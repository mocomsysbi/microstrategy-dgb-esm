Timeline.version="2.3.0";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale;};Timeline.create=function(elmt,bandInfos,orientation,unit){if(Timeline.timelines==null){Timeline.timelines=[];}var timelineID=Timeline.timelines.length;Timeline.timelines[timelineID]=null;var new_tl=new Timeline._Impl(elmt,bandInfos,orientation,unit,timelineID);Timeline.timelines[timelineID]=new_tl;return new_tl;};Timeline.createBandInfo=function(params){var theme=("theme" in params)?params.theme:Timeline.getDefaultTheme();var eventSource=("eventSource" in params)?params.eventSource:null;var ether=new Timeline.LinearEther({centersOn:("date" in params)?params.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[params.intervalUnit],pixelsPerInterval:params.intervalPixels,theme:theme});var etherPainter=new Timeline.GregorianEtherPainter({unit:params.intervalUnit,multiple:("multiple" in params)?params.multiple:1,theme:theme,align:("align" in params)?params.align:undefined});var eventPainterParams={showText:("showEventText" in params)?params.showEventText:true,theme:theme};if("eventPainterParams" in params){for(var prop in params.eventPainterParams){eventPainterParams[prop]=params.eventPainterParams[prop];}}if("trackHeight" in params){eventPainterParams.trackHeight=params.trackHeight;}if("trackGap" in params){eventPainterParams.trackGap=params.trackGap;}var layout=("overview" in params&&params.overview)?"overview":("layout" in params?params.layout:"original");var eventPainter;if("eventPainter" in params){eventPainter=new params.eventPainter(eventPainterParams);}else{switch(layout){case"overview":eventPainter=new Timeline.OverviewEventPainter(eventPainterParams);break;case"detailed":eventPainter=new Timeline.DetailedEventPainter(eventPainterParams);break;default:eventPainter=new Timeline.OriginalEventPainter(eventPainterParams);}}return{width:params.width,eventSource:eventSource,timeZone:("timeZone" in params)?params.timeZone:0,ether:ether,etherPainter:etherPainter,eventPainter:eventPainter,theme:theme,zoomIndex:("zoomIndex" in params)?params.zoomIndex:0,zoomSteps:("zoomSteps" in params)?params.zoomSteps:null};};Timeline.createHotZoneBandInfo=function(params){var theme=("theme" in params)?params.theme:Timeline.getDefaultTheme();var eventSource=("eventSource" in params)?params.eventSource:null;var ether=new Timeline.HotZoneEther({centersOn:("date" in params)?params.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[params.intervalUnit],pixelsPerInterval:params.intervalPixels,zones:params.zones,theme:theme});var etherPainter=new Timeline.HotZoneGregorianEtherPainter({unit:params.intervalUnit,zones:params.zones,theme:theme,align:("align" in params)?params.align:undefined});var eventPainterParams={showText:("showEventText" in params)?params.showEventText:true,theme:theme};if("eventPainterParams" in params){for(var prop in params.eventPainterParams){eventPainterParams[prop]=params.eventPainterParams[prop];}}if("trackHeight" in params){eventPainterParams.trackHeight=params.trackHeight;}if("trackGap" in params){eventPainterParams.trackGap=params.trackGap;}var layout=("overview" in params&&params.overview)?"overview":("layout" in params?params.layout:"original");var eventPainter;if("eventPainter" in params){eventPainter=new params.eventPainter(eventPainterParams);}else{switch(layout){case"overview":eventPainter=new Timeline.OverviewEventPainter(eventPainterParams);break;case"detailed":eventPainter=new Timeline.DetailedEventPainter(eventPainterParams);break;default:eventPainter=new Timeline.OriginalEventPainter(eventPainterParams);}}return{width:params.width,eventSource:eventSource,timeZone:("timeZone" in params)?params.timeZone:0,ether:ether,etherPainter:etherPainter,eventPainter:eventPainter,theme:theme,zoomIndex:("zoomIndex" in params)?params.zoomIndex:0,zoomSteps:("zoomSteps" in params)?params.zoomSteps:null};};Timeline.getDefaultTheme=function(){if(Timeline._defaultTheme==null){Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale());}return Timeline._defaultTheme;};Timeline.setDefaultTheme=function(theme){Timeline._defaultTheme=theme;};Timeline.loadXML=function(url,f){var fError=function(statusText,status,xmlhttp){alert("Failed to load data xml from "+url+"\n"+statusText);};var fDone=function(xmlhttp){var xml=xmlhttp.responseXML;if(!xml.documentElement&&xmlhttp.responseStream){xml.load(xmlhttp.responseStream);}f(xml,url);};SimileAjax.XmlHttp.get(url,fError,fDone);};Timeline.loadJSON=function(url,f){var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText);};var fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url);};SimileAjax.XmlHttp.get(url,fError,fDone);};Timeline.getTimelineFromID=function(timelineID){return Timeline.timelines[timelineID];};Timeline.writeVersion=function(el_id){document.getElementById(el_id).innerHTML=this.display_version;};Timeline._Impl=function(elmt,bandInfos,orientation,unit,timelineID){SimileAjax.WindowManager.initialize();this._containerDiv=elmt;this._bandInfos=bandInfos;this._orientation=orientation==null?Timeline.HORIZONTAL:orientation;this._unit=(unit!=null)?unit:SimileAjax.NativeDateUnit;this._starting=true;this._autoResizing=false;this.autoWidth=bandInfos&&bandInfos[0]&&bandInfos[0].theme&&bandInfos[0].theme.autoWidth;this.autoWidthAnimationTime=bandInfos&&bandInfos[0]&&bandInfos[0].theme&&bandInfos[0].theme.autoWidthAnimationTime;this.timelineID=timelineID;this.timeline_start=bandInfos&&bandInfos[0]&&bandInfos[0].theme&&bandInfos[0].theme.timeline_start;this.timeline_stop=bandInfos&&bandInfos[0]&&bandInfos[0].theme&&bandInfos[0].theme.timeline_stop;this.timeline_at_start=false;this.timeline_at_stop=false;this._initialize();};Timeline._Impl.prototype.dispose=function(){for(var i=0;i<this._bands.length;i++){this._bands[i].dispose();}this._bands=null;this._bandInfos=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null;};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length;};Timeline._Impl.prototype.getBand=function(index){return this._bands[index];};Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(true);this._starting=false;};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(true);this._distributeWidths();};Timeline._Impl.prototype.paint=function(){for(var i=0;i<this._bands.length;i++){this._bands[i].paint();}};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument;};Timeline._Impl.prototype.addDiv=function(div){this._containerDiv.appendChild(div);};Timeline._Impl.prototype.removeDiv=function(div){this._containerDiv.removeChild(div);};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL;};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL;};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight;};Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight;};Timeline._Impl.prototype.getUnit=function(){return this._unit;};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width";};Timeline._Impl.prototype.loadXML=function(url,f){var tl=this;var fError=function(statusText,status,xmlhttp){alert("Failed to load data xml from "+url+"\n"+statusText);tl.hideLoadingMessage();};var fDone=function(xmlhttp){try{var xml=xmlhttp.responseXML;if(!xml.documentElement&&xmlhttp.responseStream){xml.load(xmlhttp.responseStream);}f(xml,url);}finally{tl.hideLoadingMessage();}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone);},0);};Timeline._Impl.prototype.loadJSON=function(url,f){var tl=this;var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText);tl.hideLoadingMessage();};var fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url);}finally{tl.hideLoadingMessage();}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone);},0);};Timeline._Impl.prototype._autoWidthScrollListener=function(band){band.getTimeline()._autoWidthCheck(false);};Timeline._Impl.prototype._autoWidthCheck=function(okToShrink){var timeline=this;var immediateChange=timeline._starting;var newWidth=0;function changeTimelineWidth(){var widthStyle=timeline.getWidthStyle();if(immediateChange){timeline._containerDiv.style[widthStyle]=newWidth+"px";}else{timeline._autoResizing=true;var animateParam={};animateParam[widthStyle]=newWidth+"px";SimileAjax.jQuery(timeline._containerDiv).animate(animateParam,timeline.autoWidthAnimationTime,"linear",function(){timeline._autoResizing=false;});}}function checkTimelineWidth(){var targetWidth=0;var currentWidth=timeline.getPixelWidth();if(timeline._autoResizing){return ;}for(var i=0;i<timeline._bands.length;i++){timeline._bands[i].checkAutoWidth();targetWidth+=timeline._bandInfos[i].width;}if(targetWidth>currentWidth||okToShrink){newWidth=targetWidth;changeTimelineWidth();timeline._distributeWidths();}}if(!timeline.autoWidth){return ;}checkTimelineWidth();};Timeline._Impl.prototype._initialize=function(){var containerDiv=this._containerDiv;var doc=containerDiv.ownerDocument;containerDiv.className=containerDiv.className.split(" ").concat("timeline-container").join(" ");var orientation=(this.isHorizontal())?"horizontal":"vertical";containerDiv.className+=" timeline-"+orientation;while(containerDiv.firstChild){containerDiv.removeChild(containerDiv.firstChild);}var elmtCopyright=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));elmtCopyright.className="timeline-copyright";elmtCopyright.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";SimileAjax.DOM.registerEvent(elmtCopyright,"click",function(){window.location="http://code.google.com/p/simile-widgets/";});containerDiv.appendChild(elmtCopyright);this._bands=[];for(var i=0;i<this._bandInfos.length;i++){var band=new Timeline._Band(this,this._bandInfos[i],i);this._bands.push(band);}this._distributeWidths();for(var i=0;i<this._bandInfos.length;i++){var bandInfo=this._bandInfos[i];if("syncWith" in bandInfo){this._bands[i].setSyncWithBand(this._bands[bandInfo.syncWith],("highlight" in bandInfo)?bandInfo.highlight:false);}}if(this.autoWidth){for(var i=0;i<this._bands.length;i++){this._bands[i].addOnScrollListener(this._autoWidthScrollListener);}}var message=SimileAjax.Graphics.createMessageBubble(doc);message.containerDiv.className="timeline-message-container";containerDiv.appendChild(message.containerDiv);message.contentDiv.className="timeline-message";message.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){message.containerDiv.style.display="block";};this.hideLoadingMessage=function(){message.containerDiv.style.display="none";};};Timeline._Impl.prototype._distributeWidths=function(){var length=this.getPixelLength();var width=this.getPixelWidth();var cumulativeWidth=0;for(var i=0;i<this._bands.length;i++){var band=this._bands[i];var bandInfos=this._bandInfos[i];var widthString=bandInfos.width;var bandWidth;if(typeof widthString=="string"){var x=widthString.indexOf("%");if(x>0){var percent=parseInt(widthString.substr(0,x));bandWidth=Math.round(percent*width/100);}else{bandWidth=parseInt(widthString);}}else{bandWidth=widthString;}band.setBandShiftAndWidth(cumulativeWidth,bandWidth);band.setViewLength(length);cumulativeWidth+=bandWidth;}};Timeline._Impl.prototype.shiftOK=function(index,shift){var going_back=shift>0,going_forward=shift<0;if((going_back&&this.timeline_start==null)||(going_forward&&this.timeline_stop==null)||(shift==0)){return(true);}var secondary_shift=false;for(var i=0;i<this._bands.length&&!secondary_shift;i++){secondary_shift=this._bands[i].busy();}if(secondary_shift){return(true);}if((going_back&&this.timeline_at_start)||(going_forward&&this.timeline_at_stop)){return(false);}var ok=false;for(var i=0;i<this._bands.length&&!ok;i++){var band=this._bands[i];if(going_back){ok=(i==index?band.getMinVisibleDateAfterDelta(shift):band.getMinVisibleDate())>=this.timeline_start;}else{ok=(i==index?band.getMaxVisibleDateAfterDelta(shift):band.getMaxVisibleDate())<=this.timeline_stop;}}if(going_back){this.timeline_at_start=!ok;this.timeline_at_stop=false;}else{this.timeline_at_stop=!ok;this.timeline_at_start=false;}return(ok);};Timeline._Impl.prototype.zoom=function(zoomIn,x,y,target){var matcher=new RegExp("^timeline-band-([0-9]+)$");var bandIndex=null;var result=matcher.exec(target.id);if(result){bandIndex=parseInt(result[1]);}if(bandIndex!=null){this._bands[bandIndex].zoom(zoomIn,x,y,target);}this.paint();};