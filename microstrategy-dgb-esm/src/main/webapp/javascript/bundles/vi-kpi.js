(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.vi.ui.rw._HasVisSelections");var A=mstrmojo.hash,D=mstrmojo.array,G=mstrmojo.vi.ui.rw.SelectionType;function F(L){var K=-1,M=this.modelData.gts.row||[],J=M.length,N;for(N=0;N<J;N+=1){if(M[N].id===L){K=N;}}return K;}mstrmojo.kpicard._SupportKPICardBrushesAndHighlights=mstrmojo.provide("mstrmojo.kpicard._SupportKPICardBrushesAndHighlights",{_mixinName:"mstrmojo.kpicard._SupportKPICardBrushesAndHighlights",prepareLMCSelectionData:function H(){this.clearSelections();var J=this.selectedCards;D.forEach(J,function(K){var L=K.dataModel;this.addAttributeSelection(L.attrId,L.elemId,L.categoryElemName);},this);},prepareRMCSelectionData:function C(){this.clearCxtMnuSelection();var J=this.contextMenuSelections;D.forEach(J,function(K){var L=K.dataModel;this.addContextMenuAttributeSelection(L.attrId,L.elemId,L.categoryElemName);},this);},kpiInitialHighlight:function I(){var J=mstrApp.isInVFConfigMode||this.isCustomSort?null:this.findSelectorControl();if(J&&!J.isNavigation&&!A.isEmpty(J.exp)&&this.addSelectionsFromExpression&&this.highlight){this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}this.initialHighlight();},normalizeElementId:function E(M){var L=this.model,K=this.normalizedIdCache,J=K[M];if(!J){J=L.getNormalizedFormElementId(M);K[M]=J;}return J;},highlight:function B(Q,M){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill||this.isEmpty()||this.excludeData){return ;}var L,R,O,N,J,P,K;if(Q===G.ATTS||Q===G.METRICS){this.clearSelectedCards();this.clearMenuData();for(L in M){if(M.hasOwnProperty(L)){R=M[L];for(O in R){if(R.hasOwnProperty(O)){N=F.call(this,O);if(N>=0){J=R[O];if(J&&J.length>0){K=this.normalizeElementId(J[0].id);P=this.getCardInfoByElementId(K).card;}if(P){this.addToSelectedCards(P);}}}}}}}else{if(Q===G.EMPTY){this.clearSelectedCards();this.clearMenuData();}}},clearSelections:function(J){if(this._super){this._super();}if(J){this.clearSelectedCards();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=Math,I=mstrmojo.dom,K=mstrmojo.css,E="active",L="ready",J=6,F=10,O=10,P={LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",BUTTON:"button"};mstrmojo.util.ui.LassoSelectorParamsType=null;function Q(S,R,T){return function(U){S.call(mstrmojo.all[R],U,T);};}function M(S){var U=S.view,T=I.eventTarget(window,S),R=this.lassoSelector;if(this.clickFromLassoResizer||(T!==R&&this.clickFromCreatingLasso)){I.stopPropogation(U,S);I.preventDefault(U,S);}delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;}function D(b,U){var R,d,S,Z,a=b.clientX,Y=b.clientY,T=this.lassoSelector,X=U.startX,W=U.startY,V=U.containerPos,e=a-V.x,c=Y-V.y;e=C.min(e,U.maxX);e=C.max(e,U.minX);c=C.min(c,U.maxY);c=C.max(c,U.minY);R=C.abs(e-X);d=C.abs(c-W);Z=C.min(W,c);S=C.min(X,e);T.style.width=R+"px";T.style.height=d+"px";T.style.left=S+"px";T.style.top=Z+"px";U.width=R;U.height=d;U.left=S;U.top=Z;if(R<=O&&d<=O){T.style.visibility="hidden";K.removeClass(T,E);}else{T.style.visibility="visible";K.addClass(T,E);document.body.style.cursor="crosshair";}}function H(T,W){var V=window.document,S=this.lassoSelector,U=W.width,R=W.height;I.detachEvent(V,"mousemove",W.fnMove);I.detachEvent(V,"mouseup",W.fnUp);delete W.fnMove;delete W.fnUp;document.body.style.cursor="default";if(!U||U===0||!R||R===0){this.dismissLassoSelector();}else{W.ctrlKey=T.ctrlKey;this.lassoSelected(W);this.clickFromCreatingLasso=true;K.addClass(S,L);this.positionBoxResizers();}}function N(g){var Z,c=g.view,b,a,d=I.eventTarget(window,g),R=d.getAttribute("type"),V=this.lassoSelector,S=this.lassoContainer,h=this.excludeAttrArr,U=h.length,Y,X={};delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;if(!V||!S||!this.lassoSelectorEnabled){return ;}if(I.contains(this.dropDownBtn,d,true)){return ;}for(Z=0;Z<U;Z++){if(R===h[Z]){return ;}}this.lassoSelecting();Y=I.position(S);b=g.clientX-Y.x;a=g.clientY-Y.y;X.containerPos=Y;X.maxX=Y.w;X.maxY=Y.h;X.startX=b;X.startY=a;X.minX=0;X.minY=0;X.info=this.getLassoSelectionInfo(d);X.useAsSelectorOrBrushes=this.useAsSelectorOrBrushes||((this.hasAssociatedNodes&&this.hasAssociatedNodes())||this.selectorControl);V.style.visibility="hidden";V.style.left=b+"px";V.style.top=a+"px";V.style.width="0px";V.style.height="0px";K.removeClass(V,L);S.appendChild(V);var T=this.id,e=document,W=Q(D,T,X),f=Q(H,T,X);I.attachEvent(e,"mousemove",W);I.attachEvent(e,"mouseup",f);X.fnMove=W;X.fnUp=f;I.stopPropogation(c,g);I.preventDefault(c,g);}function G(a,U){var Y=U.index,X=U.startX,W=U.startY,V=U.containerPos,f=a.clientX-V.x,e=a.clientY-V.y,T=this.lassoSelector;f=C.min(f,U.maxX);f=C.max(f,U.minX);e=C.min(e,U.maxY);e=C.max(e,U.minY);var d=f-X,c=e-W;if(Y%3===1){d=0;}if(Y===3||Y===5){c=0;}var R=U.selWidth,b=U.selHeight,S=U.selLeft,Z=U.selTop;if(d!==0){if(Y%3===0){S+=d;R-=d;}else{R+=d;}}if(c!==0){if(Y<3){Z+=c;b-=c;}else{b+=c;}}T.style.width=R+"px";T.style.left=S+"px";T.style.top=Z+"px";T.style.height=b+"px";U.width=R;U.left=S;U.height=b;U.top=Z;this.positionBoxResizers();}function B(R,U){var T=R.view,S=window.document;I.detachEvent(S,"mousemove",U.fnMove);I.detachEvent(S,"mouseup",U.fnUp);delete U.fnMove;delete U.fnUp;this.clickFromLassoResizer=true;I.stopPropogation(T,R);I.preventDefault(T,R);this.lassoSelectorResized(U);}function A(V){var T=V.view,h=I.eventTarget(window,V),U=parseInt(h.getAttribute("index"),10),a=this.lassoSelector,Z=a.offsetLeft,j=a.offsetTop,Y=Z+a.offsetWidth,g=j+a.offsetHeight,R=I.position(this.lassoContainer),f=0,c=0,d=R.w,b=R.h,e={};if(U%3===0){d=Y-F;}if(U%3===2){f=Z+F;}if(U<3){b=g-F;}if(U>=6){c=j+F;}e.minX=f;e.minY=c;e.maxX=d;e.maxY=b;e.startX=V.clientX-R.x;e.startY=V.clientY-R.y;e.index=U;e.containerPos=R;e.selWidth=a.clientWidth;e.selHeight=a.clientHeight;e.selLeft=a.offsetLeft;e.selTop=a.offsetTop;var X=this.id,i=document,S=Q(G,X,e),W=Q(B,X,e);I.attachEvent(i,"mousemove",S);I.attachEvent(i,"mouseup",W);e.fnMove=S;e.fnUp=W;I.stopPropogation(T,V);I.preventDefault(T,V);}mstrmojo.util.ui._LassoSelector=mstrmojo.provide("mstrmojo.util.ui._LassoSelector",{_mixinName:"mstrmojo.util.ui._LassoSelector",lassoContainer:undefined,lassoSelector:undefined,lassoSelectorEnabled:true,excludeAttrArr:null,boxResizers:null,useDropDownBtn:false,dropDownBtn:undefined,init:function(R){if(this._super){this._super(R);}this.excludeAttrArr=[];this.boxResizers=[];},registerLassoSelector:function(S,V,U){V=V||[];V.push(P.LASSO_SELECTOR);V.push(P.LASSO_RESIZER);V.push(P.BUTTON);this.lassoContainer=S;this.excludeAttrArr=V;this.useDropDownBtn=U||false;I.attachEvent(S,"mousedown",Q(N,this.id));I.attachEvent(S,"click",Q(M,this.id));var R=this.lassoSelector;if(!R){R=this.createLassoSelector();this.lassoSelector=R;}var T=R.parentNode;if(T){T.removeChild(R);}},createLassoSelector:function(){var U,V,S,T=this.boxResizers,R=document.createElement("div");R.setAttribute("class","lasso-selector");R.setAttribute("type",P.LASSO_SELECTOR);R.setAttribute("draggable",false);R.draggable=false;for(U=0;U<9;U++){if(U!==4){V=document.createElement("div");V.setAttribute("class","lasso-selector-resizer");V.setAttribute("type",P.LASSO_RESIZER);V.setAttribute("index",String(U));V.setAttribute("draggable",false);V.draggable=false;R.appendChild(V);T[U]=V;I.attachEvent(V,"mousedown",Q(A,this.id));}}K.addClass(T[0],["top","left"]);K.addClass(T[1],["top"]);K.addClass(T[2],["top","right"]);K.addClass(T[3],["left"]);K.addClass(T[5],["right"]);K.addClass(T[6],["bottom","left"]);K.addClass(T[7],["bottom"]);K.addClass(T[8],["bottom","right"]);if(this.useDropDownBtn===true){S=document.createElement("div");S.setAttribute("type",P.BUTTON);S.setAttribute("class","lasso-selector-dropdown-button");R.appendChild(S);I.attachEvent(S,"click",Q(this.lassoButtonClicked,this.id));this.dropDownBtn=S;}return R;},positionBoxResizers:function(){var T=this.boxResizers,S=this.lassoSelector,U=S.clientWidth,R=S.clientHeight,W=(U-J)>>1,V=(R-J)>>1;T[1].style.left=W+"px";T[3].style.top=V+"px";T[5].style.top=V+"px";T[7].style.left=W+"px";},dismissLassoSelector:function(){var R=this.lassoSelector;if(R){K.removeClass(R,[E,L]);if(R.parentNode){R.parentNode.removeChild(R);}}},isLassoSelectorActive:function(){function S(V,U){var W=V.className.split(/\s+/),T;for(T=0;T<W.length;T++){if(W[T]===U){return true;}}return false;}var R=this.lassoSelector;if(R){return S(R,E);}return false;},getLassoSelectionInfo:mstrmojo.emptyFn,lassoSelected:mstrmojo.emptyFn,lassoSelecting:mstrmojo.emptyFn,lassoButtonClicked:mstrmojo.emptyFn,lassoSelectorResized:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var N=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,M=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(O){return O.model.controller.cmdMgr;}function L(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function O(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(P,R){var O,U,Q,S,T={};T.tks=this.k;T.selectorObjects=P;T.keepOnly=!!R;T.isDocVis=true;O=L.call(this);U=O.getDataService();Q=U.getGMViewFilterAction(T);S=O.getSliceCallback(T);return{action:Q,callbacks:S};}function B(Q,P){var O,S,R;O=L.call(this);R=O.getDataService();if(!this.isXMLDirty()){R.submitUpdates(Q,P);}else{S=this.getPersistAction();R.submitUpdates([Q,S],P);this.resetXMLDirtyFlag();}}function A(){var b=this.modelData||this.model.data,S=b.k,Z,Y="FormattingWidget",U,T,X,P,Q,R=[],W=[],V=this.edtModel;if(!b){console.log("warning: modelData is missing");return null;}var a=function(d,f){var c=T.createElement(f),e;if(d instanceof Object){for(e in d){if(d.hasOwnProperty(e)){var g=a(d[e],e);if(g){c.appendChild(g);}}}}else{c.setAttribute("value",d);}return c;};var O=function(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");};X=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!X||X.length===0){U=this.getProperties(S);if(this.useCompatibleXML){T=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");T.firstChild.appendChild(a(U,"fmt"));}else{T=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");T.firstChild.firstChild.appendChild(a(U,"fmt"));}X=(new XMLSerializer()).serializeToString(T);}P=O(X);Q={act:"setProperty",nodeKey:S,prs:Y,pri:4,v:P};R.push(Q);return R;}function F(P,Q,O,T){if(!(T instanceof Function)){return D;}var S=this.id;function R(U){return function(){var W=mstrmojo.all[S],V;if(!W){return ;}V=W.getProperties();V[P]=U;T.call(W,U,true);W.getDocModel().selectVIUnit(W.parent.id,true);};}return{silent:true,undo:R(O),redo:R(Q)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(R){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var Q=this,P,O=(Q.getDocModel&&Q.getDocModel())||Q.model.docModel;if(O){return O.attachEventListener("colorMapChanged",Q.id,function(T){P=Q.parent&&Q.parent.parent;if(Q.forceUpdateColorMap||(P&&P.isPanelDisplaying())){R.call(Q);}else{var S=P.attachEventListener("panelDisplaying",Q.id,function(U){if(Q.postBuilderingCalled){R.call(Q);}P.detachEventListener(S);});}});}},detachUpdateColorMapListener:function(P){if(!P){return ;}var O=(this.getDocModel&&this.getDocModel())||this.model.docModel;O.detachEventListener(P);},updateTargets:function(P){var S={},Q=this,O=L.call(this);S.fromGM=true;S.type=1;S.src=this.k;S.selectorObjects=P;function R(V){var T=Q.modelData||Q.model.data,U=T.sc;if(U!==undefined){return U[V];}return undefined;}S.keepOnly=true;S.ck=R.call(this,"ck");S.keyContext=S.ck;S.tks=R.call(this,"tks");S.ckey=R.call(this,"ckey");S.isDocVis=true;S.include=true;S.showall=R.call(this,"showall");O.slice(S);},updateAfterViewFilter:function(Q,O){var V,U,P,T,S,W,R;V=L.call(this);U=V.getDataService();T=E.call(this,Q,O);P=T.action;S=T.callbacks;R=this.model.controller||V.controller;if(this.currKeepOnlyAction){W=[C.clone(this.currKeepOnlyAction)];}else{W=E.call(this,[],false).action;}this.currKeepOnlyAction=P;R.submitUndoRedoUpdates([P],W,S);},updateAfterKeepOnly:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnly(this,R,{keepOnly:Q,data:this.getContextMenuSelections()},Q?-2:undefined);},updateAfterKeepOnlyForMultiTemplate:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnlyForMutilTemplate(Q,R,true);},updateAfterDrill:function(O,c,Y){var Z=this,d=L.call(this),b=d.getDataService(),T=b.newUpdate(),R=this.getContextMenuSelections(),P=Y||this,S=P.model,U=P.model.data||P.node.data,X=S.getSelectorDataFromTemplateLimit(U.tpl).concat({keepOnly:true,data:R}),Q=d.getKeepOnlyOrExcludeAction(U.k,X),V=Z.model.controller||d.controller,W=V._getXtabCallback(Z);T.add(O,M(c,W));T.add(Q,H.call(Z));K(Z).execute({execute:function a(){this.submitUpdate(T);},urInfo:{callback:T.callback}});},updateAfterSort:function(R){var P=this,O=L.call(this),S=O.getDataService(),T=O.getSliceCallback({tks:P.k});K(P).execute({execute:function Q(){var V=S.newUpdate(this,undefined),U={act:"sortGM",nodeKey:P.k,subActions:R,partialUpdate:{nodes:[P.k]}};V.add(U,T,undefined);if(P.isXMLDirty()){V.addActions(P.getPersistAction());}this.submitUpdate(V,undefined);},urInfo:{callback:T}});},updateAfterAction:function(T,O,P,a,X){if(!T){return ;}var V=this,Q=V.parent&&V.parent.id,b=V.model.docModel,U=V.model.controller||b.controller,Z,Y,S={},W,R=X||D;if(P){Z=mstrmojo.emptyFn;W=function(){this.submitSilent(T);};}else{Z=b.getSliceCallback({tks:this.k});Z.success=G([Z.success,function(){b.selectVIUnit(Q,true);}]);W=function(){this.submit(T,Z,S);};}Y=U._getXtabCallback(V);if(O){Z=M(Z,O);Y=M(Y,O);}Y.success=G([Y.success,function(){b.selectVIUnit(Q,true);}]);if(P){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,S);}if(a){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,S);}K(this).execute({execute:W,urInfo:{silent:R.silent,callback:Y,redo:R.redo,undo:R.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(P,Q,O,R){this.updateAfterAction(A.call(this),P,Q,O,R);},setProperty:function(V,R,T){var P=T.callback,Q=!!T.suppressData,X=T.requestDefinition,S=T.clientUndoRedoCallback,W=this.getProperties(),O=W[V],U;if(V===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,R);}}else{if(W&&(W[V]===undefined||W[V].toString()!==R.toString())){W[V]=R;U=F.call(this,V,R,O,S);this.updateAfterPropertiesChange(P,Q,X,U);}}},showData:function(O){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum","mstrmojo.util.FontLoader");var h=mstrmojo.VisUtility,f=mstrmojo.kpicard.BADGE_MODE,S=mstrmojo.kpicard.DISPLAY_MODE,e=mstrmojo.kpicard.KPI_STYLES_CONFIG,O=mstrmojo.kpicard.KPI_STYLES,N=mstrmojo.kpicard.KPI_PROPERTIES,M=mstrmojo.kpicard.TEXT_SIZE_TYPE,C=mstrmojo.kpicard.CAN_SET_FONT_PARTS,Q=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,L=mstrmojo.kpicard.DEFAULT_PROPS,T=mstrmojo.hash,P=mstrmojo.array;var d=[N.CUSTOM_KPI_STYLE,];mstrmojo.kpicard._KPICardProperty=mstrmojo.provide("mstrmojo.kpicard._KPICardProperty",{_mixinName:"mstrmojo.kpicard._KPICardProperty",handlePropValChange:function b(j,k,i){switch(j){case N.SHOW_METRIC_NAME:this.onShowMetricNameChange(k);break;case N.DISPLAY_MODE:this.onDisplayModeChange(k);break;case N.AUTO_PLAY:this.onAutoPlayChange(k);break;case N.KPI_STYLE:this.onStyleChange(k);break;case N.CUSTOM_KPI_STYLE:this.onCustomKPIStyleChange();break;case N.NEW_FONT:this.onFontChange(k);break;case N.TEXT_SIZE_TYPE:this.onTextSizeTypeChange(k);break;case N.PREVIOUS_METRIC_NAME:this.onPrevMetricNameChange();break;case N.INCREASE_BG_COLOR:case N.DECREASE_BG_COLOR:this.onBadgeBgClrChange();break;case N.BADGE_MODE:this.onBadgeModeChange();break;case N.COLOR_THRESHOLDS:this.onColorThresholdsChange();break;case N.CURRENT_SLIDE_ELEMENT:this.onStackedSlideChange(k,i);break;case N.FIX_CARD_HEIGHT:case N.GRID_COLUMN_COUNT:case N.CARD_HEIGHT:this.plot();this.initialHighlight();break;default:break;}},migrateOldFontProps:function I(){var l=this.model.data.vp;if(!l){return ;}var k=l[N.FONT];var j=l[N.UNIFY_STEPS];if((k||j)&&!l[N.NEW_FONT]){var i={};T.forEach(C,function(n){i[n]={};i[n][Q.FONT_FAMILY]=k;if(j){i[n][N.UNIFY_STEPS]=j;}});l[N.NEW_FONT]=JSON.stringify(i);}var m=l[N.UNIFY_TEXT_SIZE];if(m&&!l[N.TEXT_SIZE_TYPE]){l[N.TEXT_SIZE_TYPE]=m==="true"?M.UNIFIED:M.FIT_TO_CONTAINER;}},onDisplayModeChange:function g(j){var i=this.getFormatPropertyValue(N.TEXT_SIZE_TYPE);if(j===S.STACKED&&i===M.UNIFIED){this.updateProperties(N.TEXT_SIZE_TYPE,M.FIT_TO_CONTAINER);}this.plot();this.initialHighlight();},onShowMetricNameChange:function K(i){this.layoutor.forEachChild(function(j){j.renderMetricName(i);});this.unifyNodeFontSize("metricNameNode");},onAutoPlayChange:function U(i){if(typeof this.layoutor.toggleSlick==="function"){this.layoutor.toggleSlick(i);}},onCustomKPIStyleChange:function(){this.layoutor.forEachChild(function(i){i.updateStyle();});},onStyleChange:function W(j){var k=this;var i=function(){var n=k.getDefaultFontColor();var m=[];T.forEach(C,function(o){if(C.TREND_IDENTITY!==o){m.push({part:o,propName:Q.COLOR,propValue:n});}});k.updateProperties(N.NEW_FONT,m);};var l=this.isDefaultKPIStyle(j);if(l){i();}this.layoutor.forEachChild(function(m){m.updateStyle();if(m&&m.applyDefaultFontColor&&l){m.applyDefaultFontColor();}});if(l){this.applyColorThresholds();}},onFontChange:function R(n){var l=this;var j=n.map(function(o){return o.part;});var i=function(){l.layoutor.forEachChild(function(o){o.renderByFont(j);});if(l.getFormatPropertyValue(N.TEXT_SIZE_TYPE)!==M.FIXED){l.modifyFontSize(j);}};var m=n[0].propName;if(m===Q.FONT_FAMILY){var k=n[0].propValue;this.loadFonts([{name:k,isItalic:false,isBold:false},{name:k,isItalic:false,isBold:true},],{success:i,failure:i});return ;}if(m===N.UNIFY_STEPS){this.onUnifyStepsChange(n);return ;}i();},onTextSizeTypeChange:function Y(k){if(k===M.FIXED){var j=[[this.unifyMetricNameSize,C.LABEL],[this.unifyMetricValueSize,C.PRIMARY_VALUE],[this.unifyPrevMetricSize,C.PREVIOUS_VALUE],[this.unifyBadgeSize,C.TREND_IDENTITY],];var i=[];P.forEach(j,function(l){if(!isNaN(l[0])){i.push({part:l[1],propName:Q.FONT_SIZE,propValue:l[0]+"px",});}});this.updateProperties(N.NEW_FONT,i);}this.layoutor.forEachChild(function(l){l.renderByFont();});if(k!==M.FIXED){this.modifyFontSize();}},onUnifyStepsChange:function D(k){var j=this;var i=k.map(function(l){return l.part;});this.layoutor.forEachChild(function(m){var l=m.dataModel;if(l.prevMetricFmtValue&&i.indexOf(C.PREVIOUS_VALUE)>-1){l.prevMetricInfo=j.getPrevMetricInfoString(l.prevMetricFmtValue);m.renderPrevMetricInfo();}if(j.plusMinus===0&&k[0].propValue==="0"){m.renderByFont(i);}m.applyUnifySteps(j.plusMinus===1?"plus":"minus",i);});},onPrevMetricNameChange:function G(){var i=this;this.layoutor.forEachChild(function(k){var j=k.dataModel;if(j.prevMetricFmtValue){j.prevMetricInfo=i.getPrevMetricInfoString(j.prevMetricFmtValue);k.renderPrevMetricInfo();}});this.unifyNodeFontSize("prevMetricNode");},onBadgeModeChange:function X(){var j=this.getFormatPropertyValue(N.BADGE_MODE),i=this;this.layoutor.forEachChild(function(l){var k=l.dataModel;if(k.prevMetricFmtValue){i.generateCmpString(k,j);l.renderCompareNode();}});if(j!==f.NONE){this.unifyNodeFontSize("compareNode");}},onBadgeBgClrChange:function A(){var j=this.getFormatPropertyValue(N.INCREASE_BG_COLOR),i=this.getFormatPropertyValue(N.DECREASE_BG_COLOR),k=this;this.layoutor.forEachChild(function(n){var l=n.dataModel,o=l.chartOption,m=n.chartInstance;l.cmpBgClr=l.compareToPrev>=0?j:i;if(o){o.series[0].itemStyle=k.getItemStyle(n);}if(m){m.setOption(o);}if(n.compareNode.textContent||n.compareNode.innerText){n.applyCmpNodeBgClr();}});},onColorThresholdsChange:function B(){this.initColorThresholds();this.applyColorThresholds();},onStackedSlideChange:function F(l,i){var j=this.layoutor,k;if(!j){return ;}j.urFlag=false;k=j.findCardIdxByElemId(l);if(this.isInStackedMode()&&!this.isStackedAutoPlay()&&j.getCurrentSlickSlideIndex()!==k){j.urFlag=!!i;j.manualSlickGoto(k,true);}},getProperties:function(){var i=this.model.data;return(i&&i.vp)||{};},getPrevMetricInfoString:function a(j){var k=this.getFormatPropertyValue(N.PREVIOUS_METRIC_NAME),i;if(k===""){i=j;}else{i=k+": "+j;}return i;},getDefaultPrimaryValueColor:function(){var i=this.getFontValue();return i[C.PRIMARY_VALUE][Q.COLOR];},getFontValue:function H(j){this.migrateOldFontProps();var k=this.getProperties();var m;try{m=JSON.parse(k[N.NEW_FONT]);}catch(l){m={};}if(j){return m;}var i={};i[Q.FONT_FAMILY]=this.getDefaultFontFamily();i[Q.FONT_SIZE]="8pt";i[Q.FONT_WEIGHT]=false;i[Q.FONT_STYLE]=false;i[Q.UNDERLINE]=false;i[Q.LINE_THROUGH]=false;i[Q.COLOR]=this.getDefaultFontColor();i[N.UNIFY_STEPS]="0";T.forEach(C,function(n){var o=T.copy(i,{});if(n===C.TREND_IDENTITY){o[Q.COLOR]="#ffffff";}else{if(n===C.PREVIOUS_VALUE){o[Q.FONT_WEIGHT]=true;o[Q.FONT_STYLE]=true;}}m[n]=T.copy(m[n]||{},o);});return m;},getFormatPropertyValue:function V(i){var j=this.getProperties(),m;if(j[i]===undefined){if(i===N.BADGE_MODE){m=this.isPercentNumberStyle?f.VALUE:f.PERCENTAGE;}else{if(i===N.PREVIOUS_METRIC_NAME){m=mstrmojo.desc(1058,"Previous")+" "+this.getTrendAttributeName();}else{if(i===N.GRID_COLUMN_COUNT){m=L[i];m=parseInt(m);var l=this.singleKPIModels.length;m=m<=l?m:l;m=m.toString();this.updateProperties(i,m);}else{m=L[i];}}}}else{m=j[i];}if(i===N.NEW_FONT){m=this.getFontValue();}if(d.indexOf(i)>-1&&m!==undefined){try{m=JSON.parse(m);}catch(k){console.error(k,m);m=undefined;}}if(i===N.AUTO_PLAY||i===N.FIX_CARD_HEIGHT){m=h.isTrue(m);}else{if(i===N.CARD_HEIGHT||i===N.GRID_COLUMN_COUNT){m=parseInt(m);}}return m;},generateFontProps:function(j){var i=this.getFontValue(true);P.forEach(j,function(k){i[k.part]=i[k.part]||{};i[k.part][k.propName]=k.propValue;});return i;},generateUpdatedCustomStyleConfigs:function(i,l,m){var k=this.getFormatPropertyValue(N.CUSTOM_KPI_STYLE);var j=P.find(k||[],"id",i);if(j<0){console.error("invalid styleId: ",i);return k;}k[j][l]=m;return k;},getSpecificKPIStyle:function(k){if(this.isDefaultKPIStyle(k)){return e[k];}var j=this.getFormatPropertyValue(N.CUSTOM_KPI_STYLE);var i=P.find(j||[],"id",k);if(i<0){return undefined;}return j[i];},initCustomKPIStyle:function(m){var k=this.getFormatPropertyValue(N.KPI_STYLE);var i=this.getFormatPropertyValue(N.CUSTOM_KPI_STYLE);var j=e[k];var l="custom";if(!this.isDefaultKPIStyle(m)&&this.isDefaultKPIStyle(k)&&!i){i=[{id:l,name:mstrmojo.desc(14417,"Customize"),bgColor:j.bgColor,bgOpacity:j.bgOpacity,chartColor:j.chartColor,chartOpacity:j.chartOpacity,},];this.updateProperties(N.CUSTOM_KPI_STYLE,i);}},isDefaultKPIStyle:function(j){j=j||this.getFormatPropertyValue(N.KPI_STYLE);var i=false;T.forEach(O,function(k){if(k===j){i=true;}});return i;},updateProperties:function J(i,m){if(!i){return ;}if(i===N.NEW_FONT){m=JSON.stringify(this.generateFontProps(m));}else{if(i===N.KPI_STYLE){this.initCustomKPIStyle(m);}}var k=this.model.data,j=k&&k.vp,l=true;if(!j){console.log("invalid properties");return ;}if(m===undefined){delete j[i];}else{if(j[i]===undefined||j[i].toString()!==m.toString()){if(d.indexOf(i)>-1){j[i]=JSON.stringify(m);}else{j[i]=m;}}else{l=false;}}if(l){this.postUpdateProperties(i,m);}return l;},postUpdateProperties:function E(i,l){var j,k,m;if(i===N.AUTO_PLAY){if(l===false){j=this.layoutor;if(!(j&&j.getCurrentSlickSlideIndex)){return ;}k=j.getCurrentSlickSlideIndex();m=j.findCardElemIdByIdx(k);this.updateProperties(N.CURRENT_SLIDE_ELEMENT,m);}else{this.updateProperties(N.CURRENT_SLIDE_ELEMENT,undefined);}}else{if(i===N.KPI_STYLE){this.initCustomKPIStyle();}}},getFontOldValue:function(k){var j;this.fontStack=this.fontStack||[];var l=this.fontStack.pop();if(l){j=l;}else{j=[];var i=this.getFontValue();P.forEach(k,function(m){j.push({part:m.part,propName:m.propName,propValue:i[m.part][m.propName],});});}this.fontStack.push(k);return j;},writeProperties:function Z(o,j,q){var p=this.id;var i;if(o===N.NEW_FONT){i=this.getFontOldValue(j);}else{i=this.getFormatPropertyValue(o);}var k=this.updateProperties(o,j);var m=true;var l=this.zonesModel&&this.zonesModel.getUpdateCallback();var r=function(t,y,x,w,u){var v=mstrmojo.all[p];if(!v){return ;}if(w){P.forEach(w,function(z){v.updateProperties(z.propertyName,u?z.oldValue:z.value);});}if(y){v.updateProperties(o,t);}if(!(v.isEmpty()||v.excludeData)){v.handlePropValChange(o,t,x);}if(m&&l){l.success();}};if(k){r(j,false,undefined,q,false);var n={undo:function(){r(i,true,true,q,true);},redo:function(){r(j,true,true,q,false);}};var s;if(m){n.silent=true;}else{s=this.getDocModel().controller._getXtabCallback(this);}if(s){n.callback=s;}this.submitUpdates({requestCallback:s,urInfo:n},m);}},submitUpdates:function c(k,n){if(!k){return ;}var j=this.getDocModel(),p=j&&j.getDataService(),l=k.urInfo,i={style:{params:{treesToRender:2}}},o=this.getSetPropertiesAction(),m;if(!p||!j||!j.controller||o.length===0){return ;}if(n){i.style=mstrmojo.DocDataService.SUPPRESS_DATA;}m=j.controller.cmdMgr;if(m){m.execute({execute:function(){var q=p.newUpdate();q.add(o,k.requestCallback,i);if(n){this.submitSilent(q.actions);}else{this.submitUpdate(q);}},urInfo:l});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.viz.EnumDSSDropZones");var k=mstrmojo.array,S=mstrmojo.hash,E=mstrmojo.css,Q=mstrmojo.dom,e=mstrmojo.vi.enums.EnumFeatures,d=mstrmojo.VisUtility,i=mstrmojo.vi.viz.EnumDSSDropZones;function l(AB,z){var v=Math.max(AB.x,z.x),AD=Math.max(AB.y,z.y),AA=Math.min(AB.x+AB.w,z.x+z.w)-v,AC=Math.min(AB.y+AB.h,z.y+z.h)-AD;if(AA<0||AC<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:v,y:AD,w:AA,h:AC};}function P(){var AE=this.breakByAttrSupportsViewFilter,z=new mstrmojo.ui.menus.MenuConfig(),w=new mstrmojo.ui.menus.MenuConfig(),AG={filter:z,showData:w},AB=this,AA=this.contextMenuSelections,AC=function(AN){var AH=AB.contextMenuSelections,AJ=AH[0],AI=AJ&&AJ.dataModel,AM=AI&&AI.attrId,AL=AI&&AI.categoryName,AK={id:AM,n:AL};return d.getDrillMenu.bind(d,AB,AM,AN,{drillFromUnit:AK});},y,x,AF=AA&&AA.length,v,AD;if(!AA||AF<=0){return AG;}if(AE){if(this.isLinkedFilterEnabled()){y=function(){AB.handleContextMenuSelectionData(true);};z.addMenuItem(mstrmojo.desc(15070,"Go to Targets"),"",y);z.addSeparator();}z.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));z.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(e.WEB_DRILL_AND_LINK)){v=false;for(x=0;x<AF;x+=1){AD=AA[x];if(AD&&d.getDrillCandidates(this,AD.dataModel.attrId).length>0){v=true;break;}}if(v){z.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,AC(this.getMenuHandler("drill")),"xt");}else{z.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}}if(!mstrApp.isDossier&&!this.excludeData){w.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"xt",this.getMenuHandler("showData"));}}return AG;}function T(){if(mstrApp.isAppStatePresentation()||mstrApp.isInVFConfigMode){return{};}var w={},v=this.contextMenuSelections,y,x=function(z){return z.dataModel.categoryElemName;};if(v&&v.length>0){y=this.getCellForNode(v[0]);w=d.getGroupAndCalculationContextMenu(this,y,{selection:v,skipSingleAttrCheck:true,fnCellName:x});}return w;}function o(z,y){var w=this.menuAnchor,v,x=this;if(!w){w=document.createElement("div");w.id=this.id+"-kpicard-menu-anchor";w.style.position="absolute";document.body.appendChild(w);this.menuAnchor=w;}w.style.left=y.pageX+"px";w.style.top=y.pageY+"px";w.style.zIndex=101;this.configurePopup(z,w);v=z.newInstance();if(v){v.onCloseMenuCallBack=function(){x.clearMenuData();x.prepareRMCSelectionData();x.contextMenuDismiss=true;};this.openPopup(v);}}function J(AB,y){var AA=this,AE={act:"updateTemplate",keyContext:AA.k,actions:[]},w=AE.actions,AH=[d.pick(AB,["did","t"])],x=y.drillFromUnit.id,AD={id:i.BreakBy},AC=AA.zonesModel,z=AC.getZoneModelByZoneId(AD.id),AG=z.items||[],AF,v=d.findInArray(AG,function(AI){return AI.did===x;});if(v!==-1){AF=AG[v];}if(AF){Array.prototype.push.apply(w,AC.getRemoveDropZoneUnitActions(AD,AF));Array.prototype.push.apply(w,AC.getAddDropZoneUnitsActions(AD,AH,AF.idx));}return AE;}function p(AA,v,AD){var AC=AA.x,z=AC+AA.w,AB=AA.y,w=AB+AA.h;return v<=z&&v>=AC&&AD<=w&&AD>=AB;}mstrmojo.kpicard._KPICardInteractivity=mstrmojo.provide("mstrmojo.kpicard._KPICardInteractivity",{_mixinName:"mstrmojo.kpicard._KPICardInteractivity",contextMenuDismiss:false,handleLMCSelection:function h(AA,x){this.noHighlightAfterKeepOnlyExcludeDrill=false;var AB=AA.ctrlKey||AA.metaKey,z=this.selectedCards,w=z&&z.length,y=w&&w>1,v=this.isClearAllEnabled();if(!AB){if(!x.selected||(x.selected&&y)){this.clearSelectedCards();this.addToSelectedCards(x);}else{if(v){this.clearSelectedCards();}}}else{if(x.selected){if(y||v){this.removeCardFromSelectedCards(x);}}else{this.addToSelectedCards(x);}}this.displayVizBoxVisFilterIndicator(true,this.parent);this.clearMenuData();this.prepareLMCSelectionData();this.endSelections();this.contextMenuDismiss=false;},addToSelectedCards:function D(v){if(v.selected===false){v.selected=true;this.selectedCards.push(v);v.updateHighlight();}},removeCardFromSelectedCards:function j(v){var x=this.selectedCards,y=x&&x.length,w=x.indexOf(v);if(!y){return ;}if(w!==-1){v.selected=false;v.updateHighlight();x[w]=x[y-1];x.pop();}},clearSelectedCards:function R(){var w,v,x=this.selectedCards,y=x&&x.length;if(!y){return ;}for(w=0;w<y;w+=1){v=x[w];v.selected=false;v.updateHighlight();}this.selectedCards=[];},lassoSelecting:function A(){E.removeClass(this.lassoSelector,"lasso-selector-hasContent");this.onLassoSelection=true;},lassoSelected:function V(v){if(Q.supportsTouches===true){return ;}this.areaSelect({x:v.left,y:v.top,w:v.width,h:v.height},v);if(this.selectedCards.length){E.addClass(this.lassoSelector,"lasso-selector-hasContent");}this.noHighlightAfterKeepOnlyExcludeDrill=false;this.dismissLassoSelector();this.displayVizBoxVisFilterIndicator(true,this.parent);},dismissLassoSelector:function Z(){if(this._super){this._super();}this.onLassoSelection=false;},areaSelect:function I(w,y){var v=this;var x=this.layoutor;if(isNaN(w.x)||isNaN(w.y)||isNaN(w.w)||isNaN(w.h)){return ;}if(!y.ctrlKey){this.clearSelectedCards();}this.clearMenuData();x.forEachChild(function(z){var AB=z.getSize();if(AB){var AA=S.copy(AB,{});if(x.scrollNode){AA.x-=x.scrollNode.scrollLeft;AA.y-=x.scrollNode.scrollTop;}if(!isNaN(l(AA,w).x)){v.addToSelectedCards(z);}}});this.prepareLMCSelectionData();this.endSelections();},handleRMCEvent:function H(w,v){this.noHighlightAfterKeepOnlyExcludeDrill=false;if(mstrApp.isInVFInteractMode){Q.stopPropogation(window,w);Q.preventDefault(window,w);return ;}w.preventDefault();w.cancel();this.clearMenuData();this.addCardToMenuData(v);if(v.selected){this.copySelectedCardsToMenuData();}this.prepareRMCSelectionData();this.showSelectionMenu(w.e);this.contextMenuDismiss=false;},addCardToMenuData:function M(v){if(v.useAsMenuData===false){v.useAsMenuData=true;this.contextMenuSelections.push(v);v.updateHighlight();}},copySelectedCardsToMenuData:function U(){var w,v,x=this.selectedCards,y=x&&x.length;if(!y){return ;}for(w=0;w<y;w+=1){v=x[w];this.addCardToMenuData(v);}},clearMenuData:function K(){var x,w,v=this.contextMenuSelections,y=v&&v.length;if(!y){return ;}for(x=0;x<y;x+=1){w=v[x];w.useAsMenuData=false;w.updateHighlight();}this.contextMenuSelections=[];},getCellForNode:function r(v){var w=v.dataModel,x=w.elemData;return{at:x.at,dei:x.dei,dpt:x.dpt,o:x.o,n:w.categoryName,tui:x.tui,ui:x.ui,axis:1,v:w.categoryElemName,tid:w.attr.id};},getCellUnitIndex:function m(v){return v.o;},getSelectionMenuConfig:function W(){var v=d.mergeHashes(P.call(this),T.call(this)),w=[{name:"filter"},{name:"editGroup"},{name:"editCalculation"},{name:"createDe"},{name:"showData"},{name:"renameDe"}];return d.mergeMenuConfigs(v,w);},showSelectionMenu:function a(w){var v;if(!d.isOnExpressMode()){v=this.getSelectionMenuConfig();if(v.hasMenuItems()){o.call(this,v,w);}}},configurePopup:function Y(v,w){v.hostId=this.id;v.hostElement=w;},getMenuHandler:function f(y){var AB=this,z=this._super(y),w;if(z!==mstrmojo.emptyFn){return z;}w={keepOnly:function x(){AB.updateAfterKeepOnly(true);AB.noHighlightAfterKeepOnlyExcludeDrill=true;},exclude:function AC(){AB.updateAfterKeepOnly(false);AB.noHighlightAfterKeepOnlyExcludeDrill=true;},drill:function AA(AD){d.doDrill(AB,AD.ctxt.drillUnit,J,AD.ctxt);AB.noHighlightAfterKeepOnlyExcludeDrill=true;},showData:function v(){AB.showData(AB.getContextMenuSelectedCardsInfo());}};if(w.hasOwnProperty(y)){return w[y];}return mstrmojo.emptyFn;},getActionInfo:function L(v){var x=[],w=v.dataModel;x.push({n:w.categoryName,tid:w.attrId,v:w.categoryElemName,eid:w.elemId});return x;},getContextMenuSelectedCardsInfo:function t(){var w=[],v=this;k.forEach(this.contextMenuSelections,function(x){w.push(v.getActionInfo(x));});return w;},getCardInfoByElementId:function G(w){var v={};if(this.layoutor){this.layoutor.forEachChild(function(y,x){if(y.dataModel&&y.dataModel.elemId===w){v={card:y,index:x};return false;}});}return v;},singleSelectMobile:function s(AG,AE,AD){var AF,z,AJ=this.layoutor,AC,v,AK,AH,AI=false,AB,AA,w=this.isInStackedMode();this.hideAllToolTip();if(w){AC=AJ.getCurrentSlickSlideIndex();AF=AJ.getChildByIndex(AC);}else{AF=this.getCardByAix(AG,AE);}v=AF&&AF.getSize();if(w){v.x=0;}if((AD===1||AD===2)&&v){AB=AG-v.x;AA=AE-v.y;AI=AF.mobileShowToolTip(AB,AA);}if(w){if(this.isStackedAutoPlay()){if(AD===0||(AD===1&&AI)||AD===2){this.layoutor.toggleSlick(false);}}}AK={type:AD,toolTipTriggered:AI};if(AF&&AD!==1&&!AI){z=AF.dataModel;if(z){AH={rowIndex:z.rowIdx,colIndex:z.colIdx,elemId:z.elemId,rectInfo:v};}}AK.selection=!!AH?AH:{};window.webkit.messageHandlers.cardMobileInteraction.postMessage(AK);},multiSelectMobile:function C(w,AE,AB,v,AA){var AD={x:w,y:AE,w:AB,h:v},z=this.mobileAreaSelect(AD),AC;this.hideAllToolTip();AC={type:AA,selections:z};window.webkit.messageHandlers.cardMobileInteraction.postMessage(AC);},getCardByAix:function N(v,AA){var z=null,w;this.layoutor.forEachChild(function(x){w=x.getSize();if(w&&p(w,v,AA)){z=x;return false;}});return z;},mobileAreaSelect:function c(y){var x=[],v,AA,w,z=this.layoutor;if(isNaN(y.x)||isNaN(y.y)||isNaN(y.w)||isNaN(y.h)){return x;}z.forEachChild(function(AB){AA=AB.getSize();if(AA){var AC=S.copy(AA,{});if(z.scrollNode){AC.x-=z.scrollNode.scrollLeft;AC.y-=z.scrollNode.scrollTop;}if(!isNaN(l(AC,y).x)){v=AB.dataModel;if(v){w={rowIndex:v.rowIdx,colIndex:v.colIdx,elemId:v.elemId,rectInfo:AA};}x.push(w);}}});return x;},mobileHideAllToolTip:function b(){this.hideAllToolTip();},hideAllToolTip:function n(){this.layoutor.forEachChild(function(v){v.mobileHideToolTip();});},slickPlayMobile:function X(v){if(this.isInStackedMode()){this.layoutor.toggleSlick(!v);}},initialHighlightMobile:function F(v,AC){var x=[],AF=this.layoutor,AD,AB,y,z=v.length,AG,w,AE,AA;for(AA=0;AA<z;AA+=1){AB=this.getCardInfoByElementId(v[AA]);AD=AB.card;if(AD){w=AD.getSize();if(this.isInStackedMode()){AF.manualSlickGoto(AB.index);AF.toggleSlick(false);w.x=0;}y=AD.dataModel;if(y){AE={rowIndex:y.rowIdx,colIndex:y.colIdx,elemId:y.elemId,rectInfo:w};}x.push(AE);}}AG={type:AC,selections:x};window.webkit.messageHandlers.cardMobileInteraction.postMessage(AG);},syncStackAutoPlayMobile:function B(z){var y=this.layoutor,AA,w,v;w=y.getChildByIndex(z);if(w){v=w.dataModel;if(v){AA=v.elemId;}}var x={type:9,elemId:AA,slideIndex:z};window.webkit.messageHandlers.cardMobileInteraction.postMessage(x);},swipeMobile:function q(v,z){var AC=this.layoutor,y,AA,x,AD,w,AB;if(this.isInStackedMode()){if(!v){AC.manualSlickPrev();}else{AC.manualSlickNext();}}y=AC.getCurrentSlickSlideIndex();AA=AC.getChildByIndex(y);if(AA){w=AA&&AA.getSize();if(this.isInStackedMode()){w.x=0;}x=AA.dataModel;if(x){AB={rowIndex:x.rowIdx,colIndex:x.colIdx,elemId:x.elemId,rectInfo:w};}}AD={type:z,selection:AB};window.webkit.messageHandlers.cardMobileInteraction.postMessage(AD);},updateTooltipPos:function g(v,w){this.tooltipPos.x=v;this.tooltipPos.y=w;},showTooltip:function u(x){var v=this.tooltipWin,w=v&&v.domNode;if(!w){return ;}if(!w.parentNode){document.body.appendChild(w);}v.toggle(true);if(S.equals(x,this.tooltipCont)){v.moveTo(this.tooltipPos.x,this.tooltipPos.y);}else{v.displayInfo(x,this.tooltipPos);this.tooltipCont=x;}},hideTooltip:function O(){if(this.tooltipWin){this.tooltipWin.toggle(false);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.tooltip","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.num","mstrmojo.kpicard.KPICardEnum","mstrmojo.array","mstrmojo.hash","mstrmojo.dom");var i=mstrmojo,N=mstrmojo.dom,j=mstrmojo.array,O=mstrmojo.hash,D=i.css,Z=i.VisUtility,J=11;var AG=i.kpicard.SINGLE_METRIC_DISPLAY_MODE,s=i.kpicard.BADGE_MODE,R=i.kpicard.KPI_PROPERTIES,k=mstrmojo.kpicard.DISPLAY_MODE,p=mstrmojo.kpicard.TEXT_SIZE_TYPE,g=mstrmojo.kpicard.CAN_SET_FONT_PARTS,a=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,H="vi_icons",l="1",U=["only-metric","metric-with-timeline","only-metric","metric-with-timeline"],AF=["click","contextmenu","mouseover","mouseout"],z=i.kpicard.SELECTION_BORDER_COLOR;function w(AH,AI){if(typeof AH.innerText!=="undefined"){AH.innerText=AI;}else{AH.textContent=AI;}}function r(AK,AH,AN){var AM=AK.x,AJ=AM+AK.w,AL=AK.y,AI=AL+AK.h;return AH<=AJ&&AH>=AM&&AN<=AI&&AN>=AL;}function F(AH){if(typeof AH.innerText!=="undefined"){return AH.innerText;}else{return AH.textContent;}}function x(AI,AJ){var AH;if(AI==="none"){return ;}if(AI.indexOf("px")>0){AH=parseFloat(AI);}else{AH=AJ*parseFloat(AI)/100;}return AH;}function C(AM,AI,AJ,AK){AM.style.width="";var AH=D.getComputedStyle(AM),AL=(AI==="width"||AI==="maxWidth")?parseFloat(AJ):parseFloat(AK);return x(AH[AI],AL-2);}function AD(AK,AI){var AH=D.getComputedStyle(AK),AJ={};AJ.fontFamily=AH.fontFamily;AJ.fontStyle=AH.fontStyle;AJ.fontSize=AI+"px";AJ.fontWeight=AH.fontWeight;AJ.lineHeight=1;AJ.bonus=parseInt(AH.paddingLeft)+parseInt(AH.paddingRight);return AJ;}function X(AL,AI){var AK=AL.innerText,AJ=AD(AL,AI),AH=Z.measureTextSize(AK+l,AJ,AJ.bonus);return AH;}function Q(AH,AI){if(AH.className.indexOf("only-metric")>-1){D.addClass(AI,"align-center");}}mstrmojo.kpicard.SingleKPICard=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.kpicard.SingleKPICard",cssClass:"single-kpicard-container",layoutConfig:{w:{containerNode:"100%",leftPadding:"0px",rightPadding:"0px"},xt:true},responsiveMode:AG.HORIZONTAL,dataModel:null,selected:false,useAsMenuData:false,onHover:false,colorThresholdIdx:null,borderColor:"",markupString:'<div class="{@cssClass}" style="{@cssText}" mstrAttach:'+AF.join(",")+'><div class="metric-name label"></div><div class="metric-value label">{@en@dataModel.metricValue}</div><div class="previous-metric label">{@en@dataModel.prevMetricInfo}</div><div class="compare-to-previous label"></div><div class="chart"></div><div class="selection-fill"><div class="hover-fill"></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},metricNameNode:function(){return this.domNode.childNodes[0];},metricValueNode:function(){return this.domNode.childNodes[1];},prevMetricNode:function(){return this.domNode.childNodes[2];},compareNode:function(){return this.domNode.childNodes[3];},chartNode:function(){return this.domNode.childNodes[4];},selectionFillNode:function(){return this.domNode.childNodes[5];},hoverFillNode:function(){return this.domNode.childNodes[5].firstChild;},tooltipNode:function(){return[];}},init:function AA(AH){this._super(AH);this.colorThresholdIdx=-1;this.selected=false;},preBuildRendering:function A(){var AH=this.cssText||"",AL=this.left,AK=this.top,AJ=this.cardMarginTop,AI=this.cardMarginLeft;if(AL){AH+="left:"+AL+";";}if(AK){AH+="top:"+AK+";";}if(AJ){AH+="margin-top:"+AJ+";";}if(AI){AH+="margin-left:"+AI+";";}this.cssText=AH;return(this._super)?this._super():true;},postBuildRendering:function T(){this._super();var AI=parseFloat(this.width);var AH=parseFloat(this.height);if(AI/AH<1){this.responsiveMode=AG.VERTICAL;D.toggleClass(this.containerNode,"vertical",true);D.toggleClass(this.containerNode,"horizontal",false);}else{this.responsiveMode=AG.HORIZONTAL;D.toggleClass(this.containerNode,"vertical",false);D.toggleClass(this.containerNode,"horizontal",true);}D.toggleClass(this.containerNode,U[this.dataModel.KPITemplateMode],true);this.updateStyle();this.applyDefaultFontColor();this.renderByFont();if(this.dataModel.prevMetricInfo){this.drawChart();}},applyDefaultFontColor:function B(){var AJ=this.getHost(),AI=[this.metricNameNode,this.metricValueNode,this.prevMetricNode],AH=AJ.getDefaultFontColor();j.forEach(AI,function(AK){AK.style.color=AH;});},getHost:function(){return O.walk("parent.parent",this);},updateStyle:function(){var AJ=this.getHost();var AK=AJ.getFormatPropertyValue(R.KPI_STYLE);var AM=AJ.getSpecificKPIStyle(AK);var AH=mstrmojo.color.hex2rgb(AM.bgColor);AH.push(AM.bgOpacity);this.containerNode.style.backgroundColor="rgba("+AH.join(",")+")";var AL=this.dataModel.chartOption;var AI=this.chartInstance;if(AL){AL.series[0].itemStyle=AJ.getItemStyle(this);}if(AI){AI.setOption(AL);}},updateNodeFontStyle:function d(AJ,AR){var AS=this.getHost();var AH=AS.getFormatPropertyValue(R.NEW_FONT);var AI=AS.getFormatPropertyValue(R.TEXT_SIZE_TYPE)===p.FIXED;var AQ=AH[AR];var AL=function(AT){AJ.style.fontFamily="'"+AT+"'";};var AN=function(AT){AJ.style.fontWeight=AT?"bold":"normal";};var AM=function(AT){AJ.style.fontStyle=AT?"italic":"normal";};var AP=function(AT,AU){var AV="";AV+=AT?"underline":"";AV+=AU?" line-through":"";AJ.style.textDecoration=AV;};var AK=function(AT){AJ.style.fontSize=AT;};var AO=function(AT){AJ.style.color=AT;};AL(AQ[a.FONT_FAMILY]);AN(AQ[a.FONT_WEIGHT]);AM(AQ[a.FONT_STYLE]);AP(AQ[a.UNDERLINE],AQ[a.LINE_THROUGH]);if(AI){AK(AQ[a.FONT_SIZE]);}AO(AQ[a.COLOR]);if(AR===g.PRIMARY_VALUE){AS.applyColorThresholds(this);}},renderByFont:function AB(AH){var AI=this.getHost();var AJ=AI.getFormatPropertyValue(R.SHOW_METRIC_NAME);var AK=AH===undefined;if(AK||AH.indexOf(g.LABEL)>-1){this.renderMetricName(AJ);}if(AK||AH.indexOf(g.PRIMARY_VALUE)>-1){this.renderMetricValue();}if(this.dataModel.prevMetricInfo){if(AK||AH.indexOf(g.PREVIOUS_VALUE)>-1){this.renderPrevMetricInfo();}if(AK||AH.indexOf(g.TREND_IDENTITY)>-1){this.renderCompareNode();}}},setTitleByWidth:function v(AK,AM,AJ,AL,AH){var AI=C(AK,"width",AJ,AL);if(AM>AI){AK.title=F(AK);if(AK===this.prevMetricNode){this.fitPrevStringToContainer(AH);}}},resetNodeTextSize:function f(AK,AM,AO,AN,AH){var AI,AP,AJ;if(AK===this.prevMetricNode){AJ=parseFloat(AK.style.fontSize)+AN;}else{AJ=parseFloat(AK.style.fontSize)+(AH==="plus"?1:(AH==="minus"?-1:AN));}var AQ=this.getHost();var AL=AQ.getFormatPropertyValue(R.DISPLAY_MODE)===k.STACKED;if(AM&&!AL){AJ=AO+AN;}AJ=Math.max(AJ,J);if(parseFloat(AK.style.fontSize)<AJ){AI=X(AK,AJ);this.setTitleByWidth(AK,AI.width,this.width,this.height,AJ);AK.style.width=AI.width+"px";AP=C(AK,"height",this.width,this.height);AK.style.lineHeight=AK.style.height=Math.ceil(AI.height)*1.5+"px";}AK.style.fontSize=AJ+"px";},unifyBadgeTextSize:function I(AN,AO,AH){var AP=this.getHost(),AK=this.compareNode,AI,AM=AD(AK,parseFloat(AK.style.fontSize)),AJ=parseFloat(AK.style.fontSize)+(AH==="plus"?1:(AH==="minus"?-1:AO));var AL=AP.getFormatPropertyValue(R.DISPLAY_MODE)===k.STACKED;if(AN&&!AL){AJ=AP.unifyBadgeSize+AO;}AJ=Math.max(AJ,J);if(AM.fontFamily===H){AK.style.fontSize=AJ+"px";AK.style.width=AJ+8+"px";}else{AI=X(AK,AJ);AK.style.fontSize=AJ+"px";this.setTitleByWidth(AK,AI.width,this.width,this.height);AK.style.width=AI.width+"px";}this.setCompareNodeHeight();},applyUnifySteps:function W(AH,AP){var AM=this;var AQ=this.getHost();var AN=this.dataModel;var AO=AN.badgeMode;var AI=AQ.getFormatPropertyValue(R.NEW_FONT);var AJ=AQ.getFormatPropertyValue(R.TEXT_SIZE_TYPE);if(AJ===p.FIXED){return ;}var AL=AJ===p.UNIFIED;var AK={};if(AP){j.forEach(AP,function(AR){AK[AR]=AI[AR];});}else{AK=AI;}O.forEach(AK,function(AT,AR){var AS=Number(AT[R.UNIFY_STEPS]);if(AR===g.LABEL){AM.resetNodeTextSize(AM.metricNameNode,AL,AQ.unifyMetricNameSize,AS,AH);}if(AR===g.PRIMARY_VALUE){AM.resetNodeTextSize(AM.metricValueNode,AL,AQ.unifyMetricValueSize,AS,AH);}if(AQ.unifyPrevMetricSize){if(AR===g.PREVIOUS_VALUE){AM.resetNodeTextSize(AM.prevMetricNode,AL,AQ.unifyPrevMetricSize,AS,AH);}if(AR===g.TREND_IDENTITY&&AO!==s.NONE){AM.unifyBadgeTextSize(AL,AS,AH);}}});},setCompareNodeHeight:function e(){var AJ=this.compareNode,AI=this.dataModel.compareToPrevString,AH=AD(AJ,parseFloat(AJ.style.fontSize)),AK=Z.measureTextHeight(AI,AH);if(AH.fontFamily===H){AJ.style.height=AJ.style.width;AJ.style.lineHeight=AJ.style.fontSize;}else{AJ.style.height=(AK+8)+"px";AJ.style.lineHeight=AK+"px";}},renderCompareNode:function t(){var AJ=this.compareNode;var AH=this.dataModel;var AI=AH.badgeMode;if(AI===s.NONE){AJ.style.display="none";}else{AJ.style.display="block";this.applyCmpNodeBgClr();this.updateNodeFontStyle(AJ,g.TREND_IDENTITY);if(AI===s.PERCENTAGE&&AH.prevMetricRawValue===0&&AH.metricRawValue!==0){AJ.style.fontFamily="vi_icons";}w(AJ,AH.compareToPrevString);this.fitTextToContainer(AJ);this.setCompareNodeHeight();}},applyCmpNodeBgClr:function V(){this.compareNode.style.backgroundColor=this.dataModel.cmpBgClr;},renderMetricValue:function K(){this.updateNodeFontStyle(this.metricValueNode,g.PRIMARY_VALUE);this.fitTextToContainer(this.metricValueNode);Q(this.containerNode,this.metricValueNode);},renderMetricName:function Y(AH){var AI=this.metricNameNode,AJ;if(this.dataModel.categoryElemName){AJ=this.dataModel.categoryElemName;if(AH==="true"){AJ=this.dataModel.metricName+" - "+AJ;}}else{AJ=this.dataModel.metricName;}this.updateNodeFontStyle(AI,g.LABEL);w(AI,AJ);this.fitTextToContainer(AI);Q(this.containerNode,this.metricNameNode);},renderPrevMetricInfo:function E(){if(this.dataModel.prevMetricFmtValue){var AI=this.getHost();this.dataModel.prevMetricInfo=AI.getPrevMetricInfoString(this.dataModel.prevMetricFmtValue);}var AH=this.prevMetricNode;this.updateNodeFontStyle(AH,g.PREVIOUS_VALUE);w(AH,this.dataModel.prevMetricInfo);this.fitTextToContainer(AH);},drawChart:function AC(){this.chartNode.style.width=C(this.chartNode,"width",this.width,this.height)+"px";this.chartNode.style.height=C(this.chartNode,"height",this.width,this.height)+"px";var AI=this.getHost(),AH=window.echarts.init(this.chartNode);AH.setOption(this.dataModel.chartOption);AH.on("globalout",function(){AI.hideTooltip();});this.chartInstance=AH;},fitPrevStringToContainer:function u(AP){var AH=this.prevMetricNode,AN=C(AH,"width",this.width,this.height),AJ=AD(AH,AP),AL=this.parent.parent.getFormatPropertyValue(R.PREVIOUS_METRIC_NAME),AO="...: "+this.dataModel.prevMetricFmtValue,AM,AI;AH.style.fontSize=AP+"px";if(AL===""){AH.innerText=this.dataModel.prevMetricFmtValue;}else{AI=AL[0]+AO;AM=Z.measureTextWidth(AI+l,AJ,AJ.bonus);if(AM>=AN){AH.innerText=this.dataModel.prevMetricFmtValue;}else{for(var AK=2;AK<AL.length;AK++){AI=AL.substring(0,AK)+AO;AM=Z.measureTextWidth(AI+l,AJ,AJ.bonus);if(AM>=AN){AI=AL.substring(0,AK-1)+AO;break;}}AH.innerText=AI;}}AH.title=this.dataModel.prevMetricInfo;},fitTextToContainer:function P(AH){var AQ=J,AM,AR,AO=AH.innerText,AI,AK,AN;AK=this.getHost().getFormatPropertyValue(R.TEXT_SIZE_TYPE)===p.FIXED;if(AK){AQ=parseInt(AH.style.fontSize);}AH.style.width="";AH.style.height="";AH.style.lineHeight="";AH.style.fontSize="";AH.style.left="";AH.style.transform="";AH.title="";AM=C(AH,"width",this.width,this.height);AR=C(AH,"height",this.width,this.height);AI=X(AH,AQ);if(AO&&AO!==""){if(AH===this.prevMetricNode&&(AI.width>AM)){this.fitPrevStringToContainer(AQ);}else{if(!AK){var AJ=1,AL=AQ,AP;while(AI.width<AM&&AI.height<AR){AL=AQ;AQ=J+Math.pow(2,AJ++);AI=X(AH,AQ);}while(AL<AQ){AP=Math.floor((AL+AQ)/2);AI=X(AH,AP);if(AI.width<AM&&AI.height<AR){AL=AP+1;}else{AQ=AP-1;}}AQ=Math.max(AL-1,J);}AH.style.fontSize=AQ+"px";if(AH.style.fontFamily===H){AH.style.width=AQ+8+"px";}else{AI=X(AH,AQ);if(AI.width>AM){AN=C(AH,"maxWidth",this.width,this.height);if(AI.width<=AN){AH.style.width=AI.width+"px";}else{AH.style.width=AN+"px";AH.title=AO;}}else{AH.style.width=AI.width+"px";}}}}AH.style.lineHeight=AH.style.height=Math.ceil(AI.height)*1.5+"px";},applyColorThreshold:function c(AP,AK){var AL=this.colorThresholdIdx,AN=this.dataModel,AM=AN&&AN.metricRawValue,AO=AK.max,AJ=AK.min,AI=AK.color,AH=false;if(AL!==-1||isNaN(AM)){return ;}if(!isNaN(AO)&&!isNaN(AJ)){AH=AM>=AJ&&AM<=AO;}else{if(!isNaN(AO)){AH=AM<=AO;}else{if(!isNaN(AJ)){AH=AM>=AJ;}else{AH=true;}}}if(AH){this.colorThresholdIdx=AP;this.metricValueNode.style.color=AI;}},clearColorThreshold:function S(){var AI=this.getHost(),AH=AI.getDefaultPrimaryValueColor();this.colorThresholdIdx=-1;this.metricValueNode.style.color=AH;},onclick:function o(AH){var AI=i.all[this.widgetId];if(AI){AI.clickFromSingleKPICard=true;AI.handleLMCSelection(AH,this);}},getSize:function n(){var AH=this.containerNode;if(!AH){return null;}return{x:AH.offsetLeft,y:AH.offsetTop,w:AH.offsetWidth,h:AH.offsetHeight};},oncontextmenu:function m(AH){var AI=i.all[this.widgetId];if(AI){AI.handleRMCEvent(AH,this);}},updateHighlight:function b(){D.toggleClass(this.containerNode,"right-selected",false);D.toggleClass(this.selectionFillNode,"active",this.selected);if(this.useAsMenuData){D.toggleClass(this.containerNode,"right-selected",true);this.applyBorderColorToCard(z);}else{if(this.selected){this.applyBorderColorToCard(z);}else{this.applyBorderColorToCard(this.borderColor);}}},onmouseover:function L(){var AI=i.all[this.widgetId],AH=this.onHover;this.onHover=!!AI&&!AI.onLassoSelection;if(AH!==this.onHover){D.toggleClass(this.hoverFillNode,"active",this.onHover);}},onmouseout:function y(AH){var AJ=this.onHover,AI=this.getHost(),AK=AI.getFormatPropertyValue(R.AUTO_PLAY);this.onHover=false;if(AJ!==this.onHover){D.toggleClass(this.hoverFillNode,"active",this.onHover);}if(!AK){N.stopPropogation(AH.hWin,AH.e);}},mobileHideToolTip:function M(){var AH=this.chartInstance,AI=this.getHost();if(AH){AH.dispatchAction({type:"showTip",x:-100,y:-100});AI.hideTooltip();}},mobileShowToolTip:function AE(AH,AN){var AK=this.chartInstance,AL=this.getHost(),AJ=this.getChartSize(),AM=r(AJ,AH,AN),AI=N.position(this.domNode);if(AK&&AM){AL.updateTooltipPos(AH+AI.x,AN+AI.y);AK.dispatchAction({type:"showTip",x:AH-AJ.x,y:AN-AJ.y});return true;}return false;},getChartSize:function q(){var AH=this.chartNode;if(!AH){return null;}return{x:AH.offsetLeft,y:AH.offsetTop,w:AH.offsetWidth,h:AH.offsetHeight};},updateBorderColor:function G(AH){this.borderColor=AH;if(!this.selected&&!this.useAsMenuData){this.applyBorderColorToCard(this.borderColor);}},applyBorderColorToCard:function h(AJ){var AH=this.containerNode,AI=AH&&AH.style;if(!AI){return ;}AI.borderColor=AJ;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.num","mstrmojo.array","mstrmojo.string","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum");var M=mstrmojo.array,S=mstrmojo.num,R=mstrmojo.VisUtility,X=mstrmojo.kpicard.BADGE_MODE,J=mstrmojo.kpicard.KPI_PROPERTIES,L=mstrmojo.kpicard.KPI_STYLES,N=mstrmojo.kpicard.KPI_TEMPLATE_MODE,I=mstrmojo.VisEnum.SERVER_JSON_ERROR_TYPE,G=["at","dei","dpt","o","tui","ui"];function E(Y){var Z=Infinity;Y.forEach(function(a){if(Z>a){Z=a;}});return Z;}mstrmojo.kpicard._KPICardDataModel=mstrmojo.provide("mstrmojo.kpicard._KPICardDataModel",{_mixinName:"mstrmojo.kpicard._KPICardDataModel",getUnitsByDropZoneID:function H(b){var a=this.model&&this.model.data,Y=a&&a.dz,Z=Y&&Y[b];if(Z){if(Z.TemplateMetric){return Z.TemplateMetric;}else{if(Z.TemplateUnit){return Z.TemplateUnit;}}}return[];},checkData:function F(){var Y=this.getUnitsByDropZoneID("metric");if(Y.length<1){this.setError(undefined,I.NO_TEMPLATE_UNIT);}},getAttrID:function A(d){var c=this.model&&this.model.data,Y=c&&c.dz,Z=Y&&Y[d],a=Z&&Z.TemplateUnit,b=a&&a[0];return b&&b.id;},getAttrIdx:function B(b,a){var Z=this.getAttrID(a),Y=-1;M.forEach(b,function(d,c){if(d.id&&d.id.indexOf(Z)!==-1){Y=c;return false;}});return Y;},getTrendAttributeName:function U(){var Z=this.model&&this.model.data,Y=Z&&Z.gts,a=Y&&Y.row,b=this.getAttrIdx(a,"trend");return b>-1?a[b].n:"";},getTimeAttrElemIdx:function T(Z,a){var Y=M.find(Z,"tui",a);if(Y>=0){return Z[Y].idx;}return -1;},createModelForSingleKPI:function C(){var AK=this.model,AQ=AK&&AK.data,AD=AQ&&R.getNumberFormat(AQ,0),Y=AQ&&AQ.gts,o=AQ&&AQ.gvs&&AQ.gvs.items,d=Y&&Y.col,n=Y&&Y.row,AO=AQ&&AQ.ghs,y=AO&&AO.rhs.items,r=(y&&y.length)||(o&&o.length),AE=d&&d[0],q=AE&&AE.es,Z=0,AB=q[Z],v=this.getAttrIdx(n,"trend"),AJ=this.getAttrIdx(n,"BreakBy"),f=v>-1,AF=AJ>-1,w=f&&n[v].es,c=AF&&n[AJ],e=f&&n[v],t=e.n||"",g=c.n||"",b=c.id||null,AG=AF&&n[AJ].es,j=[],AC,AP=-1,k=-1,z=null,h=null,u=G.length,p=this,AN,AL,AI,AH,s,x,a,AM=function(){var AR=y&&y[AN],m=AR&&AR.items,i=(m&&m.length)||0;for(AL=0;AL<i;AL++){if(m[AL].stt===1){return true;}}return false;},l=function(){if(AF){z=y[AN].items[AJ];AP=z.idx;if(AP!==k){k=AP;h={};for(AL=0;AL<u;AL++){AI=G[AL];h[AI]=z[AI];}return true;}else{return false;}}else{if(!AC){return true;}else{return false;}}},AA=function(){if(AC){AC.chartData=s;AC.chartFormatData=x;AC.trendName=t;AC.xAxisData=a;AC.nfs=AD;p.populateSingleKPIAttributes(AC);j.push(AC);}};this.isPercentNumberStyle=undefined;this.KPITemplateMode=(f?1:0)+(AF?2:0);for(AN=0;AN<r;AN++){if(!AM()){if(l()){AA();AC={};AC.metricName=AB.n;AC.KPITemplateMode=this.KPITemplateMode;AC.kpiModels=j;AC.elemId="";AC.rowIdx=-1;AC.colIdx=-1;if(AF){AC.attr=c;AC.categoryName=g;AC.attrId=b;AC.elemData=h;AC.categoryElemName=AG[AP].n;AC.elemId=AG[AP].id;AC.rowIdx=AJ;AC.colIdx=AN;}s=[];a=[];x=[];}if(f){AH=this.getTimeAttrElemIdx(y[AN].items,v);if(AH>=0){a.push(w[AH].n);}}s.push(parseFloat(o[AN].items[Z].rv));x.push(o[AN].items[Z].v);}}AA();this.singleKPIModels=j;this.breakByAttrSupportsViewFilter=AK.supportsViewFilterActions(c.id);},hasTimeLine:function O(){return this.KPITemplateMode===N.METRIC_WITH_TREND||this.KPITemplateMode===N.METRIC_WITH_TREND_AND_BREAKBY;},hasCategoryAttr:function W(){return this.KPITemplateMode===N.METRIC_WITH_BREAKBY||this.KPITemplateMode===N.METRIC_WITH_TREND_AND_BREAKBY;},populateSingleKPIAttributes:function Q(Z){var b=Z.chartData,a=Z.chartFormatData,c=b.length,Y=c-1;while(Y>0&&isNaN(b[Y])){Y--;}if(Y>=0){Z.metricValue=a[Y];Z.metricRawValue=b[Y];}if(this.isPercentNumberStyle===undefined){this.getNumberStyle(Z);}if(b.length>1&&Y>=1&&this.hasTimeLine()){Z.dataMin=E(b);Z.prevMetricRawValue=b[Y-1];Z.prevMetricFmtValue=a[Y-1];Z.prevMetricInfo=this.getPrevMetricInfoString(Z.prevMetricFmtValue);this.generateCmpString(Z,this.getFormatPropertyValue(J.BADGE_MODE));this.populateChartOption(Z);}if(this.hasCategoryAttr()){Z.metricNameHTML=Z.categoryElemName;}else{Z.metricNameHTML=Z.metricName;}},populateChartOption:function K(Y){var a=this,Z={title:{show:false,padding:0},tooltip:{show:true,trigger:"axis",axisPointer:{type:"line",lineStyle:{width:0}},formatter:function(b){a.showTooltip([{n:Y.trendName,v:b[0].name},{n:Y.metricName,v:Y.chartFormatData[b[0].dataIndex]}]);}},xAxis:{show:false,boundaryGap:false,data:Y.xAxisData},yAxis:{show:false,boundaryGap:false,min:Math.min(0,Y.dataMin),max:"dataMax"},series:[{type:"line",smooth:true,symbol:"circle",showSymbol:false,data:Y.chartData}],grid:{x:0,y:5,x2:0,y2:0,borderWidth:0}};Z.series[0].itemStyle=this.getItemStyle(Y);Y.chartOption=Z;},getItemStyle:function P(Z){var b=this.getFormatPropertyValue(J.KPI_STYLE);var Y=this.getSpecificKPIStyle(b)||{};var a={normal:{color:Z.cmpBgClr,areaStyle:{color:Y.chartColor,opacity:Y.chartOpacity,}}};if(b===L.LIGHT){a.normal.lineStyle={color:"#D2D2D2",width:1};}else{a.normal.lineStyle={color:Y.chartColor,width:1};}return a;},getNumberStyle:function V(Y){var a=false,Z;if(Y.metricValue){Z=Y.metricValue;a=Z.indexOf("%")>0||Z.indexOf("‰")>0;}this.isPercentNumberStyle=a;},generateCmpString:function D(Y,Z){Y.badgeMode=Z;if(Y.metricRawValue!==undefined&&Y.prevMetricRawValue!==undefined){if(Z===X.PERCENTAGE){if(Y.prevMetricRawValue===0){if(Y.metricRawValue===0){Y.compareToPrev=0;Y.compareToPrevString=Number(0).toFixed(1)+"%";}else{Y.compareToPrev=(Y.metricRawValue-Y.prevMetricRawValue)>=0?Infinity:-Infinity;Y.compareToPrevString=Y.compareToPrev>0?"\ue80e":"\ue80d";}}else{Y.compareToPrev=(Y.metricRawValue-Y.prevMetricRawValue)/Math.abs(Y.prevMetricRawValue);if(Y.compareToPrev===0){Y.compareToPrevString=Number(0).toFixed(1)+"%";}else{Y.compareToPrevString=(Y.compareToPrev>0?"+ ":"- ")+Number(Math.abs(Y.compareToPrev*100)).toFixed(1)+"%";}}}else{if(Z===X.VALUE){Y.compareToPrev=Y.metricRawValue-Y.prevMetricRawValue;Y.compareToPrevString=(Y.compareToPrev>0?"+":"")+S.formatByMask(Y.nfs,Y.compareToPrev);if(this.isPercentNumberStyle){Y.compareToPrevString=Y.compareToPrevString.replace("%","");Y.compareToPrevString+=mstrmojo.desc(15954,"pp");}}}if(Z!==X.NONE){if(Y.compareToPrev>=0){Y.cmpBgClr=this.getFormatPropertyValue(J.INCREASE_BG_COLOR);}else{Y.cmpBgClr=this.getFormatPropertyValue(J.DECREASE_BG_COLOR);}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.kpicard.SingleKPICard");var C=mstrmojo.hash,H=mstrmojo.array,E=mstrmojo.kpicard.SingleKPICard;mstrmojo.kpicard.layout._LayoutCommon=mstrmojo.provide("mstrmojo.kpicard.layout._LayoutCommon",{_mixinName:"mstrmojo.kpicard.layout._LayoutCommon",init:function I(L){this._super(L);},render:function A(){this.cssText="";this._super();},updateSingleKPIProps:function G(N){var M=this.width,L=this.height;N.width=parseInt(M)+"px";N.height=parseInt(L)+"px";},createSingleKPIs:function J(){var M=this.singleKPIModels,Q=M.length,L=this.containerNode,S,N=[],R,O,P=this;M.forEach(function(U,T){S=document.createElement("div");L.appendChild(S);O={placeholder:S,parent:P,widgetId:P.widgetId,dataModel:U};P.updateSingleKPIProps(O,Q,T);R=new E(O);R.render();N.push(R);});this.children=N;},forEachChild:function K(L){H.forEach(this.children,function(N,M){if(N){return L(N,M);}});},getChildByIndex:function D(L){return this.children&&this.children[L];},findCardElemIdByIdx:function F(M){var N,L;N=this.getChildByIndex(M);L=N&&N.dataModel;return L&&L.elemId;},findCardIdxByElemId:function B(Q){var O=0,L=this.children,P,M,N;if(!Q||!L){return O;}M=(L&&L.length)||0;for(O=0;O<M;O+=1){P=L[O];N=P&&P.dataModel;if(N&&N.elemId===Q){break;}}return O<M?O:0;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.kpicard.layout._LayoutCommon");mstrmojo.kpicard.layout.HorizontalLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.kpicard.layout._LayoutCommon],{scriptClass:"mstrmojo.kpicard.layout.HorizontalLayout",cssClass:"horizontal-kpi-container",layoutConfig:{w:{containerNode:"100%"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;}},postBuildRendering:function A(){this._super();this.domNode.style.display="";this.createSingleKPIs();},updateSingleKPIProps:function B(F,H,G){var E=Math.floor(parseFloat(this.width)/H),C=parseFloat(this.height),D=parseFloat(this.width)-E*H;F.width=((D>G?1:0)+E)+"px";F.height=C+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.kpicard.layout._LayoutCommon");mstrmojo.kpicard.layout.VerticalLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.kpicard.layout._LayoutCommon],{scriptClass:"mstrmojo.kpicard.layout.VerticalLayout",cssClass:"vertical-kpi-container",layoutConfig:{w:{containerNode:"100%"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;}},postBuildRendering:function A(){this._super();this.domNode.style.display="";this.createSingleKPIs();},updateSingleKPIProps:function B(F,H,G){var E=parseFloat(this.width),C=Math.floor(parseFloat(this.height)/H),D=parseFloat(this.height)-C*H;F.width=E+"px";F.height=((D>G?1:0)+C)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.kpicard.layout._LayoutCommon","mstrmojo.kpicard.KPICardEnum","mstrmojo.ui._HasScroller","mstrmojo.util.ui._LassoSelector","mstrmojo.VisEnum");var A=mstrmojo.kpicard.KPI_PROPERTIES,I=mstrmojo.VisEnum.ControlType,F=90,E=mstrmojo.kpicard.NEW_STYLE_MARGIN;mstrmojo.kpicard.layout.GridLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.kpicard.layout._LayoutCommon,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.kpicard.layout.GridLayout",cssClass:"horizontal-kpi-container",layoutConfig:{w:{containerNode:"100%"},xt:true},init:function K(M){this._super(M);var L=Math.floor(parseFloat(this.height));this.scCssText=(this.scCssText||"")+";max-height:"+L+"px";},markupString:'<div class="{@cssClass}" style="{@cssText}" ><div class="scroll-container" style="{@scCssText}"><div class="me-content"></div></div></div>',markupSlots:{containerNode:function D(){return this.domNode.firstChild.firstChild;},scrollNode:function(){return this.domNode.firstChild;},scrollbarHostNode:function(){return this.domNode;}},updateScrollbars:function H(){this._super();if(this.scrollNode&&this.scrollBarNodes){var M=this.scrollBarNodes.v,L=this.scrollBarNodes.h;if(M){M.setAttribute("type",I.KPI_V_SCROLLBAR);}if(L){L.setAttribute("type",I.KPI_H_SCROLLBAR);}}},postBuildRendering:function B(){this._super();this.domNode.style.display="";this.createSingleKPIs();},render:function C(){this._super();this.updateScrollbars();},updateSingleKPIProps:function G(S,Q,R){var P=this.parent.getFormatPropertyValue(A.GRID_COLUMN_COUNT);P=P>Q?Q:P;var L=this.parent.getFormatPropertyValue(A.FIX_CARD_HEIGHT),T=this.parent.getFormatPropertyValue(A.CARD_HEIGHT),Y=parseFloat(this.width),X=parseFloat(this.height),M=Math.ceil(Q/P),U=(P-1)*E,O=(M-1)*E,N=Math.floor((Y-U)/P),W=Math.floor((X-O)/M),Z=Y-U-N*P,V=X-O-W*M;S.width=((Z>(R%P)?1:0)+N)+"px";if(L){S.height=T+"px";}else{W=((V>Math.floor(parseFloat(R)/P)?1:0)+W);if(W<F){W=F;}S.height=W+"px";}this.updateSingleKPINewStyleProps(S,R,P,E);},updateSingleKPINewStyleProps:function J(N,P,Q,O){var L=parseInt(P%Q,10),M=parseInt(P/Q,10);if(L>0){N.cardMarginLeft=O+"px";}if(M>0){N.cardMarginTop=O+"px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.kpicard.layout._LayoutCommon","mstrmojo.kpicard.KPICardEnum");var L=mstrmojo.kpicard.KPI_PROPERTIES,a=mstrmojo.css,G=mstrmojo.dom,M=mstrmojo.array,N="_stacked-ctrl-bar_id",C="small",E="middle",c="large",R=30;function D(e,g){var d=e.parent,f;if(!d||d.isStackedAutoPlay()){return ;}if(e.urFlag){e.urFlag=false;return ;}f=e.findCardElemIdByIdx(g);if(!f){return ;}d.writeProperties(L.CURRENT_SLIDE_ELEMENT,f);}function I(e,f){var d=e.parent;if(!d||!d.isInStackedMode()){return ;}d.syncStackAutoPlayMobile(f);}function U(e,g,d){var f;if(g<150||d<100){f=C;}else{if(g>300&&d>300){f=c;}else{f=E;}}a.removeClass(e,[C,E,c]);a.addClass(e,f);return f;}function B(d){return d.innerText!==undefined?"innerText":"textContent";}function H(d){return(d>=48&&d<=57)||(d>=96&&d<=105)||d===8||d===46||d===37||d===39;}mstrmojo.kpicard.layout.StackedLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.kpicard.layout._LayoutCommon],{scriptClass:"mstrmojo.kpicard.layout.StackedLayout",cssClass:"stacked-kpi-container",enableAutoPlay:true,autoPlayInterval:3000,inSlideEditingMode:false,layoutConfig:{w:{containerNode:"100%"},xt:true},markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;}},urFlag:false,getSlickNodePath:function V(){return'div[id="'+this.parent.id+'"] .stacked-kpi-container';},postBuildRendering:function Z(){var i=this,g=parseInt(this.width),d=parseInt(this.height),f=0,h,e,j;this._super();this.createSingleKPIs();h=this.singleKPIModels.length;if(h>1&&jQuery){if(!this.enableAutoPlay){f=this.findCardIdxByElemId(this.initialElemId);}e={autoplay:this.enableAutoPlay,autoplaySpeed:this.autoPlayInterval,draggable:false,initialSlide:f};j=Math.floor(g/R)>=h;if(mstrApp.isDisplayOnMobile===true){e.arrows=false;e.dots=false;}else{if(j){e.arrows=false;e.dots=true;}else{this.createCtrlBar(f,h,g,d);e.prevArrow=this.ctrlBar.firstChild;e.nextArrow=this.ctrlBar.lastChild;}}jQuery(this.getSlickNodePath()).slick(e);if(!mstrApp.isDisplayOnMobile){jQuery(this.getSlickNodePath()).on("afterChange",function(l,k,m){D(i,m);if(!j){i.updateCtrlBar(m);}});}else{jQuery(this.getSlickNodePath()).on("beforeChange",function(l,k,n,m){I(i,m);});}}},createCtrlBar:function K(i,d,f,m){var h=this.domNode,k=this.parent.id,g=h&&h.parentNode,j=k+N,l=document.getElementById(j),e;if(!l){l=document.createElement("div");l.setAttribute("id",j);a.addClass(l,"stacked-ctrl-bar");e='<div class="prev-button"></div><div class="text currIndex" contenteditable="true">'+i+'</div><div class="text divider">/</div><div class="text totalPages">'+d+'</div><div class="next-button"></div>';l.innerHTML=e;if(g){g.appendChild(l);}}this.layoutStyle=U(l,f,m);this.ctrlBar=l;this.currIdxNode=l.childNodes[1];this.attachEvent4CtrlBar();this.updateCtrlBar(i);},attachEvent4CtrlBar:function P(){var d=this.id,e=this.currIdxNode;M.forEach(["click","blur","keydown","keyup"],function(f){G.attachMarkupEvent(d,e,f);});},onclick:function(d){var f=d.getTarget(),e=this.currIdxNode;if(f===e){f.focus();this.inSlideEditingMode=true;}},onblur:function F(){this.submitSlickIndexChange();},onkeydown:function W(f){var d=f.hWin,i=f.e||d.event,h=i.keyCode,g=i.shiftKey;if(g||!H(h)){f.preventDefault();}},onkeyup:function W(f){var d=f.hWin,i=f.e||d.event,h=i.keyCode,g=this.currIdxNode;this.adjustSlickIndex();if(h===13){g.blur();}},clearBlurTimer:function b(){if(this.triggerBlurTimer){clearTimeout(this.triggerBlurTimer);this.triggerBlurTimer=null;}},adjustSlickIndex:function J(){var e=this.currIdxNode,f=e[B(e)]+"",g,d;g=this.singleKPIModels.length;d=(g+"").length;if(f.length>d){e[B(e)]=parseInt(f.substring(0,d));}},submitSlickIndexChange:function A(){if(!this.inSlideEditingMode){return ;}this.inSlideEditingMode=false;var d=this.currIdxNode,e=d[B(d)],f=this.singleKPIModels.length;if(e>=1&&e<=f){this.manualSlickGoto(e-1);}else{d[B(d)]=this.getCurrentSlickSlideIndex()+1;}},updateCtrlBar:function T(g){if(!this.ctrlBar||this.inSlideEditingMode){return ;}var d=this.ctrlBar,e=this.currIdxNode,f;if(e&&this.layoutStyle!==C){e[B(e)]=g+1;}f=d.offsetWidth||120;d.style.left=(parseInt(this.width)-f)/2+"px";},toggleSlick:function X(d){if(this.singleKPIModels.length>1&&jQuery){jQuery(this.getSlickNodePath()).slick(d?"slickPlay":"slickPause");}},manualSlickNext:function Q(){jQuery(this.getSlickNodePath()).slick("slickNext");},manualSlickPrev:function O(){jQuery(this.getSlickNodePath()).slick("slickPrev");},manualSlickGoto:function Y(e,d){jQuery(this.getSlickNodePath()).slick("slickGoTo",e,!!d);},getCurrentSlickSlideIndex:function S(){return jQuery(this.getSlickNodePath()).slick("slickCurrentSlide");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.array","mstrmojo.hash","mstrmojo.kpicard.layout._LayoutCommon","mstrmojo.kpicard.KPICardEnum");var I=mstrmojo.array,K=mstrmojo.hash,D=mstrmojo.kpicard.NEW_STYLE_MARGIN;function O(){return 1;}function G(T){var S={};S.x=T.x;S.y=T.y;S.w=T.w;S.h=T.h;return S;}function E(U){var V=0,S=1,T;switch(S){case 1:T={v:D,h:D};break;case 2:switch(V){case 0:T={v:1,h:3};break;default:T={v:1,h:1};}break;case 3:switch(V){case 0:T={v:1,h:6};break;case 1:T={v:1,h:3};break;default:T={v:1,h:1};}break;default:switch(V){case 0:T={v:1,h:8};break;case 1:T={v:1,h:4};break;case 2:T={v:1,h:2};break;default:T={v:1,h:1};}}return T;}function H(S){return S.w>0&&S.h>0;}function M(S){var T=G(S);if(!H(S)){T.w=0;T.h=0;}return T;}function J(S){var T=S.x;S.x=S.y;S.y=T;T=S.w;S.w=S.h;S.h=T;return S;}function C(V,T){var S=Math.max(V.x,T.x);var X=Math.max(V.y,T.y);var U=Math.min(V.x+V.w,T.x+T.w)-S;var W=Math.min(V.y+V.h,T.y+T.h)-X;if(U<0||W<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:S,y:X,w:U,h:W};}function F(U,T){var S=M(T);U.size=S;delete U.headerSize;delete U.contentSize;}function L(p,AG,u,V,AI){var v,q,g=p.r||[],z=g.length,f,AC,s,AH=false;if(z===0){return ;}if(u<AG.h){f=u;AC=AG.h;s=AG;}else{f=AG.h;AC=u;s=G(AG);J(s);AH=true;}var b=s.x,a=s.y,S={x:b,y:a,w:f,h:AC};var t=E.call(this,g[0]),AB,U=this;var X={v:t.v,h:t.h};if((AI===true&&AH!==true)||(AI===false&&AH===true)){X={v:t.h,h:t.v};}var AD=function AD(h,e){var j=O(h,U),i=O(e,U),c;if(isNaN(j)){if(isNaN(i)){c=0;}else{c=1;}}else{if(isNaN(i)){c=-1;}else{c=j<i?1:-1;}}return c;};var k=function(n,r,j){if(m){return 1;}var l=O(n,r),h=AC*l/V;var c=(V<=0||n.deleted)?0:Math.ceil(h);if(c>0){AE+=c-h;}if(l<V){if(j===0&&z>1){if(Y>1){if(c>(Y>>1)){c-=(Y>>1);}}else{if(c>1){c--;}}if(c+(z-1)*(Y+1)>=AC){c=AC-(z-1)*(Y+1);m=true;}}else{if(j<z-1){if(Y>1){if(c>(Y>>1)){c-=Y;}else{c=1;}}else{if(c>1){c--;}}if(AE>1&&c>1){c--;AE-=1;}}else{c=Math.max(AC+s.y-a,1);}}}return c;};var d=0,AF,AA,Y=X.v,W=Math.max(1,Math.floor((AC+Y)/(1+Y)));if(z>W){for(AB=0;AB<z;AB++){AF=g[AB];if(AF.deleted){continue;}d++;}}for(AA=z-1,AB=d-W;AB>0;AA--){AF=g[AA];if(!AF.deleted){V-=O(AF,this);AB--;}}var AE=0,m=false;for(AA=0,AB=0,d=g.length,z=Math.min(z,W);AB<d;AA++){var T,o;AF=g[AA];if(AF.deleted){continue;}if(AB>=z){q=0;}else{q=k(AF,this,AB);}AB++;v=f;var Z={x:b,y:a,w:v,h:q};T=C(Z,S);if((AI===true&&AH!==true)||(AI===false&&AH===true)){J(T);}F.call(this,AF,T);a+=q+Y;}}function Q(b,u,s){var U=0,S=b.r,h=S.length;if(h===0){return ;}var j,f=S[0].kpiModels,Z=f,W=Z.length;var k,n,Y;for(k=0;k<h;k++){n=S[k];Y=O(n,this);if(!n.deleted&&Y>0){U+=Y;}}if(b.t===undefined){var a=0;for(k=0;k<W;k++){n=Z[k];Y=O(n,this);if(!n.deleted&&Y>0){a+=Y;}}b.t=a;}n=S[0];var d=E.call(this,n),T={x:0,y:0,w:0,h:0};if(n===s){j=this.area.w*this.scaleFactor*this.area.h*this.scaleFactor;T.w=this.area.w*this.scaleFactor;T.h=this.area.h*this.scaleFactor;}else{if(f===s){j=this.area.w*this.scaleFactor*this.area.h*this.scaleFactor;T.w=this.area.w*this.scaleFactor;T.h=this.area.h*this.scaleFactor;}else{var x=f.size;j=x.w*x.h;T=G(x);}if(b.t===0){j=0;}else{j*=U/b.t;}}var X=u.w,m=u.h,w=false;if(u.h>=u.w){w=true;J(u);J(T);var o=X;X=m;m=o;d={h:d.v,v:d.h};}if((T.x<u.x)||(T.x+T.w>u.x+u.w)){if(d.h>1){X+=(d.h>>1);}}if((T.y<u.y)||(T.y+T.h>u.y+u.h)){if(d.v>1){m+=(d.v>>1);}}var g=m===0?0:Math.min(u.w,Math.ceil(j/m));if(U<b.t&&U>0){if(u.x+g<T.x+T.w){if(d.h>1){if(g>d.h>>1){g-=(d.h>>1);}}else{if(g>1){g--;}}}}L.call(this,b,u,g,U,w);var q=u.x+g,V=u.w-g;if(U<b.t&&U>0){if(u.x+g<T.x+T.w){if(d.h>1){if(V>d.h){q+=d.h;V-=d.h;}}else{if(V>1){q++;V--;}}}}u.x=q;u.w=Math.max(0,V);if(w){J(u);}}function R(Z,c,q){var d,S=Z.r,g=S.length;if(g>0&&q>0){var o=S[0];var b=0,h=this,p=h.singleKPIModels;if(Z.t===undefined){I.forEach(p,function(a){if(!a.deleted){b+=O(a,h);}});Z.t=b;}else{b=Z.t;}if(isNaN(b)||b<=0){return -1;}var f,j,T=0,s,n=false,k;for(k=0;k<g;k++){o=S[k];if(!o.deleted){s=O(o,this);if(!isNaN(s)){if(n===false){j=f=s;n=true;}else{j=Math.max(s,j);f=Math.min(s,f);}T+=s;}}}var U=q*T/b,X=U/c,Y=(c<X)?c:X;j=q*j/b;f=q*f/b;var W=j/(Y*Y);var V=f/(Y*Y);W=(W>1)?W:(1/W);V=(V>1)?V:(1/V);d=Math.max(W,V);}else{d=-1;}return d;}function A(h,S,V,d,e){var W=[[this,h,S,V,d,e]],f=this.singleKPIModels;while(W.length){var U=W.pop();var b=U.shift();h=U.shift();S=U.shift();V=U.shift();d=U.shift();e=U.shift();if(h.length===0){Q.call(b,S,d,f);}else{var T=d.w*d.h;var g;if(e!==undefined){g=e;}else{g=R.call(b,S,V,T);}var X=h[0],Y=S.r;Y.push(X);var Z=R.call(b,S,V,T);if(g>=Z||g===-1){h.shift();W.push([b,h,S,V,d,Z]);}else{S.r.pop();Q.call(b,S,d,f);V=Math.min(d.w,d.h);W.push([b,h,{r:[],t:S.t},V,d]);}}}}mstrmojo.kpicard.layout.SmartLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.kpicard.layout._LayoutCommon],{scriptClass:"mstrmojo.kpicard.layout.SmartLayout",cssClass:"smart-layout-kpi-container",layoutConfig:{w:{containerNode:"100%"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;}},postBuildRendering:function N(){this._super();this.calculateLayout();this.createSingleKPIs();},updateSingleKPIProps:function P(T){var S=T.dataModel.size;T.width=S.w+"px";T.height=S.h+"px";T.left=S.x+"px";T.top=S.y+"px";},calculateLayout:function B(){var U=parseFloat(this.width),S=parseFloat(this.height),V={x:0,y:0,w:U,h:S},T=Math.min(V.w,V.h);this.area=V;this.scaleFactor=1;A.call(this,this.singleKPIModels.slice(0),{r:[]},T,G(this.area));}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.VisTooltip","mstrmojo.VisBase","mstrmojo.PerformanceLogOutput","mstrmojo._VizSelectionHelper","mstrmojo.kpicard.KPICardEnum","mstrmojo.kpicard._KPICardProperty","mstrmojo.kpicard._KPICardDataModel","mstrmojo.kpicard._KPICardInteractivity","mstrmojo.kpicard.layout.HorizontalLayout","mstrmojo.kpicard.layout.VerticalLayout","mstrmojo.kpicard.layout.StackedLayout","mstrmojo.kpicard.layout.SmartLayout","mstrmojo.kpicard.layout.GridLayout","mstrmojo.kpicard._SupportKPICardBrushesAndHighlights","mstrmojo.util.ui._LassoSelector","mstrmojo.vi.ui.rw._XtabDE","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl","mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights","mstrmojo.vi._MonitorsAppState","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.VisEnum","mstrmojo.util.FontLoader");var L=mstrmojo.hash,b=mstrmojo.array,D=mstrmojo.css,T=mstrmojo.VisUtility,U=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,M=mstrmojo.kpicard.KPI_PROPERTIES,i=mstrmojo.kpicard.TEXT_SIZE_TYPE,a=mstrmojo.kpicard.CAN_SET_FONT_PARTS,c=mstrmojo.kpicard.DISPLAY_MODE,h=mstrmojo.PerformanceLogOutput,N=mstrmojo.VisEnum.ControlType,I=false,q=["libraries/echarts.common.min.js","libraries/jquery.min.js","libraries/slick/slick.min.js"],j=["libraries/slick/slick.css","libraries/slick/slick-theme.css"];var t=["kpicard.layout.StackedLayout","kpicard.layout.SmartLayout","kpicard.layout.HorizontalLayout","kpicard.layout.VerticalLayout","kpicard.layout.GridLayout"];var m={"1":"light-style","2":"night-style","3":"desert-style","4":"ocean-style"};var o=["click","contextmenu","mousemove"];function G(y,x){return y-x;}function P(x){if(x&&x.length){var y=(x.length-1)/2;x.sort(G);return(x[Math.ceil(y)]+x[Math.floor(y)])/2;}return NaN;}mstrmojo.kpicard.VisKPICard=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.vi._MonitorsAppState,mstrmojo.kpicard._SupportKPICardBrushesAndHighlights,mstrmojo.util.ui._LassoSelector,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.kpicard._KPICardProperty,mstrmojo.kpicard._KPICardDataModel,mstrmojo.kpicard._KPICardInteractivity],{scriptClass:"mstrmojo.kpicard.VisKPICard",cssClass:"kpicard-widget",isPercentNumberStyle:undefined,layoutor:undefined,normalizedIdCache:{},markupString:'<div id="{@id}" class="{@cssClass}" style="position:absolute; width:{@width}px; height:{@height}px; left:{@left}px; top:{@top}px; z-index: {@zIndex};" mstrAttach:'+o.join(",")+"></div>",selectedCards:null,contextMenuSelections:null,colorThresholds:null,unifyMetricNameSize:null,unifyMetricValueSize:null,unifyPrevMetricSize:null,unifyBadgeSize:null,plusMinus:null,clickFromSingleKPICard:false,tooltipWin:undefined,tooltipCont:undefined,tooltipPos:{},markupSlots:{containerNode:function(){return this.domNode;}},init:function r(x){this._super(x);if(!this.tooltipWin){this.tooltipWin=new mstrmojo.VisTooltip();this.tooltipWin.render();}this.loadDependCss();},requirePreload:true,getFonts:function l(){var z=this.getFormatPropertyValue(M.NEW_FONT);var y=[];var x=[];L.forEach(z,function(AB){var AA=AB[U.FONT_FAMILY];if(y.indexOf(AA)<0){x.push({name:AA,isItalic:false,isBold:false});x.push({name:AA,isItalic:false,isBold:true});y.push(AA);}});return x;},update:function(AB){var z,y,AC,x=this.excludeData,AA=this._super(AB);if(AA!==false){this.clearError();z=this.model.data||{};y=z.egt;AC=z.eg;if((y!==undefined||AC!==undefined)&&!x){this.setError(AC,y);}this.checkData();this.modelData=z;}return AA;},postBuildRendering:function Q(){h.visPrint("VisKPICard PostBuildRendering Start");h.startTimer({functionName:"VisKPICard.postBuildRendering: ",purpose:"from Build to End"},"timerid_KPI_fromBuildtoEnd");if(this.waitingForData){return ;}if(this.isEmpty()||this.excludeData){this._super();return ;}this.initColorThresholds();if(!this.hasRendered||!this.isResizing){this.createModelForSingleKPI();}delete this.isResizing;this.plot();var x=this.getExp(),y=this.getRowsAndCols();T.modifyScExp(x,y,this.model,this.normalizedIdCache);if(this._super){this._super();}this.registerLassoSelector(this.domNode,[N.KPI_V_SCROLLBAR,N.KPI_H_SCROLLBAR],false);h.endTimer("timerid_KPI_fromBuildtoEnd");h.recordJSHeapMemory("KPI Memory usage at the end");},refresh:function v(y,x){if(x){this.isResizing=true;}this._super(y);},resetSelections:function V(){this.selectedCards=[];this.contextMenuSelections=[];},loadDependLibraries:function E(){var y=this.id,x=mstrmojo.getJsRoot(),z=[];if(mstrApp.isSingleTier){x="file://"+x;}if(!window.echarts){z.push({url:x+q[0],forceReload:false});}if(!window.jQuery){z.push({url:x+q[1],forceReload:false});}if(!(window.jQuery&&window.jQuery.fn.slick)){z.push({url:x+q[2],forceReload:false});}this.requiresExternalScripts(z,function(){var AA=mstrmojo.all[y];if(AA){AA.plot();}});},loadDependCss:function O(){var x;if(!I){x=mstrmojo.getJsRoot();mstrmojo.insertCSSLinks(b.map(j,function(y){return x+y;}));I=true;}},setError:function(z,y){var x=T.translateGridError(z,y);this.error=x.msg;this.errorType=x.type;},clearError:function(){this.error=undefined;this.errorType=undefined;},hasError:function(){return this.error!==undefined||this.errorType!==undefined;},isEmpty:function(){return this.hasError();},getVisEmptyMsgControls:function(){return T.getVisEmptyMsgControls.call(this);},unifyNodeFontSize:function S(AC){var AA=this.getUnifiedNodeFontSize(AC);var y=this.getFormatPropertyValue(M.TEXT_SIZE_TYPE);var x=this.getFormatPropertyValue(M.NEW_FONT);if(y===i.FIXED){return ;}var AB=y===i.UNIFIED;var z;switch(AC){case"metricValueNode":this.unifyMetricValueSize=AA;z=x[a.PRIMARY_VALUE][M.UNIFY_STEPS];break;case"metricNameNode":this.unifyMetricNameSize=AA;z=x[a.LABEL][M.UNIFY_STEPS];break;case"prevMetricNode":this.unifyPrevMetricSize=AA;z=x[a.PREVIOUS_VALUE][M.UNIFY_STEPS];break;case"compareNode":this.unifyBadgeSize=AA;z=x[a.TREND_IDENTITY][M.UNIFY_STEPS];break;}this.layoutor.forEachChild(function(AD){if(AC==="compareNode"){AD.unifyBadgeTextSize(AB,Number(z));}else{AD.resetNodeTextSize(AD[AC],AB,AA,Number(z));}});},initUnifiedSize:function(x){if(!x||x.indexOf(a.LABEL)>-1){this.unifyMetricNameSize=this.getUnifiedNodeFontSize("metricNameNode");}if(!x||x.indexOf(a.PRIMARY_VALUE)>-1){this.unifyMetricValueSize=this.getUnifiedNodeFontSize("metricValueNode");}if(!x||x.indexOf(a.PREVIOUS_VALUE)>-1){this.unifyPrevMetricSize=this.getUnifiedNodeFontSize("prevMetricNode");}if(!x||x.indexOf(a.TREND_IDENTITY)>-1){this.unifyBadgeSize=this.getUnifiedNodeFontSize("compareNode");}},modifyFontSize:function(x){this.initUnifiedSize(x);this.layoutor.forEachChild(function(y){y.applyUnifySteps("init",x);});},getUnifiedNodeFontSize:function(z){var y=[],x;this.layoutor.forEachChild(function(AA){x=parseFloat(AA[z].style.fontSize);if(!isNaN(x)){y.push(x);}});return P(y);},plot:function(){var AA=this.containerNode,x=document.createElement("div"),y,AD,AC,AB,z,AG,AE=this.fmts,AF=AE&&AE["background-color"];this.resetSelections();AA.innerHTML="";AA.className=this.cssClass;AG=this.getFormatPropertyValue(M.CURRENT_SLIDE_ELEMENT);AA.appendChild(x);AD={parent:this,placeholder:x,width:parseInt(this.width)+"px",height:parseInt(this.height)+"px",enableAutoPlay:this.getFormatPropertyValue(M.AUTO_PLAY),singleKPIModels:this.singleKPIModels,widgetId:this.id,initialElemId:AG};z=this.getFormatPropertyValue(M.DISPLAY_MODE);this.lassoSelectorEnabled=(z!==c.STACKED&&this.singleKPIModels.length>1);if(this.singleKPIModels.length===1||z===c.STACKED){D.toggleClass(AA,"one-card",true);}this.removeLayout();AC=t[parseInt(z)-1];AB=L.walk(AC,mstrmojo);y=new AB(AD);this.addChildren([y]);if(!y.hasRendered){y.render();}this.layoutor=y;if(this.getFormatPropertyValue(M.TEXT_SIZE_TYPE)!==i.FIXED){this.modifyFontSize();}this.applyColorThresholds();if(AF){this.updateBorderColor(AF);}},isInStackedMode:function C(){var AA=this.getFormatPropertyValue(M.DISPLAY_MODE),z=this.layoutor,x=z.singleKPIModels,y=x&&x.length>1;return AA===c.STACKED&&y;},isStackedAutoPlay:function X(){return this.getFormatPropertyValue(M.AUTO_PLAY);},applyNewStyle:function Y(y){var z,AA,x=this.containerNode;for(z in m){AA=m[z];if(z===y){D.toggleClass(x,AA,true);}else{D.toggleClass(x,AA,false);}}},initColorThresholds:function K(){var x=this.readColorThresholdsProp(),y=x&&x.thresholds;this.colorThresholds=y||[];},addColorThreshold:function H(z){var AA=true,x,y,AB=this.colorThresholds,AC;x={min:undefined,max:undefined,color:z,enabled:AA};AB.push(x);y={thresholds:AB};AC=JSON.stringify(y);this.writeProperties(M.COLOR_THRESHOLDS,AC);},updateColorThresholds:function s(){var x,y=this.colorThresholds,z;x={thresholds:y};z=JSON.stringify(x);this.writeProperties(M.COLOR_THRESHOLDS,z);},setColorThresholdProperty:function J(y,AB,AA){var x,z=this.colorThresholds;if(y>=z.length||y<0){return ;}x=z[y];x[AB]=AA;this.updateColorThresholds();},removeColorThreshold:function R(x){this.colorThresholds.splice(x,1);this.updateColorThresholds();},applyColorThresholds:function W(AC){var AA,z=this.colorThresholds,x,AD=z.length,AB=this.layoutor;if(!AB){return ;}var y=AB.forEachChild.bind(AB);if(AC){y=b.forEach.bind(b,[AC]);}y(function(AE){AE.clearColorThreshold();});if(!AD){return ;}y(function(AE){for(AA=0;AA<AD;AA+=1){x=z[AA];if(x.enabled){AE.applyColorThreshold(AA,x);}}});},readColorThresholdsProp:function g(){var x=this.getFormatPropertyValue(M.COLOR_THRESHOLDS);return x&&JSON.parse(x);},getDefaultFontFamily:function e(){var x=mstrApp&&mstrApp.getThemeProps("KPI");return(x&&x.fontFamily)||"Open Sans";},getDefaultFontColor:function p(){var z=this.getFormatPropertyValue(M.KPI_STYLE);var y=mstrApp&&mstrApp.getThemeProps("KPI");var x=y&&y.defaultFontClr;return(x&&x[z])||"#35383A";},isClearAllEnabled:function u(){var x=this.modelData||{},y=x.sc;return !!(y===undefined||y.showall);},unrender:function B(){var x=this._lastOpened;if(x){this.closePopup();}if(this._super){this._super();}this.removeLayout();},removeLayout:function A(){if(this.layoutor){this.removeChildren(this.layoutor);this.layoutor.destroy();this.layoutor=null;}},getSortRows:function w(){var y=this.model,z=y&&y.data,AA=z&&z.gsi,x=AA&&AA.sorts;return x&&x[0];},onBEMFormatChange:function Z(x){var y=x&&x.propertyName,z=x&&x.value;if(!y||!z){return ;}if(y==="bc"){this.updateBorderColor(z);}},updateBorderColor:function F(y){var x=this.layoutor;if(!x){return ;}x.forEachChild(function(z){z.updateBorderColor(y);});},onclick:function f(x){var y=x.ctrlKey||x.metaKey;if(this.clickFromSingleKPICard){this.clickFromSingleKPICard=false;return ;}if(this.clickFromCreatingLasso){return ;}if(!y&&!this.contextMenuDismiss){this.clearSelectedCards();this.prepareLMCSelectionData();this.endSelections();}this.contextMenuDismiss=false;},oncontextmenu:function d(){this.contextMenuDismiss=false;},onmousemove:function k(x){this.updateTooltipPos(x.e.pageX,x.e.pageY);},destroy:function n(y){var x=this.tooltipWin;if(x){x.hide();this.tooltipWin=undefined;}this._super(y);}});}());