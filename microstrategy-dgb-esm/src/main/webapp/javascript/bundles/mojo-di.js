mstrmojo.warehouse.EnumDatabaseType={SAP:1200,MSAS:1500,EssBase:1600,TM1:2900,SAPHana:4000,BDE:5400,SearchEngineSOLR:5500,Hive:3100,Impala:4100,SearchEngineSPLUNK:5600,Pig:6400,PHOENIX:6800,IBMBigInsights:700,Drill:7300,DB_TYPE_NEWDB_1:8100,DB_TYPE_NEWDB_5:8500,AzureCosmosDB:8700};(function(){function Q(V,R,S){if(V.nodeType===3&&R){return V;}else{var U=(R&&V.nodeType===1&&V.lastChild)?V.lastChild:F(V,S);return U?D(U,S):null;}}function F(S,R){return(S===R)?null:(S.previousSibling||F(S.parentNode,R));}function D(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.lastChild){return D(S.lastChild);}else{return D(F(S,R));}}}function I(R){return R.textContent||R.nodeValue||R.innerText;}function M(V,R,S){if(V.nodeType===3&&R){return V;}else{var U=(R&&V.nodeType===1&&V.firstChild)?V.firstChild:B(V,S);return U?E(U,S):null;}}function B(S,R){return(S===R)?null:(S.nextSibling||B(S.parentNode,R));}function E(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.firstChild){return E(S.firstChild);}else{return E(B(S,R));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function P(U,V){var R=0,S;if(U.nodeType===1){if(window.getSelection){S=document.createRange();S.selectNode(U);R=S.toString().length;}else{S=document.body.createTextRange();S.moveToElementText(U);R=S.text.length;}}else{R=I(U).length;}return V===R?this.EDGE.EDGE_END:(V===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function K(V,S){if(!V.offsetParent){return ;}var U=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(V);R.collapse(S);U.removeAllRanges();U.addRange(R);}else{R.moveToElementText(V);R.collapse(S);R.select();}},collapseOnTextNode:function L(V,W){var U=this.getSelection(),S=this.getRange();if(window.getSelection){var R=M(V,true);S.setStart(R,W);S.collapse(true);U.removeAllRanges();U.addRange(S);}else{S.moveToElementText(V);S.collapse(true);S.move("character",W);S.select();}},collapseOnTextNodeIE:function C(S,U){var V=M(S,true),R;while(V!==null){R=I(V).length;if(R>=U){this.collapseOnTextNode(V,U);break;}else{U-=R;V=M(V,false);}}},getRangeInfo:function J(Y,f){var a=null,l,d=this.getRange(),c;if(Y&&Y===d.startContainer){var h=d.startContainer.firstChild,V=h&&h.firstChild,e=V&&V.firstChild;if(e){d.setStart(e,d.startOffset);d.setEnd(e,d.endOffset);}}if(window.getSelection){var X=function(n,p,o){var m=n.cloneRange();m.collapse(o);m.setStartBefore(p);return m.toString().length;},S=d.startContainer,g=d.startOffset;if(S.nodeType===1){g=X(d,S,true);}a={collapsed:d.collapsed,startContainer:S,startOffset:f?f.startOffset:g};if(!d.collapsed){var W=d.endContainer,R=d.endOffset;if(W.nodeType===1){R=X(d,W,false);}a.endContainer=W;a.endOffset=R;}a.range=d;}else{var k,b,Z=function(p,q){var o=p.duplicate(),m=document.body.createTextRange(),n;o.collapse(q);n=o.parentElement();m.moveToElementText(n);m.setEndPoint("EndToStart",o);return{container:n,offset:m.text.length};},j=Z(d,true),U;a={collapsed:(d.compareEndPoints("StartToEnd",d)===0),startContainer:j.container,startOffset:j.offset};if(!a.collapsed){U=Z(d,false);a.endContainer=U.container;a.endOffset=U.offset;}}return a;},collapse:function O(S){if(window.getSelection){var U=this.getSelection();if(S){U.collapseToStart();}else{U.collapseToEnd();}}else{var R=this.getRange();R.collapse(S);R.select();}},selectSingleNode:function H(U){var S=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(U);S.removeAllRanges();S.addRange(R);}else{R.moveToElementText(U);R.select();}},selectMultipleNodes:function N(X,S,Y,V){var W=this.getSelection(),U=this.getRange();if(window.getSelection){U.setStart(X,S);U.setEnd(Y,V);W.removeAllRanges();W.addRange(U);}else{X=(X.nodeType===3)?X.parentNode:X;U.moveToElementText(X);U.move("character",S);Y=(Y.nodeType===3)?Y.parentNode:Y;var R=document.body.createTextRange();R.moveToElementText(Y);R.move("character",V);U.setEndPoint("EndToStart",R);U.select();}},getSelection:function G(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function A(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());mstrmojo.mstr.EnumFunction={FunctionCustom:-1,FunctionReserved:0,FunctionPlus:1,FunctionMinus:2,FunctionTimes:3,FunctionDivide:4,FunctionUnaryMinus:5,FunctionEquals:6,FunctionNotEqual:7,FunctionGreater:8,FunctionLess:9,FunctionGreaterEqual:10,FunctionLessEqual:11,FunctionSum:12,FunctionCount:13,FunctionAvg:14,FunctionMin:15,FunctionMax:16,FunctionBetween:17,FunctionLike:18,FunctionAnd:19,FunctionOr:20,FunctionNot:21,FunctionIn:22,FunctionRank:23,FunctionAbs:24,FunctionRunningSum:25,FunctionRunningAvg:26,FunctionMovingSum:28,FunctionMovingAvg:27,FunctionProduct:29,FunctionMedian:30,FunctionMode:31,FunctionStdev:32,FunctionVar:33,FunctionGeomean:34,FunctionEqualEnhanced:35,FunctionNotEqualEnhanced:36,FunctionGreaterEqualEnhanced:37,FunctionLessEqualEnhanced:38,FunctionBetweenEnhanced:39,FunctionBanding:40,FunctionBandingC:41,FunctionBandingP:42,FunctionNotLike:43,FunctionNotBetween:44,FunctionIntersect:45,FunctionIntersectIn:46,FunctionNullToZero:47,FunctionZeroToNull:48,FunctionApplySimple:49,FunctionApplyAggregation:50,FunctionApplyLogic:51,FunctionApplyComparison:52,FunctionApplyRelative:53,FunctionIsNull:54,FunctionIsNotNull:55,FunctionUcase:56,FunctionNotIn:57,FunctionNTile:58,FunctionPercentile:59,FunctionMovingMax:60,FunctionMovingMin:61,FunctionMovingDifference:62,FunctionMovingStdev:63,FunctionExpWghMovingAvg:64,FunctionMovingCount:65,FunctionRunningMax:66,FunctionRunningMin:67,FunctionRunningStdev:68,FunctionRunningCount:69,FunctionExpWghRunningAvg:70,FunctionNotBetweenEnhanced:71,FunctionConcat:72,FunctionFirstInRange:73,FunctionLastInRange:74,FunctionValueSegment:75,FunctionContains:76,FunctionBeginsWith:77,FunctionEndsWith:78,FunctionNotContains:79,FunctionNotBeginsWith:80,FunctionNotEndsWith:81,FunctionCase:82,FunctionCaseV:83,FunctionStdevP:84,FunctionRunningStdevP:85,FunctionMovingStdevP:86,FunctionNTileS:87,FunctionNTileVS:88,FunctionVarP:89,FunctionCurrentDate:90,FunctionDayOfMonth:91,FunctionDayOfWeek:92,FunctionDayOfYear:93,FunctionWeek:94,FunctionMonth:95,FunctionQuarter:96,FunctionYear:97,FunctionCurrentDateTime:98,FunctionCurrentTime:99,FunctionHour:100,FunctionMinute:101,FunctionSecond:102,FunctionMilliSecond:103,FunctionConcatNoBlank:104,FunctionLength:105,FunctionLower:106,FunctionLTrim:107,FunctionPosition:108,FunctionRTrim:109,FunctionSubStr:110,FunctionInitCap:111,FunctionTrim:112,FunctionRightStr:113,FunctionLeftStr:114,FunctionGreatest:115,FunctionLeast:116,FunctionFirst:117,FunctionLast:118,FunctionAdd:134,FunctionAverage:135,FunctionMultiply:136,FunctionBandingM:137,FunctionOLAPSum:138,FunctionOLAPAvg:139,FunctionOLAPCount:140,FunctionOLAPMax:141,FunctionOLAPMin:142,FunctionLag:143,FunctionLead:144,FunctionPercentRank:166,FunctionConcatAgg:177,FunctionTuple:1000};(function(){mstrmojo._CanRenderChildrenOnShow=mstrmojo.provide("mstrmojo._CanRenderChildrenOnShow",{_subs_renderOnShow:null,childRenderCheck:function B(D){if(this.renderMode!=="onshow"){return this._super(D);}if(D.visible){return this._super(D);}var C=this._subs_renderOnShow;if(!C){C={};this._subs_renderOnShow=C;}if(!C[D.id]){C[D.id]=D.attachEventListener("visibleChange",this.id,"_on_child_visibleChange");}return false;},_on_child_visibleChange:function A(C){if(this.hasRendered){var E=C&&C.src;if(E&&this.childRenderCheck(E)){var D=this._subs_renderOnShow;if(D){E.detachEventListener(D[E.id]);delete D[E.id];}E.render();}}}});}());mstrmojo.mstr.EnumDSSConsolidationType={DssNormal:0,DssDerivedElement:1,DssRecursiveDerivedElement:2};(function(){var I=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.bigquery._BigQueryController=mstrmojo.provide("mstrmojo.qb.bigquery._BigQueryController",{loadDBRoles:function G(J){this.model.loadDBRoles(J);},getNameSpaces:function C(J){this.model.selectedDataset=undefined;this.model.getDatasets(J);},setSelectedDBRoleID:function F(J){this.model.set("selectedProject",J.id);},setNameSpaceID:function D(J){this.model.set("selectedDataset",J);},handleLogout:function E(){mstrApp.container.unloadQB();mstrApp.getRootController().afterBigQueryProcess(false);},handleDBTableRefresh:function A(){var J=this.model,K=J.selectedProject;if(!K||!J.selectedDataset){return ;}J.catalogRefresh=true;J.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},availableTableSearch:function B(J){this.model.getDatasetTables({blockBegin:0,blockCount:1000,filterText:J});},getProjectPrimaryDBRoleID:function H(){return this.model.selectedProject;},});}());var STR_BYTE_LEN=mstrmojo.desc(9660,"Byte length:"),STR_BIT_LEN=mstrmojo.desc(11456,"Bit length:"),STR_PREC=mstrmojo.desc(9659,"Precision:"),STR_SCL=mstrmojo.desc(9662,"Scale:"),STR_TM_SCL=mstrmojo.desc(9661,"Time scale:");var byteLength={txt:STR_BYTE_LEN,field:"ps"},bitLength={txt:STR_BIT_LEN,field:"ps"},precision={txt:STR_PREC,field:"ps"},scale={txt:STR_SCL,field:"sc"},timeScale={txt:STR_TM_SCL,field:"ps"};mstrmojo.architect.EnumColumnDataTypes={"-1":{id:-1,n:mstrmojo.desc(4444,"unknown"),options:[]},0:{id:0,n:"Reserved",options:[]},1:{id:1,n:"Integer",options:[byteLength]},2:{id:2,n:"Unsigned",options:[byteLength]},3:{id:3,n:"Numeric",options:[precision,scale]},4:{id:4,n:"Decimal",options:[precision,scale]},5:{id:5,n:"Real",options:[]},6:{id:6,n:"Double",options:[]},7:{id:7,n:"Float",options:[bitLength]},8:{id:8,n:"Char",options:[byteLength]},9:{id:9,n:"VarChar",options:[byteLength]},10:{id:10,n:"LongVarChar",options:[byteLength]},11:{id:11,n:"Binary",options:[byteLength]},12:{id:12,n:"VarBin",options:[byteLength]},13:{id:13,n:"LongVarBin",options:[byteLength]},14:{id:14,n:"Date",options:[]},15:{id:15,n:"Time",options:[timeScale]},16:{id:16,n:"TimeStamp",options:[timeScale]},17:{id:17,n:"NChar",options:[byteLength]},18:{id:18,n:"NVarChar",options:[byteLength]},30:{id:30,n:"Big Decimal",options:[precision,scale]},34:{id:34,n:"Big Integer",options:[byteLength]}};(function(){mstrmojo.DI.OneTierServerTransport={serverRequest:function A(E,D,C){window.FormWrapper.serverDIRequest(D,JSON.stringify(C.params),E,"response");},cancelRequest:function B(C){return false;}};}());mstrmojo.architect.EnumDragActions={ADD_TABLE:"addTable",ADD_COLUMN:"addColumn",TABLE_VIEW_ATTR:"tableViewItemAttr",TABLE_VIEW_METRIC:"tableViewItemMetric",PROJECT_TABLE:"projectTable",PROJECT_TABLE_COLUMN:"projectTableColumn",LINKER_ATTR:"linkerAttr",COMPOUND_FORM:"compoundForm"};(function(){var C="xviPopopNode";function A(G){var H={};H[C]=G;return H;}mstrmojo.ui.menus._IsMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._IsMenuPopup",{init:function E(G){this._super(G);var J=this.popupConfig;if(!J){throw new Error("Cannot instantiate popup without supplying the popupConfig property.");}this.addDisposable(J);var H=mstrmojo.all[J.hostId],I=J.hostElement;if(J.isHostedWithin&&H&&I){H.addSlots(A(I));this.slot=C;}},closeAllMenus:function F(){var G=this.opener;if(G&&G.closePopup){G.closePopup();}if(G&&G.closeAllMenus){G.closeAllMenus();}},open:function B(H,G){if(this._super){this._super(H,G);}},close:function D(G){if(this.slot===C){this.opener.removeSlots(A(null));}if(this._super){this._super(G);}var H=mstrmojo.all[this.popupConfig.hostId];if(H){H.closePopup();}this.destroy();}});}());mstrmojo.architect.menu.EnumMenuActions={NONE:0,DELETE:1,RENAME:2,AUTOMAP:3,UPSTRUCT:4,ADD_ATTRIBUTE:5,ADD_FACT:6,CREATE_ALIAS:7,SET_AS_PRIMARY:8,IS_PRIMARY:9,SAMPLE_DATA:10,CONVERT_ATTR_TO_FACT:11,CONVERT_ATTR_TO_FORM:12,CONVERT_FACT_TO_ATTR:13,REMOVE_FROM_TABLE:14,SET_AS_LOOKUP:15,SET_AS_FORM:16,NEW_FACT:17,NEW_ATTR:18,UPDATE_FORMAT:19,EDIT:20,MAPPING:21,AGGREGATION:22,DATA_TYPE:23,UPDATE_AGGR:24,DATA_SOURCES:25,REMOVE_TABLE:26,REMOVE_ATTR_FROM_RELATIONSHIP:27,ONE_TO_ONE:28,ONE_TO_MANY:29,MANY_TO_MANY:30,DELETE_RELATIONSHIP:31,RELATIONSHIP_TABLE:32,RELATIONSHIP_TABLE_ENTRY:33,SHOW_UNUSED_COLUMNS:34,ADD_TO_LAYER:35,REMOVE_FROM_LAYER:36,COLUMN_DEF:37,LINKS:38,CONVERT_COLUMN_TO_FORM:39,ADD_TO_PROJECT:40,LOGICAL_TABLE_SIZE:41,SET_AS_MULTILINGUAL:42,FORM_CATEGORY:43,UPDATE_CATEGORY:44,UNGROUP_FORMS:45,GROUP_FORM:46,UNGROUP_FORM:47,UPDATE_GROUP:48,DUPLICATE:49,TX_ONE_TO_ONE:50,TX_MANY_TO_MANY:51,TX_APPLY_TO_ALL:52,TX_APPLY_TO_HIGHEST:53,SET_ENTRY_POINT:54,REMOVE_ENTRY_POINT:55,REL_ATTR_ELEMENT_DISPLAY:56,ATTRIBUTE_FILTERS:57,BROWSE_ATTRIBUTES:58,REL_ATTR_ELEMENT_LIMIT:59,REL_ATTR_ELEMENT_LOCK:60,REL_ATTR_ELEMENT_UNLOCK:61,ADD_JOIN_CHILDREN:62,USE_AS_DRILL:63,USE_AS_BROWSE:64,CATALOG_SQL:65,SHARE:66};(function(){mstrmojo._IsGraphDataService=mstrmojo.provide("mstrmojo._IsGraphDataService",{handleUserSingleTap:function A(D,E,B,G,C,F){if(mstrApp.onMobileDevice()){mstrApp.serverRequest({taskId:"handleUserSingleTap",sliceID:D,nodekey:E,x:B,y:G,selectable:C},F);}}});}());(function(){mstrmojo.warehouse._CanToggleAvatarClass=mstrmojo.provide("mstrmojo.warehouse._CanToggleAvatarClass",{_mixinName:"mstrmojo.warehouse._CanToggleAvatarClass",getAvatarIconClass:function C(D){return"enabled";},ondragenter:function A(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),true);}if(this._super){this._super(D);}},ondragleave:function B(D){var E=D.src.widget;if(E&&E.toggleAvatarClass&&this.allowDrop(D)){E.toggleAvatarClass(this.getAvatarIconClass(D),false);}if(this._super){this._super(D);}}});}());(function(){mstrmojo.vi.ui.theme=mstrmojo.provide("mstrmojo.vi.ui.theme",{getThemeClass:function A(){var D=this.parent||this.opener,C="",B;while(D){var E=D.themeClassName;if(E){C=E;break;}B=D.parent||D.opener;if(B===D){break;}D=B;}return C;}});}());(function(){var A={};mstrmojo.NumberFormat={getInstance:function B(F,G){var E=F+"--"+G;if(E in A){return A[E];}var C={parse:function(H){},format:function(H){}};if(F==="."&&G===","){C.parse=function(H){if(!H){return NaN;}var I=H.replace(/,/g,"");return Number(I);};C.format=function(H){return Number(H).toString();};}else{var D=new RegExp("\\"+G,"g");C.parse=function(I){if(!I){return NaN;}var H=I.replace(D,"").replace(F,".");return Number(H);};C.format=function(I){var H=Number(I).toString();return H.replace(".",F);};}A[E]=C;return C;}};})();(function(){mstrmojo.StringBuffer=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.StringBuffer",append:function A(C){if(!this.buf){this.reset();}this.buf[++this.len]=C;return this;},reset:function B(){this.buf=[];this.len=-1;}});mstrmojo.StringBuffer.prototype.toString=function(D){var C=this.buf;return(C&&C.join(D||""))||"";};}());(function(){function A(C){return C.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");}mstrmojo._ImageHelper=mstrmojo.provide("mstrmojo._ImageHelper",{getImage:function B(D){var E=mstrApp,C=E.getConfiguration();if(D){if(D.indexOf("\\")>=0){D=D.replace(/\\/g,"/");}D=A(D);if(D===decodeURI(D)){D=encodeURI(D);}}if(C&&D&&D.indexOf("://")===-1){D=C.getHostUrlByProject(E.getCurrentProjectId())+D;}return(mstrApp.useBinaryFormat)?String(mstrMobileApp.getImage(D)):D;}});}());mstrmojo.gm.GMEnums={};mstrmojo.gm.DualAxisSubAxisBit={PRIMARY:0,SECONDARY:1};mstrmojo.gm.StackExetrmeId={PRIMARY_Y_AXIS:-2,SECONDARY_Y_AXIS:-18,PRIMARY_X_AXIS:-1,SECONDARY_X_AXIS:-17};mstrmojo.gm.FormNameType={OFF:0,ON:1,FORM_NAME_ONLY:2,SHOW_ATT_NAME_ONCE:3,AUTO:4};mstrmojo.gm.EnumSelectionOptionLevel={GLOBAL:1,ITSELF:2,ATTS_METRIC_COMBINATION:3,METRIC_AXIS:4,METRIC:5,AXIS:6,COLOR_BY:7,ALL_SHAPE:8,ITSELF_RESOLVED:9};mstrmojo.gm.EnumLabelRotation={VERTICAL:2,HORIZONTAL:0,AUTOMATIC:-1};mstrmojo.gm.EnumIdentityType={LEGEND:Math.pow(2,0),GRAPH_SHAPE:Math.pow(2,1),X_AXIS:Math.pow(2,2),Y_AXIS:Math.pow(2,3),X2_AXIS:Math.pow(2,4),Y2_AXIS:Math.pow(2,5),GRID_LINE:Math.pow(2,6),TREND_LINE:Math.pow(2,7),REF_LINE:Math.pow(2,8),DATA_LABEL:Math.pow(2,9),COLOR_SQUARE:Math.pow(2,10),ROW_TITLE:Math.pow(2,11),COL_TITLE:Math.pow(2,12),ROW_HEADER:Math.pow(2,13),COL_HEADER:Math.pow(2,14),LOG_SCALE:Math.pow(2,15),H_MATRIX_LINE:Math.pow(2,16),V_MATRIX_LINE:Math.pow(2,17),LEGEND_TEXT:Math.pow(2,18),SHAPE_COLLECTION:Math.pow(2,19),MINOR_GRID_LINE:Math.pow(2,20),AXIS_SCALE:Math.pow(2,22),AXIS_ORIGIN:Math.pow(2,23),ROWS_BACKGROUND:Math.pow(2,24),COLS_BACKGROUND:Math.pow(2,25),X_NUMERIC:Math.pow(2,26),X_CATEGORY:Math.pow(2,27),Y_NUMERIC:Math.pow(2,28),Y_CATEGORY:Math.pow(2,29),X_METRIC_AXIS_TITLE:Math.pow(2,30),Y_METRIC_AXIS_TITLE:Math.pow(2,31),VIZ_BOX_TITLE:Math.pow(2,32),REF_LINE_LABEL:Math.pow(2,33),LINE_MARKER:Math.pow(2,34),X_AXIS_ORIGIN_LABEL:Math.pow(2,35),Y_AXIS_ORIGIN_LABEL:Math.pow(2,36),X_AXIS_ORIGIN_LINE:Math.pow(2,37),Y_AXIS_ORIGIN_LINE:Math.pow(2,38),Y_ATTRIBUTE_AXIS_TITLE:Math.pow(2,39),ROW_HEADER_TEXT:Math.pow(2,40),ROW_TITLE_TEXT:Math.pow(2,41),COL_HEADER_TEXT:Math.pow(2,42),COL_TITLE_TEXT:Math.pow(2,43),VIZ_BOX_CONTAINER:Math.pow(2,44),X_ATTRIBUTE_AXIS_TITLE:Math.pow(2,45),AXIS_ORIGIN_DEFINE:Math.pow(2,46)};mstrmojo.gm.EnumGMZoneIds={ROWS:1,COLUMNS:2,XAXIS:3,YAXIS:4,BREAKBY:5,SLICEBY:6,COLORBY:7,SIZEBY:8,TOOLTIP:9,ANGLEBY:10};mstrmojo.gm.EnumClickType={NONE:-1,LEFT_CLICK:1,RIGHT_CLICK:2,DOUBLE_CLICK:3};mstrmojo.gm.EnumLegendSlot={RIGHT_TOP:1,RIGHT_MIDDLE:2,RIGHT_BOTTOM:3,LEFT_TOP:4,LEFT_MIDDLE:5,LEFT_BOTTOM:6,LEFT:7,RIGHT:8};mstrmojo.gm.EnumAxisType={ATTRIBUTE:0,METRIC:1};mstrmojo.gm.EnumGraphType={UNDEFINED:-1,AREA:1,BAR:2,LINE:3,SCATTER:4,BUBBLE:5,PIE:6,GRID:7,HISTOGRAM:8,BOXPLOT:9,WATERFALL:10};mstrmojo.gm.EnumContextMenu={SEPARATOR:0,KEEP_ONLY:1,EXCLUDE:2,SORT_ASCENDING:3,SORT_DESCENDING:4,CLEAR_SORT:5,SHOW_DATA:6,SWITCH_THEME:7,KEEP_ONLY_AND_SHOW:8,CLOSE_LEGEND:9,OPEN_LEGEND:10,AXIS_SCALE:11,DRILL_TO:100,CHART_TYPE:200,AREA_ABS:201,AREA_STACKED:202,AREA_PERCENT:203,BAR_SBS:204,BAR_ABS:205,BAR_STACKED:206,BAR_PERCENT:207,LINE_ABS:208,LINE_STACKED:209,LINE_PERCENT:210,BUBBLE:211,SCATTER:212,H_AREA_ABS:213,H_AREA_STACKED:214,H_AREA_PERCENT:215,H_BAR_SBS:216,H_BAR_ABS:217,H_BAR_STACKED:218,H_BAR_PERCENT:219,H_LINE_ABS:220,H_LINE_STACKED:221,H_LINE_PERCENT:222,GRID:223,CIRCLE:224,SQUARE:225,PIE:226,TICKER:227,RING:228,CANVAS:229,SVG:230,LARGE_ABL:231,OUTPUT_EXTREMES:232,COMBINATION:233,ENABLE_PARTIAL_RENDERING:234,DISABLE_PARTIAL_RENDERING:235,OUTPUT_DATA_COUNT:236,ENABLE_TIMER:239,DISABLE_TIMER:240,ENABLE_CE_TIMER:241,DISABLE_CE_TIMER:242};mstrmojo.gm.EnumColorRankMode={RANK_MODE_VALUE:0,RANK_MODE_TOP:1,RANK_MODE_BOTTOM:2,RANK_MODE_TOP_PERCENT:3,RANK_MODE_BOTTOM_PERCENT:4};mstrmojo.gm.EnumColorByType={NULL:0,ATT:1,METRICS_ITEM:2,METRICS:3,ATT_METRICS:4};mstrmojo.gm.EnumDockPosition={TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};mstrmojo.gm.EnumXAxisLabelStatus={NORMAL:1,STAGGER:2,ROTATE:3,HORI_DROP:4};mstrmojo.gm.EnumABLDirection={UNDEFINED:-1,NONE:0,HORIZONTAL:1,VERTICAL:2};mstrmojo.gm.EnumMetricsPosition={MetricsByRow:0,MetricsByColumn:1,MetricsByAxis:2,MetricsByBreakBy:3,MetricsBySlice:4,MetricsByXAxis:5,MetricsByYAxis:6};mstrmojo.gm.EnumDrawingAPI={GET_CHART_WIDTH:0,GET_CHART_HEIGHT:1,GET_ROW_HEADER:2,GET_COLUMN_HEADER:3,CREATE_UNIT_Y_AXIS:4,CREATE_UNIT_X_AXIS:5,GET_FULL_FLEDGED_CHART:6,GET_ROW_SPAN:7,GET_COLUMN_SPAN:8,GET_METRICS_ON_X:9,GET_METRICS_ON_Y:10,GET_METRICS_ON_SIZE_BY:11,UPDATE_MINI_CHART:12,UPDATE_X_AXIS:13,UPDATE_Y_AXIS:14,MAX_RADIUS_CALC:15,GET_EXTRA_COLUMN_HEADER:16,UPDATE_COLUMN_HEADER:17,UPDATE_ROW_HEADER:18,LAYOUT_ALL_X_AXIS_LABELS:19,LAYOUT_ONE_X_AXIS_LABELS:20};mstrmojo.gm.WidgetPropertyTag={FIT_TO:"FitTo",AXIS_SCALE:"MinMax",SHAPE:"Shape",SUB_TYPE:"Subtype",VIS_TYPE:"visType",DATA_LABEL:"DataLabel",DATA_LABELS_PLACEMENT:"DataLabelPalcement",METRIC_LEVEL_DATA_LABEL:"mtcLvlDataLabel",DATA_LABEL_FONT_SIZE_CONSTRAINT:"DataLabelFontSizeConstraint",DATA_LABEL_TEXT_ANGLE:"DataLabelTextAngle",BANDING:"Banding",LEGEND_VISIBLE:"LegendVisibleness",COL_ALIGNMENT:"Columnalignment",ROW_ALIGNMENT:"Rowalignment",MAX_SIZE_TYPE:"SizeType",MAX_SIZE_VALUE:"SizeValue",MIN_SIZE_TYPE:"minSizeType",MIN_SIZE_VALUE:"minSizeValue",OUTSIDE_BORDER:"OutSideBorder",AXES:"AxisLine",MATRIX_LINES:"MatrixLine",GRID_LINES:"GridLine",SELECTION_TYPE:"SelectionType",SELECTIONS:"Selections",LEGEND_MODE:"lm",LEGEND_POSITION:"LegendPosition",SCALE_LEGEND_WIDTH:"lwr",SCALE_CHART_HEIGHT:"rr",SCALE_CHART_WIDTH:"cr",SCALE_ROW_HEADERS:"rvr",SCALE_COL_HEADERS:"chr",SCALE_Y:"yr",SCALE_X:"xr",SCALE_Y2:"y2r",SCALE_X2:"x2r",SCALE_ALL:"scales",SCALE_V_EXTRA_LINE:"vExtraLine",SORT_ORDER:"so",SORT_INDEX:"si",AXIS_SCALE_DATA:"AxisScale",AXIS_SCALE_REAL_MIN:"rMin",AXIS_SCALE_REAL_MAX:"rMax",AXIS_SCALE_MANUAL_MIN:"mMin",AXIS_SCALE_MANUAL_MAX:"mMax",AXIS_SCALE_AUTO_MIN:"autoMin",AXIS_SCALE_AUTO_MAX:"autoMax",SINGLE_AXIS_SCALE_TYPE:"scaleType",LOG_SCALE:"logScale",GROUP_INFO:"groupInfo",METRIC_SHAPES:"metricShapes",AXIS_ORIGIN:"axisOrigin",AXIS_ORIGIN_AUTO:"axOriAuto",AXIS_ORIGIN_VALUE:"axOriValue",TREND_LINE_DEF:"trdDef",REF_LINE_DEF:"refDef",TREND_TYPE:"trdTp",TREND_LEVEL:"trdLvl",TREND_ENABLED:"trdEnabled",TREND_INCLUDE_BREAK_BY:"trdIncBB",TREND_POLY_DEGREE:"trdDgr",TREND_FORECAST_ENABLED:"trdFstEnabled",TREND_BWD_FORECAST:"trdBwdFst",TREND_FWD_FORECAST:"trdFwdFst",TREND_SEASONALITY:"trdSeason",TREND_BUBBLE_FORE_DEF:"trdBbForeDef",TREND_BUBBLE_FORE_FWD:"trdBbForeFwd",TREND_BUBBLE_FORE_BWD:"trdBbForeBwd",TREND_BUBBLE_FORE_ENABLED:"trdBbForeEnabled",TREND_BUBBLE_MAX:"trdBbMax",TREND_BUBBLE_MIN:"trdBbMin",REF_TYPE:"refTp",REF_LEVEL:"refLvl",REF_ENABLED:"refEnabled",REF_SHOW_LABEL:"refLbShw",REF_LABEL_TYPE:"refLbTp",REF_CONST_VALUE:"refCstVl",REF_LINE_NAME:"refLnName",TREND_REF_LINE_THICKNESS:"trdRefLnThk",TREND_REF_LINE_COLOR:"trdRefLnClr",TREND_REF_LINE_STYLE:"trdRefLnStyle",TREND_REF_LINE_COMBINED_STYLE:"trdRefLnCmbStyle",FORMATS_ON_COMBINATION:"fmtOnComb",PARTIAL_RENDER:"prtRdn",SHOW_BOTH_TOTALS:"totalShw:intSumShw"};mstrmojo.gm.FormatingPropertyTag={IS_DEFAULT_VALUE:"_default",MODIFIED_DEF_FILL_COLOR:"modDefFillClr",ALL_SHAPE_FORMAT:"allShpFmt",SHAPE_LINE_THICKNESS:"shpLnThk",SHAPE_LINE_COLOR:"shpLnClr",SHAPE_LINE_STYLE:"shpLnStyle",SHAPE_LINE_COMBINED_STYLE:"shpLnCmbStyle",SHAPE_FILL_COLOR:"shpFillClr",SHAPE_FILL_COLOR_DEFAULT:"shpFillClr_default",SHAPE_FILL_STYLE:"shpFillStyle",SHAPE_FILL_TRANSPARENCY:"shpFillTrans",SHAPE_FILL_EFFECT:"shpFillEff",SHAPE_BORDER_COLOR:"shpBdrClr",SHAPE_BORDER_STYLE:"shpBdrStyle",SHAPE_BORDER_COMBINED_STYLE:"shpBdrCmbStyle",SHAPE_BORDER_THICKNESS:"shpBdrThk",LINE_MARKER_SHOW:"lnMkShw",LINE_MARKER_SHAPE:"lnMkShp",LINE_MARKER_SIZE:"lnMkSz",LINE_MARKER_COLOR:"lnMkClr",LINE_MARKER_COLOR_EQUAL:"lnMkClrEq",LINE_MARKER_BORDER_COLOR:"lnMkBdrClr",PIE_EXPLODE:"pieExpl",DATA_LABELS_SHOW:"dlShw",DATA_LABELS_FONT_FAMILY:"dlFntFml",DATA_LABELS_FONT_SIZE:"dlFntSz",DATA_LABELS_FONT_STYLE:"dlFntStyle",DATA_LABELS_FONT_COLOR:"dlFntClr",REF_LABELS_FONT_FAMILY:"rfLnFntFml",REF_LABELS_FONT_SIZE:"rfLnFntSz",REF_LABELS_FONT_STYLE:"rfLnFntStyle",REF_LABELS_FONT_COLOR:"rfLnFntClr",LEGEND_BG_COLOR:"lgdBgFillClr",LEGEND_BG_FILL_STYLE:"lgdBgFillStyle",LEGEND_BG_FILL_EFFECT:"lgdBgFillEff",LEGEND_BG_FILL_TRANSPARENCY:"lgdBgFillTrans",LEGEND_FONT_SIZE:"lgdFntSz",LEGEND_FONT_FAMILY:"lgdFntFml",LEGEND_FONT_STYLE:"lgdFntStyle",LEGEND_FONT_COLOR:"lgdFntClr",LEGEND_BORDER_SHOW:"lgdBdrShw",LEGEND_BORDER_COLOR:"lgdBdrClr",LEGEND_BORDER_THICKNESS:"lgdBdrThk",LEGEND_BORDER_LINE_STYLE:"lgdBdrStyle",LEGEND_BORDER_LINE_COMBINED_STYLE:"lgdBdrCmbStyle",ALL_LINE_SHOW:"allLnShw",ALL_LINE_COLOR:"allLnClr",ALL_LINE_STYLE:"allLnStyle",ALL_LINE_COMBINED_STYLE:"allLnCmbStyle",ALL_LINE_THICKNESS:"allLnThk",ALL_AXIS_ORIGIN_LINE_SHOW:"axOriLnShw",ALL_AXIS_ORIGIN_LINE_COLOR:"axOriLnClr",ALL_AXIS_ORIGIN_LINE_COMBINED_STYLE:"axOriLnCmbStyle",X_AXIS_ORIGIN_LINE_SHOW:"xAxOriLnShw",X_AXIS_ORIGIN_LINE_COLOR:"xAxOriLnClr",X_AXIS_ORIGIN_LINE_STYLE:"xAxOriLnStyle",X_AXIS_ORIGIN_LINE_COMBINED_STYLE:"xAxOriLnCmbStyle",X_AXIS_ORIGIN_LINE_THICKNESS:"xAxOriLnThk",Y_AXIS_ORIGIN_LINE_SHOW:"yAxOriLnShw",Y_AXIS_ORIGIN_LINE_COLOR:"yAxOriLnClr",Y_AXIS_ORIGIN_LINE_STYLE:"yAxOriLnStyle",Y_AXIS_ORIGIN_LINE_COMBINED_STYLE:"yAxOriLnCmbStyle",Y_AXIS_ORIGIN_LINE_THICKNESS:"yAxOriLnThk",ALL_AXIS_LINE_SHOW:"allAxLnShw",ALL_AXIS_LINE_COLOR:"allAxLnClr",ALL_AXIS_LINE_STYLE:"allAxLnStyle",ALL_AXIS_LINE_COMBINED_STYLE:"allAxLnCmbStyle",ALL_AXIS_LINE_THICKNESS:"allAxLnThk",ALL_AXIS_TITLE_SHOW:"allAxTtShw",ALL_AXIS_TITLE_CONTENT:"allAxTtCtt",ALL_AXIS_TITLE_FONT_COLOR:"allAxTtFntClr",ALL_AXIS_TITLE_FONT_FAMILY:"allAxTtFntFml",ALL_AXIS_TITLE_FONT_STYLE:"allAxTtFntStyle",ALL_AXIS_TITLE_FONT_SIZE:"allAxTtFntSz",ALL_AXIS_LABELS_FONT_SIZE:"allAxLbFntSz",ALL_AXIS_LABELS_FONT_FAMILY:"allAxLbFntFml",ALL_AXIS_LABELS_FONT_STYLE:"allAxLbFntStyle",ALL_AXIS_LABELS_FONT_COLOR:"allAxLbFntClr",ALL_AXIS_LABELS_ROTATION:"allAxLbRtt",ALL_AXIS_LABELS_SHOW:"allAxLbShw",X_AXIS_LINE_SHOW:"xAxLnShw",X_AXIS_LINE_COLOR:"xAxLnClr",X_AXIS_LINE_STYLE:"xAxLnStyle",X_AXIS_LINE_COMBINED_STYLE:"xAxLnCmbStyle",X_AXIS_LINE_THICKNESS:"xAxLnThk",X_AXIS_TITLE_SHOW:"xAxTtShw",X_AXIS_TITLE_CONTENT:"xAxTtCtt",X_AXIS_TITLE_FONT_COLOR:"xAxTtFntClr",X_AXIS_TITLE_FONT_FAMILY:"xAxTtFntFml",X_AXIS_TITLE_FONT_STYLE:"xAxTtFntStyle",X_AXIS_TITLE_FONT_SIZE:"xAxTtFntSz",X_AXIS_LABELS_FONT_SIZE:"xAxLbFntSz",X_AXIS_LABELS_FONT_FAMILY:"xAxLbFntFml",X_AXIS_LABELS_FONT_STYLE:"xAxLbFntStyle",X_AXIS_LABELS_FONT_COLOR:"xAxLbFntClr",X_AXIS_LABELS_ROTATION:"xAxLbRtt",X_AXIS_LABELS_SHOW:"xAxLbShw",Y_AXIS_LINE_SHOW:"yAxLnShw",Y_AXIS_LINE_COLOR:"yAxLnClr",Y_AXIS_LINE_STYLE:"yAxLnStyle",Y_AXIS_LINE_COMBINED_STYLE:"yAxLnCmbStyle",Y_AXIS_LINE_THICKNESS:"yAxLnThk",Y_AXIS_TITLE_SHOW:"yAxTtShw",Y_AXIS_TITLE_CONTENT:"yAxTtCtt",Y_AXIS_TITLE_FONT_COLOR:"yAxTtFntClr",Y_AXIS_TITLE_FONT_FAMILY:"yAxTtFntFml",Y_AXIS_TITLE_FONT_STYLE:"yAxTtFntStyle",Y_AXIS_TITLE_FONT_SIZE:"yAxTtFntSz",Y_AXIS_LABELS_FONT_SIZE:"yAxLbFntSz",Y_AXIS_LABELS_FONT_FAMILY:"yAxLbFntFml",Y_AXIS_LABELS_FONT_STYLE:"yAxLbFntStyle",Y_AXIS_LABELS_FONT_COLOR:"yAxLbFntClr",Y_AXIS_LABELS_ROTATION:"yAxLbRtt",Y_AXIS_LABELS_SHOW:"yAxLbShw",ALL_FILL_COLOR:"allFillClr",ALL_FILL_TRANSPARENCY:"allFillTrans",BG_COLOR:"bgFillClr",BG_FILL_EFFECT:"bgFillEff",BG_FILL_STYLE:"bgFillStyle",BG_FILL_TRANSPARENCY:"bgFillTrans",ROW_HEADER_FILL_COLOR:"rwHdrFillClr",ROW_HEADER_FILL_EFFECT:"rwHdrFillEff",ROW_HEADER_FILL_STYLE:"rwHdrFillStyle",ROW_HEADER_FILL_TRANSPARENCY:"rwHdrFillTrans",COLUMN_HEADER_FILL_COLOR:"colHdrFillClr",COLUMN_HEADER_FILL_EFFECT:"colHdrFillEff",COLUMN_HEADER_FILL_STYLE:"colHdrFillStyle",COLUMN_HEADER_FILL_TRANSPARENCY:"colHdrFillTrans",ALL_MATRIX_LINES_SHOW:"allMatrixLnShw",ALL_MATRIX_LINES_COLOR:"allMatrixLnClr",ALL_MATRIX_LINES_THICKNESS:"allMatrixLnThk",ALL_MATRIX_LINES_STYLE:"allMatrixLnStyle",ALL_MATRIX_LINES_COMBINED_STYLE:"allMatrixLnCmbStyle",V_MATRIX_LINES_SHOW:"vMatrixLnShw",V_MATRIX_LINES_COLOR:"vMatrixLnClr",V_MATRIX_LINES_THICKNESS:"vMatrixLnThk",V_MATRIX_LINES_STYLE:"vMatrixLnStyle",V_MATRIX_LINES_COMBINED_STYLE:"vMatrixLnCmbStyle",H_MATRIX_LINES_SHOW:"hMatrixLnShw",H_MATRIX_LINES_COLOR:"hMatrixLnClr",H_MATRIX_LINES_THICKNESS:"hMatrixLnThk",H_MATRIX_LINES_STYLE:"hMatrixLnStyle",H_MATRIX_LINES_COMBINED_STYLE:"hMatrixLnCmbStyle",OUTSIDE_BORDER_SHOW:"outBdrShw",OUTSIDE_BORDER_COLOR:"outBdrClr",OUTSIDE_BORDER_STYLE:"outBdrStyle",OUTSIDE_BORDER_THICKNESS:"outBdrThk",OUTSIDE_BORDER_COMBINED_STYLE:"outBdrCmbStyle",GRID_LINE_AUTO:"gridLineAuto",ALL_GRID_LINES_SHOW:"allGridLnShw",ALL_GRID_LINES_COLOR:"allGridLnClr",ALL_GRID_LINES_THICKNESS:"allGridLnThk",ALL_GRID_LINES_STYLE:"allGridLnStyle",ALL_GRID_LINES_COMBINED_STYLE:"allGridLnCmbStyle",AUTO_GRID_LINES_COLOR:"autoGridLnClr",AUTO_GRID_LINES_COMBINED_STYLE:"autoGridLnCmbStyle",MAJOR_GRID_LINES_SHOW:"majorGridLnShw",MAJOR_GRID_LINES_COLOR:"majorGridLnClr",MAJOR_GRID_LINES_THICKNESS:"majorGridLnThk",MAJOR_GRID_LINES_STYLE:"majorGridLnStyle",MAJOR_GRID_LINES_COMBINED_STYLE:"majorGridLnCmbStyle",MINOR_GRID_LINES_SHOW:"minerGridLnShw",MINER_GRID_LINES_COLOR:"minerGridLnClr",MINER_GRID_LINES_THICKNESS:"minerGridLnThk",MINER_GRID_LINES_STYLE:"minerGridLnStyle",MINER_GRID_LINES_COMBINED_STYLE:"minerGridLnCmbStyle",ALL_NGM_GRID_LINES_SHOW:"allNGMGridLnShw",X_GRID_LINES_SHOW:"xGridLnShw",Y_GRID_LINES_SHOW:"yGridLnShw",ALL_ROW_COLUMN_SHOW:"allRwColShw",COLUMN_TEXT_SHOW:"colTxtShw",ROW_TEXT_SHOW:"rwTxtShw",COLUMN_HEADER_SHOW:"colHdrShw",ROW_HEADER_SHOW:"rwHdrShw",COLUMN_VALUES_SHOW:"colVlShw",ROW_VALUES_SHOW:"rwVlShw",ALL_TEXT_FONT_COLOR:"allTxtFntClr",ALL_TEXT_FONT_SIZE:"allTxtFntSz",ALL_TEXT_FONT_FAMILY:"allTxtFntFml",ALL_TEXT_FONT_STYLE:"allTxtFntStyle",ALL_ROW_COLUMN_TEXT_FONT_COLOR:"allRwColTxtFntClr",ALL_ROW_COLUMN_TEXT_FONT_SIZE:"allRwColTxtFntSz",ALL_ROW_COLUMN_TEXT_FONT_FAMILY:"allRwColTxtFntFml",ALL_ROW_COLUMN_TEXT_FONT_STYLE:"allRwColTxtFntStyle",ALL_ROW_COLUMN_TEXT_ALIGNMENT_HORIZONTAL:"allRwColTxtAlignH",ALL_ROW_COLUMN_TEXT_ALIGNMENT_VERTICAL:"allRwColTxtAlignV",ROW_TEXT_TEXT_FONT_COLOR:"rwTxtTxtFntClr",ROW_TEXT_TEXT_FONT_SIZE:"rwTxtTxtFntSz",ROW_TEXT_TEXT_FONT_FAMILY:"rwTxtTxtFntFml",ROW_TEXT_TEXT_FONT_STYLE:"rwTxtTxtFntStyle",ROW_TEXT_TEXT_ALIGNMENT_HORIZONTAL:"rwTxtTxtAlignH",ROW_TEXT_TEXT_ALIGNMENT_VERTICAL:"rwTxtTxtAlignV",COLUMN_TEXT_TEXT_FONT_COLOR:"colTxtTxtFntClr",COLUMN_TEXT_TEXT_FONT_SIZE:"colTxtTxtFntSz",COLUMN_TEXT_TEXT_FONT_FAMILY:"colTxtTxtFntFml",COLUMN_TEXT_TEXT_FONT_STYLE:"colTxtTxtFntStyle",COLUMN_TEXT_TEXT_ALIGNMENT_HORIZONTAL:"colTxtTxtAlignH",COLUMN_TEXT_TEXT_ALIGNMENT_VERTICAL:"colTxtTxtAlignV",ROW_HEADER_TEXT_FONT_COLOR:"rwHdrTxtFntClr",ROW_HEADER_TEXT_FONT_SIZE:"rwHdrTxtFntSz",ROW_HEADER_TEXT_FONT_FAMILY:"rwHdrTxtFntFml",ROW_HEADER_TEXT_FONT_STYLE:"rwHdrTxtFntStyle",ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL:"rwHdrTxtAlignH",ROW_HEADER_TEXT_ALIGNMENT_VERTICAL:"rwHdrTxtAlignV",COLUMN_HEADER_TEXT_FONT_COLOR:"colHdrTxtFntClr",COLUMN_HEADER_TEXT_FONT_SIZE:"colHdrTxtFntSz",COLUMN_HEADER_TEXT_FONT_FAMILY:"colHdrTxtFntFml",COLUMN_HEADER_TEXT_FONT_STYLE:"colHdrTxtFntStyle",COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL:"colHdrTxtAlignH",COLUMN_HEADER_TEXT_ALIGNMENT_VERTICAL:"colHdrTxtAlignV",ROW_VAVLUE_TEXT_FONT_COLOR:"rwVlTxtFntClr",ROW_VAVLUE_TEXT_FONT_SIZE:"rwVlTxtFntSz",ROW_VAVLUE_TEXT_FONT_FAMILY:"rwVlTxtFntFml",ROW_VAVLUE_TEXT_FONT_STYLE:"rwVlTxtFntStyle",ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:"rwVlTxtAlignH",ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL:"rwVlTxtAlignV",COLUMN_VAVLUE_TEXT_FONT_COLOR:"colVlTxtFntClr",COLUMN_VAVLUE_TEXT_FONT_SIZE:"colVlTxtFntSz",COLUMN_VAVLUE_TEXT_FONT_FAMILY:"colVlTxtFntFml",COLUMN_VAVLUE_TEXT_FONT_STYLE:"colVlTxtFntStyle",COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:"colVlTxtAlignH",COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL:"colVlTxtAlignV",TITLE_FONT_COLOR:"ttlFntClr",TITLE_FONT_SIZE:"ttlFntSz",TITLE_FONT_FAMILY:"ttlFntFml",TITLE_FONT_STYLE:"ttlFntStyle",COLOR_SQUARE_COLOR:"clrSqrClr",SELECTION_LIMIT:"slctnLmt",CONTAINER_FIT_MODE:"cntrFitMode",SHOW_MODEBAR:"showModeBar",MEAN_SD:"meanSD",POINT_SIZE:"ptSize",PTSZ_TYPE:"ptSzType",JITTER:"jitter",JTR_TYPE:"jtrType",POINT_POS:"ptPos",PTPOS_TYPE:"ptPosType",SHOW_OUTLIERS:"shwOutliers",CUSTOM_BINS_MODE:"custMode",MANUAL_BINS_MODE:"manualBinsMode",RANGE_TYPE:"rangeType",NUM_BINS:"numBins",XBINS_START:"xBinsStart",XBINS_END:"xBinsEnd",XBINS_SIZE:"xBinsSize",HAS_UNCHECKED_AUTO:"hasUncheckedAuto",HAS_UNCHECKED_DATASET_RANGE:"hasUncheckedDstRng",TOTAL_SHOW:"totalShw",TOTAL_LABEL:"totalLabel",INT_SUM_SHOW:"intSumShw",POSITIVE_COLOR:"posClr",NEGATIVE_COLOR:"negClr",TOTAL_COLOR:"totalClr",INT_SUM_COLOR:"intSumClr",INT_SUM_FULL:"intSumFull"};mstrmojo.gm.EnumAxis={DssAxisReserved:0,DssAxisRows:1,DssAxisColumns:2,DssAxisPages:3,DssAxisChapters:4,DssAxisAll:5};mstrmojo.gm.EnumCombinedLineStyle={NONE:99,THIN:1,THICK:2,DASHED:3,DOTTED:4};mstrmojo.gm.EnumSizeByType={SQUARE:1,CIRCLE:4};mstrmojo.gm.EnumTheme={DARK:0,LIGHT:1};mstrmojo.gm.EnumFitTo={NONE:1,AUTOMATIC:2,COMPACT:3,MANUAL:4};mstrmojo.gm.EnumAxisScale={GLOBAL:0,PERROWCOL:1,PERCELL:2,CUSTOM:3,DIFFERENT:4};mstrmojo.gm.EnumShape={GENERIC:-1,AREA:0,BAR:1,LINE:2,STEPLINE:3,CIRCLE:4,RECTANGLE:5,SQUARE:6,TICK:7,PIESLICE:8,POLYGON:9,PIE:10,RING:11,DEFAULT:12,BULLET:13};mstrmojo.gm.EnumSubtype={AUTO:1,ABSOLUTE:2,STACKED:3,CLUSTERED:4,PERCENT:5};mstrmojo.gm.EnumDataLabels={HIDE:1,SHOW_VALUE_ONLY:2,SHOW_TEXT_ONLY:3};mstrmojo.gm.EnumDataLabelPlacements={AUTOMATIC:1,GENERIC:2,RESERVED:3};mstrmojo.gm.EnumLegend={SHOW:0,HIDE:1,MINIMIZED:2};mstrmojo.gm.EnumLegendMode={RESTORED:1,MINIMIZED:2};mstrmojo.gm.EnumTextAlignH={LEFT:0,MIDDLE:1,RIGHT:2};mstrmojo.gm.EnumTextAlignV={TOP:0,MIDDLE:1,BOTTOM:2};mstrmojo.gm.EnumMaxSizeType={AUTO:1,MANUAL:2,AUTO_FIT:3};mstrmojo.gm.EnumMinSizeType={AUTO:1,MANUAL:2,PROPORTIONAL:3};mstrmojo.gm.EnumAxes={SHOW_BOTH:1,SHOW_NONE:2,SHOW_X:3,SHOW_Y:4};mstrmojo.gm.EnumMatrixLines={SHOW_ALL:1,SHOW_NONE:2,SHOW_HORIZONTAL:3,SHOW_VERTICAL:4};mstrmojo.gm.EnumGridLines={AUTO:1,SHOW:2,HIDE:3,SHOW_MAJOR_ONLY:4};mstrmojo.gm.EnumNGMGridLines={SHOW_Y:1,SHOW_X:2,SHOW:3,HIDE:4,AUTO:5};mstrmojo.gm.LineMarkerShape={Circle:4,Square:1};mstrmojo.gm.ShapeFillType={Solid:0,Gradient:14,Pattern:3};mstrmojo.gm.ShapeFillEffect={None:1,Bevel:2};mstrmojo.gm.Enum3DGMapping={SizeType:"9999_1002",SizeValue:"9999_1003",lgdBgFillClr:"6_564",lgdBgFillStyle:"6_10002",lgdBgFillEff:"6_608",lgdFntSz:"9_603",lgdFntFml:"9_576",lgdFntStyle:"9_584",lgdFntClr:"9_574",LegendVisibleness:"9999_116",xAxShw:"9999_124",xAxTtCtt:"293_9999",xAxTtFntClr:"293_574",xAxTtFntFml:"293_576",xAxTtFntStyle:"293_584",xAxLbFntSz:"272_603",xAxLbFntFml:"272_576",xAxLbFntStyle:"272_584",yAxShw:"9999_125",yAxTtCtt:"299_9999",yAxTtFntClr:"299_574",yAxTtFntFml:"299_576",yAxTtFntStyle:"299_584",yAxLbFntSz:"296_603",yAxLbFntFml:"296_576",yAxLbFntStyle:"296_584",bgFillClr:"1_564",bgFillEff:"1_879",bgFillTrans:"1_608",outBdrClr:"1_588"};mstrmojo.gm.EnumRefLineModelType={MAX:1,MIN:2,AVG:3,MED:4,FIRST:5,LAST:6,CONST:7};mstrmojo.gm.EnumTrendLineModelType={BEST_FIT:256,LINEAR:257,LOG:258,EXP:259,POW:260,POLY:261};mstrmojo.gm.EnumTrendRefLevel={DssModelLevelReserved:0,DssModelLevelPerCell:1,DssModelLevelPerRow:2,DssModelLevelPerColumn:3,DssModelLevelPerPanel:4,DssModelLevelLastOne:5};mstrmojo.gm.EnumTimeRole={None:0,YearOfDecade:3083,QuarterOfYear:2826,MonthOfYear:2825,MonthOfQuarter:2569,WeekOfYear:2824,WeekOfQuarter:2568,WeekOfMonth:2312,DayOfYear:2823,DayOfQuarter:2567,DayOfMonth:2311,DayOfWeek:2055,HourOfDay:1798,MinuteOfDay:1797,MinuteOfHour:1541,SecondOfDay:1796,SecondOfHour:1540,SecondOfMinute:1284};mstrmojo.gm.EnumTrendRefModelLabels={DssModelLabelsReserved:-1,DssModelLabelsNone:0,DssModelLabelsType:1,DssModelLabelsMetric:2,DssModelLabelsValue:4};mstrmojo.gm.EnumTRFManipulations={AddTRLine:"141",RemoveTRLine:"142",UpdateTRLine:"143",UpdateForecastInfo:"144"};mstrmojo.gm.EnumShapeFormatStatus={NORMAL:0,PER_COLORBY:1,PER_SHAPE:2};mstrmojo.gm.EnumNGMSubtype={CLUSTERED:0,STACKED:1,PERCENT:2};mstrmojo.gm.EnumBoxPlotMean={NO_MEAN:0,ONLY_MEAN:1,MEAN_STDEV:2};mstrmojo.gm.EnumBoxPlotOutliers={OUTLIERS:0,ALL_POINTS:1,JITTER:0,JTR_MAN:0.5,POINT_POS:0,POS_MAN:-1.8,POINT_SIZE:6,SIZE_MAN:10,MANUAL:1};mstrmojo.gm.EnumHistogram={AUTOMATIC:1,MANUAL:0,CUST_INPUT:2,DATASET:3,BY_BIN_SIZE:4,BY_BIN_NUMBER:5};mstrmojo.gm.EnumContainerFitModes={AUTOMATIC:0,FIT_TO_CONTAINER:1,FIT_TO_CONTENT:2};mstrmojo.vi.viz.EnumWidgetTypes={GRID:0,GRAPH_MATRIX:1,HEATMAP:2,NETWORK:3,IMAGELAYOUT:4,ESRIMAP:5,GOOGLEMAP:6,CUSTOM:7,MAPBOX:8,KPICARD:9};mstrmojo.qb.EnumDataChangeEvents={TABLES_SELECTED:"tablesSelected",TABLES_ADDED:"tablesAdded",TABLES_LOADED:"tablesLoaded",TABLE_CHANGED:"tableChanged",DBROLE_CHANGED:"dbRoleChanged",RENAME:"rename",REMOVE:"remove",JOIN_CHANGED:"joinChanged"};mstrmojo.mstr.EnumDataType={DataTypeUnknown:-1,DataTypeReserved:0,DataTypeInteger:1,DataTypeUnsigned:2,DataTypeNumeric:3,DataTypeDecimal:4,DataTypeReal:5,DataTypeDouble:6,DataTypeFloat:7,DataTypeChar:8,DataTypeVarChar:9,DataTypeLongVarChar:10,DataTypeBinary:11,DataTypeVarBin:12,DataTypeLongVarBin:13,DataTypeDate:14,DataTypeTime:15,DataTypeTimeStamp:16,DataTypeShort:21,DataTypeLong:22,DataTypeMBChar:23,DataTypeBool:24,DataTypePattern:25,DataTypeBigDecimal:30,DataTypeCellFormatData:31,DataTypeInt64:34};(function(){mstrmojo.cookies={};var C="%26",E="%3D",B=mstrmojo.cookies,D=function(){var F=document.cookie;if(!F||!(typeof F==="string")||F.indexOf("bSet")<0){return false;}return true;},A=function(){var F=document.cookie;F=F.split(";");for(s in F){if(F[s].indexOf("bSet")>=0){return F[s];}}return null;};mstrmojo.cookies.updateCookieSetting=function(H,N,J){try{if(!D()&&!J){return ;}var K=document.cookie,M=H+E+N+C;if(K.indexOf(H)>=0){var F=H+E,G=F+(B.getCookieSetting(H)||0),I=F+N;if(I!=G){document.cookie=K.replace(G,I);}}else{if(K.indexOf("bSet")>=0){document.cookie=K.replace("bSet=","bSet="+M);}else{if(J){document.cookie="bSet="+M+";"+K;}}}}catch(L){mstrmojo.alert(L);return ;}};mstrmojo.cookies.getCookieSetting=function(F){try{return B.getCookieList()[F];}catch(G){mstrmojo.alert(G);return ;}};mstrmojo.cookies.getCookieList=function(){try{if(!D()){return[];}var G=A(),F={},H=null;G=G.replace("bSet=","").split(C);for(H in G){H=G[H].split(E);F[H[0]]=H[1];}return F;}catch(I){mstrmojo.alert(I);return ;}};mstrmojo.cookies.enabledCookieOnBrowser=function(){var F=document.cookie;if(!F||!(typeof F==="string")){return false;}return true;};})();mstrmojo.warehouse.EnumNamespaceMode={ALL:"0",CURRENT:"1"};mstrmojo.vi.enums.EnumFilterClearActionType={CLEAR_ALL:0,CLEAR_KEEP_ONLY:1,CLEAR_ADV_QUALIFICATION:2,CLEAR_LINKING:3,CLEAR_KEEP_ONLY_AND_LINKING:4,CLEAR_DRILLING:5};(function(){var A=/^mstrmojo./;mstrmojo.DynamicClassFactory={newComponent:function(C,B,F){var H=C.prototype.scriptClass.replace(A,"");for(var E=0,D=B&&B.length||0;E<D;E++){if(!B[E]._mixinName){throw new Error('Mixins must have a "_mixinName" property to be used with DynamicClassFactory');}H+="_"+B[E]._mixinName.replace(A,"");}var G=mstrmojo[H];if(!G){G=mstrmojo.declare(C,B,F);mstrmojo[H]=G;}return G;}};}());mstrmojo.vi.enums.EnumVisFilterType={KEEP_ONLY:0,ADV_QUALIFICATION:1,LINKING:2,DRILLING:3};(function(){mstrmojo.Refine.RefineConstants=mstrmojo.provide("mstrmojo.Refine.RefineConstants",{transformationType:{Whitespace:0,TransformCell:1,Delete:2,Split:3,Extract:4,FindAndReplace:5,Facet:6,Other:7,RemoveText:8},transformationSubType:{TrimLeadingTrailingWhitespace:0,CollapseConsecutiveWhitespace:1,Titlecase:10,Uppercase:11,Lowercase:12,UnescapeHTML:13,ChangeDataType:14,FillDown:15,BlankDown:16,PadBefore:17,PadAfter:18,DeleteColumn:20,DeleteRow:21,RemoveDuplicateCells:22,RemoveDuplicateRows:23,DeleteRowsInTheView:24,DeleteRowsNotInTheView:25,SplitByFixedLength:30,SplitOnSeparator:31,SplitBeforeSeparator:32,SplitAfterSeparator:33,SplitCellIntoRows:34,ExtractByFixedLength:40,ExtractBeforeSeparator:41,ExtractAfterSeparator:42,FindAndReplaceCharactersInCell:50,FindAndReplaceCell:51,TextFacet:60,NumericFacet:61,TimelineFacet:62,SearchFacet:63,ClusterAndEdit:70,Duplicate:71,Rename:72,ConcatenateColumns:73,TransposeColumnsToRows:74,RemoveTheText:80,RemoveTheTextBefore:81,RemoveTheTextAfter:82},menuItems:{SEPARATOR:-1,REFINE_RENAME:0,REFINE_DELETE:1,REFINE_DELETE_ALL:2,REFINE_RESET:3,REFINE_RESET_ALL:4,REFINE_SORT_NAME:5,REFINE_SORT_COUNT:6,REFINE_CLUSTER:7,REFINE_NUMERIC_FACET:8,REFINE_TEXT_FACET:9,REFINE_DUPLICATE:10,REFINE_FILL_DOWN:11,REFINE_TITLE_CASE:12,REFINE_UPPERCASE:13,REFINE_LOWERCASE:14,REFINE_DELETE_ROWS_IN_THE_VIEW:15,REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:16}});}());(function(){var A=400,B=1500;mstrmojo._CanHandleTwoClicks=mstrmojo.provide("mstrmojo._CanHandleTwoClicks",{firstClickTimeStamp:undefined,firstClickTarget:undefined,onclick:function(C){var D=new Date();timeStamp=D.getTime();if(D-this.firstClickTimeStamp<B&&D-this.firstClickTimeStamp>A){C.secondTarget=C.getTarget();C.firstTarget=this.firstClickTarget;this.onTwoClicks(C);C.cancel();}else{this.firstClickTarget=C.getTarget();this.firstClickTimeStamp=timeStamp;}if(this._super){this._super(C);}},onTwoClicks:mstrmojo.emptyFn});}());mstrmojo.chart.enums.EnumFontStyle={FS_NORMAL:0,FS_BOLD:1,FS_ITALIC:2,FS_BOTH:3,FS_UNDERLINE:4,FS_STRIKETHROUGH:8};(function(){mstrmojo.vi._MonitorsAppState=mstrmojo.provide("mstrmojo.vi._MonitorsAppState",{onAppStateChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("appStateChange",this.id,"onAppStateChange");}}});}());mstrmojo.warehouse.EnumObjectTypes={FILTER:1,METRIC:4,ATTRIBUTE:12,FACT:13,DIMENSION:14,TABLE:15,TABLE_LOGICAL_VIEW:151,TABLE_PARTITION:152,FORM:21,COLUMN:26,DBROLE:29,PROJECT:32,TRANSFORMATION:43,DBTABLE:53,LAYER:70,RELATIONSHIP:99,COMPOUND_FORM:1001,RELATIONSHIP_ATTRIBUTE:1002};mstrmojo.EnumAuthenticationModes={DEFAULT:0,STANDARD:1,NTCREDENTIAL:2,PASSTHRU:4,ANONYMOUS:8,LDAP:16,DATABASE:32,PLUGIN:64,INTEGRATED:128,USHER:256};mstrmojo.vi.models.EnumDragSources={DATASETS:1,VIZ_EDITOR:2,FILTERS:3,ALL_OBJECT_LIST:4,VIZ:5,TOC_CHAPTER:6,TOC_PAGES_LIST:7,VIZ_LAYER:8};mstrmojo.EnumSelectionType={ALL:0,ELEMENT:1,BRANCH:2,LEVEL:3,BRANCH_LEVEL:4};(function(){mstrmojo._Fetchable=mstrmojo.provide("mstrmojo._Fetchable",{_mixinName:"mstrmojo._Fetchable",blockBegin:1,blockCount:-1,concat:false,items:null,size:function A(){var B=this.items;return(B&&B.length)||0;},next:function(B){if(this.hasNext()){this.getItems(this.blockBegin+this.blockCount,B);}},previous:function(B){if(this.hasPrevious()){var C=this.blockBegin-this.blockCount;C=C<0?0:C;this.getItems(C,B);}},getItems:function(H,F,B){F=F||{};var E=this,D=mstrmojo.emptyFn,C=F.success||D,G=F.failure||D,I=F.complete||D;this._retrieveItems(H,{success:function(J){E.blockBegin=H;E.blockCount=J.bc||30;E.set("items",(E.concat?(E.items||[]).concat(J.items||[]):(J.items||[])));if(J.totalSize){E.totalSize=J.totalSize;}C(J);},failure:function(J){G(J);},complete:function(J){I(J);}},B);},_retrieveItems:function(D,C,B){alert("Object which mixes in this mixin has not implemented this method - _retrieveItems().");},hasNext:function(){return(((this.concat?1:this.blockBegin)+((this.items&&this.items.length)||0))<((mstrApp.isAppStatePause&&mstrApp.isAppStatePause())?this.totalSize:(this.totalSize+1)));},hasPrevious:function(){return this.blockBegin>1;}});}());if(!mstrmojo.LoadedExternalJSURLs){mstrmojo.LoadedExternalJSURLs={};}function LoadScriptsExternalJSCallback(){mstrmojo.LoadedExternalJSURLs[mstrmojo._LoadsScript.esScripts.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(mstrmojo._LoadsScript.esScripts,mstrmojo._LoadsScript.callback,mstrmojo._LoadsScript.esScritsContext);mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=false;}if(!mstrmojo._LoadsScript){mstrmojo._LoadsScript=mstrmojo.provide("mstrmojo._LoadsScript",{_meta_usesSuper:false,requiresMethod:function requiresMethod(B){if(!B){return false;}if(typeof this[B]==="function"){return true;}var A=this[B]||(this.methods&&(this.methods[B]||this.methods["*"]));if(typeof A==="string"){this.requiresCls(A);return typeof this[B]==="function";}return false;},requiresCls:function req(mixins,callback){if(mixins){if(typeof mixins==="string"){mixins=[mixins];}mstrmojo.requiresCls.apply(mstrmojo,mixins);var p=this.constructor.prototype,pm=p.mixins;if(!pm){p.mixins={};pm=p.mixins;}var mx=mstrmojo.mixin,i,len;for(i=0,len=mixins.length;i<len;i++){var fqcn=mixins[i];if(!pm[fqcn]){var m=eval(mixins[i]);mx(m,p);pm[fqcn]=true;if(m.__onmixin__){m.__onmixin__.apply(this,[]);}}}if(callback){callback.apply(this,[]);}}},requiresContrib:function reqCb(C,B){var A=this[C];if(A){var E,D=false;if(typeof A==="string"){E=mstrmojo.registry.ref(A);this[C]=E;D=true;}else{E=A;}if(E&&(D||B)){E.parent=this;if(E.startup){E.startup();}}return E;}return null;},requiresExternalScripts:function requiresExternalScripts(G,H,C){if(G&&G instanceof Array){if(G.length===0){if(H){H.call(C);}return false;}if(G[0]&&G[0].forceReload===false&&mstrmojo.LoadedExternalJSURLs[G[0].url]){G.splice(0,1);return this.requiresExternalScripts(G,H,C);}var A=document.createElement("script"),D=!!document.all,B=G[0].url,F=G[0].onError;if(B.substr(0,7)==="file://"){B=B.substr(7);}else{if(mstrApp.isSingleTier&&B.substr(0,4)!=="http"){B="http:"+B;}}A.type="text/javascript";A.src=B;if(F){A.onerror=function(){if(F&&F.callback&&C){F.callback.call(C,F.params);}};}if(!G[0].callbackParamName){if(D){A.onreadystatechange=function(){if(A.readyState==="loaded"||A.readyState==="complete"){A.onreadystatechange=null;A.onerror=null;if(G.length>1){mstrmojo.LoadedExternalJSURLs[G.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(G,H,C);}else{if(G.length===1){mstrmojo.LoadedExternalJSURLs[G[0].url]=true;if(H){H.call(C);}}}}};}else{A.onload=function(){A.error=null;A.onload=null;if(G.length>1){mstrmojo.LoadedExternalJSURLs[G.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(G,H,C);}else{if(G.length===1){mstrmojo.LoadedExternalJSURLs[G[0].url]=true;if(H){H.call(C);}}}};}}else{if(G[0].callbackParamName.length!==0){if(mstrmojo._LoadsScript.ExternalJSCallbackIsBusy&&mstrmojo._LoadsScript.ExternalJSCallbackIsBusy===true){var E=this;window.setTimeout(function(){E.requiresExternalScripts(G,H,C);},500);return ;}mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=true;A.src+="&"+G[0].callbackParamName+"=LoadScriptsExternalJSCallback";mstrmojo._LoadsScript.esScripts=G;mstrmojo._LoadsScript.callback=H;mstrmojo._LoadsScript.esScritsContext=C;}}document.getElementsByTagName("head")[0].appendChild(A);}}});}(function(){function D(I){var G,J={};for(G=0;G<I.attributes.length;G++){var H=I.attributes[G];J[H.nodeName]=H.value;}for(G=0;G<I.childNodes.length;G++){var K=I.childNodes[G],F;if(K.nodeType===1){F=K.localName;J[F]=J[F]||[];J[F].push(D(K));}}return J;}function A(F){var G=new window.DOMParser();return G.parseFromString(F,"text/xml");}mstrmojo.XMLParser=mstrmojo.declare(null,null,{xml2DOM:function E(F){return A(F);},xml2Object:function C(G){var F=A(G);if(F){return D(F.documentElement);}return null;},file2Object:function B(F){var G=mstrmojo.loadFileSync(F);if(G){return this.xml2Object(G);}return null;}});}());mstrmojo.vi.viz.EnumVizStyles={GRAPH_MATRIX:"GraphMatrixVisualizationStyle",NETWORK:"NetworkVisualizationStyle",HEAT_MAP:"VIHeatMapVisualizationStyle",GOOGLE_MAP:"GoogleMapVisualizationStyle",ESRI_MAP:"ESRIMapVisualizationStyle",IMAGE_LAYOUT:"ImageLayoutVisualizationStyle",NEW_GRAPH_MATRIX:"NewGraphMatrixVisualizationStyle",MAPBOX:"MapboxVisualizationStyle",KPICARD:"KPICardVisualizationStyle"};mstrmojo.qb.EnumMenuActions={NONE:0,DELETE_JOIN:1,SET_INNER_JOIN:2,SET_LEFT_OUTER_JOIN:3,SET_RIGHT_OUTER_JOIN:4,SET_OUTER_JOIN:5,MORE_JOIN_OPTION:6,SET_EXPRESSION:7,SET_AGGREGATION_FUNCTION:8,SET_FILTER:9};mstrmojo.mstr.EnumDSSXMLObjectSubTypes={Unknown:-1,Reserved:0,Filter:256,CustomGroup:257,Template:512,ReportGrid:768,ReportGraph:769,ReportEngine:770,ReportText:771,ReportDatamart:772,ReportBase:773,ReportGridAndGraph:774,ReportNonInteractive:775,ReportCube:776,ReportIncrementalRefresh:777,ReportTransaction:778,ReportEmmaCube:779,ReportEmmaIncrementalRefresh:780,Metric:1024,SubtotalDefinition:1025,SystemSubtotal:1026,MetricDMX:1027,DssSubTypeMetricTraining:1028,Style:1536,AggMetric:1792,Folder:2048,Device:2304,Prompt:2560,PromptBoolean:2561,PromptLong:2562,PromptString:2563,PromptDouble:2564,PromptDate:2565,PromptObjects:2566,PromptElements:2567,PromptExpression:2568,PromptExpressionDraft:2569,PromptDimty:2570,PromptBigDecimal:2571,Function:2816,Attribute:3072,AttributeRole:3073,AttributeTransformation:3074,AttributeAbstract:3075,AttributeRecursive:3076,Fact:3328,DimensionSystem:3584,DimensionUser:3585,DimensionOrdered:3586,DimensionUserHierarchy:3587,Table:3840,TablePartitionMD:3841,TablePartitionWH:3842,DatamartReport:4096,FactGroup:4352,Resolution:4864,AttributeForm:5376,FormSystem:5377,FormNormal:5378,Schema:5632,Format:5888,Catalog:6144,CatalogDefn:6400,Column:6656,PropertyGroup:6912,PropertySet:7168,DBRole:7424,DBRoleDataImport:7425,DBRoleOAuth:7427,DBRoleGenericDataConnector:7430,DBLogin:7680,DBConnection:7936,Project:8192,ServerDef:8448,User:8704,UserGroup:8705,Transmitter:8705,Configuration:9216,Request:9472,Search:9984,SearchFolder:10240,Datamart:10496,FunctionPackageDefinition:10752,Role:11008,RoleTransformation:11009,SecurityRole:11264,InBox:11520,InBoxMsg:11776,Consolidation:12032,ConsolidationManaged:12033,ConsolidationElement:12288,ScheduleEvent:12544,ScheduleObject:12800,ScheduleTrigger:13056,Link:13312,DBTable:13568,DBTablePMT:13569,TableSource:13824,DocumentDefinition:14080,ReportWritingDocument:14081,DocumentTheme:14082,DrillMap:14336,DBMS:14592,MDSecurityFilter:14848,MonitorPerformance:15104,MonitorJobs:15105,MonitorUserConnections:15106,MonitorDBConnections:15107,PromptAnswer:15232,PromptAnswers:15360,PromptAnswerBoolean:15233,PromptAnswerLong:15234,PromptAnswerString:15235,PromptAnswerDouble:15236,PromptAnswerDate:15237,PromptAnswerObjects:15238,PromptAnswerElements:15239,PromptAnswerExpression:15240,PromptAnswerExpressionDraft:15241,PromptAnswerDimty:15242,PromptAnswerBigDecimal:15243,PromptAnswerInt64:15244,GraphStyle:15616,ChangeJournalSearch:15872,BlobUnknown:16128,BlobOther:16129,BlobImage:16130,BlobProjectPackage:16131,BlobExcel:16132,BlobHTMLTemplate:16133,DashboardTemplate:16384,Flag:16640,ChangeJournal:16896,ExternalShortcutUnknown:17152,ExternalShortcutURL:17153,ExternalShortcutSnapshot:17154,ExternalShortcutTarget:17408,Reconciliation:17664,DerivedAttribute:3077,PaletteSystem:17920,PaletteCustom:17921,Thresholds:18432,SubscriptionAddress:65281,SubscriptionContact:65282,SubscriptionInstance:65283};mstrmojo.warehouse.EnumDataChangeEvents={DBROLES_REQUESTED:"dbRolesRequested",DBROLES_LOADED:"dbRolesLoaded",DBROLES_ADD:"dbRoleAdd",DBROLES_RENAME:"dbRoleRename",DBROLES_DELETE:"dbRoleDelete",DBROLE_SELECTION:"dbroleSelection",NAMESPACES_CHANGED:"namespacesChanged",NAMESPACES_REQUESTED:"namespacesRequested",NAMESPACES_CANCELED:"namespacesCanceled",TABLES_CANCELED:"tablesCanceled",DBTABLES_CHANGED:"dbTablesChange",DBTABLES_REQUESTED:"dbTablesRequested",DBTABLE_UPDATED:"dbTableUpdated",DBROLE_CHANGED:"dbRoleChanged",DBTABLES_USED:"dbTablesUsed",DBTABLES_ENABLED:"dbTablesEnabled"};mstrmojo.qb.EnumDragActions={ADD_TABLE:"addTable",JOIN_COLUMN:"joinColumn"};(function(){mstrmojo._HasPopup=mstrmojo.provide("mstrmojo._HasPopup",{_mixinName:"mstrmojo._HasPopup",_lastOpened:null,openPopup:function A(G,E){var C=!!G&&(typeof G==="string")&&!G.match(/\./)&&!!this[G],D=mstrmojo.registry.ref(C?this[G]:G);if(D&&D.open){if(C){this[G]=D;}if(D.disposable!==false){this.addDisposable(D);}var J=D.slot&&this[D.slot];if(J){if(D.parent!==this){if(this.addChildren){this.addChildren([D]);}else{var I=false,F=D.domNode||D.placeholder;if(F&&typeof F==="string"){F=document.getElementById(F);}if(!F){I=true;F=document.createElement("span");D.placeholder=F;}if(I||(F.parentNode!==J)){J.appendChild(F);}}}}try{D.open(this,E);}catch(H){console.log("Error opening popup: "+H);}this._lastOpened=D;}},closePopup:function B(){var C=this._lastOpened;if(C&&C.visible&&C.close){C.close();delete this._lastOpened;}}});}());mstrmojo.mstr.EnumNodeDimty={NodeDimtyReserved:0,NodeDimtyNone:1,NodeDimtyContinuation:2,NodeDimtyExclusiveContinuation:3,NodeDimtyOutputLevel:4,NodeDimtyBreakBy:5,NodeDimtyEmbedded:6,NodeDimtyUnspecified:7};(function(){mstrmojo.vi._MonitorsLayoutMode=mstrmojo.provide("mstrmojo.vi._MonitorsLayoutMode",{onLayoutModeChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("layoutModeChange",this.id,"onLayoutModeChange");}}});}());mstrmojo.qb.EnumQBAppType={EmmaSingleTable:368,QueryBuilder:352,FFSQL:304,BigQuery:341,BigQueryFFSQL:342,BigQuerySingleTable:345,BISource:400,MDX:2,NewConnector:500};mstrmojo.vi.enums.EnumDSSAccessRightFlags={DssAccessRightReservedFlag:0,DssAccessRightBrowseFlag:1,DssAccessRightUseExecuteFlag:2,DssAccessRightReadFlag:4,DssAccessRightWriteFlag:8,DssAccessRightDeleteFlag:16,DssAccessRightControlFlag:32,DssAccessRightUseFlag:64,DssAccessRightExecuteFlag:128,DssAccessRightFullControlFlag:255,DssAccessRightInheritable:536870912,DssAccessRightAudit:1073741824,DssAccessRightAuditInheritable:1610612736};(function(){mstrmojo.boxmodel=mstrmojo.provide("mstrmojo.boxmodel",{rangeIntersect:function E(J,H,I,G){if(J<I){return I<=H;}if(J>I){return J<=G;}return true;},px2Inches:function C(H,G){G=parseInt(G,10);return mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep).format(parseFloat((G/H.zf/H.dpi).toFixed(4)));},offset:function F(I,H){var L=I,G=0,K=0;while(I){G+=I.offsetLeft;K+=I.offsetTop;I=I.offsetParent;if(I===H){break;}}var J;for(J=L&&L.parentNode;J&&J!==H;J=J.parentNode){if(J.scrollTop){K-=J.scrollTop;}if(J.scrollLeft){G-=J.scrollLeft;}}return{left:G,top:K};},convert2px:function D(K,I){if(!/px$/.test(I)){var H=document.createElement("img"),G=H.style,J;G.zIndex=-1;G.left=I;K.appendChild(H);J=G.pixelLeft;K.removeChild(H);return J+"px";}return I;},getEdgeQuadrantByPoint:function B(I,H){var G=H.x-I.x,M=H.y-I.y,J=I.w,L=I.h,K=[["Left","Bottom"],["Top","Right"]];if(M>L/J*G){K=K[0];}else{K=K[1];}return(M<-L/J*G+L)?K[0]:K[1];},isPtInPolygon:function A(I,K){var G=I.x,J=I.y,H=false;K.forEach(function(N,L){var M=K[L-1]||K[K.length-1];if((N.y>=J)!==(M.y>=J)){if((G<(M.x-N.x)*(J-N.y)/(M.y-N.y)+N.x)){H=!H;}}});return H;}});}());(function(){mstrmojo.DI.ProgressPolyfill=mstrmojo.provide("mstrmojo.DI.ProgressPolyfill",{createProgressPolyfill:function(){if("position" in document.createElement("progress")){return ;}var C,B=true;if(Object.defineProperty){C=function(L,J,I){I.enumerable=true;I.configurable=true;try{Object.defineProperty(L,J,I);}catch(K){if(K.number===-2146823252){I.enumerable=false;Object.defineProperty(L,J,I);}}};}else{if("__defineSetter__" in document.body){C=function(K,J,I){K.__defineGetter__(J,I.get);if(I.set){K.__defineSetter__(J,I.set);}};}else{C=function(K,J,I){K[J]=I.get.call(K);};B=false;}}try{[].slice.apply(document.images);var A=function(I){return[].slice.apply(I);};}catch(G){var A=function(L){var J=[],I=L.length;for(var K=0;K<I;K++){J[K]=L[K];}return J;};}var F=(function(){var I=document.createElement("div");I.foo="bar";return I.getAttribute("foo")==="bar";})();var D=window.ProgressPolyfill={DOMInterface:{max:{get:function(){return parseFloat(this.getAttribute("aria-valuemax"))||1;},set:function(I){this.setAttribute("aria-valuemax",I);if(!F){this.setAttribute("max",I);}D.redraw(this);}},value:{get:function(){return parseFloat(this.getAttribute("aria-valuenow"))||0;},set:function(I){this.setAttribute("aria-valuenow",I);if(!F){this.setAttribute("value",I);}D.redraw(this);}},position:{get:function(){return this.hasAttribute("aria-valuenow")?this.value/this.max:-1;}},labels:{get:function(){var I=this.parentNode;while(I&&!/^label$/i.test(I.nodeName)){I=I.parentNode;}var K=I?[I]:[];if(this.id&&document.querySelectorAll){var J=A(document.querySelectorAll('label[for="'+this.id+'"]'));if(J.length){K=K.concat(J);}}return K;}}},redraw:function H(I){if(!D.isInited(I)){D.init(I);}else{if(!F){I.setAttribute("aria-valuemax",parseFloat(I.getAttribute("max"))||1);if(I.hasAttribute("value")){I.setAttribute("aria-valuenow",parseFloat(I.getAttribute("value"))||0);}else{I.removeAttribute("aria-valuenow");}}}if(I.position!==-1){I.style.paddingRight=I.offsetWidth*(1-I.position)+"px";}},isInited:function(I){return I.getAttribute("role")==="progressbar";},init:function(I){if(D.isInited(I)){return ;}I.setAttribute("role","progressbar");I.setAttribute("aria-valuemin","0");I.setAttribute("aria-valuemax",parseFloat(I.getAttribute("max"))||1);if(I.hasAttribute("value")){I.setAttribute("aria-valuenow",parseFloat(I.getAttribute("value"))||0);}for(var J in D.DOMInterface){C(I,J,{get:D.DOMInterface[J].get,set:D.DOMInterface[J].set});}D.redraw(I);},progresses:document.getElementsByTagName("progress")};for(var E=D.progresses.length-1;E>=0;E--){D.init(D.progresses[E]);}if(document.addEventListener){document.addEventListener("DOMAttrModified",function(I){var K=I.target,J=I.attrName;if(/^progress$/i.test(K.nodeName)&&(J==="max"||J==="value")){D.redraw(K);}},false);document.addEventListener("DOMNodeInserted",function(I){var J=I.target;if(/^progress$/i.test(J.nodeName)){D.init(J);}},false);}}});})();(function(){var K="FULLCONNECTION",L="MSTR_CUSTOM";function M(Q,O){var S=mstrmojo.string;Q=S.trim(Q);var R=/\(\d+\)$/,P=R.exec(Q);if(P){O.v=parseInt(Q.substring(P.index+1,Q.length-1),10);return S.trim(Q.substring(0,P.index));}return Q;}function J(Q){if(Object.keys){return Object.keys(Q).length;}var O,P=[];for(O in Q){if(Q.hasOwnProperty(O)){P.push(O);}}return P.length;}function B(R){var O="KrbRealm",Q="KrbHostFQDN",P="KrbServiceName";return R.indexOf(O)>=0&&R.indexOf(Q)>=0&&R.indexOf(P)>=0;}mstrmojo.warehouse.dbroles.DBRoleHelper=mstrmojo.provide("mstrmojo.warehouse.dbroles.DBRoleHelper",{isNumeric:function A(O){return !isNaN(parseFloat(O))&&isFinite(O);},getUniqueName:function F(V){V=M(V,{});var Y=mstrApp.rootController.getDBRoles(),Q=mstrApp.rootController.isCloud(),S=mstrApp.rootController.getAllDBRoleNames(),X,U=0,W={},R=0,O=V,P=function(Z){O=V;if(Q){X=M(Z.des,W);}else{X=M(Z.n,W);}R=Math.max(R,W.v)||0;if(X.toString().toUpperCase()===O.toString().toUpperCase()){U=R+1;}};do{if(!Q){mstrmojo.hash.forEach(S,P);if(U===0){mstrmojo.array.forEach(Y,P);}}else{mstrmojo.array.forEach(Y,P);}if(U>0){O=V+" ("+U+")";}}while(mstrApp.rootController.findinArray(Y,"n",O)>=0);return O;},cleanDSNConnection:function E(O){O=mstrmojo.string.trim(O).replace(/\\/g,"\\\\");O=this.cleanDSNConnectionPlaceHolders(O);O=O.replace(/\\/g,"^^^789^^^");O=O.replace(/:/g,"!!!789!!!");O=O.replace(/,/g,"%%%789%%%");O=O.replace("\\","###789###");O=O.replace(/{/g,"+++789+++");O=O.replace(/}/g,"@@@789@@@");O=O.replace("FULLCONNECTION=","");return O;},cleanDSNConnectionPlaceHolders:function E(O){O=O.replace(/!#AT#!/g,"@");O=O.replace(/!#QUESTION#!/g,"?");O=O.replace(/!#AND#!/g,"&");O=O.replace("!#DRIVERSUFFIX#!","");return O;},cleanLoadedDSNConnection:function C(P,O){var Q;P=mstrmojo.string.trim(P);if(O===19||O===0){Q=P.split(";");mstrmojo.array.forEach(Q,function(S,R){if(S.search(/^\s*DBQ=/)===-1){Q[R]=S.replace(/\\\\/g,"\\");}});P=Q.join(";");}else{P=P.replace(/\\\\/g,"\\");}P=P.replace(/\?/g,"!#QUESTION#!");P=P.replace(/&/g,"!#AND#!");return P;},driverAvailable:function I(O){if((O.str.indexOf(K)===0)&&(O.driver===""||O.driver==="XQUERY")){return true;}return(mstrmojo.array.find(this.drivers,"nU",O.driver.toUpperCase())>=0);},driverExists:function G(Q){var U=this,R=false,S="",P=0,O=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.array.forEach(Q,function(W,V){if(O.driverAvailable.call(U,W)){R=true;S=W.driver;P=V;}return !R;});return{exists:R,driver:S,idx:P};},cleanDriver:function H(P){var R="DRIVER=",O=P.toUpperCase().indexOf(R),Q="";if(O>=0){O+=R.length;Q=P.substring(O,O+P.substring(O).indexOf(";"));Q=Q.replace(/([\{\}])+/g,"");}return Q;},isCustomConnection:function N(O){return(O.indexOf(L)>=0);},showHelp:function D(O){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(O);}else{window.open(mstrmojo.helpPath()+(O||""),"_blank");return false;}},extractParams:function(S,m){var o=mstrmojo.array,e=mstrmojo.string,b=this,d="XQUERY",V="@",P,j,k="",Z="",g=[],w="",R={},l=/[,:]/g,Y=0,n=/[\x28\x29\x3B\x7D]|(!#)/g,u,f="",a=/[\x29\x3B\x7D\/!]/g,c=b.cleanDriver(m),p,O={},t=0,q=0,Q=[],X=[],U=/@[^\x29\x3B\x7D\/!]+:@[^\x29\x3B\x7D\/!]+[\x29\x3B\x7D\/!]/g,W=S.length,h=0;o.forEach(S,function(z){P=z.str;g=[];R={};p=b.cleanDriver(P);Y++;P=P.replace(U,function(AB){return AB.replace(/:@/,":");});if(P.indexOf(K)===0){if(z.driver===d){Z=P.replace(K+"="+d+";"+V,"");var AA=m.indexOf(";;");if(AA>=0){m=m.substring(0,AA+1);}R[Z]=m.replace(d+";","");O=R;q=J(R);return false;}P=P.replace(K+"=",";");}if(!e.startsWith(c.toUpperCase(),p.toUpperCase())&&!e.startsWith(p.toUpperCase(),c.toUpperCase())){h++;if(h===W){O.noDriverMatched=true;}return true;}do{j=P.indexOf(V);k=P.substring(0,j);n.lastIndex=0;while(n.test(k)){j=n.lastIndex;}Z=e.trim(k.substring(j));P=P.replace(k,"").replace(V,"");a.test(P);u=a.lastIndex-1;f=P[u];a.lastIndex=1;w=P.substring(0,u).replace("@","");g.push({key:w,token:Z,endoftokenChar:f});}while(P.indexOf(V,u)>0);X[Y]=g.length;Q[Y]=0;var x;o.forEach(g,function(AF,AB){x=AF.token;AB=m.toUpperCase().indexOf(x.toUpperCase());if(AB>-1){AB+=x.length;n.lastIndex=0;var AE=m.substring(AB);var AD=n.exec(AE);if(x==="DBQ="&&m.indexOf("Microsoft Access Driver")>-1){AD=/[\x3B\x7D]|(!#)/g.exec(AE);}if(AD){var AH=AE.substring(0,AD.index);if(AE[AD.index]!==AF.endoftokenChar&&AH.length){if(AH[AH.length-1]===AF.endoftokenChar){AH=AH.substring(0,AH.length-1);}}l.test(AH);var AC=AH.substring(l.lastIndex-1,l.lastIndex)||",",AI=AF.key.split(AC),AG=AH.split(AC);if(AI.length===AG.length){o.forEach(AI,function(AJ,AK){R[AJ]=AG[AK];Q[Y]++;});}else{R[AF.key]=AH;}}}});if(J(R)>q||((J(R)===q)&&(X[Y]===Q[Y]))){O=R;q=J(R);t=Y;}return true;});if(B(m)){t=1;}O["RB"+t]=true;O.matchIndex=t-1;return O;},getSelectedDBPSection:function(Q,S){if(!Q||!Q.length){return null;}if(!S){return Q[0];}var O=0,P=0,R=Number.MAX_VALUE;mstrmojo.array.forEach(Q,function(W,U){var V=0;mstrmojo.array.forEach(W.DBP,function(X){if(X.field in S){V++;}});if(V>P||(V===P&&W.DBP.length<R)){P=V;O=U;R=W.DBP.length;}});return Q[O];},getFallbackDB:function(W,X){var P=mstrmojo.hash,R="JDBC",U=new RegExp(R+"$"),S,O,Q,V;W=Number(W);P.forEach(X,function(Z,Y){if(Z===W){S=Y;return false;}});if(!S){return false;}if(U.test(S)){V=true;O=S.replace(U,"");}else{V=false;O=S+R;}Q=X[O];return Q===undefined?false:{jdbc:!V,dbID:Q};}});}());(function(){mstrmojo.requiresDescs(9380,9381,9382,9383,9384,9385,9379,15106,15107,10639,10159,9705,9704);mstrmojo.DI.DIConstants=mstrmojo.provide("mstrmojo.DI.DIConstants",{invalidObjectNameChars:'\\"[]',invalidObjectNameCharsRegex:/[\\"\[\]]/,sourceItemLinkType:{dbList:0,oauthPara:1},setDefaultOAuthParamCMD:"MSTR_DEFAULT_OAUTH_PARAMS",actions:{none:0,importSource:1,editImport:2,transform:3,changeSheet:4,publish:5,changeMappings:6,refine:7,quickPreview:8,savePublish:9,getFlatPreview:10,refreshData:11,mergeCube:12},localStorageKey:{HGOSFileTypeTooltipPop:"HGOSFileTypeTooltipPop"},requestFlag:{mapping:1,preview:2,sourceInfo:4,refineSourceInfo:8,sheets:16,crb:32,transformations:64,transformedPreview:128,relationship:256,stateInfo:512,anyState:268435456,fullData:1024,refineInnerData:2048},formMappingFlag:{formMappingFlagReserved:0,formMappingFlagRemoveGeoRole:1,formMappingFlagRemoveTimeRole:2,formMappingFlagRemoveDeriveFlags:4},browseFlag:{reportBindingTable:1,dataPreview:4,publish:16,cubeConfig:68,reportLevelProperty:256},importBehaviorFlag:{reserved:0,newColumnsSilent:1,dataTypeSilent:2},saveAsFlags:{saveAsOverWrite:32,saveAsManaged:524288,saveAsDDA:33554432,saveAsInMemory:67108864,saveAsWithPrompts:4096,saveAsWithAnswers:4},connectLiveSupport:{connectLiveSupportUnknown:0,connectLiveSupportDDAOrInMemory:1,connectLiveSupportInMemoryOnly:2,connectLiveSupportDDAOnly:3},xdaType:{excel:272,text:288,refine:384,salesforce:337,querybuilder:352,ffsql:304,mdx:2,customFreeFormSQL:3,googleAnalytics:390,googleBigQuery:341,googleBigQueryFFSQL:342,googleBigQuerySingleTable:345,qbSingleTable:368,twitter:343,facebook:344,dataImport:256,projectsImport:400,sparkDataset:416,dataImportFileExcel:16|256,dataImportFileText:32|256,dataImportCustomSQL:48|256,dataImportTable:64|256,dataImportOAuth:80|256,dataImportBISource:144|256,dataImportOAuthSalesforce:1|336,dataImportOAuthGDocs:2|336,dataImportOAuthGDrive:2|336,dataImportOAuthDropbox:3|336,dataImportOAuthGAnalytics:4|336,dataImportOAuthGBigQuery:5|336,dataImportOAuthGBigQueryFFSQL:6|336,dataImportOAuthGBigQuerySingleTable:9|336,spark:160|256},fileTypes:[{n:"CSV/TXT",v:"CSV"},{n:"PARQUET",v:"PARQUET"},{n:"AVRO",v:"AVRO"},{n:"ORC",v:"ORC"},{n:"JSON",v:"JSON"},{n:"PARQ",v:"PARQUET",visible:false}],sourceInfoDesc:{json:"DB_FILE_TYPE_JSON"},sourceType:{file:1,salesforce:2,dropbox:3,googleDrive:4,googleAnalytics:5,googleBigQuery:6,querybuilder:7,mstrFile:8,mdx:9,hadoop:10,twitter:11,facebook:12,bisource:13,remoteProject:14,importfromcube:15,dataFromPushApi:16,newConnector:17,cloudElement:18},sourceSubtype:{localFile:1,url:2,salesforce:3,dropbox:4,googleDrive:5,googleAnalytics:6,googleBigQuery:7,querybuilder:8,samplefile:9,clipboard:10,googleBigQueryFFSQL:11,searchOnSource:12,mdx:13,hadoop:14,twitter:15,facebook:16,bisource:17,remoteProject:18,googleBigQuerySingleTable:19,hanaSingleTable:20,publicData:21,importfromcube:22,dataFromPushApi:23,cloudElement:24,},backendSourceSubtype:{localFile:65537,url:65539,samplefile:65540,clipboard:65538,newConnector:65544,cloudElement:65552,hadoopFileBrowser:65541,customSQL:131073,customSQLWizard:131074,singleTable:131075,bISources:131076,searchAsASource:131078,salesforce:196609,dropbox:196610,facebook:196611,twitter:196612,googleDrive:196613,googleAnalytics:196614,googleBigQuery:196615,googleBigQueryFFSQLModel:196616,googleBigQuerySingleTable:196617,OLAPSources:327681,publicData:65542,dataFromPushApi:65543,dataFromPushApiV2:65545,cloudElement:65552,},sourceItemType:{file:0,url:1,database:2,hadoop:3,olap:4,publicData:5,salesforce:6,googleAnalytics:7,googleBigQuery:8,googleDrive:9,dropbox:10,searchAsASource:11,clipboard:12,bISources:13,facebook:14,twitter:15,samplefile:16,importFromCube:17,addNewConnector:18,newConnector:19,cloudElement:20,unknow:-1},columnState:{reserved:0,unchanged:1,newColumn:2,missing:4,changed:8},operationMode:{create:0,edit:1,refresh:2,subscribe:3,enterCredentials:4,oauth:5,pickTable:6,hadoopPickTable:7,ffsql:8,hadoopFFsql:9},statusCode:{obtainSource:-2147071874,xformsError:-2147071872,mappingError:-2147071871,edit:1,republish:2,schedule:3,enterCredentials:4,pickTable:5,hadoopPickTable:6,ffsql:7,hadoopFFsql:8},pageType:{intro:0,file:1,database:2,emmaPreview:3,redirect:4,analytics:5,dataSelection:6,suggestNewSource:7,sourceIntro:8,sourceObjects:10,sampleFiles:11,dataset:12,externalPage:13,preview:14,clipboard:15,refine:16,parse:17,mstrFile:18,allProjectSource:19,hadoop:20,twitter:21,facebook:22,sourceObjectsDnD:23,schedule:24,publicData:25,republish:26,sourceAdmin:27,importFromCube:28,addNewConnector:29,newConnector:30,addConnectorList:31,cloudElement:32},backendError:{overwriteObject:-2147212339,noPermission:-2147214579,invalidObjectName:-2147213715,unexpectedDataType:-2147212539,noExternalSession:-2147071844,noPrivilege:-2147212082,salesforceUnsavedReport:-2147212081,salesforceObsoleteReport:-2147212080,maxSizeExceeded:-2147212076,maxSizeExceededURL:-2147212121,salesforceUnresolvedFilter:-2147212074,incrementalRefresh:-2147212287,invalidUrl:-2147212062,fileVersionError:-2147212064,emptySheet:-2147212144,refreshTokenUnavailable:-2147202875,cubeQuotaExceeded:-2147071825,notEnoughSpace:-2147071811,importedURLInvalid:-2147212122,unsupportedFileFormat:-2147212063,objectNameTooLong:-2147217407,noExternalSourceInfo:-2147215346,memoryConsumptionExceeded:-2147215346,cubeQuotaReached:-2147071870,switchingFileType:-2147212140,memoryGovernSizeExceeded:-2147181051,stringTooLong:-2147213718,missingColumn:-2147071871,dataDiscoveryError:-2147211998,refineApplyError:-2147202299,serverOutOfMemory:-2147212055,columnCountMatchError:-2147467259,incompatibleDataTypeError:-2147211983,reportTimeout:-2147212335,requestTimeout:-2147206497,databaseCredentialsNotAvailable:-2147212037,ddasupportIncompatible:-2147215326,mergeInvalidXdatype:-2147215325,notFullyControl:-2147214579,shouldBeIgnored:-2147212123,CECredentialNotAvailable:-2147215317,AuthenticationError:-2147215346,queryEngineGeneralError:-2147212544},transformation:{xtab:1,delimiter:2},application:{platform:"Platform",cloudPersonal:"Personal",cloudProfessional:"Professional"},refreshOptions:{replace:1,append:2,update:4},cubeRefreshType:{dummy:-1,reserved:0,add:1,remove:2,update:3,upsert:4,addNewTable:5,deleteTable:6,replaceTable:7,preserve:8},tableStatsExecutionAction:{reserved:0,forceExecution:1,ignore:4,requireFreshData:268435456},sourcesInfoFlags:{none:0,getReports:1,getUserName:2,getTokensInfo:4,revokeSession:8,getGAnalyticsAccount:64},queryBuilderType:{individualTable:1,multipleTables:2,queryScript:3},relationshipEditType:{create:1,changeERType:2,remove:3,flip:8001},ERType:{reserved:0,ERType11:1,ERType1M:2,ERTypeM1:3,ERTypeMM:4,ERTypeParallel:5,ERTypePerpendicular:6},RSType:{reserved:0,auto:1,geo:2,defined:3},tableStates:{newly:1,old:2},behaviorChangeFlag:{multiSheet:4,remapping:8,refreshData:16},menuItems:{SEPARATOR:-1,NONE:0,TABLE_RENAME:1,DO_NOT_IMPORT:2,FLIP_ORDER:3,DELETE:4,RELATIONSHIP_TYPE:5,ONE_TO_ONE:6,ONE_TO_MANY:7,MANY_TO_ONE:8,MANY_TO_MANY:9,REMOVE:10,REFRESH_DATA:11,REFINE:12,CANCEL_REFINE:13,UNLINK:14,CHANGE_DATA_TYPE:15,MARK_GEO_ROLES:16,CREATE_TIME_ATTRIBUTES:17,TO_METRIC:18,TO_ATTRIBUTE:19,MAP_TO_PROJECT_ATTRIBUTE:20,UNMAP:21,MODIFY_ATTRIBUTE_GROUP:22,CREATE_ATTRIBUTE_GROUP:23,HIDE_ALL_ATTRIBUTE_FORMS:24,DEFINE_RELATIONSHIPS:25,LINK:26,ITEM_RENAME:27,CREATE_MULTIFORM_ATTRIBUTE:28,EDIT_MULTIFORM_ATTRIBUTE:29,ADDTO_MULTIFORM_ATTRIBUTE:30,SHOW_ALL_ATTRIBUTE_FORMS:31,SHOW_ALL_COLUMNS:32,PARTITION:33,REFINE_RENAME:34,REFINE_DELETE:35,REFINE_DELETE_ALL:36,REFINE_RESET:37,REFINE_RESET_ALL:38,PARSE:39,IMPORT:40,UNLINK_ALL:41,CREATE_HIERARCHY_ATTRIBUTE:42,EDIT_HIERARCHY_ATTRIBUTE:43,RESET_HIERARCHY_ATTRIBUTE:44},dataTypeMenuItems:{DATE_TIME:"1",NUMBER:"2",TEXT:"3",URL:"5",EMAIL:"6",HTML_TAG:"7",DATE:"8",TIME:"9",SYMBOL:"10",BIG_DECIMAL:"11",PHONE_NUMBER:"12"},columnDataTypes:{reserved:0,integer:1,unsigned:2,numeric:3,decimal:4,real:5,dtdouble:6,dtfloat:7,dtchar:8,varChar:9,longVarChar:10,binary:11,varBin:12,longVarBin:13,date:14,dttime:15,timeStamp:16,nChar:17,nVarChar:18,nlong:22,bigDecimal:30,cellFormatData:31,utf8Char:33,int64:34},formsOptions:{CREATE_MULTIFORM_ATTRIBUTE:1,EDIT_MULTIFORM_ATTRIBUTE:2,ADDTO_MULTIFORM_ATTRIBUTE:3},hierarchyOptions:{CREATE_HIERARCHY_ATTRIBUTE:1,EDIT_HIERARCHY_ATTRIBUTE:2,RESET_HIERARCHY_ATTRIBUTE:3},rdcsFlag:{ID:1,JOIN_ID:2,FILTER_ID:3,DISTANCE:4},timeRoles:{NONE:0,DATE:1,DATE_TIME:2,TIME:3,SECOND:4,MINUTE:5,HOUR:6,DAY:7,WEEK:8,MONTH:9,QUARTER:10,YEAR:11},contextMenuType:{ITEM_MENU:0,TABLE_MENU:1,PREVIEW_ITEM_MENU:2,LINK_MENU:3},dialogType:{fixRefreshErrorDialog:1,allObjectsViewDialog:2,missingColumnsDialog:3,diPageDialog:4,refreshHistoryDialog:5,alternateSourceValidateDialog:6,ddaConfirmDialog:7,publishStatusDialog:8,saveAsDialog:9,cubesList:10,refinePage:11,multiFormEditor:12,sheetsSelectionDialog:13,partitionGroupDialog:14,parseDataDialog:15,errorDialog:16,warningDialog:17,relationDefineDialog:18,qbImportOptionDialog:19,previewRenameDialog:20,mapProjectsAttributeDialog:21,setOAuthParaDialog:22,objectPicker:23,refineClusteringPage:24,refineExtractDialog:25,refineImportDialog:26,twitterAdvOptDialog:27,credentialsDialog:28,mapProjectsAttributeDialog2:29,setWhiteListDialog:30,binaryUploadDialog:31,authenticationDialog:32,sharingDialog:33,hadoopGatewayManagerDialog:34,hadoopGatewayDialog:35,addConnectorDialog:36,hierarchyAttributeDialog:37,hierarchyAttributeResetDialog:38},dataEvents:{DATA_PREVIEW_EVENT:"dataReturned",NO_DATA_RETURNED_EVENT:"noDataReturned"},cubeSchedStatus:{unexecuted:1,successful:2,unscheduled:3,failed:4},privilegeType:{accessDatabase:1,accessFile:2,accessCloud:3},dbType:{MS_ACCESS:100,ORACLE:200,SQL_SERVER:300,INFORMIX:400,SYBASE:500,REDBRICK:600,DB2:700,TANDEM:800,TERADATA:900,UNKNOWN:1000,GENERIC:1100,SAP:1200,NETEZZA:1300,EXCEL:1400,MSFT_AS:1500,ESSBASE:1600,MYSQL:1700,POSTGRESQL:1800,HPNEOVIEW:1900,METAMATRIX:2000,DATALLEGRO:2100,COMPOSITE:2200,ASTER:2300,VERTICA:2400,OPENACCESS:2500,SYBASE_SQL_ANY:2600,SYBASE_IQ:2700,PARACCEL:2800,TM1:2900,XQUERY:3000,HIVE:3100,SAND:3200,SALESFORCE:3300,HIVETHRIFT:3400,VECTORWISE:3500,ENTERPRISEDB:3600,KOGNITIOWX2:3700,EXASOLUTION:3800,INFORMATICA:3900,SAPHANA:4000,IMPALA:4100,AMAZON_REDSHIFT:4200,DENODO:4300,GOOGLE_DRIVE:4400,DROPBOX:4500,GOOGLE_ANALYTICS:4600,GOOGLE_BIGQUERY:4700,CONNECTION_CLOUD:4800,GOOGLE_BIG_QUERY_FFSQL_MODEL:4900,PARSTREAM:5100,MONGODB:5200,MARKLOGIC:5300,BIG_DATA_ENGINE:5400,SEARCH_ENGINE_SOLR:5500,SPLUNK:5600,TWITTER:5700,FACEBOOK:5800,PIG:6400,URL:7700,newConnector:7900,LOACLFILE:8200},getCubeQuotaAndInfosOptions:{GetCubeQuotaAndInfosReserved:0,GetCubeQuotaAndInfosDefault:1,GetCubeQuotaAndInfosQuotaOnly:2,GetCubeQuotaAndInfosAll:3,GetCubeQuotaAndInfosVI:4},homepageViewMode:{GRID_VIEW:0,LIST_VIEW:1},datasetServeMode:{inMemory:1,dda:2,unknow:3},cubePollStatus:{msgID:0,result:1,prompt:2,error:3,xmlResult:21},ibmDb2Versions:[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232],hadoopDbTypes:[3100,1100,700,4100,7300,6800,6400,8100],formCategory:{longitude:"2345134F4F5E261C3BB902A874467080",latitude:"B191051C48221A6AE44CA2B65B1B65E3"},urlAuthDBRoles:{anonymous:"CB1CB472A07E41D5AE038232839F2064",windows:"95A5ACC02FE94CBABCB65E4F2D2415B2",kerberos:"317D6F016D784836A724AD4D739E1E9C",integrated:"E966E1A0A4C949108287B2E5086B68EB"},urlAuthDBMSId:"497F2406FA154B86810C71EA3D401D6D",newConnectorDBMSId:"565D5DC3A1124726B85FE53EF992472A",hadoopGateWay:{HGoS_CONFIG_HAS_EXIT:1510,CONNOT_AUTHENTICATE:1511,SPACE_OVER:1512,FAIL_COPY_TO_HOST:1513,INSUFFICIENT:1514,DIRECTORY_NO_EXIST:1515,HGOS_DEPLOYED:1518,HGOS_DEPLOYING:1519,CONNOT_AUTHENTICATE2:1520,HGOS_RUNNING:1521,HGOS_STOPPED:1522,HGOS_NOT_DEPLOYING:1523,HGOST_TAR_NOT_EXIST:1524,HGOS_CONF_NOT_EXIST:1530},workstation:{filerBreakLine:new RegExp("[\r\n]","g"),utils:{shouldShowTitleBar:function(){var A=mstrApp.getRootController().rootView.inPageDialog;return !!mstrApp.isWorkstation&&(!!mstrApp.isPopup||!!A);},setNativeWindow:function(C,F){var B=1110,E=590,D=parseInt(C,10),A=parseInt(F,10);if(!window.FormWrapper||!window.FormWrapper.setWindowFrame){return ;}if(C.match(/%$/)&&F.match(/%$/)){window.FormWrapper.setWindowContentSize(1200,680);}else{D=D<B?B:D;A=A<E?E:A;window.FormWrapper.setWindowContentSize(D,A);}},lockResize:function(){if(!window.FormWrapper||!window.FormWrapper.lockResize){return ;}window.FormWrapper.lockResize();},unlockResize:function(){if(!window.FormWrapper||!window.FormWrapper.unlockResize){return ;}window.FormWrapper.unlockResize();}}},authMode:{ANONYMOUS:0,USERNAME:1,OAUTH:2},authModePrefix:{ANONYMOUS:"AuthMode=Anonymous;URL=",USERNAME:"AuthMode=Basic;URL=",OAUTH:"AuthMode=OAuth;URL="},sdkUrl:{MARKPLACE_URL:"https://community.microstrategy.com/s/gallery?tabset-89baf=202df",QUICK_START_URL:"https://lw.microstrategy.com/msdz/MSDL/GARelease_Current/docs/projects/DataConnectorSDK/Content/topics/Quick_Start_Guide.htm"},originalConnector:{elastic:"DE4A8E15405A36D80BF1E1A2BA6F9B66",tapClicks:"1E8ADD3975DA4609B8D00E6211ACAB6A"},googleAnalyticsUrl:{queryExplorer:"https://ga-dev-tools.appspot.com/query-explorer/"},weekDay:[{n:mstrmojo.desc(9380,"Monday"),v:0},{n:mstrmojo.desc(9381,"Tuesday"),v:1},{n:mstrmojo.desc(9382,"Wednesday"),v:2},{n:mstrmojo.desc(9383,"Thursday"),v:3},{n:mstrmojo.desc(9384,"Friday"),v:4},{n:mstrmojo.desc(9385,"Saturday"),v:5},{n:mstrmojo.desc(9379,"Sunday"),v:6}],dateMon:[{n:mstrmojo.desc(15106,"1st day"),v:"1"},{n:mstrmojo.desc(15107,"15th day"),v:"15"}],timeOfDay:[{n:"12:00AM",v:"12:00AM"},{n:"1:00AM",v:"1:00AM"},{n:"2:00AM",v:"2:00AM"},{n:"3:00AM",v:"3:00AM"},{n:"4:00AM",v:"4:00AM"},{n:"5:00AM",v:"5:00AM"},{n:"6:00AM",v:"6:00AM"},{n:"7:00AM",v:"7:00AM"},{n:"8:00AM",v:"8:00AM"},{n:"9:00AM",v:"9:00AM"},{n:"10:00AM",v:"10:00AM"},{n:"11:00AM",v:"11:00AM"},{n:"12:00PM",v:"12:00PM"},{n:"1:00PM",v:"1:00PM"},{n:"2:00PM",v:"2:00PM"},{n:"3:00PM",v:"3:00PM"},{n:"4:00PM",v:"4:00PM"},{n:"5:00PM",v:"5:00PM"},{n:"6:00PM",v:"6:00PM"},{n:"7:00PM",v:"7:00PM"},{n:"8:00PM",v:"8:00PM"},{n:"9:00PM",v:"9:00PM"},{n:"10:00PM",v:"10:00PM"},{n:"11:00PM",v:"11:00PM"}],schedule:{DAILY:"Daily",WEEKDAY:"Weekday",WEEKLY:"Weekly",MONTHLY:"Monthly"},mainPage:{GRID_MODE:0,LIST_MODE:1},sourceIconClsName:{0:"ds-Generic",1:"ds-DB2",2:"ds-DB2",3:"ds-DB2",4:"ds-InformixWire",5:"ds-InformixXPS",6:"ds-PostgreSQL",7:"ds-SAP",8:"ds-SAP",9:"ds-Oracle",10:"ds-MicroSoft",11:"ds-Teradata",12:"ds-MySQL",13:"ds-GreenPlum",14:"ds-Netezza",15:"ds-WebServices",17:"ds-Infobright",18:"ds-Salesforce",19:"ds-MicroSoft",20:"ds-Actian-n",21:"ds-Amazon-Redshift",22:"ds-Impala",23:"ds-Aster",25:"ds-Actian-n",26:"ds-EnterpriseDB",27:"ds-Vertica",28:"ds-Denodo",29:"ds-CiscoDataVirtualization",31:"ds-MicroSoft",32:"ds-GoogleBigQuery",33:"ds-SAP",35:"ds-IBMBigInsights",39:"ds-TM1",41:"ds-WebServices",43:"ds-Amazon-EMR",44:"ds-Apache-Hive",45:"ds-ClouderaHive",46:"ds-HortonworksHive",47:"ds-MapRHive",48:"ds-apache",49:"ds-SharkSpark",50:"ds-MongoDB",52:"ds-MariaDB",51:"ds-MarkLogic",54:"ds-Splunk",55:"ds-DataDirectCloud",56:"ds-ParStream",58:"ds-Phoenix",59:"ds-MicroSoft",60:"ds-DB2",61:"ds-Oracle",62:"ds-Teradata",63:"ds-SAP",65:"ds-PostgreSQL",66:"ds-MySQL",67:"ds-MariaDB",68:"ds-Amazon-EMR",69:"ds-Apache-Hive",70:"ds-ClouderaHive",71:"ds-HortonworksHive",72:"ds-MapRHive",73:"ds-SharkSpark",75:"ds-Amazon-Redshift",76:"ds-PIVOTALHAWQ",77:"ds-MemSQL",78:"ds-Arcadia-Platform",79:"ds-Altibase",80:"ds-MongoDB",81:"ds-Presto",82:"ds-DB2",83:"ds-DB2",84:"ds-InformixWire",85:"ds-SAP",86:"ds-MicroSoft",87:"ds-MicroSoft",88:"ds-MemSQL",90:"ds-GreenPlum",91:"ds-PIVOTALHAWQ",92:"ds-Netezza",93:"ds-Infobright",94:"ds-Actian-n",95:"ds-Impala",96:"ds-IBMBigInsights",97:"ds-Aster",99:"ds-Actian-n",100:"ds-EnterpriseDB",101:"ds-Vertica",102:"ds-Denodo",103:"ds-CiscoDataVirtualization",105:"ds-DataDirectCloud",106:"ds-ParStream",107:"ds-Arcadia-Platform",109:"ds-Presto",110:"ds-Phoenix",111:"ds-Kognitio",112:"ds-Kognitio",113:"ds-Informatica",114:"ds-Informatica",115:"ds-Apache-Cassandra-JDBC",116:"ds-SAP",117:"ds-Actian",118:"ds-Actian",119:"ds-InformixXPS",120:"ds-Apache-Cassandra-JDBC",121:"ds-MapRDrill",122:"ds-Cirro",123:"ds-EXASolution",124:"ds-EXASolution",125:"ds-Oracle",126:"ds-Oracle",127:"ds-Snowflake",128:"ds-Snowflake",129:"ds-Amazon-Aurora",130:"ds-Amazon-Aurora",131:"ds-Amazon-Athena",132:"ds-Amazon-Athena",133:"ds-MapRDrill",134:"ds-Druid",135:"ds-Druid",139:"ds-MongoBI",157:"ds-GoogleBigQuery",161:"ds-MapD",168:"ds-HortonworksSpark",169:"ds-HortonworksSpark",170:"ds-Yellowbrick",},dispTag:{1:"Database",2:"OLAP",4:"BigData",8:"Database",16:"BigData",32:"BigData"},searchTags:{100:["Database","ODBC"],200:["Database","ODBC"],300:["Database","ODBC"],400:["Database","ODBC"],500:["Database","ODBC"],600:["Database","ODBC"],700:["Database","ODBC"],900:["Database","ODBC"],1100:["Database","ODBC"],1200:["OLAP","Cube"],1300:["Database","ODBC"],1400:["Database"],1500:["OLAP","Cube"],1600:["OLAP","Cube"],1700:["Database","ODBC"],1800:["Database","ODBC"],2200:["Database","ODBC"],2300:["Database","ODBC"],2400:["Database","ODBC"],2800:["Database","ODBC"],2900:["OLAP","Cube"],3000:["Database"],3100:["Database","BigData","Hadoop"],3300:["Cloud"],3500:["Database","ODBC"],3600:["Database","ODBC","BigData"],3800:["Database"],3900:["Database"],4000:["Database","ODBC"],4100:["Database","BigData","Hadoop"],4200:["Database","ODBC"],4300:["Database","ODBC"],4700:["Database","Cloud","BigData"],4800:["Cloud"],5200:["Database","NoSQL"],5300:["Database","NoSQL"],5400:["Hadoop"],6400:["Database","BigData","Hadoop"],6600:["Database"],6700:["Database"],6800:["BigData"],6900:["BigData"],7100:["NoSQL"],7200:["Database"],7300:["BigData","Hadoop"],7500:["Database"],7600:["Database"],8000:["Database"],8100:["BigData"],},srcItemTypes:{ALL_SOURCES:"ALL_SOURCES",STATIC_SOURCE:"STATIC_SOURCE",DBTYPE_SOURCE:"DBTYPE_SOURCE",CUSTOM_CONNECTOR:"CUSTOM_CONNECTOR",CLOUDELEMENT_CONNECTOR:"CLOUDELEMENT_CONNECTOR"},combination:{BigData:["BigData","NoSQL","Search","Hadoop"],Apps:["Apps","oAuth","Cloud","Social","BI","PublicData","CE"]},GenericDBStr:"Generic",dataSourceType:{MONGODB:"mongodb",FILE_URL:"fileUrl",FILE_LOCAL:"fileLocal",ES:"elasticsearch",DROPBOX:"dropbox",GOOGLE_DRIVE:"googleDrive",GOOGLE_ANALYTICS:"googleAnalytics",GOOGLE_BIGQUERY:"googleBigQuery",SALESFORCE:"salesforce",FILE:"file",GENERIC_JDBC:"genericJdbc"},ERDF:{ENUM_LOAD_REPORT_BROWSE_TYPE_BINDINGTABLE:1,ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW:4,ENUM_LOAD_REPORT_BINDING_FLAG_ALL:15,ENUM_LOAD_REPORT_PREVIEW_FLAG_MappingInfo:1,ENUM_LOAD_REPORT_PREVIEW_FLAG_DataInfo:2,ENUM_LOAD_REPORT_PREVIEW_FLAG_SourceInfo:4,ENUM_LOAD_REPORT_PREVIEW_FLAG_InnerDataInfo:2048,},DSSSubType:{DSSSUBTYPEATTRIBUTE:3072,DSSSUBTYPEATTRIBUTEROLE:3073,DSSSUBTYPEATTRIBUTETRANSFORMATION:3074,DSSSUBTYPEATTRIBUTEABSTRACT:3075,DSSSUBTYPEATTRIBUTERECURSIVE:3076},DSSExType:{DSSEXDISPARK:416},URLMode:{NormalUrl:0,NewConnector:1,NewConnectorEdit:2,CloudElement:3},disableFeatures:{DISABLE_CUSTOM_CONNECTOR:"disableCustomerConnector",DISABLE_DDA:"disableDDA",DISABLE_QUOTA:"disableQuota",DISABLE_HADOOP:"disableHadoop",DISABLE_BI_TOOLS:"disableBITools",DISABLE_CLIP_BOARD:"disableClipboard",DISABLE_FACE_BOOK:"disableFacebook",DISABLE_TWITTER:"disableTwitter",DISABLE_SAMPLE_FILES:"disableSampleFiles",DISABLE_PUBLIC_DATA:"disablePublicData",DISABLE_MERGE_CUBE:"disableMergeCube",DISABLE_CE_SOURCE:"disableCESource",DISABLE_FLATTERN_DB_SOURCE:"disabledSources"},DssXmlPrivileges:{DssXmlPrivilegesUseDatabaseInstanceManager:57},Enum_SourceCategoryType:{File:1,BigData:2,Database:3,OLAP:4,Customized:5,Apps:6,}});}());(function(){mstrmojo.vi.models.OneTierServerTransport={serverRequest:function A(F,E,D){var C=window.FormWrapper;if(C){C.serverRequest(E,JSON.stringify(D.params),F,"response");}else{window.console.log(E,JSON.stringify(D.params),F,"response");}},cancelRequest:function B(C){return false;}};}());mstrmojo.VisEnum={ControlType:{BUTTON:"button",LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",SPLITTER:"splitter",GM_ROW_HEADER:"rh",GM_ROW_HEADER_TEXT:"rhtext",GM_ROW_HEADER_EXTRA:"rhext",GM_COL_HEADER:"ch",GM_COL_HEADER_TEXT:"chtext",GM_COL_HEADER_EXTRA:"chext",GM_YAXIS:"y",GM_XAXIS:"x",GM_YLABEL:"y-label",GM_XLABEL:"x-label",GM_ROW_HEADER_TITLE:"rht",GM_ROW_HEADER_TITLE_TEXT:"rhttext",GM_COL_HEADER_TITLE:"cht",GM_COL_HEADER_TITLE_TEXT:"chttext",GM_MINI_CHART:"chart",GM_TEXT_BODY:"text-body",GM_SHAPE:"shape",GM_MARKER:"marker",GM_SET_SHAPE:"set-shape",GM_YAXIS2:"y2",GM_XAXIS2:"x2",GM_TREND_LINE:"trendLine",GM_TREND_LINE_HOVER:"trendLineHover",GM_TREND_LINE_SELECT:"trendLineSelect",GM_REF_LINE:"referenceLine",GM_REF_LINE_HOVER:"referenceLineHover",GM_REL_LINE_SELECT:"referenceLineSelect",GM_HIGHLIGHT_BOX:"highlight-box",GM_AXIS_TEXT:"axis-text",GM_AXIS_WORD:"axis-word",GM_SVG_X_NUMERIC:"svg-x-numeric",GM_SVG_X_CATEGORY:"svg-x-category",GM_SVG_Y_NUMERIC:"svg-y-numeric",GM_SVG_Y_CATEGORY:"svg-y-category",GM_X_NUMERIC:"x-numeric",GM_X_CATEGORY:"x-category",GM_Y_NUMERIC:"y-numeric",GM_Y_CATEGORY:"y-category",GM_SVG_CHART:"svg-chart",GM_DATA_LABEL:"data-label",GM_YAXIS_LINE:"y-line",GM_XAXIS_LINE:"x-line",GM_YAXIS2_LINE:"y2-line",GM_XAXIS2_LINE:"x2-line",LGD_TITLE:"lgd-title",LGD_TEXT:"lgd-text",LGD_COLORBOX:"lgd-colorbox",LGD_COLORBOX_CTN:"lgd-colorbox-ctn",LGD_CANVAS:"lgd-canvas",LINE_CONTAINER:"line-ctn",GM_V_MATRIX_LINE:"v-line",GM_H_MATRIX_LINE:"h-line",GM_V_CHART_LINE:"v-ctline",GM_H_CHART_LINE:"h-ctline",GM_CHART_ROW:"ct-row",GM_CHART_COL:"ct-col",GM_H_GRID_LINE:"h-gline",GM_V_GRID_LINE:"v-gline",GM_H_MINOR_GRID_LINE:"h-gline-minor",GM_V_MINOR_GRID_LINE:"v-gline-minor",GM_ORIGIN_LINE:"originLine",GM_ORIGIN_LABEL:"origin-label",GM_ORIGIN_LINE_H:"origin-line-h",GM_ORIGIN_LINE_V:"origin-line-v",GM_ORIGIN_LABEL_H:"origin-label-h",GM_ORIGIN_LABEL_V:"origin-label-v",GM_DUMMY_A:"dummy-a",GM_V_EXTRA_LINE:"v-extra-line",GM_REF_LABEL:"ref-label",GM_RIGHT_BORDER:"border-r",GM_BOTTOM_BORDER:"border-b",KPI_V_SCROLLBAR:"kpi-vertical-scrollbar",KPI_H_SCROLLBAR:"kpi-horizontal-scrollbar"},GMDropZoneID:{ROWS:1,COLUMNS:2,XAXIS:3,YAXIS:4,BREAKBY:5,SLICEBY:6,COLORBY:7,SIZEBY:8,TOOLTIP:9,ANGLEBY:10},NETWORK_LOCAL_PROPS:{ZOOM_FACTOR:"zf",NODE_POSITION:"np"},NETWORK_PROPERTIES:{showLegend:"showLegend",showEdgeDirection:"showedgearrow",showTransition:"animatelayout",nodeSizeAggregation:"nodesizeaggfunc",minNodeSize:"minns",maxNodeSize:"maxns",themeType:"th",circleLabelFont:"BubFnt",modifiedNodes:"mn",layoutMode:"layout",legendPosition:"legendposition",dragMode:"mode",bubbleStyle:"bbs",propsCategory:"pc",lgdBgFillClr:"lgdBgFillClr",lgdBgFillTrans:"lgdBgFillTrans",lgdFntClr:"lgdFntClr",lgdFntSz:"lgdFntSz",lgdFntFml:"lgdFntFml",lgdFntStyle:"lgdFntStyle"},NETWORK_LAYOUT:{CIRCULAR:"circular",LINEAR:"linear",FORCE_DIRECTED:"forceDirected"},NETWORK_DRAG_MODE:{pan:0,select:1},NETWORK_AGGREGATION_METHOD:{"Count of":0,"Sum of":1,"Average of":2,"Min of":3,"Max of":4},NETWORK_MIN_NODE_SIZE_TYPE:{PROPORTIONAL:1,FULL_RANGE:2,ADJUSTED_RANGE:3},NETWORK_MAX_NODE_SIZE_TYPE:{AUTOMATIC:1,MANUAL:2},NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE:[0,0.2],HEATMAP_PROPERTIES:{showLegend:"showLegend",deleteButton:"ed",showMetricValues:"mv",labelSize:"lb",layout:"la",themeType:"th",headerType:"he",deletedList:"dl",refreshType:"rt",metricList:"ml",colorByType:"cbt",absoluteFixed:"abs",blendColor:"blc",background:"bg",legendBackground:"lbg",headerColors:"hcl",fonts:"fts",propsCategory:"pc",attrColorByOpacity:"acbo",metricColorByOpacity:"mcbo"},HEATMAP_LABEL_SIZE:{On:0,Off:1,Proportional:2},MAPS_PROPERTIES:{SHOW_LEGEND:"showLegend"},VIS_CARDLIMIT:{GRID:250,NON_GRID:8000,AREA_MAP:1000},GMLegendDataType:{COLOR_BY:1,SIZE_BY:2},GMLegendFormatingPropertyTag:{LEGEND_BG_COLOR:"lgdBgFillClr",LEGEND_BG_FILL_STYLE:"lgdBgFillStyle",LEGEND_BG_FILL_EFFECT:"lgdBgFillEff",LEGEND_BG_FILL_TRANSPARENCY:"lgdBgFillTrans",LEGEND_FONT_SIZE:"lgdFntSz",LEGEND_FONT_FAMILY:"lgdFntFml",LEGEND_FONT_STYLE:"lgdFntStyle",LEGEND_FONT_COLOR:"lgdFntClr",LEGEND_BORDER_SHOW:"lgdBdrShw",LEGEND_BORDER_COLOR:"lgdBdrClr",LEGEND_BORDER_THICKNESS:"lgdBdrThk",LEGEND_BORDER_LINE_STYLE:"lgdBdrStyle",LEGEND_BORDER_LINE_COMBINED_STYLE:"lgdBdrCmbStyle",COLOR_SQUARE_COLOR:"clrSqrClr"},LegendPropertyTag:{LEGEND_MODE:"lm",LEGEND_POSITION:"LegendPosition",SCALE_LEGEND_WIDTH:"lwr"},EnumLegendMode:{RESTORED:1,MINIMIZED:2},EnumSingleLegendMode:{RESTORE:1,COLLAPSE:2},EnumColorRankMode:{INVALID:-1,VALUE:0,TOP:1,BOTTOM:2,TOP_PERCENT:3,BOTTOM_PERCENT:4},FormNameDisplayType:{OFF:0,ON:1,FORM_NAME_ONLY:2,SHOW_ATT_NAME_ONCE:3,AUTO:4},SERVER_JSON_ERROR_TYPE:{EMPTY_DATA:0,NO_DATASET:1,AE_ERROR:2,NO_TEMPLATE_UNIT:3},NETWORK_CIRCLE_BORDER_WIDTH:8,IMAGELAYOUT_PROPERTIES:{DISPLAY_MODE:"mt",MAX_SIZE_TYPE:"ty",MAX_SIZE_VALUE:"val",MIN_SIZE_TYPE:"mst",MIN_SIZE_VALUE:"msv",MAP_FILE_PATH:"mf",SHAPE_FILL_OPC_PER:"shapeFillTrans",SHAPE_FILL_COLOR:"shapeClr",SHAPE_BORDER_STYLE:"shapeBorderCmbStyle",SHAPE_BORDER_COLOR:"shapeBorderClr",DATA_LABEL_SWITCH:"dls",DATA_LABEL_FONT_SIZE:"dlFntSz",DATA_LABEL_FONT_FAMILY:"dlFntFml",DATA_LABEL_FONT_COLOR:"dlFntClr",DATA_LABEL_FONT_STYLE:"dlFntStyle",BLANK_MAP_BORDER_STYLE:"blankMapBorderStyle",BLANK_MAP_BORDER_COLOR:"blankMapBorderClr",BLANK_MAP_COLOR:"blankMapClr",DEFAULT_MAP_COLOR:"dftMapClr",DEFAULT_BUBBLE_COLOR:"dftBubbleClr",DEFAULT_MAP_BORDER_COLOR:"dftMapBorderClr",DEFAULT_BUBBLE_BORDER_COLOR:"dftBubbleBorderClr",LEGEND_FONT_SIZE:"lgFntSz",LEGEND_FONT_FAMILY:"lgFntFml",LEGEND_FONT_COLOR:"lgFntClr",LEGEND_FONT_STYLE:"lgFntStyle",LEGEND_BACKGROUND_COLOR:"lgBgClr",LEGEND_OPC_PER:"lgBgFillTrans",LEGEND_POSITION:"lgPos",LEGEND_SHOW:"lgShow",LEGEND_MODE:"lgMode",LEGEND_SCALE:"lgScale",H_MATRIX_LINE_COLOR:"hMatrixLnClr",V_MATRIX_LINE_COLOR:"vMatrixLnClr",ALL_MATRIX_LINE_COLOR:"allMatrixLnClr",H_MATRIX_LINE_STYLE:"hMatrixLnCmbStyle",V_MATRIX_LINE_STYLE:"vMatrixLnCmbStyle",ALL_MATRIX_LINE_STYLE:"allMatrixLnCmbStyle"}};mstrmojo.vi.enums.EnumFeatures={SUPPORT_RESPONSIVE:"support-responsive",SUPPORT_RESPONSIVE_RESIZING:"support-responsive-resizing",SUPPORT_GHOST_IMG:"support-ghost-img",SUPPORT_NLP:"use-natural-language",SUPPORT_CONDITION_METRIC:"support_condition_metric",USE_WORKSTATION_NAMING_STYLE:"use-workstation-naming-style",SUPPORT_TOC_UPDATEPOISITION:"support-toc-updatePosition",SUPPORT_LIVEMODE:"support-livemode",NUMBER_FORMATTING:"number-formatting",SAVE_ANALYSIS:"save-analysis",INSERT_NEW_METRIC:"insert-new-metric",DATA_ENGINE_VERSION:"data-engine-version",WEB_DRILL_AND_LINK:"web-drill-and-link",WEB_IMPORT_DATABASE:"web-import-database"};mstrmojo.vi.viz.EnumVisualizationTemplates={UNKNOWN_GRAPHMATRIX_TYPE:-1,GRID:0,HEATMAP:1,GOOGLEMAP:2,PIE:3,RING:4,GRAPHMATRIXVERTICALBARSTACKED:6,GRAPHMATRIXVERTICALBARCLUSTERED:7,GRAPHMATRIXVERTICALBARPERCENT:8,GRAPHMATRIXHORIZONTALBARSTACKED:9,GRAPHMATRIXHORIZONTALBARCLUSTERED:10,GRAPHMATRIXHORIZONTALBARPERCENT:11,GRAPHMATRIXVERTICALLINESTACKED:12,GRAPHMATRIXVERTICALLINECLUSTERED:13,GRAPHMATRIXVERTICALLINEPERCENT:14,GRAPHMATRIXHORIZONTALLINESTACKED:15,GRAPHMATRIXHORIZONTALLINECLUSTERED:16,GRAPHMATRIXHORIZONTALLINEPERCENT:17,GRAPHMATRIXSCATTERCIRCLEMM:18,GRAPHMATRIXSCATTERGRIDCIRCLEAA:19,GRAPHMATRIXBUBBLECIRCLEMM:21,GRAPHMATRIXBUBBLEGRIDCIRCLEAA:22,GRAPHMATRIXSCATTERSQUAREAM:23,GRAPHMATRIXSCATTERSQUAREMM:24,GRAPHMATRIXSCATTERGRIDSQUAREAA:25,GRAPHMATRIXBUBBLESQUAREAM:26,GRAPHMATRIXBUBBLESQUAREMM:27,GRAPHMATRIXBUBBLEGRIDSQUAREAA:28,GRAPHHORIZONTALBARCLUSTERED:29,GRAPHMATRIXVERTICALAREASTACKED:30,GRAPHMATRIXVERTICALAREAPERCENT:31,GRAPHMATRIXVERTICALAREACLUSTERED:32,GRAPHMATRIXHORIZONTALAREASTACKED:40,GRAPHMATRIXHORIZONTALAREAPERCENT:41,GRAPHMATRIXHORIZONTALAREACLUSTERED:42,GRAPHHORIZONTALBARDUALAXISCLUSTERED:33,GRAPHHORIZONTALBARDUALAXISABSOLUTE:34,GRAPHHORIZONTALLINEABSOLUTE:35,GRAPHHORIZONTALLINEDUALAXISABSOLUTE:36,GRAPHHORIZONTALAREAABSOLUTE:37,GRAPHHORIZONTALAREADUALAXISABSOLUTE:38,GRAPHVERTICALBARCLUSTERED:39,GRAPHVERTICALBARDUALAXISCLUSTERED:43,GRAPHVERTICALBARDUALAXISABSOLUTE:44,GRAPHVERTICALBARDUALAXISSTACKED:45,GRAPHVERTICALLINEABSOLUTE:46,GRAPHVERTICALLINESTACKED:47,GRAPHVERTICALLINEPERCENT:48,GRAPHVERTICALLINEDUALAXISABSOLUTE:49,GRAPHVERTICALLINEDUALAXISSTACKED:50,GRAPHVERTICALAREAABSOLUTE:51,GRAPHVERTICALAREAPERCENT:52,GRAPHVERTICALAREASTACKED:53,GRAPHVERTICALAREADUALAXISABSOLUTE:54,GRAPHVERTICALAREADUALAXISSTACKED:55,GRAPHCOMBINATIONBARAREA:56,GRAPHCOMBINATIONBARAREADUALAXIS:57,NETWORK:58,IMAGELAYOUT:59,GOOGLEMAPDENSITY:60,GRAPHMATRIXPIE:61,GRAPHMATRIXRING:62,GRAPHHORIZONTALBARABSOLUTE:63,GRAPHHORIZONTALBARPERCENT:64,GRAPHHORIZONTALBARSTACKED:65,GRAPHVERTICALBARABSOLUTE:66,GRAPHVERTICALBARPERCENT:67,GRAPHVERTICALBARSTACKED:68,ESRIMAP:69,GRAPHMATRIXVERTICALBARAUTOMATIC:70,GRAPHMATRIXHORIZONTALBARAUTOMATIC:71,GRAPHMATRIXVERTICALLINEAUTOMATIC:72,GRAPHMATRIXHORIZONTALLINEAUTOMATIC:73,GRAPHMATRIXVERTICALAREAAUTOMATIC:74,GRAPHMATRIXHORIZONTALAREAAUTOMATIC:75,GRAPHMATRIXVERTICALHISTOGRAM:76,GRAPHMATRIXGRIDCHART:78,GRAPHMATRIXVERTICALBOXPLOT:79,GRAPHMATRIXHORIZONTALBOXPLOT:80,GRAPHMATRIXVERTICALWATERFALL:81,GRAPHMATRIXHORIZONTALWATERFALL:82,KPICARD:83};var T=mstrmojo.vi.viz.EnumVisualizationTemplates;mstrmojo.vi.viz.EnumAggregatedVisTemplates={COMBOCHART:[T.GRAPHHORIZONTALBARDUALAXISCLUSTERED,T.GRAPHHORIZONTALBARDUALAXISABSOLUTE,T.GRAPHHORIZONTALLINEDUALAXISABSOLUTE,T.GRAPHHORIZONTALAREADUALAXISABSOLUTE,T.GRAPHVERTICALBARDUALAXISCLUSTERED,T.GRAPHVERTICALBARDUALAXISABSOLUTE,T.GRAPHVERTICALBARDUALAXISSTACKED,T.GRAPHVERTICALLINEDUALAXISABSOLUTE,T.GRAPHVERTICALLINEDUALAXISSTACKED,T.GRAPHVERTICALAREADUALAXISABSOLUTE,T.GRAPHVERTICALAREADUALAXISSTACKED,T.GRAPHCOMBINATIONBARAREADUALAXIS,T.GRAPHCOMBINATIONBARAREA],BUBBLECHART:[T.GRAPHMATRIXSCATTERCIRCLEMM,T.GRAPHMATRIXSCATTERGRIDCIRCLEAA,T.GRAPHMATRIXBUBBLECIRCLEMM,T.GRAPHMATRIXBUBBLEGRIDCIRCLEAA,T.GRAPHMATRIXSCATTERSQUAREAM,T.GRAPHMATRIXSCATTERSQUAREMM,T.GRAPHMATRIXSCATTERGRIDSQUAREAA,T.GRAPHMATRIXBUBBLESQUAREAM,T.GRAPHMATRIXBUBBLESQUAREMM,T.GRAPHMATRIXBUBBLEGRIDSQUAREAA],BARCHART:[T.GRAPHMATRIXVERTICALBARSTACKED,T.GRAPHMATRIXVERTICALBARCLUSTERED,T.GRAPHMATRIXVERTICALBARPERCENT,T.GRAPHMATRIXHORIZONTALBARSTACKED,T.GRAPHMATRIXHORIZONTALBARCLUSTERED,T.GRAPHMATRIXHORIZONTALBARPERCENT,T.GRAPHHORIZONTALBARCLUSTERED,T.GRAPHVERTICALBARCLUSTERED,T.GRAPHHORIZONTALBARABSOLUTE,T.GRAPHHORIZONTALBARPERCENT,T.GRAPHHORIZONTALBARSTACKED,T.GRAPHVERTICALBARABSOLUTE,T.GRAPHVERTICALBARPERCENT,T.GRAPHVERTICALBARSTACKED,T.GRAPHMATRIXVERTICALBARAUTOMATIC,T.GRAPHMATRIXHORIZONTALBARAUTOMATIC],LINECHART:[T.GRAPHMATRIXVERTICALLINESTACKED,T.GRAPHMATRIXVERTICALLINECLUSTERED,T.GRAPHMATRIXVERTICALLINEPERCENT,T.GRAPHMATRIXHORIZONTALLINESTACKED,T.GRAPHMATRIXHORIZONTALLINECLUSTERED,T.GRAPHMATRIXHORIZONTALLINEPERCENT,T.GRAPHHORIZONTALLINEABSOLUTE,T.GRAPHVERTICALLINEABSOLUTE,T.GRAPHVERTICALLINESTACKED,T.GRAPHVERTICALLINEPERCENT,T.GRAPHMATRIXVERTICALLINEAUTOMATIC,T.GRAPHMATRIXHORIZONTALLINEAUTOMATIC],PIECHART:[T.PIE,T.RING,T.GRAPHMATRIXPIE,T.GRAPHMATRIXRING],AREACHART:[T.GRAPHMATRIXVERTICALAREASTACKED,T.GRAPHMATRIXVERTICALAREAPERCENT,T.GRAPHMATRIXVERTICALAREACLUSTERED,T.GRAPHMATRIXHORIZONTALAREASTACKED,T.GRAPHMATRIXHORIZONTALAREAPERCENT,T.GRAPHMATRIXHORIZONTALAREACLUSTERED,T.GRAPHHORIZONTALAREAABSOLUTE,T.GRAPHVERTICALAREAABSOLUTE,T.GRAPHVERTICALAREAPERCENT,T.GRAPHVERTICALAREASTACKED,T.GRAPHMATRIXVERTICALAREAAUTOMATIC,T.GRAPHMATRIXHORIZONTALAREAAUTOMATIC],HISTOGRAM:[T.GRAPHMATRIXVERTICALHISTOGRAM,],BOXPLOT:[T.GRAPHMATRIXVERTICALBOXPLOT,T.GRAPHMATRIXHORIZONTALBOXPLOT],WATERFALL:[T.GRAPHMATRIXVERTICALWATERFALL,T.GRAPHMATRIXHORIZONTALWATERFALL]};mstrmojo.chart.model.enums.EnumDSSBaseFormType={DssBaseFormReserved:0,DssBaseFormDateTime:1,DssBaseFormNumber:2,DssBaseFormText:3,DssBaseFormPicture:4,DssBaseFormUrl:5,DssBaseFormEmail:6,DssBaseFormHTMLTag:7,DssBaseFormDate:8,DssBaseFormTime:9,DssBaseFormSymbol:10,DssBaseFormBigDecimal:11};mstrmojo.mstr.EnumDSSXMLTokenTypes={EndOfInput:-1,Reserved:0,Error:1,Unknown:2,Empty:3,ExclamationPoint:33,NumberSign:35,Dollar:36,Percent:37,Ampersand:38,LeftParen:40,RightParen:41,Asterisk:42,PlusSign:43,Comma:44,MinusSign:45,Dot:46,FwdSlash:47,Colon:58,Semicolon:59,LeftAngleBracket:60,EqualSign:61,RightAngleBracket:62,QuestionMark:63,AtSign:64,LeftSquareBracket:91,RightSquareBracket:93,Caret:94,Underscore:95,LeftAccolade:123,VerticalBar:124,RightAccolade:125,Tilda:126,Literal:258,Identifier:259,Reserved1:260,DoubleQString:261,Integer:262,Float:263,AttrRef:264,DimRef:265,MetricRef:266,AggMetricRef:267,FactRef:268,ReportRef:269,FilterRef:270,RoleRef:271,TableRef:272,PromptRef:273,ColumnRef:274,AttrFormRef:275,DimFormRef:276,SimpInfixFun1:277,SimpInfixFun2:278,SimpPrefixFun:279,AggFun:280,RelativeFun:281,CompareFun:282,AndFun:283,OrFun:284,NotFun:285,BoolPrefixFun:286,IntersectFun:287,Reserved2:288,InSetFun:289,BetweenFun:290,LikeFun:291,EnhCompareFun:292,EnhBetweenFun:293,ArrowUp:294,ArrowDown:295,ArrowUpDown:296,AggFirstInFact:297,AggLastInFact:298,KwdTrue:299,KwdFalse:300,KwdBreakBy:301,KwdSortBy:302,KwdFactID:303,DateTime:304,CaseFun:305,FreeVariable:306,LongNumber:307,RWMetricRef:308,CSQLRef:309,ConsolidationRef:310,DssTokenTypeKwdCSIUpdate:312,DssTokenTypeKwdCSISet:313,DssTokenTypeKwdCSIInsert:314,DssTokenTypeKwdCSIDelete:315,DssTokenTypeKwdCSIWhere:316,DssTokenTypeKwdCSIInto:317,DssTokenTypeKwdCSIValues:318,DssTokenTypeKwdCSIFrom:319,DssTokenTypeCSIFieldUnit:321,Elements:323,ConsolidationElementRef:324,EndOfTypes:340};mstrmojo.mstr.EnumNodeProperties={NORMAL:0,DRILL:1,CONDITION:2};mstrmojo.mstr.EnumDSSXMLBaseFormType={DssXmlBaseFormReserved:0,DssXmlBaseFormHidden:-1,DssXmlBaseFormDateTime:1,DssXmlBaseFormNumber:2,DssXmlBaseFormText:3,DssXmlBaseFormPicture:4,DssXmlBaseFormUrl:5,DssXmlBaseFormEmail:6,DssXmlBaseFormHTMLTag:7,DssXmlBaseFormDate:8,DssXmlBaseFormTime:9,DssXmlBaseFormSymbol:10,DssXmlBaseFormBigDecimal:11,DssXmlBaseFormPhoneNumber:12};mstrmojo.mstr.EnumDSSXMLBaseFormType.convertDataType2BaseFormType=function(B){var A={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2};return A[B]||0;};mstrmojo.EnumRWUnitType={LAYOUT:0,HEADER:2,FOOTER:3,SUBSECTION:4,DETAILS:5,PAGEHEADER:6,PAGEFOOTER:7,PANELSTACK:8,PANEL:9,UNITCONTAINER:11,GRID:521,GRAPH:522,GRIDGRAPH:527,RECTANGLE:101,IMAGE:102,LINE:105,TEXTFIELD:106,HTMLCONTAINER:107,SELECTOR:111,ROUNDEDRECTANGLE:112,VISUALIZATION:114,MOJOVISUALIZATION:115};mstrmojo.chart.model.enums.EnumDSSObjectType={DssTypeUnknown:-1,DssTypeReserved:0,DssTypeGeneric:5,DssTypeFormatBAD:46,DssTypeFilter:1,DssTypeTemplate:2,DssTypeReportDefinition:3,DssTypeMetric:4,DssTypeStyle:6,DssTypeAggMetric:7,DssTypeFolder:8,DssTypeDevice:9,DssTypePrompt:10,DssTypeFunction:11,DssTypeAttribute:12,DssTypeFact:13,DssTypeDimension:14,DssTypeTable:15,DssTypeDatamartReport:16,DssTypeFactGroup:17,DssTypeShortcut:18,DssTypeResolution:19,DssTypeMonitor:20,DssTypeAttributeForm:21,DssTypeSchema:22,DssTypeFormat:23,DssTypeCatalog:24,DssTypeCatalogDefn:25,DssTypeColumn:26,DssTypePropertyGroup:27,DssTypePropertySet:28,DssTypeDBRole:29,DssTypeDBLogin:30,DssTypeDBConnection:31,DssTypeProject:32,DssTypeServerDef:33,DssTypeUser:34,DssTypeTransmitter:35,DssTypeConfiguration:36,DssTypeRequest:37,DssTypeScript:38,DssTypeSearch:39,DssTypeSearchFolder:40,DssTypeDatamart:41,DssTypeFunctionPackageDefinition:42,DssTypeRole:43,DssTypeSecurityRole:44,DssTypeLocale:45,DssTypeConsolidation:47,DssTypeConsolidationElement:48,DssTypeScheduleEvent:49,DssTypeScheduleObject:50,DssTypeScheduleTrigger:51,DssTypeLink:52,DssTypeDbTable:53,DssTypeTableSource:54,DssTypeDocumentDefinition:55,DssTypeDrillMap:56,DssTypeDBMS:57,DssTypeMDSecurityFilter:58,DssTypePromptAnswer:59,DssTypePromptAnswers:60,DssTypeGraphStyle:61,DssTypeChangeJournalSearch:62,DssTypeNCSObjects:255,DssTypeReservedLastOne:63};mstrmojo.mstr.EnumDSSXMLObjectTypes={Generic:-2,Unknown:-1,Reserved:0,Filter:1,Template:2,ReportDefinition:3,Metric:4,Style:6,AggMetric:7,Folder:8,SubscriptionDevice:9,Prompt:10,Function:11,Attribute:12,Fact:13,Dimension:14,Table:15,DatamartReport:16,FactGroup:17,Shortcut:18,Resolution:19,Monitor:20,AttributeForm:21,Schema:22,Format:23,Catalog:24,CatalogDefn:25,Column:26,PropertySet:28,DBRole:29,DBLogin:30,DBConnection:31,Project:32,ServerDef:33,User:34,Configuration:36,Request:37,Script:38,Search:39,SearchFolder:40,Datamart:41,FunctionPackageDefinition:42,Role:43,SecurityRole:44,Locale:45,Consolidation:47,ConsolidationElement:48,ScheduleEvent:49,ScheduleObject:50,ScheduleTrigger:51,Link:52,DbTable:53,TableSource:54,DocumentDefinition:55,DrillMap:56,DBMS:57,MDSecurityFilter:58,PromptAnswer:59,PromptAnswers:60,ObjectTag:65,ReservedLastOne:66};(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.hash");var I=mstrmojo.array,B=mstrmojo.hash,D="u;",C="-1";ELEM_HIDDEN_PROP="hid";mstrmojo.elementHelper=mstrmojo.provide("mstrmojo.elementHelper",{buildElemsTerseID:function F(R,Q,V){var P,O;for(O in R){P=R[O];if(P.v){var S=P.v.replace(/\\\\/g,"\u001e").replace(/\\\;/g,"\u001f");var U=S.split(";");if(U&&U.length>1){U[1]=Q;if(V&&U.length>2){U.pop();}P.v=U.join(";").replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\;");}}}return R;},buildElemsCountStr:function K(U,Q,P){U=(!U||!U.length)?[]:U;Q=(!Q||!Q.length)?[]:Q;function S(V){return V.filter(function(W){return !W[ELEM_HIDDEN_PROP];});}var R=S(U).length,O=S(Q).length;if(I.find(Q,"v",D)>-1){O-=1;}if(I.find(Q,"v",C)>-1){O-=1;}if(P){R=(R<O)?O-R:0;}if(I.find(U,"v",D)>-1||I.indexOf(U,D)>-1){R=O;}return this.buildElemsCountStrByNum(R,O);},buildElemsCountStrByNum:function K(P,O){if(P===O){if(O===0){return"";}return O.toString();}else{if(O===0){return P+" "+mstrmojo.desc(514);}else{if(P>O){return"("+O+")";}}}return mstrmojo.desc(4891,"").replace("##",String(P)).replace("###",String(O));},browseElements:function G(Q,R,P){var O={doNotHold:!(P&&mstrApp.serverProxy),silent:true};mstrApp.serverRequest(mstrmojo.hash.copy(P,R),Q,O);},getIdPresentation:function J(R){if(!!R){var Q=R.charAt(0),O,P,S;if((Q>="g"&&Q<="w")||(Q>="V"&&Q<="Z")){P=false;for(S=1;S<R.length;++S){if(P){P=false;}else{switch(R.charAt(S)){case";":return"terseLong";case"\\":P=true;break;}}}return"terse";}if(Q>="B"&&Q<="Q"){if(R.length>2){O=R.charAt(1);if(O>="A"&&O<="Q"){if(R.charAt(2)===":"){return"oldLong";}}}}if(R.length>=33&&R.charAt(32)===":"){return"old";}}return null;},terseLong2OldShort:function N(P){if(this.getIdPresentation(P)!=="terseLong"){return P;}var O=P.replace(/\\\\/g,"\u001e").replace(/\\\;/g,"\u001f"),Q=O.substring(1,O.length).split(";");return(Q[1]+":"+Q[0]).replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\;");},oldShort2terseLong:function L(P,S){if(this.getIdPresentation(P)!=="old"){return P;}var O=P.replace(/\\\\/g,"\u001e").replace(/\\\:/g,"\u001f"),R=O.split(":"),Q=R.shift();return(S||"h")+(R.join(":")+";"+Q).replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\:");},isNullElem:function H(O){if(!O){return true;}var R=this.getIdPresentation(O),P=false,Q;switch(R){case"terse":case"terseLong":Q=O.substring(1,O.length).split(";");P=Q[0].indexOf(this.TERSE_NULL)>-1;break;case"old":case"oldLong":P=O.indexOf(this.OLD_NULL)>-1;break;}return P;},isNonGroupNull:function(Q){var O=Q.eid||(Q._e&&Q._e.id),P=O&&O.split(":")[0];return P&&P===this.NON_GROUP_NULL;},getAttributeId:function M(Q){var P,O;if(Q){O=Q.split(";");P=O[1];}return P;},getElementValue:function A(P){var Q,O;if(P){O=P.split(";");if(O.length>2){Q=O[0]+" "+O[2];}else{Q=O[0];}}return Q;},isAttributeIdsLinked:function E(P,O,Q){var S=false,R=B.keyarray(Q);I.forEach(R,function(U){if(U===P){I.forEach(Q[U],function(V){if(V===O){S=true;return false;}});}if(S){return false;}});return S;},ELEM_ALL_ID:"u;",ELEM_DUMMY_ID:"-1",ELEM_SEPARATOR:"\u001E",OLD_NULL:"~!@@~~!@@~",TERSE_NULL:"\\N",NON_GROUP_NULL:"n00000000000000000000000000000000",ELEM_ALL:{t:mstrmojo.chart.model.enums.EnumDSSObjectType.DssTypeDimension,v:"u;",n:"(All)"}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var E=mstrmojo.dom,M=mstrmojo.hash,B,I=mstrmojo.global.document,K="mousedown",O="mousemove",Q="mouseup";function G(Y){if(E.isPrimaryMouseBtn(Y)){B.startDragCheck(self,Y);}}var V,P,A="mstrmojo-dnd-avatar",U;function F(Z,Y){if(Y!==undefined&&Y!==null){P.innerHTML=Y;}U.left=Z.x+"px";U.top=Z.y+"px";}function L(Z,Y){if(!V){V=I.createElement("div");U=V.style;V.className=A;V.innerHTML='<div class="'+A+'-inner"></div>';P=V.firstChild;I.body.appendChild(V);}F(Z,Y);U.display="block";}function R(){if(U){U.display="none";}}function H(Y){var Z=++B.ctxt.moveCount;if(Z>=B.minMoves){B.stopDragCheck();if((Y.buttons===1||Y.buttons===undefined||E.isIE9)&&(Y.which===1||Y.button===0||E.isIE8)){B.startDrag(self,Y);}}}function N(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDragCheck();delete B.ctxt;}}function D(Y){B.onDragMove(self,Y);}function C(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDrag(window,Y);}}function J(Z){var Y=E.findWidget(Z);while(Y){if(Y.draggable){return Y;}Y=Y.parent;}return null;}function S(Y){var a=Y.src,Z=J(a.node);if(!Z){return null;}if(Z.getDragAction){Y.action=Z.getDragAction(Y);}a.widget=Z;a.data=Z.getDragData&&Z.getDragData(Y);if(Z.isDragValid){if(!Z.isDragValid(Y)){if(!mstrApp.isInVFInteractMode&&(!Z.shouldDragBubble||Z.shouldDragBubble(Y)===true)){Y.src.node=Z.domNode.parentNode;return S(Y);}return null;}}if(Z.ondragstart){Z.ondragstart(Y);}return Z;}function X(a,Z){var Y=E.findWidget(a),b=Z.tgt&&Z.tgt.widget;while(Y){if(Y.dropZone){if(Y===b){return Y;}if(Y.allowDrop&&Y.allowDrop(Z)){return Y;}}Y=Y.parent;}return null;}function W(){if(this.set){this.set("allowingDrop",false);}}mstrmojo.dnd=mstrmojo.dnd||mstrmojo.provide("mstrmojo.dnd",{minMoves:3,enable:function(){if(!mstrmojo.dndEnabled){E.attachEvent(I,K,G);mstrmojo.dndEnabled=true;}},disable:function(){mstrmojo.dndEnabled=false;E.detachEvent(I,K,G);},startDragCheck:function(Y,Z){delete this.ctxt;var a=E.captureEventInfo({hWin:Y,e:Z});this.ctxt={src:a,moveCount:0,last:M.copy(a.pos),getDirection:function(b){return !!this.dir[b];},getCtxtDragData:function(){var b=this.src;return(b&&b.data)||{};},getCtxtDropData:function(){var b=this.tgt;return(b&&b.data)||{};}};if(this.minMoves){E.attachEvent(I,O,H);E.attachEvent(I,Q,N);}else{this.startDrag(Y,Z);}},stopDragCheck:function(){E.detachEvent(I,O,H);E.detachEvent(I,Q,N);},startDrag:function(Y,b){var Z=this.ctxt;Z.id=mstrmojo.now();var a=S(Z);if(!a){return ;}E.clearBrowserHighlights(Y);E.preventDefault(self,b);E.attachEvent(I,O,D);E.attachEvent(I,Q,C);var d=window.mstrApp;if(d&&d.setInteractive){this._changeAppStatus=d.setInteractive(false);}if(!a.ownAvatar){var c=Z.src;L(c.pos,c.data&&c.data.html);}},stopDrag:function(Y,f){E.detachEvent(I,O,D);E.detachEvent(I,Q,C);var b=this.ctxt,a=b.tgt||{},Z=E.captureEventInfo({hWin:Y,e:f,data:a.data}),d=X(Z.node,b);Z.widget=d;b.tgt=Z;if(d){if(d.ondrop){d.ondrop(b);}else{W.call(d);}}var c=b.src.widget;if(c&&c.ondragend){c.ondragend(b);}if(c&&!c.ownAvatar){R();}if(this._changeAppStatus){window.mstrApp.setInteractive(true);delete this._changeAppStatus;}},onDragMove:function(c,f){if(E.isSafari){E.clearBrowserHighlights();}var Y=this.ctxt,b=Y.tgt||{},Z=b.widget,d=E.captureEventInfo({hWin:c,e:f,data:b.data}),j=d.widget=X(d.node,Y),h=Y.last,a=d.pos;Y.dir={x:a.x>h.x,y:a.y>h.y};Y.last=M.copy(d.pos);Y.tgt=d;if(Z!==j){if(Z){if(Z.ondragleave){Z.ondragleave(Y);}else{W.call(Z);}}if(j){Y.tgt.data=(j.getDropData&&j.getDropData(Y))||{};if(j.ondragenter){j.ondragenter(Y);}else{if(j.set){j.set("allowingDrop",true);}}}}if(j){if(j.ondragover){j.ondragover(Y);}}var g=Y.src.widget;if(g&&g.ondragmove){g.ondragmove(Y);}if(g&&!g.ownAvatar){F(d.pos);}}});B=mstrmojo.dnd;B.enable();}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var D=mstrmojo.dom;mstrmojo._FillsBrowser=mstrmojo.provide("mstrmojo._FillsBrowser",{_mixinName:"mstrmojo._FillsBrowser",getBrowserDimensions:function F(H){if(H){return{w:H.innerWidth,h:H.innerHeight};}var G=D.windowDim(),I=(D.isFF||D.isWK)?0:2;return{w:Math.max(G.w,0)+"px",h:Math.max(G.h-I,0)+"px"};},preBuildRendering:function B(){var I=this._super(),H=this.getBrowserDimensions();if(!this.browserResized||this.browserResized(H)!==true){this.height=H.h;this.width=H.w;}if(!this._listenerProc){var K=this.id,J=null,G=this._listenerProc=function(M){if(mstrApp&&mstrApp.isExporting){var L=M||window.event;mstrmojo.all[K].monitorWindow(L);}else{window.clearTimeout(J);J=window.setTimeout(function(){var N=M||window.event;mstrmojo.all[K].monitorWindow(N);},150);}};D.attachEvent(window,"resize",G);}return I;},destroy:function C(G){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);}this._super(G);},getResizeDimensions:function A(G){var J=G.currentTarget,I=this.getBrowserDimensions(),H={w:(J?J.innerWidth+"px":I.w),h:(J?J.innerHeight+"px":I.h)};return H;},monitorWindow:function E(G){var H=this.getResizeDimensions(G);if((H.h===this.height&&H.w===this.width)||parseInt(H.h,10)<=20||parseInt(H.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(H,true)!==true){if(H.h!==this.height){this.set("height",H.h);}if(H.w!==this.width){this.set("width",H.w);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;function D(J,I){var G=[];if(J){var F;for(F in J){var H=Number(F);if(H>=I){G.push(H);}}}G.sort(mstrmojo.array.numSorter);return G;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function E(L,F,N){if(C.isPrimaryMouseBtn(N.e)){var I=N.hWin,J=N.e,G=C.eventTarget(I,J),M=L.listMapper.findIndex(L,F,G);if(M>-1){var H=L.multiSelect,K=C.ctrlKey(I,J),O=C.shiftKey(I,J);if(K||O){C.clearBrowserHighlights(I);}if(H&&(K||(L.selectionPolicy==="toggle"))){L.toggleSelect(M);}else{if(H&&O){L.rangeSelect(M);}else{L.singleSelect(M);}}}}},premouseup:function B(H,K,G){var F=G.hWin,J=G.e,L=C.ctrlKey(F,J),I=C.shiftKey(F,J);if(L||I){C.clearBrowserHighlights(F);}},onadd:function A(I,H){var M=H&&H.value&&H.value.length;if(M){var G=H.index,K=I.selectedIndices,L=D(K,G),J;for(J=L.length-1;J>-1;J--){var F=L[J];K[F+M]=true;delete K[F];}if(I.selectedIndex>=G){I.selectedIndex+=M;}}},onremove:function A(Q,S){var O=S&&S.value&&S.value.length;if(O){var R=S.index,I=R+O-1,M=Q.selectedIndices,L=Q.selectedIndex,G=[],U=[],P=false;if(M){var H;for(H in M){var K=Number(H);if(K>I){G.push(K);}else{if(K>=R){U.push(K);P=true;}}}}G.sort(mstrmojo.array.numSorter);var J,N;for(J=0,N=G.length;J<N;J++){var F=G[J];M[F-O]=true;delete M[F];}if(L>I){Q.selectedIndex-=O;}if(P){Q.removeSelect(U);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var F=mstrmojo.dom;var W="touchstart",J="mousedown",P=F.isIOSTouch,S=P?W:J;function X(Z){var Y=Z[Z.hotSlot||"domNode"];if(Y){if(!Z._closeCallback){var b=Z.id,a=function(c){return function(f){var d=mstrmojo.all[b];if(d&&!d.ignoreHover){d["auto"+c](f,self);}};};Z._uncloseCallback=a("Unclose");Z._closeCallback=a("Close");}F.attachEvent(Y,"mouseover",Z._uncloseCallback);F.attachEvent(Y,"mouseout",Z._closeCallback);}}function C(Z){if(Z._closeCallback){var Y=Z[Z.hotSlot||"domNode"];if(Y){F.detachEvent(Y,"mouseover",Z._uncloseCallback);F.detachEvent(Y,"mouseout",Z._closeCallback);}}}function G(b,Z){var Y=b,a;while(Y){if(Y.open||Y.openPopup){a=Y.ignoreHoverCount||0;a=Z?(a+1):(a>0?a-1:a);Y.ignoreHoverCount=a;if(Y.set){Y.set("ignoreHover",(a>0));}else{Y.ignoreHover=(a>0);}}Y=Y.opener||Y.parent;if(Y&&Y.shouldPropagateLockHover&&!Y.shouldPropagateLockHover()){break;}}}function E(){var a=this._lockHoverCallback,Z=this.curtainNode,c=this._onClickChange;if(a){F.detachEvent(document.body,S,a,true);delete this._lockHoverCallback;}if(!Z||!c){return ;}var Y=mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp()||P,b=Y?W:J;F.detachEvent(Z,b,c);delete this._onClickChange;}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function U(){this._super();if(this.autoCloses){X(this);}this.oncloseOnClickChange();},onautoClosesChange:function N(){var Y=(this.autoCloses)?X:C;Y(this);},oncloseOnClickChange:function I(){if(!this.curtainNode){return ;}var a=this,Y=mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp()||P,Z=Y?W:J;this._onClickChange=function(){a.close();if(Y){mstrmojo.touchManager.notify([]);}};F.attachEvent(a.curtainNode,Z,this._onClickChange);},autoUnclose:function H(){var Y=this._autoCloseTimer;if(Y){self.clearTimeout(Y);delete this._autoCloseTimer;}},autoClose:function L(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var Y=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[Y].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function V(Y){E.call(this);this._super(Y);},lockHover:function R(){G(this,true);if(!this._lockHoverCallback){var Z=this.id,Y=this._lockHoverCallback=function(a){mstrmojo.all[Z]._unlockHoverCheck(a,self);};if((F.isIE7||F.isIE8)&&window.event&&(window.event.type===S)&&this.opener){this.opener._ignoreMousedown=true;}F.attachEvent(document.body,S,Y,true);}},unlockHover:function O(){G(this,false);E.call(this);},hoverLock:function(Y){G(this,Y);},suppressClose:function B(Y){return F.contains(this.domNode,Y,true,document.body);},_unlockHoverCheck:function D(b,Y){var Z=this.opener;if(Z&&Z._ignoreMousedown){delete Z._ignoreMousedown;return ;}var a=F.eventTarget(Y,b);if(!this.suppressClose(a)){if(this.isWithinParentWidget(a)){return ;}if(Z&&Z.onPopupAutoClosed){Z.onPopupAutoClosed(b,Y);}this.close(a);}},isWithinParentWidget:function Q(Z){var Y=F.findWidget(Z);while(Y){if(Y===this){return true;}Y=Y.parent||Y.opener;}return false;},open:function K(Z,Y){if(this.autoCloses){this.autoUnclose();}this._super(Z,Y);if(this.locksHover){this.lockHover();}},close:function M(Y){if(this.locksHover){this.unlockHover();}this._super(Y);},shouldPropagateLockHover:function A(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx={enabled:true};var E=mstrmojo.dom;mstrmojo.fx._Effect=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.fx._Effect",duration:500,interval:50,delay:null,target:null,getTarget:null,widget:null,slot:null,preStart:null,postStart:null,onCancel:null,onEnd:null,revertOnCancel:true,isPlaying:false,started:false,init:function R(X){mstrmojo.hash.copy(X,this);},play:function C(){this.isPlaying=true;this.started=false;if(this.delay){var X=this;this.delayTimer=window.setTimeout(function(){X._start();X=null;},this.delay);}else{this._start();}},pause:function H(){if(this.delayTimer){window.clearTimeout(this.delayTimer);delete this.delayTimer;}if(this.timer){window.clearInterval(this.timer);delete this.timer;}this.isPlaying=false;},cancel:function V(){this.pause();if(this.started){if(this.revertOnCancel){this.counter=0;this.exec();}if(this.onCancel){this.onCancel();}this.started=false;}},_start:function F(){this.started=true;this._doTarget();this.steps=Math.max(Math.ceil(this.duration/this.interval),1);var X=this.ease;if(typeof X==="string"){this.ease=mstrmojo.registry.ref(X);}if(this._doPreStart()===false){this.started=false;this.isPlaying=false;return ;}this.counter=0;this.exec();this.counter++;this._doPostStart();if(this.counter>=this.steps){this._end();}else{var Y=this;if(this.timer){window.clearInterval(this.timer);}this.timer=window.setInterval(function Z(){if(Y){Y.exec();Y.counter++;if(Y.counter>=Y.steps){Y._end();Y=null;}}},this.interval);}},exec:null,_end:function D(){this.pause();this.started=false;if(this.onEnd){this.onEnd();}},_doTarget:function U(){if(this.getTarget){this.target=this.getTarget();}else{if(this.widget){this.target=this.widget[this.slot||"domNode"];}else{if(this.target){var Y=this.target;if(Y&&this.slot&&Y.scriptClass){var Z=Y[this.slot];if(Z){this.widget=Y;this.target=Z;}}}}}if(!this.target){var X=this;while(X=X.parent){if(!X||X.domNode){break;}}if(X){this.widget=X;this.target=X[this.slot||"domNode"];}}},_doPreStart:function N(){if(this.preStart){return this.preStart();}},_doPostStart:function S(){if(this.postStart){this.postStart();}}});function M(a,b){var Y=a.children,X=(Y&&Y.length)||0,Z;for(Z=0;Z<X;Z++){Y[Z][b]();}}mstrmojo.fx.Parallel=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Parallel",init:function R(a){this._super(a);var Z=this.children;mstrmojo.registry.refArray(Z);var X=(Z&&Z.length)||0,Y;for(Y=0;Y<X;Y++){Z[Y].parent=this;}},_start:function F(){this.started=true;if(this.preStart){this.preStart();}M(this,"play");if(this.postStart){this.postStart();}},pause:function H(){M(this,"pause");},cancel:function V(){M(this,"cancel");}});mstrmojo.fx.AnimateProp=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.AnimateProp",props:null,_start:function O(){var Z=this.props,a;for(a in Z){var Y=Z[a],X=Y.ease;if(typeof X==="string"){Y.ease=mstrmojo.registry.ref(X,{dontInst:true});}}this._super();},exec:function P(){var a=this.props,b;for(b in a){var Y=a[b],X=(Y.ease||mstrmojo.ease.sin)(this.counter,Y.start,Y.stop-Y.start,this.steps-1);if(Y.fn){X=Y.fn(X);}if(Y.suffix){X+=Y.suffix;}var Z=Y.isStyle===false?this.target:this.target.style;Z[b]=X;}}});mstrmojo.fx.Typewriter=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Typewriter",charGroupSize:1,srcProp:"text",_doPreStart:function(){this._super();this._dynStop=false;if(this.stop==null){var b=this.srcProp,Z;if(b){var X=this.widget||this.parent;Z=X&&X[b];if((Z!=null)&&(typeof (Z)!=="string")){Z=String(Z);}}this.stop=Z;this._dynStop=true;}if(this.stop==null){this.stop="";}var a=this.target,c=null,Y=1;if(a){a.innerHTML="";c=document.createTextNode("");a.appendChild(c);Y=Math.max(Math.floor(this.stop.length/this.steps),1);}this.targetTextNode=c;this.charGroupSize=Y;},exec:function(){var Y=this.targetTextNode;if(!Y){return ;}var X;if(this.counter>=this.steps-1){X=this.stop;}else{if(this.counter===0){X="";}else{X=this.stop.substring(0,this.charGroupSize*this.counter)+"_";}}Y.nodeValue=X;},_end:function D(){this._super();if(this._dynStop){this.stop=null;delete this._dynStop;}},cancel:function V(){if(this._dynStop){this.stop=null;delete this._dynStop;}}});mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx.Fade=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Fade",start:null,stop:null,ease:null,suffix:null,exec:function P(X){if(X==null){X=(this.ease||mstrmojo.ease.sin)(this.counter,this.start,this.stop-this.start,this.steps-1);}if(E.isIE&&!E.isWinPhone){this.target.style.filter="alpha(opacity="+parseInt(X*100,10)+")";}else{this.target.style.opacity=X;}}});mstrmojo.fx.FadeOut=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeOut",start:1,stop:0,revertOnCancel:true,cssDisplay:"block",_end:function D(){if(this.cssDisplay){this.target.style.display="none";this.exec(this.start);}this._super();},cancel:function V(){if(this.started&&this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();}});mstrmojo.fx.FadeIn=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeIn",start:0,stop:1,revertOnCancel:true,cssDisplay:"block",_doPostStart:function W(){if(this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();},cancel:function(){if(this.started&&this.revertOnCancel&&this.cssDisplay){this.target.style.display="none";}this._super();}});function I(Z,Y,a){var X=Math.pow(10,a||2);if(Y){return parseInt(X*Z/Y,10)/X;}return parseInt(X*Z,10)/X;}mstrmojo.ease={linear:function L(Y,X,a,Z){if(Y===Z){return X+a;}if(Y===0){return X;}return X+a*I(Y,Z);},sin:function A(Y,X,a,Z){return X+a*Math.sin((Math.PI/2)*Y/Z);},cos:function B(Y,X,a,Z){return X+a*Math.cos((Math.PI/2)*(1-Y/Z));},sincos:function K(Y,X,a,Z){if(Y>Z/2){return X+a*Math.cos((Math.PI/2)*(1-Y/Z));}return X+a*Math.sin((Math.PI/2)*Y/Z);},cossin:function Q(Y,X,a,Z){if(Y>Z/2){return X+a*Math.sin((Math.PI/2)*Y/Z);}return X+a*Math.cos((Math.PI/2)*(1-Y/Z));},bounce:function G(Y,X,a,Z){if((Y/=Z)<(1/2.75)){return a*(7.5625*Y*Y)+X;}if(Y<(2/2.75)){return a*(7.5625*(Y-=(1.5/2.75))*Y+0.75)+X;}if(Y<(2.5/2.75)){return a*(7.5625*(Y-=(2.25/2.75))*Y+0.9375)+X;}return a*(7.5625*(Y-=(2.625/2.75))*Y+0.984375)+X;},shake:function J(Y,X,a,Z){if(Y<Z/2){return X+a*I(Math.sin(2*Math.PI*Y/8),null,2)*2*Y/Z;}return X+a*I(Math.sin(2*Math.PI*Y/8),null,2)*2*(1-Y/Z);}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var D=mstrmojo.dom,L=mstrmojo.hash;var O=100;var F=D.supportsTouches?0.5:1;var G=1;var R=100;var P={onvscrollVisibleChange:function(){var V=this.vscrollNode,W=V&&V.style;if(!W){return ;}if(this.vscrollVisible){var U=this.maxPos,X=this.clientSize;W.height=Math.round(X.y*X.y/U.y)+"px";W.left=(X.x-5)+"px";W.display="block";W.opacity=0.5;}else{W.opacity=0;}},onhscrollVisibleChange:function(){var W=this.hscrollNode,V=W&&W.style;if(!V){return ;}if(this.hscrollVisible){var U=this.maxPos,X=this.clientSize;V.width=Math.round(X.x*X.x/U.x)+"px";V.top=(X.y-5)+"px";V.display="block";V.opacity=0.5;}else{V.opacity=0;}}};var M=L.copy({onposChange:function(){var W=this.clientSize,V=this.maxPos,U=0,X=0;if(this.scrollsVert){X=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style[D.CSS3_TRANSFORM]="translateY("+Math.round((W.y-(W.y*W.y/V.y))*this.pos.y/V.y)+"px)";}}if(this.scrollsHoriz){U=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style[D.CSS3_TRANSFORM]="translateX("+Math.round((W.x-(W.y*W.x/V.x))*this.pos.x/V.x)+"px)";}}this.scrollChild.style[D.CSS3_TRANSFORM]="translate3d(-"+parseInt(U,10)+"px, -"+parseInt(X,10)+"px, 0px)";},ondeceleratingChange:function(){this.scrollChild.style[D.CSS3_TRANSITION]=this.decelerating?(D.CSS3_PREFIX+"transform 0.2s linear"):"";}},L.copy(P));var H=L.copy({onposChange:function(){var W=this.clientSize,V=this.maxPos,U=0,Y=0,X=this.scrollboxNode;if(this.scrollsVert){Y=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style.top=Math.round((W.y-(W.y*W.y/V.y))*this.pos.y/V.y)+"px";}X.scrollTop=parseInt(Y,10);}if(this.scrollsHoriz){U=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style.left=Math.round((W.x-(W.y*W.x/V.x))*this.pos.x/V.x)+"px";}X.scrollLeft=parseInt(U,10);}}},L.copy(P));mstrmojo._TouchScrolling=mstrmojo.provide("mstrmojo._TouchScrolling",{FRICTION:0.65,BOUNCEFRICTION:0.5,usesTouches:false,bounces:true,scrollsHoriz:true,scrollsVert:true,pos:null,preBuildRendering:function N(){this.usesTouches=(mstrmojo.dom.supportsTouches&&this.usesTouches&&(this.scrollsHoriz||this.scrollsVert));if(this.usesTouches){this.pos={x:0,y:0};}if(this._super){this._super();}},postBuildRendering:function C(){if(this._super){this._super();}if(this.usesTouches){var X=this.scrollboxNode,W=this.itemsContainerNode||X.firstChild;if(X&&X!==W){this.scrollChild=W;var U=X.style;U.position="relative";U.overflow="hidden";var V=W.style;V.position="absolute";V.left=0;V.top=0;this.markupMethods=L.copy(D.isSafari?M:H,L.copy(this.markupMethods));this.attachTouchEvents();}}},unrender:function(U){if(this.usesTouches){this.detachTouchEvents();}this._super(U);},attachTouchEvents:function(){var V=this.touchNode||this.scrollboxNode;if(V){if(!this._tsCallback){var U=this;this._tsCallback=function(W){U.touchesBegin(self,W);};this._tmCallback=function(W){U.touchesMoved(self,W);};this._teCallback=function(W){U.touchesEnd(self,W);};}D.attachEvent(V,D.TOUCHSTART,this._tsCallback);this._tsNode=V;}},detachTouchEvents:function(){var U=this._tsNode;if(U){D.detachEvent(U,D.TOUCHSTART,this._tsCallback);delete this._tsNode;}},touchesBegin:function J(U,W){var V=W.target&&W.target.tagName;if(V&&(V==="SELECT"||V==="INPUT")){return ;}D.preventDefault(U,W);this.stopDeceleration();this.startTime=new Date();this.startTimePos={x:this.pos.x,y:this.pos.y};this.startTouchPos=D.getMousePosition(D.firstTouch(U,W),U);this.dragging=false;D.attachEvent(window,D.TOUCHMOVE,this._tmCallback);D.attachEvent(window,D.TOUCHEND,this._teCallback);},touchesMoved:function E(c,f){var a=D.getMousePosition(D.firstTouch(c,f),c);D.preventDefault(c,f);if(!this.dragging){var U=5,j=Math.abs;if((this.scrollsHoriz&&j(a.x-this.pos.x)>U)||(this.scrollsVert&&j(a.y-this.pos.y)>U)){this.dragging=true;this.dragStartTime=new Date();this.startTouchPos=a;var W=this.scrollboxNode,Z={x:W.clientWidth,y:W.clientHeight},g={x:W.scrollWidth,y:W.scrollHeight};this.clientSize=Z;this.scrollSize=g;this.maxPos={x:Math.max(g.x-Z.x,0),y:Math.max(g.y-Z.y,0)};this.showScroll();}}if(this.dragging){D.stopPropogation(c,f);var d=this.startTimePos,Y=this.startTouchPos,b=this.maxPos;var X={x:this.scrollsHoriz?Math.max(Math.min(d.x-(a.x-Y.x),b.x),0):0,y:this.scrollsVert?Math.max(Math.min(d.y-(a.y-Y.y),b.y),0):0};this.set("pos",X);this.nextLastDragPos=this.lastDragPos;this.lastDragPos=a;var V=new Date(),h=this.lastDragTime;this.nextLastDragTime=h;this.lastDragTime=V;if((V-h)>R){this.startTime=this.lastDragTime;this.dragStartTime=this.startTime;this.startTimePos={x:X.x,y:X.y};this.startTouchPos=a;}}},touchesEnd:function I(U,V){D.preventDefault(U,V);D.detachEvent(window,D.TOUCHMOVE,this._tmCallback);D.detachEvent(window,D.TOUCHEND,this._teCallback);if(this.dragging){this.dragging=false;D.stopPropogation(U,V);if((new Date())-this.lastDragTime<=R){this.startDeceleration(U,V);}else{this.hideScroll();}}},startDeceleration:function B(Z,a){var X=D.getMousePosition(D.firstChangedTouch(Z,a),Z),d=((mstrmojo.dom.supportsTouches===null)?this.lastDragPos:this.nextLastDragPos)||X,c={x:X.x-d.x,y:X.y-d.y},U=((mstrmojo.dom.supportsTouches===null)?this.lastDragTime:this.nextLastDragTime),f=U?(new Date())-U:0,W={x:f?Number(c.x*O*F/f).toFixed(2):0,y:f?Number(c.y*O*F/f).toFixed(2):0};var b=this,V=function(e){return(b.scrollsHoriz&&Math.abs(e.x)>=G)||(b.scrollsVert&&Math.abs(e.y)>=G);};if(V(W)){this.velocity=W;this.friction={x:this.FRICTION,y:this.FRICTION};this.set("decelerating",true);var Y=function(){b.decelerate();if(!V(b.velocity)){b.stopDeceleration();b=null;}};Y();if(this.decelerating){this.decelerationTimer=window.setInterval(Y,O);}}else{this.hideScroll();}},stopDeceleration:function A(){this.set("decelerating",false);delete this.velocity;if(this.decelerationTimer){window.clearTimeout(this.decelerationTimer);delete this.decelerationTimer;}this.hideScroll();},decelerate:function S(){var X=this.pos,W=this.velocity,V=this.friction,a=this.maxPos,Y={x:X.x-W.x,y:X.y-W.y},c=this.bounces,U=this.BOUNCEFRICTION;var b=Y.x;if(b<0||b>a.x){Y.x=(b<0)?0:a.x;W.x*=c?-U:0;V.x=U;}var Z=Y.y;if(Z<0||Z>a.y){Y.y=(Z<0)?0:a.y;W.y*=c?-U:0;V.y=U;}this.set("pos",Y);this.velocity={x:V.x*W.x,y:V.y*W.y};},hideScroll:function K(){this.set("vscrollVisible",false);this.set("hscrollVisible",false);},showScroll:function Q(){var U=this.maxPos;if(this.scrollsVert&&U.y&&this.vscrollNode){this.set("vscrollVisible",true);}if(this.scrollsHoriz&&U.x&&this.hscrollNode){this.set("hscrollVisible",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var E=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function A(){var I=this.ifDataHelper,H=this,G=this.scrollNode||this.domNode;this.supportsIncFetch=I&&I.hasNext();if(I&&this.supportsIncFetch){this._scroll=function F(){var J=this.scrollNode||this.domNode||G;if(Math.ceil(J.offsetHeight+J.scrollTop)>=J.scrollHeight){H.raiseEvent({name:"incFetch",id:H.id});}};E.attachEvent(G,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(J){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);I.next({complete:function(K){if(H.postNext){H.postNext();}H.set("isFetching",false);},success:function(K){H.addItems(K.items||null);},failure:function(K){H.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+K);}});});}},unrender:function D(F){var G=this.scrollNode||this.domNode;E.detachEvent(G,"scroll",this._scroll);this._super(F);},render:function C(){this._super();if(this.supportsIncFetch){var F=this.scrollNode||this.domNode;E.attachEvent(F,"scroll",this._scroll);}},addItems:function B(F){if(this._super){this._super(F);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var G=this.scrollNode||this.domNode;E.detachEvent(G,"scroll",this._scroll);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");function G(J){return(J&&J.id);}mstrmojo._HasScrollbox=mstrmojo.provide("mstrmojo._HasScrollbox",{_mixinName:"mstrmojo._HasScrollbox",scrollListeners:null,scrollListenerCount:0,scrollInterval:50,scrollboxNode:undefined,scrollTo:function F(L,K){var J=this.scrollboxNode;J.scrollLeft=L.x;J.scrollTop=L.y;if(K){this.notifyScrollListeners(L);}},connectScrollbox:function E(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(!L){L={};this.scrollListeners=L;}if(!L[J]){L[J]=K;this.scrollListenerCount++;if(this.scrollListenerCount===1){this._attachScrollDom();}}},disconnectScrollbox:function D(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(L&&L.hasOwnProperty(J)){delete this.scrollListeners[J];this.scrollListenerCount--;if(!this.scrollListenerCount){this._detachScrollDom();}}},notifyScrollListeners:function C(K){var N=K||this.getScrollPos(),M=N.y,L=N.x;this.scrollboxTop=M;this.scrollboxLeft=L;this.scrollboxRight=L+this.scrollboxWidth;this.scrollboxBottom=M+this.scrollboxHeight;var J=this.scrollListeners,O;for(O in J){J[O].onscroll(this);}},getScrollPos:function H(){var J=this.scrollboxNode;return{x:J.scrollLeft,y:J.scrollTop};},_attachScrollDom:function A(){var M=this.scrollboxNode;if(M){var L=this.usesTouches;if(!L){if(!this.scrollCallback){var K=this.id;this.scrollCallback=function(){mstrmojo.all[K].notifyScrollListeners();};}mstrmojo.dom.attachBufferedEvent(M,"scroll",this.scrollCallback,this.scrollInterval);}if(this.scrollboxTop===null){this.scrollboxTop=L?0:M.scrollTop;}if(this.scrollboxLeft===null){this.scrollboxLeft=L?0:M.scrollLeft;}var J=function(P){var O=P.toLowerCase();var N=M.style[O];return(!isNaN(N)&&N.charAt(N.length-1)!=="%")?parseInt(N,10):M["client"+P];};if(this.scrollboxHeight===null){this.scrollboxHeight=J("Height");}if(this.scrollboxWidth===null){this.scrollboxWidth=J("Width");}this.scrollboxBottom=this.scrollboxTop+this.scrollboxHeight;this.scrollboxRight=this.scrollboxLeft+this.scrollboxWidth;this._attachedScrollbox=M;}},_detachScrollDom:function I(){var J=this._attachedScrollbox;if(J&&this.scrollCallback){mstrmojo.dom.detachBufferedEvent(J,"scroll",this.scrollCallback,this.scrollInterval);}delete this._attachedScrollbox;},scrollboxTop:null,scrollboxLeft:null,scrollboxHeight:null,scrollboxBottom:null,buildRendering:function B(){this._detachScrollDom();this._super();if(this.scrollListenerCount){this._attachScrollDom();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func");mstrmojo.ACL.UserDataService=mstrmojo.provide("mstrmojo.ACL.UserDataService",{topgroups:null,userCandidates:null,getMembers:function(G,E){var F={taskId:"getUserEntityInfo",blockBegin:G.blockBegin,blockCount:G.blockCount,userEntityID:G.data.did,userEntityName:G.data.n||"",incremental:true,outputElements:G.outputElements||3};mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);},getTopLevelGroups:function D(G,F){var E=this;if(this.topgroups){F.success({items:this.topgroups});return ;}F.success=mstrmojo.func.composite([F.success,function(H){E.topgroups=H.items;}]);this.getUsers({topGroupsOnly:true},F);},searchUserCandidates:function C(F,I,G,E){var H={blockBegin:1,blockCount:G,searchPattern:F,nameWildcards:I?4:2};this.getUsers(H,E);},getUserCandidates:function B(H,G){if(this.userCandidates){G.success(this.userCandidates);return ;}var E=G.success,F=this;G.success=function(J){F.userCandidates={items:J.items,isComplete:(parseInt(J.bc,10)===-1||(J.bb+J.bc>J.sz))};E(F.userCandidates);};var I={blockBegin:1,blockCount:H,nameWildcards:1};this.getUsers(I,G);},getUsers:function A(G,E){var F={taskId:"getUserServices"};mstrmojo.hash.copy(G,F);mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants");var C=mstrmojo.DI.DIConstants;mstrmojo.DI.model._ConnectLive=mstrmojo.provide("mstrmojo.DI.model._ConnectLive",{isDirectDataAccess:false,origIsDirectDataAccess:false,connectLiveSupport:C.connectLiveSupport.connectLiveSupportUnknown,isSupportedDDASource:function B(D){var E;switch(D){case C.sourceSubtype.querybuilder:case C.sourceSubtype.hadoop:case C.sourceSubtype.googleBigQuery:case C.sourceSubtype.googleBigQueryFFSQL:case C.sourceSubtype.googleBigQuerySingleTable:case C.sourceSubtype.searchOnSource:case C.sourceSubtype.mdx:case C.sourceSubtype.remoteProject:case C.sourceSubtype.hanaSingleTable:E=true;break;default:E=false;break;}return E;},isDDAOnlySource:function B(D){var E;switch(D){case C.sourceSubtype.searchOnSource:case C.sourceSubtype.mdx:case C.sourceSubtype.remoteProject:case C.sourceSubtype.hanaSingleTable:E=true;break;default:E=false;break;}return E;},canAddToDDACube:function A(D,I){var H,E=-1,J=-1,G;if(!this.isDirectDataAccess){return true;}if(D===C.sourceSubtype.importfromcube){return true;}H=this.isSupportedDDASource(D);var F=this.getAllTableID();if(F.length>0){G=this.importSources[F[0]];E=G.subtype;J=G.databaseType;if(E===C.sourceSubtype.googleBigQueryFFSQL||E===C.sourceSubtype.googleBigQuerySingleTable){E=C.sourceSubtype.googleBigQuery;}if(D!==E){H=false;}if(I&&I!==J){H=false;}}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASFFSQLRootController=mstrmojo.provide("mstrmojo.AS.ASFFSQLRootController",{onFinishButtonClick:function C(D){if(window.mstrAppSchema){window.mstrAppSchema.callbacks.freeformSQLCallback(D);}mstrApp.getRootController().exitApplication();},autoMapFFSQL:function A(F){var D=mstrApp.getRootController(),E=D.model;var G={path:"/ffsql/results",form:JSON.stringify(F),method:"POST"};var H={success:function(I){try{var K=I.body;if(I.httpStatus===500&&K.message){mstrmojo.alert(K.message);return ;}E.mappings=[];for(var J=0;J<K.rows.length;J++){for(var M=0;M<K.rows[J].length;M++){if(K.rows[J][M]===null){K.rows[J][M]="";}}}E.dataset=K.rows;K.headers.forEach(function(N){E.mappings.push({n:N.name,ix:N.index,dtp:B.columnDataTypes[N.datatype]});});E.raiseEvent({name:"dataPreview",mappings:E.mappings,dataset:E.dataset,selectedColumns:E.selectedClns,isRefined:E.isRefined});}catch(L){mstrmojo.alert("Error! Data from spark is unexpected.");}}};D.dataService.archSpark(H,G,{showCancel:true});}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");var H=mstrmojo.array,B=mstrmojo.hash,J=B.isEmpty;var G=1;function D(Q){return(typeof Q==="object")?Q:{};}function E(R,Q){B.forEach(Q,function(S,W){var U=R[W];if(U===undefined){delete Q[W];return true;}S=Q[W]=D(S);U=R[W]=D(U);if(J(S)&&J(U)){throw (G);}else{if(J(U)){delete R[W];if(J(R[W])){E(R,Q);}}else{if(J(S)){delete R[W];if(J(R[W])){E(R,Q);}}else{try{E(R[W],Q[W]);}catch(V){switch(V){case G:R[W]=Q[W]={};break;}}}}}});}function I(Q){B.forEach(Q,function(R){B.forEach(R,function(V,S){var U=V.include,X=V.exclude;if(J(U)||J(X)){return true;}if(!J(U)&&!J(X)){try{E(X,U);}catch(W){switch(W){case G:R[S]={};break;}}}});});return Q;}function F(S,R,Q){B.forEach(S,function(V,U){if(V===true||J(V)){Q.push(R+U);}else{F(V,R+U+".",Q);}});return Q;}function P(Q){B.forEach(Q,function(R){B.forEach(R,function(V,S){var U=[];F(V.include,"",U);F(V.exclude,"!",U);R[S]=U.join(";");});});return Q;}function K(Q,R){B.forEach(Q,function(S,V){var U=R[V];if(U!==undefined){if(S!==true&&U!==true){K(S,U);}else{if(S===true&&U!==true){R[V]=true;}else{if(S!==true&&U===true){Q[V]=true;}}}}});}function L(R,S){var Q=true;B.forEach(R,function(Z,U){var X=S[U];if(X){var V=Z.include,a=Z.exclude,Y=X.include,W=X.exclude;if(!J(W)&&!J(a)){Q=false;return Q;}if(!J(Y)&&!J(V)){K(Y,V);}}return Q;});return Q;}function C(S,Q){Q=Q||{};if(S){var R=Q;H.forEach(S.split("."),function(X,V,U,W){R[X]=W?true:{};R=R[X];});}return Q;}mstrmojo.rw.model.RetrievalKeysConfig=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.rw.model.RetrievalKeysConfig",init:function M(){this.nodes=[];this.filters={};},addNode:function A(R,U){var S=this.filters,Q=S[R];if(!Q){this.nodes.push(R);Q=S[R]={data:{},defn:{}};}if(U){if(L(Q,U)){S[R]=B.mergeHashes(Q,U);}else{throw ("The new filters for node key ## cannot be merged with the filters currently defined".replace("##",R));}}return this;}});mstrmojo.rw.model.RetrievalKeysConfig.getConsolidatedConfig=function O(U){var Q={},V={},S={};H.forEach(U,function R(X){var W=X.partialRetrieval;if(W){H.forEach(W.nodes,function(Y){V[Y]=true;});S=B.mergeHashes(S,W.filters);delete X.partialRetrieval;}H.forEach(X.actions,R);});if(!J(V)){Q.nodes=B.keyarray(V);}if(!J(S)){Q.filters=P(I(S));}return Q;};mstrmojo.rw.model.RetrievalKeysConfig.parseResponseFilters=function N(R){var Q=function(U){var S={};B.forEach(U,function(X,W){var V=S[W]={serialized:X,include:{},exclude:{}};H.forEach(X.split(";"),function(Z){var Y=Z.indexOf("!")===0;Z=Y?Z.slice(1):Z;C(Z,Y?V.exclude:V.include);});});return S;};return{data:Q(R.data),defn:Q(R.defn)};};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var O=/this\.([\w\.\[\]\'\"\-]+)/m,D=/this\./m,M=/mstrmojo\.all\[[\'\"]([\w]+)[\'\"]\]\.([\w\.\[\]\'\"\-]+)/m,R=/mstrmojo\.all\[/m,L=/mstrmojo\.all\.([\w]+)\.([\w\.\[\]\'\"\-]+)/m,B=/mstrmojo\.all\./m,C=/\[(\d+)\]/g,E=/\[\'([\w\-]+)\'\]/g,P=/\[\"([\w\-]+)\"\]/g,H=/([\[\]].*)/;mstrmojo.Binding=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Binding",parent:null,source:null,destination:null,enabled:false,setter:"set",executing:0,init:function N(S){mstrmojo.hash.copy(S,this);mstrmojo.registry.add(this);},destroy:function F(){mstrmojo.publisher.clearSubscriptions(this.id);mstrmojo.registry.remove(this);},exec:function K(){this.executing++;var X=this._sourceFn;if(!X){var W=this.source;if(W!=null){if(typeof (W)=="string"){if(!(W.match("return "))&&!(W.match(/\;\s*\S/))){W="return "+W;}X=new Function(W);}else{if(typeof (W)=="function"){X=W;}}this._sourceFn=X;}}var S,Y=this.parent;if(X){try{S=X.apply(Y,[]);}catch(V){}}var U=this.setter,Z=this.destination;if(U==null){Y[Z]=S;}else{if(typeof (U)=="string"){Y[U](Z,S);}else{if(typeof (U)=="function"){U.apply(Y,[Z,S]);}}}this.executing--;},enable:function A(){if(!this.enabled){this.exec();var U=this._chains;if(!U){this._parseChains();U=this._chains;}for(var S in U){this._attachChain(U[S]);}this.enabled=true;}},disable:function J(){if(this.enabled){var U=this._chains;if(U){for(var S in U){this._detachChain(U[S]);}}this.enabled=false;}},_chains:null,_parseChains:function(){this._chains={};var V=this._chains;var U=this.source;if(U&&(typeof (U)=="function")){U=U.toString&&U.toString();}if(!U){return ;}function S(c,f,W,Y){var X=c,a;while(a=X.match(f)){var d=a[0],b=d.length,e=true;d=d.replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"");for(var Z in V){if(Z.substr(0,b)===d){e=false;break;}else{if(d.indexOf(Z)===0){delete V[Z];}}}if(e){V[d]={host:(W==null)?null:a[W],parts:a[Y].replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"").split(".")};}X=X.substr(a.index+b);}}if(D.test(U)){S(U,O,null,1);}if(R.test(U)){S(U,M,1,2);}if(B.test(U)){S(U,L,1,2);}},_attachChain:function Q(S,V){if(!S.evt2idx){S.evt2idx={};}if(!S.idx2evt){S.idx2evt=[];}var e=S.evt2idx,h=S.idx2evt,a=S.parts;var f=(V>=0)?V:0,c=this.id,X=mstrmojo.all,d=(V>0)?X[h[f-1].context][a[f-1]]:(S.host?X[S.host]:this.parent),U=a[f];var W=mstrmojo.array;while(d&&U){if(d.attachEventListener){var g=d[U+"_bindEvents"]||(U+"Change");if(typeof (g)=="string"){g=[g];}var Z=[];for(var b=0,Y=g.length;b<Y;b++){Z[b]=d.attachEventListener(g[b],c,"_callback");}for(var b=0;b<g.length;b++){e[d.id+"_"+g[b]]=f;}h[f]={context:d.id,evts:g,subs:Z};}d=d[U];U=S.parts[++f];}},_detachChain:function G(S,U){var V=mstrmojo.all,k=S.idx2evt,e=S.evt2idx,b=this.id;var Z=(U>-1)?U:0,c=k.length;if(Z<c){for(;Z<c;Z++){var a=k[Z];if(!a){break;}var X=a.context,d=V[X],h=a.evts;if(d&&d.detachEventListener){var l=a.subs;for(var g=0,W=l.length;g<W;g++){d.detachEventListener(l[g]);}}k[Z]=null;for(var Y=0,f=h.length;Y<f;Y++){delete e[X+"_"+h[Y]];}}}},_callback:function I(U){this.exec();if(!U||!U.name||!U.src){return ;}var V=U.src.id+"_"+U.name,X=this._chains;for(var Y in X){var W=X[Y],S=W.evt2idx[V];if(S!=null){this._detachChain(W,S+1);this._attachChain(W,S+1);}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var K=mstrmojo.array,D=mstrmojo.hash;function E(W,U){var X=[],Q=W.selectedIndices,P=W.allIdx;var R,S,V=W.items;if(W.multiSelect&&(P>-1)&&(K.indexOf(U,W.allIdx)>-1)){for(R=0,S=V.length;R<S;R++){if(!Q[R]){X.push(R);Q[R]=true;W.selectedIndex=R;W.selectedItem=V[R];}}}else{for(R=0,S=U.length;R<S;R++){var Y=U[R];if(!Q[Y]){Q[Y]=true;X.push(Y);W.selectedIndex=Y;W.selectedItem=V[Y];}}}return X;}function J(R){var Q=[],S=R.selectedIndices,P;for(P in S){delete S[P];Q.push(parseInt(P,10));}R.selectedIndex=-1;R.selectedItem=null;return Q;}function H(W,V){var S=[],Q=W.selectedIndices,Y=K.indexOf,P=W.allIdx;if(W.multiSelect&&(P>-1)&&(Y(V,P)>-1)){return J(W);}if(V.length>0&&Q[P]){if(Y(V,P)<0){V.push(P);}}var U=V.length,R;for(R=0;R<U;R++){var X=V[R];if(Q[X]){delete Q[X];S.push(X);if(W.selectedIndex===X){W.selectedIndex=-1;W.selectedItem=null;}}}return S;}function A(S,R){var P=S.selectedIndices;if(!P){P={};S.selectedIndices=P;}if(!R){R={};}var V=S.selectedIndex,U=[],W,Q;for(Q in P){if(!R[Q]){W=parseInt(Q,10);delete P[Q];U.push(W);if(V===W){S.selectedIndex=-1;S.selectedItem=null;}}}var Y=[],X=S.items;for(Q in R){if(!P[Q]){W=parseInt(Q,10);P[Q]=true;Y.push(W);S.selectedIndex=W;S.selectedItem=X&&X[W];}}return{add:Y,rmv:U};}function G(Q,P,R){if(Q.raiseEvent&&((P&&P.length)||(R&&R.length))){Q.raiseEvent({name:"change",added:P,removed:R});}}mstrmojo._ListBase2Selections=mstrmojo.provide("mstrmojo._ListBase2Selections",{multiSelect:false,selectedIndices:null,selectedIndex:-1,selectedItem:null,selectedIndices_bindEvents:"change",selectedIndex_bindEvents:"change",selectedItem_bindEvents:"change",allowUnlistedValues:true,insertUnlistedValuesAt:-1,allIdx:-1,singleSelect:function F(P,Q){if(!this.selectedIndices[P]||(this.selectionPolicy==="reselect")||(P!==this.allIdx&&this.selectedIndices[this.allIdx])){var R=J(this),S=E(this,[P]);if(Q!==true){G(this,S,R);}}},toggleSelect:function O(P,Q){var S,R;if(this.selectedIndices[P]){R=H(this,[P]);}else{S=E(this,[P]);}if(Q!==true){G(this,S,R);}},rangeSelect:function N(P,Q){this.singleSelect(P,Q);},clearSelect:function I(P){var Q=J(this);if(P!==true){G(this,null,Q);}},select:function L(R,P){var Q=A(this,K.hash(R));if((P!==true)&&(Q.add.length||Q.rmv.length)){G(this,Q.add,Q.rmv);}},addSelect:function B(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=E(this,R);if(P!==true){G(this,Q,null);}return Q;},removeSelect:function M(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=H(this,R);if(P!==true){G(this,null,Q);}return Q;},_set_selectedIndices:function(S,Q,P){if(this.selectedIndices===Q){return false;}var R=A(this,Q);if(R.add.length||R.rmv.length){if(P!==true){G(this,R.add,R.rmv);}}return false;},_set_selectedIndex:function(S,Q,P){var R={};if(Q>-1){R[Q]=true;}return this._set_selectedIndices(null,R,P);},_set_selectedItem:function(X,U,S){var R=U&&(typeof U==="object"),W=this.itemIdField,Q=-1,V=this.items;if(R&&W!=null){Q=K.find(V,W,U[W]);}else{if(U!=null){Q=K.indexOf(V,U);}}if((Q===-1)&&(U!=null)&&this.allowUnlistedValues){var P=this.insertUnlistedValuesAt;if(P==null||P<0){P=(V&&V.length)||0;}Q=P;this.add([U],Q);}return this._set_selectedIndex(null,Q,S);},initSelections:function C(U,Q,P,S,R){if(!this.selectedIndices){this.selectedIndices={};this.selectedIndex=-1;}if(U){this._set_selectedIndices(null,U,R);}else{if(Q){this.select(Q,R);}else{if(S){this._set_selectedItem(null,S,R);}else{if(P!==null&&P!==undefined){this._set_selectedIndex(null,P,R);}}}}},sortSelectedIndices:function(){return D.keyarray(this.selectedIndices,true).sort(K.numSorter);},removeSelectedItems:function(){var R=this.sortSelectedIndices(),P=R.length,S=R[P-1],Q=this.remove(R);S=Math.min(S+1-P,this.items.length-1);if(S>=0){this.singleSelect(S);}return Q;},getSelectedItems:function(){return K.get(this.items,this.sortSelectedIndices())||[];},setSelectedItems:function(Q,e){if(!Q||!Q.length){return ;}var S=this.items||[],w=this.itemIdField!=null?K.findMulti(S,this.itemIdField,Q):K.indexOfMulti(S,Q),W=Q.length,U=W-w.count,t=this.allowUnlistedValues,d=this.insertUnlistedValuesAt,Y=(t&&(d>-1))?U:0;if(d<0){d=S.length;}var R=[],V=[],g=w.map;if(U&&t){var q=0,f;for(f=0;f<W;f++){if(g[f]==null){R.push(Q[f]);V.push(d+q++);}}this.add(R,d);}var X=[],l;for(l in g){var p=g[l];if(p>=d){p+=Y;}X.push(p);}var u=X.concat(V),Z=this.addSelect(u,!e);if(!e){var a=K.hash(Z),h=this.selectedIndices,b=[],o;for(o in h){if(!a[o]){b.push(parseInt(o,10));}}var P=this.removeSelect(b,true);G(this,Z,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.requiresDescs(2213,3326,3327,3329,4531,13283,13284,13285,13286);mstrmojo.ME.Enum={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EDIT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};},FBFlag:{Automatic:0,Manual:3},AFB:{Automatic:-1,False:0,True:1},SFB:{Automatic:-1,False:1,True:2},UI_OBJECT_TYPE:{Dimty:-1,Sub_Expression:-2,Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},UI_DATA_TYPE:{Sortby:-1,Breakby:-2,Level:-4,Condition:-5,Transformation:-6},SHORTCUT_FUNCTIONS:{Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},DYNAMIC_DIMTY:{CODES:{auto:{n:mstrmojo.desc(4531,"Automatic"),did:"@auto",t:-1},page:{n:mstrmojo.desc(3329,"Grand Total"),did:"@p",t:-1},byCol:{n:mstrmojo.desc(3326,"By Columns"),did:"@cols",t:-1},byRow:{n:mstrmojo.desc(3327,"By Rows"),did:"@rows",t:-1},byCell:{n:mstrmojo.desc(13283,"By Cell"),did:"@cell",t:-1},byShape:{n:mstrmojo.desc(13284,"By Shape"),did:"@shape",t:-1},downCross:{n:mstrmojo.desc(13285,"Down, Then Across"),did:"@cr",t:-1},crossDown:{n:mstrmojo.desc(13286,"Across, Then Down"),did:"@rc",t:-1}},getItems:function D(G){var F=this.CODES,E=[];switch(G){case"breakby":E=[F.auto,A.copy({n:mstrmojo.desc(2057,"None")},A.copy(F.page)),A.copy({n:mstrmojo.desc(122,"Columns")},A.copy(F.byCol)),A.copy({n:mstrmojo.desc(2968,"Rows")},A.copy(F.byRow)),A.copy({n:mstrmojo.desc(13399,"Cell")},A.copy(F.byCell)),A.copy({n:mstrmojo.desc(2923,"Shape")},A.copy(F.byShape))];break;case"level":E=[F.auto,F.page,F.byCol,F.byRow,F.byCell,F.byShape];break;case"sortby":E=[F.auto,F.downCross,F.crossDown];}return E;},getAutomaticDimtyObject:function C(){return A.copy(this.CODES.auto);},getDimtyObject:function B(E,H){var F=null;var G=false;if(H){A.forEach(mstrmojo.ME.Enum.DYNAMIC_DIMTY.CODES,function(I){if(I.did===E){F=A.copy(I);G=true;return false;}});}if(!G){F={n:E,t:-1,dimty:true};}return F;}},NonExposableParams:["IsNewOLAP","OLAPPattern","OLAPHasWindow"]};mstrmojo.ME.Enum.DEFAULT_MPS={mps:{afb:mstrmojo.ME.Enum.AFB.False,sfb:mstrmojo.ME.Enum.SFB.False,fbf:mstrmojo.ME.Enum.FBFlag.Automatic}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array,B=mstrmojo.hash;mstrmojo.models.datasets.DataInterface=mstrmojo.provide("mstrmojo.models.datasets.DataInterface",{getFormsByAttrId:function A(F,E){var D=[];E=E||[];B.forEach(E,function(G){C.forEach(G.att||[],function(H){if(H.did===F){D=D.concat(H.fs||[]);return false;}});});D=C.filter(D,function(G){return !!G.obf;});return C.distinct(D,"fid");}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");var C=mstrmojo.hash,E=mstrmojo.array;function D(F){return function(G){F[G]=true;};}mstrmojo.rw.model.UpdateKeysConfig=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.rw.model.UpdateKeysConfig",init:function B(){this.nodes=[];this.selectors={};this.objects={};}});mstrmojo.rw.model.UpdateKeysConfig.getConsolidatedConfig=function A(J){var F={},K={},G={},I={};E.forEach(J,function H(M){var L=M.partialUpdate;if(L){E.forEach(L.nodes,D(K));E.forEach(L.selectors,D(G));E.forEach(L.objects,function(N){if(!I[N.id]||N.flag>I[N.id].flag){I[N.id]=N;}});delete M.partialUpdate;}E.forEach(M.actions,H);});if(!C.isEmpty(K)){F.nodes=C.keyarray(K);}if(!C.isEmpty(G)){F.selectors=C.keyarray(G);}if(!C.isEmpty(I)){F.objects=C.valarray(I);}return F;};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array;function A(E){var D=(E&&E.gts&&E.gts.col)||[],G=(E&&E.gts&&E.gts.row)||[];var F=C.filter(D.concat(G),function(H){return H.otp===-1;})[0];return{tpltProp:E.prop,mxProp:C.map((F&&F.es)||[],function(H){var I={};I[H.oid]=mstrmojo.hash.copy(H.prop,{n:H.n,t:H.otp});return I;})};}mstrmojo._IsDocumentTemplate=mstrmojo.provide("mstrmojo._IsDocumentTemplate",{_mixinName:"mstrmojo._IsDocumentTemplate",gridInfo:null,tmsProps:null,update:function B(D){if(D&&D.data){this.gridInfo=D.data.gsi;this.tmsProps=A(D.data);}if(this._super){return this._super(D);}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,M=mstrmojo.hash;function J(V){if(V!==null){return(V.constructor!==Array)?[V]:V;}return null;}function F(f,d,Z){if(!d){return null;}var g=[],W=f.selectedIndices,V=f.allIdx,b=f.noneIdx;if(f.multiSelect&&(b>-1)&&(I.indexOf(d,b)>-1)){return g;}var Y,a,e=f.items,c=f.itemIdField,X=f.selectedItems,j;if(f.multiSelect&&(V>-1)&&(I.indexOf(d,f.allIdx)>-1)){for(Y=0,a=e.length;Y<a;Y++){if(!W[Y]){g.push(Y);W[Y]=true;f.selectedIndex=Y;f.selectedItem=e[Y];}}}else{for(Y=0,a=d.length;Y<a;Y++){var h=d[Y];if(!W[h]){W[h]=true;if(Z){g.push({idx:h,positions:Z});}else{g.push(h);}f.selectedIndex=h;j=f.selectedItem=e[h];if(X){X[j[c]]=j;}}}}return g;}function D(Y,V){var X=[],Z=Y.selectedIndices,a=Y.selectedItems,W;for(W in Z){delete Z[W];if(V){X.push({idx:parseInt(W,10),positions:V});}else{X.push(parseInt(W,10));}}Y.selectedIndex=-1;Y.selectedItem=null;if(a){Y.selectedItems={};}return X;}function U(f,e,Z){if(!e){return null;}var b=[],W=f.selectedIndices,h=I.indexOf,V=f.allIdx,c=f.noneIdx,d=f.itemIdField,X=f.selectedItems;if(f.multiSelect&&(((V>-1)&&(h(e,V)>-1))||((c>-1)&&(h(e,c)>-1)))){return D(f);}if(e.length>0&&W[V]){if(h(e,V)<0){e.push(V);}}var a=e.length,Y;for(Y=0;Y<a;Y++){var g=e[Y];if(W[g]){delete W[g];if(Z){b.push({idx:g,positions:Z});}else{b.push(g);}if(X){delete X[f.items[g][d]];}if(f.selectedIndex===g){f.selectedIndex=-1;f.selectedItem=null;}}}return b;}function C(Y,Z,W,V){if(V){return ;}if(this.raiseEvent){if((Y&&Y.length)||(Z&&Z.length)){try{this.raiseEvent({name:"selectionChange",added:Y,removed:Z});}catch(X){U(this,Y);F(this,Z);throw X;}}}}function B(W){var X=this.itemIdField,V=this.items;if(typeof W==="object"&&X){return I.find(V,X,W[X]);}return I.indexOf(V,W);}mstrmojo._ListSelections={multiSelect:false,allIdx:-1,noneIdx:-1,itemIdField:"",items:null,selectedIndices:null,selectedIndex:-1,selectedIndices_bindEvents:"selectionChange",selectedIndex_bindEvents:"selectionChange",selectedItem:null,selectedItem_bindEvts:"selectionChange",allowUnlistedValues:true,selectedItems:null,supportsIncFetch:false,init:function(V){this._super(V);if(this.supportsIncFetch&&this.itemIdField){this.selectedItems={};}if(!this.items){this.items=[];}if(!this.selectedIndices){this.selectedIndices={};if(this.selectedIndex>-1){this._set_selectedIndex("selectedIndex",this.selectedIndex,true);}else{if(this.selectedItem){this._set_selectedItem("selectedItem",this.selectedItem,true);}}}},addItems:function K(e){e=J(e);if(!e){return ;}var b=this.items,V=this.items.length,X=this.selectedItems,Z=[],W;b=this.items=b.concat(e);W=b.length;if(X){var a=this.itemIdField,Y,d;for(Y=V;Y<b.length;Y++){d=b[Y];if(X[d[a]]){Z.push(Y);}}}if(Z&&Z.length){F(this,Z);}if(W>V){var c=this.itemsContainerNode;if(c){c.innerHTML+=this._buildItemsMarkup(V,W-1).join("");}}},addSelectedItems:function S(V){this.selectItems(V,false);},setSelectedItems:function L(V){this.selectItems(V,true);},selectItems:function R(d,f){d=J(d);if(!d){return ;}if(f&&this.selectedItems){this.selectedItems={};}var X=this.selectedItems,b=this.itemIdField,V=[],Z=this.items.length,a=[],W=this.allowUnlistedValues,e,c,Y;for(Y=0;Y<d.length;Y++){e=d[Y];c=B.call(this,e);if(c<0){if(X===null){if(W){V.push(e);c=Z++;a.push(c);}}else{X[e[b]]=e;}}else{a.push(c);}}if(V.length>0){this.addItems(V);}if(a.length>0){if(f){this.select(a);}else{this.addSelect(a);}}},unselectItems:function A(W){W=J(W);if(!W){return ;}var b=this.selectedItems,X=[],a=this.itemIdField,Z,V,Y;if(b===null){return ;}for(Y=0;Y<W.length;Y++){Z=W[Y];if(b){delete b[Z[a]];}V=B.call(this,Z);if(V<0){X.push(V);}}if(X.length>0){this.removeSelect(X);}},getSelectedItems:function G(){if(this.selectedItems){return M.valarray(this.selectedItems);}return I.get(this.items,M.keyarray(this.selectedIndices,true));},singleSelect:function(W,X,V){if(W!==-1){this.select([W],X,V);}},singleSelectByField:function O(W,X,V){this.singleSelect(I.find(this.items,X,W),V);},toggleSelect:function Q(V){var X,W;if(this.selectedIndices[V]){W=U(this,[V]);}else{X=F(this,[V]);}C.call(this,X,W,[V]);},select:function(X,W,V){X=J(X);if(!X){return ;}var Z=D(this,V),b=F(this,X,V),Y;if(this.selectionPolicy!=="reselect"){for(Y=Z.length-1;Y>=0;Y--){var a=I.indexOf(b,Z[Y]);if(a>-1){Z.splice(Y,1);b.splice(a,1);}}}C.call(this,b,Z,X,W);},rangeSelect:function H(W,V){var b=this.selectedIndex,Z=b,a=this.allIdx,X=[],Y;if(W===a||this.selectedIndices[a]){X.push(a);}else{if(Z===-1&&this.selectedIndices){for(Y in this.selectedIndices){Z=parseInt(Y,10);break;}}Z=Z===-1?0:Z;if(Z>W){Z=W;W=b;}for(Y=Z;Y<=W;Y++){X.push(Y);}}this.select(X,V);this.selectedIndex=b;},clearSelect:function(V){C.call(this,null,D(this),[],V);if(!V){this.raiseEvent({name:"clearSelection"});if(this.parent){this.parent.raiseEvent({name:"clearSelection"});}}},addSelect:function(Y,V,W){Y=J(Y);if(!Y){return ;}var X=F(this,Y,W),a=null,Z=this.noneIdx;if(this.multiSelect&&(Z>-1&&I.indexOf(Y,Z)>-1)){a=U(this,Y);}C.call(this,X,a,Y,V);},removeSelect:function(X,V,W){X=J(X);if(!X){return ;}C.call(this,null,U(this,X,W),X,V);},_set_selectedIndices:function P(X,d,V){if(this.selectedItems){this.selectedItems={};}var W=this.selectedIndices;if(W===d){return false;}if(!W){W={};this.selectedIndices=W;}if(!d){d={};}var b=this.selectedIndex,a=[],c;for(c in W){if(!d[c]){c=parseInt(c,10);delete W[c];a.push(c);if(b===c){this.selectedIndex=-1;this.selectedItem=null;}}}var g=[],e=this.items,Z=this.itemIdField,f;for(c in d){if(!W[c]){c=parseInt(c,10);W[c]=true;g.push(c);this.selectedIndex=c;f=this.selectedItem=e[c];if(this.selectedItems){this.selectedItems[f[Z]]=f;}}}if(V!==true){var Y=[];for(c in d){if(W[c]){c=parseInt(c,10);Y.push(c);}}C.call(this,g,a,Y);}return(g.length||a.length);},_set_selectedIndex:function N(Y,W,V){var X={};if(W>-1){X[W]=true;}return this._set_selectedIndices("selectedIndices",X,V);},_set_selectedItem:function E(Y,X,W){var V=B.call(this,X);if((V<0)&&(X!==null&&X!==undefined)&&this.allowUnlistedValues&&this.items){this.set("items",this.items.concat(X));V=this.items.length-1;}return this._set_selectedIndex("selectedIndex",V,W);},_addSelections:function(V){return F(this,V);},_removeAll:function(){return D(this);}};}());mstrmojo.DPIManager={classes:[],registerClass:function registerClass(B,C,D,A){this.classes.push({c:B,d:C,s:D,v:A});},setDPI:function(){var A=mstrMobileApp.getDeviceDPI();mstrmojo.array.forEach(this.classes,function(B){B.c.prototype.layoutConfig[B.d][B.s]=B.v[A]+"px";});this.classes=[];}};(function(){document.msCSSOMElementFloatMetrics=true;mstrmojo.requiresCls("mstrmojo.hash");var S=mstrmojo.hash,H="containerNode",G="auto",Q="px";var I={v:G,c:undefined,sv:G};function E(d,g,f){var h=this._layoutWidgets[g],l=d.slot||H,j=h.f,k=h.p,e=(j&&j[l]!==undefined),c=(k&&k[l]!==undefined);if(l&&((!f&&e)||c)){return e?j[l]:(h.x*parseInt(k[l],10)/100)+Q;}return d[(g==="h")?"height":"width"];}function K(j,e,c){if(j.ignoreLayout){return ;}var d=(e===G)||e==="NaNpx",g=(c===G)||c==="NaNpx";var f=j.getLayoutOffsets&&j.getLayoutOffsets();if(f){if(!d){e=(parseInt(e,10)-f.h)+Q;}if(!g){c=(parseInt(c,10)-f.w)+Q;}}if(j.setDimensions){j.setDimensions(e,c);}else{if(j.set){if(!d){j.set("height",e);}if(!g){j.set("width",c);}}}}function a(f){var d=this.children,j,l;for(j=0,l=(d&&d.length)||0;j<l;j++){var e=d[j],m=e.slot||H;if(m){var k=E.call(this,e,"h",f),n=E.call(this,e,"w",f);this.setSlotDimensions(m,k,n);K(e,k,n);var c=E.call(this,e,"h",f),g=E.call(this,e,"w",f);if(c!==k||g!==n){K(e,c,g);}this.setSlotDimensions(m,c,g);}}this.afterLayout();}function B(){var d=this.children,c=this._layoutWidgets;S.forEach(this.slotNames,function(j,k){if(!j||this.skipsSlotLayout(k)){return ;}var g=(c.h&&c.h.getSlotSizeInfo(k,d))||I,e=(c.w&&c.w.getSlotSizeInfo(k,d))||I,f=g.c||e.c;mstrmojo.array.forEach(f,function(h){K(h,g.v,e.v);});this.setSlotDimensions(k,g.sv,e.sv);},this);this.afterLayout();}function D(d){var c=this.layoutConfig.xt?B:a;c.call(this,d);}function U(k,f,h){var j=k.slot||H,g=f&&f.a;if(!g||g[j]===undefined){return ;}var c=this[j]["offset"+h],e=g[j];if(c===e){return ;}f.x-=(c-e);g[j]=c;}function J(c){this.beforeLayout();var d=this._layoutWidgets,e=c.src;U.call(this,e,d.h,"Height");U.call(this,e,d.w,"Width");D.call(this,true);}function O(e,j){if(!e){return null;}var c=this.children,u=j.toLowerCase(),k=parseInt(this[u],10),m=k,o={},q={},h={},d={},p={},l,n,f,w,t;for(t in e){if(!e.hasOwnProperty(t)){continue;}w=e[t];if(w.match(/px$/)){k-=parseInt(w,10);o[t]=w;}else{if(w.match(/%$/)){q[t]=w;}else{if(w.match(/all/)){p[t]=m;}else{h[t]=w;}}}}if(!S.isEmpty(h)&&!S.isEmpty(q)){for(l=0,n=(c&&c.length)||0;l<n;l++){f=c[l];t=f.slot||H;if(t&&h[t]&&!f.ignoreLayout){if(f.hasRendered){var g=this[t];d[t]=g.getBoundingClientRect?Math.round(g.getBoundingClientRect()[j.toLowerCase()]):g["offset"+j];k-=d[t];}else{d[t]=0;f.attachEventListener((f instanceof mstrmojo.Container)?"childrenRendered":"renderComplete",this.id,J);}}}}return{f:S.isEmpty(o)?undefined:o,p:S.isEmpty(q)?undefined:q,a:S.isEmpty(d)?undefined:d,n:S.isEmpty(p)?undefined:p,x:k,getSlotSizeInfo:function(AF,AA){if(!e[AF]){return I;}var z=mstrmojo.array.filter(AA,function(AH){var AG=AH.slot;return AG===AF||(AF===H&&!AG);}),AD,AE;var x=o[AF];if(x){AE=x;}var AC=q[AF];if(AC){AE=(this.x*parseInt(AC,10)/100)+Q;}if(h[AF]){AE=d[AF];if(AE){AE+=Q;}else{AE=G;}AD=G;}var AB=p[AF];if(AB){AE=AD=AB+Q;}AE=AE||"0px";return{v:AE,c:z,sv:AD||AE};}};}function R(d){var c=this.domNode;if(!c||!this.layoutConfig){return ;}c.style[d]=this[d];this.doLayout();}mstrmojo._HasLayout=mstrmojo.provide("mstrmojo._HasLayout",{_mixinName:"mstrmojo._HasLayout",height:"auto",width:"auto",ignoreLayout:false,beforeLayout:mstrmojo.emptyFn,afterLayout:mstrmojo.emptyFn,forceLayout:false,layoutConfig:null,init:function W(c){this._super(c);this.layoutConfig=S.clone(this.layoutConfig);},preBuildRendering:function C(){var e=this.cssText||"";var c=this.height;if(c&&c!==G){e+="height:"+this.height+";";}var d=this.width;if(d&&d!==G){e+="width:"+this.width+";";}this.cssText=e;return(this._super)?this._super():true;},postBuildRendering:function X(){this.doLayout();return this._super();},modifyLayoutConfig:function Z(e,d){var c=this.layoutConfig=this.layoutConfig||{};c.h=S.copy(e,c.h);c.w=S.copy(d,c.w);this.doLayout();},getLayoutOffsets:mstrmojo.emptyFn,set:function P(e,c){var d=this._super(e,c);if(e==="visible"&&this._pendingLayoutOnVisible){delete this._pendingLayoutOnVisible;this.doLayout();}return d;},doLayout:function A(){var c=this.layoutConfig;if(!c||(this.height===G&&this.width===G)){return ;}if(c.xt){if(!this.visible){this._pendingLayoutOnVisible=true;return ;}}this.beforeLayout();this._layoutWidgets={h:O.call(this,c.h,"Height"),w:O.call(this,c.w,"Width")};D.call(this,false);this.widgetResized();},browserResized:function F(c){this.setDimensions(c.h,c.w);return true;},onwidthChange:function N(){R.call(this,"width");},onheightChange:function M(){R.call(this,"height");},skipsSlotLayout:function(c){return false;},adjustParentDimensions:function L(){var d=this.parent,c=d&&d._layoutWidgets;if(c){U.call(d,this,c.h,"Height");U.call(d,this,c.w,"Width");}},setDimensions:function V(f,d){var e=(f===G)||f==="NaNpx",g=(d===G)||d==="NaNpx";if((!e&&parseInt(this.height,10)!==parseInt(f,10))||(!g&&parseInt(this.width,10)!==parseInt(d,10))||this.forceLayout){if(!e){this.height=f;}if(!g){this.width=d;}var c=this.domNode,j=c&&c.style;if(j){if(!e){j.height=f;}if(!g){j.width=d;}this.doLayout();}return true;}return false;},setSlotDimensions:function Y(f,e,d){var c=this[f]&&this[f].style;if(!c){return ;}if(e!==G&&e!==undefined&&e!=="NaNpx"&&c.height!==e&&parseInt(e)>=0){c.height=e;}if(d!==G&&d!==undefined&&d!=="NaNpx"&&c.width!==d&&parseInt(d)>=0){c.width=d;}}});mstrmojo._HasLayout.getSlotSize=function b(f,g){var d=f&&f.prototype.layoutConfig;if(d){var e=d.h,c=d.w;return{h:(e&&e[g])||undefined,w:(c&&c[g])||undefined};}return null;};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources");function D(H){this.cleanUpAfterTarget(H);var G=H.tgtData;if(G){delete H.tgtData;}var I=this.getContextDragData(H);if(I&&I.setAvatarClass){I.setAvatarClass("");}}mstrmojo.vi.ui._IsDropTarget=mstrmojo.provide("mstrmojo.vi.ui._IsDropTarget",{_mixinName:"mstrmojo.vi.ui._IsDropTarget",dropZone:true,getDropAvatarIcon:function B(G){return"add";},getContextDragData:function F(G){return G.getCtxtDragData();},cleanUpAfterTarget:mstrmojo.emptyFn,ondragenter:function A(G){var H=this.getContextDragData(G);if(H&&H.setAvatarClass){H.setAvatarClass(this.getDropAvatarIcon(G));}if(this._super){this._super(G);}},ondragleave:function E(G){D.call(this,G);if(this._super){this._super(G);}},ondrop:function C(G){D.call(this,G);if(this._super){this._super(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumAuthenticationModes");var A=mstrmojo.EnumAuthenticationModes;function C(G){var H,F,E={success:function(I){H=I.identityToken;},complete:function(){if(H){G=G+"?idToken="+H;}F.location.href=G;}};if(mstrConfig.seamlessLoginEnabled){if(mstrConfig.authMode===A.INTEGRATED.toString()){G+="?loginMode="+A.INTEGRATED;window.open(G,"_blank");}else{F=window.open();mstrmojo.xhr.request("GET",mstrConfig.taskURL,E,{taskId:"createIdentityToken"});}}else{window.open(G,"_blank");}}function D(){return mstrConfig&&mstrConfig.features&&mstrConfig.features["show-dossier-library-link"]&&!!mstrConfig.libraryWebBaseURL;}function B(F){var E=mstrConfig.libraryWebBaseURL+"app";if(F){E+="/"+mstrConfig.projectId+"/"+F;}return E;}mstrmojo.util.LibraryHelper=mstrmojo.provide("mstrmojo.util.LibraryHelper",{createTokenAndOpenLink:C,isLibraryConfigured:D,constructLibraryUrl:B});})();(function(){mstrmojo.requiresCls("mstrmojo.array");var A=mstrmojo.array;mstrmojo.fe._IsRelationTreeNode=mstrmojo.provide("mstrmojo.fe._IsRelationTreeNode",{createSetHtml:'<span class="mstrmojo-textset mstrmojo-create-set-text" mstrAttach:click >'+mstrmojo.desc(12034,"Create a Set")+"</span>",syncRootOperator:function(){var F=this.parent,H=function(){var J=this.parent,I=[];if(J){I=J.ctxtBuilder.itemWidgets;}return I;},E,D,B,C,G;if(F){E=H.call(this);B=E.length;D=A.find(E,"noRelationOperator",true)!==-1;for(C=0;C<B;C++){G=E[C];G&&G.set("noRelationOperator",D);}this.set("noRelationOperator",D);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var I="#000000",E=Math.round;function O(Z){return("0"+parseInt(Z,10).toString(16)).slice(-2);}mstrmojo.color=mstrmojo.provide("mstrmojo.color",{rgbStr2rgb:function X(Z){if(Z==="transparent"){return["0","0","0"];}else{return Z.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i).slice(1);}},rgbStr2hex:function G(Z){if(Z.indexOf("rgb")>=0){var a=this.rgbStr2rgb(Z);return"#"+this.rgb2hex(a[0],a[1],a[2]);}return Z;},rgb2hex:function B(c,a,Z){return O(c)+O(a)+O(Z);},rgb2hsv:function W(Z,j,l){var e=Math.min(Z,j,l),m=Math.max(Z,j,l),f=0,p,o;o=m/255;p=(m!==0)?(parseFloat(m)-parseFloat(e))/parseFloat(m):0;if(p===0){f=0;}else{var k=m-e,a=(m-Z)/k,c=(m-j)/k,n=(m-l)/k;if(Z===m){f=n-c;}else{if(j===m){f=2+a-n;}else{f=4+c-a;}}f=f/6;if(f<0){f=f+1;}}return[E(f*360),E(p*100),E(o*100)];},rgb2hsl:function D(Z,e,f){Z/=255;e/=255;f/=255;var j=Math.max(Z,e,f),c=Math.min(Z,e,f),a=(j+c)/2,d,m;if(j===c){d=m=0;}else{var k=j-c;m=a>0.5?k/(2-j-c):k/(j+c);switch(j){case Z:d=(e-f)/k+(e<f?6:0);break;case e:d=(f-Z)/k+2;break;case f:d=(Z-e)/k+4;break;}d/=6;}return[d,m,a];},hsl2rgb:function C(f,m,e){var d=function d(h,g,b){if(b<0){b+=1;}if(b>1){b-=1;}if(b<1/6){return h+(g-h)*6*b;}if(b<1/2){return g;}if(b<2/3){return h+(g-h)*(2/3-b)*6;}return h;},Z,j,k;if(m===0){Z=j=k=e;}else{var a=e<0.5?e*(1+m):e+m-e*m,c=2*e-a;Z=d(c,a,f+1/3);j=d(c,a,f);k=d(c,a,f-1/3);}return[E(Z*255),E(j*255),E(k*255)];},hsl2hex:function J(b,a,Z){return"#"+mstrmojo.array.map(this.hsl2rgb(b,a,Z),function(c){return O(c);}).join("");},hex2rgb:function Q(c){var Z=this.fixFullHexValue("#"+c.replace("#","")),a=[],b;Z=Z.replace("#","");for(b=0;b<3;b++){a.push(parseInt(Z.substr(b*2,2),16));}return a;},hex2bgr:function L(Z){return this.hex2rgb(Z).reverse();},hex2hsv:function U(a){var Z=this.hex2rgb(a);return this.rgb2hsv(Z[0],Z[1],Z[2]);},hex2hsl:function Y(Z){return this.rgb2hsl.apply(this,this.hex2rgb(Z));},hsv2rgb:function H(k,w,o){k=k/360;w=w/100;o=o/100;var Z,l,n;if(w===0){Z=o*255;l=o*255;n=o*255;}else{var d=k*6;if(d===6){d=0;}var j=Math.floor(d);var c=o*(1-w);var a=o*(1-w*(d-j));var u=o*(1-w*(1-(d-j)));var m,e,f;switch(j){case 0:m=o;e=u;f=c;break;case 1:m=a;e=o;f=c;break;case 2:m=c;e=o;f=u;break;case 3:m=c;e=a;f=o;break;case 4:m=u;e=c;f=o;break;default:m=o;e=c;f=a;break;}Z=m*255;l=e*255;n=f*255;}return[E(Z),E(l),E(n)];},hsv2hex:function M(c,b,Z){var a=this.hsv2rgb(c,b,Z);return this.rgb2hex(a[0],a[1],a[2]);},getContrastingColor:function N(c,a,Z){var b=this.hex2rgb(c);return(((b[0]*299)+(b[1]*587)+(b[2]*114))/1000<125)?a:Z;},getLuminance:function F(a){var Z=this.hex2rgb(a);return 0.2126*Z[0]+0.7152*Z[1]+0.0722*Z[2];},getHighlightColor:function S(j,f){var Z,h,k,l,m=this.hex2rgb(!f?"#FFCE7F":"#EFE6D8"),e=parseInt(j[0],10),c=parseInt(j[1],10),o=parseInt(j[2],10),d=parseInt(m[0],10),a=parseInt(m[1],10),n=parseInt(m[2],10);Z=(e*d)/255;h=(c*a)/255;k=(o*n)/255;l=e*0.3+c*0.59+o*0.11;if(l<85){Z=Z+(63*(85-l)/85);Z=Z>255?255:Z;h=h+(63*(85-l)/85);h=h>255?255:h;k=k+(63*(85-l)/85);k=k>255?255:k;}return"#"+this.rgb2hex(E(Z),E(h),E(k));},get3DBorderColor:function R(c,f){var a=parseInt(c[0],10)*0.3+parseInt(c[1],10)*0.59+parseInt(c[2],10)*0.11;var e=parseInt(c[0],10);var d=parseInt(c[1],10);var Z=parseInt(c[2],10);switch(f){case"light":if(a>150){e=e*0.9;d=d*0.9;Z=Z*0.9;}else{e=e*0.6+102;d=d*0.6+102;Z=Z*0.6+102;}break;case"dark":if(a>10){e=e*0.4;d=d*0.4;Z=Z*0.4;}else{e=e*0.8+30;d=d*0.8+30;Z=Z*0.8+30;}break;}return"#"+this.rgb2hex(E(e),E(d),E(Z));},encodeColor:function K(Z,a){if(a!==undefined&&(Z===null||Z.length===0||Z==="undefined")){Z=a;}if(Z==="transparent"){return -1;}if(parseInt(Z,10)===-2){return -2;}if(Z.substring(0,1)==="#"){Z=Z.substring(1);}return parseInt(Z.substring(4)+Z.substring(2,4)+Z.substring(0,2),16);},decodeColor:function A(Z){Z=parseInt(Z,10);if(Z===0){return I;}var a=16777216+(Z&255)*65536+(Z&65280)+(Z&16711680)/65536;return"#"+a.toString(16).substring(1).toUpperCase();},fixFullHexValue:function V(Z){if(Z&&Z.length===4){return Z.replace(/([0-9a-f])/ig,"$1$1");}return Z;},findMidColorHex:function P(c,b){var d=this.hex2rgb(c),Z=this.hex2rgb(b),a=[];d.forEach(function(e,f){a.push(parseInt((e+Z[f])/2,10));});return("#"+this.rgb2hex(a[0],a[1],a[2]));}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var B=mstrmojo.array;function A(C){if(C.parent){if(C.parent.shouldEllipsizeChildren===undefined){mstrmojo.mixin(mstrmojo._HasEllipsis,C.parent);}C.parent.set("shouldEllipsizeChildren",true);}}mstrmojo._HasEllipsis=mstrmojo.provide("mstrmojo._HasEllipsis",{shouldEllipsize:false,shouldEllipsizeChildren:false,doEllipsize:function(){if(this.shouldEllipsizeChildren){B.forEach(this.children,function(D,C){if(D.hasRendered&&D.doEllipsize){D.doEllipsize();}});}},onshouldEllipsizeChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsize,this.shouldEllipsizeChildren);},onshouldEllipsizeChildrenChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsizeChildren,this.shouldEllipsize);},_onEllipsizeFlagChange:function(D,C){if(D&&!C){A(this);this.markupMethods=mstrmojo.mixin({onvisibleChange:function(){if(this._super){this._super();}if(this.visible&&this.hasRendered){this.doEllipsize();}}},mstrmojo.hash.copy(this.markupMethods));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var E="*",A=".",C="-",J="_",H="<";var M=new RegExp("[\\"+E+"\\"+A+"\\"+C+"\\"+J+"\\"+H+"]","g"),G=E+"$&";mstrmojo.Serializer={scriptClass:"mstrmojo.Serializer",serializeValueGroup:function F(B){mstrmojo.array.forEach(B,function(D,K){B[K]=mstrmojo.Serializer.serializeValues(D);});return C+this.serializeValues(B)+J;},serializeValues:function I(D){var B=[];mstrmojo.array.forEach(D,function(K){if(typeof K==="Boolean"){K=K?"1":"0";}B.push(String(K).replace(M,G));});return B.join(A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var I=mstrmojo.array,Q=mstrmojo.desc(2412,"Default"),P=mstrmojo.desc(3433,"Font"),K=mstrmojo.desc(3434,"Number"),D=mstrmojo.desc(3435,"Alignment"),N=mstrmojo.desc(2886,"Borders"),E=mstrmojo.desc(3905,"Background"),R="-1,234.12",C="1,234.12",M="(1,234.12)",H="-$1,234.12",B="$1,234.12",J="($1,234.12)";var O=[{n:Q,v:"pru"}];I.forEach(["Arial","Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Bookshelf Symbol 1","Bookshelf Symbol 2","Bookshelf Symbol 3","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Open Sans SemiBold","Open Sans","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Wingdings 2","Wingdings 3"],function(S){O.push({n:S,v:S,symbolic:true});});function G(U,S,V){return(S&&S>=U)?G(U,S-V,V).concat(S):[];}var A=G(2,12,1);A=A.concat(G(14,24,2));A=A.concat(G(36,48,12));A=A.concat(G(72,72,1));var F=[{n:Q,v:"pru"}];I.forEach(A,function(S){F.push({n:String(S),v:String(S)});});mstrmojo._FormatDefinition={Formats:[{n:P},{n:K},{n:D},{n:mstrmojo.desc(3436,"Color and Lines")}],FormatTarget:[{n:mstrmojo.desc(7942,"Element Header"),v:1,p:"header_format"},{n:mstrmojo.desc(7943,"Element Value"),v:2,p:"grid_format"},{n:mstrmojo.desc(7944,"Individual Items Header"),v:3,p:"child_header_format"},{n:mstrmojo.desc(7945,"Individual Items Value"),v:4,p:"child_grid_format"}],MetricFormatTarget:[{n:mstrmojo.desc(9710,"Metric Headers"),v:1,p:"header_format"},{n:mstrmojo.desc(9711,"Metric Values"),v:2,p:"grid_format"}],MetricValueFormats:[{n:K},{n:D},{n:P},{n:N},{n:E}],MetricHeaderFormats:[{n:K},{n:D},{n:P},{n:N},{n:E},{n:mstrmojo.desc(12139,"Chart")}],NumberFormatCategory:{Automatic:-3,Default:-2,General:9,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7},DefaultFormat:{FormattingAlignment:{Horizontal:"1",Vertical:"1",TextWrap:"0",TextDirection:"0"},FormattingBorder:{HInsideStyle:"1",VInsideStyle:"1",TopStyle:"1",LeftStyle:"1",BottomStyle:"1",RightStyle:"1",HInsideColor:"0",VInsideColor:"0",TopColor:"0",LeftColor:"0",BottomColor:"0",RightColor:"0",Border3DStyle:"0",Border3DWeight:"0",Border3DBottomColor:"0",Border3DLeftColor:"0",Border3DRightColor:"0",Border3DTopColor:"0"},FormattingFont:{Name:"Arial",Bold:"0",Italic:"0",Size:"10",Strikeout:"0",Underline:"0",Color:"0",Script:"0"},FormattingNumber:{Category:"9",DecimalPlaces:"0",ThousandSeparator:"-1",CurrencySymbol:"$",CurrencyPosition:"0",Format:"General",NegativeNumbers:"3"},FormattingPadding:{LeftPadding:"1",RightPadding:"1",TopPadding:"1",BottomPadding:"1",LineSpacing:"0"},FormattingPatterns:{FillColor:"16777215",PatternColor:"8650752",PatternStyle:"1",FillStyle:"0",ApplyToGraphThreshold:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0",SelectorSelectionColor:"16167264",SelectorSelectionFillStyle:"0",SeriesFillColor:"pru",SeriesPatternColor:"8650752",SeriesPatternStyle:"1",SeriesFillStyle:"0",SeriesApplyToGraphThreshold:"0",SeriesGradientColor:"16777215",SeriesGradientAngle:"0",SeriesGradientXOffset:"0",SeriesGradientYOffset:"0",SeriesSelectorSelectionColor:"16167264",SeriesSelectorSelectionFillStyle:"0"}},Families:O,Sizes:F,SizesInVI:F.slice(7,19),Styles:[{n:Q,v:"pru"},{n:mstrmojo.desc(3440,"Regular"),v:"0,0"},{n:mstrmojo.desc(2718,"Bold"),v:"-1,0",v2:"-1,"},{n:mstrmojo.desc(2719,"Italic"),v:"0,-1",v2:",-1"},{n:mstrmojo.desc(3441,"Bold Italic"),v:"-1,-1"}],Effects:[{n:"Underline",v:0},{n:"Strike",v:1}],Category:[{n:Q,v:-2},{n:mstrmojo.desc(2378,"General"),v:9},{n:mstrmojo.desc(2050,"Fixed"),v:0},{n:mstrmojo.desc(2051,"Currency"),v:1},{n:mstrmojo.desc(2052,"Date"),v:2},{n:mstrmojo.desc(2170,"Time"),v:3},{n:mstrmojo.desc(2053,"Percentage"),v:4},{n:mstrmojo.desc(2054,"Fraction"),v:5},{n:mstrmojo.desc(2055,"Scientific"),v:6},{n:mstrmojo.desc(2056,"Custom"),v:7}],MaxNegativeDidigts:30,FixedNegative:[{n:R,v:1,f:"#,##0.00"},{n:R,r:true,v:5,f:"#,##0.00;[RED]-#,##0.00"},{n:C,r:true,v:2,f:"#,##0.00;[RED]#,##0.00"},{n:M,v:3,f:"#,##0.00;(#,##0.00)"},{n:M,r:true,v:4,f:"#,##0.00;[RED](#,##0.00)"}],CurrencyNegative:[{n:H,v:1,f:'"$"#,##0.00'},{n:H,r:true,v:5,f:'"$"#,##0.00;[RED]-"$"#,##0.00'},{n:B,r:true,v:2,f:'"$"#,##0.00;[RED]"$"#,##0.00'},{n:J,v:3,f:'"$"#,##0.00;("$"#,##0.00)'},{n:J,r:true,v:4,f:'"$"#,##0.00;[RED]("$"#,##0.00)'}],CurrencyPosition:[{n:mstrmojo.desc(2194,"Left"),v:0},{n:mstrmojo.desc(2195,"Right"),v:1},{n:mstrmojo.desc(2183,"Left with space"),v:2},{n:mstrmojo.desc(2182,"Right with space"),v:3}],Date:[{n:mstrmojo.desc(2231,"4/7"),v:"m/d"},{n:mstrmojo.desc(2232,"04/07"),v:"mm/dd"},{n:mstrmojo.desc(2233,"4/7/98"),v:"m/d/yy"},{n:mstrmojo.desc(2234,"04/07/98"),v:"mm/dd/yy"},{n:mstrmojo.desc(2235,"04/07/1998"),v:"mm/dd/yyyy"},{n:mstrmojo.desc(2236,"7-Apr"),v:"d-mmm"},{n:mstrmojo.desc(2237,"7-Apr-98"),v:"d-mmm-yy"},{n:mstrmojo.desc(2238,"Apr-98"),v:"mmm-yy"},{n:mstrmojo.desc(2239,"Apr '98"),v:"mmm 'yy"},{n:mstrmojo.desc(2240,"April 1998"),v:"mmmm yyyy"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2243,"April 7, 1998"),v:"mmmm d, yyyy"}],Time:[{n:mstrmojo.desc(2244,"15:41"),v:"h:mm"},{n:mstrmojo.desc(2245,"3:41 PM"),v:"h:mm AM/PM"},{n:mstrmojo.desc(2246,"15:41:46"),v:"h:mm:ss"},{n:mstrmojo.desc(2247,"3:41:46 PM"),v:"h:mm:ss AM/PM"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2250,"04/07/98 15:41"),v:"mm/dd/yy h:mm"},{n:mstrmojo.desc(2248,"04/07/98 3:41 PM"),v:"mm/dd/yy h:mm AM/PM"}],PercentNegative:[{n:"-12.12%",v:1,f:"0.00%"},{n:"-12.12%",r:true,v:5,f:"0.00%;[RED]-0.00%"},{n:"12.12%",r:true,v:2,f:"0.00%;[RED]0.00%"},{n:"(12.12%)",v:3,f:"0.00%;(0.00%)"},{n:"(12.12%)",r:true,v:4,f:"0.00%;[RED](0.00%)"}],Fraction:[{n:"12 1/3",v:"# ?/?"},{n:"37/3",v:"?/?"},{n:"12 26/81",v:"# ??/??"},{n:"998/81",v:"??/??"}],TextDirection:[{n:Q,v:"pru"},{n:mstrmojo.desc(4601,"Horizontal"),v:0},{n:mstrmojo.desc(5156,"-90 Degree"),v:-90}],Horizontal:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2378,"General"),v:1},{n:mstrmojo.desc(2194,"Left"),v:2},{n:mstrmojo.desc(2193,"Center"),v:3},{n:mstrmojo.desc(2195,"Right"),v:4},{n:mstrmojo.desc(2068,"Justify"),v:6}],Vertical:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2256,"Top"),v:1},{n:mstrmojo.desc(2067,"Center"),v:2},{n:mstrmojo.desc(2257,"Bottom"),v:3}],TextWrap:[{v:0},{v:-1}],BorderStyles:[{n:Q,v:"pru"},{n:mstrmojo.desc(2258,"None"),v:0},{n:mstrmojo.desc(2259,"Dashed"),v:3},{n:mstrmojo.desc(2260,"Dotted"),v:4},{n:mstrmojo.desc(2261,"Hair"),v:7},{n:mstrmojo.desc(2262,"Thin"),v:1},{n:mstrmojo.desc(2264,"Thick"),v:5},{n:mstrmojo.desc(15361,"Double"),v:6}],extractModel:function(V,X,U){var Z=U||this.DefaultFormat,Y;for(Y in V){var S=V[Y];if(!S.attachEventListener){if(!mstrmojo.hash.isEmpty(S)){X[Y]=S;}}else{var W;for(W in S){if(Z[Y]&&Z[Y][W]){if(!X[Y]){X[Y]={};}X[Y][W]=S[W];}}}}},getAvailableFonts:function L(){var S={success:function(V){if(V.name==="fontPicker"){var U=[{n:Q,v:"pru"}];I.forEach(V.shortcuts,function(X){var Y=X.attributes,Z=I.filterOne(Y,function(a){return a.value;}),W=I.filterOne(Y,function(a){return a.symbolic;});U.push({n:Z&&Z.value,v:Z&&Z.value,symbolic:(W&&W.symbolic||"false").toUpperCase()==="TRUE"});});mstrmojo._FormatDefinition.Families=U;}}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,S,{taskId:"getSystemPickerJson",name:"fontPicker"},false,null,true);},getStandardFormat:function(U,S){var W=mstrmojo.hash.clone(S||this.DefaultFormat),V;U=U||{};for(V in W){U[V]=U[V]||{};}for(V in U){if(!U[V].attachEventListener){U[V]=mstrmojo.hash.make(U[V],mstrmojo.Obj);}}return U;},saveFormatModel:function(X,d,U,e){var c=e||this.DefaultFormat,Z,S;for(Z=0;Z<U.length;Z++){var Y=U[Z],W=d[Y]||null,b=X[Y];if(b===undefined){delete d[Y];continue;}for(S in c){var a=c[S],V;if((!W&&!b)||(W&&!W[S]&&!b[S])){continue;}for(V in a){if(b[S]===undefined||b[S]===""||b[S][V]==="pru"||b[S][V]===undefined){if(W&&W[S]&&(W[S][V]!==undefined&&W[S][V]!==null&&W[S][V]!=="pru")){W[S][V]="pru";}}else{W=W||{};W[S]=W[S]||{};W[S][V]=b[S][V];}}}if(W){d[Y]=W;}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var H=mstrmojo.array,D={},G={},A="72px",F="abcdefghijklmnopqrstuvwxyz0123456789";function C(I){return I.name+":"+(I.isItalic?"i":"n")+(I.isBold?"7":"4");}mstrmojo.util.FontLoader=mstrmojo.provide("mstrmojo.util.FontLoader",{load:function E(N,O){var L=this,J=[],K;H.forEach(N,function(P){if(!L.isFontInstalled(P)){K=C(P);if(!D[K]&&!G[K]){J.push(K);}}});if(!window.WebFont||J.length===0){return true;}window.WebFont.load({custom:{families:J},fontactive:function(Q,P){D[Q+":"+P]=true;},fontinactive:function(Q,P){G[Q+":"+P]=true;},active:function M(){O.success();},inactive:function I(){O.failure();}});return false;},isFontInstalled:function B(J){var K=document.createElement("canvas"),L=K.getContext("2d"),P=J.isItalic?"italic":"normal",I=J.isBold?"bold":"normal",N=P+" "+I+" "+A,O,M;L.font=N+" monospace";O=L.measureText(F).width;L.font=N+" '"+J.name+"', monospace";M=L.measureText(F).width;K=null;return O!==M;}});})();(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array;function B(){var H=this.buildConfig=this.buildConfig||{};H.pk=this.k;H.fgk=this.defn&&this.defn.fgk;return H;}mstrmojo._HasBuilder={builder:null,postBuildRendering:function D(){if(!this.builtChildren){this.buildChildren();}return this._super();},getChildren:function F(){return this.model.getChildren(this.node,false);},buildChildren:function E(H){if(!this.builder||!this.model){return false;}var J=this.children;if(J&&J.length){this.set("children",[]);}var I=this.builder.build(this.getChildren(),this.model,B.call(this));if(!H){this.addChildren(I);}this.builtChildren=true;return H?I:true;},rebuildChildren:function C(J){var P=this.children.slice(0),L=this.model,K=[],I,H=this,M=mstrApp.restoreVFKey,N,O;J=J||P.slice(0);J.forEach(function(S){var Q=G.indexOf(P,S),R=S.k;if(Q===-1){throw new Error("Invalid child requested rebuild in mstrmojo._HasBuilder::rebuildChild.");}this.removeChildren(S);S.destroy();K.push(R);},this);if(mstrApp.isInVFConfigMode&&(mstrApp.showBandingInVFConfigMode||mstrApp.showOutlineInVFConfigMode)&&!!J&&J.length===1&&!!J[0]&&J[0].k===M){delete mstrApp.showBandingInVFConfigMode;delete mstrApp.showOutlineInVFConfigMode;N=L.insertVizBox(M,H,{});L.selectVIUnit(N.id,true,{});I=[N];}else{O=L.getChildrenByKey(this.node,false,K);I=this.builder.build(O,L,B.call(this));this.addChildren(I);}return I;},rebuildChild:function A(H){return this.rebuildChildren([H])[0];}};}());mstrmojo.requiresCls("mstrmojo.gm.GMEnums");var $GM=mstrmojo.gm,CHART_TYPE=$GM.EnumGraphType,PRP_DATA_LABELS=$GM.EnumDataLabels,PRP_LEGEND=$GM.EnumLegend,PRP_MIN_SIZE_TYPE=$GM.EnumMinSizeType,PRP_FIT_TO=$GM.EnumFitTo,ENUM_FIT_MODES=$GM.EnumContainerFitModes,NGM_GRID_LINE=$GM.EnumNGMGridLines;var ARIAL="Arial",OPEN_SANCE="Open Sans",ALL="ALL";var ENUM_LAYOUT_THEME={DEFAULT:"spatial",CLASSIC:"classic"};var classicProps={THEME_STYLE:ENUM_LAYOUT_THEME.CLASSIC,LAYOUT:{allFF:ARIAL,titleFF:ARIAL,dlvPadding:2,dlvMargin:4,dlvLOH_Compensation:1,ucTBLOHeight:1,drpChildPadding:4,drpLOHW_Compensation:0,cueBottomOffset:1},GRID:{paddingSize:5,mRatio:2,lRatio:3,gridTemplateVisible:false},HEATMAP:{smallGap:2,middleGap:4,largeGap:6,largerGap:8},NGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={cntrFitMode:ENUM_FIT_MODES.AUTOMATIC};return A;}())},OGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE,minRowHeight:20,fitTo:PRP_FIT_TO.AUTOMATIC};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={};A[CHART_TYPE.BAR]={shpBdrThk:1,shpBdrStyle:0};A[CHART_TYPE.PIE]={shpBdrThk:1,shpBdrStyle:0};A[CHART_TYPE.GRID]={shpFillTrans:70};return A;}())},KPI:{fontFamily:ARIAL,defaultFontClr:{1:"#444649",2:"#FFFFFF",3:"#FFFFFF",4:"#FFFFFF"}}},defaultProps={THEME_STYLE:ENUM_LAYOUT_THEME.DEFAULT,LAYOUT:{allFF:OPEN_SANCE,titleFF:OPEN_SANCE,dlvPadding:0,dlvMargin:0,dlvLOH_Compensation:0,ucTBLOHeight:0,drpChildPadding:12,drpLOHW_Compensation:12,cueBottomOffset:-2},GRID:{paddingSize:4.52,mRatio:1050/452,lRatio:1205/452,gridTemplateVisible:true},HEATMAP:{smallGap:1,middleGap:3,largeGap:5,largerGap:5,cellTextSize:11,fontFamily:"Open Sans SemiBold",leftPadding:10,topPadding:8,lineHeightTime:1.3,marginTop:"3px"},NGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE};A[CHART_TYPE.WATERFALL]={dataLabels:PRP_DATA_LABELS.HIDE};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={cntrFitMode:ENUM_FIT_MODES.FIT_TO_CONTENT,dlFntFml:OPEN_SANCE,rfLnFntFml:OPEN_SANCE,lgdFntFml:OPEN_SANCE,xAxTtFntFml:OPEN_SANCE,xAxLbFntFml:OPEN_SANCE,yAxTtFntFml:OPEN_SANCE,yAxLbFntFml:OPEN_SANCE,allTxtFntFml:OPEN_SANCE,rwHdrTxtFntFml:OPEN_SANCE,colHdrTxtFntFml:OPEN_SANCE,rwVlTxtFntFml:OPEN_SANCE,colVlTxtFntFml:OPEN_SANCE,ttlFntFml:OPEN_SANCE,dlFntSz:"9pt",rfLnFntSz:"9pt",lgdFntSz:"9pt",xAxTtFntSz:"9pt",xAxLbFntSz:"9pt",yAxTtFntSz:"9pt",yAxLbFntSz:"9pt",allTxtFntSz:"9pt",rwHdrTxtFntSz:"9pt",colHdrTxtFntSz:"9pt",rwVlTxtFntSz:"9pt",colVlTxtFntSz:"9pt",ttlFntSz:"9pt"};A[CHART_TYPE.WATERFALL]={yGridLnShw:NGM_GRID_LINE.AUTO,xGridLnShw:NGM_GRID_LINE.AUTO};return A;}())},OGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE,minRowHeight:20,fitTo:PRP_FIT_TO.NONE};A[CHART_TYPE.PIE]={legend:PRP_LEGEND.HIDE,legendShow:false,dataLabels:PRP_DATA_LABELS.SHOW_TEXT_ONLY};A[CHART_TYPE.SCATTER]={minSizeType:PRP_MIN_SIZE_TYPE.AUTO};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={rwHdrShw:false,colHdrShw:false,dlFntFml:OPEN_SANCE,rfLnFntFml:OPEN_SANCE,lgdFntFml:OPEN_SANCE,xAxTtFntFml:OPEN_SANCE,xAxLbFntFml:OPEN_SANCE,yAxTtFntFml:OPEN_SANCE,yAxLbFntFml:OPEN_SANCE,allTxtFntFml:OPEN_SANCE,rwHdrTxtFntFml:OPEN_SANCE,colHdrTxtFntFml:OPEN_SANCE,rwVlTxtFntFml:OPEN_SANCE,colVlTxtFntFml:OPEN_SANCE,ttlFntFml:OPEN_SANCE,dlFntClr:3815477,rfLnFntClr:3815477,lgdFntClr:3815477,xAxTtFntClr:3815477,xAxLbFntClr:3815477,yAxTtFntClr:3815477,yAxLbFntClr:3815477,allTxtFntClr:3815477,rwHdrTxtFntClr:3815477,colHdrTxtFntClr:3815477,rwVlTxtFntClr:3815477,colVlTxtFntClr:3815477,ttlFntClr:3815477,yAxTtFntStyle:1,xAxTtFntStyle:1,rwHdrTxtFntStyle:1,colHdrTxtFntStyle:1,dlFntSz:"9pt",rfLnFntSz:"9pt",lgdFntSz:"9pt",xAxTtFntSz:"9pt",xAxLbFntSz:"9pt",yAxTtFntSz:"9pt",yAxLbFntSz:"9pt",allTxtFntSz:"9pt",rwHdrTxtFntSz:"9pt",colHdrTxtFntSz:"9pt",rwVlTxtFntSz:"9pt",colVlTxtFntSz:"9pt",ttlFntSz:"9pt"};A[CHART_TYPE.AREA]={shpBdrThk:1,shpFillTrans:100,shpBdrClr:15461355};A[CHART_TYPE.BAR]={shpBdrClr:15461355,shpBdrStyle:0,shpBdrThk:1,shpFillTrans:100};A[CHART_TYPE.LINE]={shpFillTrans:100};A[CHART_TYPE.PIE]={shpBdrThk:1,shpBdrStyle:0,shpFillTrans:100,shpBdrClr:15461355};A[CHART_TYPE.SCATTER]={shpBdrStyle:99,shpFillTrans:40};A[CHART_TYPE.BUBBLE]={shpBdrStyle:99,shpFillTrans:40};A[CHART_TYPE.GRID]={shpBdrThk:1,shpFillTrans:100};return A;}())},KPI:{fontFamily:OPEN_SANCE,defaultFontClr:{1:"#35383A",2:"#FFFFFF",3:"#FFFFFF",4:"#FFFFFF"}}};mstrmojo.vi.enums.EnumThemeProperties={CLASSIC_THEME_PROPS:classicProps,DEFAULT_THEME_PROPS:defaultProps};mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE={GRID:"GRID",LAYOUT:"LAYOUT",HEATMAP:"HEATMAP"};mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_THEME=ENUM_LAYOUT_THEME;mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_STYLE={DEFAULT:0,CARD:1,FLAT:2};(function(){mstrmojo.requiresCls("mstrmojo.vi.enums.EnumThemeProperties");var A=mstrmojo.vi.enums.EnumThemeProperties,B=A.ENUM_LAYOUT_THEME;mstrmojo.util.ThemeHelper=mstrmojo.provide("mstrmojo.util.ThemeHelper",{getThemePropConfig:function C(E){var F=E&&E.layoutTheme,D=E&&E.layoutstyle;if(!F){F=!!D?B.DEFAULT:B.CLASSIC;}return F===B.DEFAULT?A.DEFAULT_THEME_PROPS:A.CLASSIC_THEME_PROPS;}});})();(function(){mstrmojo.requiresCls("mstrmojo.form");mstrmojo.vi.util.NavUtility=mstrmojo.provide("mstrmojo.vi.util.NavUtility",{checkSessionAndSendForm:function(C,A,E,B){var D=mstrApp.sessionManager;if(D&&D.sessionTimedout){D.openLoginEditor({success:function(){if(B!=="_blank"&&B!=="mstrExportWindow"){mstrApp.showWait();}mstrmojo.form.send(C,A,E,B);}});}else{if(B!=="_blank"&&B!=="mstrExportWindow"&&C.evt!==3198){mstrApp.showWait();}mstrmojo.form.send(C,A,E,B);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var M=mstrmojo.locales,I=mstrmojo.string,P=window.mstrConfig,F=mstrmojo.array,C=P.units,R={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},A={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},E={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var G=96;String.prototype.reverse=function(){var V="",U;for(U=this.length;U>0;--U){V+=this.charAt(U-1);}return V;};function K(U,W){U=U||"";W=W||U.match(/\".+?\"/g)||[];for(var V=0;V<W.length;V++){U=U.replace(W[V],W[V].substring(1,W[V].length-1).replace(/\$/g,"$$$$"));}return U;}function S(Z){var U=86400000,Y=new Date(1900,0,1,0,0,0,0),V=Math.floor(Z)-1,X=Z-V-1;if(Z>=59){V--;}var W=new Date(Y.getTime()+(V*U));W.setTime(W.getTime()+X*U+500);return W;}function H(Y,f,h){var Z={"d+":Y.getDate(),"h+|H":Y.getHours(),"s+":Y.getSeconds()},U=M.datetime,a;if(/(y+)/.test(f)){var X=Y.getFullYear().toString(),e=RegExp.$1,W=e.length===2,V=X.length;f=f.replace(e,X.substr(W?V-2:0,W?2:V));}if(/(^\[h\])/.test(f)&&h){f=f.replace(RegExp.$1,""+(Math.floor(h*24)));}if(/(\"?:\"?mm)/.test(f)){var b=Y.getMinutes();f=f.replace(RegExp.$1,":"+(RegExp.$1.length===1?b:("00"+b).substr(b.toString().length)));}if(/(AM\/PM)/.test(f)){var g=Z["h+"],c=g>11;Z["h+"]=g-(c?12:0);f=f.replace(RegExp.$1,c?"PM":"AM");}for(a in Z){if(new RegExp("("+a+")").test(f)){f=f.replace(RegExp.$1,RegExp.$1.length===1?Z[a]:("00"+Z[a]).substr((Z[a].toString()).length));}}if(/(mmmm)/.test(f)){f=f.replace(RegExp.$1,U.MONTHNAME_FULL[Y.getMonth()]);}else{if(/(mmm)/.test(f)){f=f.replace(RegExp.$1,U.MONTHNAME_SHORT[Y.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(f)){var d=(Y.getMonth()+1).toString();f=f.replace(RegExp.$1,RegExp.$1.length===1?d:("00"+d).substr(d.length));}}}return K(f);}function N(V,Y){var W=0,U=Y.length,X=0;for(;W<U;W++){if(Y[W]==="0"){X++;}else{if(Y[W]==="#"){if(X<V){X++;}}else{continue;}}}return X;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function D(U){var X=this.getThousand(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+X+"[0-9]{3})*$"),V=new RegExp("^(-)?[0-9]+$");return(String(U).indexOf(X)&&W.test(U))||V.test(U);},isNumeric:function O(Y){var X=this.getDecimal(),Z=this.getThousand(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+Z+"[0-9]{3})*(\\"+X+"[0-9]+)?$"),V=new RegExp("^(-)?[0-9]*(\\"+X+")?[0-9]+$"),U=new RegExp("^(-)?[0-9]{1}(\\"+X+")[1-9]+[eE]{1}[-]{0,1}[0-9]+$");return(String(Y).indexOf(Z)&&W.test(Y))||V.test(Y)||U.test(Y);},isBigDecimal:function(V){if(!V){return false;}var U=String(V).match(/^#([^#]+)#$/);if(!U||U.length<=1){return false;}var W=U[1];return this.isNumeric(W);},parseInteger:function L(U,V){if(!this.isInt(U)){return Number.NaN;}return parseInt(this.toString(U,true),V);},parseNumeric:function B(U){if(!this.isNumeric(U)){return Number.NaN;}return parseFloat(this.toString(U,true));},parseBigDecimal:function(U){return String(U).match(/^#(.+)#$/)[1];},inNumericRange:function Q(V,W,U){V=this.parseNumeric(V);U=(U!=null)?this.parseNumeric(this.toLocaleString(U)):Number.NaN;W=(W!=null)?this.parseNumeric(this.toLocaleString(W)):Number.NaN;if(U!=Number.NaN&&(V>U||isNaN(V))){return 1;}if(W!=Number.NaN&&(V<W||isNaN(V))){return -1;}return 0;},convertToUSUnits:function(X,W,V){var U=X;W=W||C;switch(parseInt(W,10)){case R.CM:U=parseFloat(this.toString(X))/2.54+"";break;case R.MM:U=parseFloat(this.toString(X))/25.4+"";break;case R.PT:U=parseFloat(this.toString(X))/72+"";break;case R.PC:U=parseFloat(this.toString(X))/6+"";break;case R.PX:U=parseFloat(this.toString(X))/G+"";break;}return V?U:this.toLocaleString(U);},convertToLocalUnits:function(X,W,V){var U;W=W||C;switch(parseInt(W,10)){case R.CM:U=(parseFloat(this.toString(X))*2.54).toFixed(4)+"";break;case R.MM:U=(parseFloat(this.toString(X))*25.4).toFixed(4)+"";break;case R.PT:U=(parseFloat(this.toString(X))*72).toFixed(4)+"";break;case R.PC:U=(parseFloat(this.toString(X))*6).toFixed(4)+"";break;case R.PX:U=(parseFloat(this.toString(X))*G)+"";break;default:U=parseFloat(this.toString(X)).toFixed(4)+"";}return V?U:this.toLocaleString(U);},convertUnits:function(V,W,U){return this.convertToLocalUnits(this.convertToUSUnits(U,V,true),W,true);},toLocaleString:function(U){return(U+"").replace(".",this.getDecimal());},toString:function(W,U){if(U===true){var V=this.getThousandSepRegex();if(V){W=String(W).replace(V,"");}}return String(W).replace(this.getDecimal(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(this.getThousand().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(W,V){var U=V;if(V=="."||V=="*"||V=="\\"){U="\\"+V;}return W.reverse().replace(/(\d{3})/g,"$1"+V).reverse().replace(new RegExp("^(-)?"+U),"$1");},addSeparators2:function(X,W){var U=X,V=/(\d+)(\d{3})/;while(V.test(U)){U=U.replace(V,"$1"+W+"$2");}return U;},format:function(Y,X,b,U){var a="",Z=(X>0)?".":"",V=[];b=(b)?b:"";for(var W=0;W<X;W++){V.push("0");}V=V.join("");switch(Y){case E.GENERAL:a="0.00";break;case E.PERCENT:a="0"+Z+V+"%";break;case E.SCIENTIFIC:a="0"+Z+V+"E+00";break;default:a='"'+b+'"#,##0'+Z+V;}return this.formatByMask(a,U);},getDecimalLength:function J(W){var U=W.indexOf("."),X=0;if(U!==-1){var V=W.substr(U+1,W.length).match(/\d+/);if(V&&V.length>0){X=V[0].length;}}return X;},formatByMask:function(AI,Aa){var AC,n="",u,Ad=false;if(isNaN(Aa)){AC=new Date(Aa);if(isNaN(AC)){return Aa;}u=true;}if(AI==="General"){var AN=String(parseFloat(Aa).toFixed(2));n=AN.split(".");if(n.length===2){return n.join(this.getDecimal());}return AN;}var t=String(AI).split(";"),X=t[0],h="\u00A4",AT=/"[^"]*"/g,l=(AI&&AI.replace(AT,h).replace(/\[.*\]/g,h))||"",AZ=["m","y","d","h","s"],AO=false;F.forEach(AZ,function(j){AO=AO||l.indexOf(j,0)!==-1;});if(AO){if(window.SSF&&!Ad){n=this.formatBySSF(AI,Aa);Ad=true;}if(n!==""){return n;}else{return H(u?AC:S(Aa),AI,Aa);}}var AM=X.indexOf("E+"),d=X.indexOf("%"),z=X.match(/\".+?\"/g),AF=X.match(/\[([=<>]*)(-?\d+\.?\d*)\]/),AA=X.indexOf("?/?")>-1,AG=(AM!=-1)?E.SCIENTIFIC:((d!=-1)?E.PERCENT:((z&&!AF)?E.CURR:AA?E.FRACTION:E.FIXED)),q="",AV="",o=false,V=new String(Aa),c=parseFloat(Aa)||this.parseNumeric(Aa);if(z){if(X.match(/\[\$.+?\]/g)){for(var e=0;e<z.length;e++){X=X.replace(z[e],z[e].substring(1,z[e].length-1));if(z[e].match(/\[\$.+?\]/g)){z[e]=z[e].replace(/\[\$.+?\]/g,z[e][z[e].indexOf("[$")+2]);}}X=X.replace(/\[\$.+?\]/g,'"#"'.replace("#",X[X.indexOf("[$")+2]));}q=K(X,z);q=q.replace(X.replace(/\".+?\"/g,""),h);}if(c<0){V=V.substring(1,V.length);c=-c;o=true;if(t.length>1){var a=t[1].replace(/\[.*\]/,"");AV=K(a.replace(t[0],h));}}var k=this,b=function(Ae,j){var m=j&&j.replace(h,Ae);if(j&&(m===j)&&window.SSF){if(Ad){return Ae;}else{Ad=true;return k.formatBySSF(j,Ae);}}return(j)?m:"-"+Ae;};if(AG===E.FRACTION){var AR,AQ,AY,p=10,AB,x=0,AK,AU,Y,W=false,AH;if(AI.indexOf("# ")>-1){W=true;}for(AR=5;AR>0;AR--){AH="/";for(AQ=0;AQ<AR;AQ++){AH+="?";}if(AI.indexOf(AH)>-1){for(AQ=1;AQ<AR;AQ++){p*=10;}break;}}if(W){x=Math.floor(Number(c));c-=x;}AU=p/2;AY=-1;AK=c*p;for(AR=p-1;AR>=2;AR--){Y=(AK*AR)/p;Y=Y-Math.floor(Y);Y=Y*p;if(Math.abs(Y-p)<Y){Y=Math.abs(Y-p);}Y=Y/AR;if(Y<AU){AU=Y;AY=AR;}else{if((Y==AU)&&(Y==0)){AU=Y;AY=AR;}}}AB=Math.round(AY*AK/p);for(AR=AY;AR>=2;AR--){if((AB%AR==0)&&(AY%AR==0)){AB=AB/AR;AY=AY/AR;break;}}if(AY==p){AY=1;AB=0;}if(AB==0){AY=1;}if(AB==AY){if(W){n=""+(x+1);}else{n="1";}}else{if(W&&x>0){if(AB==0){n=x;}else{n=x+" "+AB+"/"+AY;}}else{if(AB==0){n="0";}else{n=AB+"/"+AY;}}}if(o){n=b(n,AV);}}else{if(AG==E.SCIENTIFIC){if(c!=0){var Ab=Math.floor(Math.log(c)/Math.LN10),AP=c/Math.pow(10,Ab),Ac=X.substring(0,AM),g=Ac.indexOf("."),AJ=X.length-X.indexOf("E+")-(""+Math.abs(Ab)).length-2,AR,U=Ab<0;Ab=Math.abs(Ab);for(AR=0;AR<AJ;AR++){Ab="0"+Ab;}n+=Number(AP).toFixed((g!=-1)?Ac.length-g-1:0);n=((o)?b(n,AV):n)+"E"+(U?"-":"+")+Ab;}else{n="0";}}else{if(AG==E.PERCENT){X=X.substring(0,X.length-1);V=String(c*100);}var g=X.indexOf("."),Z=0,AX,w=g>=0?X.substring(0,g):X,AD=g>=0?X.substring(g+1,X.length):"",f=false;if(w.match(/[#0\?],$/)){c/=1000;V=String(c);}else{if(AD.match(/^[#0]*,/)){var AE=0;f=true;while(AE<AD.length){if(AD[AE]==="0"||AD[AE]==="#"){AE++;}else{if(AD[AE]===","){c/=1000;V=String(c);AE++;}else{break;}}}}}AX=this.getDecimalLength(V);if(g!=-1){Z=N(AX,X.substr(g+1,X.length));}n=String((+(Math.round(+(V.indexOf("e")>0?String(parseFloat(V).toFixed(Math.min(Z+2,20))):V+"e"+Math.min(Z,20)))+"e"+-Math.min(Z,20))).toFixed(Math.min(Z,20)));if(AG===E.FIXED){if(/[\[\]><=A-Za-z]|,{2}/.test(X)&&window.SSF){var AS=this.formatBySSF(AI,Aa);n=AS!==""?AS:n;Ad=true;}}var AW=n.split(".");var AL=X.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(AL!==null){if(AG===E.CURR){AW[0]=(this.formatBySSF((f?AL[0]&&AL[0].trim():AL.input&&AL.input.trim()),parseFloat(AW[0]))||"").split(".")[0];Ad=true;}if(AW[0].indexOf(",")>=0){AW[0]=AW[0].replace(/,/g,this.getThousand());}else{if(!(this.getThousand()===","&&AW[0].search(this.getThousand())>0)){AW[0]=this.addSeparators2(AW[0],this.getThousand());}}}n=AW.join(this.getDecimal());if(AG==E.CURR){n=q.replace(h,n);if(n===q&&window.SSF){n=this.formatBySSF(AI,Aa,n);Ad=true;}}if(AG==E.PERCENT){n+="%";}if(o){n=b(n,AV);}}}return n;},formatBySSF:function(W,V,X){var U=(X!==undefined&&X!==null)?X:"";if(typeof V==="string"){V=parseFloat(V);}try{U=window.SSF.format(W,V);}catch(Y){if(window.mstr_profile){window.mstr_profile.log(Y);}U=(X||V).toString();}return U;},validateFormat:function(U){var V=true,W=String(U).split(";");if(W[1]&&W[1].indexOf(W[0])<0){V=false;}return V;},generateUniqueID:function(U){var W="0123456789ABCDEF".split(""),X=[];for(var V=0;V<U;V++){X[V]=W[0|Math.random()*16];}return X.join("");},countOfDecimals:function(V,W){var U=String(V);return U.length-(U.indexOf(W!==undefined?W:this.getDecimal())+1);},getThousand:function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},getDecimal:function(){return mstrmojo.locales.number.DECIMALSEPARATOR;}});mstrmojo.num.UNIT=R;mstrmojo.num.UNIT_SYMBOL=A;})();(function(){mstrmojo.requiresCls("mstrmojo.locales");var Y=function(){return mstrmojo.locales.datetime;},L=mstrmojo.string;mstrmojo.date=mstrmojo.provide("mstrmojo.date",{monthNumbers:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},REGEXPS:{DATES:{},TIMES:{}},CACHE:{PARSEDATE:{CONTAINS:{},EQUALS:{}},PARSETIME:{CONTAINS:{},EQUALS:{}}},now:Date.now||function D(){return new Date().getTime();},isDate:function Z(c,g,b){var e=this.parseDate(c,b);var f=!!(e&&this.doesDateExist(e.month,e.day,e.year));if(g){if(f){var d=this.formatDateInfo(e,Y().DATEOUTPUTFORMAT);if(b){return{match:e.match,formatted:d};}return d;}return null;}return !!f;},formatDateInfo:function R(e,g){if(!g){return"";}var b=e.day,f=e.month,d=e.year;var c=g.replace(/dd/g,this.formatInteger(b,2)).replace(/d/g,Number(b)).replace(/yyyy/g,Number(d)).replace(/yy/g,this.formatInteger(Number(d)%100,2)).replace(/MMM/g,"~~~~").replace(/MM/g,"@@").replace(/M/g,"^").replace(/MMMM/g,Y().MONTHNAME_FULL[Number(f)-1]).replace(/\~\~\~\~/g,Y().MONTHNAME_SHORT[Number(f)-1]).replace(/\@\@/g,this.formatInteger(f,2)).replace(/\^/g,Number(e.month));return c;},parseDate:function a(m,g,k){if(m==null){return false;}if(typeof m!=="string"){m=String(m);}m=L.trim(m);var b=this.CACHE.PARSEDATE[g?"CONTAINS":"EQUALS"],d=b[m];if(d||(d===null)){return d;}var c=null;var j;if(k){j=[k];}else{j=[].concat(Y().DATEINPUTFORMATS);j.unshift(Y().DATEOUTPUTFORMAT);}var e,f;for(e=0,f=j.length;e<f;e++){var h=this._buildRegExp4DateFormat(j[e]),l=h&&m.match(g?h.reContains:h.reEquals);if(l){c={match:l[0],year:h.yearIndex&&this.fourDigitYear(l[h.yearIndex]),day:h.dayIndex&&parseInt(Number(l[h.dayIndex]),10),month:h.monthIndex&&this.numericMonth(l[h.monthIndex])};break;}}b[m]=c;return c;},isTime:function I(c,f,b){var g=this.parseTime(c,b);var e=!!(g&&this.doesTimeExist(g.hour,g.min,g.sec));if(f){if(e){var d=this.formatTimeInfo(g,Y().TIMEOUTPUTFORMAT);if(b){return{match:g.match,formatted:d};}return d;}return null;}return !!e;},parseTime:function J(n,g,l){if(n==null){return false;}if(typeof n!=="string"){n=String(n);}n=L.trim(n);var b=this.CACHE.PARSETIME[g?"CONTAINS":"EQUALS"],d=b[n];if(d||(d===null)){return d;}var c=null;var k;if(l){k=[l];}else{k=[].concat(Y().TIMEINPUTFORMATS);k.unshift(Y().TIMEOUTPUTFORMAT);}var e,f;for(e=0,f=k.length;e<f;e++){var j=this._buildRegExp4TimeFormat(k[e]),m=j&&n.match(g?j.reContains:j.reEquals);if(m){var h=j.ampmIndex&&m[j.ampmIndex];c={match:m[0],hour:j.hourIndex&&this.capitalHour(m[j.hourIndex],h),min:j.minIndex&&parseInt(Number(m[j.minIndex]),10),sec:j.secIndex&&parseInt(Number(m[j.secIndex]),10)};break;}}b[n]=c;return c;},formatTimeInfo:function S(e,c){if(!c){return"";}var d=!(Number(e.hour)%12)?12:(Number(e.hour)%12),b=c.replace(/HH/g,this.formatInteger(e.hour,2)).replace(/H/g,Number(e.hour)).replace(/hh/g,this.formatInteger(d,2)).replace(/h/g,d).replace(/mm/g,this.formatInteger(Number(e.min)||0,2)).replace(/m/g,Number(e.min)||0).replace(/ss/g,this.formatInteger(Number(e.sec)||0,2)).replace(/s/g,Number(e.sec)||0).replace(/a/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME).replace(/tt/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME).replace(/AM\/PM/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME);return b;},doesTimeExist:function G(g,c,f){var e=parseInt(g,10);if(e>=0&&e<=23){var b=parseInt(c,10);if(b>=0&&b<=59){if(!f){return true;}var d=parseInt(f,10);if(d>=0&&d<=59){return true;}}}return false;},capitalHour:function C(b,c){b=parseInt(Number(b),10);if(c&&(c.match(Y().AM_NAME)||c.match(/AM/i))){return b%12;}if(c&&(c.match(Y().PM_NAME)||c.match(/PM/i))){return 12+(b%12);}return b;},getTimeStamp:function O(){var c=new Date();var b=[c.getMonth()+1,c.getDate(),c.getFullYear()];var f=[c.getHours(),c.getMinutes(),c.getSeconds()];var e=(f[0]<12)?"AM":"PM";f[0]=(f[0]<12)?f[0]:f[0]-12;f[0]=f[0]||12;for(var d=1;d<3;d++){if(f[d]<10){f[d]="0"+f[d];}}return b.join("-")+" "+f.join("")+" "+e;},isDateAndOrTime:function W(b,c){return this.isDateTime(b,c)||this.isDate(b,c)||this.isTime(b,c);},isDateTime:function B(l,b){var f=this.parseDateAndOrTime(l),j=f&&f.date,e=f&&f.time,h=!!j&&!!e&&this.doesDateExist(j.month,j.day,j.year)&&this.doesTimeExist(e.hour,e.min,e.sec);if(b){if(h){var c=this.formatDateInfo(j,Y().DATEOUTPUTFORMAT),d=this.formatTimeInfo(e,Y().TIMEOUTPUTFORMAT),k=l.indexOf(j.match),g=l.indexOf(e.match);return(g<k)?d+" "+c:c+" "+d;}return null;}return !!h;},parseDateAndOrTime:function Q(c,b,g){var d=this.parseDate(c,true,b);var e=L.trim((d&&d.match)?c.replace(d.match,""):c),f=this.parseTime(e,false,g);if(!d&&!f){return null;}return{date:d,time:f};},inDateTimeRange:function P(d,f,j){var c=this.parseDateAndOrTime(d),g=c&&c.date,k=c&&c.time;if(!g&&!k){return 0;}if(f!=null){var e=this.parseDateAndOrTime(f);if(g&&e&&e.date){var l=this.compareDate(g,e.date);if(l<0){return -1;}if(l==0){if(k&&e.time&&(this.compareTime(k,e.time)<0)){return -1;}}}}if(j!=null){var b=this.parseDateAndOrTime(j);if(g&&b&&b.date){var h=this.compareDate(g,b.date);if(h>0){return 1;}if(h==0){if(k&&b.time&&(this.compareTime(k,b.time)>0)){return 1;}}}}return 0;},compareDate:function A(d,b){if(d===b){return 0;}var e=typeof d==="string"?this.parseDate(d):d,c=typeof b==="string"?this.parseDate(b):b;if(!e){return -1;}if(!c){return 1;}return(e.year-c.year)||(e.month-c.month)||(e.day-c.day)||0;},compareTime:function K(c,b){if(c===b){return 0;}var e=typeof c==="string"?this.parseTime(c):c,d=typeof b==="string"?this.parseTime(b):b;if(!e){return -1;}if(!d){return 1;}return(e.hour-d.hour)||(e.min-d.min)||(e.sec-d.sec)||0;},compareDateTime:function V(c,b){return this.compareDate(c,b)||this.compareTime(c,b);},compareDateAndOrTime:function E(j,g){if(j===g){return 0;}var c=typeof j==="string"?this.parseDateAndOrTime(j):j,b=typeof g==="string"?this.parseDateAndOrTime(g):g;if(!c){return -1;}if(!b){return 1;}var h=c.date,f=b.date,e=c.time,d=b.time;return this.compareDate(h,f)||this.compareTime(e,d);},_buildRegExp4DateFormat:function N(d){if(!d){return null;}var f=this.REGEXPS.DATES[d];if(!f){if(!this.REGEXPS.MONTHNAME_FULL){this.REGEXPS.MONTHNAME_FULL=Y().MONTHNAME_FULL.join("|");this.REGEXPS.MONTHNAME_SHORT=Y().MONTHNAME_SHORT.join("|");}f=this.REGEXPS.DATES[d]={};f.formatStr=d;var c=f.reStr=d.replace(/([^M|d|y|\s])/g,"\\$1").replace(/dd/g,"~~~~").replace(/d/g,"(\\d{1,2})").replace(/\~\~\~\~/g,"(\\d\\d)").replace(/yyyy/g,"(\\d\\d\\d\\d)").replace(/yy/g,"(\\d\\d)").replace(/MMMM/g,"@@@@").replace(/MMM/g,"@@@").replace(/MM/g,"(\\d\\d)").replace(/M/g,"(\\d{1,2})").replace("@@@@","("+this.REGEXPS.MONTHNAME_FULL+")").replace("@@@","("+this.REGEXPS.MONTHNAME_SHORT+")");f.reEquals=new RegExp("^"+c+"$");f.reContains=new RegExp("^"+c+"\\b");var g=[{key:"monthIndex",index:d.indexOf("M")},{key:"dayIndex",index:d.indexOf("d")},{key:"yearIndex",index:d.indexOf("y")}];g.sort(function(j,h){return j.index-h.index;});var b=1,e;for(e=0;e<3;e++){f[g[e].key]=g[e].index>-1?b++:null;}}return f;},_buildRegExp4TimeFormat:function F(e){if(!e){return null;}var g=this.REGEXPS.TIMES[e];if(!g){if(!this.REGEXPSTR_AMPM){this.REGEXPSTR_AMPM=[Y().AM_NAME,Y().PM_NAME,String(Y().AM_NAME).toLowerCase(),String(Y().PM_NAME).toLowerCase()].join("|");}g=this.REGEXPS.TIMES[e]={};g.formatStr=e;var d=e.replace(/\'\'/g,'"');var h=d.match(/\'(.+?)\'/g);d.replace(/\'(.+?)\'/g,"*");d=d.replace(/([^H|h|m|s|z|Z|a|t|\s|A|P|M|\/])/g,"\\$1").replace(/HH|hh/g,"(\\d\\d)").replace(/H|h/g,"(\\d{1,2})").replace(/mm/g,"(\\d\\d)").replace(/m/g,"(\\d{1,2})").replace(/ss/g,"(\\d\\d)").replace(/s/g,"(\\d{1,2})").replace(/a/g,"("+this.REGEXPSTR_AMPM+")").replace(/AM\/PM/,"("+this.REGEXPSTR_AMPM+")").replace(/tt/g,"("+this.REGEXPSTR_AMPM+")").replace(/z|Z/g,"(.+?)");var f,b;for(f=1,b=(h&&h.length)||0;f<b;f++){d=d.replace(/\*/,h[f]);}d=d.replace(/\"/g,"'");g.reEquals=new RegExp("^"+d+"$");g.reContains=new RegExp(d);var j=[{key:"hourIndex",index:e.search(/h|H/)},{key:"minIndex",index:e.indexOf("m")},{key:"secIndex",index:e.indexOf("s")},{key:"ampmIndex",index:e.search(/tt|a|AM\/PM/)},{key:"zoneIndex",index:e.search(/z|Z/)}];j.sort(function(l,k){return l.index-k.index;});var c=1;for(f=0;f<5;f++){g[j[f].key]=j[f].index>-1?c++:null;}}return g;},doesDateExist:function M(e,b,c){var d=new Date(c,e-1,b);return c==d.getFullYear()&&e==d.getMonth()+1&&b==d.getDate();},fourDigitYear:function U(c){c=parseInt(Number(c),10);if(!isNaN(c)){var b=(Y().TWODIGITYEARSTART%100)||0;if(c>=0&&c<=b){c=2000+c;}else{if(c>b&&c<100){c=1900+c;}}}return c;},numericMonth:function X(f){var e=parseInt(Number(f),10),d=mstrmojo.array;if(!isNaN(e)){return e;}var b=(f&&f.length)||0,c=-1;if(b){if(b<=3){c=d.indexOf(Y().MONTHNAME_SHORT,f);}if(c===-1){c=d.indexOf(Y().MONTHNAME_FULL,f);}}return c+1;},formatInteger:function H(d,c){var g=String(d),f=Math.max(c-g.length,0);if(f>0){var b=[g],e;for(e=1;e<=f;e++){b.push("0");}g=b.reverse().join("");}return g;},getFirstDateOfMonth:function(c,b){return new Date(c,b-1,1);},getDateObject:function(h,b,g,e,f,c){h=h||0;b=b||1;g=g||1;e=e||0;f=f||0;c=c||0;return new Date(h,b-1,g,e,f,c);},getDateFromDateInfo:function(b){return this.getDateObject(b.date&&b.date.year,b.date&&b.date.month,b.date&&b.date.day,b.time&&b.time.hour,b.time&&b.time.min,b.time&&b.time.sec);},getDateJson:function(b){return{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate(),hour:b.getHours(),min:b.getMinutes(),sec:b.getSeconds()};},isLeapYear:function(b){return !(b%400)||(!(b%4)&&!!(b%100));},getDaysOfMonth:function(d,b){var c=[31,28,31,30,31,30,31,31,30,31,30,31];if(b==2&&this.isLeapYear(d)){return 29;}return c[b-1];},getPreMonth:function(c,b){if(b===1){return{y:c-1,m:12};}return{y:c,m:b-1};},getNextMonth:function(c,b){if(b===12){return{y:c+1,m:1};}return{y:c,m:b+1};}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.locales");var d=mstrmojo.array,P=mstrmojo.meta.TP,G=mstrmojo.meta.STP,O=mstrmojo.hash,F={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},B={};var X;for(X in F){B[F[X]]=true;}var b={};b[F.AQ]="a";b[F.AL]="a";b[F.AC]="a";b[F.AE]="a";b[F.MQ]="m";b[F.MC]="m";b[F.F]="f";b[F.R]="r";b[F.XML]="p";b[F.ANDOR]="nds";var K={};K[F.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];K[F.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];K[F.AE]=["not","a","fn","es","a2","fm2","p"];K[F.AQ]=["not","a","fm","fn","cs"];K[F.AL]=["not","a","fm","fn","cs"];K[F.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];K[F.R]=["not","r"];K[F.F]=["not","f"];K[F.XML]=["not","n","p"];K[F.ANDOR]=["not","node","nds","fn"];var M={};M[F.MQ]="METRIC_FNS";M[F.MC]="METRIC_FNS";M[F.AQ]="FORM_FNS";M[F.AL]="FORM_FNS";M[F.AC]="FORM_FNS";M[F.AE]="ELEM_FNS";var N={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},c={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},U={a:N.ATTR,a2:N.ATTR,m:N.METRIC,m2:N.METRIC,r:N.REPORT,f:N.FILTER,p:N.PROMPT},V={f:c.FILTER};var W={};W[F.MQ]=N.METRIC;W[F.MC]=N.METRIC;W[F.AQ]=N.ATTR;W[F.AL]=N.ATTR;W[F.AC]=N.ATTR;W[F.AE]=N.ATTR;W[F.F]=N.FILTER;W[F.R]=N.REPORT;var J=function(e){var H=e.length,h={},g;for(g=0;g<H;g++){var j=e[g];h[j.did]=j.n;}return h;},E=function(f){var H=f.length,g;for(g=0;g<H;g++){var e=f[g];if("tp" in e){e.t=e.tp;}}return f;},Y=function(f,h){var H=f.length,g;for(g=0;g<H;g++){var e=f[g];if("tp" in e){if(h){e.t=h;}else{delete e.t;}}}return f;},a=function(e,g){if(!g){g=[];}g.length=0;var f,H;for(f=0,H=e.length;f<H;f++){g[f]=e[f];}return g;},L={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var R={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:F,ETs:B,ET2TGT:b,ET2COND:K,ET2TP:W,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158,DESCENDANT:187},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:N,STP:c,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":c.PROMPT,1:c.PROMPT_LONG,2:c.PROMPT_LONG,3:c.PROMPT_LONG,4:c.PROMPT_DOUBLE,5:c.PROMPT_DOUBLE,6:c.PROMPT_DOUBLE,7:c.PROMPT_DOUBLE,8:c.PROMPT_STRING,9:c.PROMPT_STRING,10:c.PROMPT_STRING,14:c.PROMPT_DATE,15:c.PROMPT_DATE,16:c.PROMPT_DATE,21:c.PROMPT_LONG,22:c.PROMPT_LONG,23:c.PROMPT_STRING,24:c.PROMPT_BOOLEAN,30:c.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function A(g,e){var h=this.FN,j=this.FN_MRP,H=this.FNT;if(e===H.DEF||e===undefined){switch(g){case h.BETWEEN:case h.NOT_BETWEEN:return 2;case h.IS_NULL:case h.IS_NOT_NULL:return 0;}}else{if(e===H.PER||e===H.RANK){switch(g){case j.BETWEEN:case j.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function S(e,H){var g=this.FN;return e==g.IN_LIST||e==g.NOT_IN_LIST;},fn_AC_MC:function Z(e,H){var g=this.FN;return(e==g.EQUAL)||(e==g.NOT_EQUAL)||(e==g.GREATER)||(e==g.LESS)||(e==g.GREATER_EQUAL)||(e==g.LESS_EQUAL);},fnName:function Q(j,h,e,g){var H=this[M[j]];if(H&&H.constructor===Object){H=H[this.DTP2FN_DTP[g]]||H["*"];}if(j===F.MQ){H=H.concat(mstrmojo.locales.expression.MetricRP);}var f=d.find(H,"did",(e||1)+this.FN_SEP+h);if(f>-1){return H[f].n;}return"";},findTargets:function I(o,g,q){if(!q){q={};}if(o){var n;for(n in U){var AC=o[n];if(AC){if(!AC[P]){AC[P]=U[n];}if(!AC[G]&&V[n]){AC[G]=V[n];}q[AC[g]]=AC;}}if(o.dmy){var l=this.TP.ATTR,w=this.DMY_TP.ATTR,f=o.dmy.uts,AB,e;for(AB=0,e=(f&&f.length)||0;AB<e;AB++){var m=f[AB];if(m&&m.utp===w){var j=m.utgt;if(!j.t){j.t=l;}q[j[g]]=j;}}}var H=o.nds,p,z;for(p=0,z=(H&&H.length)||0;p<z;p++){this.findTargets(H[p],g,q);}var x=o.cs,AA=x&&x.length;if(AA){for(p=0;p<AA;p++){this.findTargets(x[p],g,q);}}}return q;},onLocaleUpdated:function(){var e=mstrmojo.locales.expression,H=mstrmojo.expr;H.BRANCH_FNS=O.copy(J(e.BranchQual),H.BRANCH_FNS);H.ELEM_FNS=a(Y(e.Element,"fn"),H.ELEM_FNS);H.METRIC_FNS={"*":Y(d.filter(e.Metric.concat(e.MetricRP),function(f){return f.did&&(d.find(R["0"],"did",f.did)<0);}))};H.FORM_FNS={0:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["0"],"did",f.did)<0);})),1:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["1"],"did",f.did)<0);})),2:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["0"],"did",f.did)<0)&&(d.find(L["1"],"did",f.did)<0);}))};H.DIMTYLEVELS=a(Y(e.DimtyLevels),H.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function D(h){var f=-1,H=0,e=1,g=2;function j(k){switch(k.t){case N.METRIC:return e;case N.ATTR:case N.DIM:case N.CONS:return H;case N.FILTER:return k.st===c.CUSTOMGROUP?H:g;case -1:return f;default:return g;}}h=d.map(h||[],function(k){return O.copy(k,{});});return h.sort(function(o,n){var p=j(o)-j(n);if(p){return p;}var m=o.n.toUpperCase(),l=n.n.toUpperCase(),k=m.localeCompare(l);if(k){return k;}return o.n.localeCompare(n.n);});},mapBaseFormTypeToDataType:function C(f){f=parseInt(f);if(f===NaN){return -1;}var e=this.BFTP,H=this.DTP;switch(f){case e.DATETIME:return H.TIMESTAMP;case e.DATE:return H.DATE;case e.TIME:return H.TIME;case e.NUMBER:return H.REAL;case e.TEXT:return H.CHAR;case e.BIGDECIMAL:return H.BIGDECIMAL;default:return H.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());(function(){mstrmojo.requiresCls("mstrmojo.registry");mstrmojo._PagingList=mstrmojo.provide("mstrmojo._PagingList",{usePaging:false,page:0,totalPages:1,_set_page:function(B,A){if(this.page!==A&&this.usePaging){if(A>=0&&A<this.totalPages){this.page=A;}return true;}return false;},_inScroll:false,_inPaging:false,onscroll:function(){if(this.usePaging&&!this._inPaging){this._inScroll=true;this.set("page",this.listMapper.whichPage(this));this._inScroll=false;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash");var A=false,D="mstrmojo.Binding",I="bindings",H=mstrmojo.registry;function B(K){var L;for(L in K){var J=K[L];if(J&&J.disable){J.destroy();}}}function C(K,M){if(!A){mstrmojo.requiresCls(D);A=true;}var N;for(N in K){var J=K[N];if(J===null||J===undefined){continue;}var L=typeof J;if(L==="string"||L==="function"){J={destination:N,source:J,scriptClass:D};}J.parent=M;J=H.ref(J,{skipLoadChecks:true});K[N]=J;J.enable();}}mstrmojo._HasBindings=mstrmojo.provide("mstrmojo._HasBindings",{_meta_usesSuper:false,initBindings:function E(){this.hasInitBindings=true;var K=mstrmojo.hash.copy(this[I]);if(K){delete this[I];this._set_bindings(I,K);if(this.postCreateBindings){this.postCreateBindings();}}var M=this.children,J=(M&&M.length)||0;if(J){var L;for(L=0;L<J;L++){var N=M[L];if(N&&N.initBindings){N.initBindings();}}}},destroyBindings:function G(){var J=this.bindings;if(J){B(J);delete this.bindings;}},_set_bindings:function F(L,J){var K=this[I];if(J!==K){if(K){B(K);}this[I]=J;if(J){C(J,this);}return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.array","mstrmojo.publisher");var D=mstrmojo.registry,K=mstrmojo.array,I=mstrmojo.publisher;function G(Q,R){if(R){R.parent=Q;var P=D.ref(R);if(R!==P){delete R.parent;}return P;}return null;}function L(Q,R){var P=R.alias;if(P!==null&&P!==""){Q[P]=R;}}function N(Q,R){var P=R.alias;if(R.parent===Q){delete R.parent;}if((P!==null&&P!=="")&&(Q[P]===R)){delete Q[P];}}function A(U,Q){var P=Q&&Q.length,S,R;if(P){S=[];for(R=0;R<P;R++){var V=G(U,Q[R]);if(!V){continue;}S.push(V);L(U,V);}}return S;}mstrmojo._HasChildren=mstrmojo.provide("mstrmojo._HasChildren",{_meta_usesSuper:false,children:null,postCreateChildren:mstrmojo.emptyFn,onaddChild:null,onremoveChild:null,initChildren:function F(){var P="children",Q=this[P];if(!Q){return ;}this[P]=null;this._set_children(P,Q,true);this.postCreateChildren();},_set_children:function E(S,Q,P){var R=this.children;if(Q!==R){if(R){this.removeChildren(null,P);}this.addChildren(Q,0,P);}return false;},destroyChildren:function C(S){var R=this.children,P=(R&&R.length)||0,Q;if(P){for(Q=P-1;Q>-1;Q--){var U=R[Q];if(U&&U.destroy){U.destroy(S);if(!S){N(this,U);}}}if(!S){R.length=0;}}},invalidateChildren:function B(){mstrmojo.array.forEach(this.children,function(P){P.invalidate();});},invalidate:function H(){this.invalidateChildren();},addChildren:function O(V,Q,R){if(!V){return V;}var U=V.constructor===Array,P=A(this,U?V:[V]);if(P&&P.length){var S=this.children||[];if(Q===null||Q===undefined){Q=S.length;}this.children=K.insert(S,Q,P);if(!R&&(this.onaddChild||I.hasSubs(this.id,"addChild"))){this.raiseEvent({name:"addChild",value:P,index:Q});}}return U?P:(P&&P[0]);},removeChildren:function J(W,R){var U=this.children,V=W?[W]:(this.children||[]).concat(),Q=V.length,P=-1,S;if(Q){for(S=Q-1;S>-1;S--){N(this,V[S]);}if(W){P=K.removeItem(U,W);}else{if(U){U.length=0;P=0;}}if(!R&&(this.onremoveChild||I.hasSubs(this.id,"removeChild"))){this.raiseEvent({name:"removeChild",value:V,index:P});}}return P;},removeAndDestroyChild:function M(R,P,Q){if(R){if(R.parent!==this){throw"Unable to remove an object that is not in the children collection.";}this.removeChildren(R,P);R.destroy(Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.array");var H=mstrmojo,F=H.array,A="00000000000000000000000000000000",E=-1;function J(K){return K&&K.t===4&&K.id!==A;}function G(L){var K,M=(L&&L.length)||0;if(M===0){return false;}for(K=0;K<M;K++){if(!J(L[K])){return false;}}return true;}mstrmojo.VisProps=null;mstrmojo.vi.viz.DropZoneHelper=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.vi.viz.DropZoneHelper",getXml:function B(){return"";},setData:function I(K){},isMetric:function(K){return J(K);},isMetricZone:function(K){return G(K);},getMetricCountInZone:function D(L){var K=0;F.forEach(L,function(M){if(J(M)){K++;}});return K;}});mstrmojo.vi.viz.DropZoneHelper.METRIC_NAMES_ID=A;mstrmojo.vi.viz.DropZoneHelper.isMetricNames=function C(K){return(parseInt(K.did,10)===E)||(K.id===A)||(K.did===A);};}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var M=mstrmojo.string,L=mstrmojo.hash,E=mstrmojo.dom;var R=mstrmojo.usesFrames?null:document.createElement("span");var J=/mstrAttach:([\w,]+)/g;var Q;function V(b,c){if(Q===undefined){Q=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return b.replace(J,function a(j,l){var f=l.split(","),g=[],d=f.length,h;for(h=0;h<d;h++){var k=f[h];if(k){if(Q){if(k.indexOf("mouse")>-1){continue;}else{if(k==="click"){k="touchend";}}}g.push("on"+k+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+k+"', self, event)\"");}}return g.join(" ");});}var N="preBuildRendering",C="buildRendering",B="postBuildRendering";function Y(c){var b=c.markupString;if(b.match(/mstrAttach:/)){b=V(b,c);if(c.markupString===c.constructor.prototype.markupString){c.constructor.prototype.markupString=b;}}var a=M.apply(b,c);if(a){if(a.indexOf("oncontextmenu")>-1){c.hasContextMenuEvent=true;}if(mstrmojo.usesFrames){var e=(c.domNode&&c.domNode.ownerDocument)||window.document;if(!R||R.ownerDocument!==e){R=e.createElement("span");}}R.innerHTML=a;var f=R.removeChild(R.firstChild);f.mstrmojoId=c.id;return f;}return null;}function A(c){var b=c.markupSlots,a,d;if(b){a={};for(d in b){a[d]=b[d].call(c);}}return a;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function Z(){if((this[N]&&this[N]()===false)||(this[C]()===false)||(this[B]&&this[B]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var a="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,a)){this.raiseEvent({name:a});}return true;},buildDom:function U(){return Y(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function F(){var a=this.domNode,b=this.buildDom();this.domNode=b;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(A(this));this.paint();if(b){var e=a;if(!e){e=this.placeholder;if(e){if(typeof e==="string"){e=document.getElementById(e);}delete this.placeholder;}}if(e){E.replace(e,b);}}var c="onchildRenderingChange",d=this.parent;if(d&&d[c]){d[c](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function S(c){if(this.hasRendered){if(!c){try{var a=this.domNode;if(a.parentNode){a.parentNode.removeChild(a);}if(mstrmojo.dom.isIE&&a.outerHTML!=="undefined"){a.outerHTML="";}}catch(b){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function K(){var b=this.markupMethods;if(!b){return ;}var e=this,f=function(k){var j=b[k];if(j){try{j.apply(e,[true]);}catch(h){throw new Error(["Error in markup method.","Script class: "+e.scriptClass,"Widget id: "+e.id,"Method name: "+k,"Err: "+h.message].join("\n\n"));}}};var d=b.sequence,a,c,g;if(d){a=d.length||0;for(c=0;c<a;c++){f(d[c]);}}else{for(g in b){f(g);}}},redraw:function P(){return false;},refresh:function D(a){if(this.hasRendered){if(this.redraw()!==true){var b=this.domNode;this.unrender(true);this.placeholder=b;if(a){a();}this.render();}}},set:function I(d,a){this._super(d,a);if(this.domNode){var b=this.markupMethods,c=b&&b["on"+d+"Change"];if(c){c.apply(this);}}return this;},slotNames:null,addSlots:function G(b){var a=this.slotNames,c;if(!a){a={};this.slotNames=a;}for(c in b){this[c]=b[c];a[c]=true;}},removeSlots:function H(a){if(a){var b=this.slotNames,c;for(c in a){delete this[c];if(b){delete b[c];}}}},captureDomEvent:function X(c,a,d,b){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(c,a,d||a.event,b));}},playEffect:function W(b){var a=this[b];if(a&&a.constructor===Object){a=mstrmojo.insert(mstrmojo.hash.clone(a));a.widget=this;this[b]=a;}if(a){a.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function O(b,a){b.prototype.markupMethods=L.copy(a,L.copy(b.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(d,a,c,b){return{name:d,hWin:a,e:c,config:b,ctrlKey:E.ctrlKey(a,c),shiftKey:E.shiftKey(a,c),metaKey:E.isMetaKey(a,c),cancel:function(){E.stopPropogation(a,c);},preventDefault:function(){E.preventDefault(a,c);},getTarget:function(){return E.eventTarget(a,c);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.string");var X=mstrmojo.dom,L=mstrmojo.string,b=mstrmojo.array;mstrmojo.css=mstrmojo.provide("mstrmojo.css",{DISPLAY_TABLE:X.isNSIE?"block":"table",DISPLAY_CELL:X.isNSIE?"block":"table-cell",MINHEIGHT:X.isIE6?"height":"minHeight",addClass:function M(j,h){if(j){if(h.constructor!==Array){h=[h];}var e=j.className||"",l=" "+e+" ",f=false,d=h.length,g;for(g=0;g<d;g++){var k=h[g];if(!l.match(new RegExp("\\s"+k+"\\s"))){e+=" "+k;f=true;}}if(f){j.className=L.trim(e);}}return j;},removeClass:function O(g,f){if(!g){return ;}if(f.constructor!==Array){f=[f];}var d=" "+(g.className||"")+" ",c=f.length,e;for(e=0;e<c;e++){d=d.replace(new RegExp("\\s"+f[e]+"\\s","g")," ");}g.className=L.trim(d);},addWidgetCssClass:function N(h,f){var d=h.cssClass,g=(d&&d.split(" "))||[],e;f=[].concat(f);for(e=0;e<f.length;e++){var c=f[e];if(b.indexOf(g,c)===-1){g.push(c);}}h.cssClass=g.join(" ");},removeWidgetCssClass:function G(j,g){var d=j.cssClass,h=(d&&d.split(" "))||[],f;g=[].concat(g);for(f=0;f<g.length;f++){var c=g[f];var e=b.indexOf(h,c);if(e!==-1){h.splice(e,1);}}j.cssClass=h.join(" ");},toggleClass:function W(e,d,c){if(c){this.addClass(e,d);}else{this.removeClass(e,d);}},hasClass:function A(e,f){if(e){var d=" "+(e.className||"")+" ";return !!d.match(new RegExp("\\s"+f+"\\s"));}return false;},applyShadow:function H(g,h,f,e,c){var d=g.style;if(X.isDXIE){d.filter+="progid:DXImageTransform.Microsoft.dropshadow(OffX="+h+"px, OffY="+f+"px, Color='"+c+"')";}else{if(X.isFF||X.isWK||X.isIE10){d[X.CSS3_BOXSHADOW]=h+"px "+f+"px "+e+"px "+c;}}},removeShadow:function C(d){var c=d.style;if(X.isFF||X.isWK||X.isIE10){c[X.CSS3_BOXSHADOW]="";}},setOpacity:function Y(d,f){if(X.isDXIE&&!X.isIE9){var g=d.currentStyle.filter;var c=null;if(g.length>0){c=d.filters["DXImageTransform.Microsoft.Alpha"];}if(c){c.opacity=f;c.enabled=(f!==100);}else{if(f<100){var e="progid:DXImageTransform.Microsoft.Alpha(Opacity="+f+")";d.style.filter=(g||"")+" "+e;}}}else{d.style.opacity=f/100-(X.isIE9?0.00001:0);}},buildGradient:function P(d,f,c){if(X.supports(X.cssFeatures.GRADIENTS)){var e={};if(X.isDXIE){e.n="filter";e.v="progid:DXImageTransform.Microsoft.Gradient(GradientType="+d+",StartColorStr='"+f+"',EndColorStr='"+c+"')";}else{if(X.isFF){e.n="background-image";e.v="-moz-linear-gradient("+((d===0)?"top":"left")+","+f+","+c+")";}else{if(X.isWK){e.n="background";e.v="-webkit-gradient(linear,"+((d===0)?"left top, left bottom":"left top, right top")+",from("+f+"),to("+c+"))";}else{if(X.isIE10||X.isIEW3C){e.n="background";e.v="linear-gradient("+((d===0)?"to bottom":"to right")+","+f+","+c+")";}}}}return e;}return null;},buildRoundCorners:function R(h,g){if(X.supports(X.cssFeatures.ROUND_CORNERS)){var d=h+"px";var k=d+(g?" "+d+" 0 0":"")+";";if(X.isFF||X.isWinPhone||X.isIE10){return"border-radius:"+k;}if(X.isWK){if(!g){return"-webkit-border-radius:"+d+";";}var j=["left","right"],f=[],c=-1,e;for(e=0;e<2;e++){f[++c]="-webkit-border-top-"+j[e]+"-radius:"+d;f[++c]="-webkit-border-bottom-"+j[e]+"-radius:0";}return f.join(";");}}return"";},getBorderWidthsOrPaddings:function E(d,g){var h={t:0,r:0,b:0,l:0,h:0,w:0};if(!d){return h;}var e=d.split(" "),c=e.length,f;for(f=0;f<c;f++){e[f]=Math.round(g*parseFloat(e[f])/72);}if(c<4){if(c===1){e[1]=e[2]=e[3]=e[0];}else{e[3]=e[1];if(c===2){e[2]=e[0];}}}h.t=e[0];h.r=e[1];h.b=e[2];h.l=e[3];h.h=h.t+h.b;h.w=h.l+h.r;return h;},getBorderWidths:function I(d,c){return this.getBorderWidthsOrPaddings(d,c);},getPaddings:function D(d,c){return this.getBorderWidthsOrPaddings(d,c);},parkAfterFade:function B(c){var d=c.target.style;if(d.opacity===0){d.left="-10000px";window.setTimeout(function(){d.opacity=0.99;},0);return true;}return false;},getStyleValue:function J(c,g){var e=(g==="float"),f;if(c.currentStyle){g=e?"styleFloat":g;f=c.currentStyle[g];}else{if(document.defaultView&&document.defaultView.getComputedStyle){g=e?"cssFloat":g;var d=document.defaultView.getComputedStyle(c,null);f=d?d[g]:null;}}return f;},getComputedStyle:function V(c,e){var d=(window.getComputedStyle)?function(f,g){return window.getComputedStyle(f,g||null);}:function(f){return f.currentStyle||{};};mstrmojo.css.getComputedStyle=d;return d(c,e);},getCssTextFromObj:function F(e){var d="",c;for(c in e){d+=c+":"+e[c]+";";}return d;},onTransitionEnd:function a(e,c){var d="transition",f=window.Modernizr;if(f.testProp(d)){X.attachOneTimeEvent(e,X.transEndEvtNames[f.prefixed(d)],c);}else{window.setTimeout(c,0);}},onAnimationEnd:function U(e,c){var d="animation",f=window.Modernizr;if(f.testProp(d)){X.attachEvent(e,X.animationEndEvtNames[f.prefixed(d)],c);}else{window.setTimeout(c,0);}},flashClass:function Q(d,c,f){this.toggleClass(d,c,true);var e=this;window.setTimeout(function(){e.toggleClass(d,c,false);},f);},convertCssToCamelCase:function K(c){return c.replace(/\-([a-z])/gi,function(d,e){return e.toUpperCase();});},printCSSInfo:function Z(g){var m=document.styleSheets,p=m.length,h,k;for(k=0;k<p;k++){var l=m[k],n=l.cssRules,e=n?n.length:0,o=0;for(h=0;h<e;h++){var c=n[h].selectorText;if(c){try{o+=c.split(",").length;}catch(f){}}}var d=l.href;if(!g||(d&&d.indexOf(g)>-1)){console.log("Stylesheet: "+d||"Inline CSS Block");console.log("Total rules: "+e);console.log("Total selectors: "+o);}}},cssEscape:function S(j){if(arguments.length===0){throw new TypeError("`CSS.escape` requires an argument.");}var f=String(j),h=f.length,e=-1,g,c="",d=f.charCodeAt(0);while(++e<h){g=f.charCodeAt(e);if(g==0){c+="\uFFFD";continue;}if((g>=1&&g<=31)||g==127||(e==0&&g>=48&&g<=57)||(e==1&&g>=48&&g<=57&&d==45)){c+="\\"+g.toString(16)+" ";continue;}if(e==0&&h==1&&g==45){c+="\\"+f.charAt(e);continue;}if(g>=128||g==45||g==95||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122){c+=f.charAt(e);continue;}c+="\\"+f.charAt(e);}return c;}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");var D=mstrmojo.string,F=1;mstrmojo.ListBuilder=mstrmojo.provide("mstrmojo.ListBuilder",{newContext:function E(G){var I=G.itemMarkupFunction;if(!I){var H=G.itemMarkup||(G.itemField&&'<div class="mstrmojo-text">{@'+G.itemField+"}</div>");I=H?function(K,J,L){return D.apply(H,K);}:null;}return{itemStatus:[],itemFunc:I};},build:function A(I,H,J,G){H.itemStatus[G]=F;return H.itemFunc(J,G,I);},onadd:function B(I,G,H){if(G){mstrmojo.array.insert(G.itemStatus,H.index,new Array(H.value.length));}},onremove:function C(I,G,H){if(G){G.itemStatus.splice(H.index,H.value.length);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.vi.enums.EnumFilterClearActionType","mstrmojo.vi.enums.EnumVisFilterType");var D=mstrmojo.array,M=mstrmojo.string,H=mstrmojo.vi.enums.EnumFilterClearActionType,J=mstrmojo.vi.enums.EnumVisFilterType;mstrmojo.vi.ui.rw._SupportViewFilterInVizBox=mstrmojo.provide("mstrmojo.vi.ui.rw._SupportViewFilterInVizBox",{_mixinName:"mstrmojo.vi.ui.rw._SupportViewFilterInVizBox",getSelectorObjectsFromTemplateLimit:function N(){return this.getSelObjsFromTemlateLimitHandler();},getSelectorObjectsFromViewFilter:function B(){return this.getSelObjsFromVFHandler();},getSelObjsFromVFHandler:function F(){var R=this,P=R.model,Q=R.node.data,S=Q&&Q.vfexpr;return P&&P.getSelectorDataFromViewFilter(S);},getSelObjsFromTemlateLimitHandler:function K(){var R=this,P=R.model,Q=R.node.data,S=Q&&Q.tpl;return P&&P.getSelectorDataFromTemplateLimit(S);},makeBold:function C(P){return"<span style='font-weight:bold;'>"+P+"</span>";},getSelectorExpr:function I(U,S){var V=[],W="",R=true,Q=U.keepOnly?"##":mstrmojo.desc(13232,"Not ##"),P,X=mstrmojo.desc(5283,"OR");if(S){X=this.makeBold(X);}U.data.every(function(Y){[].concat(Y).every(function(Z){if(W===""){W=Z.tn;}return(R=(W===Z.tn));});return R;});U.data.forEach(function(a,Y){if(Y>0){V.push(X);}var Z=[];[].concat(a).forEach(function(d){var c=S?M.encodeHtmlString(d.v):d.v,b=S?M.encodeHtmlString(d.tn):d.tn;Z.push((R?"":(d.tn+" = "))+(c||mstrmojo.desc(14323,"NULL")));});V.push(Z.join(" "));});if(V.length>0){P=Q.replace("##",(R?W+" = ":"")+V.join(" "));}return P;},getLinkingSelectorExpr:function O(S,R){var U=[],V="",Q=true,W=mstrmojo.desc(5283,"OR"),P=S.keepOnly?"##":mstrmojo.desc(13232,"Not ##");if(R){W=this.makeBold(W);}S.data.every(function(X){[].concat(X).every(function(Y){if(V===""){V=Y.tn;}return(Q=(V===Y.tn));});return Q;});S.data.forEach(function(Z,X){var Y=[];if(Q){if(X>0){Y.push(W);}else{Y.push(P.replace("##",V+" = "));}}[].concat(Z).forEach(function(c){var b=R?M.encodeHtmlString(c.v):c.v,a=R?M.encodeHtmlString(c.tn):c.tn;Y.push((Q?"":(a+" = "))+(b||mstrmojo.desc(14323,"NULL")));});U.push(Y.join(" "));});return U.join(" ");},getFilterMenuPairs:function G(P){var R=this,S=[],Q=mstrmojo.desc(2827,"Clear");if(P instanceof Array){P.forEach(function(X,W){var V=R.getSelectorExpr(X),U=R.getSelectorExpr(X,true);S.push({menuString:Q+' "'+V+'"',menuTtpString:Q+' "'+U+'"',ctxt:W});});}return S;},filterMenuHandler:function L(P,S){var R=this,Q=R.controller;switch(P.type){case H.CLEAR_KEEP_ONLY:P=P.idx;Q.applyKeepOnly(R,S,undefined,P,false);break;case H.CLEAR_ALL:Q.clearFiltersForVis(R,[J.KEEP_ONLY,J.LINKING,J.DRILLING],S);break;case H.CLEAR_ADV_QUALIFICATION:Q.clearFiltersForVis(R,[J.ADV_QUALIFICATION],S);break;case H.CLEAR_KEEP_ONLY_AND_LINKING:Q.clearFiltersForVis(R,[J.KEEP_ONLY,J.LINKING],S);break;case H.CLEAR_LINKING:Q.clearLinkingFilter(P,S);break;case H.CLEAR_DRILLING:Q.clearFiltersForVis(R,[J.DRILLING],S);break;default:break;}},hasKeepOnly:function E(P){return P===null||P.length>0;},getSelectorDataForKeepOnly:function A(Q,V){var S=this,R=S.model,U=S.model.data||S.node.data,P=U.tpl,W;if(V===-1){W=[];}else{W=[].concat(R.getSelectorDataFromTemplateLimit(P));if(V===-2){W=D.filter(W,function(X){return !X.keepOnly;});}else{if(V>=0){W.splice(V,1);}}}if(Q){W=W.concat(Q);}return W;}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher");var C=mstrmojo.publisher;mstrmojo._Provider=mstrmojo.provide("mstrmojo._Provider",{_meta_usesSuper:false,audibles:{"*":true},set:function F(N,H){var G=false,K=this["_set_"+N],I=this[N];if(K){G=K.apply(this,arguments);}else{this[N]=H;G=(I!==H);}if(G){var L=N+"Change",M=this.audibles||{},J=(M[N]===true)||((M[N]!==false)&&(M["*"]!==false));if(J&&(this["pre"+L]||this["on"+L]||this["post"+L]||C.hasSubs(this.id,L))){this.raiseEvent({name:L,prop:N,value:H,valueWas:I});}}return this;},raiseEvent:function B(H){var M=H&&H.name;if(!M){return null;}H.src=this;this.preHandleEvent(H);var K=["pre","on","post"],L=false,I,G;for(I=0,G=K.length;I<G;I++){var J=K[I]+M;if(this[J]){if(this[J](H)===false){L=true;break;}}}if(!L){this.postHandleEvent(H);C.publish(this.id,M,H);}return H;},preHandleEvent:mstrmojo.emptyFn,postHandleEvent:mstrmojo.emptyFn,attachEventListener:function A(G,H,I){return C.subscribe(this.id,G,I,H);},detachEventListener:function E(G){C.unsubscribe(G);},destroy:function D(){C.clearSubscriptions(this.id);if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ListSelector");var A=mstrmojo.dom;mstrmojo.TreeBrowserSelector=mstrmojo.provide("mstrmojo.TreeBrowserSelector",mstrmojo.hash.copy({premousedown:function B(F,I,E){if(A.isPrimaryMouseBtn(E.e)){var D=E.hWin,H=E.e,G=A.eventTarget(D,H),C=F.listMapper.findIndex(F,I,G);if(C>-1){F.toggleSelect(C);}}}},mstrmojo.hash.copy(mstrmojo.ListSelector)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.ListSelector");var C=mstrmojo.dom,B=C.isIE;mstrmojo.TreeNodeSelector=mstrmojo.provide("mstrmojo.TreeNodeSelector",mstrmojo.mixin({premousedown:function A(E,I,D){var G=(E&&E.tree)||E,H=D&&D.e;if(!H){return false;}var F=G.lastMouseDown;if(F){if((F.e===H)||(B&&((new Date())-F.dt<50))){return false;}}this._super(E,I,D);if(G){if(G.onnodemousedown){G.onnodemousedown(D);}G.lastMouseDown={e:H,dt:new Date()};}return true;}},mstrmojo.hash.copy(mstrmojo.ListSelector)));}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.dnd");var E=mstrmojo.dom;function B(I){return E.contains(this.getMovingHandle(),I.src.node,true,document.body);}mstrmojo._IsMovable=mstrmojo.provide("mstrmojo._IsMovable",{draggable:true,ownAvatar:true,getMovingHandle:function G(){return this.domNode;},getMovingTarget:function H(){return this.domNode;},isDragValid:function A(I){return B.call(this,I)||(this._super&&this._super(I))||false;},ondragstart:function C(J){if(B.call(this,J)){var K=this.getMovingHandle(),I=this.getMovingTarget().style;this._leftPos=parseInt(I.left,10);this._topPos=parseInt(I.top,10);this._hWidth=K.clientWidth;this._hHeight=K.clientHeight;}if(this._super){this._super();}},ondragmove:function F(L){if(B.call(this,L)){var M=L.tgt.pos,J=L.src.pos,K=this.getMovingTarget().style,I=E.windowDim();K.left=this.left=Math.min(Math.max(this._leftPos+M.x-J.x,-this._hWidth+40),I.w-40)+"px";K.top=this.top=Math.min(Math.max(this._topPos+M.y-J.y,-this._hHeight+20),I.h-20)+"px";}if(this._super){this._super();}},ondragend:function D(I){if(B.call(this,I)){delete this._leftPos;delete this._topPos;delete this._hWidth;delete this._hHeight;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.registry","mstrmojo._Provider","mstrmojo.array");var B=mstrmojo.registry,F=mstrmojo.array;mstrmojo.Obj=mstrmojo.declare(mstrmojo.Base,[mstrmojo._Provider],{scriptClass:"mstrmojo.Obj",id:"",init:function I(J){this.disposables=[];this._super(J);B.add(this);if(this.postCreate){this.postCreate();}},addDisposable:function G(M){var K=this.disposables,L,J;if(M.constructor===Array){for(L=0,J=M.length;L<J;L++){K.push(M[L]);}}else{K.push(M);}return M;},destroyDisposables:function D(J){F.forEach(this.disposables,function(K){if(K.destroy){K.destroy(J);}else{if(K.clear){K.clear();}}});this.disposables=[];},throwAbstractMethodError:function A(J){throw new Error(this.scriptClass+" must implement "+J+".");},destroy:function H(J){if(this.destroyed){return ;}this._super(J);this.destroyDisposables(J);B.remove(this);delete this.parent;this.destroyed=true;}});var C=mstrmojo.Obj;C.free=function E(J){if(J instanceof C){J.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.publisher","mstrmojo._Provider");var G=mstrmojo.hash,A=mstrmojo.array,B=mstrmojo.registry,D=mstrmojo.publisher;mstrmojo.Arr=mstrmojo.declare(null,[mstrmojo._Provider],{scriptClass:"mstrmojo.Arr",postApplyProperties:null,postCreate:null,length_bindEvents:["add","remove"],init:function H(K){var J;if(K&&K.data){J=K.data;delete K.data;}else{if(K){J=K;K=null;}}if(!J||J.constructor!==Array){J=[];}G.copy(mstrmojo.Arr.prototype,J);if(K){G.copy(K,J);}if(J.postApplyProperties){J.postApplyProperties();}B.add(J);if(J.postCreate){J.postCreate();}return J;},destroy:function E(){D.clearSubscriptions(this.id);B.remove(this);},add:function I(L,J,K){var M=L&&L.length;if(M){if(J==null){J=this.length;}A.insert(this,J,L);if(!K&&(this.onadd||D.hasSubs(this.id,"add"))){this.raiseEvent({name:"add",value:L,index:J});}}},remove:function F(J,L,K){if(L==null){L=1;}if((J!=null)&&L){var M=this.splice(J,L);if(!K&&(this.onremove||D.hasSubs(this.id,"remove"))){this.raiseEvent({name:"remove",value:M,index:J});}}}});mstrmojo.Arr.makeObservable=function C(J,K){if(!J){return ;}if(!K){K={};}K.data=J;return this.prototype.init(K);};})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.registry","mstrmojo.ListBuilder");var H=mstrmojo.hash,E=mstrmojo.registry,G=1;mstrmojo.WidgetListBuilder=mstrmojo.provide("mstrmojo.WidgetListBuilder",mstrmojo.mixin({newContext:function F(J){var K=J.itemFunction;if(!K){var I=J.itemConfig;K=I?function(M,L,N){var O=H.clone(I);O.data=M;O.parent=N;return E.ref(O);}:null;}return{itemStatus:[],itemWidgets:[],itemFunc:K};},build:function A(K,J,N,I){var L=J.itemFunc(N,I,K);if(L){J.itemStatus[I]=G;J.itemWidgets[I]=L;if(L.set){var M=K.selectedIndices;if(M&&M[I]){L.set("selected",true);}}}return L;},onadd:function C(K,I,J){if(I){mstrmojo.array.insert(I.itemWidgets,J.index,new Array(J.value.length));}this._super(K,I,J);},onremove:function D(L,J,K){if(J){var O=J.itemWidgets.splice(K.index,K.value.length),N,I;for(N=0,I=O.length;N<I;N++){var M=O[N];if(M&&M.destroy){delete M.parent;M.destroy();}}}this._super(L,J,K);},onchange:function B(S,J,P,U){if(U){var N=P.itemWidgets,L,O,I,R;for(O=0,I=U.removed,R=I&&I.length;O<R;O++){L=N[I[O]];if(L&&L.set){L.set("selected",false);}}var M,Q,K;for(M=0,Q=U.added,K=Q&&Q.length;M<K;M++){L=N[Q[M]];if(L&&L.set){L.set("selected",true);}}}}},H.copy(mstrmojo.ListBuilder)));}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.hash","mstrmojo.css");var F=mstrmojo.hash,C=mstrmojo.css;var D="open";function E(G){return G?G.popupConfig.hostElement:null;}mstrmojo.ui.menus._HasMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._HasMenuPopup",F.copy(mstrmojo._HasPopup));mstrmojo.ui.menus._HasMenuPopup.openPopup=function A(I,G){var H=this._lastOpened;if(H){this.closePopup();}mstrmojo._HasPopup.openPopup.call(this,I,G);C.addClass(E(I),D);};mstrmojo.ui.menus._HasMenuPopup.closePopup=function B(){C.removeClass(E(this._lastOpened),D);mstrmojo._HasPopup.closePopup.call(this);};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var K=mstrmojo.css,N=mstrmojo.string,H=mstrmojo.dom,L=13,C=27;function I(U){if(this._editComplete){return ;}var Y,R=false,X=this.text,V=false;if(U===C){Y=X;V=true;R=true;}if((!U&&U!==0)||(!this.allowNewLine&&U===L)){var S=this[this.editableSlot],W=S.innerText||S.textContent||"";if(!this.allowNewLine){Y=W.replace(/\n/g,"");}else{Y=W;}R=true;if(!this.allowEmptyText&&Y.length===0){Y=X;V=true;}}if(R){this._editComplete=true;Y=Y.replace(/\u00A0/g,"\u0020");this.text=Y;this.set("isEditing",false);this.onTextEditComplete(Y!==X,X);delete this._editComplete;}if(V){this.refresh();}}function E(R){var S={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[S[R.name]]||(R.name==="click"&&this.editOnTwoClicks)&&R.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function F(U,S,R){if(typeof S["on"+R]!=="function"){H.attachMarkupEvent(U,S,R);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,editOnTwoClicks:false,firstClickTime:undefined,allowEmptyText:false,allowTrimming:true,allowNewLine:false,editOnDoubleClick:false,onTextEditBegin:mstrmojo.emptyFn,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function A(){this._super();var U=this.editableSlot,R=this[U],V=this[this.editButtonSlot||U];K.addClass(R,"hasEditableText");this.text=this.text||R.innerText||R.textContent||"";R.innerHTML=this.getEditableTextInnerHTML();var S=this.id;if(this.editOnClick||this.editOnTwoClicks){F(S,V,"click");}F(S,V,"dblclick");F(S,R,"blur");F(S,R,"keyup");F(S,R,"keydown");},getEditableTextInnerHTML:function Q(){return N.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");},onclick:function P(R){if(this.editOnClick){E.call(this,R);}if(this._super){this._super(R);}},onTwoClicks:function(R){if(this.editOnTwoClicks){E.call(this,R);}if(this._super){this._super(R);}},ondblclick:function G(R){E.call(this,R);},onblur:function M(){I.call(this);},onkeyup:function B(S){var R=window.event||S.e;I.call(this,R.keyCode);},onkeydown:function J(S){var R=window.event||S.e;if(R.keyCode===L){I.call(this,R.keyCode);S.cancel();}},_set_text:function D(U,R){var S=this.text;this.text=R;if(this.hasRendered){this[this.editableSlot].innerHTML=N.encodeHtmlString(R||"",true);}return(S!==R);},onisEditingChange:function O(){if(this.hasRendered){var R=this[this.editableSlot],S=!!this.isEditing;R.contentEditable=S;R.spellcheck=false;K.toggleClass(R,"editable",S);if(S){R.focus();H.setElementSelection(R);this.onTextEditBegin();}else{R.blur();R.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var J={T:["top","left"],D:["height","width"],B:["border","border-color","border-style","border-width"],F:["font","color","text-decoration"],P:["padding"],BG:["background-color","fx"],RW:[]};J.RW=["z-index"].concat(J.T.concat(J.D));var D=mstrmojo.dom,O=mstrmojo.css;function N(U,W,S){var V=U[W]||[];V.push(S);U[W]=V;}function L(X,W){var V=((X&&X.fmts)||null);if(W){var Z=X.thresholds,U=Z&&Z[W];if(U){var Y={},a;for(a in V){Y[a]=U[a]||V[a];}for(a in U){var S=U[a];Y[a]=(typeof S==="string")?(S+" !important"):S;}V=Y;}}return V;}mstrmojo._Formattable=mstrmojo.provide("mstrmojo._Formattable",{_mixinName:"mstrmojo._Formattable",formatHandlers:null,thresholdId:null,getCacheKey:function E(){return"css_cache"+(this.thresholdId||"");},update:function G(U){var S=true;this.invisible=!!(U&&U.data&&U.data.invisible);if(this._super){S=this._super(U);}return S;},buildCSSFormatString:function H(V,e){var j=this.formatHandlers[V],l=j.src?e[j.src]:e;if(!l){return null;}var c=j.props||j;if(!c){return null;}var Y=[],h=-1;var W=c.length-1;for(W;W>=0;W--){var k=c[W];var d=J[k]||[k];var b=d.length-1;for(b;b>=0;b--){k=d[b];var U=l[k];if(U!==undefined){if(k==="fx"){var Z=U,S={};var g=Z.gd;if(g){this.formatGradient(g,S);}var X=parseInt(Z.rt,10);if(X){if(X===1||X===3){this.formatTextRotation(Z.rt,S);}}if(Z.ds){this.formatDropShadow(Z,S);}var a;for(a in S){Y[++h]=a+":"+S[a].join(" ");}}else{Y[++h]=k+":"+U;}}}}if(this.invisible){Y.push("visibility:hidden");}return Y.join(";")+";";},applyCSSFormatToNode:function I(V,S){var W=this[V],U=W&&W.style;if(U){this.buildCSSFormatString(V,S).split(";").forEach(function(X){var Y=X.split(":");U[O.convertCssToCamelCase(Y[0])]=Y[1];});}},clearSlotBackgroundCSS:function F(U){var V=this[U],S=V&&V.style;if(S){S.background="transparent none 0 0 no-repeat";S.filter="none";}},preBuildRendering:function B(){this._super();var W=this.formatHandlers,S=this.getFormats();if(W&&S){var X=this.defn=this.defn||{},Y=this.getCacheKey(),V=X[Y];if(!V){V=X[Y]={};for(var U in W){var a=U+"CssText";this[a]=V[a]=this.buildCSSFormatString(U,S)||"";}}else{var Z;for(Z in V){this[Z]=V[Z];}}}return true;},formatGradient:function P(S,V){var U=O.buildGradient(S.t,S.sc,S.ec);if(U){N(V,U.n,U.v);}},formatDropShadow:function K(X,V){if(D.supports(D.cssFeatures.DROP_SHADOW)){var W=X.ds;if(D.isDXIE){N(V,"filter","progid:DXImageTransform.Microsoft.DropShadow(Color='#66000000',Positive='true',OffX="+W+",OffY="+W+")");}else{var S=[W,W],U=parseInt(X.rt,10);if(U===1||U===3){S[((U===1)?1:0)]=-W;}N(V,(D.isWK?"-webkit-":"")+"box-shadow",S.join("px ")+"px 3px 0px #888");}}},formatTextRotation:function C(U,S){if(D.supports(D.cssFeatures.TEXT_ROTATION)){if(D.isDXIE){N(S,"filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+U+")");}else{var V=(U===1)?90:-90;N(S,D.CSS3_PREFIX+"transform-origin","top left");N(S,D.CSS3_PREFIX+"transform","rotate("+V+"deg)");}}},getFormats:function R(){if(!this.fmts){this.fmts=L.call(this,this.defn,this.thresholdId);}return this.fmts;},clearFormats:function A(){this.fmts=undefined;},createEmptyFormats:function(){return(this.fmts=this.fmts||{});},clearCache:function Q(){delete this.defn[this.getCacheKey()];},unrender:function M(S){if(this.thresholdId){this.fmts=null;}this._super(S);}});mstrmojo._Formattable.getBorderWidths=function(X){var W=X.getFormats(),S=(W.border)?W.border.match(/(\d*|\d*\.\d*)pt/)[0]:W["border-width"],V=X.model,U=V.docModel;return O.getBorderWidths(S,(U&&U.dpi)||V.dpi);};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var A=1,K="mstrmojo-itemwrap",J="&nbsp;",I=mstrmojo.array;function B(W){if(!W.pageSize||W.pageSize<=0){var X=W.scrollboxNode;W.pageSize=X&&X.clientHeight||0;}return W.pageSize;}function U(W,X){if(W.usePaging){W.totalPages=1;var Z=W.itemsContainerNode,Y=B(W);if(W.usePaging&&Z&&Y){W.totalPages=Math.ceil((Z.clientHeight-parseInt(Z.style&&Z.style.paddingBottom||0,10))/Y);}if(Z){W.itemsContainerNode.style.paddingBottom=Y+"px";}}}mstrmojo.ListMapper=mstrmojo.provide("mstrmojo.ListMapper",{markupPrefix:"",markupSuffix:"",itemWrapperPrefix:function(W){return'<div class="'+this.getWrapperCss(W)+'">';},itemWrapperSuffix:"</div>",itemWrapperPrefill:"&nbsp",wrapperNodes:function C(W){return W.childNodes;},wrapperParentNode:function D(W){return W;},createWrapperNode:function G(W){var X=W.ownerDocument,Y=X.createElement("div");return Y;},findScrollRange:function N(l,a,k,o,X,d,q,n){if(!a){return{start:0,end:0};}var f=this.wrapperNodes(l),j=parseInt(a/2,10),Z=parseInt(Math.log(a)/Math.log(2),10),Y=0,W=a-1,g=k+o,e=f[0].offsetTop,c;for(var m=1;m<=Z;m++){c=f[j].offsetTop-e+n;if(c<k){Y=j;}else{if(c>g){W=j;}}var b=Math.round(a/Math.pow(2,m+1));j+=(c>k)?-b:b;j=Math.min(Math.max(0,j),a-1);}return{start:Y,end:W};},findWrapper:function L(Y,W){var X=this.wrapperNodes(Y);return X&&X[W];},findIndex:function F(W,Z,Y){var X=this._nd2iw(W,Z,Y);return X?this._iw2idx(W,Z,X):-1;},itemOffsetTop:function V(X,b,W,Z){if(!Z){var Y=this.wrapperNodes(b);Z=Y&&Y[W];if(!Z){return 0;}}var a=b.firstChild;if(!a||(a===Z)){return 0;}else{return Z.offsetTop-a.offsetTop;}},whereDrop:function S(d,W,Y,c,X){var Z=this._nd2iw(d,W,Y),e,b,f;if(Z){b=this._iw2idx(d,W,Z);e=b;f=this.itemOffsetTop(d,W,null,Z);var a=Z.offsetHeight;if(c.y>X.top+f+a/2){e++;f+=a;}}else{return d.dropCuePos;}return{left:0,top:f,idx:e,idxActual:b};},getWrapperCss:function(W){return K;},postBuildRendering:function(a,Z,Y,X,W){U(X,this);},buildItemWrappers:function P(f,c,l,e,b,m){var n=this.itemWrapperPrefix(l),h=this.itemWrapperSuffix,a=n+this.itemWrapperPrefill+h,Z=[this.markupPrefix],X=1,W=l.selectedIndices||{},p=function o(k,j){for(var q=k;q<j;q++){Z[X++]=n;var t=c.build(l,e,f[q],q);if(W[q]){t=t.replace(/class\=\"([^\"]*)\"/,'class="$1 selected"');}Z[X++]=t;Z[X++]=h;}};var d=(f&&f.length)||0;b=b&&c?Math.min(b,d):0;if(b){p(0,b);}m=m&&c?Math.min(m,d-b):0;var g=d-m;for(var Y=b;Y<g;Y++){Z[X++]=a;}if(m){p(g,d);}Z.push(this.markupSuffix);return Z;},fillItemWrappers:function H(Y,h,e,n,g,X,c,m){var f=(h&&h.length)||0,l=this.wrapperNodes(Y),o=g.itemStatus,W=mstrmojo.css,a=n.selectedIndices||{};for(var d=X,j=Math.min(c+1,f),b=0;d<j;d++){if(o[d]!==A){l[d].innerHTML=e.build(n,g,h[d],d);if(a[d]){var Z=l[d].firstChild;if(Z){W.addClass(Z,["selected"]);}}b++;if(b===m){break;}}}return b;},onadd:function O(f,W,a,g){if(W&&g){var b=g.value.length,d=this.wrapperNodes(W),e=d[g.index],Z=this.getWrapperCss(f);for(var Y=0;Y<b;Y++){var X=this.createWrapperNode(W);X.className=Z;X.innerHTML=J;if(e){this.wrapperParentNode(W).insertBefore(X,e);}else{this.wrapperParentNode(W).appendChild(X);}}U(f,this);}},onremove:function Q(Z,d,W,Y){if(d&&Y){var b=this.wrapperNodes(d);if(b){var e=Y.value.length;for(var a=Y.index+e-1,X=Y.index;a>=X;a--){this.wrapperParentNode(d).removeChild(b[a]);}}U(Z,this);}},onchange:function R(h,Y,d,l){if(Y&&l){var e=this.wrapperNodes(Y);if(e){var X=mstrmojo.css,m=d.itemStatus,k;for(var c=0,W=l.removed,g=W&&W.length;c<g;c++){k=W[c];if(m[k]){X.removeClass(e[k].firstChild,["selected"]);}}for(var b=0,f=l.added,Z=f&&f.length;b<Z;b++){k=f[b];if(m[k]){X.addClass(e[k].firstChild,["selected"]);}}}}},_nd2iw:function E(X,a,Z){a=this.wrapperParentNode(a);if(a&&Z&&a!==Z){var W=X.domNode,Y=Z.parentNode;while(Y){if(Y===a){return Z;}if(Y===W){break;}Z=Y;Y=Z.parentNode;}}return null;},_iw2idx:function M(Y,c,b){var X=Y.items&&Y.items.length,Z=this.wrapperNodes(c),W=I.findBin(Z,b,"offsetTop",X);for(var a=W;a<X;a++){if(Z[a].offsetHeight){return a;}}return -1;},toPage:function(W,Y){var X=W.scrollboxNode;if(W.usePaging&&X){X.scrollTop=Y*B(W);}else{mstrmojo.alert("paging is not setup, can not perform paging.");}},whichPage:function(W){var X=W.scrollboxNode,Y=B(W);return Math.round((X&&Y&&X.scrollTop/Y)||0);},toItem:function(a,b){var Y=a&&a.itemsContainerNode,f=a.scrollboxNode,W=this.itemOffsetTop(a,Y,b),d=this.wrapperNodes(Y)[b].clientHeight,X=f.clientHeight,e=f.scrollTop,Z=e;if(W<e){Z=W;}else{if(e+X-d<W){Z=Math.min(W,W-X+d);}}f.scrollTop=Z;}});})();(function(){mstrmojo.requiresCls("mstrmojo.css");var A=mstrmojo.css;mstrmojo.ui._HasUITheme=mstrmojo.provide("mstrmojo.ui._HasUITheme",{_mixinName:"mstrmojo.ui._HasUITheme",themeClassName:"",postBuildRendering:function B(){var D=this.themeClassName;if(D){this.onthemeClassNameChange({value:D});}return this._super();},onthemeClassNameChange:function C(D){var F=this.domNode;if(F){var G=D.value,E=D.valueWas;if(G){A.addClass(F,D.value);}if(E){A.removeClass(F,D.valueWas);}}}});mstrmojo.ui._HasUITheme.EnumThemeNames={LIGHT_THEME:"mojo-theme-light",DARK_THEME:"mojo-theme-dark"};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=mstrmojo.dom,G=100,L=700;var B="mojo-safari-hide-nativeTooltip",H=mstrmojo.css;function M(O,N){return function(Q){var P=mstrmojo.all[O];if(P.customTooltipHandler){P.customTooltipHandler(Q);}P[(N?"move":"show")+"Tooltip"](Q,self);};}function A(){var O=this.tooltipNode||this.domNode,Q=this.id,N,P="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(R){mstrmojo.all[Q].hideTooltip(R,self);};}if(!this[P]){this[P]=M(Q,this.isDynamicTooltip);}O=[].concat(O);for(N=0;N<O.length;N++){O[N].removeAttribute("title");C.attachEvent(O[N],(this.isDynamicTooltip?"mousemove":"mouseover"),this[P]);C.attachEvent(O[N],"mouseout",this._ontooltipout);}}function I(){var Q=this.tooltipNode||this.domNode,P;if(Q&&Q.constructor!==Array){Q=[Q];}if(Q){var R=this._ontooltipover,O=this._ontooltipout,N=this._ontooltipmove;for(P=0;P<Q.length;P++){if(R){C.detachEvent(Q[P],"mouseover",R);}if(O){C.detachEvent(Q[P],"mouseout",O);}if(N){C.detachEvent(Q[P],"mousemove",N);}}}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,isIgnoreTooltipCloseDelay:false,hasWidgetContent:false,tooltipCloseDelay:G,hasOpenTooltip:false,postBuildRendering:function(){var N=this._super();if(this.useRichTooltip){A.call(this);}return N;},onuseRichTooltipChange:function K(){if(this.hasRendered){if(this.useRichTooltip){A.call(this);}else{I.call(this);this.hideTooltip();}}},showTooltip:function J(Q,P){var O=this;if(!O.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(Q);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var S={};for(var N in Q){S[N]=Q[N];}Q=S;}var U=this.richTooltip?this.richTooltip.areaId:undefined;if(C.isSafari&&Q){var R=Q.srcElement;if(window.getComputedStyle(R)["text-overflow"]==="ellipsis"){this.baseElement=R;H.toggleClass(R,B,true);}}this._tooltipTimeOut=window.setTimeout(function(){var V=O.richTooltip;if(O._closeTooltipTimeout){window.clearTimeout(O._closeTooltipTimeout);delete O._closeTooltipTimeout;}mstrmojo.tooltip.open(O,Q,P);O.tooltip.onmouseover=function(){if(O.richTooltip&&O.richTooltip.enableHover){window.clearTimeout(O._closeTooltipTimeout);window.clearTimeout(O._deactivationTimeout);if(O.tooltip){O.tooltip.onmouseout=function(W){var X=W.e;if((!X.toElement&&!X.relatedTarget)||!C.contains(this.domNode,W.e.toElement||W.e.relatedTarget)){O.hideTooltip();}};}}};O.tooltip.allowOtherTooltips=O.allowOtherTooltips;if(V&&V.onClose){O.tooltip.onClose=V.onClose;}O.hasOpenTooltip=true;O._hasActiveArea=true;O._tooltipAreaId=U;window.clearTimeout(O._deactivationTimeout);delete O._deactivationTimeout;},(this._hasActiveArea&&U&&U===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function D(N,P){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var R=this,O=N,Q=P;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(R,O,Q);},this.tooltipOpenDelay);},hideTooltip:function F(){var N=this;window.clearTimeout(this._tooltipTimeOut);if(C.isSafari&&this.baseElement){H.toggleClass(this.baseElement,B,false);}if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete N._deactivationTimeout;delete N._hasActiveArea;delete N._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if((!this.isIgnoreTooltipCloseDelay)&&N.richTooltip&&N.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete N._closeTooltipTimeout;},N.richTooltip.tooltipCloseDelay||this.tooltipCloseDelay);}else{if(N.tooltip){this.isIgnoreTooltipCloseDelay=false;mstrmojo.tooltip.close();}}this.hasOpenTooltip=false;},unrender:function E(N){I.call(this);this._super(N);}});mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY=L;mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY=G;}());(function(){mstrmojo.requiresClsP("mstrmojo","hash","css","array","desc");var R=mstrmojo.hash,m=mstrmojo.func,B=mstrmojo.css,f=mstrmojo.array;var E={lv:-1,hcd:false,epd:false,hid:false,dhid:false,children:[],displayChildren:[],parent:null,displayParent:null},k={rootItems:{},items:[],itemMap:{}};var l="hidden",C="expanded",q="collapsed",J="hierarchy",c="hasChildren",p="u;",X=10,M=7,o=32;mstrmojo.ui._IsHierarchyList=mstrmojo.provide("mstrmojo.ui._IsHierarchyList",{_mixinName:"mstrmojo.ui._IsHierarchyList",itemValueField:"v",init:function n(t){this._super(t);this.clearItems();},getItemProps:function g(w,t){var u=this._super(w,t),x=0;if(w.hcd){u.addCls(c);}if(w.v===p){u.addCls(l);}if(this.isHiearachyDisplay()){u.addCls(J);if(w.hid){u.addCls(l);}x=w.lv>=0?w.lv*X:0;}u.indent=x;return u;},_getItemNode:function S(t){var u=this.itemsContainerNode;return f.filterOne(u&&u.childNodes,function(w){return parseInt(w.getAttribute("idx"),10)===t;});},_buildItemsMarkup:function j(AB,u,w,x,z,AA){var t;if(this.isHiearachyDisplay()){t=this._buildDescendantsMarkup();}else{t=this._super(AB,u,w,x,z,AA);}return t;},_buildDescendantsMarkup:function a(AB,z){var AE=[],AA=this.itemRenderer&&this.itemRenderer.render,AC=AB?(z?[AB]:AB.displayChildren):(this.raad?this.getDisplayRoots():this.getRootItems()),u=this.blockCount,x=function(AF){if(!AF.hid&&!AF.dhid){AE.push(AA(AF,AF.idx,this));}if(AF.epd||AF.hid){f.forEach(AF.displayChildren,function(AH,AG){return AD.call(this,AH,AG);},this);}},AD=function(AG,AF){if(this.raad&&AF>=u){var AH=this.createRenderer(AG.lv,AG.displayParent,AG.parent,this.items.length,AF);this.items.push(AH);if(AH.displayParent){AH.displayParent.displayChildren.push(AH);}if(AH.parent){AH.parent.children.push(AH);}x.call(this,AH);return false;}else{x.call(this,AG);}};if(AA&&typeof AA==="function"){if(this.raad&&!AB){if(AC.length>u){var t=AC.slice(0,u),w=this.createRenderer(AC[u-1].lv,null,null,this.items.length,u);this.items.push(w);AC.push(w);t.push(w);AE=this._buildSiblingsMarkup(t);}else{AE=this._buildSiblingsMarkup(AC);}}else{f.forEach(AC,function(AG,AF){return AD.call(this,AG,AF);},this);}}return AE;},getItems:function U(){return this.items;},getItemByValue:function D(t){return this.itemMap[t];},isRootItem:function(t){return t.lv>=0&&t.v!==p&&!t.pid&&!t.parent;},getRootItems:function d(){return R.valarray(this.rootItems);},getDisplayRoots:function Y(){if(!this.displayRoots){var w=this.displayRoots=[],t=this.getRootItems(),u=function(x){f.forEach(x,function(z){if(!z.hid){w.push(z);}if(z.epd||z.hid){u(z.displayChildren);}});};u(t);}if(!this.initialDisplayRoots){this.initialDisplayRoots=w.slice();}return this.displayRoots;},getInitialDisplayRoots:function A(){if(!this.initialDisplayRoots){this.initialDisplayRoots=(this.getDisplayRoots()||[]).slice();}return this.initialDisplayRoots;},createRenderer:function I(z,u,x,t,w){return{n:mstrmojo.desc(1005,"More..."),lv:z,displayParent:u,parent:x,idx:t,fetcher:true,fake:true,config:{nextSiblingIdx:w}};},getItemAncestorMap:function F(u){var t=this.itemValueField,w={};while(u&&u[t]){w[u[t]]=true;u=u.parent;}return w;},getItemDescendantMap:function Z(w){var t=this.itemValueField,x={},u=function(z){x[z[t]]=true;f.forEach(z.children,function(AA){u(AA);});};u(w);return x;},clearItems:function h(){var t=this.itemsContainerNode;R.copy(R.clone(k),this);if(t){t.innerText="";this.updateScrollbars();}},addItems:function e(AA,w){var u=this.items,z=this.itemMap,t=this.rootItems,x=this.itemValueField,AC=[];f.forEach(AA,function(AD){var AG=AD[x],AE=this.getItemByValue(AG),AF=R.copy(AD,(AE?AE:R.clone(E)));if(!AE){AF.idx=u.length;u.push(AF);if(AG){z[AG]=AF;}}if(this.isRootItem(AF)){t[AG]=AF;}AC.push(AF);},this);f.forEach(AC,function(AF){var AD=this.getItemByValue(AF.pid),AE=this.getItemByValue(AF.dpid)||AD;if(AD){if(!AF.parent){AF.parent=AD;AD.children.push(AF);}if(!AF.hid&&!AF.dhid&&!AF.displayParent){AE.hcd=true;AF.displayParent=AE;AE.displayChildren.push(AF);}}delete AF.pid;delete AF.dpid;},this);if(!w){if(this.postAddItems){this.postAddItems(AC);}var AB=this.itemsContainerNode;if(AB){if(this.isHiearachyDisplay()){this.refresh();}else{AB.innerHTML+=this._buildSiblingsMarkup(this.getFlatDisplayItems(AC)).join("");this.updateScrollbars();}}}return AC;},addSiblingItems:function G(AC,z){var x=this.getItemByValue(z),u;if(x){f.forEach(AC,function(AE){if(AE.v!==z){AE.pid=AE.pid||z;}});}u=this.addItems(AC,true);if(this.postAddSiblingItems){this.postAddSiblingItems(u,x);}var AA=this.itemsContainerNode;if(AA&&this.isHiearachyDisplay()){var AB=this._buildSiblingsMarkup(u).join("");if(!z){AA.innerHTML+=AB;}else{if(x){var AD={},w=this._getItemNode(x.idx),t;if(w){AD[x.v]=true;while(w.nextSibling){t=this.getItemFromTarget(w.nextSibling);if(t&&t.displayParent&&AD[t.displayParent.v]){AD[t.v]=true;w=w.nextSibling;}else{break;}}w.outerHTML+=AB;}}}this.updateScrollbars();}return u;},addBranchItems:function L(u,z){var t=this.getItemByValue(z),x;if(t){f.forEach(u,function(AB){AB.pid=AB.pid||z;});}x=this.addItems(u,true);if(this.postAddBranchItems){this.postAddBranchItems(x,t);}var w=this.itemsContainerNode;if(w&&this.isHiearachyDisplay()){if(!z){f.forEach(x,function(AB){if(this.isRootItem(AB)){w.innerHTML+=this._buildDescendantsMarkup(AB,true).join("");}},this);}else{if(t){var AA=this._getItemNode(t.idx);if(AA){AA.outerHTML+=this._buildDescendantsMarkup(t).join("");}}}this.updateScrollbars();}return x;},updateItems:function H(t,u){if(u){f.forEach(t,function(AB,x,z){var AA=u[x],w=z[AA.p_index];if(w){AB.pid=w.v;}});}this.handleOriginalParent(t,u);this.setDisplayParent(t,u);this.clearItems();this.addItems(t,true);},handleOriginalParent:function P(t,u){if(u){f.forEach(t,function(AC,x,z){var AB=u[x],w=z[AB.p_index],AA=z[AB.original_p_index];if(w&&w.t===M&&AC.lv!==w.lv&&AA&&AA.pid===w.v){AC.pid=AA.v;}});}},setDisplayParent:function K(t,z,x){if(x){this.idMap=this.idMap||{};f.forEach(t,function(AB){this.idMap[AB.v]=AB;},this);}var w=this,u=function(AD,AC){var AB;if(!x&&z){var AE=z[AC].p_index;AB=t[AE];}else{if(x){AB=w.idMap[AD.pid];}}return AB;};f.forEach(t,function AA(AE,AC,AD){var AB=u(AE,AC);if(!AB||w.isRootItem(AE)){return AE.v;}if(!AE.dpid){AE.dpid=AB.hid?AA(AB,z&&z[AC]&&z[AC].p_index,AD):AB.v;}return AE.dpid;});},fetchItems:function V(x,AB){if(this.raad&&this.isHiearachyDisplay()&&(this.items||[]).length>0){return ;}x=x||{};var u=this,t=x.branch,AA=x.browseFlags&o,z=parseInt(x.level,10),w=z>=0;this.fetchItemsThroughTaskCall(x,m.wrapMethods(AB,{success:function(AC){if(u.raad===undefined&&AC&&u.isHiearachyDisplay()){u.raad=AC.raad;}if(AC&&AC.es){var AD=AC.es;if(z===(t&&t.lv+1||0)||(AA&&!u.raad)){u.addSiblingItems(AD,t&&t.v);}else{if(t&&!w){u.addBranchItems(AD,t.v);}else{u.addItems(AD);}}}}}));},updateItemNodesStatus:function W(){var t=this.itemsContainerNode&&this.itemsContainerNode.childNodes;f.forEach(t,function(w){var u=this.getItemFromTarget(w);if(u){B.toggleClass(w,CSS_SELECTED,u.isSelected);}},this);},_buildSiblingsMarkup:function O(w){var t=[],u=this.itemRenderer&&this.itemRenderer.render;if(u&&typeof u==="function"){f.forEach(w,function(x){t.push(u(x,x.idx,this));},this);}return t;},toggleCollapseExpandCss:function Q(u,t){B.toggleClass(u,q,!t);B.toggleClass(u,C,t);},doExpandCollapse:function b(t,AD){var AE=!AD.epd;AD.epd=AE;this.toggleCollapseExpandCss(t,AE);if(!this.isHiearachyDisplay()){return ;}var AB=this.getItemDescendantMap(AD),w,AC;if(AE){var u=AD.displayChildren&&AD.displayChildren[0];if(u){var z=this.getItemFromTarget(t.nextSibling);if(z&&z.displayParent===AD){var AA={},x;w=t.nextSibling;while(w){AC=this.getItemFromTarget(w);x=AC&&AC.displayParent;if(!x||!AB[AC.v]){break;}if(AA[x.v]){B.addClass(w,l);AA[AC.v]=true;}else{B.removeClass(w,l);if(!AC.epd){AA[AC.v]=true;}}w=w.nextSibling;}}else{t.outerHTML+=this._buildDescendantsMarkup(AD).join("");}}else{this.fetchItems({branch:AD,level:AD.lv+1});}}else{w=t.nextSibling;while(w){AC=this.getItemFromTarget(w);if(!AC||!AB[AC.v]){break;}B.addClass(w,l);w=w.nextSibling;}}this.updateScrollbars();},isHiearachyDisplay:function N(){return true;},fetchItemsThroughTaskCall:mstrmojo.emptyFn,getFlatDisplayItems:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.fx.AnimateProp");var S=mstrmojo.css;var Q=10;function C(X,a,Z){X.pauseScrollRendering(true);var Y=X.scrollboxNode,W=X.animate?X.scrollEffect:null;if(W&&W.play){if(W.isPlaying){W.cancel();}W.props={scrollTop:{start:Y.scrollTop,stop:a,isStyle:false}};W.onEnd=function(){X.pauseScrollRendering(false,null,Z);};W.play();}else{Y.scrollTop=a;X.pauseScrollRendering(false,null,Z);}}function K(d,f,W){var X=4;if(!W){W=0;}var g=Math.round(d.renderBlockSize/2);d.fillAt(Math.max(0,f-g),f+g);var c=d.itemsContainerNode,b=c.childNodes[f],a=d.listMapper.itemOffsetTop(d,c,null,b),e=parseInt(d.scrollboxNode.clientHeight/2,10)-b.offsetHeight/2,Y=Math.max(0,d.spacerMargin+a-e);if(Math.abs(d.scrollboxNode.scrollTop-Y)>2){C(d,Y,d.renderOnScroll?function(){if(W<=X){K(d,f,W++);}}:null);}else{var Z=d.animate?d.scrollEffect:null;if(Z&&Z.isPlaying&&Z.cancel){Z.cancel();d.pauseScrollRendering(false);}}}function J(Y){var Z=Y.itemsContainerNode,W=Z.lastChild,X=W?W.offsetTop+W.offsetHeight-Z.firstChild.offsetTop:0;return X;}function V(X){var W=J(X),Y=Math.max(0,parseInt((X.scrollboxNode.clientHeight-W)/2,10));C(X,Math.max(0,X.spacerMargin-Y));}function H(Y){var W=Y.selectedIndex,X=W>-1;Y.set("hasSelection",X);if(!Y.domNode){return ;}if(X){K(Y,W);}else{V(Y);}}function E(X){var Z=X.scrollboxNode,W=J(X),Y=W>Z.clientHeight/2;S.toggleClass(X.upArrowNode,["enabled"],Y);S.toggleClass(X.downArrowNode,["enabled"],Y);}function N(W,X){var Y=W.scrollboxNode;Y.scrollTop=Math.min(Math.max(Y.scrollTop+X,0),Y.scrollHeight-Y.offsetHeight);}function B(X,W){if(!X._scrollInter){var Y=Q*(W?-1:1);X._scrollInter=window.setInterval(function(){N(X,Y);},50);}}function R(W){if(W._scrollInter){window.clearInterval(W._scrollInter);W._scrollInter=null;}}mstrmojo._IsDial=mstrmojo.provide("mstrmojo._IsDial",{markupString:'<div id="{@id}" class="mstrmojo-Dial {@cssClass}" style="position:relative;"><div class="mstrmojo-Dial-uparrow"  onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], true)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], true)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"></div><div class="mstrmojo-Dial-scrollbox {@cssClass}" style="position:relative;{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-Dial-spacer" style="{@spacerCssText}"><div class="mstrmojo-Dial-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div></div></div><div class="mstrmojo-Dial-dnarrow" onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], false)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], false)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.childNodes[1];},spacerNode:function(){return this.domNode.childNodes[1].firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},upArrowNode:function(){return this.domNode.childNodes[0];},downArrowNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){S.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);}},animate:true,itemsEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:500,interval:25,slot:"itemsContainerNode",preStart:function(){var X=this.widget[this.slot],W=(X&&X.offsetWidth)||0;this.props=W?{left:{start:-W,stop:0,suffix:"px",isStyle:true}}:{};},revertOnCancel:false},scrollEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:250,interval:25,slot:"scrollboxNode",revertOnCancel:false},multiSelect:false,holdJumpOnly:true,audibles:{"*":true,hasSelection:false},initSpacer:function I(){var W=(this.cssText||"").match(/height:\s*(\d*)px/);if(W){this.spacerMargin=parseInt(Number(W[1])/2,10);var X=this.spacerMargin+"px";this.spacerCssText="padding-top: "+X+"; padding-bottom: "+X+";";}else{this.spacerMargin=0;delete this.spacerCssText;}},center:function U(){H(this);},preBuildRendering:function(){this.initSpacer();return this._super();},postBuildRendering:function D(){this._super();this.center();E(this);},refreshScroll:function G(){this.center();E(this);},prechange:function O(W){this._super(W);if(this.hasRendered){if(!this.multiSelect||(W&&W.added&&W.added.length)){this.center();}}},onclickarrow:function A(Y,X,W){N(this,Q*(W?-1:1));},onmouseoverarrow:function L(Y,X,W){if(!this.holdJumpOnly){B(this,W);}},onmouseoutarrow:function M(Y,X,W){R(this);},onmousedownarrow:function F(Y,X,W){if(this.holdJumpOnly){B(this,W);}},onmouseuparrow:function P(Y,X,W){R(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");var F=mstrmojo.css,E="px",J="hasOwnAvatar",I={x:0,y:0};function B(L){var K=this.createAvatar(L.src.node,L);if(K){F.addClass(K,[this.avatarCssClass,J]);this.avatar=L.avatar=document.body.appendChild(K);}}function C(){var K=this.avatar;if(K){K.parentNode.removeChild(K);delete this.avatar;F.removeClass(K,[this.avatarCssClass,J]);}}mstrmojo._HasOwnAvatar=mstrmojo.provide("mstrmojo._HasOwnAvatar",{_mixinName:"mstrmojo._HasOwnAvatar",draggable:true,ownAvatar:true,avatarCssClass:"",restrictedToAxis:undefined,isDragValid:function H(K){if(this._super){return this._super(K);}return false;},ondragstart:function D(K){B.call(this,K);this.positionAvatar(K.src.pos,K);if(this._super){this._super(K);}},ondragmove:function A(K){this.positionAvatar(K.tgt.pos,K);if(this._super){this._super(K);}},ondragend:function A(K){C.call(this);if(this._super){this._super(K);}},createAvatar:mstrmojo.emptyFn,positionAvatar:function G(O,L){if(this.avatar){var N=this.avatar.style,M=this.restrictedToAxis,K=(L&&L.dragOffsets)||I;if(M!=="y"){N.left=O.x+K.x+E;}if(M!=="x"){N.top=O.y+K.y+E;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom");var E=mstrmojo.css,C=mstrmojo.dom,B="dzMask",I="mask",J="idx";function G(K){E.toggleClass(this.domNode,I,false);E.toggleClass(K,B,false);}mstrmojo.architect.ui._HasTreeDropZone=mstrmojo.provide("mstrmojo.architect.ui._HasTreeDropZone",{_mixinName:"mstrmojo.architect.ui._HasTreeDropZone",ondragenter:function F(K){E.toggleClass(this.domNode,I,true);if(this._super){this._super(K);}},ondragover:function A(L){var P=L.src,O=L.tgt.node,K=L.dzNode;if(P&&P.data&&O!==K){E.toggleClass(K,B,false);var M=C.findAncestorByAttr(O,J,true,this.domNode);if(M){var N=M.node;L.dzNode=N;E.toggleClass(N,B,true);}}if(this._super){this._super(L);}},ondragleave:function H(K){G.call(this,K.dzNode);if(this._super){this._super(K);}},ondrop:function D(K){G.call(this,K.dzNode);if(this._super){this._super(K);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");function B(){var D=this.maskNode,E=this.isMasked;D.style.display=E?"block":"none";mstrmojo.css.toggleClass(D,"masked",E);}mstrmojo.vi.ui._HasMask=mstrmojo.provide("mstrmojo.vi.ui._HasMask",{_mixinName:"mstrmojo.vi.ui._HasMask",isMasked:false,postBuildRendering:function C(){if(this._super){this._super();}B.call(this);},onisMaskedChange:function A(){if(!this.hasRendered){return ;}B.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.num","mstrmojo.color","mstrmojo.hash","mstrmojo.array");var AN=mstrmojo.color,a=mstrmojo.hash,BZ=mstrmojo.array,BU=mstrmojo.css,m=mstrmojo.num;var BX=1,Az=2,A1=3,BG=4,Ah=5,Ai=6;var Bh="FormattingFont",L="FormattingAppearance",c="FormattingAlignment",Ao="FormattingSize",V="FormattingPatterns",I="FormattingBorder",BF="FormattingOrder",H="FormattingView",S="FormattingSelector",A3="Template Formatting",P="FormattingPadding",Ax="AnalyticalEngineProperties",A7="RWDocumentProperties",BP="FormattingPage",R="Mobile",Y="VLDB Select",AH="FormattingNumber",Ac="RWDExecution";var Aw=1;var p="n",Q="h",Ba="w",AL="wm",BM="pw",b="ml",BN="mr",AD="upwalw",AA="ff",Ar="fsz",BS="fw",AM="fit",BT="fun",x="fst",AC="fc",Z="alh",AB="alv",Al="atw",AT="atd",h="textOverflow",Av="bc",E="bgs",K="btc",Au="brc",Ae="bbc",z="blc",t="bts",Bc="brs",BH="bbs",Ak="bls",AZ="borderColor",BD="borderStyle",k="zIndex",Ab="showTitleBar",q="title",BB="ctrlStyle",AF="ctrlOrientation",BA="ctrlOrientationBehavior",o="ctrlMultiselect",l="ctrlAutoSearchEnabled",C="ciwm",BO="cmcy",BC="sec",w="easow",AS="layoutXml",M="lockAspectRatio",At="ism",n="shw",BE="mg",Bb="lhv",e="gridVPadding",Aq="gridHPadding",Ap="ln",AR="sar",B="hnv",An="iw",Aj="ih",AV="tsp",Af="visible",W="rf",Bg="jad",Ay="jdc",AO="ode",BI="fs",BL="ssc",j="sstyle",AK="hgl",A0="nct",A9="ncp",f="ncs",BQ="ndp",G="nfs",D="nnn",BW="nth",Bf="gi",A5="stfurh",d="stfuch",Bd="stfuva",N="olm",BR="gdc",Be="gda",Aa="layoutstyle";function U(Bi){return Bi;}function AX(Bi){return parseInt(Bi,10);}var AJ={name:"encode",_def:U};AJ[A1]=function(Bi){return Bi?1:0;};AJ[Az]=function(Bi){if(Bi==="transparent"){return -1;}if(Bi.length===4){Bi=Bi.replace(/([0-9a-f])/ig,"$1$1");}Bi=AN.rgbStr2hex(Bi);return parseInt(Bi.substring(5)+Bi.substring(3,5)+Bi.substring(1,3),16);};AJ[BG]=AX;AJ[BX]=function(Bi){if(typeof Bi==="number"){return m.toLocaleString(Bi);}return U(Bi);};AJ[Ai]=function(Bk){if(Bk==="none"){return 0;}var Bj=Bk.match(/([0-9]+[,\.]?[0-9]*pt)/)[0],Bi=Bk.match(/pt ([\w\W]*)/)[1];if(Bj==="2pt"){return 5;}switch(Bi){case"solid":return 1;case"dashed":return 3;case"dotted":return 4;default:throw new Error("Invalid border style value in FormatModel::encodeValue.");}};var BY={name:"decode",_def:U};BY[A1]=function(Bi){return parseInt(Bi,10)===1;};BY[Az]=function(Bi){if(Bi===-1){return"transparent";}if(typeof Bi==="number"){return AN.decodeColor(Bi);}if(Bi.length===4){return Bi.replace(/([0-9a-f])/ig,"$1$1");}return AN.rgbStr2hex(Bi);};BY[BG]=AX;BY[Ai]=function(Bk){if(Bk===undefined||Bk===0){return"none";}var Bj="1pt",Bi="solid";if(Bk===5){Bj="2pt";}if(Bk===3){Bi="dashed";}else{if(Bk===4){Bi="dotted";}}return Bj+" "+Bi;};function BJ(){return this.pn.toLowerCase();}function AU(Bi,Bk,Bl){var Bj=document.createElement("div");Bj.style[Bl||Bk]=Bi[Bk];return Bj;}function J(Bi){return function(){return AN.rgbStr2hex(Bi.apply(this,arguments));};}function As(){var Bi=BJ.call(this);return Bi==="underline"?Bi:"line-through";}var A6={name:"extract"},X=A6._def=function(Bi,Bk,Bl){var Bj=AU(Bi,Bk||this.getFormatBlockName(),Bl);return Bj.style[this.getCssName()];};A6[Az]=J(X);function AE(Bi){return X.call(this,Bi,this.getFormatBlockName())===BJ.call(this);}function A(Bi){var Bj=X.call(this,Bi,this.getFormatBlockName(),this.getCssName());return Bj.indexOf(As.call(this))>-1;}function A4(Bi){var Bj=this.getFormatBlockName();return AN.rgbStr2hex(X.call(this,Bi,Bj,Bj+this.pn));}var BV={name:"resolve"},g=BV._def=function(Bi,Bl,Bk,Bm){Bk=Bk||this.getFormatBlockName();var Bj=AU(Bi,Bk);Bj.style[Bm||this.getCssName()]=Bl;return Bj.style[BU.convertCssToCamelCase(Bk)];};BV[Az]=function(Bi,Bk,Bj,Bl){if(Bk.or!==undefined){return Bk;}return AN.rgbStr2hex(g.call(this,Bi,Bk,Bj,Bl));};function Ad(Bi,Bj){return g.call(this,Bi,Bj?BJ.call(this):"normal");}function AY(Bj,Bl){var Bk=(Bj[this.getFormatBlockName()]||"").split(" "),Bi=As.call(this);if(Bl){if(Bk.indexOf(Bi)===-1){Bk.push(Bi);}}else{Bk=Bk.filter(function(Bm){return Bm!==Bi;});}return g.call(this,Bj,Bk.join(" "));}var Am={name:"update"},BK=Am._def=function(Bi,Bj){Bi[this.getFormatBlockName()]=this.resolve(Bi,Bj);return Bi;};var AW={};AW[p]={ps:L,pn:"Name",pt:BX};AW[Q]={ps:Ao,pn:"Height",pt:BX};AW[Ba]={ps:Ao,pn:"Width",pt:BX};AW[AL]={ps:Ao,pn:"WidthMode",pt:BG};AW[BM]={ps:BP,pn:"PageWidth",pt:BX};AW[b]={ps:BP,pn:"MarginLeft",pt:BX,fn:"margin-left"};AW[BN]={ps:BP,pn:"MarginRight",pt:BX,fn:"margin-right"};AW[AD]={ps:BP,pn:"UsePageWidthAsLayoutWidth",pt:A1};AW[AA]={ps:Bh,pn:"Name",pt:BX,fn:"font",cn:"fontFamily",extract:function(){return X.apply(this,arguments).replace(/['"]/g,"");},resolve:function(Bi,Bk){var Bj=AU(Bi,"font");Bj.style.fontFamily="'"+Bk+"'";return Bj.style.font;}};AW[Ar]={ps:Bh,pn:"Size",pt:BG,fn:"font",cn:"fontSize"};AW[BS]={ps:Bh,pn:"Bold",pt:A1,fn:"font",cn:"fontWeight",extract:AE,resolve:Ad};AW[AM]={ps:Bh,pn:"Italic",pt:A1,fn:"font",cn:"fontStyle",extract:AE,resolve:Ad};AW[BT]={ps:Bh,pn:"Underline",pt:A1,fn:"text-decoration",extract:A,resolve:AY};AW[x]={ps:Bh,pn:"Strikeout",pt:A1,fn:"text-decoration",extract:A,resolve:AY};AW[AC]={ps:Bh,pn:"Color",pt:Az};AW[Z]={ps:c,pn:"Horizontal",pt:BG,fn:"text-align"};AW[Al]={ps:c,pn:"TextWrap",pt:A1,fn:"white-space"};AW[AT]={ps:c,pn:"TextDirection",pt:BG};AW[AB]={ps:c,pn:"Vertical",pt:BG};AW[h]={ps:Ao,pn:"TextOverflow",pt:A1};AW[Av]={ps:V,pn:"FillColor",pt:Az,x:Aw,fn:"background-color",update:function(Bi,Bk){var Bj=Bi.fx;if(Bk.or!==undefined){if(!Bj){Bj=Bi.fx={};}var Bl=Bj.gd=Bj.gd||{};Bl.ec=Bk.c2;Bl.sc=Bk.c1;Bl.t=Bk.or;delete Bi[this.getFormatBlockName()];Bi.fx=Bj;}else{if(Bj){delete Bj.gd;}BK.call(this,Bi,Bk);}return Bi;}};AW[E]={ps:V,pn:"FillStyle",pt:BG};AW[BL]={ps:V,pn:"SelectorSelectionColor",pt:Az};AW[j]={ps:V,pn:"SelectorSelectionFillStyle",pt:BG};AW[K]={ps:I,pn:"TopColor",pt:Az,fn:"border",extract:A4};AW[Au]={ps:I,pn:"RightColor",pt:Az,fn:"border",extract:A4};AW[Ae]={ps:I,pn:"BottomColor",pt:Az,fn:"border",extract:A4};AW[z]={ps:I,pn:"LeftColor",pt:Az,fn:"border",extract:A4};AW[AZ]={ps:I,pn:["TopColor","RightColor","BottomColor","LeftColor"],pt:Az,fn:"border",extract:A4,resolve:J(function(Bi,Bk){var Bl=this.getFormatBlockName(),Bj=g.call(this,Bi,Bk,Bl,Bl+"Color"),Bm=Bj.indexOf("rgb");if(Bm>-1){Bj=Bj.slice(0,Bm)+AN.rgbStr2hex(Bj.slice(Bm));}return Bj;})};AW[BD]={ps:I,pn:["TopStyle","RightStyle","BottomStyle","LeftStyle"],pt:Ai,fn:"border",extract:A4,resolve:function(Bi,Bl){var Bj=Bl.split(" "),Bm=this.getFormatBlockName();if(!Bi[Bm]){Bi[Bm]="transparent";}Bi[Bm]=g.call(this,Bi,Bj[0],Bm,Bm+"Width");var Bk=g.call(this,Bi,Bj[1]||"none",Bm,Bm+"Style"),Bn=Bk.indexOf("rgb");if(Bn>-1){Bk=Bk.slice(0,Bn)+AN.rgbStr2hex(Bk.slice(Bn));}return Bk;}};AW[t]={ps:I,pn:"TopStyle",pt:Ai,fn:"border",extract:A4};AW[Bc]={ps:I,pn:"RightStyle",pt:Ai,fn:"border"};AW[BH]={ps:I,pn:"BottomStyle",pt:Ai,fn:"border",extract:A4};AW[Ak]={ps:I,pn:"LeftStyle",pt:Ai,fn:"border",extract:A4};AW[k]={ps:BF,pn:"ZIndex",pt:BG,fn:"z-index"};AW[Ab]={ps:H,pn:"ShowTitleBar",pt:A1};AW[q]={ps:H,pn:"Title",pt:BX};AW[BB]={ps:S,pn:"Style",pt:BG};AW[AF]={ps:S,pn:"Orientation",pt:BG};AW[BA]={ps:S,pn:"OrientationBehavior",pt:BG};AW[o]={ps:S,pn:"Multiselect",pt:A1};AW[l]={ps:S,pn:"AutoSearchEnabled",pt:A1};AW[C]={ps:S,pn:"ItemWidthMode",pt:BG};AW[BO]={ps:S,pn:"MetricConditionType",pt:BG};AW[BC]={ps:S,pn:"ShowElementCount",pt:BG};AW[w]={ps:S,pn:"ExportAsShownOnWeb",pt:BG};AW[AS]={ps:Ao,pn:"LayoutXML",pt:Ah};AW[M]={ps:Ao,pn:"LockAspectRatio",pt:A1};AW[At]={ps:Ao,pn:"ImageSizeMode",pt:BG};AW[Aj]={ps:Ao,pn:"ImageHeight",pt:BX};AW[An]={ps:Ao,pn:"ImageWidth",pt:BX};AW[AV]={ps:A7,pn:"layoutBarPosition",pt:BX};AW[BI]={ps:A7,pn:"ExecutionFullScreenMode",pt:A1};AW[Aa]={ps:A7,pn:"LayoutStyle",pt:BG};AW[Af]={ps:L,pn:"Visible",pt:A1};AW[Ap]={ps:A3,pn:"LongNames",pt:BX};AW[N]={ps:A3,pn:"Indented",pt:BG};AW[AR]={ps:Ax,pn:"ShowAllRows",pt:BX};AW[B]={ps:Ax,pn:"HideNullZeroValues",pt:BX};AW[Aq]={ps:P,pn:["LeftPadding","RightPadding"],pt:BX};AW[e]={ps:P,pn:["TopPadding","BottomPadding"],pt:BX};AW.rowsshw={ps:A3,pn:"ShowRowHeaders",pt:BX};AW.rowsmg={ps:A3,pn:"MergeCells",pt:BX};AW.rowslhv={ps:A3,pn:"LockRowHeaders",pt:BX};AW.colsshw={ps:A3,pn:"ShowColumnHeaders",pt:BX};AW.colsmg={ps:A3,pn:"MergeColumnCells",pt:BX};AW.colslhv={ps:A3,pn:"LockColumnHeaders",pt:BX};AW[A5]={ps:A3,pn:"SubtotalFormatUseRowHeaders",pt:BX};AW[d]={ps:A3,pn:"SubtotalFormatUseColumnHeaders",pt:BX};AW[Bd]={ps:A3,pn:"SubtotalFormatUseValues",pt:BX};AW[W]={ps:R,pn:"RefreshFrequency",pt:BG};AW[Bg]={ps:Y,pn:"Join Across Datasets",pt:BG};AW[Ay]={ps:Y,pn:"MCE Join To Get Data Combination",pt:BG};AW[AO]={ps:Ac,pn:"OnDemandEvaluation",pt:BG};AW[AK]={ps:L,pn:"Highlight",pt:BG};AW[A0]={ps:AH,pn:"Category",pt:BG};AW[G]={ps:AH,pn:"Format",pt:BX};AW[f]={ps:AH,pn:"CurrencySymbol",pt:BX};AW[BQ]={ps:AH,pn:"DecimalPlaces",pt:BG};AW[A9]={ps:AH,pn:"CurrencyPosition",pt:BG};AW[D]={ps:AH,pn:"NegativeNumbers",pt:BG};AW[BW]={ps:AH,pn:"ThousandSeparator",pt:BG};AW[Bf]={ps:L,pn:"GroupInfo",pt:BX};AW[BR]={ps:V,pn:"GradientColor",pt:Az};AW[Be]={ps:V,pn:"GradientAngle",pt:BG};BZ.forEach(a.keyarray(AW),function(Bi){var Bj=AW[Bi];Bj.getFormatBlockName=function(){var Bl=this.fn;if(!Bl){var Bk=this.pn;Bl=Bk.charAt(0).toLowerCase()+Bk.substr(1);}return Bl;};Bj.getCssName=function(){var Bk=this.getFormatBlockName.call(this),Bl=this.cn;if(!Bl){Bl=BU.convertCssToCamelCase(Bk);}return Bl;};BZ.forEach([AJ,BY,A6,BV,Am],function(Bk){var Bl=Bk.name;Bj[Bl]=Bj[Bl]||Bk[Bj.pt]||Bk._def;});});function A8(Bl,Bk,Bi){var Bj=Bi[Bl.ps]=Bi[Bl.ps]||{};Bk=Bl.encode(Bk);BZ.forEach([].concat(Bl.pn),function(Bm){Bj[Bm]=Bk;});return Bi;}function AQ(Bo,Bn,Bi){var Bm=Bo.x;if(Bm){if((Bm&Aw)>0){var Bl=!!Bn.c1,Bk=0;if(Bl){A8(Bo,Bn.c1,Bi);var Bj=Bi[V];Bj.GradientColor=Bo.encode(Bn.c2);Bj.GradientAngle=Bn.or?0:90;Bj.GradientXOffset=0;Bj.GradientYOffset=0;Bk=2;}else{if(Bo.encode(Bn)===-1){Bk=1;}else{A8(Bo,Bn,Bi);}}return A8(AW[E],Bk,Bi);}}return null;}mstrmojo.models.FormatModel={getFormatUpdate:function Ag(Bj,Bm,Bi){var Bl=AW[Bj];if(!Bl){throw new Error("Invalid property "+Bj+" in FormatModel::getFormatUpdate.");}Bi=Bi||{};var Bk=AQ.call(this,Bl,Bm,Bi);if(Bk){return Bk;}return A8(Bl,Bm,Bi);},getFormatPropertyInfo:function u(Bi){return AW[Bi];},getValueFromUpdate:function O(Bj,Bk){var Bm=AW[Bj],Bi=null;try{Bi=Bk[Bm.ps][Bm.pn];}catch(Bl){}return Bi;},getGradientValues:function AP(Bj){var Bi=Bj.fx&&Bj.fx.gd;if(Bi){var Bl={c1:Bi.sc,c2:Bi.ec,or:Bi.t};return Bl;}if(Bj[E]===2){if(!!Bj.bc.c1){return Bj.bc;}var Bk={c1:Bj.bc,c2:Bj.gdc,or:Bj.gda===90?0:1};return Bk;}return null;},decodeGradientValue:function F(Bi){if(Bi&&Bi.c1){Bi.c1=this.decodeValue(BR,Bi.c1);Bi.c2=this.decodeValue(BR,Bi.c2);return Bi;}return null;},decodeValue:function AI(Bi,Bj){return AW[Bi].decode(Bj);},updateFormatBlock:function A2(Bi,Bj,Bk){return AW[Bj].update(Bi,Bk);},getFormatBlockValue:function AG(Bi,Bj){return AW[Bj].extract(Bi);},GradientType:null,FormatObjectType:null,PROPERTY_INFO_TYPE:null,ENUM_PROPERTY_NAMES:{NAME:p,HEIGHT:Q,WIDTH:Ba,WIDTH_MODE:AL,PAGE_WIDTH:BM,MARGIN_LEFT:b,MARGIN_RIGHT:BN,USE_PAGE_WIDTH_AS_LAYOUT_WIDTH:AD,FONT_FAMILY:AA,FONT_SIZE:Ar,FONT_WEIGHT:BS,FONT_STYLE:AM,UNDERLINE:BT,LINE_THROUGH:x,COLOR:AC,TEXT_ALIGN:Z,VERTICAL_ALIGN:AB,TEXT_WRAP:Al,TEXT_DIRECTION:AT,TEXT_OVERFLOW:h,BACKGROUND_COLOR:Av,FILL_STYLE:E,GRADIENT_COLOR:BR,GRADIENT_ANGLE:Be,BORDER_TOP_COLOR:K,BORDER_RIGHT_COLOR:Au,BORDER_BOTTOM_COLOR:Ae,BORDER_LEFT_COLOR:z,BORDER_TOP_STYLE:t,BORDER_RIGHT_STYLE:Bc,BORDER_BOTTOM_STYLE:BH,BORDER_LEFT_STYLE:Ak,BORDER_COLOR:AZ,BORDER_STYLE:BD,Z_INDEX:k,SHOW_TITLE_BAR:Ab,TITLE:q,CONTROL_STYLE:BB,CONTROL_ORIENTATION:AF,CONTROL_ORIENTATION_BEHAVIOR:BA,CONTROL_MULTISELECT:o,CONTROL_AUTOSEARCH:l,CONTROL_ITEM_WIDTH_MODE:C,CONTROL_METRIC_CONDITION_TYPE:BO,CONTROL_SHOW_ELEMENT_COUNT:BC,CONTROL_EXPORT_AS_SHOWN_ON_WEB:w,LAYOUT_XML:AS,LOCK_ASPECT_RATIO:M,IMAGE_SIZE_MODE:At,SHOW_HEADER:n,MERGE_HEADER:BE,LOCK_HEADER:Bb,LONG_NAME:Ap,SHOW_ALL_ROWS:AR,HIDE_NULL:B,IMAGE_WIDTH:An,IMAGE_HEIGHT:Aj,VISIBLE:Af,LAYOUT_TAB_POSITION:AV,GRID_VERTICAL_PADDING:e,GRID_HORIZONTAL_PADDING:Aq,REFRESH:W,JOIN_ACROSS_DATASET:Bg,MCE_JOIN_TO_GET_DATA_COMBINATION:Ay,ON_DEMAND_EVALUATION:AO,FULL_SCREEN_MODE:BI,SELECTOR_SELECTION_COLOR:BL,SELECTOR_SELECTION_FILL_STYLE:j,VIZ_HIGHLIGHTING:AK,GROUP_INFO:Bf,SUBTOTAL_FORMAT_USE_ROWHEADERS:A5,SUBTOTAL_FORMAT_USE_COLUMNHEADERS:d,SUBTOTAL_FORMAT_USE_VALUES:Bd,OUTLINE:N,LAYOUT_STYLE:Aa},ENUM_PROPERTY_SETS:{FORMATTING_NUMBER:AH},ENUM_NUMBER_FORMAT_KEYS_OBJ:{CATEGORY:A0,CURRENCY_POSITION:A9,CURRENCY_SYMBOL:f,DECIMAL_PLACES:BQ,FORMAT:G,NEGATIVE_NUMBERS:D,THOUSAND_SEPARATOR:BW}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css");var G=mstrmojo.array,F=mstrmojo.expr,H=mstrmojo.css;mstrmojo._IsExprNode=mstrmojo.provide("mstrmojo._IsExprNode",{ind:function B(){var L=this.parent;if(L&&L.indent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.indent(K);}}},out:function D(){var L=this.parent;if(L&&L.outdent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.outdent(K);}}},andOrTxt:function A(){var M=this.parent,K=M&&M.data,L="",N=this.data;if(K&&(K.et===F.ET.ANDOR)&&K.fn){L=K.fn+(N&&N.not?"_"+F.FN.NOT:"");L=F.BRANCH_FNS[L];}return'<span class="mstrmojo-text mstrmojo-andor">'+L+"</span>";},getPrefixAndOrToolsMarkup:function(){return('<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5896,"Ungroup Conditions")+"</span>");},premousedown:function J(K){var L=mstrmojo.dom.eventTarget(K.hWin,K.e);if(this.prefixHoverNode&&mstrmojo.dom.contains(this.prefixHoverNode,L,false)){mstrmojo.dom.stopPropogation(K.hWin,K.e);return ;}if(this._super){this._super(K);}},isSelectableArea:function E(K){return true;},childIndex:function I(){var M=this.parent,K=M&&M.data,L=K&&K.nds,N=this.data;if(L&&N){return G.indexOf(L,N);}return -1;},toggleGroupBorder:function C(K){H.toggleClass(this.parent.itemsContainerNode.childNodes[this.childIndex()-1].firstChild,"upgroup",K);H.toggleClass(this.domNode,"downgroup",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var E=mstrmojo.dom,Q=mstrmojo.css,B=mstrmojo.string,I="selected",L="hidden";function P(W,X,Y,V,a){var Z=a.listHooks[W];if(Z&&Z.call(a,X,Y,V)){return ;}Q.toggleClass(X,I,W==="select");}function G(Y,X,W){var Z=this[Y],V=Z?Z.split(X):[];this[Y]=mstrmojo.array.distinct(V.concat(W.split(X))).join(X);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function N(V){this._super(V);this._shiftStartIndex=-1;},getItemMarkup:function D(W,V){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function M(V){return V.n||"";},getItemProps:function R(Z,V){var W=!!this.selectedIndices[V],a={tag:"div",sel:W,cls:"",n:this.getItemDisplayName(Z),style:"",idx:V,addCls:function X(c){G.call(this,"cls"," ",c);},addStyle:function Y(c){G.call(this,"style",";",c);},title:Z.title||""};if(a.n&&B.isEmpty(a.n)){a.n=B.decodeHtmlString("<br/>");}if(W){a.addCls(I);}var b=Z.cls;if(b){a.addCls(b);}if(Z.hid){a.addCls(L);}return a;},itemRenderer:{render:function S(W,V,X){W._renderIdx=V;return mstrmojo.string.apply(X.getItemMarkup(W,V),X.getItemProps(W,V));},select:function K(W,X,V,Y){P("select",W,X,V,Y);},unselect:function H(W,X,V,Y){P("unselect",W,X,V,Y);}},onclick:function U(V){try{var X=this.getItemFromTarget(V.getTarget());if(X){V.cancel();this.doItemSelect(X,V||{});}}catch(W){mstrApp.onerror(W);}},doItemSelect:function C(l,k){var c=k.hWin,d=k.e,h=l._renderIdx,f=l._positionIdx,W=E.isMetaKey(c,d),b=E.shiftKey(c,d),X=this.multiSelect,a=this.useListModKeys,j=this._shiftStartIndex,Y=this.selectedIndices;if(X&&a&&b&&j>-1){var V=[],Z=[];this.processContinuousSelection(V,Z,h);this.addSelect(V);this.removeSelect(Z);}else{if(X&&(!a||W)){var g=(Y[h])?"remove":"add";this[g+"Select"](h,false,f);}else{this.singleSelect(h,false,f);}this._shiftStartIndex=h;}},processContinuousSelection:function J(X,W,V){var c=this._shiftStartIndex,b=this.selectedIndices,a=Math.min(c,V),Z=Math.max(c,V),Y;for(Y=0;Y<this.items.length;Y++){if(a<=Y&&Y<=Z){if(!b[Y]){X.push(Y);}}else{if(b[Y]){W.push(Y);}}}},onclearSelection:function A(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function F(W){var V=E.findAncestorByAttr(W,"idx",true,this.domNode);return(V&&V.node)||null;},getItemFromTarget:function O(X){var W=this.getItemNodeFromTarget(X),V=W&&parseInt(W.getAttribute("idx"),10);if(V!==null&&!isNaN(V)&&this.items){return this.items[V];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=I;mstrmojo._IsList.HIDDEN_CLS=L;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.fx");var e=mstrmojo.css,J=mstrmojo.dom,R=mstrmojo.array,N={v:{styleDim:"height",styleDir:"top",dimension:"h",position:"y",scroll:"scrollTop",scrollDimension:"scrollHeight",cls:"vertical",hostCls:"hasVertical",scrollNodeCls:"hasVertical"},h:{styleDim:"width",styleDir:"left",dimension:"w",position:"x",scroll:"scrollLeft",scrollDimension:"scrollWidth",cls:"horizontal",hostCls:"hasHorizontal",scrollNodeCls:"hasHorizontal"}},c="scrollingMode",V="scrolling",h=3;var O=J.getOSInfo().name.toLowerCase().indexOf("mac")>=0;function M(){return(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));}function W(n,k){var m=this.scrollNode,j=M.call(this),l={v:n,h:k};R.forEach(["v","h"],function(p){var o=N[p];e.toggleClass(j,o.hostCls,l[p]);e.toggleClass(m,o.scrollNodeCls,l[p]);});}function S(k,j){var p=J.eventTarget(j,k),n=this.scrollNode,m=J.position(n),o=this.scrollTrackNodes,l=this.scrollBarNodes,q=function q(AC){var AA=p===o[AC];if(AA){var AD=N[AC],t=l[AC],AE=J.position(t),w=J.getMousePosition(k,j)[AD.position],x=w-AE[AD.position],u=x>0?1:-1,AB=n[AD.scrollDimension],AF=Math.abs(x-(AE.h/2))*(AB/m[AD.dimension]),z={};z[AD.scroll]={isStyle:false,start:n[AD.scroll],stop:n[AD.scroll]+(u*Math.min(AB/3,500,AF)),ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:z,duration:200,interval:10,target:n})).play();}};q.call(this,"h");q.call(this,"v");}function C(k,j){var n=this.scrollNode,m=k.type==="mousewheel",l=m?-1:1;mstrmojo.array.forEach(["h","v"],function(x){var u=N[x],p=m?"wheelDelta":"delta",t=k[p+{h:"X",v:"Y"}[x]]*l,q=Math.abs(t),o=t/q,w=q===3&&J.isFF&&!O;n[u.scroll]+=w?o*40:t;});J.stopPropogation(j,k);J.preventDefault(j,k);}function g(o){var n=N[o],m=this.scrollNode,l=J.position(m),k=l[n.dimension],p=m[n.scrollDimension],j=Math.ceil(k)/p;return A(j,k,p);}function A(k,j,l){return(!isNaN(k)&&k<1)&&(Math.abs(j-l)>h);}function D(AL){var AE="px",w=N[AL],n=this.scrollNode,x=M.call(this),AN=J.position(n),z=AN[w.dimension],AG=n[w.scrollDimension],m=Math.ceil(z)/AG,AK=this.scrollBarNodes,t=AK[AL],AC=this.scrollTrackNodes,AD=AC[AL],AI=A(m,z,AG),o=w.cls;if(!t){AD=AC[AL]=document.createElement("div");var p=this,AB=function(AP){S.call(p,AP);},u=function(AP){C.call(p,AP);},AH=function(AR,AP,AQ){J.attachEvent(AR,AP,AQ);p.installedEventListeners.push({e:AR,evt:AP,fn:AQ});};AH(AD,"click",AB);AD.className="mstrmojo-scrolltrack "+o;t=AK[AL]=document.createElement("div");t.className="mstrmojo-scrollbar "+o;AD.appendChild(t);x.appendChild(AD);var AJ=mstrApp.isSingleTier?"mousewheel":"wheel";AH(AD,AJ,u);AH(t,AJ,u);}var AO=t.style,q=(n[w.scroll]/n[w.scrollDimension]),k=J.delta(n,M.call(this))[w.position],AF=AD.style;if(AI){AF[w.styleDir]=k+AE;var l=m*z,AA=35,AM=z*q,j=z-35;AO[w.styleDim]=(l<AA?AA:l)+AE;AO[w.styleDir]=(AM>j?j:AM)+AE;}return AI;}function I(){return !(mstrApp.isSingleTier&&O);}mstrmojo.ui._HasScroller=mstrmojo.provide("mstrmojo.ui._HasScroller",{_mixinName:"mstrmojo.ui._HasScroller",hasCustomScrollbar:null,draggable:true,ownAvatar:true,scrollNode:undefined,scrollbarHostNode:undefined,scrollBarNodes:undefined,setupScrollNodes:mstrmojo.emptyFn,installedEventListeners:null,init:function Y(j){this._super(j);if(this.hasCustomScrollbar===null){this.hasCustomScrollbar=I();}this.installedEventListeners=[];},onRender:function L(){if(this._super){this._super();}this.updateScrollbars();this.addScrollNodeProperties();},addScrollNodeProperties:function G(){var k=this.scrollNode,l=J.isFF&&!O;if(k){var j=J.attachMarkupEvent(this.id,k,"scroll");this.installedEventListeners.push({e:k,evt:"scroll",fn:j});}if(l){e.addClass(k,"firefox-on-windows");}else{if(J.isEdge){e.addClass(k,"ms-edge");}}if(!this.hasCustomScrollbar){e.addClass(M.call(this),"mstrmojo-sb-host-show-default");e.addClass(k,"mstrmojo-sb-show-default");return ;}if(k){e.addClass(M.call(this),"mstrmojo-scrollbar-host");e.addClass(k,"mstrmojo-scrollNode");}},updateScrollbars:function f(){if(!this.hasRendered){return ;}this.setupScrollNodes();var j,l=false;if(!this.hasCustomScrollbar){if(this.scrollNode){j=this.scrollNode.style;j.overflowY=g.call(this,"v")?"scroll":"hidden";j.overflowX=g.call(this,"h")?"scroll":"hidden";}return ;}if(this.scrollNode){this.scrollBarNodes=this.scrollBarNodes||{};this.scrollTrackNodes=this.scrollTrackNodes||{};W.call(this,l,l);j=this.scrollNode.style;var m=D.call(this,"v"),k=D.call(this,"h");j.overflowY=m?"scroll":"hidden";j.overflowX=k?"scroll":"hidden";W.call(this,m,k);}},onscroll:function b(){var q=this.scrollNode;if(q&&this.hasCustomScrollbar){var n=function n(t){var u=parseInt(t);return u===null||isNaN(u)?0:u;},o=J.position(q),p=o.h-n(e.getStyleValue(q,"padding-bottom")),k=o.w-n(e.getStyleValue(q,"padding-right")),m=this.scrollBarNodes,l=m.v,j=m.h;if(q.scrollHeight-p>0){l.style.top=((p-J.position(l).h)*(q.scrollTop/(q.scrollHeight-p)))+"px";}if(q.scrollWidth-k>0){j.style.left=((k-J.position(j).w)*(q.scrollLeft/(q.scrollWidth-k)))+"px";}}if(this._super){this._super();}if(this.onScrollEnd){this.onScrollEnd();}},getDragData:function F(k){var n=this.scrollNode,m=J.position(n),l=k.src.node,j=this.scrollBarNodes;if(this.isDraggingScrollBar(k)){return{isScrollBar:true,direction:l===j.v?"v":"h",scrollTop:n.scrollTop,scrollLeft:n.scrollLeft,conversionRatio:{y:n.scrollHeight/m.h,x:n.scrollWidth/m.w}};}return(this._super&&this._super(k));},isDragValid:function E(j){return this.isDraggingScrollBar(j)||(this._super&&this._super(j))||false;},isDraggingScrollBar:function X(k){var l=k.src.node,j=this.scrollBarNodes;return !!j&&(l===j.v||l===j.h);},ondragstart:function d(j){if(this.isDraggingScrollBar(j)){e.addClass(j.src.node,V);e.addClass(M.call(this),c);}if(this._super){this._super(j);}},shouldDragBubble:function U(j){var k=j.src.node,l=this.scrollTrackNodes;return !(!!l&&(k===l.v||k===l.h));},ondragmove:function Q(k){if(this.isDraggingScrollBar(k)){var u=k.tgt,j=k.src,w=u.pos,l=j.pos,p=j.node,o=this.scrollNode,t=this.scrollBarNodes,q=j.data,n={y:(w.y-l.y),x:(w.x-l.x)},m=q.conversionRatio;if(p===t.v){o.scrollTop=q.scrollTop+(n.y*m.y);}else{o.scrollLeft=q.scrollLeft+(n.x*m.x);}}if(this._super){this._super(k);}},ondragend:function K(j){if(this.isDraggingScrollBar&&this.isDraggingScrollBar(j)){e.toggleClass(j.src.node,V,false);e.toggleClass(M.call(this),c,false);}if(this._super){this._super(j);}},widgetResized:function P(){if(this._super){this._super();}this.updateScrollbars();},unrender:function Z(j){R.forEach(this.installedEventListeners,function(k){J.detachEvent(k.e,k.evt,k.fn);});this.installedEventListeners=[];delete this.scrollNode;delete this.scrollbarHostNode;delete this.scrollBarNodes;delete this.scrollTrackNodes;this._super(j);},getDefaultScrollBarProps:function a(j){return N[j];},disableScroll:function B(j,m){var l=this.scrollNode,k=M.call(this);R.forEach(["v","h"],function(o){var n=N[o];e.toggleClass(k,n.hostCls,false);e.toggleClass(l,n.scrollNodeCls,false);});if(l){if(m||m===undefined){l.style.overflowY="hidden";}else{if(l.style.overflowY==="hidden"){l.style.overflowY="auto";}}if(j||j===undefined){l.style.overflowX="hidden";}}},enableScroll:function H(){this.updateScrollbars();if(!this.hasCustomScrollbar&&this.scrollNode){this.scrollNode.style.overflowY=g.call(this,"v")?"scroll":"hidden";}},scrollIntoViewIfNeeded:function(m){var t=this.scrollNode,o=m.clientHeight,n=t.clientHeight,k=J.position(m).y,p=J.position(t).y,l=k-p,j=l<0,q=l+o>n;if(j||q){t.scrollTop+=l+o/2-n/2;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._HasMarkup");var J=mstrmojo.dom,D=mstrmojo._HasMarkup,P,Q=mstrmojo.global.document,K,A="touchstart",C="touchmove",I="touchend",N="contextmenu";function O(S){var R=J.findWidget(S);while(R){if(R.hasContextMenuEvent){return R;}R=R.parent;}return null;}function M(R){var U=R.src,S=O(U&&U.node);if(!S){return null;}return S;}H:function H(R){if(R&&R.touches.length===1){P.startTapHoldCheck(self,R);}}B:function B(){var R=++P.ctxt.moveCount;if(R>P.minMoves){P.stopTapHoldCheck();if(K){window.clearTimeout(K);}}}L:function L(){P.stopTapHoldCheck();if(K){window.clearTimeout(K);}}mstrmojo.taphold=mstrmojo.taphold||mstrmojo.provide("mstrmojo.taphold",{timeThreshold:750,minMoves:3,startTapHoldCheck:function G(R,S){delete this.ctxt;var U=J.captureEventInfo({hWin:R,e:S});this.ctxt={src:U,moveCount:0};J.attachEvent(Q,C,B);J.attachEvent(Q,I,L);S.name=N;K=window.setTimeout(function(){P.stopTapHoldCheck();var V=D.newDomEvent(N,window,S),W;for(W in S){if(!V[W]){V[W]=S[W];}}V.type=N;P.triggerContextMenu(V);},this.timeThreshold);},triggerContextMenu:function F(R){var S=this.ctxt,U=M(S);if(!U){return ;}if(U.raiseEvent){U.raiseEvent(R);}},stopTapHoldCheck:function E(){J.detachEvent(Q,C,B);J.detachEvent(Q,I,L);},enable:function(){if(J.isIOSTouch){J.attachEvent(Q,A,H);}},disable:function(){J.detachEvent(Q,A,H);}});P=mstrmojo.taphold;P.enable();}());(function(){var D={};var B="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function A(I,G,F){var E=mstrmojo.all[I],H=D[G]=new mstrmojo.SimpleXHR();$MAPF(true,B,"transportRequest");if(F.params&&!F.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){F.params.sessionState=mstrApp.sessionState;}H.request(F.config.method||"POST",F.taskURL||mstrConfig.taskURL,{success:function(J){if(typeof J==="string"&&J[0]==="{"){try{J=JSON.parse(J);}catch(K){}}if(J.mstrerr){J.code=J.mstrerr.code;J.message=J.mstrerr.message;}E&&E.response(G,true,J);},failure:function(L){var M=L.status,K=L.getResponseHeader("X-MSTR-TaskErrorCode"),J;if(M===0){M=K||M;J=mstrmojo.desc(15666,"The connection to the MicroStrategy Web Server failed. Please wait a few minutes and then attempt to reload the page. If the condition persists, please contact your administrator.");}else{M=K||M||"-999";J=L.getResponseHeader("X-MSTR-TaskFailureMsg")||L.responseText||"Unexpected error, please contact your administrator";}E&&E.response(G,false,{code:M,message:J});},complete:function(){delete D[G];},textResponse:F.callback.textResponse},F.params);},cancelRequest:function C(F){var G=D[F],E=false;if(G){E=G.cancel();delete D[F];}$MAPF(false,B,"transportRequest");return E;}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.QueuedXHR");var F=mstrmojo.hash;function J(K,L){return function(){if(K[L]){K[L]();}};}var B=[];function H(L){var K;switch(L.cacheLevel){case mstrmojo.AjaxCall.CACHELEVEL_LOCAL:if(L._cache==null){L._cache=[];}K=L._cache;break;default:if(B==null){B=[];}K=B;break;}return K;}function E(N){var M=H(N);var P={cache:M,idx:-1},O=N.params;if("xts" in O){delete O.xts;}for(var L=0,K=M.length;L<K;L++){var Q=M[L];if(Q&&F.equals(Q.url,N.url)&&F.equals(Q.params,O)){P.idx=L;break;}}return P;}function C(L){var K=H(L),M=F.copy(L.params);delete M.xts;K.push({url:L.url,params:M,res:F.copy(L.response)});}function D(K){var L=E(K);if(L&&L.idx>=0){K.response=L.cache[L.idx].res;return true;}return false;}mstrmojo.AjaxCall=mstrmojo.declare(mstrmojo.QueuedXHR,null,{scriptClass:"mstrmojo.AjaxCall",method:"POST",url:"",params:null,onsuccess:null,onerr:null,oncomplete:null,oncancel:null,readCache:false,writeCache:false,cacheLevel:"",_cache:null,useQueue:false,init:function I(K){this._super(K);F.copy(K,this);},send:function A(){var K=this;if(this.readCache&&D(this)){this.onsuccess();return ;}this.request(this.method,this.url,{success:function(L){K.response=L;if(K.writeCache){C(K);}if(K&&K.onsuccess){K.onsuccess();}},failure:J(K,"onerr"),complete:J(K,"oncomplete")},this.params,!this.useQueue);},cancel:function G(){this._super();if(this.oncancel){this.oncancel();}}});mstrmojo.AjaxCall.CACHELEVEL_GLOBAL="global";mstrmojo.AjaxCall.CACHELEVEL_LOCAL="local";})();(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var H=mstrmojo.validation,B=H.TRIGGER,c=H.STATUSCODE,A={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};H.VALIDATOR={DEMO:function N(f){var e=parseInt(f,10),g=mstrmojo.validation.STATUSCODE;if(e===0||e===1||e>10){return{code:g.VALID};}return{code:g.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function I(e){var f=String(e).replace(/[^\d]/g,"");if(f.length<10){return{code:c.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!H.REGEXP.PHONE_NUMBER.test(e)){return{code:c.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:c.VALID};},VALIDATE_ZIPCODE:function G(e){var g="",f=this.dtp;if(!H.REGEXP.US_ZIP.test(e)){if(H.isNumeric(f)||H.isInt(f)){g=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if(H.isString(f)){g=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:c.INVALID,msg:g};}return{code:c.VALID};},VALIDATE_EMAIL:function U(e){var f=e.indexOf("@");if(f===-1){return{code:c.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(e.substring(f).indexOf(".")===-1){return{code:c.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return H.REGEXP.EMAIL_ADDRESS.test(e)?{code:c.VALID}:{code:c.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function Q(e){var g=this.dtp,f;if(H.isNumeric(g)||H.isInt(g)){f=String(e).replace(/[^\d]/g,"");if(f.length!==9){return{code:c.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!H.REGEXP.SOCIAL_SECURITY_NUMBER.test(e)){return{code:c.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:c.VALID};}};H.isInt=function D(e){return A[e]===1;};H.isNumeric=function Z(e){return A[e]===2||A[e]===5;};H.isString=function J(e){return A[e]===3;};var C=window.mstrConfig,L=C.listSep,S=mstrmojo.expr,M=S.DTP,a=mstrmojo.num,V=mstrmojo.string,F=mstrmojo.date;function P(m,n){var j=m.dtp,l=m.constraints,p=l.allowedFormatChars||"",h=(A[j]===1),e=H.isNumeric(j),f=(A[j]===6),o=mstrmojo.locales.number.THOUSANDSEPARATOR,g=mstrmojo.locales.number.DECIMALSEPARATOR,k;if(h){if(!m._intRegExp){p+="0-9-"+(m.isList?L:"")+o;m._intRegExp=new RegExp("[^"+p+"]");}k=m._intRegExp;}if(e){if(!m._numericRegExp){p+="0-9-#"+(m.isList?L:"")+g+o;m._numericRegExp=new RegExp("[^"+p+"]");}k=m._numericRegExp;}return !!k&&k.test(n);}function d(m,o){var j=m.dtp,l=m.constraints,h=(A[j]===1),e=H.isNumeric(j),f=(A[j]===6),g=l.min,n=l.max,k;if(g===undefined&&n===undefined){return false;}if(h||e){if(a.isBigDecimal(o)){return a.inNumericRange(a.parseBigDecimal(o),g,n)!==0;}return a.inNumericRange(o,g,n)!==0;}if(f){return F.inDateTimeRange(o,g,n)!==0;}return false;}function K(f,e){return !a.isNumeric(e)&&!a.isBigDecimal(e);}function R(h,f){var g=(h.dtp===M.DATE),e=(h.dtp===M.TIME);return(g?!F.isDate(f):(e?!F.isTime(f):!F.isDateAndOrTime(f)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:M.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function X(e){this._super(e);if(!this.constraints){this.constraints={};}var f=this.constraints;if(!f.hasOwnProperty("trigger")){f.trigger=B.NONE;}},_set_value:function(k,g){var h=this.value,f=(h!==g);if(f){this.value=g;var j=this.constraints.trigger,e=(j&B.VALUESET)>0;if(e){this.validate(g);}}return f;},validate:function O(){var g=(this.value!==null&&this.value!==undefined)?this.value:"",k=this.isList?g.split(L):[g],j,f,l,e=k.length,h;for(h=0;h<e;h++){j=this.doValidation(k[h]);f=(j.code>c.VALID);if(f){if(e>1){j.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",k[h]||" ");}break;}}l=f?"onInvalid":"onValid";if(!f&&this.autoFormat){this.format();}this.set("validationStatus",j);if(this[l]){this[l](j);}},format:function Y(){var k=this.dtp,g=(A[k]===6);if(!g){return ;}var m=mstrConfig.listSep,p=this.value||"",f=this.isList?p.split(m):[p],o=k===14,n=[],e,h=mstrmojo.locales.datetime,l=f.length,j;for(j=0;j<l;j++){p=f[j];e=F.parseDateAndOrTime(p);if(e){if(o&&e.date){n.push(F.formatDateInfo(e.date,h.DATEOUTPUTFORMAT));}else{n.push((e.date?F.formatDateInfo(e.date,h.DATEOUTPUTFORMAT):"")+" "+(e.time?F.formatTimeInfo(e.time,h.TIMEOUTPUTFORMAT):""));}}}this.set("value",n.join(m));},isValid:function W(){var e=this.validationStatus;if(!e){this.validate();}return this.validationStatus.code===c.VALID;},clearValidation:function b(){this.set("validationStatus",{code:c.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function E(t){var o=this.constraints,p=o.regExp,g=o.validator,e={id:this.id,code:c.VALID,msg:""},n=this.dtp,m=(A[n]===1),f=H.isNumeric(n),h=(A[n]===3),j=(A[n]===6),l=V.isEmpty(t),q=String(t).length,k="",w=mstrmojo.locales.validation;if(this.required&&l){e.code=c.INVALID_EMPTY;e.msg=w.requiredFieldError;return e;}t=V.trim(t);if(!l&&P(this,t)){if(m){k=w.integerDataType;}if(f){k=w.numericDataType;}if(j){k=w.dateDataType;}e.code=c.INVALID_CHAR;e.msg=w.invalidCharError.replace("#",k);return e;}if(!l&&j&&R(this,t)){e.code=c.INVALID_BAD_DATESTRING;e.msg=w.invalidDateStringError;return e;}if(!l&&(f||m)&&K(this,t)){e.code=c.INVALID_BAD_NUMERICFORMAT;e.msg=w.invalidNumericFormatError;return e;}if(!l&&(m||f||j)&&d(this,t)){e.code=c.INVALID_OUTOFRANGE;if(o.min!==null&&o.max!==null){k=w.outofRangeError.replace("# ","").replace("##",a.toLocaleString(o.min)).replace("###",a.toLocaleString(o.max));}else{if(o.min!==null){k=w.noLessMinError.replace("##",a.toLocaleString(o.min)).replace("# ","");}else{if(o.max!==null){k=w.noGreaterMaxError.replace("###",a.toLocaleString(o.max)).replace("# ","");}}}e.msg=k;return e;}if(h&&o.minLen!==null&&o.maxLen!==null){if(q<o.minLen||q>o.maxLen){e.code=c.INVALID;e.msg=mstrmojo.desc(9211).replace(/#/,o.minLen).replace(/##/,o.maxLen);return e;}}if(p&&!p.test(t)){e.code=c.INVALID_REGEX;e.msg=mstrmojo.desc(9205);return e;}var u=g&&g.apply(this,[t]);if(u){e.code=u.code;e.msg=u.msg;return e;}return e;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.elementHelper","mstrmojo.mstr.EnumNodeProperties","mstrmojo.EnumSelectionType");var k=mstrmojo.array,U=mstrmojo.hash,Q=mstrmojo.expr,f=mstrmojo.elementHelper,Z=Q.ET,E=Q.FN,m=Q.DTP,C=mstrmojo.mstr.EnumNodeProperties,c=mstrmojo.EnumSelectionType;var AG=0,F=1,M=2,K=3,d=4,w=5;var n=0,AH="u;",Y="LEVEL_NUMBER",X=false,J=7;function AF(AJ){return AJ.t===47&&AJ.st===12033;}function S(AJ,AK){if(AJ&&AK&&AK.t===J){return AJ.parent===AK&&AJ.lv===AK.lv;}return false;}function l(AJ){if(AJ&&AJ.t===J){return k.filter(AJ.children,function(AK){return AK.lv===AJ.lv;});}return[];}function AE(AJ){return !!AJ.not||AJ.fn===E.NOT_IN_LIST||AJ.fn===E.NOT_EQUAL;}function AB(AJ){return U.copyProps(["did","n","t","st"],AJ);}function P(AM,AJ){var AL=AF(AJ),AN=AL?AM.v:f.terseLong2OldShort(AM.v),AK={v:AN.replace(/\\:/g,"*:"),n:AM.n};if(AL){AK.t=AM.t;AK.conid=AJ.did;}return AK;}function R(AM,AK){if(parseInt(AM,10)>=0){var AL=AK.lvfs||[],AJ=AL[AM]&&AL[AM].lvfn||"";return{v:AJ?AM+";"+AJ:AM,dtp:AJ?m.CHAR:m.INTEGER};}return null;}function AA(AM,AO,AL){var AJ=f.getIdPresentation(AM),AK=AF(AL);AM=AM.replace(/\*:/g,"\\:");switch(AO){case"old":case"oldLong":switch(AJ){case"old":case"oldLong":return AM;case"terse":case"terseLong":switch(AM[0]){case"V":return AM.substring(1).split(";")[0];case"n":return"HF:"+ +f.terseLong2OldShort(AM)+":47";default:return f.terseLong2OldShort(AM);}}break;case"terse":case"terseLong":switch(AJ){case"old":return AK?("V"+AM+";"+AL.did):f.oldShort2terseLong(AM,"h");case"oldLong":switch(AM.substring(0,2)){case"HF":var AN=AM.substr(3).split(":");if(AN.length>3){AN.pop();}return f.oldShort2terseLong(AN.join(":"),"n");default:return AM;}case"terse":case"terseLong":return AM;}break;default:return AM;}}function u(AJ){if(isNaN(AJ)&&typeof AJ==="string"){return parseInt(AJ.split(";")[0],10);}return parseInt(AJ,10);}function o(AJ){return !AJ||AJ.lv>0&&!AJ.parent;}function a(AJ,AR,AQ){var AO=AQ.item,AL=AQ.ancestorMap,AP=AQ.descendantMap,AK=this.getItemByValue(AJ.itemValue),AN=this.getItemByValue(AR.itemValue),AM=function(AS,AT){if(AO&&AO===AS&&AP){return AP[AT.v];}if(AO&&AO===AT&&AL){return AL[AS.v];}while(AT){if(AS===AT){return true;}AT=AT.parent;}return false;};switch(AJ.func){case c.ALL:return AR.func===c.ALL?AG:K;case c.ELEMENT:switch(AR.func){case c.ALL:return M;case c.ELEMENT:return AK===AN?AG:S(AK,AN)?M:S(AN,AK)?K:w;case c.BRANCH:return AM(AN,AK)?M:S(AN,AK)?d:o(AK)?F:w;case c.LEVEL:return AK.lv===AR.level?M:w;case c.BRANCH_LEVEL:return AK.lv!==AR.level?w:o(AK)?F:AM(AN,AK)?M:w;}break;case c.BRANCH:switch(AR.func){case c.ALL:return M;case c.ELEMENT:return AM(AK,AN)?K:S(AK,AN)?d:o(AN)?F:w;case c.BRANCH:return AK===AN?AG:(o(AK)||o(AN))?F:AM(AN,AK)?M:AM(AK,AN)?K:w;case c.LEVEL:return AK.lv<=AR.level?d:w;case c.BRANCH_LEVEL:return AK===AN?K:(o(AK)||o(AN))?F:AM(AK,AN)?K:(AM(AN,AK)&&AR.level>=AK.lv)?d:w;}break;case c.LEVEL:switch(AR.func){case c.ALL:return M;case c.ELEMENT:return AN.lv===AJ.level?K:w;case c.BRANCH:return AN.lv<=AJ.level?d:w;case c.LEVEL:return AJ.level===AR.level?AG:w;case c.BRANCH_LEVEL:return AJ.level===AR.level?K:w;}break;case c.BRANCH_LEVEL:switch(AR.func){case c.ALL:return M;case c.ELEMENT:return AN.lv!==AJ.level?w:o(AN)?F:AM(AK,AN)?K:w;case c.BRANCH:return AK===AN?M:(o(AK)||o(AN))?F:AM(AN,AK)?M:(AM(AK,AN)&&AJ.level>=AN.lv)?d:w;case c.LEVEL:return AJ.level===AR.level?M:w;case c.BRANCH_LEVEL:return AJ.level!==AR.level?w:AK===AN?AG:(o(AK)||o(AN))?F:AM(AN,AK)?M:AM(AK,AN)?K:w;}break;}return F;}function D(AK,AO,AL,AP,AJ){var AN=(AK.fs||[]).filter(function(AQ){return(AQ.n||AQ.fnm)===Y;})[0],AM=k.ensureArray(AL).map(function(AQ){return P(AQ,AK);});switch(AO){case c.ELEMENT:if(AM.length>0){return{et:Z.AE,fn:AJ?E.NOT_IN_LIST:E.IN_LIST,a:AB(AK),es:AM};}break;case c.BRANCH:if(AM.length>0){return{et:Z.AE,fn:E.DESCENDANT,not:AJ,a:AB(AK),es:AM};}break;case c.LEVEL:if(AN&&parseInt(AP,10)>=0){return{et:Z.AQ,fn:E.EQUAL,not:AJ,a:AB(AK),fm:{did:AN.did||AN.fid,n:Y,dtp:Q.mapBaseFormTypeToDataType(AN.bftp)},cs:[R(AP,AK)]};}break;case c.BRANCH_LEVEL:if(AM.length>0&&parseInt(AP,10)>=0){return{et:Z.AE,fn:E.DESCENDANT,not:AJ,a:AB(AK),es:AM,cs:[R(AP,AK),{v:18,dtp:m.INTEGER}]};}break;}return null;}function B(){var AJ={};this.selectionList.forEach(function(AL,AK){if(AL.func===c.ELEMENT){AJ[AL.itemValue]=AK;var AM=this.getItemByValue(AL.itemValue);k.forEach(l(AM),function(AN){AJ[AN.v]=AK;});}},this);return AJ;}function x(){var AJ={};this.selectionList.forEach(function(AL,AK){if(AL.func===c.BRANCH){AJ[AL.itemValue]=AK;}});return AJ;}function A(){var AJ={};this.selectionList.forEach(function(AL,AK){if(AL.func===c.LEVEL){AJ[AL.level]=AK;}});return AJ;}function j(){var AJ={};this.selectionList.forEach(function(AM,AK){if(AM.func===c.BRANCH_LEVEL){var AN=AM.itemValue,AO=AM.level,AL=AJ[AN];if(!AL){AL=AJ[AN]={};}AL[AO]=AK;}});return AJ;}function W(AL){var AK=x.call(this),AJ=n;while(AL&&AL.v){AJ=Math.max(AJ,AK[AL.v]||n);AL=AL.parent;}return AJ;}function q(AL,AN){var AJ=j.call(this),AM=A.call(this),AK=AN?n:W.call(this,AL),AP=AL&&AL.lv||0,AO={};if(!AN){U.forEach(AM,function(AR,AQ){if(AQ>=AP&&AR>AK){AO[AQ]=AR;}});}while(AL&&AL.v){U.forEach(AJ[AL.v],function(AR,AQ){if(AQ>=AP&&AR>AK){AO[AQ]=Math.max(AR,AO[AQ]||AK);}});AL=AL.parent;}return AO;}mstrmojo.ui._HierarchyListSelection=mstrmojo.provide("mstrmojo.ui._HierarchyListSelection",{_mixinName:"mstrmojo.ui._HierarchyListSelection",init:function z(AJ){this._super(AJ);this.clearSelections();},getAllSelection:function I(){return !this.selectionList[n].isNot;},setAllSelection:function g(AJ){this.selectionList[n].isNot=!AJ;},clearSelections:function h(){this.selectionList=[{func:c.ALL,isNot:!X}];return this.selectionList;},addSelection:function V(AJ){var AN=this.selectionList,AL=this.getItemByValue(AJ.itemValue),AK={item:AL,ancestorMap:AL&&this.getItemAncestorMap(AL),descendantMap:AL&&this.getItemDescendantMap(AL)},AM=true;if(!AL&&(AJ.func===c.ELEMENT||AJ.func===c.BRANCH||AJ.func===c.BRANCH_LEVEL)){return ;}AN=this.selectionList=AN.filter(function(AO){var AQ=a.call(this,AO,AJ,AK),AP=AO.isNot===AJ.isNot;if(AQ===K||AQ===d&&!AP){AM=!AP;}return !(AQ===AG||AQ===M);},this);if(AM){AN.push(AJ);}},updateSiblingItemSelection:function p(AK){var AM=this.selectionList,AJ=B.call(this),AL=x.call(this);k.forEach(AK,function(AR){var AO=AR.parent,AN=AO?W.call(this,AO):n,AP=AO?q.call(this,AO):A.call(this),AQ=Math.max(AL[AR.v]||n,AN),AS=Math.max(AJ[AR.v]||n,AQ,AP[AR.lv]||n);AR.isSelected=!AM[AS].isNot;AR.isBranchSelected=!AM[AQ].isNot;},this);},updateItemSelection:function N(AK){var AS=this.selectionList,AL=B.call(this),AT=x.call(this),AO=A.call(this),AP=j.call(this),AM=AK?[AK]:this.getRootItems(),AN=AK?[]:this.getItems().filter(function(AU){return AU&&o(AU);}),AJ=AK?W.call(this,AK):n,AR=AK?q.call(this,AK,true):{};(AM.concat(AN)).forEach(function AQ(AY){var AW=AJ,AV=U.copy(AR);AJ=Math.max(AJ,AT[AY.v]||n);U.forEach(AP[AY.v],function(Ab,Aa){AR[Aa]=Math.max(Ab,AR[Aa]||n);});var AZ=Math.max(AL[AY.v]||n,AO[AY.lv]||n,AJ,AR[AY.lv]||n);AY.isSelected=!AS[AZ].isNot;AY.isBranchSelected=!AS[AJ].isNot;k.forEach(AY.children,function(Aa){AQ.call(this,Aa);},this);var AX=l(AY);if(AX.length>0){var AU=k.find(AX,"isSelected",true)>=0;if(AY.isSelected!==AU){this.addSelection({func:c.ELEMENT,itemValue:AY.v,isNot:!AU});AY.isSelected=AU;}}AJ=AW;AR=AV;},this);},updateDescendantsStatus:function AI(){var AO=this.selectionList,AJ=this.getMaxLevel(),AM=x.call(this),AK=j.call(this),AL=n,AP=A.call(this);this.getRootItems().forEach(function AN(AZ){var AR=AZ.children||[],AV=AZ.displayChildren||[],AX=AL,AY=U.copy(AP),AS=false;AL=Math.max(AL,AM[AZ.v]||n);U.forEach(AK[AZ.v],function(Ab,Aa){AP[Aa]=Math.max(Ab,AP[Aa]||n);});AR.forEach(function(Aa){if(AN(Aa)||!Aa.hid&&Aa.isSelected){AS=true;}});if(AZ.hcd&&AV.length===0){var AT=!AO[AL].isNot,AW,AQ;for(var AU=AZ.lv+1;AU<=AJ;AU++){AW=AP[AU]||n;AQ=AW>AL&&!AO[AW].isNot;if(AQ||AT&&AW<=AL){AS=true;break;}}}AZ.hasDsctSelected=AS;AL=AX;AP=AY;return AS;});},getMaxLevel:function b(){var AJ=0;this.getItems().forEach(function(AK){var AL=AK.lv;if(AL>AJ&&!AK.hid){AJ=AL;}});this.selectionList.forEach(function(AK){if(AK.func===c.LEVEL||AK.func===c.BRANCH_LEVEL){AJ=Math.max(AJ,AK.level);}});return AJ;},getLevelSelection:function G(AJ){var AN=this.selectionList,AL=AJ?q.call(this,AJ):A.call(this),AK=AJ?AJ.isBranchSelected:this.getAllSelection(),AM={};U.forEach(AL,function(AQ,AP){var AO=!AN[AQ].isNot;if(AO!==AK){AM[AP]=AO;}});return U.copy({allLevel:AK,isLevelSelected:function(AO){return this[AO]||this.allLevel&&this[AO]!==false;}},AM);},buildSelectionExprJSON:function e(AL){var AN=this.getAllSelection(),AK=[],AO=null,AM={selected:[],unselected:[]},AJ=function(AP,AQ){if(!U.isEmpty(AQ)&&(AP.length>0||AN===AE(AQ))){AP.push(AQ);}};this.selectionList.forEach(function(AQ){var AS=AQ.func,AP=AQ.isNot,AU=AQ.level,AT=AQ.itemValue,AR=AT?this.getItemByValue(AT):null;if((AR||{}).fetcher){return ;}if(AQ.func===c.ELEMENT&&!o(AR)){AM[AP?"unselected":"selected"].push(AR);}else{if(AQ.func!==c.ALL){AJ(AK,D(AL,AS,AR,AU,AP));}}},this);AJ(AK,D(AL,c.ELEMENT,AM.selected));AJ(AK,D(AL,c.ELEMENT,AM.unselected,null,true));if(AK.length>0){AO=AK[0];AK.forEach(function(AS,AP,AR){var AQ=AE(AS);if(AP>0){if(AQ===AE(AR[AP-1])&&AO.nds){AO.nds.push(AS);}else{AO={et:Z.ANDOR,fn:AQ?E.AND:E.OR,nds:[AO,AS]};}}});}if(AO){if(AO.et===Z.ANDOR){AO.node=C.CONDITION;}else{AO={et:Z.ANDOR,fn:E.AND,nds:[AO],node:C.CONDITION};}}return AO;},setSelectionByExprJSON:function t(AL){var AM=this.clearSelections(),AK=false,AJ=this.getItems(),AO=f.getIdPresentation(AJ[0]&&AJ[0].v),AN=function(AQ,AR){if(U.isEmpty(AQ)){return ;}if(AQ.et===Z.ANDOR){(AQ.nds||[]).forEach(function(AS){AN.call(this,AS,AR);},this);}else{var AP=AE(AQ);if(!AK){AK=true;this.setAllSelection(AP);}if(AQ.et===Z.AQ&&AQ.fm&&AQ.fm.n===Y){(AQ.cs||[]).forEach(function(AT){var AS=u(AT.v);if(AS>=0){AR.push({func:c.LEVEL,level:AS,isNot:AP});}});}if(AQ.et===Z.AE){(AQ.es||[]).forEach(function(AS){var AT=AA(AS.v,AO,AQ.a),AU=u(AQ.cs&&AQ.cs[0].v);if(!this.getItemByValue(AT)){this.addItems([U.copy({v:AT,dhid:true},U.clone(AS))],true);}if(AQ.fn===E.DESCENDANT){if(AU>=0){AR.push({func:c.BRANCH_LEVEL,itemValue:AT,level:AU,isNot:AP});}else{AR.push({func:c.BRANCH,itemValue:AT,isNot:AP});}}else{AR.push({func:c.ELEMENT,itemValue:AT,isNot:AP});}},this);}}};AN.call(this,AL,AM);this.updateItemSelection();},setSelectionByList:function L(AK,AJ){var AL=[],AM=false;k.forEach(AK,function(AN){var AO=AN.v;if(AO===AH){AM=true;return false;}if(!this.getItemByValue(AO)){this.addItems([AN],true);}AL.push({func:c.ELEMENT,itemValue:AO,isNot:!AJ});},this);this.clearSelections();if(!AM){this.setAllSelection(!AJ);this.selectionList=this.selectionList.concat(AL);}this.updateItemSelection();},onSelectionChange:function O(AK,AJ,AL,AM){if(AK===c.ALL){this.clearSelections();this.setAllSelection(AJ);}else{this.addSelection({func:AK,itemValue:AL&&AL.v,level:AM,isNot:!AJ});}if(this.postSelectionChange){this.postSelectionChange();}},postAddItems:function H(AJ){this.updateItemSelection();},postAddSiblingItems:function AD(AK,AJ){this.updateSiblingItemSelection(AK);},postAddBranchItems:function AC(AK,AJ){this.updateItemSelection(AJ);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(308,5923,7930,5282,5283,2793,2787,2788,12298);var D=mstrmojo.string,S=mstrmojo.expr,M=S.ET,L=mstrmojo.array,R=mstrmojo.hash;var V=S.FN,K=S.BRANCH_FNS[V.NOT],Z=mstrmojo.mstr.EnumDSSXMLObjectTypes,H=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,N=mstrmojo.mstr.EnumDSSConsolidationType;function C(a){return D.htmlAngles(a)||"";}var A={betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),andText:mstrmojo.desc(5282,"AND"),orText:mstrmojo.desc(5283,"OR"),boldandText:"<span style='font-weight:bold;'>"+mstrmojo.desc(5282,"AND")+"</span>",boldorText:"<span style='font-weight:bold;'>"+mstrmojo.desc(5283,"OR")+"</span>",whereText:mstrmojo.desc(2793,"Where (##)"),notText:mstrmojo.desc(12298,"NOT")};var Y={"*":function(b,a){return{html:b?('<span class="mstrmojo-unknown">'+(C(b.n||b.xml)||"...")+"</span>"):null,text:b?(C(b.n||b.xml)||"..."):null};}};function W(a){return !!a.not||a.fn===V.NOT_EQUAL||a.fn===V.NOT_IN_LIST||a.fn===V.NOT_BETWEEN||a.fn===V.NOT;}function I(a){if(a&&a.not){return{html:'<span class="mstrmojo-text mstrmojo-not">'+K+"</span>",text:K+" "};}return{html:"",text:""};}function U(c,b){var a=c&&((b?'<span class="mstrmojo-ListIcon t'+b+'"></span>':"")+'<span class="mstrmojo-text mstrmojo-embedobj">'+C(c)+"</span>");return{html:a,text:c&&((b?b+" ":"")+C(c))};}function Q(a,c){var b=c&&c.trim().split(" ")||[];if(a.t===Z.Attribute&&a.st===H.AttributeRecursive){b.push("recursive");}else{if(a.t===Z.Consolidation&&a.st===H.ConsolidationManaged){b.push("derived");if(a.ndetype===N.DssRecursiveDerivedElement){b.push("recursive");}}}return b.join(" ");}function G(b,a){var c=C(b.n);return{html:'<span class="mstrmojo-text mstrmojo-attr '+Q(b,a)+'">'+c+"</span>",text:c};}Y[M.R]=function(b,a){return U(b.r&&b.r.n,b.r&&b.r.t);};Y[M.F]=function(b,a){return U(b.f&&b.f.n,b.f&&b.f.t);};Y[M.XML]=function(b,a){return U(b.n||b.p&&b.p.n||b.xml,b.p&&b.p.t);};Y[M.AE]=function(q,f){var n=[],m=[],c=(f&&f.elemsEmpty)||"("+mstrmojo.desc(2210,"Empty")+")";if(q&&q.a&&q.a.n){var b=G(q.a);n.push(b.html);m.push("{"+b.text+"}");var a=C(S.fnName(q.et,q.fn,q.fnt));n.push('<span class="mstrmojo-text mstrmojo-fn">'+a+"</span>");m.push(" "+a+" ");var t=q.es,g=t&&t.length||0;if(g){n.push('<span class="mstrmojo-elems">');m.push("[");var j=n.length,p="";for(var o=0;o<g;o++){n[j++]='<span class="mstrmojo-text mstrmojo-elem">';p=C(t[o].n);n[j++]=p;m.push(p);if(o<g-1){n[j++]=", ";m.push(", ");}n[j++]="</span>";}n[j++]="</span>";m.push("]");}else{n.push('<span class="mstrmojo-text mstrmojo-emptyelems">'+c+"</span>");m.push(c);}}return{html:n.join(""),text:m.join("")};};Y[M.AQ]=function(z,AB){var w=[],j=[];if(z&&z.a&&z.a.n){var e=G(z.a);w.push(e.html);j.push("{"+e.text+"}");if(z.fm&&z.fm.n){var AC=C(z.fm.n);w.push('<span class="mstrmojo-text mstrmojo-form">'+AC+"</span>");j.push("("+AC+")");if(z.fn!=null){var k=C(S.fnName(z.et,z.fn,z.fnt,z.fm.dtp));w.push('<span class="mstrmojo-text mstrmojo-fn">'+k+"</span>");j.push(" "+k+" ");var l=S.fnCstCount(z.fn,z.fnt);if(z.et===M.AC){if(l>=1){if(z.a2&&z.a2.n){var p=C(z.a2.n);w.push('<span class="mstrmojo-text mstrmojo-attr2">'+p+"</span>");j.push("{"+p+"}");if(z.fm2&&z.fm2.n){var x=C(z.fm2.n);w.push('<span class="mstrmojo-text mstrmojo-form2">'+x+"</span>");j.push("("+x+")");}}if(l>1){w.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");j.push(" "+A.betweenText+" ");if(z.a3&&z.a3.n){var b=C(z.a3.n);w.push('<span class="mstrmojo-text mstrmojo-attr3">'+b+"</span>");j.push("{"+b+"}");if(z.fm3&&z.fm3.n){var c=C(z.fm3.n);w.push('<span class="mstrmojo-text mstrmojo-form3">'+c+"</span>");j.push("("+c+")");}}}}}else{if(z.et===M.AL){var a=z.cs||[],f=[];for(var q=0,u=a.length;q<u;q++){f.push(a[q].v);}var n=f.join(mstrConfig.listSep);w.push('<span class="mstrmojo-text mstrmojo-c1">'+n+"</span>");j.push("["+n+"]");}else{if(l>=1){var a=z.cs,o=a&&a[0];var AA=C(o&&o.p&&o.p.n||o&&o.v);w.push('<span class="mstrmojo-text mstrmojo-c1">'+AA+"</span>");j.push(AA);if(l>1){var m=a&&a[1];w.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");j.push(" "+A.betweenText+" ");var g=C(m&&m.p&&m.p.n||m&&m.v);w.push('<span class="mstrmojo-text mstrmojo-c1">'+g+"</span>");j.push(g);}}}}}}}return{html:w.join(""),text:j.join("")};};Y[M.AC]=Y[M.AQ];Y[M.AL]=Y[M.AQ];Y[M.MQ]=function(AB,AC){var AA=[],n=[],t=AB&&AB.m,AE=t&&t.n;if(AE){var b=AB.fnt,g=S.FNT.PER,z=S.FNT.RANK;AE=b===g?mstrmojo.desc(2787,"Percentage of ##").replace("##",AE):b===z?mstrmojo.desc(2788,"Rank of ##").replace("##",AE):AE;AA.push('<span class="mstrmojo-text mstrmojo-metric">'+C(AE)+"</span>");n.push(C(AE));if(AB.fn!=null){var o=C(S.fnName(AB.et,AB.fn,b,S.DTP.REAL));AA.push('<span class="mstrmojo-text mstrmojo-fn">'+o+"</span>");n.push(" "+o+" ");var p=S.fnCstCount(AB.fn,b);if(AB.et==S.ET.MC){if(p>=1){var AD=(AB.m2&&AB.m2.n)||(AB.c2&&AB.c2.v)||"?";AA.push('<span class="mstrmojo-text mstrmojo-m2">'+C(AD)+"</span>");n.push(C(AD));if(p>1){AA.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");n.push(" "+A.betweenText+" ");var e=(AB.m3&&AB.m3.n)||(AB.c3&&AB.c3.v)||"?";AA.push('<span class="mstrmojo-text mstrmojo-m3">'+C(e)+"</span>");n.push(C(e));}}}else{if(p>=1){var c=AB.cs,w=c&&c[0];var a=function(h){var d=h.v;if(AB.fnt==g){if(d.replace){h.v=d.replace(/%$/,"");}d=h.v+"%";}return d;};var l=C(w&&w.p&&w.p.n||w&&w.v&&a(w));AA.push('<span class="mstrmojo-text mstrmojo-c1">'+l+"</span>");n.push(l);if(p>1){var q=c&&c[1],m=C(q&&q.p&&q.p.n||q&&q.v&&a(q));AA.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");n.push(" "+A.betweenText+" ");AA.push('<span class="mstrmojo-text mstrmojo-c2">'+m+"</span>");n.push(m);}}}var x=AB.dmy&&AB.dmy.uts,k=x&&x.length;if(k){AA.push('<span class="mstrmojo-text mstrmojo-at">'+A.atText+"</span>");n.push(" "+A.atText+" ");AA.push('<span class="mstrmojo-dmy">');for(var j=0;j<k;j++){var f=x[j];AA.push('<span class="mstrmojo-text mstrmojo-dmyunit">');AA.push(C(f.utgt?f.utgt.n:f.n));n.push(C(f.utgt?f.utgt.n:f.n));if(j<k-1){AA.push(",");n.push(",");}AA.push("</span>");}AA.push("</span>");}}}return{html:AA.join(""),text:n.join("")};};Y[M.MC]=Y[M.MQ];Y[M.ANDOR]=function(l,c){var j=[],g=[],b=(c&&c.elemsEmpty)||"("+mstrmojo.desc(2210,"Empty")+")",e=R.valarray(S.findTargets(l,"did"))[0],f=true;function m(d){if(!f){j.push('<span class="spliter"></span>');g.push(", ");}f=false;if(d){g.push(mstrmojo.desc(12298,"NOT")+" ");}}if(!e){return{html:'<span class="mstrmojo-text mstrmojo-emptyelems">'+b+"</span>",text:b};}var a=G(e,"andor");j.push(a.html);g.push("{"+a.text+"}");j.push("<span>:</span>");g.push(" : ");j.push('<span class="mstrmojo-elems">');g.push("[");L.forEach(l.nds,function k(n){if(!n){return ;}var d=W(n),w=n.fm,q=n.cs,o,t,h,p;switch(n.et){case M.ANDOR:L.forEach(n.nds,k);break;case M.AE:switch(n.fn){case V.IN_LIST:case V.NOT_IN_LIST:L.forEach(n.es,function(x){m(d);o=d?" not":"";t=C(x.n);j.push('<span class="mstrmojo-text mstrmojo-elem single'+o+'">'+t+"</span>");g.push(t);});break;case V.DESCENDANT:var u=(n.es||[]).slice();if(u.length===0){u.push({n:b});}L.forEach(u,function(z){m(d);o=d?" not":"";t=C(z.n);if(q&&q[0]){var x;p=q[0].v;if(isNaN(p)){h=p.substr(p.indexOf(";")+1);}else{h=mstrmojo.desc(493,"Level")+" "+(parseInt(p,10)+1);}x=h+" "+mstrmojo.desc(12853,"of")+" "+t;j.push('<span class="mstrmojo-text mstrmojo-elem level'+o+'">');j.push(x);g.push(x);}else{j.push('<span class="mstrmojo-text mstrmojo-elem descendant'+o+'">');j.push(C(z.n));g.push(t);}j.push("</span>");});break;}break;case M.AQ:L.forEach(n.cs,function(x){m(d);o=d?" not":"";p=x.v;h=(w&&w.n)?C(w.n+" "+p):"";if(w&&w.n==="LEVEL_NUMBER"){o+=" level";if(isNaN(p)){h=p.substr(p.indexOf(";")+1);}else{h=mstrmojo.desc(493,"Level")+" "+(parseInt(p,10)+1);}}j.push('<span class="mstrmojo-text mstrmojo-elem constant'+o+'">'+h+"</span>");g.push(h);});break;}});j.push("</span>");g.push("]");return{html:j.join(""),text:g.join("")};};function O(f,e){var c=Y[f&&f.et]||Y["*"],b=I(f),d=c&&c(f,e),a=e&&e.emptyText||A.emptyText;return{html:b&&b.html+((d&&d.html)||('<span class="mstrmojo-text empty-cond">'+a+"</span>")),text:b&&b.text+((d&&d.text)||a)};}function F(a){return O(a).text;}function J(e,d,b){if(!e){return null;}var o=e.et,l=e.fn,a=e.nds;if(o===M.ANDOR){var p=b?"bold":"";splitter=l===V.AND?A[p+"andText"]:(l===V.OR?A[p+"orText"]:"");a=[].concat(a);if(a.length<1){return null;}var k=[],q;L.forEach(a,function(t){q=J(t,false,b);if(q){k.push(q);}});var n,m=k.length;if(m<1){return null;}else{if(m===1){n=k[0];}else{n=k.join(" "+splitter+" ");}}n=d||e.not?n:"("+n+")";return e.not?A.notText+" "+n:n;}else{if(o===M.RLS){var j=e.dmy&&e.dmy.uts||[],g=[],f;L.forEach(j,function(t){g.push("{"+t.n+"}");});f=g.join(", ");var c=e.nds&&e.nds[0],h=J(c,false,b);if(h){return"("+f+" "+A.whereText.replace(/\(##\)/g,"").replace(/'##'/g,"")+h+")";}return null;}else{return F(e);}}}function B(a){if(mstrmojo.fe.FilterUtils.isExprEmpty(a)){return{et:14,fn:19};}else{((a&&a.nds)||[]).forEach(function(c,b){a.nds[b]=B(c);});return a;}}mstrmojo.fe.FilterUtils=mstrmojo.provide("mstrmojo.fe.FilterUtils",{getExprXml:function(g){var b="<exp>",a="</exp>",e={a:true,a2:true,a3:true,agg:true,cc:true,ce:true,cgp:true,cs:true,conid:true,desc:true,did:true,attId:true,dmt:true,dmy:true,dtp:true,es:true,et:true,expr:true,f:true,flat:true,flt:true,fm:true,fm2:true,fm3:true,fn:true,fnt:true,fres:true,gb:true,isp:true,items:true,m:true,m2:true,m3:true,n:true,nds:true,not:true,pf:true,p:true,r:true,rps:true,st:true,t:true,utgt:true,utp:true,uts:true,v:true,xml:true,relation:true,applySubExpr:true,useSchema:true,guide:true,rsTp:true,joTp:true,paTp:true,erTp:true,exp:true,joAttrs:true,ph:true,idx:true,idc:true,idcsi:true,ucfg:true,node:true},d={getArrItemName:function(h){return h.substr(0,h.length-1);},isSerializable:function(u,q,p){if(u==="xml"){var k=q[p].xml;return{att:'hasXML = "-1"',child:k};}else{if(mstrmojo.array.indexOf(["header_format","grid_format","child_header_format","child_grid_format"],u)>-1){var w=q[p][u];if(!w){return{};}var m="<"+u+">";for(var t in w){m+="<prs n='"+t+"'>";var l=w[t];for(var h in l){var o=l[h];m+="<pr n='"+h+"' v='"+(o==="pru"?"":o)+"'";m+=o==="pru"?' pru="1"':"";m+="/>";}m+="</prs>";}m+="</"+u+">";return{child:m};}else{if(u==="cs"){var j=q[p],n=q[p][u];if(j&&j.fnt&&j.fnt==S.FNT.PER&&n){if(n[0]){n[0].v+="%";}if(n[1]){n[1].v+="%";}}return true;}else{if(u==="c2"||u==="c3"){var j=q[p];if(j&&j.et==S.ET.MC&&(j.fn==S.FN.BETWEEN||j.fn==S.FN.NOT_BETWEEN)){return true;}else{return false;}}}}}return(e[u])?true:false;},skipNull:true},c=B(g);if(!c||c.et!=M.ANDOR||c.fn===V.NOT||c.not){c={et:M.ANDOR,fn:S.FN.AND,nds:c?[c]:[]};}var f=D.json2xml("nd",[{},c],d);return b+f+a;},isExprEmpty:function(a){return(!a||(a.et===M.ANDOR&&(a.nds||[]).length<1));},getExprConditionNodeHtml:function E(a){return O(a).html;},getExprConditionNodeText:function F(a){return O(a).text;},getExprNodeHtmlAndText:function P(b,a){return O(b,a);},getExprText:function X(b,a){return J(b,true,a);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.num","mstrmojo.locales");var D=mstrmojo.array,A=mstrmojo.num,B=mstrmojo.locales;mstrmojo.vi.util.NumberFormatUtility=mstrmojo.provide("mstrmojo.vi.util.NumberFormatUtility",{applyFormatToNumber:function C(P,Q,G){var H="\u00A4",L=/"[^"]*"/g,F=P.match(L),K=P.replace(L,H),O=["m","y","d","h","s"],N=G||false,E=new Date(),M=E.getFullYear(),J=E.getMonth(),I=E.getDay(),S=B.datetime,R;D.forEach(O,function(U){N=N||K.indexOf(U,0)!==-1;});if(N){K=K.replace(/y{3,}/g,M).replace(/y{1,2}/g,M.toString().slice(2,4));K=K.replace(/m{4,}/g,S.MONTHNAME_FULL[J-1]).replace(/m{3}/g,S.MONTHNAME_SHORT[J-1]).replace(/mm/g,"07").replace(/m/g,"7").replace(/7ber/g,"mber");K=K.replace(/d{4,}/g,S.dayNames[I-1]).replace(/d{3}/g,"Mon").replace(/dd/g,"10").replace(/d/g,"1").replace(/1ay/g,"day");K=K.replace(/hh/g,"08").replace(/h/g,"8");K=K.replace(/ss/g,"04").replace(/s/g,"4");K=K.split(H);R=K[0];D.forEach(F,function(V,U){R+=V+K[U+1];});return R;}if(A.isNumeric(Q)){return A.formatByMask(P,A.parseNumeric(Q));}return Q;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.func","mstrmojo.css","mstrmojo.UUID","mstrmojo.fe.FilterUtils","mstrmojo.desc");var Q=mstrmojo.func,L=mstrmojo.hash,J=mstrmojo.array,N=mstrmojo.expr,U=mstrmojo.css,R=N.DTP,F=mstrmojo.UUID,V=mstrmojo.fe.FilterUtils,U=mstrmojo.css;var H=16,E=32;function O(a,Z,c){var X=L.copyProps(["did","t","st","n"],a),Y=(a.fs||[]).filter(function(d){return d.fnm==="LEVEL_NUMBER"||d.n==="LEVEL_NUMBER";})[0],b;if(Z){b={et:N.ET.AE,fn:N.FN.DESCENDANT,a:X,es:[{v:Z.v,n:Z.n}]};if(parseInt(c,10)>=Z.lv){b.cs=[{v:c-Z.lv,dtp:R.INTEGER},{v:2,dtp:R.INTEGER}];}}else{if(parseInt(c,10)>=0&&Y){b={et:N.ET.AQ,fn:N.FN.EQUAL,a:X,fm:{did:Y.did||Y.fid,n:Y.n||Y.fnm,dtp:R.INTEGER},cs:[{v:c,dtp:R.INTEGER}]};}}return b?V.getExprXml(b):"";}mstrmojo.ui._IsIncFetchHierarchyList=mstrmojo.provide("mstrmojo.ui._IsIncFetchHierarchyList",{_mixinName:"mstrmojo.ui._IsIncFetchHierarchyList",blockCount:500,getDataHelper:mstrmojo.emptyFn,getAttribute:mstrmojo.emptyFn,isHiearachyDisplay:mstrmojo.emptyFn,getItemMarkup:function C(Z,X){var Y;if(Z.fetcher){Y='<{@tag} class="item fetcher {@cls}" idx="{@idx}" style="{@style}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="text">{@en@n}</span></{@tag}>';}else{Y=this._super(Z,X);}return Y;},isFetcher:function K(X){if(X instanceof HTMLElement){X=this.getItemFromTarget(X);}return X&&X.fetcher;},fetchItems:function I(X,Y){this._super(X,Q.wrapMethods(this.getFetchItemsCallback(X),Y));},fetchItemsThroughTaskCall:function P(b,g){var a=this.getDataHelper(),Z=this.getAttribute();if(a&&Z&&!this.isFetching){this.set("isFetching",true);var d=this,e=b.branch,X=parseInt(b.level,10),c=b.blockBegin||1,f=b.blockCount||this.blockCount,Y=b.browseFlags||0;a.set("browseConfig",L.copy({blockBegin:c,blockCount:f,browseFlags:Y,expressionXML:(e||X>=0)?O(Z,e,X):"",otp:Z.t,compress:1},L.copy(a.browseConfig)));a.getItems(c,Q.wrapMethods({success:function(h){if(h){L.copy({bb:c,bc:f},h);J.forEach(h.es,function(j){if(!j.pid&&j.pi>-1){j.pid=h.es[j.pi].v;delete j.pi;}L.copy({lv:j.lv||0,hcd:!!j.hcd,hid:!!j.hid,dhid:!!j.hid,pid:j.pid||""},j);});}}},g,{complete:function(h){d.set("isFetching",false);}}),{hideFailureErr:g.failure});}},getFlatDisplayItems:function B(X){return X.filter(function(Y){var Z=Y.fhid;delete Y.fhid;return !Z;});},getFetchItemsCallback:function M(a){var Z=this,Y=a.branch,b=parseInt(a.level,10),X=this.isHiearachyDisplay();return{success:function(c){if(c&&c.es){var e=c.es,d=c.bb+c.bc-1;if(c.sz>d&&!c.raad){e.push({v:"fetcher"+F.create(),n:mstrmojo.desc(1005,"More..."),fetcher:true,lv:X?(b>=0?b:(Y?Y.lv+1:0)):-1,config:L.copy({blockBegin:d+1},L.copy(a))});}if(!X){e.forEach(function(g){var h=g.hid,f=Z.getItemByValue(g.v);delete g.epd;delete g.hid;if(f){delete g.hcd;}L.copy({fhid:h,dhid:!f||f.dhid},g);});}if(Z.setDisplayParent){Z.setDisplayParent(e,null,true);}}}};},getMaxLevel:function A(){var X=this.getAttribute(),Y=(X&&X.lvfs||[]).length;if(Y>0){return Y-1;}return this._super?this._super():0;},getLevels:function D(){var X=this.getAttribute(),Y=X&&X.lvfs||[];return Y.map(function(a,Z){return{v:Z,n:a.lvfn};});},initElements:function S(c){if(this.isHiearachyDisplay()){delete this.displayRoots;var Z=this.getItems(),Y=Z.length,b,X;if(Y>0){if(this.raad){for(var a=Y-1;a>-1;a--){b=Z[a];if(b.fetcher&&b.fake){b.hid=true;X=J.find(b.parent&&b.parent.children,"idx",b.idx);if(X>-1){b.parent.children.splice(X,1);}X=J.find(b.displayParent&&b.displayParent.displayChildren,"idx",b.idx);if(X>-1){b.displayParent.displayChildren.splice(X,1);}}}}this.refresh();}else{this.fetchItems({browseFlags:E},c);}}else{this.clearItemsNode();this.fetchItems({blockCount:500,browseFlags:H},c);}},clearItemsNode:function G(){var X=this.itemsContainerNode;if(X){X.innerText="";this.updateScrollbars();}},onclick:function W(h){var e=h.getTarget(),Y=this.getItemNodeFromTarget(e),j=this.getItemFromTarget(e);if(j&&j.fetcher){if(U.hasClass(e,"text")){if(j.fake){var d=function(k){if(k.displayParent){if(!k.displayParent.hid){return k.displayParent;}else{return d(k.displayParent);}}},b=d(j),a=b?b.displayChildren:this.getDisplayRoots(),f=this.items,X=j.config.nextSiblingIdx,c=this.blockCount,Z=X+c,g;if(a.length-1>Z){g=a.slice(X,Z);j.config.nextSiblingIdx+=c;j.lv=g[g.length-1].lv;g.push(j);}else{a.pop();if(j.parent){j.parent.children.pop();}f.splice(J.find(f,"idx",j.idx),1);g=a.slice(X,a.length);}Y.outerHTML=this._buildSiblingsMarkup(g).join("");this.updateScrollbars();}else{this.fetchItems(j.config,{success:function(k){j.hid=true;Y.outerHTML="";}});}}h.cancel();}else{this._super(h);}},});}());(function(){mstrmojo.requiresCls("mstrmojo.StringBuffer","mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo._IsGraphDataService","mstrmojo.func","mstrmojo._ImageHelper","mstrmojo.fe.FilterUtils","mstrmojo.rw.model.RetrievalKeysConfig","mstrmojo.rw.model.UpdateKeysConfig");var e=mstrmojo.hash,B=e.copy,V=mstrmojo.array,Aa=mstrmojo.dom,AB=mstrmojo.func,AQ=[mstrmojo.desc(8445,"Loading")],AH=mstrmojo.fe.FilterUtils.getExprXml,At=mstrmojo.array.ensureArray,P=0;function X(BX){BX=BX||{};BX.preserveUndo=true;return BX;}function Aq(Bb,Bc,BX){if(this.blockRequests){throw ("The data service is currently ignoring all requests to the server.");}var BY=P++,Ba=this.getTxUpdates(BY);BX=BX||{};BX.src=Aq.caller.name;if(!mstrmojo.string.isEmpty(Ba)){Bb.updateChanges=Ba;}Bb.zoomFactor=this.model.getZoomFactor();var BZ=this.cmdMgr;if(!BX.preserveUndo&&BZ){BZ.onSubmitUpdates();}mstrApp.serverRequest(Bb,this.wrapCallback(Bc,BY,BX.preserveStid),BX);}function N(BZ,BY,BX){e.copy({unitType:BY.defn&&BY.defn.t,unitKey:BY.k},BZ);if(BX.layoutKey){e.copy({toKey:BX.layoutKey,analysisSectionType:BX.analysisSectionType},BZ);}else{e.copy({toKey:BX.parentKey},BZ);}return BZ;}function Aw(BY){BY=BY||{};if(mstrApp.optimizeFitToPage){var BX=window.mstrMobileApp?this.model.controller.getContentDimensions():mstrApp.getContentDimensions();if(BX){BY.styleName="RWDocumentMobileStyle";BY.availableWidth=BX.w;BY.availableHeight=BX.h;}else{BY.innerWidth=mstrmojo.dom.windowDim().w;BY.innerHeight=mstrmojo.dom.windowDim().h;}}return BY;}function BS(BY){var BX=BY&&BY.style,BZ=BX&&BX.params;return BZ&&BZ.treesToRender;}function C(BX,BY){return{act:"moveUnit",toKey:BX,unitType:BY};}function Av(BX){return BX.split("\u001E")[2];}function M(BY,Bc){if(BY!==mstrmojo.DocDataService.UNDO_KEY){return BY;}if(!this.undoSectionKey){var Bb=this.undoSectionKey=this.model.getNextKey(),BZ=this.undoFGKey=this.model.getNextKey();Bc.addActions({act:"addUndoSection",cbKey:this.cbKey,nodeKey:Bb,fgKey:BZ});var Ba=this;Bc.addCallbacks({failure:function BX(){delete Ba.undoSectionKey;}});}return this.undoSectionKey;}function Ap(BZ,BY){var BX={dsid:BZ.dsid,formula:BZ.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(BZ.tokenStreamXML),name:BZ.alias,afb:BZ.afb,sfb:BZ.sfb};if(BY){BX.Ids=["$GUID_135"];}return this.getAddDerivedMetricToDatasetAction(BX);}function L(BY){var BX="USE_DEFAULT_INDICATOR";BY=BY||{};BY.mptso=BY.mptso||{pru:true};BY.mptsim=BY.mptsim||{pru:true};BY.mptfms=BY.mptfms||"";return{MDXPassThrough:{SolveOrder:BY.mptso.pru?BX:BY.mptso.v,ScopeIsolationMode:BY.mptsim.pru?BX:BY.mptsim.v,FormatString:BY.mptfms}};}function AM(BX,BY){return{act:"formatDerivedMetric",dsid:BX.dsid||"",mid:(BY||!BX.did)?"$GUID_135":BX.did,format:L(BX.mptf),};}function AP(Ba,Bd,BY,Be,BX,BZ){var Bb=[this.getNodeKeyFromKeyContext(Bd)];if(!BZ){Bb=At(Be).concat(Bb);}var Bc={act:Ba,keyContext:Bd,tgtKey:BY,partialRetrieval:{nodes:Bb}};if(!BX){Bc.partialUpdate={selectors:[Av(Bd)]};}return Bc;}function n(BZ){var Bb=false;if(BZ===1||BZ===2){var BY=this.model,BX=BY.controller,Bc=BX.getRequiredZoomFactor&&BX.getRequiredZoomFactor(BZ),Ba=BY.getZoomFactor();if(isNaN(Bc)||parseInt(Math.abs((Bc-Ba)*100),10)<=2){Bb=false;}else{Bb=true;}}return Bb;}mstrmojo.DocDataService=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsGraphDataService,mstrmojo._ImageHelper],{scriptClass:"mstrmojo.DocDataService",defaultStyle:{params:{treesToRender:2}},cmdMgr:null,stid:-1,blockRequests:false,clientAuto:false,init:function An(BX){this._super(BX);this.cmdMgr=this.model.controller&&this.model.controller.cmdMgr;},wrapCallback:function Ag(Bc,BZ,BY){var Ba=this;return AB.wrapMethods({success:function Bb(Bd){if(Bd){Ba.model.bs=Ba.rwb=Bd.bs||Ba.rwb;Ba.msgId=Bd.mid||Ba.msgId;Ba.cbKey=Bd.cbKey||Ba.cbKey;if(Bd.stid!==undefined&&!BY){Ba.stid=Bd.stid;}if(Bd.clientAuto!==undefined){Ba.clientAuto=Bd.clientAuto;}if(mstrApp.parseSecondaryDataProviders){mstrApp.parseSecondaryDataProviders(Bd);}}Ba.clearTxUpdates(BZ);},failure:function BX(){Ba.resetTxUpdates(BZ);}},Bc);},getNodeKeyFromKeyContext:function Z(BX){return BX.split("\u001E")[1];},refresh:function A3(BZ,Ba){var BY=!!BZ.useRefreshProgress,BX=BY?[mstrmojo.desc(10078,"Refreshing data. Please wait.")]:AQ;delete BZ.useRefreshProgress;BZ=Aw.call(this,BZ);Aq.call(this,B(BZ,{taskId:"docRefresh",rwb:this.rwb,rePrompt:false,fresh:false,regenerate:false,displayNoResErr:true,compress:1}),Ba,{showProgress:true,hideProgress:true,progressStateText:BX,useRefreshProgress:BY});},saveRW:function A7(BX,BY){Aq.call(this,B(BX,{taskId:"saveRW",msgID:this.msgId}),BY);},saveThresholds:function j(BY,BZ,BX){Aq.call(this,B(BY,{taskId:"saveThresholds"}),BZ,BX);},getThresholds:function BL(BY,BZ,BX){Aq.call(this,B(BY,{taskId:"getThresholds"}),BZ,BX);},browseElements:function AL(BY,BZ,BX){Aq.call(this,B(BY,{taskId:"browseElements",styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30}),BZ,BX);},removeUnit:function Y(BY,BZ){var BX=B(BY,{act:"removeUnit"});this.submitTemplateUpdates(BX.nodeKey,BX,BZ);},removeLayout:function AU(BY,BX,BZ){this.submitUpdates({act:"removeLayout",unitKey:BY,isCurrent:BX},BZ);},moveLayout:function z(BZ,BX,BY){this.submitUpdates(this.getMoveNodeAction(BZ,BX,BY),mstrmojo.DocDataService.EMPTY_CALLBACK,mstrmojo.DocDataService.SUPPRESS_DATA);},getMacroCopyNodeAction:function Ar(BY,BX,Ba){var BZ={act:"macroCopyUnit",newKey:Ba,partialRetrieval:this.newRetrievalKeysConfig().addNode(Ba)};N(BZ,BY,BX);return BZ;},getMacroMoveNodeAction:function AG(BY,BX){var BZ={act:"macroMoveUnit",partialRetrieval:this.newRetrievalKeysConfig().addNode(BY.k)};N(BZ,BY,BX);return BZ;},getMoveNodeAction:function t(Bb,BX,BY){var Ba=Bb.defn,BZ=Ba?Ba.t:mstrmojo.EnumRWUnitType.LAYOUT;return this.getMoveNodeActionUsingKey(Bb.k,BZ,BX,BY);},getMoveNodeActionUsingKey:function BA(Bb,BZ,BX,BY){var Ba=C(BX,BZ);Ba.unitKey=Bb;if(BY!==undefined){Ba.index=BY;}return Ba;},getMoveControlAction:function d(Ba,BY,BX){var BZ=C(BY,mstrmojo.EnumRWUnitType.SELECTOR);BZ.keyContext=Ba;if(BX){BZ.partialRetrieval={nodes:At(BX)};}return BZ;},addMoveControlAction:function I(Ba,BZ,BY,BX){Ba.addActions(this.getMoveControlAction(BZ,M.call(this,BY,Ba),BX));},getSetCtrlSourceAction:function AN(BY,Ba,BX,BZ){return{act:"setControlSource",keyContext:BY,unitId:Ba,unitType:BX,removeCGB:BZ||[],partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BY)),partialUpdate:{selectors:[Av(BY)]}};},getRemoveCtrlTargetAction:function G(BZ,BY,Ba,BX){return AP.call(this,"removeControlTarget",BZ,BY,Ba,BX);},getClearCtrlTargetAction:function BH(BX){return{act:"clearControlTarget",keyContext:BX};},getAddCtrlTargetAction:function A1(Bb,BY,Bc,Bd,BX,BZ){var Ba=AP.call(this,"addControlTarget",Bb,BY,Bc,BX,BZ);Ba.isUC=!Bd;return Ba;},getAddCtrlTargetDatasetAction:function BE(BY,BX){return{act:"addControlTargetDataset",keyContext:BY,tgtDid:BX};},getRemoveCtrlTargetDatasetAction:function h(BY,BX){return{act:"removeControlTargetDataset",keyContext:BY,tgtDid:BX};},getClearCtrlTargetDatasetAction:function AT(BX){return{act:"clearControlTargetDataset",keyContext:BX};},getChangeControlElementSource:function BR(BY,BX){return{act:"changeControlElementSource",keyContext:BY,ctlElementSrc:BX};},getSetAttributesJoinTypeAction:function Ak(BX,BY){return{act:"setAttributesJoinType",nodeKey:BX,value:BY,partialRetrieval:this.newRetrievalKeysConfig().addNode(BX)};},getSetMetricJoinTypeAction:function Ac(BZ,Bb,BX,BY,Ba){return{act:"setMetricJoinType",nodeKey:BZ,unitId:Bb,dataType:BX,unitType:BY,value:Ba,partialRetrieval:this.newRetrievalKeysConfig().addNode(BZ)};},getTxUpdates:function AZ(BY){var BX=this.model;return BX&&BX.getTransactionUpdates&&BX.getTransactionUpdates(BY);},clearTxUpdates:function Ao(BY){var BX=this.model;if(BX&&BX.clearTransactionUpdates){BX.clearTransactionUpdates(BY);}},resetTxUpdates:function D(BY){var BX=this.model;if(BX&&BX.resetTransactionUpdates){BX.resetTransactionUpdates(BY);}},loadDocLayout:function K(Bb,Bd,Bc){var Ba={act:"setCurrentLayout",unitKey:Bb.layoutKey,disablePU:true,panelUnitKey:Bb.panelKey},BZ={style:{params:{treesToRender:3}},params:Aw.call(this,Bb)},BX=this.model,BY=!!Bc;if(!Bc){Bc=BX.getDataService().newUpdateWithoutCmd();}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){BX.applyBufferedSelections(Bc);}Bc.add(Ba,Bd,BZ);if(!BY){this.submitUpdates(Ba,Bd,BZ);}},checkMissingCredentials:function AC(BX,BY){Aq.call(this,B(BX,{taskId:"checkMissingCredentials"}),BY);},setCurrentDocLayout:function Ay(BZ,Bd,Bc){var Bb={act:"setCurrentLayout",unitKey:BZ},Ba={config:{silent:(Bd===null)&&(!!Bc&&Object.keys(Bc.callback||{}).length===0)}},BX=this.model,BY=!!Bc;Bd=Bd||null;if(!Bc){Bc=BX.getDataService().newUpdateWithoutCmd();}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){BX.applyBufferedSelections(Bc);}Bc.add(Bb,Bd,Ba);if(!BY){Bc.submit();}if(window.mstrMobileApp!==undefined){mstrMobileApp.clearWebViewCache(false);}},fetchDocPage:function BI(BX,BY){Aq.call(this,{taskId:"fetchDocPage",rwb:this.rwb,pos:BX},BY);},requestPanelChangeDeferred:function BQ(Bd,Bc,BX,BY,Ba,Bb){var BZ={act:"setCurrentPanel",unitKey:Bc};if(BX){BZ.partialRetrieval={nodes:BX.split(",")};}Bd.add(BZ,Bb,{config:{showProgress:Ba,hideProgress:Ba,progressStateText:AQ},style:{params:{treesToRender:BY?3:0}}});},getGraphSelectionAction:function E(Bb,BX,BZ,Be,Bd,BY){var Bc=this.model.getCurrentLayoutDef(),Bf=(Bc&&Bc.dzf)||1,Ba={act:"graphSelector",nodeKey:Bb,sliceID:BZ,x:Math.round(Be/Bf),y:Math.round(Bd/Bf)};if(BY){Ba.usePartialUpdate="0";}else{Ba.partialUpdate={selectors:BX.split("\u001E")};}return Ba;},getSelectorElementsAction:function u(BZ){var BY={act:"setSelectorElements",keyContext:BZ.ck,ctlKey:BZ.ctlKey,elemList:mstrmojo.string.decodeHtmlString(BZ.eid),isVisualization:!!BZ.isDocVis},BX=BZ.include;if(BX!==undefined){BY.include=!!BX;}if(BZ.tks){BY.tks=BZ.tks;}if(BZ.disablePU){BY.usePartialUpdate="0";}else{if(BZ.ignoreTargetData){BY.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BZ.ck));}else{BY.partialUpdate={selectors:BZ.ctlKey.split("\u001F")};}}return BY;},getUpdateTransactionAction:function BV(BY){var BX={act:"updateTransaction"};if(BY){if(BY.ctlKey){BX.partialUpdate={selectors:[BY.ctlKey]};}}return BX;},getSelectorFromGMAction:function o(BY){var BX={act:"setSelectorFromGM",keyContext:BY.ck,ctlKey:BY.ctlKey,keepOnly:!!BY.keepOnly,selectorObjects:BY.selectorObjects,isVisualization:!!BY.isDocVis,include:!!BY.include};if(BY.tks){BX.tks=BY.tks;}if(BY.disablePU){BX.usePartialUpdate="0";}else{BX.partialUpdate={selectors:[BY.ctlKey]};}return BX;},getGMViewFilterAction:function AK(BY){var BX={act:"keepOnlyGM",selectorObjects:BY.selectorObjects,isVisualization:!!BY.isDocVis,keepOnly:!!BY.keepOnly};if(BY.tks){BX.tks=BY.tks;}if(BY.disablePU){BX.usePartialUpdate="0";}else{BX.partialUpdate={selectors:[BY.ctlKey]};}return BX;},browseControlElements:function BM(Bb,Bk,BY){var Ba=Bb.searchPattern,Bh=Bb.attributeId,Bd=this.model;if(!Ba||Ba===""){return ;}var Be={taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:Bh,expressionXML:Bb.expressionXML||"",dataSourcesXML:Bb.dataSourcesXML||"",blockBegin:Bb.blockBegin,blockCount:Bb.blockCount,searchPattern:Ba,rawInput:Ba,browseFlags:Bb.browseFlags||0,otp:Bb.objectType};if(Bb.datasetId){B({datasetID:Bb.datasetId,messageID:Bd.mid,ctlKey:Bb.controlKey},Be);}var Bj=Bb.searchForms;if(Bj){var BZ="",Bc="";V.forEach(Bj,function(Bl){BZ+=Bc+Bl.did;Bc=";";});Be.searchForms=BZ;if(Bd.isnew||Bb.useClientForm){var BX="",Bg="",Bf=V.filterOne(Bd.getDatasetUnits(["att"]),function(Bl){return Bl.did===Bh;}),Bi=Bf.fs||[];V.forEach(Bj,function(Bl){var Bm=V.filterOne(Bi,function(Bn){return Bn.fid===Bl.did;});BX+=Bg+Bl.did+":"+(Bm&&Bm.bftp||0);Bg=";";});Be.clientFormPatterns=BX;}}Aq.call(this,Be,Bk,BY);},setMultiDocSelectorElements:function AI(BX,BY,Ba){var BZ={taskId:"setMultiDocSelectorElements",rwb:this.rwb,multiSelect:BY,selectorObjects:BX};Aq.call(this,BZ,Ba,{showWait:true,hideWait:true,delay:true});},setDocSelectorTexts:function U(Bc,Be,Bg,Bd,Bf,BY,BX,BZ,Bb){var Ba={taskId:"setDocSelectorTexts",rwb:this.rwb,unitKeyContext:Bc,ctlTexts:Be,ctlKey:Bg,zoomFactor:BY};if(Aa.isAndroid||BX){Ba.taskId="androidSetDocSelectorElements";}if(Bd!==null&&Bd!==undefined){Ba.include=Bd;}if(BZ!==null&&BZ!==undefined){Ba.usePartDisplay=BZ;}if(Bb!==null&&Bb!==undefined){Ba.treesToRender=Bb;}Aq.call(this,Ba,Bf);},getSelectorExpressionAction:function w(BZ){var BY={act:"setSelectorExpression",keyContext:BZ.ck,ctlType:BZ.type,objId:BZ.srcid,objType:BZ.srct,expFunction:BZ.f,expFunctionType:BZ.ft,include:!!BZ.include,qt:BZ.qt,unset:!!BZ.unset};if(BZ.disablePU){BY.usePartialUpdate="0";}else{BY.partialUpdate={selectors:[BZ.ckey]};if(BZ.retrieveCtrlKey){BY.partialRetrieval=this.newRetrievalKeysConfig().addNode(BZ.ctlKey);}}if(BZ.changeQual){BY.changeQual=BZ.changeQual;}var BX=BZ.cs;if(BX!==null&&BX!==undefined){BY.expConstants=BX;BY.dataType=BZ.dtp;}if(BZ.fid){BY.fid=BZ.fid;}return BY;},getAttributeSelectorExpressionAction:function A0(BY){var BX={act:"setAttributeSelectorExpression",keyContext:BY.ck,ctlKey:BY.ctlKey,ctlType:BY.type,expr:BY.expr,partialUpdate:{selectors:[BY.ctlKey]}};if(BY.tks){BX.tks=BY.tks;}return BX;},getMultiUnitSelectorAction:function BO(BX){return{act:"multiUnitSelection",keyContext:BX.ck,include:BX.include!==false,sels:BX.selections,partialUpdate:{selectors:[BX.ctlKey]}};},getRemoveCtrlAction:function As(BY,BX){return{act:"removeControl",key:BY,partialUpdate:{selectors:[BY]},partialRetrieval:{nodes:At(BX)}};},getAddCtrlAction:function Aj(Be,Bc,BY,Bd,BZ,Bf,BX,Ba,Bg){if(isNaN(Bg)){Bg=1;}var Bb={act:"addControl",parentKey:Be,nodeKey:Bc,ctlKey:BY,isUC:!!BZ,unitType:Bf||-1,unitId:BX||"",targetKeys:At(Ba),ctlType:Bg,gpType:Bg,partialRetrieval:{nodes:At(Bd)}};if(!Bb.isUC){Bb.partialUpdate={selectors:[BY]};}return Bb;},getReplaceCtrlAction:function S(BZ,Bc,BX,Bb,BY,Ba){return{act:"replaceControl",nodeKey:this.getNodeKeyFromKeyContext(BZ),ctlKey:Bc,ctlType:BX,unitId:Bb,unitType:BY,partialUpdate:{selectors:[Bc]},partialRetrieval:{nodes:At(Ba)}};},getSaveGraphPropertiesAction:function m(BX,BY){return{act:"saveGraphProperties",nodeKey:BX,properties:BY};},getSelectorIncludeAction:function A9(BY){var BX=BY.ckey;return{act:"setSelectorInclude",keyContext:BY.ck,ctlKey:BX,ctlType:BY.type,include:BY.include,partialUpdate:{selectors:[BX]}};},getSelectorShowAllAction:function Q(BX){return{act:"setSelectorShowAll",keyContext:BX.ck,ctlKey:BX.ckey,ctlType:BX.type,showAll:BX.showAll,partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BX.ck))};},getUnsetSelectorAction:function g(Ba){var BZ=Ba.ckey,BX=Ba.ck,BY={act:"unsetSelector",keyContext:BX,ctlKey:BZ,ctlType:Ba.type};if(Ba.ignoreTargetData){BY.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BX));}else{BY.partialUpdate={selectors:[BZ]};}if(Ba.retrieveCtrlKey){BY.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BX));BY.partialRetrieval=BY.partialRetrieval.addNode(BZ);}return BY;},getRASelectorExpandAction:function q(BY){var BX=BY.ckey;return{act:"raSelectorExpandCollapse",keyContext:BY.ck,ctlKey:BX,ctlType:BY.type,elementId:BY.elementId,isExpand:BY.isExpand,partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BY.ck))};},getChangeFilteringAction:function A5(BX,Ba,BZ,BY){return{act:"changeFiltering",nodeKey:BX,filterMode:Ba,isUC:BZ,partialRetrieval:{nodes:(BY?At(BY):[])}};},getAddDerivedMetricToDatasetAction:function BD(BX){return{act:"addDerivedMetricToDataset",dsid:BX.dsid,formula:BX.formula,isTokenStream:BX.isTokenStream,name:BX.name,newObjectIds:BX.Ids,afb:BX.afb,sfb:BX.sfb};},getSetMDXPassThroughOptionsForCMAction:function A(BX){var BY={act:"formatDerivedElement",format:L(BX.mptf)};if(BX.cid){BY.cid=BX.cid;}if(BX.ceid){BY.ceid=BX.ceid;}return BY;},getEditDocUnitPropAction:function AF(BX){return{act:"editDocUnitProp",dsid:BX.dsid,formId:BX.formId,unitId:BX.unitId,unitType:BX.unitType,prop:BX.prop,value:BX.value};},getRWGraphImage:function BU(Bb,Bf){if(mstrApp.isExpress&&!mstrApp.optimizeFitToPage&&n.call(this,this.model.zt)){return ;}var Ba=mstrApp,BX=this.id,BY={taskId:"getRWGraphImage",taskEnv:"xhr",imgType:4,messageID:this.msgId,nodeKey:Bb.k,sliceID:parseInt(Bb.sid,10),width:parseInt(Bb.w,10),height:parseInt(Bb.h,10)};if(Bb.needCoordinate){BY.needCoordinate=1;}if(Ba.onMobileDevice()&&Ba.useBinaryFormat){window.setTimeout(function(){Aq.call(mstrmojo.all[BX],BY,Bf,X());},0);}else{if(Bb.encodeImage){BY.taskContentEncoding="base64";delete BY.taskEnv;Aq.call(this,BY,{success:function Bg(Bh){Bf.success(Bh);},failure:function BZ(Bh){(Bf.failure||Ba.onerror)(Bh);}},X());}else{var Bd=Ba.getConfiguration(),Bc=Ba.getCurrentProjectId(),Be=new mstrmojo.StringBuffer();BY.__ts__=new Date().getTime();BY.sessionState=Ba.getSessionState(Bc);e.forEach(BY,function(Bh,Bi){Be.append(Bi+"="+encodeURIComponent(Bh));});Bf.success(Bd.getTaskUrlByProject(Bc)+"?"+Be.toString("&"));}}},getImage:function BT(BY){var BZ=mstrApp,BX=BZ.getConfiguration();if(BX&&BY&&BY.indexOf("://")===-1){BY=BX.getHostUrlByProject(BZ.getCurrentProjectId())+BY;}return(mstrApp.useBinaryFormat)?String(mstrMobileApp.getImage(BY)):BY;},setGridDisplayMode:function x(BZ,BY,Ba,BX){e.copy(mstrmojo.DocDataService.RAPID_EXEC,BX);this.submitUpdates({act:"setGridDisplayMode",unitKey:BZ,displayMode:BY},Ba,BX);},setDocZoom:function H(BX,BY){this.submitUpdates(B(BX,{act:"setDocZoom",disablePU:true}),BY,{style:{params:{treesToRender:3}}});},sortGrid:function AR(BX,BY){this.submitTemplateUpdates(BX.nodeKey,B({act:"sort"},BX),BY);},getAdvSortData:function Am(BX,BY){this.rwExecute(B(BX,{styleName:"RWGridStyle"}),BY);},getFilterExpression:function AW(BZ,BY){var Ba=BZ&&BZ.expr,BX=this.model;if(Ba&&BX&&BX.getVfexprWithUpdatedVf){Ba=BX.getVfexprWithUpdatedVf(BY,Ba);}return AH(Ba);},saveViewFilter:function Az(Bc,Bd){var Bb=this.msgId,BX=Bc&&Bc.nodeKeys,Ba=this,BZ=V.map(BX,function(Be){return{act:"saveViewFilter",messageID:Bb,nodeKey:Be,expr:Ba.getFilterExpression(Bc.filterModel,Be),partialUpdate:{nodes:[Be]}};}),BY=V.map(BX,function(Be){return{act:"saveViewFilterLimit",messageID:Bb,nodeKey:Be,limitExp:Bc.limitExp,limitToRemove:Bc.limitMdxToRemove||[]};});this.submitUpdates(BZ.concat(BY),Bd);},getViewFilter:function AS(BY,BZ){var BX=this.model;if(BX.getViewFilter){BX.getViewFilter(BY,BZ);}else{Aq.call(this,{taskId:BY.taskId,rwb:BY.rwb,msgID:BY.msgID,nodeKey:BY.nodeKey},BZ);}},createEmbeddedFilter:function Au(BZ,Bc){var BX=BZ.filterId,Ba=BZ.expJson,Bb={act:"createEmbeddedFilter",messageID:this.msgId,expr:BZ.expr,filterId:BX,filterName:BZ.filterName};var BY=this.model;AB.wrapMethods({success:function(){var Bd=BY.defn.efs||[];Bd.push({did:BX,exp:Ba});BY.defn.efs=Bd;}},Bc);this.submitUpdates([Bb],Bc,{style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.NONE}},params:{suppressData:true}});},rwExecute:function BK(BX,BY){Aq.call(this,B(BX,{taskId:"RWExecute",rwb:this.rwb,messageID:this.msgId}),BY);},pivot:function p(BX,BY){this.submitTemplateUpdates(BX.nodeKey,{act:"pivot",unitId:BX.unitId,unitType:BX.unitType,attFormId:BX.attFormId,axis:BX.axis,unitPos:BX.unitPos},BY);},resizeXtabColumn:function BG(BX,BY){this.submitUpdates([this.getUpdateTemplateAction(BX.nodeKey,BX),{act:"format",unitType:52,unitKey:BX.nodeKey,formatType:1,format:{FormattingSize:{WidthMode:2}}}],BY);},showTotals:function W(BX,BY){this.submitTemplateUpdates(BX.nodeKey,{act:"showTotals",unitId:BX.unitId,unitType:BX.unitType,subtotalType:BX.subtotalType,clearSubtotalType:BX.clearSubtotalType},BY);},drillGrid:function AO(BX,BY){this.submitUpdates(this.getDrillGridAction(BX),BY,{config:{showProgress:true,hideProgress:true,progressStateText:AQ,delay:true}});},getDrillGridAction:function BN(BY){var BX={act:"gridDrillWithin",messageID:this.msgId,nodeKey:BY.nodeKey,sliceId:BY.sliceId,drillPathIndex:BY.drillPathIndex,drillPathKey:BY.drillPathKey,elementList:BY.drillElements,retainParent:BY.retainParent,partialUpdate:{nodes:At(BY.updateNodeKey||BY.nodeKey)}};if(BY.x){BX.x=BY.x;BX.y=BY.y;}return BX;},changeDocGroupBy:function O(BZ,Ba,BX){var BY={act:"changeDocGroupBy",disablePU:true};if(BZ.flags){BY.flags=BZ.flags;}if(BZ.groupbyKey){BY.gbKey=BZ.groupbyKey;BY.elemId=BZ.elementId;}else{BY.gbUnits=BZ.gbUnits;}this.submitUpdates(BY,Ba,{config:BX,style:{params:{treesToRender:3}},params:Aw.call(this,BZ)});},setOutlineExpanding:function A6(BZ,Ba,BX){var BY={act:"updateTemplate",keyContext:BZ.unitKey,actions:[{act:"setOutlineExpanding",prs:"Template Formatting",pr:"OutlineLevelExpanding",v:BZ.outlineLevel}]};this.submitUpdates(BY,Ba,e.copy(mstrmojo.DocDataService.RAPID_EXEC,{config:{silent:true},style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH}}}));},retrieveServerJson:function f(BZ,Bj,Ba){if(mstrApp.isExpress&&!mstrApp.optimizeFitToPage&&n.call(this,this.model.zt)){return ;}var Bc=this.model,Bd=Bc.controller,Bh={},BX,BY,Bf;var Bg=BZ.nodes;if(Bg){Bh.partialRetrieval=Bg;}var Bi=BZ.slices;if(Bi){Bh.slices=Bi;}if(Ba){BX=Ba.style;BY=Ba.config;Bf=Ba.params;}if(!BY){BY={showProgress:true,hideProgress:true,progressStateText:AQ};}var Bk=BZ.style=e.clone(this.defaultStyle),Be=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();B(BX.params,Bk.params);var Bb={taskId:"getServerJSONResults",styleName:"ServerJsonRWDStyle",compress:1,rwb:this.rwb,messageID:this.msgId,stateID:-1,excludeData:!!(Be||mstrConfig.resolveOnly),params:JSON.stringify(Bh),treesToRender:Bk.params.treesToRender};B(Bf,Bb);BY.preserveUndo=(Ba&&Ba.preserveUndo)||false;Aq.call(this,Bb,Bj,BY);},downloadGridData:function J(Ba,Bb){var BZ={act:"gridIncrementalFetch",nodeKey:Ba.nodeKey,rowPosition:Ba.rowPosition,maxRows:Ba.maxRows,colPosition:Ba.colPosition,sliceId:Ba.sliceId,maxColumns:Ba.maxColumns,rowMode:Ba.rowMode||1,partialRetrieval:this.newRetrievalKeysConfig().addNode(Ba.nodeKey)};if(Ba.partialUpdate){BZ.partialUpdate=Ba.partialUpdate;}var BY=mstrmojo.all[Ba.xtabId],BX=BY&&BY.isCustomSort;this.submitUpdates(BZ,Bb,e.copy(X(),{noUpdate:true,preserveStid:BX,config:{silent:true}}));},txMarkRows:function AY(BX,BY){if(mstrApp&&mstrApp.isNativeAndroid){mstrMobileTransport.applyTransactionMarkRow(BX.nodeKey,BX.sliceId,BX.rowOrdinal,BX.actionType);}else{Aq.call(this,{taskId:"markRow",rwb:this.rwb,nodeKey:BX.nodeKey,sliceId:BX.sliceId,rowOrdinal:BX.rowOrdinal,actionType:BX.actionType},BY);}},txChangeData:function AA(BX,BY){if(mstrApp&&mstrApp.isNativeAndroid){mstrMobileTransport.applyTransactionDataChange(BX.nodeKey,BX.sliceId,JSON.stringify(BX.cells),BX.autoRefresh);}else{Aq.call(this,{taskId:"changeData",rwb:this.rwb,nodeKey:BX.nodeKey,sliceId:BX.sliceId,cells:BX.cells,autoRefresh:BX.autoRefresh},BY);}},sendTransactionActions:function c(BY,BZ){var BX={taskId:"DocTransaction",rwb:this.rwb,keyContext:BY.keyContext,actions:BY.actions,messageID:this.msgId};if(BY.txrcd){BX.isPending=BY.txrcd.pending;BX.timestamp=BY.txrcd.timestamp;}Aq.call(this,BX,BZ,{silent:!!BZ});},newUpdate:function BC(BZ,BY){var BX=new mstrmojo.DocDataService.Update(BY);BX.ds=this;BX.cmd=BZ;return BX;},newUpdateWithoutCmd:function l(BY){var BX=new mstrmojo.DocDataService.Update(BY);BX.ds=this;return BX;},newRetrievalKeysConfig:function Ai(){return new mstrmojo.rw.model.RetrievalKeysConfig();},newUpdateKeysConfig:function R(){return new mstrmojo.rw.model.UpdateKeysConfig();},submitCmd:function BJ(BY,BX){this.newUpdate(BY,BX).submit();},submitUpdates:function Al(Bg,Bm,Bd){Bg=At(Bg);var Bc={actions:Bg},BX,Ba,Bj,BZ=false;V.forEach(Bg,function Bf(Bo){if(Bo.disablePU){BZ=true;delete Bo.disablePU;}V.forEach(Bo.actions,Bf);return !BZ;});if(!BZ){var BY=mstrmojo.rw.model.RetrievalKeysConfig.getConsolidatedConfig(Bg),Bl=mstrmojo.rw.model.UpdateKeysConfig.getConsolidatedConfig(Bg);if(!e.isEmpty(BY)){Bc.partialRetrieval=BY;}if(!e.isEmpty(Bl)){Bc.partialUpdate=Bl;}}if(Bd){BX=Bd.style;Ba=Bd.config;Bj=Bd.params;}if(!Ba){Ba={showProgress:true,hideProgress:true,progressStateText:AQ};}if(!BX){Bc.style=this.defaultStyle;}else{var Bn=Bc.style=e.clone(this.defaultStyle);B(BX.params,Bn.params);}Bc.style.name=(BX&&BX.name)||mstrApp.styleName;var Be={taskId:"mojoRWManipulation",rwb:this.rwb,messageID:this.msgId,stateID:-1,params:JSON.stringify(Bc)};B(Bj,Be);Ba.preserveUndo=(Bd&&Bd.noUpdate)||false;Ba.preserveStid=(Bd&&Bd.preserveStid)||false;var Bi=this,Bk=true,Bb=AB.override({success:function(Bo,Bp){if(Bo.status===2){Bk=false;Bi.submitUpdates([],Bm,Bd);}else{Bk=true;return this._super(Bo,Bp);}},complete:function(){if(this._super&&Bk){this._super();}}},B(Bm));if(!(Bd&&Bd.hideCancel)){Ba.waitBoxCfg=e.copy({showCancel:true},Ba.waitBoxCfg);}if(Bd&&Bd.message){Ba.waitBoxCfg=e.copy({message:Bd.message},Ba.waitBoxCfg);}var Bh=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();if(Bd&&Bd.resolveOnly!==undefined){Be.resolveOnly=Bd.resolveOnly;}else{if(Bh){Be.resolveOnly=true;}}if(Bd&&Bd.excludeData!==undefined){Be.excludeData=Bd.excludeData;}else{if(Bh){Be.excludeData=true;}}if(Bd&&Bd.noDeltaXML!==undefined){Be.noDeltaXML=Bd.noDeltaXML;}if(Be.resolveOnly&&Be.excludeData){mstrApp.enableUpdate=true;}Aq.call(this,Be,Bb,Ba);},submitTemplateUpdates:function AD(BX,BZ,Ba,BY){this.submitUpdates(this.getUpdateTemplateAction(BX,BZ),Ba,BY);},getUpdateTemplateAction:function Af(BX,BZ,BY){return{act:"updateTemplate",keyContext:BX,partialRetrieval:this.newRetrievalKeysConfig().addNode(BX,BY),partialUpdate:{selectors:BZ.selectors},actions:At(BZ)};},addUpdateTemplateAction:function BP(BZ,BX,BY){BZ.addActions(this.getUpdateTemplateAction(BX,BY));},applySegment:function AV(BY,BX,BZ){Aq.call(this,{taskId:"applySegment",rwb:this.rwb,segmentID:BY,nodeKey:BX},BZ);},getPageByTree:function AX(BX){mstrApp.serverRequest({taskId:"getPageByTree",msgID:this.msgId},BX);},getUserDICubeInfo:function a(BX,BY){Aq.call(this,{taskId:"getUserDICubeInfo",cubeIds:BX.join(",")},BY);},applySorts:function BB(BY,BZ,BX,Ba){Aq.call(this,{taskId:"applySorts",key:BY,sortType:BZ,sortList:BX},Ba,mstrmojo.DocDataService.PROGRESS_CONFIG);},getAddNewDerivedMetricToDatasetSubmitFunc:function A8(BY){var BX=this;return function(Bb){var Bc=BX.model,Ba=Bc.controller,BZ=e.copy(Bb,BY),Bd=[Ap.call(BX,BZ,true)],Be=Bc.getDatasetsUpdateCallback();if((BZ.mptf||{}).dirty||this.enablePTO){Bd.push(AM(BZ));}Ba.submitUndoRedoUpdates(Bd,null,Be,{style:{params:{treesToRender:1}}});};},getAddNewDerivedMetricToXtabSubmitFunc:function Ax(BY){var BX=this;return function(Bc){var Bd=BX.model,Bb=Bd.controller,Ba=e.copy(Bc,BY),BZ=Ba.idx,Bf=[],Bg=AB.wrapMethods(Bd.getDatasetsUpdateCallback(),Bb._getXtabCallback(Ba.host));Bf.push(Ap.call(BX,Ba,true));if((Ba.mptf||{}).dirty||this.enablePTO){Bf.push(AM(Ba,true));}if(Ba.replace){Bf.push(BX.getUpdateTemplateAction(Ba.nodeKey,[Ba.host.model.getRemoveTemplateUnitAction({did:Ba.replace.did,t:Ba.replace.t})]));}else{BZ++;}var Be=BX.getUpdateTemplateAction(Ba.nodeKey,[Ba.host.model.getAddTemplateUnitAction({did:"$GUID_135",t:4},Ba.dsid,Ba.zoneid,BZ),{act:"renameUnit",id:"$GUID_135",type:4,name:Ba.alias,isDynamicAlias:false}]);Bf.push(Be);Bb.submitUndoRedoUpdates(Bf,null,Bg);};},getAddNewDerivedMetricToDropzoneSubmitFunc:function AJ(BY){var BX=this;return function(Be){var Bf=BX.model,Bg=Bf.controller,Bi=e.copy(Be,BY),Bk=Bi.host.zonesModel,Bl=Bi.idx,Bd=[],BZ=[],Bj={id:Bi.zoneid},Bh={did:"$GUID_135",t:4},Bm=AB.wrapMethods(Bf.getDatasetsUpdateCallback(),Bg._getXtabCallback(Bi.host));Bd.push(Ap.call(BX,Bi,true));if((Bi.mptf||{}).dirty||this.enablePTO){Bd.push(AM(Bi));}if(Bi.replace){var Bb={did:Bi.replace.did,t:Bi.replace.t};Array.prototype.push.apply(BZ,Bk.getRemoveDropZoneUnitActions(Bj,Bb));}else{Bl++;}BZ.push(Bk.getAddDropZoneUnitAction(Bj,Bh,Bl,{datasetId:Bi.dsid}));if(Bi.extraZone){BZ.push(Bk.getAddDropZoneUnitAction({id:Bi.extraZone.id},Bh,Bi.extraZone.idx,{datasetId:Bi.dsid}));}if(!Bi.replace){var Ba=(BY.zoneid===4)?1:2,Bc=Bk.getAddMetricNameAction(BY.host,Ba);if(Bc){Bd.push(Bc);}}if(!Bi.replace&&Bk.gmZones){Bc=Bk.gmZones.getUpdateGroupInfoActionForNewMetric(BY.zoneid,Bl,true);if(Bc){Bd.push(Bc);}}Bk.checkAndAddThresholdAction(Bi.zoneid,Bh,BZ);Bd.push(BX.getUpdateTemplateAction(Bi.nodeKey,BZ));Bg.submitUndoRedoUpdates(Bd,null,Bm);};},getEditDerivedMetricSubmitFunc:function k(BY){var BX=this;return function(Bb){var Bd=BX.model,Ba=Bd.controller,BZ=e.copy(Bb,BY),Bc=BY.nodeKey,Be={act:"editDM",formula:BZ.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(BZ.tokenStreamXML),afb:BY.afb,sfb:BY.sfb,dsid:BZ.dsid||"",did:BZ.did},Bf=[Bd.addUpdateObjects(Be,{id:BZ.did,type:4,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE})],Bg=AB.wrapMethods(Bd.getDatasetsUpdateCallback(),Ba.getPartialUpdateCallback());if(mstrApp.isSingleTier&&BY.originTokenStream){Be.originFormula=BY.originTokenStream;Be.originAfb=BY.originAfb;Be.originSfb=BY.originSfb;}if((BZ.mptf||{}).dirty){Bf.push(AM(BZ));}if(Bc){Bf.push(BX.getUpdateTemplateAction(Bc,[{act:"renameUnit",id:BZ.did,type:4,name:BZ.alias,isDynamicAlias:false}]));}else{Be.name=BZ.alias;}Ba.submitUndoRedoUpdates(Bf,null,Bg,{style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH}}});};},resetSelections:function BF(BY,BX,BZ){Aq.call(this,{taskId:"resetSelections",rwb:this.rwb,unitKeyContext:BY||"",usePartDisplay:BX?"0":"1",treesToRender:BX?3:2},BZ);},setPreference:function F(BX,BY){Aq.call(this,{taskId:"setPreference",prefs:BX},BY);},getObjectInfo:function Ad(BX,BY){Aq.call(this,B(BX,{taskId:"getObjectInfo"}),BY,X());},addSuppressData:function A2(BX){if(BS(BX)===mstrmojo.DocDataService.EnumTreesToRender.NONE){e.copy({params:{suppressData:true}},BX);}},uploadImageToServer:function(BZ,Ba){var BY={taskId:"importImage",imageFieldName:"imageData",isEdit:1,fieldKey:BZ.fieldKey,fieldName:BZ.fieldName,imageName:encodeURIComponent(BZ.imageName),imageSize:BZ.imageSize,nodeKey:BZ.nodeKey,sectionKey:BZ.sectionKey,msgID:this.msgId||""};if(mstrApp.isSingleTier){var BX=";base64,";BY.rwNodeKey=BZ.fieldGroupKey;BY.imageData=BZ.base64Str.split(BX)[1]||BZ.base64Str;mstrApp.serverRequest(BY,Ba);}else{BY.imageData=BZ.imageData;mstrmojo.xhr.upload("POST",mstrConfig.taskURL,Ba,BY);}}});mstrmojo.DocDataService.Update=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.DocDataService.Update",actions:null,callback:null,extras:null,init:function An(BX){B(BX,this);this.actions=this.actions||[];this.callback=this.callback||{};this.extras=this.extras||{};},addActions:function Ah(BX){this.actions=this.actions.concat(At(BX));},addCallbacks:function A4(BX){this.callback=AB.wrapMethods(this.callback,BX);},addExtras:function Ab(BY){var BX=BS(BY),BZ=BS(this.extras);this.extras=B(BY,this.extras);if(BX!==undefined&&BZ!==undefined){this.extras.style.params.treesToRender|=BZ;}},addUpdate:function Ae(BX){this.add(BX.actions,BX.callback,BX.extras);},setTreesToRender:function BW(BX){if(BX){this.addExtras({style:{params:{treesToRender:BX}}});}return this.extras.style.params.treesToRender;},add:function b(BY,BZ,BX){if(BY){this.addActions(BY);}if(BZ){this.addCallbacks(BZ);}if(BX){this.addExtras(BX);}},submit:function AE(){var BY=this.actions,BZ=this.callback,BX=this.extras;if(this.cmd){this.cmd.submit(BY,BZ,BX);}else{this.ds.submitUpdates(BY,BZ,BX);}}});mstrmojo.DocDataService.PUInfoType=null;mstrmojo.DocDataService.ExtrasType=null;mstrmojo.DocDataService.PROGRESS_CONFIG={showProgress:true,hideProgress:true,progressStateText:AQ,delay:true};mstrmojo.DocDataService.UNDO_KEY="undo";mstrmojo.DocDataService.REQUEST_DEFN_DATA={style:{params:{treesToRender:3}}};mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION={style:{params:{treesToRender:1}}};mstrmojo.DocDataService.REQUEST_ONLY_DATASETS={style:{params:{treesToRender:0}}};mstrmojo.DocDataService.SUPPRESS_DATA={params:{suppressData:true}};mstrmojo.DocDataService.RAPID_EXEC={params:{suppressData:true,rapidExec:true}};mstrmojo.DocDataService.EMPTY_CALLBACK={success:mstrmojo.emptyFn};mstrmojo.DocDataService.CopyMoveDestinationType=null;mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS={FORMAT_CHANGE:1,DATA_CHANGE:2};mstrmojo.DocDataService.EnumTreesToRender={NONE:0,DEFN:1,DATA:2,BOTH:3};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.taphold");var A=false,Q=mstrmojo.dom,V=16;mstrmojo._HasContextMenu=mstrmojo.provide("mstrmojo._HasContextMenu",{cm:null,cmPos:null,itemField:"n",itemIdField:"did",itemChildrenField:"items",dynamicUpdate:false,queryChecked:function(W){return false;},queryEnabled:function(W){return true;},queryVisible:function(W){return true;},executeCommand:function P(W){},item2textCss:function E(W){return W.cssClass||W.cmdId||("cmd"+W[this.itemIdField]);},showContextMenu:function J(){if(!A){mstrmojo.requiresCls("mstrmojo.ContextMenu");A=true;}var c=this._subMenu,a=this.getMenuPosition();if(!c){var e=(this.menuZIndex||this.zIndex||10)+1,Y={left:a.x+"px",top:a.y+"px",zIndex:e,visible:false,dynamicUpdate:this.dynamicUpdate,itemField:this.itemField,itemIdField:this.itemIdField,itemChildrenField:this.itemChildrenField,_cmSource:this.getContextMenuSource(),items:this.getContextMenuItems(),cssClass:this.getContextMenuCssClass(),placeholder:document.body.appendChild(document.createElement("div")),parent:this};c=new mstrmojo.ContextMenu(Y);c.render();this._subMenu=c;}else{c.set("left",a.x+"px");c.set("top",a.y+"px");}if(this.dynamicUpdate){var X=c.ctxtBuilder.itemWidgets,Z=X&&X.length,W,b,d=this.getContextMenuSource();for(W=0;W<Z;W++){b=X[W];if(d.queryVisible){b.set("visible",d.queryVisible(b.data));}if(d.queryChecked){b.set("checked",d.queryChecked(b.data));}if(d.queryEnabled){b.set("enabled",d.queryEnabled(b.data));}}}c.set("visible",true);this.callOnContextMenuOpen();this.adjustMenuPosition();this.attachMousedownEvent();},hideContextMenu:function I(){var W=this._subMenu;if(W&&W.visible){this._subMenu.set("visible",false);this.callOnContextMenuClose();}},adjustMenuPosition:function O(){var W=this._subMenu,Z=this._subMenu.domNode,Y=Z.offsetHeight,X=Z.offsetWidth,c=Q.windowDim(),b=Q.position(Z,false),a=Q.position(Z,true);if((b.x+X+V)>c.w){W.set("left",(c.w-X-V+(a.x-b.x))+"px");}if((b.y+Y+V)>c.h){W.set("top",(c.h-Y-V+(a.y-b.y))+"px");}},attachMousedownEvent:function M(){var W=this;if(!this._close_handler){this._close_handler=function(X){W.closeMenuHandler(X);};}Q.attachEvent(document.body,"mousedown",this._close_handler);},closeMenuHandler:function R(W){if(!this.isOnMySubmenu(Q.eventTarget(self,W))){this.closeMenuTree();}},isOnMySubmenu:function N(a){var X=this._subMenu;if(!X){return false;}if(Q.contains(X.domNode,a,true,document.body)){return true;}var b=X.ctxtBuilder.itemWidgets,W=b&&b.length,Z,Y;for(Z=0;Z<W;Z++){Y=b[Z];if(Y.isOnMySubmenu(a)){return true;}}return false;},oncmChange:function K(){delete this._subMenu;},callOnContextMenuOpen:function D(){if(this.onContextMenuOpen){this.onContextMenuOpen();}},callOnContextMenuClose:function C(){if(this.onContextMenuClose){this.onContextMenuClose();}},getContextMenuItems:function U(){return this.cm;},getContextMenuCssClass:function B(){return this.cmCssClass||"";},getContextMenuSource:function H(){return this;},getMenuPosition:function F(){if(this.cmPos){return this.cmPos;}var W=Q.position(this.domNode,true);return{x:Math.round(W.x),y:Math.round(W.y+W.h)};},isSeparatorItem:function G(W){return W[this.itemIdField]===-1||W[this.itemField]==="-";},hasSubmenu:function L(W){return !!W[this.itemChildrenField];},closeMenuTree:function S(Y){var X=this.activeMenuItem,W=this._cmSource||this;if(!X){if(Y){this.activeMenuItem=Y;}else{W.hideContextMenu();}return ;}if(X===Y){return ;}if(Y){this.activeMenuItem=Y;if(Y.parent.parent===X){return ;}if(Y.parent===X.parent){X.hideContextMenu();return ;}}else{Y=W;this.activeMenuItem=null;}X.hideContextMenu();while(X!==W){X=X.parent.parent;if(X!==Y||W===Y){X.hideContextMenu();if(W===Y){Q.detachEvent(document.body,"mousedown",this._close_handler);}}if(X.parent===Y.parent){break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo.Binding","mstrmojo._HasBindings","mstrmojo._HasMarkup","mstrmojo._HasTooltip","mstrmojo.css");mstrmojo.Widget=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasBindings,mstrmojo._HasMarkup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.Widget",domNode:null,hasRendered:false,visible:true,enabled:true,tooltip:"",cssClass:"",cssText:"",cssDisplay:"block",slot:"",alias:"",parent:null,init:function A(C){this._super(C);var D=this.parent;if(!D||D.hasInitBindings){this.initBindings();}},destroy:function B(C){if(this.hasRendered){this.unrender(C);}if(this.bindings){this.destroyBindings();}this._super();},invalidate:mstrmojo.emptyFn,widgetResized:mstrmojo.emptyFn});mstrmojo.Widget.cssTextMarkupMethod=function(){this.domNode.style.cssText=this.cssText||"";};mstrmojo.Widget.visibleMarkupMethod=function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";};mstrmojo.Widget.topMarkupMethod=function(){var C=this.top;if(C){this.domNode.style.top=C;}};mstrmojo.Widget.leftMarkupMethod=function(){var C=this.left;if(C){this.domNode.style.left=C;}};mstrmojo.Widget.heightMarkupMethod=function(){var C=this.height;if(C){this.domNode.style.height=C;}this.widgetResized();};mstrmojo.Widget.widthMarkupMethod=function(){var C=this.width;if(C){this.domNode.style.width=C;}this.widgetResized();};mstrmojo.Widget.enabledMarkupMethod=function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);};}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var D=1,B="mstrmojo-itemwrap";mstrmojo.ListMapperHoriz=mstrmojo.provide("mstrmojo.ListMapperHoriz",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table" cellspacing="0" cellpadding="0"><tbody><tr>',markupSuffix:"</tr></tbody></table>",itemWrapperPrefix:function(H){return'<td class="'+this.getWrapperCss(H)+'">';},getWrapperCss:function(H){return"mstrmojo-itemwrap-td";},itemWrapperPrefill:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",itemWrapperSuffix:"</td>",wrapperNodes:function G(H){return this.wrapperParentNode(H).cells;},wrapperParentNode:function F(H){return H.firstChild.rows[0];},createWrapperNode:function E(H){var I=H.ownerDocument,J=I.createElement("td");return J;},findScrollRange:function C(V,L,S,Y,I,P,Z,X){var Q=this.wrapperNodes(V),R=parseInt(L/2,10),K=parseInt(Math.log(L)/Math.log(2),10),J=0,H=L-1,U=I+P,M=Q[0].offsetLeft,O;for(var W=1;W<=K;W++){O=Q[R].offsetLeft-M+Z;if(O<=I){J=R;}else{if(O>=U){H=R;}}var N=Math.round(L/Math.pow(2,W+1));R+=(O>I)?-N:N;R=Math.min(Math.max(0,R),L-1);}return{start:J,end:H};},findIndex:function A(I,M,K){if(M&&K){var H=I.domNode,L=this.wrapperParentNode(M),J=K.parentNode;while(J){if(J===L){return mstrmojo.array.findBin(this.wrapperNodes(M),K,"offsetLeft",I.items&&I.items.length);}else{if(J===H){break;}}K=J;J=K.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.WidgetListBuilder");mstrmojo.WidgetTreeBuilder=mstrmojo.provide("mstrmojo.WidgetTreeBuilder",mstrmojo.mixin({newContext:function A(B){var D=this._super(B);if(!B.itemFunction&&D.itemFunc){var C=D.itemFunc;D.itemFunc=function(G,F,H){var E=C(G,F,H);if(E){E.tree=H.tree||H;}return E;};}return D;}},mstrmojo.hash.copy(mstrmojo.WidgetListBuilder)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.DI.model.HistoryList=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.model.HistoryList",hasSentToHistoryList:false,canSendToHistoryList:false});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(U){var V=U.callback;if(V.submission){V.submission(U.id,this.userInteractionRequired(U),U);}this.submitRequest(U);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(e,b,V,W){if(V){this.cancelRequests();}var Y=this.id,Z=this.transport,U=mstrmojo.now()+b.taskId+P++,X=e.canceled||mstrmojo.emptyFn;e.canceled=function(f){X();e.complete(true);return Z.cancelRequest(f);};e=mstrmojo.func.wrapMethods(e,{complete:function(f){mstrmojo.all[Y]&&mstrmojo.all[Y].deleteRequest(f);}});var a=!K.isEmpty(this._requests),c=this.createRequest(U,e,b,W),d=(L||a)&&!W.doNotHold;if(d){F.push(c);}else{I.call(this,c);}return U;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(W,Y,X,U){var V=this._requests;if(!V){V=this._requests={};}V[W]={id:W,callback:Y,params:X,config:U};return V[W];},submitRequest:function M(U){this.transport.serverRequest(this.id,U.id,U);},cancelRequests:function S(){var U=false;K.forEach(this._requests,function(V){if(V.gotResponse===undefined){U|=V.callback.canceled(V.id);}});this._requests={};F=[];return U;},cancelRequest:function B(Y){var V=false,X=this._requests[Y],W,U=F.length;for(W=0;W<U;W++){if(F[W]===X){break;}}if(W<U){F.splice(W,1);delete this._requests[Y];V|=X.callback.canceled(X.id);}return V;},response:function A(Y,U,W){$MAPF(false,"AndroidServerTransport","transportRequest");var X=this.getRequest(Y);if(X){X.gotResponse=true;var Z=X.callback,V=(U&&!W.mstrerr)?"success":"failure";try{if(Z[V]){Z[V](W,X);}}finally{Z.complete(Y);}}G.call(this);},deleteRequest:function N(V){var U=this._requests;delete U[V];},getRequest:function H(V){var U=this._requests;return U&&U[V];},userInteractionRequired:function C(U){return false;},addLoadingGraph:function D(U){J[U]=true;L=true;},removeLoadingGraph:function R(U){delete J[U];if(K.isEmpty(J)){L=false;G.call(this);}},_serverRequestParallel:function(V,X,Y,U){var W=U||new mstrmojo.SimpleXHR();W.request("POST",V,{success:function(Z){if(Y.success){Y.success(Z);}},failure:function(Z){if(Y.failure){Y.failure({code:Z.getResponseHeader("X-MSTR-TaskErrorCode"),message:Z.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(Y.complete){Y.complete();}}},X);},serverRequestParallel:function(V,W,U){this._serverRequestParallel(mstrConfig.taskURL,V,W,U);},upload:function(a,Z,Y,V,X,W,U){mstrmojo.xhr.upload("POST",mstrConfig.taskURL,a,Z,Y,V,X,W,U);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIRemoteProjectDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRemoteProjectDBRole",init:function D(F){var E=this.mdDBRole;E.n="Project Source Name";E.des="Remote project source name";E.dbr_type="5";E.stp=7424;E.owned="1";E.writable="1";E.tp=5;E.db_type=5;E.db_version=218;E.dbms="00000000000000000000000000000000";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:5,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.EnumColumnDataTypes","mstrmojo.warehouse.EnumObjectTypes");var F=mstrmojo.string,C=mstrmojo.warehouse.EnumObjectTypes.COLUMN,A=mstrmojo.desc(11428,"[unknown]");function E(H){var G=mstrmojo.architect.EnumColumnDataTypes;return("["+G[H].n+"]"||A);}mstrmojo.architect.obj.Column=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.Column",init:function D(G){this._super(G);var I,H;if(G){if(G.dbInfo){I=G.dbInfo;this.cln=F.decodeHtmlString(I.cln).replace(/&apos;/g,"'");this.cmid=I.cmid;this.sta=parseInt(I.sta,10);this.dt={tp:I.dt.tp,ps:I.dt.prec,sc:I.dt.scl};this.n=this.cln+": "+this.getDataTypeName();}else{if(G.tableInfo){I=G.tableInfo;H=I.def;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid=I.did;this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}else{if(G.colDef){H=G.colDef;this.cln=F.decodeHtmlString(H.cln).replace(/&apos;/g,"'");this.cmid="";this.dt={tp:H.dt.tp,ps:H.dt.ps,sc:H.dt.sc};this.n=this.cln;}}}}},cln:undefined,n:undefined,tp:C,t:C,cmid:undefined,def:undefined,dt:undefined,getDataTypeName:function B(){return E(this.dt.tp);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380);var E=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIDirectAccessController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDirectAccessController",shouldAskUser:true,confirmDDA:true,canSupportDDA:function C(I){var M=mstrApp.getRootController().model,K=true,N=-1,P=-1,J=-1,L,R=E.sourceSubtype,Q,O=M.getAllTableID().length;if(M.connectLiveSupport===E.connectLiveSupport.connectLiveSupportInMemoryOnly&&O>0){K=false;}else{mstrmojo.hash.forEach(M.importSources,function(S){Q=S.subtype;if(Q===R.googleBigQueryFFSQL||Q===R.googleBigQuerySingleTable){Q=R.googleBigQuery;}if(M.isSupportedDDASource(Q)){if(N===-1){N=Q;}else{if(N!==Q){K=false;return false;}}switch(N){case R.hanaSingleTable:case R.querybuilder:case R.searchOnSource:case R.mdx:if(P===-1){P=S.dbrid;}else{if(P!==S.dbrid){K=false;return false;}}break;case R.googleBigQuery:L=S.sourceInfo;if(J===-1){J=L.said;}else{if(J!==L.said){K=false;return false;}}break;default:break;}}else{K=false;return false;}});if(I){I.dbrid=(P===-1?undefined:P);}if(M.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportInMemoryOnly||O===0){K=true;}}return K;},shouldSupportDDA:function D(){var I=mstrApp.getRootController().model;var J=false;if(I.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportUnknown){if(I.connectLiveSupport===E.connectLiveSupport.connectLiveSupportDDAOnly){J=true;}}else{mstrmojo.hash.forEach(I.importSources,function(K){if(I.isDDAOnlySource(K.subtype)||(K.xdaType===E.xdaType.qbSingleTable&&K.databaseType===4000)){J=true;}});}return J;},onToggleDDA:function A(J){var I=mstrApp.getRootController();if(J===true){I.model.set("isDirectDataAccess",true);if(!this.canSupportDDA()){I.displayError(mstrmojo.desc(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),false);I.model.set("isDirectDataAccess",false);}}else{I.model.set("isDirectDataAccess",false);if(this.shouldSupportDDA()){I.displayError(mstrmojo.desc(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this."),false);I.model.set("isDirectDataAccess",true);}}},askUserAboutDDA:function G(I){if(I){this.shouldAskUser=false;}return this.shouldAskUser;},checkIfDDA:function H(K){var I=mstrApp.getRootController();var J=I.model,L;if(J.isDirectDataAccess){return true;}if(J.operationMode===E.operationMode.edit){if(K){for(L=0;L<K.cn;L++){if(K.cube[L].cube_id===J.cubeID&&K.cube[L].sz===undefined&&this.canSupportDDA()){return true;}}}}return false;},getDDACheckboxID:function F(){var I=mstrApp.getRootController().rootView.footer.ddaCheckbox;return I?I.id:"";},setDirectDataAccess:function B(I){mstrApp.getRootController().model.set("isDirectDataAccess",I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.hash");mstrmojo.requiresDescs(96,198,5720,10399,10492,11960,12676,12677,12678,12955,12957,12958,12960,12961,12962,12963,12964,12965,12966,12967,12968,13096,13097,14193,16038);var Ao=mstrmojo.hash;var e=mstrmojo.DI.DIConstants.sourcesInfoFlags;var Ar=mstrmojo.desc(12676,"Fetching files...");var Ad=mstrmojo.desc(12677,"Fetching Cube Information...");var Ah=mstrmojo.desc(5720,"Waiting...");var Q=mstrmojo.desc(10492,"Saving...");var AC=mstrmojo.desc(14193,"Searching Data...");var Ak=mstrmojo.DI.DIConstants;function Ab(BB,BA,A8,A9){mstrApp.serverRequest(BA,BB,A8,undefined,undefined,undefined,undefined,A9);}mstrmojo.DI.DIDataService=mstrmojo.declare(mstrmojo.Obj,null,{messageID:"",emmaIRRMessageID:"",archSpark:function u(BA,A9,A8){Ab.call(this,BA,Ao.copy(A9,{taskId:"arch.spark"}),{showProgress:true,showProgressText:true,},A8);},deleteObject:function V(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"deleteObject"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(10399,"Deleting")});},renameObject:function V(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"renameObject"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13973,"Renaming")});},getCubeQuota:function P(BA,A9,A8){Ab.call(this,BA,Ao.copy(A9,{taskId:"qBuilder.GetQuota"}),A8||{showProgress:false,showProgressText:false,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});},getUserDICubeInfo:function b(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getUserDICubeInfo"}),{showProgress:false,showProgressText:false});},getDBMSObjects:function Z(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"arch.getDBObjects"}),{doNotHold:true,showProgress:false});},getExternalSourcesInfo:function As(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getDIExternalInfo"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});},getDIProjectSettings:function t(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getDIProjectSettings"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12957,"Fetching Data Import Settings...")});},getOAuthSourceReports:function Ay(BA,A9){var A8=e.getReports|e.getTokensInfo|e.getUserName;Ab.call(this,BA,Ao.copy(A9,{taskId:"qBuilder.FetchSourceObjects",flags:A8|(A9.flags||A8)}),{showProgress:true,showProgressText:true,progressText:Ar});},getHadoopFolderSize:function AX(BA,A9){var A8=e.getReports|e.getTokensInfo|e.getUserName;Ab.call(this,BA,Ao.copy(A9,{taskId:"qBuilder.FetchSourceObjects",flags:A8|(A9.flags||A8)}),{showProgress:false,showProgressText:false});},browseURLPath:function AK(BB,BA){var A9=1,A8;if(BA.flags){A8=BA.flags|A9;}else{A8=A9;}Ab.call(this,BB,Ao.copy(BA,{taskId:"qBuilder.FetchSourceObjects",flags:A8}),{showProgress:true,showProgressText:true,progressText:Ar});},getShapeKeys:function A0(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getMapShapes",showWait:false}),{doNotHold:true,showProgress:false});},getWebServiceURL:function O(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"GetWebServiceURL"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12678,"Fetching Web Service URL for authorization...")});},getWebServiceCatalog:function c(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"GetWebServiceCatalog"}),{showProgress:true,showProgressText:true,progressText:Ar});},signOutOAuthSource:function o(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"qBuilder.FetchSourceObjects",flags:e.revokeSession}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12960,"Signing out...")});},importOAuthReport:function E(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"qBuilder.ImportSourceObject",flags:7}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12961,"Uploading data...")});},importURL:function AT(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"importFile",taskContentType:"json",taskEnv:"xhr",messageid:this.messageID}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12962,"Fetching data from the given URL...")});},importFile:function AI(A8,BA,A9){A8.submit(Ao.copy(A9,{taskId:"importFile",taskContentType:"json",taskEnv:"xhr",fileType:"application/octet-stream"}),BA,{showProgress:true,showProgressText:true,showCancel:true,onCancel:function(){mstrmojo.xhr.cancel();mstrApp.serverProxy.cancelFileReader&&mstrApp.serverProxy.cancelFileReader(A9.tableID);mstrApp.hideProgress();if(BA.cancel){BA.cancel();}},progressText:mstrmojo.desc(16038,"Uploading File #...").replace("#",A9.fileName)});},oneTierImportFile:function X(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"importFile"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")});},launchOneTierBrowser:function Ap(A8){window.FormWrapper.openFileDialog(A8);},launchOneTierUploader:function W(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"onetier.import"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(11960,"Loading Data...")});},createOneTierDoc:function Am(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"onetier.createVI"}),{showProgress:true,showProgressText:true,progressText:Ah});},handleMissingColumns:function An(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"recoverDataDiscoveryErrors",msgid:this.messageID}),{showProgress:true,showProgressText:false,progressText:""});},getImportedData:function d(BB,BA,A8){var A9;if(!BA.browsetype){BA.browsetype=mstrmojo.DI.DIConstants.browseFlag.dataPreview|mstrmojo.DI.DIConstants.browseFlag.reportBindingTable|mstrmojo.DI.DIConstants.browseFlag.reportLevelProperty;}if(BA.previewflag){BA.previewflag|=mstrmojo.DI.DIConstants.requestFlag.stateInfo;}if(!BA.bindingflag){A9=2;}else{A9=BA.bindingflag;}Ab.call(this,BB,Ao.copy(BA,{taskId:"qBuilder.GetReportXDADefinition",msgid:this.messageID,bindingflag:A9}),{showWait:true,showProgress:true,showProgressText:true,progressText:Ah});},editImportedData:function m(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"editCube",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:(A8.trans?mstrmojo.desc(12964,"Transforming data..."):Ad)});},loadProject:function A7(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getProjects"}),A9,{showProgress:true,showProgressText:true,progressText:(mstrmojo.desc(12965,"Fetching Projects Information..."))});},loginProject:function A7(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"login"}),A9,{showProgress:true,showProgressText:true,progressText:(mstrmojo.desc(12966,"Login Projects..."))});},changeMappings:function A1(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"qBuilder.RemapObject",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Q});},saveAndPublish:function n(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"saveAndPublishCube",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},saveAndPublishEMMA:function k(BE,BD,BB,BA){var BC=Ao.copy(BD,{taskId:"saveAndPublishCube",msgID:this.messageID});var A9=this;var A8={success:function(BF){if(BF.msgId){A9.messageID=BF.msgId;}mstrApp.getRootController().model.getHistoryList().set("canSendToHistoryList",true);}};if(BB){BB.saveParams=BC;BB.saveAsCallback=function(){return mstrmojo.func.wrapMethods(A8,BE,{});};if(!BB.visible){BB.open();}}else{Ab.call(this,mstrmojo.func.wrapMethods(A8,BE,{}),BC,BA||{showProgress:false});}},pollStatus:function At(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},pollEmmaStatus:function H(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"pollEmmaStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",msgID:this.messageID}),{showProgress:false});},fetchFolderContents:function Ac(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12967,"Fetching folder contents...")});},searchFolderContents:function AY(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:Ah});},fetchRemoteFolderContents:function p(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getFolderContentFromRemote",msgid:this.messageID,type:8,flags:268453447}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12967,"Fetching folder contents...")});},fetchRemoteFolderID:function a(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getFolderIDFromRemote",folderName:7,msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13096,"Fetching remote folder id...")});},getProjectsFromRemote:function AW(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getProjectsFromRemote",msgid:this.messageID,sessionState:mstrApp.sessionState}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(13097,"Fetching remote projects...")});},createEMMAReportInstance:function F(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DICreateEMMAReportInstance"}),{showProgress:true,showProgressText:true,progressText:Ah});},createEMMASourceTable:function Av(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DICreateEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},editEMMASourceTable:function Ai(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIEditEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:false});},removeEMMASourceTable:function j(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIRemoveEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:false});},persistCubeConfigInfo:function Ag(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIPersistCubeConfigInfo",msgid:this.messageID}),{showProgress:true,showProgressText:false});},startRefineStage:function AS(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIStartRefineStage",msgid:this.messageID}),{showProgress:true,showProgressText:false});},cancelRefineStage:function AD(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DICancelRefineStage",msgid:this.messageID}),{showProgress:true,showProgressText:false});},cancelAggFilter:function J(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIStartOrCancelAggFilterChange",msgid:this.messageID,cancel:1}),{showProgress:true,showProgressText:false});},autoMappingSourceTable:function AE(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIAutoMappingEMMASourceTable",msgid:this.messageID}),{showProgress:true});},autoMap:function h(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"qBuilder.AutoMapTables",msgid:this.messageID,showWait:true}),{showProgress:true,showProgressText:true,progressText:Ah});},prepareData:function A2(BC,BB,A9){var BA=this;var A8={success:function(BE){if(BE&&BE.msgid){BA.set("messageID",BE.msgid);}var BF=1;var BD=mstrmojo.desc(13196,"Prepare data ## of ### tables...").replace("###",BF).replace("##",BF);BA.taskByPollStatus(BC,BE,BD,{showWait:true},{hideCancel:A9});}};Ab.call(this,A8,Ao.copy(BB,{taskId:"DIDataPreparation",msgid:this.messageID,showWait:true}),{showProgress:true,showProgressText:true,progressText:Ah});},taskByPollStatus:function AJ(BE,A8,BC,BD,A9){var BB=this,BA="pollStatus";if(mstrApp.isSingleTier){BA="DIPollStatus";}Ab.call(BB,mstrmojo.DI.DIDataService.taskByPollStatusCb.call(BB,BE,A8,BC,BD,A9),{taskId:BA,resultSetType:3,threadId:A8.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",isAsync:true,msgid:BB.messageID},{},BD);},sendToHistoryList:function AL(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DISendToInbox",msgid:this.messageID}),{showProgress:true});},setDataImportInfo:function A6(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DISetDataImportInfo",msgid:this.messageID}),{showProgress:true});},changeMappingSourceTable:function R(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIChangeMappingEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},updateMappingSourceTable:function x(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"setCubeAttributeFormMapping",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},detectRelationshipSourceTable:function Af(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIDetectRelationshipEMMASourceTable",msgID:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},editRelationshipSourceTable:function l(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIEditRelationshipEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},saveEMMASchedule:function AN(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DISaveEMMASchedule",msgid:this.emmaIRRMessageID||""}),{showProgress:true,showProgressText:true,progressText:Ah});},getObjectSubscriptions:function A5(A9,A8){if(!A8){A8={};}if(A8.deliveryType===undefined){A8.deliveryType=16;}Ab.call(this,A9,Ao.copy(A8,{taskId:"GetObjectSubscriptions",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},getAvailableTriggers:function G(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getSchedules",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},getSubscriptionInfo:function Au(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetSubscriptionInfo",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},removeSubscription:function U(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"cancelSubscriptionsTask",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},getScheduleStatus:function Ax(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetScheduleStatus"}),{showProgress:true,showProgressText:true,progressText:Ah});},searchMetadata:function Aj(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"searchMetadata"}),{showProgress:false});},objectSearch:function w(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"objectSearch"}),{showProgress:false});},getAttributeForms:function AO(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getAttributeForms"}),{showProgress:false});},getAttributeGroupInfo:function Aq(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getCubeAttributeGroupInfo",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ad});},duplicateReportInstance:function S(BC,BB,A9){var BA=mstrApp.isFromVI?mstrApp.launchingApp:mstrApp,A8=!!(mstrConfig.resolveOnly||BA.isAppStatePause&&BA.isAppStatePause());Ab.call(this,BC,Ao.copy(BB,{taskId:"duplicateReportInstance",skipRebuild:A8}),A9||{showProgress:true,showProgressText:true,progressText:Ad});},changePartition:function AF(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIChangePartition",msgid:this.messageID,showWait:true}),{showProgress:false});},createEmmaIRRReportInstance:function N(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DICreateEmmaIRRReportInstance"}),{showProgress:true});},publishNonEmmaCube:function Al(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"reportExecute",styleName:" "}),{showProgress:true,showProgressText:true,progressText:Ah});},createEmmaIRRSourceTables:function AG(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DICreateEmmaIRRSourceTables",msgid:this.emmaIRRMessageID}),{showProgress:true});},editEmmaIRRSourceTable:function AV(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIEditEmmaIRRSourceTable",msgid:this.emmaIRRMessageID}),{showProgress:true});},deleteEmmaIRRSourceTable:function AU(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIDeleteEmmaIRRSourceTable",msgid:this.emmaIRRMessageID}),{showProgress:false});},getEmmaIRRAttributes:function q(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetEmmaIRRAttributes",msgid:this.messageID}),{showProgress:true});},setEmmaIRRFilter:function D(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DISetEmmaIRRFilter",msgid:this.emmaIRRMessageID}),{showProgress:true});},validateEmmaIRRAlternateSource:function L(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID}),{showProgress:true});},getSecurityFilter:function Aa(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetCubeSecurityFilter"}),{showProgress:true,showProgressText:true,progressText:Ad});},loadDBRoles:function AZ(A9,A8){Ab.call(this,A9,Ao.copy(A8,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances"}),{showProgress:true,showProgressText:true,progressText:Ah});},archSearch:function(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,sessionState:""}),{showProgress:true,showProgressText:true,progressText:Ah});},saveDBRole:function M(A9,A8){Ab.call(this,A9,Ao.copy(A8,{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",showWait:true}),{showProgress:true,showProgressText:true,progressText:Ah});},setDBRole:function K(A9,A8){Ab.call(this,A9,Ao.copy(A8,{msgid:this.messageID,taskId:"qBuilder.SetDBRole"}),{showProgress:true,showProgressText:true,progressText:Ah});},populateDBRoles:function AH(A9,A8){Ab.call(this,A9,Ao.copy(A8,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",skipSchemaIDCheck:true}),{showProgress:true,showProgressText:true,progressText:Ah});},getObjectFolder:function A4(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetObjectFolder"}),{showProgress:true,showProgressText:true,progressText:Ah});},deleteDBRole:function AH(A9,A8){Ab.call(this,A9,Ao.copy(A8,{skipSchemaIDCheck:true,taskId:"arch.deleteObject",objecttype:29}),{showProgress:true,showProgressText:true,progressText:Ah});},openMailClient:function AB(A8){if(mstrApp.isSingleTier){window.FormWrapper.mailService(A8);}else{mstrApp.openPage(A8);}},validateSource:function Az(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIValidateEmmaSourceTask",msgid:this.messageID}),{showProgress:true});},scrapeWiki:function AP(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"wikiScrapper"}),{showProgress:!(A8.shouldSuggest),showProgressText:true,progressText:AC});},toggleDatasetServeMode:function z(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIToggleDatasetServeMode",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},setPreference:function I(A9,A8){Ab.call(this,A9,Ao.copy(A8,{skipSchemaIDCheck:true,taskId:"setPreference"}),{showProgress:true,showProgressText:true,progressText:Ah});},updatePreferences:function AA(BB,A8,A9){var BA={taskId:"updatePreference"};if(A8){BA[A8]=A9;}Ab.call(this,BB,BA,{showProgress:true,showProgressText:true,progressText:Ah});},getPreferences:function AR(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getPreferences"}),{showProgress:true,showProgressText:true,progressText:Ah});},getProjectAttributeInfo:function A3(A9,A8){Ab.call(this,A9,Ao.copy(A8,{skipSchemaIDCheck:true,taskId:"GetProjectAttributeInfo"}),{showProgress:true,showProgressText:true,progressText:Ah});},clearRelationship:function g(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{taskId:"DIClearRelationshipEMMASourceTable",msgid:this.messageID}),{showProgress:true,showProgressText:true,progressText:Ah});},DISetURLWhiteListTask:function Y(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DISetURLWhiteListTask"}),{showProgress:true,showProgressText:true,progressText:Ah});},getImportFromCube:function Aw(BB,BA){var A9=this;var A8={success:function(BC){if(BC&&BC.msgid){A9.set("messageID",BC.msgid);}}};Ab.call(this,mstrmojo.func.wrapMethods(A8,BB,{}),Ao.copy(BA,{msgid:this.messageID,taskId:"DIImportFromCube"}),{showProgress:true,showProgressText:true,progressText:Ah});},DIManageHadoopGateway:function f(BA,A9,A8){Ab.call(this,BA,Ao.copy(A9,{taskId:"DIManageHadoopGateway"}),A8!==undefined?A8:{showProgress:true,showProgressText:true,progressText:Ah});},getObjectInfo:function AQ(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getObjectInfo"}),{showProgress:true,showProgressText:true,progressText:Ah});},getCustomConnector:function C(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"arch.getCustomConnector",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,sessionState:"",typeFilter:Ak.dbType.newConnector,uses:Ak.newConnectorDBMSId+",57"}),{showProgress:true,showProgressText:true,progressText:Ah});},deleteCustomDBMS:function B(A9,A8){Ab.call(this,A9,Ao.copy(A8,{skipSchemaIDCheck:true,taskId:"arch.deleteObject",objecttype:57}),{showProgress:true,showProgressText:true,progressText:Ah});},searchObjectName:function Ae(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"objectSearch",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",objectType:"776,779,8"}),{showProgress:true,showProgressText:true,progressText:Ah});},getPreConfigOauth:function(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"ResetOAuthPara",}),{showProgress:true,showProgressText:true,progressText:Ah});},getCubeQuotaByRestAPI:function(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"getCubeQuotaOfUser",}),{showProgress:false,showProgressText:false});},getCloudElementToken:function(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"DIGetCloudElementToken"}),{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(5720,"Waiting...")});},getSingleDBRole:function(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"qBuilder.GetSingleDBRole"}),{showProgress:false,showProgressText:false});},removeOrDuplicateRI:function A(A9,A8){Ab.call(this,A9,Ao.copy(A8,{taskId:"qBuilder.RemoveOrDuplicateRI"}),{showProgress:false,showProgressText:false});}});mstrmojo.DI.DIDataService.taskByPollStatusCb=function AM(BG,BI,BH,BE,BC,BA,A9){var BD=this;return{success:function BF(BL){if(BL.status==="1"||BL.status===1){mstrApp.hideWait(true);if(BG.success){if(BA==="arch.PollStatusCatalogAction"){BG.success(BL.response);}else{BG.success(BI);}}}else{if(BL.status==="2"||BL.status===2){BG.failure();mstrmojo.error({longDesc:JSON.parse(BL.response).message},null,{title:mstrmojo.desc(96,"Error")});}else{var BN=!!BH?true:BD.isPolling;BH&&mstrApp.showWait({showCancel:(BC&&BC.hideCancel)?false:true,message:BH,onCancel:function(){BN=false;mstrApp.hideWait(true);if(BG.canceled){BG.canceled(null,BI);}}});var BK=BC&&BC.waitTime;var BJ=BC&&BC.preTime;if(BK){var BM=BK;BK=BK+BJ;BK=BK>=5000?5000:BK;BJ=BM;}else{BK=1000;BJ=1000;}window.setTimeout(function(){if(BN){BD.taskByPollStatus(BG,BI,BH,BE,{waitTime:BK,preTime:BJ},BA);}},BK);}}},failure:function A8(BJ){BH&&mstrApp.hideWait(true);if(BG.failure){BG.failure(BJ);}},canceled:function BB(BJ){BH&&mstrApp.hideWait(true);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo._HasChildren","mstrmojo.Binding","mstrmojo._HasBindings");mstrmojo.Model=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasChildren,mstrmojo._HasBindings],{scriptClass:"mstrmojo.Model",init:function A(C){this._super(C);if(this.children){this.initChildren();}if(!this.parent){this.initBindings();}},destroy:function B(C){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(C);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(14723,14735);mstrmojo.Refine.RefineHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.RefineHelpers.completely=function(N,R){R=R||{};R.fontSize=R.fontSize||"16px";R.fontFamily=R.fontFamily||"sans-serif";R.promptInnerHTML=R.promptInnerHTML||"";R.color=R.color||"#000";R.hintColor=R.hintColor||"#aaa";R.backgroundColor=R.backgroundColor||"#fff";R.dropdownBackgroundColor=R.dropdownBackgroundColor||"#f3f3f4";R.dropDownBorderColor=R.dropDownBorderColor||"#aaa";R.dropDownZIndex=R.dropDownZIndex||"100";R.dropDownOnHoverBackgroundColor=R.dropDownOnHoverBackgroundColor||"#dadada";var C=document.createElement("input");C.type="text";C.spellcheck=false;C.style.fontSize=R.fontSize;C.style.fontFamily=R.fontFamily;C.style.color=R.color;C.style.backgroundColor=R.backgroundColor;C.style.width="100%";C.style.outline="0";C.style.border="0";C.style.margin="0";C.style.padding="0";var P=C.cloneNode();P.disabled="";P.style.position="absolute";P.style.top="0";P.style.left="0";P.style.borderColor="transparent";P.style.boxShadow="none";P.style.color=R.hintColor;P.style.visibility="hidden";C.style.backgroundColor="transparent";C.style.verticalAlign="top";C.style.position="relative";var F=document.createElement("div");F.style.position="relative";F.style.outline="0";F.style.border="0";F.style.margin="0";F.style.padding="0";var O=document.createElement("div");O.style.position="absolute";O.style.outline="0";O.style.margin="0";O.style.padding="0";O.style.border="0";O.style.fontSize=R.fontSize;O.style.fontFamily=R.fontFamily;O.style.color=R.color;O.style.backgroundColor=R.backgroundColor;O.style.top="0";O.style.left="0";O.style.overflow="hidden";O.innerHTML=R.promptInnerHTML;O.style.background="transparent";if(document.body===undefined){throw"document.body is undefined. The library was wired up incorrectly.";}document.body.appendChild(O);var K=O.getBoundingClientRect().right;F.appendChild(O);O.style.visibility="visible";O.style.left="-"+K+"px";F.style.marginLeft=K+"px";F.appendChild(P);F.appendChild(C);var D=document.createElement("div");D.style.position="absolute";D.style.visibility="hidden";D.style.padding="5px 0px";D.style.backgroundColor=R.dropdownBackgroundColor;D.style.borderWidth="1px";D.style.borderColor=R.dropDownBorderColor;D.style.borderStyle="solid";var A=document.createElement("div");A.style.position="relative";A.style.outline="0";A.style.margin="0";A.style.padding="0";A.style.textAlign="left";A.style.fontSize=R.fontSize;A.style.fontFamily=R.fontFamily;A.style.zIndex=R.dropDownZIndex;A.style.cursor="default";A.style.overflowX="hidden";A.style.whiteSpace="pre";A.style.overflowY="scroll";A.style.width=R.width+"px";var J=function(V,b){var c=[];var W=0;var Z=-1;var X=function(){this.style.backgroundColor="#e6e6e6";};var Y=function(){if(c.indexOf(this)===Z){this.style.backgroundColor=R.dropDownOnHoverBackgroundColor;}else{this.style.backgroundColor=R.dropdownBackgroundColor;}};var a=function(){U.hide();U.onmouseselection(this.__hint);};var U={hide:function(){b.style.visibility="hidden";},refresh:function(g,j){b.style.visibility="hidden";W=-1;V.innerHTML="";var e=(window.innerHeight||document.documentElement.clientHeight);var k=b.parentNode.getBoundingClientRect();var d=k.top-6;var f=e-k.bottom-6;c=[];var h;for(h=0;h<j.length;h++){if(j[h].toLowerCase().indexOf(g.toLowerCase())!==0){continue;}var l=document.createElement("div");l.style.color=R.color;l.style.padding="0px 0px 0px 9px";l.style.height="22px";l.style.lineHeight="22px";l.style.overflow="hidden";l.style.textOverflow="ellipsis";l.style.whiteSpace="nowrap";l.onmouseover=X;l.onmouseout=Y;l.onmousedown=a;l.title=l.__hint=j[h];l.innerHTML=mstrmojo.string.encodeHtmlString(j[h].substr(0,g.length),false,true)+mstrmojo.string.encodeHtmlString(j[h].substring(g.length),false,true);c.push(l);}for(h=0;h<c.length;h++){V.appendChild(c[h]);}if(c.length===0){return ;}if(c.length===1&&g===c[0].__hint){return ;}if(c.length<1){return ;}var m=22*9;if(f<m){b.style.top="";b.style.bottom=R.bottom+"px";}else{b.style.top=R.top+"px";b.style.bottom="";}V.style.maxHeight=m+"px";b.style.visibility="visible";},highlight:function(e){if(c.length===0){return ;}if(Z!==-1&&c[Z]){c[Z].style.backgroundColor=R.dropdownBackgroundColor;}c[e].style.backgroundColor=R.dropDownOnHoverBackgroundColor;Z=e;var f=c[e];var d=f.parentNode;if(f.offsetTop+f.clientHeight>d.scrollTop+d.clientHeight){d.scrollTop=f.offsetTop+f.clientHeight-d.clientHeight;}else{if(f.offsetTop<d.scrollTop){d.scrollTop=f.offsetTop;}}},move:function(d){if(b.style.visibility==="hidden"){return"";}if(W+d===-2||W+d===-1){W=c.length-1;}else{if(W+d===c.length){W=0;}else{W+=d;}}U.highlight(W);return c[W].__hint;},onmouseselection:function(){}};return U;};var M=J(A,D);M.onmouseselection=function(U){C.value=P.value=G+U;H.onChange(C.value);B=C.value;setTimeout(function(){C.focus();P.scrollLeft=C.scrollLeft;},0);};D.appendChild(A);F.appendChild(D);N.appendChild(F);var I;var G;function L(U){if(I===undefined){I=document.createElement("span");I.style.visibility="hidden";I.style.position="fixed";I.style.outline="0";I.style.margin="0";I.style.padding="0";I.style.border="0";I.style.left="0";I.style.whiteSpace="pre";I.style.fontSize=R.fontSize;I.style.fontFamily=R.fontFamily;I.style.fontWeight="normal";document.body.appendChild(I);}I.innerHTML=String(U).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return I.getBoundingClientRect().right;}var H={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(U){U.preventDefault();U.stopPropagation();},onTab:function(){},onChange:function(){H.repaint();},startFrom:0,options:[],wrapper:F,input:C,hint:P,dropDown:A,prompt:O,setText:function(U){P.value=U;C.value=U;},getText:function(){return C.value;},hideDropDown:function(){M.hide();},repaint:function(){var a=C.value;var Z=H.startFrom;var V=H.options;var U=V.length;var Y=a.substring(Z);G=a.substring(0,Z);P.value="";for(var X=0;X<U;X++){var W=V[X];if(W.toLowerCase().indexOf(Y.toLowerCase())===0){break;}}A.parentNode.style.left=L(G)-R.left+"px";M.refresh(Y,H.options);B=a;}};var B;var Q=function(U,X){B=U.value;var V=function(){var Y=U.value;if(B!==Y){B=Y;X(Y);}P.scrollLeft=C.scrollLeft;};var W=function(){P.value="";};if(U.addEventListener){U.addEventListener("input",V,false);U.addEventListener("keyup",V,false);U.addEventListener("change",V,false);U.addEventListener("blur",W,false);}else{U.attachEvent("oninput",V);U.attachEvent("onkeyup",V);U.attachEvent("onchange",V);U.attachEvent("onblur",W);}};Q(C,function(U){H.onChange(U);});var S=function(X){X=X||window.event;var W=X.keyCode;var Y,U;if(X.keyCode===17){return ;}if(W===33){return ;}if(W===34){return ;}if(W===27){M.hide();P.value=C.value;C.focus();return ;}if(W===39||W===35||W===9){if(W===9){X.preventDefault();X.stopPropagation();if(P.value.length===0){H.onTab();}}if(P.value.length>0){var V=(A.style.visibility==="hidden");if(!V){M.hide();}if(C.value!==P.value){C.value=P.value;}Y=B!==C.value;B=C.value;if(Y){H.onChange(C.value);}}return ;}if(W===13){if(P.value.length===0){return ;}else{var V=(A.style.visibility==="hidden");if(!V){M.hide();}if(V){P.value=C.value;C.focus();H.onEnter(X);return ;}C.value=P.value;Y=B!==C.value;B=C.value;if(Y){H.onChange(C.value);}X.preventDefault();X.stopPropagation();}return ;}if(W===40){U=M.move(+1);if(U===""){H.onArrowDown();}P.value=G+U;return ;}if(W===38){U=M.move(-1);if(U===""){H.onArrowUp();}P.value=G+U;X.preventDefault();X.stopPropagation();return ;}if(C.value===""&&(W===8)||(W===46)){return ;}P.value="";};var E=function(){this.parentNode.childNodes[1].scrollTop=this.scrollTop;};if(C.addEventListener){C.addEventListener("keydown",S,false);C.addEventListener("scroll",E,false);}else{C.attachEvent("onkeydown",S);C.attachEvent("scroll",E);}return H;};mstrmojo.Refine.RefineHelpers.confirmFilldownOrBlankdown=function(F,C){var D=mstrmojo.desc(14723,'The column is going to be "fill down" or "blank down" using the data order of the random sample in the preview page. When the dataset is eventually published, the entire table in the correct order will be utilized by the wrangler to populate the correct "fill down" or "blank down" values in the final in-memory dataset'),B=mstrmojo.desc(14735,"Warning: Final table data may differ from current preview due to Fill Down / Blank Down operation."),A=mstrmojo.desc(12537,"Data Import");var E=mstrApp.getRootController();if(F){E.displayError(B,false,D,F,A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.StepperContentProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.StepperContentProvider",item:null,renderer:null,min:null,max:null,interval:1,minField:"min",maxField:"max",maxLengthField:"maxLength",valField:"value",intField:"interval",canLoop:false,next:mstrmojo.emptyFn,prev:mstrmojo.emptyFn,hasPrev:mstrmojo.emptyFn,hasNext:mstrmojo.emptyFn,renderItemAt:mstrmojo.emptyFn,setVal:mstrmojo.emptyFn,getVal:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresDescs(12575,12316,12317,12319,12331,14244,14245,14246,14247,14248,14249,14250,14251,14252,14253,14254,14255,14256,14257,14258,14259,14260,14261,14262,14263,14264,14265,14266,14267,12339,12341,12342,13957,13958,12344,12345,14268,14269,14270,14271,14272,14273,14274,14275,14276,14277,14278,14279,14280,14288,14289,14762,14763,14764,14765);mstrmojo.requiresCls("mstrmojo.hash");var F=mstrmojo.hash;mstrmojo.Refine.RefineModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineModel",data:{},start:0,limit:50,columns:{},history:{},operations:{entries:[]},engine:JSON.stringify({facets:[],mode:"row-based"}),hasUploadData:false,sampleStatus:null,transformations:{Delete:{Colomn:{op:"core/column-removal",description:mstrmojo.desc(12575,"Delete Column")+" [[column name]]",columnName:"[column name]"},RowsContains:{op:"core/row-removal",description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBegins:{op:"core/row-removal",description:mstrmojo.desc(14245,"Delete Row(s) Where Cell Begins With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsEnds:{op:"core/row-removal",description:mstrmojo.desc(14263,"Delete Row(s) Where Cell Ends With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBlank:{op:"core/row-removal",description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{expression:"value",invert:false,selectError:false,omitError:false,name:"[column name]",selectBlank:true,columnName:"[column name]",omitBlank:false,type:"list",selection:[]}],mode:"row-based"}},RowsEquals:{op:"core/row-removal",description:mstrmojo.desc(14288,"Delete Row(s) Where Cell Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:false,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RowsNotEquals:{op:"core/row-removal",description:mstrmojo.desc(14289,"Delete Row(s) Where Cell Not Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:true,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RemoveDuplicateCells:{op:"core/row-deduplicate",description:mstrmojo.desc(12316,"Remove Duplicate Cells")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",columnName:"[column name]",engineConfig:{facets:[],mode:"row-based"},mode:"column-based"},RemoveDuplicateRows:{op:"core/row-deduplicate",description:mstrmojo.desc(12317,"Remove Duplicate Rows")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},mode:"row-based"},DeleteRowsInTheView:{op:"core/row-removal",description:mstrmojo.desc(14764,"Deleted rows meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"}},DeleteRowsNotInTheView:{op:"core/row-removal",description:mstrmojo.desc(14765,"Deleted rows not meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},invert:true}},Extract:{on:{op:"core/column-addition",description:mstrmojo.desc(14247,"Extract On ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[1])",onError:"store-error"},fromTo:{op:"core/column-addition",description:mstrmojo.desc(12319,"Extract By Fixed Length")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:substring(value, [from], [to])",onError:"set-to-blank"},beforeFirst:{op:"core/column-addition",description:mstrmojo.desc(14248,"Extract Before First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0])",onError:"store-error"},afterFirst:{op:"core/column-addition",description:mstrmojo.desc(14249,"Extract After First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[2])",onError:"store-error"},beforeLast:{op:"core/column-addition",description:mstrmojo.desc(14264,"Extract Before Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[0])",onError:"set-to-blank"},afterLast:{op:"core/column-addition",description:mstrmojo.desc(14265,"Extract After Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[2])",onError:"store-error"}},FindAndReplace:{CharInCell:{op:"core/text-transform",description:mstrmojo.desc(14250,"Find And Replace Characters In Cell From #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [from], [to])",onError:"keep-original",repeat:false,repeatCount:10},CellContains:{op:"core/text-transform",description:mstrmojo.desc(14251,"Find And Replace Cell Where Cell Contains #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(contains(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellBeginsWith:{op:"core/text-transform",description:mstrmojo.desc(14252,"Find And Replace Cell Where Cell Begins With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(startsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellEndsWith:{op:"core/text-transform",description:mstrmojo.desc(14253,"Find And Replace Cell Where Cell Ends With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(endsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CutOn:{op:"core/text-transform",description:mstrmojo.desc(14514,"Remove Characters")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [separator], '')",onError:"keep-original",repeat:false,repeatCount:10},CutBefore:{op:"core/text-transform",description:mstrmojo.desc(14515,"Remove Characters Before")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(if(isBlank(partition(value, [separator])[1]), value, partition(value, [separator])[1] + partition(value, [separator])[2]))",onError:"keep-original",repeat:false,repeatCount:10},CutAfter:{op:"core/text-transform",description:mstrmojo.desc(14516,"Remove Characters After")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0] + partition(value, [separator])[1])",onError:"keep-original",repeat:false,repeatCount:10}},split:{bySeparator:{op:"core/column-split",description:mstrmojo.desc(14260,"Split On ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:0,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:0},byFieldLengths:{op:"core/column-split",description:mstrmojo.desc(12331,"Split By Fixed Length")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},fieldForward:true,keepRest:true,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"lengths",fieldLengths:[]},beforeFirst:{op:"core/column-split",description:mstrmojo.desc(14257,"Split Before First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:1,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterFirst:{op:"core/column-split",description:mstrmojo.desc(14258,"Split After First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:3,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterLast:{op:"core/column-split",description:mstrmojo.desc(14259,"Split After Last ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:4,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},cellIntoRow:{op:"core/multivalued-cell-split",description:mstrmojo.desc(13884,"Split Cell Into Rows On Separator")+" [column name]",columnName:"[column name]",keyColumnName:"[key column name]",separator:",",mode:"plain"}},TransformCell:{titlecase:{op:"core/text-transform",description:mstrmojo.desc(14268,"To Title Case")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[[column name]]",expression:"value.toTitlecase()",onError:"keep-original",repeat:false,repeatCount:10},uppercase:{op:"core/text-transform",description:mstrmojo.desc(14269,"To Uppercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toUppercase()",onError:"keep-original",repeat:false,repeatCount:10},lowercase:{op:"core/text-transform",description:mstrmojo.desc(14270,"To Lowercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toLowercase()",onError:"keep-original",repeat:false,repeatCount:10},unescape:{op:"core/text-transform",description:mstrmojo.desc(12339,"Unescape HTML")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.unescape('html')",onError:"keep-original",repeat:false,repeatCount:10},number:{op:"core/text-transform",description:mstrmojo.desc(14271,"To Number")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toNumber()",onError:"set-to-blank",repeat:false,repeatCount:10},text:{op:"core/text-transform",description:mstrmojo.desc(14272,"To Text")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"toString(value)",onError:"set-to-blank",repeat:false,repeatCount:10},date:{op:"core/text-transform",description:mstrmojo.desc(14273,"To Date")+" [format] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:toDate(value, [format])",onError:"set-to-blank",repeat:false,repeatCount:10},fillDown:{op:"core/fill-down",description:mstrmojo.desc(12341,"Fill Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},blankDown:{op:"core/blank-down",description:mstrmojo.desc(12342,"Blank Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},padBefore:{op:"core/text-transform",description:mstrmojo.desc(13957,"Pad Before")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:[string] + if(isNull(value), "", value)',onError:"keep-original",repeat:false,repeatCount:10},padAfter:{op:"core/text-transform",description:mstrmojo.desc(13958,"Pad After")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:if(isNull(value), "", value) + [string]',onError:"keep-original",repeat:false,repeatCount:10}},Whitespace:{trim:{op:"core/text-transform",description:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.trim()",onError:"keep-original",repeat:false,repeatCount:10},collapse:{op:"core/text-transform",description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.replace(/\\s+/,' ')",onError:"keep-original",repeat:false,repeatCount:10}},Other:{duplicate:{op:"core/column-addition",description:mstrmojo.desc(14274,"Duplicate Column")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:value",onError:"set-to-blank"},Rename:{op:"core/column-rename",description:mstrmojo.desc(14275,"Rename Column [####] To {@@@@}"),oldColumnName:"[column name]",newColumnName:"[column name]"},ConcatenateColumns:{op:"core/column-addition",description:mstrmojo.desc(14276,"Concatenate Column [####] And Column [@@@@] To Column {@@@@}")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name 1]",expression:'grel:if(isNull(cells["[column name 1]"]),"",cells["[column name 1]"].value) + "" + if(isNull(cells["[column name 2]"]), "", cells["[column name 2]"].value)',onError:"set-to-blank"},TransposeColumnsIntoRows:{op:"core/transpose-columns-into-rows",description:mstrmojo.desc(14278,"Transpose cells in #### column(s) starting with [@@@@] into rows in two new columns named [@@@@] and [@@@@]"),startColumnName:"[start column]",columnCount:7,ignoreBlankCells:true,fillDown:true,keyColumnName:"[new column 1]",valueColumnName:"[new column 2]"}},URL:{newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name]",urlExpression:"[ex]",onError:"set-to-blank",delay:5000},EditCell:{applyToAll:{op:"core/mass-edit",description:mstrmojo.desc(14279,"Edit Cell")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value",edits:[{fromBlank:false,fromError:false,from:["[from]"],to:"[to]",type:"text"}]},singleEdit:{op:"core/single-edit",description:mstrmojo.desc(14280,"Edit cell in row #### at cell #### value is: ####"),engineConfig:{facets:[],mode:"row-based"},row:0,col:0,to:"[to]"}}},suggestions:{partialCell:{split:[{description:mstrmojo.desc(12331,"Split By Fixed Length"),suggestion_type:1,suggestion_subtype:0,operations:[{}]},{description:mstrmojo.desc(14266,"Split Before ####"),suggestion_type:1,suggestion_subtype:3,operations:[{}]},{description:mstrmojo.desc(14267,"Split After ####"),suggestion_type:1,suggestion_subtype:2,operations:[{}]},{description:mstrmojo.desc(14260,"Split On ####"),suggestion_type:1,suggestion_subtype:1,operations:[{}]}],extract:[{description:mstrmojo.desc(14261,"Extract Before ####"),suggestion_type:1,suggestion_subtype:6,operations:[{}]},{description:mstrmojo.desc(14262,"Extract After ####"),suggestion_type:1,suggestion_subtype:5,operations:[{}]},{description:mstrmojo.desc(14247,"Extract On ####"),suggestion_type:1,suggestion_subtype:4,operations:[{}]}],cut:[{description:mstrmojo.desc(14515,"Remove Characters Before")+" ####",suggestion_type:1,suggestion_subtype:9,operations:[{}]},{description:mstrmojo.desc(14516,"Remove Characters After")+" ####",suggestion_type:1,suggestion_subtype:8,operations:[{}]},{description:mstrmojo.desc(14514,"Remove Characters")+" ####",suggestion_type:1,suggestion_subtype:7,operations:[{}]}],deleteRows:[{description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####"),operations:[{}]},{description:mstrmojo.desc(14762,"Delete Row Included In Selectors"),suggestion_type:2,operations:[{}]},{description:mstrmojo.desc(14763,"Delete Row Not-included In Selectors"),suggestion_type:2,operations:[{}]}]},cell:[{}],row:[{}],column:[{description:mstrmojo.desc(12575,"Delete Column"),operations:[{}]},{description:mstrmojo.desc(12341,"Fill Down"),operations:[{}]},{description:mstrmojo.desc(12342,"Blank Down"),operations:[{}]},{description:mstrmojo.desc(14268,"To Title Case"),operations:[{}]},{description:mstrmojo.desc(14269,"To Uppercase"),operations:[{}]},{description:mstrmojo.desc(14270,"To Lowercase"),operations:[{}]},{description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]]",operations:[{}]},{description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),operations:[{}]},{description:mstrmojo.desc(14277,"Transpose Columns to Row from [####] to [@@@@]"),operations:[{}]}]},populateData:function G(H){this.set("data",H);},populateColumns:function A(H){this.set("columns",H);},populateHistory:function E(H){this.set("history",H);},populateOperations:function D(H){this.set("operations",H);},getCurrentOperations:function(){var J=F.clone(this.operations),I,H,L,K;for(K=0;K<J.entries.length;K++){L=J.entries[K];L.selected=true;}H=J&&J.entries;if(H&&H.length>0){I=H.length;L=H[I-1];if(!("op" in L.operation)||("estimatedRow" in L.operation)){H.pop();}}return J;},populateSampleStatus:function B(H){this.set("sampleStatus",H);},hasAddSample:function C(){var H=!!this.sampleStatus;if(H&&!this.sampleStatus.random){H=false;}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var M=mstrmojo.DI.DIConstants,H=mstrmojo.array,D=M.dbType,F=M.xdaType,I=M.sourceType,K=M.backendSourceSubtype;mstrmojo.DI.DIDatabaseHelper=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIDatabaseHelper.getImportOptionByDBType=function A(N){switch(N){case D.SAP:case D.MSFT_AS:case D.ESSBASE:case D.TM1:case D.PIG:return false;default:return true;}};mstrmojo.DI.DIDatabaseHelper.getSourceTypeByDBType=function E(N){switch(N){case D.SAP:case D.MSFT_AS:case D.ESSBASE:case D.TM1:return F.mdx;case D.PIG:return F.ffsql;default:return -1;}};mstrmojo.DI.DIDatabaseHelper.getDescriptionIdByDBType=function(N){switch(N){case D.MS_ACCESS:return 9149;case D.ORACLE:return 8545;case D.SQL_SERVER:return 8552;case D.INFORMIX:return 12995;case D.SYBASE:return 12998;case D.REDBRICK:return 10059;case D.DB2:return 8516;case D.TERADATA:return 8553;case D.SAP:return 13107;case D.NETEZZA:return 8558;case D.EXCEL:return 3958;case D.MSFT_AS:return 13225;case D.ESSBASE:return 13224;case D.MYSQL:return 8556;case D.POSTGRESQL:return 8541;case D.COMPOSITE:return 12991;case D.ASTER:return 10058;case D.VERTICA:return 10062;case D.PARACCEL:return 10056;case D.TM1:return 13223;case D.XQUERY:return 8560;case D.HIVE:return 8561;case D.SALESFORCE:return 9213;case D.SAPHANA:return 12997;case D.GOOGLE_BIGQUERY:return 12450;default:return 4444;}};mstrmojo.DI.DIDatabaseHelper.getOASTFromBEST=function L(N){switch(N){case K.googleBigQuery:case K.googleBigQueryFFSQLModel:case K.googleBigQuerySingleTable:return I.googleBigQuery;case K.dropbox:return I.dropbox;case K.googleAnalytics:return I.googleAnalytics;case K.googleDrive:return I.googleDrive;case K.facebook:return I.facebook;case K.twitter:return I.twitter;case K.salesforce:return I.salesforce;default:return -1;}};mstrmojo.DI.DIDatabaseHelper.isOAuthSourceType=function C(N){var O=[I.googleBigQuery,I.dropbox,I.googleAnalytics,I.googleDrive,I.facebook,I.twitter,I.salesforce];return H.indexOf(O,N)!==-1;};mstrmojo.DI.DIDatabaseHelper.filterDBById=function B(P,N,O){return H.filter(P,function(S){var R=H.indexOf(N,S.id),Q;if(R>-1){Q=O;}else{Q=!O;}return Q;});};mstrmojo.DI.DIDatabaseHelper.filterDBByDispOption=function B(P,N,O){return H.filter(P,function(R){var Q=false;if((R.disp&N)===N){H.forEach(O,function(S){if(R.id===S){Q=true;return false;}});return !Q;}});};mstrmojo.DI.DIDatabaseHelper.getDBIds=function J(O){var N=[];H.forEach(O,function(P){N=N.concat(P.id);});return N;};mstrmojo.DI.DIDatabaseHelper.getUniqueDBTypes=function G(P){var O=[],N;H.forEach(P,function(Q){N=H.indexOf(O,Q.dbType);if(N<0){O.push(Q.dbType);}});return O;};mstrmojo.DI.DIDatabaseHelper.filterDBByAdminConfig=function(O,N){return H.filter(O,function(R){var P=H.indexOf(N,R.id),Q=true;if(P>=0){Q=false;}return Q;});};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.dom");var H=mstrmojo.array,F=mstrmojo.hash;var G={pages:[],refCnt:[]};var C={};var D=0;function B(){return D++;}function E(K){if(!K){return ;}var J=G.pages;var I=H.indexOf(J,K);if(I!==-1){G.refCnt[I]=G.refCnt[I]+1;}else{G.pages.push(K);G.refCnt.push(1);}}function A(M){if(!M){return ;}var J=G.pages;var I=H.indexOf(J,M);var L,K;if(I!==-1){G.refCnt[I]=G.refCnt[I]-1;if(G.refCnt[I]===0){L=G.pages[I];G.pages.splice(I,1);G.refCnt.splice(I,1);for(K in C){if(L===C[K].page){C[K].page=null;}}L.destroy();}}}mstrmojo.DI.DIPagePoolSlot=mstrmojo.declare(mstrmojo.Obj,null,{key:null,get:function(){return C[this.key].page||null;},set:function(J){var I=this.key;C[I].page=J;J.pageSlotKey=I;},getConfig:function(){return C[this.key].config||null;},setConfig:function(J){var I=this.key;C[I].config=J;},postCreate:function(){if(this._super){this._super();}var I=this.key;if(I&&!C[I]){C[I]={slot:this,page:null};}},destroy:function(J){var I=this.key;if(I){delete C[I];}if(this._super){this._super(J);}}});mstrmojo.DI.DINavigationController=mstrmojo.declare(mstrmojo.Obj,null,{routes:{},postCreate:function(){this.routes={};this.pagePool=C;this.pageInstanceRef=G;},destroy:function(I){F.forEach(C,function(J){if(J.page&&!J.page.destroyed){J.page.destroy();}});this.routes={};C={};G={pages:[],refCnt:[]};if(this._super){this._super(I);}},addRoute:function(I){if(this.routes[I]){return false;}this.routes[I]=[];return true;},deleteRoute:function(K){var I=this.routes[K];var J,L;if(I){for(J=I.length-1;J>-1;J--){L=I[J].slot.get();I[J].slot.destroy();A(L);}}delete this.routes[K];},getPreviousPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L>0){M=I[L-1].slot;}return M;},getNextPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L+1<I.length){M=I[L+1].slot;}return M;},getRoute:function(I){return this.routes[I];},pushPage:function(K,J,M,L,N){var I;var P;var O;if(!this.getRoute(K)){this.addRoute(K);}I=this.getRoute(K);if(!L){P=B().toString();O=this.getPageSlot(P);}else{O=L;}if(M){O.set(M);E(O.get());}if(N){O.setConfig(N);}I.push({type:J,slot:O});return O;},getCurrentPageSlot:function(M,J){var I=this.getRoute(M);var K=null;var L;if(I){for(L=0;L<I.length;L++){if(I[L].type===J){K=I[L].slot;}}}return K;},getPageSlot:function(J){var K=null;var I=B().toString();J=J||I;K=C[J]&&C[J].slot;if(!K){K=new mstrmojo.DI.DIPagePoolSlot({key:J});}return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");function B(J,I){this.raiseEvent({name:"viCompBuilt",type:J,widget:I});}mstrmojo.vi.models.VIComponentMap=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.VIComponentMap",init:function G(I){this._super(I);this.relativePanels={};this.comps={};},addRelativePanel:function H(I){this.relativePanels[I]=true;},isRelativePanel:function F(I){return !!this.relativePanels[I];},isComponent:function C(J,I){return this.getComponentKey(J)===I;},getComponent:function A(I){return this.comps[I];},getComponentKey:function D(J){var I=this.getComponent(J);return(I&&I.k)||"";},createComponent:function E(L,K,J){B.call(this,L);var I=new K(J);this.comps[L]=I;B.call(this,L,I);return I;}});mstrmojo.vi.models.VIComponentMap.TYPES={FILTER_STACK:1,FILTER_PANEL:2,PAGEBY_STACK:3,PAGEBY_PANEL:4,VIZ_CONTENT:5,MAIN_CONTENT:6};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Obj","mstrmojo.string","mstrmojo.hash","mstrmojo.expr","mstrmojo.num","mstrmojo.mstr.EnumNodeDimty");var G=mstrmojo.array,S=mstrmojo.expr,L=S.ET,K=S.TP,D=S.DTP,M=mstrmojo.mstr.EnumNodeDimty,P=S.ET2TGT,O=S.ET2COND,C=mstrmojo.meta.TP,B=mstrmojo.num;function Q(W,A){var V=(A&&A.did)?A.did.split(S.FN_SEP):null,E=V&&parseInt(V[0],10),U=V&&parseInt(V[1],10),X=W.et;W.fnt=E;W.fn=U;if(X!=L.AE&&S.fn_List(U,E)){W.et=L.AL;W.a2=null;W.cs=null;}else{if(X==L.AL&&!S.fn_List(U,E)){W.et=L.AQ;W.cs=null;}else{if(X==L.MC&&!S.fn_AC_MC(U,E)){W.et=L.MQ;W.m2=null;}else{if(X==L.AC&&!S.fn_AC_MC(U,E)){W.et=L.AQ;W.a2=null;}}}}switch(U){case S.FN.IS_NULL:case S.FN.IS_NOT_NULL:W.a2=null;W.a3=null;W.fm2=null;W.fm3=null;W.m2=null;W.m3=null;W.cs=null;break;case S.FN.BETWEEN:case S.FN.NOT_BETWEEN:break;default:W.a3=null;W.fm3=null;W.m3=null;while(W.cs&&W.cs.length>1){W.cs.pop();}}}function H(Z,a,b){var E=2+a,X;if(B.isBigDecimal(b.v)){b.dtp=D.BIGDECIMAL;}switch(b.t){case K.PROMPT:X=Z.cs;var Y;if(!X){X=[];Z.cs=X;}X[a]={};Y=X[a];Y.p=b;Z["a"+E]=null;Z["m"+E]=null;switch(Z.et){case L.AC:Z.et=L.AQ;break;case L.MC:Z.et=L.MQ;break;}break;case K.METRIC:Z["a"+E]=null;Z.cs=null;Z.et=L.MC;Z["m"+E]=b;break;case K.ATTR:Z["m"+E]=null;Z.cs=null;Z.et=L.AC;Z["a"+E]=b;Z["fm"+E]=null;break;default:Z["a"+E]=null;Z["m"+E]=null;X=Z.cs;if(!X){X=[];Z.cs=X;}if("did" in b){Z["a"+E]=null;Z["fm"+E]=null;Z["m"+E]=null;if(X[a]&&X[a].p){X[a].p=null;}}else{if(b&&b.v!=null){X[a]=b;}else{if(X[a]&&Z.et!==L.AL){X=X.splice(a,1);}}}if(!b.skipET){switch(Z.et){case L.MC:if((!Z.c2||!Z.m3)&&(!Z.m2||!Z.c3)){Z.et=L.MQ;}break;case L.AC:Z.et=L.AQ;break;case L.AL:if(!("did" in b)&&b.v){var A,V=b.dtp;X=[];A=b.v.split(mstrConfig.listSep);for(var U=0,W=A.length;U<W;U++){X.push({v:mstrmojo.string.trim(A[U]),dtp:V});}Z.cs=X;}break;}}}}var J={};J[L.AQ]={target:1,fm:1,fn:1,cs:1};J[L.AL]={target:1,fm:1,fn:1,cs:1};J[L.AE]={target:1,fn:1,es:1};J[L.AC]={target:1,a2:1,a3:1,fm:1,fm2:1,fm3:1,fn:1};J[L.MQ]={target:1,fn:1,cs:1,dmy:1};J[L.MC]={target:1,fn:1,m2:1,m3:1,dmy:1};J[L.F]={target:1};J[L.R]=J[L.F];J[L.XML]={target:1};J[L.ANDOR]={target:1};var I=function(A){return A!==null&&A!==undefined;};var N=function(a){if(a.data){return true;}if(!a||!I(a.et)){return false;}var Z=true,A=J[a.et],X=a.cs,W;Z=Z&&(!A.target||a[P[a.et]]);Z=Z&&(!A.fm||a.fm);Z=Z&&(!A.fn||I(a.fn));var V=S.fnCstCount(a.fn,a.fnt);if(Z&&A.cs){for(W=0;W<V;W++){Z=Z&&X&&I(X[W]);}}if(Z){var Y=[P[a.et],"fm"];for(var E=0;E<2;E++){for(W=0;W<V;W++){var b=Y[E]+(2+W);Z=Z&&(!A[b]||a[b]);}}}Z=Z&&(!A.es||a.es&&(a.es.length>0));var U=a.dimtyTypes;Z=Z&&(!A.dmy||U[M.NodeDimtyUnspecified]||U[M.NodeDimtyNone]||(U[M.NodeDimtyOutputLevel]&&a.dmy&&a.dmy.uts&&(a.dmy.uts.length>0)));return Z;};mstrmojo.ConditionModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ConditionModel",data:null,completed:false,defaultETAttr:L.AQ,init:function(A){if(this._super){this._super(A);}this._updateCompleted();},edit:function R(p,f,AC){var W=this[p];if(W===f){return ;}this.etWas=this.et;switch(p){case"not":f=!!(f&&f.did===S.FN.NOT);W=!!this.not;if(f===W){return ;}this.not=!!f||null;break;case"target":var AG=this.et;if(f){switch(f[C]){case K.ATTR:case K.CONS:W=this.a;if(AG!==L.AQ&&AG!==L.AE&&AG!==L.ANDOR){this.et=this.defaultETAttr;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}if(AG!==L.AE){this.fn=null;this.fnt=null;}this.fm=null;this.fm2=null;this.fm3=null;this.cs=null;break;case K.METRIC:W=this.m;if((AG!==L.MQ)&&(AG!==L.MC)){this.et=L.MQ;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.r=null;this.f=null;this.cs=null;this.dmt=M.NodeDimtyUnspecified;}this.m2=null;break;case K.REPORT:W=this.r;if(AG!==L.R){this.et=L.R;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.f=null;}break;case K.FILTER:W=this.f;if(AG!==L.F){this.et=L.F;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;}break;case K.PROMPT:W=this.prms&&this.prms[0];if(AG!==L.XML){this.et=L.XML;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}break;}}this.es=null;this.data=null;this[P[this.et]]=f;break;case"fm":if(f&&f[C]==="fn"){this.et=L.AE;this.fm=null;Q(this,f);}else{this.fm=f;if(f&&(this.et==L.AE)){this.et=L.AQ;}this.fnt=null;this.fn=null;this.cs=null;this.a2=null;this.fm2=null;}break;case"fm2":case"fm3":this[p]=f;break;case"fn":Q(this,f);break;case"es":var AJ=this.es;if(f&&f.removed&&AJ){G.removeItems(AJ,f.itemIdField,f.removed);}if(f&&f.added){if(!AJ){AJ=f.added.concat();this.es=AJ;}else{G.insert(AJ,AJ.length,f.added);}}break;case"c0":H(this,0,f);break;case"c1":H(this,1,f);break;case"dmy":var AD=this.dmy;if(!AD){AD={cc:true,fres:true,uts:[]};this.dmy=AD;}var z=AD&&AD.uts;if(!z){z=[];AD.uts=z;this.dmt=M.NodeDimtyOutputLevel;}var U={};U[S.TP.ATTR]=true;U[S.TP.DIM]=true;if(f&&f.removed){var k=[],A=false,d=[],V=false;for(var o=0,X=f.removed,E=X.length;o<E;o++){var Z=X[o],AF=Z[C] in U;if(AF){V=true;}else{A=true;}var m=AF?d:k;m.push(Z);}if(A){G.removeItems(z,"did",k);}if(V){var AI={};for(var h=0,g=z&&z.length;h<g;h++){var e=z[h];if(e&&e.utgt){AI[e.utgt.did]=h;}}var Y=[];for(var AE=0,AB=d.length;AE<AB;AE++){var l=AI[d[AE].did];if(l>-1){Y.push(l);}}Y.sort(G.numSorter);for(var x=Y.length-1;x>-1;x--){z.splice(Y[x],1);}}}if(f&&f.added){var AK=[],q=S.DMY_TP.DIM,w=S.DMY_TP.ATTR;for(var AH=0,AA=f.added,j=AA.length;AH<j;AH++){var t=AA[AH];AK.push((t[C] in U)?{utgt:t,utp:t[C]===K.DIM?q:w,agg:1,flt:2,gb:true,rps:0,n:t.n}:t);}G.insert(z,z.length,AK);}break;case"data":this.data=f;break;}this._updateCompleted();if(!AC){this.raiseEvent({name:"edit",prop:p,value:f,valueWas:W});}},get:function F(){var A=this.data?this.data:this;var E=O[A.et]||[];E.push("et");return mstrmojo.hash.copyProps(E,A);},_updateCompleted:function(){this.set("completed",N(this));}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumObjectTypes");var B=mstrmojo,C=B.hash,F=B.array,G=mstrmojo.warehouse.EnumObjectTypes;function D(K,L){var M=[];F.forEach(K,function(N){if(N.tp===L){M.push(N);}});return M.sort(function(O,N){return(O.n<N.n)?-1:(O.n>N.n)?1:0;});}mstrmojo.warehouse.obj.TableData=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.obj.TableData",init:function I(N){var M=N.model,L=function(Q,P){return M.handleVisibleAction(Q,P);},K=function(Q,P){return M.handleCheckAction(Q,P);},O=function(Q,P){return M.handleEnabledAction(Q,P);};this.did=N.id;this.n=N.n;this.items=[];this.isVisible=L;this.isChecked=K;this.isEnabled=O;this.tp=N.tp;this.model=M;this.multi=N.multi;this.isLeaf=N.isLeaf;this.bold=N.bold;this.dbrole=N.dbrole;this.ns=N.ns||"";this.isError=N.isError;this.ttp=N.ttp||"";this.sta=N.sta||0;this.isLocked=N.isLocked;this.size=N.size;this.dbtn=N.dbtn||N.n;this.isView=N.isView;this.icntp=N.icntp;},model:undefined,multi:false,did:undefined,n:undefined,items:undefined,isVisible:undefined,isEnabled:undefined,isChecked:undefined,isLocked:false,size:0,isLeaf:false,bold:false,dbrole:undefined,tp:undefined,x:undefined,y:undefined,w:undefined,h:undefined,isError:false,ttp:"",sta:0,dbtn:undefined,ns:"",italics:false,addItem:function H(L,K,Q,R,U,N,P,O){var M=this,S={pdid:M.did,did:L,n:K,tp:Q,bfIdx:R,isVisible:M.isVisible,isChecked:M.isChecked,items:[],ttp:U,isLeaf:N,bold:P,unused:O};M.items.push(S);return S;},addSubItem:function J(Q,L,K,P,R,S,V,N,O){var M=this,U={pdid:M.did,did:L,sid:Q,n:K,tp:P,bfIdx:R,fcatId:S,isVisible:M.isVisible,isChecked:M.isChecked,ttp:V,isLeaf:N,bold:O};C.forEach(M.items,function(W){if(W.did===Q){W.items.push(U);return false;}return true;});return U;},addSubItemItem:function A(P,R,L,K,Q,S,U,W,N,O){var M=this,V={pdid:M.did,did:L,sid:P,n:K,tp:Q,bfIdx:S,fcatId:U,isVisible:M.isVisible,isChecked:M.isChecked,ttp:W,isLeaf:N,bold:O};C.forEach(M.items,function(X){if(X.did===P){C.forEach(X.items,function(Y){if(Y.did===R){Y.items=Y.items||[];Y.items.push(V);return false;}return true;});return false;}return true;});return V;},sortElements:function E(){var M=this,K=M.items,L=[];M.items=L.concat(D(K,G.ATTRIBUTE),D(K,G.FACT),D(K,G.COLUMN));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(12746,12747);var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIHadoopDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIHadoopDBRole",init:function D(F){var E=this.mdDBRole;E.n=mstrmojo.desc(12746,"Hadoop Connection");E.des=mstrmojo.desc(12747,"Hadoop Connection Description");E.dbr_type="2";E.stp=7424;E.owned="1";E.writable="1";E.ln="UserName";E.password=B;E.tp=44;E.db_type=A.BDE;E.db_version=218;E.dbms="85649E2005E343A19269C39CC3DE9E42";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:44,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.Refine.DateTimeUtil=mstrmojo.declare(mstrmojo.Obj,null,null);Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var B=Date,A=B.prototype,D=B.CultureInfo,G=function(I,H){if(!H){H=2;}return("000"+I).slice(H*-1);};A.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};A.setTimeToNow=function(){var H=new Date();this.setHours(H.getHours());this.setMinutes(H.getMinutes());this.setSeconds(H.getSeconds());this.setMilliseconds(H.getMilliseconds());return this;};B.today=function(){return new Date().clearTime();};B.compare=function(I,H){if(isNaN(I)||isNaN(H)){throw new Error(I+" - "+H);}else{if(I instanceof Date&&H instanceof Date){return(I<H)?-1:(I>H)?1:0;}else{throw new TypeError(I+" - "+H);}}};B.equals=function(I,H){return(I.compareTo(H)===0);};B.getDayNumberFromName=function(I){var M=D.dayNames,H=D.abbreviatedDayNames,L=D.shortestDayNames,K=I.toLowerCase();for(var J=0;J<M.length;J++){if(M[J].toLowerCase()==K||H[J].toLowerCase()==K||L[J].toLowerCase()==K){return J;}}return -1;};B.getMonthNumberFromName=function(I){var L=D.monthNames,H=D.abbreviatedMonthNames,K=I.toLowerCase();for(var J=0;J<L.length;J++){if(L[J].toLowerCase()==K||H[J].toLowerCase()==K){return J;}}return -1;};B.isLeapYear=function(H){return((H%4===0&&H%100!==0)||H%400===0);};B.getDaysInMonth=function(H,I){return[31,(B.isLeapYear(H)?29:28),31,30,31,30,31,31,30,31,30,31][I];};B.getTimezoneAbbreviation=function(K){var J=D.timezones,I;for(var H=0;H<J.length;H++){if(J[H].offset===K){return J[H].name;}}return null;};B.getTimezoneOffset=function(H){var K=D.timezones,J;for(var I=0;I<K.length;I++){if(K[I].name===H.toUpperCase()){return K[I].offset;}}return null;};A.clone=function(){return new Date(this.getTime());};A.compareTo=function(H){return Date.compare(this,H);};A.equals=function(H){return Date.equals(this,H||new Date());};A.between=function(I,H){return this.getTime()>=I.getTime()&&this.getTime()<=H.getTime();};A.isAfter=function(H){return this.compareTo(H||new Date())===1;};A.isBefore=function(H){return(this.compareTo(H||new Date())===-1);};A.isToday=function(){return this.isSameDay(new Date());};A.isSameDay=function(H){return this.clone().clearTime().equals(H.clone().clearTime());};A.addMilliseconds=function(H){this.setMilliseconds(this.getMilliseconds()+H);return this;};A.addSeconds=function(H){return this.addMilliseconds(H*1000);};A.addMinutes=function(H){return this.addMilliseconds(H*60000);};A.addHours=function(H){return this.addMilliseconds(H*3600000);};A.addDays=function(H){this.setDate(this.getDate()+H);return this;};A.addWeeks=function(H){return this.addDays(H*7);};A.addMonths=function(H){var I=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+H);this.setDate(Math.min(I,B.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};A.addYears=function(H){return this.addMonths(H*12);};A.add=function(I){if(typeof I=="number"){this._orient=I;return this;}var H=I;if(H.milliseconds){this.addMilliseconds(H.milliseconds);}if(H.seconds){this.addSeconds(H.seconds);}if(H.minutes){this.addMinutes(H.minutes);}if(H.hours){this.addHours(H.hours);}if(H.weeks){this.addWeeks(H.weeks);}if(H.months){this.addMonths(H.months);}if(H.years){this.addYears(H.years);}if(H.days){this.addDays(H.days);}return this;};var E,F,C;A.getWeek=function(){var O,N,M,L,K,J,I,H,Q,P;E=(!E)?this.getFullYear():E;F=(!F)?this.getMonth()+1:F;C=(!C)?this.getDate():C;if(F<=2){O=E-1;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=0;J=C-1+(31*(F-1));}else{O=E;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=Q+1;J=C+((153*(F-3)+2)/5)+58+Q;}I=(O+N)%7;L=(J+I-K)%7;H=(J+3-L)|0;if(H<0){P=53-((I-Q)/5|0);}else{if(H>364+Q){P=1;}else{P=(H/7|0)+1;}}E=F=C=null;return P;};A.getISOWeek=function(){E=this.getUTCFullYear();F=this.getUTCMonth()+1;C=this.getUTCDate();return G(this.getWeek());};A.setWeek=function(H){return this.moveToDayOfWeek(1).addWeeks(H-this.getWeek());};B._validate=function(K,J,H,I){if(typeof K=="undefined"){return false;}else{if(typeof K!="number"){throw new TypeError(K+" is not a Number.");}else{if(K<J||K>H){throw new RangeError(K+" is not a valid value for "+I+".");}}}return true;};B.validateMillisecond=function(H){return B._validate(H,0,999,"millisecond");};B.validateSecond=function(H){return B._validate(H,0,59,"second");};B.validateMinute=function(H){return B._validate(H,0,59,"minute");};B.validateHour=function(H){return B._validate(H,0,23,"hour");};B.validateDay=function(I,H,J){return B._validate(I,1,B.getDaysInMonth(H,J),"day");};B.validateMonth=function(H){return B._validate(H,0,11,"month");};B.validateYear=function(H){return B._validate(H,0,9999,"year");};A.set=function(H){if(B.validateMillisecond(H.millisecond)){this.addMilliseconds(H.millisecond-this.getMilliseconds());}if(B.validateSecond(H.second)){this.addSeconds(H.second-this.getSeconds());}if(B.validateMinute(H.minute)){this.addMinutes(H.minute-this.getMinutes());}if(B.validateHour(H.hour)){this.addHours(H.hour-this.getHours());}if(B.validateMonth(H.month)){this.addMonths(H.month-this.getMonth());}if(B.validateYear(H.year)){this.addYears(H.year-this.getFullYear());}if(B.validateDay(H.day,this.getFullYear(),this.getMonth())){this.addDays(H.day-this.getDate());}if(H.timezone){this.setTimezone(H.timezone);}if(H.timezoneOffset){this.setTimezoneOffset(H.timezoneOffset);}if(H.week&&B._validate(H.week,0,53,"week")){this.setWeek(H.week);}return this;};A.moveToFirstDayOfMonth=function(){return this.set({day:1});};A.moveToLastDayOfMonth=function(){return this.set({day:B.getDaysInMonth(this.getFullYear(),this.getMonth())});};A.moveToNthOccurrence=function(I,J){var H=0;if(J>0){H=J-1;}else{if(J===-1){this.moveToLastDayOfMonth();if(this.getDay()!==I){this.moveToDayOfWeek(I,-1);}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(I,+1).addWeeks(H);};A.moveToDayOfWeek=function(H,I){var J=(H-this.getDay()+7*(I||+1))%7;return this.addDays((J===0)?J+=7*(I||+1):J);};A.moveToMonth=function(J,H){var I=(J-this.getMonth()+12*(H||+1))%12;return this.addMonths((I===0)?I+=12*(H||+1):I);};A.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};A.getTimezone=function(){return B.getTimezoneAbbreviation(this.getUTCOffset());};A.setTimezoneOffset=function(J){var H=this.getTimezoneOffset(),I=Number(J)*-6/10;return this.addMinutes(I-H);};A.setTimezone=function(H){return this.setTimezoneOffset(B.getTimezoneOffset(H));};A.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};A.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};A.getUTCOffset=function(){var I=this.getTimezoneOffset()*-10/6,H;if(I<0){H=(I-10000).toString();return H.charAt(0)+H.substr(2);}else{H=(I+10000).toString();return"+"+H.substr(1);}};A.getElapsed=function(H){return(H||new Date())-this;};if(!A.toISOString){A.toISOString=function(){function H(I){return I<10?"0"+I:I;}return'"'+this.getUTCFullYear()+"-"+H(this.getUTCMonth()+1)+"-"+H(this.getUTCDate())+"T"+H(this.getUTCHours())+":"+H(this.getUTCMinutes())+":"+H(this.getUTCSeconds())+'Z"';};}A._toString=A.toString;A.toString=function(J){var H=this;if(J&&J.length==1){var K=D.formatPatterns;H.t=H.toString;switch(J){case"d":return H.t(K.shortDate);case"D":return H.t(K.longDate);case"F":return H.t(K.fullDateTime);case"m":return H.t(K.monthDay);case"r":return H.t(K.rfc1123);case"s":return H.t(K.sortableDateTime);case"t":return H.t(K.shortTime);case"T":return H.t(K.longTime);case"u":return H.t(K.universalSortableDateTime);case"y":return H.t(K.yearMonth);}}var I=function(L){switch(L*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return J?J.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(L){if(L.charAt(0)==="\\"){return L.replace("\\","");}H.h=H.getHours;switch(L){case"hh":return G(H.h()<13?(H.h()===0?12:H.h()):(H.h()-12));case"h":return H.h()<13?(H.h()===0?12:H.h()):(H.h()-12);case"HH":return G(H.h());case"H":return H.h();case"mm":return G(H.getMinutes());case"m":return H.getMinutes();case"ss":return G(H.getSeconds());case"s":return H.getSeconds();case"yyyy":return G(H.getFullYear(),4);case"yy":return G(H.getFullYear());case"dddd":return D.dayNames[H.getDay()];case"ddd":return D.abbreviatedDayNames[H.getDay()];case"dd":return G(H.getDate());case"d":return H.getDate();case"MMMM":return D.monthNames[H.getMonth()];case"MMM":return D.abbreviatedMonthNames[H.getMonth()];case"MM":return G((H.getMonth()+1));case"M":return H.getMonth()+1;case"t":return H.h()<12?D.amDesignator.substring(0,1):D.pmDesignator.substring(0,1);case"tt":return H.h()<12?D.amDesignator:D.pmDesignator;case"S":return I(H.getDate());default:return L;}}):this._toString();};}());(function(){var Q=Date,G=Q.prototype,R=Q.CultureInfo,K=Number.prototype;G._orient=+1;G._nth=null;G._is=false;G._same=false;G._isSecond=false;K._dateElement="day";G.next=function(){this._orient=+1;return this;};Q.next=function(){return Q.today().next();};G.last=G.prev=G.previous=function(){this._orient=-1;return this;};Q.last=Q.prev=Q.previous=function(){return Q.today().last();};G.is=function(){this._is=true;return this;};G.same=function(){this._same=true;this._isSecond=false;return this;};G.today=function(){return this.same().day();};G.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}return false;};G.at=function(W){return(typeof W==="string")?Q.parse(this.toString("d")+" "+W):this.set(W);};K.fromNow=K.after=function(W){var X={};X[this._dateElement]=this;return((!W)?new Date():W.clone()).add(X);};K.ago=K.before=function(W){var X={};X[this._dateElement]=this*-1;return((!W)?new Date():W.clone()).add(X);};var E=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),H=("january february march april may june july august september october november december").split(/\s/),J=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),L=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),B=("final first second third fourth fifth").split(/\s/),U;G.toObject=function(){var X={};for(var W=0;W<J.length;W++){X[J[W].toLowerCase()]=this["get"+L[W]]();}return X;};Q.fromObject=function(W){W.week=null;return Date.today().set(W);};var S=function(W){return function(){if(this._is){this._is=false;return this.getDay()==W;}if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}this._isSecond=false;var Y=this._nth;this._nth=null;var X=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(W,Y);if(this>X){throw new RangeError(Q.getDayName(W)+" does not occur "+Y+" times in the month of "+Q.getMonthName(X.getMonth())+" "+X.getFullYear()+".");}return this;}return this.moveToDayOfWeek(W,this._orient);};};var F=function(W){return function(){var Y=Q.today(),X=W-Y.getDay();if(W===0&&R.firstDayOfWeek===1&&Y.getDay()!==0){X=X+7;}return Y.addDays(X);};};for(var P=0;P<E.length;P++){Q[E[P].toUpperCase()]=Q[E[P].toUpperCase().substring(0,3)]=P;Q[E[P]]=Q[E[P].substring(0,3)]=F(P);G[E[P]]=G[E[P].substring(0,3)]=S(P);}var V=function(W){return function(){if(this._is){this._is=false;return this.getMonth()===W;}return this.moveToMonth(W,this._orient);};};var I=function(W){return function(){return Q.today().set({month:W,day:1});};};for(var O=0;O<H.length;O++){Q[H[O].toUpperCase()]=Q[H[O].toUpperCase().substring(0,3)]=O;Q[H[O]]=Q[H[O].substring(0,3)]=I(O);G[H[O]]=G[H[O].substring(0,3)]=V(O);}var C=function(W){return function(){if(this._isSecond){this._isSecond=false;return this;}if(this._same){this._same=this._is=false;var b=this.toObject(),a=(arguments[0]||new Date()).toObject(),Z="",Y=W.toLowerCase();for(var X=(J.length-1);X>-1;X--){Z=J[X].toLowerCase();if(b[Z]!=a[Z]){return false;}if(Y==Z){break;}}return true;}if(W.substring(W.length-1)!="s"){W+="s";}return this["add"+W](this._orient);};};var D=function(W){return function(){this._dateElement=W;return this;};};for(var N=0;N<J.length;N++){U=J[N].toLowerCase();G[U]=G[U+"s"]=C(J[N]);K[U]=K[U+"s"]=D(U);}G._ss=C("Second");var A=function(W){return function(X){if(this._same){return this._ss(arguments[0]);}if(X||X===0){return this.moveToNthOccurrence(X,W);}this._nth=W;if(W===2&&(X===undefined||X===null)){this._isSecond=true;return this.addSeconds(this._orient);}return this;};};for(var M=0;M<B.length;M++){G[B[M]]=(M===0)?A(-1):A(M);}}());(function(){Date.Parsing={Exception:function(I){this.message="Parse error at '"+I.substring(0,10)+" ...'";}};var A=Date.Parsing;var C=A.Operators={rtoken:function(I){return function(J){var K=J.match(I);if(K){return([K[0],J.substring(K[0].length)]);}else{throw new A.Exception(J);}};},token:function(I){return function(J){return C.rtoken(new RegExp("^s*"+J+"s*"))(J);};},stoken:function(I){return C.rtoken(new RegExp("^"+I));},until:function(I){return function(J){var K=[],M=null;while(J.length){try{M=I.call(this,J);}catch(L){K.push(M[0]);J=M[1];continue;}break;}return[K,J];};},many:function(I){return function(J){var M=[],K=null;while(J.length){try{K=I.call(this,J);}catch(L){return[M,J];}M.push(K[0]);J=K[1];}return[M,J];};},optional:function(I){return function(J){var K=null;try{K=I.call(this,J);}catch(L){return[null,J];}return[K[0],K[1]];};},not:function(I){return function(J){try{I.call(this,J);}catch(K){return[null,J];}throw new A.Exception(J);};},ignore:function(I){return I?function(J){var K=null;K=I.call(this,J);return[null,K[1]];}:null;},product:function(){var J=arguments[0],K=Array.prototype.slice.call(arguments,1),L=[];for(var I=0;I<J.length;I++){L.push(C.each(J[I],K));}return L;},cache:function(K){var I={},J=null;return function(L){try{J=I[L]=(I[L]||K.call(this,L));}catch(M){J=I[L]=M;}if(J instanceof A.Exception){throw J;}else{return J;}};},any:function(){var I=arguments;return function(K){var L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){L=null;}if(L){return L;}}throw new A.Exception(K);};},each:function(){var I=arguments;return function(K){var N=[],L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){throw new A.Exception(K);}N.push(L[0]);K=L[1];}return[N,K];};},all:function(){var J=arguments,I=I;return I.each(I.optional(J));},sequence:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;if(I.length==1){return I[0];}return function(O){var P=null,Q=null;var S=[];for(var N=0;N<I.length;N++){try{P=I[N].call(this,O);}catch(R){break;}S.push(P[0]);try{Q=J.call(this,P[1]);}catch(M){Q=null;break;}O=Q[1];}if(!P){throw new A.Exception(O);}if(Q){throw new A.Exception(Q[1]);}if(K){try{P=K.call(this,P[1]);}catch(L){throw new A.Exception(P[1]);}}return[S,(P?P[1]:O)];};},between:function(J,K,I){I=I||J;var L=C.each(C.ignore(J),K,C.ignore(I));return function(M){var N=L.call(this,M);return[[N[0][0],r[0][2]],N[1]];};},list:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return(I instanceof Array?C.each(C.product(I.slice(0,-1),C.ignore(J)),I.slice(-1),C.ignore(K)):C.each(C.many(C.each(I,C.ignore(J))),px,C.ignore(K)));},set:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return function(Y){var L=null,N=null,M=null,O=null,P=[[],Y],X=false;for(var R=0;R<I.length;R++){M=null;N=null;L=null;X=(I.length==1);try{L=I[R].call(this,Y);}catch(V){continue;}O=[[L[0]],L[1]];if(L[1].length>0&&!X){try{M=J.call(this,L[1]);}catch(W){X=true;}}else{X=true;}if(!X&&M[1].length===0){X=true;}if(!X){var S=[];for(var Q=0;Q<I.length;Q++){if(R!=Q){S.push(I[Q]);}}N=C.set(S,J).call(this,M[1]);if(N[0].length>0){O[0]=O[0].concat(N[0]);O[1]=N[1];}}if(O[1].length<P[1].length){P=O;}if(P[1].length===0){break;}}if(P[0].length===0){return P;}if(K){try{M=K.call(this,P[1]);}catch(U){throw new A.Exception(P[1]);}P[1]=M[1];}return P;};},forward:function(I,J){return function(K){return I[J].call(this,K);};},replace:function(J,I){return function(K){var L=J.call(this,K);return[I,L[1]];};},process:function(J,I){return function(K){var L=J.call(this,K);return[I.call(this,L[0]),L[1]];};},min:function(I,J){return function(K){var L=J.call(this,K);if(L[0].length<I){throw new A.Exception(K);}return L;};}};var H=function(I){return function(){var J=null,M=[];if(arguments.length>1){J=Array.prototype.slice.call(arguments);}else{if(arguments[0] instanceof Array){J=arguments[0];}}if(J){for(var L=0,K=J.shift();L<K.length;L++){J.unshift(K[L]);M.push(I.apply(null,J));J.shift();return M;}}else{return I.apply(null,arguments);}};};var G="optional not ignore cache".split(/\s/);for(var D=0;D<G.length;D++){C[G[D]]=H(C[G[D]]);}var F=function(I){return function(){if(arguments[0] instanceof Array){return I.apply(null,arguments[0]);}else{return I.apply(null,arguments);}};};var E="each any all".split(/\s/);for(var B=0;B<E.length;B++){C[E[B]]=F(C[E[B]]);}}());(function(){var E=Date,K=E.prototype,F=E.CultureInfo;var G=function(M){var N=[];for(var L=0;L<M.length;L++){if(M[L] instanceof Array){N=N.concat(G(M[L]));}else{if(M[L]){N.push(M[L]);}}}return N;};E.Grammar={};E.Translator={hour:function(L){return function(){this.hour=Number(L);};},minute:function(L){return function(){this.minute=Number(L);};},second:function(L){return function(){this.second=Number(L);};},meridian:function(L){return function(){this.meridian=L.slice(0,1).toLowerCase();};},timezone:function(L){return function(){var M=L.replace(/[^\d\+\-]/g,"");if(M.length){this.timezoneOffset=Number(M);}else{this.timezone=L.toLowerCase();}};},day:function(L){var M=L[0];return function(){this.day=Number(M.match(/\d+/)[0]);};},month:function(L){return function(){this.month=(L.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(L)/4:Number(L)-1;};},year:function(L){return function(){var M=Number(L);this.year=((L.length>2)?M:(M+(((M+2000)<F.twoDigitYearMax)?2000:1900)));};},rday:function(L){return function(){switch(L){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(L){L=(L instanceof Array)?L:[L];for(var N=0;N<L.length;N++){if(L[N]){L[N].call(this);}}var M=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=M.getDate();}if(!this.year){this.year=M.getFullYear();}if(!this.month&&this.month!==0){this.month=M.getMonth();}if(!this.day){this.day=1;}if(!this.hour){this.hour=0;}if(!this.minute){this.minute=0;}if(!this.second){this.second=0;}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.day>E.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}var O=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){O.set({timezone:this.timezone});}else{if(this.timezoneOffset){O.set({timezoneOffset:this.timezoneOffset});}}return O;},finish:function(L){L=(L instanceof Array)?G(L):[L];if(L.length===0){return null;}for(var Q=0;Q<L.length;Q++){if(typeof L[Q]=="function"){L[Q].call(this);}}var N=E.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else{if(this.now){N=new Date();}}var R=!!(this.days&&this.days!==null||this.orient||this.operator);var S,P,O;O=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){N.setTimeToNow();}if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;R=true;}}if(!R&&this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(!this.month){this.month=M.getMonth();}this.year=M.getFullYear();}if(R&&this.weekday&&this.unit!="month"){this.unit="day";S=(E.getDayNumberFromName(this.weekday)-N.getDay());P=7;this.days=S?((S+(O*P))%P):(O*P);}if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}if(this.month&&!this.day&&this.value){N.set({day:this.value*1});if(!R){this.day=this.value*1;}}if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;R=true;}if(R&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";S=(this.month-N.getMonth());P=12;this.months=S?((S+(O*P))%P):(O*P);this.month=null;}if(!this.unit){this.unit="day";}if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*O;}else{if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}this[this.unit+"s"]=this.value*O;}}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(M.getMonth()!==N.getMonth()){this.month=M.getMonth();}}if((this.month||this.month===0)&&!this.day){this.day=1;}if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}if(R&&this.timezone&&this.day&&this.days){this.day=this.days;}return(R)?N.add(this):N.set(this);}};var H=E.Parsing.Operators,D=E.Grammar,J=E.Translator,B;D.datePartDelimiter=H.rtoken(/^([\s\-\.\,\/\x27]+)/);D.timePartDelimiter=H.stoken(":");D.whiteSpace=H.rtoken(/^\s*/);D.generalDelimiter=H.rtoken(/^(([\s\,]|at|@|on)+)/);var A={};D.ctoken=function(P){var O=A[P];if(!O){var Q=F.regexPatterns;var N=P.split(/\s+/),M=[];for(var L=0;L<N.length;L++){M.push(H.replace(H.rtoken(Q[N[L]]),N[L]));}O=A[P]=H.any.apply(null,M);}return O;};D.ctoken2=function(L){return H.rtoken(F.regexPatterns[L]);};D.h=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),J.hour));D.hh=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2])/),J.hour));D.H=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),J.hour));D.HH=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3])/),J.hour));D.m=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.minute));D.mm=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.minute));D.s=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.second));D.ss=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.second));D.hms=H.cache(H.sequence([D.H,D.m,D.s],D.timePartDelimiter));D.t=H.cache(H.process(D.ctoken2("shortMeridian"),J.meridian));D.tt=H.cache(H.process(D.ctoken2("longMeridian"),J.meridian));D.z=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zz=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zzz=H.cache(H.process(D.ctoken2("timezone"),J.timezone));D.timeSuffix=H.each(H.ignore(D.whiteSpace),H.set([D.tt,D.zzz]));D.time=H.each(H.optional(H.ignore(H.stoken("T"))),D.hms,D.timeSuffix);D.d=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1]|\d)/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.dd=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1])/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.ddd=D.dddd=H.cache(H.process(D.ctoken("sun mon tue wed thu fri sat"),function(L){return function(){this.weekday=L;};}));D.M=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d|\d)/),J.month));D.MM=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d)/),J.month));D.MMM=D.MMMM=H.cache(H.process(D.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),J.month));D.y=H.cache(H.process(H.rtoken(/^(\d\d?)/),J.year));D.yy=H.cache(H.process(H.rtoken(/^(\d\d)/),J.year));D.yyy=H.cache(H.process(H.rtoken(/^(\d\d?\d?\d?)/),J.year));D.yyyy=H.cache(H.process(H.rtoken(/^(\d\d\d\d)/),J.year));B=function(){return H.each(H.any.apply(null,arguments),H.not(D.ctoken2("timeContext")));};D.day=B(D.d,D.dd);D.month=B(D.M,D.MMM);D.year=B(D.yyyy,D.yy);D.orientation=H.process(D.ctoken("past future"),function(L){return function(){this.orient=L;};});D.operator=H.process(D.ctoken("add subtract"),function(L){return function(){this.operator=L;};});D.rday=H.process(D.ctoken("yesterday tomorrow today now"),J.rday);D.unit=H.process(D.ctoken("second minute hour day week month year"),function(L){return function(){this.unit=L;};});D.value=H.process(H.rtoken(/^\d\d?(st|nd|rd|th)?/),function(L){return function(){this.value=L.replace(/\D/g,"");};});D.expression=H.set([D.rday,D.operator,D.value,D.unit,D.orientation,D.ddd,D.MMM]);B=function(){return H.set(arguments,D.datePartDelimiter);};D.mdy=B(D.ddd,D.month,D.day,D.year);D.ymd=B(D.ddd,D.year,D.month,D.day);D.dmy=B(D.ddd,D.day,D.month,D.year);D.date=function(L){return((D[F.dateElementOrder]||D.mdy).call(this,L));};D.format=H.process(H.many(H.any(H.process(H.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(L){if(D[L]){return D[L];}else{throw E.Parsing.Exception(L);}}),H.process(H.rtoken(/^[^dMyhHmstz]+/),function(L){return H.ignore(H.stoken(L));}))),function(L){return H.process(H.each.apply(null,L),J.finishExact);});var I={};var C=function(L){return I[L]=(I[L]||D.format(L)[0]);};D.formats=function(M){if(M instanceof Array){var N=[];for(var L=0;L<M.length;L++){N.push(C(M[L]));}return H.any.apply(null,N);}else{return C(M);}};D._formats=D.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);D._start=H.process(H.set([D.date,D.time,D.expression],D.generalDelimiter,D.whiteSpace),J.finish);D.start=function(L){try{var M=D._formats.call({},L);if(M[1].length===0){return M;}}catch(N){}return D._start.call({},L);};E._parse=E.parse;E.parse=function(L){var M=null;if(!L){return null;}if(L instanceof Date){return L;}try{M=E.Grammar.start.call({},L.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(N){return null;}return((M[1].length===0)?M[0]:null);};E.getParseFunction=function(M){var L=E.Grammar.formats(M);return function(N){var O=null;try{O=L.call({},N);}catch(P){return null;}return((O[1].length===0)?O[0]:null);};};E.parseExact=function(L,M){return E.getParseFunction(M)(L);};}());}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.Refine.FileSaver=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.FileSaver.saveAs=mstrmojo.Refine.FileSaver.saveAs||(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||(function(M){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return ;}var N=M.document,J=function(){return M.URL||M.webkitURL||M;},P=N.createElementNS("http://www.w3.org/1999/xhtml","a"),C=!M.externalHost&&"download" in P,Q=function(S){var R=N.createEvent("MouseEvents");R.initMouseEvent("click",true,false,M,0,0,0,0,0,false,false,false,false,0,null);S.dispatchEvent(R);},G=M.webkitRequestFileSystem,O=M.requestFileSystem||G||M.mozRequestFileSystem,D=function(R){(M.setImmediate||M.setTimeout)(function(){throw R;},0);},L="application/octet-stream",I=0,H=[],F=function(){var S=H.length;while(S--){var R=H[S];if(typeof R==="string"){J().revokeObjectURL(R);}else{R.remove();}}H.length=0;},K=function(S,R,W){R=[].concat(R);var V=R.length;while(V--){var X=S["on"+R[V]];if(typeof X==="function"){try{X.call(S,W||S);}catch(U){D(U);}}}},B=function(S,U){var V=this,b=S.type,e=false,X,W,R=function(){var f=J().createObjectURL(S);H.push(f);return f;},a=function(){K(V,"writestart progress write writeend".split(" "));},d=function(){if(e||!X){X=R(S);}if(W){W.location.href=X;}else{window.open(X,"_blank");}V.readyState=V.DONE;a();},Z=function(f){return function(){if(V.readyState!==V.DONE){return f.apply(this,arguments);}};},Y={create:true,exclusive:false},c;V.readyState=V.INIT;if(!U){U="download";}if(C){X=R(S);P.href=X;P.download=U;Q(P);V.readyState=V.DONE;a();return ;}if(M.chrome&&b&&b!==L){c=S.slice||S.webkitSlice;S=c.call(S,0,S.size,L);e=true;}if(G&&U!=="download"){U+=".download";}if(b===L||G){W=M;}if(!O){d();return ;}I+=S.size;O(M.TEMPORARY,I,Z(function(f){f.root.getDirectory("saved",Y,Z(function(g){var h=function(){g.getFile(U,Y,Z(function(j){j.createWriter(Z(function(k){k.onwriteend=function(l){W.location.href=j.toURL();H.push(j);V.readyState=V.DONE;K(V,"writeend",l);};k.onerror=function(){var l=k.error;if(l.code!==l.ABORT_ERR){d();}};"writestart progress write abort".split(" ").forEach(function(l){k["on"+l]=V["on"+l];});k.write(S);V.abort=function(){k.abort();V.readyState=V.DONE;};V.readyState=V.WRITING;}),d);}),d);};g.getFile(U,{create:false},Z(function(j){j.remove();h();}),Z(function(j){if(j.code===j.NOT_FOUND_ERR){h();}else{d();}}));}),d);}),d);},A=B.prototype,E=function(R,S){return new B(R,S);};A.abort=function(){var R=this;R.readyState=R.DONE;K(R,"abort");};A.readyState=A.INIT=0;A.WRITING=1;A.DONE=2;A.error=A.onwritestart=A.onprogress=A.onwrite=A.onabort=A.onerror=A.onwriteend=null;M.addEventListener("unload",F,false);E.unload=function(){F();M.removeEventListener("unload",F,false);};return E;}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content));if(typeof module!=="undefined"&&module!==null){module.exports=saveAs;}else{if((typeof define!=="undefined"&&define!==null)&&(define.amd!=null)){define([],function(){return saveAs;});}}String.prototype.endsWithAny=function(){var A=Array.prototype.slice.call(arguments),C=this.toLowerCase().toString();for(var B=0;B<A.length;B++){if(C.indexOf(A[B],C.length-A[B].length)!==-1){return true;}}return false;};mstrmojo.Refine.FileSaver.saveTextAs=mstrmojo.Refine.FileSaver.saveTextAs||(function(B,G,F){G=G||"download.txt";F=F||"utf-8";B=(B||"").replace(/\r?\n/g,"\r\n");if(mstrmojo.Refine.FileSaver.saveAs&&Blob){var A=new Blob([B],{type:"text/plain;charset="+F});mstrmojo.Refine.FileSaver.saveAs(A,G);return true;}else{var C=window.frames.saveTxtWindow;if(!C){C=document.createElement("iframe");C.id="saveTxtWindow";C.style.display="none";document.body.insertBefore(C,null);C=window.frames.saveTxtWindow;if(!C){C=window.open("","_temp","width=100,height=100");if(!C){window.alert("Sorry, download file could not be created.");return false;}}}var D=C.document;D.open("text/plain","replace");D.charset=F;if(G.endsWithAny(".htm",".html")){D.close();D.body.innerHTML="\r\n"+B+"\r\n";}else{if(!G.endsWithAny(".txt")){G+=".txt";}D.write(B);D.close();}var E=D.execCommand("SaveAs",null,G);C.close();return E;}});}());(function(){var D=mstrmojo.DI.DIConstants;mstrmojo.DI.OAuthSource=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.OAuthSource",type:-1,clientID:"",state:"",accessToken:"",refreshToken:"",revokeUrl:"",locale:"",reports:null,userDisplayName:null,userEmail:null,reset:function(){this.accessToken="";this.refreshToken="";this.reports=null;this.userDisplayName=null;this.instanceUrl=null;this.sourceAccountID=null;this.said=null;this.locale="";this.idUrl=null;this.signature=null;this.userEmail=null;},populate:function G(I){if(I.id){this.idUrl=I.id;}if(I.instance_url){this.instanceUrl=I.instance_url;}if(I.signature){this.signature=I.signature;}if(I.refresh_token){this.refreshToken=I.refresh_token;}if(I.access_token){this.accessToken=I.access_token;}if(I.display_name){this.userDisplayName=I.display_name;}if(I.name){this.userDisplayName=I.name;}if(I.id){this.sourceAccountID=I.id;}if(I.uid){this.sourceAccountID=I.uid;}if(I.locale){this.locale=I.locale;}},populateReports:function C(I,M,J){this.reports=I;var K;if(I.mi.sinf){var L=I.mi.sinf.stkn;if(L){for(K=0;K<L.length;K++){if(L[K].n=="SESSION_ID"){this.accessToken=L[K].v;}if(L[K].n=="SERVER_URL"){this.instanceUrl=L[K].v;}if(L[K].n=="REFRESH_TOKEN"){this.refreshToken=L[K].v;}if(L[K].n==="INSTANCE_URL"){this.instanceUrl=L[K].v;}}}this.set("userDisplayName",I.mi.sinf.un);this.set("userEmail",I.mi.sinf.ea||"");this.said=I.mi.sinf.said;this.sourceAccountID=I.mi.sinf.said;if(I.mi.sinf.said.indexOf("#said:")===0){this.said=I.mi.sinf.said.substr(6);this.sourceAccountID=I.mi.sinf.said.substr(6);}this.locale=I.mi.sinf.lcldn||"";if(I.mi.sinf.picurl){this.picurl=I.mi.sinf.picurl;}}if(!J){this.raiseEvent({name:"oAuthReportsFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id,isRefresh:M});}else{if(mstrmojo.hash.walk("diParams.isSparkCube",mstrApp)){this.raiseEvent({name:"oAuthReportsFetched",targetPageId:mstrApp.getRootController().rootView.id,isRefresh:M});}}},getSourceParams:function E(){var I={accessToken:this.accessToken,clientID:this.clientID,clientSecret:this.clientSecret||"",instanceURL:(this.instanceUrl==null||this.instanceUrl==="")?"test":this.instanceUrl,userDisplayName:this.userDisplayName,locale:this.locale===""?"en_US":this.locale};if(this.refreshToken){I.refreshToken=this.refreshToken;}I.dbRoleID=this.dbRoleID;if(this.sourceAccountID){I.sourceAccountID=this.sourceAccountID;}return I;},getSourceInfoParam:function F(I){var J={dbRoleID:this.dbRoleID,locale:this.locale===""?"en_US":this.locale};if(this.userDisplayName){J.userDisplayName=this.userDisplayName;}if(I&&this.sourceAccountID){J.sourceAccountID=this.sourceAccountID;}return J;},parseOAuthSourceFolder:function A(O){var P=[],S;var K=this.isArray(O.mi.ftree.fd)?O.mi.ftree.fd:this.makeArray(O.mi.ftree.fd);var N=this.isArray(O.mi.ftree.fl)?O.mi.ftree.fl:this.makeArray(O.mi.ftree.fl);var I,U,L,J,V,R,M,Q;for(L=0;L<K.length;L++){I=K[L];V={isFolder:true};V.n=I.n.toString();V.desc=I.des;V.address=I.address;V.type=0;M=this.isArray(I.fl)?I.fl:this.makeArray(I.fl);S=[];for(J=0;J<M.length;J++){Q=M[J];R={isFolder:false};R.address=Q.address;R.desc=Q.des;R.type=Q.minetype;R.n=Q.n.toString();R.folderPath=V.n;S.push(R);}if(S.length>0){V.cItem=S;}P.push(V);}for(L=0;L<N.length;L++){U=N[L];V={isFolder:false};V.n=U.n.toString();V.address=U.address;V.type=U.mimetype;V.desc=U.des;if(typeof U.FileSize==="number"){V.size=U.FileSize;}P.push(V);}return P;},isArray:function B(I){return(Object.prototype.toString.call(I)==="[object Array]");},makeArray:function H(){var J=[];var I;for(I=0;I<arguments.length;I++){if(arguments[I]!==undefined){J.push(arguments[I]);}}return J;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.DI.model.Schedule=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.model.Schedule",subsID:null,subsName:null,trgName:null,trgID:null,curTrg:null,availableTriggers:[],isSendNow:false,isScheduleAdvanced:false,oldIsScheduleAdvanced:false,showAdvanceState:false,populateTriggers:function A(B){var C=B&&B.objList;C=C&&[].concat(C);this.set("availableTriggers",C||[]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");mstrmojo.requiresDescs(889);var D=mstrmojo.hash;var I=mstrmojo.desc(889,"Please wait...");function F(S,R){var P=R.showWait,Q=R.suppressError,O=R.waitMsg;delete R.showWait;delete R.suppressError;delete R.waitMsg;mstrApp.serverRequest(R,S,P,Q,O);}mstrmojo.qb.mdx.DataService=mstrmojo.provide("mstrmojo.qb.mdx.DataService",{submitRequest:function C(P,O){F.call(this,P,O);},pollingStatus:function N(U,O,R){var Q=this;if(mstrApp.isSingleTier){if(U.success){U.success(O);}return ;}F.call(Q,{success:function S(V){if(V.status==="1"){if(U.success){U.success(O);}}else{Q.pollingStatus(U,O,R);}},failure:function P(V){if(U.failure){U.failure(V);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:R});},addCubes:function E(R,Q){var O=this;F.call(this,{success:function P(S){mstrApp.msgid=S.msgid;O.pollingStatus(R,S,I);}},D.copy(Q,{taskId:"qBuilder.AddMDXCubes",showWait:true,waitMsg:I}));},updateCubes:function L(R,Q){var O=this;F.call(this,{success:function P(S){mstrApp.msgid=S.msgid;O.pollingStatus(R,S,I);}},D.copy(Q,{taskId:"qBuilder.UpdateMDXCubes",showWait:true,waitMsg:I}));},setDBRole:function G(R,Q){var O=this;F.call(this,{success:function P(S){mstrApp.msgid=S.msgid;O.pollingStatus(R,S,I);}},D.copy(Q,{taskId:"qBuilder.SetDBRole",showWait:true,waitMsg:I}));},search:function M(P,O){F.call(this,P,D.copy(O,{taskId:"arch.search",showWait:true}));},searchFolderContents:function K(P,O){F.call(this,P,D.copy(O,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:I});},createEmmaTable:function B(R,Q){var O=this;F.call(O,{success:function P(S){mstrApp.msgid=S.msgid;O.pollingStatus(R,S,I);}},D.copy(Q,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:I}));},createEmmaInstance:function H(R,Q){var O=this;F.call(O,{success:function P(S){mstrApp.msgid=S.msgid;O.pollingStatus(R,S,I);}},D.copy(Q,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:I}));},getObjectFolder:function J(P,O){F.call(this,P,D.copy(O,{taskId:"DIGetObjectFolder",showWait:true,waitMsg:I}));},getObjectInfo:function A(P,O){F.call(this,P,D.copy(O,{taskId:"getObjectInfo"}),{showProgress:true,showProgressText:true,progressText:I});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array");var C=mstrmojo.array;mstrmojo.ObjectBrowserDataProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ObjectBrowserDataProvider",path:mstrConfig.taskURL,serverRequest:function(D,E){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(D,E,{silent:true});}else{mstrmojo.xhr.request("POST",this.path,E,D,undefined,this.XServer,this.baseParams);}},fetchFolderContents:function(D,E,H){var F=D.blockCount,G={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockCount:F,includeAncestorInfo:"true",includeObjectDesc:D.includeObjectDesc,encodeObjectInfo:false};if(D.folderLinksContextId){G.folderLinksContextId=D.folderLinksContextId;}if(D.sId){G.sessionState=D.sId;}if(E.fid){G.rootFolderID=E.fid;}else{if(E.fty){G.rootFolderType=E.fty;}}if(D.browsableTypes){G.objectType=D.browsableTypes;}if(E.blockBegin){G.blockBegin=E.blockBegin;}if(E.searchPattern){if(D.enableQuickSearch){G.quickSearch=D.enableQuickSearch;}G.searchPattern=E.searchPattern;if(E.recursive){G.recursive=E.recursive;}}this.serverRequest(G,H);},newFolder:function(G,H,F,D){var E={taskId:"createFolder",taskContentType:"json",folderID:G,name:H,description:F};this.serverRequest(E,D);},loadObjects:function B(H,I,D,G){var E=[],F=[];C.forEach(H,function(J){E.push(J.did);F.push(J.t);});if(H.length>0&&G){this.serverRequest({taskId:"getObjectInfo",objectIDs:E.join(","),objectTypes:F.join(","),includeDetails:true},I,D);}else{I.success();}},loadRecentSaveAsFolders:function A(E){var D={taskId:"getRecentSaveAsFolders"};this.serverRequest(D,E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.architect.EnumColumnDataTypes");var S=mstrmojo.func.wrapMethods,J=mstrmojo.hash,O=mstrmojo.array,G=mstrmojo.string,U=26,L=15,Q=mstrmojo.desc(11428,"[unknown]"),B=mstrmojo.architect.EnumColumnDataTypes,I=mstrmojo.warehouse.EnumDataChangeEvents,H=I.DBTABLES_CHANGED;function E(X){var W,Y=X.tp;W=(Y===undefined?X:B[Y].n);return("["+(W||Q)+"]");}function F(W){return G.decodeHtmlString(W).replace(/&apos;/g,"'");}mstrmojo.qb.bigquery._hasBigQueryModel=mstrmojo.provide("mstrmojo.qb.bigquery._hasBigQueryModel",{projects:[],datasets:[],warehouseTables:{},selectedProject:undefined,selectedDataset:undefined,isBigQuery:true,getColDataType:function M(X){var W=X.dt.tp;return W===undefined?X.dt:W;},loadDBRoles:function A(X){var W=this;mstrApp.getRootController().getDataService().submitRequest(S({success:function(a){var Z=a.mi.gbqht.gbqp,b=[],Y;if(!Z){Z=[];}if(!(Z instanceof Array)){Z=[Z];}O.forEach(Z,function(d){Y=d.n||d.id;b.push(J.copy({did:String(d.id),n:Y,des:Y,tp:29,isPrimary:function c(){return this.data.isPrimary;},data:{isPrimary:false}},d));});W.set("projects",b);W.raiseEvent({name:I.DBROLES_LOADED,items:b});}},X),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,flags:64,showWait:true});},_set_selectedProject:function R(Y,W){var X=this;this.selectedProject=W;this.selectedDataset=undefined;this.SelDBRoleID=undefined;this.set("SelDBRoleID",mstrApp.dbroleID);O.forEach(X.projects,function(Z){if(Z.data.isPrimary){Z.data.isPrimary=false;X.raiseEvent({name:I.DBROLE_CHANGED,item:Z});}if(Z.did==W){Z.data.isPrimary=true;X.raiseEvent({name:I.DBROLE_CHANGED,item:Z});}});this.getDatasets();},getAccountInfo:function V(X,W,Y){mstrApp.getRootController().getDataService().submitRequest({success:function(Z){Y&&Y(Z);}},{taskId:"qBuilder.FetchSourceObjects",sourceAccountID:X,dbRoleID:W,flags:2,showWait:true});},getProject:function N(X){var W=null;O.forEach(this.projects,function(Y){if(X===Y.id){W=Y;return false;}});return W;},getDatasets:function C(){var X=this,W=X.selectedProject;X.raiseEvent({name:H,items:[],selectedItems:[]});X.raiseEvent({name:I.NAMESPACES_REQUESTED});mstrApp.getRootController().getDataService().submitRequest({success:function(Z){var a=Z.mi.gbqht.gbqp.gbqd,Y=[];if(!a){a=[];}if(!(a instanceof Array)){Y.push({n:a.id||mstrmojo.desc(16211,"There is no namespace"),cls:(a.id?"":"disabled")});}else{O.forEach(a,function(b){Y.push({n:b.id});});}X.datasets=Y;X.raiseEvent({name:I.NAMESPACES_CHANGED,namespaces:Y,usecCache:Y.length,dbRoleID:W});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:W,flags:64,showWait:true});},onselectedDatasetChange:function K(W){this.selectedDataset=W.value;this.getDatasetTables({blockBegin:0,blockCount:1000,filterText:""});},getDatasetTables:function D(a,d){var b=this,g=b.selectedProject,e=b.selectedDataset,Z=a.filterText,f,X=false,c=[],W=[],Y;Y=b.warehouseTables[g]=b.warehouseTables[g]||{};if(!b.catalogRefresh&&e&&(Y[e]!==undefined)){J.forEach(Y[e],function(k,j){X=true;f={id:k.id,n:j,did:j,dbtn:j,st:8405,tag:k,ns:k.ns,tp:L,isVisible:function h(){},items:[]};if(Z!==""&&j.toUpperCase().indexOf(Z.toUpperCase())>-1){c.push(f);}W.push(f);});if(X){b.raiseEvent({name:H,items:(Z!=="")?c:W,selectedItems:[],keyword:Z});return ;}}b.raiseEvent({name:I.DBTABLES_REQUESTED,sourceInfo:a.sourceInfo||""});mstrApp.getRootController().getDataService().submitRequest({success:function(l){var n=l.mi.gbqht.gbqp.gbqd,k=n&&n.gbqt,j=[],h,m;b.catalogRefresh=false;b.selectedDataset=e=n.id;m=Y[e]={};if(!k){k=[];}if(!(k instanceof Array)){k=[k];}O.forEach(k,function(o){h=o.id;f={n:h,id:h,ns:g+"."+e,did:h,dbtn:h,st:8405,tag:o,tp:L,isVisible:function(q,p){return b.handleVisibleAction(q,p);},isChecked:function(q,p){return b.handleCheckAction(q,p);},isEnabled:function(q,p){return b.handleEnabledAction(q,p);},items:[]};m[h]=f;j.push(f);});b.raiseEvent({name:H,items:j,selectedItems:[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:g,dsid:e,flags:64,showWait:true});},getColumnsForDBTable:function P(X,b){var a=this,g=a.selectedProject,Y=X.getFresh,Z=X.data,f=Z.datasetID||a.selectedDataset,c=Z.did,d=Z.n,W;if(!Y){W=a.warehouseTables[g]&&a.warehouseTables[g][f][c].columns;if(W){b.success({src:X,items:W,selDBRole:f});a.raiseEvent({name:"dbTablesPopulated",items:{id:c,n:d,items:W}});if(b&&b.complete){b.complete();}return ;}}mstrApp.getRootController().getDataService().submitRequest(S({success:function e(k){var j=k.mi.gbqcs.gbqc,h=[],l;O.forEach(j,function(n){l=F(n.id);h.push({n:l+": "+E(n.dt),cln:n.id,dt:n.dt,id:n.id,did:l,st:26,tp:U,isVisible:function m(){}});});if((h.length>0)&&!Y){a.warehouseTables[g][f][c].columns=h;}k.items=h;}},b),{taskId:"qBuilder.FetchSourceObjects",dbRoleID:mstrApp.dbrid,sourceAccountID:mstrApp.said,gbqpid:g,dsid:f,tbid:c,flags:1,showWait:true});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo._Fetchable");var A=mstrmojo.hash;mstrmojo.mstr.DocElementDataHelper=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._Fetchable],{scriptClass:"mstrmojo.mstr.DocElementDataHelper",source:null,items:null,browseConfig:null,concat:true,init:function(B){var C=B&&B.browseConfig;this.blockBegin=(C&&C.blockBegin)||1;this.blockCount=(C&&C.blockCount)||mstrApp.elementsBlockCount||30;if(this._super){this._super(B);}},getBrowseConfig:function(){if(!this.browseConfig){this.browseConfig={blockBegin:this.blockBegin,blockCount:this.blockCount};}return this.browseConfig;},_retrieveItems:function(E,C,B){var D=this.getBrowseConfig();D.blockBegin=E;mstrmojo.func.override({success:function(F){if(this._super){this._super(mstrmojo.hash.copy(F,{items:F.es,totalSize:F.sz}));}}},C);this.source.browseElements(D,C,B);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var D={TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};var C={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};mstrmojo.ui.PopupConfig=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ui.PopupConfig",ENUM_CORNERS:D,isHostedWithin:true,position:null,hostProxyCssClass:"",hostId:"",hostElement:null,anchorElement:null,popupHandlers:null,alignment:null,alignWithAnchor:false,useTooltip:false,useDarkTheme:false,init:function H(I){this.clear();this._super(I);},setAlignment:function E(I,J){this.alignment={host:I,popup:J};},addPopupHandlers:function F(I,K,J){this.popupHandlers[I]={open:K,close:J};},clear:function B(){this.popupHandlers={};var I=this.ENUM_CORNERS;this.alignment={host:I.BOTTOM_LEFT,popup:I.TOP_LEFT};},destroy:function(I){this.anchorElement=null;this.hostElement=null;if(this._super){this._super(I);}}});mstrmojo.ui.PopupConfig.ENUM_CORNERS=D;mstrmojo.ui.PopupConfig.directionCfg={menuDirection:C.LEFT_TO_RIGHT,isRightToLeft:function G(){return this.menuDirection===C.RIGHT_TO_LEFT;},setDirection:function A(I){this.menuDirection=I?C.RIGHT_TO_LEFT:C.LEFT_TO_RIGHT;}};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.ui._HasUITheme","mstrmojo.vi.ui.theme","mstrmojo.dom");function g(h,k){if(!mstrmojo.DocInfoWindow){return ;}var j=h;while(j){if(j instanceof mstrmojo.DocInfoWindow){j[k?"registerScrollLock":"releaseScrollLock"](this);break;}j=j.parent;}}var N=mstrmojo.array,D=mstrmojo.dom,S=mstrmojo.hash,e=mstrmojo.css,G="px",K=mstrmojo.ui._HasUITheme.EnumThemeNames;var C=false;function M(h,k){if(!mstrmojo.DocInfoWindow){return ;}var j=h;while(j){if(j instanceof mstrmojo.DocInfoWindow){j[k?"registerLock":"releaseLock"](this);this.lockIW=k?j:null;break;}j=j.parent;}}var W=mstrmojo.ui.PopupConfig,O=W.directionCfg,B=W.ENUM_CORNERS,Z=B.TOP_LEFT,V=B.TOP_RIGHT,I=B.BOTTOM_RIGHT,H=B.BOTTOM_LEFT;function J(h){return(h===H||h===Z);}function d(h){return(h===V||h===I);}function Q(h){return(h===I||h===H);}function U(h){return(h===V||h===Z);}function a(q,k,AC,AI){var AL=AC.x,AK=AC.y,AH=AC.w||0,w=AC.h||0,j=AI.w,AD=AI.h,AG=q.alignment,o=AG.popup,m=AG.host,AJ=d(m),AM=Q(m),AF=false,AA=false,l=false,AB=false,n=false,x=false,AE=D.isMobile,t=mstrmojo.ui.PopupConfig.directionCfg;if(J(o)){var p=AL+j+(AJ?AH:0);AF=k.w<p;n=AE&&(AF||t.isRightToLeft());}if(U(o)){var z=AK+AD+(AM?w:0);AA=k.h<z;x=AE&&AA;}if(d(o)||n){var u=AL-j+((AJ&&!n)?AH:0);l=u<0;}if(Q(o)||x){var h=AK-AD+((AM&&!x)?w:0);AB=h<0;}return{top:AB,bottom:AA,left:l,right:AF};}function F(j){var h=this.popupConfig;if(h){S.forEach(h.popupHandlers,function(l,m){var k=l[j?"open":"close"];if(k){k.call(mstrmojo.all[m]||k,!!j);}});}}function L(j){var h=this.popupConfig;if(h&&!h.isHostedWithin){var k=this.hostProxy;if(k){k.style.display=j?"":"none";}}}function f(h){return h!==undefined&&h!==null&&!isNaN(h);}mstrmojo._IsPopup={visible:false,lockIWForScroll:false,disposable:true,opener:null,onOpen:mstrmojo.emptyFn,onClose:mstrmojo.emptyFn,popupConfig:null,hostProxy:undefined,open:function P(k,h){F.call(this,true);if(this.updatePopupConfig){this.updatePopupConfig(h,k);}else{S.forEach(h,function(n,m){this.set(m,n);},this);}var j="popup-mid-render";this.set("opener",k);if(!this.hasRendered){var l=this.visible;this.visible=false;this.render();e.addClass(this.domNode,j);this.set("visible",l);}if(this.nudge){this.domNode.style.top="-10000px";}L.call(this,true);this.set("visible",true);if(this.lockIWForScroll){g.call(this,this.opener,true);}if(h&&h.lockIW){M.call(this,h.lockIW,true);}if(this.nudge){this.nudge();}if(this.adjustSize){this.adjustSize();}this.adjustCornersForPopupOverflow();this.onOpen();e.removeClass(this.domNode,j);},adjustCornersForPopupOverflow:function b(){var u=this.popupConfig;if(!u){return false;}var Aa=(u.includeScroll!==undefined)?u.includeScroll:true;var n=u.anchorElement||u.hostElement,l=u.position||D.position(n,Aa),AG=n&&n.style&&n.style.zIndex;if(!u.isHostedWithin){var Ai=this.hostProxy,AZ=this.hostProxy=document.createElement("div");document.body.appendChild(AZ);AZ.appendChild(this.domNode);if(Ai){Ai.parentNode.removeChild(Ai);}var AQ=AZ.style,AR={x:"left",y:"top",w:"width"};AZ.className=u.hostProxyCssClass;AQ.position="absolute";AQ.background="none";e.addClass(AZ,"mstrmojo-popup-widget-hosted");AQ.height="0";N.forEach(["x","y","w"],function(Ar){var Aq=l[Ar];if(f(Aq)){AQ[AR[Ar]]=Aq+G;}});}var AF=u.ENUM_CORNERS,Ao=AF.BOTTOM_LEFT,AS=AF.BOTTOM_RIGHT,j=AF.TOP_RIGHT,AL=AF.TOP_LEFT;var q=D.position(document.body),AU=D.position(this.domNode),Ad=a(u,q,l,AU),p=Ad.right,AE=Ad.bottom,Ap=Ad.left,AY=Ad.top,AH=u.alignment,AP=AH.popup,k=AH.host,z=AP,AD=k,AT=D.isMobile,AC=n&&n.classList&&n.classList.contains("mstrmojo-ui-Menu-item"),AV=this.id,AA=n&&n.parentNode,AW=AA&&AA.parentElement,AO=n||this.domNode,AM,Aj=this.domNode.style;if(AW&&AW.classList.contains("mstrmojo-ui-Menu")){AO=AW;}AM=D.position(AO);if(AC&&((Ap&&p)||(AY&&AE))){if(AW){Aj.top=AM.y+"px";Aj.left=AM.x+"px";var Ah=document.getElementsByClassName("mstrmojo-ui-Menu");N.forEach(Ah,function(Aq){if(AV!==Aq.id){Aq.style.visibility="hidden";}});}u.anchorElement=AO;u.position={h:0,w:0,x:(AM.x+AU.w)>q.w?Math.min(AM.x,5):AM.x,y:(AM.y+AU.h)>q.h?Math.min(AM.y,90):AM.y};this.adjustCornersForPopupOverflow();return ;}if(O.isRightToLeft()&&(!AT||AU.w>0)){if(!AT||!Ap){p=true;}else{if(!AT||!p){O.setDirection(false);this.resetDirection=true;if(AT){AD=(AD===j)?AL:Ao;}}}}else{if(p){O.setDirection(true);this.resetDirection=true;}}if(p||Ap){if(J(AD)){AD=U(AD)?j:AS;}else{if(d(AD)){AD=U(AD)?AL:Ao;}}if(p&&J(z)){z=U(z)?j:AS;}else{if(Ap&&d(z)){z=U(z)?AL:Ao;}}}if(AE||AY){if(J(AD)){AD=U(AD)?Ao:AL;}else{if(d(AD)){AD=U(AD)?AS:j;}}if(AE&&U(z)){z=J(z)?Ao:AS;}else{if(AY&&Q(z)){z=J(z)?AL:j;}}}if(AY||p||AE||Ap){if(C){console.log("Overflow directions: "+JSON.stringify(Ad));}this._orgalgn={host:k,popup:AP};u.setAlignment(AD,z);}if(!u.isHostedWithin){if(f(l.y)&&f(l.h)){this.hostProxy.style.top=(l.y+(Q(z)?(u.alignWithAnchor===true?l.h:0):(u.alignWithAnchor===true?0:l.h)))+G;this.hostProxy.style.zIndex=(f(AG)&&(AG>100))?AG+1:101;}}var AX,Al={};if(u.isHostedWithin&&!!this.opener){AX=e.getComputedStyle(this.opener.domNode);}N.forEach(["left","right","top","bottom"],function(Aq){Al[Aq]=AX?parseInt(AX["border-"+Aq+"-width"]||0,10):0;});var Af=Q(AD),Ag=d(AD),x=Q(z),o=d(z),Ab=function(Ar,Aq){return"calc(100% + "+(Aq?Al[Ar]:0)+"px)";},AB=function(Ar,Aq){return(Aq?-Al[Ar]:0)+"px";};var t,Ac,h,m;t=Ac=h=m="auto";if(x){h=Af?AB("top"):Ab("top");}else{t=Af?Ab("bottom"):AB("bottom");}if(o){Ac=Ag?AB("left"):Ab("left");}else{m=Ag?Ab("right"):AB("right");}Aj.top=t;Aj.right=Ac;Aj.bottom=h;Aj.left=m;var w=D.position(this.domNode),AN=5;if(AE||AY){var Am=w.y,AI=D.getMaxScrollHeight()+"px",Ak=this.scrollNode,AJ=Ak&&Ak.style.maxHeight;if(Am<0||(Am+w.h>q.h)){if(Ak&&AI!==AJ){Ak.style.maxHeight=AI;this.updateScrollbars();}var Ae=(-l.y+AN)+G;if(!u.isHostedWithin){if(this.hostProxy){this.hostProxy.style.top=0;}Ae=AN+G;}Aj.top=Ae;Aj.bottom="auto";}}if(Ap||p){var An=w.x;if(An<0||(An+w.w>q.w)){var AK=(-l.x+AN)+G;if(!u.isHostedWithin){if(this.hostProxy){this.hostProxy.style.left=0;}AK=AN+G;}Aj.left=AK;Aj.right="auto";}}return true;},close:function R(j){if(this.keepOpen){return ;}if(this.onClose){this.onClose(j);}L.call(this,false);if(this.lockIWForScroll){g.call(this,this.opener,false);}this.set("visible",false);this.set("opener",null);if(this.lockIW){M.call(this,this.lockIW,false);}F.call(this,false);var h=this._orgalgn;if(h){this.popupConfig.setAlignment(h.host,h.popup);}if(this.resetDirection){this.resetDirection=false;O.setDirection(false);}},preBuildRendering:function A(j){this._super(j);var m=this.popupConfig;if(m&&!m.isHostedWithin){var h=m.hostProxyCssClass.split(" "),l=false;N.forEach(S.keyarray(K),function(n){if(h.indexOf(K[n])>=0){l=true;return false;}});if(!(l||m.noInheritTheme)){var k=mstrmojo.vi.ui.theme.getThemeClass.call(this);if(k){h.push(k);}}m.hostProxyCssClass=h.join(" ");}},buildRendering:function E(){var h=this._super();if(h){if(!this.parent&&!this.domNode.parentElement){document.body.appendChild(this.domNode);}}return h;},postBuildRendering:function Y(){var h=this,j=this.popupConfig;if(j&&!this._ListenerProc){this._ListenerProc=function(){h.monitorWindow();};D.attachEvent(window,"resize",this._ListenerProc);}this._super();},monitorWindow:function(){var j=D.getMaxScrollHeight();if(this.updateScrollbars&&this.scrollNode){this.scrollNode.style.maxHeight=(this.scrollNodeMaxHeight||j)+"px";this.updateScrollbars();}if(this.visible){var h=this,k=null;window.clearTimeout(k);k=window.setTimeout(function(){h.scrollNode.style.maxHeight=(h.scrollNodeMaxHeight||j)+G;h.adjustCornersForPopupOverflow();},175);}},destroy:function c(h){if(this._ListenerProc){D.detachEvent(window,"resize",this._ListenerProc);delete this._ListenerProc;}this._super(h);},unrender:function X(h){if(this.popupConfig&&!this.popupConfig.isHostedWithin&&this.hostProxy){document.body.removeChild(this.hostProxy);delete this.hostProxy;}this._super(h);}};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.OAuthSource","mstrmojo.DI.DIConstants");mstrmojo.DI.OAuthAnalytics=mstrmojo.declare(mstrmojo.DI.OAuthSource,null,{scriptClass:"mstrmojo.DI.OAuthAnalytics",accounts:[],onGetAnalyticsWebProperties:{},onGetAnalyticsProfiles:{},reset:function(){this.accounts=[];this.onGetAnalyticsProfiles={};this.onGetAnalyticsProfiles={};this._super();},populateReports:function B(H,J,I){if(H.mi.ght){this.accounts=this.isArray(H.mi.ght.gacc)?H.mi.ght.gacc:this.makeArray(H.mi.ght.gacc);}if(this._super){this._super(H,J,I);}if(this.accounts&&this.accounts[0]){this.populateWebProperties(H,this.accounts[0].id,I);this.populateProfiles(H,this.accounts[0].id,this.accounts[0].webProperties[0].id,I);}},populateWebProperties:function G(I,N,J){var L=this.isArray(I.mi.ght.gacc)?I.mi.ght.gacc:this.makeArray(I.mi.ght.gacc);var H=mstrmojo.array.find(L,"id",N);var O=null;if(H===-1){return ;}O=L[H];for(var K=0;K<this.accounts.length;K++){var M=this.accounts[K];if(M.id===N){M.webProperties=this.isArray(O.gprp)?O.gprp:this.makeArray(O.gprp);break;}}if(!J){this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}},checkWebProperties:function C(J,I){var H=this.getAccountById(J);if(!H){return false;}if(H.webProperties){if(I){this.raiseEvent({name:"analyticsWebPropertiesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},populateProfiles:function E(U,H,J,N){var S,O,P,I,Q;S=this.isArray(U.mi.ght.gacc)?U.mi.ght.gacc:this.makeArray(U.mi.ght.gacc);Q=mstrmojo.array.find(S,"id",H);if(Q===-1){return ;}P=S[Q];O=this.isArray(P.gprp)?P.gprp:this.makeArray(P.gprp);Q=mstrmojo.array.find(O,"id",J);if(Q===-1){return ;}I=O[Q];for(var L=0;L<this.accounts.length;L++){var M=this.accounts[L];if(M.id===H){for(var K=0;K<M.webProperties.length;K++){var R=M.webProperties[K];if(R.id===J){R.profiles=this.isArray(I.gprf)?I.gprf:this.makeArray(I.gprf);break;}}break;}}if(!N){this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id,accountID:H,webPropertyID:J});}},checkProfiles:function F(M,L,K){var J,I,H;J=this.getAccountById(M);if(!this.checkWebProperties(M,false)){return false;}H=mstrmojo.array.find(J.webProperties,"id",L);if(H===-1){return false;}I=J.webProperties[H];if(I.profiles){if(K){this.raiseEvent({name:"analyticsProfilesFetched",targetPageId:mstrApp.getRootController().rootView.currentPage.id});}return true;}else{return false;}},getAccountById:function D(J){var H=0;var I=null;for(H=0;H<this.accounts.length;H++){if(this.accounts[H].id===J){I=this.accounts[H];break;}}return I;},parseOAuthSourceFolder:function A(L){var I=[];var N=this.isArray(L.mi.ftree.fd)?L.mi.ftree.fd:this.makeArray(L.mi.ftree.fd);var H=this.isArray(L.mi.ftree.fl)?L.mi.ftree.fl:this.makeArray(L.mi.ftree.fl);var K,O,J,M;for(J=0;J<N.length;J++){K=N[J];M={isFolder:true};M.n=K.n;M.desc=K.des;M.address=K.address;M.type=0;I.push(M);}for(J=0;J<H.length;J++){O=H[J];M={isFolder:false};M.edit=true;M.n=O.n;M.desc=O.des;M.address=O.address;M.type=O.mimetype;I.push(M);}return I;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.obj.TableData");mstrmojo.requiresDescs(4572,11138,3651);var H=mstrmojo.array,G=mstrmojo.warehouse.dbroles.DBRoleHelper,C="PWDHIDDEN123!@#",A=mstrmojo.desc(4572,"Primary"),D=mstrmojo.warehouse.EnumObjectTypes.DBROLE;mstrmojo.warehouse.obj.DBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBRole",init:function K(O){var M=this,L=(O&&O.mdDBRole);if(L){M.mdDBRole=L;M.n=L.n.toString();M.did=L.did;M.des=(!(L.des&&mstrApp.rootController.isCloud())?L.n:L.des||"").toString();M.data=new mstrmojo.warehouse.obj.TableData({id:L.did,n:L.n,tp:L.stp,model:O.mdl});}else{M.mdDBRole={n:G.getUniqueName(mstrmojo.desc(11138,"new data source #").replace("#","")),did:"",tp:29,stp:7424,writable:"1",vldbProperties:{}};M.n=M.mdDBRole.n;M.did=M.mdDBRole.did;M.data=new mstrmojo.warehouse.obj.TableData({id:M.mdDBRole.did,n:M.mdDBRole.n,tp:M.mdDBRole.stp,model:O.mdl});var N=mstrApp.rootController.getDBObjects().preferences;if(N&&N.vldbProperties){H.forEach(N.vldbProperties,function(P){M.mdDBRole.vldbProperties[P.propset]={};});}M.populated=true;}M.isManagedDBR=O&&O.isManagedDBR;M.data.isPrimary=M.isPrimary();},dbmsCatalogCacheMode:undefined,mdDBRole:{},n:"",did:"",tp:D,supportsNameSpaces:false,avoidColumnCaching:false,displayName:function J(){return this.n+(this.isPrimary()?" ("+A+")":"");},isPrimary:function I(){return(this.did===mstrApp.getRootController().getProjectPrimaryDBRoleID());},data:undefined,populated:false,isManagedDBR:false,populate:function F(M){var L=this;if(this.populated){M(L);}else{mstrApp.getRootController().populateDBRole(this.mdDBRole.did,{success:function(O){L.populated=true;L.mdDBRole=O.dbrs[0];if(typeof L.mdDBRole.vldbProperties==="string"){L.mdDBRole.vldbProperties=JSON.parse(L.mdDBRole.vldbProperties);}L.n=L.mdDBRole.n.toString();L.did=L.mdDBRole.did;var N=parseInt(L.mdDBRole.dbmsCatalogCacheMode,10);L.supportsNameSpaces=((N&1)===1);L.avoidColumnCaching=((N&2)===2||(N&4)===4);M(L);}});}},rename:function B(L){var M=mstrApp.rootController;this.mdDBRole.n=L;if(M.isCloud()){this.des=L;this.n=this.des+"___"+new Date().getTime();}else{this.n=L;}if(this.did!==""){this.mdDBRole.connstr=G.cleanDSNConnection(this.mdDBRole.connstr);M.saveDBRole(this,false,{success:function(){}});}},duplicate:function E(){var M=mstrApp.rootController,O=new mstrmojo.warehouse.obj.DBRole({mdDBRole:this.mdDBRole,mdl:this.data.model}),N=mstrApp.isSingleTier?"copy of ##":mstrmojo.desc(3651,"copy of ##"),L=G.getUniqueName(N.replace("##",M.isCloud()?this.des:this.n));O.did="";O.mdDBRole.did="";O.rename(L);O.mdDBRole.connstr=G.cleanDSNConnection(O.mdDBRole.connstr);O.mdDBRole.originalID=this.did;if(O.mdDBRole.password===C){delete O.mdDBRole.password;}M.saveDBRole(O,true,{success:function(){}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.locales","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIDatabaseHelper");mstrmojo.requiresDescs(2052,2170,2265,3434,3544,4530,4699,8002,8984,9614,9919,9920,9921,9922,12491,12492,12493,12494,12495,12509,12771,13031,13131,13132,13980,13981,8536);var U=mstrmojo.DI.DIConstants,O=U.dataTypeMenuItems,L=U.rdcsFlag,D=mstrmojo.dom,J=mstrmojo.array;mstrmojo.DI.DIHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIHelpers.isIE7=function N(){return mstrmojo.dom.isIE7;};mstrmojo.DI.DIHelpers.isIE=function(){return D.isIE||!!D.userAgent.match(/Trident\/7\.0/);};mstrmojo.DI.DIHelpers.isIEOrEdge=function(){return mstrmojo.dom.isEdge||this.isIE();};mstrmojo.DI.DIHelpers.getURLCaption=function(){var V="";if(mstrApp.diParams&&mstrApp.diParams.EnableURLImport){if(mstrApp.diParams.EnableFileImport){if(mstrApp.isSingleTier){if(window.FormWrapper!==window.client){V+="File://";}}else{V+="File://";}}if(mstrApp.diParams.EnableHttpImport){if(V!==""){V+=", ";}V+="Http://, Https://";}if(mstrApp.diParams.EnableFTPImport){if(V!==""){V+=", ";}V+="Ftp://";}}return V;};mstrmojo.DI.DIHelpers.getUrlTooltip=function C(){var V="";if(!mstrApp.diParams){return V;}if(!mstrApp.diParams.EnableURLImport){V=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{V=mstrmojo.desc(12492,"Use one of the following URL formats to upload your file:")+" ";V+=mstrmojo.DI.DIHelpers.getURLCaption();if(mstrApp.enableFileImport){V+="\r\r";V+=mstrmojo.desc(12493,"'File://' format allows you to upload files in your local machine. For example: File://ComputerName/path/FileName.");}if(mstrApp.enableHttpImport||mstrApp.enableHttpsImport){V+="\r\r";if(mstrApp.enableFileImport){V+=mstrmojo.desc(12494,"Some other examples are:");}else{V+=mstrmojo.desc(12495,"Some examples are:");}}if(mstrApp.enableHttpImport){V+="\r";V+="http://host/path/FileName";V+="\r";V+="https://user:password@host/path/FileName";}if(mstrApp.enableFtpImport){V+="\r";V+="ftp://user:password@host/path/FileName";V+="\r";V+="ftp://user:password@host:port/path/FileName";}}return V;};mstrmojo.DI.DIHelpers.createMSTRObjects=function(X,Z){var V,Y,W;if(X.constructor===Array){V=X;for(W=0;W<V.length;W++){V[W]=mstrmojo.DI.DIHelpers.createMSTRObjects(X[W],Z);}}else{if(typeof X==="object"){V=new mstrmojo.Obj(X);for(Y in X){if(!Z||Z.indexOf(Y)===-1){if(X.hasOwnProperty(Y)){V.set(Y,mstrmojo.DI.DIHelpers.createMSTRObjects(X[Y],Z));}}}}else{V=X;}}return V;};mstrmojo.DI.DIHelpers.getURLParameters=function(V){var W;var Z;var Y=[];if(V){if(V.indexOf("?")>0){V=V.substr(V.indexOf("?")+1);}Z=V.split("&");for(W=0;W<Z.length;W++){var X=Z[W].split("=");if(X.length===2){Y[X[0]]=X[1];}}}return Y;};mstrmojo.DI.DIHelpers.getBackendSourceType=function(V){var W=U.backendSourceSubtype.localFile;switch(V){case U.sourceSubtype.dropbox:W=U.backendSourceSubtype.dropbox;break;case U.sourceSubtype.bisource:W=U.backendSourceSubtype.bISources;break;case U.sourceSubtype.clipboard:W=U.backendSourceSubtype.clipboard;break;case U.sourceSubtype.facebook:W=U.backendSourceSubtype.facebook;break;case U.sourceSubtype.googleAnalytics:W=U.backendSourceSubtype.googleAnalytics;break;case U.sourceSubtype.googleBigQuery:W=U.backendSourceSubtype.googleBigQuery;break;case U.sourceSubtype.googleBigQueryFFSQL:W=U.backendSourceSubtype.googleBigQueryFFSQLModel;break;case U.sourceSubtype.googleBigQuerySingleTable:W=U.backendSourceSubtype.googleBigQuerySingleTable;break;case U.sourceSubtype.googleDrive:W=U.backendSourceSubtype.googleDrive;break;case U.sourceSubtype.hadoop:W=U.backendSourceSubtype.hadoopFileBrowser;break;case U.sourceSubtype.localFile:W=U.backendSourceSubtype.localFile;break;case U.sourceSubtype.mdx:W=U.backendSourceSubtype.OLAPSources;break;case U.sourceSubtype.salesforce:W=U.backendSourceSubtype.salesforce;break;case U.sourceSubtype.samplefile:W=U.backendSourceSubtype.samplefile;break;case U.sourceSubtype.searchOnSource:W=U.backendSourceSubtype.searchAsASource;break;case U.sourceSubtype.twitter:W=U.backendSourceSubtype.twitter;break;case U.sourceSubtype.url:W=U.backendSourceSubtype.url;break;case U.sourceSubtype.publicData:W=U.backendSourceSubtype.publicData;break;case U.sourceSubtype.cloudElement:W=U.backendSourceSubtype.cloudElement;break;}return W;};mstrmojo.DI.DIHelpers.getStateParameters=function(W){var V;var Z;var X=[];if(W.indexOf(":")>=0){Z=W.split(":");}else{Z=W.split("%3A");}for(V=0;V<Z.length;V++){var Y=Z[V];if(Y.substr(2,1)==="_"){X[Y.substr(0,2)]=Y.substr(3);}}return X;};mstrmojo.DI.DIHelpers.getExtensionType=function(X){var W=X.toLowerCase(),V;if(W===".xls"||W===".xlsx"||W===".xlsm"){V=U.xdaType.excel;}else{if(W===".txt"||W===".csv"||W===".tsv"||W===".prn"){V=U.xdaType.text;}else{V=0;}}return V;};mstrmojo.DI.DIHelpers.setTablesrc=function(V,X,W){if(X){if(!V.tablesSrc[X]){V.tablesSrc[X]=[];}V.tablesSrc[X].push(W);}};function S(V){var X={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2},a={1:U.columnDataTypes.integer,2:U.columnDataTypes.integer,6:U.columnDataTypes.dtdouble,7:U.columnDataTypes.dtfloat,21:U.columnDataTypes.integer,22:U.columnDataTypes.nlong,30:U.columnDataTypes.bigDecimal,34:U.columnDataTypes.int64},W=X[V],Z=a[V],Y="";switch(W.toString()){case U.dataTypeMenuItems.NUMBER:switch(Z){case U.columnDataTypes.integer:Y=mstrmojo.desc(9614,"Integer");break;case U.columnDataTypes.nlong:Y=mstrmojo.desc(13131,"Long");break;case U.columnDataTypes.int64:Y=mstrmojo.desc(13132,"Big Integer");break;case U.columnDataTypes.dtfloat:Y=mstrmojo.desc(8002,"Float");break;case U.columnDataTypes.dtdouble:Y=mstrmojo.desc(2265,"Double");break;case U.columnDataTypes.bigDecimal:Y=mstrmojo.desc(9920,"Big Decimal");break;default:Y=mstrmojo.desc(3434,"Number");break;}break;case U.dataTypeMenuItems.DATE:Y=mstrmojo.desc(2052,"Date");break;case U.dataTypeMenuItems.DATE_TIME:Y=mstrmojo.desc(9919,"DateTime");break;case U.dataTypeMenuItems.TIME:Y=mstrmojo.desc(2170,"Time");break;case U.dataTypeMenuItems.TEXT:Y=mstrmojo.desc(3544,"Text");break;case U.dataTypeMenuItems.HTML_TAG:Y=mstrmojo.desc(9921,"HTML Tag");break;case U.dataTypeMenuItems.PHONE_NUMBER:Y=mstrmojo.desc(8984,"Phone Number");break;case U.dataTypeMenuItems.SYMBOL:Y=mstrmojo.desc(4530,"Symbol");break;case U.dataTypeMenuItems.URL:Y=mstrmojo.desc(9922,"URL");break;case U.dataTypeMenuItems.EMAIL:Y=mstrmojo.desc(4699,"Email");break;}return Y;}mstrmojo.DI.DIHelpers.getDataTypeString=S;mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults=function M(d){var b=[],Z,a,c,e,V,X,Y,W;J.forEach(d,function(f){Z=a=c=e="";X=(f.vt===3)?1:0;switch(f.vt){case 0:case 1:case 2:case 3:Z=f.n;a=S(f.ddt);V=f.src;c=V.n;e=S(V.ddt);break;case 4:Z=f.n;a=S(f.ddt);break;case 8:V=f.src;c=V.n;e=S(V.ddt);break;}Y=a?Z+"("+a+")":Z;W=e?c+"("+e+")":c;b.push([Y,X,W]);});return b;};mstrmojo.DI.DIHelpers.getURLFileName=function(W){var V=W.lastIndexOf("/");return V>=0&&V+1!==W.length?W.substr(V+1):W;};mstrmojo.DI.DIHelpers.isOperationMode=function(V){return V!==undefined&&V!==null;};mstrmojo.DI.DIHelpers.isCtrlKey=function(V,X){var W=X||(V||window).event;return W.ctrlKey||W.metaKey;};mstrmojo.DI.DIHelpers.isRefreshable=function(W){var V,X=0;for(V in W.importSources){var Y=W.importSources[V];if(Y.type===U.sourceType.file&&(Y.subtype===U.sourceSubtype.url||Y.subtype===U.sourceSubtype.publicData)){if(!Y.sourceInfo||Y.sourceInfo.url.indexOf("http://mirror.microstrategy.com/datahub/samples")!==0){X++;}}}if(W.getAllTableID().length===X&&!mstrApp.diParams.EnableHttpImport&&!mstrApp.diParams.EnableFTPImport&&!mstrApp.diParams.EnableFileImport&&!mstrApp.diParams.EnableURLImport){return false;}return true;};mstrmojo.DI.DIHelpers.strStartsWith=function(W,V){return W.indexOf(V)===0;};mstrmojo.DI.DIHelpers.adjustDataIdx=function(Y,X){var V=[],W;if(!Y||Y.length===0){return ;}J.forEach(Y,function(Z){W=Z.subColumns;if(W&&W.length>1){V=V.concat(W);}else{V.push(Z);}});V.sort(function(c,Z){return c[X]-Z[X];});};mstrmojo.DI.DIHelpers.setDataIdx=function(X,W,V){if(!W||W.length===0){return ;}if(W[0].hasOwnProperty("clix")){J.forEach(X,function(Z){var Y=Z.ix;Z[V]=J.find(W,"clix",Y);if(Z.isMultiForm){J.forEach(Z.subColumns,function(a){a[V]=J.find(W,"clix",a.ix);});}});}if(W[0].hasOwnProperty("did")){J.forEach(X,function(a){var Z=a.did;var Y=J.find(W,"did",Z);if(Y!==-1){a[V]=Y;}if(a.isMultiForm){J.forEach(a.subColumns,function(b){Y=J.find(W,"did",b.did);if(Y!==-1){b[V]=Y;}});}});}};mstrmojo.DI.DIHelpers.encodeData=function(V){var W="";if(V!==undefined){if(typeof V==="number"){W=V;}else{W=mstrmojo.string.encodeHtmlString(V,false,true);}}return W;};var E={0:"Bytes",1:"KB",2:"MB",3:"GB",4:"TB",5:"PB"};function P(V){return E[V]||"unknown";}mstrmojo.DI.DIHelpers.getRoundSize=function I(W){var V;for(V=0;(W/1024)>1;V++){W=W/1024;}W=W.toPrecision(3);return W+P(V);};mstrmojo.DI.DIHelpers.findNewElements=function(X,Y){var W=[],V;if(X&&X.length){J.forEach(Y,function(Z){V=J.indexOf(X,Z);if(V===-1){W.push(Z);}});}else{if(Y&&Y.length){W=[].concat(Y);}}return W;};mstrmojo.DI.DIHelpers.generateCubeName=function(W){var V,X,Y=50;V=W.join(" ");if(V.length>Y){V=V.slice(0,Y)+"...";}X=W.length;if(X>1){V+=" ("+X+" tables)";}return V;};mstrmojo.DI.DIHelpers.parseValidateSourceResults=function(W){var V={isValidate:true,hasError:false,tbids:[],tableValidate:[],missingColumnTbids:[],mismatchedDatatypeTbids:[],missingTableTbids:[],errorTableTbids:[],missingColumns:{},mismatchedDatatypeColumns:{},missingTablesColumns:{},errorTableErrCode:{},errorTableErrMsg:{}},X=W&&W.vts;J.forEach(X,function(f){var Y=f.tbid,g=f.vt,a=f.emsg,d=f.cols||[],Z=true,e=false,c,h=[],b=[];if(g===1){Z=true;}else{switch(g){case U.backendError.switchingFileType:case U.backendError.noExternalSession:case U.backendError.databaseCredentialsNotAvailable:case U.backendError.CECredentialNotAvailable:case U.backendError.AuthenticationError:case U.backendError.shouldBeIgnored:e=true;break;}J.forEach(d,function(j){var k=j.vt;switch(k){case 1:b.push(j);break;case 4:h.push(j);break;}});}if(e){V.errorTableTbids.push(Y);V.errorTableErrCode[Y]=g;V.errorTableErrMsg[Y]=a;V.isValidate=false;V.hasError=true;}c=h.length>0&&h.length===d.length;if(h.length>0||b.length>0){Z=false;}else{Z=true;}if(Z===false){V.isValidate=false;}V.tbids.push(Y);V.tableValidate.push(Z);if(h.length>0){if(c){V.missingTableTbids.push(Y);V.missingTablesColumns[Y]=h;}else{V.missingColumnTbids.push(Y);V.missingColumns[Y]=h;}}if(b.length>0){V.mismatchedDatatypeTbids.push(Y);V.mismatchedDatatypeColumns[Y]=b;}});return V;};mstrmojo.DI.DIHelpers.truncate=function(X,Z,V){if(X&&X.length>Z){var b=3,W=Z-b,a=Math.ceil(W/2),Y=Math.floor(W/2);if(V){return X.substr(0,W)+"...";}else{return X.substr(0,a)+"..."+X.substr(X.length-Y);}}else{return X;}};mstrmojo.DI.DIHelpers.getAbsoluteFileName=function(V){var W,X=V.lastIndexOf("\\");if(X===-1){X=V.lastIndexOf("/");}W=V.substring(X+1,V.length);return W;};mstrmojo.DI.DIHelpers.reevaluatePopupPosition=function(V){if(V){var W=V.style,Z=W.display,Y=W.left,X=W.top;W.display="block";if(parseInt(Y.substring(0,Y.length-2))<0){W.left="0px";}if(parseInt(X.substring(0,X.length-2))<0){W.top="0px";}W.display=Z;}};mstrmojo.DI.DIHelpers.expandNode=function(W){var V=W.visible;W.set("visible",!V);return !V;};mstrmojo.DI.DIHelpers.normalizeTimestamp=function(X){var W=X.replace(/-/g,"/");var V=W.indexOf(".");if(V>0){W=W.substring(0,V);}return W;};mstrmojo.DI.DIHelpers.getBackendErrorStr=function(W,V){var X="";switch(W){case U.backendError.switchingFileType:X=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");break;case U.backendError.noExternalSession:case U.backendError.databaseCredentialsNotAvailable:case U.backendError.CECredentialNotAvailable:case U.backendError.AuthenticationError:X=mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table.");break;}return X;};mstrmojo.DI.DIHelpers.getCommonElements=function(Y,a,Z){var W=[],X,V;for(X=0;Y&&X<Y.length;X++){for(V=0;a&&V<a.length;V++){if(Z(Y[X],a[V])){W.push(Y[X]);break;}}}return W;};mstrmojo.DI.DIHelpers.formatDateAndTime=function(d,Y){var c=mstrmojo.date;var W=mstrmojo.locales;var X,e,b,a,V,Z;X=c.parseDateAndOrTime(d);e=X.date;b=X.time;if(Y){Z=new Date(Date.UTC(e.year,e.month-1,e.day,b.hour,b.min,b.sec));X=c.getDateJson(Z);e=X;b=X;}a=c.formatDateInfo(e,W.datetime.DATEDISPLAYFORMAT);V=c.formatTimeInfo(b,W.datetime.TIMEDISPLAYFORMAT);return a+" "+V;};mstrmojo.DI.DIHelpers.isServerBasedWS=function(){return !!mstrApp.isWorkstation&&!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isLocalWS=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isDIinVI=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier&&!!mstrApp.isPopup;};mstrmojo.DI.DIHelpers.extractFileNameFromHadoopURL=function(W){if(!W){return"";}var V,X;V=W.lastIndexOf("/")+1;X=W.substring(V);return X;};mstrmojo.DI.DIHelpers.extractFileExtensionFromHadoopURL=function(W){if(!W){return"";}var V,X;V=W.lastIndexOf("/")+1;X=W.substring(V);return X.substring(X.lastIndexOf(".")+1);};mstrmojo.DI.DIHelpers.isWS=function(){return !!mstrApp.isWorkstation;};mstrmojo.DI.DIHelpers.getEnvObj=function(){var Y=(navigator.platform.indexOf("Win")!==-1?"Win":"Mac"),V=!!mstrApp.isWorkstation?"WS":"Web",W=[];W.push(V,Y);return{ENV:W.join("-"),isWSClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return !window.FormWrapper.isDesktop();},isDesktopClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return window.FormWrapper.isDesktop();},isWeb:function(){return V==="Web";},isWS:function(){return V==="WS";},isWin:function(){return Y==="Win";},isMac:function(){return Y==="Mac";},isDataSet:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp"||mstrApp.placeholder==="QBApp";},isDIinVI:function(){return !!mstrApp.isFromVI;},isInDI:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp";},isInQB:function(){return mstrApp.placeholder==="QBApp";},isAppSchema:function(){return !!window.mstrAppSchema;},isWebWin:function(){return this.isWeb()&&this.isWin();},isWebMac:function(){return this.isWeb()&&this.isMac();},isWebDataSet:function(){return this.isWeb()&&this.isDataSet();},isWebDossier:function(){return this.isWeb()&&this.isDIinVI();},isWSWin:function(){return this.isWS()&&this.isWin();},isWSMac:function(){return this.isWS()&&this.isMac();},isWSDataSet:function(){return this.isWS()&&this.isDataSet();},isServerBasedWS:mstrmojo.DI.DIHelpers.isServerBasedWS,isWSDossier:function(){return this.isWS()&&this.isDIinVI();},isWSLiveMode:function X(){return this.isWS()&&parseInt(window.FormWrapper.isWSLiveMode(),10)===1;},isWSDossierLocalMode:function(){return this.isWSDossier()&&!this.isWSLiveMode();},isWebWinDataSet:function(){return this.isWeb()&&this.isWin()&&this.isDataSet();},isWebMacDataSet:function(){return this.isWeb()&&this.isMac()&&this.isDataSet();},isWebWinDossier:function(){return this.isWeb()&&this.isWin()&&this.isDIinVI();},isWebMacDossier:function(){return this.isWeb()&&this.isMac()&&this.isDIinVI();},isWSWinDataSet:function(){return this.isWS()&&this.isWin()&&this.isDataSet();},isWSMacDataSet:function(){return this.isWS()&&this.isMac()&&this.isDataSet();},isWSWinDossier:function(){return this.isWS()&&this.isWin()&&this.isDIinVI();},isWSMacDossier:function(){return this.isWS()&&this.isMac()&&this.isDIinVI();},isStandaloneDataSet:function(){return !this.isDIinVI()&&this.isDataSet();}};};mstrmojo.DI.DIHelpers.isOnetier=function(){return !!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.getHierarchyMappingXML=function(a,b){var X="";var W=0,Y=1,Z=12;if(b&&b[L.ID]){X+="<mpcs>";X+="<mpc ";X+='did="'+b[L.ID].did+'" drvflg="'+W+(b[L.ID].n?('" n="'+b[L.ID].n+'" ot="'):"")+Z+'" recurisve="'+Y+'" ';if(!!a&&a!==""){X+='oid="'+a+'" ';}X+=">";if(b[L.JOIN_ID]){X+="<rdcs>";}for(var V=L.JOIN_ID;V<=L.DISTANCE;V++){if(b[V]!==undefined){X+='<rdc did="'+b[V].did+'" fg="'+V+'"/>';}}if(b[L.JOIN_ID]){X+="</rdcs>";}X+="</mpc>";X+="</mpcs>";}return X;};mstrmojo.DI.DIHelpers.getOperationMode=function(){return mstrApp.getRootController().getModel().operationMode;};mstrmojo.DI.DIHelpers.standardizeDBRolesFormat=function Q(d){var X=["att","dbRole","tableMap"],e,g,a,V,Y,W,b,Z,f,h,c=(function(){var j="list",l="number",k="text";function m(n,u,t,q,p,o){if(n&&t){if(o){n.push({field:u,fieldV:t,IDS:q,options:o,tp:p});}else{n.push({field:u,fieldV:t,IDS:q,tp:p});}}}return{authenticationmethod:function(n,o){m(n,"auth",o,7776,j,[{IDS:13980,n:mstrmojo.desc(13980),v:"1"},{IDS:13981,n:mstrmojo.desc(13981),v:"4"}]);},databasename:function(n,o){m(n,"db",o,8519,k);},hostname:function(n,o){m(n,"host",o,8533,k);},port:function(n,o){m(n,"port",o,8534,l);},server:function(n,o){m(n,"svr",o,8536,k);}};}());d=Object.keys(d).map(function(j){return mstrmojo.DI.DIHelpers.createMSTRObjects(d[j],X);});J.forEach(d,function(j){J.forEach(j.tables,function(k){k.dbRole=(k.dbRole&&k.dbRole.oi)||k.dbRole;k.dbmsObj=k.dbmsObj&&k.dbmsObj.oi;g=k.dbRole;if(g){g.dbmsObj=k.dbmsObj;a=g.dbmsObj;if(!g.dbms){g.dbms=g.def&&g.def.dbms&&g.def.dbms.did;}}if(!a||a.DBInfo){return ;}a.DBInfo={};e=a.DBInfo;V=g.efd;if(!V){return ;}V.forEach(function(l){Y=l.oi&&l.oi.def;if(!Y){return ;}h=Y.dbtp;if(h){g.db_type=h;e.dbTypes={dbt:{v:h,n:mstrmojo.desc(mstrmojo.DI.DIDatabaseHelper.getDescriptionIdByDBType(h))}};}W=Y.cnsr;if(!W){return ;}f=[];Z=null;g.connstr=W;W.split(";").forEach(function(m){b=m.split("=");b[0]=b[0].toLowerCase().trim();if(b[0]==="driver"){e.driverInstalled=true;}else{if(b[0]==="authenticationmethod"){Z=b;}else{if(c[b[0]]){c[b[0]](f,b[1]);}}}});if(Z){c[Z[0]](f,Z[1]);}});});});return d;};mstrmojo.DI.DIHelpers.filterDisableSources=function A(V){return J.indexOf(mstrApp.diParams.disabledSources,V)<0;};mstrmojo.DI.DIHelpers.getPopupWindowOptions=function R(){var Z={};var X=window.screenX||window.screenLeft||0,W=window.screenY||window.screenTop||0,Y=800,V=600,a;if(document.body&&document.body.offsetWidth){Y=document.body.offsetWidth;V=document.body.offsetHeight;}if(document.compatMode==="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){Y=document.documentElement.offsetWidth;V=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){Y=window.innerWidth;V=window.innerHeight;}if(window.outerWidth){Y=window.outerWidth;}if(window.outerHeight){V=window.outerHeight;}Z.height=V*0.5;Z.width=Y*0.8;if(Z.height<600||isNaN(Z.height)){Z.height=600;}if(Z.width<800||isNaN(Z.width)){Z.width=800;}Z.left=X+(Y-Z.width)/2;Z.top=W+(V-Z.height)/8;if(this.getEnvObj().isWSWin()&&this.getEnvObj().isDIinVI()){Z.left=(window.screen.width-Z.width)/2;Z.top=(window.screen.height-Z.height)/2;}a="width="+Z.width+",height="+Z.height;a+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";a+=",left="+Z.left+",top="+Z.top;return a;};mstrmojo.DI.DIHelpers.createPopupWindow=function G(W,V){var X,Y;Y=this.getPopupWindowOptions();if(!W){W="";}X=window.open(W,V,Y);return{wnd:X};};mstrmojo.DI.DIHelpers.openPopupWindow=function H(Y,W,V){var X;if(Y&&!Y.closed){Y.location=V;Y.focus();}else{X=this.createPopupWindow(V);Y=X.wnd;if(Y){Y.focus();}}return Y;};mstrmojo.DI.DIHelpers.sendResponse2Window=function B(W,V,Z){var Y;if(Z){Y=Z;}else{Y=window.opener;}if(Y){if(V===undefined){V=window.location.origin;if(!V){V=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}}try{if(this.isIE()&&Y.postMessagePassthrough){Y.postMessagePassthrough(W,V);try{window.open("","_self","");window.close();}catch(a){window.close();}}else{Y.postMessage(W,V);}}catch(X){console.log("postMessage error: "+X);}}};mstrmojo.DI.DIHelpers.convertDataSourceType2SourceType=function F(V){switch(V){case U.dataSourceType.DROPBOX:return U.sourceType.dropbox;case U.dataSourceType.GOOGLE_DRIVE:return U.sourceType.googleDrive;case U.dataSourceType.GOOGLE_ANALYTICS:return U.sourceType.googleAnalytics;case U.dataSourceType.SALESFORCE:return U.sourceType.salesforce;case U.dataSourceType.GOOGLE_BIGQUERY:return U.sourceType.googleBigQuery;default:return -1;}};mstrmojo.DI.DIHelpers.highlightKeyWords=function K(d,e,V){var X="\\*.?+$^[](){}|/",f=d,b,Y;if(d===""){return e;}for(Y in X){if(X.hasOwnProperty(Y)){b=X[Y];f=f.replace(new RegExp("\\"+b,"g"),"\\"+b);}}var c=new RegExp("("+f+")","ig");var W="\u001E",a=mstrmojo.string.encodeHtmlString,Z;if(c.test(e)){e=e.replace(c,function(g){return W+g+W;});Z=J.map((e||"").split(W),function(h,g){return(g%2===0)?a(h):('<span class="'+V+'">'+a(h)+"</span>");});return Z.join("");}};mstrmojo.DI.DIHelpers.detectCustomImg=function(Y,X){if(!Y||!(X.nodeType&&X.nodeType===window.Node.ELEMENT_NODE)){return ;}var V=Y.replace?Y.replace(/\s+/g,""):"";var Z=document.getElementsByTagName("head")[0];var W=document.createElement("img");W.src="../javascript/mojo/css/images/DI/connectors/"+V+".png";W.onload=function(){X.style.background="url(../javascript/mojo/css/images/DI/connectors/"+V+".png) no-repeat";Z.removeChild(W);};W.onerror=function(){X.style.background="url(../javascript/mojo/css/images/DI/connectors/default.png) no-repeat";Z.removeChild(W);};Z.appendChild(W);};mstrmojo.DI.DIHelpers.spliceUrlBySeparator=function(W){var V=W.split("#");return V.slice(V.length/2+1).join("#");};mstrmojo.DI.DIHelpers.isOriginalConnector=function(W){var V=U.originalConnector;if(V.elastic===W||V.tapClicks===W){return true;}return false;};mstrmojo.DI.DIHelpers.acceptEventFromAncestor=function(V){if(!V){return true;}if(!this.domNode||typeof V.contains!=="function"||!this.hasRendered){return false;}return V.contains(this.domNode);};mstrmojo.DI.DIHelpers.isdbRoleWritable=function(V){if(mstrmojo.DI.DIHelpers.isOnetier()){return true;}else{return V.writable==="1"&&mstrApp.rootController.hasPrivilege(U.DssXmlPrivileges.DssXmlPrivilegesUseDatabaseInstanceManager);}};mstrmojo.DI.DIHelpers.isdbRoleUsable=function(V){return mstrmojo.DI.DIHelpers.isOnetier()?true:V.usable==="1";};mstrmojo.DI.DIHelpers.applyDriverSuffix=function(X){if(!X||!X.Preferences){return ;}var V=JSON.stringify(X),W=X.Preferences.driverNameSuffix,Z=this.getEnvObj();var Y="Platform";if(Z.isDesktopClient()){Y=Z.isMac()?"DesktopMac":"DesktopWin";}else{if(Z.isWSClient()){Y=Z.isMac()?"WorkstationMac":"WorkstationWin";}}var a=W[J.find(W,"n",Y)];return JSON.parse(V.replace(/!#DRIVERSUFFIX#!/g,a?a.value:""));};mstrmojo.DI.DIHelpers.isGeo=function(V){return V.georole&&V.georole>0;};mstrmojo.DI.DIHelpers.isTime=function(V){return V.dtp===parseInt(O.DATE,10)||V.dtp===parseInt(O.DATE_TIME,10)||V.dtp===parseInt(O.TIME,10);};}());(function(){mstrmojo.requiresCls("mstrmojo.StepperContentProvider","mstrmojo.num");var A=mstrmojo.num;function B(G,F){var H=F?G.max:G.min,D=F?G.min:G.max,E=G.getVal(F?1:-1);return(H===null||(F?(E<=H):(E>=H))||(D!==null&&G.canLoop));}function C(H,G){var F=H.min,D=H.max,E=H.getVal(G?1:-1);if((G&&D!==null&&E>D)||(!G&&F!==null&&(E<F))){if(H.canLoop){E=((E-F)%(D-F+1))+F;E=(E>=F)?E:E+(D-F+1);}else{return ;}}H.item[H.valField]=H.curVal=E;H.onTraverse();}mstrmojo.NumStepperContentProvider=mstrmojo.declare(mstrmojo.StepperContentProvider,null,{scriptClass:"mstrmojo.NumStepperContentProvider",curVal:null,init:function(E){this._super(E);var F=this.item,D=function(I){var H=I&&F[I];return(H===null||H===undefined);},G=function(I,K,H){var J=H&&D.call(this,K)?null:F[K];if(J!==null&&J!==undefined){this[I]=J;}};G.call(this,"min",this.minField,true);G.call(this,"max",this.maxField,true);G.call(this,"maxLength",this.maxLengthField,true);G.call(this,"interval",this.intField);this._initCurrent();},_initCurrent:function(){var E=this.item,F=this.curVal=E[this.valField];if(F===null||F===undefined){var D=this.min;this.curVal=D!==null?D:0;}},next:function(){C(this,true);},prev:function(){C(this,false);},hasPrev:function(){return B(this,false);},hasNext:function(){return B(this,true);},renderItemAt:function(F){var E=this.getVal(F),D=this.renderer;return D?D.render(E,this):E;},getVal:function(D){return this.curVal+(this.interval*(D||0));},setVal:function(F){var G=this.min,D=this.max,E=this.getVal();if(typeof F!=="number"||isNaN(F)||F===E||A.inNumericRange(F,G,D)!==0){return ;}this.item[this.valField]=this.curVal=F;this.onTraverse();},onTraverse:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.DI.DIDataService");mstrmojo.requiresDescs(889,7405,11163,12369);var X=mstrmojo.hash,M=mstrmojo.desc;var AD=M(889,"Please wait...");function K(AN,AM,AL){var AJ=AM.showWait,AK=AM.suppressError,AI=AM.waitMsg;delete AM.showWait;delete AM.suppressError;delete AM.waitMsg;mstrApp.serverRequest(AM,AN,AJ,AK,AI,undefined,undefined,AL);}mstrmojo.qb.DataService=mstrmojo.provide("mstrmojo.qb.DataService",{submitRequest:function AB(AJ,AI){K.call(this,AJ,AI);},archSpark:function AC(AK,AJ,AI){K.call(this,AK,X.copy(AJ,{taskId:"arch.spark",showWait:true}),AI);},pollingStatus:function c(AP,AJ,AM,AN){var AL=this;if(mstrApp.isSingleTier){if(AP.success){AP.success(AJ);}return ;}K.call(AL,{success:function AO(AQ){if(AQ.status==="1"){if(AP.success){AP.success(AJ);}}else{AL.pollingStatus(AP,AJ,AM);}},failure:function AK(AQ){if(AP.failure){AP.failure(AQ);}},canceled:function AI(AQ){if(AP.canceled){AP.canceled(AQ,AJ);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:AM},AN);},taskByPollStatus:function t(AP,AI,AM,AN,AJ,AO){var AL=this,AK="pollStatus";if(mstrApp.isSingleTier){AK=AO||"DIPollStatus";}K.call(AL,mstrmojo.DI.DIDataService.taskByPollStatusCb.call(AL,AP,AI,AM,AN,AJ,AO),{taskId:AK,resultSetType:3,threadId:AI.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",isAsync:true,},AN);},search:function AF(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"arch.search",showWait:true}));},searchFolderContents:function A(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:AD});},createReportInstance:function Y(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.CreateQBReportInstance",showWait:true,suppressError:true}));},createEmmaInstance:function B(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:AD}));},createEmmaTable:function x(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"DICreateEMMASourceTable",showWait:true,waitMsg:AD}));},changeMapping:function z(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.RemapObject",showWait:true,waitMsg:AD}));},buildRelations:function a(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"DIDetectRelationshipEMMASourceTable",showWait:true,waitMsg:AD}));},setDBRole:function o(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.SetDBRole",showWait:false}));},getShapeKeys:function AH(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getMapShapes",showWait:false}));},addTable:function h(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.AddTable",showWait:true,waitMsg:AD}));},removeTable:function V(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.RemoveTable",showWait:true,waitMsg:AD}));},editTable:function H(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.EditTable",showWait:true}));},addColumn:function j(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.AddSelectedColumn",showWait:true}));},addSelectedColumns:function P(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.AddMultiSelectedColumns",showWait:true}));},editColumn:function Q(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.EditSelectedColumn",showWait:true}));},removeColumn:function I(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.RemoveSelectedColumn",showWait:true}));},addJoin:function d(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.AddJoin",showWait:true}));},removeJoin:function AA(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.RemoveSelectedJoin",showWait:true}));},editJoin:function m(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.EditJoin",showWait:true}));},autoJoin:function W(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.GenerateJoins",showWait:true}));},editCondition:function D(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"qBuilder.EditCondition",showWait:true}));},remapObject:function O(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.RemapObject",showWait:true}));},updateTableStructure:function G(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.UpdateWHTable",showWait:true}));},parse:function R(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.Parse",showWait:true}));},getReportDefinition:function q(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.GetReportXDADefinition",showWait:true}));},saveReport:function C(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.SaveReportXDADefinition",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(7405,"Saving changes...")}));},getSystemFunctions:function w(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getSystemFunctions",showWait:false,suppressError:true}));},convertToQB:function J(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.ConvertToQueryBuilder",showWait:true}));},convertToFFSQL:function k(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.ConvertToFreeFormSQL",showWait:true}));},editFFSQL:function n(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.EditFreeFormSQL",showWait:true}));},catalogAction:function AG(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"arch.catalogAction",showWait:true}));},getDocumentAttributes:function l(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getDocumentAttributes",showWait:true}));},autoClosePrompt:function L(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.AutoClosePrompt",showWait:true}));},publishCube:function U(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.PublishCube",showWait:true,suppressError:true,waitMsg:mstrmojo.desc(11163,"Publishing...")}));},getAttributeForms:function p(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getAttributeForms"}));},searchMetadata:function F(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"searchMetadata"}));},getFunctionDetails:function AE(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getSystemFunctions"}));},signOutOAuthSource:function f(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:M(12369,"Signing out...")}));},removeEmmaTable:function Z(AL,AK){var AI=this;K.call(AI,{success:function AJ(AM){mstrApp.msgid=AM.msgid;AI.pollingStatus(AL,AM,AD);}},X.copy(AK,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:AD}));},removeOrDuplicateRI:function e(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},clearDataCache:function N(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"DIClearDataCache",}));},catalogActionForLocalDossier:function b(AN,AM,AJ){var AK=this;K.call(AK,{success:function AL(AO){AK.cancelEvt&&mstrApp.getRootController().model.detachEventListener(AK.cancelEvt);AK.cancelEvt=mstrApp.getRootController().model.attachEventListener(AJ,this.id,function(){AK.isPolling=false;AN.canceled(AO);});AK.isPolling=true;AK.taskByPollStatus(AN,AO,null,{silent:true},null,"arch.PollStatusCatalogAction");},failure:function AI(AO){mstrmojo.alert("arch.catalogAction : Get thread Id failed.");},canceled:function(AO){if(AN.canceled){AN.canceled(AO);}}},X.copy(AM,{taskId:"arch.catalogAction",showWait:false,}));},prepareData:function g(AQ,AK,AL,AN,AJ){var AI=AJ||M(13196,"Prepare data ## of ### tables...").replace("##",AL).replace("###",AN);var AM=this,AO={showCancel:true};K.call(AM,{success:function AP(AR){mstrApp.showWait(AO);AM.taskByPollStatus(AQ,AR,AI,{silent:true});},canceled:function(AR){if(AQ.canceled){AQ.canceled(AR);}}},X.copy(AK,{taskId:"DIDataPreparation",showWait:true,waitMsg:AI}),AO);},killJob:function S(AK,AJ,AI){K.call(this,AK,X.copy(AJ,{taskId:AI||"DIKillJob",showWait:true,suppressError:true,waitMsg:AD}));},getObjectInfo:function E(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"getObjectInfo"}),{showProgress:true,showProgressText:true,progressText:AD});},getSingleDBRole:function u(AJ,AI){K.call(this,AJ,X.copy(AI,{taskId:"qBuilder.GetSingleDBRole"}),{showProgress:true,showProgressText:true,progressText:AD});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.DI.DIDataService");mstrmojo.requiresDescs(889,13196);var U=mstrmojo.hash,G=mstrmojo.desc;var H=G(889,"Please wait...");function A(j,h,g){var c=h.showWait,d=h.suppressError,b=h.waitMsg,e=h.msgid,f=h.alertCfg;delete h.showWait;delete h.suppressError;delete h.waitMsg;delete h.msgid;delete h.alertCfg;mstrApp.serverRequest(h,j,c,d,b,e,f,g);}mstrmojo.qb.es.DataService=mstrmojo.provide("mstrmojo.qb.es.DataService",{emmaIRRMessageID:null,submitRequest:function S(c,b){A.call(this,c,b);},setDBRole:function X(c,b){A.call(this,c,U.copy(b,{taskId:"qBuilder.SetDBRole",showWait:true}));},signOutOAuthSource:function Y(c,b){A.call(this,c,U.copy(b,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:G(12369,"Signing out...")}));},pollingStatus:function E(j,c,f,g){var e=this;if(mstrApp.isSingleTier){if(j.success){j.success(c);}return ;}A.call(e,{success:function h(k){if(k.status==="1"){if(j.success){j.success(c);}}else{e.pollingStatus(j,c,f);}},failure:function d(k){if(j.failure){j.failure(k);}},canceled:function b(k){if(j.canceled){j.canceled(k,c);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:f},g);},taskByPollStatus:function D(j,b,f,g,c,h){var e=this,d="pollStatus";if(mstrApp.isSingleTier){d=h||"DIPollStatus";}A.call(e,mstrmojo.DI.DIDataService.taskByPollStatusCb.call(e,j,b,f,g,c,h),{taskId:d,resultSetType:3,threadId:b.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",isAsync:true,},g);},createEmmaTables:function V(e,d){var b=this;A.call(b,{success:function c(f){mstrApp.msgid=f.msgid;b.pollingStatus(e,f,H);}},U.copy(d,{taskId:"qBuilder.CreateEmmaTables",showWait:true,waitMsg:H}));},createEmmaInstance:function a(e,d){var b=this;A.call(b,{success:function c(f){mstrApp.msgid=f.msgid;b.pollingStatus(e,f,H);}},U.copy(d,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:H}));},removeEMMATable:function B(e,d){var b=this;A.call(b,{success:function c(f){mstrApp.msgid=f.msgid;b.pollingStatus(e,f,H);}},U.copy(d,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:H}));},changePartition:function Q(e,d){var b=this;A.call(b,{success:function c(f){mstrApp.msgid=f.msgid;b.pollingStatus(e,f,H);}},U.copy(d,{taskId:"DIChangePartition",showWait:true,waitMsg:H}));},editEmmaIRRSourceTable:function K(f,e){var c=this,b;b={success:function d(g){c.emmaIRRMessageID=g.msgid;}};A.call(c,mstrmojo.func.wrapMethods(b,f),U.copy(e,{taskId:"DIEditEmmaIRRSourceTable",msgid:c.emmaIRRMessageID,showWait:true}));},search:function L(c,b){A.call(this,c,U.copy(b,{taskId:"arch.search",showWait:true}));},searchFolderContents:function Z(c,b){A.call(this,c,U.copy(b,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:H});},validateEmmaIRRAlternateSource:function C(c,b){A.call(this,c,U.copy(b,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID,showWait:true}));},clearDataCache:function J(c,b){A.call(this,c,U.copy(b,{taskId:"DIClearDataCache",}));},catalogActionForLocalDossier:function W(g,f,c){var d=this;A.call(d,{success:function e(h){d.cancelEvt&&mstrApp.getRootController().model.detachEventListener(d.cancelEvt);d.cancelEvt=mstrApp.getRootController().model.attachEventListener(c,this.id,function(){d.isPolling=false;g.canceled(h);});d.isPolling=true;d.taskByPollStatus(g,h,null,{silent:true},null,"arch.PollStatusCatalogAction");},failure:function b(h){mstrmojo.alert("arch.catalogAction : Get thread Id failed.");},canceled:function(h){if(g.canceled){g.canceled(h);}}},U.copy(f,{taskId:"arch.catalogAction",showWait:false,}));},prepareData:function I(k,d,e,g,c,l){var b=c||G(13196,"Prepare data ## of ### tables...").replace("##",e).replace("###",g);var f=this,h={showCancel:l?false:true};A.call(f,{success:function j(m){mstrApp.showWait(h);f.taskByPollStatus(k,m,b,{silent:true},{hideCancel:l});},canceled:function(m){if(k.canceled){k.canceled(m);}}},U.copy(d,{taskId:"DIDataPreparation",showWait:true,waitMsg:b}),h);},catalogAction:function P(c,b){A.call(this,c,U.copy(b,{taskId:"arch.catalogAction",showWait:true}));},autoMap:function N(e,d){var b=this;A.call(b,{success:function c(f){mstrApp.msgid=f.msgid;b.pollingStatus(e,f,H);}},U.copy(d,{taskId:"qBuilder.AutoMapTables",showWait:true,waitMsg:H}));},killJob:function F(c,b){A.call(this,c,U.copy(b,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:H}));},getObjectInfo:function M(c,b){A.call(this,c,U.copy(b,{taskId:"getObjectInfo"}),{showProgress:true,showProgressText:true,progressText:H});},removeOrDuplicateRI:function O(c,b){A.call(this,c,U.copy(b,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},getSingleDBRole:function R(c,b){A.call(this,c,U.copy(b,{taskId:"qBuilder.GetSingleDBRole"}),{showProgress:true,showProgressText:true,progressText:H});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ServerProxy");mstrmojo.QueueNative=mstrmojo.declare(mstrmojo.ServerProxy,null,{scriptClass:"mstrmojo.QueueNative",queue:[],requestCount:0,transport:null,createRequest:function(C,E,D,B){return this._super(C,E,D,B);},advance:function(){var B=this.queue.shift();if(B){this.request(B.callback,B.params,false,{});}},queueHandle:function(B,C){if(this.requestCount>0){this.queue.push({callback:C,params:B});this.requestCount++;}else{this.requestCount++;this.request(C,B,false,{});}},response:function A(F,B,D){var E=this.getRequest(F);if(E){E.gotResponse=true;var G=E.callback,C=(B&&!D.mstrerr)?"success":"failure";try{if(G[C]){G[C](D,E);}}finally{G.complete(F);}this.requestCount--;this.advance();}},});}());(function(){mstrmojo.requiresCls("mstrmojo.ServerProxy");mstrmojo.DI.WorkstationServerProxy=mstrmojo.declare(mstrmojo.ServerProxy,null,{workstationEnv:null,createRequest:function(B,D,C,A){return this._super(B,D,C,A);},serverRequestParallel:function(C,D,A){var B=mstrmojo.hash.copy(C);B.taskContentType=B.taskContentType||"json";B.taskEnv=B.taskEnv||"xhr";this.request(D,C,false,{});},upload:function(J,E,G,D,B,C,A){if(G===null){this.request(J,E,G,D);}else{var H=new FileReader();var I=this;var F=function(){H.onload=null;};if(!this.fileReaderUnloader){this.fileReaderUnloader={};}this.fileReaderUnloader[E.tableID]=F;H.onload=function(K){E.myFile=K.target.result.split("base64,")[1];I.request(J,E,G,D);};H.readAsDataURL(G);}},cancelFileReader:function(C){var B=this.fileReaderUnloader||{};var A=B[C];if(A){A();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.array","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.mstr.EnumFunction");var m=mstrmojo.array,g=mstrmojo.mstr.EnumFunction;var N={"8107C31BDD9911D3B98100C04F2233EA":"Sum","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C32CDD9911D3B98100C04F2233EA":"Product",B2C0FA4020C711D6AD1400C04F0423DE:"Greatest","8107C330DD9911D3B98100C04F2233EA":"Var","8107C32FDD9911D3B98100C04F2233EA":"Stdev","8107C32DDD9911D3B98100C04F2233EA":"Median",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31CDD9911D3B98100C04F2233EA":"Count","8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",B2C0FA4120C711D6AD1400C04F0423DE:"Least"},Q={"8107C326DD9911D3B98100C04F2233EA":"Rank"},AA={D221F90EB35540E3A1204ED6CC9A8267:"Avg",D221F90FB35540E3A1204ED6CC9A8267:"Count",D221F910B35540E3A1204ED6CC9A8267:"Max",D221F911B35540E3A1204ED6CC9A8267:"Min",D221F90DB35540E3A1204ED6CC9A8267:"Sum"},AB={"8107C32ADD9911D3B98100C04F2233EA":"Avg","8107C350DD9911D3B98100C04F2233EA":"Count","8107C34BDD9911D3B98100C04F2233EA":"Max","8107C34CDD9911D3B98100C04F2233EA":"Min","8107C32BDD9911D3B98100C04F2233EA":"Sum"},q={"8107C329DD9911D3B98100C04F2233EA":"Avg","8107C354DD9911D3B98100C04F2233EA":"Count","8107C351DD9911D3B98100C04F2233EA":"Max","8107C352DD9911D3B98100C04F2233EA":"Min","8107C328DD9911D3B98100C04F2233EA":"Sum"},X={"8107C337DD9911D3B98100C04F2233EA":"Banding","8107C338DD9911D3B98100C04F2233EA":"BandingC","8107C339DD9911D3B98100C04F2233EA":"BandingP"},H={"8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31CDD9911D3B98100C04F2233EA":"Count",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C32DDD9911D3B98100C04F2233EA":"Median","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode","8107C32CDD9911D3B98100C04F2233EA":"Product","8107C32FDD9911D3B98100C04F2233EA":"Stdev","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31BDD9911D3B98100C04F2233EA":"Sum","8107C330DD9911D3B98100C04F2233EA":"Var",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",A202C23DDD9D11D3B98100C04F2233EA:"Fvschedule",A202C23CDD9D11D3B98100C04F2233EA:"IRR",A202C240DD9D11D3B98100C04F2233EA:"MIRR",A202C23EDD9D11D3B98100C04F2233EA:"NPV","8107C34ADD9911D3B98100C04F2233EA":"Percentile","9C374203DD9F11D3B98100C04F2233EA":"AvgDev","9C374228DD9F11D3B98100C04F2233EA":"ChiSquareTest","9C374225DD9F11D3B98100C04F2233EA":"Correlation","9C374224DD9F11D3B98100C04F2233EA":"Covariance","9C374237DD9F11D3B98100C04F2233EA":"ForecastV","9C37422FDD9F11D3B98100C04F2233EA":"FTest","9C374234DD9F11D3B98100C04F2233EA":"GrowthV","9C37422EDD9F11D3B98100C04F2233EA":"HeteroscedasticTTest","9C37422DDD9F11D3B98100C04F2233EA":"HomoscedasticTTest","9C37422ADD9F11D3B98100C04F2233EA":"Intercept","9C374204DD9F11D3B98100C04F2233EA":"Kurtosis","9C374222DD9F11D3B98100C04F2233EA":"MeanTTest","9C37422CDD9F11D3B98100C04F2233EA":"PairedTTest","9C374226DD9F11D3B98100C04F2233EA":"Pearson","9C374227DD9F11D3B98100C04F2233EA":"RSquare","9C374205DD9F11D3B98100C04F2233EA":"Skew","9C374229DD9F11D3B98100C04F2233EA":"Slope","9C37422BDD9F11D3B98100C04F2233EA":"SteYX","9C374231DD9F11D3B98100C04F2233EA":"TrendV","9C374223DD9F11D3B98100C04F2233EA":"VarTest","4A99DC7BC5254A319F6B8098E7D652C1":"ConcatAgg"},Z={AND283:"And",OR284:"Or",NOT285:"Not",IF305:"If"},o={BEGINSWITH279:"Begins with",ENDSWITH279:"Ends with",IN289:"In",BETWEEN290:"Between",CONTAINS291:"Contains",LIKE291:"Like"};function P(AG){var AE=function(AI,AH){return mstrmojo.array.stringSorter(AI.n,AH.n);},AF,AD;AG=AG.sort(AE);for(AF=0,AD=AG.length;AF<AD;AF++){AG[AF].fns=AG[AF].fns.sort(AE);}return AG;}function Y(AG,AH){var AD=AG.length,AF;for(AF=0;AF<AD;AF++){var AE=AG[AF].fns;if(mstrmojo.array.find(AE,"did",AH)>-1){return AF;}}return -1;}function M(AE){var AD=mstrApp&&mstrApp.useQuickSearch&&mstrApp.useQuickSearch();AE=mstrmojo.hash.copy(AE,{taskId:"searchMetadata",recursive:true,styleName:"MojoFolderStyle",includeObjectDesc:true,includeAncestorInfo:false});if(AD){AE.quickSearch=AD;AE.nameWildcards=16;AE.sortKey=-1;}return AE;}function I(AE,AD){if(mstrApp.serverRequest){mstrApp.serverRequest(AD,AE);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(AE,AD,false,{});}}mstrmojo.ME.MetricDataService=mstrmojo.provide("mstrmojo.ME.MetricDataService",{rootFolderTypes:{ALL:39,FILTERS:4,METRICS:5,FACTS:29,SCHEMA:24,ATTRIBUTES:26,TRANSFORMATIONS:38},blockCount:10,suggestCount:10,suggestDelay:200,noCache:true,functions:null,metricComponents:null,functionsDetails:null,getServerProxy:function F(){if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}return this.serverProxy;},getMetricDefintion:function S(AF,AD){var AE={taskId:"getMetricDefinition",metricId:AF.id,outputFlags:65599};if(AF.msgID){AE.msgID=AF.msgID;}I.call(this,AD,AE);},validateMetric:function e(AF,AD){var AE={taskId:"validateMetric",metricId:AF.metricId,tokenStreamXML:AF.tokenStreamXML,metricXML:AF.metricXML,outputFlags:327695};if(mstrmojo.string.isEmpty(AF.metricId)){AE.isNew=true;}if(AF.msgID){AE.msgID=AF.msgID;}if(AF.formID){AE.frmid=AF.formID;}if(AF.isIDForm){AE.isIDForm=AF.isIDForm;}if(AF.objectType){AE.objectType=AF.objectType;}I.call(this,AD,AE);},getMetricComponents:function B(AH,AE){var AD=this,AF=this.metricComponents;if(!this.noCache&&AF&&AF.items.length==AF.sz){AE.success(AF);return ;}AE.success=mstrmojo.func.composite([AE.success,function(AI){if(AD.metricComponents&&AD.metricComponents.items){AD.metricComponents.items.push(AI.items);}else{AD.metricComponents=AI;}}]);var AG=M({blockBegin:AH.blockBegin,blockCount:AH.blockCount,searchPattern:AH.pattern,rootFolderType:AH.rootFolderType||24,objectType:AH.objectType||"12,13,43"});I.call(this,AE,AG);},getAttributes:function R(AF,AD){var AE=M({blockBegin:AF.blockBegin,blockCount:AF.blockCount,searchPattern:AF.pattern,rootFolderType:AF.rootFolderType||26,objectType:12});I.call(this,AD,AE);},getFacts:function L(AF,AD){var AE=M({blockBegin:AF.blockBegin,blockCount:AF.blockCount,searchPattern:AF.pattern,rootFolderType:AF.rootFolderType||29,objectType:13});I.call(this,AD,AE);},getMetrics:function G(AF,AD){var AE=M({blockBegin:AF.blockBegin,blockCount:AF.blockCount,searchPattern:AF.pattern,rootFolderType:AF.rootFolderType||5,objectType:4});if(AF.isVerify){AE.nameWildcards=2;}I.call(this,AD,AE);},getFunctions:function U(AI){var AK=this,AL=window.sessionStorage,AH=this.functions||(AL&&AL.getItem("functions")),AJ=AL&&AL.getItem("mstrLocaleId"),AF=mstrApp&&mstrApp.localeId;if(AH&&AJ==AF){AH=P(JSON.parse(AH).fncs);AI.success(AH);}else{var AE={failure:AI.failure,textResponse:true},AG={taskId:"getSystemFunctions",includeFunctionDetails:true,functionFlags:2|2147483648,includeFunctionHelpTopic:true};var AD=function(AM){m.forEach(AM,function(AO){var AN=AO&&AO.fns;m.forEach(AN,function(AQ){var AP=AQ.pros;var AR=m.filterOne(AP,function(AS){return AS.n==="UseLookupForAttributes";});if(AR){AR.dfv="0";}});});};AE.success=function(AM){if(typeof AM==="string"||!mstrApp.isSingleTier){AM=AM.replace(/\\'/g,"'");var AO=JSON.parse(AM),AN=AO.fncs;AD(AN);AM=JSON.stringify(AO);if(AL){AL.setItem("functions",AM);AL.setItem("mstrLocaleId",AF);}AK.functions=AM;AH=P(JSON.parse(AM).fncs);}else{AD(AM.fncs);AH=P(AM.fncs);AK.functions=JSON.stringify(AM);}AI.success(AH);};I.call(this,AE,AG);}},getAggFunctions:function C(){if(this._aggFunctions){return this._aggFunctions;}var AD=this.parseFuncStr();AD=mstrmojo.array.filter(AD[this.getBasicCategoryIndex(AD)].fns,function(AF){var AE=AF.did,AG;if(AE!=="B2C0FA4020C711D6AD1400C04F0423DE"&&AE!=="B2C0FA4120C711D6AD1400C04F0423DE"){AG=N[AE];}return AG;});return AD;},getOLAPAggFunctions:function E(AD){var AE=this.parseFuncStr();AE=mstrmojo.array.filter(AE[this.getOLAPCategoryIndex(AE)].fns,function(AF){switch(AD){case"moving":return AB[AF.did];case"running":return q[AF.did];case"olap":default:return AA[AF.did];}return false;});return AE;},getFunctionCatList:function u(){if(this._functionCatList){return this._functionCatList;}var AD=this.parseFuncStr();AD=mstrmojo.hash.make(AD,mstrmojo.Arr);this._functionCatList=AD;return AD;},getCategoryIndex:function t(AE,AD){return Y(AD||this.getFunctionCatList(),AE);},getBasicCategoryIndex:function J(AE){var AD="B2C0FA4020C711D6AD1400C04F0423DE";return Y(AE||this.getFunctionCatList(),AD);},getDataMiningCatIndex:function k(AD){var AE="F17CD4F3FF134D91B80DDAB9CA73C919";return Y(AD||this.getFunctionCatList(),AE);},getDateTimeCategoryIndex:function z(AE){var AD="C50F2A4F75AE49D6B20E00224967B500";return Y(AE||this.getFunctionCatList(),AD);},getStringCategoryIndex:function h(AE){var AD="6F7DF5FF449111D5BEA300B0D01A55EF";return Y(AE||this.getFunctionCatList(),AD);},getOLAPCategoryIndex:function J(AE){var AD="D221F90EB35540E3A1204ED6CC9A8267";return Y(AE||this.getFunctionCatList(),AD);},getInternalCategoryIndex:function V(AE){var AD="8107C337DD9911D3B98100C04F2233EA";return Y(AE||this.getFunctionCatList(),AD);},getFunctionDetails:function w(AF,AD){var AE={taskId:"getSystemFunctions",functionId:AF.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};I.call(this,AD,AE);},getTransformations:function O(AF,AD){var AE=M({blockBegin:AF.blockBegin,blockCount:AF.blockCount,searchPattern:AF.pattern,rootFolderType:AF.rootFolderType||38,objectType:43});I.call(this,AD,AE);},getFilters:function l(AF,AD){var AE=M({blockBegin:AF.blockBegin,blockCount:AF.blockCount,searchPattern:AF.pattern,rootFolderType:AF.rootFolderType||4,objectType:1});I.call(this,AD,AE);},getAttributeForms:function f(AF,AD){var AE={taskId:"getAttributeForms",attributeID:AF.attributeID,displayedForms:AF.displayedForms,styleName:"WidgetElementListStyle"};I.call(this,AD,AE);},getSubtotalFunctions:function W(AF,AD){var AE=M({objectType:"1025,1026",searchPattern:""});I.call(this,AD,AE);},isBasicAggMap:function n(AD){var AE=!!N[AD];if(AD==="B2C0FA4020C711D6AD1400C04F0423DE"||AD==="B2C0FA4120C711D6AD1400C04F0423DE"){AE=false;}return AE;},isOLAPAgg:function AC(AD){return !!AA[AD];},isMovingAgg:function a(AD){return !!AB[AD];},isRunningAgg:function d(AD){return !!q[AD];},isBanding:function j(AD){return !!X[AD];},isOLAP:function K(AE){var AF=this.getFunctionCatList(),AD=AF[this.getOLAPCategoryIndex(AF)].fns;return mstrmojo.array.find(AD,"did",AE)>-1;},isRank:function D(AD){return !!Q[AD];},isScalar:function c(AD){return(AD||{}).sqt===3;},hasLookupForAttributesProps:function(AD){return !!H[AD];},getFunctionHelpTopic:function p(AD){var AE="<div class='func-details' onclick='mstrmojo.ME.MetricDataService.showFunctionHelpTopic(\"##HELPTOPIC##\")'>"+mstrmojo.desc(5811,"Details...")+"</div>";AE=AE.replace("##HELPTOPIC##",AD);return AE;},showFunctionHelpTopic:function x(AE){var AF=mstrApp.isSingleTier,AD=((mstrApp.helpUrl||"../help/")+"FunctionsRef/");if(AF){AD=AD+"index.htm#cshid="+(AE||"");window.FormWrapper.openPage(AD);}else{if(AE){AD=AD+"Content/"+AE+".htm";}else{AD=AD+"index.htm";}window.open(AD);}return false;},sortFunctions:function A(AE){var AF={},AD=function(AH,AG){return mstrmojo.array.stringSorter(AH.n,AG.n);};mstrmojo.array.forEach(AE,function(AG){mstrmojo.array.forEach(AG&&AG.fns,function(AH){if(AH&&AH.did){AF[AH.did]=AH;}});});return mstrmojo.hash.valarray(AF).sort(AD);},parseFuncStr:function b(){var AD=window.sessionStorage,AE=this.functions||AD&&AD.getItem("functions");if(AE){return P(JSON.parse(AE).fncs);}},isValEqual:function(AG,AF){if(AG===AF){return true;}var AD=[-1,"-1","True",true],AE=[0,"0","False",false];if(AD.indexOf(AG)>-1&&AD.indexOf(AF)>-1){return true;}else{if(AE.indexOf(AG)>-1&&AE.indexOf(AF)>-1){return true;}}return false;},isFuncHasUseLookupForAttributeProp:function(AE){var AD=[g.FunctionSum,g.FunctionCount,g.FunctionAvg,g.FunctionMin,g.FunctionMax,g.FunctionProduct,g.FunctionMedian,g.FunctionMode,g.FunctionStdev,g.FunctionVar,g.FunctionGeomean,g.FunctionPercentile,g.FunctionStdevP,g.FunctionVarP,g.FunctionFirst,g.FunctionLast,g.ConcatAgg];return AD.indexOf(AE)>-1;},isLogicOrCompFunc:function(AE){var AD=AE.v.toUpperCase()+AE.tp;return !!Z[AD]||!!o[AD];}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var C=1;mstrmojo._hasWidgetListMapper={buildItemWrappers:function A(H,G,F,E,J,I){E.first=J;E.last=I;return this._super(H,G,F,E,0,0);},postBuildRendering:function B(K,I,H,G,F){var J=F.first;if(J){this.fillItemWrappers(K,I,H,G,F,0,J);}if(F.last){var E=I&&I.length||0,L=Math.max(Math.max(0,E-F.last),J);this.fillItemWrappers(K,I,H,G,F,L,E);}if(this._super){this._super(K,I,H,G,F);}},fillItemWrappers:function D(F,N,K,R,M,E,I,Q){var L=(N&&N.length)||0,P=this.wrapperNodes(F),S=M.itemStatus;for(var J=E,O=Math.min(I+1,L),H=0;J<O;J++){if(S[J]!==C){var G=K.build(R,M,N[J],J);if(G){G.placeholder=P[J].firstChild;G.render();}H++;if(H===Q){break;}}}return H;},onchange:null};mstrmojo.WidgetListMapper=mstrmojo.provide("mstrmojo.WidgetListMapper",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.WidgetListMapper.RENDERED=C;mstrmojo.requiresCls("mstrmojo.ListMapperHoriz");mstrmojo.WidgetListMapperHoriz=mstrmojo.provide("mstrmojo.WidgetListMapperHoriz",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperHoriz)));})();(function(){mstrmojo.requiresCls("mstrmojo._HasScrollbox","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Widget");var R=mstrmojo,S=R.array,A=R.css,I=R.dom,P=R.hash,k=R.string,W="selected",H="open",X="leaf",d="loading",g=":",c="li",o="ul",m="idx",n="level";function F(AC,t,AA,x){var z=this.renderIndex*this.renderBlockSize,q=AA.split(":"),AB=parseInt(q[0],10)+z,u=!!this.selectedIndices[AB],p=!!this.expandedIndices[AB],w=(AC.isLeaf||(!this.dataHelper&&!(AC.items&&AC.items.length)));q[0]=AB;return k.apply('<{@tag} class="{@cls}" level="{@level}" idx="{@idx}">{@itemMkp}{@childMkp}</{@tag}>',{tag:c,cls:(u?W:"")+(p?" "+H:"")+(w?" "+X:""),level:t,idx:q.join(":"),itemMkp:this.itemRenderer.render(AC,t,AA,this),childMkp:x||""});}function b(AB,q,w){var AE=[],u=0,AC=this.itemRenderer,AA=AC&&AC.render,p=AB&&AB.length,z,x,AD,t;AE[u++]="<"+o+">";if(AA&&typeof AA==="function"&&p){for(t=0;t<AB.length;t++){AD=AB[t];z=w.concat([t]);x=z.join(g);AE[u++]=F.call(this,AD,q,x,b.call(this,AD.items,q+1,z));}}AE[u]="</"+o+">";return AE.join("");}function L(q,t){var p=t[0];if(t&&t.length===1){return q[p];}return L(q[p].items,t.slice(1));}function K(q,t,u,z,p,x){var w=x.treeHooks[q];if(w&&w.call(x,t,u,z,p)){return ;}A.toggleClass(t,W,q==="select");}function U(q,w,AF,p,AD,AA){var AC=AA.treeHooks[q],x=AF.items,AB=(!x||x.length===0),u=q==="expand",z=AA.dataHelper;if(AC&&AC.call(AA,w,AF,p,AD)){return ;}if(u&&!z&&AB){A.addClass(w,X);return ;}if(u&&z){if(AB){if(AF.tp==="search"){A.toggleClass(w,H,u);return ;}A.toggleClass(w,d,true);z.fetch(AF,{success:function AE(AH){var AG=AF.items=AH.items;if(AG&&AG.length>0){w.innerHTML+=b.call(AA,AG,(parseInt(p,10)+1),AF._renderIdx.split(g));}else{A.addClass(w,X);}},complete:function t(){A.toggleClass(w,d,false);}});}}A.toggleClass(w,H,u);}mstrmojo.ui.SimpleTree=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ui.SimpleTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click>{@itemsHTML}</div>',markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},markupSlots:{scrollboxNode:function M(){return this.domNode;}},items:undefined,dataHelper:undefined,treeHooks:{},init:function j(p){this._super(p);this.expandedIndices={};this.selectedIndices={};},buildRendering:function a(){var p=this.items,q;if(this.renderOnScroll&&this.items){this.renderIndex=0;p=this.items.slice(this.renderIndex,this.renderBlockSize);}q=p&&p.length;this.itemsHTML=q?b.call(this,p,0,[]):"";this._super();delete this.itemsHTML;},renderOnScroll:false,_cb_scroll:undefined,renderBlockSize:50,renderIndex:0,onscroll:function e(){if(this.renderOnScroll){var t=1,w=this.domNode,u=w.clientHeight,p=(this.renderIndex+1)*this.renderBlockSize;if(p>=this.items.length){return ;}if(Math.ceil(u+w.scrollTop)+t>=w.scrollHeight){this.renderIndex++;var q=this.items.slice(p,p+this.renderBlockSize);this.domNode.innerHTML+=b.call(this,q,0,[]);}}},postBuildRendering:function N(){if(!this._cb_scroll){var q=this.id;this._cb_scroll=function p(){var t=mstrmojo.all[q];t.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);if(this._super){this._super();}},getItemMarkup:function(){return'<{@tag} class="{@cls}" style="{@style}">{@n}</{@tag}>';},getItemProps:function V(q,t,p){return{tag:"div",cls:"item ",n:q.n||"",style:"",idx:p};},itemRenderer:{render:function(q,u,p,t){q._renderIdx=p;q._renderLvl=u;return k.apply(t.getItemMarkup(q,u,p),t.getItemProps(q,u,p));},select:function f(q,t,w,p,u){K("select",q,t,w,p,u);},unselect:function G(q,t,w,p,u){K("unselect",q,t,w,p,u);},expand:function B(q,t,w,p,u){U("expand",q,t,w,p,u);},collapse:function O(q,t,w,p,u){U("collapse",q,t,w,p,u);}},_set_items:function Q(q,u){var t=this.items;this.items=u;if(t!==u){var p=this.hasRendered;if(p){this.unrender(false);}if(p){this.render();}return true;}return false;},getTreeItem:function C(p){if(p!==null){return L(this.items,p.split(g));}},getLeafNode:function D(q){var p=this.domNode.children[0].children;if((q>=0)&&(q<p.length)){return p[q];}},addChild:function J(u,q){var x=this,p=x.getTreeItem(u).items,t=u.split(g);t.push(p.length);if(this.hasRendered){var w=this.domNode.getElementsByTagName(c);S.forEach(w,function(AA){if(AA.getAttribute(m)===u){var z=q[0];var AB=document.createElement("div");AB.innerHTML=F.call(x,z,parseInt(AA.getAttribute(n),10)+1,t.join(g),b.call(x,z.items,parseInt(AA.getAttribute(n),10)+2,t));AA.lastChild.appendChild(AB.firstChild);p.push(z);return false;}return true;});}},updateChild:function h(q,p){var u=this;P.copy(p,u.getTreeItem(q));if(this.hasRendered){var t=this.domNode.getElementsByTagName(c);S.forEach(t,function(w){if(w.getAttribute(m)===q){var x=parseInt(w.getAttribute(n),10);w.innerHTML=u.itemRenderer.render(p,x,q,u)+b.call(u,p.items,x+1,q.split(g));return false;}return true;});}},toggleChildSelection:function l(q,p){var t=this.domNode.getElementsByTagName(c);S.forEach(t,function(u){if(u.getAttribute(m)===q){A.toggleClass(u,W,p);this.selectedIndices[q]=p;return false;}return true;},this);},removeChild:function E(t){var q=t.split(g),w=q.length,u=q[w-1],p=this;if(w>1){q=q.splice(0,w-1);p=this.getTreeItem(q.join(g));p.items.splice(u,1);this.updateChild(p._renderIdx,p);}else{this.items.splice(u,1);this.refresh();}},getItemWithPropName:function Z(t,x,AA){var q=S.find(t,x,AA);var u,w=[];if(q!==-1){w.push(t[q]);}for(u=0;u<t.length;u++){var p=t[u].items;if(p&&p.length){var z=this.getItemWithPropName(p,x,AA);if(z&&z.length){w=w.concat(z);}}}return w;},onclick:function Y(z){try{var u=z.target||I.eventTarget(z.hWin,z.e),q=u.tagName.toLowerCase(),AC=I.findAncestorByAttr(u,m,true,this.domNode),p=AC&&AC.node.getAttribute(n),x=AC&&AC.value;if(q===o){return ;}if(x!==null&&!isNaN(parseInt(p,10))){var t={sel:{indicesName:"selected",enabledFn:"select",disabledFn:"unselect"},ex:{indicesName:"expanded",enabledFn:"expand",disabledFn:"collapse"}}[(q!==c)?"sel":"ex"];var AA=this[t.indicesName+"Indices"],AB=AA[x];if(AB){delete AA[x];}else{AA[x]=true;}this.itemRenderer[AB?t.disabledFn:t.enabledFn](AC.node,this.getTreeItem(x),p,x,this);}}catch(w){mstrApp.onerror(w);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.HistogramWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.HistogramWidget",options:null,binMatrix:null,range:null,markupString:"<canvas></canvas>",update:function(D,A,E,F){if(D===undefined||A===undefined||F.length===0||F[0].length===0){this.range=null;this.binMatrix=null;this.parent.histogramNode.style.display="none";}else{this.range={min:D,max:A,step:E};this.binMatrix=F;this.peak=0;var C,B;for(C=0;C<F.length;C++){var G=F[C];for(B=0;B<G.length;B++){this.peak=Math.max(this.peak,G[B]);}}}if(this.binMatrix!==null){this.parent.histogramNode.style.display="block";this.resize();this._render();}},resize:function(){var A=this.options.height||(this.parent.hasOtherChoices()?54:73);this.domNode.height=A;this.domNode.width=this.parent.histogramNode.clientWidth;this.parent.histogramNode.style.height=A+"px";},_render:function(){var D=this;var F=this.options;var E=this.domNode;var B=E.getContext("2d");B.fillStyle="white";B.fillRect(0,0,E.width,E.height);B.save();B.translate(0,E.height);B.scale(1,-1);var G=E.width/this.binMatrix[0].length;B.save();B.strokeStyle=F.emptyBinColor||"#faa";B.lineWidth=1;B.moveTo(0,0);B.lineTo(E.width,0);B.stroke();B.restore();var A=function(I){var K=Math.floor(15*(D.binMatrix.length-I)/D.binMatrix.length);var J=K.toString(16);return"#"+J+J+J;};var C=function(M,J,P){B.save();B.lineWidth=0;B.fillStyle=J;B.strokeStyle=P;var O;for(O=0;O<M.length;O++){var N=M[O];if(N>0){var L=O*G;var K=Math.ceil(G);var I=Math.max(2,Math.ceil(N*E.height/D.peak));B.fillRect(L,0,K,I);B.strokeRect(L,0,K,I);}}B.restore();};var H;for(H=0;H<this.binMatrix.length;H++){C(this.binMatrix[H],F.hasOwnProperty("binBorderColors")&&H<F.binColors.length?F.binColors[H]:A(H),F.hasOwnProperty("binBorderColors")&&H<F.binBorderColors.length?F.binBorderColors[H]:A(H));}B.restore();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string");var B=mstrmojo.string;mstrmojo.Label=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Label",allowHTML:false,text:"",title:"",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){var C=this.text;C=B.isEmpty(C)?"":C.toString();this.domNode.innerHTML=this.allowHTML?C:B.encodeHtmlString(B.decodeHtmlString(C),true);},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},autoHide:false,_set_text:function A(E,C){if(this.autoHide){this.set("visible",(C!==null)&&(C!=="")&&(C!==undefined));}var D=this.text;this.text=C;return(D!==C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css");var C=mstrmojo.Widget;mstrmojo.ui.Checkbox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ui.Checkbox",markupString:'<div id="{@id}" class="mstrmojo-ui-Checkbox {@cssClass}" mstrAttach:click></div>',markupMethods:{onvisibleChange:C.visibleMarkupMethod,oncheckedChange:function B(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},onenabledChange:C.enabledMarkupMethod},checked:false,onclick:function A(){this.set("checked",!this.checked);}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.css","mstrmojo._IsExprNode","mstrmojo._HasPopup","mstrmojo.Widget","mstrmojo.fe.FilterUtils");var I=mstrmojo.dom,A=mstrmojo.css,E=mstrmojo.fe.FilterUtils,D=E.getExprConditionNodeHtml,B=E.getExprNodeHtmlAndText;function C(J){var K=J.data;return D(K);}mstrmojo.ConditionNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.ConditionNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},oneditableChange:function(){A.toggleClass(this.textNode,["editable"],this.editable);},onselectedChange:function(){A.toggleClass(this.condNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();var J=B(this.data);this.textNode.innerHTML=J.html;this.textNode.title=J.text;this.textPostfixNode.innerHTML=this.getConditionTextPostfix();}},betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),init:function H(J){this._super(J);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());},getConditionTextPostfix:function(){return"";},del:function G(){var J=this.parent;if(J&&J.remove&&this.data){J.remove(this.data);}},isEmpty:function(){var K=this.data,J=K&&K.et,L=J&&mstrmojo.expr.ET2TGT[J];return !(L&&K[L]);},isSelectableArea:function(J){return I.contains(this.condNode,J,true);},preclick:function F(J){var L=null,K=I.eventTarget(J.hWin,J.e);if(I.contains(this.prefixNode,K,true)){L="andor";}else{if(I.contains(this.textNode,K,true)){L="condition";}else{if(I.contains(this.textPostfixNode,K,true)){I.stopPropogation(J.hWin,J.e);return false;}}}J.part=L;}});mstrmojo.ConditionNode.getFunctionNode=C;})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.css","mstrmojo.string");function A(C,B){return mstrmojo.hash.copy(B,{label:"",tabIndex:"",cssDisplay:"inline",name:null,markupString:'<span id="{@id}" class="'+C+' {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input"  type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},onenabledChange:function(){this.inputNode.disabled=!this.enabled;mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,"disabled");},onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(this.label);},oncheckedChange:function(){this.inputNode.checked=this.checked;}},checked:false,preclick:function(){this.set("checked",this.inputNode.checked);},isChecked:function(){return this.inputNode.checked;}});}mstrmojo.CheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox",{scriptClass:"mstrmojo.CheckBox",type:"checkbox"}));mstrmojo.ImageCheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox mstrmojo-ImageCheckBox",{scriptClass:"mstrmojo.CheckBox",type:"image",cssDisplay:"block",preclick:function(){this.set("checked",!this.checked);},postCreate:function(){this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oncheckedChange=function(){mstrmojo.css.toggleClass(this.inputNode,["checked"],this.checked);};},postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";if(this._super){return this._super();}return true;}}));mstrmojo.RadioButton=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-RadioButton",{scriptClass:"mstrmojo.RadioButton",type:"radio",postBuildRendering:function(){if(mstrmojo.dom.isIE){this.inputNode.checked=this.checked;}}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash");function A(H,E,G,F){var D=mstrmojo.hash.copy(F,{props:{left:{isStyle:true,start:H,stop:E,suffix:"px",ease:mstrmojo.ease.linear}},duration:G});(new mstrmojo.fx.AnimateProp(D)).play();}function B(K,N,G,L){var I=K.domNode,M=I.offsetWidth,D=K.scrollableIncFetch;var E=K.hasAnimation&&(!(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent))||Number(RegExp.$1)>3.5),J=L?1:-1,F=parseInt(M,10)*J,H=E?500:0;A(0,-F,H,{target:G,duration:H,preStart:function(){this.target.style.overflowY="hidden";},onEnd:function(){this.target.style.display="none";}});A(F,0,H,{target:N,preStart:function(){this.target.style.display="block";this.target.style.overflowY=(D?"visible":"auto");}});if(K.waiting){A(0,-F,H,{widget:K,slot:"loaderNode",onEnd:function(){this.widget.waiting=false;}});}}var C=function(D){var E=D.currentPage;if(E===D.p1Node){E=D.p2Node;}else{E=D.p1Node;}D.currentPage=E;};mstrmojo.Booklet=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Booklet",pageClass:"mstrmojo-BookletPage",markupString:'<div id="{@id}" class="mstrmojo-Booklet {@cssClass}" style="{@cssText}"><div id="{@id}_p1" class="mstrmojo-BookletPage" ></div><div id="{@id}_p2" class="mstrmojo-BookletPage" style="left:-100%;"></div><div id="{@id}_ldr" class="mstrmojo-BookletLoader" ></div></div>',markupSlots:{containerNode:function(){return this.domNode;},p1Node:function(){return this.domNode.firstChild;},p2Node:function(){return this.domNode.childNodes[1];},loaderNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onnextChange:function(){var G=this.next;if(!G){return ;}var D=this.currentPage,F=this.p1Node,E=this.currentPage=(D==F)?this.p2Node:F;if(!(G instanceof mstrmojo.Obj)){G=this.next=mstrmojo.insert(G);}if(!G.hasRendered){G.placeholder=E.appendChild(document.createElement("span"));G.render();}else{if(E.firstChild){E.replaceChild(G.domNode,E.firstChild);}else{E.appendChild(G.domNode);}}this.set("waiting",false);if(E&&D){B(this,E,D,this.turnDirFwd);}else{if(this.scrollableIncFetch){E.style.overflowY="visible";}}},onwaitingChange:function(D){this.loaderNode.style.left=(this.waiting)?0:"-100%";},onheightChange:function(D){if(this.height){this.domNode.style.height=this.height;}},onwidthChange:function(D){if(this.width){this.domNode.style.width=this.width;}}},enabled:true,waiting:false,next:null,currentPage:null,turnDirFwd:true,hasAnimation:true,scrollableIncFetch:false,FORWARD:true,REVERSE:false,turnFwd:function(D){this.turn(D,this.FORWARD);},turnBack:function(D){this.turn(D,this.REVERSE);},turn:function(D,E){this.set("turnDirFwd",E);this.set("next",D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var F=mstrmojo.dom,K=mstrmojo.css,N=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var V=document.createElement("tr"),W=this.data,Z=this._cmSource,R,S;V.id=this.id;V.className="mstrmojo-ContextMenuItem "+(Z.isSeparatorItem(W)?"separator":Z.item2textCss(W));var X=this,Y=function(){X.handleMouseOver();},U=function(){X.handleMouseOut();},Q=function(){X.handleClick();};F.attachEvent(V,"mouseover",Y);F.attachEvent(V,"mouseout",U);F.attachEvent(V,"click",Q);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-left";S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-text";if(Z.isSeparatorItem(W)){S=document.createElement("img");S.src="../images/1ptrans.gif";}else{S=document.createElement("div");S.className="mstrmojo-CMI-content";R.innerHTML=W.itemWidget?"&nbsp":W[this.itemField];}R.appendChild(S);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);return V;},buildRendering:function L(){this._super();var Q=this.data.itemWidget;if(Q){Q.placeholder=this.domNode.cells[1].children[0];Q.data=this.data;Q=mstrmojo.insert(Q);Q.render();Q.parent=this;this.itemWidget=Q;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){K.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){K.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function I(){var Q=F.position(this.domNode,true);return{x:Math.round(Q.x+Q.w-this.SUBMENU_SHIFT),y:Math.round(Q.y)};},getContextMenuItems:function B(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function D(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function M(){var Q=this.data;if(Q.onContextMenuOpen){Q.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function A(){var Q=this.data;if(Q.onContextMenuClose){Q.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function J(){},getContextMenuSource:function P(){return this._cmSource;},adjustMenuPosition:function G(){var Q=this._subMenu,U=this._subMenu.domNode,S=U.offsetHeight,R=U.offsetWidth,X=F.windowDim(),W=F.position(U,false),V=F.position(U,true);if((W.x+R+N)>X.w){Q.set("left",(F.position(this.domNode,true).x-R)+"px");}else{Q.set("left",(F.position(this.domNode,true).x+this.domNode.offsetWidth)+"px");}if((W.y+S+N)>X.h){Q.set("top",(X.h-S-N+(V.y-W.y))+"px");}},handleMouseOver:function O(){var Q=this,R=function(){if(Q.hasSubmenu){Q.showContextMenu();}Q._cmSource.closeMenuTree(Q);Q._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(R,80);}},handleMouseOut:function H(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function C(){this._cmSource.closeMenuTree();},handleClick:function E(){if(this.hasSubmenu){return ;}var Q=this._cmSource,R=this.data;if(!this.itemWidget){if(!Q.isSeparatorItem(R)&&Q.queryEnabled(R)){if(Q.executeCommand){Q.executeCommand(this.data);}Q.closeMenuTree();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.requiresDescs(1825);var A=mstrmojo.dom;mstrmojo.Refine.RefineFileButton=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.RefineFileButton",browseLabel:mstrmojo.desc(1825,"Browse")+"...",markupString:'<span class="refine-file-button" mstrAttach:click>{@browseLabel}<input type="file" mstrAttach:change/></span>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},markupSlots:{inputNode:function(){return this.domNode.lastChild;}},onclick:function(B){if(mstrApp.isSingleTier){var E=window.FormWrapper.loadDWHistoryList();this.parent.textArea.set("value",E);this.parent.textArea.oninput();}else{var D=B.e,C=A.eventTarget(B.hWin,D);if(C!==this.inputNode){this.inputNode.click();}}},onchange:function(){var D=this.inputNode.files[0];var C=this;var B=new FileReader();B.onload=function(E){var F=E.target.result;C.parent.textArea.set("value",F);C.parent.textArea.oninput();};B.readAsText(D,"UTF-8");this.inputNode.value="";}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.SliderWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.SliderWidget",sliderNode:null,options:null,range:{min:0,max:1,step:1,from:0,to:0},drag:null,postCreate:function(){var A=this;this._mouseMoveHandler=function(B){return A._onMouseMove(B);};this._mouseUpHandler=function(B){return A._onMouseUp(B);};this.initializeUI();this.updateRange();},initializeUI:function(){var A=this;this.leftTintedRect=document.createElement("div");this.leftTintedRect.className="slider-widget-tint left";this.sliderNode.appendChild(this.leftTintedRect);this.rightTintedRect=document.createElement("div");this.rightTintedRect.className="slider-widget-tint right";this.sliderNode.appendChild(this.rightTintedRect);this.highlightRect=document.createElement("div");this.highlightRect.className="slider-widget-highlight slider-widget-draggable";this.highlightRect.setAttribute("part","highlight");this.sliderNode.appendChild(this.highlightRect);this.highlightRect.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.leftBracket=document.createElement("div");this.leftBracket.className="slider-widget-bracket slider-widget-draggable left";this.leftBracket.setAttribute("part","left");this.sliderNode.appendChild(this.leftBracket);this.leftBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.rightBracket=document.createElement("div");this.rightBracket.className="slider-widget-bracket slider-widget-draggable right";this.rightBracket.setAttribute("part","right");this.sliderNode.appendChild(this.rightBracket);this.rightBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);},_onMouseDown:function(A,C){if(this.drag){return ;}document.addEventListener("mousemove",this._mouseMoveHandler,false);document.addEventListener("mouseup",this._mouseUpHandler,false);var B=document.createElement("div");B.className="slider-widget-overlay";document.body.appendChild(B);this.drag={sureDrag:false,overlay:B};if("highlight"===C){this.drag.elmt=this.highlightRect;this.drag.value=this.range.from;this.drag.overlay.style.cursor="move";}else{if("left"===C){this.drag.elmt=this.leftBracket;this.drag.overlay.style.cursor="e-resize";}else{if("right"===C){this.drag.elmt=this.rightBracket;this.drag.overlay.style.cursor="w-resize";}}}this.drag.what=C;this.drag.from=this.range.from;this.drag.to=this.range.to;this.drag.down={x:A.pageX,y:A.pageY};},_onMouseUp:function(){if(!(this.drag)){return ;}document.removeEventListener("mousemove",this._mouseMoveHandler,false);document.removeEventListener("mouseup",this._mouseUpHandler,false);if(this.drag.sureDrag){this.updateRange();this.trigger("stop");}document.body.removeChild(this.drag.overlay);this.drag=null;},_onMouseMove:function(H){if(!(this.drag)){return true;}var C=this.drag;var D=this.range;var F=H.pageX-C.down.x;if(Math.abs(F)>=2){C.sureDrag=true;}var E=this.sliderNode.clientWidth;var A=E/(D.max-D.min);var I=F/A;var G=function(){D.from=C.from+Math.floor(I/D.step)*D.step;D.from=Math.max(Math.min(D.from,D.max),D.min);};var B=function(){D.to=C.to+Math.floor(I/D.step)*D.step;D.to=Math.max(Math.min(D.to,D.max),D.min);};if(C.what==="left"){G();D.to=Math.min(Math.max(D.to,D.from+D.step),D.max);}else{if(C.what==="right"){B();D.from=Math.max(Math.min(D.from,D.to-D.step),D.min);}else{G();B();}}this.updateRange();this.trigger("slide");H.preventDefault();return false;},trigger:function(A){this.parent.raiseEvent({name:A,from:this.range.from,to:this.range.to});},updateRange:function(){var A=this.range;var F=this.sliderNode.clientWidth;var E=F/(A.max-A.min);var B=function(G){return(G-A.min)*E;};var C=Math.floor(B(A.from));var D=Math.floor(B(A.to));if(A.from===A.min&&A.to===A.max){this.leftTintedRect.style.display="none";this.rightTintedRect.style.display="none";}else{this.leftTintedRect.style.display="block";this.leftTintedRect.style.width=C+"px";this.rightTintedRect.style.display="block";this.rightTintedRect.style.width=(F-D)+"px";}this.highlightRect.style.width=(D-C)+"px";this.highlightRect.style.left=C+"px";this.leftBracket.style.left=C+"px";this.rightBracket.style.left=D+"px";},update:function(B,A,C,E,D){if(C<=0){C=1;}A=Math.max(A,B+C);E=E!==null?Math.max(B,E):B;D=D!==null?Math.min(A,D):A;this.range={min:B,max:A,step:C,from:E,to:D};this.updateRange();}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget");var J=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";",'"'],F=null;function D(O){if(!F){F={};var N,M;for(N=0,M=J.length;N<M;N++){F[J[N]]=true;}}return F[O];}mstrmojo.qb.FFsqlToken=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.qb.FFsqlToken",data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}"></span>',active:false,dropZone:true,allowDrop:function H(M){return this.dropZone;},ondrop:function(M){mstrmojo.all.FFsql.ondrop(M);},markupMethods:{ondataChange:function(){var M=this.data;if(M.v===","){this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}else{if(M.v=="\n"){this.domNode.innerHTML="<br>";}else{this.domNode.innerHTML=mstrmojo.string.encodeHtmlString(String(M.v));}}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql());mstrmojo.css.toggleClass(this.domNode,["invalid"],M.sta===-1);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);if(!this.active){var N=mstrmojo.all.FFsql;if(!this.isMstrO()&&!this.isDelimiter()){var M=N.candidates.items,P=this.data,O=P.v.toLowerCase();mstrmojo.array.forEach(M,function(R){if(O===R.n.toLowerCase()){P.oi=R;return false;}});}mstrmojo.css.toggleClass(this.domNode,["mstr"],this.isMstrO());var Q=this.isOutOfBracket(N.items,this.data.did);mstrmojo.css.toggleClass(this.domNode,["sql"],this.isSql()&&Q);}}},isOutOfBracket:function(Q,V){var M=Q.map(function(X){return X.v;}),R=Q.map(function(X){return X.did;}),O=R.indexOf(V),P=M.slice(0,O+1),W=P.join(""),S=W.split("[").length-1,N=W.split("]").length-1,U=S<=N;return U;},isMstrO:function I(){var M=this.data;return(!!M.oi&&M.oi.sta!==2)||!!M.rfd;},isSql:function L(){return this.data.oi&&this.data.oi.sta===100;},length:function B(){return this.data.v.length;},isDelimiter:function A(){return this.data.isDelimiter||(this.length()===1&&D(this.data.v));},split2Tokens:function E(Q,N){var P=this.data,O=P&&P.v,R=O.substring(0,Q),M=O.substring(Q);return[{v:R,isNew:true,did:P.did},{v:M,isNew:true,did:N}];},mergeTo:function C(N){var P=this.data,O=P&&P.v,M=N.data.v;return{v:O+M,isNew:true};},setItemInfo:function G(M){var N=this.data;N.v=M.n;N.oi=M;N.sta=1;N.isNew=true;this.set("data",N);this.paint();},spliceContent:function K(S,Q,N){var R=this.data,P=R&&R.v,U=P.substring(0,S);if(N&&N!=="'"&&N.charAt(0)==="'"){N=N.substr(1);}Q=(Q===null||Q===undefined)?(P.length-S):Q;var M=P.substring(S+Q),O=U+(N||"")+M;R.v=O;R.isNew=true;R.sta=1;delete R.oi;this.set("data",R);this.paint();}});mstrmojo.qb.FFsqlToken.isDelimiter=D;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Widget");var B=mstrmojo.dom;mstrmojo.InlineEditBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.InlineEditBox",text:null,editMode:false,allowEdit:true,okSave:false,allowHighlight:false,emptyHint:"Enter your text here.",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.lastChild;},inputNode:function(){return this.domNode.lastChild.firstChild;},okNode:function(){return this.domNode.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontextChange:function(){var C=this.text||this.emptyHint||"";this.textNode.innerHTML=this.allowHighlight?C:mstrmojo.string.encodeHtmlString(C);},oneditModeChange:function(){var H=this.editMode,E=this.domNode,D=this.textNode,G=this.editNode;mstrmojo.css.toggleClass(E,["edit"],H);if(H){D.style.display="none";G.style.display="block";D=this.inputNode;var F=D.style;D.value=this.text||"";F.width=(E.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";F.height=E.clientHeight+"px";D.focus();if(D.createTextRange){var I=D.createTextRange(),C=D.value.length;I.move("character",C);I.select();}}else{D.style.display="block";G.style.display="none";}},onokSaveChange:function(){var C=this.okSave?"inline":"none";this.okNode.style.display=C;this.cancelNode.style.display=C;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},onvisibleChange:function A(){if(this.domNode){this.domNode.style.display=(this.visible?"block":"none");}},preclick:function(C){var E=C.e,D=B.eventTarget(C.hWin,E);if(D===this.okNode){this.save();}else{if(D===this.cancelNode){this.cancel();}else{if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}}},prekeyup:function(C){var E=C.e,D=E.keyCode||E.charCode;if(D===mstrmojo.Enum_Keys.ENTER){this.save();}else{if(D===mstrmojo.Enum_Keys.ESCAPE){this.cancel();}}},_attachEvents:function(){var C=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var D=B.eventTarget(self,arguments[0]);if(!B.contains(C.domNode,D,true,document.body)){C.save();}};}B.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){B.detachEvent(document.body,"mousedown",this._save_handler);}}},postBuildRendering:function(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");},destroy:function(){this.detachEventListener(this._em_sub);if(this._super){this._super();}},save:function(){this.set("text",this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},cancel:function(){this.set("editMode",false);if(this.onCancel){this.onCancel();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,G=mstrmojo.array;function F(H,J){var I={searchMetadata:{taskId:"searchMetadata",styleName:this.searchStyleName,rootFolderID:this.rootID,searchPattern:this.searchPattern+"*",nameWildcards:(this.qse?16:1),quickSearch:this.qse,sortKey:(this.qse?-1:6),blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",includeObjectDesc:this.includeObjectDesc,searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseFolder:{taskId:"searchMetadata",rootFolderID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,recursive:this.hierarchical?0:(this.searchXML?"":1),folderBrowserStyle:this.hierarchical?1:0,includeAncestorInfo:String(!!this.hierarchical),searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseElements:{taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,filterXML:this.filterXML||"",searchPattern:this.searchPattern||"",matchCase:!!this.matchCase,dataSourcesXML:this.dataSourcesXML||"",includeFormNames:!!this.collectForms,includeFormValues:!!this.bIncludeFormValues,displayedForms:this.displayedForms||1,dimensionID:this.dimensionId||""}}[H]||{};if(typeof J==="object"){mstrmojo.hash.copy(J,I);}return I;}var B="##searchPattern";mstrmojo.SearchBox2=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchBox2",taskId:"searchMetadata",rootID:null,searchStyleName:"MojoFolderStyle",objectTypes:"3,14,256,257,1024,1027,2048,3072,10",token:{searchMetadata:/\//,browseElements:/(^-)|(,)|( OR )|( AND)|([<>]=?)|(&)|( )|(["\[\]\/])/},blockCount:50,blockBegin:1,minSearchLength:2,matchCase:false,enableMatchCase:true,supportIncFetch:true,quickSearch:false,searchAfterSearchPatternRestored:false,includeObjectDesc:true,forceResetCache:false,onUpdateSearchParams:mstrmojo.emptyFn,markupString:'<table id={@id} cellspacing=0 cellpadding=0 class="mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" mstrAttach:keyup,blur /></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}sbSearch" mstrAttach:click ></div></div></td><td><div class="mstrmojo-SearchBox-options" style="{@cssTextShowMC}"><input id="{@id}sbMatchCase" type="checkbox" mstrAttach:click /><label for="{@id}sbMatchCase">'+mstrmojo.desc(4326,"Case Sensitive")+"</label></div></td></tr></table>",markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},searchNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},optionNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},preBuildRendering:function(){this.cssTextShowMC=this.enableMatchCase?"":"display: none";},postBuildRendering:function(){if(this._super){this._super();}this.matchCase=this.optionNode.checked;},onkeyup:function E(H){var J=this;var I=J.searchTimer;if(I){window.clearTimeout(I);}J.searchTimer=window.setTimeout(function(){J.onkeyupDelayed(H);delete J._searchTimer;},parseInt(H.e.keyCode||H.e.charCode,10)===13?0:J.searchDelay);},onkeyupDelayed:function A(I){var H=I.hWin,K=I.e||H.event;var J=mstrmojo.string.trim(this.inputNode.value);if(this.searchNode){C.toggleClass(this.searchNode,["clear"],J.length>0);}this.showTaskError=false;this.click2Search=false;if(J.length==0||this.autoSubmit||this.onEnter&&K.keyCode===13){this._onsearch();}},onEnter:function(){this._onsearch();},onclick:function(I){var H=I.hWin,K=I.e||H.event,M=K.target||K.srcElement,L=M&&M.id;switch(L.replace(this.id,"")){case"sbDown":if(this.enableMatchCase){var J=this.optionNode.parentNode.style;J.display=J.display=="block"?"none":"block";}break;case"sbSearch":if(this.inputNode.value.length>0){this.clearSearch();}break;case"sbMatchCase":this.set("matchCase",this.optionNode.checked);break;case"sbSpinner":break;}},clearSearch:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);var I=this.searchCache,H=this.rootID;if(I&&I[H]){I[H][B]="";}this._onsearch(true);},onmatchCaseChange:function(){this.matchCaseChanged=true;this._onsearch();},onrootIDChange:function(){this.rootChanged=true;this._setupCache(this.forceResetCache);var I=this.searchCache[this.rootID];if(I){var H=I[B]||"";this.inputNode.value=H;if(H.length>0){if(H.length>=this.minSearchLength&&this.searchAfterSearchPatternRestored){this._onsearch();}}}},getRootID:function(){},contentWidget:null,_notifyContentWidget:function(I){var H=this.contentWidget||this;H.set("items",I[0]);if(this.supportIncFetch){var J=I[1],L=I[2],K=this.blockCount;H.set("ifs",{np:Math.floor(J/K)+((J%K>0)?1:0),cp:Math.floor(L/K)+((L%K>0)?1:0)});}},_onsearch:function(H){this.getRootID();this._setupCache();var K=mstrmojo.string.trim(this.inputNode.value);if(K.length===0){H=true;}var L=this.token[this.taskId];if(L.test(K)){}if(this.searchPattern==K&&!this.rootChanged&&!this.matchCaseChanged&&!this.click2Search){return ;}var M=this.rootID,J=this.searchCache[M];if((K.length<this.minSearchLength&&!this.click2Search)&&!H){if(this.searchPattern&&this.searchPattern.length>=this.minSearchLength){this._notifyContentWidget(J[M]);this.searchPattern=K;}}else{this.searchPattern=K;J[B]=this.searchPattern;var I=this.filterCache(K,J,H);if((this.click2Search||I===null)&&!H){this.blockBegin=1;this.fetch();return ;}else{this._notifyContentWidget(I);}}J[B]=K;},_setupCache:function(J){var K=this.searchCache,I=this.rootID;if(K&&(J||!K[I])){K[I]=K[I]||{};var H=this.contentWidget&&this.contentWidget.items||this.rootCacheItems||[];K[I][I]=[H,this.totalSize||0,this.blockBegin||1].concat();}},taskCallId:0,path:mstrConfig.taskURL,method:"POST",serverRequest:function D(H,I){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(H,I);}else{mstrmojo.xhr.request("POST",this.path,I,H,undefined,this.XServer,this.baseParams);}},fetch:function(){this.rootChanged=false;this.matchCaseChanged=false;if(this.spinnerNode){this.spinnerNode.style.display="block";}if(this.preFetch){this.preFetch();}var H=this,I=F.apply(this,[this.taskId]);I.searchPattern=this.searchPattern;this.onUpdateSearchParams(I);var J={success:function(K){var L=K.items||K.es||[];L=[L,K.totalSize||K.sz||0,K.blockBegin||K.bb];mstrmojo.all[H.id].searchCache[H.rootID][(I.searchPattern.length==0?H.rootID:H.buildIndex(I.searchPattern))]=L;H._notifyContentWidget(L);},failure:function(K){if(H.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+K.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){if(H.spinnerNode){H.spinnerNode.style.display="none";}if(H.postFetch){H.postFetch();}}};this.serverRequest(I,J);},fetchPage:function(H){this.blockBegin=H*this.blockCount+1;this.fetch();},filterCache:function(J,M,I){var H=M&&M[I?this.rootID:this.buildIndex(J)];if(H){return H;}var K=this.token[this.taskId];if(K.test(J)||this.totalSize>this.blockCount){return null;}var O=J.replace(/.$/,"");H=M&&M[this.buildIndex(O)];while(H===undefined&&(O=O.replace(/.$/,"")).length>0){H=M&&M[this.buildIndex(O)];}if(H!==undefined){if(H[1]>this.blockCount){return null;}var L=H[0],N=[];G.forEach(L,function(P){if(P.n.search(new RegExp(J,this.matchCase?"":"i"))>-1){N.push(P);}});this.totalSize=N.length;return(M[this.buildIndex(J)]=[N,N.length,this.blockBegin].concat());}return null;},buildIndex:function(H){if(H.replace(/^\s|\s$/g,"").length===0){return"";}return !this.matchCase?H.toUpperCase():H+"::0";},init:function(H){if(this._super){this._super(H);}this.qse=mstrApp.useQuickSearch&&mstrApp.useQuickSearch()||0;this.autoSubmit=this.quickSearch&&(mstrApp.searchAutoComplete&&mstrApp.searchAutoComplete()||false);this.searchDelay=mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay()||0;this.xhr=new mstrmojo.SimpleXHR();this.searchCache=this.searchCache||{};},clear:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css","mstrmojo.string");function C(H,D,E){var K=[];var G=H.optionRenderer,I=G&&G.render;if(I&&typeof I==="function"){var L=H.options,J=Math.min(E,((L&&L.length)||0)),F;for(F=D;F<J;F++){K.push(I(L[F],F,H));}}return K.join("");}mstrmojo.DropDownList=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.DropDownList",title:"",selectCssClass:"",tooltip:"",cssDisplay:"inline",value:"",unset:false,options:null,optionValueField:"v",optionNameField:"n",idx:-1,renderedOptions:"",markupString:'<span id="{@id}"  class="mstrmojo-DropDownList {@cssClass}">{@en@title}<select id="{@id}_select" class="mstrmojo-DropDownList-select {@selectCssClass}"  style="{@cssText}" title="{@tooltip}"onchange="mstrmojo.all[\'{@id}\'].set(\'selected\', this.options[this.selectedIndex].value);">{@renderedOptions}</select><div class = "strikeoutContainer"></div></span>',markupSlots:{selectNode:function(){return this.domNode.getElementsByTagName("select")[0];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onidxChange:function(){var D=this.domNode.getElementsByTagName("select");if(D&&D.length){D[0].selectedIndex=this.idx;}},onvalueChange:function(){var I=this.selectNode,G=I.options,F=this.value,E,H;for(H=0;H<G.length;H++){var D=G[H].value.toString()===F;if(D){E=H;if(F!==""){mstrmojo.css.toggleClass(G[H],"selected",D);}break;}}if(I.length>0&&E>0&&this.unset){if(this.options[0].v==="-1"){I.remove(0);E--;}this.unset=false;}this.set("idx",E);},onwidthChange:function(){var D=this.width;if(D>=0){this.selectNode.style.width=D+"px";}}},_set_selected:function(G,D){var E=this.selectNode,F=this[G]!==D;this[G]=D;if(E){this.set("value",D);}return F;},preBuildRendering:function A(){var F=this;if(F.unset){F.idx=0;}var E=F.options,D=(E&&E.length)||0;if(D){F.renderedOptions=C(F,0,D);}return this._super();},optionRenderer:{render:function(E,D,F){return mstrmojo.string.apply(F.getOptionMarkup(E),F.getOptionProps(E,D));}},getOptionMarkup:function(D){return'<option value="{@en@v}" class="{@cls}" style="{@style}" {@sel}>{@en@n}</option>';},getOptionProps:function B(F,D){var G=this,H=F[G.optionValueField],E=D===parseInt(G.idx,10);G.selected=G.value=E?H.toString():G.value;return{cls:E?"selected":"",v:H===undefined?"":H,n:F[G.optionNameField]||"",style:"",sel:E?"selected":""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.WaitIcon=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.WaitIcon",cssFloat:"left",visible:false,markupString:'<div id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="float:{@cssFloat};{@cssText};"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(8126);var Y=mstrmojo.dom,S=mstrmojo.hash,a=mstrmojo.array,X,O=mstrmojo.qb.EnumJoinTypes,Q=mstrmojo.qb.EnumDataChangeEvents,b,W=1500,H=900;function C(){var d=document.createElement("v:rect"),c=d.style;d.setAttribute("id","vmlFrame");d.setAttribute("stroke","true");d.setAttribute("strokecolor","red");c.width=this.width;c.height=this.height;c.zindex="-1";document.getElementById("vmlCanvas").appendChild(d);}function B(){var f=parseInt(this.width,10),d=parseInt(this.height,10),e=document.createElement("v:group"),c=e.style;e.setAttribute("id","vmlCanvas");e.setAttribute("coordorigin","0, 0");e.setAttribute("coordsize",f+", "+d);c.width=this.width;c.height=this.height;this.domNode.appendChild(e);C.call(this);}function A(){this.highlight.clearRect(0,0,W,H);this.hl_link=null;this.highlight.beginPath();}function K(){if(b){var d=this.context;d.clearRect(0,0,W,H);d.beginPath();}else{var c=document.getElementById("vmlCanvas");if(c&&c.hasChildNodes()){while(c.childNodes.length>=1){c.removeChild(c.firstChild);}C.call(this);}}A.call(this);}function P(f){if(b){if(this.hl_link&&this.hl_link!==f){A.call(this);}var d=this.linksInfo[f].marker,e=this.highlight,c=Math.PI*2;this.hl_link=f;e.strokeStyle="blue";a.forEach(d,function(g){e.beginPath();e.arc(g.x,g.y,3,0,c,true);e.closePath();e.stroke();});}}function M(e,h,d,g){if(b){var f=this.context=this.context||this.canvas.getContext("2d");f.moveTo(e,h);f.lineTo(d,g);}else{var c=document.createElement("v:line");c.setAttribute("from",[e," ",h].join(""));c.setAttribute("to",[d," ",g].join(""));document.getElementById("vmlCanvas").appendChild(c);}}function F(e,n,m){var j=e.length,c,q,p,o,f,l,d,k,h,g=false;if(j/2<3){return false;}p=e[j-2];o=e[j-1];for(h=0;h<j;h=h+2){c=e[h];q=e[h+1];if(c>p){f=p;d=c;l=o;k=q;}else{f=c;d=p;l=q;k=o;}if((c<n)===(n<=p)&&((m-l)*(d-f)<(k-l)*(n-f))){g=!g;}p=c;o=q;}return g;}function L(c,e){var d=null;S.forEach(this.linksInfo,function(g,f){if(F(g.coords,c,e)){d=f;return false;}return true;},this);return d;}mstrmojo.qb.DBTableLinker=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.qb.DBTableLinker",markupString:'<div id="{@id}" class="mstrmojo-DBTableLinker" mstrAttach:click><canvas height="'+H+'" width="'+W+'"></canvas><canvas height="'+H+'" width="'+W+'"></canvas></div>',markupMethods:{onvisibleChange:function N(){this.domNode.style.display=(this.visible)?"block":"none";},onheightChange:function I(){this.domNode.style.height=this.height||"";},onwidthChange:function J(){this.domNode.style.width=this.width||"";}},markupSlots:{canvas:function D(){return this.domNode.firstChild;},highlightCanvas:function R(){return this.domNode.childNodes[1];}},init:function V(c){this._super(c);this.linksInfo={};var d={},e=d[this.id]={};},postBuildRendering:function Z(){this._super();var c=this.canvas;if(b===undefined){b=c&&c.getContext&&c.getContext("2d");}if(b){this.context=c.getContext("2d");this.highlight=this.highlightCanvas.getContext("2d");}else{if(Y.isIE8){B.call(this);}else{this.renderErrorMessage(mstrmojo.desc(8126));}}},handleClick:function G(d){var j=Y.position(this.domNode),c=d.clientX,h=d.clientY,f=L.call(this,c-j.x,h-j.y);if(f){P.call(this,f);var e=this.linksInfo[f];X.showPopupMenu(this,{data:S.copy({columnIndex:e.columnIndex,isChecked:function g(l,k){return(l.type===k.type);}},e.joinObj),pos:{x:c+2,y:h+2}});}else{A.call(this);}},drawLinks:function E(p){K.call(this);var z=this.joins=p?p.joins:this.joins,k=Y.position(this.domNode),c=8;var AC=this,w,d,g,AE,AA,e,t,q,n,m,u,o,f,AD,h,j=0,l=this.parent.tableContainer.children,x=function x(AG,AH){var AF=null;a.forEach(AG,function(AI){if(AI.tableData.id===AH){AF=AI;return false;}});return AF;},AB=AC.linksInfo={};a.forEach(z,function(AF){w=x(l,AF.sourceTable);d=x(l,AF.targetTable);f=AF.type;if(w&&d){a.forEach(AF.links,function(AH,AG){g=w.rows.getRowNode("did",AH.source.did);AE=d.rows.getRowNode("did",AH.target.did);AA=Y.position(g);e=Y.position(AE);t=AA.x+g.clientWidth-k.x;q=AA.y+0.5*g.clientHeight-k.y;n=e.x-k.x;m=e.y+0.5*AE.clientHeight-k.y;u=t<n;o=u?c:-c;t-=u?0:AA.w;n+=u?0:e.w;AB[j++]={joinObj:AF,columnIndex:AG,coords:[t+c,q+c,t+c,q-c,n-c,m-c,n-c,m+c],marker:[{x:t,y:q},{x:t+c,y:q},{x:n-c,y:m},{x:n,y:m}]};M.call(AC,t,q,t+o,q);M.call(AC,t+o,q,n-o,m);M.call(AC,n-o,m,n,m);AD=f===O.OUTER||f===O.RIGHT;h=f===O.OUTER||f===O.LEFT;o=o/2;if(AD){M.call(AC,t,q,t+o,q+o);M.call(AC,t,q,t+o,q-o);}if(h){M.call(AC,n-o,m-o,n,m);M.call(AC,n-o,m+o,n,m);}});}});if(b){this.context.stroke();}}});X=mstrmojo.qb.DBTableLinker;X.showPopupMenu=function U(c,d){var e=X.linkMenu;if(!e){e=X.linkMenu=mstrmojo.insert({scriptClass:"mstrmojo.qb.JoinMenu",zIndex:45});}e.set("cmPos",d.pos);e.target=c;e.data=d.data;e.domNode=c.domNode;e.showContextMenu();};}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Arr","mstrmojo._HasLayout","mstrmojo._ListBase2Selections","mstrmojo.ListSelector","mstrmojo._TouchScrolling","mstrmojo._PagingList");var b=mstrmojo.hash,g=mstrmojo.array,f=mstrmojo.boxmodel,d=mstrmojo.dom;function A(k,m,j){var l=k.listSelector;if(l){l[m](k,k.itemsContainerNode,j);}}function L(k,j){var l=k.lastPagePos;if(!l||l.dragId!==j){l=f.offset(k.itemsContainerNode);l.dragId=j;k.lastPagePos=l;var m=k.scrollboxNode;k.lastScrollPos={left:m.scrollLeft,top:m.scrollTop,width:m.clientWidth,height:m.clientHeight};}}function O(m,p,k){var l=p&&p.node;if(l===m.dropCueNode||l===m.dropCueNode.firstChild){return m.dropCuePos;}var n=m.listMapper;var j=n&&n.whereDrop(m,m.itemsContainerNode,l,p.pos,{left:m.lastPagePos.left-m.lastScrollPos.left,top:m.lastPagePos.top-m.lastScrollPos.top,width:m.lastScrollPos.width,height:m.lastScrollPos.height});var o=m.dropCuePos;return((k!==false)&&o&&j&&(o.idx===j.idx)&&(o.left===j.left)&&(o.top===j.top))?o:j;}var h="attachEventListener";function D(k,j){if(k.makeObservable){j=j||[];if(!j[h]){mstrmojo.hash.make(j,k.itemsScriptClass||mstrmojo.Arr);}}return j;}function H(k,j){if(j&&j[h]){k._sub_its=j;k._sub_add=j[h]("add",k.id,"preadd");k._sub_rmv=j[h]("remove",k.id,"preremove");}}function G(j){if(j._sub_its){var k=mstrmojo.publisher;k.unsubscribe(j._sub_add);k.unsubscribe(j._sub_rmv);delete j._sub_add;delete j._sub_rmv;delete j._sub_its;}}mstrmojo.ListBase2=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListBase2Selections,mstrmojo._TouchScrolling,mstrmojo._PagingList,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ListBase2",items:null,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode;},itemsContainerNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},ondropCuePosChange:function(){var k=this.dropCueNode,j=k&&k.style;if(!j){return ;}var m=this.dropCuePos,l=!!m;if(l){j.left=m.left+"px";j.top=m.top+"px";}j.display=l?"block":"none";},onpageChange:function(){if(this.usePaging&&!this._inScroll){this._inPaging=true;this.listMapper.toPage(this,this.page);this._inPaging=false;}},onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}}},autoHide:false,renderOnScroll:false,firstRenderBlockSize:50,renderBlockSize:50,listMapper:null,listBuilder:null,listSelector:mstrmojo.ListSelector,animate:false,itemsEffect:null,containerResizable:true,init:function a(m){this._super(m);this.items=this.initItems(this.items);var l=this.selectedIndices,j=this.selectedIndicesList,k=this.selectedIndex,n=this.selectedItem;this.selectedIndices={};this.selectedIndex=-1;delete this.selectedIndicesList;delete this.selectedItem;if(l||j||(k>-1)||n){this.initSelections(l,j,k,n);}if(this.postInitItems){this.postInitItems();}},initItems:function I(j){return D(this,j);},preBuildRendering:function X(){var n=this.listBuilder,q=n.newContext(this);this.ctxtBuilder=q;var k=this.markupSlots,m=!!(this.renderOnScroll&&this.renderBlockSize&&k&&k.scrollboxNode),l=this.items,j=(l&&l.length)||0,o=m?this.firstRenderBlockSize:j,p=m?this.firstRenderBlockSize:0;this._eros=m;this.paused=false;this.itemsHtml=this.listMapper.buildItemWrappers(l,n,this,q,o,p).join("");this.itemsContainerCssText="visibility: hidden";if(this._super){this._super();}},postBuildRendering:function E(){delete this.itemsHtml;var o=this.listMapper;if(o&&o.postBuildRendering){o.postBuildRendering(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder);}H(this,this.items);if(this._eros||this.usePaging){if(!this._cb_scroll){var q=this.id;this._cb_scroll=function(){var n=mstrmojo.all[q];n.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);this.onscroll();}if(this.animate){for(var l=0,k=["itemsEffect","scrollEffect"],j=k.length;l<j;l++){var p=k[l],m=this[p];if(m&&m.constructor===Object){m=mstrmojo.insert(mstrmojo.hash.clone(m));m.widget=this;this[p]=m;}}if(this.itemsEffect){this.itemsEffect.play();}}this.itemsContainerNode.style.visibility="inherit";if(this.containerResizable&&this.itemsContainerNode.scrollWidth<this.domNode.scrollWidth){this.itemsContainerNode.style.width=this.domNode.scrollWidth+"px";}if(this._super){this._super();}},unrender:function Y(m){G(this);if(this._eros){mstrmojo.dom.detachEvent(this.scrollboxNode,"scroll",this._cb_scroll);delete this._cb_scroll;}for(var k=0,l=["itemsEffect","scrollEffect"],j=l.length;k<j;k++){var n=this[l[k]];if(n&&n.isPlaying){n.cancel();}}this._super(m);},pauseScrollRendering:function P(l,j,k){if(l!==false){l=true;}if(this.paused===!!l){return ;}this.paused=!!l;if(l){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}}else{this.fill(j,k);}},onscroll:function K(){if(this.paused){return ;}if(this._eros){if(!this._fillTmr){var j=this;this._fillTmr=self.setTimeout(function(){j.fill();j=null;},50);}}if(this._super){this._super();}},fill:function c(j,n){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}var o=(this.items&&this.items.length)||0;if(!o){if(n){n();}}else{var l=this.scrollboxNode,p=this.itemsContainerNode,m=mstrmojo.boxmodel.offset(p,l),t=this.listMapper,q=t.findScrollRange(p,o,(this.usesTouches&&this.pos&&parseInt(this.pos.y,10))||l.scrollTop,l.clientHeight,(this.usesTouches&&this.pos&&parseInt(this.pos.x,10))||l.scrollLeft,l.clientWidth,m.left,m.top);if(this.fillAt(q.start,q.end)){if(j){j();}var k=this.id;this._fillTmr=window.setTimeout(function(){mstrmojo.all[k].fill(j,n);},100);}else{if(n){n();}}}},fillAt:function M(l,k){var j=this.listMapper;if(j){return j.fillItemWrappers(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder,l,k,this.renderBlockSize);}else{return false;}},add:function R(k,j){if(!k||!k.length){return -1;}var l=this.items;if(j==null){j=b.min(this.selectedIndices,false,true);if(j!==null&&j!==undefined){j++;}}if(j==null||j===-1){j=(l&&l.length)||0;}if(l&&l.add){l.add(k,j);}else{this.set("items",l?g.insert(l.concat(),j,k):k);}return j;},preadd:function B(l){if(this.hasRendered){var o=this.listMapper;if(o){o.onadd(this,this.itemsContainerNode,this.ctxtBuilder,l);}var n=this.listBuilder;if(n){n.onadd(this,this.ctxtBuilder,l);}var k=this.listSelector;if(k){k.onadd(this,l);}if(this._eros){this.onscroll();}else{var m=l.index,j=l.value.length;this.fillAt(m,m+j-1);}}if(this.onadd){this.onadd(l);}if(this._super){this._super(l);}},remove:function V(j){if(j==null){return -1;}if(j.constructor!==Array){return this._remove(j);}var l=this.items;if(l){var k;if(l.remove){for(k=j.length-1;k>-1;k--){l.remove(j[k],1);}}else{l=l.concat();for(k=j.length-1;k>-1;k--){l.splice(j[k],1);}this.set("items",l);}return j[0];}return -1;},_remove:function V(l){var k=this.items;if(!k||(l==null)){return -1;}var j;if(!isNaN(l)){j=l;}else{j=this.itemIndex(l);}if(j>-1){if(k.remove){k.remove(j,1);}else{k=k.concat();k.splice(j,1);this.set("items",k);}}return j;},duplicate:function Z(o,k,l){var m=this.items,j=-1;if(!m||(o==null)){return -1;}if(!isNaN(o)){if(k===null||k===undefined){k=o+1;}o=m[o];}else{if(k===null||k===undefined){k=this.itemIndex(o)+1;}}if(o){var n;n=b.copy(l,b.clone(o));j=this.add([n],k);}return j;},preremove:function N(k){if(this.hasRendered){var m=this.listMapper;if(m){m.onremove(this,this.itemsContainerNode,this.ctxtBuilder,k);}var l=this.listBuilder;if(l){l.onremove(this,this.ctxtBuilder,k);}var j=this.listSelector;if(j){j.onremove(this,k);}if(this._eros){this.onscroll();}}if(this.onremove){this.onremove(k);}if(this._super){this._super(k);}},move:function S(m,t){function p(w,u){return t>=w&&t<=w+u;}var q=(this.items&&this.items.length)||0;if(t===-1||t==null||isNaN(t)){t=q;}else{t=Math.min(t,q);}var l,j,o,n;if(m.constructor===Array){j=m;o=m;n=(j&&j.length)||0;if(p(m[0],m.length)){return false;}l=g.get(this.items,m);}else{if(typeof (m)==="object"){l=[m];n=1;j=this.itemIndex(l[0]);o=[j];if(p(j,1)){return false;}}else{j=m;o=[m];n=1;if(p(j,1)){return false;}l=[this.items[j]];}}for(var k=0;k<n;k++){if(o[k]<=t){t--;}}if(l[0]!=null){this.remove(j);this.add(l,t);}return true;},itemIndex:function F(j){if(j==null){return -1;}var k=this.itemIdField;return k?g.find(this.items,k,j[k]):g.indexOf(this.items,j);},prechange:function U(l){if(this.hasRendered){var k=[this.listBuilder,this.listMapper];for(var m=0,j=k.length;m<j;m++){var n=k[m];if(n&&n.onchange){n.onchange(this,this.itemsContainerNode,this.ctxtBuilder,l);}}}},makeObservable:false,_set_items:function J(p,j){var o=this.items;j=this.initItems(j);this.items=j;if(o!==j){var m=this,l=function(){if(m.autoHide){m.set("visible",!!(j&&j.length));}m=null;},k=this.hasRendered;if(k){this.refresh(l);}else{l();}}return o!==j;},premousedown:function e(j){A(this,"premousedown",j);},premouseup:function Q(j){A(this,"premouseup",j);},scrollTo:function W(k){var j,l=this.listMapper;if(l&&l.toItem){if(!isNaN(k)){j=k;}else{j=this.itemIndex(k);}if(j>=0){l.toItem(this,j);}}},draggable:false,getDragData:function(n){L(this,n.id);var l=O(this,n.src),k=l&&l.idxActual;if((k>-1)&&this.selectedIndices[k]){var m=this.sortSelectedIndices(),j=g.get(this.items,m)||[];switch(j.length){case 1:return b.copy({html:j[0][this.itemDisplayField],index:m[0]},b.copy(j[0]));case 0:return null;default:return b.copy({html:j.length+" selections",indices:m},j);}}},dropZone:false,ondragenter:function(j){L(this,j.id);this.set("dropCuePos",O(this,j.tgt));},ondragover:function(j){this.set("dropCuePos",O(this,j.tgt));},ondragleave:function(j){this.set("dropCuePos",null);},isDragValid:function C(j){return j&&j.src&&j.src.data;},ondragstart:function(j){if(!(j&&j.src&&j.src.data)){return false;}},allowCopy:false,ondragend:function(m){var k=m&&m.tgt,j=k&&k.widget;if(j===this){}else{if(this.tree&&j&&j.tree===this.tree){if(!this.allowCopy||!d.ctrlKey(k.hWin,k.e)){var l=m.src&&m.src.data;if(l&&(l.indices||(l.index!==null))){this.remove(l.indices||l.index);}}}}},ondrop:function(t){var x=t&&t.src,q=x&&x.data;if(q){var l=O(this,t.tgt,false),u=l&&l.idx,m=(q&&q.constructor===Array),k=this.sortSelectedIndices();var o=this.items;u=Math.min(u,o&&o.length)||0;var w=true;if(x.widget===this){w=this.move(k,u);g.forEach(k,function(z){if(z<=u){u--;}});}else{this.add(m?q:[q],u);}if(w){var p=m?q.length:1,j={};for(var n=0;n<p;n++){j[u+n]=true;}this.set("selectedIndices",j);}}this.set("dropCuePos",null);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var C=mstrmojo.dom,B=mstrmojo.hash,E=mstrmojo.css;mstrmojo.Button=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Button",iconClass:"",innerIconClass:"",title:"",text:"&nbsp;",enabled:true,selected:false,markupString:'<div id="{@id}" class="mstrmojo-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-Button-text {@innerIconClass}"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){E.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){E.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;},onwidthChange:mstrmojo.Widget.widthMarkupMethod},oniconClassChange:function D(J){var K=this.domNode;if(this.hasRendered&&K){K.className=K.className.replace(J.valueWas,"")+" "+J.value;}},onclick:mstrmojo.emptyFn,ontouchend:function I(J){this.onclick(J);}});mstrmojo.Button.newIconButton=function H(L,O,M,J,N){var K={scriptClass:"mstrmojo.Button",title:L,cssClass:O,text:"",onclick:M};if(J){K.bindings=J;}B.copy(N,K);return K;};function F(M,N,J,P){var L=[];if(J){L.push(J);}var O=P&&P.cssClass;if(O){L.push(O);delete P.cssClass;}var K={scriptClass:"mstrmojo.Button",cssClass:L.join(" "),text:M};if(N){K.onclick=N;}return B.copy(P,K);}mstrmojo.Button.newInteractiveButton=function G(M,N,P,O){var L={glowClass:"glow"};if(P&&(C.isFF||C.isWK)){B.copy({onmousedown:function J(){E.applyShadow(this.domNode,0,0,10,P);},onmouseup:function K(){E.removeShadow(this.domNode);}},L);}return F(M,N,"mstrmojo-InteractiveButton",B.copy(O,L));};mstrmojo.Button.newWebButton=function A(K,J,M,L){return F(K,J,"mstrmojo-WebButton"+(M?" hot":""),L);};mstrmojo.Button.newActionButton=function(K,L,M){var J=mstrmojo.Button.newWebButton(K,L,false,M);J.cssClass=J.cssClass+" action-button";return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.FileUploadBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.FileUploadBox",value:"",params:null,action:"taskProc",uploadTaskId:"uploadFile",browseLabel:"Browse...",fileFieldName:"myfile",multiple:"",status:"init",jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",enabled:true,markupString:'<div id={@id} class="mstrmojo-FileUploadBox {@cssClass}" style="{@cssText}"><form class="mstrmojo-FileUploadBox-form" target="{@id}_iframe" enctype="multipart/form-data" method="post" action="{@action}"><input class="mstrmojo-FileUploadBox-input" readonly="readonly" type="text" size="30"/><div class="mstrmojo-FileUploadBox-buttonDiv"><div class="mstrmojo-FileUploadBox-button">{@browseLabel}</div><input class="mstrmojo-FileUploadBox-file" type="file" accept="{@accept}" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synValue();"/></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},inputNode:function(){return this.domNode.firstChild.firstChild;},buttonNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},fileNode:function(){return this.domNode.firstChild.childNodes[1].lastChild;},paramsNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onenabledChange:function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);this.fileNode.style.display=this.enabled?"block":"none";},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){if(this.status==="init"){this.inputNode.value="";this.fileNode.value="";this.paramsNode.innerHTML="";}},onvalueChange:function(){this.inputNode.value=this.value;}},uploadCallback:function(B){var A=(B.status==200);this.set("status",A?"successful":"failed");if(A&&this.onSuccess){this.onSuccess(B);}if(!A&&this.onFailed){this.onFailed(B);}},synValue:function(){var B=this.fileNode.value,A=B.split(/[\/\\]/);B=A[A.length-1];this.set("value",B);},submit:function(E,C){var B=true;if(this.onsubmit){B=this.onsubmit();}if(B){E=E||{};E.fileFieldName=this.fileFieldName;E.taskEnv="jsonp2";E.taskId=this.uploadTaskId;E.jsonp=this.jsonp.replace("{@id}",this.id);var A=[],D;for(D in E){A.push('<input type="hidden" name="'+D+'" value="'+mstrmojo.string.encodeHtmlString(E[D])+'"/>');}if(this.params){E=this.params;for(D in E){A.push('<input type="hidden" name="'+D+'" value="'+mstrmojo.string.encodeHtmlString(E[D])+'"/>');}}this.paramsNode.innerHTML=A.join("");if(C){this.onSuccess=C.success;this.onFailed=C.failure;}this.formNode.submit();this.set("status","loading");}},reset:function(){this.set("status","init");}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var E=mstrmojo.Widget;mstrmojo.ui._IsPulldown=mstrmojo.provide("mstrmojo.ui._IsPulldown",{scriptClass:"mstrmojo.ui._IsPulldown",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text {@cssTextClass}" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function D(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:E.visibleMarkupMethod,onheightChange:E.heightMarkupMethod,onwidthChange:E.widthMarkupMethod,onvalueChange:function F(){this.selectedNode.innerHTML=this.value||"";},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},getPopupList:mstrmojo.emptyFn,anchorSlot:"selectedNode",postBuildRendering:function B(){this._super();this.getPopupList().set("items",this.items);var G=this.selectedIndex,H=this.selectedIndices;if(G!==undefined){this.set("selectedIndex",G);}if(H!==undefined){this.set("selectedIndices",mstrmojo.hash.copy(H||{}));}},onitemsChange:function C(){var G=this.getPopupList();if(G){G.set("items",this.items);}},onPopupWidgetOpened:function(){var G=this.getPopupList();if(G&&(!G.items||G.items.length===0)){G.close();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var B="mstrmojo-Image";mstrmojo.Image=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Image",markupString:'<div id="{@id}" class="'+B+' {@cssClass}" style="{@cssText}" mstrAttach:click><image class="{@imgCssClass}" src="{@src}" mstrAttach:load /></div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onsrcChange:function(){var C=this.imgNode;if(C){C.src=this.src||"../javascript/mojo/css/images/1ptrans.gif";}},oncssClassChange:function(){var C=this.domNode;if(C){C.className=this.cssClass||B;}},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},src:"",getImageSize:function A(){var C=this.imgNode;return{w:C.clientWidth,h:C.clientHeight};}});mstrmojo.Image.baseCssClass=B;}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.array","mstrmojo._HasChildren");var G=mstrmojo.array;function E(P){if(!this.shouldPropagateEnabled){return ;}var O=this._disabledChildren;G.forEach(P,function(Q){if(Q.enabled){O.push(Q.id);Q.set("enabled",false);}});}function J(){G.forEach(this._disabledChildren,function(O){var P=mstrmojo.all[O];if(P&&P.parent===this){P.set("enabled",true);}},this);this._disabledChildren=[];}mstrmojo.Container=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.Container",defaultChildSlot:"containerNode",containerNode:null,preserveChildDomOrder:true,shouldPropagateEnabled:false,init:function M(P){this._super(P);this._disabledChildren=[];this.attachEventListener("addChild",this.id,function(Q){if(this.shouldPropagateEnabled&&!this.enabled){E.call(this,Q.value);}});if(this.children){this.initChildren();}var O=this.parent;if(!O||O.hasInitBindings){this.initBindings();}},destroy:function H(O){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(O);},unrender:function I(Q){var R=this.children,O=(R&&R.length)||0,P;for(P=O-1;P>-1;P--){R[P].unrender(true);}this._super(Q);},postBuildRendering:function A(){if(this._super()!==false){this.renderChildren();return true;}return false;},renderChildren:function L(){var Q=this.children,O=(Q&&Q.length)||0,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}}},childRenderCheck:function D(P){if(P&&!P.hasRendered){var O=P.slot||this.defaultChildSlot;return !!this[O];}return false;},addChildren:function N(R,P,Q){var O=this._super(R,P,Q);if(O){this.childRenderOnAddCheck(O);}return O;},removeChildren:function F(W,R){var V=W?[W]:(this.children||[]),O=V.length,S;for(S=O-1;S>-1;S--){var Q=V[S],P=Q&&Q.domNode;if(P){var U=this[(Q.slot||this.defaultChildSlot)];if(P.parentNode===U){U.removeChild(P);}}}return this._super(W,R);},childRenderOnAddCheck:function B(Q){if(this.hasRendered&&Q){var O=Q.length,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}else{if(R&&R.hasRendered){this.onchildRenderingChange(R);}}}}},onchildRenderingChange:function K(O){var X=O&&O.domNode;if(!X){return ;}var P=this.defaultChildSlot,W=O.slot||P,Z=this[W],Q=this.children;if(!Z){if(X.parentNode){X.parentNode.removeChild(X);}}else{if(X.parentNode===Z){return ;}if(!this.preserveChildDomOrder){Z.appendChild(X);}else{var R,V;for(V=Q.length-1;V>=0;V--){var Y=Q[V];if(Y===O){break;}if(W===(Y.slot||P)){var a=Y.domNode;if(a&&a.parentNode===Z){R=a;}}}if(R){Z.insertBefore(X,R);}else{Z.appendChild(X);}}}if(mstrmojo.publisher.hasSubs(this.id,"childrenRendered")){var S=Q.length,U;for(U=0;U<S;U++){if(!Q[U].domNode){return ;}}this.raiseEvent({name:"childrenRendered"});}},propagateChildProps:function C(S){var R=this[S],Q=this.children||[],O=Q.length,P;for(P=0;P<O;P++){Q[P].set(S,R);}}});mstrmojo.Container.enabledMarkupMethod=function(){mstrmojo.Widget.enabledMarkupMethod.apply(this,arguments);if(this.shouldPropagateEnabled){if(this.enabled){J.call(this);}else{E.call(this,this.children);}}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.Widget","mstrmojo._ListSelections");var E=mstrmojo.dom;mstrmojo.ListBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBase",selectionPolicy:null,itemRenderer:null,icnCssText:"",icnCss:"",markupString:'<div id="{@id}" tstid="{@tstid}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',markupSlots:{itemsContainerNode:function G(){return this.domNode.firstChild;},scrollboxNode:function A(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},autoHide:false,itemsContainerNode:null,_markupPrefix:null,_markupSuffix:null,_itemPrefix:null,_itemSuffix:null,init:function J(K){this._super(K);if(this.autoHide){this.visible=!!(this.items&&this.items.length);}},buildRendering:function D(){this.itemsHtml="";var K=(this.renderOnScroll?this.items&&((this.renderIndex+1)*this.renderBlockSize):this.items&&this.items.length);if(K){this.itemsHtml=this._buildItemsMarkup(0,K-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}this._super();delete this.itemsHtml;this.addSlots({itemsNode:this.itemsContainerNode.firstChild});},_buildItemsMarkup:function B(K,N,V,L,W,M){var X=[],Q=0;X[Q++]=V||"";var P=this.itemRenderer,U=P&&P.render;if(U&&typeof U==="function"){var R=this.items,S=Math.min(N+1,((R&&R.length)||0)),O;for(O=K;O<S;O++){X[Q++]=W||"";X[Q++]=U(R[O],O,this);X[Q++]=M||"";}}X[Q+1]=L||"";return X;},onselectionChange:function H(X){if(!X){return ;}var S=this.itemRenderer;if(!S){return ;}var V=this.items;if(X.added&&X.added.length>0&&V.length>0&&!mstrmojo.array.some(X.added,function(a){return !V[a]||!V[a].dsbld;})){return ;}var O=S.unselect,R=this.items||[],Y=X.removed,N,M,L,P,Z;if(O&&Y){for(P=0,Z=Y.length;P<Z;P++){N=Y[P];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){O(L,R[N],M,this);}}}var K=S.select,W=X.added,Q,U;if(K&&W){for(Q=0,U=W.length;Q<U;Q++){N=W[Q];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){K(L,R[N],M,this);}}}if(this.onchange){this.onchange({added:X.added,removed:X.removed});}},_set_items:function C(N,K){this.renderIndex=0;if(this.autoHide){this.set("visible",!!(K&&K.length));}var M=this.items;this.items=K;if(M!==K){var L=this.hasRendered;if(L){this.unrender(false);}this.clearSelect();if(L){this.render();}return true;}return false;},onItemContextMenu:mstrmojo.emptyFn,oncontextmenu:function F(K){E.preventDefault(window,K.e);var M=K.getTarget(),L=this.getItemFromTarget&&this.getItemFromTarget(M);if(L){if(this.onItemContextMenu(L,K)){K.cancel();}}},_getItemNode:function I(K){var L=this.itemsContainerNode;return(L&&L.childNodes[K])||null;},renderOnScroll:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.ProgressBar=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ProgressBar",markupString:'<div id="{@id}" class="mstrmojo-ProgressBar {@cssClass}" style="{@cssText}"><div class="bar"><div class="indicator" style="width: 0"></div></div><div class="text">{@progressText}</div></div>',markupSlots:{barNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onprogressTextChange:function(){this.textNode.innerHTML=this.progressText||"";}},progressText:"",updateProgress:function A(C,B){if(this.hasRendered){this.barNode.firstChild.style.width=Math.min(100,Math.max(0,parseInt(C,10)))+"%";if(B!==undefined){this.set("progressText",B);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo.string","mstrmojo.dom");var C=mstrmojo.css,A=mstrmojo.dom,F=mstrmojo.string,E=function(H){this._super&&this._super(H);A.stopPropogation(H.hWin,H.e);},G=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.DynamicNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.fe.DynamicNode",markupString:'<div id="{@id}" class="mstrmojo-dynamic {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-dynamic-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-dynamic-prefix-text"  mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">'+G+'<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-onhoverparent mstrmojo-dynamicNode" title="'+mstrmojo.desc(13229,"Add this condition to the target list of a selector.")+'"><span class="mstrmojo-dynamicNode-info"><span class="mstrmojo-textset"></span></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" ></img></span><span class="mstrmojo-textset mstrmojo-rename-text" mstrAttach:click >'+mstrmojo.desc(1388,"Rename")+"</span>"+G+"</div></div>",markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},dynamicNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.lastChild.firstChild.lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},createSetNode:function(){return this.domNode.lastChild.lastChild;},renameNode:function(){return this.domNode.lastChild.childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){C.toggleClass(this.dynamicNode,["selected"],this.selected);},onisEditingChange:function(){C.toggleClass(this.domNode,["renaming"],this.isEditing);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=this.data.ph.n;},onglowChange:function(){var H=this;C.toggleClass(H.dynamicNode,["glow"],this.glow);if(this.glow){setTimeout(function(){C.toggleClass(H.dynamicNode,["glow"],false);H.glow=false;},1000);}},onnoRelationOperatorChange:function(){C.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){C.toggleClass(this.dynamicNode,["noRelation"],this.noRelation);}},editableSlot:"textNode",editButtonSlot:"renameNode",init:function(H){var J=H.data;if(J){var I=H.tree.nameFactory;if(J.ph.n){I.setName(J.ph.n,this);}else{J.ph.n=I.getNewName(this,mstrmojo.desc(12033,"Dynamic Condition")+" ");}}this._super(H);},_set_data:function(K,H){var I=this.data,J=(I!==H);if(J){this.data=H;this.text=H.ph.n;}return J;},preclick:function D(H){var J=null,I=A.eventTarget(H.hWin,H.e);if(A.contains(this.prefixNode,I,true)){J="andor";}else{if(A.contains(this.createSetOptNode,I,true)&&!this.noRelationOperator&&!this.noRelation){J="createSetOpt";}else{if(A.contains(this.createSetNode,I,true)&&!this.noRelation){J="createSet";}else{if(A.contains(this.renameNode,I,true)){this.set("isEditing",true);}}}}H.part=J;},isEmpty:function(){var I=this.data,H=I&&I.ph;return !(H&&H.n);},del:function B(){var I=this.parent,H=this.tree.nameFactory;if(I&&I.remove&&this.data){I.remove(this.data);H.removeName(this.data.ph.n);}},onkeyup:E,onkeydown:E,onTextEditComplete:function(){var J=this.tree,K=J.nameFactory,H=F.trim(this.text||""),I=this.data.ph.n;if(H&&H!==I){if(K.isNameExist(H)){K.names[H].set("glow",true);this.set("isEditing",true);}else{K.changeName(I,H,this);this.data.ph.n=H;}}},isSelectableArea:function(H){return mstrmojo.dom.contains(this.dynamicNode,H,true);},avatarCssCls:"mstrmojo-FE mstrmojo-dynamicNode",getAvatarNode:function(){return this.dynamicNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.DocDataService");mstrmojo.vi.models.PanelFormatSaver=mstrmojo.provide("mstrmojo.vi.models.PanelFormatSaver",{getPanelSaver:function A(C,B,D){return{saveProperty:function E(G,H){var J=B[G];if(J){if(J.convert){H=mstrmojo.boxmodel.px2Inches(C.getZoomProps(),H);}var I={},F=I[J.set]={};F[J.name]=H;C.updateUnitFormat(D||C.getRootNode(),1,I,undefined,mstrmojo.DocDataService.RAPID_EXEC);}}};}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.PanelFormatSaver");mstrmojo.vi.ui._IsViPanel=mstrmojo.provide("mstrmojo.vi.ui._IsViPanel",{_mixinName:"mstrmojo.vi.ui._IsViPanel",getPanelSaver:function A(){return null;},setOpenStatus:function D(F,E,I,H){if(this.visible!==F){this.set("visible",F);if(!H){this.resetLayout(H);}if(!E){var G=this.getPanelSaver();if(G){G.saveProperty("visible",F);}}mstrApp.rootCtrl.generateToolbar();}},getOpenStatus:function C(){return !!this.visible;},resetLayout:function B(){this.height=this.width="1px";this.parent.doLayout();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");mstrmojo.ui.List=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.List",postselectionChange:function C(D){var G=D.added||[],F=G.length,I=D.removed||[],E=I.length;if(E){this.selectionRemoved({added:G,removed:I,isReselect:false});}if(F){var H=function(J){return[].concat(J).sort().join(",");};this.selectionAdded({added:G,removed:I,isReselect:H(G)===H(I)});}},selectionAdded:function A(D){},selectionRemoved:function B(D){}});mstrmojo.ui.List.SelectionChangeEvtType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.css");var B=mstrmojo.css;var A;var D;mstrmojo.ui.ButtonBar=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.ButtonBar",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onenabledChange:function G(){B.toggleClass(this.domNode,"disabled",!this.enabled);}},cssDisplay:"table",icnCssText:"display:table-row;",items:null,showIcon:true,hasSpacing:false,init:function F(I){this._super(I);var H=["mstrmojo-ui-ButtonBar"];if(this.hasSpacing){H.push("spacing");}if(!this.showIcon){H.push("btn-text");}B.addWidgetCssClass(this,H);},getItemMarkup:function E(H){if(!D){D=this._super(H);}if(!A){A=D.replace(">{@en@n}<",'title="{@en@n}"><div>&nbsp;</div><');}return this.showIcon&&!H.tx?A:D;},getItemProps:function C(J,H){var I=this._super(J,H);var K=J.css;if(K){I.addCls(K);}I.n=J.n||"";return I;}});mstrmojo.ui.ButtonBar.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var D=mstrmojo.dom,E=mstrmojo.hash;var A;mstrmojo.SuggestionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.SuggestionList",itemField:"n",getItemMarkup:function(G,F){if(!A){var H=this.itemField;A=this._super(G).replace('@title}">{@en@n}<',"@en@"+H+'}">{@en@'+H+"}<");}return A;},getItemProps:function C(H,F){var G=this._super(H,F),I=this.itemField;if(!mstrmojo.string.isEmpty(H[I])){G[I]=H[I];}return G;},onclick:function B(F){if(this.disableClick){return false;}var K=this,H=this.parent,J=H.opener,G=D.isMetaKey(F.hWin,F.e);if(G&&!this.multiSelect){this.multiSelect=J.parent.defn.multi;if(this.multiSelect){D.attachOneTimeEvent(document.documentElement,"keyup",function(){var M=K.selectedIndices;if(J){J.suggestionShown=false;if(M&&!E.isEmpty(M)){var L=[];E.forEach(K.selectedIndices,function(O,N){L.push(K.items[N]);});J.handleSuggestionItemSelect(L);}H.close();}K.multiSelect=false;});}}this._super(F);if(!this.multiSelect){J.suggestionShown=false;var I=this.selectedItem;if(I){J.handleSuggestionItemSelect(I);}H.close();}},bindings:{itemField:"this.parent.opener.itemField",items:"this.parent.opener.suggestionItems",disableClick:"this.parent.opener.disableClick"}});}());(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList");mstrmojo.VisMenuList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.VisMenuList",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:false,init:function C(D){this._super(D);},getItemProps:function A(F,D){var E=this._super(F,D);E.tag="a";E.addCls("mstrmojo-ui-Menu-item");return E;},onselectionChange:function B(D){this._super(D);this.parent.data.set("valid",true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.dom","mstrmojo.qb.EnumDragActions");var E=mstrmojo.dom,A=mstrmojo.qb.EnumDragActions.JOIN_COLUMN,G="item-add",B="item-mn";mstrmojo.qb.DBTableRows=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.DBTableRows",getItemMarkup:function(L,K){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic"></span><span class="item-n">{@n}</span><span class='+G+"></span><span class="+B+"></span></div>";},getItemProps:function H(L,K){return{sel:!!this.selectedIndices[K],cls:"st"+(L.state||"")+(K%2?" odd":" even"),n:L.n,idx:K};},getRowNode:function D(M,L){var K=mstrmojo.array.find(this.items,M,L);if(K>-1){return this.itemsContainerNode.children[K];}},getRowItem:function I(K){return this.items[K];},onclick:function J(L){try{var P=L.target||E.eventTarget(L.hWin,L.e),O=E.findAncestorByAttr(P,"idx",true,this.domNode),K=O&&parseInt(O.value,10),N=P.className;if((N===B||N===G)&&K!==null&&!isNaN(K)){var Q=this.itemsContainerNode.children[K];if(N===B){this.raiseEvent({name:"tableViewMenuSelect",data:this.items[K],menuNode:Q.children[2]});}else{mstrApp.getRootController().addSelectedColumns([this.items[K]]);}}}catch(M){throw M;}},dropZone:true,allowDrop:function C(K){return(K.action===A);},ondrop:function F(L){var K=mstrApp.getRootController(),O=L.src;if(O&&O.data){var N=O.data;if(L.action===A){var M=E.findAncestorByAttr(L.tgt.node,"idx",true,this.domNode);if(M){K.addJoinInfo(N,mstrmojo.hash.copy(this.getRowItem(M.value),{tableName:this.parent.tableData.did,tableId:this.parent.tableData.id}));}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");mstrmojo.requiresDescs(505,629);var C=mstrmojo.dom;mstrmojo.qb.mdx.CubeList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.mdx.CubeList",cssClass:"mstrmojo-qb-emma-tablelist",init:function D(G){this._super(G);var I=this,H={},F=H[this.id]={};F.refreshTables=function E(J){I.set("items",J.items);};mstrApp.getRootController().attachDataChangeListeners(H);},getItemMarkup:function(F,E){return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@n}"> {@n} </div><div class="item-refresh {@isNew}" title="'+mstrmojo.desc(505,"Update")+'"></div><div class="item-del {@isNew}" title="'+mstrmojo.desc(629,"Delete")+'"></div></div>';},getItemProps:function B(F,E){return{cls:"tp"+F.tp,n:F.caption?F.caption:F.n,isNew:F.isNew?"new":"exist",idx:E};},onclick:function A(F){try{var I=F.target||C.eventTarget(F.hWin,F.e),H=C.findAncestorByAttr(I,"idx",true,this.domNode),E=H&&parseInt(H.value,10);if(E!==null&&!isNaN(E)){if(I.className.indexOf("item-del")>-1){mstrApp.getRootController().removeCube(E);}else{if(I.className.indexOf("item-refresh")>-1){mstrApp.getRootController().updateCube(E);}}}}catch(G){mstrApp.onerror(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo._IsList","mstrmojo.ListBase");var D=mstrmojo.dom,G=mstrmojo.array,C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.es.TableList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.qb.es.TableList",cssClass:"mstrmojo-qb-emma-tablelist",itemMaxWidth:"",onitemMaxWidthChange:function F(I){var H=this.itemsContainerNode,J=H&&H.children,K=I.value;G.forEach(J,function(L){L.children[1].style.maxWidth=K;});},init:function E(K){this._super(K);var M=this,L={},J=L[this.id]={};J.refreshTables=function I(N){M.set("items",N.items);};J[C.DBROLES_DELETE]=function H(N){mstrApp.getRootController().removeDBRoleTables(N.item.did);};mstrApp.getRootController().attachDataChangeListeners(L);},getItemMarkup:function(I,H){return'<div class="item cf {@cls}" idx="{@idx}" style="{@style}"><div class="item-ic"></div><div class="item-n" title="{@en@title}" style="max-width: {@maxWidth}">{@en@n}</div><div class="item-del"></div></div>';},getItemProps:function B(I,H){return{cls:"tp"+I.tp,n:I.n,idx:H,title:[I.n," [",I.dbrn,"]"].join(""),maxWidth:this.itemMaxWidth};},onclick:function A(I){try{var L=I.target||D.eventTarget(I.hWin,I.e),K=D.findAncestorByAttr(L,"idx",true,this.domNode),H=K&&parseInt(K.value,10);if(H!==null&&!isNaN(H)){if(L.className==="item-del"){mstrApp.getRootController().removeTable(H);}}}catch(J){mstrApp.onerror(J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");mstrmojo.DivItemRenderer={render:function(E,C,F){var D=mstrmojo.string.encodeHtmlString((F.getItemName?F.getItemName(E,C):(F.itemDisplayField&&E[F.itemDisplayField])));return'<div mstridx="'+C+'" class="'+F.itemCssClass+(F.selectedIndices[C]?" "+F.itemSelectedCssClass:"")+(E.cssClass?" "+E.cssClass:"")+'" style="'+F.itemCssText+'">'+D+"</div>";},select:function(C){if(C&&C.className){C.className+=" selected";}},unselect:function(C){if(C&&C.className){C.className=C.className.replace(/selected/g,"");}},rowHeight:21};mstrmojo._RendersItemDivs={tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"mstrmojo-ListBox-cell",cellCssText:"",itemCssClass:"mstrmojo-ListBox-item",itemSelectedCssClass:"selected",itemDisplayField:"n",itemRenderer:mstrmojo.DivItemRenderer,rangeSelected:false,_findMatch:function(C,D){return mstrmojo.dom.findAncestorByAttr(mstrmojo.dom.eventTarget(C,D),"mstridx",true,this.itemsNode);},premousedown:function A(C){if(mstrmojo.dom.shiftKey(C.hWin,C.e)){mstrmojo.dom.preventDefault(C.hWin,C.e);}},preclick:function B(K){var G=K.hWin,H=K.e,F=this._findMatch(G,H);if(F){var J=parseInt(F.value,10),I=mstrmojo.dom,C=I.ctrlKey(G,H),D=I.shiftKey(G,H);if(C||D){I.clearBrowserHighlights(G);}if(this.multiSelect&&(this.selectionPolicy==="toggle"||C)){var E=this.rangeSelected||this.selectedIndex===-1;this.toggleSelect(J);if(E&&J<this.items.length&&this.selectedIndices[J+1]){J++;}this.selectedIndex=J;this.rangeSelected=false;}else{if(this.multiSelect&&D){this.rangeSelected=true;this.rangeSelect(J);}else{this.singleSelect(J);this.rangeSelected=false;}}}}};mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._RendersItemDivs");mstrmojo.ListBoxBase=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._RendersItemDivs],{scriptClass:"mstrmojo.ListBoxBase",cssClass:"mstrmojo-ListBox",itemCssClass:"mstrmojo-ListBox-item",_markupPrefix:function(){var C=this.itemRenderer;return(C&&C.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="0" cellpadding="0"><tbody>');},_markupSuffix:function(){var C=this.itemRenderer;return(C&&C.markupSuffix)||"</tbody></table>";},_itemPrefix:function(){var C=this.itemRenderer;return(C&&C.itemPrefix)||('<tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'"><td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var C=this.itemRenderer;return(C&&C.itemSuffix)||"</td></tr>";},_getItemNode:function(C){var H=this.itemsNode,G=this.renderAllItems,F=H&&H.tBodies,E=G?0:Math.floor(C/100),D=G?C:C%100,I=F&&F[E]&&F[E].rows&&F[E].rows[D];return I&&I.cells[0].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsPopup","mstrmojo._CanAutoClose");function A(B){return function(){this.domNode.style[B]=this[B]||"";};}mstrmojo.Popup=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.Popup",shadowNodeCssClass:"mstrmojo-popup-shadow",titleNodeCssClass:"mstrmojo-popup-title",contentNodeCssClass:"mstrmojo-popup-content",cssDisplay:"block",keepOpen:false,markupString:'<div id="{@id}" class="mstrmojo-Popup {@cssClass}" style="{@cssText}"><div class="mstrmojo-Popup-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Popup-title {@titleNodeCssClass}">{@title}</div><div class="mstrmojo-Popup-content {@contentNodeCssClass}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onleftChange:A("left"),ontopChange:A("top"),onzIndexChange:A("zIndex")}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.Widget;mstrmojo.Box=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:A.visibleMarkupMethod,onheightChange:A.heightMarkupMethod,onwidthChange:A.widthMarkupMethod}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");function B(K,J,H){var I=J,G;for(;I>0;I--){G=Array(I+1).join("#");K=K.replace(G,H[I-1]);}return K;}var C='<div class="freezing-vis-txt-metric">',A='<div class="freezing-vis-txt-attr">',E="</div>",F="("+mstrmojo.desc(16294,"data retrieval paused")+")";var D=function(J,I){if(J<1&&I<1){return null;}var H=[],G="# ## ### ####";if(J>0){H.push(B(G,4,[A,J,J>1?mstrmojo.desc(3581,"Attributes"):mstrmojo.desc(518,"Attribute"),E]));}if(I>0){H.push(B(G,4,[C,I,I>1?mstrmojo.desc(3582,"Metrics"):mstrmojo.desc(517,"Metric"),E]));}return H.join(",");};mstrmojo.vi.ui.rw.FreezingImageContainer=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.vi.ui.rw.FreezingImageContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-rw-freezingImageContainer mstrmojo-vi-ui-rw-GhostImageContainer {@cssClass}"><div class="mstmojo-freezingImgTableCell"><div class="mstrmojo-freezingImgDiv"><div class="freezing-vis-img ghost-vis-img"></div><div class="freezing-vis-desc"><label class="visName">{@visName}</label><div class="freezing-details">{@freezingDetails}</div></div><div class="vis-dropzone">{@visDropzoneMsg} </div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;}},visName:"",freezingDetails:F,visDropzoneMsg:""});mstrmojo.vi.ui.rw.FreezingImageContainer.getVisDropzoneMsg=D;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-SplitPanel-avatar";L.height=J.clientHeight+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.SplitPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.SplitPanel",draggable:true,dropZone:false,marginSpan:10,minSpan:200,leftItemVisible:true,rightItemVisible:true,lp:25,markupString:'<div id="{@id}" class="mstrmojo-SplitPanel {@cssClass}" style="{@cssText}" ><table cellpadding=0 cellspacing=0><tr><td><div></div></td><td style="padding-left:{@marginSpan}px;"><div class="mstrmojo-qb-SplitPanel-resizeHandle" style="height:{@height};width:{@marginSpan}px;margin-left:-{@marginSpan}px;" ></div><div></div></td></tr></table></div>',markupSlots:{leftItem:function(){return this.domNode.firstChild.firstChild.firstChild.firstChild.firstChild;},rightItem:function(){return this.domNode.firstChild.firstChild.firstChild.children[1].children[1];}},getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-SplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,w:L.w,h:L.h};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.left=Math.min(Math.max(N.x+this.minSpan,K.pos.x),N.x+N.w-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.left=K.pos.x+"px";L.style.top=M.y+"px";L.style.display="block";L.style.zIndex="9999";L.style.height=M.h+"px";},ondragend:function D(J){var L=J.src,O=L&&L.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.left)-O.x-this.marginSpan/2,M=this.domNode.clientWidth;this.lp=K*100/M;this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};this.doLayout();}this.ownAvatar=false;}},children:[{scripClass:"mstrmojo.Box",slot:"leftItem"},{scripClass:"mstrmojo.Box",slot:"rightItem"}],layoutConfig:{w:{leftItem:"20%",rightItem:"80%"},h:{leftItem:"100%",rightItem:"100%"}},afterLayout:function(){if(this.domNode){var J=this.domNode.firstChild.firstChild.firstChild.children[1].children[0].style;if(this.leftItemVisible&&this.rightItemVisible){J.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);J.height=this.height;var L=parseInt(this.children[0].width);this.children[0].set("width",L+"px");this.rightItem.style.width=parseInt(this.width)-L-this.marginSpan+"px";this.children[1].set("width",this.rightItem.style.width);}else{J.display="none";if(this.leftItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}}},_set_leftItemVisible:function(L,J){if(this.leftItemVisible!=J){this.leftItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]=this.marginSpan+"px";}}else{this.layoutConfig.w={leftItem:"0%",rightItem:"100%"};if(this.rightItem){var K=this.rightItem.parentNode;K.style["padding-left"]="0px";}}this.doLayout();}},_set_rightItemVisible:function(K,J){if(this.rightItemVisible!=J){this.rightItemVisible=J;if(J){this.layoutConfig.w={leftItem:this.lp+"%",rightItem:100-this.lp+"%"};}else{this.layoutConfig.w={leftItem:"100%",rightItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.height=this.domNode.clientHeight+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var L=mstrmojo.boxmodel,I=mstrmojo.dom,M=mstrmojo.css,O="mstrmojo-Tooltip",A="mstrmojo-scrollNode",E=20;function C(S,U,R){var V="connectScrollbox";if(R){V="dis"+V;}var Q=S&&S.parent;while(Q){if(Q[V]){Q[V](U);}Q=Q.parent;}}function G(){if(!this._paintHandle){var R=this.id,Q=function(W){var a=mstrmojo.all[R];if(!a){return ;}delete a._paintHandle;var U=[O],b=a.cssClass;if(b){U.push(b);}var S=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),Y=a.opener;if(Y&&Y.getTooltipThemeClass){S=Y.getTooltipThemeClass();}U.push(S);a.domNode.className=U.join(" ");var Z=a.content,V=a.contentNode,X=a.arrowNode;V.className=(O+"-content "+A+" "+a.contentNodeCssClass);V.style.cssText=a.contentNodeCssText;if(!a.hasWidgetContent){V.innerHTML=Z;}X.style.cssText="";a.domNode.style.visibility=!!Z?"visible":"hidden";a.updatePosition();if(!W&&a.optimizePos){a.optimizePos();}a.updateScrollbars();};if(!this._hasPaint){Q(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(Q,0);}}}function B(V,d,k,W){var Z=d&&(d.richTooltip||d.tooltip),n=k?I.getMousePosition(k,W||self):null,c=Z&&(typeof Z==="string");var l="",b="",Y="",h=Z,a=null,Q=mstrmojo.tooltip.POS_TOPLEFT,S=null,f=null,R=null,m=false,U=null,X=mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY;var g=false,j=false;if(Z&&!c){b=Z.cssClass||b;l=Z.contentNodeCssClass||l;Y=Z.contentNodeCssText||Y;h=Z.content||"";a=Z.refNode||a;Q=Z.posType||Q;S=Z.left||0;f=Z.top||0;g=Z.keepArrowXPos||g;j=Z.keepArrowYPos||j;R=Z.updatePosition||null;m=Z.hasWidgetContent;U=Z.children;X=Z.tooltipCloseDelay||mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY;}V.set("contentNodeCssClass",l);V.set("cssClass",b);V.set("contentNodeCssText",Y);V.set("content",h);V.set("refNode",a);V.set("posType",Q);V.set("left",c?((n&&n.x)||V.left):S);V.set("top",(c||!Z)?((n&&(n.y+E))||V.top):f);V.set("keepArrowXPos",g);V.set("keepArrowYPos",j);if(R){V.set("updatePosition",R);}else{V.set("updatePosition",mstrmojo.Tooltip.prototype.updatePosition);}V.set("hasWidgetContent",m);V.set("children",U);V.set("tooltipCloseDelay",X);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",allowOtherTooltips:false,markupString:'<div id="{@id}" class="'+O+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+O+'-shadow {@shadowNodeCssClass}"></div><div class="'+O+'-contentWrapper"><div class="'+O+"-content "+A+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+O+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function D(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var R=this.domNode.style,Q=!!this.visible;if(this._previousVisible!==Q){R.visibility="hidden";}R.display=Q?"block":"none";this._previousVisible=Q;if(Q){this.updatePosition();if(this.content){G.call(this);}}},onleftChange:G,ontopChange:G,onrefNodeChange:G,onposTypeChange:G,oncontentNodeCssClassChange:G,oncontentNodeCssTextChange:G,oncontentChange:G,oncssClassChange:G},preBuildRendering:function N(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function H(W){if(!this.visible&&!W){return ;}var V=this.refNode,U=V?L.offset(V,document.body):{left:I.getHorizontalScroll(),top:I.getVerticalScroll()},n=this.domNode.style,g=this.containerNode,j=g.offsetWidth,a=g.offsetHeight,R=this.posType,d=R.indexOf("R")>-1,X=R.indexOf("B")>-1,c=this.top!==null?parseInt(this.top,10)+U.top-(X?a:0):null,S=this.left!==null?parseInt(this.left,10)+U.left-(d?j:((R.indexOf("C")>-1)?Math.floor(j/2):0)):null,l=false,b=false,e,Y,k=I.windowDim(),h=I.getHorizontalScroll()+k.w,Q=I.getVerticalScroll()+k.h,f=this.arrowNode,m=null;if(S!==null){e=Math.min(Math.max(S,0),h-j);n.left=e+"px";l=S!==e;}if(c!==null){Y=Math.min(Math.max(c,0),Q-a);n.top=Y+"px";b=c!==Y;}if(l||b){var Z,p=this.keepArrowXPos&&l,o=this.keepArrowYPos&&b;if(p||o){m=M.getComputedStyle(f);Z=m.left;}if(Z&&Z.endsWith("%")){Z=parseFloat(Z)/100*j;}if(p){f.style.left=(parseInt(Z,10)+S-e)+"px";}if(o){f.style.top=(parseInt(m.top,10)+c-Y)+"px";}}M.toggleClass(this.domNode,"offset",l||b);},_on_tooltip_change:function(Q){B(this,Q&&Q.src);},_set_opener:function(U,S){var R=this.opener,Q=S!==R;if(Q){if(S){C(S,this);}if(R){C(S,this,true);}if(R&&R.detachEventListener){R.detachEventListener(this._richSubs);R.detachEventListener(this._ttpSubs);}if(S&&S.attachEventListener){this._richSubs=S.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=S.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=S;}return Q;},updatePopupConfig:function(Q,R){B(this,R,Q&&Q.e,Q&&Q.win);},onscroll:function K(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var J=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function F(R,U,S,Q){if(R&&R.hasWidgetContent&&J){J.destroy();}if(!J||!mstrmojo.all[J.id]){J=new mstrmojo.Tooltip();}Q=Q||{};Q.e=U;Q.win=S;J.open(R,Q);R.tooltip=J;},close:function P(){if(J&&!J.allowOtherTooltips){var Q=J.opener;if(Q){Q.tooltip=null;}J.close();if(Q&&Q.hasWidgetContent){J.destroy();}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var F="",B="row-",E=mstrmojo.css.DISPLAY_TABLE;mstrmojo.Table=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Table",cellCssClass:"",rows:-1,cols:-1,_trows:-1,cellPadding:0,cellSpacing:0,layout:null,markupString:'<table id="{@id}" class="mstrmojo-Table {@cssClass}" style="{@cssText}" cellpadding="{@cellPadding}" cellspacing="{@cellSpacing}">{@tableHtml}</table>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?E:"none";}},preBuildRendering:function G(){var I=[],P=this.cellCssClass;if(this.layout){var Q=this._trows=this.layout.length;for(var K=0;K<Q;K++){var H=this.layout[K],R=H.cells,O=R.length,L=[];for(var J=0;J<O;J++){var N=R[J],M="";M+=((N.cssClass||P)?' class="'+(N.cssClass||P)+'"':"");M+=(N.cssText?' style="'+N.cssText+'"':"");M+=(N.rowSpan?' rowspan="'+N.rowSpan+'"':"");M+=(N.colSpan?' colspan="'+N.colSpan+'"':"");L[J]="<td"+M+"></td>";}var S="";S+=(H.cssClass?' class="'+H.cssClass+'"':"");S+=(H.cssText?' style="'+H.cssText+'"':"");I[K]="<tr"+S+">"+L.join("")+"</tr>";}}else{this._trows=this.rows;var M=(P?' class="'+P+'"':""),L=[];for(var K=0;K<this.rows;K++){for(var J=0;J<this.cols;J++){L[J]="<td"+M+"></td>";}I[K]="<tr>"+L.join("")+"</tr>";}}this.tableHtml=I.join("");if(this._super){this._super();}},postBuildRendering:function C(){if(this._trows){var M={},I=this.containerNode.rows,N=I.length;for(var L=0;L<N;L++){var K=I[L].cells,H=K.length;M[B+L]=I[L];for(var J=0;J<H;J++){M[F+L+","+J]=K[J];}}this.addSlots(M);}this._super();},childRenderCheck:function D(I){if(I&&!I.hasRendered){var H=I.slot||this.defaultChildSlot;return !!this[H]||H.match(/^([\d]+),([\d]+)$/);}return false;},on_child_change_rendering:function A(L){var H=(L&&L.src)||L,O=H&&H.domNode;if(O){var V=H.slot;if(!this[V]){var M=V&&V.match(/^([\d]+),([\d]+)$/);if(M){var R=parseInt(M[1],10),W=parseInt(M[2],10),Q=this.containerNode,U=this[(B+R)],N=[];if(!U){var J=Q.rows,S=J&&J.length||0;for(var K=S;K<=R;K++){N[B+K]=Q.insertRow();}U=N[B+R];}var P=U.cells&&U.cells.length||0;for(var K=P;K<=W;K++){var I=U.insertCell(K);N[F+R+","+K]=I;if(this.cellCssClass){I.className=this.cellCssClass;}}this.addSlots(N);}}}this._super(L);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineFileButton");mstrmojo.requiresDescs(14180,14181,14182,14183,221,2164);mstrmojo.Refine.RefineImportDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineImportDialog",markupString:'<div id="{@id}" class="refine-import-dialog"><div class="refine-import-dialog-header">'+mstrmojo.desc(14180,"Import History Script")+'</div><div class="refine-import-dialog-body"><div class="refine-import-dialog-instruction"></div><div class="refine-import-dialog-input"></div></div><div class="refine-import-dialog-footer"><div class="refine-import-dialog-cancel"></div><div class="refine-import-dialog-apply"></div><div class="refine-import-dialog-file"></div></div><div class="refine-dialog-curtain" style="display: block"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},instructionNode:function(){return this.domNode.children[1].children[0];},inputNode:function(){return this.domNode.children[1].children[1];},cancelNode:function(){return this.domNode.children[2].children[0];},applyNode:function(){return this.domNode.children[2].children[1];},fileNode:function(){return this.domNode.children[2].children[2];},curtainNode:function B(){return this.domNode.lastChild;}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=-1;}},getMovingHandle:function D(){return this.headerNode;},getMovingTarget:function F(){return this.editorNode;},preBuildRendering:function A(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},children:[{scriptClass:"mstrmojo.Label",slot:"instructionNode",bindings:{text:function(){if(!!window.FileReader){return mstrmojo.desc(14181,"Browse or Paste the Wrangling Script");}else{return mstrmojo.desc(14182,"Paste the Wrangling Script");}}}},{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,input,keydown,keyup,blur></textarea>',slot:"inputNode",alias:"textArea",maxLength:undefined,onkeyup:function C(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}},oninput:function E(){if(this.value){this.parent.apply.set("enabled",true);}else{this.parent.apply.set("enabled",false);}}},{scriptClass:"mstrmojo.Refine.RefineFileButton",slot:"fileNode",bindings:{visible:function(){return !!window.FileReader;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",slot:"cancelNode",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"apply",slot:"applyNode",enabled:false,text:mstrmojo.desc(2164,"Apply"),onclick:function(){String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"");};String.prototype.startsWith=function(J){return this.length>=J.length&&this.substring(0,J.length)==J;};String.prototype.endsWith=function(J){return this.length>=J.length&&this.substring(this.length-J.length)==J;};String.prototype.contains=function(J){return this.indexOf(J)>=0;};var H=function(J){J=J.trim();if(!J.startsWith("[")){J="["+J;}if(!J.endsWith("]")){J=J+"]";}return J.replace(/\}\s*\,\s*\]/g,"} ]").replace(/\}\s*\{/g,"}, {");};var G;try{G=this.parent.textArea.value;G=H(G);G=JSON.parse(G);}catch(I){mstrmojo.alert(mstrmojo.desc(14183,"The JSON you pasted is invalid."));return ;}this.parent.controller.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});this.parent.destroy();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash");var W=mstrmojo.hash,Y=mstrmojo.dom,F="h",S="w",G="100%",L="none",V={HORIZONTAL:0,VERTICAL:1},D=V.HORIZONTAL,B="horizontal",H="vertical",J={firstSplitNode:"300px",resizeHandleNode:"5px",secondSplitNode:G};function Q(){var c=this.config,a=this.orientation,e=(a===D)?S:F,Z=(a===D)?F:S,b="Node",f=this.layoutConfig||{};f.xt=true;f[e]=f[e]||W.copy(J);f[Z]=f[Z]||{firstSplitNode:G,resizeHandleNode:G,secondSplitNode:G};var d=f[e];W.forEach(c,function(h,g){d[g+b]=h.v;});return f;}function I(k){var c=this._wPos,a=(this.orientation===D)?"x":"y",n=k[a]-c[a],e=this.config,m=e.firstSplit,p=e.secondSplit,l=parseInt(m.min,10),b=parseInt(p.min,10),g=(m.v.indexOf("px")>-1),d=parseInt((this.orientation===D)?this.width:this.height,10);if(!g){if(n===d){n=d*(parseInt(m.v,10)/100);}}var h=d-b,Z=Math.floor(Math.min(Math.max(n,l),h));if(this.applyPercentage){var o=Math.round((Z/d)*100),j=(d-parseInt(e.resizeHandle.v,10)-Z),f=Math.round((j/d)*100);if((o+f)<100){f+=(100-(o+f));}m.v=o+"%";p.v=f+"%";}else{m.v=Z+"px";p.v="100%";}this.layoutConfig=Q.call(this,e);this.doLayout();}mstrmojo.ui.Splitter=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.ui.Splitter",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-SplitterHandle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',markupSlots:{firstSplitNode:function C(){return this.domNode.firstChild;},resizeHandleNode:function A(){return this.domNode.children[1];},secondSplitNode:function K(){return this.domNode.children[2];}},orientation:D,orientationCss:"",applyPercentage:false,onRender:function O(){if(this.applyPercentage){var a=(this.orientation===D)?"x":"y",Z={};this._wPos={};Z[a]=parseInt((this.orientation===D)?this.width:this.height,10);this._wPos[a]=0;I.call(this,Z);}},config:{firstSplit:{v:"50%",min:"100px",max:undefined},secondSplit:{v:"50%",min:"100px",max:undefined},resizeHandle:{v:"5px"}},init:function X(Z){this._super(Z);var a=(this.orientation===D);this.orientationCss=a?B:H;this.restrictedToAxis=a?"x":"y";this.config=W.clone(this.config);this.layoutConfig=Q.call(this);},toggleFirstItemVisibility:function N(Z){if(Z){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:"0px",resizeHandleNode:"0px",secondSplitNode:G};}this.doLayout();},toggleSecondItemVisibility:function P(Z){if(Z){this.layoutConfig=Q.call(this);}else{this.layoutConfig[(this.orientation===D)?S:F]={firstSplitNode:G,resizeHandleNode:"0px",secondSplitNode:"0px"};}this.doLayout();},draggable:true,dropZone:false,avatarCssClass:"mstrmojo-Splitter-av",delayResizing:false,createAvatar:function U(){var d=document.createElement("div"),c=(this.orientation===D),a=this._wPos=Y.position(this.domNode),b="2px",Z=d.style;Z.top=(c?a.y:0)+"px";Z.left=(c?0:a.x)+"px";Z.height=c?this.height:b;Z.width=c?b:this.width;Z.display=this.delayResizing?"block":L;return d;},isDragValid:function E(Z){return Z.src.node===this.resizeHandleNode||this._super(Z);},ondragmove:function R(Z){if(!this.delayResizing){I.call(this,Z.tgt.pos);}if(this._super){this._super(Z);}},ondragend:function M(Z){if(this.delayResizing){I.call(this,Z.tgt.pos);}delete this._wPos;if(this._super){this._super(Z);}}});mstrmojo.ui.Splitter.ENUM_OR=V;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.InlineEditBox","mstrmojo.Button");var B=": ";mstrmojo.qb.thirdParty.InlineEditBox=mstrmojo.declare(mstrmojo.InlineEditBox,null,{postCreate:function A(){if(this._super){this._super();}this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oneditModeChange=function(){var I=this.editMode,F=this.domNode,E=this.textNode,H=this.editNode;mstrmojo.css.toggleClass(F,["edit"],I);if(I){E.style.display="none";H.style.display="block";E=this.inputNode;var G=E.style;E.value=this.parent.url||"";G.width=(F.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";G.height=F.clientHeight+"px";E.focus();if(E.createTextRange){var J=E.createTextRange(),D=E.value.length;J.move("character",D);J.select();}}else{E.style.display="block";H.style.display="none";}};},save:function(){this.set("text",this.parent.dbRoleName+B+this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){this.parent.set("url",this.inputNode.value);},bindings:{text:function(){return this.parent.dbRoleName+B+this.parent.url;}}});mstrmojo.qb.thirdParty.UrlSourceItem=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",markupString:"<div class='qb-bi-source-url-list' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},iconNode:function(){return this.domNode.children[0];},contentNode:function(){return this.domNode.children[1];},deleteNode:function(){return this.domNode.children[2];}},allowEdit:true,url:"",dbRoleID:"",dbRoleName:"",children:[{slot:"iconNode",alias:"icon",cssClass:"mstrmojo-di-url-icon",scriptClass:"mstrmojo.Label"},{slot:"contentNode",alias:"text",cssClass:"urlItem-text-div",scriptClass:"mstrmojo.qb.thirdParty.InlineEditBox"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-url-delete-button",innerIconClass:"close-button",onclick:function(){this.parent.deleteURL();}}],deleteURL:function C(){this.parent.deleteURL(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var B=mstrmojo.css;mstrmojo.Panel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Panel",state:1,showTitlebar:false,markupString:'<div id="{@id}" class="mstrmojo-Panel {@cssClass}" style="position: relative;{@cssText}"><div class="mstrmojo-Panel-titlebar {@cssClass}"><img class="mstrmojo-Panel-state" src="../images/1ptrans.gif" align="absmiddle" onclick="var w = mstrmojo.all[\'{@id}\']; w.set(\'state\', w.state === 0 ? 1 : 0)" /><span class="mstrmojo-Panel-text" style="{@ttlTxtCssText}"></span><input type="button" class="mstrmojo-Panel-del" value="{@delText}" onclick="mstrmojo.all[\'{@id}\'].del()"/><div class="mstrmojo-clearMe"></div></div><div class="mstrmojo-Panel-container"></div></div>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},titlebarNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.firstChild.childNodes[1];},containerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){var C=this.titleNode;if(C){var D=this.title;C.innerHTML=(D!==null)?D:"";}},onstateChange:function(){var C=(this.state===0);for(var D in {stateNode:1,titleNode:1,containerNode:1}){if(this[D]){B.toggleClass(this[D],["closed"],C);}}},onshowTitlebarChange:function(){B.toggleClass(this.titlebarNode,["closed"],(this.showTitlebar===false));}},del:function A(){var C=this.parent;if(C&&C.remove){C.remove(this.item);}if(this.customDel){this.customDel();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.array","mstrmojo.Refine.DateTimeUtil","mstrmojo.Refine.RefineHelpers","mstrmojo.string");mstrmojo.requiresDescs(221,12366,2164,13188,14517);var A=mstrmojo.dom;var D=mstrmojo.array;var F=mstrmojo.Refine.DateTimeUtil;function C(G){return !isNaN(parseFloat(G))&&isFinite(G);}mstrmojo.Refine.PopupEditBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.PopupEditBox",text:"",value:"",top:0,left:0,markupString:'<div id="{@id}" class="refine-cell-editor {@cssClass}" style="top: {@top}; left: {@left};" mstrAttach:click,keydown><div class="refine-menu-overlay"></div><div class="refine-menu-container" style="width: {@width};"><div class="refine-cell-editor-text"></div><div class="refine-cell-editor-actions"><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div></div></div></div>',markupSlots:{overlayNode:function(){return this.domNode.firstChild;},autoNode:function(){return this.domNode.lastChild.childNodes[0];},buttonNode:function(){return this.domNode.lastChild.lastChild;},applyToAllNode:function(){return this.domNode.lastChild.lastChild.childNodes[2];},applyNode:function(){return this.domNode.lastChild.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild.childNodes[0];}},children:[{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply-to-all",title:mstrmojo.desc(12366,"Apply To All")+" (Enter)",slot:"applyToAllNode",onclick:function(){this.parent.applyToAll();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply",title:mstrmojo.desc(2164,"Apply")+" (Ctrl + Enter)",slot:"applyNode",alias:"applyButton",bindings:{visible:function(){return(!this.parent.fromFacet)&&(!mstrApp.getRootController().refineApp.isBDE);}},onclick:function(){this.parent.apply();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-cancel",title:mstrmojo.desc(221,"Cancel"),alias:"cancel",slot:"cancelNode",onclick:function(){this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}}],applyToAll:function(){var K=this.autoNode.childNodes[0].childNodes[2].value;if(String(this.text)!==K){var M=this.preview.controller;var L=M.model;var I=this.columnName;var G=[],J,O;var H="yyyy-MM-ddTHH:mm:ssZ";var N=this.type;J=JSON.parse(JSON.stringify(L.transformations.EditCell.applyToAll));J.description=J.description.replace("[column name]",I);J.columnName=I;J.edits[0].to=K;if(this.type==="number"){if(!C(K)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}O=parseFloat(K);J.edits[0].to=O;}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){O=Date.parse(K);if(!O){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date"));return ;}J.edits[0].to=K;N="date";}}if(this.text===""||(this.text==="(blank)"&&this.blankChoice)){J.edits[0].fromBlank=true;J.edits[0].from[0]="";}else{J.edits[0].from[0]=this.value||this.text;}J.edits[0].type=N;if(!this.fromFacet){J.engineConfig=JSON.parse(L.engine);}G.push(J);this.preview.controller.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});}},apply:function(){var M=this.autoNode.childNodes[0].childNodes[2].value;if(this.text.toString()!==M){var H=this.preview.controller;var K=H.model;var J=[],I,L;var G="yyyy-MM-ddTHH:mm:ssZ";I=JSON.parse(JSON.stringify(K.transformations.EditCell.singleEdit));I.description=I.description.replace("####",this.row);I.description=I.description.replace("####",this.cell);I.row=this.row;I.col=this.cell;L=M;if(this.type==="number"){if(!C(M)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}L=parseFloat(M);}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){L=Date.parse(M);if(!L){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date."));return ;}L=M;}}I.to=L;I.description=I.description.replace("####",L);J.push(I);this.preview.controller.applyOperations({operations:JSON.stringify(J),engine:JSON.stringify({facets:[],mode:"row-based"})});}},onclick:function(G){var I=G.e,H=A.eventTarget(G.hWin,I);if(H===this.overlayNode){this.destroy();}},prekeydown:function(H){var K=H.e,I=K.keyCode||K.charCode,G=this.preview.controller,J=G.model;if(K.ctrlKey&&I===mstrmojo.Enum_Keys.ENTER){if(!this.fromFacet&&!J.hasAddSample()){this.apply();this.destroy();}}else{if(I===mstrmojo.Enum_Keys.ENTER){this.applyToAll();this.destroy();}else{if(I===mstrmojo.Enum_Keys.ESCAPE){this.destroy();}}}},preBuildRendering:function B(){var G=this.preview.controller,H=G.model;this.placeholder=document.body.appendChild(document.createElement("div"));if(H.hasAddSample()){this.applyButton.set("visible",false);}return this._super();},postBuildRendering:function E(){this._super();this.autoNode.style.width=(parseInt(this.width)-(this.fromFacet?43:88))+"px";if(this.floatLeft){this.autoNode.style["float"]="left";this.autoNode.style.marginRight="3px";this.buttonNode.style["float"]="left";}else{this.autoNode.style["float"]="right";this.autoNode.style.marginLeft="3px";this.buttonNode.style["float"]="right";}var I=this;var M=mstrmojo.Refine.RefineHelpers.completely(this.autoNode,{bottom:(this.fromFacet?14:16),top:(this.fromFacet?15:17),left:(this.fromFacet?0:10),fontSize:"8pt",fontFamily:"monospace",width:(parseInt(this.width)-(this.fromFacet?43:77))});setTimeout(function(){M.input.focus();M.setText(I.text);M.input.select();M.repaint();},0);var H={facets:[{type:"list",name:this.columnName,columnName:this.columnName,expression:"value",omitBlank:false,omitError:false,selection:[],selectBlank:false,selectError:false,invert:false}],mode:"row-based"};var G=[];var L={success:function(O){var P=O.facets[0].choices,N;if(P){for(N=0;N<P.length;N++){G.push(P[N].v.l);}}G.sort(function(R,Q){return R.localeCompare(Q);});M.options=G;setTimeout(function(){M.repaint();},0);}};var K={engine:JSON.stringify(H)};var J={project:this.preview.controller.model.projectID};this.preview.controller.dataService.computeFacetsQuiet(L,J,K);return true;},destroy:function(){D.forEach(this.children,function(G){if(G.hasOpenTooltip){G.hideTooltip();}},this);this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash");var K=mstrmojo.hash,Q=mstrmojo.css,S="hidden",P=mstrmojo.Widget,R="mstrmojo-wh-pn-",A="titleIconsNode";mstrmojo.warehouse.ui.BasePanel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.warehouse.ui.BasePanel",markupString:'<div id="{@id}" class="mstrmojo-wh-Panel {@cssClass}" mstrAttach:click><div class="'+R+'header"><div class="'+R+'title tp{@icntp}"><span>{@title}</span></div><div class="'+R+'ttl-icons"></div></div><div><div class="'+R+'instructions-text">{@instructionsText}</div></div></div>',markupSlots:{headerNode:function F(){return this.domNode.firstChild;},titleNode:function J(){return this.domNode.firstChild.firstChild;},titleTextNode:function L(){return this.domNode.firstChild.firstChild.firstChild;},titleIconsNode:function C(){return this.domNode.firstChild.children[1];},instructionsNode:function E(){return this.domNode.lastChild.children[0];},containerNode:function M(){return this.domNode;}},markupMethods:{onvisibleChange:P.visibleMarkupMethod,onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod},onRender:function G(){this._super();if(this.instructionsHeight){this.oninstructionsHeightChange({value:this.instructionsHeight});}this.oninstructionsVisibleChange({value:this.instructionsVisible});},title:"",titleTooltip:"",icntp:"",postBuildRendering:function N(){this._super();if(this.editableSlot){this.setEditableTitle("");}},ontitleChange:function O(){this.titleTextNode.innerHTML=this.title;},addNewTitleButton:function B(U){this.addChildren(K.copy(U,{scriptClass:"mstrmojo.Widget",markupString:'<span id="{@id}" class="{@cssClass}" mstrAttach:click>{@text}</span>',onvisibleChange:function V(){this.domNode.style.display=this.visible?"":"none";},useRichTooltip:true,showTooltip:function W(X,Y){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.domNode,top:32,content:this.title||""};this.constructor.prototype.showTooltip.call(this,X,Y);},slot:A}));},setEditableTitle:function I(U){Q.toggleClass(this.titleNode,S,(U===""));Q.toggleClass(this.titleIconsNode,S,(U===""));this.set("text",U);this.set("title",U);},instructionsText:"",instructionsHeight:undefined,oninstructionsHeightChange:function H(U){var W=this.instructionsNode,V=U.value;if(W){W.style.height=V;W.style.lineHeight=V;}else{this.instructionsHeight=undefined;}},instructionsVisible:false,oninstructionsVisibleChange:function D(U){if(U.value){this.instructionsNode.style.display="block";}else{this.instructionsNode.style.display="none";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var B=mstrmojo.func,D=mstrmojo.dom,C=mstrmojo.ui._HasUITheme.EnumThemeNames,G="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function J(N){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);}this._super(N);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function E(){var N=this.getPopupWidget();if(!N||N._pbCfg){return ;}var O=function O(Q,P){return function(){Q.apply(P,arguments);};};N.onOpen=B.composite([O(this.onPopupWidgetOpened,this),N.onOpen||mstrmojo.emptyFn]);N.onClose=B.composite([O(this.onPopupWidgetClosed,this),N.onClose||mstrmojo.emptyFn]);N._pbCfg=true;},onclick:function L(N){if(this.isClickingAnchorSlot(N)){var O=this.getPopupWidget();if(!O.visible){this.openPopup(O);}else{this.closePopup();}}},isClickingAnchorSlot:function M(N){var O=N.getTarget();return O===this[this.anchorSlot]||O.parentNode===this[this.anchorSlot];},onPopupAutoClosed:function I(O,N){if(D.contains(this[this.anchorSlot],D.eventTarget(N,O),true)){return false;}},getPopupHostNode:function K(){return this.containerNode;},getPopupConfig:function H(){var O=[G],N=this.hostedCSSClass;if(N){O.push(N);}var P=new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:O.join(" ")});return this.disposables?this.addDisposable(P):P;},unrender:function F(N){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(N);},postBuildRendering:function A(){var R=this.getPopupWidget();if(R){var U=this.getPopupConfig();if(!U.isHostedWithin){var P=this.parent||this.opener,O=U.hostProxyCssClass.split(" ");O.push(this.domNode.className);while(P){var S=P.themeClassName;if(S){O.push(S);break;}P=P.parent||P.opener;}if(U.useDarkTheme){O.splice(O.indexOf(C.LIGHT_THEME),1);O.push(C.DARK_THEME);}U.hostProxyCssClass=O.join(" ");}mstrmojo.Obj.free(R.popupConfig);R.popupConfig=R.addDisposable(U);}if(!(this.editableSlot&&D.isMobile)){var N=R.id,Q=this._listenerProc=function(){var V=mstrmojo.all[N];if(V&&V.visible&&V.adjustCornersForPopupOverflow){V.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){D.attachEvent(window,"resize",Q);}}return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");mstrmojo.VBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.VBox",markupString:'<table id="{@id}" class="mstrmojo-VBox {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(10,2391,8338,8513,12882,13006,13819,14308,14309,14504,14505);var O=mstrmojo.DI.DIConstants,F=mstrmojo.desc,I=mstrmojo.css,H=mstrmojo.dom,L=5000;mstrmojo.DI.DISearchBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DISearchBox",cssClass:"mstrmojo-DI-SearchBox",searchLabel:F(10,"Search"),headerLabelVisible:false,footerLabelVisible:true,headerLabelText:F(13006,"Search for Data"),placeHolderText:F(13006,"Search for Data"),previewTableId:"",showOperators:true,showAdvancedOptions:false,showFetchOptions:false,noDataErrorString:F(12882,"No data was returned, please try another search string."),hideSignout:false,hint:"",iconCssClass:"",signOutTooltipText:"",tipLabel:mstrmojo.desc(14504,"Tip: use")+" ",operatorLabel:mstrmojo.desc(14505,"operators"),markupString:'<div class = "{@cssClass}" mstrAttach:click,input><div class = "signOut cf"></div><div class = "block center"><label class = "headerLabel" style="visible:{@headerLabelVisible};">{@headerLabelText}</label><div class="input"><input class="inputSearch" type="text" value = "" placeholder="{@placeHolderText}"/><div id={@id} class="mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton"><div class="mstrmojo-Button-text ">{@searchLabel}</div></div></div><div class="footerDiv"><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible}">{@tipLabel}<a class = "helpOperatorsLabelLink"><span id="operators">{@operatorLabel} </span></a></label><label class ="helpOperatorsLabel" style="visible:{@footerLabelVisible};"><a class = "helpOperatorsLabelLink"><span id="advanced">'+F(2391,"Advanced search")+'</span></a></label></div><div  class="mstrmojo-di-source-fetch"><input type="text" value="100"/>'+F(14308,"## rows of latest tweets.").replace("##","")+'<span class="comment"> ('+F(14309,"Please do not type more than ##").replace("##",L)+')</span></div><div id={@id} class ="helpOperators" mstrAttach:click ></div><div id={@id} class ="noDataReturned">{@noDataErrorString}</div></div></div>',markupSlots:{signoutNode:function(){return this.domNode.children[0];},blockNode:function(){return this.domNode.children[1];},headerLabelNode:function(){return this.domNode.children[1].childNodes[0];},searchFieldNode:function(){return this.domNode.children[1].childNodes[1].firstChild;},searchButton:function(){return this.domNode.children[1].childNodes[1].lastChild;},footerNode:function(){return this.domNode.children[1].childNodes[2];},fetchNode:function(){return this.domNode.children[1].childNodes[3];},operatorsHelpNode:function(){return this.domNode.children[1].childNodes[4];},noDataReturnedNode:function(){return this.domNode.childNodes[1].lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.footerNode.firstChild.style.display=this.showOperators?"inline-block":"none";this.footerNode.children[1].style.display=this.showAdvancedOptions?"inline-block":"none";this.fetchNode.style.display=this.showFetchOptions?"block":"none";this.headerLabelNode.style.display=this.headerLabelVisible?"block":"none";}},handleNoDataReturned:function P(){this.noDataReturnedNode.style.visibility="visible";},init:function M(R){var S,Q;this._super(R);S={};Q=S[this.id]={};Q[O.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;mstrApp.getRootController().attachDataChangeListeners(S);},formatUserEmail:function N(Q){if(Q!==""){Q="("+Q+")";}return Q;},getUserEmail:function J(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userEmail;return this.formatUserEmail(Q);},getUserName:function C(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].userDisplayName;return F(8513,"User:")+Q+" ";},getProfilePic:function D(){var Q=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].picurl;return Q||"";},populate:function G(){this.emailAddress.set("text",this.getUserEmail());this.username.set("text",this.getUserName());this.noDataReturnedNode.style.visibility="hidden";},children:[{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-signout",alias:"signoutLink",text:F(8338,"sign out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(this.parent.parent.sourceObjectsInfo.type);},postBuildRendering:function B(){var R=this,S=this.parent.signOutTooltipText;var Q;if(this._super){Q=this._super();}if(S){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:50,content:S});if(!this._ontooltipover){this._ontooltipover=function(U){R.showTooltip(U,self);};this._ontooltipout=function(U){R.hideTooltip(U,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);}return Q;}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"signoutLinkSeparator",text:" | "},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"emailAddress",bindings:{text:function(){return this.parent.getUserEmail();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"username",bindings:{text:function(){return this.parent.getUserName();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"profileIcon",bindings:{visible:function(){return !!this.parent.getProfilePic();},src:function(){return this.parent.getProfilePic();}}},{slot:"signoutNode",scriptClass:"mstrmojo.Image",cssClass:"sourceIcon",bindings:{src:function(){var Q="../javascript/mojo/css/images/DI/facebook-logo-small.png";if(this.parent.parent.iconCssClass==="twitterIcon"){Q="../javascript/mojo/css/images/DI/twitter-logo-small.png";}return Q;}}}],handleHelpOperatorsItemClick:function E(Q,S){var R=Q.currentTarget.value;S.searchFieldNode.value=R;S.searchFieldNode.select();},operatorsHelp:{toggleVisibility:function(Q){if(Q.style.visibility==="visible"){Q.style.visibility="hidden";}else{Q.style.visibility="visible";}}},onclick:function(Q){var R=Q.e.target||Q.e.srcElement;if(H.contains(this.searchButton,R,true)){this.parent.onSearchClick(this.getSearchQuery());}if(R.id==="advanced"){this.parent.onadvancedSearchClick();}else{if(R.id==="operators"){mstrApp.getRootController().showDialog(O.dialogType.twitterAdvOptDialog);}}},oninput:function(Q){this.parent.handleSearchChange(Q);},postBuildRendering:function(){var R=this,Q=this.fetchNode.children[0];if(this._super){this._super();}this.parent.refreshSearch();if(this.signoutLink){this.signoutLink.domNode.style.display=this.hideSignout?"none":"block";this.signoutLinkSeparator.domNode.style.display=this.hideSignout?"none":"block";}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:Q,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:F(13819,"Invalid input")});if(!this.validateFetchNum){this.validateFetchNum=function(U){var S=R.getFetchValue();if(!S.valid){I.addClass(Q,"warning");R.showTooltip(U,window);window.clearTimeout(R._warningTimeOut);R._warningTimeOut=window.setTimeout(function(){R.hideTooltip(U,window);},6000);}else{window.clearTimeout(R._warningTimeOut);R.hideTooltip(U,window);I.removeClass(Q,"warning");}};}H.attachEvent(Q,"blur",this.validateFetchNum);},getFetchValue:function(){var R=parseInt(this.fetchNode.children[0].value,10),Q={valid:true,value:R};if(isNaN(R)||R>L||R<=0){Q.valid=false;Q.value=100;}return Q;},getSearchQuery:function A(){return this.searchFieldNode.value;},updateLayout:function K(){I.addClass(this.blockNode,"top");I.addClass(this.signoutNode,"top");I.removeClass(this.blockNode,"center");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var Z=mstrmojo.css,F=mstrmojo.dom;var a={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function A(){var d=this.value,c=this.inputNode,e=c.value,b=(d!==null&&d!==undefined)?String(d):"";if(b!==e&&(!this.keepEmpty||e!==this.emptyText)){c.value=b;}if(c.mstrmojoEmpty){Z.removeClass(c,[this.emptyClass]);c.mstrmojoEmpty=null;}}function Y(){var b=this.inputNode;b.value=this.emptyText||"";Z.addClass(b,[this.emptyClass]);b.mstrmojoEmpty=true;}function N(){var b=this.inputNode;if(b){this.readingDom=true;this.set("value",b.value);this.readingDom=false;}}function V(b){var c=this;if(b===-1){N.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete c._lastTimeoutId;N.call(c);},b||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,spellCheck:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown,mousedown  tstid="{@tstid}"/>',markupSlots:{inputNode:function D(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function S(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function O(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function E(){var b=this.inputNode;b.disabled=!this.enabled;Z.toggleClass(b,"disabled",!this.enabled);},onvalueChange:function P(){var b=this.value,c=(b===undefined)||(b===null)||(b==="");if(c){if(!this.hasFocus){Y.call(this);}else{this.inputNode.value="";}}else{A.call(this);}if(F.isIE9){this.inputNode.type=c?"text":this.type;}},ontooltipChange:function R(){this.domNode.title=this.tooltip;},onreadOnlyChange:function H(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function B(){Z.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function W(){this._super();var b=this.inputNode;b.setAttribute("autocomplete",this.autoComplete?"on":"off");b.setAttribute("autocorrect",this.autoCorrect?"on":"off");b.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");b.setAttribute("spellcheck",this.spellCheck?"true":"false");},focus:function Q(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(b){}}},prefocus:function M(){this.hasFocus=true;A.call(this);},blur:function U(){this.inputNode.blur();},preblur:function X(){window.setTimeout(function(){},200);this.hasFocus=false;N.call(this);var b=this.value;if(((b===null||b==="")&&this.emptyText)||(this.keepEmpty&&b===this.emptyText)){Y.call(this);}},prekeyup:function I(c){var b=c.hWin,d=c.e||b.event;V.call(this,this.valueChangeDelay);var f=a[d.keyCode];if(this["on"+f]){this["on"+f](c);}},preinput:function J(){V.call(this,this.valueChangeDelay);},prepaste:function K(){V.call(this);},precut:function G(){V.call(this);},setInvalidState:function C(b){this.set("textValid",false);if(b){this.domNode.setAttribute("title",b);}},cleanUp:function L(){this.inputNode.value="";this.set("textValid",true);this.domNode.setAttribute("title",this.tooltip);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo._CanRenderChildrenOnShow");var A=mstrmojo.array;mstrmojo.StackContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._CanRenderChildrenOnShow],{scriptClass:"mstrmojo.StackContainer",isStack:true,markupString:'<div id="{@id}" class="mstrmojo-StackContainer {@cssClass}" style="{@cssText}"></div>',markupMethods:{onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}},onborderChange:function(){this.domNode.style.border=this.border||"";},onbackgroundChange:function(){this.domNode.style.background=this.background||"";}},markupSlots:{containerNode:function(){return this.domNode;}},_set_selected:function D(H,F){var G=this.selected;if(G===F){return false;}if(G){G.set("visible",false);}this.selected=F;if(F){F.set("visible",true);}return true;},addChildren:function B(J,G,H){var K=this.selected,L;for(var I=0,F=(J&&J.length)||0;I<F;I++){L=J[I];if(L&&L.set){L.set("visible",L===K);}}return this._super(J,G,H);},removeChildren:function C(H,F){var G=this._super(H,F);if(!H||(H===this.selected)){this.set("selected",null);}return G;},destroy:function E(F){this._super(F);this.selected=null;},renderMode:"onshow"});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.Refine.FileSaver");mstrmojo.requiresDescs(14184,2177,2400,3474,14243);var E=mstrmojo.dom;mstrmojo.Refine.RefineExtractDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineExtractDialog",markupString:'<div id="{@id}" class="refine-extract-dialog"><div class="refine-extract-dialog-header">'+mstrmojo.desc(14184,"Extract History Script")+'</div><div class="refine-extract-dialog-body"><div class="refine-extract-dialog-left"><div class="refine-extract-dialog-entries"></div></div><div class="refine-extract-dialog-input"></div></div><div class="refine-extract-dialog-footer"><div class="refine-extract-dialog-close"></div><div class="refine-extract-dialog-save"></div><div class="refine-clustering-dialog-selectall"></div><div class="refine-clustering-dialog-unselectall"></div></div><div class="refine-dialog-curtain" style="display: block"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},entriesNode:function(){return this.domNode.children[1].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[1];},closeNode:function(){return this.domNode.children[2].children[0];},saveNode:function(){return this.domNode.children[2].children[1];},selectAllNode:function(){return this.domNode.children[2].children[2];},unselectAllNode:function(){return this.domNode.children[2].children[3];},curtainNode:function D(){return this.domNode.lastChild;}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=-1;}},getMovingHandle:function F(){return this.headerNode;},getMovingTarget:function G(){return this.editorNode;},preBuildRendering:function B(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},postBuildRendering:function C(){this.operations=this.controller.model.getCurrentOperations();this.entriesTable.populateData(this.operations);this.updateJson(this.operations);return this._super();},updateJson:function A(J){var H=[];for(var I=0;I<J.entries.length;I++){var K=J.entries[I];if("operation" in K&&K.selected){H.push(K.operation);}}this.textArea.set("value",JSON.stringify(H,null,2));},children:[{scriptClass:"mstrmojo.Table",slot:"entriesNode",alias:"entriesTable",populateData:function(I){if(!I.entries.length){return ;}this.removeChildren();this.unrender();this.rows=I.entries.length;this.cols=2;var J;var H={scriptClass:"mstrmojo.CheckBox",oncheckedChange:function(){this.entry.selected=this.checked;this.parent.parent.updateJson(I);}};var L={scriptClass:"mstrmojo.Label"};for(J=0;J<this.rows;J++){var K=I.entries[J];H.slot=J+",0";H.entry=K;H.checked=K.selected;this.addChildren(H);L.slot=J+",1";L.text=K.description;this.addChildren(L);}this.render();this.updateCellClass();},updateCellClass:function(){var I=this.domNode.firstChild.children;var J=I[0];var H=J.children;H[0].className="refine-extract-checkbox";H[1].className="refine-extract-text";}},{scriptClass:"mstrmojo.TextArea",slot:"inputNode",alias:"textArea",maxLength:undefined},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"close",slot:"closeNode",text:mstrmojo.desc(2177,"Close"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"save",slot:"saveNode",text:mstrmojo.desc(2400,"Save"),bindings:{visible:function(){return mstrApp.isSingleTier||!mstrmojo.dom.isSafari;}},onclick:function(){if(mstrApp.isSingleTier||mstrApp.isWorkstation){window.FormWrapper.saveDWHistoryList(this.parent.textArea.value);}else{mstrmojo.Refine.FileSaver.saveTextAs(this.parent.textArea.value,"Data Wrangling Script.txt");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"selectAll",slot:"selectAllNode",visible:false,text:mstrmojo.desc(3474,"Select All"),onclick:function(){var H=this.parent.operations;for(var I=0;I<H.entries.length;I++){var J=H.entries[I];J.selected=true;}this.parent.entriesTable.populateData(H);this.parent.updateJson(H);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"unselectAll",slot:"unselectAllNode",visible:false,text:mstrmojo.desc(14243,"Unselect All"),onclick:function(){var H=this.parent.operations;for(var I=0;I<H.entries.length;I++){var J=H.entries[I];J.selected=false;}this.parent.entriesTable.populateData(H);this.parent.updateJson(H);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(1064,1825,13252,12813,12814,13142,13143,2121,14135,12741,14142,14622,14623,14792,14793,15339);var X=mstrmojo.DI.DIConstants,F=mstrmojo.dom,K=mstrmojo.array,V=mstrmojo.css,Q=mstrmojo.func,H=mstrmojo.DI.DIHelpers,A=4*1024*1024,U=4*1024*1024*1024;var J={scriptClass:"mstrmojo.Container",slot:"tableNode",cssClass:"",markupString:"<div class='mstrmojo-FileDragDropBox-file {@cssClass}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},deleteNode:function(){return this.domNode.children[0];},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];}},name:"",isFailed:false,children:[{scriptClass:"mstrmojo.Label",alias:"fileName",slot:"contentNode",cssClass:"mstrmojo-FileDragDropBox-file-name"},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-file-delete-button",innerIconClass:"close-button"},{slot:"imageNode",alias:"fileImg",cssClass:"mstrmojo-FileDragDropBox-file-img",scriptClass:"mstrmojo.Label"}],preBuildRendering:function(){if(this._super){this._super();}this.fileName.set("text",this.name);},onclick:function(c){var d=this;var a=c.e.srcElement||c.e.target,Z=this.parent;if(a.className!=="mstrmojo-Button-text close-button"){return ;}var b=function(){var g=-1,h;var j=Z.files;if(!d.isFailed){for(h=0;h<j.length;h++){if(!H.isOnetier()){if(j[h].name===d.name){g=h;break;}}else{if(j[h]===d.file){g=h;break;}}}if(g>=0){j.splice(g,1);}if(!(H.isOnetier()||H.isWS())){Z.fileNode.value="";}Z.set("files",j);}else{if(--Z.failedFilesCount<0){Z.failedFilesCount=0;}if(!(H.isOnetier()||H.isWS())){Z.fileNode.value="";}}Z.removeChildren(d);};var e=this.tableID;if(e){var Y={success:function(g){if(g&&g.msgid){mstrApp.getRootController().dataService.set("messageID",g.msgid);}mstrApp.getRootController().model.resetImportSource(e);b();},failure:function(){mstrApp.getRootController().displayError(mstrmojo.desc(13142,"Delete file error."));}};var f={did:this.tableID,progressText:mstrmojo.desc(13143,"Deleting file...")};mstrApp.getRootController().removeEMMASourceTable(Y,f);}else{b();}}};var N={scriptClass:"mstrmojo.Container",slot:"tableNode",cssClass:"",markupString:"<div class='mstrmojo-url-list {@cssClass}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},deleteNode:function(){return this.domNode.children[0];},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];}},allowEdit:true,url:"",dbr:"",children:[{slot:"contentNode",alias:"text",cssClass:"urlItem-text-div",scriptClass:"mstrmojo.InlineEditBox",rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){this.parent.set("url",this.inputNode.value);this.parent.parent.raiseEvent({name:"urlChanged",src:this,url:this.url});},bindings:{text:"this.parent.url"}},{slot:"contentNode",scriptClass:"mstrmojo.Label",cssClass:"urlItem-dbrole",bindings:{text:"this.parent.dbr"}},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-url-delete-button",innerIconClass:"close-button"},{slot:"imageNode",alias:"fileImg",cssClass:"mstrmojo-FileDragDropBox-file-img",scriptClass:"mstrmojo.Label"}],onclick:function(b){var e=this;var Z=b.e.srcElement||b.e.target;if(Z.className!=="mstrmojo-Button-text close-button"){return ;}var c;var a=function(){var h=e.parent.urls;var g=e.parent.dbrs;for(c=0;c<h.length;c++){if(h[c]===e.url){if(e.parent.urlTableID){delete e.parent.urlTableID[h[c]];}h.splice(c,1);if(g&&g.length>c){g.splice(c,1);}break;}}e.parent.set("urls",h.concat());e.parent.removeChildren(e);};var d=this.tableID;if(this.tableID){var Y={success:function(g){if(g&&g.msgid){mstrApp.getRootController().dataService.set("messageID",g.msgid);}mstrApp.getRootController().model.resetImportSource(d);a();},failure:function(){mstrApp.getRootController().displayError(mstrmojo.desc(13142,"Delete file error."));}};var f={did:this.tableID,progressText:mstrmojo.desc(13143,"Deleting file...")};mstrApp.getRootController().removeEMMASourceTable(Y,f);}else{a();}}};function G(c){var Z=mstrApp.getRootController(),a=c.size,b=c.name.split("."),Y;if(a===0){Z.displayError(mstrmojo.desc(13252,"The import process cannot proceed with an empty file"));return false;}if(a>U&&!H.isOnetier()){Z.displayError(mstrmojo.desc(14792,"Files larger than 4GB are only supported through Data from URL connector"),false,mstrmojo.desc(14793,'The "File from Disk" connector only allows users to upload files that are upto 4GB in size. For files that are larger, please place the file on a webserver or a network location and use the "Data from URL" connector to access the file.'));return false;}Y=b[b.length-1].toLowerCase();if(a%4096===0&&!c.type&&!(Y==="sas7bdat"||Y==="xls")){Z.displayError(mstrmojo.desc(14135,"The import process cannot proceed with a folder"));return false;}return true;}function E(Z){var d=this.files,b=0,e;var a=this.parent.operationMode;var c=mstrApp.getRootController().model;var f=this.parent.currentSource||c.currentSource;var g=f&&f.sourceInfo.partition;if(a!==X.operationMode.create&&!c.isAddingNewTable){this.removeChildren();d=[];this.failedFilesCount=0;}for(b=0;b<Z.length;b++){if(G(Z[b])){d.push(Z[b]);var Y=mstrmojo.DI.DIHelpers.truncate(Z[b].name,60,true);J.name=Y;e=this.addChildren(mstrmojo.insert(J));e.render();}}this.set("files",d);this.textNode.style.display="none";}mstrmojo.DI.FileDragDropBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.FileDragDropBox",action:mstrConfig.taskURL,markupString:'<div ><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="{@action}"><div class="mstrmojo-di-fileHolder {@cssClass}" mstrAttach:dragover,dragleave,drop,click><div class="mstrmojo-FileDragDropBox-text {@textcssClass}">{@text}</div><div class="mstrmojo-FileDragDropBox-content {@maxHeight}"></div><div class="mstrmojo-FileDragDropBox-count"></div></div><div class="mstrmojo-di-dragLabel">{@descriptor}<div class="or">'+mstrmojo.desc(1064,"or")+'</div></div><div class="mstrmojo-FileDragDropBox-buttonDiv"><div class="mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton hot file-button"><div class="mstrmojo-Button-text">{@browseLabel}</div></div><div><input class="mstrmojo-FileUploadBox-file" id="file'+this.id+'upload" type="file" accept=".csv,.txt,.xlsx,.xls,.json,.sas7bdat,.tsv,.prn" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synFile();"/><label for="file'+this.id+'upload" style="width:100px;height:30px;position:absolute;opacity:0;">hackForNoFileChosenTooltip</label></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},dnDNode:function(){return this.domNode.firstChild.children[0];},textNode:function(){return this.domNode.firstChild.children[0].children[0];},tableNode:function(){return this.domNode.firstChild.children[0].children[1];},countNode:function(){return this.domNode.firstChild.children[0].children[2];},dragLabelNode:function(){return this.domNode.firstChild.children[1];},buttonNode:function(){return this.domNode.firstChild.children[2];},inputNode:function(){return this.domNode.firstChild.children[2].lastChild;},fileNode:function(){return this.domNode.firstChild.children[2].lastChild.firstChild;},paramsNode:function(){return this.domNode.firstChild.children[3];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.buttonNode.style.display=this.fileUpload?"block":"none";this.textNode.style.display=this.fileUpload?"block":"none";this.dragLabelNode.style.display=this.fileUpload?"block":"none";}},visible:true,files:[],failedFilesCount:0,urls:[],dbrs:[],allFileNode:[],fileFieldName:"myFile",descriptor:mstrmojo.desc(15339,"Drag and drop files here"),text:mstrmojo.desc(12691,"Data can be in crosstab or tabular format"),browseLabel:mstrmojo.desc(13865,"Choose files"),multiple:"",droppable:true,fileUpload:true,jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",adjustSize:function C(Z){if(Z.urlpage){this.dnDNode.style.width=Z.w;this.dnDNode.style.height=Z.h;return ;}var a=parseInt(Z.w,10);var Y=parseInt(Z.h,10);if(isNaN(a)){return ;}this.dnDNode.style.width=a-60+"px";if(!!mstrApp.isWorkstation){this.dnDNode.style.height=Y-105-(X.workstation.utils.shouldShowTitleBar()?35:0)+"px";this.buttonNode.style.top=Y-160+"px";}this.dragLabelNode.style.width=a+"px";this.buttonNode.style.left=a/2-(this.buttonNode.clientWidth/2+10)+"px";},init:function O(Y){this._super(Y);if(!!mstrApp.isWorkstation&&!mstrApp.isPopup){this.set("maxHeight","maxHeightStandLone");}else{if(!!mstrApp.isWorkstation&&!!mstrApp.isPopup){this.set("maxHeight","maxHeightEmbed");}}},postCreate:function(){if(this._super){this._super();}this.files=[];this.urls=[];this.dbrs=[];if((H.isOnetier()||H.isWS())){this.set("text","");this.set("droppable",false);}if(F.isIE){if(F.isIE8||F.isIE9){this.set("droppable",false);this.cssClass=this.cssClass+" solid";}}},postBuildRendering:function R(){if(this._super){this._super();}F.detachEvent(this.fileNode,"mouseover",this.onmouseover);F.detachEvent(this.fileNode,"mouseout",this.onmouseout);F.attachEvent(this.fileNode,"mouseover",this.onmouseover);F.attachEvent(this.fileNode,"mouseout",this.onmouseout);F.detachEvent(this.fileNode,"mousedown",this.onmousedown);F.detachEvent(this.fileNode,"mouseup",this.onmouseup);F.attachEvent(this.fileNode,"mousedown",this.onmousedown);F.attachEvent(this.fileNode,"mouseup",this.onmouseup);if(!!mstrApp.isWSStyling){V.addClass(this.dnDNode,"solid");}},onmouseover:function I(Y){var a=F.eventTarget(window,Y),b=F.findWidget(a),Z=b.buttonNode.firstChild;V.addClass(Z,"hover");V.removeClass(Z,"active");},onmouseout:function D(Y){var a=F.eventTarget(window,Y),b=F.findWidget(a),Z=b.buttonNode.firstChild;V.removeClass(Z,"hover");},onmousedown:function W(Y){var a=F.eventTarget(window,Y),b=F.findWidget(a),Z=b.buttonNode.firstChild;V.addClass(Z,"active");V.removeClass(Z,"hover");},onmouseup:function L(Y){var a=F.eventTarget(window,Y),b=F.findWidget(a),Z=b.buttonNode.firstChild;V.removeClass(Z,"active");},ondragover:function M(Y){if(!this.droppable){return ;}Y.e.stopPropagation();Y.e.preventDefault();mstrmojo.css.addClass(this.dnDNode,"dragging");mstrmojo.css.addClass(this.dragLabelNode,"dragging");},ondragleave:function B(){if(!this.droppable){return ;}this.className="";mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dragLabelNode,"dragging");},ondrop:function S(h){if(!this.droppable){return ;}var c=h.e;c.preventDefault();var Y=c.dataTransfer.files;mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dragLabelNode,"dragging");if(Y){var b=mstrApp.getRootController().model,Z=b.operationMode;var d=this.parent.currentSource||b.currentSource;var f=d&&d.sourceInfo.partition;if(Y.length>1&&Z!==X.operationMode.create&&(!f||!f.isPartition&&!b.isAddingNewTable)){var g=this.parent.parent.headerNode;var a=mstrmojo.dom.position(g);mstrmojo.notify(mstrmojo.desc(12741,"You can upload only one file when refresh a table."),{top:a.y+a.h+"px"});}else{E.call(this,Y);}}},synFile:function(){var b=[],d;F.detachEvent(this.fileNode,"mouseover",this.onmouseover);F.detachEvent(this.fileNode,"mouseout",this.onmouseout);F.detachEvent(this.fileNode,"mousedown",this.onmousedown);F.detachEvent(this.fileNode,"mouseup",this.onmouseup);var Y=this.buttonNode.removeChild(this.inputNode);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){b=this.fileNode.files;}else{try{var c=new ActiveXObject("Scripting.FileSystemObject");d=c.getFile(this.fileNode.value);var Z={size:d.size,name:d.name,fileNode:Y};b.push(Z);}catch(a){mstrApp.getRootController().displayError(mstrmojo.desc(14142,"Please enable ActiveX and put our website to the trust list to upload the file.Please try using Chrome, Firefox if you are still having problem with Internet Explorer."));}}if(b&&b.length>0){E.call(this,b);}this.inputNode=document.createElement("div");this.inputNode.innerHTML='<input class="mstrmojo-FileUploadBox-file" id="file'+this.id+'upload" type="file" accept=".csv,.txt,.xlsx,.xls,.json,.sas7bdat,.tsv,.prn"'+this.multiple+' size="30" style="font-size:4em;" name='+this.fileFieldName+' onchange="mstrmojo.all.'+this.id+'.synFile();"/>                 <label for="file'+this.id+'upload" style="width:100px;height:30px;position:absolute;opacity:0;">hackForNoFileChosenTooltip</label>';this.fileNode=this.inputNode.firstChild;this.buttonNode.appendChild(this.inputNode);F.attachEvent(this.fileNode,"mouseover",this.onmouseover);F.attachEvent(this.fileNode,"mouseout",this.onmouseout);F.attachEvent(this.fileNode,"mousedown",this.onmousedown);F.attachEvent(this.fileNode,"mouseup",this.onmouseup);},_set_urls:function(Z,Y){this.urls=Y||[];this.toggleBorderSolid(this.files.length||this.urls.length);return true;},_set_files:function(Z,Y){this.files=Y||[];this.toggleBorderSolid(this.files.length||this.urls.length);return true;},addURL:function(Z){var a=this.urls||[];N.url=Z;N.dbr="";var Y=this.addChildren(mstrmojo.insert(N));Y.render();a.push(Z);this.set("urls",a);},addAuthURL:function(a,b){var c=this.urls||[];var Z=this.dbrs||[];N.url=a;N.dbr=b.n;var Y=this.addChildren(mstrmojo.insert(N));Y.render();c.push(a);Z.push(b);this.set("urls",c);this.set("dbrs",Z);},addFile:function P(Y,Z){var a=this.files||[];J.name=Y;J.file=Z;var b=this.addChildren(mstrmojo.insert(J));b.render();a.push(Z);this.set("files",a);this.textNode.style.display="none";},submit:function(Z,k,d){if(H.isOnetier()){mstrApp.showProgress();mstrApp.getRootController().oneTierImportFile(k,mstrmojo.hash.copy(Z,{datasource:this.files[Z.__index],dict:X.backendSourceSubtype.localFile}));return ;}if(d.showProgress){mstrApp.showProgress(d);}function l(m){var n=[];n.push(m.target.result);var h=new Blob(n);mstrApp.upload(k,Z,h,d);}function a(h){var m={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(k.failure){k.failure(h||m);}if(k.complete){k.complete();}}var b=true;if(this.onsubmit){b=this.onsubmit();}if(b){Z=Z||{};Z.fileFieldName=this.fileFieldName;Z.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){d=mstrmojo.hash.copy(d,{async:true});if(this.params){Z=this.params;}if(Z.__index!==undefined){(function(o){var m=o.name,p;function h(){var q,t;Z.fileName=m;Z.index++;q=Math.min(o.size,p+A);t=o.slice(p,q);if(Z.index===Z.numberOfChunks){mstrApp.upload(k,Z,t,d);}else{mstrApp.upload({success:function(){p=p+A;h();},failure:function(u){a(u);}},Z,t,d);}}if(o.size>A){var n=Math.ceil(o.size/A);p=0;Z.index=0;Z.numberOfChunks=n;Z.chunkSize=A;Z.fileSize=o.size;Z.fileType="application/octet-stream";mstrApp.upload({success:function(){h();},failure:function(q){a(q);}},Z,null,d);}else{Z.fileName=m;mstrApp.upload(k,Z,o.slice(0,o.size),d);}})(this.files[Z.__index]);}else{var f;for(f=0;f<this.files.length;f++){var e=this.files[f];var Y=e.name;var j=new FileReader();Z.fileName=Y;j.onload=l;j.readAsArrayBuffer(e);}}}else{Z.taskEnv="jsonp2";var g=[],c;for(c in Z){g.push('<input type="hidden" name="'+c+'" value="'+mstrmojo.string.encodeHtmlString(Z[c].toString())+'"/>');}if(this.params){Z=this.params;for(c in Z){g.push('<input type="hidden" name="'+c+'" value="'+mstrmojo.string.encodeHtmlString(Z[c])+'"/>');}}this.buttonNode.removeChild(this.inputNode);this.buttonNode.appendChild(this.files[Z.__index].fileNode);this.inputNode=this.buttonNode.lastChild;this.paramsNode.innerHTML=g.join("");if(k){this.onSuccess=k.complete?Q.composite([k.success,k.complete]):k.success;this.onFailed=k.complete?Q.composite([k.failure,k.complete]):k.failure;}this.formNode.submit();}this.set("status","loading");}},uploadCallback:function(Z){var Y=(Z.status===200);if(Y&&this.onSuccess){this.onSuccess(Z);}if(!Y&&this.onFailed){this.onFailed(Z);}},preBuildRendering:function(){if(this._super){this._super();}this.attachEventListener("urlChanged",this.id,"updateURLs");},getFilesCnt:function(){var Y=0;if(this.files){Y=this.files.length;}return Y;},getFileName:function(Y){var Z="";if(Y<this.files.length){if(H.isOnetier()){Z=this.files[Y];}else{Z=this.files[Y].name;}}return Z;},getFileTableID:function(Y){if(this.urls&&Y<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[Y]];}if(this.files&&Y<this.files.length){return this.files[Y].tableID;}return null;},updatePageConfig:function(b){var d,Z,a;var l=[];var g=b.properties.tableID;var e=b.properties.model.importSources[g],f,j=[],c,k,h=this;if(b.name&&b.properties&&b.properties.sourceSubtype===X.sourceSubtype.localFile){l=[];for(d=0;this.children&&d<this.children.length;d++){Z=this.children[d];if(Z.domNode&&Z.domNode.parentNode===this.tableNode){l.push(Z);}}a=l.length;for(d=0;d<a;d++){this.removeChildren(l[d]);}this.set("files",[]);b=mstrmojo.hash.copy(b,mstrmojo.hash.copy(J));if(this.parent.getOperationMode()!==X.operationMode.create){b.cssClass="fake";}if(!H.isOnetier()){this.set("files",[{name:b.properties.currentSource.fileName,tableID:b.properties.tableID}]);}else{b.file=b.name;this.set("files",[b.name]);}this.addChildren([mstrmojo.insert(b)]);mstrmojo.css.toggleClass(this.dnDNode,"refresh",this.parent.getOperationMode()===X.operationMode.edit);mstrmojo.css.toggleClass(this.buttonNode,"refresh",this.parent.getOperationMode()===X.operationMode.edit);this.textNode.style.display="none";}if(b.properties&&b.properties.sourceSubtype===X.sourceSubtype.url){l=[];var Y;if(e){Y=e.sourceInfo.url;}for(d=0;this.children&&d<this.children.length;d++){Z=this.children[d];if(Z.domNode&&Z.domNode.parentNode===this.tableNode){l.push(Z);}}a=l.length;for(d=0;d<a;d++){this.removeChildren(l[d]);}this.set("urls",[]);f=e&&e.sourceInfo.partition;if(f&&f.isPartition){K.forEach(f.tables,function(m){j.push(m.name);});}else{if(Y){j.push(Y);}}if(j.length>0){this.set("visible",true);k=(this.parent.getOperationMode()!==X.operationMode.create)?"fake":"";K.forEach(j,function(m){c=mstrmojo.hash.copy(b,mstrmojo.hash.copy(N));c.url=m;c.cssClass=k;h.addChildren([mstrmojo.insert(c)]);});this.urlTableID={};}}},setFilesObject:function(b){var a,d,Z;var c=[],Y=mstrmojo.hash.copy(J,{});for(a=0;this.children&&a<this.children.length;a++){d=this.children[a];if(d.domNode&&d.domNode.parentNode===this.tableNode){c.push(d);}}Z=c.length;for(a=0;a<Z;a++){this.removeChildren(c[a]);}this.set("files",[]);for(a=0;b&&a<b.length;a++){Y.name=b[a];Y.isFailed=true;this.addChildren([mstrmojo.insert(Y)]);}this.failedFilesCount=b?b.length:0;},setURLsObject:function(a){var Z,c,Y;var b=[];for(Z=0;this.children&&Z<this.children.length;Z++){c=this.children[Z];if(c.domNode&&c.domNode.parentNode===this.tableNode){b.push(c);}}Y=b.length;for(Z=0;Z<Y;Z++){this.removeChildren(b[Z]);}for(Z=0;Z<a.length;Z++){N.url=a[Z];this.addChildren([mstrmojo.insert(N)]);}this.set("urls",a);},onclick:function(Z){var Y=Z.e.srcElement||Z.e.target;var b,a=0,c;if(Y.className!=="mstrmojo-Button-text close-button"){return ;}for(b=0;this.children&&b<this.children.length;b++){c=this.children[b];if(c.domNode&&c.domNode.parentNode===this.tableNode){a++;}}if(a===0&&this.fileUpload){this.textNode.style.display="block";}},getURLCnt:function(){if(this.urls){return this.urls.length;}else{return 0;}},updateItemsCount:function(Y){if(Y>1){this.countNode.style.display="block";V.toggleClass(this.countNode,"countPosition",mstrApp.getRootController().rootView.currentPage.pageType===X.pageType.file);}else{this.countNode.style.display="none";}this.countNode.textContent=mstrmojo.desc(2121,"Total")+": "+Y;},onurlsChange:function(){this.updateItemsCount(this.getURLCnt());},onfilesChange:function(){this.updateItemsCount(this.getFilesCnt());},updateURLs:function(Y){var b=Y.src.children;var a=[],Z;for(Z=0;Z<b.length;Z++){a.push(b[Z].url);}this.set("urls",a);},toggleBorderSolid:function(Y){if(this.dnDNode){V.toggleClass(this.dnDNode,"solid",Y);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var E=function(){var G=this.opener;if(G.direction.toLowerCase()==="up"){this.domNode.style.top=-G.domNode.offsetHeight+"px";}};mstrmojo.DropDownButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DropDownButton",height:"",text:"",direction:"down",enabled:true,title:"",allowHTML:true,markupString:'<div id="{@id}" class="mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode">{@text}</div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:function(){this.boxNode.style.height=this.height||"";},ontextChange:function(){this.iconNode.innerHTML=this.getTextInnerHTML();},ontitleChange:function(){this.boxNode.title=this.title;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function C(){if(this._super){this._super();}var G=this.popupRef;if(G){if(G.nudge){G.nudge=mstrmojo.func.composite([G.nudge,E]);}else{if(this.direction.toLowerCase()!=="down"){G.nudge=E;}}}},popupRef:null,popupOpenConfig:null,destroy:function D(G){var H=this.popupRef;if(H&&H.hasRendered){H.destroy(false);}if(this._super){this._super(G);}},togglePopup:function F(){var G=this._lastOpened;if(G&&G.visible){this.closePopup();}else{this.openPopup("popupRef",this.popupOpenConfig);}},premousedown:function A(G){this.togglePopup();},getTextInnerHTML:function B(){return this.allowHTML?this.text:mstrmojo.string.encodeHtmlString(this.text);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.css,G=mstrmojo.dom;mstrmojo.Refine.RefineTagBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Refine.RefineTagBox",markupString:'<div id="{@id}" class="refine-tag-box-container {@cssClass}" style="{@cssText}"><div class="refine-tag-box"></div></div>',markupSlots:{boxNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function C(){var H={scriptClass:"mstrmojo.Refine.RefineTagBoxNew",slot:"boxNode"};this.inputBox=this.addChildren(H);return this._super();},setupScrollNodes:function D(){this.scrollNode=this.boxNode;},onaddChild:function B(){if(this.children.length>1){this.inputBox.input.emptyText="";A.toggleClass(this.inputBox.input.domNode,"short",true);}},onremoveChild:function(H){var J=H.value;for(var I=0;I<J.length;I++){J[I].destroy();}this.updateScrollbars();if(this.children.length===1){this.inputBox.input.emptyText=mstrmojo.desc(14518,"Press Enter Key to input multiple keywords");A.toggleClass(this.inputBox.input.domNode,"short",false);}},removeTags:function E(){for(var H=this.children.length-2;H>=0;H--){this.removeChildren(this.children[H]);}}});mstrmojo.Refine.RefineTagBoxNew=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxNew",markupString:'<div id="{@id}" class="refine-tag-box-new {@cssClass}" style="{@cssText}" mstrAttach:keydown></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},children:[{scriptClass:"mstrmojo.TextBox",alias:"input",slot:"domNode",cssClass:"refine-tag-box-new-input",useRichTooltip:true,tooltipOpenDelay:0,updateTooltipConfig:function(){var H=this.domNode.clientHeight;this.set("richTooltip",{refNode:this.domNode,cssClass:"vi-regular vi-tooltip-A",top:H,posType:mstrmojo.tooltip.POS_TOPLEFT,content:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords"),});},emptyText:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords")}],onkeydown:function F(L){var H=13;var J=8;var I={scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",slot:"boxNode"};if(L.e.keyCode===H){if(this.input.value){I.text=this.input.value;this.input.set("value","");this.parent.addChildren([I],this.parent.children.length-1);this.parent.updateScrollbars();}}else{if(L.e.keyCode===J&&this.input.value===""){var K=this.parent.children.length;if(K>1){var M=this.parent.children[K-2];this.parent.removeChildren(M);}}}}});mstrmojo.Refine.RefineTagBoxLabel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",markupString:'<div id="{@id}" class="refine-tag-box-label {@cssClass}" style="{@cssText}"><span class="refine-tag-box-label-text">{@text}</span><a class="refine-tag-box-close"><span class="refine-tag-box-icon" mstrAttach:click></span></div>',text:"",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];}},onclick:function(){this.parent.removeChildren(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.Checkbox","mstrmojo.dom");mstrmojo.requiresDescs(13189,2968,1095,11841,221,3474,14230,14231,14232,14233,14234,14235,11656,14236,14237,14238,14239,14240,14241,14242,14243);var A=mstrmojo.dom;mstrmojo.Refine.RefineClusteringDialog=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.Refine.RefineClusteringDialog",method:"binning",algorithm:"fingerprint",facets:[],columnName:"",markupString:'<div id="{@id}" class="refine-clustering-dialog mojo-theme-light"><div class="refine-clustering-dialog-header"></div><div class="refine-clustering-dialog-body"><div class="refine-clustering-dialog-info"><div class="refine-clustering-dialog-algorithm"></div><div class="refine-clustering-dialog-count"></div></div><div class="refine-clustering-dialog-table"></div></div><div class="refine-clustering-dialog-footer"><div class="refine-clustering-dialog-cancel"></div><div class="refine-clustering-dialog-merge"></div><div class="refine-clustering-dialog-mergeandredo"></div><div class="refine-clustering-dialog-selectall"></div><div class="refine-clustering-dialog-unselectall"></div></div><div class="refine-clustering-dialog-overlay"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.firstChild;},algorithmNode:function(){return this.domNode.children[1].children[0].children[0];},countNode:function(){return this.domNode.children[1].children[0].children[1];},tableNode:function(){return this.domNode.children[1].children[1];},cancelNode:function(){return this.domNode.children[2].children[0];},mergeNode:function(){return this.domNode.children[2].children[1];},mergeandredoNode:function(){return this.domNode.children[2].children[2];},selectAllNode:function(){return this.domNode.children[2].children[3];},unselectAllNode:function(){return this.domNode.children[2].children[4];}},markupMethods:{onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},getMovingHandle:function D(){return this.headerNode;},getMovingTarget:function E(){return this.editorNode;},preBuildRendering:function B(){this.placeholder=document.body.appendChild(document.createElement("div"));return this._super();},postBuildRendering:function C(){this.cluster();return this._super();},cluster:function(){var F={engine:this.controller.model.engine,clusterer:JSON.stringify({type:this.method,"function":this.algorithm,column:this.columnName,params:{}})};this.controller.computeClusters(F);this.clustering.set("visible",true);this.noCluster.set("visible",false);this.clusterTable.set("visible",false);},handleClustersFetched:function(F){this.updateData(F.clusters);this.countNode.innerHTML=mstrmojo.desc(14234,"#### cluster(s) found").replace("####",this.clusters.length);},updateData:function(I){var N=[];var J,H;for(J=0;J<I.length;J++){var L=I[J];var O={edit:false,choices:L,value:L[0].v,size:L.length};var K=0;var P=0;var M=0;for(H=0;H<O.choices.length;H++){var G=O.choices[H];M+=G.c;var F=G.v.length;K+=F;P+=F*F;}O.rowCount=M;O.avg=K/O.choices.length;O.variance=Math.sqrt(P/O.choices.length-O.avg*O.avg);N.push(O);}this.clusters=N;this.updateAll();},updateAll:function(){this.renderTable(this.clusters);},renderTable:function(F){this.clustering.set("visible",false);if(F.length>0){this.clusterTable.populateData(F);this.clusterTable.set("visible",true);}else{this.noCluster.set("visible",true);}},apply:function(L){var K=this.clusters;var H=[],J,I;for(J=0;J<K.length;J++){var F=K[J];if(F.edit){var G=[];for(I=0;I<F.choices.length;I++){G.push(F.choices[I].v);}H.push({from:G,to:F.value});}}if(H.length>0){this.controller.MergeCluster({columnName:this.columnName,expression:"value",description:mstrmojo.desc(14279,"Edit Cell")+" ["+this.columnName+"] (#### "+mstrmojo.desc(2968,"Rows")+")",edits:JSON.stringify(H)},L);}else{mstrmojo.alert(mstrmojo.desc(13189,"You must check some checkboxes for your merges to be applied."));}},children:[{scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-refine-title",alias:"title",bindings:{text:function(){return mstrmojo.desc(14230,'Cluster & Edit column "####"').replace("####",this.parent.parent.columnName);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-close",onclick:function(){this.parent.parent.cancel.onclick();}}]},{scriptClass:"mstrmojo.HBox",slot:"algorithmNode",alias:"algorithmBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14231,"Algorithm")+": "},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"algorithm",items:[{n:mstrmojo.desc(14232,"Fingerprint"),algo:"fingerprint"},{n:mstrmojo.desc(14233,"Phonetic"),algo:"metaphone3"}],selectedIndex:0,onitemSelected:function(F){if(this.parent.parent.algorithm!==F.algo){this.parent.parent.algorithm=F.algo;this.parent.parent.cluster();}}}]},{scriptClass:"mstrmojo.Table",slot:"tableNode",cellCssClass:"refine-clustering-cell",alias:"clusterTable",populateData:function(P){this.removeChildren();this.unrender();this.rows=P.length+1;this.cols=5;var J=0,I;var K=[mstrmojo.desc(1095,"Merge")+"?",mstrmojo.desc(14235,"Cluster Size"),mstrmojo.desc(11656,"Row Count"),mstrmojo.desc(14236,"Values in Cluster"),mstrmojo.desc(14237,"New Cell Value")];var G={scriptClass:"mstrmojo.Label",cssClass:"refine-label"};for(I=0;I<this.cols;I++){G.slot=J+","+I;G.text=K[I];this.addChildren(G);}var O={scriptClass:"mstrmojo.ui.Checkbox",oncheckedChange:function(){this.cluster.edit=this.checked;}};var Q={scriptClass:"mstrmojo.TextBox",onvalueChange:function(){this.cluster.value=this.value;}};var F={scriptClass:"mstrmojo.Container",markupString:"<ul></ul>",markupSlots:{containerNode:function(){return this.domNode;}}};var L={scriptClass:"mstrmojo.Container",markupString:'<li><a title="'+mstrmojo.desc(14238,"Use this value")+'" mstrAttach:click>{@Text}</a><span class="refine-clustering-cell-rows">({@Count} '+mstrmojo.desc(2968,"Rows")+")</span></li>",markupSlots:{textNode:function(){return this.domNode.children[0];}},onclick:function(){var U=this.parent.row*5;var S=this.parent.row*5+4;this.parent.parent.children[U].set("checked",true);this.parent.parent.children[S].set("value",this.textNode.innerHTML);}};for(J=1;J<this.rows;J++){var R=P[J-1];O.slot=J+",0";O.cluster=R;this.addChildren(O);G.slot=J+",1";G.text=R.choices.length;this.addChildren(G);G.slot=J+",2";G.text=R.rowCount;this.addChildren(G);F.slot=J+",3";F.row=J;var M=new mstrmojo.Container(F);var N;for(N=0;N<R.choices.length;N++){var H=R.choices[N];L.slot="containerNode";L.Text=H.v;L.Count=H.c;M.addChildren(L);}this.addChildren(M);Q.slot=J+",4";Q.value=R.value;Q.cluster=R;this.addChildren(Q);}this.render();this.updateCellClass();},updateCellClass:function(){var G;var H=this.domNode.firstChild.children;var I=H[0];var F=I.children;for(G=0;G<5;G++){F[G].className="refine-clustering-header";}}},{scriptClass:"mstrmojo.Widget",alias:"noCluster",slot:"tableNode",markupString:'<div style="padding: 10px;"><div style="font-size: 130%; color: #333;">'+mstrmojo.desc(14239,"No clusters were found with the selected method")+'</div><div style="padding-top: 1em; font-size: 110%; color: #888;">'+mstrmojo.desc(14240,"Try selecting another method above or changing its parameters")+"</div></div>",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}},{scriptClass:"mstrmojo.Widget",slot:"tableNode",alias:"clustering",markupString:'<div style="padding: 10px; font-size: 130%; color: #888;">'+mstrmojo.desc(11841,"Clustering")+'... <img src="../javascript/mojo/css/images/Refine/small-spinner.gif"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",slot:"cancelNode",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"merge",slot:"mergeNode",text:mstrmojo.desc(14241,"Merge and Close"),onclick:function(){var F=this.parent;var G=function(){F.destroy();};this.parent.apply(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"mergeandredo",slot:"mergeandredoNode",text:mstrmojo.desc(14242,"Merge and Recluster"),onclick:function(){var F=this.parent;var G=function(){F.cluster();};this.parent.apply(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"selectAll",slot:"selectAllNode",text:mstrmojo.desc(3474,"Select All"),onclick:function(){var H=this.parent.clusterTable;var G=H.children.length;var F;for(F=5;F<G;F+=5){H.children[F].set("checked",true);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"unselectAll",slot:"unselectAllNode",text:mstrmojo.desc(14243,"Unselect All"),onclick:function(){var H=this.parent.clusterTable;var G=H.children.length;var F;for(F=5;F<G;F+=5){H.children[F].set("checked",false);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout");var D=' style="display:inline-block;vertical-align:middle;"';mstrmojo.ui.editors.controls.TwoColumnContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-TwoColumnProp {@cssClass}" style="{@cssText}"><div class="vi-col1"'+D+'></div><div class="divider"'+D+'></div><div class="vi-col2"'+D+"></div></div>",markupSlots:{col1Node:function C(){return this.domNode.firstChild;},dividerNode:function B(){return this.domNode.childNodes[1];},col2Node:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod},layoutConfig:{w:{col1Node:"40%",dividerNode:"5px",col2Node:"60%"},xt:true},shouldPropagateEnabled:true,col1Width:"40%",dividerWidth:"5px",col2Width:"60%",init:function F(G){this._super(G);var H=this.layoutConfig=JSON.parse(JSON.stringify(this.layoutConfig)),I=H.w;I.col1Node=this.col1Width;I.dividerNode=this.dividerWidth;I.col2Node=this.col2Width;},getControl:function E(G){return(this.children||[]).filter(function(H){return H.slot==="col"+G+"Node";})[0];}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var I=mstrmojo.css,G={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},E="sbClear",N="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,quickSearchForClear:false,showClearNode:true,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,focus,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+E+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+N+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){I.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}},ondisabledChange:function O(){var Q=this.disabled;I.toggleClass(this.domNode,"disabled",Q);if(this.inputNode){this.inputNode.disabled=Q;}}},clearNode:null,searchNode:null,isFocus:false,disabled:false,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function M(R){var Q=R.hWin,S=R.e||Q.event;this.updateSearch();var U=G[S.keyCode];if(this["on"+U]){this["on"+U](R);}},setClearIcon:function C(){var R=this.parent;if(!R){return ;}var Q=R.search&&R.search.searchNode,S=this.getSearchPattern(),U=(S.length===0);if(Q){I.toggleClass(this.searchNode,"clear",!U&&this.quickSearch);}},onEnter:function D(Q){this.onsearch(this.getSearchPattern());},onEsc:function A(Q){this.clearSearch();},getSearchPattern:function K(){return mstrmojo.string.trim(this.inputNode.value);},setSearchPattern:function K(Q){if(this.inputNode){this.inputNode.value=Q||"";this.updateSearch();}},preclick:function H(Q){var S=Q.getTarget(),R=S&&S.id;switch(R.replace(this.id,"")){case N:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case E:this.clearSearch();break;}},updateSearch:function B(){var R=this.getSearchPattern(),Q=(R.length===0),S=this.quickSearch;I.toggleClass(this.clearNode,"show",this.showClearNode&&!Q&&!S);I.toggleClass(this.searchNode,"clear",!Q&&S);I.toggleClass(this.domNode,"hasPattern",!Q);if(S||this.quickSearchForClear&&Q){this[Q?"clearSearch":"onsearch"](R);}},clearSearch:function L(){var Q=this.getSearchPattern();this.reset();this.onclear(Q);},onfocus:function P(){this.isFocus=true;I.addClass(this.domNode,"focus");},onblur:function J(){this.isFocus=false;I.removeClass(this.domNode,"focus");},reset:function F(){this.inputNode.value="";I.removeClass(this.clearNode,"show");I.removeClass(this.domNode,"hasPattern");I.removeClass(this.searchNode,"clear");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(1825,2121,12609,14216,14662);var M=mstrmojo.DI.DIConstants,K=mstrmojo.string;var A={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];},deleteNode:function(){return this.domNode.children[0];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},name:"",isFolder:"",children:[{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"item-delete",innerIconClass:"close-button",onclick:function(){}},{slot:"contentNode",alias:"text",cssDisplay:"inline-block",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}],preBuildRendering:function(){if(this._super){this._super();}this.fileName.text=this.name;},onclick:function(Q){var R=this;var O=Q.e.srcElement||Q.e.target;if(O.className!=="mstrmojo-Button item-delete"){return ;}var P=function(){var V=-1,W;var X=R.parent.files;var Y=[];for(W=0;W<X.length;W++){if(X[W].name===R.name){V=W;break;}}if(V>=0){X.splice(V,1);}R.parent.set("files",X);R.parent.removeChildren(R);};var S=this.tableID;if(S){var N={success:function(V){if(V&&V.msgid){mstrApp.getRootController().dataService.set("messageID",V.msgid);}mstrApp.getRootController().model.resetImportSource(S);P();},failure:function(V){mstrApp.getRootController().displayError(mstrmojo.desc(14662,"Delete file error."));}};var U={did:this.tableID,progressText:"Delting file..."};mstrApp.getRootController().removeEMMASourceTable(N,U);}else{P();}}};var I={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[2];},deleteNode:function(){return this.domNode.children[0];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},allowEdit:true,url:"",text:"",isFolder:"",dbr:"",children:[{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"item-delete",innerIconClass:"close-button",onclick:function(){}},{slot:"contentNode",alias:"text",cssClass:"item-content",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"contentNode",scriptClass:"mstrmojo.Label",cssClass:"urlItem-dbrole",bindings:{text:"this.parent.dbr"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}],onclick:function(Q){var U=this;var O=Q.e.srcElement||Q.e.target;if(O.className!=="mstrmojo-Button item-delete"){return ;}var R;var P=function(){var X=U.parent.urls;var W=U.parent.dbrs;for(R=0;R<X.length;R++){if(X[R]===U.url){if(U.parent.urlTableID){delete U.parent.urlTableID[X[R]];}X.splice(R,1);if(W&&W.length>R){W.splice(R,1);}break;}}if(X.length===0){U.parent.textNode.style.display="block";U.parent.imageNode.style.display="block";}U.parent.set("urls",X);U.parent.removeChildren(U);U.hideTooltip(Q,self);};var S=this.tableID;if(this.tableID){var N={success:function(W){if(W&&W.msgid){mstrApp.getRootController().dataService.set("messageID",W.msgid);}mstrApp.getRootController().model.resetImportSource(S);P();},failure:function(W){mstrApp.getRootController().displayError(mstrmojo.desc(14662,"Delete file error."));}};var V={did:this.tableID,progressText:"Deleting file..."};mstrApp.getRootController().removeEMMASourceTable(N,V);}else{P();}}};function E(P){var O=true;var N;if(P.size%4096===0){if(P.slice(0).size===0){mstrApp.getRootController().displayError(mstrmojo.desc(12609,"Error in importing the file. Please check the file being imported"));O=false;return O;}}return O;}mstrmojo.DI.FileDragDropBoxDnD=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.FileDragDropBoxDnD",markupString:'<div class="{@cssClass}"><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div class="mstrmojo-di-fileHolder drag-drop-box-dnd" mstrAttach:dragover,dragleave,drop,click,mouseenter,mouseleave><div class="mstrmojo-FileDragDropBox-count"></div><div class="di-dropbox-image"></div><div class="mstrmojo-FileDragDropBox-text">{@text}</div><div class="mstrmojo-FileDragDropBox-content"></div></div><div class="mstrmojo-FileDragDropBox-buttonDiv"><div class="mstrmojo-di-button primary-button">{@browseLabel}</div><input class="mstrmojo-FileUploadBox-file" type="file" {@multiple} size="30" style="font-size:4em;" name="{@fileFieldName}" onchange="mstrmojo.all.{@id}.synFile();"/></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupSlots:{formNode:function(){return this.domNode.firstChild;},dnDNode:function(){return this.domNode.firstChild.children[0];},countNode:function(){return this.domNode.firstChild.children[0].children[0];},imageNode:function(){return this.domNode.firstChild.children[0].children[1];},textNode:function(){return this.domNode.firstChild.children[0].children[2];},tableNode:function(){return this.domNode.firstChild.children[0].children[3];},buttonNode:function(){return this.domNode.firstChild.children[1];},fileNode:function(){return this.domNode.firstChild.children[1].lastChild;},paramsNode:function(){return this.domNode.firstChild.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.buttonNode.style.display=this.fileUpload?"block":"none";this.textNode.style.display="block";}},visible:true,files:[],urls:[],dbrs:[],folders:{},fileFieldName:"myFile",text:mstrmojo.desc(14216,"Drop files here"),browseLabel:mstrmojo.desc(1825,"Browse"),multiple:"",droppable:true,fileUpload:true,dropZone:true,allowDrop:function F(N){return true;},jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",postCreate:function(){if(this._super){this._super();}this.files=[];this.urls=[];this.dbrs=[];},onmouseenter:function J(){mstrmojo.css.addClass(this.dnDNode,"hover");},onmouseleave:function B(){mstrmojo.css.removeClass(this.dnDNode,"hover");},ondragenter:function H(){mstrmojo.css.addClass(this.dnDNode,"dragging");mstrmojo.css.addClass(this.dnDNode,"hover");},ondragover:function D(){if(!this.droppable){return ;}},ondragleave:function L(){if(!this.droppable){return ;}this.className="";mstrmojo.css.removeClass(this.dnDNode,"dragging");mstrmojo.css.removeClass(this.dnDNode,"hover");},ondrop:function G(N){if(!this.droppable){return ;}var P=N.src.data,O;for(O=0;O<P.length;O++){this.addURL(P[O].data.address,P[O].text);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},_set_urls:function(O,N){this.urls=N||[];return true;},addURL:function(Q,V,P,O,R){if(mstrmojo.string.isEmpty(Q)){return ;}if(mstrmojo.string.isEmpty(V)){return ;}if(this.urls.indexOf(Q)>-1){return ;}var U=this.urls||[];var N=this.dbrs||[];I.url=Q;I.text=V;I.useRichTooltip=true;I.fullPath=O||"";if(R&&R.n){I.dbr=R.n||"";}else{I.dbr="";}var S=this.addChildren(mstrmojo.insert(I));S._ontooltipover=function(W){S.richTooltip={cssClass:"vi-regular vi-tooltip-A",refNode:S.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:22,content:K.htmlAngles(S.fullPath)};S.showTooltip(W,self);};S.render();S.set("isFolder",P);U.push(Q);N.push(R||null);this.folders[Q]=P;this.set("urls",U);this.textNode.style.display="none";this.imageNode.style.display="none";},isFolder:function(N){return this.folders[N]==true;},removeURL:function(N){var P=null,O,Q=this.urls;for(O=0;O<this.children.length;O++){if(this.children[O].url===N){P=this.children[O];break;}}if(P){Q.splice(O,1);this.removeChildren(P);this.set("urls",Q);if(this.dbrs&&this.dbrs.length>O){this.dbrs.splice(O,1);}}},addFile:function C(N,O){A.name=N;A.title=N;A.file=O;var P=this.addChildren(mstrmojo.insert(A));P.render();this.textNode.style.display="none";this.imageNode.style.display="none";},submit:function(N,V,R){function W(Y){var Z=[];Z.push(Y.target.result);var X=new Blob(Z);mstrApp.showProgress(R);mstrApp.upload(V,N,X,R);}function O(Y){var X={code:0,message:"Cannot read file content"};if(V.failure){V.failure(X);}if(V.complete){V.complete();}}var P=true;if(this.onsubmit){P=this.onsubmit();}if(P){N=N||{};N.fileFieldName=this.fileFieldName;N.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){if(this.params){N=this.params;}if(N.__index!==undefined){(function(Z){var Y=Z.name;var X=new FileReader();X.onload=function(c){var b=Y;N.fileName=Y;var d=[];d.push(c.target.result);var a=new Blob(d);mstrApp.showProgress();mstrApp.upload(V,N,a,R);};X.onerror=O;X.readAsArrayBuffer(Z);})(this.files[N.__index]);}else{var S;for(S=0;S<this.files.length;S++){(function(Z){var Y=Z.name;var X=new FileReader();X.onload=function(c){var b=Y;N.fileName=Y;var d=[];d.push(c.target.result);var a=new Blob(d);mstrApp.showProgress();mstrApp.upload(V,N,a,R);};X.readAsArrayBuffer(Z);})(this.files[S]);}}}else{N.taskEnv="jsonp2";var U=[],Q;for(Q in N){U.push('<input type="hidden" name="'+Q+'" value="'+mstrmojo.string.encodeHtmlString(N[Q].toString())+'"/>');}if(this.params){N=this.params;for(Q in N){U.push('<input type="hidden" name="'+Q+'" value="'+mstrmojo.string.encodeHtmlString(N[Q])+'"/>');}}this.paramsNode.innerHTML=U.join("");if(V){this.onSuccess=V.success;this.onFailed=V.failure;}this.formNode.submit();}this.set("status","loading");}},uploadCallback:function(O){var N=(O.status==200);if(N&&this.onSuccess){this.onSuccess(O);}if(!N&&this.onFailed){this.onFailed(O);}},preBuildRendering:function(){if(this._super){this._super();}},getFilesCnt:function(){if(this.files){return this.files.length;}else{return 0;}},getFileName:function(N){if(N<this.files.length){filename=this.files[N].name;return filename;}return"";},getFileTableID:function(N){if(this.urls&&N<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[N]];}if(this.files&&N<this.files.length){return this.files[N].tableID;}return null;},updatePageConfig:function(Q){var R,O,P;var U,W;var X=[];var V=Q.properties.tableID;var S=Q.properties.model.importSources[V];if(Q.name!==undefined&&Q.tableID&&Q.properties&&Q.properties.sourceSubtype===M.sourceSubtype.localFile){X=[];for(R=0;this.children&&R<this.children.length;R++){O=this.children[R];if(O.domNode&&O.domNode.parentNode===this.tableNode){X.push(O);}}P=X.length;for(R=0;R<P;R++){this.removeChildren(X[R]);}this.set("files",[]);Q=mstrmojo.hash.copy(Q,mstrmojo.hash.copy(A));U=this.addChildren([mstrmojo.insert(Q)]);this.set("files",[{name:Q.name,tableID:Q.tableID}]);this.textNode.style.display="none";this.imageNode.style.display="none";}if(Q.name!==undefined&&Q.tableID&&Q.properties&&Q.properties.sourceSubtype===M.sourceSubtype.url){X=[];if(S){var N=S.sourceInfo.url;}for(R=0;this.children&&R<this.children.length;R++){O=this.children[R];if(O.domNode&&O.domNode.parentNode===this.tableNode){X.push(O);}}P=X.length;for(R=0;R<P;R++){this.removeChildren(X[R]);}this.set("urls",[]);this.set("visible",true);Q.url=N;Q=mstrmojo.hash.copy(Q,mstrmojo.hash.copy(I));W=this.addChildren([mstrmojo.insert(Q)]);this.set("urls",[N]);this.urlTableID={};this.urlTableID[N]=V;}},setFilesObject:function(P){var O,R,N;var Q=[];for(O=0;this.children&&O<this.children.length;O++){R=this.children[O];if(R.domNode&&R.domNode.parentNode===this.tableNode){Q.push(R);}}N=Q.length;for(O=0;O<N;O++){this.removeChildren(Q[O]);}this.set("files",[]);for(O=0;P&&O<P.length;O++){A.name=P[O];this.addChildren([mstrmojo.insert(A)]);}},setURLsObject:function(R){var P,V,O;var Q,N;var S=[];for(P=0;this.children&&P<this.children.length;P++){V=this.children[P];if(V.domNode&&V.domNode.parentNode===this.tableNode){S.push(V);}}O=S.length;for(P=0;P<O;P++){this.removeChildren(S[P]);}this.set("urls",[]);if(R.length>0){this.set("visible",true);this.textNode.style.display="none";this.imageNode.style.display="none";}else{this.set("visible",false);}for(P=0;P<R.length;P++){I.url=R[P];var U=R[P].substring(R[P].lastIndexOf("/")+1,R[P].lastIndexOf("?")===-1?R[P].length:R[P].lastIndexOf("?"));Q=mstrmojo.insert(I);N=this.folders[R[P]];if(!mstrmojo.string.isEmpty(U)){I.text=U;}this.addChildren([Q]);Q.set("isFolder",N);}this.set("urls",R);},synFile:function(){var P=[],O,R,N=this.files;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){P=this.fileNode.files;}else{var Q=new ActiveXObject("Scripting.FileSystemObject");P.push(Q.getFile(this.fileNode.value));}for(O=0;O<P.length;O++){N.push(P[O]);A.name=P[O].name;R=this.addChildren(mstrmojo.insert(A));R.render();}this.set("files",N);this.textNode.style.display="none";this.imageNode.style.display="none";},onclick:function(O){var N=O.e.srcElement||O.e.target;var Q=0,P=0,R;if(N.className!=="mstrmojo-Button-text close-button"){return ;}for(Q=0;this.children&&Q<this.children.length;Q++){R=this.children[Q];if(R.domNode&&R.domNode.parentNode===this.tableNode){P++;}}if(P===0){this.textNode.style.display="block";this.imageNode.style.display="block";}},getURLCnt:function(){if(this.urls){return this.urls.length;}else{return 0;}},updateItemsCount:function(N){if(N>1){this.countNode.style.display="block";if(mstrApp.getRootController().rootView.currentPage.pageType===M.pageType.sourceObjectsDnD){this.countNode.style.right="30px";}if(mstrApp.getRootController().rootView.currentPage.pageType===M.pageType.hadoop){this.countNode.style.right=!!mstrApp.isWorkstation?"20px":"30px";}}else{this.countNode.style.display="none";}this.countNode.textContent=mstrmojo.desc(2121,"Total")+": "+N;},onurlsChange:function(){this.updateItemsCount(this.getURLCnt());}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(11668,15187,15188,15189,15190);function B(L,K,I){var J=K,H;for(;J>0;J--){H=Array(J+1).join("#");L=L.replace(H,I[J-1]);}return L;}var C='<div class="ghost-vis-txt-metric">',A='<div class="ghost-vis-txt-attr">',E='<div class="ghost-vis-txt-attr-time">',G="</div>";var D={grid:B(mstrmojo.desc(15187,"Add # or more ##attributes### and/or #### or more #####metrics######"),6,[1,A,G,1,C,G]),heatmap:B(mstrmojo.desc(15187,"Add # or more ##attributes### and/or #### or more #####metrics######"),6,[1,A,G,1,C,G]),barchart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),linechart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),areachart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),bubblechart:B(mstrmojo.desc(15190,"Add # or more ##metrics### and #### or more #####attributes######"),6,[2,C,G,1,A,G]),piechart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),combochart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,2,C,G]),network:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[2,A,G,1,C,G]),histogram:B(mstrmojo.desc(15667,"Add # or more ##attributes### and ####  #####metric######"),6,[1,A,G,1,C,G]),boxplot:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),waterfall:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),kpicard:B(mstrmojo.desc(15878,"Add # or more ##attributes### and #### #####metric######"),6,[1,A,G,1,C,G])};function F(H){return D[H]?D[H]:mstrmojo.desc(11668,"Drag objects here.");}mstrmojo.vi.ui.rw.GhostImageContainer=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.vi.ui.rw.GhostImageContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-rw-GhostImageContainer {@cssClass}"><div class="mstmojo-ghostImgTableCell"><div class="mstrmojo-ghostImgDiv"><div class="ghost-vis-img"></div><div class="ghost-vis-name">{@visName}</div><div class="ghost-vis-desc">{@visDesc}</div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;}},visName:"",visDesc:""});mstrmojo.vi.ui.rw.GhostImageContainer.getVisDesc=F;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");var D="slot";mstrmojo.HBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.HBox",cellCssClass:"",cellSpacing:0,cellPadding:0,markupString:'<table id="{@id}" class="mstrmojo-HBox {@cssClass}" style="{@cssText}" cellspacing="{@cellSpacing}" cellpadding="{@cellPadding}">{@colHTML}<tr>{@tableHtml}</tr></table>',colHTML:"",markupSlots:{containerNode:function(){return this.domNode.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildRendering:function B(){this.tableHtml="";var N=[],F=this.children,K=(F&&F.length)||0,I;if(K){var G=0,J=this.cellCssClass?' class="mstrmojo-HBox-cell '+this.cellCssClass+'" ':"",M="<td "+J+"></td>";for(I=0;I<K;I++){N[G++]=M;F[I].slot=D+I;}this.tableHtml=N.join("");}this._super();if(K){var L={},H=this.containerNode.cells;for(I=0;I<K;I++){L["slot"+I]=H[I];}this.addSlots(L);}},addChildren:function E(K,F,G){if(!K){return K;}if(F===undefined||isNaN(F)||F<0){var J=this.children;F=(J&&J.length)||0;}var I=0,H;if(K.constructor===Array){for(I=0,H=K.length;I<H;I++){K[I].slot=D+(F+I);}}else{K.slot=D+F;}return this._super(K,F,G);},childRenderCheck:function C(G){if(G&&!G.hasRendered){var F=G.slot||this.defaultChildSlot;return !!this[F]||F.match(/^slot[\d]+$/);}return false;},onchildRenderingChange:function A(I){var F=(I&&I.src)||I,L=F&&F.domNode;if(L){var Q=F.slot;if(!this[Q]){var J=Q&&Q.match(/^slot([\d]+)$/);if(J){var O=parseInt(J[1],10),N=this.containerNode,P=N.cells,M=(P&&P.length)||0,K={};for(var H=M;H<=O;H++){var G=N.insertCell(H);K["slot"+H]=G;if(this.cellCssClass){G.className=this.cellCssClass;}}this.addSlots(K);}}}this._super(I);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var M=mstrmojo.Widget,G=mstrmojo.dom,N=mstrmojo.global.document,C=50,B=500;mstrmojo.Stepper=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Stepper",orientation:"vertical",provider:null,title:"",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text">{@itemHtml}</div><div class="prev">-</div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},nextNode:function(){return this.domNode.children[1];},textNode:function(){return this.domNode.children[2];},prevNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:M.visibleMarkupMethod,onheightChange:M.heightMarkupMethod,onwidthChange:M.widthMarkupMethod,onenabledChange:function I(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},preBuildRendering:function J(){this.itemHtml=this.provider.renderItemAt();this._super();},processEvent:function A(O){if(G.contains(this.textNode,O)||O===this.titleNode){return ;}var Q=this.provider,P=((O===this.nextNode)?"Next":"Prev");if(Q["has"+P]()){Q[P.toLowerCase()]();this.updateDisplayText();}},updateDisplayText:function E(){this.textNode.innerHTML=this.provider.renderItemAt();},startStepperInterval:function F(O,P){var Q=this;this._holdTimer=setInterval(function(){Q[P](O);},C);},stopStepperInterval:function H(){if(this._holdTimer){clearInterval(this._holdTimer);delete this._holdTimer;}},onclick:function L(O){this.processEvent(O.e.target);},onmousedown:function D(O){if(!this._holdTimer&&!this._startHoldTimer){var P=this;this._startHoldTimer=setTimeout(function(){delete P._startHoldTimer;P.startStepperInterval(O,"onclick");},B);G.attachOneTimeEvent(N,"mouseup",function(){if(P._startHoldTimer){clearTimeout(P._startHoldTimer);delete P._startHoldTimer;}P.stopStepperInterval();},true);}},onselectstart:function K(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.date");mstrmojo.requiresDescs(1823,9374,9375,12680,12681,12682,12683,12684,12685,12686,12688);var D=mstrmojo.date,B=mstrmojo.locales,E="M/d/yyyy";mstrmojo.DI.DIFacebookAdvancedEditor=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",cssClass:"mstrmojo-DI-facebook-advancedOptionsContent",advancedProperties:{},markupString:'<div id="{@id}" class="{@cssClass}" ></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{contentNode:function(){return this.domNode;}},postBuildRendering:function A(){var K,J;if(this._super){this._super();}if(this.advancedProperties.hasOwnProperty("r")){this.rangeDropdown.dates.set("select",this.advancedProperties.r);}if(this.advancedProperties.hasOwnProperty("i")){this.rangeDropdown.dates.set("selectedIndex",this.advancedProperties.i);}if(this.advancedProperties.hasOwnProperty("n")){this.rangeDropdown.rangeBox.nValue.set("value",this.advancedProperties.n);}if(this.advancedProperties.hasOwnProperty("fD")){K=D.parseDate(this.advancedProperties.fD,false,E);if(!K){K=D.parseDate(this.advancedProperties.fD);}J=K?D.formatDateInfo(K,B.datetime.DATEOUTPUTFORMAT):this.advancedProperties.fD;this.fromBox.fromDate.set("value",J);}else{this.fromBox.fromDate.set("value","MM/DD/YYYY");}if(this.advancedProperties.hasOwnProperty("tD")){K=D.parseDate(this.advancedProperties.tD,false,E);if(!K){K=D.parseDate(this.advancedProperties.fD);}J=K?D.formatDateInfo(K,B.datetime.DATEOUTPUTFORMAT):this.advancedProperties.tD;this.toBox.toDate.set("value",J);}else{this.toBox.toDate.set("value","MM/DD/YYYY");}},children:[{slot:"contentNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(12681,"Optional Time Parameters")},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"rangeDropdown",children:[{scriptClass:"mstrmojo.ui.Pulldown",title:"",alias:"dates",cssText:"height:23px; width:130px;",select:true,selectedIndex:2,items:[{n:mstrmojo.desc(12682,"Last N Minutes"),v:0,range:"minutes"},{n:mstrmojo.desc(12683,"Last N Hours"),v:1,range:"hours"},{n:mstrmojo.desc(12684,"Last N Days"),v:2,range:"days"},{n:mstrmojo.desc(12685,"Last N Weeks"),v:3,range:"weeks"},{n:mstrmojo.desc(12686,"Last N Months"),v:4,range:"months"},{n:mstrmojo.desc(1823,"Custom"),v:5,range:"custom"}],updateSelection:function G(J){switch(J){case 5:this.parent.parent.fromBox.fromDate.set("disabled",false);this.parent.parent.toBox.toDate.set("disabled",false);this.parent.rangeBox.set("disabled",true);this.select=false;break;default:this.parent.parent.fromBox.fromDate.set("disabled",true);this.parent.parent.toBox.toDate.set("disabled",true);this.parent.rangeBox.set("disabled",false);this.select=true;break;}},preBuildRendering:function(){if(this._super){this._super();}this.updateSelection(this.selectedIndex);},onSelectedItemChange:function(){if(this.hasRendered===false){return ;}this.updateSelection(this.selectedIndex);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-DI-facebook-advancedOptionsInner",alias:"rangeBox",disabled:false,ondisabledChange:function I(J){mstrmojo.css.toggleClass(this.domNode,"disabled",J.value);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12688,"where N = ")},{scriptClass:"mstrmojo.TextBox",alias:"nValue",cssText:"width:20px;",value:1}]}]},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"fromBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(9374,"Start Date")},{scriptClass:"mstrmojo.DI.DIDateTextBox2",cssClass:"DIDateTextBox2",alias:"fromDate",value:"MM/DD/YYYY",disabled:true,bindings:{toDate:function(){return this.parent.toDate.value;}},ondisabledChange:function I(J){this.parent.handleDisableChange(J.value);},postBuildRendering:function(){if(this._super){this._super();}this.parent.handleDisableChange(this.disabled);}}],handleDisableChange:function F(J){if(J===true){mstrmojo.css.addClass(this.domNode,"DIDateTextBox2 disabled");}else{mstrmojo.css.removeClass(this.domNode,"DIDateTextBox2 disabled");}}},{scriptClass:"mstrmojo.HBox",slot:"contentNode",cssClass:"mstrmojo-DI-facebook-advancedOptions",alias:"toBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-dateLabel",text:mstrmojo.desc(9375,"End Date")},{scriptClass:"mstrmojo.DI.DIDateTextBox2",cssClass:"DIDateTextBox2",alias:"toDate",value:"MM/DD/YYYY",disabled:true,bindings:{fromDate:function(){return this.parent.fromDate.value;}},ondisabledChange:function I(J){this.parent.handleDisableChange(J.value);},postBuildRendering:function(){if(this._super){this._super();}this.parent.handleDisableChange(this.disabled);}}],handleDisableChange:function F(J){if(J===true){mstrmojo.css.addClass(this.domNode,"DIDateTextBox2 disabled");}else{mstrmojo.css.removeClass(this.domNode,"DIDateTextBox2 disabled");}}}],setAdvancedProperties:function C(K,J,L,P,O,M){this.advancedProperties={r:K,i:J,n:L,fD:P,tD:O,d:M,dateRange:function(R,Q){return{since:R,until:Q};},getProperties:function N(){if(this.r===true){return this.dateRange(this.d,this.tD);}return this.dateRange(this.fD,this.tD);}};return true;},onOk:function H(){var L=this.rangeDropdown.dates.select,M=this.rangeDropdown.rangeBox.nValue.value,P,O,K,N,J=5;if(L===true){J=this.rangeDropdown.dates.selectedIndex;N="-"+M+" "+this.rangeDropdown.dates.items[J].range;}else{P=this.fromBox.fromDate.value;O=this.toBox.toDate.value;K=D.parseDate(P);if(K){P=D.formatDateInfo(K,E);}K=D.parseDate(O);if(K){O=D.formatDateInfo(K,E);}}return this.setAdvancedProperties(L,J,M,P,O,N);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo._IsPopup","mstrmojo._CanAutoClose");var C=mstrmojo.dom;mstrmojo.ui.PopupWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.PopupWidget",markupString:'<div id="{@id}" class="mstrmojo-ui-PopupWidget {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="pw-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},autoCloses:true,locksHover:true,closeOnClick:true,visible:true,onclick:function B(D){C.stopPropogation(null,D.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button");mstrmojo.HTMLButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.HTMLButton",markupString:'<input id="{@id}" type="button" class="mstrmojo-text mstrmojo-HTMLButton mstrButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:click />',markupSlots:{inputNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onselectedChange:function(){mstrmojo.css[this.selected?"addClass":"removeClass"](this.domNode,["selected"]);},ontextChange:function(){this.inputNode.value=this.text!=null?this.text:"";},oniconClassChange:function(){this.domNode.className="mstrmojo-text mstrmojo-HTMLButton mstrButton "+this.cssClass+" "+this.iconClass+(this.enabled?"":" disabled");}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapperHoriz","mstrmojo.ListBuilder");mstrmojo.ListHoriz=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.ListHoriz",renderOnScroll:true,listMapper:mstrmojo.ListMapperHoriz,listBuilder:mstrmojo.ListBuilder,itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2");function B(E){var I=E.ctxtBuilder;if(I){var H=I.itemWidgets,G;for(G=H.length-1;G>-1;G--){var F=H[G];if(F){F.destroy(true);}}}}mstrmojo.WidgetListBase=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.WidgetListBase",unrender:function C(G){var I=this.ctxtBuilder;if(I){var H=I.itemWidgets,F;for(F=H.length-1;F>-1;F--){var E=H[F];if(E&&E.hasRendered){E.unrender(true);}}}this._super(G);},refresh:function A(E){B(this);if(this._super){this._super(E);}},destroy:function D(E){B(this);this._super(E);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapper","mstrmojo.ListBuilder","mstrmojo.ListSelector");mstrmojo.List=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.List",renderOnScroll:true,listMapper:mstrmojo.ListMapper,listBuilder:mstrmojo.ListBuilder,listSelector:mstrmojo.ListSelector,itemIdField:"dssid",itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.InlineEditBox");var B=mstrmojo.dom,A=mstrmojo.css;mstrmojo.DI.DIInlineEditBox=mstrmojo.declare(mstrmojo.InlineEditBox,null,{scriptClass:"mstrmojo.DI.DIInlineEditBox",cssClass:"mstrmojo-di-rename-box",enableBreakLine:false,init:function C(D){this._super(D);this.markupMethods.oneditModeChange=function(){var J=this.editMode,G=this.domNode,F=this.textNode,I=this.editNode;A.toggleClass(G,["edit"],J);if(J){F.style.display="none";I.style.display="block";F=this.inputNode;var H=F.style;F.value=mstrmojo.string.decodeHtmlString(this.text||"");H.width=(G.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";H.height=G.clientHeight+"px";F.select();F.focus();if(F.createTextRange){var K=F.createTextRange(),E=F.value.length;K.move("character",E);K.select();}}else{F.style.display="block";I.style.display="none";}};if(!this.enableBreakLine){this.markupMethods.ontextChange=function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||this.emptyHint||"",false,true);};}}});}());(function(){mstrmojo.requiresCls("mstrmojo.RadioButton");var C=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton=mstrmojo.declare(mstrmojo.RadioButton,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton",cssClass:"mstrmojo-wh-DBRoleRadioButton",enableChildren:function A(){var G=this.parent,F=this;C.forEach(G.children,function(H){if(H.parentRBAlias&&(H.parentRBAlias===F.alias)){H.set("enabled",F.checked);}});},enabled:true,getValue:function B(){return this.checked;},setValue:function E(F){this.checked=F;this.onclick();},isValid:function D(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ConditionNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.dom","mstrmojo.css","mstrmojo.expr");mstrmojo.requiresDescs(1994,5893,7931,15671);var A=mstrmojo.dom,B=mstrmojo.css,D=mstrmojo.expr.ET,E=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.ConditionNode=mstrmojo.declare(mstrmojo.ConditionNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.ConditionNode",emptyText:mstrmojo.desc(5893,"New Condition"),markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /><img class="mstrmojo-lock" src="../images/lock_view.svg"/></span><span class="mstrmojo-add-cond" mstrAttach:click>'+mstrmojo.desc(1994,"Add Condition")+"</span>"+E+"</div></div>",getPrefixAndOrToolsMarkup:function(){return(E+this._super());},markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];},createSetNode:function(){return this.domNode.childNodes[1].lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},addConditionNode:function(){return this.domNode.childNodes[1].childNodes[4];}},markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){B.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noRelation);},onnoCreateSetChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noCreateSet);},onlockedChange:function(){B.toggleClass(this.condNode,["locked"],this.locked);}},mstrmojo.hash.copy(mstrmojo.ConditionNode.prototype.markupMethods)),init:function(I){if(this._super){this._super(I);}var K=this.data&&this.data.et;if(K){this.set("noCreateSet",mstrApp.supportAdvFilter?false:(K===D.MQ||K===D.MC));}var G=this.tree.editor;if(G){var F=G.scriptClass==="mstrmojo.fe.FilterEditor";var H=typeof (G.disableElementsBrowsing)==="function"&&G.disableElementsBrowsing();if(F&&H&&K===D.AE){this.set("locked",true);this.set("editable",false);this.set("useRichTooltip",true);var J=this;this.set("updateTooltipConfig",function(){var L=mstrmojo.dom.position(J.domNode);this.richTooltip={content:mstrmojo.desc(15671,"Edit or remove is only available in workstation"),refNode:J.domNode,enableHover:true,cssClass:"vi-regular vi-tooltip-V V-center",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,left:L.w/2,top:-10};});}}},preclick:function C(F){var I=null,H=A.eventTarget(F.hWin,F.e),G=this._super(F);if(A.contains(this.createSetOptNode,H,true)&&!this.noRelationOperator&&!this.noRelation){I="createSetOpt";}else{if(A.contains(this.createSetNode,H,true)&&!this.noRelation){I="createSet";}else{if(A.contains(this.addConditionNode,H,true)){I="addCondition";}}}F.part=I||F.part;return G;},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.Checkbox");var A={ROUND:"round",RECT:""};mstrmojo.ui.ToggleButton=mstrmojo.declare(mstrmojo.ui.Checkbox,null,{scriptClass:"mstrmojo.ui.ToggleButton",markupString:'<div id="{@id}" class="mstrmojo-ui-ToggleButton {@cssClass}" mstrAttach:click><div class="container"><div class="slider {@sliderStyle}"></div></div></div>',sliderStyle:A.ROUND});mstrmojo.ui.ToggleButton.EnumStyle=A;}());(function(){mstrmojo.requiresCls("mstrmojo.Label");mstrmojo.DI.DILabel=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.DI.DILabel",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click,mouseover,mouseout></div>'});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.css","mstrmojo.hash");mstrmojo.TristateCheckBox=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.TristateCheckBox",grayed:true,checked:true,cssClass:"tristate",onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}},markupMethods:mstrmojo.hash.copy({oncheckedChange:function(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},ongrayedChange:function(){mstrmojo.css.toggleClass(this.domNode,"grayed",this.grayed);},onenabledChange:function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},mstrmojo.hash.copy(mstrmojo.Label.prototype.markupMethods))});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo._CanHandleTwoClicks","mstrmojo.Label","mstrmojo.Widget");var C=mstrmojo.css,A=mstrmojo.Label.prototype.markupMethods;mstrmojo.EditableLabel=mstrmojo.declare(mstrmojo.Label,[mstrmojo._CanHandleTwoClicks,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.EditableLabel",autoApplyDelay:-1,markupString:'<div id="{@id}" class="mstrmojo-EditableLabel {@cssClass}" title="{@title}" contenteditable="{@isEditing}" style="{@cssText}" mstrAttach:click,mousedown,blur,keydown,keyup></div>',markupMethods:mstrmojo.hash.copy({onwidthChange:function(){mstrmojo.Widget.widthMarkupMethod.call(this);},ontextChange:function(){if(A.ontextChange){A.ontextChange.call(this);}this.widgetResized();},onvisibleChange:function(){if(A.onvisibleChange){A.onvisibleChange.call(this);}if(this.visible){this.widgetResized();}}},mstrmojo.hash.copy(A)),onkeyup:function E(F){this._super(F);if(this._autoApplyTimer){window.clearTimeout(this._autoApplyTimer);}if(this.autoApplyDelay!==-1){var G=this;this._autoApplyTimer=window.setTimeout(function(){G.set("isEditing",false);},this.autoApplyDelay);}},postBuildRendering:function D(){if(this._super){this._super();}this.widgetResized();},selectable:true});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.EditableLabel,{onselectableChange:function B(){var G=this[this.editableSlot],F=!!this.selectable;G.selectable=F;G.setAttribute("unselectable",!F?"on":"off");C.toggleClass(G,"unselectable",!F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.architect.ui._HasTreeDropZone","mstrmojo.string","mstrmojo.dom","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.hash","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(11611,11805,13243,14868);var I=mstrmojo.dom,w=mstrmojo.string,B=mstrmojo.css,U=mstrmojo.hash,Y=mstrmojo.array,C=mstrmojo.warehouse.EnumObjectTypes,j=mstrmojo.DI.DIConstants,M="selected",n=mstrmojo.DI.DIHelpers,k="li",AB="idx",P=12,AA="tableViewItemAttr",W="tableViewItemMetric",H="tableViewItemForm";function u(AE,AD){var AC=mstrmojo.dom.position(AE).y;var AF=mstrmojo.dom.position(AE).h;var AG=mstrmojo.dom.position(AD);if(AC+AF>=AG.y+AG.h){AE.parentElement.scrollTop=AE.parentElement.scrollTop+AC-AG.y-AG.h+AF;}else{if(AC<AG.y){AE.parentElement.scrollTop=AE.parentElement.scrollTop-(AG.y-AC);}}}function Z(AD){if(AD.subColumns&&AD.subColumns.length){for(var AC=0;AC<AD.subColumns.length;AC++){if(AD.subColumns[AC].recursive){return true;}}}return false;}mstrmojo.DI.DIMappingTableRows=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo._HasPopup,mstrmojo.warehouse._CanToggleAvatarClass,mstrmojo.architect.ui._HasTreeDropZone],{scriptClass:"mstrmojo.DI.DIMappingTableRows",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree mstrmojo-di-mappingRows {@cssClass}" mstrAttach:click,dblclick,contextmenu,scroll>{@itemsHTML}</div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},scrollboxNode:function N(){return this.domNode;}},tableData:undefined,tp:undefined,useRichTooltip:true,convertEnabled:true,init:function q(AC){this._super(AC);this.userSelections={};},getItemMarkup:function G(){return'<div class="item {@cls} {@link}"><span class="di-item-ic"></span><span class="di-item-n {@ipa}">{@n}</span><div class="{@link}"></div>';},preBuildRendering:function A(){if(this._super){this._super();}if(n.isIE()){var AC=document.getElementsByTagName("div");mstrmojo.array.forEach(AC,function(AD){AD.onselectstart=function(){return false;};});}},postBuildRendering:function O(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:"",keepArrowXPos:true});if(!this._ontooltipover){var AC=this.id;this._ontooltipover=function(AD){var AG=mstrmojo.all[AC];var AI=AD.target||AD.srcElement;I.stopPropogation(self,AD);var AF=I.findAncestorByAttr(AI,AB,true,AG.domNode);if(!!AF){var AE=AF.node.firstChild.childNodes[1];var AJ=mstrmojo.dom.position(AE);if(AJ.w<AE.scrollWidth){var AH=AG.getTreeItem(AF.value);AG.richTooltip.refNode=AI;AG.richTooltip.content=w.encodeHtmlString((AH.ipa?(mstrmojo.desc(13243,"Project Attribute")+": "):"")+AH.ttp+((AH.isMultiForm&&AH.fmn)?"@"+AH.fmn:""));AG.showTooltip(AD,self);}}};this._ontooltipout=function(AD){var AE=mstrmojo.all[AC];AE.hideTooltip(AD,self);};}return this._super();},getItemProps:function d(AE,AC){var AD={sel:!!this.selectedIndices[AC],cls:(function(){var AK=AE.isLinked;var AH=false,AJ=false;if(AK){var AI=mstrApp.getRootController().model.findMappingItem(AE);var AG;for(AG=0;AG<AI.length;AG++){if(AI[AG].recursive){AJ=true;break;}else{if(AI[AG].georole){AH=true;break;}}}}var AF="tp"+AE.tp;if(AE.recursive||AJ||Z(AE)){AF+=" recursive";}else{if(n.isTime(AE)){AF+=" time";}else{if((!AE.isAttributeForm&&n.isGeo(AE))||AH){AF+=" geo";}}}return AF+(AE.unused?" uc":"");}()),link:AE.isLinked?"linked":"",n:w.encodeHtmlString(AE.isAttributeForm?(AE.alias+"@"+AE.fmn):AE.alias,false,true),idx:AC,ipa:AE.ipa?"ipa":""};AD.n=AD.n.replace(/<br\s*\/?>/g,"&nbsp;");return AD;},getRowItem:function p(AC){return this.getTreeItem(AC);},getRowNode:function x(AE,AD){var AC=mstrmojo.array.find(this.items,AE,AD);if(AC>-1){return this.domNode.children[0].children[AC];}},isItemAvailable:function S(AC){return this.getItemWithPropName(this.items,"did",AC).length>0;},handleEvent:function K(AC){var AD=this.getItemWithPropName(this.items,"did",AC.did)[0];switch(AC.name){case"Remove":this.removeChild(AD._renderIdx);return true;case"Rename":AD.n=AC.value;this.updateChild(AD._renderIdx,AD);return true;}return false;},onclick:function g(AK){try{var AG=AK.target||I.eventTarget(AK.hWin,AK.e),AL=I.findAncestorByAttr(AG,AB,true,this.domNode),AD;if(AL){AL.tableId=AK.src.tableData.id;AL.tableRow=this;AL.tableRow.parent=this.parent;this.parent.parent.clickedNode=AL;}if(!n.isCtrlKey(AK.hWin,AK.e)&&!I.shiftKey(AK.hWin,AK.e)){this.parent.parent.raiseEvent({name:"allTableSelectionClear"});}else{this.parent.parent.raiseEvent({name:"allTableSelectionClear",source:AK.src.tableData});}this._super(AK);this.raiseEvent({name:"tableSelectionClear",source:this});this.parent.parent.parent.linker.clearLinks();var AJ=this.getUserSelectedData();if(AJ&&AJ.length>0){this.parent.parent.parent.parent.raiseEvent({name:"scrollPreviewToCurItem",tableId:this.tableData.id,columnIndex:AJ[0].dataIdx,data:AJ[0]});}if(I.shiftKey(AK.hWin,AK.e)){var AI=Math.min(parseInt(AJ[0]._renderIdx,10),parseInt(AJ[1]._renderIdx,10));var AE=Math.max(parseInt(AJ[0]._renderIdx,10),parseInt(AJ[1]._renderIdx,10));if(AJ.length>2){AG=AK.target||I.eventTarget(AK.hWin,AK.e);AL=I.findAncestorByAttr(AG,"idx",true,this.domNode);if(AI>AL.value){AE=AI;AI=AL.value;}else{AI=AE;AE=AL.value;}}var AF;for(AF=AI;AF<AE;AF++){this.userSelections[AF]=true;AD=this.domNode.children[0].childNodes[AF];B.addClass(AD,"selected");if(AF!==AI&&AF!==AE){AJ.push(this.items[AF]);}}}var AC=U.walk("parent.parent.parent.parent",this);AC.raiseEvent({name:"highlightColumns",tableId:this.tableData.id,data:AJ});if(AJ.length!==0){Y.forEach(AJ,function(AM){if(AM.isLinked){this.raiseEvent({name:"selectLinkedItems",source:this,oid:AM.oid,alias:AM.alias});}},this);}}catch(AH){throw AH;}},ondblclick:function R(AC){var AF=AC.getTarget();if(AF.nodeName!=="SPAN"){AF=AF.childNodes[1];}else{var AE=mstrmojo.string.trim(AF.nextSibling.className);if(AE==="di-item-n"){AF=AF.nextSibling;}}var AG={data:this.getUserSelectedData(),target:AC.src.parent,position:I.position(AF,true)};this.clearSelections(U.copy(this.userSelections));var AD=AG.data[0];if(!AD||AD.isAttributeForm){return ;}mstrApp.getRootController().openRenameTextBox(j.contextMenuType.ITEM_MENU,AF,AG);},treeHooks:{select:function o(AE,AF){var AG=this.userSelections,AD=AF._renderIdx,AC=AG[AD]===true;if(AC){delete AG[AD];}else{AG[AD]=true;}B.toggleClass(AE,M,!AC);delete this.selectedIndices[AD];return true;}},createAvatar:function X(AD){var AG=document.createElement("div"),AE=I.findAncestorByAttr(AD,AB,true,this.domNode);if(AE&&AE.node){var AC=this.userSelections;if(AC[AE.value]){var AF=this.domNode.getElementsByTagName(k);Y.forEach(AF,function(AH){if(AC[AH.getAttribute(AB)]===true){AG.appendChild(AH.cloneNode(true));}},this);}else{AG.appendChild(AE.node.cloneNode(true));}AG.appendChild(document.createElement("div"));}AG.className=this.domNode.className;return AG;},ondragenter:function E(AC){if(this._super){this._super(AC);}var AD=AC.src.widget;if(AD&&AD.updateAvatarHTML){AD.updateAvatarHTML(AC);}},isDragValid:function V(){return true;},ondragstart:function h(AC){this._super(AC);if(AC.src.data&&AC.src.data.length){this.selectItem("did",AC.src.data[0].did);}},ondragmove:function F(AC){if(this._super){this._super(AC);}var AF=AC.src.widget;var AE=AC.tgt.widget;var AD=AC.tgt.node.parentElement;if(AF&&AE&&AF.tp===P&&AE.tp===P&&AD!==AE.domNode){this.parent.parent.parent.linker.clearLinks();this.parent.parent.parent.linker.drawLink(AD,AE.parent,AC.src.node,AF.parent);}else{this.parent.parent.parent.linker.clearLinks();}},updateAvatarHTML:function t(AC){var AD="";if(!this.convertEnabled){return ;}if(AC.action===W&&this.tp===C.METRIC){AD=mstrmojo.desc(11611,"Convert to Attribute");}else{if(AC.action===AA){if(this.tp===C.ATTRIBUTE){AD=mstrmojo.desc(11805,"Convert to Metric");}}}this.avatar.lastChild.innerHTML=AD;},getAvatarIconClass:function Q(AC){var AD=AC.src&&AC.src.data;AD=AD&&AD[0];return AD.tableId===this.tableData.id?"enabled":"";},toggleAvatarClass:function l(AC,AD){B.toggleClass(this.avatar,AC,AD);},getDragAction:function J(AC){var AD=I.findAncestorByAttr(AC.src.node,AB,true,this.domNode);if(AD){switch(this.getRowItem(AD.value).tp){case C.ATTRIBUTE:return AA;case C.METRIC:return W;case C.FORM:return H;}}},getDragData:function f(AE){var AC=this.getNodeAttributes(AE.src.node).index,AD=this.getTreeItem(AC),AF=this.userSelections;if(AD&&AD.tp!==21){U.copy(AD,{columnId:AD.did,tableName:this.tableData.n,tableId:this.tableData.id});if(AF[AC]===true){return this.getUserSelectedData();}this.clearSelections(U.copy(AF));return[AD];}return AD;},getUserSelectedData:function a(){var AD=[],AC;U.forEach(this.userSelections,function(AE,AF){AC=this.getTreeItem(AF);AD.push(U.copy(AC,{columnId:AC.did,tableName:this.tableData.n,tableId:this.tableData.id}));},this);return AD;},getNodeAttributes:function z(AD){var AC=I.findAncestorByAttr(AD,AB,true,this.domNode),AE=AC&&AC.node.getAttribute("level");return{index:AC&&AC.value,level:parseInt(AE,10)};},clearSelections:function b(AF){var AE=this.domNode.getElementsByTagName(k),AD;Y.forEach(AE,function AC(AG){AD=AG.getAttribute(AB);if(AF[AD]===true){B.toggleClass(AG,M,false);delete this.userSelections[AD];}},this);},selectItem:function L(AG,AD){var AC=this.items;var AE=mstrmojo.array.find(AC,AG,AD);var AF;if(AE!==-1){AF=this.domNode.children[0].childNodes[AE];if(!this.userSelections[AE]){this.userSelections[AE]=true;B.addClass(AF,"selected");}u(AF,this.domNode);}return AF;},onscroll:function m(){var AC=this.getUserSelectedData();if(AC.length!==0&&AC[0].isLinked){this.raiseEvent({name:"drawLinks",source:this,oid:AC[0].oid});}},draggable:true,dropZone:true,allowDrop:function D(AD){var AE=AD.src&&AD.src.data;var AC=AE&&AE.length;AE=AE&&AE[0];if(AE&&AE.tableId===this.tableData.id){return this.convertEnabled&&AE.tp!==this.tp&&Y.indexOf([AA,W],AD.action)!==-1;}return AD.action===AA&&AE.tp===this.tp&&AC===1;},ondrop:function c(AD){var AJ=mstrApp.getRootController(),AG=AD.src,AK=AJ.model,AC=AK.isFromPushApi();if(AG&&AG.data){var AI=AG.data,AL=I.findAncestorByAttr(AD.tgt.node,AB,true,this.domNode),AE;if(this.tableData.id===AI[0].tableId){if(AD.action===AA&&this.tp===C.METRIC){if(AC){for(var AH=0;AH<AI.length;AH++){if(AI[AH].isMultiForm){var AM=this._super(AD);AJ.displayError(mstrmojo.desc(14868,"Converting a Multiform attribute to a metric is not supported when the table is created using the MicroStrategy Data Push api."),false);return AM;}}}AJ.toMetric(AI);}if(AD.action===W&&this.tp===C.ATTRIBUTE){AJ.toAttribute(AI);}}else{if(AL&&AI.length===1&&this.tp===AI[0].tp){this.domNode.scrollTop=50;AE=this.getTreeItem(AL.value);var AF=AD.tgt;AF.data=[AE];this.raiseEvent({name:"tableSelectionClear"});this.selectItem("did",AE.did);AJ.linkAttributes(AF,AG);this.parent.parent.parent.linker.clearLinks();}}}if(this._super){this._super(AD);}},oncontextmenu:function e(AD){var AG=AD.src;var AF=AD.getTarget()||I.eventTarget(AD.hWin,AD.e);var AE=I.findAncestorByAttr(AF,"idx",true,this.domNode),AC=AE&&AE.value;if(!AG.userSelections[AC]&&!n.isCtrlKey(AD.hWin,AD.e)){this.raiseEvent({name:"tableSelectionClear"});this.onclick(AD);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");mstrmojo.ListMapperTable=mstrmojo.provide("mstrmojo.ListMapperTable",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table">',markupSuffix:"</table>",itemWrapperPrefix:function(E){return'<tbody class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"<tr><td>&nbsp;</td></tr>",itemWrapperSuffix:"</tbody>",wrapperNodes:function D(E){return this.wrapperParentNode(E).tBodies;},wrapperParentNode:function C(E){return E.getElementsByTagName("table")[0];},createWrapperNode:function B(E){var F=E.ownerDocument,G=F.createElement("tbody");return G;},findIndex:function A(G,J,I){if(J&&I){var F=G.domNode,E=this.wrapperParentNode(J),H=I.parentNode;while(H){if(H===E){return mstrmojo.array.findBin(this.wrapperNodes(J),I,"offsetTop",G.items&&G.items.length);}else{if(H===F){break;}}I=H;H=I.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.requiresCls("mstrmojo.WidgetListMapper");mstrmojo.WidgetListMapperTable=mstrmojo.provide("mstrmojo.WidgetListMapperTable",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperTable)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.base64","mstrmojo.SimpleXHR","mstrmojo.XHRServerTransport","mstrmojo.DI.WorkstationServerProxy");mstrmojo.requiresDescs(15068);var B="DI.WorkstationServerTransport";var C=mstrmojo.hash;var E=mstrmojo.desc(15068,"Server internal error");mstrmojo.DI.WorkstationServerTransport={serverRequest:function A(H,G,F){if(F.params.taskId==="openNativeWindow"){window.FormWrapper.openNativeWindow(JSON.stringify(F.params),F.params.windowType,G,H);}else{F.params.DITask="1";window.FormWrapper.serverDIRequest(G,JSON.stringify(F.params),H,"response");}},cancelRequest:function D(F){return false;},};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui._HasScroller","mstrmojo.css","mstrmojo.DI.DIHelpers");var F=mstrmojo.css,H=mstrmojo.string,A=mstrmojo.desc(14058,"Show Details"),E=mstrmojo.desc(14059,"Hide Details"),B=mstrmojo.DI.DIHelpers,D=mstrmojo.desc(14060,"We are sorry for the inconvenience. Please {contact} your administrator for help.").replace("{",'<span class="dyn-link">').replace("}","</span>");mstrmojo.ui.editors.ErrorDialogContent=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",markupString:'<div class="mstrmojo-error-content {@cssClass}" mstrAttach:click><div class="scroll-container"><div>{@shortDesc}</div><div class="contact">'+D+'</div><div class="toggle-details-link" >'+A+'</div><div class="error-details">{@longDesc}</div></div></div>',markupSlots:{scrollNode:function(){return this.domNode.firstChild;},contactNode:function(){return this.domNode.firstChild.children[1].getElementsByClassName("dyn-link")[0];},toggleDetailsNode:function(){return this.domNode.firstChild.children[2];},errorDetailsNode:function(){return this.domNode.firstChild.children[3];}},markupMethods:{onshowDetailsChange:function(){var K=this.showDetails;this.toggleDetailsNode.innerHTML=K?E:A;F.toggleClass(this.domNode,"show-details",K);this.updateScrollbars();}},cssClass:undefined,shortDesc:undefined,longDesc:undefined,showDetails:false,showToggle:true,enableContactStr:true,allowHTML:false,init:function I(K){this._super(K);this.shortDesc=this.shortDesc||mstrmojo.desc(14061,"An error has occurred");},onclick:function J(K){var M=K.getTarget(),L,N=this.longDesc;if(M===this.contactNode){L="mailto:?subject="+encodeURI("Issue: "+this.shortDesc)+(N?("&body="+encodeURI("Detail:\r\n"+N)):"");mstrApp.openPage(L,"_self");}else{if(M===this.toggleDetailsNode){this.set("showDetails",!this.showDetails);this.parent.raiseEvent({name:"EditorResized"});this.parent.positionDialog();}}},setupScrollNodes:function C(){this.scrollNode=this.scrollNode;},preBuildRendering:function G(){this._super&&this._super();if(!this.allowHTML){this.longDesc=H.encodeHtmlString(H.decodeHtmlString(this.longDesc,true),true);}},postBuildRendering:function(){var K=this.domNode.firstChild.children[1];this._super&&this._super();!this.showToggle&&F.addClass(this.toggleDetailsNode,"hide");!this.enableContactStr&&F.addClass(K,"invisible");}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");var J=mstrmojo.array,E=mstrmojo.hash,O=mstrmojo.func.wrapMethods,G=mstrmojo.DI.DIHelpers;function N(V){var S=[],P=mstrApp.getRootController().model.dbObjectsDisplayOptions,Q=mstrApp.getRootController().model.dbObjectsConnectionType,U=this,R=this.dbmsTypeFilter;J.forEach(V,function(W){if((W.disp&P)===P&&(R.length===0||J.indexOf(R,W.dbType)>-1)){if((W.connType&4)===4){S.push(W);}else{if((W.connType&Q)===Q||W.n===mstrmojo.DI.DIConstants.GenericDBStr){S.push(W);}}}});if(!U.dbVersion2dbId){U.dbVersion2dbId={};J.forEach(S,function(W){J.forEach(W.dbVersions,function(X){U.dbVersion2dbId[X.v]=W.id;});});}this.dsnMapDBs=V;this.supportedDBs=S;}function C(){var P=this;E.forEach(P.dbTypes,function(Q){if(Q.catSQL===1){P.catalogDbTypes.push(Q);}});}function B(P){P=P.sort(function(R,Q){return R.n.toLowerCase().localeCompare(Q.n.toLowerCase());});P.unshift({n:mstrmojo.desc(8526,"select a dsn"),nU:mstrmojo.desc(8526,"select a dsn").toUpperCase(),des:0});return P;}function F(P){P=P.sort(function(R,Q){return R.n.toLowerCase().localeCompare(Q.n.toLowerCase());});return P;}function A(U){if(!(U.DBInfo&&U.DBInfo.Preferences)){return U;}var Q,S=JSON.stringify(U),V,P=U.DBInfo.Preferences.driverNameSuffix;var R="Platform";if(mstrApp.isSingleTier){if(G.isWS()&&(navigator.platform.indexOf("Win")>-1)){R="WorkstationWin";}else{R=navigator.platform.indexOf("Win")===-1?"DesktopMac":"DesktopWin";}}Q=J.find(P,"n",R);V=P[Q];return JSON.parse(S.replace(/!#DRIVERSUFFIX#!/g,V.value));}function M(Q){var P=this;if(P.loaded){Q.success();}else{if(this.dbmsTypeFilter.length>0){this.dbmsTypeFilter.push(1100);}mstrApp.getRootController().model.submitRequest(O({success:function(S){S=A(S);var R=(S.DBMS.dbmss.dbms?[].concat(S.DBMS.dbmss.dbms):[]);P.dbms=R;P.dbms.sort(function(V,U){var X=V.db_ver;var W=U.db_ver;if(X<W){return 1;}if(X>W){return -1;}return 0;});P.dsndbms=R.sort(function(V,U){return V.n.toLowerCase().localeCompare(U.n.toLowerCase());});N.call(P,S.DBInfo.DBS);P.dbVersions=S.DBInfo.dbVersions;P.dbTypes=S.DBInfo.dbTypes;C.call(P);P.dbIDs=S.DBInfo.dbIDs;P.drivers=F(S.Drivers.Drivers);P.preferences=S.DBInfo.Preferences;P.dsns=B(S.DSNs.Dsns);P.loaded=true;}},Q),{taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,typeFilter:(mstrApp.isWorkstation&&!mstrApp.isSingleTier)?(this.dbmsVersionFilter.length?this.dbmsTypeFilter.toString():""):this.dbmsVersionFilter,versionFilter:(mstrApp.isWorkstation&&!mstrApp.isSingleTier)?(this.dbmsVersionFilter.length?this.dbmsVersionFilter.toString():""):this.dbmsVersionFilter,typeExcludeFilter:P.dbmsTypeExcludeFilter.join(","),versionExcludeFilter:P.dbmsVersionExcludeFilter.join(","),flags:15});}}function D(P,U){var R=this;var S={taskId:"arch.getDBObjects",skipSchemaIDCheck:true,showWait:true,flags:P};var Q=O({success:function(V){V=A(V);if(V.DBInfo){N.call(R,V.DBInfo.DBS);R.dbVersions=V.DBInfo.dbVersions;R.dbTypes=V.DBInfo.dbTypes;C.call(R);R.dbIDs=V.DBInfo.dbIDs;R.preferences=V.DBInfo.Preferences;}if(V.Drivers){R.drivers=F(V.Drivers.Drivers);}if(V.DSNs){R.dsns=B(V.DSNs.Dsns);}mstrApp.hideWait();}},U);mstrApp.showProgress();mstrApp.serverRequestQueue(S,U,mstrApp.taskQueue);}mstrmojo.warehouse.obj.DBObjects=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.obj.DBObjects",dbms:[],dsndbms:[],supportedDBs:[],dsnMapDBs:[],drivers:[],dsns:[],dbVersions:undefined,dbTypes:undefined,catalogDbTypes:[],dbIDs:undefined,preferences:undefined,dbmsTypeFilter:[],dbmsVersionFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],DBInfo:undefined,DBS:undefined,DSNs:undefined,Dsns:undefined,Preferences:undefined,Drivers:undefined,DBMS:undefined,dbmss:undefined,disp:undefined,dbVersion2dbId:undefined,load:function L(Q,P,R){this.dbmsTypeFilter=Q;this.dbmsVersionFilter=P;M.call(this,R);},populateDBProperties:function K(P){if(this.supportedDBs.length>0){P.success();}else{D.call(this,8,P);}},reloadDrivers:function H(P){D.call(this,2,P);},reloadDSNs:function I(P){D.call(this,4,P);},loaded:false});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.string");mstrmojo.requiresDescs(10,489,1279,1910,3687,7755,10171,10174,12448,12450,12539,12541,13978,14217,14218,14219,14220,14221,14222,14223,14224,14225,14226,14227,14228,14229);var a=mstrmojo.DI.DIConstants,K=mstrmojo.array,P=mstrmojo.hash,S=mstrmojo.DI.DIHelpers,J=mstrmojo.string,A=4000;var N={NT:1,RT:2,PT:3};var O={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2};var Z={1:a.columnDataTypes.integer,2:a.columnDataTypes.integer,3:a.columnDataTypes.dtdouble,6:a.columnDataTypes.dtdouble,7:a.columnDataTypes.dtfloat,21:a.columnDataTypes.integer,22:a.columnDataTypes.nlong,30:a.columnDataTypes.bigDecimal,34:a.columnDataTypes.int64};function W(d,e){var c=false;if(e==="amps"||e==="mtmps"){c=(d&a.columnState.missing)!==a.columnState.missing;return c;}if(e==="cmps"){c=false;return c;}return c;}function I(u,o,h,n,g,q,w){var c=a.columnState.newColumn,k=u.aimp,l=o.def?o.def.dicl.ups:o.sqc.ups,d=W(l,h),f,p,t=null,e,AB,j,AA,m,x;if(o.sqc){j=o.cln;AB=o.sqc;p=AB.als;m=w&&w.bft?w.bft:O[AB.dt.tp];x=Z[AB.dt.tp];AA=AB.ix+1;}else{j=o.def.cln;p=o.n;m=w?w.bft:O[o.def.dt.tp];AB=o.def.dicl;AA=AB.clix;x=Z[o.def.dt.tp];}var z=l===c;f={did:o.did||o.sqc.id,n:mstrmojo.string.decodeHtmlString(j),originalAlias:mstrmojo.string.decodeHtmlString(p),alias:mstrmojo.string.decodeHtmlString(p),isNew:z,columnState:l,selected:d,dtp:m,ctp:x,ix:AA,tp:d?AB.idot:0,idot:AB.idot,toDel:(l===a.columnState.missing),der:AB.der,hasMapped:true,isDI:true,type:h};switch(h){case"amps":p=k.atnm;t=k.atid;e=k.ipa;if(e){f.ipa=e;}if(p&&!q){f.alias=p;}f.isMultiForm=q;break;case"mtmps":t=u.mtid;p=u.mtn;if(p){f.alias=p;}break;case"cmps":break;}if(t){f.id=t;}if(n){f.tableId=n;}if(g){f.tableName=g;}if(w){f.afid=k.atid+w.fmid;f.fmn=w.fmn;f.fmid=w.fmid;f.oid=k.atid;f.shapeKey=w.sha;f.timerole=w.tim;}return f;}function D(q,d,g,x,k){var e,o,u,n,m=x.datap.tbid||k,f=x.datap.tbn,t,j,c,p,w,l,h;K.forEach(q,function(z){j=z.aimp;c=z.afmps;switch(g){case"amps":u=c.length;t=u>1;K.forEach(c,function(AA,AB){h=0;o=AA.sqc?AA:AA.col.oi;n=I(z,o,g,m,f,t,AA);n.georole=AA.geo;if(n.georole){h=1;}n.timerole=AA.tim;n.ipa=j.ipa;if(j.recurisve!==undefined){w=j.recurisve;l=j.rtbid;n.recursive=w?true:false;n.rtbid=l;if(z.rdcs!==undefined){p=z.rdcs;n.rdcs=p;}}else{n.recursive=false;}if(u===1){d.push(n);}else{if(AB===0){e={id:j.atid,tableId:m,n:j.atnm,alias:j.atnm,isMultiForm:true,ix:n.ix,oid:j.atid,selected:false,tp:12,subColumns:[],type:g,ipa:j.ipa};d.push(e);n.isIdForm=true;}if(h){e.georole=h;}n.isAttributeForm=true;e.subColumns.push(n);if(n.selected){e.selected=true;}}});break;case"mtmps":case"cmps":o=z.sqc?z:(z.col?z.col.oi:z.oi);e=I(z,o,g,m,null,null,null);d.push(e);break;}});}function V(e,g){var c=[];var d,f,j,h;if(!e||!g||g.length<=0){return c;}for(d=0;d<g.length;d++){f=g[d];j={id:f.atid,n:f.n};h={parent:e,child:j,ert:f.ert};if(f.hasOwnProperty("status")){h.status=f.status;}if(f.hasOwnProperty("relationship_type")){h.type=f.relationship_type;}c.push(h);c=c.concat(V(j,f.children));}return c;}function b(d,c){return d.ix-c.ix;}function H(d){var c,e=[];d.sort(b);K.forEach(d,function(f){c=f.subColumns;if(c&&c.length>1){c.sort(b);K.forEach(c,function(g){e.push(g);});f.dataIdx=-1;}else{e.push(f);}});e.sort(b);K.forEach(e,function(g,f){g.dataIdx=f;});}mstrmojo.DI.ImportSource=mstrmojo.declare(mstrmojo.Obj,null,{formCategory:null,type:-1,subtype:-1,key:"",currentIndex:-1,previews:{},mappings:{},originalMappings:{},sourceInfo:null,sheets:null,transformations:{},currentTransformations:null,currentPreview:null,currentMapping:null,transformedMapping:null,origTransformMapping:null,transformedPreview:null,tableID:null,relationships:{},relationship:null,state:0,lastRefreshedTime:null,nrows:0,binaryExists:false,executeAction:0,refreshType:0,cannotFetchPreview:false,tablePosition:null,hasRefreshedData:false,tableState:null,forceRepublish:false,schemaChanged:false,isMergedCube:false,isHierarchyRelationTable:function(){return !!K.filterOne(this.currentMapping,function(d){var e=false;if(d.subColumns&&(d.subColumns.length>0)){for(var c=0;c<d.subColumns.length;c++){if(d.subColumns[c].recursive===true&&d.subColumns[c].rdcs&&(d.subColumns[c].rdcs.length>0)){e=true;break;}}}return(d.recursive===true&&d.rdcs&&(d.rdcs.length>0))||e;});},hasRecursiveAttr:function(){return !!K.filterOne(this.currentMapping,function(d){var e=false;if(d.subColumns&&(d.subColumns.length>0)){for(var c=0;c<d.subColumns.length;c++){if(d.subColumns[c].recursive===true){e=true;break;}}}return(d.recursive===true)||e;});},getRecursiveAttr:function(){var c=[],d=K.filterOne(this.currentMapping,function(f){var g=false;if(f.subColumns&&(f.subColumns.length>0)){for(var e=0;e<f.subColumns.length;e++){if(f.subColumns[e].recursive===true){c.push(f.subColumns[e]);g=true;}}}return(f.recursive===true)||g;});return d.isMultiForm?c:d;},getRecursiveAttrAndMFA:function(){return K.filterOne(this.currentMapping,function(d){var e=false;if(d.subColumns&&(d.subColumns.length>0)){for(var c=0;c<d.subColumns.length;c++){if(d.subColumns[c].recursive===true){e=true;}}}return(d.recursive===true)||e;});},shouldDoNotImportHierarchy:function(){var c=false;if(!this.isHierarchyRelationTable()){return c;}else{c=K.filterOne(this.currentMapping,function(e){var f=false;if(e.subColumns&&(e.subColumns.length>0)){for(var d=0;d<e.subColumns.length;d++){if(e.subColumns[d].recursive===true){f=true;}}}return(e.type!=="cmps"&&!(e.recursive||f));});}return c;},postCreate:function(){this.relationships={};this.previews={};this.mappings={};this.originalMappings={};this.transformations={};var c=mstrApp.getRootController().model;if(c.operationMode===a.operationMode.create){this.executeAction=1;}},reset:function(){this.currentIndex=-1;this.previews={};this.mappings={};this.originalMappings={};this.sourceInfo=null;this.transformations={};this.sheets=null;this.currentPreview=null;this.currentTransformations=null;this.currentMapping=null;},canAutoMappingAndDetectRelation:function(){var d=mstrApp.getRootController().model.operationMode;var c=this.hasRefreshedData;if(this.xdaType===a.xdaType.qbSingleTable&&this.databaseType===A){return false;}return c;},canLaunchWrangler:function(){var d=mstrApp.getRootController().model.operationMode;var c=this.canAutoMappingAndDetectRelation();if(mstrApp.isSingleTier&&this.type===a.sourceType.file&&this.subtype===a.sourceSubtype.localFile){if(d!==a.operationMode.create){c=c&&this.projectID;}}return c;},initialize:function(e,c,d,f){this.type=e;this.subtype=c;this.key=d;this.tableID=f;},populate:function(f,g,e){var c=g;if(this.sourceInfo.sheetIndex>=0){this.currentIndex=this.sourceInfo.sheetIndex;}else{this.currentIndex=-1;}if((c&a.requestFlag.transformations)===a.requestFlag.transformations){if(!f.datap.trnsfs){c=c&(~a.requestFlag.transformations);}else{this.populateTransformations(f.datap.trnsfs,this.currentIndex,f.datap.data&&f.datap.data.chrn);this.currentTransformations=this.transformations[this.currentIndex];}}if((c&a.requestFlag.mapping)===a.requestFlag.mapping){if(!f.datap.maps){c=c&(~a.requestFlag.mapping);}else{var d=this.populateMappings(f,e);if(d.length>0){if((g&a.requestFlag.transformedPreview)===a.requestFlag.transformedPreview||((this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab)===true)){this.transformedMapping=d;this.origTransformMapping=mstrmojo.hash.clone(d);}else{this.mappings[this.currentIndex]=d;this.currentMapping=d;this.originalMappings[this.currentIndex]=mstrmojo.hash.clone(d);}this.formCategory=f.forms;}}}if((c&a.requestFlag.preview)===a.requestFlag.preview){if(!f.datap.data||!f.datap.data.dcs||f.datap.data.dcs.length===0){c=c&(~a.requestFlag.preview);this.cannotFetchPreview=true;}else{this.previews[this.currentIndex]=this.populatePreview(f.datap.data.dcs,this.previews[this.currentIndex]);this.currentPreview=this.previews[this.currentIndex];if(f.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",f.datap.data.timestamp);}if(f.datap.data.nrows){this.nrows=f.datap.data.nrows;}}}if((c&a.requestFlag.transformedPreview)===a.requestFlag.transformedPreview){if(!f.datap.data||!f.datap.data.dcs||f.datap.data.dcs.length===0){c=c&(~a.requestFlag.transformedPreview);this.cannotFetchPreview=true;}else{this.transformedPreview=this.populatePreview(f.datap.data.dcs,this.transformedPreview);if(f.datap.data.timestamp!==undefined){this.set("lastRefreshedTime",f.datap.data.timestamp);}if(f.datap.data.nrows){this.nrows=f.datap.data.nrows;}}}if((c&a.requestFlag.relationship)===a.requestFlag.relationship){if(!f.datap.relationship){c=c&(~a.requestFlag.relationship);}else{this.relationships[this.currentIndex]=this.populateRelationships(f.datap.relationship);this.relationship=this.relationships[this.currentIndex];}}return c;},invalidPreview:function(){this.currentPreview=null;this.transformedPreview=null;this.cannotFetchPreview=false;this.previews=[];},getCurrentMappings:function(c){var d;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){d=this.transformedMapping;}else{d=this.currentMapping;}if(typeof c==="function"){d=mstrmojo.array.filter(d,c);}return d;},getMappingChanges:function(){var c=this.currentMapping;var k=this.originalMappings[this.currentIndex];var g,e,h=[],m,f,l,d;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){c=this.transformedMapping||this.currentMapping;k=this.origTransformMapping||this.originalMappings[this.currentIndex];}if(!c||!k){return h;}for(g=0;g<c.length;g++){l=c[g];d=k[g];if(l.isMultiForm){m=this.findChanges(l,d);if(m){e=K.find(l.subColumns,"isIdForm",true);if(e>0){m.did=l.subColumns[e].did;}else{m.did=l.subColumns[0].did;}h.push(m);}l=l.subColumns;d=d.subColumns;for(e=0;e<l.length;e++){f=this.findChanges(l[e],d[e]);if(f){if(m&&f.did===m.did){P.copy(f,m);}else{h.push(f);}}}}else{f=this.findChanges(l,d);if(f){h.push(f);}}}return h;},findChanges:function L(f,c){var e,g;e={did:f.did,n:f.n};e.n=mstrmojo.string.encodeXMLAttribute(f.n);g=false;if(f.selected!==c.selected){e.cmf=(f.selected?1:0);e.ot=f.tp;g=true;}if(!f.ipa){if(c.ipa){g=true;e.alias=mstrmojo.string.encodeXMLAttribute(f.alias);e.oid="";e.frmid="";}else{if(f.oid!==c.oid){g=true;e.oid=f.oid;e.alias=f.alias;}if(f.tp===12){var d=false;if(c.tp!==12){if(f.fmid!==""){d=true;}}else{if(f.fmid!==c.fmid){d=true;}}if(d){g=true;e.frmid=f.fmid;}}if(f.alias!==c.alias){e.alias=mstrmojo.string.encodeXMLAttribute(f.alias);g=true;}}}else{if(c.tp===4){g=true;}else{if(!c.selected){g=true;}else{if(c.fmid!==f.fmid||c.oid!==f.oid){g=true;}}}if(g===true){e.oid=f.oid;e.frmid=f.fmid;}}if(f.alias!==c.alias){e.alias=mstrmojo.string.encodeXMLAttribute(f.alias);if(f.ipa===0){if(f.linkObjID!==null||f.linkObjID!==undefined){e.oid=f.linkObjID;}if(f.formID!==null||f.formID!==undefined){e.frmid=f.formID;}if(f.lv){e.lv=f.lv;}else{e.lv=0;}}if(f.tp===4&&f.lv){e.lv=f.lv;}g=true;}if(f.tp!==c.tp){e.ot=f.tp;g=true;}if(f.dtp!==c.dtp||f.ctp!==c.ctp){e.bft=f.dtp;if(f.ctp!==c.ctp){e.dt=f.ctp;}g=true;}if(!f.ipa){if(f.tp===12){if(c.tp===12){if(c.georole!==f.georole){g=true;e.georole=f.georole;}else{if(c.timerole!==f.timerole){g=true;e.timerole=f.timerole;}}}else{g=true;e.georole=f.georole;}}if(f.tp===12){if(c.tp===12){if(c.der!==f.der||c.dtp!==f.dtp){g=true;e.drvflg=f.der;}}else{g=true;e.drvflg=f.der;}}if(f.tp===12){if(c.tp===12){if(c.shapeKey!==f.shapeKey){g=true;e.shapekey=f.shapeKey;}}else{g=true;e.shapekey=f.shapeKey;}}}if((f.recursive!==c.recursive)&&f.tp===12){e.recurisve=f.recursive;g=true;}if(g){return mstrmojo.hash.copy(e);}return"";},isOriginColumnImported:function E(){var e=this.currentMapping;var d,c;if(e){for(c=0;c<e.length;c++){d=e[c];if((d.columnState&a.columnState.unchanged)===a.columnState.unchanged){return true;}}}return false;},getMissingColumns:function B(){var h=this.currentMapping;var c=[];var f,g,e,d;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){h=this.transformedMapping;}if(h){for(e=0;e<h.length;e++){f=h[e];if(f.isMultiForm){for(d=0;f.subColumns&&d<f.subColumns.length;d++){g=f.subColumns[d];if((g.columnState&a.columnState.missing)===a.columnState.missing&&(g.type==="amps"||g.type==="mtmps")){c.push(f);}}}else{if((f.columnState&a.columnState.missing)===a.columnState.missing&&(f.type==="amps"||f.type==="mtmps")){c.push(f);}}}}return c;},areAllColumnsMissing:function F(){var h=this.getCurrentMappings(function(j){return !j.isNew;});var d=this.getMissingColumns(),c=false,g=0,f,e;for(e=0;e<h.length;e++){f=h[e];if(f.isMultiForm){g+=f.subColumns.length;}else{g++;}}if(g===d.length){c=true;}return c;},populatePreview:function(f,l){if(!f.length){return null;}var k=f.length;var m=f[0].dvs.length;var h=[];var c=[];var d=[];var g,e;for(g=0;g<k;g++){c.push(f[g].dcns.cln);d.push(f[g].dcns);}for(e=0;e<m;e++){h[e]=[];for(g=0;g<k;g++){h[e].push(f[g].dvs[e]);}}for(e=m;e<49;e++){h[e]=[];for(g=0;g<k;g++){h[e].push("");}}if(!l){l=new mstrmojo.Obj();this.addDisposable(l);}l.set("chs",c);l.set("dcns",d);l.set("data",h);l.set("numOfRows",m+1);l.set("ignoredRows",0);return l;},populateMappings:function(e,d){if(this.type===a.sourceType.googleBigQuery){if(this.xdaType===a.xdaType.googleBigQuery){return this.populateQBMappings(e,d);}}if(this.type===a.sourceType.querybuilder&&this.xdaType===a.xdaType.querybuilder){return this.populateQBMappings(e,d);}var c=[];var f=e.datap.maps;D(f.amps,c,"amps",e,d);D(f.mtmps,c,"mtmps",e,d);D(f.cmps,c,"cmps",e,d);H(c);return c;},populateQBMappings:function U(AA,n){var d=[],o=AA.datap.maps,q=o.amps,w=o.mtmps,t,u,h,c,m,z,j,x,AB,l,e,f,p,g;var k=AA.datap.tbid||n;K.forEach(q,function(AC){h=AC.aimp;c=AC.afmps;x=c.length;if(AC.rdcs!==undefined){m=AC.rdcs;}K.forEach(c,function(AD,AE){g=0;AB=AD.sqc;l={id:h.atid,ipa:h.ipa,oid:h.atid,fmn:AD.fmn,fmid:AD.fmid,did:AB.id,afid:h.atid+AD.fmid,n:AD.cln,alias:AD.cln,isNew:(AB.ups===a.columnState.newColumn),columnState:AB.ups,selected:(AB.se===1),dtp:AD.bft,ctp:Z[AB.dt.tp],ix:AB.ix+1,tp:12,toDel:(AB.ups&4)?true:false,georole:AB.geo,der:AB.der,hasMapped:true,isDI:true,type:"amps",tableId:k};if(l.georole){g=1;}if(h.recurisve!==undefined){z=h.recurisve;j=h.rtbid;l.recursive=z?true:false;l.rtbid=j;if(m!==undefined){l.rdcs=m;}}else{l.recursive=false;}if(x===1){p=h.atnm;if(p){l.alias=p;l.isMultiForm=false;}d.push(l);}else{if(AE===0){e={id:h.atid,tableId:k,did:h.atid,n:h.atnm,alias:h.atnm,ix:AB.ix+1,tp:12,selected:false,isMultiForm:(x>1),oid:h.atid,subColumns:[],type:"amps",ipa:h.ipa};d.push(e);l.isIdForm=true;}if(g){e.georole=g;}l.isAttributeForm=true;e.subColumns.push(l);if(l.selected){e.selected=true;}}});});for(t=0,u=w.length;t<u;t++){f=w[t];AB=f.sqc;d.push({id:f.mtid,tableId:k,did:AB.id,alias:f.mtn,n:f.cln,selected:(AB.se===1),hasMapped:true,isDI:true,dtp:O[AB.dt.tp],ctp:Z[AB.dt.tp],ix:AB.ix+1,tp:4,georole:AB.geo,der:AB.der,toDel:(AB.ups&4)?true:false,type:"mtmps"});}mstrmojo.hash.forEach(o.cmps,function(AC){AB=AC.sqc;d.push({did:AB.id,alias:AB.exp.exp,n:AB.exp.exp,selected:false,hasMapped:false,isDI:true,dtp:O[AB.dt.tp],ctp:Z[AB.dt.tp],ix:AB.ix+1,tp:0,type:"cmps"});});H(d);return d;},populateSheets:function(g,h){var e;var d=[];var c=-1;var f;if(this.currentIndex&&this.currentIndex!==-1){h=this.currentIndex;}if(g){for(e=0;e<g.length;e++){if(g[e]!=="*"){if(c===-1){c=e;}if(h){f=(e===h);}else{f=(e===c);}d.push({index:e,name:g[e],selected:f,isAutoMapped:false});}}if(d.length>0&&K.find(d,"selected",true)<0){d[0].selected=true;}this.set("sheetsInfo",d);}},populateTransformations:function(f,c,k){var h=this.transformations[c],e;if(!h){h=new mstrmojo.Obj();this.addDisposable(h);}var g;function j(){var l='<trnsfs count="1" >';if(this.isCrosstab){l+='<trnsf trnsftype="'+a.transformation.xtab+'">';if(this.mhb.startColumn===-1&&this.mhb.startRow===-1){l+='<mhdrs srow="-1" scol="-1" erow="-1" ecol="-1" />';}else{l+='<mhdrs srow="'+(this.mhb.startRow+k)+'" scol="'+this.mhb.startColumn+'" erow="'+(this.mhb.endRow+k)+'" ecol="'+this.mhb.endColumn+'" />';}l+='<dtrng srow="'+(this.db.startRow+k)+'" scol="'+this.db.startColumn+'" erow="'+(this.db.endRow+k)+'" ecol="'+this.db.endColumn+'" />';l+="</trnsf>";}else{l+='<trnsf trnsftype="'+a.transformation.xtab+'" fg="1" />';}l+="</trnsfs>";return l;}for(e=0;e<f.length;e++){var d=f[e];if(d.tp===a.transformation.xtab){g=new mstrmojo.Obj({isCrosstab:(d.fg!==1),mhb:new mstrmojo.Obj({startRow:(d.clrngs[0].srow===-1)?-1:(d.clrngs[0].srow-k),startColumn:d.clrngs[0].scol,endRow:(d.clrngs[0].erow===-1)?-1:(d.clrngs[0].erow-k),endColumn:d.clrngs[0].ecol}),db:new mstrmojo.Obj({startRow:(d.clrngs[1].srow===-1)?-1:(d.clrngs[1].srow-k),startColumn:d.clrngs[1].scol,endRow:(d.clrngs[1].erow===-1)?-1:(d.clrngs[1].erow-k),endColumn:d.clrngs[1].ecol}),getXML:j});}}h.set("xtab",g);if(g){h.addDisposable(g);if(g.mhb){g.addDisposable(g.mhb);}if(g.db){g.addDisposable(g.db);}}this.transformations[c]=h;},populateRelationships:function R(h){var l=[];var d,c,f,e,g;var k=[];if(h){for(d=0;d<h.length;d++){f=h[d];e={id:f.atid||f.paid,n:f.n};l=l.concat(V(e,f.children));}}for(d=0;d<l.length;d++){f=l[d];g=false;for(c=0;c<k.length;c++){if(k[c].parent.id===f.parent.id&&k[c].child.id===f.child.id){g=true;break;}}if(!g){k.push(f);}}return k;},getSourceObjectType:function Q(){var d=mstrmojo.desc(489,"File"),c=a.xdaType;switch(this.type){case a.sourceType.file:d=mstrmojo.desc(489,"File");break;case a.sourceType.googleDrive:d=mstrmojo.desc(489,"File");break;case a.sourceType.dropbox:d=mstrmojo.desc(489,"File");break;case a.sourceType.salesforce:d=mstrmojo.desc(1279,"Report");break;case a.sourceType.googleAnalytics:d=mstrmojo.desc(1279,"Report");break;case a.sourceType.googleBigQuery:d=mstrmojo.desc(14217,"Query");break;case a.sourceType.querybuilder:if(this.xdaType===c.qbSingleTable){d=mstrmojo.desc(7755,"Table");}if(this.xdaType===c.querybuilder){d=mstrmojo.desc(14218,"Builder");}if(this.xdaType===c.ffsql){d=mstrmojo.desc(1910,"Data");}break;case a.sourceType.bisource:d=mstrmojo.desc(1910,"Data");break;case a.sourceType.facebook:d=mstrmojo.desc(3687,"Page");break;case a.sourceType.twitter:d=mstrmojo.desc(10,"Search");break;}return d;},getDataSource:function C(){var d="",e=a.xdaType,c=a.sourceType;switch(this.type){case c.file:d=mstrmojo.desc(489,"File");switch(this.subtype){case a.sourceSubtype.localFile:if(this.xdaType===e.excel){d=mstrmojo.desc(14219,"Excel Data");}if(this.xdaType===e.text){d=mstrmojo.desc(14220,"Text Data");}break;case a.sourceSubtype.url:if(this.xdaType===e.excel){d=mstrmojo.desc(14221,"URL Excel Data");}if(this.xdaType===e.text){d=mstrmojo.desc(14222,"URL Text Data");}break;case a.sourceSubtype.samplefile:d=mstrmojo.desc(12539,"Sample File");break;case a.sourceSubtype.publicData:d=mstrmojo.desc(13978,"Public Data");break;case a.sourceSubtype.clipboard:d=mstrmojo.desc(12541,"Custom Data");break;}break;case c.googleDrive:d=mstrmojo.desc(14223,"Google Drive File");break;case c.dropbox:d=mstrmojo.desc(14224,"Dropbox File");break;case c.salesforce:d=mstrmojo.desc(14225,"Salesforce Report");break;case c.googleAnalytics:d=mstrmojo.desc(12448,"Google Analytics");break;case c.googleBigQuery:d=mstrmojo.desc(12450,"Google Big Query");break;case c.querybuilder:if(this.xdaType===e.qbSingleTable){d=mstrmojo.desc(14226,"Individual Table");}if(this.xdaType===e.querybuilder){d=mstrmojo.desc(14227,"Query Builder");}if(this.xdaType===e.ffsql){d=mstrmojo.desc(14228,"Freeform SQL Data");}break;case c.bisource:d=mstrmojo.desc(14229,"BI Data");break;case c.facebook:d=mstrmojo.desc(10171,"Facebook");break;case c.twitter:d=mstrmojo.desc(10174,"Twitter");break;}return d;},getDataSourceDescription:function(){var c=mstrmojo.desc(13050,"###T Name: ###F."),d=mstrmojo.desc(13051," Sheet Name: ###S."),e="";if(this.getDataSource){e=this.getDataSource()+" ";}if(this.sourceInfo){c=c.replace("###T",this.getSourceObjectType());c=c.replace("###F",this.sourceInfo.dbTableName||this.sourceInfo.name);c=J.encodeHtmlString(c);if(this.sourceInfo.sheetName){d=d.replace("###S",J.encodeHtmlString(this.sourceInfo.sheetName));c+="<br>";c+=d;}}else{c="";}return e+"<br>"+c;},canSubscribe:function(){var c=false;var d=a.xdaType;if(this.iskrbpass){return false;}switch(this.xdaType){case d.excel:case d.text:if(this.sourceInfo&&this.sourceInfo.url!==""){c=true;}break;case d.qbSingleTable:case d.querybuilder:case d.ffsql:c=true;break;case d.dataImportOAuthDropbox:case d.dataImportOAuthSalesforce:case d.dataImportOAuthGDrive:case d.dataImportOAuthGAnalytics:case d.dataImportOAuthGBigQuery:case d.dataImportOAuthGBigQueryFFSQL:case d.dataImportOAuthGBigQuerySingleTable:case d.twitter:case d.facebook:c=true;break;}return c;},canSetAlternateSource:function G(){var c=false,d=a.xdaType;switch(this.xdaType){case d.excel:case d.text:if(this.sourceInfo&&this.sourceInfo.url!==""){c=true;}break;case d.qbSingleTable:c=true;break;}if(this.type===a.sourceType.hadoop){c=false;}if(this.type===a.sourceType.file&&this.subtype===a.sourceSubtype.samplefile){c=false;}return c;},canRefine:function Y(){var d=mstrApp.getRootController().getModel(),h=a.xdaType,c=a.sourceType,j=this.xdaType,g=this.type,f,e;f=(!d.isDirectDataAccess&&(j===h.ffsql||j===h.qbSingleTable||j===h.querybuilder))||g===c.file||g===c.googleDrive||g===c.dropbox||g===c.salesforce||g===c.twitter||g===c.facebook||g===c.googleAnalytics||(!d.isDirectDataAccess&&g===c.hadoop);if(mstrmojo.array.some(this.currentMapping,function(k){if(k.isMultiForm){for(e=0;e<k.subColumns.length;e++){if(k.subColumns[e].recursive){return true;}}}else{return k.recursive;}})){f=false;}return f;},canRandomSample:function(){var c=this.type;if(c===a.sourceType.salesforce||c===a.sourceType.dropbox||c===a.sourceType.googleDrive||c===a.sourceType.googleAnalytics||c===a.sourceType.googleBigQuery||c===a.sourceType.twitter||c===a.sourceType.facebook||c===a.sourceType.bisource||c===a.sourceType.hadoop){return false;}return true;},isFromPushApi:function M(){if(this.type===a.sourceType.dataFromPushApi){return true;}return false;},findMappingItem:function X(d){var f=null,g;var c;var e=false;if(this.currentTransformations&&this.currentTransformations.xtab&&this.currentTransformations.xtab.isCrosstab){g=this.transformedMapping;}else{g=this.currentMapping;}for(c=0;g&&c<g.length;c++){f=g[c];if(d.id){if(f.id&&f.id===d.id){e=true;break;}}else{if(d.oid){if(f.oid&&f.oid===d.oid){e=true;break;}}else{if(f.did===d.did){e=true;break;}else{if(d.type==="cmps"&&f.type==="cmps"&&d.alias===f.alias){e=true;break;}}}}}return e?f:null;},updateTablePosition:function(c){this.tablePosition=mstrmojo.hash.copy(c,this.tablePosition);},populatePosition:function(d){var e={},c=false;if(!this.tablePosition){K.forEach(d,function(f){switch(f.pri){case 135856129:e.y=f.pdv;break;case 135856130:e.x=f.pdv;break;case 134742017:e.w=f.pdv;break;case 134742018:e.h=f.pdv;break;}});if(e.hasOwnProperty("x")||e.hasOwnProperty("y")||e.hasOwnProperty("w")||e.hasOwnProperty("h")){this.tablePosition=e;c=true;}}return c;},isExtensionValid:function(g){var e=true,f,c,d;if(this.sourceInfo&&this.sourceInfo.dbTableName!==undefined&&g!==undefined){f=this.sourceInfo.dbTableName.toString();c=S.getExtensionType(f.substr(f.lastIndexOf(".")));f=g.toString();d=S.getExtensionType(f.substr(f.lastIndexOf(".")));}return e;},isRefined:function(){return !!this.sourceInfo.isRefined;},isParsed:function(){var d=this.sourceInfo,c=this.currentTransformations;if(c&&c.xtab&&c.xtab.isCrosstab){return true;}if(d&&d.hasNewHeaders){return true;}if(d&&d.skipRows>0){return true;}return false;}});mstrmojo.DI.ImportSource.ENUM_STATE=N;}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");var B=mstrmojo.DI.DIHelpers;var A=1010,C=552;function D(G,E,F){F=F||0.8;if(!G||!E){return{w:A,h:C};}return{w:(E*F>A?Math.floor(E*F):A).toString()+"px",h:(G*F>C?Math.floor(G*F):C).toString()+"px"};}mstrmojo.DI.DIWorkstationHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIWorkstationHelpers.shouldShowTitleBar=function(){var E=mstrApp.getRootController().rootView.inPageDialog;return !!mstrApp.isWorkstation&&(!!mstrApp.isPopup||!!E);};mstrmojo.DI.DIWorkstationHelpers.setNativeWindow=function(G,J){var F=1010,I=552,H=parseInt(G,10),E=parseInt(J,10);if(!window.FormWrapper||!window.FormWrapper.setWindowContentSize||mstrmojo.DI.DIWorkstationHelpers.isDIFullScreenModeOnMac()){return ;}if(G.match(/%$/)&&J.match(/%$/)){window.FormWrapper.setWindowContentSize(1200,680);}else{H=H<F?F:H;E=E<I?I:E;window.FormWrapper.setWindowContentSize(H,E);}};mstrmojo.DI.DIWorkstationHelpers.lockResize=function(){if(!window.FormWrapper||!window.FormWrapper.lockResize){return ;}window.FormWrapper.lockResize();};mstrmojo.DI.DIWorkstationHelpers.unlockResize=function(){if(!window.FormWrapper||!window.FormWrapper.unlockResize){return ;}window.FormWrapper.unlockResize();};mstrmojo.DI.DIWorkstationHelpers.getResponsivePageSize=function(F,E,G){if(B.getEnvObj().isServerBasedWS()&&!B.getEnvObj().isWSLiveMode()&&B.getEnvObj().isMac()){return F?(E?D(C,A,G?G:1):D(window.innerHeight,window.innerWidth,G?G:1)):(E?D(C,A,G?G:1):{w:"1366px",h:"768px"});}if(B.getEnvObj().isServerBasedWS()&&!B.getEnvObj().isWSLiveMode()&&B.getEnvObj().isWin()){return F?(E?D(C,A,G?G:1):D(window.innerHeight,window.innerWidth,G?G:1)):(E?D(C,A,G?G:1):mstrmojo.DI.DIWorkstationHelpers.getCurrentScreenSizeForWindowsWorkstation());}if(E){return D(C,A,1);}if(B.getEnvObj().isWebDataSet()||B.getEnvObj().isWebDossier()||B.getEnvObj().isWSDossier()){return D(window.innerHeight,window.innerWidth,G?G:null);}return D();};mstrmojo.DI.DIWorkstationHelpers.isDIFullScreenModeOnMac=function(){if(!window.FormWrapper||!window.FormWrapper.isDIFullScreenModeOnMac){return false;}return window.FormWrapper.isDIFullScreenModeOnMac();};mstrmojo.DI.DIWorkstationHelpers.getCurrentScreenSizeForWindowsWorkstation=function(){var G=mstrmojo.hash.walk("FormWrapper.getCurrentScreenSize",window),F=JSON.parse(G&&G()),E="1366px",H="768px";return{w:F&&F.width?((parseInt(F.width)*0.8).toString()+"px"):E,h:F&&F.height?((parseInt(F.height)*0.8).toString()+"px"):H};};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.DI.DIHelpers");var N=mstrmojo.dom,z=mstrmojo.DI.DIHelpers;var I,U,B;var AA={singleColumnSelect:1,multipleColumnSelect:2,singleRowSelect:3,multipleRowSelect:4};var x={directPaste:0,refreshPaste:1};function K(AI){var AJ="";if(AI.innerText!==undefined){AJ=AI.innerText;}else{if(AI.textContent!==undefined){AJ=AI.textContent;}else{AJ=AI.innerHTML;}}return AJ;}function H(AK,AI,AJ){if(!(AK.cellHash.hasOwnProperty(AI))){AK.cellHash[AI]=AJ;}}function Y(AK,AI){if(AI===undefined){return ;}if(AI===null){return ;}mstrmojo.css.removeClass(AI,["selected"]);mstrmojo.css.removeClass(AI,["super-selected"]);var AL=AK.table.rows[0].cells[AI.cellIndex];mstrmojo.css.removeClass(AL,["selectedHeader"]);mstrmojo.css.removeClass(AL,["super-selectedHeader"]);if(AK.showRowHeaders){var AJ=AK.table.rows[AI.parentNode.rowIndex].cells[0];mstrmojo.css.removeClass(AJ,["selectedHeader"]);}}function o(AL){var AJ=AL.selections;if(AJ===undefined){return ;}while(AJ.length>0){var AK=AJ.pop();while(AK.length>0){var AI=AK.pop();Y(AL,AI);}}}function AF(AL,AK){var AJ;var AM=AL.actionsMenu;var AI=AM.childNodes;for(AJ=3;AJ<AI.length;AJ++){mstrmojo.css.addClass(AI[AJ],["inactive"]);mstrmojo.css.removeClass(AI[AJ],["active"]);}switch(AK){case 1:mstrmojo.css.removeClass(AI[3],["inactive"]);mstrmojo.css.removeClass(AI[4],["inactive"]);mstrmojo.css.addClass(AI[3],["active"]);mstrmojo.css.addClass(AI[4],["active"]);break;case 2:mstrmojo.css.removeClass(AI[4],["inactive"]);mstrmojo.css.addClass(AI[4],["active"]);break;case 3:mstrmojo.css.removeClass(AI[5],["inactive"]);mstrmojo.css.removeClass(AI[6],["inactive"]);mstrmojo.css.addClass(AI[5],["active"]);mstrmojo.css.addClass(AI[6],["active"]);break;case 4:mstrmojo.css.removeClass(AI[6],["inactive"]);mstrmojo.css.addClass(AI[6],["active"]);break;default:break;}}function u(AM,AI){var AK,AJ;var AL=AM.selections;if(AL===undefined){return ;}for(AK=0;AK<AL.length;AK++){for(AJ=0;AJ<AL[AK].length;AJ++){if(AL[AK][AJ]===AI){Y(AM,AL[AK][AJ]);AL[AK].splice(AJ,1);return ;}}}}function k(AK,AW,AL,AT,AM){if(AW===undefined){return ;}var AQ,AU,AX,AV,AO,AJ=AL||false,AN=AT||false,AS,AI;if(!AJ&&!AN){o(AK);}AS=AW.cellIndex;AI=AW.parentNode.rowIndex;var AR=false;if(AL&&AW.className.indexOf("selected")!==-1){AR=true;}if(AK.showRowHeaders){if(AS===0&&AI===0){o(AK);AF(AK,0);return ;}}if(AI===0){AF(AK,AA.singleColumnSelect);if(AL){AF(AK,AA.multipleColumnSelect);}if(AM===undefined||(AM!==undefined&&(AM!=="dblclick"&&AM!=="contextmenu"))){for(AQ=0;AQ<AK.rowCount;AQ++){AV=AK.table.rows[AQ].cells[AS];if(AR){u(AK,AV);}else{mstrmojo.css.addClass(AV,["selected"]);var AP=AK.table.rows[0].cells[AV.cellIndex];mstrmojo.css.addClass(AP,["super-selectedHeader"]);if(AK.showRowHeaders){if(AQ!==0){AX=AK.table.rows[AQ].cells[0];mstrmojo.css.addClass(AX,["selectedHeader"]);}}AU=[];AU.push(AV);AK.selections.push(AU);}}}else{o(AK);mstrmojo.css.addClass(AW,["selected"]);AO=AK.table.rows[0].cells[AW.cellIndex];mstrmojo.css.addClass(AO,["selectedHeader"]);if(AK.showRowHeaders){AX=AK.table.rows[AW.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AX,["selectedHeader"]);}AU=[];AU.push(AW);AK.selections.push(AU);}}else{if(AK.showRowHeaders&&AS===0){AF(AK,AA.singleRowSelect);AU=[];for(AQ=1;AQ<AK.columnCount;AQ++){AV=AK.table.rows[AI].cells[AQ];if(AR){u(AK,AV);}else{mstrmojo.css.addClass(AV,["selected"]);AO=AK.table.rows[0].cells[AV.cellIndex];mstrmojo.css.addClass(AO,["selectedHeader"]);AU.push(AV);}}AK.selections.push(AU);if(!AR){AX=AK.table.rows[AI].cells[0];mstrmojo.css.addClass(AX,["selectedHeader"]);}if(AK.selections.length>1){AF(AK,AA.multipleRowSelect);}}else{AF(AK,0);if(AR){u(AK,AW);}else{mstrmojo.css.addClass(AW,["super-selected"]);AO=AK.table.rows[0].cells[AW.cellIndex];mstrmojo.css.addClass(AO,["selectedHeader"]);if(AK.showRowHeaders){AX=AK.table.rows[AW.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AX,["selectedHeader"]);}AU=[];AU.push(AW);AK.selections.push(AU);}}}if(AR){AK.selectedSource=null;}}B=function(AK){var AI,AJ=[];for(AI in AK){if(AK.hasOwnProperty(AI)){AJ.push(AI);}}return AJ;};function j(AI){var AJ=B(AI.cellHash).length>0;AI.raiseEvent({name:"WorksheetContentChanged",data:AJ});return AJ;}function F(AJ,AI){if((AJ.cellHash.hasOwnProperty(AI))){delete AJ.cellHash[AI];}}function c(AI){var AJ=AI.cellIndex;var AK=AI.parentNode.rowIndex;return AJ+"."+AK;}function f(AL){var AJ,AI;var AK=AL.selections;if(AK){for(AJ=0;AJ<AK.length;AJ++){for(AI=0;AI<AK[AJ].length;AI++){AK[AJ][AI].firstChild.innerHTML="";F(AL,c(AK[AJ][AI]));}}}AL.isDirty=j(AL);}function m(AI){AI.rowCount=AI.numOfRows;AI.columnCount=AI.numOfcols;AI.selections=[];var AN,AM;var AL=[],AR=AI.tableRowCellCssClass,AK=AR+" header";var AQ=AI.tableRowHeaderCssClass;var AJ=(AK?' class="'+AK+'"':"");var AS=(AR?' class="'+AR+'"':""),AP=[];var AO=z.getEnvObj().isWSMac()?"spellcheck=false":"";for(AN=0;AN<AI.rowCount;AN++){for(AM=0;AM<AI.columnCount;AM++){if(AI.showRowHeaders){if(AM===0){if(AN===0){AP[AM]='<td class="'+AQ+'"><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" ></div></td>";}else{AP[AM]='<td class="'+AQ+'"><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" >"+AN+"</div></td>";}}else{if(AN===0){AP[AM]="<td"+AJ+'><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" ></div></td>";}else{AP[AM]="<td"+AS+'><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" ></div></td>";}}}else{if(AN===0){AP[AM]="<td"+AJ+'><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" ></div></td>";}else{AP[AM]="<td"+AS+'><div class="'+AI.editableDivCssClass+'" contentEditable = "false" style="outline: 0;" '+AO+" ></div></td>";}}}AL[AN]="<tr>"+AP.join("")+"</tr>";}return AL.join("");}function n(AI){AI.source.table.parentNode.removeChild(U);}function q(AI){AI.cellHash={};AI.isDirty=j(AI);}function AE(AN){var AJ,AO=false,AL="";if(mstrmojo.dom.isWK===true){AL="webkitAnimationEnd";AO=true;}else{if(mstrmojo.dom.isFF===true){AL="animationend";AO=true;}else{if(mstrmojo.dom.isIE8===false&&mstrmojo.dom.isIE9===false){AL="MSAnimationEnd";AO=true;}else{if(mstrmojo.dom.isIE8===true||mstrmojo.dom.isIE9===true){AO=false;}}}}if(AO===true){U=document.createElement("div");AJ=AN.table.cloneNode(true);mstrmojo.css.addClass(AJ,["animated bounceOut"]);AN.table.parentNode.setAttribute("cssText","style=z-index: 0;position:absolute;");U.appendChild(AJ);U.setAttribute("cssText","style=z-index: 2;position:absolute;top:70px;");U.style.top="70px";U.style.position="absolute";if(AL!==""){U.addEventListener(AL,function(AP){AP.source=AN;n(AP);},false);}AN.table.parentNode.appendChild(U);}if(mstrmojo.dom.isIE8===true||mstrmojo.dom.isIE9===true){var AK=document.getElementsByName("tempTableSpan")[0];AK.innerHTML="<table>"+m(AN)+"</table>";var AI=document.getElementsByName("tableBody")[0];AI.parentNode.replaceChild(AK.firstChild.firstChild,AI);}else{AN.table.innerHTML=m(AN);}if(AN.selectedSource&&AN.selectedSource.firstChild&&AN.selectedSource.firstChild.contentEditable==="true"){AN.selectedSource.firstChild.contentEditable=false;}AN.selectedSource=null;o(AN);q(AN);AN.tableContainer.focus();var AM=AN.parent.domNode.clientWidth+36;AN.parent.refresh();AN.parent.adjustSize({size:{w:AM}});}function l(AL){var AK,AJ;var AM="";if(AL){for(AK=0;AK<AL.length;AK++){for(AJ=0;AJ<AL[AK].length;AJ++){var AI=AL[AK][AJ].firstChild;var AN=(AI.innerText||AI.textContent).replace("\n","");if(AJ===AL[AK].length-1){AM+=AN;}else{AM+=AN+"\t";}}if(AK!==AL.length-1){AM+="\n";}AM=AM.replace("\t\n","\n");}}return AM;}function S(AI){var AN,AK,AS,AJ;var AM=AI.table;if(AM===null||AM===undefined){return null;}var AO=AM.getElementsByTagName("tr");var AL="";var AR=0;if(AI.showRowHeaders){AR=1;}for(AN=0;AN<AO.length;AN++){var AP=AO[AN].cells;for(AK=AR;AK<AP.length;AK++){AJ=AP[AK].firstChild;AS=K(AJ).replace("\n","");AS=AS.replace(/&amp;/g,"&");AS=AS.replace(/"/g,'""');AS=AS.replace(/\xA0/g," ");if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){AS='"'+AS+'"';}else{AS="&quot;"+AS+"&quot;";}AL+=AS;if(AK!==AP.length-1){AL+=",";}}if(AN!==AO.length-1){AL=AL+"\n";}}var AV=AL.split("\n");for(AN=AV.length-1;AN>=0;AN--){var AU=AV[AN];var AQ=true;var AT=AU.split(",");for(AK=0;AK<AT.length;AK++){if(AT[AK]!=='""'){AQ=false;break;}}if(!AQ){break;}}AV=AV.slice(0,AN+1);AL=AV.join("\n");return AL;}function h(AI,AJ){var AK;if(AI.keyCode===17||AI.keyCode===91){return ;}if(AI.keyCode===8){if(!AJ.selectedSource){return ;}if(!AJ.selectedSource.firstChild){return ;}if(AJ.selectedSource.firstChild.innerHTML===""){F(AJ,c(AJ.selectedSource));}AJ.isDirty=j(AJ);}if(AI.keyCode===46){if(!AJ.selectedSource){return ;}if(!AJ.selectedSource.firstChild){return ;}if(AJ.selectedSource.firstChild.contentEditable!=="false"){AK=K(AJ.selectedSource.firstChild);if(AK.replace("\n","")===""){F(AJ,c(AJ.selectedSource));}AJ.isDirty=j(AJ);}return true;}if(AJ.selectedSource.firstChild.innerHTML===""){F(AJ,c(AJ.selectedSource));}else{H(AJ,c(AJ.selectedSource),AJ.selectedSource);}AJ.isDirty=j(AJ);}function AG(AJ){var AI=l(AJ.selections);var AK=document.getElementById(AJ.id+"_pseudoText");AK.value=AI;AK.focus();AK.select();}function C(AK,AI){var AJ;if(AK.table.rows[0].cells[AI]===null){return ;}for(AJ=0;AJ<AK.rowCount;AJ++){var AL=AK.table.rows[AJ];AL.deleteCell(AI);}AK.columnCount--;}function AH(AI,AO,AN,AL){var AM,AQ,AP=AN||0;if(AP===0){AQ=AO+1||AI.columnCount;}else{AQ=AO||AI.columnCount;}for(AM=0;AM<AI.rowCount;AM++){var AR=AI.table.rows[AM];var AJ=AR.insertCell(AQ);AJ.className=AI.tableRowCellCssClass;AJ.contentEditable=false;var AK=document.createElement("DIV");AK.contentEditable=false;AK.className=AI.editableDivCssClass;AK.style.outline="0";if(AL){AK.innerHTML=AL[AM];}if(AM===0){mstrmojo.css.addClass(AJ,["header"]);}AJ.appendChild(AK);}AI.columnCount++;AI.updateScrollbars();}function L(AL,AM){var AK,AJ;for(AK=0;AK<AM.length;AK++){for(AJ=0;AJ<AM[AK].length;AJ++){var AI=AM[AK][AJ].cellIndex;if(AI===-1){continue;}C(AL,AI);AH(AL);}}}function g(AJ,AI){AJ.table.deleteRow(AI);AJ.rowCount--;}function M(AI,AM,AO){var AL,AP,AN=AO||0;if(AN===0){AP=AM+1||AI.rowCount;}else{AP=AM||AI.rowCount;}var AQ=AI.table.insertRow(AP);for(AL=0;AL<AI.columnCount;AL++){var AJ=AQ.insertCell(AL);var AK=document.createElement("DIV");AK.contentEditable=false;AK.className=AI.editableDivCssClass;AK.style.outline="0";if(AL===0){if(AI.showRowHeaders){AJ.className=AI.tableRowHeaderCssClass;AK.innerHTML=AP++;}else{AJ.className=AI.tableRowCellCssClass;}}else{AJ.className=AI.tableRowCellCssClass;}AJ.appendChild(AK);}AI.rowCount++;AI.updateScrollbars();}function Z(AJ,AK){var AI;for(AI=0;AI<AK.length;AI++){g(AJ,AK[AI][0].parentNode.rowIndex);M(AJ);}}var V=(function(){var AJ,AI,AK=[];return{getSourceContent:function(AN,AM){AK=[];for(AJ=0;AJ<AN.rowCount;AJ++){var AL=AN.table.rows[AJ].cells[AM];AK.push(AL.firstChild.innerHTML);}return AK;},createDragDiv:function(AL,AR,AM){if(!AL.dragDiv){var AO=this.getSourceContent(AL,AR);AL.dragDiv=document.createElement("div");AL.dragDiv.className="testDragDiv";AL.dragDiv.style.left=AM.clientX+10+"px";AL.dragDiv.style.top=AM.clientY+"px";var AV=document.createElement("table");var AP=[],AU=I.tableRowCellCssClass+" selected",AN=AU+" header selectedHeader";var AT=(AN?' contentEditable = "false" class="'+AN+'"':"");var AS=(AU?' contentEditable = "false" class="'+AU+'"':""),AQ=[];for(AJ=0;AJ<10;AJ++){for(AI=0;AI<1;AI++){if(AJ===0){AQ[AI]="<td"+AT+'><div class="'+AL.editableDivCssClass+'" contentEditable = "false" style="outline: 0;">'+AO[AJ]+"</div></td>";}else{AQ[AI]="<td"+AS+'><div class="'+AL.editableDivCssClass+'" contentEditable = "false" style="outline: 0;">'+AO[AJ]+"</div></td>";}}AP[AJ]="<tr>"+AQ.join("")+"</tr>";}AV.innerHTML=AP.join("");AL.dragDiv.appendChild(AV);AL.table.parentNode.parentNode.parentNode.appendChild(AL.dragDiv);}else{AL.dragDiv.style.left=AM.clientX+10+"px";AL.dragDiv.style.top=AM.clientY+"px";}},removeDragDiv:function(AL){if(AL.dragDiv){AL.table.parentNode.parentNode.parentNode.removeChild(AL.dragDiv);AL.dragDiv=null;}},swapColumns:function(AN,AM){var AL=event.target.cellIndex;C(AN,AM);AH(AN,AL-1,0,AK);}};}());function e(AL,AJ,AK){var AI;if(AJ===-1){if(AK===AL.rowCount){AI=AL.table.rows[AL.rowCount-1].cells[0];}else{AI=AL.table.rows[AK].cells[0];}}else{if(AJ===AL.columnCount){AI=AL.table.rows[0].cells[AL.columnCount-1];}else{AI=AL.table.rows[0].cells[AJ];}}return AI;}function AD(AK){var AJ={};while(B(AK.cellHash).length>0){var AL=B(AK.cellHash).pop();var AI=AK.cellHash[AL];delete AK.cellHash[AL];var AM=c(AI);if(!(AJ.hasOwnProperty(AM))){AJ[AM]=AI;}}AK.cellHash={};AK.cellHash=AJ;AK.isDirty=j(AK);}function w(AK){var AJ;var AI=document.getElementsByClassName(AK.tableRowHeaderCssClass);for(AJ=1;AJ<AI.length;AJ++){AI[AJ].innerHTML=AI[AJ].parentNode.rowIndex;}}function E(AQ,AI){var AK,AJ,AM;if(AQ.e.target.className.indexOf("inactive")!==-1){return ;}if(AQ.e.target.className.indexOf("add_col")!==-1){AH(AI);return ;}if(AQ.e.target.className.indexOf("add_row")!==-1){M(AI);AD(AI);return ;}if(AQ.e.target.className.indexOf("clear_grid")!==-1){AE(AI);return ;}if(AQ.e.target.className.indexOf("insert_col")!==-1){AH(AI,AI.selectedSource.cellIndex,1);AD(AI);return ;}if(AQ.e.target.className.indexOf("delete_col")!==-1){AM=[];for(AK=0;AK<AI.selections.length;AK++){var AL=[];for(AJ=0;AJ<AI.selections[AK].length;AJ++){AL[AJ]=AI.selections[AK][AJ];}AM[AK]=AL;}var AN=AI.selectedSource.cellIndex;f(AI);o(AI);L(AI,AM);AD(AI);AI.selectedSource=e(AI,AN,-1);k(AI,AI.selectedSource);if(AI.showRowHeaders!==undefined&&AI.showRowHeaders===true){if(AI.columnCount===1){AF(AI,0);}}else{if(AI.columnCount===0){AF(AI,0);}}return ;}if(AQ.e.target.className.indexOf("insert_row")!==-1){if(AI.showRowHeaders!==undefined&&AI.showRowHeaders===true){M(AI,AI.selectedSource.parentNode.rowIndex,1);w(AI);AD(AI);}return ;}if(AQ.e.target.className.indexOf("delete_row")!==-1){if(AI.showRowHeaders!==undefined&&AI.showRowHeaders===true){AM=[];for(AK=0;AK<AI.selections.length;AK++){var AP=AI.selections[AK];var AO=[];for(AJ=0;AJ<AP.length;AJ++){AO[AJ]=AP[AJ];}AM[AK]=AO;}var AR=AI.selectedSource.parentNode.rowIndex;f(AI);o(AI);Z(AI,AM);w(AI);AD(AI);AI.selectedSource=e(AI,-1,AR);k(AI,AI.selectedSource);if(AI.rowCount===0){AF(AI,0);}}return ;}}function A(AI,AJ){if(AJ.showRowHeaders!==undefined&&AJ.showRowHeaders===true){if(AJ.selectedSource.cellIndex===0){AJ.selectedSource.firstChild.contentEditable=false;AI.e.stopImmediatePropagation();AI.e.preventDefault();return ;}}E(AI,AJ);AJ.selectedSource.firstChild.contentEditable=true;AJ.selectedSource.firstChild.focus();k(AJ,AJ.selectedSource,false,false,AI.e.type);return false;}function d(AI,AK){var AL=AI.e.target;if(AL.tagName==="DIV"){AL=AL.parentNode;}AK.selectedSource=AL;if(AK.showRowHeaders&&AL.cellIndex===0){return ;}AK.selectedSource.firstChild.contentEditable=true;if(AK.selectedSource.firstChild.innerHTML!==""){AK.selectedSource.setAttribute("data-editable","true");var AJ=window.getSelection();AJ.collapse(AK.selectedSource.firstChild,1);}AK.selectedSource.firstChild.focus();k(AK,AK.selectedSource,AI.e.ctrlKey,false,AI.e.type);}function AC(AN){var AL,AK,AJ;f(AN);var AO=0;if(AN.showRowHeaders){AO=1;}for(AL=0;AL<AN.rowCount;AL++){AJ=[];for(AK=AO;AK<AN.columnCount;AK++){if(AN.showRowHeaders){if(AK===0){continue;}}var AI=AN.table.rows[AL].cells[AK];mstrmojo.css.addClass(AI,["selected"]);var AP=AN.table.rows[0].cells[AI.cellIndex];mstrmojo.css.addClass(AP,["selectedHeader"]);if(AN.showRowHeaders){if(AL!==0){var AM=AN.table.rows[AI.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AM,["selectedHeader"]);}}AJ.push(AI);}AN.selections.push(AJ);}}function G(AW,AY){if(!AW.selections||(AW.selections&&AW.selections.length===0)){return ;}var AT=AW.selections[0][0],AU,AN;if(AY.cellIndex>AT.cellIndex){if(AY.parentNode.rowIndex<AT.parentNode.rowIndex){AU=AW.selections.length;AN=1;}else{AU=1;AN=1;}}else{if(AY.parentNode.rowIndex>AT.parentNode.rowIndex){AU=1;AN=AW.selections[0].length;}else{AU=AW.selections.length;AN=AW.selections[AU-1].length;}}var AQ=AW.selections[AU-1][AN-1];var AK=AQ.cellIndex;var AX=AQ.parentNode.rowIndex;var Ab=AY.cellIndex;var AV=AY.parentNode.rowIndex;if(AY.parentNode.rowIndex===0&&AQ.parentNode.rowIndex===0){AV=AW.rowCount-1;AF(AW,AA.multipleColumnSelect);}if(AW.showRowHeaders){if(AY.cellIndex===0&&AY.parentNode.rowIndex===0){o(AW);AF(AW,0);return ;}}o(AW);var AS=Math.min(AX,AV);var AP=Math.max(AX,AV);var AR=Math.min(AK,Ab);var AM=Math.max(AK,Ab);var Aa,AZ=0,Ac;for(Aa=AS;Aa<=AP;Aa++){var AO=[];for(AZ=AR;AZ<=AM;AZ++){if(AW.showRowHeaders){if(AZ===0){continue;}}var AL=AW.table.rows[Aa].cells[AZ];mstrmojo.css.addClass(AL,["selected"]);var AI=AW.table.rows[0].cells[AL.cellIndex];mstrmojo.css.addClass(AI,["selectedHeader"]);if(AW.showRowHeaders){if(Aa!==0){var AJ=AW.table.rows[AL.parentNode.rowIndex].cells[0];mstrmojo.css.addClass(AJ,["selectedHeader"]);}}if(Aa===AS&&AZ===AR){Ac=AL;}AO.push(AL);}AW.selections.push(AO);}mstrmojo.css.addClass(Ac,["super-selected"]);}function J(AJ,AI){if(!AI.selectedSource){return false;}if(AJ.keyCode===17||(AJ.metaKey===true&&AJ.keyCode===91)){AG(AI);return false;}if(AJ.keyCode===27){AI.selectedSource.firstChild.contentEditable=false;AI.tableContainer.focus();AI.selectedSource.firstChild.innerHTML=AI.preText;if(K(AI.selectedSource.firstChild).replace("\n","")===""){f(AI);}return true;}if(AJ.keyCode===67&&(AJ.ctrlKey||AJ.metaKey)){AI.selectedSource.firstChild.contentEditable=true;AI.selectedSource.firstChild.focus();AG(AI);return true;}if(AJ.keyCode===88&&(AJ.ctrlKey||AJ.metaKey)){AI.selectedSource.firstChild.contentEditable=true;AI.selectedSource.firstChild.focus();AG(AI);f(AI);return true;}if(AJ.keyCode===65&&(AJ.ctrlKey||AJ.metaKey)){f(AI);AC(AI);AF(AI,0);return true;}if(AJ.keyCode===16){return false;}var AK=AI.selectedSource.cellIndex;var AN=AI.selectedSource.parentNode.rowIndex;if(AI.showRowHeaders!==undefined&&AI.showRowHeaders===true){if(AK===0){if(AJ.keyCode===86&&(AJ.ctrlKey||AJ.metaKey)){AI.selectedSource.firstChild.contentEditable=true;AI.selectedSource.firstChild.focus();return false;}}}if(AJ.keyCode===46){if(AI.selectedSource.firstChild.contentEditable==="false"){f(AI);}return true;}var AP=false;if(AJ.keyCode===9){if(AJ.shiftKey){if((AK-1)>0){AK--;}}else{if(AK<=AI.columnCount-1){AK++;}}AP=true;}var AQ=AJ.keyCode;switch(AQ){case 37:AK--;AP=true;break;case 39:AK++;AP=true;break;case 38:AN--;AP=true;break;case 40:AN++;AP=true;break;}if(AP){if(AI.selectedSource.getAttribute("data-editable")==="true"){return false;}if(AI.selectedSource.firstChild.contentEditable==="true"){AI.selectedSource.firstChild.contentEditable=false;AI.tableContainer.focus();}if(AN<0||AN>AI.rowCount-1||AK<0||AK>AI.columnCount-1){return false;}AI.selectedSource=AI.table.rows[AN].cells[AK];if(!AJ.shiftKey&&!AJ.ctrlKey){k(AI,AI.selectedSource,AJ.ctrlKey,AJ.shiftKey);}else{if(AJ.shiftKey&&AJ.keyCode===9){k(AI,AI.selectedSource,false,false);}else{G(AI,AI.selectedSource);}}var AL=N.delta(AI.selectedSource,AI.table.parentNode.parentNode);var AM=!!(AL.y>=0&&AL.y<580);var AO=!!(AL.x>=0&&AL.x<950);if(AO&&AM){AJ.preventDefault();AJ.stopImmediatePropagation();}}else{if(AI.showRowHeaders!==undefined&&AI.showRowHeaders===true){if(AK===0){return false;}}if(AJ.keyCode===13){AI.selectedSource.setAttribute("data-editable","false");AI.selectedSource.firstChild.contentEditable=false;AI.tableContainer.focus();if(AN===AI.rowCount-1){M(AI);}AI.selectedSource=AI.table.rows[AN+1].cells[AK];AI.preText=AI.selectedSource.firstChild.innerHTML;k(AI,AI.selectedSource);}else{if(!AJ.ctrlKey&&!AJ.metaKey){if(AI.selectedSource.firstChild.contentEditable==="false"){AI.selectedSource.firstChild.contentEditable=true;AI.selectedSource.firstChild.focus();AI.preText=AI.selectedSource.firstChild.innerHTML;AI.selectedSource.firstChild.innerHTML="";}}}}return true;}function Q(AJ,AI){var AK="";if(AJ.e.target.className.indexOf("add_col")!==-1){AK="DIClipboard-add_col_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-add_col",!AI);}if(AJ.e.target.className.indexOf("add_row")!==-1){AK="DIClipboard-add_row_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-add_row",!AI);}if(AJ.e.target.className.indexOf("clear_grid")!==-1){AK="DIClipboard-clear_grid_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-clear_grid",!AI);}if(AJ.e.target.className.indexOf("insert_col")!==-1){AK="DIClipboard-insert_col_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-insert_col",!AI);}if(AJ.e.target.className.indexOf("insert_row")!==-1){AK="DIClipboard-insert_row_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-insert_row",!AI);}if(AJ.e.target.className.indexOf("delete_col")!==-1){AK="DIClipboard-delete_col_click";mstrmojo.css.toggleClass(AJ.e.target,"DIClipboard-delete_col",!AI);}mstrmojo.css.toggleClass(AJ.e.target,AK,AI);}function AB(AI,AJ){if(AI.e.target.getAttribute("type")==="menuItem"){Q(AI,false);}return false;}function D(AI,AJ){if(AI.e.target.getAttribute("type")==="menuItem"){Q(AI,true);return ;}if(AI.e.target.id===AJ.actionsMenu.id){return ;}if(AJ.selectedSource&&AJ.selectedSource.firstChild&&AJ.selectedSource.firstChild.contentEditable==="true"){if(AI.e.target.parentNode===AJ.selectedSource){return ;}AJ.selectedSource.firstChild.contentEditable=false;}AJ.tableContainer.focus();var AK=AI.e.target;if(AK.tagName==="DIV"){AK=AK.parentNode;}AJ.selectedSource=AK;AJ.preText=AK.firstChild.innerHTML;if(AI.e.shiftKey){G(AJ,AK);}else{k(AJ,AK,AI.e.ctrlKey);}if(AI.e.which!==3){AJ.clickPosition={x:AI.e.clientX,y:AI.e.clientY};AJ.domNode.addEventListener("mousemove",AJ.mouseSelections,false);AJ.domNode.addEventListener("mouseup",AJ.removeSelections,false);}}function b(AI,AM,AL){var AN=AI.target;if(AN.tagName==="DIV"){AN=AN.parentNode;}if(AM.dragColumns){if(AN.parentNode.rowIndex===0){if(AI.clientX<AM.clickPosition.x-10||AI.clientX>AM.clickPosition.x+10||AI.clientY<AM.clickPosition.y-10||AI.clientY>AM.clickPosition.y+10){if(AL.dropTarget){AL.dropTarget.setAttribute("style","border-right:1px solid;");}V.createDragDiv(AM,AM.selectedSource.cellIndex,AI);AM.table.setAttribute("style","cursor:move;");AL.dropTarget=AN;AL.dropTarget.setAttribute("style","border-right:3px solid;");}}else{V.removeDragDiv(AM,AI);if(AL.dropTarget!=="undefined"){AL.dropTarget.setAttribute("style","border-right:1px solid;");AL.dropTarget=null;}G(AM,AN);}}if(AM.resizeColumns){if(AN.parentNode.rowIndex===0){AM.table.setAttribute("style","cursor:w-resize;");var AJ=parseInt(AN.clientWidth,10);var AP=AI.clientX-AM.clickPosition.x;if(AP!==0){var AK=AJ+AP;var AO=AK+50;AN.setAttribute("style","max-width:"+AO+"px;");AN.setAttribute("style","width:"+AK+"px;");}}else{G(AM,AN);AM.table.setAttribute("style","cursor:auto;");}}else{G(AM,AN);}}function X(AI,AK,AJ){AJ.removeEventListener("mousemove",AK.mouseSelections);AJ.removeEventListener("mouseup",AK.removeSelections);if(AK.dragColumns){if(AK.selectedSource.parentNode.rowIndex===0){if(AI.clientX<AK.clickPosition.x-10||AI.clientX>AK.clickPosition.x+10||AI.clientY<AK.clickPosition.y-10||AI.clientY>AK.clickPosition.y+10){if(AJ.dropTarget){AJ.dropTarget.setAttribute("style","border-right:1px solid;");AJ.dropTarget=null;}V.removeDragDiv(AK,AI);V.swapColumns(AK,AK.selectedSource.cellIndex,AI);}}}AK.table.setAttribute("style","cursor:auto;");}function a(AR,AI,AQ){var AP,AO,AS,AV;if(mstrmojo.string.trim(AR)===""){return ;}AI.table.setAttribute("style","cursor:wait;");if(AR.length>50000){mstrApp.getRootController().displayError(mstrmojo.desc(12578,"Please paste less data, maximum limit is 50000 characters!"));AI.table.setAttribute("style","cursor:auto;");AI.isDirty=j(AI);return ;}if(AR.indexOf(String.fromCharCode(10))!==-1){AS=AR.split(String.fromCharCode(10));}else{AS=AR.split(String.fromCharCode(13));}if(AS.length>0){if(AS[AS.length-1]===""||AS[AS.length-1]===String.fromCharCode(10)){AS.splice(AS.length-1,1);}}var AN=false;var AM=AQ||x.directPaste;if(AS.length===1&&AM!==x.refreshPaste){AN=true;}for(AP=0;AP<AS.length;AP++){AS[AP]=AS[AP].split(String.fromCharCode(9));if(AS[AP].length>1){AN=false;}}if(AN){for(AP=0;AP<AI.selections.length;AP++){for(AO=0;AO<AI.selections[AP].length;AO++){AV=AI.selections[AP][AO].firstChild;if(AV.innerText!==undefined){AV.innerText=AR;}else{AV.textContent=AR;}H(AI,c(AI.selections[AP][AO]),AI.selections[AP][AO]);}}}else{var AJ=AI.selections[0][0].cellIndex;var AU=AI.selections[0][0].parentNode.rowIndex;var AL=AU+AS.length-AI.rowCount;var AT=AS[0].length;for(AP=0;AP<AS.length;AP++){AT=Math.max(AS[AP].length,AT);}var AK=AJ+AT-AI.columnCount;for(AP=0;AP<AL;AP++){M(AI);}for(AP=0;AP<AK;AP++){AH(AI);}for(AP=0;AP<AS.length;AP++){for(AO=0;AO<AS[AP].length;AO++){AV=AI.table.rows[AU+AP].cells[AJ+AO];if(AV.firstChild.innerText!==undefined){AV.firstChild.innerText=AS[AP][AO];}else{AV.firstChild.textContent=AS[AP][AO];}H(AI,c(AV),AV);AV.contentEditable=false;}}}AI.isDirty=j(AI);AI.table.setAttribute("style","cursor:auto;");}function P(AI,AJ){if(navigator.userAgent.indexOf("Trident")!==-1||mstrmojo.dom.isIE){a(window.clipboardData.getData("Text"),AJ);AI.e.preventDefault();}else{AJ.selectedSource.firstChild.contentEditable=false;a(AI.e.clipboardData.getData("Text"),AJ);}AJ.tableContainer.focus();AJ.updateScrollbars();}function O(AJ){var AI="";AI='<div type = "menuItem" class="active DIClipboard-add_col" mstr_title = "'+mstrmojo.desc(7555,"Add Column")+'"></div>';AI+='<div type = "menuItem" class="active DIClipboard-add_row" mstr_title = "'+mstrmojo.desc(12572,"Add Row")+'"></div>';if(AJ.clearSheet){AI+='<div type = "menuItem" class="active DIClipboard-clear_grid" mstr_title = "'+mstrmojo.desc(12573,"Clear Sheet")+'"></div>';}AI+='<div type = "menuItem" class="inactive DIClipboard-insert_col" mstr_title = "'+mstrmojo.desc(12574,"Insert Column")+'"></div>';AI+='<div type = "menuItem" class="inactive DIClipboard-delete_col" mstr_title= "'+mstrmojo.desc(12575,"Delete Column")+'"></div>';if(AJ.showRowHeaders!==undefined&&AJ.showRowHeaders===true){AI+='<div type = "menuItem" class="inactive DIClipboard-insert_row" mstr_title= "'+mstrmojo.desc(12576,"Insert Row")+'"></div>';AI+='<div type = "menuItem" class="inactive DIClipboard-delete_row" mstr_title= "'+mstrmojo.desc(12577,"Delete Row")+'"></div>';}return AI;}function W(AI,AJ){AJ.richTooltip.refNode=AI.target;AJ.richTooltip.content=AI.target.getAttribute("mstr_title");AJ.richTooltip.left="12px";AJ.showTooltip(AI.e,self);}mstrmojo.Worksheet=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Worksheet",cssClass:"mstrmojo-di-worksheet-main-container",tableCssClass:"mstrmojo-di-worksheet-main-table",tableRowCellCssClass:"mstrmojo-di-worksheet-table-row-cell",tableRowHeaderCssClass:"mstrmojo-di-worksheet-table-rowHeader-cell",buttonCssClass:"mstrmojo-di-worksheet-buttonCssClass",numOfRows:10,numOfcols:5,showRowHeaders:false,selectedSource:null,selections:null,preText:"",isDirty:false,cellHash:{},dropTarget:null,dragColumns:false,clearSheet:false,resizeColumns:false,editableDivCssClass:"mstrmojo-di-worksheet-nonHighlightDiv",tableHtml:undefined,listHtml:undefined,markupString:'<div id="{@id}" class="{@cssClass}" mstrAttach:keydown,keyup><div id="{@id}" class = "mstrmojo-di-worksheet-navigationMenu" mstrAttach:click,mousedown,mouseup>{@listHtml}</div><div id="{@id}" class = "mstrmojo-di-worksheet-table-container" tabindex="0"><div class = "mstrmojo-di-worksheet-table-scroller"><table id="{@id}" class="{@tableCssClass}"><tbody id ="tableBody" mstrAttach:dblclick,contextmenu,mousedown,paste>{@tableHtml}</tbody></table></div></div><span id="tempTableSpan" style="visibility:hidden"></span><textarea id = "{@id}_pseudoText" class="mstrmojo-di-worksheet-copyTextBox" mstrAttach:paste></textarea></div>',markupSlots:{containerNode:function(){return this.domNode;},actionsMenu:function(){return this.domNode.firstChild;},tableContainer:function(){return this.domNode.childNodes[1];},table:function(){return this.domNode.childNodes[1].firstChild.lastChild;},tableScrollerNode:function(){return this.domNode.childNodes[1].firstChild;}},setupScrollNodes:function p(){this.scrollNode=this.tableScrollerNode;},setInitialSelection:function R(AJ){var AI=this;k(this,AJ);AJ.firstChild.contentEditable=false;window.setTimeout(function(){AI.tableContainer.focus();},0);},preBuildRendering:function(){I=this;if(!!mstrApp.isWSStyling&&!mstrApp.isPopup){this.set("tableRowCellCssClass","mstrmojo-di-worksheet-table-row-cell flexible");}this.tableHtml=m(this);this.listHtml=O(this);if(this._super){this._super();}},postBuildRendering:function(){var AI=0,AK=this.actionsMenu.clientHeight;if(this._super){AI=this._super();}this.selectedSource=this.table.rows[0].cells[1];this.setInitialSelection(this.selectedSource);q(this);j(this);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A root-toolbar-tooltip",posType:mstrmojo.tooltip.POS_TOPCENTER,top:AK});if(!this._ontooltipover){var AJ=this.id;this._ontooltipover=function(AM){var AL=mstrmojo.all[AJ];W(AM,AL);};this._ontooltipout=function(AM){var AL=mstrmojo.all[AJ];AL.hideTooltip(AM,self);};}mstrmojo.dom.attachEvent(this.actionsMenu,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.actionsMenu,"mouseout",this._ontooltipout);return AI;},oncontextmenu:function(AI){A(AI,this);},onclick:function(AI){E(AI,this);},onmousedown:function(AI){D(AI,this);},onmouseup:function(AI){AB(AI,this);},mouseSelections:function(AI){b(AI,I,this);},removeSelections:function(AI){X(AI,I,this);},ondblclick:function(AI){d(AI,this);},onpaste:function(AI){P(AI,this);},onkeydown:function(AI){J(AI.e,this);},onkeyup:function(AI){h(AI.e,this);},formatData:function t(AP){if((AP.datap&&AP.datap.data&&AP.datap.data.dcs)===undefined){return null;}var AN=AP.datap.data.dcs,AM=AN.length,AJ=0,AL,AK,AI="";for(AL=0;AL<AM;AL++){AJ=Math.max(AN[AL].dvs.length,AJ);}for(AK=0;AK<AM;AK++){AI+=AN[AK].dcns.cln;if(AK!==AM-1){AI+="\t";}}AI+="\n";for(AL=0;AL<AJ;AL++){for(AK=0;AK<AM;AK++){var AO=AN[AK].dvs[AL];if(AO!==null){AI+=AO;}else{AI+="";}if(AK!==AM-1){AI+="\t";}}AI+="\n";}return AI;},getData:function(){return S(this);},setData:function(AJ){var AI=this.formatData(AJ);if(AI!==null){a(AI,this,x.refreshPaste);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12604,12605,12607,12608,12893,12894,12895,12896,13302,13994,16025);var U=mstrmojo.DI.DIConstants,P=mstrmojo.DI.DIHelpers,B=mstrmojo.dom,M=mstrmojo.hash;function N(X){var W="oAuthSourcelogout";var V=document.getElementById(W);if(!V){V=document.createElement("IFRAME");V.id=W;document.body.appendChild(V);V.style.display="none";}V.src=X;}function O(X){var a=/&?redirect_uri=([^&]*)&?/;var W=/^((https|http):\/\/[^\/]+)\/?/;var Z,V,Y;Z=a.exec(X);if(Z){V=window.decodeURIComponent(Z[1]);Z=W.exec(V);if(Z){Y=Z[1];}}return Y;}function H(){var V=this.getRootController();return V.CDDIcontroller?V.CDDIcontroller:V;}mstrmojo.DI.controller.DIOAuthController=mstrmojo.declare(mstrmojo.Obj,null,{popupWnd:null,responseHandler:null,beforeOAuth:function(){var V;if(!this.popupWnd||this.popupWnd.closed){V=P.createOAuthPopupWindow();this.popupWnd=V.wnd;}return !!this.popupWnd;},afterOAuth:function(){var V=this;window.setTimeout(function(){if(V.popupWnd&&!V.popupWnd.closed){V.popupWnd.close();}V.popupWnd=null;},0);},getExternalSourcesInfo:function F(){var V=mstrApp.getRootController(),Y=V.getModel(),X=window.location.href.toLowerCase(),W=P.getURLParameters(X);if(window.opener&&(X.indexOf("code=")>=0||X.indexOf("oauth_token")>=0||X.indexOf("accesstoken")>=0||X.indexOf("denied=")>=0||X.indexOf("access_denied")>=0||(W.state&&W.state.toUpperCase()==="OC"))){Y.set("operationMode",U.operationMode.oauth);P.sendResponse2Window(window.location.href);}else{if(window.opener&&(mstrApp.diParams.code||X.indexOf("authenticated=")>=0)){Y.set("operationMode",U.operationMode.oauth);P.sendResponse2Window(window.location.href+"&code="+mstrApp.diParams.code);}else{Y.populateExternalSources();V.restoreForLaunchingApp();}}},oAuthSignOut:function K(a){var X=mstrApp.getRootController(),e=X.model.externalSources[a],W={},c,b,Z,V,Y=parseInt(a,10);var d={success:function(){var f;e.reset();if(Y===U.sourceType.facebook){f=P.getPopupWindowOptions();window.open("https://www.facebook.com","",f);return ;}b=X.navigationController.getPageSlot();if(Z){b.setConfig(Z);}X.getOAuthSourceReports(a,false,b);}};if(!e){X.displayError(mstrmojo.desc(12608,"Could not log out. Please do so by manually going to the website"),false);}if(P.isIE7()&&Y===U.sourceType.salesforce){window.location.href="https://embedexpress-dev-ed.my.salesforce.com/secur/logout.jsp";}else{switch(Y){case U.sourceType.dropbox:N("https://www.dropbox.com/logout");break;case U.sourceType.googleDrive:N("https://www.google.com/accounts/logout");break;case U.sourceType.googleAnalytics:N("https://www.google.com/accounts/logout");break;case U.sourceType.salesforce:V="https://embedexpress-dev-ed.my.salesforce.com/secur/logout.jsp";if(e.instanceUrl){V=e.instanceUrl+"/secur/logout.jsp";}N(V);break;case U.sourceType.twitter:N("https://twitter.com/logout");break;}if(X.rootView.currentPage){c=X.navigationController.getPageSlot(X.rootView.currentPage.pageSlotKey);Z=c.getConfig();}if(X.rootView.currentPage&&X.rootView.currentPage.tableID){X.showPage(U.pageType.emmaPreview);}else{if(X.rootView.currentPage){X.showPage(U.pageType.dataSelection);}}}W.dbRoleID=e.dbRoleID;if(e.sourceAccountID){W.sourceAccountID=e.sourceAccountID;}X.dataService.signOutOAuthSource(d,W);},oneTierOAuth:function A(X,W,Y,V){this.sourceType=X;this.slot=Y;this.getWebServiceURL(X,W,Y,V);},getWebServiceURL:function I(b,V,c,W){var f=U.sourceType,Z=H.call(window.mstrApp),a=this,g=Z.model&&Z.model.externalSources[b],d=function Y(h){var k,j,l=mstrmojo.desc(13302,"This app is blocked by admin in Salesforce.");if(mstrApp.originUrl.indexOf(h.origin)>=0){a.afterOAuth();B.detachEvent(window,"message",a.responseHandler);a.responseHandler=null;if(b===U.sourceType.salesforce){k=h&&h.data;j=P.getURLParameters(k);if(j.error&&j.error==="OAUTH_APP_BLOCKED"){Z.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,l);return ;}}a.getWebServiceCatalog(b,h.data,c,W);}};var e={success:function(o){var w;if(o.url){w=o.url;}else{w=o;}if(P.isServerBasedWS()){var m;if(b===U.sourceType.twitter){m="http://127.0.0.1";}else{if(b===U.sourceType.facebook){m="http://localhost/";}else{m="http://localhost";}}w=w.replace(/(redirect_uri=).*?(&)/,"$1"+m+"$2");}if(!w||w.length===0){B.detachEvent(window,"message",a.responseHandler);a.responseHandler=null;Z.displayError(mstrmojo.desc(12893,"Oops Unable to get the authorization URL for the given webservice. Please contact your administrator"));return ;}if(V&&(b===f.googleDrive||b===f.googleAnalytics||b===f.googleBigQuery)){if(w.indexOf("approval_prompt=force")<0){w+="&approval_prompt=force";}}if(mstrApp.isCloud){var t=window.location,x=t.protocol,l=t.hostname,j=t.port,u=t.pathname.split("/");var k=u&&u.length!==0&&u[1],q="ptc_"+x+"shrd_"+l+":port_"+j+":app_"+k;w+=("&state="+q);}if(mstrmojo.getCSRFToken()){w+=("&state=validateRandNum"+mstrmojo.getCSRFToken());}if(!P.getEnvObj().isWS()){var p=O(w);var h=window.location.origin;if(p!==undefined&&p!==h){var n=mstrmojo.desc(16025,"The OAuth Callback URL origin # does not match current origin ##. This might not bring you back to current Web. Please modify the Callback URL to make it work properly.");n=n.replace("#",p).replace("##",h);Z.displayError(n,false,null,function(){a.openAuthWindow(w);});return ;}}a.openAuthWindow(w);},failure:function(h){B.detachEvent(window,"message",a.responseHandler);this.responseHandler=null;a.afterOAuth();Z.displayError(mstrmojo.desc(12893,"Oops Unable to get the authorization URL for the given webservice. Please contact your administrator"),false,h.message);Z.showPage(U.pageType.dataSelection);}};if(P.isIE()){window.postMessagePassthrough=function(j,h){d({origin:h,data:j});};}if(a.responseHandler){B.detachEvent(window,"message",a.responseHandler);}B.attachEvent(window,"message",d);this.responseHandler=d;var X={dbRoleID:g.dbRoleID,scope:g.scope,flags:4};Z.dataService.getWebServiceURL(e,X);},openAuthWindow:function(X){var Y=this,W=H.call(window.mstrApp);Y.popupWnd=P.openPopupWindow(Y.popupWnd,"Authorization",X);if(!Y.popupWnd){B.detachEvent(window,"message",Y.responseHandler);Y.responseHandler=null;W.displayError(mstrmojo.desc(12894,"Your browser has blocked the popup for this site. Please enable the popup for this site in order to continue and sign in."),false);return ;}else{var V=setInterval(function(){if(Y.popupWnd&&Y.popupWnd.closed){clearInterval(V);B.detachEvent(window,"message",Y.responseHandler);Y.responseHandler=null;}},500);}},oneTierOAuthHandler:function R(V){this.afterOAuth();if(V.search("access_denied")<0&&V.search("denied")<0){this.getWebServiceCatalog(this.sourceType,V,this.slot);}},getWebServiceCatalogCallback:function S(e,f,Y){var a=H.call(window.mstrApp);var g=this;var b=a.model||{},h=b.externalSources&&b.externalSources[e],V=e,d,Z,X,W,c;return{success:function(j){if(!h.sourceAccountID&&j.mi.sinf.said){h.sourceAccountID=j.mi.sinf.said;}if(b.operationMode===U.operationMode.subscribe){a.readyForSubscription();}else{if(b.operationMode===U.operationMode.enterCredentials){a.model.updateDocumentCredentials(g.tableIDs,true);}else{if(b.operationMode===U.operationMode.refresh||b.isInputCredential){h.populateReports(j,undefined,true);}else{var k=b.externalSources;switch(V){case U.sourceType.twitter:h.populateReports(j);a.showPage(U.pageType.twitter,k[V],f);break;case U.sourceType.facebook:h.populateReports(j);a.showPage(U.pageType.facebook,k[V],f);break;case U.sourceType.dropbox:case U.sourceType.googleDrive:case U.sourceType.salesforce:case U.sourceType.googleAnalytics:a.showPage(U.pageType.sourceObjectsDnD,k[V],f);h.populateReports(j);break;case U.sourceType.googleBigQuery:Z=f&&f.getConfig&&f.getConfig();d=Z&&Z.properties&&Z.properties.tableID;X=d&&b.getImportSource(d);W=(X&&X.xdaType)||mstrApp.bigQueryXdatype;h.populateReports(j,null,mstrApp.isVI);window.setTimeout(function(){a.showPage(U.pageType.database,{sourceType:U.sourceType.googleBigQuery,type:W},f);c=a.rootView.parent;if(c&&c.editorNode){B.center(c.editorNode);}},1);break;}}}}Y&&Y.success&&Y.success();},failure:function(j){var k=parseInt(j.code||(j.getResponseHeader?j.getResponseHeader("X-MSTR-TaskErrorCode"):-1),10);a.closePageDialog();if(b.operationMode===U.operationMode.enterCredentials){a.model.updateDocumentCredentials(this.tableIDs,false);}if(k===U.backendError.refreshTokenUnavailable){a.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);}else{if(k===U.backendError.noExternalSession){a.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);}else{if(k===U.backendError.noExternalSourceInfo&&V===U.sourceType.googleAnalytics){var l=mstrmojo.desc(12895,"Could not find a Google Analytics account for your account. Please sign in with a different account.");mstrmojo.alert(l,function(){a.oAuthSignOut(V);});}else{a.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,j.message);if(b.operationMode!==U.operationMode.enterCredentials){a.showPage(U.pageType.dataSelection);}}}}Y&&Y.failure&&Y.failure();}};},getWebServiceCatalog:function D(Y,Z,b,V){var X=H.call(mstrApp);var W=X.model.externalSources[Y],a={dbRoleID:W.dbRoleID,code:Z};a.flags=U.sourcesInfoFlags.getReports|U.sourcesInfoFlags.getUserName;if(Y===U.sourceType.googleAnalytics){a.flags=a.flags|U.sourcesInfoFlags.getGAnalyticsAccount;}if(Y===U.sourceType.googleBigQuery){a.flags=U.sourcesInfoFlags.getGAnalyticsAccount|U.sourcesInfoFlags.getUserName;}if(Y===U.sourceType.salesforce){a.flags|=U.sourcesInfoFlags.getTokensInfo;}if(this.tableIDs&&this.tableIDs[0]){a.tableIDs=this.tableIDs;}a.isWorkstation=P.isServerBasedWS();X.dataService.getWebServiceCatalog(this.getWebServiceCatalogCallback(Y,b,V),a);},getAnalyticsWebProperties:function J(Y){var V=mstrApp.getRootController();var W=V.model.externalSources[U.sourceType.googleAnalytics];var X=W.getSourceParams();X.gaAccountID=Y;X.gaWebPropertyID="";X.flags=U.sourcesInfoFlags.getGAnalyticsAccount;if(W.checkWebProperties(Y,true)){V.getAnalyticsProfiles(Y,W.getAccountById(Y).webProperties[0].id);return ;}var Z={success:function(a){W.onGetAnalyticsWebProperties[Y]=false;W.populateWebProperties(a,Y);V.getAnalyticsProfiles(Y,W.getAccountById(Y).webProperties[0].id);},failure:function(){V.displayError(mstrmojo.desc(12604,"Unable to fetch Analytics web properties."),false);}};if(!W.onGetAnalyticsWebProperties[Y]){W.onGetAnalyticsWebProperties[Y]=true;V.dataService.getOAuthSourceReports(Z,X);}},getAnalyticsProfiles:function Q(Z,X){var V=mstrApp.getRootController();var W=V.model.externalSources[U.sourceType.googleAnalytics];var Y=W.getSourceParams();Y.gaAccountID=Z;Y.gaWebPropertyID=X;Y.flags=U.sourcesInfoFlags.getGAnalyticsAccount;if(W.checkProfiles(Z,X,true)){return ;}var a={success:function(b){W.onGetAnalyticsProfiles[Z+":"+X]=false;W.populateProfiles(b,Z,X);},failure:function(){V.displayError(mstrmojo.desc(12605,"Unable to fetch Analytics profiles."),false);}};if(!W.onGetAnalyticsProfiles[Z+":"+X]){W.onGetAnalyticsProfiles[Z+":"+X]=true;V.dataService.getOAuthSourceReports(a,Y);}},getOAuthSourceReports:function C(j,g,k,h,Z){var d=mstrApp.getRootController();var m=d.model.externalSources[j],b={},W=j,c=d.model,f,a,V,Y,X,e;if(!m){return ;}if(g){b=m.getSourceParams();if(j===U.sourceType.googleAnalytics){b.gaAccountID="";b.gaWebPropertyID="";b.flags=U.sourcesInfoFlags.getGAnalyticsAccount|U.sourcesInfoFlags.getReports|U.sourcesInfoFlags.getTokensInfo|U.sourcesInfoFlags.getUserName;}}else{b.dbRoleID=m.dbRoleID;if(m.sourceAccountID){b.sourceAccountID=m.sourceAccountID;}}if(j===U.sourceType.googleAnalytics){b.flags=U.sourcesInfoFlags.getGAnalyticsAccount|U.sourcesInfoFlags.getReports|U.sourcesInfoFlags.getTokensInfo|U.sourcesInfoFlags.getUserName;}if(j===U.sourceType.googleBigQuery){b.flags=U.sourcesInfoFlags.getGAnalyticsAccount|U.sourcesInfoFlags.getTokensInfo|U.sourcesInfoFlags.getUserName;}if(j===U.sourceType.facebook){b.fbPageSearchQuery=h;}a=k&&k.getConfig&&k.getConfig();V=a&&a.footerConfig;var l=Z||{success:function(n){if(!m.sourceAccountID&&n.mi.sinf.said){m.sourceAccountID=n.mi.sinf.said;}if(c.operationMode===U.operationMode.subscribe){d.readyForSubscription();}else{var o=c.externalSources;switch(W){case U.sourceType.twitter:m.populateReports(n);d.showPage(U.pageType.twitter,o[W],k,V);break;case U.sourceType.facebook:m.populateReports(n);d.showPage(U.pageType.facebook,o[W],k,V);break;case U.sourceType.dropbox:case U.sourceType.googleDrive:case U.sourceType.salesforce:case U.sourceType.googleAnalytics:d.showPage(U.pageType.sourceObjectsDnD,o[W],k,V);m.populateReports(n);break;case U.sourceType.googleBigQuery:f=a&&a.properties&&a.properties.tableID;Y=f&&c.getImportSource(f);X=(Y&&Y.xdaType)||mstrApp.bigQueryXdatype;m.populateReports(n);window.setTimeout(function(){d.showPage(U.pageType.database,{sourceType:U.sourceType.googleBigQuery,type:X},k,V);e=d.rootView.parent;if(e&&e.editorNode){B.center(e.editorNode);}},1);break;}}},failure:function(n){var o=parseInt(n.code||(n.getResponseHeader&&n.res.getResponseHeader("X-MSTR-TaskErrorCode")),10);if(o===U.backendError.refreshTokenUnavailable){d.gotoOAuthLogin(W,true,k);}else{if(o===U.backendError.noExternalSession&&(!g)){d.gotoOAuthLogin(W,false,k);}else{if(o===U.backendError.noExternalSourceInfo&&W===U.sourceType.googleAnalytics){var p=mstrmojo.desc(12896,"Could not find a Google Analytics account for ####. Please sign in with a different account.").replace("####",m.userDisplayName);mstrmojo.alert(p,function(){d.oAuthSignOut(W);});}else{d.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,n&&n.message);d.showPage(U.pageType.dataSelection);}}}}};if(!b.userDisplayName){delete b.userDisplayName;}if(!b.instanceURL){delete b.instanceURL;}d.dataService.getOAuthSourceReports(l,b);},getOAuthSourceFolderContents:function G(X,Y,a){var V=mstrApp.getRootController();var W=V.model.externalSources[X];var Z=W.getSourceParams();V.dataService.getOAuthSourceReports(a,M.copy(Y,Z));},oAuthSourceBrowserFunction:function(X,Y,Z,W){var V=mstrApp.getRootController();var a={success:function(j){var h=V.parseOAuthSourceFolder(X,j);Y.data.browser.set("fileList",h);if(Z){var k=Y.items,e;var b=k,g=k;var f=Z.indexOf("/",1);if(f!==-1){var c=Z.substring(1,f);for(e=0;e<b.length;e++){if(b[e].isFolder===true&&b[e].n===c){Y.data.browser.autoSelectNode(b[e].node,Z.substring(f),W);b[e].fetched=true;b[e].node.set("state",1);}}}else{var d=Z.substring(1);for(e=0;e<g.length;e++){if(g[e].isFolder!==true&&g[e].n===d){if(W){if(W===g[e].address){g[e].node.data.browser.autoSelectNode(g[e].node);}}else{g[e].node.data.browser.autoSelectNode(g[e].node);}}}}}},failure:function(b){if(Y&&Y.data){Y.set("state",0);Y.data.set("fetched",false);}V.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,b&&b.message);}};this.getOAuthSourceFolderContents(X,{folderName:Y.data.address},a);},oAuthSourceFetchFunction:function L(W,X){var V=mstrApp.getRootController();var Y={success:function(a){var Z=mstrApp.getRootController().getModel().externalSources[W];Z.populateReports(a);},failure:function(Z){V.displayError(mstrmojo.desc(12607,"Uh-Oh, Error fetching the list of reports from the external source"),false,Z&&Z.message);}};this.getOAuthSourceFolderContents(W,X,Y);},parseOAuthSourceFolder:function E(X,W){var V=mstrApp.getRootController().getModel().externalSources[X];return V.parseOAuthSourceFolder(W);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Worksheet","mstrmojo.CheckBox","mstrmojo.Image","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13974);var H=mstrmojo.DI.DIConstants,B=mstrmojo.DI.DIHelpers,E=mstrmojo.DI.DIHelpers.isOperationMode,F=mstrmojo.css;mstrmojo.DI.DIClipboard=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIClipboard",cssClass:"mstrmojo-di-clipboard",jsonp:"parent.mstrmojo.all.{@id}.uploadCallback(@R@)",_data:null,markupString:'<div id="{@id}" class="{@cssClass}" ><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div id="{@id}" ></div><div id="{@id}" ></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{formNode:function(){return this.domNode.children[0];},worksheet:function(){return this.domNode.children[0].children[0];},paramsNode:function(){return this.domNode.children[0].children[1];}},children:[{scriptClass:"mstrmojo.Worksheet",alias:"ws",slot:"worksheet",numOfRows:19,numOfcols:11,showRowHeaders:true,dragColumns:false,clearSheet:true,resizeColumns:false,postCreate:function(){this.attachEventListener("WorksheetContentChanged",this.id,"checkState");},checkState:function(J){mstrApp.getRootController().sourceSelected(J.data);}}],postBuildRendering:function A(){var L=mstrmojo.desc(13974,"Copy-pasting data from Internet Explorer might not align properly. We recommend using Chrome, Firefox."),K=mstrApp.getRootController().model;if(this._super){this._super();}window.setTimeout(function J(){if(B.isIE()){mstrApp.getRootController().displayWarning(L,null,mstrmojo.emptyFn,{showCancel:false});}},0);K.attachEventListener("windowSizeChanged",this.id,this.adjustSize);if(mstrmojo.dom.isEdge){this.domNode.setAttribute("x-ms-format-detection","none");}},adjustSize:function I(L){var N=Math.ceil(parseInt(L.size.w,10)),K=this.ws;K.tableContainer.style.width=(N-35)+"px";if(B.isServerBasedWS()){var J=Math.ceil(parseInt(L.size.h,10)),P=K.parent.parent.virtualHeaderHeight,O=52,M=56;K.tableContainer.style.height=(J-P-O-M)+"px";}K.updateScrollbars();},onBackButtonClick:function G(){var J=mstrApp.getRootController();J.showPage(H.pageType.dataSelection);this.destroy();},onHelpButtonClick:function C(){return"Importing_custom_data_by_typing_or_pasting_values.htm";},onNextButtonClick:function D(){var J=mstrApp.getRootController();if(this.tableID){J.refreshDataClipboard(this.tableID,this,H.actions.refreshData);}else{J.importClipboard(this,!J.model.hasEMMAReportInstance(),H.actions.importSource,this.id);}},onFinishButtonClick:function(){var J=mstrApp.getRootController();if(this.tableID){J.refreshDataClipboard(this.tableID,this);}else{J.importClipboard(this,!J.model.hasEMMAReportInstance(),H.actions.savePublish,this.id);}},collectData:function(){this._data=this.ws.getData();},destroy:function(J){this.collectData();this._super(J);},submit:function(P,M,K){var Q=[],N;N=this._data!==null?this._data:this.ws.getData();Q.push(N);if(mstrApp.isSingleTier){mstrApp.showProgress(K);mstrApp.getRootController().oneTierImportFile(M,mstrmojo.hash.copy(P,{datasource:N,dict:H.backendSourceSubtype.clipboard}));return ;}if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){var J=new Blob(Q);mstrApp.showProgress(K);P.fileFieldName="myFile";mstrApp.upload(M,P,J,K);}else{P.jsonp=this.jsonp.replace("{@id}",this.id);P.taskEnv="jsonp2";var L=[],O;for(O in P){L.push('<input type="hidden" name="'+O+'" value="'+mstrmojo.string.encodeHtmlString(P[O].toString())+'"/>');}L.push('<input type="hidden" name="data" value="'+N+'"/>');this.paramsNode.innerHTML=L.join("");if(M){this.onSuccess=M.success;this.onFailed=M.failure;}this.formNode.submit();}},uploadCallback:function(K){var J=(K.status===200);if(J&&this.onSuccess){this.onSuccess(K);}if(!J&&this.onFailed){this.onFailed(K);}},getFilesCnt:function(){return 1;},getFileName:function(J){return"";},getFileTableID:function(J){return null;},getOperationMode:function(){var J=this.model.operationMode;if(E(this.operationMode)){J=this.operationMode;}return J;},updatePageConfig:function(J){var K=this;if(J&&J.properties){mstrmojo.hash.forEach(J.properties,function(M,L){K.set(L,M);});}if(this.content){this.ws.setData(this.content);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.Obj","mstrmojo.date","mstrmojo.hash","mstrmojo.array","mstrmojo.DI.DIHelpers","mstrmojo.architect.obj.Column","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.obj.DBObjects","mstrmojo.warehouse.obj.DBRole","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12934,5160,11426,11427,11429,11430,11436,11437,11432,11434,12935,12936,11442,12942,10068,12943,12944,12945,12946);var V=mstrmojo,O=V.func.wrapMethods,AA=V.date,Y=V.hash,j=V.array,R=V.string,l=mstrmojo.DI.DIHelpers,F=V.architect.menu.EnumMenuActions,U=mstrmojo.warehouse.EnumDataChangeEvents,Z=U.DBTABLES_CHANGED,X=U.DBTABLES_REQUESTED,AC=3000,AO=mstrmojo.warehouse.EnumDatabaseType.SAPHana,e=mstrmojo.warehouse.EnumNamespaceMode.ALL,k=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,K=232,AG=V.warehouse.EnumObjectTypes,AT=AG.ATTRIBUTE,G=AG.FACT,AH=AG.TABLE,AP=AG.COLUMN,t=AG.FORM,m=AG.LAYER,J=AG.DIMENSION,AB=AG.PROJECT,x=AG.TRANSFORMATION,o=AG.DBROLE,z=mstrmojo.DI.DIConstants;var AQ={DssCatalogDefault:0,DssCatalogGetTables:1,DssCatalogGetColumns:2,DssCatalogGetTablePrimaryKeys:4,DssCatalogGetTableForeignKeys:8,DssCatalogGetTableKeys:12,DssCatalogGetTableSize:16,DssCatalogGetTableContent:32,DssCatalogGetColumnCardinality:64,DssCatalogGetColumnContent:128,DssCatalogGetFullCatalog:255,DssCatalogSelectedOnly:256,DssCatalogApplyConnectionMapping:512,DssCatalogAllNamespaces:1024,DssCatalogGetFresh:4096,DssCatalogIgnoreNamespace:8192,DssCatalogIgnoreCase:16384,DssCatalogIgnoreInvalidNames:32768,DssCatalogReuseMatching:65536,DssCatalogReuseCompatible:131072,DssCatalogReuseAny:262144,DssCatalogAugmentExisting:524288,DssCatalogSortDescending:1048576,DssCatalogSortTableNameFirst:2097152,DssCatalogGetNamespaces:16777216,DssCatalogCompareWithMetadata:134217728,DssCatalogTestConnectionOnly:536870912};var p={DssCatalogStateDefault:0,DssCatalogStateSelected:1,DssCatalogStateFresh:2,DssCatalogStateMissing:4,DssCatalogStateUnexpected:8,DssCatalogStateCompatibleSmaller:16,DssCatalogStateCompatibleLarger:32,DssCatalogStateCompatible:64,DssCatalogStateIncompatible:128,DssCatalogStateCompatibilityMask:240,DssCatalogStateFreshTables:256,DssCatalogStateMissingTables:512,DssCatalogStateFreshColumns:1024,DssCatalogStateMissingColumns:2048,DssCatalogStatePartitionMappingTable:65536,DssCatalogStateDummyPartitionMappingTable:131072,DssCatalogStateDummyPartitionSliceTable:262144};function h(AU){return R.decodeHtmlString(AU).replace(/&apos;/g,"'");}function L(){var AU=new Date();return" - "+[("00"+AU.getHours()).slice(-2),("00"+AU.getMinutes()).slice(-2),("00"+AU.getSeconds()).slice(-2)].join(":");}function N(AU){var AV=" ",AZ="-",Aa=":",AY=AU.split(AV),AW=AY[0].split(AZ),AX=AY[1].split(Aa);return new Date(Date.UTC(AW[0],parseInt(AW[1],10)-1,AW[2],AX[0],AX[1],AX[2]));}function w(AW,AV,AU){mstrApp.getRootController().getDataService()[AU||"submitRequest"](AW,AV);}function AE(AW,AV,AU){AV.showWait=AU;mstrApp.getRootController().getDataService().submitRequest(AW,AV);}function u(){mstrApp.serverProxy.cancelRequests();}function S(AU){var AW={},AV=[];j.forEach(AU,function(AX){AW[AX.propset]=AX.propset;AV.push(AX.propset+","+AX.prop);});return Y.valarray(AW).join(",,")+";"+AV.join(",,");}function q(AV){var AU=AV.ab;if(AU===0){AU=this.dbObjects.dbVersion2dbId[AV.db_ver];}return AU;}function B(AW,AV,AU){var AX=true;j.forEach(AU,function(AY){if(AY===AW){AX=false;return false;}});if(!AX){return false;}if(!AV||!AV.length){return true;}AX=false;j.forEach(AV,function(AY){if(AY===AW){AX=true;return false;}});return AX;}function AJ(AW,AV,AU){if(l.getEnvObj().isWSDossierLocalMode()){AV.isAsynced=true;mstrApp.getRootController().dataService.catalogActionForLocalDossier(AW,AV,AU);}else{AV.taskId="arch.catalogAction";AE(AW,AV,false);}}function AR(AV){var AU={success:function(AW){console.log(AW);console.log("success cancel");},failure:function(AW){console.log(AW);console.log("fail cancel");}};if(AV&&(AV.tid||AV.jid)){console.log("send cancel request to contoller");mstrApp.getRootController().dataService.killJob(AU,{threadId:AV.tid,jobid:AV.jid},"arch.KillJobCatalogAction");}}mstrmojo.warehouse.WHModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.warehouse.WHModel",schemaInstanceID:"",dbtbls:{},dbtables:[],cachedStamp:{},dbrs:[],dbObjects:undefined,namespaces:[],catalogStamp:"",SelDBRoleID:null,SelNameSpaceID:null,catalogRefresh:false,sourceInfo:undefined,privileges:{},dbRolesTypeFilter:[],dbRolesVersionFilter:[],dbmsTypeFilter:[],dbmsVersionFilter:[],dbRolesTypeExcludeFilter:[],dbRolesVersionExcludeFilter:[],dbmsTypeExcludeFilter:[],dbmsVersionExcludeFilter:[],dbObjectsDisplayOptions:1,dbObjectsConnectionType:1,showAddDriver:false,usingCookieNamespace:false,currentDBRole:undefined,allDBRoleNames:undefined,isSearching:false,searchedTableName:"",cas:undefined,tis:undefined,xrc:undefined,vldbProperties:undefined,propset:undefined,ns:undefined,did:undefined,clis:undefined,cln:undefined,dbRoleEditorCfg:{},databaseType:undefined,isDataImport:undefined,postCreate:function b(){this.dbObjects=new mstrmojo.warehouse.obj.DBObjects();if(mstrApp.isSingleTier){if(navigator.platform.indexOf("Win")===-1){this.dbObjectsConnectionType=2;this.showAddDriver=true;}return ;}this.loadPrivileges();},loadPrivileges:function H(AV){var AU=this;AE({success:function(AW){AU.privileges=AW.privileges;if(AV){AV();}}},{taskId:"arch.checkPrivileges",skipSchemaIDCheck:true},true);},loadDBTypeFilters:function C(AW){var AU=this;AU.dbObjects.populateDBProperties(O({success:function AV(){var AY=[],AX=AU.dbObjectsDisplayOptions;Y.forEach(AU.dbObjects.dbTypes,function(AZ){if((AZ.disp&AX)===AX){AY.push(AZ.v);}});AU.dbmsTypeFilter=AY;AU.dbRolesTypeFilter=AY.slice(0);}},AW));},loadDBRoles:function D(Ab,AV){var AW=this,Aa;AW.raiseEvent({name:U.DBROLES_REQUESTED});if(l.getEnvObj().isAppSchema()){AW.dbRolesTypeFilter=j.filter(AW.dbRolesTypeFilter,function(Ac){return l.filterDisableSources(Ac);});}var AZ={taskId:"arch.search",objecttypes:o,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1+2048,typeFilter:AW.dbRolesTypeFilter.join(","),versionFilter:AW.dbRolesVersionFilter.join(","),typeExcludeFilter:AW.dbRolesTypeExcludeFilter.join(","),versionExcludeFilter:AW.dbRolesVersionExcludeFilter.join(",")};var AU=O({success:function AY(Ag,Ah){var Ac=[],Af=AW.currentDBRole,Ae=0,Aj=(AW.dbIds&&AW.dbIds.length===1),Ad;j.forEach(Ag.dbRoles,function(Ak,Al){if(Ah){if(!B(Ak.db_type,AW.dbRolesTypeFilter,AW.dbRolesTypeExcludeFilter)||!B(Ak.db_ver,AW.dbRolesVersionFilter,AW.dbRolesVersionExcludeFilter)){return ;}}if(Aj){Ad=q.call(AW,Ak);if(Ak.ab===0&&(Ad===9||Ad===125)&&(AW.dbIds[0]===9||AW.dbIds[0]===125)){Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}else{if(AW.dbIds[0]===Ad||Ak.db_ver===-1){Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}else{if(AW.dbObjectsDisplayOptions===1&&Ak.ab===0&&Ad===undefined){Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}else{if(AW.dbObjectsDisplayOptions===16&&Ak.ab===0){Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}else{if(Ak.ab===0&&Ak.db_type===z.dbType.GOOGLE_BIGQUERY){Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}}}}}}else{Ac.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:Ak,mdl:AW}));}if(Af&&Ak.did===Af.did){Ae=Al;}});AW.currentDBRole=undefined;AW.set("dbrs",Ac);AW.raiseEvent({name:U.DBROLES_LOADED,items:Ac,offset:Ae});AW.allDBRoleNames={};j.forEach(Ag.allNames||[],function(Ak){AW.allDBRoleNames[Ak.did]=Ak;});var Ai=AW.findManagedDBR();if(AW.isNew===false&&(Ai||AW.dbridForDDA)){AW.fetchAndAppendSingleDBR(Ai||AW.dbridForDDA);}if(AW.defaultDbrId){mstrApp.getRootController().selectDBRole(AW.defaultDbrId);}}},Ab);if(AW.isDataImport!==undefined){AZ.isDataImport=AW.isDataImport;}if(!mstrApp.isSingleTier&&!l.isServerBasedWS()&&mstrApp.placeholder==="QBApp"&&!AV&&AW.isDataImport){Aa=mstrApp.type;var AX=mstrmojo.qb.EnumQBAppType;if((Aa===AX.QueryBuilder||Aa===AX.FFSQL||Aa===AX.EmmaSingleTable)&&AW.dbObjectsDisplayOptions!==16&&AW.dbObjectsDisplayOptions!==4){if(mstrApp.dbRoles){AU.success(mstrApp.dbRoles,true);}else{mstrApp.serverRequestParallel(AZ,AU,true);}return ;}}if(!mstrApp.isSingleTier&&!l.isServerBasedWS()&&AV&&mstrApp.dbRoles){mstrApp.dbRoles=undefined;if(mstrApp.container&&mstrApp.container.launchingApp){mstrApp.container.launchingApp.dbRoles=undefined;}}mstrApp.serverRequestQueue(AZ,AU,mstrApp.taskQueue);},loadDBObjects:function W(AW){var AV=this.dbmsTypeFilter.slice(),AU=this.dbmsVersionFilter.slice();this.dbObjects.load(AV,AU,AW);},_set_SelDBRoleID:function g(AX,AW){var AV=this,AU=this.getDBRole(AW);AV.SelDBRoleID=AW;AV.SelNameSpaceID=undefined;if(AU&&AU.mdDBRole){AV.getNameSpaces({sourceInfo:AV.sourceInfo?AV.sourceInfo:"tablesPanel",getFresh:AV.catalogRefresh});AV.sourceInfo=undefined;AV.catalogRefresh=false;}else{if(!AW){AV.raiseEvent({name:Z,items:[],selectedItems:[],sourceInfo:""});AV.raiseEvent({name:U.NAMESPACES_CHANGED,namespaces:[],namespaceMode:k,dbRoleID:AW,error:true});}}AV.raiseEvent({name:U.DBROLE_SELECTION,value:AV.SelDBRoleID});},onSelNameSpaceIDChange:function A(AU){this.SelNameSpaceID=AU.value;this.getSelectedDBRoleTables({blockBegin:0,blockCount:1000,filterText:""},{failure:function AV(AX){if(AX){AX.getResponseHeader&&V.alert(AX.getResponseHeader("X-MSTR-TaskFailureMsg"));}}});var AW=window.localStorage;if(AW){AW.setItem(this.SelDBRoleID,this.SelNameSpaceID);}},getDBRole:function n(AV){var AW="00000000000000000000000000000000";var AU=j.find(this.dbrs,"did",(AV===AW)?this.projPrimaryDBRoleID:AV);if(AU>=0){return this.dbrs[AU];}return null;},cancelNameSpaces:function P(){u();this.raiseEvent({name:U.NAMESPACES_CANCELED,});},cancelLoadTables:function AI(){u();this.isSearching=false;this.raiseEvent({name:U.TABLES_CANCELED});},getNameSpaces:function AL(AZ){var Ab=this,AU=AZ.dbRoleID||Ab.SelDBRoleID,AY=AQ.DssCatalogGetNamespaces|AQ.DssCatalogApplyConnectionMapping,Ac=this.getDBRole(AU),AX=false,AV=false,AW=Ac&&Ac.mdDBRole&&Ac.mdDBRole.db_type,Ad;if(Ac&&Ac.mdDBRole&&!l.isdbRoleUsable(Ac.mdDBRole)){return ;}switch(AW){case 4000:AX=true;break;case 3000:AV=true;break;default:break;}if(AZ.getFresh){AY=(AY|AQ.DssCatalogGetFresh);}Ab.raiseEvent({name:Z,items:[],selectedItems:[],sourceInfo:AZ.sourceInfo||""});Ad={success:function(Ae){Ab.namespaces=Ae.ns;Ab.raiseEvent({name:U.NAMESPACES_CHANGED,namespaces:AX?[]:Ab.namespaces,namespaceMode:e,dbRoleID:AU,namespace:Ab.SelNameSpaceID,sourceInfo:AZ.sourceInfo||""});},failure:function(Ae){Ab.raiseEvent({name:U.NAMESPACES_CHANGED,namespaces:[],namespaceMode:k,dbRoleID:AU,sourceInfo:AZ.sourceInfo||"",error:true});if(Ae){Ae.getResponseHeader&&V.alert(Ae.getResponseHeader("X-MSTR-TaskFailureMsg"));}},canceled:AR};if(AV){Ad.success({ns:[]});return ;}if(!AX){Ab.raiseEvent({name:U.NAMESPACES_REQUESTED,sourceInfo:AZ.sourceInfo||""});}var Aa={dbrid:AU,flags:AY};AJ(Ad,Aa,U.NAMESPACES_CANCELED);},getSelectedDBRoleTables:function AD(Al,AX){var AW=this,AV=Al.getFresh||false,Ao=Al.dbRoleID||AW.SelDBRoleID||AW.projPrimaryDBRoleID,Ac=AW.cachedStamp,AU=AW.dbtbls,Ag=Al.filterText.toString(),An=AW.getDBRole(Ao),AY=arguments.callee;if(An&&An.mdDBRole&&!l.isdbRoleUsable(An.mdDBRole)){return ;}if(!!AW.isSearching){AW.searchedTableName=Ag;return ;}if(AV){AW.catalogRefresh=true;}if(!An||An.mdDBRole.db_type===AC){AW.raiseEvent({name:Z,items:[],selectedItems:[],sourceInfo:Al.sourceInfo||""});return ;}var Ad=(AU[Ao]=AU[Ao]||{}),Ah=(Ac[Ao]=Ac[Ao]||{}),Ae=R.decodeHtmlString(Al.nameSpace||AW.SelNameSpaceID||""),Aa=false,Af=[],Ai=[],Ak,Ab=Ad[Ae],Aj=(An.mdDBRole.db_type===AO);if(!AW.catalogRefresh&&Ad&&(Ab!==undefined)){Y.forEach(Ab,function(Ar,Aq){var Ap=(Ag!==""&&Aq.toUpperCase().indexOf(Ag.toUpperCase()));Aa=true;Ak=new mstrmojo.warehouse.obj.TableData({id:Aq,n:Aq,tp:AH,model:AW,ns:Ar.ns,did:Aq,sta:parseInt(Ar.sta,10),items:[],dbtn:Ar.tbn});if(Aj){Ak.extt=Ar.extt;Ak.hanai=Ar.hanai;}if(Ap!==false&&Ap>-1){Af.push(Ak);}Ai.push(Ak);});if(Aa){AW.set("catalogStamp",Ah[Ae]);AW.raiseEvent({name:Z,items:(Ag!=="")?Af:Ai,selectedItems:AW.getDBRoleTablesInUse(Ao)||[],sourceInfo:Al.sourceInfo||"",keyword:Ag});if(AX&&AX.success){AX.success({items:(Ag!=="")?Af:Ai});}return ;}}Ab=(Ad[Ae]={});Ah[Ae]=null;var AZ=AQ.DssCatalogGetTables|AQ.DssCatalogApplyConnectionMapping;AZ=AW.catalogRefresh?(AZ|AQ.DssCatalogGetFresh):AZ;AW.raiseEvent({name:X,sourceInfo:Al.sourceInfo||""});AW.isSearching=true;var Am=O({success:function(As){var Ap=As.xrc.cas[0],Av=Ap.timestamp,Aq=Ap.tis,Ar,At;if(Av){var Au=AA.getDateJson(N(Av.replace(/&apos;/,"")));Av=[AA.formatDateInfo(Au,"yyyy-MM-dd")," ",AA.formatTimeInfo(Au,"hh:mm a")].join("");}Ah[Ae]=Av;AW.set("catalogStamp",Av);AW.catalogRefresh=false;j.forEach(Aq,function(Aw){Ar=Aw.tbn=h(Aw.tbn);At=Aw.ns=h(Aw.ns);if(!Ab[Ar]){Ab[Ar]=Aw;Ad[At]=Ad[At]||{};Ad[At][Ar]=Aw;}});Y.forEach(Ab,function(Ax,Aw){Ak=new mstrmojo.warehouse.obj.TableData({id:Aw,n:Aw,tp:AH,model:AW,ns:Ax.ns,did:Aw,sta:parseInt(Ax.sta,10),items:[],dbtn:Ax.tbn});if(Aj){Ak.extt=Ax.extt;Ak.hanai=Ax.hanai;}Ai.push(Ak);});AW.raiseEvent({name:Z,items:Ai,selectedItems:AW.getDBRoleTablesInUse(Ao)||[],sourceInfo:Al.sourceInfo||""});AW.isSearching=false;Ai.length>0&&AW.searchedTableName&&AY.call(AW,{filterText:AW.searchedTableName});AW.searchedTableName="";},failure:function(){AW.raiseEvent({name:Z,items:Ai,selectedItems:AW.getDBRoleTablesInUse(Ao)||[],sourceInfo:Al.sourceInfo||""});AW.isSearching=false;AW.searchedTableName="";},canceled:AR},AX);var Al={dbrid:Ao,flags:AZ,ns:Ae};AJ(Am,Al,U.TABLES_CANCELED);},getDBRoleTablesAndColumns:function AS(AV,AW){var AU=this;if(!AV.dbRoleID){return ;}AE(O({success:function(Aa){var AX=Aa.xrc.cas[0],AY=AX.tis,Ad=[],Ac={},AZ,Ab;j.forEach(AY,function(Ae){Ab=h(Ae.ns);AZ=h(Ae.tbn);Ad.push({n:(Ab?Ab+"."+AZ:AZ),tp:AH});j.forEach(Ae.clis,function(Af){Ac[Af.cln]={n:Af.cln,tp:AP};});});Aa.tables=Ad;Aa.columns=Y.valarray(Ac);}},AW),{taskId:"arch.catalogAction",dbrid:AV.dbRoleID,flags:AQ.DssCatalogGetTables+AQ.DssCatalogGetColumns,ns:R.decodeHtmlString(AU.SelNameSpaceID||"")},true);},getDBRoleTablesInUse:mstrmojo.emptyFn,getColumnsForDBTable:function f(AZ,Ad){var Ac=this,AU=AZ.data.dbrole||Ac.SelDBRoleID,Ab=AZ.data,AV=typeof AZ.showCancel==="boolean"?AZ.showCancel:true,Aa=AZ.getFresh||false,Ah=R.decodeHtmlString(Ab.n.replace(/<strong>|<\/strong>/gi,"")),AY=Ab.ns,Ae=Ab.tableId,AX,AW=AQ.DssCatalogGetColumns+AQ.DssCatalogApplyConnectionMapping+AQ.DssCatalogIgnoreCase+(AZ.compareWithMD?AQ.DssCatalogCompareWithMetadata:0),Ag;Ab.n=Ah;if(AU){if(!Aa){if(AY){Ag=Ac.dbtbls[AU][AY][Ah];AX=Ag.columns;}else{Ag=Ac.dbtbls[AU][Ah];if(Ag){AX=Ag.columns;}}if(AX){Ad.success({src:AZ,items:AX,selDBRole:AU,hanaInfo:Ag.hanaInfo});if(Ad&&Ad.complete){Ad.complete();}return ;}}AW=Aa?(AW|AQ.DssCatalogGetFresh):AW;AE(O({success:function Af(Aj){var Ak=Aj.xrc.cas[0].tis[0],Ai=[],Al=Ak.hanai;AX=Ak.clis;j.forEach(AX,function(Am){Ai.push(new mstrmojo.architect.obj.Column({dbInfo:Am}));});Ag=Ac.dbtbls[AU][AY][Ah];if(Ai.length>0){Ag.columns=Ai;}Ag.hanaInfo=mstrmojo.hash.clone(Al);Aj.items=Ai;Aj.hanaInfo=Ag.hanaInfo;}},Ad),{taskId:"arch.catalogAction",dbrid:AU,schemaid:Ac.schemaInstanceID,ns:AY,dbts:JSON.stringify([{tbn:Ab.dbtn,ns:AY,tbid:Ae}]),flags:AW},AV);}},saveDBRole:function I(AV,AU,AY){var AW=this;AE(O({success:function AX(Aa){if(!AU){var AZ=AW.getDBRole(Aa.dbr.did);AZ.populated=false;AZ.populate(function Ab(){AW.raiseEvent({name:AU?U.DBROLES_ADD:U.DBROLES_RENAME,item:AZ});});}else{AW.currentDBRole=Aa.dbr;AW.loadDBRoles(undefined,true);}}},AY),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(AV),showWait:true},true);},deleteDBRole:function M(AV,AX){var AU=this;AE(O(AX,{success:function AW(){var AY=j.find(AU.dbrs,"did",AV);if(AY>-1){AU.dbrs.splice(AY,1);}delete AU.allDBRoleNames[AV];if(AU.SelDBRoleID===AV){AU.set("SelDBRoleID",AU.projPrimaryDBRoleID);}AU.raiseEvent({name:U.DBROLES_DELETE,item:{did:AV}});}}),{taskId:"arch.deleteObject",schemaid:AU.schemaInstanceID,objectid:AV,objecttype:29,showWait:true},true);},populateDBRole:function d(AU,AV){AE(AV,{isDataImport:false,reverseOrder:true,verbose:true,taskId:"getDBInstances",vldbProperties:S(this.dbObjects.preferences.vldbProperties),objectID:AU,skipSchemaIDCheck:true,showWait:false},false);},handleEnabledAction:function E(AV,AU){if(!AU){return true;}return true;},handleVisibleAction:function AF(AW,AV){if(!AV){return true;}switch(AV.action){case F.SET_AS_PRIMARY:return mstrApp.isArchitect&&!AW.isPrimary;case F.IS_PRIMARY:return mstrApp.isArchitect&&AW.isPrimary;case F.UPSTRUCT:return true;case F.CATALOG_SQL:var AU=this.getDBRole(AW.did);return(mstrApp.getRootController().canDisplayCatalogSQL(this.dbObjects.dbTypes,AU.mdDBRole.db_type));case F.SHARE:return !AV.isManaged&&!mstrApp.isSingleTier&&mstrApp.getRootController().hasPrivilege(K);case F.DUPLICATE:return !AV.isManaged;}return true;},handleCheckAction:function AN(AV,AU){switch(AU.action){case F.IS_PRIMARY:return AV.isPrimary;}return false;},findNameInHash:function a(AX,AU){var AW=false,AV="";Y.forEach(AX,function(AY){AV=AY.name||AY.n;if(AV.toString().toUpperCase()===AU){AW=true;return false;}return true;});return AW;},validateName:function c(Ac,Ab,AU,AY){var AW=this,Ae=10000,AX={},Af,AV,Aa=V.desc(12934,"Object names need to be less than 250 characters"),AZ=V.desc(5160,'An object name cannot contain the following characters " \\ [ ]');switch(Ac){case AT:case t:AX=AW.getAttributes();Af=V.desc(11426,"The attribute name cannot be empty.");AV=V.desc(11427,"The name is currently in use by another attribute.");break;case G:AX=AW.getFacts();Af=V.desc(11429,"The fact name cannot be empty.");AV=V.desc(11430,"The name is currently in use by another fact.");break;case AH:AX=AW.tables;Af=V.desc(11436,"The table name cannot be empty.");AV=V.desc(11437,"The name is currently in use by another table.");break;case m:AX=AW.layers;Af=V.desc(11432,"The layer name cannot be empty.");AV=V.desc(11434,"The name is currently in use by another layer.");break;case J:AX=AW.userHierarchies;Af=V.desc(12935,"The hierarchy name cannot be empty.");AV=V.desc(12936,"The name is currently in use by another hierarchy.");break;case AB:AX=AY;Af=V.desc(11442,"The project name cannot be empty.");AV=V.desc(12942,"The project name already exists.");break;case o:AX=AW.allDBRoleNames;j.forEach(AW.dbrs,function(Ag){AX[Ag.did]=Ag;});Af=V.desc(10068,"The Database Connection name can't be empty");AV=V.desc(12943,"The database connection name already exists.");break;case x:AX=AW.transformations;Af=V.desc(12944,"The transformation name cannot be empty.");AV=V.desc(12945,"The transformation name already exists.");break;default:V.alert(V.desc(12946,"object type cannot be validated, it's not defined yet"),undefined,undefined,Ae);return false;}if(Ab===""){V.alert(Af,undefined,undefined,Ae);return false;}if(AU){if(AU.toString().toUpperCase()===Ab.toString().toUpperCase()){return true;}}if(Ab.length>250){V.alert(Aa,undefined,undefined,Ae);return false;}var Ad=/[\[\]\\"]/;if(Ad.test(Ab)){V.alert(AZ,undefined,undefined,Ae);return false;}if(this.findNameInHash(AX,Ab.toUpperCase())){V.alert(AV,undefined,undefined,Ae);return false;}return true;},findinArray:function AM(AV,Aa,AW){var AY=AW.toUpperCase(),AU=(AV&&AV.length)||0,AX,AZ;for(AX=0;AX<AU;AX++){AZ=AV[AX];if(AZ&&AZ[Aa].toUpperCase()===AY){return AX;}}return -1;},findNextName:function AK(AV,AX,AZ){AV+=(L());var AW=1,AU=AV,AY=AU.toUpperCase();do{if(this.findinArray(AX,AZ,AY)>=0){AU=AV+" "+AW++;AY=AU.toUpperCase();}else{return AU;}}while(AW<100);return"Temp Object";},findManagedDBR:function(){var AW,AU,AX;var AV=mstrApp.getRootController().model;AW=j.filter(AV.bindingT?AV.bindingT:[],function(AY){return AY.oi.did===AV.tableID;});if(AW.length&&AW[0].oi.def&&AW[0].oi.def.dbt&&AW[0].oi.def.dbt.did){AU=j.filter(AV.bindingT?AV.bindingT:[],function(AY){return AY.oi.did===AW[0].oi.def.dbt.did;});}if(AU&&AU.length){AX=AU[0].oi.def&&AU[0].oi.def.dbr&&AU[0].oi.def.dbr.did;}return AX;},fetchAndAppendSingleDBR:function(AV){var AU=this;if(AV&&j.find(AU.dbrs,"did",AV)===-1){mstrApp.getRootController().getDataService().getSingleDBRole({success:function(AX){var AW=typeof (AX.dbr)==="object"?AX.dbr:JSON.parse(AX.dbr);var AY=AW.dbRoles[0];AU.dbrs.push(new mstrmojo.warehouse.obj.DBRole({mdDBRole:AY,mdl:AU,isManagedDBR:true}));AU.set("currentDBRole",AY);AU.raiseEvent({name:U.DBROLES_REQUESTED});AU.raiseEvent({name:U.DBROLES_LOADED,items:AU.dbrs,offset:AU.dbrs.length-1,isManagedDBR:true});AU.allDBRoleNames[AY.did]=AY;}},{dbrId:AV});}}});var Q=mstrmojo.warehouse.WHModel;Q.DssCatalogFlags=AQ;Q.DSSCatalogStateFlags=p;}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.List");mstrmojo.requiresDescs(2057,7674,7675,7676,7677,7696,7697,9923,9924,12375,12919,12948);var Q=mstrmojo.dom,R=mstrmojo.css,E=mstrmojo.desc;var M={NONE:0,CITY:1,STATE:2,COUNTRY:3,LOCATION:4,LATITUDE:5,LONGTITUDE:6,OTHER:7,ZIPCODE:8,COUNTY:9};var B=268435456,G=536870912,C=1073741824;var A=268435456,D=805306368,F=805306368,O=1879048192;var I=[{n:mstrmojo.desc(2057,"None"),did:M.NONE,geo:true},{n:mstrmojo.desc(7674,"Country"),did:M.COUNTRY,geo:true},{n:mstrmojo.desc(7676,"State"),did:M.STATE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B}]},{n:mstrmojo.desc(12919,"County"),did:M.COUNTY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7675,"City"),did:M.CITY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7677,"Zip Code"),did:M.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),did:M.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),did:M.LONGTITUDE,geo:true},{n:mstrmojo.desc(12948,"City, State"),did:M.LOCATION,geo:true},{n:mstrmojo.desc(9923,"Others..."),did:M.OTHER,geo:true}];mstrmojo.qb.GeoRole=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.GeoRole",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title">{@title}</div><div class="mstrmojo-qb-mapping-georole"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];}},top:"0px",left:"0px",height:"320px",title:E(12375,"Please select a geography role for this attribute and any additional attributes that you want to create."),georole:0,shapeKeys:[],der:0,init:function N(S){this._super(S);this.raiseEvent({name:"shapeKeysChange"});},onshapeKeysChange:function J(){var S=this.shapeKeys;if(mstrApp.isCloud){I.splice(-1);}this.geolist.set("items",S?I.concat(this.shapeKeys):I);},_close:function(){var S=this.parent;if(S&&S._cmSource){S._cmSource.closeMenuTree();}},onOK:function(){var U,S;this.data.geo=true;if(this.geolist.selectedItem.geo){U=this.geolist.selectedItem.did;this.data.georole=U;S={2:A,1:D,9:F,8:O}[U]||0;this.data.der=this.der=this.der&S;}else{this.data.georole=7;this.data.shapeKey=this.geolist.selectedItem.did;}mstrApp.getRootController().setGeoRoles(this.data);this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.List",slot:"contentNode",alias:"geolist",cssClass:"mstrmojo-qb-geolist",itemIdField:"did",cssClassItem:"",onclick:function(c){var a=Q.eventTarget(c.hWin,c.e).parentNode,X,Y,b,S,W,U,d,Z;function V(e,f){return e.children[0].children[1].children[0].children[f];}if(a.className.indexOf("mstrmojo-qb-georole-attribute")>-1){b=parseInt(a.getAttribute("did"),10);S=[];Z=this.domNode.children[0].children;W=5;U={};U[B]={minIndex:2,childIndex:1};U[G]={minIndex:3,childIndex:2};U[C]={minIndex:5,childIndex:3};d=U[b];if(d){for(X=W;X>=d.minIndex;X--){S.push(V(Z[X],d.childIndex));}}Y=(this.parent.der&b)?R.removeClass:R.addClass;for(X=0;X<S.length;X++){Y(S[X],"selected");}this.parent.der=this.parent.der^b;}},adjustMenu:function L(){var S=this.parent.parent;if(S){S=S.parent.parent;if(S&&S.adjustMenuPosition){S.adjustMenuPosition();}}},expandShapeKeyNode:function K(){R.addClass(this.domNode,"showShapeKey");this.adjustMenu();},onmouseup:function H(S){switch(this.selectedItem.did){case M.OTHER:this.expandShapeKeyNode();this.set("selectedItem",{did:this.parent.shapeKey});break;}},onchange:function P(S){var U=S.added;if(U){switch(this.selectedItem.did){case M.COUNTY:case M.CITY:case M.STATE:case M.ZIPCODE:this.adjustMenu();break;case M.OTHER:var V=S.removed;if(V&&V.length){this.set("selectedIndex",V[0]);this.expandShapeKeyNode();}break;}}},itemMarkupFunction:function(b,W,V){var Y=[],a=V.parent,U,X,Z,S;if(b.items){Z=b.items;S="onclick=\"mstrmojo.dom.captureDomEvent('"+V.id+"','click', self, event)\"";Y.push('<div class="mstrmojo-qb-georole-attribute-box"><span>');Y.push(mstrmojo.desc(9924,"Create attributes for:"));Y.push("</span>");for(U=0,X=Z.length;U<X;U++){Y.push('<div class="mstrmojo-qb-georole-attribute '+((a.der&Z[U].did)?"selected":"")+'" did="'+Z[U].did+'"'+S+'><img class="mstrmojo-qb-georole-checkbox" src="../images/1ptrans.gif"><span style="padding-left:5px;">');Y.push(Z[U].n);Y.push("</span></div>");}Y.push("</div>");}return'<div class="mstrmojo-qb-georole '+((b.did==M.OTHER)?"other":"")+(b.geo?"":"shapeKey ")+V.cssClassItem+'" idx="'+W+'" did="'+b.did+'"><div class="mstrmojo-qb-georole-itemtext"><img class="mstrmojo-qb-georole-img" src="../images/1ptrans.gif"><span class="mstrmojo-qb-georole-text">'+b.n+'</span></div><div class="mstrmojo-qb-georole-itemcontent">'+Y.join("")+"</div></div>";},onRender:function(){this.set("selectedItem",{did:this.parent.georole});}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.Refine.RefineImportDialog","mstrmojo.Refine.RefineExtractDialog","mstrmojo.List");mstrmojo.requiresDescs(12350,12351,3482,3473,8118,246,14817,118,1905);var A=mstrmojo.css,F=mstrmojo.dom;var D=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineHistoryList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineHistoryList",markupString:'<div id="{@id}" class="refine-history-list-box"><div class="refine-history-header"></div><div class="refine-history-box"><div class="refine-history-inner-box"></div></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[0];},historyNode:function(){return this.domNode.children[1];},sequenceNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onundoIDChange:function(){if(this.undoID===-1){this.undo.set("enabled",false);}else{this.undo.set("enabled",true);}},onredoIDChange:function(){if(this.redoID===-1){this.redo.set("enabled",false);}else{this.redo.set("enabled",true);}}},undoID:-1,redoID:-1,setDimensions:function C(K,I){var G=parseInt(K,10);var J=parseInt(I,10);if(isNaN(G)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var L=44;var H=J-Math.max(Math.floor(J*0.65),618)-1;this.layoutConfig.h.headerNode=(L-16)+"px";this.layoutConfig.w.headerNode=(H-9)+"px";this.layoutConfig.h.sequenceNode=(G-L-14-3)+"px";this.layoutConfig.w.sequenceNode=(H-14)+"px";if(this._super){this._super(G+"px",H+"px");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"refine-history-label",cssDisplay:"inline-block",text:mstrmojo.desc(14817,"Script"),slot:"headerNode"},{slot:"headerNode",alias:"undo",cssClass:"refine-history-undo",cssDisplay:"inline-block",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3482,"Undo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.undoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{slot:"headerNode",alias:"redo",cssClass:"refine-history-redo",cssDisplay:"inline-block",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3473,"Redo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.redoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(118,"Save"),slot:"headerNode",cssClass:"refine-history-export",cssDisplay:"inline-block",alias:"export",onclick:function(){var G=mstrApp.getRootController();G.showDialog(D.dialogType.refineExtractDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(8118,"Import"),slot:"headerNode",cssClass:"refine-history-import",cssDisplay:"inline-block",alias:"import",onclick:function(){var G=mstrApp.getRootController();G.showDialog(D.dialogType.refineImportDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1905,"Reset"),cssClass:"refine-history-reset",cssDisplay:"inline-block",slot:"headerNode",alias:"reset",enable:false,visible:true,onclick:function(){var G,H;if(this.enable){G=this.parent.controller;if(G.refinePanel&&G.refinePanel.bottomPanal&&G.refinePanel.bottomPanal.splitter){H=G.refinePanel.bottomPanal.splitter.facetPanel;H.resetAllFacets();}G.applyOperations({lastDoneID:0},true);}},onenableChange:function(){A.toggleClass(this.domNode,"enable",this.enable);},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.List",cssClass:"refine-history-list",slot:"sequenceNode",itemMarkup:'<div class="list-item {@cssClass}" title="{@description}">{@description}</div>',alias:"sequence",populateChange:false,populate:function E(I){if(I.past&&I.future){var H,G,J;for(H=0;H<I.past.length;H++){J=I.past[H];J.description=H+") "+mstrmojo.string.encodeHtmlString(J.description,null,true);J.cssClass="past";}for(G=0;G<I.future.length;G++){J=I.future[G];J.description=(H+G)+") "+mstrmojo.string.encodeHtmlString(J.description,null,true);J.cssClass="future";}this.set("items",I.past.concat(I.future));if(this.selectedIndex!==I.past.length-1){this.populateChange=true;}this.set("selectedIndex",I.past.length-1);this.render();if(I.past.length===0){this.parent.set("undoID",-1);}else{if(I.past.length===1){this.parent.set("undoID",0);}else{this.parent.set("undoID",I.past[this.selectedIndex-1].id);}}if(I.future.length===0){this.parent.set("redoID",-1);}else{this.parent.set("redoID",I.future[0].id);}}},onchange:function(G){if(this.populateChange===true){this.populateChange=false;}else{this.parent.controller.applyOperations({lastDoneID:G.src.selectedItem.id},true);}},multiSelect:false}],populate:function E(G){this.sequence.populate(G);if(G&&G.past&&G.past.length>0){this.reset.set("enable",true);}else{this.reset.set("enable",false);}},handleListChanged:function B(G){this.populate(G.value);},updateTooltip:function(){var G=F.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+25,0),left:Math.max(G.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.List","mstrmojo.DI.DIConstants","mstrmojo.dom","mstrmojo.Button","mstrmojo.List","mstrmojo.Table","mstrmojo.DI.DIDatabaseHelper","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13191,13227,13961,14030,14712,14893,9849,15172);var E=mstrmojo.hash,M=mstrmojo.DI.DIConstants,I=mstrmojo.array,H=mstrmojo.dom,F=mstrmojo.DI.DIDatabaseHelper,N=mstrmojo.warehouse.EnumDatabaseType,J=mstrmojo.DI.DIHelpers,D=mstrmojo.DI.DIHelpers.detectCustomImg;function O(Q,P){if(Q===M.dbType.PIG){P.showImportOption=false;P.sourceInfo.type=M.xdaType.ffsql;}}function B(P){if(mstrApp.isSingleTier){if((P===1400)&&!(window.FormWrapper.isWin32&&window.FormWrapper.isWin32())){return true;}if([6800,5300,5600,6600,7000].indexOf(P)!==-1){return true;}}return false;}mstrmojo.DI.DISourceItem=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DISourceItem",pageType:null,icon:null,dbTypeIconCls:null,title:"",n:"",desc:"",connectorDesc:"",enabled:true,containHadoopFile:false,showImportOption:false,dbTypes:null,tooltipOpenDelay:0,useRichTooltip:true,keywordLeft:"",keyword:"",keywordRight:"",waitDbTypesFetched:false,preBuildRendering:function K(){if(this._super){this._super();}var P=!this.keyword?"{@en@n}":'{@en@keywordLeft}<span style="font-weight: bold;">{@en@keyword}</span>{@en@keywordRight}';this.markupString='<div id="{@id}" class="mstrmojo-di-source-item {@icon}" mstrAttach:click,mouseover,mouseout><div class="mstrmojo-di-source-name"><span class="mstrmojo-di-source-name-span normal">'+P+'</span></div><div class="mstrmojo-di-source-below"><div class="mstrmojo-di-Icons medium-{@icon} {@dbTypeIconCls}"></div><div class="mstrmojo-di-source-link"></div><div class="mstrmojo-di-source-desc">{@en@desc}</div><div class="mstrmojo-di-source-desc"><span class="mstrmojo-di-source-name-span connector">{@en@connectorDesc}</span></div><div class="mstrmojo-di-source-introduction"></div><div class="mstrmojo-di-source-link mstrmojo-di-source-editlink-paddingtop"></div><div class="mstrmojo-di-source-pulldown mstrmojo-di-source-link-paddingtop"></div><div class="mstrmojo-di-source-link"></div></div></div>';},markupSlots:{nameNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.children[1].children[0];},firstLinkNode:function(){return this.domNode.children[1].children[1];},descNode:function(){return this.domNode.children[1].children[2];},connectordescNode:function(){return this.domNode.children[1].children[3];},introductionNode:function(){return this.domNode.children[1].children[4];},editLinkNode:function(){return this.domNode.children[1].children[5];},pulldownNode:function(){return this.domNode.children[1].children[6];},lastLinkNode:function(){return this.domNode.children[1].lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function L(Q){this._super(Q);var P=mstrApp.getRootController().model;if(this.dbObjectsDisplayOptions){if(P.supportDBObjects&&P.supportDBObjects.supportDBType){this.filterDB();}else{P.attachEventListener(M.srcItemTypes.DBTYPE_SOURCE,this.id,"filterDB");}}},filterDB:function G(P){var Q,U,S,R=P&&P.isCustomConnector;if(!mstrApp.getRootController){return ;}if(!P||!P.src){Q=mstrApp.getRootController().model;}else{Q=P.src;}U=Q.supportDBObjects&&Q.supportDBObjects.supportDBType;U=F.filterDBByDispOption(U,this.dbObjectsDisplayOptions,this.dbIdExcludeFilter);U=F.filterDBByAdminConfig(U,this.dbRolesAdminConfig);this.dbTypes=U;this.dbIds=F.getDBIds(U);if(this.isWaitingDBTypes){mstrApp.hideProgress();this.onclick(this.clickEvent,this.clickEventTarget);}if(!mstrApp.isSingleTier&&this.sid===M.sourceItemType.database&&!mstrApp.dbRoles&&this.showDBList&&!R){S=F.getUniqueDBTypes(U);if(J.getEnvObj().isAppSchema()){S=I.filter(S,function(V){return J.filterDisableSources(V);});}mstrApp.getRootController().getDBRoles(S,this.dbRolesAdminConfig);}},handleSourceSelect:function C(V,Q){var c=this,X,b=[],d=[],R,Z=mstrApp.getRootController(),Y=Z.model,U,P=!!Q&&Q.dbType===3000,S;if(!mstrApp.isSingleTier&&this.sid===M.sourceItemType.database&&mstrApp.dbRoles){if(!E.equals(mstrApp.dbRolesAdminConfig,this.dbRolesAdminConfig||[])){mstrApp.dbRoles=undefined;}}mstrApp.dbmsID=V.oid;mstrApp.conUrl=V.url;mstrApp.clientId=V.user;mstrApp.newConDbroleId=V.oid;if(V.dbIds){b=(Q&&Q.dbType)?[Q.dbType]:F.getUniqueDBTypes(V.dbTypes);U=c.parent.parent.isFilterDDA;I.forEach(b,function(g){if(!U||Y.canAddToDDACube(V.sourceInfo.subtype,g)){d.push(g);}});mstrApp.dbIds=(Q&&Q.id)?[].concat(Q.id):V.dbIds;mstrApp.dbTypes=d;mstrApp.supportDBObjects=mstrApp.getRootController().model.supportDBObjects;mstrApp.dbObjectsDisplayOptions=this.dbObjectsDisplayOptions;mstrApp.dbRolesVersionExcludeFilter=this.excludeDBVFilter||[];}if(V.showImportOption){X={onOK:function(g){var j=mstrmojo.hash.clone(c.sourceInfo);var h=mstrmojo.hash.copy(g.sourceInfo,j);c.openSelectedSource(g.pageType,h);}};if(V.sourceInfo.type===M.sourceType.googleBigQuery){R={isODBC:true,srcInfo:V.sourceInfo};}else{if(V.sourceInfo.type===M.xdaType.querybuilder){if(V.isSAPHanaDDA){R={isSAPHanaDDA:true};}else{R=(Q&&Q.dbType===N.SAPHana)?{isSAPHana:true}:{isODBC:true};R.hasNonSAPHana=V.hasNonSAPHana;if(P){S={sourceType:M.sourceType.querybuilder,type:M.xdaType.ffsql};Z.showPage(M.pageType.database,S);return ;}}}else{if(V.enableHadoopOption){R=E.copy(X,{isContainHadoop:true});}else{R=E.copy(X,{isContainHadoop:false});}}}mstrApp.getRootController().showDialog(M.dialogType.qbImportOptionDialog,R);}else{if(V.importFromCube){var a={OKFn:function(g){if(g&&g.did){if(Y.cubeID&&Y.cubeID===g.did){Z.displayError(mstrmojo.desc(14893,"We have detected that you are attempting to merge a dataset with itself. Please select different datasets."),false);return ;}Z.importFromCube(g.did,!Z.model.hasEMMAReportInstance(),M.actions.importSource);}},oTypes:[779,776,3],supportedTypes:I.hash([779,776,3]),rootFolderType:7,isImportFromCube:V.importFromCube};if(J.getEnvObj().isWSDataSet()){var f={success:function(g){if(g&&g.objectId){if(Y.cubeID&&Y.cubeID===g.objectId){Z.displayError(mstrmojo.desc(14893,"We have detected that you are attempting to merge a dataset with itself. Please select different datasets."),false);return ;}Z.importFromCube(g.objectId,!Y.hasEMMAReportInstance(),M.actions.importSource);}}};var W={taskId:"openNativeWindow",windowType:1};mstrApp.serverRequest(W,f,{});}else{mstrApp.getRootController().showDialog(M.dialogType.objectPicker,a);}}else{if(V.addConnector||V.newConnector){mstrApp.getRootController().showDialog(M.dialogType.addConnectorDialog);}else{if(V.pageType===M.pageType.cloudElement){var e=I.find(Y.cloudElementDBRoles,"did",Q.did);c.openSelectedSource(undefined,{n:e>=0?Y.cloudElementDBRoles[e].n:"",did:Q.did});}else{c.openSelectedSource();}}}}},openSelectedSource:function(Q,U){var P=mstrApp.getRootController(),V;if(!this.pageType){return ;}if(this.enabled){if(mstrApp.isSingleTier&&this.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var R=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),S='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";R=R.replace("#",S)+".";P.displayError(R,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}V=mstrApp.getRootController().navigationController.getPageSlot();V.setConfig({properties:{operationMode:M.operationMode.create}});P.showPage(Q===undefined?this.pageType:Q,U===undefined?this.sourceInfo:U,V);}},onclick:function(Q,R){var P=Q.getTarget();if(!P){P=R;}var S=H.findWidget(P);if(!S){return ;}var U=this.dbList;if(Q.e&&Q.e.button===1){Q.cancel();return ;}if(U){if(this.waitDbTypes&&!this.dbTypes){this.isWaitingDBTypes=true;this.clickEvent=Q;this.clickEventTarget=Q.e&&(Q.e.target||Q.e.srcElement);mstrApp.showProgress();return ;}if(S===U||S===U.list){return ;}}this.handleSourceSelect(S);},onmouseover:function(P){var Q=P.e;if(H.contains(this.domNode,Q.relatedTarget,true)){Q.stopImmediatePropagation();}},onmouseout:function(P){var Q=P.e;if(H.contains(this.domNode,Q.relatedTarget,true)){Q.stopImmediatePropagation();}},postBuildRendering:function A(){if(this._super){this._super();}if(this.customizeIcon){if(!M.sourceIconClsName[this.itemId]){D(this.originalName?this.originalName:this.n,this.iconNode);}}else{if(this.iconData&&mstrmojo.string.startsWith(this.iconData,"data:image")){this.iconNode.innerHTML='<img src="'+this.iconData+'" style="width:75px;height:75px;"/>';}else{if(J.isOriginalConnector(this.oid)&&this.oid===M.originalConnector.elastic){mstrmojo.css.addClass(this.iconNode,"medium-Elastic_Connector");}else{if(J.isOriginalConnector(this.oid)&&this.oid===M.originalConnector.tapClicks){mstrmojo.css.addClass(this.iconNode,"medium-TapClicks_Connector");}else{if(!this.icon&&!mstrmojo.string.startsWith(this.iconData,"data:image")&&!J.isOriginalConnector(this.oid)){mstrmojo.css.addClass(this.iconNode,"medium-defaultconnector");}}}}}if(!this.enabled){mstrmojo.css.addClass(this.domNode,"disabled");}else{mstrmojo.css.addClass(this.domNode,"enabled");}this.nameNode.firstChild.style.position="relative";this.nameNode.firstChild.style.top=((this.nameNode.clientHeight-this.nameNode.firstChild.clientHeight)/2)+"px";var P=mstrApp.getRootController().model;if(this.waitDbTypesFetched&&P.sourceList.length===0&&mstrApp.diParams.ImportDatabase!==0){P.attachEventListener(M.srcItemTypes.DBTYPE_SOURCE,this.id,function(){this.set("enabled",true);mstrmojo.css.removeClass(this.domNode,"disabled");mstrmojo.css.addClass(this.domNode,"enabled");});}},updateTooltipConfig:function(){var P=H.position(this.nameNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-V",top:Math.max(P.y-20,0),left:Math.max(P.x+P.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});},postCreate:function(){if(this.containHadoopFile&&!mstrApp.isSingleTier){var V={scriptClass:"mstrmojo.Button",slot:"firstLinkNode",alias:"hadoopFiles",text:mstrmojo.desc(13191,"Browse Hadoop Files"),onclick:function Q(Y){H.stopPropogation(Y.hWin,Y.e);var X=mstrApp.getRootController();X.showPage(M.pageType.hadoop,1);}};!mstrApp.diParams.disableHadoop&&this.addChildren(V);}if(!J.isWS()&&this.showOAuthLink&&(mstrApp.diParams.SetOAuthParams||mstrApp.isSingleTier)){var U={scriptClass:"mstrmojo.Button",slot:"editLinkNode",alias:"setOAuth",text:mstrmojo.desc(13227,"Set OAuth Parameters"),onclick:function Q(a){a.cancel();var X=mstrApp.getRootController().model;var Z=X.externalSources[this.parent.sourceInfo.type];var Y=this.parent;mstrApp.getRootController().openOAuthParaDialog(a,{sourceName:Z.name,did:Z.dbRoleID,isOneTier:!!mstrApp.isSingleTier,sourceItem:Y});}};this.addChildren(U);}if(this.showWhiteListLink&&!mstrApp.isSingleTier&&mstrApp.diParams.configureProjectBasic){var P={scriptClass:"mstrmojo.Button",slot:"editLinkNode",alias:"setWhiteList",text:mstrmojo.desc(14712,"Set Allowed URLs"),onclick:function Q(Y){if(this.parent.enabled){Y.cancel();var X=this.parent;mstrApp.getRootController().openWhiteListDialog(Y,{isOneTier:!!mstrApp.isSingleTier,sourceItem:X});}}};this.addChildren(P);}if(this.showEditDialog&&(!mstrApp.isSingleTier||mstrApp.isWorkstation)){var R=this,W={scriptClass:"mstrmojo.Button",slot:"introductionNode",alias:"introductionButton",text:mstrmojo.desc(9849,"Learn more"),bindings:{visible:function(){return R.introductionUrl.trim()!="";}},onclick:function Q(Y){if(this.parent.enabled){Y.cancel();var X=R.introductionUrl.trim();if(J.isWS()){window.FormWrapper.openPage(X);}else{window.open(X);}}}};this.addChildren(W);}if(this.showEditDialog&&(!mstrApp.isSingleTier||mstrApp.isWorkstation)){var R=this,S={scriptClass:"mstrmojo.Button",slot:"editLinkNode",alias:"editConnector",text:mstrmojo.desc(15172,"Edit Connector"),onclick:function Q(Y){var X=mstrApp.getRootController();if(this.parent.enabled){Y.cancel();X.connectorScrollTop=this.parent.parent.domNode.scrollTop;X.openEditConnectorDialog(Y,{title:R.n,isNew:false,name:R.n,url:R.url,desc:R.connectorDesc,introductionUrl:R.introductionUrl,iconData:R.iconData,oid:R.oid,type:R.type,user:R.user,pwd:R.pwd});}}};this.addChildren(S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");var B=mstrmojo.dom;mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",itemTitleField:null,defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,allowHTML:false,_set_items:function(H,F){var G=this.items;this.items=F||[];return G!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var G=this.value,F=this.selectedIndex,I=this.items||[],J,H;if(F===undefined||(G!==null&&(F===-1||(F!==-1&&I[F]&&I[F][this.itemIdField]!==G)))){F=mstrmojo.array.find(I,this.itemIdField,G);F=(F>-1)?F:this.defaultSelection;this.selectedIndex=F;}else{if(G===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=J=I[this.selectedIndex];if(J){H=J[this.itemField];}else{H=this.defaultText||"";}this.set("text",H);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function D(){var G=this.value,F=-1;if(G!==null){F=mstrmojo.array.find(this.items,this.itemIdField,G);}if(F>-1){this.selectedItem=this.items[F];this.selectedIndex=F;}},togglePopup:function E(){if(this.popupToBody){var I=B.position(this.popupNode,true),H=this.popupRef,F={left:Math.round(I.x)+"px",top:Math.round(I.y)+"px"};if(!H.hasRendered){delete H.slot;F.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(F,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var G=this.popupRef.domNode;if(G){if(this.fixWidth){G.style.width=(this.domNode.offsetWidth-2)+"px";}else{G.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function A(F){if(B.getButton(F.hWin,F.e)===B.MOUSE_BUTTON.LEFT){this.togglePopup();}},unrender:function C(F){var G=this.popupRef;if(this.popupToBody&&G.hasRendered){G.unrender(false);}if(this._super){this._super(F);}},itemName:function(H,F,G){return this.allowHTML?H[G.itemField]:mstrmojo.string.encodeHtmlString(H[G.itemField]);},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,adjustSize:function(){var G=this.opener,F=this.domNode;if(G&&G.fixWidth){mstrmojo.css.addClass(F,["fix-width"]);}if(G&&G.fixHeight){mstrmojo.css.addClass(F,["fix-height"]);}},onOpen:function(){var H=this.opener,G=H&&H.popupZIndex,I=(H&&H.popupCssClass)||"",F=this.domNode;if(G){F.style.zIndex=G;}if(I){mstrmojo.css.addClass(F,[I]);}this.adjustSize();},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(I,F,G){var H=I[G.itemCSS]||G.parent.opener.item2textCss&&G.parent.opener.item2textCss(I)||"",J=G.parent.opener.itemName;return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+H+'" title="'+I[G.itemTitleField||G.itemField]+'">'+(J(I,F,G)||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",itemTitleField:"this.parent.opener.itemTitleField",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var H=this.parent,I=H.visible,F=H.opener,G=this.selectedItem;if(!F||!G||!I){return ;}F.set("value",G[this.itemIdField]);}}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo._IsDial");mstrmojo.Dial=mstrmojo.declare(mstrmojo.List,[mstrmojo._IsDial],{scriptClass:"mstrmojo.Dial",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){mstrmojo.css.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);},hideIfEmpty:function(){this.onadd();}},hideIfEmpty:false,onadd:function(A){if(this._super){this._super(A);}if(this.hideIfEmpty){if(this.domNode){this.domNode.style.display=(!this.items||this.items.length==0)?"none":"block";}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListSelector","mstrmojo.List","mstrmojo.string");mstrmojo.OBList=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.OBList",cssClass:"mstrmojo-OBList",itemClass:"mstrmojo-OBListItem",iconClass:"mstrmojo-OBListItemIcon",textClass:"mstrmojo-OBListItemText",iconCssPrefx:"mstrmojo-OBIcon_",itemMarkupFunction:function(C,A,B){return'<div class="'+B.itemClass+(C[B.itemType]?" t_"+C[B.itemType]:"")+(C[B.itemSubType]?" st_"+C[B.itemSubType]:"")+(C[this.itemISC]?" isc":"")+(C[B.itemViewMedia]?" vm_"+C[B.itemViewMedia]:"")+'"><table cellspacing="0" cellpadding="0"><tbody><tr><td>'+B.getIcon(C)+'</td><td><div class="'+B.textClass+'" title="'+B.getTooltip(C)+'">'+mstrmojo.string.htmlAngles(C.n)+"</div></td></tr></tbody></table></div>";},getIcon:function(F){var E=F[this.itemType],D=F[this.itemSubType],B=" t"+E,C=(parseInt(E,10)===1||parseInt(E,10)===3||parseInt(D,10)===14082)?" st"+D:"",G=F[this.itemISC]?'class="mstrmojo-ListIcon isc"':"",A=(F[this.itemViewMedia]===2048||F[this.itemViewMedia]===8192)?" hvi":"";return'<span class="mstrmojo-ListIcon '+B+C+A+'"><span '+G+"></span></span>";},getTooltip:function(C){var D="",F=C.anc&&C.anc.items,A=F&&F.length,B;if(A>0){for(B=0;B<A-1;B++){D+=F[B].n+" > ";}D+=F[A-1].n;}var E=C.desc,G=128;if(E){D+="\r\n\r\n"+mstrmojo.string.encodeHtmlString(E.substring(0,G))+(E.length>G?"...":"");}return D;},listSelector:mstrmojo.ListSelector,selectionPolicy:"reselect",itemType:"t",itemSubType:"st",itemISC:"isc",itemViewMedia:"dvm",useDblSelect:false});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetListBase","mstrmojo.WidgetListMapper","mstrmojo.WidgetListBuilder");mstrmojo.WidgetList=mstrmojo.declare(mstrmojo.WidgetListBase,null,{scriptClass:"mstrmojo.WidgetList",renderOnScroll:true,listMapper:mstrmojo.WidgetListMapper,listBuilder:mstrmojo.WidgetListBuilder,itemConfig:null,itemFunction:null,initBindings:function(){this._super();var E=this.ctxtBuilder,D=E&&E.itemWidgets;if(D){for(var C=0,A=D.length;C<A;C++){var B=D[C];if(B&&B.initBindings){B.initBindings();}}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListHoriz","mstrmojo.fx");mstrmojo.FishEye=mstrmojo.declare(mstrmojo.ListHoriz,null,{scriptClass:"mstrmojo.FishEye",width:16,size:10,step:16,speed:2,cssClass:"mstrmojo-FishEye",cssClassItem:"mstrmojo-dot",itemMarkupFunction:function(B,A,C){return'<div class="mstrmojo-fisheye-item '+C.cssClassItem+'" title="'+B.n+'" idx="'+A+'" did="'+B.did+'">&nbsp;</div>';},onchange:function(){this.scroll2();this.parent.set("selectedIndex",this.selectedIndex);},as:new mstrmojo.fx.AnimateProp(),onitemsChange:function(){if(this._super){this._super();}this.last=this.items.length-1;this.first=Math.max(0,this.last-this.size);if(this.items.length>this.size){this.scroll("left",this.width);}},scroll2:function(){var A=this.selectedIndex-this.last;if(this.selectedIndex==this.first&&this.first>0){this.scroll("right",this.width);}else{if(this.selectedIndex==this.last&&this.last<this.items.length-1){this.scroll("left",this.width);}else{if(this.selectedIndex>this.last){A=this.selectedIndex-this.last;this.scroll("left",this.width*A,A);this.last=Math.min(this.items.length-1,this.last+A);}else{if(this.selectedIndex<this.first){A=this.first-this.selectedIndex;this.scroll("right",this.width*A,A);this.first=Math.max(0,this.first-A);}}}}},scroll:function(C,F,E){var B=this.itemsContainerNode,I=B&&B.style;var D=this.as,H=parseInt(mstrmojo.css.getStyleValue(B,{left:"right",right:"left"}[C]),10),H=isNaN(H)?0:H,A=parseInt(I.left,10)||0,G=A+(C=="left"?-1:1)*(F||(Math.min(this.step,(-1)*H)));D.target=B;D.props={left:{start:A,stop:G,duration:100,interval:10,suffix:"px"}};D.play();E=E===undefined?1:E;this.first+=(C=="left"?1:-1)*E;this.last=this.first+this.size-1;this.parent.set("scrollable",this.last<this.items.length-1);this.parent.set("rightScrollable",this.first>0);return G;},srcId:null,postBuildRendering:function(){if(this._super){this._super();}this.hasRendered=!!this.domNode;var E=this.itemsContainerNode,A=E&&E.firstChild,B=A&&A.rows&&A.rows[0],D=B&&B.cells&&B.cells[0];this.first=0;this.last=this.size-1;var C=this.srcId;if(C&&mstrmojo.all[C]&&mstrmojo.all[C].attachEventListener){mstrmojo.all[C].attachEventListener("change",this.id,function(F){if(this.items[this.items.length-1]!=F.src.selectedItem){this.items.add([mstrmojo.hash.copy(F.src.selectedItem)]);this.set("selectedIndex",this.items.length-1);}if(this.items.length>this.size){this.set("rightScrollable",this.items.length>this.size);this.scroll("left",this.width*(this.selectedIndex-this.last),(this.selectedIndex-this.last));}});}this.itemsContainerNode.style.left=Math.min(0,(this.size-this.items.length+1))*this.width+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupWidget","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.css");mstrmojo.ui.menus.MenuPopup=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui.menus._IsMenuPopup],{scriptClass:"mstrmojo.ui.menus.MenuPopup",popupConfig:null,init:function B(E){this._super(E);var C=this.popupConfig;if(!C.contents){throw new Error("Cannot open popup without contents.");}var D=["mstrmojo-ui-MenuPopup"],F=C.cssClass;if(F){D.push(F);}if(C.hasToggleItem){D.push("hasToggleItem");}mstrmojo.css.addWidgetCssClass(this,D);this.addChildren(C.contents);},shouldPropagateLockHover:function A(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HBox","mstrmojo.CheckBox");mstrmojo.requiresDescs(1143);var E=mstrmojo.warehouse.dbroles.DBRoleHelper;mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",cssClass:"mstrmojo-wh-DBRoleCheckBox",postBuildRendering:function A(){if(this._super){this._super();}this.checkbox.set("label",this.label);this.helpBtn.set("visible",!!(this.helpLink));},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",oncheckedChange:function C(){if(this._super){this._super();}this.parent.checked=this.checked;this.parent.oncheckedChange();},useRichTooltip:true,updateTooltipConfig:function(){var J=-5;this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:J,content:this.label});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-wh-DBRoleCheckBox-help",alias:"helpBtn",visible:false,title:mstrmojo.desc(1143,"help"),onclick:function I(){E.showHelp(this.parent.helpLink);}}],helpBtn:undefined,onlabelChange:function G(){this.checkbox.set("label",this.label);},helpLink:undefined,enabled:true,onenabledChange:function F(){this.checkbox.set("enabled",this.enabled);},isNumeric:false,getValue:function D(){if(this.isNumeric){return(this.checkbox.checked?"1":"0");}return(this.checkbox.checked?"true":"false");},setValue:function B(J){this.checkbox.set("checked",((J==="true")||(J===true)||(J==="1")));},isValid:function H(){return{val:true,msg:""};}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasLayout","mstrmojo.Box","mstrmojo.css","mstrmojo.HBox","mstrmojo.string","mstrmojo.TextBox","mstrmojo.Label");var H=mstrmojo.css,E=mstrmojo.dom,C=mstrmojo.desc(505,"Update"),D="clear";mstrmojo.warehouse.ui.SearchBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.ui.SearchBox",cssClass:"mstrmojo-wh-SearchBox",tableBox:undefined,inputBox:undefined,clearBtn:undefined,refreshBtn:undefined,labelTable:undefined,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-SearchBox-contents",alias:"tableBox",children:[{scriptClass:"mstrmojo.Label",alias:"labelTable",text:mstrmojo.desc(7755,"Table"),cssClass:"mstrmojo-wh-sb-labelTable"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",spellCheck:false,onkeydown:function G(){this.oldText=this.value;},onkeyup:function B(){var P=this,N=this.value,M=this.parent.clearBtn,Q=this._searchTimeoutId,O=this._hasText=N.length>0;if(this.oldText!==N){H.toggleClass(M.domNode,[D],O);window.clearTimeout(Q);this._searchTimeoutId=window.setTimeout(function(){P.parent.parent.triggerSearch();},this.searchDelay);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function L(){var M=this.parent;if(M.inputBox._hasText){M.parent.clearSearch();}else{M.parent.triggerSearch();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-sb-refresh",alias:"refreshBtn",visible:false,onclick:function L(){if(this.parent.parent._onRefresh){this.parent.parent._onRefresh();}},title:C,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var M=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}]}],title:"",tooltipOpenDelay:0,useRichTooltip:true,_preSearch:undefined,_onRefresh:undefined,searchDelay:-1,init:function K(N){this._super(N);var M=this.searchDelay;if(M===-1||isNaN(M)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},postBuildRendering:function A(){var N=mstrApp.getRootController(),O=N.dataService,M=(O==mstrmojo.qb.mdx.DataService);this._super();this.tableBox.inputBox.domNode.maxLength=248;this.tableBox.inputBox.value="";M&&this.tableBox.labelTable.set("text",mstrmojo.desc(14211,"Cube"));},clearSearch:function I(M){if(!this.hasRendered){return ;}this.tableBox.inputBox.set("value","");H.removeClass(this.tableBox.clearBtn.domNode,[D]);delete this.tableBox.inputBox._hasText;if(!M){this.triggerSearch();}},triggerSearch:function F(){var M=true;if(this._preSearch){M=this._preSearch();}if(M){this.raiseEvent({name:"searchTriggered",searchValue:mstrmojo.string.trim(this.tableBox.inputBox.value)});}},showTooltip:function J(R,Q){var P=this,N=E.findAncestorByAttr(E.eventTarget(Q,R),"tooltip",true,this.domNode),O=N&&N.value;if(!P.hasOpenTooltip&&O){var M=E.position(N.node);P.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:O,top:Math.max(M.y+40,0),left:Math.max(M.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT};this._super(R,Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasBuilder");mstrmojo.ToolBar=mstrmojo.declare(mstrmojo.HBox,[mstrmojo._HasBuilder],{scriptClass:"mstrmojo.ToolBar",cellCssClass:"mstrmojo-ToolBar-cell",markupString:'<table id="{@id}" class="mstrmojo-ToolBar {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-ToolBar-outercell"><table class="mstrmojo-ToolBar-innertable" cellspacing="0" cellpadding="0"><tr>{@tableHtml}</tr></table></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0].firstChild.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildChildren:function A(){var B=this.buildConfig;if(!B){this.buildConfig={};B=this.buildConfig;}B.target=this.target;return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Label","mstrmojo.dom");mstrmojo.requiresDescs(162,5961,3012,163);function A(){var D=mstrApp.getRootController().refineApp.rootController,C=D.model,B=parseInt(this.parent.currentPage.value,10);if(!B){return ;}C.set("start",(B-1)*C.limit);}mstrmojo.Refine.RefinePagination=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefinePagination",markupString:'<div class="mstrmojo-Refine-RefinePagination refine-viewpanel-paging" mstrAttach:click><div class="refine-viewpanel-paging-currentRows"></div><div class="refine-viewpanel-paging-of"></div><div class="refine-viewpanel-paging-totalRows"></div><div class="refine-viewpanel-paging-pages"></div></div>',markupSlots:{currentRows:function(){return this.domNode.children[0];},ofNode:function(){return this.domNode.children[1];},totalRows:function(){return this.domNode.children[2];},pageNode:function(){return this.domNode.children[3];}},totalPages:null,children:[{scriptClass:"mstrmojo.Label",alias:"currentRows",slot:"currentRows",text:"",},{scriptClass:"mstrmojo.Label",slot:"ofNode",text:"",},{scriptClass:"mstrmojo.Label",alias:"totalRows",slot:"totalRows",text:"",},{scriptClass:"mstrmojo.HBox",alias:"right",slot:"pageNode",cssClass:"",children:[{scriptClass:"mstrmojo.Button",alias:"firstNode",text:"",cssClass:"pagination-firstNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(162,"First page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",0);}},{scriptClass:"mstrmojo.Button",alias:"previousNode",text:"",cssClass:"pagination-previousNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(5961,"Previous page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===0){return ;}B.set("start",B.start-B.limit);}},{scriptClass:"mstrmojo.TextBox",alias:"currentPage",cssClass:"pagination-currentPage",width:"40px",onvalueChange:function(B){var C=B.value.toString();if(!C){return ;}C=C.replace(/[^0-9,]/g,"");C=parseInt(C)>parseInt(this.parent.parent.totalPages)?this.parent.parent.totalPages:C;C=parseInt(C)===0?1:C;this.set("value",C);},onEnter:A,onblur:A},{scriptClass:"mstrmojo.Label",alias:"totalPages",text:"",cssClass:"pagination-totalPages"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3687,"Page"),cssClass:"pagination-Page"},{scriptClass:"mstrmojo.Button",alias:"nextNode",text:"",cssClass:"pagination-nextNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(3012,"Next page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===(B.data.filtered-1)-((B.data.filtered-1)%B.limit)){return ;}B.set("start",B.start+B.limit);}},{scriptClass:"mstrmojo.Button",alias:"lastNode",text:"",cssClass:"pagination-lastNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(163,"Last page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",(B.data.filtered-1)-((B.data.filtered-1)%B.limit));}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.func","mstrmojo.array","mstrmojo.Button","mstrmojo.HBox","mstrmojo.dom","mstrmojo.Box");var D=mstrmojo.dom;mstrmojo.Dialog=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Dialog",title:"",buttons:null,alignment:"center",btnAlignment:"right",zIndex:10,modal:true,markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 1100;" tabindex="0" mstrAttach:click><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},curtainNode:function(){return this.domNode.childNodes[1];},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[1];},buttonNode:function(){return this.domNode.firstChild.lastChild;},tipNode:function(){return this.domNode.lastChild;}},editorNode:null,btnHbox:null,markupMethods:{onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onwidthChange:function(){this.editorNode.style.width=this.width||"auto";},onvisibleChange:function(L){if(L){return ;}var J=this.visible,K=J?"block":"none";this.editorNode.style.display=K;if(this.modal){this.curtainNode.style.display=K;}},onleftChange:function(){this.editorNode.style.left=this.left||"";},ontopChange:function(){this.editorNode.style.top=this.top||"";},ontitleChange:function(){this.titleNode.firstChild.innerHTML=this.title||"";}},preBuildRendering:function F(){var J;var K=this.buttons;if(K&&!this.btnHbox){for(J in K){K[J].cssClass=(K[J].cssClass||"")+(this.noButtonCls?"":" mstrmojo-Editor-button");}this.addChildren([{scriptClass:"mstrmojo.HBox",cssText:"float:"+this.btnAlignment,slot:"buttonNode",alias:"btnHbox",children:K},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-clearMe",slot:"buttonNode"}]);}if(this.modal){this.cssClass+=" modal";}return this._super();},buildRendering:function B(){var J=this.placeholder;if(this._super()){if(!this.parent&&!J){document.body.appendChild(this.domNode);}return true;}return false;},getResizeHandler:function E(){var J=this.id;return function(){var K=mstrmojo.all[J];K.resizeDialog();K.positionDialog();};},postBuildRendering:function A(){this._super();if(this.modal&&this.visible){this.curtainNode.style.display="block";}if(!this._resizeHandler){var K=this._resizeHandler=this.getResizeHandler();D.attachEvent(window,"resize",K);}this.resizeDialog();this.positionDialog();try{this.domNode.focus();}catch(J){}return true;},resizeDialog:function G(){if(this.modal){this.resizeCurtain();}},resizeCurtain:function C(){var K=this,O=K.curtainNode,J=document.body,M=document.documentElement,N=O.style,L=K.curtainPosition;N.width=Math.max(J.clientWidth,M.scrollWidth)+"px";if(L&&L.h){N.height=L.h+"px";}else{N.height=Math.max(J.clientHeight,M.scrollHeight)+"px";}if(L&&L.y){N.top=L.y+"px";}K.raiseEvent({name:"resizeCurtain"});},positionDialog:function H(){var K=this.editorNode,M=this.left,L=this.top;if(!M||!L){D.center(K);var J=K.style;if(this.alignment==="top"){J.top="10px";}if(M){J.left=M;}if(L){J.top=L;}}},destroy:function(K){var J=this._resizeHandler;if(J){D.detachEvent(window,"resize",J);}this._super(K);}});mstrmojo.toast=function I(O,M,Q,J){var P="mojoToast9",N,L=M||3000;if(J&&J.id){P=J.id+"-"+P;}try{mstrmojo.all[P].destroy();}catch(K){}mstrmojo.insert({id:P,scriptClass:"mstrmojo.Label",cssClass:(J&&J.cssClass)?J.cssClass:"toastCss",text:O}).render();N=mstrmojo.all[P].domNode;if(J&&J.dom){J.dom.appendChild(N);}else{document.body.appendChild(N);D.bottomCenter(N);}window.setTimeout(function(){if(Q){Q();}try{mstrmojo.all[P].destroy();}catch(R){}},L);};mstrmojo.mask={show:function(){var J=mstrmojo.mask.win=mstrmojo.insert({scriptClass:"mstrmojo.Box",cssClass:"fullscreen-mask"});J.render();document.body.appendChild(J.domNode);},hide:function(){mstrmojo.mask.win.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasPopup","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui.SimpleTree","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.array","mstrmojo.DI.DIHelpers","mstrmojo.css");var I=mstrmojo.array,R=mstrmojo.css,E=mstrmojo.DI.DIHelpers;var A=mstrmojo.warehouse.EnumObjectTypes,K=A.ATTRIBUTE,L=A.METRIC,J=A.TABLE;var U=mstrmojo.DI.DIConstants;mstrmojo.requiresDescs(10);mstrmojo.DI.DISearchTableBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DISearchTableBox",cssClass:"mstrmojo-di-DISearchTableBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"",alias:"tableBox",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-tb-inputBox mstrmojo-wh-sb-input",alias:"inputBox",oldText:"",bindings:{hint:function(){return(!!mstrApp.isWorkstation)?(mstrmojo.desc(10,"Search")+"..."):"";}},onkeydown:function F(){this.oldText=this.value;},onkeyup:function P(){var Z=this,X=this.value,W=this.parent.clearBtn,Y=this._hasText=X.length>0;if(this.oldText!==X){R.toggleClass(W.domNode,["clear"],Y);Z.parent.parent.searchTableTree.searchTables(mstrmojo.string.trim(X));}},onclick:function V(W){var X=this.parent.parent,Y=X.searchTableTree;if(!Y.visible){Y.searchTables(mstrmojo.string.trim(this.value));X.openPopup("searchTableTree",{});}},postBuildRendering:function Q(){if(this._super){this._super();}this.inputNode.setAttribute("placeholder",mstrmojo.desc(12666,"Search..."));}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tb-clearBtn mstrmojo-wh-sb-btn",alias:"clearBtn",onclick:function V(){var Y=this.parent,W=Y.inputBox,X=Y.parent.searchTableTree;if(W._hasText){W.set("value","");W._hasText=false;R.removeClass(this.domNode,["clear"]);X.searchTables();}else{X.searchTables();}}}]}],initChildren:function B(){this.children.push({scriptClass:"mstrmojo.DI.DISearchTableTree",alias:"searchTableTree",cssClass:"mstrmojo-di-searchTableTree mstrmojo-wh-AvailableTablesTree mstrmojo-wh-TablesTree",visible:false,locksHover:true});this._super();},getPopupWidget:function D(){return this.searchTableTree;},getPopupHostNode:function G(){return this.domNode;},getPopupConfig:function H(){var W="mstrmojo-popup-widget-hosted",Y=[W],X=this.hostedCSSClass;if(X){Y.push(X);}return new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:Y.join(" ")});},postBuildRendering:function Q(){var W=this.getPopupWidget();if(W){var X=this.getPopupConfig();W.popupConfig=W.addDisposable(X);}return this._super();},openPopup:function(Y,W){var Z,X;this._super(Y,W);Z=mstrApp.getRootController().getDialogController().getCurrentZIndex()+10;X=this.domNode.style;if(Z!==X.zIndex){X.zIndex=Z;}},anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:""});mstrmojo.DI.DISearchTableTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.DI.DISearchTableTree",cssClass:"mstrmojo-di-searchTableTree",getItemMarkup:function C(){return'<div class="{@cls}" title="{@ttp}"><span class=item-n>{@n}</span></div>';},getItemProps:function S(Z,a,X){var Y=Z.n,W=Y;return{tag:"div",cls:(function(){var b="item "+(Z.tp?("tp"+Z.tp):"");if(E.isGeo(Z)){b+=" geo";}else{if(E.isTime(Z)){b+=" time";}}return b;}()),n:W,idx:X};},searchTables:function N(n){var h=mstrApp.getRootController(),W=h.model.importSources,l,q,g=[],j,p,X=[],f=[],t,c,Z=[],m,d=[K,L],e=[],o,Y="di-searchbox-highlight",b,a;n=n||"";p=n.toUpperCase();for(l in W){if(W.hasOwnProperty(l)){j=W[l];q={id:j.tableID,did:j.tableID,n:mstrmojo.string.encodeHtmlString(j.sourceInfo.name),tp:J,isLeaf:true};if(!p||q.n.toUpperCase().indexOf(p)!==-1){q.n=E.highlightKeyWords(n,q.n,Y);X.push(q);}t=h.getAttributesAndMetrics(j.tableID,p);I.forEach(t,function(u,k){if(!f[k]){f[k]={};}if(!Z[k]){Z[k]={};}c=f[k];m=Z[k];I.forEach(u,function(w){if(!c[w.alias]){c[w.alias]=[];}c[w.alias].push(j.tableID);m[w.alias]={georole:w.georole,dtp:w.dtp};});});}}I.forEach(f,function(x,z){var w;var u=Z[z];e[z]=[];for(w in x){if(x.hasOwnProperty(w)){q={n:E.highlightKeyWords(n,w,Y),tp:d[z],tableIds:x[w],georole:u[w].georole,dtp:u[w].dtp};e[z].push(q);}}});I.forEach([X].concat(e),function(k){k.sort(function(w,u){var z=w.n.toUpperCase(),x=u.n.toUpperCase();return(z<x)?-1:((z===x)?0:1);});});g=X;I.forEach(e,function(k){g=g.concat(k);});this.expandedIndices={};this.set("items",g);b=g.length;if(!b){return ;}a=this.domNode.firstChild.children;for(o=X.length;o<b;o++){this.expandedIndices[o]=true;this.itemRenderer.expand(a[o],this.items[o],0,o,this);}},init:function O(X){if(this._super){this._super(X);}this.dataHelper={fetch:function W(b,d){var Z=[],c,Y=mstrApp.getRootController(),a=Y.model.importSources;if(b.tp===K||b.tp===L){I.forEach(b.tableIds,function(e){if(a.hasOwnProperty(e)&&a[e]){c={id:e,did:e,n:mstrmojo.string.encodeHtmlString(a[e].sourceInfo.name),tp:J,isLeaf:true};Z.push(c);}});}d.success({items:Z});if(d.complete){d.complete();}}};},treeHooks:{select:function M(Y,e,W,d){var a,X=this.userSelections,Z=e.id,c,b;if(e.tp!==J){this.selectedIndices={};return true;}for(a in X){if(X.hasOwnProperty(a)&&X[a]){this.toggleChildSelection(a,false);}}this.selectedIndices={};this.userSelections={};this.userSelections[d]=true;R.toggleClass(Y,"selected",true);c=mstrApp.getRootController();b=c.getModel();if(b.currentSource&&b.currentSource.tableID===Z){return true;}c.selectSourceTable(Z,true);return true;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.DropDownButton","mstrmojo.Label","mstrmojo.WaitIcon");mstrmojo.IncFetch=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.IncFetch",markupString:'<div id="{@id}" class="mstrmojo-IncFetch {@cssClass}" style="{@cssText}"><div class="mstrmojo-IncFetch-content"></div><div class="mstrmojo-clearMe"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},preBuildRendering:function A(){var J=[],F=this.ds,M=this.cp,P=this.np,C=this.ps,E=this.id,G=2;var L=function(){mstrmojo.all[E].set("cp",this.text);};var H={f:1,p:Math.max(M-1,1),n:Math.min(M+1,P),l:P};for(var O in H){J.push(new mstrmojo.Button({iconClass:"arrow "+O,title:F[O],enabled:(H[O]!==M),text:H[O],onclick:L}));}var D=Math.max(Math.min(M-2,P-4),1),I=Math.min(D+4,P);for(var K=D;K<=I;K++){var N;if(K===M){if(I-D===4&&P!==5){N=new mstrmojo.DropDownButton({height:"13px",title:F.a?F.a:"",text:K,direction:"up",popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"goto",autoCloses:false,locksHover:true,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Label",cssText:"float:left;",text:F.gt},{scriptClass:"mstrmojo.TextBox",cssText:"float:left;",size:3,maxLength:String(P).length,onEnter:function(){var R=this.inputNode.value,U=this.parent.parent;if(R===""){U.close();return ;}var Q=parseInt(R,10),S=!(isNaN(Q)||Q<1||Q>P);if(S){mstrmojo.all[E].set("cp",Q);U.close();}else{this.setInvalidState(F.v.replace("###",P).replace("##",1).replace(" #",""));}}},{scriptClass:"mstrmojo.Button",cssText:"float:left",iconClass:"apply",title:F.ap?F.ap:"",onclick:function(){this.parent.children[1].onEnter();}}]}],onOpen:function(){mstrmojo.css.addClass(this.parent.domNode,["open"]);var Q=this.children[0].children[1].inputNode;window.setTimeout(function(){Q.focus();},0);},onClose:function(){mstrmojo.css.removeClass(this.parent.domNode,["open"]);this.children[0].children[1].cleanUp();}}});}else{N=new mstrmojo.Button({iconClass:"pg on",text:K});}}else{N=new mstrmojo.Button({iconClass:"pg",text:K,onclick:L});}J.splice(G++,0,N);}J.splice(G++,0,new mstrmojo.Label({text:F.pgs.replace("###",P).replace("##",""),cssText:"float:left;margin:1px 1px 1px 3px;"}));this._iWait=new mstrmojo.WaitIcon({cssText:"margin-top:-2px;"});J.push(this._iWait);this.addChildren(J);return this._super?this._super():true;},_set_cp:function B(D,C){if(parseInt(C,10)!==this.cp){this.raiseEvent({name:"fetch",v:C,iWait:this._iWait});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.StackContainer");mstrmojo.MouseOverContainer=mstrmojo.declare(mstrmojo.StackContainer,null,{scriptClass:"mstrmojo.MouseOverContainer",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',doSwitch:true,mouseoverItem:null,mouseoutItem:null,init:function(A){this._super(A);if(this.setupSelectedItem){this.setupSelectedItem();}},markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onmouseover:function(){if(this.doSwitch&&this.enabled){this.set("selected",this.mouseoverItem);}},onmouseout:function(){if(this.doSwitch){this.set("selected",this.mouseoutItem);}},preBuildRendering:function(){this.set("selected",this.mouseoutItem);}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._HasPopup","mstrmojo.Popup","mstrmojo.Label","mstrmojo.css");var B=mstrmojo.css;mstrmojo.DI.DNTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DNTextBox",sugName:"",maxInput:256,valid:false,defaultName:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DI-DNTextBox-popup",locksHover:true,slot:"popupNode",content:"",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DI-DNTextBox-defaultName",bindings:{text:function(){return this.parent.content;}},onclick:function(C){var D=this.parent&&this.parent.opener;if(D){D.set("value",C.src.text);D.closePopup();}}}]},markupString:'<div id="{@id}" class="mstrmojo-DI-DNTextBox {@cssClass}" style="{@cssText}"><input class="mstrmojo-DI-DNTextBox-input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur,click /><div class="mstrmojo-DI-DNTextBox-wordCount"></div><div class="mstrmojo-DI-DNTextBox-popup"></div></div>',markupSlots:{inputNode:function(){return this.domNode.childNodes[0];},wordCountNode:function(){return this.domNode.childNodes[1];},popupNode:function(){return this.domNode.childNodes[2];}},onclick:function(C){var D={content:this.sugName};this.openPopup("defaultName",D);},postvalueChange:function A(){var F=this.inputNode,C=this.wordCountNode,H=this.value,G=H.length,D=this.maxInput,E=D>=G&&G!==0;this.set("valid",E);C.innerHTML=G+"/"+D;B.toggleClass(C,"invalid",!E);B.toggleClass(F,"invalid",!E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.TextBox");var A=mstrmojo.css,C=mstrmojo.dom;mstrmojo.TextArea=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keydown,keyup,blur></textarea>',maxLength:256,onkeydown:function B(K){var I=this.inputNode,J=this.value,E=this.maxLength,F=(J&&J.length)||0,M=K.e,L=M.keyCode;this.isDeleteKeys=L===8||L===46;this.isArrowKeys=L===37||L===38||L===39||L===40;if(E!==undefined&&E<=F){var G=I.selectionEnd,H=(G!==undefined)?(G-I.selectionStart)>0:document.selection.createRange().text.length>0;if(!this.isDeleteKeys&&!this.isArrowKeys&&!H){if(C.isIE7||C.isIE8||C.isIE9){I.blur();window.setTimeout(function(){I.focus();},1);}C.preventDefault(window,M);return false;}}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.TextArea,{oncssClassChange:function D(){A.addClass(this.domNode,this.cssClass||"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.warehouse.dbroles.DBRoleHelper");mstrmojo.requiresDescs(12937,12938);var I=mstrmojo.warehouse.dbroles.DBRoleHelper,H=mstrmojo.dom,M=mstrmojo.string;var O=0,F=1;mstrmojo.warehouse.dbroles.DBRoleSetting=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",cssClass:"mstrmojo-wh-DBRoleSetting",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);if(this.mode===F){this.infobox.dropDown.set("selectedIndex",0);}var Q=H.position(this.infobox.captionlbl.domNode).w,R=H.position(this.infobox.txt.domNode).w,S=H.position(this.infobox.domNode).w;if((Q+R)>S){this.infobox.txt.domNode.style.width=(S-Q-10)+"px";}},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){if(this.mode===O){this.infobox.txt.set("value",this.text);}else{if(this.mode===F){this.infobox.dropDown.set("selectedIndex",parseInt(this.text));}}},isNumeric:false,isPassword:false,hiddenPwd:"",isRequired:false,enabled:true,field:undefined,parentRBAlias:"",mode:O,focus:function P(){this.infobox.txt.focus();},getValue:function E(){return this.text;},setValue:function D(Q){this.set("text",Q);this.set("value",Q);},onenabledChange:function J(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);this.infobox.dropDown.set("enabled",this.enabled);},disableTextbox:function C(){this.infobox.txt.set("enabled",false);},isValid:function N(){var Q=M.trim(this.getValue()),R={val:true,msg:""};if(!this.enabled){return R;}if(!this.isRequired&&Q===""){return R;}if(this.isRequired&&Q===""){R.val=false;R.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return R;}if(this.isNumeric&&!I.isNumeric(Q)){R.val=false;R.msg=mstrmojo.desc(12938,"Only numeric values are allowed for '##'").replace("##",this.caption);return R;}return R;},children:[{scriptClass:"mstrmojo.Box",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl",text:"this.parent.caption",useRichTooltip:true,updateTooltipConfig:function(){var S=H.position(this.domNode),Q=-40,R=10;this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(S.y+Q,0),left:Math.max(S.x+R,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.text});}},{scriptClass:"mstrmojo.TextBox",spellCheck:false,autoCapitalize:false,cssClass:"mstrmojo-wh-DBRoleSetting-Info",alias:"txt",bindings:{visible:function(){return this.parent.parent.mode===O;}},preBuildRendering:function L(){var Q=this.parent.parent;if(Q.isPassword){this.set("type","password");this.set("autoComplete",(mstrApp.autocomplete==="1"));}},onEnter:function G(){var Q=this.parent.parent;if(Q.onEnter){Q.onEnter(Q.parent.parent);}},onvalueChange:function K(Q){this.parent.parent.setValue(Q.value);}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-wh-DBRoleSetting-Info",alias:"dropDown",bindings:{visible:function(){return this.parent.parent.mode===F;},items:function(){return this.parent.parent.items;}},onitemSelected:function K(Q){this.parent.parent.setValue(Q.v);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.DI.DIConstants","mstrmojo.qb.thirdParty.UrlSourceItem");mstrmojo.requiresDescs(11098,12850,13992);var H=mstrmojo.css,F=mstrmojo.array;mstrmojo.qb.thirdParty.SourceInput=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload mstrmojo-di-fu mstrmojo-qb-thirdParty-SourceInput {@cssClass}" style="{@cssText}" ><div></div><div class="url-input"></div><div class="url-container"></div><div class="url-placeholder">'+mstrmojo.desc(15306,"Please select a connection first")+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;},instructionNode:function(){return this.domNode.firstChild;},urlInputNode:function(){return this.domNode.children[1];},urlContainerNode:function(){return this.domNode.children[2];},urlPlaceholderNode:function(){return this.domNode.lastChild;}},children:[{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",emptyText:mstrmojo.desc(12850,"Enter URL"),onvalueChange:function(){this.parent.updateAddBtnState();this.parent.enableFooterBtn();}},{slot:"urlInputNode",alias:"addBtn",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-bi-tools-add",cssDisplay:"inline-block",text:mstrmojo.desc(531,"Add"),onclick:function(){this.parent.addURL();}},{scriptClass:"mstrmojo.Box",cssClass:"select-hint-box",alias:"select-hint",bindings:{visible:function(){return this.parent.urlList.getSrcCnt()===0;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"select-hint-text",text:mstrmojo.desc(13992,"Please select a connection first")}]},{slot:"urlContainerNode",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-thirdParty-url-holder",alias:"urlList",srcs:[],bindings:{visible:function(){return true;}},postBuildRendering:function A(){this.srcs=[];},addURL:function G(O){var N=mstrApp.getRootController();var L=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",url:O,dbRoleID:N.model.SelDBRoleID,dbRoleName:N.model.SelDBRoleName,index:this.srcs.length===0?0:this.srcs[this.srcs.length-1].index+1});this.srcs.push({url:L.url,dbRoleID:L.dbRoleID,index:this.srcs.length===0?0:this.srcs[this.srcs.length-1].index+1});var M=this.addChildren(L);M.render();this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";},deleteURL:function I(L){var M=mstrmojo.array.find(this.srcs,"index",L.index);this.removeChildren(L);this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";this.parent.enableFooterBtn();if(M>=0){this.srcs.splice(M,1);}},deleteAll:function(){this.removeChildren();this.srcs=[];this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";this.parent.enableFooterBtn();},getSrcCnt:function(){return this.children?this.children.length:0;},getSrcs:function(){return this.srcs;}}],addURL:function G(){var L=mstrApp.getRootController();var N=L.model;var M=this.urlInput.value;M=M.replace(/^\s+|\s+$/g,"");if(M.length===0||!N.SelDBRoleID){return ;}if(!N.isNew){this.urlList.deleteAll();}this.urlList.addURL(M);this.urlInput.set("value","");},enableFooterBtn:function B(){var L=mstrApp.getRootController();var O=L.model;var P=this.urlList.getSrcCnt();var M=this.urlInput.value;if(P===0){var N=M&&O.SelDBRoleID;L.enableButton(N);}else{if(!O.isNew&&P===1){L.enableButton(M.length<1);}}},getSrcs:function D(){this.addURL();return this.urlList.getSrcs();},removeSrcs:function C(O){var L=this.urlList;var M=L.children,N=[];F.forEach(O,function(P){F.forEach(M,function(Q){if(Q.url===P.url){N.push(Q);return false;}});});F.forEach(N,function(P){L.removeChildren(P);});},initURL:function J(){var L=mstrApp.getRootController().model.SQLstmt;if(L&&L.length>0){this.urlList.addURL(L);this.enableFooterBtn();}},postBuildRendering:function E(){if(this._super){this._super();}var L=this;var M=mstrApp.getRootController().model;M.attachEventListener("reportDefLoaded",this.id,this.initURL);M.attachEventListener("BISourceChange",this.id,function(){L.updateAddBtnState();L.enableFooterBtn();});},updateAddBtnState:function(){var L=mstrApp.getRootController();var N=L.model;var M=N.SelDBRoleID&&this.urlInput.value;this.toggleAddBtnState(M);},toggleAddBtnState:function K(L){H[L?"addClass":"removeClass"](this.addBtn.domNode,["hot"]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo.hash");var A="mstrmojo-TextBoxWithLabel";mstrmojo.TextBoxWithLabel=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextBoxWithLabel",label:"",rightLabel:"",cssDisplay:"inline",type:"text",markupString:'<div class="'+A+' {@cssClass}" style="{@cssText}"><span class="mstrmojo-TextBox-label">{@label}</span><input id="{@id}" class="mstrmojo-TextBox {@inputNodeCssClass}"  style="{@inputNodeCssText}" title="{@tooltip}" type="{@type}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur/><span class="mstrmojo-TextBox-label-right">{@rightLabel}</span></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild.nextSibling;},lblNode:function(){return this.domNode.firstChild;}}});mstrmojo.TextBoxWithLabel.prototype.markupMethods=mstrmojo.hash.copy({oncssClassChange:function(){var B=this.cssClass;this.domNode.className=A+(B?" "+B:"");},onlabelChange:function(){this.lblNode.innerText=this.label||"";}},mstrmojo.hash.copy(mstrmojo.TextBoxWithLabel.prototype.markupMethods));}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextBox");mstrmojo.requiresDescs(7564);var F,I=mstrmojo.string,J=mstrmojo.desc(7564,"Select...");mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector",postBuildRendering:function A(){if(this._super){this._super();}this.infobox.captionlbl.set("text",this.caption);},caption:"",text:"",infobox:undefined,captionlbl:undefined,ontextChange:function B(){this.infobox.txt.set("value",this.text);},isRequired:false,enabled:true,field:undefined,selectorOption:0,parentRBAlias:"",focus:function M(){this.infobox.txt.focus();},getValue:function D(){return this.text;},setValue:function C(N){this.set("text",N);this.set("value",N);},onenabledChange:function G(){this.infobox.captionlbl.set("enabled",this.enabled);this.infobox.txt.set("enabled",this.enabled);},isValid:function L(){var N=I.trim(this.getValue()),O={val:true,msg:""};if(!this.enabled){return O;}if(!this.isRequired&&N===""){return O;}if(this.isRequired&&N===""){O.val=false;O.msg=mstrmojo.desc(12937,"Value for '##' cannot be empty").replace("##",this.caption);return O;}return O;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-InfoBox",alias:"infobox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Info",alias:"txt",onEnter:function E(){var N=this.parent.parent;if(N.onEnter){N.onEnter(N.parent.parent);}},onvalueChange:function H(N){this.parent.parent.setValue(N.value);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSettingFileSelector-Select",alias:"fileSelector",text:J,bindings:{visible:function(){var O=this.parent.parent.selectorOption,N=!!(mstrApp.isSingleTier),P=(navigator.platform.indexOf("Win")!==-1),Q=!P;if(((O&1)===1)&&!N){return true;}if(((O&2)===2)&&N&&P){return true;}if(((O&4)===4)&&N&&Q){return true;}return false;}},onclick:function K(){F=this.parent;mstrApp.rootController.launchOneTierAccessFileBrowser("mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector");}}]}]});mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector.oneTierFileSelector=function(N){F.txt.set("value",N);};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo._HasLayout");mstrmojo.ui.editors.controls.PreviewButton=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.PreviewButton",markupString:'<div id="{@id}" class="mstrmojo-ui-PreviewButton {@cssClass}" style="{@cssText}"><div class="cf" mstrAttach:click><div class="preview"></div><div class="btn">&nbsp;</div></div><div class="host"></div></div>',markupSlots:{previewNode:function(){return this.domNode.firstChild.firstChild;},btnNode:function(){return this.domNode.firstChild.lastChild;},widgetHostNode:function(){return this.domNode.lastChild;},clickableNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{previewNode:"100%",btnNode:"100%",widgetHostNode:"0px"},w:{previewNode:"100%",btnNode:"20px",widgetHostNode:"all"},xt:true},isHostedWithin:false,getLayoutOffsets:function B(){return{h:2,w:2};},anchorSlot:"clickableNode",updatePreview:function C(){throw new Error(this.scriptClass+" must implement updatePreview.");},getPopupHostNode:function A(){return this.widgetHostNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.PopupEditBox");var A=mstrmojo.dom;var F=mstrmojo.DI.DIHelpers;function E(G){var H=this.columnIndex;var I=this.rowIndex;this.preview.downColumn=H;this.preview.downRow=I;this.preview.controller.isClickedInDatePreview=true;this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.columnName,isCtrlKey:F.isCtrlKey(G.hWin,G.e)});}function C(N){var I=N.e.srcElement;var H=this.columnIndex;var Q=this.rowIndex;if(this.preview.downColumn===H&&this.preview.downRow===Q){var M=null,J,K,L;var P=String(this.text).length;var O=String(this.text);if(window.getSelection){M=window.getSelection();J=M.getRangeAt(0);K=J.startOffset;L=J.endOffset;if(!J.collapsed&&J.startContainer===J.endContainer){this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}else{this.preview.controller.resetRecords();}}else{M=document.selection;J=M.createRange();var G=J.duplicate();G.moveToElementText(I);G.setEndPoint("EndToEnd",J);K=G.text.length-J.text.length;L=K+J.text.length;this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}}}function B(){var K=this.parent.parent.controller;K.resetRecords();K.model.raiseEvent({name:"columnUnSelected"});var H=this.columnIndex;var P=this.column[H].cellIndex;var Q=this.rowIndex;var G=A.position(this.domNode);var L=A.position(this.preview.dataNode);var O=(G.x+G.w)-(L.x+L.w);if(O>0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft+O;G=A.position(this.domNode);L=A.position(this.preview.dataNode);}else{if(G.x-L.x<0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft-(L.x-G.x);G=A.position(this.domNode);L=A.position(this.preview.dataNode);}}var J=(G.x+G.w+72)<=(L.x+L.w);var I=(J?(G.x):(G.x-72-3))-1-1-3;var N=G.y-1-1-3;var M=this.preview;mstrmojo.insert({scriptClass:"mstrmojo.Refine.PopupEditBox",top:N+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+72+2+3+"px",text:String(this.text).replace(/\n/g," "),value:String(this.text),preview:M,columnName:this.columnName,row:Q,cell:P,type:this.cssClass,floatLeft:J}).render();}function D(){if(this.preview.columnIndex>=0){if(this.preview.lastColumnIndex>=0&&this.preview.columnIndex>=this.preview.lastColumnIndex){this.preview.controller.generateColumnSuggestions(this.preview.columnIndex,this.preview.lastColumnName,this.preview.columnIndex-this.preview.lastColumnIndex+1);}else{this.preview.controller.generateColumnSuggestions(this.preview.columnIndex);}}if(this.preview.controller.isClickedInTransformation){this.preview.controller.resetRecords();this.preview.controller.isClickedInTransformation=false;}if(window.getSelection){window.getSelection().removeAllRanges();}else{document.selection.empty();}}mstrmojo.Refine.RefineDataCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineDataCell",markupString:'<div tabindex="-1" id="{@id}" class="refine-cell-node {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,blur,dblclick><div class="refine-cell-text-container"><div class="refine-cell-pseudo-text"></div><div class="refine-cell-text"></div></div></div>',markupSlots:{pseudoNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);this.textNode.title=this.text;this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);}},resetText:function(){if(this.pseudoNode){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text)||"",null,true);}},highlightSelectedText:function(G,H){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).substring(0,G),null,true)+'<span class="refine-selected-text">'+mstrmojo.string.encodeHtmlString(String(this.text).substring(G,H),null,true)+"</span>"+mstrmojo.string.encodeHtmlString(String(this.text).substring(H),null,true);},columnIndex:null,preview:null,onmousedown:E,onmouseup:C,ondblclick:B,onblur:D});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Widget","mstrmojo.string");var D={none:0,moveMetricHeader:1,moveData:2,moveDataColumn:3,moveDataRow:4};var L=mstrmojo.string;function N(R,P,O){var Q;if(O.startRow===O.endRow&&R===O.startRow&&P>=O.startColumn){Q=true;}else{Q=O.startColumn===O.endColumn&&P===O.startColumn&&R>=O.startRow;}return Q;}function F(Q,P,O){return Q===O.startRow&&P===O.startColumn;}function E(Q,P,O){return P===O.startColumn&&Q>O.startRow;}function C(Q,P,O){return Q===O.startRow&&P>O.startColumn;}function I(R,Q,P,O){if(N(R,Q,P)||(this.operation===D.moveMetricHeader)){this.domNode.style.cursor="move";}else{if(F(R,Q,O)||(this.operation===D.moveData)){this.domNode.style.cursor="se-resize";}else{if(E(R,Q,O)||(this.operation===D.moveDataColumn)){this.domNode.style.cursor="w-resize";}else{if(C(R,Q,O)||(this.operation===D.moveDataRow)){this.domNode.style.cursor="n-resize";}else{this.domNode.style.cursor="auto";}}}}}function A(P){var O=P.currentTarget;var Q=O.parentNode;if(N(Q.rowIndex,O.cellIndex,this.xtabModel.mhb)){this.operation=D.moveMetricHeader;this.draw();}if(F(Q.rowIndex,O.cellIndex,this.xtabModel.db)){this.operation=D.moveData;this.draw();}if(E(Q.rowIndex,O.cellIndex,this.xtabModel.db)){this.operation=D.moveDataColumn;this.draw();}if(C(Q.rowIndex,O.cellIndex,this.xtabModel.db)){this.operation=D.moveDataRow;this.draw();}}function G(P){var O=(P.currentTarget)?P.currentTarget:P.srcElement;var V=O.parentNode;var R=this.xtabModel.mhb;var Q=this.xtabModel.db;var U={x:V.rowIndex,y:O.cellIndex};var S=window.getSelection();S.removeAllRanges();if(this.operation===D.none){I.call(this,V.rowIndex,O.cellIndex,R,Q);return ;}switch(this.operation){case D.moveMetricHeader:if((U.x<Q.startRow)&&(U.y>=Q.startColumn)){R.set("startRow",U.x);R.set("startColumn",Q.startColumn);R.set("endRow",U.x);R.set("endColumn",-1);}else{if((U.y<Q.startColumn)&&(U.x>=Q.startRow)){R.set("startRow",Q.startRow);R.set("startColumn",U.y);R.set("endRow",-1);R.set("endColumn",U.y);}}break;case D.moveData:Q.set("startRow",U.x);Q.set("startColumn",U.y);if(R.startColumn>-1&&R.startRow>-1&&R.startRow===R.endRow){if(R.startRow>=U.x){R.set("startRow",U.x-1);R.set("endRow",U.x-1);}R.set("startColumn",U.y);}else{if(R.startColumn>-1&&R.startRow>-1&&R.startRow!==R.endRow){if(R.startColumn>=U.y){R.set("startColumn",U.y-1);R.set("endColumn",U.y-1);}R.set("startRow",U.x);}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;case D.moveDataRow:Q.set("startRow",U.x);if(R.startColumn>-1&&R.startRow>-1&&R.startRow===R.endRow){if(R.startRow>=U.x){R.set("startRow",U.x-1);R.set("endRow",U.x-1);}}else{if(R.startColumn>-1&&R.startRow>-1&&R.startRow!==R.endRow){if(R.startColumn>=U.y){R.set("startColumn",U.y-1);R.set("endColumn",U.y-1);}R.set("startRow",U.x);}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;case D.moveDataColumn:Q.set("startColumn",U.y);if(R.startColumn>-1&&R.startRow>-1&&R.startRow===R.endRow){if(R.startRow>=U.x){R.set("startRow",U.x-1);R.set("endRow",U.x-1);}R.set("startColumn",U.y);}else{if(R.startColumn>-1&&R.startRow>-1&&R.startRow!==R.endRow){if(R.startColumn>=U.y){R.set("startColumn",U.y-1);R.set("endColumn",U.y-1);}}else{this.raiseEvent({name:"NoMetricHeaderBlock"});}}break;}this.draw();I.call(this,V.rowIndex,O.cellIndex,R,Q);}function K(){this.operation=D.none;this.draw();}function H(){var X=this.domNode.firstChild.children;var Q,P;var S=this;var O=function(Y){G.call(S,Y);};var U=function(Y){A.call(S,Y);};var R=function(Y){K.call(S,Y);};for(Q=0;Q<X.length;Q++){var W=X[Q];var V=W.children;for(P=0;P<V.length;P++){mstrmojo.dom.attachEvent(V[P],"mousemove",O);mstrmojo.dom.attachEvent(V[P],"mousedown",U);mstrmojo.dom.attachEvent(V[P],"mouseup",R);}}}function M(Q){var P=200;var R=this.parent&&this.parent.previewNode;if(!R){return ;}var O=P*Q;if(R.clientWidth>O){this.cssText="width:100%";}else{this.cssText="width:"+O+"px";}}mstrmojo.DI.DIXtabPreview=mstrmojo.declare(mstrmojo.Table,null,{scriptClass:"mstrmojo.DI.DIXtabPreview",preview:null,colHdrs:null,xtabModel:null,operation:D.none,cellCssClass:"di-xtab-cell",setDimensions:function J(R,P){if(!this.colHdrs){return ;}var Q=parseInt(P,10);var O=parseInt(R,10)-5+"px";var S=200;var U=this.parent&&this.parent.previewNode;if(!U){return ;}this.parent.preGrid.set("height",O);if(Q>this.colHdrs.length*S){this.domNode.style.width="100%";}else{this.domNode.style.width=this.colHdrs.length*S+"px";}},initXtab:function(Q,O,P){this.preview=Q;this.xtabModel=O;this.colHdrs=P;if(!O){return ;}this.populate();H.call(this);},populate:function(){var O=this.colHdrs.length;this.removeChildren();this.unrender();this.rows=49;this.cols=O;M.call(this,O);this.render();this.addContents();this.draw();},addContents:function B(){var S=this.domNode.firstChild.children;var R=this.preview;var U,P,Q,O;for(Q=0;Q<S.length;Q++){U=S[Q];P=U.children;for(O=0;O<P.length;O++){if(Q===0){P[O].innerHTML=L.encodeHtmlString(this.colHdrs[O]);}else{if(!mstrmojo.string.isEmpty(R[Q-1][O])){P[O].innerHTML=L.encodeHtmlString(R[Q-1][O].toString());}}}}},draw:function(){var S,R,Y,W;var P=this.xtabModel.mhb;var X=this.xtabModel.db;var Z=this.domNode.firstChild.children;if(X.startRow>this.rows||X.startColumn>this.cols||(P.startRow===-1&&P.startColumn===-1&&X.startRow===-1&&X.startColumn===-1)){X.set("startRow",0);X.set("startColumn",0);X.set("endRow",-1);X.set("endColumn",-1);P.set("startRow",-1);P.set("startColumn",-1);P.set("endRow",-1);P.set("endColumn",-1);for(S=0;S<Z.length;S++){Y=Z[S];W=Y.children;for(R=0;R<W.length;R++){W[R].className="di-xtab-cell di-xtab-cell-data";}}return ;}var U=X.endColumn>-1?X.endColumn:this.cols-1;var Q=P.endColumn>-1?P.endColumn:this.cols-1;var V=X.endRow>-1?X.endRow:this.rows-1;var O=P.endRow>-1?P.endRow:this.rows-1;for(S=0;S<Z.length;S++){Y=Z[S];W=Y.children;for(R=0;R<W.length;R++){W[R].className="";if(R>=X.startColumn&&S>=X.startRow){W[R].className="di-xtab-cell di-xtab-cell-data";if(S===X.startRow){W[R].className+=" di-xtab-cell-data-top";if((R-X.startColumn)%5===0){W[R].className+=" handler";}}if(S===V){W[R].className+=" di-xtab-cell-data-bottom";}if(R===X.startColumn){W[R].className+=" di-xtab-cell-data-left";if((S-X.startRow)%5===0){W[R].className+=" handler";}}if(R===U){W[R].className+=" di-xtab-cell-data-right";}}else{if(R<X.startColumn&&S<X.startRow){W[R].className="di-xtab-cell di-xtab-cell-undefined";}else{if(P.startColumn===X.startColumn&&S===P.startRow&&R>=P.startColumn){W[R].className="di-xtab-cell di-xtab-cell-metricHeader di-xtab-cell-metricHeader-top di-xtab-cell-metricHeader-bottom";if(R===P.startColumn){W[R].className+=" di-xtab-cell-metricHeader-left header-first-one";}else{if(R===Q){W[R].className+=" di-xtab-cell-metricHeader-right";}}}else{if(P.startRow===X.startRow&&R===P.startColumn&&S>=P.startRow){W[R].className="di-xtab-cell di-xtab-cell-metricHeader di-xtab-cell-metricHeader-left di-xtab-cell-metricHeader-right";if(S===P.startRow){W[R].className+=" di-xtab-cell-metricHeader-top header-first-one";}else{if(S===O){W[R].className+=" di-xtab-cell-metricHeader-bottom";}}}else{W[R].className="di-xtab-cell di-xtab-cell-dataElement";}}}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.Table");mstrmojo.requiresDescs(12652,12653,12654,12657,12885,12886,12887,15478);var B=mstrmojo.DI.DIConstants;mstrmojo.DI.DISourceIntro=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DISourceIntro",markupString:'<div id="{@id}" class="mstrmojo-di-source-intro {@cssClass}" ><div></div></div>',markupSlots:{introNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onNextButtonClick:function A(){mstrApp.getRootController().getOAuthSourceReports(this.sourceInfo.type,false);},children:[{scriptClass:"mstrmojo.Label",alias:"subTitle",slot:"introNode",cssClass:"mstrmojo-di-source-intro-title",bindings:{text:function(){return mstrmojo.desc(12885,"With ####, You can now connect to @@@@").replace("####",mstrApp.applicationName()).replace("@@@@",this.parent.sourceInfo.name);}}},{slot:"introNode",scriptClass:"mstrmojo.Image",cssClass:"image-di-source-intro di-image"},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-di-source-steps",slot:"introNode",rows:2,cols:3,children:[{slot:"0,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step1",bindings:{text:function(){return mstrmojo.desc(12886,"Sign in to ####").replace("####",this.parent.parent.sourceInfo.name);}}},{slot:"0,1",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step2",bindings:{text:function(){return this.parent.parent.sourceInfo.step2||mstrmojo.desc(12652,"Select Your File");}}},{slot:"0,2",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step3",bindings:{text:function(){return this.parent.parent.sourceInfo.step3||mstrmojo.desc(12653,"Create a Visualization");}}},{slot:"1,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step1-detail",bindings:{text:function(){return mstrmojo.desc(12654,"MicroStrategy does not store or request your credentials");}}},{slot:"1,1",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step2-detail",bindings:{text:function(){return mstrmojo.desc(12887,"Max File Size: #### MB").replace("####",mstrApp.diParams.UploadSizeLimit);},visible:function(){switch(this.parent.parent.sourceInfo.type){case B.sourceType.dropbox:case B.sourceType.googleDrive:case B.sourceType.salesforce:return true;default:return false;}}}},{slot:"1,2",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-source-steps mstrmojo-di-source-step3-detail",bindings:{text:function(){return mstrmojo.desc(15478,"Publish a cube and then create dossiers and documents.");}}}]},{slot:"introNode",scriptClass:"mstrmojo.Image",cssClass:"image-di-divider di-image"},{scriptClass:"mstrmojo.Label",alias:"introText1",bindings:{text:function(){return mstrmojo.desc(12657,"Click Continue below to get started!");}},cssClass:"mstrmojo-di-source-continue",slot:"introNode"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.tooltip");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.hash,H=mstrmojo.array,C=mstrmojo.tooltip;mstrmojo.ui._HasListTooltip=mstrmojo.provide("mstrmojo.ui._HasListTooltip",{_mixinName:"mstrmojo.ui._HasListTooltip",tooltipOrientation:"horizontal",tooltipOffset:8,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipCss:{},tooltipContrast:false,getTooltipText:function A(I){return I&&(D.encodeHtmlString(I.ttp,true)||D.encodeHtmlString(I.n,true));},showTooltip:function G(a,N){var Q=this;if(!Q.hasOpenTooltip&&!(Q._lastOpened&&Q._lastOpened.visible)){var g=E.eventTarget(N,a),b=Q.getItemFromTarget(g),V=Q.getItemNodeFromTarget(g),j=Q.getTooltipText(b),P=Q.tooltipCss;if(!j||b.ttpDisabled){return ;}if(Q.showTooltipForLargeText){if(V.offsetWidth>=V.scrollWidth){return ;}}var h=E.position(V),Z,R,L,X="",Y=Q.tooltipOffset,O=(b&&b.ctxt)||{};if(this.tooltipOrientation==="vertical"){Z=h.x+h.w/2;L=O.posType||C.POS_TOPCENTER;R=h.y+h.h+Y;var M="mojo-theme-light vi-regular vi-tooltip-A";if(!O.posType){M+=" A-center";}Q.tooltipCss=F.copy({cssClass:M},P);}else{var K=E.windowDim(),W=40,c=h.x+h.w+Y,J=h.x-Y,f=J-W,I=K.w-(c+W),d="vi-regular vi-tooltip-",U;R=h.y;if(I>=f){Z=c;U=I;L=O.posType||C.POS_TOPLEFT;P.cssClass=d+"C "+P.rightCssClass;}else{Z=J;U=f;L=O.posType||C.POS_TOPRIGHT;P.cssClass=d+"D "+P.leftCssClass;}X="max-width: "+U+"px;";}if(Q.tooltipContrast){P.cssClass=P.cssClass+" contrast";}if(P&&P.getItemCssClass){P.cssClass=H.filter([P.cssClass,P.getItemCssClass(b)],function(e){return !!e;}).join(" ");}var S=Q.richTooltip=F.copy(Q.tooltipCss,{content:D.apply(Q.tooltipMarkup,{c:j,style:X}),top:R,left:Z,posType:L});if(Q.itemDisabled){S.cssClass+=" vi-warning";}if(O.hoverable){S.enableHover=true;}if(O.posType==="TL"){S.left=h.x;}S.keepArrowXPos=!!Q.keepArrowXPos;S.keepArrowYPos=!!Q.keepArrowYPos;this._super(a,N);}},onclick:function B(I){var J=this;window.setTimeout(function(){if(J.hasOpenTooltip){J.hideTooltip();}window.clearTimeout(J._tooltipTimeOut);},0);this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var C=mstrmojo.hash.copy,P=mstrmojo.css,J=mstrmojo.dom,N=mstrmojo.array,E=mstrmojo.string,Q=function Q(W,U){if(!W){return ;}var S=U&&U.length||0,V;for(V=S;V>0;V--){W=W.replace(new Array(V+2).join("#"),U[V-1]);}return W;},L=function L(U){if(!U){return ;}var a=this,W=J.position(U.refNode||a.refNode),Z=J.position(a.domNode),Y=U.position||R.RIGHT,V=0,b=0,S=9+(U.margin!==undefined?U.margin:0),X=" ";switch(Y){case R.TOP:b=-Z.h-S;X+="t";break;case R.BOTTOM:b=W.h+S;X+="b";break;case R.LEFT:V=-Z.w-S;X+="l";break;case R.RIGHT:V=W.w+S;X+="r";break;}mstrmojo.hash.forEach(C(U,{left:V,top:b,contentNodeCssClass:X,visible:false}),function(c,d){this[d]=c;},this);this.set("visible",U.invalid);},A=function A(S){var X=this,V,W=S.errorCode,Y=S.errorMsg,U=S.args,Z=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(S.invalid){V={content:W!==null?(X.generateContentHTML(Q(Z[W],U))||Z["*"]):Y};}return V;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=C(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var R=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function G(V){var Z=this,b=Z.warningSlotName,d=Z[b],S=V&&V.lasting||6000,Y=V.refNode||this.domNode,U=V.highlight!==false,c=V.closeOnClick===false?false:true,a;if(!d){d=new mstrmojo.Tooltip({refNode:Y,highlight:U,closeOnClick:c,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});Z.addDisposable(d);Z[b]=d;a=Z.closeOnClick=Z.getCloseOnClickListener();J.attachEvent(document.body,"click",a);}var X=V.position||R.TOP,W="vi-warning vi-tooltip-";switch(X){case R.TOP:d.cssClass=W+"V";break;case R.BOTTOM:d.cssClass=W+"A";break;case R.LEFT:d.cssClass=W+"D";break;case R.RIGHT:d.cssClass=W+"C";break;}d.open(Z,A.call(Z,V));this.adjustPosition(V);if(U){P.toggleClass(d.refNode,"mstrmojo-Warning",true);}window.clearTimeout(Z._warningTimeOut);Z._warningTimeOut=window.setTimeout(function(){Z.hideWarning();},S);},hideWarning:function H(){var U=this,S=U[U.warningSlotName];if(S&&S.visible&&S.close){if(S.highlight){P.toggleClass(S.refNode,"mstrmojo-Warning",false);}S.close();window.clearTimeout(U._warningTimeOut);delete U._warningTimeOut;}},getCloseOnClickListener:function I(){var S=this;return function(){var U=S[S.warningSlotName];if(U.closeOnClick){S.hideWarning();}};},adjustPosition:function M(S){var U=this;L.call(U[U.warningSlotName],S);},generateContentHTML:function D(S){return E.encodeHtmlString(S,true);},bindWarningHandler:function F(){N.forEach(arguments,function S(V){if(!V||!V.attachEventListener){return ;}var W=V._validationEventListener,U;if(W){V.detachEventListener(W);delete V._validationEventListener;}U=this.getValidationEvtListener();if(U){V._validationEventListener=V.attachEventListener("validationChange",this.id,U);}},this);},getValidationEvtListener:function B(){var U=this;return function S(V){var W=V.value;U[(W&&W.invalid?"show":"hide")+"Warning"](W);};},unrender:function K(S){var U=this[this.warningSlotName];if(U){U.unrender();}this._super(S);},destroy:function O(S){J.detachEvent(document.body,"click",this.closeOnClick);return this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.tooltip");mstrmojo.requiresDescs(14286,14287,14328,15600);var A=mstrmojo.DI.DIDatabaseHelper,B=30,D=mstrmojo.hash,C=function(E){return E.name||E.n;};mstrmojo.AS.DIAppSchemaRepublishTreeNode=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.AS.DIAppSchemaRepublishTreeNode",data:null,cssClass:"dataset-table",iconClass:"",buttonClass:"",markupString:'<div id="{@id}" class="cf {@cssClass}" style="width:380px;"><span class="item icon {@iconClass}" style="height:18px;"></span><div class="tableNode" style="display: inline-block;"></div><div style="display: inline-block;"></div><div style="display: inline-block;"></div></div>',markupSlots:{tableNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[2];},menuNode:function(){return this.domNode.children[3];}},getItemActionBtn:mstrmojo.emptyFn,getMenuBtn:mstrmojo.emptyFn,injectEvts:mstrmojo.emptyFn,preBuildRendering:function(){this._super&&this._super();this.injectEvts&&this.injectEvts();var E=this.getItemActionBtn(),F=this.getMenuBtn();D.copy({slot:"buttonNode"},E);D.copy({slot:"menuNode"},F);this.addChildren([E,F]);},children:[{scriptClass:"mstrmojo.Label",slot:"tableNode",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,top:32},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.richTooltip.content=this.title;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},bindings:{text:function(){var E=C(this.parent.data);if(E.length>B){E=E.substr(0,B)+"...";}return E;},title:function(){var F="",E=C(this.parent.data);if(E.length>B){F=E;}return F;},cssClass:function(){var E="table-font-credentials-not-fetched";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.domNode,E);E="";}else{mstrmojo.css.addClass(this.domNode,E);}return"dataset-table-name "+E;}}}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._ListSelections","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var Q=mstrmojo.dom,C=mstrmojo.css,R=mstrmojo.hash,K=mstrmojo.all,d=mstrmojo._HasMarkup,e="px";var D={},J=false,a;function c(){var o={mousedown:["touchstart","mousedown"],mouseup:["touchend","mouseup"],mousemove:["touchmove","mousemove"]},n;for(n in o){D[n]=J?o[n][0]:o[n][1];}}function l(o){if(this.dragging){return ;}this._moveCnt++;if(this._moveCnt>this.mousemoveBuffer){var n=document.body;Q.detachEvent(n,"mousemove",this._mousemoveCallback);Q.detachEvent(n,"mouseup",this._cancelCallback);this.initDrag(o);}}function g(o){if(this.dragging){return ;}this._moveCnt++;if(this._moveCnt>this.mousemoveBuffer){var n=document.body;Q.detachEvent(n,"touchmove",this._touchmoveCallback);Q.detachEvent(n,"touchend",this._cancelCallback);if(a){window.clearTimeout(a);}this.initDrag(o);}}function H(q){var n=document.body,p=J?"_touchmoveCallback":"_mousemoveCallback";Q.detachEvent(n,D.mousemove,this[p]);Q.detachEvent(n,D.mouseup,this._cancelCallback);if(a){window.clearTimeout(a);}var o=this.afterDragCancel;if(o){o.call(this.target,q);}}function G(u){J=true;c();Q.preventDefault(window,u);if(this.dragging){return true;}var p=this.target.id,q=document.body,o=u&&u.touches&&u.touches[0]||u;if(!this._touchmoveCallback){this._touchmoveCallback=function(w){g.call(K[p].dnd,w&&w.touches&&w.touches[0]||w);return true;};}this._moveCnt=0;this.startE=R.copy(o);Q.attachEvent(q,"touchmove",this._touchmoveCallback);if(!this._cancelCallback){this._cancelCallback=function(w){H.call(K[p].dnd,o);return true;};}Q.attachEvent(q,"touchend",this._cancelCallback);var t=this,n=o;n.type=n.name="contextmenu";a=window.setTimeout(function(){var x=t.target,z=x&&x.docSelector,w=z&&z.parent;Q.detachEvent(q,"touchmove",this._touchmoveCallback);Q.detachEvent(q,"touchend",this._cancelCallback);if(w){w.raiseEvent(d.newDomEvent("contextmenu",window,n));}},1000);return false;}function f(p){J=false;c();Q.preventDefault(window,p);if(this.dragging){return true;}var n=this.target.id,o=document.body;if(!this._mousemoveCallback){this._mousemoveCallback=function(q){l.call(K[n].dnd,q);return true;};}this._moveCnt=0;this.startE=R.copy(p);Q.attachEvent(o,"mousemove",this._mousemoveCallback);if(!this._cancelCallback){this._cancelCallback=function(q){H.call(K[n].dnd,q);return true;};}Q.attachEvent(o,"mouseup",this._cancelCallback);return false;}function E(o){var n=this.duringDrag;if(n){n.call(this.target,o);}return true;}function N(p){this.dragging=false;var n=document.body;Q.detachEvent(n,D.mousemove,this._dragCallback);Q.detachEvent(n,D.mouseup,this._dragEndCallback);var o=this.afterDragEnd;if(o){o.call(this.target,p);}return true;}function W(){if(this._mousemoveCallback){Q.detachEvent(document.body,"mousemove",this._mousemoveCallback);delete this._mousemoveCallback;}if(this._touchmoveCallback){Q.detachEvent(document.body,"touchmove",this._touchmoveCallback);delete this._touchmoveCallback;}if(this._cancelCallback){Q.detachEvent(document.body,"mouseup",this._cancelCallback);Q.detachEvent(document.body,"touchup",this._cancelCallback);delete this._cancelCallback;}if(this._dragCallback){Q.detachEvent(document.body,"mousemove",this._dragCallback);Q.detachEvent(document.body,"touchmove",this._dragCallback);delete this._dragCallback;}if(this._dragEndCallback){Q.detachEvent(document.body,"mouseup",this._dragEndCallback);Q.detachEvent(document.body,"touchmove",this._dragEndCallback);delete this._dragEndCallback;}}mstrmojo.DnDComponent=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.DnDComponent",isDragging:false,initD:null,startE:null,afterDragStart:null,duringDrag:null,afterDragEnd:null,target:null,mousemoveBuffer:1,init:function V(n){R.copy(n,this);},initDrag:function k(t){this.dragging=true;var o=this.target.id,q=document.body;var u=this._dragCallback;if(!u){u=this._dragCallback=function(w){if(J){w=w&&w.touches&&w.touches[0]||w;}return E.call(K[o].dnd,w);};}Q.attachEvent(q,D.mousemove,u);var n=this._dragEndCallback;if(!n){n=this._dragEndCallback=function(w){if(J){w=w&&w.touches&&w.touches[0]||w;}return N.call(K[o].dnd,w);};}Q.attachEvent(q,D.mouseup,n);var p=this.afterDragStart;if(p){p.call(this.target,t);}this._dragCallback(t);}});function Z(n){this.getUnit=function o(){var p=n.items.length;return p>1?n._effLen/(p-1):1;};this.calcMinMax=function(t,q){var u=Math.round((t/n.unit+q/n.unit)/2);return{min:u,max:u};};this.preUpdateThumb=function(){n.start=Math.min(n.min*n.unit,n._effLen)+e;n.sdCssText=n.orCfg.posCssP+":"+n.start+";";};this.updateThumb=function(){n.containerNode.style[n.orCfg.posCssP]=n.start=Math.min(Math.round(n.min*n.unit),n._effLen)+e;};return this;}function j(n){this.getUnit=function(){return n._effLen/n.items.length;};this.calcMinMax=function(q,p){return{min:Math.floor(q/n.unit+0.5),max:Math.floor(p/n.unit-0.5)};};function o(){var p=n.min,t=n.unit;var u=n.start=(p*t)+e;var q=n.length=Math.max(Math.round((n.max-p+1)*t-n.gap),0)+e;return{st:u,len:q};}this.preUpdateThumb=function(){var q=n.orCfg,p=o();n.sdCssText=q.posCssP+":"+p.st+";"+q.lenCssP+":"+p.len+";";};this.updateThumb=function(){var q=n.orCfg,p=o(),t=n.containerNode.style;t[q.posCssP]=p.st;t[q.lenCssP]=p.len;};return this;}var F="<span>{@content}</span>";mstrmojo.Slider=mstrmojo.declare(mstrmojo.Container,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.Slider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',sdCssText:"",cssClass:"sc",clsType:"sc2",clsOrientation:"sc-v",orCfg:null,typeHelper:null,_tooltip_pos:"TL",useRichTooltip:true,init:function h(n){this._super(n);if(n.isHoriz){this.orCfg={posCssP:"left",marginCssP:"marginLeft",lenCssP:"width",lenP:"clientWidth",opPosCssP:"top",thickP:"clientHeight",offsetP:"x"};this.clsOrientation=" sc-h";this._tooltip_pos=mstrmojo.tooltip.POS_BOTTOMLEFT;}else{this.orCfg={posCssP:"top",marginCssP:"marginTop",lenCssP:"height",lenP:"clientHeight",opPosCssP:"left",thickP:"clientWidth",offsetP:"y"};this._tooltip_pos=mstrmojo.tooltip.POS_TOPRIGHT;this.titleHeight=(n.docSelector.fmts.ttl&&n.docSelector.fmts.ttl.height)?parseInt(n.docSelector.fmts.ttl.height,10):0;}this._exRoom=this.thumbWidth;if(this.multiSelect){this._exRoom*=2;}if(n.multiSelect){this.typeHelper=new j(this);}else{this.clsType="sc1";this.typeHelper=new Z(this);}},markupSlots:{dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:function(){this.synchronizeSlider();}},start:"50px",length:"30px",min:0,max:0,gap:1,ghost:null,thumbWidth:11,cssBkBW:1,dndNode:null,synchronizeSlider:function I(){var x=this.orCfg,w=x.lenCssP,p=this[w],n=parseInt(p,10),AD=this.hasRendered,AB=this.titleHeight||0;var q=this._effLen=isNaN(n)?0:(n-this._exRoom-AB);if(p){var AC={};AC[w]=Math.max(parseInt(p,10)-(2*this.cssBkBW),0)-AB+e;var t={};t[w]=q+e;t[x.posCssP]=Math.round(this._exRoom/2)+e;t[x.opPosCssP]="0"+e;if(AD){R.copy(AC,this.bgNode.style);R.copy(t,this.sdcNode.style);}else{this.bkCssText=C.getCssTextFromObj(AC);this.sdcCssText=C.getCssTextFromObj(t);}}var AF=this.selectedIndices;if(!R.isEmpty(AF)){var AA=this.items.length,u=-1,AE=-1,z;for(z=0;z<AA;z++){if(AF[z]){if(u<0){u=z;}AE=z;}else{if(u>-1){break;}}}this.min=u;this.max=AE;}var o=this.typeHelper;this.unit=o.getUnit();if(AD){o.updateThumb();}else{o.preUpdateThumb();}},preBuildRendering:function A(){this.synchronizeSlider();},postBuildRendering:function U(){this._super();if(this.items.length>1){var n=this.dnd=new mstrmojo.DnDComponent({target:this});var o=this.id;this.__mouseDownEvt=function(p){Q.stopPropogation(window,p);f.call(K[o].dnd,p);return true;};Q.attachEvent(this.dndNode,"mousedown",this.__mouseDownEvt);if(Q.supportsTouches){this.__touchstartEvt=function(p){Q.stopPropogation(window,p);G.call(K[o].dnd,p);return true;};Q.attachEvent(this.dndNode,"touchstart",this.__touchstartEvt);}n.afterDragStart=this.initDrag;n.duringDrag=this.ondrag;n.afterDragEnd=this.ondrop;n.afterDragCancel=this.cancelDrag;}},initDrag:function k(u,n){n=n||window;var t=this.configureGhost(true),o=this.orCfg,q=this.dnd,p=q.startE;q.initD={tP:parseInt(this.start,10),sL:this._effLen,contL:t.containerNode[o.lenP],offset:Q.getMousePosition(p,n)[o.offsetP],td:Q.eventTarget(n,p)};},configureGhost:function b(o){var q=this.ghost;if(!q){var u=this.containerNode.cloneNode(true),t=u.childNodes;C.addClass(u,"gh");u.style.display="none";q=this.ghost={containerNode:u,frontNode:t[0],thumbNode:t[1],endNode:t[2]};this.sdcNode.appendChild(u);}var p=this.ghost.containerNode.style,n=this.orCfg;R.copyProps([n.posCssP,n.lenCssP],this.containerNode.style,p);if(o){p.display="block";}return q;},ondrag:function O(z,x){x=x||window;var AA=this.dnd.initD,t=this.ghost.containerNode,AE,p,n,w=this.min,AB=this.max,u=this.orCfg,o=u.lenCssP,AD=u.posCssP;var AC=Q.getMousePosition(z,x)[u.offsetP]-AA.offset;switch(AA.td){case this.thumbNode:AE=Math.max(Math.min(AA.tP+AC,AA.sL-AA.contL),0);p=AE+AA.contL;t.style[AD]=AE+e;var q=this.typeHelper.calcMinMax(AE,p);w=q.min;AB=q.max;break;case this.frontNode:AE=Math.max(Math.min(AA.tP+AC,AA.tP+AA.contL),0);n=Math.max(Math.min(AA.contL-AC,AA.tP+AA.contL),0);t.style[AD]=AE+e;t.style[o]=n+e;w=Math.min(Math.floor(AE/this.unit+0.5),this.max);break;case this.endNode:n=Math.max(Math.min(AA.contL+AC,AA.sL-AA.tP),0);p=AA.tP+n;t.style[o]=n+e;AB=Math.max(Math.floor(p/this.unit-0.5),this.min);break;default:return ;}if(w!==this.min||AB!==this.max){this.min=w;this.max=AB;this.typeHelper.updateThumb();}this._updateTooltip();},ondrop:function Y(){this.typeHelper.updateThumb();var t=this.ghost;if(t){t.containerNode.style.display="none";}this.hideTooltip();var u=this.dnd&&this.dnd.initD;if(this.makeSelection&&u){this.makeSelection({selItem:u.td});}var n=this.items;if(n&&n.length){var p=[],o;for(o=this.min;o<=this.max;o++){var q=n[o];if(q){p.push(o);}}this.select(p);}this.dnd.initD=null;},cancelDrag:function M(o,n){if(this.makeSelection){this.makeSelection({selItem:Q.eventTarget(n||window,this.dnd.startE)});}},showTooltip:function m(o,n){this.configureGhost(false);this._updateTooltip(o,n);this._super(o,n);},hideTooltip:function P(o,n){if(this.dnd&&this.dnd.dragging){return ;}this._super(o,n);},_updateTooltip:function S(){var x=this.orCfg,z={contentNodeCssClass:"sc-tooltip",refNode:this.domNode,posType:this._tooltip_pos},o=(this.ghost)?this.ghost.containerNode:this.containerNode;z[x.opPosCssP]=0;z[x.posCssP]=o.style[x.posCssP];z.content="";var u=this.items,q=u.length;if(u&&q){var n=(u[this.min]||u[0]),p=this.getItemTooltip(n),t=p;if(this.min!==this.max){var w=(u[this.max]||u[q-1]);t=mstrmojo.desc(146,"From:")+" '"+p+"' "+mstrmojo.desc(2665,"To:")+" '"+this.getItemTooltip(w)+"'";}z.content=F.replace(/\{@content\}/g,t);}this.set("richTooltip",z);},getItemTooltip:function X(n){var o=n?n.n:"";return"'"+(o.length>20?o.slice(0,20)+"...":o)+"'";},unrender:function B(o){this.ghost=null;this.hideTooltip();this.min=0;this.max=(this.items&&this.items.length-1)||0;var p=this.dndNode,q=this.__mouseDownEvt,n=this.__touchstartEvt;if(q&&p){Q.detachEvent(p,"mousedown",q);}if(n&&p){Q.detachEvent(p,"touchstart",n);}W.call(this);this._super(o);},onselectionChange:function L(){var n=this.selectedIndices,o=R.isEmpty(n);if(n){this.set("max",o?this.items.length-1:R.max(n,false,true));this.set("min",o?0:R.min(n,false,true));if(this.typeHelper){this.typeHelper.updateThumb();}}if(this.onchange){this.onchange();}}});mstrmojo.Slider.SINGLE_HANDLE_WIDTH=11;mstrmojo.Slider.SCROLLHANDLEWIDTH=11;}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Box","mstrmojo._HasTooltip");var D=mstrmojo.dom;mstrmojo.ui.LabelWithIconTooltip=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasTooltip],{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",markupString:'<div id="{@id}" class="mstrmojo-IconLabel {@cssClass}" style="{@cssText}" ttp="{@tooltip}"><span class="mstrmojo-Label" style="">{@text}</span><span class="{@iconCss}" style=""></span></div>',markupSlots:{labelNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.lastChild;}},text:"",iconCss:"",tooltip:"",useRichTooltip:true,shouldShowTooltip:function B(F,H){var G=F.target||D.eventTarget(F.hWin,F.e);return G===this.iconNode;},getTooltipContent:function A(F){var G=F.target||D.eventTarget(F.hWin,F.e);return this.tooltip||G.getAttribute("ttp");},updateTooltipConfig:function C(G){var H=G.target||D.eventTarget(G.hWin,G.e),F=D.position(H);if(!this.richTooltip){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.getTooltipContent(G),top:F.y+F.h,left:F.x+10,cssClass:"vi-regular vi-tooltip-D no-arrow",};}},showTooltip:function E(F,G){if(this.shouldShowTooltip(F,G)){this._super(F,G);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.ME.Enum");mstrmojo.requiresDescs();var M=mstrmojo.dom,B=mstrmojo.string,D=mstrmojo.Widget;var H=/\r?\n?----\r?\n?/;function F(N){var O=B.decodeHtmlString((N||{}).desc||"",true).split(H);return{desc:O[0],example:O.length===2?O[1]:""};}mstrmojo.ME.FunctionInfo=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionInfo",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="mstrmojo-FunctionInfo-container"><div class="mstrmojo-FunctionInfo-syntax"></div><div class="mstrmojo-FunctionInfo-desc"></div><div class="mstrmojo-FunctionInfo-eg"><span class="icon" t="icon"></span><span class="text"></span></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},syntaxNode:function(){return this.domNode.firstChild.firstChild;},descNode:function(){return this.domNode.firstChild.childNodes[1];},egNode:function(){return this.domNode.firstChild.lastChild;},egTextNode:function(){return this.domNode.firstChild.lastChild.lastChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onfoiChange:function(){this.syntaxNode.innerHTML=B.htmlAngles(this.syntax)||"";this.descNode.innerHTML=this.desc;this.egTextNode.innerHTML=this.example;this.egNode.style.display=this.example?"block":"none";this.updateScrollbars();}},foi:{},syntax:"",desc:"",example:"",init:function L(N){this._super(N);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-FunctionInfo");},setupScrollNodes:function C(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},onfoiChange:function A(){this.set("syntax",this.getFunctionSyntax());this.set("desc",this.getDesc()+" "+this.getHelpTopic());this.set("example",this.getExample());},getFunctionSyntax:function K(R){var U=R||this.foi;if(!U){return"";}if(U.did<0){return U.n;}var Q=U.pars,S=U.pros,O=[],P,N;O.push(U.n);S=mstrmojo.hash.clone(S)||[];if(U.ios){S.push({n:"SortBy"});}if(U.sqt===5){S.push({n:"BreakBy"});}if(this.showFullSyntax){if(S.length>0){O.push("<");for(P=0,N=S.length;P<N;P++){if(mstrmojo.array.indexOf(mstrmojo.ME.Enum.NonExposableParams,S[P].n)===-1){O.push(S[P].n);O.push(", ");}}O.pop();O.push(">");}}O.push("(");for(P=0,N=Q.length;P<N;P++){O.push(Q[P].n);if(P!==(N-1)){O.push(", ");}}O.push(")");return O.join("");},getDesc:function E(){return F(this.foi).desc;},getExample:function J(){return F(this.foi).example;},getHelpTopic:function G(N){var O=N||this.foi;if(!O||O.did===mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(O.h);},useRichTooltip:true,showTooltip:function I(N,Q){var P=M.eventTarget(Q,N),O=this.foi;if(P&&P.getAttribute("t")==="icon"){this.richTooltip=this.getTooltip(O,P);if(this.richTooltip){this._super(N,Q);}}},getTooltip:function(Q,R){var O=M.position(R),P=R.egTip||"";var N={areaId:Q._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:P,top:O.y-75,left:O.x+O.w-30,enableHover:false};return N;}});mstrmojo.ME.FunctionInfo.getDescAndExample=F;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.css","mstrmojo.Button");mstrmojo.requiresDescs(1143,8338,9111,9113);var M=mstrmojo.css,G=mstrmojo.dom,I=mstrmojo.array,F="mstrmojo-qb-toolbarIcon",N="on",J="connectionview",C="viewtable",B="conditionview",L="refreshOption",O="help",E=" ";function K(R){return mstrmojo.hash.copy(R,{scriptClass:"mstrmojo.Button",onactiveChange:function Q(){M.toggleClass(this.domNode,N,this.active);},onclick:function P(){this.set("active",!this.active);if(this.cmd){mstrApp.getRootController()[this.cmd](this.active);}if(!this.persistSelection){var S=this;window.setTimeout(function(){S.set("active",false);},100);}}});}function A(R){var Q="mstr-qb-oAuthSourcelogout",P=document.getElementById(Q);if(!P){P=document.createElement("IFRAME");P.id=Q;document.body.appendChild(P);P.style.display="none";G.attachEvent(P,"load",function(S){var V={};var W={success:function U(X){mstrApp.getRootController().handleLogout();}};V.dbRoleID=mstrApp.dbrid;if(mstrApp.said){V.sourceAccountID=mstrApp.said;}mstrApp.getRootController().getDataService().signOutOAuthSource(W,V);});}P.src=R;}function D(){var R={scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-toolbar-bigquery",bindings:{visible:function(){return mstrApp.said&&mstrApp.dbrid;}},children:[{scriptClass:"mstrmojo.Label",postCreate:function Q(){if(this._super){this._super();}var S=mstrApp.userName;if(mstrApp.userEmail){S+=" ("+mstrApp.userEmail+")";}this.set("text",S);this.set("title",S);},cssClass:"mstrmojo-qb-toolbar-bigquery-username"},{scriptClass:"mstrmojo.Label",text:"|",cssClass:"splitText"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8338,"sign out"),cssClass:"mstrmojo-qb-toolbar-bigquery-signout",onclick:function P(){A("https://www.google.com/accounts/logout");}}]};return R;}function H(){var Q=[{cmd:"toggleDatabaseView",active:true,iconClass:[F,J,N].join(E),title:mstrmojo.desc(9111,"Database View"),persistSelection:true},{cmd:"toggleDataPreview",active:false,iconClass:[F,C].join(E),title:mstrmojo.desc(9113,"Data Preview"),persistSelection:true,postBuildRendering:function P(){var R=mstrApp.getRootController(),S=this.id;R.attachEventListener("dataPreview",S,function(){this.set("active",true);});R.attachEventListener("reportModeChange",S,function(U){this.set("active",U.showPreview);});}},{cmd:"openHelp",iconClass:[F,O].join(E),title:mstrmojo.desc(1143,"help")}];I.forEach(Q,function(S,R,U){U[R]=K(S);});Q.push(D());return Q;}mstrmojo.qb.Toolbar=mstrmojo.declare(mstrmojo.Box,null,{children:H()});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.css");var B=mstrmojo.css;mstrmojo.ui.ColumnContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnContainer {@cssClass}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},scrollNode:function(){return this.domNode.firstChild;}},markupMethods:{onnextChange:function A(){B.toggleClass(this.domNode,"hasNext",!!this.next);}},active:false,next:null,idx:undefined,updateColumnContainer:function D(){var E=this.next;if(E){E.updateColumnContainer();}},onactiveChange:function C(){B.toggleClass(this.domNode,"active",this.active);var E=this.next;if(E){E.updateColumnContainer();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.dom","mstrmojo.string","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(5,49,2918,15446,14825,9948,14825,13305,13306,13307,15474);var D=mstrmojo.array,E=mstrmojo.dom,F=mstrmojo.string;function C(){var G=[],H=mstrApp.diParams,J=(E.isIE8||E.isIE7)&&!(H.flashVI||H.smartVI),I=mstrmojo.DI.DIExitOptions.pageRedirect;if(H.CreateAnalysis===1){G.push({hot:true,icon:"newvi",n:mstrmojo.desc(14825,"Create Dossier"),desc:mstrmojo.desc(9948,"Explore data visually and discover trends, patterns, relationships and outliers"),redirect:J?I.unsupportedBrowser:I.analysis});}if(H.CreateReportServices===1){G.push({icon:"newdoc",n:mstrmojo.desc(2918,"Create Document"),desc:mstrmojo.desc(15503,"Create an enterprise report, scorecard, or dossier"),redirect:I.doc});}if(H.CreateViewReport===1&&mstrApp.getRootController().model.isDirectDataAccess===false){G.push({icon:"newreport",n:mstrmojo.desc(5,"Create Report"),desc:mstrmojo.desc(13859,"Create a grid or graph report"),redirect:I.report});}return G;}mstrmojo.DI.DIExitOptions=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIExitOptions",cssClass:"mstrmojo-di-DIExitOptions",redirectToPage:function B(G){var H=mstrmojo.DI.DIExitOptions;if(G===H.pageRedirect.unsupportedBrowser){mstrmojo.alert(mstrmojo.desc(15474,"Please upgrade your browser or turn off Internet Explorer Compatibility View to work with HTML5 dossiers."));}else{mstrApp.redirectToPage(H.getRedirectParams(G,this.model.cubeID,this.model.isDirectDataAccess));}},onCancelButtonClick:function(){mstrApp.getRootController().exitApplication();return true;},preBuildRendering:function(){var I=[],H,J,G=["mstrmojo-di-button","mstrmojo-WebButton"];if(this._super){this._super();}H=C();G.push("cnt"+H.length);D.forEach(H,function(L,K){J=new mstrmojo.Button({cssClass:K===0?G.concat(["hot",L.icon]).join(" "):G.concat(L.icon).join(" "),text:L.n,useRichTooltip:true,updateTooltipConfig:function(){var N=this,M=E.position(N.domNode);N.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:L.desc,top:Math.max(M.y+40,0),left:Math.max(M.x+M.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},redirect:L.redirect,onclick:function(){this.parent.redirectToPage(this.redirect);}});I.push(J);});this.addChildren(I);},children:[{scriptClass:"mstrmojo.Label",cssClass:"title-icon",text:" "},{scriptClass:"mstrmojo.Label",cssClass:"title-one",useRichTooltip:true,allowHTML:true,updateTooltipConfig:function(){var G;if(this.isOverflow&&this.title){G=E.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(G.y,0),left:Math.max(G.x+G.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}},ontextChange:function(){var H=this;var G=function(){var P=H.parent.model.isDirectDataAccess?mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###."):mstrmojo.desc(13305,"Success! Your data was imported as ###."),L=H.domNode,R=H.parent.model.path,K=H.parent.model.cubeName,Q,N,O,M,J;if(!L){return ;}Q=L.scrollWidth>L.clientWidth;N=R;M=J=R.indexOf(K);while(Q&&(M>=0||J<=R.length)){if(M>0){M--;}else{J++;}O=M>0?[R.substr(0,M)]:[];O.push("...");if(J<R.length){O.push(R.substr(J));}N=P.replace("###","<b>"+F.encodeHtmlString(O.join(""),true,true)+"</b>");L.innerHTML=N;Q=L.scrollWidth>L.clientWidth;}};var I=function(){var P=H.parent.model.isDirectDataAccess?mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###."):mstrmojo.desc(13305,"Success! Your data was imported as ###."),L=H.domNode,R=H.parent.model.path,K=H.parent.model.cubeName,Q,N,O,M,J;if(!L){return ;}Q=L.scrollHeight>L.clientHeight;N=R;tail=R.length;H.set("isOverflow",Q);while(Q&&(tail>0)){tail--;O=tail>0?[R.substr(0,tail)]:[];O.push("..");N=P.replace("###","<b>"+F.encodeHtmlString(O.join(""),true,true)+"</b>");L.innerHTML=N;Q=L.scrollHeight>L.clientHeight;}};if(H.domNode){I();}else{window.setTimeout(I,0);}},preBuildRendering:function(){var H=mstrmojo.desc(13305,"Success! Your data was imported as ###."),G;if(this.parent.model.isDirectDataAccess){H=mstrmojo.desc(13306,"Success! Your live connection dataset has been saved as ###.");}G=H.replace("###","<b>"+F.encodeHtmlString(this.parent.model.path,true,true)+"</b>");this.set("text",G);this.set("title",G);}},{scriptClass:"mstrmojo.Label",cssClass:"title-two",text:mstrmojo.desc(13307,"What would you like to do now?")}]});mstrmojo.DI.DIExitOptions.pageRedirect={exit:0,report:1,doc:2,analysis:3,flashVI:4,historyList:5,existingAnalysis:6,unsupportedBrowser:7};mstrmojo.DI.DIExitOptions.getRedirectParams=function A(M,J,I,H){var L={},K=mstrmojo.DI.DIExitOptions.pageRedirect,G=mstrApp.name||microstrategy.servletName;switch(M){case K.analysis:if(mstrApp.diParams.flashVI){L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:"16",rwViewMode:"2048"};}else{L={evt:"3185",src:mstrApp.name+".3185",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:64};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}}break;case K.doc:L={evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:J,rwCreateFlags:0};if(I){L.rwCreateFlags|=128;}if(mstrApp.cubeSaveFolderId){L.saveFolderId=mstrApp.cubeSaveFolderId;}break;case K.flashVI:L={evt:"3104",src:G+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:J,rwCreateFlags:16,rwViewMode:"2048"};if(I){L.rwCreateFlags|=128;}break;case K.report:L={iframe:"true",evt:["5005","17004"],src:[mstrApp.name+".create.5005",mstrApp.name+".create.ObjectExplorer.17004"],selectedObjectID:J,defaultevtlist:"17004"};break;case K.exit:L={evt:"3010"};break;case K.historyList:L={evt:"3018",src:G+".3018"};break;case K.existingAnalysis:L={evt:"3140",src:G+".3140",documentID:H};break;}return L;};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasLayout");mstrmojo.ui.LayoutBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.LayoutBox",layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.mdx.CubeList");mstrmojo.requiresDescs(12931,14545);var B="addCube";mstrmojo.qb.mdx.CubeDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-MDXCubeDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint">{@emptyHint}</div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function G(){return this.domNode.firstChild.firstChild;},containerNode:function C(){return this.domNode.firstChild.lastChild;},panelNode:function N(){return this.domNode.firstChild;},outerContainerNode:function A(){return this.domNode;}},emptyHint:mstrmojo.desc(13246,"Drag and Drop table(s) from any database connections"),children:[{scriptClass:"mstrmojo.qb.mdx.CubeList"},{scriptClass:"mstrmojo.CheckBox",slot:"outerContainerNode",label:mstrmojo.desc(14545,"Import as Recursive Attribute"),alias:"recursive",oncheckedChange:function D(){mstrApp.getRootController().setRecursive(this.checked?1:0);},postCreate:function J(){if(this._super){this._super();}var Q=this,P={},O=P[this.id]={};O.recursiveChange=function(R){Q.set("checked",R.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(P);this.enabled=!mstrApp.tableID;}}],init:function M(P){this._super(P);var Q={},O=Q[this.id]={};O.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(Q);},onTableRefresh:function L(O){var P=O.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],P);mstrmojo.css.toggleClass(this.panelNode,["active"],P);},dropZone:true,allowDrop:function F(O){return B===O.action;},ondrop:function I(O){var P=O.action,R=O.src,Q;if(R&&R.data){Q=R.data;if(P===B){mstrApp.getRootController().addCubes([Q]);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function E(){return"enabled";},ondragenter:function H(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function K(O){var P=O.src.widget;if(P&&P.toggleAvatarClass&&this.allowDrop(O)){P.toggleAvatarClass(this.getAvatarIconClass(O),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box");var B=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox",cssClass:"mstrmojo-wh-DBRoleSettingGroupBox",groupbox:undefined,isRequired:false,isGroupSetting:true,enabled:true,onenabledChange:function E(){var F=this.enabled;B.forEach(this.children,function(G){G.set("enabled",F);});},getValue:function A(){return"";},setValue:function D(F){},isValid:function C(){return{val:true,msg:""};},children:[{scriptClass:"mstrmojo.Box",alias:"groupbox",children:[]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.es.TableList","mstrmojo.Label");mstrmojo.requiresDescs(12930,2121,14909);var K="addTable",H=mstrmojo.array,L=mstrmojo.string,C=mstrmojo.hash;mstrmojo.qb.es.TableDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.es.TableDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-EmmaTableDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint"><div class="mstrmojo-qb-emma-EmptyHint-text">{@emptyHint}</div></div><div class="mstrmojo-qb-emma-TableCount"></div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function G(){return this.domNode.firstChild.firstChild;},countNode:function F(){return this.domNode.firstChild.children[1];},containerNode:function B(){return this.domNode.firstChild.lastChild;},panelNode:function Q(){return this.domNode.firstChild;}},emptyHint:mstrmojo.desc(14909,"Drag and Drop to Add Tables"),children:[{scriptClass:"mstrmojo.Label",alias:"tableCount",slot:"countNode",visible:false,postCreate:function M(){if(this._super){this._super();}var U={},S=U[this.id]={},R=mstrmojo.desc(2121,"Total");S.refreshTables=function(V){var W=V.items.length;this.set("visible",W>1);if(W>1){this.set("text",R+": "+W);}};mstrApp.getRootController().attachDataChangeListeners(U);}},{scriptClass:"mstrmojo.qb.es.TableList",alias:"tableList"}],init:function P(S){this._super(S);var U={},R=U[this.id]={};R.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(U);},onTableRefresh:function O(R){var S=R.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],S);mstrmojo.css.toggleClass(this.panelNode,["active"],S);this.panelNode.scrollTop=this.panelNode.scrollHeight;},dropZone:true,allowDrop:function E(R){return K===R.action;},ondrop:function J(R){var S=R.action,V=R.src;if(V&&V.data){var U=V.data;H.forEach(U,function(X,W){if(X.n){X.n=L.decodeHtmlString(X.n.replace(/<strong>|<\/strong>/gi,""));X.decoded=true;}});if(S===K){mstrApp.getRootController().addTable(U);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function D(){return"enabled";},ondragenter:function I(R){var S=R.src.widget;if(S&&S.toggleAvatarClass&&this.allowDrop(R)){S.toggleAvatarClass(this.getAvatarIconClass(R),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function N(R){var S=R.src.widget;if(S&&S.toggleAvatarClass&&this.allowDrop(R)){S.toggleAvatarClass(this.getAvatarIconClass(R),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");},onwidthChange:function A(R){var S=parseInt(R.value,10);if(isNaN(S)){return ;}S=S-140;S=(S<=0)?"20px":S+"px";this.tableList.set("itemMaxWidth",S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.css","mstrmojo.ui._HasScroller");var A=mstrmojo.css;mstrmojo.DI.ui.ScrollableBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DI.ui.ScrollableBox",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',hasCustomScrollbar:true,getHeight:null,setupScrollNodes:function(){this.scrollNode=this.containerNode;},disableScroll:function(B,E){var D=this.scrollNode,C=(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));if(D){if(E||E===undefined){D.style.overflowY="hidden";A.toggleClass(D,"hasVertical",false);A.toggleClass(C,"hasVertical",false);}else{if(D.style.overflowY==="hidden"){D.style.overflowY="auto";}}if(B||B===undefined){A.toggleClass(D,"hasHorizontal",false);A.toggleClass(C,"hasHorizontal",false);D.style.overflowX="hidden";}}},});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(13227,15134);var E=mstrmojo.dom,A=mstrmojo.css,C=mstrmojo.DI.DIConstants,D=mstrmojo.DI.DIHelpers,F=mstrmojo.DI.DIHelpers.detectCustomImg;mstrmojo.DI.DISourceItemAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DISourceItemAdmin",icon:"",n:"",desc:"",mode:"add",tooltipOpenDelay:0,useRichTooltip:true,markupString:'<div id="{@id}" class="mstrmojo-di-source-item mstrmojo-di-source-item-admin {@icon} {@mode}" mstrAttach:click><div class="mstrmojo-di-source-name"><span class="mstrmojo-di-source-name-span">{@en@n}</span></div><div class="mstrmojo-di-source-below"><div class="mstrmojo-di-Icons medium-{@icon}"></div><div class="mstrmojo-di-source-desc">{@desc}</div><div class="mstrmojo-di-source-cover {@mode}"><div class="mstrmojo-di-source-cover-img {@mode}" /></div></div></div>',markupSlots:{nameNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.children[1].children[0];},descNode:function(){return this.domNode.children[1].children[1];},coverNode:function(){return this.domNode.children[1].children[2];}},postBuildRendering:function B(){if(this._super){this._super();}if(this.iconData&&mstrmojo.string.startsWith(this.iconData,"data:image")){this.iconNode.innerHTML='<img src="'+this.iconData+'" style="width:80px;height:80px;"/>';}else{if(!this.customizeIcon&&!this.icon&&!mstrmojo.string.startsWith(this.iconData,"data:image")&&!D.isOriginalConnector(this.oid)){mstrmojo.css.addClass(this.iconNode,"medium-defaultconnector");}else{if(this.customizeIcon){if(!C.sourceIconClsName[this.itemId]){F(this.originalName?this.originalName:this.n,this.iconNode);}}else{if(D.isOriginalConnector(this.oid)&&this.oid===C.originalConnector.elastic){mstrmojo.css.addClass(this.iconNode,"medium-Elastic_Connector");}else{if(D.isOriginalConnector(this.oid)&&this.oid===C.originalConnector.tapClicks){mstrmojo.css.addClass(this.iconNode,"medium-TapClicks_Connector");}}}}}if(this.showOAuthLink&&D.getEnvObj().isWS()){E.attachEvent(this.iconNode,"mouseover",this.onOauthButtonMouseOver);E.attachEvent(this.iconNode,"mouseleave",this.onOauthButtonMouseLeave);A.addClass(this.iconNode,"set-oauth-source");this.iconNode.innerHTML='<div class="oauth-link hide"><span>'+mstrmojo.desc(15134,"Set OAuth")+"</span></div>";E.attachEvent(this.iconNode.firstChild,"click",this.onOauthButtonClick.bind(this));}this.set("enabled",true);if(!this.enabled){mstrmojo.css.addClass(this.domNode,"disabled");}else{mstrmojo.css.addClass(this.domNode,"enabled");}},onOauthButtonMouseOver:function(){A.removeClass(this.firstChild,"hide");},onOauthButtonMouseLeave:function(){A.addClass(this.firstChild,"hide");},onOauthButtonClick:function(J){var G=mstrApp.getRootController().model;var I=G.externalSources[this.sourceInfo.type];var H=this;mstrApp.getRootController().openOAuthParaDialog(J,{sourceName:I.name,did:I.dbRoleID,isOneTier:!!mstrApp.isSingleTier,sourceItem:H});},onmodeChange:function(G){var I=G.valueWas,H=G.value;if(this.hasRendered){A.toggleClass(this.domNode,I,false);A.toggleClass(this.coverNode,I,false);A.toggleClass(this.domNode,H,true);A.toggleClass(this.coverNode,H,true);}},onclick:function(G){var H=G.getTarget(),I=this.mode;if(I==="add"&&E.contains(this.coverNode,H)){this.raiseEvent({name:"selectChange",type:"add"});}else{if(I==="remove"&&H===this.coverNode.children[0]){this.raiseEvent({name:"selectChange",type:"remove"});}}},updateTooltipConfig:function(){var G=E.position(this.domNode);if(this.title){this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-V",top:Math.max(G.y,0),left:Math.max(G.x+G.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css");var A=mstrmojo.css;var I=mstrmojo.dom;function B(K){var M=document.createElement("div"),L=M.style,J=K.domNode;M.className="mstrmojo-qb-VSplitPanel-avatar";L.width=J.clientWidth+"px";J.appendChild(M);K.avatar=M;return M;}mstrmojo.qb.VSplitPanel=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.VSplitPanel",draggable:true,dropZone:false,width:0,topP:40,topItemVisible:true,bottomItemVisible:true,borderoffset:0,marginSpan:20,minSpan:80,markupString:'<div id="{@id}" class="mstrmojo-VSplitPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseup,mousemove ><div></div><div style="padding-top:{@marginSpan}px;"><div class="mstrmojo-qb-VSplitPanel-resizeHandle" style="width:{@width};height:{@marginSpan}px;margin-top:-{@marginSpan}px"></div></div></div>',markupSlots:{topItem:function(){return this.domNode.children[0];},bottomItem:function(){return this.domNode.children[1];}},children:[{scripClass:"mstrmojo.Box",slot:"topItem"},{scripClass:"mstrmojo.Box",slot:"bottomItem"}],getDragData:function H(J){var K=J.src,M=K.node;if(M.className&&M.className.indexOf("mstrmojo-qb-VSplitPanel-resizeHandle")>=0){var L=I.position(this.domNode);return{node:M,x:L.x,y:L.y,h:L.h,w:L.w};}else{if(this._super){return this.dropZone&&this._super(J);}}return null;},allowDrop:function E(J){var K=J.src,L=K&&K.data;if(L&&L.node){return true;}else{return this.dropZone;}},ondragmove:function F(J){var L=J.src,N=L&&L.data;if(N&&N.node){var K=J.tgt,M=this.avatar;if(M){M.style.top=Math.min(Math.max(N.y+this.minSpan,K.pos.y),N.y+N.h-this.minSpan)+"px";}}},isDragValid:function G(J){var K=J.src,L=K&&K.data;return !!(L&&L.node);},ondragstart:function C(J){var K=J.src,M=K&&K.data;var L=this.avatar||B(this);this.ownAvatar=true;L.style.top=Math.max(M.y,K.pos.y)+"px";L.style.left=M.x+"px";L.style.display="block";L.style.zIndex="9999";L.style.width=M.w+"px";},ondragend:function D(J){var M=J.src,O=M&&M.data;if(O&&O.node){var N=this.avatar;if(N){N.style.display="none";var K=parseInt(N.style.top)-O.y,L=this.domNode.clientHeight;this.topP=K*100/L;this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};this.doLayout();}this.ownAvatar=false;}else{if(this._super){this._super(J);}}},layoutConfig:{w:{topItem:"100%",bottomItem:"100%"},h:{topItem:"40%",bottomItem:"60%"}},afterLayout:function(){if(this.domNode){var K=this.domNode.children[1].children[0].style;if(this.topItemVisible&&this.bottomItemVisible){K.display="block";this.children[0].set("visible",true);this.children[1].set("visible",true);K.width=this.width;var J=parseInt(this.children[0].height);this.children[0].set("height",J+"px");this.bottomItem.style.height=parseInt(this.height)-J-this.marginSpan+"px";this.children[1].set("height",this.bottomItem.style.height);}else{K.display="none";if(this.topItemVisible){this.children[0].set("width",this.width);this.children[1].set("visible",false);}else{this.children[1].set("width",this.width);this.children[0].set("visible",false);}}}},_set_topItemVisible:function(L,J){if(this.topItemVisible!=J){this.topItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};if(this.bottomItem){var K=this.bottomItem;K.style["padding-top"]=this.marginSpan+"px";}}else{this.layoutConfig.h={topItem:"0%",bottomItem:"100%"};if(this.bottomItem){var K=this.bottomItem.parentNode;K.style["padding-top"]="0px";}}this.doLayout();}},_set_bottomItemVisible:function(K,J){if(this.bottomItemVisible!=J){this.bottomItemVisible=J;if(J){this.layoutConfig.h={topItem:this.topP+"%",bottomItem:100-this.topP+"%"};}else{this.layoutConfig.h={topItem:"100%",bottomItem:"0%"};}this.doLayout();}},postBuildRendering:function(){if(this._super){this._super();}this.width=this.domNode.clientWidth+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._ListSelections");mstrmojo.ListBoxHoriz=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBoxHoriz",cssClass:"mstrmojo-ListBoxHoriz",tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"",cellCssText:"",cellSpacing:0,cellPadding:0,_markupPrefix:function(){var A=this.itemRenderer;return(A&&A.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="'+this.cellSpacing+'" cellpadding="'+this.cellPadding+'"><tbody><tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'">');},_markupSuffix:function(){var A=this.itemRenderer;return(A&&A.markupSuffix)||"</tr></tbody></table>";},_itemPrefix:function(){var A=this.itemRenderer;return(A&&A.itemPrefix)||('<td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var A=this.itemRenderer;return(A&&A.itemSuffix)||"</td>";},_getItemNode:function(A){if(A<0){return null;}var B=this.itemsNode,C=B&&B.rows[0];return C&&C.cells[A].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBoxBase","mstrmojo._HasScrollbox");mstrmojo.ListBox=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ListBox",renderAllItems:false,renderPause:10,numPagesRendered:0,pageStatus:null,_rc:null,_totalPages:null,_rh:null,_rhMin:8,_rowsPerPage:null,_defaultRowsPerPage:100,_minRowsPerPage:100,_pageHeight:null,buildRendering:function K(){if(this.renderAllItems===true){this._super();return true;}this._initPageSettings();var L=this.items;this.items=this._rc?this.items.slice(0,Math.min(this._rowsPerPage,this._rc)):[];this._super();this.items=L;this.postRenderPage(0,true);if(this._rc>this._rowsPerPage){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]=(this._rh*this._rc)+"px";if(!this.connectedScrollbox){this.connectScrollbox(this);this.connectedScrollbox=true;}}else{this.postRenderingCleanup();}},_initPageSettings:function E(){var L=this.items;this._rc=(L&&L.length)||0;var N=this.itemRenderer;this._rh=(N&&N.rowHeight)||this._rhMin||3;var M=this._defaultRowsPerPage;if(!isNaN(this.scrollboxHeight)){M=Math.ceil(this.scrollboxHeight/this._rh);M=Math.max(M,this._minRowsPerPage);}this._rowsPerPage=M;this._totalPages=Math.ceil(this._rc/this._rowsPerPage);this._pageHeight=this._rh*this._rowsPerPage;this._pageStatus=new Array(this._totalPages);this._numPagesRendered=0;},onscroll:function J(){if(!this._renderingRows){this._startPageRenderThread();}},_startPageRenderThread:function F(){this.renderingRows=true;var M=this,L=this._renderTimer=self.setInterval(function(){if(!M){self.clearInterval(L);return ;}var N=M.getPagesToRender();if(N.length>0){M.renderPages(N);}else{M.renderingRows=false;self.clearInterval(M._renderTimer);delete M._renderTimer;if(M.isRenderingComplete()){M.postRenderingCleanup();}M=null;}},this.renderPause);},getPagesToRender:function I(){var P=[],a=this._pageHeight,c=null,X=this._pageStatus,Z=this;function R(d){var e=X[d];if(e&&e.filled){if(!e.height){if(!c){c=Z.itemsNode.tBodies;}e.height=c[d].offsetHeight;}return e.height;}else{return a;}}var b=0,S=null,O=null,M=this.scrollboxTop;for(var W=0,Y=this._totalPages;W<Y;W++){b+=R(W);if(b>=M){S=W;break;}}if(S==null){S=O=Y-1;}else{var L=this.scrollboxBottom;for(var U=S+1;U<Y;U++){if(b>=L){O=U-1;break;}b+=R(U);}}if(O==null){O=Y-1;}for(var N=this._numPagesRendered;N<S;++N){P.push({idx:N,fill:false});}for(var Q=S;Q<=O;++Q){var V=X[Q];if(!V||!V.filled){P.push({idx:Q,fill:true});}}return P;},renderPages:function D(M){for(var N=0,L=M.length;N<L;++N){this.renderPage(M[N].idx,M[N].fill);}},renderPage:function B(R,M){var W=this._pageStatus,P=(this._numPagesRendered>=R+1);if(P){if(!M||(W[R]&&W[R].filled)){return ;}}var V=this._rowsPerPage,L=R*V,N=Math.min(L+V,this._rc)-1;var U=this.tempTableCont;if(!U){U=this.tempTableCont=this.domNode.ownerDocument.createElement("div");}var Q=M?this._buildItemsMarkup(L,N,'<table><tbody idx="'+R+'">',"</tbody></table>",this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join(""):'<table><tbody idx="'+R+'"><tr><td style="height:'+this._pageHeight+'px">&nbsp;</td></tr></tbody></table>';U.innerHTML=Q;var O=U.firstChild.tBodies[0],S=this.itemsNode;if(!P){S.appendChild(O);}else{S.replaceChild(O,S.tBodies[R]);}this.postRenderPage(R,M);},postRenderPage:function G(M,O){if(M+1>this._numPagesRendered){this._numPagesRendered=M+1;}var L=this._pageStatus,N=L[M];if(!N){N=L[M]={};}if(O){N.filled=true;}if(M>0&&M==this._totalPages-1){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]="";}},isRenderingComplete:function C(){if(this._numPagesRendered==this._totalPages){for(var L=this._pageStatus,M=this._totalPages-1;M>-1;M--){if(!L[M]||!L[M].filled){return false;}}return true;}return false;},postRenderingCleanup:function A(){if(this.connectedScrollbox){this.disconnectScrollbox(this);this.connectedScrollbox=false;}},unrender:function(L){this.postRenderingCleanup();this._super(L);},refresh:function H(){if(!this.hasRendered){return ;}var N=this.domNode,L=N&&N.parentNode;if(!this.parent&&L){var M=N.ownerDocument.createElement("span");L.insertBefore(M,N);}this.unrender();if(!this.parent&&L){this.domNode=M;}this.render();if(this.defn&&this.defn.set){this.defn.set("readyState",mstrmojo.EnumReadystate.IDLE);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableRows","mstrmojo._IsMovable","mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");mstrmojo.requiresDescs(12912,12913,12914,12915);var D=mstrmojo.css,J=mstrmojo.dom,S=mstrmojo.hash,e=Math.max,H=Math.min,f="px",I=mstrmojo.desc(12915,"No columns."),k="dragging",Z=320,P=150,a,M=mstrmojo.qb.EnumDataChangeEvents,Y=10;function Q(){if(this.domNode){var o=this.domNode.style,p=this.tableData;o.left=this.left||p.x;o.top=this.top||p.y;}}function g(o,q){var t=this.rows,p=this.domNode;if(o===undefined||q===undefined){this.maxHeight=e(p.clientHeight,this._ttlHeight);this.height=H(this.maxHeight,Z);this.width=e(p.clientWidth,P);}else{this.height=e(H(o,this.maxHeight),this._ttlHeight);this.width=e(q,P);}t.set("height",e(this.height-this._ttlHeight-this._rowHeight,0)+f);t.set("width",this.width+f);}mstrmojo.qb.DBTableView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsMovable,mstrmojo._HasOwnAvatar,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.DBTableView",markupString:'<div id="{@id}" class="mstrmojo-qb-TableView {@cssClass}"><div class="mstrmojo-qb-tv-header item"><span class="mstrmojo-qb-tv-ttl" mstrAttach:dblclick,click>{@title}</span><span class="item-mn" mstrAttach:click></span></div><div class="mstrmojo-qb-tv-rsz"></div></div>',markupSlots:{headerNode:function j(){return this.domNode.firstChild;},titleNode:function V(){return this.domNode.firstChild.firstChild;},containerNode:function W(){return this.domNode;},menuNode:function n(){return this.domNode.firstChild.lastChild;},resizeHandle:function h(){return this.domNode.children[1];}},init:function l(o){this._super(o);},rows:undefined,preBuildRendering:function A(){this._super();this.title=this.tableData.n;var o=this.tableData.items;if(!o||o.length===0){o=this.tableData.items=[{n:I,tp:"none"}];}this.rows.items=o;},postBuildRendering:function O(){this._super();Q.call(this);this._ttlHeight=this.headerNode.clientHeight;this._rowHeight=this.dummyrow.domNode.clientHeight;g.call(this);this.domNode.style.zIndex=Y++;},getTableID:function C(){return this.tableData.id;},onclick:function c(o){if(o.getTarget()===o.src.titleNode){if(mstrApp.getRootController().selectSourceTable){mstrApp.getRootController().selectSourceTable(this.tableData.id);}return ;}mstrApp.getRootController().removeTable(this.tableData);},ondblclick:function L(){var p=this.title,o=this.headerNode.clientWidth-15;this.openPopup("inlineTextRef",{left:"2px",top:(J.isIE?0:1)+"px",txtConfig:{cssClass:"mstrmojo-qb-tablealias-edit",width:o+"px",value:mstrmojo.string.decodeHtmlString(p)||"",onEnter:function(){this.parent.close({enter:true});}}});this.isEditing=true;},ontableDataChange:function F(){var o=this.rows;o.height=o.width=undefined;this.refresh();},isItemAvailable:function R(o){return(this.getTableID()===o);},handleEvent:function N(o){var p=(o.item&&o.item.id)||o.id;if(this.getTableID()===p){switch(o.name){case M.RENAME:this.titleNode.innerHTML=this.title=o.value;return true;case M.TABLE_CHANGED:this.set("tableData",o.item);return true;}}else{return this.rows.handleEvent(o);}return false;},getMovingHandle:function m(){return(this.isEditing?null:this.headerNode);},draggable:true,createAvatar:function X(o){var q=document.createElement("div");if(o!==this.resizeHandle){var p=J.findAncestorByAttr(o,"idx",true,this.domNode);if(p&&p.node){q.appendChild(p.node.cloneNode(true));}q.className=this.domNode.className+" "+this.rows.domNode.className;}return q;},isDragValid:function U(o){return o.src.node===this.resizeHandle||this._super(o);},ondragstart:function d(o){this._super(o);D.toggleClass(this.domNode,[k],true);this._rszCfg={h:this.height,w:this.width};},ondragmove:function G(q){if(this._rszCfg){var o=q.src.pos,t=q.tgt.pos,p=this._rszCfg;g.call(this,p.h+t.y-o.y,p.w+t.x-o.x);}else{this._super(q);}this.linker.drawLinks();},ondragend:function E(o){this._super(o);var p=this.domNode,q=p.style.zIndex;D.toggleClass(p,[k],false);if(parseInt(q,10)<(Y-1)){p.style.zIndex=Y++;}delete this._rszCfg;},getDragAction:function K(o){var p=J.findAncestorByAttr(o.src.node,"idx",true,this.domNode);if(p){return mstrmojo.qb.EnumDragActions.JOIN_COLUMN;}},getDragData:function b(p){var q=J.findAncestorByAttr(p.src.node,"idx",true,this.domNode);if(q){var o=this.rows.getRowItem(q.value);return S.copy(o,{columnId:o.did,tableName:this.tableData.did,tableId:this.tableData.id});}},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"headerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onEsc:function(){this.parent.close({cancel:true});}}],onOpen:function(){var o=this.txt;S.forEach(this.txtConfig,function(p,q){o.set(q,p);});o.domNode.style.width=o.width;o.focus();},onClose:function(){this.parent.isEditing=false;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div class="item st"><span class="item-ic"></span><span class="item-n">*</span><span class="item-add" mstrAttach:click></span></div>',onclick:function c(){try{var p=this.parent;mstrApp.getRootController().addSelectedColumns(p.tableData.items);}catch(o){throw o;}},alias:"dummyrow"},{scriptClass:"mstrmojo.qb.DBTableRows",alias:"rows"}]});a=mstrmojo.qb.DBTableView;a.showPopupMenu=function B(o,p){var q=a.tableCtxMenu;q.target=o;q.data=p.data;q.domNode=p.menuNode;q.showContextMenu();};}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var C=function(S,V,U){var R=S.parent.opener,J=R&&R.showDesc,Q=R&&R.showPath,I=V[S.itemField];var P=mstrmojo.string.escape4HTMLText,W="";if(Q){var M=V.anc&&V.anc.items,O=M&&M.length;if(O>0){for(var L=0;L<O-1;L++){W+=M[L].n+" > ";}W+=P(M[O-1].n);}else{if(V.path){W+=P(V.path);}}}if(!U){W+=(W.length===0?"":" > ")+P(I);}if(J){var N=V[S.itemDescField],K=120;if(N){W+="\r\n\r\n<br>"+P(N.substring(0,K)+(N.length>K?"...":""));}}return W;};var A=function(I,J,K){I.path=null;if(!J||!K||K.path){if(K&&K.path){I.set("path",K.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var L=J.path||J.getAttribute("path");if(L){I.set("path",K.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(M){var N=H(M.toString())||"";K.path=N;I.set("path",N);}},{taskId:"getObjectDetails",objectID:K.did,objectType:K.t},undefined);},200);};var H=function(K){var N;if(window.DOMParser){N=(new DOMParser()).parseFromString(K,"text/xml");}else{N=new ActiveXObject("Microsoft.XMLDOM");N.async="false";N.loadXML(K);}var P=N.getElementsByTagName("path")[0],L=P.childNodes,O="";if(L){for(var J=0,I=L.length;J<I;J++){var M=L[J].childNodes&&L[J].childNodes[0];if(M){O+=mstrmojo.string.escape4HTMLText(M.nodeValue)+(J<I-1?"> ":"");}}}return O;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(K,I){var J=this.parent.opener,L=this.useRichTooltip?"":this.buildTooltip(K);return'<div class="mstrmojo-suggest-text '+((J&&J.item2textCss(K))||"")+'" idx="'+I+'" title="'+L+'">'+J.getHighlightedText(J.getSearchPattern(),mstrmojo.string.escape4HTMLText(K[this.itemField]))+"</div>";},getItemProps:function E(){return{};},onmouseover:function(J){var M=this.parent.opener;if(M&&M.showPath){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),I=K.getAttribute("idx"),L=I!=null?this.items[I]:null;if(L&&L.t>-1){this.targetEl=K;this.targetItem=L;this.requestPath(K,L);}}},requestPath:function D(I,K){var J=this.parent.opener;if(K.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&J.showFunctionSyntaxAsPath){this.buildFunctionSyntax(K);}else{A(this,I,K);}},buildFunctionSyntax:function G(J){var K=J.path;if(!K&&J.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var I=function I(P){if(P.did<0){return P.n;}var O=P.pars,M=[],N,L;M.push(P.n);if(O){M.push("(");for(N=0,L=O.length;N<L;N++){M.push(O[N].n);if(N!==(L-1)){M.push(", ");}}M.push(")");}return M.join("");};J.path=I(J);}this.set("path",{path:J.path,excludeSelf:true});},buildTooltip:function B(I,J){return C(this,I,J);},onpathChange:function F(){var I=this.targetEl;I.path=1;var J=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!I.ttp){I.ttp=J;this.showTooltip();}}else{I.title=J;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.css");var G=mstrmojo.css;var D;mstrmojo.ui.CheckList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.CheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function J(){return this.domNode.firstChild.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onorientationChange:function M(){G.toggleClass(this.domNode,"horizontal",this.orientation!=="v");},onmultiSelectChange:function K(){G.toggleClass(this.domNode,"radio",!this.multiSelect);},onenabledChange:function I(){G.toggleClass(this.domNode,"disabled",!this.enabled);},onhideCheckMarkChange:function B(){G.toggleClass(this.domNode,"hideCheckMark",this.hideCheckMark);}},multiSelect:true,hideCheckMark:false,orientation:"v",minimumSelectCnt:0,icnCss:"icn",items:null,getItemMarkup:function L(N){if(!D){D=this._super(N).replace(">{@en@n}<",'title="{@tt}"><span class="text">{@en@n}</span><');}return D;},getItemProps:function H(Q,O){var P=this._super(Q,O),N={"\r\n":" ","\n":" ","\r":" "};var R=Q.css;if(R){P.addCls(R);}P.tt=Q.tt||"";Q.n=mstrmojo.string.multiReplace(Q.n,N);P.n=Q.n||"";return P;},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},preselectionChange:function C(O){var P=this.minimumSelectCnt,N=this.getSelectedItems().length,Q=O.removed;if(Q&&P){if(N<P){this.select(Q,true);return false;}}G.toggleClass(this.itemsContainerNode,"disableSelected",N<=P);return true;},buildRendering:function F(){this._super();G.toggleClass(this.itemsContainerNode,"disableSelected",this.getSelectedItems().length<=this.minimumSelectCnt);}});mstrmojo.ui.CheckList.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller");mstrmojo.ui.ScrollableList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function C(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function E(){return this.domNode.firstChild;}},postBuildRendering:function B(){if(this.renderOnScroll){if(!this.onScrollEnd){var G=this.id;this.onScrollEnd=function F(){var H=mstrmojo.all[G];H.doScroll();H.updateScrollbars();};}}if(this._super){this._super();}},renderBlockSize:150,renderIndex:0,onScrollEnd:undefined,doScroll:function A(){if(this.renderOnScroll){var G,H=this.scrollNode,F=(this.renderIndex+1)*this.renderBlockSize;if(F>=this.items.length){return ;}if(mstrmojo.dom.position(H).h===H.scrollHeight){G=this.domNode;}else{G=H;}if((mstrmojo.dom.position(G).h+G.scrollTop)>=G.scrollHeight){this.renderIndex++;var I=this._buildItemsMarkup(this.renderIndex*this.renderBlockSize,((this.renderIndex+1)*this.renderBlockSize)-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");G.innerHTML+=I;this.itemsContainerNode.innerHTML+=I;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui._HasListTooltip");mstrmojo.ui.PopupList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PopupList",autoCloses:true,locksHover:true,closeOnClick:true,scrollNodeMaxHeight:undefined,parentDomNode:undefined,keydownString:null,lastKeydownTime:null,keydownInterval:500,closeAfterSelection:true,markupString:'<div id="{@id}" class="mstrmojo-PopupList {@cssClass}" style="{@cssText}" tabIndex="-1" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu,keydown><div class="mstrmojo-popupList-scrollBar"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function I(){return this.domNode.firstChild.firstChild;},scrollboxNode:function A(){return this.domNode.firstChild;}},setupScrollNodes:function F(){this.scrollNode=this.scrollboxNode;},onOpen:function E(){this._super();this.updateScrollbars();var M=this;setTimeout(function(){M.scrollToSelectedItem();},10);},onclick:function K(M){this.closeAfterSelection=true;this._super(M);},postBuildRendering:function B(){var N=this._super();if(!this.parent){var M=this.parentDomNode=this.parentDomNode||document.body;M.appendChild(this.domNode);}return N;},closePopup:function J(){this.set("visible",false);},onkeydown:function H(O){if(!this.opener||!this.opener.focusOnPopup){return ;}var M=O.hWin,R=O.e||M.event,U=this.keydownString;this.locksHover=false;this.closeAfterSelection=false;if(R.keyCode===mstrmojo.Enum_Keys.DOWN_ARROW){if(this.selectedIndex<this.items.length-1){this.set("selectedIndex",this.selectedIndex+1);this.scrollToSelectedItem();}}else{if(R.keyCode===mstrmojo.Enum_Keys.UP_ARROW){if(this.selectedIndex>0){this.set("selectedIndex",this.selectedIndex-1);this.scrollToSelectedItem();}}else{if(R.keyCode===mstrmojo.Enum_Keys.ENTER||R.keyCode===mstrmojo.Enum_Keys.ESCAPE){this.closeAfterSelection=true;this.singleSelect(this.selectedIndex);}else{var S=new Date(),P=S.getTime(),N=String.fromCharCode(R.keyCode).toLowerCase(),Q=this;if(this.lastKeydownTime===null){this.keydownString=N;}else{if(P-this.lastKeydownTime<this.keydownInterval){this.keydownString=this.keydownString+N;}else{this.keydownString=N;}}U=this.keydownString;if(this._holdTimer){clearTimeout(this._holdTimer);}this._holdTimer=setTimeout(function(){Q.changeSelectedItem(O);Q.adjustPosition();},Q.keydownInterval);this.lastKeydownTime=P;}}}},changeSelectedItem:function D(M){var P=this.selectedIndex,O=this.items&&this.items.length;if(O>0){var N;for(N=this.selectedIndex+1;N<this.items.length;N++){if(this.items[N].n.toLowerCase().indexOf(this.keydownString)==0){P=N;break;}}if(P===this.selectedIndex){for(N=0;N<this.selectedIndex;N++){if(this.items[N].n.toLowerCase().indexOf(this.keydownString)==0){P=N;break;}}}if(P!==this.selectedIndex){this.set("selectedIndex",P);}}},focus:function L(){this.domNode.focus();},scrollToSelectedItem:function G(){var P=this.itemsContainerNode.childNodes[this.selectedIndex];if(P){var M=this.scrollNode,O=M.clientHeight,N=P.offsetTop;if(N-M.scrollTop+P.offsetHeight>O){M.scrollTop=P.offsetTop+P.offsetHeight-O;}else{if(N<M.scrollTop){M.scrollTop-=P.offsetHeight;}}}},adjustPosition:function C(){this.adjustCornersForPopupOverflow();this.scrollToSelectedItem();this.focus();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.css","mstrmojo.ui._HasListTooltip");var E=mstrmojo.css;var C;mstrmojo.ui.IconTooltipCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.IconTooltipCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu,mouseover><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function F(){return this.domNode.firstChild.firstChild;}},getItemMarkup:function I(L){if(!C){var K='><span class="text">{@en@n}</span> <span class="{@iconCss}" ttp="{@ttp}"></span><';C=this._super(L).replace(">{@en@n}<",K);}return C;},markupslots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function F(){return this.domNode.firstChild.firstChild;}},getItemProps:function G(N,L){var M=this._super(N,L),K={"\r\n":" ","\n":" ","\r":" "};if(N.css){M.addCls(N.css);}M.ttp=N.ttp||"";M.iconCss=N.iconCss||"";N.n=mstrmojo.string.multiReplace(N.n,K);M.n=N.n||"";return M;},postBuildRendering:function B(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-D",refNode:this.itemsContainerNode,posType:mstrmojo.tooltip.POS_TOPRIGHT,keepArrowXPos:false});},useRichTooltip:true,tooltipOffset:0,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipOrientation:"horizontal",tooltipCss:{leftCssClass:"no-arrow",rightCssClass:"no-arrow"},showTooltip:function H(L,N){var M=this,K=mstrmojo.dom.position(L.target);M.richTooltip.top=Math.max(K.y+K.h);M.richTooltip.left=Math.max(K.x+4,0);this._super(L,N);},getTooltipText:function D(K){return K.ttp;},onmouseover:function J(K){var O=this.id,L=mstrmojo.all[O],N=K.getTarget(),M=N.getAttribute("ttp");if(!M){return ;}L.richTooltip.content=M;L.showTooltip(K.e,self);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.ui._IsHierarchyList","mstrmojo.css","mstrmojo.array","mstrmojo.EnumSelectionType");var S=mstrmojo.css,K=mstrmojo.array,A=mstrmojo.EnumSelectionType;var V="hidden",Q="selected",R="expanded",F="collapsed",I="hierarchy",M="hasChildren";var P="u;",Z=10;mstrmojo.ui.HierarchyCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._IsHierarchyList],{scriptClass:"mstrmojo.ui.HierarchyCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="header"></div><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div><div class="footer"></div></div>',markupSlots:{headerNode:function E(){return this.domNode.firstChild;},footerNode:function C(){return this.domNode.lastChild;},scrollboxNode:function H(){return this.domNode.children[1];},itemsContainerNode:function U(){return this.domNode.children[1].firstChild;}},getItemMarkup:function D(b,a){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="triangle"></span><span class="checkbox"></span><span class="text">{@en@n}</span></{@tag}>';},getItemProps:function X(c,a){var b=this._super(c,a);if(c.isSelected){b.addCls(Q);}if(this.isHiearachyDisplay()){if(c.hcd){b.addCls(c.epd?R:F);}}return b;},setupScrollNodes:function J(){this.scrollNode=this.scrollboxNode;var a=this.domNode.clientHeight-this.headerNode.clientHeight-this.footerNode.clientHeight;if(a>0){this.scrollNode.style.height=a+"px";}},onclick:function Y(a){var c=a.getTarget(),d=this.getItemNodeFromTarget(c),b=this.getItemFromTarget(c);if(b){if(S.hasClass(c,"triangle")){if(b.hcd){this.doExpandCollapse(d,b);}}else{if(!S.hasClass(c,"indent")){this.doBranchSelect(d,b,!b.isSelected);}}a.cancel();}},doElementSelect:function W(c,b,a){b.isSelected=a;this.onSelectionChange(A.ELEMENT,a,b);this.updateItemNodesStatus();},doBranchSelect:function O(d,b,a){var c=function(e){e.isSelected=a;e.isBranchSelected=a;(e.children||[]).forEach(function(f){c(f);});};c(b);this.onSelectionChange(A.BRANCH,a,b);this.updateItemNodesStatus();},doLevelSelect:function G(b,a){this.getItems().forEach(function(c){if(c.lv===b){c.isSelected=a;}});this.onSelectionChange(A.LEVEL,a,null,b);this.updateItemNodesStatus();},doBranchLevelSelect:function B(e,b,d,a){var c=function(f){if(f.lv===d){f.isSelected=a;}else{if(f.lv<d){(f.children||[]).forEach(function(g){c(g);});}}};c(b);this.onSelectionChange(A.BRANCH_LEVEL,a,b,d);this.updateItemNodesStatus();},doAllSelect:function L(a){this.getItems().forEach(function(b){b.isSelected=b.isBranchSelected=a;});this.onSelectionChange(A.ALL,a);this.updateItemNodesStatus();},updateItemNodesStatus:function N(){var a=this.itemsContainerNode&&this.itemsContainerNode.childNodes;K.forEach(a,function(c){var b=this.getItemFromTarget(c);if(b){S.toggleClass(c,Q,b.isSelected);}},this);},onSelectionChange:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.ui.CheckList","mstrmojo.css");var B=mstrmojo.css;var A;mstrmojo.ui.CheckListWithDesc=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.CheckListWithDesc",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckListWithDesc {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function G(){return this.domNode.firstChild;},itemsContainerNode:function D(){return this.domNode.firstChild.firstChild;}},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},getItemMarkup:function F(H){if(!A){A=this._super(H).replace(">{@en@n}<",'title="{@tt}"><span class="text-title">{@en@n}</span><span class="text-desc">{@en@desc}</span><');}return A;},getItemProps:function C(K,I){var J=this._super(K,I),H={"\r\n":" ","\n":" ","\r":" "};var L=K.css;if(L){J.addCls(L);}J.tt=K.tt||"";K.n=mstrmojo.string.multiReplace(K.n,H);J.n=K.n||"";J.desc=K.desc||"";return J;},});mstrmojo.ui.CheckListWithDesc.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.CheckList","mstrmojo.ImageCheckBox");mstrmojo.requiresDescs(12388);var F=mstrmojo.array,E=mstrmojo.desc;mstrmojo.DI.DIPartition=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPartition",markupString:'<div id="{@id}" class="mstrmojo-di-partition {@cssClass}" style="{@cssText}"><div class="mstrmojo-di-partition-content"></div><div class="mstrmojo-di-partition-notice"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild;},noticeNode:function(){return this.domNode.lastChild;}},tables:null,sourceId:null,init:function D(I){this._super(I);var K=this.data,J=K&&K.id,G=K&&K.partition;var H=mstrApp.getRootController().getModel();this.isRefined=H.importSources[J].sourceInfo.isRefined;this.sourceId=J;this.tables=mstrApp.getRootController().partitionController.getAllPartitionTables(J,G);F.forEach(this.tables,function(L){L.selected=L.isMember;});if(this.isRefined){F.forEach(this.tables,function(L){L.title="Cannot change partition group after wrangling.";});}this.ontablesChange();},ontablesChange:function C(){var H=this.tables,G=H&&H.length>0;if(G){this.content.set("items",H);}this.content.set("visible",G);this.notice.set("visible",!G);},_close:function(){var G=this.parent;if(G&&G._cmSource){G._cmSource.closeMenuTree();}},onOK:function A(){var H=this.content.items,I=[],G=[],J;J=this.content.getSelectedItems();F.forEach(H,function(K){K.selected=(F.indexOf(J,K)!==-1);});F.forEach(H,function(K){if(K.isMember&&!K.selected){G.push(K.ptIndex.toString());}else{if(!K.isMember&&K.selected){I.push(K.sourceId);}}});if(I.length>0||G.length>0){mstrApp.getRootController().partitionController.changePartition(this.sourceId,I,G);}this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"content",slot:"contentNode",onRender:function B(){var G=this.items,H=[];F.forEach(G,function(I){if(I.selected){H.push(I);}});if(H.length){this.setSelectedItems(H,true);}if(this.parent.isRefined){this.set("enabled",false);}}},{scriptClass:"mstrmojo.Label",alias:"notice",slot:"noticeNode",text:E(12388,"No tables found with the same set of attributes and metrics.")}]});}());(function(){mstrmojo.requiresCls("mstrmojo.LegacySuggestionList","mstrmojo.ui._HasScroller");var E=mstrmojo.dom;mstrmojo.ui.ScrollableSuggestionList=mstrmojo.declare(mstrmojo.LegacySuggestionList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-scrollable-suggestlist {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function B(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function H(){return this.domNode.firstChild;}},onclick:function A(I){var J=this.getItemFromTarget(I.getTarget());if(J){this._super(I);}},onitemsChange:function C(){var I=this;window.setTimeout(function(){I.hideTooltip();I.updateScrollbars();},0);},updateScrollbars:function F(){this._super();var K=this,M=K.scrollNode,I=M.clientWidth,L=K.itemsContainerNode,J=L.clientWidth;L.style.width="auto";window.setTimeout(function(){if(I>J){L.style.width=J+(I-J)+"px";}},10);},useRichTooltip:true,getItemTooltip:function(L,M){var J=E.position(M),K=M.ttp;var I={areaId:L._renderIdx+"text",cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:K,top:J.y,left:J.x+J.w+6,enableHover:false};return I;},showTooltip:function G(I,L){var K=this.targetEl,J=this.targetItem;if(K&&K.ttp){this.richTooltip=this.getItemTooltip(J,K);if(this.richTooltip){this._super(I,L);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableView","mstrmojo.qb.EnumDataChangeEvents","mstrmojo.qb.EnumDragActions","mstrmojo.qb.EnumMenuActions","mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var I=mstrmojo.dom,E=mstrmojo.hash,K=mstrmojo.array,B="px",P=mstrmojo.qb.EnumDataChangeEvents,F=P.REMOVE,N=mstrmojo.qb.EnumDragActions.ADD_TABLE;function L(Q){var S=Q.item,R=Q.did||S.id,U=Q.name;K.forEach(this.children,function(V){if(V.isItemAvailable(R)){var W=V.handleEvent(Q);if(!W){switch(U){case F:this.removeTable(V.tableData);break;}}}},this);}mstrmojo.qb.TableContainer=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.TableContainer",markupString:'<div id="{@id}" class="mstrmojo-qb-TableContainer {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-tc-container"></div></div>',markupSlots:{containerNode:function D(){return this.domNode.lastChild;}},init:function O(R){this._super(R);var S={},Q=S[this.id]={};Q[P.TABLES_ADDED]=function U(V){K.forEach(V.tableItems,function(W){this[((V.toAdd?"add":"remove")+"Table")](W);},this);};Q[P.TABLE_CHANGED]=Q[P.RENAME]=Q[F]=L;},addTable:function C(V){var S=this,R=this.children,U=V.id;K.forEach(R,function(W){if(W.isItemAvailable(U)){this.removeTable(V);}},this);if((V.x===undefined)||(V.y===undefined)){var Q=25*(R?R.length:0)+B;V=E.copy({x:Q,y:Q},V);}S.addChildren([new mstrmojo.qb.DBTableView({tableData:V,left:V.x,top:V.y,linker:this.parent.linker})]);},removeTable:function H(S){var Q=this,R=S.id;K.forEach(this.children,function(V,U){if(V.getTableID()===R){Q.removeChildren(Q.children[U]);mstrApp.getRootController().removeFromCurrentLayer(V.tableData);return false;}return true;});},updateTablePositionCache:function A(){var S=this.children,Q=I.position(this.domNode),R=[];K.forEach(S,function(U){var V=I.position(U.domNode);R.push(E.copy({x:((V.x-Q.x)+B),y:((V.y-Q.y)+B),h:V.h+B,w:V.w+B},U.tableData));});mstrApp.getRootController().setTablePositions(R);},refresh:function J(Q){if(Q){this.updateTablePositionCache();}this.removeChildren();K.forEach(mstrApp.getRootController().getTablePositions(),function(R){this.addTable(R);},this);},dropZone:true,allowDrop:function G(Q){return N.indexOf(Q.action)!==-1;},ondrop:function M(R){var U=R.action,W=R.src;if(W&&W.data){var V=W.data;if(U===N){var S=R.tgt.pos,Q=mstrmojo.dom.position(R.tgt.node);V.x=S.x-Q.x+B;V.y=S.y-Q.y+B;mstrApp.getRootController().addWHTable([V],true);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.ListBoxHoriz","mstrmojo.string");var B=mstrmojo.string;var A={render:function(G,C,H){var I=(H.htmlName+C),E=H.selectedIndices[C]?"checked ":"",F=E?" selected":"",D=G.v!=="u;"?" nAll":"";return'<div class="'+H.itemCssClass+F+D+'"><input type="'+H.inputType+'" name="'+H.htmlName+'" id="'+I+'" value="'+C+'" '+E+'/><label for="'+I+'" title="'+B.encodeHtmlString(G[H.itemTitleField]||"")+'" style="'+H.labelCssText+'">'+B.encodeHtmlString(G[H.itemDisplayField||"n"])+"</label></div>";},select:function(D){var C=D&&D.firstChild;if(C){if(!C.checked){C.checked=true;}mstrmojo.css.toggleClass(D,"selected",C.checked);}},unselect:function(D){var C=D&&D.firstChild;if(C){if(C.checked){C.checked=false;}mstrmojo.css.toggleClass(D,"selected",C.checked);}},rowHeight:23};mstrmojo._RendersInputItems=mstrmojo.provide("mstrmojo._RendersInputItems",{inputType:null,htmlName:null,itemRenderer:A,init:function(C){this._super(C);if(!this.htmlName){this.htmlName=this.id;}},preclick:function(F){var E=F.hWin,H=F.e,G=mstrmojo.dom.eventTarget(E,H);if(G&&G.nodeName.match(/input/i)){var D=parseInt(G.value,10);if(this.inputType&&this.inputType.match(/radio/i)){this.singleSelect(D);}else{var C=(G.checked)?"add":"remove";this[C+"Select"](D);}}}});mstrmojo._InputList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputList"});mstrmojo._InputListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputListHoriz"});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.ListBoxBase");mstrmojo.ButtonItemRenderer=mstrmojo.hash.copy(mstrmojo.DivItemRenderer);mstrmojo.ButtonItemRenderer.render=function(D,A,E){var B=D.v!=="u;"?" nAll":"",C=(E.enabled===false);return'<input mstridx="'+A+'" class="'+E.itemCssClass+(E.selectedIndices[A]?" "+E.itemSelectedCssClass:"")+" "+(D.css||"")+B+'" style="'+E.itemCssText+'" type="button"  value="'+D[E.itemDisplayField]+'" '+(C?"disabled ":"")+"/>";};mstrmojo._RendersItemButtons=mstrmojo.hash.copy(mstrmojo._RendersItemDivs);mstrmojo._RendersItemButtons.itemRenderer=mstrmojo.ButtonItemRenderer;mstrmojo.ButtonList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersItemButtons],{scriptClass:"mstrmojo.ButtonList",cssClass:"mstrmojo-ButtonList",itemCssClass:"mstrmojo-ButtonItem",selectionPolicy:"toggle"});mstrmojo.requiresCls("mstrmojo.ListBoxHoriz");mstrmojo.ButtonListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersItemButtons],{scriptClass:"mstrmojo.ButtonListHoriz",cssClass:"mstrmojo-ButtonListHoriz",itemCssClass:"mstrmojo-ButtonItem",selectionPolicy:"toggle"});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItem","mstrmojo.DI.DISourceItemAdmin","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.hash","mstrmojo.array");var S=mstrmojo.DI.DIConstants,B="mstrmojo.DI.DISourceItem",I=mstrmojo.DI.DIConstants.pageType,F=mstrmojo.DI.DIConstants.sourceType,D=mstrmojo.desc(13227,"Set OAuth Parameters"),H=S.sourceItemLinkType&&S.sourceItemLinkType.oauthPara,J=mstrmojo.DI.DIDatabaseHelper,N=mstrmojo.DI.DIHelpers,P=mstrmojo.array,L=mstrmojo.hash,K=mstrmojo.warehouse.EnumDatabaseType,Q=S.sourceItemType,R=[3100,700,4100,7300,6800,6400,8100],O=L.invert(S.Enum_SourceCategoryType);mstrmojo.requiresDescs(1563,3958,6277,9214,10171,10174,11108,11109,12712,13223,13411,13412,13413,13414,13415,13416,13417,13421,13422,13423,13424,13425,13426,12442,12444,12448,12449,12450,12455,12456,12460,12461,12462,12491,12463,12498,12542,12712,12713,12733,12751,12752,12755,12757,12758,12986,12988,13224,13225,13226,13418,13419,13420,13532,13533,13978,13993,14031,14188,14189,14190,14191,14461,14616,14617,14618,14767,14768,14769,14770,14771,14772,14773,14774,14775,14790,14794,14807,14808,12444,14894,14895,14904,14912,14913,15061,15063,15354,15367);var G=[{n:mstrmojo.desc(12455,"Add Custom Data"),initial:"A",pageType:I.clipboard,sourceInfo:0,subtype:S.sourceSubtype.clipboard,oneTier:true,privilege:S.privilegeType.accessFile,title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},{n:mstrmojo.desc(12752,"BI Sources"),initial:"B",pageType:I.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:F.bisource,name:"BI Sources",type:S.xdaType.dataImportBISource,subtype:S.sourceSubtype.bisource},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13533,"Cognos"),initial:"C",pageType:I.database,dbObjectsDisplayOptions:8,tags:["BI"],sourceInfo:{sourceType:F.bisource,name:"BI Sources",type:S.xdaType.dataImportBISource,subtype:S.sourceSubtype.bisource},oneTier:true,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13223,"Cognos TM1"),initial:"C",pageType:I.database,dbType:2900,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.mdx,subtype:S.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !(mstrApp.isSingleTier||N.isServerBasedWS());},oneTier:false,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(12713,"Clipboard"),initial:"C",sourceInfo:0,pageType:I.clipboard,subtype:S.sourceSubtype.clipboard,oneTier:true,privilege:S.privilegeType.accessFile,title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},{n:mstrmojo.desc(14768,"CSV from Disk"),initial:"C",pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(14769,"CSV From URL"),initial:"C",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(11109,"Dropbox"),initial:"D",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"0",name:"Dropbox",url:"Dropbox.com",type:F.dropbox,subtype:S.sourceSubtype.dropbox},tags:["File","Cloud"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessFile,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(14770,"Excel from Disk"),initial:"E",pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(14771,"Excel From URL"),initial:"E",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(10171,"Facebook"),initial:"F",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{name:"Facebook",url:"facebook.com",type:F.facebook,subtype:S.sourceSubtype.facebook},tags:["Social","Cloud"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12442,"File From Disk"),initial:"F",pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(12444,"File from URL"),initial:"D",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(14794,"OData"),initial:"O",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:[],oneTier:true,checkConectivity:true,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(12448,"Google Analytics"),initial:"G",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"3",name:"Google Analytics",type:F.googleAnalytics,subtype:S.sourceSubtype.googleAnalytics},tags:["Cloud"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12542,"Google Big Query"),initial:"G",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"2",name:"Google BigQuery",url:"Google.com/bigquery/",type:F.googleBigQuery,subtype:S.sourceSubtype.googleBigQuery},tags:["Database","Cloud","BigData"],oneTier:true,privilege:S.privilegeType.accessDatabase,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(11108,"Google Drive"),initial:"G",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"3",name:"Google Drive",url:"Google.com/drive/",type:F.googleDrive,subtype:S.sourceSubtype.googleDrive},tags:["File","Cloud","SaaS"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessFile,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier)?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(12755,"Hadoop File Browser"),initial:"H",pageType:I.hadoop,sourceInfo:1,subtype:S.sourceSubtype.hadoop,tags:["Database","BigData","Hadoop","File"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13224,"Hyperion Essbase"),initial:"H",pageType:I.database,dbType:1600,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.mdx,subtype:S.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !(mstrApp.isSingleTier||N.isServerBasedWS());},oneTier:false,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(14772,"JSON from Disk"),initial:"J",pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(14773,"JSON From URL"),initial:"J",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(13225,"Microsoft Analysis Server"),initial:"M",pageType:I.database,dbType:1500,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.mdx,subtype:S.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){return !(mstrApp.isSingleTier||N.isServerBasedWS());},oneTier:false,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(12733,"Network Browser"),initial:"N",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:true,mode:1,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},{n:mstrmojo.desc(13532,"OBIEE"),initial:"O",pageType:I.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:F.bisource,name:"BI Sources",type:S.xdaType.dataImportBISource,subtype:S.sourceSubtype.bisource},tags:["BI"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13978,"Public Data"),initial:"P",bindings:{enabled:function(){return mstrApp.diParams.EnableURLImport&&mstrApp.diParams.EnableHttpImport;},title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},sourceInfo:1,subtype:S.sourceSubtype.publicData,pageType:I.publicData,oneTier:true,checkConectivity:false,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(12712,"Sample Files"),initial:"S",pageType:I.sampleFiles,sourceInfo:1,subtype:S.sourceSubtype.samplefile,tags:["File"],oneTier:true,checkConectivity:false,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},{n:mstrmojo.desc(12757,"SalesForce Reports"),initial:"S",pageType:I.sourceIntro,dbType:300,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"4",name:"Salesforce",url:"Salesforce.com",type:F.salesforce,subtype:S.sourceSubtype.salesforce},tags:["Cloud","SaaS"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier||!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(14190,"SAP Business Object"),initial:"S",pageType:I.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:F.bisource,name:"BI Sources",type:S.xdaType.dataImportBISource,subtype:S.sourceSubtype.bisource},tags:["BI"],oneTier:true,privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},{n:mstrmojo.desc(13226,"SAP Business Warehouse"),initial:"S",pageType:I.database,dbType:1200,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.mdx,subtype:S.sourceSubtype.mdx},tags:["MDX","OLAP","Cube"],isEnabled:function(){if(mstrApp.showDDAOptions===false){return false;}return !(mstrApp.isSingleTier||N.isServerBasedWS());},oneTier:false,privilege:S.privilegeType.accessDatabase,title:function(){var U="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return U;}},{n:mstrmojo.desc(14807,"SAS from Disk"),initial:"S",pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(14808,"SAS From URL"),initial:"S",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(12986,"Search as a Source"),initial:"S",pageType:I.database,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12988,"Select a table"),type:S.xdaType.qbSingleTable,subtype:S.sourceSubtype.searchOnSource,extParams:{subtype:S.sourceSubtype.searchOnSource}},oneTier:false,tags:["Search"],isEnabled:function(){return !(mstrApp.isSingleTier||!N.isServerBasedWS());},privilege:S.privilegeType.accessDatabase,title:function(){var U="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return U;}},{n:mstrmojo.desc(14774,"Text from Disk"),initial:"T",pageType:F.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,tags:["File"],oneTier:true,privilege:S.privilegeType.accessFile},{n:mstrmojo.desc(14775,"Text From URL"),initial:"T",pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,tags:["File"],oneTier:true,checkConectivity:false,mode:0,isEnabled:function(){return mstrApp.diParams.EnableURLImport;},privilege:S.privilegeType.accessFile,title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},{n:mstrmojo.desc(10174,"Twitter"),initial:"T",pageType:I.sourceIntro,isEnabled:function(){return(document.location.protocol.indexOf("https")!==-1)||mstrApp.isSingleTier||N.isServerBasedWS();},sourceInfo:{id:"5",name:"Twitter",url:"twitter.com",type:F.twitter,subtype:S.sourceSubtype.twitter},tags:["Social","Cloud"],oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";}},{n:mstrmojo.desc(6277,"Web Services"),initial:"W",bindings:{enabled:function(){return mstrApp.diParams.ImportDatabase!==0;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},pageType:I.database,dbIdExcludeFilter:[41],dbObjectsDisplayOptions:1,sourceInfo:{name:"Database",sourceType:F.querybuilder,type:S.xdaType.ffsql},tags:["Database","Cloud"],oneTier:true,privilege:S.privilegeType.accessDatabase,waitDbTypes:true},{n:mstrmojo.desc(15061,"Add a New Connector"),initial:"A",pageType:I.addConnectorList,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:F.newConnector,name:"New Connector",type:500,subtype:S.sourceSubtype.bisource},oneTier:true,checkConectivity:true,bindings:{enabled:function(){return N.isLocalWS()?true:!N.isOnetier()&&mstrApp.diParams.AccessDataFromFiles&&mstrApp.diParams.Admin&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;}},privilege:S.privilegeType.accessDatabase,title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}}];function C(U){if(mstrApp.isSingleTier){if((U===1400)&&!(window.FormWrapper.isWin32&&window.FormWrapper.isWin32())){return true;}if([6800,5300,5600,6600,7000].indexOf(U)!==-1){return true;}}return false;}function E(U){if(!U){return ;}else{if(U.cateType){return[O[U.cateType.toString()]];}else{if(!!S.searchTags[U.dbType]){return S.searchTags[U.dbType];}}}return S.dispTag[U.disp];}function A(V,U){if(V===S.dbType.PIG){U.showImportOption=false;U.sourceInfo.type=S.xdaType.ffsql;}}mstrmojo.DI.model._DISources=mstrmojo.provide("mstrmojo.DI.model._DISources",{supportDBObjects:{},sourceItems:[{sid:Q.file,scriptClass:B,icon:"ds_disk",n:mstrmojo.desc(14904,"File from Disk"),desc:mstrmojo.desc(14913,"Import Excel, CSV, JSON, Text and SAS data files from your local machine"),pageType:I.file,sourceInfo:0,subtype:S.sourceSubtype.localFile,bindings:{enabled:function(){return true;},title:function(){return"";}},oneTier:true,privilege:S.privilegeType.accessFile,tags:["File"]},{sid:Q.url,scriptClass:B,icon:"ds_url",n:mstrmojo.desc(14767,"Data from URL"),desc:mstrmojo.desc(14912,"Import Excel, CSV, JSON, Text, SAS data files and OData from any URL"),bindings:{enabled:function(){return mstrApp.diParams.EnableURLImport;},title:function(){return mstrmojo.DI.DIHelpers.getUrlTooltip();}},pageType:I.file,sourceInfo:1,subtype:S.sourceSubtype.url,oneTier:true,checkConectivity:false,showWhiteListLink:true,privilege:S.privilegeType.accessFile,tags:["File"]},{sid:Q.database,scriptClass:B,icon:"ds_database",n:mstrmojo.desc(14461,"Databases"),desc:mstrmojo.desc(13413,"Access data from Tables"),bindings:{enabled:function(){return mstrApp.diParams.ImportDatabase!==0;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},pageType:I.database,showDBList:true,dbIdExcludeFilter:[41],showImportOption:true,dbObjectsDisplayOptions:1,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.querybuilder,subtype:S.sourceSubtype.querybuilder},oneTier:true,privilege:S.privilegeType.accessDatabase,waitDbTypes:true,tags:["Database"]},{sid:Q.bISources,scriptClass:B,icon:"ds_bi_tools",bindings:{enabled:function(){return(mstrApp.diParams.ImportDatabase!==0);},visible:function(){return !mstrApp.diParams.disableBITools;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";}},n:mstrmojo.desc(13422,"BI Tools"),desc:mstrmojo.desc(13423,"Import Reports from SAP BO, OBIEE, and Cognos"),pageType:I.database,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:F.bisource,name:"BI Sources",type:S.xdaType.dataImportBISource,subtype:S.sourceSubtype.bisource},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessDatabase,tags:["BI"]},{sid:Q.clipboard,scriptClass:B,icon:"ds_clipboard",n:mstrmojo.desc(12713,"Clipboard"),desc:mstrmojo.desc(13421,"Type or Paste your data"),bindings:{enabled:function(){return !mstrmojo.dom.isIE8;},visible:function(){return !mstrApp.diParams.disableClipboard;},title:function(){return(!mstrmojo.dom.isIE8)?mstrmojo.desc(12456,"Upload custom data or paste from another data source"):mstrmojo.desc(12981,"Custom data not supported for this browser");}},pageType:I.clipboard,sourceInfo:0,subtype:S.sourceSubtype.clipboard,oneTier:true,privilege:S.privilegeType.accessFile},{sid:Q.hadoop,scriptClass:B,n:mstrmojo.desc(12758,"Hadoop"),desc:mstrmojo.desc(13414,"Query SQL on Hadoop, or type PigScripts"),bindings:{enabled:function(){var U=mstrApp.getRootController().model;return mstrApp.diParams.ImportDatabase!==0&&U.sourceList&&U.sourceList.length!==0;},title:function(){return(mstrApp.diParams.ImportDatabase===0)?mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges"):"";},icon:function(){return"hadoop";}},pageType:I.database,showDBList:true,showImportOption:true,enableHadoopOption:true,dbObjectsDisplayOptions:16,sourceInfo:{sourceType:F.hadoop,name:"hadoop",subtype:S.sourceSubtype.hadoop},containHadoopFile:true,oneTier:true,excludeDBVFilter:S.ibmDb2Versions.slice(0),privilege:S.privilegeType.accessDatabase,waitDbTypes:true,tags:["Hadoop"],waitDbTypesFetched:true},{sid:Q.salesforce,scriptClass:B,n:mstrmojo.desc(12757,"Salesforce Reports"),desc:mstrmojo.desc(9214,"Import your reports from Salesforce.com"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1;},icon:function(){return"salesforce";}},pageType:I.sourceIntro,showOAuthLink:true,link:D,linkType:H,sourceInfo:{id:"4",name:"Salesforce",url:"Salesforce.com",type:F.salesforce,subtype:S.sourceSubtype.salesforce,step2:mstrmojo.desc(12463,"Select Your Report")},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,tags:["oAuth"]},{sid:Q.dropbox,scriptClass:B,icon:"ds_dropbox",n:mstrmojo.desc(11109,"Dropbox"),desc:mstrmojo.desc(13418,"Import files from your account"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1);}},pageType:I.sourceIntro,link:D,showOAuthLink:true,linkType:H,sourceInfo:{id:"0",name:"Dropbox",url:"Dropbox.com",type:F.dropbox,subtype:S.sourceSubtype.dropbox},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessFile,tags:["oAuth"]},{sid:Q.facebook,scriptClass:B,icon:"ds_facebook",n:mstrmojo.desc(10171,"Facebook"),desc:mstrmojo.desc(13424,"Import data from Facebook Pages"),showOAuthLink:true,bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},visible:function(){return false&&!mstrApp.diParams.disableFacebook;},enabled:function(){return(mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1);}},pageType:I.sourceIntro,link:D,linkType:H,sourceInfo:{name:"Facebook",url:"facebook.com",type:F.facebook,subtype:S.sourceSubtype.facebook},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,tags:["oAuth"]},{sid:Q.twitter,scriptClass:B,icon:"ds_twitter",desc:mstrmojo.desc(13425,"Import Tweet data"),showOAuthLink:true,n:mstrmojo.desc(10174,"Twitter"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},visible:function(){return !mstrApp.diParams.disableTwitter;},enabled:function(){return mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1;}},pageType:I.sourceIntro,link:D,linkType:H,sourceInfo:{id:"5",name:"Twitter",url:"twitter.com",type:F.twitter,subtype:S.sourceSubtype.twitter},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,tags:["oAuth"]},{sid:Q.googleDrive,scriptClass:B,icon:"ds_drive",n:mstrmojo.desc(11108,"Google Drive"),desc:mstrmojo.desc(13418,"Import files from your account"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1);}},pageType:I.sourceIntro,showOAuthLink:true,link:D,linkType:H,sourceInfo:{id:"3",name:"Google Drive",url:"Drive.google.com",type:F.googleDrive,subtype:S.sourceSubtype.googleDrive},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessFile,tags:["oAuth"]},{sid:Q.googleAnalytics,scriptClass:B,bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1);},icon:function(){return"google_Analytics";}},n:mstrmojo.desc(12448,"Google Analytics"),showOAuthLink:true,desc:mstrmojo.desc(12449,"Import your web analytics data"),pageType:I.sourceIntro,link:D,linkType:H,sourceInfo:{id:"1",name:"Google Analytics",url:"Google.com/analytics/",type:F.googleAnalytics,subtype:S.sourceSubtype.googleAnalytics},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessCloud,tags:["oAuth"]},{sid:Q.googleBigQuery,scriptClass:B,n:mstrmojo.desc(15367,"Google BigQuery (Native API)"),showOAuthLink:true,desc:mstrmojo.desc(13417,"Access Big Data in Google Cloud"),bindings:{title:function(){return(document.location.protocol.indexOf("https")===-1&&!mstrApp.isSingleTier&&!N.isServerBasedWS())?mstrmojo.desc(12498,"Disabled as the web server is not setup for HTTPS connections."):"";},enabled:function(){return(mstrApp.isSingleTier||N.isServerBasedWS()||document.location.protocol.indexOf("https")!==-1);},icon:function(){return"google-bigquery";}},pageType:I.sourceIntro,showImportOption:true,link:D,linkType:H,sourceInfo:{id:"2",name:"Google BigQuery",url:"Google.com/bigquery/",checkConectivity:true,type:F.googleBigQuery,subtype:S.sourceSubtype.googleBigQuery,step2:mstrmojo.desc(12461,"Make a query and get results"),step3:mstrmojo.desc(12462,"Publish cube to create documents")},oneTier:true,checkConectivity:true,privilege:S.privilegeType.accessDatabase,tags:["oAuth"]},{sid:Q.samplefile,scriptClass:B,icon:"ds_sample",n:mstrmojo.desc(12712,"Sample Files"),desc:mstrmojo.desc(13426,"Import some sample files"),bindings:{enabled:function(){return true;},visible:function(){return !mstrApp.diParams.disableSampleFiles;}},sourceInfo:{subtype:S.sourceSubtype.samplefile},pageType:I.sampleFiles,oneTier:true,checkConectivity:false,privilege:S.privilegeType.accessFile,tags:["File"]},{sid:Q.searchAsASource,scriptClass:B,icon:"ds_search",n:mstrmojo.desc(13419,"Search Engine Indices"),desc:mstrmojo.desc(13420,"Search data via external search engine"),bindings:{enabled:function(){if(mstrApp.showDDAOptions===false||mstrApp.isSingleTier){return false;}return mstrApp.diParams.ImportDatabase!==0;},title:function(){var U="";if(mstrApp.showDDAOptions===false){return mstrmojo.desc(14188,"Disabled as Flash VI does not support this data source");}if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return U;}},pageType:I.database,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12988,"Select a table"),type:S.xdaType.qbSingleTable,subtype:S.sourceSubtype.searchOnSource,extParams:{subtype:S.sourceSubtype.searchOnSource}},oneTier:false,privilege:S.privilegeType.accessDatabase,tags:["Search"]},{sid:Q.olap,scriptClass:B,icon:"ds_olap",n:mstrmojo.desc(13416,"OLAP"),desc:mstrmojo.desc(13415,"Access MDX cubes in SAP, Essbase, MSFT Analysis, and Cognos TM1"),dbObjectsDisplayOptions:2,bindings:{enabled:function(){if(mstrApp.showDDAOptions===false||mstrApp.isSingleTier){return false;}return mstrApp.diParams.ImportDatabase!==0;},title:function(){var U="";if(mstrApp.showDDAOptions===false){return"Disabled as Flash VI does not support this data source";}if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}return U;}},pageType:I.database,sourceInfo:{sourceType:F.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.mdx,subtype:S.sourceSubtype.mdx},oneTier:false,privilege:S.privilegeType.accessDatabase,tags:["OLAP"]},{sid:Q.publicData,scriptClass:B,icon:"ds_cloud",n:mstrmojo.desc(13978,"Public Data"),desc:mstrmojo.desc(14031,"Search for data on the internet and import them"),bindings:{enabled:function(){return mstrApp.diParams.EnableURLImport&&mstrApp.diParams.EnableHttpImport;},visible:function(){return !mstrApp.diParams.disablePublicData;},title:function(){if(!mstrApp.diParams.EnableURLImport){return mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}}},sourceInfo:1,subtype:S.sourceSubtype.publicData,pageType:I.publicData,oneTier:true,checkConectivity:false,privilege:S.privilegeType.accessFile,tags:["PublicData"]},{sid:Q.importFromCube,scriptClass:B,icon:"ds_cloud",n:mstrmojo.desc(16146,"Import existing dataset"),desc:mstrmojo.desc(16147,"Import the definition of an existing dataset"),pageType:I.sourceObjects,sourceInfo:{sourceType:F.importfromcube,name:"Import From Cube",subtype:S.sourceSubtype.importfromcube},subtype:S.sourceSubtype.importfromcube,bindings:{enabled:function(){return N.isServerBasedWS()||!N.isWS();},visible:function(){return !mstrApp.diParams.disableMergeCube&&(N.isServerBasedWS()||!N.isWS());},title:function(){return"";}},oneTier:false,privilege:S.privilegeType.accessFile,importFromCube:true}],staticSourceList:[],customConnector:{sid:S.sourceItemType.newConnector,scriptClass:"mstrmojo.DI.DISourceItem",bindings:{enabled:function(){return(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;},title:function(){var U="";if(!mstrApp.diParams.EnableURLImport){U=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}}return U;},visible:function(){return N.isWS()||!N.isOnetier();}},pageType:S.pageType.newConnector,dbObjectsDisplayOptions:8,sourceInfo:{sourceType:S.sourceType.bisource,name:"New connector",type:500,subtype:S.sourceSubtype.bisource},oneTier:true,checkConectivity:true,showEditDialog:true,privilege:S.privilegeType.accessDatabase,n:"",url:"",desc:"",connectorDesc:"",iconData:"",oid:"",type:1,user:"",pwd:"",tags:["Customized"]},cloudElement:{scriptClass:"mstrmojo.DI.DISourceItem",n:"",desc:"",pageType:I.cloudElement,customizeIcon:true,selected:true,privilege:S.privilegeType.accessCloud,bindings:{title:function(){var U="";if(!mstrApp.diParams.EnableURLImport){U=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){U=mstrmojo.desc(12499,'Disabled as the user does not have any "Web Import Database" privileges');}}return U;},enabled:function(){return N.isLocalWS()?true:mstrApp.diParams.AccessDataFromFiles&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;}},oid:"",sid:S.sourceItemType.cloudElement,oneTier:true,tags:["CE"]},flattendDBTypeSourceItem:{scriptClass:"mstrmojo.DI.DISourceItem",sid:"",icon:"",customizeIcon:true,itemId:"",dbTypeIconCls:"dbTypeIcon-baseImg",n:"",desc:"",pageType:I.database,showDBList:false,dbIdExcludeFilter:[41],showImportOption:true,dbObjectsDisplayOptions:"",sourceInfo:"",oneTier:true,privilege:S.privilegeType.accessDatabase,excludeDBVFilter:"",waitDbTypes:true,tags:"",onclick:mstrmojo.emptyFn(),isDBTypeConnection:true,dbType:""},sourceList:[],searchTags:{100:["Database","ODBC"],200:["Database","ODBC"],300:["Database","ODBC"],400:["Database","ODBC"],500:["Database","ODBC"],600:["Database","ODBC"],700:["Database","ODBC"],900:["Database","ODBC"],1100:["Database","ODBC"],1300:["Database","ODBC"],1400:["File"],1700:["Database","ODBC"],1800:["Database","ODBC"],2200:["Database","ODBC"],2300:["Database","ODBC"],2400:["Database","ODBC"],2800:["Database","ODBC"],2900:["OLAP"],3100:["Database","BigData","Hadoop"],3300:["Cloud"],3500:["Database","ODBC"],3600:["Database","ODBC","BigData"],3800:["Database"],3900:["File"],4000:["Database","ODBC"],4100:["Database","BigData","Hadoop"],4200:["Database","ODBC"],4300:["Database","ODBC"],4700:["Database","Cloud","BigData"],4800:["Cloud"],5200:["Database","NoSQL"],5300:["Database","NoSQL"],5400:["Hadoop"],6400:["Database","BigData","Hadoop"],6600:["Database"],6700:["Database"],6800:["BigData"],6900:["BigData"],7100:["NoSQL"],7200:["Database"],7300:["BigData","Hadoop"],7500:["File"],7600:["Database"],8000:["File"],8100:["BigData"],},postCreate:function(){this.sourceList=[];this.staticSourceList=G.slice();},populateDBRoles:function M(f){var e,h=new mstrmojo.warehouse.obj.DBObjects(),g=this.dbObjectsDisplayOptions,c=this,j,Z,d,V,a=[],Y,U,b=(navigator.platform.indexOf("Win")!==-1||!mstrApp.isSingleTier||N.isServerBasedWS())?1:2,W=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),X=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1));mstrmojo.array.forEach(f.DBS,function(k){e=k.dbType;if(mstrApp.isSingleTier&&X&&(e===100||e===1400)){return true;}U=(k.connType===undefined)?1:k.connType;if((U&b)===b||k.n===mstrmojo.DI.DIConstants.GenericDBStr){if(b===2){k.n=k.n.replace(" (JDBC)","");}Y=mstrmojo.array.find(a,"n",k.n);if(Y<0){a.push(k);}else{a[Y].id=[k.id].concat(a[Y].id);}}});h.supportDBType=a;h.dbVersions=f.dbVersions;h.dbTypes=f.dbTypes;h.dbIDs=f.dbIDs;h.preferences=f.Preferences;this.supportDBObjects=h;if(this.sourceList.length===0){mstrmojo.array.forEach(f.DBS,function(k){e=k.dbType;if(mstrApp.isSingleTier&&!W&&(e===100||e===1400)){return true;}U=(k.connType===undefined)?1:k.connType;if((U&b)===b){if(((k.disp&g)===k.disp&&e!==4700)||(e===1100)){var l=c.getTags(e);if(k.id===0&&e===1100){V=mstrmojo.desc(13993,"Generic Database");Z="G";}else{V=k.IDS>0?mstrmojo.desc(k.IDS,k.n):k.n;Z=V.substring(0,1);}if(b===2){V=V.replace(" (JDBC)","");}j={n:V,initial:Z,pageType:2,dbType:e,dbId:k.id,sourceInfo:{sourceType:S.sourceType.querybuilder,subtype:S.sourceSubtype.querybuilder},tags:l,oneTier:true,privilege:S.privilegeType.accessDatabase};j.showImportOption=J.getImportOptionByDBType(e);j.dbObjectsDisplayOptions=(k.disp)?k.disp:c.getDisplayOptionsByType(e);d=J.getSourceTypeByDBType(e);if(d>0){j.sourceInfo.type=d;}c.sourceList.push(j);}}});this.addfromStaticSources(this.staticSourceList);this.sortSourceList();}this.raiseEvent({name:S.srcItemTypes.DBTYPE_SOURCE,src:c});},getAllSupportedDBType:function(Y,W){var V=this,Z=[],a=V.supportDBObjects.supportDBType,X,U;if(Y.dbTypes){L.forEach(V.importSources,function(b){U=true;if(b.subtype===S.sourceSubtype.hanaSingleTable){X=true;return false;}});if(X){P.forEach(Y.dbTypes,function(b){if(b.dbType===K.SAPHana){Z.push(b);}});}else{P.forEach(Y.dbTypes,function(b){if(!C(b.dbType)&&(!W||V.canAddToDDACube(Y.sourceInfo.subtype,b.dbType))){Z.push(b);}});}}else{a=J.filterDBByDispOption(a,Y.dbObjectsDisplayOptions,Y.dbIdExcludeFilter);a=J.filterDBByAdminConfig(a,Y.dbRolesAdminConfig);P.forEach(a,function(b){if(!C(b.dbType)&&(!W||V.canAddToDDACube(Y.sourceInfo.subtype,b.dbType))){Z.push(b);}});}return Z;},convertDBType2SourceItems:function(U){var V=this;return P.map(U,function(W){return(function(Y){var X=L.copy(V.flattendDBTypeSourceItem,{});return Y.sid?Y:L.copy({sid:P.indexOf(R,Y.dbType)>-1?S.sourceItemType.hadoop:S.sourceItemType.database,icon:S.sourceIconClsName[Y.id]?S.sourceIconClsName[Y.id]:"ds_database",itemId:Y.id,n:Y.n,desc:mstrmojo.desc(12876,"Connect to ####").replace("####",Y.n),dbObjectsDisplayOptions:Y.disp,sourceInfo:P.indexOf(R,Y.dbType)>-1?{sourceType:S.sourceType.hadoop,name:"hadoop",subtype:S.sourceSubtype.hadoop}:{sourceType:S.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:S.xdaType.querybuilder,subtype:S.sourceSubtype.querybuilder},excludeDBVFilter:P.indexOf(R,Y.dbType)>-1?S.ibmDb2Versions.slice(0):undefined,tags:E(Y),dbType:Y.dbType,onclick:function(){var b=mstrApp.dbIds=[],a=mstrApp.dbTypes=[],Z=mstrApp.dbVersions=[];P.forEach(Y.dbVersions,function(c){Z.push(c.v);});b=b.concat(Y.id);a.push(Y.dbType);mstrApp.supportDBObjects=V.supportDBObjects;mstrApp.dbVersions=[];A(Y.dbType,this);this.enableHadoopOption=false;this.handleSourceSelect(this,Y);}},X);})(W);});},getFlattenedDBTypeSourceItems:function(X,W){var V=this.getAllSupportedDBType(X,W),U;if(N.getEnvObj().isAppSchema()){V=P.filter(V,function(Y){return N.filterDisableSources(Y.dbType);});}U=this.convertDBType2SourceItems(V);return U;},addfromStaticSources:function(U){var V=this;mstrmojo.array.forEach(U,function(Y){var X=Y,W=V,Z;if(Y.dbObjectsDisplayOptions){Z=W.supportDBObjects&&W.supportDBObjects.supportDBType;Z=J.filterDBByDispOption(Z,X.dbObjectsDisplayOptions,X.dbIdExcludeFilter);Z=J.filterDBByAdminConfig(Z,X.dbRolesAdminConfig);X.dbTypes=Z;X.dbIds=J.getDBIds(Z);}V.sourceList.push(Y);});},sortSourceList:function(){this.sourceList.sort(function(Y,W){var X=Y.n,V=W.n,Z=X.charAt(0),c=V.charAt(0),U=function(a){return a.charAt(0).toUpperCase()+a.slice(1);};X=U(X);V=U(V);if(/[a-z]/i.test(Z)&&!/[a-z]/i.test(c)){return -1;}else{if(!/[a-z]/i.test(Z)&&/[a-z]/i.test(c)){return 1;}else{if(X>V){return 1;}else{if(X<V){return -1;}else{return 0;}}}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.array","mstrmojo._HasLayout","mstrmojo.ui.ColumnContainer");var E=mstrmojo.dom,G=mstrmojo.hash,C=mstrmojo.array;mstrmojo.ui.ColumnWalk=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.ColumnWalk",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnWalk cf {@cssClass}" mstrAttach:click></div>',layoutConfig:{h:{containerNode:"100%"},xt:true},currentColumn:-1,addNextColumn:function B(K){var J=this.children||[],L=J.length,I=J[L-1];var M=this.addChildren([G.copy(K,{scriptClass:"mstrmojo.ui.ColumnContainer",idx:L})])[0];if(I){I.set("next",M);}},onclick:function A(I){var K=I.getTarget();if(K){var J=this.children;C.forEach(J,function(M,L){if(E.contains(M.domNode,K,true,M.domNode)){this.set("currentColumn",L);}},this);}},oncurrentColumnChange:function D(I){var K=this.children,M=K[I.valueWas],J=K[this.currentColumn],L="active";if(M){M.set(L,false);}J.set(L,true);},removeTrailingContainer:function H(K){var J=this,I=this.children;if(!I||K>=I.length-1){return ;}C.forEach(I.slice(K+1),function(L){J.removeAndDestroyChild(L);});if(K>=0){I[K].set("next",null);}},insertAndRemoveTrailing:function F(J,I){this.removeTrailingContainer(J);this.addNextColumn(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Slider");var E=mstrmojo.dom,C="px";function A(G){this.getUnit=function H(){var I=G.items.length;return I>1?G._effLen/(I-1):1;};this.calcMinMax=function(J,I){var K=Math.round((J/G.unit+I/G.unit)/2);return{min:K,max:K};};this.preUpdateThumb=function(){G.start=Math.min(G.min*G.unit,G._effLen)+C;G.sdCssText=G.orCfg.posCssP+":"+G.start+";";};this.updateThumb=function(){G.containerNode.style[G.orCfg.posCssP]=G.start=Math.min(Math.round(G.min*G.unit),G._effLen)+C;G.moveProgress(parseInt(G.start,10)+5+"px");};return this;}mstrmojo.Refine.SampleSlider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.Refine.SampleSlider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"><div class="progress" style=""></div></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',markupSlots:{progressNode:function(){return this.domNode.firstChild.firstChild.firstChild;},dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},_total:null,init:function F(G){this._super(G);if(G.isHoriz){this.orCfg={posCssP:"left",marginCssP:"marginLeft",lenCssP:"width",lenP:"clientWidth",opPosCssP:"top",thickP:"clientHeight",offsetP:"x"};this.clsOrientation=" sc-h";this._tooltip_pos=mstrmojo.tooltip.POS_BOTTOMLEFT;}else{this.orCfg={posCssP:"top",marginCssP:"marginTop",lenCssP:"height",lenP:"clientHeight",opPosCssP:"left",thickP:"clientWidth",offsetP:"y"};this._tooltip_pos=mstrmojo.tooltip.POS_TOPRIGHT;this.titleHeight=(G.docSelector.fmts.ttl&&G.docSelector.fmts.ttl.height)?parseInt(G.docSelector.fmts.ttl.height,10):0;}this._exRoom=this.thumbWidth;if(this.multiSelect){this._exRoom*=2;}if(G.multiSelect){this.typeHelper=new MultiSlider(this);}else{this.clsType="sc1";this.typeHelper=new A(this);}},postBuildRendering:function B(){this._super();this.moveProgress(parseInt(this.start,10)+5+"px");},moveProgress:function(H){var G=this.progressNode;G.style.width=H;},ondrag:function D(O,N){N=N||window;var P=this.dnd.initD,K=this.ghost.containerNode,U,I,G,M=this.min,Q=this.max,L=this.orCfg,H=L.lenCssP,S=L.posCssP;var R=E.getMousePosition(O,N)[L.offsetP]-P.offset;switch(P.td){case this.thumbNode:U=Math.max(Math.min(P.tP+R,P.sL-P.contL),0);I=U+P.contL;K.style[S]=U+C;this.moveProgress(U+5+C);var J=this.typeHelper.calcMinMax(U,I);M=J.min;Q=J.max;break;case this.frontNode:U=Math.max(Math.min(P.tP+R,P.tP+P.contL),0);G=Math.max(Math.min(P.contL-R,P.tP+P.contL),0);K.style[S]=U+C;K.style[H]=G+C;this.moveProgress(U+5+C);M=Math.min(Math.floor(U/this.unit+0.5),this.max);break;case this.endNode:G=Math.max(Math.min(P.contL+R,P.sL-P.tP),0);I=P.tP+G;K.style[H]=G+C;Q=Math.max(Math.floor(I/this.unit-0.5),this.min);break;default:return ;}if(M!==this.min||Q!==this.max){this.min=M;this.max=Q;this.typeHelper.updateThumb();}this._updateTooltip();},onselectionChange:function(){this._super();this.moveProgress(parseInt(this.containerNode.style.left,10)+5+"px");},preBuildRendering:function(){var I=[],G={},H;for(H=1000;H<=this.max;H++){I[H-1000]={n:H.toString()};}this.items=I;G[this.initValue-1000]=true;this.selectedIndices=G;this._super();}});})();(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var H=mstrmojo.css,E=mstrmojo.validation,G=E.TRIGGER,J=E.STATUSCODE;function F(L){if((this.constraints.trigger&L)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function K(L){return(L&&L.msg?L.msg:"");},postBuildRendering:function A(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function I(L){this._super(L);var P=(this.constraints.trigger&G.ONKEYUP)>0;if(P){var M=this.validationDelay;if(M){this.clearValDelayTimer();var O=this._validateHandler;if(!O){var N=this;this._validateHandler=O=function(){N.validate();if(N._valDelayTimer){window.clearTimeout(N._valDelayTimer);delete N._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(O,M);}else{this.validate();}}},preinput:function D(L){this._super(L);F.call(this,G.ONKEYUP);},preblur:function B(L){this._super(L);F.call(this,G.ONBLUR);},clearValidation:function C(){this._super();var L=this.inputNode;H.removeClass(L,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");L.title=this._original_tooltip;},clearValDelayTimer:function(){var L=this._valDelayTimer;if(L){window.clearTimeout(L);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var P=this.validationStatus;if(!P){return ;}var N=this.inputNode,L=(P.code>J.VALID),M=this.constraints.invalidCssClass;H.toggleClass(N,M||"mstrmojo-TextBox-ErrValidation",L);var O=L?this.getInvalidMsg(P):this._original_tooltip;if(!this.useRichTooltip&&O!==undefined&&O!==null){N.setAttribute("title",O);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._CanAutoClose","mstrmojo._IsPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.ui.PopupConfig","mstrmojo.ui._HasScroller","mstrmojo.ui._HasUITheme","mstrmojo.dom","mstrmojo.css","mstrmojo.ui._HasListTooltip");var E=mstrmojo.dom,H=mstrmojo.css,F=mstrmojo.ui.PopupConfig.directionCfg;var C={};var B=false;function O(W,X){if(W.pop){if(X&&W.ax){window.clearTimeout(this._popupAxTimeout);W.actionFn();this.closeAllMenus();}else{var U=W.fn.call(mstrmojo.all[W.scope],W.ctxt);var V=U.ENUM_CORNERS,S=U.maxHeight,R=E.getMaxScrollHeight();U.setAlignment(V.TOP_RIGHT,V.TOP_LEFT);U.hostId=this.id;U.hostElement=this._getItemNode(W._renderIdx);U.includeScroll=this.includeScroll;U.supportsScroll=true;U.alignWithAnchor=true;U.isHostedWithin=false;U.maxHeight=S?Math.min(R,S):R;this.openPopup(U.newInstance());}}else{if(W.dsbld!==true){if(W.fn(W,this)!==false){this.closeAllMenus();}}}}mstrmojo.ui.menus.Menu=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._IsPopup,mstrmojo.ui.menus._IsMenuPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip,mstrmojo.ui._HasScroller,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.ui.menus.Menu",selectionPolicy:"reselect",locksHover:true,closeOnClick:true,themeClassName:"mojo-theme-dark",icnCss:"mstrmojo-ui-Menu-item-container",popupConfig:null,tooltipCss:{leftCssClass:"menuTooltip",rightCssClass:"menuTooltip"},setupScrollNodes:function(){if(this.popupConfig&&this.popupConfig.supportsScroll){this.scrollNode=this.itemsContainerNode;this.scrollbarHostNode=this.domNode;}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll&&this.hasCustomScrollbar){var S=this.scrollNode;if(!S){return ;}var R=E.getComputedScrollbarWidth(S);S.style.marginRight=-R+"px";S.style.paddingRight=0;}},onscroll:function(){this.closePopup();this._super();},init:function P(U){this._super(U);if(!!mstrApp.isWSStyling){this.themeClassName="mojo-theme-light";}if(U.themeClassName){this.themeClassName=U.themeClassName;}var R=this.popupConfig;this.items=R.getMenuItems();var S=["mstrmojo-ui-Menu","unselectable"],V=R.menuCssClass;if(V){S.push(V);}if(R.hasToggleItem){S.push("hasToggleItem");}H.addWidgetCssClass(this,S);if(R&&R.supportsScroll&&R.maxHeight>0){this.icnCssText=(this.icnCssText||"")+";max-height:"+R.maxHeight+"px";}this.useRichTooltip=!!R.useTooltip;this.tstid=R.tstid;},markupMethods:{onvisibleChange:function M(){var R=this.visible;if(!B||R){H.toggleClass(this.domNode,"visible",R);}}},getItemMarkup:function L(X,S){if(X.getItemMarkup){return X.getItemMarkup.apply(this,[X,S]);}var V=!!X.pop,W=V?"submenu":"item",U=C[W],R='<div class="micn"></div>';if(!U){R+=!!mstrApp.isWSStyling?'<div class="mtxt">{@en@n}</div>':"{@en@n}";if(V){R+='<div class="arw"></div>';}U=this._super(X,S).replace("{@en@n}",R);C[W]=U;}if(X.tstid){U=U.replace("{@tag}","{@tag} "+mstrmojo.tstid(X)+" ");}return U;},getItemProps:function J(U,R){var S=this._super(U,R);S.tag="a";S.addCls("mstrmojo-ui-Menu-item");S.addCls(U.cls);return S;},onmouseover:function Q(Y){var W=Y.config&&Y.config.targetHostElement?Y.config.targetHostElement:Y.getTarget(),a=this.getItemFromTarget(W),X=this,S=X._lastOpened,R=S&&this.getItemFromTarget(S.popupConfig.hostElement)._renderIdx,U=this.getItemNodeFromTarget(W),V=(R!==undefined&&E.contains(this._getItemNode(R),W,true,this.domNode));if(a){this._lastHoverIx=a._renderIdx;window.clearTimeout(this._popupTimeOut);window.clearTimeout(this._popupAxTimeout);if(this._lastHoverIx!==R&&!V){this._popupTimeOut=window.setTimeout(function(){if(X._lastOpened&&X._lastOpened.visible){X.closePopup();}if(X.visible&&a.pop){if(a.ax){X._popupAxTimeout=window.setTimeout(function(){H.removeClass(U,"hlt-ax");O.call(X,a);},0);}else{O.call(X,a);}}},400);if(a.pop&&a.ax){H.addClass(U,"hlt-ax");}}}var Z=this.popupConfig;if(Z&&!Z.isHostedWithin&&this.opener){this.opener.raiseEvent(mstrmojo._HasMarkup.newDomEvent(Y.name,Y.hWin,Y.e,{targetHostElement:Z.hostElement}));}},onclick:function N(R){this._evtTarget=R.getTarget();this._super(R);R.cancel();},postselectionChange:function D(R){var S=R.added;if(S){var U=this.items[S[0]];O.call(this,U,!(U.ax&&this._evtTarget.className==="arw"));delete this._evtTarget;}},oncontextmenu:function G(R){E.preventDefault(window,R.e);return false;},postBuildRendering:function A(R){this._super(R);if(this.popupConfig.supportsScroll){var S=this;window.setTimeout(function(){S.updateScrollbars();},10);}},showTooltip:function K(W,V){var U=E.eventTarget(V,W),S=this.getItemNodeFromTarget(U),R=this.getItemFromTarget(U);this.itemDisabled=R&&R.dsbld;if(S&&((R&&R.ttp)||(S.scrollWidth>S.clientWidth)||(U.scrollWidth>U.clientWidth))){this._super(W,V);}},onCloseMenuCallBack:null,onClose:function I(R){if(this._super){this._super(R);}this.closePopup();if(this.onCloseMenuCallBack){this.onCloseMenuCallBack();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISourceIntro");mstrmojo.DI.DIDatabaseIntro=mstrmojo.declare(mstrmojo.DI.DISourceIntro,null,{scriptClass:"mstrmojo.DI.DIDatabaseIntro",sourceInfo:{},postBuildRendering:function(){if(this._super){this._super();}this.set("sourceInfo",this.sourceInfo);this.introText1.set("text","");},onNextButtonClick:function A(){mstrApp.getRootController().launchQueryBuilder(false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var k=mstrmojo.func.composite,M=mstrmojo.dom,a=mstrmojo.Button.newWebButton,C=mstrmojo.css,Z=mstrmojo.all,N=mstrmojo.hash,c=mstrmojo.DI.DIHelpers,X=mstrmojo.array;function W(t){if(!this.modal){return ;}var u=window.mstrApp;if(u&&u.modalEditorChange){u.modalEditorChange(this.id,t);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",allowHTMLTitle:false,help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,onEditorResized:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function Y(){return this.domNode.firstChild;},titleContainerNode:function l(){return this.domNode.firstChild.firstChild;},titlebarNode:function n(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function R(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function o(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function E(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function S(){return this.domNode.firstChild.childNodes[2];},buttonNode:function I(){return this.domNode.firstChild.childNodes[3];},curtainNode:function p(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.allowHTMLTitle?this.title:mstrmojo.string.encodeHtmlString(this.title);}},onzIndexChange:function(){var t=this.zIndex;this.editorNode.style.zIndex=t;this.curtainNode.style.zIndex=t-1;},onvisibleChange:function(x){if(x){return ;}var w=this.visible,u="closeEffect",t="none";if(w){u="openEffect";t="block";}if(this[u]){this.playEffect(u);}else{this.editorNode.style.display=t;if(this.modal){this.curtainNode.style.display=t;}}},onhelpChange:function f(){if(this.showTitle){var u=this.help,t=this.helpNode;if(!u){t.style.display="none";}else{t.style.display="block";}}},onleftChange:function F(){this.editorNode.style.left=this.left||"";},ontopChange:function H(){this.editorNode.style.top=this.top||"";}},open:function Q(u,t){this._super(u,t);W.call(this,true);},close:function h(t){this._super(t);W.call(this,false);},unrender:function B(t){this._super(t);W.call(this,false);},destroy:function j(t){this._super(t);W.call(this,false);},preBuildRendering:function A(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;W.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function m(){return this.titlebarNode;},getMovingTarget:function V(){return this.editorNode;},onPreClose:function G(){this.hideTooltip();return true;},premousedown:function P(t){var u=t.getTarget();if(u===this.closeNode||u===this.helpNode){C.toggleClass(u,"active",true);}},premouseup:function O(t){var u=t.getTarget();if(u===this.closeNode||u===this.helpNode){C.toggleClass(u,"active",false);}if(t.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function e(t){if(t.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{window.open(mstrmojo.helpPath()+(this.help||""),"_blank");return false;}}},_set_visible:function d(AA,w){var u=(this[AA]!==w);if(u){this[AA]=w;var z=this._close_handler;if(w){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var x=this;z=this._close_handler=z||function(AB){var AC=M.eventTarget(self,AB);if(AC&&AC.parentNode&&!M.contains(x.editorNode,AC,true,document.body)){x.close();}};M.attachEvent(document.body,"mousedown",z);}}else{var t=this._curtain_handler;if(t){M.detachEvent(window,"resize",t);}if(z){M.detachEvent(document.body,"mousedown",z);}}}return u;},showTooltip:function q(AB,AA){var z=this,w=M.findAncestorByAttr(M.eventTarget(AA,AB),"tooltip",true,this.domNode),x=w&&w.value;if(!z.hasOpenTooltip&&x){var u=M.position(w.node);z.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:x,top:Math.max(u.y+40,0),left:Math.max(u.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(AB,AA);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(t){t=Math.round(t);return["rgb(",t,",",t,",",t,")"].join("");}}},preStart:function(){var u=this.target,t=this.widget;t.editorNode.style.display="block";if(!t.modal){return false;}u.style.display="block";C.setOpacity(u,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var t=this.widget;t.editorNode.style.display="none";return !!t.modal;}};function D(t){return function(){Z[t].destroy();};}function J(u,AD,AE,AF){var t=AD.id||"mojoAlertx9",AA,AC=AD.buttons;X.forEach(AC,function(AH){var AG=AH.onclick;AH.onclick=function(AI){var AJ=Z[t];if(AG&&AG.call(AH,AI)===false){return ;}AJ.destroy();AJ=null;};});try{!!Z[t]&&Z[t].destroy();}catch(AB){}var w=AD.cssClass,x=[];if(w){x.push(w);delete AD.cssClass;}if(AF){x.push(AF);}x.push("mstrmojo-alert");AA={scriptClass:"mstrmojo.Editor",id:t,width:"475px",zIndex:1000,title:AE||mstrmojo.desc(11812,"Notification"),cssClass:x.join(" "),children:[{scriptClass:"mstrmojo.Box",cssClass:"alert-content",children:[{scriptClass:"mstrmojo.Label",text:u,allowHTML:AD.allowHTML}]}],visible:true};var z=new mstrmojo.Editor(N.copy(AD,AA));z.render();return z;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function L(u,AC,w){w=w||{};var AD=w.forceClose,AB=w.callback||mstrmojo.emptyFn,AA=N.copy(AC||{},{buttons:AD?[mstrmojo.Button.newActionButton((w.buttonText||mstrmojo.desc(8607,"Dismiss")),AB)]:null,showTitle:false,modal:false,top:"42px"}),x=w.duration||6000;var z=J(u,AA,"",AD?"ed-notify":"ed-toast"),t=z.id;if(!AD){window.setTimeout(k([AB,D(t)]),x);}else{window.setTimeout(function(){if(Z[t]){Z[t].editorNode.style.opacity=0.75;}},6000);}return z;};mstrmojo.confirm=function g(t,AB,AD){AB=AB||{};var w=AB.confirmBtn||{},AA=AB.cancelBtn||{},AC=w.hot!==false,u=!!AA.hot,z=AD&&AD.title,x=[a(w.t||mstrmojo.desc(219,"Yes"),w.fn,AC,w.cfg),a(AA.t||mstrmojo.desc(218,"No"),AA.fn,u,AA.cfg)];return J(t,N.copy(AD||{},{buttons:x,onPreClose:function(){if(AA&&AA.fn){AA.fn();}return true;}}),z,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};mstrmojo.warn=function K(w,t,u){u=u||{};u.cssClass=(u.cssClass||"")+" mstrmojo-warning";return mstrmojo.confirm(w,t,u);};mstrmojo.alert=function b(AA,w,z,AB,t,x){var u={title:z||mstrmojo.desc(12405,"Alert"),zIndex:AB,cssClass:t,buttons:[a(mstrmojo.desc(1442,"OK"),w,true)],onPreClose:function(){if(w){w();}return true;}};N.forEach(u,function(AD,AC){if(!AD){delete u[AC];}});return J(AA,N.copy(x,u),z,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};mstrmojo.error=function U(AA,u,z){var w=AA||{};var x=mstrmojo.desc(96,"Error");var t=!(c.getEnvObj().isInDI()||c.getEnvObj().isInQB());if(z){x=(z.title)?z.title:mstrmojo.desc(96,"Error");z.title=x;if(z.enableContactStr===false){t=false;}}J("",N.copy(z||{},{buttons:[a(mstrmojo.desc(1442,"OK"),u,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:w.shortDesc,longDesc:w.longDesc,showToggle:!!(w.longDesc),enableContactStr:t,allowHTML:!!(z&&z.allowHTML===true)}]}),x,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};}mstrmojo.Editor.ButtonConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo.Button");mstrmojo.requiresDescs(1442,3610,11581,11582);var E=mstrmojo.css,A="on",D=mstrmojo.desc(11581,"Click for more details"),B=mstrmojo.desc(11582,"Collapse");mstrmojo.qb.QBAlertDialog=mstrmojo.declare(mstrmojo.Dialog,null,{scriptClass:"mstrmojo.qb.QBAlertDialog",cssClass:"mstrmojo-qb-AlertDialog",title:mstrmojo.desc(3610),genericMsg:"",detailedMsg:"",width:"475px",isExpanded:false,buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(1442),function(H){var I=this.parent.parent;I.destroy();if(I.callback){I.callback();}},"#666666")],children:[{scriptClass:"mstrmojo.Label",alias:"genericLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-genericlabel"},{scriptClass:"mstrmojo.Label",alias:"expandButton",text:"",cssClass:"mstrmojo-qb-alertdialog-expandbutton",cssDisplay:"",onclick:function C(H){var I=this.parent;I.isExpanded=!I.isExpanded;I.expandButton.set("text",I.isExpanded?B:D);E.toggleClass(I.detailedLabel.domNode,A,I.isExpanded);}},{scriptClass:"mstrmojo.Label",alias:"detailedLabel",text:"",cssClass:"mstrmojo-qb-alertdialog-detailedlabel",cssDisplay:""}],postBuildRendering:function F(){if(this._super){this._super();}this.isExpanded=false;this.genericLabel.set("text",this.genericMsg);this.detailedLabel.set("text",this.detailedMsg||"");this.expandButton.set("text",D);E.toggleClass(this.expandButton.domNode,A,!!this.detailedMsg);}});mstrmojo.qb.old_alert=function G(I,M,O,N,J){var H="mstr-qb-alert",P,K={id:H,zIndex:1000};try{mstrmojo.all[H].destroy();}catch(L){}if(J){mstrmojo.hash.copy(J,K);}P=new mstrmojo.qb.QBAlertDialog(K);P.title=N||mstrmojo.desc(3610);P.genericMsg=I;P.detailedMsg=M;P.callback=O;P.render();};mstrmojo.qb.alert=function G(H,L,K,J,I){if(mstrApp.isBISource){mstrApp.getRootController().handleServerRequestError(H,L,K,J);}else{mstrmojo.error({shortDesc:H,longDesc:L},K,{title:J||mstrmojo.desc(96,"Error"),allowHTML:true});}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ToolBar","mstrmojo.boxmodel","mstrmojo.array","mstrmojo.EnumRWUnitType","mstrmojo.dom","mstrmojo.css");var Q=["background-color","border","border-color","border-left","border-style","border-top","border-width","filter","top","left","z-index","fx","normWidth","normHeight","normZIndex","normTop","normLeft","tbborder","lrborder","ttl"],Y=["width","height"],p="p_fmts";var m="px";var k={getContentHeight:function(u,x){var w=x.ttl&&x.ttl.height;if(u&&w&&!this.floatingToolbar){return Math.max(parseInt(u,10)-parseInt(w,10),0)+m;}return"";},getPortletMinHeight:function(u){return u.ttl.height;},adjustTitleCss:function(){return ;}};var g={getContentHeight:function(u){return u;},getPortletMinHeight:function(){return 0;},adjustTitleCss:function(u){u.titlebarNodeClass+=" floating";return ;}};function A(z,w){var x=this.parent,u=z+"DirtyKey";if(x[u]){x[u](w);}}function P(){this.toolbarTitleTextNode.innerHTML=this.title+(this.count?" ("+this.count+")":"");}function j(){var w=this.parent,z=w&&w.defn;if(z&&parseInt(z.t,10)===mstrmojo.EnumRWUnitType.PANEL){var u=w.parent,x=u.defn;if(x&&x.ifp){return u;}}return null;}var R=mstrmojo.hash,G=2;mstrmojo.DocPortlet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocPortlet",floatingTitle:false,floatingTitleHeight:30,n:"",buttonWidth:17,markupString:'<div class="mstrmojo-portlet {@borderCss}" nm="{@n}" style="{@portletNodeCssText}"><div class="mstrmojo-portlet-slot-shadow" style="{@shadowNodeCssText}"></div><div class="mstrmojo-portlet-container" style="{@portletContainerNodeCssText}"><div class="mstrmojo-portlet-titlebar {@titlebarNodeClass}" style="{@titlebarNodeCssText}"><table style="height:100%;width:100%" class="mstrmojo-portlet-titlebar-table" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-portlet-slot-toolbar-left {@leftToolbarNodeClass}" style="{@leftToolbarNodeCssText}"></td><td class="mstrmojo-portlet-title" style="{@titleNodeCssText}"><div style="overflow: hidden;"></div></td><td class="mstrmojo-portlet-slot-toolbar {@toolbarNodeClass}" style="{@rightToolbarNodeCssText}"></td></tr></table></div><div class="mstrmojo-portlet-buttonbar {@buttonbarNodeClass}" style="{@buttonbarNodeCssText}"></div><div class="mstrmojo-portlet-slot-content" style="{@contentNodeCssText}"></div></div></div>',rightToolbarNodeCssText:"",leftToolbarNodeCssText:"",titleNodeCssText:"",titlebarNodeClass:"",titlebarNodeCssText:"",contentNodeCssText:"",borderCss:"no-border",buttonbarNodeClass:"",buttonbarNodeCssText:"",markupSlots:{containerNode:function(){return this.domNode.lastChild;},portletNode:function(){return this.domNode;},portletContainerNode:function(){return this.domNode.lastChild;},dimNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;},titleNode:function(){return this.domNode.lastChild.childNodes[0];},buttonbarNode:function(){return this.domNode.lastChild.childNodes[1];},toolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[2];},toolbarTitleTextNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[1].firstChild;},leftToolbarNode:function(){return this.domNode.lastChild.firstChild.childNodes[0].rows[0].cells[0];},contentNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontitleChange:function(){P.call(this);},oncountChange:function(){P.call(this);},onfcChange:function(){if(this.fc&&this.content){this.updateContentHeight();}}},formatHandlers:{portletContainerNode:["RW","B","fx","background-color"],shadowNode:["RW","B","fx","background-color"],buttonbarNode:{src:"ttl",props:["background-color"]},titlebarNode:{src:"ttl",props:["F","B","background-color","height","fx","text-align","vertical-align"]},titleNode:{src:"ttl",props:["vertical-align","P","text-decoration"]}},updateServer:true,fc:false,content:null,rightToolbar:null,leftToolbar:null,floatingToolbar:false,_ts:k,getCacheKey:function F(){return this._super()+"-portlet";},getFormats:function M(){var w=this.content,u=w&&w.getFormats();return u&&u[p];},updateContentHeight:function e(AA){var u=this.getFormats(),w=this.content,z=w.dimNode||w.domNode,x=((u.ttl&&parseInt(u.ttl.height,10))||0);if(z){if(!AA){x+=((this.fc||this.isInFilterPanel())?z.offsetHeight:(u.height?parseInt(u.height,10):0));}this.containerNode.style.height=x+m;this.shadowNode.style.height=x+m;}},init:function q(u){this._super(u);var w=this.content;this.n=(u&&u.defn&&u.defn.n)||"";if(w&&w.getFormats()&&!this.getFormats()){this._createFormats();}},preBuildRendering:function B(){var w=this._ts=(this.floatingTitle)?g:k;if(this.isInFilterPanel()){var x=R.clone(this.formatHandlers);x.portletContainerNode=["z-index","height","B","backgroud-color"];x.shadowNode=["z-index","height","B","fx","background-color"];this.formatHandlers=x;}this._super();w.adjustTitleCss(this);var u="display:none;";if(!this.leftToolbar){this.leftToolbarNodeCssText+=u;}if(!this.toolbar){this.toolbarNodeCssText+=u;}var z=mstrmojo._Formattable.getBorderWidths(this);if(z.l||z.t||z.r){this.borderCss="has-border";}},postBuildRendering:function Z(){var x=mstrmojo.dom,AF=this.titleNode,AE=this.onclicktitle;if(this.floatingTitle&&this.titleNode){document.body.appendChild(this.titleNode);var z=mstrmojo.css,AB=this.contentNode,AC=this;if(!this._onhover){this._onhovertt=function(){z.addClass(AC.titleNode,["visible"]);AC._onflt=true;return true;};this._onhoverofftt=function(){z.removeClass(AC.titleNode,["visible"]);AC._onflt=false;return true;};this._onhover=function(){var AG=AC.titleNode;z.addClass(AG,["visible"]);var AH=x.position(AC.contentNode,true);AG.style.top=(AH.y-AG.clientHeight+2)+m;AG.style.left=AH.x+m;return true;};this._onhoveroff=function(){z.removeClass(AC.titleNode,["visible"]);return true;};}x.attachEvent(AB,"mouseover",this._onhover);x.attachEvent(AB,"mouseout",this._onhoveroff);x.attachEvent(AF,"mouseover",this._onhovertt);x.attachEvent(AF,"mouseout",this._onhoverofftt);}if(AF&&AE){x.attachEvent(AF,"click",AE);}if(this._super){this._super();}var AA=this.getFormats();this.set("fc",AA&&!AA.height);if(this.isInFilterPanel()&&!this.isHorizFP()){var u=this.portletContainerNode.style,w=this.shadowNode.style,AD=this.parent;u.width=w.width="99%";u.top=w.top=AD.topStart+m;u.left=w.left=G+m;}else{if(this.isInFilterPanel()&&this.isHorizFP()){G=8;this.portletContainerNode.style.left=this.shadowNode.style.left=parseInt(AA.left,10)+G*this.orgPos+m;}else{if(this.defn.ifp){this.adjustFPHeight2Fit();}}}if(this.buttonbarNode.clientHeight>0){this.buttonbarNode.style.height=this.buttonbarNode.clientHeight*this.model.getZoomFactor()+"px";}},adjustFPHeight2Fit:function(){var x=mstrmojo.dom,u=x.position(this.titleNode),w=x.position(this.contentNode).y-u.y-u.h;this.content.domNode.style.height=parseInt(this.defn.fmts.height,10)-w+"px";},unrender:function E(w){if(this.floatingTitle&&this.titleNode){var z=this.domNode,u=this.titleNode,x=mstrmojo.dom;if(z&&this._onhover){x.detachEvent(z,"mouseover",this._onhover);}if(z&&this._onhoveroff){x.detachEvent(z,"mouseout",this._onhoveroff);}if(u&&this._onhovertt){x.detachEvent(u,"mouseover",this._onhovertt);}if(u&&this._onhoverofftt){x.detachEvent(u,"mouseout",this._onhoverofftt);}if(u){document.body.removeChild(u);}}if(this._super){this._super(w);}},updateStyle:function(x,u){var AA=this.shadowNode.style,z=this.containerNode.style;AA.height=z.height=x;AA.width=z.width=u;},_createFormats:function W(){var AB=this.content&&this.content.getFormats(),z;z=AB.p_fmts={};var u,AA;for(u in Q){AA=Q[u];if(AB[AA]!==undefined){z[AA]=AB[AA];delete AB[AA];}}for(u in Y){AA=Y[u];if(AB[AA]!==undefined){z[AA]=AB[AA];}}AB.height=this._ts.getContentHeight(AB.height,z);if(mstrmojo.dom.isIE&&z.fx&&z.fx.ds&&!z["background-color"]){z["background-color"]="#ffffff";}var x=z.ttl,w=x&&x["background-color"];if(w){this.titlebarNodeClass=mstrmojo.color.getContrastingColor(w,"light","dark");}},refresh:function t(){if(!this.hasRendered){return ;}var w=this.children,u;for(u=w.length-1;u>=0;u--){w[u].refresh();}},isInFilterPanel:function L(){return(j.call(this)!==null);},isHorizFP:function(){if(this.isInFilterPanel()){var u=this.getFilterPanel();return u&&u.defn&&parseInt(u.defn.fds,10)===2;}return false;},getFilterPanel:function H(){return j.call(this);},getContainerHeight:function d(){return this.containerNode.clientHeight;},relocate:function C(u){if(this.isInFilterPanel()&&!this.isHorizFP()){this.portletContainerNode.style.top=this.shadowNode.style.top=u+m;}},setInfoWindowDimensions:function o(AA){var w=this.domNode.style,u=this.shadowNode.style,x=this.portletContainerNode.style,z=mstrmojo._Formattable.getBorderWidths(this);AA.h-=z.h;AA.w-=z.w;u.height=x.height=w.height=AA.h+m;u.width=x.width=w.width=AA.w+m;AA.h-=this.titleNode.offsetHeight;this.toolbarNode.style.display="none";},addDirtyKey:function K(u){A.call(this,"add",u);},removeDirtyKey:function J(u){A.call(this,"remove",u);},setDirtyChildren:function a(){var u=this.content;if(u&&u.setDirtyChildren){u.setDirtyChildren.apply(u,arguments);}}});var X=0,O=1,l=2;function N(u){var w=this.content.defn;if(w){w.set("ds",u);}}function n(u){return{FormattingOrder:{ZIndex:this.getFormats()["z-index"]},FormattingView:{WindowState:u}};}function b(AI,AG,u,AJ){var AE=this.content,AH=AE.k,AD=mstrmojo.boxmodel.px2Inches,z=AE.model.docModel||AE.model,AL=z.getZoomProps(),AA=this.getFormats(),x=AG!==undefined&&u!==undefined,AK={},AB=this,AC=n.call(this,AI),AF=!(AE.defn.t===mstrmojo.EnumRWUnitType.GRIDGRAPH||AE.defn.t===mstrmojo.EnumRWUnitType.GRAPH);if(x){AC.FormattingSize={OldHeight:AD(AL,AG),OldWidth:AD(AL,u),Height:AD(AL,parseInt(AA.height,10)),Width:AD(AL,parseInt(AA.width,10))};}AK.success=function(w){var AM=w&&w.data;if(AM){z.loadPartialData(AM,AH);}N.call(AB,AI);var AN=AB.parent;if(AN.adjustSectionSize&&x){AN.adjustSectionSize();}};z.updateUnitFormat(AE,1,AC,AK,{params:{suppressData:AF,rapidExec:AF},config:x?null:{silent:true},preserveUndo:true});if(!x&&!(AJ&&AJ.all)){if(z.saveRWProps){z.saveRWProps(AH,undefined,1,this.loadDataOnResize,AK,true);}}}function U(){var AC=this.content;if(!AC){return ;}var AA=function(AG){mstrmojo.array.forEach(AG,function(AH){if(AH.ds!==undefined){AH.set("visible",(AH.ds!==AC.defn.ds));}});},AD;if(this.isInFilterPanel()){var x=(parseInt(this.defn.ds,10)===X);AC.set("visible",x);this.updateContentHeight(!x);AD=this.leftToolbar;AA(AD&&AD.children);var z=this.parent;if(z.refreshFP){z.refreshFP();}}else{var u=AC.getFormats(),AE=this.getFormats(),w=this.portletContainerNode.style,AF=this.shadowNode.style,AB=this.contentNode.firstChild.style;AB.height=u.height;AB.width=u.width;AF.height=w.height=AE.height;AF.width=w.width=AE.width;AF.top=w.top=AE.top;AF.left=w.left=AE.left;if(AE["z-index"]!==undefined){AF.zIndex=w.zIndex=AE["z-index"];}AD=this.rightToolbar;AA(AD&&AD.children);if(AC.resize){AC.resize();}}}mstrmojo.DocResizablePortlet=mstrmojo.declare(mstrmojo.DocPortlet,null,{scriptClass:"mstrmojo.DocResizablePortlet",loadDataOnResize:false,_createFormats:function W(){this._super();var w=this.getFormats();var u=parseInt(this.defn.ds,10);if(u===X){w.normHeight=w.height;w.normWidth=w.width;if(w["z-index"]!==null&&w["z-index"]!==undefined){w.normZIndex=w["z-index"];}}if(u!==l){w.normTop=w.top;w.normLeft=w.left;}},onmaximize:function f(){var z=this.parent,AC=this.content,AB=AC&&AC.getFormats(),x=this.getFormats(),w=x.height,u=x.width,AA=mstrmojo._Formattable.getBorderWidths(this);this.clearCache();AC.clearCache();x.height=(parseInt(z.getHeight(),10)-AA.h)+m;AB.height=this._ts.getContentHeight(x.height,x);x.width=AB.width=(z.getWidth()-AA.w)+m;x.top=x.left=0;x["z-index"]=z.getMaxZIndex()+1;b.call(this,l,w,u);},onminimize:function c(){var AB=this.content,w=AB.dimNode||AB.domNode,AA=AB&&AB.getFormats(),z=this.getFormats(),x=z.height||w.offsetHeight,u=z.width;this.clearCache();AB.clearCache();z.width=AA.width=z.normWidth;z.top=z.normTop;z.left=z.normLeft;if(z.normZIndex!==null&&z.normZIndex!==undefined){z["z-index"]=z.normZIndex;}AA.height=0;z.height=this._ts.getPortletMinHeight(z);b.call(this,O,x,u);},onrestore:function S(){var AA=this.content,z=AA&&AA.getFormats(),x=this.getFormats(),w=x.height,u=x.width;this.clearCache();AA.clearCache();x.height=x.normHeight;z.height=this._ts.getContentHeight(x.height,x);x.width=z.width=x.normWidth;x.top=x.normTop;x.left=x.normLeft;if(x.normZIndex!==null&&x.normZIndex!==undefined){x["z-index"]=x.normZIndex;}b.call(this,X,w,u);},changeWindowState:function I(z){N.call(this,z);var x=this.content,AA=n.call(x,z),u=x.model.docModel||x.model;return u.getUnitFormatAction(x,1,AA);},oncollapse:function V(u){b.call(this,O,undefined,undefined,u);},onexpand:function D(u){b.call(this,X,undefined,undefined,u);},adjustFP:function h(){var w=(parseInt(this.defn.ds,10)===X);this.content.set("visible",w);this.updateContentHeight(!w);var u=this.parent;if(u.refreshFP){u.refreshFP();}},postBuildRendering:function Z(){if(!this._sub_dsChange){this._sub_dsChange=this.defn.attachEventListener("dsChange",this.id,U);}this._super();if(this.isInFilterPanel()){var u=(parseInt(this.defn.ds,10)===X);this.updateContentHeight(!u);}}});mstrmojo.DocPortlet.ST_RESTORE=X;mstrmojo.DocPortlet.ST_MAX=l;mstrmojo.DocPortlet.ST_MIN=O;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.MenuPopup");mstrmojo.ui.menus.PopupConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.PopupConfig",cssClass:"",hasToggleItem:false,contents:null,clear:function A(){this._super();this.contents=null;},close:function C(){([].concat(this.contents)[0]).parent.closeAllMenus();},newInstance:function B(){return new mstrmojo.ui.menus.MenuPopup({popupConfig:this});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(1442,2140);var D=mstrmojo.dom,E=mstrmojo.array;function G(L,N){var K=2140,P="Cancel",O="this.parent.popupConfig."+(L?"ok":"cancel"),M=N&&N[(L?"ok":"cancel")+"BtnText"];if(L){K=1442;P="Ok";}return mstrmojo.Button.newWebButton(M||mstrmojo.desc(K,P),function(R){var S=this.parent,Q=S.popupConfig;S.closeAllMenus();Q["fn"+P](Q.data,S);D.stopPropogation(R.hWin,R.e);},L,{slot:"btnNode",bindings:{enabled:O+"Enabled",visible:O+"Visible"},cssDisplay:"inline-block"});}mstrmojo.ui.menus.MenuEditor=mstrmojo.declare(mstrmojo.ui.menus.MenuPopup,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.menus.MenuEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-MenuEditor {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="scroll-container" style="{@scCssText}"><div class="me-content"></div><div class="me-buttons"></div><div class="me-bottom"></div></div></div>',markupSlots:{containerNode:function C(){return this.domNode.firstChild.firstChild;},btnNode:function H(){return this.domNode.firstChild.children[1];},bottomNode:function H(){return this.domNode.firstChild.children[2];},scrollNode:function(){return this.domNode.firstChild;},scrollbarHostNode:function(){return this.domNode;}},popupConfig:null,postBuildRendering:function A(K){this._super(K);if(this.popupConfig&&this.popupConfig.supportsScroll){var L=this;window.setTimeout(function(){L.updateScrollbars();},10);}},onmouseover:function J(L){var K=this.popupConfig;if(K&&!K.isHostedWithin&&this.opener){this.opener.raiseEvent(mstrmojo._HasMarkup.newDomEvent(L.name,L.hWin,L.e,{targetHostElement:K.hostElement}));}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll){var L=this.scrollNode;if(!L){return ;}var K=D.getComputedScrollbarWidth(L);L.style.marginRight=-K+"px";L.style.paddingRight=0;}},monitorWindow:function F(){var L=document.activeElement,K=null;if(L!==null&&L.id!==""){K=this.domNode.querySelector("#"+L.id)?L:null;}this._super();if(K){K.focus();}},init:function I(M){this._super(M);var L=this.popupConfig,K=L.bottomNode;if(L&&L.supportsScroll&&L.maxHeight>0){if(L.cssClass.indexOf("RoleMenu")>-1){L.maxHeight=360;}this.cssText=(this.cssText||"")+";max-height:"+L.maxHeight+"px";this.scCssText=(this.scCssText||"")+";max-height:"+L.maxHeight+"px";}if(!!mstrApp.isWSStyling){this.themeClassName="mojo-theme-light";}this.data=L.data||{};if(L.onOpen){this.onOpen=L.onOpen;}this.addChildren([G(true,L),G(false)]);if(K){K.slot="bottomNode";this.addChildren(K);}},onOpen:function B(){E.forEach(this.children,function(K){if(K.scriptClass==="mstrmojo.ui.ScrollableContainer"&&K.onOpen){K.onOpen();}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Arr","mstrmojo.Button","mstrmojo.HBox","mstrmojo.FishEye");var A=function(B){return mstrmojo.hash.copy(B,{scriptClass:"mstrmojo.Button",text:"",enabled:false,dir:"left",cssClass:"mstrmojo-icon left",onclick:function(){var D=this.parent.fishEyeList,C=D&&D.scroll(this.dir,D.step);}});};mstrmojo.FishEyeContainer=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.FishEyeContainer",cssClass:"mstrmojo-FishEyeContainer",selectedIndex:-1,setItems:function(B){this.fishEyeList.set("items",B);},setSelectedIndex:function(B){this.fishEyeList.set("selectedIndex",B);},scrollable:false,rightScrollbale:false,children:[A({bindings:{enabled:"!!this.parent.scrollable"}}),({scriptClass:"mstrmojo.FishEye",alias:"fishEyeList",items:mstrmojo.Arr.makeObservable([]),srcId:"obList"}),A({alias:"feScrollRight",cssClass:"mstrmojo-icon right",dir:"right",bindings:{enabled:"!!this.parent.rightScrollable"}})]});mstrmojo.css=mstrmojo.hash.copy({getStyleValue:function(D,E){var B=null;if(D.currentStyle){E=(E==="float"?"styleFloat":E);B=D.currentStyle[E];}if(document.defaultView&&document.defaultView.getComputedStyle){E=(E==="float"?"cssFloat":E);var C=document.defaultView.getComputedStyle(D,null);B=C?C[E]:null;}return B;},setStyleValue:function(D,F,E){var B=function(G){return !!(G&&(typeof G==="object")&&(typeof G.length==="number"));};if(B(F)&&B(E)){var C;for(C in F){D.style[F[C]]=E[C];}}else{D.style[F]=E;}}},mstrmojo.css);}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo._IsDial");mstrmojo.WidgetDial=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._IsDial],{scriptClass:"mstrmojo.WidgetDial"});})();(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.ui._HasScroller","mstrmojo.DI.DIConstants");var f=mstrmojo.DI.DIConstants;function a(h){var k=document.createElement("div"),j=k.style,g=h.domNode;k.className="mstrmojo-DataGrid-avatar";j.height=g.clientHeight+"px";g.appendChild(k);h.avatar=k;return k;}function Q(g){var h=mstrmojo.dom.position(g.domNode,true);return h.x;}function O(g){return'<div class="mstrmojo-DataGrid-resizeHandle" unselectable="on" onselectstart="return false" rh="'+g+'"></div>';}function c(j){var h=j.getAttribute("rh"),g=h&&parseInt(h,10);return g;}function Z(h,l,g){var k=g.src,m=k&&k.data,j=m&&m.resizingIdx;if(!(j&&j>0)){return l&&l.apply(h,[g]);}}mstrmojo.RESIZE_NEXT_COLUMN_MODE={getRange:function G(k,j){var g=k.colSizeArray;var h=[-g[j-1]+k.minColWidth,(j==g.length-1)?g[j]-k.resizeHandleWidth-k.minColWidth:g[j]-k.minColWidth];return h;},updateSize:function F(k,j,h){var g=k.colSizeArray;g[j-1]=g[j-1]+h;g[j]=g[j]-h;},updateColumnWidth:function U(k,h,l,j){var g=k.colSizeArray;h[j-1].style.width=g[j-1]+"px";l[j-1].style.width=g[j-1]+"px";h[j].style.width=g[j]+"px";l[j].style.width=g[j]+"px";}};mstrmojo.RESIZE_ALL_COLUMN_MODE={getRange:function G(m,l){var n=m.minColWidth+m.resizeHandleWidth,g=m.colSizeArray,j=0;for(var k=l;k<g.length;++k){j+=g[k]-n;}var h=[-g[l-1]+n,j];return h;},updateSize:function F(k,o,h){var n=k.minColWidth+k.resizeHandleWidth,l=k.colSizeArray;l[o-1]=l[o-1]+h;var g=[];for(var j=0;j<l.length-o;++j){g[j]=o+j;}g.sort(function(q,t){return l[q]-l[t];});for(var j=0;j<g.length;++j){var p=h/(g.length-j);var m=l[g[j]];h-=(m>=p+n)?p:m-n;l[g[j]]=(m>=p+n)?m-p:n;}},updateColumnWidth:function U(l,h,m,k){var g=l.colSizeArray;for(var j=k-1;j<g.length;++j){h[j].style.width=g[j]+"px";m[j].style.width=g[j]+"px";}}};mstrmojo.RESIZE_CURRENT_COLUMN_MODE={getRange:function G(m,l){var n=m.minColWidth+m.resizeHandleWidth,g=m.colSizeArray,j=0;for(var k=l;k<g.length;++k){j+=g[k]-n;}var h=[-g[l-1]+n,j];return h;},updateSize:function F(k,j,h){var g=k.colSizeArray;g[j-1]=g[j-1]+h;},updateColumnWidth:function U(k,h,l,j){var g=k.colSizeArray;h[j-1].style.width=g[j-1]+"px";l[j-1].style.width=g[j-1]+"px";k.widgetResized();}};mstrmojo._CanResizeColumn=mstrmojo.provide("mstrmojo._CanResizeColumn",{draggable:true,dropZone:false,avatar:null,colSizeArray:null,resizableColumns:true,resizeHandleWidth:10,minColWidth:5,resizeColumnBehavior:mstrmojo.RESIZE_NEXT_COLUMN_MODE,createColSizeArray:function d(){var h,m,k,j,l,g;m=this.headerContainerNode;k=m&&m.getElementsByTagName("table")[0];j=k.rows[0].cells;h=[];for(l=0,g=j.length;l<g;l++){h.push(j[l].offsetWidth);}return h;},postBuildRendering:function W(){if(this._super){this._super();}if(this.avatar){this.domNode.appendChild(this.avatar);}this.colSizeArray=null;},getDragData:function E(g){var j=g.src,k=j.node,h=c(k);if(h&&h>0){return{resizingIdx:h,startingX:j.pos.x,baseX:Q(this)};}if(this._super){return this.dropZone&&this._super(g);}return null;},allowDrop:function K(g){var j=g.src,k=j&&j.data,h=k&&k.resizingIdx;if(h&&h>0){return true;}return this.dropZone;},ondragenter:function R(g){Z(this,this._super,g);},ondragover:function S(g){Z(this,this._super,g);},ondragleave:function B(g){Z(this,this._super,g);},ondrop:function X(g){Z(this,this._super,g);},isDragValid:function C(g){var j=g.src,k=j&&j.data,h=k&&k.resizingIdx;if(h&&h>0){return true;}if(this._super){return this._super(g);}return false;},ondragstart:function Y(g){var k=g.src,l=k&&k.data,j=l&&l.resizingIdx;if(j&&j>0){var h=this.avatar||a(this);this.ownAvatar=true;h.style.left=(l.startingX-l.baseX)+"px";h.style.display="block";document.body.style.cursor="col-resize";if(!this.colSizeArray){this.colSizeArray=this.createColSizeArray();this._firstTimeResize=true;}l.resizingRange=this.resizeColumnBehavior.getRange(this,j);return ;}if(this._super){this._super(g);}},ondragmove:function P(h){var p=h.src,j=p&&p.data,n=j&&j.resizingIdx;if(n&&n>0){var o=h.tgt,k=this.avatar,m=j.resizingRange,l=o.pos.x-j.startingX,g=Math.min(m[1],Math.max(l,m[0]));j.deltaX=g;if(k){k.style.left=(j.startingX-j.baseX+g)+"px";}}else{if(this._super){this._super(h);}}},ondragend:function L(l){var u=l.src,m=u&&u.data,q=m&&m.resizingIdx;if(q&&q>0){var g=this.titleColGroup,t=g&&g.childNodes,o=this.dataColGroup,p=o&&o.childNodes,k=t.length,n=this.colSizeArray,h=m.deltaX;this.resizeColumnBehavior.updateSize(this,q,h);if(this._firstTimeResize){var j;for(j=0;j<k;j++){t[j].style.width=n[j]+"px";p[j].style.width=n[j]+"px";}this._firstTimeResize=false;}else{this.resizeColumnBehavior.updateColumnWidth(this,t,p,q);}this.avatar.style.display="none";document.body.style.cursor="";this.ownAvatar=false;}else{if(this._super){this._super(l);}}}});mstrmojo.requiresCls("mstrmojo._CanResizeColumn","mstrmojo.ListMapperTable","mstrmojo.WidgetList");function J(j){var m=document.createElement("colgroup"),g=j.length,h,l;for(l=0;l<g;l++){var k=document.createElement("col");h=j[l];if(h.colWidth){k.style.width=h.colWidth+"px";}k.className=h.colCss||("col"+l);m.appendChild(k);}return m;}function I(h){var j=h._headerWidgets_,g=j&&j.length;if(g>0){var k;for(k=0;k<g;k++){j[k].destroy(true);}}}function A(l,g,k,n,h){var j=[],m=l.headerWidget;k=k?(" "+k):"";n=n||this._headerWidgets;h=h?(" "+h):' w="1"';j.push("<td"+k+">");if(g>0&&this.resizableColumns){j.push(O(g));}j.push('<div class="mstrmojo-DataGrid-headerText');j.push(l.headerCss?" "+l.headerCss:"");if(m){n.push(mstrmojo.hash.copy(m));j.push('"'+h+">");}else{j.push('">');}j.push(l.headerText||"&nbsp");j.push("</div>");j.push("</td>");return j.join("");}function b(g,o){var j,m,n,h,p,l,k=[];g=g||"_headerWidgets";o=o||"1";j=this[g];m=j.length;if(m>0){n=this.headerContainerNode.getElementsByTagName("div");h=mstrmojo.array.filter(n,function(q){return q.getAttribute("w")==o;});for(l=0;l<m;l++){j[l].placeholder=h[l].firstChild;j[l].dataGrid=this;p=mstrmojo.registry.ref(j[l]);p.render();k.push(p);}}this[g+"_"]=k;}mstrmojo.DataGrid=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._CanResizeColumn,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DataGrid",banding:true,resizableColumns:true,columns:null,items:null,listMapper:mstrmojo.WidgetListMapperTable,lockHeader:false,contentWidth:"",renderHook:{},shouldDisableItem:function(){return false;},markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild.firstChild;},dropCueNode:function(){return this.domNode.lastChild.lastChild;},headerContainerNode:function(){return this.domNode.firstChild;},headerRows:function(){return this.domNode.firstChild.firstChild.rows;},bodyRows:function(){return this.domNode.lastChild.firstChild.firstChild.rows;}},markupMethods:{oncontentWidthChange:function(){var h=this.contentWidth,j=this.headerContainerNode,g=this.itemsContainerNode;if(h&&j&&g){j.style.width=h;g.style.width=h;}},onlockHeaderChange:function(){mstrmojo.css.toggleClass(this.domNode,"lockHeader",this.lockHeader);},onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";}},setupScrollNodes:function M(){this.scrollNode=this.scrollboxNode;},itemFunction:function(j,g,h){var k=new mstrmojo.DataRow({columns:h.columns,data:j,disable:h.shouldDisableItem(j),idx:g,dataGrid:h,parent:h});return k;},preBuildRendering:function D(){var m=this.renderHook;if(m&&m.pre){m.pre.apply(this,[A]);}else{var h=this.columns,g=h.length,j=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],l;this._headerWidgets=[];var k;for(k=0;k<g;k++){l=A.apply(this,[h[k],k]);j.push(l);}j.push("</tr></table>");this.headerHtml=j.join("");}if(this._super){this._super();}},postBuildRendering:function W(){if(this._super){this._super();}var j=this.renderHook;if(j&&j.post){j.post.apply(this,[J,b]);}else{b.apply(this);this.titleColGroup=J(this.columns);}var g=this.titleColGroup,o=g.cloneNode(true),l=this.headerContainerNode,n=l&&l.getElementsByTagName("table")[0],p=this.itemsContainerNode,m=this.scrollboxNode,k=this.domNode,h=p&&p.getElementsByTagName("table")[0];this.dataColGroup=o;if(n&&h){n.insertBefore(g,n.firstChild);h.insertBefore(o,h.firstChild);}if(this.lockHeader){m.style.height=k.offsetHeight-l.offsetHeight+"px";mstrmojo.dom.attachEvent(m,"scroll",function(q){l.style.left=-m.scrollLeft+"px";});}},refresh:function H(g){I(this);if(this._super){this._super(g);}},destroy:function e(g){I(this);this._super(g);},unrender:function V(l){var j=this._headerWidgets_,h=j&&j.length,g;if(h>0){var k;for(k=0;k<h;k++){g=j[k];if(g&&g.hasRendered){g.unrender(true);}}}this._super(l);}});mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Container");mstrmojo.DataRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DataRow",cssClass:"mstrmojo-DataRow",dataTextCSSClass:"mstrmojo-DataRow-text",columns:null,disable:false,markupMethods:{onselectedChange:function(){mstrmojo.css.toggleClass(this.domNode,"selected",this.selected);}},buildDom:function(){this.children=[];var n=document.createElement("tr"),t=this.data,z=this.idx,h=this.dataGrid,o=this.cssClass,AB=this.columns,g=this.children,k=this.disable,j,u=-1,AA,x;n.setAttribute("id",this.id);if(h.banding){o+=(z%2==1)?" odd":" even";}n.className=o+(mstrmojo.string.isEmpty(t[h.itemDisplayField||"n"])?" empty-row":"")+(" "+t[h.itemCSSField||"itemCss"]||"")+(k?" disabled":"");var m,q;for(m=0,q=AB.length;m<q;m++){AA=AB[m];x=(AA.dataWidgetBuilder&&AA.dataWidgetBuilder(t))||AA.dataWidget;j=document.createElement("td");if(AA.applyStyle2Cell&&AA.colCss){j.setAttribute("class",AA.colCss);}n.appendChild(j);if(x){j.setAttribute("w","1");u++;g.push(mstrmojo.hash.copy(x,{slot:"slot"+u,data:t,idx:z,dataGrid:h}));}else{if(AA.dataFunction){j.innerHTML=AA.dataFunction(t,z,h);}else{var l=mstrmojo.string.htmlAngles(t[AA.dataField||"n"])||"&nbsp",p=AA.tooltip?' title="'+l+'"':"";j.innerHTML='<div class="'+this.dataTextCSSClass+'" '+p+">"+l+"</div>";}}}this.initChildren();n.mstrmojoId=this.id;return n;},buildRendering:function N(){this._super();var l=this.domNode.childNodes,g=l.length,k={},j=0,m,h;for(h=0;h<g;h++){m=l[h];if(m.getAttribute("w")=="1"){k["slot"+j]=m;j++;}}this.addSlots(k);}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.dom","mstrmojo.TreeNodeSelector");var B=mstrmojo.dom,A={0:"closed",1:"opened",2:"leaf"};mstrmojo.TreeNode=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.TreeNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseover><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},onstateChange:function(){this.stateNode.className="mstrmojo-TreeNode-state "+(A[this.state]||"closed");this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},onselectedChange:function(){var D=this.selected?"addClass":"removeClass";mstrmojo.css[D](this.domNode.firstChild,["selected"]);},ondropCuePosChange:mstrmojo.WidgetList.prototype.markupMethods.ondropCuePosChange},renderOnScroll:false,listSelector:mstrmojo.TreeNodeSelector,premousedown:function C(D){var E=this._super(D),F=B.eventTarget(D.hWin,D.e);if(F===this.stateNode){if(this.state!==2){this.set("state",this.state===1?0:1);}}return E;},preclick:function(D){mstrmojo.dom.stopPropogation(D.hWin,D.e);},prechange:function(D){var E=this._super(D);if(E!==false){var F=this.tree;if(F&&F.onnodechange){F.onnodechange(D);}}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ContextMenuItem","mstrmojo.WidgetList","mstrmojo.ListMapperTable");var H=false,B=20;function G(J,K){var L=J.itemsContainerNode;L.scrollTop=Math.min(Math.max(L.scrollTop+K,0),L.scrollHeight-L.offsetHeight);}function I(K,J){if(!K._scrollInter){var L=B*(J?-1:1);K._scrollInter=window.setInterval(function(){G(K,L);},50);}}function E(J){if(J._scrollInter){window.clearInterval(J._scrollInter);J._scrollInter=null;}}mstrmojo.ContextMenu=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ContextMenu",zIndex:100,visible:true,makeObservable:true,markupString:'<div id={@id} class="mstrmojo-ContextMenu {@cssClass}" style="z-index: {@zIndex};{@cssText}"><div class="mstrmojo-CM-scrollup" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" ></div><div class="mstrmojo-CM-itemsContainer">{@itemsHtml}</div><div class="mstrmojo-CM-scrolldown" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" ></div></div>',markupSlots:{scrollupNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},scrolldownNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){var K=this.domNode,P=this.itemsContainerNode,N=this.scrollupNode,M=this.scrolldownNode;K.style.display=this.visible?"block":"none";if(this.visible){N.style.display="none";M.style.display="none";P.style.overflow="auto";P.style.height="auto";var J=mstrmojo.dom.windowDim().h,O=K.offsetHeight,L=K.offsetWidth;if(J<O){N.style.display="block";N.style.minWidth=L+"px";M.style.display="block";M.style.minWidth=L+"px";P.style.overflow="hidden";P.style.height=(J-42)+"px";}}},onleftChange:function(){this.domNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.domNode.style.top=(this.top!=null)?this.top:"";}},listMapper:mstrmojo.WidgetListMapperTable,itemFunction:function C(N,J,L){if(!H){mstrmojo.requiresCls("mstrmojo.ContextMenuItem");H=true;}var K={data:N,parent:L,hasSubmenu:L._cmSource.hasSubmenu(N),dynamicUpdate:L.dynamicUpdate,_cmSource:L._cmSource,zIndex:L.zIndex,itemIdField:L.itemIdField,itemField:L.itemField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction},M=new mstrmojo.ContextMenuItem(K);return M;},onmousedownarrow:function A(L,K,J){I(this,J);},onclickarrow:function F(L,K,J){G(this,B*(J?-1:1));},onmouseuparrow:function D(L,K,J){E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.Refine.RefineHelpers","mstrmojo.ui._HasScroller","mstrmojo.hash","mstrmojo.string");var C=mstrmojo.hash,N=mstrmojo.string;var D=mstrmojo.Refine.RefineHelpers;mstrmojo.requiresDescs(8953);function I(b,R,U,V,X){var S,c=[],Q,a,W,Y,Z;if(U===0){if(V!==-1&&X!==-1){if(b.length>X){c.push(b.substring(0,V));c.push(b.substring(V,X));c.push(b.substring(X));}else{if(b.length>V){c.push(b.substring(0,V));c.push(b.substring(V));}else{c.push(b);}}}else{if(V===-1){if(b.length>X){c.push(b.substring(0,X));c.push(b.substring(X));}else{c.push(b);}}else{if(b.length>V){c.push(b.substring(0,b.length-V));c.push(b.substring(b.length-V));}else{c.push("");c.push(b);}}}}else{if(U===1){S=b.split(R);for(Q=0;Q<S.length;Q++){c.push(S[Q]);}}else{if(U===2){if(b.match(R)){W=b.match(R)[0];a=b.search(R);Y=W.length+a;c.push(b.substring(0,Y));c.push(b.substring(Y));}else{c.push(b);}}else{if(U===3){if(b.match(R)){Y=b.search(R);c.push(b.substring(0,Y));c.push(b.substring(Y));}else{c.push(b);}}else{if(U===4){if(b.match(R)){c.push(b.match(R)[0]);}}else{if(U===5){if(b.match(R)){W=b.match(R)[0];a=b.search(R);Y=W.length+a;c.push(b.substring(Y));}}else{if(U===6){if(b.match(R)){Y=b.search(R);c.push(b.substring(0,Y));}else{c.push(b);}}else{if(U===7){Z=new RegExp(R.source,"g");c.push(b.replace(Z,""));}else{if(U===8){if(b.match(R)){W=b.match(R)[0];a=b.search(R);Y=W.length+a;c.push(b.substring(0,Y));}else{c.push(b);}}else{if(U===9){if(b.match(R)){Y=b.search(R);c.push(b.substring(Y));}else{c.push(b);}}}}}}}}}}}return c;}function L(X,U,b,V,W,Y){var R,Q=0,a,Z,S;if(V===0){if(W!==-1&&Y!==-1){return 3;}else{return 2;}}else{if(V===1){for(R=0;R<b.length;R++){a=b[R].cells;if(a[X]){Z=a[X].v;S=Z.toString().split(U);Q=Math.max(S.length,Q);}}}else{if(V===2){return 2;}else{if(V===3){return 2;}else{if(V===4){return 1;}else{if(V===5){return 1;}else{if(V===6){return 1;}else{if(V===7){return 1;}else{if(V===8){return 1;}else{if(V===9){return 1;}}}}}}}}}}return Q;}function P(Q,R,a,U){var W=[],Z,X,S;switch(a){case 0:case 1:case 2:case 3:for(Z=0;Z<Q;Z++){S={};if(Q>4&&Z>=2&&Z<=Q-1){if(Z===2){S.suggestionPreview=true;S.cellIndex=Z;S.name="...";S.columnNumber=(Q>4?4:Q);W.push(S);}if(Z===Q-1){S.suggestionPreview=true;S.cellIndex=3;S.name="New Column "+Z;S.columnNumber=(Q>4?4:Q);W.push(S);}continue;}S.suggestionPreview=true;S.cellIndex=Z;S.name="New Column "+Z;S.columnNumber=(Q>4?4:Q);W.push(S);}break;case 4:case 5:case 6:var b,V,Y;S={};Z=1;while(true){b=R+" "+Z;V=true;for(X=0;X<U.length;X++){if(b===U[X].name){V=false;break;}}Z++;if(V){Y=b;break;}}S.suggestionPreview=true;S.cellIndex=0;S.name=Y;S.columnNumber=1;W.push(S);break;case 7:case 8:case 9:S={};S.suggestionPreview=true;S.cellIndex=0;S.name=R;S.columnNumber=1;W.push(S);break;}return W;}function G(Y,V,d,W,Q,X,Z){var U,S;for(U=0;U<d.length;U++){var c=d[U].cells,b={};var R=[];if(c[Y]){var a=I(c[Y].v.toString(),V,W,X,Z);for(S=0;S<Q;S++){b={};if(S<a.length){b.v=a[S];}else{b.v="";}if(Q>4&&S>=2&&S<Q-1){if(S===2){b.v="...";}else{continue;}}b.columnNumber=(Q>4?4:Q);R.push(b);}}else{for(S=0;S<Q;S++){b={};b.v="";if(Q>4&&S>=2&&S<Q-1){if(S===2){b.v="...";}else{continue;}}b.columnNumber=(Q>4?4:Q);R.push(b);}}d[U].cells=[].concat(R);}}function O(S,Q){var R=Q.controller;if(S===1){R.model.raiseEvent({name:"unPreviewSuggestion"});}Q.highlighted=false;}function H(Q){O(Q.src.data.suggestion_type,Q.src.suggestions);}function K(a){var Y=a.src.suggestions;var V=a.src.data;var S=JSON.parse(JSON.stringify(Y.columns));var X=JSON.parse(JSON.stringify(Y.data));if(!Y.highlighted){var W=Y.controller;if(V.suggestion_type===1){var U,Z,Q;var R={};C.copy(S[V.index],R);Z=R.cellIndex;Q=L(Z,V.separator,X.rows,V.suggestion_subtype,V.startOffset,V.endOffset);U=P(Q,R.name,V.suggestion_subtype,S);G(Z,V.separator,X.rows,V.suggestion_subtype,Q,V.startOffset,V.endOffset);W.model.raiseEvent({name:"previewSuggestion",columns:U,data:X,scrollTop:V.scrollTop,cellPos:Y.cellPos});}a.src.suggestions.highlighted=true;}}mstrmojo.Refine.RefineSuggestions=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Refine.RefineSuggestions",markupString:'<div id="{@id}" class="refine-suggestions"><div class="refine-suggestions-list"></div></div>',markupSlots:{listNode:function(){return this.domNode.children[0];}},setupScrollNodes:function E(){this.scrollNode=this.listNode;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function J(U,R){var Q=parseInt(U,10);var S=parseInt(R,10);if(isNaN(Q)||isNaN(S)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=(Q-3)+"px";this.layoutConfig.w.listNode=(S)+"px";if(this._super){this._super((Q)+"px",(S)+"px");}},highlighted:false,children:[{scriptClass:"mstrmojo.WidgetList",renderOnScroll:false,slot:"listNode",alias:"suggestions",itemFunction:function B(U,Q,R){var S=new mstrmojo.Widget({data:U,markupString:'<div class="list-item" mstrAttach:mouseover,mouseout>'+N.encodeHtmlString(U.description)+"</div>"});if(U.suggestion_type!==undefined){S.onmouseover=K;S.onmouseout=H;S.suggestions=R.parent;}return S;},populate:function F(X){this.unrender();var U,S,Q=[];var R=this.parent.controller;var V=R.model;var W=R.refinePanel.bottomPanal.splitter.facetPanel;if(W.hasSelection()){U=JSON.parse(JSON.stringify(V.transformations.Delete.DeleteRowsInTheView));U.engineConfig=W.getJSON();var Y=W.getRequirementDiscription();U.description=U.description.replace("[Requirement]",Y);S=JSON.parse(JSON.stringify(V.suggestions.partialCell.deleteRows[1]));S.operations=JSON.stringify([U]);Q.push(S);U=JSON.parse(JSON.stringify(V.transformations.Delete.DeleteRowsNotInTheView));U.engineConfig=W.getJSON();U.description=U.description.replace("[Requirement]",Y);S=JSON.parse(JSON.stringify(V.suggestions.partialCell.deleteRows[2]));S.operations=JSON.stringify([U]);Q.push(S);X=Q.concat(X);}this.set("items",X);this.set("selectedIndex",-1);this.render();this.set("visible",X.length);this.parent.label.set("visible",!X.length);},onchange:function(U){var Q=this.parent.controller,R,V,S,W;if(this.selectedIndex===-1){return ;}if(U.src.selectedItem.suggestion_type===2){R=Q.refinePanel.bottomPanal.splitter.facetPanel;R.resetAllFacets();}S=JSON.parse(U.src.selectedItem.operations);if(S&&S.length){W=S[0];}V={operations:U.src.selectedItem.operations,engine:JSON.stringify({facets:[],mode:"row-based"})};if(Q.model.hasAddSample()&&W&&(W.op==="core/fill-down"||W.op==="core/blank-down")){D.confirmFilldownOrBlankdown(function(){Q.applyOperations(V);});}else{Q.applyOperations(V);}O(this.selectedItem.suggestion_type,this.parent);},multiSelect:false,visible:false},{scriptClass:"mstrmojo.Label",slot:"listNode",alias:"label",cssClass:"refine-suggestions-label",text:mstrmojo.desc(8953,"Suggestions")}],populate:function F(Q){this.suggestions.populate(Q);this.updateScrollbars();},handleDataChanged:function(Q){this.data=Q.value;},handleColumnsChanged:function(Q){this.columns=Q.value.columns;},handleGotSuggestions:function M(Q){this.populate(Q.list);if(Q.cellPos){this.cellPos=Q.cellPos;}},handleEmptySuggestions:function A(){this.populate([]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.OBList","mstrmojo.ui._IsIncFetchList","mstrmojo.ui._HasScroller");var F=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType;function D(G){return{browseConfig:null,parent:G,next:function(J){var I=this.browseConfig;if(!I){return ;}I.blockBegin+=I.blockCount;var H={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockBegin:I.blockBegin,blockCount:I.blockCount,includeAncestorInfo:true};if(I.folderLinksContextId){H.folderLinksContextId=I.folderLinksContextId;}if(I.includeObjectDesc){H.includeObjectDesc=I.includeObjectDesc;}if(I.rootFolderID){H.rootFolderID=I.rootFolderID;}else{if(I.rootFolderType){H.rootFolderType=I.rootFolderType;}}if(I.browsableTypes){H.objectType=I.browsableTypes;}if(I.searchPattern){H.searchPattern=I.searchPattern;if(I.recursive){H.recursive=I.recursive;}}this.parent.set("waiting",true);if(I.dataProvider){I.dataProvider.serverRequest(H,J);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,J,H);}},hasNext:function(){var H=this.browseConfig;return(H.blockBegin+H.blockCount-1)<H.totalSize;}};}mstrmojo.mstr.ui.IncFetchOBList=mstrmojo.declare(mstrmojo.OBList,[mstrmojo.ui._IsIncFetchList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.mstr.ui.IncFetchOBList",cssClass:"mstrmojo-OBList mstrmojo-IF-OBList",makeObservable:true,renderOnScroll:false,waiting:false,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keypress,mousedown,mouseup,dblclick><div class="scroll-box" style="{@scrollBoxCssText}"><div class="mstrmojo-ListBase2-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onwaitingChange:function(){this.onwaitingChange();}},init:function E(G){if(this._super){this._super(G);}this.ifDataHelper=D(this);if(G.browseConfig){this.ifDataHelper.browseConfig=G.browseConfig;}},onwaitingChange:mstrmojo.emptyFn,addItems:function B(G){var H=this.browseConfig.browsableViewMedias;if(G&&H){var I={};F.forEach(H.split(","),function(J){I[parseInt(J,10)]=true;});G=F.filter(G,function(J){return(J.t!==A.DssTypeDocumentDefinition)||I[J.dvm];});}this.add(G,-1);this.set("waiting",false);if(this._super){this._super(G);}if(this.scrollNode){this.updateScrollbars();}},setupScrollNodes:function C(){this.scrollNode=this.scrollboxNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasPopup","mstrmojo.string","mstrmojo.Pulldown","mstrmojo.Container");var C=mstrmojo.css;mstrmojo.CustomGroupEl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.CustomGroupEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}" mstrAttach:mouseover><div class="mstrmojo-CustomGroupEl-title {@cssClass}" mstrAttach:click><img class="mstrmojo-CustomGroupEl-state {@cssClass}" src="../images/1ptrans.gif" align="absmiddle" onclick="var w = mstrmojo.all[\'{@id}\']; w.set(\'state\', !w.state)" /><span class="mstrmojo-text"></span></div><div class="mstrmojo-onhover mstrmojo-abs mstrmojo-topright mstrmojo-CustomGroupEl-tools {@cssClass}"><img class="mstrmojo-dup" src="../images/1ptrans.gif" title="'+mstrmojo.desc(3397,"Duplicate")+'" onclick="mstrmojo.all[\'{@id}\'].dup()" /><img class="mstrmojo-ops" src="../images/1ptrans.gif"onclick="var w = mstrmojo.all[\'{@id}\'].showOps();" title="'+mstrmojo.desc(7932,"Element display options")+'" /><img class="mstrmojo-del" src="../images/1ptrans.gif" onclick="mstrmojo.all[\'{@id}\'].del()" title="'+mstrmojo.desc(7933,"Delete element")+'"/></div><div class="mstrmojo-CustomGroupEl-details {@cssClass}"><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr-tools {@cssClass}"></div></div></div>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},titleNode:function(){return this.domNode.firstChild.lastChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.firstChild;},exprToolsNode:function(){return this.domNode.lastChild.lastChild;},titlebarNode:function(){return this.domNode.firstChild;}},markupMethods:{ondataChange:function(){var G=this.data,F=G&&G.n;this.titleNode.innerHTML=(F!=null)?mstrmojo.string.encodeHtmlString(F):"";},onstateChange:function(){var F=this.stateNode;F.className="mstrmojo-CustomGroupEl-state "+(this.state?"opened":"closed");this.detailsNode.style.display=this.state?"block":"none";},onselectedChange:function(){C.toggleClass(this.domNode,["selected"],this.selected);},onshowaddChange:function(){this.exprToolsNode.style.display=this.showadd?"block":"none";}},_set_data:function A(H,F){var G=this.data;this.data=F;this.set("expr",F&&F.expr);return G!==F;},optionsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(7934,"Element Options"),contentNodeCssClass:"mstrmojo-balloon",cssClass:"mstrmojo-CGEOptionsEditor",help:"element_options_dialog_box.htm",ce:false,isp:false,onOpen:function(){var F=this.opener.data,G=this.ops.dsplb.dspl;G.set("value",F.ce?2:(F.isp?1:0));},save:function(){var F=this.ops.dsplb.dspl.value,G=this.opener.data;G.ce=(F==2);G.isp=(F==1);this.close();},children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-ElementOptions",alias:"ops",children:[{scriptClass:"mstrmojo.HBox",alias:"dsplb",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(168,"Display:"),cssText:"margin: 0 5px;"},{alias:"dspl",scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:[{n:mstrmojo.desc(7935,"Display element name only (Default)"),v:0},{n:mstrmojo.desc(7936,"Display individual items only"),v:1},{n:mstrmojo.desc(7937,"Display element name and individual items"),v:2}]}]},{scriptClass:"mstrmojo.HBox",alias:"btns",cssText:"float:right;width:150px;margin:5px;",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(118,"Save"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;",onclick:function(){this.parent.parent.parent.save();}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",cssText:"width:72px;margin: 5px;",onclick:function(){this.parent.parent.parent.close();}}]}]}]},showOps:function(){var G=this.titlebarNode,F=mstrmojo.dom.position(G,true);this.openPopup("optionsRef",{zIndex:30,left:Math.round(F.x+F.w-300)+"px",top:Math.round(F.y+F.h)+"px"});},init:function E(F){this._super(F);var G=this.data;if(G){delete this.data;this._set_data(null,G);}},del:function B(){var F=this.parent;if(F&&F.remove){F.remove(this.data);}},dup:function D(){var F=this.parent;if(F&&F.duplicate){var K=this.data,L=F.items,N=K.did,M=1,O=new RegExp(K.n+"_(\\d+)");for(var I=0,J=L.length;I<J;I++){var H=L[I],G=H.n&&H.n.match(O);if(G){M=Math.max(M,G[1]);}N=Math.max(N,parseInt(H.did,10));}F.duplicate(this.data,null,{n:mstrmojo.desc(3651,"Copy of ##").replace("##",K.n),did:F.getNextId(),state:1});}},onmouseover:function(F){this.set("showadd",this.state?true:false);}});})();(function(){var F=mstrmojo.string;function H(Q,R,K){var L,O,J,M=[],N,S;try{N=new RegExp(mstrmojo.string.regEscape(Q),"i");}catch(P){return M;}for(L=0,O=R.length;L<O;L++){J=R[L][K];N.lastIndex=0;if(N.test(J)){M.push(R[L]);}}return M;}function C(){if(this.searchEnabled){this.iconNode.style.display="none";this.inputBar.style.display="";if(this.autofocus){this.inputNode.focus();this.inputNode.select();}}else{this.hideInputNode();if(this.autofocus){if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){var J=this;window.setTimeout(function(){try{J.iconNode.focus();}catch(K){}},100);}else{this.iconNode.focus();}}}}var G={8:"BackSpace",9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};mstrmojo.SearchableDropDownList=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchableDropDownList",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupSlots,{inputBar:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.firstChild.lastChild.rows[0].cells[0].firstChild;}}),markupMethods:mstrmojo.hash.copy({ontextChange:function(){this.iconNode.innerHTML=F.decodeHtmlString(this.text);this.inputNode.value=this.text;},onheightChange:function(){var J=parseInt(this.height,10);if(J>=0){this.domNode.offsetHeight=J+"px";this.inputBar.offsetHeight=J+"px";}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),popupToBody:true,searchEnabled:false,selectedIndex:-1,placeholderText:"",allItems:null,autofocus:true,focus:function(){C.call(this);},hideInputNode:function B(){this.inputBar.style.display="none";this.iconNode.style.display="block";},postBuildRendering:function A(){if(!this.allItems){this.allItems=this.items;}this._super();C.call(this);},clickInput2pop:false,onclick:function I(J){if(this.clickInput2pop){this.togglePopup();}},prekeyup:function E(R){var K=this.getSearchPattern(),P=[],M,Q=this.inputNode,O=R.e,J,L,N=this.items.length;if(G[O.keyCode]==="Enter"){if(this.items.length>0){this.set("selectedIndex",this.selectedIndex===-1?0:this.selectedIndex);}this.onEnter&&this.onEnter();this.closePopup();return ;}else{if(G[O.keyCode]==="Esc"){this.onEsc&&this.onEsc();if(this.popupRef.visible){this.popupRef.close();}return ;}else{if(G[O.keyCode]==="ArrowDown"){if(!this.popupRef.visible){this.togglePopup();}this.set("selectedIndex",(this.selectedIndex+1)%N);}else{if(G[O.keyCode]==="ArrowUp"){if(this.popupRef.visible&&N>0){this.set("selectedIndex",(this.selectedIndex+N-1)%N);}}else{if(this.searchEnabled){if(K&&K.length>0&&K.indexOf(this.lastSearchPattern)>-1){P=H(K,this.items,this.itemField);}else{P=H(K,this.allItems,this.itemField);}this.set("selectedIndex",-1);this.set("items",P);N=P.length;if(N===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}if(K&&K.length>0){this.set("selectedIndex",mstrmojo.array.find(P,this.itemField,Q.value));}}}}}}this.lastSearchPattern=K;},getSearchPattern:function D(){return F.trim(this.inputNode.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Pulldown");var C={ENTER:13,LEFT:37,UP:38,TAB:9,RIGHT:39,DOWN:40,ESC:27};function D(L,M){var G,J,F,H=[],I,N;try{I=new RegExp(L,"i");}catch(K){I=new RegExp(mstrmojo.string.regEscape(L));}for(G=0,J=M.length;G<J;G++){if(I.test(M[G][this.itemField])){H.push(M[G]);}}return H;}function B(F){return !(F<0||F===undefined||F===null);}mstrmojo.SearchablePulldown=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchablePulldown",popupCssClass:"mstrmojo-SearchablePulldown-Popup",searchEnabled:false,allowCustomInput:false,useItemCssOnInput:false,lastSearchPattern:"",isEditing:false,allItems:null,markupString:'<div id="{@id}" class="mstrmojo-SearchablePulldown mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-SearchablePulldown-boxNode mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><input class="mstrmojo-SearchablePulldown-inputNode" value="{@text}" mstrAttach:keyup,blur/><div class="mstrmojo-SearchablePulldown-iconNode mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mouseover,mouseout></div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},inputNode:function(){return this.domNode.firstChild.firstChild;},iconNode:function(){return this.domNode.firstChild.children[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:mstrmojo.hash.copy({ontextChange:function(){if(this.inputNode.value!==this.text){this.inputNode.value=this.text;}},onheightChange:function(){this.domNode.style.height=this.height||"";this.boxNode.style.height=this.height||"";},onsearchEnabledChange:function(){this.inputNode.readOnly=this.searchEnabled?false:true;this.items=this.allItems||this.items;},onallowCustomInputChange:function(){if(this.allowCustomInput){this.set("searchEnabled",true);}},onvalueChange:function E(){if(this.useItemCssOnInput&&this.selectedItem){this.inputNode.className="mstrmojo-SearchablePulldown-inputNode "+(this.selectedItem[this.itemCSS]||"");}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),prevalueChange:function(){this.synchronize();},synchronize:function(){var G=this.value,H=this.items||[],I=H[this.selectedIndex],F=-1;if(I&&G===I[this.itemIdField]){this.selectedItem=I;this.set("text",I[this.itemField]);return ;}F=mstrmojo.array.find(this.items,this.itemIdField,G);if(!B(F)&&this.allowCustomInput){this.selectedItem=undefined;this.selectedIndex=undefined;return ;}this.selectedIndex=B(F)?F:this.defaultSelection;this.selectedItem=I=this.items[this.selectedIndex];this.value=I?I[this.itemIdField]:undefined;this.set("text",I?I[this.itemField]:(this.defaultText||""));},preBuildRendering:function A(){if(this._super){this._super();}this.allItems=this.allItems||this.items;this.synchronize();},premousedown:function(F){if(this.searchEnabled&&F.getTarget()===this.iconNode){this.set("items",this.allItems);}this._super(F);},onkeyup:function(M){var J=mstrmojo.string.trim(this.inputNode.value),I=M.e,N=I.keyCode||I.which,L=B(this.selectedIndex)?this.selectedIndex:-1,F=this.allowCustomInput,H=this.items.length;this.isEditing=true;switch(N){case C.ENTER:if(H>0&&!F){this.set("selectedIndex",L===-1?0:L);this.synchronize();}this.closePopup();break;case C.ESC:this.closePopup();this.synchronize();break;case C.UP:if(this.popupRef.visible&&H>0){this.set("selectedIndex",(L+H-1)%H);this.synchronize();}break;case C.DOWN:if(!this.popupRef.visible&&H>0){this.togglePopup();}this.set("selectedIndex",(L+1)%H);this.synchronize();break;default:if(J===this.lastSearchPattern){return ;}var K=[];if(J&&J.length>0&&J.indexOf(this.lastSearchPattern)>-1){K=D.apply(this,[J,this.items]);}else{K=D.apply(this,[J,this.allItems]);}this.set("items",K);if(K.length===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}this.set("selectedIndex",undefined);if(J&&J.length){var G=mstrmojo.array.find(K,this.itemField,J);if(G!==-1){this.set("selectedIndex",G);}}}if(F&&!B(this.selectedIndex)){this.set("value",this.inputNode.value);}this.lastSearchPattern=J;},onblur:function(F){this.isEditing=false;if(!this.searchEnabled){return ;}if(!this.allowCustomInput){this.items=this.allItems;this.synchronize();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.VBox","mstrmojo.array","mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItem");var A={scriptClass:"mstrmojo.DI.DISourceItem",icon:"mstrmojo-di-main-page-wait-box",iconData:"",dbTypeIconCls:"wait-box-icon",alias:"spinner",bindings:{visible:function(){return this.parent.showSpinner;}}};var B=mstrmojo.DI.DIConstants,C=mstrmojo.array;mstrmojo.DI.DISourceItemBox=mstrmojo.declare(mstrmojo.VBox,null,{scriptClass:"mstrmojo.DI.DISourceItemBox",markupString:'<table id="{@id}" class="mstrmojo-VBox {@cssClass}" style="position: relative; {@cssText}" cellspacing="0" cellpadding="0"><tr><td></td></tr></table>',showSpinner:true,setSrcLsrs:function(){return[];},asyncSrcFetched:function(){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return{};}var D=mstrApp.getRootController().getModel();return{DBTYPE_SOURCE:D.hasDBMSTypeFetched(),CLOUDELEMENT_CONNECTOR:D.hasCloudElementFetched(),CUSTOM_CONNECTOR:D.hasCustomConnenctFetched()};},postCreate:function(){var D=mstrApp.getRootController().model;if(this._super){this._super();}this.addChildren([A],true);this.addDisposable(D.attachEventListener(B.srcItemTypes.DBTYPE_SOURCE,this.id,"updateSpinner"));this.addDisposable(D.attachEventListener(B.srcItemTypes.CLOUDELEMENT_CONNECTOR,this.id,"updateSpinner"));this.addDisposable(D.attachEventListener(B.srcItemTypes.CUSTOM_CONNECTOR,this.id,"updateSpinner"));this.updateSpinner();},updateSpinner:function(){var D=this.isAllListenedSrcFetched();if(!D){this.set("showSpinner",false);}},isAllListenedSrcFetched:function(){var D=this.setSrcLsrs(),E=this;D=C.filter(D,function(F){return typeof F!=="undefined";});return C.some(D,function(F){return !E.asyncSrcFetched()[F];});},addChildren:function(F,D){if(D){this._super(F);return ;}var E=this.children?this.children.length:undefined;this._super(F,!E||E<0?0:E-1);},removeChildren:function(E,D){this._super(E);if(D){return ;}this.addChildren([A],true);},removeItems:function(D){this.removeChildren(D,true);},addItems:function(E,D){if(!D){this.removeChildren();}this.addChildren(E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.EnumQBAppType","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(14098,12406,13534,13535,12383,14666);var D=mstrmojo.DI.DIConstants,S=mstrmojo.warehouse.EnumDatabaseType,X=mstrmojo.warehouse.EnumDataChangeEvents,F=mstrmojo.qb.EnumQBAppType,O=mstrmojo.array,N=mstrmojo.DI.DIHelpers,c={SET_SINGLE_PARTITION_EMMA:4},I=S.SAPHana,J={SPECIAL_SOURCE:1,ALTERNATE_SOURCE:2,REFRESH_DATA:3},C={1:mstrmojo.desc(12406,"Multiple tables cannot be added to the selection list as this data source has a special restriction which allows only a single table to be present in the data cube."),2:mstrmojo.desc(13534,"Multiple tables cannot be added to the selection list when setting Alternate Source."),3:mstrmojo.desc(13535,"Multiple tables cannot be added to the selection list when refreshing data for a table which is not a partition table.")},R=10,b=0,W=0;function U(k){var m={isPartition:false},n,j=[],l;if(!k){return m;}m.type=k.tp;m.isPartition=m.type!==0;n=k.ptabs||[];O.forEach(n,function(o){l={};if(o.n){l.name=o.n;}if(o.hasOwnProperty("shnb")){l.sheetIndex=o.shnb;}j.push(l);});m.tables=j;return m;}function Y(j){var k=[],l;O.forEach(j,function(m){l={n:m.dbtn||m.n,ns:m.ns,dbr:m.dbr,dbrn:m.dbrn,tid:m.tid||"",gbqpid:m.gbqpid||""};if(m.extt){l.extt=m.extt;}if(m.clis){l.clis=m.clis;}if(m.hanai){l.afis=m.hanai.afis;l.hieris=m.hanai.hieris;l.varis=m.hanai.varis;}k.push(l);});return k;}function P(t,q,n){var o=mstrApp.getRootController().getDataService(),m,l,w=t.length,u=(mstrApp.getRootController().model&&mstrApp.getRootController().model.original)!==undefined,j={success:function p(){var x={};b+=R;if(b>=w){m=JSON.stringify(Y(t));x.tables=m;if(n!==undefined){x.flag=n;}o.autoMap(q,x);}else{l=[];O.forEach(t.slice(b,b+R),function(z){l.push(z.tid);});o.prepareData(j,{tables:l.join(",")},Math.min(b+R,w),w,undefined,u);}},failure:function k(){b+=R;},canceled:function(AA,z){var x={success:function(){q.canceled();},failure:function(){q.canceled();}};if(z&&(z.tid||z.jid)){o.killJob(x,{threadId:z.tid,jobid:z.jid});}else{x.success();}}};l=[];O.forEach(t.slice(b,b+R),function(x){l.push(x.tid);});o.prepareData(j,{tables:l.join(",")},Math.min(b+R,w),w,undefined,u);}function A(){this.raiseEvent({name:"refreshTables",items:this.tables.slice(0),tablesEnabled:this.getAvailableTablesEnabled()});}mstrmojo.qb.es.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.es.Model",tables:[],addTableErrorMsg:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function a(j){if(this._super){this._super(j);}if(j===undefined||j.tables===undefined){this.tables=[];}if(j===undefined){return ;}if(this.isForAlternateSource){this.maxTableCount=1;this.addTableErrorMsg=C[J.ALTERNATE_SOURCE];}else{if(this.isDDA&&(j.tableID!==undefined&&j.tableID!=="")&&(j.type===D.xdaType.qbSingleTable||j.type===D.xdaType.googleBigQuerySingleTable)){this.maxTableCount=1;this.addTableErrorMsg=C[J.SPECIAL_SOURCE];}}if(j.dbTypes!==undefined){this.specifyDBTypes=true;var k=j.dbTypes;if(j.hasNonSapHana||mstrApp.isSingleTier){O.removeItem(k,I);}this.dbRolesTypeFilter=k;this.dbmsTypeFilter=k.slice(0);}if(j.dbIds){this.dbRoleEditorCfg={hideShareConnection:true,dbIdFilter:j.dbIds};}if(j.dbVersions){this.dbRolesVersionFilter=j.dbVersions;this.dbmsVersionFilter=j.dbVersions;}this.dbRolesVersionExcludeFilter=(j.dbRolesVersionExcludeFilter!==undefined)?[223].concat(j.dbRolesVersionExcludeFilter):[223];if(mstrApp.isSingleTier){this.dbRolesVersionExcludeFilter=[203,220,228,252].concat(this.dbRolesVersionExcludeFilter);this.dbRoleEditorCfg=this.dbRoleEditorCfg||{};this.dbRoleEditorCfg.dsnDbTypeExcludeFilter=[4000];}if(j.dbObjects!==undefined){this.dbObjects=j.dbObjects;}if(j.isSapHanaSingleTable){this.isDDA=true;this.origIsDDA=true;this.dbObjectsDisplayOptions=1;this.specifyDBTypes=true;this.dbRolesTypeFilter=[S.SAPHana];this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);}if(j.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=D.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=D.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter);}if(j.subtype!==undefined){switch(j.subtype){case D.sourceSubtype.searchOnSource:this.maxTableCount=1;this.addTableErrorMsg=C[J.SPECIAL_SOURCE];this.isDDA=true;this.origIsDDA=true;this.dbRoleEditorCfg={hideDSNOption:true,hideDriverCheck:true,requiresLogin:false,dbIdFilter:[40]};this.helpTopic="importing_data_using_a_search_as_a_source.htm";this.dbObjectsDisplayOptions=4;this.specifyDBTypes=true;this.dbRolesTypeFilter=[S.SearchEngineSOLR,S.SearchEngineSPLUNK];break;}}this.dbRoleEditorCfg.dbIdExcludeFilter=[41,15];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[3000];},helpTopic:"Importing_data_from_a_database_by_picking_relation.htm",dbRoleEditorCfg:{dbIdExcludeFilter:[41]},canAddTableInDDA:function Z(n){var m=this.tables,k=this.SelDBRoleID,l,j;if(this.isDDA){l=this.dbridForDDA;if(l&&k!==l){j={name:"directDataAccessTableError"};}else{if(!l&&m.length>0&&k!==m[0].dbr){j={name:"directDataAccessTableError"};}}}if(j){if(!n){this.raiseEvent(j);}return false;}return true;},canAddTable:function h(k,n){var o=this.tables,t=n?n.length:0,l=this.maxTableCount,q=[],m,w={OLAP:4+262144000,JOIN:5+262144000,CALC:7+262144000};if(!this.canAddTableInDDA(k)){return false;}if(l&&o.length+t>l){if(!k){this.raiseEvent({name:"maxTableError"});}return false;}var p=this.SelDBRoleID,j=this.getDBRole(p),u=false;if(j&&j.mdDBRole&&j.mdDBRole.db_type===I){mstrmojo.array.forEach(n,function(x){m=parseInt(x.extt,10);if(m!==w.OLAP&&m!==w.JOIN&&m!==w.CALC){q.push(x);}});mstrmojo.array.removeItems(n,"did",q);if(q.length>0){this.raiseEvent({name:"SapHanaIncompatibleTypeError",data:q});}if(t!==0&&n.length===0){return false;}mstrmojo.array.forEach(o,function(x){if(p!==x.dbr){u=true;return false;}});}else{mstrmojo.array.forEach(o,function(x){if(x.hanai){u=true;return false;}});}if(u){this.raiseEvent({name:"SaPHanaError"});return false;}return true;},handleKeepSessionAlive:function Q(){if(N.isServerBasedWS()){mstrApp.serverRequest({taskId:"keepSessionAlive"},{success:function(j){if(j){mstrApp.sessionManager.warningTimeoutTimer(mstrApp.sessionManager.maxSessionIdleTime);}else{mstrApp.sessionManager.sessionTimedout=true;mstrmojo.alert("Your session is expired.");}},failure:function(){mstrmojo.alert("Problems encountered during activating session. Connection is down or session already time out.");}});}else{if(N.getEnvObj().isWS()){}else{mstrApp.sessionManager.keepSessionAlive();}}},addTable:function e(l){var k=this.tables,j=this.SelDBRoleID,n=this.getDBRole(j),p=n.n,o,m=this;if(!this.canAddTable(false,l)){return ;}if(n.mdDBRole&&n.mdDBRole.db_type===I){mstrmojo.array.forEach(l,function(q){k.push({n:q.n,ns:q.ns,dbr:j,dbrn:p,dbtn:q.dbtn,extt:q.extt,hanai:q.hanai,clis:q.clis});});A.call(m);}else{mstrmojo.array.forEach(l,function(q){k.push({n:q.n,ns:q.ns,dbr:j,dbrn:p,dbtn:q.dbtn,gbqpid:m.selectedProject});});if(!this.isDDA){o=mstrApp.getRootController().getDDAController();o.tryEnableDDACheckbox(false);}if(mstrApp.msgid&&mstrApp.sessionManager){m.handleKeepSessionAlive();}A.call(m);}},removeTable:function g(j){var o=mstrApp.getRootController().getDataService(),k=this.tables,m,l=this,n;n=k[j].tid;k.splice(j,1);if(k.length===0&&this.canAddTable(true)){this.raiseEvent({name:X.DBTABLES_ENABLED,value:true});}if(!this.isDDA){m=mstrApp.getRootController().getDDAController();m.tryEnableDDACheckbox(true);}if(n&&!l.original){o.removeEMMATable({success:function(){A.call(l);}},{did:n});}else{if(mstrApp.msgid&&mstrApp.sessionManager){l.handleKeepSessionAlive();}A.call(l);}},removeDBRoleTables:function G(m){var j=this.tables,k=[],l;if(!m){return ;}O.forEach(j,function(n){if(n.dbr!==m){k.push(n);}});if(k.length===j.length){return ;}j=this.tables=k;A.call(this);if(j.length===0&&this.canAddTable(true)){this.raiseEvent({name:X.DBTABLES_ENABLED,value:true});}if(!this.isDDA){l=mstrApp.getRootController().getDDAController();l.tryEnableDDACheckbox(true);}},getAvailableTablesEnabled:function f(){return this.canAddTableInDDA(true);},commitChangesEditPartition:function K(q){var o=this,p=mstrApp.getRootController().getDataService(),k,m=[],t=o.tables,n,l,j=true;if(t.length===0){return ;}n=t[0].dbr;l=t[0].ns;O.forEach(t,function(u){j=u.dbr&&u.dbr===n&&((!u.ns&&!l)||(u.ns===l));if(!j){return false;}m.push(u.n);return true;});if(!j){mstrmojo.alert(mstrmojo.desc(12383,"Error: All the tables should share the same database and namespace when refreshing a partition table"),null,null);return ;}k={mode:c.SET_SINGLE_PARTITION_EMMA,partitionId:o.tableID,addTables:JSON.stringify(m)};p.changePartition(q,k);},commitChanges:function B(o){var n=!!(this.tableID&&this.partition&&this.partition.isPartition),j=this.original,k=this;var l=function(){if(!n&&this.tableID&&this.tables.length>1){n=true;}k._commitChanges(o,n);};O.forEach(k.tables,function(p){if(p.extt){k.isSapHana=true;return false;}});if(j&&k.isSapHana===true){k.editSapHanaTable(o);return ;}if(j){k.originalMsgID=mstrApp.msgid;mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:function m(p){k.messageID=p.msgid;mstrApp.msgid=p.msgid;l();}},{messageID:mstrApp.msgid});}else{l();}},editSapHanaTable:function H(p){var o=!!(this.tableID&&this.partition&&this.partition.isPartition),l=false,k=this,j=p,n=mstrmojo.desc(14666,"Do you want to group these tables into a single partition table?");if(!o&&this.tableID&&this.tables.length>1){o=true;l=true;}if(!o){k._commitChanges(p);return ;}p={success:function m(){k._commitChanges(j,true);}};if(l){mstrmojo.confirm(n,{confirmBtn:{fn:function(){k.commitChangesEditPartition(p);}}});}else{k.commitChangesEditPartition(p);}},_commitChanges:function d(u,q){var n=u;var t=mstrApp.getRootController().getDataService(),p=this,k=false,l,o,m=false,j=function j(AB){if(p.tables.length===0){if(AB&&AB.success){AB.success({msgid:mstrApp.msgid});}return ;}O.forEach(p.tables,function(AC){if(AC.extt){m=true;return false;}});if(m){p.isDDA=true;}var z=function z(){var AC=p.tables;if(p.original&&!m){AC[0].tid="";}else{if(p.original&&m){AC=q?[p.tables[0]]:p.tables;}}l=JSON.stringify(Y(AC));if(mstrApp.msgid){o=m?64:0;o=o|((p.original&&m)?16:0);t.createEmmaTables(AB,{tables:l,skip:k,flag:o,said:mstrApp.said||"",xt:mstrApp.type,sap:m});}else{t.createEmmaInstance({success:function AD(AE){mstrApp.msgid=AE.msgid;t.createEmmaTables(AB,{tables:l,skip:k});}});}};if(p.tables.length>0&&!m&&mstrApp.type!==F.BigQuerySingleTable){k=true;b=0;AB={success:function AA(AC){var AD=p.tables;O.forEach(AD,function(AF,AE){if(AC.tables&&AC.tables.length===AD.length){AF.tid=AC.tables[AE].id;}});P(AD,mstrmojo.func.wrapMethods(n,{canceled:function(){}}),o);}};}else{if(p.tables.length>0&&!m&&mstrApp.type===F.BigQuerySingleTable){AB={success:function AA(AC){O.forEach(p.tables,function(AE,AD){if(AC.tables&&AC.tables.length===p.tables.length){AE.tid=AC.tables[AD].id;}});n&&n.success(AC);}};}else{if(m){W=0;var x={success:function AA(AD){var AC=[],AE=p.tables[W];O.forEach(AD.items,function(AF){AC.push(AF.dbInfo);});AE.clis=AC;AE.hanai=AD.hanaInfo;W++;if(W>=p.tables.length){z();}else{p.getColumnsForDBTable({data:p.tables[W]},mstrmojo.hash.copy(x,{}));}},failure:function w(){W++;}};p.getColumnsForDBTable({data:p.tables[W]},mstrmojo.hash.copy(x,{}));return ;}}}z();};if(p.original){p.tables[0].tid=p.tableID;}j(u);},loadTable:function M(k){var l=this,j=mstrApp.getRootController();l.tableID=k;l.submitRequest({success:function m(AA){var AE=AA.datap.srce,n=AE.dbrid,z,AC=l.tables,p,t=AE.ns||"",o=AE.gbqp||"",x=(AE.dbtp===I),q,w,AD=(mstrApp.type===F.BigQuerySingleTable);l.original=AE;l.usingCookieNamespace=true;if(!AD){w=l.getDBRole(n);p=(w&&w.n)||"";}else{p=AE.gbqp;}if(!l.isBigQuery&&!w){l.fetchAndAppendSingleDBR(n);}z=l.partition=U(AE.pti);if(z.isPartition){O.forEach(z.tables,function(AF){AC.push({n:AF.name,ns:t,dbr:n,dbrn:p});});}else{AC.push({n:AE.tbn,ns:t,dbr:n,dbrn:p,gbqpid:o});}A.call(l);if(AD){j.selectDBRole(o);if(l.getProject(o)===null){q=mstrmojo.desc(14098,"There is no project ## in ###").replace("##",o).replace("###",mstrApp.userEmail);mstrmojo.alert(q);}}else{j.selectDBRole(n);if(x){var u=AC[0];l.getSelectedDBRoleTables({dbRoleID:n,filterText:""},{success:function AB(AF){var AH=AF.items||AF.xrc.cas[0].tis;O.forEach(AH,function(AI){if((AI.tbn||AI.dbtn)===AE.tbn&&AI.ns===AE.ns){u.extt=AI.extt;u.hanai=AI.hanai;return false;}});l.getColumnsForDBTable({getFresh:true,data:{n:AE.tbn,dbtn:AE.tbn,ns:t}},{success:function AG(AJ){var AI=[];O.forEach(AJ.items,function(AK){AI.push(AK.dbInfo);});u.clis=AI;}});}});}}}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:k,browsetype:D.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW,previewflag:this.isRefined?4:8});},_set_SelDBRoleID:function(m,k){var j=this,l=(j.SelDBRoleID!==k);this._super&&this._super(m,k);j.SelDBRoleID=k;if(l&&k){j.setDBRole&&j.setDBRole(k);}mstrmojo.array.forEach(j.dbrs,function(n){if(n.data.isPrimary){n.data.isPrimary=false;j.raiseEvent({name:X.DBROLE_CHANGED,item:n});}if(n.did===k){n.data.isPrimary=true;j.raiseEvent({name:X.DBROLE_CHANGED,item:n});}});if(l){j.raiseEvent({name:X.DBTABLES_ENABLED,value:j.getAvailableTablesEnabled()});A.call(j);}return l;},submitRequest:function V(l,k,j){mstrApp.getRootController().getDataService()[j||"submitRequest"](l,k);},onisDDAChange:function E(j){var k=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(j.value);k.raiseEvent({name:X.DBTABLES_ENABLED,value:k.getAvailableTablesEnabled()});A.call(k);},getHelpTopic:function L(){return this.helpTopic;},loadDBRoles:function(l,j){var k=this;return this._super(mstrmojo.func.wrapMethods(l,{success:function(){if(k.defaultDbrId){mstrApp.getRootController().selectDBRole(k.defaultDbrId);}}}),j);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12370);var M=mstrmojo.hash,S=mstrmojo.array,H=mstrmojo.string,I=mstrmojo.warehouse.EnumDatabaseType,J=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_CHANGED,R=mstrmojo.warehouse.EnumDataChangeEvents.DBTABLES_REQUESTED,U=mstrmojo.architect.menu.EnumMenuActions,F=7425,B=7426,W=mstrmojo.DI.DIConstants;mstrmojo.qb.mdx.Model=mstrmojo.declare(mstrmojo.warehouse.WHModel,null,{scriptClass:"mstrmojo.qb.mdx.Model",cubes:[],dbRoleEditorCfg:{hideShareConnection:true,hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[36,37,38,39],help:"Creating_a_data_source_connection_to_an_OLAP_source.htm"},dbObjectsDisplayOptions:2,dbRolesTypeFilter:[I.SAP,I.MSAS,I.EssBase,I.TM1],recursive:0,addCubes:function K(a){var Y=[],Z=this;if(!this.canAddCube(false)){return ;}mstrmojo.array.forEach(a,function(c){Y.push({n:c.n&&c.n.toString(),caption:c.cube_caption&&c.cube_caption.toString(),tp:c.cubetp.toString(),des:c.des&&c.des.toString(),ctn:c.ctn,tn:c.tn&&c.tn.toString(),isNew:true,dbrid:Z.SelDBRoleID});});Z.cubes=Z.cubes.concat(Y);mstrApp.getRootController().getDataService().pollingStatus({success:function b(){Z.raiseEvent({name:"refreshTables",items:Z.cubes.slice(0)});}},null,mstrmojo.desc(12370,"Please wait..."));},canAddCube:function O(Y){if(this.cubes.length>0){if(!Y){this.raiseEvent({name:"maxCubeError"});}return false;}return true;},commitChanges:function C(c){var Z=this,Y=function(d){var e=Z.recursive.toString();S.forEach(Z.cubes,function(f){f.rec=e;});mstrApp.getRootController().getDataService().addCubes(d,{cubes:JSON.stringify(Z.cubes),tbid:Z.tableID,dbrid:Z.cubes[0].dbrid,showWait:true});},a=function(d){if(Z.isManagedCube){if(d&&d.success){d.success();}}else{var e={success:function(f){if(f&&f.items&&f.items.length===1){Z.folderID=f.items[0].fid;}Z.submitRequest(d,{taskId:"saveAndPublishCube",displayMode:12,shouldRefresh:false,saveAsFlags:W.saveAsFlags.saveAsDDA|W.saveAsFlags.saveAsOverWrite,folderID:Z.folderID||"",objName:Z.cubeName||"",objDesc:Z.cubeDesc||"",showWait:true});}};if(!Z.folderID&&Z.cubeID){mstrApp.getRootController().getDataService().getObjectFolder(e,{dids:Z.cubeID,types:3});}else{e.success();}}};if(this.original){if(Z.cubes[0].isNew){Y({success:function b(){a(c);}});}else{a(c);}}else{Y({success:function b(){a(c);}});}},removeCube:function N(Y){mstrmojo.array.removeIndices(this.cubes,Y,1);this.raiseEvent({name:"refreshTables",items:this.cubes.slice(0)});},updateCube:function X(){var Y=this;mstrApp.getRootController().getDataService().updateCubes({success:function Z(){Y.raiseEvent({name:"refreshTables",items:Y.cubes.slice(0)});}},{tbid:Y.tableID,showWait:true});},initialize:function A(){var Z=this,Y=Z.isNew=!mstrApp.tableID,a=2,b=327681,d=mstrApp.getRootController().getDataService(),e=function e(){d.createEmmaTable({success:function f(g){Z.tableID=g.tbid;mstrApp.msgid=g.msgid;}},{xt:a,dict:b});};Z.tableID=mstrApp.tableID;Z.folderID=mstrApp.folderID;Z.cubeName=mstrApp.cubeName;Z.cubeDesc=mstrApp.cubeDesc;Z.cubeID=mstrApp.reportID;mstrApp.msgid=mstrApp.msgID;Z.cubes=[];Z.dbtbls={};Z.original=undefined;Z.SelDBRoleID=undefined;Z.recursive=0;if(Y){if(mstrApp.msgid){e();}else{d.createEmmaInstance({success:function c(f){mstrApp.msgid=f.msgid;e();}});}}else{Z.loadTable(Z.tableID);}},loadTable:function G(Y){var Z=this;Z.tableID=Y;Z.submitRequest({success:function a(d){var e=d.datap.srce,b=e.dbrid,f=e.tbal&&e.tbal.toString(),c=e.recurisve||0;Z.original=e;Z.cubes.push({n:f,tp:e.dbtp&&e.dbtp.toString(),des:e.des&&e.des.toString(),ctn:e.ctn,tn:f});Z.raiseEvent({name:"refreshTables",items:Z.cubes.slice(0)});Z.set("SelDBRoleID",b);Z.set("recursive",c);}},{taskId:"qBuilder.GetReportXDADefinition",showWait:true,tableID:Y,browsetype:4,previewflag:8});},_set_SelDBRoleID:function P(d,a){var Y=this,c=(Y.SelDBRoleID!==a),Z=mstrmojo.warehouse.EnumDataChangeEvents;if(this._super){this._super(d,a);}Y.SelDBRoleID=a;if(c&&a){mstrApp.getRootController().getDataService().setDBRole({success:function b(e){mstrApp.msgid=e.msgid;}},{dbrid:a,tbid:Y.tableID});}S.forEach(Y.dbrs,function(e){if(e.data.isPrimary){e.data.isPrimary=false;Y.raiseEvent({name:Z.DBROLE_CHANGED,item:e});}if(e.did===a){e.data.isPrimary=true;Y.raiseEvent({name:Z.DBROLE_CHANGED,item:e});var f=mstrApp.diFooterID,g=f?mstrmojo.all[f]:undefined;if(g){g.mdxRA.update(!Y.hasNonRADataset&&(e.mdDBRole.db_type===I.EssBase||e.mdDBRole.db_type===I.MSAS));}}});return c;},getNameSpaces:function D(){var Y=this.SelDBRoleID;this.raiseEvent({name:mstrmojo.warehouse.EnumDataChangeEvents.NAMESPACES_CHANGED,namespaces:undefined,namespaceMode:mstrmojo.warehouse.EnumNamespaceMode.ALL,dbRoleID:Y,namespace:undefined});},getSelectedDBRoleTables:function E(p){var Z=this,t=Z.SelDBRoleID,Y=Z.dbtbls,n=p.blockCount,j=p.filterText,q=Z.getDBRole(t),b=false,e,d=[],h=[],m=[],u,o,k,a,l=Y[t],c,g={};if(!q){return ;}if(!Z.catalogRefresh&&l!==undefined){j=j&&j.toUpperCase();M.forEach(l,function(w,x){b=true;c=H.decodeHtmlString(w.n&&w.n.toString());a=[];k=w.cuis;k=[].concat((k&&k.cui)||[]);e=false;u=[];if(j!==""){S.forEach(k,function(z){var AA=(z.cube_caption||z.n).toString();if(AA.toUpperCase().indexOf(j)>-1){u.push(z);e=true;}});}else{u=k;e=true;}if(e){o=new mstrmojo.warehouse.obj.TableData({id:x,n:c,tn:x,tp:15,model:Z,ns:""});o.items=u.slice(0);h.push(o);}});if(b){if(j!==""){S.forEach(h,function(x,w){g[w]=true;});}Z.raiseEvent({name:J,items:h,expandedIndices:g,selectedItems:Z.getDBRoleTablesInUse(t)||[]});return ;}}l=Y[t]={};Z.raiseEvent({name:R,sourceInfo:p.sourceInfo||""});this.submitRequest({success:function(x){var z=x.mi.cas,AA,w;Z.catalogRefresh=false;z=[].concat((z&&z.ca)||[]);S.forEach(z,function(AC,AB){AA=H.decodeHtmlString(AC.n&&AC.n.toString());w=H.decodeHtmlString(AC.tn&&AC.tn.toString())||AA;if(!l[w]){l[w]=AC;a=[];k=AC.cuis;k=[].concat((k&&k.cui)||[]);S.forEach(k,function AD(AE){AE.cubetp=AE.tp;AE.tp=26;AE.ctn=AA;AE.tn=w;AE.n=AE.n&&AE.n.toString();AE.des=AE.des&&AE.des.toString();a.push(AE);});o=new mstrmojo.warehouse.obj.TableData({id:w,n:AA,tp:15,model:Z,ns:"",did:AA,items:a});l[w].cubes=a;m.push(o);if(AB<n){d.push(o);}}});Z.raiseEvent({name:J,items:m,selectedItems:Z.getDBRoleTablesInUse(t)||[]});},failure:function f(){Z.raiseEvent({name:J,items:m,selectedItems:Z.getDBRoleTablesInUse(t)||[]});}},{taskId:"qBuilder.FetchSourceObjects",dbRoleID:t,mdx:1,showWait:false});},getColumnsForDBTable:function V(f,a){var Z=this,e=f.data.dbrole||Z.SelDBRoleID,c=f.data,b=c.n,d=c.did,Y=Z.dbtbls[e][d].cubes;a.success({src:f,items:Y,selDBRole:e});Z.raiseEvent({name:"dbTablesPopulated",items:{id:b,n:b,items:Y}});if(a&&a.complete){a.complete();}},handleVisibleAction:function Q(Z,Y){var a;if(!Y){return true;}if(Y.action===U.EDIT){a=Z.tp===F||Z.tp===B;}else{a=this._super(Z,Y);}return a;},submitRequest:function L(a,Z,Y){mstrApp.getRootController().getDataService()[Y||"submitRequest"](a,Z);}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.qb.es.Model");mstrmojo.qb.bigquery.ESModel=mstrmojo.declare(mstrmojo.qb.es.Model,[mstrmojo.qb.bigquery._hasBigQueryModel],{scriptClass:"mstrmojo.qb.bigquery.ESModel",getDBRole:function A(){return{n:this.selectedProject};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.DI.DISourceItemAdmin","mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItemBox","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(14456,14459);var B=mstrmojo.array,C=mstrmojo.hash,A=mstrmojo.DI.DIConstants;mstrmojo.DI.DIResourceAdmin=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DI.DIResourceAdmin",selectedSource:null,topLabel:mstrmojo.desc(14459,"Commonly used"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),markupString:'<div id="{@id}" class="mstrmojo-DI-DIResourceAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIResourceAdmin-Label top" style="position: relative">{@topLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content top cf"></div><div class="mstrmojo-DI-DIResourceAdmin-Label bottom" style="position: relative">{@bottomLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content bottom cf"></div></div>',markupSlots:{topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.DI.DISourceItemBox",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box top",setSrcLsrs:function(){var D=!mstrApp.diParams.disableCESource?A.srcItemTypes.CLOUDELEMENT_CONNECTOR:undefined,E=!mstrApp.diParams.disableCustomerConnector?A.srcItemTypes.CUSTOM_CONNECTOR:undefined;return[D,E];}},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box bottom"}],hasCustomScrollbar:true,setupScrollNodes:function(){this.scrollNode=this.domNode;},postBuildRendering:function(){if(this._super){this._super();}this.populateResources();var D=mstrApp.getRootController().model;D.attachEventListener("sourceItemsChange",this.id,this.onsourceItemsChange);D.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},onsourceItemsChange:function(){this.populateResources();},populateResources:function(){var H=this,E=mstrApp.getRootController(),G=E.getModel(),F=[],I=[],J=this.domNode.scrollTop;var D=function(K){H.onItemSelectChange(K);};B.forEach(G.sourceItems,function(L){var K=C.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:L.selected!==false?"":"add",onselectChange:D},C.clone(L));if(K.selected!==false){I.push(C.copy({mode:"remove"},K));}else{F.push(K);}});this.selectedSource=I||[];this.topBox.addItems(mstrApp.isSingleTier?E.filterSourcesForOneTier(I):E.filterSourcesByPrivileges(I));this.bottomBox.removeChildren();this.bottomBox.addChildren(mstrApp.isSingleTier?E.filterSourcesForOneTier(F):E.filterSourcesByPrivileges(F));this.updateScroll(J);},updateScroll:function(D){this.domNode.scrollTop=D;this.updateScrollbars();this.disableScroll(true,false);},onItemSelectChange:function(D){switch(D.type){case"add":this.addItem(D);break;case"remove":this.removeItem(D);break;}},addItem:function(N){var J=this,I=mstrApp.getRootController().getModel(),D=N.src,F=I.sourceItems,H=A.sourceItemType,G,E,L,O,K,M;var P=function(Q){J.onItemSelectChange(Q);};K=(D.sid===H.newConnector);M=(D.sid===H.cloudElement);this.bottomBox.removeChildren(D);D.destroy();G=D.sid;L=B.find(F,K||M?"oid":"sid",K||M?D.oid:G);E=F[L];O=C.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"remove",onselectChange:P},C.clone(E));this.selectedSource.push(O);this.topBox.addItems([O],true);},removeItem:function(N){var J=this,D=N.src,I=mstrApp.getRootController().getModel(),E=I.sourceItems,F=A.sourceItemType,L,H,O,G,K,M;var P=function(Q){J.onItemSelectChange(Q);};K=(D.sid===F.newConnector);M=(D.sid===F.cloudElement);L=B.find(this.topBox.children,K||M?"oid":"sid",K||M?D.oid:D.sid);if(L<0){return ;}O=this.topBox.children[L];this.topBox.removeItems(O);L=B.find(this.bottomBox.children,K||M?"oid":"sid",K||M?D.oid:D.sid);if(L>=0){O=this.bottomBox.children[L];O.set("mode","add");}else{H=B.find(E,K||M?"oid":"sid",K||M?D.oid:D.sid);if(H>=0){G=C.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"add",onselectChange:P},C.clone(E[H]));this.bottomBox.addChildren([G],true);}}L=B.find(this.selectedSource,K||M?"oid":"sid",K||M?D.oid:D.sid);if(L>=0){B.removeIndices(this.selectedSource,L,1);}},getAdminConfig:function(){var I=this,F=mstrApp.getRootController().getModel(),H=I.selectedSource,G=null,D,E;if(this.hasRendered){G=[];B.forEach(F.sourceItems,function(K){var J=K.sid;D=(J===A.sourceItemType.newConnector);E=(J===A.sourceItemType.cloudElement);if(B.find(H,D||E?"oid":"sid",D||E?K.oid:J)<0){G.push(D||E?K.oid:J);}});}return G;},adjustSize:function(D){var E=Math.floor(parseInt(D.size.w,10)),G,F;if(isNaN(E)||E<0||!this.domNode){return ;}G=Math.floor(E/160);if(G>0){F=Math.floor((E-G*160)/2);}if(F>0){this.topBox.domNode.style.left=F+"px";this.bottomBox.domNode.style.left=F+"px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo._HasContextMenu","mstrmojo.ContextMenu");mstrmojo.MenuButton=mstrmojo.declare(mstrmojo.Button,[mstrmojo._HasContextMenu],{preclick:function A(B){this.showContextMenu();},openPopupMenu:function(){this.showContextMenu();}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.fx","mstrmojo.TreeNode");var K=mstrmojo.dom,E={0:"closed",1:"opened",2:"leaf"},I=function(R,Q){var N=R.style,M,P,L,S,O;N.display="block";N.height="auto";M=R.offsetHeight;P=Q?M:0;L=Q?0:M;S=Q?"block":"none";N.overflow="hidden";O=new mstrmojo.fx.AnimateProp({target:R,props:{height:{start:L,stop:P,suffix:"px",fn:Math.round,ease:mstrmojo.ease.linear}},onEnd:function(){N.height="auto";N.display=S;},interval:30,duration:300});O.play();};mstrmojo.TreeBrowserNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.TreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',markupSlots:mstrmojo.hash.copy({displayNode:function(){return this.domNode.firstChild;},checkBoxNode:function(){return this.domNode.firstChild.childNodes[1];}},mstrmojo.TreeNode.prototype.markupSlots),markupMethods:mstrmojo.hash.copy({onstateChange:function(L){this.stateNode.className="mstrmojo-TreeNode-state "+(E[this.state]||"closed");if(this.tree.anim&&this.contentRetrieved&&!L){I(this.itemsContainerNode,this.state===1);}else{this.itemsContainerNode.style.display=(this.state===1)?"block":"none";}}},mstrmojo.TreeNode.prototype.markupMethods),blockBegin:1,allowUnlistedValues:false,contentRetrieved:false,_set_items:function(N,M){var L=this._super(N,M);if(L&&this.tree.anim){I(this.itemsContainerNode,true);}return L;},onstateChange:function J(){var L=this.tree;if(!this.contentRetrieved&&(this.state==1)){this.set("items",[L.loadingItemCreaterFunc()]);L.getContent(this,this.blockBegin);}else{if((this.state==1)&&L.onNodeExpand){L.onNodeExpand(this);}if((this.state==0)&&L.onNodeCollapse){L.onNodeCollapse(this);}}},toggleState:function G(){if(this.state!==2){this.set("state",this.state===1?0:1);}},preclick:function H(L){K.clearBrowserHighlights(L.hWin);return false;},predblclick:function D(L){K.clearBrowserHighlights(L.hWin);return false;},premousedown:function B(M){var R=mstrmojo.dom,O=mstrmojo.dom.eventTarget(M.hWin,M.e),L=this.tree,N=(this.state==2),Q=R.contains(this.itemsContainerNode,R.eventTarget(M.hWin,M.e),true,this.domNode),P=(L.branchClickPolicy==mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if((this.isSpecialNode()||!(O==this.checkBoxNode||((O==this.textNode||O==this.displayNode)&&(N||!P))))&&!this.draggable){R.stopPropogation(M.hWin,M.e);}if((O==this.stateNode)||((O==this.textNode||O==this.displayNode)&&!N&&P)){if(!N){this.toggleState();}}else{if(O==this.checkBoxNode||Q){if(this._super){this._super(M);}}else{this.handleNodeClicked();}}},isSpecialNode:function C(){var L=this.data&&this.data.st;return(L<0);},handleNodeClicked:function F(){var L=this.tree,M=this.parent,N=this.data;switch(N&&N.st){case"-4":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin-L.blockCount);break;case"-3":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin+L.blockCount);break;case"-1":case"-2":break;default:if(L.handleNodeClicked){L.handleNodeClicked(N);}}},init:function(L){this._super(L);this.set("state",this.tree.isBranch(this.data)?0:2);},postBuildRendering:function A(){if(this._super){this._super();}var L=function(M){K.preventDefault(window,M||window.event);return false;};K.attachEvent(this.domNode,"mousedown",L);if(this.isSpecialNode()||this.tree.noCheckBox){this.checkBoxNode.style.display="none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo._HasOwnAvatar","mstrmojo.TreeNode");mstrmojo.requiresDescs(70);var E=mstrmojo.dom,J;var G={scriptClass:"mstrmojo.Container",slot:"tableNode",markupString:"<div class='mstrmojo-url-list-dnd' title='{@title}' mstrAttach:click ><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},imageNode:function(){return this.domNode.children[0];},contentNode:function(){return this.domNode.children[1];}},markupMethods:{onisFolderChange:function(){if(this.isFolder){mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-folder");}else{mstrmojo.css.addClass(this.imageNode.firstChild,"drop-zone-file");}}},text:"",isFolder:"",children:[{slot:"contentNode",alias:"text",cssClass:"item-content",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"imageNode",alias:"image",cssClass:"item-image",scriptClass:"mstrmojo.Label"}]};mstrmojo.DI.DITreeNodeDnD=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.DI.DITreeNodeDnD",title:"",cssClass:"mstrmojo-di-tree-node-dnd-list",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" title="{@title}" mstrAttach:click,mouseover,dblclick><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><div class="mstrmojo-di-tree-node-text {@textCssClass}"></div><span class="mstrmojo-di-ga-tree-node-edit-icon"></span><div class="empty-indicator">'+mstrmojo.desc(70,"This Folder is empty.")+'</div></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},emptyIndicatorNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){var L=this.state===1;this.iconNode.className=L?this.iconFolderOpen:this.iconFolderClosed;this.itemsContainerNode.style.display=L?"block":"none";mstrmojo.css.toggleClass(this.domNode,"expanded",L);},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},ontitleChange:function(){this.domNode.title=this.title;},postitemsChange:function(){mstrmojo.css.toggleClass(this.domNode,"empty",(!this.items||!this.items.length)&&this.data.fetched);}},clickHandler:null,dblClickHandler:mstrmojo.emptyFn,editHandler:null,deselect:function F(){if(this.listNode){if(this.data.isFolder){this.listNode.className="mstrmojo-di-tree-node-folder";}else{this.listNode.className="mstrmojo-di-tree-node-file";}}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",supportFolderDrag:true,totalSize:undefined,draggable:true,createAvatar:function C(N){if(!this.supportFolderDrag&&this.data.isFolder){return document.createElement("div");}if(N.className.indexOf("mstrmojo-di-tree-node-text")>-1){N=N.parentNode;}var M=N.className;G.text=N.innerText;var O=mstrmojo.insert(G);O.render();var L=(M.indexOf("mstrmojo-di-tree-node-folder")>-1)?O.set("isFolder",true):O.set("isFolder",false);return O.domNode;},getDragData:function I(L){var N=[],O,S;if(!this.supportFolderDrag&&this.data.isFolder){return N;}var P=L.target||E.eventTarget(L.src.hWin,L.src.e);var M=P.className;var R=P.parentNode.className;var Q=(M.indexOf("selected")>-1||R.indexOf("selected")>-1);if(Q){S=this.data.browser.fileTree.selectedNodes;for(O=0;O<S.length;O++){N.push(S[O]);}}else{N.push(this);}return N;},isDragValid:function H(){return !this.data.isFolder||this.supportFolderDrag;},ondragstart:function D(L){this._super(L);var M=L.src.data;if(M&&M.length>1){if(this.avatar&&this.avatar.getElementsByClassName){this.avatar.getElementsByClassName("item-content")[0].innerHTML=M.length;}}},postBuildRendering:function A(){if(this._super){this._super();}var L=0;var M=this;while(M&&M.parent&&M.parent.data){L++;M=M.parent;}this.iconNode.style.marginLeft=L*18+"px";this.emptyIndicatorNode.style.marginLeft=L*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}if(!this.data.edit){this.editIconNode.style.display="none";}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.textNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:-5,content:this.tooltipContent});},selectThisNode:function(L){if(this.data.isFolder){this.listNode.className="mstrmojo-di-tree-node-folder selected";}else{this.listNode.className="mstrmojo-di-tree-node-file selected";}var M=this;while(M&&M.parent&&M.parent.data){M=M.parent;}if(M&&M.tree&&M.tree.scriptClass==="mstrmojo.DI.DITreeDnD"){M.tree.selectNode(this,L);}this.data.clickHandler.call(this,this);},selectThisNodeForDblClick:function(L){if(this.data.isFolder){this.listNode.className="mstrmojo-di-tree-node-folder selected";}else{this.listNode.className="mstrmojo-di-tree-node-file selected";}var M=this;while(M&&M.parent&&M.parent.data){M=M.parent;}if(M&&M.tree&&M.tree.scriptClass==="mstrmojo.DI.DITreeDnD"){M.tree.selectNode(this,L);}this.data.dblClickHandler.call(this,this);},onmouseover:function K(L){if(!(J)){J=mstrApp.getRootController();}if(!this.parent.sizeTooltip||!this.parent.folderSizeTooltip){return ;}if(!this.data.isMouseOver&&this.data.isFolder&&(this.totalSize===undefined)){this.data.isMouseOver=true;J.hadoopController.browseHadoopForFolderSize(L.src.data.address,this);}},onclick:function B(L){var M=mstrmojo.dom.eventTarget(L.hWin,L.e);mstrmojo.dom.stopPropogation(L.hWin,L.e);if(M!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.selectThisNode(L);}}else{this.data.editHandler(this);}},ondblclick:function B(L){var M=mstrmojo.dom.eventTarget(L.hWin,L.e);mstrmojo.dom.stopPropogation(L.hWin,L.e);if(M!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}this.selectThisNodeForDblClick(L);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.WidgetTreeBuilder","mstrmojo.TreeNodeSelector");var E=false;mstrmojo.WidgetTree=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.WidgetTree",listBuilder:mstrmojo.WidgetTreeBuilder,listSelector:mstrmojo.TreeNodeSelector,renderOnScroll:true,itemIdField:"dssid",itemDisplayField:"n",itemIconField:"tp",itemChildrenField:"items",itemFunction:function D(L,I,J){if(!E){mstrmojo.requiresCls("mstrmojo.TreeNode");E=true;}var H=J.tree||J,K=new mstrmojo.TreeNode({data:L,state:0,parent:J,tree:H,multiSelect:J.multiSelect,text:L[J.itemDisplayField],textCssClass:H.item2textCss(L),items:L[J.itemChildrenField],itemIdField:J.itemIdField,itemDisplayField:J.itemDisplayField,itemIconField:J.itemIconField,itemChildrenField:J.itemChildrenField,itemFunction:J.itemFunction,listSelector:J.listSelector});return K;},item2textCss:function B(H){return H[this.itemIconField];},selectionParentNode:null,init:function F(H){this._super(H);this.selectionParentNode=this;this.tree=this;},clearTreeSelect:function A(){(this.selectionParentNode||this).clearSelect();},prechange:function G(H){var I=this._super(H);this.onnodechange(H);return I;},onnodechange:function C(I){if(!I){return ;}var J=mstrmojo.hash,M=this.selectionParentNode,L=I.src;if(L===M){if(J.isEmpty(L.selectedIndices)){L=this;this.selectionParentNode=this;}this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:I.removed});}else{if(I.added&&I.added.length){var K=[];if(!J.isEmpty(M.selectedIndices)){K=mstrmojo.hash.keyarray(M.selectedIndices,true);M.clearSelect();}this.selectionParentNode=L;this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:K});}else{}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TreeNode");mstrmojo.DI.DITreeNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.DI.DITreeNode",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" mstrAttach:mousedown><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><span class="mstrmojo-di-tree-node-text {@textCssClass}"></span><span class="mstrmojo-di-ga-tree-node-edit-icon {@textCssClass}"></span><span class="mstrmojo-di-tree-node-desc {@textCssClass}"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},descNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);if(this.data.desc){var D=this.data.desc;D=mstrmojo.string.multiReplace(D,{"&#10;":" "});this.descNode.innerHTML=mstrmojo.string.encodeHtmlString(D);this.descNode.title=D;}}},clickHandler:null,editHandler:null,deselect:function B(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",isFolder:true,postBuildRendering:function A(){if(this._super){this._super();}var D=0;var E=this;while(E&&E.parent&&E.parent.data){D++;E=E.parent;}this.iconNode.style.marginLeft=D*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.iconFolderOpen:this.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}if(!this.data.edit){this.editIconNode.style.display="none";}},selectThisNode:function(D){this.listNode.className="mstrmojo-di-tree-node-file selected";var E=this;while(E&&E.parent&&E.parent.data){E=E.parent;}if(E&&E.tree&&E.tree.scriptClass==="mstrmojo.DI.DITree"){E.tree.selectNode(this,D);}this.data.clickHandler.call(this,this);},premousedown:function C(D){var E=mstrmojo.dom.eventTarget(D.hWin,D.e);mstrmojo.dom.stopPropogation(D.hWin,D.e);if(E!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.selectThisNode(D);}}else{this.data.editHandler(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.TreeNode","mstrmojo._IsExprNode","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo.expr","mstrmojo._HasOwnAvatar");var F=mstrmojo.array,M=mstrmojo.expr,P=mstrmojo.dom,A=mstrmojo.css;function J(R,Q){var U=R.data,S=U&&U.nds;if(!S){return null;}if(Q){Q.sort(F.numSorter);}else{Q=R.sortSelectedIndices();}if(!Q.length){return null;}return{idxs:Q,nds:F.get(S,Q)};}function N(S){var R=S.ctxtBuilder,V=R&&R.itemWidgets,Q=V&&V[0],U=Q&&Q.data;if(U&&U.not&&(V.length>0)){delete U.not;Q.paint();}}mstrmojo.AndOrNode=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._IsExprNode,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.AndOrNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},itemsContainerPrefix:function(){return this.domNode.childNodes[1];},itemsContainerNode:function(){return this.domNode.childNodes[2].firstChild;},dropCueNode:function(){return this.domNode.childNodes[2].lastChild;},itemsContainerSuffix:function(){return this.domNode.lastChild;},scrollboxNode:function(){return this.domNode;}},markupMethods:{onitemCntChange:function(){A.toggleClass(this.itemsContainerNode,["multi"],this.itemCnt>2);},onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();},ondropCuePosChange:mstrmojo.TreeNode.prototype.markupMethods.ondropCuePosChange},multiSelect:true,itemIdField:null,init:function(Q){this._super(Q);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());var R=this.data;if(R){delete this.data;this._set_data(null,R);}},itemCnt:0,postBuildRendering:function(){var Q;this.set("itemCnt",this.items.length);if(this._super){Q=this._super();}N(this);return Q;},preadd:function L(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},preremove:function O(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},_set_data:function(U,Q){var R=this.data,S=(R!==Q);if(S){this.data=Q;if(Q&&!Q.nds){Q.nds=[];}this.set("items",Q&&Q.nds);}return S;},isDragValid:function K(){return true;},isSelectableArea:function(Q){return false;},getDragData:function(Q){var S=this._super(Q);if(S&&!S.html){var R=S.et&&M.ET2TGT[S.et];S.html=R?S[R]&&S[R].n||"":S.n||"";}return S;},remove:function I(R,S){var Q=this._super(R);if(Q>-1){var U=S||this.suppressConsolidation;if(!U){this.consolidate(false);}}return Q;},move:function(R,Q){this.suppressConsolidation=true;var S;if(this._super){S=this._super(R,Q);}this.suppressConsolidation=false;return S;},consolidate:function E(){var V=this.parent;if(!V||!V.remove){return ;}var S=this.items,R=S&&S.length;if(R<2){var U=R?S[0]:null,Q=this.childIndex();if(U){V.add([U],Q);}V.remove(this.data);}},indent:function G(S,Q){var R=J(this,S);if(!R){return ;}this.remove(R.idxs,true);var X=R.nds,W=Q&&Q.fn||this.data&&this.data.fn,V={et:M.ET.ANDOR,nds:X,fn:W};if(X.length===2&&X[0].not){if(X[1].not){delete X[0].not;delete X[1].not;V.not=true;V.fn=(W===M.FN.AND?M.FN.OR:M.FN.AND);}else{var U=X[0];X[0]=X[1];X[1]=U;}}this.add([V],R.idxs[0]);this.consolidate(false);},outdent:function C(R){var S=this.parent,Q=S&&S.data;if(!Q||Q.et!==M.ET.ANDOR){return ;}var U=J(this,R);if(!U){return ;}this.remove(U.idxs,true);if(this.data.not){U.nds[0].not=true;}S.add(U.nds,this.childIndex());this.consolidate(false);},edit:function D(a,b,S){if(!a){return ;}var Z=this.data,Y=Z&&Z.fn,R=a.data,g=R&&R.not;if(!R){R={};a.data=R;}R.not=!!S;if(Y!==b){var Q=Z.nds;if(Q&&Q.length>2){var f=a.childIndex();if(f>0){this.indent([f-1,f],{fn:b});}}else{Z.fn=b;var W=this.ctxtBuilder,V=W&&W.itemWidgets;for(var U=0,X=(V&&V.length)||0;U<X;U++){var e=V[U];if(e){e.paint();}}}}else{a.paint();}},preclick:function H(Q){var S=null,R=P.eventTarget(Q.hWin,Q.e);if(R===this.prefixNode){}else{if(P.contains(this.prefixNode,R,true)){S="andor";}}Q.part=S;},createAvatar:function B(S){var R=document.createElement("div"),U=P.findWidget(S),Q=U.getAvatarNode&&U.getAvatarNode();if(!Q){Q=U.condNode.cloneNode(true);Q.style.boxSizing="border-box";Q.style.width=U.condNode.offsetWidth+"px";}R.appendChild(Q);A.addClass(R,U.avatarCssCls||"mstrmojo-FE mstrmojo-ConditionNode");R.style.zIndex=20;return R;},_ndsToMove:J});})();(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.DataRow","mstrmojo.css","mstrmojo.hash","mstrmojo.ui._HasScroller");var G=mstrmojo.array,C=2;function L(O){var P=[],N;G.forEach(O,function(Q){N=Q.subColumns;P=P.concat((N&&N.length>1)?N:Q);});return P;}function F(N){G.forEach(N._subHeaderWidgets_,function(O){O.destroy(true);});}function B(W){var S=this.columns,V=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],N=1,a=["<tr>"],b=0,O,R,U,Q,Z,Y,P,X='w="'+C+'"';this._headerWidgets=[];this._subHeaderWidgets=[];G.forEach(S,function(c){O=c.subColumns;if(O&&O.length>1){N=C;return false;}return true;});G.forEach(S,function(c){O=c.subColumns;R=O?O.length:0;if(R>1){U=1;Q=R;Y=0;}else{U=N;Q=1;Y=b++;}Z='rowspan="'+U+'" colspan="'+Q+'"';P=W.apply(this,[c,Y,Z]);V.push(P);if(R>1){G.forEach(O,function(d){P=W.apply(this,[d,b,"",this._subHeaderWidgets,X]);a.push(P);b++;},this);}},this);V.push("</tr>");a.push("</tr>");G.forEach(a,function(c){V.push(c);});V.push("</table>");this.headerHtml=V.join("");}function J(P,O){var N;O.apply(this);O.apply(this,["_subHeaderWidgets",C.toString()]);N=L(this.columns);this.titleColGroup=P.apply(this,[N]);}mstrmojo.DI.LevelDataGrid=mstrmojo.declare(mstrmojo.DataGrid,null,{scriptClass:"mstrmojo.DI.LevelDataGrid",renderHook:{pre:B,post:J},renderOnScroll:false,itemFunction:function D(P,N,O){return new mstrmojo.DI.LevelDataGridDataRow({columns:O.columns,data:P,idx:N,dataGrid:O});},refresh:function H(N){F(this);if(this._super){this._super(N);}},destroy:function K(N){F(this);this._super(N);},unrender:function I(N){G.forEach(this._subHeaderWidgets_,function(O){if(O&&O.hasRendered){O.unrender(true);}});this._super(N);},createColSizeArray:function A(){var S=this.headerContainerNode,V=S&&S.getElementsByTagName("table")[0],Q=V.rows[0].cells,N=V.rows[1]&&V.rows[1].cells,U=0,W=[],O,R,P;G.forEach(Q,function(X){O=X.getAttribute("colspan");O=O?parseInt(O,10):1;if(O===1){W.push(X.offsetWidth);}else{for(R=0;R<O;R++){P=N[U++];W.push(P.offsetWidth);}}});return W;},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;}});mstrmojo.DI.LevelDataGridDataRow=mstrmojo.declare(mstrmojo.DataRow,null,{scriptClass:"mstrmojo.DI.LevelDataGridDataRow",cssClass:"mstrmojo-DataRow",columns:null,init:function M(N){this._super(N);this.columns=L(this.columns);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(39,12539);var C=mstrmojo.DI.DIConstants,E=mstrmojo.DI.DIHelpers;function B(I){var G=(this.model.operationMode===C.operationMode.create),F=mstrApp.getRootController(),J=this.getSelectedItems(),H=this;this.urls=[];mstrmojo.array.forEach(J,function(L){var K=L.url;H.urls.push(K);});F.importURLEMMA(this,this.urls,G,!F.model.hasEMMAReportInstance(),this.id,true,I);}function D(F){var G=this.items.length;var I={},H;if(F){for(H=0;H<G;H++){I[H]=F;}}this.set("selectedIndices",I);}mstrmojo.DI.DISampleFiles=mstrmojo.declare(mstrmojo.DataGrid,null,{scriptClass:"mstrmojo.DI.DISampleFiles",cssClass:"mstrmojo-di-samplefiles",data:null,resizableColumns:false,multiSelect:true,selectionPolicy:"toggle",urls:[],visible:false,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",label:mstrmojo.desc(12539,"Sample File"),alias:"allSampleFiles",state:"unselect-all",preclick:function(){if(this.dataGrid.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");D.call(this.dataGrid,false);}else{this.set("state","select-all");D.call(this.dataGrid,true);}},onstateChange:function(){var F=mstrmojo.css;F.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);F.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);}}},{headerText:mstrmojo.desc(39,"Description"),colCss:"mstrmojo-di-samplefiles-col2",dataWidget:{scriptClass:"mstrmojo.Container",markupString:'<div class="mstrmojo-di-sampleitem-desc"><div class="sampleitem-desc-text""></div><div class="sampleitem-desc-downloadbtn"></div></div>',markupSlots:{textNode:function(){return this.domNode.children[0];},btnNode:function(){return this.domNode.children[1];}},children:[{scriptClass:"mstrmojo.Label",slot:"textNode",bindings:{text:"this.parent.data.desc"}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-di-download",slot:"btnNode",onclick:function(G){var F=this.parent.data.url;if(mstrApp.isSingleTier||E.isServerBasedWS()){window.FormWrapper.openPage(F);}else{mstrApp.openPage(F);}G.cancel();},premousedown:function(F){F.cancel();}}]}}],init:function(H){this._super(H);this.set("items",this.model.sampleFiles.file);var F=mstrApp.getRootController();F.sourceSelected(false);if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.url){var I,G=this.model.importSources[this.tableID].sourceInfo.url;for(I=0;I<this.items.length;I++){if(G===this.items[I].url||G===this.items[I].url.replace("https://","http://")){this.set("selectedIndex",I);break;}}this.set("multiSelect",false);}},onchange:function(){var H=mstrApp.getRootController();var J=this.getSelectedItems();if(J.length>0){H.sourceSelected(true);}else{H.sourceSelected(false);}if(this._headerWidgets_){var G=this._headerWidgets_[0];var I=this.items.length,F=J.length;if(F<=0){G.set("state","unselect-all");}else{if(F>=I){G.set("state","select-all");}else{G.set("state","select-some");}}}},onvisibleChange:function(){var F=mstrApp.getRootController();if(this.selectedIndex!==-1){F.sourceSelected(true);}else{F.sourceSelected(false);}},getFileUrl:function(F){var G;if(F<this.urls.length){G=this.urls[F];return G;}return"";},getFilesCnt:function(){return this.urls?this.urls.length:0;},getFileTableID:function(F){if(this.urls&&F<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[F]];}},onNextButtonClick:function(){B.call(this,this.tableID?C.actions.refreshData:C.actions.importSource);},onFinishButtonClick:function(){B.call(this,C.actions.savePublish);},onHelpButtonClick:function A(){return"importing_data_from_a_sample_file.htm";},onBackButtonClick:function(){var F=mstrApp.getRootController();F.showPage(C.pageType.dataSelection);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.locales","mstrmojo.date","mstrmojo.string");mstrmojo.requiresDescs(96,187,1442,9620,10216,10290,11119,12907);mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog",cssClass:"mstrmojo-di-refreshHistory",title:mstrmojo.desc(10216,"Refresh History"),zIndex:999,subsStatus:[],onOK:mstrmojo.emptyFn,onOpen:function(){this.grid.set("items",this.subsStatus||[]);this.set("detailMsg","");this.grid.set("selectedIndex",-1);this.grid.set("selectedIndex",0);},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refreshHistory-title",text:mstrmojo.desc(12907,"Status for the last 5 scheduled refreshes:")},{alias:"grid",scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-refreshHistory-grid",onchange:function(){var B="";var A=this.selectedIndex;if(A>=0&&this.items.length>0){B=this.items[A].en!==0?this.items[A].emsg:mstrmojo.desc(11119,"The scheduled data refresh was successful.");}this.parent.set("detailMsg",B);},columns:[{headerText:mstrmojo.desc(9620,"Timestamp"),headerCss:"grid-header timestamp",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{text:function(){var C=mstrmojo.date;var D=mstrmojo.locales;var B=C.getDateJson(this.data.timestamp);var A=C.formatDateInfo(B,D.datetime.DATEDISPLAYFORMAT);var E=C.formatTimeInfo(B,D.datetime.TIMEDISPLAYFORMAT);return A+" "+E;},cssClass:function(){var A="grid-col timestamp ";if(this.data.en!==0){A+="error";}return A;}}}},{headerText:mstrmojo.desc(187,"Status"),headerCss:"grid-header status",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{cssClass:function(){var A="grid-col status ";if(this.data.en!==0){A+="error";}return A;}}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-refreshHistory-detail",bindings:{text:"this.parent.detailMsg"}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var A=this.parent;if(typeof A.onOK==="function"){A.onOK();}A.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.DataGrid");mstrmojo.requiresDescs(14615,1442,8684,12381,16212,12403,12404);var C=mstrmojo.desc;mstrmojo.qb.es.AlternateSourceDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.es.AlternateSourceDialog",cssClass:"mstrmojo-qb-ValidateAlternateSource-dialog",title:C(8684,"Error"),items:null,onOpen:function A(){var I=this.table,E=[],D,G=[C(14615,"Match Status"),C(12403,"Original Table"),C(12404,"New Table")],K,F=this.items.length;MATCH_RESULT_COLUMN=0;function H(P,R,N){var O=[P[1],P[0],P[2]],Q=this.dataField,M=O[Q],L;if(parseInt(Q,10)===MATCH_RESULT_COLUMN){if(M<0){L="";}else{L=M?'<div class="matched-item"></div>':'<div class="unmatched-item"></div>';}}else{L=M;}return L;}for(D=0;D<G.length;D++){K={headerText:G[D],colWidth:(D===MATCH_RESULT_COLUMN)?"120":"247",dataFunction:H,dataField:D.toString()};E.push(K);}for(D=0;D<9-F;D++){var J={0:"",1:-1,2:""};J.prototype=this.items[0];this.items.push(J);}I.set("columns",E);I.set("items",this.items);I.parent&&I.parent.positionDialog&&I.parent.positionDialog();},children:[{scriptClass:"mstrmojo.Label",cssClass:"validation-note1",text:C(16212,"The selected table cannot serve as an alternate source due to the below mismatches. Please select an alternate table.")},{scriptClass:"mstrmojo.DataGrid",alias:"table",cssClass:"validation-table",resizableColumns:false,columns:[]},{scriptClass:"mstrmojo.Label",cssClass:"validation-note2",text:C(12381,"Note: The column names and the data types have to match between the currently uploaded table and the original table for relational sources.")},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Button mstrmojo-WebButton hot",onclick:function(){var D=this.parent.parent;D.close();}}]}],postBuildRendering:function B(){if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.PopupConfig","mstrmojo.ui.menus.MenuEditor");mstrmojo.ui.menus.EditorConfig=mstrmojo.declare(mstrmojo.ui.menus.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.EditorConfig",data:null,fnOk:null,fnCancel:null,okEnabled:true,cancelEnabled:true,okVisible:true,cancelVisible:true,init:function D(E){this._super(E);if(this.data&&!mstrmojo.all[this.data.id]){mstrmojo.hash.make(this.data,mstrmojo.Obj);}this.initBindings();},clear:function A(){this._super();this.data=null;this.fnOk=this.fnCancel=mstrmojo.emptyFn;},newInstance:function C(){return new mstrmojo.ui.menus.MenuEditor({popupConfig:this});},destroy:function B(){if(this.data){this.data.destroy();}this.destroyBindings();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.DI.DIConstants","mstrmojo.string","mstrmojo.Button","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(118,221,2148,13325,15051,15052,15053,15054,15055,15056,15057,15058,15059,15060,15088,15089,15851);var e=mstrmojo.DI.DIConstants,W=e.hierarchyOptions,R=e.rdcsFlag;var Q=mstrmojo.array,L=mstrmojo.desc,a=mstrmojo.Button.newWebButton,D=mstrmojo.string,Y=mstrmojo.DI.DIHelpers;var A=mstrmojo.warehouse.EnumObjectTypes,U=A.TABLE,V=12,C=4,X=0;var H={OK:0,DISTANCE_NOT_INT:1,LINKED_TO_RELATIONAL_TABLE:2,};function c(j,l,g){var h=this.model;var m=h.findMappingItem(j);var k;for(k=0;k<m.length;k++){if(m[k].tableId===j.tableId){m[k].alias=l;m[k].linkObjID="";if(m[k].tp===V){m[k].formID="";m[k].oid="";}m[k].lv=0;}}if(!g){this.changeEMMAMappings();}}function O(g,k,j,h){return{scriptClass:"mstrmojo.HBox",alias:g,cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-roleAttributeLine",children:[{scriptClass:"mstrmojo.Label",text:k},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-IDPulldown",alias:j,value:mstrmojo.desc(15328,"Select a column"),popupToBody:true,itemField:"n",itemIdField:"id",visible:true,enabled:false,bindings:{popupZIndex:"this.parent.parent.parent.parent.zIndex"},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}},postselectedIndexChange:function(t){var m=this.parent.parent.parent.parent;var o=t.value,u=t.valueWas,AE;if(m.hierarchyMaps===null){var AJ={};m.set("hierarchyMaps",AJ);}if(o!==u){if(m.relationAttributes.length===t.src.items.length){AE=m.relationAttributes[o];}else{var l=Q.find(m.relationAttributes,"did",t.src.items[o].id);AE=m.relationAttributes[l];}m.hierarchyMaps[h]=AE;}var q=["IDAttributeContainer","JoinIDAttributeContainer","FilterIDAttributeContainer","DistanceAttributeContainer"],w=["IDAttributePullDown","JoinIDAttributePullDown","FilterIDAttributePullDown","DistanceAttributePullDown"],p=this.parent.parent,AH=false,AB,z,AA,x,AG,AF,AD,AC;for(AB=0;AB<4;AB++){this.parent.parent[q[AB]][w[AB]+"Warning"].domNode.style.display="none";}var n=w.indexOf(t.src.alias);for(AB=n;AB!==n+1;AB++){AB=AB%4;AA=q[AB];AG=w[AB];AD=p[AA][AG].getSelectedItem();if(typeof AD==="undefined"){continue;}for(z=0;z<4;z++){if(AB===z){continue;}x=q[z];AF=w[z];AC=p[x][AF].getSelectedItem();if(typeof AC!=="undefined"&&AD.id===AC.id){var AI=mstrmojo.dom.position(this.parent[AG].domNode);this.parent[AG+"Warning"].domNode.textContent="'"+AD.n+"' has been taken";this.parent[AG+"Warning"].domNode.style.display="block";this.parent[AG+"Warning"].domNode.style.position="fixed";this.parent[AG+"Warning"].domNode.style.left=AI.x-10+"px";this.parent[AG+"Warning"].domNode.style.top=AI.y+20+4+"px";S(m,{hasEmptyForm:true});AH=true;}}}if(!AH){G(m);}}},{scriptClass:"mstrmojo.Label",cssClass:"pulldownWarning",alias:j+"Warning",cssDisplay:"none",text:""}]};}function f(t,l){t.set("relationTableId",l);var z=t.tables;var k=z[l];t.set("relationAttributes",k.attributes);var q=t.boxContainer.roleAttributeContainer;var j=q.IDAttributeContainer.IDAttributePullDown;var w=q.JoinIDAttributeContainer.JoinIDAttributePullDown;var m=q.FilterIDAttributeContainer.FilterIDAttributePullDown;var h=q.DistanceAttributeContainer.DistanceAttributePullDown;var g=[j,w,m,h];var u=[],AA,n=t.relationAttributes;Q.forEach(n,function(AB){if(I(AB,t.hierarchyOption)){AA={};AA[j.itemIdField]=AB.did;AA[j.itemField]=AB.alias;u.push(AA);}});Q.forEach(g,function(AB){AB.set("enabled",true);AB.set("items",u);});if(t.hierarchyOption===e.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){if(t.tableId===l){var p=Q.find(j.items,j.itemIdField,t.attribute.did);j.set("selectedIndex",p);j.set("enabled",false);}else{if(t.attribute.isLinked){var x=t.attribute.alias;var o=Q.find(j.items,j.itemField,x);if(o>=0){j.set("selectedIndex",o);j.set("enabled",false);}}}}G(t);}function N(g){switch(g){case W.CREATE_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15051,"Create Hierarchy Attribute");case W.EDIT_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15052,"Edit Hierarchy Attribute");case W.RESET_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15053,"Reset Hierarchy Attribute");default:return"";}}function S(g,j){var k=g.btnHbox.save;var l=!j.hasEmptyForm;var h;k.set("enabled",l);if(l){k.title="";return ;}else{}}function G(j){var l=j.hierarchyMaps,h=!l,k,g;if(!h){for(g in R){if(!l[R[g]]){h=true;break;}}}k={hasEmptyForm:h};S(j,k);return k;}function F(j){var h=mstrApp.getRootController(),g=h.getModel(),k=j.relationTableId;var l={success:function(n){var m=e.requestFlag.mapping|e.requestFlag.sourceInfo|e.requestFlag.relationship;if(j.hierarchyOption!==W.CREATE_HIERARCHY_ATTRIBUTE){h.getImportedDataEMMA(e.actions.none,m);}else{h.getImportedDataEMMA(e.actions.none,m,null,null,null,null,{success:function(){var o=g.getImportSource(k),p=false;Q.forEach(o.currentMapping,function(t){var q;if(t.selected&&t.tp===12&&t.isLinked&&!t.recursive){q=t.alias+" - "+o.sourceInfo.name;q=g.getUniqueAlias(12,q);c.call(h,t,D.encodeXMLAttribute(q),true);p=true;}});if(p){h.changeEMMAMappings();}}});}j.destroy();},failure:function(m){h.displayError(m.message);}};if(j.tableIds&&j.tableIds.length){M(j,j.hierarchyOption,j.isLinked,j.tableId,j.attribute,j.relationTableId,j.hierarchyMaps,l);}}function M(j,h,m,l,k,g,n,o){switch(h){case W.CREATE_HIERARCHY_ATTRIBUTE:K(j,m,l,k,g,n,o);break;case W.EDIT_HIERARCHY_ATTRIBUTE:K(j,m,l,k,g,n,o);break;case W.RESET_HIERARCHY_ATTRIBUTE:B(j,m,l,k,g,n,o);break;}}function K(h,l,k,j,g,m,n){if(l){P(h,g,null,m,n);}else{if(k===g){P(h,g,null,m,n);}else{h.hierarchyMaps[R.ID].n=j.n;P(h,g,j.oid,m,n);}}}function B(o,p,m,l,j,h,u){if(!p){P(o,m,l.did,h,u,true,l.n);}else{var n=mstrApp.getRootController(),g=n.model.importSources,q,k,t;for(q in g){if(g.hasOwnProperty(q)){Q.forEach(g[q].currentMapping,function(x,z,w){if(x.isLinked&&x.recursive&&x.id===l.id&&x.rdcs.length>0){k=x.tableId;t=x.did;return false;}});}}if(k&&t){P(o,k,t,h,u,true,l.n);}else{n.displayError(mstrmojo.desc(999999,"cannot find the corresponding table and attribute."));}}}function P(p,h,k,g,t,o,j){o=o||false;var l={tbid:h,mapping:!o?Y.getHierarchyMappingXML(k,g):E(k,j)};var m=mstrApp.getRootController();var q={success:function(u){if(u&&u.msgid){m.dataService.set("messageID",u.msgid);}var n=m.model;var w=n.getImportSource(h);w.invalidPreview();if(w.canAutoMappingAndDetectRelation()){m.dataService.detectRelationshipSourceTable(t||b(),{did:h});}else{if(t&&t.success){t.success(u);}else{b().success(u);}}},failure:function(n){m.displayError(n.message);}};m.dataService.changeMappingSourceTable(q,l);}function b(){return{success:function(j){var h=mstrApp.getRootController();h.dataService.set("messageID",j.msgid);var g=e.requestFlag.mapping|e.requestFlag.sourceInfo|e.requestFlag.relationship;h.getImportedDataEMMA(e.actions.none,g);},failure:function(g){controller.displayError(g.message);}};}function E(g,h){return'<mpcs><mpc did="'+g+'" drvflg="0" n="'+h+'" ot="12" recurisve="0" ></mpc></mpcs>';}function d(j){if(j&&j.currentMapping&&j.currentMapping.length>0){var g,h;for(g in j.currentMapping){h=j.currentMapping[g];if(h.recursive&&h.rdcs.length>0){return true;}}}return false;}function J(j){if(j&&j.currentMapping&&j.currentMapping.length>0){var g,h;for(g in j.currentMapping){h=j.currentMapping[g];if(h.recursive&&h.rdcs.length===0){return true;}}}return false;}function I(h,g){return !(h.isMultiForm||h.ipa===1||(h.recursive&&g===e.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE));}function Z(l){var h=mstrApp.getRootController().getModel().importSources,q,g,p,o=l.roleAttributeContainer.IDAttributeContainer.IDAttributePullDown.getSelectedItem().n,n=l.roleAttributeContainer.DistanceAttributeContainer.DistanceAttributePullDown.getSelectedItem().id,t=l.hierarchyTableContainer.tablesPullDown.getSelectedItem().id,m=h[t],k,j;k=Q.find(m.currentMapping,"did",n);if(k>=0){j=m.currentMapping[k];if(!(j.ctp&&j.ctp===e.columnDataTypes.integer)){return H.DISTANCE_NOT_INT;}}for(q in h){if(!h.hasOwnProperty(q)||q===t){continue;}g=h[q];p=Q.find(g.currentMapping,"alias",o);if(p>=0&&d(g)){return H.LINKED_TO_RELATIONAL_TABLE;}}return H.OK;}mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog",title:"",hierarchyOption:null,tables:null,tableIds:null,relationTableId:null,tableId:null,relationAttributes:null,attribute:null,hierarchyMaps:null,isLinked:null,onOpen:function(){var AF=mstrApp.getRootController(),j=AF.model.importSources,AI,u={},t=[],m,w,AH,n=this.attribute.columnId;for(AI in j){if(j.hasOwnProperty(AI)){AH=j[AI];if(!((AH.type===e.sourceType.file&&AH.subtype!==e.sourceSubtype.samplefile&&AH.subtype!==e.sourceSubtype.clipboard&&AH.subtype!==e.sourceSubtype.publicData&&AH.subtype!==e.sourceSubtype.cloudElement&&(AH.xdaType===e.xdaType.excel||AH.xdaType===e.xdaType.text))||(AH.type===e.sourceType.querybuilder&&AH.subtype===e.sourceSubtype.querybuilder&&AH.xdaType===e.xdaType.qbSingleTable))){continue;}if(this.hierarchyOption===e.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE&&(d(AH)||J(AH))){continue;}m=AH.currentMapping;if(this.hierarchyOption===e.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){w=Q.filter(m,function(k){return k.tp===V;});}else{w=Q.filter(m,function(k){return k.tp===X||k.tp===V;});}u[AI]={id:AH.tableID,did:AH.tableID,n:AH.sourceInfo.name,tp:U,attributes:w};t.push(AH.tableID);}}G(this);this.set("tables",u);this.set("tableIds",t);this.set("title",N(this.hierarchyOption));this.set("isLinked",this.attribute.isLinked);var AP=this.boxContainer.hierarchyTableContainer;var q=AP.tablesPullDown;if(this.tableIds.length>0){var AE=[],AN,AL="";Q.forEach(t,function(k){AL=u[k];AN={};AN[q.itemIdField]=AL.id;AN[q.itemField]=AL.n;AE.push(AN);});q.set("items",AE);}else{q.set("value",mstrmojo.desc(15851,"Not available"));}if(this.hierarchyOption===e.hierarchyOptions.EDIT_HIERARCHY_ATTRIBUTE){var AG,p,AJ,h,o;var AB=this.attribute.tableId;AG=Q.find(q.items,q.itemIdField,AB);q.set("selectedIndex",AG);var AD=this.attribute.rdcs;var g=this.attribute.oid;var AA;for(AA in j){if(j.hasOwnProperty(AA)){var l=Q.find(j[AA].currentMapping,"oid",g);if(l>=0&&j[AA].currentMapping[l].recursive&&j[AA].currentMapping[l].isLinked&&j[AA].currentMapping[l].rdcs.length>0){if(AD.length===0){n=j[AA].currentMapping[l].did;AD=j[AA].currentMapping[l].rdcs;AB=j[AA].tableID;AG=Q.find(q.items,q.itemIdField,AB);q.set("selectedIndex",AG);break;}}}}var AM=this.boxContainer.roleAttributeContainer;var AO=AM.IDAttributeContainer.IDAttributePullDown;var z=AM.JoinIDAttributeContainer.JoinIDAttributePullDown;var AC=AM.FilterIDAttributeContainer.FilterIDAttributePullDown;var AK=AM.DistanceAttributeContainer.DistanceAttributePullDown;p=Q.find(AO.items,AO.itemIdField,n);AJ=Q.find(z.items,z.itemIdField,AD[0].did);h=Q.find(AC.items,AC.itemIdField,AD[1].did);o=Q.find(AK.items,AK.itemIdField,AD[2].did);AO.set("selectedIndex",p);z.set("selectedIndex",AJ);AC.set("selectedIndex",h);AK.set("selectedIndex",o);q.set("enabled",false);AO.set("enabled",false);}},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"save",enabled:false,onclick:function(){var g=this.parent.parent;mstrmojo.confirm(L(null,"Except the hierarchy attribute, other attributes or metrics will not be imported after clicking 'Finish' or 'Save', but you can find them in 'Show All Columns'"),{},{title:L(null,"Not Importing Attributes and Metrics"),buttons:[a(L(1442,"OK"),function(){var h=Z(g.boxContainer);switch(h){case H.OK:F(g);g.close();break;case H.LINKED_TO_RELATIONAL_TABLE:mstrApp.getRootController().displayError(mstrmojo.desc(15113,"The ID is linked with an attribute, which is in a relational table, so we cannot create the Hierarchy Table."));break;case H.DISTANCE_NOT_INT:mstrApp.getRootController().displayError(mstrmojo.desc(15114,"The Distance attribute datatype should be integer."));break;}},true),a(L(221,"Cancel"))]});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var g=this.parent.parent;g.close();g.destroy();}}],children:[{scriptClass:"mstrmojo.VBox",alias:"boxContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-boxContainer",children:[{scriptClass:"mstrmojo.HBox",alias:"hierarchyTableContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-hierarchyTableContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-hierarchy-tableName",text:mstrmojo.desc(15054,"Hierarchy Table")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-tablePulldown",alias:"tablesPullDown",value:mstrmojo.desc(15327,"Select a Hierarchy Table"),popupToBody:true,itemField:"n",itemIdField:"id",visible:true,bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},useRichTooltip:true,updateTooltipConfig:function(){var g=mstrmojo.dom.position(this.domNode);var h="";if(!this.enabled){h=mstrmojo.desc(15092,"Hierarchy table can not be changed");}this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPRIGHT,content:h,top:g.y-35,left:g.x+198};},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}},postselectedIndexChange:function(g){var j=this.parent.parent.parent;var l=g.value,h=g.valueWas,k;if(l!==h){k=j.tableIds[l];f(j,k);}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeaderContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-role",text:mstrmojo.desc(15056,"Role")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Search-infoIcon mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-infoIcon",alias:"infoIcon",onclick:function(){}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-attribute",text:mstrmojo.desc(2148,"Attribute")}]},{scriptClass:"mstrmojo.VBox",alias:"roleAttributeContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-roleAttributeContainer",children:[O("IDAttributeContainer",mstrmojo.desc(15057,"ID"),"IDAttributePullDown",R.ID),O("JoinIDAttributeContainer",mstrmojo.desc(15059,"JoinID"),"JoinIDAttributePullDown",R.JOIN_ID),O("FilterIDAttributeContainer",mstrmojo.desc(15060,"FilterID"),"FilterIDAttributePullDown",R.FILTER_ID),O("DistanceAttributeContainer",mstrmojo.desc(13325,"Distance"),"DistanceAttributePullDown",R.DISTANCE)]}]}],});mstrmojo.DI.ui.dialogs.DIHierarchyAttributeResetDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog",title:"",hierarchyOption:null,tables:null,tableIds:null,relationTableId:null,tableId:null,relationAttributes:null,attribute:null,hierarchyMaps:null,isLinked:null,onOpen:function(){var g=mstrApp.getRootController(),l=g.model.importSources,j,m={},o=[],p,h;for(j in l){if(l.hasOwnProperty(j)){var n=l[j];p=n.currentMapping;if(this.hierarchyOption===e.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){h=Q.filter(p,function(k){return k.tp===V;});}else{h=Q.filter(p,function(k){return k.tp===X||k.tp===V;});}m[j]={id:n.tableID,did:n.tableID,n:n.sourceInfo.name,tp:U,attributes:h};o.push(n.tableID);}}this.set("tables",m);this.set("tableIds",o);this.set("title",N(this.hierarchyOption));this.set("isLinked",this.attribute.isLinked);},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1905,"Reset"),onclick:function(){var g=this.parent.parent;F(g);g.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Cancel hot",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var g=this.parent.parent;g.close();g.destroy();}}],children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Container",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-icon",text:""},{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Container",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-warning",text:mstrmojo.desc(15088,"Do you want to reset hierarchy attribute")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-warning-info",text:mstrmojo.desc(15089,"After resetting hierarchy attribute, it will turn back to a normal attribute.")}]}]}],});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Box","mstrmojo.ui.CheckListWithDesc","mstrmojo.hash","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(212,221,1442,1911,12389,12999,15035,15036,15324,15325,15326,16055,16056);var G=mstrmojo.array,F=mstrmojo.hash,E=mstrmojo.desc;mstrmojo.DI.DIPartitionGroupDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIPartitionGroupDialog",cssClass:"mstrmojo-di-partitiongroup-dialog",title:mstrmojo.desc(16055,"Group Tables"),groups:null,callback:null,zIndex:1000,isEditMode:false,onOpen:function A(){var H=this.groups,I=[];G.forEach(H,function(K,J){I.push({n:E(1911,"Group"),desc:K.tableNames.join("\n"),index:J,});});this.contentBox.content.set("items",I);this.contentBox.content.set("multiSelect",!this.isEditMode);if(!this.isEditMode){this.contentBox.content.set("selectedIndices",G.map(I,function(J){return J.index;}));}},onPreClose:function C(){this.onCancel();return true;},onCancel:function D(){var H=this.callback;if(H&&H.onCancel){H.onCancel();}},children:[{scriptClass:"mstrmojo.Label",alias:"webTitle2",cssClass:"webTitle2",text:E(16056,"The grouped tables have the same set of objects, please select the tables you want to group.")},{scriptClass:"mstrmojo.Box",cssClass:"partition-items",alias:"contentBox",children:[{scriptClass:"mstrmojo.ui.CheckListWithDesc",alias:"content",orientation:"v",}]}],buttons:[{scriptClass:"mstrmojo.Button",alias:"okButton",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:E(212,"Continue"),bindings:{enabled:function(){if(!this.parent.parent.isEditMode){return true;}var H=this.parent.parent.contentBox.content.selectedIndices;if(H&&Object.keys(H).length>0){return true;}return false;}},onclick:function B(){var K=this.parent.parent,L,H,N=[];L=K.contentBox.content.selectedIndices;for(var J=K.groups.length-1;J>=0;J--){if(!L[J]){H=K.groups.splice(J,1);N=N.concat(H[0].tableIds);}}if(K.groups.length>0){if(K.isEditMode){var M=N.join(","),I=mstrApp.getRootController().model,O;O={success:function(){mstrApp.getRootController().partitionController.setPartition(I.editingTableId,K.groups[0].tableIds,K.callback);},failure:function(){K.callback.onCancel();}};mstrApp.getRootController().dataService.removeEMMASourceTable(O,{did:M});}else{mstrApp.getRootController().partitionController.addMultiPartitions(K.groups,K.callback);}}else{if(K.callback&&K.callback.onCancel){K.callback.onCancel();}}K.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.array");mstrmojo.requiresDescs(15677,15678,15679,15681,15682,15683,15684);var C=mstrmojo.Button.newWebButton,B={discard:0,open:2,closed:4};mstrmojo.vi.ui.editors.PromptOptionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.PromptOptionEditor",cssClass:"mstrmojo-PromptOptionEditor-Editor",title:mstrmojo.desc(15681,"Change Prompt Option and Save"),help:null,optVal:B.open,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon-box"},{scriptClass:"mstrmojo.Box",alias:"box",children:[{scriptClass:"mstrmojo.Label",cssClass:"prompt-confirm",text:mstrmojo.desc(15682,"We have detected that this dossier contains prompts. Please confirm your prompt option.")},{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",col1Width:"20%",col2Width:"80%",cssClass:"chkBox",alias:"chkBox",children:[{scriptClass:"mstrmojo.ui.Checkbox",cssDisplay:"inline-block",slot:"col1Node",alias:"chk",oncheckedChange:function D(){var G=this.parent.parent,F=G.optPrompt,H=G.defaultLabel;F.set("visible",this.checked);H.set("visible",!this.checked);}},{scriptClass:"mstrmojo.Label",slot:"col2Node",text:mstrmojo.desc(15677,"Display prompt when opening this dossier")}]},{scriptClass:"mstrmojo.ui.CheckList",alias:"optPrompt",multiSelect:false,orientation:"v",selectedIndex:0,items:[{n:mstrmojo.desc(15678,"And use current answers as default answers"),v:B.open},{n:mstrmojo.desc(15679,"And discard current answers"),v:B.discard}]},{scriptClass:"mstrmojo.Label",alias:"defaultLabel",cssClass:"indent",text:mstrmojo.desc(15683,"It will use current answer as default answer")}]},{alias:"buttonBar",scriptClass:"mstrmojo.Box",slot:"buttonNode",children:[C(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.close();}),C(mstrmojo.desc(15684,"Confirm and Save"),function(){var G=this.parent.parent,H=G.box,F=H.chkBox.chk;G.optVal=F.checked?(H.optPrompt.selectedIndex===0?B.open:B.discard):B.closed;G.onSave();G.close();},true)]}],onOpen:function A(){var G=this.box,F=G.chkBox.chk,I=G.optPrompt,H=G.defaultLabel;F.set("checked",this.optVal!==B.closed);I.set("visible",F.checked);I.set("selectedIndex",this.optVal===B.discard?1:0);H.set("visible",!F.checked);H.set("enabled",false);},onSave:mstrmojo.emptyFn,onClose:function E(){this.destroy();}});mstrmojo.vi.ui.editors.PromptOptionEditor.OptValue=B;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.Button","mstrmojo.Editor");mstrmojo.requiresDescs(221);var G=mstrmojo.warehouse.EnumDataChangeEvents,D=mstrmojo.css;mstrmojo.warehouse.ui.WaitBoxTip=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.warehouse.ui.WaitBoxTip",cssClass:"mstrmojo-WaitBoxTip",visible:false,draggable:false,showTitle:false,zIndex:9997,displayMsg:null,position:null,cancelCallback:null,extraCls:undefined,width:null,isHostedWithin:false,adjustCorners:null,children:[{scriptClass:"mstrmojo.Box",cssClass:"waitBoxTip-icon",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"waitBoxTip-msg",alias:"msgfield"},{scriptClass:"mstrmojo.Label",cssClass:"waitBoxTip-cancel",alias:"cancelBtn",text:mstrmojo.desc(221,"Cancel")}],postBuildRendering:function E(){var K=this._super();var J=mstrmojo.all.WaitBoxTip;J.closeWait();if(!J.isHostedWithin){var I=J.parentDomNode=document.body;J.domNode&&I.appendChild(J.domNode);}mstrmojo.dom.attachEvent(window,"resize",function(){if(J&&J.adjustCorners){J.adjustCorners();}});return K;},ondisplayMsgChange:function F(){var I=10,J=this.displayMsg.length>I?"":this.displayMsg;this.msgfield.set("text",J);},onwidthChange:function B(){if(this.domNode){this.domNode.firstElementChild.style.width=this.width;}},onpositionChange:function C(){this.set("left",this.position.left);this.set("top",this.position.top);},showWait:function A(I){this.cancelCallback=I.cancelCallback;this.cancelBtn.set("visible",!!(I&&I.showCancel));this.cancelBtn.onclick=function(){if(this.parent.cancelCallback){this.parent.cancelCallback();}this.parent.closeWait();};if(I&&I.position){this.set("position",I.position);}if(I&&I.extraCls){if(this.domNode){D.addClass(this.domNode.firstElementChild,I.extraCls);}else{this.cssClass+=" "+I.extraCls;}}else{if(this.domNode){D.removeClass(this.domNode.firstElementChild,"extraCls-.*?");}}this.set("displayMsg",(I&&I.message)||mstrmojo.desc(11960,"Loading Data..."));this.open();if(I&&I.width){this.set("width",I.width);this.onwidthChange();}return this;},closeWait:function H(){this.close();}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.Label","mstrmojo.Button","mstrmojo.Editor","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(7778,14937,14938,14939,7778,14940,4453,14966,12309,12310,14961,14942,12313,14943,2707,7776,14944,14945,14946,14941,702,629,221,118,14936,14956,14957,14958,14963,15852,15853);var O=mstrmojo.hash,J=mstrmojo.array,R=mstrmojo.css,P=mstrmojo.DI.DIHelpers;var U=0,V=1,B=2,E=0,C=1;var S=[{did:U,n:mstrmojo.desc(14937,"Local")},{did:V,n:mstrmojo.desc(14938,"Standalone")},{did:B,n:mstrmojo.desc(14939,"Yarn")}];var Q=[{did:E,n:mstrmojo.desc(7778,"Anonymous")},{did:C,n:mstrmojo.desc(14940,"Shared Kerberos")}];function K(X){var W;W=X.trim().split("");for(var Y=0;Y<W.length;Y++){if(W[Y]==="#"||W[Y]==="?"||W[Y]==="/"||W[Y]===";"||W[Y]==="."||W[Y]==="+"||W[Y]==="%"||W[Y]==="&"||W[Y]==="="){return false;}}return true;}function G(X){var W=X;if(!mstrmojo.num.isNumeric(X)){W=W.trim();}if(W===null||W===""){return true;}else{return false;}}function F(X){var W=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return W.test(X);}function D(W){var X=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/;return X.test(W);}function I(W){return encodeURI(W);}function L(Z){if(Z===undefined||Z===null){return true;}else{var Y=Z.split("\n");for(var X=0;X<Y.length;X++){if(Y[X].trim()!==""){var W=(Y[X].trim()).split("=");if(W.length!==2){mstrmojo.alert("Invalid input for Optional field. Please enter the Optional in format:\nkey1=value1\nkey2=value2\n...");return false;}}}}return true;}function A(b,X){var Z=["AuthMode","Mode","spark.executor.cores","spark.driver.memory","spark.executor.memory","spark.master","spark.yarn.jar"],a;for(a in X.sparkConfig.props){if(Z.indexOf(a)<0){X.sparkConfig.props[a]=undefined;}}for(var Y in b){if(Y!=="sparkConfig"){X[Y]=b[Y];}}for(var W in b.sparkConfig.props){X.sparkConfig.props[W]=b.sparkConfig.props[W];}if(X.sparkConfig.props.hasOwnProperty("spark.yarn.jar")){X.sparkConfig.props["spark.master"]="yarn-client";}return X;}function N(W){var X=W.sparkConfig.props.Mode;var Y=true;if(W.name===undefined||G(W.name)){mstrmojo.alert("The Name cannot be empty");return false;}if(!K(W.name)){mstrmojo.alert("There are illegal character in name");return false;}if(W.namenodeAddr===undefined||G(W.namenodeAddr)){mstrmojo.alert("The Hadoop Name Node cannot be empty");return false;}if(W.hdfsRpcPort===undefined||G(W.hdfsRpcPort)){mstrmojo.alert("The HDFS Port cannot be empty");return false;}if(W.hdfsRpcPort!==undefined&&!mstrmojo.num.isNumeric(W.hdfsRpcPort)){mstrmojo.alert("The HDFS Port must be a number");return false;}if(W.hdfsHttpPort===undefined||G(W.hdfsHttpPort)){mstrmojo.alert("The WebHDFS Port cannot be empty");return false;}if(W.hdfsHttpPort!==undefined&&!mstrmojo.num.isNumeric(W.hdfsHttpPort)){mstrmojo.alert("The WebHDFS Port must be a number");return false;}if(W.hostAddr===undefined||G(W.hostAddr)){mstrmojo.alert("The Host Port cannot be empty");return false;}if(W.tcpPort===undefined||G(W.tcpPort)){mstrmojo.alert("The Port cannot be empty");return false;}if(W.tcpPort!==undefined&&!mstrmojo.num.isNumeric(W.tcpPort)){mstrmojo.alert("The Port  must be a number");return false;}return true;}function H(X,a){var Y=this,Z,W;W={scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:X},a]};Z=Y.addChildren([W])[0];return Z.children[1];}function M(a,X){var Y=this,Z,W;W=[{scriptClass:"mstrmojo.Label",cssClass:"section-header",text:a,onclick:X||mstrmojo.emptyFn},{scriptClass:"mstrmojo.Box",cssClass:"section-box"}];Z=Y.addChildren(W)[1];return Z;}mstrmojo.DI.ui.dialogs.DIHadoopGatewayDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHadoopGatewayDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayDialog",title:mstrmojo.desc(14956,"Hadoop Gateway"),afterSave:mstrmojo.emptyFn,data:null,option:null,postBuildRendering:function(){if(this._super){this._super();}if(P.isServerBasedWS()){R.addClass(this.containerNode,"scrollable");}},onClose:function(){this.afterSave();},onOpen:function(){var a=this,d,Z,W=!a.data,b,c,X;var Y={"spark.serialize":"org.apache.spark.serializer.KryoSerializer"};d=a.data=a.data||{config:{sparkConfig:{props:{}}}};Z=a.dirtyData={remoteDir:d&&d.config&&d.config.remoteDir||"/opt"};a.set("isNew",W);Z.sparkConfig={props:{}};H.call(a,mstrmojo.desc(4453,"Name:"),{scriptClass:"mstrmojo.TextBox",enabled:W,value:d&&d.config.name||"",onvalueChange:function(){Z.name=this.value;}});b=M.call(a,mstrmojo.desc(14961,"Hadoop Properties"));H.call(b,mstrmojo.desc(14966,"Hadoop NameNode:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.namenodeAddr||"",onvalueChange:function(){Z.namenodeAddr=this.value;}});b.addChildren([{scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:"&nbsp;",allowHTML:true},{scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15110,"Use HTTPS"),checked:d&&d.config.supportHttpsURL||false,oncheckedChange:function(){Z.supportHttpsURL=this.checked;}}]}]);H.call(b,mstrmojo.desc(12309,"HDFS Port:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.hdfsRpcPort||"",onvalueChange:function(){Z.hdfsRpcPort=this.value;}});H.call(b,mstrmojo.desc(12310,"WebHDFS Port:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.hdfsHttpPort||"",onvalueChange:function(){Z.hdfsHttpPort=this.value;}});b=M.call(a,mstrmojo.desc(14941,"Gateway Properties"));H.call(b,mstrmojo.desc(14942,"Host:"),{scriptClass:"mstrmojo.TextBox",enabled:W,value:d&&d.config.hostAddr||"",onvalueChange:function(){Z.hostAddr=this.value;}});H.call(b,mstrmojo.desc(12313,"Port:"),{scriptClass:"mstrmojo.TextBox",enabled:W,value:d&&d.config.tcpPort||"",onvalueChange:function(){Z.tcpPort=this.value;}});H.call(b,mstrmojo.desc(2307,"Path:"),{scriptClass:"mstrmojo.TextBox",enabled:W,value:d&&d.config.remoteDir||"/opt",onvalueChange:function(){Z.remoteDir=this.value;}});b=M.call(a,mstrmojo.desc(14943,"Spark Properties"));c=H.call(b,mstrmojo.desc(2707,"Mode:"),{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:S,enabled:W,postselectedIndexChange:function(g){var l=this.parent.parent,j=l.children,m=g.value,h=g.valueWas,k=this.items[m];if(m!==h){if(j.length>=4){l.removeChildren(j[3]);l.removeChildren(j[2]);l.removeChildren(j[1]);}if(j.length>=3){l.removeChildren(j[2]);l.removeChildren(j[1]);}switch(k&&k.did){case U:Z.sparkConfig={props:{}};Z.sparkConfig.props.AuthMode=0;Z.sparkConfig.props.Mode=0;H.call(l,mstrmojo.desc(7776,"Authentication Mode:"),{scriptClass:"mstrmojo.TextBox",value:mstrmojo.desc(7778,"Anonymous"),enabled:false});if(d.config.sparkConfig.props&&d.config.sparkConfig.props["spark.master"]){var e=d.config.sparkConfig.props["spark.master"];var f=e.substring(6,e.length-1);if(f==="*"){f="";}}H.call(l,mstrmojo.desc(14944,"Thread Number:"),{scriptClass:"mstrmojo.TextBox",value:f,onvalueChange:function(){if(this.value.trim()){var n="local["+this.value+"]";Z.sparkConfig.props["spark.master"]=n;}else{var o="local[*]";Z.sparkConfig.props["spark.master"]=o;}}});break;case V:Z.sparkConfig={props:{}};Z.sparkConfig.props.AuthMode=0;Z.sparkConfig.props.Mode=1;Z.sparkConfig.props["spark.serializer"]="org.apache.spark.serializer.KryoSerializer";H.call(l,mstrmojo.desc(7776,"Authentication Mode:"),{scriptClass:"mstrmojo.TextBox",value:mstrmojo.desc(7778,"Anonymous"),enabled:false});H.call(l,mstrmojo.desc(14945,"Master:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.sparkConfig.props["spark.master"]||"",onvalueChange:function(){Z.sparkConfig.props["spark.master"]=this.value;}});break;case B:Z.sparkConfig={props:{}};Z.sparkConfig.props.Mode=2;Z.sparkConfig.props["spark.serializer"]="org.apache.spark.serializer.KryoSerializer";X=H.call(l,mstrmojo.desc(7776,"Authentication Mode:"),{isHostedWithin:false,scriptClass:"mstrmojo.ui.Pulldown",items:Q,postselectedIndexChange:function(n){var o=this.items[n.value];Z.sparkConfig.props.AuthMode=o.did;}});H.call(l,mstrmojo.desc(15640,"Path of spark assembly JAR:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.sparkConfig.props["spark.yarn.jar"]||"",onvalueChange:function(){Z.sparkConfig.props["spark.yarn.jar"]=this.value;}});if(W){X.set("selectedIndex",0);}break;}}}});if(d.config.sparkConfig.props.Mode==="0"){c.set("selectedIndex",0);}else{if(d.config.sparkConfig.props.Mode==="1"){c.set("selectedIndex",1);}else{if(d.config.sparkConfig.props.Mode==="2"){c.set("selectedIndex",2);if(d.config.sparkConfig.props.AuthMode==="0"){X.set("selectedIndex",0);}else{if(d.config.sparkConfig.props.AuthMode==="1"){X.set("selectedIndex",1);}else{X.set("selectedIndex",0);}}}else{c.set("selectedIndex",0);}}}b=a.addChildren([{scriptClass:"mstrmojo.ui.Checkbox",cssClass:"advanced-toggle",alias:"advancedToggler",oncheckedChange:function(){var g=this.parent,f=g.children,e,h;e=J.find(f,"id",this.id);h=f[e+2];if(h){h.set("visible",!h.visible);}}},{scriptClass:"mstrmojo.Label",cssClass:"section-header-advanced",text:mstrmojo.desc(702,"Advanced"),onclick:function(){var e=this.parent.advancedToggler;e.set("checked",!e.checked);}},{scriptClass:"mstrmojo.Box",cssClass:"section-box"}])[2];b.set("visible",false);H.call(b,mstrmojo.desc(14947,"Memory of driver:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.sparkConfig.props["spark.driver.memory"]||"",onvalueChange:function(){Z.sparkConfig.props["spark.driver.memory"]=this.value;}});H.call(b,mstrmojo.desc(14948,"Memory of executor:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.sparkConfig.props["spark.executor.memory"]||"",onvalueChange:function(){Z.sparkConfig.props["spark.executor.memory"]=this.value;}});H.call(b,mstrmojo.desc(14963,"Cores of executor:"),{scriptClass:"mstrmojo.TextBox",value:d&&d.config.sparkConfig.props["spark.executor.cores"]||"",onvalueChange:function(){Z.sparkConfig.props["spark.executor.cores"]=this.value;}});H.call(b,mstrmojo.desc(14949,"Optional:"),{scriptClass:"mstrmojo.TextArea",alias:"option",onvalueChange:function(){this.parent.parent.parent.option=this.value;},bindings:{value:function(){var g="";var f=d.config.sparkConfig.props;if(f){for(var e in f){if(e!=="AuthMode"&&e!=="spark.driver.memory"&&e!=="spark.executor.memory"&&e!=="spark.executor.cores"&&e!=="spark.master"&&e!=="Mode"&&e!=="spark.serializer"&&e!=="spark.yarn.jar"){g+=e+" = "+f[e]+"\n";}}}return g;}}});a.addChildren([{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrmojo-Editor-button delete hot",text:mstrmojo.desc(629,"Delete"),visible:!W,onclick:function(){var e=this.parent;var f=mstrmojo.desc(14957,"Do you want to undeploy and delete it?\nThe Hadoop Gateway will be undeployed first, and deleted from the list.");mstrmojo.confirm(f,{confirmBtn:{fn:function(){var g=O.copy(e.dirtyData,e.data.config);mstrApp.getRootController().getHadoopGatewayController().deleteGateway(g,{success:function(){e.close();}});}}});}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrmojo-Editor-button cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var e=this.parent;e.close();}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrmojo-Editor-button save",text:mstrmojo.desc(118,"Save"),onclick:function(){var h=mstrApp.getRootController().getHadoopGatewayController(),n=this.parent,m,l;var k={success:function(){l.close();n.close();}};var g={success:function(){n.close();}};m=A(n.dirtyData,n.data.config);m.sshPort=22;if(N(m)&&L(n.option)){if(n.option){var e=n.option.split("\n");for(var j=0;j<e.length;j++){if(e[j].trim()!==""){var p=(e[j].trim()).split("=");var o=p[0].trim();n.dirtyData.sparkConfig.props[o]=p[1].trim();}}m=A(n.dirtyData,n.data.config);}if(W){h.createGateway(m,g);}else{m=A(n.dirtyData,n.data.config);var f=mstrmojo.desc(null,"Your changes have been saved. Click Yes to redeploy Hadoop Gateway for the changes to take effect. Or click No to redeploy later.");mstrmojo.confirm(f,{confirmBtn:{fn:function(){h.confirmAuthentication(function(q,t){l=this;Z.user=q;Z.passwd=t;m=A(n.dirtyData,n.data.config);h.updateGateway(m,g);h.updateSparkConfig(m,k);});}},cancelBtn:{fn:function(){h.updateGateway(m,g);}}});}}}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:W?"mstrmojo-Button mstrmojo-WebButton mstrmojo-Editor-button deploy hot":"mstrmojo-Button mstrmojo-WebButton mstrmojo-Editor-button deploy",text:mstrmojo.desc(14936,"Deploy"),visible:W,onclick:function(){var h=mstrApp.getRootController().getHadoopGatewayController(),o=this.parent,k=o.data,e=o.dirtyData,n,l;var j={success:function(){}};n=A(o.dirtyData,k.config);n.sshPort=22;function m(){var t={success:function(){h.installGateway(n,{success:function(){l.close();o.close();}});}};if(W){h.createGateway(n,t);h.updateSparkConfig(n,j);}else{h.updateGateway(n,t);}}if(N(n)&&L(o.option)){if(o.option){var f=o.option.split("\n");for(var g=0;g<f.length;g++){if(f[g].trim()!==""){var q=(f[g].trim()).split("=");var p=q[0].trim();o.dirtyData.sparkConfig.props[p]=q[1].trim();}}n=A(o.dirtyData,o.data.config);}h.confirmAuthentication(function(t,u){l=this;e.user=t;e.passwd=u;n=O.copy(e,o.data.config);m();});}}}]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.Box","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.ui.IconTooltipCheckList","mstrmojo.ui.LabelWithIconTooltip","mstrmojo.ValidationTextBox","mstrmojo.hash","mstrmojo.func","mstrmojo.desc","mstrmojo.css","mstrmojo.form","mstrmojo.date","mstrmojo.dom","mstrmojo.alert","mstrmojo.NumberFormat");mstrmojo.requiresDescs(6,7,295,3437,15153,15156,2879,2140,5212,5592,5374,1345,34,5875,29,32,6213,15581,15582,5876,35,15583,2696,18,15631,15632,15633,15634,2033,4604,2058,8378,15836,15837,15838,15839,15840,15841,15842,15843,15846,15847,15849,15948,15956);var H=mstrmojo.desc,P=mstrmojo.hash,R=mstrmojo.Button.newWebButton,X=mstrmojo.css,J={GENERAL:0,SECURITY:1,LAYOUT:2},A={ALL_CHAPTERS:0,CURRENT_CHAPTER:1,CURRENT_PAGE:2},O={FULL_PAGE:1,VISUALIZATIONS:2,BOTH:3},Q={DISABLE:0,ENABLE:1};var Y={range:A.CURRENT_CHAPTER,overviewViz:O.FULL_PAGE,paperHeight:"8.5",paperWidth:"11",pageOrientation:-1,mode:0,enableFooter:Q.ENABLE,enableHeader:Q.ENABLE,pdfPwd:"",selectedTabIndex:J.GENERAL,hideTabIndex:undefined};function F(){return true;}function U(){var c={},a=this.general,b=this.layout;c.range=a.exportChapters.chapterContent.getSelectedItem().v;c.overviewViz=this.singleVis?O.VISUALIZATIONS:a.exportIndiVis.checkbox.checked?O.BOTH:O.FULL_PAGE;c.pageOrientation=a.pageOrientation.oriCheckList.selectedItem.v;c.paperHeight=b.exportPages.paperSize.sizeOptions.getSelectedItem().eph;c.paperWidth=b.exportPages.paperSize.sizeOptions.getSelectedItem().epw;c.pageOrientation=b.pageOrientation.oriCheckList.selectedItem.v;c.mode=0;c.enableHeader=b.pdfHeader.checkbox.checked?Q.ENABLE:Q.DISABLE;c.enableFooter=b.pdfFooter.checkbox.checked?Q.ENABLE:Q.DISABLE;c.pdfPwd="";return c;}function B(c){var a=this.general,b=this.layout;this.exOpts=c;a.exportChapters.chapterContent.set("selectedIndex",W(M,c.range));a.exportIndiVis.checkbox.set("checked",c.overviewViz===O.BOTH);a.pageOrientation.oriCheckList.set("selectedIndex",W(N,c.pageOrientation));b.exportPages.paperSize.sizeOptions.set("selectedIndex",W(I,L(c.paperWidth,c.paperHeight)));b.pageOrientation.oriCheckList.set("selectedIndex",W(N,c.pageOrientation));b.pdfHeader.set("checked",c.enableHeader===Q.ENABLE);b.pdfFooter.set("checked",c.enableFooter===Q.ENABLE);}var M=[{n:H(2058,"All"),v:A.ALL_CHAPTERS},{n:H(15846,"Current Chapter"),v:A.CURRENT_CHAPTER}];var I=[{n:H(1345,'A3 11.69" x 16.54"'),eph:"11.69",epw:"16.54"},{n:H(34,'A4 8.27" x 11.69"'),eph:"8.27",epw:"11.69"},{n:H(5875,'A5 5.83" x 8.27"'),eph:"5.83",epw:"8.27"},{n:H(29,'Letter 8.5" x 11"'),eph:"8.5",epw:"11"},{n:H(32,'Legal 8.5" x 14"'),eph:"8.5",epw:"14"},{n:H(6213,'Ledger 11" x 17"'),eph:"11",epw:"17"},{n:H(15581,'B4 13.9" x 9.8"'),eph:"13.9",epw:"9.8"},{n:H(15582,'B5 9.8" x 6.9"'),eph:"9.8",epw:"6.9"},{n:H(5876,'Executive 7.25" x 10.5"'),eph:"7.25",epw:"10.5"},{n:H(35,'Folio 8.5" x 13"'),eph:"8.5",epw:"13"},{n:H(15583,'Statement 5.5" x 8.5"'),eph:"5.5",epw:"8.5"}];var N=[{n:H(4604,"Auto"),tx:true,css:"pdfAuto",v:-1},{n:H(6,"Portrait"),css:"pdfPortrait",v:0},{n:H(7,"Landscape"),css:"pdfLandscape",v:1}];function L(b,a){if(parseFloat(b)<parseFloat(a)){return{eph:b,epw:a};}return{eph:a,epw:b};}function W(b,c){var a=0;if(typeof c==="object"){var d=P.keyarray(c);P.forEach(b,function(f,e){if(P.equals(P.copyProps(d,f),c)){a=e;return false;}});}else{P.forEach(b,function(f,e){if(f.v===c){a=e;return false;}});}return parseInt(a);}function E(a){return{scriptClass:"mstrmojo.Box",alias:"pageOrientation",cssClass:"page-orientation",bindings:{visible:"this.parent.parent.basic||this.parent.parent.tabBar.tabs.selectedIndex===2"},children:[{scriptClass:"mstrmojo.Label",text:H(2879,"Orientation")},{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:true,alias:"oriCheckList",selectedIndex:W(N,a.exOpts.pageOrientation),items:N,postselectionChange:function(b){a.exOpts.pageOrientation=this.selectedItem.v;a.raiseEvent({name:"updateOrientation"});}}]};}function D(c,a){var b=this;return[{scriptClass:"mstrmojo.Box",alias:"tabBar",cssClass:"tabBar",children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,alias:"tabs",selectedIndex:J.GENERAL,postselectionChange:function(d){var h=this.parent.parent,e=h.tabBar.tabs.selectedItem.v,g=[h.general,h.security,h.layout];for(var f=0;f<g.length;f++){g[f].set("visible",f+1==e);}},items:[{n:H(295,"General"),v:J.GENERAL+1},{n:H(2696,"Security"),v:J.SECURITY+1},{n:H(3437,"Layout"),v:J.LAYOUT+1}]}]},{scriptClass:"mstrmojo.Box",alias:"general",cssClass:"general",children:[{scriptClass:"mstrmojo.Box",alias:"exportChapters",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Label",text:H(5374,"Content")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chapterContent",selectedIndex:W(M,c.range),items:M}]},{scriptClass:"mstrmojo.Box",alias:"exportIndiVis",cssClass:"mstrmojo-CheckBoxes-Box",bindings:{visible:"!this.parent.parent.basic"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.overviewViz===O.BOTH?true:false,label:"",oncheckedChange:function(){c.overviewViz=this.checked?O.BOTH:O.FULL_PAGE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:H(15849,"Export Individual Visualizations"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:H(15836,"Visualizations will be exported individually on separate pages.")}]},this.orientationSettings,]},{scriptClass:"mstrmojo.Box",alias:"security",cssClass:"security",visible:false},{scriptClass:"mstrmojo.Box",alias:"layout",cssClass:"layout",visible:false,children:[{scriptClass:"mstrmojo.Box",alias:"exportPages",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Box",alias:"paperSize",children:[{scriptClass:"mstrmojo.Label",text:H(15156,"Paper Size")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"sizeOptions",selectedIndex:W(I,L(c.paperWidth,c.paperHeight)),items:I}]}]},this.orientationSettings,{scriptClass:"mstrmojo.Label",cssClass:"wrap",text:H(15839,"Header and Footer")},{scriptClass:"mstrmojo.Box",alias:"pdfHeader",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.enableHeader===Q.ENABLE?true:false,label:"",oncheckedChange:function(){c.enableHeader=this.checked?Q.ENABLE:Q.DISABLE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:H(2033,"Header"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:H(15956,"Display the dossier, chapter, and page name on every page.")}]},{scriptClass:"mstrmojo.Label",text:""},{scriptClass:"mstrmojo.Box",alias:"pdfFooter",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.enableFooter===Q.ENABLE?true:false,label:H(15948,"Page Numbers"),oncheckedChange:function(){c.enableFooter=this.checked?Q.ENABLE:Q.DISABLE;}}]}]},{scriptClass:"mstrmojo.Box",alias:"buttonNode",slot:"buttonNode",children:[R(H(2140,"Cancel"),function(){this.parent.parent.close();}),R(b.exportDisplayText,function(){var d=this.parent.parent;if(!F.call(d)){return ;}var e=U.call(d);d.exOpts=e;d.exportHandler(e);d.close();},true),R(H(8378,"Advanced Settings"),function(){a=!a;this.parent.parent.set("basic",a);this.parent.parent.toggleMode();this.set("text",a?H(8378,"Advanced Settings"):H(15840,"Basic Settings"));},false,{cssClass:"togglerBtn"+(this.singleVis?" hidden":"")})]}];}function V(b){var a=P.copy(Y);if(typeof b==="object"){if(b.hasOwnProperty("range")){a.range=parseInt(b.range);}if(b.hasOwnProperty("overviewViz")){a.overviewViz=parseInt(b.overviewViz);}if(b.hasOwnProperty("paperHeight")){a.paperHeight=b.paperHeight.toString();}if(b.hasOwnProperty("paperWidth")){a.paperWidth=b.paperWidth.toString();}if(b.hasOwnProperty("pageOrientation")){a.pageOrientation=parseInt(b.pageOrientation);}if(b.hasOwnProperty("mode")){a.mode=parseInt(b.mode);}if(b.hasOwnProperty("enableFooter")){a.enableFooter=parseInt(b.enableFooter);}if(b.hasOwnProperty("enableHeader")){a.enableHeader=parseInt(b.enableHeader);}if(b.hasOwnProperty("pdfPwd")){a.pdfPwd=b.pdfPwd.toString();}if(b.hasOwnProperty("selectedTabIndex")){a.selectedTabIndex=parseInt(b.selectedTabIndex);}a.hideTabIndex=b.hideTabIndex;}return a;}mstrmojo.vi.ui.editors.ExportPDFEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ExportPDFEditor",cssClass:"mstrmojo-ExportPDFEditor",title:H(5212,"Export to PDF"),help:"intro_export_dossier.htm",exportHandler:mstrmojo.emptyFn,exportDisplayText:H(5592,"Export"),basic:true,singleVis:false,exOpts:Y,orientationSettings:undefined,useCache:false,zIndex:12,init:function S(a){this._super(a);this.basic=!this.singleVis;this.exOpts=V.call(this,a.exOpts);this.orientationSettings=E(this,this);this.set("children",D.call(this,this.exOpts,this.basic));this.attachEventListener("updateOrientation",this.id,function(){var b=W(N,this.exOpts.pageOrientation);this.general.pageOrientation.oriCheckList.set("selectedIndex",b);this.layout.pageOrientation.oriCheckList.set("selectedIndex",b);});},updatePopupConfig:function K(a,b){B.call(this,this.exOpts);},onOpen:function G(){var b=this.exOpts,a=this.tabBar.tabs.itemsContainerNode.childNodes;if(b.hideTabIndex!==undefined&&0<=b.hideTabIndex&&b.hideTabIndex<a.length){X.addClass(a[b.hideTabIndex],"hidden");}this.toggleMode();this.positionDialog();},onClose:function C(){if(!this.useCache){this.destroy();}},toggleMode:function Z(){var e=this.tabBar.tabs.itemsContainerNode.childNodes,d=this.basic;X.toggleClass(this.editorNode,"advanced",!d);X.toggleClass(e[J.LAYOUT],"hidden",d);var a=mstrApp&&mstrApp.featureFlagsCache&&mstrApp.featureFlagsCache["EE/PDFEncrypt"];X.toggleClass(e[J.SECURITY],"hidden",d||!a);var b=e.length;for(var c=0;c<e.length;c++){if(e[c].className.match(/\bhidden\b/)){b--;}}this.tabBar.set("visible",b>1);this.tabBar.tabs.set("selectedIndex",this.exOpts.selectedTabIndex);if(!this.singleVis){this.set("title",d?H(15841,"Export to PDF - Basic"):H(15842,"Export to PDF - Advanced"));}}});mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings={hideTabIndex:J.GENERAL,selectedTabIndex:J.LAYOUT,overviewViz:O.VISUALIZATIONS,enableFooter:Q.DISABLE};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.HTMLButton","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(24,221,5369,13085,13086,13087,13088,13089,13090);var C,H=mstrmojo.array,F=mstrmojo.dom,G,E;C=function C(M){var Q=M;var P=Q.vBoxAlias,L=P.iServerNameNodeHBox.iServerNameNodeAlias.value,N=P.iServerPortHBox.iServerPortAlias.value,R=P.loginHBox.loginAlias.value,S=P.passwordHBox.passwordAlias.value,I=P.dsNameHBox.dsNameAlias.value,K,O;if(Q.dbrole){K=Q.dbrole;}else{K=new mstrmojo.DI.DIRemoteProjectDBRole();K.init();}O=K.mdDBRole;var J={str:"hostname="+L+"; Port="+N+"; ProjectID="+E+";",err:"error Msg"};O.n=I;O.connstr=J.str;O.ln=R;O.password=S;O.dbr_type="5";O.dbms="00000000000000000000000000000000";O.hostname=L;O.Port=N;O.selectedProjectName=G;O.ProjectID=E;mstrApp.getRootController().projectController.saveDBRole(O,Q);};mstrmojo.DI.DIProjectDBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectDBRoleEditor",title:mstrmojo.desc(24,"Data Source"),id:"projectDBRoleEditor",help:"Select_Objects_dialog_box_.htm",cssClass:"mstrmojo-project-login",dbrole:undefined,buttons:[{scriptClass:"mstrmojo.HTMLButton",alias:"submitButtonAlias",cssClass:"mstrmojo-Editor-button mstr-submit-button",text:mstrmojo.desc(5369,"Submit"),onclick:function(){C(this.parent.parent);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button mstr-cancel-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var I=this.parent.parent;I.close();}}],preBuildRendering:function B(){if(this._super){this._super();}if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);},onOpen:function A(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);var J=this.dbrole;this.set("dbrole",new mstrmojo.DI.DIRemoteProjectDBRole());this.set("dbrole",J);if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}else{var I=this.vBoxAlias.iServerProjectHBox.iServerProject;I.set("items",[]);I.set("defaultSelection",0);I.set("selectedIndex",-1);I.set("text","");}},projectsLoaded:function D(K){var L=K.data.srps.sp,M=this.vBoxAlias.iServerProjectHBox.iServerProject;if(Object.prototype.toString.call(L)!=="[object Array]"){L=[].concat(L);}M.set("items",L);if(!this.dbrole){M.set("defaultSelection",0);G=L[0].pn;E=L[0].pgd;}else{var J=this.dbrole.ProjectID,I=H.find(L,"pgd",J);E=J;if(I!==-1){M.set("defaultSelection",I);M.set("selectedIndex",I);}else{M.set("selectedIndex",-1);M.set("defaultSelection",-1);M.set("text","");}}M.render();},children:[{scriptClass:"mstrmojo.VBox",alias:"vBoxAlias",cssClass:"login_Vbox",children:[{scriptClass:"mstrmojo.HBox",alias:"iServerNameNodeHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13085,"Remote I-Server Location")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerNameNodeAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.hostname;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerPortHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13086,"Remote I-Server Port")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerPortAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.Port;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerProjectHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13087,"Remote Server Project")},{scriptClass:"mstrmojo.Pulldown",alias:"iServerProject",popupToBody:true,itemField:"pn",itemIdField:"pgd",bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},onvalueChange:function(){var J=this,I=J.selectedIndex;G=J.items[I].pn;E=J.items[I].pgd;},premousedown:function(I){if(!this.items||(this.items.length===0)){var K=this.parent.parent.iServerNameNodeHBox.iServerNameNodeAlias.value;var J=this.parent.parent.iServerPortHBox.iServerPortAlias.value;if(K&&J){mstrApp.getRootController().projectController.getProjectsFromRemote(K,J);}}else{if(F.getButton(I.hWin,I.e)===F.MOUSE_BUTTON.LEFT){this.togglePopup();}}}}]},{scriptClass:"mstrmojo.HBox",alias:"loginHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13088,"Project Login")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"loginAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.ln;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"passwordHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13089,"Project Password")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"passwordAlias",type:"password",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.password;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"dsNameHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13090,"Data Source Name")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"dsNameAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.n;}return"";}}}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.css","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(221,1825,8708,12771,12949,13052,14896);var D=mstrmojo.DI.DIConstants,C=mstrmojo.css,F=mstrmojo.dom,E=mstrmojo.array,A=4*1024*1024;function B(){var K=this,J=mstrApp.getRootController(),L=K.list.items,G=L&&L.length,M=0;var N={success:function(){K.sources[M].invalidPreview();K.sources[M].fileUploader=null;M++;if(M<G){O(M);}else{I();}},failure:function(P){var R=L[M];var S=R&&R.dbTableName;var Q=J.getImportController().handleImportError(P,S);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,Q);}};function I(){var P=D.requestFlag.mapping|D.requestFlag.sourceInfo|D.requestFlag.relationship;J.getImportedDataEMMA(D.actions.none,P,undefined,undefined,undefined,undefined,{success:function(){H();}});}function H(){K.close();K.onOK();mstrApp.hideProgress();}function O(P){var S=L[P],Q=S.tableID,R=J.getModel().operationMode;if(S.type===D.sourceType.file&&S.subtype===D.sourceSubtype.localFile){J.getImportController().refreshDataLocalFile(Q,{uploader:S.fileUploader},R,N);}else{if(S.type===D.sourceType.file&&S.subtype===D.sourceSubtype.clipboard){J.getImportController().refreshDataClipboard(Q,{uploader:S.fileUploader},R,N);}}}mstrApp.showProgress();O(0);}mstrmojo.DI.ui.dialogs.DIBinaryUploadDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIBinaryUploadDialog",cssClass:"mstrmojo-di-ui-dialogs-DIBinaryUploadDialog",title:mstrmojo.desc(14896,"Upload your data"),sources:null,onOK:mstrmojo.emptyFn,onOpen:function(){this.list.set("items",this.sources);},checkOKButtonEnabled:function(){var G=true;E.forEach(this.sources,function(H){if(!H.hasSelectFile){G=false;return false;}});this.btnHbox.okButton.set("enabled",G);},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIBinaryUploadDialog-header",text:mstrmojo.desc(12949,"Data Source")},{scriptClass:"mstrmojo.WidgetList",cssClass:"mstrmojo-di-ui-dialogs-DIBinaryUploadDialog-widgetList",alias:"list",itemFunction:function(J,H,K){var I=K.parent,G,M="",L=false;if(J&&J.sourceInfo){M=J.sourceInfo.dbTableName||J.sourceInfo.name;}L=J.type===D.sourceType.file&&J.subtype===D.sourceSubtype.clipboard;G=new mstrmojo.Box({parent:K,data:J,index:H,cssClass:"mstrmojo-di-ui-dialogs-DIBinaryUploadDialog-widgetBox cf",children:[{alias:"label",scriptClass:"mstrmojo.Label",text:M,title:J.getDataSourceDescription(),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var N;if(this.title){N=F.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-A",top:Math.max(N.y+N.h+2,0),left:Math.max(N.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}}]});if(L){G.addChildren([{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(13052,"Upload"),onclick:function(){var N=mstrApp.getRootController(),P=this.parent.data,O=this.parent.label,R=N.navigationController.getPageSlot(),Q={next:{visible:true,text:mstrmojo.desc(13052,"Upload")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};R.setConfig({footerConfig:Q,properties:{operationMode:D.operationMode.refresh,tableID:P.tableID,currentSource:P,donotFetchData:true,onNextButtonClick:function(){N.showPage(D.pageType.emmaPreview);P.hasSelectFile=true;P.fileUploader=this;C.toggleClass(O.domNode,"hasSelectFile",true);I.checkOKButtonEnabled();}}});this.pageSlot=R;N.showDialog(D.dialogType.diPageDialog,{pageType:D.pageType.clipboard,sourceInfo:0,slot:R});}}]);}else{G.addChildren([{scriptClass:"mstrmojo.FileUploadBox",browseLabel:mstrmojo.desc(1825,"Browse"),accept:".xls,.xlsx,.csv,.txt,.tsv,.prn,.json,.sas7bdat",uploadTaskId:"importFile",action:mstrConfig.taskURL,fileFieldName:"myFile",initValue:false,onvalueChange:function(){var O=(this.value!==""),N=this.parent.data;N.hasSelectFile=true;N.fileUploader=this;if(O){this.parent.label.set("text",this.getFileName());}C.toggleClass(this.parent.label.domNode,"hasSelectFile",O);I.checkOKButtonEnabled();},getFileName:function(){var N;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){N=this.fileNode.files.length>0&&this.fileNode.files[0].name;}else{N=this.value;}return N;},getFileSize:function(){var N=0;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){N=this.fileNode.files.length>0&&this.fileNode.files[0].size;}else{try{var Q=new ActiveXObject("Scripting.FileSystemObject");var O=Q.getFile(this.fileNode.value);if(O){N=O.Size;}}catch(P){}}return N;},submit:function(N,Z,W){function O(a){var b={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(Z.failure){Z.failure(a||b);}if(Z.complete){Z.complete();}}function R(){var a,b;N.fileName=Q;N.index++;a=Math.min(X.size,U+A);b=X.slice(U,a);if(N.index===N.numberOfChunks){mstrApp.upload(Z,N,b,W);}else{mstrApp.upload({success:function(){U=U+A;R();},failure:function(c){O(c);}},N,b,W);}}var P=true;var X,Q,V,U;if(this.onsubmit){P=this.onsubmit();}if(P){N=N||{};N.fileFieldName=this.fileFieldName;N.taskId=this.uploadTaskId;N.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){W=mstrmojo.hash.copy(W,{async:true});X=this.fileNode.files[0];Q=X.name;if(this.params){N=this.params;}if(X.size>A){V=Math.ceil(X.size/A);U=0;N.index=0;N.numberOfChunks=V;N.chunkSize=A;N.fileName=this.fileNode.files[0].name;N.fileSize=X.size;N.fileType="application/octet-stream";mstrApp.showProgress(W);mstrApp.upload({success:function(){R();},failure:function(a){O(a);}},N,null,W);}else{N.fileName=this.fileNode.files[0].name;mstrApp.upload(Z,N,X.slice(0,X.size),W);}}else{N.taskEnv="jsonp2";N.fileName=this.value;var Y=[],S;for(S in N){Y.push('<input type="hidden" name="'+S+'" value="'+mstrmojo.string.encodeHtmlString(N[S])+'"/>');}if(this.params){N=this.params;for(S in N){Y.push('<input type="hidden" name="'+S+'" value="'+mstrmojo.string.encodeHtmlString(N[S])+'"/>');}}this.paramsNode.innerHTML=Y.join("");if(Z){this.onSuccess=Z.success;this.onFailed=Z.failure;}this.formNode.submit();}this.set("status","loading");}}}]);}return G;}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",enabled:false,onclick:function(){var G=this.parent.parent;B.call(G);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var G=this.parent.parent;G.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.VBox","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.css");mstrmojo.requiresDescs(118,221,246,531,629,7778,14900,15038,15039,15040,15041,15360,15043,15044,15045,15046,15047,15048,15049,15050,15064,15082,15202,6138,15369);var a=mstrmojo.DI.DIConstants,h=mstrmojo.string,S=mstrmojo.array,P=mstrmojo.hash,H=mstrmojo.dom,R=mstrmojo.css,Z="http://",V="https://",p="data:image",X="mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imageNode ",j=mstrmojo.DI.DIHelpers,Q=mstrmojo.css,D=a.sdkUrl.MARKPLACE_URL;$SEPARATOR_INTRODUCTION="#DESCRIPTION#INTRODUCTION#";var F=["image/jpeg","image/bmp","image/png"];var J=[{did:a.authMode.ANONYMOUS,n:mstrmojo.desc(7778,"Anonymous"),prefix:a.authModePrefix.ANONYMOUS},{did:a.authMode.USERNAME,n:mstrmojo.desc(14900,"Username and Password"),prefix:a.authModePrefix.USERNAME},{did:a.authMode.OAUTH,n:mstrmojo.desc(15038,"OAuth"),prefix:a.authModePrefix.OAUTH}];function N(t,w,q,u){return{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-box",alias:t,children:[{scriptClass:"mstrmojo.Label",cssClass:u?u:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-label",alias:"label",text:w,useRichTooltip:true,updateTooltipConfig:function(){var x=H.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(x.y,0),left:Math.max(x.x+x.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.text});}}].concat(q)};}function L(q,t){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:q,onvalueChange:function(){if(this._super){this._super();}l(this.parent.parent.parent);}};}function I(w,u,t){var q=w.userNode,x=w.pwdNode;q.domNode.setAttribute("style","mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-extraSetting");q.label.set("text",u);q.tbUser.set("value","");x.domNode.setAttribute("style","mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-extraSetting");x.label.set("text",t);x.tbPwd.set("value","");}function d(AC,AB,u){AC=window.btoa(AC);var t;if(typeof window.Blob=="function"||"object"){t=new Blob([AC],{type:AB});}else{var x=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.Blob;var z=new x();z.append(AC);t=z.getBlob(AB);}var AA=window.URL||window.webkitURL;var q=AA.createObjectURL(t);var w=document.createElement("a");if("download" in w){w.style.visibility="hidden";w.href=q;w.download=u;document.body.appendChild(w);var AD=document.createEvent("MouseEvents");AD.initEvent("click",true,true);w.dispatchEvent(AD);document.body.removeChild(w);}else{if(navigator.msSaveBlob){navigator.msSaveBlob(t,u);}else{location.href=q;}}}function n(u){var t=u.fileBox,x=u.collapseBox.collapse,q=u.detailInfo,w=u.collapseBox.arrow;q.set("visible",false);R.toggleClass(t.dnDNode,"expanded",false);u.isExpand=false;R.toggleClass(x.domNode,"expanded",false);R.toggleClass(u.buttonNode,"expanded",false);}function b(u){var t=u.fileBox,x=u.collapseBox.collapse,q=u.detailInfo,w=u.collapseBox.arrow;x.set("text",mstrmojo.desc(15304,"Collapse connector information"));q.set("visible",true);R.toggleClass(t.dnDNode,"expanded",true);u.isExpand=true;R.toggleClass(x.domNode,"expanded",true);R.toggleClass(u.buttonNode,"expanded",true);}function k(q){var u=q.detailInfo;u.nameNode.tbName.set("value",q.name);!mstrApp.diParams.Admin&&u.nameNode.tbName.domNode.setAttribute("readonly","readonly");u.urlNode.tbURL.set("value",q.url);u.descNode.tbDesc.set("value",q.desc);u.introductionNode.tbIntroduction.set("value",q.introductionUrl);var t=u.iconNode.imageNode;if(q.iconData&&mstrmojo.string.startsWith(q.iconData,p)){t.set("src",q.iconData);}else{t.set("src","");}if(q.oid===a.originalConnector.elastic){u.iconNode.backgroundImage='url("images/DI/icons.svg") -3250px -200px no-repeat';}else{if(q.oid===a.originalConnector.tapClicks){u.iconNode.backgroundImage='url("images/DI/tapClicks.png") 0px 0px no-repeat';}}u.typeNode.type.set("selectedIndex",q.type);u.userNode.tbUser.set("value",q.user);u.pwdNode.tbPwd.set("value",q.pwd);}function G(q,t){q.set("enabled",t);q.set("visible",t);}function g(t,q){if(j.isLocalWS()){G(t.btnDelete,!q);}else{G(t.btnDelete,!q&&mstrApp.diParams.Admin&&mstrApp.diParams.AccessDataFromFiles);}G(t.btnExport,!q);G(t.btnSave,!q);G(t.btnAdd,q);}function B(t,u){var x=t.detailInfo,w=mstrApp.getRootController(),q=w.getModel();if(u.oid===undefined||S.find(q.sourceItems,"oid",u.oid)<0){x.nameNode.tbName.set("value",u.name);x.urlNode.tbURL.set("value",u.url);x.descNode.tbDesc.set("value",u.desc);x.introductionNode.tbIntroduction.set("value",!!u.introductionUrl?u.introductionUrl:"");x.iconNode.imageNode.domNode.style.backgroundImage="";if(mstrmojo.string.startsWith(u.iconData,p)){x.iconNode.imageNode.set("src",u.iconData);}else{x.iconNode.imageNode.set("src","");}t.iconData=u.iconData;t.oid=u.oid;x.typeNode.type.set("selectedIndex",u.type);x.userNode.tbUser.set("value",u.user);b(t);}else{m(t.fileBox);w.displayError(mstrmojo.desc(15082,"The connector you selected is already added"));}}function E(w,u){var q=new FileReader(),AA=w.detailInfo,z=mstrApp.getRootController(),t=z.getModel(),x;q.onload=function(AB){if(j.isLocalWS()){AA.typeNode.type.set("enabled",false);w.isMstrcc=true;}x=JSON.parse(window.atob(AB.target.result));B(w,x);};q.readAsText(u);}function K(u,q){if(q.size>48*1<<10){mstrApp.getRootController().displayError(mstrmojo.desc(15360,"Please upload the image whose size no more than ##KB, we support ### format.").replace("###","jpg, jpeg, png, bmp").replace("##","48"));return false;}var t=q.type,w=false,x=u.detailInfo;if(j.isLocalWS()){t=q.data.split(";")[0].split(":")[1];}S.forEach(F,function(AA){if(t===AA){if(j.isLocalWS()){x.iconNode.imageNode.set("src",q.data);u.iconData=q.data;}else{var AB=new Image(),z=new FileReader();z.onload=function(AC){u.iconData=AB.src=AC.target.result;AB.onload=function(){var AD=u.detailInfo.iconNode.imageNode;AD.set("src",window.URL.createObjectURL(q));AD.domNode.style.backgroundImage="";l(u);};};z.readAsDataURL(q);}w=true;return false;}});if(!w){mstrApp.getRootController().displayError(mstrmojo.desc(15064,"Please select another image.\n The image size should be not larger than ## KB, and we only support ### format").replace("###","jpg, jpeg, png, bmp").replace("##","48"));return false;}}function c(w,AA,t,z){var AB=w.detailInfo,u=AB.typeNode.type,x=u.items[u.selectedIndex],q;q={tp:29,stp:7430,writable:"1",shared:"1",dbr_type:"7",owned:"1",db_type:a.dbType.newConnector,cefu:1,driverMode:1,dbms:a.newConnectorDBMSId,n:AB.nameNode.tbName.value,connstr:x.prefix+AB.urlNode.tbURL.value.trim()+";",des:AB.descNode.tbDesc.value+$SEPARATOR_INTRODUCTION+AB.introductionNode.tbIntroduction.value,iconData:window.btoa(w.iconData===""?"default":w.iconData),newly_created:0,};if(z){q.importFromMstrcc=1;}if(x.did!==a.authMode.ANONYMOUS){q.ln=AB.userNode.tbUser.value;q.password=AB.pwdNode.tbPwd.value;}if(AA){q.did=AA;if(t){q.newly_created=1;}}return JSON.stringify(q);}function e(t){var q=/^[^@\/\'\\\"#$%&\^\*]+$/;if(q.test(t)){return true;}return false;}function W(x){var AA=x.detailInfo,u=h.trim(AA.nameNode.tbName.value),t=h.trim(AA.urlNode.tbURL.value),w=AA.typeNode.type.selectedIndex,q=AA.userNode.tbUser.value,z=h.trim(AA.pwdNode.tbPwd.value);if(!u.length||!e(u)||!(h.startsWith(t,"http://")||h.startsWith(t,"https://"))){return false;}if((h.startsWith(t,Z)&&t.length===Z.length)||(h.startsWith(t,V)&&t.length===V.length)){return false;}if(w===a.authMode.USERNAME&&q.length===0){return false;}else{if(w===a.authMode.OAUTH&&q.length===0){return false;}}return true;}function l(t){var u=t.btnHbox,q=W(t);if(t.isNew){u.btnAdd.set("enabled",q);R.toggleClass(t.buttonNode,"edit",false);}else{R.toggleClass(t.buttonNode,"edit",true);u.btnExport.set("enabled",q);if(j.isLocalWS()){u.btnSave.set("enabled",q);}else{u.btnSave.set("enabled",q&&mstrApp.diParams.Admin&&(mstrApp.diParams.AccessDataFromFiles===1));}}}function M(t,q){var u=document.getElementById(t.id+"_browseGallery");if(u.style.visibility==="visible"){u.style.visibility="hidden";}u=document.getElementById(t.id+"_separator");if(u.style.visibility==="visible"){u.style.visibility="hidden";}var w=document.getElementById(t.id+"_selectButton");w.innerHTML=mstrmojo.desc(190,"Remove");w.setAttribute("onclick","document.getElementById('"+t.id+"_fileRemove').click()");document.getElementById(t.id+"_descStr").innerHTML=mstrmojo.desc(null,"Now Connector for "+q);document.getElementById(t.id+"_fileHolder").style.border="1px solid #B5B5B5";}function m(t){var u=document.getElementById(t.id+"_browseGallery");if(u.style.visibility==="hidden"){u.style.visibility="visible";}u=document.getElementById(t.id+"_separator");if(u.style.visibility==="hidden"){u.style.visibility="visible";}var w=document.getElementById(t.id+"_selectButton");w.innerHTML=mstrmojo.desc(15049,"Select a file");w.setAttribute("onclick","document.getElementById('"+t.id+"_fileSelect').click()");document.getElementById(t.id+"_descStr").innerHTML=mstrmojo.desc(15048,"Drag the connector file (.mstrcc) here or");document.getElementById(t.id+"_fileHolder").style.border="1px dashed #B5B5B5";var q=t.parent.detailInfo;q.nameNode.tbName.set("value","");q.urlNode.tbURL.set("value","");q.descNode.tbDesc.set("value","");q.introductionNode.tbIntroduction.set("value",""),q.iconNode.imageNode.set("src","");q.typeNode.type.set("enabled",true);q.typeNode.type.set("selectedIndex","0");t.isMstrcc=false;}function C(q,u){for(var t=0;t<u.length;t++){if(u[t].n===q&&u[t].pageType===a.pageType.newConnector){return true;}}return false;}mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog",title:"",showTitle:true,sourceInfo:null,help:"How_to_Add_a_Custom_Connector.htm",pageType:null,subtype:null,isContainHadoop:false,items:null,isNew:true,name:"",url:"",desc:"",introductionUrl:"",iconData:"",oid:"",type:a.authMode.ANONYMOUS,user:"",pwd:"",isExpend:false,isMstrcc:false,children:[{scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"fileBox",preBuildRendering:function A(){if(this._super){this._super();}this.markupString='<div><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div id="{@id}_fileHolder" class="mstrmojo-di-fileHolder {@cssClass}" style="width:439px; margin:11px 0px 0px 0px;" mstrAttach:dragover,dragend,drop><div><table><tbody><tr><td><div id="{@id}_fileIcon" style="height:60px; width:60px; background-image:url(../javascript/mojo/css/images/DI/icons.svg); background-position:-700px -10px; margin:30px 0px 30px 91px" /></td><td><table><tbody><tr><td colspan = "3"><div id="{@id}_descStr"  style="padding:11px 0px 0px 7px; font-size:12px; color:#444649; line-height:18px; ">'+mstrmojo.desc(15048,"Drag the connector file (.mstrcc) here or")+'</div></td></tr><tr><td><div id="{@id}_selectButton" style="padding-left:7px; font-si: ;ze:12px; color:#3B92ED; line-height:18px; " onclick="document.getElementById(\'{@id}_fileSelect\').click()";>'+mstrmojo.desc(15049,"Select a file")+'</div><input id="{@id}_fileSelect" type="file" style="display:none" accept=".mstrcc" mstrAttach:change,click/><input id="{@id}_fileRemove" type="button" style="display:none"  mstrAttach:click/></td><td id="{@id}_separator" style="visibility : visible">|</td><td><div id="{@id}_browseGallery" style="padding-left:16px; font-si: ;ze:12px; color:#3B92ED; line-height:18px; visibility : visible" type="button" mstrAttach:click";>'+mstrmojo.desc(15369,"Browse Gallery")+'</div></td></tr></tbody></table></td></tr></tbody></table></div><div></div><div></div></div><div></div><div><div><div></div></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>';},onchange:function o(){var q=document.getElementById(this.id+"_fileSelect"),t=q&&q.files;if(t[0]){E(this.parent,t[0]);}M(this,t[0].name);q.value="";},ondrop:function U(q){if(!this.droppable){return ;}var u=q.e;u.preventDefault();var t=u.dataTransfer.files;if(t){E(this.parent,t[0]);}M(this,t[0].name);},onclick:function Y(q){if(q.e.currentTarget.id===this.id+"_browseGallery"){if(j.isWS()){window.FormWrapper.openPage(D);}else{window.open(D);}}else{if(q.e.currentTarget.id===this.id+"_fileRemove"){m(this);}}},},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-expend-box",alias:"collapseBox",children:[{scriptClass:"mstrmojo.Image",alias:"arrow",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-arrow up"},{scriptClass:"mstrmojo.Label",alias:"collapse",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-collapse",text:mstrmojo.desc(15305,"Manually enter connection details"),onclick:function(){var q=this.parent.parent;if(q.detailInfo.visible){n(q);}else{b(q);}}}]},{scriptClass:"mstrmojo.VBox",alias:"detailInfo",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-information",children:[N("nameNode",mstrmojo.desc(15043,"Connector Name"),[L("tbName")]),N("urlNode",mstrmojo.desc(15044,"Input a URL"),[L("tbURL")]),N("descNode",mstrmojo.desc(8680,"Description"),[{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text Desc",alias:"tbDesc",maxLength:255}],"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-tbDesclabel"),N("introductionNode",mstrmojo.desc(15202,"Introduction Page"),[L("tbIntroduction")]),N("iconNode",mstrmojo.desc(15045,"Connector Icon"),[{scriptClass:"mstrmojo.Image",alias:"imageNode",bindings:{cssClass:function(){if(this.parent.parent.parent.oid===a.originalConnector.elastic){return X+"Elastic_Connector";}else{if(this.parent.parent.parent.oid===a.originalConnector.tapClicks){return X+"TapClicks_Connector";}else{return this.parent.parent.parent.isNew?X+"new":X+"edit";}}}},onsrcChange:function(){mstrmojo.Image.prototype.markupMethods.onsrcChange.call(this);if(this.src){Q.addClass(this.imgNode.parentNode,"bgtransparent");}else{Q.removeClass(this.imgNode.parentNode,"bgtransparent");}},imgCssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imageNode-img"},{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15046,"Select an image..."),preBuildRendering:function A(){if(this._super){this._super();}this.markupString='<span><input type="file" style="display:none" accept=".jpeg,.jpg,.bmp,.png" mstrAttach:change/><label class="mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imagelabel" mstrAttach:click>{@label}</label></span>';},onclick:function(){if(j.isLocalWS()){var q=window.FormWrapper;q.openImageFileDialog("mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierImageSelected");var t=mstrApp.getRootController().model.attachEventListener("getSdkImageDossier",this.id,function(u){var w=this.parent.parent.parent.parent;if(u.data){K(w,u.data);}});}else{this.inputNode.click();}},onchange:function(){var q=this.inputNode,w=q.files,u=this.parent.parent.parent.parent;if(w){K(u,w[0]);}q.value="";if(q.value!=""){var t=q.cloneNode(true);q.parentNode.appendchild(t);if(q.removeNode){q.removeNode(true);}}}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15042,"Please upload the image whose size no more than ##KB, we support ### format.").replace("###","jpg, jpeg, png, bmp").replace("##","48"),cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-upload"}]}],"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-tbDesclabel"),N("typeNode",mstrmojo.desc(15047,"Credential Type"),[{scriptClass:"mstrmojo.ui.Pulldown",items:J,cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:"type",postBuildRendering:function(){mstrmojo.ui.Pulldown.prototype.postBuildRendering.apply(this,arguments);var q=this.list.adjustCornersForPopupOverflow;this.list.adjustCornersForPopupOverflow=function(){q.call(this);this.domNode.style.top="calc(100% - 124px)";};},postselectedIndexChange:function(q){var u=this.parent.parent,x=q.value,t=q.valueWas,w=this.items[x];if(x!==t){switch(w&&w.did){case a.authMode.USERNAME:I(u,"User Name","Password");break;case a.authMode.OAUTH:I(u,"Client ID","Client Secret");break;default:u.userNode.domNode.style.display="none";u.pwdNode.domNode.style.display="none";}}if(a.authMode.USERNAME==(w&&w.did)||a.authMode.OAUTH==(w&&w.did)){u.parent.isNew?u.pwdNode.children[1].inputNode.setAttribute("placeholder",""):u.pwdNode.children[1].inputNode.setAttribute("placeholder","********");}l(u.parent);}}]),N("userNode","User Name",[L("tbUser")]),N("pwdNode","Password",[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:"tbPwd",type:"password",onvalueChange:function(){if(this._super){this._super();}l(this.parent.parent.parent);}}])]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-btnDelete",text:mstrmojo.desc(629,"Delete"),alias:"btnDelete",enabled:false,onclick:function(){var t=this.parent.parent,q=mstrApp.getRootController(),u=t.oid;var w=mstrmojo.desc(15041,"Do you want to delete this connector?");mstrmojo.confirm(w,{confirmBtn:{fn:function(){q.getDataService().deleteDBRole({success:function z(AD){var AC=q.getModel(),AB=S.find(AC.sourceItems,"oid",u),AA=S.find(AC.sourceList,"oid",u);S.removeIndices(AC.sourceItems,AB,1);S.removeIndices(AC.sourceList,AA,1);t.close();q.showPage(a.pageType.dataSelection);},failure:function x(AA){mstrApp.getRootController().displayError(AA.message);}},{objectid:u,objecttype:29});}}});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(246,"Export"),alias:"btnExport",enabled:false,onclick:function(){var t=this.parent.parent,u=t.detailInfo,q=u.nameNode.tbName.value,w=JSON.stringify({name:q,url:u.urlNode.tbURL.value,desc:u.descNode.tbDesc.value,introductionUrl:u.introductionNode.tbIntroduction.value,iconData:t.iconData,type:u.typeNode.type.selectedIndex,user:u.userNode.tbUser.value,oid:t.oid});if(j.isWS()){window.FormWrapper.saveConnectorFile(window.btoa(w));}else{d(w,"text/latex",q+".mstrcc");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),alias:"btnSave",enabled:false,onclick:function(){var x=this.parent.parent,AA=x.detailInfo,t=mstrApp.getRootController(),z=x.oid,w=x.name,q=AA.nameNode.tbName.value;if(w!==q&&C(q,t.getModel().sourceItems)){mstrApp.getRootController().displayError(mstrmojo.desc("6138","Cannot create object because the name is in use. Please use a different name."));return ;}t.getDataService().saveDBRole({success:function AB(AE){var AD=t.getModel(),AC=S.find(AD.sourceItems,"oid",z),AF=AD.sourceItems[AC];AF=P.copy({n:AA.nameNode.tbName.value,url:AA.urlNode.tbURL.value.trim(),connectorDesc:AA.descNode.tbDesc.value,introductionUrl:AA.introductionNode.tbIntroduction.value,iconData:x.iconData,type:AA.typeNode.type.selectedIndex,user:AA.userNode.tbUser.value,pwd:AA.pwdNode.tbPwd.value},AF);x.close();t.showPage(a.pageType.dataSelection);},failure:function u(AC){mstrApp.getRootController().displayError(AC.message);}},{dbroleinfo:c(x,z)});x.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(531,"Add"),alias:"btnAdd",enabled:true,onclick:function(){var u=this.parent.parent,w=u.detailInfo,q=mstrApp.getRootController();if(C(w.nameNode.tbName.value,q.getModel().sourceItems)){mstrApp.getRootController().displayError(mstrmojo.desc("6138","Cannot create object because the name is in use. Please use a different name."));return ;}q.getDataService().saveDBRole({success:function x(AC){var AB=q.getModel(),AD=AC.dbr.did;if(S.find(AB.sourceItems,"oid",AD)<0){var z,AE=w.nameNode.tbName.value,AF=w.urlNode.tbURL.value.trim(),AA=w.userNode.tbUser.value;z=P.copy(AB.customConnector,z);AB.sourceItems.push(P.copy({n:AE,url:AF,connectorDesc:w.descNode.tbDesc.value,introductionUrl:w.introductionNode.tbIntroduction.value,iconData:u.iconData,oid:AD,type:w.typeNode.type.selectedIndex,user:AA,pwd:w.pwdNode.tbPwd.value},z));AB.sourceList.push({n:AE,url:AF,oid:AD,user:AA,pageType:a.pageType.newConnector,initial:/[a-z]/i.test(AE.charAt(0))?AE.charAt(0).toUpperCase():"Others",checkConectivity:true,dbObjectsDisplayOptions:8,tags:["Customized"],oneTier:true,privilege:a.privilegeType.accessDatabase,title:function(){var AG="";if(!mstrApp.diParams.EnableURLImport){AG=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){AG=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}}return AG;},isEnabled:function(){return mstrApp.diParams.EnableURLImport;},sourceInfo:{sourceType:a.sourceType.bisource,name:"New connector",type:500,subtype:a.sourceSubtype.bisource}});AB.sourceList.sort(function(AK,AI){var AJ=AK.n,AH=AI.n,AL=AJ.charAt(0),AM=AH.charAt(0),AG=function(AN){return AN.charAt(0).toUpperCase()+AN.slice(1);};AJ=AG(AJ);AH=AG(AH);if(/[a-z]/i.test(AL)&&!/[a-z]/i.test(AM)){return -1;}else{if(!/[a-z]/i.test(AL)&&/[a-z]/i.test(AM)){return 1;}else{if(AJ>AH){return 1;}else{if(AJ<AH){return -1;}else{return 0;}}}}});}u.close();w.iconNode.imageNode.set("src","");q.showPage(a.pageType.dataSelection);},failure:function t(z){mstrApp.getRootController().displayError(z.message);}},{dbroleinfo:c(u,u.oid,true,u.isMstrcc)});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"btnCancel",enabled:true,onclick:function(){var q=this.parent.parent;q.close();}}],open:function O(u,q){if(this._super){this._super(u,q);}var w=this.detailInfo,t=this.fileBox,x=this.collapseBox.collapse;if(this.isNew){this.fileBox.set("visible",true);n(this);g(this.btnHbox,true);m(this.fileBox);x.set("visible",true);this.collapseBox.domNode.style.display="table";}else{if(!mstrApp.diParams.Admin&&!j.isLocalWS()){this.fileBox.set("visible",false);this.collapseBox.domNode.style.display="none";R.toggleClass(this.editorNode,"common-user",true);}b(this);g(this.btnHbox,false);}k(this);if(j.isLocalWS()){this.detailInfo.nameNode.tbName.domNode.removeAttribute("readOnly");}},close:function f(q){if(this._super){this._super(q);}}});mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierImageSelected=function(q){if(q&&q.data&&q.filename){mstrApp.getRootController().model.raiseEvent({name:"getSdkImageDossier",data:q});}};mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierFileSelected=function(q){if(q&&q.data&&q.filename){mstrApp.getRootController().model.raiseEvent({name:"getSdkFileDossier",data:q});}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(14503);mstrmojo.DI.DIFacebookPageItem=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFacebookPageItem",cssClass:"mstrmojo-di-fbpage-item",pg_id:null,picUrl:null,n:"",desc:"",likes:"",link:"",enabled:true,advancedProperties:null,markupString:'<div class={@cssClass} mstrAttach:click,mouseover,mouseout><div class="image" style="background-image:url({@picUrl});"></div><div><div class="name"><a href="{@link}" target="_blank" style="text-decoration: none;">{@en@n}</a><span class="desc">({@en@desc})</span></div><div class="info">{@likes} Likes</div><div class="info filter" style="color: #4099ff;">'+mstrmojo.desc(14503,"Filter post data by date...")+"</div></div></div>",markupSlots:{iconNode:function(){return this.domNode.firstChild;},nameNode:function(){return this.domNode.children[1].children[0];},likesNode:function(){return this.domNode.children[1].children[1];},advancedPropertiesNode:function(){return this.domNode.children[1].children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onclick:function(E){var F=E.e.target||E.e.srcElement;this.source.handleSelectionChange(this);if(F===this.advancedPropertiesNode){this.onadvancedSearchClick();}},postBuildRendering:function A(){if(this._super){this._super();}this.set("title",this.n);},setSelectedItem:function C(){mstrmojo.css.toggleClass(this.domNode,"selected",true);},setUnSelectedItem:function B(){mstrmojo.css.toggleClass(this.domNode,"selected",false);},onadvancedSearchClick:function D(){var E=this;var G=mstrApp.getRootController().dialogController.getCurrentZIndex()+1;var F=new mstrmojo.Editor({cssClass:"mstrmojo-di-facebookAdvancedEditor",cssText:"background: white; width:475px;",showTitle:true,title:mstrmojo.desc(3653,"Advanced Options"),zIndex:G,onOpen:function(){var H=this.curtainNode.style;H.background="black";H.opacity=0.5;H.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",alias:"editorContent",bindings:{advancedProperties:function(){return E.advancedProperties||{};}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var H=this.parent.parent;if(H.editorContent.onOk){H.editorContent.onOk();E.advancedProperties=H.editorContent.advancedProperties;}H.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var H=this.parent.parent;H.close();if(H.onCancel){H.onCancel();}}}]});F.open();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Editor","mstrmojo.Box","mstrmojo.Label","mstrmojo.CheckBox","mstrmojo.ui.Checkbox","mstrmojo.HTMLButton","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(221,308,5369,12829,12830,12831,12862,12863,12864,12865,12866,12867,12868,12869,12870,12871,12872,12873,13643,13644,13645,14752);var B=mstrmojo.DI.DIConstants.formsOptions,M=mstrmojo.array,H=mstrmojo.hash,Q=mstrmojo.DI.DIConstants;mstrmojo.DI.MultiFormItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.MultiFormItem",editor:null,formMap:null,visible:true,linkedColumnId:null,isRecursive:false,closeButtonVisible:true,children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",bindings:{text:function(){return this.parent.parent.formMap.alias||this.parent.parent.formMap.name;},title:function(){return this.parent.parent.formMap.alias||this.parent.parent.formMap.name;}}},{scriptClass:"mstrmojo.Pulldown",alias:"formPullDown",popupToBody:true,popupCssClass:"mfa-item-list",itemField:"fmn",itemIdField:"fmid",fixHeight:true,bindings:{popupZIndex:"this.parent.parent.editor.zIndex",linkedColumnId:"this.parent.parent.linkedColumnId"},preBuildRendering:function P(){var S=this.parent.parent,W=S.editor,U=S.formMap,V=U.forms,X=U.formId,R;if((W.attribute.isLinked)&&(X===W.idFormId)&&W.isMultiLinked&&(W.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE)){this.set("items",V);R=M.find(V,this.itemIdField,X);this.set("defaultSelection",R);}else{if(((W.attribute.isLinked)&&(X===W.idFormId)&&(!W.isMultiLinked))||S.isRecursive){this.enabled=false;this.set("items",[{fmid:0,fmn:W.idFormName}]);this.set("defaultSelection",0);}else{this.set("items",V);R=M.find(V,this.itemIdField,X);this.set("defaultSelection",R);}}},onvalueChange:function(){var U=this,S=U.selectedIndex,R=this.parent.parent;R.editor.onFormChanged(R.formMap,U.items[S].fmid,this.parent);}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"displayFormCheckbox",checked:false,label:"",oncheckedChange:function(){var R=this.parent.parent;R.formMap.displayForm=this.checked?"1":"0";var U=R.editor;M.forEach(U.tableIds,function(W){var V=U.tables[W];M.forEach(V.formMaps,function(X){if(X.formId===R.formMap.formId){X.displayForm=R.formMap.displayForm;}});});var S=H.walk("parent.parent.parent",R);if(S){S.set("displayFormCount",S.displayFormCount+(this.checked?1:-1));}},preBuildRendering:function P(){var R=this.parent.parent;this.set("checked",R.formMap.displayForm==="1");},bindings:{enabled:"this.parent.parent.parent.parent.parent.displayFormCount > 1 || !this.checked"}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-Editor-close",alias:"removeButton",onclick:function(){var R=this.parent.parent;R.editor.onRemoveMap(R.formMap);},preBuildRendering:function P(){this.visible=this.parent.parent.closeButtonVisible&&!this.parent.parent.isRecursive;}}]}]});mstrmojo.DI.DIMultiFormEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIMultiFormEditor",tables:null,tableIds:null,attribute:null,attributes:null,cssClass:"mstrmojo-di-multiformeditor",formMaps:null,formsOption:null,idFormId:"",idFormName:"",idMap:null,isShared:null,isMultiLinked:null,tableId:null,noButtonCls:true,linkedColumnId:"",displayFormCount:0,help:"Create_Multiform_Attribute_dialog_box.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",useRichTooltip:true,updateTooltipConfig:function(){var R=this.domNode,U=R.clientHeight;var S={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,refNode:R,bottom:U};S.content=this.title;this.set("richTooltip",S);},onclick:function(){var R=this.parent.parent;R.updateMapping();R.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var R=this.parent.parent;R.close();R.destroy();}}],children:[{scriptClass:"mstrmojo.VBox",alias:"boxContainer",cssClass:"mstrmojo-di-multiformeditor-boxContainer",children:[{scriptClass:"mstrmojo.VBox",alias:"tableAndAttributeNameContainer",children:[{scriptClass:"mstrmojo.HBox",alias:"attributeNameContainer",cssClass:"mstrmojo-di-multiformeditor-attributeNameContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"new-attribute-Label",text:mstrmojo.desc(12862,"New Attribute Name:")},{scriptClass:"mstrmojo.TextBox",alias:"attributeName",cssClass:"mstrmojo-di-multiformeditor-attributeName",onvalueChange:function(){var R=this.parent.parent.parent.parent;R.attribute.alias=this.value;}}]},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-multiformeditor-tablePulldown",alias:"tablesPullDown",popupToBody:true,itemField:"n",itemIdField:"id",visible:false,bindings:{popupZIndex:"this.parent.parent.parent.editor.zIndex"},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}var R=this.getPopupList();R.set("useRichTooltip",true);R.set("tooltipOpenDelay",0);},postselectedIndexChange:function(R){var U=this.parent.parent.parent;var W=R.value,S=R.valueWas,V;if(W!==S){V=U.tableIds[W];U.setEditorConfig(V);U.validateForms();}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-formName",text:""},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-formCategory",text:mstrmojo.desc(12864,"Form Category")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-multiformeditor-formMapsListHeader-displayForm",text:mstrmojo.desc(12865,"Display Form")}]},{scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-multiformeditor-formMapsList",visible:true,itemFunction:function K(c,Z,Y){var b=c.formId;var R=!((Y.parent.parent.isShared)&&(b===Y.parent.parent.idFormId));var S=(Y.items.length===1)?false:true;var X=Y.parent.parent,W=X.attributes,V=M.find(X.attributes,"columnId",c.columnId),U=V>=0?W[V].recursive:false;var a=new mstrmojo.DI.MultiFormItem({editor:Y.parent.parent,formMap:c,linkedColumnId:Y.parent.parent.linkedColumnId,parent:Y,closeButtonVisible:R&&S,isRecursive:U});return a;},bindings:{items:function(){var R=this.parent.parent.formMaps;M.forEach(R,function(S){S.name=S.name.replace(Q.workstation.filerBreakLine," ");});return R;},linkedColumnId:function(){return this.parent.parent.linkedColumnId;}}}]}],getDescription:function O(R){switch(R){case B.ADDTO_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12866,"Include in the Multi-form Attribute the following attribute forms:");case B.CREATE_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12866,"Include in the Multi-form Attribute the following attribute forms:");case B.EDIT_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12867,"Edit Multi-form Attribute with the following attribute forms:");}return"";},getTitle:function I(R){switch(R){case B.ADDTO_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12868,"Add to Multi-form Attribute");case B.CREATE_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12869,"Create Multi-form Attribute");case B.EDIT_MULTIFORM_ATTRIBUTE:return mstrmojo.desc(12870,"Edit Multi-form Attribute");}return"";},setEditorConfig:function N(V){this.set("tableId",V);var U=this.tables;var S=U[V];if(S.isShared){var R=mstrApp.getRootController().formsController.getLinkedColumnId(S.attribute,S.attributes,S.idFormId);if(R){this.set("linkedColumnId",R);}}this.set("idMap",S.idMap);this.set("idFormId",S.idFormId);this.set("idFormName",S.idFormName);this.set("formsOption",S.formsOption);this.set("attribute",S.attribute);this.set("attributes",S.attributes);this.set("isShared",S.isShared);this.set("formMaps",M.filter(S.formMaps,function(W){return W.remove!=="-1";}));this.set("displayFormCount",M.filter(S.formMaps,function(W){return W.displayForm==="1";}).length);this.set("isMultiLinked",S.isMultiLinked);},onOpen:function F(){this.setEditorConfig(this.tableIds[0]);this.validateForms();this.set("title",this.getTitle(this.formsOption));var S=this.boxContainer.tableAndAttributeNameContainer;var U=S.tablesPullDown;var W="";if(this.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE&&this.idMap){W=this.idMap.alias||this.idMap.name;}else{W=this.attribute.alias||this.attribute.name;}S.attributeNameContainer.attributeName.set("value",W);var R=this.tableIds,Z=this.tables;U.set("visible",false);if(this.formsOption===B.EDIT_MULTIFORM_ATTRIBUTE||this.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE){if(this.tableIds.length>1){var V=[],a,Y="";M.forEach(R,function(b){Y=Z[b].tableName;a={};a[U.itemIdField]=b;a[U.itemField]=Y;V.push(a);});U.set("items",V);var X=M.find(V,U.itemIdField,this.attribute.tableId);U.set("selectedIndex",X);U.set("visible",true);}}},preBuildRendering:function P(){this._super();this.setEditorConfig(this.tableIds[0]);},onFormChanged:function L(S,Z,a){S.formId=Z;var W,V,X=this;if(X.isMultiLinked){M.forEach(X.tableIds,function(b){W=X.tables[b];V=W.formMaps;M.forEach(V,function(c){if(c.name===S.name){c.formId=Z;}if(c.formId===X.idFormId){W.idMap=c;}});});}var R=!((this.isShared)&&(Z===this.idFormId));var U=(this.formMaps.length===1)?false:true;var Y=R&&U;a.removeButton.set("visible",Y);this.validateForms();if(Z===this.idFormId){this.idMap=S;W=X.tables[X.tableId];W.idMap=S;}},onRemoveMap:function A(R){R.remove="-1";this.boxContainer.formMapsList._remove(R);var V=this.tables[this.tableId];var U=V.formMaps;if(V.formsOption===B.CREATE_MULTIFORM_ATTRIBUTE){M.removeItem(U,R);}var S=this.validateForms();if(R.formId===this.idFormId||R.columnId===this.idMap.columnId){if(S[0].idMaps.length>0){this.idMap=S[0].idMaps[0];V.idMap=this.idMap;}else{this.idMap=null;V.idMap=null;}}},updateMapping:function E(){var S=this.validateAttributeName();var X=null;if(S){var R=mstrApp.getRootController(),U=R.getModel();var W=this;var V=0;var Y={success:function(){var a;var Z={success:function(){var b=Q.requestFlag.mapping|Q.requestFlag.sourceInfo|Q.requestFlag.relationship;R.getImportedDataEMMA(Q.actions.none,b);W.destroy();}};V++;if(V>=W.tableIds.length){if(U.hierarchyMFA){a=JSON.parse(U.hierarchyMFAMapping);R.dataService.changeMappingSourceTable(Z,a);U.set("hierarchyMFA",false);U.set("hierarchyMFAMapping",false);}else{Z.success();}}else{X=W.tables[W.tableIds[V]];R.formsController.updateMapping(X.formsOption,X.tableId,X.attribute,X.attributes,X.isShared,X.formMaps,X.idMap,Y);}}};if(W.tableIds&&W.tableIds.length){X=W.tables[W.tableIds[0]];R.formsController.updateMapping(X.formsOption,X.tableId,X.attribute,X.attributes,X.isShared,X.formMaps,X.idMap,Y);}}},setSubmitBtn:function D(Y){var S=this.btnHbox.submit;var V,b,a=true,Z=[],W=[],R=[],U=[],X="";for(V=0;V<Y.length;V++){b=Y[V];a=a&&b.valid;}S.set("enabled",a);if(a){S.title="";return ;}for(V=0;V<Y.length;V++){b=Y[V];if(b.idMaps.length===0){Z.push(b.tableName);}if(b.haveEmptyForm){W.push(b.tableName);}if(b.duplicateMaps.length>0){R.push(b.tableName);}if(!b.valid&&b.hasLat!==b.hasLong){U.push(b);}}if(Z.length>0){X=mstrmojo.desc(13643,"A column must be assigned to the ID form category within each table containing a multi-form attribute. Table ### violates this condition.");X=this.concatErrorMsg(Z,X);}else{if(R.length>0){X=mstrmojo.desc(13644,"The same Form Category cannot be used more than once within each table containing a multi-form attribute. Table ### violates this condition.");X=this.concatErrorMsg(R,X);}else{if(W.length>0){X=mstrmojo.desc(13645,"A column cannot have an empty Form Category  within any table containing a multi-form attribute. Table ### violates this condition.");X=this.concatErrorMsg(W,X);}else{if(U.length>0){X=mstrmojo.desc(14752,"### form category is missing.").replace("###",U[0].hasLat?mstrmojo.desc(7697,"Longitude"):mstrmojo.desc(7696,"Latitude"));}}}}S.title=X;},concatErrorMsg:function G(R,W){var S,U,V=R.length;if(V===1){U=R[0];}else{if(V===2){U=R[0]+" "+mstrmojo.desc(308,"and")+" "+R[1];}else{for(S=0;S<V-2;S++){U+=R[S];U+=", ";}U+=R[V-2];U+=" ";U+=mstrmojo.desc(308,"and");U+=" ";U+=R[V-1];}}W=W.replace("###",U);return W;},validateAttributeName:function C(){var a=this.attribute.alias;var Y=mstrApp.getRootController(),X=Y.model;if(!a||a.length<=0){Y.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));X.raiseEvent({name:"MappingsFetched"});return false;}if(a.length>=250){Y.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));X.raiseEvent({name:"MappingsFetched"});return false;}if(Q.invalidObjectNameCharsRegex.test(a)){Y.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",Q.invalidObjectNameChars));X.raiseEvent({name:"MappingsFetched"});return false;}var V=X.getAllMappings();var W,U,R,b,S;for(W=0;W<V.length;W++){R=V[W];var Z=false;for(U=0;U<this.attributes.length;U++){if(R.oid===this.attributes[U].oid){Z=true;break;}}if(Z){continue;}if(a===R.alias&&this.attribute.tp===R.tp){b=true;break;}}if(b){S=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");Y.displayError(S.replace("##",a));return false;}return true;},validateForms:function J(){var b,o,Z,W,U,n=null,l,k,h,V,a,g,S,X,e;var c=this.tables,Y=this.tableIds,m,d,R=[];for(k=0;k<Y.length;k++){b=[];o=[];U=[];V=false;X=false;e=false;a=false;g=false;d=Y[k];m=c[d];Z=m.formMaps;W=Z?Z[0].forms:[];W.push({fmid:this.idFormId,fmn:"ID"});M.forEach(Z,function(j){if(j.remove!=="-1"){U.push(j);}});Z=U;M.forEach(Z,function(j){V=V||(M.find(W,"fmid",j.formId)===-1);});W.pop();for(l=0;l<Z.length;l++){n=Z[l];if(n.formId===this.idFormId){b.push(n);}}for(l=0;l<Z.length;l++){n=Z[l];if(M.find(o,"formId",n.formId)===-1){var f=M.findMulti(Z,"formId",[n]);if(f.count>1){o.push({formId:n.formId,indices:f.indices});}}}for(l=0;l<Z.length;l++){n=Z[l];if(n.formId===Q.formCategory.latitude){X=true;}if(n.formId===Q.formCategory.longitude){e=true;}}h=((b.length===1)&&(o.length===0)&&!V);if(h){h=X===e;}if(h&&Z.length>1){S=[];M.forEach(this.attributes,function(p){if(p.isMultiForm){var j=p.subColumns;S=S.concat(j&&j.length>1?j:p);}else{S.push(p);}});a=M.some(Z,function(j){return M.some(S,function(p){if((p.columnId||p.did)===j.columnId&&p.recursive){return true;}});});g=M.some(Z,function(j){return M.some(j.forms,function(p){if(p.fmid===j.formId&&p.fmn==="Level"){return true;}});});if(a&&!g){h=false;}}R.push({tableName:m.tableName,valid:h,idMaps:b,duplicateMaps:o,haveEmptyForm:V,hasLat:X,hasLong:e});}this.setSubmitBtn(R);return R;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.List","mstrmojo.DI.DIConstants","mstrmojo.Table","mstrmojo.dom");mstrmojo.requiresDescs(12460);var B=mstrmojo.DI.DIConstants.pageType,D=mstrmojo.DI.DIConstants.sourceType,F=mstrmojo.DI.DIConstants.sourceType;var A=[{iconClass:"File",text:"File",pageType:B.file,sourceInfo:0},{iconClass:"File",text:"URL",pageType:B.file,sourceInfo:1},{iconClass:"Database",pageType:B.database,text:"Database",sourceInfo:{sourceType:D.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:F.qbSingleTable}},{iconClass:"SF",text:"Salesforce"},{iconClass:"File",text:"Sample"},{iconClass:"Eloqua",text:"Eloqua"},{iconClass:"analytics",text:"Google Analytics"},{iconClass:"bigQuery",text:"BigQuery"},{iconClass:"facebook",text:"Facebook"},{iconClass:"twitter",text:"Twitter"},{iconClass:"msDynamics",text:"MSFT Dynamics"},{iconClass:"OracleCRM",text:"Oracle CRM"},{scriptClass:"mstrmojo.Button",iconClass:"SugarCRM",text:"SugarCRM"},{iconClass:"Zendesk",text:"Zendesk"},{iconClass:"netsuit",text:"NetSuit"},{iconClass:"dropbox",text:"Clipboard"},{iconClass:"dropbox",text:"Dropbox"},{iconClass:"gdrive",text:"Google Drive"},{iconClass:"File",text:"Microstrategy"}];mstrmojo.DI.TableSources=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.TableSources",cssClass:"mstrmojo-di-table-sources",domSrc:null,enableDrag:false,clickhandler:null,showTitle:false,numOfcols:6,children:[{scriptClass:"mstrmojo.Button",alias:"closeBtn",text:"Close",innerIconClass:"mstrmojo-di-ts-close-btn",onclick:function(G){if(this.parent.onPreClose()){this.parent.close();}}},{scriptClass:"mstrmojo.Table",alias:"sourceTable",cssClass:"",rows:0,cols:0}],positionDialog:function E(){var G=mstrmojo.dom.position(this.domSrc,true);this.editorNode.style.left=Math.round(G.x)+"px";this.editorNode.style.top=Math.round(G.y+G.h)+"px";},preBuildRendering:function C(){if(this._super){this._super();}this.sourceTable.cols=this.numOfcols;this.sourceTable.rows=A.length/this.numOfcols;var H,J=[],L=0,I=0;var K=this;var G=function(){K.close();};for(H=0;H<A.length;H++){J.push({scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-table-sources-icons",iconClass:A[H].iconClass,innerIconClass:"mstrmojo-di-tablesources-text",text:A[H].text,slot:L+","+I,pageType:A[H].pageType,sourceInfo:A[H].sourceInfo,preclick:G,onclick:this.clickhandler});I++;if(I===this.numOfcols){I=0;L++;}}this.sourceTable.addChildren(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(12726,13016,13588,13589,13590,13591,13611);var B=mstrmojo.array,C=mstrmojo.dom;function A(){var D=[{dda:true,n:mstrmojo.desc(12726,"Connect Live"),desc:mstrmojo.desc(13588,"Access up-to-the-minute data via live queries."),hot:true},{dda:false,n:mstrmojo.desc(13589,"Import as an In-memory Dataset"),desc:mstrmojo.desc(13590,"Upload your data and build an in-memory dataset for rapid analysis."),hot:true}];return D;}mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog",callback:null,title:mstrmojo.desc(11922,"Data Access Mode"),cssClass:"mstrmojo-di-dda-confirm",selectedIndex:0,help:"",preBuildRendering:function(){var F=[],D=["mstrmojo-di-button","mstrmojo-WebButton"],E,G;if(this._super){this._super();}E=A();B.forEach(E,function(H){G=new mstrmojo.Button({cssClass:H.hot?D.concat(["hot",H.icon||""]).join(" "):D.concat(H.icon||"").join(" "),text:H.n,useRichTooltip:true,updateTooltipConfig:function(){var J=this,I=C.position(J.domNode);J.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:H.desc,top:Math.max(I.y+40,0),left:Math.max(I.x+I.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER};},slot:"containerNode",onclick:function(){if(this.hasOpenTooltip){this.hideTooltip();}this.parent.handleContinue(H);}});F.push(G);});this.addChildren(F);},handleContinue:function(F){var D=mstrApp.getRootController(),H=this.callback,G=D.getDDAController(),E=this;D.model.isDirectDataAccessBeforeSave=D.model.isDirectDataAccess;G.onToggleDDA(F.dda);G.askUserAboutDDA(true);if(!H){D.getPublishController().saveAndPublishNoConfirm();}else{if(H.onOK){H.onOK();}}E.close();},children:[{scriptClass:"mstrmojo.Label",cssClass:"confirm-title",text:mstrmojo.desc(13591,"How would you like to access your data?")}],close:function(){this._super();mstrmojo.array.forEach(this.children,function(D){D.hideTooltip&&D.hideTooltip();},this);this.destroy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Button","mstrmojo.array","mstrmojo.string");mstrmojo.requiresDescs(221,1442,13216,13217,13218,13219,13220,13221,13222,14712,14713,14714,14715);var F=mstrmojo.array,E=mstrmojo.string;function C(){var I=this,H=I.urlList,G=mstrApp.getRootController();G.getDataService().DISetURLWhiteListTask({success:function(J){if(J&&J.whiteList){J=E.decodeHtmlString(J.whiteList);F.forEach(J&&J.split(";"),function(K){K=K.trim();if(K&&K.length){H.addURL(K);}});}},failure:function(J){G.displayError(mstrmojo.desc(14713,"Get URL white list failed"),false,J&&J.message);}});}function D(){var I=this,H=I.urlList,G=mstrApp.getRootController(),J=H.urls.concat();G.getDataService().DISetURLWhiteListTask({success:function(){I.close();},failure:function(K){G.displayError(mstrmojo.desc(14714,"Save URL white list failed"),false,K&&K.message);}},{sv:E.encodeHtmlString(J.join(";"))});}mstrmojo.DI.DIWhiteListEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIWhiteListEditor",cssClass:"mstrmojo-di-DIWhiteListEditor",title:mstrmojo.desc(14712,"Set Allowed URLs"),help:"Interfaces_for_importing_data.htm",sourceName:"",isOneTier:false,sourceItem:null,children:[{scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",initValue:false,postBuildRendering:function(){this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());if(this._super){return this._super();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-button mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(531,"Add"),onclick:function(){var G=this.parent.urlInput.value;if(G.length===0){return ;}this.parent.urlList.addURL(G);this.parent.urlInput.set("value","");},visible:true},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-DIWhiteListEditor-title",text:mstrmojo.desc(14715,"List of Allowed URLs")},{scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"urlList",text:"",draggable:false,fileUpload:false,cssClass:"mstrmojo-di-url-box",visible:true,getFilesCnt:function(){var G=0;if(this.parent.urlInput.value&&this.parent.urlInput.value!==""){G=this.urls?this.urls.length+1:1;}else{G=this.urls?this.urls.length:0;}return G;},getFileUrl:function(G){if(G<this.urls.length){return mstrmojo.string.trim(this.urls[G]);}if(this.parent.urlInput.value!==""){return mstrmojo.string.trim(this.parent.urlInput.value);}return"";},onurlsChange:function(){if(this._super){this._super();}if(this.updateItemsCount){this.updateItemsCount(this.getURLCnt());var G=this.getURLCnt();this.updateItemsCount(G);if(G>1&&G<5){this.countNode.style.marginTop=G*(-33)+"px";}else{if(G>=5){this.countNode.style.marginTop="-140px";}}}}},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){D.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],onOpen:function B(){if(this._super){this._super();}C.call(this);},onClose:function A(){if(this._super){this._super();}mstrmojo.css.removeClass(this.sourceItem.domNode,"selected");this.destroy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Button","mstrmojo.DI.DIHelpers","mstrmojo.string");var E=mstrmojo.desc,K=mstrmojo.css,J=mstrmojo.DI.DIHelpers,F=mstrmojo.string;mstrmojo.requiresDescs(221,1442,13216,13217,13218,13219,13220,13221,13222,15229);function G(N){var O=N.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");return F.trim(O);}function H(N){return N.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");}function I(N,V,Q,R){var S=G(V);var P=G(Q);var U='<prs><ClientID v="'+S+'"/><ClientSecret v="'+P+'"/>';if(!N){var O=G(R);U+='<RedirectURL v="'+O+'"/>';}return U+"</prs>";}function A(S){var N=this;var U=N.oaDBRole;var W=mstrmojo.DI.DIConstants;var Q,O=mstrApp.getRootController(),V;if(S){Q=W.setDefaultOAuthParamCMD;}else{if(J.isServerBasedWS()){V=N.sourceItem.sourceInfo.type;if(V===W.sourceType.twitter){N.inputPanel.callbackURL.value="http://127.0.0.1";}else{if(V===W.sourceType.facebook){N.inputPanel.callbackURL.value="http://localhost/";}else{N.inputPanel.callbackURL.value="http://localhost";}}}Q=I(N.isOneTier,N.inputPanel.clientID.value,N.inputPanel.clientSecret.value,N.inputPanel.callbackURL.value);}U.oa=Q;O.getDataService().saveDBRole({errorMsg:E(13216,"Save OAuth parameters failed."),success:function(){},failure:function R(X){mstrApp.getRootController().displayError(this.errorMsg+X.message);},complete:function P(){N.close();}},{dbroleinfo:JSON.stringify(U)});}function B(R){var N=R.oaDBRole.oa;if(N!==""){var Q=N.indexOf("ClientID");var O=N.indexOf("RedirectURL");var S=N.substring(Q+"ClientID".length+4,N.indexOf('"/>',Q));var P=N.substring(O+"RedirectURL".length+4,N.indexOf('"/>',O));R.inputPanel.clientID.set("value",H(S));if(!R.isOneTier&&O>-1){R.inputPanel.callbackURL.set("value",H(P));}}}function D(){var O=this,N=mstrApp.getRootController().getDataService();N.populateDBRoles({errorMsg:E(13217,"Get OAuth information failed."),success:function(P){O.oaDBRole=P.dbrs[0];B(O);},failure:function(P){mstrApp.getRootController().displayError(this.errorMsg+P.message);}},{objectID:O.did});}function M(){var O=this;var Q=O.parent;var P=O.callbackURL.value;var R=O.clientID.value;var N=O.clientSecret.value;if(R&&R.length>0&&N&&N.length>0){if(J.isServerBasedWS()||Q.isOneTier||(P&&P.length>0)){Q.btns.ok.set("enabled",true);K.addClass(Q.btns.ok.domNode,"hot");}}else{Q.btns.ok.set("enabled",false);K.removeClass(Q.btns.ok.domNode,"hot");}}mstrmojo.DI.DIOAuthParaEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIOAuthParaEditor",cssClass:"mstrmojo-di-DIOAuthParaEditor",title:"",sourceName:"",isOneTier:false,did:"",sourceItem:null,oaDBRole:null,preConfigClientId:null,userDefined:false,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:3,cols:2,alias:"inputPanel",checkValue:function(N){if(N.value&&N.value.length>0){M.call(this);}else{this.parent.btns.ok.set("enabled",false);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"0,0",alias:"callbackURLLabel",text:E(13218,"Callback URL")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-textInput",slot:"0,1",alias:"callbackURL",onvalueChange:function(){this.parent.checkValue(this);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"1,0",text:E(13219,"Client ID")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-textInput",slot:"1,1",alias:"clientID",onvalueChange:function(){this.parent.checkValue(this);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-Label",slot:"2,0",text:E(13220,"Client Secret")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-OAuthParaEditor-textInput",slot:"2,1",alias:"clientSecret",type:"password",onvalueChange:function(){this.parent.checkValue(this);},postBuildRendering:function(){if(this._super){this._super();}this.inputNode.onclick=function(N){N.target.select();};}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-OAuthParaEditor-setDefault",alias:"setDefault",text:E(13221,"Reset to Default"),onclick:function(){A.call(this.parent,true);}},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-Button mstrmojo-WebButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),enabled:false,onclick:function(){A.call(this.parent.parent,false);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-Button mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],onOpen:function C(){if(this._super){this._super();}this.set("title",E(13222,"Set OAuth Parameters for ###").replace("###",this.sourceName));this.inputPanel.callbackURL.set("value","");this.inputPanel.clientID.set("value","");this.inputPanel.clientSecret.set("value","");D.call(this);this.setDefault.set("visible",(J.isWS()||J.isOnetier()));this.inputPanel.callbackURL.set("visible",!(J.isWS()||J.isOnetier()));this.inputPanel.callbackURLLabel.set("visible",!(J.isWS()||J.isOnetier()));},onClose:function L(){if(this._super){this._super();}mstrmojo.css.removeClass(this.sourceItem.domNode,"selected");}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIHelpers","mstrmojo.Editor","mstrmojo.Label","mstrmojo.VBox","mstrmojo.ui.Checkbox");mstrmojo.requiresDescs(14058,14059);var C=mstrmojo.DI.DIHelpers;function B(E){var D=mstrApp.getRootController();if(C.isServerBasedWS()){D.shutDownServerBased(E);}}mstrmojo.DI.ui.dialogs.ErrorDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.ErrorDialog",cssClass:"mstrmojo-di-ui-dialogs-ErrorDialog",showTitle:true,summary:"",errorMessage:"",detailErrorMessage:"",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-errorDialog-icon"},{scriptClass:"mstrmojo.VBox",alias:"errorSection",cssClass:"mstrmojo-errorDialog-errorSection",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-errorDialog-summary",alias:"summary",bindings:{text:"this.parent.parent.summary"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-errorDialog-description",bindings:{text:"this.parent.parent.errorMessage",visible:function(){var D=this.parent.parent.errorMessage;return D!==null&&D!=="";}}},{scriptClass:"mstrmojo.ui.Checkbox",cssClass:"mstrmojo-errorDialog-details-toggle",alias:"detailsToggler",oncheckedChange:function(){this.parent.details.set("visible",this.checked);this.parent.detailsHeader.set("text",this.checked?mstrmojo.desc(14059,"Hide Details"):mstrmojo.desc(14058,"Show Details"));this.parent.parent.positionDialog();}},{scriptClass:"mstrmojo.Label",alias:"detailsHeader",cssClass:"mstrmojo-errorDialog-details-header",text:mstrmojo.desc(14058,"Show Details"),onclick:function(){var D=this.parent.detailsToggler;D.set("checked",!D.checked);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-errorDialog-details",alias:"details",visible:false}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"okButton",onclick:function(){var D=this.parent.parent;D.close();if(D.showTitle===false){B("{}");}if(D.onOK){D.onOK();}}}],onOpen:function A(){if(this.showTitle===false){window.FormWrapper.setTitle("");}var E=!!this.detailErrorMessage,D=this.errorSection;D.detailsToggler.set("visible",E);D.detailsHeader.set("visible",E);if(E){D.detailsToggler.set("checked",false);D.details.domNode.innerHTML=this.detailErrorMessage;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(4531,8262,12437,12438,12439,15645);var D=mstrmojo.hash;var E={Automatic:0,Manual:3};var J={Automatic:-1,False:0,True:1};var H={Automatic:-1,False:1,True:2};var F={mps:{afb:J.False,sfb:H.False,fbf:E.Automatic}};var B=["mps"],L=function(Q,O){var P=this.parent.parent,M=P.cloneModel,N=M.mps||{};if(N[Q]!==O){N[Q]=O;if(Q==="fbf"&&O===E.Manual){N.afb=(N.afb===J.Automatic)?J.False:N.afb;N.sfb=(N.sfb===H.Automatic)?H.False:N.sfb;}P.set("dirty",true);}};var I=function(M){return M&&M.afb===J.False&&M.sfb===H.False&&M.fbf===E.Manual;};mstrmojo.ME.DerivedMetricOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedMetricOptions",cssClass:"mstrmojo-DerivedMetricOptions",dirty:false,init:function K(M){this._super(M);mstrmojo.css.addWidgetCssClass(this,"dme");},updateModel:function C(){var N=this.model,M=this.cloneModel,O=M.mps;if(O.fbf===E.Automatic){O.afb=J.Automatic;O.sfb=H.Automatic;}else{if(O.fbf===E.Manual){O.afb=O.afb===J.Automatic?J.False:O.afb;O.sfb=O.sfb===H.Automatic?H.False:O.sfb;}}O.dirty=true;N.mps=M.mps;},onOpen:function A(){var O=this.cloneModel||{};D.make(O,mstrmojo.Obj);var N=mstrmojo.hash.copy(this.model,mstrmojo.hash.copy(F)),P,M;for(P=0,M=B.length;P<M;P++){O.set(B[P],D.clone(N[B[P]]));}this.cloneModel=null;this.set("cloneModel",O);},onClose:function G(){this.set("dirty",false);delete this.cloneModel;},children:[{scriptClass:"mstrmojo.HBox",alias:"fbFlagBox",cssClass:"mstrmojo-DerivedMetricOptions-aggBox",children:[{scriptClass:"mstrmojo.Label",cssText:"white-space: nowrap; margin-right: 8px; vertical-align: top;",text:mstrmojo.desc(12437,"Aggregation And Subtotal Behavior:")},{scriptClass:"mstrmojo.Pulldown",alias:"fbFlag",cssText:"min-width: 100px;",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"v",items:[{n:mstrmojo.desc(4531,"Automatic"),v:E.Automatic},{n:mstrmojo.desc(8262,"Manual"),v:E.Manual}],bindings:{value:function(){return this.parent.parent.cloneModel.mps.fbf||E.Automatic;}},onvalueChange:function(M){if(M.value!==undefined&&M.valueWas!==undefined){L.call(this,"fbf",M.value);}}}]},{scriptClass:"mstrmojo.Box",cssText:"height: 30px",cssClass:"mstrmojo-DerivedMetricOptions-afbBox",children:[{scriptClass:"mstrmojo.CheckBox",alias:"afb",cssDisplay:"inline-block",label:mstrmojo.desc(12438,"Aggregate From Base"),bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.afb===J.True;}},onclick:function(M){var N=this.parent.parent.fbFlagBox.fbFlag.value;L.call(this,"afb",N===E.Automatic?J.Automatic:(this.checked?J.True:J.False));}},{scriptClass:"mstrmojo.CheckBox",alias:"sfb",cssDisplay:"inline-block",label:mstrmojo.desc(12439,"Subtotals From Base"),oncheckedChange:function(M){var N=this.parent.afb;if(M.value){if(!N.checked){N.checked=J.True;N.onclick();}if(N.inputNode){N.inputNode.checked=true;N.inputNode.disabled=true;}}else{if(N.inputNode){N.inputNode.disabled=false;}}},bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.sfb===H.True;}},onclick:function(){var M=this.parent.parent.fbFlagBox.fbFlag.value;L.call(this,"sfb",M===E.Automatic?H.Automatic:(this.checked?H.True:H.False));}}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var P=this.parent.parent,R=P&&P.opener;var Q=function(){P.updateModel();if(P.onOK){P.onOK();}P.close();};var M=P.cloneModel,N=M&&M.mps;if(I(N)&&R&&R.hasConditionFilter&&R.hasConditionFilter()){mstrmojo.warn(mstrmojo.desc(15645,"There is a filter defined for this metric, if you proceed this filter will be removed."),{confirmBtn:{t:mstrmojo.desc(212,"Continue"),fn:function O(){Q();R.clearConditionFilter();},hot:false},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:mstrmojo.emptyFn,hot:true}});}else{Q();if(R&&R.onMpsChange){R.onMpsChange();}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var M=this.parent.parent;M.close();}}]}]});mstrmojo.ME.DerivedMetricOptions.isNonAFB=I;}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.requiresDescs(2102,13475,13476,13477,13478,13479,13480,13481,13482,13483,13484,13485,13486,13487,13488,13489,13490,13491,13492,13493,13494,13495,13496,13497,13498,13499,13500,13501,13502,13503,13504,13505,13506,13507,13508,13509,13510,13511,13512,13513,13514,13515,13869,13870);var D=mstrmojo.desc;function C(){var E=[[D(13869,"Operators"),D(13475,"Find Tweets...")],[D(13476,"twitter search"),D(13477,'Containing both "twitter" and "search". This is the default operator.')],[D(13478,'"happy hour"'),D(13479,'Containing the exact phrase "happy hour".')],[D(13480,"love OR hate"),D(13481,'Containing either "love" or "hate" (or both).')],[D(13482,"beer -root"),D(13483,'Containing "beer" but not "root".')],[D(13484,"#haiku"),D(13485,'Containing the hashtag "haiku".')],[D(13486,"from:alexiskold"),D(13487,'sent from person "alexiskold".')],[D(13488,"to:techcrunch"),D(13489,'sent to person "techcrunch".')],[D(13490,"@mashable"),D(13491,'referencing person "mashable".')],[D(13492,"UN Security -council"),D(13493,'Containing "UN Security" but not "council"')],[D(13494,"superhero since:2010-12-27"),D(13495,'Containing "superhero" and sent since date "2010-12-27" (year-month-day).')],[D(13496,"ftw until:2010-12-27"),D(13497,'Containing "ftw" and sent up to date "2010-12-27".')],[D(13498,"movie -scary :)"),D(13499,'Containing "movie", but not "scary", and with a positive attitude.')],[D(13500,"flight :("),D(13501,'Containing "flight" and with a negative attitude.')],[D(13502,"traffic ?"),D(13503,'Containing "traffic" and asking a question.')],[D(13504,"hilarious filter:links"),D(13505,'Containing "hilarious" and linking to URLs.')],[D(13506,"news source:twitterfeed"),D(13507,'Containing "news" and entered via TwitterFeed')],[D(13508,"steelers&geocode=40.4417,-80.0000,25mi"),D(13509,"Containing steelers within 25 miles of Pittsburgh (40.4417 N, 80.0000 W)")],[D(13510,"Jon Stewart&result_type=popular"),D(13511,'Containing "Jon Stewart" and results which are popular')],[D(13512,"from:conanobrien&result_type=mixed"),D(13513,'Sent from person "Conan O Brien" and results which are both popular and recent')],[D(13514,"germany&lang=fr&count=5"),D(13515,'Containing "germany" and language is French (fr) and limit to five.')]];return E;}function B(){var E=C(),F,G=[];for(F=1;F<E.length;F++){G.push({key:E[F][0],value:E[F][1]});}return G;}mstrmojo.DI.DITwitterAdvancedOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DITwitterAdvancedOptions",cssClass:"mstrmojo-DI-DITwitterAdvancedOptions",title:mstrmojo.desc(13870,"Use Operators"),children:[{scriptClass:"mstrmojo.DataGrid",cssClass:"advOptsGrid",resizableColumns:false,items:B(),setupScrollNodes:function A(){this.scrollNode=this.scrollboxNode;},columns:[{headerText:D(13869,"Operators"),headerCss:"advOptsGrid-Col key header",colCss:"advOptsGrid-Col key",dataField:"key"},{headerText:D(13475,"Find Tweets..."),headerCss:"advOptsGrid-Col value header",colCss:"advOptsGrid-Col value",dataField:"value"}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox");mstrmojo.requiresDescs(218,219,3610,9161,10040,10041,13318,15481,13074,13075,15482,13077,13078,13079,15483,15484);var C=[mstrmojo.desc(15481,"The following attribute, which is currently used to personalize the dossier, is missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13074,"If you do not include it, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view."),mstrmojo.desc(15482,"The following attributes, which are currently used to personalize the dossier, are missing. ")+'<span style="color:red;"><u>'+mstrmojo.desc(13077,"If you do not include them, personalization will not be applied")+"</u></span>"+mstrmojo.desc(13075," and users could have access to more data than they are currently allowed to view.")],B=[mstrmojo.desc(13078,"If you still want to make this change please unmap the attributes by going to Share>Personalize."),mstrmojo.desc(13079,"If you still want to make this change please unmap the attribute from your Recipient List by going to Share>Deliver.")],A=[mstrmojo.desc(15483,"The following object is missing which could affect your dossier definition."),mstrmojo.desc(15484,"The following objects are missing which could affect your dossier definition.")];mstrmojo.qb.MissingColumnWarning=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.MissingColumnWarning",cssClass:"",title:mstrmojo.desc(3610),hasPT:false,isCube:true,warning:mstrmojo.desc(10040,"Some of the previously uploaded columns are missing"),details:mstrmojo.desc(10041,"If you do not import previously used columns, existing reports, documents and analyses might be affected. Do you still want to continue?"),onOpen:function(){var F=this.mappings,E=this.hasPT,D=this.buttonBox,G=(F.length>1)?1:0;this.set("title",mstrApp.isCloudPro?(E?mstrmojo.desc(9161,"Oops!"):mstrmojo.desc(13318,"Just Checking")):mstrmojo.desc(3610));this.list.set("items",F);this.warningLabel.set("text",E?C[G]:(mstrApp.isCloudPro?A[G]:this.warning));this.detailLabel.set("text",E?B[this.isCube?0:1]:this.details);D.YesButton.set("visible",!E);D.NoButton.set("visible",!E);D.OKButton.set("visible",E);},cssText:"width: 400px",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-title",alias:"warningLabel"},{scriptClass:"mstrmojo.List",alias:"list",cssClass:"mstrmojo-qb-MissingColumns-list",itemIdField:"did",itemMarkupFunction:function(D,F,G){var E='<div class="mstrmojo-qb-MissingColumns-bullet mstrmojo-qb-MissingColumns-Icon t'+D.tp+'">'+D.n+"</div>";return E;}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-MissingColumns-instruction",alias:"detailLabel"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-MissingColumns-buttonBox",slot:"buttonNode",alias:"buttonBox",cssText:"float:right;background:transparent;height:45px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Yes",text:mstrmojo.desc(219,"Yes"),alias:"YesButton",onclick:function(D){var F=this.parent.parent;var E=true;if(F.onOK){E=F.onOK();}if(E){F.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-No",text:mstrmojo.desc(218,"No"),alias:"NoButton",onclick:function(D){var E=this.parent.parent;if(E.onCancel){E.onCancel();}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-OK",alias:"OKButton",onclick:function(D){this.parent.parent.close();}}]}],onRender:function(){this.helpNode&&(this.helpNode.style.display="none");this.closeNode&&(this.closeNode.style.display="none");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.func","mstrmojo.string","mstrmojo.Box","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Label","mstrmojo._HasLayout","mstrmojo.Editor","mstrmojo.ui.CheckList","mstrmojo.ui.ToggleButton","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(10,1763,15120,15801);var L=mstrmojo.array,Z=mstrmojo.css,D=mstrmojo.dom,Q=mstrmojo.expr,U=mstrmojo.func,B=mstrmojo.string,R=mstrmojo.Button.newWebButton,b=mstrmojo.mstr.EnumDSSXMLObjectTypes;var W=mstrmojo.desc(1763,"Clear All");mstrmojo.vi.ui.IncCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._IsIncFetchList],{scriptClass:"mstrmojo.vi.ui.IncCheckList",allowUnlistedValues:false,cssClass:"elementsList",initElements:function Y(e){var d=this.ifDataHelper,c=this;if(!d){return ;}e=U.wrapMethods({success:function(f){c.clearSelect(true);c.set("items",[]);c.initScroll();c.addItems(f&&f.es);}},e);d.getItems(1,e,{hideFailureErr:true});},addItems:function N(c){this._super(c||[]);this.postAddItems();this.updateScrollbars();},postAddItems:mstrmojo.emptyFn});function F(c){return !L.filterOne(c.fs,function(d){return d.isbf&&(!!d.dtp?d.dtp:Q.mapBaseFormTypeToDataType(d.bftp))!==Q.DTP.CHAR;});}mstrmojo.vi.ui.ElementsBrowser=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.ElementsBrowser",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-ui-vi-ElementsBrowser {@cssClass}" style="{@cssText}"><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},searchBoxNode:function(){return this.domNode.firstChild;},buttonPanelNode:function(){return this.domNode.childNodes[1];},elementListNode:function(){return this.domNode.childNodes[2];}},layoutConfig:{h:{searchBoxNode:"26px",buttonPanelNode:"36px",elementListNode:"100%"},w:{searchBoxNode:"100%",buttonPanelNode:"100%",elementListNode:"100%"},xt:true},onBrowseElementsFailure:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.HBox",slot:"searchBoxNode",alias:"util",cssClass:"elemsBrowser-utils-bar",children:[{scriptClass:"mstrmojo.Box",cssClass:"eb-box-search",alias:"box",children:[{scriptClass:"mstrmojo.TextBox",alias:"searchBox",hint:mstrmojo.desc(10,"Search"),cssClass:"eb-searchBox",valueChangeDelay:300,onEnter:function I(){var d=this.value,c=this.parent.parent.parent;c.set("searchPattern",d);},onvalueChange:function P(){var d=this.value,c=this.parent.parent.parent;c.set("searchPattern",d);}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-clear",text:"",onclick:function(){var c=this.parent.searchBox;c.set("value","");c.cleanUp();c.focus();},bindings:{visible:"(this.parent.searchBox.value || '').length > 0"}}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15120,"View Selected"),cssClass:"eb-viewSelected",title:mstrmojo.desc(15120,"View Selected")},{scriptClass:"mstrmojo.ui.ToggleButton",alias:"toggleSelected",oncheckedChange:function J(){var c=this.parent.parent;c.onsearchPatternChange();}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonPanelNode",alias:"buttonPanel",cssClass:"elemsBrowser-button-panel",children:[{scriptClass:"mstrmojo.Button",text:W,title:W,alias:"clearAllBtn",cssClass:"eb-clearAll",useRichTooltip:true,updateTooltipConfig:function V(){var c=D.position(this.domNode);this.richTooltip={content:mstrmojo.desc(16192,"This function is currently not supported for non-text elements in the searching result."),cssClass:"vi-info vi-tooltip-C",left:c.x+60,top:c.y+5};},onclick:function(){var d=this.parent.parent,f=d.elementList;f.clearSelect(false);var c=d.getLocalSearchItems(),e=d.itemIdField;d.onItemsSelectionChange({added:[],removed:c,itemIdField:e});L.removeItems(d.selectedItems,e,c);},showTooltip:function C(f,d){var c=this.parent.parent;if(!this.enabled&&!B.isEmpty(c.getSearchBox().value)&&!F(c.attribute)){mstrmojo._HasTooltip.showTooltip.call(this,f,d);}}},]},{scriptClass:"mstrmojo.vi.ui.IncCheckList",alias:"elementList",slot:"elementListNode",itemIdField:null,bindings:{ifDataHelper:"this.parent.ifDataHelper",itemIdField:"this.parent.itemIdField"},postAddItems:function(){var c=this.parent.selectedItems||[];this.setSelectedItems(c);}}],itemIdField:"v",ifDataSource:null,searchPattern:null,ifDataHelper:null,attribute:null,attributeId:null,selectedItems:[],init:function(c){this._super(c);this.set("ifDataHelper",new mstrmojo.mstr.DocElementDataHelper({source:this.ifDataSource}));if(this.ifDataSource&&this.attribute){this.onattributeChange();}this.elementList.attachEventListener("selectionChange",this.id,"onElementsListchange");},updateClearAllBtnState:function O(){this.buttonPanel&&this.buttonPanel.clearAllBtn.set("enabled",(B.isEmpty(this.getSearchBox().value)||F(this.attribute))&&(this.getLocalSearchItems().length>0));},onElementsListchange:function H(j){var h=j&&j.added||[],f=j&&j.removed||[],g=this.elementList.items,c=this.itemIdField;if(!this.selectedItems){this.selectedItems=[];}var e=this.selectedItems,d=[],k=L.get(g,f);L.removeItems(e,c,k);var l;L.forEach(h,function(m){l=g[m];if(l&&L.find(e,c,l[c])<0){e.push(l);d.push(l);}});this.updateClearAllBtnState();if(k.length>0||d.length>0){this.onItemsSelectionChange({added:d,removed:k,itemIdField:c});}},onItemsSelectionChange:mstrmojo.emptyFn,updateBrowseConfig:function K(){var e=this,j=this.attributeId,c=this.attribute,h=this.searchPattern,g=function(l,m){l.set("textValid",!m);l.domNode.title=B.encodeHtmlString(m,true);};if(!j){return ;}this.ifDataHelper.set("items",null);var d={attributeID:j};if(h&&h!==""){d.searchPattern=h;d.matchCase=false;d.otp=c.t||b.Attribute;}this.onUpdateBrowseElementsParams(d);this.ifDataHelper.set("browseConfig",d);var k=e.getSearchBox();this.elementList.initElements({success:function(l){g(k,"");},failure:function(q){var n=parseInt(q.code,10)+4294967296,p=2147762269,l=2147762227,m=2147762262,o=2147894808;if(n===l||n===m){g(k,"");}else{if(n!==p){var t=(n!==o)?e.onBrowseElementsFailure.bind(e):null;var u={shortDesc:mstrmojo.desc(15402,"This object is not available at this time."),longDesc:q.message},w={title:mstrmojo.desc(15403,"Invalid Object"),buttons:[R(mstrmojo.desc(13197,"Got it"),t,false)]};mstrmojo.error(u,undefined,w);g(k,"");}else{g(k,q.message);}}}});var f=this.util&&this.util.toggleSelected;if(f){f.checked=false;Z.toggleClass(f.domNode,"checked",false);}this.updateClearAllBtnState();},isObjSearchable:function E(c){return !(c&&c.t===b.Consolidation);},onattributeChange:function A(){var c=this.attribute;this.attributeId=c&&c.did;this.searchPattern=null;this.selectedItems=[];this.updateBrowseConfig();var e=this.getSearchBox(),d=this.isObjSearchable(c);if(e){e.set("enabled",d);e.set("hint",d?mstrmojo.desc(10,"Search"):mstrmojo.desc(15801,"Not searchable"));}},getSearchBox:function M(){var c=this.util,d=this.util&&this.util.box;return d&&d.searchBox;},onifDataSourceChange:function G(){this.ifDataHelper.set("source",this.ifDataSource);this.ifDataHelper.set("items",null);},onsearchPatternChange:function X(){var d=this.util&&this.util.toggleSelected;if(!d||!d.checked){this.updateBrowseConfig();}else{var c=this.getLocalSearchItems();this.elementList.clearSelect(true);this.elementList.set("items",[]);this.elementList.addItems(c);this.updateClearAllBtnState();}},getLocalSearchItems:function S(){var d=[],c;if(this.searchPattern&&this.searchPattern!==""){var e=this.searchPattern.toLowerCase();L.forEach(this.selectedItems,function(f){c=(f.n||"").toLowerCase();if(c.indexOf(e)>-1){d.push(f);}});}else{d=(this.selectedItems||[]).slice(0);}return d;},_set_selectedItems:function a(g,c){var f=this.selectedItems,e=this.itemIdField;c=c||[];this.selectedItems=c;this.updateClearAllBtnState();if(f.length!==c.length){return true;}var d=L.intersection(f,c,e);return d.length!==f.length;},onselectedItemsChange:function(){this.elementList.setSelectedItems(this.selectedItems);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.warehouse.EnumObjectTypes");var K=mstrmojo.warehouse.EnumObjectTypes,H=mstrmojo.desc(12218,"Rename Object"),C=mstrmojo.desc(11457,"Please enter name:"),G=mstrmojo.desc(11440,"(lookup)"),D=mstrmojo.desc(518,"Attribute"),I=mstrmojo.desc(1821,"db conn"),J=mstrmojo.desc(11458,"Fact"),B=mstrmojo.desc(7755,"Table");function E(){var M=mstrmojo.string.trim(this.txtbox.value);if(!this.isNew){if(M===this.originalName){if(this.onCancel){this.onCancel();}this.close();return ;}}if(mstrApp.getRootController().validateName(this.tp||this.data.tp,M,((this.isNew?undefined:this.originalName)))){this.onOK(M);this.close();}}mstrmojo.architect.ui.editors.NameEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.NameEditor",cssClass:"mstrmojo-ar-ne",isNew:false,originalName:"",tp:undefined,txtbox:undefined,error:undefined,onOpen:function F(){var O=this.data,N=O.n||O.name,M=this.txtbox,P=M.domNode;N=(N.indexOf(G,0)>0)?N.substr(0,N.indexOf(G)):N;this.originalName=N;M.set("value",N);P.focus();P.select();switch(O.tp){case K.ATTRIBUTE:this.set("title",D+" - "+O.n);break;case K.FACT:this.set("title",J+" - "+O.n);break;case K.TABLE:this.set("title",B+" - "+O.n);this.warningBox.set("visible",true);break;case K.DBROLE:this.set("title",I);break;default:this.set("title",H);break;}},children:[{scriptClass:"mstrmojo.Label",text:C},{scriptClass:"mstrmojo.TextBox",alias:"txtbox",onkeyup:function A(M){switch(M.e.keyCode){case 13:E.call(this.parent);break;case 27:this.parent.close();break;default:break;}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",alias:"warningBox",visible:false,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:"This operation requries a schema update and can take a while",cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function L(){E.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function L(){var M=this.parent.parent;if(M.onCancel){M.onCancel();}M.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.DI.DIConfirmSaveEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIConfirmSaveEditor",cssClass:"workstation mstrmojo-ConfirmSave-Editor",title:"Application Schema",help:null,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:"Do you want to save the changes you made before you close Application Schema?",cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton nosave",text:mstrmojo.desc(11814,"Don't Save"),onclick:function(){this.editor.onDonotSave();this.editor.destroy();},bindings:{editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){this.editor.onSave();this.editor.destroy();},bindings:{editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.destroy();},bindings:{editor:"this.parent.parent"}}]}],onSave:mstrmojo.emptyFn,onDonotSave:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Editor");mstrmojo.requiresDescs(221,1442,3393,5282,9124,12407);var S=mstrmojo.hash,Y=mstrmojo.css,D=mstrmojo.dom,J=mstrmojo.desc,L=mstrmojo.array,C="on";var W={2219:[" IN "],2220:["[Not In]"]},B={525:[" LIKE "],526:["[Not Like]"],686:[" Contains "],2784:["[Not Contains]"],687:["[Begins With]"],2785:["[Not Begins With]"],688:["[Ends with]"],2786:["[Not ends with]"]},V=S.copy(W,{520:["="],612:["<>"],521:[">"],523:["<"],522:[">="],524:["<="],Between:[" between ","AND"],"Not between":["[Not Between]","AND"]});V=S.copy(B,V);var F=mstrmojo.desc(5282,"AND"),N={Between:[F],"Not between":[F]};var P={numeric:{2219:["1234,12345,123456"],2220:["1234,12345,123456"],520:["123456"],612:["123456"],521:["123456"],523:["123456"],522:["123456"],524:["123456"],Between:["1234","123456"],"Not between":["1234","123456"],525:["1%4_6"],526:["1%4_6"],686:["1%4_6"],2784:["1%4_6"],687:["1%4_6"],2785:["1%4_6"],688:["1%4_6"],2786:["1%4_6"]},vchar:{2219:["abcde,abcdef"],2220:["abcde,abcdef"],520:["abcde"],612:["abcde"],521:["aa"],523:["zz"],522:["aa"],524:["zz"],Between:["aa","zz"],"Not between":["mn","zz"],525:["a%d_f"],526:["a%d_f"],686:["a%d_f"],2784:["a%d_f"],687:["a%d_f"],2785:["a%d_f"],688:["a%d_f"],2786:["a%d_f"]},date:{2219:["2014-02-14,2014-12-25 00:00:00"],2220:["2014-02-14,2014-12-25 00:00:00"],520:["2014-12-25"],612:["2014-12-25"],521:["2014-12-25"],523:["2014-12-25"],522:["2014-12-25"],524:["2014-12-25"],Between:["2014-02-14","2014-12-25"],"Not between":["2014-02-14","2014-12-25"],525:["2014-0_-25%"],526:["2014-0_-25%"],686:["2014-0_-25%"],2784:["2014-0_-25%"],687:["2__4-"],2785:["2__4-"],688:["-25%"],2786:["-25%"]}};var R=",",I="'",X='"',G={"'":1,'"':1},M="(",O=")";function H(b){var a=b.length;b=b.substring(G[b[0]]?1:0,(G[b[a-1]]?a-1:a));return[I,b,I].join("");}function K(b){var a=b.toString();if(a.match(/#\d+#/)){return a;}return"#"+a+"#";}function Q(c){var b=c.split(R),a=[];L.forEach(b,function(d){a.push(H(d));});return a.join(R);}function A(b,a){var d,e=[],c=b;if(a){d=b.split(R);L.forEach(d,function(f){e.push(X+f+X);});c=e.join(R);}return M+c+O;}mstrmojo.qb.FilterValueEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FilterValueEditor",init:function U(a){this._super(a);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.filterValue)||"Enter_Value_dialog_box.htm";},zIndex:100,title:mstrmojo.desc(9124,"Enter Value"),cssClass:"mstrmojo-qb-filtervalue-editor",help:"",column:null,operatorID:null,paraNum:null,MAX_PARA_NUM:2,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filtervalue-box",alias:"box",children:[{scriptClass:"mstrmojo.Label",alias:"label0",cssClass:"mstrmojo-qb-filtervalue-name1",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input0",cssClass:"mstrmojo-qb-filtervalue-textbox1",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"label1",cssClass:"mstrmojo-qb-filtervalue-name2",cssDisplay:""},{scriptClass:"mstrmojo.TextBox",alias:"input1",cssClass:"mstrmojo-qb-filtervalue-textbox2",cssDisplay:""}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-filterexample-box",alias:"exampleBox",children:[{scriptClass:"mstrmojo.Label",alias:"exampleLabel",cssClass:"mstrmojo-qb-example-label",text:mstrmojo.desc(3993,"Example:")},{scriptClass:"mstrmojo.Label",alias:"exampleLabel0",cssClass:"mstrmojo-qb-example-name0",cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleAndLabel",cssClass:"mstrmojo-qb-example-and-label",text:F,cssDisplay:""},{scriptClass:"mstrmojo.Label",alias:"exampleLabel1",cssClass:"mstrmojo-qb-example-name1",cssDisplay:""}]},{scriptClass:"mstrmojo.Label",alias:"err",cssClass:"mstrmojo-qb-filtervalue-errmsg",text:""},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),alias:"ok",onclick:function Z(){var l=this.parent.parent,e=l.box,a=l.operatorID,k,n=l.isDateTime,q=l.isBigDecimal,b=l.isString,h,p=l.paraNum,d=[],c,o="["+l.column+"]",j,g=B.hasOwnProperty(a),m=W.hasOwnProperty(a),f;if(p<=0||p>l.MAX_PARA_NUM){return ;}for(c=0;c<p;c++){k=e["input"+c].value;if(k===""){return ;}if(n&&!g){k=Q(k);}else{if(q){k=K(k);}}if(m){k=A(k,b);}else{if(g||b){k=X+k+X;}}d.push(k);}f=V[a];if(!f||f.length!==p){return ;}for(c=0,j=[o];c<p;c++){j.push(" ",f[c]," ",d[c]);}h=j.join("");mstrApp.getRootController().parseExpression({expr:h,qbrex:2,cIndex:1,vo:1},{success:function(u){if(u&&u.mi){var t=u.mi,w=t.reject_error_description;if(w){if(n&&t.reject_error_code===-2147214817){w=J(12407,"(Please enter a valid date/time value.)");}l.err.set("text",w);}else{l.close();mstrApp.getRootController().addNewFilter({et:"*",expr:t.items,n:h,sqltp:t.exp.sqltp});mstrApp.getRootController().refreshConditionDialog();}}}});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancel",onclick:function(a){var b=this.parent.parent;if(b.onCancel){b.onCancel();}b.close();}}]}],onOpen:function E(){var e=this.box,l=this.paraNum,k=this.MAX_PARA_NUM,c,m,o,n,b=this.buttonBox,h,p=this.exampleBox,d=p.exampleAndLabel,f,j=this.isDateTime,a=this.isString;n=[this.n].concat(N[this.operatorID]||[]);var g=j?"date":(a?"vchar":"numeric");f=P[g][this.operatorID]||[];this.err.set("text","");e.input0.focus();Y.toggleClass(this.editorNode,"multi",l>1);for(c=0;c<k;c++){m=e["label"+c];m.set("text",n[c]||"");o=e["input"+c];o.set("value","");Y.toggleClass(m.domNode,C,c<l);Y.toggleClass(o.domNode,C,c<l);m=p["exampleLabel"+c];m.set("text",f[c]||"");Y.toggleClass(m.domNode,C,c<l);Y.toggleClass(d.domNode,C,c<l);}if(D.isIE7||D.isIE8){h=[b.ok,b.cancel];for(c=0;c<h.length;c++){h[c].inputNode.style.minWidth=(l===1)?"70px":"";}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(2102,4447,7559,14931,14932,14933,14934,8726,762,6792,2554,14935,14936,14952,14953,8727,14954,14955,14965,14967,15083);var C=mstrmojo.DI.DIConstants,D=mstrmojo.hash;function A(E,I,G){var F=document.createElement("div");F.innerHTML=I;F.className="hintTitle";E.appendChild(F);var H=document.createElement("div");H.innerHTML=G;H.className="hintContent";E.appendChild(H);}mstrmojo.DI.ui.dialogs.DIHadoopGatewayManagerDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHadoopGatewayManagerDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog",title:mstrmojo.desc(14906,"Manage Hadoop Gateway"),items:null,sh:null,update:function(){var E=this;controller=mstrApp.getRootController().getHadoopGatewayController();controller.listGateways({success:function(F){if(F&&F.length){E.set("items",F[0].entity);}}});},onOpen:function(){var F=this;var E=F.grid;sh=setInterval(function(){controller=mstrApp.getRootController().getHadoopGatewayController();var G=false;controller.listGateways({success:function(I){if(I&&I.length){var H;if(E&&E.domNode){H=E.scrollNode.scrollTop;}F.set("items",I[0].entity);if(H!==null){E.scrollNode.scrollTop=H;}}}},G);},3000);},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}],onClose:function(){clearInterval(sh);var E;E=mstrApp.getRootController().getHadoopController();E.updateDBRoleEditor();},children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-addBtn mstrmojo-WebButton hot",text:mstrmojo.desc(4447,"Add"),onclick:function(){var E=this.parent;mstrApp.getRootController().showDialog(C.dialogType.hadoopGatewayDialog,{afterSave:function(){E.update();}});}},{scriptClass:"mstrmojo.DataGrid",alias:"grid",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid",bindings:{items:"this.parent.items"},postBuildRendering:function B(){mstrmojo.DataGrid.prototype.postBuildRendering.call(this);if(this.items&&this.items.length===0){A(this.itemsContainerNode,mstrmojo.desc(14965,"No Hadoop Gateway"),mstrmojo.desc(14967,"Click 'Add' to start configuration for a new Hadoop Gateway Manager"));}},columns:[{headerText:mstrmojo.desc(7559,"Name"),colCss:"nameCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col name",onclick:function(){var E=this.parent.parent.parent;mstrApp.getRootController().showDialog(C.dialogType.hadoopGatewayDialog,{data:this.parent.data,afterSave:function(){E.update();}});},bindings:{text:"this.parent.data.hgosName"}}},{headerText:mstrmojo.desc(14931,"Host"),colCss:"hostCol",dataFunction:function(E){return E.config.hostAddr;}},{headerText:mstrmojo.desc(16,"Port"),colCss:"portCol",dataFunction:function(E){return E.config.tcpPort;}},{headerText:mstrmojo.desc(14932,"Hadoop NameNode"),colCss:"namenodeAddrCol",dataFunction:function(E){return E.config.namenodeAddr;}},{headerText:mstrmojo.desc(14933,"HDFS Port"),colCss:"hdfsRpcPortCol",dataFunction:function(E){return E.config.hdfsRpcPort;}},{headerText:mstrmojo.desc(14934,"WebHDFS Port"),colCss:"hdfsHttpPortCol",dataFunction:function(E){return E.config.hdfsHttpPort;}},{headerText:mstrmojo.desc(8726,"Status"),colCss:"statusCol",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{text:function(){var E=this.parent.data.status;if(E==="INITIAL"||E==="Unavailable"){return mstrmojo.desc(14952,"Undeployed");}else{if(E==="BUSY"){return mstrmojo.desc(14953,"Running");}else{if(E==="Available"){return mstrmojo.desc(8727,"Stopped");}else{if(E==="Deploying"){return mstrmojo.desc(14954,"Deploying...");}else{if(E==="Starting"){return mstrmojo.desc(15083,"Starting...");}}}}}},cssClass:function(){var E=this.parent.data.status;if(E==="BUSY"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusRunning";}else{if(E=="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusStopped";}else{if(E==="INITIAL"||E==="Unavailable"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusUndeployed";}else{if(E==="Deploying"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusDeploying";}else{if(E==="Starting"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusDeploying";}}}}}}}}},{headerText:mstrmojo.desc(762,"Action"),colCss:"actionCol",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col action cf",children:[{scriptClass:"mstrmojo.Button",cssDisplay:"inline-block",bindings:{text:function(){var E=this.parent.data.status;if(E==="Available"){return mstrmojo.desc(14935,"Undeploy");}else{return mstrmojo.desc(14936,"Deploy");}},enabled:function(){var E=this.parent.data.status;if(E==="Available"||E==="Unavailable"||E==="INITIAL"){return true;}else{return false;}},visible:function(){var E=this.parent.data.status;if(E==="Deploying"||E==="Starting"){return false;}else{return true;}},cssClass:function(){var E=this.parent.data.status;if(E==="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-undelpoy";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-delpoy";}}},onclick:function(){var E={success:function(M){J.close();},failure:function(M){J.close();}};var G=this.parent.data.status;if(G!=="Available"){var L=mstrApp.getRootController().getHadoopGatewayController(),K=this.parent.parent.data,J,I={};function H(){var N={success:function(){if(J){J.close();}}};var M=D.copy(I,K.config);M.sshPort=22;L.updateGateway(M,N);L.installGateway(M,E);}L.confirmAuthentication(function(M,N){J=this;I.user=M;I.passwd=N;H();});}else{var L=mstrApp.getRootController().getHadoopGatewayController(),K=this.parent.parent.data,J,I={};function F(){var M=D.copy(I,K.config);L.uninstallGateway(M,E);}L.confirmAuthentication(function(M,N){J=this;I.user=M;I.passwd=N;F();});}}},{scriptClass:"mstrmojo.Button",cssDisplay:"inline-block",bindings:{text:function(){var E=this.parent.data.status;if(E==="Available"){return mstrmojo.desc(6792,"Start");}else{return mstrmojo.desc(2554,"Stop");}},visible:function(){var E=this.parent.data.status;if(E==="Available"||E==="BUSY"){return true;}else{return false;}},cssClass:function(){var E=this.parent.data.status;if(E==="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-start";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-stop";}}},onclick:function(){var E=this.parent.data.status;if(E==="Available"){var L=mstrApp.getRootController().getHadoopGatewayController(),J=this.parent.parent.parent.parent,I=this.parent.parent.data,H,G={};function F(){var M=D.copy(G,I.config);L.startGateway(M,{success:function(){H.close();}});}L.confirmAuthentication(function(M,N){H=this;G.user=M;G.passwd=N;F();});}else{var L=mstrApp.getRootController().getHadoopGatewayController(),J=this.parent.parent.parent.parent,I=this.parent.parent.data,H,G={};function K(){var M=D.copy(G,I.config);L.stopGateway(M,{success:function(){H.close();}});}L.confirmAuthentication(function(M,N){H=this;G.user=M;G.passwd=N;K();});}}}]}},{headerText:mstrmojo.desc(14955,"Logs"),colCss:"LogsCol",dataWidget:{scriptClass:"mstrmojo.Button",bindings:{cssClass:function(){var E=this.parent.data.status;if(E==="BUSY"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-logs normal";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-logs disable";}},title:function(){var E=this.parent.data.status;if(E==="BUSY"){return this.parent.data.config.hostAddr+":/opt/hgos-0.1.0/log/hgos.out";}else{return"";}}}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Box","mstrmojo.Editor","mstrmojo.Widget","mstrmojo.hash");var G=mstrmojo.hash;mstrmojo.requiresDescs(12705,14760);function I(U){var R="";var S;for(S in U){if(U.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(U[S]);}}return R;}function M(U){var R="";var S;for(S in U){if(U.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(U[S]);}}return R;}function D(S,X,Z,W,Y,R){if(R.showProgress){mstrApp.showProgress(R);}var U=X+"?"+I.call(this,W);var V={taskId:"DataWranglerServer",command:U};if(S){V.postData=M.call(this,Y);}window.setTimeout(function(){mstrApp.serverProxy.request(mstrmojo.func.wrapMethods({success:mstrmojo.emptyFn,complete:function(){if(R.showProgress){mstrApp.hideProgress();}},failure:mstrmojo.emptyFn},Z),V,false,{});},0);}mstrmojo.Refine.DataService=mstrmojo.declare(mstrmojo.Obj,null,{projectID:null,refineServerURL:null,getPreviewData:function J(U,R,S){D.call(this,true,"command/core/get-rows",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getColumns:function Q(S,R){D.call(this,false,"command/core/get-models",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getHistory:function E(S,R){D.call(this,false,"command/core/get-history",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getOperations:function F(S,R){D.call(this,false,"command/core/get-operations",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getProcesses:function C(U,S,R){D.call(this,false,"command/core/get-processes",U,S,null,{showProgress:true,progressValue:R.progress,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},applyOperations:function L(U,R,S){D.call(this,true,"command/core/apply-operations",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacets:function A(U,R,S){D.call(this,true,"command/core/compute-facets",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacetsQuiet:function N(U,R,S){D.call(this,true,"command/core/compute-facets",U,R,S,{showProgress:false,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeClusters:function B(U,R,S){D.call(this,true,"command/core/compute-clusters",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},massEdit:function K(U,R,S){D.call(this,true,"command/core/mass-edit",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},undoRedo:function P(U,R,S){D.call(this,true,"command/core/undo-redo",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},addSampleData:function O(U,R,S){D.call(this,true,"command/core/append-sample",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},setSampleData:function H(U,R,S){D.call(this,true,"command/core/set-sample",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getSampleStatus:function H(U,R,S){D.call(this,true,"command/core/get-sample",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},refreshSampleData:function H(U,R,S){D.call(this,true,"command/core/refresh-sample",U,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(14760,"Refreshing...")});},});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.Editor","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(118,221,1162,8374,8513,10071,12580,14900,14901,14902,14614,15210,15211);var B=mstrmojo.hash,J=mstrmojo.array,K=mstrmojo.string,F=mstrmojo.DI.DIHelpers,L=mstrmojo.DI.DIConstants;var C="PWDHIDDEN123!@#";var I=[{did:2,n:mstrmojo.desc(14900,"Username and Password")}];function H(N,Q){var O=this,P,M;M={scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",cssDisplay:"inline-block",text:N},B.copy({cssDisplay:"inline-block"},Q)]};P=O.addChildren([M])[0];return P.children[1];}function E(){var N=this,M=N.dbrole;H.call(N,mstrmojo.desc(8513,"User:"),{scriptClass:"mstrmojo.TextBox",value:M&&M.ln||"",onvalueChange:function(){N.checkValid();}});H.call(N,mstrmojo.desc(1162,"Password:"),{scriptClass:"mstrmojo.TextBox",type:"password",value:!!M?C:""});H.call(N,mstrmojo.desc(14901,"Connection Name:"),{scriptClass:"mstrmojo.TextBox",value:M&&M.n||"",onvalueChange:function(){N.checkValid();}});}function A(N){var M,O;M=J.filter(this.children,function(P){return P.cssClass&&P.cssClass.indexOf("ctrl-box")>=0;});if(N<M.length){O=M[N];}if(O&&O.children.length===2){return O.children[1];}return null;}function D(R,Q){var N=mstrApp.getRootController().getModel(),O=N.authDBRoles,M,P;M=J.find(O,"n",R);if(M<0){P=true;}else{P=O[M].did===Q;}return P;}function G(){var M=mstrApp.getRootController(),P=this,O=A.call(P,0),R=O.items[O.selectedIndex],N=P.dbrole,Q;if(R.did===2){if(!N){N={tp:29,stp:7429,writable:"1",shared:"0",dbr_type:"6",owned:"1",connstr:"AuthMode=Basic;",db_type:7700,cefu:1,driverMode:1,dbms:L.urlAuthDBMSId};}N.ln=K.trim(A.call(P,1).value);Q=A.call(P,2);if(Q.value!==C){N.password=Q.value;}N.n=K.trim(A.call(P,3).value);if(!D(N.n,N.did)){M.displayError(mstrmojo.desc(14614,"This name already exists. Please choose a different name."));return ;}if(P.sharedConnection.isChecked()){N.shared="1";}else{N.shared="0";}M.dataService.saveDBRole({success:function(){M.getAuthenticationDBRoles();P.close();},failure:function(S){if(F.isWS()){M.displayError(null,false,S&&S.message,null,mstrmojo.desc(15210,"Add a New Connection"),mstrmojo.desc(15211,"Unexpected error occurred."));}else{M.displayError(mstrmojo.desc(12580,"Unexpected error occurred during an operation. Please try again."),false,S&&S.message);}}},{dbroleinfo:JSON.stringify(N)});}}mstrmojo.DI.ui.dialogs.DIAuthenticationDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAuthenticationDialog",cssClass:"mstrmojo-DI-ui-dialogs-DIAuthenticationDialog",title:mstrmojo.desc(8374,"Connection"),onOpen:function(){var N=this.dbrole;var M=false;var O=H.call(this,mstrmojo.desc(14902,"Credential Type:"),{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:I});O.set("selectedIndex",0);E.call(this);if(N){M=!!parseInt(N.shared,10);}this.addChildren([{scriptClass:"mstrmojo.CheckBox",cssClass:"sharedConnection",cssDisplay:"block",visible:false,alias:"sharedConnection",label:mstrmojo.desc(10071,"Share this connection with all users"),checked:M}]);this.checkValid();},checkValid:function(){var N=this,M=N.btnHbox&&N.btnHbox.children[0],P,O,Q;O=K.trim(A.call(N,1).value);Q=K.trim(A.call(N,3).value);P=O.length&&Q.length;if(M){M.set("enabled",!!P);}},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){G.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var M=this.parent.parent;M.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor");function C(E,F){var D=this;if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(E,F,{silent:true});}else{mstrmojo.xhr.request("POST",D.path,F,E,undefined,D.XServer,D.baseParams);}}function A(H,I,G,D){var E=this,F={taskId:"createFolder",taskContentType:"json",folderID:H,name:I,description:G};C.call(E,F,D);}function B(E,I,F){if(!E){mstrmojo.alert(mstrmojo.desc(3380));return false;}var G=this,H=G.fId,D={success:function(J){G.contPanel.name.set("value","");G.contPanel.desc.set("value","");if(G.okFn){G.okFn(J,F);}},failure:function(J){var K="";if(J.getResponseHeader){K=J.getResponseHeader("X-MSTR-TaskFailureMsg");}else{if(J.message){K=J.message;}}K&&mstrmojo.alert(K);}};if(mstrApp.isSingleTier&&this.dp){this.dp.newFolder(H,E,I,D);}else{A.call(G,H,E,I,D);}}mstrmojo.NewFolderEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.NewFolderEditor",cssClass:"mstrmojo-NewFolderEditor",title:mstrmojo.desc(663,"Create Folder"),help:"Create_a_new_folder.htm",navigateAfter:false,okFn:mstrmojo.emptyFn,path:mstrConfig.taskURL,fId:null,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,G=E&&E.opener,D=E.contPanel.name.value,F=E.contPanel.desc.value;if(!B.call(E,D,F,E.navigateAfter)){E.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.requiresDescs(373,12460,12856,12857,12858,12859);var A="databaseImportDialog";var B=mstrmojo.DI.DIConstants;mstrmojo.DI.DIDatabaseImportOption=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.Editor",id:A,showTitle:false,cssClass:"mstrmojo-di-database-import",zIndex:999,positionDialog:function C(){var D=mstrmojo.dom.position(this.domSrc,true);this.editorNode.style.left=Math.round(D.x)+"px";this.editorNode.style.top=Math.round(D.y+D.h)+"px";},children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12856,"Import from Database"),cssClass:"mstrmojo-di-database-import-title"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12857,"Individual Tables"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database1",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.qbSingleTable});}},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12858,"Build a Query using Multiple Tables"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database2",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.querybuilder});}},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(12859,"Type your own Query script"),cssClass:"mstrmojo-di-table-sources-icons",iconClass:"Database3",onclick:function(){this.parent.set("visible",false);mstrApp.getRootController().showPage(B.pageType.database,{sourceType:B.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:B.xdaType.ffsql});}},{scriptClass:"mstrmojo.Button",alias:"closeBtn",text:mstrmojo.desc(373,"Back"),innerIconClass:"mstrmojo-di-ts-close-btn",onclick:function(){if(this.parent.onPreClose()){this.parent.close();}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo._HasPopup","mstrmojo.ListBase","mstrmojo.Popup","mstrmojo.Editor","mstrmojo.SuggestionList");function D(b,Y){var a=this.list,W=a.selectedIndex,V=a.items.length,X=b?V-1:0;if(W===X){a.clearSelect();return ;}if(W===null||W<0){W=b?0:V-1;}else{W+=b?1:-1;}if(Y){var Z=a.items[W];while(Z&&Z.type==="dummy"){if(W===X){a.clearSelect();return ;}W+=b?1:-1;Z=a.items[W];}}a.singleSelect(W);}mstrmojo._HasSuggestion=mstrmojo.provide("mstrmojo._HasSuggestion",mstrmojo.hash.copy(mstrmojo._HasPopup,{blockBegin:1,blockCount:-1,suggestCount:15,autoSelect:true,itemField:"n",candidates:null,suggestionShown:false,suggestionItems:null,_last_hit:null,_request_pattern:null,browseItemVisible:false,folderLinksContextId:25,browsableTypes:"1,8",REQUEST_THRESHOLD:20,noCache:false,disableClick:false,getCandidatesThroughTaskCall:mstrmojo.emptyFn,onSuggestionItemSelect:function J(V){this.hideSuggestion();},getSearchPattern:function U(){return"";},getSuggestionPos:function N(){return{left:"100px",top:"100px"};},getSuggestionTarget:function G(){return this;},showSuggestion:function B(W){var V=this.getSuggestion(W);if(!this.noCache&&V!==-1){this.updateSuggestion(V);}},hideSuggestion:function C(){this.suggestionShown=false;if(this.suggestionPopup.visible){this.suggestionPopup.close();}},getSelected:function M(){return(this.suggestionShown)?this._lastOpened.getSelected():null;},nextHighlight:function E(V){if(this.suggestionShown){this._lastOpened.nextHighlight(V);}},preHighlight:function H(V){if(this.suggestionShown){this._lastOpened.preHighlight(V);}},getSuggestion:function S(j){var e=this.candidates,b=e&&e.items,Y=e&&e.isComplete,h=this._last_hit;if(!this.noCache&&(e||h)){var g=this.filterCandidates(b,j,this.REQUEST_THRESHOLD),d=g.length,f=this.suggestCount,V=false;if(!Y&&d<f){var W=h&&h.pattern;if(h&&W&&(j.indexOf(W)>-1)){V=true;var l=this.filterCandidates(h.items,j,this.REQUEST_THRESHOLD),Z=l&&l.length,X=mstrmojo.array,k=this.itemField,a;for(a=0;a<Z;a++){if(X.find(g,k,l[a][k])===-1){g.push(l[a]);}}d=g.length;}}if(!Y&&((j.length>2&&d<this.REQUEST_THRESHOLD)||(d<f))){this.requestCandidates(j);return -1;}return(d<f)?g:g.slice(0,f);}this.requestCandidates(j);return -1;},requestCandidates:function A(V){this._request_pattern=V;var Y=this,W=this.getSuggestionTarget(),X={success:function(f){if(!f){return ;}var e=Y.getSuggestionTarget();if(!e||(W!==e)){return ;}var k=e.getSearchPattern(),b=f.items;Y._last_hit={items:b,pattern:V};Y.sz=f.sz;if(!Y.noCache&&b){var g=(Y.candidates&&Y.candidates.items)||[],h=[].concat(b),d=b.length,a;for(a=0;a<d;a++){var Z=h[a];if(mstrmojo.array.indexOf(g,Z)>-1){mstrmojo.array.removeItem(b,Z);}}if(Y.candidates){Y.candidates.items=g.concat(b);}}if((k||k==="")&&k.indexOf(V)>-1){var j=Y.filterCandidates(b,k);Y.updateSuggestion(j);}},failure:function(Z){if(Z.getResponseHeader){mstrmojo.alert(Z.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};this.getCandidatesThroughTaskCall({pattern:V,blockBegin:this.blockBegin,blockCount:this.blockCount,isSuggest:true},X);},filterCandidates:function Q(Y,X,V){V=V||this.suggestCount;X=mstrmojo.string.regEscape(X);var Z=this.itemField,W=mstrmojo.array.filter(Y,function(a){return(new RegExp("\\s"+X+"|^"+X,"i")).test(a[Z]);},{max:V});return W;},getHighlightedText:function P(X,a){if(!this.highlightPattern||mstrmojo.string.isEmpty(X)){return a;}try{if(!this.nameWildcards||mstr.$A.find([2,32],parseInt(this.nameWildcards,10))>-1){a=a.replace(new RegExp("(^|\\s)("+X+")","gi"),"$1<b>$2</b>");}else{var Z=X.split(" "),W,V;for(W=0,V=Z.length;W<V;W++){if(Z[W]!==""){a=a.replace(new RegExp("("+Z[W]+")","gi"),"<b>$1</b>");}}}}catch(Y){}return a;},updateSuggestion:function O(Y){var W=Y&&Y.length,V=this.browseItemVisible;if(W||V){if(V){Y=Y||[];Y.push({n:"Browse...",t:-99,cssClass:(W?"br":"bro")});}this.set("suggestionItems",Y);if(this.suggestionShown){var X=this._lastOpened;if(X&&X.nudge){X.nudge();}if(this.autoSelect&&X){X.list.singleSelect(0);}}else{this.openPopup("suggestionPopup",this.getSuggestionPos());this.suggestionShown=true;}}else{this.hideSuggestion();}},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",onClose:function(){var V=this.opener;if(V&&V.onBrowserClose){V.onBrowserClose();}},onOpen:function(){var V=this.opener;if(V&&V.onBrowserOpen){V.onBrowserOpen();}},children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},onBrowserClose:function L(){this.browserShown=false;},handleSuggestionItemSelect:function K(V,W){if(this.browseItemVisible&&V.t===-99){this.hideSuggestion();mstrmojo.requiresCls("mstrmojo.ObjectBrowser");var X=this.zIndex;this.openPopup("ob",{zIndex:(X&&(X+10))||110});this.ob.browser.browse(mstrmojo.hash.copy(W,{folderLinksContextId:this.folderLinksContextId,onSelectCB:[this,"onSuggestionItemSelect"],browsableTypes:this.browsableTypes}));this.browserShown=true;}else{this.onSuggestionItemSelect(V);}},highlightPattern:true,suggestionPopupCssClss:"",suggestionPopup:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-ObjectInputBox-suggest",autoClose:true,locksHover:true,nextHighlight:function(V){D.call(this,true,V);},preHighlight:function(V){D.call(this,false,V);},getSelected:function M(){var V=this.list;return V.items[V.selectedIndex];},onOpen:function I(){var V=this.opener;if(V){mstrmojo.css.addClass(this.domNode,V.suggestionPopupCssClss||"");if(V.autoSelect){this.list.singleSelect(0);}if(V.nudge){V.nudge(this);}}},onClose:function F(){this.list.clearSelect();var V=this.opener;if(V){V.suggestionShown=false;mstrmojo.css.removeClass(this.domNode,V.suggestionPopupCssClss||"");}}},suggestionListClass:"mstrmojo.SuggestionList",postApplyProperties:function R(){this.suggestionPopup.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list"}];}}));}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var B=mstrmojo.array,X="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasToggleItem:false,hasMenuItems:function S(){var Y=B.filter(this.menus||[],function(Z){return Z.cls!==X;});return !!Y.length;},getMenuItems:function F(Y){var a=B.filter(this.menus.slice().reverse(),function(e,d,c){var b=c[d+1];return Y||e.cls!==X||(d&&b&&b.cls!==X);}).reverse();var Z=(a&&a.length)||0;if(!Y&&Z>0&&a[Z-1].cls===X){a.pop();}return a;},getMenuItem:function D(b){var a=this.menus,Y;if(a!==null){for(Y=0;Y<a.length;Y++){var Z=a[Y];if(Z.cls===b){return Z;}}}return null;},absorbMenuItems:function V(Y){this.menus=this.menus.concat(Y.menus);if(!this.hasToggleItem&&Y.hasToggleItem){this.hasToggleItem=true;}},addMenuItem:function K(f,b,d,Z,c){var e,a,Y;if(!f||typeof f==="string"){e=f;}else{e=f.n;a=f.ttp;}Y={n:e,ttp:a,cls:b,fn:d,ctxt:Z};if(isNaN(c)||c>=this.menus.length){this.menus.push(Y);}else{this.menus.splice(c,0,Y);}if(b.indexOf(/\bon\b/)>-1){this.hasToggleItem=true;}return Y;},addCustomMenuItem:function W(d,a,c,Z,Y){var b=this.addMenuItem(d,a,c,Y);b.getItemMarkup=Z;return b;},addDisabledMenuItem:function Q(Z,Y){this.addNonInteractiveMenuItem(Z,Y,true);},addNonInteractiveMenuItem:function O(c,Z,Y){var a=["non-int"];if(Z){a.push(Z);}if(Y){a.push("disabled");}if(c&&typeof c!=="string"&&c.ttp){this.useTooltip=true;}var b=this.addMenuItem(c,a.join(" "),mstrmojo.emptyFn);b.dsbld=true;},addSeparator:function E(){this.addMenuItem("",X,function(){return false;});},addPopupMenuItem:function U(f,a,e,b,Z,c){var d=["pop "];if(b){d.push(b);}var Y=this.addMenuItem(f,d.join(" "),e,Z,c);Y.pop=true;Y.scope=a;return Y;},addActionPopupMenuItem:function N(f,Z,d,e,a,Y,c){var b=this.addPopupMenuItem(f,Z,e,(a||"")+" ax",Y,c);b.actionFn=d;b.ax=true;},addSubMenuItem:function M(c,a,Z,b,Y){this.addPopupMenuItem(c,Z,b,a,Y);},addEditorMenuItem:function R(c,Z,b,Y,a){this.addPopupMenuItem(c,Z,b,"",Y,a);},getToggleItemStates:function G(g,j,Y,e,a,d){var b,c,Z,f;if(typeof g==="string"){b=c=g;Z=f="";}else{b=g.on||"";c=g.off||"";Z=g.ttpOn||"";f=g.ttpOff||"";}var h=[{n:b,ttp:Z,cls:j+" on",fn:e,ctxt:d},{n:c,ttp:f,cls:j,fn:Y,ctxt:d}];if(!a){h.reverse();}return h;},addToggleMenuItem:function L(f,b,d,a,Z,e,Y){var c=this.getToggleItemStates(f,b,d,a,e,Y);this.hasToggleItem=true;return this.addDualStateItem(Z,c[0],c[1]);},addDualStateItem:function I(Z,Y,a){return this.addMenuItem({n:Y.n,ttp:Y.ttp},Y.cls,this.getDualStateHandler(Z,Y,a),Y.ctxt);},getDualStateHandler:function J(Z,Y,a){return function(c,d){var b=[Y,a];if(c.cls===Y.cls){b.reverse();}b[1].fn.call(mstrmojo.all[Z],c,d);c.n=b[0].n;c.ttp=b[0].ttp;c.cls=b[0].cls;};},addRadioMenuGroup:function C(a,f,b,Z,Y,e,d){var c=[];this.hasToggleItem=true;b.forEach(function(k,g){if(k.separator){this.addSeparator();return ;}var m=k.text,l=(Z||"")+" "+(k.cls||"")+(e?"":" radio")+(k.value===a?" on":""),j=function(){if(f.call(this.ctxt,k.value,a,k)===false){return false;}a=k.value;c.forEach(function(n){n.cls=n.cls.replace(/ on$/,"")+(n.radioValue===a?" on":"");});return true;},h=d?this.addCustomMenuItem(m,l,j,d(k,g),Y):this.addMenuItem(m,l,j,Y);h.radioValue=k.value;c.push(h);},this);},clear:function P(){this._super();this.menus=[];},newInstance:function A(Y){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},Y));},addMenuTitle:function H(Y){this.addMenuItem(Y||"","menu-item-title",mstrmojo.emptyFn);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo.ui.menus.Menu","mstrmojo._IsList","mstrmojo.vi.ui._HasMask","mstrmojo.dom","mstrmojo.hash","mstrmojo.string","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui._HasListTooltip");var F=mstrmojo.dom;mstrmojo.vi.ui.toolbars.Toolbar=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._HasMask,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",tooltipOrientation:"vertical",init:function G(I){this._super(I);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIToolbar");},selectionPolicy:"reselect",toolbarCfg:null,toolbarClicked:mstrmojo.emptyFn,tooltipCss:null,_set_toolbarCfg:function(L,I){var J=this.toolbarCfg,K=(J!==I);if(K){if(J){J.destroy();}this.toolbarCfg=I;}return K;},getItemProps:function D(K,I){var J=this._super(K,I);J.addCls(K.cls);J.addStyle("display:inline-block");return J;},postBuildRendering:function C(){var I=document.createElement("div");I.className="mstrmojo-VIDND-mask";this.maskNode=this.domNode.appendChild(I);return this._super();},postselectionChange:function(I){var J=I.added;if(J){var K=this.items[J[0]];if(K.tp==="pb"&&K.isMenuClicked){K.menufn(K,this);}else{K.fn(K,this);}}},ontoolbarCfgChange:function H(I){var K=I.valueWas;if(K){K.destroy();}var J=I.value;if(!J){return ;}this.set("items",J.btns);if(this.hasRendered){this.raiseEvent({name:"renderComplete"});}},openMenu:function E(J,I){J.hostId=this.id;J.hostElement=this._getItemNode(I._renderIdx);this.openPopup(J.newInstance());},onclick:function A(I){var K=I.target||F.eventTarget(I.hWin,I.e),J=this.getItemFromTarget(K);if(J&&J.tp==="pb"){if(K&&K.className){J.isMenuClicked=K.className.indexOf("icn")===-1;}}this.toolbarClicked(I);this._super(I);},destroy:function B(J){var I=this.toolbarCfg;if(I){I.destroy();}delete this.items;this._super(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasOwnAvatar","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.SimpleTree","mstrmojo.warehouse._CanToggleAvatarClass","mstrmojo.warehouse.EnumObjectTypes");var Z=mstrmojo.array,b=mstrmojo.css,G=mstrmojo.dom,X=mstrmojo.hash,d="item-mn",K="item-n",A="userSel",U="mltSel",B=mstrmojo.warehouse.EnumObjectTypes,N=B.TABLE,D="li",L="ul",W="idx",H=":";function V(f){if(this.hasRendered){var g=this.domNode.getElementsByTagName(D);Z.forEach(g,f,this);}}function I(){var f=[];X.forEach(this.userSelections,function(g,h){f.push(this.getTreeItem(h));},this);return(f.length>1)?f:null;}mstrmojo.warehouse.ui.TablesTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.warehouse.ui.TablesTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree {@cssClass}" mstrAttach:click,dblclick>{@itemsHTML}</div>',userSelections:undefined,draggable:true,dropZone:true,getMenuHelper:mstrmojo.emptyFn,showTablesNum:true,init:function Y(f){this._super(f);this.cssClass+=" mstrmojo-wh-TablesTree";this.userSelections=[];},getItemMarkup:function F(){return'<div class="{@cls}" title="{@ttp}"><span class='+K+' unselectable="on">{@n}</span><span class='+d+"></span></div>";},treeHooks:{select:function S(h,AB,g){var f=G.findAncestorByAttr(h,"idx",true,this.domNode),AC=f.value,AF=this.userSelections,u=this.rangeSelect,AE,AA,m=Number.MAX_VALUE,l=Number.MIN_VALUE,n,z,j,p,q,x,w,t=this.shiftStartIndex,AD=parseInt(g,10),k=AF[AC]===true;if(AB.tp===N){if(k){delete AF[AC];}else{AF[AC]=true;}AE=X.keyarray(AF);AA=AE.length;b.toggleClass(this.domNode,U,AA>1);b.toggleClass(h,A,!k);if(u&&AA&&t){p=t.split(H);j=AC.split(H);if(p&&j&&(p.length===j.length)&&p.length===(AD+1)){for(w=0;w<p.length;w++){if(p[w]!==j[w]){break;}}if(w===AD){n=parseInt(j[AD],10);z=parseInt(p[AD],10);if(!isNaN(n)&&!isNaN(z)){m=(n<z)?n:z;l=(n>z)?n:z;}for(var o=m;o<=l;o++){j[g]=o.toString();q=j.join(H);x=this.getTreeItem(q);if(x&&x.tp===N){AF[q]=true;delete this.selectedIndices[q];}}V.call(this,function(AH){var AG=AH.getAttribute(W);if(AF[AG]===true){b.toggleClass(AH,A,true);}});}}}}delete this.selectedIndices[AC];return true;},unselect:function M(g,h,j,f){this.itemRenderer.select(g,h,j,f,this);this.selectedIndices[h._renderIdx]=true;return true;}},tablesTreeHooks:{},showMenu:function Q(g){var h=this.getMenuHelper(),j=1;mstrApp.getRootController().setTableMenuContext(j);h.target=this;h.data=g.data;var f=h.getMenuConfig();f.hostId=this.id;f.hostElement=g.menuNode;f.isHostedWithin=false;f.hostProxyCssClass="item-mn-proxy";this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:f}));},onclick:function e(g){var l=g.target||G.eventTarget(g.hWin,g.e),k=G.findAncestorByAttr(l,"idx",true,this.domNode),m=k&&k.node.getAttribute("level"),j=G.shiftKey(g.hWin,g.e),h=k&&k.value,f=l.className===d&&h!==null&&!isNaN(m);if(!(G.ctrlKey(g.hWin,g.e)||G.metaKey(g.hWin,g.e)||j)){if(!f||!this.userSelections[h]){this.clearUserSelections(X.copy(this.userSelections));}else{this.userSelections[h]=false;}}if(j){this.rangeSelect=true;}else{this.shiftStartIndex=h;}this._super(g);if(f){this.showMenu({data:I.call(this)||this.getTreeItem(h),menuNode:l});}this.rangeSelect=false;},ondblclick:function J(o){var l=this,k=o.target||G.eventTarget(o.hWin,o.e),g=k.nodeName.toLowerCase(),t=G.findAncestorByAttr(k,"idx",true,this.domNode),f=t&&t.node.getAttribute("level"),n=t&&t.value,p=this.selectedIndices,m,q=p[n],h,j=l.tablesTreeHooks;l.onclick(o);if((g!==L)&&(g!==D)&&n!==null&&!isNaN(parseInt(f,10))){h=this.getTreeItem(n);if(j.isTable===undefined||j.isTable(h)){if(q){m=j.removeItem;}else{m=j.addItem;}if(m){m.call(l,t.node,h,f,n,p,this);}}}},createAvatar:function O(f){var h=document.createElement("div"),g=G.findAncestorByAttr(f,W,true,this.domNode);if(g&&g.node){h.appendChild(g.node.cloneNode(true));h.appendChild(document.createElement("div"));}h.className=this.domNode.className;return h;},toggleAvatarClass:function P(f,g){b.toggleClass(this.avatar,f,g);},getDragData:function E(g){var f=this.getNodeAttributes(g.src.node).index,j=this.getTreeItem(f),h=this.userSelections;if(j.tp===N){if(h[f]===true){return I.call(this)||[j];}this.clearUserSelections(X.copy(h));return[j];}return j;},isDragValid:function C(){return true;},ondragstart:function a(f){this._super(f);var g=f.src.data;if(this.showTablesNum&&g&&g.length>1){this.avatar.getElementsByClassName(K)[0].innerHTML=g.length;}},getNodeAttributes:function c(g){var f=G.findAncestorByAttr(g,W,true,this.domNode),h=f&&f.node.getAttribute("level");return{index:f&&f.value,level:parseInt(h,10)};},clearUserSelections:function R(f){V.call(this,function(h){var g=h.getAttribute(W);if(f[g]===true){b.toggleClass(h,A,false);delete this.userSelections[g];}});b.toggleClass(this.domNode,U,false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.ui.editors.controls.ValidationTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,null,{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",errRevert:true,dtp:null,validationDelay:3000,orignText:null,trigger:mstrmojo.validation.TRIGGER.ONKEYUP,init:function(B){B=B||{};B.constraints=B.constraints||{};B.constraints.trigger=this.trigger;this._super(B);},prekeyup:function(B){if(B.e.keyCode===13){this.blur();return ;}this._super(B);},onfocus:function(){this.orignText=this.value;},onblur:function(){if(this.value!=this.orignText){this.validate();}},validate:function(){this._super();this.orignText=this.value;this.clearValDelayTimer();},preinput:mstrmojo.emptyFn,postinput:function(){var B=this.doValidation(this.value);if(B.code<=mstrmojo.validation.STATUSCODE.VALID){this.clearValidation();if(!this.errRevert){this.hideTooltip();}}},updateTooltipConfig:function(){this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:mstrmojo.desc(13819,"Invalid input")};},onInvalid:function(){if(!this.errRevert){this.hideTooltip();this.showTooltip();}else{this.clearValidation();this.set("value",this.orignText);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Box","mstrmojo.Label","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.Dialog","mstrmojo.cookies","mstrmojo.string");mstrmojo.requiresDescs(17,18,221,9772,11773,14028,16220,16227,14138,14139,14140,14149,14522,14523,14524,16224,14526,14527);var M=mstrmojo.css,W=mstrmojo.dom,I=mstrmojo.hash;var D=mstrmojo.validation,G=D.STATUSCODE,H=D.TRIGGER,V=D.VALIDATOR,K=mstrmojo.expr.DTP;var c={intervalCtr:0,qrLoaded:false,maxPollingAttempts:80,timeDelay:3000};var Q={mini_badge:"#ddd",mini_badge_icon:"../style/mstr/images/badge-placeholder-m.png",t_color:"#797979",appName:"",name:""};var F={firstName:"",badgeId:""};var J={duration:undefined,elem:undefined,callback:undefined,timerInterval:null,init:function(e,d,f){this.duration=e;this.elem=d;this.callback=f;},startTimer:function(){this.stopTimer();var j=Date.now(),f,d,g;var e=this;function h(){f=e.duration-(((Date.now()-j)/1000)|0);d=(f/60)|0;g=(f%60)|0;d=d<10?"0"+d:d;g=g<10?"0"+g:g;e.elem.set("text",d+":"+g);if(f<=0){j=Date.now()+1000;e.callback();e.stopTimer();}}h();this.timerInterval=setInterval(h,1000);},stopTimer:function(){if(this.timerInterval){clearInterval(this.timerInterval);}}};function B(d){d.sn=this.serverName||mstrConfig.serverName;d.sp=this.serverPort||mstrConfig.serverPort;d.connectionId=this.connectionId||"";return d;}function R(){this.set("expired",true);this.usherProps.qrLoaded=false;}function N(){try{var f=this.usherProps;var d=this;if(f.qrLoaded){if(f.intervalCtr>f.maxPollingAttempts){R.call(d);}else{clearTimeout(this.pullTimeout);this.pullTimeout=setTimeout(function(){f.intervalCtr+=1;if(!d.stopPolling){X.call(d);}},f.timeDelay);}}}catch(g){}}function P(f,e,d){if(mstrApp.serverRequest){mstrApp.serverRequest(f,e,d);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,e,f);}}function X(){var e=this,f=this.usherProps,g={taskId:"usherLoginWeb",pollOnly:"true",server:this.serverName||mstrConfig.serverName,port:this.serverPort||mstrConfig.serverPort,project:this.projectName||mstrConfig.projectName,connectionId:this.connectionId},d={success:function(j){try{if(j.status=="invalid"){N.call(e);}else{if(j.status=="success"){function h(n){e.onUsherLogin(n);f.qrLoaded=false;}if(e.rememberMe===true){var k={success:function(n){h(n);},failure:function(n){e.onUsherError(n);}};var m={taskId:"usherRememberMe"};m.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";P(m,k,{doNotHold:true});}else{h(j);}}}}catch(l){mstrmojo.alert("usherPollForScan:\n "+l.messsage);}},failure:function(h){R.call(e);e.onUsherError(h);}};P(g,d,{doNotHold:true});}function a(d){this.userDetails.set("text",d||"");}function L(d){var e=this;e.loginButton.set("visible",d);e.loginNotificationBox.set("visible",!d);}function C(){var g=this.usherProps;var f=this.notificationTimer;var e=this,d={success:function(k){try{if(k.status==1){function n(){L.call(e,true);}function j(){if(e.pullTimeout){clearTimeout(e.pullTimeout);}e.usherProps.intervalCtr=0;g.qrLoaded=true;N.call(e);}var m=60*5;f.init(m,e.loginNotificationBox.timer,n);f.startTimer();L.call(e,false);j();}else{e.onUsherError(k);}}catch(l){mstrmojo.alert("Error:\n"+l.message);}},failure:function(j){e.onUsherError(j);}},h={taskId:"usherNotifyMe"};h.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";P(B.call(this,h),d,{doNotHold:true});}function A(){var e=this,d={success:function(g){try{e.set("notificationMode",false);e.reloadQR();}catch(h){mstrmojo.alert("Error:\n"+h.messsage);}},failure:function(g){e.onUsherError(g);}},f={taskId:"usherRememberMe",rememberMe:false};if(e.userInfo.badgeId!==""){f.badgeId=e.userInfo.badgeId;}f.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";P(B.call(this,f),d,{doNotHold:true});}function O(h){if(this.notificationMode==true&&!h){return ;}var f=this.usherProps;this.showQRLoading(true);var e=this,d={success:function(k){try{if(k.img){e.set("notificationMode",false);e.updateQRCode(k.img);e.set("badge",k.badgeInfo&&k.badgeInfo[0]);f.intervalCtr=0;f.qrLoaded=true;this.stopPolling=false;N.call(e);}else{var l=JSON.parse(k.data);var j=l.pnEnabled||l.isPNEnabled;e.set("isPnEnabled",j);if(l.code||l.proximityBasedLogin){e.set("notificationMode",false);if(l.proximityBasedLogin&&!h){e.updateQRCodeProximity();e.set("proximityMode",true);}else{e.updateQRCode(l.code);e.set("proximityMode",false);}e.set("badge",k.badgeInfo&&k.badgeInfo[0]);f.intervalCtr=0;f.qrLoaded=true;this.stopPolling=false;mstrmojo.cookies.updateCookieSetting("usher_sso_device",k.device_id);N.call(e);}else{e.set("proximityMode",false);e.set("notificationMode",true);e.refresh.set("visible",false);if(l.photoData&&e.userInfoNode){e.userInfoNode.src="data:image/png;base64,"+l.photoData;}e.userInfo.firstName=l.firstName;e.userInfo.badgeId=l.badgeId;L.call(e,true);e.set("badge",k.badgeInfo&&k.badgeInfo[0]);}}}catch(m){mstrmojo.alert("getQRCode:\n "+m.messsage);}},failure:function(j){e.handleQRCodeError(j);R.call(e);e.onUsherError(j);},complete:function(){e.showQRLoading(false);}},g={taskId:"usherQRWeb"};g.deviceId=mstrmojo.cookies.getCookieSetting("usher_sso_device")?mstrmojo.cookies.getCookieSetting("usher_sso_device"):"";P(B.call(this,g),d,{doNotHold:true});}function E(){var f=this,j=this.registerButton,g=this.parent.badgeNode.childNodes[1];if(j.enabled){j.set("enabled",false);M.addClass(g,["anim"]);var d={},e={success:function(k){var l=k&&k.name==f.user.value;d={msg:l?mstrmojo.desc(14139,"You've successfully registered. Please check your email to continue.")+" "+mstrmojo.desc(16222,"Or perform a MicroStrategy badge recovery."):k.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:l};},failure:function(k){d={msg:k.getResponseHeader("X-MSTR-TaskFailureMsg"),successful:false};},complete:function(){j.set("enabled",true);M.removeClass(g,["anim"]);f.set("regMsg",d);}},h={taskId:"usherRegUsr",server:this.serverName||mstrConfig.serverName,project:mstrConfig.projectName,port:this.serverPort||mstrConfig.serverPort,email:this.email.value,userid:this.user.value,password:this.pwd.value};P(h,e);}}function U(d){return mstrmojo.hash.copy(d,{scriptClass:"mstrmojo.ValidationTextBox",cssDisplay:"block",postCreate:function(){if(W.isIE9||W.isIE8||W.isIE7){this.emptyText=this.hint;}},onEnter:function(){E.call(this.parent);}});}mstrmojo.UsherLogin=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.UsherLogin",markupString:'<div id="{@id}" class="mstrmojo-UsherLogin-Container {@cssClass}" style="{@cssText}" ><div class="mstrmojo-UsherLogin-badge"><div class="icn"><img src="../images/1ptrans.gif"/></div><div class="dots"><div class="dot1"></div><div class="dot2"></div><div class="dot3"></div></div><div class="app"><img src="../style/mstr/images/badge-app.png"/></div></div><div class="mstrmojo-UsherLogin-badgeLabel"><div class="app-name"></div><div id="badgename" class="badge-name"></div></div><div class="mstrmojo-UsherLogin"><div class="mstrmojo-UsherLogin-QR mode"><img class="QR" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-register mode"></div></div><div class="mstrmojo-UsherLogin-userInfo mode"><img class="userInfo" src="../images/1ptrans.gif" alt="" /></div><div class="mstrmojo-UsherLogin-notification"></div><div class="mstrmojo-UsherLogin-remember-setting"><div class = "mstrmojo-UsherLogin-remember"></div><div class = "mstrmojo-UsherLogin-forget"></div></div><div class="mstrmojo-UsherLogin-link"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},badgeNode:function(){return this.domNode.firstChild;},badgeIconNode:function(){return this.domNode.firstChild.firstChild.firstChild;},badgeLabelNode:function(){return this.domNode.childNodes[1];},usherNode:function(){return this.domNode.childNodes[2];},qrNode:function(){return this.domNode.childNodes[2].firstChild;},qrCodeNode:function(){return this.domNode.childNodes[2].firstChild.firstChild;},refreshNode:function(){return this.domNode.childNodes[2].firstChild.lastChild;},registerNode:function(){return this.domNode.childNodes[2].lastChild;},userNode:function(){return this.domNode.childNodes[3];},userInfoNode:function(){return this.domNode.childNodes[3].firstChild;},notificationNode:function(){return this.domNode.childNodes[4];},rememberSettingsNode:function(){return this.domNode.childNodes[5];},rememberNode:function(){return this.domNode.childNodes[5].firstChild;},forgetNode:function(){return this.domNode.childNodes[5].lastChild;},linksNode:function(){return this.domNode.lastChild;}},markupMethods:{onqrCodeChange:function(){if(this.qrCodeNode){this.qrCodeNode.src=this.qrCode;}},onbadgeChange:function(){var e=this.badge||Q,j=e.badgeFormat,d=j&&JSON.parse(j)||{isnull:true},g=this.badgeLabelNode,f=this.badgeIconNode,h=this.domNode;if(this.showBadgeBackgroundImage){h.style.backgroundColor=d.mini_badge;if(d.bg_4){h.style.backgroundImage="url("+d.bg_4+")";}}f.src=d.mini_badge_icon||Q.mini_badge_icon;if(!d.isnull&&!d.mini_badge_icon){M.addClass(f.parentNode,"default");}g.firstChild.innerHTML=mstrmojo.string.encodeHtmlString(e.appName||Q.appName);g.lastChild.innerHTML=mstrmojo.string.encodeHtmlString(e.name||Q.name);g.lastChild.title=e.name||Q.name;g.style.color=d.t_color||Q.t_color;this.linksNode.style.color=d.t_color||Q.t_color;},onexpiredChange:function(){M.toggleClass(this.usherNode,"expired",this.expired);},onloadingChange:function(){M.toggleClass(this.usherNode,"loading",this.loading);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(this.visible&&this.canRequestQR()&&!this._lastVisible){O.call(this);}this.stopPolling=!this.visible;this._lastVisible=this.visible;},onnotificationModeChange:function(d){M.toggleClass(this.containerNode,"notificationMode",this.notificationMode);},onproximityModeChange:function(d){M.toggleClass(this.containerNode,"proximityMode",this.proximityMode);},onisPnEnabledChange:function(){this.hideRememberMe(!this.isPnEnabled);}},qrCode:"../images/1ptrans.gif",badge:Q,expired:false,onUsherLogin:mstrmojo.emptyFn,onUsherError:mstrmojo.emptyFn,showBadgeBackgroundImage:true,usherProps:null,serverName:null,serverPort:null,rememberMe:false,userInfo:null,notificationTimer:null,loadQR:false,notificationMode:false,isPnEnabled:false,init:function S(d){if(this._super){this._super(d);}M.addWidgetCssClass(this,"");this.usherProps=this.usherProps?I.copy(this.usherProps,I.clone(c)):I.clone(c);this.userInfo=this.userInfo?I.copy(this.userInfo,I.clone(F)):I.clone(F);this.notificationTimer=this.notificationTimer?I.copy(this.notificationTimer,I.clone(J)):I.clone(J);},destroy:function Y(d){this.stopPolling=true;clearTimeout(this.pullTimeout);this._super(d);},canRequestQR:function(){return this.usherProps&&(this.loadQR||(this.serverName||mstrConfig.serverName));},showUserInfo:function(d){this.refresh.set("visible",false);this.refresh.set("visible",false);},updateQRCode:function(d){this.set("qrCode","data:image/png;base64,"+d);this.set("expired",false);this.refresh.set("visible",false);},updateQRCodeProximity:function(){this.set("qrCode","../images/WaitUsherRadar.gif");this.set("expired",false);this.refresh.set("visible",false);},handleQRCodeError:function(){this.set("qrCode","../style/mstr/images/msgError.gif");this.set("expired",true);this.refresh.set("visible",true);},showQRLoading:function Z(d){this.set("loading",d);if(d){this.refresh.set("visible",false);}},postBuildRendering:function(){this._super();this.registerForm.set("tabIndex",-1);},toggleRegister:function(d){this.registerVisible=(d!==undefined)?d:!this.registerVisible;M.toggleClass(this.usherNode,"show-register",this.registerVisible);this.registerLink.set("text",this.registerLink.texts[this.registerVisible?1:0]);if(this.isPnEnabled===true){this.hideRememberMe(this.registerVisible&&this.isPnEnabled);}},hideRememberMe:function(d){M.toggleClass(this.rememberSettingsNode,"hide-rememeber",d);},reloadQR:function(){if(this.canRequestQR()){if(this.pullTimeout){clearTimeout(this.pullTimeout);}this.usherProps.intervalCtr=0;this.usherProps.qrLoaded=false;if(this.visible){O.call(this);}}},children:[{scriptClass:"mstrmojo.Label",slot:"qrNode",alias:"refresh",cssClass:"refresh",text:mstrmojo.desc(14028,"Refresh QR Code"),visible:false,onclick:function(){O.call(this.parent);}},{scriptClass:"mstrmojo.Box",slot:"registerNode",alias:"registerForm",regMsg:null,children:[U({alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name")}),U({alias:"pwd",cssClass:"login-pwd",hint:mstrmojo.desc(18,"Password"),type:"password"}),U({alias:"email",cssClass:"login-email",dtp:K.VARCHAR,constraints:{validator:V.VALIDATE_EMAIL,trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{visible:"this.parent.parent.usherRegistrationOption > 2"},hint:mstrmojo.desc(9772,"Email")}),U({alias:"confirmEmail",cssClass:"login-email",bindings:{visible:function(){return this.parent.parent.usherRegistrationOption>2;}},hint:mstrmojo.desc(14149,"Confirm Email"),onpaste:function(d){W.preventDefault(d.hWin,d.e||d.hWin.event);}}),{scriptClass:"mstrmojo.Box",alias:"regMsg",cssClass:"register-msg",bindings:{regMsg:function(){return this.parent.regMsg;},visible:function(){return this.parent.regMsg;}},onregMsgChange:function(){if(this.domNode){this.domNode.style.color=this.regMsg&&this.regMsg.successful?"#42C31E":"#f00";}},children:[{scriptClass:"mstrmojo.Label",alias:"msg",cssClass:"register-msg-txt",bindings:{text:function(){return this.parent.regMsg.msg;}}},{scriptClass:"mstrmojo.Label",alias:"icn",cssClass:"register-msg-icn",onclick:function(){this.parent.parent.parent.toggleRegister();this.parent.parent.set("regMsg",null);}}]},{scriptClass:"mstrmojo.Button",alias:"registerButton",cssClass:"register mstrmojo-WebButton hot",cssDisplay:"inline-block",text:mstrmojo.desc(11773,"Register"),bindings:{enabled:function(){var k=this.parent.user.value,g=this.parent.email.value,e=this.parent.confirmEmail.value;var f=k.length>0;if(f){if(this.parent.parent.usherRegistrationOption>1){var j=g.length>=3&&e.length>=3&&g.toUpperCase()===e.toUpperCase()&&this.parent.email.validationStatus.code===G.VALID;if(j){if(this.parent.parent.usherRegistrationOption==7){var h=this.parent.parent.usherRegistrationDomain.toUpperCase();var d=g.substr(g.indexOf("@")+1).toUpperCase();return h.indexOf(d)>=0;}}return j;}}return f;}},onclick:function(){E.call(this.parent);}},{scriptClass:"mstrmojo.Button",alias:"registerCancelButton",cssClass:"register-cancel",cssDisplay:"inline-block",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var d=this.parent;d.parent.toggleRegister();d.set("regMsg",null);d.user.set("value","");d.pwd.set("value","");d.email.set("value","");d.confirmEmail.set("value","");d.user.domNode.focus();}}]},{scriptClass:"mstrmojo.CheckBox",slot:"rememberNode",alias:"remember-me",label:mstrmojo.desc(14522,"Remember me"),onclick:function b(){this.parent.set("rememberMe",this.checked);}},{scriptClass:"mstrmojo.Label",slot:"forgetNode",allowHTML:true,text:mstrmojo.desc(14527,"Forget me/Switch user"),onclick:function(){A.call(this.parent);}},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:'<a id="proximityProblems" href="#">Login via Phone</a>',onclick:function(d){O.call(this.parent,true);return false;},bindings:{visible:"this.parent.proximityMode"},},{scriptClass:"mstrmojo.Label",slot:"linksNode",allowHTML:true,text:mstrmojo.desc(16220,"Use your ###MicroStrategy Badge## app to scan the QR Code.").replace("###","").replace("##",""),},{scriptClass:"mstrmojo.Label",slot:"linksNode",alias:"registerLink",cssClass:"register-label",allowHTML:true,bindings:{visible:"this.parent.usherRegistrationOption > 0"},text:"",texts:[mstrmojo.desc(16227,"Don't have MicroStrategy Badge? Click ###here## to register."),mstrmojo.desc(14140,"Display your ###QR Code##.")],postCreate:function(){this.set("text",this.texts[0]);},ontextChange:function(){this.text=this.text.replace("###",'<a href="#" onclick="mstrmojo.all.'+this.parent.id+'.toggleRegister(); return false;">').replace("##","</a>");}},{scriptClass:"mstrmojo.Label",alias:"userDetails",cssClass:"user-details",slot:"userNode"},{scriptClass:"mstrmojo.Button",alias:"loginButton",cssClass:"mstrmojo-WebButton login-button .mstrButton",cssDisplay:"inline-block",text:mstrmojo.desc(16224,"Login with MicroStrategy Badge"),slot:"notificationNode",visible:false,onclick:function(){C.call(this.parent);},onvisibleChange:function(){var d=this.parent,e=mstrmojo.desc(14523,"Hi ")+" "+d.userInfo.firstName;this.visible?e+="!":e+=mstrmojo.desc(14524,", please approve on your device.");a.call(d,e);}},{scriptClass:"mstrmojo.Box",alias:"loginNotificationBox",cssClass:"login-notification",slot:"notificationNode",visible:false,children:[{scriptClass:"mstrmojo.Label",alias:"timer",cssClass:"notification-timer"},{scriptClass:"mstrmojo.Label",alias:"notificationFailure",cssClass:"notification-failure",text:mstrmojo.desc(14526,"Did not get notification"),onclick:function(){L.call(this.parent.parent,true);}}]},]});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.ImportSource","mstrmojo.DI.DIConstants","mstrmojo.DI.OAuthSource","mstrmojo.DI.OAuthAnalytics","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIDatabaseHelper","mstrmojo.DI.model.HistoryList","mstrmojo.DI.model._ConnectLive","mstrmojo.DI.model._DISources","mstrmojo.DI.model.Schedule");mstrmojo.requiresDescs(218,219,3958,7151,8516,8520,8531,8545,8552,8553,8556,8558,8560,8561,9149,9214,9926,10056,10057,10058,10059,10060,10061,10062,10072,10171,10174,11108,11109,11164,12442,12444,12447,12448,12449,12451,12452,12454,12455,12456,12460,12461,12462,12463,12498,12542,12711,12712,12713,12748,12749,12750,12751,12752,12753,12754,12755,12756,12757,12758,12759,12760,12977,12978,12979,12980,12981,12982,12983,12984,12985,12986,12987,12988,12989,12990,12991,12992,12993,12994,12995,12996,12997,12998,13041,13223,13224,13225,13226,13227,13411,13412,13413,13414,13415,13416,13417,13418,13419,13420,13421,13422,13423,13424,13425,13426,13978,14039,14040,14041,14042,14043,14044,14045,14046,14047,14048,14049,14050,14051,14052,14053,14054,14201);var k=mstrmojo.DI.DIConstants,V=mstrmojo.warehouse.EnumDatabaseType,P=mstrmojo.array,X=mstrmojo.hash,J=mstrmojo.DI.DIHelpers;function I(u){var q,t=0,p={},n=u.agis,m,x,l,o,w;if(n){t=n.length;}for(q=0;q<t;q++){x=n[q];l=x.atid;o=x.agi.fms;w=x.agi.maps;m={fms:o,maps:w};p[l]=m;}return p;}function Y(n,l,o){var m=n+"_"+l;if(o){m=o;}return m;}function L(n,l,o){var m=new mstrmojo.DI.ImportSource();m.initialize(n,l,Y(n,l,o),o);return m;}function Q(q,m){var o={isPartition:false},p,l=[],n;if(!m){q.set("partition",o);return ;}o.type=m.tp;o.isPartition=o.type!==0;p=m.ptabs||[];P.forEach(p,function(t){n={};if(t.n){n.name=t.n;}if(t.hasOwnProperty("shnb")){n.sheetIndex=t.shnb;}l.push(n);});o.tables=l;q.set("partition",o);}function C(q,p){var t=p.datap.srce,o,m;if(q.sourceInfo){q.sourceInfo.destroy();}o=q.sourceInfo=new mstrmojo.Obj();if(t.iurl){o.set("name",t.url);}else{o.set("name",mstrmojo.string.decodeHtmlString(t.tbn)||"");}if(t.tbal){o.set("name",mstrmojo.string.decodeHtmlString(t.tbal)||"");}o.set("dbTableName",t.tbn||"");if(t.xt===k.xdaType.excel||t.xt===k.xdaType.text||t.xt===k.xdaType.dataImportOAuthDropbox||t.xt===k.xdaType.dataImportOAuthGDrive){o.set("sheetName",t.file_description.shn);o.set("sheetIndex",t.file_description.shnb);o.set("hasInsertedColumnHeaders",t.file_description.hnchs);}if(t.dbrid){o.set("dbRoleId",t.dbrid);}if(t.des){o.set("des",t.des);}if(t.ns){o.set("dbNamespace",t.ns);}if(t.said){o.set("said",t.said);}if(t.gbqp){o.set("gbqp",t.gbqp);}if(t.cstr){var n=t.cstr.split(";");var l=null;if(n.length===3){l=n[1].substr(n[1].indexOf("=")+1);}o.set("sdkUrl",l);}if(t.ln){o.set("clientId",t.ln);}Q(o,t.pti);m=t.file_description;if(m){if(m.url!==undefined){o.set("url",m.url);}if(m.srcid){o.set("sourceId",m.srcid);}if(m.oid){o.set("objectId",m.oid);}if(m.odesc){o.set("objectDesc",m.odesc);}if(m.rdtr){o.set("delimiter",m.rdtr);}if(m.qt!==undefined){o.set("quotes",m.qt);}if(m.hasOwnProperty("chrn")){o.set("skipRows",m.chrn);}if(m.hasOwnProperty("fil")){o.set("fileStruct",m.fil);}if(m.hasOwnProperty("hnchs")){o.set("hasNewHeaders",m.hnchs);}if(m.mimetype){o.set("mimetype",m.mimetype);}if(m.maxr){q.set("fetchNum",m.maxr);}if(m.url!==undefined){o.set("sourceAccountID",m.exte);}if(m.filet){o.set("filet",m.filet);}}o.set("isRefined",t.irfd);o.set("hasAggFilter",t.ifaa);o.set("hnc",t.hnc);}function h(t,p){if(!t){return null;}var l=t.datap.srce,w=t.datap.tbid||p,m,z,q=k.xdaType,n=k.backendSourceSubtype,AB=k.sourceType,AA=k.sourceSubtype;if(!l){if(p){m=this.getImportSource(p);}else{m=null;}return m;}switch(l.xt){case q.text:case q.excel:if(l.txt===q.text){z=t.datap.shts&&t.datap.shts[0].indexOf(":\\fakepath\\");if(z&&z>=0){t.datap.shts[0]=t.datap.shts[0].substr(z+11);}}switch(l.dict){case n.samplefile:m=this.importSources[Y(AB.file,AA.samplefile,w)];if(!m){m=this.selectImportSource(AB.file,AA.samplefile,w);}break;case n.publicData:m=this.importSources[Y(AB.file,AA.publicData,w)];if(!m){m=this.selectImportSource(AB.file,AA.publicData,w);}break;case n.url:m=this.importSources[Y(AB.file,AA.url,w)];if(!m){m=this.selectImportSource(AB.file,AA.url,w);}break;case n.localFile:m=this.importSources[Y(AB.file,AA.localFile,w)];if(!m){m=this.selectImportSource(AB.file,AA.localFile,w);}break;case n.clipboard:m=this.importSources[Y(AB.file,AA.clipboard,w)];if(!m){m=this.selectImportSource(AB.file,AA.clipboard,w);}break;case n.dataFromPushApi:case n.dataFromPushApiV2:m=this.importSources[Y(AB.dataFromPushApi,AA.dataFromPushApi,w)];if(!m){m=this.selectImportSource(AB.dataFromPushApi,AA.dataFromPushApi,w);}break;case n.cloudElement:m=this.importSources[Y(AB.file,AA.cloudElement,w)];if(!m){m=this.selectImportSource(AB.file,AA.cloudElement,w);}break;default:if(l.file_description&&l.file_description.url!==""){m=this.importSources[Y(AB.file,AA.url,w)];if(!m){m=this.selectImportSource(AB.file,AA.url,w);}}else{if(l.tbn===""){m=this.importSources[Y(AB.file,AA.clipboard,w)];if(!m){m=this.selectImportSource(AB.file,AA.clipboard,w);}else{m.set("type",AB.file);m.set("subtype",AA.clipboard);}}else{m=this.importSources[Y(AB.file,AA.localFile,w)];if(!m){m=this.selectImportSource(AB.file,AA.localFile,w);}}}break;}break;case q.refine:m=this.importSources[Y(AB.file,AA.localFile,w)];if(!m){m=this.selectImportSource(AB.file,AA.localFile,w);}break;case q.dataImportOAuthGDrive:m=this.importSources[Y(AB.googleDrive,AA.googleDrive,w)];if(!m){m=this.selectImportSource(AB.googleDrive,AA.googleDrive,w);}break;case q.dataImportOAuthDropbox:m=this.importSources[Y(AB.dropbox,AA.dropbox,w)];if(!m){m=this.selectImportSource(AB.dropbox,AA.dropbox,w);}break;case q.salesforce:m=this.importSources[Y(AB.salesforce,AA.salesforce,w)];if(!m){m=this.selectImportSource(AB.salesforce,AA.salesforce,w);}break;case q.dataImportOAuthGAnalytics:m=this.importSources[Y(AB.googleAnalytics,AA.googleAnalytics,w)];if(!m){m=this.selectImportSource(AB.googleAnalytics,AA.googleAnalytics,w);}break;case q.dataImportOAuthGBigQuery:m=this.importSources[Y(AB.googleBigQuery,AA.googleBigQuery,w)];if(!m){m=this.selectImportSource(AB.googleBigQuery,AA.googleBigQuery,w);}break;case q.dataImportOAuthGBigQueryFFSQL:m=this.importSources[Y(AB.googleBigQuery,AA.googleBigQueryFFSQL,w)];if(!m){m=this.selectImportSource(AB.googleBigQuery,AA.googleBigQueryFFSQL,w);}break;case q.dataImportOAuthGBigQuerySingleTable:m=this.importSources[Y(AB.googleBigQuery,AA.googleBigQuerySingleTable,w)];if(!m){m=this.selectImportSource(AB.googleBigQuery,AA.googleBigQuerySingleTable,w);}break;case q.mdx:m=this.importSources[Y(AB.mdx,AA.mdx,w)];if(!m){m=this.selectImportSource(AB.mdx,AA.mdx,w);}break;case q.qbSingleTable:case q.ffsql:case q.querybuilder:case q.spark:var x=AB.querybuilder,u=AA.querybuilder,AC,o;if(l.dbvs===223){x=AB.bisource;u=AA.bisource;}else{if(t.datap.srce.dbtp!==undefined){AC=t.datap.srce.dbtp;o=l.dbvs;switch(AC){case V.SearchEngineSOLR:case V.SearchEngineSPLUNK:u=AA.searchOnSource;break;case V.SAPHana:if(l.xt===q.qbSingleTable){u=AA.hanaSingleTable;}break;case V.Hive:case V.Impala:case V.SearchEngineSPLUNK:case V.Pig:case V.PHOENIX:case V.IBMBigInsights:case V.Drill:case V.DB_TYPE_NEWDB_1:case V.DB_TYPE_NEWDB_5:case V.AzureCosmosDB:u=AA.hadoop;break;default:u=AA.querybuilder;break;}}}m=this.importSources[Y(x,u,w)];if(!m){m=this.selectImportSource(x,u,w);}m.xdaType=l.xt;m.databaseType=AC;m.databaseVersion=o;m.dbrid=t.datap.srce.dbrid;break;case q.twitter:m=this.importSources[Y(AB.twitter,AA.twitter,w)];if(!m){m=this.selectImportSource(AB.twitter,AA.twitter,w);}break;case q.facebook:m=this.importSources[Y(AB.facebook,AA.facebook,w)];if(!m){m=this.selectImportSource(AB.facebook,AA.facebook,w);}break;}if(l&&l.tbn){if(J.strStartsWith(l.tbn,"hdfs://")){m.type=AB.hadoop;m.subtype=AA.hadoop;}}m.xdaType=l.xt;m.iskrbpass=l.iskrbpass;if(t.datap.crt!==undefined){m.refreshType=t.datap.crt;m.origRefreshType=m.refreshType;}if(t.datap.bin!==undefined){m.binaryExists=(t.datap.bin!==1);}if(t.datap.ac!==undefined){m.executeAction=t.datap.ac;}if(t.datap.tbn!==undefined){m.dbTableName=t.datap.tbn;}if(t.datap.state){m.hasRefreshedData=t.datap.state.bin===1;if(t.datap.state.op!==undefined){m.tableState=t.datap.state.op;}}if(t.datap.isMergedCube){m.isMergedCube=t.datap.isMergedCube;}C(m,t);return m;}function B(l){var m=l.currentTransformations;return(m&&m.xtab&&m.xtab.isCrosstab)?l.transformedMapping:l.currentMapping;}function a(l){return l===k.sourceSubtype.cloudElement||l===k.sourceSubtype.url;}function N(z,p,x,o){var n=k.xdaType,m=z.xdaType,w=z.sourceInfo,u=x.sourceInfo,l=m===x.xdaType,t,q;if(z.sourceInfo.isRefined||x.sourceInfo.isRefined){return false;}if(z.sourceInfo.sdkUrl||x.sourceInfo.sdkUrl||z.subtype===k.sourceSubtype.cloudElement||x.subtype===k.sourceSubtype.cloudElement){if(z.xdaType!==n.excel||x.xdaType!==n.excel){return false;}}switch(m){case n.excel:if(a(z.subtype)&&a(x.subtype)){l=l&&w.url===u.url;l=l&&w.fileStruct===u.fileStruct&&w.skipRows===u.skipRows;l=l&&w.dbRoleId===u.dbRoleId;}else{if(z.subtype===k.sourceSubtype.localFile&&x.subtype===k.sourceSubtype.localFile){t=z.srcTableID||z.tableID;q=x.srcTableID||x.tableID;l=l&&t===q;l=l&&w.fileStruct===u.fileStruct&&w.skipRows===u.skipRows;}else{l=false;}}break;case n.text:l=l&&a(z.subtype)&&a(x.subtype);l=l&&w.fileStruct===u.fileStruct&&w.delimiter===u.delimiter;l=l&&w.quotes===u.quotes&&w.skipRows===u.skipRows;l=l&&w.dbRoleId===u.dbRoleId;break;case n.qbSingleTable:l=l&&w.dbRoleId&&w.dbRoleId===u.dbRoleId;l=l&&((!w.dbNamespace&&!u.dbNamespace)||w.dbNamespace===u.dbNamespace);break;default:l=false;}l=l&&p&&o&&p.length===o.length;if(!l){return false;}P.forEach(p,function(AB,AA){if(!(AB.ix===o[AA].ix&&AB.tp===o[AA].tp&&AB.id===o[AA].id&&(m!==n.qbSingleTable||AB.n===o[AA].n))){l=false;return false;}return true;});return l;}function S(m){var n=k.cubeSchedStatus,l;P.forEach(m,function(o){var p=o.subs,q=false,t=true,u;p=p?[].concat(p):[];if(p.length>0){P.forEach(p,function(w){u=w.status&&w.status.length>0&&w.status[w.status.length-1];if(u){q=true;t=t&&(u.en===0);}});if(!q){l=n.unexecuted;}else{if(t){l=n.successful;}else{l=n.failed;}}}else{l=n.unscheduled;}o.schedStatus=l;});return m;}mstrmojo.DI.DIModel=mstrmojo.declare(mstrmojo.Obj,[mstrmojo.DI.model._ConnectLive,mstrmojo.DI.model._DISources],{scriptClass:"mstrmojo.DI.DIModel",refresh_opt:1,folderID:"",cubeID:"",cubeName:"",cubesInfo:0,isManagedCube:false,cubeDesc:"",analysisID:"",currentSource:null,externalSources:{},importSources:null,operationMode:k.operationMode.create,refineServerURL:null,dbObjectsDisplayOptions:17,subsInfo:null,subsStatus:null,isCubePublished:false,appSchemaTables:null,rawDataExistsInAE:false,attributeFormInfo:{},cubeConfig:{},xquerySources:{},cubeQuota:0,isAddingNewTable:false,datasets:null,publishedDatasets:null,currentDataset:null,hasMergedReportInstance:false,isCalledByFlex:false,cubePersisted:false,partitionGroups:null,isCubeSaved:false,reportDefinitionId:null,isInputCredential:false,getHistoryList:function O(){if(this._HL===undefined){this._HL=new mstrmojo.DI.model.HistoryList();}return this._HL;},getSchedule:function(){if(this._Schedule===undefined){this._Schedule=new mstrmojo.DI.model.Schedule();}return this._Schedule;},sampleFiles:{file:[{display:mstrmojo.desc(14039,"Airline Sample Data"),name:"airline-sample-data.xls",url:"https://mirror.microstrategy.com/datahub/samples/airline-sample-data.xls",desc:mstrmojo.desc(14040,"On-time and delayed flights for airlines operating in the three main Washington, DC-area airports"),size:6.5,iscrosstab:"false"},{display:mstrmojo.desc(14041,"Campaign Finance Data"),name:"campaign-finance-sample-data.xls",url:"https://mirror.microstrategy.com/datahub/samples/campaign-finance-sample-data.xls",desc:mstrmojo.desc(14042,"Financial data about campaigns for Senate, House of Representatives, and President of the United States"),size:1,iscrosstab:"false"},{display:mstrmojo.desc(14044,"Gaming Sample Data"),name:"gaming-sample-data.xls",url:"https://mirror.microstrategy.com/datahub/samples/gaming-sample-data.xls",desc:mstrmojo.desc(14043,"Slot machine data for casino floor analysis. Data available at the day and individual machine level"),size:15.1,iscrosstab:"false"},{display:mstrmojo.desc(14045,"Global Migration Data"),name:"global-migration.xls",url:"https://mirror.microstrategy.com/datahub/samples/global-migration.xls",desc:mstrmojo.desc(14046,"2000 global bilateral migration data from the World Bank"),size:0.1,iscrosstab:"false"},{display:mstrmojo.desc(14047,"Income Tax Return Data"),name:"income-tax-sample-data.xls",url:"https://mirror.microstrategy.com/datahub/samples/income-tax-sample-data.xls",desc:mstrmojo.desc(14048,"2007 income tax return data items classified by state and county"),size:0.4,iscrosstab:"false"},{display:mstrmojo.desc(14049,"Inventory Sample Data"),name:"Inventory-Sample-Data.xls",url:"https://mirror.microstrategy.com/datahub/samples/Inventory-Sample-Data.xls",desc:mstrmojo.desc(14050,"Data for inventory analysis at standalone, mall and strip mall locations"),size:0.6,iscrosstab:"false"},{display:mstrmojo.desc(14051,"Retail Sample Data"),name:"retail-sample-data.xls",url:"https://mirror.microstrategy.com/datahub/samples/retail-sample-data.xls",desc:mstrmojo.desc(14052,"Retail data for category management analysis. Metrics include cost, revenue, unit cost, units sold"),size:2.3,iscrosstab:"false"},{display:mstrmojo.desc(14053,"Worldwide CO2 Emissions"),name:"Worldwide-CO2-Emissions.xls",url:"https://mirror.microstrategy.com/datahub/samples/Worldwide-CO2-Emissions.xls",desc:mstrmojo.desc(14054,"Worldwide, energy-related carbon dioxide emissions for the 1990-2010 time period"),size:0.5,iscrosstab:"false"}]},initParams:function W(l){switch(l.StatusCode){case k.statusCode.edit:this.set("operationMode",k.operationMode.edit);break;case k.statusCode.obtainSource:this.set("operationMode",k.operationMode.refresh);break;case k.statusCode.xformsError:case k.statusCode.mappingError:this.set("operationMode",k.operationMode.refresh);break;case k.statusCode.republish:this.set("operationMode",k.operationMode.refresh);break;case k.statusCode.schedule:this.set("operationMode",k.operationMode.subscribe);break;case k.statusCode.enterCredentials:this.set("operationMode",k.operationMode.enterCredentials);break;case k.statusCode.pickTable:this.set("operationMode",k.operationMode.pickTable);break;case k.statusCode.hadoopPickTable:this.set("operationMode",k.operationMode.hadoopPickTable);break;case k.statusCode.ffsql:this.set("operationMode",k.operationMode.ffsql);break;case k.statusCode.hadoopFFsql:this.set("operationMode",k.operationMode.hadoopFFsql);break;default:this.set("operationMode",k.operationMode.create);break;}if(mstrApp.isSingleTier){this.refineServerURL="http://localhost:3333/";}else{this.refineServerURL="http://"+mstrConfig.serverName+":3333/";}this.cubeID=l.ReportId;this.cubeName=l.CubeName;this.folderID=l.FolderId||"";this.cubeDesc=l.CubeDesc;if(l.isDirectDataAccess){this.set("isDirectDataAccess",l.isDirectDataAccess);}if(l.SubsId){this.getSchedule().subsID=l.SubsId;}if(l.SubsName){this.getSchedule().subsName=l.SubsName;}if(l.DocumentID){this.analysisID=l.DocumentID;}else{if(l.AnalysisId){this.analysisID=l.AnalysisId;if(l.isManagedCube!==undefined&&this.cubeID){this.isManagedCube=l.isManagedCube;}else{if(!mstrApp.isSingleTier&&mstrApp.isFromVI){this.isManagedCube=true;}else{this.isManagedCube=false;}}}}if(l.isCalledByFlex){this.isCalledByFlex=l.isCalledByFlex;this.isManagedCube=false;}if(l.datasets){this.populateVIDatasets(l.datasets);if(mstrApp.refreshMultipleCubes){this.set("cubesInfo",l.datasets);}}if(l.documentModel){this.set("documentModel",J.createMSTRObjects(l.documentModel,["dbRole"]));}if(l.missingCredentialsData){this.set("missingCredentialsData",l.missingCredentialsData);}if(l.isSparkCube){this.isSparkCube=l.isSparkCube;}this.refreshMode=l.RefreshMode;this.importSources={};this.publishedDatasets=[];},updateDocumentCredentials:function j(n,m){var l=this;mstrmojo.array.forEach(n,function(o){mstrmojo.array.forEach(l.documentModel.datasets,function(p){mstrmojo.array.forEach(p.tables,function(q){if(q.did===o){q.set("credentialsFetched",m);}});});});},selectImportSource:function Z(o,l,n){var m=this.importSources[Y(o,l,n)];if(!m){m=L(o,l,n);this.importSources[m.key]=m;}this.raiseEvent({name:"ImportTypeChanged"});return m;},populateExternalSources:function e(){var n;if(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier||J.isServerBasedWS()||mstrApp.diParams&&mstrApp.diParams.isSparkCube){var m=new mstrmojo.DI.OAuthSource({type:k.sourceType.dropbox,subtype:k.sourceSubtype.dropbox,name:"Dropbox",dbRoleID:"897B0012B9A24BF9AB297BA654F21482",scope:"",oauthVersion:"2.0",sourceID:"https://www.dropbox.com"});this.externalSources[k.sourceType.dropbox]=m;var u=new mstrmojo.DI.OAuthSource({type:k.sourceType.googleDrive,subtype:k.sourceSubtype.googleDrive,name:"Google Drive",dbRoleID:"4FC38D1FC0E140EB8FCD2CBAA235E1DE",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/drive.readonly",oauthVersion:"2.0",sourceID:"https://drive.google.com"});this.externalSources[k.sourceType.googleDrive]=u;var p=new mstrmojo.DI.OAuthAnalytics({type:k.sourceType.googleAnalytics,subtype:k.sourceSubtype.googleAnalytics,name:"Google Analytics",dbRoleID:"1304214B5640429EBC5FA0820E64DEC4",oauthVersion:"2.0",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/analytics.readonly ",sourceID:"http://www.google.com/analytics/"});this.externalSources[k.sourceType.googleAnalytics]=p;var t=new mstrmojo.DI.OAuthSource({type:k.sourceType.googleBigQuery,subtype:k.sourceSubtype.googleBigQuery,name:"Google BigQuery",dbRoleID:"021CDA5330A0437A8477B597796F2AC3",oauthVersion:"2.0",scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/bigquery.readonly",step2:mstrmojo.desc(12461,"Make a query and get results"),step3:mstrmojo.desc(12462,"Publish cube to create documents"),sourceID:"https://developers.google.com/bigquery/"});this.externalSources[k.sourceType.googleBigQuery]=t;var o=new mstrmojo.DI.OAuthSource({type:k.sourceType.salesforce,subtype:k.sourceSubtype.salesforce,name:"Salesforce",step2:mstrmojo.desc(12463,"Select Your Report"),dbRoleID:"AC41E217C55342DC871C511E77EBE4D0",oauthVersion:"2.0",scope:"id api refresh_token web",sourceID:"https://www.salesforce.com"});this.externalSources[k.sourceType.salesforce]=o;var q=new mstrmojo.DI.OAuthSource({type:k.sourceType.twitter,subtype:k.sourceSubtype.twitter,name:"Twitter",dbRoleID:"7FADDA9B2CF44458A38DE40C786FD99D",oauthVersion:"1.0",sourceID:"https://www.twitter.com"});this.externalSources[k.sourceType.twitter]=q;var l=new mstrmojo.DI.OAuthSource({type:k.sourceType.facebook,subtype:k.sourceSubtype.facebook,name:"Facebook",dbRoleID:"C4232C63F23D4932B75CFBAC950EADE7",oauthVersion:"2.0",scope:"email user_likes public_profile",sourceID:"https://www.facebook.com"});this.externalSources[k.sourceType.facebook]=l;}},getTags:function(m){var l=this.searchTags[m];if(l){return l;}},getDisplayOptionsByType:function(n){var m=this.searchTags[n];var l;if(m){mstrmojo.array.forEach(m,function(o){if(o==="Hadoop"){l=16;}else{if(o==="Database"){l=1;}}});return l;}},populateAllTables:function(p,m,w){var u=this;var n=p.datap.length;var q;var l=0;var x={},t,z={},o=false;t=this.getAllTableID();if(p.rit){this.isCubePublished=(p.rit.pcube===1);this.rawDataExistsInAE=(p.rit.eprd===1);}if(p.prs&&p.prs.dda){this.connectLiveSupport=p.prs.dda;}if(this.operationMode!==k.operationMode.create&&p.prs&&p.prs.ddam){this.isDirectDataAccess=(p.prs.ddam===2);}for(q=0;q<n;q++){x.datap=p.datap[q];x.btb=p.btb;x.forms=p.forms;x.prs=p.prs;l|=this.populateEMMA(x,m,null,true);if(x.datap.tbid){z[x.datap.tbid]=true;}}if(p.rit&&p.rit.ts&&p.rit.ts.length){P.forEach(p.rit.ts,function(AA){var AB=u.getImportSource(AA.tbid);if(AB){AB.forceRepublish=(AA.ac===1);AB.schemaChanged=(AA.crt!==0);if(AA.ac===1){AB.refreshType=k.cubeRefreshType.replaceTable;AB.executeAction=k.tableStatsExecutionAction.forceExecution;}}});}P.forEach(t,function(AA){if(z[AA]!==true){o=true;this.resetImportSource(AA);}},this);if(o){this.raiseEvent({name:"MappingsFetched"});}this.raiseEvent({name:"tableNamesChanged"});q=this.populateTablesPosition(p);if(q&&!w){this.raiseEvent({name:"TablesPositionFetched"});}if((m&k.requestFlag.sourceInfo)===k.requestFlag.sourceInfo){if(!w){this.raiseEvent({name:"SourceInfoFetched"});}}if((l&k.requestFlag.relationship)===k.requestFlag.relationship){if(!w){this.raiseEvent({name:"RelationshipFetched"});}}if((l&k.requestFlag.mapping)===k.requestFlag.mapping){if(!w){this.raiseEvent({name:"MappingsFetched"});}}return l;},populateTablesPosition:function(q){var x=-1,t,p,o,u,n,m,l,w=false;if(q.btb){u=[].concat(q.btb);}for(t=0;u&&t<u.length;t++){if(u[t].oi&&u[t].oi.tp===3){x=t;break;}}if(x<0){return ;}p=q.btb[x].oi.def.em.sou.it_c;this.cubePersisted=q.btb[x].oi.sta&256;if(!p){return ;}p=[].concat(p);for(t=0;t<p.length;t++){o=p[t];n=o.tb.did;m=this.getImportSource(n);if(m){l=m.populatePosition(o.sqltf);w=w||l;}}return w;},populate:function K(n,o){if(n.btb&&n.btb[0]&&n.btb[0].oi&&n.btb[0].oi.def&&n.btb[0].oi.def.crpt){this.refresh_opt=n.btb[0].oi.def.crpt;}if(n.prs){this.connectLiveSupport=n.prs.dda;}var m;if((o&k.requestFlag.sourceInfo)===k.requestFlag.sourceInfo){m=h.call(this,n);this.raiseEvent({name:"SourceInfoFetched"});}var l=m.populate(n,o);if((l&k.requestFlag.preview)===k.requestFlag.preview){this.raiseEvent({name:"PreviewFetched"});}if((l&k.requestFlag.transformedPreview)===k.requestFlag.transformedPreview){this.raiseEvent({name:"TransformedPreviewFetched"});}if((l&k.requestFlag.mapping)===k.requestFlag.mapping){this.raiseEvent({name:"MappingsFetched"});}else{if((o&k.requestFlag.mapping)===k.requestFlag.mapping){this.raiseEvent({name:"MappingsNotFetched"});}}if((l&k.requestFlag.sheets)===k.requestFlag.sheets){this.raiseEvent({name:"SheetsFetched"});}if((l&k.requestFlag.transformations)===k.requestFlag.transformations){this.raiseEvent({name:"TransformationsFetched"});}this.currentSource=m;return l;},populateAttributeGroup:function F(m,l){this.attributeFormInfo[l]=I(m);},populateCubeConfig:function A(n){var l={},q=n.datap,p,o={},t=[];if(q[0]){p=q[0];}else{p=q;}var m=p.pas?p.pas[0]:null;l.keyId=m?m.atid:"";l.pf=p.pf||0;if(n.sidxes){P.forEach(n.sidxes,function(u){t.push({atid:u.stat,afid:u.stafid});});}o.distInfo=l;o.sidxes=t;o.initialSet=X.clone(o);o.autopa=p.autopa===1;if(p.autopa===1){o.distInfo.keyId="autopa";}this.cubeConfig=o;this.raiseEvent({name:"CubeConfigFetched"});},populateWikiSuggestions:function E(l){this.set("wikiSuggestions",l[1]);},populateWikiSearchResults:function b(l){this.wikiSearchResults=l;this.raiseEvent({name:"wikiSearchResultsFetched"});},populateEMMA:function R(o,n,u,t){var l,p,w,q;if(o.rit){this.isCubePublished=(o.rit.pcube===1);this.rawDataExistsInAE=(o.rit.eprd===1);}if(o.prs&&o.prs.dda){this.connectLiveSupport=o.prs.dda;}if(this.operationMode!==k.operationMode.create&&o.prs&&o.prs.ddam){this.isDirectDataAccess=(o.prs.ddam===2);}w=-1;if(o.btb){q=[].concat(o.btb);for(p=0;q&&p<q.length;p++){if(q[p].oi&&q[p].oi.tp===3){w=p;this.isSparkCube=q[p].oi.ext_type===k.xdaType.sparkDataset;break;}}if(w>-1){this.reportDefinitionId=o.btb[w].oi.did;}}if(Object.prototype.toString.call(o.datap)==="[object Array]"){return this.populateAllTables(o,n,t);}if((n&k.requestFlag.sourceInfo)===k.requestFlag.sourceInfo){l=h.call(this,o,u);if(!t){this.raiseEvent({name:"SourceInfoFetched"});}}if(!l){l=this.importSources[u];}var m=l.populate(o,n,l.tableID);if((m&k.requestFlag.preview)===k.requestFlag.preview){if(!t){this.raiseEvent({name:"PreviewFetched"});}}else{if((n&k.requestFlag.preview)===k.requestFlag.preview){if(!t){this.raiseEvent({name:"PreviewNotFetched"});}}}if((m&k.requestFlag.relationship)===k.requestFlag.relationship){if(!t){this.raiseEvent({name:"RelationshipFetched"});}}if((m&k.requestFlag.transformedPreview)===k.requestFlag.transformedPreview){if(!t){this.raiseEvent({name:"TransformedPreviewFetched"});}}if((m&k.requestFlag.mapping)===k.requestFlag.mapping){this.getAllMappings();if(!t){this.raiseEvent({name:"MappingsFetched"});}}else{if((n&k.requestFlag.mapping)===k.requestFlag.mapping){if(!t){this.raiseEvent({name:"MappingsNotFetched"});}}}if((m&k.requestFlag.sheets)===k.requestFlag.sheets){if(!t){this.raiseEvent({name:"SheetsFetched"});}}if((m&k.requestFlag.transformations)===k.requestFlag.transformations){if(!t){this.raiseEvent({name:"TransformationsFetched"});}}return m;},getAllMappings:function(){var n,m,o,q,t;var p=[];for(n in this.importSources){o=this.importSources[n];if(o.currentTransformations&&o.currentTransformations.xtab&&o.currentTransformations.xtab.isCrosstab){t=o.transformedMapping;}else{t=o.currentMapping;}if(t){for(m=0;t&&m<t.length;m++){q=t[m];q.isLinked=false;if(q.id){var l=mstrmojo.array.find(p,"id",q.id);if(l<0){p.push(q);}else{p[l].isLinked=true;q.isLinked=true;}}else{p.push(q);}}}}return p;},getAllRelationships:function(){var o,n,l,t,u,m;var p=[];var q=false;for(o in this.importSources){t=this.importSources[o];u=t.relationship;if(u){for(n=0;n<u.length;n++){m=u[n];q=false;for(l=0;l<p.length;l++){if(p[l].parent.id===m.parent.id&&p[l].child.id===m.child.id&&p[l].ert===m.ert){q=true;break;}}if(!q){p.push(m);}}}}return p;},findMappingSource:function(o){var m=[];var q,p,l,n,u;if(!o){return m;}for(q in this.importSources){l=this.importSources[q];if(l.currentTransformations&&l.currentTransformations.xtab&&l.currentTransformations.xtab.isCrosstab){u=l.transformedMapping;}else{u=l.currentMapping;}if(u){for(p=0;p<u.length;p++){n=u[p];if(o.id){if(n.id&&n.id===o.id){if(o.isAttributeForm){if(n.isMultiForm){var w=n.subColumns,t=mstrmojo.array.find(w,"afid",o.afid);if(t>=0){m.push(l);break;}}else{if(n.afid===o.afid){m.push(l);break;}}}else{m.push(l);break;}}}else{if(o.oid){if(n.oid&&n.oid===o.oid){m.push(l);break;}}else{if(n.did===o.did){m.push(l);break;}}}}}}return m;},findMappingItem:function(p,o){var n=this.getAllTableID();var q=[];var m,l;if(o){l=this.getImportSource(o).findMappingItem(p);if(l){q.push(l);}}else{for(m=0;m<n.length;m++){l=this.getImportSource(n[m]).findMappingItem(p);if(l){q.push(l);}}}return q;},getAllMissingColumns:function(){var o=this.getAllTableID();var l=[];var n,m,p;for(n=0;n<o.length;n++){p=this.getImportSource(o[n]);m=p.getMissingColumns();if(m&&m.length>0){l=l.concat(m);}}return l;},createImportSource:function(l,m,n){return this.selectImportSource(l,m,n);},getImportSource:function(l){return this.importSources[l]||null;},getAllTableID:function(){var l=[];var n,m;for(n in this.importSources){m=this.importSources[n];if(m&&m.tableID){l.push(n);}}return l;},selectSourceTable:function(l){if(this.currentSource&&this.currentSource.key===l){return ;}if(!this.currentSource&&(l===-1||l===null)){this.raiseEvent({name:"CurrentSourceChanged"});return ;}if(l===-1||l===null){this.currentSource=null;}else{this.currentSource=this.getImportSource(l);}this.raiseEvent({name:"CurrentSourceChanged"});},resetImportSource:function(l){if(l){if(this.sheetsInfo&&this.sheetsInfo[l]){delete this.sheetsInfo[l];}if(this.importSources[l]){if(this.importSources[l].sourceInfo){this.importSources[l].sourceInfo.destroy();}this.importSources[l].destroy();}delete this.importSources[l];if(this.currentSource&&this.currentSource.tableID===l){this.currentSource=null;this.raiseEvent({name:"CurrentSourceChanged"});}}else{if(this.currentSource!==null){this.currentSource=null;this.raiseEvent({name:"CurrentSourceChanged"});}this.importSources={};}},hasRelationship:function(o,n,t){var q=this.getImportSource(o),l=q.relationship||[],m,p=false;if(!o||!n||!t){return p;}if(!q){return p;}for(m=0;m<l.length;m++){if(l[m].parent.id===n.id&&l[m].child.id===t.id){p=true;break;}}return p;},isEMMACube:function(){var l;if(this.currentSource&&this.currentSource.tableID){return true;}l=this.getAllTableID().length>0;return l;},hasEMMAReportInstance:function(){return mstrApp.getRootController().dataService.messageID?true:false;},populateSubscriptions:function(o){var m=this;var p=m.cubesInfo;var n=(o&&o.items)||[];var l=p&&p.cubes&&p.cubes.cube;var q=p&&p.cubes&&p.cubes.doc;var t;l=l&&[].concat(l);n=[].concat(n);P.forEach(l,function(u){t=u.cube_id;u.subs=P.filter(n,function(w){return w.contentID===t;});});l=S(l);P.forEach(q,function(w){var u=w.cube?[].concat(w.cube):[];P.forEach(u,function(x){x.subs=P.filter(n,function(z){return z.contentID===x.cube_id;});});S(u);});m.set("subsInfo",n);},populateScheduleStatus:function(z){var l=this.cubesInfo&&this.cubesInfo.cubes&&this.cubesInfo.cubes.cube;var x=this.cubesInfo&&this.cubesInfo.cubes&&this.cubesInfo.cubes.doc;var n,o,w,t,u;var q=z.sesr&&z.sesr.subscription;var p={},m;function AB(AD,AC){return AD.timestamp-AC.timestamp;}function AA(AC,AD){AD=[].concat(AD);P.forEach(AD,function(AE){n=AE.did;o=AE.content_id;w=P.find(AC,"cube_id",o);if(w>=0){t=P.find(AC[w].subs,"did",n);if(t>=0){u=[];P.forEach(AE.exec_status&&[].concat(AE.exec_status),function(AF){u.push({en:AF.en,emsg:AF.emsg,timestamp:new Date(J.normalizeTimestamp(AF.timestamp))});});u.sort(AB);AC[w].subs[t].status=u;p[n]=u;}}});AC=S(AC);}if(!q){return ;}AA(l,q);P.forEach(x,function(AD){var AC=AD.cube?[].concat(AD.cube):[];AA(AC,q);});m=mstrmojo.hash.copy(this.subsStatus,m);p=mstrmojo.hash.copy(p,m);this.set("subsStatus",p);},mapAttribute:function M(u,n,AA,AB){var p=this,m=p.getImportSource(u.tableId),w,AD=u.did,t,o,q=n.dssid,z;if(m.currentTransformations&&m.currentTransformations.xtab&&m.currentTransformations.xtab.isCrosstab){w=m.transformedMapping;}else{w=m.currentMapping;}o=n.aid;for(t=0,z=w.length;t<z;t++){if(w[t].afid===(o+q)){if(AA&&AA.failure){AA.failure(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));}return false;}}var x=mstrmojo.array.find(w,"did",AD),l=w[x],AC=function AC(){mstrApp.getRootController().changeEMMAMappings();};if(l.isIDForm&&l.multiForms&&!l.ipa){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var AE=[];mstrmojo.array.forEach(w,function(AF){if(AF.oid===AB&&AF.did!==AD){AE.push({did:AF.did,aid:"",ot:12});}});AE.push({did:AD,aid:o,fid:q});AC(AE);}}});}else{AC();}},getAllPartitionTables:function d(t,o){var p=this.importSources,x=p[t],m,l,u=[],z=[],w,q;function n(AB,AA){var AC;if(AB.n<AA.n){AC=-1;}else{if(AB.n===AA.n){AC=0;}else{AC=1;}}return AC;}if(!x){return[];}m=B(x);q=this.getAllTableID();P.forEach(q,function(AA){if(AA!==t){l=p[AA];if(N(x,m,l,B(l))){w=l.sourceInfo&&l.sourceInfo.name;u.push({n:w||"",isMember:false,sourceId:AA});}}});u.sort(n);P.forEach(o,function(AB,AA){w=AB.name||"";z.push({n:w,isMember:true,ptIndex:AA+1});});z.sort(n);u=z.concat(u);return u;},detectPartitionGroups:function H(n,AD){var t=this.importSources,AE,p=[],l,u,AC,AB,m,q=[];if(n.length<=1){return p;}P.forEach(n,function(AF){AE=t[AF];if(!AE){return ;}l=B(AE);if(!l||!l.length){return ;}u={importSource:AE,mapping:l};AC=false;P.forEach(p,function(AG){if(N(u.importSource,u.mapping,AG.importSource,AG.mapping)){AG.tableIds.push(AF);AC=true;return false;}return true;});if(!AC){u.tableIds=[AF];p.push(u);}});var w=false,AA=t[p[0].tableIds[0]].xdaType,x=AA===k.xdaType.qbSingleTable,z=AA===k.xdaType.googleBigQuerySingleTable,o=false;w=x&&!AD;o=!w;P.forEach(p,function(AF){if(AF.tableIds.length<=1&&!AD){return ;}m=[];var AG;P.forEach(AF.tableIds,function(AI,AH){AE=t[AI];if(x){AB=(AE.sourceInfo&&AE.sourceInfo.dbTableName)||"";AG=AH===0?AB:AG;}else{if(z&&AD){AB=(AE.sourceInfo&&AE.sourceInfo.dbTableName)||"";}else{AB=(AE.sourceInfo&&AE.sourceInfo.name)||"";}}m.push(AB);if(!o&&AG!==AB){o=true;}AG=AB;});if(o){q.push({tableIds:AF.tableIds,tableNames:m});}});return q;},populateVIDatasets:function(m){var l=[{name:mstrmojo.desc(14201,"A New Dataset"),did:-1}];m=P.filter(m,function(p){var o=true,n=p.tables&&p.tables[0];if(p.dsm===2&&n&&n.dict===k.backendSourceSubtype.url&&n.dbt===V.BDE){o=false;}return o;});l=l.concat(m);this.set("datasets",l);},selectDataset:function(m){var l=mstrApp.getRootController();if(m&&m.did!==-1){this.set("isManagedCube",!!m.mngd);l.rootView.showFooter({managedCheckbox:{enabled:false}});this.set("currentDataset",m||null);}else{this.set("currentDataset",null);l.rootView.showFooter({managedCheckbox:{enabled:true}});this.set("isManagedCube",true);}},canSubscribe:function(){var n=this.getAllTableID(),l=false,m;for(m=0;m<n.length;m++){l|=this.getImportSource(n[m]).canSubscribe();}return l;},isFromPushApi:function(){var o=this.getAllTableID(),p=false,m=o.length,l;for(l=0;l<m;l++){var n=this.importSources[o[l]];if(n&&n.isFromPushApi()){p=true;break;}}return p;},isTableAliasUnique:function(n){var p=true,l=this.getAllTableID(),o,m;for(m=0;m<l.length;m++){o=this.getImportSource(l[m]);if(o&&o.sourceInfo&&n===o.sourceInfo.name){p=false;break;}}return p;},hasPrivilegesForAllTables:function g(m){var l=true,n=k.xdaType;P.forEach(m,function(o){switch(o.xdaType){case n.text:case n.excel:case n.refine:case n.dataImportOAuthGDrive:case n.dataImportOAuthDropbox:if(o.type===k.sourceType.hadoop){if(!mstrApp.diParams.ImportDatabase){l=false;return ;}}else{if(!mstrApp.diParams.AccessDataFromFiles){l=false;return ;}}break;case n.dataImportOAuthGBigQuery:case n.dataImportOAuthGBigQueryFFSQL:case n.dataImportOAuthGBigQuerySingleTable:case n.qbSingleTable:case n.ffsql:case n.querybuilder:case n.mdx:if(!mstrApp.diParams.ImportDatabase){l=false;return ;}break;case n.salesforce:case n.dataImportOAuthGAnalytics:case n.twitter:case n.facebook:if(!mstrApp.diParams.AccessDataFromCloudApp){l=false;return ;}break;}});return l;},hasRefreshDataPrivilegesForAllTables:function c(m){var l=this.hasPrivilegesForAllTables(m);return l||mstrApp.isSingleTier;},isRefreshDataSupported:function D(m){var l=k.xdaType;switch(m){case l.dataImportOAuthGDrive:case l.dataImportOAuthDropbox:case l.dataImportOAuthGBigQuery:case l.dataImportOAuthGBigQueryFFSQL:case l.dataImportOAuthGBigQuerySingleTable:case l.dataImportOAuthGAnalytics:case l.dataImportOAuthSalesforce:case l.twitter:case l.facebook:if(document.location.protocol.indexOf("https")<0&&!mstrApp.isSingleTier&&!J.isServerBasedWS()){return false;}else{return true;}break;default:return true;}},isRefined:function G(l){var m=this.getImportSource(l);return m?m.isRefined():false;},isParsed:function f(l){var m=this.getImportSource(l);return m?m.isParsed():false;},populateSourceListAdminConfig:function(p,o){var m=this,l=m.sourceItems,n=p;P.forEach(l,function(u){var t=u.sid,q;if(p){q=P.indexOf(n,t===k.sourceItemType.newConnector||t===k.sourceItemType.cloudElement?u.oid:t);u.selected=q<0;}if(o&&o[t]){u.dbRolesAdminConfig=o[t];}});},isLinkedMFA:function(m){var l=false;var n=this.findMappingItem(m);if(n.length>1){P.forEach(n,function(o){if(o.isMultiForm){l=true;return false;}});}return l;},getUniqueAlias:function(o,n){var p=false,q,m,l;q=this.getAllMappings();q=P.filter(q,function(t){return t.tp===o;});m=1;while(!p){p=true;m++;if(n.length>=250){n=n.substr(0,100)+"..."+n.substr(n.length-100,100);}l=P.find(q,"alias",n);if(l>=0){p=false;n=n+" ("+m+")";}}return n;},populateCloudElementDBRole:function(l){this.set("cloudElementDBRolesFetched",true);this.set("cloudElementDBRoles",l&&l.dbRoles);},hasCloudElementFetched:function(){return !!this.cloudElementDBRoles;},hasCustomConnenctFetched:function(){return !!this.customConnectorDBRoles;},hasDBMSTypeFetched:function(){return !!(this.supportDBObjects&&this.supportDBObjects.supportDBType);},populateAuthenticationDBRole:function(l){this.set("authDBRolesFetched",true);this.set("authDBRoles",l&&l.dbRoles);},getHierarchyRdcs:function(q){var m=this.importSources,p=[],l;for(var o in m){if(m.hasOwnProperty(o)){if(m[o].isHierarchyRelationTable()&&(m[o].getRecursiveAttr().oid===q)){p=m[o].getRecursiveAttr().rdcs;l=P.filterOne(m[o].currentMapping,function(t){return t.recursive;});p.splice(0,0,{did:l.did,fg:1});break;}}}for(var n=p.length;n>0;n--){p[n]=p[n-1];}delete p[0];return p;},getHierarchyRelationTabele:function(n){var l=this.importSources;for(var m in l){if(l.hasOwnProperty(m)){if(l[m].isHierarchyRelationTable()&&(l[m].getRecursiveAttr().oid===n)){return m;}}}return undefined;},cleanDuplicateRI:function U(m,n){var l;if(this.originalMsgID&&this.originalMsgID!==mstrApp.msgid){if(m){l=mstrApp.msgid;mstrApp.msgid=this.originalMsgID;mstrApp.getRootController().getDataService().set("messageID",this.originalMsgID);}else{l=this.originalMsgID;mstrApp.msgid=mstrApp.getRootController().getDataService().messageID;mstrApp.messageID=mstrApp.msgid;}mstrApp.getRootController().getDataService().removeOrDuplicateRI(n,{add:false,messageID:l,msgid:mstrApp.msgid});delete this.originalMsgID;}else{if(n&&n.success){n.success();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz");mstrmojo.RadioList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.RadioList",inputType:"radio",cssClass:"mstrmojo-RadioList",itemCssClass:"mstrmojo-RadioList-item",onenabledChange:function A(B){for(var C=0;C<this.items.length;C++){this._getItemNode(C).firstChild.disabled=!B.value;}}});mstrmojo.RadioListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.RadioListHoriz",inputType:"radio",cssClass:"mstrmojo-RadioListHoriz",itemCssClass:"mstrmojo-RadioListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz","mstrmojo.hash");mstrmojo.CheckList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.CheckList",inputType:"checkbox",cssClass:"mstrmojo-CheckList",itemCssClass:"mstrmojo-CheckList-item"});mstrmojo.requiresCls("mstrmojo._InputListHoriz");mstrmojo.CheckListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.CheckListHoriz",inputType:"checkbox",cssClass:"mstrmojo-CheckListHoriz",itemCssClass:"mstrmojo-CheckListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.HierarchyCheckList","mstrmojo.ui._HierarchyListSelection","mstrmojo.EnumSelectionType","mstrmojo.hash","mstrmojo.array","mstrmojo.css");var L=mstrmojo.hash,S=mstrmojo.css,H=mstrmojo.array,A=mstrmojo.EnumSelectionType;var R="dynamic",K="hasSelectedDsct";var W=7;function G(a,X,Z){var b=[],Y={};H.forEach(a,function(d){var c=d.v;if(c>=Z){b.push(d);if(X.isLevelSelected(c)){Y[b.length-1]=true;}}});return{items:b,selectedIndices:Y};}mstrmojo.vi.ui.HierarchyCheckList=mstrmojo.declare(mstrmojo.ui.HierarchyCheckList,[mstrmojo.ui._HierarchyListSelection],{scriptClass:"mstrmojo.vi.ui.HierarchyCheckList",getItemMarkup:function D(Y,X){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><div class="right"><span class="refresh" title="{@refreshTitle}"></span><span class="branch" title="{@branchTitle}"></span><span class="level" title="{@levelTitle}"></span></div><div class="content"><span class="indent" style="padding-left: {@indent}px;"></span><span class="triangle"></span><span class="checkbox"></span><span class="text">{@en@n}</span></div></{@tag}>';},getItemProps:function U(Z,X){var Y=this._super(Z,X);if(Z.isBranchSelected){Y.addCls(R);}if(Z.hasDsctSelected){Y.addCls(K);}L.copy({refreshTitle:mstrmojo.desc(15251,"Dynamic"),branchTitle:Z.isSelected?mstrmojo.desc(15921,"Single Deselect"):mstrmojo.desc(15920,"Single Select"),levelTitle:mstrmojo.desc(15919,"Level Select"),},Y);return Y;},onclick:function V(X){var Z=X.getTarget(),a=this.getItemNodeFromTarget(Z),Y=this.getItemFromTarget(Z);if(Y){if(S.hasClass(Z,"triangle")){if(Y.hcd){this.doExpandCollapse(a,Y);}}else{if(S.hasClass(Z,"branch")){this.doElementSelect(a,Y,!Y.isSelected);}else{if(S.hasClass(Z,"level")){this.openLevelPopup(a,Y,Z);}else{if(!S.hasClass(Z,"indent")&&!S.hasClass(Z,"refresh")){this.doBranchSelect(a,Y,!Y.isSelected);}}}}X.cancel();}},onSelectionChange:function I(Y,X,Z,a){if(Y===A.ALL&&X){this.clearSelections();(this.raad?this.getInitialDisplayRoots():this.getRootItems()).forEach(function(b){if(b.v){this.selectionList.push({func:A.BRANCH,itemValue:b.v,isNot:false});}},this);if(this.postSelectionChange){this.postSelectionChange();}}else{this._super(Y,X,Z,a);}},updateItemNodesStatus:function M(){var X=this.itemsContainerNode&&this.itemsContainerNode.childNodes;this._super();H.forEach(X,function(a){var Z=this.getItemFromTarget(a),Y=a.getElementsByClassName("branch")[0];if(Z){S.toggleClass(a,R,Z.isBranchSelected);S.toggleClass(a,K,Z.hasDsctSelected);if(Y){Y.title=Z.isSelected?mstrmojo.desc(15921,"Single Deselect"):mstrmojo.desc(15920,"Single Select");}}},this);},getSummaryText:function J(){return"";},getLevels:function E(){return[];},getLevelItems:function B(Y){var a=this.getLevels(),b=Y?[{v:-1,n:mstrmojo.desc(15824,"All Levels")}]:[];if(a.length>0){return b.concat(a);}var X=this.getMaxLevel();for(var Z=0;Z<=X;Z++){b.push({v:Z,n:mstrmojo.desc(493,"Level")+" "+(Z+1)});}return b;},postBuildRendering:function Q(){var Z=this.levelPopup,Y=this.domNode;if(!Z){var X=this.getLevelPopupConfig(),a=L.walk(X.scriptClass,window);delete X.scriptClass;Z=this.levelPopup=new a(X);this.addDisposable(Z);}Z.placeholder=Y.insertBefore(document.createElement("div"),Y.firstChild);Z.render();return this._super();},unrender:function P(X){var Y=this.levelPopup;if(Y){Y.unrender(X);}return this._super(X);},onScrollEnd:function C(){var Y=this.levelPopup,X=Y&&Y.getPopupWidget();if(X&&X.visible){Y.closePopup();}this.hideTooltip();},openLevelPopup:function O(b,Z,Y){var a=this.levelPopup,X=a.getPopupWidget();if(a&&Z.hcd&&this.isHiearachyDisplay()){a.openPopup(X,{branch:Z,branchNode:b});if(Y){X.domNode.style.left=Y.offsetLeft+"px";X.domNode.style.top=Y.offsetTop+Y.offsetHeight-this.scrollNode.scrollTop+"px";}}},getLevelPopupConfig:function N(Z){return L.copy(Z,{scriptClass:"mstrmojo.ui.PopupButton",markupString:'<div id="{@id}" class="level-popup-btn" title="{@title}" mstrAttach:click></div>',title:mstrmojo.desc(15919,"Level Select"),isHostedWithin:false,parent:this,widget:this,children:{scriptClass:"mstrmojo.ui.PopupWidget",alias:"levelPopup",visible:false,children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"checklist",doItemSelect:function b(j,g){var f=this.parent,k=f.opener.widget,h=!this.selectedIndices[j._renderIdx];if(f.branch&&f.branchNode){k.doBranchLevelSelect(f.branchNode,f.branch,j.v,h);}else{k.doLevelSelect(j.v,h);}mstrmojo._IsList.doItemSelect.call(this,j,g);},onclick:function Y(f){if(!S.hasClass(f.getTarget(),"refresh")){mstrmojo._IsList.onclick.call(this,f);}},getItemMarkup:function d(f){return mstrmojo.ui.CheckList.prototype.getItemMarkup.call(this,f).replace('<span class="text">{@en@n}</span>','<span class="refresh"></span><span class="text">{@en@n}</span>');}}],onOpen:function X(){var h=this.opener.widget,f=this.branch,g=G(h.getLevelItems(),h.getLevelSelection(f),f&&f.lv+1||0);this.checklist.set("items",g.items);this.checklist.set("selectedIndices",g.selectedIndices);}},getPopupWidget:function c(){return this.levelPopup;},onPopupWidgetOpened:function a(){S.addClass(this.levelPopup.branchNode,"level-popup-open");},onPopupWidgetClosed:function e(){S.removeClass(this.levelPopup.branchNode,"level-popup-open");}});},getAllButtonConfig:function F(Y,X){return L.copy(X,Y?{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(3474,"Select All"),alias:"selectAllBtn",cssClass:"selectAll",widget:this,onclick:function(){this.widget.doAllSelect(true);}}:{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1763,"Clear All"),alias:"clearAllBtn",cssClass:"clearAll",widget:this,onclick:function(){this.widget.doAllSelect(false);}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.PreviewButton","mstrmojo.ui.PopupList","mstrmojo.array","mstrmojo.css");var F=mstrmojo.css,E=mstrmojo.array;mstrmojo.ui.editors.controls.ListPreviewButton=mstrmojo.declare(mstrmojo.ui.editors.controls.PreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ListPreviewButton",init:function G(L){this._super(L);var M=this.getListCfg(),K=this.itemValueField;M.alias="list";M.locksHover=true;M.slot="widgetHostNode";M.listHooks={select:function J(N,O){this.parent.set("selectedValue",O[K]);this.close();}};M.setDimensions=mstrmojo.emptyFn;this.addChildren([M]);F.addWidgetCssClass(this.list,"ctrl-popup-list");},getPopupWidget:function D(){return this.list;},items:null,onitemsChange:function H(){var J=this.items;if(J){this.list.set("items",J);}},selectedValue:"",itemValueField:"n",onselectedValueChange:function C(){var K=this.selectedValue,J=this.itemValueField,L=this.list;L.selectItems(E.filter(L.items||[],function(M){return M[J]===K;}),true);this.updatePreview();},updatePreview:function B(){throw new Error(this.scriptClass+" must implement updatePreview.");},getListCfg:function I(){return{scriptClass:"mstrmojo.ui.PopupList",selectionPolicy:"reselect"};},postBuildRendering:function A(){this.onitemsChange();this.onselectedValueChange();return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo._HasTooltip","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.string","mstrmojo.css","mstrmojo.array","mstrmojo._CanAutoClose");var U=mstrmojo.css,L=mstrmojo.array,F=mstrmojo.dom,B=mstrmojo.string;function H(W){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",content:B.encodeHtmlString(W)});}mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,onSelectedItemChange:mstrmojo.emptyFn,useRichTooltip:true,allowHTML:false,useDarkTheme:false,init:function P(W){this._super(W);U.addWidgetCssClass(this.getPopupList(),"ctrl-popup-list");},initChildren:function C(){this.children=this.getPopupListConfig();this._super();},postBuildRendering:function Q(){if(this._super){this._super();}var W=this.getSelectedItem();if(W){H.call(this,W.n);}},showTooltip:function D(a,Z){var X=this.selectedNode,Y=this.richTooltip;if(X.offsetWidth>=X.scrollWidth){return ;}if(!Y.top){var W=F.position(this.selectedNode);Y.top=W.y-3;Y.left=W.x+W.w+6;}if(this._super){this._super(a,Z);}},getSelectedItem:function M(){var W=this.items;return W&&W[this.selectedIndex];},selectItemByField:function A(X,W){this.set("selectedIndex",L.find(this.items||[],X,W));},getPopupWidget:function E(){return this.list;},getPopupList:function J(){return this.list;},_set_items:function I(Z,W){var Y=this.items;this.items=W;delete this.selectedIndex;if(Y!==W){var X=this.hasRendered;if(X){this.refresh();}return true;}return false;},onclick:function V(W){this._super(W);var Y=this,X=Y.getPopupWidget();Y.mw=Y.mw||function(Z){if(!F.contains(X.domNode,F.eventTarget(self,Z),true,document.body)){X.close();F.detachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Y.mw);}};F.attachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Y.mw);if(Y.focusOnPopup){X.domNode.focus();}},_set_selectedIndex:function N(d,a,Y){if((a!==0&&!a)||a<0){return false;}var X=this.selectedIndex=a,W=this.getPopupList(),Z=W&&W.items,c=Z&&Z[X],b=this.selectedNode;if(c&&c.dsbld){return false;}if(W){mstrmojo._ListSelections._set_selectedIndex.call(W,"selectedIndex",X,Y);}if(b&&Z&&Z[X]){b.innerHTML=this.getPulldownTextInnerHTML(Z[X]);b.title=Z[X].title||"";}if(Z&&Z[X]){if(this.focusOnPopup&&W&&!W.closeAfterSelection){W.itemsContainerNode.children[X].style.color="";}else{this.onitemSelected(Z[X],X);}}return true;},getPulldownTextInnerHTML:function G(W){return this.allowHTML?W.n:B.encodeHtmlString(W.n,true);},postselectedIndexChange:function O(W){var a=W.value,Y=W.valueWas;if(a!==Y){var X=this.items,Z=X[a];if(Z){H.call(this,Z.n);}this.onSelectedItemChange(Z,X[Y]);}},getPopupConfig:function K(){var W=this._super();W.useDarkTheme=this.useDarkTheme;return W;},getPopupListConfig:function S(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,useRichTooltip:true,showTooltipForLargeText:true,scrollNodeMaxHeight:this.scrollNodeMaxHeight,listHooks:{select:function W(a,b,Z){this.parent.set("selectedIndex",Z);if(this.visible&&this.closeAfterSelection&&!this.selectedItem.dsbld){this.close();}}},getItemProps:function X(b,Z){var a=mstrmojo._IsList.getItemProps.call(this,b,Z);a.style=this.parent.itemCssText||"";return a;},suppressClose:function Y(Z){return mstrmojo._CanAutoClose.suppressClose.call(this,Z)||F.contains(this.parent.domNode,Z,true,document.body);}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function R(X,b,W,a,Z){a=a||{};a.items=X;var Y;if(Z===true){Y=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:W||0},a);}else{Y=new mstrmojo.ui.Pulldown(a);if(W!==undefined){Y.set("selectedIndex",W);}}Y.onSelectedItemChange=b||mstrmojo.emptyFn;return Y;};}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.List","mstrmojo.ui.Pulldown","mstrmojo.array","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(2057,7674,7675,7676,7677,7696,7697,9924,12375,12696,12919,12948,12973,13521,13522,13523,13524);var R=mstrmojo.css,S=mstrmojo.array;var L={NONE:0,CITY:1,STATE:2,COUNTRY:3,LOCATION:4,LATITUDE:5,LONGTITUDE:6,OTHER:7,ZIPCODE:8,COUNTY:9,AREACODE:10};var B=268435456,G=536870912,C=1073741824;var A=268435456,D=805306368,E=805306368,O=1879048192;var I=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true},{n:mstrmojo.desc(7674,"Country"),v:L.COUNTRY,geo:true},{n:mstrmojo.desc(7676,"State"),v:L.STATE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B}]},{n:mstrmojo.desc(12919,"County"),v:L.COUNTY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7675,"City"),v:L.CITY,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G}]},{n:mstrmojo.desc(7677,"Zip Code"),v:L.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),v:L.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),v:L.LONGTITUDE,geo:true},{n:mstrmojo.desc(12948,"City, State"),v:L.LOCATION,geo:true},{n:mstrmojo.desc(12973,"Area Code"),v:L.AREACODE,geo:true},{n:mstrmojo.desc(13521,"Custom"),v:L.OTHER,geo:true}];var H=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true},{n:mstrmojo.desc(7677,"Zip Code"),v:L.ZIPCODE,geo:true,items:[{n:mstrmojo.desc(7674,"Country"),did:B},{n:mstrmojo.desc(7676,"State"),did:G},{n:mstrmojo.desc(7675,"City"),did:C}]},{n:mstrmojo.desc(7696,"Latitude"),v:L.LATITUDE,geo:true},{n:mstrmojo.desc(7697,"Longtitude"),v:L.LONGTITUDE,geo:true},{n:mstrmojo.desc(12973,"Area Code"),v:L.AREACODE,geo:true}];mstrmojo.DI.DIGeoRole=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIGeoRole",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title"></div><div class="mstrmojo-qb-mapping-georole"></div><div class="mstrmojo-di-mapping-driveAttribute"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},formNode:function(){return this.domNode.firstChild.childNodes[0];},derivedAttributeNode:function(){return this.domNode.firstChild.childNodes[2];}},markupMethods:{onvisibleChange:function(){if(this.data.isSharedMultiForm){this.formNode.style.display="block";}else{this.formNode.style.display="none";}}},top:"0px",left:"0px",georole:0,shapeKeys:[],der:0,geoFormIndex:0,init:function M(U){this._super(U);this.raiseEvent({name:"shapeKeysChange"});this.raiseEvent({name:"dataChange"});this.multiFormList.attachEventListener("formChange",this.id,"updateGeoListSelection");this.geolist.attachEventListener("showDerivedAttribute",this.id,"showDerivedAttribute");},postBuildRendering:function P(){if(this._super){this._super();}this.updateGeoListSelection();},onshapeKeysChange:function J(){var Z=[];if(mstrApp.isCloud){I.splice(-1);}var Y=this.data;if(Y.isSharedMultiForm){var W=this.multiFormList.selectedIndex||this.multiFormList.idx;var U=this.data.mergeSubColumns[W];var V=U.dtp;var X;if(V===2){X=H;}else{if(V===1||V===8||V===9){X=[{n:mstrmojo.desc(2057,"None"),v:L.NONE,geo:true}];}else{X=I;}}mstrmojo.array.forEach(X,function(a){if(a.n!=="Latitude"&&a.n!=="Longitude"){Z.push(a);}});this.geolist.set("items",Z);this.geolist.refresh();}else{if(Y.dtp===2){this.geolist.set("items",H);}else{this.geolist.set("items",I);}}},ondataChange:function N(){var Y=this.data;if(Y.isSharedMultiForm){var U=Y.mergeSubColumns;var W=[];var V=0,X;mstrmojo.array.forEach(U,function(a,Z){W.push({n:a.fmn,v:Z});if(a.georole&&a.georole!==0){V=Z;}});this.multiFormList.set("items",W);this.geoFormIndex=V;X=U[this.geoFormIndex].der;this.multiFormList.set("selectedIndex",this.geoFormIndex);if(X){this.der=X;}}},updateGeoListSelection:function Q(){var W=this.data,V;if(W.isSharedMultiForm){var U=this.multiFormList.selectedIndex||0;W=this.data.mergeSubColumns[U];}V=S.find(this.geolist.items,"v",W.georole);this.geolist.set("selectedIndex",V);},_close:function(){var U=this.parent;if(U&&U._cmSource){U._cmSource.closeMenuTree();}},onOK:function(){var X,b,Y,Z;if(this.data.isSharedMultiForm){Z=this.multiFormList.selectedIndex;Y=this.data.mergeSubColumns[Z];}else{Y=this.data;}var a=this.geolist;var V=a.items[a.selectedIndex];if(V.geo){X=V.v;if(X===undefined){X=a.selected;}b={2:A,1:D,9:E,8:O}[X]||0;Y.georole=X;Y.der=this.der=this.der&b;}else{Y.georole=7;Y.shapeKey=this.geolist.selectedItem.did;}if(this.data.isSharedMultiForm){Z=this.multiFormList.selectedIndex;if(Z!==this.geoFormIndex){var d=this.data.mergeSubColumns[Z];var c=this.data.mergeSubColumns[this.geoFormIndex];if((d.georole!==L.LATITUDE)&&(d.georole!==L.LONGTITUDE)){var W,U=this.data.mergeSubColumns;for(W=0;W<U.length;W++){if(W===Z){if(U[W].fmn==="ID"){this.data.georole=U[W].georole;}continue;}this.data.mergeSubColumns[W].georole=0;}}else{if((c.georole!==L.LONGTITUDE)&&(c.georole!==L.LATITUDE)){this.data.mergeSubColumns[c].georole=0;}}}}mstrApp.getRootController().setGeoRoles(this.data);this._close();},onCancel:function(){this._close();},showDerivedAttribute:function(V){var Z=this.data;if(Z.isSharedMultiForm){var U=this.multiFormList.selectedIndex;Z=this.data.mergeSubColumns[U];}var Y=Z.der;var W=V.items;this.derivedAttrList.set("items",W);var X=[];if(Y){S.forEach(W,function(b,a){if(Y&b.did){X.push(a);}});this.derivedAttrList.addSelect(X);}this.derivedAttributeNode.style.display="block";},children:[{scriptClass:"mstrmojo.Label",slot:"formNode",alias:"title",text:mstrmojo.desc(13522,"Select Attribute Form:")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"formNode",alias:"multiFormList",idx:0,onitemSelected:function F(){this.parent.raiseEvent({name:"shapeKeysChange"});this.raiseEvent({name:"formChange",idx:this.selectedIndex});}},{scriptClass:"mstrmojo.Label",slot:"contentNode",text:mstrmojo.desc(13523,"Select Geographic Type:")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"contentNode",alias:"geolist",cssClass:"mstrmojo-qb-geolist",itemIdField:"did",cssClassItem:"",onitemSelected:function(){var U=this.items[this.selectedIndex];if(U.items){this.raiseEvent({name:"showDerivedAttribute",items:U.items});}else{this.parent.derivedAttributeNode.style.display="none";}},expandShapeKeyNode:function K(){},itemMarkupFunction:function(c,X,W){var Z=[],b=W.parent,V,Y,a,U;if(c.items){a=c.items;U="onclick=\"mstrmojo.dom.captureDomEvent('"+W.id+"','click', self, event)\"";Z.push('<div class="mstrmojo-qb-georole-attribute-box"><span>');Z.push(mstrmojo.desc(9924,"Create attributes for:"));Z.push("</span>");for(V=0,Y=a.length;V<Y;V++){Z.push('<div class="mstrmojo-qb-georole-attribute '+((b.der&a[V].did)?"selected":"")+'" did="'+a[V].did+'"'+U+'><img class="mstrmojo-qb-georole-checkbox" src="../images/1ptrans.gif"><span style="padding-left:5px;">');Z.push(a[V].n);Z.push("</span></div>");}Z.push("</div>");}return'<div class="mstrmojo-qb-georole '+((c.did===L.OTHER)?"other":"")+(c.geo?"":"shapeKey ")+W.cssClassItem+'" idx="'+X+'" did="'+c.did+'"><div class="mstrmojo-qb-georole-itemtext"><img class="mstrmojo-qb-georole-img" src="../images/1ptrans.gif"><span class="mstrmojo-qb-georole-text">'+c.n+'</span></div><div class="mstrmojo-qb-georole-itemcontent">'+Z.join("")+"</div></div>";}},{scriptClass:"mstrmojo.Label",slot:"derivedAttributeNode",alias:"derivedAttrTitle",text:mstrmojo.desc(13524,"(Optional) Create Additional Attributes:")},{scriptClass:"mstrmojo.ui.CheckList",slot:"derivedAttributeNode",alias:"derivedAttrList",onchange:function(V){var U=V.removed&&V.removed.length>0?V.removed:V.added;var Z=this.items[U[0]];var X=Z.did;var Y,W,a;a=[];W=(this.parent.der&X)?R.removeClass:R.addClass;for(Y=0;Y<a.length;Y++){W(a[Y],"selected");}if(V.added&&V.added.length>0){this.parent.der=this.parent.der|X;}else{this.parent.der=this.parent.der^X;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.HTMLButton","mstrmojo.Button","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.CheckBox","mstrmojo.HBox","mstrmojo.Label","mstrmojo.MenuButton","mstrmojo.Table","mstrmojo.string","mstrmojo.DI.DIConstants");var G=mstrmojo.array,L=mstrmojo.DI.DIConstants;var F=[{n:"(GMT-12:00)International Date Line West",v:"-12_0"},{n:"(GMT-11:00)Midway Island, Samoa",v:"-11_0"},{n:"(GMT-10:00)Hawaii",v:"-10_0"},{n:"(GMT-09:00)Alaska",v:"-9_1"},{n:"(GMT-08:00)Pacific Time (US & Canada)",v:"-8_1"},{n:"(GMT-07:00)Arizona",v:"-7_0"},{n:"(GMT-07:00)Mountain Time (US & Canada)",v:"-7_1"},{n:"(GMT-06:00)Central America, Saskatchewan",v:"-6_0"},{n:"(GMT-06:00)Central Time (US & Canada), Guadalajara, Mexico city",v:"-6_1"},{n:"(GMT-05:00)Indiana, Bogota, Lima, Quito, Rio Branco",v:"-5_0"},{n:"(GMT-05:00)Eastern time (US & Canada)",v:"-5_1"},{n:"(GMT-04:00)Caracas, La Paz",v:"-4_0"},{n:"(GMT-04:00)Atlantic time (Canada), Manaus, Santiago",v:"-4_1"},{n:"(GMT-03:00)Buenos Aires, Georgetown",v:"-3_0"},{n:"(GMT-03:00)Greenland, Brasilia, Montevideo",v:"-3_1"},{n:"(GMT-02:00)Mid-Atlantic",v:"-2_1"},{n:"(GMT-01:00)Azores, Cape Verde Is.",v:"-1_1"},{n:"(GMT 00:00)Casablanca, Monrovia, Reykjavik",v:"0_0"},{n:"(GMT 00:00)GMT: Dublin, Edinburgh, Lisbon, London",v:"0_1"},{n:"(GMT+01:00)West Central Africa",v:"1_0"},{n:"(GMT+01:00)Amsterdam, Berlin, Rome, Vienna, Prague, Brussels",v:"1_1"},{n:"(GMT+02:00)Harare, Pretoria",v:"2_0"},{n:"(GMT+02:00)Amman, Athens, Istanbul, Beirut, Cairo, Jerusalem",v:"2_1"},{n:"(GMT+03:00)Kuwait, Riyadh, Nairobi, Tbilisi",v:"3_0"},{n:"(GMT+03:00)Baghdad, Moscow, St. Petersburg, Volgograd",v:"3_1"},{n:"(GMT+04:00)Abu Dhadi, Muscat",v:"4_0"},{n:"(GMT+04:00)Baku, Yerevan",v:"4_1"},{n:"(GMT+05:00)Islamabad, Karachi, Tashkent",v:"5_0"},{n:"(GMT+05:00)Ekaterinburg",v:"5_1"},{n:"(GMT+06:00)Astana, Dhaka",v:"6_0"},{n:"(GMT+06:00)Almaty, Nonosibirsk",v:"6_1"},{n:"(GMT+07:00)Bangkok, Hanoi, Jakarta",v:"7_0"},{n:"(GMT+07:00)Krasnoyarsk",v:"7_1"},{n:"(GMT+08:00)Beijing, Hong Kong, Singapore, Taipei",v:"8_0"},{n:"(GMT+08:00)Irkutsk, Ulaan Bataar, Perth",v:"8_1"},{n:"(GMT+09:00)Seoul, Osaka, Sapporo, Tokyo",v:"9_0"},{n:"(GMT+09:00)Yakutsk",v:"9_1"},{n:"(GMT+10:00)Brisbane, Guam, Port Moresby",v:"10_0"},{n:"(GMT+10:00)Canberra, Melbourne, Sydney, Hobart, Vladivostok",v:"10_1"},{n:"(GMT+11:00)Magadan, Solomon Is., New Caledonia",v:"11_0"},{n:"(GMT+12:00)Fiji, Kamchatka, Marshall Is.",v:"12_0"},{n:"(GMT+12:00)Auckland, Wellington",v:"12_1"},{n:"(GMT+13:00)Nuku'alofa",v:"13_0"}];var H=[mstrmojo.desc(9380),mstrmojo.desc(9381),mstrmojo.desc(9382),mstrmojo.desc(9383),mstrmojo.desc(9384),mstrmojo.desc(9385),mstrmojo.desc(9379)];function M(){var P=new Date(),O=new Date(P.getFullYear(),0,1,0,0,0,0),V=new Date(P.getFullYear(),6,1,0,0,0,0),W=O.toGMTString(),X=new Date(W.substring(0,W.lastIndexOf(" ")-1));W=V.toGMTString();var U=new Date(W.substring(0,W.lastIndexOf(" ")-1)),R=(O-X)/(1000*60*60),Q=(V-U)/(1000*60*60),S=(R==Q)?"0":"1";if(R-Q>=0){R=Q;}return R+"_"+S;}function A(S,X,Q,R){var O=mstrmojo.desc(10155)+' <span class="mstrmojo-SREditor-timeHilight">',U=function(a,b){var Z=parseInt(a),Y=0;if(a=="12:00AM"){Z=0;}else{if(a=="12:00PM"){Z=12;}else{if(a.contains("PM")){Z+=12;}}}Z+=parseInt(b);if(Z>36){a=(Z-36)+":00PM";Y=1;}else{if(Z==36){a="12:00PM";Y=1;}else{if(Z>24&&Z<36){a=(Z-24)+":00AM";Y=1;}else{if(Z==24){a="12:00AM";Y=1;}else{if(Z>12&&Z<24){a=(Z-12)+":00PM";}else{if(Z==12){a="12:00PM";}else{if(Z>0&&Z<12){a=Z+":00AM";}else{if(Z==0){a="12:00AM";}else{if(Z>-12&&Z<0){a=(12+Z)+":00PM";Y=-1;}else{if(Z==-12){a="12:00PM";Y=-1;}else{if(Z>-24&&Z<-12){a=(-12-Z)+":00AM";Y=-1;}}}}}}}}}}}return{t:a,dd:Y};},V=U(Q,R);switch(X){case"Daily":O+=mstrmojo.desc(9386,"every day");break;case"Weekday":O+=mstrmojo.desc(9387,"every weekday");break;case"Weekly":O+=mstrmojo.desc(10156)+" "+H[(S.schedules.wday.selectedItem.v+V.dd+7)%7];break;case"Monthly":var W=parseInt(S.schedules.mday.selectedItem.v)+V.dd,P={"0":"last","1":"1st","2":"2nd","14":"14th","15":"15th","16":"16th"}[W];O+=mstrmojo.desc(9688)+" "+P+" "+mstrmojo.desc(10157);break;}if(R>0){R="+"+R;}R+=":00";O+=" at "+V.t+"</span> "+mstrmojo.desc(10158)+":";return O;}var I=M(),B=L.timeOfDay,E=L.weekDay,K=L.dateMon,N=L.schedule;function D(P,O){return{slot:P,scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-SREditor-tzPrev",bindings:{visible:function(){var Q=this.parent.parent.stp;return Q==O;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"preview-text",bindings:{text:function(){var V=this.parent.parent.parent,Q=this.parent.parent.parent.stp,U=this.parent.parent.parent.time,R=this.parent.parent.parent.day,S=this.parent.parent.parent.date,W=this.parent.parent.parent.rrtz||mstrApp.rrtz||I;return A(V,Q,U,parseInt(W));}}},{alias:"timezone",scriptClass:"mstrmojo.Pulldown",popupCssClass:"timezone-pulldown",items:null,itemIdField:"v",bindings:{value:function(){return this.parent.parent.parent.rrtz||mstrApp.rrtz||I;}},onvalueChange:function(){this.parent.parent.parent.set("rrtz",this.value);},onRender:function(){var Q=this.value;this.set("items",F);this.set("value",Q);}}]};}function J(O){return mstrmojo.array.filter(O,function(P){return P.isSubscribable;});}function C(){var P={scheduleType:"width:143px",pulldown:"width:123px;"},O={scheduleType:"width:166px",pulldown:"width:156px;"};return mstrApp.isWorkstation?O:P;}mstrmojo.SREditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SREditor",cssClass:"rrEditor rrEditor-defaultTitleSpacer mstrmojo-SREditor",cssText:"position:absolute;",zIndex:10,title:mstrmojo.desc(10160),cubeID:"",stp:"",day:"",date:"",time:"1:00AM",trgNm:null,showNote:true,subsID:null,obj:null,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11245,"Please note that only <# of # dataset> can be scheduled."),cssClass:"rrEditor-cubeType",alias:"sWarning",visible:false,cubes:[],setScheduleWarningText:function(){if(this.parent.obj===null){return ;}this.set("visible",false);var S=this,R=S.parent.obj,Q=R.ds,P=function(){var V=J(Q);if(V.length!==Q.length){var U=mstrmojo.desc(11245,"Please note that only <# of # dataset> can be scheduled.");U=U.replace("#",V.length).replace("#",Q.length);U=U.replace(">","</a>");U=U.replace("<",'<a href="#" onclick="return false;" style="font-weight: bold;">');S.set("text",U);S.set("visible",true);}};if(Q===undefined||Q.length===0){var O={success:function(U){R.ds=transDatasets(U.ds);Q=R.ds;P();},failure:function(U){rrAlert(U.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrmojo.xhr.request("POST",mstrApp.taskURL,O,{taskId:"getDashboardRefreshHistory",docID:R.did,recentN:5});}else{P();}},onclick:function(S){if(S.e.target.tagName==="A"){var O=this.parent.obj.ds,R="datasetDetail",P=mstrmojo.all,Q=P[R];if(Q){Q.set("datasets",O);}else{Q=new mstrmojo.RRDatasetDetail({datasets:O});}Q.open();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SREditor-header",bindings:{text:"this.parent.headerText"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SREditor-note",text:mstrmojo.desc(11373,"NOTE: All schedules are defined in <Greenwich Mean Time (GMT)>. Once you select a schedule, a preview box displays the equivalent time in your local time zone.").replace(/<(.*?)>/,'<span class="mstrmojo-SREditor-timeHilight">$1</span>'),bindings:{visible:"this.parent.showNote"}},{alias:"schedules",scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-SREditor-scheduleTable",layout:[{cells:[{cssClass:"schedule-type"},{colSpan:2}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{colSpan:2}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{bindings:{cssText:function(){return C().scheduleType;}}},{}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{cssClass:"schedule-type"},{bindings:{cssText:function(){return C().scheduleType;}}},{}],cssClass:"mstrmojo-SREditor-rowSpace"},{cells:[{colSpan:3}]},{cells:[{colSpan:3}]}],children:[{alias:"daily",slot:"0,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(10639,"Daily"),tp:N.DAILY,bindings:{checked:function(){var O=this.parent.parent.stp,P=this.tp;return O==P;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"dtime",slot:"0,1",scriptClass:"mstrmojo.ui.Pulldown",hostedCSSClass:"hour-pulldown",popupCssClass:"hour-pulldown",items:B,bindings:{visible:function(){return this.parent.daily.checked;},cssText:function(){return C().pulldown;}},preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.time);if(O>=0){this.set("selectedIndex",O);}},itemIdField:"v",postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("time",P.v);}},D("1,0",N.DAILY),{alias:"weekday",slot:"2,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(10159,"Weekday"),tp:N.WEEKDAY,bindings:{checked:function(){var O=this.parent.parent.stp,P=this.tp;return O==P;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"wdtime",slot:"2,1",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",items:B,bindings:{visible:function(){return this.parent.weekday.checked;},cssText:function(){return C().pulldown;}},preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.time);if(O>=0){this.set("selectedIndex",O);}},itemIdField:"v",postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("time",P.v);}},D("3,0",N.WEEKDAY),{alias:"weekly",slot:"4,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(9705,"Weekly"),tp:N.WEEKLY,bindings:{checked:function(){var O=this.parent.parent.stp,P=this.tp;return O==P;}},oncheckedChange:function(){if(this.checked){this.parent.parent.set("stp",this.tp);}}},{alias:"wday",slot:"4,1",scriptClass:"mstrmojo.ui.Pulldown",items:E,bindings:{visible:"this.parent.weekly.checked",cssText:function(){return C().pulldown;}},preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.day);if(O>=0){this.set("selectedIndex",O);}},itemIdField:"v",postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("day",P.v);}},{alias:"wtime",slot:"4,2",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",items:B,bindings:{visible:"this.parent.weekly.checked",cssText:function(){return C().pulldown;}},preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.time);if(O>=0){this.set("selectedIndex",O);}},itemIdField:"v",postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("time",P.v);}},D("5,0",N.WEEKLY),{alias:"monthly",slot:"6,0",scriptClass:"mstrmojo.RadioButton",cssClass:"mstrmojo-SREditor-radio",label:mstrmojo.desc(9704,"Monthly"),tp:N.MONTHLY,bindings:{checked:function(){var O=this.parent.parent.stp,P=this.tp;return O==P;}},oncheckedChange:function(){if(this.checked){if(this.domNode){this.parent.parent.set("stp",this.tp);}}}},{alias:"mday",slot:"6,1",scriptClass:"mstrmojo.ui.Pulldown",items:K,bindings:{visible:"this.parent.monthly.checked",cssText:function(){return C().pulldown;}},itemIdField:"v",preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.date);if(O>=0){this.set("selectedIndex",O);}},postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("date",P.v);}},{alias:"mtime",slot:"6,2",scriptClass:"mstrmojo.ui.Pulldown",popupCssClass:"hour-pulldown",items:B,visible:false,bindings:{visible:"this.parent.monthly.checked",cssText:function(){return C().pulldown;}},itemIdField:"v",preBuildRendering:function(){var O=G.find(this.items,this.itemIdField,this.parent.parent.time);if(O>=0){this.set("selectedIndex",O);}},postselectedIndexChange:function(O){var P=this.items[O.value];this.parent.parent.set("time",P.v);}},D("7,0",N.MONTHLY),{alias:"daylightLabel",slot:"8,0",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DayLightLabel",text:mstrmojo.desc(10163),bindings:{visible:function(){var O=this.parent.parent.stp;return O===N.DAILY||O===N.WEEKDAY||O===N.WEEKLY||O===N.MONTHLY;},}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton ok hot",text:mstrmojo.desc(1442,"OK"),bindings:{enabled:"this.parent.parent.stp"},onclick:function(O){var P=this.parent.parent.rrtz;if(P&&(P!=mstrApp.rrtz)){if(typeof rrCreateCookie==="function"){rrCreateCookie("rrtz",P);}mstrApp.rrtz=P;}this.parent.parent.onOK();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(O){var P=this.parent.parent;if(P.onCancel){P.onCancel();}P.close();}}]}],onOpen:function(){this.sWarning.setScheduleWarningText();var P=this.trgNm&&mstrmojo.string.trim(this.trgNm.toUpperCase()).split(" ");if(P&&P.length>=2){switch(P[0]){case"DAILY":this.set("stp",N.DAILY);this.set("time",P[1]);break;case"WEEKDAY":this.set("stp",N.WEEKDAY);this.set("time",P[1]);break;case"WEEKLY":var O=function(S){var Q=0,R=H.length;for(;Q<R;Q++){if(H[Q].toUpperCase()==S){break;}}return Q;};this.set("stp",N.WEEKLY);this.set("day",O(P[1]));this.set("time",P[2]);break;case"MONTHLY":this.set("stp",N.MONTHLY);this.set("date",P[1]);this.set("time",P[2]);break;default:rrAlert(mstrmojo.desc(10164));this.close();}}},onOK:function(){var S=this,R=S.obj,Q=R.ds,U={taskId:"saveRefreshSchedule",triggerName:this.getTrgName()};var V=function(Z,Y,X){var W=[];mstrmojo.array.forEach(Z,function(a){W.push(a[Y]);});return W.join(X);};var P=function(){waitCurtain.open();mstrmojo.xhr.request("POST",mstrApp.taskURL,{success:function(W){S.obj.set("af",W.subs);S.close();},failure:function(W){S.close();if(W.getResponseHeader("X-MSTR-TaskErrorCode")==="-2147050197"){rrAlert(mstrmojo.desc(11605,"In order to set a schedule for automatically refreshing this dashboard please click on the Refresh Now option under Refresh Data menu. Once you have finished refreshing all your datasets, please click on the Set Schedule option again."));}else{rrAlert(W.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){waitCurtain.close();}},U);};if(R.af&&R.af.length>0){U.subscriptionID=V(R.af,"subID",",");P();}else{if(R.ds&&R.ds.length>0){U.contentID=V(J(R.ds),"cubeID",",");P();}else{var O={success:function(W){R.ds=transDatasets(W.ds);U.contentID=V(J(R.ds),"cubeID",",");P();},failure:function(W){rrAlert(W.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrmojo.xhr.request("POST",mstrApp.taskURL,O,{taskId:"getDashboardRefreshHistory",docID:R.did,recentN:1});}}},onClose:function(){var O=new Array(),P=window.location.href;O[0]="state";O[1]="code";url=removeUrlParams(P,O);if(P!=url){window.location.href=url;}},getTrgName:function(){var O=this.schedules;switch(this.stp){case"Daily":return mstrmojo.desc(10639,"Daily")+" "+O.dtime.items[O.dtime.selectedIndex].v;case"Weekday":return mstrmojo.desc(10159,"Weekday")+" "+O.wdtime.items[O.wdtime.selectedIndex].v;case"Weekly":return mstrmojo.desc(9310,"Weekly")+" "+O.wday.items[O.wday.selectedIndex].n+" "+O.wtime.items[O.wtime.selectedIndex].v;case"Monthly":return mstrmojo.desc(9704,"Monthly")+" "+O.mday.items[O.mday.selectedIndex].v+" "+O.mtime.items[O.mtime.selectedIndex].v;default:return this.stp;}},getTrgDefinition:function(){var O=this.schedules;switch(this.stp){case"Daily":return this.stp+" "+O.dtime.selectedIndex;case"Weekday":return this.stp+" "+O.wdtime.selectedIndex;case"Weekly":return this.stp+" "+O.wday.selectedIndex+" "+O.wtime.selectedIndex;case"Monthly":return this.stp+" "+O.mday.selectedIndex+" "+O.mtime.selectedIndex;default:return this.stp;}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ui.Pulldown","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(118,221,5186,6389,12877,12878,12879,12880,12881,13783,13784,13785,13851,12706,14678,14679,14680,14689,14716);var D="rs-item";var J=mstrmojo.array,C=mstrmojo.hash,G=mstrmojo.dom,I=mstrmojo.css,L=mstrmojo.DI.DIHelpers,P=mstrmojo.Widget,O=mstrmojo.DI.DIConstants;var K=O.dataTypeMenuItems;var M=function(){var Q=this.getPopupWidget(),R;R=G.position(this.getPopupHostNode(),true);Q.popupConfig.position=R;};function H(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,useRichTooltip:true,showTooltipForLargeText:true,scrollNodeMaxHeight:this.scrollNodeMaxHeight,listHooks:{select:function Q(V,W,U){this.parent.set("selectedIndex",U);if(this.visible&&this.closeAfterSelection){this.close();}}},getItemProps:function R(W,U){var V=mstrmojo._IsList.getItemProps.call(this,W,U);V.style=this.parent.itemCssText||"";if(L.isGeo(W)){V.cls+=" geo";}else{if(L.isTime(W)){V.cls+=" time";}}return V;},suppressClose:function S(U){return mstrmojo._CanAutoClose.suppressClose.call(this,U)||G.contains(this.parent.domNode,U,true,document.body);}};}function E(W,U,V,a){var l=O.relationshipEditType;var h=O.ERType;var S=[],k=[],Z=[],Y=[],e=[];var c=[];var f,b,j,d,X;var R=U&&U.length,g=V&&V.length;var Q=function(m,n){if(m.tp===n.tp){return 0;}if(m.tp===l.remove){return -1;}if(m.tp===l.create){return n.tp===l.remove?1:-1;}if(m.tp===l.changeERType){return 1;}};if(g<R){return ;}for(f=0;f<g;f++){b=f<R?U[f]:null;j=V[f];if(j.deleted){if(b){c.push({tp:l.remove,paid:b.parent.id,atid:b.child.id,ert:h.reserved,rstp:O.RSType.reserved});}}else{if(b){if(b.parent.id===j.parent.id&&b.child.id===j.child.id){if(b.ert!==j.ert){c.push({tp:l.changeERType,paid:j.parent.id,atid:j.child.id,ert:j.ert,rstp:j.type});}else{if(b.type!==j.type){c.push({tp:l.changeERType,paid:j.parent.id,atid:j.child.id,ert:j.ert,rstp:j.type});}}}else{c.push({tp:l.remove,paid:b.parent.id,atid:b.child.id,ert:h.reserved,rstp:O.RSType.reserved});c.push({tp:l.create,paid:j.parent.id,atid:j.child.id,ert:j.ert,rstp:j.type});}}else{if(j.parent&&j.parent.id&&j.child&&j.child.id){c.push({tp:l.create,paid:j.parent.id,atid:j.child.id,ert:j.ert,rstp:j.type});}}}}c.sort(Q);d=false;J.forEach(c,function(m){if(m.paid===m.atid){d=true;X=mstrmojo.desc(13851,"Cannot define the relationship between the same attributes.");}S.push(m.tp);k.push(m.paid);Z.push(m.atid);Y.push(m.ert);e.push(m.rstp);});if(d){if(a.failure){a.failure({message:X});}if(a&&a.complete){a.complete();}return ;}if(c.length>0){mstrApp.getRootController().editRelationship([W],{tp:S.join(),paid:k.join(),atid:Z.join(),ert:Y.join(),rstp:e.join()},a);}else{if(a&&a.success){a.success();}if(a&&a.complete){a.complete();}}}function A(Q,S){var R=true;J.forEach(Q,function(W){var U,V,X;if(W){U=J.find(S,"id",W.parent.id);if(U>=0){V=S[U];}U=J.find(S,"id",W.child.id);if(U>=0){X=S[U];}if(V&&X){if(V.id===X.id){R=false;}else{if(V.ipa&&X.ipa){R=false;}}}if(!R){return false;}}});return R;}function B(R){if(R.isMultiForm){var Q;for(Q in R.subColumns){if(R.subColumns[Q].recursive){return true;}}}return false;}mstrmojo.DI.DIRelationshipItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIRelationshipItem",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-di-relationship-item cf {@cssClass}" style="{@cssText}"><div class="rsitem-toggle {@toggle}"></div><div class="rsitem-pulldown parent"></div><div class="rsitem-pulldown child"></div><div class="rsitem-pulldown type"></div><div class="rsitem-icon status{@status}" tooltip="{@tooltip}"></div><div class="rsitem-button"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},toggleButtonNode:function(){return this.domNode.children[0];},parentPulldownNode:function(){return this.domNode.children[1];},childPulldownNode:function(){return this.domNode.children[2];},typePulldownNode:function(){return this.domNode.children[3];},buttonNode:function(){return this.domNode.children[5];}},markupMethods:{onvisibleChange:P.visibleMarkupMethod,onheightChange:P.heightMarkupMethod,onwidthChange:P.widthMarkupMethod,onstatusChange:function(){var Q=this.domNode.lastChild.previousSibling;Q.className="rsitem-icon status"+this.status;},ontooltipChange:function(){var Q=this.domNode.lastChild.previousSibling;Q.setAttribute("tooltip",this.tooltip);}},onstatusChange:function(){var Q=this.data;Q.status=this.status;},ontooltipChange:function(){var Q=this.data;Q.tooltip=this.tooltip;},ontypeChange:function(R){var S=this.toggleButtonNode,Q=R.value===O.RSType.defined;if(this.hasRendered&&S){I.toggleClass(S,"toggle",Q);if(G.isIE9||G.isIE8){S.firstChild.firstChild.style.display=Q?"none":"block";}}},setRSType:function(Q){var R=this.data;if(Q!==R.type){R.type=Q;this.set("type",Q);this.parent.raiseEvent({name:"change",src:this});}},postBuildRendering:function(){var Q=this.toggle,R=this.toggleButtonNode;if(this._super){this._super();}if(Q==="toggle"&&(G.isIE9||G.isIE8)){R.firstChild.firstChild.style.display="none";}if(mstrmojo.dom.isFF){this.domNode.className+=" isFF";}},children:[{slot:"toggleButtonNode",scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:click><div class="front"></div><div class="back"></div></div>',onclick:function(){var S=this.parent.data,R=S&&S.type,Q=false;switch(R){case O.RSType.auto:S.type=O.RSType.defined;Q=true;break;case O.RSType.defined:S.type=O.RSType.auto;Q=true;break;}if(Q){this.parent.set("type",S.type);this.parent.raiseEvent({name:"change",src:this});}}},{slot:"parentPulldownNode",scriptClass:"mstrmojo.ui.Pulldown",allowHTML:false,isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted",bindings:{items:function(){var Q=this.parent.maps;J.forEach(Q,function(R){if(R.n){R.n=R.n.replace(O.workstation.filerBreakLine," ");}});return Q;}},getPopupListConfig:H,preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data&&this.parent.data.parent){this.selectItemByField("id",this.parent.data.parent.id);}},postselectedIndexChange:function(Q){var V=Q.value,S=Q.valueWas,R=this.items,U=this.parent.data;if(V!==S){if(R[V]){this.set("title",R[V].n);}U.parent.id=R[V].id;if(this.parent.hasRendered){U.type=O.RSType.defined;this.parent.set("type",U.type);this.parent.raiseEvent({name:"change",src:this});}}}},{slot:"childPulldownNode",scriptClass:"mstrmojo.ui.Pulldown",allowHTML:false,isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted",bindings:{items:"this.parent.maps"},allowHTML:false,getPopupListConfig:H,preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data&&this.parent.data.child){this.selectItemByField("id",this.parent.data.child.id);}},postselectedIndexChange:function(Q){var V=Q.value,S=Q.valueWas,R=this.items,U=this.parent.data;if(V!==S){if(R[V]){this.set("title",R[V].n);}U.child.id=R[V].id;if(this.parent.hasRendered){U.type=O.RSType.defined;this.parent.set("type",U.type);this.parent.raiseEvent({name:"change",src:this});}}}},{slot:"typePulldownNode",scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,hostedCSSClass:"mstrmojo-di-relationship-item-hosted ertype",preBuildRendering:function(){if(this._super){this._super();}if(this.parent.data){this.selectItemByField("id",this.parent.data.ert);}},postselectedIndexChange:function(Q){var V=Q.value,S=Q.valueWas,R=this.items,U=this.parent.data;if(V!==S){U.ert=R[V].id;if(this.parent.hasRendered){U.type=O.RSType.defined;this.parent.set("type",U.type);this.parent.raiseEvent({name:"change",src:this});}}},items:[{n:mstrmojo.desc(13783,"One to One"),id:O.ERType.ERType11},{n:mstrmojo.desc(13784,"One to Many"),id:O.ERType.ERType1M},{n:mstrmojo.desc(13785,"Many to Many"),id:O.ERType.ERTypeMM}]},{slot:"buttonNode",scriptClass:"mstrmojo.Button",onclick:function(){this.parent.raiseEvent({name:"delete",src:this});}}]});mstrmojo.DI.DIRelationshipDefineEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIRelationshipDefineEditor",cssClass:"mstrmojo-di-relationship-define",title:mstrmojo.desc(12706,"Define Relations"),origItems:null,help:"",items:null,onOpen:function(){var S=mstrApp.getRootController().model;var W=this.tableID;var R,V,Q;var U=S.getImportSource(W);if(!U){this.close();}if(U.currentTransformations&&U.currentTransformations.xtab&&U.currentTransformations.xtab.isCrosstab){V=U.transformedMapping;}else{V=U.currentMapping;}Q=V;V=J.filter(V,function(X){return X.tp===12&&X.selected===true&&!B(X)&&!X.recursive;});V=C.clone(V);J.forEach(V,function(X){X.n=X.alias;X.cls=X.ipa?"ipa":"";});R=C.clone(U.relationship);this.set("origItems",U.relationship);this.set("maps",V);this.set("items",R);this.helpNode.style.display="block";},onClose:function(){this.destroy();},onclick:function N(Q){if(Q.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic("Defining_relationships_between_attributes.htm");}else{window.open(mstrmojo.helpPath()+(this.help||""),"_blank");return false;}}},updateTooltipConfig:function F(){this.richTooltip.left+=4;this.richTooltip.top-=10;},ondeleteItem:function(Q){var S=Q.src;var R=this.items;var U;S.data.deleted=true;this.set("items",R);this.hasChanged=true;U=A(this.list.items,this.maps);this.btnHbox.children[0].set("enabled",U);},onchangeItem:function(R){var U=true,V,W="",Q,S,X;this.hasChanged=true;V=R&&R.src&&R.src.data;if(V){Q=J.find(this.maps,"id",V.parent.id);if(Q>=0){S=this.maps[Q];}Q=J.find(this.maps,"id",V.child.id);if(Q>=0){X=this.maps[Q];}if(S&&X){if(S.id===X.id){U=false;W=mstrmojo.desc(13851,"Cannot define the relationship between the same attributes.");}else{if(S.ipa&&X.ipa){U=false;W=mstrmojo.desc(14689,"Do not support two project attributes have relationship here.");}}}}if(!U){R.src.set("status",8002);R.src.set("tooltip",W);this.btnHbox.children[0].set("enabled",U);return ;}else{R.src.set("status","");R.src.set("tooltip","");}U=A(this.list.items,this.maps);this.btnHbox.children[0].set("enabled",U);},_set_items:function(R,Q){this.items=Q;return true;},onitemsChange:function(){var V=null,S=false,X;var R=mstrApp.getRootController().model,Q,W=this.tableID,U=R.getImportSource(W);if(U.currentTransformations&&U.currentTransformations.xtab&&U.currentTransformations.xtab.isCrosstab){Q=U.transformedMapping;}else{Q=U.currentMapping;}X=J.filter(this.items,function(Y){return !Y.deleted;});X=J.filter(X,function(Z){var a=J.find(Q,"id",Z.child.id),Y=J.find(Q,"id",Z.parent.id);return !(a>=0&&(B(Q[a])||Q[a].recursive))&&!(Y>=0&&(B(Q[Y])||Q[Y].recursive));});if(this.list.items){S=X.length>this.list.items.length;}if(this.list.domNode){V=this.list.domNode.scrollTop;}this.list.set("items",X);if((V!==null||S)&&this.list.domNode){this.list.domNode.scrollTop=S?this.list.domNode.scrollHeight:V;}},deleteAllItems:function(){var Q;J.forEach(this.items,function(R){R.deleted=true;});Q=this.items;this.set("items",Q);this.hasChanged=true;},toggleAllRSType:function(Q){var R=this.list,S=R&&R.ctxtBuilder.itemWidgets;J.forEach(S,function(U){U.setRSType(Q);});},children:[{scriptClass:"mstrmojo.Box",cssClass:"rseditor-box cf",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",iconClass:"addBtn",text:mstrmojo.desc(6389,"Add New"),onclick:function(){var R=this.parent.parent,Q=R.items;Q.push({parent:{},child:{},ert:O.ERType.ERType1M,type:O.RSType.defined});R.set("items",Q);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",iconClass:"delBtn",text:mstrmojo.desc(5186,"Delete All"),onclick:function(){this.parent.parent.deleteAllItems();}},{scriptClass:"mstrmojo.Box",cssClass:"sep"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"toggleAllPulldown",value:mstrmojo.desc(14678,"Convert All"),items:[{n:mstrmojo.desc(14679,"To user managed"),cls:"defined",id:O.RSType.defined},{n:mstrmojo.desc(14680,"To auto managed"),cls:"auto",id:O.RSType.auto}],postselectedIndexChange:function(Q){var W=this.parent.parent,Y=Q.value,U=Q.valueWas,S=this.items,R=this.value,X=this,V;this.set("value","");this.set("value",R);if(Y!==U){V=S[Y].id;W.toggleAllRSType(V);}if(Y>=0){window.setTimeout(function(){X.getPopupList().clearSelect();},0);}}}]},{scriptClass:"mstrmojo.Box",cssClass:"rseditor-header cf",children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label parent",text:mstrmojo.desc(12877,"Parent Attribute")},{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label child",text:mstrmojo.desc(12878,"Child Attribute")},{scriptClass:"mstrmojo.Label",cssClass:"rseditor-header-label relation",text:mstrmojo.desc(12879,"Relationship")}]}]},{scriptClass:"mstrmojo.WidgetList",cssClass:"rseditor-list",alias:"list",bindings:{maps:"this.parent.maps"},itemFunction:function(U,Q,V){var R={data:U,maps:V.maps,cssClass:D,idx:Q,parent:V,tooltip:U.tooltip||""};if(U.hasOwnProperty("status")){R.status=U.status;if(R.status===2){R.tooltip=mstrmojo.desc(14716,"Please modify the relationship");}}if(U.hasOwnProperty("type")){R.type=U.type;R.toggle=R.type===O.RSType.defined?"toggle":"";}var S=new mstrmojo.DI.DIRelationshipItem(R);S.attachEventListener("delete",V.parent.id,"ondeleteItem");S.attachEventListener("change",V.parent.id,"onchangeItem");return S;}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){var Q=this.parent.parent;var R={success:function(){Q.close();},failure:function(S){mstrApp.getRootController().displayError(mstrmojo.desc(12881,"Cannot save relationships."),false,S.message);}};E(Q.tableID,Q.origItems,Q.items,R);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var Q=this.parent.parent;Q.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.ui.Pulldown","mstrmojo.DI.DIDatabaseHelper","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14455,14456,14457);var E=mstrmojo.array,B=mstrmojo.hash,I=mstrmojo.DI.DIConstants,F=mstrmojo.css,D=mstrmojo.dom,C=mstrmojo.DI.DIDatabaseHelper,G=mstrmojo.DI.DIHelpers;var H={scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Item cf",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass} {@mode}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-DI-DIDBRoleAdmin-Item-Text">{@n}</div><div class="mstrmojo-DI-DIDBRoleAdmin-Item-Img"></div></div>',onmodeChange:function(J){var L=J.valueWas,K=J.value;if(this.hasRendered){F.toggleClass(this.domNode,L,false);F.toggleClass(this.coverNode,L,false);F.toggleClass(this.domNode,K,true);F.toggleClass(this.coverNode,K,true);}},onclick:function(J){var K=J.getTarget();if(this.mode==="remove"){if(this.domNode.children[1]===K){this.parent.raiseEvent({name:"selectChange",item:this});}}else{if(this.mode==="add"){if(D.contains(this.domNode,K,true)){this.parent.raiseEvent({name:"selectChange",item:this});}}}}};var A=function(){var J=this.items||[];this.destroyChildren();this.addChildren(J);};mstrmojo.DI.DIDBRoleAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIDBRoleAdmin",selectedDBRole:null,topLabel:mstrmojo.desc(14455,"Commonly used for"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),adminConfig:null,markupString:'<div id="{@id}" class="mstrmojo-DI-DIDBRoleAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIDBRoleAdmin-Label top cf"><div class="mstrmojo-DI-DIDBRoleAdmin-Label-Text">{@topLabel}</div></div><div class="mstrmojo-DI-DIDBRoleAdmin-Content top"></div><div class="mstrmojo-DI-DIDBRoleAdmin-Label bottom">{@bottomLabel}</div><div class="mstrmojo-DI-DIDBRoleAdmin-Content bottom"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},headerContainerNode:function(){return this.domNode.children[0];},topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.Box",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Box top cf",onitemsChange:function(){A.call(this);},onselectChange:function(J){this.parent.onselectChange(J);}},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIDBRoleAdmin-Box bottom cf",onitemsChange:function(){A.call(this);},onselectChange:function(J){this.parent.onselectChange(J);}}],preBuildRendering:function(){var J;if(this._super){this._super();}J=mstrApp.getRootController().getModel();if(J.supportDBObjects&&J.supportDBObjects.supportDBType){this.populateDBRoles();}else{if(mstrApp.diParams.ImportDatabase){mstrApp.showProgress();J.attachEventListener(I.srcItemTypes.DBTYPE_SOURCE,this.id,"populateDBRoles");}else{this.set("topLabel",mstrmojo.desc(14457,"You do not have the right privilege to import from databases. Contact your administrator."));this.set("bottomLabel","");this.topBox.set("visible",false);this.bottomBox.set("visible",false);}}},populateDBRoles:function(K){var N=this,M=mstrApp.getRootController().getModel(),L,J;if(K){mstrApp.hideProgress();}this.adminConfig={};L=E.filter(M.sourceItems,function(O){return O.showDBList;});L=E.map(L,function(O){return{did:O.sid,n:O.n,dbObjectsDisplayOptions:O.dbObjectsDisplayOptions,dbIdExcludeFilter:O.dbIdExcludeFilter,dbRolesAdminConfig:O.dbRolesAdminConfig};});E.forEach(L,function(Q){var O=Q.did,R,P;if(!N.adminConfig[O]){R=M.supportDBObjects&&M.supportDBObjects.supportDBType;R=C.filterDBByDispOption(R,Q.dbObjectsDisplayOptions,Q.dbIdExcludeFilter);R=E.filter(R,function(S){return G.filterDisableSources(S.dbType);});P=E.map(R,function(S){return B.copy(H,{n:S.n,dbId:S.id,dbType:S.dbType,selected:true});});if(Q.dbRolesAdminConfig){E.forEach(P,function(U){var S=E.indexOf(Q.dbRolesAdminConfig,U.dbId);if(S>=0){U.selected=false;}});}N.adminConfig[O]=P;}});if(!this.typePulldown){J=mstrmojo.ui.Pulldown.newPulldown(L,function(O,P){N.onselectSourceItemChange(O,P);},0,{alias:"typePulldown",slot:"headerContainerNode",isHostedWithin:true},true);this.addChildren([J]);this.onselectSourceItemChange(L[0]);}else{this.typePulldown.set("items",L);this.typePulldown.set("selectedIndex",this.typePulldown.selectedIndex||0);}},onselectSourceItemChange:function(K){var J,M,L;if(!K||!this.adminConfig[K.did]){return ;}J=E.map(this.adminConfig[K.did],function(N){return B.copy(N,{mode:N.selected?"remove":"add"});});M=E.filter(J,function(N){return N.selected;});L=E.filter(J,function(N){return !N.selected;});this.topBox.set("items",M);this.bottomBox.set("items",L);},onselectChange:function(K){var O=K.item,N=O.mode,M,L,J;M=this.typePulldown.getSelectedItem();if(!M){return ;}L=this.adminConfig[M.did];if(!L){return ;}J=E.find(L,"dbId",O.dbId);if(J>=0){if(N==="remove"){L[J].selected=false;}else{if(N==="add"){L[J].selected=true;}}}this.onselectSourceItemChange(M);},getAdminConfig:function(){var J=null;if(this.hasRendered&&this.adminConfig){J={};B.forEach(this.adminConfig,function(L,K){var M=E.filter(L,function(N){return N.selected!==true;});M=E.map(M,function(N){return N.dbId;});J[K]=M;});}return J;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown","mstrmojo.string");var K=mstrmojo.array,M=mstrmojo.hash,A=19,F=13,L=27;var S=mstrmojo.css,E=mstrmojo.dom,J=mstrmojo.string;mstrmojo.Refine.RefineSearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",editableSlot:"selectedNode",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-label" title="{@title}">'+mstrmojo.desc(10,"Search")+'</div><div class="mstrmojo-ui-Pulldown-text" title="{@title}" style="{@labelCssText}"></div><div class="container"></div></div>',markupSlots:{selectedNode:function R(){return this.domNode.children[1];},labelNode:function I(){return this.domNode.children[0];},containerNode:function Q(){return this.domNode.lastChild;}},allowCustomText:false,isSearching:false,editOnClick:false,init:function O(Y){this._super(Y);var V=this.getPopupList();V.renderOnScroll=this.renderOnScroll||V.renderOnScroll;V.renderBlockSize=this.renderBlockSize||V.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown mstrmojo-Refine-SearchablePulldown");var X=V.constructor.prototype,W=V.getItemProps?V.getItemProps:X.getItemProps,Z=V.getItemMarkup?V.getItemMarkup:X.getItemMarkup;V.getItemProps=function(e,a){var b=this._spft||"",f=e.n,c=f.toUpperCase().indexOf(b);if(c===-1){b="";}var d=W.call(this,e,a);d.before=f.slice(0,c);d.input=f.substring(c,c+b.length);d.after=f.slice(c+b.length,f.length);return d;};V.getItemMarkup=function(b,a){return Z.call(this,b,a).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function U(V){var Y=this.selectedNode,Z=V.getTarget(),a=V.e.offsetX>=(Y.offsetWidth-A),X=this.getPopupWidget(),W=X.visible;if(Z===Y&&(!W||(W&&a))){this.set("isEditing",!W);this.labelNode.style.display=W?"none":"block";S.toggleClass(this.labelNode,"hidden",false);this._super(V);}},onPopupWidgetClosed:function B(){this.set("isEditing",false);this.labelNode.style.display="none";var X=this.getPopupList(),Y=X._oldItems,W=this.text;delete X._oldItems;if(Y){var V=K.find(Y,"n",W);if(V===-1&&!this.allowCustomText){X.set("items",Y);return ;}X.set("items",Y);this.set("selectedIndex",V);}},_set_selectedIndex:function C(Z,W){if(this.allowCustomText&&W===-1){this.selectedIndex=-1;this.onitemSelected(null,W);}else{this.isSearching=false;this._super(Z,W);if(this.hasRendered){var Y=this.getPopupList();var X=this.selectedIndex;var V=Y.items;this.text=V[X].n;}}return true;},onkeydown:function H(W){this._super(W);var V=window.event||W.e;if(V.keyCode===F){this.getPopupList().close();}},onkeyup:function P(X){this._super(X);var V=window.event||X.e,Y=V.keyCode,W=this.getPopupList();if(Y===L||Y===F){W.close();}else{this.processSearch();}},onblur:function D(){},processSearch:function N(){this.isSearching=true;this.hideTooltip();var V=[],X=this.getPopupList(),Y=this.selectedNode.innerHTML,Z=X._oldItems||X.items,W=Y.toUpperCase();if(Y){S.toggleClass(this.labelNode,"hidden",true);}else{S.toggleClass(this.labelNode,"hidden",false);}W=W.replace(/<BR>/,"");W=W.replace(/&NBSP;/,"");W=W.replace(/\s+/g,"");if(W.length>0){K.forEach(Z,function(a){var b=a.n.toUpperCase().replace(/\s+/g,"");if(b.indexOf(W)>-1&&!a.skipSearch){V.push(M.clone(a));}},this);}else{V=Z;}X._spft=W;if(this.customizeSearchResult){this.customizeSearchResult(V);}X.set("items",V);X.adjustCornersForPopupOverflow();delete X._spft;X._oldItems=Z;X.set("visible",V.length!==0);},onisEditingChange:function G(){if(this.hasRendered){var V=this[this.editableSlot],W=!!this.isEditing;V.contentEditable=W;V.spellcheck=false;S.toggleClass(V,"editable",W);if(W){V.innerHTML="";V.focus();E.setElementSelection(V);}else{V.innerHTML=J.encodeHtmlString(this.text);V.blur();V.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(F,E){F=F.replace(/\$/g,"$$$$");if(!E){F=F.replace(/[\\"']/g,"\\$&");}return F;}function C(){var E=[],I,M,H,L,F,G,O;M=this.parent;H=M.columns;L=H.selectedIndex;if(L===undefined){return ;}F=(H.items[L]).name;G=M.transformationList;O=G.subType%10;var P,Q,K,J;switch(O){case 0:I=JSON.parse(JSON.stringify(this.operations.CutOn));Q=this.optionsBox.find.tagBox.children;P="";for(K=0;K<Q.length-1;K++){P+=mstrmojo.string.regEscape(Q[K].text);if(K!==Q.length-2){P+="|";}}J=Q[Q.length-1].input.value;if(J){if(Q.length>1){P+="|";}P+=mstrmojo.string.regEscape(J);}break;case 1:I=JSON.parse(JSON.stringify(this.operations.CutBefore));break;case 2:I=JSON.parse(JSON.stringify(this.operations.CutAfter));break;}var N=this.optionsBox.find.from.value;if((O===0&&!P)||(O!==0&&!N)){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);if(O===0){I.description=I.description.replace("####","/"+B(D(P,true))+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+D(P,true)+"/");}else{I.description=I.description.replace("####","'"+B(D(N))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(N)+"'");}I.columnName=F;I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.tagBox.removeTags();this.optionsBox.find.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlRemoveText=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlRemoveText",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.RemoveText);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"find",cssClass:"refine-controls-remove-text-box",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10===0);}}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var K=mstrmojo.array,H=mstrmojo.dom,D=mstrmojo.hash,A=mstrmojo.Enum_Keys,C=19,M=A.ENTER,E=A.ESCAPE,N=A.DOWN_ARROW,F=A.UP_ARROW;mstrmojo.ui.SearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.ui.SearchablePulldown",editableSlot:"selectedNode",allowCustomText:false,isSearching:false,editOnClick:false,init:function P(V){this._super(V);var Q=this.getPopupList();Q.renderOnScroll=this.renderOnScroll||Q.renderOnScroll;Q.renderBlockSize=this.renderBlockSize||Q.renderBlockSize;var U=[];if((mstrApp.isWorkstation&&H.isMac())||H.isSafari){U=["clip-safari"];}mstrmojo.css.addWidgetCssClass(this,["mstrmojo-ui-SearchablePulldown"].concat(U));var S=Q.constructor.prototype,R=Q.getItemProps||S.getItemProps,W=Q.getItemMarkup||S.getItemMarkup;Q.getItemProps=function(b,Y){var Z=this._spft||"",d=b.n,a=d?d.toUpperCase().indexOf(Z):-1,X=function(f){var e=[],g;K.forEach(f.split(";"),function(h){g=h.split(":");if(g.length===2&&g[0].toLowerCase()!=="color"){e.push(h);}});return e.join(";");};if(a===-1){Z="";}var c=R.call(this,b,Y);if(this.selectedIndices[Y]){c.style=X(c.style);}if(d){c.before=d.slice(0,a);c.input=d.substring(a,a+Z.length);c.after=d.slice(a+Z.length,d.length);}return c;};Q.getItemMarkup=function(Z,X){var Y=W.call(this,Z,X);if(Z.n&&Z.v!=="u;"){return Y.replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");}return Y;};this._originalFocusOnPopup=this.focusOnPopup;this.focusOnPopup=false;},onclick:function O(Q){if(this._originalFocusOnPopup!==undefined){this.focusOnPopup=false;}if(this.isClickingAnchorSlot(Q)){var S=Q.e.offsetX>=(this.selectedNode.offsetWidth-C),R=this.getPopupWidget().visible;if(!R||(R&&S)){this.set("isEditing",!R);this._super(Q);}else{if(!this.isEditing){this.set("isEditing",true);}}}},setDefaultListAndIndex:function(V,W){var U=this.getPopupList(),R=this.text,Q=K.find(V,"n",R);if(Q===-1&&!this.allowCustomText){var S=U.items[0]||V[0];Q=K.find(V,"n",S.n);}U.set("items",V);if(W){this.set("selectedIndex",Q);}},onPopupWidgetClosed:function I(Q){this.set("isEditing",false);var R=this.getPopupList(),S=R._oldItems;delete R._oldItems;if(S){this.setDefaultListAndIndex(S,Q&&Q.pressingEnter);}},_set_selectedIndex:function G(S,Q){if(this.allowCustomText&&Q===-1){this.selectedIndex=-1;this.onitemSelected(null,Q);}else{this.isSearching=false;this._super(S,Q,true);if(this.hasRendered){var R=this.selectedNode;this.text=R.innerText||R.textContent;}}return true;},onkeydown:function J(S){this._super(S);var R=window.event||S.e,U=R.keyCode,Q=this.getPopupWidget();if(U===M){Q.close({pressingEnter:true});}else{if(this._originalFocusOnPopup&&(U===N||U===F)){this.focusOnPopup=true;if(Q.focus){Q.focus();}Q.raiseEvent(S);}}},onkeyup:function B(S){var Q=window.event||S.e,U=Q.keyCode,R=this.getPopupWidget();this._super(S);if(U===E||U===M){R.close();}else{if(U!==N&&U!==F){this.processSearch();}}},processSearch:function L(){this.isSearching=true;this.hideTooltip();var Q=[],S=this.getPopupList(),V=this.selectedNode.innerHTML,W=S._oldItems||S.items,R=V.toUpperCase(),U;R=R.replace(/<BR>/,"");if(R.length>0){K.forEach(W,function(X){U=X.n;if(U&&U.toUpperCase().indexOf(R)>-1){Q.push(D.clone(X));}},this);}else{Q=W;}S._spft=R;if(this.customizeSearchResult){this.customizeSearchResult(Q);}S.set("items",Q);if(S.adjustCornersForPopupOverflow){S.adjustCornersForPopupOverflow();}delete S._spft;S._oldItems=W;S.set("visible",S.items.length!==0);}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Editor","HBox","Button","Label","TextBox","hash","dom","css","array","desc");mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.ui.Checkbox","mstrmojo.ui.Pulldown","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(959,2056,15656,15657,15658,15659,15660,15661,2397,2399);var M=mstrmojo.warehouse.EnumDatabaseType,D=mstrmojo.hash,J=mstrmojo.array,I=mstrmojo.dom,L=mstrmojo.css,F=mstrmojo.desc;var Q=[{v:"",n:F(959,"Default")},{v:"General Number",},{v:"Standard"},{v:"Currency"},{v:"Percent"},{v:"Scientific"},{v:"General Date"},{v:"Long Date"},{v:"Short Date"},{n:F(2056,"Custom")}];Q.forEach(function(R){if(R.n===undefined){R.n=R.v;}});var G={};G[M.MSAS]={min:0,max:65535,maxlength:5};G[M.EssBase]={min:0,max:126,maxlength:3};function O(U,W){var S=null,V=G[W],R=/^-?\d+$/;if(R.test(U)){U=parseInt(U);if(V&&U>=V.min&&U<=V.max||!V){S=U;}}return S;}function C(R){var S=/(\"|\-\-|\/\/|\/\*|\*\/)/;return R&&R.length&&!S.test(R);}var K={mptf:{mptso:{pru:1,v:500},mptsim:{pru:1,v:0},mptfms:""},dbt:M.MSAS,so_dft:0,sim_dft:0};function P(){return D.clone(K);}function B(R){switch(R){case"so":return this.config.mptf.mptso;case"si":return this.config.mptf.mptsim;case"fs":return this.config.mptf.mptfms;case"dbt":return this.config.dbt;case"soDefault":return this.config.so_dft;case"siDefault":return this.config.sim_dft;}}function N(){return{mptso:{pru:this.soBox.soDefaultCb.checked?1:0,v:parseInt(this.soBox.soTB.value)},mptsim:{pru:this.siBox.siDefaultCbBox.siDefaultCb.checked?1:0,v:this.siBox.siClBox.siCl.selectedIndex},mptfms:this.fsBox.fsTbBox.fsTb.value};}mstrmojo.PassThroughOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.PassThroughOptions",cssClass:"mstrmojo-PassThroughOptions",title:F(15656,"Pass-through Options"),updatePopupConfig:function H(R,U){if(R){this.onOK=R.onOK;delete R.onOK;}["left","top","width","height","zIndex"].forEach(function(V){if(R[V]!==undefined){this.set(V,R[V]);delete R[V];}}.bind(this));var S=P();D.forEach(R,function(W,V){if(W===undefined){delete R[V];}});this.config=D.copy(R,S);},onOpen:function E(){this.soBox.set("dirty",false);this.soBox.set("valid",true);this.siBox.set("dirty",false);this.fsBox.set("dirty",false);this.fsBox.set("valid",true);var U=B.call(this,"dbt")===M.EssBase,W=B.call(this,"so");L.toggleClass(this.editorNode,"ess",U);this.soBox.soDefaultCb.set("checked",W.pru);if(!W.pru){this.soBox.soTB.set("value",W.v);}else{this.soBox.soTB.set("value",B.call(this,"soDefault"));}if(!U){var S=B.call(this,"si"),R=B.call(this,"fs"),V;this.siBox.siDefaultCbBox.siDefaultCb.set("checked",S.pru);if(!S.pru){this.siBox.siClBox.siCl.select(S.v);}else{this.siBox.siClBox.siCl.select(B.call(this,"siDefault"));}V=J.find(Q,"v",R);if(V<0){V=J.find(Q,"v",undefined);}this.fsBox.fsPdBox.fsPd.set("selectedIndex",V);this.fsBox.fsTbBox.fsTb.set("value",R);}},children:[{scriptClass:"mstrmojo.Box",alias:"soBox",cssClass:"mstrmojo-PassThroughOptions-soBox",processDirty:function A(){var Y=this.parent,V=B.call(Y,"so"),X=V.pru,R=V.v,U=this.soDefaultCb.checked,S=this.soTB.value,W=X!=U||(!U&&R!=S);this.set("dirty",W);},children:[{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:F(15657,"Solve Order:")},{scriptClass:"mstrmojo.TextBox",alias:"soTB",cssClass:"mstrmojo-PassThroughOptions-soTB",cssDisplay:"inline-block",useRichTooltip:true,enabled:false,updateTooltipConfig:function(){var W=this.parent.parent,U=this.domNode,R=I.position(U),V=B.call(W,"dbt"),S=F(15658,"The value has to be between # and ##.").replace("#",G[V].min).replace("##",G[V].max);this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:S,top:R.y,left:R.x};},onvalueChange:function(){var V=this.parent.parent,U=B.call(V,"dbt"),S=O(this.value,U),R=(S!=null);this.set("textValid",R);if(!R){this.showTooltip();}else{this.hideTooltip();}this.parent.set("valid",R);this.parent.processDirty();}},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssClass:"right",text:F(959,"Default")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"soDefaultCb",cssDisplay:"inline-block",cssClass:"right",checked:true,oncheckedChange:function(R){var V=this.parent.parent,S=this.parent.soTB,U=this.checked;S.set("enabled",!U);if(U){S.set("value",B.call(V,"soDefault"));}this.parent.processDirty();}}]},{scriptClass:"mstrmojo.Box",alias:"siBox",cssClass:"mstrmojo-PassThroughOptions-siBox",processDirty:function A(){var Y=this.parent,X=B.call(Y,"si"),W=X.pru,R=X.v,U=this.siDefaultCbBox.siDefaultCb.checked,S=this.siClBox.siCl.selectedIndex,V=W!=U||(!U&&R!=S);this.set("dirty",V);},children:[{scriptClass:"mstrmojo.HBox",alias:"siDefaultCbBox",cssClass:"mstrmojo-PassThroughOptions-siDefaultCbBox",children:[{scriptClass:"mstrmojo.Label",text:F(15659,"Scope Isolation:")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"siDefaultCb",checked:true,oncheckedChange:function(R){var S=this.parent.parent,V=S.parent,U=S.siClBox.siCl;U.set("enabled",!this.checked);if(this.checked){U.select(B.call(V,"siDefault"));}S.processDirty();}},{scriptClass:"mstrmojo.Label",text:F(959,"Default")}]},{scriptClass:"mstrmojo.HBox",alias:"siClBox",cssClass:"mstrmojo-PassThroughOptions-siClBox",children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"siCl",multiSelect:false,orientation:"h",selectedIndex:1,items:[{n:"NONE",v:0},{n:"CUBE",v:1}],onchange:function(R){this.parent.parent.processDirty();}}]}]},{scriptClass:"mstrmojo.Box",alias:"fsBox",cssClass:"mstrmojo-PassThroughOptions-fsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fsPdBox",cssClass:"mstrmojo-PassThroughOptions-fsPdBox",children:[{scriptClass:"mstrmojo.Label",text:F(15660,"Format String:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"fsPd",selectedIndex:0,items:Q,onselectedIndexChange:function(){var S=this.getSelectedItem(),R=S&&S.v===undefined,U=this.parent.parent.fsTbBox.fsTb;U.set("visible",R);if(R){U.set("value","");}else{U.set("value",S&&S.v);}}}]},{scriptClass:"mstrmojo.HBox",alias:"fsTbBox",cssClass:"mstrmojo-PassThroughOptions-fsTbBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fsTb",updateTooltipConfig:function(){var U=this.domNode,R=I.position(U),S=F(15661,'Custom Format String should not be empty or contain ",//, --, /*, */.');this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:S,top:R.y,left:R.x};},onvalueChange:function(){var R=this.parent.parent;R.processDirty();},bindings:{textValid:function(){var R=this.parent.parent.fsPdBox.fsPd.selectedIndex,U=this.parent.parent,W=U.fsPdBox.fsPd.getSelectedItem(),S=W&&W.v===undefined,V=!S||C(this.value);U.set("valid",V);if(!V){this.showTooltip();}else{this.hideTooltip();}return V;}}}]}],processDirty:function(){var S=this.fsTbBox.fsTb.value,R=B.call(this.parent,"fs");this.set("dirty",S!==R);}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:F(2397,"OK"),bindings:{enabled:function(){var U=this.parent.parent.soBox.dirty,S=this.parent.parent.siBox.dirty,W=this.parent.parent.fsBox.dirty,V=this.parent.parent.soBox.valid,R=this.parent.parent.fsBox.valid;return(U||S||W)&&(V&&R);}},onclick:function(){if(this.enabled){var R=this.parent.parent;if(R.onOK){R.onOK(N.call(R));}R.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:F(2399,"Cancel"),onclick:function(){var R=this.parent.parent;R.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineTagBox","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,686,13059,13060,12359,12360,134,14290,14291);var A=mstrmojo.Refine.RefineConstants;function B(){var C=[],H,M,G,K,D,F,N;var E,Q;M=this.parent;K=M.columns.selectedIndex;F=M.transformationList;G=M.columns;N=F.subType%10;if(K===undefined&&!F.noColumn){return ;}if(!F.noColumn){D=(G.items[K]).name;}switch(N){case 0:H=JSON.parse(JSON.stringify(this.operations.Colomn));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 1:var L=this.optionsBox.rows.type.selectedIndex;var O=this.optionsBox.rows.text.value;var P,J,I;switch(L){case 0:H=JSON.parse(JSON.stringify(this.operations.RowsContains));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I);}break;case 1:H=JSON.parse(JSON.stringify(this.operations.RowsBegins));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+="^"+mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+="^"+mstrmojo.string.regEscape(I);}break;case 2:H=JSON.parse(JSON.stringify(this.operations.RowsEnds));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text)+"$";if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I)+"$";}break;case 3:H=JSON.parse(JSON.stringify(this.operations.RowsBlank));break;case 4:H=JSON.parse(JSON.stringify(this.operations.RowsEquals));break;case 5:H=JSON.parse(JSON.stringify(this.operations.RowsNotEquals));break;}if(L!==3&&!O){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(L===0||L===1||L===2){H.engineConfig.facets[0].query=H.engineConfig.facets[0].query.replace("[text]",O);H.description=H.description.replace("####","/"+O+"/");}else{if(L===4||L===5){H.engineConfig.facets[0].selection[0].v.v=O;H.engineConfig.facets[0].selection[0].v.l=O;H.description=H.description.replace("####","'"+O+"'");}}H.engineConfig.facets[0].name=H.engineConfig.facets[0].columnName=D;H.description=H.description.replace("[column name]",D);break;case 2:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateCells));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 3:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateRows));break;case 4:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;case 5:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsNotInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;}if(N===1||N===2||N===3){H.engineConfig.facets=H.engineConfig.facets.concat(JSON.parse(this.controller.model.engine).facets);}C.push(H);this.controller.applyOperations({operations:JSON.stringify(C),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.rows.text.set("value","");this.optionsBox.rows.tagBox.removeTags();this.optionsBox.rows.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlDelete=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlDelete",markupString:'<div class="refine-controls delete"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===20||this.subType===22||this.subType===23||this.subType===24||this.subType===25){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Delete);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Delete)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"rows",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends With")},{n:mstrmojo.desc(12360,"Is Empty")},{n:mstrmojo.desc(14290,"Equals To")},{n:mstrmojo.desc(14291,"Not Equals To")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===3){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",false);}else{if(this.selectedIndex===0||this.selectedIndex===1||this.selectedIndex===2){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",true);}else{this.parent.text.set("visible",true);this.parent.tagBox.set("visible",false);}}}},{scriptClass:"mstrmojo.TextBox",alias:"text"},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox"}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{slot:"optionsNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Refine.RefineHelpers","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(13574,134,3434,1013,2052,14533);var A=mstrmojo.Refine.RefineConstants,C=mstrmojo.Refine.RefineHelpers;function B(F){F=F.replace(/\n/g,"\\n");F=F.replace(/\t/g,"\\t");return F;}function E(F){return F.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function D(){var F=[],J,M,I,K,G,H,N,L;M=this.parent;I=M.columns;K=I.selectedIndex;L=I.items[I.selectedIndex].cellIndex;if(K===undefined){return ;}G=(I.items[K]).name;H=M.transformationList;N=H.subType%10;switch(N){case 0:J=JSON.parse(JSON.stringify(this.operations.titlecase));break;case 1:J=JSON.parse(JSON.stringify(this.operations.uppercase));break;case 2:J=JSON.parse(JSON.stringify(this.operations.lowercase));break;case 3:J=JSON.parse(JSON.stringify(this.operations.unescape));break;case 4:switch(this.optionsBox.datatype.type.selectedIndex){case 0:J=JSON.parse(JSON.stringify(this.operations.number));break;case 1:J=JSON.parse(JSON.stringify(this.operations.text));var O=this.parentBox.controller.model.data.rows[0].cells[L];if(!!O&&O.t){if(O.v.indexOf("T")!==-1){J.expression="toString(value, 'yyyy-MM-dd HH:mm:ss')";}else{J.expression="toString(value, 'yyyy-MM-dd')";}}break;case 2:if(!this.optionsBox.datatype.format.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}J=JSON.parse(JSON.stringify(this.operations.date));J.description=J.description.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");J.expression=J.expression.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");break;}break;case 5:J=JSON.parse(JSON.stringify(this.operations.fillDown));break;case 6:J=JSON.parse(JSON.stringify(this.operations.blankDown));break;case 7:J=JSON.parse(JSON.stringify(this.operations.padBefore));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;case 8:J=JSON.parse(JSON.stringify(this.operations.padAfter));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;}J.columnName=G;J.description=J.description.replace("[column name]",G);J.engineConfig=JSON.parse(this.controller.model.engine);F.push(J);this.controller.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.datatype.format.set("value","");this.optionsBox.padString.set("value","");}mstrmojo.Refine.RefineControlTransformCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlTransformCell",markupString:'<div id="{@id}" class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===10||this.subType===11||this.subType===12||this.subType===13||this.subType===15||this.subType===16){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.TransformCell);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.TransformCell)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"datatype",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(3434,"Number")},{n:mstrmojo.desc(1013,"Text")},{n:mstrmojo.desc(2052,"Date")}],selectedIndex:0},{scriptClass:"mstrmojo.TextBox",alias:"format",visible:false,cssClass:"Date",emptyText:mstrmojo.desc(14533,"Input Date Format"),bindings:{visible:function(){return(this.parent.type.selectedIndex===2);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-help",title:mstrmojo.desc(1143,"Help"),onclick:function(){var F="Valid_date_and_time_forms_for_wrangling_your_data.htm";mstrApp.showHelpTopic(F);},bindings:{visible:function(){return(this.parent.type.selectedIndex===2)&&(!mstrApp.isWorkstation);}}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"padString",bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){var H=this.parent.parent,G=H.controller.model,I=H.subType,F=A.transformationSubType;if((I===F.FillDown||I===F.BlankDown)&&G.hasAddSample()){C.confirmFilldownOrBlankdown(function(){D.call(H);});}else{D.call(H);}},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4||this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.Editor","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.Button","mstrmojo.Label","mstrmojo.DynamicClassFactory","mstrmojo.ui.Pulldown");var E=mstrmojo.array,D=mstrmojo.DynamicClassFactory.newComponent;mstrmojo.architect.ui.SimpleList=D(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.architect.ui.SimpleList"});function C(){var F=this.secondaryList,G=this.primaryDBRole;this.close();this.onSubmit({did:this.dataSources.did,primaryId:G.id,primaryName:G.n,secondary:F.getSelectedItems()});}mstrmojo.architect.ui.editors.DataSourceEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.architect.ui.editors.DataSourceEditor",cssClass:"mstrmojo-ar-DataSourceEditor",title:mstrmojo.desc(4381,"Data Sources"),help:null,primaryPulldown:undefined,secondaryList:undefined,onSubmit:mstrmojo.emptyFn,onOpen:function A(){var F=this.dataSources.dbRoles;this.primaryPulldown.set("items",F);this.primaryPulldown.set("selectedIndex",E.find(F,"id",this.dataSources.primaryId));},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11387,"Primary Data Source")+":"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"primaryPulldown",onitemSelected:function B(L,I){var H=this.items.concat(),K=this.parent,G=K.secondaryList;H.splice(I,1);G.clearSelect(true);G.set("visible",H.length!==0);G.set("items",H);var J={};E.forEach(H,function F(N,M){J[M]=true;});G.set("selectedIndices",J);K.primaryDBRole=L;}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11389,"Secondary Data Source(s):")},{scriptClass:"mstrmojo.architect.ui.SimpleList",cssClass:"mstrmojo-ar-SecondaryDBRoles",multiSelect:true,selectionPolicty:"reselect",alias:"secondaryList"},{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),slot:"buttonNode",onclick:function(){C.call(this.parent);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,9305,3124,12359,686,13059,13060,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var E=[],I,K,H,J,F,G,N;K=this.parent;H=K.columns;J=H.selectedIndex;if(J===undefined){return ;}F=(H.items[J]).name;G=K.transformationList;N=G.subType%10;switch(N){case 0:I=JSON.parse(JSON.stringify(this.operations.CharInCell));break;case 1:if(this.optionsBox.type.selectedIndex===0){I=JSON.parse(JSON.stringify(this.operations.CellContains));}else{if(this.optionsBox.type.selectedIndex===1){I=JSON.parse(JSON.stringify(this.operations.CellBeginsWith));}else{I=JSON.parse(JSON.stringify(this.operations.CellEndsWith));}}break;}var M=this.optionsBox.find.from.value;var L=this.optionsBox.find.to.value;if(!M||!L){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);I.description=I.description.replace("####","'"+B(D(M))+"'");I.description=I.description.replace("@@@@","'"+B(D(L))+"'");I.columnName=F;I.expression=I.expression.replace("[from]","'"+D(M)+"'");I.expression=I.expression.replace("[to]","'"+D(L)+"'");I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.to.set("value","");}mstrmojo.Refine.RefineControlFindAndReplace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFindAndReplace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.FindAndReplace);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends with")}],selectedIndex:0,bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.HBox",alias:"find",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",emptyText:mstrmojo.desc(9305,"From")},{scriptClass:"mstrmojo.TextBox",alias:"to",emptyText:mstrmojo.desc(3124,"To")}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown");var F=mstrmojo.array;mstrmojo.warehouse.dbroles.DBRoleSettingPulldown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown",postBuildRendering:function A(){if(this._super){this._super();}this.captionlbl.set("text",this.caption);this.list.set("itemIdField",this.itemIdField);this.list.set("itemField",this.itemField);this.onenabledChange();if(typeof this.allowHTML==="boolean"){this.list.set("allowHTML",this.allowHTML);}},caption:"",contains:function C(M){var L=mstrmojo.array.find(this.items,this.itemIdField,M);return(L>0);},itemIdField:"",itemField:"n",items:null,onitemsChange:function K(){this.list.set("items",this.items);},selectedID:null,onselectedIDChange:function E(){var L=Math.max(F.find(this.items,this.itemIdField,this.selectedID),0);if(this.items&&this.items[L]){this.list.set("selectedIndex",L);this.selectedItem=this.items[L];this.selectedID=this.selectedItem.id;}},selectedItem:undefined,enabled:true,onenabledChange:function G(){this.captionlbl.set("enabled",this.enabled);this.list.set("enabled",this.enabled);},getValue:function D(){var L=this.selectedItem||this.items[0];if(L){return L.v;}return"";},setValue:function B(L){this.set("selectedID",L);},isValid:function J(){return{val:true,msg:""};},onChange:mstrmojo.emptyFn,captionlbl:undefined,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",alias:"captionlbl"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"list",scrollNodeMaxHeight:350,isHostedWithin:false,onitemSelected:function H(O,M){var N=this.parent,L=(N.selectedItem?N.selectedItem.id:"");if(O[this.itemIdField]!==L){N.set("selectedItem",O);if(N.onChange){N.onChange(O,M);}}},onitemsChange:function I(){var L=this.parent;L.selectedID=null;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134,12361,13574,14178,14179,12348);var C=mstrmojo.Refine.RefineConstants;var D=mstrmojo.DI.DIConstants;var A=mstrmojo.css;function G(){var X=1,W,I,a=[],P,O,J,M,K,c,R,b,Y,d;O=this.parent;J=O.columns;M=J.selectedIndex;d=J.items[J.selectedIndex].columnIndex;if(M===undefined){return ;}K=(J.items[M]).name;c=O.transformationList;R=c.subType%10;if(R===0){var S=mstrApp.getRootController();var Z=S.showDialog(D.dialogType.refineClusteringPage,{columnName:K,controller:this.controller});this.controller.model.attachEventListener("clustersFetched",Z.id,Z.handleClustersFetched);return ;}while(true){Y=K+" "+X;I=true;for(W=0;W<J.items.length;W++){if(Y===(J.items[W]).name){I=false;break;}}X++;if(I){b=Y;break;}}switch(R){case 1:P=JSON.parse(JSON.stringify(this.operations.duplicate));P.description=P.description.replace("[new column name]",b);P.description=P.description.replace("[column name]",K);P.columnInsertIndex=d+1;P.newColumnName=P.newColumnName.replace("[column name]",b);P.baseColumnName=P.baseColumnName.replace("[column name]",K);break;case 2:b=this.optionsBox.name.value;if(b===""){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}P=JSON.parse(JSON.stringify(this.operations.Rename));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",b);P.oldColumnName=K;P.newColumnName=b;break;case 3:var N=this.optionsBox.columns.selectedIndex;if(N===undefined){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q=(this.optionsBox.columns.items[N]).name;P=JSON.parse(JSON.stringify(this.operations.ConcatenateColumns));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",Q);P.description=P.description.replace("@@@@",b);P.baseColumnName=K;P.newColumnName=b;P.columnInsertIndex=Math.max(d,N)+1;P.expression=P.expression.replace(new RegExp("\\[column name 1\\]","gm"),K);P.expression=P.expression.replace(new RegExp("\\[column name 2\\]","gm"),Q);break;case 4:var V=this.optionsBox.name2.value;var U=this.optionsBox.name3.value;var H=this.optionsBox.columns;if(H.selectedIndex===undefined||!V||!H){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var L=H.items[H.selectedIndex].columnIndex-d+1;P=JSON.parse(JSON.stringify(this.operations.TransposeColumnsIntoRows));P.description=P.description.replace("####",L);P.description=P.description.replace("@@@@",K);P.description=P.description.replace("@@@@",V);P.description=P.description.replace("@@@@",U);P.startColumnName=K;P.keyColumnName=V;P.valueColumnName=U;P.columnCount=L;}if(!(R===2||R===4)){P.engineConfig=JSON.parse(this.controller.model.engine);}a.push(P);this.controller.applyOperations({operations:JSON.stringify(a),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.name.set("value","");}mstrmojo.Refine.RefineControlOther=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlOther",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===70||this.subType===71){this.optionsBox.apply.onclick();}if(this.subType===74){var I=this.parent.columns;var H=I.selectedIndex;var J=I.items[H].columnIndex;this.populate(this.columns.slice(J+1),J+1);this.handleColumnUnSelected();}else{if(this.subType===73){this.populate(this.columns);this.handleColumnUnSelected();}}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===C.transformationType.Other);},subType:function(){return((this.parentBox.transformationList.type===C.transformationType.Other)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",alias:"columns",cssClass:"refine-pulldown refine-other-columns",onitemSelected:function(H){A.toggleClass(this.domNode,"selected",true);this.set("value",H.name);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===3||this.parent.parent.parentBox.transformationList.subType%10===4);}},getPopupListConfig:function B(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",useRichTooltip:true,selectionPolicy:"reselect",locksHover:true,listHooks:{select:function H(K,L,J){this.parent.set("selectedIndex",J);this.close();}},getItemProps:function I(K,J){return mstrmojo._IsList.getItemProps.call(this,K,J);}};}},{scriptClass:"mstrmojo.TextBox",alias:"name",emptyText:mstrmojo.desc(12361,"Column Name"),tooltip:mstrmojo.desc(12361,"Column Name"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===2);}}},{scriptClass:"mstrmojo.TextBox",alias:"name2",emptyText:mstrmojo.desc(14178,"Key Column"),tooltip:mstrmojo.desc(14178,"Key Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"name3",emptyText:mstrmojo.desc(14179,"Value Column"),tooltip:mstrmojo.desc(14179,"Value Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){G.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==1);}}}]}],populate:function F(J,K){if(!K){K=0;}var H=[],I;for(I=0;I<J.length;I++){H.push({n:J[I].name,name:J[I].name,columnIndex:I+K,originalName:J[I].originalName});}this.optionsBox.columns.set("items",H);},handleColumnsChanged:function E(H){this.columns=H.value.columns;this.populate(this.columns);},handleColumnUnSelected:function(){this.optionsBox.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.optionsBox.columns.selectedIndex=undefined;this.optionsBox.columns.list.set("selectedIndex",null);A.toggleClass(this.optionsBox.columns.domNode,"selected",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ListPreviewButton","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.EditableLabel");var A=mstrmojo.css,E=mstrmojo.validation.STATUSCODE;mstrmojo.ui.editors.controls.ComboBox=mstrmojo.declare(mstrmojo.ui.editors.controls.ListPreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ComboBox",markupMethods:{onenabledChange:function D(){this.txtLabel.set("enabled",this.enabled);this.txtLabel.set("editOnClick",this.enabled);A.toggleClass(this.domNode,"disabled",!this.enabled);}},init:function B(F){this._super(F);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-ComboBox");},updatePreview:function C(){this.txtLabel.set("value",this.selectedValue||"");},updateSelection:function(){this.set("selectedValue",this.txtLabel.value);},validateTextInput:function(F){return true;},txtLabel:null,children:[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"txtLabel",slot:"previewNode",constraints:{validator:function(){if(!this.parent.validateTextInput(this.value)){return{id:this.id,code:E.INVALID,msg:""};}}},onValid:function(){this.parent.updateSelection();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.vi.ui.HierarchyCheckList","mstrmojo.ui._IsIncFetchHierarchyList");var A=mstrmojo.css;mstrmojo.vi.ui.IncHierarchyCheckList=mstrmojo.declare(mstrmojo.vi.ui.HierarchyCheckList,[mstrmojo.ui._IsIncFetchHierarchyList],{scriptClass:"mstrmojo.vi.ui.IncHierarchyCheckList",cssClass:"elementsList"});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(487,871,872,873,2052,2057,2461,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,12731,12732,13008);var E="all",O=0,A=1,Q=2,Z=4,a=8,e=16,Y=32,W=64,X=128,C=256,I=512,P=1024,R=2048,S=4096;var g=mstrmojo.DI.DIConstants;var B=g.timeRoles;var N=[{n:mstrmojo.desc(2461,"All"),did:E}],M=[{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:Q},{n:mstrmojo.desc(10051,"Quarter of Year"),did:Z},{n:mstrmojo.desc(871,"Month"),did:a},{n:mstrmojo.desc(10049,"Month of Year"),did:e},{n:mstrmojo.desc(10048,"Week"),did:Y},{n:mstrmojo.desc(10047,"Week of Year"),did:W},{n:mstrmojo.desc(2052,"Date"),did:X},{n:mstrmojo.desc(10046,"Day of Month"),did:C},{n:mstrmojo.desc(10045,"Day of Week"),did:I}],L=[{n:mstrmojo.desc(10042,"Hour"),did:P},{n:mstrmojo.desc(10043,"Minute"),did:R},{n:mstrmojo.desc(10044,"Second"),did:S}],G=[{n:mstrmojo.desc(2057,"None"),did:B.NONE},{n:mstrmojo.desc(873,"Year"),did:B.YEAR},{n:mstrmojo.desc(10050,"Quarter"),did:B.QUARTER},{n:mstrmojo.desc(871,"Month"),did:B.MONTH},{n:mstrmojo.desc(10048,"Week"),did:B.WEEK},{n:mstrmojo.desc(872,"Day"),did:B.DAY},{n:mstrmojo.desc(10042,"Hour"),did:B.HOUR},{n:mstrmojo.desc(10043,"Minute"),did:B.MINUTE},{n:mstrmojo.desc(10044,"Second"),did:B.SECOND},{n:mstrmojo.desc(487,"Time"),did:B.TIME},{n:mstrmojo.desc(13008,"Date Time"),did:B.DATE_TIME},{n:mstrmojo.desc(2052,"Date"),did:B.DATE}];var K=false;var F=1,J=2,U=3,d=4;mstrmojo.DI.DITimeDimension=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DITimeDimension",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-di-mapping-title"></div><div class="mstrmojo-di-mapping-time"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];}},top:"0px",left:"0px",height:"320px",mode:U,timeFormIndex:0,init:function c(h){this._super(h);this.raiseEvent({name:"dataChange"});},onmodeChange:function f(){var k=this.mode,h=[],j;this.timebrowser.set("visible",false);this.timeRoleList.set("visible",false);switch(k){case F:h=N.concat(M);j=this.timebrowser;break;case J:h=N.concat(L);j=this.timebrowser;break;case U:h=N.concat(M).concat(L);j=this.timebrowser;break;case d:h=G.concat(L);j=this.timeRoleList;break;default:break;}j.set("items",h);j.set("visible",true);},ondataChange:function b(){var l=this.data,j=0;if(l.isMultiForm){var h=l.subColumns;var k=[];mstrmojo.array.forEach(h,function(n,m){k.push({n:n.fmn,v:m});if((n.timerole&&n.timerole!==0)||(n.der&&n.der!==0)){j=m;}});this.timeFormIndex=j;this.getMode(l.subColumns[j]);this.multiFormList.set("options",k);this.title.set("text",mstrmojo.desc(12731,"Select a column to mark as a Time role: "));this.multiFormList.set("idx",this.timeFormIndex);}else{this.getMode(l);this.multiFormList.set("visible",false);this.title.set("text",mstrmojo.desc(12732,"Please select a time role for this attribute."));}},getMode:function D(j){var h;switch(j.dtp){case 8:this.set("height","220px");this.mode=1;h=false;break;case 9:this.set("height","100px");this.mode=2;h=false;break;case 1:this.set("height","260px");this.mode=3;h=false;break;case 2:case 3:this.set("height","260px");this.mode=4;h=false;break;default:this.georole=j.georole;break;}this.raiseEvent({name:"modeChange"});},_close:function(){var h=this.parent;if(h&&h._cmSource){h._cmSource.closeMenuTree();}},onOK:function(){var p=this.parent,k,l,o,j,q;var h,m=mstrApp.getRootController();if(this.data.isMultiForm){var n=this.multiFormList.idx;if(n!==this.timeFormIndex){this.data.subColumns[this.timeFormIndex].timerole=0;this.data.subColumns[this.timeFormIndex].der=0;}k=this.data.subColumns[n];}else{k=this.data;}if(this.mode===d){h=this.timeRoleList.getSelectedItems();k.timerole=h[0].did;m.setTimeRole(this.data);}else{h=this.timebrowser.getSelectedItems();j=h.slice();q=0;for(l=0,o=j.length;l<o;l++){if(j[l].did!=="all"){q=q|j[l].did;}}k.der=q;m.setTimeDimension(this.data);}this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.Label",slot:"titleNode",alias:"title"},{scriptClass:"mstrmojo.DropDownList",slot:"titleNode",alias:"multiFormList",idx:0,onvalueChange:function V(){var h=this.parent.data.subColumns[this.value];this.parent.getMode(h);}},{scriptClass:"mstrmojo.CheckList",slot:"contentNode",alias:"timebrowser",cssClass:"mstrmojo-di-time-tree",visible:false,onchange:function(j){var m=j.added,o=j.removed,k,n,h,l;if(K){K=false;return ;}if(m){k=this.items;n=k.length;l=this.selectedIndices;if(m[0]===0){for(h=0;h<n;h++){if(!l[h]){K=true;this.setSelectedItems(k,true);break;}}}else{for(h=1;h<n;h++){if(!l[h]){return ;}}if(!l[0]){K=true;this.toggleSelect(0,false);}}}if(o){if(o[0]===0){this.clearSelect();}else{if(this.selectedIndices[0]){K=true;this.toggleSelect(0,false);}}}},onRender:function(){var n=this.parent,o=n.data,j=this.items,m=[],l,k,h;if(o.isMultiForm){o=o.subColumns[n.multiFormList.value];}k=o.der;for(l=0,h=j.length;l<h;l++){if(k&j[l].did){m.push(j[l]);}}if(h===m.length+1){m.push(j[0]);}if(m.length){this.setSelectedItems(m,true);}}},{scriptClass:"mstrmojo.RadioList",slot:"contentNode",alias:"timeRoleList",cssClass:"mstrmojo-di-time-tree",visible:false,onRender:function H(){var n=this.parent,o=n.data;if(o.isMultiForm){o=o.subColumns[n.multiFormList.value];}var l=o.timerole,j=this.items,m=[],k,h;for(k=0,h=j.length;k<h;k++){if(l===j[k].did){m.push(j[k]);break;}}if(m.length){this.setSelectedItems(m,true);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx");mstrmojo.requiresDescs(221,871,873,1442,2052,2057,2461,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,12929);var Y=mstrmojo.hash;var C="all",A=1,M=2,U=4,V=8,Z=16,S=32,Q=64,R=128,B=256,F=512,L=1024,N=2048,O=4096;var K=[{n:mstrmojo.desc(2461,"All"),did:C}],J=[{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:M},{n:mstrmojo.desc(10051,"Quarter of Year"),did:U},{n:mstrmojo.desc(871,"Month"),did:V},{n:mstrmojo.desc(10049,"Month of Year"),did:Z},{n:mstrmojo.desc(10048,"Week"),did:S},{n:mstrmojo.desc(10047,"Week of Year"),did:Q},{n:mstrmojo.desc(2052,"Date"),did:R},{n:mstrmojo.desc(10046,"Day of Month"),did:B},{n:mstrmojo.desc(10045,"Day of Week"),did:F}],I=[{n:mstrmojo.desc(10042,"Hour"),did:L},{n:mstrmojo.desc(10043,"Minute"),did:N},{n:mstrmojo.desc(10044,"Second"),did:O}],E=[{n:mstrmojo.desc(2057,"None")},{n:mstrmojo.desc(873,"Year"),did:A},{n:mstrmojo.desc(10050,"Quarter"),did:M},{n:mstrmojo.desc(871,"Month"),did:V},{n:mstrmojo.desc(10048,"Week"),did:S},{n:"Day",did:R}];var H=false;var D=1,G=2,P=3,X=4;mstrmojo.qb.TimeDimension=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.TimeDimension",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};width:155px;height:{@height};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-qb-mapping-title">{@title}</div><div class="mstrmojo-qb-mapping-time"></div><div class="mstrmojo-qb-mapping-buttons"></div></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[1];},titleNode:function(){return this.domNode.firstChild.childNodes[0];},buttonNode:function(){return this.domNode.firstChild.childNodes[2];}},top:"0px",left:"0px",height:"320px",title:mstrmojo.desc(12929,"Please select additional time attributes that you want to create."),mode:P,init:function W(b){this._super(b);this.raiseEvent({name:"modeChange"});},onmodeChange:function a(){var d=this.mode,b=[],c;switch(d){case D:b=K.concat(J);c=this.timebrowser;break;case G:b=K.concat(I);c=this.timebrowser;break;case P:b=K.concat(J).concat(I);c=this.timebrowser;break;case X:b=E.concat(I);c=this.timeRoleList;break;default:break;}c.set("items",b);c.set("visible",true);},_close:function(){var b=this.parent;if(b&&b._cmSource){b._cmSource.closeMenuTree();}},onOK:function(){var g;if(this.mode===X){g=this.timeRoleList.getSelectedItems();}else{g=this.timebrowser.getSelectedItems();}var f=this.parent,d,b,e,c;this.data.geo=false;e=g.slice();c=0;for(d=0,b=e.length;d<b;d++){(e[d].did!=="all")&&(c=c|e[d].did);}this.data.der=c;mstrApp.getRootController().setTimeRole(this.data);this._close();},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.CheckList",slot:"contentNode",alias:"timebrowser",cssClass:"mstrmojo-qb-time-tree",visible:false,onchange:function(c){var f=c.added,h=c.removed,d,g,b,e;if(H){H=false;return ;}if(f){d=this.items;g=d.length;e=this.selectedIndices;if(f[0]===0){for(b=0;b<g;b++){if(!e[b]){H=true;this.setSelectedItems(d,true);break;}}}else{for(b=1;b<g;b++){if(!e[b]){return ;}}if(!e[0]){H=true;this.toggleSelect(0,false);}}}if(h){if(h[0]===0){this.clearSelect();}else{if(this.selectedIndices[0]){H=true;this.toggleSelect(0,false);}}}},onRender:function(){var d=this.parent.der,c=this.items,f=[],e,b;for(e=0,b=c.length;e<b;e++){(d&c[e].did)&&(f.push({did:c[e].did}));}(b===f.length+1)&&(f.push({did:"all"}));f.length&&this.setSelectedItems(f,true);}},{scriptClass:"mstrmojo.RadioList",slot:"contentNode",alias:"timeRoleList",cssClass:"mstrmojo-qb-time-tree",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.array","mstrmojo.CheckList","mstrmojo.fx","mstrmojo.dom","mstrmojo.DI.DIConstants","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(12725);var D=mstrmojo.dom;var C=mstrmojo.DI.DIConstants;mstrmojo.DI.DIShowAllColumns=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIShowAllColumns",markupString:'<div id="{@id}"  class="{@cssClass}" style="top:{@top};left:{@left};"><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,click><div class="mstrmojo-di-mapping-title"></div><div class="mstrmojo-di-mapping-columns"></div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild.childNodes[0];},contentNode:function(){return this.domNode.firstChild.childNodes[1];}},top:"0px",left:"0px",onOK:function(){var H=this.allColumns.getSelectedItems();var G=this.allColumns.items,E=mstrApp.getRootController();for(var F in G){if(mstrmojo.array.indexOf(H,G[F])===-1){G[F].selected=false;}else{G[F].selected=true;}}E.setMultipleImport(G);},onCancel:function(){this._close();},children:[{scriptClass:"mstrmojo.Label",slot:"titleNode",alias:"title",text:mstrmojo.desc(12725,"Include Columns:")},{scriptClass:"mstrmojo.ui.CheckList",multiSelect:true,orientation:"v",slot:"contentNode",alias:"allColumns",itemDisplayField:"alias",cssClass:"mstrmojo-di-all-columns",preBuildRendering:function A(){var F=this.parent,I=F.data,E=mstrApp.getRootController().model,H=E.getImportSource(I.id),G=[];var J=function(L,K){mstrmojo.array.forEach(K,function(M){if(M.fg!==1){L.push(M.did);}});};if(H.currentTransformations&&H.currentTransformations.xtab&&H.currentTransformations.xtab.isCrosstab){this.items=H.transformedMapping;}else{mstrmojo.array.forEach(H.currentMapping,function(K){if(K.recursive&&K.rdcs.length>0){J(G,K.rdcs);}if(K.isMultiForm&&K.subColumns.length>0){mstrmojo.array.forEach(K.subColumns,function(L){if(L.recursive&&L.rdcs.length>0){J(G,L.rdcs);return false;}});}});this.items=mstrmojo.array.filter(H.currentMapping,function(K){return G.indexOf(K.did)<0;});}if(H.xdaType===C.xdaType.querybuilder||H.xdaType===C.xdaType.googleBigQuery||H.xdaType===C.xdaType.dataImportCustomSQL||H.sourceInfo.hasAggFilter){this.set("enabled",false);}},postBuildRendering:function B(){if(this._super){this._super();}var E=this.itemsContainerNode.childNodes;if(!E){return ;}if(!this._ontooltipover){var F=this.id;this._ontooltipover=function(G){var I=mstrmojo.all[F];D.stopPropogation(self,G);var H=D.findAncestorByAttr(G.target,"idx",true,I.itemsContainerNode);if(!!H&&!!H.node&&H.node.clientWidth<H.node.scrollWidth){I.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:H.node,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:H.node.innerText});I.showTooltip(G,self);}};this._ontooltipout=function(G){var H=mstrmojo.all[F];H.hideTooltip(G,self);};}D.attachEvent(this.itemsContainerNode,"mouseover",this._ontooltipover);D.attachEvent(this.itemsContainerNode,"mouseout",this._ontooltipout);},onRender:function(){var F=this.items,H=[],G,E;for(G=0,E=F.length;G<E;G++){if(F[G].selected){H.push(F[G]);}}if(H.length){this.setSelectedItems(H,true);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,12365,3627,14549,14550);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var L=1,K,J,E=[],I,O,H,M,F,G,R,U,S,N;O=this.parent;H=O.columns;M=H.selectedIndex;N=H.items[H.selectedIndex].columnIndex;if(M===undefined){return ;}F=(H.items[M]).name;G=O.transformationList;R=G.subType%10;while(true){S=F+" "+L;J=true;for(K=0;K<H.items.length;K++){if(S===(H.items[K]).name){J=false;break;}}L++;if(J){U=S;break;}}switch(R){case 0:I=JSON.parse(JSON.stringify(this.operations.fromTo));var Q=this.optionsBox.fromto.from.value;var P=this.optionsBox.fromto.to.value;if(!Q||!P){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[new column name]",U);I.description=I.description.replace("[column name]",F);I.description=I.description.replace("[from]",parseInt(Q)-1);I.description=I.description.replace("[to]",P);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",U);I.baseColumnName=I.baseColumnName.replace("[column name]",F);I.expression=I.expression.replace("[from]",parseInt(Q)-1);I.expression=I.expression.replace("[to]",P);break;case 1:case 2:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(R===1){I=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{I=JSON.parse(JSON.stringify(this.operations.afterLast));}I.description=I.description.replace("[new column name]",U);I.description=I.description.replace("[column name]",F);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",U);I.baseColumnName=I.baseColumnName.replace("[column name]",F);if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){I.description=I.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+this.optionsBox.separatorBox.separator.value+"/");}else{I.description=I.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(this.optionsBox.separatorBox.separator.value)+"'");}break;}I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fromto.from.set("value","");this.optionsBox.fromto.to.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");}mstrmojo.Refine.RefineControlExtract=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlExtract",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Extract);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fromto",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"from",tooltip:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}},{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"to",tooltip:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"comma")},{n:mstrmojo.desc(1053,"tab")},{n:mstrmojo.desc(12343,"whitespace")},{n:mstrmojo.desc(12362,"newline")},{n:mstrmojo.desc(12363,"pipe")},{n:mstrmojo.desc(12364,"period")},{n:mstrmojo.desc(3627,"other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var H=[],E,J,I,G,D,F,C;J=this.parent;I=J.columns;G=I.selectedIndex;if(G===undefined){return ;}D=(I.items[G]).name;F=J.transformationList;C=F.subType%10;switch(C){case 0:E=JSON.parse(JSON.stringify(this.operations.trim));break;case 1:E=JSON.parse(JSON.stringify(this.operations.collapse));break;}E.columnName=D;E.description=E.description.replace("[column name]",D);E.engineConfig=JSON.parse(this.controller.model.engine);H.push(E);this.controller.applyOperations({operations:JSON.stringify(H),engine:JSON.stringify({facets:[],mode:"row-based"})});}mstrmojo.Refine.RefineControlWhitespace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlWhitespace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Whitespace);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Whitespace)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",visible:false,onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.FileUploadBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.CheckBox","mstrmojo.Image","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.DI.FileDragDropBox","mstrmojo.css");mstrmojo.requiresDescs(1825,12509,12691,12692,12737,12738,12739,12740,14099,14194);var R=mstrmojo.DI.DIConstants,K=mstrmojo.desc,C,M=mstrmojo.DI.DIHelpers,H=M.isOperationMode;function F(){var S=this.model;var U;if(this.currentSource){U=this.currentSource;}else{U=S.currentSource;}return U;}function J(X){var W=0,U,S;if(mstrApp.isSingleTier){for(U=0;U<X.length;U++){var V=X[U];var Y=V.lastIndexOf("\\");if(Y===-1){Y=V.lastIndexOf("/");}if(Y!==-1){W++;}}}else{for(S in X){if(X[S].size){W++;}}}return W;}function B(){var Y=true;var U,S;var X=F.call(this);if(!X||!X.sourceInfo){return Y;}var W=this.getOperationMode();if((W===R.operationMode.refresh)||(W===R.operationMode.edit)){if(this.origFileExt===""){U=mstrApp.isEMMACube?X.sourceInfo.dbTableName:X.sourceInfo.name;this.origFileExt=M.getExtensionType(U.substring(U.lastIndexOf(".")));}var V="";if(this.dnDBox.files&&this.dnDBox.files.length>0){V=this.dnDBox.files[0].name;}S=M.getExtensionType(V.substring(V.lastIndexOf(".")));if(this.origFileExt!==S){Y=false;}}return Y;}function I(b){var f;var a=this.dnDBox;var W=a.files;var n;var j;var X;var g="<ul>";var Y=mstrApp.getRootController();var U=this.getOperationMode();var c=this;var V=true;var S=true;var d,p,h,Z;var m=false;var l=[];for(f=0;f<W.length;f++){j=W[f];n="C:\\fakepath\\"+j.name;X=n.substring(n.lastIndexOf(".")+1);if(W!==undefined){if(W[f]!==undefined){d=W[f].size;}}else{p=new ActiveXObject("Scripting.FileSystemObject");h=p.getFile(W);d=h.Size;}if(d>(mstrApp.diParams.UploadSizeLimit*1024*1024)){m=true;l.push(j.name);var q=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",X).replace("@@@@",mstrApp.diParams.UploadSizeLimit);g+="<li>"+j.name+"<br>"+q||" </li>";j.toDel=true;}else{V=false;}if(X==="mstr"){Y.displayError(mstrmojo.desc(14194,"Error: Only Excel Text, CSV can be uploaded. Please use the Upload MicroStrategy File to import .MSTR files."),false);return ;}}if(U!==R.operationMode.create&&W.length>0){Z=F.call(this);n=W[0].name;if(!Z.isExtensionValid(n)){Y.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}}if(m){g+="</ul>";if(V){Y.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,g);}else{var o=function(){for(f=0;f<a.files.length;f++){var e=a.files[f];if(e.toDel){mstrmojo.array.removeItem(a.files,e);}}Y.importFileEMMA(a,n,S,!Y.model.hasEMMAReportInstance(),this.id,true,b);};var k={detailErrorMessage:g,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){var t=[];for(f=0;f<a.files.length;f++){var e=a.files[f];if(!e.toDel){t.push(e);}}if(c.setFilesObject){c.setFilesObject(l);}a.files=t;}};Y.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),o,k);}return ;}Y.importFileEMMA(a,n,S,!Y.model.hasEMMAReportInstance(),this.id,true,b);}function N(Y){var W=this,S=this.dnDBox,U=mstrApp.getRootController(),X,V;X=function(){I.call(W,Y);};V={detailErrorMessage:"",okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){}};if(S.failedFilesCount>0){U.displayWarning(K(14099,"Some files could not be imported last time. Click 'Yes' to ignore them and proceed with the rest files. Otherwise, click 'No' to check the erroneous files or delete them."),K(12537,"Data Import"),X,V);}else{I.call(W,Y);}}mstrmojo.DI.DIFileUpload=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFileUpload",cssClass:"mstrmojo-di-fu",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload {@cssClass}" ><div></div><div></div><div class="mstrmojo-di-fileUpload-fileinput"></div><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},URLOrFileSwitchNode:function(){return this.domNode.children[0];},radioListNode:function(){return this.domNode.children[1];},fileInputNode:function(){return this.domNode.children[2];},infoNode:function(){return this.domNode.children[3];},showPreviewNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},origFileExt:"",init:function O(U){if(this._super){this._super(U);}var V={},S=V[this.id]={};S.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(V);},onNextButtonClick:function L(){N.call(this,this.tableID?R.actions.refreshData:R.actions.importSource);},onFinishButtonClick:function(){N.call(this,R.actions.savePublish);},onBackButtonClick:function A(){var S=mstrApp.getRootController();S.showPage(R.pageType.dataSelection);},onHelpButtonClick:function Q(){return"importing_data_from_a_file.htm";},updatePageConfig:function(S){var U=this;if(S&&S.properties){mstrmojo.hash.forEach(S.properties,function(W,V){U.set(V,W);});}this.dnDBox.updatePageConfig(S);},setFilesObject:function(S){this.dnDBox.setFilesObject(S);},onforceEnableChange:function(){mstrApp.getRootController().sourceSelected(this.forceEnable);},getOperationMode:function(){var S=this.model.operationMode;if(H(this.operationMode)){S=this.operationMode;}return S;},adjustSize:function G(S){var V=S.size,W,U;this.dnDBox.adjustSize(V);if(mstrApp.isSingleTier){W=parseInt(V.w,10);U=this.fileInputNode.children[1];U.style.marginRight=W/2-(U.clientWidth/2+1)+"px";}},children:[{slot:"fileInputNode",scriptClass:"mstrmojo.DI.FileDragDropBox",cssClass:"drag-drop-box",alias:"dnDBox",markupMethods:{onvalueChange:function(){var S=mstrApp.getRootController();if(this.files&&this.files.length>0){S.sourceSelected(true);}else{S.sourceSelected(false);}},onfilesChange:function(){var U=mstrApp.getRootController(),V=this.parent.getOperationMode();if((this.files.length!==0||this.parent.forceEnable===true)){this.dnDNode.style.borderStyle="solid";if(V===R.operationMode.create){U.sourceSelected(true);}else{if(V===R.operationMode.refresh||V===R.operationMode.edit){var S=J(this.files);U.sourceSelected((S===1));}}}else{this.dnDNode.style.borderStyle="dashed";U.sourceSelected(false);}},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.dragLabelNode.style.display=this.fileUpload&&!mstrmojo.dom.isIE8&&!mstrmojo.dom.isIE9?"block":"none";}},addOneTierFile:function E(W){var Y=0;if(!W){return ;}var U=mstrmojo.dom.getOSInfo().name.toLowerCase().indexOf("windows")>=0,Z;if(U){Z=W.split("*");}else{Z=W.split(":");}var X,V=[].concat(this.files);if(this.parent.tableID&&V.length>0){this.removeChildren();V=[];}for(Y=0;Y<Z.length;Y++){X=Z[Y];V.push(X);this.addFile(mstrmojo.DI.DIHelpers.getAbsoluteFileName(X),X);}this.set("files",V);if(this.parent.tableID){var S=J(this.files);mstrApp.getRootController().sourceSelected((S===1));}},bindings:{value:function(){var U=F.call(this.parent);if((H(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==R.operationMode.create){if(!this.initValue){this.initValue=true;if(U.subtype===R.sourceSubtype.localFile){var S=U.sourceInfo.name;S=S.substr("C:/fakepath/".length);return mstrmojo.desc(12739,"Previously uploaded file:####").replace("####",S);}}}return"";}},preBuildRendering:function D(){if(this._super){this._super();}var U=mstrApp.getRootController().model;var V=F.call(this.parent);var S=V&&V.sourceInfo.partition;if(mstrApp.isSingleTier){this.markupString='<div><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div class="mstrmojo-di-fileHolder {@cssClass}" mstrAttach:dragover,dragend,drop,click><div class="mstrmojo-FileDragDropBox-text {@textcssClass}">{@text}</div><div class="mstrmojo-FileDragDropBox-content"></div><div class="mstrmojo-FileDragDropBox-count"></div></div><div></div><div><div><div></div></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>';}if(U.operationMode!==R.operationMode.create&&(!S||!S.isPartition)&&!U.isAddingNewTable){this.descriptor=mstrmojo.desc(13867,"Drag a file to replace this file");this.browseLabel=mstrmojo.desc(13864,"Choose a file");}else{this.multiple="multiple";}this.text=mstrmojo.desc(12691,"Data can be in crosstab or tabular format");C=this.id;},postBuildRendering:function(){if(mstrApp.isWorkstation){this.dragLabelNode.style.display="none";}}},{slot:"fileInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot mstrmojo-onetier-browse",text:mstrmojo.desc(13865,"Choose files"),onclick:function(){mstrApp.getRootController().launchOneTierBrowser("mstrmojo.DI.DIFileUpload.OneTierFiles");},bindings:{visible:function(){return mstrApp.isSingleTier;}}},{slot:"fileInputNode",scriptClass:"mstrmojo.Label",text:"",allowHTML:true,cssClass:"di-fu-refresh-text",postBuildRendering:function P(){var S=F.call(this.parent);if((H(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==R.operationMode.create){var U=mstrmojo.string.encodeHtmlString(S.sourceInfo.dbTableName);this.set("text",mstrmojo.desc(13868,"Upload original file or a new file to refresh this table.")+"<br />"+mstrmojo.desc(12739,"Previously uploaded file:####").replace("####",U));this.set("title",mstrmojo.desc(12739,"Previously uploaded file:####").replace("####",U));}}}]});mstrmojo.DI.DIFileUpload.OneTierFiles=function(U){var S=mstrmojo.all[C];S.addOneTierFile(U);};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var J,H,G,D,F,C;J=this.parent;H=J.columns;G=H.selectedIndex;if(G===undefined){return ;}name=(H.items[G].originalName);D=(H.items[G]).name;F=J.transformationList;C=F.subType%10;var I;var E={};E.originalName=name;E.name=D;E.columnName=D;if(C===0){I="list";E.expression="value";}else{if(C===1){I="range";E.expression="value";E.mode="range";}else{if(C===2){I="timerange";E.expression="value";E.mode="range";}else{if(C===3){I="text";E.caseSensitive=false;E.mode="text";}}}}this.controller.addFacets(I,E);}mstrmojo.Refine.RefineControlFacet=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFacet",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Facet);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Facet)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.WidgetList","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.ui.CheckList","mstrmojo.RadioList","mstrmojo.StackContainer","mstrmojo.Editor","mstrmojo.hash","mstrmojo.css");mstrmojo.requiresDescs(373,547,2140,12724,12909,16033);var C=mstrmojo.array,B=mstrmojo.hash,D=mstrmojo.css,I=mstrmojo.DI.DIHelpers,G=mstrmojo.string;function H(J,L,K){D.removeClass(J.domNode,["select-all","unselect-all","select-some"]);if(L===0){D.addClass(J.domNode,"unselect-all");}else{if(L===K){D.addClass(J.domNode,"select-all");}else{D.addClass(J.domNode,"select-some");}}}function E(K){var J={shouldAlert:false,num:0},L=".json",M=50;C.forEach(K,function(O){var Q=O.n,N=Q&&Q.substr(Q.lastIndexOf("."));if((N&&N.toLowerCase())===L&&O.sheets&&O.sheets.length>=M){var P=C.filter(O.sheets,function(R){return R.selected===true;});if(P&&P.length>=M){J.shouldAlert=true;J.num+=P.length;}}});return J;}function F(K,M){var L=mstrmojo.desc(16301,"#numbers# tables were identified in the selected file, which is likely not the expected result. The structure of the JSON file you selected is likely not handled correctly. Please refer to #link# for more information on supported JSON data formats."),J="https://community.microstrategy.com/s/article/KB442251-Best-practice-of-JSON-File-Import-in-MicroStrategy-10-4-and-above";L=L.replace("#numbers#",K);if(mstrApp.isWorkstation){L=L.replace("#link#",'<a onclick="mstrmojo.DI.DIHelpers.createPopupWindow(\'#docLink#\');return false;" href="">KB442251</a>'.replace("#docLink#",J));}else{L=L.replace("#link#",'<a href="#docLink#" target="_blank">KB442251</a>'.replace("#docLink#",J));}mstrmojo.confirm(L,{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){M();}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{allowHTML:true});}mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog",cssClass:"mstrmojo-di-sheets-selection-dialog",title:mstrmojo.desc(12724,"Select Worksheets"),items:null,onBack:mstrmojo.func.emptyFn,onOK:function(){this.close();},noButtonCls:true,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ssd-file-content",alias:"filesAndSheets",colHTML:'<colgroup><col style="width: 200px;"/><col/></colgroup>',children:[{scriptClass:"mstrmojo.VBox",alias:"leftPanel",cssClass:"mstrmojo-di-ssd-left-panel",children:[{scriptClass:"mstrmojo.WidgetList",alias:"fileList",cssClass:"mstrmojo-di-ssd-file-list",selectedIndex:0,itemFunction:function(M,J,N){var L;if(M.n&&/^hdfs:\/\//.test(M.n)){L=M.n.substring(M.n.lastIndexOf("/")+1);}else{L=M.n;}L=mstrmojo.string.htmlAngles(I.truncate(L,28));var K=new mstrmojo.Button({text:L,title:mstrmojo.string.encodeHtmlString(M.n),sheets:M.sheets,widget:N,onclick:function(){N.updateSheetsList(M,false);}});return K;},bindings:{items:"this.parent.parent.parent.items"},onitemsChange:function(){if(this.items&&this.items.length>0){this.set("selectedIndex",0);this.updateSheetsList(this.items[0],true);}},updateSheetsList:function(U,W){var O=this.parent.parent.parent;var N=this.parent.parent.rightPanel;var Q=N.sheets;var V,L,K=U.sheets;if(!U.sheets||U.sheets.length<=0){Q.set("selected",null);N.fileName.set("text",mstrmojo.desc(12909,"There are no sheets in this file."));return ;}if(Q.children){for(L=0;L<Q.children.length;L++){if(Q.children[L].id===U.id){V=Q.children[L];}}}C.forEach(K,function(X){X.title=G.encodeHtmlString(X.title)||"";});var S={};if(!U.multiSelection){S[U.defaultSheetsIndex||0]=true;}else{C.forEach(U.sheets,function(Y,X){S[X]=true;});C.forEach(this.items,function(X){C.forEach(X.sheets,function(Y){if(Y.selected===undefined){Y.selected=true;}});});}if(!V){V=Q.addChildren([mstrmojo.insert({scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-di-ssd-sheets-list",alias:"list",items:K,list:U.sheets,id:U.id,multiSelect:U.multiSelection,sheetsSelectionDialog:O,selectedIndices:S,getItemMarkup:function P(){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}"><span class="text">{@en@n}</span></{@tag}>';},postBuildRendering:function(){if(this._super){this._super();}this.onchange();window.setTimeout((function(X){return function(){X.disableScroll(true,false);};})(this),0);},onchange:function(){var Y=this.items,b=this.selectedIndices;C.forEach(Y,function(d){d.selected=false;});B.forEach(b,function(e,d){if(d){Y[d].selected=e;}});var X=false;mstrmojo.array.forEach(this.items,function(d){X=X||d.selected;});this.parent.parent.parent.parent.btnHbox.selectBtn.set("enabled",X);var Z=Object.keys(b).length,a=Y.length,c=B.walk("parent.parent.selectAllButton",this);H(c,Z,a);}})])[0];}else{if(W){V.set("list",U.sheets);V.set("items",U.sheets);V.set("selectedIndices",S);}}var J;if(U.n&&/^hdfs:\/\//.test(U.n)){J=U.n.substring(U.n.lastIndexOf("/")+1);}else{J=U.n;}J=I.truncate(J,42);N.fileName.set("text",J);Q.set("selected",V);var M=Object.keys(V.selectedIndices).length,R=V.items.length;H(N.selectAllButton,M,R);}}]},{scriptClass:"mstrmojo.VBox",alias:"rightPanel",cssClass:"mstrmojo-di-ssd-right-panel",children:[{scriptClass:"mstrmojo.Label",alias:"fileName"},{scriptClass:"mstrmojo.Button",alias:"selectAllButton",text:mstrmojo.desc(16033,"All worksheets"),cssClass:"select-all-button",cssDisplay:"none",cssText:"",onclick:function(){var M=B.walk("parent.parent.leftPanel.fileList.selectedIndex",this),L=B.walk("parent.sheets.children."+M,this),J,K;if(L){J=Object.keys(L.selectedIndices).length;K=L.items.length;if(J===K){L.set("selectedIndices",[]);}else{L.set("selectedIndices",C.map(L.items,function(N){return N.idx;}));}}}},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ssd-search",cssText:"font-size:10pt;",alias:"searchBox",visible:false,onkeyup:function(){var M=this.value;var L=this.parent.sheets.list.list;var K,N,J=[];for(K=0;K<L.length;K++){N=L[K].n.toLowerCase().search(M.toLowerCase());if(N>-1){J.push(L[K]);}}this.parent.sheets.list.set("items",J);}},{scriptClass:"mstrmojo.StackContainer",cssClass:"mappingpage-bottom",alias:"sheets"}]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(547,"Select"),alias:"selectBtn",enabled:true,onclick:function(){var K=this.parent.parent,L=function(){if(K.onOK){K.onOK();}else{K.close();}},J=E(K.items);if(J.shouldAlert){F(J.num,L);}else{L();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2140,"Cancel"),alias:"backBtn",onclick:function(){var J=this.parent.parent;if(J.onBack){J.onBack();}if(J&&J.filesAndSheets&&J.filesAndSheets.rightPanel&&J.filesAndSheets.rightPanel.sheets){C.forEach(J.filesAndSheets.rightPanel.sheets.children,function(K){K&&K.destroy&&K.destroy();});J.filesAndSheets.rightPanel.sheets.removeChildren();}J.close();}}],postBuildRendering:function A(){if(this._super){this._super();}var J=B.walk("filesAndSheets.rightPanel.selectAllButton",this);if(J){if(B.walk("items.0.multiSelection",this)){J.domNode.style.display="inline-block";}else{J.domNode.style.display="none";J.domNode.className+=" none-display";}}},onOpen:function(){if(this.visible&&I.getEnvObj().isWeb()){this.filesAndSheets.rightPanel.sheets.list.updateScrollbars();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(221,373,1059,12906,13166,13167);var B=mstrmojo.DI.DIConstants;mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog",cssClass:"mstrmojo-di-import-option",title:mstrmojo.desc(13327,"Select Import Options"),showTitle:true,sourceInfo:null,help:"Importing_data_from_a_database_by_building_a_SQL_q.htm",pageType:null,subtype:null,isContainHadoop:true,items:null,onOK:null,onClose:function(){this.onOK=null;},children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-di-io-radio-list",icnCss:"import-options",alias:"radioList",multiSelect:false,orientation:"v",bindings:{items:"this.parent.items"},postBuildRendering:function(){this._super&&this._super();this.hasCustomScrollbar=true;},getItemMarkup:function(D,C){return mstrmojo.ui.CheckList.prototype.getItemMarkup.call(this,D,C).replace("{@en@n}",'{@en@n}<div class="subtitle">{@en@sub}</div>');},getItemProps:function(E,C){var D=mstrmojo.ui.CheckList.prototype.getItemProps.call(this,E,C);D.sub=E.sub;return D;},onchange:function(){var D=this.parent,C=(D.srcInfo&&D.srcInfo.type),F,E;if(!this.selectedItem){return ;}switch(this.selectedItem.did){case"0":D.pageType=B.pageType.hadoop;D.subtype=B.sourceSubtype.hadoop;D.sourceInfo=1;break;case"1":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.qbSingleTable};D.pageType=B.pageType.database;F=B.xdaType.googleBigQuerySingleTable;break;case"2":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.querybuilder};D.pageType=B.pageType.database;F=B.xdaType.googleBigQuery;break;case"3":D.sourceInfo={sourceType:B.sourceType.querybuilder,type:B.xdaType.ffsql};D.pageType=B.pageType.database;F=B.xdaType.googleBigQueryFFSQL;break;}if(C===B.sourceType.googleBigQuery){D.pageType=B.pageType.sourceIntro;D.sourceInfo=this.parent.srcInfo;mstrApp.bigQueryXdatype=F;}E=D.btnHbox.nextBtn;if(!E.enabled){E.set("enabled",true);}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1059,"Next"),alias:"nextBtn",enabled:false,onclick:function(){var D=this.parent.parent;var C=mstrApp.getRootController();if(D.onOK){D.onOK({pageType:D.pageType,sourceInfo:D.sourceInfo,enabled:true});}else{C.showPage(D.pageType,D.sourceInfo);}D.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelBtn",onclick:function(){var C=this.parent.parent;C.close();}}],onvisibleChange:function A(){if(this.visible){this.btnHbox.nextBtn.set("enabled",false);this.radioList.select(0);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,3627,12365,13995,14551);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var K,E=[],J,N,I,L,F,G,P;N=this.parent;I=N.columns;L=I.selectedIndex;if(L===undefined){return ;}F=(I.items[L]).name;G=N.transformationList;P=G.subType%10;switch(P){case 0:if(!this.optionsBox.fixed.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q="["+this.optionsBox.fixed.value+"]";var H=[];try{var O=JSON.parse(Q);for(K=0;K<O.length;K++){if(typeof O[K]==="number"){H.push(O[K]);}}if(H.length===0){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}}catch(M){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}J=JSON.parse(JSON.stringify(this.operations.byFieldLengths));J.description=J.description.replace("[column name]",F);J.columnName=F;J.fieldLengths=H;break;case 1:case 2:case 3:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(P===1){J=JSON.parse(JSON.stringify(this.operations.bySeparator));}else{if(P===2){J=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{J=JSON.parse(JSON.stringify(this.operations.afterLast));}}J.description=J.description.replace("[column name]",F);J.columnName=F;J.separator=this.optionsBox.separatorBox.separator.value;if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){J.regex=true;J.description=J.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");}else{J.description=J.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");}break;case 4:J=JSON.parse(JSON.stringify(this.operations.cellIntoRow));J.description=J.description.replace("[column name]",F);J.columnName=F;J.keyColumnName=this.controller.model.columns.keyColumnName;J.separator=this.optionsBox.separatorBox2.separator.value;break;}J.engineConfig=JSON.parse(this.controller.model.engine);E.push(J);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fixed.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");this.optionsBox.separatorBox2.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox2.separator.set("value",",");}mstrmojo.Refine.RefineControlSplit=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlSplit",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Split);}},operations:null,children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fixed",cssClass:"refine-split-fromto",emptyText:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),tooltip:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9,]/g,"");this.set("value",F);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==4);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox2",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.RadioList","mstrmojo.DI.DIConstants","mstrmojo.DI.FileDragDropBox");mstrmojo.requiresDescs(14659,14660);var B=mstrmojo.DI.DIConstants;function C(F){var E=F.toLowerCase(),D;if(E===".xls"||E===".xlsx"){D=B.xdaType.excel;}else{if(E===".txt"||E===".csv"){D=B.xdaType.text;}else{D=0;}}return D;}mstrmojo.DI.DIDataset=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIDataset",cssClass:"mstrmojo-di-dataset",markupString:'<div id="{@id}" class="{@cssClass}" ><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},titleNode:function(){return this.domNode.children[0];},fileDnDNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-dataset-title",text:"Specify the location of the file that you would like to upload"},{slot:"titleNode",scriptClass:"mstrmojo.RadioListHoriz",cssClass:"mstrmojo-FileDragDropBox-radioList",itemCssClass:"mstrmojo-FileDragDropBox-radioList-item",alias:"radioList",selectedIndex:0,onchange:function(){var D=mstrApp.getRootController();},items:[{did:"0",n:"From my Computer/Network"},{did:"1",n:"From URL"},{did:"2",n:"From Clipboard"}]},{slot:"fileDnDNode",scriptClass:"mstrmojo.DI.FileDragDropBox",cssClass:"drag-drop-box",alias:"dnDBox",multiple:"multiple",markupMethods:{onvalueChange:function(){var D=mstrApp.getRootController();if(this.value!==""){D.sourceSelected(true);}else{D.sourceSelected(false);}},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}}],onNextButtonClick:function A(){var F=this.model,I;var L=this.dnDBox;var D=L.files;var O;var K=mstrApp.getRootController();var N=(this.model.operationMode===B.operationMode.create)?true:this.showPrv.checked;var J;var H;for(I=0;I<D.length;I++){var E=D[I];H="C:\\fakepath\\"+E.name;O=H.substring(H.lastIndexOf("."));if(C(O)===0){K.displayError(mstrmojo.desc(14659,"The following file extension ## is not supported.").replace("##",O),false);return ;}if(D!==undefined){if(D[I]!==undefined){J=D[I].size;}}else{var G=new ActiveXObject("Scripting.FileSystemObject");var M=G.getFile(D);J=M.Size;}if(J>(mstrApp.diParams.UploadSizeLimit*1024*1024)){O=H.substring(H.lastIndexOf(".")+1);K.displayError(mstrmojo.desc(14660,"The maximum file size for ## files is @@ MB.").replace("##",O).replace("@@",mstrApp.diParams.UploadSizeLimit),false);return ;}}K.importFileEMMA(L,H,N,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(11636);var C=mstrmojo.func,D=mstrmojo.hash,A={style:{params:{treesToRender:1}},hideCancel:true};mstrmojo.DI.controller.DIDocController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDocController",submitUpdate:function(I,J,H){var G=mstrApp,F=mstrApp.launchingApp,E={success:function(K){window.mstrApp=G;if(K&&K.mid){mstrApp.getRootController().getModel().analysisID=K.mid;}},failure:function(){window.mstrApp=G;}};window.mstrApp=F;if(mstrApp.rootCtrl.docCtrl){mstrApp.rootCtrl.docCtrl.cmdMgr.getInterimCmd().submitInterim(I,C.wrapMethods(E,J,{}),H);}else{E.success();J.success();}},createNewManagedDataset:function(G,F){var E={act:"createDataset",mgo:true,name:mstrmojo.desc(11636,"New Dataset"),prm:true,rid:"4B43EC5548911FC01AF5D3ACE3F16256",disablePU:true,execFlags:131072};this.submitUpdate(D.copy(F,E),G,{style:{params:{treesToRender:1}},hideCancel:true});},removeDataset:function(G,F){var E={act:"removeDataset",did:F&&F.id,disablePU:true};if(F&&F.id){this.submitUpdate(E,G,A);}},renameDataset:function B(F,E,H){var G={act:"renameDataset",datasetID:F,name:E};this.submitUpdate(G,H,A);},setDatasetDDA:function(H,G){var F={act:"toggleDatasetServeMode",execFlags:131072,dsid:G&&G.id,dsm:2};var E={style:{params:{treesToRender:1}},params:{stateID:-1}};if(G&&G.id){this.submitUpdate(F,H,E);}},getVIModelDatasets:function(){var E=mstrApp.launchingApp,F=null,G=[];if(E&&E.rootCtrl&&E.rootCtrl.docCtrl&&E.rootCtrl.docCtrl.model){F=E.rootCtrl.docCtrl.model.datasets;D.forEach(F,function(H){G.push(H);});}return G;},getVIDocData:function(F){var E={style:{params:{treesToRender:0}},hideCancel:true};this.submitUpdate([],F,E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants","mstrmojo.DI.DIModel");mstrmojo.requiresDescs(641,12783,12897,12899,12900,12901,12902,12903,12904,12510,12537,13324,12392,14708);var k=mstrmojo.DI.DIConstants,O=mstrmojo.array,Z=mstrmojo.func,C=mstrmojo.string,J=k.xdaType,M=k.actions,W=mstrmojo.DI.DIHelpers,K="TABLENAME=",G="GENERICPARA=";var X=W.extractFileExtensionFromHadoopURL;var B=function(o,m){if(o.fileTypeMap&&o.fileTypeMap[m]){return o.fileTypeMap[m];}else{var l=X(m).toUpperCase();var n=k.fileTypes[0].v;O.some(k.fileTypes,function(p){if(p.n===l){n=p.v;return true;}});return n;}};var N=function(l){return(l.toUpperCase()===k.fileTypes[0].v)?J.dataImportFileText:J.dataImportFileExcel;};function V(l){var o=l.idx;var m={idx:0,files:{}};for(var n=0;n<o;++n){if(!l.files[n].cancelled){m.files[m.idx]=l.files[n];++m.idx;}}return m;}function a(u,q,w){var p=mstrApp.getRootController(),t=p.dataService,m=null,o=[];var n={success:function(AA){var z=AA.datap.shts,x=0;o=[];O.forEach(z,function(AB){if(AB!=="*"){o.push({idx:x,n:AB});}x++;});if(o.length>0){if(w.success){w.success({sheets:o});}}else{if(w.failure){w.failure({message:mstrmojo.desc(12510,"The import process cannot proceed with an empty file.")});}}if(w.complete){w.complete();}},failure:function(x){if(w.failure){w.failure(x);}if(w.complete){w.complete();}}};var l={success:function(){m={tableID:q,previewflag:k.requestFlag.sheets};t.getImportedData(n,m);},failure:function(x){if(w.failure){w.failure(x);}if(w.complete){w.complete();}}};m=mstrmojo.hash.copy(u,{tbid:q});t.setDataImportInfo(l,m);}function Y(q,u,p){var m=this;var o=q&&q.length;var n=0;var t;if(!o){if(u&&u.success){u.success();}if(u&&u.complete){u.complete();}return ;}var l={success:function(w){m.dataService.set("messageID",w.msgid);m.model.resetImportSource(q[n]);if(p){O.removeItem(m.tablesSrc[p],q[n]);}n++;if(n<o){t={did:q[n]};m.removeEMMASourceTable(l,t);}else{if(u&&u.success){u.success();}if(u&&u.complete){u.complete();}}},failure:function(w){if(u&&u.failure){u.failure(w);}}};if(n<o){t={did:q[n]};m.removeEMMASourceTable(l,t);}}function g(n,q,x,u){var t=this;var l=this.model.cubeID;var p=n.getFileName(q.idx);var o={msgID:t.dataService.messageID,tableID:u,__index:q.idx,fileName:p};var m={failure:function(z){var AA=t.getImportController().handleImportError(z,p);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,AA);},complete:function(){mstrApp.hideProgress();}};var w=function(){var z=q.files[q.idx];z.cancelled=true;if(z.tableID&&z.toDel){t.model.resetImportSource(z.tableID);t.removeEMMASourceTable(null,{did:z.tableID});}x.success&&x.success();};if(l){o.reportid=l;}o.behaviorFlags=k.importBehaviorFlag.reserved;if(this.model.operationMode===k.operationMode.refresh||this.model.operationMode===k.operationMode.edit){if(mstrApp.isCloudPro){o.behaviorFlags=k.importBehaviorFlag.newColumnsSilent|k.importBehaviorFlag.dataTypeSilent;}}t.dataService.importFile(n,Z.wrapMethods(m,x,{cancel:w}),o);}function c(n,p,w,AF){var z=this;var x=z.model;var AC=mstrmojo.all[n].tableID;var m;var q={xt:k.xdaType.dataImport};var l=x.getImportSource(AC);w.files[w.idx].tableID=AC;if(l.type===k.sourceType.file&&(l.subtype===k.sourceSubtype.localFile||l.subtype===k.sourceSubtype.clipboard)){var u=p.getFileName(w.idx);w.files[w.idx].fileName=u;g.call(z,p,w,{success:function(){if(AF.success){AF.success();}},failure:function(AG){if(AF.failure){AF.failure(AG);}}},AC);}else{if((l.type===k.sourceType.file&&(l.subtype===k.sourceSubtype.cloudElement||l.subtype===k.sourceSubtype.url||l.subtype===k.sourceSubtype.samplefile||l.subtype===k.sourceSubtype.publicData))||l.type===k.sourceType.hadoop){w.files[w.idx].fileName=p.getFileUrl(w.idx);l.originTableInfo={};var o=l.sourceInfo;var t=o&&o.url;var AE=o&&o.sheetIndex;var AB=o&&o.dbRoleId;if(l.subtype===k.sourceSubtype.cloudElement||l.subtype===k.sourceSubtype.url){var AA=p.getFileUrl(w.idx);w.files[w.idx].isSDKBased=AA&&AA.indexOf(K)>-1;l.originTableInfo=mstrmojo.hash.copy(l.originTableInfo,{url:t,shtIx:AE,dbRoleId:AB,fileType:o&&o.filet});}q.isUrl=true;q.url=p.getFileUrl(w.idx);if(l.type===k.sourceType.hadoop){q.fileType=B(p,q.url);var AD=q.url.match(/.+\?hdfsURL=(.+)/);q.url=AD?AD[1]:q.url;q.xt=N(q.fileType);l.originTableInfo=mstrmojo.hash.copy(l.originTableInfo,{fileType:o&&o.filet,url:t,xt:l.xdaType});}if(p.tableidx){l.set("tableIdx",p.getUrlTableIndices(w.idx));l.set("currentIndex",p.getUrlTableIndices(w.idx));q.shtIx=l.tableIdx;}if(p.getFileUrlDBRole){m=p.getFileUrlDBRole(w.idx);}if((l.subtype===k.sourceSubtype.url||l.subtype===k.sourceSubtype.cloudElement)&&m){z.getDataService().setDBRole({success:function(){l.dbRoleId=m;z.setDataImportInfoURL(AF,q,AC);},failure:function(AG){if(AF.failure){AF.failure(AG);}}},{tbid:AC,dbrid:m});}else{z.setDataImportInfoURL(AF,q,AC);}}}}function f(m,o,t,AA,n){var w=this;var u=w.model;var p={success:function(AB){var AD=AB.msgid;var AC=AB.tbid;if(AD){w.dataService.set("messageID",AD);}var AE=u.createImportSource(k.sourceType.file,n,AC);var AF=o.getFileName(t.idx);t.files[t.idx].tableID=AC;t.files[t.idx].toDel=true;AE.set("fileName",W.getAbsoluteFileName(AF));W.setTablesrc(w,m,AC);g.call(w,o,t,AA,AC);},failure:function(AB){if(AA&&AA.failure){AA.failure(AB);}}};var q={xt:k.xdaType.dataImport,dict:W.getBackendSourceType(n)};if(o.getFileTableID(t.idx)){if(AA.success){AA.success();}if(AA.complete){AA.complete();}return ;}if(!t.files[t.idx]){t.files[t.idx]={};}if(t.idx===0&&mstrmojo.all[m].tableID){c.call(w,m,o,t,AA);return ;}if(n===k.sourceSubtype.localFile){t.files[t.idx].fileName=o.getFileName(t.idx);w.dataService.createEMMASourceTable(p,q);}else{if(n===k.sourceSubtype.url||n===k.sourceSubtype.samplefile||n===k.sourceSubtype.publicData||n===k.sourceSubtype.cloudElement){var x=o.getFileUrl(t.idx);var z;t.files[t.idx].fileName=x;t.files[t.idx].isSDKBased=x&&x.indexOf(K)>-1;q.isUrl=true;q.url=x;q.fileType=B(o,q.url);if(mstrmojo.all[m].scriptClass==="mstrmojo.DI.DIHadoop"){q.xt=N(q.fileType);q.url=x.match(/.+\?hdfsURL=(.+)/);q.url=q.url?q.url[1]:x;}if(o.getFileUrlDBRole){z=o.getFileUrlDBRole(t.idx);}if(z===null){z=w.hadoopController.dbRoleID;}var l={success:function(AC){var AE=AC.msgid;var AD=AC.tbid;q.tbid=AD;if(AE){w.dataService.set("messageID",AE);}W.setTablesrc(w,m,AD);function AB(){var AF=u.createImportSource(k.sourceType.file,n,AD);var AG=o.getFileUrl(t.idx);t.files[t.idx].tableID=AD;t.files[t.idx].toDel=true;if(z){AF.dbRoleId=z;}AF.set("fileName",AG);if(o.tableidx){AF.set("tableIdx",o.getUrlTableIndices(t.idx));AF.set("currentIndex",o.getUrlTableIndices(t.idx));q.shtIx=AF.tableIdx;}AF.fileType=q.fileType;w.setDataImportInfoURL(AA,q,AD);}if(z){w.getDataService().setDBRole({success:function(){AB();},failure:function(AF){if(AA.failure){AA.failure(AF);}}},{tbid:AD,dbrid:z});}else{AB();}}};if(C.startsWith(q.url,K)&&n!==k.sourceSubtype.cloudElement){q.dict=k.backendSourceSubtype.newConnector;}w.dataService.createEMMASourceTable(l,q);}}}function S(l,p,t,z,n,x){var w=this;var m=p.getFilesCnt();var q={idx:0,files:{}};function u(){var AE=[],AF=[],AG=[],AD=0,AC;mstrmojo.hash.forEach(q.files,function(AI,AH){if(AI.failed===true){AE.push(AH);if(AI.tableID&&AI.toDel){AF.push(AI.tableID);w.model.resetImportSource(AI.tableID);}}else{if(AI.tableID){AG.push(AI.tableID);}}});AC=AG.length;var AA={success:function(){AD++;if(AD>=AC){if(AE.length>0){if(x&&x.failure){x.failure(q);}}else{if(x&&x.success){x.success(q);}}}},failure:function(){w.displayError(mstrmojo.desc(12897,"RS detection failure."));},complete:function(){if(AD>=AC){if(x&&x.complete){x.complete();}}}};var AB={success:function(AH){if(AH&&AH.msgid){w.dataService.set("messageID",AH.msgid);}if(AG.length>0){O.forEach(AG,function(AI){w.dataService.detectRelationshipSourceTable(AA,{did:AI});});}else{AA.success();}},failure:function(){w.displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),true);}};if(AF.length>0){w.removeEMMASourceTable(AB,{did:AF.join()});}else{AB.success();}}var o={success:function(AA){if(AA&&AA.msgid){w.dataService.set("messageID",AA.msgid);}q.idx++;if(q.idx<m){f.call(w,l,p,q,o,n);}else{u();}},failure:function(AA){q.files[q.idx].failed=true;q.files[q.idx].errRes=AA;q.idx++;if(q.idx<m){f.call(w,l,p,q,o,n);}else{u();}}};if(m>0){f.call(w,l,p,q,o,n);}else{if(x&&x.success){x.success(q);}if(x&&x.complete){x.complete();}}}function E(l){var m,n,o;for(m in l){o=l[m].sheetsInfo;if(this.model.operationMode===k.operationMode.edit){if(l[m].sourceInfo){continue;}}if(l[m].subtype===k.sourceSubtype.localFile){if(!o){return false;}if(o.length===0){if(!l[m].isAutoMapped){return false;}}for(n=0;n<o.length;n++){if(!o[n].isAutoMapped&&o[n].selected){return false;}}}else{if(l[m].subtype===k.sourceSubtype.url||l[m].subtype===k.sourceSubtype.samplefile||l[m].subtype===k.sourceSubtype.publicData||l[m].subtype===k.sourceSubtype.cloudElement){if(!o){return false;}if(o.length===0){if(!l[m].isAutoMapped){return false;}}for(n=0;n<o.length;n++){if(!o[n].isAutoMapped&&o[n].selected){return false;}}}}}return true;}function L(m){var o,q,u,t,l,n=k.sourceSubtype,p=[];for(o in m){t=m[o];u=t.sheetsInfo;l=t.subtype;switch(l){case n.localFile:case n.url:case n.samplefile:case n.publicData:case n.hadoop:case n.cloudElement:if(!u){break;}if(u.length===0){if(!t.isAutoMapped){p.push(o);break;}}for(q=0;q<u.length;q++){if(!u[q].isAutoMapped&&u[q].selected&&u[q].is1stSheetAutoMapped!==true){p.push(o);break;}}break;}}return p;}function A(t,m){var l=this,o=l.model,p,q;p=mstrmojo.all[t]&&mstrmojo.all[t].tableID||m.files[m.idx-1]&&m.files[m.idx-1].tableID;q=o.getImportSource(p);if(q&&q.type===k.sourceType.hadoop){l.setDataImportInfoURL({},mstrmojo.hash.copy(q.originTableInfo,{isUrl:true}),p);}else{var n=q&&q.originTableInfo;if(n&&n.dbRoleId){l.getDataService().setDBRole({success:function(){l.setDataImportInfoURL({},mstrmojo.hash.copy(n,{isUrl:true}),p);},failure:function(u){console.log("revert dbrole on table failed with details:"+u);}},{tbid:p,dbrid:q.originTableInfo.dbRoleId});}else{if(n){l.setDataImportInfoURL({},mstrmojo.hash.copy(n,{isUrl:true}),p);}}}}function e(p,m,o,l,u){var q=this;p.idx=0;var w=true;var x=[];var n=function(){var AC=q.model;var AA=AC.importSources,AB,AD=[];var z=E.call(q,AA);if(z){if(AC.operationMode===k.operationMode.create){for(AB in AA){AD.push(AB);}}else{for(AB in AA){if(!AA[AB].sourceInfo){AD.push(AB);}}}q.detectRelationshipSourceTable(null,AD,o);}else{if(w){q.showSheetsSelectionDialog(x,o,null,l,z,t);w=false;}}};var t={success:function(){if(p.files[p.idx]){x.push(p.files[p.idx].tableID);}p.idx++;if(!u&&p.idx<m){q.getSheetsInfo(t,p.files[p.idx].tableID,k.requestFlag.sheets|0,o,p);}else{var AA=[];var z=false;mstrmojo.hash.forEach(p.files,function(AD){if(AD.failed){z=true;AA.push(AD.tableID);}});if(z){var AC={success:function(){q.tablesSrc[l]=[];Q.call(q,p,n);for(var AD in p.files){if(p.files[AD].failed){delete p.files[AD];}}}};Y.call(q,AA,AC,l);}else{if(w){var AB=L.call(q,q.model.importSources);q.showSheetsSelectionDialog(AB,o,null,l,p,t);w=false;}}}},failure:function(){p.idx++;var AB=q.model.operationMode,z=mstrmojo.all[l]&&mstrmojo.all[l].tableID?true:false;if(AB===k.operationMode.create||(AB===k.operationMode.edit&&!z)){if(p.idx<m){q.getSheetsInfo(t,p.files[p.idx].tableID,k.requestFlag.sheets|0,o,p);}else{var AC=[];var AA=true;mstrmojo.hash.forEach(p.files,function(AE){if(AE.failed){AC.push(AE.tableID);}else{AA=false;}});var AD={success:function(){if(AA){F.call(q,p);A.call(q,l,p);}else{q.tablesSrc[l]=[];Q.call(q,p,n);for(var AE in p.files){if(p.files[AE].failed){delete p.files[AE];}}}}};if(mstrmojo.all[l]&&!mstrmojo.all[l].tableID){Y.call(q,AC,AD,l);}else{AD.success();}}}else{F.call(q,p);A.call(q,l,p);}},complete:mstrmojo.emptyFn};q.getSheetsInfo(t,p.files[p.idx].tableID,k.requestFlag.sheets|0,o,p);}function j(AD,p,q,z,AC,u){var t=mstrApp.getRootController(),AA=t.dataService,m=[],o=0,x=[],w=[],n=[];function l(AF,AH){var AG=mstrmojo.hash.copy(AD,{shtIx:AF.idx});if(AF.tableID){AG.tbid=AF.tableID;}else{AG.srctbid=z;AG.xt=p;}if(m.length>1){AG.behaviorFlags=k.behaviorChangeFlag.multiSheet;}AA.autoMappingSourceTable(AH,AG);}function AB(){mstrApp.hideProgress();if(n.length>0){x=x.concat(w);}if(x.length>0){if(!u){AA.removeEMMASourceTable({success:function(){if(AC.success){if(w.length>0){AC.success({tableIDs:w});}else{AC.failure({tableIDs:null,res:n[0]});}}if(AC.complete){AC.complete();}},failure:function(AF){if(AC.failure){AC.failure(AF);}if(AC.complete){AC.complete();}}},{did:x.join()});}else{if(AC.failure){AC.failure(n[0]);}if(AC.complete){AC.complete();}}}else{if(AC.success){AC.success({tableIDs:w});}if(AC.complete){AC.complete();}}}var AE={success:function(AF){if(AF&&AF.tbid){w.push(AF.tbid);}else{w.push(z);}},failure:function(AF){if(m[o].tableID){x.push(m[o].tableID);}n.push(AF);},complete:function(){o++;if(o<m.length){l(m[o],AE);}else{AB();}}};O.forEach(q,function(AF){if(AF.selected){m.push(AF);}});if(m.length<=0){AA.removeEMMASourceTable(AC,{did:z});}else{mstrApp.showProgress();m[0].tableID=z;l(m[0],AE);}}function U(m){var n=m.code;var o=m.message;if(n===null||n===undefined){o=m.getResponseHeader("X-MSTR-TaskFailureMsg");}var p=o.indexOf("("),l=o.lastIndexOf(")");if(p>=0&&l>p){o=o.substring(p+1,l);}return o;}function R(n){var m=this;var l=[];var p=[];var o=m.rootView.currentPage;var t="<ul>";var q=false;mstrmojo.hash.forEach(n.files,function(z,x){var AB=z.fileName;if(z.failed===true){l.push(AB);if(z.isSDKBased){q=z.isSDKBased;var AA=K.length;var u=AB.indexOf(G)-1;AB=AB.substring(AA,u);}var w=(typeof z.errRes==="string"||z.errRes instanceof String)?z.errRes:U(z.errRes);t+="<li>"+C.htmlAngles(AB)+"<br>"+C.htmlAngles(w)||" </li>";}else{p.push(AB);}});t+="</ul>";o.set("forceEnable",p.length>0?true:false);if(o.setFilesObject){o.setFilesObject(l);}if(q&&p.length===0){if(m.dialogController.pageZIndex>0){m.rootView.parent.close();}}return t;}function F(m){var l=this;var n=R.call(l,m);l.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,n);}function Q(m,p,o){var l=this;var q=R.call(l,m);var n={detailErrorMessage:q,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:o};l.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),p,n);}function d(p,n,o){var l=this,t=false,q,m;if(p===k.operationMode.edit&&n===k.sourceSubtype.url&&o){q=l.model.importSources[o];m=q.sourceInfo.partition;t=!!m&&m.isPartition&&q.xdaType===k.xdaType.text;}return t;}function h(l,t,AA,AD,n,x){var AB=this;var m=t.getFilesCnt();var z={idx:0,files:{}};var o=AB.model.operationMode,AC=false;if(mstrmojo.DI.DIHelpers.isOperationMode(mstrmojo.all[l].operationMode)){o=mstrmojo.all[l].operationMode;}var q={success:function(AE){if(AE&&AE.msgid){AB.dataService.set("messageID",AE.msgid);}z.idx++;if(!AC&&z.idx<m){f.call(AB,l,t,z,q,n);}else{z=V(z);m=z.idx;if(m>0){e.call(AB,z,m,x,l,AC);}}},failure:function(AF){var AE=z.files[z.idx];AE.failed=true;AE.errRes=AF;z.idx++;if(!AC&&AE.tableID&&AE.toDel){AB.model.resetImportSource(AE.tableID);AB.removeEMMASourceTable(null,{did:AE.tableID});}mstrApp.hideProgress();var AG=AB.getImportController().handleImportError(AF);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,AG);if(!AC&&z.idx<m){f.call(AB,l,t,z,q,n);}}};if(m>0){AC=d.call(AB,o,n,mstrmojo.all[l].tableID);if(AC){I.call(AB,l,t,z,q,n);}else{f.call(AB,l,t,z,q,n);}}else{if(AB.model.getAllTableID().length>0){var w=AB.model.importSources;var p=[];for(var u in w){p.push(u);}if(E.call(AB,AB.model.importSources)){AB.detectRelationshipSourceTable(null,p,x);}else{AB.showSheetsSelectionDialog(p,x,null,l);}}}}function I(AC,w,z,p,q){var t=this,l=mstrmojo.all[AC].tableID,u,AF=w.getFilesCnt(),AA,AB=[],o,AE={xt:k.xdaType.dataImport},AG,x,m=t.model,n;function AD(AH){t.getDataService().setDBRole({success:function(){x.dbRoleId=n;AH();},failure:function(AI){u.failure(AI);}},{tbid:l,dbrid:n});}if(!z.files[z.idx]){z.files[z.idx]={};}AG=w.getFileUrl(z.idx);z.files[z.idx].fileName=AG;z.files[z.idx].tableID=l;x=m.getImportSource(l);u={success:function(AH){var AI=AH.msgid;if(AI){t.dataService.set("messageID",AI);}if(x&&!x.fileName){x.set("fileName",AG);}AE.isUrl=true;AE.url=AG;t.setDataImportInfoURL(p,AE,l);},failure:function(){mstrApp.hideProgress();t.displayError(mstrmojo.desc(12392,"Encounter error when set partition!"));}};for(AA=0;AA<AF;AA++){o=w.getFileUrl(AA);AB.push(o);}n=w.getFileUrlDBRole(0);if(AB.length>1){mstrmojo.confirm(mstrmojo.desc(14708,"Do you want to group these files into a single partition table?"),{confirmBtn:{fn:function(){if(n){AD(function(){t.partitionController.setPartitionURL(l,AB,u);});}else{t.partitionController.setPartitionURL(l,AB,u);}}}});}else{if(n){AD(function(){t.partitionController.setPartitionURL(l,AB,u);});}else{t.partitionController.setPartitionURL(l,AB,u);}}}mstrmojo.DI.controller.ImportController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.ImportController",importMultiOAuthReports:function(l,AE,n,p){var AA=mstrApp.getRootController();var m=AA.getModel();var x=m.externalSources[l];var AD=x.getSourceInfoParam(true);var q=null;var AC=0,o=null;var AB=[];var AH=[];function z(){if(p.failure){p.failure({reports:n,status:AB});}if(p.complete){p.complete();}}function AF(){if(p.success){p.success({reports:n,status:AB});}if(p.complete){p.complete();}}function t(AI,AK){var AJ=mstrmojo.hash.copy(AD,{reportAddress:AI.query,reportDesc:AI.desc===undefined?"":AI.desc,reportMimetype:AI.type===undefined?"":AI.type,reportName:AI.n});if(AI.tableID){AJ.tbid=AI.tableID;}else{AJ.xt=q;}if(AI.max){AJ.reportMax=AI.max;}AJ.dict=W.getBackendSourceType(AE);AA.dataService.autoMappingSourceTable(AK,AJ);}var AG={success:function(){if(AH.length>0){z();}else{AF();}}};function u(){var AL=[],AJ=0,AK;var AI={success:function(){AJ++;if(AJ>=AK&&AG.success){AG.success();}},failure:function(AM){AA.displayError(mstrmojo.desc(12901,"RS detection error."),false,AM.message);},complete:function(){if(AJ>=AK&&AG.complete){AG.complete();}}};mstrmojo.array.forEach(AB,function(AN,AM){if(AN.success){AL.push(AN.tableID);}else{AH.push(AM);}});mstrApp.hideProgress();AK=AL.length;if(AL.length>0){O.forEach(AL,function(AM){AA.dataService.detectRelationshipSourceTable(AI,{did:AM});});}else{z();}}var w={success:function(AI){o={success:true};if(AI&&AI.tbid){o.tableID=AI.tbid;}else{o.tableID=n[AC].tableID;}AB.push(o);},failure:function(AI){o={success:false,errCode:AI.code,errMsg:AI.message};AB.push(o);},complete:function(){AC++;if(AC>=n.length){u();}else{t(n[AC],w);}}};AD.behaviorFlags=k.importBehaviorFlag.reserved;if(m.operationMode===k.operationMode.refresh||m.operationMode===k.operationMode.edit){if(mstrApp.isCloudPro){AD.behaviorFlags=k.importBehaviorFlag.newColumnsSilent|k.importBehaviorFlag.dataTypeSilent;}}if(!n||n.length<=0){AF();return ;}switch(l){case k.sourceType.googleDrive:q=J.dataImportOAuthGDrive;break;case k.sourceType.dropbox:q=J.dataImportOAuthDropbox;break;case k.sourceType.salesforce:q=J.dataImportOAuthSalesforce;break;case k.sourceType.googleAnalytics:q=J.dataImportOAuthGAnalytics;break;case k.sourceType.googleBigQuery:q=J.dataImportOAuthGBigQuery;break;case k.sourceType.twitter:q=J.twitter;break;case k.sourceType.facebook:q=J.facebook;break;}if(q===null){return ;}mstrApp.showProgress();t(n[0],w);},refreshDataOAuthReport:function(z,AD,x,q,o,AC){var u=mstrApp.getRootController(),t=u.getModel(),AB=u.dataService,AE=t.externalSources[z],AF=AE&&AE.getSourceInfoParam(true),p,l;function AA(AG){if(AC.failure){AC.failure(AG);}if(AC.complete){AC.complete();}}function n(){AB.detectRelationshipSourceTable(AC,{did:x});}var w={success:function(){n();},failure:function(AG){AA(AG);}};if(!AE||!q||!x){AA();}var m={success:function(){p=mstrmojo.hash.copy(AF,{behaviorFlags:k.behaviorChangeFlag.refreshData,reportAddress:q.query,reportDesc:q.desc,reportMimetype:q.type,reportName:q.n,reportMax:q.max===undefined?"":q.max,dict:W.getBackendSourceType(AD),tbid:x});AB.autoMappingSourceTable(w,p);},failure:function(AG){AA(AG);}};l=t.getImportSource(x);if(l.sourceInfo.isRefined){p=mstrmojo.hash.copy(AF,{reportAddress:q.query,reportDesc:q.desc,reportMimetype:q.type,reportName:q.n,tbid:x});AB.setDataImportInfo(m,p);}else{m.success();}},importMultiFBReports:function(m,AE,o,p){var z=mstrApp.getRootController(),n=z.getModel(),AB=z.dataService,w=n.externalSources[m],AD=w.getSourceInfoParam(true),q=k.xdaType.facebook,AH={},l=[],AA=[],AG,AC=0,t;function x(){if(p.failure){p.failure({reports:o});}if(p.complete){p.complete();}}function AF(){if(p.success){p.success({reports:o,status:AA});}if(p.complete){p.complete();}}var AI={success:function(){var AJ={success:true};AA.push(AJ);AC++;if(t&&AC>=t.length){AF();}},failure:function(AJ){var AK={success:false,errCode:AJ.code,errMsg:AJ.message};AA.push(AK);}};var u={success:function(AJ){t=AJ&&AJ.tbids;if(t.length>0){O.forEach(t,function(AK){z.dataService.detectRelationshipSourceTable(AI,{did:AK.tbid});});}else{x();}},failure:function(AJ){var AK={success:false,errCode:AJ.code,errMsg:AJ.message};AA.push(AK);x();}};O.forEach(o,function(AJ){l.push({reportName:AJ.n,reportAddress:AJ.query,reportMimetype:AJ.type===undefined?"":AJ.type,reportDesc:AJ.desc===undefined?"":AJ.desc});});AH.reports=l;AG=mstrmojo.hash.copy(AD,{xt:q,hasMultiOAuth:true,multiOAuthReports:JSON.stringify(AH),dict:W.getBackendSourceType(AE)});AB.autoMappingSourceTable(u,AG);},importMultiOAuthFileReports:function(l,AG,n,o){var AA=mstrApp.getRootController(),m=AA.getModel(),AC=AA.dataService,x=m.externalSources[l],AF=x&&x.getSourceInfoParam(true),AE=0,AD=null,u=null,w=[],AJ;function AI(){var AK=false,AL=[];O.forEach(n,function(AM){AL.push(AM.status);if(AM.status&&AM.status.success===false){AK=true;}});if(AK){if(o.failure){o.failure({reports:n,status:AL});}}else{if(o.success){o.success({reports:n,status:AL});}}if(o.complete){o.complete();}}function t(AK,AN){var AM={success:function(AO){AK.id=AK.tableID;AK.sheets=AO.sheets;if(AK.sheets.length>0){AK.sheets[0].selected=true;}AK.multiSelection=true;if(AN.success){AN.success();}if(AN.complete){AN.complete();}},failure:function(AO){if(AN.failure){AN.failure(AO);}if(AN.complete){AN.complete();}}};var AL={success:function(AO){if(AO&&AO.tbid){AK.tableID=AO.tbid;}AJ=mstrmojo.hash.copy(AF,{reportAddress:AK.query,reportDesc:AK.desc,reportMimetype:AK.type,reportName:AK.n});a(AJ,AK.tableID,AM);},failure:function(AO){if(AN.failure){AN.failure(AO);}if(AN.complete){AN.complete();}}};AC.createEMMASourceTable(AL,{xt:u,dict:W.getBackendSourceType(AG)});}function q(){var AL=0,AM;mstrApp.showProgress();var AK={success:function(){AL++;if(AL>=AM){AI();}},failure:function(AN){AA.displayError(mstrmojo.desc(12901,"RS detection error."),false,AN.message);},complete:function(){if(AL>=AM){mstrApp.hideProgress();mstrApp.hideProgress();}}};AM=w.length;if(w.length>0){O.forEach(w,function(AN){AC.detectRelationshipSourceTable(AK,{did:AN});});}else{AK.success();AK.complete();}}function z(AK,AL){AJ=mstrmojo.hash.copy(AF,{reportAddress:AK.query,reportDesc:AK.desc,reportMimetype:AK.type,reportName:AK.n});j(AJ,u,AK.sheets,AK.tableID,AL);}var AH={success:function(AK){if(AK.tableIDs&&AK.tableIDs.length>0){w=w.concat(AK.tableIDs);}AE++;if(AE<n.length){AD=n[AE];z(AD,AH);}else{q();}},failure:function(AK){AD.status.success=false;AD.status.errCode=AK&&AK.res&&AK.res.code;AD.status.errMsg=AK&&AK.res&&AK.res.message;AE++;if(AE<n.length){AD=n[AE];z(AD,AH);}else{q();}}};function AB(){mstrApp.showProgress();AE=0;AD=n[AE];AJ=mstrmojo.hash.copy(AF,{reportAddress:AD.query,reportDesc:AD.desc,reportMimetype:AD.type,reportName:AD.n});j(AJ,u,AD.sheets,AD.tableID,AH);}var p={failure:function(AK){AD.status.success=false;AD.status.errCode=AK.code;AD.status.errMsg=AK.message;},complete:function(){var AK=false,AN=[],AM=[],AL;AE++;if(AE<n.length){AD=n[AE];AD.status={success:true};t(AD,p);}else{O.forEach(n,function(AO){if(AO.sheets&&AO.sheets.length>1){AK=true;AM.push(AO);}else{AN.push(AO);}});if(AK){AL={items:AM,onOK:function(){n=this.items?this.items.concat(AN):AN;this.close();AB();},onBack:function(){var AO=[];O.forEach(n,function(AP){if(AP.tableID){AO.push(AP.tableID);}});if(AO.length>0){AA.dataService.removeEMMASourceTable(null,{did:AO.join()});}}};AA.showDialog(k.dialogType.sheetsSelectionDialog,AL);}else{AB();}}}};if(!x||!n||n.length<=0){AI();return ;}switch(l){case k.sourceType.googleDrive:u=J.dataImportOAuthGDrive;break;case k.sourceType.dropbox:u=J.dataImportOAuthDropbox;break;}if(u===null){return ;}AD=n[AE];AD.status={success:true};t(AD,p);},refreshDataOAuthFileReport:function(z,AD,x,t,n,AC){var w=mstrApp.getRootController(),AB=w.dataService,AE=w.getModel().externalSources[z],l=null,AF=AE&&AE.getSourceInfoParam(true),m=w.getModel().getImportSource(x),q=mstrmojo.hash.copy(AF,{reportAddress:t.query,reportDesc:t.desc,reportMimetype:t.type,reportName:t.n});function AA(AG){if(AC.failure){AC.failure(AG);}if(AC.complete){AC.complete();}}var p={success:function(){AB.detectRelationshipSourceTable(AC,{did:x});},failure:function(AG){AA(AG);}};function u(){j(mstrmojo.hash.copy(q,{behaviorFlags:k.behaviorChangeFlag.refreshData}),l,t.sheets,x,p,true);}var o={success:function(AI){var AH,AG;t.sheets=AI.sheets;t.multiSelection=false;t.defaultSheetsIndex=0;if(m&&m.sourceInfo){AG=O.find(AI.sheets,"idx",m.sourceInfo.sheetIndex);if(AG>-1){t.defaultSheetsIndex=AG;}}if(t.sheets.length>1){AH={items:[t],onOK:function(){t=this.items[0];this.close();u();}};w.showDialog(k.dialogType.sheetsSelectionDialog,AH);}else{t.sheets[0].selected=true;u();}},failure:function(AG){AA(AG);}};switch(z){case k.sourceType.googleDrive:l=J.dataImportOAuthGDrive;break;case k.sourceType.dropbox:l=J.dataImportOAuthDropbox;break;}if(l===null){return ;}if(m){if(!m.isExtensionValid(t.n)){w.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}}a(q,x,o);},importProjects:function(u,p,q){var l=mstrApp.getRootController(),t=l.dataService,o=null;function n(x){var w={code:x.code,message:x.message};if(o){t.removeEMMASourceTable({success:function(){if(u.failure){u.failure(w);}if(u.complete){u.canceled();}},failure:function(z){l.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,z.message);}},{did:o});}else{if(u.failure){u.failure(w);}if(u.complete){u.complete();}}}var m={success:function(w){if(w&&w.tbid){o=w.tbid;}if(u.success){u.success(w);}},failure:function(w){n(w);}};t.createEMMASourceTable(m,{xt:k.xdaType.projectsImport,dbrId:p,cubeId:q});},importClipboard:function(m,x){var p=mstrApp.getRootController(),t=p.dataService,q=null,n=m.uploader;function u(AA){var z={code:AA.code,message:AA.message};if(q){t.removeEMMASourceTable({success:function(){if(x.failure){x.failure(z);}if(x.complete){x.canceled();}},failure:function(AB){p.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,AB.message);}},{did:q});}else{if(x.failure){x.failure(z);}if(x.complete){x.complete();}}}var o={success:function(){t.detectRelationshipSourceTable(x,{did:q});},failure:function(z){u(z);}};var l={success:function(){t.autoMappingSourceTable(o,{tbid:q,shtIx:0,dlmt:",",qt:'\\"'});},failure:function(z){u(z);},complete:function(){mstrApp.hideProgress();}};var w={success:function(z){if(z&&z.tbid){q=z.tbid;}t.importFile(n,l,{msgID:t.messageID,tableID:q});},failure:function(z){u(z);}};t.createEMMASourceTable(w,{xt:k.xdaType.dataImport,dict:k.backendSourceSubtype.clipboard});},refreshDataClipboard:function(t,n,m,x){var q=mstrApp.getRootController(),u=q.dataService,o=n.uploader;function w(z){if(x.failure){x.failure(z);}if(x.complete){x.complete();}}var p={success:function(){u.detectRelationshipSourceTable(x,{did:t});},failure:function(z){w(z);}};var l={success:function(){u.autoMappingSourceTable(p,{tbid:t,shtIx:0,behaviorFlags:k.behaviorChangeFlag.refreshData});},failure:function(z){w(z);},complete:function(){mstrApp.hideProgress();}};u.importFile(o,l,{msgID:u.messageID,tableID:t});},handleImportError:function P(w,q){var t=w.code,AB=w.message;if(t===undefined||t===null){t=parseInt(w.getResponseHeader("X-MSTR-TaskErrorCode"),10);AB=w.getResponseHeader("X-MSTR-TaskFailureMsg");}var u=mstrApp.getRootController();var n=u.model;if(t===k.backendError.cubeQuotaReached){AB=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");}else{if(t===k.backendError.fileVersionError){AB=mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher.");}else{if(t===k.backendError.salesforceUnsavedReport){AB=mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!");}else{if(t===k.backendError.emptySheet){AB=mstrmojo.desc(12618,"The import process cannot proceed with an empty sheet.");}else{if(t===k.backendError.salesforceUnresolvedFilter){AB=mstrmojo.desc(12789,"You cannot import a Salesforce report with any unresolved filters.");}else{if(t===k.backendError.noExternalSourceInfo){var l=AB.indexOf("Google Analytics");var p=AB.indexOf("\t");AB=AB.substring(l,p);}else{if(t===k.backendError.switchingFileType){AB=mstrmojo.desc(12790,"Switching the source file type between Excel, CSV and Text is not allowed. You had previously used ####. Please use the same file type.").replace("####",n.currentSource.sourceInfo.name);}else{if(t===k.backendError.memoryConsumptionExceeded){var o="";if(AB.indexOf("Max memory size limit: ")>-1){var z=AB.indexOf("Max memory size limit: ")+23;var x=AB.indexOf(".",z);o="("+AB.substring(z,x)+") ";}AB=mstrmojo.desc(12791,"Memory consumption limit during data fetching #### is exceeded.").replace("####",o);}else{if(t===k.backendError.switchingFileType){AB=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");}else{if(t===k.backendError.unsupportedFileFormat){AB=mstrmojo.desc(12619,"Only UTF 8/16 CSV or text files are supported. Save the file as UTF or 16 codepage and import again.");}}}}}}}}}}var AA="<ul><li>"+q+"<br>"+AB||U(w)+"</li></ul>";return AA;},importFile:function b(p,t,AC,AA,l,m,q){var z=mstrApp.getRootController();var x,w,u=null;var o={success:function(){var AF=z.model.getAllTableID();if(l){z.tablesSrc[l]=[];for(w=0;w<AF.length;w++){if(O.indexOf(x,AF[w])===-1){z.tablesSrc[l].push(AF[w]);}}if(u&&u.length){for(w=0;w<AF.length;w++){z.navigationController.deleteRoute(u[w]);}}}var AD=k.requestFlag.mapping|k.requestFlag.sourceInfo|k.requestFlag.relationship,AE=AC?0:-1;z.getImportedDataEMMA(M.importSource,AD,AE);},failure:function(AD){F.call(z,AD);},complete:function(){mstrApp.hideProgress();}};var AB={success:function(AD){if(AD&&AD.msgid){z.dataService.set("messageID",AD.msgid);}if(m){h.call(z,l,p,t,AC,k.sourceSubtype.localFile,q);}else{S.call(z,l,p,t,AC,k.sourceSubtype.localFile,o);}},failure:function(AD){z.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,AD.message||"");}};var n={success:function(){x=z.model.getAllTableID();if(AA){z.createNewReportInstance(AB);}else{if(m){h.call(z,l,p,t,AC,k.sourceSubtype.localFile,q);}else{S.call(z,l,p,t,AC,k.sourceSubtype.localFile,o);}}},failure:function(){z.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(l){u=[];for(w=0;z.tablesSrc[l]&&w<z.tablesSrc[l].length;w++){if(z.model.getImportSource(z.tablesSrc[l][w])){u.push(z.tablesSrc[l][w]);}}Y.call(z,u,n,l);}else{n.success();}},importURL:function H(o,l,AD,AB,m,n,t){var z=mstrApp.getRootController();var x,w,u;var AA=k.sourceSubtype.url;if(o.scriptClass==="mstrmojo.DI.DISampleFiles"){AA=k.sourceSubtype.samplefile;}if(o.scriptClass==="mstrmojo.DI.DIPublicData"){AA=k.sourceSubtype.publicData;}if(mstrmojo.all[m].isFromCloudElement){AA=k.sourceSubtype.cloudElement;}var q={success:function(){var AG=z.model.getAllTableID();if(m){z.tablesSrc[m]=[];for(w=0;w<AG.length;w++){if(O.indexOf(x,AG[w])===-1){z.tablesSrc[m].push(AG[w]);}}if(u&&u.length){for(w=0;w<AG.length;w++){z.navigationController.deleteRoute(u[w]);}}}var AE=k.requestFlag.mapping|k.requestFlag.sourceInfo|k.requestFlag.relationship,AF=AD?0:-1,AH;AH={onOK:function(){z.getImportedDataEMMA(M.importSource,AE,AF);},onCancel:function(AI){z.getImportedDataEMMA(M.importSource,AE,AF,undefined,undefined,undefined,undefined,AI);}};if(!z.rootView.currentPage.tableID){z.autoDetectPartitionGroups(AH,AF);}else{z.getImportedDataEMMA(M.importSource,AE,AF);}},failure:function(AE){F.call(z,AE);}};var AC={success:function(AE){if(AE&&AE.msgid){z.dataService.set("messageID",AE.msgid);}h.call(z,m,o,l,AD,AA,t);},failure:function(AE){z.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,AE.message||"");}};var p={success:function(){x=z.model.getAllTableID();if(AB){z.createNewReportInstance(AC);}else{if(n){h.call(z,m,o,l,AD,AA,t);}else{S.call(z,m,o,l,AD,AA,q);}}},failure:function(){z.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(m){u=[];for(w=0;z.tablesSrc[m]&&w<z.tablesSrc[m].length;w++){if(z.model.getImportSource(z.tablesSrc[m][w])){u.push(z.tablesSrc[m][w]);}}Y.call(z,u,p,m);}else{p.success();}},removeMultipleSourceTables:function D(m){var l=mstrApp.getRootController();var n={success:function(){},failure:function(){l.displayError(mstrmojo.desc(12904,"Failed to remove 1 or more tables"));}};Y.call(l,m,n);},importFromCube:function(m,n){var l=mstrApp.getRootController();l.getDataService().getImportFromCube(n,{did:m});},refreshDataLocalFile:function(u,o,n,z){var t=mstrApp.getRootController(),x=t.dataService,p=o.uploader,l=t.getModel().getImportSource(u);function w(AA){if(z.failure){z.failure(AA);}if(z.complete){z.complete();}}var q={success:function(){x.detectRelationshipSourceTable(z,{did:u});},failure:function(AA){w(AA);}};var m={success:function(){x.autoMappingSourceTable(q,{tbid:u,shtIx:l.sourceInfo.sheetIndex,behaviorFlags:k.behaviorChangeFlag.refreshData});},failure:function(AA){w(AA);},complete:function(){mstrApp.hideProgress();}};x.importFile(p,m,{msgID:x.messageID,tableID:u,fileName:p.getFileName?p.getFileName():l.name,});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14959,14960,1162,9935,14968,14969,14970,14971,14972,14973,14974,14975,14976,14977,14978,14979,14980,14981,14982,14983,14984,14985,14986,14987,14988,14989,14990,14991,14992,14993,14994,14995,14996,14997,14998,1149,14999);var C=mstrmojo.DI.DIConstants;var B={HGoS_CONFIG_HAS_EXIT:{TITLE:mstrmojo.desc(14968,"Configuration Conflict"),MSG:mstrmojo.desc(14969,"Please specfiy gateway propertoes"),DETAIL:mstrmojo.desc(14970,"Hadoop gateway with same host name and port number already exists;")+"\n"+mstrmojo.desc(14971,"please modify the gateway definition.")},CONNOT_AUTHENTICATE:{TITLE:mstrmojo.desc(14972,"Gateway Authentication Error"),MSG:mstrmojo.desc(14973,"You may solve this problem by checking followings:"),DETAIL:mstrmojo.desc(14974,"1. Username or password is not correct.")+"\n"+mstrmojo.desc(14975,"2. Gateway host is down.")+"\n"+mstrmojo.desc(14976,"3. Network problem (Gateway host is unreachable, firewall blocking, etc.).")+"\n"+mstrmojo.desc(14977,"4. Connection time out.")},SPACE_OVER:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14979,"Insufficient disk space to deploy Hadoop Gateway. Minimum required disk space is 200M.")},FAIL_COPY_TO_HOST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14980,"Unable to copy application files to host. It may be caused by:"),DETAIL:mstrmojo.desc(14981,"1. Insufficient permissions")+"\n"+mstrmojo.desc(14982,"2. Gateway host being down")+"\n"+mstrmojo.desc(14983,"3. Network problem (Gateway host is unreachable, firewall blocking, etc.)")+"\n"+mstrmojo.desc(14984,"4. Connection time out")},INSUFFICIENT:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14985,"Insufficient disk space on host. Minimum required disk space is 200M.")},DIRECTORY_NO_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14997,"Folder '####' does not exist. This may be caused by insufficient permission to create the folder.")},HGOS_DEPLOYED:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14986,"Hadoop Gateway has been already deployed.")},HGOS_DEPLOYING:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14987,"Hadoop Gateway is being deployed. Please wait the operation complete.")},CONNOT_AUTHENTICATE2:{TITLE:mstrmojo.desc(14972,"Gateway Authentication Error"),MSG:mstrmojo.desc(14973,"You may solve this problem by checking followings:"),DETAIL:mstrmojo.desc(14974,"1. Username or password is not correct")+"\n"+mstrmojo.desc(14975,"2. Gateway host is down")+"\n"+mstrmojo.desc(14976,"3. Network problem (Gateway host is unreachable, firewall blocking, etc)")+"\n"+mstrmojo.desc(14977,"4. Connection time out")},HGOS_RUNNING:{TITLE:mstrmojo.desc(14988,"Failed to start Hadoop Gateway"),MSG:mstrmojo.desc(14989,"Hadoop Gateway is already running.")},HGOS_STOPPED:{TITLE:mstrmojo.desc(14990,"Failed to stop Hadoop Gateway"),MSG:mstrmojo.desc(14991,"Hadoop Gateway has already stopped.")},HGOS_NOT_DEPLOYING:{TITLE:mstrmojo.desc(14992,"Failed to start/stop Hadoop Gateway"),MSG:mstrmojo.desc(14993,"Failed to start/ stop Hadoop Gateway. This may be due to Hadoop Gateway not being deployed, or been removed.")},HGOST_TAR_NOT_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14994,"Unable to copy tar file to host. Please make sure that the tar file exists under the folder:")+"\n"+mstrmojo.desc(14999,"[MicroStrategy Install Path]/IntelligenceServer/hgos-manager.")},HGOS_CONF_NOT_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14995,"Hadoop Gateway configuration file is not found.")},DEFAULT:{TITLE:mstrmojo.desc(14996,"Operation failed"),MSG:mstrmojo.desc(15617,"Unknown error.")}};function A(D){return encodeURI(D);}mstrmojo.DI.controller.DIHadoopGatewayController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopGatewayController",submitActions:function(I,J,E){var D=this.rootController||mstrApp.getRootController(),F=D.dataService;var H=this;var G={actions:I,success:function(K,L){if(K&&(typeof (K[0].success)!=="undefined")&&K[0].success===true){J.success(K);}else{if(K&&(typeof (K[0].success)!=="undefined")&&K[0].success===false){H.popUpErrorWin4HGW(K[0],JSON.parse(L.params.json));J.success(K);}else{D.displayError(mstrmojo.desc(null,"IServer returns a invalid result"),false,"");}}},failure:function(K){D.displayError(mstrmojo.desc(null,"Failed to connect to webServer"),false,"");J.failure(K);}};F.DIManageHadoopGateway(G,{json:JSON.stringify(I)},E);},popUpErrorWin4HGW:function(F,J){var E=mstrApp.diRootCtrl,G=F.code||null,I,H,D;switch(G){case C.hadoopGateWay.HGoS_CONFIG_HAS_EXIT:I=B.HGoS_CONFIG_HAS_EXIT.TITLE,H=B.HGoS_CONFIG_HAS_EXIT.MSG,D=B.HGoS_CONFIG_HAS_EXIT.DETAIL;break;case C.hadoopGateWay.CONNOT_AUTHENTICATE:I=B.CONNOT_AUTHENTICATE.TITLE,H=B.CONNOT_AUTHENTICATE.MSG,D=B.CONNOT_AUTHENTICATE.DETAIL;break;case C.hadoopGateWay.SPACE_OVER:I=B.SPACE_OVER.TITLE,H=B.SPACE_OVER.MSG;break;case C.hadoopGateWay.FAIL_COPY_TO_HOST:I=B.FAIL_COPY_TO_HOST.TITLE,H=B.FAIL_COPY_TO_HOST.MSG,D=B.FAIL_COPY_TO_HOST.DETAIL;break;case C.hadoopGateWay.INSUFFICIENT:I=B.INSUFFICIENT.TITLE,H=B.INSUFFICIENT.MSG;break;case C.hadoopGateWay.DIRECTORY_NO_EXIST:I=B.DIRECTORY_NO_EXIST.TITLE;H=B.DIRECTORY_NO_EXIST.MSG.replace("####",J[0]["remoteDir"]);break;case C.hadoopGateWay.HGOS_DEPLOYED:I=B.HGOS_DEPLOYED.TITLE,H=B.HGOS_DEPLOYED.MSG;break;case C.hadoopGateWay.HGOS_DEPLOYING:I=B.HGOS_DEPLOYING.TITLE,H=B.HGOS_DEPLOYING.MSG;break;case C.hadoopGateWay.CONNOT_AUTHENTICATE2:I=B.CONNOT_AUTHENTICATE2.TITLE,H=B.CONNOT_AUTHENTICATE2.MSG,D=B.CONNOT_AUTHENTICATE2.DETAIL;break;case C.hadoopGateWay.HGOS_RUNNING:I=B.HGOS_RUNNING.TITLE,H=B.HGOS_RUNNING.MSG;break;case C.hadoopGateWay.HGOS_STOPPED:I=B.HGOS_STOPPED.TITLE,H=B.HGOS_STOPPED.MSG;break;case C.hadoopGateWay.HGOS_NOT_DEPLOYING:I=B.HGOS_NOT_DEPLOYING.TITLE,H=B.HGOS_NOT_DEPLOYING.MSG;break;case C.hadoopGateWay.HGOST_TAR_NOT_EXIST:I=B.HGOST_TAR_NOT_EXIST.TITLE,H=B.HGOST_TAR_NOT_EXIST.MSG;break;case C.hadoopGateWay.HGOS_CONF_NOT_EXIST:I=B.HGOS_CONF_NOT_EXIST.TITLE,H=B.HGOS_CONF_NOT_EXIST.MSG;break;default:I=B.DEFAULT.TITLE,H=B.DEFAULT.MSG,H=mstrmojo.desc(1149,"Error Code")+" : "+G;break;}E.displayError(H,false,D,null,I);},createGateway:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}if(D.sparkConfig.props["spark.master"]===undefined||D.sparkConfig.props["spark.master"].trim()===""){D.sparkConfig.props["spark.master"]="local[*]";}F.push({path:"hgosmgr/conf/hgos/",method:"POST",body:D});this.submitActions(F,G);},updateSparkConfig:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}if(D.sparkConfig.props["spark.master"]===undefined||D.sparkConfig.props["spark.master"].trim()===""){D.sparkConfig.props["spark.master"]="local[*]";}D.httpPort=4020;F.push({path:"hgosmgr/deploy/update/hgosConf/"+A(D.name),method:"PUT",body:D.passwd});this.submitActions(F,G);},updateGateway:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}D.httpPort=4020;F.push({path:"hgosmgr/conf/hgos/"+A(D.name),method:"PUT",body:D});this.submitActions(F,G);},deleteGateway:function(D,F){var E=[];E.push({path:"hgosmgr/conf/hgos/"+A(D.name),method:"DELETE",body:D});this.submitActions(E,F);},listGateways:function(F,D){var E=[];E.push({path:"hgosmgr/status/hgos",method:"GET"});this.submitActions(E,F,D);},startGateway:function(D,F){var E=[];E.push({path:"hgosmgr/launch/start/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},stopGateway:function(D,F){var E=[];E.push({path:"hgosmgr/launch/stop/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},installGateway:function(D,F){var E=[];E.push({path:"hgosmgr/deploy/install/"+A(D.name),method:"POST",remoteDir:D.remoteDir,body:D.passwd});this.submitActions(E,F);},uninstallGateway:function(D,F){var E=[];E.push({path:"hgosmgr/deploy/uninstall/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},showGatewayListDialog:function(){var D=this.rootController||mstrApp.getRootController();this.listGateways({success:function(E){D.showDialog(C.dialogType.hadoopGatewayManagerDialog,{controller:D,items:E[0].entity});},failure:function(){D.showDialog(C.dialogType.hadoopGatewayManagerDialog,{controller:D});}});},confirmAuthentication:function(H){var D,G,E,F;D={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayDialog-AuthenticationEditor",zIndex:10000,title:mstrmojo.desc(14959,"Gateway Authentication"),visible:true,check:function(){var I=E&&E.length&&F!==undefined;this.btnHbox.children[0].set("enabled",I);},children:[{scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:mstrmojo.desc(14960,"Username:")},{scriptClass:"mstrmojo.TextBox",onvalueChange:function(){E=this.value;this.parent.parent.check();}}]},{scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:mstrmojo.desc(1162,"Password:")},{scriptClass:"mstrmojo.TextBox",type:"password",onvalueChange:function(){F=this.value;this.parent.parent.check();}}]}],buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(9935,"Log In"),function(){H.call(this.parent.parent,E,F);},true,{enabled:false})]};G=new mstrmojo.Editor(D);G.render();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12792,12804);var J=mstrmojo.array,D=mstrmojo.hash,L=mstrmojo.DI.DIConstants,F=mstrmojo.DI.DIConstants.actions;function C(N,M){var O=M;if(N.isMultiForm){if(!M.isMultiForm){O=N;}else{var Q=N.subColumns,P=M.subColumns.concat();J.forEach(Q,function(S){var R=J.find(P,"afid",S.afid);if(R<0){P.push(S);}});O=D.copy(M);O.subColumns=P;}}if(!O.linkedTbs){O.linkedTbs={};O.linkedTbs[M.tableId]=true;O.linkedTbs[N.tableId]=true;}else{O.linkedTbs[N.tableId]=true;}return O;}function A(O){var M=O.initialSet.distInfo,N=O.distInfo;if(M.keyId===N.keyId&&M.pf===N.pf){return null;}else{return N;}}function B(Q){var N=Q.initialSet.sidxes,O=Q.sidxes,R={},M=false;if(O.length<N.length){M=true;}else{J.forEach(N,function P(S){R[S.atid+S.afid]=true;});J.forEach(O,function P(S){if(R[S.atid+S.afid]!==true){M=true;return false;}});}return M?O:null;}mstrmojo.DI.controller.DIAllObjectsViewController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIAllObjectsViewController",controller:null,init:function K(M){this._super(M);this.controller=mstrApp.getRootController();},getAllMappings:function(){var P,O,Q,S,U;var R=[],M=this.controller.model.importSources;for(P in M){Q=M[P];if(Q.currentTransformations&&Q.currentTransformations.xtab&&Q.currentTransformations.xtab.isCrosstab){U=Q.transformedMapping;}else{U=Q.currentMapping;}if(U){for(O=0;U&&O<U.length;O++){S=U[O];var N=mstrmojo.array.find(R,"id",S.id);if(N<0){R.push(mstrmojo.hash.copy(S));}else{R[N]=C(S,R[N]);}}}}return R;},getAllImportSources:function(){return this.controller.model.importSources;},getCubeConfig:function E(){var N=this.controller;var M=N.model;var O={browsetype:L.browseFlag.cubeConfig,previewflag:L.requestFlag.mapping};var P={success:function(Q){M.populateCubeConfig(Q);},failure:function(Q){N.displayError(mstrmojo.desc(12792,"Cannot retrieve cube config info.")+Q);}};N.dataService.getImportedData(P,O);},isCubeConfigEnabled:function G(){var M=this.controller.model;if(mstrApp.isSingleTier){return true;}else{if(M.isDirectDataAccess&&M.weakDDA!==true){return false;}else{return true;}}},persistCubeConfig:function I(S){var O=this.controller,N=A(S),R=B(S),P=[],Q=[],U={};if(!N&&!R){return ;}if(R){J.forEach(R,function(V){P.push(V.atid);Q.push(V.afid);});U.statid=P.join();U.stafid=Q.join();U.stic=true;}if(N){U.keyid=N.keyId;U.n=N.pf;}var M={success:function(){delete S.initialSet;S.initialSet=D.clone(S);O.model.set("isDirectDataAccess",false);var V=L.requestFlag.mapping|L.requestFlag.sourceInfo|L.requestFlag.relationship;O.getImportedDataEMMA(F.none,V);},failure:function(V){var W=mstrmojo.desc(12804,"Persist cube configurations failed:");O.displayError(W,false,V.message);}};O.dataService.persistCubeConfigInfo(M,U);},showAllObjects:function H(){var M=this.controller;M.model.attachEventListener("CubeConfigFetched",this.id,function(){M.showDialog(L.dialogType.allObjectsViewDialog,null);});this.getCubeConfig();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.HBox","mstrmojo.EnumAuthenticationModes","mstrmojo.UsherLogin","mstrmojo.string","mstrmojo.cookies");mstrmojo.requiresDescs(17,18,221,11804,11863);var F=mstrmojo.EnumAuthenticationModes,D={};D[F.LDAP]=mstrmojo.desc(1947,"LDAP Authentication");D[F.DATABASE]=mstrmojo.desc(1948,"Database Authentication");var L={LIVE_OR_HL:0,PERSISTED:1};function B(){return(JSON.parse(decodeURIComponent(mstrmojo.cookies.getCookieSetting("lastMsgID")||"{}")))[mstrConfig.lastMsgKey];}function C(){var Q=this,R=Q.stdLoginInfo,O=R.user.value,N=R.tsvCode.value,S=R.pwd.value,U={taskId:"login",server:mstrConfig.serverName,project:mstrmojo.string.decodeHtmlString(mstrConfig.projectName),port:mstrConfig.serverPort,authMode:mstrConfig.authMode,setAsActiveSession:true};var P=B();if(P){U.msgID=P;}if((this.authMode&(F.STANDARD|F.LDAP|F.DATABASE))>0){U.userid=O;U.password=S;U.tsvCode=N;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(X){if(X&&X.sessionState){mstrApp.updateSessionState(X.sessionState);if(mstrApp.sessionManager){mstrApp.sessionManager.restart();}var a=X;var Z=a.servletState;if(Z){if(mstrApp){mstrApp.servletState=Z;}if(mstrConfig){mstrConfig.servleState=Z;}}var W=X.resCode;if(W==L.LIVE_OR_HL&&(mstrApp.isVI||mstrApp.scriptClass==="mstrmojo.OIVMApp"||mstrApp.analysisID)){mstrmojo.xhr.request("post",mstrConfig.taskURL,{success:function(){var b=Q.config.callback,c=b.success;if(c){c(a);}},failure:function(){mstrmojo.form.send({evt:3010,src:mstrApp.name+".3010"},null,"POST");}},{taskId:"docXMLResults",sessionState:X.sessionState,msgID:X.msgID,resultFlags:33554432});}else{var V=Q.config.callback,Y=V.success;if(Y){Y(a);}}}Q.destroy();},failure:function(V){if(Q.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){Q.set("visible",true);}mstrmojo.alert(V.getResponseHeader("X-MSTR-TaskFailureMsg"),null,null,Q.zIndex);}},U);}function M(){if(mstrApp.sessionManager){mstrApp.sessionManager.gotoLogoutPage();}}mstrmojo.LoginEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.LoginEditor",cssClass:"mstrmojo-LoginEditor",title:mstrmojo.desc(11804,"Log in to"),btnAlignment:"right",help:null,config:{callback:{},taskParams:{}},authMode:F.STANDARD,usherEnabled:false,init:function K(N){this._super(N);this.title+=" "+mstrApp.projectName;this.set("authMode",parseInt(mstrConfig.authMode,10));if(this.isUsherLogin()){mstrmojo.css.addWidgetCssClass(this,"usher");}},isUsherLogin:function(){return this.authMode===F.USHER;},onvisibleChange:function J(){if(this.visible&&(mstrmojo.dom.isFF||mstrmojo.dom.isWK)){var N=this.stdLoginInfo.user;window.setTimeout(function(){N.focus();},50);}},onOpen:function E(){if(this.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){this.set("visible",false);}},onClose:function G(){M();},destroy:function I(){mstrmojo.dom.detachEvent(document.body,"mousedown",this.stopPropagation,true);this._super();},postBuildRendering:function A(){if(this.authMode===mstrmojo.EnumAuthenticationModes.NTCREDENTIAL){C.call(this);return ;}else{var N=this._super();this.stopPropagation=function(O){O.stopPropagation();};mstrmojo.dom.attachEvent(document.body,"mousedown",this.stopPropagation,true);return N;}},preBuildRendering:function H(){if(this.isUsherLogin()){var O=this,N=mstrmojo.insert({scriptClass:"mstrmojo.UsherLogin",alias:"usherLogin",onUsherLogin:function(){mstrConfig.authMode=F.USHER;C.call(O);}});this.addChildren([N],1);}return this._super();},children:[{scriptClass:"mstrmojo.Label",cssText:"margin-bottom: 20px; line-height: 1.5em;",text:mstrmojo.desc(11863,"Your user session has timed out due to inactivity, and you have been automatically logged out. Please log in again.")},{scriptClass:"mstrmojo.Box",alias:"stdLoginInfo",cssClass:"std-login-container",bindings:{visible:function(){return this.parent.authMode!==F.USHER;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"user",cssClass:"login-username",cssDisplay:"block",hint:mstrmojo.desc(17,"User name"),postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(17,"User name");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"pwd",cssClass:"login-pwd",cssDisplay:"block",hint:mstrmojo.desc(18,"Password"),type:"password",postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(18,"Password");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.TextBox",alias:"tsvCode",cssClass:"login-tsvCode",cssDisplay:"block",hint:mstrmojo.desc(13825,"Usher code"),bindings:{visible:function(){return mstrConfig.features["is-two-step-verification-required"];}},postCreate:function(){if(mstrmojo.dom.isIE9||mstrmojo.dom.isIE8||mstrmojo.dom.isIE7){this.emptyText=mstrmojo.desc(13825,"Usher code");}},onEnter:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-LoginEditor-authMode",bindings:{visible:function(){return this.parent.parent.authMode===F.LDAP||this.parent.parent.authMode===F.DATABASE;},text:function(){return D[this.parent.parent.authMode]||"";}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btns",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:mstrmojo.desc(26,"Login"),bindings:{enabled:"this.parent.parent.stdLoginInfo.user.value.length > 0",visible:function(){return this.parent.parent.authMode!==F.USHER;}},onclick:function(){C.call(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){M();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Stepper","mstrmojo._HasLayout","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.expr","mstrmojo.css","mstrmojo.ValidationTextBox");var F=mstrmojo.expr.DTP,G=mstrmojo.css,B=mstrmojo.hash,H=mstrmojo.desc;var D=1000;var E=false;function J(K){return E?K.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):K;}function A(K){return E?parseInt(K.toString().replace(/,/g,""),10):K;}mstrmojo.Refine.RefineValidateStepper=mstrmojo.declare(mstrmojo.Stepper,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineValidateStepper",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,mouseup,mousemove,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text"></div><div class="prev">-</div></div>',vflag:null,layoutConfig:{w:{textNode:"100%"},xt:true},textInput:null,init:function I(K){var L=K.provider;if(!!mstrApp.isWSStyling){this.layoutConfig=null;}this.children=[{scriptClass:"mstrmojo.ValidationTextBox",alias:"textInput",slot:"textNode",dtp:L.dtp||F.INTEGER,cssDisplay:"inline-block",height:"20px",width:"70px",min:1000,max:10000,valueChangeDelay:200,warningTooltip:{cssClass:"vi-regular vi-tooltip-V",invalid:true,position:"TC",top:"0",left:"0",lasting:2000,closeOnClick:true,highlight:true},_isValid:true,onvalueChange:function(M){var O=M.value.toString().replace(/[^0-9,]/g,""),N;if(O.charAt(0)==="0"&&O.length>1){O=O.substr(1);}N=parseInt(O,10);this.set("value",O===""?O:J(A(O)));if(N!==this.parent.provider.curVal){this.parent.provider.setVal(N);}},onInvalid:function(){this.parent.set("vflag",false);if(!this.domNode){return ;}this.warningTooltip.refNode=this.domNode;this.warningTooltip.errorCode=null;this.warningTooltip.errorMsg=this.validationStatus.msg;this.warningTooltip.top="-"+(parseInt(this.domNode.clientHeight,10)+10);this.showWarning(this.warningTooltip);this._isValid=false;},onValid:function(){this.parent.set("vflag",true);this.hideWarning();this._isValid=true;},constraints:{trigger:mstrmojo.validation.TRIGGER.VALUESET,validator:function(N){var O=this.min,M=this.max,Q=B.isEmpty(N),P=A(N);if(Q){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:H(14701,"Please input a number.")};}P=parseInt(P,10);if(P>=O&&P<=M){return{code:mstrmojo.validation.STATUSCODE.VALID};}else{if(P>M){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:H(14757,"The maximum value is")+" "+J(M)};}else{if(P<O){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:H(14758,"The minmum value is")+" "+J(D)};}}}},invalidCssClass:"invalid"},autoFormat:false,useRichTooltip:true}];this._super(K);this.addDisposable(L);G.addWidgetCssClass(this,(!!mstrApp.isWSStyling)?"mstrmojo-Refine-RefineValidateStepper":"mstrmojo-ui-ctrl-Stepper");},postBuildRendering:function(){this.updateDisplayText();this._super();},updateDisplayText:function C(){var K=this.provider.getVal();if(K<0){this.provider.set("curVal",0);this.provider.setVal(0);this.textInput.set("value",0);return ;}this.textInput.set("value",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Stepper","mstrmojo._HasLayout","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.expr","mstrmojo.css");var C=mstrmojo.expr.DTP,B=mstrmojo.css,A="mstrmojo-Stepper-ErrValidation";mstrmojo.ui.editors.controls.Stepper=mstrmojo.declare(mstrmojo.Stepper,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.Stepper",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,mouseup,mousemove,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text"></div><div class="prev">-</div></div>',layoutConfig:{w:{textNode:"100%"},xt:true},textInput:null,init:function E(F){var G=F.provider;if(!!mstrApp.isWSStyling){this.layoutConfig=null;}this.children=[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"textInput",slot:"textNode",dtp:G.dtp||C.INTEGER,maxLength:G.maxLength,constraints:{validator:G.validator,max:G.max,min:G.min},onValid:function(){var H=this.parent;B.removeClass(H.domNode,A);G.setVal(parseInt(this.value,10)||0);H.updateDisplayText();}}];this._super(F);this.addDisposable(G);B.addWidgetCssClass(this,"mstrmojo-ui-ctrl-Stepper");},postBuildRendering:function(){this.updateDisplayText();this._super();},updateDisplayText:function D(){this.textInput.set("value",this.provider.getVal());}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.css");var D=mstrmojo.css;var B;mstrmojo.vi.ui.toolbars.TitleToolbar=mstrmojo.declare(mstrmojo.vi.ui.toolbars.Toolbar,null,{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",init:function F(H){this._super(H);D.addWidgetCssClass(this,"mstrmojo-VITitleToolbar");},markupMethods:{onvisibleChange:function A(){var H=this.visible,I=this.domNode;D.toggleClass(I,"visible",H);if(!H){D.onTransitionEnd(I,function(){D.addClass(I,"hidden");});}else{D.removeClass(I,"hidden");}}},getItemMarkup:function E(H){if(!B){B=this._super(H).replace("{@en@n}",'<div class="icn"></div>');}return B;},ontoolbarCfgChange:function G(H){var I=H.value;if(I){if(I.showContextMenu){I.addMenuToolbarBtn("","mnu");}if(I.hasCloseButton){I.addToolbarBtn(I.closeButtonText,"cls",function(K,J){J.parent.close();});}}this._super(H);},onItemContextMenu:function C(H){this.closePopup();if(H.fn){H.fn(H,this);return true;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.ui.menus.MenuConfig");var A=mstrmojo.func,J=mstrmojo.desc(2177,"Close");function G(L){return function(N,M){M.openMenu(L,N);};}mstrmojo.ui.menus.ToolbarConfig=mstrmojo.declare(mstrmojo.ui.menus.MenuConfig,null,{scriptClass:"mstrmojo.ui.menus.ToolbarConfig",btns:null,hasCloseButton:false,closeButtonText:J,showContextMenu:true,addCloseButton:function E(L){this.hasCloseButton=true;if(L){this.closeButtonText=L;}},preShowMenu:mstrmojo.emptyFn,addToolbarBtn:function I(R,M,P,L,N,Q){var O={n:R,cls:M,fn:P,ctxt:L,ttp:Q};if(isNaN(N)||N>=this.btns.length){this.btns.push(O);}else{this.btns.splice(N,0,O);}return O;},addDisabledToolbarBtn:function I(O,M,L){var N=this.addToolbarBtn(O,(M||"")+" disabled",mstrmojo.emptyFn,L);N.dsbld=true;},addToolbarPickerBtn:function B(R,M,P,Q,L,N){var O={n:R,cls:M,fn:P,ctxt:L,tp:"pb",menufn:G(Q||this)};if(isNaN(N)||N>=this.btns.length){this.btns.push(O);}else{this.btns.splice(N,0,O);}},addMenuToolbarBtn:function H(P,L,O,M,N){if(!O&&!this.hasMenuItems()){return ;}this.addToolbarBtn(P,L,A.composite([this.preShowMenu,G(O||this),(N||mstrmojo.emptyFn)]),null,M);},addToggleToolbarButton:function D(S,O,Q,N,M,R,L){var P=this.getToggleItemStates(S,O,Q,N,R,L);this.addDualStateItem(M,P[0],P[1],true);},addDualStateItem:function K(M,L,N,O){this["add"+(O?"ToolbarBtn":"MenuItem")](L.n,L.cls,this.getDualStateHandler(M,L,N),L.ctxt,undefined,L.ttp);},getDualStateHandler:function C(M,L,N){var O=this._super(M,L,N);return function(P,Q){O.call(this,P,Q);Q.refresh();};},clear:function F(){this.btns=[];this.hasCloseButton=false;this.closeButtonText=J;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.requiresDescs(2131,2122,2127,2125,2123,9938,2219,2220,520,612,521,523,522,524,525,526,686,2784,687,2785,688,2786,696,746,7555,13083,13084,4561,12939,12940,7227,13387,12078,12736);function N(z,q,x,AH,AA,AE,t){var AB=AA?"height:"+AA+"px;":"";var AD=AE?"width:"+AE+"px;":"",AG=x[1],AC="";var AF='<div class="mstrmojo-qb-DBTableRow-bullet" style="'+AB+AD+'">';if(AG==="tick"||AG==="mix"){AC='style="font-weight: bold;"';AG=(AG==="tick")?0:16;}AF+='<div class="icon t'+AG+'"></div>';AF+='<div class="text" '+AC+">"+z+"</div>";if(t&&t.length){for(var u=0;u<t.length;u++){AF+='<div class="cxtmenu '+t[u].n+'"></div>';}}AF+="</div></div>";return AF;}var K=mstrmojo.dom,H=mstrmojo.global.document,E=mstrmojo.string,f=mstrmojo.array,L=mstrmojo.desc;var D,k,A;var d;function l(u,q,t){if(t!=null){k.innerHTML=t;}A.left=u.x+"px";A.top=u.y+"px";}function R(q,t){if(!D){D=H.createElement("div");A=D.style;A.position="absolute";A["z-index"]=9999;D.className="mstrmojo-qb-TableRow-avatar";D.innerHTML="<div></div>";k=D.firstChild;H.body.appendChild(D);}l(t,true,q);A.display="block";}function h(){if(D){A.display="none";}}function F(t,u){try{var AB=[],z=t,AA=0,q,w;w=new RegExp(E.regEscape(u),"gi");while(!!u&&(q=w.exec(t))){AB.push(E.encodeHtmlString(t.slice(AA,q.index)));AB.push('<span class="keyword">'+E.encodeHtmlString(t.slice(q.index,w.lastIndex))+"</span>");AA=w.lastIndex;}AB.push(E.encodeHtmlString(t.slice(AA)));t=AB.join("");}catch(x){t=z;}return t;}function c(t,q,z){if(!t.domNode){return false;}var u=K.position(t.domNode,true);return((u.y<=z)&&(u.x<=q)&&(u.x+u.w>=q)&&(u.y+u.h>=z));}function b(z,q,AB){var AA=document.elementFromPoint(q,AB);var u=K.findWidget(AA);while(u){if(u.dropZone){if(u.allowDrop&&u.allowDrop(z)){return u;}}u=u.parent;}return null;}mstrmojo.qb.DBTableRow=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.DBTableRow",indent:0,text:"",displayText:"",keyword:"",isVisibleChanged:false,checkBox:false,draggable:true,ownAvatar:true,dropZone:true,cxtmenus:null,allowDrop:function C(q){return true;},ondrop:function e(w){var u=w.src.widget,q=w.tgt.widget,t=mstrmojo.all.QBuilderModel;if(u.domNode.className.indexOf("mstrmojo-qb-DBTableRow")<0){return ;}if(u.srcID==q.srcID){return ;}if(t.joinsInfo[u.srcID+q.srcID]){t.addLink(u,q,u.srcID+q.srcID);}else{if(t.joinsInfo[q.srcID+u.srcID]){t.addLink(q,u,q.srcID+u.srcID);}else{t.addJoin(u,q,0,null);}}},_leftPos:0,_topPos:0,movable:false,dropTarget:null,markupString:'<div id="{@id}" class="mstrmojo-qb-DBTableRow {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,contextmenu></div>',markupMethods:{ondisplayTextChange:function(){this.domNode.innerHTML=N(this.displayText,this.indent,this.images,this.selected,null,null,this.cxtmenus);},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,oncssClassChange:function X(){this.domNode.className="mstrmojo-qb-DBTableRow "+(this.cssClass||"");},onkeywordChange:function(){var u=this.keyword,t,q;if(!u){this.set("isVisibleChanged",!this.visible);this.set("visible",true);this._highlight();return ;}q=this.text.toLowerCase().indexOf(u.toLowerCase())>=0;t=!!q;this._highlight();this.set("isVisibleChanged",t!=this.visible);this.set("visible",t);}},_highlight:function(){this.set("displayText",F(this.text,this.keyword));},getDragData:function(t){var q={};if(this.domNode){q.html=N(this.displayText,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth);q.n=this.text;}return q;},isDragValid:function V(q){return K.contains(this.domNode,q.src.node,true,document.body);},ondragstart:function(q){if(K.isWK){document.onselectstart=function(t){t.preventDefault();return false;};}this.domNode.style.cssText="opacity:0.3; filter: alpha(opacity=30);";d=K.position(this.domNode);R(N(this.displayText,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth),d);},ondragmove:function(t){var q=t.tgt.pos;l({x:q.x+5,y:q.y+5},true,N(this.displayText,this.indent,this.images,this.selected,this.domNode.offsetHeight,this.domNode.offsetWidth));},ondragend:function(){if(K.isWK){document.onselectstart=function(){return true;};}if(this.domNode){this.domNode.style.cssText="opacity:1; filter: alpha(opacity=100);";}h();},onclick:function(t){var q=t.hWin,u=t.e||q.event,w=u.target||u.srcElement;if(w.type==="checkbox"){if(this.onCheck){this.onCheck(w.checked);}}},postBuildRendering:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-D",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.rIndex>=0?this.text:mstrmojo.desc(12736,"Add all columns")});if(!this._ontooltipover){var q=this.id;this._ontooltipover=function(u){var t=mstrmojo.all[q];t.showTooltip(u,self);};this._ontooltipout=function(u){var t=mstrmojo.all[q];t.hideTooltip(u,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return this._super();}});var Z=[{n:L(2131,"Sum"),idx:1},{n:L(2122,"Average"),idx:2},{n:L(2127,"Minimum"),idx:3},{n:L(2125,"Maximum"),idx:4},{n:L(2123,"Count"),idx:5},{n:L(9938,"Count Distinct"),idx:6}];var g={SEPARATOR:-1,IN_LIST:0,NOT_IN_LIST:1,EXACTLY:2,NOT_EXACTLY:3,GREATER_THAN:4,LESS_THAN:5,GREATER_THAN_EQ:6,LESS_THAN_EQ:7,LIKE:8,NOT_LIKE:9,CONTAIN:10,NOT_CONTAIN:11,BEGIN_WITH:12,NOT_BEGIN_WITH:13,END_WITH:14,NOT_END_WITH:15,BETWEEN:16,NOT_BETWEEN:17},M={0:{did:2219,n:L(2219,"In list")},1:{did:2220,n:L(2220,"Not in list")},2:{did:520,n:L(520,"Exactly")},3:{did:612,n:L(612,"Not Exactly")},4:{did:521,n:L(521,"Greater than")},5:{did:523,n:L(523,"Less than")},6:{did:522,n:L(522,"Greater than equal")},7:{did:524,n:L(524,"Less than equal")},8:{did:525,n:L(525,"Like")},9:{did:526,n:L(526,"Not like")},10:{did:686,n:L(686,"Contains")},11:{did:2784,n:L(2784,"Does not contain")},12:{did:687,n:L(687,"Begins with")},13:{did:2785,n:L(2785,"Does not begin with")},14:{did:688,n:L(688,"Ends with")},15:{did:2786,n:L(2786,"Does not end with")},16:{did:"Between",n:L(696,"Between")},17:{did:"Not between",n:L(746,"Not between")}};var B=[g.IN_LIST,g.NOT_IN_LIST,g.SEPARATOR,g.EXACTLY,g.NOT_EXACTLY,g.SEPARATOR,g.GREATER_THAN,g.LESS_THAN,g.SEPARATOR,g.LIKE,g.NOT_LIKE],j=[g.IN_LIST,g.NOT_IN_LIST,g.SEPARATOR,g.EXACTLY,g.NOT_EXACTLY],Y=[g.GREATER_THAN,g.LESS_THAN,g.SEPARATOR,g.GREATER_THAN_EQ,g.LESS_THAN_EQ,g.SEPARATOR,g.BETWEEN,g.NOT_BETWEEN],n=[g.LIKE,g.NOT_LIKE,g.SEPARATOR,g.CONTAIN,g.NOT_CONTAIN,g.SEPARATOR,g.BEGIN_WITH,g.NOT_BEGIN_WITH,g.SEPARATOR,g.END_WITH,g.NOT_END_WITH];mstrmojo.qb.DBTableRowMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,tableRow:null,handleAddColumn:function W(w){var q=this.tableRow,x=[q],u,t=mstrApp.getRootController(),z;u=t.gettIndex(q.parent.parent.id);z={success:function(){q.updateState(1);q.count++;}};t.addSelectedColumns(x,u,null,z);return true;},handleAddExpression:function p(u){var t=this.tableRow,q=0;mstrApp.getRootController().openExpressionEditor({type:q,w:t,tkn:t.expr});return true;},handleAddAggrColumn:function G(x){var t=x.ctxt,q=this.tableRow,AA=t.aggrFuncIdx,z=[q],w,u=mstrApp.getRootController(),AB;w=u.gettIndex(q.srcID);AB={success:function(){if(q.state==0||q.state==2){q.state++;q.images[1]=q.img[q.state];q.render();}q.count++;}};u.addSelectedColumns(z,w,AA,AB);return true;},handleAddFuncExpr:function Q(u){var q=u.ctxt,t=this.tableRow;mstrApp.getRootController().openExpressionEditor({type:0,selFuncItem:q,w:t});},getSubMenuConfigComFuncs:function a(q){var t=new mstrmojo.ui.menus.MenuConfig(),w,u=this;w=function(x){u.handleAddAggrColumn(x);};f.forEach(Z,function(x){if(x.idx==6&&mstrApp.getRootController()&&mstrApp.getRootController().isBDE&&mstrApp.getRootController().isBDE==true){t.addDisabledMenuItem(x.n,"");}else{t.addMenuItem(x.n,"",w,{aggrFuncIdx:x.idx});}});return t;},getSubMenuConfigFuncs:function J(q){var u=new mstrmojo.ui.menus.MenuConfig(),AA=this.id,w,x=this,t,z;w=function(AB){x.handleAddFuncExpr(AB);};if(!q){t=mstrApp.getRootController().getFunctionList();z=1;}else{t=q.funcList;z=q.depth;}f.forEach(t,function(AB){if(AB.n&&(AB.n.indexOf("Financial")>-1||AB.n.indexOf("Statistical")>-1)){return ;}if(AB.fns&&AB.fns.length){u.addSubMenuItem(AB.n,"depth"+z.toString(),AA,this.getSubMenuConfigFuncs,{funcList:AB.fns,depth:z+1});}else{u.addMenuItem(AB.n,"",w,AB);}},this);return u;},handleAddFilter:function O(AE){var z=AE.ctxt,t=this.tableRow,q=z.opID,w=t.dt.tp,AB={14:true,15:true,16:true},AD={30:true},x={8:true,9:true,10:true,17:true,18:true,33:true},AA,u,AC;mstrApp.getRootController().openConditionDialog();switch(q){case M[g.BETWEEN].did:case M[g.NOT_BETWEEN].did:AC=2;break;default:AC=1;}u="mstr-qb-fve";AA=mstrmojo.all[u]||(new mstrmojo.qb.FilterValueEditor({id:u,zIndex:1000}));AA.n=AE.n;AA.operatorID=q;AA.column=t.oriexpr;AA.isDateTime=!!AB[w];AA.isBigDecimal=!!AD[w];AA.isString=!!x[w];AA.paraNum=AC;AA.open();},getSubMenuConfigClauses:function S(x,q){var t=new mstrmojo.ui.menus.MenuConfig(),u,AA=this,z,w;u=function(AB){AA.handleAddFilter(AB);};switch(x){case"common":w=B;break;case"basic":w=j;break;case"numeric":w=Y;break;case"string":w=n;break;}f.forEach(w,function(AB){if(AB===g.SEPARATOR){t.addSeparator();}else{z=M[AB];t.addMenuItem(z.n,"",u,{opID:z.did});}});return t;},getSubMenuConfigComClauses:function I(q){return this.getSubMenuConfigClauses("common",q);},getSubMenuConfigAllClauses:function P(q){var t=new mstrmojo.ui.menus.MenuConfig(),u=this.id;t.addSubMenuItem(L(7227,"Basic"),"",u,this.getSubMenuConfigAllClausesBasic,q);t.addSubMenuItem(L(13387,"Comparison"),"",u,this.getSubMenuConfigAllClausesNumeric,q);t.addSubMenuItem(L(12078,"Pattern"),"",u,this.getSubMenuConfigAllClausesString,q);return t;},getSubMenuConfigAllClausesBasic:function U(q){return this.getSubMenuConfigClauses("basic",q);},getSubMenuConfigAllClausesNumeric:function m(q){return this.getSubMenuConfigClauses("numeric",q);},getSubMenuConfigAllClausesString:function o(q){return this.getSubMenuConfigClauses("string",q);},getMenuConfig:function(){var t=this.menuCfg,x=this.id,q,u,w=this;if(!t){t=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{t.clear();}q=function(z){w.handleAddColumn(z);};u=function(z){w.handleAddExpression(z);};t.addMenuItem(L(7555,"Add Column"),"",q);if(w.tableRow.enableExpr){t.addMenuItem(L(13083,"Edit Column"),"",u);}t.addSeparator();t.addSubMenuItem(L(13084,"Basic Functions"),"",x,this.getSubMenuConfigComFuncs);t.addSubMenuItem(L(4561,"All Functions"),"",x,this.getSubMenuConfigFuncs);t.addSeparator();t.addSubMenuItem(L(12939,"Basic Filters"),"",x,this.getSubMenuConfigComClauses);t.addSubMenuItem(L(12940,"All Filters"),"",x,this.getSubMenuConfigAllClauses);return t;}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.ME.MetricDataService");mstrmojo.requiresDescs(3224);var Z=["(",")","{","}","-","+","*","/","<",">","|","~",","],I={" ":true,"@":true},Y=null,X=mstrmojo.dom,K=mstrmojo.css,H=mstrmojo.mstr.EnumDSSXMLObjectTypes,D=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,a=mstrmojo.ME.MetricDataService;function O(f){if(!Y){Y={};var e,d;for(e=0,d=Z.length;e<d;e++){Y[Z[e]]=true;}}return Y.hasOwnProperty(f);}function b(f){if(!f){return false;}var d=f.length,e,g;for(e=0;e<d;e++){g=f.charAt(e);if(g==="["){return false;}if(O(g)||I[g]){return true;}}return false;}function A(c){return b(c)?"["+c+"]":c;}function M(g){if(!g){return null;}var c=g.length,f=g.split("["),e=f.length,j,h;if(e===1){return g.split("@");}else{if(e===3){j=f[1];j="["+j.substring(0,j.length-1);h="["+f[2];}else{if(f[0].length===0){var k=f[1],d=k.indexOf("]");j="["+k.substring(0,d+1);if(d===k.length-1){return[j];}else{h=k.substring(d+2);}}else{var k=f[0];j=k.substring(0,k.length-1);h="["+f[1];}}}return[j,h];}var R={8:true,9:true,10:true};var C=function(d,c){return R[d]&&!/^\".*\"$/.test(c)?'"'+c+'"':c;};var F=function(d,c,e){var f=typeof e==="undefined"?true:R[e];if(c.length===2&&c==='""'){return c;}return d.tp===261&&c.length>=2&&f?(/^\s+$/.test(c.substr(1,c.length-2))?c:c.substr(1,c.length-2)):c;};mstrmojo.ME.MetricToken=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}" mstrAttach:contextmenu></span>',active:false,markupMethods:{ondataChange:function(){var e=this.data,f=this.isEmbeddedFilter(),c=f?"&nbsp;":mstrmojo.string.encodeHtmlString(String(e.v));if(e.v===","){this.domNode.innerHTML=c+"&nbsp;";}else{if(e.tp===259&&e.v==="Desc"){this.domNode.innerHTML="&nbsp;"+c;}else{if(a.isLogicOrCompFunc(e)){this.domNode.innerHTML="&nbsp;"+c+"&nbsp;";}else{this.domNode.innerHTML=c;}}}K.toggleClass(this.domNode,["mstr"],this.isMstrO());K.toggleClass(this.domNode,["nfn"],!this.isFunction());K.toggleClass(this.domNode,["invalid"],e.sta===-1);K.toggleClass(this.domNode,["embeddedFilter"],f);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},oncontextmenu:function V(c){this.closePopup();if(this.isEmbeddedFilter()){var e=new mstrmojo.ui.menus.MenuConfig({position:X.getMousePosition(c.e,c.hWin),isHostedWithin:false,alignWithAnchor:true});var d=this;e.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){var f=d.parent;if(f&&f.editEmbeddedFilterToken){f.editEmbeddedFilterToken(d);}});this.openPopup(e.newInstance());}},isMstrO:function W(){return !!this.data.oi||!!this.data.rfd;},isFunction:function B(){return this.isMstrO()&&(this.data.oi&&this.data.oi.t===H.Function);},isEmbeddedFilter:function J(){var e=this.data.oi,d=e&&e.t,c=e&&e.st;return this.isMstrO()&&d===H.Filter&&c===D.Filter&&e.isEmbedded;},brackets:A,length:function E(){return this.isEmbeddedFilter()?1:this.data.v.toString().length;},isDelimiter:function U(){return this.data.isDelimiter||(this.length()===1&&O(this.data.v));},split2Tokens:function L(g){var f=this.data,e=f&&f.v.toString(),h=e.substring(0,g),c=e.substring(g);return[{v:h,isNew:true},{v:c,isNew:true}];},mergeTo:function N(e){var g=this.data,f=g&&g.v.toString(),c=e.data.v.toString();return{v:f+c,isNew:true};},brackets:A,setItemInfo:function S(c){var e=this.data;e.v=this.brackets(c.n);e.oi=c;e.sta=1;e.isNew=true;this.set("data",e);this.paint();},spliceContent:function P(k,h,e){var j=this.data,g=j&&j.v.toString(),l=g.substring(0,k);h=(h===null||h===undefined)?(g.length-k):h;var c=g.substring(k+h),f=l+(e||"")+c;j.v=f;j.isNew=true;j.sta=1;j.ift=(this.isAttributeToken()||j.at)&&(j.v.indexOf("@")>=0);if(j.ift){j.at=j.oi||j.at;}else{delete j.at;}delete j.oi;delete j.exv;delete j.extp;delete j.tp;this.set("data",j);this.paint();},isAttributeToken:function G(){return this.data&&this.data.oi&&this.data.oi.t===H.Attribute;},setFormInfo:function Q(e){var f=this.data,c=f.oi||f.at;f.v=this.brackets(c.n)+"@"+this.brackets(e.n);f.exv=e.did;f.extp=8;f.sta=1;f.isNew=true;f.oi=f.at;delete f.at;this.set("data",f);this.paint();}});mstrmojo.ME.MetricToken.isDelimiter=O;mstrmojo.ME.MetricToken.brackets=A;mstrmojo.ME.MetricToken.splitAttrAndAttrForm=M;mstrmojo.ME.MetricToken.quotes=C;mstrmojo.ME.MetricToken.unquotes=F;mstrmojo.ME.MetricToken.QUOTABLE_DATATYPES=R;mstrmojo.ME.MetricToken.argDelimiter={".":",",",":";"}[mstrConfig&&mstrConfig.decimalSep]||",";})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var A=mstrmojo.css,N=mstrmojo.dom,M="draggedTab",J="stopDragging",m=1,L=2,q=4,G=8,l=16;function n(t){return function(){A.toggleClass(this.tabStripMenuNode,"active",t);};}function h(AF){var AA=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:N.getMaxScrollHeight()}),t=this.getMenuActions(),AD=this.index,w=this.id,x=this.total,AB=this.parent,u=function(){var AG=AB&&AB.getTabs();return AG&&AG.length>AD?AG[AD]:mstrmojo.all[w];};if((t&l)>0){this.addNewTabMenuItem(AA);}if((t&q)>0){var AC=mstrmojo.desc(3397,"Duplicate"),AE=this.parent.scriptClass;if(AE.indexOf("LayoutTabStrip")>=0){AC=mstrmojo.desc(15022,"Duplicate Chapter");}else{if(AE.indexOf("PanelTabStrip")>=0){AC=mstrmojo.desc(14923,"Duplicate Page");}}AA.addMenuItem(AC,"dup",function(){u().tabDuplicated();});}if((t&L)>0){if(AD){AA.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){u().tabMoved(true);});}if(AD<x-1){AA.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){u().tabMoved(false);});}}AA.addSeparator();if((t&m)>0){AA.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){u().lbl.set("isEditing",true);});}if((t&G)>0){if(x>1){AA.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){u().tabDeleted();});}}var z=this.getCustomMenu();if(z&&z.hasMenuItems()){AA.addSeparator();AA.absorbMenuItems(z);}AA.addPopupHandlers(this.id,n(true),n(false));this.showTabMenu(this.updateMenuCfg(AA),AF);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:contextmenu,click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function S(){return this.domNode.firstChild.firstChild;},menuBtnNode:function p(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function I(){this.lbl.set("text",this.title);},onisSelectedChange:function j(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function k(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,isCutoff:false,isHidden:false,isLeftMost:false,isRightMost:false,leftEdgeHiddenWidth:0,rightEdgeHiddenWidth:0,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function W(u,t){if(u){this.parent.titleEdited(this.text,t);}}}],postBuildRendering:function Q(){var t=this.isValidMode();if(!t||(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview())){this.draggable=false;}this.lbl.set("editOnDoubleClick",t);this._super();},oncontextmenu:function b(t){this.onclick(t);t.preventDefault();},onclick:function e(t){var w=this.domNode;if(A.hasClass(w,J)){A.removeClass(w,J);return ;}var u=function(){if(this.isValidMode()){this.postTabClicked(this,t);}};if(!this.isSelected){this.tabSelected({success:u.bind(this)});}else{u.call(this);}},postTabClicked:function o(x,u){x=this.findSelectedTab(this)||x;var t=x.menuBtnNode,z=u.getTarget().className===t.className,w;if(z){w=N.position(t);}if(u.name==="contextmenu"||(z&&!(w.x||w.y))){w={x:u.e.clientX,y:u.e.clientY};}if(w){h.call(x,w);}},getMenuActions:function d(){return 0;},getCustomMenu:function Y(){return null;},isDragValid:function R(){return this.parent.children.length>1&&!this.lbl.isEditing&&this.isValidMode();},createAvatar:function U(){var t=document.createElement("div");t.appendChild(this.domNode.cloneNode(true));t.style.margin="-5px 0 0 10px";return t;},addTabDnDStyle:function X(){var t=this.lbl.domNode;if(t&&!this.isSelected){A.addClass(t,M);}},clearTabDnDStyle:function F(){var t=this.lbl.domNode;if(t&&!this.isSelected){A.removeClass(t,M);}},allowDrop:function D(t){var u=t.src.widget;return u&&u.parent===this.parent;},dropTab:function K(t){var x=t.src,w=x.data,u=x.widget;u.clearTabDnDStyle();this.parent.moveTab(w.idx,this.index,w.fromIdx);},ondragenter:function H(u){this._super(u);var x=u.src.data,w=u.src.widget,t=this.index;this.parent.moveTab(x.idx,t);x.idx=t;},ondragover:function a(w){var t=w.tgt.node,u=w.tgtData,x=u&&u.node,z=w.src.widget;if(!u||x!==t){w.tgtData={node:t};}if(z&&!z.isSelected){z.addTabDnDStyle();}},ondragleave:function P(t){this._super(t);var u=t.src.widget;if(u&&!u.isSelected){u.addTabDnDStyle();}},ondragend:function C(t){this._super(t);A.addClass(this.domNode,J);this.dropTab(t);},getDragData:function c(){var w=this.id,t=this.index;return{setAvatarClass:function u(x){var AB=mstrmojo.all[w],z=AB.avatar;if(z){var AA=[AB.avatarCssClass,"hasOwnAvatar",x];z.className=AA.join(" ");}},fromIdx:t,idx:t};},getDropAvatarIcon:function B(){return"pivot";},isValidMode:function E(){return !((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())||(mstrApp.allowWebDashboardDesign&&!mstrApp.allowWebDashboardDesign()));},cleanUpAfterTarget:function f(t){this.clearTabDnDStyle();this._super(t);},onAppStateChange:function g(u){var x=this.lbl,w=this.isValidMode(),t=mstrApp.isLayoutPreview(u.value);x.set("isEditing",false);x.set("editOnDoubleClick",w);this.draggable=w&&!t;},onLayoutModeChange:function O(u){var w=this.isValidMode(),t=mstrApp.isLayoutPreview(u.value);this.draggable=w&&!t;},addNewTabMenuItem:function V(t){this.throwAbstractMethodError("addNewTabMenuItem");},findSelectedTab:mstrmojo.emptyFn,tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function Z(t){return t;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:l,RENAME:m,MOVE:L,DUPLICATE:q,DELETE:G};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Refine.RefineHelpers","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(1388,629,14539,14540);var C=mstrmojo.Refine.RefineConstants;var F=mstrmojo.Refine.RefineHelpers;var B=C.menuItems;var E=mstrmojo.array;mstrmojo.Refine.RefineMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(1388,"Rename"),did:B.REFINE_RENAME},{did:B.SEPARATOR},{n:mstrmojo.desc(12575,"Delete Column"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14274,"Duplicate Column"),did:B.REFINE_DUPLICATE},{did:B.SEPARATOR},{n:mstrmojo.desc(12341,"Fill Down"),did:B.REFINE_FILL_DOWN},{did:B.SEPARATOR},{n:mstrmojo.desc(14539,"Text Selector"),did:B.REFINE_TEXT_FACET},{n:mstrmojo.desc(14540,"Numeric Selector"),did:B.REFINE_NUMERIC_FACET},{did:B.SEPARATOR},{n:mstrmojo.desc(14268,"To Title Case"),did:B.REFINE_TITLE_CASE},{n:mstrmojo.desc(14269,"To Uppercase"),did:B.REFINE_UPPERCASE},{n:mstrmojo.desc(14270,"To Lowercase"),did:B.REFINE_LOWERCASE}],queryEnabled:function H(){return true;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_TEXT_FACET:case B.REFINE_NUMERIC_FACET:J=!mstrApp.getRootController().refineApp.isBDE;break;default:J=true;break;}return J;},queryChecked:function A(){return false;},executeCommand:function(Y){var J={},U;var I,N,K=this.target.text;var S=this.target.preview.controller;var R=S.model;var V=R.columns.columns;var M;switch(Y.did){case B.REFINE_RENAME:this.target.inlineEdit.ondblclick();break;case B.REFINE_DELETE:this.target.inlineEdit.handleDelete();break;case B.REFINE_DUPLICATE:I=[];var X,W,P,Q=1,O;var L=this.target.preview.columns;while(true){X=K+" "+Q;P=true;for(O=0;O<L.length;O++){if(X===(L[O]).name){P=false;break;}}Q++;if(P){W=X;break;}}N=JSON.parse(JSON.stringify(R.transformations.Other.duplicate));N.description=N.description.replace("[new column name]",W);N.description=N.description.replace("[column name]",K);N.columnInsertIndex=this.target.columnIndex+1;N.newColumnName=N.newColumnName.replace("[column name]",W);N.baseColumnName=N.baseColumnName.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_FILL_DOWN:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.fillDown));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);M={operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})};if(R.hasAddSample()){F.confirmFilldownOrBlankdown(function(){S.applyOperations(M);});}else{S.applyOperations(M);}break;case B.REFINE_TEXT_FACET:J.name=this.target.text;J.columnName=this.target.text;J.columnIndex=this.target.columnIndex;if(V[this.target.columnIndex]===undefined){J.originalName=null;}else{J.originalName=V[this.target.columnIndex].originalName;}U="list";J.expression="value";this.target.preview.controller.addFacets(U,J);break;case B.REFINE_NUMERIC_FACET:J.name=this.target.text;J.columnName=this.target.text;if(V[this.target.columnIndex]===undefined){J.originalName=null;}else{J.originalName=V[this.target.columnIndex].originalName;}U="range";J.expression="value";J.mode="range";this.target.preview.controller.addFacets(U,J);break;case B.REFINE_TITLE_CASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.titlecase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_UPPERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.uppercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_LOWERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.lowercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var N=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu",useTooltip:true}),O=this.id,I,M=false,L=null,K=J||this.cm;E.forEach(K,function(Q){I=(Q.did===C.menuItems.SEPARATOR);if(this.queryVisible(Q)){if(I){if(null!==L){M=true;}}else{if(null===L){L=Q;}else{if(M){N.addSeparator();M=false;}}var P=[Q.icn||""],R=function R(){this.executeCommand(Q);};if(this.queryEnabled(Q)===false){N.addDisabledMenuItem(Q.n,P.join(" "));if(Q.title){N.menus[N.menus.length-1].title=Q.title;}}else{if(Q.items){N.addSubMenuItem(Q.n,"",O,Q.buildSubMenuConfig||this.getMenuConfig,Q.items);}else{if(Q.hasEdt){N.addEditorMenuItem(Q.n,O,Q.buildSubMenuConfig);}else{N.addToggleMenuItem(Q.n||"",P.join(" "),R,R,O,this.queryChecked(Q));}}}}}},this);return N;}});}());(function(){var H=mstrmojo.array,A={NONE:0,EDIT:1,DELETE:2};function E(L,J){var K=this.data,I=(K&&K.length)?K[0]:K;return(I&&I[L])?I[L](K,J):true;}mstrmojo.qb.menu.SimpleGridMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.menu.SimpleGridMenu",dynamicUpdate:true,queryEnabled:function G(I){return E.call(this,"isEnabled",I);},queryVisible:function D(I){return E.call(this,"isVisible",I);},queryChecked:function C(I){return E.call(this,"isChecked",I);},executeCommand:function B(J){var K=this.data,I=mstrApp.getRootController();switch(J.action){case A.EDIT:I.editColumn(K);break;case A.DELETE:I.deleteColumn(K);break;}},getMenuConfig:function F(I){var L=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-qb-simplegrid-menu"}),K=I||this.cm,J=this;H.forEach(K,function(N){if(this.queryVisible(N)){var M=["xt "+(N.icn||"")],O=function O(){J.executeCommand(N);};L.addMenuItem(N.n||"",M.join(" "),O);}},this);return L;},cm:[{action:A.EDIT,n:mstrmojo.desc(1088,"Edit"),icn:"edit"},{action:A.DELETE,n:mstrmojo.desc(629,"Delete"),icn:"del"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(12346,12355,12356,1905,14543,10380,14544,14738,14739);var C=mstrmojo.Refine.RefineConstants;var E=mstrmojo.DI.DIConstants;var B=C.menuItems;var F=mstrmojo.array;mstrmojo.Refine.RefineFacetMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineFacetMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12346,"Cluster and Edit"),did:B.REFINE_CLUSTER},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(12355,"Sort by Name"),did:B.REFINE_SORT_NAME},{n:mstrmojo.desc(12356,"Sort by Count"),did:B.REFINE_SORT_COUNT},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(1905,"Reset"),did:B.REFINE_RESET},{n:mstrmojo.desc(14543,"Reset ALL Selector"),did:B.REFINE_RESET_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(13039,"Delete"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14544,"Delete ALL Selector"),did:B.REFINE_DELETE_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(14738,"Delete Row Included In Selectors"),did:B.REFINE_DELETE_ROWS_IN_THE_VIEW},{n:mstrmojo.desc(14739,"Delete Row Not-included In Selectors"),did:B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW}],queryEnabled:function H(L){var J=true;var I=this.target.parent.parent.parent.parent.controller;switch(L.did){case B.REFINE_DELETE_ROWS_IN_THE_VIEW:case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:var K=I.refinePanel.bottomPanal.splitter.facetPanel;J=K.hasSelection();break;default:J=true;break;}return J;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_CLUSTER:case B.REFINE_SORT_NAME:case B.REFINE_SORT_COUNT:J=(this.target.type==="list");break;case B.SEPARATOR:if(I.type==="list"){J=(this.target.type==="list");}break;default:J=true;break;}return J;},queryChecked:function A(J){var I=false;switch(J.did){case B.REFINE_SORT_NAME:I=(this.target.options.sort==="name");break;case B.REFINE_SORT_COUNT:I=(this.target.options.sort!=="name");break;}return I;},executeCommand:function(P){var J,M,K,I=[],Q;var N=this.target.parent.parent.parent.parent.controller;switch(P.did){case B.REFINE_CLUSTER:var L=mstrApp.getRootController();var O=L.showDialog(E.dialogType.refineClusteringPage,{columnName:this.target.config.name,controller:N});N.model.attachEventListener("clustersFetched",O.id,O.handleClustersFetched);break;case B.REFINE_SORT_NAME:this.target.sortByName();break;case B.REFINE_SORT_COUNT:this.target.sortByCount();break;case B.REFINE_RESET:J=this.target.parent;this.target.reset();J.updateEngine(true);break;case B.REFINE_RESET_ALL:J=this.target.parent;J.resetAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE_ALL:J=this.target.parent;J.removeAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE:this.target.remove();break;case B.REFINE_DELETE_ROWS_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsNotInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var M=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-refine-menu"}),N=this.id,I,K=false,L=J||this.cm;F.forEach(L,function(P){I=(P.did===C.menuItems.SEPARATOR);if(this.queryVisible(P)){var O=[P.icn||""],Q=function Q(){this.executeCommand(P);};if(this.queryEnabled(P)===false||I){if((I&&!K)||!I){O.push(I?"separator":"");M.addDisabledMenuItem(P.n,O.join(" "));}if(I){K=true;}}else{if(P.items){M.addSubMenuItem(P.n,"",N,P.buildSubMenuConfig||this.getMenuConfig,P.items);K=false;}else{if(P.hasEdt){M.addEditorMenuItem(P.n,N,P.buildSubMenuConfig);K=false;}else{M.addToggleMenuItem(P.n||"",O.join(" "),Q,Q,N,this.queryChecked(P));K=false;}}}}},this);return M;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig");var D=mstrmojo.string,A=mstrmojo.dom,E=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function B(){var K=this,J=K.statusList,F=J&&J.length||0,G=K.statusConfig||new mstrmojo.ui.menus.MenuConfig(),L=function(M){return function(N){K.set("status",M);K.onStatusClick(M);};};if(!G.hasMenuItems()&&F){for(var H=0;H<F;H++){var I=J[H];G.addMenuItem(I.n,I.cls||"",L(I),K);}}else{}if(G.hasMenuItems()){G.alignment=K.alignment||{host:E.BOTTOM_LEFT,popup:E.TOP_LEFT};G.hostId=K.id;G.hostElement=K[K.hostElementName]||K.domNode;K.openPopup(G.newInstance());}}function C(){var F=this.statusConfig||this.statusList&&this.statusList.length>1;this.menuButtonNode.style.display=F?"":"none";}mstrmojo.ui.StatusButton=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.ui.StatusButton",markupString:'<div id="{@id}" class="mstrmojo-StatusButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}"><div class="mstrmojo-Button {@innerIconClass}"  mstrAttach:click><span class="mstrmojo-text"></span></div><div class="menuButton" mstrAttach:click></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},textSpanNode:function(){return this.domNode.firstChild.firstChild;},menuButtonNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){this.textSpanNode.innerHTML=D.encodeHtmlString(this.status&&this.status.n||"");},onstatusListChange:function(){C.call(this);},onstatusConfigChange:function(){C.call(this);}},status:null,statusList:null,statusConfig:null,onclick:function(F){var G=A.eventTarget(F.hWin,F.e);if(A.contains(this.menuButtonNode,G,true)){B.call(this);}else{if(A.contains(this.textNode,G,true)){this.onButtonClick(this.status,F);}}},onButtonClick:mstrmojo.emptyFn,onStatusClick:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasLayout","mstrmojo._HasSuggestion","mstrmojo.css");var G=mstrmojo.css,D="clear";function E(){this.searchTriggered(this.inputNode.value);}mstrmojo.ui.SearchBox=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" mstrAttach:keyup,blur,focus/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',markupSlots:{inputNode:function I(){return this.domNode.firstChild;},searchNode:function B(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{inputNode:"20px",searchNode:"20px"},w:{inputNode:"100%",searchNode:"22px"},xt:true},getLayoutOffsets:function(){return{w:2,h:0};},searchNode:undefined,inputNode:undefined,searchDelay:-1,init:function M(P){this._super(P);var O=this.searchDelay;if(O===-1||isNaN(O)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},onfocus:function N(O){var P=O.getTarget();if(P===this.inputNode){this.inputNode.placeholder="";G.addClass(this.domNode,"onInputFocus");}},onblur:function H(O){var P=O.getTarget();if(P===this.inputNode){this.inputNode.placeholder="Search...";G.removeClass(this.domNode,"onInputFocus");}},onclick:function L(O){var P=O.getTarget();if(P===this.searchNode){if(this._hasText){this.clearSearch();}else{E.call(this);}}},onkeyup:function A(Q){var P=Q.hWin,U=Q.e||P.event;if(U.keyCode===27){this.clearSearch();return ;}var S=this,O=this.text,V=this.text=this.inputNode.value,R=this._hasText=V.length>0;if(O!==V){G.toggleClass(this.searchNode,[D],R);window.clearTimeout(this._searchTimeoutId);this._searchTimeoutId=window.setTimeout(function(){E.call(S);},this.searchDelay);}},unrender:function F(){this.text="";this._super();},clearSearch:function J(O){this.text=this.inputNode.value="";G.removeClass(this.searchNode,[D]);delete this._hasText;if(!O){E.call(this);}this.postClearSearch();},isClear:function C(){return !this.text||this.text.length===0;},postClearSearch:mstrmojo.emptyFn,searchTriggered:function K(O){}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var F=-1,E=0,D=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function C(J,H){var M=this.candidates,L;if(M){var I=M.items,G=mstrmojo.array.find(I,this.itemValidationField,H.data[this.itemValidationField]);G=G>-1?G:mstrmojo.array.find(I,this.itemField,J);if(G>-1){H.updateData(I[G]);L=E;}else{if(M.isComplete){L=D;}}}if(L!==undefined){return L;}var K=this._vqueue=this._vqueue||[];K.push({pattern:J,id:H.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return F;},verifyNextCandidate:function B(){var G=this._vqueue;if(!G||G.length===0){this._vInProgress=false;return ;}this.verifyCandidate(G.shift());},verifyCandidate:function A(H){var G=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:H.pattern,blockBegin:1,blockCount:G.noCache?-1:this.suggestCount,isVerify:true},{success:function(N){var K=G.ctxtBuilder.itemWidgets,J=K&&K.length,O,M;for(M=0;M<J;M++){if(K[M].data[G.itemIdField]===H.id){O=K[M];break;}}if(!O){return ;}var L=N.items;if(L&&L.length===1){O.updateData(L[0]);}else{if(L&&L.length>1){var I=mstrmojo.array.find(L,"did",O.data.did);if(I>-1){O.updateData(L[I]);}else{O.set("state",D);}}else{O.set("state",D);}}},failure:function(I){mstrmojo.alert(I.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){G.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:F,VALID:E,INVALID:D};}());(function(){mstrmojo.requiresCls("mstrmojo.qb.MissingColumnWarning","mstrmojo.css","mstrmojo.ui.Checkbox","mstrmojo.Editor","mstrmojo.ui.List","mstrmojo.Image","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(122,212,218,219,221,1761,3415,3610,6724,8708,9161,11581,12598,12609,12771,13164,13447,11581,14058,14059,15209,15213,15214,15215,15216,15217,15218,15219,15220,15221,15222,15223,15224,15225,15226);var Q=mstrmojo.array,R=mstrmojo.css,E=mstrmojo.dom,N=mstrmojo.DI.DIHelpers,W=mstrmojo.DI.DIConstants;var M=mstrmojo.desc(15213,"Missing columns were detected in new data."),K=mstrmojo.desc(15214,"Mismatched datatypes were detected between new data and current data."),U=mstrmojo.desc(15215,"Missing columns were detected in new data, and mismatched datatypes were detected between new data and current data."),J=mstrmojo.desc(15216,"Refreshing dataset failed."),F=mstrmojo.desc(15217,"The above columns are missing in new data. The dataset schema or model will be updated when refresh the dataset with new data."),S=mstrmojo.desc(15218,'When refreshing dataset, if you choose the refresh policy as "Replace Existing Data", the current datatype will be replaced with new one. If you choose another refresh policies, the current datatype will be converted to the new one.'),L=mstrmojo.desc(15219,"###: Table missing. You could choose to edit dataset if your goal is to replace a table with another one completely."),I=mstrmojo.desc(15220,"Refresh a dataset with ### may cause errors in Dossiers that use them. Do you want to continue? See more details below."),O=mstrmojo.desc(15221,"Refresh a dataset with ### may cause errors in the Dossiers that use them, and refreshing dataset failed because incorrect data was uploaded. See more details below."),H=mstrmojo.desc(15222,"Refreshing dataset failed because incorrect data was uploaded. See more details below."),B=mstrmojo.desc(15223,"### (Dataset Datatype: ***)");function P(){return{"100":M,"010":K,"001":J,"110":U,"011":J,"101":J,"111":J};}function G(){return{column:F,datatype:S,table:L};}mstrmojo.DI.ui.dialogs.DIMissingColumnsList=mstrmojo.declare(mstrmojo.ui.List,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsList",getItemMarkup:function D(){var X='<div class="MissingColumnList-item {@cls} cf"><div class="MissingColumnList-item-icon tp{@tp}"></div><div class="MissingColumnList-item-text" itemtooltipn="{@n}">{@n}</div><div class="MissingColumnList-item-text2" itemtooltipname="{@name}">{@name}</div><div class="MissingColumnList-item-text3" itemtooltipcomment="{@comment}">{@comment}</div></div>';return X;},useRichTooltip:true,showTooltip:function C(c,a){var g=this,h=E.findAncestorByAttr(E.eventTarget(a,c),"itemtooltipn",true,this.domNode),k=E.findAncestorByAttr(E.eventTarget(a,c),"itemtooltipname",true,this.domNode),f=E.findAncestorByAttr(E.eventTarget(a,c),"itemtooltipcomment",true,this.domNode),j=h?h:(k?k:f),d=j&&mstrmojo.string.encodeHtmlString(j.value);if(!g.hasOpenTooltip&&d){var Y=E.position(j.node),X="vi-regular vi-tooltip-V missing-cloumns-tooltip",Z=Math.max(Y.x,0),b=mstrmojo.tooltip.POS_BOTTOMLEFT;if(k){X+=" V-center";Z=Math.max(Y.x+Y.w/2,0);b=mstrmojo.tooltip.POS_BOTTOMCENTER;}else{if(f){X+=" right-column";}}g.richTooltip={cssClass:X,content:d,top:Math.max(Y.y,0),left:Z,posType:b,enableHover:true};this._super(c,a);}},getItemProps:function V(a,X){var Y=mstrApp.getRootController().getModel(),Z=this._super(a,X),b=Y.getImportSource(a.tableId);Z.tp=a.tp||"";if(a.tableName){Z.name=mstrmojo.string.encodeHtmlString(a.tableName);}else{if(b&&b.sourceInfo){Z.name=mstrmojo.string.encodeHtmlString(b.sourceInfo.name);}else{Z.name="";}}if(a.isHeader){Z.name=mstrmojo.string.encodeHtmlString(a.name);Z.addCls("header");}Z.comment=a.comment||"";return Z;}});function A(X){R.addClass(X.warningTitle.domNode,"warningContent");R.addClass(X.warningLabel.domNode,"warningContent");R.addClass(X.collapseButton.domNode,"left-float");R.addClass(X.domNode,"resize");X.set("title",mstrmojo.desc(15209,"Refresh Dataset"));X.btnHbox.okButton.set("text",mstrmojo.desc(212,"Continue"));R.removeClass(X.btnHbox.okButton.domNode,"hot");}mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog",cssClass:"mstrmojo-MissingColumnWarning",warning:mstrmojo.desc(12598,"The following previously uploaded columns are missing"),details:mstrmojo.desc(13164,"If you publish without these columns, existing reports, documents and analyses based on this cube might be affected. Tables with all missing columns will not be republished. Do you still want to continue?"),showDetails:false,useRichTooltip:false,children:[{scriptClass:"mstrmojo.Image",cssClass:"cf mstrmojo-MissingColumnWarning-image",alias:"errorIcon"},{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-MissingColumnWarning-title warning-title",alias:"warningTitle"},{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-MissingColumnWarning-title",alias:"warningLabel"},{scriptClass:"mstrmojo.ui.Checkbox",cssClass:"mstrmojo-details-toggle",alias:"detailsToggler",oncheckedChange:function(){this.parent.set("showDetails",this.checked);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-MissingColumnWarning-collapsed",alias:"collapseButton",text:mstrmojo.desc(14058,"Show Details"),onclick:function(){this.parent.set("showDetails",!this.parent.showDetails);}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-MissingColumnWarning-collapsedBox",alias:"colllapsedBox",visible:false,children:[{scriptClass:"mstrmojo.DI.ui.dialogs.DIMissingColumnsList",cssClass:"mstrmojo-MissingColumnWarning-list",alias:"list"},{scriptClass:"mstrmojo.Box",alias:"detailMsgBox"}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var Y=this.parent.parent,X=true;if(Y.onOK){X=Y.onOK();}if(X){Y.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var Y=this.parent.parent,X=true;if(Y.onCancel){X=Y.onCancel();}if(X){Y.close();}}}],onshowDetailsChange:function(){this.colllapsedBox.set("visible",this.showDetails);this.positionDialog();this.collapseButton.set("text",this.showDetails?mstrmojo.desc(14059,"Hide Details"):mstrmojo.desc(14058,"Show Details"));this.detailsToggler.set("checked",this.showDetails);},onOpen:function(){var h=[{isHeader:true,n:mstrmojo.desc(122,"Columns"),name:mstrmojo.desc(1761,"Tables"),comment:mstrmojo.desc(6724,"Comment")}];var d=mstrApp.getRootController().getModel(),b=this.results,n=[],o=[],f=["0","0","0"],m,Y,X=[],a=[],k=[],g=this.btnHbox.okButton,l=this.btnHbox.cancelButton;this.set("title",mstrApp.isCloudPro?mstrmojo.desc(9161,"Oops!"):mstrmojo.desc(3610));this.set("showDetails",false);if(!b){return ;}g.set("visible",true);l.set("visible",true);l.set("text",mstrmojo.desc(221,"Cancel"));R.removeClass(l.domNode,"hot");this.colllapsedBox.list.set("visible",false);R.removeClass(this.colllapsedBox.detailMsgBox.domNode,"margin-left-90");if(b.hasError){n.push("<ul>");m=mstrmojo.desc(14302,"We encountered some errors while republishing the cube.");var Z=[];Q.forEach(b.errorTableTbids,function(u){var t=d.getImportSource(u),p=t&&t.sourceInfo&&mstrmojo.string.htmlAngles(t.sourceInfo.name),q=(b.errorTableErrMsg&&b.errorTableErrMsg[u])?b.errorTableErrMsg[u]:N.getBackendErrorStr(b.errorTableErrCode[u],t.type);n.push("<li>");n.push(p+"<br>"+q);Z.push(p+": "+q);n.push("</li>");});n.push("</ul>");this.warningTitle.set("text",J);this.warningLabel.set("text","");R.addClass(this.colllapsedBox.detailMsgBox.domNode,"margin-left-90");A(this);if(b.errorTableTbids.length){o.push(new mstrmojo.Label({allowHTML:true,cssClass:"mstrmojo-MissingColumnWarning-detailMsg",text:Z.join("<br>")}));if(o.length>0){this.colllapsedBox.detailMsgBox.removeChildren();this.colllapsedBox.detailMsgBox.addChildren(o);this.colllapsedBox.detailMsgBox.set("visible",true);}this.colllapsedBox.set("visible",false);}l.set("text",mstrmojo.desc(8708,"OK"));R.addClass(l.domNode,"hot");g.set("visible",false);var j=this;window.setTimeout(function(){j.positionDialog();});return ;}Q.forEach(b.missingTableTbids,function(t){var q=d.getImportSource(t),p=q&&q.sourceInfo&&q.sourceInfo.name;X.push(p);});Q.forEach(b.missingColumnTbids,function(t){var q=d.getImportSource(t),p=q&&q.sourceInfo&&q.sourceInfo.name,u=b.missingColumns[t];a.push(p);Q.forEach(u,function(w){h.push({n:mstrmojo.string.encodeHtmlString(w.n),tableId:t,comment:mstrmojo.desc(13447,"Missing Columns")});});});var c=B;Q.forEach(b.mismatchedDatatypeTbids,function(t){var q=d.getImportSource(t),p=q&&q.sourceInfo&&q.sourceInfo.name,u=b.mismatchedDatatypeColumns[t];k.push(p);Q.forEach(u,function(w){h.push({n:mstrmojo.string.encodeHtmlString(w.n),tableId:t,comment:c.replace("###",N.getDataTypeString(w.src.ddt)).replace("***",N.getDataTypeString(w.ddt))});});});if(a.length>0){f[0]="1";n.push(G().column);Y=I.replace("###",mstrmojo.desc(15224,"missing columns"));}if(k.length>0){f[1]="1";n.push(G().datatype);Y=I.replace("###",mstrmojo.desc(15225,"mismatched datatypes"));if(a.length>0){Y=I.replace("###",mstrmojo.desc(15226,"missing columns and mismatched datatypes"));}}if(X.length>0){f[2]="1";n.push(G().table.replace("###",X.join(", ")));if(a.length>0||k.length>0){if(a.length>0&&k.length===0){Y=O.replace("###",mstrmojo.desc(15224,"missing columns"));}else{if(a.length===0&&k.length>0){Y=O.replace("###",mstrmojo.desc(15225,"mismatched datatypes"));}else{Y=O.replace("###",mstrmojo.desc(15226,"missing columns and mismatched datatypes"));}}}else{Y=H;}g.set("visible",false);l.set("text",mstrmojo.desc(8708,"OK"));R.addClass(l.domNode,"hot");}var e=f.join("");m=P()[e];A(this);this.warningTitle.set("text",m);this.warningLabel.set("text",Y);this.detailsToggler.set("checked",false);if(h.length>1){this.colllapsedBox.list.set("items",h);this.colllapsedBox.list.set("visible",true);}else{this.colllapsedBox.list.set("items",null);this.colllapsedBox.list.set("visible",false);}Q.forEach(n,function(p){o.push(new mstrmojo.Label({cssClass:"mstrmojo-MissingColumnWarning-detailMsg",text:p}));});if(o.length>0){this.colllapsedBox.detailMsgBox.removeChildren();this.colllapsedBox.detailMsgBox.addChildren(o);}this.colllapsedBox.set("visible",false);var j=this;window.setTimeout(function(){j.positionDialog();});},onOK:function(){var X=mstrApp.getRootController();X.handleRepublishError(this.results);return true;},onCancel:function(){mstrApp.getRootController().cancelRepublishError(this.results);return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(2140);var B=mstrmojo.array;mstrmojo.ME._DerivedMetricEditorHelper=mstrmojo.provide("mstrmojo.ME._DerivedMetricEditorHelper",{isDME:true,noCache:false,closeLabel:mstrmojo.desc(2140,"Cancel"),saveAsEnabled:false,tbBrowsable:false,init:function C(D){this._super(D);},onApplyMetricCallback:mstrmojo.emptyFn,optionPopupRef:{scriptClass:"mstrmojo.ME.DerivedMetricOptions",title:mstrmojo.desc(13035,"Metric Options"),help:"create_derived_metric.htm",width:300},replaceAttributeWithForms:function A(E){var D=[];B.forEach(E,function(F){if(F.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute&&F.fs){B.forEach(F.fs,function(G){if(G.obf||F.da){D.push({n:F.n+"@"+G.fnm,did:F.did+"@"+G.fid,fmdid:G.fid,fnm:G.fnm,t:G.t,frm:G,oi:F,path:F.path});}});}else{D.push(F);}});return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIMultiFormEditor","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13134,13136,13396,13887,14451);var h=mstrmojo.DI.DIConstants,D=mstrmojo.DI.DIConstants.formsOptions,O=mstrmojo.array,Z=mstrmojo.hash,J=mstrmojo.DI.DIHelpers;function L(m,l){var o=m.linkedTbs,j=m.tableId,n=l.linkedTbs,t=l.tableId,p,q,k;if(!o&&!n){return j===t;}if(o&&n){p=false;Z.forEach(n,function(u,w){if(u){if(o[w]){p=true;return false;}}});return p;}q=o||n;k=o?t:j;return q[k];}function H(k,l,m,n){var j=O.find(k,l,n);if(j<0){return"";}return Z.walk(j.toString()+"."+m,k);}function F(l,k){var j=O.map(l,function(m){if(m.formId===k){return 0;}else{return 1;}});return j.join(",");}function Y(u,p,n){var AB="ID",w,j,AF,AE="DESC",x,k,z,q,t,AD,l,AA,o="",m,AC;if((u&&u.length===0)||p.length===0){return"";}AA=Z.walk("0.forms",p);w=H(AA,"fmn","fmid",AB);x=H(AA,"fmn","fmid",AE);j=H(p,"formId","columnId",w);k=H(p,"formId","columnId",x);AF=H(u,"columnId","georole",j);z=H(u,"columnId","georole",k);if(n){if(!AF){AF=H(n,"did","georole",j);}if(!z){z=H(n,"did","georole",k);}}if(AF>0){o=F(p,w);}else{if(z>0){o=F(p,x);}else{m=O.filter(u,function(AG){return AG.georole>0;});if(n){AC=O.filter(n,function(AG){return AG.georole>0;});}if(m.length===0){o=O.map(p,function(AG){return"0";}).join(",");return o;}q=H(m,"dtp","columnId",h.dataTypeMenuItems.TEXT);if(n&&!q){q=H(AC,"dtp","did",h.dataTypeMenuItems.TEXT);}if(q){t=H(p,"columnId","formId",q);o=F(p,t);}else{AD=m[0].columnId;if(n&&!AD){AD=AC[0].did;}l=H(p,"columnId","formId",AD);o=F(p,l);}}}return o;}mstrmojo.DI.controller.DIFormsController=mstrmojo.declare(mstrmojo.Obj,null,{getLinkedAttribute:function b(j){var k,l=[];for(k=0;k<j.length;k++){if(this.isLinkedAttribute(j[k])){l.push(j[k]);}}return l;},countLinkedAttribute:function b(j){var l=0,k;for(k=0;k<j.length;k++){if(this.isLinkedAttribute(j[k])){l++;}}return l;},countSingleFormLinkedAttribute:function R(j){var l=0,k;for(k=0;k<j.length;k++){if(this.isLinkedAttribute(j[k])&&this.isAllSingleFormAttribute(j[k])){l++;}}return l;},getLinkedColumnId:function K(m,j,n){var l,k;if(this.isLinkedAttribute(m)&&!this.isSingleFormAttribute(m)){k=m.subColumns;for(l=0;l<k.length;l++){if(k[l].fmid===n||k[l].isIdForm){return k[l].did;}}}else{for(l=0;l<j.length;l++){if(this.isLinkedAttribute(j[l])){return j[l].did;}}}},isLinkedAttribute:function g(j){return j.isLinked;},isSingleFormAttribute:function Q(j){return !(j.isMultiForm);},isAllSingleFormAttribute:function(l){var k=true,j;if(!l.isLinked){k=!(l.isMultiForm);}else{j=mstrApp.getRootController().getModel().findMappingItem(l);O.forEach(j,function(m){if(m.isMultiForm){k=false;return false;}});}return k;},isVisible:function X(k,j){switch(k){case D.ADDTO_MULTIFORM_ATTRIBUTE:return this.isVisibleAddtoMultiformAttribute(j);case D.CREATE_MULTIFORM_ATTRIBUTE:return this.isVisibleCreateMultiformAttribute(j);case D.EDIT_MULTIFORM_ATTRIBUTE:return this.isVisibleEditMultiformAttribute(j);}return false;},isVisibleAddtoMultiformAttribute:function P(k){if(k.length<2){return false;}var l=0,j;for(j=0;j<k.length;j++){if(!(this.isAllSingleFormAttribute(k[j]))){l++;}if(l>=2){return false;}if(k[j].ipa){return false;}if(!L(k[0],k[j])){return false;}}return(l===1);},isVisibleCreateMultiformAttribute:function d(k){if(k.length<2){return false;}var j;for(j=0;j<k.length;j++){if(!(this.isAllSingleFormAttribute(k[j]))){return false;}if(k[j].ipa){return false;}}return true;},isVisibleEditMultiformAttribute:function W(j){if(j.length!==1){return false;}return !(this.isSingleFormAttribute(j[0]))&&j[0].subColumns&&j[0].subColumns[0].ipa!==1;},onClick:function I(k,m,l,j){switch(k){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.onClickAddtoMultiformAttribute(m,j);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.onClickCreateMultiformAttribute(m,l,j);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.onClickEditMultiformAttribute(m,l);break;}},onClickAddtoMultiformAttribute:function C(m,k){var l=null,j;for(j=0;j<k.length;j++){if(!(this.isAllSingleFormAttribute(k[j]))){if(l!==null){return ;}l=k[j];}}var n=this.countSingleFormLinkedAttribute(k);if(this.isLinkedAttribute(l)){if(n>=1){this.showUnlinkError();}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,m,l,k,true);}}else{if(n>=2){this.showUnlinkError();}else{if(n===1){l=this.getLinkedAttribute(k)[0];this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,m,l,k,true);}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,m,l,k,false);}}}},checkMultiLinkedAttributes:function N(u){var q=this.getLinkedAttribute(u);var p=mstrApp.getRootController();var o=p.model;var z,x=[],t;O.forEach(q,function(j){t="";z=o.findMappingSource(j);O.forEach(z,function(AA){t+=AA.tableID;t+=";";});x.push(t);});var w=x[0].split(";");var n,m,l=false,k=w.length;for(n=0;n<x.length;n++){if(x[n].split(";").length!==k){l=true;break;}}if(l){return false;}for(n=0;n<w.length;n++){for(m=1;m<x.length;m++){if(x[m].indexOf(w[n])===-1){l=true;break;}}}if(l){return false;}return true;},onClickCreateMultiformAttribute:function B(o,n,m){var l=this.countLinkedAttribute(m),p=mstrApp.getRootController(),j=false,q=false;for(var k=0;k<m.length;k++){if(m[k].recursive){j=true;}else{if(m[k].isLinked){q=true;}}}if(j&&q){p.displayError(mstrmojo.desc(null,"We do not support a MFA with a linked non-hierarchy attribute."));return ;}if(l>=2){if(!this.checkMultiLinkedAttributes(m)){this.showCreateMFAError();return ;}n=this.getLinkedAttribute(m)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,o,n,m,true,true);}else{if(l===1){n=this.getLinkedAttribute(m)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,o,n,m,true);}else{this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,o,n,m,false);}}},onClickEditMultiformAttribute:function c(k,j){if(this.isLinkedAttribute(j)){this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,k,j,[j],true);}else{this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,k,j,[j],false);}},showMultiformDialog:function f(p,k,j,o,t,n){var q=mstrApp.getRootController(),u=this.showMultiformDialog2,m="",w;for(w=0;w<o.length;w++){m+=o[w].oid;if(w<o.length-1){m+=",";}}var l={tableID:k,selectedAttributeIds:m};var x={success:function(z){u(p,k,j,o,t,z,n);},failure:function(z){q.displayError(mstrmojo.desc(13134,"Cannot retrieve attribute form info.")+z);}};q.dataService.getAttributeGroupInfo(x,l);},showMultiformDialog2:function A(q,o,p,n,l,AE,k){var t=[],j=[],AC=[],m=null,u={},AD,w,z;var AB=function(AG,AF){return AG.name===AF.name;};u.tableIds=[o];u.tables={};j=AE.agi.fms;AC=AE.agi.attribute_forms;m=AE.agi.ts;if(q===D.EDIT_MULTIFORM_ATTRIBUTE&&l&&m.length>1){z=m[0].maps;for(w=1;w<m.length;w++){z=J.getCommonElements(z,m[w].maps,AB);}if(z.length>=2){k=true;}}for(w=0;w<m.length;w++){var AA=m[w];t=AA.maps;var x=AA.tbid;if(x!==o){u.tableIds.push(x);}AD=mstrApp.getRootController().formsController.populateMFACommand(t,j,AC,q,l,p,n,AA.tbid,AA.tbn,k);u.tables[x]=AD;}mstrApp.getRootController().showDialog(h.dialogType.multiFormEditor,u);},populateMFACommand:function e(AE,k,AO,AC,t,AB,x,AA,n,m){var u=[],AM=null,z,AK,AG,AJ,AH;z=k[0].fmid;AK=k[0].fmn;AG=k.slice(0);O.forEach(AE,function(AS){var l=O.find(AG,"fmid",AS.fmid);if(l<0){var AR=O.find(AO,"fmid",AS.fmid);if(AR>=0){AG.push({fmid:AO[AR].fmid,fmn:AO[AR].fmn,});}else{AG.push({fmid:AS.fmid,fmn:AS.fmn||AS.name});}}});if(t&&!m){if(AG[0].fmn==="ID"){AG.splice(0,1);}}for(AJ=0,AH=AE.length;AJ<AH;AJ++){var p=AE[AJ],j=p.cmid,AQ=p.name,AP=p.fmid,q=p.flags,AF=p.alias,w=p.isdf?"1":"0",o=p.atid;var AD=O.find(x,"did",j);if(AD!==-1){AQ=x[AD].alias;}var AL={columnId:j,name:AQ,formId:AP,displayForm:w,remove:"0",forms:AG,flags:q,alias:AF,atid:o};u.push(AL);if(AP===z){AM=AL;}}var AN={};AN.formsOption=AC;AN.tableId=AA;AN.tableName=n;AN.attribute=AB;AN.attributes=x;AN.isShared=t;AN.isMultiLinked=m;AN.formMaps=u;AN.idMap=AM;AN.idFormId=z;AN.idFormName=AK;if(t){var AI=mstrApp.getRootController().formsController.getLinkedColumnId(AB,x,z);if(AI){AN.linkedColumnId=AI;}}return AN;},showUnlinkError:function M(){var j=mstrApp.getRootController();j.displayError(mstrmojo.desc(13396,"Unlink the Attribute that you want to use as the Non-ID form."));},showCreateMFAError:function V(){var j=mstrApp.getRootController();j.displayError(mstrmojo.desc(14451,"Unable to create Multi-form attribute since the selected attributes are not present in all tables."));},updateMapping:function G(l,n,m,j,o,q,k,p){switch(l){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.updateMappingAddtoMultiformAttribute(n,m,j,o,q,k,p,514);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.updateMappingCreateMultiformAttribute(n,m,o,q,k,p,514,j);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.updateMappingEditMultiformAttribute(n,m,j,o,q,k,p,640);break;}},updateMappingAddtoMultiformAttribute:function U(n,m,k,o,q,l,p,j){this.updateMappingSourceTable(n,false,m.oid,m.alias,q,l,p,j,k);},updateMappingCreateMultiformAttribute:function E(n,m,o,q,l,p,j,k){if(o){this.updateMappingSourceTable(n,true,m.oid,m.alias,q,l,p,j,k);}else{this.updateMappingSourceTable(n,true,"",m.alias,q,l,p,j,k);}},updateMappingEditMultiformAttribute:function a(n,m,k,o,q,l,p,j){this.updateMappingSourceTable(n,false,m.oid,m.alias,q,l,p,j);},updateMappingSourceTable:function S(AB,k,AG,AE,u,AN,o,q,x){if(k){AG="";}var AH="",t="",w="",n="",AL="",AF="",AD="",AK,AP,AJ,p,z,AA=x?O.find(x,"columnId",AN.columnId):-1,m=mstrApp.getRootController().getModel();for(AK=0;AK<u.length;AK++){AH+=u[AK].columnId;if(AK<u.length-1){AH+=",";}t+=u[AK].formId;if(AK<u.length-1){t+=",";}w+=u[AK].displayForm;if(AK<u.length-1){w+=",";}n+=u[AK].remove;if(AK<u.length-1){n+=",";}var AI=u[AK].flags;if((AI&h.formMappingFlag.formMappingFlagRemoveGeoRole)===h.formMappingFlag.formMappingFlagRemoveGeoRole){AL+="1";}else{AL+="0";}if(AK<u.length-1){AL+=",";}if((AI&h.formMappingFlag.formMappingFlagRemoveTimeRole)===h.formMappingFlag.formMappingFlagRemoveTimeRole){AF+="1";}else{AF+="0";}if(AK<u.length-1){AF+=",";}if((AI&h.formMappingFlag.formMappingFlagRemoveDeriveFlags)===h.formMappingFlag.formMappingFlagRemoveDeriveFlags){AD+="1";}else{AD+="0";}if(AK<u.length-1){AD+=",";}}if(k){AL=Y(x,u);}else{var j=H(x,"isMultiForm","subColumns",true);AL=Y(x,u,j);}var AM={newAttribute:k,tableId:AB,attributeId:AG,attributeName:AE,idMapColumnId:AN.columnId,idMapFormId:AN.formId,idMapDisplayForm:AN.displayForm,formMapsColumnIds:AH,formMapsFormIds:t,formMapsDisplayForms:w,formMapsRemoves:n,formMapsRemoveGeoRoleFlags:AL,formMapsRemoveTimeRoleFlags:AF,formMapsRemoveDeriveFlags:AD,};if(AA>=0&&x[AA].recursive){p=x[AA];m.set("hierarchyMFA",true);AM.recursive="1";AP=m.getHierarchyRdcs(p.oid);AJ=m.getHierarchyRelationTabele(p.oid);z={tbid:AJ,mapping:J.getHierarchyMappingXML(null,AP)};m.set("hierarchyMFAMapping",JSON.stringify(z));}if(q!==undefined){AM.formMapsFlags=q;}var AC=mstrApp.getRootController();var AO=this;var l={success:function(AR){var AQ=AC.model;var AS=AQ.getImportSource(AB);AS.invalidPreview();if(AS.canAutoMappingAndDetectRelation()){AC.dataService.detectRelationshipSourceTable(o||AO.onRSDetected,{did:AB});}else{if(o&&o.success){o.success(AR);}else{AO.onRSDetected.success(AR);}}},failure:function(AR){var AQ=mstrApp.getRootController();AQ.displayError(mstrmojo.desc(13136,"Cannot remap columns. "),false,AR.message);}};AC.dataService.updateMappingSourceTable(l,AM);},onRSDetected:{success:function(l){var k=mstrApp.getRootController();k.dataService.set("messageID",l.msgid);var j=h.requestFlag.mapping|h.requestFlag.sourceInfo|h.requestFlag.relationship;k.getImportedDataEMMA(h.actions.none,j);},failure:function(){var j=mstrApp.getRootController();j.displayError(mstrmojo.desc(13136,"Cannot remap columns."));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog","mstrmojo.DI.DIInlineEditBox","mstrmojo.DI.DIHelpers","mstrmojo.UUID","mstrmojo.hash");mstrmojo.requiresDescs(218,219,517,518,221,8149,9912,11164,12532,12818,12819,12820,12821,12822,12823,12824,12825,12826,12827,12828,12829,12830,12831,12832,12833,12834,12835,12892,13266,13301,13331,13332,13333,13334,13335,13336,13337,13338,14196,14197);var d=mstrmojo.array,x=mstrmojo.string,p=mstrmojo.DI.DIHelpers,e=mstrmojo.UUID,U=mstrmojo.hash,m=mstrmojo.DI.DIConstants,k=m.actions,G=4;function h(AA,AC,AE){var AD={},AF=AA;var AB,z;for(AB=0,z=AC.length;AB<z;AB++){if(AC[AB].tp===AE){AD[AC[AB].alias]=1;}}AB=0;while(AD[AF]){AF=AA+" ("+(++AB)+")";}return AF;}function D(AD,z){var AC,AB,AA,AE;for(AC=0;AC<z.length;AC++){AA=z[AC];for(AB=0;AB<AD.length;AB++){AE=AD[AB];if(AE.fmid===AA.fmid){AA.georole=AE.georole;AA.der=AE.der;}}}}function P(AC,z){var AB,AA;for(AB=0;AB<z.length;AB++){AA=z[AB];if(AA.fmn===AC){return AA;}}return null;}function K(AA,AC,z){var AB=false;d.forEach(AC,function(AD){if(AD.fmid===z.fmid&&AD[AA]!==z[AA]){if(AD[AA]&&AD[AA]!==0){z[AA]=AD[AA];AB=true;}else{if(z[AA]&&z[AA]!==0){AD[AA]=z[AA];AB=true;}}}});return AB;}function J(AB,z){var AA=false;d.forEach(AB,function(AC){if(AC.fmid===z.fmid&&AC.der!==z.der){AC.der=z.der|AC.der;z.der=z.der|AC.der;AA=true;}});return AA;}function l(AA,z){var AB=false;if(AA.isMultiForm&&z.isMultiForm){d.forEach(AA.subColumns,function(AC){AB=AB||K("georole",z.subColumns,AC);});}else{if(AA.isMultiForm&&!z.isMultiForm){AB=K("georole",AA.subColumns,z);}else{if(!AA.isMultiForm&&z.isMultiForm){AB=K("georole",z.subColumns,AA);}else{if(AA.georole!==z.georole){if(AA.georole&&AA.georole!==0){z.georole=AA.georole;AB=true;}}}}}return AB;}function B(AA,z){var AB=false;if(AA.isMultiForm&&z.isMultiForm){d.forEach(AA.subColumns,function(AC){AB=AB||J(z.subColumns,AC);});}else{if(AA.isMultiForm&&!z.isMultiForm){AB=J(AA.subColumns,z);}else{if(!AA.isMultiForm&&z.isMultiForm){AB=J(z.subColumns,AA);}else{if(AA.der!==z.der){z.der=AA.der|z.der;AA.der=AA.der|z.der;AB=true;}}}}return AB;}function f(AA,z){var AB=false;if(AA.isMultiForm&&z.isMultiForm){d.forEach(AA.subColumns,function(AC){AB=AB||K("timerole",z.subColumns,AC);});}else{if(AA.isMultiForm&&!z.isMultiForm){AB=K("timerole",AA.subColumns,z);}else{if(!AA.isMultiForm&&z.isMultiForm){AB=K("timerole",z.subColumns,AA);}else{if(AA.timerole!==z.timerole){if(AA.timerole&&AA.timerole!==0){z.timerole=AA.timerole;AB=true;}else{if(z.timerole&&z.timerole!==0){AA.timerole=z.timerole;AB=true;}}}}}}return AB;}function C(AA,z){AA.tp=12;AA.selected=true;AA.georole=z.georole;AA.der=z.der;AA.shapeKey=z.shapeKey;}function H(AA,z){AA.tp=12;AA.selected=true;AA.timerole=z.timerole;}function b(z){var AB=this;var AA=AB.model.importSources;d.forEach(z,function(AF){var AD=AA[AF.tableId];var AC=AD.currentIndex;var AG=AD.originalMappings[AC];var AE=AD.mappings[AC];d.forEach(AG,function(AI,AH){if(AI.id===AF.id){AE[AH]=mstrmojo.hash.clone(AI);return false;}});});}function N(AB,AC,AA){var z=false;d.forEach(AC,function(AD){if(AD.fmid===AA.fmid){if(AD[AB]!==0&&AA[AB]!==0&&AD[AB]!==AA[AB]){z=true;return false;}}});return z;}function L(AE,z,AD){var AA=mstrApp.getRootController();var AC=false;if(AE.ipa){AA.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var AB=false;d.forEach(z,function(AH){if(AH.ipa){AB=true;return false;}if(AH.recursive||AE.recursive){AC=true;}if(AH.isMultiForm||AE.isMultiForm){var AI=(AH.subColumns||[]).concat(AE.subColumns||[]);d.some(AI,function(AJ){if(AJ.recursive){AC=true;return true;}});}});if(AC){AA.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}if(AB){AA.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var AF={success:function(AH){if(AH&&AH.msgid){AA.dataService.set("messageID",AH.msgid);}w(AE,z,AD,null,16);},failure:function(){b.call(AA,z);AA.displayError(mstrmojo.desc(13334,"Error to map two attributes"));}};var AG={success:function(){var AI=false;var AH=false;d.forEach(z,function(AJ){if(AE.georole&&AJ.georole&&AE.georole!==0&&AJ.georole!==0&&AE.georole!==AJ.georole){if(AE.isMultiForm&&AJ.isMultiForm){d.forEach(AE.subColumns,function(AK){if(N("georole",AJ.subColumns,AK)){AH=true;return false;}});}else{if(AE.isMultiForm&&!AJ.isMultiForm){if(N("georole",AE.subColumns,AJ)){AH=true;return false;}}else{if(!AE.isMultiForm&&AJ.isMultiForm){if(N("georole",AJ.subColumns,AE)){AH=true;return false;}}else{AH=true;}}}if(AH){AA.displayError(mstrmojo.desc(13332,"Cannot map two attribute which has different geo role"));b.call(AA,z);return false;}}if(AE.timerole&&AJ.timerole&&AE.timerole!==0&&AJ.timerole!==0&&AE.timerole!==AJ.timerole){if(AE.isMultiForm&&AJ.isMultiForm){d.forEach(AE.subColumns,function(AK){if(N("timerole",AJ.subColumns,AK)){AH=true;return false;}});}else{if(AE.isMultiForm&&!AJ.isMultiForm){if(N("timerole",AE.subColumns,AJ)){AH=true;return false;}}else{if(!AE.isMultiForm&&AJ.isMultiForm){if(N("timerole",AJ.subColumns,AE)){AH=true;return false;}}else{AH=true;}}}if(AH){this.displayError(mstrmojo.desc(13333,"Cannot map two attribute which has different time role"));b.call(AA,z);return false;}}AI=l.call(AA,AE,AJ)||AI;AI=B.call(AA,AE,AJ)||AI;AI=f.call(AA,AE,AJ)||AI;if(AI){AA.changeEMMAMappings(AF);}else{AF.success();return false;}});},failure:function(AI){var AJ;var AK=/\(.*\)/g.exec(AI.message);if(AK&&AK.length>0){AJ=AK[0].substr(1,AK[0].length-2);}var AH=function(){var AL=m.requestFlag.mapping|m.requestFlag.sourceInfo|m.requestFlag.relationship;AA.getImportedDataEMMA(k.none,AL);};AA.displayError(AJ,false,null,AH);b.call(AA,z);}};w(AE,z,AD,AG,1);}function F(AB,AF,AD){var AA=mstrApp.getRootController(),AC=AA.getModel(),AE,z;if(!AB||!AF||!AB.tableId||!AF.tableId){return ;}AE=AC.getImportSource(AB.tableId).findMappingItem(AB);z=AC.findMappingItem(AF);L(AE,z,AD);}function w(AD,z,AC,AE,AB){var AA=mstrApp.getRootController();d.forEach(z,function(AF){AF.alias=AC;AF.oid=AD.id;AF.linkObjID=AD.id;});AA.changeEMMAMappings(AE,AB);}function I(AB,AD,z){var AA=this.model;var AE=AA.findMappingItem(AB);var AC;for(AC=0;AC<AE.length;AC++){if(AE[AC].tableId===AB.tableId){AE[AC].alias=AD;AE[AC].linkObjID="";if(AE[AC].tp===12){AE[AC].formID="";AE[AC].oid="";}AE[AC].lv=0;}}if(!z){this.changeEMMAMappings();}}function j(AE,z){var AA,AB,AC,AD;for(AA in z){AC=z[AA];if(AC.currentTransformations&&AC.currentTransformations.xtab&&AC.currentTransformations.xtab.isCrosstab){AD=AC.transformedMapping;}else{AD=AC.currentMapping;}for(AB=0;AB<AD.length;AB++){if(AD[AB].alias===AE){return AD[AB];}}}return null;}function S(AB,AA){var z;for(z=0;z<AB.length;z++){AB[z].alias=AA;if(this.linkObjID){AB[z].linkObjID=this.linkObjID;this.linkObjID=null;}if(AB.length>1){AB[z].lv=1;}}mstrApp.getRootController().changeEMMAMappings();}mstrmojo.DI.controller.DIMappingController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingController",changeDataType:function Z(AI,AG,AC){if(!AI||!AI.data||isNaN(AI.data[0].tp)){return ;}var AF=mstrApp.getRootController();var AA=AI.data[0];var AB=AF.model;var AE,AD;var AH;var z;AH=AB.findMappingItem(AA);for(AE=0;AE<AH.length;AE++){if(AH[AE].isMultiForm){z=AH[AE].subColumns;for(AD=0;AD<z.length;AD++){if(z[AD].afid===AA.afid){z[AD].dtp=AG;if(typeof AC==="number"&&!isNaN(AC)){z[AD].ctp=AC;}z[AD].selected=true;break;}}}else{AH[AE].dtp=AG;if(typeof AC==="number"&&!isNaN(AC)){AH[AE].ctp=AC;}AH[AE].selected=true;}}AF.changeEMMAMappings();},linkAttributes:function Q(AC,AK){if(!AC||!AK){return ;}var AE=AC.data[0],AI,AB,AF,z=AC.widget,AH=mstrmojo.dom.position(z.domNode),AJ=mstrmojo.dom.position(AC.node).y-AH.y,AG=mstrApp.getRootController(),AD=0;if(AJ>=22*3){if(z.containerNode.scrollTop<z.containerNode.scrollHeigh-z.containerNode.clientHeight){z.containerNode.scrollTop+=22;}else{}}AJ=mstrmojo.dom.position(AC.node).y-AH.y-5+AD;if(AJ<-40){AJ=-7;}var AA={scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-di-linkPopup",locksHover:true,slot:"domNode",children:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13301,"Map?"),cssClass:"mstrmojo-di-link-button",onclick:function(AL){mstrmojo.dom.stopPropogation(AL.hWin,AL.e);F(AE,AK.data[0],AE.alias);this.set("visible",false);}}],onOpen:function(){var AL=this.txt,AM=this.txtConfig;mstrmojo.hash.forEach(AM,function(AN,AO){AL.set(AO,AN);});}};AI=AK.data[0];if(AE.id===AI.id){AG.displayError(mstrmojo.desc(13335,"#### and @@@@ are already mapped.").replace("####",AE.alias).replace("@@@@",AI.alias));return ;}AB=AG.getModel().getImportSource(AI.tableId);AF=AG.getModel().getImportSource(AE.tableId);if(AF.findMappingItem(AI)){AG.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AI.alias).replace("@@@@",AF.sourceInfo.name));return ;}if(AB.findMappingItem(AE)){AG.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AE.alias).replace("@@@@",AB.sourceInfo.name));return ;}window.setTimeout(function(){z.openPopup(AA,{left:"9px",top:AJ+"px"});for(var AL=0;AL<z.containerNode.childNodes.length;AL++){if(z.containerNode.childNodes[AL].className.indexOf("selected")>=0){z.containerNode.childNodes[AL>0?AL-1:AL].scrollIntoView();break;}}},100);},renameSourceTable:function M(AF,AH){var AE=mstrApp.getRootController();var AD=AE.model;var z=AD.importSources;var AG=AD.getImportSource(AF);if(!AG){return ;}if(AG.sourceInfo&&AG.sourceInfo.name===AH){return ;}if(!AH||AH.length<=0){AE.displayError(mstrmojo.desc(12824,"Cannot rename table alias with empty string."));AD.raiseEvent({name:"MappingsFetched"});return ;}if(AH.length>=250){AE.displayError(mstrmojo.desc(12825,"Cannot rename table alias with a too long string."));AD.raiseEvent({name:"MappingsFetched"});return ;}if(m.invalidObjectNameCharsRegex.test(AH)){AE.displayError(mstrmojo.desc(12826,"Cannot rename table alis with string contains the following characters: ####.").replace("####",m.invalidObjectNameChars));AD.raiseEvent({name:"MappingsFetched"});return ;}for(var AC in z){if(z[AC].tableID!==AF&&z[AC].sourceInfo&&z[AC].sourceInfo.name===AH){AE.displayError(mstrmojo.desc(14197,"Cannot rename table alias with a used name."));return ;}}var AA={success:function(){var AI=m.requestFlag.mapping|m.requestFlag.sourceInfo|m.requestFlag.relationship;AE.getImportedDataEMMA(k.none,AI);},failure:function(AJ){var AI=parseInt(AJ.code,10);var AK=mstrmojo.desc(12827,"Cannot rename table alias.");switch(AI){case m.backendError.invalidObjectName:AK=mstrmojo.desc(12828,"Cannot rename table alias with invalid characters.");break;case m.backendError.stringTooLong:AK=mstrmojo.desc(12825,"Cannot rename table alias with a too long string.");break;}mstrApp.getRootController().displayError(AK,false,AJ.message);AD.raiseEvent({name:"MappingsFetched"});}};var AB={did:AF,xml:"",n:AH};AE.dataService.editEMMASourceTable(AA,AB);},renameTableItem:function R(AG,AD){var AI=mstrApp.getRootController(),AH=AI.model;var AK=mstrmojo.string.trim(AG.text);var AE=0,AC,AL=false;var AJ,AA,AB;if(AK===AD.alias){return false;}if(!AK||AK.length<=0){AI.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));AH.raiseEvent({name:"MappingsFetched"});return false;}if(AK.length>=250){AI.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));AH.raiseEvent({name:"MappingsFetched"});return false;}if(m.invalidObjectNameCharsRegex.test(AK)){AI.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",m.invalidObjectNameChars));AH.raiseEvent({name:"MappingsFetched"});return false;}var z=AH.findMappingSource(AD);if(z.length===0){return false;}for(AC=0;AC<z.length;AC++){AA=z[AC];if(AD.tp===G&&!AD.linkedTbs&&AD.tableId!==AA.tableID){continue;}if(AA.currentTransformations&&AA.currentTransformations.xtab&&AA.currentTransformations.xtab.isCrosstab){AJ=AA.transformedMapping;}else{AJ=AA.currentMapping;}for(AE=0;AE<AJ.length;AE++){if(AK===AJ[AE].alias&&AD.tp===AJ[AE].tp){AL=true;break;}}}if(AL){AB=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");AI.displayError(x.encodeHtmlString(AB.replace("##",AK)));AH.raiseEvent({name:"MappingsFetched"});return false;}var AF=j(AK,AH.importSources);if(AF&&AF.tp!==G&&AD.tp!==G){AB=mstrmojo.desc(13337,"#### is already being used by other attributes. Would you like to map to those attributes?").replace("####",AK);mstrmojo.confirm(AB,{confirmBtn:{t:mstrmojo.desc(13301,"Map?"),fn:function(){AJ=AH.findMappingItem(AD);F(AF,AJ[0],AK);return true;}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}else{if(AD.tp===4&&!AD.linkedTbs){AJ=AH.findMappingItem(AD,AD.tableId);}else{AJ=AH.findMappingItem(AD);}S(AJ,AK);return true;}},openRenameTextBox:function X(AH,AI,z,AJ){var AA=z.data[0],AG=AA.alias||AA.n,AD=this;var AE=AI;var AC=AI.parentNode;var AF=mstrmojo.insert({scriptClass:"mstrmojo.DI.DIInlineEditBox",text:AG||"",cssDisplay:"inline-block",placeholder:AI,onSave:function AB(){var AK;if(AH===m.contextMenuType.ITEM_MENU){AK=AD.renameTableItem(this,AA);if(!AK){AC.replaceChild(AE,this.domNode);}}else{if(AH===m.contextMenuType.TABLE_MENU){AC.replaceChild(AE,this.domNode);AD.renameSourceTable(AA.id,this.text);}else{if(AH===m.contextMenuType.LINK_MENU){F(AA,AJ.data[0],mstrmojo.string.decodeHtmlString(this.text));}}}}});if(parent&&parent.draggable){AF.parent=parent;}AF.render();AF.set("editMode",true);},openUnLinkDialog:function W(AB){if(!AB||!AB.data||isNaN(AB.data[0].tp)||!AB.data[0].selected){return ;}var AC=AB.data[0];var AA=AC.alias;var z=AC.tp===12?mstrmojo.desc(518,"attribute"):mstrmojo.desc(517,"metric");mstrApp.getRootController().showDialog(m.dialogType.previewRenameDialog,{curName:AC.alias,text:mstrmojo.desc(13338,"#### is currently being used by other @@@@. Please rename to unmap this @@@@").replace("####",AA).replace(/@@@@/g,z),onOk:function(AD){var AE=mstrApp.getRootController();var AF=mstrmojo.string.encodeXMLAttribute(AD);if(AF===AC.alias){AE.displayError(mstrmojo.desc(12834,"Please input a different name."));return false;}if(AF.length<=0){AE.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));return false;}if(AF.length>=250){AE.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));return false;}if(m.invalidObjectNameCharsRegex.test(AF)){AE.displayError(mstrmojo.desc(12835,"Cannot rename column with string contains the following characters: ")+m.invalidObjectNameChars);return false;}I.call(AE,AC,AF);return true;}});},unlinkAll:function q(AI,AG){var AF=mstrApp.getRootController(),AE=AF.getModel(),AA=AE.importSources,AH=AI.data,AD=false,z,AC=[],AB=false;if(!AG){AG=AH[0].tableId;}z=AE.getImportSource(AG);d.forEach(AH,function(AK){var AM;if(AK.recursive&&AK.rdcs){if(AK.rdcs.length===0){AC.push(AK);}else{if(AK.isLinked){for(var AJ in AA){if(AA.hasOwnProperty(AJ)&&AJ!==AK.tableId){AM=AA[AJ].findMappingItem(AK);if(AM){AC.push(AM);AB=true;}}}}}}else{if(AK.isMultiForm){for(var AL=0;AL<AK.subColumns.length;AL++){if(AK.subColumns[AL].recursive&&AK.subColumns[AL].rdcs){AC.push(AK);}}}}});if(AC.length){AF.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}d.forEach(AH,function(AJ){var AK;if(AJ.selected&&AJ.tp===12&&AJ.isLinked){AK=AJ.alias+" - "+z.sourceInfo.name;AK=AE.getUniqueAlias(12,AK);I.call(AF,AJ,x.encodeXMLAttribute(AK),true);AD=true;}});if(AD){AF.changeEMMAMappings();}},unlinkAllCubeLevel:function n(AC){var z=mstrApp.getRootController(),AA=z.getModel(),AD=AC.data,AE=false,AB=false;AB=d.some(AD,function(AF){if(AF.recursive){return true;}else{if(AF.isMultiForm){return d.some(AF.subColumns,function(AG){if(AG.recursive){return true;}});}}});if(AB){z.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}d.forEach(AD,function(AF){var AG;if(AF.selected&&AF.tp===12&&AF.isLinked){AG=AA.findMappingItem(AF);d.forEach(AG,function(AJ){var AI=AA.getImportSource(AJ.tableId),AH;AH=AJ.alias+" - "+AI.sourceInfo.name;AH=AA.getUniqueAlias(12,AH);I.call(z,AJ,x.encodeXMLAttribute(AH),true);AE=true;});}});if(AE){z.changeEMMAMappings();}},unmap:function g(AQ){var AG=AQ.data[0]||AQ.data;if(!AQ||!AQ.data||isNaN(AG.tp)||(AG.tp===4&&AG.selected)){return ;}var AN,AL;var AC=mstrApp.getRootController();var AM=AC.model;AL=AM.findMappingItem(AG);var AK,AE,AA=true;var AD=function AH(){for(AN=0;AN<AL.length;AN++){mstrmojo.array.forEach(AL[AN].subColumns,function(AR){AR.oid="";AR.fmid="";AK=AR.originalAlias;AR.alias=AK;});}AC.changeEMMAMappings();};var AI=[],AO=AG.alias,AF={success:function(){var AU,AR,AT;for(var AS=0;AS<AI.length;AS++){AU=U.walk("importSources."+AI[AS].tid+".currentMapping",AM);AR=d.find(AU,"did",AI[AS].did);if(AR<0){console.warn("error when finding attribute ",AI[AS]);continue;}AT=AU[AR];AT.alias=AI[AS].name;}mstrApp.getRootController().changeEMMAMappings();}};for(AN=0;AN<AL.length;AN++){if(AL[AN].isMultiForm&&AA){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:AD}});AA=false;}else{AL[AN].oid="";AL[AN].fmid="";AK=AL[AN].originalAlias;var AB=mstrApp.rootController.model,z=AB?AB.importSources:null,AJ=z?z[AL[AN].tableId].sourceInfo:null,AP=AJ?AJ.name:null;if(AK===AO){AL[AN].alias=AP?AK+" - "+AP:AK;}else{AL[AN].alias=AK;}}}if(AA){if(AI.length===0){AC.changeEMMAMappings();}else{AC.changeEMMAMappings(AF,undefined,true);}}},isSingleFormAttribute:function V(z){return !(z.isMultiForm);},toProjectAttribute:function u(AP,AI){var AE=AP.data[0]||AP.data;if(!AP||!AP.data||isNaN(AE.tp)||(AE.tp===4&&AE.selected)){return ;}var AJ=[];var AO,AM,AL,AQ,AC=[],AK;var z;var AD=mstrApp.getRootController().model;if(AP.data.length>1){this.toProjectAttribute2(AP,AI);return ;}z=AD.findMappingSource(AE);for(AO=0;AO<z.length;AO++){AK=z[AO];if(AK.currentTransformations&&AK.currentTransformations.xtab&&AK.currentTransformations.xtab.isCrosstab){AJ=AJ.concat(AK.transformedMapping);}else{AJ=AJ.concat(AK.currentMapping);}}if(AJ){for(AM=0;AJ&&AM<AJ.length;AM++){AQ=AJ[AM];if(AQ.type!=="amps"){continue;}if((AQ.id===AE.id)&&(AQ.isLinked||AQ.isMultiForm)){var AB=AQ.subColumns,AH;for(AL=0;AB&&AL<AB.length;AL++){AH=AB[AL];if(AH.georole){AE.georole=1;}var AG=mstrmojo.array.find(AC,"fmid",AH.fmid);if(AG<0){AC.push(AH);}}}}}var AA=function AF(){var AT={};AT.attribute=AE;if(AE.isMultiForm||AE.isLinked){var AR=AC,AU,AS;AS=d.find(AR,"isIdForm",true);if(AS>0){AU=AR[AS];AR.splice(AS,1);AR.unshift(AU);}AT.formMaps=AR;}mstrApp.getRootController().showDialog(m.dialogType.mapProjectsAttributeDialog,AT);},AN={confirmBtn:{fn:function(){AA();}}};if(AE.georole){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AN);}else{if(AE.timerole){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AN);}else{AA();}}},toProjectAttribute2:function(AC,AB){var AF=AC.data,z=d.some(AF,function(AG){return AG.georole;}),AD=d.some(AF,function(AG){return AG.timerole;}),AA=function(){var AG={tableId:AB||AF[0].tableId,attributes:AF};mstrApp.getRootController().showDialog(m.dialogType.mapProjectsAttributeDialog2,AG);},AE={confirmBtn:{fn:function(){AA();}}};if(z){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AE);}else{if(AD){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AE);}else{AA();}}},toUnused:function t(AF){if(!AF||!AF.data||isNaN(AF.data[0].tp)||!AF.data[0].selected){return ;}var AD=mstrApp.getRootController();var AA=AF.data;var z=AD.model;var AE,AC,AB,AG;for(AE=0;AE<AA.length;AE++){AB=AA[AE];AG=z.findMappingItem(AB);for(AC=0;AC<AG.length;AC++){if(AB.linkedTbs){AG[AC].selected=false;}else{if(AG[AC].tp===12){AG[AC].selected=false;}else{if(AG[AC].tableId===AB.tableId){AG[AC].selected=false;}}}}}AD.changeEMMAMappings();},toAttribute:function c(AF){var AH=[],AA=[],AG;var AC,AE,z;var AD=mstrApp.getRootController();var AB=AD.model;mstrmojo.array.forEach(AF,function(AI){if(!AI||isNaN(AI.tp)||(AI.tp===12&&AI.selected)){return ;}AG=[];AA=AB.findMappingSource(AI);for(AC=0;AC<AA.length;AC++){z=AA[AC];if(z.currentTransformations&&z.currentTransformations.xtab&&z.currentTransformations.xtab.isCrosstab){AG=AG.concat(z.transformedMapping);}else{AG=AG.concat(z.currentMapping);}}if(AI.tp!==12){AE=h(AI.alias,AG,12);}else{AE=AI.alias;}AH=AB.findMappingItem(AI);for(AC=0;AC<AH.length;AC++){AH[AC].alias=AE;AH[AC].tp=12;AH[AC].selected=true;}});AD.changeEMMAMappings();},toMetric:function a(AF){var AD=mstrApp.getRootController();var AB=AD.model;var AA=[],AH=[],AG;var AC,AE,z;mstrmojo.array.forEach(AF,function(AI){if(!AI||isNaN(AI.tp)||(AI.tp===4&&AI.selected)){return ;}AG=[];AA=AB.findMappingSource(AI);for(AC=0;AC<AA.length;AC++){z=AA[AC];if(z.currentTransformations&&z.currentTransformations.xtab&&z.currentTransformations.xtab.isCrosstab){AG=AG.concat(z.transformedMapping);}else{AG=AG.concat(z.currentMapping);}}if(AI.tp!==4){AE=h(AI.alias,AG,4);}else{AE=AI.alias;}AH=AB.findMappingItem(AI);for(AC=0;AC<AH.length;AC++){AH[AC].alias=AE;AH[AC].tp=4;AH[AC].selected=true;}});AD.changeEMMAMappings();},importItem:function o(AD){var AA=mstrApp.getRootController();var z=AA.model;var AE=[],AC,AB;if(!AD||isNaN(AD.tp)){return ;}AE=z.findMappingItem(AD);for(AC=0;AC<AE.length;AC++){if(AE[AC].idot===12){AE[AC].alias=AB;AE[AC].tp=AE[AC].idot;AE[AC].selected=true;}else{if(AE[AC].tableId===AD.tableId){AE[AC].alias=AB;AE[AC].tp=AE[AC].idot;AE[AC].selected=true;}}}AA.changeEMMAMappings();},setMultipleImport:function O(AE,AI,AF){var AC=mstrApp.getRootController();var AA=AC.model;var z=[],AH=[],AG;var AB,AD;mstrmojo.array.forEach(AE,function(AJ){if(!AJ||isNaN(AJ.tp)){return ;}AG=[];z=AA.findMappingSource(AJ);if(AJ.tp===0&&AJ.selected){AH=AA.findMappingItem(AJ);for(AB=0;AB<AH.length;AB++){if(AH[AB].idot===12){AH[AB].alias=AD;AH[AB].tp=AH[AB].idot;AH[AB].selected=true;}else{if(AH[AB].tableId===AJ.tableId){AH[AB].alias=AD;AH[AB].tp=AH[AB].idot;AH[AB].selected=true;}}}}});AC.changeEMMAMappings(AI,undefined,AF);},setTimeDimension:function A(AC){if(!AC||isNaN(AC.tp)||(AC.tp===4&&AC.selected)){return ;}var AB,AD;var AA=mstrApp.getRootController();var z=AA.model;AD=z.findMappingItem(AC);for(AB=0;AB<AD.length;AB++){if(AD[AB].isMultiForm){AD[AB].subColumns=AC.subColumns;}else{AD[AB].tp=12;AD[AB].selected=true;AD[AB].der=AC.der;}}AA.changeEMMAMappings();},setTimeRole:function Y(AD){if(!AD||isNaN(AD.tp)||(AD.tp===4&&AD.selected)){return ;}var AF=mstrApp.getRootController();var AE,AC,AH,AB,AG;var AA=AF.model;AH=AA.findMappingItem(AD);for(AE=0;AE<AH.length;AE++){var z=AH[AE];if(AH[AE].isMultiForm){if(AD.isMultiForm){AH[AE].subColumns=AD.subColumns;}else{for(AC=0;AC<z.subColumns.length;AC++){if(z.subColumns[AC].isIdForm){AB=z.subColumns[AC];break;}}H(AB,AD);}}else{if(AD.isMultiForm){for(AC=0;AC<AD.subColumns.length;AC++){if(AD.subColumns[AC].isIdForm){AG=AD.subColumns[AC];break;}}H(z,AG);}else{H(z,AD);}}}AF.changeEMMAMappings();},setGeoRoles:function E(AG){if(!AG||isNaN(AG.tp)||(AG.tp===4&&AG.selected)){return ;}var AH,AF,AK,AE,AJ,z;var AI=mstrApp.getRootController();var AC=AI.model;AK=AC.findMappingItem(AG);if(AG.isMultiForm){if(AG.mergeSubColumns){D(AG.mergeSubColumns,AG.subColumns);}}for(AH=0;AH<AK.length;AH++){var AA=AK[AH];if(AA.isMultiForm){if(AG.isMultiForm){if(AA.tableId===AG.tableId){AA.subColumns=AG.subColumns;}else{for(AF=0;AF<AG.mergeSubColumns.length;AF++){var AB=AG.mergeSubColumns[AF];var AD=P(AB.fmn,AA.subColumns);if(AB.georole&&AD){AE=AD;AE.georole=AB.georole;break;}}z=AE.fmn;for(AF=0;AF<AA.subColumns.length;AF++){if(AA.subColumns[AF].fmn!==z){AA.subColumns[AF].georole=0;}}}}else{for(AF=0;AF<AA.subColumns.length;AF++){if(AA.subColumns[AF].isIdForm){AE=AA.subColumns[AF];}else{AA.subColumns[AF].georole=0;}}C(AE,AG);}}else{if(AG.isMultiForm){for(AF=0;AF<AG.subColumns.length;AF++){if(AG.subColumns[AF].isIdForm){AJ=AG.subColumns[AF];break;}}C(AA,AJ);}else{C(AA,AG);}}}AI.changeEMMAMappings();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog");mstrmojo.requiresDescs(12390,12391,12392);var K=mstrmojo.DI.DIConstants,D=K.actions,I=mstrmojo.array,C=mstrmojo.desc,G={UPDATE_SINGLE_PARTITION:0,ADD_MULTI_PARTITION:1,SET_SINGLE_PARTITION:2,SET_SINGLE_PARTITION_URL:3,SET_SINGLE_PARTITION_EMMA:4,SET_SINGLE_PARTITION_EXCEL:5};mstrmojo.DI.controller.DIPartitionController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIPartitionController",getAllPartitionTables:function J(P,O){var N=mstrApp.getRootController();return N.model.getAllPartitionTables(P,O);},changePartition:function M(S,Q,P,V){var O=mstrApp.getRootController(),N,U,R;R=O.model.getImportSource(S);R.invalidPreview();N={success:function(X){var W=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",X.msgid);O.getImportedDataEMMA(D.none,W);},failure:function(W){O.displayError(C(12390,"Cannot change partition group."),false,W.message||"");}};U={mode:G.UPDATE_SINGLE_PARTITION,partitionId:S,addTables:JSON.stringify(Q),delTables:JSON.stringify(P)};O.dataService.changePartition(V||N,U);},setPartition:function H(R,P,U){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(W){var V=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",W.msgid);O.getImportedDataEMMA(D.none,V);},failure:function(V){O.displayError(C(12390,"Cannot change partition group."),false,V.message||"");}};S={mode:G.SET_SINGLE_PARTITION,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(U||N,S);},addMultiPartitions:function E(S,V){var O=mstrApp.getRootController(),P=O.model,U,Q=[],N,R;I.forEach(S,function(W){Q.push(W.tableIds.join(","));R=P.getImportSource(W.tableIds[0]);R.invalidPreview();});U={mode:G.ADD_MULTI_PARTITION,partitions:Q.join("|")};N={success:function(X){var W=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",X.msgid);if(V&&V.onOK){V.onOK();}else{O.getImportedDataEMMA(D.none,W);}},failure:function(W){O.displayError(C(12391,"Cannot group partitions."),false,W.message||"",V&&V.onCancel);}};O.dataService.changePartition(N,U);},setPartitionURL:function B(R,P,U){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(V){var W=V.msgid,X={};if(W){O.dataService.set("messageID",W);}X.url=P[0];O.autoMappingSourceTable(null,R,X);},failure:function(){O.displayError(C(12392,"Encounter error when set partition!"));}};S={mode:G.SET_SINGLE_PARTITION_URL,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(U||N,S);},setPartitionExcel:function A(S,O,Q){var P=mstrApp.getRootController(),N,U,R;if(Q.length<=0){return ;}R=P.model.getImportSource(S);R.invalidPreview();N={success:function(W){var X={shtIx:Q[0]};P.autoMappingSourceTable(null,S,X,S);for(var V=1;V<Q.length;V++){R.sheetsInfo[V].is1stSheetAutoMapped=true;}},failure:function(){P.displayError(C(12392,"Encounter error when set partition!"));}};U={mode:G.SET_SINGLE_PARTITION_EXCEL,partitionId:S,addSheetsName:JSON.stringify(O),addsheetsIndex:Q.join(",")};P.dataService.changePartition(N,U);},openPartitionGroupDialog:function F(N,P,O){mstrApp.getRootController().showDialog(K.dialogType.partitionGroupDialog,{groups:N,callback:P,isEditMode:O});},isSamePartitionGroups:function L(V,S){var Q={},N=true,P=V?V.length:0,O=S?S.length:0,U=0,R=0;if(P!==O){return false;}I.forEach(V,function(W){I.forEach(W.tableIds,function(X){Q[X]=true;U++;});});I.forEach(S,function(W){I.forEach(W.tableIds,function(X){if(!Q[X]){N=false;return false;}R++;});if(!N){return false;}});N=N&&(U===R);return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasScrollbox","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Widget","mstrmojo.ui.SimpleTree","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");var Y=mstrmojo,K=Y.array,b=Y.css,D=Y.dom,S=Y.hash,B=Y.string,a=mstrmojo.DI.DIConstants,L="selected",P="open",V="leaf",O="loading",G=":",A="li",J="ul",R="idx",N="level";function Z(o,g,m,k){var l=this.renderIndex*this.renderBlockSize,f=m.split(":"),n=parseInt(f[0],10)+l,h=!!this.selectedIndices[n],e=!!this.expandedIndices[n],j=(o.isLeaf||(!this.dataHelper&&!(o.items&&o.items.length)));f[0]=n;return B.apply('<{@tag} class="{@cls}" level="{@level}" idx="{@idx}">{@itemMkp}{@childMkp}</{@tag}>',{tag:A,cls:(h?L:"")+(e?" "+P:"")+(j?" "+V:""),level:g,idx:f.join(":"),itemMkp:this.itemRenderer.render(o,g,m,this),childMkp:k||""});}function M(n,f,j){var q=[],h=0,o=this.itemRenderer,m=o&&o.render,e=n&&n.length,l,k,p,g;q[h++]="<"+J+">";if(m&&typeof m==="function"&&e){for(g=0;g<n.length;g++){p=n[g];l=j.concat([g]);k=l.join(G);q[h++]=Z.call(this,p,f,k,M.call(this,p.items,f+1,l));}}q[h]="</"+J+">";return q.join("");}function W(f,g){var e=g[0];if(g&&g.length===1){return f[e];}return W(f[e].items,g.slice(1));}function X(f,g,h,l,e,k){var j=k.treeHooks[f];if(j&&j.call(k,g,h,l,e)){return ;}b.toggleClass(g,L,f==="select");}function H(f,j,t,e,p,m){var o=m.treeHooks[f],k=t.items,n=(!k||k.length===0),h=f==="expand",l=m.dataHelper;if(o&&o.call(m,j,t,e,p)){return ;}if(h&&!l&&n){b.addClass(j,V);return ;}if(h&&l){if(n){if(t.tp==="search"){b.toggleClass(j,P,h);return ;}b.toggleClass(j,O,true);l.fetch(t,{success:function q(w){var u=t.items=w.items;if(u&&u.length>0){j.innerHTML+=M.call(m,u,(parseInt(e,10)+1),t._renderIdx.split(G));}else{b.addClass(j,V);}},complete:function g(){b.toggleClass(j,O,false);}});}}b.toggleClass(j,P,h);}mstrmojo.ui.DIPublishSimpleTree=mstrmojo.declare(mstrmojo.ui.SimpleTree,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ui.DIPublishSimpleTree",markupString:'<div id="{@id}" class="mstrmojo-SimpleTree mstrmojo-DIPublishSimpleTree {@cssClass}" mstrAttach:click>{@itemsHTML}</div>',init:function U(e){this._super(e);},getItemMarkup:function(){return'<span class="{@cls} icon" style="display: {@icon_display}">&nbsp;</span><{@tag} class="{@cls}" style="{@style}" title={@n}>{@n}</{@tag}><div class="extra-action" style="display:{@extra_visible}">{@extra}</div>';},getItemProps:function c(g,h,f){var e={tag:"div",cls:"item ",n:g.n||"",style:"",idx:f,icon_display:"none"};if(g.isLeaf){e.cls+=g.dataSourceType;e.extra_visible=g.extra?"inline-block":"none";e.icon_display="inline-block";switch(g.dataSourceType){case a.dataSourceType.DROPBOX:case a.dataSourceType.GOOGLE_ANALYTICS:case a.dataSourceType.GOOGLE_BIGQUERY:case a.dataSourceType.GOOGLE_DRIVE:case a.dataSourceType.SALESFORCE:if(g.extra&&g.extra.isLoggedIn){e.extra="<div id='"+g.extra.loginEmail+"*"+f+"' class='loginName' title='"+g.extra.loginName+"'>"+g.extra.loginName+"</div>";}else{e.extra="<div class='mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton'><div class='mstrmojo-Button-text'>"+mstrmojo.desc(9935,"Log In")+"</div></div>";e.extra_visible="inline-block";}break;case a.dataSourceType.FILE_LOCAL:case a.dataSourceType.FILE_URL:if(g.extra&&g.extra.isUploaded){e.extra="<div class='mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton'><div class='mstrmojo-Button-text'>"+mstrmojo.desc(764,"Change")+"</div></div>";}else{e.extra="<div class='mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton'><div class='mstrmojo-Button-text'>"+mstrmojo.desc(505,"Update")+"</div></div>";e.extra_visible="inline-block";}break;default:e.extra="";}}return e;},addChild:function F(h,f){var k=this,e=k.getTreeItem(h).items,g=h.split(G);g.push(e.length);if(this.hasRendered){var j=this.domNode.getElementsByTagName(A);K.forEach(j,function(m){if(m.getAttribute(R)===h){var l=f[0];var n=document.createElement("div");n.innerHTML=Z.call(k,l,parseInt(m.getAttribute(N),10)+1,g.join(G),M.call(k,l.items,parseInt(m.getAttribute(N),10)+2,g));m.lastChild.appendChild(n.firstChild);e.push(l);return false;}return true;});}},updateChild:function C(f,e){var h=this;S.copy(e,h.getTreeItem(f));if(this.hasRendered){var g=this.domNode.getElementsByTagName(A);K.forEach(g,function(j){if(j.getAttribute(R)===f){var k=parseInt(j.getAttribute(N),10);j.innerHTML=h.itemRenderer.render(e,k,f,h)+M.call(h,e.items,k+1,f.split(G));return false;}return true;});}},removeChild:function I(g){var f=g.split(G),j=f.length,h=f[j-1],e=this;if(j>1){f=f.splice(0,j-1);e=this.getTreeItem(f.join(G));e.items.splice(h,1);this.updateChild(e._renderIdx,e);}else{this.items.splice(h,1);this.refresh();}},getItemWithPropName:function E(g,k,m){var f=K.find(g,k,m);var h,j=[];if(f!==-1){j.push(g[f]);}for(h=0;h<g.length;h++){var e=g[h].items;if(e&&e.length){var l=this.getItemWithPropName(e,k,m);if(l&&l.length){j=j.concat(l);}}}return j;},handleForOAuthSources:function Q(h,k,g){var f=mstrmojo.DI.DIHelpers.convertDataSourceType2SourceType(k),e=mstrApp.getRootController().getModel(),j=this;if(f>0){mstrApp.getRootController().setTableIDsForOAuth(h);mstrApp.getRootController().gotoOAuthLogin(f);e.externalSources[f].attachEventListener("oAuthReportsFetched",this.id,function(){var l=j.getTreeItem(g);if(l){l.extra={isLoggedIn:true,loginName:e.externalSources[f].userDisplayName,loginEmail:e.externalSources[f].userEmail};j.updateChild(g,l);}});}else{mstrmojo.alert("can not found such source Type");}},onclick:function d(o){try{var j=o.target||D.eventTarget(o.hWin,o.e),g=j.tagName.toLowerCase(),t=D.findAncestorByAttr(j,R,true,this.domNode),e=t&&t.node.getAttribute(N),n=t&&t.value,m=this;if(g===J){return ;}if(g==="div"&&j.className.indexOf("loginName")>=0){var u=new mstrmojo.ui.menus.EditorConfig({hostId:j.id,hostElement:j,isHostedWithin:false,hostProxyCssClass:"oauth-log-info-for-publish",cancelVisible:false,okBtnText:mstrmojo.desc(13380,"Log out"),contents:[{scriptClass:"mstrmojo.HBox",cssClass:"oauth-log-info-box",children:[{scriptClass:"mstrmojo.Label",cssClass:"login-icon",text:"ICON"},{scriptClass:"mstrmojo.VBox",cssClass:"oauth-log-info-box2",children:[{scriptClass:"mstrmojo.Label",cssClass:"login-name",text:j.textContent},{scriptClass:"mstrmojo.Label",cssClass:"login-email",text:j.id.split("*")[0]}]}],}],data:{}});u.fnOk=function(){console.log("clicked.");};var l=u.newInstance();l.open();return ;}var f=[this.parent.data.id];if(g==="button"||(g==="div"&&j.className.indexOf("Button")>=0)){this.items.forEach(function(w){w.items.forEach(function(x){if(x._renderIdx===n){m.handleForOAuthSources(f,x.dataSourceType,n);}});});return ;}if(n!==null&&!isNaN(parseInt(e,10))){var h={sel:{indicesName:"selected",enabledFn:"select",disabledFn:"unselect"},ex:{indicesName:"expanded",enabledFn:"expand",disabledFn:"collapse"}}[(g!==A)?"sel":"ex"];var p=this[h.indicesName+"Indices"],q=p[n];if(q){delete p[n];}else{p[n]=true;}this.itemRenderer[q?h.disabledFn:h.enabledFn](t.node,this.getTreeItem(n),e,n,this);}}catch(k){mstrApp.onerror(k);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetTree","mstrmojo.expr","mstrmojo.mstr.EnumNodeProperties","mstrmojo.AndOrNode","mstrmojo.ConditionNode");var H=mstrmojo.expr,B=mstrmojo.mstr.EnumNodeProperties,C=H.ET;function A(I){var K=I&&I.src,L=K&&K.data,J=L&&L.et;return(J in H.ETs);}function E(I){return I&&I.et===C.ANDOR&&!(I.node&B.CONDITION);}mstrmojo.FilterExpr=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.FilterExpr",allowDrop:A,renderOnScroll:false,itemIdField:null,nodeClassMap:{14:mstrmojo.AndOrNode,"*":mstrmojo.ConditionNode},onBlankClick:function(I){this.clearTreeSelect();},onnodemousedown:function(J){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),L=J.src,I=L.listMapper.findIndex(L,L.itemsContainerNode,K),M=I>=0?L.ctxtBuilder.itemWidgets[I]:null;if(!M||(M.isSelectableArea&&!M.isSelectableArea(K))){this.onBlankClick(J);}},getItemIdentityProp:function(I){return I.et;},itemFunction:function(N,K,O){var J=O.tree,L=J.getItemConfig(N,K,O),M=J.nodeClassMap,I=M[J.getItemIdentityProp(N)]||M["*"];return I&&(new I(L));},getItemConfig:function(L,I,M){var J=E(L),K=M.tree||M;return{data:L,tree:K,parent:M,bindings:{prefixedAndOrEditable:"this.parent.editable"},itemFunction:(J)?M.itemFunction:null,draggable:J?K.draggable:false,dropZone:J?K.dropZone:false,allowDrop:J&&K.dropZone?K.allowDrop:null,allowCopy:J?K.allowCopy:false,editable:K.isEditable?K.isEditable(L):K.editable,makeObservable:J&&M.makeObservable,onclick:K.onnodeclick,onadd:K.onnodeadd,onremove:K.onnoderemove};},getDragData:function(I){var K=this._super(I);if(K&&!K.html){var J=K.et&&H.ET2TGT[K.et];K.html=J?K[J]&&K[J].n||"":K.n||"";}return K;},newCondition:function G(M){M=M||{et:C.AQ};var L=this.selectionParentNode,I;L=(L&&L.hasRendered)?L:this;if(L!==this){I=L.add([M]);}else{var K=this.addCondition([M],null,true);I=K.index;L=K.widget;}var J={widget:L,index:I,data:M};if(this.onNew){this.onNew(J);}return J;},addCondition:function F(K,M){var N=this.items,J=N&&N.length,P=K&&K.length;if(!P){return null;}var L,I;if(J&&E(N[0])){L=this.ctxtBuilder.itemWidgets[0];I=L.add(K,null);}else{if(!J&&(P===1)){L=this;I=0;this.add(K,0);}else{if(J){var O=N[0];this.remove(O);K.unshift(O);}this.add([{et:C.ANDOR,fn:H.FN.AND,nds:K}],0);L=this.ctxtBuilder.itemWidgets[0];I=J?1:0;}}return{widget:L,index:I};},addSingleCondition:function D(J,I){var K=this.addCondition([J],I);return K.widget.ctxtBuilder.itemWidgets[K.index];},ondrop:function(L){if(this._super){this._super(L);}var J=this.items,I=J&&J.length,K=J.concat();if(I>1){if(J.remove){J.remove(0,J.length);}else{this.set("items",null);}this.add([{et:C.ANDOR,fn:H.FN.AND,nds:K}],0);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.AndOrNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.expr","mstrmojo.dom","mstrmojo.array","mstrmojo.css");var L=mstrmojo.expr,N=mstrmojo.dom,C=mstrmojo.array,A=mstrmojo.css,F=mstrmojo.fe._IsRelationTreeNode.createSetHtml;var M=function(){var U="noRelationOperator",P=this[U],R=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],S=mstrmojo.array.filter(R,function(V){return V&&V[U]!==P&&V.data.et!==L.ET.RLS;}),O=S.length;for(var Q=0;Q<O;Q++){S[Q].set(U,P);}};mstrmojo.fe.AndOrNode=mstrmojo.declare(mstrmojo.AndOrNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.AndOrNode",markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',getPrefixAndOrToolsMarkup:function(){return(F+this._super());},markupSlots:mstrmojo.hash.copy({createSetNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupSlots)),markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){A.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupMethods)),removeSet:function G(P){var O=P.childIndex(),Q=P.data,R=[Q];if(O>=0){this.remove(O,true);if(Q.nds&&Q.nds.length>0){R=Q.nds;if(Q.not){R[0].not=true;}}else{delete Q.dmy;delete Q.relation;delete Q.applySubExpr;delete Q.relation;delete Q.useSchema;delete Q.dmt;}this.add(R,O);this.consolidate(false);}},createSet:function E(Q,O){var P=this._ndsToMove(this,Q);if(!P){return ;}this.remove(P.idxs,true);var V=P.nds,U;if(V){if(V.length>1){var S={et:L.ET.ANDOR,nds:V};S.fn=this.data.fn;V=[S];U=S.nds[0].not;}else{var W=V[0];if(W&&W.not&&W.et===L.ET.ANDOR){U=W.not;delete W.not;}}}if(O&&O.rq){var R;if(O.isMetric){R=O.cq;mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],O.rq,R);}else{R=O.rq;R.nds=V;if(U){R.not=U;}}this.add([R],P.idxs[0]);}this.consolidate(false);},preclick:function H(O){var R=null,Q=N.eventTarget(O.hWin,O.e),P=this._super(O);if(N.contains(this.createSetNode,Q,true)&&!this.noRelationOperator){R="createSetOpt";}O.part=R||O.part;return P;},preadd:function I(O){if(this._super){this._super(O);}this.updateRelationOperator();},preremove:function K(O){if(this._super){this._super(O);}this.updateRelationOperator();},consolidate:function B(){this._super();this.updateRelationOperator();},postBuildRendering:function J(){var O=this._super();this.updateRelationOperator();return O;},updateRelationOperator:function D(){var O=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],P=!!C.filterOne(O,function(R){return R&&(R.data.et===L.ET.RLS||(R.data.et===L.ET.ANDOR&&R.noRelationOperator));}),Q=this.parent;this.set("noRelationOperator",P);M.call(this);if(Q&&Q.hasRendered&&Q.updateRelationOperator){Q.updateRelationOperator();}},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.DI.DITreeNode","mstrmojo.WidgetTree","mstrmojo.DI.DIHelpers");var C=mstrmojo.DI.DIHelpers,D=mstrmojo.array;mstrmojo.DI.DITree=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.DI.DITree",renderOnScroll:false,itemFunction:function B(I,F,G){var E=G.tree||G,H=new mstrmojo.DI.DITreeNode({edit:I.edit,data:I,state:0,parent:G,tree:E,multiSelect:G.multiSelect,text:I[G.itemDisplayField],textCssClass:E.item2textCss(I),items:I[G.itemChildrenField],itemIdField:G.itemIdField,itemDisplayField:G.itemDisplayField,itemIconField:G.itemIconField,itemChildrenField:G.itemChildrenField,itemFunction:G.itemFunction,listSelector:G.listSelector,iconFolderClosed:I.iconFolderClosed||"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:I.iconFolderOpen||"mstrmojo-di-tree-node-icon folder-open"});I.node=H;return H;},postCreate:function(){if(this._super){this._super();}this.selectedNodes=[];this.selectedNode=null;},isMultiSelect:false,selectedNodes:[],selectedNode:null,selectNode:function A(G,F){if(!this.isMultiSelect){if(this.selectedNode!==null&&this.selectedNode!==G){this.selectedNode.deselect();}this.selectedNode=G;this.selectedNodes=[G];}else{if(!F||(!C.isCtrlKey(F.hWin,F.e))){D.forEach(this.selectedNodes,function(H){if(H!==null&&H!==G){H.deselect();}});this.selectedNode=G;this.selectedNodes=[G];}else{if(F&&C.isCtrlKey(F.hWin,F.e)){var E=mstrmojo.array.find(this.selectedNodes,"id",G.id);if(E<0){this.selectedNodes.push(G);this.selectedNode=G;}else{G.deselect();this.selectedNodes.splice(E,1);if(this.selectedNode===G){this.selectedNode=null;}}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.TextBox","mstrmojo.TreeNode","mstrmojo.DI.DITreeNode");mstrmojo.DI.DIGATreeNode=mstrmojo.declare(mstrmojo.DI.DITreeNode,null,{scriptClass:"mstrmojo.DI.DIGATreeNode",markupString:'<div id="{@id}" class="{@cssClass} mstrmojo-di-tree-node-list" style="{@cssText}" mstrAttach:mousedown><div class="mstrmojo-di-tree-node"><img border="0" class="mstrmojo-di-tree-node-icon folder-closed" src="../images/1ptrans.gif"/><span class="mstrmojo-di-tree-node-text {@textCssClass}"></span><span class="mstrmojo-di-ga-tree-node-edit-icon {@textCssClass}"></span><span class="mstrmojo-di-tree-node-desc {@textCssClass}"></span></div><ul class="mstrmojo-di-tree-node-itemsContainer">{@itemsHtml}</ul></div>',markupSlots:{listNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];},editIconNode:function(){return this.domNode.firstChild.children[2];},descNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{onstateChange:function(){this.iconNode.className=(this.state===1)?this.data.iconFolderOpen:this.data.iconFolderClosed;this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);if(this.data.desc){this.descNode.innerHTML=mstrmojo.string.encodeHtmlString(this.data.desc);this.descNode.title=this.data.desc;}}},clickHandler:null,editHandler:null,deselect:function B(){if(this.listNode){this.listNode.className="mstrmojo-di-tree-node-file";}},fetched:false,iconEntity:"",iconFolderClosed:"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:"mstrmojo-di-tree-node-icon folder-open",isFolder:true,postBuildRendering:function A(){if(this._super){this._super();}var D=0;var E=this;while(E!=null&&E.parent!=null&&E.parent.data!=null){D++;E=E.parent;}this.iconNode.style.marginLeft=D*18+"px";if(this.data.isFolder){this.iconNode.className=(this.state===1)?this.data.iconFolderOpen:this.data.iconFolderClosed;this.listNode.className="mstrmojo-di-tree-node-folder";this.editIconNode.style.display="none";}else{this.iconNode.className=this.data.iconEntity;this.listNode.className="mstrmojo-di-tree-node-file";}},premousedown:function C(D){var E=mstrmojo.dom.eventTarget(D.hWin,D.e);mstrmojo.dom.stopPropogation(D.hWin,D.e);if(E!==this.editIconNode){if(this.data.isFolder){if(this.state===0){if(this.data.fetched){this.set("state",1);}else{this.data.clickHandler.call(this,this);this.data.fetched=true;this.set("state",1);}}else{if(this.state===1){this.set("state",0);}}}else{this.listNode.className="mstrmojo-di-tree-node-file selected";var F=this;while(F!=null&&F.parent!=null&&F.parent.data!=null){F=F.parent;}if(F!=null&&F.tree!=null&&F.tree.scriptClass=="mstrmojo.DI.DITree"){F.tree.selectNode(this,D);}this.data.clickHandler.call(this,this);}}else{this.data.editHandler(this);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout");mstrmojo.requiresDescs(39,12545);var E={"application/vnd.google-apps.spreadsheet":"mstrmojo-di-tree-node-icon google-spreadsheet","application/vnd.ms-excel":"mstrmojo-di-tree-node-icon excel-doc","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"mstrmojo-di-tree-node-icon excel-doc","text/csv":"mstrmojo-di-tree-node-icon csv-doc","text/plain":"mstrmojo-di-tree-node-icon text-doc",file:"mstrmojo-di-tree-node-icon ga-document",graph:"mstrmojo-ListIcon  t3 st769",gridGraph:"mstrmojo-ListIcon  t3 st774",cube:"mstrmojo-ListIcon  t3 st776",grid:"mstrmojo-ListIcon  t3 st768"};function D(H,G){var J=H.n.toLowerCase(),I=G.n.toLowerCase();if((H.isFolder&&G.isFolder)||(!H.isFolder&&!G.isFolder)){if(J<I){return -1;}if(J>I){return 1;}return 0;}if(H.isFolder&&!G.isFolder){return -1;}if(!H.isFolder&&G.isFolder){return 1;}}mstrmojo.DI.DIObjectBrowser=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIObjectBrowser",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{listHeaderNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},canRefresh:false,children:[{scriptClass:"mstrmojo.List",slot:"listHeaderNode",itemMarkupFunction:function(I,G,H){var J=H.parent.canRefresh?'<div class="di-refresh-reports icon-clickable di-object-browser-header-right" mstrAttach:click></div>':"";return'<div><table cellpadding="0" cellspacing="0" style="width: 100%;"><tr><td class="mstrmojo-di-so-list-header cf" style="width: 30%;"><div class="di-object-browser-header-left">'+I.n+"</div>"+J+'</td><td class="mstrmojo-di-so-list-header" style="width: 70%;">'+I.desc+"</td></tr></table></div>";},items:[{n:mstrmojo.desc(12545,"Files"),desc:mstrmojo.desc(39,"Description")}],onmousedown:function(G){if(G.e.target.className==="di-refresh-reports icon-clickable di-object-browser-header-right"){this.parent.clickedNode=this.parent.fileTree;this.parent.refreshFunction();}}},{scriptClass:"mstrmojo.DI.DITree",alias:"fileTree",slot:"listNode",cssClass:"mstrmojo-di-ga-table",bindings:{isMultiSelect:"this.parent.isMultiSelect"}}],browseFunction:mstrmojo.emptyFn(),editFunction:mstrmojo.emptyFn(),refreshFunction:mstrmojo.emptyFn(),clickedNode:null,fileList:null,sortRoot:true,isMultiSelect:false,forceEnableContinue:false,onfileListChange:function(){var H,G,J=[],M,N,Q;var I=this.fileList;var P=this;for(H=0;H<I.length;H++){var O=I[H];O.clickHandler=P.onTreeNodeClick;O.list=P.fileTree;O.browser=P;if(this.clickedNode.data){var L=this.clickedNode.data.folderPath||"";O.folderPath=L+"/"+this.clickedNode.data.n;}if(!O.isFolder){O.editHandler=P.onEditButtonClick;O.iconEntity=E[O.type]||E["text/plain"];}N=new mstrmojo.DI.DITreeNode(O);if(O.cItem){M=[];for(G=0;G<O.cItem.length;G++){var K=O.cItem[G];K.clickHandler=P.onTreeNodeClick;K.list=P.fileTree;K.browser=P;K.iconEntity="mstrmojo-di-tree-node-icon salesforce";Q=new mstrmojo.DI.DITreeNode(K);M.push(Q);}M.sort(D);N.set("items",M);N.fetched=true;}J.push(N);}if(this.sortRoot){J.sort(D);}this.clickedNode.set("items",J);this.clickedNode.selectedItem=null;this.clickedNode.selectedNode=null;},onEditButtonClick:function F(G){G.data.browser.editFunction(G);},onTreeNodeClick:function A(G){if(G.data.isFolder){G.data.browser.clickedNode=G;G.data.browser.browseFunction(G);}else{this.data.list.selectedItem=G.data;mstrApp.getRootController().sourceSelected(this.data.list.selectedNodes.length>0||G.data.browser.forceEnableContinue);}},postBuildRendering:function C(){if(this._super){this._super();}this.clickedNode=this.fileTree;},setDimensions:function B(J,H){var G=parseInt(J,10);var I=parseInt(H,10);if(isNaN(G)||isNaN(I)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listHeaderNode="28px";this.layoutConfig.w.listHeaderNode=I+"px";this.layoutConfig.w.listNode=Math.max(I,0)+"px";if(this._super){this._super(G+"px",H);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.hash","mstrmojo.func","mstrmojo.css","mstrmojo.string","mstrmojo.HBox","mstrmojo.Box","mstrmojo.DropDownButton","mstrmojo.Popup","mstrmojo.WidgetTree","mstrmojo.ObjectBrowserDataProvider","mstrmojo.OBList","mstrmojo.FishEyeContainer","mstrmojo.SearchBox2","mstrmojo.Booklet","mstrmojo.IncFetch","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.mstr.ui.IncFetchOBList","mstrmojo.DI.DIConstants");var Q=mstrmojo.hash,Z=mstrmojo.func,A=mstrmojo.string,M=mstrmojo.meta.TP,G="5CECE58CC1D549F890EB61C4DB2156A3",W="E0CCB9CF22104A489CBE78D974AFD19E",S=mstrmojo.chart.model.enums.EnumDSSObjectType,L=mstrmojo.array,E=mstrmojo.dom,P=mstrmojo.DI.DIConstants,b=function(k,l,e){var h=k.scrollableIncFetch,g=h?"mstrmojo.mstr.ui.IncFetchOBList":"mstrmojo.OBList",j={scriptClass:g,items:l.items,multiSelect:e};if(h){j.browseConfig={blockBegin:l.bb,blockCount:l.bc,totalSize:l.sz,folderLinksContextId:k.folderLinksContextId,rootFolderID:l.did,browsableTypes:k.browsableTypes,browsableViewMedias:k.browsableViewMedias,dataProvider:k.dataProvider};j.onwaitingChange=function(){if(k.booklet){k.booklet.set("waiting",this.waiting);}};}var f=mstrmojo.insert(j);f.render();return f;},B=function(g,j,e){var f=mstrmojo.ObjectBrowser.widgetHandler||b;return f(g,j,e);},O={success:function(g){var h=this.ob,f=g.items,j=h.pageCache[h.currentPage],e=j._w;j.items=f;e.set("items",f);this.ob=null;this.item=null;window.clearTimeout(h._btm);h.booklet.set("waiting",false);if(h.scrollableIncFetch&&e.scrollNode){e.initScroll();e.updateScrollbars();}},failure:function(e){window.alert(e.getResponseHeader("X-MSTR-TaskFailureMsg"));this.ob.booklet.set("waiting",false);}},V=function(k,j,g){var h=g?-1:1,f=k.pageCache.length,l;for(l=k.currentPage+h;l<f&&l>=0;l+=h){var e=k.pageCache[l];if(e._k===j.k){return{steps:l-k.currentPage,cache:e};}}return null;},D=function(j,h,g,k){var m=j.currentPage+1,f=j.pageCache.length,e;for(e=m;e<f;e++){j.pageCache[e]._w.destroy();delete j.pageCache[e].items;}j.pageCache=j.pageCache.slice(0,m);k._w=g;k._k=h.k;j.pageCache[m]=k;j.cacheChange();},I=function(f){var e=mstrmojo.hash.walk("anc.items.0.items",f);this.set("canGoUp",!(!f.pf||!e));},J=function(j,h,k,g,f){delete j._btm;var e;if(!g){e=B(j,k,j.multiSelect);e.attachEventListener("change",j.id,"navigate");if(j.useDblSelect||j.useBothSglDblSelect){e.attachEventListener("dblclick",j.id,"dblselect");}}else{e=k._w;}j.obList=e;j.booklet.turn(e,f>0);window.setTimeout(function(){j.onBrowsing=false;},300);if(!g){D(j,h,e,k);}j.set("currentFolder",k);j.set("currentPage",j.currentPage+f);j.updateUpButton(k);if(j.scrollableIncFetch&&e.scrollNode){e.initScroll();e.updateScrollbars();}},R=function(g,f,e){var h=V(g,f,false);h=h||V(g,f,true);if(!h){window.clearTimeout(g._btm);g._btm=window.setTimeout(function(){g.booklet.set("waiting",true);},300);e.ob=g;e.item=f;g.getDataProvider().fetchFolderContents(g,f,e);}else{J(g,f,h.cache,true,h.steps);}},C=function(f,g,h,e){R(f,{fid:f.pageCache[f.currentPage].did,blockBegin:g,searchPattern:h,recursive:e},O);},K={success:function(f){var g=this.ob;if(g){window.clearTimeout(g._btm);if(!f.items){f.items=[{did:"empty",n:"("+mstrmojo.desc(2210)+")",t:"e"}];}var e=function j(k){var n=k.length,l;for(l=0;l<n;l++){var m=k[l];if(m.did===G||m.did===W){m.n=(m.did===G)?mstrmojo.desc(8112):mstrmojo.desc(9277);}if(m.items){e(m.items);}}};if(f.did===G||f.did===W){f.n=(f.did===G)?mstrmojo.desc(8112):mstrmojo.desc(9277);if(f.anc&&f.anc.items){e(f.anc.items);}}if(f&&f.items&&g.browsableViewMedias){var h={};L.forEach(g.browsableViewMedias.split(","),function(k){h[parseInt(k,10)]=true;});f.items=L.filter(f.items,function(k){return(k.t!==S.DssTypeDocumentDefinition)||h[k.dvm];});}if(f&&f.items&&mstrApp&&mstrApp.isSingleTier){f.items=L.filter(f.items,function(k){return(k.st!==772);});}if(g.isImportFromCube){f.items=L.filter(f.items,function(k){return(k.et!==P.DSSExType.DSSEXDISPARK);});}if(f.did&&this.item.k!==f.did){this.item.k=f.did;}J(g,this.item,f,false,1);this.ob=null;this.item=null;}},failure:function(e){this.ob.booklet.set("waiting",false);if(this.ob.onError){this.ob.onError(e);}else{if(e.getResponseHeader){mstrmojo.alert(e.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{mstrmojo.alert(e.message);}}},complete:function(){if(this.ob){this.ob.onBrowsing=false;}}},d=function(g){var f=g.pageCache.length,e;for(e=0;e<f;e++){g.pageCache[e]._w.destroy();}g.pageCache=[];g.currentPage=-1;g.cacheChange();},N=function(h,g,j){var e=h.onBrowseFolder;if(e){e[0][e[1]](g);}if(g&&parseInt(g.acg,10)===33){return ;}var f={};if(g){f.k=g.did;f.fid=g.did;}else{if(h.rootFolderID){f.k=h.rootFolderID;f.fid=h.rootFolderID;}else{if(h.rootFolderType){f.k=h.rootFolderType;f.fty=h.rootFolderType;}else{if(h.folderLinksContextId){f.k=h.folderLinksContextId;}}}}R(h,f,Z.wrapMethods(j,Q.copy(K)));},Y=function(k,e,g){if(!g){return e;}var h=k.showCompletePath,m=e[0],j,f;while(m){var l;for(l=g.length-1;l>=0;l--){if(m.did===g[l].did){g.splice(l,1);m._isSc=true;}}f=m;m._open=true;m=m.items;m=m&&m[0];if(!m){f.lastLeaf=true;}}if(!h){m=e[0];while(m){if(m._isSc){e[0]=m;break;}m=m.items;m=m&&m[0];}}return e.concat(g);},X=function(f,e,g){f._naviInfo=Y(f,e,g);};mstrmojo.ObjectBrowser=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.ObjectBrowser",rootFolderType:null,rootFolderID:null,sId:null,closeOnSelect:true,browsableTypes:null,browsableViewMedias:null,includeObjectDesc:false,closeable:true,fishEyeVisible:false,searchVisible:true,upButtonVisible:false,currentFolder:null,pageCache:[],currentPage:-1,blockCount:50,canGoUp:true,folderLinksContextId:null,minSearchLength:2,showCompletePath:true,multiSelect:false,onCloseCB:null,onSelectCB:null,onBrowseFolder:null,scrollableIncFetch:false,useBothSglDblSelect:false,displaySaveLabel:false,useOldSearch:false,getDataProvider:function(){if(!this.dataProvider){this.dataProvider=mstrmojo.insert({scriptClass:"mstrmojo.ObjectBrowserDataProvider"});}return this.dataProvider;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.HBox",alias:"titleBar",cssClass:"mstrmojo-OB-titleTable",children:[{alias:"saveLabel",scriptClass:"mstrmojo.Label",cssClass:"msrmojo-save-label",text:mstrmojo.desc(3178,"Save in:"),bindings:{visible:"this.parent.parent.displaySaveLabel"}},{alias:"title",scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-FormatEditor-DropDownButton",cssText:"margin:0px;",popupRef:{scriptClass:"mstrmojo.Popup",alias:"popup",contentNodeCssClass:"mstrmojo-OBNavigatorPopup",cssText:"position:relative;",slot:"popupNode",locksHover:true,onOpen:function(){var e=this.opener.parent.parent,h=this.tree,g=e._naviInfo,f=this.parent.parent.parent.extraDDItems;if(h.items!==g){h._pup=this;this.ob=e;if(f){L.forEach(f,function(j){j.isExtra=true;});g=g.concat(f);}h.set("items",g);}if(e.getRecents&&!mstrApp.isSingleTier){e.getRecents(this);}},children:[{alias:"tree",scriptClass:"mstrmojo.WidgetTree",itemIdField:"did",itemFunction:function(j,e,f){var h=mstrmojo.WidgetTree.prototype.itemFunction(j,e,f);if(j.isExtra){if(j.cssClass){h.cssClass=j.cssClass;}h.onmousedown=j.onmousedown||mstrmojo.emptyFn;return h;}if(j._open){h.state=1;}h._ll=!!j.lastLeaf;h._pup=f._pup;h.onmousedown=function(k){var l=mstrmojo.dom.eventTarget(k.hWin,k.e),m=this._pup;if(l===this.domNode||l===this.textNode){if(!this._ll){N(m.ob,this.data);}m.close();}};h.markupMethods=Q.copy(h.markupMethods);h.markupMethods.onstateChange=function(){var k=this.data.items?this.state:0;this.stateNode.className="mstrmojo-TreeNode-state "+({0:"closed",1:"opened",2:"leaf"}[k]||"closed");this.itemsContainerNode.style.display=(k===1)?"block":"none";};h.useRichTooltip=true;var g=h.postBuildRendering;h.postBuildRendering=function(){if(g){g.call(h);}if(h.textNode.parentNode.clientWidth){h.textNode.style.width=(h.textNode.parentNode.clientWidth-20)+"px";}};h.premouseover=function(m){if(this.useRichTooltip){var l=this.textNode;if(l.clientWidth<l.scrollWidth){var k=E.position(l);this.richTooltip={areaId:this.id,cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_TOPLEFT,content:A.encodeHtmlString(this.data[this.itemDisplayField]),top:k.y-2,left:k.x+k.w+6};}else{this.richTooltip=null;}mstrmojo.dom.stopPropogation(m.hWin,m.e);}return true;};return h;}}]}},{alias:"upButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-OBListItemIcon up",title:mstrmojo.desc(1152,"Up One Level"),onclick:function(){this.parent.parent.goUp();},bindings:{enabled:"this.parent.parent.canGoUp",visible:"this.parent.parent.upButtonVisible"}},{alias:"closebtn",scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-OBCloseButton",title:mstrmojo.desc(2102,"Close"),bindings:{visible:"this.parent.parent.closeable"},onclick:function(){this.parent.parent.close();}}]},{alias:"fishEye",scriptClass:"mstrmojo.FishEyeContainer",cssText:"width:100%",bindings:{visible:"this.parent.fishEyeVisible"}},{alias:"searchUpBar",scriptClass:"mstrmojo.HBox",cssClass:"searchBox",children:[{alias:"obSearchBox",scriptClass:"mstrmojo.SearchBox2",cssClass:"mstrmojo-charcoalbox mstrmojo-dxsprite",cssText:"margin: 3px 0; ",contentWidget:mstrmojo.all.obList,taskId:"searchMetadata",searchIncFetch:true,enableMatchCase:false,forceResetCache:true,bindings:{minSearchLength:"this.parent.parent.minSearchLength",quickSearch:"this.parent.parent.quickSearch"},serverRequest:function(e,f){this.parent.parent.getDataProvider().serverRequest(e,f);},preFetch:function(){this.objectTypes=this.parent.parent.browsableTypes||this.objectTypes;this.parent.parent.booklet.set("waiting",true);},postFetch:function(){this.parent.parent.booklet.set("waiting",false);},postBuildRendering:function a(){if(this._super){this._super();}this.inputNode.setAttribute("placeholder"," "+mstrmojo.desc(12666,"Search..."));},onUpdateSearchParams:function H(g){var f=this.parent.parent,e=f.sId;if(e){g.sessionState=e;}if(f.useOldSearch){g.quickSearch=0;g.nameWildcards=1;g.sortKey=6;}}}],bindings:{visible:"this.parent.searchVisible"}},{scriptClass:"mstrmojo.Booklet",cssClass:"mstrmojo-OB-booklet",alias:"booklet",hasAnimation:false,bindings:{scrollableIncFetch:"this.parent.scrollableIncFetch"}},{alias:"obIncFetch",scriptClass:"mstrmojo.IncFetch",height:"17px",cssText:"height:0px;overflow:hidden;",visible:false,np:0,cp:0,ds:{f:mstrmojo.desc(4046,"First"),p:mstrmojo.desc(1058,"Previous"),n:mstrmojo.desc(1059,"Next"),l:mstrmojo.desc(4049,"Last"),pgs:mstrmojo.desc(5972,"## of ### pages"),gt:mstrmojo.desc(5878,"Go to:"),v:mstrmojo.desc(6079,"This field should be # between ## and ###.")},onvisibleChange:function(f){var j=parseInt(this.height,10),e=this.np>1,g={target:this.domNode,props:{height:{start:(e?0:j),stop:(e?j:0),suffix:"px"}},onEnd:function(){if(e){this.target.style.overflow="visible";}}},k=new mstrmojo.fx.AnimateProp(g);this.domNode.style.overflow="hidden";mstrmojo.css.toggleClass(this.parent.domNode,"show-inc-fetch",this.visible);k.play();},onifsChange:function(e){var f=this.np;mstrmojo.hash.copy(e.value,this);if(this.np>1){this.children=null;this.refresh();}if((f<=1&&this.np>1)||(f>1&&this.np<=1)||(f===0&&this.np>0)){this.set("visible",this.np>1);}this.cssText="";}}],destroy:function c(){d(this);if(this._super){this._super();}},postBuildRendering:function(){if(this._super){this._super();}if(this.fishEye&&this.fishEyeVisible){this.fishEye.attachEventListener("selectedIndexChange",this.id,"onFishEyeChange");}var g=this.searchUpBar;if(g&&g.obSearchBox&&this.searchVisible){this.obSearchBox=this.searchUpBar.obSearchBox;this.obSearchBox.attachEventListener("itemsChange",this.id,"onSearchItemsChange");var e=this.obSearchBox.contentWidget||this.obSearchBox;if(!this.scrollableIncFetch){e.attachEventListener("ifsChange",this.id,function(h){if(!this.scrollableIncFetch){this.obIncFetch.set("ifs",h.value);}});}}if(!this.scrollableIncFetch&&this.obIncFetch){var f=this.obIncFetch;f.attachEventListener("fetch",this.id,function(h){f.cp=h.v;f.children=null;f.refresh();C(this,(h.v-1)*this.blockCount+1,this.searchVisible?this.obSearchBox.inputNode.value:"",1);});}mstrmojo.css.addClass(this.domNode,"mstrmojo-ObjectBrowser");},onSearchItemsChange:function(f){var g=f.value,e=this.pageCache[this.currentPage]._w;if(!g||g.length===0){g=[{did:"empty",n:"("+mstrmojo.desc(2210,"")+")",t:"e"}];}else{if(this.browsableViewMedias){var h={};L.forEach(this.browsableViewMedias.split(","),function(j){h[parseInt(j,10)]=true;});g=L.filter(g,function(j){return(j.t!==S.DssTypeDocumentDefinition)||h[j.dvm];});}}e.set("items",g);},navigate:function(n){var e=n.src,o=e.selectedItem,g=this.multiSelect,k=g&&e.getSelectedItems(),l=this,f=n.added&&n.added.length,j=n.removed&&n.removed.length,h=g?k.length===1&&(!j||f):!!o;if(h&&o.did==="empty"){return ;}if(h&&parseInt(o[M],10)===8){if(!this.onBrowsing){this.onBrowsing=true;N(this,o);}}else{if((o&&(!this.useDblSelect||this.useBothSglDblSelect))||k){this.select(g?k:o);}}},browseFolder:function(e,f){N(this,{did:e,n:f});},onFishEyeChange:function(e){this.goToPage(e.value);},goToPage:function(e){if(e<this.pageCache.length&&e!==this.currentPage){var g=e>this.currentPage,f=this.pageCache[e];this.set("currentPage",e);this.booklet.turn(f._w,g);this.set("currentFolder",f);I.call(this,f);}},oncurrentPageChange:function(e){if(this.fishEye){this.fishEye.setSelectedIndex(e.value);}var f=this.pageCache[this.currentPage];this.titleBar.title.set("text",mstrmojo.string.encodeHtmlString(f.n));if(this.searchVisible&&this.obSearchBox){this.obSearchBox.set("rootCacheItems",f.items||[]);this.obSearchBox.set("totalSize",f.sz);this.obSearchBox.set("rootID",f.did);this.obSearchBox.clearSearch();}if(!this.scrollableIncFetch&&this.obIncFetch){this.obIncFetch.set("ifs",{np:Math.floor(f.sz/f.bc)+((f.sz%f.bc>0)?1:0),cp:Math.floor(f.bb/f.bc)+((f.bb%f.bc>0)?1:0)});}},cacheChange:function(){if(this.fishEye&&this.fishEyeVisible){this.fishEye.setItems(this.pageCache);}},browse:function(f,e){Q.copy(f,this);if(this.searchVisible&&this.obSearchBox){this.obSearchBox.clear();}d(this);N(this,undefined,e);},close:function(){var f=this.ctx||this,e=f.onCloseCB;if(e){e[0][e[1]]();}f.set("visible",false);},select:function(f){var e=this.onSelectCB;if(e){e[0][e[1]](f);}if(this.closeOnSelect){this.close();}},dblselect:function U(f){var g=f&&f.src.selectedItem;if(!g||(g&&g.did==="empty")||g[M]===8){return ;}if(this.useBothSglDblSelect){var e=this.onDblSelectCB;if(e){e[0][e[1]](g);}if(this.closeOnSelect){this.close();}}else{this.select(g);}},goUp:function(){if(this.canGoUp){N(this,{did:this.currentFolder.pf});}},updateUpButton:function F(e){I.call(this,e);},oncurrentFolderChange:function(e){var f=e.value;X(this,f.anc.items,f.sc);},refreshContent:function(e){C(this,e);},onError:null,onheightChange:function(){var e=["titleBar","fishEye","searchUpBar","obIncFetch"],g=0,f;for(f in e){g+=parseInt(this[e[f]].domNode.offsetHeight,10);}this.booklet.set("height",parseInt(this.height,10)-g+"px");}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.WidgetTree","mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowserSelector");mstrmojo.TreeBrowserEnum={};var I=mstrmojo.TreeBrowserEnum;I.BRANCH_POLICY_TOGGLE="toggle";I.BRANCH_POLICY_SELECT="select";mstrmojo.TreeBrowser=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.TreeBrowser",cssClass:"mstrmojo-TreeBrowser",browserNodeClass:mstrmojo.TreeBrowserNode,blockCount:30,noCheckBox:false,selectionAcrossBranch:true,branchClickPolicy:I.BRANCH_POLICY_TOGGLE,contentRetrieved:false,listSelector:mstrmojo.TreeBrowserSelector,handleNodeClicked:function(J){},getContentThroughTaskCall:function H(K,J){},isBranch:function F(J){},item2textCss:function C(J){return{"-1":"failed","-2":"loading","-3":"next","-4":"prev"}[J.st]||"";},failItemCreaterFunc:function(){return{n:"Loading Failed!",did:"-1",tp:"-1",st:"-1"};},loadingItemCreaterFunc:function(){return{n:mstrmojo.desc(5674,"Loading..."),did:"-2",tp:"-2",st:"-2"};},nextItemCreaterFunc:function(J){return{n:mstrmojo.desc(4507,"Next ##  item(s)...").replace("##",J?Math.min(J,this.blockCount):this.blockCount),did:"-3",tp:"-3",st:"-3"};},prevItemCreaterFunc:function(){return{n:mstrmojo.desc(4508,"Previous ##  item(s)...").replace("##",this.blockCount),did:"-4",tp:"-4",st:"-4"};},updateTreeContent:function(K,M){K.contentRetrieved=true;var L=M[K.itemChildrenField]||[],J=K.tree||K,O=M.bc,N=M.sz,P=M.bb;if(O!==-1){if(P+O<=N){L.push(J.nextItemCreaterFunc(N-P-O+1));}if((P-O)>-1){L.unshift(J.prevItemCreaterFunc());}}K.blockBegin=P;J.initializing=true;K.clearSelect(false);K.set("items",L);K.setSelectedItems(J.getTotalSelections(),true);J.initializing=false;if(J.onNodeExpand){J.onNodeExpand(K);}},getContent:function(K,O){var L=(K===this),J=this,P=function(Q){if(L){mstrmojo.css.removeClass(J.domNode,["loading"]);}J.updateTreeContent(K,Q);},M=function(Q){K.contentRetrieved=true;K.set("items",[J.failItemCreaterFunc()]);},N={success:P,failure:M};if(L){mstrmojo.css.addClass(J.domNode,["loading"]);}this.getContentThroughTaskCall({isRoot:L,data:K.data,blockBegin:L?0:(O||K.blockBegin),blockCount:J.blockCount},N);},postBuildRendering:function A(){this._super();if(!this.contentRetrieved){var J=this;setTimeout(function(){J.getContent(J);},0);}},itemFunction:function G(N,K,L){var J=L.tree||L,M=new J.browserNodeClass({data:N,state:0,parent:L,tree:J,multiSelect:L.multiSelect,text:N[L.itemDisplayField],textCssClass:J.item2textCss(N),items:N[L.itemChildrenField],itemIdField:L.itemIdField,itemDisplayField:L.itemDisplayField,itemIconField:L.itemIconField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction,listSelector:L.listSelector});return M;},clearTreeSelect:function E(){if(!this.selectionAcrossBranch){this._super();}else{var L=this._selectionParentNode,J=L&&L.length,K;for(K=0;K<J;K++){L[K].clearSelect();}this._selectionParentNode=null;this._totalSelections=null;}},onnodechange:function D(U){if(this.initializing){return ;}if(!this.selectionAcrossBranch){this._super(U);}else{this._totalSelections=this._totalSelections||[];this._selectionParentNode=this._selectionParentNode||[];var R=this._totalSelections,J=this._selectionParentNode,S=U.added,P=U.removed,Q=[],L=[],K=U.src,N,M,O,V;J.push(K);for(N=0,O=P&&P.length;N<O;N++){L.push(K.items[P[N]]);}mstrmojo.array.removeItems(R,"did",L);for(M=0,V=S&&S.length;M<V;M++){Q.push(K.items[S[M]]);}this._totalSelections=R.concat(Q);}},getTotalSelections:function B(){if(this.selectionAcrossBranch){return this._totalSelections||[];}var J=this.selectionParentNode;return J&&J.getSelectedItems();}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DITreeNodeDnD","mstrmojo.WidgetTree","mstrmojo.DI.DIHelpers");var C=mstrmojo.DI.DIHelpers,E=mstrmojo.dom,D=mstrmojo.array,F=mstrmojo.string;mstrmojo.DI.DITreeDnD=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.DI.DITreeDnD",renderOnScroll:false,itemFunction:function B(K,H,I){var L="Name: "+K[I.itemDisplayField];if(I.sizeTooltip){if(K.isFolder){if(I.folderSizeTooltip){L+=" Size: ---";}}else{if(K.type==="application/vnd.google-apps.spreadsheet"){L+=" Size: unavailable";}else{if(typeof K.size==="number"){L+=" Size: "+C.getRoundSize(K.size);}}}}var G=I.tree||I,J=new mstrmojo.DI.DITreeNodeDnD({edit:K.edit,data:K,state:0,parent:I,tree:G,supportFolderDrag:I.supportFolderDrag,text:K[I.itemDisplayField],tooltipContent:F.htmlAngles(L),useRichTooltip:true,_ontooltipover:function(M){E.stopPropogation(self,M);J.showTooltip(M,self);},textCssClass:"mstrmojo-di-tree-node-dnd",index:H,items:K[I.itemChildrenField],itemIdField:I.itemIdField,itemDisplayField:I.itemDisplayField,itemIconField:I.itemIconField,itemChildrenField:I.itemChildrenField,itemFunction:I.itemFunction,listSelector:I.listSelector,iconFolderClosed:K.iconFolderClosed||"mstrmojo-di-tree-node-icon folder-closed",iconFolderOpen:K.iconFolderOpen||"mstrmojo-di-tree-node-icon folder-open"});K.node=J;return J;},postCreate:function(){if(this._super){this._super();}this.selectedNodes=[];this.selectedNode=null;},selectedNodes:[],selectedNode:null,selectNode:function A(I,O){if(!O||(!C.isCtrlKey(O.hWin,O.e)&&!mstrmojo.dom.shiftKey(O.hWin,O.e))){D.forEach(this.selectedNodes,function(P){if(P!==null&&P!==I){P.deselect();}});this.selectedNode=I;this.selectedNodes=[I];}else{if(O&&C.isCtrlKey(O.hWin,O.e)){var N=mstrmojo.array.find(this.selectedNodes,"id",I.id);if(N<0){this.selectedNodes.push(I);this.selectedNode=I;}else{I.deselect();this.selectedNodes.splice(N,1);if(this.selectedNode===I){this.selectedNode=null;}}}else{if(O&&mstrmojo.dom.shiftKey(O.hWin,O.e)){var H=I,K=H;if(this.selectedNode){var L=0;while(this.selectedNode.ancestorList[L]===I.ancestorList[L]){L++;}if(this.selectedNode.ancestorList[L]<I.ancestorList[L]){H=this.selectedNode;}else{K=this.selectedNode;}}var J;if(this.selectedNodes.length>=2){var M=this.selectedNodes.length;for(J=0;J<M;J++){this.selectedNodes[J].deselect();}}this.selectedNodes=[];this.selectedNode=I;var G=H;while(G!==K){if(!G.data.isFolder){this.selectedNodes.push(G);mstrmojo.css.addClass(G.listNode,"selected");}G=G.nextOrderNode;}this.selectedNodes.push(K);mstrmojo.css.addClass(K.listNode,"selected");}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.Button","mstrmojo.MenuButton");mstrmojo.requiresDescs(212,2140);var C="mstrmojo-qb-footerIcon",F="cancel",B="publish",E="disabled",H="new",D=" ";function I(L){return mstrmojo.hash.copy(L,{scriptClass:"mstrmojo.Button",onclick:function K(){if(this.cmd){mstrApp.getRootController()[this.cmd]();}}});}mstrmojo.qb.Footer=mstrmojo.declare(mstrmojo.Box,null,{hidePublish:function G(){this.publish.set("visible",false);},children:[I({cmd:"publish",enabled:false,text:mstrmojo.desc(212,"Continue"),alias:"publish",postBuildRendering:function A(){mstrApp.getRootController().attachEventListener("allowSave",this.id,function(K){this.set("enabled",K.value);});}}),I({cmd:"cancel",iconClass:[C,F].join(D),text:mstrmojo.desc(2140,"Cancel")})],addChildren:function J(N,K,L){var M=N[0];if(M.alias==="publish"){M.iconClass=[C,B,(mstrApp.reportID?"":H),E].join(D);}this._super(N,K,L);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.MenuButton","mstrmojo.Label","mstrmojo.Image","mstrmojo.CheckBox","mstrmojo.ui.Checkbox","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants","mstrmojo.css","mstrmojo.dom","mstrmojo.tooltip");mstrmojo.requiresDescs(172,212,373,1059,1279,1302,2140,2400,3345,15452,9115,10236,12300,12387,12647,12693,12694,12695,13195,13587,13612,13850,13852,14417,14195,14458,14597,14598,15244,15245,15246,15247,15248,15249,12250);var G=13,Q=9,X=mstrmojo.css,E=mstrmojo.dom,Y=mstrmojo.DI.DIConstants,F=mstrmojo.DI.DIHelpers;var M={UNVISIBLE:1,UNENABLED:2,ENABLED:3};var L={ERROR:-1,LOADING:0,NORMAL:1,NONE:2,UNLIMITED:3,EXCEED:4};function S(a,Z){if(Z){if(Z.hasOwnProperty("visible")){a.set("visible",Z.visible);}if(Z.hasOwnProperty("enabled")){a.set("enabled",Z.enabled);}if(Z.hasOwnProperty("text")){a.set("text",Z.text);}}}mstrmojo.DI.DIFooter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIFooter",markupString:'<div id="{@id}" class="{@cssClass}" tabIndex="0"><div class="footer-buttons back"></div><div class="footer-buttons"></div><div class="footer-buttons"></div><div class="footer-buttons"></div><div class="footer-managed-checkbox"></div><div class="footer-managed-label"></div><div class="footer-dda-checkbox"></div><div class="footer-dda-label"></div><div class="footer-buttons"></div><div class="cube-quota"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},backNode:function(){return this.domNode.children[0];},cancelNode:function(){return this.domNode.children[1];},saveNode:function(){return this.domNode.children[2];},nextNode:function(){return this.domNode.children[3];},managedNode:function(){return this.domNode.children[4];},managedLabelNode:function(){return this.domNode.children[5];},ddaNode:function(){return this.domNode.children[6];},ddaLabelNode:function(){return this.domNode.children[7];},finishNode:function(){return this.domNode.children[8];},cubeQuotaNode:function(){return this.domNode.children[9];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onquotaVisibleChange:function(){this.cubeQuotaNode.style.display=this.quotaVisible?"block":"none";X.toggleClass(this.parent.domNode,"show-quota",this.quotaVisible);if(!F.isWS()){X.addClass(this.cubeQuotaNode,"cube-quota-web");}}},init:function U(Z){var a;if(this._super){a=this._super(Z);}this.initButtons();return a;},destroy:function(Z){if(this.next&&this.next.richTooltip){this.next.richTooltip.refNode=null;}if(this._super){this._super(Z);}},controlButtons:[],hotButtonIndex:-1,quotaVisible:false,toggleButtonHOTStyle:function P(a,Z){X.toggleClass(this.controlButtons[a].obj.domNode,["select"],Z);},initButtons:function N(){this.controlButtons=[];this.controlButtons.push({obj:this.back,status:M.UNVISIBLE});this.controlButtons.push({obj:this.finish,status:M.UNVISIBLE});this.controlButtons.push({obj:this.next,status:M.UNVISIBLE});this.controlButtons.push({obj:this.save,status:M.UNVISIBLE});this.controlButtons.push({obj:this.cancel,status:M.UNVISIBLE});},refreshControlButtonsStatus:function B(){mstrmojo.array.forEach(this.controlButtons,function(Z){var a=Z.obj;if(a&&a.visible&&a.visible===true){if(a.enabled&&a.enabled===true){Z.status=M.ENABLED;}else{Z.status=M.UNENABLED;}}else{Z.status=M.UNVISIBLE;}});},selectNextButton:function J(){var Z=(this.hotButtonIndex+1)%this.controlButtons.length;var a=this.hotButtonIndex;while(Z!==a&&this.controlButtons[Z].status!==M.ENABLED){Z=(Z+1)%this.controlButtons.length;}if(Z!==a){this.toggleButtonHOTStyle(this.hotButtonIndex,false);this.hotButtonIndex=Z;this.toggleButtonHOTStyle(this.hotButtonIndex,true);}},initSelectedButton:function I(){var Z=0;while(Z<this.controlButtons.length&&this.controlButtons[Z].status!==M.ENABLED){Z+=1;}if(Z<this.controlButtons.length){this.hotButtonIndex=Z;this.toggleButtonHOTStyle(this.hotButtonIndex,true);}},showControls:function W(Z){if(Z.next){S.call(this,this.next,Z.next);}if(Z.back){S.call(this,this.back,Z.back);}if(Z.cancel){S.call(this,this.cancel,Z.cancel);}if(Z.dda){S.call(this,this.ddaCheckbox,Z.dda);S.call(this,this.ddaLabel,Z.dda);}if(Z.finish){S.call(this,this.finish,Z.finish);}if(!mstrApp.diParams.disableQuota&&!F.isOnetier()&&Z.cubeQuota){this.set("quotaVisible",!!Z.cubeQuota.visible);}if(Z.save){S.call(this,this.save,Z.save);}if(Z.managedCheckbox){S.call(this,this.managedCheckbox,Z.managedCheckbox);S.call(this,this.managedLabel,Z.managedCheckbox);}if(Z.mdxRACheckbox){S.call(this,this.mdxRA,Z.mdxRACheckbox);}this.refreshControlButtonsStatus();},enableButton:function R(Z){var a;if(!this.visible){return ;}switch(Z.name){case"allowSave":a=Z.value;break;case"refreshTables":a=Z.items.length>0;if(Z.hasOwnProperty("tablesEnabled")){a=a&&Z.tablesEnabled;}break;}if(a!==undefined){this.set("enabled",a);}},getQuotaIconClassByStatus:function(a){var Z="cube-quota-icon ";switch(a){case L.LOADING:Z+="loading-icon";break;case L.UNLIMITED:Z+="unlimited-icon";break;case L.NONE:Z+="no-quota-icon";break;case L.EXCEED:case L.ERROR:Z+="error-icon";break;default:break;}return Z;},getQuotaStatus:function(){var Z=this.model.cubesInfo;if(Z===-1){return L.ERROR;}else{if(!Z||!Z.cubes){return L.LOADING;}else{if(Z.cubes.cquota===-1){return L.UNLIMITED;}else{if(Z.cubes.cquota===0){return L.NONE;}else{if(Z.cubes.cusage>Z.cubes.cquota){return L.EXCEED;}else{return L.NORMAL;}}}}}},displayQuota:function(){var Z=this.getQuotaStatus();var b="";if(Z===L.LOADING){return ;}var a=this.model.cubesInfo;this.cubeQuota.set("visible",Z===L.NORMAL);this.cubeQuotaIcon.set("visible",Z!==L.NORMAL);this.cubeSeeMoreContainer.set("visible",Z===L.EXCEED);this.cubeQuotaIcon.set("cssClass",this.getQuotaIconClassByStatus(Z));if(Z===L.ERROR){b=mstrmojo.desc(14195,"We are unable to retrieve the information about your cubes.");}else{if(Z===L.UNLIMITED){this.cubeQuota.updateProgress(0);b=mstrmojo.desc(15244,"You have been allocated ##### storage quota.").replace("#####","<span class='bold-font'>"+mstrmojo.desc(15245,"Unlimited")+"</span>");}else{if(Z===L.EXCEED){b=mstrmojo.desc(15247,"##### MB out of @@@@@ MB (*****%) used for your storage quota.").replace("#####",Math.round(a.cubes.cusage)).replace("*****",Math.round(a.cubes.cusage/a.cubes.cquota*10000)/100).replace("@@@@@",Math.round(a.cubes.cquota));this.cubeSeeMoreContainer.set("visible",true);}else{this.cubeQuota.updateProgress(Math.round(a.cubes.cusage/a.cubes.cquota*10000)/100);b=mstrmojo.desc(15248,"You have used ##### MB out of @@@@@ MB (*****%) of your allocated storage quota.").replace("#####",Math.round(a.cubes.cusage)).replace("*****",Math.round(a.cubes.cusage/a.cubes.cquota*10000)/100).replace("@@@@@",Math.round(a.cubes.cquota));}}}if(!F.isWS()&&Z!==L.ERROR){b=b+" "+mstrmojo.desc(13195,"Manage Your Datasets...");}this.cubeQuotaLabel.set("text",b);},onQuotaChange:function(){this.displayQuota();},preBuildRendering:function C(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("cubesInfoChange",this.id,"onQuotaChange");if(this.model.cubesInfo&&!F.isOnetier()){this.displayQuota();}},postBuildRendering:function V(){if(this._super){this._super();}if(this.model.cubesInfo&&!F.isOnetier()){var Z=this.model.cubesInfo;if(!Z.cubes){console.error("error in get quota info");}else{if(Z.cubes.cquota===-1){this.cubeQuota.updateProgress(0);}else{this.cubeQuota.updateProgress(Math.round(Z.cubes.cusage/Z.cubes.cquota*10000)/100);}}}this.next.richTooltip.refNode=this.nextNode;},onkeydown:function H(Z){if(Z.e.keyCode===G){this.controlButtons[this.hotButtonIndex].obj.onclick(Z);}else{if(Z.e.keyCode===Q){this.selectNextButton();}}mstrmojo.dom.preventDefault(Z.hWin,Z.e);return false;},children:[{scriptClass:"mstrmojo.ui.Checkbox",slot:"ddaNode",text:mstrmojo.desc(12387,"Direct Data Connection"),alias:"ddaCheckbox",oncheckedChange:function K(){mstrApp.getRootController().getDDAController().onToggleDDA(this.checked);},preBuildRendering:function D(){if(this._super){this._super();}},bindings:{visible:function(){return !mstrApp.isSingleTier&&!mstrApp.diParams.disableDDA;}},postCreate:function A(){if(this._super){this._super();}this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.onenabledChange=function(){X.toggleClass(this.domNode,"disabled",!this.enabled);X.toggleClass(this.parent.ddaLabel.domNode,"disabled",!this.enabled);};}},{scriptClass:"mstrmojo.Label",slot:"ddaLabelNode",text:mstrmojo.desc(12387,"Direct Data Connection"),alias:"ddaLabel",bindings:{visible:function(){return !mstrApp.isSingleTier&&!mstrApp.diParams.disableDDA;}}},{scriptClass:"mstrmojo.CheckBox",cssClass:"managedCheckbox",slot:"managedNode",alias:"managedCheckbox",visible:false,oncheckedChange:function K(){mstrApp.getRootController().model.set("isManagedCube",this.checked);},onenabledChange:function(){this.set("checked",mstrApp.getRootController().model.isManagedCube);},postBuildRendering:function(){var Z=mstrApp.getRootController().model;Z.attachEventListener("isManagedCubeChange",this.id,"update");},update:function(){var Z=mstrApp.getRootController().model;this.set("checked",Z.isManagedCube);},bindings:{enabled:function(){return mstrApp.getRootController().model.operationMode===Y.operationMode.create;},checked:function(){if(mstrApp.getRootController().model.isCalledByFlex){return false;}return mstrApp.getRootController().model.isManagedCube;}}},{scriptClass:"mstrmojo.Label",slot:"managedLabelNode",text:"Managed Cube",alias:"managedLabel",visible:false,bindings:{enabled:function(){return mstrApp.getRootController().model.operationMode===Y.operationMode.create;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2140,"Cancel"),slot:"cancelNode",alias:"cancel",onclick:function(){mstrApp.getRootController().onCancelButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2400,"Save"),slot:"saveNode",alias:"save",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,keepArrowXPos:true},updateTooltipConfig:function(){if(!this.enabled){this.richTooltip.refNode=this.domNode;this.richTooltip.content=mstrmojo.desc(12647,"You do not have the permission to modify this object");this.set("richTooltip",this.richTooltip);}},onclick:function(){mstrApp.getRootController().onSaveButtonClick();},bindings:{visible:function(){return !mstrApp.isSingleTier;}}},{slot:"backNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button back mstrmojo-WebButton ",text:mstrmojo.desc(373,"Back"),alias:"back",onclick:function(){mstrApp.getRootController().onBackButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"next",slot:"nextNode",text:mstrmojo.desc(212,"Continue"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V"},updateTooltipConfig:function(){this.richTooltip.top=-this.domNode.offsetHeight-this.richTooltip.refNode.offsetTop+"px";if(this.text===mstrmojo.desc(13850,"Update Dataset")&&!this.enabled){this.richTooltip.content=mstrmojo.desc(12647,"You do not have the permission to modify this object");}this.set("richTooltip",this.richTooltip);},ontextChange:function(){if(this.text!==mstrmojo.desc(13852,"Prepare Data")){this.richTooltip.content="";}else{this.richTooltip.content=mstrmojo.desc(13587,"Edit data and add more tables.");}if(this.text===mstrmojo.desc(1302,"Finish")||this.text===mstrmojo.desc(13850,"Update Dataset")){X.addClass(this.domNode,"hot");}},onclick:function(){mstrApp.getRootController().onNextButtonClick();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"finish",slot:"finishNode",text:mstrmojo.desc(1302,"Finish"),visible:false,onclick:function(){mstrApp.getRootController().onFinishButtonClick();}},{scriptClass:"mstrmojo.ProgressBar",alias:"cubeQuota",slot:"cubeQuotaNode",visible:false,cssClass:"mstrmojo-di-user-quota"},{scriptClass:"mstrmojo.Image",alias:"cubeQuotaIcon",slot:"cubeQuotaNode",visible:true,cssClass:"cube-quota-icon loading-icon",},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-user-quota-text",alias:"cubeQuotaLabel",slot:"cubeQuotaNode",text:mstrmojo.desc(12695,"Fetching Cube Quota Information..."),allowHTML:true,onclick:function(a){if(F.isWS()){return ;}var Z=mstrApp.getRootController();Z.getCubeQuota({complete:function(){Z.displayCubesInfo(a,true);}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}},{scriptClass:"mstrmojo.Box",cssClass:"quota-see-more-container",alias:"cubeSeeMoreContainer",slot:"cubeQuotaNode",visible:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"quota-see-more",alias:"cubeSeeMore",text:mstrmojo.desc(15249,"See More..."),onclick:function(){this.parent.cubeSeeMorePopDiv.set("visible",!this.parent.cubeSeeMorePopDiv.visible);}},{scriptClass:"mstrmojo.Box",cssClass:"quota-see-more-click-pop V-center mstrmojo-Tooltip vi-regular vi-tooltip-V",alias:"cubeSeeMorePopDiv",visible:true,children:[{scriptClass:"mstrmojo.Label",cssClass:"quota-see-more-pop-label",alias:"cubeSeeMoreContent",text:mstrmojo.desc(15250,"Please try to free some used in-memory space. For more information, contact your administrator.")},{scriptClass:"mstrmojo.Image",cssClass:"cube-see-more-close-icon",alias:"cubeSeeMorePopClose",onclick:function(){this.parent.set("visible",false);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Tooltip-arrow"}]}]},{scriptClass:"mstrmojo.Label",allowHTML:true,cssClass:"mstrmojo-di-source-admin cf",alias:"sourceAdmin",visible:false,text:'<span class="icon"></span><span class="text">'+mstrmojo.desc(14417,"Customize")+"</span>",onclick:function(){mstrApp.getRootController().showPage(Y.pageType.sourceAdmin);}},{scriptClass:"mstrmojo.Box",alias:"mdxRA",visible:false,cssClass:"mstrmojo-di-mdx-ra-checkbox cf",useRichTooltip:true,tooltipOpenDelay:1500,updateTooltipConfig:function(){var Z=E.position(this.domNode);this.set("richTooltip",{top:Math.max(Z.y+18,0),left:Math.max(Z.x+Z.w/2,0),cssClass:"vi-regular A-center vi-tooltip-V mstrmojo-di-mdx-ra-checkbox-tooltip",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.content,enableHover:true});},content:mstrmojo.desc(14598,"MicroStrategy provides two types of attributes: normal attributes and hierarchical attributes. A normal attribute represents a single hierarchy level, e.g., Month. A hierarchical attribute represents an entire hierarchy and its levels, e.g., Time. If a hierarchy is imported as a single hierarchical attribute, then the entire hierarchy can be placed on a report at once, and operations like filtering and sorting can be performed respecting the hierarchy. If a hierarchy is imported as multiple normal attributes to represent each hierarchy level, then each level can be placed on a report separately, and filters can be created on specific levels."),update:function(Z){this.children[0].update();this.set("visible",!!Z);},onvisibleChange:function O(){if(this.raCheckbox){this.raCheckbox.set("checked",false);}},children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"raCheckbox",oncheckedChange:function K(){var Z;try{Z=mstrApp.getRootController();}catch(a){}if(Z&&typeof Z.setRecursive==="function"){Z.setRecursive(this.checked?1:0);}},update:function(){var b=this,a={},Z=a[this.id]={};Z.recursiveChange=function(c){b.set("checked",c.value?true:false);};mstrApp.getRootController().attachDataChangeListeners(a);b.set("enabled",!mstrApp.tableID);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14597,"Import hierarchy as hierarchical attribute")}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.List","mstrmojo.DI.DITreeDnD","mstrmojo.DI.DITreeNodeDnD");mstrmojo.requiresDescs(12714,14899);var G=mstrmojo.array;function D(I,H){var K=I.n.toLowerCase(),J=H.n.toLowerCase();if((I.isFolder&&H.isFolder)||(!I.isFolder&&!H.isFolder)){if(K<J){return -1;}if(K>J){return 1;}return 0;}if(I.isFolder&&!H.isFolder){return -1;}if(!I.isFolder&&H.isFolder){return 1;}}mstrmojo.DI.DIObjectBrowserDnD=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIObjectBrowserDnD",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},listHeaderNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},canRefresh:false,sizeTooltip:false,folderSizeTooltip:false,showBrowseText:false,children:[{scriptClass:"mstrmojo.List",slot:"listHeaderNode",itemMarkupFunction:function(J,H,I){var K=I.parent.canRefresh?'<div class="di-refresh-reports-dnd icon-clickable di-object-browser-header-right" mstrAttach:click></div>':"";return'<div><table cellpadding="0" cellspacing="0" style="width: 100%;"><tr><td class="mstrmojo-di-so-list-header-dnd cf" style="width: 30%;"><div class="di-object-browser-header-left">'+J.n+"</div>"+K+"</td></tr></table></div>";},items:null,onmousedown:function(H){if(H.e.target.className==="di-refresh-reports-dnd icon-clickable di-object-browser-header-right"){this.parent.clickedNode=this.parent.fileTree;this.parent.refreshFunction();}}},{slot:"listNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-browse-text",alias:"browseText",text:mstrmojo.desc(14899,"Input the URL for remote folder and you can view folder list here"),bindings:{visible:"this.parent.showBrowseText"}},{scriptClass:"mstrmojo.DI.DITreeDnD",alias:"fileTree",slot:"listNode",cssClass:"mstrmojo-di-ga-table",bindings:{supportFolderDrag:"this.parent.supportFolderDrag",sizeTooltip:"this.parent.sizeTooltip",folderSizeTooltip:"this.parent.folderSizeTooltip"}}],browseFunction:mstrmojo.emptyFn(),editFunction:mstrmojo.emptyFn(),refreshFunction:mstrmojo.emptyFn(),filterType:[],clickedNode:null,fileList:null,sortRoot:true,supportFolderDrag:true,dblClickNodeFunction:mstrmojo.emptyFn,setFileListForNode:function(N,H){var I,K=[],M;var J=N;var P=this;for(I=0;I<J.length;I++){var O=J[I];if((this.filterType.length>0)&&mstrmojo.array.indexOf(this.filterType,O.type)===-1){continue;}O.clickHandler=P.onTreeNodeClick;O.dblClickHandler=P.onTreeNodeDblClick;O.list=P.fileTree;O.browser=P;if(H.data){var L=H.data.folderPath||"";O.folderPath=L+"/"+H.data.n;H.data.fetched=true;}if(!O.isFolder){O.editHandler=P.onEditButtonClick;O.iconEntity="mstrmojo-di-tree-node-icon text-doc";}M=new mstrmojo.DI.DITreeNodeDnD(O);K.push(M);}if(this.sortRoot){K.sort(D);}H.set("sizeTooltip",this.sizeTooltip);H.set("folderSizeTooltip",this.folderSizeTooltip);H.data.fetched=true;H.set("items",K);H.selectedItem=null;H.selectedNode=null;this.buildNodeRelation(H);},onfileListChange:function(){var J,I,L=[],O,P,S;var K=this.fileList;var R=this;var H=[];if(this.showBrowseText&&K&&K.length){this.set("showBrowseText",false);}for(J=0;J<K.length;J++){var Q=K[J];if((this.filterType.length>0)&&mstrmojo.array.indexOf(this.filterType,Q.type)===-1){continue;}Q.clickHandler=R.onTreeNodeClick;Q.dblClickHandler=R.onTreeNodeDblClick;Q.list=R.fileTree;Q.browser=R;if(this.clickedNode.data){var N=this.clickedNode.data.folderPath||"";Q.folderPath=N+"/"+this.clickedNode.data.n;this.clickedNode.data.fetched=true;}if(!Q.isFolder){Q.editHandler=R.onEditButtonClick;Q.iconEntity="mstrmojo-di-tree-node-icon text-doc";}P=new mstrmojo.DI.DITreeNodeDnD(Q);if(Q.cItem){O=[];for(I=0;I<Q.cItem.length;I++){var M=Q.cItem[I];M.clickHandler=R.onTreeNodeClick;M.dblClickHandler=R.onTreeNodeDblClick;M.list=R.fileTree;M.browser=R;M.iconEntity="mstrmojo-di-tree-node-icon salesforce";S=new mstrmojo.DI.DITreeNodeDnD(M);O.push(S);}O.sort(D);P.set("items",O);P.fetched=true;H.push(P);}L.push(P);}if(this.sortRoot){L.sort(D);}this.clickedNode.set("sizeTooltip",this.sizeTooltip);this.clickedNode.set("folderSizeTooltip",this.folderSizeTooltip);this.clickedNode.set("items",L);this.clickedNode.selectedItem=null;this.clickedNode.selectedNode=null;this.buildNodeRelation(this.clickedNode);G.forEach(H,function(U){R.buildNodeRelation(U.node);});},buildNodeRelation:function F(J){var I=[],H=null,K=null,L=null;if(!!J.ancestorList){I=J.ancestorList;H=J;L=J.nextOrderNode;}mstrmojo.array.forEach(J.items,function(M){K=M.node;if(!K){return ;}if(!K.ancestorList){K.ancestorList=[];}mstrmojo.hash.copy(I,K.ancestorList);K.ancestorList.push(K.index);if(H){H.nextOrderNode=K;}H=K;});if(K){K.nextOrderNode=L;}},onEditButtonClick:function E(H){H.data.browser.editFunction(H);},onTreeNodeClick:function A(H){if(H.data.isFolder){H.data.browser.clickedNode=H;H.data.browser.browseFunction(H);}else{this.data.list.selectedItem=H.data;}},onTreeNodeDblClick:function(H){if(!H.data.isFolder){this.data.list.selectedItem=H.data;}H.data.browser.dblClickNodeFunction(H);},postBuildRendering:function C(){if(this._super){this._super();}this.clickedNode=this.fileTree;},setDimensions:function B(K,I){var H=parseInt(K,10);var J=parseInt(I,10);if(isNaN(H)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listHeaderNode="44px";this.layoutConfig.w.listHeaderNode=J+"px";this.layoutConfig.h.listNode=Math.max((H-44),0)+"px";this.layoutConfig.w.listNode=Math.max(J,0)+"px";if(this._super){this._super(H+"px",I);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.Label","mstrmojo.Box","mstrmojo.TreeBrowser","mstrmojo.fx","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(221,1442,8117,8953,9135,12911);function B(b,f){var e,c,g,h={};var d=function d(j){if(j.selected){if(j.ipa){h[j.oid]=h[j.oid]||(j.fmn==="ID");}}};for(e=0;e<b.length;e++){g=b[e];if(g.isMultiForm){for(c=0;c<g.subColumns.length;c++){d(g.subColumns[c]);}}else{d(g);}}if(!h[f[0].aid]&&f[0].n!=="ID"){return false;}else{return true;}}var Y=mstrmojo.desc(8953,"Suggestions"),F=mstrmojo.desc(9135,"No match found"),W=mstrmojo.dom,Z=mstrmojo.css,U=mstrmojo.hash,M=mstrmojo.array,I=16,a,E;function X(e,d){var c=e.did,b=e.n,f={success:function(l){if(l.container){var j=l.container.dssforms||[],k,h;for(k=0,h=j.length;k<h;k++){j[k].aid=c;j[k].an=b;j[k].did=c+j[k].dssid;j[k].idf=j[0].dssid;}if(d&&d.success){d.success({items:j});}}}},g={attributeID:c,displayedForms:0};mstrApp.getRootController().getDataService().getAttributeForms(f,g);}function G(c){var b=this.status;b.set("text",c);b.set("title",c);Z.addClass(b.domNode,"error");this.adjustPosition();}function D(){var c=mstrmojo.string.trim(this.inputNode.value),f=this,e,j,h;if(!c){return ;}j={success:function g(m){var l=[],k;a=a.toLowerCase();mstrmojo.array.forEach(m.items,function(n){if(n.n.toString().toLowerCase().indexOf(a)===0){l.push(U.copy({items:[],st:-5},n));}});E=l;k=l.length>0;f.status.set("text",k?Y:F);f.statusNode.style.display="block";f.set("showContent",k);Z.removeClass(f.status.domNode,"error");f.children[0].set("items",l);},failure:function d(k){if(f.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+k.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));}},complete:function b(k){if(f.spinnerNode){f.spinnerNode.style.display="none";}if(f.postFetch){f.postFetch();}}};if(typeof microstrategy!=="undefined"&&microstrategy.useQuickSearch){e=microstrategy.useQuickSearch();}else{e=false;}if(a&&c.indexOf(a)===0&&E.length<this.blockCount){a=c;j.success({items:E});return ;}a=c;if(this.spinnerNode){this.spinnerNode.style.display="block";}h={styleName:"MojoFolderStyle",nameWildcards:e?16:1,blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:true,includeAncestorInfo:true,objectType:"12",quickSearch:e};h.searchPattern=e?c:c+"*";mstrApp.getRootController().getDataService().searchMetadata(j,h);}mstrmojo.qb.AttributeMappingTreeBrowserNode=mstrmojo.declare(mstrmojo.TreeBrowserNode,null,{scriptClass:"mstrmojo.qb.AttributeMappingTreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" title="{@title}" mstrAttach:mousedown,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',premousedown:function O(b){if(this._super){this._super(b);}var f=mstrmojo.dom,d=mstrmojo.dom.eventTarget(b.hWin,b.e),c=(this.state===2),e=(this.tree.branchClickPolicy===mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if(this.isSpecialNode()||!(d===this.checkBoxNode||((d===this.textNode||d===this.displayNode)&&(c||!e)))){f.stopPropogation(b.hWin,b.e);}else{this.tree.raiseEvent({name:"formSelected",evt:b,target:d});}}});mstrmojo.qb.AttributeMapping=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup],{scriptClass:"mstrmojo.qb.AttributeMapping",markupString:'<div id="{@id}"  class="mstrmojo-Editor {@cssClass}" style="top:{@top};left:{@left};" mstrAttach:mousedown><div style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown><div class="mstrmojo-qb-mapping-searchbox" mstrAttach:click ><input class="mstrmojo-SearchBox-input mstrmojo-qb-mapping-searchinput" type="text"  mstrAttach:keyup,blur/><span class="mstrmojo-qb-mapping-spinnerbox" style="width:20px;"><span class="mstrmojo-SearchBox2-spinner" id="{@id}sbSpinner"></span></span></div><div class="mstrmojo-qb-mapping-search-status"></div><div class="mstrmojo-qb-mapping-search-content"><div class="mstrmojo-di-mapping-search-tree" style="float:left"></div><div class="mstrmojo-di-mapping-search-form"></div></div><div class="mstrmojo-qb-mapping-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',markupSlots:{contentNode:function(){return this.domNode.firstChild.childNodes[2];},treeNode:function(){return this.domNode.firstChild.childNodes[2].firstChild;},formNode:function(){return this.domNode.firstChild.childNodes[2].lastChild;},inputNode:function(){return this.domNode.firstChild.firstChild.firstChild;},spinnerNode:function(){return this.domNode.firstChild.firstChild.lastChild.lastChild;},buttonNode:function(){return this.domNode.firstChild.childNodes[3];},statusNode:function(){return this.domNode.firstChild.childNodes[1];},curtainNode:function(){return this.domNode.lastChild;}},blockCount:50,cssClass:"mstrmojo-qb-mapping-editor",init:function S(b){this._super(b);this.tree.attachEventListener("formSelected",this.id,"updateFormSelector");},updateFormSelector:function J(c){var g=c.evt.src;var f=this.target.data[0];if(f.isMultiForm){if(g.text==="ID"){this.attrName.set("text",f.alias+"<br>ID");}else{var e=f.alias+"_"+g.text;if(!g.selected){var b=f.subColumns;var d=[];mstrmojo.array.forEach(b,function(j,h){if(j.fmn!=="ID"){d.push({n:j.fmn,v:h});}});this.addChildren(mstrmojo.insert({scriptClass:"mstrmojo.DropDownList",cssClass:"mstrmojo-di-mapping-form-list",slot:"formNode",options:d,alias:e}));}else{this.removeChildren(this[e]);}this.renderChildren();}}},children:[{scriptClass:"mstrmojo.TreeBrowser",slot:"treeNode",alias:"tree",noCheckBox:false,itemIdField:"did",cssClass:"mstrmojo-qb-mapping-tree",items:[],itemFunction:function K(g,d,e){var c=e.tree||e,f,h=[],b="";if(g.anc&&g.anc.items){M.forEach(g.anc.items,function(j){h.push(j.n||"");});}if(h.length>0){b="\\"+h.join("\\");}f=new mstrmojo.qb.AttributeMappingTreeBrowserNode({data:g,state:0,parent:e,tree:c,multiSelect:e.multiSelect,text:g[e.itemDisplayField],textCssClass:c.item2textCss(g),items:g[e.itemChildrenField],itemIdField:e.itemIdField,itemDisplayField:e.itemDisplayField,itemIconField:e.itemIconField,itemChildrenField:e.itemChildrenField,itemFunction:e.itemFunction,listSelector:e.listSelector,title:b,selectionPolicy:"toggle"});return f;},isBranch:function N(b){return b.items;},item2textCss:function H(b){return("mstrmojo-qb-ListIcon "+(b.items?"t12":"t21"));},selectionAcrossBranch:false,listSelector:mstrmojo.ListSelector,multiSelect:true,getContentThroughTaskCall:function R(d,c){var b=this;if(d.isRoot){c.success(b.items);}else{X(d.data,c);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapping-form-name",slot:"formNode",alias:"attrName"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-qb-mapping-status",slot:"statusNode",alias:"status",text:Y},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-qb-mapping-buttonbox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-qb-attributelink-button",cssText:"float: right",text:mstrmojo.desc(1442,"OK"),onclick:function(o){var b=this.parent.parent,d=b.children[0].getTotalSelections(),k,h,f,p,g,e,c;b.close();if(d&&d.length>0){k=mstrApp.getRootController().model;h=b.cols;var n,m;for(g=0;g<h.length;g++){f=h[g];c=k.importSources[f.tableId].currentMapping;if(!B(c,d)){var l=mstrmojo.desc(12911,"Key attribute form ID of attribute ## has not been mapped.").replace("##",d[0].an);mstrApp.getRootController().displayError(l);return ;}}for(g=0;g<h.length;g++){f=h[g];f.ipa=1;f.tp=12;if(f.isMultiForm){for(e=0;e<d.length;e++){f.subColumns[e].ipa=1;if(e===0){f.subColumns[0].oid=d[0].aid;f.subColumns[0].fmid=d[0].dssid;}else{n=f.alias+"_"+d[e].n;m=b[n].selectNode.value;f.subColumns[m].oid=d[e].aid;f.subColumns[m].fmid=d[e].dssid;}}}else{f.oid=d[0].aid;f.fmid=d[0].dssid;}f.nochange=true;}p={failure:function(j){G.call(b,j);}};k.mapAttribute(f,d[0],p,f.oid);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-qb-attributelink-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(b){var c=this.parent.parent;c.close();}}]}],onEnter:function(){D.call(this);},onEsc:function(){if(this.onCancel){this.onCancel();}this.close();},close:function(){var b;W.detachEvent(document.body,"mousedown",this._close_handler);if(this.target){Z.toggleClass(this.target.domNode,"highlight",false);}this.buttonNode.style.display="none";this.statusNode.style.display="none";this.slideProp(false,this.contentNode,95);this.slideProp(false,this.inputNode,16);b=this.domNode;self.setTimeout(function(){document.body.removeChild(b);},510);},onkeyup:function Q(c){var b=c.hWin,f=c.e||b.event;if(this.onEnter&&f.keyCode===13){this.onEnter();return ;}if(this.onEsc&&f.keyCode===27){this.onEsc();return ;}if(typeof microstrategy!=="undefined"&&microstrategy.enableQuickSearch){if(this._autoSearchTimer){self.clearTimeout(this._autoSearchTimer);}var e=microstrategy.searchAutoCompleteDelay,d=this;if(e){this._autoSearchTimer=self.setTimeout(function(){D.call(d);},e);}}else{D.call(this);}},slideProp:function(c,f,b){var d,e={target:f,props:{height:{start:(c?0:b),stop:(c?b:0),suffix:"px"}}};d=new mstrmojo.fx.AnimateProp(e);d.play();},onshowContentChange:function A(){if(this.showContent){this.contentNode.style.display="block";this.slideProp(true,this.contentNode,95);this.buttonNode.style.display="block";}else{this.contentNode.style.display="none";this.buttonNode.style.display="none";}},attachMousedownEvent:function P(){var b=this;if(!this._close_handler){this._close_handler=function(){if(!b.isOnMe(W.eventTarget(self,arguments[0]))){b.close();}};}W.attachEvent(document.body,"mousedown",this._close_handler);},isOnMe:function L(b){return W.contains(this.domNode.firstChild,b,true,document.body);},adjustPosition:function V(){var c=this.domNode,e=c.firstChild,b=e.offsetHeight,d=e.offsetWidth,g=W.windowDim(),f=W.position(e,false);if((f.x+d+I)>g.w){e.style.left=g.w-d-I+"px";}if((f.y+b+I)>g.h){e.style.top=g.h-b-I+"px";}},onOpen:function C(){var b=this.inputNode;this.tree.set("items",[]);b.value="";this.set("showContent",false);this.statusNode.style.display="none";if(!mstrmojo.dom.isWK){this.slideProp(true,b,16);}b.focus();this.attachMousedownEvent();}});}());(function(){mstrmojo.requiresCls("mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserTreeBrowser=mstrmojo.declare(mstrmojo.TreeBrowser,null,{scriptClass:"mstrmojo.ACL.UserTreeBrowser",itemIdField:"did",branchClickPolicy:mstrmojo.TreeBrowserEnum.BRANCH_POLICY_SELECT,getACLUserDataService:function D(){return mstrmojo.ACL.UserDataService;},getContentThroughTaskCall:function C(G,E){var F=this.getACLUserDataService();E.failure=mstrmojo.func.composite([function(H){if(H.getResponseHeader){mstrmojo.alert(H.getResponseHeader("X-MSTR-TaskFailureMsg"));}},E.failure]);if(G.isRoot){F.getTopLevelGroups(G,E);}else{F.getMembers(G,E);}},isBranch:function B(E){return E.isGroup;},item2textCss:function A(E){return(this._super&&this._super(E))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[E.st];}});})();(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor","mstrmojo.ObjectBrowser","mstrmojo.NewFolderEditor","mstrmojo.DI.DIHelpers");var C=mstrmojo.func,F=mstrmojo.DI.DIHelpers,E=mstrmojo.array;function B(){var H={alias:"newFolder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var J=this.parent.parent,I={zIndex:J.zIndex+10,navigateAfter:false,fId:J.ob.currentFolder.did,okFn:function(K,L){J.ob.refreshContent();if(L){J.ob.browseFolder(K.fid,J.newFolder);}}};if(J.ob.dataProvider){I.dp=J.ob.dataProvider;}J.openPopup("newFolder",I);},postCreate:function(){this.set("visible",false);}},G=mstrmojo.hash.clone(mstrmojo.ObjectBrowser.prototype.children);G.push(H);return G;}mstrmojo.SaveAsObjectBrowser=mstrmojo.declare(mstrmojo.ObjectBrowser,null,{scriptClass:"mstrmojo.SaveAsObjectBrowser",cssClass:"mstrmojo-SaveAs-OB",children:B(),getRecents:function(G){var H=this;G.onClose=function(){if(H.recentFolders){this.removeChildren(this.recentLable);this.removeChildren(this.recentList);delete H.recentFolders;}};this.getDataProvider().loadRecentSaveAsFolders({success:function(I){if(H.recentFolders){G.removeChildren(G.recentLable);G.removeChildren(G.recentList);delete H.recentFolders;}if(I&&I!==""){H.recentFolders=H.getList(I.objects,G);G.addChildren(H.recentFolders);}},failure:function(I){mstrmojo.alert(I.message||I.getResponseHeader("X-MSTR-TaskFailureMsg"));},});},getList:function(H,G){var I=this;return[{scriptClass:"mstrmojo.Label",alias:"recentLable",cssClass:"recentLabel",text:mstrmojo.desc(14354,"Recents")},{scriptClass:"mstrmojo.ui.List",alias:"recentList",items:H,cssClass:"recentList",onclick:function(J){var K=this.getItemFromTarget(J.getTarget());I.browseFolder(K.did,"");G.close();}}];}});var A={success:function(G){var H=this.parent;if(H.onObjectSaved){H.onObjectSaved({name:H.name,did:G.did,desc:H.desc});}mstrmojo.alert(mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",H.typeDesc||"Object").replace("###",H.name),null,mstrmojo.desc(7984,"Object Saved"));H.ob.refreshContent();H.close();},failure:function(H){var G=parseInt(H.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296,I=this.parent;if(G===2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",I&&I.typeDesc||"Object").replace("'###'",I&&I.name?'"'+I.name+'"':""),{confirmBtn:{fn:function(){I.saveAs(true);}}},{title:mstrmojo.desc(3179),zIndex:I&&I.zIndex+10});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+H.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};mstrmojo.SaveAsEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SaveAsEditor",cssClass:"mstrmojo-SaveAsEditor",title:mstrmojo.desc(3167,"Save As"),sId:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:null,browsableTypes:null,showCompletePath:true,desc:"",name:"",displaySaveLabel:true,searchVisible:true,upButtonVisible:true,children:[{scriptClass:"mstrmojo.SaveAsObjectBrowser",alias:"ob",closeable:false,closeOnSelect:false,fishEyeVisible:false,bindings:{showCompletePath:"this.parent.showCompletePath",rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",browsableTypes:"this.parent.browsableTypes",displaySaveLabel:"this.parent.displaySaveLabel",searchVisible:"this.parent.searchVisible",upButtonVisible:"this.parent.upButtonVisible",sId:"this.parent.sId"},postCreate:function(){this.onSelectCB=[this.parent,"onOBSelect"];this.onBrowseFolder=[this.parent,"onOBBrowseFolder"];}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput",bindings:{value:"this.parent.parent.name"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",bindings:{value:"this.parent.parent.desc"},rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{alias:"newFolder",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var H=this.parent.parent,G={zIndex:H.zIndex+10,navigateAfter:false,fId:H.ob.currentFolder.did,okFn:function(I,J){H.ob.refreshContent();if(J){H.ob.browseFolder(I.fid,H.newFolder);}},cssClass:F.getEnvObj().isAppSchema()?"workstation":undefined};if(H.ob.dataProvider){G.dp=H.ob.dataProvider;}H.openPopup("newFolder",G);},postCreate:function(){this.set("visible",mstrmojo.resolveFeature("create-folder")||F.getEnvObj().isAppSchema());}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot okButton",alias:"ok",text:mstrmojo.desc(2400,"Save"),onclick:function(){this.parent.parent.saveAs();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],newFolder:{scriptClass:"mstrmojo.NewFolderEditor"},onOpen:function(){this.ob.browse();},onOBBrowseFolder:mstrmojo.emptyFn,onOBSelect:function(G){this.set("name",G.n);},saveAsCallback:function D(){return A;},saveAs:function(J){var H=this.contPanel;this.name=H.name.value;this.desc=H.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var L=this.saveParams||{};L.folderID=this.ob.currentFolder.did;L.description=this.desc||"";L.name=this.name||"";L.saveAsOverwrite=!!J;var G=this.saveAsCallback(),K=this,I={success:function(){K.saveRecentFolders(K.ob.currentFolder.did);},failure:function(M){mstrmojo.alert(M.message||M.getResponseHeader("X-MSTR-TaskFailureMsg"));}};G.parent=this;if(!mstrApp.isSingleTier){G=C.wrapMethods(G,I);}mstrmojo.xhr.request("POST",mstrConfig.taskURL,G,L);},saveRecentFolders:function(K){var I,G,H,J=this;J.ob.getDataProvider().loadRecentSaveAsFolders({success:function(L){G=[];E.forEach(L.objects,function(O){G.push(O.did);});H=mstrmojo.array.indexOf(G,K);if(H!==-1){G.splice(H,1);}G.unshift(K);I=G.slice(0,3).join(",")+",";var M={taskId:"setPreference",prefs:"recentFolders\u001E"+I};var N={success:function(){mstrConfig.recentFolders=I;},failure:function(O){mstrmojo.alert(O.message||O.getResponseHeader("X-MSTR-TaskFailureMsg"));}};J.ob.getDataProvider().serverRequest(M,N);},failure:function(L){mstrmojo.alert(L.message||L.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}});mstrmojo.SaveAsEditor.SAVEAS_CALLBACK=A;})();(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ObjectBrowser");var H=mstrmojo.array;var E=[257,1024,3072,12032];mstrmojo.vi.ui.editors.ObjectPicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ObjectPicker",cssClass:"mstrmojo-vi-ObjectPicker",zIndex:9,title:mstrmojo.desc(11496,"Select Object"),help:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:4,supportedTypes:H.hash(E),item:null,OKFn:null,children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"ob",closeable:false,browsableTypes:"8,"+E.join(","),closeOnSelect:false,showCompletePath:false,searchVisible:false,scrollableIncFetch:true,bindings:{rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",isImportFromCube:"this.parent.isImportFromCube",}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btnHBox",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function C(){var J=this.parent.parent;this.parent.parent.close({item:J.item});var I=J.OKFn;if(I){I(J.item);}J.set("item",null);},bindings:{enabled:function B(){return !!this.parent.parent.item;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancle"),onclick:function C(){var I=this.parent.parent;this.parent.parent.close();I.set("item",null);}}]}],preBuildRendering:function A(){if(this._super){this._super();}this.ob.onSelectCB=[this,"onOBSelect"];},postBuildRendering:function D(){if(this._super){this._super();}this.browse();},onOBSelect:function F(I){this.set("item",((this.supportedTypes[I.t]||this.supportedTypes[I.st])?I:null));},browse:function G(){this.ob.browse();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DIObjectBrowser","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget");mstrmojo.requiresDescs(8338,8513,12891);var I=mstrmojo.DI.DIConstants,E=mstrmojo.DI.DIConstants.sourceType,D=mstrmojo.DI.DIHelpers.isOperationMode;function B(J,K){return J+"###path:"+K;}mstrmojo.DI.DISourceObjects=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DISourceObjects",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div class="cf source-objects-options"></div><div></div><div style="padding-left:20px;"></div><div style="padding-left:20px;padding-right:20px;"></div><div class="show-preview"></div><div class="source-objects-refresh"></div></div>',markupSlots:{subtitleNode:function(){return this.domNode.children[0];},analyticsNode:function(){return this.domNode.children[1];},listHeaderNode:function(){return this.domNode.children[2];},listNode:function(){return this.domNode.children[3];},previewNode:function(){return this.domNode.children[4];},refreshNode:function(){return this.domNode.children[5];}},markupMethods:{onvisibleChange:function(){var J=mstrApp.getRootController().getModel().operationMode;if(D(this.operationMode)){J=this.operationMode;}this.domNode.style.display=this.visible?"block":"none";}},isMultiSelect:true,children:[{slot:"subtitleNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-signout",text:mstrmojo.desc(8338,"sign out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(this.parent.sourceObjectsInfo.type);}},{slot:"subtitleNode",scriptClass:"mstrmojo.Label",cssClass:"source-objects-username",alias:"username",postBuildRendering:function(){this.update();mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.update);},update:function(){var J=mstrApp.getRootController().model.externalSources[this.parent.sourceObjectsInfo.type],K=J.userDisplayName;if(J.userEmail){K+=" ("+J.userEmail+")";}this.set("text",K);}},{slot:"subtitleNode",alias:"subtitle",scriptClass:"mstrmojo.Label",cssClass:"source-objects-subtitle",bindings:{text:function(){return mstrmojo.desc(12891,"Select Your file from ####").replace("####",this.parent.sourceObjectsInfo.name);},visible:function(){if(this.parent.sourceObjectsInfo.type===E.googleAnalytics){return false;}return true;}}},{slot:"subtitleNode",scriptClass:"mstrmojo.Label",allowHTML:true,cssClass:"source-objects-subtitle2",alias:"rightFormat",text:'|  Make sure your file is in <a target="_blank" href="http://www.microstrategy.com/express/resources/data-preparation">right format!</a>'},{scriptClass:"mstrmojo.DI.DIObjectBrowser",cssClass:"source-objects-browser",slot:"listNode",alias:"browser",browseFunction:function(J){return mstrApp.getRootController().oAuthSourceBrowserFunction(this.parent.sourceObjectsInfo.type,J);},editFunction:function(J){this.parent.onEditButtonClick(J);},refreshFunction:function(){mstrApp.getRootController().getOAuthSourceReports(this.parent.sourceObjectsInfo.type,false);},bindings:{visible:function(){if(this.parent.sourceObjectsInfo.type===E.googleAnalytics){return(this.parent.analyticsComponent.ultp.selectedIndex===0);}return true;},canRefresh:function(){return this.parent.sourceObjectsInfo.type!==E.googleAnalytics;},isMultiSelect:"this.parent.isMultiSelect"},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},autoSelectNode:function(J,K){if(J.data.isFolder){J.data.browser.clickedNode=J;mstrApp.getRootController().oAuthSourceBrowserFunction(this.parent.sourceObjectsInfo.type,J,K);}else{J.data.list.selectedItem=J.data;J.selectThisNode();mstrApp.getRootController().sourceSelected(true);}},postCreate:function(){this.sortRoot=(this.parent.sourceObjectsInfo.type!==E.salesforce);}},{scriptClass:"mstrmojo.TextArea",slot:"listNode",alias:"textarea",maxLength:2000,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onheightChange:function(){this.domNode.style.height=this.height||"";},onwidthChange:function(){this.domNode.style.width=this.width||"";}},onvalueChange:function(){if(this.value!==""){mstrApp.getRootController().sourceSelected(true);}else{mstrApp.getRootController().sourceSelected(false);}},bindings:{value:function(){var J=mstrApp.getRootController().getModel().operationMode;if(D(this.operationMode)){J=this.operationMode;}if(J!==I.operationMode.create){return this.model.currentSource.sourceInfo.name;}return"";},visible:function(){if(this.parent.sourceObjectsInfo.type===E.googleAnalytics){return(this.parent.analyticsComponent.ultp.selectedIndex===1);}return false;}}}],populate:function(W){var V=this.model.externalSources[this.sourceObjectsInfo.type].reports;var U=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,V);this.browser.set("fileList",U);var X,S,L,P;var M=this.model.operationMode;if(D(this.operationMode)){M=this.operationMode;}var K,R,Q,O,J=null;if(W&&W.targetPageId){if(W.targetPageId!==this.id){return ;}}if(M===I.operationMode.refresh||M===I.operationMode.edit){J=this.model.currentSource;if(this.tableID){J=this.model.getImportSource(this.tableID);}if(this.currentSource){J=this.currentSource;}if(this.sourceObjectsInfo.type===E.salesforce){if(J&&J.sourceInfo&&J.sourceInfo.url){K=this.browser.fileTree.items;for(Q=0;Q<K.length;Q++){R=K[Q].items;for(O=0;O<R.length;O++){var N=R[O];if(N.n===J.sourceInfo.name){K[Q].node.set("state",1);N.node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===E.dropbox){if(J&&J.sourceInfo&&J.sourceInfo.url){R=K=this.browser.fileTree.items;X=J.sourceInfo.url;S=X.indexOf("/",1);if(S!==-1){L=X.substring(1,S);for(Q=0;Q<K.length;Q++){if(K[Q].isFolder===true&&K[Q].n===L){this.browser.autoSelectNode(K[Q].node,X.substring(S));K[Q].fetched=true;K[Q].node.set("state",1);}}}else{P=X.substring(1);for(Q=0;Q<R.length;Q++){if(R[Q].isFolder!==true&&R[Q].n===P){R[Q].node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===E.googleDrive){if(J&&J.sourceInfo&&J.sourceInfo.url){R=K=this.browser.fileTree.items;X=J.sourceInfo.url;X=X.substr(X.indexOf("###")+"###path:".length);S=X.indexOf("/",1);while(S!==-1){L=X.substring(1,S);for(Q=0;Q<K.length;Q++){if(K[Q].isFolder===true&&K[Q].n===L){this.browser.autoSelectNode(K[Q].node,X.substring(S));K[Q].fetched=true;K[Q].node.set("state",1);}}X=X.substr(S);S=X.indexOf("/",1);}P=X.substring(1);for(Q=0;Q<R.length;Q++){if(R[Q].isFolder!==true&&R[Q].n===P){R[Q].node.selectThisNode();}}}}}this.username.set("text",mstrmojo.desc(8513,"User:")+this.model.externalSources[this.sourceObjectsInfo.type].userDisplayName+" | ");},preBuildRendering:function G(){var K=this.model.operationMode;if(D(this.operationMode)){K=this.operationMode;}mstrApp.getRootController().sourceSelected(false);var J=this.sourceObjectsInfo.name.toLowerCase();if(J.indexOf(" ")!==-1){J=J.substring(0,J.indexOf(" "))+J.substring(J.indexOf(" ")+1,J.length);}this.subtitle.cssClass+=" extrasmall-"+J;if(this.sourceObjectsInfo.type===E.googleAnalytics||this.sourceObjectsInfo.type===E.salesforce||K===I.operationMode.refresh){this.rightFormat.set("visible",false);}this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);if(this._super){this._super();}},setDimensions:function F(M,K){var J=parseInt(M,10);var L=parseInt(K,10);var N=this.model.operationMode;if(D(this.operationMode)){N=this.operationMode;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=(J-70)+"px";if(N===I.operationMode.refresh||N===I.operationMode.edit){this.layoutConfig.h.listNode=(J-340)+"px";}this.layoutConfig.w.listNode=(L-40)+"px";if(this._super){this._super(J+"px",K);}},postBuildRendering:function A(){if(this._super){this._super();}this.model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);},onNextButtonClick:function C(){var O=this.model.operationMode;var K=[];var N,L,J,P;var M=this.tableID||null;if(D(this.operationMode)){O=this.operationMode;}J=(O===I.operationMode.create)?true:this.showPrv.checked;P=this.browser.fileTree;for(L=0;L<P.selectedNodes.length;L++){N=P.selectedNodes[L].data;K.push({n:N.n,desc:N.desc,query:B(N.address,N.folderPath+"/"+N.n),type:N.type,tableID:M});}mstrApp.getRootController().importMultiOAuthReports(this.sourceObjectsInfo.type,K,J,!mstrApp.getRootController().model.hasEMMAReportInstance(),M?I.actions.refreshData:I.actions.importSource,this.id);},onBackButtonClick:function H(){var J=mstrApp.getRootController();J.showPage(I.pageType.dataSelection);},setSelectedNodes:function(J){var M=this.browser.fileTree,K=0,L;for(K=0;K<M.selectedNodes.length;K++){L=M.selectedNodes[K];L.deselect();}M.selectedNodes=[];M.selectedNode=null;this.browser.set("forceEnableContinue",true);for(K=0;K<J.length;K++){J[K].selectThisNode();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasPopup","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.ConditionNode","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr");var E=mstrmojo,A=E.css,I=E.dom,F=E.hash,G=E.string,C=function(N){var O=N.data,M=O.dmy&&O.dmy.uts||[],K=M.length,J=[],L;for(L=0;L<K;L++){J.push(G.encodeHtmlString(M[L].n));}return'<span class="mstrmojo-text">'+J.join(", ")+"</span>";};mstrmojo.fe.RelationNode=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><span class="mstrmojo-relationNode-inf"><span class="mstrmojo-relation-prefix-text">'+mstrmojo.desc(2790,"Set of").replace(/##/g,"")+'</span><span class="mstrmojo-textset"  mstrAttach:click></span><span class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(2793,"Where").replace(/##/g,"")+'</span><span class="mstrmojo-relation-convert-text"  mstrAttach:click >'+mstrmojo.desc(15412,"Convert to Condition")+'</span><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></span><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},convertNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[3];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){A.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=C(this);}},noRelationOperator:true,children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(J){this.parent.tree.onNew(J);},getItemConfig:function(M,J,N){var K=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,M,J,N),L=N.tree||N;return F.copy({tree:L,rootTree:this.parent.tree,noRelation:true,inRelation:true},K);},prenodeclick:function(J){if(!J||!J.part){return ;}var K=this.rootTree;if(K&&K.onnodeclick&&this.editable){J.editor=K.editor;K.onnodeclick.call(this,J);}}}],premousedown:function(J){if(this._super){this._super(J);}var K=I.eventTarget(J.hWin,J.e);if(!I.contains(this.childTree.domNode,K,true)){this.childTree.clearTreeSelect();}},preselectedChange:function(J){if(!J.value){this.childTree.clearTreeSelect();}},init:function(J){this._super(J);var K=this.data;if(K){delete this.data;this._set_data(null,K);}},_set_data:function(M,J){var K=this.data;if(J&&(!J.relation)){J.relation={};}var L=(K!==J);if(L){this.data=J;if(J){this.childTree.set("items",J.nds||[J]);}}return L;},isSelectableArea:function(J){return mstrmojo.dom.contains(this.relationNode,J,true);},preclick:function D(J){var L=null,K=I.eventTarget(J.hWin,J.e);if(I.contains(this.prefixNode,K,true)){L="andor";}else{if(I.contains(this.textNode,K,true)){L="createSet";}else{if(I.contains(this.convertNode,K,true)){this.parent.removeSet(this);return false;}}}J.part=L;},del:function H(){var J=this.parent;if(J&&J.remove&&this.data){J.remove(this.data);}},newCondition:function B(J){this.childTree.newCondition(J);},avatarCssCls:"mstrmojo-FE mstrmojo-relationNode",getAvatarNode:function(){return this.relationNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.Label","mstrmojo.Obj","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.warehouse.EnumObjectTypes");var H=mstrmojo.expr,I=H.ET,C=mstrmojo.array,F=mstrmojo.string,E=mstrmojo.warehouse.EnumObjectTypes,G=mstrmojo.mstr.EnumNodeDimty,D=mstrmojo.hash;mstrmojo.fe.CreateSetEditor=mstrmojo.declare(mstrmojo.Editor,null,{onOpen:function(){var Q=this.model,X=this.condition.data,R=!X.m,N=this.attrsBox.attrsList,J=this.relBox.relPd,S=C.filter(Q.metrics,function(a){return !a.um;}),Y=[{n:mstrmojo.desc(12037,"System Default"),t:-1,did:"default"}].concat(S),L=this.appQualBox.appQual,Z=D.clone(Q.attrs);C.forEach(Z,function(b){var a=false;if(b.t===E.ATTRIBUTE){C.forEach(b.fs,function(c){if(c.fgr>0){a=true;return false;}});}b.css=(b.css||"")+" "+(b.t?("t"+b.t+((b.da||b.um)?"d":"")+(a?"g":"")+(b.st?(" st"+b.st):"")):"");});N.set("items",Z);mstrmojo.array.forEach(["relBox","appQualBox"],function(a){this[a].set("visible",R);},this);if(X.dmt===4&&X.dmy.uts){var M={};C.forEach(X.dmy.uts,function(b){var a=C.find(Q.attrs,"did",b.utgt.did);if(a>=0){M[a]=true;}});N.set("selectedIndices",M);}if(R){J.set("items",Y);if(X.relation&&X.relation.guide){var O=X.relation.guide,W=C.find(Y,"did",O.did);J.set("selectedIndex",W>=0?W:0);}else{J.set("selectedIndex",0);}L.set("checked",!!X.applySubExpr);}if(mstrApp.isWSStyling){var V={left:parseInt(this.left,10),top:parseInt(this.top,10)},K=this.editorNode.getBoundingClientRect(),U={width:window.innerWidth,height:window.innerHeight},P={width:K.right-K.left,height:K.bottom-K.top};if(K.right>U.width){this.set("left",(V.left-P.width)+"px");}if(K.bottom>U.height){this.set("top",(V.top-P.height)+"px");}}},onOK:function(){var Q=this.model,U=this.condition,W=this.condition.data,N=this.attrsBox.attrsList,J=this.relBox.relPd,L=this.appQualBox.appQual;var Y=N.getSelectedItems(),K=[];C.forEach(Y,function(a){K.push({utgt:{n:a.n,did:a.did},utp:H.DMY_TP.ATTR,agg:1,flt:2,gb:true,rps:0,n:a.n});});var X;if(J.selectedIndex>0){var O=J.items[J.selectedIndex];X={n:O.n,did:O.did,t:E.METRIC,st:1024};}var M;if(W.et===15){W.dmt=G.NodeDimtyOutputLevel;W.dmy=W.dmy||{};W.dmy.uts=K;M=W.relation=W.relation||{};if(X){M.guide=X;W.useSchema=false;}else{delete M.guide;delete M.rsTp;delete M.joTp;delete M.paTp;delete M.erTp;W.useSchema=true;}W.applySubExpr=L.checked;U.set("data",W);}else{var V={et:15};V.dmt=G.NodeDimtyOutputLevel;V.dmy={};V.dmy.uts=K;M=V.relation={};if(X){M.guide=X;}else{V.useSchema=true;}V.applySubExpr=L.checked;var P=U,R={rq:V,cq:W},S=[U.childIndex()];if(W.et===I.ANDOR){if(W.nds&&W.nds.length>2){var Z=Q.childIdx;S=[Z,Z-1];}else{P=U.parent;}}else{P=U.parent;R.isMetric=!!W.m;}P.createSet(S,R);}},children:[{scriptClass:"mstrmojo.Box",alias:"attrsBox",cssClass:"Attributes-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14613,"Select attributes to create the set"),cssClass:"Label",alias:"attrsBoxLabel"},{scriptClass:"mstrmojo.ui.CheckList",alias:"attrsList",cssClass:"CheckList"}]},{scriptClass:"mstrmojo.Box",alias:"relBox",cssClass:"RelatedBy-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12036,"Related by"),cssClass:"Label",cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"relPd",cssClass:"Pulldown",cssDisplay:"inline-block",allowHTML:false,onitemSelected:function B(J){}}]},{scriptClass:"mstrmojo.Box",alias:"appQualBox",cssClass:"AppQual-Box",children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"appQual",cssClass:"AppQual-CheckBox"},{scriptClass:"mstrmojo.Label",cssClass:"AppQual-Label",text:mstrmojo.desc(12038,"Apply this qualification independently of the relationship filter"),postBuildRendering:function(){if(this._super){this._super();}if(mstrApp.isWSStyling){this.set("text",mstrmojo.desc(15015,"Apply this qualification to define the set, and also to the results of the visualization."));}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float: right; border-collapse: separate; display: table;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(2397,"OK"),onclick:function(){var J=this.editor;J.onOK();J.close();},bindings:{enabled:function(){var K=this.parent.parent.attrsBox.attrsList,J=this.parent.parent.attrsBox.attrsList.selectedIndices;return K.getSelectedItems().length>0;},editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.close();},bindings:{editor:"this.parent.parent"}}]}],postBuildRendering:function A(){this._super();if(mstrApp&&mstrApp.isWSStyling){this.attrsBox.attrsBoxLabel.set("text",mstrmojo.desc(15013,"Select the attributes that you look for."));}}});})();(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.FilterExpr");var D=mstrmojo.hash,B=mstrmojo.expr.ET;mstrmojo.fe.FilterExprTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.fe.FilterExprTree",allowCopy:false,containerResizable:false,draggable:true,dropZone:true,editable:true,makeObservable:true,onConditionEdit:mstrmojo.emptyFn,modifyConditionNode:function(G,F){var H=G.data,E=H.isNew;D.copy(D.clone(F),D.clear(H));delete H.isNew;G.paint();if(H.et===B.MQ||H.et===B.MC){G.set("noCreateSet",!mstrApp.supportAdvFilter);}if(G.tree.onConditionEdit){G.tree.onConditionEdit(G,E);}},getItemConfig:function(H,E,I){var F=this._super(H,E,I),G=I.tree;return D.copy({onclick:G.prenodeclick,containerResizable:G.containerResizable,ondragend:G.ondragend,ondrop:G.ondrop},F);},ondragenter:function A(E){this.dropCuePos={left:0,top:0,idx:0,idxActual:0};this._super(E);},ondragend:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondragend.call(this,E);}},ondrop:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondrop.call(this,E);}},isEditable:function C(F){if(!this.editable){return false;}var E=false;switch(F&&F.et){case B.R:case B.F:E=false;break;case B.ANDOR:case B.MQ:case B.AQ:case B.AL:case B.AC:case B.MC:case B.AE:E=true;break;case B.XML:E=!F.xml||!!F.ph;}return E;},prenodeclick:function(E){if(!E||!E.part){return ;}if(E.part!=="createSet"&&E.part!=="createSetOpt"&&!(E.part==="andor"?this.prefixedAndOrEditable:this.editable)){return ;}var F=this.tree;if(F.onnodeclick){F.onnodeclick.call(this,E);}},getSelectedItemWidget:function(){var E=function(K){var I=K&&K.ctxtBuilder&&K.ctxtBuilder.itemWidgets,G=K.selectedIndex,F=I&&I.length||0;if(!I){return ;}if(G===-1){for(var H=0;H<F;H++){var J=E(I[H]);if(J){return J;}}}else{return I[G];}};return E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.FilterExpr");var J=mstrmojo.expr,L=J.ET,C={},G=mstrmojo.hash,M=mstrmojo.dom;C[L.ANDOR]=mstrmojo.AndOrNode;C["*"]=mstrmojo.ConditionNode;function A(){var O=this.tree,N=O.parent,P=M.delta(this.domNode,O.domNode);if(this.data.sqltp===1){P.y+=parseInt(N.filterExpr.domNode.offsetHeight,10)+15;}N.parent.openPopup("andOrPopupRef",{condition:this,zIndex:this.zIndex?this.zIndex+100:100,left:P.x+40+"px",top:P.y+65-N.domNode.scrollTop+"px"});}function I(P){if(P.constructor!==Array){P=[P];}var U,S={b:0,c:0},V,R,O;for(var Q=0,N=P.length;Q<N;Q++){U=P[Q];if(!(U&&U.et)){continue;}V=U.nds;if(V){R=I(V);S.b+=R.b;S.c+=R.c;}else{O=(U.et===L.B);S[O?"b":"c"]++;}}return S;}function H(O){var P=O.parent.data;if(P){var N=O.items;if(O.alias==="filterExpr"){P.expr=N&&N[0];}else{P.aggexpr=N&&N[0];}}}function D(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount+P.b);O.set("conditionCount",O.conditionCount+P.c);}function B(N){var P=I(N.value),O=this.tree;O.set("bandingCount",O.bandingCount-P.b);O.set("conditionCount",O.conditionCount-P.c);}mstrmojo.qb.FilterTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.qb.FilterTree",draggable:true,dropZone:true,allowCopy:false,makeObservable:true,bandingCount:0,conditionCount:0,onadd:function(N){H(this);D.apply(this,[N]);},onremove:function(N){H(this);B.apply(this,[N]);},editable:true,onRender:function(){var O=I(this.items),N=this.tree;N.set("bandingCount",O.b);N.set("conditionCount",O.c);},itemFunction:function(S,O,U){var Q=(S.et===L.ANDOR),R=U.tree||U,P={data:S,tree:R,parent:U,itemFunction:Q?U.itemFunction:null,draggable:Q?R.draggable:false,dropZone:Q?R.dropZone:false,allowDrop:Q&&R.dropZone?R.allowDrop:null,allowCopy:Q?R.allowCopy:false,editable:R.isEditable?R.isEditable(S):R.editable,makeObservable:Q&&U.makeObservable,onclick:R.onnodeclick,onadd:R.onnodeadd,onremove:R.onnoderemove},N=C[S.et]||C["*"];return N&&(new N(P));},isEditable:function K(O){if(!this.editable){return false;}var N=false;switch(O&&O.et){case L.AQ:case L.ANDOR:case L.RLS:case"*":N=true;break;}return N;},onnodeclick:function F(O){if(!this.editable){return ;}if(O&&O.part==="andor"){A.call(this);}else{var N=this.tree;N.onexprclick&&N.onexprclick(this);}},onnodeadd:D,onnoderemove:B,allowDrop:function E(N){var P=N&&N.src,S=P&&P.data,R=S&&S.et,Q=(R===L.B),O=this.tree;return R&&((Q&&(O.conditionCount===0))||(!Q&&(O.bandingCount===0)));}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._ValidateSuggestions","mstrmojo.WidgetList","mstrmojo.Editor","mstrmojo.LegacySuggestionList");mstrmojo.Enum_OIB_States=mstrmojo.hash.copy(mstrmojo._ValidateSuggestions.ENUM_STATES,{EDITING:2,ADDING:3,EMPTY:4});mstrmojo.Enum_OIB_States_CSS=(function(){var AI=mstrmojo.Enum_OIB_States,AH={},AJ;for(AJ in AI){if(AI.hasOwnProperty(AJ)){AH[String(AI[AJ])]=AJ;}}return AH;}());var Q=mstrmojo.dom,S=mstrmojo.hash,b=mstrmojo.Enum_OIB_States,I=0,d="_did_",AD=mstrmojo.Enum_Keys,AF=80,V=200;function Y(){return(mstrApp&&mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay())?mstrApp.searchAutoCompleteDelay():V;}function P(){return I++;}function j(AH){return(AH&&AH.state===b.ADDING);}function t(AH){var AI={n:AH||"",state:b.EMPTY};AI[d]=-2;return AI;}function O(AH){return(AH&&AH.state===b.EMPTY);}function z(AI){var AJ=AI.items,AH=AJ&&AJ.length;if(!AH){return true;}return(AH===1&&j(AJ[0]))||(AH===2&&O(AJ[0])&&j(AJ[1]));}function n(){var AI=this.ctxtBuilder.itemWidgets,AH=AI[AI.length-1];if(AH&&AH.isAdding){var AJ=this;Q.attachEvent(AH.domNode,"click",function(){AJ.editingIdx=null;});return AH;}return null;}function L(){var AH=this.editingIdx;if(AH!==null){return this.ctxtBuilder.itemWidgets[AH];}return n.call(this);}function D(){this.isActive=false;var AI=this.emptyText||"",AJ=this.items;if(z(this)&&!O(AJ[0])&&(AI.length>0)){this.add([t(AI)],0);var AK=this.ctxtBuilder.itemWidgets[0];AK.set("shouldEllipsize",true);AK.doEllipsize();}var AH=L.call(this);if(AH){if(j(AH)&&this.showEmptyItem){AH.domNode.style.visibility="hidden";}AH.blur();}Q.detachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.detachEvent(AH.inputNode,"keydown",this._tabKeyHander);}}function N(){if(!this.enabled){return ;}this.isActive=true;if(O(this.items[0])){this.remove(0);}var AH=L.call(this);if(AH){if(j(AH)&&!this.isFull){AH.domNode.style.display="block";AH.domNode.style.visibility="visible";}this.scrollTo(AH.data);AH.focus();}Q.attachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.attachEvent(AH.inputNode,"keydown",this._tabKeyHander);}}mstrmojo.ObjectInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._ValidateSuggestions],{scriptClass:"mstrmojo.ObjectInputBox",cssClass:"mstrmojo-ObjectInputBox",emptyText:"",showEmptyItem:true,items:null,itemField:"n",dynamicVerify:true,suggestCount:10,candidates:null,makeObservable:true,renderOnScroll:false,editingIdx:null,isActive:false,maxObjectCount:null,isFull:false,suggestionListClass:"mstrmojo.LegacySuggestionList",acptSugItemOnly:false,useKeyDelay:false,showSuggestionOnEdit:true,tabNavigable:false,getSearchPattern:function(){var AH=L.call(this);if(AH){return AH.getSearchPattern();}return"";},getSuggestionTarget:function o(){return this.suggestTarget;},onsuggestTargetChanged:function q(AH){this._request_pattern=null;},getSuggestionPos:function e(){return this._pop_cfg;},onSuggestionItemSelect:function AA(AH){if(this.suggestTarget){this.suggestTarget.setItem(AH[this.itemField],AH,false);}this.hideSuggestion();this.closePopup();},hideEditButton:function(AH){return !!this.noEditButton;},_set_items:function m(AM,AJ){AJ=mstrmojo.hash.clone(AJ)||[];var AL=this.maxObjectCount;this.set("isFull",(AL&&AJ.length>=AL));if(AJ.length===0){var AI=this.emptyText||"";if(AI.length>0){AJ.push(t(AI));}}var AK={n:"",state:b.ADDING};AK[d]=-1;AJ.push(AK);var AH=AJ[AJ.length-1];if(AH&&j(AH)&&this.maxObjectCount&&(this.getSelectedObjects().length>=this.maxObjectCount)){this.set("isFull",true);}this.itemIdField=d;return this._super(AM,AJ);},add:function E(AI,AH){var AJ=n.call(this);if(!this.maxObjectCount||this.getSelectedObjects().length<this.maxObjectCount){this._super(AI,AH);}if(!z(this)&&O(this.items[0])){this.remove(0);}if(AJ){AJ.adjustInputWidth();if(this.maxObjectCount&&(this.getSelectedObjects().length===this.maxObjectCount)){this.set("isFull",true);AJ.domNode.style.display="none";}else{AJ.domNode.style.display=this.showEmptyItem?"none":"";}}},remove:function c(AH){this._super(AH);var AI=n.call(this);if(AI){if(this.maxObjectCount&&(this.getSelectedObjects().length<this.maxObjectCount)){this.set("isFull",false);}AI.adjustInputWidth();}},preBuildRendering:function(){if(this.items==null||this.items.length==0){this.set("items",[]);}if(this._super){this._super();}},postBuildRendering:function a(){this._super();var AI=this,AH=n.call(AI);if(AH&&(this.showEmptyItem||this.isFull)){AH.domNode.style.display="none";}this._clickHandler=function(){N.call(AI);};this._mousedownHandler=function(AJ){if(!AI.isActive||AI.browserShown){return ;}var AK=Q.eventTarget(self,AJ);if(AK&&AK.parentNode&&!Q.contains(L.call(AI).domNode,AK,false,document.body)&&!Q.contains(AI.suggestionPopup.domNode,AK,false,document.body)){D.call(AI);}};if(this.tabNavigable){this._tabKeyHander=function(AJ){var AK=parseInt(AJ.keyCode||AJ.charCode,10);if(AK===AD.TAB){if(!AI.isActive||AI.browserShown){return ;}D.call(AI);}};}Q.attachEvent(this.domNode,"click",this._clickHandler);},nextId:P,item2textCss:function M(AH){return AH.cssClass||"";},itemFunction:function G(AJ,AH,AI){AJ[AI.itemIdField]=P();var AK=new mstrmojo.ObjectItem({parent:AI,itemField:AI.itemField,cssClass:AI.item2textCss(AJ),data:AJ,showSuggestionOnEdit:this.showSuggestionOnEdit,enabled:AI.enabled});AI.attachEventListener4ItemWidget(AK,AI);return AK;},attachEventListener4ItemWidget:function k(AL,AJ){var AI=["ItemEditBegin","ItemEditEnd","ItemDeletePrev","ItemDelete","ItemAdd","SuggestionOn","SuggestionOff","ItemEditing"],AH=AI.length,AK;for(AK=0;AK<AH;AK++){AL.attachEventListener(AI[AK],AJ.id,"_itemChangeHandler");}return AL;},getSelectedObjects:function l(){if(z(this)){return[];}var AH=this.items,AI=AH.length-1;if((AI>-1)&&j(AH[AI])){return AH.slice(0,AI);}return AH.concat();},isValid:function C(){var AI=this.ctxtBuilder.itemWidgets,AH=AI&&AI.length,AJ;for(AJ=0;AJ<AH;AJ++){if(!AI[AJ].isValid()){return false;}}return true;},isEmpty:function W(){return z(this);},_itemChangeHandler:function(AK){var AM=AK.name,AN=AK.d,AI,AH=this.items.length,AJ;switch(AM){case"ItemEditBegin":if(this.editingIdx!==null){AJ=L.call(this);if(AJ){AJ.blur();}}AI=this.itemIndex(AN);this.editingIdx=AI;N.call(this);break;case"ItemEditEnd":this.editingIdx=null;if(AK.deactivate){D.call(this);}else{N.call(this);}AJ=n.call(this);if(AJ){AJ.adjustInputWidth();}break;case"ItemDelete":if(this.editingIdx!==null){AJ=L.call(this);if(AJ){AJ.blur();}this.editingIdx=null;}AI=this.itemIndex(AN);this.remove(AI);if(!AK.deactivate){this.editingIdx=null;N.call(this);}else{if(!this.isActive){D.call(this);}else{N.call(this);}}break;case"ItemDeletePrev":if(AH>1){this.remove(AH-2);}break;case"ItemAdd":var AL=S.copy(AK.d);this.add([AL],AH-1);if(AK.deactivate){D.call(this);}else{N.call(this);}break;case"SuggestionOn":this.set("suggestTarget",AK.target);this._pop_cfg={target:AK.target,left:AK.l,top:AK.t,zIndex:this.zIndex?this.zIndex:100};this.showSuggestion(AK.pattern);break;case"SuggestionOff":this.set("suggestTarget",null);this.hideSuggestion();break;}if(this.onitemchange&&(AM==="ItemEditEnd"||AM==="ItemAdd"||AM==="ItemDelete"||AM==="ItemDeletePrev"||AM==="ItemEditing")){this.onitemchange();}},unrender:function B(AI){var AH=this.suggestionPopup;if(AH.hasRendered){AH.unrender(false);}if(this._super){this._super(AI);}},destroy:function x(AI){var AH=this.suggestionPopup;if(AH&&AH.hasRendered){AH.destroy(false);}if(this._super){this._super(AI);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ObjectInputBox,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasEllipsis");var u="mstrmojo-ObjectItem-text";mstrmojo.ObjectItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasEllipsis],{scriptClass:"mstrmojo.ObjectItem",markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode"><span title=" {@en@title}" class="'+u+' {@cssClass}"></span><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])"/></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" mstrAttach:keyup,keydown/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},editButtonNode:function(){return this.domNode.firstChild.childNodes[1];},delButonNode:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},markupMethods:{oncssClassChange:function(){this.textNode.className=u+" "+this.cssClass;},onstateChange:function(){var AJ=this.state,AI=mstrmojo.Enum_OIB_States_CSS[AJ],AH=this.domNode;if(AJ===b.EMPTY){AH.innerHTML=this.enabled?'<div class="mstrmojo-ObjectItem-emptyText">'+this.text+"</div>":"";}else{if(AJ===b.EDITING){this.reduceWidth();}}AH.className="mstrmojo-ObjectItem "+AI;this.updateButtonsVisibility(this.data);},ontextChange:function(){this.inputNode.value=this.text;this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);}},reduceWidth:function(){var AH=Math.round(this.displayNode.clientWidth);this.editNode.style.width=AH-4+"px";this.inputNode.style.width=AH-9+"px";},updateButtonsVisibility:function AG(){if(this.parent.hideEditButton(this.data)){this.editButtonNode.style.display="none";}},state:b.VALID,onstateChange:function g(AH){this.data.state=this.state;},ontextChange:function H(AH){this.data[this.itemField]=this.text;},onfocus:function AB(){N.call(this.parent);},updateData:function F(AH){S.copy(AH,this.data);this.set("state",b.VALID);this.set("text",this.data[this.itemField]);this.set("cssClass",this.parent.item2textCss(this.data));},init:function AC(AI){this._super(AI);var AK=this.data,AH=AK.state,AJ=this.parent;AH=this.initState();this.cssClass=AJ.item2textCss(AK);this.text=AK[this.itemField];this.state=AH;this.isAdding=j(AK);this.useRichTooltip=true;this.title=this.text;},initState:function K(){var AI=this.parent,AJ=this.data,AH=AJ.state;if(AJ&&AJ.did){AJ.state=b.VALID;return AJ.state;}if(typeof AH==="undefined"){AH=AI.dynamicVerify?AI.verifyObject(AJ[this.itemField],this):b.UNDETERMINED;AJ.state=AH;}return AH;},isValid:function C(){var AH=parseInt(this.state,10);return(AH!==b.INVALID&&AH!==b.UNDETERMINED);},adjustInputWidth:function A(){if(this.isAdding){var AK=this.inputNode.style;AK.width=AF+"px";var AJ=this.domNode.parentNode,AH=AJ.parentNode.offsetWidth,AI=Math.max(AH-AJ.offsetLeft-20,AF);if(!isNaN(AI)){AK.width=AI+"px";}}},blur:function U(){this.hideSuggestion();if(!this.isActive){return ;}this.isActive=false;var AJ=this.inputNode,AH=AJ.value,AI=this.parent;window.setTimeout(function(){try{AJ.blur();}catch(AK){}},0);if(!AH){return ;}if(AI.acptSugItemOnly&&this._tWas_){this.set("text",AH);this.set("text","");this._tWas_=null;return ;}this.setItem(AH,null,true);},focus:function w(){var AI=this.inputNode,AH=this.isActive;window.setTimeout(function(){try{AI.focus();if(AI.createTextRange&&!AH){var AK=AI.createTextRange(),AJ=AI.value.length;AK.move("character",AJ);AK.select();}else{if(AI.setSelectionRange&&!AH){var AJ=AI.value.length;AI.setSelectionRange(AJ,AJ);}}}catch(AL){}},0);this.isActive=true;},prekeydown:function J(AH){var AJ=this.inputNode.value,AI=parseInt(AH.e.keyCode||AH.e.charCode,10),AL=this.parent;if(!AJ){return ;}if(AI===AD.TAB||AI===AD.ENTER){if(AI===AD.ENTER){Q.preventDefault(AH.hWin,AH.e);}var AK=AL.getSelected();if(AK&&AK.did){AL.handleSuggestionItemSelect(AK);}else{this.hideSuggestion();if(!AL.acptSugItemOnly){this.setItem(AJ,null,false);}else{this.set("text",AJ);this.set("text","");}}}else{if(AI===AD.DOWN_ARROW){if(!AL.noCache&&!AL.suggestionShown){this.showSuggestion(AJ);AL.preHighlight();}AL.nextHighlight();}else{if(AI===AD.UP_ARROW){AL.preHighlight();}}}},prekeyup:function AE(AH){var AJ=this.inputNode.value,AI=parseInt(AH.e.keyCode||AH.e.charCode,10),AM=this.isAdding,AL=this.parent;if(!AJ){if(AM){if(AI===AD.BACKSPACE&&!this._tWas_){this.raiseEvent({name:"ItemDeletePrev"});Q.preventDefault(AH.hWin,AH.e);}this._tWas_=null;}else{this.raiseEvent({name:"ItemDelete",d:this.data});}this.hideSuggestion();return ;}if(AI===AD.ESCAPE||AI===AD.TAB){this.hideSuggestion();if(AL.acptSugItemOnly){this.set("text",AJ);this.set("text","");this._tWas_=null;return ;}}else{if(this._tWas_!==AJ){this.textChanged=true;this.raiseEvent({name:"ItemEditing",d:this.data});if(AL.useKeyDelay){window.clearTimeout(this._timerID);var AK=this;this._timerID=window.setTimeout(function(){var AN=AK.inputNode.value;if(AN){AK.showSuggestion(AN);}AK._timerID=null;},Y());}else{this.showSuggestion(AJ);}}}this._tWas_=AJ;},setItem:function(AH,AJ,AI){var AK=this.isAdding;AI=AI||false;this.set("text",AH);if(AK){this.setItem_Adding(AH,AJ,AI);}else{this.setItem_Editing(AH,AJ,AI);}this._tWas_=null;},setItem_Adding:function(AH,AJ,AI){this.set("text","");if(!AJ){AJ={};AJ[this.itemField]=AH;}else{AJ.state=b.VALID;}this.raiseEvent({name:"ItemAdd",d:AJ,deactivate:AI});},setItem_Editing:function(AH,AJ,AI){var AK=this.parent;this.set("text",AH);if(AJ){this.updateData(AJ);}else{if(this.textChanged){var AL={};AL[d]=this.data[d];delete this.data.did;this.data=AL;this.textChanged=false;}this.set("state",AK.verifyObject(AH,this));this.set("cssClass",AK.item2textCss(this.data));}this.isActive=false;this.raiseEvent({name:"ItemEditEnd",d:AJ,deactivate:AI});},getSearchPattern:function X(){return(this.inputNode?this.inputNode.value:"");},showSuggestion:function p(AH){var AI=mstrmojo.dom.position(this.domNode,true);this.raiseEvent({name:"SuggestionOn",l:Math.round(AI.x)+"px",t:Math.round(AI.y+AI.h)+"px",pattern:AH,target:this});},hideSuggestion:function h(){this.raiseEvent({name:"SuggestionOff"});},del:function R(AH){AH=AH||self.event;Q.stopPropogation(self,AH);this.raiseEvent({name:"ItemDelete",d:this.data,deactivate:true});if(this.useRichTooltip&&this.hideTooltip){this.hideTooltip();}},edit:function Z(){this.set("state",b.EDITING);this.raiseEvent({name:"ItemEditBegin",d:this.data});if(this.showSuggestionOnEdit){this.showSuggestion(this.text);}},doEllipsize:function f(){if(!this.shouldEllipsize){return ;}var AI=this.maxItemWidth,AH;if(AI){this.domNode.style.maxWidth=AI;switch(parseInt(this.state,10)){case b.VALID:case b.UNDETERMINED:case b.INVALID:AH=this.textNode;break;case b.EMPTY:AH=this.domNode.firstChild;break;}if(AH){this.set("richTooltip",{content:this.text,contentNodeCssClass:"sp-tooltip",posType:mstrmojo.tooltip.POS_TOPLEFT,left:0,top:30,refNode:this.domNode});mstrmojo.css.addClass(AH,"truncated");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.hash","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.Table","mstrmojo.DI.DIDatabaseImportOption","mstrmojo.DI.DISourceItem","mstrmojo.ui.CheckList","mstrmojo.array","mstrmojo.ui.SearchBox","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DISourceItemBox","mstrmojo.vi.enums.EnumDSSAccessRightFlags","mstrmojo.DI.ui.ScrollableBox");mstrmojo.requiresDescs(10,489,1563,2461,4700,9095,9096,9097,9098,9100,9213,9214,10213,12459,12666,12726,12727,12758,12889,12890,13027,13416,13961,14101,14102,14103,14104,14208,14210,14211,14212,14213,12491,12499,15169,15170,15171,14461,16144,15542,15626,15807,15808);var P=mstrmojo.dom,d=mstrmojo.hash,h=mstrmojo.array,R=mstrmojo.hash,O=mstrmojo.Widget,k=mstrmojo.vi.enums.EnumDSSAccessRightFlags,o=mstrmojo.DI.DIConstants,u=mstrmojo.DI.DIDatabaseHelper,V=o.pageType,e="mstrmojo.DI.DISourceItem",b=o.mainPage.GRID_MODE,G=o.mainPage.LIST_MODE,D=mstrmojo.desc(12666,"Search..."),J=24,c=4,N=17,I,Q,E=o.sdkUrl.MARKPLACE_URL,l=mstrmojo.DI.DIHelpers,m="diMainPageWaitBox"+Date.now(),F="Community Connectors config ready";function U(z,AA){var AC=Math.floor(AA/160),AB,x=this[z]&&this[z].children;if(AC>0){AB=Math.floor((AA-AC*160)/2);}if(AB>0){h.forEach(x,function(AD){if(AD.hasRendered){AD.domNode.style.left=AB+"px";}});}}var f={scriptClass:e,icon:"ds_suggest",n:mstrmojo.desc(12890,"Suggest a Data Source"),desc:mstrmojo.desc(12459,"Is your data source not available? Tell us which source it is and why it is important to you."),pageType:V.suggestNewSource,alias:"suggest",tags:["Customized"],sourceInfo:0};function p(){var x=[];if(mstrApp.diParams.AccessDataFromFiles===1){x.push({n:mstrmojo.desc(489,"File"),did:o.Enum_SourceCategoryType.File,v:"File"});}if(mstrApp.diParams.ImportDatabase===1){x.push({n:mstrmojo.desc(15626,"Big Data"),did:o.Enum_SourceCategoryType.BigData,v:"BigData"});x.push({n:mstrmojo.desc(14461,"Databases"),did:o.Enum_SourceCategoryType.Database,v:"Database"});}if(mstrApp.diParams.ImportDatabase===1&&!window.mstrAppSchema){if(!mstrApp.isSingleTier){x.push({n:mstrmojo.desc(15542,"OLAP (MDX)"),did:o.Enum_SourceCategoryType.OLAP,v:"OLAP"});}x.push({n:mstrmojo.desc(15171,"Community Extension"),did:o.Enum_SourceCategoryType.Customized,v:"Customized"});}x.push({n:mstrmojo.desc(16145,"Applications"),did:o.Enum_SourceCategoryType.Apps,v:"Apps"});return x;}function S(){var z=mstrApp.getRootController().model;if(mstrApp.isWorkstation){return false;}if(mstrApp.showDDAOptions===false){return false;}if(mstrApp.diParams.ImportDatabase===0){return false;}if(z.currentDataset){return false;}var AA=0,AB,x=z.importSources;for(AB in x){if(x.hasOwnProperty(AB)){AA++;}}return AA<1;}function Y(){var x="";if(!mstrApp.diParams.EnableURLImport){x=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){x=mstrmojo.desc(12499,'Disabled as the user does not have any "Web Import Database" privileges');}}return x;}var Z={scriptClass:"mstrmojo.Container",markupString:"<div class='mstrmojo-di-search-tag' mstrAttach:click ><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},contentNode:function(){return this.domNode.children[0];},deleteNode:function(){return this.domNode.children[1];}},tag:"",children:[{scriptClass:"mstrmojo.Label",alias:"tagName",slot:"contentNode",cssClass:"mstrmojo-di-search-tag-name",visible:false},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-di-tag-delete-button",innerIconClass:"close-button"}],preBuildRendering:function(){if(this._super){this._super();}this.tagName.text=this.tag;},onclick:function(){var AA=this.parent;AA.removeChildren();var z=AA.parent.filterTags;var x=h.find(z,"n",this.tag);if(x>-1){h.removeIndices(z,x,1);}AA.parent.raiseEvent({name:"filterTagsChange"});}};function X(AL,x,z){var AE=0,AC=0,AO=4000;var AI={},AB=[],AK;var AG=0;var AF=this;var AQ=AF.isFilterDDA;var AS=[];var AP=[];var AM=mstrApp.getRootController();var AA=AM.getModel();var AJ=function AJ(AT){var AW=mstrmojo.dom.findWidget(AT.getTarget());if(AW===this.dbList){mstrmojo.css.addClass(this.domNode,"selected");}else{if(AW.alias==="closeList"){mstrmojo.css.removeClass(this.domNode,"selected");}else{if(this.parent.parent.mode===G){if(AW.sourceInfo.type===o.sourceType.googleBigQuery){AM.showDialog(o.dialogType.qbImportOptionDialog,{isODBC:true,srcInfo:AW.sourceInfo});}else{if(AW.dbTypes){AP=u.getUniqueDBTypes(AW.dbTypes);h.forEach(AP,function(AY){if(!AQ||AA.canAddToDDACube(AW.sourceInfo.subtype,AY)){AS.push(AY);}});mstrApp.dbTypes=AS;}else{if(AW.dbTypes!==undefined){mstrApp.dbTypes=[AW.dbType];}}mstrApp.supportDBObjects=AM.model.supportDBObjects;mstrApp.dbObjectsDisplayOptions=AW.dbObjectsDisplayOptions;if(AW.dbObjectsDisplayOptions===16){mstrApp.dbRolesVersionExcludeFilter=[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232];}if(AW.dbIds){mstrApp.dbIds=AW.dbIds;}else{mstrApp.dbIds=AW.dbId?[].concat(AW.dbId):undefined;}if(AW.showImportOption){AM.showDialog(o.dialogType.qbImportOptionDialog,(AW.dbType===AO)?{isSAPHana:true}:{isODBC:true});}else{if(AW.pageType===o.pageType.newConnector){mstrApp.dbmsID=AW.oid;mstrApp.conUrl=AW.url;mstrApp.clientId=AW.user;mstrApp.newConDbroleId=AW.oid;if(AW.enabled){var AX;if(mstrApp.isSingleTier&&AW.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var AU=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),AV='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";AU=AU.replace("#",AV)+".";AM.displayError(AU,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}AX=AM.navigationController.getPageSlot();AX.setConfig({properties:{operationMode:o.operationMode.create}});AM.showPage(AW.pageType,AW.sourceInfo,AX);}}else{AF.selectedSource=this;AF.onNextButtonClick(AT);}}}}}}};var AN=x?c:c+1;var AH=0;var AR=N;if(x&&I<940){AN-=1;}Q=AN;h.forEach(AL,function(AT){if(!AI[AT.initial]){AH++;AI[AT.initial]=true;}});AI={};var AD=AH+AL.length;if(AD>AN*N){AR=AD/AN+1;}J=AR;h.forEach(AL,function(AT){if(!AI[AT.initial]){AB.push({scriptClass:"mstrmojo.Label",text:AT.initial,cssClass:"initial",slot:AE+","+AC});AE++;AI[AT.initial]=true;if(AE>=AR){AE=0;AC++;}}if(z){AG=AT.n.toLowerCase().indexOf(z.toLowerCase());if(AG!==-1){AK=AT.n.substring(0,AG)+'<span style="font-weight: bold;">'+AT.n.substring(AG,AG+z.length)+"</span>"+AT.n.substr(AG+z.length);}}AT.slot=AE+","+AC;if(AT.isEnabled){AT.enabled=AT.isEnabled();}if(typeof AT.title==="function"){AT.title=AT.title();}AB.push(mstrmojo.hash.copy(AT,{scriptClass:"mstrmojo.Label",allowHTML:true,text:AK||AT.n,onclick:AJ,tooltipOpenDelay:0,useRichTooltip:true,cssText:"overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",updateTooltipConfig:function(){var AU=P.position(this.domNode);if(this.title!==undefined){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",top:Math.max(AU.y,0),left:Math.max(AU.x+4,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.title});}}}));AE++;if(AE>=AR){AE=0;AC++;}});return AB;}function t(AC,AB,x){var AA=[],z;if(!x){h.forEach(AB,function(AD){if(AD.sourceInfo&&AD.sourceInfo.subtype){z=AD.sourceInfo.subtype;}else{z=AD.subtype;}if(!AC.isDDAOnlySource(z)){AA.push(AD);}});}else{AA=AB;}return AA;}function C(AA,z){var x=[],AD=0,AB=0,AC;d.forEach(z,function(AF){AC=null;var AE,AG;if(AF.sourceInfo&&AF.sourceInfo.subtype){AE=AF.sourceInfo.subtype;}else{AE=AF.subtype;}if(AF.sourceInfo&&AF.sourceInfo.dbType){AG=AF.sourceInfo.dbType;}else{AG=AF.dbType;}if(AA.canAddToDDACube(AE,AG)){AC=mstrmojo.hash.copy(AF,AC);if(AB>3){AD++;AB=0;}AB++;x.push(AC);}});return x;}function H(z){var x=[];d.forEach(z,function(AA){if(AA.privilege===o.privilegeType.accessCloud&&mstrApp.diParams.AccessDataFromCloudApp){x.push(AA);}if(AA.privilege===o.privilegeType.accessDatabase&&mstrApp.diParams.ImportDatabase){x.push(AA);}if(AA.privilege===o.privilegeType.accessFile&&mstrApp.diParams.AccessDataFromFiles){x.push(AA);}});return x;}function W(x){var z=[],AC=0,AA=0,AB;d.forEach(x,function(AD){AB=null;if(AD.oneTier){AB=mstrmojo.hash.copy(AD,AB);if(AA>3){AC++;AA=0;}AA++;z.push(AB);}});return z;}function q(AB,AA,AE){var z,AD,x=[],AF=0,AC=0;for(z=0;z<AB.length;z++){AD=AB[z].n.toLowerCase().indexOf(AA.toLowerCase());if(AD>-1){x.push(AB[z]);AC++;if(AC===AE){AC=0;AF=AF+1;}}}return x;}function g(AB,AF,AC){var AA,z,AG=[],AE=0,x=0,AD;for(z=0;z<AB.length;z++){if(AB[z].tags){for(AA=0;AA<AB[z].tags.length;AA++){AD=AB[z].tags[AA];if(AF[AD]){AG.push(AB[z]);x++;if(x===AC){x=0;AE=AE+1;}break;}}}}return AG;}function a(){var x=h.filter(mstrApp.getRootController().model.datasets||[],function(z){return !z.hcs;});return x&&x.length>1&&!mstrApp.diParams.isEdit&&!mstrApp.getRootController().model.hasEMMAReportInstance();}function M(AB,z,x,AA){AB.keywordLeft=z.substring(0,x);AB.keyword=z.substring(x,x+AA);AB.keywordRight=z.substr(x+AA);}mstrmojo.DI.DISourceList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DISourceList",selectedSource:null,filterTags:[],filterTagsInGridView:[],mode:b,keyword:"",hasDDAOnlySource:true,isFilterDDA:true,isSAPHana:false,markupString:'<div id="{@id}" class="mstrmojo-di-sources {@cssClass}" mstrAttach:mousedown style="height: 100%"><div class="mstrmojo-di-source-datasets"></div><div class = "mstrmojo-di-source-content"></div><div class = "mstrmojo-di-search-tags"></div></div>',markupSlots:{datasetsNode:function(){return this.domNode.children[0];},allSourceNode:function(){return this.domNode.children[1];},searchTagsNode:function(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onheightChange:O.heightMarkupMethod,onwidthChange:O.widthMarkupMethod},onmodeChange:function(){var x=this.model;if(this.mode===G){this.sourceList.removeChildren();this.populateSources(o.populateType.ALL_SOURCES);if(x.isDirectDataAccess!==this.sourceList.ddaList){this.update();}}else{if(!this.allSources.sourceTable.children){this.populateSources(o.populateType.ALL_SOURCES);}this.updateViewByMode();if(x.isDirectDataAccess!==this.allSources.sourceTable.ddaList){this.update({type:o.populateType.ALL_SOURCES});}}this.persistViewMode();this.clearSearchBox();x.raiseEvent({name:"sourceListModeChange",mode:this.mode});},onhasDDAOnlySourceChange:function(){if(this.hasRendered){this.update({name:o.srcItemTypes.ALL_SOURCES});}},updateViewByMode:function K(){var z=this.model;var x;if(this.mode===G){this.sourceList.set("visible",true);this.allSources.set("visible",false);this.searchTagsNode.style.display="block";this.sourceView.set("selectedIndex",1);if(!mstrApp.isPopup&&this.height){x=parseInt(this.height,10)-30+"px";this.sourceList.domNode.style.height=x;}}else{this.sourceList.set("visible",false);this.allSources.set("visible",true);this.searchTagsNode.style.display="none";this.sourceView.set("selectedIndex",0);}if(z.isDirectDataAccess){this.allddatabs.children[0].set("selectedIndex",1);}else{this.allddatabs.children[0].set("selectedIndex",0);}},onfilterTagsInGridViewChange:function(){this.update({name:o.srcItemTypes.ALL_SOURCES});},onfilterTagsChange:function(){var AA=this,z,x;z=this._onfilterTags(1);x=X.call(AA,z,this.filterTags.length!==0);mstrmojo.css.toggleClass(this.sourceList.domNode,"narrow",this.filterTags.length>0);this.sourceList._set_children("children",x);},_onfilterTags:function(AD){var AC=this,z={},AB=AD?this.filterTags:this.filterTagsInGridView;var x=this.model;var AA=x.sourceList;this.searchTagList.removeChildren();if(AB.length!==0){AA=g(x.sourceList,z,c);}if(x.isDirectDataAccess){AA=C(x,AA);}if(!mstrApp.isSingleTier){AA=H(AA);}else{AA=W(AA);}if(this.searchBox.inputNode.value!==""&&this.searchBox.inputNode.value!==D){AA=q(AA,this.searchBox.inputNode.value,c);}return AA;},persistViewMode:function w(){mstrApp.getRootController().rootView.setHomepageViewMode(this.mode);},children:[{scriptClass:"mstrmojo.Box",slot:"datasetsNode",cssClass:"mstrmojo-di-source-datasets-box cf",bindings:{visible:a},preBuildRendering:function A(){if(this.visible){mstrmojo.css.addClass(this.parent.domNode,"with-mstrmojo-di-source-datasets-box");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"dataset-box-label",text:mstrmojo.desc(13027,"Add to:")},{scriptClass:"mstrmojo.ui.Pulldown",bindings:{items:function(){var x=[];h.forEach(mstrApp.getRootController().model.datasets||[],function(AC){var z=AC.tables&&AC.tables.length>0&&AC.tables[0].xdaType===o.xdaType.sparkDataset;var AB=AC.acg?AC.acg&k.DssAccessRightWriteFlag:true,AA=AC.copyable!=="false";if(!AC.hcs&&!z&&AB&&AA){x.push({id:AC.did,n:AC.name});}});return x;}},allowHTML:false,onitemSelected:function n(AB){if(this.parent.parent){this.parent.parent.filterTagsInGridView=[];}var AA=mstrApp.getRootController().getModel(),x=h.find(AA.datasets,"did",AB.id),z=mstrApp.getRootController(),AC=z.rootView;if(x>-1){AA.selectDataset(AA.datasets[x]);AC._DISourceListPulldownSelectedIndex=x;this.selectedIndex=x;this.parent.parent.set("hasDDAOnlySource",AA.datasets[x].did===-1);this.parent.parent.allddatabs.set("visible",false&&S());}},preBuildRendering:function A(){var x=mstrApp.getRootController(),z=x.rootView;if(this._super){this._super();}if(this.items.length>0){this.selectedIndex=z._DISourceListPulldownSelectedIndex!==undefined?z._DISourceListPulldownSelectedIndex:0;}}}]},{alias:"sourceView",slot:"allSourceNode",scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-di-source-view",renderOnScroll:false,selectedIndex:0,bindings:{visible:function(){return false&&!mstrApp.isWorkstation;}},postselectionChange:function(x){var z=x.added&&this.items[x.added[0]].v;this.parent.set("mode",z);},items:[{v:b,css:"grid"},{v:G,css:"list"}]},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-source-direct-access-container",slot:"allSourceNode",alias:"allddatabs",bindings:{visible:function(){return false&&S();}},children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,selectedIndex:0,postselectionChange:function(z){var x=mstrApp.getRootController(),AA=x.model,AC=z.added&&this.items[z.added[0]].v,AB=!!AC;if(AA.isDirectDataAccess!==AB){x.getDDAController().setDirectDataAccess(AB);AA.origIsDirectDataAccess=AB;this.parent.parent.update();}},items:[{n:mstrmojo.desc(2461,"All"),v:0},{n:mstrmojo.desc(12726,"Connect Live"),v:1}]}]},{scriptClass:"mstrmojo.Button",slot:"allSourceNode",alias:"dropDownBtn",cssClass:"mstrmojo-di-source-search-button",onclick:function(){this.parent.showEditorConfig();},bindings:{visible:function(){return this.parent.mode===G&&!mstrApp.isWorkstation&&false;}}},{scriptClass:"mstrmojo.Label",slot:"allSourceNode",text:mstrmojo.desc(12727,"Advanced Search"),cssClass:"mstrmojo-di-source-search-label",bindings:{visible:function(){return this.parent.mode===G&&!mstrApp.isWorkstation&&false;}},onclick:function(){this.parent.showEditorConfig();}},{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" placeholder="{@emptyText}" mstrAttach:keyup,blur/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',searchDelay:0,cssClass:"mstrmojo-di-source-search",slot:"allSourceNode",alias:"searchBox",emptyText:D,bindings:{visible:function(){return this.parent.mode===G&&!mstrApp.isWorkstation&&false;}},searchTriggered:function(x){this.parent.onSearch(x);}},{scriptClass:"mstrmojo.DI.ui.ScrollableBox",alias:"allSources",cssClass:"mstrmojo-di-sourceGrid",slot:"allSourceNode",ddaList:false,padding:5,getHeight:function(){var x=R.walk("parent.domNode.clientHeight",this)||0,z=R.walk("parent.datasetsNode.clientHeight",this)||0;return x-z;},children:[{scriptClass:"mstrmojo.DI.DISourceItemBox",alias:"sourceTable",setSrcLsrs:function(){var z=!mstrApp.diParams.disableCESource?o.srcItemTypes.CLOUDELEMENT_CONNECTOR:undefined,x=mstrApp.diParams.ImportDatabase?o.srcItemTypes.DBTYPE_SOURCE:undefined;return[z,x];}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-communitybox",alias:"community",bindings:{visible:function(){return l.isWS()||!l.isOnetier();}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community title",text:mstrmojo.desc(15171,"Community Extension"),},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-addconnector",alias:"addConnector",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon addconnector",bindings:{enabled:function(){return l.isLocalWS()?true:mstrApp.diParams.AccessDataFromFiles&&mstrApp.diParams.Admin&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;},title:function(){return Y();}},onclick:function(){if(this.enabled){mstrApp.getRootController().showDialog(o.dialogType.addConnectorDialog);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15170,"Add Connector"),bindings:{enabled:function(){return l.isLocalWS()?true:mstrApp.diParams.AccessDataFromFiles&&mstrApp.diParams.Admin&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;},title:function(){return Y();}},onclick:function(){if(this.enabled){mstrApp.getRootController().showDialog(o.dialogType.addConnectorDialog);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-community-addconnector-symbol",text:"|"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-extension",alias:"extension",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon extension",onclick:function(){window.open(E);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15169,"Browse Extensions"),onclick:function(){if(l.isWS()){window.FormWrapper.openPage(E);}else{window.open(E);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-community-addconnector-symbol",text:"|"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-addconnector",alias:"deployConnector",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon addconnector",bindings:{enabled:function(){return l.isLocalWS()?false:mstrConfig.connectorWebBaseURL&&mstrApp.diParams.Admin;},title:function(){return mstrConfig.connectorWebBaseURL?"":mstrmojo.desc(15808,"Community Connectors Application URL is not set.");}},onclick:function(){if(this.enabled){window.open(mstrConfig.connectorWebBaseURL+"?webUrl="+window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+mstrConfig.taskURL+"&sessionState="+mstrApp.sessionState);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15807,"Deploy Community Connectors"),bindings:{enabled:function(){return l.isLocalWS()?false:mstrConfig.connectorWebBaseURL&&mstrApp.diParams.Admin;},title:function(){return mstrConfig.connectorWebBaseURL?"":mstrmojo.desc(15808,"Community Connectors Application URL is not set.");}},onclick:function(){if(this.enabled){var z=this;var x=function(AB){if(AB.data===F){P.detachEvent(window,"message",z.handleDeployCommunityConnectors);var AA={webUrl:window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+mstrConfig.taskURL,sessionState:mstrApp.sessionState,baseURL:mstrConfig.connectorWebBaseURL};l.sendResponse2Window(AA,window.location.origin,z.popupWnd);}};if(z.handleDeployCommunityConnectors){P.detachEvent(window,"message",z.handleDeployCommunityConnectors);}P.attachEvent(window,"message",x);z.handleDeployCommunityConnectors=x;z.popupWnd=window.open("../html/CommunityConnectorsWaiting.html");}}}]}]},{scriptClass:"mstrmojo.VBox",cssText:"position: relative",alias:"sourceTableConnector",bindings:{visible:function(){return l.isWS()||!l.isOnetier();}}}]},{scriptClass:"mstrmojo.Table",alias:"sourceList",cssClass:"mstrmojo-di-sourceList",slot:"allSourceNode",visible:false,rows:J,cols:5,ddaList:false},{scriptClass:"mstrmojo.Label",slot:"searchTagsNode",text:mstrmojo.desc(12889,"Returned results are related to:"),bindings:{visible:function(){return this.parent.filterTags.length>0;}}},{scriptClass:"mstrmojo.VBox",slot:"searchTagsNode",alias:"searchTagList"}],showEditorConfig:function(z){var AA=this;var x=new mstrmojo.ui.menus.EditorConfig(R.copy(z,{hostId:this.id,hostElement:this.dropDownBtn.domNode,isHostedWithin:false,hostProxyCssClass:"item-mn-proxy",contents:new mstrmojo.ui.CheckList({multiSelect:true,orientation:"v",itemIdField:"did",alias:"list",items:p.call(AA)}),data:{}}));x.fnOk=function(){var AC;AC=x.contents.getSelectedItems();if(AA.mode===0){AA.set("filterTagsInGridView",AC);}else{AA.set("filterTags",AC);}};var AB=x.newInstance();if(this.mode===0){if(this.filterTagsInGridView&&this.filterTagsInGridView.length>0){AB.list.selectItems(this.filterTagsInGridView);}}else{if(this.filterTags&&this.filterTags.length>0){AB.list.selectItems(this.filterTags);}}this.openPopup(AB);},preBuildRendering:function(){if(this._super){this._super();}var z=mstrApp.getRootController().getModel(),x=[o.srcItemTypes.STATIC_SOURCE];if(z.hasCloudElementFetched()){x.push(o.srcItemTypes.CLOUDELEMENT_CONNECTOR);}if(z.hasCustomConnenctFetched()){x.push(o.srcItemTypes.CUSTOM_CONNECTOR);}if(z.hasDBMSTypeFetched()){x.push(o.srcItemTypes.DBTYPE_SOURCE);}this.populateSources.apply(this,x);z.attachEventListener("isDirectDataAccessChange",this.id,this.update);z.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function(AA){var AB=Math.floor(parseInt(AA.size.w,10)),x=Math.floor(parseInt(AA.size.h,10)),AC=AA.target;if(!l.acceptEventFromAncestor.call(this,AC)){return ;}if(isNaN(AB)||AB<0||!this.domNode){return ;}U.call(this,"allSources",AB);var z=Math.max(5,Math.floor((AB-40)/195));if(!mstrApp.isPopup&&this.sourceList){c=z-1;J=Math.floor((parseInt(AA.size.h,10)-20)/25);this.sourceList.cols=z;if(this.sourceList.domNode){this.sourceList.refresh();x=parseInt(AA.size.h,10)-30+"px";this.sourceList.domNode.style.height=x;}}if(this.sourceList&&this.sourceList.domNode){this.sourceList.domNode.children[0].style.width=(AB-28)+"px";if(AB-630<200&&mstrApp.isPopup){this.dropDownBtn.domNode.style.marginRight=(AB-630)+"px";}if(this.filterTags.length>0){if(AB<940&&Q!==3){this.onfilterTagsChange();}else{if(AB>=940&&Q===3){this.onfilterTagsChange();}}}}I=AB;},onheightChange:function(){var x=parseInt(this.height,10);if(!mstrApp.isPopup){if(this.sourceList){this.sourceList.set("height",(x-20)+"px");}}},postBuildRendering:function(){var x=mstrApp.getRootController().model;if(this._super){this._super();}x.raiseEvent({name:"sourceListModeChange",mode:this.mode});x.attachEventListener(o.srcItemTypes.DBTYPE_SOURCE,this.id,"update");x.attachEventListener(o.srcItemTypes.CLOUDELEMENT_CONNECTOR,this.id,"update");x.attachEventListener(o.srcItemTypes.CUSTOM_CONNECTOR,this.id,"update");},postCreate:function(){var x=mstrApp.getRootController().getModel();x.attachEventListener("sourceItemsChange",this.id,this.onsourceItemsChange);},displayCustomConnectors:function(AA){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return ;}var x=mstrApp.getRootController().getModel();var z=!x.isDirectDataAccess&&!mstrApp.diParams.disableDDA;this.allSources.community.set("visible",z&&!(AA&&AA.length===0)&&!mstrApp.diParams.disableCustomerConnector);this.allSources.sourceTableConnector.set("visible",z);this.allSources.sourceTableConnector.set("children",AA);this.allSources.updateScrollbars();this.allSources.disableScroll(true,false);},displayMainPageSourceItems:function(z,x){if(mstrApp.isSingleTier){z=W(z);}else{z=H(z);}this.allSources.sourceTable.addItems(z,x);this.allSources.updateScrollbars();this.allSources.disableScroll(true,false);},populateSources:function L(AN){var z=this.model,AK,AF=this.hasNonSAPHana,AD,AB=this,x=Array.prototype.slice.call(arguments,0);AD=h.filter(z.sourceItems,function(AQ){return AQ.selected!==false;});if(this.parent.parent&&this.parent.parent.items){AK=this.parent.parent.items;}else{if(this.isSAPHana){AK=[z.sourceItems[2]];AK[0].isSAPHanaDDA=true;}else{AK=(this.isFilterDDA||z.isDirectDataAccess)?C(z,AD):AD;h.forEach(AK,function(AQ){AQ.hasNonSAPHana=AF;AQ.isSAPHanaDDA=false;});}}var AP=window.mstrAppSchema?false:this.hasDDAOnlySource;AK=t(z,AK,AP);var AA=[],AM=[];var AL=[],AH=[],AO,AJ=[],AG=[],AI=[f];h.forEach(AK,function(AQ){if(AQ.bindings.enabled()){AA.push(AQ);}else{AM.push(AQ);}if(AQ.sid===o.sourceItemType.database&&z.hasDBMSTypeFetched()){AJ=AJ.concat(z.getFlattenedDBTypeSourceItems(AQ,AB.isFilterDDA));AL.push(AQ);}else{if(AQ.sid===o.sourceItemType.hadoop&&z.hasDBMSTypeFetched()){AG=AG.concat(z.getFlattenedDBTypeSourceItems(AQ,AB.isFilterDDA));AL.push(AQ);}else{if(AQ.sid===o.sourceItemType.newConnector){AI.push(AQ);}else{if(AQ.sid===o.sourceItemType.cloudElement){AH.push(AQ);}else{AL.push(AQ);}}}}});AK=AA.concat(AM);AO=AJ.concat(AG);if(this.isFilterDDA&&z.isDirectDataAccess){var AC=h.find(AO,"dbType",o.dbType.XQUERY);if(AC>-1){AO.splice(AC,1);}}if(h.filter(AO,function(AQ){return AQ.dbType===o.dbType.GENERIC;}).length>1){AO.splice(h.find(AO,"dbType",o.dbType.GENERIC),1);}AL=this.filterByTag(AL);AO=this.filterByTag(AO);AH=this.filterByTag(AH);AI=this.filterByTag(AI);if(AB.keyword!==""){AL=this.filterByKeyword(AL);AO=this.filterByKeyword(AO);AI=this.filterByKeyword(AI);AH=this.filterByKeyword(AH);}if(x.indexOf(o.srcItemTypes.STATIC_SOURCE)>=0){this.displayMainPageSourceItems(AL);this.displayCustomConnectors(AI);}if(x.indexOf(o.srcItemTypes.DBTYPE_SOURCE)>=0){this.displayMainPageSourceItems(AO,true);}if(x.indexOf(o.srcItemTypes.CLOUDELEMENT_CONNECTOR)>=0){if(!z.isDirectDataAccess){this.displayMainPageSourceItems(AH,true);}}if(x.indexOf(o.srcItemTypes.CUSTOM_CONNECTOR)>=0){this.displayCustomConnectors(AI);}if(x.indexOf(o.srcItemTypes.ALL_SOURCES)>=0){var AE=[].concat(AL).concat(AO).concat(AH);this.displayMainPageSourceItems(AE);this.displayCustomConnectors(AI);}},filterByTag:function(x){var z=this;return z.filterTagsInGridView.length?h.filter(x,function(AA){return AA.tags?h.filter(z.filterTagsInGridView,function(AC){var AB;if(o.combination[AC.v]){h.forEach(o.combination[AC.v],function(AD){AB=AA.tags.indexOf(AD)>-1;return !AB;});return AB;}else{return AA.tags.indexOf(AC.v)>-1;}}).length:false;}):x;},filterByKeyword:function(z){var x=this.keyword;var AA=h.filter(z,function(AB){return AB.n.toLowerCase().indexOf(x.toLowerCase())>-1;});AA=h.map(AA,function(AD){var AB=AD.n.toLowerCase().indexOf(x.toLowerCase()),AC=d.copy(AD);if(AB!==-1){M(AC,AD.n,AB,x.length);}return AC;});return AA;},update:function j(z){var x=this.model;this.allSources.sourceTable.ddaList=x.isDirectDataAccess;this.allSources.sourceTableConnector.ddaList=x.isDirectDataAccess;if(z&&z.name==="isDirectDataAccessChange"){this.populateSources(o.srcItemTypes.ALL_SOURCES);}else{if(z&&z.name){this.populateSources(z.name);}}},onSearch:function(AC){var x=this.model;var AB=q(x.sourceList,AC,c);if(this.filterTags.length!==0){var AA={};h.forEach(this.filterTags,function(AD){AA[AD.v]=true;});AB=g(AB,AA,c);}if(x.isDirectDataAccess){AB=C(x,AB);}if(!mstrApp.isSingleTier){AB=H(AB);}else{AB=W(AB);}var z=X.call(this,AB,this.filterTags.length!==0,AC);this.sourceList._set_children("children",z);},onSearchGridView:function(z){var x=this._onfilterTags(0);this.set("keyword",z);this.update({name:o.srcItemTypes.ALL_SOURCES});},onmousedown:function(x){if(x&&x.e&&x.e.button===1){x.preventDefault();x.cancel();}},onNextButtonClick:function(z){var x=mstrApp.getRootController(),AD=this.selectedSource,AE;if(AD.enabled){if(mstrApp.isSingleTier&&AD.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var AA=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),AC='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);mstrApp.getRootController().wrapUpDataImport();window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";AA=AA.replace("#",AC)+".";x.displayError(AA,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}AE=mstrApp.getRootController().navigationController.getPageSlot();var AB={operationMode:o.operationMode.create};if(AD.mode){AB.mode=AD.mode;}AE.setConfig({properties:AB});AD.sourceInfo.evt=z;if(AD.pageType===o.pageType.addConnectorList){mstrApp.getRootController().showDialog(o.dialogType.addConnectorDialog);}else{x.showPage(AD.pageType,AD.sourceInfo,AE);}}},onBackButtonClick:function(){mstrApp.getRootController().showPage(o.pageType.emmaPreview,null);},onHelpButtonClick:function B(){return"Interfaces_for_importing_data.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu");mstrmojo.requiresDescs(4326,8983);var A=mstrmojo.dom;mstrmojo.Refine.TextSearchFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TextSearchFacet",config:null,options:null,query:null,timerID:null,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><div class="facet-column-name text"></div></div><div class="facet-menu"></div></div><div class="facet-text-body"><div class="input-container" mstrAttach:keyup><textarea></textarea></div><div class="facet-text-options"><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(4326,"Case Sensitive")+'</label></div><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(8983,"Regular Expression")+"</label></div></div></div></li>",markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},titleNode:function(){return this.domNode.children[0].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[0].children[0];},caseSensitiveNode:function(){return this.domNode.children[1].children[1].children[0].children[0];},regexNode:function(){return this.domNode.children[1].children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var E=this.parent;var C=mstrmojo.Refine.RangeFacet;var D=C.menuHelper=C.menuHelper||new mstrmojo.Refine.RefineFacetMenu();D.target=E;D.type=0;var B=D.getMenuConfig();B.hostId=E.id;B.hostElement=this.domNode;B.isHostedWithin=false;B.position=A.position(this.domNode,true);E.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:B}));}}],onkeyup:function(){this.query=this.inputNode.value;this.scheduleUpdate();},onclick:function(B){var D=B.e,C=A.eventTarget(B.hWin,D);if(C===this.removeNode){this.remove();}else{if(C===this.caseSensitiveNode){this.config.caseSensitive=!this.config.caseSensitive;if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}else{if(C===this.regexNode){if(this.config.mode==="regex"){this.config.mode="text";}else{this.config.mode="regex";}if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}}}},scheduleUpdate:function(){var B=this;if(!this.timerID){this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}else{window.clearTimeout(this.timerID);this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}},reset:function(){this.query=null;this.inputNode.value="";this.parent.updateEngine(true);},remove:function(){this.parent.removeFacet(this);this.config=null;this.options=null;},hasSelection:function(){return(this.query!==null&&this.query!=="");},getRequirementDiscription:function(){var B='{cells in "'+this.config.name+'" contains "'+this.query+'"}';return B;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(B){this.config.caseSensitive=B.caseSensitive;this.config.mode=B.mode;if(this.config.caseSensitive){this.caseSensitiveNode.checked=true;}if(this.config.mode==="regex"){this.regexNode.checked=true;}},getJSON:function(){var B;var C=mstrApp.rootController.refineApp.rootController.model;var D=C.columns.columns;var E=false;if(this.config.originalName!==undefined){E=true;for(B=0;B<D.length;B++){if(D[B].originalName===this.config.originalName){break;}}if(B===D.length){E=false;}}return{type:"text",name:E?D[B].name:this.config.name,columnName:E?D[B].name:this.config.columnName,mode:this.config.mode,caseSensitive:this.config.caseSensitive,query:this.query};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.HistogramWidget","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(487,12354,2797,96,1905,8445);var A=mstrmojo.dom;function C(F){var D=new Date(),G=window.Date.prototype.getTimezoneOffset.call(D),E=F-G*60*1000;return new Date(E);}var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.inputNode){if(this.label===mstrmojo.desc(487,"Time")){this.parent.selectTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12354,"Non-Time")){this.parent.selectNonTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.TimeRangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TimeRangeFacet",config:null,options:null,from:null,to:null,step:null,selectTime:true,selectNonTime:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices time"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var G=this.parent;var E=mstrmojo.Refine.RangeFacet;var F=E.menuHelper=E.menuHelper||new mstrmojo.Refine.RefineFacetMenu();F.target=G;F.type=0;var D=F.getMenuConfig();D.hostId=G.id;D.hostElement=this.domNode;D.isHostedWithin=false;D.position=A.position(this.domNode,true);G.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:D}));}}],onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.removeNode){this.remove();}else{if(E===this.resetNode){this.reset();this.parent.updateEngine(true);}}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectTime=true;this.selectNonTime=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(!this.from||!this.to){return ;}var F=C(this.from);var E=C(this.to);var D="yyyyMMdd";var G="HH:mm:ss";if(this.config.step>2629746000){this.statusNode.innerHTML=(F.getFullYear()+" &mdash; "+E.getFullYear());}else{if(this.config.step>3600000){this.statusNode.innerHTML=(F.toString(D)+" &mdash; "+E.toString(D));}else{this.statusNode.innerHTML=(F.toString(D)+" "+F.toString(G)+" &mdash; "+E.toString(D)+" "+E.toString(G));}}},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectTime||!this.selectNonTime||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var D='{cells in "'+this.config.name+'" are';var E="";if(this.selectTime&&this.timeCount>0){E+=" "+this.statusNode.innerHTML;}if(this.selectNonTime&&this.nonTimeCount>0){if(E){E+=" /";}E+=" (Non-Time)";}if(this.selectBlank&&this.blankCount){if(E){E+=" /";}E+=" (blank)";}E+="}";return D+E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(D){if(D.hasOwnProperty("min")&&D.hasOwnProperty("max")&&D.baseTimeCount!==0){this.error=false;this.config.min=D.min;this.config.max=D.max;this.config.step=D.step;this.baseBins=D.baseBins;this.bins=D.bins;switch(this.config.mode){case"min":this.from=Math.max(D.from,this.config.min);break;case"max":this.to=Math.min(D.to,this.config.max);break;default:this.from=Math.max(D.from,this.config.min);if(D.to){this.to=Math.min(D.to,this.config.max);}else{this.to=D.max;}}this.baseTimeCount=D.baseTimeCount;this.baseNonTimeCount=D.baseNonTimeCount;this.baseBlankCount=D.baseBlankCount;this.baseErrorCount=D.baseErrorCount;this.timeCount=D.timeCount;this.nonTimeCount=D.nonTimeCount;this.blankCount=D.blankCount;this.errorCount=D.errorCount;}else{if(D.baseTimeCount===0){this.error=true;this.errorMessage="No date value present.";}else{this.error=true;this.errorMessage=D.hasOwnProperty("error")?D.error:"Unknown error.";}}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(D){this.from=D.from;this.to=D.to;this.setRangeIndicators();},handleStop:function(D){this.from=D.from;this.to=D.to;this.selectTime=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var D=[];B.slot="choicesNode";B.label=mstrmojo.desc(487,"Time");B.count=this.timeCount;B.checked=(this.selectTime&&this.baseTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12354,"Non-Time");B.count=this.nonTimeCount;B.checked=(this.selectNonTime&&this.baseNonTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);D.push(new mstrmojo.Widget(B));this.addChildren(D);},getJSON:function(){var D;var E=mstrApp.rootController.refineApp.rootController.model;var F=E.columns.columns;var H=false;if(this.config.originalName!==undefined){H=true;for(D=0;D<F.length;D++){if(F[D].originalName===this.config.originalName){break;}}if(D===F.length){H=false;}}var G={type:"timerange",name:H?F[D].name:this.config.name,columnName:H?F[D].name:this.config.columnName,expression:this.config.expression,selectTime:this.selectTime,selectNonTime:this.selectNonTime,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){G.from=this.from;}if(this.to!==null){G.to=this.to;}return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Refine.HistogramWidget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(1395,12353,2797,96,1905,8445,13687);var A=mstrmojo.dom;var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.inputNode){if(this.label===mstrmojo.desc(1395,"Numeric")){this.parent.selectNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12353,"Non-numeric")){this.parent.selectNonNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.RangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RangeFacet",config:null,options:null,from:null,to:null,selectNumeric:true,selectNonNumeric:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var F=this.parent;var D=mstrmojo.Refine.RangeFacet;var E=D.menuHelper=D.menuHelper||new mstrmojo.Refine.RefineFacetMenu();E.target=F;E.type=0;var C=E.getMenuConfig();C.hostId=F.id;C.hostElement=this.domNode;C.isHostedWithin=false;C.position=A.position(this.domNode,true);F.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:C}));}}],onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.resetNode){this.reset();this.parent.updateEngine(true);}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectNumeric=true;this.selectNonNumeric=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(this.from===null||this.to===null){return ;}this.statusNode.innerHTML=this.addCommas(this.from.toFixed(2))+" &mdash; "+this.addCommas(this.to.toFixed(2));},addCommas:function(G){var C,F,D;G+="";C=G.split(".");F=C[0];D=C.length>1?"."+C[1]:"";var E=/(\d+)(\d{3})/;while(E.test(F)){F=F.replace(E,"$1,$2");}return F+D;},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectNumeric||!this.selectNonNumeric||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var C='{cells in "'+this.config.name+'" are';var D="";if(this.selectNumeric&&this.numericCount>0){D+=" "+this.statusNode.innerHTML;}if(this.selectNonNumeric&&this.nonNumericCount){if(D){D+=" /";}C+=" (Non-Numeric)";}if(this.selectBlank&&this.blankCount){if(D){D+=" /";}C+=" (blank)";}D+="}";return C+D;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(C){if(C.hasOwnProperty("min")&&C.hasOwnProperty("max")){this.error=false;this.config.min=C.min;this.config.max=C.max;this.config.step=C.step;this.baseBins=C.baseBins;this.bins=C.bins;switch(this.config.mode){case"min":this.from=Math.max(C.from,this.config.min);break;case"max":this.to=Math.min(C.to,this.config.max);break;default:this.from=Math.max(C.from,this.config.min);if(C.to!==undefined){this.to=Math.min(C.to,this.config.max);}else{this.to=C.max;}}this.baseNumericCount=C.baseNumericCount;this.baseNonNumericCount=C.baseNonNumericCount;this.baseBlankCount=C.baseBlankCount;this.baseErrorCount=C.baseErrorCount;this.numericCount=C.numericCount;this.nonNumericCount=C.nonNumericCount;this.blankCount=C.blankCount;this.errorCount=C.errorCount;}else{this.error=true;this.errorMessage=C.hasOwnProperty("error")?C.error:mstrmojo.desc(13687,"Unknown error");}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(C){this.from=C.from;this.to=C.to;this.setRangeIndicators();},handleStop:function(C){this.from=C.from;this.to=C.to;this.selectNumeric=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonNumericCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(!this.hasOtherChoices()){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var C=[];B.slot="choicesNode";B.label=mstrmojo.desc(1395,"Numeric");B.count=this.numericCount;B.checked=(this.selectNumeric&&this.baseNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12353,"Non-numeric");B.count=this.nonNumericCount;B.checked=(this.selectNonNumeric&&this.baseNonNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);C.push(new mstrmojo.Widget(B));this.addChildren(C);},getJSON:function(){var C;var D=mstrApp.rootController.refineApp.rootController.model;var E=D.columns.columns;var G=false;if(this.config.originalName!==undefined){G=true;for(C=0;C<E.length;C++){if(E[C].originalName===this.config.originalName){break;}}if(C===E.length){G=false;}}var F={type:"range",name:G?E[C].name:this.config.name,columnName:G?E[C].name:this.config.columnName,expression:this.config.expression,selectNumeric:this.selectNumeric,selectNonNumeric:this.selectNonNumeric,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){F.from=this.from;}if(this.to!==null){F.to=this.to;}return F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.PopupEditBox","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Widget","mstrmojo.dom");mstrmojo.requiresDescs(3946,3945,12352,1905,8445,1088);var A=mstrmojo.dom;var B=mstrmojo.css;var D=100;var C={scriptClass:"mstrmojo.Widget",choiceIndex:null,label:null,count:null,s:false,markupString:'<div class="facet-choice" mstrAttach:click,mouseover,mouseout><a class="facet-choice-link"></a><a class="facet-choice-link">'+mstrmojo.desc(1088,"Edit")+'</a><div class="facet-choice-label"></div><span class="facet-choice-count">({@count})</span><div class="facet-choice-count-bar"></div></div>',markupSlots:{toggleNode:function(){return this.domNode.children[0];},editNode:function(){return this.domNode.children[1];},labelNode:function(){return this.domNode.children[2];},countNode:function(){return this.domNode.children[3];},barNode:function(){return this.domNode.children[4];}},markupMethods:{onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.label)||"",null,true);}},onmouseover:function(){if(!this.s){this.toggleNode.style.visibility="visible";}this.editNode.style.visibility="visible";},onmouseout:function(){if(!this.s){this.toggleNode.style.visibility="hidden";}this.editNode.style.visibility="hidden";},onclick:function(E){var J=E.e,F=A.eventTarget(E.hWin,J);if(F===this.labelNode){this.parent.labelClick(this.choiceIndex);}else{if(F===this.toggleNode){this.parent.toggleClick(this.choiceIndex);}else{if(F===this.editNode){var G=A.position(this.domNode);var I=G.x-1;var H=G.y-1;mstrmojo.insert({scriptClass:"mstrmojo.Refine.PopupEditBox",cssClass:"facet",top:H+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+"px",text:this.blankChoice?"":this.label,preview:this.parent.parent.parent.parent.parent,columnName:this.parent.config.name,type:"text",blankChoice:this.blankChoice,fromFacet:true,floatLeft:true}).render();}}}},postBuildRendering:function(){if(this.s){B.toggleClass(this.domNode,"facet-choice-selected",true);}this.toggleNode.style.visibility=(this.s?"visible":"hidden");this.toggleNode.innerHTML=(this.parent.config.invert!==this.s?mstrmojo.desc(3946,"exclude"):mstrmojo.desc(3945,"include"));this.editNode.style.visibility="hidden";if(this.toggleNode.clientWidth+this.editNode.clientWidth+this.labelNode.clientWidth+this.countNode.offsetWidth+21>291){this.toggleNode.style.maxWidth="45px";this.editNode.style.maxWidth="45px";}this.barNode.style.right=(1-this.bar)*100+"%";}};mstrmojo.Refine.ListFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.ListFacet",config:null,options:null,selection:[],blankChoice:null,errorChoice:null,data:null,_dataIndex:0,_childrenNodes:[],markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><a class="facet-choice-link" >'+mstrmojo.desc(12352,"invert")+'</a><div class="facet-column-name"></div><div class="choiceCountContainer"></div> </div><div class="facet-menu"></div></div><div class="facet-body"><div class="facet-body-inner"></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},invertNode:function(){return this.domNode.children[0].children[0].children[1];},choiceCountNode:function(){return this.domNode.children[0].children[0].children[3];},titleNode:function(){return this.domNode.children[0].children[0].children[2];},bodyInnerNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var H=this.parent;var F=mstrmojo.Refine.ListFacet;var G=F.menuHelper=F.menuHelper||new mstrmojo.Refine.RefineFacetMenu();G.target=H;G.type=0;var E=G.getMenuConfig();E.hostId=H.id;E.hostElement=this.domNode;E.isHostedWithin=false;E.position=A.position(this.domNode,true);H.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:E}));}}],labelClick:function(G){var H=this.data.choices,F;var E=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);if(G===-1){F=this.blankChoice;}else{if(G===-2){F=this.errorChoice;}else{F=H[G];}}if(F.s){if(E>1){this.select(F,true);}else{this.deselect(F);}}else{if(E>0){this.select(F,true);}else{this.select(F,false);}}},toggleClick:function(F){var G=this.data.choices,E;if(F===-1){E=this.data.blankChoice;}else{E=G[F];}if(E.s){this.deselect(E);}else{this.select(E,false);}},select:function(E,F){if(F){this.selection=[];if(this.blankChoice!==null){this.blankChoice.s=false;}if(this.errorChoice!==null){this.errorChoice.s=false;}}E.s=true;if(E!==this.errorChoice&&E!==this.blankChoice){this.selection.push(E);}this.parent.updateEngine(true);},deselect:function(E){var F;if(E===this.errorChoice||E===this.blankChoice){E.s=false;}else{for(F=this.selection.length-1;F>=0;F--){if(this.selection[F]===E){this.selection.splice(F,1);break;}}}this.parent.updateEngine(true);},onclick:function(E){var G=E.e,F=A.eventTarget(E.hWin,G);if(F===this.invertNode){this.config.invert=!this.config.invert;this.parent.updateEngine(true);}else{if(F===this.resetNode){this.reset();this.parent.updateEngine(true);}}},sortByName:function(){if(this.options.sort!=="name"){this.options.sort="name";this.reSortChoices();this.update();}},sortByCount:function(){if(this.options.sort!=="count"){this.options.sort="count";this.reSortChoices();this.update();}},reset:function(){this.selection=[];this.blankChoice=null;this.errorChoice=null;this.config.invert=false;},remove:function(){this.parent.removeFacet(this);this.config=null;this.selection=null;this.blankChoice=null;this.errorChoice=null;this.data=null;},hasSelection:function(){return this.selection.length>0||(this.blankChoice!==null&&this.blankChoice.s)||(this.errorChoice!==null&&this.errorChoice.s);},getRequirementDiscription:function(){var F,E='{cells in "'+this.config.name+'" '+(this.config.invert?"are not equal to ":"are equal to ");for(F=0;F<this.selection.length;F++){var G=this.selection[F];E+='"'+G.v.l+'"';if(F!==this.selection.length-1){E+=" / ";}}E+="}";return E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.config.invert=false;this.update();this.bodyInnerNode.onscroll=function(){var E=A.findWidget(this.parentNode.parentNode);if(this.scrollTop+this.clientHeight+3>=this.scrollHeight){if(E._dataIndex<E._childrenNodes.length-1){E.incrementalRender(E._childrenNodes,E._dataIndex);}}};},updateState:function(I){this.maxCount=0;this.data=I;var F,H=false;if(I.choices){var G=[];var J=I.choices;for(F=0;F<J.length;F++){var E=J[F];this.maxCount=Math.max(this.maxCount,E.c);if(E.s){if(E.c===0){H=true;}else{G.push(E);}}}this.selection=G;this.reSortChoices();this.blankChoice=null;if(I.blankChoice){this.maxCount=Math.max(this.maxCount,I.blankChoice.c);if(I.blankChoice.c===0){I.blankChoice=null;H=true;}else{this.blankChoice=I.blankChoice;}}this.errorChoice=I.errorChoice||null;}if(H===true){this.parent.updateEngine(true);return ;}this.update();},reSortChoices:function(){this.data.choices.sort(this.options.sort==="name"?function(F,E){return F.v.l.toLowerCase().localeCompare(E.v.l.toLowerCase());}:function(F,E){var G=E.c-F.c;return G!==0?G:F.v.l.localeCompare(E.v.l);});},update:function(){var I,J;var K=this.config.invert;if(K){B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",true);B.toggleClass(this.invertNode,"facet-mode-inverted",true);}else{B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",false);B.toggleClass(this.invertNode,"facet-mode-inverted",false);}while(this.bodyInnerNode.hasChildNodes()){this.bodyInnerNode.removeChild(this.bodyInnerNode.firstChild);}if(!this.data){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=mstrmojo.desc(8445,"Loading")+"...";this.bodyInnerNode.appendChild(J);return ;}if(this.data.hasOwnProperty("error")){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=this.data.error;this.bodyInnerNode.appendChild(J);return ;}var L=this.data.choices;var G=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);this.choiceCountNode.innerHTML="("+L.length+")";if(G>0){this.invertNode.style.display="block";this.resetNode.style.display="block";}else{this.invertNode.style.display="none";this.resetNode.style.display="none";}var E=[];var H,F;for(I=0;I<L.length;I++){H=L[I];if(H.c===0){continue;}C.slot="bodyInnerNode";C.choiceIndex=I;C.label=H.v.l;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;C.blankChoice=false;F=new mstrmojo.Widget(C);E.push(F);}if(this.blankChoice!==null){H=this.blankChoice;C.slot="bodyInnerNode";C.choiceIndex=-1;C.label="(blank)";C.blankChoice=true;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}if(this.errorChoice!==null){H=this.errorChoice;C.slot="bodyInnerNode";C.choiceIndex=-2;C.label="(error)";C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}this.set("_dataIndex",0);this.set("_childrenNodes",E);this.incrementalRender(this._childrenNodes,this._dataIndex);},incrementalRender:function(F,H){var I=H===0?H:H+1,G=I+D-1,E=F.slice(I,G+1);this.set("_dataIndex",G);this.addChildren(E);},getJSON:function(){var I,E;var G=mstrApp.rootController.refineApp.rootController.model;var H=G.columns.columns;var K=false;if(this.config.originalName!==undefined){K=true;for(E=0;E<H.length;E++){if(H[E].originalName===this.config.originalName){break;}}if(E===H.length){K=false;}}var J={type:"list",name:K?H[E].name:this.config.name,columnName:K?H[E].name:this.config.columnName,expression:this.config.expression,omitBlank:this.config.omitBlank||false,omitError:this.config.omitError||false,selection:[],selectBlank:this.blankChoice!==null&&this.blankChoice.s,selectError:this.errorChoice!==null&&this.errorChoice.s,invert:this.config.invert};for(I=0;I<this.selection.length;I++){var F={v:this.selection[I].v};J.selection.push(F);}return J;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.DI.DIHelpers","mstrmojo.qb.menu.SimpleGridMenu","mstrmojo.hash");var L=mstrmojo.string,C=mstrmojo.DI.DIHelpers,J=mstrmojo.dom,K=mstrmojo.array,G=mstrmojo.hash;var D;function I(N){var M=[];K.forEach(N,function(O){M.push(O.v);});return M.join("");}mstrmojo.qb.QBSimplePreview=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.qb.QBSimplePreview",resizeColumnBehavior:mstrmojo.RESIZE_ALL_COLUMN_MODE,dataset:null,mappings:null,selectedColumns:null,visible:false,cssClass:"lockHeader mstrmojo-qb-simplepreview",lockHeader:true,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},menuButton:null,adjustSize:function(Q){var P=60,O=this.parent&&this.parent.domNode,S=P*Q;if(!O||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflow="hidden";this.contentWidth="auto";var N=this.contentWidth,R=this.headerContainerNode,M=this.itemsContainerNode;if(N&&R&&M){R.style.width=N;M.style.width=N;}this.onheightChange();},onmouseover:function(){var M=mstrmojo.hash.walk("itemsContainerNode.firstChild.clientWidth",this)||0,N=this.parent&&this.parent.domNode;this.scrollboxNode.style.overflowX=(M>N.clientWidth)?"auto":"hidden";this.scrollboxNode.style.overflowY="auto";},onmouseout:function(){this.scrollboxNode.style.overflow="hidden";},onheightChange:function E(){var O=this.height,M=this.headerContainerNode,N=this.scrollboxNode;if(O&&M&&N){N.style.height=parseInt(O,10)-M.clientHeight-1+"px";}this.domNode.style.height=parseInt(this.height,10)-(C.getEnvObj().isWSDossierLocalMode()?60:0)+"px";},onwidthChange:function F(){if(this.domNode&&this.mappings){this.domNode.style.width="100%";this.adjustSize(this.mappings.length);}},postBuildRendering:function B(){if(this._super){this._super();}mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseover");mstrmojo.dom.attachMarkupEvent(this.id,this.domNode,"mouseout");if(C.getEnvObj().isWS()){this.hasCustomScrollbar=true;}},populatePreview:function A(){var R=this.mappings,V=this.selectedColumns,N=0,M=this.scrollboxNode,Q,U,O,P,W=this;this.columns=[];if(M){N=M.scrollLeft||0;}this.unrender();if(this.isRefined&&!mstrApp.isFFSQLMode){K.forEach(V,function(a,d){var f=a.colo,e,Z;e=mstrApp.isFFSQLMode?a.n:I(V[d].expr);Z={tag:a,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:d,headerText:e,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@en@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function c(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:e});if(!this._ontooltipover){var g=this.id;this._ontooltipover=function(j){var h=mstrmojo.all[g];h.showTooltip(j,self);};this._ontooltipout=function(j){var h=mstrmojo.all[g];h.hideTooltip(j,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function b(){var j=this.columnIndex,h=mstrApp.isFFSQLMode;if(h){return ;}D.showPopupMenu(W,{menuNode:this.domNode.lastChild,data:{columnIndex:j,isVisible:function g(l,k){return h?false:true;}}});}},colWidth:"60",dataFunction:function(l,h,k){var g=l[this.dataField],j="mstrmojo-di-datapreview-DataRow-text";j+=(h%2===1)?" odd":" even";return'<div class="'+j+'" title="'+g+'">'+g+"</div>";},dataField:d.toString()};W.columns.push(Z);});}else{K.forEach(R,function(a,d){var f=mstrApp.isFFSQLMode?G.walk("dicl.clix",a):a.colo,e,Z;e=mstrApp.isFFSQLMode?a.cln:I(V[f].expr);Z={tag:a,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:f,headerText:e,menuCssClass:mstrApp.isFFSQLMode?"":"mstrmojo-qb-simplegrid-itemmenu",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@en@headerText}</span><span class="{@menuCssClass}" mstrAttach:click></span></div>',useRichTooltip:true,postBuildRendering:function c(){if(this._super){this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:e});if(!this._ontooltipover){var g=this.id;this._ontooltipover=function(j){var h=mstrmojo.all[g];h.showTooltip(j,self);};this._ontooltipout=function(j){var h=mstrmojo.all[g];h.hideTooltip(j,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);},onclick:function b(){var j=this.columnIndex,h=mstrApp.isFFSQLMode;if(h){return ;}D.showPopupMenu(W,{menuNode:this.domNode.lastChild,data:{columnIndex:j,isVisible:function g(l,k){return h?false:true;}}});}},colWidth:"178",dataFunction:function(l,h,k){var g=l[this.dataField],j="mstrmojo-di-datapreview-DataRow-text";j+=(h%2===1)?" odd":" even";return'<div class="'+j+'" title="'+g+'">'+g+"</div>";},dataField:d.toString()};W.columns.push(Z);});}O=this.dataset;if(O.length===0&&this.columns.length>0){var X=21;var S=parseInt(parseInt(this.parent.height,10)/X,10)-1;S=S>0?S:1;var Y;for(Q=0;Q<S;Q++){Y=[];for(P=0,U=this.columns.length;P<U;P++){Y.push("");}O.push(Y);}}this.items=O;this.render();this.adjustSize(R.length);this.scrollboxNode.scrollLeft=N;if(C.isIEOrEdge()||J.isFF){this.disableScroll(false);}},onvisibleChange:function(M){if(M.value){this.populatePreview();}}});D=mstrmojo.qb.QBSimplePreview;D.showPopupMenu=function H(P,N){var O=D.menuHelper=D.menuHelper||new mstrmojo.qb.menu.SimpleGridMenu();O.target=P;O.data=N.data;var M=O.getMenuConfig();M.hostId=P.id;M.hostElement=N.menuNode;M.isHostedWithin=false;M.position=mstrmojo.dom.position(N.menuNode,true);P.openPopup(M.newInstance());};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineMenu","mstrmojo.InlineEditBox","mstrmojo.DI.DIConstants");var A=mstrmojo.dom;var C=0;var D=mstrmojo.DI.DIHelpers;var B=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineDataHeader=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RefineDataHeader",text:"",markupString:'<div id="{@id}" class="refine-data-header {@cssClass}" style="{@cssText}" mstrAttach:mousedown><div class="refine-data-header-text"></div><div class="refine-data-header-menu"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];},menuNode:function(){return this.domNode.children[1];}},onmousedown:function(E){this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.text,isCtrlKey:D.isCtrlKey(E.hWin,E.e)});this.preview.controller.isClickedInDatePreview=true;this.preview.controller.resetRecords();},children:[{slot:"textNode",alias:"inlineEdit",scriptClass:"mstrmojo.InlineEditBox",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:mousedown,dblclick><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div><div class="mstrmojo-InlineEditBox-overlay"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},inputNode:function(){return this.domNode.childNodes[1].firstChild;},okNode:function(){return this.domNode.childNodes[1].childNodes[1];},cancelNode:function(){return this.domNode.childNodes[1].lastChild;},overlayNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||"",null,true);this.textNode.title=mstrmojo.string.encodeHtmlString(this.text||"",null,true);},oneditModeChange:function(){var K=this.editMode,H=this.domNode,F=this.textNode,G=this.overlayNode,J=this.editNode;mstrmojo.css.toggleClass(H,["edit"],K);if(K){F.style.display="none";J.style.display="block";G.style.display="block";F=this.inputNode;var I=F.style;F.value=this.text||"";I.width=(this.nodeWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";I.height=this.nodeHeight+"px";F.select();F.focus();if(F.createTextRange){var L=F.createTextRange(),E=F.value.length;L.move("character",E);L.select();}}else{F.style.display="block";J.style.display="none";G.style.display="none";}},onokSaveChange:function(){var E=this.okSave?"inline":"none";this.okNode.style.display=E;this.cancelNode.style.display=E;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},bindings:{text:"this.parent.text"},ondblclick:function(){this.nodeWidth=this.domNode.clientWidth;this.nodeHeight=this.domNode.clientHeight;this.set("editMode",this.allowEdit);},onmousedown:function(E){var G=E.e,F=A.eventTarget(E.hWin,G);if(F===this.okNode){this.save();}else{if(F===this.cancelNode){this.cancel();}}},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}if(this.onSave){this.onSave();}},onSave:function(){this.handleRename();},handleRename:function(){var E=this.parent.preview.controller;var I=mstrApp.getRootController();var H=E.model;var J=this.oldColumn;var K=this.newColumn;var G=[],F;if(B.invalidObjectNameCharsRegex.test(K)){I.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",B.invalidObjectNameChars));return false;}F=JSON.parse(JSON.stringify(H.transformations.Other.Rename));F.description=F.description.replace("####",J);F.description=F.description.replace("@@@@",K);F.oldColumnName=J;F.newColumnName=K;G.push(F);E.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});},handleDelete:function(){var F=this.parent.preview.controller;var I=F.model;var E=this.text;var H=[],G;G=JSON.parse(JSON.stringify(I.transformations.Delete.Colomn));G.description=G.description.replace("[column name]",E);G.columnName=E;H.push(G);F.applyOperations({operations:JSON.stringify(H),engine:JSON.stringify({facets:[],mode:"row-based"})});},_attachEvents:function(){var E=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var F=A.eventTarget(self,arguments[0]);if(F===E.overlayNode){E.save();}};}A.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){A.detachEvent(document.body,"mousedown",this._save_handler);}}}},{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var H=this.parent;var F=mstrmojo.Refine.RefineDataHeader;var G=F.menuHelper=F.menuHelper||new mstrmojo.Refine.RefineMenu();G.target=H;G.data=[H.data];G.type=C;var E=G.getMenuConfig();E.hostId=H.id;E.hostElement=this.domNode;E.isHostedWithin=false;E.position=A.position(this.domNode,true);E.isRefine=!!mstrApp.isWorkstation?true:false;H.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:E}));},bindings:{visible:function(){return(!this.parent.suggestionPreview);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var N=mstrmojo.dom,b=mstrmojo.array,B=mstrmojo.css,h="animate",j="90px",o="70px",F="52px",z=200,Q=700,A=750;function D(){var AH=window.Modernizr,AG="transition";if(AH&&AH.testProp(AG)){return N.transEndEvtNames[AH.prefixed(AG)];}return null;}function AB(AG){return function(){this.menuNode.style.display=AG?"block":"none";};}function P(AG){return Math.min(AG.offsetWidth-AG.firstChild.offsetWidth,0);}function AA(AG){return AG.isAlignRight?"right":"left";}function AE(AG,AH){return parseInt(AG.style[AA(AH)],10)||0;}function L(){var AK=this.tabContainerNode,AJ=false,AI=false,AL=false,AM=this.leftBtnNode,AG=this.rightBtnNode,AH=this.isValidMode();window.setTimeout(function(){if(P(AK)<0){var AO=N.position(AK),AN=N.position(AK.firstChild);AJ=(AN.x<AO.x);AI=(AN.x+AN.w>AO.x+AO.w+1);}AL=AJ||AI;B.toggleClass(this.btnBarNode,"highlightBar",AL);AM.style.display=AG.style.display=AL?"block":"none";AM.disabled=!AJ;AG.disabled=!AI;B.toggleClass(AM,"disable",!AJ);B.toggleClass(AG,"disable",!AI);if(this.domNode){this.addBtnNode.style.display=this.tabStripMenuNode.style.display=AH?"block":"none";this.bufferNode.style.display=AH?"none":"block";this.floaterNode.style.display=this.hasFloater&&AJ?"block":"none";}this.widgetResized();}.bind(this),z);}function U(AG,AH){AG=(AG||[]);if(!AG.filter){return b.filter(AG,AH);}return AG.filter(AH);}function X(AG,AH){AG=(AG||[]);if(!AG.map){return b.map(AG,AH);}return AG.map(AH);}function u(AW,AI,AJ){var AU=this.tabContainerNode,AN=this.domNode;if(this.isStatic||!AU||!AN||AN.style.display==="none"){return ;}var AP=AU.firstChild,AV=P(AU),AM=AE(AP,this),AG=Math.max(AM,AV),AT=U(this.children,function(AX){return AX.isSelected;})[0],AR=AJ&&AJ.domNode||AT&&AT.domNode;if(AW&&AR){if(AV<0){var AO=N.position(AR),AK=N.position(AU),AQ=Math.floor(AO.x-AK.x),AS=Math.floor(AO.x+AO.w-(AK.x+AK.w));if(AJ){var AH=Math.ceil(AR.offsetWidth);AQ=AQ===0?Math.max(AV,-AH):AQ;AS=AS===0?Math.min(-AV,AH):AS;}var AL=AQ<0?AQ:(AS>0?AS:0);AG=this.isAlignRight?AG+AL:AG-AL;}}if(AG!==AM){if(AI){this.setAnimation(AP);}AP.style[AA(this)]=Math.max(AV,Math.min(AG,0))+"px";}L.call(this);}function C(AG){return AG.hasOwnProperty("index");}function J(){var AH=this.tabContainerNode,AI=N.position(AH),AG=this.isAlignRight;b.forEach(this.children||[],function(AK){var AQ=AK.domNode,AR=N.position(AQ),AN=Math.floor(AR.x-AI.x),AO=Math.floor(AR.x+AR.w-(AI.x+AI.w)),AJ=AK.isSelected,AP=Math.ceil(AQ.offsetWidth),AL=0;AK.isCutoff=AK.isHidden=AK.isLeftMost=AK.isRightMost=false;AK.leftEdgeHiddenWidth=AK.rightEdgeHiddenWidth=0;if(AN<0){var AM=Math.abs(AN);AL=AP-AM;AK.isLeftMost=AL>=0;AK.isCutoff=AK.isLeftMost&&AM>0&&AL>0;AK.isHidden=AL<=0;AK.leftEdgeHiddenWidth=AM;}else{if(AO>0){AL=AP-AO;AK.isRightMost=AL>=0;AK.isCutoff=AK.isRightMost&&AO>0&&AL>0;AK.isHidden=AL<=0;AK.rightEdgeHiddenWidth=AO;}}});}function Z(){var AG=this.children,AH=0;(AG||[]).every(function(AJ,AI){if(!C(AJ)){return false;}AH++;AJ.index=AI;return true;});(AG||[]).every(function(AI){if(!C(AI)){return false;}AI.total=AH;return true;});}function g(AM,AI){var AL=AM.ENUM_CORNERS,AN=[AL.TOP_LEFT,AL.BOTTOM_LEFT],AH=this.parent;if(AH.position!=="bottom"){AN.reverse();}AM.setAlignment(AN[0],AN[1]);var AG=N.position(AH.domNode),AK=AH.menuNode;var AJ=AK.style;AJ.top=(AI.y-AG.y)+"px";AJ.left=(AI.x-AG.x)+"px";AM.addPopupHandlers(AH.id,AB(true),AB(false));AM.hostId=AH.id;AM.hostElement=AK;AM.isHostedWithin=false;AH.openPopup(AM.newInstance());}function k(AG){AG.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-menu" mstrAttach:click><div id="tabCommonIcon" class="mstrmojo-VITabStrip-menuIcon"></div><div id="tabCommonButton" class="mstrmojo-VITabStrip-menuButton"></div><div id="tabCommonMenuHost" class="mstrmojo-VITabStrip-menuButtonHost"></div></div><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-buffer"></div><div class="mstrmojo-VITabStrip-btnBar"><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div class="mstrmojo-VITabStrip-addBtn-Img"></div><div class="mstrmojo-VITabStrip-addBtn-Text"></div></div><div class="mstrmojo-VITabStrip-navBtns"><div id="tabRightButton" class="mstrmojo-VITabStrip-rightBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div><div id="tabLeftButton" class="mstrmojo-VITabStrip-leftBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div></div></div><div class="mstrmojo-VITabStrip-floater"></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabStripMenuNode:function(){return this.domNode.firstChild;},menuImgNode:function(){return this.domNode.firstChild.firstChild;},menuBtnNode:function(){return this.domNode.firstChild.childNodes[1];},menuBtnHostNode:function(){return this.domNode.firstChild.lastChild;},tabContainerNode:function(){return this.domNode.childNodes[1];},containerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},bufferNode:function(){return this.domNode.childNodes[2];},btnBarNode:function(){return this.domNode.childNodes[3];},addBtnNode:function(){return this.domNode.childNodes[3].firstChild;},addBtnImgNode:function(){return this.domNode.childNodes[3].firstChild.firstChild;},addBtnTxtNode:function(){return this.domNode.childNodes[3].firstChild.lastChild;},navBtnsNode:function(){return this.domNode.childNodes[3].lastChild;},rightBtnNode:function(){return this.domNode.childNodes[3].lastChild.firstChild;},leftBtnNode:function(){return this.domNode.childNodes[3].lastChild.lastChild;},floaterNode:function(){return this.domNode.childNodes[4];},menuNode:function(){return this.domNode.childNodes[5];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabStripMenuNode:null,menuImgNode:null,menuBtnNode:null,menuBtnHostNode:null,tabContainerNode:null,addBtnNode:null,bufferNode:null,navBtnsNode:null,leftBtnNode:null,rightBtnNode:null,menuNode:null,position:"bottom",selectMovedTab:false,hasFloater:false,tabObjects:null,layoutConfig:{w:{tabContainerNode:"100%",bufferNode:"6px",addBtnNode:j,navBtnsNode:F,tabStripMenuNode:o},xt:true},onAppStateChange:function q(AN){var AL=mstrmojo.vi.VisualInsightApp.APP_STATES,AM=AL.PRESENTATION,AG=AL.SELECTOR_TARGETING,AH=AN.value,AO=AN.valueWas,AK=this.isValidMode();if(AH&AM||AO&AM||AH&AG||AO&AG){var AI=this.addBtnNode,AJ=this.tabStripMenuNode;if(AI&&AJ){AI.style.display=AJ.style.display=AK?"block":"none";this.bufferNode.style.display=AK?"none":"block";this.doLayout();}}},setStatic:function R(AG,AH){this.isStatic=AG;if(!AG){u.call(this,true,AH);}},setTabs:function p(AI,AG){this.removeChildren();this.tabObjects=AI;var AJ=this,AH=(AI&&AI.length)||0;this.addChildren(X(AI,function(AM,AK){var AL=AM.k;return AJ.getTabCfg(AI,AM,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:AK,total:AH,draggable:!!AH,dropZone:!!AH,k:AL,isSelected:AL===AG,showTabMenu:g,tabMoved:function(AO){var AN=this.index;AJ.moveTab(AN,AN+(AO?-1:1),AN);}});}));u.call(this,true);k(this);},getTabs:function l(){return U(this.children,C);},getTabCfg:function AF(AH,AI,AG){return AG;},deleteTab:function I(AG){var AM=this.id,AL=this.children[AG],AK=D(),AJ=function(){var AN=mstrmojo.all[AM];AN.removeChildren(AL);AL.destroy();Z.call(AN);L.call(AN);k(AN);};if(AK){var AI=AL.domNode.firstChild,AH=AI.style;AH.width=AI.offsetWidth+"px";window.setTimeout(function(){B.addClass(AI,h);N.attachOneTimeEvent(AI,AK,AJ);AH.width=0;},0);}else{AJ();}},buildRendering:function c(){this._super();B.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function V(){var AG=this._super();u.call(this,true);return AG;},doLayout:function K(){this._super();u.call(this,true);},isValidMode:function E(){return !((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())||(mstrApp.allowWebDashboardDesign&&!mstrApp.allowWebDashboardDesign()));},setSelectedTab:function S(AG){b.forEach(this.children||[],function(AH){AH.set("isSelected",AH.k===AG);});k(this);},getSelectedTab:function f(){var AI=null,AH=this.children||[],AG;for(AG=0;AG<AH.length;AG++){if(AH[AG].isSelected){AI=AH[AG];break;}}return AI;},onclick:function n(AG){if(!this.isValidMode()){return ;}if(AG.getTarget()===this.addBtnImgNode||AG.getTarget()===this.addBtnTxtNode){this.addTab();}},addTab:mstrmojo.emptyFn,clearBtnTooltips:function O(AI){var AG=(AI===this.leftBtnNode),AH=(AI===this.rightBtnNode);if(AG||AH){this.clearTooltips();return true;}return false;},showBtnTooltips:function G(AG){var AI=AG.getTarget().parentNode,AH=this.clearBtnTooltips(AI);if(AH){this.toggleTooltip(AI);}},onmouseout:function w(AG){var AH=AG.getTarget().parentNode;this.clearBtnTooltips(AH);},onmouseover:function H(AG){this.showBtnTooltips(AG);},onmouseup:function a(AG){window.setTimeout(function(){this.showBtnTooltips(AG);}.bind(this),z);},onmousedown:function e(AP){var AL=AP.getTarget().parentNode,AQ=(AL===this.leftBtnNode),AJ=(AL===this.rightBtnNode);if(AQ||AJ){var AO=this.tabContainerNode,AK=AO.firstChild,AG=this.id,AM=this,AI;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}B.addClass(AL,"active");var AN=function(){window.clearInterval(AI);B.removeClass(AL,"active");L.call(mstrmojo.all[AG]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};N.attachOneTimeEvent(document.body,"mouseup",AN);var AH=function(){var AT=P(AO),AW=AE(AK,AM),AX=AW-AT,AV=0-AW;J.call(AM);AM.setAnimation(AK);var AR=AM.getCornerTabs()||[],AU=U(AR,function(AY){if(AQ&&AY.isLeftMost||AJ&&AY.isRightMost){return AY;}})[0],AS=0;if(AU){AS=AU.isCutoff?(AQ?AU.leftEdgeHiddenWidth:AU.rightEdgeHiddenWidth):Math.ceil(AU.domNode.offsetWidth);AS=Math.min(AS,AQ?AV:AX);AS=AM.isAlignRight?(AQ?-AS:AS):(AQ?AS:-AS);}AK.style[AA(AM)]=parseInt(AK.style[AA(AM)]||0)+AS+"px";};AH();AI=window.setInterval(function(){AH();},A);}},getCornerTabs:function d(){return U(this.children,function(AG){return AG.isLeftMost||AG.isRightMost;});},setAnimation:function Y(AG){var AH=D();if(AH){B.addClass(AG,h);N.attachOneTimeEvent(AG,AH,function(){B.removeClass(AG,h);});}},createTooltip:function AC(AH){var AJ=document.createElement("div");AJ.className="navBtnTooltip";AJ.appendChild(document.createTextNode(AH.getAttribute("tooltip")||""));var AM=document.body.firstChild;AM.parentNode.insertBefore(AJ,AM);var AK=5,AN=AJ.offsetWidth-25,AI=AH.getBoundingClientRect(),AL=AJ.getBoundingClientRect(),AG=AI.top-(AL.height+AK);AJ.style.top=AG+"px";AJ.style.left=(AI.left-AN)+"px";return AJ;},clearTooltips:function m(){window.clearTimeout(this._tooltipTimeOut);var AG=document.querySelectorAll(".navBtnTooltip");b.forEach(AG||[],function(AH){AH.parentNode.removeChild(AH);});},toggleTooltip:function AD(AG){window.clearTimeout(this._tooltipTimeOut);if(AG.disabled){this._tooltipTimeOut=window.setTimeout(function(){this.createTooltip(AG);}.bind(this),Q);}},moveTab:function M(AG,AO,AM,AL){var AH=this.children,AP=AH.splice(AG,1)[0];AH.splice(AO,0,AP);Z.call(this);this.setAnimation(this.tabContainerNode.firstChild);var AI=this.containerNode,AJ=AI.childNodes,AN=AI.removeChild(AJ[AG]),AK=AJ[AO];if(AK){AI.insertBefore(AN,AK);}else{AI.appendChild(AN);}if(this.selectMovedTab||AP.isSelected){u.call(this,true,true,AP);}if(!AL&&AM!==undefined&&AM!==AO){this.commitTabMove(AM,AO);k(this);}},commitTabMove:function x(AG,AH){throw new Error(this.scriptClass+" must implement commitTabMove.");},updateTabTable:function t(){if(!this.isStatic){u.call(this,true);}},setLinkIcon:function W(AG,AJ){var AI,AH;if(AG){if(AJ){AH="src";b.some(this.getTabs(),function(AK){if(AK.k===AJ){AI=AK;}return AI;});if(!AI){return ;}}else{AH="tgt";AI=this.getSelectedTab();}B.addClass(AI.domNode,AH);}else{AH=AJ?["src","tgt"]:"tgt";b.forEach(this.children,function(AK){B.removeClass(AK.domNode,AH);});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricDataService","mstrmojo.ui.ScrollableSuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var R=mstrmojo.dom,U=mstrmojo.css,AL=mstrmojo.Enum_Keys,H=mstrmojo.range,l=H.EDGE,AD=mstrmojo.ME.MetricToken.isDelimiter,Q=mstrmojo.expr,u=mstrmojo.array,K=mstrmojo.hash;var M=R.isIE||R.isIEW3C;function AT(E){return E.ctrlKey||R.isMetaKey(window,E)||(E.charCode||E.keyCode)===AL.CTRL;}mstrmojo.ME.SpanListMapper=mstrmojo.provide("mstrmojo.ME.SpanListMapper",mstrmojo.mixin({itemWrapperPrefix:function(E){return'<span class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"&nbsp;",itemWrapperSuffix:"</span>",createWrapperNode:function S(E){var AU=E.ownerDocument,AV=AU.createElement("span");return AV;},_iw2idx:function V(AU,AX,AW){var AV=this.wrapperNodes(AX),E=mstrmojo.array.indexOf(AV,AW);return E===-1?AV.length:E;},itemOffsetLeft:function j(AU,AY,E,AW){if(!AW){var AV=this.wrapperNodes(AY);AW=AV&&AV[E];if(!AW){return 0;}}var AX=AY.firstChild;if(!AX||(AX===AW)){return 0;}return AW.offsetLeft-AX.offsetLeft;},whereDrop:function AS(Ac,E,AW,Ab,AU){var AY=this._nd2iw(Ac,E,AW),Ad,Aa,AX,AZ,AV;if(AY){Aa=this._iw2idx(Ac,E,AY);Ad=Aa;AX=this.itemOffsetLeft(Ac,E,null,AY);AZ=AY.offsetTop;AV=AY.offsetWidth;if(Ab.x>AU.left+AX+AV/2){Ad++;AX+=AV;}}else{return Ac.dropCuePos;}return{left:AX,top:AZ,idx:Ad,idxActual:Aa};}},mstrmojo.hash.copy(mstrmojo.WidgetListMapper)));mstrmojo.ME.TokenInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.ME.TokenInputBox",containerResizable:false,dropZone:true,suggestionPopupCssClss:"mstrmojo-ME-TokenInputBox-suggest",allowDrop:function G(E){var AU=E.src.data;return !!AU;},createToken:function A(E){return{v:mstrmojo.ME.MetricToken.brackets(E.n),oi:K.copyProps(["did","n","t"],E),isNew:true};},ondrop:function(AU){AU.src.data=this.createToken(AU.src.data.item);if(this.prepareDropItem){this.prepareDropItem(AU);}var E=this.insertTokens([AU.src.data]);this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");return E;},ondragenter:function I(E){this.dragdata=E.src.data;this._super(E);this.set("dropCuePos",{left:0,top:0});mstrmojo.css.addClass(this.domNode,"unselectable");},ondragleave:function W(){this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondropCuePosChange:function Y(AU){var AV=AU.value,E=this.dragdata;if(E&&E.setAvatarClass){if(AV){E.setAvatarClass("add");}else{E.setInvalidAvatarClass();}}},makeObservable:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,markupString:'<div id={@id} class="mstrmojo-TokenInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit" contenteditable="true" tabindex="1" spellcheck="false"ondragstart = "return false;" oncontextmenu = "return false;" onkeydown = "return mstrmojo.all.{@id}.handlekeydown(event);" onkeypress = "return mstrmojo.all.{@id}.handlekeypress(event);" onkeyup = "return mstrmojo.all.{@id}.handlekeyup(event);" onmouseup = "return mstrmojo.all.{@id}.handlemouseup(event);" onpaste = "return mstrmojo.all.{@id}.handlepasteDirect(event);" onblur = "return mstrmojo.all.{@id}.handleblur(event);" >{@itemsHtml}</div><textarea class = "mstrmojo-TokenInputBox-clipboard" onkeyup = "return mstrmojo.all.{@id}.handlepaste(event);"></textarea><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild;},clipboardNode:function(){return this.domNode.childNodes[1];},scrollboxNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",items:null,itemFunction:function J(AV,E,AU){return new mstrmojo.ME.MetricToken({data:AV,parent:AU});},listMapper:mstrmojo.ME.SpanListMapper,_set_items:function X(AU,E){if(this._super){this._super(AU,E);}if(this.oi){this.oi.tks.items=this.items;}if(!this.tokensCacheInitilized){this.pretokensModify();this.tokensCacheInitilized=true;}},tokensCache:[],tokensCachePointer:0,isDelimiter:AD,postBuildRendering:function e(){if(this._super){this._super();}this._eros=false;if(R.isFF){document.body.spellCheck=false;}mstrmojo.dom.attachEvent(this.editNode,"compositionstart",function(){this.saveStateForIME();this.composing=true;this.toggleIMEStatusBar(true);}.bind(this));mstrmojo.dom.attachEvent(this.editNode,"compositionupdate",function AU(AV){if(R.isIEW3C){this.lastImeChar=AV.data||(M&&this.lastImeChar);}else{this.lastImeChar=AV.data||this.lastImeChar;}}.bind(this));mstrmojo.dom.attachEvent(this.editNode,"compositionend",function E(AX){this.composing=false;if(R.isIE9||R.isIE10){var AW=H.getRangeInfo();this.imeBuffer=AW.startContainer.data.slice(this.prev_rInfo.startOffset,AW.startOffset).split("");}else{if(R.isIEW3C){var AW=H.getRangeInfo();this.imeBuffer=AW.startContainer.data.slice((this.prev_rInfo.startOffset-1)<0?0:this.prev_rInfo.startOffset,AW.startOffset).split("");}else{if(R.isEdge){var AV=AX.data||"";this.imeBuffer=(this.imeBuffer||[]).concat(AV.split(""));}else{var AV=AX.data||this.lastImeChar||"";this.imeBuffer=(this.imeBuffer||[]).concat(AV.split(""));}}}}.bind(this));},fnContextMenu:function N(E){if(E){E.cancelBubble=true;E.returnValue=false;}return false;},saveStateForIME:function h(){if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=H.getRangeInfo();this.prev_items=this.items;}},handleblur:function L(){if(this.doubleByte){this.doubleByte=false;this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;}},processDeleteKeyDown:function D(AU){if(!this.doubleByte){try{this.widgetHandleDelete(AU);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});}catch(E){}return true;}},processBackspaceKeyDown:function AR(AU){if(!this.doubleByte){try{this.widgetHandleBackspace(AU);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();this.editNode.focus();}catch(E){}return true;}},handlekeydown:function b(AW){AW=AW||window.event;var E=AW.keyCode||AW.charCode,AU=false,AV=H.getRangeInfo();if((E===AL.LEFT_ARROW||E===AL.RIGHT_ARROW||E===AL.BACKSPACE)&&this.doubleByte){if(this.composing){return ;}this.doubleByte=false;if(E===AL.BACKSPACE){this.imeBuffer.pop();}this.widgetHandleImeInput(this.prev_rInfo);mstrmojo.dom.stopPropogation(window,AW);mstrmojo.dom.preventDefault(window,AW);return false;}switch(E){case AL.DELETE:AU=this.processDeleteKeyDown(AV);break;case AL.BACKSPACE:AU=this.processBackspaceKeyDown(AV);break;case AL.ENTER:if(this.breakOnEnterKeyDown&&this.breakOnEnterKeyDown()){break;}case AL.TAB:this._startDebug=true;if(this.suggestionShown){this.handleSuggestionItemSelect(this.getSelected());}else{this.startTokenSuggestion();}AU=true;break;case AL.ESCAPE:this.endTokenSuggestion();AU=true;break;case 86:if(AT(AW)){this.handlePasteTriggeredDeletion();AU=false;}break;case 89:if(AT(AW)){this.widgetHandleUndoRedo("redo");AU=true;}break;case 90:if(AT(AW)){this.widgetHandleUndoRedo("undo");AU=true;}break;case 229:this.saveStateForIME();break;default:}if(AU){R.stopPropogation(window,AW);R.preventDefault(window,AW);return false;}return true;},handlePasteTriggeredDeletion:function F(){this.set("_saveRangeInfo",H.getRangeInfo());if(!this._saveRangeInfo.collapsed){this.widgetHandleDelete(this._saveRangeInfo);this.set("_saveRangeInfo",H.getRangeInfo());}this.clipboardNode.focus();},getCharacter:function AN(AU){var E=(R.isIE&&!R.isIE9)?AU.keyCode:AU.charCode;return(E>0)?String.fromCharCode(E):null;},handleCharacter:function AE(AW){var AX=this.getCharacter(AW),AU=false;if(AX&&!((AX==="c"||AX==="a")&&AT(AW))){try{this.widgetHandleInput(H.getRangeInfo(),AX);this.raiseChangeEvent({type:"input",character:AX});if(!this.isDelimiter(AX)){if(this.useKeyDelay){var AV=this;window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){AV.startTokenSuggestion();},mstrmojo.ME.MetricDataService.suggestDelay);}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(E){}AU=true;}return AU;},handlekeypress:function B(E){E=E||window.event;if(this.doubleByte){this.toggleIMEStatusBar(false);this.doubleByte=false;this.widgetHandleImeInput(this.prev_rInfo);window.setTimeout(function(){this.handleCharacter(E);}.bind(this),10);return false;}if(this.handleCharacter(E)){R.stopPropogation(window,E);R.preventDefault(window,E);return false;}return true;},handlekeyup:function g(AV){var E=AV.keyCode||AV.charCode,AU;if(E===AL.LEFT_ARROW||E===AL.RIGHT_ARROW){AU=this.findObjectToken();if(AU&&AU===this._saveActiveToken){this.startTokenSuggestion(AU);}else{this.endTokenSuggestion();}}else{if(E===AL.UP_ARROW){this.preHighlight();}else{if(E===AL.DOWN_ARROW){this.nextHighlight();}else{if(E===AL.BACKSPACE&&this.doubleByte){if(E===AL.BACKSPACE&&!this.composing&&!R.isIE9){this.doubleByte=false;this.imeBuffer.pop();this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;}}}}}this.set("_saveRangeInfo",H.getRangeInfo());},handlemouseup:function q(AW){if(this.dropCuePos){return false;}var AU=this.findObjectToken();if(AU&&AU===this._saveActiveToken){this.startTokenSuggestion(AU);}else{this.endTokenSuggestion();}var AV=H.getRangeInfo();if(this.doubleByte){this.doubleByte=false;var E=this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;AU=R.findWidget(AV.startContainer);if(AU){this._delaySetTextCaretPos(AU.domNode,AV.startOffset);}else{this._delaySetTextCaretPos(E.domNode,AV.startOffset-1);}this.prev_rInfo=AV;}this.set("_saveRangeInfo",AV);},handlepasteDirect:function AI(E){this.clipboardNode.value=E.clipboardData.getData("Text");this.handlepaste(E);R.stopPropogation(window,E);R.preventDefault(window,E);this.handlePasteTriggeredDeletion();return false;},handlepaste:function o(AY){var AU=this.clipboardNode.value;this.clipboardNode.value="";var AX=[],E=AU&&AU.length,AW,AV="",AZ;if(E>0){for(AW=0;AW<E;AW++){AZ=AU.charAt(AW);if(this.isDelimiter(AZ)){if(!mstrmojo.string.isEmpty(AV)){AX.push({v:AV,isNew:true});AV="";}AX.push({v:AZ,isDelimiter:true,isNew:true});}else{AV=AV+AZ;}}if(!mstrmojo.string.isEmpty(AV)){AX.push({v:AV,isNew:true});AV="";}this.insertTokens(AX);}},raiseChangeEvent:function(E){E.name="tokensModify";this.raiseEvent(E);},getTokensAsString:function AQ(){var AU=[],AW=this.items,AV,E;for(AV=0,E=AW.length;AV<E;AV++){AU[AV]=AW[AV].v;}return AU.join("| ");},replaceErrorToken:function t(AW){var AV=this.items||[],AX=mstrmojo.array.find(AV,"sta",-1),AU,AY=function(Ae,Ac,Af){var Ab=(Ae&&Ae.items)||[],Aa=u.find(Ab,"did",Ac),AZ,Ad;if(Aa>-1){AZ=Ab[Aa].fs;Ad=u.filterOne(AZ,function(Ag){return Ag.fnm&&Ag.fnm.toUpperCase()===Af.toUpperCase();});}return Ad;},E=function(Ae,Ac,Ad){var AZ={v:Ac.n,oi:Ac,isNew:true},Ab=Ae.v&&Ae.v.split("@"),Aa;if(Ab&&Ab.length>1){Aa=AY(Ad,Ac.did,Ab[1]);if(Aa){AZ.exv=Aa.fmdid||Aa.fid;AZ.extp=8;AZ.v=mstrmojo.ME.MetricToken.brackets(Ac.n)+"@"+Aa.fnm;}}return AZ;};if(AX>-1){AU=E(AV[AX],AW,this.candidates);this.remove(AX);this.add([AU],AX);}},widgetHandleDelete:function f(AX){if(AX.collapsed){var AW,AV,E,AY=AX.startOffset,AU=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AX.startContainer,false,document.body)){H.collapseOnNode(this.editNode,false);return ;}AW=H.getEdgeInfo(AX.startContainer,AX.startOffset);AV=R.findWidget(AX.startContainer);E=this.itemIndex(AV.data);if(AW===l.EDGE_END){E++;AV=AU[E];AY=0;}if(!AV){H.collapseOnNode(this.editNode,false);return ;}if(AV.length()===1){this.remove(E);AV=AU[E];if(AV){H.collapseOnNode(AV.domNode,true);}else{H.collapseOnNode(this.editNode,false);}this.checkMergeTwoTokens(E-1,E);}else{AV.spliceContent(AY,1);H.collapseOnTextNode(AV.domNode,AY);}}else{this.widgetDeleteTokens(AX);}},widgetHandleBackspace:function AC(AX){if(AX.collapsed){var AW,AV,E,AY=AX.startOffset,AU=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AX.startContainer,false,document.body)){if(AX.startOffset>0&&R.isFF){AV=AU[this.items.length-1];H.collapseOnNode(AV.domNode,false);AX=H.getRangeInfo();AW=H.getEdgeInfo(AX.startContainer,AX.startOffset);}else{H.collapseOnNode(this.editNode,true);return ;}}AW=H.getEdgeInfo(AX.startContainer,AX.startOffset);AV=R.findWidget(AX.startContainer);E=this.itemIndex(AV.data);if(AW===l.EDGE_BEGIN){E--;AV=AU[E];AY=AV.length();}if(!AV){H.collapseOnNode(this.editNode,true);return ;}if(AV.length()===1){this.remove(E);AV=AU[E-1];if(AV){H.collapseOnNode(AV.domNode,false);this.checkMergeTwoTokens(E-1,E);AV=AU[E-1];}else{H.collapseOnNode(this.editNode,true);}}else{AV.spliceContent(AY-1,1);H.collapseOnTextNode(AV.domNode,AY-1);}}else{this.widgetDeleteTokens(AX);}},widgetHandleInput:function AF(AY,AZ){if(!AY.collapsed){this.widgetDeleteTokens(AY);AY=H.getRangeInfo();}var AV,Aa,Ab,Ac,E,AU,AW=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AY.startContainer,false,document.body)){this.add([{v:AZ,isDelimiter:this.isDelimiter(AZ),isNew:true}],0);Aa=AW[0];H.collapseOnTextNode(Aa.domNode,1);return ;}AV=H.getEdgeInfo(AY.startContainer,AY.startOffset);Aa=R.findWidget(AY.startContainer);Ab=this.itemIndex(Aa.data);if(this.isDelimiter(AZ)){Ac={v:AZ,isDelimiter:true,isNew:true};if(AV===l.EDGE_MIDDLE){var AX=Aa.split2Tokens(AY.startOffset);this.remove(Ab);this.add([AX[0],Ac,AX[1]],Ab);Ab=Ab+1;}else{Ab=(AV===l.EDGE_BEGIN)?Ab:Ab+1;this.add([Ac],Ab);}Aa=AW[Ab];H.collapseOnTextNode(Aa.domNode,(Aa.domNode.innerText||Aa.domNode.textContent).length);}else{AU=AY.startOffset;if(Aa.isDelimiter()){E=AW[(AV===l.EDGE_BEGIN)?Ab-1:Ab+1];if(E&&!E.isDelimiter()){Aa=E;AU=(AV===l.EDGE_BEGIN)?Aa.length():0;}}if(!Aa.isDelimiter()){Aa.spliceContent(AU,0,AZ);H.collapseOnTextNode(Aa.domNode,AU+1);}else{this.add([{v:AZ,isNew:true}],(AV===l.EDGE_BEGIN)?Ab:Ab+1);Aa=AW[(AV===l.EDGE_BEGIN)?Ab:Ab+1];H.collapseOnNode(Aa.domNode,false);}}},widgetHandleImeInput:function AF(AX,AY){AY=AY||this.imeBuffer.join("");this.imeBuffer=[];this.lastImeChar=null;if(!AY){return ;}if(!AX.collapsed){this.widgetDeleteTokens(AX);AX=H.getRangeInfo();}var AV,AZ,Aa,Ab,E,AU,AW=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AX.startContainer,false,document.body)||this.items.length==0){this.clearTokens();this.add([{v:AY,isDelimiter:this.isDelimiter(AY),isNew:true}],0);AW=this.ctxtBuilder.itemWidgets;AZ=AW[0];H.collapseOnTextNode(AZ.domNode,1);this._delaySetCaretPos(AZ.domNode,false);return ;}AV=H.getEdgeInfo(AX.startContainer,AX.startOffset);AZ=R.findWidget(AX.startContainer);Aa=this.itemIndex(AZ.data);AU=AX.startOffset;if(AZ.isDelimiter()){this.clearTokens();this.add(this.prev_items);AW=this.ctxtBuilder.itemWidgets;E=AW[(AV===l.EDGE_BEGIN)?Aa-1:Aa+1];if(E&&!E.isDelimiter()){AZ=E;AU=(AV===l.EDGE_BEGIN)?AZ.length():0;}}if(!AZ.isDelimiter()){AZ.spliceContent(AU,0,AY);this._delaySetTextCaretPos(AZ.domNode,AU+AY.length);}else{this.add([{v:AY,isNew:true}],(AV===l.EDGE_BEGIN)?Aa:Aa+1);AZ=AW[(AV===l.EDGE_BEGIN)?Aa:Aa+1];this._delaySetCaretPos(AZ.domNode,false);}this.startTokenSuggestion();return AZ;},findObjectToken:function C(){var AX=H.getRangeInfo(),AV=R.findWidget(AX.startContainer);if(!R.contains(this.editNode,AX.startContainer,false,document.body)){return null;}if(!AV||AV===this||!AV.isDelimiter){return null;}if(AV&&!AV.isDelimiter()){return AV;}var AW=H.getEdgeInfo(AX.startContainer,AX.startOffset),AU=this.ctxtBuilder.itemWidgets,E=this.itemIndex(AV.data);AV=AU[(AW===l.EDGE_BEGIN)?E-1:E+1];if(AV&&!AV.isDelimiter()){return AV;}return null;},checkMergeTwoTokens:function AA(AX,AV){var AW=this.ctxtBuilder.itemWidgets,AU=AW[AX],E=AW[AV];if((AU&&!AU.isDelimiter())&&(E&&!E.isDelimiter())){this.remove([AX,AV]);this.add([AU.mergeTo(E)],AX);H.collapseOnTextNode(AW[AX].domNode,AU.length());}},insertTokens:function AH(AY){var Ab=0,Aa=this.editNode;var AV=this._saveRangeInfo||H.getRangeInfo();if(!AV||!R.contains(Aa,AV.startContainer,false,document.body)){this.add(AY);Ab=this.items.length-1;if(Ab===0){this._delaySetTextCaretPos(Aa,(Aa.innerText||Aa.textContent).length);}else{var E=this.ctxtBuilder.itemWidgets[Ab].domNode;this._delaySetTextCaretPos(E,(E.innerText||E.textContent).length);}}else{var AU=H.getEdgeInfo(AV.startContainer,AV.startOffset),AZ=R.findWidget(AV.startContainer);Ab=this.itemIndex(AZ.data);if(AU===l.EDGE_MIDDLE){var AW=AZ.split2Tokens(AV.startOffset);this.remove(Ab);AY.unshift(AW[0]);AY.push(AW[1]);this.add(AY,Ab);}else{Ab=(AU===l.EDGE_BEGIN?Ab:Ab+1);this.add(AY,Ab);}Ab=Ab+AY.length-1;AZ=this.ctxtBuilder.itemWidgets[Ab];this._delaySetCaretPos(AZ.domNode,false);}this.raiseChangeEvent({type:"insert"});var AX=this;window.setTimeout(function(){AX.set("_saveRangeInfo",H.getRangeInfo());},50);return Ab;},insertParenthesisTokens:function AK(AU){var E=this;window.setTimeout(function(){var AV=E.insertTokens([{v:"(",isDelimiter:true,isNew:true},{v:")",isDelimiter:true,isNew:true}]);E._delaySetTextCaretPos(E.itemsContainerNode.childNodes[AV-1],1);},AU||50);},clearTokens:function z(E){this.set("items",E||[]);this.set("_saveRangeInfo",null);this._delaySetCaretPos(this.editNode,false);},focus:function AG(){var AU=this.ctxtBuilder.itemWidgets,E=AU.length;this._delaySetCaretPos(E>0?AU[E-1].domNode:this.editNode,false);},startTokenSuggestion:function AM(E){this.endTokenSuggestion();if(!E){E=this.findObjectToken();}if(E&&!E.isDelimiter()){E.set("active",true);this._saveActiveToken=E;this.showSuggestion(this.getSearchPattern());}if(!E||this.getSearchPattern().length===0){this.hideSuggestion();}},browseItemVisible:true,folderLinksContextId:25,browsableTypes:[Q.TP.FOLDER,Q.TP.FACT,Q.TP.ATTR,Q.TP.FUNCTION,Q.TP.FILTER,Q.STP.PROMPT_OBJECTS,Q.TP.ATTR,Q.TP.DIM,Q.TP.METRIC,Q.TP.ROLE].join(","),getSearchPattern:function a(){var AU=this._saveActiveToken,AW=AU&&AU.data.v,E=AW&&AW.length;if(E>2){if(AW.charAt(0)==="["){AW=AW.substring(1);}if(AW.charAt(AW.length-1)==="]"){AW=AW.substring(0,AW.length-1);}}if(AU&&AU.data.ift){var AV=AU.data.v,AX=AV&&AV.indexOf("@");if(AX>=0){AW=AV.substring(AX);}}return AW||"";},getSuggestionPos:function k(){var E=this._saveActiveToken,AU=null,AW,AV;if(E){AW=E.data&&E.data.ift;AV=mstrmojo.dom.position(E.domNode,true);AU={left:Math.round(AV.x+(AW?AV.w:0))+"px",top:Math.round(AV.y+AV.h)+"px",zIndex:100};}return AU;},item2textCss:function O(AU){var E=(this._super&&this._super(AU))||{4:"m",11:"fx",12:"a",13:"fc",43:"tr",21:"afm","-99":"br"}[AU.t]||"";E+=AU.da?" da":"";E+=(AU.dm||AU.um)?" dm":"";E+=AU.de?" de":"";E+=AU.fs&&AU.fs.length&&AU.fs.some(function(AV){return AV.fgr>0;})?" g":"";return E;},onBrowserOpen:function AB(){this.editNode.blur();},onSuggestionItemSelect:function AJ(AU){var E=this._saveActiveToken;this.endTokenSuggestion();if(E){if(E.data.ift&&AU.t===21){E.setFormInfo(AU);}else{E.setItemInfo(AU);if(AU.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){this.insertParenthesisTokens();}}this._delaySetCaretPos(E.domNode,false);}this.closePopup();},_delaySetCaretPos:function AO(E,AV){var AU=this.editNode,AW=this,AX=function(){AU.focus();AU.focus();H.collapseOnNode(E,AV);AW.set("_saveRangeInfo",H.getRangeInfo());};window.setTimeout(AX,0);},_delaySetTextCaretPos:function AO(E,AX){var AU=this.editNode,AV=this,AW=function(){AU.focus();AU.focus();H.collapseOnTextNode(E,AX);AV.set("_saveRangeInfo",H.getRangeInfo());};window.setTimeout(AW,0);},getCandidatesThroughTaskCall:function d(AU,E){AU.objectType="11,12,13,43,4";AU.rootFolderType=39;AU.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AU,E);},filterCandidates:function x(AX,AW,E){var AU=this._saveActiveToken,AY=AU&&(AU.data.oi||AU.data.at),AV;if(AY&&AU.data.ift){E=E||this.suggestCount;AW=mstrmojo.string.regEscape(AW);AV=u.filter(AX,function(AZ){return AZ.t===21&&AZ.attid===AY.did&&(new RegExp("^"+AW,"i")).test("@"+AZ.n);},{max:E});}else{AV=u.filter(AX,function(AZ){return AZ.t!==21;});AV=this._super(AV,AW,E);}return AV;},endTokenSuggestion:function AP(AU){var E=this._saveActiveToken;if(E){if(AU){this.hideSuggestion();}E.set("active",false);this._saveActiveToken=null;}},widgetDeleteTokens:function p(Ac){var AU=Ac.startOffset,E=Ac.endOffset,Af=R.findWidget(Ac.startContainer),Ad=R.findWidget(Ac.endContainer),AY=this.itemIndex(Af.data),AW=this.itemIndex(Ad.data),AZ=[],Aa=H.getEdgeInfo(Ac.startContainer,AU),Ae=H.getEdgeInfo(Ac.endContainer,E),Ab=(Aa===l.EDGE_BEGIN?AY:AY+1),AV=(Ae===l.EDGE_END?AW:AW-1),AX;if(Af===Ad){if((Aa===l.EDGE_BEGIN)&&(Ae===l.EDGE_END)){this.remove(AY);Ad=this.ctxtBuilder.itemWidgets[AY===0?AY:AY-1];if(Ad){H.collapseOnNode(Ad.domNode,AY===0);}else{H.collapseOnNode(this.editNode,true);}}else{Af.spliceContent(AU,E-AU);H.collapseOnTextNode(Ad.domNode,AU);}}else{for(AX=Ab;AX<=AV;AX++){AZ.push(AX);}this.remove(AZ);if(Aa===l.EDGE_MIDDLE){Af.spliceContent(AU);}if(Ae===l.EDGE_MIDDLE){Ad.spliceContent(0,E);}if(Aa===l.EDGE_BEGIN){Af=this.ctxtBuilder.itemWidgets[AY===0?AY:AY-1];}if(Af){H.collapseOnNode(Af.domNode,AY===0);}else{H.collapseOnNode(this.editNode,false);}AY=(Aa===l.EDGE_BEGIN)?AY-1:AY;this.checkMergeTwoTokens(AY,AY+1);}this.editNode.focus();},oncandidatesChange:function w(){var AU=this.candidates,E=(AU&&AU.items)||[];if(!this.noCache&&AU&&AU.isComplete){this.suggestCount=this.REQUEST_THRESHOLD=E.length;}else{this.suggestCount=mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=20;}},nudge:function(E){var AU=this.getSuggestionPos();if(AU){E.set("left",AU.left);E.set("top",AU.top);}},pretokensModify:function P(){this.tokensCache=this.tokensCache.slice(0,this.tokensCachePointer);var E=this.findObjectToken();this.tokensCache.push({items:K.clone(this.items),rInfo:H.getRangeInfo(),idx:E!==null?this.itemIndex(E.data):-1});this.tokensCachePointer=this.tokensCache.length;},widgetHandleUndoRedo:function n(AV){var AW,E,AU=function(AY){if(!AY){return ;}AY=AY||{};this.set("items",K.clone(AY.items));var Ab=this.ctxtBuilder.itemWidgets,AX=Ab[AY.idx],Aa=AX&&AX.domNode||this.editNode,AZ=AY.rInfo;this._delaySetTextCaretPos(Aa,AZ&&AZ.startOffset||0);};switch(AV){case"undo":AW=--this.tokensCachePointer;if(AW>-1){E=this.tokensCache[AW-1];AU.call(this,E);}else{this.tokensCachePointer=1;}break;case"redo":AW=this.tokensCachePointer++;if(AW>-1&&AW<this.tokensCache.length){E=this.tokensCache[AW];AU.call(this,E);}else{this.tokensCachePointer=Math.min(Math.max(this.tokensCachePointer,1),this.tokensCache.length);}break;}},resetTokensCache:function Z(){this.tokensCache=[];this.tokensCachePointer=-1;this.tokensCacheInitilized=false;},toggleIMEStatusBar:function c(E){if((R.isIE9||R.isIE10||R.isIEW3C||R.isEdge)&&this.detectKoreanLocale()){if(E){if(!this.elStatus||!this.elStatus.offsetParent){var AU=this.elStatus=document.createElement("div");AU.innerText=mstrmojo.desc(15003,"Please enter space key to finish IME typing");AU.className="mstrmojo-TokenInputBox-status";this.domNode.appendChild(AU);}}else{this.domNode.removeChild(this.elStatus);delete this.elStatus;}}},detectKoreanLocale:function m(){var E=window.navigator;if(window.mstrConfig&&(window.mstrConfig.browserLang||[]).indexOf("ko")>=0){return true;}else{if(E.userLanguage=="ko"||E.userLanguage=="ko-KR"||E.browserLanguage=="ko"||E.browserLanguage=="ko-KR"){return true;}}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.array","mstrmojo.qb.DBTableRow");mstrmojo.requiresDescs(629,12912,12913,12914,10);var N=mstrmojo.string,Z=mstrmojo.dom,b=mstrmojo.css,K=mstrmojo.array;function C(c,e,f){var d=c.editorNode.style;e=(e<0)?0:e+"px";f=(f<0)?0:f+"px";d.left=e;c.set("left",e);c.left=e;d.top=f;c.set("top",f);c.top=f;}function A(c){var d=c.children[0].children;K.forEach(d,function(f,e){if(c.selectedIndex[e]){b.addClass(f.domNode,["selected"]);}else{b.removeClass(f.domNode,["selected"]);}});}function Y(d,c){d.canvasbox.domNode.style.width=d.maxWidth+"px";d.canvasbox.width=d.maxWidth+"px";d.linker.width=d.maxWidth;c.linkerNeedRender=true;d.linker.drawLinks();}function R(e,d,c){e.canvasbox.domNode.style.height=e.maxHeight+"px";e.canvasbox.height=e.maxHeight+"px";e.linker.height=e.maxHeight;d.linkerNeedRender=true;if(!c){e.linker.drawLinks();}}function D(d,h){var g=30,c=40,f=10,e;h=h?h+2:1;e=g*h;if(d.searchBox.visible){e+=c;}e+=f;return e;}function Q(e,f){var g=e.editorNode.style,l=parseInt(g.top),d=parseInt(g.height),k=e.container,j,c=false;if(l+d>k.maxHeight){k.maxHeight=l+d+10;j=parseInt(k.domNode.clientHeight);if(k.maxHeight>j){R(k,f,true);c=true;}else{k.domNode.scrollTop=0;}}return c;}function E(c){var d=this.Rows.children;K.forEach(d,function(e){e.domNode.firstChild.childNodes[1].style.width=(c-20)+"px";});}mstrmojo.qb.DBTable=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.DBTable",title:"",left:"",top:"",minWidth:80,maxWidth:250,maxHeight:300,minHeight:20,model:null,prevPos:{},container:null,selectedIndex:[],draggable:true,noCheckBox:true,topAnchor:function I(){return(this.titlebarNode)?parseInt(this.top,10)+(this.titlebarNode.clientHeight/2)+"px":"0px";},leftAnchor:function U(){return this.left;},rightAnchor:function W(){return(this.editorNode)?parseInt(this.left,10)+this.editorNode.clientWidth+"px":"0px";},modal:false,zIndex:7,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor mstrmojo-qb-DBTable {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mousedown,mouseup,click><div class = "mstrmojo-qb-DBTable-header" style="position:absolute;"><table cellspacing="0" cellpadding="0" class="mstrmojo-qb-DBTable-titlebar"><tr><td><input id="{@id}check" type="checkbox" mstrAttach:click></td><td><div class="mstrmojo-qb-DBTable-titleIcon"></div></td><td class="mstrmojo-Editor-titleCell"><div id="{@id}title" class="mstrmojo-qb-DBTable-title"  mstrAttach:dblclick></div></td><td><div class="mstrmojo-qb-DBTable-searchIcon" title="'+mstrmojo.desc(10,"Search")+'"></div></td><td><div class="mstrmojo-qb-DBTable-close" title="'+mstrmojo.desc(629,"Delete")+'"></div></td><td><div style="display:none;"></div></td></tr></table></div><div class="mstrmojo-Editor-titleSpacer"></div>{@titlebarHTML}<div class="mstrmojo-qb-DBTable-searchBox"></div><div class="mstrmojo-Editor-content" style="padding:0px;" mstrAttach:scroll,mouseover,mouseout></div><div class="mstrmojo-qb-table-resize-handle north" id="{@id}north" ></div><div class="mstrmojo-qb-table-resize-handle east" id="{@id}east"></div><div class="mstrmojo-qb-table-resize-handle south" id="{@id}south"></div><div class="mstrmojo-qb-table-resize-handle west" id="{@id}west"></div></div></div>',titleMarkupString:"",children:[{scriptClass:"mstrmojo.Box",alias:"Rows",cssText:"width:100%; background-color:white; border-top: 1px solid #C6C6C6; height:100%;white-space: nowrap;"},{scriptClass:"mstrmojo.TextBox",slot:"searchBoxNode",alias:"searchBox",visible:false,cssClass:"mstrmojo-qb-DBTable-searchInput",onvisibleChange:function O(e){var d=this.parent,g,k=22,j=this.visible?k:-k,c,f=mstrmojo.all.QBuilderModel,h=this;g=d.editorNode.style;g.height=parseInt(g.height)+j+"px";d.maxHeight+=j;if(this.visible){this.set("width",parseInt(g.width)-48+"px");window.setTimeout(function(){h.focus();},0);}c=Q(d,f);if(mstrApp.getRootController().hasTableJoin(d.id)||c){window.setTimeout(function(){d.container.linker.drawLinks();},0);}},onvalueChange:function P(){var p=this.parent,g,m=p.Rows.children,o,d,j=this.inputNode.value.toLowerCase(),f=0,e,l=264,n=false,h,c=mstrmojo.all.QBuilderModel;for(g=1;g<m.length;g++){o=m[g];o.set("keyword",j);if(o.text.toLowerCase().indexOf(j.toLowerCase())>=0){f++;}if(!!o.isVisibleChanged){n=true;}if(o.visible){o.set("cssClass",(f-1)%2?"odd":"even");}}if(!n){return ;}m[0].set("visible",f>0);var k=p.domNode.getElementsByClassName("no-match");if(f===0){if(k.length===0){d=document.createElement("div");d.className="no-match";d.innerText=mstrmojo.desc(15573,"No matched result");d.style.display="block";p.Rows.domNode.appendChild(d);}else{k[0].style.display="block";}}else{if(k.length>0){k[0].style.display="none";}}e=D(p,f);p.maxHeight=e;p.set("height",(e>l)?l:e);h=Q(p,c);if(n||h){p.container.linker.drawLinks();}}}],markupSlots:{editorNode:function(){return this.domNode.firstChild;},titlebarNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},checkBoxNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[0].firstChild:null;},titleIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[1].firstChild:null;},titleNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[2].firstChild:null;},helpNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[5].firstChild:null;},searchIconNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[3].firstChild:null;},closeNode:function(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild.rows[0].cells[4].firstChild:null;},searchBoxNode:function(){return this.domNode.firstChild.childNodes[2];},containerNode:function(){return this.domNode.firstChild.childNodes[3];},buttonNode:function(){return this.domNode.firstChild.childNodes[4];},curtainNode:function(){return this.domNode.lastChild;},leftanchor:function(){return this.left;}},onscroll:function(){this.parent.parent.linker.drawLinks();},premousedown:function M(d){var e=mstrmojo.dom.eventTarget(d.hWin,d.e),c;if(e===this.closeNode){if(!this.readOnly){this.close();}}else{if(e===this.searchIconNode){c=this.searchBox.visible;this.searchBox.set("visible",!c);}}},onmousedown:function(c){this.editorNode.style.zIndex=8;},onmouseup:function(c){this.editorNode.style.zIndex=7;},toggleSelect:function(c){var e,d;if(this.selectedIndex[c]){this.selectedIndex[c]=false;}else{this.selectedIndex[c]=true;}A(this);},rangeSelect:function(c){},singleSelect:function(d){var e,c;for(e=0,c=this.selectedIndex.length;e<c;e++){this.selectedIndex[e]=false;}this.selectedIndex[d]=true;A(this);},clearSelect:function(){var d,c;for(d=0,c=this.selectedIndex.length;d<c;d++){this.selectedIndex[d]=false;}A(this);},onmouseover:function(d){var c=parseInt(this.editorNode.style.height);this.containerNode.style.overflowY=(c>=this.minHeight&&c<this.maxHeight)?"auto":"hidden";this.containerNode.style.overflowX="hidden";},onmouseout:function H(){this.containerNode.style.overflow="hidden";},touchBegin:function V(d){var c=this.editorNode.style;this._tl=parseInt(c.left);this._tt=parseInt(c.top);},touchSwipeMove:function S(f){var c=mstrmojo.all.QBuilderModel,d=this.container,e=c.tables[this.id];C(this,f.delta.x+this._tl,f.delta.y+this._tt);if(e&&e.njoins>0){d.linker.drawLinks();}},addRow:function L(c,j,d,e,g){var f=this.children[0];var h={scriptClass:"mstrmojo.qb.DBTableRow",images:d,indent:j,text:c,displayText:!g?N.encodeHtmlString(c):g};f.addChildren([h]);},onclick:function(n){var h=n.hWin,j=n.e||h.event,g=j.target||j.srcElement,f=document.elementFromPoint(j.clientX,j.clientY),d=g&&g.id;if(d.replace(this.id,"")=="check"){if(this.onCheck){this.onCheck(g.checked);}}var l=Z.findWidget(f);if(!l||!l.srcData){this.clearSelect();return ;}var m=l.rIndex,k=Z.ctrlKey(h,j),o=Z.shiftKey(h,j);if(k||o){Z.clearBrowserHighlights(h);}if(k){this.toggleSelect(m);}else{this.singleSelect(m);}},ondblclick:function(d){var c=d.hWin,g=d.e||c.event,l=g.target||g.srcElement,k=l&&l.id;if(k.replace(this.id,"")=="title"){var j=Z.delta(this.titleNode,this.titlebarNode);var h=this.title,f=this.titleNode.clientWidth-6;this.openPopup("inlineTextRef",{left:j.x+"px",top:(Z.isIE?0:-1)+"px",txtConfig:{cssClass:"mstrmojo-qb-tablealias-edit",width:f+"px",value:N.decodeHtmlString(h)||"",onEnter:function(){var o=N.trim(this.value);this.parent.close({enter:true});if(o){var t=this.parent.parent;if(N.encodeHtmlString(o)!==t.title){var e=t.model;if(e&&e.tbns){var q="";if(o.match(/[~#'"?;:[\]]/)){q=mstrmojo.desc(12912,"A table alias cannot contain the following characters: ~#'\"?;:/[]");mstrmojo.alert(q);return ;}if(!o.match(/^[a-zA-Z]/)){o=o.replace(/^\S/,"L");q=mstrmojo.desc(12913,"Table alias starting with non alphabetic character will be replaced by the character L.");}var p=N.encodeHtmlString(o);if(e.tbns[o]&&(p!==t.title)){q+=mstrmojo.desc(12914,"'##' has been used as the alias of another table. Please give a new name.").replace("##",p);mstrmojo.alert(q);return ;}if(q){mstrmojo.alert(q);}}var n=N.decodeHtmlString(t.title);if(e&&e.renameTable){e.renameTable(t.id,n,o);}t.set("title",N.encodeHtmlString(o));if(t.onHeaderChange){t.onHeaderChange(n,o);}}}},onCancel:function(){this.set("value",this.parent.title);}}});}},onCheck:function(c){},postBuildRendering:function X(){if(this._super){this._super();}if(this.noCheckBox){this.checkBoxNode.style.display="none";}},getDragData:function F(c){var d=c.src,f=d.node,e=f.id;if(e){switch(e.replace(this.id,"")){case"north":case"east":case"south":case"west":return{dir:e.replace(this.id,""),startX:d.pos.x,startY:d.pos.y};break;default:break;}}else{if(this._super){return this.dropZone&&this._super(c);}}return null;},isDragValid:function B(c){return true;},ondragstart:function a(c){var f=c.src,g=f&&f.data,e=g&&g.dir;if(e){this.prevPos={x:f.pos.x,y:f.pos.y};return true;}else{if(this._super){return this._super(c);}}},ondragmove:function J(l){var p=l.src,AJ=p&&p.data,x=AJ&&AJ.dir,t,u,f,z,c,j,AD,o,m,AA,AF,n,AH,AI,AB,k,AC,AE;c=this.container;j=mstrmojo.all.QBuilderModel;if(x){switch(x){case"north":case"south":AD=l.tgt;m=AD.pos.y-this.prevPos.y;m=(x==="north")?m:-m;this.prevPos=AD.pos;AA=this.editorNode.style;if(parseInt(AA.height)-m>=this.minHeight&&parseInt(AA.height)-m<=this.maxHeight){t=parseInt(AA.top);if(x==="north"){t+=m;if(t<0){t=0;}AA.top=t+"px";this.top=AA.top;}u=parseInt(AA.height)-m;AA.height=u+"px";this.containerNode.style.height=u-this.titlebarNode.clientHeight-1-(this.searchBox.visible?this.searchBoxNode.clientHeight:0)+"px";if(t+u>c.maxHeight){c.maxHeight=t+u+10;AF=parseInt(c.domNode.clientHeight);if(c.maxHeight>AF){R(c,j);}else{c.domNode.scrollTop=0;}}}break;case"east":case"west":AD=l.tgt;k=this.noCheckBox?57:77;o=AD.pos.x-this.prevPos.x;o=(x==="east")?o:-o;this.prevPos=AD.pos;AA=this.editorNode.style;if(parseInt(AA.width)+o>=this.minWidth&&parseInt(AA.width)+o<=this.maxWidth){f=parseInt(AA.left);if(x==="west"){f-=o;if(f<0){f=0;}AA.left=f+"px";this.left=AA.left;}z=parseInt(AA.width)+o;AA.width=z+"px";this.titleNode.style.width=z-k+"px";this.titlebarNode.style.width=z+"px";if(this.searchBox.visible){this.searchBox.set("width",z-48+"px");}if(f+z>c.maxWidth){c.maxWidth=f+z+10;n=parseInt(c.domNode.clientWidth);if(c.maxWidth>n){Y(c,j);}else{c.domNode.scrollLeft=0;}}E.call(this,z);}break;}c.linker.drawLinks();}else{AF=parseInt(c.domNode.clientHeight);n=parseInt(c.domNode.clientWidth);AH=l.tgt.pos;p=l.src.pos;o=AH.x-p.x;m=AH.y-p.y;AA=this.getMovingTarget().style;AI=this._leftPos+o;AB=this._topPos+m;AI=(AI<0)?0:AI;AB=(AB<0)?0:AB;var q=true,AK=true,AG=c.canvasbox.children;for(AC=0,AE=AG.length;AC<AE;AC++){if(!AG[AC].visible){continue;}if(this.id!=AG[AC].id&&AI+this.editorNode.clientWidth<parseInt(AG[AC].left)+AG[AC].editorNode.clientWidth){q=false;break;}}if(q){c.maxWidth=AI+this.editorNode.clientWidth;if(c.maxWidth>n){Y(c,j);}}for(AC=0,AE=AG.length;AC<AE;AC++){if(!AG[AC].visible){continue;}if(this.id!=AG[AC].id&&AB+this.editorNode.clientHeight<parseInt(AG[AC].top)+AG[AC].editorNode.clientHeight){AK=false;break;}}if(AK){c.maxHeight=AB+this.editorNode.clientHeight+10;if(c.maxHeight>AF){R(c,j);}}AA.left=AI+"px";AA.top=AB+"px";this.top=AB+"px";this.left=AI+"px";var g=j.tables[this.id];if(g&&g.njoins>0){c.linker.drawLinks();}if(c.maxWidth<=n){c.domNode.scrollLeft=0;}if(c.maxHeight<=AF){c.domNode.scrollTop=0;}}},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"containerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var e=this.txt,f=this.txtConfig;if(f){for(var d in f){e.set(d,f[d]);}}e.domNode.style.width=e.width;e.focus();},onClose:function(c){if(!c||(!c.cancel&&!c.enter)){this.txt.onEnter();}}},_set_height:function(f,e){var d=this.searchBox.visible?this.searchBoxNode.clientHeight:0;if(this.editorNode&&parseInt(e)>this.titlebarNode.clientHeight+d){var c=this.editorNode.style;c.height=parseInt(e)+"px";this.containerNode.style.height=parseInt(c.height)-this.titlebarNode.clientHeight-1-d+"px";}},useRichTooltip:true,showTooltip:function G(d,g){var f=mstrmojo.dom;var e=d.target||f.eventTarget(d.hWin,d.e);if(e.className&&((e.className==="mstrmojo-qb-DBTable-title")||(e.className==="mstrmojo-qb-DBTable-titleIcon"))){e=e.parentNode.parentNode.parentNode.children[0].children[2].children[0];var c=f.position(e);this.set("richTooltip",{posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:e.textContent,top:c.y+c.h+5,left:c.x});mstrmojo._HasTooltip.showTooltip.call(this,d,g);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.ToolbarConfig");mstrmojo.vi.ui.toolbars._HasToolbar=mstrmojo.provide("mstrmojo.vi.ui.toolbars._HasToolbar",{_mixinName:"mstrmojo.vi.ui.toolbars._HasToolbar",preBuildRendering:function A(){this.generateToolbar();return this._super();},generateToolbar:function B(){this.passToolbarCfg(this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));},updateToolbar:function D(E){if(this._super){E=this._super(E);}return E;},passToolbarCfg:function C(E){var F=this.toolbar.toolbarCfg;if(F){F.destroy();}this.toolbar.set("toolbarCfg",E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi._MonitorsAppState","mstrmojo.EditableLabel","mstrmojo.vi.ui.toolbars.TitleToolbar");var J=mstrmojo.dom;mstrmojo.vi.ui.TitleBar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.TitleBar",markupString:'<div id="{@id}" class="mstrmojo-VITitleBar {@cssClass}" style="{@cssText}" mstrAttach:contextmenu,click><div class="left-toolbar"></div><div class="title-text"></div><div class="right-toolbar"></div></div>',markupSlots:{leftToolNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.childNodes[1];},rightToolNode:function(){return this.domNode.lastChild;},containerNode:function(){return this.domNode;}},markupMethods:{onhasContextMenuButtonChange:function(){var P=this.hasContextMenuButton;this.tbToolbar.set("visible",P);this.tbToolbar.set("enabled",P);},ontitleChange:function(){this.lblTitle.set("text",this.title||" ");},ontoolbarCfgChange:function(){var P=this.toolbarCfg;if(!P){return ;}this.tbToolbar.set("toolbarCfg",P);this.doLayout();},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{leftToolNode:"auto",textNode:"100%",rightToolNode:"auto"},h:{leftToolNode:"100%",textNode:"100%",rightToolNode:"100%"},xt:true},lblTitle:null,tbToolbar:null,hasContextMenuButton:true,editTitleOnClick:false,editTitleOnDoubleClick:true,editTitleOnTwoClicks:false,title:"",close:mstrmojo.emptyFn,toolbarCfg:null,beganEditingTitlebar:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,useRichTooltip:true,init:function O(P){this._super(P);this.addChildren([].concat(this.getLeftToolbarChildren()).concat(this.getTitleChildren()).concat(this.getRightToolbarChildren()));},shouldShowTooltip:function K(P,R){var Q=P.target||J.eventTarget(P.hWin,P.e);return Q===this.textNode.firstChild&&(Q.scrollWidth>Q.clientWidth);},getTooltipContent:function L(P){var R=P.target||J.eventTarget(P.hWin,P.e),Q=R.innerHTML;return Q;},showTooltip:function M(P,Q){if(this.shouldShowTooltip(P,Q)){this._super(P,Q);}},updateTooltipConfig:function I(Q){var R=Q.target||J.eventTarget(Q.hWin,Q.e),P=J.position(R);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.getTooltipContent(Q),top:P.y+P.h+3,left:P.x+4,cssClass:"vi-regular vi-tooltip-A"};},getLabelNode:function C(){return this.lblTitle.domNode;},getMenuConfig:function B(){var P=this.toolbarCfg;if(P){if(P.hasMenuItems()){return P;}}return null;},setToolbarVisibility:function D(P){this.tbToolbar.set("visible",P);},editTitle:function N(){this.lblTitle.set("isEditing",true);},onAppStateChange:function F(P){var Q=this.lblTitle,R=mstrApp.isAppStatePresentation(),S=!!(P.valueWas&mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION);if(R&&this._confgTitleEditable===undefined){this._confgTitleEditable=this.editTitleOnClick||this.editTitleOnDoubleClick||this.editTitleOnTwoClicks;}Q.set("isEditing",false);if(R||S){Q.set("editOnDoubleClick",!R&&this._confgTitleEditable);}},getLeftToolbarChildren:function A(){},getTitleChildrenLayoutOffsets:function H(){return{h:2,w:2};},getTitleChildren:function G(){return[{scriptClass:"mstrmojo.EditableLabel",slot:"textNode",alias:"lblTitle",bindings:{editOnClick:"this.parent.editTitleOnClick",editOnDoubleClick:"this.parent.editTitleOnDoubleClick",selectable:"this.isEditing",editOnTwoClicks:"this.parent.editTitleOnTwoClicks"},onTextEditBegin:function(){this.parent.beganEditingTitlebar();},onTextEditComplete:function(R,Q){this.parent.titleEdited(this.text,R,Q);},getLayoutOffsets:function P(){return this.parent.getTitleChildrenLayoutOffsets();}}];},getRightToolbarChildren:function E(){return[{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",slot:"rightToolNode",alias:"tbToolbar",visible:true,useRichTooltip:true,bindings:{hasContextMenuButton:"this.parent.hasContextMenuButton",}}];}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.fx","mstrmojo.locales","mstrmojo.expr","mstrmojo.Button","mstrmojo.date","mstrmojo.ui.editors.controls.Stepper","mstrmojo.css");var AG=function(){return mstrmojo.locales.datetime;},k=mstrmojo.dom,j=mstrmojo.expr,AD=j.DTP,a=mstrmojo.date,J=mstrmojo.publisher,f=mstrmojo.hash,m=mstrmojo.array,N=m.removeIndices,l=mstrmojo.css;var AF=0,C=3,M=4,p=5,Q=6;var AH="month",d="day",W="year",Y="hour",AK="minute",AA="second";var G='<table border="0" cellpadding="0" cellspacing="0">',z="</table>";function O(AL){return'<table border="0" cellpadding="0" cellspacing="0" style="'+AL+'">';}function H(AO,AL,AM){var AN=a.getFirstDateOfMonth(AO,AL);return(AN.getDay()-AM+8)%7;}function n(AO){var AN=a.parseDateAndOrTime(AO),AP,AL,AM;if(AN){AM={};AP=AN.date;AL=AN.time;if(AP){f.copy(AP,AM);}if(AL){f.copy(AL,AM);}}return AM;}function F(AM,AP,AO,AN,AL){var AQ=a.formatDateInfo({day:AM,month:AP,year:AO},AG().DATEOUTPUTFORMAT);return a.inDateTimeRange(AQ,AN,AL)===0;}function U(AP,AO,AN){var AM=AP.decreaseButton,AL=AP.increaseButton,AQ="mstrmojo-Calendar";AM.className=(AQ+"-decrease");AL.className=(AQ+"-increase");}function X(AP,AM,AR,AO){var AN=0,AL=AP.length,AQ;for(AN=0;AN<AL;AN++){AQ=AP[AN];if(AQ&&AQ.day===AM&&AQ.month===AR&&AQ.year===AO){return AN;}}return -1;}function q(AL,AN,AM){var AO=new Date();return(AO.getFullYear()===AM)&&((AO.getMonth()+1)===AN)&&(AO.getDate()===AL);}function x(AS,AT){var AX=AS.dayView.getElementsByTagName("div"),AV=AS.selectedDates,AN=AV[AT],AW=AS.browseYear,AM=AS.browseMonth,AP=a.getDaysOfMonth(AW,AM),AO=a.getPreMonth(AW,AM),AR=a.getDaysOfMonth(AO.y,AO.m),AL=H(AW,AM,AS.firstDayOfWeek),AQ=((AN.month===AM)?AN.day+AL-1:(AN.month>AM?AN.day+AL+AP-1:AL-AR+AN.day-1)),AU=AX[AQ];if(AU){c(AU,AS,false);}N(AV,AT,1);}function B(AL){var AM=AL.selectedDates;while(AM.length){x(AL,0);}}function AJ(AN,AL){var AM=K(AN,AL),AO=AN.selectedDates;AO.push({day:AM.d,month:AM.m,year:AM.y});c(AL,AN,true);}function o(AN,AO){if(!AO||!AO.length){return null;}var AQ=AN.selectedDates;for(var AM=0,AL=AO.length;AM<AL;AM++){var AP=AO[AM],AR=t(AN,AP);AQ.push({day:AP.d,month:AP.m,year:AP.y});if(AR){c(AR,AN,true);}}}function t(AT,AV){var AX=AT.dayView.getElementsByTagName("div"),AO=AX.length,AW=AT.browseYear,AM=AT.browseMonth,AP=a.getPreMonth(AW,AM),AQ=a.getDaysOfMonth(AP.y,AP.m),Ab=a.getNextMonth(AW,AM),AN=a.getDaysOfMonth(AW,AM),AL=H(AW,AM,AT.firstDayOfWeek);var AR=AL>0?{y:AP.y,m:AP.m,d:AX[0].innerHTML}:{y:AW,m:AM,d:AX[0].innerHTML},AZ=(AX.length-AN-AL)>0?{y:Ab.y,m:Ab.m,d:AX[AO-1].innerHTML}:{y:AW,m:AM,d:AX[AO-1].innerHTML},Aa=S(AR,AV),AS=S(AV,AZ),AU=null;if(Aa>=0&&AS>=0){var AY=0;if(Aa<AL){AY=-1;}if(AS<(AX.length-AL-AN)){AY=1;}AU=((AY===0)?AV.d+AL-1:(AY===1?AV.d+AL+AN-1:AL-AQ+AV.d-1));return AX[AU];}else{return null;}}function g(AT,AL){var AV=AT.selectedDates,AN=AV.length;if(!AN){return null;}var AM=AV[AN-1],AO=K(AT,AL),AY=S({y:AM.year,m:AM.month,d:AM.day},AO),AZ=[],AQ=AY>0,AW=Math.abs(AY);for(var AS=0;AS<=AW;AS++){var AR=new Date(AO.y,AO.m-1,AO.d);AR.setDate(AR.getDate()+(AQ?-AS:AS));var AX=AR.getFullYear(),AP=AR.getMonth()+1,AU=AR.getDate();if(AT.isDateDisabled(AU,AP,AX,AT.min,AT.max)&&!AT.canSelectDisabledDate){continue;}AZ.push({y:AX,m:AP,d:AU});}return AZ;}function S(AO,AN){var AL=new Date(AO.y,AO.m-1,AO.d),AM=new Date(AN.y,AN.m-1,AN.d);return(AM-AL)/1000/3600/24;}function K(AN,AL){var AO=AN.browseYear,AQ=AN.browseMonth,AP=parseInt(AL.innerHTML,10),AR=parseInt(AL.getAttribute("m"),10),AM=null;AM=(AR===0)?{y:AO,m:AQ}:(AR===1?a.getNextMonth(AO,AQ):a.getPreMonth(AO,AQ));AM.d=AP;return AM;}function h(AL){var AN=AL.selectedDates,AM=AN.length;return(AM===0)?null:AN[AM-1];}function c(AM,AN,AL){var AO=AN.selectedColor;l.toggleClass(AM,["selected",AN.selectedCssStyle],AL);AM.parentNode.style.backgroundColor=AL?AO:"";AM.style.backgroundColor=AL?AO:"";}function AC(AL){return AL.selectedColor?('style="background-color:'+AL.selectedColor+';"'):"";}function P(AL){return(AL.tagName.toLowerCase()==="td")?AL.firstChild:AL;}function R(AM,AN){var AO=a.getDateJson(AM),AL=a.formatDateInfo(AO,mstrmojo.locales.datetime.DATEOUTPUTFORMAT);if(AN===AD.TIMESTAMP){AL+=" "+a.formatTimeInfo(this.timeVal,mstrmojo.locales.datetime.TIMEOUTPUTFORMAT);}return AL;}function u(AQ,AN){var AL=this.advancedValues,AM=null;AL.set(AQ,AN);switch(AL.baseDate){case C:AM=new Date();break;case M:break;case p:break;case Q:break;default:return ;}var AO=AL.monthsToAdjust;if(AO>0){AM.setMonth(AM.getMonth()+(AL.toAddMonths?AO:-AO));}var AP=AL.daysToAdjust;if(AP>0){AM.setDate(AM.getDate()+(AL.toAddDays?AP:-AP));}this.set("value",R.call(this,AM,this.dtp));}function V(){var AL=this.advancedValues,AM=["isDyn"];if(AL.baseDate===AF){return null;}AM.push(AL.baseDate);AM.push(AL.toAddDays?AL.daysToAdjust:-AL.daysToAdjust);AM.push(AL.toAddMonths?AL.monthsToAdjust:-AL.monthsToAdjust);AM.push(0);AM.push(0);AM.push(0);AM.push(0);AM.push(this.value);AM.push(this.timeVal.hour);AM.push(this.timeVal.min);AM.push(this.timeVal.sec);return AM.join("::");}function AI(AL){if(AL.value!==undefined&&this.hasRendered){this.updateSelectedDate();}}function I(AN,AM){var AO=this,AL=function(AP){return AP[0].toUpperCase()+AP.substring(1);};return{scriptClass:"mstrmojo.HBox",cssClass:"dateAdjustBox",alias:AN+"AdjustBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:AM>0?0:1,onitemSelected:function(AQ,AP){u.call(AO,"toAdd"+AL(AN),AP===0);},items:[{did:0,n:mstrmojo.desc(9424,"plus")},{did:1,n:mstrmojo.desc(9425,"minus")}]},{scriptClass:"mstrmojo.ui.editors.controls.Stepper",width:null,height:null,provider:new mstrmojo.NumStepperContentProvider({item:{interval:1,min:0,value:Math.abs(AM)},onTraverse:function(){u.call(AO,AN+"ToAdjust",this.curVal);}})},{scriptClass:"mstrmojo.Label",text:AN==="days"?mstrmojo.desc(707,"Days"):mstrmojo.desc(710,"Months")}]};}function Z(){this.buttonsNode.style.display=(this.wasAdvanced||this.changeValueOnOK||(this.showAdvanced&&this.isAdvanced)?"block":"none");this.advancedNode.style.display=this.showAdvanced?"block":"none";}mstrmojo.Calendar=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Calendar",cssPrefix:"",browseMonth:null,browseYear:null,yearRangStart:null,selectedDates:null,selectedColor:"",isMultiSelect:false,hilightToday:false,yearViewSize:5,cssTextDay:"",cssTextMonth:"",cssTextYear:"",cssTextWeekDay:"",cssTextHeader:"",cssTextMonthYearLabel:"",forceNonEmptySelection:false,showCurMonthDatesOnly:false,currentView:d,duration:600,timeDelimiter:":",dtp:AD.DATE,value:"",firstDayOfWeek:1,changeValueOnOK:false,wasAdvanced:false,showAdvanced:false,isAdvanced:false,dynDateValue:null,canSelectDisabledDate:false,monthNames:function(AL){return AG().MONTHNAME_SHORT[AL];},dayNames:function(AL){return AG().dayShortNames[AL];},min:null,max:null,supportedViews:{day:true,month:true,year:true,hour:true,minute:true,second:true},sDirMatrix:{day:{month:"down",year:"down",hour:"up",minute:"up",second:"up"},month:{day:"up",year:"left",hour:"up",minute:"up",second:"up"},year:{day:"up",month:"right",hour:"up",minute:"up",second:"up"},hour:{day:"down",month:"down",year:"down",minute:"left",second:"left"},minute:{day:"down",month:"down",year:"down",hour:"right",second:"left"},second:{day:"down",month:"down",year:"down",hour:"right",minute:"right"}},markupString:'<div id="{@id}" class="{@cssPrefix} mstrmojo-Calendar {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,mouseover,mouseout><div class="mstrmojo-Calendar-header" style="{@cssTextHeader}"><div class="mstrmojo-Calendar-decrease"></div><div class="mstrmojo-Calendar-increase"></div><div class="mstrmojo-Calendar-title"><span class="mstrmojo-Calendar-monthLabel" style="{@cssTextMonthYearLabel}">{@browseMonth}</span><span class="mstrmojo-Calendar-yearLabel" style="{@cssTextMonthYearLabel}">{@browseYear}</span></div></div><div class="mstrmojo-Calendar-body" style="{@cssTextBody}"><div class="mstrmojo-Calendar-dayView"></div></div><div class="mstrmojo-Calendar-timePart"><span class="mstrmojo-Calendar-hourLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-minuteLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-secondLabel">00</span><span class="mstrmojo-Calendar-AMPMLabel">AM</span></div><div class="mstrmojo-Calendar-advanced"></div><div class="mstrmojo-Calendar-buttons cf"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onbrowseMonthChange:function(){this.monthLabel.innerHTML=this.monthNames(this.browseMonth-1);},onbrowseYearChange:function(){this.yearLabel.innerHTML=this.browseYear;},ondtpChange:function(){this.timePart.style.display=(this.dtp===AD.TIMESTAMP||this.dtp===AD.TIME)?"block":"none";this.advancedNode.style.display=this.showAdvanced?"block":"none";},onvalueChange:function(){if(this.lastValue===undefined||this.value!==this.lastValue){this.updateSelectedDate();}},onchangeValueOnOKChange:Z,onisAdvancedChange:Z},markupSlots:{monthLabel:function(){return this.domNode.firstChild.lastChild.firstChild;},yearLabel:function(){return this.domNode.firstChild.lastChild.lastChild;},decreaseButton:function(){return this.domNode.firstChild.firstChild;},increaseButton:function(){return this.domNode.firstChild.childNodes[1];},bodyContainer:function(){return this.domNode.childNodes[1];},dayView:function(){return this.domNode.childNodes[1].firstChild;},monthView:function(){return this.domNode.childNodes[1].firstChild;},yearView:function(){return this.domNode.childNodes[1].firstChild;},hourView:function(){return this.domNode.childNodes[1].firstChild;},minuteView:function(){return this.domNode.childNodes[1].firstChild;},secondView:function(){return this.domNode.childNodes[1].firstChild;},timePart:function(){return this.domNode.childNodes[2];},hourLabel:function(){return this.domNode.childNodes[2].firstChild;},minuteLabel:function(){return this.domNode.childNodes[2].childNodes[2];},secondLabel:function(){return this.domNode.childNodes[2].childNodes[4];},AMPMLabel:function(){return this.domNode.childNodes[2].childNodes[5];},advancedNode:function(){return this.domNode.childNodes[3];},buttonsNode:function(){return this.domNode.childNodes[4];}},init:function AE(AL){if(this._super){this._super(AL);}if(this.duration<1){this.duration=1;}if(!this.selectedDates){this.selectedDates=[];}this.timeVal={hour:0,min:0,sec:0};},ondynDateValueChange:function w(AL){if(AL.value!==undefined&&this.hasRendered){this.updateSelectedDate();this.buildChildren();}},onminChange:AI,onmaxChange:AI,buildChildren:function b(){var AR=this;if(this.showAdvanced){var AO=this.dynDateValue,AN=this.advancedValues||this.addDisposable(new mstrmojo.Model({})),AU=AO&&AO.split("::")||[],AQ=AU[1]||AF,AM=AU[2]||0,AV=AU[3]||0,AS=function AS(){if(AR.isAdvanced){AR.wasAdvanced=true;AR.changeValueOnOK=true;}AR.set("isAdvanced",!AR.isAdvanced);mstrmojo.css.toggleClass(AR.markupSlots.dayView.call(AR),["ddSelected"],AR.isAdvanced);u.call(AR,"baseDate",AR.isAdvanced?3:0);if(AR.parent&&AR.parent.nudge&&AR.isAdvanced){AR.parent.nudge();}};this.advancedValues=AN;AN.baseDate=parseInt(AQ);AN.toAddDays=AM>=0;AN.daysToAdjust=Math.abs(AM);AN.toAddMonths=AV>=0;AN.monthsToAdjust=Math.abs(AV);this.isAdvanced=!!this.dynDateValue;if(this.domNode){mstrmojo.css.toggleClass(this.markupSlots.dayView.call(this),["ddSelected"],this.isAdvanced);}if(this.isAdvanced&&this.value){var AL=n(this.value),AP=this.timeVal;if(AL&&AL.hour!==undefined){AP.hour=AL.hour;AP.min=AL.min;AP.sec=AL.sec;}}u.call(AR,"baseDate",this.isAdvanced?3:0);this.destroyChildren(false);this.addChildren([{scriptClass:"mstrmojo.HBox",alias:"checkLabel",slot:"advancedNode",children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"checkbox",checked:!!AR.isAdvanced,oncheckedChange:AS},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13844,"Dynamic Date"),onclick:function AT(){this.parent.checkbox.onclick();}}]},{scriptClass:"mstrmojo.Box",alias:"advancedPanel",slot:"advancedNode",bindings:{visible:"this.parent.isAdvanced"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9423,"Today"),cssClass:"tdLabel"},I.call(this,"days",AM),I.call(this,"months",AV)]},]);}else{this.destroyChildren(false);}this.addChildren([mstrmojo.Button.newWebButton(mstrmojo.desc(2140,"Cancel"),function(){AR.parent.close();},false,{slot:"buttonsNode"}),mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){if(AR.changeValueOnOK||AR.isAdvanced||AR.wasAdvanced){AR.updateValue(true);}},true,{slot:"buttonsNode"})]);},preBuildRendering:function A(){this.buildChildren();return this._super();},getSelectedDatesAsString:function E(AM){var AL=[];m.forEach(this.selectedDates,function(AN){AL.push(a.formatDateInfo(AN,AM||AG().DATEOUTPUTFORMAT));});return AL;},updateSelectedDate:function L(AQ){var AL=this.value,AN=this.timeVal,AP=this.selectedDates,AO,AR=function(AT,AS){AT.set("browseYear",AS.year);AT.set("browseMonth",AS.month);AT.updateTimePart();AT.updateView(AT.currentView);if(!AT.changeValueOnOK&&AT.hasRendered&&AT.closeOnValueChange!=true){AT.updateValue();}};if(this.wasAdvanced){this.wasAdvanced=false;this.changeValueOnOK=false;}if(AL){AO=n(AL);if(AO&&AO.hour!==undefined){AN.hour=AO.hour;AN.min=AO.min;AN.sec=AO.sec;if(this.dtp===AD.TIME&&(AO.year===undefined||AO.month===undefined||AO.day===undefined)){var AM=a.getDateJson(new Date());AO.year=AM.year;AO.month=AM.month;AO.day=AM.day;}}}if((AO&&!this.isMultiSelect)||AQ){B(this);}if(AP.length===0){if(!AO){if(this.parent.opener&&this.parent.opener.defaultDate){AO=n(this.parent.opener.defaultDate);}else{AO=a.getDateJson(new Date());}}if(!this.canSelectDisabledDate&&this.isDateDisabled(AO.day,AO.month,AO.year,this.min,this.max)){if(this.min&&a.compareDate(AO,this.min)<0){AO=n(this.min);}else{if(this.max&&a.compareDate(AO,this.max)>0){AO=n(this.max);}}}AP.push(AO);AR(this,AO);}else{AO=AP[0];if(this.value!==null){AR(this,AO);}}},updateValue:function e(AL){var AN=h(this),AM="";if(AN){AM=a.formatDateInfo(AN,AG().DATEOUTPUTFORMAT);if(this.dtp!==AD.DATE){var AO=a.formatTimeInfo(this.timeVal,AG().TIMEOUTPUTFORMAT);if(this.dtp===AD.TIME){AM=AO;}else{AM+=" "+AO;}}}this.lastValue=AM;this.set("value",AM);if(this.showAdvanced){this.set("dynDateValue",AL?V.call(this):null);}if(this.onValueUpdate){this.onValueUpdate();}},updateTimePart:function AB(){var AM=this.timeVal,AL=AM.hour||0,AN=(AL%12===0)?12:(AL%12);this.hourLabel.innerHTML=AN;this.minuteLabel.innerHTML=a.formatInteger(AM.min||0,2);this.secondLabel.innerHTML=a.formatInteger(AM.sec||0,2);this.AMPMLabel.innerHTML=AL<12?" "+AG().AM_NAME:" "+AG().PM_NAME;},premousedown:function(AL){var AN=AL.e,AM=k.eventTarget(AL.hWin,AN);if(AM===this.decreaseButton||AM===this.increaseButton){if(k.isFF){k.stopPropogation(window,AN);}return true;}else{return this.processEvent(AM,AN);}},premouseup:function(AL){var AN=AL.e;if(AN.ctrlKey||AN.shiftKey){k.clearBrowserHighlights();}var AM=k.eventTarget(AL.hWin,AN);if(AM===this.decreaseButton&&!AM.disabled){this.decrease();return true;}if(AM===this.increaseButton&&!AM.disabled){this.increase();return true;}},processEvent:function(AW,Ad){var AO=this.currentView,AP=this.selectedDates,AT,AY,Ae,AL,AV;if(AW===this.monthLabel){if(AO!==AH){this.switchViewTo(AH);}return true;}if(AW===this.yearLabel){if(AO!==W){this.adjustYearStart();this.switchViewTo(W);return true;}}if(AW===this.hourLabel){if(AO!==Y){this.switchViewTo(Y);}return true;}if(AW===this.minuteLabel){if(AO!==AK){this.switchViewTo(AK);}return true;}if(AW===this.secondLabel){if(AO!==AA){this.switchViewTo(AA);}return true;}if(AW===this.AMPMLabel){if(AO!==Y){this.switchViewTo(Y);}return true;}if(AO===Y){var AR=AW.getAttribute("h");AV=parseInt(AW.innerHTML,10);if(!isNaN(AR)&&!isNaN(AV)){AR=parseInt(AR,10);this.timeVal.hour=AV%12+AR*12;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AO===AK){AV=parseInt(AW.innerHTML,10);if(!isNaN(AV)){this.timeVal.min=AV;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AO===AA){AV=parseInt(AW.innerHTML,10);if(!isNaN(AV)){this.timeVal.sec=AV;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AO===d){var Ac=this.browseYear,AM=this.browseMonth,AN;AW=P(AW);Ae=parseInt(AW.innerHTML,10);AL=parseInt(AW.getAttribute("m"),10);if(!isNaN(Ae)&&!isNaN(AL)){AN=(AL===0)?{y:Ac,m:AM}:(AL===1?a.getNextMonth(Ac,AM):a.getPreMonth(Ac,AM));if((!this.canSelectDisabledDate&&this.isDateDisabled(Ae,AN.m,AN.y,this.min,this.max))||Ad.button===2){return true;}if(this.isAdvanced){return true;}var AZ=X(AP,Ae,AM,Ac),AX=AP.length>1,AU=this.forceNonEmptySelection,Aa=this.isMultiSelect,AS=Aa&&Ad.ctrlKey,Ab=Aa&&Ad.shiftKey,AQ=null;if(Ab){AQ=g(this,AW);B(this);o(this,AQ);}else{if(AS){if(AZ===-1){AJ(this,AW);}else{if(!AU||AX){x(this,AZ);}}}else{B(this);if(AX||AZ===-1||AU){AJ(this,AW);}}}if(this.onselect||J.hasSubs(this.id,"select")){this.raiseEvent({name:"select",value:this.selectedDates});}if(AL===1){this.increase();}else{if(AL===-1){this.decrease();}}if(!this.changeValueOnOK){this.updateValue();}else{if(this.showAdvanced){this.checkLabel.checkbox.set("checked",false);u.call(this,"baseDate",0);}}}return true;}if(AO===AH){AW=P(AW);AY=parseInt(AW.getAttribute("m"),10);if(!isNaN(AY)){this.set("browseMonth",AY+1);this.switchViewTo(d);}return true;}if(AO===W){AW=P(AW);AT=parseInt(AW.innerHTML,10);if(!isNaN(AT)){this.set("browseYear",AT);this.switchViewTo(d);}return true;}return true;},decrease:function(){var AN=this.currentView,AQ=AN,AP=this.browseYear,AL=this.browseMonth,AM=this.yearRangStart,AO;switch(AN){case d:AO=a.getPreMonth(AP,AL);this.set("browseMonth",AO.m);this.set("browseYear",AO.y);break;case AH:this.set("browseYear",AP-1);break;case W:this.yearRangStart=AM-this.yearViewSize*this.yearViewSize;break;case Y:AQ=AA;break;case AK:AQ=Y;break;case AA:AQ=AK;break;}this.switchViewTo(AQ,"right");},increase:function(){var AN=this.currentView,AQ=AN,AP=this.browseYear,AL=this.browseMonth,AM=this.yearRangStart,AO;switch(AN){case d:AO=a.getNextMonth(AP,AL);this.set("browseMonth",AO.m);this.set("browseYear",AO.y);break;case AH:this.set("browseYear",AP+1);break;case W:this.yearRangStart=AM+this.yearViewSize*this.yearViewSize;break;case Y:AQ=AK;break;case AK:AQ=AA;break;case AA:AQ=Y;break;}this.switchViewTo(AQ,"left");},updateView:function(AL){var AM=this[AL+"ViewHTML"]();this[AL+"View"].innerHTML=AM;},adjustYearStart:function(){this.yearRangStart=this.browseYear-10-this.browseYear%5;},switchViewTo:function(AM,AO){var AS="mstrmojo-Calendar-"+AM+"View",AR=document.createElement("div"),AL=this[this.currentView+"View"],AP=AM+"ViewHTML",AQ=this[this.currentView+"Label"],AN=this[AM+"Label"];if(!this.supportedViews[AM]){return ;}if(!AO){AO=this.sDirMatrix[this.currentView][AM];}AR.className=AS;AR.innerHTML=this[AP]();this.currentView=AM;this[AM+"View"]=AR;mstrmojo.css.toggleClass(AR,["ddSelected"],this.isAdvanced);this._slideIntoView(AL,AR,AO);},_slideIntoView:function(AP,AT,AN){var AL=this.bodyContainer,AR=(AN==="left"||AN==="right")?AP.offsetWidth:AP.offsetHeight,AM=(AN==="left"||AN==="right")?"left":"top",AS=(AN==="left"||AN==="up")?AR:-AR,AQ=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AP,onEnd:function(){AL.removeChild(AP);}}),AO=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AT});AT.style[AM]=AS+"px";AL.appendChild(AT);AQ.props[AM]={start:0,stop:-AS,suffix:"px"};AO.props[AM]={start:AS,stop:0,suffix:"px"};AQ.play();AO.play();},dayViewHTML:function(){var AQ=this.browseYear,AT=this.browseMonth,AY=a.getDaysOfMonth(AQ,AT),Ac=a.getPreMonth(AQ,AT),AN=a.getDaysOfMonth(Ac.y,Ac.m),AM=a.getNextMonth(AQ,AT),AU=H(AQ,AT,this.firstDayOfWeek),AR=[],AO=AC(this),Ae=0,AL=this.selectedDates,AW=this.min,Aa=this.max,Af,AX,Ab,AZ,Ad=this.showCurMonthDatesOnly?'style="visibility:hidden;"':"";U(this,{d:AN,m:Ac.m,y:Ac.y},{d:1,m:AM.m,y:AM.y});AR.push(O(this.cssTextDay));AR.push(this._dayViewTHead());AR.push("<tr>");for(Ab=0;Ab<AU;Ab++){Af=AN-AU+Ab+1;AX=this.isDateDisabled(Af,Ac.m,Ac.y,AW,Aa)?"disabled":"";AR.push("<td "+Ad+'><div class="mstrmojo-Calendar-day-pre '+AX+'" m="-1">');AR.push(Af);AR.push("</div></td>");Ae++;}for(Ab=0;Ab<AY;Ab++){Af=Ab+1;AX=this.isDateDisabled(Af,AT,AQ,AW,Aa)?" disabled":"";var AP=q(Af,AT,AQ),AS=AP?" today":"",AV=X(AL,Af,AT,AQ)!==-1;AS=(this.hilightToday&&AP)?" hilightToday":AS;AR.push("<td "+(AP?('class="'+AS+'" '):" ")+(AV?AO:"")+'><div class="mstrmojo-Calendar-day-cur'+(AV?(" selected "):"")+AX+'" m="0"'+(AV?AO:"")+">");AR.push(Ab+1);AR.push("</div></td>");if((++Ae)%7===0){AR.push("</tr><tr>");}}for(AZ=Ae;AZ<42;AZ++){Af=Ae-AY-AU+1;AX=this.isDateDisabled(Af,AM.m,AM.y,AW,Aa)?"disabled":"";AR.push("<td "+Ad+'><div class="mstrmojo-Calendar-day-next '+AX+'" m="1">');AR.push(Af);AR.push("</div></td>");if((++Ae)%7===0&&Ae!==42){AR.push("</tr><tr>");}}AR.push("</tr>");AR.push(z);return AR.join("");},_dayViewTHead:function(){var AO=[],AP='<thead><tr class="mstrmojo-Calendar-thead" style="'+this.cssTextWeekDay+';">',AN="</tr></thead>",AM=this.firstDayOfWeek-1,AQ=this.dayNames,AL;AO.push(AP);for(AL=AM;AL<AM+7;AL++){AO.push("<td>");AO.push(AQ(AL%7));AO.push("</td>");}AO.push(AN);return AO.join("");},monthViewHTML:function(){var AM=[],AO=this.browseMonth-1,AN=this.browseYear,AL;U(this,{d:31,m:12,y:AN-1},{d:1,m:1,y:AN+1});AM.push(O(this.cssTextMonth));AM.push("<tr>");for(AL=0;AL<12;AL++){AM.push("<td "+((AL===AO)?AC(this):"")+'><div class="mstrmojo-Calendar-month'+((AL===AO)?" selected":"")+'" m="');AM.push(String(AL));AM.push('">');AM.push(this.monthNames(AL));AM.push("</div></td>");if(AL%3===2){AM.push("</tr><tr>");}}AM.pop();AM.push("</tr>");AM.push(z);return AM.join("");},yearViewHTML:function(){var AQ=this.yearRangStart,AM=[],AO=this.browseYear,AP,AL,AN=this.yearViewSize;U(this,{d:31,m:12,y:AQ-1},{d:1,m:1,y:AQ+AN*AN});AM.push(O(this.cssTextYear));AM.push("<tr>");for(AL=0;AL<AN*AN;AL++){AP=AQ+AL;AM.push("<td "+((AO===AP)?AC(this):"")+'><div class="mstrmojo-Calendar-year'+((AO===AP)?" selected":"")+'">');AM.push(AP);AM.push("</div></td>");if(AL%AN===(AN-1)){AM.push("</tr><tr>");}}AM.pop();AM.push("</tr>");AM.push(z);return AM.join("");},hourViewHTML:function(){var AN=[],AM=this.timeVal.hour,AL;AN.push(G);AN.push('<tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AN.push(AG().AM_NAME);AN.push("</div></td></tr>");for(AL=0;AL<12;AL++){AN.push('<td><div class="mstrmojo-Calendar-hour'+((AL===AM)?" selected":"")+'" h="0">');AN.push((AL===0)?12:AL);AN.push("</div></td>");if(AL===5){AN.push("</tr><tr>");}}AN.push('</tr><tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AN.push(AG().PM_NAME);AN.push("</div></td></tr>");for(AL=0;AL<12;AL++){AN.push('<td><div class="mstrmojo-Calendar-hour'+(((12+AL)===AM)?" selected":"")+'" h="1">');AN.push((AL===0)?12:AL);AN.push("</div></td>");if(AL===5){AN.push("</tr><tr>");}}AN.push("</tr>");AN.push(z);return AN.join("");},minuteViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.min,"mstrmojo-Calendar-minute");},secondViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.sec,"mstrmojo-Calendar-second");},_minuteSecondViewHTML:function(AN,AO){var AM=[],AL;AM.push(G);AM.push("<tr>");for(AL=0;AL<60;AL++){AM.push('<td><div class="');AM.push(AO);AM.push((AL===AN)?' selected">':'">');AM.push(AL);AM.push("</div></td>");if(AL%10===9){AM.push("</tr><tr>");}}AM.pop();AM.push("</tr>");AM.push(z);return AM.join("");},isDateDisabled:function(AL,AN,AM){return !F(AL,AN,AM,this.min,this.max);},unrender:function D(AL){delete this.lastValue;this._super(AL);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.ui.PopupWidget","mstrmojo.Tooltip","mstrmojo.Slider","mstrmojo.RadioList","mstrmojo.Refine.SampleSlider","mstrmojo.css","mstrmojo.Refine.RefineValidateStepper");mstrmojo.requiresDescs(1302,547,14703,14697,14697,14699,14700,14701,14704,14724,14753,14754,14755,14756,14757,14758,14759,4046,14816,14897,134,14818);var L=mstrmojo.Widget;var H=false;var F=mstrmojo.Button.newWebButton,I=mstrmojo.css,J=mstrmojo.desc;function D(O){var U=mstrApp.getRootController(),P=U.refineApp.rootController,N=P.model,S=P.tableID,Q=this,R=Q.itembox.steper.textInput.value;R=A(Q.itembox.steper.textInput.value);R=parseInt(R,10);if(O&&!isNaN(R)){if(N.hasUploadData){P.setSampleData(R,!parseInt(Q.itembox.randomType.selectedIndex,10));}else{U.dataService.startRefineStage({success:function(){N.hasUploadData=true;P.setSampleData(R,!parseInt(Q.itembox.randomType.selectedIndex,10));},failure:function(V){U.displayError(V&&V.message);}},{did:S,flag:4});}}Q.close();}function M(N){return H?N.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):N;}function A(N){return H?parseInt(N.toString().replace(/,/g,""),10):N;}function K(){return{alias:"popupWidget",scriptClass:"mstrmojo.ui.PopupWidget",visible:false,cssClass:"mstrmojo-Refine-RefineSampleButton-Popup",children:[{scriptClass:"mstrmojo.HBox",cssText:" margin: 20px,20px,20px,0",alias:"itembox",bindings:{cssClass:function(){if(!!mstrApp.isWorkstation){return"workstation box";}else{return"box";}}},children:[{scriptClass:"mstrmojo.ui.Pulldown",title:"",alias:"randomType",cssText:"height:20px; width:80px;",select:true,selectedIndex:0,items:[{n:mstrmojo.desc(4046,"First"),v:0},{n:mstrmojo.desc(14816,"Random"),v:1}],onSelectedItemChange:function(){this.parent.parent.parent.toggleRefresh(true);}},{scriptClass:"mstrmojo.Refine.RefineValidateStepper",alias:"steper",vflag:true,onvflagChange:function(N){this.parent.parent.bottom_buttons.children[0].set("enabled",N.value);},width:null,height:null,provider:new mstrmojo.NumStepperContentProvider({item:{interval:1000,value:1000}})},{scriptClass:"mstrmojo.Label",alias:"label",text:mstrmojo.desc(14897,"rows"),cssDisplay:"inline-block"}]},{scriptClass:"mstrmojo.Box",cssClass:"box",alias:"bottom_buttons",cssDisplay:"inline-block",children:[F(J(134,"Apply"),function(){D.call(this.parent.parent,true);},true,{alias:"finish",cssDisplay:"inline-block",height:"22px"}),F(J(2140,"Cancel"),function(){D.call(this.parent.parent,false);},false,{cssDisplay:"inline-block",height:"22px"})]}]};}function G(){var U=mstrApp.getRootController(),P=U.refineApp.rootController,N=P.model,O=N.sampleStatus,Q=this.getPopupWidget(),V,R,S=0;if(!O){S=1000;}else{V=O.current;R=O.total;S=Math.max(V,0);}Q.itembox.steper.textInput.set("max",!R||R>10000?10000:parseInt(R,10));Q.itembox.steper.textInput.set("value",S);Q.itembox.steper.provider.set("curVal",S);}mstrmojo.Refine.RefineSampleButton=mstrmojo.declare(mstrmojo.ui.PopupButton,null,{scriptClass:"mstrmojo.Refine.RefineSampleButton",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-Refine-RefineSampleButton {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-Refine-RefineSampleButton-text mstrmojo-Button-text mstrmojo-Button mstrmojo-WebHoverButton" title="{@title}" style="{@labelCssText}">{@text}</div><div class="container"></div></div>',markupSlots:{textNode:function C(){return this.domNode.firstChild;},containerNode:function B(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:L.visibleMarkupMethod,onheightChange:L.heightMarkupMethod,onwidthChange:L.widthMarkupMethod},text:J(14818,"Sample Size"),anchorSlot:"textNode",children:[],initChildren:function E(){this.children=this.getPopupWidgetRef();this._super();},getPopupWidget:function(){return this.popupWidget;},onPopupWidgetOpened:G,getPopupWidgetRef:K,postBuildRendering:function(){if(this._super){this._super();}var P=mstrApp.getRootController(),N=P.refineApp.rootController,O=P.getModel().currentSource;this.m=N.model;this.h4LessThan1k=this.m.attachEventListener("dataChange",this.id,this.lessThanOneKRows);this.h1KandLoaded=this.m.attachEventListener("sampleStatusChange",this.id,this.OneKandAllLoaded);this.m.attachEventListener("sampleStatusChange",this.id,this.refreshToggle);this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);if(!(O&&O.canRandomSample())){this.set("visible",false);}},lessThanOneKRows:function(N){var O=parseInt(N.value.totalInitial,10);if(O<1000){this.toggleButton(false);}this.m.detachEventListener(this.h4LessThan1k);},OneKandAllLoaded:function(){var O=mstrApp.getRootController(),N=this.popupWidget.itembox.steper.textInput.value;if(this.m.sampleStatus.total===1000){this.toggleButton(false);O.displayError(J(14724,"All data from the source has been added in the data wrangler preview"));}else{if(this.m.sampleStatus.total<=N){O.displayError(J(14724,"All data from the source has been added in the data wrangler preview"));this.toggleRefresh(true);}else{this.toggleRefresh(true);}}this.m.detachEventListener(this.h1KandLoaded);},toggleButton:function(O){var N=!!O;this.set("useRichTooltip",!N);this.set("enabled",N);if(N){I.removeClass(this.textNode,"_disable-Button");}else{I.addClass(this.textNode,"_disable-Button");}},toggleRefresh:function(O){var N=!!O;this.parent.refreshButton.set("visible",!!(N&&this.m.hasAddSample()&&!!parseInt(this.popupWidget.itembox.randomType.selectedIndex,10)));},refreshToggle:function(O){var P=O.value,Q=parseInt(P.total,10),N=false;if(P.random===true&&Q>1000){N=true;}this.toggleRefresh(N);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Dialog","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.form","mstrmojo.LoginEditor");mstrmojo.requiresDescs(2699,7773,11812,11865,13380,13381,13382);var D=mstrmojo.desc(13382,"Your user session will time out due to inactivity in # ##."),S=60,M=false,G=null,A=null,H=null;function N(){return mstrApp.sessionState||window.microstrategy&&microstrategy.sessionState;}function K(W,V){if(mstrApp.is508){for(var U in V){W.setAttribute(U,V[U]);}}}mstrmojo.SessionManager=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SessionManager",cssClass:"mstrmojo-SessionManager",width:"370px",title:mstrmojo.desc(11812,"Notification"),msgInterval:1,checkSessionInterval:20,zIndex:10000,maxSessionIdleTime:600,timeBeforeSessionTimeoutWarning:60,remainingTime:60,sessionTimedout:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(13381,"Stay logged in"),function(){var U=this.parent.parent;if(A){U.keepSessionAlive();}U.hideMessage();},true,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13381,"Stay logged in")});}}),mstrmojo.Button.newWebButton(mstrmojo.desc(13380,"Log out"),function(){this.parent.parent.hideMessage();mstrmojo.form.send({evt:3019,src:mstrApp.name+".3019"});},null,{onRender:function(){K(this.domNode,{tabindex:0,role:"button","aria-label":mstrmojo.desc(13380,"Log out")});}})],children:[{scriptClass:"mstrmojo.Label",alias:"message",cssClass:"mstrmojo-SessionManager-msg",text:"",allowHTML:true,ontextChange:function(){if(mstrApp.is508){this.refresh();var U=this.domNode;K(U,{tabindex:-1,role:"alert"});window.setTimeout(function(){U.focus();},0);}}}],postBuildRendering:function(){this._super();if(mstrApp.is508){this.msgInterval=10;K(this.editorNode,{role:"alertdialog",tabindex:-1});}},updateMsg:function B(V){var U;if(V>60){U=D.replace("##",mstrmojo.desc(2699,"minutes")).replace("#","<b>"+Math.ceil(V/S)+"</b>");}else{if(V>-1){U=D.replace("##",mstrmojo.desc(7773,"seconds")).replace("#","<b>"+V+"</b>");}else{U=mstrmojo.desc(11865,"Your session is expired.");}}this.message.text="";this.message.set("text",U);this.remainingTime=V;},showMessage:function F(U){this.updateMsg(U);this.set("visible",true);M=true;},hideMessage:function I(){if(A){window.clearInterval(A);A=null;window.clearInterval(H);H=null;}this.set("visible",false);M=false;},popupTimeoutWarning:function L(Y){if(M){return ;}var W=this,X=(typeof Y==="number")?Y:W.timeBeforeSessionTimeoutWarning,U=X,V=mstrmojo.now();if(mstrApp.enableWarningSessionTimeout){if(!this.hasRendered){this.render();}this.showMessage(U);}window.clearInterval(A);A=window.setInterval(function(){if(U<1){window.clearInterval(A);A=null;window.clearInterval(H);H=null;window.setTimeout(function(){if(mstrApp.enableWarningSessionTimeout){W.gotoLogoutPage();}else{W.sessionTimedout=true;W.closeSession();}},200);}var Z=Math.round((mstrmojo.now()-V)/1000);U=X-Z;W.updateMsg(U);},this.msgInterval*1000);window.clearInterval(H);H=window.setInterval(function(){W.isSessionAlive();},this.checkSessionInterval*1000);},warningTimeoutTimer:function Q(U){var V=this;window.clearTimeout(G);G=window.setTimeout(function(){G=null;V.isSessionAlive();},(U-this.timeBeforeSessionTimeoutWarning)*1000);},isSessionAlive:function E(){var U=this,W={success:function(X){var Y=parseInt(X,10);if(Y!==-1){if(Y>U.remainingTime){U.hideMessage();}if(Y>U.timeBeforeSessionTimeoutWarning){U.warningTimeoutTimer(Y);}else{U.popupTimeoutWarning(Y);}}else{window.clearInterval(H);U.popupTimeoutWarning(0);}},failure:function(){mstrmojo.alert("Problems encountered during checking for whether session is alive. Connection is down or session already time out.");}},V={taskId:"isSessionAlive",notRestartSessionManager:true};mstrmojo.xhr.request("POST",mstrConfig.taskURL,W,V);},keepSessionAlive:function R(){var U=this,W={success:function(X){if(X){U.warningTimeoutTimer(U.maxSessionIdleTime);}else{U.sessionTimedout=true;mstrmojo.alert("Your session is expired.");}},failure:function(){mstrmojo.alert("Problems encountered during activating session. Connection is down or session already time out.");}},V={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,W,V);},closeSession:function J(){var U=this;mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(){U.sessionTimedout=true;}},{taskId:"closeSessions",sessionStates:N(),notRestartSessionManager:true});},restart:function(){this.sessionTimedout=false;this.hideMessage();if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}},start:function C(){var W=mstrConfig.lastMsgKey;if(this.maxSessionIdleTime>this.timeBeforeSessionTimeoutWarning){this.warningTimeoutTimer(this.maxSessionIdleTime);}var V=function(){window.localStorage.setItem("msg_recovery_notify"+W,1);};if(window.addEventListener){window.addEventListener("beforeunload",V);}else{window.attachEvent("onbeforeunload",V);}var U=window.sessionStorage;if(U){U.setItem("msg_browser_not_closed"+W,1);U.setItem("msg_user_login",0);}},openLoginEditor:function P(W){if(window.mstrmobile&&window.mstrmobile.onSessionExpired){window.mstrmobile.onSessionExpired();return ;}var V="LoginEditor",U=mstrmojo.all[V];if(!U){U=mstrmojo.insert({id:V,scriptClass:"mstrmojo.LoginEditor",config:{callback:{}},zIndex:10000});}U.config.callback=W;U.open();},gotoLogoutPage:function O(){mstrmojo.form.send({evt:3008,src:mstrApp.name+".3008",autoLoggedout:true,Server:mstrConfig.serverName,Port:mstrConfig.serverPort,Project:mstrmojo.string.decodeHtmlString(mstrConfig.projectName),loginReq:true},null,"POST");}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.dom","mstrmojo.DI.DIGeoRole","mstrmojo.DI.DITimeDimension","mstrmojo.ui.menus.EditorConfig","mstrmojo.DI.DIPartition","mstrmojo.DI.DIShowAllColumns","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(967,1388,2052,2170,2265,3434,3544,4530,4699,8002,8118,8984,9920,9134,9614,9919,9921,9922,11611,11805,11909,12697,12698,12699,12700,12701,12703,12706,12707,12708,12709,12710,13023,13024,13036,13037,13038,13039,13131,13132,13280,13303,13366,12388,13526,14198,14199,14200);var S=mstrmojo.DI.DIConstants;var R=S.menuItems,O=S.dataTypeMenuItems;var Q=mstrmojo.array,G=mstrmojo.DI.DIHelpers;var F=8,M=9,C=1;function L(W,V){var U;if(V&&V.length>0){return true;}U=mstrApp.getRootController().partitionController.getAllPartitionTables(W,V);return U.length>0;}mstrmojo.DI.DIMappingMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIMappingMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12697,"Create Multi-form Attribute"),did:R.CREATE_MULTIFORM_ATTRIBUTE},{n:mstrmojo.desc(12698,"Edit Multi-form Attribute"),did:R.EDIT_MULTIFORM_ATTRIBUTE},{n:mstrmojo.desc(12699,"Add To Multi-form Attribute"),did:R.ADDTO_MULTIFORM_ATTRIBUTE},{did:R.SEPARATOR},{n:mstrmojo.desc(13303,"Unmap"),did:R.UNLINK_ALL},{did:R.SEPARATOR},{n:mstrmojo.desc(11909,"Change Data Type"),did:R.CHANGE_DATA_TYPE,items:[{did:O.NUMBER,ctp:S.columnDataTypes.integer,n:mstrmojo.desc(9614,"Integer"),isTogglable:true},{did:O.NUMBER,ctp:S.columnDataTypes.nlong,n:mstrmojo.desc(13131,"Long"),isTogglable:true},{did:O.NUMBER,ctp:S.columnDataTypes.int64,n:mstrmojo.desc(13132,"Big Integer"),isTogglable:true},{did:O.NUMBER,ctp:S.columnDataTypes.dtfloat,n:mstrmojo.desc(8002,"Float"),isTogglable:true},{did:O.NUMBER,ctp:S.columnDataTypes.dtdouble,n:mstrmojo.desc(2265,"Double"),isTogglable:true},{did:O.BIG_DECIMAL,ctp:S.columnDataTypes.bigDecimal,n:mstrmojo.desc(9920,"Big Decimal"),isTogglable:true},{did:R.SEPARATOR},{did:O.DATE,n:mstrmojo.desc(2052,"Date"),isTogglable:true},{did:O.DATE_TIME,n:mstrmojo.desc(9919,"DateTime"),isTogglable:true},{did:O.TIME,n:mstrmojo.desc(2170,"Time"),isTogglable:true},{did:R.SEPARATOR},{did:O.TEXT,n:mstrmojo.desc(3544,"Text"),isTogglable:true},{did:O.HTML_TAG,n:mstrmojo.desc(9921,"HTML Tag"),isTogglable:true},{did:O.PHONE_NUMBER,n:mstrmojo.desc(8984,"Phone Number"),isTogglable:true},{did:O.SYMBOL,n:mstrmojo.desc(4530,"Symbol"),isTogglable:true},{did:O.URL,n:mstrmojo.desc(9922,"URL"),isTogglable:true},{did:O.EMAIL,n:mstrmojo.desc(4699,"Email"),isTogglable:true}]},{did:R.SEPARATOR},{n:mstrmojo.desc(15051,"Create Hierarchy Attribute"),did:R.CREATE_HIERARCHY_ATTRIBUTE},{n:mstrmojo.desc(15052,"Edit Hierarchy Attribute"),did:R.EDIT_HIERARCHY_ATTRIBUTE},{n:mstrmojo.desc(15053,"Reset Hierarchy Attribute"),did:R.RESET_HIERARCHY_ATTRIBUTE},{did:R.SEPARATOR},{n:mstrmojo.desc(13526,"Define Geography"),did:R.MARK_GEO_ROLES,items:[],buildSubMenuConfig:function K(){return this.buildGeoRoleMenuEditor();}},{n:mstrmojo.desc(12701,"Create Time Attributes"),did:R.CREATE_TIME_ATTRIBUTES,items:[],buildSubMenuConfig:function K(){return this.buildTimeRoleMenuEditor();}},{n:mstrmojo.desc(11611,"Convert to Attribute"),did:R.TO_ATTRIBUTE},{n:mstrmojo.desc(11805,"Convert to Metric"),did:R.TO_METRIC},{n:mstrmojo.desc(13036,"Do Not Import"),did:R.DO_NOT_IMPORT},{n:mstrmojo.desc(8118,"Import"),did:R.IMPORT},{n:mstrmojo.desc(1388,"Rename"),did:R.ITEM_RENAME},{did:R.SEPARATOR},{n:mstrmojo.desc(13037,"Map to Project Attribute"),did:R.MAP_TO_PROJECT_ATTRIBUTE},{n:mstrmojo.desc(13038,"Unmap from Project Attribute"),did:R.UNMAP},{n:mstrmojo.desc(12703,"Link ?"),did:S.menuItems.LINK},{n:mstrmojo.desc(13849,"Edit Table"),did:R.REFRESH_DATA},{n:mstrmojo.desc(1388,"Rename"),did:R.TABLE_RENAME},{n:mstrmojo.desc(13039,"Delete"),did:R.DELETE},{did:R.SEPARATOR},{n:mstrmojo.desc(13026,"Parse..."),did:R.PARSE},{n:mstrmojo.desc(13023,"Wrangle..."),did:R.REFINE},{n:mstrmojo.desc(13024,"Delete Wrangle Operations"),did:R.CANCEL_REFINE},{did:R.SEPARATOR},{n:mstrmojo.desc(12706,"Define Relationships"),did:R.DEFINE_RELATIONSHIPS},{n:mstrmojo.desc(12707,"Show All Attribute Forms"),did:R.SHOW_ALL_ATTRIBUTE_FORMS},{n:mstrmojo.desc(12708,"Hide All Attribute Forms"),did:R.HIDE_ALL_ATTRIBUTE_FORMS},{n:mstrmojo.desc(12709,"Show All Columns"),did:R.SHOW_ALL_COLUMNS,items:[],buildSubMenuConfig:function K(){return this.buildAllColumnsMenuEditor();}},{did:R.SEPARATOR},{n:mstrmojo.desc(12710,"Group Partition"),did:R.PARTITION,items:[],buildSubMenuConfig:function K(){return this.buildPartitionMenuEditor();}}],queryEnabled:function J(h){var f=true;var c=this.data[0];var U,V,X=this.data[0],e=mstrApp.getRootController().getModel(),d,a;if(this.type!==S.contextMenuType.TABLE_MENU){V=e.findMappingSource(X);if(V.length===0){return false;}U=V[0];}else{if(this.type===S.contextMenuType.TABLE_MENU){U=e.importSources[this.data[0].id];}}if(c.isMultiForm&&!c.isAttributeForm){c=c.subColumns[0];}switch(h.did){case R.ITEM_RENAME:case R.CHANGE_DATA_TYPE:f=(c.ipa!==1);break;case R.MARK_GEO_ROLES:f=(c.ipa!==1)&&(U.type!==S.sourceType.hadoop)&&!e.isDirectDataAccess;var b=mstrApp.getRootController();var Y=b.model;var g=Y.findMappingItem(c);var Z,W;for(d=0;d<g.length;d++){Z=g[d];W=Z.subColumns;if(Z.isMultiForm){for(a=0;a<W.length;a++){if(W[a].fmn==="Latitude"||W[a].fmn==="Longitude"){f=false;break;}}}}break;case R.DO_NOT_IMPORT:if(c.tp===12){mstrmojo.array.forEach(V,function(j){if(j.xdaType===S.xdaType.querybuilder||j.xdaType===S.xdaType.googleBigQuery||j.xdaType===S.xdaType.dataImportCustomSQL||j.sourceInfo.hasAggFilter){f=false;h.title=mstrmojo.desc(14198,"Unmap to enable this option");return false;}});}break;case R.CREATE_TIME_ATTRIBUTES:f=(c.ipa!==1)&&(U.type!==S.sourceType.hadoop)&&((c.dtp===F)||(c.dtp===M)||(c.dtp===C))&&!e.isDirectDataAccess;break;case R.PARSE:f=U&&(U.sourceInfo.isRefined===0&&U.sourceInfo.hasAggFilter===0)&&U.canAutoMappingAndDetectRelation();h.title=mstrmojo.desc(13902,"Edit table to enable this option.");break;case R.REFINE:f=true;break;case R.CANCEL_REFINE:f=U&&(U.canAutoMappingAndDetectRelation());break;case R.SHOW_ALL_COLUMNS:f=true;if(e.operationMode===S.operationMode.edit&&U&&!U.hasRefreshedData){f=false;h.title=mstrmojo.desc(13902,"Edit table to enable this option.");}if(U.xdaType===S.xdaType.querybuilder||U.xdaType===S.xdaType.dataImportCustomSQL||U.xdaType===S.xdaType.googleBigQuery||U.xdaType===S.xdaType.googleBigQueryFFSQL){f=false;h.title=mstrmojo.desc(14199,"This option is not applicable to Build Query and Type Query sources. Please use the 'edit table' operation to change the imported columns.");}break;case R.PARTITION:f=L(c.id,c.partition);h.title=f?"":mstrmojo.desc(12388,"No tables found with the same set of attributes and metrics.");break;case R.REFRESH_DATA:f=e.isRefreshDataSupported(U.xdaType);h.title=f?"":(U.sourceInfo.hnc?mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table."):mstrmojo.desc(13977,"HTTPS is required to edit this table"));if(U.type===S.sourceType.file&&U.subtype===S.sourceSubtype.url){f=mstrApp.diParams.EnableURLImport;}break;case R.UNLINK:f=c.ipa!==1;break;default:f=true;break;}return f;},queryVisible:function B(w){var X=true;var x=(this.data.length>1);var l=false;var b=this.data[0],Y=b.tp,W=(b.type==="cmps"),t=!w.showLink,d=b.isLinked,n=b.recursive,V,o,u=b.isAttributeForm,j=12,a=(b.type==="mtmps"),k=mstrApp.getRootController(),Z=k.model,m=k.formsController,c,U,h;if(!x){l=b.isMultiForm;}if(this.type!==S.contextMenuType.TABLE_MENU){V=Z.findMappingSource(b);if(V.length===0){return false;}o=V[0];}else{if(this.type===S.contextMenuType.TABLE_MENU){o=Z.importSources[this.data[0].id];}}c=o&&(o.subtype===S.sourceSubtype.hanaSingleTable);switch(w.did){case R.SEPARATOR:X=true;break;case R.ITEM_RENAME:X=(this.type!==S.contextMenuType.TABLE_MENU)&&!x&&b.selected&&!u;break;case R.TO_ATTRIBUTE:X=(this.type!==S.contextMenuType.TABLE_MENU)&&(Y!==12||!b.selected)&&!u&&!c;X=X&&!W;break;case R.TO_METRIC:X=(this.type!==S.contextMenuType.TABLE_MENU)&&(Y!==4||!b.selected)&&!u&&!c&&!(o.type===S.sourceType.dataFromPushApi&&l);X=X&&!W;if(x&&o.type===S.sourceType.dataFromPushApi){Q.forEach(this.data,function(z){if(z.isMultiForm){X=false;}});}break;case R.CREATE_MULTIFORM_ATTRIBUTE:X=(Y===12)&&m.isVisible(S.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,this.data)&&(o.type!==S.sourceType.dataFromPushApi);if(X){U=0;mstrmojo.array.forEach(this.data,function(z){if(z.recursive){U++;}});if(U>=2){X=false;}}break;case R.EDIT_MULTIFORM_ATTRIBUTE:X=(Y===12)&&m.isVisible(S.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,this.data);break;case R.ADDTO_MULTIFORM_ATTRIBUTE:X=(Y===12)&&m.isVisible(S.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,this.data);break;case R.MAP_TO_PROJECT_ATTRIBUTE:if(!x){X=(this.type!==S.contextMenuType.TABLE_MENU)&&(Y===12)&&!x&&!mstrApp.isSingleTier&&!u&&(b.ipa!==1);X=X&&!W&&!(b.isMultiForm||Z.isLinkedMFA(b))&&!b.recursive;}else{X=!mstrApp.isSingleTier;if(X){Q.forEach(this.data,function(z){if(z.tp!==12||z.isAttributeForm||z.isMultiForm||Z.isLinkedMFA(z)||z.ipa===1||z.recursive){X=false;return false;}});}}break;case R.MARK_GEO_ROLES:X=(this.type!==S.contextMenuType.TABLE_MENU)&&(Y===12)&&!x&&!u&&!n&&(o.type!==S.sourceType.dataFromPushApi);if(l){var f=b.subColumns;var p=true;if(mstrmojo.array.some(f,function(z){if(z.recursive){X=false;return false;}})){break;}mstrmojo.array.forEach(f,function(AA){var z=AA.dtp;if(z!==1&&z!==8&&z!==9){p=false;}});if(p){X=false;}}else{var e=b.dtp;if(e===1||e===8||e===9){X=false;}}X=X&&!c;X=X&&!W;break;case R.CREATE_TIME_ATTRIBUTES:X=false;break;case R.CHANGE_DATA_TYPE:case O.NUMBER:X=(u||((this.type!==S.contextMenuType.TABLE_MENU)&&!x&&!l&&b.selected))&&!c&&(o.type!==S.sourceType.dataFromPushApi);if(w.ctp===S.columnDataTypes.int64){X=X&&!a;}break;case O.DATE_TIME:case O.TEXT:case O.DATE:case O.TIME:X=(u||((this.type!==S.contextMenuType.TABLE_MENU)&&!x&&!l&&b.selected))&&!c;break;case O.BIG_DECIMAL:X=(u||((this.type!==S.contextMenuType.TABLE_MENU)&&!x&&!l&&b.selected))&&!c;break;case O.HTML_TAG:case O.PHONE_NUMBER:case O.SYMBOL:case O.URL:case O.EMAIL:X=u||((this.type!==S.contextMenuType.TABLE_MENU)&&!x&&!l&&b.selected);X=X&&!a;break;case R.UNMAP:X=(this.type!==S.contextMenuType.TABLE_MENU)&&(Y===12)&&!x&&!mstrApp.isSingleTier&&!u&&(b.ipa===1);X=X&&!W;break;case R.UNLINK:X=t&&d&&!x&&(Y===12)&&(this.type===S.contextMenuType.ITEM_MENU)&&!u;break;case R.UNLINK_ALL:X=false;Q.forEach(this.data,function(z){if(z.isLinked&&z.tp===12){X=true;return false;}});break;case R.IMPORT:X=W;break;case R.DO_NOT_IMPORT:if(u||(n&&mstrmojo.all.diAllObjectsViewDialog)){return false;}o=Z.importSources[this.data[0].tableId];if((this.type!==S.contextMenuType.TABLE_MENU)&&o&&b.selected){if((o.xdaType===S.xdaType.querybuilder||o.xdaType===S.xdaType.dataImportCustomSQL||o.xdaType===S.xdaType.googleBigQuery||o.xdaType===S.xdaType.googleBigQueryFFSQL||o.sourceInfo.hasAggFilter)){X=false;}}else{X=false;}if(b.recursive){X=false;}else{if(b.subColumns&&(b.subColumns.length>0)){for(var q=0;q<b.subColumns.length;q++){if(b.subColumns[q].recursive===true){X=false;break;}}}}X=X&&!c;break;case R.CANCEL_REFINE:X=o.canRefine()&&(o.sourceInfo.isRefined&&this.type===S.contextMenuType.TABLE_MENU)&&!u;if(X){if(mstrmojo.array.some(o.currentMapping,function(z){if(z.recursive){return true;}})){X=false;}}break;case R.REFINE:var g=o.canRefine();X=(g&&this.type===S.contextMenuType.TABLE_MENU)&&!u;break;case R.PARSE:X=(this.type===S.contextMenuType.TABLE_MENU)&&(o.type===S.sourceType.file||o.type===S.sourceType.googleDrive||o.type===S.sourceType.dropbox||o.type===S.sourceType.hadoop);if(o.sourceInfo&&o.sourceInfo.des===S.sourceInfoDesc.json){X=false;}if(o.type===S.sourceType.hadoop){X=(!!o.fileType&&(S.fileTypes[0].v===o.fileType.toUpperCase()))||/.+\.csv$/i.test(o.sourceInfo.name);}break;case R.DEFINE_RELATIONSHIPS:if(o.type===S.sourceType.dataFromPushApi){X=false;break;}case R.TABLE_RENAME:case R.DELETE:case R.SHOW_ALL_COLUMNS:X=(this.type===S.contextMenuType.TABLE_MENU);break;case R.PARTITION:X=(this.type===S.contextMenuType.TABLE_MENU&&!Z.isDirectDataAccess)&&!u;break;case R.SHOW_ALL_ATTRIBUTE_FORMS:X=(this.type===S.contextMenuType.TABLE_MENU)&&!this.target.isExpanded&&!u;break;case R.HIDE_ALL_ATTRIBUTE_FORMS:X=(this.type===S.contextMenuType.TABLE_MENU)&&this.target.isExpanded&&!u;break;case R.REFRESH_DATA:X=(this.type===S.contextMenuType.TABLE_MENU)&&!u&&Z.hasRefreshDataPrivilegesForAllTables([o])&&(o.type!==S.sourceType.dataFromPushApi);break;case R.CREATE_HIERARCHY_ATTRIBUTE:X=!n&&!b.isMultiForm&&!b.ipa&&!mstrmojo.all.diAllObjectsViewDialog&&(!mstrApp.diParams||mstrApp.diParams.hierarchyAttributeFeature)&&(this.type===S.contextMenuType.ITEM_MENU||this.type===S.contextMenuType.PREVIEW_ITEM_MENU)&&!x&&(Y===j);break;case R.EDIT_HIERARCHY_ATTRIBUTE:X=n&&!b.isMultiForm&&!b.ipa&&!mstrmojo.all.diAllObjectsViewDialog&&(!mstrApp.diParams||mstrApp.diParams.hierarchyAttributeFeature)&&(this.type===S.contextMenuType.ITEM_MENU||this.type===S.contextMenuType.PREVIEW_ITEM_MENU)&&!x&&(Y===j);if(X&&b.isLinked&&n){V=mstrApp.getRootController().getModel().importSources;for(o in V){if(V.hasOwnProperty(o)){h=mstrmojo.array.find(V[o].currentMapping,"alias",b.alias);if(h>=0&&V[o].currentMapping[h].isMultiForm){X=false;break;}}}}break;case R.RESET_HIERARCHY_ATTRIBUTE:X=n&&!b.isMultiForm&&!b.ipa&&!mstrmojo.all.diAllObjectsViewDialog&&(!mstrApp.diParams||mstrApp.diParams.hierarchyAttributeFeature)&&(this.type===S.contextMenuType.ITEM_MENU||this.type===S.contextMenuType.PREVIEW_ITEM_MENU)&&!x&&(Y===j)&&(o.type===S.sourceType.querybuilder||o.type===S.sourceType.file);if(X&&b.isLinked&&n){V=mstrApp.getRootController().getModel().importSources;for(o in V){if(V.hasOwnProperty(o)){h=mstrmojo.array.find(V[o].currentMapping,"alias",b.alias);if(h>=0&&V[o].currentMapping[h].isMultiForm){X=false;break;}}}}break;default:X=false;break;}return X;},queryChecked:function P(W){var V=false;var U=(this.data.length>1);if(this.data[0].dtp&&!U){if(W.ctp===undefined){V=W.did===this.data[0].dtp.toString();}else{V=(W.did===this.data[0].dtp.toString())&&W.ctp===this.data[0].ctp;}}return V;},executeCommand:function(X){var a=this,W=this.data[0].id,U=mstrApp.getRootController(),b=U.formsController,Y=U.model.importSources[W];switch(X.did){case R.ITEM_RENAME:U.openRenameTextBox(S.contextMenuType.ITEM_MENU,this.menuNode||a.target.textNode,a);break;case R.IMPORT:U.importItem(a.data[0]);break;case R.DO_NOT_IMPORT:U.toUnused(a);break;case R.TO_ATTRIBUTE:U.toAttribute(a.data);break;case R.TO_METRIC:U.toMetric(a.data);break;case R.UNLINK:U.openUnLinkDialog(a);break;case R.UNLINK_ALL:U.unlinkAll(a);break;case R.MAP_TO_PROJECT_ATTRIBUTE:U.toProjectAttribute(a);break;case R.UNMAP:U.unmap(a);break;case R.PARSE:U.showDialog(S.dialogType.parseDataDialog,{model:U.model,height:"726px",w:"1328px",id:"parseDataDialog"+Y.tableID,tableID:Y.tableID});break;case R.CANCEL_REFINE:U.cancelRefineStage(W,true);break;case R.REFINE:if(Y.canLaunchWrangler()){U.launchWranglerDialog(Y);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(U.model)){U.model.isAddingNewTable=false;U.model.refreshToWrangle=Y.tableID;U.refreshSourceTable(Y.tableID);}else{U.displayError(mstrmojo.desc(14200,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}break;case R.TABLE_RENAME:U.openRenameTextBox(S.contextMenuType.TABLE_MENU,a.target.titleNode,a);break;case R.DELETE:U.removeSourceTable(W);break;case R.REFRESH_DATA:if(G.isRefreshable(U.model)){U.model.isAddingNewTable=false;U.model.refreshToWrangle=null;U.refreshSourceTable(W);}else{U.displayError(mstrmojo.desc(13280,"Administrator has disabled importing a file from a URL."));}break;case R.DEFINE_RELATIONSHIPS:U.openRelationsDefineEditor(W);break;case R.SHOW_ALL_ATTRIBUTE_FORMS:case R.HIDE_ALL_ATTRIBUTE_FORMS:this.target.expandAttrForms();break;case R.CREATE_MULTIFORM_ATTRIBUTE:b.onClick(S.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,this.data[0].tableId,this.data[this.data.length-1],this.data);break;case R.EDIT_MULTIFORM_ATTRIBUTE:b.onClick(S.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,this.data[0].tableId,this.data[this.data.length-1],this.data);break;case R.ADDTO_MULTIFORM_ATTRIBUTE:b.onClick(S.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,this.data[0].tableId,null,this.data);break;case O.NUMBER:case O.DATE_TIME:case O.TEXT:case O.URL:case O.EMAIL:case O.HTML_TAG:case O.DATE:case O.TIME:case O.SYMBOL:case O.BIG_DECIMAL:case O.PHONE_NUMBER:var V=parseInt(X.did,10);var Z=parseInt(X.ctp,10);if(typeof Z!=="number"){Z=null;}U.changeDataType(a,V,Z);break;case R.CREATE_HIERARCHY_ATTRIBUTE:U.showDialog(S.dialogType.hierarchyAttributeDialog,{controller:U,tableId:this.data[0].tableId,attribute:this.data[0],hierarchyOption:S.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE});break;case R.EDIT_HIERARCHY_ATTRIBUTE:U.showDialog(S.dialogType.hierarchyAttributeDialog,{controller:U,tableId:this.data[0].tableId,attribute:this.data[0],hierarchyOption:S.hierarchyOptions.EDIT_HIERARCHY_ATTRIBUTE});break;case R.RESET_HIERARCHY_ATTRIBUTE:U.showDialog(S.dialogType.hierarchyAttributeResetDialog,{controller:U,tableId:this.data[0].tableId,attribute:this.data[0],hierarchyOption:S.hierarchyOptions.RESET_HIERARCHY_ATTRIBUTE});break;default:return false;}return true;},buildDataTypeMenuEditor:function E(){var U=new mstrmojo.ui.menus.EditorConfig({cssClass:"geoRoleMenu",contents:new mstrmojo.DI.DIDataType({data:this.data[0]}),data:{}});U.fnOk=function(V){U.contents.onOK(V);};return U;},buildGeoRoleMenuEditor:function H(){var Z=this.data[0];var b=mstrApp.getRootController().model;var V=b.findMappingItem(Z);if(V.length>1){var a,Y,X,f,d,W,U,c;for(a=0;a<V.length;a++){f=V[a];if(!f.isMultiForm){continue;}c=f.subColumns;if(!U){U=c.slice(0);}else{for(Y=0;Y<c.length;Y++){W=c[Y];d=false;for(X=0;X<U.length;X++){if(W.fmn===U[X].fmn){d=true;}}if(!d){U.push(W);}}}}if(U){this.data[0].mergeSubColumns=U;this.data[0].isSharedMultiForm=true;}}else{this.data[0].mergeSubColumns=this.data[0].subColumns;this.data[0].isSharedMultiForm=this.data[0].isMultiForm;}var e=new mstrmojo.ui.menus.EditorConfig({cssClass:"geoRoleMenu",contents:new mstrmojo.DI.DIGeoRole({georole:Z.georole,der:Z.der,shapeKeys:b.shapeKeys,data:this.data[0]}),data:{}});e.fnOk=function(g){e.contents.onOK(g);};return e;},buildTimeRoleMenuEditor:function I(){var V=this.data[0];var U=new mstrmojo.ui.menus.EditorConfig({cssClass:"timeRoleMenu",contents:new mstrmojo.DI.DITimeDimension({der:V.der,data:this.data[0]}),data:{}});U.fnOk=function(W){U.contents.onOK(W);};return U;},buildPartitionMenuEditor:function N(){var V=this.data[0],U;U=new mstrmojo.ui.menus.EditorConfig({cssClass:"partitionMenu",contents:new mstrmojo.DI.DIPartition({data:V}),data:{},cancelVisible:false});U.fnOk=function(W){U.contents.onOK(W);};return U;},buildAllColumnsMenuEditor:function A(){var V=this.data[0];var U=new mstrmojo.ui.menus.EditorConfig({cssClass:"timeRoleMenu",contents:new mstrmojo.DI.DIShowAllColumns({der:V.der,data:this.data[0]}),data:{}});U.fnOk=function(W){U.contents.onOK(W);};return U;},getMenuConfig:function D(V){var Z=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu",useTooltip:true}),a=this.id,U,Y=false,X=null,W=V||this.cm;Q.forEach(W,function(c){U=(c.did===S.menuItems.SEPARATOR);if(this.queryVisible(c)){if(U){if(null!==X){Y=true;}}else{if(null===X){X=c;}else{if(Y){Z.addSeparator();Y=false;}}var b=[c.icn||""],d=function d(){this.executeCommand(c);};if(this.queryEnabled(c)===false){Z.addDisabledMenuItem(c.n,b.join(" "));if(c.title){Z.menus[Z.menus.length-1].title=c.title;}}else{if(c.items){Z.addSubMenuItem(c.n,"",a,c.buildSubMenuConfig||this.getMenuConfig,c.items);}else{if(c.hasEdt){Z.addEditorMenuItem(c.n,a,c.buildSubMenuConfig);}else{if(c.isTogglable){Z.addToggleMenuItem(c.n||"",b.join(" "),d,d,a,this.queryChecked(c));}else{Z.addMenuItem(c.n||"",b.join(" "),d.bind(this));}}}}}}},this);if(!Z.hasMenuItems()){return new mstrmojo.ui.menus.MenuConfig({menuCssClass:"hidden"});}return Z;},getCategoryMenuConfig:function(U){var f=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu category-menu"}),g=this,W=this.id,X,c,b,a;var k='<div class="category-menu-item cf"><div class="menu-category">',e="</div>",d='<div class="menu-item">',Z="</div></div>",V,h,m;function Y(j){return function(){g.executeCommand(j);};}for(b=0;U&&b<U.length;b++){X=U[b];c=X&&X.items;for(a=0;a<c.length;a++){var l=c[a];V=(a===0)?(X.n||"&nbsp"):"&nbsp";h=l.n||"";m=k+V+e+d+h+Z;f.addToggleMenuItem(m,"",Y(l),Y(l),W,this.queryChecked(l));}if(b<U.length-1){f.addDisabledMenuItem("","sep");}}return f;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.css","mstrmojo.vi.ui.ElementsBrowser","mstrmojo.vi.ui.IncHierarchyCheckList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var G=mstrmojo.css,A=mstrmojo.mstr.EnumDSSXMLObjectTypes;var E="36px";mstrmojo.vi.ui.HierarchyElementsCheckListBrowser=mstrmojo.declare(mstrmojo.vi.ui.ElementsBrowser,null,{scriptClass:"mstrmojo.vi.ui.HierarchyElementsCheckListBrowser",children:[{scriptClass:"mstrmojo.HBox",slot:"searchBoxNode",alias:"util",cssClass:"elemsBrowser-utils-bar",children:[{scriptClass:"mstrmojo.Box",cssClass:"eb-box-search",alias:"box",children:[{scriptClass:"mstrmojo.TextBox",alias:"searchBox",hint:"Search",cssClass:"eb-searchBox",onEnter:function B(){var O=this.value,M=this.parent.parent.parent,N=!M.searchPattern&&!O;if(!N){M.set("searchPattern",O);}this.blur();}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-clear",text:"",onclick:function(){var M=this.parent.searchBox;M.set("value","");M.cleanUp();M.focus();M.onEnter();},bindings:{visible:"(this.parent.searchBox.value || '').length > 0"}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-search",text:"",onclick:function(){var M=this.parent.searchBox;M.focus();M.onEnter();}}]}]},{scriptClass:"mstrmojo.HBox",slot:"buttonPanelNode",alias:"buttonPanel",cssClass:"elemsBrowser-button-panel"},{scriptClass:"mstrmojo.vi.ui.IncHierarchyCheckList",alias:"elementList",slot:"elementListNode",allowUnlistedValues:false,bindings:{disableLevel:"this.parent.disableLevel"},getDataHelper:function(){return this.parent.ifDataHelper;},getAttribute:function(){return this.parent.attribute;},isHiearachyDisplay:function F(){var M=this.parent;return !M.searchPattern||M.searchPattern==="";},setSelectedItems:function J(M){if(typeof M==="object"){this.setSelectionByExprJSON(M);}},postSelectionChange:function I(){var M=this.getAttribute();if(M){this.parent.onItemsSelectionChange(this.buildSelectionExprJSON(M));}}}],init:function L(M){this._super(M);G.addWidgetCssClass(this,"hierarchy");if(this.disableLevel){G.addWidgetCssClass(this,"disable-level");}},postCreateChildren:function D(){var M=this.elementList;this.util.addChildren(M.getLevelPopupConfig());this.buttonPanel.addChildren([M.getAllButtonConfig(true),M.getAllButtonConfig(false)]);},onattributeChange:function H(M){var N=this.elementList;N.clearItems();this._super(M);},onsearchPatternChange:function C(){var N=this.elementList,M=N.isHiearachyDisplay();this._super();this.buttonPanel.set("visible",M);this.layoutConfig.h.buttonPanelNode=M?E:"0px";this.doLayout();},isObjSearchable:function K(M){return true;},onElementsListchange:mstrmojo.emptyFn,updateClearAllBtnState:mstrmojo.emptyFn,_set_selectedItems:null});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.num","mstrmojo.dom","mstrmojo.date","mstrmojo.Container","mstrmojo.VBox","mstrmojo.Button","mstrmojo.locales","mstrmojo._FormatDefinition","mstrmojo.mstr.EnumFunction","mstrmojo.ui.editors.controls.ComboBox","mstrmojo.vi.util.NumberFormatUtility");var M=mstrmojo.hash,c=mstrmojo.array,G=mstrmojo.num,J=mstrmojo._FormatDefinition,B=mstrmojo.css,a=mstrmojo.mstr.EnumFunction,L=mstrmojo.locales,H=mstrmojo.Button.newIconButton,O=mstrmojo.date,I=mstrmojo.vi.util.NumberFormatUtility,u="1234.12",E=J.NumberFormatCategory,q=J.FixedNegative,F=J.CurrencyNegative,f=J.PercentNegative,K=J.DefaultFormat.FormattingNumber,o="nf-MiddleRow ",X="nf-MiddleRow nf-HasWidget ",Z,U,e=function e(x,w){return{cls:this.value===x.v?"selected":"",v:x.v||"",n:x.n||"",style:x.r?"color:red;":"color:#fff;",sel:parseInt(this.idx,10)===w?"selected":""};},p={RIGHT:1,LEFT_WITH_SPACE:2,RIGHT_WITH_SPACE:3};var S=[{n:mstrmojo.desc(4531,"Automatic"),v:-3}].concat(J.Category.slice(2)),d=[{n:"$"},{n:""},{n:""},{n:""},{n:"fr."}];function D(z,x){var w=c.find(z,"v",x);return w===-1?"":z[w].f;}function N(w){var z=this.parent.parent.parent.myData,x=w.v;z.set("format",D(this.items,x));z.set("negativeNumbers",x);B.toggleClass(this.selectedNode,"red",w.r);}function Y(z,AA,w){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:z,onitemSelected:function x(AB){var AC=this.parent;while(AC&&(!AC.data||typeof AC.data[AA]==="undefined")){AC=AC.parent;}if(AC){AC.data.set(AA,AB.v);if(w){AC.children[0].preview.preview_label.set("text",AB.n);}}}};}function j(AH,AC,AB,AK,AG){var AJ=M.clone(AH),x=AC>0?L.number.DECIMALSEPARATOR:"",z=AC>0?".":"",AA=J.DefaultFormat.FormattingNumber,AI=new RegExp("\\"+L.number.THOUSANDSEPARATOR,"g"),w=new RegExp("\\"+L.number.DECIMALSEPARATOR+"\\d{2}","g"),AE;for(AE=0;AE<AC;AE++){x+=AE%9;z+="0";}for(AE=0;AE<AJ.length;AE++){var AF=AJ[AE];AF.n=AF.n.replace(/,/g,"@");AF.n=AF.n.replace(/\./g,L.number.DECIMALSEPARATOR);AF.n=AF.n.replace(/@/g,L.number.THOUSANDSEPARATOR);if(AB){AF.n=AF.n.replace(AI,"");AF.f=AF.f.replace(/,/g,"");}if(AK&&AK!==AA.CurrencyPosition){switch(AK){case p.RIGHT:AF.n=AF.n.replace(/\$/g,"").replace(w,L.number.DECIMALSEPARATOR+"12$");AF.f=AF.f.replace(/"\$"/g,"").replace(/\.\d{2}/g,'.00"$"');break;case p.LEFT_WITH_SPACE:AF.n=AF.n.replace(/\$/g,"$ ");AF.f=AF.f.replace(/\$/g,"$ ");break;case p.RIGHT_WITH_SPACE:AF.n=AF.n.replace(/\$/g,"").replace(w,L.number.DECIMALSEPARATOR+"12 $");AF.f=AF.f.replace(/"\$"/g,"").replace(/\.\d{2}/g,'.00" $"');break;default:}}AF.n=AF.n.replace(w,x);AF.f=AF.f.replace(/\.\d{2}/g,z);if(AG&&AG!==AA.CurrencySymbol){var AD=AG.replace(/\$/g,"$$$$");AF.n=AF.n.replace(/\$/g,AD);AF.f=AF.f.replace(/\$/g,AD);}AF.cls=AF.r?"red":null;}return AJ;}function V(z){var w="1"+(z>0?".":"").toString(),AA="0"+(z>0?".":"").toString(),x;for(x=0;x<z;x++){w+=x%10;AA+="0";}return[w+"E+03",AA+"E+0#"];}function R(AK,AM){var AE="\u00A4",AI=/"[^"]*"/g,z=AK.match(AI),AN="\u0091",AJ=/\[[^\]]*\]/g,w=AK.match(AJ),AH,AL;AH=AK.replace(AI,AE);AH=AH.replace(AJ,AN);var AB=AK.indexOf("."),AG=G.getDecimalLength(AK),AD=Math.max(0,AG+AM),AA=AK.match(/\d(?!((\d)|(,\d)))/g),x=AB!==-1?AK.charAt(AB-1):AA&&AA[0],AF=(x||"0")+(AD>0?".":"").toString();for(var AC=0;AC<AD;AC++){AF+="0";}AH=AH.replace(AG===0?/\d(?!((\d)|(,\d)))/g:/\d\.\d+/g,AF);AH=AH.split(AE);AL=AH[0];c.forEach(z,function(AP,AO){AL+=AP+AH[AO+1];});AH=AL.split(AN);AL=AH[0];c.forEach(w,function(AP,AO){AL+=AP+AH[AO+1];});return AL;}function P(AE,w,AD,AC,z,x){var AB=AE.parent.parent.parent,AA=j(w,AD.decimalPlaces,AC,z,x);AD.set("format",D(AA,AD.negativeNumbers.toString()));AE.set("items",AA);AE.set("selectedIndex",c.find(AA,"v",AD.negativeNumbers.toString()));AB.preview.preview_label.set("text",I.applyFormatToNumber(AB.myData.format,u.replace(/\./g,L.number.DECIMALSEPARATOR)));}function m(){var AF=this.parent.parent,AJ=AF.myData,AA=AF.formatterContainer,x=S[AF.categoryPicker.selectedIndex].v,AM=this.funcType===a.FunctionLeftStr?1:-1,AC=null,AE=null,AB=false,AL=0,AG=null,z=false,AI;switch(x){case E.Fixed:AC=AA.fixed_hBox.negativeDDL;AE=q;AB=!AJ.thousandSeparator;break;case E.Currency:AC=AA.currency_hBox2.negativeDDL;AE=F;AL=AJ.currencyPosition;AG=AJ.currencySymbol;break;case E.Percentage:AC=AA.percentage_hBox.negativeDDL;AE=f;break;case E.Scientific:z=true;break;case E.Custom:AI=true;break;default:return ;}if(AI){var AK=R(AJ.format,AM);AF.preview.preview_label.set("text",I.applyFormatToNumber(AK,u.replace(".",L.number.DECIMALSEPARATOR)));AF.formatterContainer.custom_text.set("value",AK);return ;}var AD=AJ.decimalPlaces,w=AD+AM;w=Math.max(0,w);w=Math.min(J.MaxNegativeDidigts,w);AJ.set("decimalPlaces",w);if(z){var AH=V(w);AJ.set("format",AH[1]);AF.preview.preview_label.set("text",AH[0]);}else{P(AC,AE,AJ,AB,AL,AG);}}function t(w,x){return Math.max(c.find(w,"v",x),0);}function C(z){var x=this.parent.parent.categoryPicker,w=S.map(function(AA){return AA.v;}).indexOf(z);x.set("selectedIndex",w);}function n(w,x,AA,z){return H(undefined,w,x,undefined,M.copy(z,{useRichTooltip:true,updateTooltipConfig:function(){this.richTooltip={cssClass:"vi-regular vi-tooltip-A A-center",content:AA,refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPCENTER,left:15,top:33};}}));}function b(){if(mstrApp.isSingleTier&&!mstrmojo.dom.isMac()){var AC=this.formatterContainer,AB=L.datetime,w={day:7,month:4,year:1998},z={hour:9,min:41,sec:46},AA=AB&&AB.DATEINPUTFORMATS,x=AB&&AB.TIMEINPUTFORMATS;Z=[];U=[];AA.forEach(function(AD){Z.push({v:AD,n:O.formatDateInfo(w,AD)});});x.forEach(function(AD){U.push({v:AD,n:O.formatTimeInfo(z,AD)});});AC.date_ddl.set("items",Z);AC.time_ddl.set("items",U);}else{Z=J.Date;U=J.Time;}}mstrmojo.vi.ui.NumberFormatter=mstrmojo.declare(mstrmojo.VBox,null,{scriptClass:"mstrmojo.vi.ui.NumberFormatter",cssClass:"NumberFormatter-content",formatValue:null,myData:null,oldData:null,categoryPicker:null,formatterContainer:null,preview:null,shortcutRow:null,adjustAfterCategoryChange:mstrmojo.emptyFn,preBuildRendering:function(){if(this._super){this._super();}b.call(this);var w=this.formatterContainer;if(this.formatValue){w.currency_hBox1.currency_symbol.selectedValue=this.formatValue.currencySymbol;w.fixed_btn.checked=!!this.formatValue.thousandSeparator;B.addWidgetCssClass(w.fraction_ddl,f[c.find(f,"v",this.formatValue.negativeNumbers)].r?" red":"");}},postBuildRendering:function Q(){if(this._super){this._super();}if(this.formatValue){this.categoryPicker.set("selectedIndex",t(this.categoryPicker.items,this.formatValue.category.toString()));}},children:[M.copy({alias:"categoryPicker",cssClass:"nf-category",onitemSelected:function l(AK){if(!this.hasRendered){return ;}var AF=this,AI=AF.parent,AA=AI.formatterContainer,w=AI.shortcutRow,AJ=AI.preview.preview_label,AH=AK.v,AC=AH===E.Automatic,z=AH===E.Scientific,x=[],AE=AI.myData;c.forEach(AA.children,function(AL){AL.set("visible",false);});AI.border.set("visible",!AC);AI.preview.set("visible",!AC);AI.borderBottom.set("visible",!(!mstrApp.isWSStyling||AC||z));["border","moveLeftBtn","moveRightBtn"].forEach(function(AL){w[AL].set("visible",!AC);});AE.set("category",AH);AE.set("thousandSeparator",AH?K.ThousandSeparator:AI.formatValue.thousandSeparator);switch(AH){case E.Currency:P(AA.currency_hBox2.negativeDDL,F,AE,false,AE.currencyPosition,AE.currencySymbol);AA.currency_hBox1.currency_position.set("selectedIndex",t(J.CurrencyPosition,AE.currencyPosition.toString()));x=["currency_hBox1","currency_hBox2"];break;case E.Date:AA.date_ddl.set("selectedIndex",t(Z,AE.format));x=["date_ddl"];break;case E.Time:AA.time_ddl.set("selectedIndex",t(U,AE.format));x=["time_ddl"];break;case E.Percentage:P(AA.percentage_hBox.negativeDDL,f,AE,false,0,null);x=["percentage_hBox"];break;case E.Fraction:AA.fraction_ddl.set("selectedIndex",t(J.Fraction,AE.format));x=["fraction_ddl"];break;case E.Scientific:var AD=V(AE.decimalPlaces||0);AE.set("format",AD[1]);AJ.set("text",AD[0]);break;case E.Custom:var AB=AE.customText||AE.format,AG=AA.custom_text;AE.set("format",AB);AG.value=AB;AG.refresh();AJ.set("text",I.applyFormatToNumber(AB,u.replace(".",L.number.DECIMALSEPARATOR)));x=["custom_condense","custom_text"];break;case E.Fixed:P(AA.fixed_hBox.negativeDDL,q,AE,!AE.thousandSeparator,0,null);x=["fixed_hBox","fixed_btn"];break;}c.forEach(x,function(AL){AA[AL].set("visible",true);});AI.adjustAfterCategoryChange();}},Y(S,"category")),{scriptClass:"mstrmojo.Box",cssClass:o+"nf-shortcut",alias:"shortcutRow",border:null,moveLeftBtn:null,moveRightBtn:null,children:[n("nf-shortcut-currency",function h(){C.call(this,E.Currency);},mstrmojo.desc(2051,"Currency"),undefined),n("nf-shortcut-percentage",function h(){C.call(this,E.Percentage);},mstrmojo.desc(2053,"Percentage"),undefined),n("nf-shortcut-fixed",function h(){C.call(this,E.Fixed);this.parent.parent.formatterContainer.fixed_btn.set("checked",true);},mstrmojo.desc(2050,"Fixed"),undefined),{scriptClass:"mstrmojo.Label",cssClass:"shortcut-border",alias:"border"},n("nf-MoveDecimalPoint left",function h(){m.call(this);},mstrmojo.desc(2189,"Increase Decimal"),{funcType:a.FunctionLeftStr,alias:"moveLeftBtn"}),n("nf-MoveDecimalPoint right",function h(){m.call(this);},mstrmojo.desc(2188,"Decrease Decimal"),{funcType:a.FunctionRightStr,alias:"moveRightBtn"})]},{scriptClass:"mstrmojo.Label",alias:"border",cssClass:"nf-border"},{scriptClass:"mstrmojo.Container",alias:"formatterContainer",cssClass:"nf-buttons",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"></div>',fixed_hBox:null,fixed_btn:null,currency_hBox1:null,currency_hBox2:null,date_ddl:null,time_ddl:null,percentage_hBox:null,fraction_ddl:null,custom_condense:null,custom_text:null,markupSlots:{containerNode:function W(){return this.domNode;}},children:[{scriptClass:"mstrmojo.HBox",alias:"fixed_hBox",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(w){N.call(this,w);}},Y([],"format"))]},{scriptClass:"mstrmojo.CheckBox",alias:"fixed_btn",cssClass:o,label:"",onclick:function h(){var w=this.parent.parent;w.myData.set("thousandSeparator",this.checked?-1:0);P(this.parent.fixed_hBox.negativeDDL,q,w.myData,!this.checked,0,null);},preBuildRendering:function A(){this.set("label",mstrmojo.desc(13898,"Use 1000 Separator(#)").replace("#",L.number.THOUSANDSEPARATOR));}},{scriptClass:"mstrmojo.HBox",alias:"currency_hBox1",cssClass:X,visible:true,currency_symbol:null,currency_position:null,children:[{scriptClass:"mstrmojo.ui.editors.controls.ComboBox",alias:"currency_symbol",cssClass:"nf-CurrencySymbol",selectedValue:"$",items:d,postselectedValueChange:function k(w){var AB=this,AA=AB.parent.parent.parent,z=w.value,x=AA.myData;x.set("currencySymbol",z);P(this.parent.parent.currency_hBox2.negativeDDL,F,x,false,parseInt(x.currencyPosition,10),z);}},M.copy({cssClass:"nf-CurrencyPosition align-right",alias:"currency_position",onitemSelected:function l(w){var AA=this,z=AA.parent.parent.parent,x=w.v;z.myData.set("currencyPosition",parseInt(x,10));P(this.parent.parent.currency_hBox2.negativeDDL,F,z.myData,false,parseInt(x,10),z.myData.currencySymbol);}},Y(J.CurrencyPosition,"currencyPosition"))]},{scriptClass:"mstrmojo.HBox",alias:"currency_hBox2",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(w){N.call(this,w);}},Y([],"format"))]},M.copy({alias:"date_ddl",cssClass:X},Y(J.Date,"format",true)),M.copy({alias:"time_ddl",cssClass:X},Y(J.Time,"format",true)),{scriptClass:"mstrmojo.HBox",alias:"percentage_hBox",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(w){N.call(this,w);}},Y([],"format"))]},M.copy({alias:"fraction_ddl",cssClass:X},Y(J.Fraction,"format",true)),mstrmojo.Button.newWebButton(mstrmojo.desc(13893,"Condense (e.g.10M)"),function(){this.parent.custom_text.set("value",'[>=1000000]#,##0,,"M";[>=1000]#,##0,"K";0;[<=-1000000]#,##0,,"M";[<=-1000]#,##0,"K"');},false,{cssClass:"nf-condense",alias:"custom_condense"}),{scriptClass:"mstrmojo.TextBox",alias:"custom_text",cssClass:"nf-custom",onvalueChange:function g(){var z=this,x=z.parent.parent,w=z.value;x.myData.set("format",w);x.myData.set("customText",w);z.parent.parent.preview.preview_label.set("text",I.applyFormatToNumber(w,u.replace(".",L.number.DECIMALSEPARATOR)).replace(/\s/g,"&nbsp;"));}}]},{scriptClass:"mstrmojo.Label",alias:"borderBottom",cssClass:"nf-border"},{scriptClass:"mstrmojo.HBox",alias:"preview",cssClass:o+"nf-PreviewRow",preview_label:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"preview_lable",text:mstrmojo.desc(13892,"Preview:")},{scriptClass:"mstrmojo.Label",cssClass:"align-right preview-info-label",alias:"preview_label"}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(14036,14037,14038,14467,14928);var O=mstrmojo.array,P=mstrmojo.css,K=mstrmojo.hash,F=mstrmojo.warehouse.dbroles.DBRoleHelper,G=mstrmojo.DI.DIHelpers,Q="MSTR_CUSTOM=true;",J=mstrmojo.desc(14036,"Show connection string"),A=mstrmojo.desc(14037,"Hide connection string"),N=mstrmojo.desc(14038,"Edit connection string");mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor",cssClass:"mstrmojo-wh-DBRoleSettingConnectionStringEditor",enabled:true,getValue:function D(){if(this.visibleContents&&this.enabledContents){var U=this.contents.connectionArea.value;U=F.cleanDSNConnection(U+(U.slice(-1)===";"?"":";")+Q);return U;}return"";},setValue:function B(U){var X=this.contents;this.toggleContents();X.editString.setValue(true);var W=F.cleanDSNConnectionPlaceHolders(U);if(G.getEnvObj().isWSMac()&&G.isLocalWS()){var V=W.match(/;MSTR_JDBC_JAR_FOLDER=[^;]+;$/);if(V){W=W.substring(0,V.index);}}W=W.replace(/MSTR_CUSTOM=true;$/,"");X.connectionArea.set("value",W);},isValid:function M(){return{val:true,msg:""};},connectionArea:undefined,driverList:undefined,showLabel:undefined,editString:undefined,info:{},drivers:[],enableFn:mstrmojo.emptyFn,generateConnectionStringFn:mstrmojo.emptyFn,dbID:{},dbms:{},load:function E(){var b=this.contents,d=this.dbID,X=this.dbms,V=d.dbVersions[O.find(d.dbVersions,"v",X.db_ver)],e=V.connections.concat(V.altconnections),W=F.driverExists.call(this,e),Y={},Z=[];O.forEach(this.dbIDVersions,function(c){O.forEach(c.dbVersions,function(f){O.forEach(f.connections.concat(f.altconnections),function(g){Y[g.driver]=g;});});});var U;K.forEach(this.drivers,function(c){U=mstrmojo.hash.clone(c);if(Y[c.n]){U.n=U.n+" (Certified)";U.title=U.n;U.str=Y[c.n].str;}Z.push(U);});b.driverList.set("items",Z);if(W.exists){var a=O.find(this.drivers,"n",W.driver);if(a<0){a=0;}b.driverList.set("selectedID",Z[a].n);}this.updateString();},visibleContents:false,enabledContents:false,toggleContents:function S(){this.visibleContents=!this.visibleContents;this.contents.set("visible",this.visibleContents);this.showLabel.set("text",(this.visibleContents?A:J));if(!this.visibleContents){this.contents.editString.setValue(false);this.enableFn(true);}else{this.load();}},updateString:function H(){if(this.visibleContents){this.contents.connectionArea.set("value",F.cleanDSNConnectionPlaceHolders(this.generateConnectionStringFn()));}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ShowConnection",alias:"showLabel",text:J,onclick:function R(){this.parent.toggleContents();}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionStringContents",alias:"contents",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",label:N,alias:"editString",oncheckedChange:function I(){var U=this.parent;U.parent.enableFn(!this.checked);U.connectionArea.set("enabled",this.checked);P.toggleClass(this.parent.CSLabel.domNode,"disabled",!this.checked);U.driverList.set("enabled",this.checked);U.parent.enabledContents=this.checked;}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",cssClass:"mstrmojo-wh-DBRolePulldown mstrmojo-wh-DBRoleConnection-driverList",caption:mstrmojo.desc(14467,"Driver"),alias:"driverList",itemIdField:"n",itemField:"n",enabled:false,bindings:{visible:function(){var U=this.parent.parent;return(U.dbID.connType&4)!==4;}},preBuildRendering:function C(){if(this._super){this._super();}},onChange:function L(U){var V=this.parent.parent,X=this.parent.parent.contents,W;if(V.enabledContents){W=U.str||"";}X.connectionArea.set("value",F.cleanDSNConnectionPlaceHolders(V.generateConnectionStringFn(W).replace(Q,"")));}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString-Label",alias:"CSLabel",enabled:false,text:mstrmojo.desc(14928,"Connection String"),bindings:{visible:function(){return !!mstrApp.isWorkstation;}}},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString",value:"",alias:"connectionArea",maxLength:1024,enabled:false,preBuildRendering:function C(){if(this._super){this._super();}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.string","mstrmojo.Editor","mstrmojo.warehouse.WHModel","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(8538,8513,2523,2399,13708,1162,11134,15858);var D=mstrmojo.hash,I=mstrmojo.array,G=mstrmojo.dom,K=mstrmojo.string,M=mstrmojo.warehouse.WHModel.DssCatalogFlags,L=mstrmojo.warehouse.dbroles.DBRoleHelper,J=mstrmojo.DI.DIHelpers;function E(){var N={position:{}};var O=G.position(this.titleContainerNode,true);N.position.top=O.h+O.y;return N;}function C(O,Q){var N="list";var P={field:O.field,fieldV:Q[O.field]||O.defaultValue,IDS:O.IDS,tp:O.tp,req:O.req};if(O.tp===N){P.options=O.options;}return P;}function F(N){var Z=this.data.dbRole,U=Z.dbmsObj.DBInfo,Q=Z.connstr,Y=N||Z.ab,S,a=null,V=[];if(Z.def){Z.db_ver=Z.def.dbv;}S=Z.db_ver;var P=this.DBInfo.DBS[I.find(this.DBInfo.DBS,"id",Y)];if(P){var X=P.dbVersions[I.find(P.dbVersions,"v",S)];if(X){a=X.connections.concat(X.altconnections);var R=L.extractParams(a,Q);if(R.noDriverMatched){if(!N){var O=L.getFallbackDB(Y,this.DBInfo.dbIDs);if(O&&O.dbID){F.call(this,O.dbID);return ;}}}else{this.connectionTemplate=a[R.matchIndex].str;var W=L.getSelectedDBPSection(X.DBPS,R).DBP;I.forEach(W,function(b){V.push(C(b,R));});}}U.n=P.n;}U.DBS=[{dbVersions:[{DBPS:[{DBP:V}]}]}];}function H(V,R,W){if(!H.cache){H.cache={};}var Q=this.connectionStringBox.connectionStringArea.value;var N=H.cache;if(!N[V]){var P=new RegExp("[;,]([^;,=]+)=\\s*@"+K.regEscape(V));var O=P.exec(this.connectionTemplate);if(O){N[V]=O[1].trim().toUpperCase();}else{return Q;}}var X=N[V];var S=new RegExp("("+K.regEscape(X)+")\\s*=\\s*"+K.regEscape(R),"i");var U="$1="+W;return Q.replace(S,U);}function B(){var N=this.dbInfoBox,V=this.dsnlessBox,P=this.data.dbRole,U,Q=P.dbmsObj,O=function O(Z){var X,W=mstrmojo.desc(Z.IDS,Z.n),Y=Z.fieldV;if(W&&W[W.length-1]!==":"){W+=":";}switch(Z.tp){case"token":X=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:W,value:"",isRequired:Z.req,onvalueChange:function(a){var c=this.parent.parent;var b=H.call(c,Z.field,a.valueWas,a.value);c.connectionStringBox.connectionStringArea.set("value",b);}});break;case"text":case"number":X=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:W,value:Y});X.set("text",Y);break;case"list":X=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:W,itemIdField:"v",itemField:"v"});X.render();X.set("items",Z.options);X.set("selectedID",Y);break;case"boolean":X=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:W,driverMode:1});X.render();X.setValue(Y);break;}if(Z.tp!=="token"){X.set("enabled",false);}return X;};U=Q.DBInfo.DBS[0]&&Q.DBInfo.DBS[0].dbVersions[0].DBPS[0].DBP;if(U){mstrmojo.array.forEach(U,function(W){N.addChildren([O(W)]);});}var S=Q.DBInfo.n;var R=D.walk("def.dbmsv",Q);V.database.set("enabled",false);V.database.list.set("value",S);V.version.set("enabled",false);V.version.list.set("value",R?R:Q.n);this.txtlogin.set("text",P.ln||"");this.txtpwd.set("text",P.password||"");this.txtname.set("text",P.n);this.txtname.set("enabled",false);this.connectionStringBox.connectionStringArea.set("value",P.connstr);}mstrmojo.onetier.vi.ui.DBCredentialEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.ui.DBCredentialEditor",title:"Data Source",data:undefined,DBInfo:null,connectionTemplate:null,cssClass:"mstrmojo-DBCredentialEditor",children:[{alias:"dsnlessBox",scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"database",caption:mstrmojo.desc(8538,"Database:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dsnBox",scriptClass:"mstrmojo.Box",visible:false,children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dsn",caption:"dsn:"},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"version",caption:mstrmojo.desc(2523,"Version:")}]},{alias:"dbInfoBox",scriptClass:"mstrmojo.Box",visible:true,isValid:function(){var N={val:true,msg:""};I.forEach(this.children,function(O){N=O.isValid();return N.val;});return N;}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,isRequired:true,caption:mstrmojo.desc(1162,"password:")},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",caption:mstrmojo.desc(11134,"ds name:")},{scriptClass:"mstrmojo.Box",alias:"connectionStringBox",cssClass:"mstrmojo-DBCredentialEditor-connectionBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",text:mstrmojo.desc(14928,"Connection String")+":",enabled:false},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-wh-DBRoleConnection-ConnectionString mstrmojo-DBCredentialEditor-connectionBox-textArea",value:"",alias:"connectionStringArea",maxLength:1024,enabled:false}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",alias:"buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"OK",text:mstrmojo.desc(13708,"Test & Save Changes"),onclick:function(){var S=this.parent.parent,Q=S.data,X=S.dbInfoBox,V=S.txtlogin,R=S.txtpwd,P=S.connectionStringBox.connectionStringArea.value,Z,W,O=function(){mstrmojo.error({shortDesc:mstrmojo.desc(15858,"The connection to the database failed. Please check the connectivity information and try again.")},mstrmojo.emptyFn,{enableContactStr:false});},U=function(a){if(a.dbr||!(mstrApp.isSingleTier&&!(mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode()))){Q.set("credentialsFetched",true);Q.dbRole.ln=V.getValue();Q.dbRole.password=R.getValue();S.close();}else{O();}};Z=X.isValid();if(!Z.val){mstrmojo.alert(Z.msg);return ;}Z=V.isValid();if(!Z.val){mstrmojo.alert(Z.msg);return ;}Z=R.isValid();if(!Z.val){mstrmojo.alert(Z.msg);return ;}W=E.call(S);if(mstrApp.isSingleTier&&!(mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode())){mstrApp.serverRequest({taskId:"setDBCredentials",dbroleinfo:JSON.stringify(D.copy({ln:V.getValue(),password:R.getValue(),connstr:P},D.copy(Q.dbRole)))},{success:function Y(a){U(a);}},{doNotHold:true,showProgress:true},W);}else{mstrApp.serverRequest({taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(D.copy({ln:V.getValue(),password:R.getValue(),connstr:P},D.copy(Q.dbRole)))},{success:function Y(b){var c=mstrApp.docModelData||(mstrApp.launchingApp&&mstrApp.launchingApp.docModelData),a=c&&c.mid;mstrApp.serverRequest({taskId:"arch.catalogAction",dbrid:b.dbr.did,flags:M.DssCatalogApplyConnectionMapping|M.DssCatalogGetNamespaces,msgid:a,sessionState:mstrApp.sessionState,styleName:"RWDocumentMojoStyle"},{success:function(d){U(d);},failure:function(d){O();}},{doNotHold:true,silent:true});},failure:function N(a){O();}},{doNotHold:true,waitBoxCfg:W});}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var N=this.parent.parent;N.close();N.destroy();}}]}],postBuildRendering:function A(O){this._super(O);var N=this;var P=E.call(this);mstrApp.serverRequest({taskId:"arch.getDBObjects",flags:8},{success:function(Q){N.DBInfo=J.applyDriverSuffix(Q.DBInfo);F.call(N);B.call(N);N.positionDialog();}},{showProgress:true,hideFailureErr:false,waitBoxCfg:P},P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.architect.ui.editors.DataSourceEditor","mstrmojo.warehouse.EnumObjectTypes");var J=mstrmojo.array,C=mstrmojo.architect.menu.EnumMenuActions,L=mstrmojo.warehouse.EnumObjectTypes,E=mstrmojo.desc(11398,"Functionality not yet implemented."),G=mstrmojo.desc(6722,"Are you sure you want to delete '##'?"),I="Are you sure you want to delete these ## objects?";var K=false;function F(P,N){var O=this.data,M=(O&&O.length)?O[0]:O;return(M&&M[P])?M[P](O,N):true;}mstrmojo.architect.menu.ArchitectMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.architect.menu.ArchitectMenu",dynamicUpdate:true,queryEnabled:function H(M){return F.call(this,"isEnabled",M)||K;},queryVisible:function D(M){return F.call(this,"isVisible",M)||K;},queryChecked:function B(M){return F.call(this,"isChecked",M)||K;},executeCommand:function(W){var V=mstrmojo.architect.menu.ArchitectMenu.EnumRelationType,Q=this.data,R=mstrApp.getRootController(),P=Q.parentAttributeId,M=Q.childAttributeId,N=Q.relationTableId;switch(W.action){case C.NONE:break;case C.DELETE:var O;if(Q.length){O=I.replace("##",Q.length);}else{O=G.replace("##",Q.n);}mstrmojo.confirm(O,{confirmBtn:{fn:function(){R.deleteObject(Q);}}});break;case C.RENAME:R.renameObject(Q);break;case C.AUTOMAP:R.autoMapTable([].concat(Q));break;case C.SAMPLE_DATA:R.showSampleData(Q);break;case C.CONVERT_ATTR_TO_FACT:R.convertAttributeToFact(Q);break;case C.CONVERT_ATTR_TO_FORM:R.convertAttributeToForm(Q,W);break;case C.LOGICAL_TABLE_SIZE:R.setTableLogicalSize(Q);break;case C.CONVERT_COLUMN_TO_FORM:R.convertColumnToForm(Q,W);break;case C.SET_AS_MULTILINGUAL:R.setAsMultiLingual(Q);break;case C.CONVERT_FACT_TO_ATTR:R.convertFactToAttribute(Q);break;case C.REMOVE_FROM_TABLE:R.removeFromTable(Q);break;case C.SET_AS_LOOKUP:R.setAsLookup(Q);break;case C.NEW_FACT:W.tp=L.FACT;W.isNew=true;R.openExpressionEditor(Q,W);break;case C.NEW_ATTR:W.tp=L.ATTRIBUTE;W.isNew=true;R.openExpressionEditor(Q,W);break;case C.UPDATE_FORMAT:R.updateFormFormat(Q,W);break;case C.EDIT:W.tp=Q.tp;W.isNew=false;R.openExpressionEditor(Q,W);break;case C.MAPPING:R.updateMappingMethod(Q,W);break;case C.UPDATE_AGGR:R.updateAggregation(Q,W);break;case C.REMOVE_TABLE:R.removeFromCurrentLayer(Q);break;case C.ADD_ATTRIBUTE:R.createAttribute(Q);break;case C.ADD_FACT:R.createFact(Q);break;case C.DATA_SOURCES:var U=mstrmojo.all[this._dseid]||new mstrmojo.architect.ui.editors.DataSourceEditor({onSubmit:function S(X){R.setTableDBRoles(X);}});this._dseid=U.id;U.open(undefined,{dataSources:R.getTableDBRoles(Q)});break;case C.REMOVE_ATTR_FROM_RELATIONSHIP:R.removeAttributeFromRelation(Q);break;case C.DELETE_RELATIONSHIP:R.removeRelation(P,M);return ;case C.ONE_TO_ONE:R.updateRelation(P,M,V.ONE_TO_ONE,N);break;case C.ONE_TO_MANY:R.updateRelation(P,M,V.ONE_TO_MANY,N);break;case C.MANY_TO_MANY:R.updateRelation(P,M,V.MANY_TO_MANY,N);break;case C.RELATIONSHIP_TABLE_ENTRY:R.updateRelation(P,M,Q.relationType,W.did);break;case C.SHOW_UNUSED_COLUMNS:R.changeLayerTableColumnView([].concat(Q),W);break;case C.ADD_TO_LAYER:R.addOrRemoveTables([].concat(Q),true);break;case C.REMOVE_FROM_LAYER:R.addOrRemoveTables([].concat(Q),false);break;case C.UPSTRUCT:R.handleUpdateStructures([].concat(Q));break;case C.CREATE_ALIAS:R.createTableAlias([].concat(Q));break;case C.LINKS:R.showLinks(Q);break;case C.UPDATE_CATEGORY:R.updateFormCategory(Q,W);break;case C.UNGROUP_FORMS:R.unGroupForms(Q,W);break;case C.UPDATE_GROUP:R.groupForms([Q],W);break;case C.UNGROUP_FORM:R.unGroupForms(Q,W);break;case C.TX_ONE_TO_ONE:R.setTransformationCardinality(Q.did,true);break;case C.TX_MANY_TO_MANY:R.setTransformationCardinality(Q.did,false);break;case C.TX_APPLY_TO_ALL:R.setTransformationAllAttributes(Q.did,true);break;case C.TX_APPLY_TO_HIGHEST:R.setTransformationAllAttributes(Q.did,false);break;case C.SET_ENTRY_POINT:R.addEntryPoint(Q.attributeId);break;case C.REMOVE_ENTRY_POINT:R.removeEntryPoint(Q.attributeId);break;case C.ATTRIBUTE_FILTERS:R.editFilters(Q.attributeId,undefined,undefined);break;case C.ADD_JOIN_CHILDREN:R.addJointChildren(Q,W.did);break;case C.USE_AS_DRILL:R.updateHiearchySubtype(true);break;case C.USE_AS_BROWSE:R.updateHiearchySubtype(false);break;default:mstrmojo.alert(E);break;}},getMenuConfig:function A(N){var Q=new mstrmojo.ui.menus.MenuConfig(),R=this.id,O=false,M,P=N||this.cm;J.forEach(P,function(U){M=U.action===C.NONE;if(this.queryVisible(U)){var S=["xt "+(U.icn||"")],V=function V(){this.executeCommand(U);};if((this.queryEnabled(U)===false)||M){if((M&&!O)||!M){if(M){Q.addSeparator();}else{Q.addDisabledMenuItem(U.n,S.join(" "));}}if(M){O=true;}}else{if(U.items){Q.addSubMenuItem(U.n,"",R,U.buildSubMenuConfig||this.getMenuConfig,U.items);O=false;}else{if(U.hasEdt){Q.addEditorMenuItem(U.n,R,U.buildSubMenuConfig);O=false;}else{Q.addToggleMenuItem(U.n||"",S.join(" "),V,V,R,this.queryChecked(U));O=false;}}}}},this);return Q;}});mstrmojo.architect.menu.ArchitectMenu.EnumRelationType={ONE_TO_ONE:1,ONE_TO_MANY:2,MANY_TO_MANY:4,PARENT_CHILD:0};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.Label","mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.ui.WaitBoxTip");mstrmojo.requiresDescs(14185,2901,14187);var Z=mstrmojo.array,F=mstrmojo.dom,D=mstrmojo.DI.DIConstants,O=mstrmojo.desc(14185,"Search for a namespace"),P=mstrmojo.desc(2901,"Loading..."),L=mstrmojo.desc(14187,"Update namespaces"),S=mstrmojo.warehouse.EnumDataChangeEvents,R="WaitBoxTip",I=20,W=mstrmojo.desc(15258,"Namespace"),E="...",N=mstrmojo.DI.DIHelpers;var C=31;mstrmojo.ui.PopupListForNS=mstrmojo.declare(mstrmojo.ui.PopupList,null,{scriptClass:"mstrmojo.ui.PopupListForNS",onclick:function(b){if(b.getTarget().className.indexOf("disabled")!==-1){return false;}else{this._super(b);}}});mstrmojo.warehouse.ui.NameSpacePullDown=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.architect.ui.NameSpacePullDown",cssClass:"mstrmojo-wh-NameSpacePullDown",visible:false,pulldown:undefined,btnRefreshNS:undefined,selectedIndex:undefined,waitBoxTip:undefined,labelNS:undefined,keepNamespacesVisible:false,sourceInfoLoadedByRefreshBtn:undefined,children:[{scriptClass:"mstrmojo.Label",alias:"labelNS",cssClass:"mstrmojo-wh-labelNS",text:W.length>I?W.substring(0,I-E.length)+E:W,title:W,useRichTooltip:true,updateTooltipConfig:function(){var b=F.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(b.y+b.h*1.2,0),left:Math.max(b.x+b.w*0.5,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},visible:false},{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"pulldown",isHostedWithin:false,scrollNodeMaxHeight:350,hostedCSSClass:"mstrmojo-wh-Panel.AvailableTables",visible:false,nameSpacesLoaded:undefined,renderOnScroll:true,updateText:function V(b){this.selectedNode.textContent=b;},onPopupWidgetOpened:function X(){this.getPopupWidget().set("width",mstrmojo.dom.position(this.domNode).w+"px");},onPopupWidgetClosed:function B(){this.set("isEditing",false);var b=this.getPopupList(),c=b._oldItems;delete b._oldItems;if(c&&(!c[0].cls||c[0].cls.indexOf("disabled")===-1)){this.setDefaultListAndIndex(c);}},onitemSelected:function H(b){if(this.parent.mode===1){this.parent.selectedIndex=this.selectedIndex;if(this.parent.onItemSelectedCallback){this.parent.onItemSelectedCallback(b);}}else{this.parent.selectedIndex=undefined;}},getPopupListConfig:function(){var b=mstrmojo.ui.Pulldown.prototype.getPopupListConfig();b.scriptClass="mstrmojo.ui.PopupListForNS";return b;}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-btnRefreshNS",alias:"btnRefreshNS",visible:false,onclick:function a(){if(this.parent.catalogRefreshNS&&typeof this.parent.catalogRefreshNS==="function"){this.parent.catalogRefreshNS();}else{var b=mstrApp.getRootController(),c=b.model;if(b instanceof mstrmojo.qb.bigquery.RootController||b instanceof mstrmojo.qb.bigquery.ESController){b.getNameSpaces();}else{c.catalogRefresh=true;if(this.parent.sourceInfoLoadedByRefreshBtn!==undefined){c.sourceInfo=this.parent.sourceInfoLoadedByRefreshBtn;}b.updateSelectedDBRoleId();}}},title:L,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var b=F.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",top:Math.max(b.y+34,0),left:Math.max(b.x-8,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});},onvisibleChange:function M(b){if(this.parent&&this.parent.domNode){var c=this.parent.domNode.clientWidth||parseInt(this.parent.width,10);if(typeof c==="number"&&c>0){if(mstrApp.isWorkstation){this.parent.pulldown.set("width",c-(this.visible?(this.domNode.clientWidth==0?28:this.domNode.clientWidth):0)+"px");}else{this.parent.pulldown.set("width",c-(this.visible?this.domNode.clientWidth:0)+"px");}}}}}],onwidthChange:function J(b){var c=parseInt(b.value,10);if(c>0){this.pulldown.set("width",c-(this.btnRefreshNS.visible?this.btnRefreshNS.domNode.clientWidth:0)+"px");if(this.waitBoxTip){this.waitBoxTip.adjustCorners();}}},onvisibleChange:function M(b){if(this&&this.domNode){var c=this.domNode.clientWidth||parseInt(this.width,10);if(this.visible&&typeof c==="number"&&c>0){this.pulldown.set("width",c-this.btnRefreshNS.domNode.clientWidth+"px");if(this.waitBoxTip){this.waitBoxTip.adjustCorners();}}}},postBuildRendering:function Y(){var c=this;if(this._super){this._super();}if(F.isIE8||F.isIE9){mstrmojo.css.addClass(this.domNode,"ie9");}if(!mstrmojo.all[R]){mstrmojo.insert({scriptClass:"mstrmojo.warehouse.ui.WaitBoxTip",cssClass:"mstrmojo-WaitBoxTip",id:R,adjustCorners:function b(){var d=this;if(c&&c.domNode){var g=F.getComputedMargin(c.pulldown.domNode)[3],e=F.getComputedMargin(c.btnRefreshNS.domNode)[3],f=F.getComputedMargin(c.labelNS.domNode)[1];setTimeout(function(){var h=mstrmojo.dom.position(c.domNode);d.set("width",((c.domNode.clientWidth||parseInt(c.width,10))-(c.btnRefreshNS.visible?c.btnRefreshNS.domNode.clientWidth:0)-(c.labelNS.visible?c.labelNS.domNode.clientWidth:0)-g-e-f)+"px");d.set("position",{left:h.x+(c.labelNS.visible?c.labelNS.domNode.clientWidth:0)+g+f+"px",top:(h.y+c.domNode.clientHeight)+"px"});},300);}}});}this.waitBoxTip=mstrmojo.all[R];},init:function U(c){this._super(c);var f=this,d={},b=d[this.id]={};b[S.NAMESPACES_CHANGED]=function e(g){f.loadNameSpaces(g);};b[S.NAMESPACES_REQUESTED]=function e(g){f.preLoadNameSpaces(g);};b[S.NAMESPACES_CANCELED]=function e(g){f.afterCancelNameSpaces(g);};mstrApp.getRootController().attachDataChangeListeners(d);},mode:0,afterCancelNameSpaces:function A(b){var c=this.pulldown.getPopupList().visible;if(c){this.pulldown.getPopupList().close();}this.mode=0;this.pulldown.set("items",[{n:""},{n:L}]);this.pulldown.updateText(L);this.pulldown.set("visible",true);this.set("visible",true);this.btnRefreshNS.set("visible",true);this.labelNS.set("visible",true);if(D.xdaType.qbSingleTable===mstrApp.type){this.pulldown.domNode.style.maxWidth="153px";}},preLoadNameSpaces:function K(b){if(!((this.sourceInfo===b.sourceInfo)||(b.sourceInfo==="")||(b.sourceInfo===undefined))){return ;}this.set("visible",true);this.pulldown.set("visible",true);this.btnRefreshNS.set("visible",true);this.labelNS.set("visible",true);this.mode=0;var d=[];if(this.sourceInfo==="tablesPanel"){d[0]={n:""};this.pulldown.set("items",d);this.pulldown.set("selectedIndex",0);this.pulldown.updateText(O);var e=this.domNode.clientWidth||parseInt(this.width,10),g=F.getComputedMargin(this.pulldown.domNode)[3],c=F.getComputedMargin(this.btnRefreshNS.domNode)[3],f=F.getComputedMargin(this.labelNS.domNode)[1];this.waitBoxTip.showWait({message:P,showCancel:true,cancelCallback:this.cancelNamespace,extraCls:D.xdaType.qbSingleTable===mstrApp.type?"extraCls-selectTables":undefined,position:{left:F.position(this.domNode).x+(this.labelNS.visible?this.labelNS.domNode.clientWidth:0)+g+f+"px",top:(F.position(this.domNode).y+this.domNode.clientHeight)+"px"},width:(e-(this.btnRefreshNS.visible?this.btnRefreshNS.domNode.clientWidth:0)-(this.labelNS.visible?this.labelNS.domNode.clientWidth:0)-g-c-f)+"px"});}else{if(this.parent.parent.parent){d[0]={n:""};d[1]={n:P};this.pulldown.set("items",d);if(!this.keepNamespacesIndexUnselectedBeforeLoading){this.pulldown.set("selectedIndex",0);}this.labelNS.set("visible",true);this.pulldown.set("visible",true);this.set("visible",true);this.pulldown.updateText(O);}}},cancelNamespace:function G(){mstrApp.getRootController().cancelLoadNameSpaces();},loadNameSpaces:function Q(h){if(this.waitBoxTip){this.waitBoxTip.closeWait();}if(!((this.sourceInfo===h.sourceInfo)||(h.sourceInfo==="")||(h.sourceInfo===undefined))){return ;}var c=h.namespaces||[],k=true,l=h.dbRoleID,e,j,m=-1;if(c.length===0){c.push({n:""});k=false;}c=c.sort(function(p,o){return p.n.toLowerCase().localeCompare(o.n.toLowerCase());});var n=this.pulldown,g=n.selectedNode.innerHTML,f=n.getPopupList(),b=f.visible,d=this.keepNamespacesVisible||k;if(b){f.close();}this.mode=1;n.set("items",c);n.set("visible",d);this.labelNS.set("visible",d);this.set("visible",d);this.btnRefreshNS.set("visible",d);if(!k&&!h.error){n.set("selectedIndex",0);}this.dbRoleID=l;if(this.nameSpacesLoaded){this.nameSpacesLoaded();}if(k){if(this.sourceInfo==="tablesPanel"||b){n.openPopup(f);}if(mstrApp.getRootController().isUsingCookieNamespace()){e=window.localStorage;j=(e&&e.getItem(l));m=Z.find(c,"n",j);}if(m>=0){n.set("selectedIndex",m);}else{n.updateText(g);}if(g&&g!==O){n.processSearch();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown");var G=13,F=mstrmojo.array;mstrmojo.DI.DISearchableTextBox=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,null,{scriptClass:"mstrmojo.DI.DISearchableTextBox",allowCustomInput:true,allowCustomText:true,editOnClick:true,editOnDoubleClick:true,isInputTip:true,inputTip:"",onclick:function I(){this.set("isEditing",true);var J=this[this.editableSlot];if(this.isInputTip){J.textContent="";}},onmousedown:function C(J){var K=J.getTarget();if(K===this.selectedNode){var L=this.getPopupList();if(!L.visible&&L.items.length>0){L.open(this);}J.cancel();}},onPopupWidgetClosed:function D(){var M=this.getPopupList(),N=M._oldItems,K=this.text;delete M._oldItems;if(N){var J=F.find(N,"n",K);if(J===-1&&!this.allowCustomText){var L=M.items[0]||N[0];J=F.find(N,"n",L.n);}M.set("items",N);}},onkeydown:function E(K){this._super(K);var J=this;if(K.e.keyCode===G){window.setTimeout(function(){J.onitemSelected(null,-1);},0);}},populateList:function H(){var Q=this.getPopupList();var M=mstrApp.getRootController().model.wikiSuggestions;var K=[],P=Q._oldItems||Q.items;var L;if(M.length===0){Q.set("visible",false);return ;}if(M){for(L=0;L<M.length;L++){K.push({n:M[L],rgt:""});}}var O=this.selectedNode.innerText||this.selectedNode.textContent||"";var N=mstrmojo.string.trim(O),J=N.toUpperCase();Q._spft=J;Q.set("items",K);Q.selectedIndex=-1;Q.adjustCornersForPopupOverflow();delete Q._spft;Q._oldItems=P;if(!Q.visible){Q.open(this);}},onkeyup:function B(K){if(this._super){this._super(K);}var L=this.getPopupList();var J=this.selectedNode.innerText||this.selectedNode.textContent||"";if(!J||J.length===0){L.set("visible",false);this.text=this.inputTip;this.isInputTip=true;}else{this.isInputTip=false;mstrApp.getRootController().scrapeWiki(J,true);}},postBuildRendering:function A(){if(this._super){this._super();}var K=this.domNode;mstrmojo.dom.attachEvent(K,"paste",function J(M){var L="";setTimeout(function(){L=K.children[0].innerText;L=L.replace(/<\/?.+?>/g," ").replace(/[\r\n]/g," ").replace(/\r/g," ").replace(/\n/g," ").replace(/\s+/g," ");K.children[0].innerText=L;});});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.array","mstrmojo.Button","mstrmojo.css","mstrmojo.hash","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown","mstrmojo.func");mstrmojo.requiresDescs(221,1442,2751,2891,11949,11950,11951,11942,13397,13398,14640,14648);var R=mstrmojo.array,V=mstrmojo.css,N=mstrmojo.hash,O=mstrmojo.func,M=mstrmojo.Button.newWebButton,P=mstrmojo.dom,U="mstrmojo-link-validation",Q="mstrmojo-link-vt",F=function F(W){if(W.old){this.removedLinks.push(W);}this.links.removeChildren(W);},S=function S(){var w=this.dsMap,q=this.docModel,Z=q.datasets,AA=function AA(j,x,a){var k={n:a||"",did:x||null,parent:j||null,lv:(j?j.lv+1:-1),children:[]};if(j){j.children.push(k);}return k;},f=AA(),Y,X,W,h,b,t,m,z,u,p,o,n,d,c,e,l,g;N.forEach(Z,function(a){if(q.isMDXDataset(a)){b=a.tables;for(p=0,c=b.length;p<c;p++){t=b[p];Y=AA(f,t.did,t.n);Y.isMDX=true;for(o=0,e=t.dimensions.length;o<e;o++){m=t.dimensions[o];X=AA(Y,m.did,m.n);for(n=0,l=m.hierarchies.length;n<l;n++){z=m.hierarchies[n];W=AA(X,z.did,z.n);for(d=0,g=z.att.length;d<g;d++){u=z.att[d];h=AA(W,u.did,u.n);h.att=u;w[t.did+":"+u.did]=h;}}}}}else{Y=AA(f,a.did,a.name);Y.isMDX=false;R.forEach(a.att,function(j){h=AA(Y,j.did,j.n);h.att=j;w[a.did+":"+j.did]=h;});}});return f;},B=function B(c,d){c=R.ensureArray(c);var b=this,a=this.attribute.did,e=this.docModel,Y=this.datasetId,X="\u001F",W={success:function(g){var j=g.als,f=(e.als&&e.als.links)||{},h=b.dsTree;R.forEach(c,function(t,m){var u={},k={},l=[],n={},q=a+" "+t,o=R.filter(j[m].ats,function(w){return !e.isInDataset(Y,w.at,["att"]);}),p=function p(w,x){if(!n[w]){n[w]={};}if(!n[w][x]){n[w][x]=true;}};R.forEach(o,function(z){var w=z.at,x=z.fms;u[w]=true;if(x){R.forEach(x,function(AA){p(w,AA.fm);});}});N.keyarray(f).forEach(function(w){if(w===q){R.forEach(f[w],function(x){x=x.split(" ");u[x[0]]=true;p(x[0],x[1]);});}});if(N.keyarray(u).length>0){R.forEach(h.children,function(x){var w=function(z){var AA;if(!z.att){return ;}z=z.att;if(u[z.did]){if(!k[z.n]){k[z.n]={};}if(!k[z.n][z.did]){k[z.n][z.did]=[];}k[z.n][z.did].push(x.n);AA=N.copy(z,AA);AA.dsId=x.did;l.push(AA);}};if(x.isMDX){R.forEach(x.children,function(z){R.forEach(z.children,function(AA){R.forEach(AA.children,w);});});}else{R.forEach(x.children,w);}});}b.tgtAttrs[t]=l;b.tgtForms[t]=n;b.namesHash[t]=k;});}},Z={taskId:"validateDocumentLinks",msgID:e.mid,action:1,attributeList:a,attributeFormList:c.join(X)};mstrApp.serverRequest(Z,O.wrapMethods(W,d));},E=function(Z,b,X,a){Z.richTooltip=null;if(!Z.isSearching){var Y=b&&b.scrollWidth>b.clientWidth;X=Y?mstrmojo.desc(14648,"## from ###").replace("##",X):"";if(a){if(!Y){X=mstrmojo.desc(14640,"From ###");}X=X.replace("###",a);}var W=mstrmojo.dom.position(b);Z.richTooltip={cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:X,top:W.y-6,left:W.x};}},D=function D(d){var e=this,g=function(o){var m=o.fs,p=o.de,n=[];(m||[]).forEach(function(q){if(q.obf&&(!p||q.idf)){n.push({n:q.fnm,v:q.fid,idf:q.idf});}});return n;},h=g(this.attribute),a=function(p,n){var m=g(p);var q=(e.tgtForms[n]&&e.tgtForms[n][p.did])||{};var o=[];R.forEach(m,function(t){if(q[t.v]){o.push(t);}});return o;},c=function c(n){var m=[];R.forEach(e.tgtAttrs[n],function(o){if(a(o,n||e.idFormId).length>0){var q=e.namesHash[n],p=o.n;if(q[o.n]&&N.keyarray(q[o.n]).length>1){p=p+" ("+q[o.n][o.did].join(",")+")";}m.push({n:o.n,v:o,tt:p});}});if(m.length===0){m.push({n:mstrmojo.desc(13398,"No valid object"),v:{did:null},cls:"nvo",t:1});}return m;},j=c((d&&d.srcFormId)||this.idFormId),k=function(m,n){return R.find(m.fs,n?"fid":"idf",n||true);},l=function(n){var m=-1;j.forEach(function(p,o){if(p.v.did===n){m=o;}});return m;},X=function(n){var m=j[n];if(!m){return mstrmojo.desc(13397,"Select an attribute");}else{return m.n;}},Y=function(n){var o=n.items,m=n.selectedIndex;if(m>=0){if(o[m].idf){return ;}}o.forEach(function(q,p){if(q.idf){n.set("selectedIndex",p);}});};this.links.addChildren({scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-linkRow",slot:"containerNode",old:!!d,oldMeta:d,getMeta:function(){var m=this.linkFromForm,o=this.linkToAtt,n=this.linkToForm;return{srcAttrId:e.attribute.did,srcFormId:m.items[m.selectedIndex].v,tgtAttrId:o.items[o.selectedIndex]&&o.items[o.selectedIndex].v.did,tgtFormId:n.items[n.selectedIndex]&&n.items[n.selectedIndex].v};},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-attName",text:e.attribute.n,useRichTooltip:true,updateTooltipConfig:function(q){var p=q.target,m=this.text,n=e.datasetId,o=n?e.docModel.datasets[n].name:"";E(this,p,m,o);}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-linkFormFromPD",alias:"linkFromForm",value:"ID",isHostedWithin:true,items:h,selectedIndex:k(e.attribute,d&&d.srcFormId),onitemSelected:function(n){var m=this,o=function(){var q=m.parent.linkToAtt;j=c(n.v);q.set("items",j);q.set("selectedIndex",-1);q.set("text",mstrmojo.desc(13397,"Select an attribute"));V.addClass(q.selectedNode,"nvo");},p={success:o};if(this.hasRendered){if(this.parent.old){this.parent.oldUpdated=true;}if(!n.idf){Y(this.parent.linkToForm);if(!e.tgtForms[n.v]){B.call(e,n.v,p);return ;}}o();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-linksToLabel",text:mstrmojo.desc(11949,"links to")},{scriptClass:"mstrmojo.ui.SearchablePulldown",cssClass:"mstrmojo-linkToAtt",alias:"linkToAtt",useRichTooltip:true,isHostedWithin:false,items:j,text:X(l(d&&d.tgtAttrId)),selectedIndex:l(d&&d.tgtAttrId),allowCustomText:true,allowEmptyText:true,updateTooltipConfig:function(t){var q=t.target,m=q.getAttribute("tt"),o=this.getSelectedItem(),n=o?o.v.dsId:null,p=n?e.docModel.datasets[n].name:"";if(this.selectedNode===q&&o){m=o.tt;}E(this,q,m,p);},onitemSelected:function(q){if(!q||q.v.did===null){return ;}var p=this.parent.linkToForm,o=this.parent.linkFromForm,n=a(q.v,o.items[o.selectedIndex].v),t=function t(u,x){var w=R.find(u,x?"v":"idf",x||true);if(w===-1&&u.length>0){w=0;}return w;},m;R.forEach(n,function(u){if(u.idf){m=false;return false;}});if(m){K.call(e,true);}p.set("items",n);p.set("selectedIndex",t(n,!this.hasRendered&&d&&d.tgtFormId));if(this.hasRendered&&this.parent.old){this.parent.oldUpdated=true;}J.call(e);},onPopupWidgetOpened:function b(){if(this.selectedIndex===-1){this.set("text","");}V.removeClass(this.selectedNode,"nvo");},onPopupWidgetClosed:function f(){mstrmojo.ui.SearchablePulldown.prototype.onPopupWidgetClosed.call(this);if(this.selectedIndex===-1&&this.text===""){this.set("text",mstrmojo.desc(13397,"Select an attribute"));V.addClass(this.selectedNode,"nvo");}else{V.removeClass(this.selectedNode,"nvo");}this.hideTooltip();R.forEach(e.collapseTargets,function(m){m.className="arrow-b";V.removeClass(m.parentNode.parentNode,"collapse");});R.forEach(e.collapseTreeNodes,function(m){delete m.collapse;});R.forEach(this.list.itemsContainerNode.childNodes,function(m){m.style.display="";});},postBuildRendering:function W(){mstrmojo.ui.SearchablePulldown.prototype.postBuildRendering.call(this);if(this.selectedIndex===-1){V.addClass(this.selectedNode,"nvo");}this.list.popupConfig.clear();},getPopupListConfig:function Z(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",width:"170px",tooltipOrientation:"vertical",selectionPolicy:"reselect",useRichTooltip:true,locksHover:true,listHooks:{select:function m(u,w,t){this.parent.set("selectedIndex",t);this.close();}},onclick:function n(AD){try{var u=AD.getTarget(),AE=this.getItemFromTarget(u),AA=P.findAncestorByAttr(u,"idx",true,this.domNode),z=this.items;if(z){this.parent.set("items",z);}if(AE){AD.cancel();if(u.className==="arrow-b"||u.className==="arrow-r"){var t=this.itemsContainerNode.childNodes,x=function x(AG){var AF;while(AG){AF=AG.className||"";if(AF.indexOf("lv")===0){return window.parseInt(AF.substring(2),10);}AG=AG.firstChild;}return null;},AC=function AC(AF,AI){var AH=e.dsMap,AG=AH[AF.dsId+":"+AF.did];while(AG){if(AG.lv===AI){return AG;}AG=AG.parent;}return null;},AB=function AB(){var AO=(u.className==="arrow-b"),AI=u.parentNode.parentNode,AF=x(AI),AJ=AE._renderIdx,AG=AC(AE.v,AF),AM=z.length,AL,AH,AK,AN,AQ,AP;u.className=AO?"arrow-r":"arrow-b";if(!e.collapseTargets){e.collapseTargets=[];}e.collapseTargets.push(u);V.toggleClass(AI,"collapse",AO);AG.collapse=AO;if(!e.collapseTreeNodes){e.collapseTreeNodes=[];}e.collapseTreeNodes.push(AG);for(AL=AJ+1;AL<AM;AL++){AH=t[AL];AK=x(AH);if(AK<=AF){break;}AN=AC(z[AL].v,AK);AQ=AN.parent;AP=true;while(AQ){if(AQ.collapse){AP=false;break;}AQ=AQ.parent;}AH.style.display=(AP?"":"none");}};AB();}else{if(AA&&AA.node.className.indexOf("item")!==-1){this.doItemSelect(AE,AD||{});}}}}catch(w){mstrApp.onerror(w);}},getItemProps:function o(w,t){var u=mstrmojo._IsList.getItemProps.call(this,w,t);var x=w.cls;if(x){u.addCls(x);}return u;},getItemMarkup:function q(AF,AE){if(AF.v.did===null){return'<{@tag} class="item {@cls}" did="'+AF.v.did+'" idx="{@idx}" style="{@style}">{@n}</{@tag}>';}var AG=[],AC=AF.v.did,w=AF.v.dsId,x=w?e.docModel.datasets[w]:null,u=x?x.name:"",AD=AE>0&&this.items[AE-1].v,AA=e.dsMap,z=AA[AF.v.dsId+":"+AC],t=AA[(AD&&(AD.dsId+":"+AD.did))];AG.push("</div>");while(z){if(z.lv===-1){break;}if(z.att){var AB=z.att.da?"derived-attr":"attr";AG.push('<div class="lv'+z.lv+' dim item {@cls}" tt="'+AF.tt+'" did="'+AC+'" dsName="'+u+'" idx="{@idx}" style="{@style}"><div><div class="'+AB+'"></div></div>{@n}</div>');}else{if(z!==t){AG.push('<div class="lv'+z.lv+' dim" dtt="'+z.n+'" idx="{@idx}"><div><div class="arrow-b"></div></div>'+z.n+"</div>");}else{break;}}z=z.parent;t=(t&&t.parent)||null;}AG.push("<div>");return AG.reverse().join("");},updateTooltipConfig:function p(AA){var z=AA.target,w=z.getAttribute("tt"),u=z.getAttribute("dtt"),x=z.getAttribute("dsName"),t=w||u;if(t){E(this,z,t,x);}}};}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-linkFormToPD",alias:"linkToForm",value:"ID",isHostedWithin:true,items:[],onitemSelected:function(m){if(this.hasRendered){if(this.parent.old){this.parent.oldUpdated=true;}if(!m.idf){Y(this.parent.linkFromForm);}}}},M("",function(){F.call(e,this.parent);},false,{cssClass:"mstrmojo-removeLink"})]});this.links.renderChildren();},K=function(W){V.toggleClass(this.editorNode,"mstrmojo-advanced",W);},L=function(Z){var X=this,a=U,W;try{mstrmojo.all[a].destroy();}catch(Y){}W={scriptClass:"mstrmojo.Editor",id:a,title:mstrmojo.desc(2751,"Message"),cssClass:"mstrmojo-alert",buttons:[M(mstrmojo.desc(1442,"Ok"),function(){mstrmojo.all[a].destroy();H.call(X);},true)],children:[{scriptClass:"mstrmojo.Label",text:Z}],visible:true,zIndex:1000};mstrmojo.insert(W).render();},H=function(){var Y=this,X=this.illLinks,W=this.links.children,Z=Q;R.forEach(X,function(a){a=a.al;R.forEach(W||[],function(c){var e=c.getMeta(),f=c.linkToAtt,b,d;if(e.srcAttrId===a.alaid1&&e.tgtAttrId===a.alaid2){if(!mstrmojo.all[Z]){d=new mstrmojo.Tooltip({id:Z,cssClass:Y.themeClassName+" vi-warning vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,updatePopupConfig:null});P.attachEvent(Y.editorNode,"click",function(){d.close();V.toggleClass(f.selectedNode,"mstrmojo-Warning",false);});}else{d=mstrmojo.all[Z];}d.close();b=mstrmojo.dom.position(f.selectedNode);d.set("top",b.y-6);d.set("left",b.x);d.set("content",a.alstmsg);V.toggleClass(f.selectedNode,"mstrmojo-Warning",true);d.open();return false;}});});},A=function(){var W=mstrmojo.all[Q];if(W){W.close();}},J=function J(){this.buttons[0].enabled=true;if(this.btnHbox){this.btnHbox.children[0].set("enabled",true);}},G=function G(){var W=this,X=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-toolBox",alias:"tools",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-addLink",text:mstrmojo.desc(11950,"Add A Link"),title:mstrmojo.desc(11950,"Add A Link"),onclick:function(){D.call(W);A.call(W);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-showForms",text:mstrmojo.desc(2891,"Show Attribute Forms"),title:mstrmojo.desc(2891,"Show Attribute Forms"),onclick:function(){K.call(W,true);A.call(W);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-hideForms",text:mstrmojo.desc(11951,"Hide Attribute Forms"),title:mstrmojo.desc(11951,"Hide Attribute Forms"),onclick:function(){K.call(W,false);A.call(W);}}],slot:"containerNode"},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-linksBox mstrmojo-advanced",alias:"links",slot:"containerNode"}];this.addChildren(X);};mstrmojo.vi.ui.editors.AttributeLinkEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.AttributeLinkEditor",title:mstrmojo.desc(11942,"Link Attributes"),cssClass:"mstrmojo-att-link",btnAlignment:"right",buttons:null,modal:true,visible:false,help:"link_attributes_editor.htm",attribute:null,tgtAttrs:null,tgtForms:null,docModel:null,datasetId:null,namesHash:null,removedLinks:null,preBuildRendering:function C(){var Z=this,X=this.docModel,Y=function(){var a=(X.als&&X.als.links)||{},b=[];N.keyarray(a).forEach(function(c){if(c.indexOf(Z.attribute.did+" ")===0){a[c].forEach(function(d){b.push({srcAttrId:c.split(" ")[0],srcFormId:c.split(" ")[1],tgtAttrId:d.split(" ")[0],tgtFormId:d.split(" ")[1]});});}});return b;},W;this.set("buttons",[M(mstrmojo.desc(1442,"OK"),function(){var h=[],b=Z.links.children,a=function(){var j=X.controller,k=X.controller.getRefreshCallback();if(h.length>0){j.cmdMgr.execute({execute:function(){this.submit(h,k,{style:{params:{treesToRender:3}}});},urInfo:{callback:k}});}Z.close();},g=false,d,e;Z.removedLinks.forEach(function(j){d=N.copy(j.oldMeta,{act:"applyAttributeLinking",unlink:true});h.push(d);});(b||[]).forEach(function(j){if(j.old&&j.oldUpdated){d=N.copy(j.oldMeta,{act:"applyAttributeLinking",unlink:true});h.push(d);}if(!j.old||(j.old&&j.oldUpdated)){e=j.getMeta();if(!e.tgtAttrId){return ;}d=N.copy(e,{act:"applyAttributeLinking",unlink:false});h.push(d);}});R.forEach(h,function(j){if(!j.unlink){g=true;return false;}});if(!g){a();return ;}var f={taskId:"validateDocumentLinks",msgID:X.mid,action:2,manipulationList:'{"ml":'+JSON.stringify(h)+"}"},c={success:function(j){if(j.als&&j.als.length>0){var k="";R.forEach(j.als,function(l){k+=l.al.alstmsg+"\n";});Z.illLinks=j.als;L.call(Z,k);return ;}a();}};mstrApp.serverRequest(f,c);},true,{enabled:false}),M(mstrmojo.desc(221,"Cancel"),function(){Z.close();})]);G.call(this);W=Y(this.attribute.did);if(W.length>0){W.forEach(function(a){D.call(Z,a);});J.call(this);}else{D.call(this);}this._super();},close:function I(){A.call(this);this.destroy();}});mstrmojo.vi.ui.editors.AttributeLinkEditor.open=function(c){var X=mstrmojo.insert(N.copy(c,{scriptClass:"mstrmojo.vi.ui.editors.AttributeLinkEditor",tgtAttrs:{},tgtForms:{},namesHash:{},removedLinks:[]})),a=X.attribute,d=a.did,W=X.docModel,Z=(W.als&&W.als.links)||{},Y=[],b={success:function(){X.set("visible",true);X.render();}};R.forEach(a.fs,function(e){if(e.idf){X.idFormId=e.fid;return false;}});N.keyarray(Z).forEach(function(f){var e=f.split(" ");if(e[0]===d){Y.push(e[1]);}});if(R.indexOf(Y,X.idFormId)===-1){Y.push(X.idFormId);}X.dsMap={};X.dsTree=S.call(X);B.call(X,Y,b);};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");var E=mstrmojo.css,D=mstrmojo.array,C=mstrmojo.DI.DIHelpers,J=mstrmojo.DI.DIConstants.DSSSubType,F=13;function H(K){D.forEach(K,function(L){var M=L.anc.items;L.title="";if(M){D.forEach(M,function(N){L.title+=N.n+"/";});}});}function G(){var P=this.selectedNode&&mstrmojo.string.trim(this.selectedNode.innerText||this.selectedNode.innerHTML),O=this,K,R,N,Q;if(!P||!O.isEditing){O.getPopupList()._oldItems=null;O.getPopupList().set("items",[]);O.getPopupList().set("visible",false);return ;}P=P.toString();P=P.replace(/<BR>/,"").replace(/<br>/,"").replace("\u00A0","\u0020");R={success:function S(W){Q=mstrmojo.string.trim(O.selectedNode.innerText||O.selectedNode.innerHTML);Q=Q.toString();Q=Q.replace(/<BR>/,"").replace(/<br>/,"").replace("\u00A0","\u0020");var X=O.getPopupList(),U=O.isMap2ProjAttr?D.filter(W.items,function(Z){return Z.st!==J.DSSSUBTYPEATTRIBUTETRANSFORMATION;}):W.items,V=false;if(Q===P){H(U);X._spft=(P||"").toUpperCase();O.set("items",U);X.set("items",U);if(!U||U.length===0){O.closePopup();}else{V=true;}}else{X._oldItems=null;O.set("items",[]);O.closePopup();}var Y=X._oldItems||X.items;if(V){O.openPopup(X);}delete X._spft;X._oldItems=Y;},failure:function M(U){if(O.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+U.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));}},complete:function L(){O.set("isEditing",true);E.removeClass(O.domNode,"wait");}};if(typeof microstrategy!=="undefined"&&microstrategy.useQuickSearch){K=microstrategy.useQuickSearch();}else{if(mstrApp&&mstrApp.isWorkstation){K=true;}else{K=false;}}N={styleName:"MojoFolderStyle",nameWildcards:K?16:1,blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:true,includeAncestorInfo:true,objectType:"12",quickSearch:K};N.searchPattern=K?P:P+"*";mstrApp.getRootController().getDataService().searchMetadata(R,N);}mstrmojo.DI.DISearchablePulldown=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,null,{scriptClass:"mstrmojo.DI.DISearchablePulldown",onPopupWidgetClosed:mstrmojo.emptyFn,onkeyup:function A(P){var L=window.event||P.e,K=this.getPopupList(),Q=this.selectedNode.innerText||this.selectedNode.textContent,R=Q.replace(/\n/g,""),M;if(L.keyCode===F){if(this.selectedNode.innerText){this.selectedNode.innerText=R;}else{this.selectedNode.textContent=R;}this.selectedNode.blur();this.set("isEditing",true);K._oldItems=null;if(this.items&&this.items.length){this.set("items",[]);}E.addClass(this.domNode,"wait");if(typeof microstrategy!=="undefined"&&microstrategy.enableQuickSearch){if(this._autoSearchTimer){self.clearTimeout(this._autoSearchTimer);}var O=1000,N=this;if(O){this._autoSearchTimer=self.setTimeout(function(){G.call(N);},O);}}else{G.call(this);}}else{M=(R||"").length>0;E.toggleClass(this.selectedNode,"clear",M);if(K._oldItems){K._oldItems=null;}if(this.items&&this.items.length){this.set("items",[]);}this.closePopup();}},onkeydown:function(L){var K=window.event||L.e;if(K.keyCode===F){K.preventDefault();return false;}},onclick:function I(K){var N=K.getTarget(),M=this.selectedNode,L=K.e.offsetX>=(M.offsetWidth-19),O=this.getPopupList();if(N===this.selectedNode&&!L){this.set("isEditing",true);if(!O.visible&&this.items&&this.items.length>0){this.openPopup(O);}else{this.closePopup();}}if(L&&this.selectedNode.className.indexOf("clear")>=0){this.set("text","");this.set("isEditing",true);E.toggleClass(this.selectedNode,"clear",false);this.set("selectedIndex",-1);this.set("items",[]);O._oldItems=null;this.closePopup();}K.cancel();},_set_items:function B(O,L){var M=this.items,K=this.getPopupList(),N;if(this.isEditing){delete this.selectedIndex;this.items=L;K.set("items",L);N=(M!==L);}else{N=this._super(O,L);}return N;},onselectedIndexChange:function(){var K=this.selectedIndex;if(this._super){this._super();}if(K>=0){E.toggleClass(this.selectedNode,"clear",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineSearchablePulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(629,6052,6051,12316,12317,12318,12319,12320,12321,4728,14539,14540,14541,14542,12327,12328,12329,12330,12331,12332,12333,12334,12335,14268,14269,14270,12339,12340,12341,12342,12343,12344,12345,3627,12346,14274,1388,12347,12348,12349,13647,13884,13957,13958,12575,12577,190,14514,14515,14516,14738,14739);var H=mstrmojo.Refine.RefineConstants;var C=mstrmojo.css;var I=mstrmojo.dom;var E=[{name:mstrmojo.desc(629,"Delete"),type:H.transformationType.Delete,items:[{name:mstrmojo.desc(12575,"Delete Column"),subType:H.transformationSubType.DeleteColumn},{name:mstrmojo.desc(12577,"Delete Row"),subType:H.transformationSubType.DeleteRow},{name:mstrmojo.desc(12316,"Remove Duplicate Cells"),subType:H.transformationSubType.RemoveDuplicateCells},{name:mstrmojo.desc(12317,"Remove Duplicate Rows"),subType:H.transformationSubType.RemoveDuplicateRows,noColumn:true},{name:mstrmojo.desc(14738,"Delete Row Included In Selectors"),subType:H.transformationSubType.DeleteRowsInTheView},{name:mstrmojo.desc(14739,"Delete Row Not-included In Selectors"),subType:H.transformationSubType.DeleteRowsNotInTheView}]},{name:mstrmojo.desc(12318,"Extract"),type:H.transformationType.Extract,items:[{name:mstrmojo.desc(12319,"Extract By Fixed Length"),subType:H.transformationSubType.ExtractByFixedLength},{name:mstrmojo.desc(12320,"Extract Before Separator"),subType:H.transformationSubType.ExtractBeforeSeparator},{name:mstrmojo.desc(12321,"Extract After Separator"),subType:H.transformationSubType.ExtractAfterSeparator}]},{name:mstrmojo.desc(4728,"Selector"),type:H.transformationType.Facet,items:[{name:mstrmojo.desc(14539,"Text Selector"),subType:H.transformationSubType.TextFacet},{name:mstrmojo.desc(14540,"Numeric Selector"),subType:H.transformationSubType.NumericFacet},{name:mstrmojo.desc(14541,"Timeline Selector"),subType:H.transformationSubType.TimelineFacet},{name:mstrmojo.desc(14542,"Text Search"),subType:H.transformationSubType.SearchFacet}]},{name:mstrmojo.desc(12327,"Find And Replace"),type:H.transformationType.FindAndReplace,items:[{name:mstrmojo.desc(12328,"Find And Replace Characters In Cell"),subType:H.transformationSubType.FindAndReplaceCharactersInCell},{name:mstrmojo.desc(12329,"Find And Replace Cell"),subType:H.transformationSubType.FindAndReplaceCell}]},{name:mstrmojo.desc(190,"Remove"),type:H.transformationType.RemoveText,items:[{name:mstrmojo.desc(14514,"Remove Characters"),subType:H.transformationSubType.RemoveTheText},{name:mstrmojo.desc(14515,"Remove Characters Before"),subType:H.transformationSubType.RemoveTheTextBefore},{name:mstrmojo.desc(14516,"Remove Characters After"),subType:H.transformationSubType.RemoveTheTextAfter}]},{name:mstrmojo.desc(12330,"Split"),type:H.transformationType.Split,items:[{name:mstrmojo.desc(12331,"Split By Fixed Length"),subType:H.transformationSubType.SplitByFixedLength},{name:mstrmojo.desc(12332,"Split On Separator"),subType:H.transformationSubType.SplitOnSeparator},{name:mstrmojo.desc(12333,"Split Before Separator"),subType:H.transformationSubType.SplitBeforeSeparator},{name:mstrmojo.desc(12334,"Split After Separator"),subType:H.transformationSubType.SplitAfterSeparator},{name:mstrmojo.desc(13884,"Split Cell Into Rows On Separator"),subType:H.transformationSubType.SplitCellIntoRows}]},{name:mstrmojo.desc(12335,"Transform Cell"),type:H.transformationType.TransformCell,items:[{name:mstrmojo.desc(14268,"To Title Case"),subType:H.transformationSubType.Titlecase},{name:mstrmojo.desc(14269,"To Uppercase"),subType:H.transformationSubType.Uppercase},{name:mstrmojo.desc(14270,"To Lowercase"),subType:H.transformationSubType.Lowercase},{name:mstrmojo.desc(12339,"Unescape HTML"),subType:H.transformationSubType.UnescapeHTML},{name:mstrmojo.desc(12340,"Change Data Type"),subType:H.transformationSubType.ChangeDataType},{name:mstrmojo.desc(12341,"Fill Down"),subType:H.transformationSubType.FillDown},{name:mstrmojo.desc(12342,"Blank Down"),subType:H.transformationSubType.BlankDown},{name:mstrmojo.desc(13957,"Pad Before"),subType:H.transformationSubType.PadBefore},{name:mstrmojo.desc(13958,"Pad After"),subType:H.transformationSubType.PadAfter}]},{name:mstrmojo.desc(12343,"Whitespace"),type:H.transformationType.Whitespace,items:[{name:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace"),subType:H.transformationSubType.TrimLeadingTrailingWhitespace},{name:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),subType:H.transformationSubType.CollapseConsecutiveWhitespace}]},{name:mstrmojo.desc(3627,"Other"),type:H.transformationType.Other,items:[{name:mstrmojo.desc(12346,"Cluster And Edit"),subType:H.transformationSubType.ClusterAndEdit},{name:mstrmojo.desc(14274,"Duplicate Column"),subType:H.transformationSubType.Duplicate},{name:mstrmojo.desc(1388,"Rename"),subType:H.transformationSubType.Rename},{name:mstrmojo.desc(12347,"Concatenate Columns"),subType:H.transformationSubType.ConcatenateColumns},{name:mstrmojo.desc(13975,"Transpose Columns To Rows"),subType:H.transformationSubType.TransposeColumnsToRows}]}];mstrmojo.Refine.RefineTransformations=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineTransformations",alias:"RefineTransformations",markupString:'<div class="refine-transformations" mstrAttach:mousedown><div class="refine-transformations-top"><div class="refine-transformations-columns"></div><div class="refine-transformations-functions"></div><div class="refine-transformations-control"></div></div><div class="refine-transformations-suggestions"></div></div>',markupSlots:{transformationNode:function(){return this.domNode.children[0];},columnsNode:function(){return this.domNode.children[0].children[0];},functionNode:function(){return this.domNode.children[0].children[1];},controlNode:function(){return this.domNode.children[0].children[2];},suggestionsNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function G(N,L){var J=parseInt(N,10);var M=parseInt(L,10);if(isNaN(J)||isNaN(M)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var O=44;C.toggleClass(this.domNode,"selected",true);var K=Math.floor(M*0.65);if(K<980){C.toggleClass(this.domNode,"short",true);}else{C.toggleClass(this.domNode,"short",false);}K=Math.max(Math.floor(M*0.65),618);this.layoutConfig.h.transformationNode=O+"px";this.layoutConfig.w.transformationNode=K+"px";this.layoutConfig.h.suggestionsNode=(J-O-14)+"px";this.layoutConfig.w.suggestionsNode=(K-14)+"px";if(this._super){this._super(J+"px",K+"px");}},postBuildRendering:function B(){this.setDimensions(this.parent.domNode.style.height,this.parent.domNode.style.width);if(this._super){this._super();}},onmousedown:function(J){var L=J.e,K=I.eventTarget(J.hWin,L);if(K.className.indexOf("mstrmojo-scrollbar")===-1){this.controller.isClickedInTransformation=true;I.stopPropogation(J.hWin,J.e);}},populate:function F(L){var J=[],K;for(K=0;K<L.columns.length;K++){J.push({n:L.columns[K].name,name:L.columns[K].name,columnIndex:K,cellIndex:L.columns[K].cellIndex,originalName:L.columns[K].originalName});}J.sort(function(N,M){return N.n.localeCompare(M.n);});this.columns.selectedIndex=null;this.columns.set("items",J);},handleColumnsChanged:function A(J){this.populate(J.value);},handleColumnSelected:function(L){var K,J=this.columns.list.items;for(K=0;K<J.length;K++){if(L.columnIndex===J[K].columnIndex){if(this.columns.list.selectedIndex!==K){this.columns.list.set("selectedIndex",K);}}}},handleColumnUnSelected:function(){this.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.columns.set("text",mstrmojo.desc(12348,"Select Column"));this.columns.selectedIndex=undefined;this.columns.list.set("selectedIndex",null);C.toggleClass(this.columns.domNode,"selected",false);this.transformationList.set("value",mstrmojo.desc(12349,"Select Function"));this.transformationList.set("text",mstrmojo.desc(12349,"Select Function"));this.transformationList.list.set("selectedIndex",null);this.transformationList.set("type",-1);this.transformationList.set("subType",-1);C.toggleClass(this.transformationList.domNode,"selected",false);C.toggleClass(this.transformationList.domNode,"disable",true);this.transformationList.selectedNode.title=mstrmojo.desc(13647,"Select a column for more functions");},children:[{slot:"columnsNode",scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-column-pulldown",cssClass:"refine-pulldown",alias:"columns",allowHTML:false,title:mstrmojo.desc(13647,"Select a column for more functions"),onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);C.toggleClass(this.parent.transformationList.domNode,"disable",false);this.parent.transformationList.selectedNode.title="";this.parent.controller.model.raiseEvent({name:"columnSelected",columnIndex:J.columnIndex,columnName:J.n,updateScrollLeft:true});if(this.parent.transformationList.subType===74){this.parent.transformationList.subType=-1;this.parent.transformationList.set("subType",74);}}},{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-transformation-pulldown",cssClass:"refine-pulldown disable",slot:"functionNode",alias:"transformationList",type:-1,subType:-1,preBuildRendering:function(){this.setItems();},setItems:function(){var V,U,K,N,R=[],Q,M,S;var O,L,P;P=mstrmojo.hash.clone(E);if(mstrApp.getRootController().refineApp.isBDE){P[0].items=P[0].items.slice(0,2);P.splice(2,1);}for(O=0;O<P.length;O++){Q=P[O];K=Q.name;S=Q.items;V={};V.type=Q.type;V.n=K;V.cls="refine-transformations-list-big";V.skipSearch=true;R.push(V);for(L=0;L<S.length;L++){V={};M=S[L];N=M.name;V.subType=M.subType;V.type=Q.type;U="refine-transformations-list-small";if(M.noColumn===true){V.noColumn=true;U="refine-transformations-list-small noColumn";}if(M.subType===H.transformationSubType.DeleteRowsInTheView||M.subType===H.transformationSubType.DeleteRowsNotInTheView){var J=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;if(!J.hasSelection()){V.disable=true;U="refine-transformations-list-small disable";}else{V.noColumn=true;U="refine-transformations-list-small noColumn";}}V.n=N;V.cls=U;R.push(V);}}this.set("items",R);},onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);this.set("noColumn",J.noColumn);this.set("subType",J.subType);this.set("type",J.type);},getPopupListConfig:function D(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,cssText:"",listHooks:{select:function J(M,P,L){var O=this.parent.parent;var N=O.columns.selectedIndex;if((N===undefined&&P.noColumn!==true)||P.subType===undefined||P.disable===true){return true;}this.parent.set("selectedIndex",L);this.close();}},getItemProps:function K(M,L){return mstrmojo._IsList.getItemProps.call(this,M,L);}};}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.StackContainer","mstrmojo.ui.CheckList","mstrmojo.DI.DIResourceAdmin","mstrmojo.DI.DIDBRoleAdmin","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(14460,14461);var C=mstrmojo.DI.DIConstants,D=mstrmojo.DI.DIHelpers,E=0,B=1;mstrmojo.DI.DISourceListAdmin=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DISourceListAdmin",mode:E,markupString:'<div id="{@id}" class="mstrmojo-di-sources-admin {@cssClass}"><div class="mstrmojo-di-source-headers"></div><div class = "mstrmojo-di-source-content"></div></div>',markupSlots:{headersNode:function(){return this.domNode.children[0];},contentsNode:function(){return this.domNode.children[1];}},onmodeChange:function(){this.contentStack.set("selected",this.contentStack.children[this.mode]);},children:[{slot:"headersNode",scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-di-source-menu",renderOnScroll:false,showIcon:false,selectedIndex:0,postselectionChange:function(F){var G=F.added&&this.items[F.added[0]].v;this.parent.set("mode",G);},items:[{n:mstrmojo.desc(14460,"Resources"),v:E},{n:mstrmojo.desc(14461,"Databases"),v:B}]},{scriptClass:"mstrmojo.StackContainer",alias:"contentStack",cssClass:"mstrmojo-di-source-content-stack",slot:"contentsNode",children:[{scriptClass:"mstrmojo.DI.DIResourceAdmin",visible:true},{scriptClass:"mstrmojo.DI.DIDBRoleAdmin",visible:false}]}],preBuildRendering:function(){if(this._super){this._super();}var F=mstrApp.getRootController().getModel();this.onmodeChange();F.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function(F){var G=Math.floor(parseInt(F.size.w,10));if(!isNaN(G)&&G>0){this.set("width",G+"px");}},onFinishButtonClick:function(){var F=this.contentStack;mstrApp.getRootController().saveSourceListAdminConfig(F.children[0].getAdminConfig(),F.children[1].getAdminConfig());},onBackButtonClick:function(){mstrApp.getRootController().showPage(C.pageType.dataSelection);},onCancelButtonClick:function(){mstrApp.getRootController().showPage(C.pageType.dataSelection);return true;},onHelpButtonClick:function A(){return"Displaying_and_hiding_data_sources_and_databases_f.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.Image","mstrmojo.Pulldown","mstrmojo.tooltip","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIModel","mstrmojo.locales","mstrmojo.date","mstrmojo.css","mstrmojo.string");var B=mstrmojo.array,E=mstrmojo.hash,C=mstrmojo.DI.DIHelpers,D=mstrmojo.string,A=mstrmojo.DI.DIConstants;mstrmojo.AS.DIPublishAppSchemaSheetsMatchEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.AS.DIPublishAppSchemaSheetsMatchEditor",cssClass:"mstrmojo-di-appschema-sheetsmatch-editor mstrmojo-di-scheduleEMMA refreshMode",title:"Match Worksheet",onOpen:function(){},onClose:function(){},postData:undefined,callback:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.Label",text:"Please make sure the updated worksheets are matched with the original ones."},{scriptClass:"mstrmojo.DataGrid",lockHeader:true,alias:"tablesheetsGrid",cssText:"height: 260px;",cssClass:"mstrmojo-di-tablesheets-list mstrmojo-di-tablestatuslist mstrmojo-di-appschema-tablestatuslist",columns:[{headerText:"Table",headerCss:"",dataField:"tableName",dataFunction:function(H,F,G){return H.tableName;}},{headerText:"Original worksheet",headerCss:"",dataField:"originalWorksheet",dataFunction:function(H,F,G){return H.originalWorksheet;}},{headerText:"Updated worksheet",headerCss:"",dataField:"updatedWorksheet",dataWidget:{scriptClass:"mstrmojo.Pulldown",popupZIndex:99999,popupToBody:true,isHostedWithin:false,colWidth:"230",onvalueChange:function(){var F=this.parent.parent,G=this.items[this.selectedIndex];F.postData[this.idx]["sheetIndex"]=G.sheetIndex;},bindings:{items:function(){return this.parent.parent.items[this.idx].updatedWorksheet;},selectedIndex:function(){var I=this.parent.parent.items,H=this.idx,J=I[H],G=J.updatedWorksheet[H],F=G.dssid||0,K=G.n;this.set("text",K);return F;}}}}]},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var F=this.parent;F.cancelCb();F.close();}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var F=this.parent;console.log(F.children[1].postData);F.callback(F.children[1].postData);F.close();}}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.Pulldown","mstrmojo.DI.DISearchablePulldown");mstrmojo.requiresDescs(221,1825,5369,13037,13242,13243,13244,13606,13642,13853,13989,14202,14203);var I=mstrmojo.array,K=mstrmojo.DI.DIConstants;function L(P,O){var N=P.did,M=P.n,Q={success:function(W){if(W.container){var U=W.container.dssforms||[],V,S;for(V=0,S=U.length;V<S;V++){U[V].aid=N;U[V].an=M;U[V].did=N+U[V].dssid;U[V].idf=U[0].dssid;}if(O&&O.success){O.success({items:U});}}}},R={attributeID:N,displayedForms:0};mstrApp.getRootController().getDataService().getAttributeForms(Q,R);}function E(R,b,Y){var X=R.formMaps;var a=b.n;var O=[];var Q=Y.items;var c,V,S,N;for(S=0;S<Q.length;S++){N=Q[S];if(N.dssid===N.idf){c=N;}}R.idForm=c;if(X&&X.length>0){mstrmojo.array.removeItem(Q,c);for(V=0;V<X.length;V++){O.push({did:X[V].did,dssid:(V===0)?c.idf:null,aid:b.did,projectFormMaps:Q,proAttrName:a,isMultiForm:true,fmid:X[V].fmid});}}else{var U=R.attribute;var W=mstrApp.getRootController().model,M=W.importSources[U.tableId],Z;if(M.currentTransformations&&M.currentTransformations.xtab&&M.currentTransformations.xtab.isCrosstab){Z=M.transformedMapping;}else{Z=M.currentMapping;}R.found=false;for(V=0;V<Z.length;V++){if(c&&((c.aid+c.dssid)===Z[V].afid||c.aid===Z[V].oid)){if(Q.length>1){R.found=true;R.set("found",true);R.set("formMaps",[{fmn:mstrmojo.desc(14202,"Default form")}]);mstrmojo.array.removeItem(Q,c);break;}else{var P=mstrmojo.desc(13989,"The project attribute '##' has a single form which has already been mapped within the current table.");mstrApp.getRootController().displayError(P.replace("##",c.an));return ;}}}O=[{isMultiForm:false,aid:Q[0].aid,dssid:Q[0].dssid,projectFormMaps:Q,proAttrName:a}];if(R.found){O[0].isMultiForm=true;}}R.set("projectAttribute",b);R.set("selections",O);R.validateForms();}mstrmojo.DI.ProjectAttributeItem=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.ProjectAttributeItem",editor:null,projectFormMap:null,item:null,visible:true,linkedColumnId:null,did:null,cssClass:"mstrmojo-di-projects-form-select",children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Pulldown",alias:"formPullDown",popupToBody:true,itemField:"n",itemIdField:"dssid",bindings:{popupZIndex:"this.parent.parent.editor.zIndex",linkedColumnId:"this.parent.parent.linkedColumnId"},preBuildRendering:function J(){var M=this.parent.parent,N=M.item;this.set("items",N.projectFormMaps);this.set("defaultSelection",0);var O=this.parent.parent;if(this.items[0]){O.item.dssid=this.items[0].dssid;}},onvalueChange:function(){var P=this,M=P.selectedIndex,N=this.parent.parent.editor,O=this.parent.parent;N.onFormChanged(O.item,P.items[M].dssid);N.validateForms();}}]}]});var D=mstrmojo.desc(14203,"Type attribute name and press 'Enter' to search");mstrmojo.DI.DIProjectsAttribute=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectsAttribute",cssClass:"di-projects-attribute-panel",title:mstrmojo.desc(13037,"Map to Project Attribute"),titleWidget:"",blockCount:50,attribute:null,formMaps:null,found:false,projectAttribute:null,projectFormMaps:null,selections:{},help:"About_mapping_imported_data.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",enabled:false,onclick:function(){var M=this.parent.parent;M.updateMapping();M.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var M=this.parent.parent;M.close();}}],updateHintText:function(){var M=this.mainPage.title.attributePulldown.selectedNode;if(M.textContent!==undefined){M.textContent=D;}else{M.innerText=D;}},children:[{scriptClass:"mstrmojo.VBox",cssClass:"",alias:"mainPage",children:[{scriptClass:"mstrmojo.HBox",alias:"title",cssClass:"mstrmojo-di-title-box",children:[{alias:"attributePulldown",scriptClass:"mstrmojo.DI.DISearchablePulldown",cssClass:"mstrmojo-di-projectAttributeSearchbox",visible:true,blockCount:50,onitemSelected:function(N){var M=this;var O={success:function(P){M.set("isEditing",false);var Q=M.parent.parent.parent;E(Q,N,P);}};L(this.getSelectedItem(),O);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton browseButton",text:mstrmojo.desc(1825,"Browse"),onclick:function(){var N=this;var M={OKFn:function(O){var P={success:function(Q){var R=N.parent.parent.parent;E(R,O,Q);}};L(O,P);},oTypes:[12]};mstrApp.getRootController().showDialog(K.dialogType.objectPicker,M);}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-content-box",alias:"contentH",children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-projects-attribute-left-box",alias:"contentV",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-projects-attribute-title-label",text:mstrmojo.desc(13242,"Imported Attribute")},{scriptClass:"mstrmojo.Label",alias:"attributeName",cssClass:"mstrmojo-di-projects-attribute-label",visible:true,bindings:{text:function(){return this.parent.parent.parent.parent.attribute.alias;}}},{scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-projects-attribute-formMapsList",visible:true,itemFunction:function G(O,M,N){return new mstrmojo.Label({cssClass:"mstrmojo-di-projects-form-label",text:O.fmn});},bindings:{items:function(){return this.parent.parent.parent.parent.formMaps;}}}]},{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-projects-attribute-right-box",alias:"selected_content",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-projects-attribute-title-label",text:mstrmojo.desc(13243,"Project Attribute")},{scriptClass:"mstrmojo.Label",alias:"selected_attribute_select_placeholder",cssClass:"mstrmojo-di-projects-attribute-placeholder",text:mstrmojo.desc(13244,"Search or browse Attribute above"),visible:true,bindings:{visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return false;}return true;}}},{scriptClass:"mstrmojo.Label",alias:"selected_attribute",cssClass:"mstrmojo-di-projects-attribute-label ipa",visible:false,bindings:{text:function(){var M=this.parent.parent.parent.parent.projectAttribute;var N="";if(M){N=M.n;}return N;},visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return true;}return false;}}},{scriptClass:"mstrmojo.WidgetList",alias:"selected_formMapsList",cssClass:"mstrmojo-di-projects-attribute-formMapsList",visible:false,itemFunction:function G(O,M,N){if(!O.isMultiForm){return ;}if(N.parent.parent.parent.parent.found){return new mstrmojo.DI.ProjectAttributeItem({editor:N.parent.parent.parent.parent,projectFormMap:N.parent.parent.parent.parent.projectFormMaps,item:O,did:O.did});}else{if(M===0){return new mstrmojo.Label({cssClass:"mstrmojo-di-projects-form-label",text:N.parent.parent.parent.parent.idForm?N.parent.parent.parent.parent.idForm.n:"ID"});}else{return new mstrmojo.DI.ProjectAttributeItem({editor:N.parent.parent.parent.parent,projectFormMap:N.parent.parent.parent.parent.projectFormMaps,item:O,did:O.did});}}},bindings:{items:function(){return this.parent.parent.parent.parent.selections;},visible:function(){var M=this.parent.parent.parent.parent.projectAttribute;if(M){return true;}return false;}}}]}]}]}],preBuildRendering:function J(){this._super();},onOpen:function C(){this.mainPage.title.attributePulldown.set("items",[]);this.mainPage.title.attributePulldown.set("text","");this.set("isEditing",true);this.set("selections",{});this.set("projectAttribute",null);this.set("projectFormMaps",null);this.btnHbox.submit.set("enabled",false);this.set("found",false);},updateMapping:function B(){var Y,g,f,e,U;var Q=this.selections;Y=this.attribute;var b=mstrApp.getRootController(),P=mstrApp.getRootController().model,X=false,c=false,d,R,a,l,Z;var S=Q[0].aid;var N=Q[0].dssid;var h=Q[0].proAttrName;var M=P.findMappingSource(Y);Z=this.projectAttribute.n;for(g=0;g<M.length;g++){c=false;d=M[g];if(d.currentTransformations&&d.currentTransformations.xtab&&d.currentTransformations.xtab.isCrosstab){a=d.transformedMapping;}else{a=d.currentMapping;}for(f=0;f<a.length;f++){l=a[f];if(l.afid===(S+N)){b.displayError(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));P.raiseEvent({name:"MappingsFetched"});return false;}if(Y.did===l.did||Y.afid===l.afid){continue;}if(Y.oid===l.oid&&Y.tableId!==l.tableId){continue;}if(Y.oid===l.oid&&this.projectAttribute.t===l.tp){if(l.oid&&l.oid===this.projectAttribute.did){continue;}else{if(!l.isMultiForm&&(this.projectAttribute.did+l.fmid)!==l.afid){X=true;break;}else{if(l.isMultiForm&&!l.isLinked){X=true;break;}}}}if(Y.oid!==l.oid&&h===l.alias&&!l.ipa){X=true;}}if(X){R=mstrmojo.desc(13853,"The Attribute ## cannot be mapped to the Project Attribute ### since there is already an Attribute with the same name as the Project Attribute within the current dataset. Please rename the Attribute ### in the current dataset to something else.");b.displayError(R.replace(/###/g,Z).replace("##",this.attribute.alias));P.raiseEvent({name:"MappingsFetched"});return false;}if(N===this.idForm.idf){c=true;}else{for(f=0;f<a.length;f++){l=a[f];if(l.ipa&&l.oid&&(l.oid===this.projectAttribute.did)&&(l.fmid===this.idForm.idf)){c=true;}}}if(!c){R=mstrmojo.desc(13606,"Linked non-id form can't mapped to project attribute: ###, please unlink the non-id form first.");b.displayError(R.replace(/###/g,Z).replace("##",this.attribute.alias));P.raiseEvent({name:"MappingsFetched"});return false;}}for(g=0;g<M.length;g++){d=M[g];var O=d.findMappingItem(Y);if(O.isMultiForm){O.ipa=1;O.tp=12;O.nochange=true;var V=O.subColumns,W;for(U=0;U<Q.length;U++){var m=Q[U];for(e=0;e<V.length;e++){if(m.fmid===V[e].fmid){W=V[e];}}W.ipa=1;W.oid=m.aid;W.fmid=m.dssid;}}else{O.ipa=1;O.tp=12;O.nochange=true;O.oid=Q[0].aid;O.fmid=Q[0].dssid;}}mstrApp.getRootController().changeEMMAMappings();},onFormChanged:function H(M,N){M.dssid=N;},validateForms:function F(){var M=[],R=this.selections,N,Q,P=false;for(N=0;N<R.length;N++){Q=R[N];if(I.find(M,"dssid",Q.dssid)===-1){var O=I.findMulti(R,"dssid",[Q]);if(O.count>1){M.push({dssid:Q.dssid,indices:O.indices});}}}P=(M.length===0);this.setSubmitBtn(P);},setSubmitBtn:function A(M){var N=this.btnHbox.submit;N.set("enabled",M);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.ui.Pulldown","mstrmojo.DI.DISearchablePulldown");mstrmojo.requiresDescs(221,641,1825,5369,13037,13242,13243,13244,13606,13642,13853,13989,14202,14203,14462,14463,14464,14465,14466);var J=mstrmojo.array,I=mstrmojo.dom,E=mstrmojo.hash,K=mstrmojo.DI.DIHelpers,M=mstrmojo.string,O=mstrmojo.DI.DIConstants;function P(S,V){var R=S.did,Q=S.n;var U={success:function(Y){var X=[],W;function Z(e,b,f,c,a){if(J.find(X,"did",e.did)<0){var d={did:e.did,n:e.n,name:e.fdt.content,idf:e.fdt.id_form===1,aid:R,an:Q};if(b){d.caf={did:b.id,n:b.n,name:b.fdt.content,items:a};d.cafi=f;d.cafl=c;}X.push(d);}}if(!Y||!Y.mi){return ;}W=Y.mi["in"].oi;if(W){W=[].concat(W);J.forEach(W,function(b){var a;if(b.tp!==21){return ;}if(b.fdt.bfi!==-1){Z(b);}else{a=b.item===undefined?[]:[].concat(b.item);J.forEach(a,function(e,d){var c=J.find(W,"did",e);if(c>=0){Z(W[c],b,d,a.length,a);}});}});if(V&&V.success){V.success({forms:X});}}},failure:function(W){mstrApp.getRootController().displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),false,W.message);}};mstrApp.getRootController().getDataService().getProjectAttributeInfo(U,{id:R});}function F(R,S,Q){R.set("projectAttribute",S);R.set("projectFormMaps",Q);}function N(){var R=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this),Q=" mstrmojo-di-mapProjectAttribute-formMapItem-popupList";R.getItemMarkup=function(U,S){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@n}</{@tag}>';};R.getItemProps=function(V,S){var U=mstrmojo._IsList.getItemProps.call(this,V,S);U.style=this.parent.itemCssText||"";if(V.data&&K.isGeo(V.data)){U.cls+=" geo";}else{if(V.data&&K.isTime(V.data)){U.cls+=" time";}}return U;};R.cssClass=R.cssClass||"";R.cssClass+=Q;return R;}function A(S,R){var Q=[];var U=J.map(S,function(V){return V.projectFormMap;});J.forEach(R,function(W){var V=J.find(U,"did",W);if(V>=0){if(S[V].formMap){Q.push(S[V].formMap);}}});return Q;}function C(S){var Q=mstrApp.getRootController().getModel(),R=[],U=[];J.forEach(S,function(W){var X=W.formMap,Y=W.projectFormMap,V;if(!X||!Y){return ;}if(Y.idf){V=J.find(U,"did",X.did);if(V<0){U.push(X.data);}}});J.forEach(S,function(V){var W=V.formMap,Y=V.projectFormMap,X;if(!W||!Y){return ;}X=Q.findMappingSource(W.data);J.forEach(X,function(a){var b=true,Z;J.forEach(U,function(c){var d=Q.findMappingItem(c,a.tableID);if(!d||d.length===0){b=false;return false;}});if(b){Z=J.indexOf(R,a.tableID);if(Z<0){R.push(a.tableID);}}});});return R;}mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog",cssClass:"mstrmojo-di-mapProjectAttribute-dialog",title:mstrmojo.desc(13037,"Map to Project Attribute"),blockCount:50,found:false,attributes:null,formMapOptions:null,formMaps:null,projectAttribute:null,projectFormMaps:null,selections:null,help:"About_mapping_imported_data.htm",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(5369,"Submit"),alias:"submit",enabled:false,onclick:function(){var Q=this.parent.parent;Q.updateMapping();Q.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var Q=this.parent.parent;Q.close();}}],children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-mapProjectAttribute-dialog-content",alias:"content",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="content-box top cf"></div><div class="content-box bottom cf"><div class="content-bottom-box left"></div><div class="content-bottom-box right"></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},topNode:function(){return this.domNode.children[0];},bottomNode:function(){return this.domNode.children[1];},bottomLeftNode:function(){return this.domNode.children[1].children[0];},bottomRightNode:function(){return this.domNode.children[1].children[1];}},children:[{slot:"topNode",alias:"searchPulldown",scriptClass:"mstrmojo.DI.DISearchablePulldown",cssClass:"mstrmojo-di-mapProjectAttribute-searchPulldown",blockCount:50,value:mstrmojo.desc(14203,"Type attribute name and press 'Enter' to search"),items:[],isMap2ProjAttr:true,onitemSelected:function(R){var Q=this;var S={success:function(U){var V=Q.parent.parent;Q.set("isEditing",false);F(V,R,U.forms);}};P(this.getSelectedItem(),S);}},{slot:"topNode",alias:"browseButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton mstrmojo-di-mapProjectAttribute-browseButton",text:mstrmojo.desc(1825,"Browse"),onclick:function(){var R=this;var Q={OKFn:function(S){var U={success:function(V){var W=R.parent.parent;F(W,S,V.forms);W.content.searchPulldown.set("items",[S]);W.content.searchPulldown.set("selectedIndex",0);}};P(S,U);},oTypes:[12]};mstrApp.getRootController().showDialog(O.dialogType.objectPicker,Q);}},{slot:"bottomLeftNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-label left",text:mstrmojo.desc(13242,"Imported Attribute")},{slot:"bottomLeftNode",scriptClass:"mstrmojo.WidgetList",alias:"formMapsList",cssClass:"mstrmojo-di-mapProjectAttribute-formMapsList",renderOnScroll:false,onitemsChange:function(){var Q=this;if(!!navigator.userAgent.match(/Edge/)){window.setTimeout(function(){Q.refresh();},0);}},itemFunction:function H(Y,X,W){var U=W.parent.parent,Q=U.formMapOptions,R=-1,Z=["mstrmojo-di-mapProjectAttribute-formMapItem"];var V={n:"---",did:-1};var S={scriptClass:"mstrmojo.ui.Pulldown",getPopupListConfig:N,isHostedWithin:false,allowHTML:true,data:Y,enabled:Y.enabled,value:Y.enabled?mstrmojo.desc(14462,"Select attribute"):"---",parent:W};if(Y.projectFormMap){if(Y.projectFormMap.caf){Z.push("caf");}if(Y.projectFormMap.cafi===0){Z.push("cafb");}if(Y.projectFormMap.cafi===Y.projectFormMap.cafl-1){Z.push("cafe");}}if(!Y.projectFormMap||!Y.projectFormMap.idf){Q=[V].concat(E.clone(Q));}else{Q=E.clone(Q);}if(Y.formMap&&Y.enabled){R=J.find(Q,"did",Y.formMap.did);if(R<0){S.data.formMap=null;}}S.cssClass=Z.join(" ");return mstrmojo.ui.Pulldown.newPulldown(Q,function(a){this.data.formMap=a.did!==-1?a:null;this.parent.parent.parent.validateForms();},R,S);}},{slot:"bottomRightNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-label right",text:mstrmojo.desc(14463,"Project Attribute: "),postBuildRendering:function(){var Q=this.parent.parent;Q.attachEventListener("projectAttributeChange",this.id,"update");},update:function(){var Q=this.parent.parent;if(Q.projectAttribute){this.set("text",mstrmojo.desc(14463,"Project Attribute: ")+Q.projectAttribute.n);this.set("title",Q.projectAttribute.n);}}},{slot:"bottomRightNode",alias:"projectFormMapsPlaceholder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-mapProjectAttribute-placeholder",text:mstrmojo.desc(13244,"Search or browse Attribute above")},{slot:"bottomRightNode",scriptClass:"mstrmojo.WidgetList",alias:"projFormMapsList",cssClass:"mstrmojo-di-mapProjectAttribute-formMapsList",visible:false,renderOnScroll:false,onitemsChange:function(){var R=this;var Q=this.items&&this.items.length;this.set("visible",Q);this.parent.projectFormMapsPlaceholder.set("visible",!Q);if(!!navigator.userAgent.match(/Edge/)){window.setTimeout(function(){R.refresh();},0);}},itemFunction:function H(V,Q,U){var S=["mstrmojo-di-mapProjectAttribute-formMapItem","proj"];var R={parent:U,scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" tooltip="{@tooltip}"><div class="proj-item-text"><span class="icon"></span><span class="text">{@text}</span></div></div>',text:M.encodeHtmlString(V.name,false,true)};if(V.caf){S.push("caf");if(V.cafi===0){S.push("cafb");}if(V.cafi===V.cafl-1){S.push("cafe");}R.tooltip=mstrmojo.desc(14464,"Compound Attribute");R.text=M.encodeHtmlString(V.caf.name)+"@"+M.encodeHtmlString(V.name);}R.cssClass=S.join(" ");return new mstrmojo.Box(R);}}]}],showTooltip:function L(W,V){var U=this,R=I.findAncestorByAttr(I.eventTarget(V,W),"tooltip",true,this.domNode),S=R&&R.value;if(S&&I.contains(U.containerNode,R.node)){if(!U.hasOpenTooltip&&S){var Q=I.position(R.node);U.richTooltip={cssClass:"vi-regular vi-tooltip-C",content:S,top:Math.max(Q.y+Q.h+4,0),left:Math.max(Q.x+Q.w+8,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT};mstrmojo._HasTooltip.showTooltip.call(U,W,V);}}else{this._super(W,V);}},onOpen:function D(){var R=mstrApp.getRootController().getModel(),V=this,Q=V.attributes,U=V.tableId,X=[],S=0,W;J.forEach(Q,function(a){var Z,b='<span class="icon #{FORM} #{ROLE}"></span>',Y='<span class="text #{IPA}">#{ALIAS}</span>';if(!a.isMultiForm){b=b.replace("#{FORM}","");b=this.setItemIconClass(a,b);Y=Y.replace("#{ALIAS}",mstrmojo.string.encodeHtmlString(a.alias));Y=this.setItemTextClass(a,Y);Z={n:b+Y,alias:a.alias,did:a.did,oid:a.oid,id:a.id,tableId:a.tableId,isMultiForm:a.isMultiForm,ipa:a.ipa,aid:a.id,data:a};X.push(Z);}else{if(S===0){b=b.replace("#{FORM}","form");b=this.setItemIconClass(a,b);Y=this.setItemTextClass(a,Y);J.forEach(a.subColumns,function(c){Y=Y.replace("#{ALIAS}",mstrmojo.string.encodeHtmlString(a.alias,false,true)+"@"+M.encodeHtmlString(c.alias,false,true));Z={n:b+Y,did:c.did,oid:c.oid,id:c.id,tableId:a.tableId,isMultiForm:true,aid:a.id,data:a};X.push(Z);});S++;}}},this);this.set("formMaps",X);W=[];J.forEach(R.getImportSource(U).getCurrentMappings(function(Y){return Y.tp===12;}),function(b){var a,Y,c='<span class="icon #{FORM} #{ROLE}"></span>',Z='<span class="text #{IPA}">#{ALIAS}</span>';if(!b.isMultiForm){if(b.ipa!==1){c=c.replace("#{FORM}","");c=this.setItemIconClass(b,c);Z=Z.replace("#{ALIAS}",mstrmojo.string.encodeHtmlString(b.alias,false,true));Z=this.setItemTextClass(b,Z);a={n:c+Z,alias:b.alias,did:b.did,oid:b.oid,id:b.id,tableId:b.tableId,isMultiForm:b.isMultiForm,ipa:b.ipa,aid:b.id,data:b};W.push(a);}}else{Y=-1;if(Y>=0){c=c.replace("#{FORM}","form");c=this.setItemIconClass(b,c);Z=this.setItemTextClass(b,Z);J.forEach(b.subColumns,function(d){Z=Z.replace("#{ALIAS}",mstrmojo.string.encodeHtmlString(b.alias)+"@"+M.encodeHtmlString(d.alias));a={n:c+Z,did:d.did,oid:d.oid,id:d.id,tableId:b.tableId,isMultiForm:true,aid:b.id,data:b};W.push(a);});}}},this);this.set("formMapOptions",W);this.set("projectFormMaps",[]);this.content.browseButton.set("visible",!mstrApp.isWorkstation);},setItemTextClass:function(R,S){var Q=S;if(R.ipa){Q=Q.replace("#{IPA}","ipa");}else{Q=Q.replace("#{IPA}","");}return Q;},onprojectFormMapsChange:function(){var W=this.formMaps||[],V=this.projectFormMaps||[],Q=Math.max(W.length,V.length),R=[],U,S;this.content.projFormMapsList.set("items",V);for(S=0;S<Q;S++){if(S<W.length&&S<V.length){U={formMap:W[S],projectFormMap:V[S],enabled:true};}else{if(S<W.length){U={formMap:W[S],projectFormMap:null,enabled:V.length===0};}else{U={formMap:null,projectFormMap:V[S],enabled:true};}}R.push(U);}this.set("selections",R);},setItemIconClass:function(R,S){var Q=S;if(K.isGeo(R)){Q=Q.replace("#{ROLE}","geo");}else{if(K.isTime(R)){Q=Q.replace("#{ROLE}","time");}else{Q=Q.replace("#{ROLE}","");}}return Q;},onselectionsChange:function(){this.content.formMapsList.set("items",this.selections);this.validateForms();},updateMapping:function(){var Q=mstrApp.getRootController(),R=Q.getModel(),U=this.selections,S;if(!this.checkUpdateMapping()){return ;}S=C(U);J.forEach(U,function(V){var W=V.formMap,Y=V.projectFormMap,X;if(!W||!Y){return ;}if(!W.isMultiForm){X=R.findMappingItem(W.data);J.forEach(X,function(Z){if(J.indexOf(S,Z.tableId)>=0){Z.ipa=1;Z.tp=12;Z.nochange=true;Z.oid=Y.aid;Z.fmid=Y.did;}});}else{X=R.findMappingItem(W.data);J.forEach(X,function(Z){if(J.indexOf(S,Z.tableId)>=0){J.forEach(Z.subColumns,function(a){if(a.did===W.did){Z.ipa=1;Z.tp=12;Z.nochange=true;a.ipa=1;a.oid=Y.aid;a.fmid=Y.did;}});}});}});Q.changeEMMAMappings();},checkUpdateMapping:function(){var W=this,S=true,Q=mstrApp.getRootController(),R=Q.getModel(),U=this.selections,V=W.projectAttribute.n,Y=[],X;J.forEach(U,function(a){var Z=a.formMap,b=a.projectFormMap;if(!Z||!b){return ;}Y.push(Z);});if(S){J.forEach(U,function(g){var a=g.formMap,b=g.projectFormMap,f;if(!a||!b){return ;}if(!S){return false;}if(b.idf){var e,h,Z=R.importSources,d;f=R.findMappingItem(a.data);d=f&&f.length>0&&f[0].tableId;for(var c in Z){e=R.getImportSource(c).getCurrentMappings(function(j){return j.tp===12;});h=J.find(e,"alias",V);if(h>=0&&c===d&&J.find(Y,"id",e[h].id)<0||h>=0&&c!==d&&e[h].ipa===0&&a.alias!==e[h].alias){S=false;X=mstrmojo.desc(13853,"The Attribute ## cannot be mapped to the Project Attribute ### since there is already an Attribute with the same name as the Project Attribute within the current dataset. Please rename the Attribute ### in the current dataset to something else.");X=X.replace(/###/g,V).replace("##",M.encodeHtmlString(a.data.alias,false,true));return false;}}}});}if(!S&&X){Q.displayError(X);}return S;},validateForms:function G(){var S=this.selections,U=true,V="",Q=[],R;if(!this.projectFormMaps||!this.projectFormMaps.length){U=false;V=mstrmojo.desc(13244,"Search or browse Attribute above");}if(U){R=0;J.forEach(S,function(W){if(W.formMap&&W.projectFormMap){R++;if(J.indexOf(Q,W.formMap.did)<0){Q.push(W.formMap.did);}}});if(R===0){U=false;V=mstrmojo.desc(13244,"Search or browse Attribute above");}else{if(Q.length!==R){U=false;V=mstrmojo.desc(14465,"Cannot map two attributes to same form");}}}if(U){J.forEach(S,function(X){var a=X.projectFormMap,Z=X.formMap,Y,W;if(a){if(a.idf&&!Z){U=false;return false;}if(a.caf&&a.caf.items){Y=A(S,a.caf.items);W=Y.length;if(W!==0&&W!==a.caf.items.length){U=false;V=mstrmojo.desc(14466,"Compound attribute forms need to be mapped together");return false;}}}});}this.setSubmitBtn(U,V);},setSubmitBtn:function B(Q,S){var R=this.btnHbox.submit;R.set("enabled",Q);R.textNode.setAttribute("tooltip",S);},onClose:function(){var Q=this;window.setTimeout(function(){Q.destroy();},0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Box","mstrmojo.Image","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.DI.DISearchableTextBox","mstrmojo.DataGrid");mstrmojo.requiresDescs(39,4283,14032,14033);var N=mstrmojo.DI.DIConstants;function I(Q){var R=this.items.length;var U={},S;if(Q){for(S=0;S<R;S++){U[S]=Q;}}this.set("selectedIndices",U);}function G(U){var S;var V=[];var Q=mstrApp.getRootController();var R;for(S=0;S<this.outputGrid.items.length;S++){if(this.outputGrid.selectedIndices[S]){V.push(this.outputGrid.items[S].url);this.setTableIndex(V.length-1,this.outputGrid.items[S].index);}}this.urls=V;for(S=0;S<V.length;S++){R=mstrmojo.string.trim(V[S]);V[S]=R;}Q.importURLEMMA(this,V,true,!Q.model.hasEMMAReportInstance(),this.id,true,U,this.id);}mstrmojo.DI.DIPublicData=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPublicData",markupString:'<div id = "{@id}" ><div class= "{@cssClass} cf" mstrAttach:click></div><div></div><div></div><div></div></div>',cssClass:"mstrmojo-di-public-data-search",searchField:null,resultSize:0,markupSlots:{containerNode:function(){return this.domNode;},textInputNode:function(){return this.domNode.children[0];},textOutputNode:function(){return this.domNode.children[1];},textOutputNode2:function(){return this.domNode.children[2];},gridOutputNode:function(){return this.domNode.children[3];}},preBuildRendering:function J(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("wikiSearchResultsFetched",this.id,"populate");},postBuildRendering:function A(){if(this._super){this._super();}var Q=mstrApp.getRootController().model;Q.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},adjustSize:function P(S){if(!mstrApp.isWorkstation){return ;}var Q=parseInt(S.size.layoutH,10),V=40;var R=this.outputGrid,U=this.textInputNode;if(!mstrApp.isPopup&&!isNaN(Q)){this.domNode.style.height=Q-V+"px";R.domNode.style.height=Q-V-U.clientHeight+"px";R.scrollNode.style.height=Q-V-U.clientHeight-R.headerContainerNode.clientHeight+"px";}},onBackButtonClick:function M(){mstrApp.getRootController().showPage(N.pageType.dataSelection);},onNextButtonClick:function E(){G.call(this,this.tableID?N.actions.refreshData:N.actions.importSource);},onFinishButtonClick:function B(){G.call(this,N.actions.savePublish);},onHelpButtonClick:function D(){return"Importing_data_by_scraping_a_web_page_public_data.htm";},populate:function H(){var V=mstrApp.getRootController().model.wikiSearchResults;if(V.length===0){this.outputText.set("text",mstrmojo.desc(14032,"We could not find any results for your search."));this.outputText.set("visible",true);this.outputGrid.set("visible",false);}else{this.outputText.set("visible",false);this.outputText2.set("visible",false);this.outputGrid.set("visible",true);this.outputGrid.set("items",V);I.call(this.outputGrid,false);}if(this.model.importSources[this.tableID]&&this.model.importSources[this.tableID].sourceInfo&&this.model.importSources[this.tableID].sourceInfo.name&&!this.autoselected){this.autoselected=true;var Z=this.model.importSources[this.tableID];var W,Q=Z.sourceInfo.url,X=Z.sourceInfo.sheetIndex;this.outputGrid.set("multiSelect",false);for(W=0;W<this.outputGrid.items.length;W++){if(Q===this.outputGrid.items[W].url&&X===this.outputGrid.items[W].index){this.outputGrid.set("selectedIndex",W);break;}}this.outputGrid.updateHeaderCheckbox();}if(!!mstrApp.isWorkstation){var Y=this.domNode.clientHeight,U=30;var R=this.outputGrid,S=this.textInputNode;S.style.left="0px";S.style.top="16px";if(V.query&&(V.query.searchinfo.totalhits===0)){this.outputText.set("text",mstrmojo.desc(15027,"Sorry, we did not find the result matched your search."));this.outputText2.set("text",mstrmojo.desc(15028,"Try another search please."));this.outputText.set("visible",true);this.outputText2.set("visible",true);this.outputGrid.set("visible",false);}if(!mstrApp.isPopup&&!isNaN(Y)){R.domNode.style.height=Y-U-S.clientHeight+"px";R.scrollNode.style.height=Y-U-S.clientHeight-R.headerContainerNode.clientHeight+"px";}R.domNode.style.left="0px";R.domNode.style.top="26px";R.domNode.style.height="418px";R.domNode.style.width="978px";R.itemsContainerNode.style.width="978px";}},updateSearchResult:function L(Q){if(!this.stillSearching&&!Q.newValue){return ;}if(Q.newValue){this.searchField=Q.newValue;}this.outputGrid.set("visible",false);if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrApp.getRootController().scrapeWiki(Q.newValue);},children:[{slot:"textInputNode",scriptClass:"mstrmojo.DI.DISearchableTextBox",alias:"urlInput",value:mstrmojo.desc(14033,"Search for data or enter a URL to extract data."),inputTip:mstrmojo.desc(14033,"Search for data or enter a URL to extract data."),isInputTip:true,items:[],itemField:"n",itemIdField:"rgt",preBuildRendering:function J(){if(this._super){this._super();}this.attachEventListener("itemSelectedChanged",this.parent.id,"updateSearchResult");mstrApp.getRootController().model.attachEventListener("wikiSuggestionsChange",this.id,"populateList");},onitemSelected:function(S,Q){var R;if(S){R=(S.n);}else{if(Q&&Q!==-1){R=(this.items[Q]);}else{R=(this.text);}}this.raiseEvent({name:"itemSelectedChanged",newValue:R,limit:25,off:0});}},{slot:"textInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",cssText:"float:left;",text:mstrmojo.desc(10,"Search"),onclick:function(){if(this.parent.urlInput.text!=="Search for data or enter a URL to extract data."){this.parent.urlInput.raiseEvent({name:"itemSelectedChanged",newValue:this.parent.urlInput.text,limit:25,off:0});}},preBuildRendering:function(){if(this._super){this._super();}if(mstrApp.isWSStyling){this.cssText="float:left";}}},{slot:"textOutputNode",scriptClass:"mstrmojo.Label",alias:"outputText",cssClass:"mstrmojo-di-public-data-output"},{slot:"textOutputNode2",scriptClass:"mstrmojo.Label",alias:"outputText2",cssClass:"mstrmojo-di-public-data-output2"},{slot:"gridOutputNode",scriptClass:"mstrmojo.DataGrid",alias:"outputGrid",cssClass:"mstrmojo-di-public-data-grid",setupScrollNodes:function F(){this.scrollNode=this.scrollboxNode;},visible:false,multiSelect:true,markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="height:336px; {@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',selectionPolicy:"toggle",columns:[{headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",cssText:"padding-top:8px;",alias:"checkall",state:"unselect-all",preclick:function(){var Q=this.dataGrid.parent;if(Q.tableID){return ;}if(this.state==="select-all"){this.set("state","unselect-all");I.call(this.dataGrid,false);}else{this.set("state","select-all");I.call(this.dataGrid,true);}},onstateChange:function(){var Q=mstrmojo.css;Q.removeClass(this.inputNode,["select-all","unselect-all","select-some"]);Q.addClass(this.inputNode,this.state);},postCreate:function(){this.set("state","unselect-all");}},colCss:"mstrmojo-di-samplefiles-col1",colWidth:"30",dataWidget:{scriptClass:"mstrmojo.ImageCheckBox",bindings:{label:"this.parent.data.display",checked:function(){return !!this.parent.dataGrid.selectedIndices[this.idx];}},preclick:function(){this.set("checked",!!this.parent.dataGrid.selectedIndices[this.idx]);this.parent.dataGrid.updateHeaderCheckbox();}}},{headerText:mstrmojo.desc(4283,"Source"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:'<div class="mstrmojo-di-public-data-source-container"><a href="{@value}" target="_blank"" mstrAttach:mouseover,mouseout,mousedown>{@value}</a></div>',bindings:{value:function(){return this.data.url+"#"+this.data.section.replace(/ /g,"_");}},onmouseover:function O(R){var Q=mstrmojo.all[this.id];Q.showTooltip(R,self);},onmouseout:function K(R){var Q=mstrmojo.all[this.id];Q.hideTooltip(R,self);},onmousedown:function C(Q){Q.e.stopPropagation();},postBuildRendering:function A(){function R(S){return decodeURIComponent(S.replace(/\+/g," "));}var Q=R(this.data.contents);Q=Q.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:Q});}}},{headerText:mstrmojo.desc(39,"Description"),dataWidget:{colCss:"mstrmojo-di-public-data-grid-entry",scriptClass:"mstrmojo.Widget",markupString:"<div mstrAttach:mouseover,mouseout>{@value}</div>",bindings:{value:function(){return this.data.desc;}},onmouseover:function O(R){var Q=mstrmojo.all[this.id];Q.showTooltip(R,self);},onmouseout:function K(R){var Q=mstrmojo.all[this.id];Q.hideTooltip(R,self);},postBuildRendering:function A(){function R(S){return decodeURIComponent(S.replace(/\+/g," "));}var Q=R(this.data.contents);Q=Q.replace(/\/\/upload.wikimedia.org\//ig,"http://upload.wikimedia.org/");this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:Q});}},colCss:"mstrmojo-di-public-data-grid-entry"}],onchange:function(){var Q=mstrApp.getRootController();var R=this.getSelectedItems();if(R.length>0){Q.sourceSelected(true);}else{Q.sourceSelected(false);}},updateHeaderCheckbox:function(){var S=this,U=S.items.length,R=0,Q=S._headerWidgets_[0],V;if(!Q){return ;}for(V=0;V<U;V++){if(S.selectedIndices[V]){R++;}}if(R<=0){Q.set("state","unselect-all");}else{if(R>=U){Q.set("state","select-all");}else{Q.set("state","select-some");}}}}],tableidx:[],getFilesCnt:function(){if(this.urls){return this.urls.length;}return 0;},getFileUrl:function(Q){if(Q>=0){return this.urls[Q];}return -1;},setUrlTableIndices:function(){var Q;for(Q=0;Q<this.urls.length;Q++){this.tableidx[Q]=0;}},setTableIndex:function(Q,R){this.tableidx[Q]=R;},getUrlTableIndices:function(Q){if(this.tableidx){return this.tableidx[Q];}},getFileTableID:function(Q){if(this.urls&&Q<this.urls.length){return this.urlTableID&&this.urlTableID[this.urls[Q]];}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.DI.DIHelpers","mstrmojo.array");mstrmojo.requiresDescs(1088,629,9099,1388,3397,12259,11425,4572,15173);var O=mstrmojo.DI.DIHelpers,R=mstrmojo.array;var U=mstrmojo.architect.menu.EnumMenuActions,M=U.NONE,G=U.EDIT,L=U.DELETE,E=U.RENAME,I=U.DUPLICATE,N=U.CATALOG_SQL,H=U.SET_AS_PRIMARY,F=U.IS_PRIMARY,Q=U.SHARE,A=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),J=mstrmojo.desc(1388,"Rename"),S=mstrmojo.desc(3397,"Duplicate"),C=mstrmojo.desc(15173,"Edit Catalog Options"),V=mstrmojo.desc(11425,"Set as Primary"),K=mstrmojo.desc(4572,"Primary");function D(Y,X){var W;switch(Y.action){case E:W=parseInt(X.writable,10);break;case Q:W=parseInt(X.controllable,10);break;case L:W=parseInt(X.deletable,10);break;default:W=true;}return !!W;}mstrmojo.warehouse.menu.DBConnectionsMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.DBConnectionsMenu",cm:[{action:G,n:A,icn:"edt"},{action:L,n:B,icn:"del"},{action:E,n:J,icn:"rnm"},{action:Q,n:mstrmojo.desc(9099,"Share")},{action:I,n:S},{action:H,n:V},{action:M},{action:F,n:K},{action:M},{action:N,n:C,icn:"catsql"}],isManaged:undefined,readable:"1",writable:"1",controllable:"1",deletable:"1",postCreate:function(){var W=this;if(!O.isOnetier()){W.cm=R.filter(W.cm,function(X){return D(X,W);});}W.cm=R.map(W.cm,function(X){if(W.isManagedDBR){if(X.action===I){return{action:I,n:S,isManaged:true};}else{if(X.action===Q){return{action:Q,n:mstrmojo.desc(9099,"Share"),isManaged:true};}}}if(X.action===N){return{action:N,n:C,readable:parseInt(W.readable,10)};}return X;});},executeCommand:function P(X){var Y=this.data,W=mstrApp.getRootController();switch(X.action){case G:W.editDBRole(Y);break;case E:W.renameDBRole(Y);break;case L:W.deleteDBRole(Y);break;case I:W.duplicateDBRole(Y);break;case H:W.setProjectPrimaryDBRole(Y);break;case N:W.model.SelDBRoleID=Y.did;W.displayCatalogSQL(Y.did);break;case Q:if(O.isServerBasedWS()){var Z={taskId:"openNativeWindow",did:Y.did,windowType:2};mstrApp.serverRequest(Z,{},false);}else{if(W.shareDBRole){W.shareDBRole(Y);}}break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu");mstrmojo.requiresDescs(11411,11424,11417);var D=mstrmojo.architect.menu.EnumMenuActions,E=mstrmojo.desc(11411,"Sample Data"),A=mstrmojo.desc(11424,"Add to Project"),C=mstrmojo.desc(11417,"Update Structure");mstrmojo.warehouse.menu.AvailableTablesMenu=mstrmojo.declare(mstrmojo.architect.menu.ArchitectMenu,null,{scriptClass:"mstrmojo.architect.menu.AvailableTablesMenu",cm:[{action:D.ADD_TO_PROJECT,n:A},{action:D.UPSTRUCT,n:C},{action:D.NONE},{action:D.SAMPLE_DATA,n:E,icn:"smpl"}],executeCommand:function B(G){var H=this.data,F=mstrApp.getRootController();switch(G.action){case D.UPSTRUCT:F.getColumnsForDBTables({tables:[].concat(H),getFresh:true},{});break;case D.ADD_TO_PROJECT:F.addTables([].concat(H));break;case D.SAMPLE_DATA:F.showSampleData(H);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.architect.menu.ArchitectMenu","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.DI.DIMappingMenu");mstrmojo.requiresDescs(629,1088,3397);var E=mstrmojo.architect.menu.EnumMenuActions,C=E.EDIT,G=E.DELETE,K=E.DUPLICATE,F=mstrmojo.desc(1088,"Edit"),B=mstrmojo.desc(629,"Delete"),J=mstrmojo.desc(3397,"Duplicate");mstrmojo.DI.DIProjectsMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIProjectsMenu",cm:[{action:C,n:F,icn:"rnm"},{action:G,n:B,icn:"del"},{action:K,n:J}],executeCommand:function H(M){var N=this.data,L=mstrApp.getRootController();switch(M.action){case C:L.projectController.editDBRole(N);break;case G:L.projectController.deleteDBRole(N);break;case K:L.projectController.duplicateDBRole(N);break;}},queryVisible:function D(L){return true;},queryEnabled:function I(L){return true;},queryChecked:function A(L){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.warehouse.dbroles.DBRoleHelper","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox","mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor","mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector","mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox","mstrmojo.warehouse.dbroles.DBRoleSettingPulldown","mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton","mstrmojo.DI.DIHelpers","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(14910,15,260,512,689,1034,2523,3332,3989,7790,7952,8517,8518,8519,8521,8522,8523,8524,8526,8528,8529,8530,8532,8533,8534,8536,8538,8539,8540,8546,8547,8548,8549,8550,8560,10055,10058,10059,10061,10064,10065,11392,11394,12308,12309,12310,12312,12313,12542,12752,12758,12997,13100,13101,13103,13104,13105,13106,13107,13108,13109,13110,13111,13112,13113,13114,13115,13116,13117,13118,13119,13121,13122,13123,13124,13125,13126,13234,13373,13531,13532,13533,13540,13541,13904,13905,13906,13907,13908,13909,13910,13944,13945,13946,13947,13948,13949,13950,13951,13952,13962,13979,13980,13981,13982,13990,14002,14005,14620,14621,14641,14685,14686,14687,14906,15618,10198,15662,15663,15664,5166,15256,15257,15337,15914,15167,15168,16149,16150,16151,16152);var j=mstrmojo.array,c=mstrmojo.hash,O=mstrmojo.string,x=mstrmojo.DI.DIHelpers,h="hideUnavailableDrivers",N="FULLCONNECTION",m,E=mstrmojo.warehouse.dbroles.DBRoleHelper,w=mstrmojo.DI.DIConstants,u=mstrmojo.desc(8538,"Database:"),V=mstrmojo.desc(2523,"Version:"),I=mstrmojo.desc(13540,"Show databases whose certified drivers were not found"),l=mstrmojo.desc(14910,"Include databases whose certified drivers were not found"),f=mstrmojo.desc(13990,"Show databases which are not certified for the DSNs driver"),Q=mstrmojo.desc(13234,"Add driver"),k=mstrmojo.desc(11392,"Missing parameters"),o=" ("+mstrmojo.desc(13541,"Certified driver not found")+")",G=mstrmojo.desc(11394,"The ODBC driver used by this database connection is currently not installed, until that happens this connection may not work"),D=mstrmojo.desc(14002,"The JDBC driver used by this database connection is currently not installed, until that happens this connection may not work"),n=mstrmojo.desc(8526,"select a dsn"),AC=mstrmojo.desc(15951,"Only show databases with certified drivers"),J=mstrmojo.desc(16014,"No Available DSN");POSTGRESQL_ODBC_DRIVER="MicroStrategy ODBC Driver for PostgreSQL Wire Protocol";function AB(AJ,AW,AZ){var AX,AM="";if(this.isDSNLess){var AI={},AY,AN=this.contents.children,Ac=1;if(AZ===undefined){var Ab=this.dbIDSelectList.selectedItem,AO=Ab.dbVersions[j.find(Ab.dbVersions,"v",this.dbmsList.selectedItem.db_ver)],AS=AO.connections[this.selectedSection]||AO.connections[0],AU=[AS].concat(AO.altconnections),AP=E.driverExists.call(this,AU);if(AP.exists){AY=AU[AP.idx].str;}else{if(AO.altconnections.length>0){if(Ab.n==="Impala"&&this.selectedSection===1){AY=AO.altconnections[2].str;}else{AY=AS.str;}}else{AY=AS.str;AM=G;if(AY.indexOf("JDBC;")>=0){AM=D;}}}}else{AY=AZ;}j.forEach(AN,function(Ae){if(Ae.alias!="showLabel"){var Ad=Ae.getValue();if(Ae.field){if(typeof Ad==="string"){AI[Ae.field]=O.trim(Ad);}else{AI[Ae.field]=Ad;}}if((!!Ad)&&Ae.driverMode){Ac=Ae.driverMode;}}});this.driverMode=Ac;AX=AY.replace(/@([\w\d]+)/gm,function AR(Ad,Ae){return(AI.hasOwnProperty(Ae)&&AI[Ae]!==null)?AI[Ae]:"";});if(AW){var AK="=;",AV,AT,AQ,Aa=/[\s\x28\x29\x3B]/g,AL=0;do{AV=AX.indexOf(AK,AL);AL=AV+AK.length;if(AV>-1){AT=AX.substring(0,AV);while(Aa.test(AT)){AV=Aa.lastIndex;}AQ=AT.substring(AV);if(AQ.indexOf("=")<0){AX=AX.replace(AQ+AK,"");}}}while(AX.indexOf(AK,AL)>0);}}else{AX="DSN="+this.dsnBox.dsnList.selectedItem.n+";";}if(AJ){AX=E.cleanDSNConnection(AX);}return{str:AX,err:AM};}function U(AL){var AK={},AI=AL.split(";"),AJ=[];j.forEach(AI,function(AM){AJ=AM.split("=");if(AJ[0]!==""){AK[AJ[0]]=AJ[1];}});return AK;}function C(AI,AN){var AM,AL,AJ=[],AK={};j.forEach(c.keyarray(AN),function(AO){AM=AN[AO];if(AO){AK[AO]=AO+"="+AM;}else{j.forEach(c.keyarray(AK),function(AP){AJ.push(AP);});j.forEach(AJ,function(AP){AL=false;j.forEach(AI.parent.children,function(AQ){if(AQ.propfield===AP){AL=true;return !AL;}});if(!AL){delete AK[AP];}});AK[AO]=AM;}});return c.valarray(AK).join(";");}function AA(AL,AO,AJ){var AN,AK;if(AL.field){AN=AO[AL.field];}else{if(AL.propset){AK=AJ[AL.propset][AL.prop];if(AL.propformat==="json"){AN=JSON.parse(AK||"{}")[AL.propfield];}else{if((AL.propformat==="text")){if(AL.propfield){AN=(U(AK||"")[AL.propfield]);}else{var AI=U(AK||"");j.forEach(AL.parent.children,function(AP){if(AP.propfield){delete AI[AP.propfield];}});var AM=[];j.forEach(c.keyarray(AI),function(AP){AM.push(AP+"="+AI[AP]);});AN=AM.join(";");}}else{AN=AK;}}}else{j.forEach(AL.children,function(AP){AA(AP,AO,AJ);});}}if(AN){AL.setValue(AN);}}function b(AN,AJ){var AO,AM,AK,AI={},AL={};if(AN.propset){AO=AN.getValue();if(typeof AO==="string"){AM=O.trim(AO).replace(/\\/g,"\\\\");}else{AM=AO;}AK=AJ[AN.propset][AN.prop];if(AN.propformat==="json"){AL=JSON.parse(AK||"{}");AL[AN.propfield]=AM;AJ[AN.propset][AN.prop]=JSON.stringify(AL).replace(/\\"/g,'"');}else{if((AN.propformat==="text")){AI=U(AK||"");AI[AN.propfield]=AM;AJ[AN.propset][AN.prop]=C(AN,AI);}else{AJ[AN.propset][AN.prop]=AM;}}}else{j.forEach(AN.children,function(AP){b(AP,AJ);});}}function S(AO){if(this.info.connstr){var AN=this.contents;var AK=this.info.connstr.split(";")[0],AJ=(AK.split("=")[0]).toUpperCase();switch(AJ){case"DSN":AN=this.dsnBox;AK=AK.substring(AJ.length+1,AK.length);AN.dsnList.set("selectedID",AK.toUpperCase());break;default:AK=E.cleanLoadedDSNConnection(this.info.connstr,AO.dbID);var AP=this.supportedDBs[j.find(this.supportedDBs,"id",AO.dbID)],AI=AP.dbVersions[j.find(AP.dbVersions,"v",AO.dbver)],AQ=AI.connections.concat(AI.altconnections);var AL=E.extractParams(AQ,AK);AL.supportHttpsURL=AK.indexOf("Protocol=HTTPS")>-1;var AM=this.info.vldbProperties;j.forEach(AN.children,function(AR){AA(AR,AL,AM);});if(AO.dbver===-1||E.isCustomConnection(AK)||mstrApp.rootController.getObjectCount(AL)<=AI.DBPS.length||AL.noDriverMatched){AN.stringEditor.setValue(AK);}}}}function AF(){var AM,AR;if(this.info.connstr){var AU=E.cleanDriver(this.info.connstr),AQ=E.isCustomConnection(this.info.connstr),AI=(AU.split("=")[0]).toUpperCase(),AP=this.dbObjects.dbms,AK=AP[j.find(AP,"did",this.info.dbms)],AS,AN=function AJ(AW,AV){j.forEach(AW,function(AY,AX){if(AK.db_ver===AY.v){AS=AY.connections.concat(AY.altconnections);if(AU!==""&&!AQ){if(j.find(AS,"driver",AU)>=0){AM={dbver:AY.v,dbID:AV};}}else{AM={dbver:AY.v,dbID:AV};}}else{if((AW.length-1)===AX){AR={dbver:AY.v,dbID:AV};}}if(AM){return false;}return true;});};switch(AI){case"DSN":AM={dbver:AK.db_ver,dbID:this.dbIDs.Undefined};break;default:var AL=parseInt(this.info.ab,10),AO,AT;if(isNaN(AL)){AO=j.find(this.supportedDBs,"dbType",this.info.db_type);}else{if(AL>=0){AO=j.find(this.supportedDBs,"id",AL);}}if(AO>=0){AT=this.supportedDBs[AO];AN(AT.dbVersions,AT.id);}if(!AM&&!!AR){AM=AR;}if(!AM){j.forEach(this.supportedDBs,function(AV){AN(AV.dbVersions,AV.id);if(AM){return false;}return true;});}if(!AM){AQ=true;j.forEach(this.supportedDBs,function(AV){AN(AV.dbVersions,AV.id);if(AM){return false;}return true;});}break;}}if(!AM){AM={dbID:-1};}return AM;}function R(AL,AK,AJ,AI){var AO=this,AN=[],AP,AM;AM=new mstrmojo.warehouse.dbroles.DBRoleSettingGroupBox({alias:AL.alias+"groupBox"});AO.contents.addChildren([AM]);j.forEach(AK,function(AQ){if(AQ.group===AJ){AP=c.clone(AQ);delete AP.group;AN.push(AP);}});AI.call(AO,AN,AM.alias,AM);if(AL.oncheckedChange){AL.checked=true;AL.set("checked",false);}}function AH(AO,AK,AJ){var AM=this,AI=AM.parent.parent,AL=[];j.forEach(AO,function(AP){if(!!(AP.group)){AL.push(AP);}});var AN;j.forEach(AO,function(AW,AX){AN=false;if(mstrApp.isSingleTier){if((AW.scope&2)===2){AN=true;}}else{if((AW.scope&1)===1){AN=true;}}if(!AN){return ;}var AZ,AY=mstrmojo.desc(AW.IDS,AW.n),AS="dbp_"+AW.field,AV=(AW.isgroup===1);if(AY&&AY[AY.length-1]!==":"){AY+=":";}if(AW.group){return true;}switch(AW.tp){case"hadoopdropdown":AZ=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AY,alias:AS,isRequired:AW.req,onEnter:AM.onEnterFn,mode:1,items:[{n:"None",v:"0"},{n:"AD Kerberos",v:"1"},{n:"User delegation",v:"2"}]});break;case"hadooptext":AZ=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AY,alias:AS,isRequired:AW.req,onEnter:AM.onEnterFn,onvalueChange:function AQ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});AZ.disableTextbox();if(parseInt(AW.IDS,10)===7952){if(AI.AuthMode!==undefined){AZ.set("text",AM.parent.parent.AuthMode==0?"Anonymous":"Shared_Kerberos");}}break;case"hadoopnumber":AZ=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AY,alias:AS,isNumeric:true,isRequired:AW.req,onEnter:AM.onEnterFn,onvalueChange:function AQ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});AZ.disableTextbox();break;case"text":case"token":AZ=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AY,alias:AS,isRequired:AW.req,onEnter:AM.onEnterFn,onvalueChange:function AQ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"number":AZ=new mstrmojo.warehouse.dbroles.DBRoleSetting({caption:AY,alias:AS,isNumeric:true,isRequired:AW.req,onEnter:AM.onEnterFn,onvalueChange:function AQ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"list":var AU="v",AP=AW.options;if((!AP||!AP.length)&&AI.listOptions){AP=AM.parent.parent.listOptions[parseInt(AW.IDS,10)];AP=c.clone(AP);}if(AP[0].n){AU="n";j.forEach(AP,function(Aa){Aa.n=mstrmojo.desc(Aa.IDS,Aa.n);});}else{j.forEach(AP,function(Aa){Aa.n=Aa.v;});}AZ=new mstrmojo.warehouse.dbroles.DBRoleSettingPulldown({caption:AY,alias:AS,itemIdField:"v",itemField:AU,onChange:function AT(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});if(parseInt(AW.IDS,10)===7952){AZ.onChange=function AT(){if(this.parent&&this.parent.parent){if((this.selectedItem&&parseInt(this.selectedItem.IDS,10)===13981)){this.parent.parent.updateLoginFn(false);}else{this.parent.parent.updateLoginFn(true);}}if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}};}if(parseInt(AW.IDS,10)===14956){AZ.onChange=function(){if(this.parent){var Aa=this.selectedItem;this.parent.dbp_hnn.setValue(Aa.data.config.namenodeAddr);this.parent.dbp_supportHttpsURL.setValue(Aa.data.config.supportHttpsURL);this.parent.dbp_hp.setValue(Aa.data.config.hdfsRpcPort);this.parent.dbp_wp.setValue(Aa.data.config.hdfsHttpPort);this.parent.dbp_host.setValue(Aa.data.config.hostAddr);this.parent.dbp_bdep.setValue(Aa.data.config.tcpPort);if(!Aa.data.config.sparkConfig.props||Aa.data.config.sparkConfig.props.AuthMode=="0"){this.parent.dbp_auth.setValue("Anonymous");}else{this.parent.dbp_auth.setValue("SHARED_KERBEROS");}}};}AZ.render();AZ.set("items",AP);if(AM.parent.parent.oldIndex){AZ.set("selectedID",AP[AM.parent.parent.oldIndex].v);}break;case"boolean":if(AI.isHadoopGateWay&&AW.n==="SupportHttpsURL"){AZ=new mstrmojo.Box({alias:AS,cssClass:"mstrmojo-Box mstrmojo-wh-DBRoleSetting",getValue:function(){return this.protocol.domNode.firstChild.innerText;},setValue:function(Aa){this.protocol.domNode.firstChild.innerText=this.protocol.text=Aa?"HTTPS":"HTTP";},isValid:function(){return true;},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Label",text:mstrmojo.desc(15109,"Protocol:")},{alias:"protocol",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleSetting-Info",cssText:"line-height: 25px;",allowHTML:true,text:'<label style="padding-left:6px">'+(this["supportHttpsURL"]?"HTTPS":"HTTP")+"</label>"}]});}else{AZ=new mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox({label:AY,alias:AS,isGroup:AV,isNumeric:(AW.stp&&(AW.stp==="numeric")),driverMode:1,helpLink:AW.help,driverModeChecked:AW.driverMode||1,display:AW.display,oncheckedChange:function AR(){if(this.parent.stringEditor){this.parent.stringEditor.updateString();}this.driverMode=(this.checked?this.driverModeChecked:1);if(!this.isGroup){return ;}var Aa=(this.checked&&(this.display==="onChecked"))||(!this.checked&&(this.display==="onUnChecked"));this.parent[this.alias+"groupBox"].set("visible",Aa);}});}break;case"file":AZ=new mstrmojo.warehouse.dbroles.DBRoleSettingFileSelector({caption:AY,alias:AS,isRequired:AW.req,selectorOption:AW.selectorOption,onEnter:AM.onEnterFn,onvalueChange:function AQ(){if(this.parent&&this.parent.stringEditor){this.parent.stringEditor.updateString();}}});break;case"label":AZ={scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-ShowConnection",alias:"showLabel",text:mstrmojo.desc(14906,"Manage Hadoop Gate"),bindings:{visible:function(){return false;}}};if(AI.labelClickFn){AZ.onclick=AI.labelClickFn[parseInt(AW.IDS,10)]||mstrmojo.emptyFn;}break;}AZ.field=AW.field;AZ.parentRBAlias=AK;AZ.propset=AW.propset;AZ.prop=AW.prop;AZ.propformat=AW.propformat;AZ.propfield=AW.propfield;if(AW.defaultValue){AZ.setValue(AW.defaultValue);}AJ.addChildren([AZ]);if(AV){R.call(AM,AZ,AL,AW.groupid,AH);}});}function X(AK,AJ,AI){return new mstrmojo.warehouse.dbroles.DBRoleSettingRadioButton({label:mstrmojo.desc(AK.IDS,AK.n),index:AJ,alias:"RB"+AJ,count:AI,field:"RB"+(AJ+1),onclick:function AL(){var AN;if(this.checked){for(AN=0;AN<this.count;AN++){this.parent["RB"+AN].set("checked",false);this.parent["RB"+AN].enableChildren();}this.set("checked",true);this.enableChildren();}},oncheckedChange:function AM(){if(this.checked){this.parent.parent.selectedSection=this.index;}}});}function z(){if(!this.isDSNLess){return ;}var AM=this.contents,AP,AK,AN=this;if(!AM){return ;}if(AM.children){AM.removeChildren(null,true);}if(!this.dbmsList.selectedItem){return ;}AP=this.dbIDSelectList.selectedItem||this.dbIDSelectList.items[0];var AI=AP.dbVersions[j.find(AP.dbVersions,"v",this.dbmsList.selectedItem.db_ver)];if(!AI){return ;}if(!E.driverExists.call(this,AI.connections).exists&&(AI.altDBPS.length>0)){AK=AI.altDBPS;}else{AK=AI.DBPS;}if(AK&&AK.length>1){var AL=AK.length;j.forEach(AK,function(AS,AR){if(AS.defaultSection){AN.selectedSection=AR;}var AT=X(AS,AR,AL);AM.addChildren([AT]);AH.call(AN,AS.DBP,AT.alias,AN.contents);});AM["RB"+AN.selectedSection].checked=true;AM["RB"+AN.selectedSection].onclick();}else{AH.call(AN,AK[0].DBP,"",AN.contents);}var AQ=new mstrmojo.warehouse.dbroles.DBRoleSettingConnectionStringEditor({alias:"stringEditor",drivers:AN.drivers,dbIDVersions:this.dbIDSelectList.items,info:AN.info,dbID:AN.dbIDSelectList.selectedItem,dbms:AN.dbmsList.selectedItem,enableFn:function AO(AS){var AT=this.parent.parent,AR=AT.contents["RB"+AT.selectedSection];j.forEach(AM.children,function(AU){if(!AU.isGroupSetting&&!AU.isGroup){AU.set("enabled",AS);}});if(AS&&AR){AR.setValue(true);}},generateConnectionStringFn:function AJ(AR){return AB.call(AN,false,false,AR).str.replace(N+"=","");}});AM.addChildren([AQ]);}function AE(AJ){var AI=this.dbObjects.dbms;return AI[j.find(AI,"db_ver",AJ)];}function H(){var AR=this,AN=false,AQ=this.dbObjects.supportedDBs,AS=this.dbIdFilter||[],AT=this.dbIdExcludeFilter||[],AM=[],AL,AP=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")===-1)),AO=(mstrApp.isSingleTier&&(navigator.platform.indexOf("Win")!==-1)),AJ=(mstrApp.isSingleTier&&window.FormWrapper.isWin32&&window.FormWrapper.isWin32()),AK=function AK(AV){if(AP){var AW=c.clone(AV);AW.n=O.trim(AV.n.replace("(JDBC)",""));return AW;}if(AO){var AU=c.clone(AV);AU.n=O.trim(AV.n.replace("(32 bit)",""));return AU;}return AV;},AI=[6800,5300,5600,6600,7000];j.forEach(AQ,function(AU){AN=false;if(mstrApp.isSingleTier&&AP&&AU.dbType===100){return true;}if(mstrApp.isSingleTier){if(j.indexOf(AI,AU.dbType)!==-1){return true;}}j.forEach(AU.dbVersions,function(AV){if(AV.dsnless){if(!AR.showUnavailable){j.forEach(AV.connections.concat(AV.altconnections),function(AW){if(E.driverAvailable.call(AR,AW)){AN=true;}return !AN;});}else{AN=true;}return !AN;}return !AN;});if(AN){AL=false;j.forEach(AT,function(AV){if(AV===AU.id){AL=true;return false;}});if(!AL){if(AS.length>0){j.forEach(AS,function(AV){if(AV===AU.id){AM.push(AK(AU));}});}else{AM.push(AK(AU));}}}});if(x.getEnvObj().isAppSchema()){AM=j.filter(AM,function(AU){return x.filterDisableSources(AU.dbType);});}this.dbIDSelectList.set("items",AM);if(AM.length===0&&!AR.showUnavailable){AR.showUnavailable=true;this.driverBox.hideUnavailable.setValue(false);}}function AD(AL,AK){var AQ=this.dbObjects.dbms,AS=this.dbmsList;if(AL.length===0){var AI,AM=this.dbObjects.dsndbms,AN={};if(this.cfgDbmsTypeExcludeFilter&&this.cfgDbmsTypeExcludeFilter.length>0){j.forEach(this.cfgDbmsTypeExcludeFilter,function(AU){AN[AU]=true;});AM=j.filter(this.dbObjects.dsndbms,function(AU){return !AN[AU.db_type];});}AI=c.cloneArray(AM);var AT=[];j.forEach(AK,function(AV){if(AV.v>-1){var AU=j.find(AI,"db_ver",AV.v);if(AU>=0&&AT.indexOf(AU)<0){AI[AU].n+=" (Certified for DSN)";AT.push(AU);}}});AS.set("items",AI);}else{var AO={},AR=this;j.forEach(AQ,function(AU){AU.enabled=true;if(!(AL.length===1&&AL[0].v===-1)){if((AU.db_type===AR.dbTypes.Generic.v)||(AU.db_ver===-1)){if(!AR.alwaysShowGeneric){return true;}}}j.forEach(AL,function(AY){if(AU.db_ver===AY.v){if((AY.dsnless&&AR.isDSNLess)||(!AR.isDSNLess)){var AW=AY.connections.concat(AY.altconnections);if(!AR.showUnavailable){j.forEach(AW,function(AZ){if(E.driverAvailable.call(AR,AZ)){AO[AU.did]=AU;}return true;});}else{var AV=false;j.forEach(AW,function(AZ){if(E.driverAvailable.call(AR,AZ)){AV=true;}return !AV;});if(AV){AU.title=(AU.n.length>50)?AU.n:"";AO[AU.did]=AU;}else{var AX=mstrmojo.hash.clone(AU);AX.n=AX.n+o;AU.enabled=false;AX.title=(AX.n.length>50)?AX.n:"";AO[AX.did]=AX;}}}}});});if(mstrApp.rootController.getObjectCount(AO)===0){var AJ=AE.call(this,-1);if(AJ){AO[AJ.did]=AJ;}}if(AL.length===1&&AL[0].v===-1){mstrmojo.hash.forEach(AO,function(AW,AV,AU){if(AW.db_type!==AR.dbTypes.Generic.v){delete AU[AV];}});AS.set("items",mstrmojo.hash.valarray(AO));}else{AS.set("items",mstrmojo.hash.valarray(AO));}}var AP=AS.items;if(AP.length>0){if(this.info&&this.info.dbms){AS.set("selectedID",this.info.dbms);}else{if(AS.selectedItem&&(j.find(AP,"did",AS.selectedItem.did)>-1)){AS.set("selectedID",AS.selectedItem.did);}else{AS.set("selectedID",AP[0].did);}}AS.onChange();}else{AS.set("selectedID","");}}function a(){var AR=this,AS={n:n,nU:n.toUpperCase(),des:0},AK={n:J,nU:n.toUpperCase(),des:0};var AQ={},AP=AR.dbObjects.dsns,AJ=[];AQ[AS.nU]=AS;if(AR.dbIdFilter.length===1){j.forEach(AR.supportedDBs,function(AT){j.forEach(AT.dbVersions,function(AU){j.forEach(AU.connections.concat(AU.altconnections),function(AV){j.forEach(AP,function(AW){if(AV.driver===AW.des){AQ[AW.nU]=AW;}return true;});});});});AJ=c.cloneArray(c.valarray(AQ));}else{AJ=c.cloneArray(AR.dbObjects.dsns);}var AI={};if(AR.dsnDbTypeExcludeFilter&&AR.dsnDbTypeExcludeFilter.length>0){j.forEach(AR.dsnDbTypeExcludeFilter,function(AT){j.forEach(AR.dsnMapDBs,function(AU){if(AU.dbType===AT){j.forEach(AU.dbVersions,function(AV){j.forEach(AV.connections.concat(AV.altconnections),function(AW){j.forEach(AJ,function(AX){if(AW.driver===AX.des){AI[AX.nU]=AX;}return true;});});});}});});var AM,AO,AL=c.valarray(AI),AN=AL.length;for(AM=0;AM<AN;AM++){AO=j.find(AJ,"nU",AL[AM].nU);if(AO>=0){AJ.splice(AO,1);}}}AJ.splice(0,1,AJ.length>1?AS:AK);this.dsnBox.dsnList.list.set("enabled",AJ.length>1);this.dsnBox.dsnList.set("items",AJ);this.onisDSNLessChange();}mstrmojo.warehouse.dbroles.DBRoleDSNConnection=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",cssClass:"mstrmojo-wh-DBRoleDSNConnection",postCreate:function e(){var AI=mstrApp.rootController.getDBObjects();this.dbObjects=AI;this.dbTypes=AI.dbTypes;this.dbIDs=AI.dbIDs;this.dbVersions=AI.dbVersions;this.supportedDBs=AI.supportedDBs;this.dsnMapDBs=AI.dsnMapDBs;this.drivers=AI.drivers;this.preferences=AI.preferences;},onEnterFn:mstrmojo.emptyFn,info:undefined,oninfoChange:function L(){var AK=this.info.connstr;if(AK&&(AK.substring(0,1)===";")){this.info.connstr=this.info.connstr.replace(";","");}H.call(this);var AI=AF.call(this);var AJ=window.localStorage,AL=(AJ&&AJ.getItem(h));this.driverBox.hideUnavailable.setValue((AL?(AL==="1"):false));if((mstrApp.rootController.getObjectCount(this.info)>0)&&(this.info.did!=="")&&(j.find(this.dbIDSelectList.items,"id",AI.dbID)<0)){this.driverBox.hideUnavailable.setValue(false);}if(this.isDSNLess){this.dbIDSelectList.selectedItem=null;this.dbIDSelectList.set("selectedID",AI.dbID);this.dbmsList.set("selectedID",this.info.dbms);}else{if(this.info.n){a.call(this);}}S.call(this,AI);this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},selectedSection:0,isDSNLess:undefined,dbIdFilter:[],dbIdExcludeFilter:[],dsnDbTypeExcludeFilter:[],driverMode:1,singleType:false,onisDSNLessChange:function M(){var AO=this.dbIDSelectList,AL=this.dsnBox,AN=AL.dsnList,AI=this.info&&this.info.connstr,AK,AM,AJ;if(this.isDSNLess){AO.set("selectedItem",null);AO.set("selectedID",this.supportedDBs[0].id);this.driverBox.hideUnavailable.set("label",AC);}else{if(!(AN.items&&AN.items.length>0)){a.call(this);}if(AI){AK=AI.split(";")[0];AM=(AK.split("=")[0]).toUpperCase();if(AM==="DSN"){AK=AK.substring(AM.length+1,AK.length);AJ=AK.toUpperCase();}}if(AJ===undefined){AJ=AN.items[0].nU;}AN.set("selectedID",AJ);AN.onChange();this.driverBox.hideUnavailable.set("label",AC);}AO.set("visible",this.isDSNLess&&!this.singleType);this.contents.set("visible",this.isDSNLess);AL.set("visible",!this.isDSNLess);this.updateLoginFn(true);this.dbmsList.list.set("enabled",this.isDSNLess?true:this.dsnBox.dsnList.list.enabled);},dsnBox:undefined,dsnList:undefined,dbIDSelectList:undefined,dbmsList:undefined,contents:undefined,hideUnavailable:undefined,hideDriverCheck:false,onhideDriverCheckChange:function g(){this.driverBox.hideUnavailable.set("visible",!this.hideDriverCheck);},driverBox:undefined,addDriver:undefined,showAddDriver:false,showConnectionString:false,Hive:undefined,db_ver:undefined,DBP:undefined,DBPS:undefined,altDBPS:undefined,IDS:undefined,connections:undefined,altconnections:undefined,dsnless:undefined,Undefined:undefined,isgroup:undefined,groupid:undefined,showUnavailable:true,alwaysShowGeneric:false,children:[{scriptClass:"mstrmojo.Box",alias:"driverBox",children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingCheckbox",alias:"hideUnavailable",label:l,oncheckedChange:function Z(){var AL=window.localStorage;if(AL){AL.setItem(h,this.checked?"1":"0");}var AK=this.parent.parent,AI,AJ;if(AK.dbIDSelectList.items){AI=AK.dbIDSelectList.selectedID;}if(AK.dbmsList.items){AJ=AK.dbmsList.selectedID;}AK.showUnavailable=(!this.checked);if(AK.isDSNLess){H.call(AK);if(AK.dbIDSelectList.hasRendered){if(!!(AK.dbIDSelectList.items.length)&&((!AI)||(j.find(AK.dbIDSelectList.items,"id",AI)<0))){AI=AK.dbIDSelectList.items[0].id;AK.dbIDSelectList.set("selectedID",AI);}else{AK.dbIDSelectList.set("selectedID",AI);}}}else{if(this.parent.parent.hasRendered){this.parent.parent.dsnBox.dsnList.onChange();}}if(AK.dbmsList.hasRendered){if(((!AJ)||(j.find(AK.dbmsList.items,"did",AJ)<0))&&(AK.dbmsList.items&&AK.dbmsList.items[0])){AJ=AK.dbmsList.items[0].id;AK.dbmsList.set("selectedID",AJ);}}}}]},{scriptClass:"mstrmojo.Table",rows:1,cols:2,alias:"dsnBox",postCreate:function e(){this.cssClass="mstrmojo-wh-DSNConnection-Box "+((mstrApp.isSingleTier&&navigator.platform.indexOf("Win")!==-1)?"one-tier-win":"");},layout:[{cells:[{cssClass:"mstrmojo-wh-DSNConnection-Box-list"},{cssClass:"mstrmojo-wh-DSNConnection-Box-btn"}]}],children:[{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",slot:"0,0",caption:mstrmojo.desc(8559,"DSN")+":",alias:"dsnList",itemIdField:"nU",allowHTML:false,onChange:function Y(){var AK=this.parent.parent,AJ=AK.dsnBox.dsnList.selectedItem,AI=[];if(AJ){j.forEach(AK.supportedDBs,function(AL){j.forEach(AL.dbVersions,function(AM){j.forEach(AM.connections.concat(AM.altconnections),function(AN){if(AN.driver===AJ.des){AI.push(AM);return false;}return true;});});});}if(AK.showUnavailable){AD.call(AK,[],AI);}else{AD.call(AK,AI);}}},{scriptClass:"mstrmojo.Button",slot:"0,1",onclick:function t(){var AI=this.parent.parent.parent.parent.buttonsbox.buttonCancel;if(AI){AI.onclick();}mstrApp.getRootController().getDataService().submitRequest({},{taskId:"openODBCAdmin"});}}]},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbIDSelectList",itemIdField:"id",caption:u,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function Y(AI){var AJ=this.parent,AK;if(AI){AK=AI.id;AD.call(AJ,AJ.supportedDBs[j.find(AJ.supportedDBs,"id",AK)].dbVersions);this.set("selectedID",AK);if((AI.connType&4)!==4){AJ.addDriver.set("visible",AJ.showAddDriver);}if(AJ.isDSNLess){z.call(AJ);}AJ.updateLoginFn(AI.stdLogin!==0);}}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSettingPulldown",alias:"dbmsList",itemIdField:"did",caption:V,bindings:{visible:function(){return !this.parent.singleType;}},onChange:function Y(){var AI=this.parent;if(AI.isDSNLess&&AI.dbIDSelectList.selectedItem){AI.updateLoginFn(AI.dbIDSelectList.selectedItem.stdLogin!==0);}this.selectedID=this.selectedItem.did;if(this.items.length===1){this.selectedID=0;}if(AI.onDBMSSelectFn){AI.onDBMSSelectFn(this.selectedItem);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleConnection-AddDriver",visible:false,alias:"addDriver",text:Q,onclick:function t(){m=this.parent;mstrApp.rootController.launchOneTierFileBrowser("mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader");}},{scriptClass:"mstrmojo.Box",alias:"contents",cssClass:"mstrmojo-wh-DBRoleConnection-Box"}],dbObjects:{},dbVersions:[],dbTypes:[],preferences:{},dbIDs:{},supportedDBs:[],dsnMapDBs:[],drivers:[],getConnectionStr:function P(){if(this.isDSNLess){var AI=this.contents.stringEditor;if(AI.visibleContents&&AI.enabledContents){return{str:AI.getValue(),err:""};}}return AB.call(this,true,true,undefined);},getVLDBProperties:function B(AI){if(this.isDSNLess&&AI){j.forEach(this.contents.children,function(AJ){if(!(AJ.field)){b(AJ,AI);}});}},isValidInput:function F(){var AI=this.contents.children,AJ={val:false,msg:k};if(this.isDSNLess){j.forEach(AI,function(AK){if(AK.isGroupSetting&&AK.visible){j.forEach(AK.children,function(AL){if(AL.alias!=="groupbox"){AJ=AL.isValid();return(AJ.val);}return true;});}else{if(AK.alias==="showLabel"){AJ=true;}else{AJ=AK.isValid();}}return(AJ.val);});return AJ;}return this.dsnBox.dsnList.isValid();},getDbmsID:function K(){return this.dbmsList.selectedItem.did;},getDBId:function A(){if(this.dbIDSelectList.selectedItem&&this.isDSNLess){return this.dbIDSelectList.selectedItem.id;}return 0;},getDBType:function AG(){return this.dbmsList.selectedItem.db_type;},getCharEncodingForUnix:function d(AL){var AM=this.dbmsList.selectedItem,AK=AM.db_ver,AI=j.find(this.dbVersions,"v",AK);var AJ=this.isDSNLess?AL:c.walk("dsnBox.dsnList.selectedItem.des",this);if(AM.db_type===w.dbType.POSTGRESQL&&AJ.indexOf(POSTGRESQL_ODBC_DRIVER)>-1){return 1;}else{if(AI>=0){return this.dbVersions[AI].unixEncoding;}}return 1;},getDriverMode:function W(){return this.driverMode;},getOdbcv:function q(){if(this.getDBType()===this.dbTypes.Hive.v){return"20";}return"";},clear:function p(){this.set("info",{});}});mstrmojo.warehouse.dbroles.DBRoleDSNConnection.oneTierFileUploader=function(AI){mstrApp.rootController.oneTierFileUploader({success:function AJ(){m.dbObjects.reloadDrivers({success:function AK(){m.drivers=m.dbObjects.drivers;m.oninfoChange.call(m);}});}},{fp:AI});};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSearchOnSource=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSearchOnSource",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.MARK_GEO_ROLES:E=false;break;case A.CREATE_TIME_ATTRIBUTES:E=false;break;case A.CREATE_MULTIFORM_ATTRIBUTE:E=false;break;case A.MAP_TO_PROJECT_ATTRIBUTE:E=false;break;case A.UNMAP:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableRows","mstrmojo._IsMovable","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIMappingTableRows","mstrmojo.DI.DIMappingMenu");mstrmojo.requiresDescs(962,3581);var N=mstrmojo.dom,Y=mstrmojo.hash,AA=mstrmojo.DI.DIHelpers,b=mstrmojo.array,D=mstrmojo.css,Q=mstrmojo.string,M=mstrmojo.Widget,j=Math.max,J=Math.min,p="px",W=12,L=4,n=mstrmojo.DI.DIConstants,x="dragging",F=264,O=98,t=175,K=350,z;function e(AD){var AE=this;b.forEach(AD,function(AF){if(AE.isHierarchyRelation&&!AF.recursive){AF.ttp=mstrmojo.desc(null,"This attribute or metric will not be imported after 'Finish' or 'Save', you can find it in 'Show All Columns'");}else{AF.ttp=AF.alias;}if(AF.subColumns){e(AF.subColumns);}});}function S(AD,AE){var AF=[];b.forEach(AD,function(AG){if(AG.tp===AE){AF.push(AG);}});return AF;}function c(AF,AE){var AD=AF.alias,AG=AE.alias;if(AD<AG){return -1;}if(AD>AG){return 1;}return 0;}function U(){if(this.domNode){var AD=this.domNode.style,AE=this.tableData;AD.left=this.left||AE.x;AD.top=this.top||AE.y;}}function q(AD,AG){var AJ,AH,AI,AF,AE;AH=this.parent.domNode.clientHeight-40;if(AD===undefined||AG===undefined){AI=N.position(this.domNode);AJ=AI.h;AF=J(j(AJ,F),AH);AE=AG===undefined?t:AG;}else{AF=j(AD,F);AE=j(AG,t);}this.set("height",AF+p);this.set("width",AE+p);}function w(AE,AD){this.domNode.style.top=Math.max(AD,0)+"px";this.domNode.style.left=Math.max(AE,0)+"px";}function m(AD){return D.hasClass(AD,"mstrmojo-qb-tv-rs");}function k(AD){return b.filterOne(["e","w","n","s","es"],function(AE){return D.hasClass(AD.src.node,AE);});}mstrmojo.DI.DIMappingTable=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsMovable,mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.DI.DIMappingTable",markupString:'<div id="{@id}" class="mstrmojo-di-TableView {@cssClass} {@group}" mstrAttach:contextmenu,click><div class="mstrmojo-di-tv-header item" ><span class="mstrmojo-di-tv-ttl" mstrAttach:dblclick>{@title}</span><span class="di-item-mn" mstrAttach:click></span></div><div class="mstrmojo-qb-tv-rs n"></div><div class="mstrmojo-qb-tv-rs s"></div><div class="mstrmojo-qb-tv-rs w"></div><div class="mstrmojo-qb-tv-rs e"></div><div class="mstrmojo-qb-tv-rs es"></div></div>',markupSlots:{headerNode:function u(){return this.domNode.firstChild;},titleNode:function Z(){return this.domNode.firstChild.firstChild;},containerNode:function a(){return this.domNode;},menuNode:function AC(){return this.domNode.firstChild.lastChild;}},markupMethods:{onvisibleChange:M.visibleMarkupMethod,onheightChange:M.heightMarkupMethod,onwidthChange:M.widthMarkupMethod},onheightChange:function(AM){var AK=this.attrRows,AF=this.metricRows,AH=parseInt(this.height,10),AD=this._ttlHeight,AE,AI,AL,AJ,AG;if(this._super){this._super(AM);}AE=(AK.containerNode||AK.domNode).clientHeight;AI=(AF.containerNode||AF.domNode).clientHeight;AG=AH-AD*3-2;AL=Math.floor(AG/2);AJ=AL;if(AL>AE){AL=Math.max(AE,O);AJ=AG-AL;}else{if(AJ>AI){AJ=Math.max(AI,O);AL=AG-AJ;}}if(AL>=0){AK.set("height",AL+p);}if(AJ>=0){AF.set("height",AJ+p);}},initSelectNode:null,draggable:true,dropZone:true,ownAvatar:true,tableMapping:null,model:null,isExpanded:false,group:"",init:function(AI){if(this._super){this._super(AI);}var AH=this.id,AF="tableViewMenuSelect",AE="tableSelectionClear";b.forEach([this.attrRows,this.metricRows],function AG(AL){AL.attachEventListener(AF,AH,function AK(AM){z.showPopupMenu(this,AM);});AL.attachEventListener(AE,AH,function AJ(AM){this.clearRowSelections(AM);});},this);this.attrRows.convertEnabled=this.metricRows.convertEnabled=this.convertEnabled;this.attrRows.attachEventListener("selectLinkedItems",AH,function AD(AJ){this.parent.selectLinkedAttribute(AJ);});this.metricRows.attachEventListener("selectLinkedItems",AH,function AD(AJ){this.parent.selectLinkedAttribute(AJ);});},preBuildRendering:function A(){this._super();var AF=this.tableData,AE=AF.items,AG=this.attrRows,AD=this.metricRows;e.call(this,AE);this.title=Q.escape4HTMLText(AF.n);AG.items=Array.prototype.sort.call(S(AE,W),c);AG.tableData=AF;AG.tp=W;AD.items=Array.prototype.sort.call(S(AE,L),c);AD.tableData=AF;AD.tp=L;},onselectedChange:function(){if(!this.domNode){return ;}if(this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+2;}else{this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+1;}},postBuildRendering:function R(){this._super();U.call(this);this._ttlHeight=this.headerNode.clientHeight;q.call(this,this.height,this.width);if(this.attrRows.domNode&&this.tableData.attrRowsScroll!==undefined){this.attrRows.domNode.scrollTop=this.tableData.attrRowsScroll;}if(this.metricRows.domNode&&this.tableData.metricRowsScroll!==undefined){this.metricRows.domNode.scrollTop=this.tableData.metricRowsScroll;}if(this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+2;}else{this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+1;}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.title});if(!this._ontooltipover){var AD=this.id;this._ontooltipover=function(AG){var AF=mstrmojo.all[AD];var AE=AF.titleNode;var AH=mstrmojo.dom.position(AE);if(AH.w<AE.scrollWidth){AF.showTooltip(AG,self);}};this._ontooltipout=function(AF){var AE=mstrmojo.all[AD];AE.hideTooltip(AF,self);};}N.attachEvent(this.domNode,"mouseover",this._ontooltipover);N.attachEvent(this.domNode,"mouseout",this._ontooltipout);N.attachEvent(this.domNode,"mousedown",this._ontooltipout);if(this.shouldExpand){this.expandAttrForms();}},expandAttrForms:function H(){var AE=this.attrRows,AD=AE.items,AF=false;if(this.isExpanded){AE.expandedIndices={};AF=true;this.isExpanded=false;}else{b.forEach(AD,function(AH,AG){if(AH.subColumns&&!AH.items){AH.items=AH.subColumns;AE.expandedIndices[AG]=true;AF=true;}else{if(AH.items&&!this.isExpanded){AE.expandedIndices[AG]=true;AF=true;}}});this.isExpanded=true;}if(AF){this.attrRows.render();mstrmojo.css.toggleClass(this.attrRows.domNode,"expand",this.isExpanded);}},getTableID:function C(){return this.tableData.id;},getMovingHandle:function AB(){return(this.isEditing?null:this.headerNode);},toggleAvatarClass:function o(AD,AE){D.toggleClass(this.avatar,AD,AE);},isDragValid:function X(AD){return m.call(this,AD.src.node)||this._super(AD)||false;},ondragstart:function h(AD){this.dragging=true;this._super(AD);if(!this.selected){this.domNode.style.zIndex=mstrApp.getRootController().getDialogController().getCurrentZIndex()+3;}D.toggleClass(this.domNode,[x],true);if(m.call(this,AD.src.node)){this._rszCfg={h:parseInt(this.height,10),w:parseInt(this.width,10),x:Math.max(parseInt(this.domNode.style.left,10),0),y:Math.max(parseInt(this.domNode.style.top,10),0),dir:k(AD)};}this.parent.parent.linker.clearLinks();},ondragmove:function I(AE){var AF=AE.src.pos,AS=AE.tgt.pos;if(this._rszCfg){var AK=this._rszCfg,AG=AK.dir,AI=AS.x-AF.x,AH=AS.y-AF.y,AQ=0,AP=0,AJ=0,AR=0;switch(AG){case"w":AQ=AI;AR=(AK.x+AQ<0)?AK.x:-AI;if(AK.w+AR<t||AK.w+AR>K){return ;}break;case"e":AR=AI;break;case"n":AP=AH;AJ=(AK.y+AP<0)?AK.y:-AH;var AD=this.parent.domNode.clientHeight-40;if(AK.h+AJ<F||AK.h+AJ>AD){return ;}break;case"s":AJ=AH;break;case"es":AJ=AH;AR=AI;}w.call(this,AK.x+AQ,AK.y+AP);q.call(this,AK.h+AJ,AK.w+AR);}else{var AM=this.getMovingTarget();var AN=AM.style;if(parseInt(AN.left,10)<0){AN.left=this.left="0px";}else{AN.left=this.left=Math.max(this._leftPos+AS.x-AF.x,-this._hWidth+40)+"px";}AN.top=this.top=Math.max(this._topPos+AS.y-AF.y,-this._hHeight+20)+"px";var AL=AE.src.widget.attrRows;var AO=AL.getUserSelectedData();if(AO.length===1&&AO[0].isLinked){this.attrRows.raiseEvent({name:"drawLinks",source:this,oid:AO[0].oid});}}},ondragend:function E(AE){var AI,AG;this._super(AE);var AF=this.domNode,AH=AF.style.zIndex,AD=mstrApp.getRootController().getDialogController();D.toggleClass(AF,[x],false);if(parseInt(AH,10)<(AD.getCurrentZIndex()-1)){AF.style.zIndex=AD.getNextZIndex();}if(this.selected){AF.style.zIndex=AD.getCurrentZIndex()+2;}else{AF.style.zIndex=AD.getCurrentZIndex()+1;}delete this._rszCfg;AG=mstrApp.getRootController().getModel().getImportSource(this.getTableID());AI={x:Math.max(parseInt(AF.style.left,10),0),y:Math.max(parseInt(AF.style.top,10),0),w:AF.clientWidth,h:AF.clientHeight};if(!AG){return ;}AG.updateTablePosition(AI);},selectItemById:function V(AD){return this.attrRows.selectItem("id",AD);},selectItemByName:function f(AD){return this.metricRows.selectItem("alias",AD);},onclick:function g(AD){var AF=AD.getTarget();mstrmojo.dom.stopPropogation(AD.hWin,AD.e);if(AF===this.menuNode){z.showPopupMenu(this,{position:N.position(this.menuNode,true),data:[this.tableData],menuType:n.contextMenuType.TABLE_MENU});}else{if(AF===this.titleNode&&this.dragging){this.dragging=false;return ;}else{if(mstrApp.getRootController().selectSourceTable){var AE=mstrApp.getRootController().getModel();if(!AE.currentSource||AE.currentSource.tableID!==this.tableData.id){mstrApp.getRootController().selectSourceTable(this.tableData.id);}}}}},clearRowSelections:function l(AE){var AD=AE&&AE.source&&AE.source.id;b.forEach([this.attrRows,this.metricRows],function AF(AG){if(AG.id!==AD){AG.clearSelections(Y.copy(AG.userSelections));}});},oncontextmenu:function d(AE){N.preventDefault(window,AE.e);var AF=AE.target||N.eventTarget(AE.hWin,AE.e);var AD;if(AF.nodeName==="SPAN"){if(AF.className.indexOf("di-item-n")===-1&&AF.nextSibling&&AF.nextSibling.className.indexOf("di-item-n")!==-1){AF=AF.nextSibling;}if(AF.className.indexOf("di-item-n")===-1){return false;}}else{if(AF.childNodes[1]&&AF.childNodes[1].className.indexOf("di-item-n")!==-1){AF=AF.childNodes[1];}else{if(AF.className==="linked"){AF=AF.parentNode.childNodes[1];}else{return false;}}}AD=N.getMousePosition(AE.e,AE.hWin);b.forEach([this.attrRows,this.metricRows],function AG(AI){if(Y.keyarray(AI.userSelections).length){var AH=AI.getUserSelectedData();z.showPopupMenu(this,{menuNode:AF,data:AI.getUserSelectedData(),menuType:n.contextMenuType.ITEM_MENU,position:AD});}},this);return false;},ondblclick:function P(AD){var AE=AD.getTarget();if(AE.nodeName!=="SPAN"){AE=AE.childNodes[1];}var AF={data:[this.tableData],target:AD.src,position:N.position(AE,true)};mstrApp.getRootController().openRenameTextBox(n.contextMenuType.TABLE_MENU,AE,AF);},ontableDataChange:function G(){this.refresh();},clearSelectionRowsOrSelectTable:function(){var AD=mstrApp.getRootController().getModel();if(!AD.currentSource||AD.currentSource.tableID!==this.tableData.id){mstrApp.getRootController().selectSourceTable(this.tableData.id);}else{this.clearRowSelections();}},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3581,"Attributes"),cssClass:"mstrmojo-di-subTitle",onclick:function g(){this.parent.clearSelectionRowsOrSelectTable();}},{scriptClass:"mstrmojo.DI.DIMappingTableRows",alias:"attrRows",allowEdit:true,cssClass:"attrRows",onscroll:function(){var AF=this.parent.parent,AG=AF.parent.linker,AE=mstrmojo.array.filter(AF.children,function(AI){return AI.selected;}),AH,AD;if(AE.length>0){AH=AE[0].attrRows.getUserSelectedData();AD=mstrmojo.array.filter(AH,function(AI){return AI.isLinked;});AG.clearLinks();mstrmojo.array.forEach(AD,function(AI){this.selectLinkedAttribute({source:AE[0].attrRows,oid:AI.oid,alias:AI.alias});},AF);}}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(962,"Metrics"),cssClass:"mstrmojo-di-subTitle",onclick:function g(){this.parent.clearSelectionRowsOrSelectTable();}},{scriptClass:"mstrmojo.DI.DIMappingTableRows",alias:"metricRows",allowEdit:true,cssClass:"metricRows"}]});z=mstrmojo.DI.DIMappingTable;z.showPopupMenu=function B(AD,AF){AD.menuHelper=mstrApp.getRootController().getMappingMenu(AD.tableData.id);AD.menuHelper.target=AD;AD.menuHelper.data=AF.data;AD.menuHelper.type=AF.menuType;AD.menuHelper.position=AF.position;AD.menuHelper.menuNode=AF.menuNode;var AE=AD.menuHelper.getMenuConfig();AE.hostId=AD.id;AE.hostElement=AF.menuNode;AE.isHostedWithin=false;AE.position=AF.position;AE.popupHandlers[AD.id]={close:function(){this.menuHelper.destroy();}};if(AE.menus&&AE.menus.length>0){AD.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AE,themeClassName:AA.getEnvObj().isServerBasedWS()?"mojo-theme-light":undefined}));}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSAPHana=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSAPHana",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.CREATE_MULTIFORM_ATTRIBUTE:case A.ADDTO_MULTIFORM_ATTRIBUTE:case A.EDIT_MULTIFORM_ATTRIBUTE:case A.CHANGE_DATA_TYPE:case A.DO_NOT_IMPORT:case A.TO_ATTRIBUTE:case A.DEFINE_RELATIONSHIPS:case A.TO_METRIC:case A.MARK_GEO_ROLES:case A.CREATE_TIME_ATTRIBUTES:case A.SHOW_ALL_COLUMNS:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuHadoop=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuHadoop",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingMenu");var B=mstrmojo.DI.DIConstants,A=B.menuItems,F=mstrmojo.hash,C=mstrmojo.array;function E(I,H){var G=[];if(!H){if(I.linkedTbs){F.forEach(I.linkedTbs,function(J,K){if(J){G.push(K);}});}else{G.push(I.tableId);}}else{C.forEach(H,function(K){var J=false;if(I.linkedTbs){if(I.linkedTbs[K]){J=true;}}else{if(K===I.tableId){J=true;}}if(J){if(C.indexOf(G,K)<0){G.push(K);}}});}return G;}mstrmojo.DI.DIAllObjectsMappingMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIAllObjectsMappingMenu",queryEnabled:function D(J){var G=true;if(J.did===A.CREATE_MULTIFORM_ATTRIBUTE||J.did===A.MAP_TO_PROJECT_ATTRIBUTE){var H,K=this.data,I;I=K[0].linkedTbs?F.keyarray(K[0].linkedTbs):[K[0].tableId];for(H=1;H<K.length;H++){I=C.intersection(I,K[H].linkedTbs?F.keyarray(K[H].linkedTbs):[K[H].tableId]);}if(I.length){K[0].tableId=I[0];}else{G=false;}}else{G=this._super(J);}return G;},executeCommand:function(I){var K=this.data,J,H,G;if(I.did===A.CREATE_MULTIFORM_ATTRIBUTE||I.did===A.EDIT_MULTIFORM_ATTRIBUTE||I.did===A.ADDTO_MULTIFORM_ATTRIBUTE||I.did===A.MAP_TO_PROJECT_ATTRIBUTE){for(G=0;G<K.length;G++){if(G===0){J=E(K[0]);}else{J=E(K[G],J);}}if(J.length){H=J[0];}switch(I.did){case A.CREATE_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.CREATE_MULTIFORM_ATTRIBUTE,H,this.data[this.data.length-1],this.data);break;case A.EDIT_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.EDIT_MULTIFORM_ATTRIBUTE,H,this.data[this.data.length-1],this.data);break;case A.ADDTO_MULTIFORM_ATTRIBUTE:mstrApp.getRootController().formsController.onClick(B.formsOptions.ADDTO_MULTIFORM_ATTRIBUTE,H,null,this.data);break;case A.MAP_TO_PROJECT_ATTRIBUTE:mstrApp.getRootController().toProjectAttribute(this,H);break;}}else{if(I.did===A.UNLINK_ALL){mstrApp.getRootController().unlinkAllCubeLevel(this);}else{return this._super(I);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.dom","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.LoginEditor","mstrmojo.util.ThemeHelper","mstrmojo.SessionManager");function Q(j,g){var h=(g?"add":"remove")+"LoadingGraph";this.serverProxy[h](j);}var M=true,R=mstrmojo.hash,P="waitBox",W=".htm";function A(g){return g&&(g.sections||g.subsections||g.objects||g.panels||g.layouts||g.children);}mstrmojo._IsWebApp=mstrmojo.provide("mstrmojo._IsWebApp",{_mixinName:"mstrmojo._IsWebApp",serverProxy:null,init:function Z(g){this._super(g);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:mstrmojo.emptyFn,styleName:"RWDocumentMojoStyle",modelFactory:null,enableWaitBox:false,primaryScdpMap:{},onMobileDevice:function E(){return false;},isTouchApp:function H(){return false;},getContentDimensions:function e(g){return null;},getConfiguration:mstrmojo.emptyFn,setInteractive:function L(g){if(M!==g){M=g;mstrmojo.dom.toggleSelection(window.document.body,g);return true;}return false;},isInteractive:function c(){return M;},addLoadingGraph:function G(g){Q.call(this,g,true);},removeLoadingGraph:function a(g){Q.call(this,g);},serverRequest:function V(n,o,h){try{o=o||{};h=h||{};var k=h.src||(arguments.callee&&arguments.callee.caller.name),g=!this.enableWaitBox||h.silent,m=h.hideFailureErr,l=this;if(!n.noStyle){n.styleName=n.styleName||this.styleName;}o=mstrmojo.func.wrapMethods(o,{submission:function(p){if(!g&&mstrmojo.all[P]){mstrmojo.all[P].requestId=p;}},failure:function(p){if(!g){p.method=k;if(!(mstrApp.isSingleTier&&p.code===403)&&!m){mstrmojo.err(typeof p.mstrerr==="object"?p.mstrerr:p);}}},complete:function(){if(!g){if(mstrmojo.all[P]){delete mstrmojo.all[P].requestId;}l.hideWait();}}});if(!g){this.showWait(h&&h.waitBoxCfg);}window.setTimeout(function(){l.serverProxy.request(o,n,!!h.override,h);},0);}catch(j){mstrmojo.err(j);}},serverRequestParallelNative:function I(j,k,h){var g=h||new mstrmojo.QueueNative();g.queueHandle(j,k);},hasRequests:function U(){return this.serverProxy.hasRequests();},getWaitBoxPosition:function(){return null;},isWaiting:function C(){var g=mstrmojo.all[P];return !!(g&&g.visible);},showWait:function F(k){var m=this,o=mstrmojo.all[P]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:P,cssClass:"mstrWaitBox",draggable:false,refreshOnNextShow:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,position:null,ondisplayMsgChange:function l(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function h(){var q=this.counter,w=this.visible;if(q===0&&w){this.close();}else{if(q>0&&!w){this.open();mstrmojo.dom.center(this.editorNode);var p=this.position||m.getWaitBoxPosition();if(p){var u=p.top,t=p.left;if(u!==undefined){this.set("top",u+"px");}if(t!==undefined){this.set("left",t+"px");}}}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",alias:"msgfield"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",alias:"cancelBtn",text:mstrmojo.desc(2140,"Cancel")}]});o.cancelBtn.set("visible",!!(k&&k.showCancel));o.cancelBtn.onclick=function(){m.serverProxy.cancelRequests();if(k&&k.onCancel&&k.onCancel instanceof Function){k.onCancel.call(m);}};var g=k&&k.position;if(g&&((g.top||g.left)!==undefined)){o.position=k.position;}else{o.position=null;}o.set("displayMsg",(k&&k.message)||mstrmojo.desc(11960,"Loading Data..."));if(k&&k.cssClass){o.set("cssClass","mstrWaitBox "+((k&&k.cssClass)||""));o.refresh();o.refreshOnNextShow=true;}else{if(o.refreshOnNextShow){o.refresh();o.refreshOnNextShow=false;}}if(!this._waitUserLogin){o.set("counter",o.counter+1);}else{this._waitCounter=this._waitCounter+1;}var n;function j(){mstrApp.hideWait();clearTimeout(n);}if(k&&k.timeout){n=window.setTimeout(function(){j();},k.timeout);}if(k&&k._autoClose){mstrmojo.all.waitBox.curtainNode.onclick=function(){j();};}return o;},hideWait:function N(g){var h=mstrmojo.all[P];if(this._autoCloseFn){mstrmojo.dom.detachEvent(h.curtainNode,"mousedown",this._autoCloseFn,true);delete this._autoCloseFn;}if(h){h.set("cssClass","mstrWaitBox");if(!this._waitUserLogin){h.set("counter",g?0:Math.max(0,h.counter-1));}else{this._waitCounter=g?0:Math.max(0,h.counter-1);}}},getWaitBox:function(){return mstrmojo.all[P];},showProgress:mstrmojo.emptyFn,hideProgress:mstrmojo.emptyFn,startSessionManager:function Y(h){var j=mstrApp,g=j.enableAutomaticSessionRecovery&&j.maxSessionIdleTime;j.sessionManager=j.addDisposable(new mstrmojo.SessionManager(mstrmojo.hash.copy(h,g?{timeBeforeSessionTimeoutWarning:mstrApp.timeBeforeSessionTimeoutWarning,maxSessionIdleTime:j.maxSessionIdleTime}:{})));if(g){j.sessionManager.start();}},isSessionExpiredError:function f(l){var k=2147760371,j=2147760372,h=2147758245,g=2147759877;l=(l<0)?(4294967296+parseInt(l,10)):l;switch(l){case k:case j:case h:case g:return true;}return false;},onSessionExpired:function b(j){if(!mstrConfig.features["enable-login-editor"]){var m=mstrApp.launchingApp||mstrApp;var n={evt:5005,src:m.name+"."+m.pageName+".5005"},h=(m.docModel&&m.docModel.bs)||(m.rootCtrl&&m.rootCtrl.docCtrl&&m.rootCtrl.docCtrl.model&&m.rootCtrl.docCtrl.model.bs)||(m.docModelData&&m.docModelData.bs);if(h){n.rwb=h;}mstrmojo.form.send(n);return ;}if(mstrApp.sessionManager){var l=mstrmojo.all[P],g=l&&l.counter>0,k=this;this._waitCounter=-1;if(g){this._waitCounter=l.counter-1;k.hideWait(true);}this._waitUserLogin=true;mstrApp.sessionManager.openLoginEditor({success:function(o){k._waitUserLogin=false;if(o&&o.sessionState){if(j){if(j.params.sessionState){j.params.sessionState=o.sessionState;}if(g){l.counter=k._waitCounter;k.showWait();}mstrmojo.xhr.request(j.method,j.baseUrl,j.callback,j.params);}}},cancelRequests:function(){mstrApp.serverProxy.cancelRequests();}});}},updateSessionState:function O(g){this.sessionState=g;},onNavigateOut:mstrmojo.emptyFn,showHelpTopic:function B(l,h){var k=h?h+"HelpPath":"helpPath",g=mstrmojo[k].call(),n=mstrApp.isSingleTier,m=mstrApp.isWorkstation,j=-1;if(l&&typeof l==="string"){g+=l;}if(n||m){window.FormWrapper.openPage(g);}else{mstrApp.openPage(g);}return false;},getSearchAutoCompleteDelay:function S(){return parseInt(mstrConfig&&mstrConfig.searchAutoCompleteDelay,10)||200;},getThemeClassName:function D(){return"mojo-theme-light";},openPage:function K(g,h){window.open(g,h);},modalEditorChange:function J(h,g){if(mstrApp&&mstrApp.isOIVM&&mstrApp.isOIVM()){if(!mstrApp.modalOpenEditors){mstrApp.modalOpenEditors={};}if(g){mstrApp.modalOpenEditors[h]=true;}else{delete mstrApp.modalOpenEditors[h];}}},parseSecondaryDataProviders:function X(l){var k,n,h,m=l.defn,o=m&&m.layouts,j=(o&&o.length)||0,g=mstrApp.primaryScdpMap;for(k=0;k<j;k++){n=o[k];h=n&&n.units;R.forEach(h,function(p,q){if(p&&p.scdp){g[q]=p.scdp.split(",");}});}},getPluginsRoot:function(){return((mstrApp.isSingleTier||mstrApp.isWorkstation)?"file://":"")+(this.pluginRoot||(mstrConfig&&mstrConfig.pluginRoot)||"../plugins/");},upload:function(n,m,l,h,k,j,g){this.serverProxy.upload(n,m,l,h,k,j,g);},getThemeProps:function d(g){var h;if(mstrApp&&mstrApp.isOIVM&&mstrApp.isOIVM()){if(!mstrApp.themeProps){mstrApp.themeProps=mstrmojo.util.ThemeHelper.getThemePropConfig({layoutstyle:mstrApp.docModel.getCurrentLayoutStyle()});}h=mstrApp.themeProps;}else{h=mstrApp.getRootController().view.themeProps;}return g?h[g]:h;}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.string","mstrmojo._FillsBrowser","mstrmojo.Refine.RefineSampleButton");var A=mstrmojo.dom,F=mstrmojo.DI.DIConstants,C=mstrmojo.css;function G(I){if(I.type===F.sourceType.file&&(I.subtype===F.sourceSubtype.localFile||I.subtype===F.sourceSubtype.url||I.subtype===F.sourceSubtype.samplefile)){return true;}else{if(I.type===F.sourceType.querybuilder&&I.subtype===F.sourceSubtype.querybuilder){return true;}}return false;}mstrmojo.requiresDescs(1143,221,12314,1442,14705,14761,14809,14819,134);mstrmojo.Refine.RefinePopupPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._IsPopup,mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.Refine.RefinePopupPage",alias:"RefinePopupPage",markupString:'<div id="{@id}" class="refine-popup-page mojo-theme-light" mstrAttach:mousedown,mousemove,contextmenu><div class="refine-popup-page-header"></div><div class="refine-popup-page-content"></div><div class="refine-popup-page-footer"><div class="refine-popup-page-cancel"></div><div class="refine-popup-page-apply"></div></div><div class="refine-popup-page-overlay"></div></div>',markupSlots:{editorNode:function(){return this.domNode;},headerNode:function(){return this.domNode.children[0];},refinePanelNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[2];},cancelNode:function(){return this.domNode.children[2].children[0];},applyNode:function(){return this.domNode.children[2].children[1];},overlayNode:function(){return this.domNode.children[3];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex;}},onmousedown:function(I){var K=I.e,J=A.eventTarget(I.hWin,K);if(!this.controller.refineApp.rootController.isClickedInDatePreview&&J.className.indexOf("mstrmojo-scrollbar")===-1){this.refinePanel.controller.model.raiseEvent({name:"columnUnSelected"});if(window.getSelection){window.getSelection().removeAllRanges();}else{document.selection.empty();}}this.controller.refineApp.rootController.isClickedInDatePreview=false;},oncontextmenu:function H(I){if(!!!mstrApp.isWorkstation){return true;}var K=A.eventTarget(I.hWin,I.e),J;if(K&&K.tagName){J=K.tagName.toLowerCase();}if(J!=="input"&&J!=="textarea"&&K.contentEditable!=="true"){A.preventDefault(window,I.e);return false;}},preBuildRendering:function B(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}var J=mstrApp.getRootController(),I=J.refineApp.rootController.tableID,K=J.model.importSources[I];if(!G(K)){Array.prototype.splice.call(this.children[0].children,1,1);}return this._super();},postBuildRendering:function E(){this.setDimensions();if(this._super){this._super();}},setDimensions:function D(){var J=this.getBrowserDimensions();var I=Math.ceil(parseInt(J.h,10)*0.95);var K=Math.ceil(parseInt(J.w,10)*0.95);if(isNaN(I)||isNaN(K)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.refinePanelNode=(I-41-47-2)+"px";this.layoutConfig.w.refinePanelNode=(K-36)+"px";if(this._super){this._super(I+"px",K+"px");}if(this.domNode){mstrmojo.dom.center(this.domNode);}},children:[{scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-refine-title",alias:"title",bindings:{text:function(){return(!mstrApp.isWorkstation)?mstrmojo.desc(12314,"Wrangle Your Data"):mstrmojo.desc(14819,"Data Wrangling");}}},{scriptClass:"mstrmojo.Refine.RefineSampleButton",cssClass:"mstrmojo-WebHoverButton mstrmojo-refine-sample-button",alias:"sampleButton",useRichTooltip:false,visible:false,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:(parseInt(this.domNode.offsetWidth,10)+6).toString()+"px",content:mstrmojo.desc(14705,"All data from the source has <br>been added in the data <br>wrangler preview.")});},postBuildRendering:function(){var J=mstrApp.getRootController(),I=J.refineApp.rootController;this.m=I.model;this.listener=this.m.attachEventListener("dataChange",this.id,this.disableSetSampleButtonhandler);this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},disableSetSampleButtonhandler:function(I){var J=parseInt(I.value.totalInitial,10);if(J<1000){this.set("useRichTooltip",true);this.set("enabled",false);C.addClass(this.textNode,"_disable-Button");}this.m.detachEventListener(this.listener);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-refine-spliter",alias:"spliter",visible:false},{scriptClass:"mstrmojo.Button",alias:"refreshButton",iconClass:"mstrmojo-refine-refresh-button",visible:false,onclick:function(){var K=mstrApp.getRootController(),J=K.refineApp.rootController,I=J.model;if(I.hasUploadData){J.refreshSampleData(0);}},useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:(parseInt(this.domNode.offsetWidth,10)+6).toString()+"px",content:mstrmojo.desc(14809,"Select an alternate random sample")});}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-close",onclick:function(){this.parent.parent.cancel.onclick();}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-help",title:mstrmojo.desc(1143,"Help"),bindings:{visible:function(){return true;}},onclick:function(){var I="Wrangle_Your_Data_page.htm";mstrApp.showHelpTopic(I);}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",alias:"next",slot:"applyNode",text:mstrmojo.desc(134,"Apply"),onclick:function(){var R,O,L;var M=mstrApp.getRootController();var P=M.model;var I=P.importSources[this.parent.tableID];L=this.parent.refinePanel.controller.model;R=L.projectID;var N=JSON.parse(JSON.stringify(L.operations.entries));var Q=[],K;if(N.length===0){M.cancelRefineStage(this.parent.tableID,I&&I.sourceInfo&&I.sourceInfo.isRefined);}else{for(K=0;K<N.length;K++){Q.push(N[K].operation);}O='<rss rpid="'+R+'" rfmt=""><rpo></rpo><rjsops>'+mstrmojo.string.encodeXMLAttribute(JSON.stringify(Q))+"</rjsops></rss>";M.startRefineStage(this.parent.tableID,3,O);}var J=this.parent.refinePanel.bottomPanal.splitter.facetPanel;J.removeAllFacets();L.engine=JSON.stringify(J.getJSON());I.inRefine=false;this.parent.destroy();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),slot:"cancelNode",alias:"cancel",onclick:function(){var Q=[],L,O;var M=this.parent.refinePanel.controller.model;var N=mstrApp.getRootController();var P=N.model;var J=P.importSources[this.parent.tableID];if(J.RefineOperations.length===0){N.cancelRefineStage(this.parent.tableID);}else{if(!mstrmojo.hash.equals(J.RefineOperations,M.operations.entries)){var I=N.refineApp.rootController;O=J.RefineOperations;for(L=0;L<O.length;L++){Q.push(O[L].operation);}I.rollBackOperations({operations:JSON.stringify(Q),engine:JSON.stringify({facets:[],mode:"row-based"})});}}var K=this.parent.refinePanel.bottomPanal.splitter.facetPanel;K.removeAllFacets();M.engine=JSON.stringify(K.getJSON());J.inRefine=false;this.parent.destroy();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.locales","mstrmojo.date","mstrmojo.string");var B=mstrmojo.ValidationTextBox.prototype.markupMethods,D=mstrmojo.string,A=function(){return mstrmojo.locales.datetime;},C=mstrmojo.date;mstrmojo.DateTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DateTextBox",calendarToBody:false,calendarZIndex:100,changeValueOnOK:false,dynDateValue:null,showAdvanced:false,canSelectDisabledDate:false,isList:false,dtp:14,defaultDate:null,autoFormat:true,enabled:true,min:"",max:"",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="mstrmojo-DateTextBox-input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="mstrmojo-DateTextBox-icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.childNodes[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},onwidthChange:function(){if(this.width){this.inputNode.style.width=(this.width-20)+"px";this.iconNode.style.left=(this.width-18)+"px";this.domNode.style.width=this.width+"px";}},onvalueChange:B.onvalueChange,onenabledChange:B.onenabledChange,onvalidationStatusChange:B.onvalidationStatusChange},calConfig:null,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var H=this.opener,G=H&&H.calendarZIndex,I=this.cal,E=H&&H.calConfig;if(G){this.domNode.style.zIndex=G;}for(var F in E){I.set(F,E[F]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",forceNonEmptySelection:true,bindings:{showAdvanced:"this.parent.opener.showAdvanced",dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",dynDateValue:"this.parent.opener.dynDateValue",enabled:"this.parent.opener.enabled",min:"this.parent.opener.min",max:"this.parent.opener.max",canSelectDisabledDate:"this.parent.opener.canSelectDisabledDate",changeValueOnOK:function(){var F=this.parent.opener.dtp,E=this.parent.opener.changeValueOnOK;return F===15||F===16||E;}},closeOnValueChange:true,onValueUpdate:function(F){var I=this.parent&&this.parent.opener;if(I){var G=I.value,E=window.mstrConfig&&window.mstrConfig.listSep||";",H=I.dtp===15?C.formatTimeInfo(this.timeVal,A().TIMEOUTPUTFORMAT):this.value;if(I.isList&&!D.isEmpty(G)){I.set("value",I.value+E+H);}else{I.set("dynDateValue",this.dynDateValue);I.set("value",H);}I.closePopup();}}}]},onclick:function(E){var F=this._lastOpened,G=this._calendarConfig;if(!G){G={};if(this.calendarToBody){delete this.calendar.slot;G.placeholder=document.body.appendChild(document.createElement("div"));G.nudge=function(){var M=this.opener;if(M){var H=mstrmojo.dom.position(M.popupNode,true),L=this.domNode,P=L.offsetHeight,I=L.offsetWidth,J=mstrmojo.dom.windowDim(),K=H.x,N=H.y;if(N+P>=J.h){N=Math.max(N-P,0);}if(K+I>=J.w){K=Math.max(K-I,0);}var O=L.style;O.top=N+"px";O.left=K+"px";}};}this._calendarConfig=G;}G.lockIW=this;if(F&&F.visible){this.closePopup();}else{this.openPopup("calendar",G);this.calendar.cal.updateSelectedDate(true);}},unrender:function(){this._super();if(this.calendarToBody&&this._calendarConfig){delete this._calendarConfig;}if(this.calendar.hasRendered){this.calendar.unrender();}},_set_value:function(H,F){var G=this.value,E=(G!==F);if(E){this.value=F;this.validate(F);}if(this.showAdvanced&&this.dynDateChanged){this.dynDateChanged=false;E=true;}return E;},_set_dynDateValue:function(H,F){var G=this.dynDateValue,E=(G!==F);if(E){this.dynDateValue=F;this.dynDateChanged=true;}return E;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.fx","mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.string","mstrmojo.css");var Q=mstrmojo.css,P=mstrmojo.dom,O=mstrmojo.expr,J=O.DTP,L=mstrmojo.date,N=mstrmojo.hash,R=mstrmojo.array,I=mstrmojo.string,B=R.removeIndices;var A='<table style="width: 200px; table-layout: fixed">',H="</table>";var S=7;var D="MM/dd/yyyy";function C(Z,W,X){var Y=L.getFirstDateOfMonth(Z,W);return(Y.getDay()-X+8)%S;}function U(Y,b,a,Z,W){var X=L.getDateJson(new Date(b+"/"+Y+"/"+a));return(L.compareDate(X,W)>0);}function F(Y,W,Z,X){if(Y&&Y.day===W&&Y.month===Z&&Y.year===X){return 0;}return -1;}function V(a,Y,X,b,Z){var W=L.getDateJson(new Date(b+"/"+X+"/"+Z));if(Y.day.toString()==="NaN"){return -1;}else{if(a&&Y&&L.compareDate(a,Y)<=0&&L.compareDate(a,W)<=0&&L.compareDate(Y,W)>=0){return 0;}}return -1;}function K(a,Z,Y){var X=a.decreaseButton,W=a.increaseButton,c="mstrmojo-Calendar",b=function(f,e,d){f.className=(c+e)+((U(d.d,d.m,d.y,a.min,a.max))?" disabled":"");};b(X,"-decrease",Z);b(W,"-increase",Y);}function M(Z){var Y=L.parseDateAndOrTime(Z),a,W,X;if(Y){X={};a=Y.date;W=Y.time;if(a){N.copy(a,X);}if(W){N.copy(W,X);}}return X;}function E(e,c,Z,b,a,X,W){var Y,d,f;switch(e){case"day":Y=(W==="decrease")?L.getPreMonth(c,Z):L.getNextMonth(c,Z);a.set("browseMonth",Y.m);a.set("browseYear",Y.y);X.set("browseMonth",Z);X.set("browseYear",c);break;case"month":d=(W==="decrease")?c-1:c+1;a.set("browseYear",d);X.set("browseYear",c);break;case"year":d=(W==="decrease")?b-25:b+25;a.yearRangStart=d;X.yearRangStart=b;break;}f=(W==="decrease")?"left":"right";a.switchViewTo(e,f);X.switchViewTo(e,f);}mstrmojo.DI.DICalendar=mstrmojo.declare(mstrmojo.Calendar,null,{cssClass:"mstrmojo-di-calendar",max:L.getDateJson(new Date()),markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onbrowseMonthChange:function(){this.monthLabel.innerHTML=this.monthNames(this.browseMonth-1);},onbrowseYearChange:function(){this.yearLabel.innerHTML=this.browseYear;},ondtpChange:function(){this.timePart.style.display=(this.dtp===J.TIMESTAMP||this.dtp===J.TIME)?"block":"none";},onvalueChange:function(){this.updateSelectedDate();},onchangeValueOnOKChange:function(){if(this.tools){this.tools.style.display=(this.changeValueOnOK?"block":"none");}this.buttonsNode.style.display=(this.wasAdvanced||this.changeValueOnOK||(this.showAdvanced&&this.isAdvanced)?"block":"none");this.advancedNode.style.display=this.showAdvanced?"block":"none";}},dayNames:function(X){var W=["Su","M","Tu","W","Th","F","Sa"];return W[X];},decrease:function(){var W=this.parent.getRightCalendar();E(this.currentView,this.browseYear,this.browseMonth,this.yearRangStart,this,W,"decrease");},increase:function(){var W=this.parent.getLeftCalendar();E(this.currentView,this.browseYear,this.browseMonth,this.yearRangStart,this,W,"increase");},updateSelectedDate:function G(){var Y=this.value,X=this.selectedDates,W;if(Y){W=M(Y);}if(!W){W=L.getDateJson(new Date());}if(U(W.day,W.month,W.year,this.min,this.max)){if(this.min&&L.compareDate(W,this.min)<0){W=M(this.min);}else{if(this.max&&L.compareDate(W,this.max)>0){W=M(this.max);}}}if(this.alias==="leftCal"&&W.month!==1){W.month=W.month-1;}else{if(this.alias==="rightCal"&&W.month===1){W.month=W.month+1;}else{if(this.parent.parent.alias==="fromDate"){X.push(W);}}}this.set("browseMonth",W.month);this.set("browseYear",W.year);this.updateView(this.currentView);},onValueUpdate:function(){var Y=this.parent&&this.parent.opener;if(Y){var X=Y.value,W=(window.mstrConfig&&window.mstrConfig.listSep)||";";if(Y.isList&&!I.isEmpty(X)){Y.set("value",Y.value+W+this.value);}else{Y.set("value",this.value);}Y.closePopup();}},processEvent:function(W){var a=this.selectedDates,Y,d;if(W===this.monthLabel){return true;}if(W===this.yearLabel){return true;}if(P.contains(this.dayView,W,false,this.domNode)){var b=this.browseYear,c=this.browseMonth,Z;Y=parseInt(W.innerHTML,10);d=parseInt(W.getAttribute("m"),10);if(!isNaN(Y)&&!isNaN(d)){Z=(d===0)?{y:b,m:c}:(d===1?L.getNextMonth(b,c):L.getPreMonth(b,c));if(U(Y,Z.m,Z.y,this.min,this.max)){return true;}var X=F(a,Y,c,b);if(X===-1){this.parent.removeSelection(0);Q.addClass(W,["selected"]);a.push({day:Y,month:Z.m,year:Z.y});}else{this.parent.removeSelection(X);}if(d===1){this.increase();}else{if(d===-1){this.decrease();}}if(!this.changeValueOnOK){this.updateValue();}}}else{this._super(W);}return true;},dayViewHTML:function(){var a=this.browseYear,f=this.browseMonth,k=L.getDaysOfMonth(a,f),o=L.getPreMonth(a,f),Y=L.getDaysOfMonth(o.y,o.m),X=L.getNextMonth(a,f),g=C(a,f,this.firstDayOfWeek),b=[],q=0,e=(this.parent.parent.fromDate.value&&L.formatDateInfo(L.parseDate(this.parent.parent.fromDate.value)||{},D))||this.parent.parent.fromDate,Z=(this.parent.parent.toDate.value&&L.formatDateInfo(L.parseDate(this.parent.parent.toDate.value)||{},D))||this.parent.parent.toDate,h=this.min,l=this.max,u,j,n;var t=(this.alias==="leftCal")?this.parent.getRightCalendar():this.parent.getLeftCalendar();var W=(this.selectedDates.length===0)?t.selectedDates:this.selectedDates;var d=L.getDateJson(new Date(e));var p=L.getDateJson(new Date(Z));K(this,{d:Y,m:o.m,y:o.y},{d:1,m:X.m,y:X.y});b.push(A);b.push(this._dayViewTHead());b.push("<tr>");for(n=0;n<g;n++){j=(U(u,o.m,o.y,h,l))?"disabled":"";b.push('<td><div m="-1">');b.push("");b.push("</div></td>");q++;}for(n=0;n<k;n++){u=n+1;j=(U(u,f,a,h,l))?" disabled":"";if(this.parent.parent.alias==="fromDate"){if(p.day.toString()==="NaN"&&d.day.toString()==="NaN"){b.push('<td><div class="mstrmojo-Calendar-day-cur'+((F(W[0],u,f,a)!==-1)?" selected":"")+j+'" m="0">');}else{if(p.day.toString()==="NaN"){b.push('<td><div class="mstrmojo-Calendar-day-cur'+((F(d,u,f,a)!==-1)?" selected":"")+j+'" m="0">');}else{b.push('<td><div class="mstrmojo-Calendar-day-cur'+((V(d,p,u,f,a)!==-1)?" selected":"")+j+'" m="0">');}}}else{if(p.day.toString()==="NaN"){b.push('<td><div class="mstrmojo-Calendar-day-cur'+((F(d,u,f,a)!==-1)?" selected":"")+j+'" m="0">');}else{b.push('<td><div class="mstrmojo-Calendar-day-cur'+((V(d,p,u,f,a)!==-1)?" selected":"")+j+'" m="0">');}}b.push(n+1);b.push("</div></td>");if((++q)%S===0){b.push("</tr><tr>");}}b.push("</tr>");b.push(H);return b.join("");},_dayViewTHead:function(){var Z=[],a='<thead><tr class="mstrmojo-di-Calendar-thead">',Y="</tr></thead>",X=this.firstDayOfWeek===1?0:1,b=this.dayNames,W;Z.push(a);for(W=X;W<S;W++){Z.push("<td>");Z.push(b(W));Z.push("</td>");}if(X===1){Z.push(b(0));}Z.push(Y);return Z.join("");}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TitleBar","mstrmojo.Image","mstrmojo.css");mstrmojo.vi.ui.CollapsibleTitleBar=mstrmojo.declare(mstrmojo.vi.ui.TitleBar,null,{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",btnCollapse:null,canCollapse:false,isCollapsed:false,collapse:mstrmojo.emptyFn,onToggleCollapseByUI:mstrmojo.emptyFn,setToolbarVisibility:function C(D){if(!D||!this.isCollapsed){this._super(D);}},onisCollapsedChange:function B(){if(this.canCollapse){var D=this.isCollapsed;this.parent.set("isCollapsed",D);}},getLeftToolbarChildren:function A(){var D=this;return[{scriptClass:"mstrmojo.Image",slot:"leftToolNode",alias:"btnCollapse",onclick:function(F){var G=this.parent,E=G.parent;if(G.canCollapse){G.set("isCollapsed",!G.isCollapsed);D.onToggleCollapseByUI();var H=F.e;if(H&&H.stopPropagation){H.stopPropagation();}}if(E&&E.clickToCollapse){E.clickToCollapse();}}}];}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.CollapsibleTitleBar,{oncanCollapseChange:function(){this.btnCollapse.set("visible",this.canCollapse);},onisCollapsedChange:function(){mstrmojo.css.toggleClass(this.domNode,"collapsed",this.isCollapsed);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.array","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.qb.FFsqlToken","mstrmojo.warehouse.EnumDataChangeEvents");var t=mstrmojo.dom,M=mstrmojo.array,P=mstrmojo.hash,AT=mstrmojo.Enum_Keys,o=mstrmojo.range,U=mstrmojo.string,AI=o.EDGE,AV=mstrmojo.qb.FFsqlToken.isDelimiter,E=150000,AM=67,S=86,AQ=88,h=90,AX="\n",q="\t",L=" ",J="c",Ab="v",X="x",u="z",AL="a",AA=";",AC=".",AO="[",p="]",K="addTable",H="addColumn",AG="compositionstart",e="compositionupdate",w="compositionend",AP="DOMCharacterDataModified",j="paste",G=mstrmojo.warehouse.EnumDataChangeEvents;function AW(Ae){var Ad=(t.isIE&&!t.isIE9)?Ae.keyCode:Ae.charCode;return(Ad>0)?String.fromCharCode(Ad):null;}var V,AZ=100,g={" ":true,"\t":true,"\n":true},A=["select","update","insert","delete","create","drop","alter","set","exec"],W=A.concat(["from","where","having","in","group","by","order","into","on","values","table","case","then","else","join","as"]),AN={};W=W.concat(["left","right","full","outer"]);function Z(){if(!V){V=[];M.forEach(W,function(Ad){V.push({n:Ad,sta:AZ,t:AZ});});}return V;}function R(){return{v:AX,isDelimiter:true,isNew:true,did:this.itemCount++};}function C(){return{v:L,isDelimiter:true,isNew:true,did:this.itemCount++};}mstrmojo.qb.FFsqlInput=mstrmojo.declare(mstrmojo.ME.TokenInputBox,null,{scriptClass:"mstrmojo.qb.FFsqlInput",renderBlockSize:50000,renderOnScroll:false,init:function x(Ae){this._super(Ae);var Ag={},Af=this,Ad=Ag[this.id]={};Ad.sqlTokensAdded=this.onsqlTokensAdded;Ad[G.DBROLE_CHANGED]=function Ah(){mstrApp.getRootController().enableButton(Af.getSQLstmt());};Ad[G.DBTABLES_ENABLED]=function(Ai){if(this.parent.visible){this.editNode.contentEditable=Ai.value?"true":"false";}};mstrApp.getRootController().attachDataChangeListeners(Ag);this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;},itemFunction:function AS(Ae,Ad,Af){return new mstrmojo.qb.FFsqlToken({data:Ae});},item2textCss:function AK(Ad){return" mstrmojo-qb-SuggestIcon t"+Ad.t;},itemIdField:"did",itemCount:0,ostack:[],sqlTokens:Z(),browseItemVisible:false,customFunctionVisible:false,raiseChangeEvent:function(Af){var Ae=U.trim(this.getSQLstmt()),Ad=mstrApp.getRootController();Af.name="tokensModify";this.raiseEvent(Af);Ad.enableButton(Ae);if(!Ae&&Ad.canAddTableSQL(true,Ae)){Ad.enableAvailableTables();}},getSQLstmt:function(){if(!this.items){return"";}var Ad=[];M.forEach(this.items,function(Af,Ae){Ad[Ae]=Af.v;});return Ad.join("");},onsqlTokensAdded:function z(Ad){var Ag=Ad.value,Af=this.itemCount,Ae=this.items;if(Af>0&&Ae[Af-1]!==AX){Ae.push({isNew:true,v:AX,isDelimiter:true,did:Af++});}M.forEach(Ag,function(Ah){Ah=P.copy({isNew:true,did:Af++},Ah);});Ae=Ae.concat(Ag);this.itemCount=Af;this.set("items",Ae);this.parent.updatepasses();},postBuildRendering:function Aa(){var Ad=this.editNode;if(this._super){this._super();}t.detachEvent(Ad,AG,this.oncompositionstart);t.detachEvent(Ad,e,this.oncompositionupdate);t.detachEvent(Ad,w,this.oncompositionend);if(t.isIE9||t.isIE10||t.isIEW3C){t.detachEvent(Ad,AP,this.ondomcharmodifed);}t.attachEvent(Ad,AG,this.oncompositionstart);t.attachEvent(Ad,e,this.oncompositionupdate);t.attachEvent(Ad,w,this.oncompositionend);if(t.isIE9||t.isIE10||t.isIEW3C){t.attachEvent(Ad,AP,this.ondomcharmodifed);}mstrApp.getRootController().attachEventListener("failureLabel",this.id,function(Ae){this.markFailureLabel(Ae.value);});},handlekeydown:function Y(Am){var Ax=this,Af=Am.keyCode||Am.charCode;if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}if(Ax._inHandleImeInputTimeout&&Af===AT.ENTER){window.setTimeout(function(){Ax.handlekeydown(Am);},0);t.stopPropogation(window,Am);t.preventDefault(window,Am);return false;}Am=Am||window.event;var Ad,As=false,Ak=o.getRangeInfo(),Ae=Ak.range.startContainer,Au=Ak.range.startOffset;switch(Af){case AT.DELETE:if(!this.doubleByte){try{this.widgetHandleDelete(Ak);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});this.parent.updatepasses();}catch(Ar){}As=true;}break;case AT.BACKSPACE:if(!this.doubleByte){try{this.widgetHandleBackspace(Ak);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();}catch(Aq){}As=true;}break;case AT.ENTER:if(this.suggestionShown){Ad=this.getSelected();if(Ad){this.handleSuggestionItemSelect(Ad);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}this.hideSuggestion();}else{var Ah,Ag,An,Av=this.ctxtBuilder.itemWidgets,Ay,Aw=null;Ag=t.findWidget(Ae);if(Ag.data!==undefined){Ah=o.getEdgeInfo(Ae,Au);An=this.itemIndex(Ag.data);Ay=Av[An].data.v===AX;}else{Ah=AI.EDGE_END;An=-1;Ay=false;}if(t.isFF){Aw=this.itemsContainerNode.scrollTop;}if(Ah===AI.EDGE_MIDDLE){if(Ay){this.add([C.call(this),R.call(this),C.call(this)],An);An=An+3;}else{var Al=Ag.split2Tokens(Ak.startOffset,this.itemCount++);this.remove(An);this.add([Al[0],R.call(this),Al[1]],An);An=An+1;}}else{if(Ah===AI.EDGE_BEGIN){this.add([C.call(this),R.call(this)],An);An=An+1;}else{An=An+1;this.add([C.call(this),R.call(this),C.call(this)],An);An=An+1;}}if(t.isFF||t.isIE||t.isIEW3C){An=Ay?An:An+1;Ag=Av[An];this._delaySetCaretPos(Ag.domNode,true);}else{Ag=Av[An];this._delaySetCaretPos(Ag.domNode,false);}this.delayedScrollToItem(An,Aw);this.parent.updatepasses();}As=true;break;case AT.TAB:if(this.suggestionShown){Ad=this.getSelected();if(Ad){this.handleSuggestionItemSelect(Ad);if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}}}else{this.startTokenSuggestion();}As=true;break;case AT.ESCAPE:this.endTokenSuggestion();As=true;break;case AM:if(Am.ctrlKey||Am.metaKey){this.ctrx=false;As=false;}break;case S:if(Am.ctrlKey||Am.metaKey){this._saveRangeInfo=o.getRangeInfo();if(!this._saveRangeInfo.collapsed){this.widgetDeleteTokens(this._saveRangeInfo);this._saveRangeInfo=o.getRangeInfo();}if(this.ctrx){this.handlepaste(this.cutstr);As=true;}else{this.clipboardNode.focus();As=false;}this.parent.updatepasses();}break;case AQ:if(Am.ctrlKey||Am.metaKey){try{var Aj=document.createElement("div");Aj.appendChild(Ak.range.cloneContents());Aj.innerHTML=Aj.innerHTML.replace(/<br\>/gi,"\n");this.cutstr=Aj.textContent.replace(/\u00A0/gi," ");this.widgetHandleDelete(Ak);this.startTokenSuggestion();this.ctrx=true;this.raiseChangeEvent({type:"cut"});}catch(Ap){}As=true;}break;case h:if(Am.ctrlKey||Am.metaKey){try{var Ai=this.ostack,At=Ai.length;if(At>1){Ai.pop();this.set("items",Ai[At-2].its);this.parent.updatepasses();this.focus();this.raiseChangeEvent({type:"undo"});}}catch(Ao){}As=true;}break;case AT.LEFT_ARROW:case AT.RIGHT_ARROW:this.endTokenSuggestion(true);break;case 229:if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=Ak;this.prev_items=this.items;}break;}if(As){t.stopPropogation(window,Am);t.preventDefault(window,Am);return false;}return true;},handlekeypress:function N(Ad){if(this.editNode.contentEditable==="false"){return true;}if(this._inComposition){return true;}Ad=Ad||window.event;var Ah=AW(Ad),Ae=false,Af=this,Ag;function Ai(){try{this.widgetHandleInput(o.getRangeInfo(),Ah);this.raiseChangeEvent({type:"input",characeter:Ah});var Aj=this._saveActiveToken;if(!AV(Ah)){if(!Aj){Ag=this.findObjectToken();if(Ag&&!Ag.isDelimiter()){this._saveActiveToken=Aj=Ag;}}if(Aj&&Ah===AC){var Al=AN[Aj.data.v.toLowerCase().slice(0,-1)];if(Al){if(Al.columns){this.startTokenSuggestion();}else{var Am=this;mstrApp.getRootController().getColumnsForDBTable({data:Al},{success:function An(Aq){var Ap=Aq.items,Ao=[],Ar=Aj.data.v;Al.columns=Ap;M.forEach(Ap,function(As){Ao.push({n:Ar+As.n,sta:2,t:26});});Am.set("candidates",{items:Am.candidates.items.concat(Ao),isComplete:true});Am.startTokenSuggestion();}});}}else{Aj.isCol=false;Aj.col=null;this.startTokenSuggestion();}}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(Ak){}}if(Ah&&!((Ah===J||Ah===X||Ah===Ab||Ah===u||Ah===AL)&&(Ad.ctrlKey||Ad.metaKey))){if(Af._inHandleImeInputTimeout||(t.isIE||t.isIEW3C)){if(Af._inHandleImeInputTimeout&&(t.isIE9||t.isIE10||t.isIEW3C)&&Ah===" "){}else{window.setTimeout(function(){Ai.call(Af);},1);}}else{Ai.call(Af);}Ae=true;}if(Ae){t.stopPropogation(window,Ad);t.preventDefault(window,Ad);return false;}return true;},handlekeyup:function O(Af){var Ag,Ad,Ae;if(this.doubleByte&&!this._inComposition){Ag=this.prev_rInfo;Ad=o.getRangeInfo();Ae=Ad.startContainer.data.slice(Ag.startOffset,Ad.startOffset);if(Ae){this.widgetHandleImeInput(Ag,Ae);}this.doubleByte=false;}else{if(this._super){this._super(Af);}}},oncompositionstart:function c(Ad){var Ae=t.findWidget(this);Ae._inComposition=true;Ae.doubleByte=true;Ae._savedCompositionData=null;if(!Ae._compositionDataArr){Ae.prev_rInfo=o.getRangeInfo();Ae.prev_items=Ae.items;Ae._compositionDataArr=[];Ae._savedCompositionData=null;Ae._beforeCompositionDOMChars=null;Ae._hasBeforeCompositionDOMChars=false;Ae._compositionDOMChars=null;}},oncompositionupdate:function Ac(Ad){var Ae=t.findWidget(this);if(Ae._inComposition){Ae._savedCompositionData=Ad.data;}},ondomcharmodifed:function d(Ad){var Ah=t.findWidget(this),Ag=Ad.newValue,Af=Ad.prevValue,Ae;if(Ah._inComposition){if(Ah._savedCompositionData===null){Ah._beforeCompositionDOMChars=Af;Ah._hasBeforeCompositionDOMChars=true;}else{Ah._compositionDOMChars=Ag;}if(t.isIEW3C&&!Ah._hasBeforeCompositionDOMChars){Ae=Ag.length<=Af.length?Ag:Af;Ah._beforeCompositionDOMChars=Ae;Ah._hasBeforeCompositionDOMChars=true;}}},oncompositionend:function I(Ad){var Ag=t.findWidget(this),Ae=Ag.prev_rInfo,Ah=Ae.range.startOffset,Ai,Af;Ag._inComposition=false;Ag.doubleByte=false;Af=Ad.data||Ag._savedCompositionData;if(Af!==null&&Af!==undefined){Ag._compositionDataArr.push(Af);}if(t.isIE9||t.isIE10||t.isIEW3C){if(Ag._compositionDOMChars&&Ag._compositionDOMChars.length){if(Ag._beforeCompositionDOMChars!==null){Ai=Ag._compositionDOMChars.substr(Math.min(Ah,Ag._beforeCompositionDOMChars.length),Ag._compositionDOMChars.length-Ag._beforeCompositionDOMChars.length);}else{Ai=Ag._compositionDOMChars;}if(Ai.length){Ag._compositionDataArr=Ai.split("");}}}if(Ag._compositionDataArr.length){Ag._inHandleImeInputTimeout=true;window.setTimeout(function(){Ag._inHandleImeInputTimeout=false;if(!Ag._inComposition&&Ag._compositionDataArr){if(t.findWidget(Ae.startContainer.parentNode?Ae.startContainer:Ae.range.startContainer)){Af=Ag._compositionDataArr.join("");Ag._compositionDataArr=null;Ag.widgetHandleImeInput(Ae,Af);Ag.raiseChangeEvent({type:"insert"});}}},0);}},markFailureLabel:function AR(Ad){this.pnum=Ad;this.parent.updatepasses();},getPassLabelYCoords:function a(){var Af=[],Ae=this.ctxtBuilder.itemWidgets,Ai=true,Ad=t.position(this.domNode).y,Ah,Ag;M.forEach(Ae,function(Aj){Ah=Aj.data;Ag=Ah.v;if(Ai&&!g[Ag]){if(Ag&&M.indexOf(A,Ag.toString().toLowerCase())>-1){Af.push(t.position(Aj.domNode).y-Ad);}Ai=false;}else{if(Ag===AA){Ai=true;}}});if(Af.length===1){Af=[];}return Af;},widgetHandleBackspace:function AD(Ai){if(Ai.collapsed){var Ae=this._saveActiveToken,Af,Ak;if(Ae&&Ae.data){Ak=Ae.data.v;if(Ak&&Ak[Ak.length-1]===AC&&Ae.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});Ae.isCol=false;Ae.col=null;}}var Ad,Ah,Al,Aj=Ai.startOffset,Ag=this.ctxtBuilder.itemWidgets;if(!t.contains(this.editNode,Ai.startContainer,false,document.body)){if(Ai.startOffset>0&&t.isFF){Ah=Ag[this.items.length-1];o.collapseOnNode(Ah.domNode,false);Ai=o.getRangeInfo();Ad=o.getEdgeInfo(Ai.range.startContainer,Ai.range.startOffset);}else{o.collapseOnNode(this.editNode,true);return ;}}Ad=o.getEdgeInfo(Ai.range.startContainer,Ai.range.startOffset);Ah=t.findWidget(Ai.range.startContainer);Al=this.itemIndex(Ah.data);if(Ad===AI.EDGE_BEGIN){Al--;Ah=Ag[Al];Aj=Ah.length();}if(!Ah){o.collapseOnNode(this.editNode,true);return ;}if(Ah.length()<=1){this.remove(Al);if(Ah.data.v===AA||Ah.data.v===AX){this.parent.updatepasses();}Ah=Ag[Al-1];if(Ah){o.collapseOnNode(Ah.domNode,false);this.checkMergeTwoTokens(Al-1,Al);Ah=Ag[Al-1];}else{o.collapseOnNode(this.editNode,true);}}else{Ah.spliceContent(Aj-1,1);if(Ah.isCol){this.set("candidates",{items:Ah.col,isComplete:true,isCol:true});}o.collapseOnTextNode(Ah.domNode,Aj-1);}}else{this.widgetDeleteTokens(Ai);this.parent.updatepasses();}},onpaste:function AJ(Ad){var Af=t.findWidget(this),Ag,Ae;if(!Af){return ;}if(Ad&&Ad.clipboardData&&Ad.clipboardData.getData){Ag=Ad.clipboardData.getData("text/plain");}else{if(window.clipboardData&&window.clipboardData.getData){Ag=window.clipboardData.getData("Text");}}if(typeof Ag!=="string"){return ;}Ae=Ag.replace(/\r/g,"");if(Ae===""){return ;}Af.handlepaste(Ae);t.stopPropogation(window,Ad);t.preventDefault(window,Ad);return false;},handlepaste:function m(Ae){var Af;if(typeof Ae!=="string"){Af=this.clipboardNode.value;}else{Af=Ae;}this.clipboardNode.value="";var Aj=[],Ad=Af&&Af.length,Ag,Ah="",Ai;if(Ad>E){Aj.push({v:Af,isNew:true,did:this.itemCount++});this.insertTokens(Aj);}else{if(Ad>0){for(Ag=0;Ag<Ad;Ag++){Ai=Af.charAt(Ag);if(AV(Ai)){if(!U.isEmpty(Ah)){Aj.push({v:Ah,isNew:true,did:this.itemCount++});Ah="";}Aj.push({v:Ai,isDelimiter:true,isNew:true,did:this.itemCount++});}else{Ah=Ah+Ai;}}if(!U.isEmpty(Ah)){Aj.push({v:Ah,isNew:true,did:this.itemCount++});}this.insertTokens(Aj);}}},insertTokens:function l(Aj){var Ai=this._saveRangeInfo,Af,Ah,Ag,Ad;if(!Ai||!t.contains(this.editNode,Ai.startContainer,false,document.body)){this.add(Aj);Af=this.ctxtBuilder.itemWidgets;Ad=Af.length-1;Ah=Af[Ad];this._delaySetCaretPos(Ah.domNode,false);this.delayedScrollToItem(Ad);this.raiseChangeEvent({type:"insert"});return ;}Ag=o.getEdgeInfo(Ai.startContainer,Ai.startOffset);Ah=t.findWidget(Ai.startContainer);Ad=this.itemIndex(Ah.data);if(Ag===AI.EDGE_MIDDLE){var Ae=Ah.split2Tokens(Ai.startOffset,this.itemCount++);this.remove(Ad);Aj.unshift(Ae[0]);Aj.push(Ae[1]);this.add(Aj,Ad);}else{Ad=(Ag===AI.EDGE_BEGIN?Ad:Ad+1);this.add(Aj,Ad);}Ad=Ad+Aj.length-1;Ah=this.ctxtBuilder.itemWidgets[Ad];this._delaySetCaretPos(Ah.domNode,false);this.delayedScrollToItem(Ad);this.raiseChangeEvent({type:"insert"});},widgetHandleInput:function AF(Al,Aj){if(!Al.collapsed){this.widgetDeleteTokens(Al);Al=o.getRangeInfo();}var Ae,Ai,Aq,Af,Am,An,Ah=this.ctxtBuilder.itemWidgets,Ap=this,Ao=Al.startContainer,Ad=Al.startOffset,Ag;if(!t.contains(this.editNode,Ao,false,document.body)||!Ah||Ah.length===0){this.add([{v:Aj,isDelimiter:AV(Aj),isNew:true,did:this.itemCount++}],0);Ai=Ah[0];o.collapseOnTextNode(Ai.domNode,1);this.delayedScrollToItem(0);return ;}Ae=o.getEdgeInfo(Ao,Ad);Ai=t.findWidget(Ao);Aq=this.itemIndex(Ai.data);if(AV(Aj)){if(this.candidates.isCol){this.set("candidates",{items:mstrApp.getRootController().getFFsqlComp(),isComplete:true});}Af={v:Aj,isDelimiter:true,isNew:true,did:this.itemCount++};if(Ae===AI.EDGE_MIDDLE){var Ak=Ai.split2Tokens(Ad,this.itemCount++);this.remove(Aq);this.add([Ak[0],Af,Ak[1]],Aq);Aq=Aq+1;}else{Aq=(Ae===AI.EDGE_BEGIN)?Aq:Aq+1;this.add([Af],Aq);}Ai=Ah[Aq];o.collapseOnNode(Ai.domNode,false);this._delaySetCaretPos(Ai.domNode,false);if(Aj===AA){this.parent.updatepasses();}}else{An=Ad;if(Ai.isDelimiter()){Am=Ah[(Ae===AI.EDGE_BEGIN)?Aq-1:Aq+1];if(Am&&!Am.isDelimiter()){Ai=Am;An=(Ae===AI.EDGE_BEGIN)?Ai.length():0;}Aq=(Ae===AI.EDGE_BEGIN)?Aq:Aq+1;this.add([{v:Aj,isNew:true,did:this.itemCount++}],Aq);Ai=Ah[Aq];o.collapseOnNode(Ai.domNode,false);this.parent.updatepasses();}else{Ag=Ai.data.v;Al=o.getRangeInfo();Ai.spliceContent(An,0,Aj);if(t.isIE||t.isIEW3C){o.collapseOnTextNodeIE(Ai.domNode,An+1);window.setTimeout(function(){Ap.editNode.focus();Ap.editNode.focus();o.collapseOnTextNodeIE(Ai.domNode,An+1);},0);}else{o.collapseOnTextNode(Ai.domNode,An+1);this._delaySetTextCaretPos(Ai.domNode,An+1);}}}this.delayedScrollToItem(Aq);},widgetHandleImeInput:function b(Ak,Ad){if(!Ak.collapsed){this.widgetDeleteTokens(Ak);Ak=o.getRangeInfo();}var Af,Ai,Ap,Al,Am,Ah=this.ctxtBuilder.itemWidgets,Ao=this,Aj,An=Ak.range.startContainer,Ae=Ak.range.startOffset,Ag=this.itemsContainerNode.scrollTop;if(!t.contains(this.editNode,An,false,document.body)||!Ah||Ah.length===0){this.clearTokens();this.add([{v:Ad,isDelimiter:this.isDelimiter(Ad),isNew:true,did:this.itemCount++,isIME:true}],0);Ah=this.ctxtBuilder.itemWidgets;Ai=Ah[0];o.collapseOnTextNode(Ai.domNode,Ai.data.v.length||1);this._delaySetCaretPos(Ai.domNode,false);this.delayedScrollToItem(0,Ag);return ;}Af=o.getEdgeInfo(An,Ae);Ai=t.findWidget(An);Ap=this.itemIndex(Ai.data);Am=Ae;if(Ai.isDelimiter()){this.clearTokens();this.set("items",this.prev_items);Ah=this.ctxtBuilder.itemWidgets;Aj=(Af===AI.EDGE_BEGIN)?Ap-1:Ap+1;Al=Ah[Aj];if(Al&&!Al.isDelimiter()){Ai=Al;Am=(Af===AI.EDGE_BEGIN)?Ai.length():0;Ap=Aj;}}if(!Ai.isDelimiter()){Ai.spliceContent(Am,0,Ad);if(t.isIE||t.isIEW3C){o.collapseOnTextNodeIE(Ai.domNode,Am+Ad.length);window.setTimeout(function(){Ao.editNode.focus();Ao.editNode.focus();o.collapseOnTextNodeIE(Ai.domNode,Am+Ad.length);},0);}else{o.collapseOnTextNode(Ai.domNode,Am+Ad.length);this._delaySetTextCaretPos(Ai.domNode,Am+Ad.length);}}else{Ap=(Af===AI.EDGE_BEGIN)?Ap:Ap+1;this.add([{v:Ad,isNew:true,did:this.itemCount++}],Ap);Ai=Ah[Ap];o.collapseOnNode(Ai.domNode,false);this._delaySetCaretPos(Ai.domNode,false);}this.delayedScrollToItem(Ap,Ag);this.startTokenSuggestion();return Ai;},getSearchPattern:function AE(){var Ae=this._saveActiveToken,Ag,Ad;if(Ae.isCol){var Af=Ae.data.v;Ag=Af.slice(Af.lastIndexOf(AC)+1,Af.length);}else{Ag=Ae&&Ae.data.v;}Ad=Ag&&Ag.length;if(Ad>2){if(Ag.charAt(0)===AO){Ag=Ag.substring(1);}if(Ag.charAt(Ag.length-1)===p){Ag=Ag.substring(0,Ag.length-1);}}return Ag;},getSuggestionPos:function AU(){var Al=this._saveActiveToken,Ah=null,Af,Aj=0;if(Al&&Al.isCol){Aj=Al.domNode.offsetWidth;}if(Al){Af=t.position(Al.domNode,true);var Am=Math.round(Af.y+Af.h),Ai=this.suggestionItems.length*19,Ak=mstrmojo.all.QBuilderPage,Ad=parseInt(Ak.height,10),Ae=t.position(Ak.domNode,true),Ag=(Ad>Am-40-Ae.y+Ai)?Am:Af.y-Ai;Ah={left:Math.round(Af.x)+Aj+"px",top:Ag+"px",zIndex:100};}return Ah;},onSuggestionItemSelect:function AH(Af){var Ae=this._saveActiveToken,Ag,Ai=this;this.endTokenSuggestion();if(Af.t===-98){Ag=this.items;this.clearTokens();M.forEach(Ag,function(Al){Al.did=Ai.itemCount++;});this.customFunctionMode=true;Ag=[{v:"{",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}].concat(Ag).concat([{v:"}",isDelimiter:true,sta:1,isNew:true,did:this.itemCount++}]);this.set("items",Ag);var Ad=this.itemIndex({did:this.itemCount-1}),Ak=this.ctxtBuilder.itemWidgets[Ad-1];this._delaySetCaretPos(Ak.domNode,false);}else{if(Ae){if(Ae.isCol){var Ah=Ae.data.v,Aj={};P.copy(Af,Aj);Aj.n=Ah.slice(0,Ah.lastIndexOf(AC)+1)+Af.n;Ae.setItemInfo(Aj);}else{Ae.setItemInfo(Af);}this._delaySetCaretPos(Ae.domNode,false);}}},ontokensModify:function(Ad){this.ostack.push({its:P.cloneArray(this.items)});this.pnum=-1;this.parent.updatepasses();},dropZone:true,allowDrop:function B(Ad){return(Ad.action===K||Ad.action===H);},getAvatarIconClass:function D(Ad){return"enabled";},ondragenter:function F(Ad){var Ae=Ad.src.widget;if(Ae&&Ae.toggleAvatarClass&&this.allowDrop(Ad)){Ae.toggleAvatarClass(this.getAvatarIconClass(Ad),true);}},ondragleave:function f(Ad){var Ae=Ad.src.widget;if(Ae&&Ae.toggleAvatarClass&&this.allowDrop(Ad)){Ae.toggleAvatarClass(this.getAvatarIconClass(Ad),false);}},ondragover:function n(Ai){var Af=Ai.tgt.widget,An=Ai.tgt.pos.x,Am=Ai.tgt.pos.y;var Ak=Af.ctxtBuilder.itemWidgets,Ah=Ak.length;if(Ah===0){return ;}var Ag=Ak[Ah-1].domNode,Aj=t.position(Ag),Ae;if(Am>Aj.y+Ag.clientHeight){Af._delaySetCaretPos(Ag,false);}else{for(Ae=Ah-1;Ae>-1;Ae--){if(Ak[Ae].data.v===AX||Ak[Ae].data.v===q){continue;}var Al=Ak[Ae].domNode,Ad=t.position(Al).y;if(Ad<Am&&!(Ad+14<Am)){Af._delaySetCaretPos(Al,false);break;}}}},ondrop:function(Ae){var Ah=Ae.action,Ak=Ae.src,Ad=mstrApp.getRootController(),Ag=this;if(Ak&&Ak.data){var Aj=Ak.data;if(Ah===K){var Ai=Ak.widget.dataHelper;if(!Ad.canAddTableSQL()){return ;}M.forEach(Aj,function(Am){Ai.fetch(Am,{success:function Al(An){Ad.addTableSQL(Am,An.items);Ad.enableButton(Ag.getSQLstmt());}});});}else{if(Ah===H){if(!Ad.canAddTableSQL()){return ;}var Af=Ak.widget.items[parseInt(Aj._renderIdx.split(":")[0],10)];Ad.addTableSQL(Af,[Aj]);Ad.enableButton(Ag.getSQLstmt());}}}},onscroll:function(Ad){if(t.isIE8){editNode=Ad.srcElement;}if(this.parentNode){mstrmojo.all[this.parentNode.id].parent.updatepasses();}},onRender:function Q(){if(this.hasRendered){t.attachEvent(this.editNode,"scroll",this.onscroll);this.itemsContainerNode.style.height="100%";}},addCandidateTables:function AY(Ad){var Ae=[],Af,Ag=Ad.value;AN={};M.forEach(Ag,function(Ah){Af=Ah.ns?Ah.ns+AC+Ah.n:Ah.n;Ae.push({n:Af,sta:2,t:15});AN[Af.toLowerCase()]=Ah;});this.set("candidates",{items:this.sqlTokens.concat(Ae).concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});},scrollToItem:function k(Aj,Af){var Ad=this.itemsContainerNode,Ah=Ad.childNodes[Aj],Ai,Ae,Ag=Ad.clientHeight,Ak;if(typeof Af!=="number"){Af=Ad.scrollTop;}Ae=Af;if(!Ah){return ;}Ak=Ah.offsetHeight;Ai=Ah.offsetTop;if(Ai<Af){Ae=Ai;}else{if(Af+Ag<Ai+Ak){Ae=Math.min(Ai,Ai+Ak-Ag);}}Ad.scrollTop=Ae;},delayedScrollToItem:function AB(Af,Ad){var Ae=this;if(typeof Ad!=="number"){Ad=this.itemsContainerNode.scrollTop;}window.setTimeout(function(){Ae.scrollToItem(Af,Ad);},0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Container","mstrmojo.desc","mstrmojo.ME.TokenInputBox","mstrmojo.mstr.EnumDSSXMLTokenTypes","mstrmojo.ME.Enum","mstrmojo._HasTooltip","mstrmojo.dom","mstrmojo.string");mstrmojo.requiresDescs(221,547,9106,9565,9566,9567,9568,11897,13542,13543,15665);var M=mstrmojo.array,S=mstrmojo.hash,I=mstrmojo.desc,O=mstrmojo.mstr.EnumDSSXMLTokenTypes,N=mstrmojo.ME.Enum.METRIC_EDIT_TYPES,L=mstrmojo.string.escape4HTMLText,E=mstrmojo.dom;var Q={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3,AMBIGUITY:4},G={0:"valid",1:"unknown",2:"validating",3:"error",4:"ambiguity"},R={0:I(9565,"Valid Metric Formula."),1:I(9106,"Require Validation?"),2:I(9566,"Validation in Progress..."),3:I(9567,"Validation Failed with Syntax Error!"),4:I(9568,"Validation Failed with Object Ambiguity!")},U={ERROR:"-2147214845",AMBIGUITY:"-2147214846"},B={};B[U.ERROR]=Q.ERROR;B[U.AMBIGUITY]=Q.AMBIGUITY;function P(a){if(!a){return Q.VALID;}return B[a]||Q.ERROR;}mstrmojo.ME.MetricEditBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.MetricEditBox",vStatus:Q.VALID,iStatus:"",showStatus:true,browseItemVisible:true,absorbAmbiguity:true,validateFunc:null,isObjectVisible:function(a){return true;},markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-MEBox-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;},statusNode:function(){return this.domNode.lastChild;}},markupMethods:{onvStatusChange:function(){var b=this.vStatus,a=this.vStatusNode;a.className="mstrmojo-MEBox-vStatus "+G[b];a.innerHTML=(this.getStatusDesc&&this.getStatusDesc(b))||R[b]||"";if(this.vStatus===Q.VALID){this.set("cValid",true);}},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"},editEmbeddedFilterToken:function(a){var b=this.parent;if(b.editEmbeddedFilterToken){b.editEmbeddedFilterToken(a);}}}],init:function V(a){var b=this,c=a.validateFunc||this.validateFunc;if(c){b.children=[{scriptClass:"mstrmojo.Button",alias:"validateBtn",slot:"statusNode",text:I(11897,"Validate"),cssClass:"mstrmojo-WebHoverButton right hoverLink",cssDisplay:"inline-block",onclick:c}].concat(this.children);}if(this._super){this._super(a);}this.statusCssClass=this.showStatus?"":"hidden";},getSearchPattern:function Z(){return this.inputBox.getSearchPattern();},getHighlightedText:function W(b,a){return this.inputBox.getHighlightedText(b,a);},item2textCss:function K(a){return{4:"m",7:"am",11:"fx",12:"a",13:"fc",43:"tr",47:"cs"}[a.t]||"";},handleSuggestionItemSelect:function J(a){var b=this.ambiguityDialog;if(a){b.onItemSelect(a);}b.close();},showDesc:true,showPath:true,ambiguityDialog:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-ambiguityDialog",onOpen:function(){this.set("title",I(13542,"Object Ambiguity - ##").replace("##",this.ambiguousName));this.list.clearSelect();this.list.set("items",this.items);this.list.singleSelect(0);this.label.set("text",I(13543,"More than one object with the name '##' were found.").replace("##",this.ambiguousName));},children:[{scriptClass:"mstrmojo.Label",alias:"label",text:""},{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",alias:"list",cssClass:"mstrmojo-ME-ambiguityList",bindings:{items:"this.parent.opener.suggestionItems"},onclick:function(a){mstrmojo._IsList.onclick.call(this,a);},getItemMarkup:function(d,a){var c=this.parent.opener,b=mstrmojo.string.escape4HTMLText;var f=(c&&c.item2textCss(d))||"";var e="";if(d.path){e='<div class="mstrmojo-object-additional-info" idx="'+a+'">'+mstrmojo.desc(16154,"From Dataset:")+" "+L(d.path)+"</div>";}else{d.standalone=true;}return'<div class="mstrmojo-object-item" idx="'+a+'"><div class="mstrmojo-object-name '+f+'" idx="'+a+'">'+L(d.n)+"</div>"+e+"</div>";},buildTooltip:function(a,b){if(a.standalone){return L(a.path)+"> "+L(a.n);}else{return L(a.n)+'<div class="mstrmojo-object-additional-info">'+mstrmojo.desc(16154,"From Dataset:")+" "+L(a.path)+"</div>";}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:I(547,"Select"),onclick:function(){var a=this.parent.parent;a.opener.handleSuggestionItemSelect(a.list.selectedItem);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:I(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},defaultOnTokensModify:function(){this.set("vStatus",Q.UNKNOWN);this.set("iStatus","");},postBuildRendering:function Y(){this._super();this.inputBox.attachEventListener("tokensModify",this.id,"defaultOnTokensModify");this.inputBox.attachEventListener("tokensModify",this.id,"ontokensModify");},updateInputBoxItems:function H(a){this.inputBox.set("items",a.items);},replaceErrorToken:function C(a){this.inputBox.replaceErrorToken(a);},clientSideValidation:function A(g){if(!g){return ;}var c=false,f=false,b=g.items;try{c=mstrApp.rootCtrl.docCtrl.model.isMDXDataset(S.any(this.parent.parent.datasets));f=g.met==N.ADVANCED&&b[0].tp==O.SimpPrefixFun&&b[0].v==="ApplySimple";}catch(h){}if(c&&f){var a=M.filterOne(b,function(e){return e.tp===O.DoubleQString;});var d=/(\'|\/\/|\-\-|\/\*|\*\/)/;if(a&&d.test(a.v)){g.vs=Q.ERROR;g.rjec=U.ERROR;g.rjed=I(15665,"MDX pass-through expression should not contain ', //, --, /*, */.");}}},handleValidation:function F(a){if(!a){this.set("vStatus",Q.ERROR);return ;}a.vs=P(a.rjec);this.set("vStatus",a.vs);this.set("iStatus",mstrmojo.string.encodeHtmlString(a.rjed)||"");this.updateInputBoxItems(a);this.inputBox.focus();if(a.vs===Q.AMBIGUITY){var l=this,h=a.items,g=M.find(h,"sta",-1),b=h[g].v,j=function(c){l.replaceErrorToken(c);l.set("iStatus","");l.set("vStatus",Q.UNKNOWN);if(l.continueValidataion){l.continueValidataion();}else{l.set("vStatus",Q.VALID);}};var d=M.filter(a.srfd.items,this.isObjectVisible);var k=this.parent.candidates,e=k&&k.items;if(e){M.forEach(d,function(f){var c=M.find(e,"did",f.did);if(c===-1){if(this.absorbAmbiguity){e.push(f);}}else{f.path=e[c].path;}});}if(d.length===1){j(d[0]);return ;}this.openPopup("ambiguityDialog",{zIndex:100,items:d,ambiguousName:b,onItemSelect:j});}else{if(this.postHandleValidation){this.postHandleValidation();}}},tooltip:"",useRichTooltip:true,updateTooltipConfig:function X(b){var c=b.target||E.eventTarget(b.hWin,b.e),a=E.position(c);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.getTooltipContent(b),top:a.y+a.h,left:a.x+10,cssClass:"vi-regular vi-tooltip-A"};},getTooltipContent:function(a){return this.iStatus;},showTooltip:function D(a,b){if(a.target===this.iStatusNode){this._super(a,b);}}});mstrmojo.ME.MetricEditBox.VALIDATION_STATUS=Q;mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_CSS=G;mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_DESC=R;}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.Refine.RefinePagination","mstrmojo.dom");mstrmojo.requiresDescs(4046,4049,1058,1059,2968,773,11411);var D=mstrmojo.css;var C={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var B={scriptClass:"mstrmojo.Refine.RefineDataCell"};var F="### rows";function A(G){return G.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");}mstrmojo.Refine.RefineDataPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineDataPreview",markupString:'<div class="refine-data-preview"><div class="refine-datapreivew-title cf"></div><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner" mstrAttach:scroll></div></div><div class="refine-viewpanel-header"></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[2];},dataNode:function(){return this.domNode.children[1];},tableNode:function(){return this.domNode.children[1].children[0];},titleNode:function(){return this.domNode.firstChild;}},enableEdit:true,columnIndex:-1,lastColumnIndex:-1,markupMethods:{onvisibleChange:function(){this.headerNode.style.display=this.enableEdit?"block":"none";}},onscroll:function(){this.controller.model.raiseEvent({name:"previewScrollTop",scrollTop:this.tableNode.scrollTop});},setDimensions:function E(K,H){var G=parseInt(K,10);var J=parseInt(H,10);var I=6;if(isNaN(G)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}G-=32;this.layoutConfig.h.dataNode=(this.enableEdit?(G-26-2):(G-2))+"px";this.layoutConfig.w.dataNode=(J-2)+"px";this.layoutConfig.h.tableNode=(this.enableEdit?(G-26-2-I):(G-2-I))+"px";this.layoutConfig.w.tableNode=(J-2)+"px";this.layoutConfig.w.headerNode=(J-16-2)+"px";if(this._super){this._super((G-2)+"px",(J-2)+"px");}},children:[{scriptClass:"mstrmojo.Refine.RefinePagination",slot:"headerNode",alias:"pagingNode"},{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(G){var I=G.value;for(var H=0;H<I.length;H++){I[H].destroy();}},populateData:function(J,K){this.removeChildren();this.unrender();var I=0,H,G;this.rows=K.rows.length+1;this.cols=J.length;for(H=0;H<J.length;H++){C.slot=I+","+H;C.columnIndex=H;C.text=J[H].name;C.preview=this.parent;C.allowEdit=this.parent.enableEdit;this.addChildren(C);}for(I=1;I<=K.rows.length;I++){for(H=0;H<J.length;H++){G=B;G.slot=I+","+H;G.columnIndex=H;G.column=J;G.rowIndex=K.rows[I-1].i;var L=K.rows[I-1].cells[J[H].cellIndex];if(L===null||L===undefined){L={v:""};}if(L.v===null||L.v===undefined){L.v="";}G.text=L.v;if(L.t){G.cssClass=L.t;}else{if(typeof L.v==="string"||L.v instanceof String){G.cssClass="text";G.text=L.v;}else{G.cssClass="number";}}G.preview=this.parent;G.columnName=J[H].name;this.addChildren(G);}}this.render();this.updateCellClass(J,K);},updateCellClass:function(J,L){var I,H;var K=this.domNode.firstChild.children;for(I=0;I<=L.rows.length;I++){var M=K[I];var G=M.children;for(H=0;H<J.length;H++){if(I===0){G[H].className="refine-header";}else{G[H].className="refine-cell";}if(this.parent.columnIndex>=0&&this.parent.columnIndex===H){G[H].className+=" selected";if(I===L.rows.length){G[H].className+=" last";}}if(this.parent.lastColumnIndex>=0&&this.parent.lastColumnIndex===H){G[H].className+=" last-selected";if(I===L.rows.length){G[H].className+=" last";}}}}}},{alias:"previewTitle",slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"refine-title-label"},{slot:"titleNode",scriptClass:"mstrmojo.Refine.RefineSampleButton",cssClass:"refine-title-sampleButton",},{scriptClass:"mstrmojo.Button",slot:"titleNode",alias:"refreshButton",cssClass:"mstrmojo.Refine.RefreshButton",iconClass:"mstrmojo-refine-refresh-button",visible:false,onclick:function(){var I=mstrApp.getRootController(),H=I.refineApp.rootController,G=H.model;if(G.hasUploadData){H.refreshSampleData(0);}},useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPCENTER,left:(parseInt(this.domNode.offsetWidth,10)+6).toString()+"px",top:"-"+(parseInt(this.domNode.offsetHeight,10)+21).toString()+"px",content:mstrmojo.desc(773,"refresh")});}}],columns:null,populate:function(I,L){var H=this.controller.model;var J=this.controller.tableID;var K;var G="";K=mstrApp.getRootController().getModel().getImportSource(J);if(K){G=K.sourceInfo.name;}if(!!this.previewTitle){this.previewTitle.set("text",mstrmojo.desc(11411,"Sample Data")+": "+G);}this.dataTable.populateData(I,L);this.pagingNode.children[1].set("text","/");this.pagingNode.children[2].set("text",A(H.data.filtered)+" "+mstrmojo.desc(2968,"Rows"));this.pagingNode.right.totalPages.set("text","/ "+Math.ceil((parseInt(H.data.filtered,10)/parseInt(H.limit,10))).toString());this.pagingNode.set("totalPages",Math.ceil((parseInt(H.data.filtered,10)/parseInt(H.limit,10))).toString());this.handleStartChange();},handleDataChanged:function(G){this.data=G.value;this.populate(this.columns,this.data);this.controller.model.raiseEvent({name:"columnUnSelected"});},handleColumnsChanged:function(G){this.columns=G.value.columns;},handleColumnSelected:function(G){if(this.columnIndex!==G.columnIndex){if(G.isCtrlKey){this.lastColumnIndex=this.columnIndex;this.lastColumnName=this.columnName;}else{this.lastColumnIndex=-1;}this.columnIndex=G.columnIndex;this.columnName=G.columnName;this.dataTable.updateCellClass(this.columns,this.data);if(G.updateScrollLeft){this.tableNode.scrollLeft=this.dataTable["0,"+this.columnIndex].offsetLeft;}}if(this.lastColumnIndex>=0){if(this.lastColumnIndex<this.columnIndex){this.controller.generateColumnSuggestions(this.columnIndex,this.lastColumnName,this.columnName,this.columnIndex-this.lastColumnIndex+1);}else{this.controller.generateColumnSuggestions(this.columnIndex,this.columnName,this.lastColumnName,this.lastColumnIndex-this.columnIndex+1);}}else{this.controller.generateColumnSuggestions(this.columnIndex);}},handleColumnUnSelected:function(){this.columnIndex=-1;this.lastColumnIndex=-1;if(this.data){this.dataTable.updateCellClass(this.columns,this.data);}this.controller.model.raiseEvent({name:"emptySuggestions"});},handleStartChange:function(){var G=this.controller.model;if(G.start===0){this.pagingNode.right.firstNode.set("enabled",false);this.pagingNode.right.firstNode.set("useRichTooltip",false);this.pagingNode.right.previousNode.set("enabled",false);this.pagingNode.right.previousNode.set("useRichTooltip",false);}else{this.pagingNode.right.firstNode.set("enabled",true);this.pagingNode.right.firstNode.set("useRichTooltip",true);this.pagingNode.right.previousNode.set("enabled",true);this.pagingNode.right.previousNode.set("useRichTooltip",true);}if(G.start+G.limit>=G.data.filtered){this.pagingNode.right.nextNode.set("enabled",false);this.pagingNode.right.nextNode.set("useRichTooltip",false);this.pagingNode.right.lastNode.set("enabled",false);this.pagingNode.right.lastNode.set("useRichTooltip",false);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(G.start,10)/parseInt(G.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(G.start,10)+1)+" - "+A(G.data.filtered));}else{this.pagingNode.right.nextNode.set("enabled",true);this.pagingNode.right.nextNode.set("useRichTooltip",true);this.pagingNode.right.lastNode.set("enabled",true);this.pagingNode.right.lastNode.set("useRichTooltip",true);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(G.start,10)/parseInt(G.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(G.start,10)+1)+" - "+A(parseInt(G.start,10)+parseInt(G.limit,10)));}},});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.dom");var B={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var A={scriptClass:"mstrmojo.Refine.RefineDataCell"};mstrmojo.Refine.RefineSuggestionPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineSuggestionPreview",markupString:'<div class="refine-suggestion-preview"><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner"></div></div></div>',markupSlots:{dataNode:function(){return this.domNode.children[0];},tableNode:function(){return this.domNode.children[0].children[0];}},enableEdit:true,scrollTop:0,setDimensions:function C(E){var D=parseInt(E,10);if(isNaN(D)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.dataNode=(this.enableEdit?(D-56-2):(D-2))+"px";this.layoutConfig.w.dataNode="auto";this.layoutConfig.h.tableNode=(this.enableEdit?(D-56-2):(D-2))+"px";this.layoutConfig.w.tableNode="auto";if(this.domNode){if(this.cellPos){this.domNode.style.top=(this.cellPos.tableTop+30)+"px";if(this.domNode.clientWidth+10<this.cellPos.distanceToRight){this.domNode.style.left=this.cellPos.cellRight+10+"px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview left";}else{if(this.domNode.clientWidth+10<this.cellPos.distanceToLeft){this.domNode.style.right=(this.cellPos.cellRight+this.cellPos.distanceToRight)-this.cellPos.cellLeft+10+"px";this.domNode.style.left="";this.domNode.className="refine-suggestion-preview right";}else{if(this.cellPos.distanceToRight>=this.cellPos.distanceToLeft){this.domNode.style.left="";this.domNode.style.right="0px";this.domNode.className="refine-suggestion-preview left";}else{this.domNode.style.left="0px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview right";}}}}}if(this._super){this._super((D-2)+"px","auto");}},children:[{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(D){var F=D.value;for(var E=0;E<F.length;E++){F[E].destroy();}},populateData:function(G,H){if(!G||!H){this.parent.domNode.style.display="none";return ;}else{this.parent.domNode.style.display="block";this.parent.domNode.style.left="";this.parent.domNode.style.right="";}this.removeChildren();this.unrender();var F=0,E,D;this.rows=H.rows.length+1;this.cols=G.length;for(E=0;E<G.length;E++){B.slot=F+","+E;B.columnIndex=E;B.text=G[E].name;B.preview=this.parent;B.suggestionPreview=G[E].suggestionPreview;B.cssClass="suggestion-preview columnNumber"+G[E].columnNumber;B.allowEdit=this.parent.enableEdit;this.addChildren(B);}for(F=1;F<=H.rows.length;F++){for(E=0;E<G.length;E++){D=A;D.slot=F+","+E;D.columnIndex=E;D.column=G;D.rowIndex=H.rows[F-1].i;var I=H.rows[F-1].cells[G[E].cellIndex];if(I===null||I===undefined){I={v:""};}if(I.v===null||I.v===undefined){I.v="";}D.text=I.v;if(I.t){D.cssClass="date";}else{if(typeof I.v==="string"||I.v instanceof String){D.cssClass="text";D.text=I.v;}else{D.cssClass="number";}}D.cssClass+=" suggestion-preview";D.cssClass+=" columnNumber"+I.columnNumber;D.preview=this.parent;D.columnName=G[E].name;this.addChildren(D);}}this.render();this.updateCellClass(G,H);this.parent.setDimensions(parseInt(this.parent.domNode.style.height,10)+2);},updateCellClass:function(G,I){var F,E;var H=this.domNode.firstChild.children;for(F=0;F<=I.rows.length;F++){var J=H[F];var D=J.children;for(E=0;E<G.length;E++){if(F===0){D[E].className="refine-header";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}if(0<E<G.length-1){D[E].className+=" center";}}else{D[E].className="refine-cell";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}if(F===I.rows.length){D[E].className+=" bottom";}}}}this.parent.tableNode.scrollTop=this.parent.scrollTop;}}],populate:function(D,E){this.dataTable.populateData(D,E);},handlePreviewSuggestion:function(D){this.cellPos=D.cellPos;this.populate(D.columns,D.data);},handleUnPreviewSuggestion:function(){this.populate();},handlePreviewScrollTop:function(D){this.scrollTop=D.scrollTop;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBSimplePreview");var E=mstrmojo.dom,F=mstrmojo.array;var C;mstrmojo.DI.DIPreviewGrid=mstrmojo.declare(mstrmojo.qb.QBSimplePreview,null,{scriptClass:"mstrmojo.DI.DIPreviewGrid",cssClass:"lockHeader mstrmojo-di-previewGrid",adjustSize:function(K){var J=200,I=this.parent&&this.parent.domNode,M=J*K;if(!I||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflowX=(M>I.clientWidth)?"scroll":"hidden";this.contentWidth=Math.max(M,I.clientWidth)+"px";var H=this.contentWidth,L=this.headerContainerNode,G=this.itemsContainerNode;if(H&&L&&G){L.children[0].style.width=H;G.style.width=H;}},renderOnScroll:false,setupScrollNodes:function B(){this.scrollNode=this.scrollboxNode;},lockHeader:false,postBuildRendering:function A(){if(this._super){this._super();}var G=this.domNode,I=this.scrollboxNode,H=this.headerContainerNode;I.style.height=G.offsetHeight-H.offsetHeight+"px";E.attachEvent(I,"scroll",function(){if(H.scrollLeft!==I.scrollLeft){H.scrollLeft=I.scrollLeft;}});E.attachEvent(H,"scroll",function(){if(I.scrollLeft!==H.scrollLeft){I.scrollLeft=H.scrollLeft;}});},populatePreview:function D(){var L=this.mappings,O=this.selectedColumns,H=0,G=this.scrollboxNode,K,N,I,J,P=this;this.columns=[];if(G){H=G.scrollLeft||0;}this.unrender();F.forEach(L,function(U,W){var Y=U.ix,X,S;X=U.n;S={tag:U,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-simplegrid-header",columnIndex:Y,headerText:X,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-simplegrid-headertext">{@en@headerText}</span></div>',onclick:function V(){var a=this.columnIndex;C.showPopupMenu(P,{menuNode:this.domNode.lastChild,data:{columnIndex:a,isVisible:function Z(c,b){return mstrApp.isFFSQLMode?false:true;}}});}},colWidth:"60",dataFunction:function(e,a,c){var Z=e[this.dataField],b="mstrmojo-di-datapreview-DataRow-text";b+=(a%2===1)?" odd":" even";return'<div class="'+b+'">'+Z+"</div>";},dataField:W.toString()};P.columns.push(S);});I=this.dataset;if(I.length===0&&this.columns.length>0){var Q=21;var M=parseInt(parseInt(this.parent.height)/Q)-1;M=M>0?M:1;var R;for(K=0;K<M;K++){R=[];for(J=0,N=this.columns.length;J<N;J++){R.push("");}I.push(R);}}this.items=I;this.render();this.adjustSize(L.length);this.updateScrollbars();this.scrollboxNode.scrollLeft=H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.QBSimplePreview");mstrmojo.requiresDescs(13033,12419,3389);var D=mstrmojo.desc;var A;mstrmojo.qb.QBMappings=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBMappings",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssClass:"mstrmojo-di-datapreview",cssText:"position:relative;overflow:hidden;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",width:0,height:0,dropZone:false,active:false,children:[{scriptClass:"mstrmojo.Box",alias:"previewInfo",cssClass:"mstrmojo-qb-preview-info",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><span class="mstrmojo-qb-preview-text"></span><span class="mstrmojo-qb-preview-menu" mstrAttach:click></span></div>',visible:false,markupSlots:{ButtonNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.domNode.lastChild.style.cssText+=(mstrApp.isFFSQL||mstrApp.isFFSQLMode)?";display:none !important":";display:inline-block !important";}},onclick:function H(){A.showPopupMenu(this.parent,{menuNode:this.domNode.lastChild});}},{scriptClass:"mstrmojo.qb.QBSimplePreview",alias:"content",columns:[],cssText:"width:100%"},{scriptClass:"mstrmojo.Label",alias:"notice",cssClass:"warnLabel",text:D(12419,"No preview available.")}],init:function G(K){var L,J;this._super(K);L={};J=L[this.id]={};J.dataPreview=this.handleDataPreview;mstrApp.getRootController().attachDataChangeListeners(L);},handleDataPreview:function I(K){mstrApp.getRootController().toggleDataPreview(true);var L=this.content,M=this.notice,Q=K.mappings,N=K.dataset,J=K.selectedColumns,P=K.isRefined,O=(Q&&Q.length>0);L.mappings=Q;L.dataset=N;L.selectedColumns=J;L.isRefined=P;L.set("visible",O);M.set("visible",!O);this.previewInfo.set("visible",O);mstrmojo.css.toggleClass(this.parent.domNode,"has-preview",O);O&&L.populatePreview();},onheightChange:function(L){if(this.domNode){var M=Math.max(parseInt(L.value,10),0),J=38,K;this.domNode.style.height=M+"px";K=Math.max(M-J+2,0);this.content.set("height",K+"px");}},onwidthChange:function C(K){if(this.domNode){var J=parseInt(K.value,10)+"px";if(J!=="NaNpx"){this.domNode.style.width=J;this.content.set("width",J);}}},postBuildRendering:function B(){if(this._super){this._super();}if(this.previewInfo){this.previewInfo.ButtonNode.innerHTML=(!!mstrApp.isWorkstation)?D(3389,"Preview"):D(13033,"Sample Preview");}}});function F(){mstrApp.getRootController().deleteAllColumns();}A=mstrmojo.qb.QBMappings;A.showPopupMenu=function E(M,K){var L=A.menuHelper=A.menuHelper||new mstrmojo.qb.QBPreviewMenu();L.target=M;var J=L.getMenuConfig();J.hostId=M.id;J.hostElement=K.menuNode;J.isHostedWithin=false;J.position=mstrmojo.dom.position(K.menuNode,true);M.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:J}));};mstrmojo.qb.QBPreviewMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.qb.DBTableRowMenu",menuCssClass:"mstrmojo-qb-DBTableRowMenu",menuCfg:null,getMenuConfig:function(){var J=this.menuCfg;if(!J){J=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{J.clear();}J.addMenuItem(D(5186,"Delete All"),"",F);return J;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.ListFacet","mstrmojo.Refine.RangeFacet","mstrmojo.Refine.TimeRangeFacet","mstrmojo.Refine.TextSearchFacet");var A=mstrmojo.dom;mstrmojo.Refine.RefineFacetPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineFacetPanel",facets:[],markupString:'<div class="refine-facet-panel"><div class="browsing-panel-header"><div class="browsing-panel-indicator"><img src="../javascript/mojo/css/images/Refine/small-spinner.gif"> Refreshing facets...</div><div class="browsing-panel-controls"  mstrAttach:click><div class="browsing-panel-controls-refresh"><a class="button" title="Update all facets">Refresh</a></div><a class="button button-pill-left" title="Clear selection in all facets">Reset All</a><a class="button button-pill-right" title="Remove all facets">Remove All</a></div></div><ul class="facets-container ui-sortable"></ul></div>',markupSlots:{ulNode:function(){return this.domNode.children[1];},indicatornNode:function(){return this.domNode.children[0].children[0];},controlsNode:function(){return this.domNode.children[0].children[1];},refreshNode:function(){return this.domNode.children[0].children[1].children[0].children[0];},resetNode:function(){return this.domNode.children[0].children[1].children[1];},removeNode:function(){return this.domNode.children[0].children[1].children[2];},headerNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onclick:function(C){var F=C.e,E,D=A.eventTarget(C.hWin,F);if(D===this.refreshNode){this.updateEngine(true);}else{if(D===this.resetNode){this.resetAllFacets();this.updateEngine(true);}else{if(D===this.removeNode){this.removeAllFacets();this.updateEngine(true);}}}},resetAllFacets:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];D.reset();}},removeAllFacets:function(){var D;while(this.facets.length){var C=this.facets[0];this.facets.splice(0,1);this.removeChildren(C);C.destroy();}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}},hasSelection:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];if(D.hasSelection()){return true;}}return false;},getRequirementDiscription:function(){var D,C="";var E=[],F;for(D=0;D<this.facets.length;D++){F=this.facets[D];if(F.hasSelection()){E.push(F);}}for(D=0;D<E.length;D++){F=E[D];C+=F.getRequirementDiscription();if(D!==E.length-1){C+=" & ";}}return C;},getJSON:function(D){var E;var C={facets:[],mode:"row-based"};for(E=0;E<this.facets.length;E++){var F=this.facets[E];if(D||F.hasSelection()){C.facets.push(F.getJSON());}}return C;},updateEngine:function(E){var C=this.parent.parent.parent.controller;var D=C.model;if(E){this.parent.toggleSecondItemVisibility(true);this.controlsNode.style.visibility="hidden";this.indicatornNode.style.visibility="visible";D.engine=JSON.stringify(this.getJSON());D.start=0;C.loadData();}else{D.engine=JSON.stringify(this.getJSON());}},addFacets:function(D,C){var E;switch(D){case"range":E=new mstrmojo.Refine.RangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"timerange":E=new mstrmojo.Refine.TimeRangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"text":E=new mstrmojo.Refine.TextSearchFacet({slot:"ulNode",type:D,config:C,options:{}});break;default:E=new mstrmojo.Refine.ListFacet({slot:"ulNode",type:D,config:C,options:{sort:"name"}});}this.addChildren([E]);this.facets.push(E);this.updateEngine(true);},removeFacet:function(F){var D;var E=F.hasSelection();for(D=this.facets.length-1;D>=0;D--){var C=this.facets[D];if(C===F){this.facets.splice(D,1);this.removeChildren(C);C.destroy();break;}}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}if(E){this.updateEngine(true);}else{this.updateEngine(false);if(this.facets.length===0){this.parent.toggleSecondItemVisibility(false);}}},handleFacetsFetched:function(E){var D=E.facets,C;for(C=0;C<D.length;C++){this.facets[C].updateState(D[C]);}this.indicatornNode.style.visibility="hidden";if(this.facets.length>0){this.controlsNode.style.visibility="visible";}else{this.parent.toggleSecondItemVisibility(false);}this.updateEngine(false);},children:[],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(isNaN(C)||isNaN(E)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}if(C<2){C=2;}this.layoutConfig.h.ulNode=(C-2)+"px";this.layoutConfig.w.ulNode=(E-2)+"px";if(this._super){this._super((C-2)+"px",(E-2)+"px");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ObjectInputBox","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{suggestionPopupCssClss:"mstrmojo-ACLInputBox-suggest",blockCount:10,useKeyDelay:true,getACLUserDataService:function C(){return mstrmojo.ACL.UserDataService;},item2textCss:function A(D){return(this._super&&this._super(D))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[D.st]||"";},getCandidatesThroughTaskCall:function B(E,D){this.getACLUserDataService().searchUserCandidates(E.pattern,!E.isVerify,E.blockCount,D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.ObjectInputBox","mstrmojo.DataGrid","mstrmojo.Editor");mstrmojo.requiresDescs(221,629,945,1442,1825,3095,4114,4115,4563,5298,8246,9125,12173,12916,12918,12947);var F=mstrmojo.hash,D=mstrmojo.expr,A=mstrmojo.ME.MetricToken.brackets,G=function(M){var J=null;if(M.isParam){J={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",alias:"paramInput",slot:"0,0",itemValidationField:"_did_",item2textCss:function E(N){return" mstrmojo-qb-SuggestIcon t"+N.t;},hideEditButton:function(){return false;},browseItemVisible:false,dynamicVerify:false,emptyText:mstrmojo.desc(9125,"Type here to input columns..."),postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===26;});if(!O){N.candidatesListener.push(this);}this.autoSelect=false;this.openPopup("suggestionPopup");this.suggestionPopup.close();this.autoSelect=true;}}],onParamAdded:function(P){var O=this.dataGrid.parent,N=this.paramInput;O.closePopup();P.state=0;N.add([P],N.items.length-1);},getTokens:function(){var Q=this.paramInput.getSelectedObjects(),N=Q.length,P,R=[],O;if(N>0){for(P=0;P<N;P++){if(Q[P].state===mstrmojo.Enum_OIB_States.VALID){O={v:A(Q[P].n)};O.oi=Q[P];}else{O={v:Q[P].n};}R.push(O);R.push({v:",",isDelimiter:true});}R.pop();}return R;}};var K=J.children[0];if(!M.isRepeated){K.cssClass="mstrmojo-ObjectInputBox singleObject noVerify";K.maxObjectCount=1;}else{K.cssClass="mstrmojo-ObjectInputBox noVerify";}}else{switch(M&&M.dtp){case 11:J={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-functionArgs-pulldown mstrmojo-Pulldown",items:[{n:mstrmojo.desc(4115,"False"),did:"0"},{n:mstrmojo.desc(4114,"True"),did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(N){this.value=this.data.dfv||0;},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:String(this.value)==="-1"?"True":"False"}];}return[];}};break;case -2:J={scriptClass:"mstrmojo.Table",cssClass:"breakBy",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ObjectInputBox",slot:"0,0",alias:"breakByInput",item2textCss:function E(N){return(this._super&&this._super(N))||{12:"a","-99":"br"}[N.t]||"";},emptyText:mstrmojo.desc(12916,"Type here to input breakby attributes..."),noEditButton:true,browseItemVisible:true,folderLinksContextId:16,browsableTypes:[D.TP.FOLDER,D.TP.ATTR].join(","),getCandidatesThroughTaskCall:function L(O,N){mstrmojo.ME.MetricDataService.getAttributes(O,N);},postCreate:function(O){var N=this.parent.dataGrid,P=N&&N.parent;this.candidates=P.getCandidates(function(Q){return Q.t===12;});if(!O){N.candidatesListener.push(this);}}},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onBreakByAdded"],browsableTypes:[D.TP.ATTR,D.TP.FOLDER].join(",")});}}]}],onBreakByAdded:function(P){var O=this.dataGrid.parent,N=this.breakByInput;O.closePopup();N.add([P],N.items.length-1);},getTokens:function(){var P=this.breakByInput.getSelectedObjects(),N=P.length,O,Q=[];if(N>0){Q.push({v:"BreakBy"});Q.push({v:"=",isDelimiter:true});Q.push({v:"{",isDelimiter:true});for(O=0;O<N;O++){Q.push({v:A(P[O].n),oi:P[O]});if(O!==(N-1)){Q.push({v:",",isDelimiter:true});}}Q.push({v:"}",isDelimiter:true});}return Q;}};break;case -1:J={scriptClass:"mstrmojo.Table",cssClass:"sortBy",layout:[{cells:[{cssText:"width: 330px"},{}]}],getTokens:function(){var Q=this.sortByGrid.items,N=Q.length,P,U=[];if(N>0){U.push({v:"SortBy"});U.push({v:"=",isDelimiter:true});U.push({v:"(",isDelimiter:true});for(P=0;P<N;P++){var R=Q[P],S=R.selFrm||(R.dssforms&&R.dssforms[0]),O={v:A(R.n),oi:R};if(S&&parseInt(R.t,10)===12){F.copy({v:A(R.n)+"@"+A(S.n),exv:S.dssid,extp:S.dtp},O);}U.push(O);if(P!==(N-1)){U.push({v:",",isDelimiter:true});}}U.push({v:")",isDelimiter:true});}return U;},children:[{scriptClass:"mstrmojo.DataGrid",slot:"0,0",cssClass:"mstrmojo-functionArgs-sort",alias:"sortByGrid",renderOnScroll:false,resizableColumns:true,makeObservable:true,itemDisplayField:"n",columns:[{headerText:mstrmojo.desc(945,"Name"),dataField:"n",colCss:"nmCol"},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(8246,"Field"),dataField:"field",colCss:"spcCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",bindings:{items:"this.data.dssforms"},popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.selFrm=this.selectedItem;}}},{headerText:mstrmojo.desc(3095,"Order"),dataField:"order",colCss:"ordCol",dataWidget:{scriptClass:"mstrmojo.Pulldown",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,onvalueChange:function(){this.data.asc=this.value;}}},{dataWidget:{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(N){this.dataGrid.remove(this.data);}},headerText:"&nbsp",colCss:"actionsCol"}]},{scriptClass:"mstrmojo.ToolBar",slot:"0,1",cssClass:"mstrmojo-oivmSprite grouped",children:[{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1825,"Browse"),iconClass:"tbBrowse",onclick:function(){var O=this.parent.parent.dataGrid.parent;O.openPopup("ob",{zIndex:O.zIndex+10});var N=O.ob.browser;N.browse({folderLinksContextId:16,onSelectCB:[this.parent.parent,"onSortByAdded"],browsableTypes:[D.TP.ATTR,D.TP.METRIC,D.TP.FOLDER].join(",")});}}]}],onSortByAdded:function(Q){var O=this.dataGrid.parent,P=this.sortByGrid;O.closePopup();if(Q){switch(Q.t){case 12:var R=function(S){if(S){var U=S.container;if(U&&U.dssforms){Q.dssforms=U.dssforms;P.add([Q]);}}},N=function(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:Q.did,displayedForms:0},{success:R,failure:N});break;case 4:Q.dssforms=[{n:"Value"}];default:P.add([Q]);}}}};break;default:J={scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(N){var O=this.data;this.value=(O.dfv||O.dfv===0)?O.dfv:"";},getTokens:function(){var N=this.data;if(this.value!==N.dfv){return[{v:N.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}};break;}}J.alias="inputWidget";return J;},I=function(K,E,J){return'<div class="mstrmojo-DataRow-text"title="'+(K.desc||"")+'">'+K.n+(K.isParam?"*":"")+":</div>";};mstrmojo.qb.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.FunctionWizard",init:function H(E){this._super(E);this.help=this.help||(mstrApp&&mstrApp.helpTopics&&mstrApp.helpTopics.fnWiz);},cssClass:"mstrmojo-FunctionWidzard",title:mstrmojo.desc(4563,"Function Arguments"),help:"",fctOi:null,fctArgs:null,fctSyntax:"",bindings:{candidates:"this.opener.candidates"},getCandidates:function B(K){var J=this.candidates,E;if(J){E=mstrmojo.array.filter(J.items,K);return{items:E,isComplete:J.isComplete};}return null;},_set_candidates:function(N,J){this.candidates=J;if(this.hasRendered&&this.visible){var L=this.argsGrid,M=L.candidatesListener,E=M.length,K;for(K=0;K<E;K++){M.postCreate(true);}}return true;},onOpen:function(){var J=this,L,K=function(P){if(P){J.set("fctOi",P);var R=[],O,M,Q,N=[];N.push(P.n);N.push("(");M=(P.pars&&P.pars.length)||0;for(O=0;O<M;O++){Q=F.copy(P.pars[O]);Q.isParam=true;R.push(Q);N.push(P.pars[O].n);if(O!==(M-1)){N.push(", ");}}N.push(")");if(P.rpc>0){Q.isRepeated=true;}M=(P.pros&&P.pros.length)||0;if(P.did==="6F7DF5FF449111D5BEA300B0D01A55EF"){M=0;}for(O=0;O<M;O++){if(P.pros[O].n!=="UseLookupForAttributes"){R.push(F.copy(P.pros[O]));}}if(P.sqt===5){R.push({n:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:mstrmojo.desc(12918,"Break By is a parameter representing the break by levels for this function.")});}J.set("fctArgs",R);J.set("fctSyntax",N.join(""));}mstrmojo.css.removeClass(J.argsGrid.domNode,["loading"]);},E=function(M){mstrmojo.alert(M.getResponseHeader("X-MSTR-TaskFailureMsg").replace(/com\.microstrategy\.(.*): \((.*)\)/,"$2"));mstrmojo.css.removeClass(this.argsGrid.domNode,["loading"]);};this.argsGrid.set("items",[]);mstrmojo.css.addClass(this.argsGrid.domNode,["loading"]);this.set("fctSyntax","");this.set("title",mstrmojo.desc(12947,"Function arguments for:")+this.fctOi.n);L={functionId:this.fctOi.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};mstrApp.getRootController().getDataService().getFunctionDetails({success:K,failure:E},L);},getTokens:function C(){var L=this.argsGrid.ctxtBuilder.itemWidgets,O=L.length,N,S,P=[],K=[],U=[],Q,M,J,E,R=this.fctOi;for(N=0;N<O;N++){S=L[N].inputWidget;if(S.data.isParam){K.push(S.getTokens());}else{P.push(S.getTokens());}}U.push({v:R.n,oi:R});O=P.length;if(O>0){E=false;U.push({v:"<",isDelimiter:true});for(N=0;N<O;N++){Q=P[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){U.push(Q[M]);}U.push({v:",",isDelimiter:true});}U.pop();if(E){U.push({v:">",isDelimiter:true});}}O=K.length;U.push({v:"(",isDelimiter:true});E=false;for(N=0;N<O;N++){Q=K[N];J=Q.length;if(J===0){continue;}E=true;for(M=0;M<J;M++){U.push(Q[M]);}U.push({v:",",isDelimiter:true});}if(E){U.pop();}U.push({v:")",isDelimiter:true});return U;},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},children:[{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:"functionArgs",banding:false,columns:[{headerText:"Property Name",dataFunction:I,colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:G,colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-syntaxLabel",text:"",bindings:{text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FW-descLabel",text:"",bindings:{text:function(){return this.parent.fctOi.desc;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-FW-buttonBox mstrmojo-Function-Arguments",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;if(E.insertOnFinish){E.insertOnFinish(E.getTokens());}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.WidgetList","mstrmojo.qb.FilterTree","mstrmojo.CustomGroupEl","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ConditionNode","mstrmojo._IsPopup");mstrmojo.requiresDescs(118,1994,2550,3415,3416,5893,7953,12367,12368);var D=mstrmojo.hash,G=mstrmojo.array,M=mstrmojo.expr,H=M.BRANCH_FNS,N=mstrmojo.dom,E=mstrmojo.desc;function B(O){if(!O){return undefined;}var P=O.nds;if(!P){return O;}G.forEach(P,function(R,Q){P[Q]=B(R);});O.nds=P.slice(0);return O;}function I(O,Q,P){G.forEach(O,function(S,R){if(S.nds){I(S.nds,Q,P);}else{if(S===Q){O[R]=P;}}});}function L(Q,O){var R=Q.data,P=R?Q.parent.parent.parent.editorNode:Q.parent.editorNode;mstrApp.getRootController().openExpressionEditor({n:O?mstrmojo.desc(5893,"New Condition"):mstrmojo.desc(7953,"Condition Editor"),tkn:O?[]:R.expr,zIndex:(P&&parseInt(P.style.zIndex,10)+1),callbacks:{success:function S(V){var X={0:"filterExpr",1:"aggfilterExpr"},U=V.mi,W=U.exp.sqltp;var Y={et:"*",expr:U.items,n:V.expr,sqltp:W};if(O){Q[X[W]].newCondition(Y);}else{if(R.sqltp===W){I(Q.tree.items,Q.data,Y);Q.data=Y;Q.paint();}else{Q.del();Q.tree.parent[X[W]].newCondition(Y);}}}}});}function F(O){var P=O&&O.items;if(P){O.remove(P);}}mstrmojo.qb.ConditionEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._HasPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.qb.ConditionEditor",cssClass:"mstrmojo-qb-filterEditor",title:mstrmojo.desc(2550,"Filters"),ondataChange:function C(){var O=this.CEl,Q=this.data,P=Q.having,R=D.clone(Q.where);O.filterExpr.set("items",[]);O.filterExpr.add(R?[R]:[],0);O.aggfilterExpr.set("items",[]);O.aggfilterExpr.add(P?[P]:[],0);},children:[{scriptClass:"mstrmojo.CustomGroupEl",cssClass:"mstrmojo-qb-filterTreeBox",alias:"CEl",markupString:'<div id="{@id}" class="mstrmojo-onhoverparent mstrmojo-CustomGroupEl {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-cond-details {@cssClass}"><div class="mstrmojo-qb-expr-tools {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"><br></div><div class="mstrmojo-CustomGroupEl-expr {@cssClass}"></div></div></div>',markupMethods:{onstateChange:function(){this.detailsNode.style.display=this.state?"block":"none";}},markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},detailsNode:function(){return this.domNode.lastChild;},exprNode:function(){return this.domNode.lastChild.children[2];},expr2Node:function(){return this.domNode.lastChild.children[4];},exprToolsNode:function(){return this.domNode.lastChild.firstChild;}},parent:this.parent,children:[{scriptClass:"mstrmojo.qb.FilterTree",slot:"exprNode",alias:"filterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.qb.FilterTree",slot:"expr2Node",alias:"aggfilterExpr",onexprclick:function A(O){L(O,false);}},{scriptClass:"mstrmojo.Box",slot:"exprToolsNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-CGE-addCondition-button",onclick:function(){L(this.parent.parent,true);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-CGE-addCondition",text:mstrmojo.desc(1994,"Add Condition"),onclick:function(){L(this.parent.parent,true);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5186,"Delete All"),cssClass:"mstrmojo-qb-deleteAll",onclick:function(){var O=this.parent.parent;F(O.filterExpr);F(O.aggfilterExpr);}}]}],state:true}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function K(){var P=this.parent.parent,O=P.CEl;mstrApp.getRootController().updateFilters(B(O.filterExpr.items[0]),B(O.aggfilterExpr.items[0]));P.set("visible",false);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),onclick:function K(){var Q=this.parent.parent,P=Q.CEl,R=Q.data,U=1000;if(D.equals(B(P.filterExpr.items[0]),R.where)&&D.equals(B(P.aggfilterExpr.items[0]),R.having)){Q.set("visible",false);return ;}var O=mstrmojo.Button.newInteractiveButton;mstrmojo.confirm(E(12367,"All your changes on the filter will be lost. Do you want to exit?"),null,{buttons:[O(mstrmojo.desc(1442,"OK"),function S(){Q.set("visible",false);},null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton","hot"]);}}}),O(mstrmojo.desc(3416,"Cancel"),mstrmojo.emptyFn,null,{onRender:function(){if(mstrApp.isCloudPro){mstrmojo.css.addClass(this.domNode,"cloud cancel");}else{mstrmojo.css.addClass(this.domNode,["mstrmojo-di-button","mstrmojo-WebButton"]);}}})],title:E(12368,"Lose Your Changes?"),zIndex:U});}}],getMovingHandle:function J(){return this.children[0].domNode;},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",cssText:"width: auto;",contentNodeCssClass:"mstrmojo-balloon",left:"250px",top:"15px",slot:"containerNode",autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var O=this.condition,R=O&&O.data&&O.data.not,U=O&&O.parent,P=U&&U.data,Q=(P&&P.fn)+(R?21:0),S=this.list;S.opening=true;S.set("selectedItem",isNaN(Q)?null:{did:Q});S.opening=false;this.curtainNode.style.position="fixed";},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",items:[{did:19,n:H[19]},{did:20,n:H[20]},{did:19+21,n:H["19_21"]},{did:20+21,n:H["20_21"]}],onchange:function(){if(this.opening){return ;}var P=this.parent,O=P.condition,V=this.selectedItem,U=V&&V.did,S=U>21?true:null,R=U-(S?21:0);P.close();var Q=O&&O.parent;if(Q&&Q.data&&Q.data.et===M.ET.ANDOR){Q.edit(O,R,S);}else{var W=O&&O.data;if(W&&(W.not!==S)){W.not=S;O.paint();}}}}]},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onTab:function(P){if(this.onEnter){this.onEnter();}var O=N.shiftKey(P.hWin,P.e)?this.prevTab:this.nextTab;if(O&&O.onclick){O.onclick();}},onblur:function(){if(this.onEnter){this.onEnter();}},onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var P=this.txt,O=this.txtConfig;D.forEach(O,function(Q){P.set(Q,O[Q]);});P.focus();},onClose:function(O){if(!O||(!O.cancel&&!O.enter)){this.txt.onEnter();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.mstr.EnumNodeProperties","mstrmojo.fe.FilterExprTree","mstrmojo.fe.AndOrNode","mstrmojo.fe.RelationNode","mstrmojo.fe.DynamicNode","mstrmojo.fe.ConditionNode");var M=mstrmojo.expr.ET,K=mstrmojo.mstr.EnumNodeProperties;mstrmojo.fe.RelationFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RelationFilterExprTree",nodeClassMap:{14:mstrmojo.fe.AndOrNode,15:mstrmojo.fe.RelationNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},getItemIdentityProp:function(N){if(N.node&K.CONDITION){return"*";}if(N.ph){return"ph";}if((N.et===10||N.et===12)&&N.dmt===4){return M.RLS;}return N.et;},isEditable:function L(O){var N=false;switch(O&&O.et){case M.RLS:N=true;break;}return N||this._super(O);},getItemConfig:function B(Q,N,R){var O=this._super(Q,N,R),P=(Q.et===M.RLS||!!Q.relation);if(P){O.itemFunction=R.itemFunction;}return O;},newCondition:function F(P){var O=this.getSelectedItemWidget(),N=0;if((typeof microstrategy!=="undefined")&&microstrategy.bones&&microstrategy.bones.rwb_viewer){N=microstrategy.bones.rwb_viewer.nextPhIndex;}else{if(mstrApp&&mstrApp.docModelData&&mstrApp.docModelData.phIndex){N=mstrApp.docModelData.phIndex;}}if(P&&P.ph&&!P.ph.idx){P.ph.idx=N++;}if(O&&O.selected&&O.newCondition){return O.newCondition(P);}else{return this._super(P);}},createSet:function E(O,N){var P=N.rq,Q=N.cq;if(P&&Q){this.remove(Q);if(N.isMetric){mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],P,Q);P=Q;}else{P.nds=[Q];}this.add([P],O[0]);}},removeSet:function I(N){var O=N.data,P=[O];this.remove(O);if(O.nds&&O.nds.length>0){P=O.nds;}else{delete O.dmy;delete O.relation;delete O.applySubExpr;delete O.relation;delete O.useSchema;delete O.dmt;}this.add(P,0);},nameFactory:{counter:1,names:{},clear:function(){this.resetCounter();this.names={};},resetCounter:function D(){this.counter=1;},isNameExist:function J(N){return !!this.names[N];},setName:function H(N,O){this.names[N]=O;},changeName:function C(O,N,P){this.removeName(O);this.setName(N,P);},getNewName:function G(Q,P,S){var R=P||"",O=S||"",N;while(this.isNameExist(R+this.counter+O)){this.counter++;}N=R+this.counter+++O;this.names[N]=Q;return N;},removeName:function A(N){delete this.names[N];this.resetCounter();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.SaveAsEditor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(1442,12376,12377,12908);var F=mstrmojo.array,H=mstrmojo.DI.DIConstants,C=mstrmojo.desc;var D=0,E=-1,B=-2;mstrmojo.DI.ui.dialogs.DISaveAsDialog=mstrmojo.declare(mstrmojo.SaveAsEditor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DISaveAsDialog",cssClass:"mstrmojo-SaveAsEditor",typeDesc:"Cube",browsableTypes:"776,779,8",zIndex:1000,folderLinksContextId:28,onRender:function I(){this.ob.set("scrollableIncFetch",true);},validateInput:function(O,Q){var N=mstrApp.getRootController(),K=this.contPanel,M=this.ob.currentFolder,R=K.name.value,P=this,S=D,L;this.name=K.name.value;this.desc=K.desc.value;this.folderID=M.did;this.saveAsOverwrite=!!O;if(!this.name||H.invalidObjectNameCharsRegex.test(this.name)){S=E;Q(S);return ;}F.forEach(M.items,function(U){if(U.t===3&&U.n.toUpperCase()===R.toUpperCase()){S=B;return false;}});if(S!==D){Q(S);return ;}L={rootFolderID:M.did,searchPattern:R,objectType:P.browsableTypes,nameWildcards:0};if(this.ob.enableQuickSearch){L.quickSearch=this.ob.enableQuickSearch;}N.dataService.searchFolderContents({success:function(U){if(U&&U.items){F.forEach(U.items,function(V){if(V.t===3&&V.n.toUpperCase()===R.toUpperCase()){S=B;return false;}});}Q(S);},failure:function(U){N.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,U.message);}},L);},saveCube:function J(){var P=mstrApp.getRootController(),O=P.getModel();var M=this.saveParams||{};M.folderID=this.folderID;M.objDesc=this.desc||"";M.objName=this.name||"";M.saveAsOverwrite=this.saveAsOverwrite;var L=this.saveAsCallback();L.parent=this;var Q=O.isDirectDataAccess?true:false;mstrApp.serverRequest(M,L,{showProgress:Q});this.close();var N,R=[],S=O.importSources;for(N in S){var K=S[N].sourceInfo.name;S[N].status="0";R.push({n:K,complete:false});}O.cubeName=this.name||"";if(!O.isDirectDataAccess){O.raiseEvent({name:"PublishStatusUpdate"});P.showDialog(H.dialogType.publishStatusDialog,{model:O,zIndex:mstrApp.getRootController().dialogController.getNextZIndex()});}P.enableFinishButton(false);},saveAs:function(K){var L=this;this.validateInput(K,function(M){switch(M){case D:L.saveCube();break;case E:mstrmojo.alert(C(12376,"Please enter a valid cube name"));break;case B:var N=C(12377,"Saving cube with the same name");mstrmojo.warn(mstrmojo.desc(12908,"The name #### already exists. Do you want to replace the existing one?").replace("####",this.name),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){L.saveCube();},hot:true},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{title:N});break;}});},close:function(){if(this._super){this._super();}},getObjectPath:function G(){var M=this.ob.currentFolder,N=this.name,L="\\",O="",K;if(M){K=M.anc&&M.anc.items;while(K[0].n!==M.n&&K[0].n!=="Shared Reports"&&K[0].n!=="My Reports"){K=K[0].items;}while(K){O=O+K[0].n+L;K=K[0].items;}}O+=N;return O;},postBuildRendering:function A(){if(this._super){this._super();}this.buttonBox.cancel.onclick=function(){var L=mstrApp.getRootController(),K=L.getModel&&L.getModel()||L.model;if(K.isDirectDataAccessBeforeSave!==undefined&&K.isDirectDataAccess!==K.isDirectDataAccessBeforeSave){K.set("isDirectDataAccess",K.isDirectDataAccessBeforeSave);}this.parent.parent.close();};},});}());(function(){mstrmojo.requiresCls("mstrmojo.HBox","mstrmojo.Box","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.qb.AttributeMapping","mstrmojo.qb.TimeDimension","mstrmojo.qb.GeoRole");mstrmojo.requiresDescs(218,219,517,518,629,1088,1388,2052,2170,3434,3544,4530,4699,8984,9133,9134,9912,9918,9919,9920,9921,9922,11170,11171,11621,12927,13036);var B=mstrmojo.css,Q=mstrmojo.dom,M=mstrmojo.string;var N=mstrmojo.desc(11170,"This column contains geographical locations. Additional columns will be created automatically so that you can view your data on Google Maps. See menu options for details."),E=mstrmojo.desc(11171,"This column contains date values. Additional columns will be created automatically. See menu options for details.");var I=function(S,V,X){var W={},Y=S,U,R;for(U=0,R=V.length;U<R;U++){(V[U].tp==X)&&(W[V[U].alias]=1);}U=0;while(W[Y]){Y=S+" ("+(++U)+")";}return Y;};function O(V,R,S){var W="mstrmojo-di-timedimension";var U=mstrmojo.all[W];if(!U){U=new mstrmojo.qb.TimeDimension({height:R,mode:V,der:S});}else{U.set("height",R);U.set("mode",V);U.set("der",S);}return U;}function P(W,R,U,S){var X="mstrmojo-di-georole";var V=mstrmojo.all[X];if(!V){V=new mstrmojo.qb.GeoRole({height:"200px",georole:W,der:R,shapeKey:U,shapeKeys:S});}else{V.set("georole",W);V.set("der",R);V.set("shapeKey",U);}return V;}var H=[{did:"QBAttribute",n:mstrmojo.desc(518,"Attribute"),items:[{did:"QBTimeGeo"}]},{did:"QBMetric",n:mstrmojo.desc(517,"Metric")},{did:"QBNone",n:mstrmojo.desc(13036,"Do Not Import")},{did:-1,n:"-"},{did:"QBRename",n:mstrmojo.desc(1388,"Rename")},{did:"QBMap",n:mstrmojo.desc(9133,"Map to project ...")},{did:"QBUnMap",n:mstrmojo.desc(9134,"Unmap from project")},{did:-1,n:"-"},{did:"QBEdit",n:mstrmojo.desc(1088,"Edit")},{did:"QBRemove",n:mstrmojo.desc(629,"Delete")}];function K(S,U,V){var R,W={1:1|2|4|8|16|32|64|128|256|512|1024|2048|4096,8:1|2|4|8|16|32|64|128|256|512,9:1024|2048|4096};R=W[V];R=R?R:(268435456|536870912|1073741824);S.der=S.der&R;U.der=S.der;}var L={scriptClass:"mstrmojo.MenuButton",cssClass:"mstrmojo-di-datapreview-cxtmenu",cmCssClass:"mstrmojo-di-datapreview-popmenu",id:"mstrmojo-di-datapreview-cm",postCreate:function(){if(!mstrApp.isCloudPro){H=H.concat([{did:-1,n:"-"},{did:"QBDataType",n:mstrmojo.desc(9918,"Data Type"),items:[{did:"2",n:mstrmojo.desc(3434,"Number")},{did:"3",n:mstrmojo.desc(3544,"Text")},{did:"8",n:mstrmojo.desc(2052,"Date")},{did:"1",n:mstrmojo.desc(9919,"DateTime")},{did:"9",n:mstrmojo.desc(2170,"Time")},{did:"11",n:mstrmojo.desc(9920,"Big Decimal")},{did:"6",n:mstrmojo.desc(4699,"Email")},{did:"7",n:mstrmojo.desc(9921,"HTML Tag")},{did:"12",n:mstrmojo.desc(8984,"Phone Number")},{did:"10",n:mstrmojo.desc(4530,"Symbol")},{did:"5",n:mstrmojo.desc(9922,"URL")}]}]);}this.cm=H;},getMenuPosition:function J(){var R=mstrmojo.dom.position(this.domSrc,true);return{x:Math.round(R.x),y:Math.round(R.y+R.h)};},dataGrid:null,widget:null,dynamicUpdate:true,queryEnabled:function(R){var S=this.widget;switch(R.did){case"QBAttribute":return !S.ipa;break;case"QBMetric":return(S.tp!=4)&&!S.ipa;break;case"QBNone":return S.mapped;break;case"QBRename":return S.mapped&&!S.ipa;break;case"QBEdit":case"QBMap":return !S.ipa;break;case"QBUnMap":return S.ipa;break;default:return true;}},queryVisible:function(U){var S=this.dataGrid,R=this.widget;switch(U.did){case"QBAttribute":case"QBMetric":case"QBRename":return this.widget.hasMapped;break;case"QBMap":case"QBUnMap":return this.widget.hasMapped&&this.widget.tp==12&&this.widget.sptMap;break;case"QBEdit":return !!this.widget.isQB;break;case"QBRemove":return !!this.widget.isQB&&(!this.widget.isReadOnly);break;case"QBNone":return !!this.widget.isDI;break;case"QBDataType":return this.widget.hasMapped&&this.widget.sptGeo&&this.widget.tp==12;break;default:return true;}},queryChecked:function(U){var R=this.widget;var S=parseInt(U.did,10);if(S>0&&S<=12){return S==R.dtp;}return false;},executeCommand:function(l){var n=this.widget.did;var V=this.dataGrid.model;var h=V.mappings;var c=mstrmojo.array.find(h,"did",n);var Z=this.dataGrid;var S;if(c!=-1){S=mstrmojo.hash.copy(h[c]);}var e={failure:function(m){h[c]=S;Z.populatePreview();}};switch(l.did){case"QBAttribute":if(c!=-1){h[c].alias=h[c].isPA?h[c].alias:I(h[c].alias,h,12);h[c].tp=12;h[c].selected=true;if(h[c].isPA){h[c].ipa=1;}this.dataGrid.populatePreview();if(V.remap){V.remap({did:h[c].did,alias:h[c].alias,ot:12},e);}}break;case"QBMetric":if(c!=-1){h[c].alias=I(h[c].alias,h,4);h[c].tp=4;h[c].selected=true;h[c].dtp=2;this.dataGrid.populatePreview();if(V.remap){V.remap({did:h[c].did,alias:h[c].alias,ot:4},e);}}break;case"QBNone":if(c!=-1){if(V.unimport){V.unimport(n,h[c]);}}break;case"QBRename":var d=h[c].alias;var b=this.widget;var g=b.domNode.parentNode.clientWidth-25;g=(g>0)?(g+"px"):"20px";var W=Q.position(b.domNode).x-Q.position(Z.domNode).x+Z.scrollboxNode.scrollLeft+20+"px";Z.openPopup("inlineTextRef",{top:(Q.isIE?0:-1)+"px",left:W,txtConfig:{value:d||"",width:g,onEnter:function(){var m=M.trim(this.value),p=false;this.parent.close({enter:true});if(m===h[c].alias){return ;}if(V.validateRename){p=V.validateRename(m);}else{p=(m===I(m,h,h[c].tp));}if(p){h[c].alias=m;b.set("text",M.encodeHtmlString(m));V.remap&&V.remap({did:b.did,alias:m},e);}else{var q=mstrmojo.desc(12927,"The name ## has been used by another column. Please give a new name.");mstrmojo.alert(M.encodeHtmlString(q.replace("##",m)),null,V.alertTitle);}}}});break;case"QBEdit":var c=this.widget.ix,k=V.selectedClns[c],o=3;mstrApp.getRootController().openExpressionEditor({type:o,w:k,tkn:k.expr,cIndex:c+1});break;case"QBRemove":var b=this.widget;var f=b.ix+1;if(V.removeSelectedColumn){V.removeSelectedColumn(f);}break;case"QBMap":var Z=this.dataGrid,b=this.widget,Y=Q.position(b.domNode),U=V.mappings[c],R=function X(){var m=new mstrmojo.qb.AttributeMapping({model:V});m.placeholder=document.body.appendChild(document.createElement("div"));m.top=Y.y+22+"px";m.left=Y.x+"px";m.did=b.did;m.target=b;m.open();},j={confirmBtn:{t:mstrmojo.desc(219,"Yes"),fn:function(){R();}},cancelBtn:{t:mstrmojo.desc(218,"No")}};B.toggleClass(b.domNode,"highlight",true);if(U.georole){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),j);}else{if(U.der){mstrmojo.confirm(mstrmojo.desc(11621,"Mapping this column to a project attribute will remove all related derived date/time attributes. Do you want to continue?"),j);}else{R();}}break;case"QBUnMap":if(V.unmap){V.unmap(n,h[c].oid);}break;case"1":case"8":case"9":case"2":case"3":case"4":case"5":case"6":case"7":case"10":case"11":case"12":var b=this.widget;var a=parseInt(l.did,10);if(b.dtp!=a){b.dtp=a;V.mappings[c].dtp=a;V.remap&&V.remap({did:n,bft:a},e);if(a==1||a==8||a==9){b.georole=0;B.removeClass(b.domNode,"geo");!b.ipa&&B.addClass(b.domNode,"time");}else{B.removeClass(this.widget.domNode,"time");}K(b,V.mappings[c],a);}break;case"QBTime":if(c!=-1){var U=V.mappings[c];U.tp=12;U.selected=true;U.der=l.der;Z.populatePreview();}break;case"QBGeo":if(c!=-1){var U=V.mappings[c];U.tp=12;U.selected=true;U.georole=l.georole;U.der=l.der;U.shapeKey=l.shapeKey;Z.populatePreview();}break;default:break;}}};function G(R,Y,U){var S="mstrmojo-di-datapreview-cm",X=mstrmojo.all[S];var Z=R.parent.dataGrid;if(!X){X=mstrmojo.insert(L);X.set("domSrc",Y);X.widget=R;X.dataGrid=Z;X.render();}else{X.widget=R;X.dataGrid=Z;X.set("domSrc",Y);}X._subMenu&&X._subMenu.domNode&&X._subMenu.domNode.parentNode.removeChild(X._subMenu.domNode);X._subMenu=null;if(R.sptGeo&&R.tp!=4&&R.tp!=0&&!R.ipa){var W={},a=true;switch(R.dtp){case 8:W={height:"220px",mode:1};a=false;break;case 9:W={height:"100px",mode:2};a=false;break;case 1:W={height:"260px",mode:3};a=false;break;default:W={georole:R.georole};break;}if(a){var V=Z.model;H[0].items=[{did:"QBGeo",itemWidget:P(R.georole,R.der,R.shapeKey,V.shapeKeys)}];}else{H[0].items=[{did:"QBTime",itemWidget:O(W.mode,W.height,R.der)}];}}else{delete (H[0].items);}X.cm=H;X.showContextMenu();}function D(U){var R={},S;mstrmojo.array.forEach(U,function(V){if(V.tp===12||V.tp===0){S=V.oid;R[S]=(R[S]||0)+1;}});return R;}mstrmojo.qb.QBPreview=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBPreview",resizeColumnBehavior:mstrmojo.RESIZE_ALL_COLUMN_MODE,model:null,visible:false,cssClass:"lockHeader",lockHeader:true,markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},adjustSize:function(W){var V=200,U=this.parent&&this.parent.domNode,Y=V*W;if(!U||!this.scrollboxNode){return ;}this.scrollboxNode.style.overflowX=(Y>U.clientWidth)?"auto":"hidden";this.contentWidth=Math.max(Y,U.clientWidth)+"px";var S=this.contentWidth,X=this.headerContainerNode,R=this.itemsContainerNode;if(S&&X&&R){X.style.width=S;R.style.width=S;}},onheightChange:function C(){var U=this.height,R=this.headerContainerNode,S=this.scrollboxNode;if(U&&R&&S){S.style.height=parseInt(U,10)-R.clientHeight+"px";}},onwidthChange:function F(){if(this.domNode&&this.model&&this.model.mappings){this.domNode.style.width="100%";this.adjustSize(this.model.mappings.length);}},populatePreview:function A(){if(!this.model){return ;}var U=this.model,R=U.mappings,k=U.supportTimeGeo,d=!mstrApp.isCloudPro,b=0,X=this.scrollboxNode;this.columns=[];if(X){b=X.scrollLeft?X.scrollLeft:0;}this.unrender();var n,l,m,g,S,o,Z=D(R);for(var e=0,f=R.length;e<f;e++){n=R[e];m=M.encodeHtmlString(n.alias);m=(Z[n.oid]>1&&n.fmn)?[m,"(",n.fmn,")"].join(""):m;g=n.tp;S=((n.dtp==1)||(n.dtp==8)||(n.dtp==9))&&!n.ipa;o="";if(S){g+=" time";if(n.tp===12){o=E;}}else{if(n.georole){g+=" geo";if(n.tp===12){o=N;}}}l={tag:n,headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-datapreview-header",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-datapreview-headerIcon t"+(n.selected?g:0).toString(),text:m,did:n.did,tp:n.tp,isReadOnly:n.isReadOnly,hasMapped:n.hasMapped,isQB:n.isQB,isDI:n.isDI,sptGeo:k,sptMap:d,mapped:n.selected,ix:n.ix,nochange:n.nochange,ipa:n.ipa,dtp:n.dtp,georole:n.georole,der:n.der,shapeKey:n.shapeKey,multiForms:n.multiForms,isIDForm:n.isIDForm},{scriptClass:"mstrmojo.Widget",cssClass:"menu",alias:"tips",title:o,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" title="{@title}" style="{@cssText}" mstrAttach:click></div>',onclick:function(){var j=this.parent.children[0],p=j.tag;G(j,this.domNode,p);},markupMethods:{ontitleChange:function(){this.domNode.title=this.title;}}}]},colWidth:"60",colCss:"mstrmojo-qb-metric",dataFunction:function(w,p,u){var q=u.columns,j=w[this.dataField],t="mstrmojo-di-datapreview-DataRow-text";if(this.tag.selected){t+={"12":" Attribute","4":" Metric"}[this.tag.tp];}t+=(p%2==1)?" odd":" even";return'<div class="'+t+'">'+j+"</div>";},dataField:e.toString()};this.columns.push(l);}var a=U.dataset;if(a.length==0&&this.columns.length>0){var h=21;var W=parseInt(parseInt(this.parent.height)/h)-1;W=W>0?W:1;var V;for(var e=0;e<W;e++){V=[];for(var c=0,f=this.columns.length;c<f;c++){V.push("");}a.push(V);}}this.items=a;this.render();this.adjustSize(R.length);var Y=this;window.setTimeout(function(){Y.scrollboxNode.scrollLeft=b;},3);},inlineTextRef:{scriptClass:"mstrmojo.Popup",locksHover:true,slot:"headerContainerNode",children:[{scriptClass:"mstrmojo.TextBox",alias:"txt",onblur:function(){this.onEsc();},onEsc:function(){if(this.onCancel){this.onCancel();}this.parent.close({cancel:true});}}],onOpen:function(){var S=this.txt,U=this.txtConfig;if(U){for(var R in U){S.set(R,U[R]);}}S.domNode.style.width=S.width;S.focus();},onClose:function(R){if(!R||(!R.cancel&&!R.enter)){this.txt.onEnter();}this.unrender();}},onvisibleChange:function(R){if(R.value){this.populatePreview();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.InlineEditBox","mstrmojo.Tooltip","mstrmojo.MenuButton","mstrmojo.string","mstrmojo.qb.AttributeMapping","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIInlineEditBox");mstrmojo.requiresDescs(12532,12829,12830,12831);var L="idx",H=mstrmojo.string;var C=mstrmojo.dom;var K=mstrmojo.DI.DIConstants;var F=K.dataTypeMenuItems;var G=mstrmojo.DI.DIHelpers;function J(P){if(!P||!P.data||isNaN(P.data.tp)||!P.data.selected){return ;}var N=P.data;var M=mstrApp.getRootController().model;var O,Q=[];Q=M.findMappingItem(N);for(O=0;O<Q.length;O++){Q[O].selected=false;}mstrApp.getRootController().changeEMMAMappings();}function B(N,O){var P=this;P.menuHelper=mstrApp.getRootController().getMappingMenu(P.data.tableId);P.menuHelper.target=P;P.menuHelper.data=[P.data];P.menuHelper.type=K.contextMenuType.PREVIEW_ITEM_MENU;P.menuHelper.position=C.getMousePosition(N.e,O);var M=P.menuHelper.getMenuConfig();M.hostId=P.id;M.hostElement=this.domNode;M.isHostedWithin=false;M.position=P.menuHelper.position;M.popupHandlers[P.id]={close:function(){this.menuHelper.destroy();}};if(P.scriptClass==="mstrmojo.DI.DIMappingItem"){M.alignment.host=1;M.alignment.popup=4;}P.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:M}));}mstrmojo.DI.DIMappingItem=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIMappingItem",type:"",subtype:"",georole:null,timerole:null,recursive:null,name:"",allowEdit:true,tooltip:"",markupString:'<div id="{@id}" class="mstrmojo-di-mappingitem {@cssClass}" style="{@cssText}" title="{@itemTitle}" mstrAttach:contextmenu><div class="mappingitem-icon mstrmojo-di-datapreview-headerIcon t{@type} {@subtype}" style="{@iconStyle}"></div><div class="mappingitem-text t{@type}" style="{@textStyle}"></div><div class="mappingitem-menu" style="{@menuStyle}"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{iconNode:function(){return this.domNode.children[0];},textNode:function(){return this.domNode.children[1];},menuNode:function(){return this.domNode.children[2];}},useRichTooltip:true,setSubtype:function A(){if(this.recursive){this.subtype="recursive";}else{if(G.isGeo(this)){this.subtype="geo";}else{if(G.isTime(this.data)){this.subtype="time";}}}if(this.parent&&this.parent.parent.hasRelationalTable===null){var M=mstrApp.getRootController().getModel().importSources,N;this.parent.parent.hasRelationalTable=false;this.parent.parent.hierarchyTableIds=[];for(N in M){if(M.hasOwnProperty(N)){if(mstrmojo.array.some(M[N].currentMapping,function(O){return O.recursive&&O.rdcs.length!==0;})){this.parent.parent.hasRelationalTable=true;this.parent.parent.hierarchyTableIds.push(N);}}}}if(this.parent&&this.parent.parent.hasRelationalTable&&!this.data.recursive&&this.parent.parent.hierarchyTableIds.indexOf(this.data.tableId)>=0){this.cssClass+=" donotimport";}},postCreate:function(){if(this._super){this._super();}this.setSubtype();this.itemTitle=0===this.type?mstrmojo.string.decodeHtmlString(this.name,false):"";this.iconStyle=0===this.type?"display:none;":"display:block;";this.textStyle=0===this.type?"display:none;":"display:block;";this.menuStyle=0===this.type?"float:left;":"float:right";},toUnused:function I(){J(this);},rename:function(M){if(M){this.linkObjID=M;}this.text.rename();},onitemOnSave:function(N){var M=mstrApp.getRootController();var P=N.src;var O=P.data;M.mappingController.renameTableItem(this.text,O);this.text.set("text",O.alias);return true;},postBuildRendering:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:H.encodeHtmlString((this.data.ipa?(mstrmojo.desc(13243,"Project Attribute")+": "):"")+this.name)});if(!this._ontooltipover){var M=this.id;this._ontooltipover=function(O){var N=mstrmojo.all[M];if(N.text.textNode.scrollWidth>N.text.textNode.clientWidth){N.showTooltip(O,self);}};this._ontooltipout=function(O){var N=mstrmojo.all[M];N.hideTooltip(O,self);};}C.attachEvent(this.textNode,"mouseover",this._ontooltipover);C.attachEvent(this.textNode,"mouseout",this._ontooltipout);if(this._super){return this._super();}},children:[{slot:"textNode",alias:"text",cssClass:"mstrmojo-di-rename-box mappingitem-text-div",scriptClass:"mstrmojo.DI.DIInlineEditBox",preclick:function E(){if(this.parent.data.selected&&this.parent.data.ipa!==1){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){var M=this.text;this.parent.raiseEvent({name:"itemOnSave",src:this,text:M});},onCancel:function(){this.parent.linkObjID=null;},bindings:{allowEdit:"this.parent.allowEdit",text:"this.parent.name",cssClass:function(){var M="mstrmojo-di-rename-box mappingitem-text-div";if(this.parent.data.ipa){M+=" ipa";}return M;}}},{slot:"textNode",alias:"linkedIcon",iconClass:"mappingitem-linkedIcon",scriptClass:"mstrmojo.Button"},{slot:"menuNode",alias:"menu",scriptClass:"mstrmojo.Button",onclick:function(M){B.call(this.parent,M);}}],oncontextmenu:function D(M,N){C.stopPropogation(self,M.e);if(this.dataGrid&&this.dataGrid.hasContextMenu){B.call(this,M,N);}C.preventDefault(window,M.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DIObjectBrowserDnD","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.DI.FileDragDropBoxDnD","mstrmojo.css");mstrmojo.requiresDescs(12679);mstrmojo.DI.DIDragFiles=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIDragFiles",cssClass:"di-connector-panel",titleWidget:"",children:[{scriptClass:"mstrmojo.VBox",cssClass:"",alias:"mainPage",children:[{scriptClass:"mstrmojo.HBox",cssClass:"",alias:"content",children:[{scriptClass:"mstrmojo.VBox",cssClass:"di-connector-left-panel",alias:"objectListPanel",children:[{scriptClass:"mstrmojo.DI.DIObjectBrowserDnD",cssClass:"di-object-browser",alias:"browser",rootUrl:"",visible:true,populate:function C(J){this.set("fileList",J);},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{canRefresh:"this.parent.parent.parent.parent.canRefresh"}}]},{scriptClass:"mstrmojo.DI.FileDragDropBoxDnD",alias:"urlList",draggable:false,fileUpload:false,dropZone:true,visible:true,text:mstrmojo.desc(12679,"Drag and drop file(s) from left."),cssClass:"di-connector-right-panel",getFilesCnt:function(){return this.urls?this.urls.length:0;},getFileUrl:function(J){if(J<this.urls.length){return this.urls[J];}return"";},getFileUrlDBRole:function(K){var J=null;if(this.dbrs&&K<this.dbrs.length){J=this.dbrs[K];}if(J&&J.did===-1){return null;}return J&&J.did;},onurlsChange:function(){if(this._super){this._super();}var K=mstrApp.getRootController();if(!this.parent.parent.parent.multiSelect){K.sourceSelected(this.urls.length===1);}else{if(this.urls.length>0||this.forceEnable===true){K.sourceSelected(true);}else{K.sourceSelected(false);}}var L=this.domNode.firstChild.children[0];var J=mstrmojo.css;if(this.urls&&this.urls.length>0){J.toggleClass(L,"solid",true);}else{J.toggleClass(L,"solid",false);}this.updateItemsCount(this.getURLCnt());}}]}]}],createTitleWidget:mstrmojo.emptyFn,ondrop:mstrmojo.emptyFn,onNextButtonClick:mstrmojo.emptyFn,browseFunction:mstrmojo.emptyFn,refreshFunction:mstrmojo.emptyFn,editFunction:mstrmojo.emptyFn,supportFolderDrag:true,sourceObjectsInfo:null,autoSelectNode:mstrmojo.emptyFn,canRefresh:false,sizeTooltip:false,folderSizeTooltip:false,multiSelect:true,filterType:[],preBuildRendering:function F(){var L,K,J;if(this._super){this._super();}this.titleWidget=this.createTitleWidget();L=this.mainPage.content;K=L.objectListPanel;J=K.browser;K.addChildren(this.titleWidget,0);L.urlList.set("ondrop",this.ondrop);J.set("browseFunction",this.browseFunction);J.set("refreshFunction",this.refreshFunction);J.set("editFunction",this.editFunction);J.set("supportFolderDrag",this.supportFolderDrag);J.set("sourceObjectsInfo",this.sourceObjectsInfo);J.set("autoSelectNode",this.autoSelectNode);J.set("container",this);J.set("sizeTooltip",this.sizeTooltip);J.set("folderSizeTooltip",this.folderSizeTooltip);J.set("filterType",this.filterType);J.set("dblClickNodeFunction",function(M){if((M.data.isFolder&&this.supportFolderDrag)||!M.data.isFolder){L.urlList.ondrop({src:{data:[M]}});}});},getObjectBrowser:function A(){var L,K,J;L=this.mainPage.content;K=L.objectListPanel;J=K.browser;return J;},getDropZone:function E(){var J=this.mainPage.content;return J.urlList;},getTitleWidget:function G(){return this.titleWidget;},refreshBrowser:function I(){var L,K,J;L=this.mainPage.content;K=L.objectListPanel;J=K.browser;J.clickedNode=this.mainPage.content.objectListPanel.browser.fileTree;J.refreshFunction();},setRootURL:function D(L){var M,K,J;M=this.mainPage.content;K=M.objectListPanel;J=K.browser;J.set("rootUrl",L);},adjustSize:function H(U){var K=parseInt(U.w,10),Q=parseInt(U.layoutH,10),R,L,O=Math.round(K*0.482),S=(!!mstrApp.isWorkstation)?15:0,P=(!!mstrApp.isWorkstation)?47:36,M=(!!mstrApp.isWorkstation&&!!mstrApp.isPopup)?3:0,J=(!!mstrApp.isWorkstation&&!!mstrApp.isPopup)?7:0;this.domNode.style.width=K+"px";R=this.mainPage.content;L=R.objectListPanel;L.domNode.style.width=O+"px";R.urlList.dnDNode.style.width=K-O-31+"px";if(!isNaN(Q)){this.mainPage.content.objectListPanel.domNode.style.height=Q-P+M+"px";this.mainPage.content.objectListPanel.browser.domNode.style.height=Q-16-P+M-10+"px";var N=Q-16-P+M-11;if(N===390){N-=10;}this.mainPage.content.objectListPanel.browser.fileTree.set("height",N+"px");this.mainPage.content.urlList.dnDNode.style.height=Q-38-18-25+S+J+"px";}},changeSize:function B(K){var L=Math.ceil(parseInt(K.size.w,10));var J=Math.ceil(parseInt(K.size.layoutH,10));if(isNaN(L)){return ;}this.mainPage.content.objectListPanel.domNode.style.width=L*0.5+"px";this.mainPage.content.urlList.dnDNode.style.width=(L*0.5-41)+"px";if(!mstrApp.isPopup&&!isNaN(J)){this.mainPage.content.objectListPanel.domNode.style.height=J+"px";this.mainPage.content.objectListPanel.browser.domNode.style.height=J-42+"px";this.mainPage.content.objectListPanel.browser.fileTree.set("height",J-42-11+"px");this.mainPage.content.urlList.dnDNode.style.height=J-41+"px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.Label","mstrmojo.DI.DIHelpers","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.dom","mstrmojo.DI.DIDragFiles");mstrmojo.requiresDescs(12512,12741,16210,12745,13030);function M(Y){Y=Y.toLowerCase();Y=Y.replace(/\s+/g," ");return(Y.indexOf("file://")===0)||(Y.indexOf("ftp://")===0)||(Y.indexOf("http://")===0)||(Y.indexOf("https://")===0)||(Y.indexOf("hdfs://")===0);}function K(Y){var Z={protocolDisabled:false,protocol:""};Y.toLowerCase();Y.replace(/\s+/g," ");return Z;}function E(){var Y=this.model;var Z;if(this.currentSource){Z=this.currentSource;}else{Z=Y.currentSource;}return Z;}var W=mstrmojo.DI.DIConstants;var P=mstrmojo.DI.DIHelpers.extractFileNameFromHadoopURL;var Q=mstrmojo.DI.DIHelpers.extractFileExtensionFromHadoopURL;function V(Y){return !/csv|txt|avro|parquet|parq|orc|json/.test(Y&&Y.toLowerCase());}function X(b,c){if(b.tooltip!=null&&b.tooltip.close){b.tooltip.close();}var a=mstrmojo.array.filter(W.fileTypes,function(e,d){return e.visible!==false;});var Z=b.getDropZone();var Y=[];mstrmojo.array.forEach(Z.urls,function(d){if(Z.isFolder(d)||!/.+\..+/.test(P(d))||V(Q(d))){Y.push(d);}});if(Y.length===0){c();return ;}mstrmojo.insert({scriptClass:"mstrmojo.Dialog",id:"extensionCheck",title:mstrmojo.desc(15146,"Confirm File Type")+'<div class="mstrmojo-Button di-title-btn mstrmojo-di-close"><div class="mstrmojo-Button-text ">&nbsp;</div></div><div class="mstrmojo-Button di-title-btn mstrmojo-di-help"><div class="mstrmojo-Button-text ">&nbsp;</div></div>',btnAlignment:"right",cssClass:"mojo-di-filetype mstrmojo-Dialog  modal",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),postBuildRendering:function(){this.domNode.focus();},onclick:function(d){b.getDropZone().fileTypeMap=this.parent.parent.content.getFileType();mstrmojo.tooltip.close();mstrmojo.all.extensionCheck.destroy();c();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(2140,"Cancel"),onclick:function(d){mstrmojo.tooltip.close();mstrmojo.all.extensionCheck.destroy();}}],children:[{scriptClass:"mstrmojo.Label",cssText:"text-align:left",text:mstrmojo.desc(15137,"Please confirm file types for following files or folders. The files or folder without appropriate types will not be imported.")},{scriptClass:"mstrmojo.Container",alias:"content",markupString:'<div><table class="fileExtensionTable"><thead><tr><th>'+mstrmojo.desc(12545,"Files")+"</th><th>"+mstrmojo.desc(15138,"File Type")+"</th></tr></thead><tbody></tbody></table></div>",markupSlots:{tbody:function(){return this.domNode.firstChild.children[1];}},postBuildRendering:function(){var j="";var g,l,d,e;this.parent.titleNode.querySelector(".di-title-btn.mstrmojo-di-close").onclick=this.parent.buttons[1].onclick;var h=function(m){mstrmojo.array.forEach(a,function(n){var o=document.createElement("option");o.innerHTML=n.n;o.value=n.v||n.n;m.appendChild(o);});return m;};g=document.createElement("tr");var k=(function(n){var o=document.createElement("td");var m=document.createElement("select");m.onchange=function(){mstrmojo.array.forEach(n.tbody.querySelectorAll("select"),function(p){p.value=this.value;},this);};o.appendChild(h(m));return{td:o,select:m};})(this);var f=(function(p,m){var q=document.createElement("td");var o=document.createElement("input");o.type="checkbox";o.checked=true;o.onclick=function(){if(this.checked){m.disabled=false;var u=p.tbody.querySelectorAll("select");for(var t=1;t<u.length;t++){u[t].value=m.value;}}else{m.disabled=true;}};q.appendChild(o);var n=document.createElement("label");n.innerHTML=mstrmojo.desc(15144,"All Files");q.appendChild(n);return{td:q,input:o};})(this,k.select);g.appendChild(f.td);g.appendChild(k.td);this.tbody.appendChild(g);mstrmojo.array.forEach(Y,function(m){g=document.createElement("tr");l=document.createElement("td");e=Z.isFolder(m);l.innerHTML='<img border="0" class="'+(e?"mstrmojo-di-tree-node-icon folder-closed":"mstrmojo-di-tree-node-icon text-doc")+'" src="../images/1ptrans.gif" />'+P(m);g.appendChild(l);l=document.createElement("td");d=document.createElement("select");d.dataset.url=m;d.onchange=(function(n){return function(){if(n.checked){n.checked=false;n.onclick();}};})(f.input);l.appendChild(h(d));g.appendChild(l);this.tbody.appendChild(g);},this);return true;},getFileType:function(){var d=this.tbody.querySelectorAll("select[data-url]");var e={};mstrmojo.array.forEach(d,function(f){e[f.dataset.url]=f.value;});return e;}}],postBuildRendering:function(){this.containerNode.style.borderTop="1px solid #DEDEDE";mstrmojo.Dialog.prototype.postBuildRendering.call(this);}}).render();}function O(c){var e,m=this.getDropZone(),j=this.tableID||null,k=[],h=m.urls;mstrmojo.hash.copy(m.urls,k);var f=mstrApp.getRootController();var d=false;if(j&&h&&h.length>1){var Y=this.model&&this.model.getImportSource(j);if(Y&&Y.sourceInfo&&Y.sourceInfo.url){var g=Y.sourceInfo.partition;if(g&&g.isPartition){d=true;}}if(!d){f.displayError(mstrmojo.desc(12741,"You can upload only one file when refresh a table."));return ;}}var l=true;var b,a;if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}for(e=0;e<k.length;e++){var Z=k[e].trim();k[e]=Z.match(/.+\?hdfsURL=(.+)/);k[e]=k[e]?k[e][1]:Z;if(!M.call(this,Z)){f.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}b=K.call(this,Z);if(b.protocolDisabled){a=mstrmojo.desc(13030,"Unable to fetch data. Importing files using ## has been disabled by the administrator.").replace("##",b.protocol);f.displayError(a,false);return ;}}f.importURLEMMA(m,k,l,!f.model.hasEMMAReportInstance(),this.id,true,c);}function L(Y,b){var a=mstrApp.getRootController().dataService;a.cancelAggFilter({success:function Z(d,e){a.set("messageID",d.msgid);var c=mstrApp.getRootController().model.importSources,f=c&&c[e.params&&e.params.tbid];if(f&&f.sourceInfo){f.sourceInfo.hasAggFilter=0;}b();}},{tbid:Y});}mstrmojo.DI.DIHadoop=mstrmojo.declare(mstrmojo.DI.DIDragFiles,null,{scriptClass:"mstrmojo.DI.DIHadoop",cssClass:"mstrmojo-rootview-hadoop di-connector-panel",supportFolderDrag:true,sizeTooltip:true,folderSizeTooltip:true,controller:null,dbRoleSavedEvt:null,dbRoleLoadedEvt:null,tooltipOpenDelay:0,tooltips:'<div class="tooltip-content"><p>'+mstrmojo.desc(15142,"All files dragged inside need to conform to following filename extensions, including .csv, .txt, .avro, .parquet and .orc. Files without these extensions will need to confirm file types.")+"</p><p>"+mstrmojo.desc(15143,"All files inside a folder will be treated as having one kind of extension; sub-folders inside this folder will not be imported.")+'</p></div><div class="tooltip-close-btn mstrmojo-Button di-title-btn mstrmojo-di-close">&nbsp;</div>',createTitleWidget:function B(){var Y={dbRoleName:"Hadoop Connection",cssClass:"di-hadoop-titleWidget",children:[{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-database"},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title",bindings:{text:"this.parent.dbRoleName"}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-refresh",onclick:function(){var Z=mstrApp.getRootController();Z.hadoopController.loadBDEDBRole();}},{scriptClass:"mstrmojo.Label",text:"(##)".replace("##",mstrmojo.desc(16210,"Change Connection")),cssClass:"di-connector-title-connection",bindings:{visible:function(){return mstrApp.diParams.useDatabaseInstanceManager?true:false;}},onclick:function(){var Z=mstrApp.getRootController(),a=Z.hadoopController.dbRole;Z.hadoopController.renderDBRoleEditor(a);}}]};return new mstrmojo.Box(Y);},ondrop:function U(Z){if(!this.droppable){return ;}var e=Z.src.data,c,a,Y=mstrApp.getRootController(),b=this.urls;if(Y.model.isDirectDataAccess&&(Y.model.operationMode!==W.operationMode.edit)&&(b.length+e.length)>1){var d=mstrmojo.desc(12745,"Live mode Cube with multiple files or folders from HDFS is not supported yet. Please keep only one file or folder and remove others.");Y.displayError(d,false);return ;}if(this.parent.parent.parent.refreshMode){mstrmojo.array.forEach(this.children,function(f){this.removeURL(f.url);},this);c=e[0];if(c){this.addURL(c.data.address,c.text,c.data.isFolder);}}else{for(a=0;a<e.length;a++){c=e[a];this.addURL(c.data.address,c.text,c.data.isFolder);}}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function D(Y){return mstrApp.getRootController().hadoopController.hadoopBrowserFunction(Y);},refreshFunction:function I(){mstrApp.getRootController().hadoopController.browseHadoop(this.rootUrl,this);},preBuildRendering:function C(){var a,Z,Y;if(this._super){this._super();}this.controller=mstrApp.getRootController();this.controller.hadoopController.loadBDEDBRole(this.tableID);a=this.mainPage.content;Z=a.objectListPanel;Y=Z.browser;a.urlList.set("ondrop",this.ondrop);Y.set("browseFunction",this.browseFunction);Y.set("refreshFunction",this.refreshFunction);Y.set("editFunction",this.editFunction);Y.set("supportFolderDrag",this.supportFolderDrag);Y.set("sourceObjectsInfo",this.sourceObjectsInfo);Y.set("autoSelectNode",this.autoSelectNode);Y.set("container",this);Y.set("sizeTooltip",this.sizeTooltip);Y.set("folderSizeTooltip",this.folderSizeTooltip);Y.set("filterType",this.filterType);Y.set("dblClickNodeFunction",function(b){if((b.data.isFolder&&this.supportFolderDrag)||!b.data.isFolder){a.urlList.ondrop({src:{data:[b]}});}});},postBuildRendering:function S(){if(this._super){this._super();}var Y=(function(a){var Z=document.createElement("label");Z.innerHTML='<div class="mstrmojo-Label mstrmojo-Search-infoIcon mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-infoIcon" style="display: inline-block;cursor:pointer;"></div>'+mstrmojo.desc(15145,"File Type Rules");Z.style.cursor="pointer";a.tooltip=new mstrmojo.Tooltip({updateScrollbars:function(){mstrmojo.Tooltip.prototype.updateScrollbars.call(this);var b=this.contentNode.querySelector(".tooltip-close-btn");b.id=Math.random();b.onclick=function(){a.tooltip.close();};}});Z.onclick=function(b){if(a.tooltip.visible){a.tooltip.close();}else{a.tooltip.open({richTooltip:{cssClass:"vi-regular vi-tooltip-V mojo-theme-light fileTypeTooltip",content:a.tooltips,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,refNode:this,top:-10,left:-10}},{e:b});a.tooltip.domNode.style.zIndex=a.controller.dialogController.getNextZIndex();a.tooltip.visible=true;}};return Z;})(this);this.mainPage.content.urlList.domNode.appendChild(Y);if(this.dbRoleSavedEvt){this.model.detachEventListener(this.dbRoleSavedEvt);}if(this.dbRoleLoadedEvt){this.model.detachEventListener(this.dbRoleLoadedEvt);}this.dbRoleSavedEvt=this.model.attachEventListener("HadoopDBRoleSaved",this.id,this.handleDBRoleSaved);this.dbRoleLoadedEvt=this.model.attachEventListener("BDEDBRoleLoaded",this.id,this.handleDBRoleLoaded);this.model.attachEventListener("windowSizeChanged",this.id,this.changeSize);this.controller.sourceSelected(false);if(window.localStorage){if(window.localStorage.getItem(W.localStorageKey.HGOSFileTypeTooltipPop)==null){window.localStorage.setItem(W.localStorageKey.HGOSFileTypeTooltipPop,new Date().getTime());setTimeout(function(){Y.onclick();},500);}}this.resizeHandler=function(){if(Z){clearTimeout(Z);}var Z=setTimeout(function(){Y.onclick();Y.onclick();},500);};mstrmojo.dom.attachEvent(window,"resize",this.resizeHandler,true);},handleDBRoleSaved:function H(){var Y=mstrApp.getRootController();Y.hadoopController.loadBDEDBRole();},handleDBRoleLoaded:function N(){if(this.controller.rootView.currentPage.id!==this.id){return ;}var Y=this.controller.hadoopController;var b=Y.dbRoleID;if(b){var Z=Y.hadoopConnURL;this.setRootURL(Z);this.refreshBrowser();this.setFilesForRefreshData();var a=this.getTitleWidget();a.set("dbRoleName",Y.dbRole.n);}else{Y.renderDBRoleEditor();}},setFilesForRefreshData:function G(){var a=this.tableID;var b=this.model&&this.model.getImportSource(a);if(b&&b.sourceInfo&&b.sourceInfo.url){var c=b.sourceInfo.url;var Y=b.sourceInfo.partition;var d=this.getDropZone();if(Y&&Y.isPartition){var Z;for(Z=0;Z<Y.tables.length;Z++){d.addURL(Y.tables[Z].name,P(Y.tables[Z].name),false);}}else{d.addURL(c,P(b.sourceInfo.dbTableName),false,c);}}},onHelpButtonClick:function R(){return"importing_data_from_a_Hadoop_file_browser.htm";},onNextButtonClick:function J(){X(this,(function(Y){return function(){var Z=mstrApp.getRootController().getModel(),a=Z.importSources[Y.tableID],b=Y.tableID?W.actions.refreshData:W.actions.importSource;if(Y.tableID&&a.sourceInfo&&a.sourceInfo.hasAggFilter){mstrmojo.confirm(mstrmojo.desc(12720,"Previous changes made in aggregation will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){L(Y.tableID,function(){O.call(Y,b);});}}});}else{O.call(Y,b);}};})(this));},onFinishButtonClick:function(){X(this,(function(Y){return function(){O.call(Y,W.actions.savePublish);};})(this));},onBackButtonClick:function A(){if(this.tooltip!=null&&this.tooltip.close){this.tooltip.close();}this.controller.showPage(W.pageType.dataSelection);},setFilesObject:function F(Z){var Y=this.getDropZone();Y.setURLsObject(Z);},destroy:function(Y){if(this.tooltip!=null&&this.tooltip.close){this.tooltip.close();}mstrmojo.Container.prototype.destroy.call(this,Y);mstrmojo.dom.detachEvent(window,"resize",this.resizeHandler,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Widget","mstrmojo.DI.DIDragFiles","mstrmojo.DI.DIProjectsMenu");mstrmojo.requiresDescs(12783,13091,13092,13093,13094,13095);var M=mstrmojo.array,H=mstrmojo.dom,E,F,G;mstrmojo.DI.DIRemoteProjects=mstrmojo.declare(mstrmojo.DI.DIDragFiles,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIHadoop",supportFolderDrag:false,sizeTooltip:false,createTitleWidget:function B(){var V={dbRoleName:mstrmojo.desc(13091,"Choose a connection"),children:[{scriptClass:"mstrmojo.Label",cssClass:"di-connector-projects-title",bindings:{text:"this.parent.dbRoleName"}},{scriptClass:"mstrmojo.Pulldown",alias:"dbRoleList",popupToBody:true,itemField:"dbrn",itemIdField:"dbrid",defaultText:mstrmojo.desc(13092,"Select a MicroStrategy Project"),bindings:{popupZIndex:"this.parent.parent.zIndex"},onvalueChange:function(){var X=this,W=X.selectedIndex;E=X.items[W].dbrn;F=X.items[W].dbrid;G.projectController.getProjectSourceFolderId(F);}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-menu-connection",onclick:function(X){if(!F){return ;}var Y=this.menuHelper;if(!Y){Y=new mstrmojo.DI.DIProjectsMenu();}Y.data=F;var W=Y.getMenuConfig();W.hostId=this.parent.parent.parent.parent.parent.id;W.hostElement=X.target||H.eventTarget(X.hWin,X.e);W.position=H.position(W.hostElement,true);W.isHostedWithin=false;W.hostProxyCssClass="item-mn-proxy";this.parent.parent.parent.parent.parent.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:W}));}},{scriptClass:"mstrmojo.Label",cssClass:"di-connector-title-add-connection",onclick:function(){G.projectController.renderDBRoleEditor();}}]};return new mstrmojo.HBox(V);},ondrop:function S(W){if(!this.droppable){return ;}var b=W.src.data,Z,X,V=mstrApp.getRootController(),Y=this.urls;if(V.model.isDirectDataAccess&&(Y.length+b.length)>1){var a=mstrmojo.desc(13093,"A dataset can have only a single MicroStrategy Cube. Please create another dataset to import the second MicroStrategy cube.");V.displayError(a,false);return ;}for(X=0;X<b.length;X++){Z=b[X];this.addURL(Z.data.address,Z.text,Z.data.isFolder);}},filterType:["folder","emmaCube"],browseFunction:function D(V){return mstrApp.getRootController().projectSourceBrowserFunction(V.data.browser,V.data.address,F);},refreshFunction:function K(V){if(!V){this.getObjectBrowser().set("fileList",[]);return ;}this.getObjectBrowser().clickedNode=this.mainPage.content.objectListPanel.browser.fileTree;return mstrApp.getRootController().projectSourceBrowserFunction(this.getObjectBrowser(),V,F);},preBuildRendering:function C(){if(this._super){this._super();}this.model.attachEventListener("projectsDBRoleLoaded",this.id,this.projectsDBRoleLoaded);this.model.attachEventListener("getFolderId",this.id,this.projectsFolderIdLoaded);this.model.attachEventListener("DBRoleLoadedById",this.id,this.projectDBRoleLoadedById);this.model.attachEventListener("projectDBRoleSaved",this.id,this.handleDBRoleSaved);this.model.attachEventListener("deleteDBRole",this.id,this.deleteDBRole);this.model.attachEventListener("DuplicateDBRole",this.id,this.duplicateDBRole);this.model.attachEventListener("getFolderIdFailure",this.id,this.getFolderIdFailure);this.getDropZone().set("text",mstrmojo.desc(13094,"Drag and Drop a Cube"));G=mstrApp.getRootController();G.projectController.loadRemoteProjectsDBRole();G.model.isDirectDataAccess=true;var V={success:function(W){if(W&&W.msgid){G.dataService.set("messageID",W.msgid);G.model.resetImportSource();}mstrApp.hideProgress();},failure:function(W){G.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,W.message||"");}};G.createNewReportInstance(V);},getFolderIdFailure:function O(){this.refreshFunction();},deleteDBRole:function L(){var X=this.getTitleWidget(),W=X.dbRoleList.items;var V=M.find(W,"dbrid",F);if(V!==-1){W.splice(V,1);X.dbRoleList.set("items",W);X.dbRoleList.set("selectedIndex",-1);X.dbRoleList.set("text",mstrmojo.desc(13092,"Select a MicroStrategy Project"));F="";this.refreshFunction();}else{this.set("defaultSelection",V);}},duplicateDBRole:function R(){G.projectController.duplicate();},handleDBRoleSaved:function I(W){var Z=this.getTitleWidget(),X=Z.dbRoleList.items,Y=W.data;var V=M.find(X,"dbrid",Y.dbrid);if(V===-1){X.push(Y);Z.dbRoleList.set("items",X);Z.dbRoleList.set("defaultSelection",X.length-1);Z.dbRoleList.set("text",X[X.length-1].dbrn);Z.dbRoleList.set("selectedIndex",X.length-1);F=Y.dbrid;}else{this.set("defaultSelection",V);}G.projectController.getProjectSourceFolderId(F);},projectsFolderIdLoaded:function J(W){var V=W.data.fid;this.refreshFunction(V);},projectDBRoleLoadedById:function P(){var W=mstrApp.getRootController().projectController;var V=W.dbRole;W.renderDBRoleEditor(V);},projectsDBRoleLoaded:function N(W){var X=W.data;if(X){var Y=this.getTitleWidget(),Z=G.projectController.dbRoleID;Y.dbRoleList.set("items",X);if(Z){var V=M.find(X,"dbrid",Z);Y.dbRoleList.set("text",X[V].dbrn);Y.dbRoleList.set("selectedIndex",V);F=Z;G.projectController.getProjectSourceFolderId(Z);}else{Y.dbRoleList.set("selectedIndex",-1);Y.dbRoleList.set("text",mstrmojo.desc(13092,"Select a MicroStrategy Project"));F="";this.refreshFunction();}}},onHelpButtonClick:function Q(){return"importing_a_microstrategy_file.htm";},onFinishButtonClick:function U(){var V=this.getDropZone(),X=[];mstrmojo.hash.copy(V.urls,X);var W={success:function(){G.getImportController().importProjects({success:function(){G.saveAndPublish();},failure:function(Y){G.displayError(mstrmojo.desc(13095,"Error in importing the cube. Please check the cube being imported."),false,Y.message);}},F,X[0]);},failure:function(Y){G.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,Y.message||"");}};G.duplicateSelectedDataset(W);},onBackButtonClick:function A(){var V=mstrApp.getRootController();V.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIModel","mstrmojo.DI.DIDragFiles");mstrmojo.requiresDescs(8338,12741,16136);var D=mstrmojo.DI.DIHelpers.isOperationMode,J=mstrmojo.DI.DIConstants,F=mstrmojo.array,E=mstrmojo.dom,I=mstrmojo.DI.DIHelpers,G=mstrmojo.css;function B(L,M){return L+"###path:"+M;}function K(){var O=mstrApp.getRootController(),L=this.getDropZone(),S=L.urls,M=[],R=null,N=null,Q=this.tableID||null,P;if(Q&&S&&S.length>1){O.displayError(mstrmojo.desc(12741,"You can upload only one file when refresh a table."));return ;}for(P=0;S&&P<S.length;P++){R=S[P];N={n:R.n,desc:R.desc,query:B(R.address,(R.folderPath===undefined?"":R.folderPath)+"/"+R.n),type:R.type};if(!mstrApp.isSingleTier){N.data=R;}M.push(N);}return M;}function C(O){var L=K.call(this),N=this.tableID||null,M=mstrApp.getRootController();if(!N){M.importMultiOAuthReports(this.sourceObjectsInfo.type,L,true,!M.model.hasEMMAReportInstance(),O,this.sourceObjectsInfo.subtype,this.id);}else{M.refreshDataOAuthReport(this.sourceObjectsInfo.type,this.sourceObjectsInfo.subtype,N,L[0],O);}}mstrmojo.DI.DISourceObjectsDnD=mstrmojo.declare(mstrmojo.DI.DIDragFiles,null,{scriptClass:"mstrmojo.DI.DISourceObjectsDnD",cssClass:"mstrmojo-DISourceObjectsDnD",supportFolderDrag:false,canRefresh:true,userDisplayName:null,sizeTooltip:true,createTitleWidget:function(){var N=this,M=this.sourceObjectsInfo.type;var L={cssClass:"DISourceObjectsDnd-titleWidget cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"userInfo",postBuildRendering:function(){mstrmojo.Widget.prototype.postBuildRendering.call(this);this.update();N.model.externalSources[N.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.update);},update:function(){var O=N.model.externalSources[N.sourceObjectsInfo.type],P=O&&O.userDisplayName;if(!O){return ;}if(O.userEmail){P+=" ("+O.userEmail+")";}this.set("text",P);},useRichTooltip:true,updateTooltipConfig:function(){var Q=this.domNode,R=E.position(Q),P=Q.offsetWidth/2,O=-45;this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(R.y+O,0),left:Math.max(R.x+P,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.text});}},{scriptClass:"mstrmojo.Button",cssClass:"refresh",onclick:function(){var P=N.model.externalSources[N.sourceObjectsInfo.type],O=N.getObjectBrowser();mstrApp.getRootController().getOAuthSourceReports(M,false,null,null,{success:function(Q){O.clickedNode=O.fileTree;P.populateReports(Q,true);}});},useRichTooltip:true,updateTooltipConfig:function(){var Q=E.position(this.domNode),O=-45,P=10;this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(Q.y+O,0),left:Math.max(Q.x+P,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:mstrmojo.desc(773,"Refresh")});}},{scriptClass:"mstrmojo.Label",cssClass:"signOut",text:mstrmojo.desc(8338,"Sign Out"),onclick:function(){mstrApp.getRootController().oAuthSignOut(M);}}]};return new mstrmojo.Box(L);},ondrop:function(L){var Q=L.src.data,N=0,M,O=this.parent.parent.parent.sourceObjectsInfo.type,P;for(N=0;Q&&N<Q.length;N++){P=Q[N].data;switch(O){case J.sourceType.salesforce:M="/"+(P.folderPath?P.folderPath+"/":"")+P.n;break;default:M=P.address;break;}this.addURL(P,P.n,undefined,M);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function(L){return mstrApp.getRootController().oAuthSourceBrowserFunction(this.sourceObjectsInfo.type,L);},autoSelectNode:function(N,O,L){var M=this.container;if(N.data.isFolder){N.data.browser.clickedNode=N;mstrApp.getRootController().oAuthSourceBrowserFunction(this.sourceObjectsInfo.type,N,O,L);}else{M.getDropZone().addURL(N.data,N.data.n);N.selectThisNode();mstrApp.getRootController().sourceSelected(true);}},postBuildRendering:function(){if(this._super){this._super();}this.model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);this.model.attachEventListener("windowSizeChanged",this.id,this.changeSize);},changeSize:function(N){if(I.isServerBasedWS()){var Q=this.getDropZone(),M=this.getObjectBrowser(),P=parseInt(G.getStyleValue(M.domNode,"width"),10),O=parseInt(N.size.w,10),L=parseInt(N.size.layoutH,10);if(isNaN(O)||isNaN(L)||isNaN(P)){return ;}Q.dnDNode.style.height=(L-20)+"px";Q.dnDNode.style.width=(O-P-60)+"px";}else{this._super&&this._super(N);}},populate:function(S){var d=this.model.externalSources[this.sourceObjectsInfo.type].reports;if(d.mi&&!d.mi.ftree&&d.mi.errc&&d.mi.errc===J.backendError.AuthenticationError){mstrApp.getRootController().displayError(mstrmojo.desc(16136,"You don't have privilege to view the project. Please contact your administrator."));return ;}var a=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,d),M=this.model.operationMode,Q=J.sourceType,R=this.getDropZone(),b=this.getObjectBrowser(),U,N,P,L,c,V,Z,O,X,Y,W;if(S&&S.targetPageId){if(S.targetPageId!==this.id){return ;}}b.set("fileList",a);if(S&&S.isRefresh){return ;}if(D(this.operationMode)){M=this.operationMode;}if(M===J.operationMode.refresh||M===J.operationMode.edit){V=null;if(this.tableID){V=this.model.getImportSource(this.tableID);}if(this.currentSource){V=this.currentSource;}if(V){this.set("multiSelect",false);if(this.sourceObjectsInfo.type===Q.salesforce){if(V&&V.sourceInfo&&V.sourceInfo.url){U=V.sourceInfo.url;N=U.substr(0,U.indexOf("###"));U=U.substr(U.indexOf("###")+"###path:".length);if(U.indexOf("undefined/")===0){U=U.substr("undefined/".length-1);}c=U.substr(U.lastIndexOf("/")+1);Z=b.fileTree.items;for(Y=0;Y<Z.length;Y++){O=Z[Y].items;for(W=0;W<O.length;W++){X=O[W];if(X.n===c&&X.address===N){Z[Y].node.set("state",1);R.addURL(X.node.data,X.node.data.n);X.node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===Q.dropbox){if(V&&V.sourceInfo&&V.sourceInfo.url){O=Z=b.fileTree.items;U=V.sourceInfo.url;U=I.spliceUrlBySeparator(U);U=U.substr("path:".length);if(U.indexOf("undefined/")===0){U=U.substr("undefined/".length-1);}P=U.indexOf("/",1);if(P!==-1){L=U.substring(1,P);for(Y=0;Y<Z.length;Y++){if(Z[Y].isFolder===true&&Z[Y].n===L){b.autoSelectNode(Z[Y].node,U.substring(P));Z[Y].fetched=true;Z[Y].node.set("state",1);}}}else{c=U.substring(1);for(Y=0;Y<O.length;Y++){if(O[Y].isFolder!==true&&O[Y].n===c){R.addURL(O[Y].node.data,O[Y].node.data.n);O[Y].node.selectThisNode();}}}}}if(this.sourceObjectsInfo.type===Q.googleDrive){if(V&&V.sourceInfo&&V.sourceInfo.url){O=Z=b.fileTree.items;U=V.sourceInfo.url;N=U.substr(0,U.indexOf("###"));U=U.substr(U.indexOf("###")+"###path:".length);P=U.indexOf("/",1);while(P!==-1){L=U.substring(1,P);for(Y=0;Y<Z.length;Y++){if(Z[Y].isFolder===true&&Z[Y].n===L){b.autoSelectNode(Z[Y].node,U.substring(P),N);Z[Y].fetched=true;Z[Y].node.set("state",1);}}U=U.substr(P);P=U.indexOf("/",1);}c=U.substring(1);for(Y=0;Y<O.length;Y++){if(O[Y].isFolder!==true&&O[Y].n===c&&O[Y].address===N){R.addURL(O[Y].node.data,O[Y].node.data.n);O[Y].node.selectThisNode();}}}}}}},asDataPrepare:function(){return K.call(this);},onHelpButtonClick:function A(){var M=this.sourceObjectsInfo.type,L;switch(M){case J.sourceType.dropbox:L="Importing_data_from_a_Dropbox_file.htm";break;case J.sourceType.salesforce:L="Importing_data_from_a_salesforce_report.htm";break;case J.sourceType.googleDrive:L="Importing_data_from_a_file_stored_on_Google_Drive.htm";break;}return L;},onNextButtonClick:function(){C.call(this,this.tableID?J.actions.refreshData:J.actions.importSource);},onFinishButtonClick:function(){C.call(this,J.actions.savePublish);},onBackButtonClick:function H(){var L=mstrApp.getRootController();L.showPage(J.pageType.dataSelection);},handleImportError:function(N,M,O){var L=this.getDropZone();L.set("forceEnable",!O);F.forEach(N,function(Q,P){if(M[P].success===true){L.removeURL(Q.data);}});return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DataGrid","mstrmojo.DI.DIConstants","mstrmojo.CheckBox","mstrmojo.Container","mstrmojo._HasOwnAvatar","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.HBox","mstrmojo.Label","mstrmojo.ui.SearchBox","mstrmojo.DI.DIMappingItem","mstrmojo.DI.DIAllObjectsMappingMenu");mstrmojo.requiresDescs(191,192,962,2461,3581,7755,11611,11805,12665,12666,14029);var R=mstrmojo.dom,B=mstrmojo.css,l=mstrmojo.array,W=mstrmojo.hash,q=mstrmojo.DI.DIConstants,z="ConvertAttributeToMetric",G="ConvertMetricToAttribute",f=0,J=null,AB={ALL:"select-all",NON:"unselect-all",PART:"select-some"},AD={Attribute:"amps",Metric:"mtmps"},w=[3,11];function O(AH,AG){var AJ=AH.findMappingSource(AG);var AK=[];l.forEach(AJ,function AI(AL){AK.push(AL.sourceInfo.name);});return AK;}function h(AI){var AM=mstrApp.getRootController().allObjectsController.getAllMappings();if(!AM||!AM.length){return null;}var AK=l.filter(AM,function AJ(AN){return AN.type===AI;});var AH,AL;var AG=[];for(AH=0;AH<AK.length;AH++){AL=AK[AH];AG.push({n:AL.alias,tp:AL.tp,col:AL,idx:AH,isLinked:AL.isLinked});}return AG;}function AE(){if(!J){J=new mstrmojo.DI.DIAllObjectsMappingMenu();}return J;}function S(AG){return AG===AD.Attribute?1:0;}function AA(AH){var AG=l.indexOf(w,AH);return AG===-1?false:true;}function L(AG,AH){if(AH){this.set("state",AB.NON);}else{if(AG){this.set("state",AB.ALL);}else{this.set("state",AB.PART);}}}function M(AK,AL){var AO=AK.cubeConfig.sidxes;var AN=0,AM=AO.length;var AJ,AI,AH;for(AJ=0;AJ<AL.length;AJ++){if(AN===AM){break;}var AG=AL[AJ].col;if(!AG.isMultiForm){AG.indexOn=false;}for(AI=0;AI<AO.length;AI++){if(AG.id===AO[AI].atid){if(!AG.isMultiForm){AG.indexOn=true;AN++;break;}else{for(AH=0;AH<AG.subColumns.length;AH++){if(AG.subColumns[AH].fmid===AO[AI].afid){AG.subColumns[AH].indexOn=true;AN++;break;}}}}}}}function C(AG){this.data=AG;this.type=AG.tp;this.name=AG.alias;this.tooltip=AG.alias;this.georole=AG.georole;this.timerole=AG.timerole;this.recursive=AG.recursive;if(AG.isLinked){this.cssClass+=" linked";}this.setSubtype();}function F(AI){var AG=this;var AH={headerWidget:{scriptClass:"mstrmojo.DI.HeaderWidget",text:(this.type==="amps"?mstrmojo.desc(3581,"Attributes"):mstrmojo.desc(962,"Metrics")),menuController:AG,field:"n",cm:[{n:mstrmojo.desc(191,"Sort Ascending"),did:"ASC"},{n:mstrmojo.desc(192,"Sort Descending"),did:"DES"}]},colWidth:AI,dataWidgetBuilder:function(AO){var AJ=null;if(AO.col.isMultiForm){var AK=AO.col.subColumns;AJ={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute cf",at:AO.col,children:[{scriptClass:"mstrmojo.Button",cssClass:"mfa-status-button",onclick:function AL(){this.parent.toggleState();}},{scriptClass:"mstrmojo.DI.DIMappingItem",allowEdit:false,oncontextmenu:mstrmojo.emptyFn,postCreate:function(){var AP=this.parent.at;C.call(this,AP);}},{scriptClass:"mstrmojo.ui.List",cssClass:"attribute-forms-list",items:AK,getItemDisplayName:function AM(AQ){var AP=AQ.alias.replace(q.workstation.filerBreakLine," ");return AP+"@"+AQ.fmn;},oncontextmenu:function(AQ){R.preventDefault(window,AQ.e);this.onclick(AQ);var AU=R.eventTarget(AQ.hWin,AQ.e);var AS=AE();var AT=[this.selectedItem];AS.target=this;AS.data=AT;AS.type=q.contextMenuType.ITEM_MENU;AS.position=R.position(this.domNode);var AP=AS.getMenuConfig(),AR=this.parent.dataGrid;AP.hostId=AR.id;AP.hostElement=AU;AP.isHostedWithin=false;if(AP.menus&&AP.menus.length>0){AR.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AP}));}},onchange:function AN(){this.parent.dataGrid.hightlightAttFormList=this;}}],onclick:function AL(AQ){var AR=AQ.target||R.eventTarget(AQ.hWin,AQ.e);var AP=R.findWidget(AR);if(AP===this){this.collapse=!this.collapse;this.toggleState();}},toggleState:function(){this.collapse=!this.collapse;var AP=this.domNode.parentNode.parentNode;B.toggleClass(AP,"collapse",this.collapse);}};}else{AJ={scriptClass:"mstrmojo.DI.DIMappingItem",cssClass:"sfa",allowEdit:false,oncontextmenu:mstrmojo.emptyFn,postCreate:function(){var AP=this.parent.data.col;C.call(this,AP);}};}return AJ;}};return AH;}function N(AH){var AG={headerText:mstrmojo.desc(7755,"Table"),colWidth:AH,dataWidgetBuilder:function(AM){var AN=null,AL=mstrApp.getRootController().model,AQ,AO=mstrApp.getRootController().allObjectsController.getAllImportSources();var AI=W.keyarray(AO).length;if(AO.length===0){return ;}if(AM.col.isMultiForm){AN={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute-src-box",children:[{scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label"},{scriptClass:"mstrmojo.Box",cssClass:"attribute-forms-src-list",alias:"srcTableCount",children:[]}]};var AK,AR=AM.col.subColumns,AP=AN.children[0],AJ=AN.children[1];for(AK=0;AK<AR.length;AK++){AQ=O(AL,AR[AK]);AJ.children.push({scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label",text:AQ.length+"/"+AI,src:AQ,total:AI});if(AR[AK].isIdForm){AP.text=AQ.length+"/"+AI;AP.src=AQ;AP.total=AI;}}}else{AQ=O(AL,AM.col);AN={scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",cssClass:"attribute-form-label",text:AQ.length+"/"+AI,src:AQ,total:AI};}return AN;}};return AG;}function Q(AI){var AH=this;var AG={colWidth:AI,headerCss:"mstrmojo-di-samplefiles-col1header",headerWidget:{scriptClass:"mstrmojo.ImageCheckBox",label:mstrmojo.desc(12665,"Search Index"),state:AB.NON,enabled:false,onclick:function(){if(this.state===AB.ALL){this.set("state",AB.NON);this.dataGrid.initSearchIndex(false);}else{this.set("state",AB.ALL);this.dataGrid.initSearchIndex(true);}AH.raiseEvent({name:"searchIndexChange"});},onstateChange:function(){B.removeClass(this.inputNode,[AB.ALL,AB.NON,AB.PART]);B.addClass(this.inputNode,this.state);},updateState:function(){var AJ=this.dataGrid;var AQ=AJ.items;var AL=AQ.length;var AN,AR=true,AO=true,AK,AP=0;for(AN=0;AN<AL;AN++){var AM=AJ.getCellWidget(AN,f);if(AM){AK=AQ[AN].col.isMultiForm?AM.mfaIndexControl.state:AM.checked;if(AK===AB.ALL||AK===true){AO=false;}else{if(AK===AB.PART){AO=false;AR=false;}else{AR=false;}}AP=true;}}L.call(this,AR,AO);this.set("enabled",AP>0);}},dataWidgetBuilder:function(AP){var AS=null;if(AP.col.isMultiForm){AS={scriptClass:"mstrmojo.Box",cssClass:"multiform-attribute-index-box",at:null,children:[{scriptClass:"mstrmojo.ImageCheckBox",markupString:'<span id="{@id}" class="mstrmojo-CheckBox mstrmojo-ImageCheckBox {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input" class="{@cssClass}" type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',alias:"mfaIndexControl",bindings:{checked:"this.parent.data.col.indexOn"},state:AB.NON,getHeaderCheckBox:function(){return this.parent.dataGrid._headerWidgets_[f];},oncheckedChange:function AR(AV){this.parent.data.col.indexOn=AV.value;this.parent.dataGrid._headerWidgets[f].enabled=true;},onstateChange:function(){B.removeClass(this.inputNode,[AB.ALL,AB.NON,AB.PART]);B.addClass(this.inputNode,this.state);var AV=this.getHeaderCheckBox();AV.updateState();},onclick:function AT(){if(this.state===AB.ALL){this.set("state",AB.NON);this.set("checked",false);}else{this.set("state",AB.ALL);this.set("checked",true);}var AW=this.parent.formsList.children,AX=this.checked;l.forEach(AW,function AV(AY){if(AY.enabled){AY.set("checked",AX);}});AH.raiseEvent({name:"searchIndexChange"});},updateByForms:function AO(){var AX=this.parent.formsList.children,AY=false,AW=true,AZ=true;l.forEach(AX,function AV(Aa){if(Aa.enabled){if(Aa.checked){AY=true;AZ=false;}else{AW=false;}}});L.call(this,AW,AZ);this.set("checked",AY);}},{scriptClass:"mstrmojo.Box",cssClass:"attribute-forms-index-list",alias:"formsList",children:[]}]};var AL,AK=AS.children[1],AU=AP.col.subColumns,AN=false,AM=true,AQ=true,AJ;for(AL=0;AL<AU.length;AL++){AK.children.push({scriptClass:"mstrmojo.ImageCheckBox",checked:AU[AL].indexOn,afidx:AL,enabled:true,oncheckedChange:function AR(AV){AP.col.subColumns[this.afidx].indexOn=AV.value;},onclick:function AT(){this.parent.parent.mfaIndexControl.updateByForms();AH.raiseEvent({name:"searchIndexChange"});}});if(!AA(AU[AL].dtp)){AK.children[AL].cssText="visibility:hidden;";AK.children[AL].enabled=false;}else{AN=true;if(AU[AL].indexOn){AQ=false;}else{AM=false;}}}if(AQ){AJ=AB.NON;}else{if(AM){AJ=AB.ALL;}else{AJ=AB.PART;}}AS.children[0].state=AJ;AS.children[0].cssClass=AJ;if(!AN){AS.cssText="visibility:hidden;";AS.children[0].enabled=false;}}else{if(AA(AP.col.dtp)){AS={scriptClass:"mstrmojo.ImageCheckBox",bindings:{checked:"this.parent.data.col.indexOn"},getHeaderCheckBox:function(){return this.dataGrid._headerWidgets_&&this.dataGrid._headerWidgets_[f];},oncheckedChange:function AR(AV){this.parent.data.col.indexOn=AV.value;this.dataGrid._headerWidgets[f].enabled=true;},onclick:function(){var AV=this.getHeaderCheckBox();AV.updateState();AH.raiseEvent({name:"searchIndexChange"});}};}}return AS;},dataFunction:function(){return"";}};return AG;}function b(AG){return AG===AD.Attribute&&mstrApp.getRootController().allObjectsController.isCubeConfigEnabled();}mstrmojo.DI.DIAllObjectsGrid=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo._HasOwnAvatar,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",type:null,resizableColumns:false,lockHeader:true,multiSelect:true,selectionPolicy:"reselect",clickedItem:null,draggable:true,dropZone:true,allItems:null,sortFlag:true,renderOnScroll:false,hierarchyTableIds:[],hasRelationalTable:null,markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',isDragValid:function d(){return true;},allowDrop:function E(AG){var AH=false;if(AG.action===z&&this.type===AD.Metric){AH=true;}else{if(AG.action===G&&this.type===AD.Attribute){AH=true;}}return AH;},createAvatar:function e(AK){var AM=S(this.type);var AG=document.createElement("div");var AO=R.findAncestorByName(AK,"tr",true,this.domNode);if(AO){var AI=this.sortSelectedIndices(),AJ=this.domNode.getElementsByTagName("tr"),AN,AH;l.forEach(AI,function(AP){AN=1+parseInt(AP,10);AH=AJ[AN];AG.appendChild(AH.children[AM].firstChild.cloneNode(true));});}var AL=document.createElement("div");AG.appendChild(AL);AG.className="mstrmojo-all-objects-avatar";AL.className="avatar-hint";return AG;},createCols:function p(){var AG=[];if(b(this.type)){AG.push(Q.call(this,5));}AG.push(F.call(this,50));AG.push(N.call(this,20));this.columns=AG;},filterItems:function o(AJ){var AI=this;if(AJ===undefined){AJ=this.searchPattern;}if(AJ===undefined){return ;}var AG=l.filter(this.allItems,function AH(AL){var AK=AL.n.toLowerCase();var AM=AJ.toLowerCase();return ~AK.indexOf(AM);});this.set("searchPattern",AJ);this.set("items",AG);this.sort("n",this.sortFlag);setTimeout(function(){if(AI.type===AD.Attribute&&AI._headerWidgets_){AI._headerWidgets_[f].updateState();}});},getAllItems:function I(){return this.allItems;},getCellWidget:function A(AH,AG){var AI=this.itemsContainerNode.firstChild;var AJ=AI.rows[AH];if(AJ){return mstrmojo.dom.findWidget(AJ.cells[AG].firstChild);}},getDragAction:function U(){return this.type===AD.Attribute?z:G;},getDragData:function n(AH){var AI=R.eventTarget(AH.src.hWin,AH.src.e);var AG=this.listMapper.findIndex(this,this.itemsContainerNode,AI);if(AG>=0&&this.selectedIndices[AG]!==true){this.raiseEvent({name:"beginSelectionItem"});this.singleSelect(AG);this.clickedItem=this.items[AG];}return this.getSelObjs();},getSearchIdxes:function t(){var AG=this.items;var AL=AG.length;var AK=[];var AI,AJ,AH;for(AJ=0;AJ<AL;AJ++){AI=AG[AJ].col;if(!AI.isMultiForm){if(AI.indexOn){AK.push({atid:AI.id,afid:AI.fmid});}}else{for(AH=0;AH<AI.subColumns.length;AH++){if(AI.subColumns[AH].indexOn){AK.push({atid:AI.id,afid:AI.subColumns[AH].fmid});}}}}l.forEach(l.difference(this.allItems,this.items),function(AN){var AM=AN.col;if(!AM.isMultiForm){if(AM.indexOn){AK.push({atid:AM.id,afid:AM.fmid});}}else{for(AH=0;AH<AM.subColumns.length;AH++){if(AM.subColumns[AH].indexOn){AK.push({atid:AM.id,afid:AM.subColumns[AH].fmid});}}}});return AK;},getSelObjs:function g(){var AH=this.getSelectedItems();var AG=[];l.forEach(AH,function(AI){AG.push(AI.col);});return AG;},init:function(AG){if(this._super){this._super(AG);}this.model=mstrApp.getRootController().model;this.createCols();this.updateItems();this.model.attachEventListener("CurrentSourceChanged",this.id,"updateItems");this.model.attachEventListener("MappingsFetched",this.id,"updateItems");},initSearchIndex:function P(AK){var AH=this.items;var AL=AH.length;var AI,AJ;for(AI=0;AI<AL;AI++){var AG=this.getCellWidget(AI,f);if(AG){if(AH[AI].col.isMultiForm){AJ=AK?AB.ALL:AB.NON;AG.mfaIndexControl.set("state",AJ);l.forEach(AG.formsList.children,function(AM){if(AM.enabled){AM.set("checked",AK);}});AG.mfaIndexControl.set("checked",AK);}else{AG.set("checked",AK);}}}},itemFunction:function(AI,AG,AH){var AJ=this._super(AI,AG,AH);AJ.parent=AH;return AJ;},oncontextmenu:function H(AQ){R.preventDefault(window,AQ.e);var AJ=AE();var AH=R.eventTarget(AQ.hWin,AQ.e);var AP=this.listMapper.findIndex(this,this.itemsContainerNode,AH);if(AP>=0&&this.selectedIndices[AP]!==true){this.raiseEvent({name:"beginSelectionItem"});this.singleSelect(AP);this.clickedItem=this.items[AP];}var AI=this.getSelObjs();var AG=R.eventTarget(AQ.hWin,AQ.e);var AN=R.findAncestorByName(AG,"tr",true,this.domNode);if(!AN){return ;}var AO=S(this.type);var AM=AN.children[AO].firstChild;var AL=R.findWidget(AM);if(AL&&AL.scriptClass==="mstrmojo.Box"){AL=AL.children[1];}AJ.target=AL;AJ.data=AI;AJ.type=q.contextMenuType.ITEM_MENU;var AK=AJ.getMenuConfig();AK.hostId=this.id;AK.hostElement=AG;AK.isHostedWithin=false;AK.position=R.getMousePosition(AQ.e,AQ.hWin);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AK}));},ondragenter:function K(AG){if(this._super){this._super(AG);}var AH=AG.src.widget;if(AH&&AH.updateAvatarHTML){AH.updateAvatarHTML(AG.action,this.type);}},ondragleave:function V(AG){if(this._super){this._super(AG);}var AH=AG.src.widget;AH.avatar.lastChild.innerHTML="";},ondrop:function k(AH){var AG=mstrApp.getRootController(),AK=AH.src;if(AK&&AK.data){var AI=AK.data;if(AH.action===z&&this.type===AD.Metric){AG.toMetric(AI);}else{if(AH.action===G&&this.type===AD.Attribute){AG.toAttribute(AI);}}var AJ=AH.src.widget;AJ.clearSelect();}},onmousedown:function m(AG){var AI=this.hightlightAttFormList;if(AI){AI.clearSelect();AI=null;}var AJ=R.eventTarget(AG.hWin,AG.e);var AH=R.findAncestorByName(AJ,"table",true,this.domNode);if(!AH){this.clearSelect();}},postBuildRendering:function x(AG){this._super(AG);R.attachMarkupEvent(this.id,this.domNode,"contextmenu");},premousedown:function Z(AG){if(AG.e.button===2){var AJ=R.eventTarget(AG.hWin,AG.e);var AI=R.findAncestorByName(AJ,"tr",true,this.domNode);var AH=R.findWidget(AI);if(AH.selected){return ;}}},preclick:function u(AJ){if(R.isPrimaryMouseBtn(AJ.e)){var AI=AJ.hWin,AM=AJ.e,AL=R.eventTarget(AI,AM),AH=this.listMapper.findIndex(this,this.itemsContainerNode,AL);if(AH>-1){var AG=this.multiSelect,AN=R.isMetaKey(AI,AM),AK=R.shiftKey(AI,AM);if(AN||AK){R.clearBrowserHighlights(AI);}this.raiseEvent({name:"beginSelectionItem"});if(AG&&(AN||(this.selectionPolicy==="toggle"))){this.toggleSelect(AH);}else{if(AG&&AK){this.rangeSelect(AH);}else{this.singleSelect(AH);this.clickedItem=this.items[AH];}}}}},rangeSelect:function Y(AG,AI){var AL=this.selectedIndex,AH=AG,AM=AH-AL,AK=1,AJ=[];if(AH<AL){AK=-1;AM=-AM;}while(AM>=0){AJ.push(AL);AL=AL+AK;AM--;}this.addSelect(AJ,AI);},sort:function AF(AK,AG){var AJ=AG?1:-1;var AH=this.items;AH.sort(function AI(AM,AL){if(AM[AK]>AL[AK]){return AJ;}return -AJ;});this.set("items",AH.concat());},updateAvatarHTML:function AC(AH,AG){var AI="";if(AH===z&&AG===AD.Metric){AI=mstrmojo.desc(11805,"Convert to Metric");}else{if(AH===G&&AG===AD.Attribute){AI=mstrmojo.desc(11611,"Convert to Attribute");}}this.avatar.lastChild.innerHTML=AI;},updateItems:function j(){var AJ=this,AH=h(this.type),AG=mstrApp.getRootController().allObjectsController,AK=0;if(this.hasRendered){AK=this.scrollNode.scrollTop;}if(this.type===AD.Attribute){M(this.model,AH);}this.clearSelect();this.items=AH;this.sort("n",this.sortFlag);this.set("allItems",AH);setTimeout(function(){if(AJ.type===AD.Attribute&&AJ._headerWidgets_){AJ._headerWidgets_[f].updateState();}});this.filterItems();if(this.clickedItem&&this.clickedItem.col){for(var AI=0;AI<this.items.length;AI++){if(this.items[AI].col&&this.items[AI].col.did===this.clickedItem.col.did){this.singleSelect(AI);break;}}}if(this.hasRendered){this.scrollNode.scrollTop=AK;}AG.raiseEvent({name:"updateDistKey"});}});mstrmojo.DI.HeaderWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.HeaderWidget",field:"",text:"",cm:[],menuController:null,tooltip:"",markupString:'<div id="{@id}" class="mstrmojo-di-headerwidget {@cssClass}" style="{@cssText}"><div class="header-text"></div><div class="header-icon"></div><div class="header-menu"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];},iconNode:function(){return this.domNode.children[1];},menuNode:function(){return this.domNode.children[2];}},onexecuteCommand:function(AG){var AH=this.menuController;switch(AG.item.did){case"ASC":AH.sort(this.field,true);AH.sortFlag=true;break;case"DES":AH.sort(this.field,false);AH.sortFlag=false;break;default:break;}},children:[{slot:"textNode",alias:"text",scriptClass:"mstrmojo.Label",bindings:{text:"this.parent.text"}},{slot:"iconNode",alias:"icon",scriptClass:"mstrmojo.Button",cssClass:"search-index-icon",title:mstrmojo.desc(15362,"Click to enable fast search index on an attribute"),tooltipOpenDelay:0,useRichTooltip:true,visible:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",left:10,top:-5,refNode:this.domNode,posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.title});}},{slot:"menuNode",alias:"menu",scriptClass:"mstrmojo.Button",onclick:function(){var AI=this.parent;var AH=new mstrmojo.DI.DIAllObjectsHeaderMenu();AH.target=AI;AH.cm=AI.cm;AH.type=q.contextMenuType.ITEM_MENU;AH.position=R.position(this.domNode,true);var AG=AH.getMenuConfig();AG.hostId=AI.id;AG.hostElement=this.domNode;AG.isHostedWithin=false;AG.position=AH.position;AI.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:AG}));}}]});mstrmojo.DI.DIAllObjectsHeaderMenu=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIAllObjectsHeaderMenu",queryVisible:function X(AG){if(AG.did==="ASC"||AG.did==="DES"){return true;}else{return false;}},queryEnabled:function D(AG){if(AG.did==="ASC"||AG.did==="DES"){return true;}else{return false;}},queryChecked:function c(){return false;},executeCommand:function(AG){this.target.raiseEvent({name:"executeCommand",src:this.target,item:AG});}});mstrmojo.DI.DIAllObjectsSourceLabel=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.DI.DIAllObjectsSourceLabel",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,top:-32},src:null,total:0,postBuildRendering:function a(){var AH=mstrmojo.desc(14029,"Exists in #### of @@@@ tables");if(!this.src){return this._super();}AH=AH.replace("####",this.src.length).replace("@@@@",this.total);AH+="</br>";AH+=this.src.join("</br>");var AG={cssClass:"vi-regular vi-tooltip-C",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,content:AH,top:-6,left:50};this.set("richTooltip",AG);return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Panel","mstrmojo.Container","mstrmojo.Button","mstrmojo.MenuButton","mstrmojo.WidgetList","mstrmojo.DI.DIMappingItem","mstrmojo.DI.DIMultiFormEditor");var G=mstrmojo.dom;var L=mstrmojo.DI.DIConstants;var A=mstrmojo.DI.DIConstants.menuItems;function B(O,N){var M={placeholder:document.body.appendChild(document.createElement("div")),cssClass:"mstrmojo-di-mappingitem-avatar",visible:false,data:N,name:N.n,type:N.tp,georole:N.georole,timerole:N.der,parent:O};var P=new mstrmojo.DI.DIMappingItem(M);P.render();O.avatar=P;return P;}function J(Q,M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(!N||!N._allowDnD){return false;}var S=G.position(N.domNode);var R=Q.avatar||B(Q,N.data);R.set("name",N.data.n);R.domNode.style.top=(O.pos.y+1)+"px";R.domNode.style.left=(O.pos.x+1)+"px";R.domNode.style.display="block";R.domNode.style.zIndex="9999";R.domNode.style.width=(S.w-2)+"px";R.domNode.style.height=(S.h-2)+"px";}function H(N,M){if(N.avatar&&N.avatar.domNode){N.avatar.domNode.style.display="none";}}function D(P,M){var O=M.src;var N=M.tgt;if(N&&N.pos&&P.avatar&&P.avatar.domNode){P.avatar.domNode.style.left=(N.pos.x+1)+"px";P.avatar.domNode.style.top=(N.pos.y+1)+"px";}}function K(V){if(!V||!V.data||!V.data.ert||!V.data.col){return ;}var N=this.model;var S=V.data.col;var O=[];var R,M;var P={tp:L.relationshipEditType.remove,paid:S.parent.id,atid:S.child.id,ert:L.ERType.reserved};if(N.currentSource){O=[N.currentSource.tableID];}else{var Q=N.findMappingSource(S.parent);var U=N.findMappingSource(S.child);for(R=0;R<Q.length;R++){if(U.indexOf(Q[R])>-1){if(N.hasRelationship(Q[R].tableID,S.parent,S.child)){O.push(Q[R].tableID);}}}}mstrApp.getRootController().editRelationship(O,P);}function F(P){if(!P||!P.data||!P.data.ert||!P.data.col){return ;}var M=this.model;var U=P.data.col;var S=[];var O;if(M.currentSource){S=[M.currentSource.tableID];}else{var N=M.findMappingSource(U.parent);var Q=M.findMappingSource(U.child);for(O=0;O<N.length;O++){if(Q.indexOf(N[O])>-1){if(M.hasRelationship(N[O].tableID,U.parent,U.child)){S.push(N[O].tableID);}}}}var R={tp:L.relationshipEditType.flip,paid:U.parent.id,atid:U.child.id,ert:U.ert};mstrApp.getRootController().editRelationship(S,R);}function C(V,R){if(!V||!V.data||!V.data.ert||!V.data.col){return ;}var M=this.model;var S=V.data.col;var N=[];var Q;if(S.ert===R){return ;}if(M.currentSource){N=[M.currentSource.tableID];}else{var P=M.findMappingSource(S.parent);var U=M.findMappingSource(S.child);for(Q=0;Q<P.length;Q++){if(U.indexOf(P[Q])>-1){if(M.hasRelationship(P[Q].tableID,S.parent,S.child)){N.push(P[Q].tableID);}}}}var O={tp:L.relationshipEditType.changeERType,paid:S.parent.id,atid:S.child.id,ert:R};mstrApp.getRootController().editRelationship(N,O);}function E(N){var O=this.data;var M=false;if(O&&O.ert!==undefined){if(N.did===A.ONE_TO_ONE&&O.ert===L.ERType.ERType11){M=true;}if(N.did===A.ONE_TO_MANY&&O.ert===L.ERType.ERType1M){M=true;}if(N.did===A.MANY_TO_ONE&&O.ert===L.ERType.ERTypeM1){M=true;}if(N.did===A.MANY_TO_MANY&&O.ert===L.ERType.ERTypeMM){M=true;}}return M;}mstrmojo.DI.DIMappingDeck=mstrmojo.declare(mstrmojo.Container,null,{title:"",type:"",titlebarCss:"",scriptClass:"mstrmojo.DI.DIMappingDeck",markupString:'<div id="{@id}" class="mstrmojo-di-mappingdeck {@cssClass}" style="{@cssText}"><div class="mstrmojo-di-mappingdeck-titlebar {@titlebarCss}"></div><div class="mstrmojo-di-mappingdeck-list"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.children[0];},containerNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"titlebarNode",scriptClass:"mstrmojo.Table",cssClass:"titlebar-table",rows:1,cols:2,children:[{slot:"0,0",scriptClass:"mstrmojo.Label",cssClass:"titlebar-label",bindings:{text:"this.parent.parent.title"}},{slot:"0,1",scriptClass:"mstrmojo.Button",cssClass:"titlebar-button",text:"?",onclick:function(){if(this.parent.parent.onCaptionOK){this.parent.parent.onCaptionOK();}}}]},{slot:"containerNode",alias:"list",scriptClass:"mstrmojo.WidgetList",cssClass:"mstrmojo-di-mappingdeck-list",draggable:true,dropZone:true,ownAvatar:true,allowDrop:function(M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}return N&&N._allowDnD;},getDragData:function(M){var Q=null;var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(N&&N._allowDnD){Q={item:N.data};}return Q;},isDragValid:function I(N){var O=N.src;if(!O){return false;}var P,M;P=O.node;if(P){M=G.findWidget(P);}if(!M||!M.data||!M.data.col||isNaN(M.data.tp)){return false;}if(M&&M._allowDnD){J(this,N);}return M&&M._allowDnD;},ondragstart:function(N){var O=N.src;var P,M;P=O.node;if(P){M=G.findWidget(P);}if(M&&M._allowDnD){J(this,N);}},ondragend:function(M){H(this,M);},ondrop:function(M){var P=M&&M.src;var O=M&&M.tgt;var Q,S,N,R,U;if(!P||!P.node||!O||!O.node){return ;}Q=P.node;S=G.findWidget(Q);Q=O.node;N=G.findWidget(Q);R=O.pos;if(!N._allowDnD&&N.parent._allowDnD){N=N.parent;}if(N.textNode){U=G.position(N.textNode);}if(!S||!S._allowDnD){return ;}if(N._allowDnD&&U&&(R.x<=U.x)){this.parent.onMappingItemsDnD(S,N);}else{if(N===O.widget){this.parent.onItemToDeck(S,N.parent);}else{if(N._allowDnD&&U&&(R.x>U.x)){if(P.widget===O.widget){this.parent.onMappingItemsDnD(S,N);}else{this.parent.onItemToDeck(S,O.widget.parent);}}}}},ondragenter:function(M){var O=M.src;var P,N;if(!O){return false;}P=O.node;if(P){N=G.findWidget(P);}if(!N||!N._allowDnD){return false;}var Q=O.widget;J(Q,M);D(Q,M);return true;},ondragmove:function(M){D(this,M);},ondragover:function(M){},ondragleave:function(M){var N=M.src;if(!N||!N.widget){return false;}H(N.widget,M);},getItemContainerChildrenHeight:function(){var N=0;var M;if(this.domNode&&this.itemsContainerNode&&this.itemsContainerNode.childNodes){for(M=0;M<this.itemsContainerNode.childNodes.length;M++){N+=this.itemsContainerNode.childNodes[M].clientHeight;}}return N;},onheightChange:function(N){var M;if(this.domNode){this.domNode.style.height=parseInt(N.value,10)+"px";M=this.getItemContainerChildrenHeight();if(M>parseInt(N.value,10)-20){this.domNode.childNodes[0].style.height=this.domNode.childNodes[0].clientHeight+50+"px";}else{if(M>0){this.domNode.childNodes[0].style.height=M+10+"px";}}}},itemFunction:function(P,O,Q){var M={data:P.col,name:P.n,tooltip:P.n,type:P.tp,queryChecked:P.queryChecked,queryVisible:P.queryVisible,model:Q.parent.model,_allowDnD:true,cssClass:P.isLinked?"linked":"",georole:P.georole,timerole:P.der,parent:Q};if(typeof P.allowEdit==="boolean"){M.allowEdit=P.allowEdit;}var N=new mstrmojo.DI.DIMappingItem(M);return N;},postCreate:function(){var M=this.parent.model;this.update();M.attachEventListener("MappingsFetched",this.id,"update");M.attachEventListener("CurrentSourceChanged",this.id,"update");},update:function(){var N=this.parent.model;var S;if(N.currentSource){if(N.currentSource.currentTransformations&&N.currentSource.currentTransformations.xtab&&N.currentSource.currentTransformations.xtab.isCrosstab){S=N.currentSource.transformedMapping;}else{S=N.currentSource.currentMapping;}}else{S=N.getAllMappings();}if(!S||!S.length){return ;}var P,M,W;var R=[];for(P=0;P<S.length;P++){M=S[P];W=false;switch(this.parent.type){case"amps":if(M.tp===12&&M.selected){W=true;}break;case"mtmps":if(M.tp===4&&M.selected){W=true;}break;case"cmps":if(!M.selected){W=true;}break;}if(W){R.push({n:M.alias,tp:M.tp,col:M,idx:P,isLinked:M.isLinked,queryVisible:queryMenuItemVisible,isMultiForm:M.isMultiForm});}}var Q=[];var U,O,V;if(this.parent.type==="amps"){if(N.currentSource){Q=N.currentSource.relationship||[];}else{Q=N.getAllRelationships();}for(P=0;P<Q.length;P++){O=Q[P];V={n:"&lt"+O.parent.n+", "+O.child.n+"&gt",tp:"rs",allowEdit:false,ert:O.ert,col:O,queryChecked:E};if(O.ert===L.ERType.ERType11){V.n=V.n+"(1:1)";}else{if(O.ert===L.ERType.ERType1M){V.n=V.n+"(1:M)";}else{if(O.ert===L.ERType.ERTypeM1){V.n=V.n+"(M:1)";}else{if(O.ert===L.ERType.ERTypeMM){V.n=V.n+"(M:M)";}}}}R.push(V);}}this.set("items",R);}}],onheightChange:function(M){this.list.set("height",parseInt(M.value,10)-20+"px");},onMappingItemsDnD:function(M,V){var P=M.name;var X=V.name;var N=this.model;var O=[],U;var Q,W,S;if(M.type!==12||V.type!==12){if(V.type===12||V.type==="rs"){M.toAttribute();return ;}if(V.type===4){M.toMetric();return ;}return ;}if(!M.data||!M.data.col||!V.data||!V.data.col){return ;}if(!M.data.col.selected&&V.data.col.selected){M.toAttribute();return ;}if(M.data.col.selected&&!V.data.col.selected){M.toUnused();return ;}if(!M.data.col.selected&&!V.data.col.selected){return ;}if(M.data.col.id===V.data.col.id){return ;}if(N.currentSource){if(!(N.hasRelationship(N.currentSource.tableID,V.data.col,M.data.col)||N.hasRelationship(N.currentSource.tableID,M.data.col,V.data.col))){O.push(N.currentSource.tableID);}}else{Q=N.findMappingSource(M.data.col);W=N.findMappingSource(V.data.col);for(S=0;S<Q.length;S++){if(W.indexOf(Q[S])>-1){if(!(N.hasRelationship(Q[S].tableID,V.data.col,M.data.col)||N.hasRelationship(Q[S].tableID,M.data.col,V.data.col))){O.push(Q[S].tableID);}}}}var R={tp:L.relationshipEditType.create,paid:V.data.col.id,atid:M.data.col.id,ert:L.ERType.ERType1M};mstrApp.getRootController().editRelationship(O,R);},onItemToDeck:function(O,P){var N=O.name;var M=O.type;var Q=P.type;switch(Q){case"amps":O.toAttribute();break;case"mtmps":O.toMetric();break;case"cmps":O.toUnused();break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.LevelDataGrid","mstrmojo.DI.DIMappingItem","mstrmojo.string");var G=mstrmojo.array,E=mstrmojo.dom,A=mstrmojo.css;var D=200;var F=22;function C(M,I,J){var H=M[this.dataField];var K="mapping-column",L=mstrmojo.DI.DIHelpers.encodeData(H);if(H===null){L="";}if(this.tag.selected){K+={"12":" Attribute","4":" Metric"}[this.tag.tp];}K+=(I%2===1)?" odd":" even";if(0===this.tag.tp||false===this.tag.selected){L="";}return'<div class="'+K+'" title="'+L+'">'+L+"</div>";}function B(N,L,J){var P="";if(N.isLinked){P+="linked ";}if(N.isAttributeForm){P+="attrForm";}var H=N.isLinked;var O=false,M=false;if(H){var I=mstrApp.getRootController().model.findMappingItem(N);var K;for(K=0;K<I.length;K++){if(I[K].recursive){M=true;break;}else{if(I[K].georole){O=true;break;}}}}return{tag:N,headerWidget:{scriptClass:"mstrmojo.DI.DIMappingItem",data:N,allowEdit:this.hasContextMenu,name:N.isAttributeForm?N.alias+"@"+N.fmn:N.alias,type:N.tp,georole:N.georole||O,recursive:N.recursive||M,timerole:N.timerole,_allowDnD:false,cssClass:P},dataField:L.toString(),colWidth:J,colCss:J===F?"NotImported":"mapping-column",applyStyle2Cell:J===F,dataFunction:C};}mstrmojo.DI.DIMappingPreview=mstrmojo.declare(mstrmojo.DI.LevelDataGrid,null,{scriptClass:"mstrmojo.DI.DIMappingPreview",cssClass:"lockHeader mstrmojo-di-mappingpreview",lockHeader:false,hasContextMenu:true,model:null,hasCustomScrollbar:true,resizeColumnBehavior:mstrmojo.RESIZE_CURRENT_COLUMN_MODE,markupMethods:{onheightChange:function(){var H=this.height,I=parseInt(H,10);if(isNaN(I)||I<0){return ;}if(H){this.domNode.style.height=H;}this.widgetResized();},onwidthChange:function(){var I=this.width,H=parseInt(I,10);if(isNaN(H)||H<0){return ;}if(I){this.domNode.style.width=I;}this.widgetResized();},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},oncontentWidthChange:function(){var J=this.contentWidth||this.width,I=this.domNode,H=this.itemsContainerNode;if(J&&I&&H){if(J==="auto"&&this.parent.containerNode.clientWidth>40){J=this.parent.containerNode.clientWidth-40+"px";}I.style.width=J;H.style.width=J;}}},postBuildRendering:function(){var H=this;if(this._super){this._super();}window.setTimeout(function(){var I=H.domNode,K=H.scrollboxNode,J=H.headerContainerNode;if(I.offsetHeight>=J.offsetHeight){K.style.height=I.offsetHeight-J.offsetHeight+"px";}H.widgetResized();E.attachEvent(K,"scroll",function(){if(J.scrollLeft!==K.scrollLeft){J.scrollLeft=K.scrollLeft;}});},0);if(mstrmojo.dom.isEdge){this.domNode.setAttribute("x-ms-format-detection","none");}},setDimensions:function(L,J){var I=parseInt(L,10);var K=parseInt(J,10);var H=this.itemsContainerNode;var M=this.scrollNode;if(isNaN(I)||isNaN(K)){return ;}this.set("height",(!!mstrApp.isWorkstation?Math.max((I+21),0):Math.max((I-4),0))+"px");this.set("width",Math.max((K-4),0)+"px");if(H){H.style.width=Math.max((K-4),0)+"px";}if(M){M.style.height=(!!mstrApp.isWorkstation?Math.max((I),0):Math.max((I-25),0))+"px";M.style.width=Math.max((K-4),0)+"px";}if(this._super){return this._super(L,J);}},ondragend:function(H){if(this._super){this._super(H);this.ownAvatar=true;}},populatePreview:function(){if(!this.model||!this.model.mappings){return ;}var I=this.model.mappings;var N=this.model.dataset;var Y=0,V=0,L=0,O,P,J,M,Q;var K=function(a){return a.selected;};V=this.scrollNode&&this.scrollNode.scrollLeft;this.unrender();this.refresh();var S=this.parent&&this.parent.domNode;if(!S){return ;}var R=this.parent&&this.parent.previewNode;var W=R?R.clientWidth:parseInt(this.contentWidth);var Z=this.countNotIMColumn();var X=(I.length-Z)*D+Z*F;var U=W>X?W:X;U-=2;var H=Math.floor((U-Z*F)/(I.length-Z));this.columns=[];Q=mstrmojo.hash.clone(I);Q=mstrmojo.array.filter(Q,K);Q.sort(function(d,c){if(d.tp>c.tp){return -1;}else{if(d.tp<c.tp){return 1;}}if(d.n>c.n){return 1;}else{if(d.n<c.n){return -1;}}return 0;});G.forEach(Q,function(a){J=B.call(this,a,a.dataIdx,0===a.tp||false===a.selected?F:H);O=a.subColumns;if(O&&O.length>1){J.dataField=null;J.dataFunction=null;M=J.subColumns=[];G.forEach(O,function(b){P=B.call(this,b,b.dataIdx,0===a.tp||false===a.selected?F:H/O.length);M.push(P);Y++;});}else{Y++;}this.columns.push(J);},this);this.items=N;this.render();A.toggleClass(this.domNode,"populated",true);if(this.scrollNode){L=this.scrollNode.scrollWidth-this.scrollNode.clientWidth;}if(this.scrollNode&&V!==undefined){this.scrollNode.scrollLeft=V<L?V:L;}if(this.headerContainerNode&&V!==undefined){this.headerContainerNode.scrollLeft=V<L?V:L;}},countNotIMColumn:function(){var H=0;var I=this.model.mappings;G.forEach(I,function(J){if(0===J.tp||false===J.selected){H++;}});return H;},onvisibleChange:function(H){if(H.value){this.populatePreview();}},getMappingColumnOffset:function(J){var I=this,L=I._headerWidgets_,H,K;if(I.scrollNode){K=I.scrollNode.scrollLeft;}H=G.filterOne(L,function(M){return M.data.id===J.id||M.data.did===J.did;});if(H&&H.domNode){K=E.delta(H.domNode,L[0].domNode).x;}return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.ui.dialogs.DISaveAsDialog","mstrmojo.Button","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(221,1442,3415,3416,12376,12377,12925,14438,15065,15066,15066);var F=mstrmojo.desc,E=mstrmojo.DI.DIHelpers,C=mstrmojo.Button.newWebButton;var B;mstrmojo.qb.QBHelpers={showSaveAsDialog:function A(N,L){var G=0,J=-1,H=-2;var I,M={};if(E.isServerBasedWS()&&N){M.taskId="openNativeWindow";M.windowType=3;var K={success:function(O){if(O&&O.fileName){N.onOK({folderID:O.folderID,objDesc:"",objName:O.fileName,objPath:O.filePath+"\\"+O.fileName});}}};mstrApp.serverRequest(M,K);return ;}I=B&&mstrmojo.all[B];if(!I){I=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();B=I.id;}I.set("name",L.name||"");I.set("desc",L.desc||"");I.set("saveParams",{});I.set("retainPrevFolder",true);I.buttonBox.ok.set("enabled",true);if(mstrApp.cubeSaveFolderId){I.set("rootFolderID",mstrApp.cubeSaveFolderId);}I.saveAs=function(O){var P=I.zIndex+2;I.buttonBox.ok.set("enabled",false);this.validateInput(O,function(Q){var R={folderID:I.folderID,objDesc:I.desc||"",objName:I.name||"",saveAsOverwrite:I.saveAsOverwrite,objPath:I.getObjectPath()};switch(Q){case G:I.close();N.onOK(R);break;case J:mstrmojo.alert(F(12376,"Please enter a valid cube name"),null,"",P);I.buttonBox.ok.set("enabled",true);break;case H:I.buttonBox.ok.set("enabled",true);mstrmojo.confirm(mstrmojo.desc(12925,"The name ## already exists. Do you want to replace the existing one?").replace("##",this.name),{confirmBtn:{fn:function(){I.close();N.onOK(R);}}},{title:F(12377,"Saving cube with the same name"),zIndex:P});break;}});};I.open();return I;},saveWithUserOption:function(I,H,J){var G="<strong>"+F(15066,"Do you want to replace the existing cube")+"?</strong><br/>",K={rename:function(){mstrmojo.confirm(G+F(15067,"A cube named ## already exists in this location. Do you want to replace it with the one you are editing ?").replace("##",H.fileName),{},{title:F(14438,"Replace"),allowHTML:true,cssClass:"CubeNameConflictDialog",buttons:[C(F(15065,"Keep Both"),function(){I(true);},false),C(F(14438,"Replace"),function(){I(false);},false)]});},saveDirectly:function(){I(false);}};if(!H){return false;}J.searchObjectName(K,{folderID:H.folderID,searchPattern:H.fileName});},clone:function D(K){if(!K){return null;}var M;if(K.constructor===Array){M=K.concat();var L=M[0];if(L&&typeof L==="object"){var G=M.length,J;for(J=0;J<G;J++){M[J]=this.clone(K[J]);}}}else{M={};var I,H;for(I in K){if(I==="parent"){continue;}H=K[I];if(H&&typeof H==="object"){M[I]=this.clone(H);}else{M[I]=H;}}}return M;}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo.fe.RelationNode","mstrmojo.fe.RelationFilterExprTree","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumNodeDimty","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.Label","mstrmojo.vi.ui.toolbars.TitleToolbar","mstrmojo.vi.ui.toolbars._HasToolbar");mstrmojo.requiresDescs(2790,5895,5896,7931,12036,12037,15121,15122);var F=mstrmojo.hash,A=mstrmojo.array,G=mstrmojo.mstr.EnumDSSXMLObjectTypes,H=mstrmojo.mstr.EnumNodeDimty,C=mstrmojo.css,E=mstrmojo.string,D=function(P){var Q=P.data,O=Q.dmy&&Q.dmy.uts||[],L=O.length,K=[],N,M;for(N=0;N<L;N++){K.push(E.encodeHtmlString(O[N].n));}M=K.join(", ");return'<span class="mstrmojo-text" title="'+M+'">'+M+"</span>";};var I=function(){var M=mstrmojo.desc(2790,"Set of ##"),L=M.split("##")[0];var K=L.length;if(K>0&&L[K-1]===" "){L+="&nbsp;";}return L;};mstrmojo.vi.ui.editors.fe.RelationNode=mstrmojo.declare(mstrmojo.fe.RelationNode,[mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.editors.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><div class="mstrmojo-relationNode-inf"><div class="mstrmojo-relation-prefix-text">'+I()+'</div><div class="mstrmojo-textset"  mstrAttach:click></div><div class="mstrmojo-relation-prefix-text">'+(mstrmojo.desc(2790,"Set of ##").split("##")[1]||"")+'</div><div class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(15121,"filtered by")+'</div><div class="mstrmojo-relation-related-by-box"></div><div class="mstrmojo-relation-toolbar"></div><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></div><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},relatedByBoxNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[4];},toolbarNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[5];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){C.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=D(this);}},children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(K){this.parent.tree.onNew(K);},getItemConfig:function(N,K,O){var L=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,N,K,O),M=O.tree||O;return F.copy({tree:M,rootTree:this.parent.tree,noRelation:true,inRelation:true,onremove:function(){if(this.rootTree&&this.rootTree.onremove){this.rootTree.onremove();}},onadd:function(){if(this.rootTree&&this.rootTree.onadd){this.rootTree.onadd();}}},L);},prenodeclick:function(K){if(!K||!K.part){return ;}var L=this.rootTree;if(L&&L.onnodeclick&&this.editable){K.editor=L.editor;L.onnodeclick.call(this,K);}}},{scriptClass:"mstrmojo.Box",alias:"relBox",slot:"relatedByBoxNode",cssClass:"RelatedBy-Box",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12036,"Related by"),cssClass:"Label",cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"relPd",cssClass:"Pulldown",cssDisplay:"inline-block",isHostedWithin:false,allowHTML:false,onitemSelected:function B(O){var N=this.parent.parent,L=N.data,K=null;if(this.selectedIndex>0){K={n:O.n,did:O.did,t:O.t||G.Metric,st:O.st||1024};}L.dmt=H.NodeDimtyOutputLevel;L.dmy=L.dmy||{};var M=L.relation=L.relation||{};if(K){M.guide=K;L.useSchema=false;}else{delete M.guide;delete M.rsTp;delete M.joTp;delete M.paTp;delete M.erTp;L.useSchema=true;}N.set("data",L);}}]},{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",slot:"toolbarNode",alias:"toolbar",visible:true,hasContextMenuButton:true,cssClass:"relation-toolbar",cssDisplay:"inline-block"}],_set_data:function(N,S){var O=this._super(N,S);var L=this.data,P=!L.m,K=this.relBox.relPd,Q=A.filter(this.tree.editor.targetMetrics,function(V){return !V.um;}),U=[{n:mstrmojo.desc(12037,"System Default"),t:-1,did:"default"}].concat(Q);this.relBox.set("visible",P);if(P){var R=0;if(L.relation&&L.relation.guide){var M=L.relation.guide;R=A.find(U,"did",M.did);}if(R!==K.selectedIndex){K.set("items",U);K.set("selectedIndex",R>=0?R:0);}}return O;},updateToolbar:function J(K){var L=this;if(this._super){K=this._super(K);}K.addMenuItem(mstrmojo.desc(15122,"Convert to Condition"),"convert",function(){L.parent.removeSet(L);});K.isHostedWithin=false;return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.CheckList","mstrmojo.TextBox","mstrmojo.TextBoxWithLabel","mstrmojo.CheckBox","mstrmojo.MouseOverContainer","mstrmojo.util.LibraryHelper");mstrmojo.requiresDescs(1825,8078,8079,629,8080,8081,8082,3336,9048,8083,8084,955,8085,531,8086,8087,8088,8089,8090,767,2056,8091,8093,1442,221,8092,13621,9772,9773,9774,272,271,8145,2509,8146,8147,9775,9776,9777,9771,12299,9151,2156,9892,9890,9891,9099,2140,2102);var W=mstrmojo.dom,E=mstrmojo.css,q=mstrmojo.array,t=mstrmojo.util.LibraryHelper,j=[],AA=[{n:mstrmojo.desc(16034,"Grant"),v:0},{n:mstrmojo.desc(16035,"Deny"),v:1},{n:mstrmojo.desc(8441,"Default"),v:2}],Y="sharingEditor",w=199,X="294DEDC011D2F1D56000D98E67019608",I="C82C6B1011D2894CC0009D9F29718E4F",F=[1,4,8,16,32,64,128],B=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],f=["B","R","W","D","C","U","E"],h=false,z=true,Z=257,x=1024,b=772,d=776,O=777,l=mstrmojo.Button.newWebButton,u=mstrmojo.Button.newActionButton;function g(AD,AE,AC){return{scriptClass:"mstrmojo.HBox",alias:AD,right:AE,cssText:"height:20px;",children:[{scriptClass:"mstrmojo.Label",text:AC,cssText:"width:80px"},{scriptClass:"mstrmojo.Pulldown",cssText:"width:100px",itemIdField:"v",items:AA,defaultSelection:2,selectionPolicy:"reselect",_set_value:function(AG,AF){this.value=AF;}}]};}function V(AC){return(AC&&AC.t===8);}function AB(AC){return AC&&AC.st!=Z&&AC.st!=x&&AC.st!=b&&AC.st!=d&&AC.st!=O;}function N(AC){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[AC]||AC;}function K(AC){return{"253000":255000,"253":255,"32221":223,"56197":199}[AC]||AC;}function c(AI){var AH=[].concat(AI.acls),AC=AI.inhs,AG=AI.acls,AK,AE,AJ,AD,AF;AG.splice(0,AG.length);if(V(AI)){AH=AH.concat(mstrmojo.hash.valarray(AC));}for(AD=0,AF=AH.length;AD<AF;AD++){AK=AH[AD];AJ=AK.rgt;if(AJ>1000){AE=mstrmojo.hash.copy(AK);AE.den=true;AE.rgt=Math.floor(AJ/1000);AG.push(AE);}if((AJ%1000)>0){AE=mstrmojo.hash.copy(AK);AE.den=false;AE.rgt=AJ%1000;AG.push(AE);}}return AI;}function U(AD){var AC={isSerializable:function(AG,AF,AE){switch(AG){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(AG,AE,AF){if(AG==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",AD,AC);}function o(AH,AG){var AE=AH&&AH.oi,AD,AC,AI,AF=AH.oneTierConnectivity;if(AE){AE=c(AE);AD=U(AE);AI={taskId:"saveObjectACL",objectXML:AD,objectType:AE.t,objectID:AE.did,propagateToChildren:AH.childrenAccessPulldown.value};AC={success:function(AJ){if(AG){AH.close();}else{mstrmojo.alert(mstrmojo.desc(3336,"## has been saved successfully.").replace("##",AJ.n));AH.set("hasChanged",false);}},failure:function(AJ){if(AJ.getReponseHeader){mstrmojo.alert(AJ.getResponseHeader("X-MSTR-TaskFailureMsg"));}if(AG){AH.close();}}};if(AF){delete AI.taskId;AI.connectionId=AF.connectionId;AI.sessionState=AF.sessionState;AF.connectivityProxy.saveObjectACL(AI,mstrmojo.func.wrapMethods(AC,{failure:function(AJ){mstrmojo.onetier.vi.prefs.handleErrorMessage(AJ);}}));}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,AC,AI);}}}function p(AK){var AO=AK.aclList,AP=AK.objectInputer,AF=AP.getSelectedObjects(),AH=AF.length,AL=[],AE,AN=199,AD,AM,AC;if(!AP.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,AK.alertTitle);return false;}for(AD=0;AD<AH;AD++){AE=AF[AD];if(AE.did===X||AE.did===I){var AG=mstrmojo.all[Y];if(AN===AG.currentPublicRight){if(z){E.removeClass(AG.userMessage.domNode,"hideMsg");}}}AM=q.find(AO.items,"did",AE.did);if(AM!==-1){AC=AO.items[AM];if(AK.uneditableRights[AC.rgt]){continue;}}AL.push(new mstrmojo.Obj({n:AE.n,did:AE.did,st:AE.st,rgt:AN,newItem:true}));}if(AL.length>0){var AJ=q.findMulti(AO.items,"did",AL);if(AJ.count){var AI=AJ.indices.concat().sort(q.numSorter).slice(0,AJ.count);for(AD=AI.length-1;AD>-1;AD--){AO.remove(AI[AD]);}}AO.add(AL);AK.set("hasChanged",true);}AP.set("items",[]);return true;}function P(AC){var AE=[],AH=Math.floor(AC/1000),AF=AC%1000,AI=F,AJ=B,AG=AI.length,AK,AD;for(AD=0;AD<AG;AD++){AE.push(AJ[AD]);AE.push(" ");if((AF&AI[AD])>0){AE.push(mstrmojo.desc(8083,"Granted"));}else{if((AH&AI[AD])>0){AE.push(mstrmojo.desc(8084,"Denied"));}else{AE.push(mstrmojo.desc(959,"Default"));}}AE.push(",");}AK=AE.join("");return AK.substring(AK,AK.length-1);}function k(AJ){var AG=[],AI=AJ%1000,AE=F,AH=f,AC=AE.length,AF,AD;for(AD=0;AD<AC;AD++){if((AI&AE[AD])>0){AG.push(AH[AD]);AG.push(",");}}AF=AG.join("");return AF.substring(AF,AF.length-1);}function R(AE,AF){var AG=AE.items,AD=q.find(AG,AE.itemIdField,AF),AI=AE.customItem,AC=AG.length-2;if(AD===-1){var AH={n:k(AF),rgt:AF};if(AI){AG.splice(AC,1);}AC=AG.length-1;AG.splice(AC,0,AH);AE.customItem=AH;}else{if(AI&&AD!==AC){AG.splice(AC,1);AE.customItem=null;}}if(mstrmojo.all[Y].showACLHint!==false){AE.set("title",P(AF));}AE.value=AF;}function C(AC){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[AC]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}];}function S(AJ,AH){var AG="";if(AH){var AD=this.widthInput.value,AK=this.heightInput.value,AC=' src="'+AJ,AL="",AE=this.toolbarOptions.checkBoxList,AI=AE.items,AF;for(AF=0;AF<AI.length;AF++){if(!AE.selectedIndices.hasOwnProperty(AF)){if(AL==""){AL="&hiddensections="+AI[AF].alias;}else{AL+=","+AI[AF].alias;}}}AG='<iframe width="'+AD+'" ';AG+='height="'+AK+'" ';AG+=AC;AG+=AL;AG+='"></iframe>';}else{AG='<iframe width="640" height="480" src="';AG+=AJ;AG+='&hiddensections=header,path,dockTop,dockLeft,footer"></iframe>';}return AG;}function n(AE){var AG=mstrmojo.string.parseUri(AE).queryKey,AH=AE.indexOf("?"),AD=AH>0?AE.substring(0,AH):AE;var AC=AD.indexOf(";jsessionid");AD=AC>0?AD.substring(0,AC):AD;if(AG.hasOwnProperty("iframe")){delete AG.iframe;}if(AG.hasOwnProperty("validateRandNum")){delete AG.validateRandNum;}if(!AG.hasOwnProperty("server")){AG.Server=encodeURIComponent(mstrApp.serverName);}if(!AG.hasOwnProperty("Project")){AG.Project=encodeURIComponent(mstrmojo.string.decodeHtmlString(mstrApp.projectName));}if(!AG.hasOwnProperty("port")){AG.Port=mstrApp.serverPort;}if(h&&mstrConfig.shareToGuestWhenEnabled){AG.connmode=8;AG.ru=1;}if(AG.evt!=="3185"){AG.share=1;}AD+="?";for(var AF in AG){AD+=AF+"="+AG[AF]+"&";}AD=AD.substring(0,AD.length-1);return AD;}function M(AC){AC.select();document.execCommand("copy");AC.value=AC.value;mstrmojo.alert(mstrmojo.desc(15340,"The link has been successfully copied to your clipboard"));}function D(AD,AC){return(t.isLibraryConfigured()&&(AD===55||(AD===18&&AC&&AC.contains("documentID"))));}function H(AE,AD,AC){if(AD===18&&D(AD,AC)){var AF=mstrmojo.string.parseUri(AC).queryKey;AE=AF.documentID;}return AE;}function a(AE,AD){var AF=window.location.protocol,AC="mailto:?body="+window.encodeURIComponent(AD)+"&subject="+encodeURI(AE.objectName);if(mstrApp.isSingleTier){window.FormWrapper.openPage(AC);}else{if(!!W.isChrome&&AF==="https:"){window.open(AC,"_self");window.setTimeout("iframe.hideWaitPage()",2000);}else{window.open(AC,"mailtoIframe");}}}function L(AD){var AC;switch(AD){case 199:AC="read";break;case 223:AC="write";break;case 255:AC="full";break;case 255000:AC="deny";break;default:AC="custom";}return"sharingEditor-privilegeIcon "+AC;}function J(AF){var AC=new Date(),AE=this.objectName+" "+AC.toLocaleDateString()+" "+AC.toLocaleTimeString(),AD=this,AG={success:function(AJ){var AI=n(AJ.url);AD.topSection.authorLinkRow.authorLinkBox.set("value",AI);AD.url=AI;AD.topSection.htmlPanel.htmlLinkRow.htmlBox.set("value",S(AI));var AH=AD.topSection.authorEmail.emailLink;AH.set("url",window.encodeURIComponent(AI));AH.set("name",AD.objectName);},failure:function(AH){mstrmojo.alert(AH.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){AD.hideWait();if(AF){var AH="mailto:?body="+window.encodeURIComponent(AD.url)+"&subject="+encodeURI(AD.objectName);var AI=mstrApp.openPage||mstrmojo._IsWebApp.openPage;AI(AH,"mailtoIframe");}}};this.showWait();mstrmojo.xhr.request("POST",mstrConfig.taskURL,AG,{taskId:"savePersonalView",messageID:this.mid,objectType:this.oi.t,subName:AE,objectSubType:0,viewMode:this.viewMode||0,isPVPublic:true});}function e(AF){var AD=this.getAvailableRightsForSelection(),AC=AD.length,AE;for(AE=0;AE<AC;AE++){if(AD[AE].rgt===AF){return AD[AE].n;}}return mstrmojo.desc(2056,"Custom");}function Q(AC){return(((AC.acg&32)>0)&&((AC.acg&8)>0));}mstrmojo.SharingEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SharingEditor",cssClass:"mstrmojo-SharingEditor",showSharingOptions:true,showButtonBar:true,showPublisAccess:true,hasChanged:false,help:"sharing_dialog_box.htm",zIndex:199,defaultRight:223,showButtonText:true,uneditableRights:{},currentPublicRight:199,userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),showLinkOnOpen:true,closeEditorAfterSave:true,allowHTMLTitle:true,init:function(AC){Y=AC.id||Y;this._super(AC);},onShowLink:function(AF){var AC=["libraryLink","showLink","htmlCode"];for(var AE=0;AE<AC.length;AE++){if(AC[AE]!==AF){var AD=this.topSection.tabDock[AC[AE]];AD.set("selected",false);E.removeClass(AD.domNode,"selected");}}},showWait:mstrmojo.emptyFn,hideWait:mstrmojo.emptyFn,checkPublicAccess:function(){var AJ=this.oi.acls,AE,AM=q.find(AJ,"did",I),AH=this.aclList.itemsContainerNode,AI=this.publicAccessSection.publicLabel,AG,AL=false,AC=q.find(AJ,"did",X),AK;if(AM!==-1&&h&&AC!==-1){var AD=AJ[AM].rgt,AF=AJ[AC].rgt;if(AD===AF){AL=true;AK=AF;}}if(AM!==-1&&!h){AL=true;AK=AJ[AM].rgt;}AG=AH.children[0].tBodies;if(h&&AG[AC]){E.toggleClass(AG[AC].rows[0],"hide",AL);}if(AG[AM]){E.toggleClass(AG[AM].rows[0],"hide",AL);}AI.set("checked",AL);if(AK){this.set("currentPublicRight",AK);}},oncurrentPublicRightChange:function(){var AC=this.publicAccessSection.publicMouseOver;AC.publicRight.set("value",this.currentPublicRight);AC.publicRightLabel.set("text",e.call(this,this.currentPublicRight));},onOpen:function(){var AN=this.oi,AE=AN.n,AL=AN.t,AO=AN.acls,AG=this.topSection,AJ=AG.tabDock,AF=false;var AH=H(AN.did,AL,this.href);if(this.objectId&&this.objectId===AH&&!this.isLinkDirty){AF=true;}this.objectId=AH;this.objectName=AE;this.set("showACL",!!AO);h=this.guestModeEnabled;if(AB(AN)&&this.showSharingOptions){if(!AF){if(this.href&&!this.isLinkDirty){var AD=!this.urlReady?n(this.href):this.href,AK=AG.authorEmail.emailLink;this.url=AD;AK.set("url",window.encodeURIComponent(AD));AK.set("name",AE);AG.htmlPanel.htmlLinkRow.htmlBox.set("value",S(AD));AG.authorLinkRow.authorLinkBox.set("value",AD);}else{J.call(this);this.set("isLinkDirty",false);}if(D(AL,this.href)){var AD=t.constructLibraryUrl(AH);var AM=AG.libraryLaunchButtons.libraryEmailLink;this.libraryUrl=AD;AG.libraryLinkRow.libraryLinkBox.set("value",this.libraryUrl);AM.set("url",window.encodeURIComponent(AD));AM.set("name",AE);}}if(this.initTab=="shareByLinkMSTRLibrary"){this.onShowLink("libraryLink");AJ.libraryLink.set("selected",true);E.addClass(AJ.libraryLink.domNode,"selected");}else{if(this.initTab=="shareByLinkEmbed"){this.onShowLink("htmlCode");AJ.htmlCode.set("selected",true);E.addClass(AJ.htmlCode.domNode,"selected");}else{this.onShowLink("showLink");AJ.showLink.set("selected",true);E.addClass(AJ.showLink.domNode,"selected");}}}this.set("title",mstrmojo.desc(8093,"share").replace("##",mstrmojo.string.encodeHtmlString(AE)));if(AO){this.checkPublicAccess();var AP=this.objectInputer,AI=this.userSelector,AC=AI&&AI.userBrowser;AP.zIndex=this.zIndex;if(AC&&AC.hasRendered){AI.opener=this;AC.set("items",[]);AC.getContent(AC);}this.set("hasChanged",false);}this.aclList.updateScrollbars();this.positionDialog();},_set_hasChanged:function(AE,AC){var AD=(AC!==this.hasChanged);this.hasChanged=AC;if(AC===true){this.checkPublicAccess();return AC;}return AD;},_set_oi:function(AD,AC){this.oi=this.preProcessACLs(AC);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},getAvailableRightsForSelection:function(){return C(this.oi.st);},preProcessACLs:function(AJ){if(AJ&&AJ.acls){var AH=AJ.acls,AG=AH&&AH.length,AI=V(AJ),AD={},AK,AC,AE,AF;if(AI){AE={};AJ.inhs=AE;}for(AF=0;AF<AG;AF++){AK=new mstrmojo.Obj(AH[AF]);if(AK.den){AK.rgt=AK.rgt*1000;}if(AI&&AK.inh){AE[AK.n]=mstrmojo.hash.copy(AK);continue;}AC=AD[AK.n];if(!AC){AC=mstrmojo.hash.copy(AK);AC.rgt=0;delete AC.den;AD[AK.n]=AC;}AC.rgt=AC.rgt+AK.rgt;if(AC.rgt>255000){AC.rgt=Math.floor(AC.rgt/1000)*1000;}}AH=mstrmojo.hash.valarray(AD);AJ.acls=AH;}return AJ;},getACLItems:function(){var AF=this.aclList&&this.aclList.items,AD=[];for(var AE=0,AC=AF.length;AE<AC;AE++){AD.push(AF[AE]);}return AD;},onClose:function(){var AC=this.objectInputer;AC.set("items",[]);this.aclList.clearSelect();this.onShowLink("showLink");},getACLUserDataService:function m(){return mstrmojo.ACL.UserDataService;},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",getACLUserDataService:function m(){return this.parent.opener.getACLUserDataService();},updateTreeContent:function(AD,AF){AD.contentRetrieved=true;var AE=AF[AD.itemChildrenField],AC=AD.tree||AD,AH=AF.bc,AG=AF.sz,AI=AF.bb;if(AH!==-1){if(AI+AH<=AG){AE.push(AC.nextItemCreaterFunc());}if((AI-AH)>-1){AE.unshift(AC.prevItemCreaterFunc());}}AD.blockBegin=AI;AC.initializing=true;AD.clearSelect(false);AD.set("items",AE);AD.setSelectedItems(AC.getTotalSelections(),true);AC.initializing=false;},selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(AD){var AC=this.parent.parent,AH=AC.opener,AG=AH.objectInputer,AF=AC.userBrowser,AE=AF.getTotalSelections();if(AE&&AE.length>0){AG.add(AE,AG.items.length-1);}AC.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(AC){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var AI=this.rgt,AJ=Math.floor(AI/1000),AH=AI%1000,AE=this.children,AF,AG,AD,AC;for(AD=0,AC=7;AD<AC;AD++){AF=AE[AD];AG=AF.right;if((AH&AG)>0){AF.children[1].value=0;}else{if((AJ&AG)>0){AF.children[1].value=1;}else{AF.children[1].value=2;}}}this.refresh();},getACLValue:function(){var AG=0,AH=0,AE=this.children,AF,AD,AC;for(AD=0,AC=7;AD<AC;AD++){AF=AE[AD];if(AF.children[1].value==0){AG+=AF.right;}else{if(AF.children[1].value==1){AH+=AF.right;}}}return AH*1000+AG;},children:[g("browse",1,mstrmojo.desc(1825,"Browse")),g("read",4,mstrmojo.desc(8078,"Read")),g("write",8,mstrmojo.desc(8079,"Write")),g("delete",16,mstrmojo.desc(629,"Delete")),g("control",32,mstrmojo.desc(8080,"Control")),g("use",64,mstrmojo.desc(8081,"Use")),g("execute",128,mstrmojo.desc(8082,"Execute")),{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(AC){var AD=this.parent.parent;if(AD.onOK){AD.onOK();}AD.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(AC){var AD=this.parent.parent;if(AD.onCancel){AD.onCancel();}AD.close();}}]}]},children:[{scriptClass:"mstrmojo.Box",alias:"topSection",cssClass:"sharingEditor-topSection",bindings:{visible:function(){return AB(this.parent.oi)&&this.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.HBox",alias:"tabDock",cssClass:"sharingEditor-tabDock",bindings:{visible:function(){return AB(this.parent.parent.oi)&&this.parent.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.Label",alias:"showLink",text:mstrmojo.desc(9773,"Link"),cssClass:"SharingEditor-ShowLink",selected:false,onclick:function(AC){var AD=this.parent.parent.parent;if(!this.selected){AD.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}},},{scriptClass:"mstrmojo.Label",alias:"libraryLink",text:mstrmojo.desc(15572,"Library link"),cssClass:"SharingEditor-libraryLink",selected:false,onclick:function(AC){var AD=this.parent.parent.parent;if(!this.selected){AD.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}},bindings:{visible:function(){return D(this.parent.parent.parent.oi.t,this.parent.parent.parent.href);}}},{scriptClass:"mstrmojo.Label",cssClass:"SharingEditor-ShowHtml",alias:"htmlCode",text:mstrmojo.desc(9774,"Show HTML"),selected:false,onclick:function(AC){var AD=this.parent.parent.parent;if(!this.selected){AD.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}}}]},{scriptClass:"mstrmojo.Box",alias:"htmlPanel",cssClass:"mstrmojo-SharingEditor-html-panel",children:[{scriptClass:"mstrmojo.HBox",alias:"htmlLinkRow",cssClass:"SharingEditor-LinkRow",children:[{scriptClass:"mstrmojo.TextBox",alias:"htmlBox",cssClass:"SharingEditor-Html"},{scriptClass:"mstrmojo.Button",alias:"copyHtmlLink",cssClass:"SharingEditor-CopyHtmlLink",onclick:function(AC){var AD=this.parent.htmlBox.inputNode;M(AD);},bindings:{visible:"this.parent.parent.parent.tabDock.htmlCode.selected"}}]},{scriptClass:"mstrmojo.Label",alias:"IframeSize",text:mstrmojo.desc(9735,"Size:"),cssClass:"SharingEditor-Html-Size"},{scriptClass:"mstrmojo.TextBoxWithLabel",alias:"widthInput",label:mstrmojo.desc(272,"Width:"),value:640,onvalueChange:function(AC){var AD=this.parent,AE=mstrmojo.all[Y];AD.htmlLinkRow.htmlBox.set("value",S.call(AD,AE.url,true));}},{scriptClass:"mstrmojo.TextBoxWithLabel",label:mstrmojo.desc(271,"Height:"),alias:"heightInput",value:480,onvalueChange:function(){var AC=this.parent,AD=mstrmojo.all[Y];AC.htmlLinkRow.htmlBox.set("value",S.call(AC,AD.url,true));}},{scriptClass:"mstrmojo.HBox",alias:"toolbarOptions",cssClass:"SharingEditor-toolbarRow",children:[{scriptClass:"mstrmojo.Label",alias:"IframeShow",text:mstrmojo.desc(15341,"Show:"),cssClass:"SharingEditor-Html-Show"},{scriptClass:"mstrmojo.CheckListHoriz",alias:"checkBoxList",items:[{n:mstrmojo.desc(8145,"Navigation bar"),alias:"path"},{n:mstrmojo.desc(2509,"Toolbar"),alias:"dockTop"},{n:mstrmojo.desc(8146,"Tools panel"),alias:"dockLeft"},{n:mstrmojo.desc(8147,"Footer"),alias:"footer"}],multiSelect:true,onselectionChange:function(AC){var AD=this.parent.parent,AE=mstrmojo.all[Y];AD.htmlLinkRow.htmlBox.set("value",S.call(AD,AE.url,true));}}]}],bindings:{visible:"this.parent.tabDock.htmlCode.selected"}},{scriptClass:"mstrmojo.HBox",alias:"authorLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"authorLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"authorCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(AC){var AD=this.parent.authorLinkBox.inputNode;M(AD);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"libraryLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"libraryCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(AC){var AD=this.parent.libraryLinkBox.inputNode;M(AD);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLaunchButtons",cssClass:"SharingEditor-LaunchButtons",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-launchLink" style="{@cssText}" mstrAttach:click>'+mstrmojo.desc(15334,"Launch")+' <iframe name="launchToIframe" target="_blank" style="display:none"></iframe> </div>',alias:"launchLink",onclick:function(){var AC=this.parent.parent.parent;t.createTokenAndOpenLink(AC.libraryUrl);},bindings:{visible:function(){return this.parent.parent.tabDock.libraryLink.selected&&this.parent.parent.parent.oi.t==55;}}},{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"libraryEmailLink",onclick:function(){var AC=this.parent.parent.parent;if(!AC.libraryUrl){t.constructLibraryUrl(AC.objectId);}else{a(AC,AC.libraryUrl);}}}]},{scriptClass:"mstrmojo.HBox",alias:"authorEmail",cssClass:"SharingEditor-LaunchButtons email",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"emailLink",onclick:function(){var AC=this.parent.parent.parent;if(!AC.url||AC.isLinkDirty){J.call(AC,true);AC.set("isLinkDirty",false);}else{a(AC,AC.url);}}}]}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9775,"Who Has Access"),cssClass:"SharingEditor-title",bindings:{visible:"this.parent.showACL"}},{scriptClass:"mstrmojo.Label",alias:"userMessage",text:mstrmojo.desc(9771,"The permission you added is already granted"),cssClass:"sharingEditorUserMessage hideMsg",bindings:{visible:"this.parent.showACL"},onclick:function(){E.addClass(this.domNode,"hideMsg");z=false;}},{scriptClass:"mstrmojo.Box",cssClass:"sharingEditor-ACLUserPanel",bindings:{visible:"this.parent.showACL"},children:[{scriptClass:"mstrmojo.HBox",cssClass:"sharingEditor-CPSection",children:[{scriptClass:"mstrmojo.ACL.AddUserInputBox",emptyText:mstrmojo.desc(15335,"Type to add users or groups here..."),getACLUserDataService:function m(){return this.parent.parent.parent.getACLUserDataService();},noCache:true,postCreate:function(){var AC=this.parent.parent.parent;if(AC){this.zIndex=AC.zIndex+1;}},onRender:function(){var AC=this.parent.parent.parent;if(AC){AC.objectInputer=this;}},bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}}},u(mstrmojo.desc(1825,"Browse"),function(AC){var AD=this.parent.parent.parent;AD.openPopup("userSelector",{zIndex:AD.zIndex+10});},{bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}}})]}]},{scriptClass:"mstrmojo.HBox",alias:"publicAccessSection",cssClass:"sharingEditor-publicAccessSection",bindings:{visible:"this.parent.showACL && this.parent.showPublisAccess"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"publicLabel",cssClass:"SharingEditor-Public",bindings:{label:function(){if(this.parent.parent.guestModeEnabled){return mstrmojo.desc(9776,"Public (Login not required)");}return mstrmojo.desc(9777,"Everyone (Login not required)");},enabled:function(){return Q(this.parent.parent.oi);}},oncheckedChange:function(){E.toggleClass(this.domNode.children[1],"label-disabled",!this.checked);},getUserGroupsInfo:function(){if(h){this.getUserGroupFromTaskCall(X);}this.getUserGroupFromTaskCall(I);},getUserGroupFromTaskCall:function(AI){var AE=mstrmojo.all[Y],AF=AE.aclList,AG=AE.getACLUserDataService(),AH=function(AK){var AJ=new mstrmojo.Obj({n:AK.n,did:AK.did,st:AK.st,rgt:w,newItem:true});j.push(AJ);},AD=function(AJ){},AC=function(){if(!h||(h&&j.length==2)){AF.add(j);AE.set("hasChanged",true);}};AG.getMembers({blockBegin:0,blockCount:1,outputElements:1,data:{did:AI}},{success:AH,failure:AD,complete:AC});},onclick:function(){var AD=mstrmojo.all[Y];var AE=AD.aclList.items;var AF=q.find(AE,"did",I);if(AF!==-1){AE.remove(AF);}var AC=q.find(AE,"did",X);if(h&&AC!==-1){AE.remove(AC);}if(this.checked===true){if(j.length<1){this.getUserGroupsInfo();}else{mstrmojo.array.forEach(j,function(AG){AG.rgt=w;});AE.add(j);AD.set("hasChanged",true);}}else{AD.set("currentPublicRight",w);AD.set("hasChanged",true);}}},{scriptClass:"mstrmojo.MouseOverContainer",alias:"publicMouseOver",setupSelectedItem:function A(){this.mouseoverItem=this.publicRight;this.mouseoutItem=this.publicRightLabel;},bindings:{visible:"this.parent.publicLabel.checked",enabled:function(){return Q(this.parent.parent.oi);}},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return L(this.parent.parent.parent.currentPublicRight);}}},{scriptClass:"mstrmojo.Label",alias:"publicRightLabel",cssClass:"sharingEditor-rightLabel",bindings:{text:function(){var AC=this.parent.parent.parent;return e.call(AC,AC.currentPublicRight);},enabled:function(){return Q(this.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-pulldown",itemIdField:"rgt",alias:"publicRight",visible:false,postCreate:function(){this.items=this.parent.parent.parent.getAvailableRightsForSelection();},bindings:{value:"this.parent.parent.parent.currentPublicRight",enabled:function(){return Q(this.parent.parent.parent.oi);}},selectionPolicy:"reselect",onvalueChange:function(){var AC=this.parent;var AD=AC.parent.parent;AC.publicRightLabel.set("text",e.call(AD,this.value));},_set_value:function(AH,AD){var AE=this.value,AC=(AE!==AD);if(AC){if(AD===-1){var AG=this.parent.parent.parent,AF=this;AG.openPopup("customACL",{zIndex:AG.zIndex+10,rgt:AE,twoStates:true,onOK:function(){AF.set("value",this.getACLValue());},onCancel:function(){AF.set("value",AE);}});return false;}AD=K(AD);R(this,AD);this.updatePublicRight(AD);return true;}return true;},updatePublicRight:function(AD){var AE=this.parent.parent.parent;if(AE.aclList){var AF=AE.aclList.items;var AC=q.find(AF,"did",X);var AG=q.find(AF,"did",I);if(h&&AC!==-1){AF[AC].rgt=AD;}if(AG!==-1){AF[AG].rgt=AD;}AE.set("hasChanged",true);AE.set("currentPublicRight",AD);}}}]}]},{scriptClass:"mstrmojo.DataGrid",alias:"aclList",cssClass:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",itemIdField:"did",dropZone:true,bindings:{items:function(){return this.parent.oi.acls||[];},visible:"this.parent.showACL"},onremove:function(AD){var AH=this.parent.oi;var AG=this;window.setTimeout(function(){AG.updateScrollbars();},10);if(!V(AH)){return ;}var AI=AH.inhs,AF=AD.value,AC=AF&&AF.length,AJ,AE;for(AE=0;AE<AC;AE++){AJ=AF[AE].n;delete AI[AJ];}},onadd:function(AD){var AH=this.parent.oi;var AG=this;window.setTimeout(function(){AG.updateScrollbars();},10);if(!V(AH)){return ;}var AI=AH.inhs,AF=AD.value,AC=AF&&AF.length,AJ,AE;for(AE=0;AE<AC;AE++){AJ=AF[AE].n;AI[AJ]=mstrmojo.hash.copy(AF[AE]);AI[AJ].inh=true;}},onACLChanged:function(AD){var AC=this.parent.oi;this.parent.set("hasChanged",true);if(!V(AC)){return ;}if(this.parent.childrenAccessPulldown.value==1){AC.inhs[AD.n]=mstrmojo.hash.copy(AD);AC.inhs[AD.n].inh=true;}},columns:[{dataFunction:function(AE,AC,AD){return'<div class="mstrmojo-ACLEditor-user '+(AE.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(AE.n)+"</div>";}},{dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",alias:"mouseOverContainer",bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}},setupSelectedItem:function A(){this.mouseoverItem=this.dataGridPulldown;this.mouseoutItem=this.dataGridLabel;},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return L(this.parent.parent.data.rgt);}}},{scriptClass:"mstrmojo.Label",cssClass:"sharingEditor-rightLabel",alias:"dataGridLabel",bindings:{text:function(){return e.call(mstrmojo.all[Y],this.parent.parent.data.rgt);},enabled:function(){return Q(this.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.HBox",alias:"dataGridPulldown",cssClass:"sharingEditor-datagridContainer",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-datagridPulldown",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",popupZIndex:1001,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var AC=this.parent.parent.data;this.set("value",AC[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(AH,AD){var AE=this.value,AC=(AE!==AD);if(AC){if(AD===-1){var AG=this.parent.parent.dataGrid.parent,AF=this;AG.openPopup("customACL",{zIndex:AG.zIndex+10,rgt:AE,twoStates:!!this.parent.parent.data.newItem,onOK:function(){AF.set("value",this.getACLValue());},onCancel:function(){AF.set("value",AE);}});return false;}AD=N(AD);R(this,AD);this.parent.parent.data.set(this.itemIdField,AD);if(AE!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;},bindings:{enabled:function(){return Q(this.parent.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(AC){var AD=this,AE=function(){var AF=AD.parent.parent.dataGrid;AF.remove(AD.parent.parent.data);AF.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:AE}},{zIndex:2000});},bindings:{enabled:function(){return Q(this.parent.parent.parent.parent.parent.oi);}}}]}]}}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9892,"Children Access"),cssClass:"SharingEditor-title",bindings:{visible:function(){return this.parent.showACL&&V(this.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",alias:"childrenAccessPulldown",value:0,items:[{n:mstrmojo.desc(9890,"Preserve children's access control lists"),idx:0},{n:mstrmojo.desc(9891,"Overwrite children's access control lists"),idx:1}],itemIdField:"idx",bindings:{visible:function(){return this.parent.showACL&&V(this.parent.oi);}}},{scriptClass:"mstrmojo.HBox",cssClass:"Editor-buttonBox",slot:"buttonNode",bindings:{visible:"this.parent.showButtonBar"},children:[l(mstrmojo.desc(8473,"Done"),function(AC){var AD=this.parent.parent;if(p(AD)){o(AD,AD.closeEditorAfterSave);}},true,{iconClass:"mstrmojo-Editor-button-OK",bindings:{visible:"this.parent.parent.showACL",enabled:function(){return Q(this.parent.parent.oi)&&this.parent.parent.hasChanged;},text:function(){return mstrmojo.desc(8473,"Done");}},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}}),l("",function(AC){var AD=this.parent.parent;AD.close();AD.set("hasChanged",false);},false,{iconClass:"mstrmojo-Editor-button-Close",bindings:{iconClass:function(){var AC=this.parent.parent;if(AC.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){return mstrmojo.desc(2140,"Cancel");}}})]}]});mstrmojo.ACL.AddUserInputBox=mstrmojo.declare(mstrmojo.ACL.UserInputBox,null,{scriptClass:"mstrmojo.ACL.AddUserInputBox",add:function G(AD,AC){var AE=this.parent.parent.parent;this._super(AD,AC);p(AE);},});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.List","mstrmojo.ui.LayoutBox","mstrmojo.ui.Splitter","mstrmojo.Refine.RefineFacetPanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineHistoryList");mstrmojo.Refine.RefinePanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.Refine.RefinePanel",alias:"refinePanel",cssClass:"refine-panal",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel refine-transformation-panal"></div><div class="mstrmojo-SplitterHandle refine-panal-middle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',setDimensions:function B(G,E){var C=parseInt(G,10);var F=parseInt(E,10);if(isNaN(C)||isNaN(F)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var D=Math.max(F,980);this.layoutConfig.w.firstSplitNode=D+"px";this.layoutConfig.w.resizeHandleNode=D+"px";this.layoutConfig.w.secondSplitNode=D+"px";if(this._super){this._super(C+"px",F+"px");}},postBuildRendering:function A(){this.setDimensions("0px","0px");this.setDimensions(this.parent.refinePanelNode.style.height,this.parent.refinePanelNode.style.width);if(this._super){this._super();}},handleSampleStatusChanged:function(){var C=this.bottomPanal.splitter.facetPanel;if(C&&C.hasRendered){C.resetAllFacets();}C.updateEngine(false);},config:{firstSplit:{v:"150px",min:"100px",max:undefined},secondSplit:{v:"100%",min:"100px",max:undefined},resizeHandle:{v:"2px"}},orientation:1,children:[{slot:"firstSplitNode",alias:"topPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-top",setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=C+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",(E-22)+"px");}}},{slot:"secondSplitNode",alias:"bottomPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-bottom",children:[{alias:"splitter",scriptClass:"mstrmojo.ui.Splitter",orientation:1,draggable:false,config:{firstSplit:{v:"100%"},secondSplit:{v:"127px"},resizeHandle:{v:"11px"}},children:[{slot:"secondSplitNode",alias:"facetPanel",scriptClass:"mstrmojo.Refine.RefineFacetPanel"}]}],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);var G=(!!mstrApp.isWorkstation)&&(C>0)?3:28;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=(C-G)+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",E+"px");}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.qb.QBMappings");mstrmojo.requiresDescs(12735);var D="firstSplitNode",C="secondSplitNode";function F(M,J,H){if(M.ignoreLayout){return ;}var I=(J==="auto")||J==="NaNpx",L=(H==="auto")||H==="NaNpx";var K=M.getLayoutOffsets&&M.getLayoutOffsets();if(K){if(!I){J=(parseInt(J,10)-K.h)+"px";}if(!L){H=(parseInt(H,10)-K.w)+"px";}}if(M.setDimensions){M.setDimensions(J,H);}else{if(M.set){if(!I){M.set("height",J);}if(!L){M.set("width",H);}}}}mstrmojo.qb.QBPageLayout=mstrmojo.declare(mstrmojo.ui.Splitter,null,{cssClass:"mstrmojo-qb-whole-panel",workPanel:null,whPanel:null,config:{firstSplit:{v:"20%",min:"300px",max:undefined},secondSplit:{v:"80%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},afterLayout:function B(){var I=parseInt(this.whPanel.width,10);var H=parseInt(this.width,10);if(I<300){F(this.whPanel,this.height,"300px");F(this.workPanel,this.height,(H-300-2)+"px");this.setSlotDimensions(D,this.height,"300px");this.setSlotDimensions(C,this.height,(H-300-2)+"px");}},getLayoutOffsets:function G(){return{w:36,h:0};},toggleDatabaseView:function A(H){this.toggleFirstItemVisibility(H);},toggleDataPreview:function E(H){this.workPanel.toggleSecondItemVisibility(H);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",slot:D,alias:"whPanel",config:{firstSplit:{v:"40%",min:"100px"},secondSplit:{v:"60%",min:"100px"},resizeHandle:{v:"1px"}}},{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",alias:"workPanel",slot:C,orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function G(){return{h:0,w:12};},children:[{scriptClass:"mstrmojo.qb.QBPanel",slot:D},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",slot:C}],config:{firstSplit:{v:"50%",min:"150px",max:undefined},secondSplit:{v:"50%",min:"150px",max:undefined},resizeHandle:{v:"5px"}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBMappings","mstrmojo.DI.DIPreviewGrid");var A=mstrmojo.DI.DIConstants,C=mstrmojo.string;mstrmojo.DI.DIPreviewSimpleGrid=mstrmojo.declare(mstrmojo.qb.QBMappings,null,{scriptClass:"mstrmojo.DI.DIPreviewSimpleGrid",cssClass:"lockHeader mstrmojo-di-mappingpreview",cssText:"position:relative;overflow:hidden;border:0px solid lightGrey;border-width:1px;border-bottom-right-radius:6px;border-bottom-left-radius:6px;padding:0px;",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.DI.DIPreviewGrid",alias:"content",columns:[],cssText:"overflow:hidden;",banding:false}],populate:function B(M){var I=mstrApp.getRootController(),D=I.model,F=D.importSources,E=M.data,H,G,K,J,L;H=F[E].currentMapping;G=F[E].currentPreview.data;K=this.content;J=M.selectedColumns;L=(H&&H.length>0);K.mappings=H;K.dataset=G;K.selectedColumns=J;if(G[0][0]===""){I.displayError(mstrmojo.desc(14862,"We can't find any result for '####' in Twitter.").replace("####",C.encodeHtmlString(this.parent.parent.searchText)),false);mstrApp.getRootController().enableFinishButton(false);}else{K.set("visible",L);}if(L){K.populatePreview();}else{I.raiseModelEvent({name:A.dataEvents.NO_DATA_RETURNED_EVENT});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditBox","mstrmojo.warehouse._CanToggleAvatarClass");var U=mstrmojo.array,I=mstrmojo.string,X=mstrmojo.css,V=mstrmojo.dom,Q="visible",Z=["(",")","{","}","-","+","*","/","<",">","=","|","~",","," ","\t","\n",";"],Y=null,A=mstrmojo.warehouse.EnumObjectTypes,L=A.TABLE,O=A.COLUMN;function M(b){var a;if(!Y){Y={};for(a=0;a<Z.length;a++){Y[Z[a]]=true;}}return Y[b];}mstrmojo.architect.ui.SQLInputBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[mstrmojo.warehouse._CanToggleAvatarClass],{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox",dropZone:true,allowDrop:function B(b){var c=[].concat(b.src.data)[0],a=mstrApp.rootController.model;if(!c){return false;}if(!((c.tp===O)||(c.tp===L))){return false;}return(a.SelDBRoleID===a.projPrimaryDBRoleID);},ondrop:function S(c){var e=this,d=[].concat(c.src.data)[0],b=this.inputBox.items,g=function g(h){b=[{v:"select"}];b.push({v:String.fromCharCode(10)});U.forEach(h,function(j){b.push({v:j.cln});b.push({v:", "});});b.pop();b.push({v:String.fromCharCode(10)});b.push({v:"from"});b.push({v:String.fromCharCode(10)});b.push({v:d.n});e.inputBox.set("items",b);e.parent.execSQL.onclick({cancel:mstrmojo.emptyFn});e.inputBox.focus();};if(!d){return ;}this.inputBox.set("items",[]);switch(d.tp){case O:b.push({v:d.cln});this.inputBox.set("items",b);break;case L:var a=(c.src.widget.alias==="dbTableTree");if(a){mstrApp.rootController.getColumnsForDBTable({data:d},{success:function f(h){g(h.items);}});}else{mstrApp.rootController.model.getAttributesFactsInTable(d.did,{success:function f(){g(mstrApp.rootController.model.getTable(d.did).columns);}});}break;}},postBuildRendering:function R(){if(this._super){this._super();}this.onheightChange({value:this.height});this.onwidthChange({value:this.width});this.reset();},onheightChange:function G(b){var c=this.inputBox,a=b.value;if(c.hasRendered&&a!==undefined){c.height=a;c.domNode.style.height=a;c.editNode.style.height=a;}},onwidthChange:function J(a){var c=this.inputBox,b=a.value;if(c.hasRendered&&b!==undefined){c.width=b;c.editNode.style.width=b;}},tables:[],columns:[],sqlFunctions:[{n:"Select"},{n:"Update"},{n:"Insert"},{n:"Delete"},{n:"Create"},{n:"Drop"},{n:"Alter"},{n:"Set"},{n:"Exec"},{n:"From"},{n:"Where"},{n:"Having"},{n:"In"},{n:"Group"},{n:"By"},{n:"Order"},{n:"Into"},{n:"On"},{n:"Values"},{n:"Table"},{n:"Case"},{n:"Then"},{n:"Else"},{n:"Join"},{n:"As"}],getSQLStatement:function E(){var a=[];U.forEach(this.inputBox.items,function(b){a.push(b.v);});return I.trim(a.join("").replace(/<\s/g,"<").replace(/>\s/g,">"));},setSQLStatement:function H(g){var d=[],c,e="\n",a=", ",f=g.split(e),b;U.forEach(f,function(h){c=I.trim(h);if(c.indexOf(a)>0){b=c.split(a);U.forEach(b,function(j){d.push({v:I.trim(j)});d.push({v:a});});d.pop();}else{d.push({v:c});}d.push({v:e});});this.inputBox.set("items",d);},onvisibleChange:function N(){X.toggleClass(this.domNode,Q,this.visible);X.toggleClass(this.inputBox.domNode,Q,this.visible);},reset:function W(){var a={items:this.sqlFunctions.concat(this.tables).concat(this.columns),isComplete:true};this.inputBox.set("candidates",a);this.inputBox.set("items",[]);},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",cssClass:"mstrmojo-ar-sqlInput-tokenbox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,lastPagePos:{left:0,top:0,width:0,height:0},lastScrollPos:{left:0,top:0,width:0,height:0},breakOnEnterKeyDown:function P(){return !this.suggestionShown;},getCharacter:function C(b){var a=(V.isIE&&!V.isIE9)?b.keyCode:b.charCode;return(a>0)?((a===13)?"\n":String.fromCharCode(a)):null;},ondrop:function(a){this.parent.ondrop(a);},ondragenter:function K(a){this.parent.ondragenter(a);},allowDrop:function B(a){return this.parent.allowDrop(a);},item2textCss:function F(a){return{15:" mstrmojo-ArchitectListIconSuggest t15 ",26:" mstrmojo-ArchitectListIconSuggest t26 "}[a.tp||a.t]||"";},itemFunction:function D(b){return new mstrmojo.ME.MetricToken({data:b,brackets:function(c){return c;},isDelimiter:function a(){var c=this.data,d=c.v.length;if(c){return c.isDelimiter||(d===1&&M(c.v));}return false;}});},isDelimiter:M}]});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui.tabs.Tab","mstrmojo.Label","mstrmojo.Button","mstrmojo.Pulldown","mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.tooltip","mstrmojo.ME.MetricEditBox","mstrmojo.array","mstrmojo.hash","mstrmojo.mstr.EnumDSSXMLBaseFormType");var f=mstrmojo.array,N=mstrmojo.hash,M=mstrmojo.ME.MetricToken.brackets,B=mstrmojo.css,S=mstrmojo.vi.ui.tabs.Tab.ACTIONS,n=S.DELETE+S.RENAME,o=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,p=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_CSS,O=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_DESC,W=mstrmojo.mstr.EnumDSSXMLObjectTypes,D=mstrmojo.string,t="This@ID",Y="45C11FA478E745FEA08D781CEA190FE5",V=mstrmojo.mstr.EnumDSSXMLBaseFormType,w=[{n:mstrmojo.desc(959,"Default"),v:V.DssXmlBaseFormReserved},{n:mstrmojo.desc(12276,"String"),v:V.DssXmlBaseFormText},{n:mstrmojo.desc(2052,"Date"),v:V.DssXmlBaseFormDate},{n:mstrmojo.desc(3434,"Number"),v:V.DssXmlBaseFormNumber}],Z=function(){var AB="analytical_engine_version.htm",AA=mstrApp.showHelpTopic;if(AA){AA(AB,"upgrade");}else{window.open(mstrmojo.upgradeHelpPath()+AB,"_blank");}};function H(AA){return{n:AA,k:AA,ftk:[],vs:1,is:"",bft:V.DssXmlBaseFormReserved,bftp:V.DssXmlBaseFormReserved};}function Q(AG,AH,AA,AE){var AC=AG.forms[AH]||{},AF=AG.forms[AA],AB=AG.inputBox,AD=AG.statusBox.pulldownBox.pulldown;if(AH!==AA){AC.vs=AG.vStatus;AC.is=AG.iStatus;AC.bft=AG.formType||AD.getSelectedItem().v;AC.bftp=AG.formType||AD.getSelectedItem().v;AC.ftk=AB.items;AG.set("vStatus",o.UNKNOWN);}AG.set("vStatus",AF.vs);AG.set("iStatus",AF.is);AG.updateInputBoxItems({items:AF.ftk});if(AG.curFormIdx!==AA){AG.curFormIdx=AA;AG.tabstrip.setSelectedTab(AF.k);}AD.set("selectedIndex",f.find(AD.items,"v",AF.bft));AG.raiseEvent({name:"tabSwitch",tks:AF.ftk,vs:AF.vs,is:AF.is,bft:AF.bft,bftp:AF.bftp,oidx:AH,nidx:AA,toNewTab:AE});}function P(AB){var AA=AB.forms[AB.curFormIdx];if(AA){AA.ftk=AB.inputBox.items;AA.vs=AB.vStatus;AA.is=AB.iStatus;}}var m=0;function c(AA){m=Math.max(AA.length-1,m);}function b(){m=0;}function u(AA){var AB="DESC"+(m?" "+m:"");m++;if(f.find(AA,"n",AB)>=0){return u(AA);}return AB;}function J(AD){var AC={v:M(AD.n),oi:AD,isNew:true},AB,AA;if(AD.t===12){AB=f.filter(AD.fs,function(AE){return AE.obf||AD.da;}).length;if(AB===1){AA=AD.fs[0];AC=N.copy({v:M(AD.n)+"@"+M(AA.fnm),ift:true,exv:AA.fid,extp:8},AC);}else{AC=N.copy({v:M(AD.n)+"@",ift:true},AC);}}return AC;}function E(AB,AA){AB.set("enabled",!AA);var AC="mstrmojo-InlineWaitIcon";if(AB.iconClass){AB.set("iconClass",AB.iconClass.replace(new RegExp(AC),"")+" "+(AA?AC:""));}else{mstrmojo.css.toggleClass(AB.domNode,AC,AA);}}function L(AA){return AA.tp===33||AA.tp===37;}function F(AA){return AA.tp===-1;}var a=function(AG){var AE=AG.items,AB=AE.length,AD,AF,AC=[],AA="";AC.push({v:"!",tp:33,lv:4,sta:2});for(AD=0;AD<AB;AD++){AF=AE[AD];if((AD===0&&L(AF))||F(AF)){continue;}if(AF.isNew&&!AF.oi){AA+=AF.v;}else{if(!D.isEmpty(AA)){AC.push({v:AA,tp:2,lv:1});AA="";}if(AF.v&&AF.v.indexOf(t)>=0){AF.v=AF.v.replace("["+t+"]",t);AF.exv=Y;AF.extp=8;delete AF.oi;}AC.push(AF);}}if(!D.isEmpty(AA)){AC.push({v:AA,tp:2,lv:1});AA="";}AC.push({v:"",tp:-1,lv:4,sta:2});return{items:AC};},g=function(AC){var AA=AC.items||[],AB=AA[AA.length-1];if(AB&&AB.tp===-1){AA.pop();}if(AA[0]&&L(AA[0])){AA.splice(0,1);}f.forEach(AA,function(AD){if(AD.v&&AD.v.indexOf(t)>=0){N.copy({extp:8,exv:Y,oi:{n:"This",did:"This",t:12}},AD);}});},e=function(AA){if(!AA){return o.VALID;}return{"-2147214845":o.ERROR,"-2147214846":o.AMBIGUITY}[AA]||o.ERROR;},U=function(AC){AC=a(AC);var AB={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true,vtp:true},AA={getArrItemName:function(){return"tkn";},isSerializable:function(AD){return(AB[AD])?true:false;}};return D.json2xml("tknstrm",AC,AA);},G=function(AC,AF,AE,AB){var AD=U(AF),AG=function(AH){if(AH&&AH.tks){var AI=AH.tks;g(AI);AI.vs=e(AI.rjec);AI.tokenXML=AD;if(AB){AB(AI);}}},AA=function(AH){mstrmojo.alert(AH.message||AH.getResponseHeader&&AH.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:AD,localSymbolFolderXML:"",metricXML:"",metricId:AC||"",isNew:true,objectType:12,isIDForm:AE,msgID:mstrApp.getMsgID()},{success:AG,failure:AA});};mstrmojo.ME.DerivedAttributeFormTab=mstrmojo.declare(mstrmojo.vi.ui.tabs.Tab,null,{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",valid:true,editable:true,postBuildRendering:function X(){if(this._super){this._super();}var AA=this,AB=AA.lbl;AB.editOnDoubleClick=this.editable;AB.onTextEditComplete=function(AD,AC){if(AA.validate(AB.text)){AA.titleEdited(AB.text,AC);}};},onclick:function l(AA){var AB=mstrmojo.dom.eventTarget(AA.hWin,AA.e);if(AB===this.menuBtnNode){this.tabDeleted();}else{if(!this.isSelected){this.tabSelected();}}},validate:function(AA){var AB=!/[\[\]\"\\]/g.test(AA);if(!AB){this.lbl.set("isEditing",true);}this.set("valid",AB);return AB;},showErrTooltip:function z(AE,AC){var AA=mstrmojo.dom.position(this.domNode),AB=this,AD=AB.errTooltip;if(!AD){AB.errTooltip=AD=new mstrmojo.Tooltip({contentNodeCssClass:"me-tooltip-content up me-err",updatePopupConfig:null});this.addDisposable(AD);}AD.set("top",AA.y+AA.h+2);AD.set("left",AA.x+AA.w/2-AC);AD.set("content",'<div class="content"><span>'+AE+"</span></div>");AD.open();window.setTimeout(function(){AD.close();},2500);},onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.showErrTooltip(mstrmojo.desc(11569,"Input contains invalid character"),95);}}});function k(AD,AE,AF){var AC=f.find(AE,"k",AF.k);return{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",title:AF.n,draggable:false,editable:AC!==0,cssClass:"mstrmojo-AEB-Tab "+(AC===0?"mstrmojo-AEB-IDTab":""),getMenuActions:function(){return n;},tabSelected:function(){Q(AD,AD.curFormIdx,AC);},titleEdited:function AB(AH,AG){if(AH!==AG){if(f.find(AD.forms,"n",AH)>=0){this.showErrTooltip(mstrmojo.desc(7209,"Name already exists"),69);}else{var AI=AD.forms[AC];AI.n=AH;AD.set("dirty",true);}}},tabDeleted:function AA(){var AG=AD.forms.length,AJ=(AD.curFormIdx===AG-1)?0:AD.curFormIdx,AH=AD.forms.slice(0),AI=AH[AC];if(AI&&AI.did){AD.delForms.push({n:AI.n,did:AI.did});}AH.splice(AC,1);AD.curFormIdx=AJ;AD.set("forms",AH);Q(AD,-1,AJ);AD.set("dirty",true);}};}mstrmojo.ME.AttributeEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,null,{scriptClass:"mstrmojo.ME.AttributeEditBox",markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-AEB-TabStrip"></div><div class="mstrmojo-MEBox-edit mstrmojo-AEB-edit"></div><div class="mstrmojo-AEBox-status {@statusCssClass}"></div></div>',markupSlots:{tabstripNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},statusNode:function(){return this.domNode.lastChild;}},markupMethods:{onvStatusChange:function(){var AB=this.vStatus,AF=(AB===o.VALID),AD=(AB===o.UNKNOWN||AB===o.VALIDATING),AC=this.statusBox.infoBox;this.validateBtn.set("visible",AD);AC.set("visible",!AD);if(!AD){AC.infoLabel.set("text",AF?mstrmojo.desc(11655,"Valid formula."):mstrmojo.desc(15953,"Validation failed."));var AE=p[AB],AA=AC.infoIcon.domNode;if(!B.hasClass(AE)){B.removeClass(AA,[p[o.VALID],p[o.ERROR],p[o.AMBIGUITY]]);B.addClass(AA,AE);}}},oniStatusChange:function(){var AC=this.vStatus,AA=(AC===o.ERROR||AC===o.AMBIGUITY),AB=this.statusBox.infoBox.infoIcon;AB.title=AA?(this.getStatusDesc&&this.getStatusDesc(AC))||O[AC]+" "+this.iStatus:"";}},forms:null,delForms:[],curFormIdx:0,attrid:null,absorbAmbiguity:false,init:function q(AD){var AE=this,AG=function(){AE.validateCurrentForm();},AC=[{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",alias:"tabstrip",position:"top",slot:"tabstripNode",isAlignRight:false,getTabCfg:function AB(AJ,AK,AI){return N.copy(k(AE,AJ,AK),AI);},addTab:function AH(){var AK=AE.forms,AI=AK.length,AL=u(AK),AJ=AK.slice(0);AJ.push(H(AL));AE.set("forms",AJ);Q(AE,AE.curFormIdx,AI,true);AE.set("dirty",true);},clear:function AA(){f.forEach(this.children,function(AI){AI.hideTooltip();});}},{scriptClass:"mstrmojo.Button",alias:"clearBtn",slot:"tabstripNode",text:mstrmojo.desc(2827,"Clear"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll hoverLink",onclick:function(){AE.inputBox.clearTokens([]);AE.inputBox.raiseChangeEvent({type:"clear"});}},{scriptClass:"mstrmojo.Box",alias:"statusBox",slot:"statusNode",cssClass:"statusBox",children:[{scriptClass:"mstrmojo.Box",alias:"pulldownBox",cssClass:"pulldownBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-AEBox-pulldownLabel AEBox-item",text:mstrmojo.desc(9918,"Data Type")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"pulldown",cssClass:"mstrmojo-AEBox-pulldown AEBox-item",selectedIndex:0,items:w,onitemSelected:function(AL){var AI=AE.curFormIdx,AJ=AE.forms,AK=AJ&&AJ.length>AI&&AJ[AI];if(AK){if(AK.bft!==AL.v){AK.bft=AK.bftp=AL.v;AE.set("dirty",true);}}}}]},{scriptClass:"mstrmojo.Box",cssClass:"helpIcon",cssDisplay:"inline-block",richTooltip:{cssClass:"vi-regular vi-tooltip-A A-center AE-tooltip",posType:mstrmojo.tooltip.POS_TOPCENTER,enableHover:true},useRichTooltip:true,tooltipCloseDelay:500,updateTooltipConfig:function AF(){var AJ=this.richTooltip,AI=mstrmojo.dom.position(this.domNode);AJ.left=AI.x+AI.w-8;AJ.top=AI.y+28;AJ.content=mstrmojo.desc(16313,"Data Type options for derived attribute forms are only available for data engine version 11.1 and later.");AJ.content+="<br /><div class='help-link-label' onclick='mstrmojo.ME.AttributeEditBox.AEHelpFn()'>"+mstrmojo.desc(9849,"Learn More")+"</div>";}},{scriptClass:"mstrmojo.Box",alias:"infoBox",cssClass:"infoBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Button",alias:"infoIcon",cssClass:"mstrmojo-AEBox-infoIcon AEBox-item",title:"",tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AI=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AI.y+26,0),left:Math.max(AI.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title};}},{scriptClass:"mstrmojo.Label",alias:"infoLabel",cssClass:"mstrmojo-AEBox-infoLabel AEBox-item"}]}]}];this.validateFunc=AG;AE.children=AC.concat(this.children);this._super(AD);},item2textCss:function K(AA){return this._super(AA)||{21:"afm"}[AA.t]||"";},onformsChange:function d(){var AA=this.forms,AB=AA[this.curFormIdx].k;f.forEach(AA,function(AC){g({items:AC.ftk});});this.tabstrip.setTabs(AA,AB);c(AA);},selectFormTab:function A(AA){Q(this,this.curFormIdx,AA);},postBuildRendering:function X(){if(this._super){this._super();}this.clear();var AA=this;this.inputBox.ondrop=function(AE){if(!AE.src.data||!AE.src.data.item){return ;}var AD=AA.inputBox,AG=AD.ctxtBuilder.itemWidgets,AH=N.copyProps(["did","n","t","fs"],AE.src.data.item),AJ=J(AH),AB,AI,AC;AE.src.data=AJ;mstrmojo.ListBase2.prototype.ondrop.call(this,AE);var AF=function(AK){return AK.t===W.Function&&!(!isNaN(AK.fdid)&&AK.fdid<0);};if(AF(AJ.oi)){this.insertParenthesisTokens();}if(AA.ontokensModify){AA.ontokensModify();}AB=this.selectedIndices;if(AH.t===12&&AJ.ift&&!AJ.exv){for(AI in AB){AC=AG[AI];if(AC){AD.startTokenSuggestion(AC);}}}AD.clearSelect(true);B.removeClass(AD.domNode,"unselectable");};},clear:function j(){this.curFormIdx=0;this.delForms=[];this.attrid=null;b();this.set("forms",[H("ID")]);this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",o.UNKNOWN);this.set("iStatus","");this.tabstrip.clear();},validateCurrentForm:function C(AB){var AC=this,AD=this.validateBtn,AA=function(AE){E(AD,false);AC.set("vStatus",AE.vs);AC.set("iStatus",AE.rjed||"");AC.updateInputBoxItems({items:AE.items});AC.statusNode.style.display="block";AC.handleValidation(AE);if(AB){AB(AE.items,AE.vs===o.VALID);}};AC.set("vStatus",o.VALIDATING);E(AD,true);G(this.attrid,{items:this.inputBox.items},AC.curFormIdx===0,AA);},validateAllForms:function x(AC){var AD=this,AB=AD.forms,AA=0,AE=function(AH){var AG=(AA===0);if(AH){var AF=AB[AA-1];AF.ftk=AH.items;AF.vs=AH.vs;AF.is=AH.rjed||"";AF.tokenXML=U({items:AH.items});if(AH.vs!==o.VALID){AD.selectFormTab(AA-1);AD.handleValidation(AH);if(AC){AC(null,false);}return ;}}if(AA===AB.length){if(AC){AC(AB,true);}return ;}G(AD.attrid,{items:AB[AA++].ftk},AG,AE);};P(AD);AE();},continueValidataion:function R(){this.validateCurrentForm();},getStatusDesc:function h(AA){return{0:mstrmojo.desc(11655,"Valid Formula.")}[AA];},onObjectInsert:function I(AD){var AE=this.inputBox,AC=J(AD),AA=AE.insertTokens([AC]),AB;if(AD.t===12&&AC.ift&&!AC.exv){AB=AE.ctxtBuilder.itemWidgets[AA];if(AB){AE.startTokenSuggestion(AB);}}}});mstrmojo.ME.AttributeEditBox.preprocessTokenStream=g;mstrmojo.ME.AttributeEditBox.postprocessTokenStream=a;mstrmojo.ME.AttributeEditBox.mapErrorCode=e;mstrmojo.ME.AttributeEditBox.getTokenStreamXML=U;mstrmojo.ME.AttributeEditBox.validateSyntax=G;mstrmojo.ME.AttributeEditBox.prepareInsertToken=J;mstrmojo.ME.AttributeEditBox.AEHelpFn=Z;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.PassThroughOptions");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249,15656);var p=mstrmojo.array,F=mstrmojo.string,w=mstrmojo.mstr.EnumDataType,A=mstrmojo.ME.MetricDataService,u=mstrmojo.mstr.EnumDSSXMLObjectTypes,W=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,H=mstrmojo.hash;function V(AD){var AA=AD.items,S=AA.length,AC="",AB;for(AB=0;AB<S;AB++){AC+=AA[AB].v;}return AC;}var L=mstrmojo.dom,E=mstrmojo.string,R=mstrmojo._FormatDefinition,o=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,C=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var Y=function(S){if(!S){return o.VALID;}return{"-2147214845":o.ERROR,"-2147214846":o.AMBIGUITY}[S]||o.ERROR;},X=function(AG){var AD=AG.items,AA=AD.length,AF=AD[AD.length-1],AC,AE,AB=[],S="";if(AD[0]&&AD[0].tp!==38){AB.push({v:"&",tp:38,lv:4,sta:2});}for(AC=0,AA=AD.length;AC<AA;AC++){AE=AD[AC];if(AE.isNew&&!AE.oi&&AE.tp!==283){S+=AE.v;}else{if(!E.isEmpty(S)){AB.push({v:S,tp:2,lv:1});S="";}AB.push(AE);}}if(!E.isEmpty(S)){AB.push({v:S,tp:2,lv:1});S="";}if(AF&&AF.tp!==-1){AB.push({v:"",tp:-1,lv:4,sta:2});}return{items:AB};},P=function(AB){var AC=X(AB.tks);var AA={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},S={getArrItemName:function(AF,AD,AE){return"tkn";},isSerializable:function(AF,AE,AD){return(AA[AF])?true:false;}};return E.json2xml("tknstrm",AC,S);},n=function(AC){var AA=AC.items,S=AA.length,AB=AA[AA.length-1];if(AB&&AB.tp===-1){AA.pop();}if(AA[0]&&AA[0].tp===38){AA.splice(0,1);}},q=function(S){return"";},l=function(S,AB){var AA=[];S.oi.tks.items=AA;AB.clearTokens(AA);},M=function(AE,AD){var AC=[];AC.push("<mt>");if(AE.fmt&&!AD){var S={getArrItemName:function(AH,AF,AG){return AH.substr(0,AH.length-1);},isSerializable:function(AM,AK,AJ){if(mstrmojo.array.indexOf(["header_format","grid_format"],AM)>-1){var AN=AK[AJ][AM];if(!AN){return{};}var AH="<"+AM+">",AL;for(AL in AN){AH+="<prs n='"+AL+"'>";var AG=AN[AL],AF;for(AF in AG){var AI=AG[AF];AH+="<pr n='"+AF+"' v='"+(AI==="pru"?"":AI)+"'";AH+=AI==="pru"?' pru="1"':"";AH+="/>";}AH+="</prs>";}AH+="</"+AM+">";return{child:AH};}return true;},skipNull:true};AC.push(E.json2xml("fmt",AE.fmt,S));}if(AE.prss&&!AD){var AB={getArrItemName:function(AH,AF,AG){return AH.substr(0,AH.length-1);},isSerializable:function(AM,AJ,AH){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],AM)>-1){var AI=AJ[AH][AM];if(!AI){return{};}var AG=[],AK=[],AL;AG.push("<prs n='"+AM+"' ");for(AL in AI){var AF=AI[AL];if(AF!=null){if(typeof AF==="object"){AK.push(E.json2xml("pr",AF,{skipNull:true,convertBoolean:true,isSerializable:function(AP,AO,AN){return true;}}));}else{AG.push(AL+"='"+AF+"' ");}}}AG.push(">");AG.push(AK.join(""));AG.push("</prs>");return{child:AG.join("")};}return true;},skipNull:true};AC.push(E.json2xml("prss",AE.prss,AB));}if(AE.mps){AC.push(E.json2xml("mps",AE.mps,{skipNull:true,convertBoolean:true,isSerializable:function(AH,AG,AF){return true;}}));}if(AE.datp&&!AD){AC.push(E.json2xml("datp",AE.datp,{skipNull:true,convertBoolean:true,isSerializable:function(AH,AG,AF){return true;}}));}if(AE.sbs&&!AD){var AA={getArrItemName:function(AH,AF,AG){return(AH==="avs")?"sb":AH.substr(0,AH.length-1);},isSerializable:function(AH,AG,AF){return true;},skipNull:true};AC.push(E.json2xml("sbs",AE.sbs,AA));}AC.push("</mt>");return AC.join("");},G=function(AA,S){AA.set("enabled",!S);var AB="mstrmojo-InlineWaitIcon";if(AA.iconClass){AA.set("iconClass",AA.iconClass.replace(new RegExp(AB),"")+" "+(S?AB:""));}else{mstrmojo.css.toggleClass(AA.domNode,AB,S);}},I=function(AA,S){var AB={taskId:"saveMetricDefinition",tokenStreamXML:P(AA),localSymbolFolderXML:q(AA),metricXML:M(AA),metricId:AA.did||"",outputFlags:327695,description:AA.desc||"",name:AA.n||"",saveAs:S};if(E.isEmpty(AA.metricId)){AB.isNew=true;}return AB;},O=function(AB){var AA=function(AC){var AE=this.parent;var AD=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(AE){AE.ob.refreshContent();AE.onObjectSaved({name:AE.name,did:AC.did,desc:AE.desc});AD=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",AE.typeDesc||"Object").replace("###",AE.name);}mstrmojo.alert(AD,AB.onSaved,mstrmojo.desc(7984,"Object Saved"));if(AE){AE.close();}AB.dirty=false;},S={success:AA,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return S;},K=function K(AG){var AC=AG.items,S;for(var AB=0;AB<AC.length;AB++){var AH=AC[AB];if(AH&&AH.oi&&A.hasLookupForAttributesProps(AH.oi.did)){var AF=AC[AB+1];if(AF.v==="<"){var AD=false;for(var AE=AB+2;AE<AC.length&&AC[AE].v!==">";AE++){var AA=AC[AE];if(AA&&AA.v==="UseLookupForAttributes"){AD=true;break;}}if(!AD){S=AB+2;AC.splice(S,0,{v:"UseLookupForAttributes"},{v:"="},{v:"False"},{v:","});AB=AB+5;}}else{S=AB+1;AC.splice(S,0,{v:"<"},{v:"UseLookupForAttributes"},{v:"="},{v:"False"},{v:">"});AB=AB+5;}}}},N=function(AG,AD){var AB=this;G(AB,true);var AH=mstrmojo.ME._MetricEditorHelper.oi=AG.oi,AC=P(AH),AE=q(AH),AF=M(AH,true),AI=function(AL){if(AL&&AL.tks){var AM=AL.tks;n(AM);var AK=AM.items;if(mstrApp&&mstrApp.isVI){AH.conditions=[];var AJ=mstrApp&&mstrApp.getRootController().docCtrl.model;p.forEach(AK,function(AP){var AQ=AP.oi,AR=AQ&&AQ.t,AN=AQ&&AQ.st,AO=AQ&&AQ.did;if(AR===u.Filter&&AN===W.Filter){var AS=AJ.getEmbeddedFilter(AO);if(AS){AQ.isEmbedded=true;AH.conditions.push(AS);}}});}AH.tks=AM;if(AG.clientSideValidation){AG.clientSideValidation(AM);}AG.checkEditorFallback(AG.ide.candidates.items,AH);AM.vs=Y(AM.rjec);AG.set("vStatus",AM.vs);AG.set("iStatus",AM.rjed||"");if(AG.handleValidation){AG.handleValidation(AM);}if(AD&&(AM.vs===o.VALID)){K(AM);switch(AD){case"save":case"saveAs":if(AG.isDME){AG.handleDerivedMetricAction(AD,AH);}else{AG.handleMetricAction(AD,AH);}break;case"switch":if(AG.cbSwtichEditor){AG.cbSwtichEditor(AG);}break;}}else{if(AD&&AM.vs===o.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},AA=function(AJ){mstrmojo.alert(AJ.message||AJ.getResponseHeader("X-MSTR-TaskFailureMsg"));},S=function(AJ){G(AB,false);};A.validateMetric({tokenStreamXML:AC,localSymbolFolderXML:AE,metricXML:AF,metricId:AH.did,isNew:E.isEmpty(AH.did),msgID:AG.ide.isDME?mstrApp.getMsgID():null},{success:AI,failure:AA,complete:S});},D=function(AA,AC){var AD=AC,S=AD.oi.fmt,AB=R.MetricFormatTarget;G(AA,true);window.setTimeout(function(){if(!S){S=AD.oi.fmt={};var AE;for(AE=0;AE<AB.length;AE++){S[AB[AE].p]={};}}var AF=L.position(AA.domNode,true);AD.openPopup("formatPopupRef",{zIndex:AD.zIndex+10,model:S,left:Math.max(0,(AF.x-(AD.formatPopupRef.width||565)))+"px",top:AF.y+"px"});G(AA,false);},50);},j=function(AB,AC){var AD=AC,S=AD.oi,AA=function(){var AE=L.position(AB.domNode,true);AD.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:AD.zIndex+10,model:S,funcs:AD.funcs,left:Math.max(0,(AE.x-(AD.optionPopupRef.width||565)))+"px",top:AE.y+"px"});};if(!AD.isDME&&!AD.funcs){G(AB,true);A.getSubtotalFunctions(null,{success:function(AE){if(AE.items){AD.funcs=AE.items;AA();G(AB,false);}},failure:function(AE){mstrmojo.alert(AE.message||AE.getResponseHeader("X-MSTR-TaskFailureMsg"));G(AB,false);}});}else{AA();}},x=function(AA,AB){var AD=L.position(AA.domNode,true),AC=H.any(AB.ide.datasets),S={zIndex:AB.zIndex+10,left:Math.max(0,(AD.x-(AB.ptoPopupRef.width||333)+AD.w/2))+"px",top:AD.y+"px",mptf:AB.mptf||_getMptfFromDataset(AB),dbt:AC.tables[0].dbt,so_dft:AC.so_dft,sim_dft:AC.sim_dft,onOK:function(AF){AB.mptf=AF;var AE=_getMptfFromDataset(AB);if(!H.equals(AE,AF)){AF.dirty=true;}}};AB.openPopup("ptoPopupRef",S);};_getMptfFromDataset=function(AB){var S=mstrApp&&mstrApp.getRootController().docCtrl.model,AD=AB.oi.did,AC=S.findUnitInDataSet(AD),AA;if(AC){AA=H.clone(AC.mptf);}else{AA={mptso:{pru:1,v:0},mptsim:{pru:1,v:0},mptfms:""};}return AA;};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(S){if(S.value==false){return ;}var AA=this;if(!AA.tmr){AA.tmr=window.setInterval(function(){if(AA.domNode){window.clearInterval(AA.tmr);delete AA.tmr;AA.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function z(){var AA=L.position(this.domNode),S=E.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+S+"</span></div>",top:AA.y-5,left:AA.x+AA.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var S=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var AA=this.parent.parent.ide||{},S=AA.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):S;}},onvalueChange:function(AB){var S=this.parent.parent.ide.action.alias,AF=function(AG){return !E.isEmpty(AG)&&(S?true:!/[\[\]\"\\]/g.test(AG));},AE=AF(this.value);if(AE){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!AE);var AC=this.parent.parent;AC.set("cValid",AE);var AD=AC.oi;if(AD){var AA={n:AD.n,alias:AD.alias};AD.n=this.value;AD.alias=this.value;if(AD.n!==AA.n&&AD.alias!==AA.alias){AC.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(AB){var AA=this.opener,S=AA&&AA.oi;if(AA&&S){S.did=AB.did;S.n=AB.name;S.desc=AB.desc;AA.set("title",mstrmojo.desc(2154,"Metric:")+" "+AB.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},ptoPopupRef:{scriptClass:"mstrmojo.PassThroughOptions",help:"create_derived_metric_mdx_hierarchy_reports.htm",width:333},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var S=this.getEditor();return(S.ide&&S.ide.formulaEditorId)||"mstrME";},onclick:function(){var AB=this.getEditor(),AA=this.getFormulaEditorId();AB.oi.tks.items=AB.getMetricDefAsTokens();var S={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:AB.oi,did:AB.oi.did,cValid:true};if(AB.dirty){S.dirty=AB.dirty;}if(AB.mptf){S.mptf=AB.mptf;}AB.switch2Editor(AA,S);if(AB.ide){AB.ide.set("showLeftPanel",true);AB.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){D(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&!S.ide.disableAFB;}},onclick:function(){j(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"ptoButton",text:mstrmojo.desc(15656,"Pass-through Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&S.ide.enablePTO&&(S.id===((S.ide&&S.ide.formulaEditorId)||"mstrME"));}},onclick:function(){x(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var AA=this.parent.parent;if(!AA.insertMode&&AA.isDirty&&!AA.isDirty()){AA.close();AA.onCancel();return ;}if(!AA.cValid){return ;}if(AA.insertMode){AA.insertOnFinish(AA.getMetricDefAsTokens());AA.close();}else{if(AA.getMetricDefAsTokens){AA.oi.tks.items=AA.getMetricDefAsTokens();}var S=this;if(AA.validateAndSave){G(S,true);AA.validateAndSave(AA.oi,function(){G(S,false);});}else{if(AA.ide&&AA.ide.validateAndSave){G(S,true);AA.ide.validateAndSave(AA.oi,function(){G(S,false);});}else{AA.tbValidate=this;N.call(this,AA,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var S=this.parent.parent;if(S.getMetricDefAsTokens){S.oi.tks.items=S.getMetricDefAsTokens();}S.tbValidate=this;N.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var S=this.parent.parent;if(S.onPreClose()){S.close();if(!S.insertMode){S.onCancel();}}}}]},validateSyntax:function B(S){N.call(S,this);},validateSyntaxAndSwitch:function c(S){N.call(S,this,"switch");},preprocessTokenStram:function U(S){n(S);},isDirty:function k(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty||(this.mptf||{}).dirty;},onmetricModify:function h(){this.dirty=true;},save:function Q(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+mstrmojo.string.encodeHtmlString(this.parent.opener.oi.n)+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var S=this.parent.parent;S.opener.save();S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var S=this.parent.parent;S.opener.close();if(S.opener.onCancel){S.opener.onCancel();}S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var S=this.parent.parent;S.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function f(AB,AA){var S=this;var AC=I(AA,false);if((AB==="save")&&AA.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,O(S),AC);}else{if(((AB==="save")&&E.isEmpty(AA.did))||AB==="saveAs"){AC.saveAs=true;S.openPopup("saveasRef",{zIndex:S.zIndex+10,folderLinksContextId:17,name:AA.n||AA.name||(S.name&&S.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:AC,saveAsCallback:function(){var AD=O(S);if(AD.success){var AE=AD.success;AD.success=function(AF){AE.call(this,AF);if(S.ide.noRefresh!==true){var AG=mstrApp;mstrmojo.form.send({evt:5005,src:AG.name+"."+AG.pageName+".5005"});}};}return AD;}});}}},handleDerivedMetricAction:function g(AD,AC){AC=AC||this.oi;if(AD==="save"){var S={tokenStreamXML:P(AC),alias:AC.n};var AA=AC.mps||{};if(AA.dirty){if(AA.fbf===0){AA.afb=AA.sfb=-1;}S.afb=AA.afb;S.sfb=AA.sfb;}if(this.originTks){S.originTokenStream=P({tks:{items:this.originTks}});S.originAfb=this.originAfb;S.originSfb=this.originSfb;}var AE=mstrmojo.all.mstrMetricIDE,AB=AE.disableAFB;if(AB){S.afb=0;S.sfb=1;}if((this.mptf||{}).dirty){S.mptf=this.mptf;}AE.onApplyMetricCallback(S);AE.close();}},onPreClose:function(){var S=this;if(S.isDirty&&S.isDirty()&&!this.isDME){S.prompt2save();return false;}return true;},onClose:function a(){this.dirty=false;delete this.mptf;if(this.onPostClose){this.onPostClose();}},init:function t(AB){if(this._super){this._super(AB);}var AC=mstrApp,S=AC&&AC.useQuickSearch&&AC.useQuickSearch(),AA=S?((AC&&AC.searchAutoCompleteDelay&&AC.searchAutoCompleteDelay())||0):0;this.suggestDelay=AA||200;this.noCache=this.noCache&&S&&!this.isDME;this.ob.children[0].quickSearch=S;A.suggestDelay=this.suggestDelay;A.noCache=this.noCache;},_setupCandidatesCache:function m(S){if(this.candidates&&S){S.candidates=null;S.set("candidates",this.candidates);}},item2textCss:function J(S){return"mstrmojo-ME-icon t"+S.t+(S.st?" st"+S.st:(S.um||S.da?"d":""));},getSpecialFunctionEditorId:function e(S,AC){var AB=S&&S.did,AA;if(AB){if(A.isBasicAggMap(AB)){AA="mstrSME";}else{if(A.isRank(AB)){AA="mstrRFE";}else{if(A.isOLAPAgg(AB)){AA="mstrOFE";}else{AA="mstrFE";}}}if(AA){AA+=AC?"_1":"";}}return AA;},isDimty:function(AA,S){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(F.trim(AA));},validateByDataType:function d(AA,S){var AB=false;switch(AA){case w.DataTypeInteger:AB=/^(-)?\d+$/.test(S);break;case w.DataTypeNumeric:case w.DataTypeReal:case w.DataTypeDouble:AB=mstrmojo.num.isNumeric(S);break;case w.DataTypeChar:case w.DataTypeVarChar:AB=true;break;case w.DataTypeDate:case w.DataTypeTimeStamp:AB=true;break;default:AB=true;}return AB;},getRootFunction:function b(AB){var AA,S=AB&&AB.tks&&AB.tks.met;if(S!==C.ADVANCED){var AC=AB.tks.items[0];AA=AC&&AC.oi;}return AA;},checkEditorFallback:function Z(S,AC){var AA=this.getRootFunction(AC),AB=mstrmojo.array.find(S,"did",AA&&AA.did)===-1;if(AB&&AC&&AC.tks&&AC.tks.items&&AC.tks.items.length>0){AC.tks.met=C.ADVANCED;}return AB;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=P;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.qb.FFsqlInput");var H=mstrmojo.array,G=mstrmojo.hash;function C(J,K){var I=K?"\n":"",L;for(L=0;L<J;++L){I+=" ";}return I;}mstrmojo.qb.FFsqlEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",children:[{scriptClass:"mstrmojo.Box",alias:"passlabel",cssClass:"mstrmojo-qb-ffsqlview-passlabel",bindings:{visible:function(){return this.children&&this.children.length;}}},{scriptClass:"mstrmojo.qb.FFsqlInput",alias:"ffsql",cssClass:"mstrmojo-qb-ffsqlview-editnode",id:"FFsql",txt:"",dropZone:true,onwidthChange:function B(){if(this.hasRendered){this.parent.updatepasses();}},onheightChange:function E(){if(this.hasRendered){this.parent.updatepasses();}},updateSQL:function D(I){if(!this.candidates){this.set("candidates",{items:this.sqlTokens.concat(mstrApp.getRootController().getSuggestionItems(true)),isComplete:true});}this.clearTokens();this.txt=I.value;this.clipboardNode.value=I.keepFormat?this.txt:this.formatSQL(this.txt);this.handlepaste();if(I.value===""){this.parent.updatepasses();}this.oriSQL=this.getSQLstmt();},formatSQL:function A(P){var N,L=false,J=C(2,false),Q=C(1,false),M="\n",O=C(9,true),K=C(10,true),I=false;N=P.replace(/,/g," ,").replace(/;/g," ;").replace(/\n/g," ").replace(/ +/g," ").split(" ");H.forEach(N,function(S,R){switch(S){case"from":case"having":N[R]="\n"+N[R]+J;break;case"group":if(N[R+1]==="by"){N[R]="\n"+N[R]+Q;}break;case"where":N[R]=M+N[R];break;case"join":case"outer":if(L){break;}case"full":case"left":case"right":N[R]=K+N[R];L=true;break;case",":if(!I){N[R]=N[R]+O;}break;case"on":N[R]=K+N[R];L=false;break;case";":N[R]=N[R]+"\n";break;case"in":I=true;break;default:if(I&&S.length>=1&&S[S.length-1]===")"){I=false;}break;}});return N.join(" ").replace(/ ,/g,",");}}],onwidthChange:function B(I){var L=this.ffsql,K=L.domNode,J;J=Math.max((parseInt(I.value,10)-((this.passlabel.children&&this.passlabel.children.length)?10:0)),0)+"px";L.set("width",J);if(K){K.style.width=J;}},updatepasses:function F(){var L,N=this.ffsql,M=[],K={scriptClass:"mstrmojo.Button"},I=this.domNode.clientHeight,J=this.passlabel;L=N.getPassLabelYCoords();H.forEach(L,function(P,O){if(P>=0&&P<=I){M.push(G.copy(K,{cssText:["top:",P,"px;"].join(""),cssClass:(N.pnum===O?"error":"")}));}});J.removeChildren(null,true);J.addChildren(M,0,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DateTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.DI.DICalendar","mstrmojo.css");mstrmojo.requiresDescs(13128,13129,13130);var I=mstrmojo.css,N=mstrmojo.date,G=mstrmojo.array,L=G.removeIndices,E=7;var B=["MM/DD/YYYY","today","yesterday"],F=/^\d+daysAgo$/;function K(){var Q=this._lastOpened;if(Q&&Q.visible){var P=this.calendar.leftCal;var O=this.calendar.rightCal;P.updateView(P.currentView);O.updateView(O.currentView);}}function H(R,O,P){var Q=N.getFirstDateOfMonth(R,O);return(Q.getDay()-P+8)%E;}function M(P,O){return(N.compareDate(P,O)>0);}function C(Q,O){var P=" disabled";I.toggleClass(Q.iconNode,P,Q.disabled);I.toggleClass(Q.inputNode,P,Q.disabled);}var J="MM/DD/YYYY",D="MM/dd/yyyy";mstrmojo.DI.DIDateTextBox=mstrmojo.declare(mstrmojo.DateTextBox,null,{scriptClass:"mstrmojo.DI.DIDateTextBox",fromDate:"",toDate:"",disabled:false,cssClass:"mstrmjo-di-DateTextBox",calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,max:N.getDateJson(new Date("9999-12-31")),slot:"popupNode",onOpen:function(){var U=this.opener,S=U&&U.calendarZIndex,Q=this.leftCal,R=this.rightCal,O=U&&U.calConfig,P;if(S){this.domNode.style.zIndex=S;}for(P in O){Q.set(P,O[P]);R.set(P,O[P]);}},onvisibleChange:function(){var R=this.visible,P=this.opener.iconNode,Q=this.opener.inputNode,O=" selected";P.className="mstrmojo-DateTextBox-icon";Q.className="mstrmojo-DateTextBox-input";I.toggleClass(P,O,R);I.toggleClass(Q,O,R);},getLeftCalendar:function(){return this.children[0];},getRightCalendar:function(){return this.children[1];},removeSelection:function(P){var S=this.leftCal.selectedDates.length>0?this.leftCal:this.rightCal;if(S.selectedDates.length>0){var Q=S.dayView.getElementsByTagName("div"),U=S.selectedDates,O=U[P],R=H(O.year,O.month,S.firstDayOfWeek);I.removeClass(Q[R+O.day-1],["selected"]);L(U,P,1);}},children:[{scriptClass:"mstrmojo.DI.DICalendar",cssClass:"mstrmojo-di-calendar mstrmojo-Calendar-left",alias:"leftCal",max:N.getDateJson(new Date("9999-12-31")),bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var P=this.parent.opener.dtp,O=this.parent.opener.changeValueOnOK;return P===15||P===16||O;}}},{scriptClass:"mstrmojo.DI.DICalendar",cssClass:"mstrmojo-di-calendar mstrmojo-Calendar-right",alias:"rightCal",max:N.getDateJson(new Date("9999-12-31")),bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var P=this.parent.opener.dtp,O=this.parent.opener.changeValueOnOK;return P===15||P===16||O;}}}]},onclick:function(){this.calendarHandler();},onfocus:function(){this.calendarHandler();},updateValue:function(){if(!this.disabled){var Q=mstrmojo.locales.datetime;J=Q.DATEOUTPUTFORMAT.toUpperCase();if(this.value===""||this.value===J){this.value=J;return ;}var O=N.getDateJson(new Date(N.formatDateInfo(N.parseDate(this.value)||{},D)));if(mstrmojo.array.indexOf(B,this.value)!==-1||F.test(this.value)){return ;}else{if(M(O,this.calendar.max)){var P=new Date();this.value=P.getMonth()+1+"/"+P.getDate()+"/"+P.getFullYear();}else{if(!mstrmojo.date.doesDateExist(O.month,O.day,O.year)){J=Q.DATEOUTPUTFORMAT.toUpperCase();mstrApp.getRootController().displayError(mstrmojo.desc(13128,"Requests can only specify a date formatted as ###, ").replace("###",J)+mstrmojo.desc(13129,"or as a relative date (e.g., today, yesterday, or NdaysAgo where N is a positive integer). ")+mstrmojo.desc(13130,"Please change your input into any of the aforementioned formats."),false);}else{this.value=N.formatDateInfo(O,mstrmojo.locales.datetime.DATEOUTPUTFORMAT);this.inputNode.value=N.formatDateInfo(O,mstrmojo.locales.datetime.DATEOUTPUTFORMAT);}}}}},onblur:function(){this.updateValue();},onkeyup:function A(O){O.e.which=O.e.which||O.e.keyCode;if(O.e.which===13){this.inputNode.blur();}},calendarHandler:function(){if(!this.disabled){if(this.value===J){this.set("value","");}var O=this._lastOpened,P=this._calendarConfig;this.fromDate=this.parent.fromDate;this.toDate=this.parent.toDate;if(!P){P={};if(this.calendarToBody){delete this.calendar.slot;P.placeholder=document.body.appendChild(document.createElement("div"));P.nudge=function(){var S=this.opener;if(S){var R=mstrmojo.dom.position(S.popupNode,true),Q=this.domNode.style;Q.left=R.x+"px";Q.top=R.y+"px";}};}this._calendarConfig=P;}if(O&&O.visible){this.closePopup();}else{this.openPopup("calendar",P);}}},onfromDateChange:function(){K.call(this);},ontoDateChange:function(){K.call(this);},onvalueChange:function(){K.call(this.parent.fromDate);K.call(this.parent.toDate);if(!this.hasFocus){this.updateValue();}},ondisabledChange:function(O){this.inputNode.disabled=O.value;var P=mstrmojo.locales.datetime;if(O.value===true&&this.inputNode.value!==""){this.set("value",P.DATEOUTPUTFORMAT.toUpperCase()||J);}C(this);},postBuildRendering:function(){if(this._super){this._super();}if(mstrmojo.dom.isIE){this.inputNode.style.lineHeight="23px";}this.inputNode.disabled=this.disabled;if(this.disabled){C(this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DateTextBox");mstrmojo.DI.DIDateTextBox2=mstrmojo.declare(mstrmojo.DateTextBox,null,{scriptClass:"mstrmojo.DI.DIDateTextBox2",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',disabled:false,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var D=this.opener,C=D&&D.calendarZIndex,E=this.cal,A=D&&D.calConfig;if(C){this.domNode.style.zIndex=C;}for(var B in A){E.set(B,A[B]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",duration:0,forceNonEmptySelection:true,bindings:{dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",changeValueOnOK:function(){var B=this.parent.opener.dtp,A=this.parent.opener.changeValueOnOK;return B===15||B===16||A;}},onValueUpdate:function(B){var D=this.parent&&this.parent.opener;if(D){var C=D.value,A=window.mstrConfig&&window.mstrConfig.listSep||";";if(D.isList&&!_S.isEmpty(C)){D.set("value",D.value+A+this.value);}else{D.set("value",this.value);}}}}]},onclick:function(A){if(this.disabled===true){return ;}if(this._super){this._super();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.Arr","mstrmojo.AjaxCall","mstrmojo.css","mstrmojo.Calendar","mstrmojo.WidgetDial","mstrmojo.Label","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.registry","mstrmojo.string","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox","mstrmojo.mstr.EnumDataType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSConsolidationType");var u=mstrmojo.array,AK=u.map,J=mstrmojo.Arr,E=mstrmojo.css,V=mstrmojo.dom,W=mstrmojo.hash,AL=mstrmojo.string,A=mstrmojo.registry,U=mstrmojo.expr,O=U.ET,h=mstrmojo.mstr.EnumDataType,l=U.ET2TP,X=U.ET2TGT,AH=U.DTP,D=mstrmojo.meta.TP,P=mstrmojo.meta.STP,AR=mstrmojo.mstr.EnumDSSXMLObjectTypes,AD=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,G=mstrmojo.mstr.EnumDSSConsolidationType;var f="dummy",K={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:f,css:"unselectable",cls:"temp"},q={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:f,css:"unselectable",cls:"temp"},C={did:"idAttribute",v:"idAttribute",n:mstrmojo.desc(518,"Attribute"),t:f,css:"unselectable"},AF={did:"idMetric",v:"idMetric",n:mstrmojo.desc(517,"Metric"),t:f,css:"unselectable"},AE={did:"idSelect",v:"idSelect",n:mstrmojo.desc(547,"Select"),t:f,css:"unselectable"},z={did:"idWait",v:"idQualification",n:mstrmojo.desc(5225,"Qualification"),t:f,css:"unselectable"},B={did:"idWait",v:"idQualification",n:mstrmojo.desc(15008,"Qualify on"),t:f,css:"unselectable"};var AQ={};AQ[AH.DATE]=1;AQ[AH.TIME]=1;AQ[AH.TIMESTAMP]=1;var AA={};AA[O.MQ]={key:"metricFns",def:U.METRIC_FNS};AA[O.MC]={key:"metricFns",def:U.METRIC_FNS};AA[O.AQ]={key:"formFns",def:U.FORM_FNS};AA[O.AL]={key:"formFns",def:U.FORM_FNS};AA[O.AC]={key:"formFns",def:U.FORM_FNS};AA[O.AE]={key:"elemFns",def:U.ELEM_FNS};var S=[U.STP.PROMPT,U.STP.PROMPT_OBJECTS,U.STP.PROMPT_ELEMENTS,U.STP.PROMPT_EXPRESSION,U.STP.PROMPT_EXPRESSION_DRAFT];function Z(AS){if(AS&&AS.t===AR.Consolidation&&AS.st===AD.ConsolidationManaged){return true;}return false;}function F(AU,AW,AT){var AV=AU.items,AS=u.indexOf(AV,AW);if((AS===0)&&(AV.length===1)){AT=mstrmojo.Arr.makeObservable((AT&&AT.length)?AT.concat():[]);AU.set("items",AT);}else{if(AS>-1){AV.splice(AS,1);}if(AT&&AT.length){u.insert(AV,(AS>-1)?AS:AV.length,AT);}AU.refresh();}}function b(Aa,AZ){if(this.updating){return ;}var AS=this.multiSelect,AU=this.selectedItem,AX=Aa&&Aa.added,AW=Aa&&Aa.removed;AZ=AZ||this.alias;if(!AS&&AX&&AW&&AX[0]===AW[0]){return ;}if(AU&&AU[D]===f){this.updating=true;if(AS){this.removeSelect([this.selectedIndex]);}else{var AY=AW&&Number(AW[0]);AY=(AY==null)?-1:AY;this.set("selectedIndex",AY);}this.updating=false;}else{var AT=this.parent.parent.parent.model;if(AS){var AV=this.items;AT.edit(AZ,{added:AX&&u.get(AV,AX),removed:AW&&u.get(AV,AW),itemIdField:this.itemIdField});}else{AT.edit(AZ,AU);}}}function R(AS,AU,AV){if(this.updating){return ;}AV=AV||this.alias;var AT=AS.model;AT.edit(AV,AU);}function w(){var AT=this.parent,AS=((AT&&AT.cssText)||"").match(/height:\s*(\d*)px/);this.cssText=AS&&AS[0];}function N(AS){return mstrmojo.mixin(AS,{scriptClass:"mstrmojo.rw.ConditionList",cssClass:"mstrmojo-"+AS.alias,postCreate:w});}function Y(){var AT=this.parent,AS=AT.parent;AS["invalid"+AT.cstIndex]=false;}function n(AU,AS,AV){var AT=AU.cfg;if(AT){AT.data=AU;AT.parent=AV;return A.ref(AT);}AT=new mstrmojo.Label({text:AU.n||"&nbsp;",cssClass:"dial-item "+(AU.t?("t"+AU.t):"")});AT.markupMethods.onselectedChange=function(){E.toggleClass(this.domNode,["selected"],this.selected);};AT.data=AU;AT.parent=AV;return AT;}function AC(AS){switch(AS){case h.DataTypeInteger:case h.DataTypeUnsigned:case h.DataTypeDecimal:case h.DataTypeReal:case h.DataTypeDouble:case h.DataTypeFloat:case h.DataTypeCellFormatData:return h.DataTypeNumeric;default:return AS;}}function H(AU,AT){var AS=AU.model||{},AV=AS.fn;return(AV!=null)&&((AS.et===O.MQ)||(AS.et===O.MC)||(AS.et===O.AQ)||(AS.et===O.AL)||(AS.et===O.AC))&&(U.fnCstCount(AV,AS.fnt)>AT);}function p(AT){var AW=AT&&l[AT.et],AV=AT&&AT.fm&&AT.fm.dtp,AS=AV&&U.DTP2PROMPT_STP[AV],AU={};AU[AW]=true;if(AS){AU[AS]=true;}return AU;}function AN(AS,AU){var AT;if(AU){switch(X[AS.et]){case"a":AT=AU[O.AC];break;case"m":AT=AU[O.MC];break;default:AT=false;break;}}else{AT=true;}return AT&&U.fn_AC_MC(AS&&AS.fn);}function k(AS){var AV=AS.model,AZ=AV&&AV[X[AV.et]]&&AV[X[AV.et]][AS.columnWalk.target.itemIdField||"did"],AU=AV&&AV.fm,Ab=AU&&AU.dtp,AT=AN(AV,AS.ets);if(this.targetsLastMod&&this.targetsLastMod===AS.targetsLastMod&&AZ&&AZ===this._lastTargetId&&this.lastFmDtp===Ab&&this.lastFnTp===AT){return ;}if(!AT){this.clearSelect();if(this.items.length!==this.preLen){this.set("items",this.items.slice(0,this.preLen));}}else{var AX=AV.a?[C]:AV.m?[AF]:[],AW=e(AS),Aa=AX.concat(AW),AY=this.items.slice(this.preLen);u.forEach(AY.reverse(),function(Ac){this.remove(Ac);},this);this.add(Aa,-1);}this._lastTargetId=AZ;this.lastFnTp=AT;this.lastFmDtp=Ab;this.targetsLastMod=AS.targetsLastMod;}function e(AS){var AT=AS.model,AU=p(AT),AV=AT[X[AT.et]];return U.getSortedObjectsByTypeGroup(u.filter(AS.targets,function(AW){return(AW.t!==4||AW.did!==AV.did)&&(AU[AW[D]]||AU[AW[P]]);}));}function a(AT,AS){var AU=AT.model||{},AV=AU.cs,AW=AV&&AV[AS];if(AU.et==O.MC&&AU["c"+(AS+2)]){AW=AU["c"+(AS+2)];}return AW;}function I(AS,AV){var AU=AS.model||{},AT;switch(AU.et){case O.MC:case O.MQ:AT=(AV&&AV.dtp)||AC(AU.m.dt)||U.METRIC_DTP;if(AT===AH.BIGDECIMAL){AT=U.METRIC_DTP;}break;case O.AQ:case O.AC:case O.AE:case O.AL:AT=AU.fm&&AU.fm.dtp;break;}return AT||AH.CHAR;}function AP(AT,AU){if(!AT){return AT;}if(AT.dtp===AH.BIGDECIMAL&&AU===O.MQ){var AS=String(AT.v);if(AS&&AS.indexOf("#")===-1){return"#"+AS+"#";}else{return AS;}}else{return AT.v;}}function AB(AT,AS){var AV=AT.model||{},AW=AV.cs,AX,AU;if(AV.et===O.AL){AU=[];u.forEach(AW,function(AY){AU.push(AY&&AY.v);});AU=AU.join(mstrConfig.listSep);}else{AX=a(AT,AS);AU=AP(AX,AV.et);}return AU;}function L(Am,Ae){Am.updating=true;var Aa=Am.parent.parent.parent,Al=H(Aa,Ae),Af,Ag;if(Al){k.call(Am,Aa);var AV=Aa.model||{},Ak=a(Aa,Ae),Ab=I(Aa,Ak),Ad=AB(Aa,Ae);var AZ=AV.fn,AX=U.fn_List(AZ,AV.fnt),An=AQ[Ab],Ah=An&&!AX;var AT=Am.ctxtBuilder,Aj=AT&&AT.itemWidgets,AU=An?(Ah?Am.calIndex:Am.dtxtIndex):Am.txtIndex,AY;for(Af=0,Ag=Am.preLen;Af<Ag;Af++){AY=Aj[Af];if(Af==AU){AY.set("dtp",Ab);AY.set("isList",AX);var AS=AY.value,AW=AL.isEmpty(AS),Ai=AL.isEmpty(Ad);if(!(AW&&Ai)&&AS!==Ad){AY.set("value",Ad);}AY.set("visible",true);AY.set("hint",AX?mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep||";"):"");try{if(Am.alias!=="c1"||Am.parent.c1Selected){AY.focus&&AY.focus();}}catch(Ac){}if(AZ===1||AZ===2){AY.constraints.min=0;}if(AY.clearValidation){AY.clearValidation();}}else{AY.set("visible",false);}}if(Aa.hasPrompt&&Am.selectedItem&&Am.selectedItem.st===U.STP.PROMPT_STRING){Aa.invalid0=false;}switch(AV.et){case O.AQ:case O.AL:case O.MQ:if(Ak&&Ak.p){Am.set("selectedItem",Ak.p);}else{Am.set("selectedIndex",AU);}break;case O.MC:case O.AC:Am.set("selectedItem",AV[X[AV.et]+(2+Ae)]);break;}}Am.updating=false;}function AM(){var AV=this.parent,AT=AV.parent.parent.parent,AU=(this.isValid&&this.isValid())||(!this.isValid&&!AL.isEmpty(this.value)),AS=AT.model;AT["invalid"+AV.cstIndex]=!AU;if(!this.updating&&AU){this.updating=true;if(AS){AS.edit(AV.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}if(AT.updateOkBtn){AT.updateOkBtn();}}function j(AT){var AS=[{did:660,cfg:{scriptClass:"mstrmojo.ValidationTextBox",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP|mstrmojo.validation.TRIGGER.VALUESET},onValid:AM,onInvalid:AM,onClearValidation:Y,size:6,visible:false}},{did:154,cfg:{scriptClass:"mstrmojo.Calendar",onvalueChange:AM,visible:false}},{did:23,cfg:{scriptClass:"mstrmojo.DateTextBox",cssText:"margin-left:9px;",cssDisplay:"inline-block",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL-mstrmojo.validation.TRIGGER.ALL.ONBLUR},onValid:AM,onInvalid:AM,onClearValidation:Y,calendarToBody:true,autoFormat:false,calConfig:{onmousedown:function(AU){V.stopPropogation(AU.hWin,AU.e);}},visible:false}}];return N(W.copy(AT,{scriptClass:"mstrmojo.WidgetDial",makeObservable:true,itemFunction:n,selectionPolicy:"reselect",items:AS.concat(),txtIndex:0,calIndex:2,dtxtIndex:2,preLen:AS.length,insertUnlistedValuesAt:-1,itemIdField:"did",update:function(){L(this,this.cstIndex);this.parent.updateScrollbars();},postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},itemsEffect:undefined,onchange:b}));}function AO(AT,AS){var AU=AS+U.FN_SEP+AT;return(AT!=null)?{did:AU,n:AU}:null;}function Q(AU){var AW=this.selectedItem;AU=u.filter(AU,function(AX){return(!AX.icf);});if(AW){var AT=u.find(AU,this.itemIdField,AW[this.itemIdField]);if(AT>-1){AU=AU.concat();AU.splice(AT,1);}}F(this,q,AU);var AV=this.items,AS=AV.length;if(AS===1){this.singleSelect(0);}this.updateScrollbars&&this.updateScrollbars();this.parent.updateScrollbars();}function o(AU,AT,AV,AY){AU.updating=true;if(AT){if(AV!=null){AU.set("items",[]);AU.clearSelect();AU.set("items",AV);}var AX=AU.itemIdField,AW=AU.selectedItem;if((AW&&AW[AX])!=(AY&&AY[AX])){var AS=Math.max(u.indexOf(AK((AV||[]),function(AZ){return AZ[AX];}),AY&&AY[AX]),0);AU.set("selectedIndex",AS);}}AU.updating=false;}function M(AU,AT,AV,AY){AU.updating=true;if(AT){if(AV!=null){AU.set("items",AV);}var AX=AU.itemIdField,AW=AU.getSelectedItem();if((AW&&AW[AX])!=(AY&&AY[AX])){var AS=Math.max(u.indexOf(AK((AV||[]),function(AZ){return AZ[AX];}),AY&&AY[AX]),0);AU.set("selectedIndex",AS);}}AU.updating=false;}function g(AS){return N(W.copy(AS,{insertUnlistedValuesAt:-1,hasDummyLabel:true,postCreate:function(){w.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,readCache:true,writeCache:true,params:{taskId:"getAttributeForms",attributeId:null,displayedForms:"0",styleName:"MojoAttributeStyle"},onsuccess:function(){var AV=this.parent,AU=this.response;if((AU&&AU.did)!==AV.lastAttrId){return ;}Q.call(this.parent,AU.fms||[]);},onerr:function(){F(this.parent,q,[K]);}});},update:function AT(){var Aj=this.fmPost,Ac=this,AW=this.parent.parent.parent,AZ=AW.model,Ah=AZ&&AZ["a"+Aj],Ae=!!Ah,AY,Ad,Ai,AV=AW.disableElementsBrowsing,AU=Ah&&AV&&AV(Ah),Ag=Z(Ah);if(Ae){switch(AZ.et){case O.AQ:case O.AL:Ad=AZ.fm;break;case O.AC:Ad=AZ["fm"+Aj];break;case O.AE:Ad=AO(AZ.fn,1);break;}if(this.lastAttrId!==Ah.did){this.lastAttrId=Ah.did;AY=[];if(this.isFirstFm){if(!AU&&(!Ah.ilk&&(!AW.ets||AW.ets[O.AE]))){if(this.hasDummyLabel){AY.push(AE);}var Ab=AA[O.AE],Af=Ab&&Ab.key,AX=Ab.def;AY=AY.concat((Af&&AW[Af])||(Ag?u.filter(AX,function(Ak){return Ak.did!=="1,57";}):AX)||[]);u.forEach(AY,function(Ak){Ak.cls="fn";});}if(this.hasDummyLabel){AY.push(mstrApp.isWSStyling?B:z);}}if(Ad&&(AZ.et!==O.AE)){AY.push(Ad);}Ai=this.ajx;Ai.params.attributeId=Ah.did;Ai.params.otp=Ah.t||12;AY.push(q);J.makeObservable(AY);}}if(AU&&AZ.et===O.AE){Ad=null;}o(this,Ae,AY,Ad);if(Ae&&Ai){var Aa;if(AW.getAttributeForms){Aa=AW.getAttributeForms(Ah.did);}else{if(Ah.fms){Aa=Ah.fms;}}if(Aa&&Aa.length>0){Q.call(this,Aa);}else{if(Ah&&Ah.t===AR.Consolidation){Q.call(this,[]);}else{if(Ai){if(mstrApp&&mstrApp.isWorkstation){mstrApp.serverRequest(Ai.params,{success:function(Ak){if((Ak&&Ak.did)!==Ac.lastAttrId){return ;}Q.call(Ac,Ak.fms||[]);},failure:Ai.onerror});}else{if(Ai._delayId){window.clearTimeout(Ai._delayId);delete Ai._delayId;}Ai._delayId=window.setTimeout(function(){delete Ai._delayId;Ai.send();},500);}}}}}}}));}function AJ(AS){if(AS&&!W.isEmpty(AS)){var AT=u.hash(S);W.forEach(AS,function(AV,AU){if(AV){AT[l[AU]]=true;}});return AT;}return null;}function m(AS,AT,AV,AU){AS.updating=true;AS.clearSelect();u.forEach(AT,function(AW){AW.title=AL.encodeHtmlString(AW.title||AW.n||"");});if(AT){AS.set("items",AT);}if(AV&&AV.length){AS.setSelectedItems(AV);}else{if(AU&&AU.length){AS.select(AU);}}AS.updating=false;}function d(AT,AS,AU,AW,AV){if(AS){m(AT,AU,AW,AV);}}mstrmojo.rw.ConditionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.rw.ConditionList",allowUnlistedValues:true,itemIdField:"did",getItemProps:function x(AW,AS){var AV=!!this.selectedIndices[AS],AY=AW.n,AU=false,AX=AW.ndetype===G.DssRecursiveDerivedElement;if(AW.t===12){var AT=u.filter(AW.fs,function(AZ){return AZ.fgr>0;});if(AT.length>0){AU=true;}}return W.copy({cls:(AV?mstrmojo._IsList.SELECTED_CLS:"")+" "+(AW.css||"")+" "+(AW.t?("t"+AW.t+((AW.da||AW.um)?"d":"")+(AU?"g":"")+(AW.st?(" st"+AW.st+(AX?" nde4ra":"")):"")):""),n:AY||"&nbsp;"},this._super(AW,AS));},onselectionChange:function AG(AS){this._super(AS);b.call(this,AS);}});mstrmojo.rw.ConditionWalkProviderBase=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.rw.ConditionWalkProviderBase",browseEs:function c(AV,AU,AX){AV.openPopup("eb",{zIndex:AV.parent.zIndex+10,left:Math.round(AX.x)+"px",top:Math.round(AX.y)+"px"});var AT=AV.eb.browser,AS=AV.model,AW=AS&&AS.a&&AS.a.did;if(!AW){return ;}AT.set("attributeID",AW);AT.set("selectedItems",AS.es?W.clone(AS.es):[]);AT.initBrowser();},browseObjs:function AI(AZ,AS,AT){AZ.openPopup("ob",{zIndex:AZ.parent.zIndex+10,left:Math.round(AT.x)+"px",top:Math.round(AT.y)+"px"});var AU=AZ.ob.browser;AU.target=AS;var AV;switch(AS.alias){case"dmy":AV=[U.TP.ATTR,U.TP.DIM];break;case"c0":case"c1":var AX=AZ.model,AW=AX&&AX.et,Aa=AX&&AX.fm,AY=Aa&&Aa.dtp||(AX.m?U.DTP.DECIMAL:U.DTP.UNKNOWN);AV=(AW===O.MQ||AW===O.MC)?[U.TP.METRIC,U.DTP2PROMPT_STP[AY]]:[U.TP.ATTR,U.DTP2PROMPT_STP[AY]];break;default:AV=AJ(AZ.ets);AV=AV?W.keyarray(AV,true):[U.TP.ATTR,U.TP.METRIC,U.STP.REPORT_GRID,U.STP.REPORT_GRAPH,U.STP.REPORT_ENGINE,U.STP.REPORT_TEXT,U.STP.REPORT_DATAMART,U.STP.REPORT_BASE,U.STP.REPORT_GRIDGRAPH,U.STP.REPORT_NONINTERACTIVE,U.STP.FILTER].concat(S);}AV[AV.length]=U.TP.FOLDER;AU.browse({rootFolderType:AX&&(AX.et===O.MQ||AX.et===O.MC)?5:26,folderLinksContextId:33,onSelectCB:[AZ,"onOBSelect"],browsableTypes:AV.join(",")});},});var t=mstrmojo.rw.ConditionWalkProviderBase;t.onWalkChange=b;t.replaceItem=F;t.getChildJSON=N;t.walkChildPostCreateFn=w;t.cstJson=j;t.isComparisonAllowed=AN;t.clearInvalid=Y;t.updateCst=L;t.widgetItemFn=n;t.shouldShowCst=H;t.getConstant=a;t.getConstantDataType=I;t.getConstantValue=AB;t.isDATE=AQ;t.getCstListCompareTgts=e;t.fmJson=g;t.fnItem=AO;t.updateList=o;t.allowedTargetTypes=AJ;t.updatePulldown=M;t.onWalkChangeThroughPulldown=R;t.updateListMultiData=m;t.updateListMulti=d;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo._IsWebApp");mstrmojo.requiresDescs(5720,12963);var A=4*1024*1024,D=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport}),E=mstrmojo.hash,C=mstrmojo._IsWebApp,B=mstrmojo.DI.DIConstants;C.serverProxy=D;C.enableWaitBox=true;mstrmojo.AS.DIAppSchemaService=mstrmojo.provide("mstrmojo.AS.DIAppSchemaService",{_mixinName:"mstrmojo.AS.DIAppSchemaService",_uploadChunks:function(G,H,N,L,M,O){var I=arguments.callee,J=G[0];if(!J){O.complete();return ;}if(H===undefined&&N===null){D.upload({success:function(P){I(G,0,P,L,M,O);},failure:function(P){C.hideWait(true);}},E.copy(L,{index:-1}),null,M);}else{var K=Math.min(J.size,H+A),F=J.slice(H,K),M=E.copy({async:true},M);D.upload({success:function(P){if(H+A<J.size){H+=A;I(G,H,P,L,M,O);}else{var Q=G.shift();O.success(Q.name,P.uploadingId);I(G,undefined,null,L,M,O);}},failure:function(P){C.hideWait(true);}},E.copy({index:N.index+1,uploadingId:N.uploadingId,fileName:J.name,fileFieldName:"file"},L),F,M);}},archSpark:function(H,G,F){C.serverRequest(E.copy(G,{taskId:"arch.spark"}),H,F);},uploadFile:function(L,Q,P){var I={taskId:"arch.sparkFileUpload",taskContentType:"json",taskEnv:"xhr",fileType:"application/octet-stream",workspaceId:Q.workspaceId,uploadingId:Q.uploadingId},J={showProgress:Q.showProgress,message:mstrmojo.desc(12963,"Uploading File...")},N=this,G=Q.tableId,M=Q.pipelineId,O=Q.sheetIndex,H=Q.workspaceId,F=Q.requestId,K=Q.mode;if(J.showProgress){C.showWait(J);}this._uploadChunks([L.files[0]],undefined,null,I,J,{complete:function(){},success:function(U,S){if(K===B.operationMode.republish){typeof P==="function"&&P({tableName:U,uploadingId:S,sheetIndex:O,tableId:G});}else{if(K===B.operationMode.edit){var R=typeof P==="function"?function(){P({tableName:U,uploadingId:S,sheetIndex:O});}:mstrmojo.emptyFn;if(!Q.uploadingId){N.editSourceTableId({workspaceId:H,pipelineId:M,tableId:G,uploadingId:S,sheetIndex:O},R);}else{R();}}}}});},editSourceTableId:function(G,H){var F=this;F.archSpark({complete:function(){C.hideWait(true);},success:function(I){if(I.body.status==="ERROR"){mstrmojo.error({longDesc:I.body.message,shortDesc:"ERROR"},function(){});}else{if(I.body.status==="immediateResponse"&&I.httpStatus===200){H();}}},failure:function(I){C.hideWait(true);}},{path:"/sourcetables/"+G.tableId,method:"PUT",form:JSON.stringify({workspaceId:G.workspaceId,pipelineId:G.pipelineId,datasource:{type:B.dataSourceType.FILE_LOCAL,url:G.uploadingId,sheetIndex:G.sheetIndex}})});},deleteWorkspace:function(G,H){var F=this;F.archSpark({complete:function(){typeof H.complete=="function"&&H.complete();},success:function(I){if(I.body.status==="ERROR"){mstrmojo.error({longDesc:I.body.message,shortDesc:"ERROR"});}else{if(I.body.status==="immediateResponse"&&I.httpStatus===200){}}},failure:function(I){console.error(I);}},{path:"/workspaces/"+G.workspaceId,method:"DELETE"});},checkConnection:function(H,I){var G={path:"/cubes/checkConnection",headers:JSON.stringify(H),method:"GET"};var F={hideFailureErr:true,silent:false,waitBoxCfg:{message:mstrmojo.desc(5720,"Waiting..."),showCancel:false,position:{}}};this.archSpark(I,G,F);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIMappingMenu","mstrmojo.DI.DIMappingMenuSearchOnSource","mstrmojo.DI.DIMappingMenuHadoop","mstrmojo.DI.DIMappingMenuSAPHana");var A=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIMappingMenuController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingMenuController",getMappingMenu:function B(E){var D=mstrApp.getRootController().getModel();var F=D.importSources[E],C;if(F!==undefined&&F.type===A.sourceType.querybuilder&&F.subtype===A.sourceSubtype.searchOnSource){C=new mstrmojo.DI.DIMappingMenuSearchOnSource();}else{if(F!==undefined&&F.type===A.sourceType.hadoop&&F.subtype===A.sourceSubtype.hadoop){C=new mstrmojo.DI.DIMappingMenuHadoop();}else{if(F!==undefined&&F.databaseType===4000&&F.xdaType===A.xdaType.qbSingleTable){C=new mstrmojo.DI.DIMappingMenuSAPHana();}else{C=new mstrmojo.DI.DIMappingMenu();}}}return C;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.qb.DBTableView","mstrmojo.qb.EnumDataChangeEvents","mstrmojo.qb.EnumDragActions","mstrmojo.qb.EnumMenuActions","mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var E=mstrmojo.dom,O=mstrmojo.hash,J=mstrmojo.array,S=mstrmojo.css,C=mstrmojo.string,F="px",U=mstrmojo.DI.DIConstants,L=16,M=260+4,D=175;function B(Z,X){var V,Y,W=false;if(!Z||!X){return false;}V=parseInt(Z.x,10);Y=parseInt(Z.y,10);O.forEach(X,function(k){var f,e,j,d;var b=0,c=0,g=0,a=0;if(!k.x||!k.y){return ;}f=parseInt(k.x,10);e=parseInt(k.y,10);j=parseInt(k.w,10);d=parseInt(k.h,10);if(isNaN(j)){j=D;}if(isNaN(d)){d=M;}b=f>V?f:V;c=e>Y?e:Y;g=(f+j)<(V+D)?(f+j):(V+D);a=(e+d)<(Y+M)?(e+d):(Y+M);if(b<=g&&c<=a){W=true;return false;}});return W;}mstrmojo.DI.DIMappingTableContainer=mstrmojo.declare(mstrmojo.qb.TableContainer,null,{scriptClass:"mstrmojo.DI.DIMappingTableContainer",markupString:'<div id="{@id}" class="mstrmojo-qb-TableContainer {@cssClass}" style="{@cssText}" mstrAttach:scroll><div class="mstrmojo-qb-tc-container"></div></div>',dropZone:false,joinInfos:null,clickedNode:null,postCreate:function A(){if(this._super){this._super();}var V=this.parent.model;V.attachEventListener("CurrentSourceChanged",this.id,"updateSelected");V.attachEventListener("MappingsFetched",this.id,"update");V.attachEventListener("scrollToTable",this.id,"showTable");this.attachEventListener("allTableSelectionClear",this.id,"clearAllTableSelection");},postBuildRendering:function R(){var V=this;if(this._super){this._super();}window.setTimeout(function(){V.update();},0);},clearAllTableSelection:function I(V){J.forEach(this.children,function(W){if(V&&V.source&&V.source.id===W.tableData.id){return true;}else{W.clearRowSelections();}});},recordTableData:function K(){var Y=this.children;var W=E.position(this.containerNode),b,V,c,X={},Z,a;J.forEach(Y,function(d){var e=null;if(d.domNode){e=E.position(d.domNode);}Z=d.tableData.id;if(e){V=e.x-W.x;c=e.y-W.y;if(V<0){return false;}b={x:(V+F),y:(c+F),w:e.w,h:e.h,shouldExpand:d.isExpanded,mappingLen:d.tableData.items&&d.tableData.items.length};if(d.attrRows&&d.attrRows.domNode){a=d.attrRows.domNode;b.attrRowsScroll=a.scrollTop;b.attrRowsHeight=a.clientHeight;}if(d.metricRows&&d.metricRows.domNode){a=d.metricRows.domNode;b.metricRowsScroll=a.scrollTop;b.metricRowsHeight=a.clientHeight;}X[Z]=b;}else{X[Z]=null;}});return X;},selectLinkedAttribute:function P(h){var f=h.alias,Z=h.oid,d,b,X,k,a=this.joinInfos&&this.joinInfos.joins,g,W,c,Y,e,V;if(h.source&&h.source.tableData){c=this.findTableById(h.source.tableData.id);if(h.oid){c.selectItemById(h.oid);}else{if(h.alias){c.selectItemByName(h.alias);}}}if(a){for(d=0;d<a.length;d++){X=a[d];k=X.links;for(b=0;b<k.length;b++){if(k[b].source.alias===f){g=k[b].source.tableId;W=k[b].target.tableId;c=this.findTableById(g);Y=this.findTableById(W);if(Z){if(c){e=c.selectItemById(Z);}if(Y){V=Y.selectItemById(Z);}}else{if(f){if(c){e=c.selectItemByName(f);}if(Y){V=Y.selectItemByName(f);}}}if(V&&Y&&e&&c&&(h.source.parent===Y||h.source.parent===c)){if(k[b].source.tp===12&&k[b].target.tp===12){this.parent.linker.drawLink(V,Y,e,c);}}}}}}},findTableById:function N(W){var V;for(V=0;V<this.children.length;V++){if(this.children[V].tableData.id===W){return this.children[V];}}},updateSelected:function(){var X=this,V=this.parent.model,W;W=J.filter(X.children,function(Y){return Y.scriptClass==="mstrmojo.DI.DIMappingTable";});J.forEach(W,function(a){var Y=a.tableData.id,Z=V.currentSource&&(V.currentSource.tableID===Y);a.set("selected",Z);S.toggleClass(a.domNode,"selected",Z);});},onremoveChild:function(V){var X=V.value;for(var W=0;W<X.length;W++){X[W].destroy();}},update:function H(){var l,o,AC,Z;var x,W,AB,h,p=this.parent.model,b,n=false,t,V,f,q,u=true;if(!this.hasRendered){return ;}t=this.domNode.scrollLeft;V=this.domNode.scrollTop;if(this.children){AB=this.recordTableData();this.removeChildren();u=false;}var c=0;var X=function(k){return k.selected;};var a=this.clickedNode;function w(k){var AD,m,AF={},AE=[],z=[];for(AD in k){m=k[AD].srcTableID||AD;if(!AF[m]){AF[m]=[];AE.push(m);}AF[m].push(AD);}J.forEach(AE,function(AG){z=z.concat(AF[AG]);});return z;}f=w(p.importSources);for(q=0;q<f.length;q++){x=f[q];if(!p.importSources[x].sourceInfo){continue;}if(p.importSources[x].currentTransformations&&p.importSources[x].currentTransformations.xtab&&p.importSources[x].currentTransformations.xtab.isCrosstab){h=p.importSources[x].transformedMapping;}else{h=p.importSources[x].currentMapping;}l=mstrmojo.hash.clone(h);l=mstrmojo.array.filter(l,X);if(!l){continue;}o=p.importSources[x];AC=o.sourceInfo;Z=AC.partition;W={n:AC.name,items:l,id:o.tableID,idx:c++,partition:Z&&Z.tables,type:o.type,subtype:o.subtype};if(W.subtype===U.sourceSubtype.searchOnSource){n=true;}var j=mstrApp.getRootController();if(W.subtype===U.sourceSubtype.hadoop&&j.model.isDirectDataAccess){n=true;}b=null;if(u){if(o.tablePosition){b={};if(o.tablePosition.x){b.x=Math.max(o.tablePosition.x,0)+F;}if(o.tablePosition.y){b.y=Math.max(o.tablePosition.y,0)+F;}if(o.tablePosition.w){b.w=o.tablePosition.w+F;}if(o.tablePosition.h){b.h=o.tablePosition.h+F;}}}if(!b&&AB&&AB[x]){b=AB[x];}O.copy(b,W);if(typeof W.mappingLen==="number"&&W.mappingLen!==l.length){delete W.h;}AB=this.addTable(W,AB);}for(x in p.importSources){if(!p.importSources[x].sourceInfo){continue;}if(p.importSources[x].currentTransformations&&p.importSources[x].currentTransformations.xtab&&p.importSources[x].currentTransformations.xtab.isCrosstab){h=p.importSources[x].transformedMapping;}else{h=p.importSources[x].currentMapping;}l=mstrmojo.hash.clone(h);l=mstrmojo.array.filter(l,X);if(!l){continue;}o=p.importSources[x];if(a&&o.tableID===a.tableId){var d,AA,Y=this.children;for(q=0;q<Y.length;q++){if(Y[q].tableData.id===a.tableId){AA=Y[q];break;}}if(a.tableRow.alias==="metricRows"){var e=AA.metricRows.items;for(d=0;d<e.length;d++){if(a.node.innerText&&e[d].alias===a.node.innerText.replace("\xA0"," ")){AA.metricRows.raiseEvent({name:"selectLinkedItems",source:AA.metricRows,oid:e[d].oid,alias:e[d].alias});}}}else{var g=AA.attrRows.items;for(d=0;d<g.length;d++){if(a.node.innerText&&g[d].alias===a.node.innerText.replace("\xA0"," ")){AA.attrRows.raiseEvent({name:"selectLinkedItems",source:AA.attrRows,oid:g[d].oid,alias:g[d].alias});}}}}}if(this.children&&this.children.length>1){this.joinInfos={joins:this.addJoinInfos()};}this.domNode.scrollLeft=t;this.domNode.scrollTop=V;this.parent.set("disableNewTables",n);},addTable:function Q(W,V){var f=this;var d=W.id;var Y=this.parent.model;var c=Y.currentSource&&(Y.currentSource.tableID===d),X=Y.getImportSource(d).isHierarchyRelationTable(),a="",e,Z,b;if((W.x===undefined)||(W.y===undefined)){Z=0;while(!e||B(e,V)){e={x:(Z*209)+5+F,y:L+F};Z++;}}if(e){W=O.copy(e,W);if(!V){V={};}V[d]=e;}b=W.partition;if(b&&b.length>1){a="partition-group";}f.addChildren([new mstrmojo.DI.DIMappingTable({alias:"table",tableData:W,left:W.x,top:W.y,height:W.h,width:W.w,shouldExpand:W.shouldExpand,attrRowsScroll:W.attrRowsScroll,metricsScroll:W.metricRowsScroll,attrRowsHeight:W.attrRowsHeight,metricRowsHeight:W.metricRowsHeight,model:Y,linker:this.parent.linker,selected:c,cssClass:mstrmojo.string.trim((c?"selected":"")+" "+(X?"hierarchy":"")),isHierarchyRelation:X,group:a,convertEnabled:W.subtype!==U.sourceSubtype.hanaSingleTable,initSelectNode:W.initSelectNode})]);return V;},addJoinInfos:function(){var X,W;var Y=[],V;for(X=0;X<this.children.length;X++){for(W=X+1;W<this.children.length;W++){V=this.findCommonRows(this.children[X],this.children[W]);if(V&&V.length>0){Y.push({targetTable:this.children[X],sourceTable:this.children[W],links:V});}}}return Y;},findCommonRows:function(b,Z){var a=b.attrRows.items,Y=Z.attrRows.items,W=b.metricRows.items,V=Z.metricRows.items,X=[];J.forEach(a,function(c){J.forEach(Y,function(d){if(c.oid&&d.oid&&c.oid===d.oid){X.push({target:c,source:d});}});});J.forEach(W,function(c){J.forEach(V,function(d){if(c.alias&&d.alias&&c.alias===d.alias){X.push({target:c,source:d});}});});return X;},showTable:function G(g){var b=g.value,a=null,k,Y,W,d,Z,V,X,c,e,j,h,f;J.forEach(this.children,function(l){if(l.tableData.id===b){a=l;return false;}});if(!a){return ;}k=a.domNode;Y=k.style;W=parseInt(Y.left);d=parseInt(Y.top);if(W<0||d<0){return ;}Z=k.offsetWidth;V=k.offsetHeight;X=this.domNode;c=X.style;e=parseInt(c.width);j=parseInt(c.height);h=X.scrollLeft;f=X.scrollTop;if(W-h<0||W-h+Z>e){X.scrollLeft=W;}if(d-f<0||d-f+V>j){X.scrollTop=d-L;}},onscroll:function(){var X=this,Y=O.walk("parent.linker",X),W=J.filter(X.children,function(a){return a.selected;}),Z,V;if(W.length>0){Z=W[0].attrRows.getUserSelectedData();V=J.filter(Z,function(a){return a.isLinked;});Y.clearLinks();J.forEach(V,function(a){this.selectLinkedAttribute({source:W[0].attrRows,oid:a.oid,alias:a.alias});},this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.CheckBox","mstrmojo.Editor","mstrmojo.HBox","mstrmojo.Label","mstrmojo.RadioButton","mstrmojo.warehouse.dbroles.DBRoleDSNConnection","mstrmojo.warehouse.dbroles.DBRoleSetting","mstrmojo.warehouse.obj.DBRole","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(10070,12933,12949,11139,8513,1162,11134,10071,5891,2102);var O=mstrmojo.array,H=mstrmojo.string,L=mstrmojo.hash,R=mstrmojo.css,A=mstrmojo.warehouse.EnumObjectTypes,I="PWDHIDDEN123!@#",K=mstrmojo.DI.DIHelpers,P="Kerberos Authentication",S=mstrmojo.DI.DIConstants,C=[S.dbType.TERADATA];function M(V,W){var U=V&&V.container&&V.container.dsnSelector&&V.container.dsnSelector.WHDSNLIST&&V.container.dsnSelector.WHDSNLIST.selectedIndex===1;return K.getEnvObj().isWSDossierLocalMode()&&U&&C.indexOf(W)>-1;}function J(){var X=this,U=this.dbrole.mdDBRole,Y=H.trim(X.container.txtname.text),W=X.container.dsninfo,Z=W.contents,a,b;b=Z&&Z.RB0&&Z.RB0.label===P&&Z.RB0.checked;if(Y!==U.n){if(!mstrApp.getRootController().validateName(A.DBROLE,Y,U.n)){return false;}}if(W.getDBId()!==43&&!b&&!M(X,W.getDBType())){if(X.container.txtlogin.visible){a=X.container.txtlogin.isValid();if(!a.val){mstrmojo.alert(a.msg);return false;}}if(X.container.txtpwd.visible){a=X.container.txtpwd.isValid();if(!a.val){mstrmojo.alert(a.msg);return false;}}}if(X.container.dsnSelector.WHDSNLIST.selectedIndex===1){var V=X.container.dsninfo.dsnBox.dsnList.selectedItem;if(!V||V.des==="0"||V.des===0){mstrmojo.alert(mstrmojo.desc(10070,"Please select a DSN first"));return false;}}else{a=X.container.dsninfo.isValidInput();if(!a.val){mstrmojo.alert(a.msg);return false;}}return true;}function E(){var X=this,e=this.container.dsninfo,Y=this.dbrole.mdDBRole,V=this.config,U=Y.connstr,W=this.container,a=false,b=function b(){e.clear();if(!U){var g=window.localStorage,c=parseInt((g&&g.getItem("dbRoleDSNOption"))||0,10);if(c===0||a){W.dsnSelector.WHDSNLIST.set("selectedIndex",0);}else{W.dsnSelector.WHDSNLIST.set("selectedIndex",1);}}else{var f=(U.split("=")[0]).toUpperCase();if(f==="DSN"){W.dsnSelector.WHDSNLIST.set("selectedIndex",1);}else{W.dsnSelector.WHDSNLIST.set("selectedIndex",0);}}e.set("info",Y);if(!Y.shared){Y.shared="0";}if(mstrApp.isSingleTier){W.sharedConnection.domNode.style.display="none";}else{W.sharedConnection.checked=(Y.shared==="1");W.sharedConnection.refresh();}Y.des=(mstrApp.rootController.isCloud()?Y.n:"");Y.ln=Y.ln||"";W.txtlogin.set("text",Y.ln);if(Y.did===""){Y.password=Y.password||"";}else{Y.password=Y.password||I;}W.txtpwd.set("text",Y.password);W.txtname.set("text",Y.n||Y.des);};if(V||mstrApp.isSingleTier){X.set("visible",false);mstrApp.rootController.getDBObjects().reloadDSNs({success:function d(){b.call(X);X.set("visible",true);}});if(V.hideDSNOption||(mstrApp.isSingleTier&&navigator.userAgent.indexOf("Macintosh")>-1)){W.dsnSelector.domNode.style.display="none";a=true;}if(V.hideDriverCheck){W.dsninfo.set("hideDriverCheck",V.hideDriverCheck);}if(V.requiresLogin!==undefined){W.txtlogin.isRequired=V.requiresLogin;W.txtpwd.isRequired=V.requiresLogin;}if(V.dbIdFilter){W.dsninfo.dbIdFilter=V.dbIdFilter.sort(O.numSorter);}if(V.dbIdExcludeFilter){W.dsninfo.dbIdExcludeFilter=V.dbIdExcludeFilter.sort(O.numSorter);}if(V.dsnDbTypeExcludeFilter){W.dsninfo.dsnDbTypeExcludeFilter=V.dsnDbTypeExcludeFilter.sort(O.numSorter);}if(V.showAddDriver){W.dsninfo.set("showAddDriver",V.showAddDriver);}if(V.singleType){W.dsninfo.set("singleType",true);}if(V.cfgDbmsTypeExcludeFilter){W.dsninfo.set("cfgDbmsTypeExcludeFilter",V.cfgDbmsTypeExcludeFilter);}W.sharedConnection.set("visible",!(V.hideShareConnection===undefined||V.hideShareConnection===null?true:V.hideShareConnection));W.shareLink.set("visible",!!V.showShareLink);W.txtlogin.set("visible",false);if(V.hideLogin){W.txtlogin.set("visible",false);}if(V.hidePwd){W.txtpwd.set("visible",false);}if(V.hideShareLink){W.shareLink.set("visible",false);}}else{b.call(X);}var Z=K.isdbRoleWritable(Y);X.buttonsbox.okButton.set("enabled",Z);}function N(a){var Y=this;var b=this.container,W=b.dsninfo,U=L.clone(this.dbrole.mdDBRole);if(mstrApp.rootController.isCloud()){U.des=H.trim(b.txtname.text);U.n=U.des+"___"+new Date().getTime();}else{U.n=H.trim(b.txtname.text);}U.des=U.des.replace(",","%%%");U.n=U.n.replace(",","%%%");if(parseInt(U.dbr_type,10)!==1){U.dbr_type="2";}U.owned="1";U.writable="1";if(b.sharedConnection.isChecked()){U.shared="1";}else{U.shared="0";}if(b.txtlogin.visible){U.ln=H.trim(b.txtlogin.text);}else{U.ln="";}if((b.txtpwd.text!==I)&&(b.txtpwd.visible)){U.password=b.txtpwd.text;}else{delete U.password;}var X=W.getConnectionStr();U.connstr=X.str;U.db_type=W.getDBType();U.cefu=W.getCharEncodingForUnix(U.connstr);U.driverMode=W.getDriverMode();U.odbcv=W.getOdbcv();U.dbms=W.getDbmsID();U.ab=W.getDBId();if(M(Y,U.db_type)){if(U.ln===""){delete U.ln;}if(U.password===""){delete U.password;}}W.getVLDBProperties(U.vldbProperties);mstrApp.rootController.saveDBRole({mdDBRole:U},(U.did===""),{errorMsg:X.err,success:function Z(){if(Y.callback&&Y.callback.success){Y.callback.success(Y.dbrole);}if(a&&a.keepOpen){a.success();}else{Y.close();}},complete:function V(){if(this.errorMsg!==""){mstrmojo.alert(this.errorMsg);}}});}function Q(W,X){var V=(W.dbrole?W:W.parent),U=V.dbrole.mdDBRole;if(K.isdbRoleWritable(U)){if(J.call(V)){N.call(V,X);}}else{return ;}}mstrmojo.warehouse.dbroles.DBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleEditor",cssClass:"mstrmojo-wh-DBRoleEditor",title:mstrmojo.desc(12949,"Data Source"),zIndex:100,dbrole:undefined,useDSN:true,callback:mstrmojo.emptyFn(),isHadoopGateWay:false,onOpen:function D(){E.call(this);},onClose:function B(){if(this.callback&&this.callback.close){this.callback.close();}},container:undefined,dsnSelector:undefined,WHDSNLIST:undefined,dsninfo:undefined,txtlogin:undefined,txtpwd:undefined,sharedConnection:undefined,shareLink:undefined,hideDSNOption:undefined,hideDriverCheck:undefined,requiresLogin:undefined,scrollable:undefined,postBuildRendering:function(){if(this._super){this._super();}if(this.isHadoopGateWay){this.containerNode.style.maxHeight="416px";}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DBRoleEditor-container",alias:"container",children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-wh-DSNSelector",alias:"dsnSelector",bindings:{visible:function(){return !(K.getEnvObj().isWSMac()&&K.getEnvObj().isWSDossierLocalMode());}},children:[{scriptClass:"mstrmojo.ui.CheckList",cssClass:"mstrmojo-wh-DSNSelector-radio",multiSelect:false,orientation:"h",alias:"WHDSNLIST",items:[{did:"0",n:mstrmojo.desc(11132,"DSN less data sources")},{did:"1",n:mstrmojo.desc(11133,"DSN data sources")}],onchange:function(){if(this.selectedIndex===0){this.parent.parent.dsninfo.set("isDSNLess",true);}else{this.parent.parent.dsninfo.set("isDSNLess",false);}var U=window.localStorage;if(U){U.setItem("dbRoleDSNOption",this.selectedIndex);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleEditor-info",text:mstrmojo.desc(11139,"Connection Information"),visible:false},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleDSNConnection",alias:"dsninfo",onEnterFn:function G(U){Q(U.parent.parent);},updateLoginFn:function F(U){if(this.parent.parent.isHadoopGateWay){this.parent.txtlogin.set("visible",false);this.parent.txtpwd.set("visible",false);}else{this.parent.txtlogin.set("visible",U);this.parent.txtpwd.set("visible",U);}}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtlogin",isRequired:true,caption:mstrmojo.desc(8513,"login:"),onEnter:function G(){Q(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtpwd",isPassword:true,hiddenPwd:I,isRequired:true,caption:mstrmojo.desc(1162,"password:"),onEnter:function G(){Q(this.parent.parent);}},{scriptClass:"mstrmojo.warehouse.dbroles.DBRoleSetting",alias:"txtname",bindings:{cssText:function(){return this.isHadoopGateWay?"display:none !important;visibility:hidden !important":"";}},caption:mstrmojo.desc(11134,"ds name:"),onEnter:function G(){Q(this.parent.parent);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-wh-DBRoleEditor-infoCheckbox",alias:"sharedConnection",label:mstrmojo.desc(10071,"Share this connection with everybody")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-wh-DBRoleEditor-shareLabel",alias:"shareLink",text:mstrmojo.desc(9099,"Share"),onclick:function(){var V=this.parent.parent,U=V.dbrole&&V.dbrole.mdDBRole;if(U){mstrApp.getRootController().shareDBRole(U);}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonsbox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button rightfloat mstrmojo-WebButton hot",text:mstrmojo.desc(5891,"Save"),alias:"okButton",onclick:function(){Q(this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2102,"Close"),alias:"buttonCancel",onclick:function(){var U=this.parent.parent;if(U.onCancel){U.onCancel();}U.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.architect.EnumDragActions","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.warehouse.ui.TablesTree","mstrmojo.warehouse.menu.AvailableTablesMenu");mstrmojo.requiresDescs(2901);var W=mstrmojo.array,R=mstrmojo.hash,A=mstrmojo.string,X=mstrmojo.css,M="loading",Z="item-mn",I="item-n",E=mstrmojo.dom,P=mstrmojo.warehouse.EnumDataChangeEvents,N=mstrmojo.architect.EnumDragActions,H=mstrmojo.warehouse.EnumObjectTypes,Q=mstrmojo.desc(2901,"Loading..."),O="waitBoxTipForAvailableTablesTree",V;mstrmojo.warehouse.ui.AvailableTablesTree=mstrmojo.declare(mstrmojo.warehouse.ui.TablesTree,null,{scriptClass:"mstrmojo.architect.ui.AvailableTablesTree",cssClass:"mstrmojo-wh-AvailableTablesTree",tablesTreeHooks:{addItem:function(c,d){var b=mstrApp.getRootController();if(d.n){d.n=d.n.replace(/<strong>|<\/strong>/gi,"");if(!d.decoded){d.n=A.decodeHtmlString(d.n);d.decoded=true;}}b.addTables([].concat(d));},isTable:function a(b){return b&&b.tp===H.TABLE;}},createAvatarFunc:undefined,positionAvatarFunc:undefined,useRichTooltip:true,showTooltip:function D(c,e){var d=c.target||E.eventTarget(c.hWin,c.e);if(d.className&&(d.className.indexOf("item-n")>-1)){d=d.parentNode;}if(d.className.indexOf("item tp")>-1&&(d.scrollWidth>d.clientWidth)){var b=E.position(d);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:d.textContent,top:b.y+b.h+5,left:b.x};this._super(c,e);}},init:function U(m){this._super(m);var n={},g=mstrApp.getRootController(),d=n[this.id]={};d[P.DBTABLES_CHANGED]=function j(q){if(!((this.sourceInfo===q.sourceInfo)||(q.sourceInfo==="")||(q.sourceInfo===undefined))){return ;}this.cleanUp();var x=q.selectedItems||[],w=this.selectedIndices={},t=q.keyword,u=q.items;u=W.map(u,function(AC){if(AC.encoded===true){return AC;}var AD=AC.n,AA=new RegExp(t,"gi"),z,AE=0,AB=[];while(!!t&&(z=AA.exec(AD))){AB.push(A.encodeHtmlString(AD.slice(AE,z.index)));AB.push("<strong>"+A.encodeHtmlString(AD.slice(z.index,AA.lastIndex))+"</strong>");AE=AA.lastIndex;}AB.push(A.encodeHtmlString(AD.slice(AE)));AC.n=AB.join("");AC.encoded=true;return AC;});W.forEach(x,function(z){w[W.find(u,"n",z)]=true;});this.expandedIndices=q.expandedIndices||{};this.set("items",u);if(this.domNode){this.domNode.onmousedown=function(z){E.preventDefault(window,z);};}this.waitBoxTip&&this.waitBoxTip.closeWait();};d[P.DBTABLES_REQUESTED]=function k(x){var w=mstrApp.getRootController(),AB=w.dataService,u=(AB==mstrmojo.qb.mdx.DataService);if(!((this.sourceInfo===x.sourceInfo)||(x.sourceInfo===""))){return ;}this.cleanUp();var z=[],AA=this.domNode.clientWidth||parseInt(this.width,10),t=this.domNode.clientHeight||parseInt(this.height,10);z.push({n:u?Q:"",tp:"0",isVisible:function q(){return true;}});this.set("items",z);X.toggleClass(this.getLeafNode(0),M,true);!u&&this.waitBoxTip.showWait({showCancel:true,message:" ",cssClass:"mstrmojo-WaitBoxTip",cancelCallback:this.cancelTables,position:{left:(E.position(this.domNode).x+AA/2-20)+"px",top:(E.position(this.domNode).y+t/2-12)+"px"},width:"40px"});};d[P.DBTABLE_UPDATED]=function p(q){W.forEach(this.getItemWithPropName(this.items,"did",q.item.did),function(t){this.updateChild(t._renderIdx,q.item);},this);};d[P.TABLES_CANCELED]=function e(q){this.set("items",[]);};d.windowSizeChanged=function(){this.waitBoxTip&&this.waitBoxTip.adjustCorners.call(this);};d[P.DBTABLES_USED]=function f(q){var u=q.items||[],t=this.items;R.forEach(this.selectedIndices,function(w,x){this.toggleChildSelection(String(x),false);},this);W.forEach(u,function(w){this.toggleChildSelection(String(W.find(t,"n",w)),true);},this);};g.attachDataChangeListeners(n);this.dataHelper={fetch:function c(q,t){if(q.tp===H.TABLE){g.getColumnsForDBTable({data:q,showCancel:false},t);}else{t.success({items:[]});}}};if(!mstrmojo.all[O]){var h=this,o=h.domNode?h.domNode:undefined;mstrmojo.insert({scriptClass:"mstrmojo.warehouse.ui.WaitBoxTip",cssClass:"mstrmojo-WaitBoxTip",id:O,adjustCorners:function l(){if(o||(this&&this.domNode)){var u=o?h:this,t=u.domNode.clientWidth||parseInt(u.width,10),q=u.domNode.clientHeight||parseInt(u.height,10);var w=E.position(u.domNode);this.set("position",{left:(w.x+t/2-20)+"px",top:(w.y+q/2-12)+"px"});}},postBuildRendering:function b(){mstrmojo.warehouse.ui.WaitBoxTip.prototype.postBuildRendering.call(this);var q=this.domNode.firstChild;X.addClass(q,"noBgNBor");}});}this.waitBoxTip=mstrmojo.all[O];},createAvatar:function L(b){if(this.createAvatarFunc){return this.createAvatarFunc.call(this,b);}else{return this._super(b);}},positionAvatar:function G(c,b){if(this.positionAvatarFunc){this.positionAvatarFunc.call(this,c,b);}else{this._super(c,b);}},cancelTables:function B(){mstrApp.getRootController().cancelLoadTables();},cleanUp:function K(){this.expandedIndices={};this.selectedIndices={};this.userSelections={};},onitemsChange:function S(b){if(this._super){this._super(b);}delete this._oldItems;},getItemProps:function Y(d,e,c){var b=d.cube_caption?d.cube_caption:d.n;b=(b&&(b+""))||"";return{tag:"div",cls:"item "+(d.tp?("tp"+d.tp):""),n:b,idx:c};},getItemMarkup:function C(c,d,b){return'<div class="{@cls}" title="{@ttp}"><span class='+I+' unselectable="on">{'+(d===1?"@en":"")+"@n}</span><span class="+Z+"></span></div>";},getMenuHelper:function F(){V.menuHelper=V.menuHelper||new mstrmojo.warehouse.menu.AvailableTablesMenu();return V.menuHelper;},getDragAction:function J(c){var d=this.getNodeAttributes(c.src.node),b=d&&this.getTreeItem(d.index);if(b&&b.n){if(!!b.decoded){b.n=A.encodeHtmlString(b.n);b.decoded=false;}b.n=b.n.replace(/<strong>|<\/strong>/gi,"");}switch(b&&b.tp){case H.TABLE:return N.ADD_TABLE;}}});V=mstrmojo.warehouse.ui.AvailableTablesTree;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.ui.ScrollableList","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.ui.menus._HasMenuPopup");var A=mstrmojo.css,C=mstrmojo.dom;var B=mstrmojo.architect.menu.EnumMenuActions;mstrmojo.DI.DIAuthenticationList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo.ui._HasListTooltip,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DIAuthenticationList",selectionPolicy:"reselect",mode:"",useRichTooltip:true,executeCommand:mstrmojo.emptyFn,setupScrollNodes:function(){this.scrollNode=this.scrollNode;},onitemsChange:function(){this.updateScrollbars();A.toggleClass(this.domNode,"edit",this.mode==="edit");},onmodeChange:function(){var D=this.parent.bottom,E=this.mode==="edit";A.toggleClass(this.domNode,"edit",E);D.children[0].set("visible",!E);D.children[1].set("visible",!E);D.children[2].set("visible",E);},getItemMarkup:function(F,D){var E=mstrmojo._IsList.getItemMarkup.call(this,F,D);return E.replace("{@en@n}",'<span class="icon"></span><span class="text">{@en@n}</span><span class="btn"></span>');},onclick:function(D){var F=D.getTarget(),E=this.getItemNodeFromTarget(F);if(E&&E.childNodes[2]===F){this.handleBtnAction(this.getItemFromTarget(F),D);return ;}return mstrmojo._IsList.onclick.call(this,D);},handleBtnAction:function(H,E){var G=this,I=E.getTarget(),F,D;F=this.ctxMenuHelper=this.ctxMenuHelper||new mstrmojo.warehouse.menu.DBConnectionsMenu({queryVisible:function(J){var K;switch(J&&J.action){case B.EDIT:K=true;break;case B.DELETE:K=true;break;case B.SHARE:K=!!mstrApp.diParams.Share&&!mstrApp.isSingleTier;break;default:K=false;break;}return K;},queryChecked:function(){return false;},executeCommand:function(J){var L=this.data,K=J.action;G.executeCommand(K,L);}});F.data=H;D=F.getMenuConfig();D.hostId=this.id;D.hostElement=I;D.isHostedWithin=false;D.hostProxyCssClass="item-mn-proxy";D.position=C.position(D.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:D}));}});}());(function(){mstrmojo.requiresCls("mstrmojo._IsList","mstrmojo.ListBase","mstrmojo.array","mstrmojo.string","mstrmojo.dom","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.Menu","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.menu.DBConnectionsMenu");mstrmojo.requiresDescs(2901);var O=mstrmojo.array,D=mstrmojo.dom,A=mstrmojo.string,Q="item-mn",I=mstrmojo.warehouse.EnumDataChangeEvents,L=mstrmojo.desc(2901,"Loading..."),G=57,H=mstrmojo.DI.DIHelpers;function K(U){var W=U.item,S=this.items,V=O.find(S,"did",W.did);S[V]=W;this._getItemNode(V).outerHTML=this.itemRenderer.render(W,V,this);}function E(V){var W=V.item,U=this.items.concat(),S=O.find(U,"did",W.did);if(S>-1){U.splice(S,1);}this.set("items",U);}mstrmojo.warehouse.ui.DBConnectionsList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.architect.ui.DBConnectionsList",cssClass:"mstrmojo-wh-dbConnectionslist",selectionPolicy:"reselect",useRichTooltip:true,showTooltip:function B(U,X){var W=U.target||D.eventTarget(U.hWin,U.e),V=this.getItemFromTarget(W);if(W.className&&(W.className.indexOf("item-n")>-1)){W=W.parentNode;}if(V&&V.n&&(W.scrollWidth>W.clientWidth)){var S=D.position(W);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:A.encodeHtmlString(V.n+"",true),top:S.y+S.h+5,left:S.x};this._super(U,X);}},postBuildRendering:function N(){if(D.isChrome){D.attachEvent(this.domNode,"mousedown",function(S){if(S.which===2){D.stopPropogation(window,S);D.preventDefault(window,S);}});}if(this._super){this._super();}},init:function M(X){this._super(X);var Z=this,Y={},V=Y[this.id]={};V[I.DBROLES_REQUESTED]=function S(){var a={n:L,tp:"0",isPrimary:function(){return false;}};Z.set("items",[a]);};V[I.DBROLES_LOADED]=function W(a){var c=a.offset||0;Z.set("items",a.items);if(a.isManagedDBR){var b={};b[c]=true;this.set("selectedIndices",b);}if(c>0){Z.adjustScrollPosition(c);}};V[I.DBROLES_ADD]=function U(a){Z.addItems([a.item]);};V[I.DBROLE_CHANGED]=K;V[I.DBROLES_RENAME]=K;V[I.DBROLES_DELETE]=E;mstrApp.getRootController().attachDataChangeListeners(Y);},getItemMarkup:function C(U){var S=(U.mdDBRole&&U.mdDBRole.shared==="1"?" shared":"");return'<div class="item {@cls}" idx="{@idx}" style="{@style}"><span class="item-ic'+S+'"></span><span class="item-n" >{@n}</span><span class='+Q+"></span></div>";},getItemProps:function P(W,S){var X=!!this.selectedIndices[S],V=A.encodeHtmlString(W.n),U=mstrApp.rootController.hasPrivilege(G)?"":" hide-menu";return{sel:X,cls:"tp"+W.tp+(W.isPrimary()?" primary":"")+(X?" selected":"")+U,n:V,idx:S};},onclick:function R(b){try{var X=b.target||D.eventTarget(b.hWin,b.e),c=D.findAncestorByAttr(X,"idx",true,this.domNode),a=c&&parseInt(c.value,10),S=this.items[a],U=H.getEnvObj().isDesktopClient();if(A.startsWith(X.className,Q)&&a!==null&&!isNaN(a)){var Z=mstrmojo.warehouse.ui.DBConnectionsList,V=new mstrmojo.warehouse.menu.DBConnectionsMenu({isManagedDBR:S.isManagedDBR,readable:S.mdDBRole&&S.mdDBRole.readable?S.mdDBRole.readable:"0",writable:S.mdDBRole&&S.mdDBRole.writable?S.mdDBRole.writable:"0",controllable:!U&&S.mdDBRole&&S.mdDBRole.controllable?S.mdDBRole.controllable:"0",deletable:S.mdDBRole&&S.mdDBRole.deletable?S.mdDBRole.deletable:"0"});V.data=S.data;var W=V.getMenuConfig();W.hostId=this.id;W.hostElement=X;W.isHostedWithin=false;W.hostProxyCssClass="item-mn-proxy";W.position=D.position(W.hostElement,true);this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:W}));}else{if(a!==null){this._super(b);}}}catch(Y){throw Y;}},onchange:function F(){if(this.selectedItem){mstrApp.getRootController().setSelectedDBRoleID(this.selectedItem);}},adjustScrollPosition:function J(W){var S=this.domNode.clientHeight,V=this.domNode.scrollHeight,U=this.items.length;if(U>0&&V>S){this.domNode.scrollTop=W*(V/U);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(13531,13532,13533,14034,14035);var E=57,D="reportDefLoaded",C=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.qb.thirdParty.BISourceSelector=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",cssClass:"mstrmojo-qb-thirdParty-BISourceSelector",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,onheightChange:function B(G){if(!this.heightOffset){this.heightOffset=37;}this.dbConnections.set("height",parseInt(G.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.Box",cssClass:"selector-panel-header cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"title-label",text:mstrmojo.desc(4381,"DATA SOURCES")},{scriptClass:"mstrmojo.Button",cssClass:"add-connection-button",text:mstrmojo.desc(14035,"Add a new connection")+"...",onclick:function F(){if(mstrApp.rootController.hasPrivilege(E)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}}]},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"source-type-selector",visible:false,items:[{id:0,n:"All"},{id:1,n:"SAP Business Objects"},{id:2,n:"OBIEE"},{id:3,n:"Cognos"}],selectedIndex:0,onitemSelected:function(G){this.parent.dbConnections.filterBySource(G.n);}},{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections",postCreate:function(){var H={},G=H[this.id]={};G[C.DBROLES_LOADED]=this.onDBRolesLoaded;G[D]=this.onReportDefLoaded;mstrApp.getRootController().attachDataChangeListeners(H);},onDBRolesLoaded:function(G){this.allDBRoles=G.items;},onReportDefLoaded:function(){var G=mstrApp.getRootController().model;this.singleSelectByField(G.SelDBRoleID,"did");},onchange:function(){var H=this.selectedItem,G=mstrApp.getRootController().model;if(H){G.SelDBRoleID=H.did;G.set("SelDBRoleName",H.n);}else{if(G.SelDBRoleID){this.singleSelectByField(G.SelDBRoleID,"did");}else{G.set("SelDBRoleName","");}}G.raiseEvent({name:"BISourceChange"});},filterBySource:function A(G){}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.DBConnectionsList");mstrmojo.requiresDescs(4381,11131,12933);var B=57;mstrmojo.warehouse.DBRoleSelector=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.DBRoleSelector",cssClass:"DBConnections",title:mstrmojo.desc(4381,"data sources"),newDBBtn:undefined,dbConnections:undefined,init:function C(D){this._super(D);this.addNewTitleButton({alias:"newDBBtn",cssClass:"mstrmojo-wh-addDB",title:mstrmojo.desc(11131,"New data source"),onclick:function E(){if(mstrApp.rootController.hasPrivilege(B)){mstrApp.getRootController().editDBRole();}else{mstrmojo.alert(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"));}}});},onheightChange:function A(D){if(!this.heightOffset){this.heightOffset=30;}this.dbConnections.set("height",parseInt(D.value,10)-this.heightOffset+"px");},children:[{scriptClass:"mstrmojo.warehouse.ui.DBConnectionsList",alias:"dbConnections"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Widget","mstrmojo.Button","mstrmojo.TextBox","mstrmojo.ui.PopupButton","mstrmojo.DI.DIConstants","mstrmojo.DI.DIAuthenticationList","mstrmojo.architect.menu.EnumMenuActions","mstrmojo.DI.DIHelpers","mstrmojo.string");mstrmojo.requiresDescs(531,641,3398,7778,8473,12933,14887,14898,14925);var Q=mstrmojo.Widget,H=mstrmojo.hash,F=mstrmojo.array,R=mstrmojo.css,C=mstrmojo.dom,J=mstrmojo.desc,U=mstrmojo.DI.DIConstants,K=mstrmojo.DI.DIHelpers,E=mstrmojo.string;var S=mstrmojo.desc(7778,"Anonymous"),D=mstrmojo.architect.menu.EnumMenuActions;function G(Y){var X=this;var V=mstrApp.getRootController();var W=H.walk("parent.parent.tableID",X);if(!Y||!Y.did){return ;}V.dataService.loadDBRoles({success:function(Z){X.close();V.getDialogController().show(U.dialogType.authenticationDialog,{dbrole:Z.dbrs&&Z.dbrs[0],srcTableID:W});}},{objectID:Y.did});}function B(X){var W=mstrApp.getRootController(),V=X&&X.length,Y=0;var Z={success:function(){Y++;if(Y>=V){W.getAuthenticationDBRoles();}},failure:function(a){Y++;if(a&&parseInt(a.code,10)===U.backendError.notFullyControl){W.displayError(mstrmojo.desc(12933,"You don't have enough privileges to perform this operation"),false,a&&a.message);}else{W.displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),false,a&&a.message);}}};if(!V){return ;}F.forEach(X,function(a){W.dataService.deleteDBRole(Z,{objectid:a.did,objecttype:29});});}function L(Z){var X=this,a=J(14898,'Are you sure to delete connection "###"?'),W=X.parent,Y=W.selectedIndex>=0?W.items[W.selectedIndex]:null,V=false;if(Y){V=Y.did===Z.did;}mstrmojo.confirm(a.replace("###",Z.n),{confirmBtn:{hot:false,fn:function(){B.call(X,[Z]);if(V){X.list.set("selectedIndex",0);}}},cancelBtn:{hot:true}});}function N(Y){var X=this;var V=mstrApp.getRootController(),Z;function W(){X.close();V.showDialog(U.dialogType.sharingDialog,{oi:Z,showSharingOptions:false});}if(!Y){return ;}if(K.isServerBasedWS()){var a={taskId:"openNativeWindow",did:Y.did,windowType:2};X.close();mstrApp.serverRequest(a,null,{});}else{V.getDataService().getObjectInfo({success:function(b){Z=b.objects[0];W();}},{objectIDs:Y.did,objectTypes:29,includeACL:true});}}function P(V){var W;if(!V.enabled){W=C.position(V.domNode);V.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(W.y+W.h+5,0),left:Math.max(W.x+W.w/2,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:mstrmojo.desc(12933,"You don't have enough privileges to perform this operation")});}}mstrmojo.DI.DIAuthenticationButton=mstrmojo.declare(mstrmojo.ui.PopupButton,null,{markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-DI-DIAuthenticationButton mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-DI-DIAuthenticationButton-text mstrmojo-ui-Pulldown-text" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{textNode:function I(){return this.domNode.firstChild;},containerNode:function O(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:Q.visibleMarkupMethod,onheightChange:Q.heightMarkupMethod,onwidthChange:Q.widthMarkupMethod,onvalueChange:function(){if(this.textNode){this.textNode.innerHTML=E.encodeHtmlString(this.value)||"";}}},value:S,selectedIndex:0,items:null,anchorSlot:"textNode",isHostedWithin:false,hostedCSSClass:"",isWaiting:false,children:[],init:function M(V){this._super(V);R.addWidgetCssClass(this.popupWidget,"ctrl-popup-list");},initChildren:function A(){this.children=this.getPopupWidgetRef();this._super();},onselectedIndexChange:function(){var V=this.items&&this.items[this.selectedIndex];if(this.selectedIndex===-1||this.selectedIndex>this.items.length-1){this.set("value",S);return ;}if(V&&V.n){this.set("value",V.n);}},updateSelectedItemById:function(X){var V=F.find(this.items,"did",X),W=this.getPopupWidget();if(V>-1){this.set("selectedIndex",V);if(W){W.set("selectedIndex",V);}}},postBuildRendering:function(){var V=mstrApp.getRootController(),W=V.getModel();if(!W.authDBRoles||W.authDBRoles.length===0){V.getAuthenticationDBRoles();}this._super();V.getModel().attachEventListener("authDBRolesChange",this.id,"update");this.update();},filteringMDBR:function(W){var X=mstrApp.getRootController("DI").getModel(),a=this.parent,Y=a.tableID,Z=X.getImportSource(Y),V=H.walk("sourceInfo.dbRoleId",Z);return F.filter(W,function(b){if(!b.isManagedDBR){return true;}else{if(!V){return false;}else{if(b.did!==V){return false;}}}return true;});},update:function(){var W=mstrApp.getRootController("DI"),Y=W.getModel().authDBRoles,Z,V,X=[];if(Y&&Y.length>0){Y=H.clone(Y);F.forEach([U.urlAuthDBRoles.anonymous,U.urlAuthDBRoles.windows,U.urlAuthDBRoles.kerberos,U.urlAuthDBRoles.integrated],function(b){V=F.find(Y,"did",b);if(V>-1){X.push(Y[V]);Y.splice(V,1);}});Y.sort(function(d,c){if(d.n<c.n){return -1;}if(d.n>c.n){return 1;}return 0;});X=X.concat(Y);}X=this.filteringMDBR(X);var a=F.find(X,"isManagedDBR",true);this.set("items",X);this.set("selectedIndex",a>=0?a:this.selectedIndex);if(a===this.selectedIndex){this.set("value",X[a].n);}Z=this.getPopupWidget();Z.list.set("items",F.map(X,function(b){if((!!mstrApp.diParams.useDatabaseInstanceManager||mstrApp.isSingleTier)&&b.did!==-1&&b.did!==U.urlAuthDBRoles.anonymous&&b.did!==U.urlAuthDBRoles.windows&&b.did!==U.urlAuthDBRoles.kerberos&&b.did!==U.urlAuthDBRoles.integrated){b.cls="edit";}return b;}));Z.list.set("selectedIndex",a>=0?a:this.selectedIndex);if(this.isWaiting){mstrApp.hideProgress();this.isWaiting=false;this.openPopup(Z);}},getSelectedDBRole:function(){var V=this.selectedIndex,W;if(V<0){W={did:-1,n:S};}else{W=this.items[this.selectedIndex];}return W;},getPopupWidget:function(){return this.popupWidget;},getPopupWidgetRef:function(){return{alias:"popupWidget",scriptClass:"mstrmojo.ui.PopupWidget",cssClass:"mstrmojo-DI-DIAuthenticationButton-Popup",visible:false,autoCloses:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"title",text:mstrmojo.desc(14887,"Connection List")},{alias:"list",cssClass:"list",scriptClass:"mstrmojo.DI.DIAuthenticationList",hasCustomScrollbar:true,executeCommand:function(X,W){switch(X){case D.EDIT:G.call(this.parent,W);break;case D.DELETE:L.call(this.parent,W);break;case D.SHARE:N.call(this.parent,W);break;}},listHooks:{select:function V(Y,Z,W){var X=this.parent;X.parent.set("selectedIndex",W);X.close();}}},{scriptClass:"mstrmojo.Box",cssClass:"bottom",alias:"bottom",children:[{scriptClass:"mstrmojo.Label",cssClass:"add",cssDisplay:"inline-block",text:J(14925,"Add a new connection..."),enabled:!!mstrApp.diParams.useDatabaseInstanceManager||mstrApp.isSingleTier,useRichTooltip:true,updateTooltipConfig:function(){P(this);},onclick:function(){var W=this.parent.parent;if(!this.enabled){return ;}W.close();mstrApp.getRootController().getDialogController().show(U.dialogType.authenticationDialog);}}]}]};},onPopupWidgetOpened:function(){var V=mstrApp.getRootController().getModel(),W=this.getPopupWidget();if(!V.authDBRolesFetched){mstrApp.showProgress();this.isWaiting=true;this.closePopup();return ;}W.list.set("mode","");W.list.set("items",this.items);W.list.set("selectedIndex",this.selectedIndex);if(!W.visible){this.openPopup(W);}W.list.updateScrollbars();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.SearchablePulldown","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.BasePanel","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.warehouse.ui.SearchBox");mstrmojo.requiresDescs(12260,9142,12259,12666,15173);var J=mstrmojo.array,K=mstrmojo.css,F="mstrmojo-wh-",H=mstrmojo.dom,B=mstrmojo.desc(12260,"%% Tables, Last cache update: $$"),L=mstrmojo.desc(9142,"Available Tables"),G=mstrmojo.desc(15173,"Edit Catalog Options"),Q=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.ui.AvailableTablesPanel=mstrmojo.declare(mstrmojo.warehouse.ui.BasePanel,null,{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",cssClass:"AvailableTables",title:L,dbTableTree:undefined,searchBox:undefined,nameSpaces:undefined,catalogSQLBtn:undefined,refreshBtn:undefined,catSQL:undefined,useRichTooltip:true,showTooltip:function M(R,U){var S=R.target||H.eventTarget(R.hWin,R.e);if(S===this.titleNode||S===this.titleTextNode){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.titleNode,top:32,content:this.titleTooltip};this._super(R,U);}},init:function N(V){this._super(V);var Y=this.searchBox,U=this.dbTableTree;Y.attachEventListener("searchTriggered",this.id,function(Z){U.userSelections={};mstrApp.getRootController().availableTableSearch(Z.searchValue);});this.addNewTitleButton({alias:"catalogSQLBtn",title:G,cssClass:F+"catalogSQL hidden",onclick:function R(){mstrApp.getRootController().displayCatalogSQL();}});var X=this,W={},S=W[this.id]={};S[Q.DBTABLES_CHANGED]=function(Z){X.set("titleTooltip",B.replace("%%",Z.items.length.toString()).replace("$$",Z.src.catalogStamp||""));};S[Q.DBROLE_SELECTION]=function(b){var c=this,a=mstrApp.getRootController(),Z=b.src.dbrs[J.find(b.src.dbrs,"did",b.value)];if(!!mstrApp.isWorkstation){K.toggleClass(this.searchBox.tableBox.refreshBtn.domNode,"btnRefreshNS-show",false);K.toggleClass(this.searchBox.tableBox.refreshBtn.domNode,"btnRefreshNS-hide",true);}else{Y.tableBox.refreshBtn.set("visible",false);}if(Z){Z.populate(function d(e){Y.clearSearch(true);K.toggleClass(c.catalogSQLBtn.domNode,"hidden",!(a.canDisplayCatalogSQL(b.src.dbObjects.dbTypes,e.mdDBRole.db_type)));if(!!mstrApp.isWorkstation){K.toggleClass(Y.tableBox.refreshBtn.domNode,"btnRefreshNS-show",Y._preSearch?Y._preSearch():false);K.toggleClass(Y.tableBox.refreshBtn.domNode,"btnRefreshNS-hide",!(Y._preSearch?Y._preSearch():false));}else{Y.tableBox.refreshBtn.set("visible",Y._preSearch?Y._preSearch():false);}});}else{if(!b.value){Y.clearSearch(true);}}};mstrApp.getRootController().attachDataChangeListeners(W);},onheightChange:function C(U){var S=mstrApp.getRootController(),V=S.dataService,R=(V==mstrmojo.qb.mdx.DataService);if(!this.nameSpaces.heightOffset){this.nameSpaces.heightOffset=21;}if(!this.heightOffset){this.heightOffset=85;}this.dbTableTree.set("height",parseInt(U.value,10)-this.heightOffset-(this.nameSpaces.visible?this.nameSpaces.heightOffset:0)-(!R&&this.searchBox.visible?this.searchBox.domNode.clientHeight:0)-(R?7:0)+"px");},onwidthChange:function E(R){if(!this.searchBox.widthOffset){this.searchBox.widthOffset=0;}var S=parseInt(R.value,10);this.searchBox.set("width",S-6-this.searchBox.widthOffset+"px");this.nameSpaces.set("width",S-12+"px");if(!!mstrApp.isWorkstation){this.nameSpaces.pulldown.set("width",parseInt(this.nameSpaces.pulldown.width,10)+4+"px");this.nameSpaces.set("width",parseInt(this.searchBox.width,10)+7+"px");}},postBuildRendering:function A(){if(this._super){this._super();}if(!!mstrApp.isWorkstation){this.searchBox.tableBox.inputBox.domNode.setAttribute("placeholder",mstrmojo.desc(12666,"Search..."));this.nameSpaces.btnRefreshNS.set("visible",true);this.searchBox.tableBox.refreshBtn.set("visible",true);K.toggleClass(this.searchBox.tableBox.refreshBtn.domNode,"btnRefreshNS-show",false);K.toggleClass(this.searchBox.tableBox.refreshBtn.domNode,"btnRefreshNS-hide",true);}},children:[{alias:"nameSpaces",scriptClass:"mstrmojo.warehouse.ui.NameSpacePullDown",sourceInfo:"tablesPanel",nameSpacesLoaded:function D(){this.parent.searchBox.clearSearch(true);this.parent.onheightChange({value:this.parent.height});},onItemSelectedCallback:function P(R){var S=this.parent.searchBox;S.clearSearch(true);mstrApp.getRootController().setNameSpaceID(R.n);if(!!mstrApp.isWorkstation){K.toggleClass(S.tableBox.refreshBtn.domNode,"btnRefreshNS-show",S._preSearch?S._preSearch():false);K.toggleClass(S.tableBox.refreshBtn.domNode,"btnRefreshNS-hide",!(S._preSearch?S._preSearch():false));}else{S.tableBox.refreshBtn.set("visible",S._preSearch?S._preSearch():false);}}},{scriptClass:"mstrmojo.warehouse.ui.SearchBox",alias:"searchBox",_preSearch:function O(){if(this.parent&&this.parent.nameSpaces.visible){return(this.parent.nameSpaces.selectedIndex!==undefined);}return true;},_onRefresh:function I(){this.clearSearch(true);mstrApp.getRootController().handleDBTableRefresh();}},{alias:"dbTableTree",scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",sourceInfo:"tablesPanel",renderOnScroll:true}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.DataGrid","mstrmojo.dom","mstrmojo.Editor","mstrmojo.RadioButton","mstrmojo.architect.ui.SQLInputBox","mstrmojo.warehouse.EnumNamespaceMode","mstrmojo.warehouse.ui.AvailableTablesTree","mstrmojo.warehouse.ui.NameSpacePullDown","mstrmojo.DI.DIHelpers");var w=mstrmojo.array,l=mstrmojo.hash,F=mstrmojo.css,Z=mstrmojo.dom,AF=mstrmojo.DI.DIHelpers,u="1",z="2",AC="0",t="2",AR="4",q=mstrmojo.warehouse.EnumNamespaceMode.ALL,AB=mstrmojo.warehouse.EnumNamespaceMode.CURRENT,AK=30,AD=57,m=40,AE=78,G=3,AN="...",Y="mstrmojo-ar-catSQL",AP=mstrmojo.desc(15173,"Edit Catalog Options"),AI=mstrmojo.desc(15174,"Select Catalog Mode"),k=mstrmojo.desc(15175,"Retrieval Mode"),S=mstrmojo.desc(12263,"Data source SQL"),b=mstrmojo.desc(12264,"ODBC calls"),a=mstrmojo.desc(8368,"Caching"),K=mstrmojo.desc(12265,"Table names only"),N=mstrmojo.desc(12266,"Table and column names"),AM=mstrmojo.desc(2057,"None"),x=mstrmojo.desc(12267,"Cannot guarantee caching when using non-default SQL"),H=mstrmojo.desc(221,"Cancel"),p=mstrmojo.desc(15176,"Edit SQL Statement:"),O=mstrmojo.desc(12268,"Namespaces"),I=mstrmojo.desc(3524,"All"),A=mstrmojo.desc(12269,"Current only"),M=mstrmojo.desc(12270,"Retrieve table and column names in the data source"),AH=mstrmojo.desc(15177,"Retrieve namespaces available in data source"),h=mstrmojo.desc(12271,"Retrieve tables available in the data source"),c=mstrmojo.desc(12272,"Retrieve columns available in the data source"),L=mstrmojo.desc(15178,"Preview Available Tables"),AQ=mstrmojo.desc(1442,"OK"),D=mstrmojo.desc(1905,"Reset"),R=mstrmojo.desc(134,"Apply"),J=mstrmojo.desc(12273,"Use default value"),C={namespace:AH,full:M,table:h,column:c},g="##EMPTY##";var AO;var e;function W(AT){return AT.replace(/[ \n\r\t]/g,"");}function AA(){var AT=new mstrmojo.Label({cssClass:Y+"-sectionTitle",text:p});this.contents.middlePanel.addChildren([AT]);}function o(Aa,AV,AX){var AW=new mstrmojo.Box({alias:"sqlBox",cssClass:Y+"-sqlBox",defaultSQL:"",useDefaultSQL:function AZ(){return(W(this.defaultSQL)===W(this.currentSQL));},currentSQL:"",resize:function AU(){var Af=this.sqlText.domNode,Ad=Z.position(Af).h,Ac=Af.offsetTop,Ab=Z.position(Af).w,Ae=this.curtain;Ae.domNode.style.height=Ad+"px";Ae.domNode.style.width=Ab+"px";Ae.domNode.style.top=Ac+"px";},children:[{scriptClass:"mstrmojo.HBox",alias:"sqlHead",cssClass:"sqlSection-box",children:[{scriptClass:"mstrmojo.Label",cssClass:Y+"-sqlLabel",text:C[AX].length>AE?C[AX].substring(0,AE-G)+AN:C[AX],title:C[AX],useRichTooltip:true,updateTooltipConfig:function(){E.call(this);}},{scriptClass:"mstrmojo.CheckBox",cssClass:Y+"-check",alias:"sqlCheck",index:AX,label:J,oncheckedChange:function AY(){var Ad=this.parent.parent,Ab=Ad.parent.parent.parent,Ac,Ae;Ad.curtain.set("visible",this.checked);Ab.changeDirtyStat(true);if(this.checked){Ad.sqlText.setSQLStatement(Ad.defaultSQL);}else{if(!Ab.loadingPanel){switch(Ab.options.cacheMode.value){case AC:Ae=N;break;case t:if(this.index==="column"){break;}Ae=K;break;case AR:break;}Ae!==undefined&&mstrmojo.alert(x,undefined,a+": "+Ae);}}Ac=Ad.sqlText.domNode.firstChild.firstChild.firstChild;Ac.style.overflowY=this.checked?"hidden":"auto";}}]},{scriptClass:"mstrmojo.architect.ui.SQLInputBox",cssClass:"mstrmojo-ar-sqlInput-inputbox visible "+Y,alias:"sqlText",postBuildRendering:function(){mstrmojo.architect.ui.SQLInputBox.prototype.postBuildRendering.call(this);this.inputBox.handlekeyup=function(Ac){var Ab=this.parent.parent.parent.parent.parent;mstrmojo.ME.TokenInputBox.prototype.handlekeyup.call(this,Ac);Ab.changeDirtyStat(true);};}},{scriptClass:"mstrmojo.Label",cssClass:Y+"-curtain",alias:"curtain"}]});this.contents.middlePanel.addChildren([AW]);var AT=AW.sqlText;F.toggleClass(AT.domNode,"full",(this.options.cacheMode.value===AC));F.toggleClass(AT.domNode,"full-column",(this.options.catalogMode.value===z));AW.resize();AW.defaultSQL=Aa[w.find(Aa,"tp",AX)]?Aa[w.find(Aa,"tp",AX)].sql:"";AW.currentSQL=AV[w.find(AV,"tp",AX)]?AV[w.find(AV,"tp",AX)].sql:"";if("namespace"===AX){if(g===AW.currentSQL){AW.currentSQL=f(AW.currentSQL);}}AT.setSQLStatement(AW.currentSQL);AW.sqlHead.sqlCheck.checked=!AW.useDefaultSQL();AW.sqlHead.sqlCheck.set("checked",AW.useDefaultSQL());return AW;}function V(Aa,AV,AY,AU){var AX=this,AW,AT,AZ;AT=Aa[w.find(Aa,"tp",AY)];AW=AV[w.find(AV,"tp",AY)];AZ=AX.contents.middlePanel.children[AU].sqlText.getSQLStatement();if(AT===undefined&&AY==="namespace"){return false;}if(AZ===AT.sql){AZ="";}AW.sql=AZ;return AW;}function Q(AX,AW,AV,AT){var AU,Aa;if((AW.value===q)){AU=l.cloneArray(AX.SQLStatements.currentSQLs.allNS);Aa=l.cloneArray(AX.SQLStatements.defaultSQLs.allNS);if(AV.value===AR){if(AX.supportsNameSpaces){AU=l.cloneArray(AX.SQLStatements.currentSQLs.allNS);Aa=l.cloneArray(AX.SQLStatements.defaultSQLs.allNS);}}else{if(AV.value===t){if(AX.supportsNameSpaces){var AZ=l.cloneArray(AX.SQLStatements.currentSQLs.allNS),AY=l.cloneArray(AX.SQLStatements.defaultSQLs.allNS);AU[w.find(AU,"tp","column")]=AZ[w.find(AZ,"tp","column")];Aa[w.find(Aa,"tp","column")]=AY[w.find(AY,"tp","column")];}}}}else{AU=l.cloneArray(AX.SQLStatements.currentSQLs.currentNS);Aa=l.cloneArray(AX.SQLStatements.defaultSQLs.currentNS);}if(AT){return AU;}return Aa;}function E(){var AT=Z.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+AT.h*1.2,0),left:Math.max(AT.x+AT.w*0.5,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}function B(){var AV=this,AT=new mstrmojo.Box({alias:"sqlPreviewBox",cssClass:Y+"-sqlBox",children:[{scriptClass:"mstrmojo.Label",cssClass:Y+"-sqlPreviewLabel",text:L.length>m?L.substring(0,m-G)+AN:L,title:L,useRichTooltip:true,updateTooltipConfig:function(){E.call(this);}},{scriptClass:"mstrmojo.Box",cssClass:Y+"-preview",alias:"sqlPreviewContents",children:[new mstrmojo.warehouse.ui.NameSpacePullDown({alias:"nameSpaces",sourceInfo:"CatSQL",keepNamespacesVisible:true,catalogRefreshNS:function(){var AX=mstrApp.getRootController(),AY=AX.model,AZ=AV.btnHbox.applyBtn;if(AV.isDirty){mstrmojo.confirm(mstrmojo.desc(15180,"Catalog SQL statement modification will be applied firstly before you preview catalog."),{confirmBtn:{fn:function(){AZ.onclick(function(){AY.catalogRefresh=true;AY.sourceInfo="CatSQL";AX.updateSelectedDBRoleId();});},t:mstrmojo.desc(134,"Apply")},cancelBtn:{fn:function(){}}},{title:mstrmojo.desc(15185,"Apply SQL statement")});}else{AY.catalogRefresh=true;AY.sourceInfo="CatSQL";AX.updateSelectedDBRoleId();}},nameSpacesLoaded:function(){if(this.parent.parent.parent){var AY=this.parent.parent.parent.parent.parent,AX=AY.options.nsMode;if(AX.value===q){this.pulldown.set("items",[]);mstrApp.rootController.availableTableSearch("",{dbRoleID:AY.dbRole.did,nameSpace:"",getFresh:true,sourceInfo:"CatSQL"});}}},onItemSelectedCallback:function AW(AY){AV.selectedNS=AY.n;var AX=AV.btnHbox.applyBtn;if(AV.isDirty&&AY.n!==""){mstrmojo.confirm(mstrmojo.desc(15180,"Catalog SQL statement modification will be applied firstly before you preview catalog."),{confirmBtn:{fn:function(){AX.onclick();},t:mstrmojo.desc(134,"Apply")},cancelBtn:{fn:function(){}}},{title:mstrmojo.desc(15185,"Apply SQL statement")});}else{if(AV.options.nsMode.value!==q){mstrApp.rootController.availableTableSearch("",{dbRoleID:AV.dbRole.did,nameSpace:AV.selectedNS||"",getFresh:AV.isDirty,sourceInfo:"CatSQL"});}}},onvisibleChange:function(){var AX=(this.domNode&&this.domNode.clientWidth)||parseInt(this.width,10);if(this.visible&&typeof AX==="number"&&AX>0){this.pulldown.set("width","144px");if(this.waitBoxTip){this.waitBoxTip.adjustCorners();}}}})]},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesTree",alias:"dbTableTree",cssClass:"mstrmojo-wh-AvailableTablesTree "+Y+"-dbTablesTree",sourceInfo:"CatSQL",editor:AV,postCreate:function AU(){this.ondblclick=function(){};if(this.editor.options.catalogMode.value===z){this.cssClass+="-none";}}}]});this.contents.rightPanel.addChildren([AT]);}function U(){var AT,AU=this.parent.count,AV=this.parent.prefix;if(this.checked){for(AT=0;AT<AU;AT++){this.parent[AV+AT].set("checked",false);}this.set("checked",true);}}function P(AU){var AT=l.walk("dbRole.mdDBRole",AU);return AF.isdbRoleWritable(AT);}function d(AU){var AT=l.walk("dbRole.mdDBRole",AU);return AT&&AT.usable==="1";}function AL(){var AY=this,Ad=AY.options,AX=AY.contents.middlePanel,AZ=AY.contents.rightPanel,AV,AT,Ac,AW,AU;if(AY.loading){return ;}this.loadingPanel=true;AX.removeChildren();AA.call(AY);AT=Q(AY,Ad.nsMode,Ad.cacheMode,true);Ac=Q(AY,Ad.nsMode,Ad.cacheMode,false);e=[];e.push(o.call(AY,Ac,AT,"namespace"));if(Ad.catalogMode.value===u){switch(Ad.cacheMode.value){case AC:AW=o.call(AY,Ac,AT,"full");e.push(AW);break;case t:case AR:e.push(o.call(AY,Ac,AT,"table"));e.push(o.call(AY,Ac,AT,"column"));break;default:break;}}AZ.sqlPreviewBox&&AZ.sqlPreviewBox.sqlPreviewContents.nameSpaces.destroy();AZ.removeChildren();B.call(AY);AU=AY.contents.rightPanel.sqlPreviewBox.sqlPreviewContents.nameSpaces;AU.domNode.style.visibility=(AY.supportsNameSpaces?"":"hidden");AU.selectedIndex=undefined;AY.selectedNS=undefined;if(AY.supportsNameSpaces){if(AY.defaultOptions.nsMode.value===q&&AY.options.nsMode.value===AB){AU.keepNamespacesIndexUnselectedBeforeLoading=true;}AU.pulldown.set("visible",true);AU.labelNS.set("visible",true);AU.set("visible",true);AU.btnRefreshNS.set("visible",true);}this.loadingPanel=false;var Aa=P(AY),Ab=d(AY);AY.btnHbox.applyBtn.set("enabled",Aa&&Ab);AY.btnHbox.okBtn.set("enabled",Aa&&Ab);AU.btnRefreshNS.set("enabled",Aa&&Ab);}function f(AU){var AT;switch(AU){case"":AT=g;break;case g:AT="";break;default:AT=AU;break;}return AT;}mstrmojo.warehouse.ui.editors.CatalogSQLEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.warehouse.ui.editors.CatalogSQLEditor",cssClass:Y,title:AP,isDirty:false,changeDirtyStat:function(AT){this.isDirty=AT;this.btnHbox.applyBtn.set("enabled",P(this)&&d(this)&&AT);},hasApplied:false,options:{},SQLStatements:[],onUpdateInfo:undefined,supportsNameSpaces:false,dbRole:undefined,sql:"",curtain:undefined,useDefaultSQL:undefined,contents:undefined,middlePanel:undefined,rightPanel:undefined,sqlPreviewBox:undefined,sqlPreviewContents:undefined,leftPanel:undefined,currentSQLs:undefined,defaultSQLs:undefined,catalogModeRBBox:undefined,catalogModeRB0:undefined,catalogModeRB1:undefined,cacheMode:undefined,nsMode:undefined,catalogMode:undefined,sqlCheck:undefined,allNS:undefined,currentNS:undefined,cacheModeRBBox:undefined,nsModeRBBox:undefined,nsModeRB1:undefined,applyBtn:undefined,okBtn:undefined,revertBtn:undefined,closeBtn:undefined,cbkOnClose:mstrmojo.emotyFn,browserResized:function AJ(AT){var AU=parseInt(AT.w,10);AO=AT;if(isNaN(AU)||AU<0||!this.domNode){return ;}if(AU<948){AU=1110;}else{if(AU>1063){AU=1110;}else{AU=Math.ceil(AU*0.95);}}this.domNode.children[0].style.width=AU+"px";this.contents.middlePanel.domNode.style.width=(AU-219-281)+"px";w.forEach(e,function(AV){AV.resize();});this.btnHbox.revertBtn.domNode.style.marginRight=(AU-316)+"px";},collectOptions:function AS(){var AY=this,Ab=AY.options,AX=Ab.catalogMode,AZ=Ab.nsMode,AT=Ab.cacheMode,AU,Aa,AW=[];AW.push(AX);AW.push(AZ);AW.push(AT);AU=Q(AY,AZ,AT,true);Aa=Q(AY,AZ,AT,false);var AV=V.call(AY,Aa,AU,"namespace",1);if(AV!==false){if(false===AY.contents.middlePanel.children[1].sqlHead.sqlCheck.checked&&W(AY.contents.middlePanel.children[1].sqlText.getSQLStatement())===""){AV.sql=f(AV.sql);}AW.push(AV);}if(Ab.catalogMode.value===u){switch(AT.value){case AC:AW.push(V.call(AY,Aa,AU,"full",2));break;case t:AW.push(V.call(AY,Aa,AU,"table",2));AW.push(V.call(AY,Aa,AU,"column",3));break;case AR:AW.push(V.call(AY,Aa,AU,"table",2));AW.push(V.call(AY,Aa,AU,"column",3));break;}}return AW;},defaultOptions:undefined,applyOptions:function X(AX){var AW,AV=AX?AX:this.options,AU=this.contents.leftPanel;var AT=(w.find(mstrApp.rootController.getDBObjects().catalogDbTypes,"v",this.dbRole.mdDBRole.db_type)>=0);AU.catalogModeRBBox.catalogModeRB0.set("enabled",AT);if((AV.catalogMode.value===u)&&AT){AW=0;}else{AW=1;}AU.catalogModeRBBox["catalogModeRB"+AW].set("checked",true);AU.catalogModeRBBox["catalogModeRB"+AW].onclick();AU.nsModeRBBox.nsModeRB1.set("enabled",this.supportsNameSpaces);if(this.supportsNameSpaces){if(AV.nsMode.value===AC){AW=0;}else{AW=1;}}else{AW=0;}AU.nsModeRBBox["nsModeRB"+AW].set("checked",true);AU.nsModeRBBox["nsModeRB"+AW].onclick();if(AV.cacheMode.value===AC){AW=0;}else{if(AV.cacheMode.value===t){AW=1;}else{if(AV.cacheMode.value===AR){AW=2;}}}AU.cacheModeRBBox["cacheModeRB"+AW].set("checked",true);AU.cacheModeRBBox["cacheModeRB"+AW].onclick();},checkSqlSection:function(){var AT=this,AV=AT.contents.middlePanel,AU=AV.children.slice(1);w.forEach(AU,function(AX,AW){AX.sqlHead.sqlCheck.set("checked",true);},AT);},onOpen:function n(){var AU=this.contents.leftPanel,AT,AV,AW;this.loading=true;this.defaultOptions=l.clone(this.options);this.applyOptions();this.hasApplied=false;this.selectedNS=undefined;this.loading=false;AL.call(this);AV=this.domNode.children[0];AW=parseInt(AV.style.top,10);if(AW<0){AV.style.top="0px";}if(AO){this.browserResized(AO);Z.center(AV);}this.changeDirtyStat(false);},onClose:function(){this.cbkOnClose.call(this);},children:[{scriptClass:"mstrmojo.HBox",alias:"contents",cssClass:"catsql-hbox",children:[{scriptClass:"mstrmojo.Box",cssClass:Y+"-leftPanel",alias:"leftPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:Y+"-sectionTitle",text:AI.length>AK?AI.substring(0,AK-G)+AN:AI,title:AI,useRichTooltip:true,updateTooltipConfig:function(){E.call(this);}},{scriptClass:"mstrmojo.Label",cssClass:Y+"-sectionSubTitle",text:k},{scriptClass:"mstrmojo.Box",cssClass:Y+"-sectionBox",count:2,prefix:"catalogModeRB",alias:"catalogModeRBBox",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:S,index:0,alias:"catalogModeRB0",onclick:function AG(){U.call(this);},oncheckedChange:function j(){}},{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:b,index:1,alias:"catalogModeRB1",onclick:function AG(){U.call(this);},oncheckedChange:function j(){var AT=this.parent.parent.parent.parent;AT.changeDirtyStat(true);AT.options.catalogMode.value=(this.checked?z:u);AL.call(AT);}}]},{scriptClass:"mstrmojo.Label",cssClass:Y+"-sectionSubTitle",text:O},{scriptClass:"mstrmojo.Box",cssClass:Y+"-sectionBox",count:2,alias:"nsModeRBBox",prefix:"nsModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:I,index:0,alias:"nsModeRB0",onclick:function AG(){U.call(this);},oncheckedChange:function j(){if(!this.checked){return ;}var AT=this.parent.parent.parent.parent;AT.options.nsMode.value=q;AT.changeDirtyStat(true);AL.call(AT);}},{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:A,index:1,alias:"nsModeRB1",onclick:function AG(){U.call(this);},oncheckedChange:function j(){if(!this.checked){return ;}var AT=this.parent.parent.parent.parent;AT.options.nsMode.value=AB;AT.changeDirtyStat(true);AL.call(AT);}}]},{scriptClass:"mstrmojo.Label",cssClass:Y+"-sectionSubTitle",text:a},{scriptClass:"mstrmojo.Box",cssClass:Y+"-sectionBox",count:3,alias:"cacheModeRBBox",prefix:"cacheModeRB",children:[{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:N,index:0,alias:"cacheModeRB0",onclick:function AG(){U.call(this);},oncheckedChange:function j(){if(!this.checked){return ;}var AT=this.parent.parent.parent.parent;AT.changeDirtyStat(true);AT.options.cacheMode.value=AC;AL.call(AT);}},{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:K,index:1,alias:"cacheModeRB1",onclick:function AG(){U.call(this);},oncheckedChange:function j(){if(!this.checked){return ;}var AT=this.parent.parent.parent.parent;AT.changeDirtyStat(true);AT.options.cacheMode.value=t;AL.call(AT);}},{scriptClass:"mstrmojo.RadioButton",cssClass:Y+"-option",label:AM,index:2,alias:"cacheModeRB2",onclick:function AG(){U.call(this);},oncheckedChange:function j(){if(!this.checked){return ;}var AT=this.parent.parent.parent.parent;AT.changeDirtyStat(true);AT.options.cacheMode.value=AR;AL.call(AT);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:Y+"-middlePanel",alias:"middlePanel",children:[]},{scriptClass:"mstrmojo.Box",cssClass:Y+"-rightPanel",alias:"rightPanel",children:[]}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+Y+"-button mstrmojo-ar-catSQL-revertBtn",text:D,alias:"revertBtn",onclick:function AG(){var AT=this.parent.parent;mstrmojo.confirm(mstrmojo.desc(15181,"Do you want to revert all modifications to default value?"),{confirmBtn:{hot:false,fn:function(){var AU=AT.defaultOptions;AT.applyOptions(AU);AT.checkSqlSection();}},cancelBtn:{fn:function(){}}},{title:mstrmojo.desc(15182,"Revert to Default Value")});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+Y+"-button",text:R,alias:"applyBtn",enabled:false,onclick:function AG(AV){var AT=this.parent.parent,AU=AT.collectOptions();dbr=AT.dbRole.mdDBRole;if(P(AT)){AT.onUpdateInfo({options:AU,callback:function(){if(AT.selectedNS){mstrApp.rootController.availableTableSearch("",{dbRoleID:AT.dbRole.did,nameSpace:AT.selectedNS||"",getFresh:AT.isDirty,sourceInfo:"CatSQL"});}AT.changeDirtyStat(false);AT.hasApplied=true;typeof AV==="function"&&AV();}});}else{return ;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+Y+"-button",text:AQ,alias:"okBtn",onclick:function AG(){var AT=this.parent,AU=AT.parent;if(AU.isDirty){AT.applyBtn.onclick(function(){AT.closeBtn.onclick();});}else{AT.closeBtn.onclick();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton "+Y+"-closeBtn",text:H,alias:"closeBtn",onclick:function AG(){var AT=this.parent.parent,AU=function AU(){w.forEach(AT.contents.rightPanel.sqlPreviewBox.dbTableTree.items,function(AV){delete AV.items;});AT.close();};if(AT.isDirty){mstrmojo.confirm(mstrmojo.desc(15183,"The SQL statement modification has not been saved applied, do you still want to leave and discard the SQL modification?"),{confirmBtn:{t:mstrmojo.desc(15186,"Leave"),hot:false,fn:function(){AU();}},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:function(){}}},{title:mstrmojo.desc(15184,"Discard SQL modification")});}else{AU();}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.qb.DataService","mstrmojo.DI.DIProjectDBRoleEditor","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(12815,13098);var E=mstrmojo.array;mstrmojo.DI.controller.DIRemoteProjectsController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIRemoteProjectsController",dbRoleID:"",hadoopConnURL:"",dbRole:"",saveDBRole:function J(P,O){var N=mstrApp.getRootController(),Q=this;O.set("visible",false);O.close();N.getDataService().saveDBRole({success:function R(S){Q.dbRoleID=S.dbr.did;N.model.raiseEvent({name:"projectDBRoleSaved",data:{dbrid:S.dbr.did,dbrn:S.dbr.n}});},fail:function M(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(P)});},deleteDBRole:function L(Q){var N=mstrApp.getRootController(),O=this;N.getDataService().deleteDBRole({success:function P(R){O.dbRoleID=undefined;O.dbRole=undefined;N.model.raiseEvent({name:"deleteDBRole"});},fail:function M(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{objectid:Q});},loadRemoteProjectsDBRole:function H(){var M=mstrApp.getRootController(),O=this,N=[];var P={success:function(Q){var R=Q.dbrs;if(R){E.forEach(R,function(S){if(S.dbr_type==="5"){N.push({dbrid:S.did,dbrn:S.n});}});}if(N){M.model.raiseEvent({name:"projectsDBRoleLoaded",data:N});}},failure:function(){O.displayError(mstrmojo.desc(12815,"Error when loading DB Roles."));}};M.getDataService().loadDBRoles(P,{});},loadDBRoleByID:function G(Q,O){var P=this,N=new mstrmojo.DI.DIRemoteProjectDBRole(),M=mstrApp.getRootController();N.mdDBRole.did=Q;N.populate(function(S){var R=S.mdDBRole.connstr;E.forEach(R.split(";"),function(V){var U=V.split("=");S[U[0].trim().toLowerCase()]=U[1];});P.dbRoleID=Q;P.dbRole=N;if(O){M.model.raiseEvent({name:"DuplicateDBRole"});}else{M.model.raiseEvent({name:"DBRoleLoadedById"});}});},populateDBRole:function D(N,O){var M=mstrApp.getRootController();M.model.populateDBRole(N,O);},renderDBRoleEditor:function I(N){var M=mstrmojo.all.projectDBRoleEditor;if(M){M.set("dbrole",N);M.open();}else{mstrmojo.insert(new mstrmojo.DI.DIProjectDBRoleEditor({zIndex:9999}));M=mstrmojo.all.projectDBRoleEditor;M.set("dbrole",N);M.render();}},editDBRole:function F(M){this.loadDBRoleByID(M);},getProjectSourceFolderId:function K(N){var M=mstrApp.getRootController();var O={dbrid:N};var P={success:function(Q){mstrApp.getRootController().model.raiseEvent({name:"getFolderId",data:Q});},failure:function(){mstrApp.getRootController().model.raiseEvent({name:"getFolderIdFailure"});mstrmojo.alert(mstrmojo.desc(13098,"Invalid Username, Password. Please check your login credentials to browse the Project"));}};M.dataService.fetchRemoteFolderID(P,O);},getProjectsFromRemote:function A(Q,O){var M=mstrApp.getRootController();var N={serverName:Q,serverPort:O};var P={success:function(R){mstrApp.getRootController().model.raiseEvent({name:"projectsLoaded",data:R});},failure:function(){}};M.dataService.getProjectsFromRemote(P,N);},duplicateDBRole:function B(M){this.loadDBRoleByID(M,true);},duplicate:function C(){var M=this.dbRole,O=new mstrmojo.DI.DIRemoteProjectDBRole({mdDBRole:M.mdDBRole}),N="Duplicate "+M.n;O.hostname=M.hostname;O.Port=M.Port;O.ProjectID=M.ProjectID;O.did="";O.mdDBRole.did="";O.mdDBRole.n=N;O.n=N;O.des=N;O.mdDBRole.ln=M.mdDBRole.ln;O.mdDBRole.connstr="";delete O.mdDBRole.password;this.renderDBRoleEditor(O);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingTableContainer","mstrmojo.qb.DBTableLinker","mstrmojo.DI.DIConstants","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.array","mstrmojo.DI.DILabel");mstrmojo.requiresDescs(531,12730,14871);var R=mstrmojo.DI.DIConstants,Q,L=1500,G=590,C=4000,O=mstrmojo.array,M=mstrmojo.dom,P=mstrmojo.css;function E(){var U=document.createElement("v:rect"),S=U.style;U.setAttribute("id","vmlFrame");U.setAttribute("stroke","true");U.setAttribute("strokecolor","red");S.width=this.width;S.height=this.height;S.zindex="-1";document.getElementById("vmlCanvas").appendChild(U);}function A(){if(this.highlight){this.highlight.clearRect(0,0,L,G);this.hl_link=null;this.highlight.beginPath();}}function J(V,Y,U,X){if(Q){var W=this.context=this.context||this.canvas.getContext("2d");W.lineJoin="round";W.lineCap="round";W.moveTo(V,Y);W.lineTo(U,X);}else{var S=document.createElement("v:line");S.setAttribute("from",[V," ",Y].join(""));S.setAttribute("to",[U," ",X].join(""));document.getElementById("vmlCanvas").appendChild(S);}}function I(){var U=mstrApp.getRootController(),S=U.model;S.isAddingNewTable=true;var V=S.isFromPushApi();if(V){U.displayError(mstrmojo.desc(14871,'"Add a new table" option is currently not available for datasets that have a table that are created via the MicroStrategy Data Push api.'),false);}else{mstrApp.set("DIEmbeded",true);U.showDialog(R.dialogType.diPageDialog,{pageType:R.pageType.dataSelection,left:"200px",top:"115px",cssClass:"mstrmojo-di-homepage-editor"});}}function B(){var U,S;if(this.hasRendered&&this.domNode instanceof HTMLElement){U=this.domNode.getElementsByTagName("canvas");S=U[0]&&U[0].height;}return S?S:G;}mstrmojo.DI.DITablePanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DITablePanel",markupString:'<div id="{@id}" class="mstrmojo-di-DBTablePanel cf {@cssClass}" ><div class="button-node"></div><div class="container-node"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},buttonNode:function(){return this.domNode.children[0];}},setDimensions:function K(V,S){var U=parseInt(S,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.buttonNode="100%";this.layoutConfig.h.containerNode="100%";this.layoutConfig.w.buttonNode="220px";this.layoutConfig.w.containerNode=(U-220-30)+"px";if(this._super){this._super(V,S);}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},tableContainer:undefined,joinInfos:[],children:[{scriptClass:"mstrmojo.qb.DBTableLinker",alias:"linker",clearLinks:function H(){if(Q){var V=this.context,U=B.call(this);if(V&&V.clearRect){V.clearRect(0,0,L,U);V.beginPath();}}else{var S=document.getElementById("vmlCanvas");if(S&&S.hasChildNodes()){while(S.childNodes.length>=1){S.removeChild(S.firstChild);}E.call(this);}}A.call(this);},drawLink:function(W,l,o,U){var V=this.canvas;Q=V&&V.getContext&&V.getContext("2d");var Y=mstrmojo.dom.position(this.domNode),S=8,c,n,m,Z,j,h,d,b,a,e,f,X,k,g;m=M.position(l.domNode);Z=M.position(U.domNode);a=m.y+l.headerNode.clientHeight*1.5-Y.y;e=Z.y+U.headerNode.clientHeight*1.5-Y.y;f=m.y+l.domNode.clientHeight-Y.y;X=Z.y+U.domNode.clientHeight-Y.y;c=M.position(W).y;n=M.position(o).y;j=m.x+m.w-Y.x;h=Math.max(c+0.5*W.clientHeight-Y.y,a);d=Z.x-Y.x;b=Math.max(n+0.5*o.clientHeight-Y.y,e);k=j<d;g=k?S:-S;j-=k?0:m.w;d+=k?0:Z.w;if(f-118>=h&&X-118>=b){J.call(this,j,h,j+g,h);J.call(this,j+g,h,d-g,b);J.call(this,d-g,b,d,b);}else{if(f-118<h&&X-118>b){J.call(this,j,a,j+g,a);J.call(this,j+g,a,d-g,b);J.call(this,d-g,b,d,b);}else{if(f-118>h&&X-118<b){J.call(this,j,h,j+g,h);J.call(this,j+g,h,d-g,e);J.call(this,d-g,e,d,e);}}}if(Q){this.context.strokeStyle="#999999";this.context.stroke();}},drawLinks:function F(Z){var V=this.parent.tableContainer.joinInfos,W=Z.oid,U=Z.oids;var Y=this,a,X,S,b;O.forEach(V.joins,function(c){a=c.sourceTable;X=c.targetTable;if(a&&X){O.forEach(c.links,function(e,d){if((!!W&&e.source.oid===W)||(!!U&&O.indexOf(U,e.source.oid)>=0)){S=a.attrRows.getRowNode("did",e.source.did);b=X.attrRows.getRowNode("did",e.target.did);Y.drawLink(S,a,b,X,d,c);}});}});},postCreate:function D(){if(this._super){this._super();}var S=this.parent.parent.model;S.attachEventListener("MappingsFetched",this.id,"clearLinks");},postBuildRendering:function N(){if(mstrmojo.qb.DBTableLinker.prototype.postBuildRendering){mstrmojo.qb.DBTableLinker.prototype.postBuildRendering.call(this);}this.clearLinks();}},{scriptClass:"mstrmojo.DI.DIMappingTableContainer",cssClass:"mstrmojo-di-tableview",alias:"tableContainer"},{slot:"buttonNode",scriptClass:"mstrmojo.Label",alias:"background",cssClass:"plus-background",onclick:function(S){mstrmojo.dom.stopPropogation(S.hWin,S.e);I.call(this);},enabled:true,onenabledChange:function(){P.toggleClass(this.domNode,"disable-button",!this.enabled);this.set("enabled",this.enabled);}},{slot:"buttonNode",scriptClass:"mstrmojo.DI.DILabel",cssClass:"button-label button",alias:"background-button",text:mstrmojo.desc(12730,"Add a new table"),onclick:function(S){mstrmojo.dom.stopPropogation(S.hWin,S.e);I.call(this);},onmouseover:function(){if(this.enabled){P.removeClass(this.domNode,"button-label");P.addClass(this.domNode,"button-label-hover");P.removeClass(this.parent.background.domNode,"plus-background");P.addClass(this.parent.background.domNode,"plus-background-hover");}},onmouseout:function(){if(this.enabled){P.addClass(this.domNode,"button-label");P.removeClass(this.domNode,"button-label-hover");P.addClass(this.parent.background.domNode,"plus-background");P.removeClass(this.parent.background.domNode,"plus-background-hover");}},enabled:true,onenabledChange:function(){P.toggleClass(this.domNode,"disable-button",!this.enabled);this.set("enabled",this.enabled);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.AS.DIAppSchemaService");mstrmojo.requiresDescs(9935,15600);var C=mstrmojo.DI.DIDatabaseHelper,F=mstrmojo.hash,B="mstrmojo-Tooltip",E="mstrmojo-scrollNode",D=mstrmojo.DI.DIHelpers;mstrmojo.AS.DIAppSchemaRepublishOAuthButton=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.AS.DIAppSchemaRepublishOAuthButton",cssClass:"",sourceType:"",isLogin:false,tableId:"",pipelineId:"",markupString:'<div id="{@id}" class="cf {@cssClass}" ><div style="display: inline-block;"></div><div style="display: inline-block; height: 15px;"></div></div>',markupSlots:{loginNode:function(){return this.domNode.children[0];},accountNode:function(){return this.domNode.children[1];}},children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(9935,"Log In"),slot:"loginNode",alias:"login",bindings:{visible:function(){return !this.parent.isLogin;}},onclick:function(){var J=this,G=mstrApp.getRootController(),H=mstrApp.getRootController().getModel(),I=this.parent.sourceType;if(!(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier||$DIHelper.isServerBasedWS())){mstrmojo.alert(mstrmojo.desc(15600,"We are unable to connect to this data source because your web server is not set up for HTTPS connections. Please contact your administrator."));return ;}G.gotoOAuthLogin(I);H.externalSources[I].attachEventListener("oAuthReportsFetched",this.id,function(){this.parent.isLogin=true;var K={workspace_id:H.workspaceId,pipeline_id:this.parent.pipelineId,table_id:this.parent.tableId,};var L={success:function(N){var M=mstrApp.getRootController().getModel();M.externalSources[J.parent.sourceType].isLogin=true;M.raiseEvent({name:"OAuthInfoUpdate"});},failure:function(M){mstrmojo.alert("Update DBRole failed");}};mstrmojo.AS.DIAppSchemaService.checkConnection(K,L);});}},{scriptClass:"mstrmojo.HBox",alias:"account",slot:"accountNode",bindings:{visible:function(){return this.parent.isLogin;}},children:[{scriptClass:"mstrmojo.Label",alias:"icon",cssClass:"mstrmojo-accountIcon",},{scriptClass:"mstrmojo.Label",alias:"account",cssClass:"mstrmojo-accountId",useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.text,refNode:this.domNode,top:-32,},onclick:function(H){var G=0;if(D.getEnvObj().isAppSchema()&&this.parent.parent.parent&&this.parent.parent.parent.scriptClass==="mstrmojo.DI.DIAppSchemaRepublishTreeNode"){G=-350;}if(this.detailTooltip.visible){this.detailTooltip.close();}else{this.detailTooltip.open({richTooltip:{cssClass:"vi-regular vi-tooltip-A mojo-theme-light",content:this.text,posType:mstrmojo.tooltip.POS_TOPLEFT,refNode:this.domNode,top:30,left:-10+G}},{e:H});this.detailTooltip.contentNodeCssText="font-size: 14px; line-height: 26px";this.detailTooltip.visible=true;}},preBuildRendering:function A(){var L=this,G=mstrApp.getRootController(),J=mstrApp.getRootController().getModel(),K=L.parent.parent.sourceType;this.text=J.externalSources[K]&&J.externalSources[K].userDisplayName;this.detailTooltip=new mstrmojo.Tooltip({preBuildRendering:function I(){if(this._super){this._super();}this.email=J.externalSources[K]&&J.externalSources[K].userEmail;this.markupString='<div id="{@id}" class="'+B+' {@cssClass}" style="{@cssText}"><div class="'+B+'-shadow {@shadowNodeCssClass}"></div><div class="'+B+'-contentWrapper"><div class="'+B+"-content "+E+' {@contentNodeCssClass}" style="background-color: #fff"></div><div style="max-width: 140px; word-break: break-all; opacity: 0.45; font-size: 12px; line-height: 16px">{@email}</div><hr><div id="{@id}_signOut" style="padding-left:34px; font-size:12px; color:#3B92ED; line-height:26px; visibility : visible" type="button" mstrAttach:click";>Sign out</div></div><div class="'+B+'-arrow"></div></div>';},onclick:function H(M){if(M.e.currentTarget.id===this.id+"_signOut"){this.close();G.oAuthSignOut(K);J.externalSources[K].isLogin=false;J.raiseEvent({name:"OAuthInfoUpdate"});}}});}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.css","mstrmojo.AjaxCall","mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.Label","mstrmojo.ListBase","mstrmojo.ui.CheckList","mstrmojo.ui.ColumnContainer","mstrmojo.rw.ConditionWalkProviderBase","mstrmojo.elementHelper");var G=mstrmojo.css,X=mstrmojo.hash,u=mstrmojo.array,W=mstrmojo.expr,M=W.ET,Z=W.ET2TGT,Y=W.FN,S=W.FN_MRP,n=W.DTP2FN_DTP,E=mstrmojo.meta.TP,AD=W.TP,J=W.STP,l=mstrmojo.elementHelper,q=mstrmojo.rw.ConditionWalkProviderBase;var P={};P[M.AQ]={target:1,fm:1,fn:1,c0:1,c1:1};P[M.AL]={target:1,fm:1,fn:1,c0:1};P[M.AE]={target:1,fm:1,es:1};P[M.AC]={target:1,fm:1,fm2:1,fm3:1,fn:1,c0:1,c1:1};P[M.MQ]={target:1,fn:1,c0:1,c1:1,dmy:1};P[M.MC]=P[M.MQ];P["*"]={target:1};var z={};z[M.MQ]={key:"metricFns",def:W.METRIC_FNS};z[M.MC]={key:"metricFns",def:W.METRIC_FNS};z[M.AQ]={key:"formFns",def:W.FORM_FNS};z[M.AL]={key:"formFns",def:W.FORM_FNS};z[M.AC]={key:"formFns",def:W.FORM_FNS};z[M.AE]={key:"elemFns",def:W.ELEM_FNS};var AI=mstrmojo.desc(14084,"Select a filter option or a qualification."),AH=mstrmojo.desc(15007,"Choose to select in list or qualify on an attribute form."),AG=mstrmojo.desc(14085,"Select one or more elements."),N=mstrmojo.desc(15009,"Select element(s)."),AF=mstrmojo.desc(14086,"Select an operator."),AE=mstrmojo.desc(14087,"Enter a value or select an attribute from the list."),C=mstrmojo.desc(15010,"Enter a specific value or select an attribute form as variable."),AC=mstrmojo.desc(14088,"Select an attribute form. When done, click ## button.").replace("##",'""'),AB=mstrmojo.desc(14089,"Select a condition."),AK=mstrmojo.desc(15011,"Select an operator."),AA=mstrmojo.desc(14090,"Enter a value or select a metric from the list."),R=mstrmojo.desc(15012,"Enter a specific value or select a metric as variable.");var k=0,t=1;var H=mstrmojo.ui.ColumnContainer.prototype.updateColumnContainer;var e="dummy",I={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:e,css:"unselectable"},p={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:e,css:"unselectable"},AJ={did:"idSelect",v:"idSelect",n:mstrmojo.desc(547,"Select"),t:e,css:"unselectable"},x={did:"idWait",v:"idQualification",n:mstrmojo.desc(5225,"Qualification"),t:e,css:"unselectable"},D={did:"idWait",v:"idQualification",n:mstrmojo.desc(15008,"Qualify on"),t:e,css:"unselectable"};var b=q.onWalkChange,F=q.replaceItem,L=q.getChildJSON,w=q.walkChildPostCreateFn,o=q.updateList,AO=q.fnItem,AN=q.isComparisonAllowed,h=q.cstJson,f=q.fmJson,d=q.updateListMulti,m=q.updateListMultiData;function j(AP){return AP.targets?u.filter(AP.targets,function(AQ){return AQ[E]===W.TP.ATTR;}):[];}function K(AP){this.tip.set("text",AP);}var V=[W.STP.PROMPT,W.STP.PROMPT_OBJECTS,W.STP.PROMPT_ELEMENTS,W.STP.PROMPT_EXPRESSION,W.STP.PROMPT_EXPRESSION_DRAFT];var AM=q.allowedTargetTypes;mstrmojo.rw.ConditionWalkProvider=mstrmojo.declare(mstrmojo.rw.ConditionWalkProviderBase,null,{scriptClass:"mstrmojo.rw.ConditionWalkProvider",browseEs:function c(AS,AR,AU){AS.openPopup("eb",{zIndex:AS.parent.zIndex+10,left:Math.round(AU.x)+"px",top:Math.round(AU.y)+"px"});var AQ=AS.eb.browser,AP=AS.model,AT=AP&&AP.a&&AP.a.did;if(!AT){return ;}AQ.set("attributeID",AT);AQ.set("selectedItems",AP.es?X.clone(AP.es):[]);AQ.initBrowser();},browseObjs:function AL(AW,AP,AQ){AW.openPopup("ob",{zIndex:AW.parent.zIndex+10,left:Math.round(AQ.x)+"px",top:Math.round(AQ.y)+"px"});var AR=AW.ob.browser;AR.target=AP;var AS;switch(AP.alias){case"dmy":AS=[W.TP.ATTR,W.TP.DIM];break;case"c0":case"c1":var AU=AW.model,AT=AU&&AU.et,AX=AU&&AU.fm,AV=AX&&AX.dtp||(AU.m?W.DTP.DECIMAL:W.DTP.UNKNOWN);AS=(AT===M.MQ||AT===M.MC)?[W.TP.METRIC,W.DTP2PROMPT_STP[AV]]:[W.TP.ATTR,W.DTP2PROMPT_STP[AV]];break;default:AS=AM(AW.ets);AS=AS?X.keyarray(AS,true):[W.TP.ATTR,W.TP.METRIC,W.STP.REPORT_GRID,W.STP.REPORT_GRAPH,W.STP.REPORT_ENGINE,W.STP.REPORT_TEXT,W.STP.REPORT_DATAMART,W.STP.REPORT_BASE,W.STP.REPORT_GRIDGRAPH,W.STP.REPORT_NONINTERACTIVE,W.STP.FILTER].concat(V);}AS[AS.length]=W.TP.FOLDER;AR.browse({rootFolderType:AU&&(AU.et===M.MQ||AU.et===M.MC)?5:26,folderLinksContextId:33,onSelectCB:[AW,"onOBSelect"],browsableTypes:AS.join(",")});},getFm2NodeProps:function U(){return{alias:"fm2",children:[f({alias:"fm2",fmPost:2})],updateColumnContainer:function AP(){var AQ=this.parent.parent;if(this.domNode){G.addClass(this.domNode,"lastStage");}this.fm2.update();K.call(AQ,AC);H.call(this);}};},getC0NodeProps:function Q(){var AP=this;return{alias:"c0",c1Selected:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(527,"Value")},h({alias:"c0",cstIndex:0}),{scriptClass:"mstrmojo.Label",alias:"btwn",cssClass:"btwn",text:mstrmojo.desc(308,"and"),visible:false},h({alias:"c1",cstIndex:1,visible:false}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.c0);},visible:false}],updateColumnContainer:function AQ(){this.c0.update();var Aa=this.parent,AW=Aa.parent,AV=Aa.parent.model,AY=AV&&AV.fn,AS=AY===Y.BETWEEN||AY===Y.NOT_BETWEEN||AY===S.BETWEEN||AY===S.BETWEEN_DESCENDING,AX=AY===Y.EQUAL||AY===Y.NOT_EQUAL||AY===Y.GREATER||AY===Y.GREATER_EQUAL||AY===Y.LESS||AY===Y.LESS_EQUAL,AZ=this.idx,AU=this.next;this.browseLink.set("visible",AW.objectBrowsingEnabled&&AN(AV,AW.ets));this.btwn.set("visible",AS);this.c1.set("visible",AS);if(AS){this.c1.update();}else{AV.edit("c1",{v:null,dtp:null,skipET:true},true);}if(AV.a2&&AX){if(!(AU&&AU.fm2)){Aa.insertAndRemoveTrailing(AZ,AP.getFm2NodeProps());}}else{Aa.removeTrailingContainer(AZ);}var AT=mstrApp.isWSStyling?C:AE,AR=mstrApp.isWSStyling?R:AA;K.call(AW,AV.a?AT:AV.m?AR:"");if((!AV.a)&&AV.m&&this.domNode){G.addClass(this.domNode,"lastStage");}H.call(this);}};},getFnNodeProps:function a(){var AP=this;return{alias:"fn",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrApp.isWSStyling?mstrmojo.desc(15006,"Operator"):mstrmojo.desc(9579,"Condition")},f({alias:"fn",allowUnlistedValues:false,update:function(){var AW=this.parent.parent.parent,AS=AW.model||{},AX=AS.et,AV,AY=false,AZ,AR;switch(AX){case M.AE:AY=!!AS.a;break;case M.AQ:case M.AC:case M.AL:AY=!!(AS.fm&&AS.fm.did);AV=AY?AS.fm.dtp:null;break;case M.MQ:case M.MC:AY=!!AS.m;AV=AY?W.METRIC_DTP:null;break;}if(AY){var Aa=n[AV];if((this.lastEt!==AX)||(this.lastFnDtp!==Aa)){this.lastEt=AX;this.lastFnDtp=Aa;var AU=AX?z[AX]:null,AT=AU&&AU.key;AZ=(AT&&AW[AT])||AU.def||[];if(typeof (AZ)==="object"){AZ=AZ[Aa]||AZ["*"];}}AR=AO(AS.fn,AS.fnt||1);}o(this,AY,AZ,AR);this.parent.updateScrollbars();}})],updateColumnContainer:function AQ(){this.fn.update();var AR=this.parent,AS=AR.parent,AT=AS.model,AV=AT&&AT.fn,AU=this.next,AX=AV===Y.IS_NULL||AV===Y.IS_NOT_NULL;if(AV&&AX){AR.removeTrailingContainer(this.idx);}else{if(AV&&!(AU&&AU.c0)){AR.insertAndRemoveTrailing(this.idx,AP.getC0NodeProps());}}var AW=mstrApp.isWSStyling?AK:AB;K.call(AS,AT.a?AF:AT.m?AW:"");AU=this.next;if(AU){AU.updateColumnContainer();}}};},getEsNodeProps:function B(){var AR=[{scriptClass:"mstrmojo.ui.CheckList",alias:"es",itemIdField:"v",allowUnlistedValues:true,insertUnlistedValuesAt:0,selectionPolicy:"toggle",postCreate:function AQ(){w.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,params:{taskId:"browseElements",attributeID:null,styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30},onsuccess:function(){var Ac=this.parent,AW=this.response;if((AW&&AW.did)!==Ac.lastAttrId){return ;}var AY=(AW&&AW.es)?u.filter(AW.es,function(Ad){return !l.isNullElem(Ad.v);}):[],Ab=Ac.parent.parent.parent.model&&Ac.parent.parent.parent.model.es,AZ=function(Aj,Ae){var Ai=Aj&&Aj.length||0,Ah=Ae&&Ae.length||0,Ad=[],Ag,Af;for(Ag=0;Ag<Ah;Ag++){for(Af=0;Af<Ai;Af++){if(Ae[Ag].n===Aj[Af].n){break;}}if(Af===Ai){Ad.push(Ae[Ag]);}}return Ad;},Aa=function(Ad,Ae,Ah){var Ag=[],Af;u.forEach(Ad,function(Ai){Af=u.filterOne(Ae,function(Aj){return Ai[Ah]&&Aj[Ah]&&Ai[Ah]===Aj[Ah];});if(Af){Ag.push(Af);}});return Ag.length===Ad.length?Ag:Ad;};Ab=Ab&&Aa(Ab,AY,"v");if(Ac.allowUnlistedValues){var AX=AZ(AY,Ab);AY=(Ac.insertUnlistedValuesAt===0)?AX.concat(AY):AY.concat(AX);}m(Ac,AY,Ab,null);Ac.parent.updateScrollbars();},onerr:function(){F(this.parent,p,[I]);}});},onselectionChange:function AU(AW){mstrmojo.ListBase.prototype.onselectionChange.call(this,AW);b.call(this,AW);},update:function AT(){var AZ=this.parent.parent.parent,AY=AZ.model,Ad=AY&&AY.a,Ae=!!Ad&&!Ad.ilk,Af,AW,Ac,Aa,AX,Ag;if(Ae){if(this.lastAttrId!==Ad.did){this.lastAttrId=Ad.did;Af=AY.es;Aa=Af&&Af.length;Af=Aa?Af.concat():[];Af.push(p);if(Aa){Ac=[];for(AX=1;AX<=Aa;AX++){Ac[AX]=AX;}}Ag=this.ajx;AZ.updateBrowseElementsParams(Ag.params,Ad);}else{AW=AY.es;}}d(this,Ae,Af,AW,Ac);if(Ae&&Ag){if(AZ.getElements){var Ab=this;AZ.getElements(Ad,{success:function(Ah){m(Ab,Ah.es||[],AZ.model&&AZ.model.es,null);Ab.parent.updateScrollbars();},failure:function(){F(Ab,p,[I]);}});}else{Ag.send();}}},setupScrollNodes:function AS(){this.scrollNode=null;}}];if(!mstrApp.isSingleTier){AR.splice(0,0,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7928,"Browse elements..."),onclick:function AP(){this.parent.parent.parent.browse(this.parent.es);}});}return{alias:"es",children:AR,updateList:function(AW){d(this.es,true,AW,this.parent.parent.model.es,null);this.updateScrollbars();},updateColumnContainer:function AV(){var AW=this.parent.parent;if(this.domNode){G.addClass(this.domNode,"lastStage");}this.es.update();K.call(AW,mstrApp.isWSStyling?N:AG);}};},getFmNodeProps:function O(){var AP=this;return{alias:"fm",children:[f({alias:"fm",fmPost:"",filter:false,isFirstFm:true})],updateColumnContainer:function AQ(){this.fm.update();var Aa=this.parent,AV=Aa.parent,AU=AV.model,AX=AU&&AU.fm,AZ=this.idx,AY=AU&&AU.a,AS=AV.disableElementsBrowsing,AR=AY&&AS&&AS(AY);var AW=(AU.etWas&&AU.etWas===M.AE)?t:k,AT=k;if(AU.et===M.AE&&!AR){AT=t;}if(AW!==AT||AT===k){Aa.removeTrailingContainer(AZ);if(AT===k&&AX){Aa.addNextColumn(AP.getFnNodeProps());}else{if(AT===t){Aa.addNextColumn(AP.getEsNodeProps());}}}K.call(AV,mstrApp.isWSStyling?AH:AI);H.call(this);}};},getTargetNodeProps:function g(){var AP=this;return{alias:"target",target:null,browseLink:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(11859,"Based On")},L({alias:"target",insertUnlistedValuesAt:0,makeObservable:true,hideIfEmpty:true,postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},onObjBrowsed:function(AS){if(AS.st===J.FILTER||AS.t===AD.REPORT||AS.t===AD.PROMPT){this.parent.parent.parent.onOK();}},update:function AR(){var AT=this.parent.parent.parent,AU=AT.model,AX=AT.targetsLastMod,AY=AU&&AU.et;if(this.lastModel!==AU||this.targetsLastMod!==AX){this.lastModel=AU;this.targetsLastMod=AX;var AS=AT.targets,AZ=AT.ets;if(AZ&&AS&&AS.length){var AW=AM(AT.ets);AS=u.filter(AS,function(Aa){return AW[Aa[E]];});}var AV=AU&&AU[Z[AY]];o(this,true,W.getSortedObjectsByTypeGroup(AS),AV);this.parent.updateScrollbars();}}}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.target);}}],updateColumnContainer:function AQ(){this.target.update();var AT=this.parent,AU=AT.parent,AV=AU.model,AX=AV&&AV.et,AS=this.idx,AW=this.next;this.browseLink.set("visible",AU.objectBrowsingEnabled);if(AX){switch(AX){case M.AQ:case M.AL:case M.AC:case M.AE:if(AV.a&&!(AW&&AW.fm)){this.parent.insertAndRemoveTrailing(AS,AP.getFmNodeProps());}break;case M.MQ:case M.MC:if(AV.m&&!(AW&&AW.fn)){this.parent.insertAndRemoveTrailing(AS,AP.getFnNodeProps());}break;case M.R:case M.F:case M.XML:this.parent.removeTrailingContainer(AS);break;}}AW=this.next;if(AW){AW.updateColumnContainer();}}};}});var A=mstrmojo.rw.ConditionWalkProvider;A.setTip=K;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIConstants","mstrmojo.List","mstrmojo.DI.DITree","mstrmojo.DI.DIGATreeNode","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.DropDownList","mstrmojo.TextArea","mstrmojo.RadioList","mstrmojo.Widget","mstrmojo.DateTextBox","mstrmojo.DI.DIDateTextBox");mstrmojo.requiresDescs(146,147,1088,1995,12551,12552,12553,12554,12555,12556,12557,12558,12559,12560,12561,12562,12566,12567,12568,12671,12672,12673,12674,12675,13128,13129,13130);var M=mstrmojo.DI.DIConstants.sourceType;var P="mstrmojo-di-ga-label";var F="mstrmojo-di-ga-dropDownList";var E=["MM/DD/YYYY","today","yesterday"],H=/^\d+daysAgo$/;var L="###";var G=["308","200","100"];var B=mstrmojo.DI.DIConstants.googleAnalyticsUrl.queryExplorer;var K=mstrmojo.css;var A=mstrmojo.date;function J(){var R=this.parent;var S=0,Q;if(!this.optionNode){return ;}if(this.optionNode.style.display==="block"){S++;}if(this.dateOptionNode.style.display==="block"){S++;}Q=G[S];R.browser.domNode.style.height=Q+"px";R.textarea.domNode.style.height=(Q-10)+"px";R.browser.domNode.parentNode.style.height="";}function O(Q){var R=(Q.style.display==="none")?false:true;if(!R){Q.style.display="block";this.set("text",mstrmojo.desc(1995,"Hide"));}else{Q.style.display="none";this.set("text",mstrmojo.desc(1088,"Edit"));}J.call(this.parent);}function N(R,S){var U=R.indexOf(S);if(U===-1){return"";}var Q=R.indexOf("&",U+S.length)===-1?R.length:R.indexOf("&",U+S.length);return R.substring(U,Q);}function D(U){var R,S=mstrmojo.locales.datetime;if(U.toUpperCase()==="MM/DD/YYYY"){R="YYYY-MM-DD";}else{if(mstrmojo.array.indexOf(E,U)!==-1||H.test(U)){R=U;}else{var Q=A.parseDate(U,false,S.DATEOUTPUTFORMAT);if(Q.day.toString()!=="NaN"){R=A.formatDateInfo(Q,"yyyy-MM-dd");}else{var V=S.DATEOUTPUTFORMAT.toUpperCase();mstrApp.getRootController().displayError(mstrmojo.desc(13128,"Requests can only specify a date formatted as ###, ").replace("###",V)+mstrmojo.desc(13129,"or as a relative date (e.g., today, yesterday, or NdaysAgo where N is a positive integer). ")+mstrmojo.desc(13130,"Please change your input into any of the aforementioned formats."),false);}}}return R;}function I(Q){var S="",R=Q.dateTable;if(R.dates.selectedIndex===0){S="&start-date="+D(R.fromDate.value)+"&end-date="+D(R.toDate.value);}else{if(R.dates.selectedIndex!==0){S="&dynamic-date={"+R.dates.items[R.dates.selectedIndex].qn+"}";}}return S;}function C(Q){var R,S;R=I(Q);S="ids=ga:"+Q.selectedProfile.id+"&dimensions=ga:source&metrics=ga:visits&segment=gaid::-11";if(R){S+=R;}return S;}mstrmojo.DI.DIAnalytics=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIAnalytics",cssClass:"mstrmojo-di-ga",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div class="cf sf-options"></div><div style="display:none;" class="mstrmojo-di-ga-options sf-options"></div><div class="cf sf-options"></div><div style="display:block;"class="mstrmojo-di-ga-options"></div><div class="cf sf-options"></div><div style="display:none;"></div><div></div></div>',markupSlots:{firstNode:function(){return this.domNode.children[0];},optionNode:function(){return this.domNode.children[1];},secondNode:function(){return this.domNode.children[2];},dateOptionNode:function(){return this.domNode.children[3];},thirdNode:function(){return this.domNode.children[4];},listHeaderNode:function(){return this.domNode.children[5];},listNode:function(){return this.domNode.children[6];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},account:undefined,webproperty:undefined,analyticsList:undefined,ultp:undefined,textarea:undefined,username:undefined,showPrv:undefined,fromDate:undefined,toDate:undefined,expand:false,selectedAccount:undefined,selectedWebProperty:undefined,fixObjectBrowserHeight:function(){J.call(this);},postCreate:function(){this.selectedAccount=null;this.selectedWebProperty=null;},children:[{slot:"firstNode",scriptClass:"mstrmojo.Label",cssClass:P,text:mstrmojo.desc(12549,"Select your Account, Web Property and Profile")},{scriptClass:"mstrmojo.Label",slot:"firstNode",alias:"edit",text:mstrmojo.desc(1088,"Edit"),cssClass:"mstrmojo-di-ga-collapsed",onclick:function(){O.call(this,this.parent.optionNode);}},{scriptClass:"mstrmojo.Table",alias:"accountTable",slot:"optionNode",rows:1,cols:6,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",cssClass:"mstrmojo-di-ga-account-label",text:mstrmojo.desc(12566,"Account:")},{slot:"0,1",scriptClass:"mstrmojo.ui.Pulldown",cssClass:F,isHostedWithin:false,allowHTML:false,alias:"account",postselectedIndexChange:function(Q){var S=this.parent.parent,R=S.model.externalSources[M.googleAnalytics];if(this.selectedIndex===undefined||this.selectedIndex<0){return ;}S.selectedAccount=R.accounts[this.selectedIndex];mstrApp.getRootController().getAnalyticsWebProperties(R.accounts[this.selectedIndex].id);}},{scriptClass:"mstrmojo.Label",slot:"0,2",cssClass:"mstrmojo-di-ga-webproperty-label",text:mstrmojo.desc(12567,"Web Property:")},{slot:"0,3",scriptClass:"mstrmojo.ui.Pulldown",cssClass:F,isHostedWithin:false,allowHTML:false,alias:"webproperty",postselectedIndexChange:function(Q){var R=this.parent.parent;if(this.selectedIndex===undefined||this.selectedIndex<0){return ;}R.selectedWebProperty=R.selectedAccount.webProperties[this.selectedIndex];mstrApp.getRootController().getAnalyticsProfiles(R.selectedAccount.id,R.selectedAccount.webProperties[this.selectedIndex].id);}},{scriptClass:"mstrmojo.Label",slot:"0,4",text:mstrmojo.desc(12568,"Profile:")},{slot:"0,5",scriptClass:"mstrmojo.ui.Pulldown",cssClass:F,isHostedWithin:false,alias:"profiles",postselectedIndexChange:function(Q){var R=this.parent.parent;if(this.selectedIndex===undefined||this.selectedIndex<0){return ;}if(this.selectedIndex!==-1){R.selectedProfile=R.selectedWebProperty.profiles[this.selectedIndex];}}}]},{slot:"secondNode",scriptClass:"mstrmojo.Label",cssClass:P,text:mstrmojo.desc(12550,"Select Date Range: ")},{scriptClass:"mstrmojo.Label",slot:"secondNode",alias:"edit",text:mstrmojo.desc(1995,"Hide"),cssClass:"mstrmojo-di-ga-collapsed",onclick:function(){O.call(this,this.parent.dateOptionNode);}},{slot:"dateOptionNode",scriptClass:"mstrmojo.Table",alias:"dateTable",rows:1,cols:6,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-date-label",slot:"0,0",text:mstrmojo.desc(12551,"Date Range: ")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"0,1",alias:"dates",cssClass:"di-analytics-pulldown",selectCssClass:"mstrmojo-di-ga-dropDownList-select",items:[{n:mstrmojo.desc(12552,"Custom range"),qn:"Custom range",v:0},{n:mstrmojo.desc(12553,"Last 7 days"),qn:"Last 7 days",v:1},{n:mstrmojo.desc(12554,"This month"),qn:"This month",v:2},{n:mstrmojo.desc(12555,"Last month"),qn:"Last month",v:3},{n:mstrmojo.desc(12556,"Last 3 months"),qn:"Last 3 months",v:4},{n:mstrmojo.desc(12557,"Last 6 months"),qn:"Last 6 months",v:5},{n:mstrmojo.desc(12558,"Last 12 months"),qn:"Last 12 months",v:6},{n:mstrmojo.desc(12559,"This year"),qn:"This year",v:7},{n:mstrmojo.desc(12560,"Last year"),qn:"Last year",v:8}],selectedIndex:3,onSelectedItemChange:function(){switch(this.selectedIndex){case 0:this.parent.fromDate.set("disabled",false);this.parent.toDate.set("disabled",false);K.toggleClass(this.parent.fromDateLabel.domNode,"disabled",false);K.toggleClass(this.parent.toDateLabel.domNode,"disabled",false);break;default:this.parent.fromDate.set("disabled",true);this.parent.toDate.set("disabled",true);this.parent.fromDateLabel.set("disabled",true);this.parent.toDateLabel.set("disabled",true);K.toggleClass(this.parent.fromDateLabel.domNode,"disabled",true);K.toggleClass(this.parent.toDateLabel.domNode,"disabled",true);}}},{scriptClass:"mstrmojo.Label",slot:"0,2",alias:"fromDateLabel",enabled:false,text:mstrmojo.desc(146,"From:")},{scriptClass:"mstrmojo.DI.DIDateTextBox",alias:"fromDate",cssDisplay:"inline-block",cssClass:"mstrmjo-di-DateTextBox fromDate",value:"MM/DD/YYYY",disabled:true,slot:"0,3",bindings:{toDate:function(){return this.parent.toDate.value;}},preBuildRendering:function(){this._super&&this._super();var Q=mstrmojo.locales.datetime,R=Q.DATEOUTPUTFORMAT.toUpperCase();this.set("value",R);}},{scriptClass:"mstrmojo.Label",slot:"0,4",alias:"toDateLabel",enabled:false,text:mstrmojo.desc(147,"To: ")},{scriptClass:"mstrmojo.DI.DIDateTextBox",alias:"toDate",cssDisplay:"inline-block",cssClass:"mstrmjo-di-DateTextBox toDate",value:"MM/DD/YYYY",disabled:true,slot:"0,5",bindings:{fromDate:function(){return this.parent.fromDate.value;}},preBuildRendering:function(){this._super&&this._super();var Q=mstrmojo.locales.datetime,R=Q.DATEOUTPUTFORMAT.toUpperCase();this.set("value",R);}}]},{slot:"thirdNode",scriptClass:"mstrmojo.RadioListHoriz",cssClass:"upload-options",itemCssClass:"mstrojo-di-ga-upload-options-item",alias:"ultp",selectedIndex:0,onchange:function(){var Q=mstrApp.getRootController();if(this.selectedIndex===0){if(this.parent.parent.browser.fileTree.selectedItem!==null){Q.sourceSelected(true);}else{Q.sourceSelected(false);}}else{if(this.selectedIndex===1){if(!this.parent.parent.textarea.value||this.parent.parent.textarea.value===""){var R=C.call(this,this.parent);this.parent.parent.textarea.set("value",R);this.parent.parent.textarea.domNode.style.display="block";this.parent.parent.textarea.domNode.focus();}Q.sourceSelected(true);}}},postBuildRendering:function(){if(this._super){this._super();}var S=mstrApp.getRootController();var V=S.model;var U=null,R=null,Q;var X=null;var W=this;if(this.parent.tableID){X=V.getImportSource(this.parent.tableID);}if(this.parent.currentSource){X=this.parent.currentSource;}if(X&&X.sourceInfo){U=X.sourceInfo.dbTableName;R=X.sourceInfo.url.substr("SQL=".length);Q=R.indexOf(L);if(Q>-1){R=R.substr(0,Q);}if(U.indexOf("CustomQuery")>-1||U.indexOf("Google Analytics Query")>-1||X.sourceInfo.url.indexOf("folderName:")<0){R=mstrmojo.string.decodeHtmlString(R);this.parent.parent.textarea.set("value",R);this.set("selectedIndex",1);window.setTimeout(function(){W.parent.parent.textarea.domNode.focus();},0);}else{mstrApp.getRootController().sourceSelected(false);}}else{mstrApp.getRootController().sourceSelected(false);}},items:[{did:"0",n:mstrmojo.desc(12561,"Pick a report")},{did:"1",n:mstrmojo.desc(12562,"Write your own query")}]},{slot:"thirdNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-label link",text:mstrmojo.desc(12674,"Update Query"),onclick:function(){var V=this.parent.parent,X=V.textarea.value,S=V.domNode.scrollTop;var Z=N(X,"ids=ga:");var Y="ids=ga:"+V.analyticsComponent.selectedProfile.id.toString();var W=X.indexOf("&dynamic-date={")!==-1?N(X,"&dynamic-date={"):N(X,"&start-date=")+N(X,"&end-date=");var R=I(V.analyticsComponent);var Q,U;V.textarea.domNode.blur();if(Z!==Y){X=Y+X.substr(X.indexOf("&"));V.textarea.set("value",X);}if(W!==R&&R!==""){if(X.indexOf("&dynamic-date={")!==-1){Q=X.indexOf(W);X=X.substring(0,Q)+R+X.substr(Q+W.length);}else{if(X.indexOf("&start-date=")!==-1){Q=X.indexOf("&start-date=");U=X.indexOf("&",Q+"&start-date=".length)===-1?X.length:X.indexOf("&",Q+"&start-date=".length);X=X.substring(0,Q)+X.substr(U);}if(X.indexOf("&end-date=")!==-1){Q=X.indexOf("&end-date=");U=X.indexOf("&",Q+"&end-date=".length)===-1?X.length:X.indexOf("&",Q+"&end-date=".length);X=X.substring(0,Q)+X.substr(U);}X=X.trim()+R;}V.textarea.set("value",X);}V.textarea.domNode.focus();V.domNode.scrollTop=S;},bindings:{visible:function(){return this.parent.ultp.selectedIndex===1;}}},{slot:"thirdNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ga-label link",text:mstrmojo.desc(12675,"Help: Query Explorer"),onclick:function(){if(mstrApp.isSingleTier){window.FormWrapper.openPage(B);}else{mstrApp.openPage(B);}},bindings:{visible:function(){return this.parent.ultp.selectedIndex===1;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper");mstrmojo.requiresDescs(12852);var J=mstrmojo.expr,A=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.Enum.DYNAMIC_DIMTY,L=mstrmojo.ME.Enum.UI_DATA_TYPE,I=mstrmojo.ME.Enum.UI_OBJECT_TYPE,F=mstrmojo.ME.MetricToken.brackets;var K;function Q(){var E=mstrmojo.all[K];if(E&&E.onmetricModify){E.onmetricModify();}}function C(){var E=mstrmojo.all[K];if(E&&E.updateScrollbars){E.updateScrollbars();}}mstrmojo.ME.SortByInputList=mstrmojo.declare(mstrmojo.WidgetList,null,{makeObservable:true,isNewDef:true,isDME:false,init:function R(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-sortby");},preBuildRendering:function(){var E=this.items||[];if(this.isNewDef&&this.isDME){E.push(B.getAutomaticDimtyObject());}E.push({n:""});this.items=E;if(this._super){this._super();}},getTokens:function(){var X=this.items,E=X.length-1,W,b=[];if(E>0){b.push({v:"SortBy"});b.push({v:"=",isDelimiter:true});b.push({v:"(",isDelimiter:true});for(W=0;W<E;W++){var Z=X[W],a=Z.selFrm,V,Y=false;if(M.isDimty(Z.n)){V={v:Z.n};Y=true;}else{if(/^@/.test(Z.did)){V={v:Z.did};Y=true;}else{V={v:F(Z.n),oi:Z};}}if(a&&(Z.t===J.TP.ATTR||(Z.t===J.TP.CONS&&Z.st===J.STP.NDE))){G.copy({v:F(Z.n)+"@"+F(a.n),exv:a.dssid,extp:8},V);}b.push(V);if(!Y){if(!!Z.asc){b.push({v:"Desc",tp:259});}}if(W!==(E-1)){b.push({v:",",isDelimiter:true});}}b.push({v:")",isDelimiter:true});}return b;},itemFunction:function(Y,E,V){return new mstrmojo.Box({cssClass:"mstrmojo-ME-sortby-item",alias:"sortByItem",parent:V,children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"sortByInput",cssClass:"mstrmojo-ME-ObjectInputBox-sortby",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),isDME:V.isDME,dtp:L.Sortby,maxObjectCount:1,folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(","),getCandidatesThroughTaskCall:function a(d,c){d.objectType=J.TP.ATTR+","+J.TP.METRIC;d.rootFolderType=39;d.blockCount=d.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(d,c);},obCfg:{folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(",")},bindings:{candidates:"this.parent.parent.candidates"},postCreate:function(c){if(!c){this.set("items",Y.did||Y.dimty?[Y]:null);}},onitemchange:function(){var e=this.getSelectedObjects()[0];if(!e||!e.did&&!e.n){return ;}Y.selFrm=null;mstrmojo.hash.copy(e,Y);var d=this.parent.formsPulldown;if(d){d.updateForms(e);}var c=this.parent.ascPulldown;if(c){c.set("visible",Y.t===4||Y.st===J.STP.NDE);}Q();},onadd:function W(){if(this.getSelectedObjects().length===0){return ;}if(this.parent===V.ctxtBuilder.itemWidgets[V.items.length-1]){V.add([{n:""}]);this.parent.del.set("visible",true);}},hidePulldownButton:function(){return !V.isDME;},hideDelButton:function(){return true;},hideItemWidgetBrowseButton:function(){return V.isDME;},getItemsToFilterOut:function(){return V.items;}},{scriptClass:"mstrmojo.Pulldown",alias:"formsPulldown",cssClass:"mstrmojo-ME-sortby-forms mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",defaultSelection:-1,bindings:{visible:function(){return this.items&&this.items.length>0;}},popupToBody:true,popupZIndex:100,postCreate:function(){this.retrieveDssForms(Y);},retrieveDssForms:function X(e){var d=this,c=function(){var m=function(n){e.dssforms=n;d.set("items",e.dssforms);d.selectedIndex=-1;d.selectedItem=null;d.value=null;d.set("value",e.selFrm);};var k=d.parent.sortByInput.candidates,f=k&&k.items;if(e.did&&f){var j=A.find(f,"did",e.did);if(j>-1){var h=mstrmojo.hash.clone(f[j].fs);if(h){A.forEach(h,function(n){n[d.itemIdField]=n.fid;n[d.itemField]=n.fnm;});m(h);return ;}}}var l=function(n){if(n){var o=n.container;if(o&&o.dssforms){e.dssforms=o.dssforms;m(e.dssforms);}}},g=function(n){mstrmojo.alert(n.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:e.did,displayedForms:0},{success:l,failure:g});};switch(e.t){case J.TP.ATTR:c();break;case J.TP.CONS:if(e.st===J.STP.NDE){d.set("visible",false);}break;case J.TP.METRIC:d.set("visible",false);break;case I.Dimty:d.set("visible",false);break;}},updateForms:function Z(c){this.retrieveDssForms(c);},onvalueChange:function b(){if(this.selectedItem){Y.selFrm=this.selectedItem;}if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Pulldown",alias:"ascPulldown",cssClass:"mstrmojo-ME-sortby-asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,visible:false,bindings:{value:function(){return this.parent.parent.items[E].asc;},visible:function(){var c=this.parent.sortByInput.getSelectedObjects()[0];return this.parent.formsPulldown.visible&&this.parent.formsPulldown.value||c.t===J.TP.METRIC||c.st===J.STP.NDE;}},onvalueChange:function(c){Y.asc=this.value;if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Button",alias:"del",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),bindings:{visible:function(){var c=V.itemIndex(Y);return this.parent.parent.items[c].did;}},onclick:function(){V.remove(V.items[V.itemIndex(Y)]);Q();}}]});},onadd:function H(){C();},onremove:function S(){C();}});mstrmojo.ME._HasSortBy=mstrmojo.provide("mstrmojo.ME._HasSortBy",{_mixinName:"mstrmojo.ME._HasSortBy",ios:false,oniosChange:function P(E){this.sortByContainer.set("visible",E.value);},onOpen:function(){if(this._super){this._super();}K=this.id;var V=this.oi.tks,W=!V.met;var E=this.sortByContainer&&this.sortByContainer.sortByWidgetList;if(E){E.set("isNewDef",W);E.set("isDME",this.isDME);E.set("candidates",this.getCandidates4Sortby());E.set("items",this.getSortByDefFromTokens().items||[]);}},getCandidates4Sortby:function U(){var V=this.candidates,E;if(V&&!this.noCache){E=A.filter(V.items,function(W){return W.t===J.TP.ATTR||W.t===J.TP.METRIC||W.st===J.STP.NDE;});if(this.isDME){E=B.getItems("sortby").concat(E);}}return{items:E||[],isComplete:V&&V.isComplete};},getSortByWidget:function D(E){var X=this,W=[{scriptClass:"mstrmojo.ME.SortByInputList",alias:"sortByWidgetList",cssClass:"sortBy mstrmojo-ME-sortby",cssDisplay:"table-cell"}],V={scriptClass:"mstrmojo.Label",alias:"sortByLabel",cssClass:"mstrmojo-ME-SortBy-label",cssDisplay:"table-cell",text:mstrmojo.desc(12852,"Sort By")};if(E){W.unshift(V);}return{scriptClass:"mstrmojo.Box",alias:"sortByContainer",cssClass:"mstrmojo-ME-SortBy-Container",cssDisplay:"table-row",visible:X.ios,postCreate:function(){X.sortByContainer=this;this.editor=X;},getTokens:function(){return this.sortByWidgetList.getTokens();},children:W};},getSortByDefFromTokens:function N(){var b=this.oi.tks.items,X=b.length,c,Z,V,W,Y={};for(W=0;W<X;W++){c=b[W];Z=c.tp;V=c.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(c.v)&&(c.v!=="("&&c.v!==")")||c.v==="&gt;"||c.v==="&lt;"){continue;}switch(V){case 131072:if(Z===302){c=b[++W];while(c){if(c.tp!==282){if(c.oi){c.oi.selFrm=c.exv;var a=b[W+1];if(a.v==="Desc"&&a.tp===259){c.oi.asc=1;W++;}Y.items=Y.items||[];Y.items.push(c.oi);}else{if(c.tp===64){Y.items=Y.items||[];var E=c.v+b[++W].v;c=b[W+1];if(c.tp===43||c.tp===45){E+=b[++W].v;E+=b[++W].v;}Y.items.push(B.getDimtyObject(E,this.isDME));}}}if((c=b[++W])["v"]===")"){break;}}}}}return Y;},getSortByDefAsTokens:function O(){return this.sortByContainer.getTokens();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var H=mstrmojo.expr,O=mstrmojo.Enum_OIB_States,J=mstrmojo.ME._MetricEditorHelper,R=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function P(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function D(X){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(X);}var E=this._super(X)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[X.t]||"";return E?" icn "+E:"";},itemFunction:function B(Y,E,X,Z){Y[X.itemIdField]=X.nextId();var a=Z||mstrmojo.ME.ObjectItem,b=new a({parent:X,itemField:X.itemField,cssClass:X.item2textCss(Y),data:Y,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});X.attachEventListener4ItemWidget(b,X);return b;},getActiveItem:function M(){var E=this.editingIdx,Y,X;if(E>-1){Y=this.ctxtBuilder.itemWidgets[E];X=Y&&Y.data;}return X;},showObjectBrowser:function(E){this.set("suggestTarget",E);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function S(){return false;},hidePulldownButton:function G(){return true;},hideDelButton:function A(){return false;},dtp:0,verifyObject:function C(X,E){if(!this.dynamicVerify){return O.VALID;}var Z=E.data;var Y=parseInt(this.dtp,10);switch(Y){case -1:case -2:case -4:case -5:case -6:if(Z.t===-1||J.isDimty(X,Y===-1)){return O.VALID;}if(this.dynamicVerify){return this._super(X,E);}return Z.did?O.VALID:O.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(Z.t<0){return O.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(X))||Z.did){return O.VALID;}if(this.dynamicVerify){return this._super(X,E);}return O.INVALID;default:return O.VALID;}},getItemsToFilterOut:function N(){return this.items;},updateSuggestion:function Q(E){var Y=this.getActiveItem();var X=this.getItemsToFilterOut();E=mstrmojo.array.filter(E,function(b){var a=b.did,Z=false,d;var c=function(e){mstrmojo.array.forEach(X,function(f){if(f!==Y&&f.did===e){Z=true;return false;}});};c(a);if(!Z){d=b;}return d;});if(this._super){this._super(E);}},nudge:function I(X){X.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME&&!(mstrApp&&mstrApp.isWSStyling)?13:0)+"px";var Y=R.position(X.domNode),Z=R.position(this.suggestTarget.domNode),E=R.windowDim();if(Y.y+Y.h>E.h){X.domNode.style.top=(Z.y-Y.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown,focus/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function P(E){this._super(E);this.placeholderText=this.parent.emptyText;},initState:function U(){var X=this.parent,Y=this.data,E=Y.state;if(X.dynamicVerify){return this._super();}if(typeof E==="undefined"){E=X.verifyObject(Y[this.itemField],this);Y.state=E;}return E;},reduceWidth:function(){},updateButtonsVisibility:function F(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==O.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==O.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function L(){this.set("state",this.data.state===O.ADDING?O.ADDING:O.EDITING);this.parent.showObjectBrowser(this);},click2edit:function K(){if(this.parent.click2edit){this.edit();}},onclick:function W(){this.click2edit();},onfocus:function V(E){if(E.getTarget()===this.inputNode){this._super();}else{this.click2edit();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.HBox","mstrmojo.ui.menus.EditorConfig","mstrmojo.mstr.EnumFunction","mstrmojo.DropDownList","mstrmojo.ui.Pulldown","mstrmojo.SearchablePulldown","mstrmojo.ButtonList","mstrmojo.Box","mstrmojo.Label","mstrmojo.RadioList","mstrmojo.CheckList","mstrmojo.EditableLabel","mstrmojo.CheckBox","mstrmojo._FormatDefinition","mstrmojo.num","mstrmojo.locales","mstrmojo.vi.models.VIComponentMap","mstrmojo.func","mstrmojo.dom","mstrmojo.ME.AttributeEditBox","mstrmojo.ME.MetricToken","mstrmojo.string","mstrmojo.dom","mstrmojo.models.datasets.DataInterface","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.ui.editors.ObjectPicker","mstrmojo.vi.ui.editors.AttributeLinkEditor","mstrmojo.vi.ui.NumberFormatter","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSConsolidationType");mstrmojo.requiresDescs(1442,1885,1886,2022,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,3993,4564,11494,11495,11496,11497,14612);var t=mstrmojo.mstr.EnumFunction,a=mstrmojo.hash,z=mstrmojo.array,D=mstrmojo.css,Y=mstrmojo.dom,AC=mstrmojo.Button.newWebButton,V=mstrmojo.ME.MetricToken.brackets,AI=mstrmojo.ME.MetricToken.argDelimiter,W=mstrmojo._FormatDefinition,w=mstrmojo.models.datasets.DataInterface,K=mstrmojo.vi.models.VIComponentMap.TYPES,X=mstrmojo.chart.model.enums.EnumDSSObjectType,u=mstrmojo.mstr.EnumDSSXMLBaseFormType,AV=mstrmojo.mstr.EnumDSSXMLObjectTypes,N=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,AG=mstrmojo.mstr.EnumDSSConsolidationType;var b={SUM:mstrmojo.desc(2131,"Sum"),ADD:mstrmojo.desc(6017,"Add"),AVG:mstrmojo.desc(2122,"Average"),MAX:mstrmojo.desc(2125,"Maximum"),GST:mstrmojo.desc(5869,"Greatest"),MIN:mstrmojo.desc(2127,"Minimum"),LST:mstrmojo.desc(5868,"Least"),CNT:mstrmojo.desc(2123,"Count"),MTP:mstrmojo.desc(5418,"Multiply"),STD:mstrmojo.desc(2130,"Standard Deviation"),PTD:mstrmojo.desc(11494,"Population Standard Deviation")},g={SUM:{n:b.SUM,t:t.FunctionSum},ADD:{n:b.ADD,t:t.FunctionPlus},AVG:{n:b.AVG,t:t.FunctionAvg},MAX:{n:b.MAX,t:t.FunctionMax},GST:{n:b.GST,t:t.FunctionGreatest},MIN:{n:b.MIN,t:t.FunctionMin},LST:{n:b.LST,t:t.FunctionLeast},TMS:{n:b.MTP,t:t.FunctionTimes},CNT:{n:b.CNT,t:t.FunctionCount},GEM:{n:mstrmojo.desc(2124,"Geometric Mean"),t:t.FunctionGeomean},MED:{n:mstrmojo.desc(2126,"Median"),t:t.FunctionMedian},MOD:{n:mstrmojo.desc(2128,"Mode"),t:t.FunctionMode},PDT:{n:mstrmojo.desc(2129,"Product"),t:t.FunctionProduct},STD:{n:mstrmojo.desc(2130,"Standard Deviation"),t:t.FunctionStdev},VAR:{n:mstrmojo.desc(2132,"Variance"),t:t.FunctionVar}},c=[{n:b.SUM,t:t.FunctionOLAPSum},{n:b.AVG,t:t.FunctionOLAPAvg},{n:b.MIN,t:t.FunctionOLAPMin},{n:b.MAX,t:t.FunctionOLAPMax},{n:b.CNT,t:t.FunctionOLAPCount}],AT=[{n:b.SUM,t:t.FunctionOLAPSum},{n:b.AVG,t:t.FunctionOLAPAvg},{n:b.MIN,t:t.FunctionOLAPMin},{n:b.MAX,t:t.FunctionOLAPMax},{n:b.CNT,t:t.FunctionOLAPCount}],M=[{n:mstrmojo.desc(1058,"Previous"),t:t.FunctionLag},{n:mstrmojo.desc(1059,"Next"),t:t.FunctionLead},{n:mstrmojo.desc(4046,"First"),t:t.FunctionFirst},{n:mstrmojo.desc(4049,"Last"),t:t.FunctionLast}];var AD={YEAR:"Year",QUARTER:"Quarter",CONCAT:"Concat",QUARTERSTARTDATE:"QuarterStartDate",MONTH:"Month",TOSTRING:"ToString",MONTHSTARTDATE:"MonthStartDate",WEEK:"Week",WEEKSTARTDATE:"WeekStartDate",DAYOFMONTH:"DayOfMonth",DAYOFWEEK:"DayOfWeek",DAYOFYEAR:"DayOfYear"};var AM={};AM[AD.YEAR]="6F7DF5F8449111D5BEA300B0D01A55EF";AM[AD.QUARTER]="6F7DF5F7449111D5BEA300B0D01A55EF";AM[AD.CONCAT]="6F7DF5FF449111D5BEA300B0D01A55EF";AM[AD.QUARTERSTARTDATE]="59E10CE2ADDD4A6DAC2416A72999A9ED";AM[AD.MONTH]="6F7DF5F6449111D5BEA300B0D01A55EF";AM[AD.TOSTRING]="D1ED29645DEC4DBF99E8E09ED939074B";AM[AD.MONTHSTARTDATE]="7C63D4E70B2741C3A5B54A2EFD40961B";AM[AD.WEEK]="6F7DF5F5449111D5BEA300B0D01A55EF";AM[AD.WEEKSTARTDATE]="44681336D0DB4E43AC333FFB3CC4400D";AM[AD.DAYOFMONTH]="6F7DF5F2449111D5BEA300B0D01A55EF";AM[AD.DAYOFWEEK]="6F7DF5F3449111D5BEA300B0D01A55EF";AM[AD.DAYOFYEAR]="6F7DF5F4449111D5BEA300B0D01A55EF";var Q="@form";function d(AX){var AZ=8,Aa=1,AW=z.find(AX.fs,"idf",true);if(AW===-1){return null;}var AY=AX.fs[AW];return((AX.da||AY.obf)&&(AY.bftp===AZ||AY.bftp===Aa))?AY:null;}var AS={Year:{ID:[AD.YEAR,"(",Q,")"]},Quarter:{ID:[AD.YEAR,"(",Q,") * 10 + ",AD.QUARTER,"(",Q,")"],DESC:[AD.CONCAT,'("Q"',AI,AD.QUARTER,"(",Q,")",AI,' ", "',AI,AD.YEAR,"(",Q,"))"],DATE:[AD.QUARTERSTARTDATE,"(",Q,")"]},QuarterOfYear:{ID:[AD.QUARTER,"(",Q,")"],DESC:[AD.CONCAT,'("Q"',AI,"This@ID)"]},Month:{ID:[AD.YEAR,"(",Q,") * 100 + ",AD.MONTH,"(",Q,")"],DESC:[AD.TOSTRING,'<Pattern="mmm yyyy">(',Q,")"],DATE:[AD.MONTHSTARTDATE,"(",Q,")"]},MonthOfYear:{ID:[AD.MONTH,"(",Q,")"],DESC:[AD.TOSTRING,'<Pattern="mmmm">(',Q,")"]},Week:{ID:[AD.YEAR,"(",Q,") * 100 + ",AD.WEEK,"(",Q,")"],DESC:[AD.CONCAT,'("W"',AI,AD.WEEK,"(",Q,")",AI,' ", "',AI,AD.YEAR,"(",Q,"))"],DATE:[AD.WEEKSTARTDATE,"(",Q,")"]},WeekOfYear:{ID:[AD.WEEK,"(",Q,")"]},DayOfMonth:{ID:[AD.DAYOFMONTH,"(",Q,")"]},DayOfWeek:{ID:[AD.DAYOFWEEK,"(",Q,")"],DESC:[AD.TOSTRING,'<Pattern="ddd">(',Q,")"]},DayOfYear:{ID:[AD.DAYOFYEAR,"(",Q,")"]}};function k(AY,Aa,AZ,AW){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:AY,selectedIndex:Aa,onitemSelected:function AX(Ab){var Ac=this.parent;while(!Ac.data||!Ac.data[AZ]){Ac=Ac.parent;}Ac.data.set(AZ,AW?AW(Ab):Ab.v);}};}function AE(AY,AX,AW){return{scriptClass:"mstrmojo.Box",cssClass:"breakByBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13903,"Break by:"),cssClass:"menu-info-text"},a.copy(AW,k(AY,AX,"breakBy",function(AZ){return{id:AZ.did,type:AZ.t,dmy:AZ.dmy};}))]};}function AQ(AZ){var Aa=AZ.metrics,Ab=AZ.propName,AY=AZ.optionValueField||"id",AW=z.find(Aa,AY,AZ.value),Ac=function Ac(Ae){var Ad=this.parent;while(!Ad.data||!Ad.data.hasOwnProperty(Ab)){Ad=Ad.parent;}Ad.data.set(Ab,Ae?{id:Ae[AY],type:4}:{cst:this.text});};return{scriptClass:"mstrmojo.ui.SearchablePulldown",isHostedWithin:false,cssClass:"Calculation-PullDown",items:Aa,selectedIndex:AW,useRichTooltip:true,bindings:AZ.bindings,valid:true,allowCustomText:true,allowEmptyText:true,allowHTML:false,onvalidChange:function AX(){mstrmojo.css.toggleClass(this.domNode,"invalid",!this.valid);if(this.hasRendered){this.hideTooltip();this.showTooltip();}},updateTooltipConfig:function(){if(this.valid){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:mstrmojo.desc(13819,"Invalid input")};},onitemSelected:Ac,onTextEditComplete:function(){Ac.call(this,this.items[this.selectedIndex]);},onPopupWidgetOpened:function(){this.set("valid",true);},postkeyup:AZ.postkeyup};}function U(AZ,AY,AX){if(AZ&&AZ.datap){var AW=z.filterOne(AZ.datap,function(Ab){return Ab.tbid===AY;}),Aa=AW&&AW.maps.amps;return z.filterOne(Aa,function(Ab){return AX===Ab.aimp.atid;});}return null;}function n(AW,Aa){var AY=z.filterOne(AW&&AW.afmps,function(Ab){return Ab.fmid===Aa;}),AZ=AY&&(AY.sqc?AY:AY.col.oi),AX;if(AZ&&AZ.sqc){AX={did:AZ.sqc.id,n:mstrmojo.string.decodeHtmlString(AZ.cln),coldtp:AZ.sqc.dt.tp,georole:AZ.geo,timerole:AZ.tim,der:AZ.sqc.der};}else{if(AZ){AX={did:AZ.did,n:mstrmojo.string.decodeHtmlString(AZ.def.cln),coldtp:AZ.def.dt.tp,georole:AY.geo,timerole:AZ.def.dicl.time,der:AZ.def.dicl.der};}}return AX;}function C(AY,AX,Aa){var AZ={success:function(Ab){if(Ab&&Ab.msgid){mstrApp.serverRequest({taskId:"qBuilder.GetReportXDADefinition",msgid:Ab.msgid,bindingflag:2,previewflag:261,browsetype:5},Aa);}},failure:function(Ab){mstrApp.onerror(Ab);}};var AW=!!(mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause());mstrApp.serverRequest({taskId:"duplicateReportInstance",datasetID:AX,messageID:AY,skipRebuild:AW},AZ);}function I(Ab,Ac,AZ){var AX=Ab.srcTableId,Ae=Ab.tgtTableId,AW,Aa,AY=function(Ai,Ah){var Ak="<mpcs><mpc ",Ag,Aj;for(Ag in Ah){Aj=Ah[Ag];Ak+='$ACT="$VAL" '.replace("$ACT",Ag).replace("$VAL",Aj);}Ak+="/></mpcs>";return{act:"changeEMMAMapping",tbid:Ai,dsid:Ab.dsid,mapping:Ak};},Ad=function(){var Ag=[],Aj={},Ah,Ai;if(!AW||!Aa){return ;}Aj[AX]={};Aj[Ae]={};z.forEach(AW.afmps,function(An){var Al=z.find(Aa.afmps,"fmid",An.fmid),Ao,Am,Ak;if(Al>=0){Ah=n(AW,An.fmid);Ai=n(Aa,An.fmid);if(Ah.georole!==Ai.georole){Ak=(Ah.georole===0)?AX:Ae;Ao=(Ah.georole===0)?Ah.did:Ai.did;Am=Ah.georole||Ai.georole;Aj[Ak][Ao]=a.copy({did:Ao,georole:Am},Aj[Ak][Ao]);}if(Ah.timerole!==Ai.timerole){Ak=(Ah.timerole===0)?AX:Ae;Ao=(Ah.timerole===0)?Ah.did:Ai.did;Am=Ah.timerole||Ai.timerole;Aj[Ak][Ao]=a.copy({did:Ao,timerole:Am},Aj[Ak][Ao]);}if(Ah.der!==Ai.der){Am=Ah.der|Ai.der;Aj[AX][Ah.did]=a.copy({did:Ah.did,drvflg:Am},Aj[AX][Ah.did]);Aj[Ae][Ai.did]=a.copy({did:Ai.did,drvflg:Am},Aj[Ae][Ai.did]);}}});a.forEach(Aj,function(Ak,Al){a.forEach(Ak,function(Am){Ag.push(AY(Al,Am));});});Ah=n(AW,AW.afmps[0].fmid);Ag.push(AY(AX,{did:Ah.did,oid:Aa.aimp.atid}));if(AZ){AZ(Ag);}},Af=function(Ai){var Aj={success:function(){Ad();}},Ah,Ag;AW=U(Ai,AX,Ab.srcId);Aa=U(Ai,Ae,Ab.tgtId);Ah=n(AW,AW.afmps[0].fmid);Ag=[AY(AX,{did:Ah.did,oid:Aa.aimp.atid,fg:1})];Ac.getDataService().submitUpdates(Ag,Aj);};C(Ac.mid,Ab.dsid,{success:Af});}function Z(Ab,AY,AX,Ac){var AW=0,Aa=[],AZ=function(Ad){var Ae=AX[AW-1];if(Ad&&Ad.tks&&Ae){Aa.push({fid:Ae.fid,fnm:Ae.fnm,ftk:Ad.tks.items});}if(AW===AX.length){Ac(Aa);return ;}Ae=AX[AW++];mstrmojo.ME.MetricDataService.validateMetric({metricId:AY,formID:Ae.fid,objectType:12,tokenStreamXML:"",metricXML:"",msgID:Ab},{success:AZ});};AZ();}function AJ(AW,AX){return{v:V(AW.n)+"@"+V(AX.fnm),tp:275,lv:1,exv:AX.fid,extp:8,oi:{did:AW.did,t:AW.t,n:AW.n}};}function H(AX){var AZ=(AX.t===AV.Filter||AX.t===AV.Consolidation),AY=(AX.t===AV.Attribute&&AX.de),AW=(AX.t===AV.Consolidation&&AX.st===N.ConsolidationManaged);return !!(AZ&&!AW||AY);}mstrmojo.vi.ui.DatasetUnitMenuUtils=mstrmojo.provide("mstrmojo.vi.ui.DatasetUnitMenuUtils",{getAvailableShortcutMetricFunctionsGroup:function AP(AW){return{"12":[[g.AVG,g.CNT,g.MAX,g.MIN,g.STD,g.SUM,g.VAR]],"4":[[g.SUM,g.AVG,g.MIN,g.MAX,g.CNT],[g.GEM,g.MED,g.MOD,g.PDT,g.STD,g.VAR]]}[AW.t];},isAmongFunctions:function B(AX,AW){return AW.some(function(AY){return AY.some(function(AZ){return AZ.t===AX;});});},getMultiSelectionShortcutMetricFunctions:function J(AW){var AX=true;z.forEach(AW,function(AY){if(4!==AY.t){AX=false;return false;}return true;});return AX?[g.ADD,g.AVG,g.GST,g.LST,g.TMS]:[];},getRelativeReferenceMenu:function f(Aa,AY,Ad,AW){var AZ=0,AX=M[AZ],Ac=0,Ab=Ad&&Ad[Ac];return new mstrmojo.ui.menus.EditorConfig({data:{item:Aa,relativeRef:AX,breakBy:Ab},cssClass:"RelativeReference-MenuEditor",contents:[{scriptClass:"mstrmojo.Box",cssClass:"funcBox",children:[{scriptClass:"mstrmojo.Label",visible:AY&&AY.length,text:AY,cssClass:"menu-info-text"},a.copy({cssClass:"RelativeReferencePullDown"},k(M,AZ,"relativeRef",function(Ae){return Ae.t;}))]},AE(Ad,Ac,{cssClass:"RelativeReferencePullDown"})],fnOk:function(Ae){return AW(Ae.item,Ae.relativeRef,[Ae.breakBy]);}});},getMovingTotalMenu:function A(Ag,Aa,Ac){var Ah=1,AZ=AT[Ah].t,Ab=1,AX=mstrmojo.desc(13289,"Starting previous##rows").split("##"),Af=0,AY=Aa&&Aa[Af];return new mstrmojo.ui.menus.EditorConfig({cssClass:"MovingTotal-MenuEditor",data:{item:Ag,funcType:AZ,windowSize:Ab,breakBy:AY},contents:[a.copy({cssClass:"MovingTotalPullDown"},k(AT,Ah,"funcType",function(Ai){return Ai.t;})),{alias:"winSzBox",scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"WinSzPrefix menu-info-text",text:AX[0]},{alias:"winSz",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:mstrmojo.expr.DTP.INTEGER,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:1},postCreate:function Ae(){this.set("value",Ab);},_ontooltipover:function(){var Ai=mstrmojo.all[this.id];Ai._hovered=true;Ai.showTooltip();},_ontooltipout:function(){var Ai=mstrmojo.all[this.id];Ai._hovered=false;Ai.hideTooltip();},useRichTooltip:true,tooltipOpenDelay:0,onInvalid:function(){var Ai=this.validationStatus.msg,Aj=!(this.richTooltip&&Ai===this.richTooltip.content);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-V",top:-5,refNode:this.domNode,content:Ai};if(this._hovered&&Aj){this.hideTooltip();this.showTooltip();}},onValid:function(){this.richTooltip=null;this.hideTooltip();},postvalueChange:function Ad(){var Ai=this.isValid();this.parent.parent.popupConfig.data.set("windowSize",Ai?parseInt(this.value,10):0);}},{scriptClass:"mstrmojo.Label",cssClass:"WinSzSuffix menu-info-text",text:AX[1]}]},AE(Aa,Af,{cssClass:"MovingTotalPullDown BreakByBox"})],bindings:{okEnabled:function(){return !!this.data.windowSize;}},fnOk:function AW(Ai){if(Ac){Ac(Ag,Ai.funcType,Ai.windowSize,[Ai.breakBy]);}}});},getRunningTotalMenu:function AO(AZ,Ac,AX){var AY=0,AW=c[AY].t,Ab=0,Aa=Ac&&Ac[Ab];return new mstrmojo.ui.menus.EditorConfig({data:{item:AZ,func:AW,breakBy:Aa},cssClass:"RunningTotal-MenuEditor",contents:[a.copy({cssClass:"RunningTotalPullDown"},k(c,AY,"func",function(Ad){return Ad.t;})),AE(Ac,Ab,{cssClass:"RunningTotalPullDown BreakByBox"})],fnOk:function(Ad){return AX(Ad.item,Ad.func,[Ad.breakBy]);}});},getRankMetricEditor:function AF(Aa,Ad,AY){var AW=[{n:mstrmojo.desc(1886,"Descending"),v:"0"},{n:mstrmojo.desc(1885,"Ascending"),v:"-1"}],AX=0,AZ=AW[AX].v,Ac=0,Ab=Ad&&Ad[Ac];return new mstrmojo.ui.menus.EditorConfig({data:{item:Aa,order:AZ,breakBy:Ab},cssClass:"NewRankMetric-MenuEditor",contents:[{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14612,"Sort:"),cssClass:"menu-info-text"},a.copy({cssClass:"NewRankMetricPullDown"},k(AW,AX,"order"))]},AE(Ad,Ac,{cssClass:"NewRankMetricPullDown"})],fnOk:function(Ae){return AY(Ae.item,Ae.order,[Ae.breakBy]);}});},insertAddUnitToFilterMenu:function G(Ab,AX,AW){var AZ=this,AY=mstrmojo.desc(2022,"Add to Filter"),Aa=z.ensureArray(AW).filter(function(Ac){return AZ.isValidAddToFP(AX,Ac);});if(Aa.length>0){Ab.addMenuItem(AY,"",function(){AX.addFilterStackSelectors(Aa);});}else{Ab.addDisabledMenuItem(AY,"");}},isValidAddToFP:function O(AX,Ac,Ae){var AY=AX.controller.view.builder,Aa=AY.getLayoutVIMap(AX.getCurrentLayoutKey()),Ab=Aa.getComponent(K.FILTER_STACK),Ad=true;if(!Ae){Ad=(!Ab||z.find(Ab.getFilterDefinitions(),"srcid",Ac.did)===-1);}if(Ad&&Ac.lock){var AZ=Ac.fs||[],AW;Ad=false;for(AW=0;AW<AZ.length;AW++){if(AZ[AW].iidx){Ad=true;break;}}}return Ad;},renameItem:function x(Ab,Ae,AX,AZ){var Aa=Ab.mstrmojoId,Ad=mstrmojo.dom.findWidget(Ab);AZ=AZ||{};if(!Aa){var Ac=mstrmojo.insert({scriptClass:"mstrmojo.EditableLabel",editOnClick:false,editOnTwoClicks:true,text:Ae.n,title:Ae.dsc||"",allowEmptyText:AZ.allowEmptyText,allowTrimming:AZ.allowTrimming||false,cssClass:AZ.cssClass||"",placeholder:Ab,onTextEditComplete:function AW(Af){if(Af){return AX(this);}},onmousedown:function AY(Af){if(this.isEditing){Af.cancel();}}});if(Ad&&Ad.draggable){Ac.parent=Ad;}Ac.render();Aa=Ac.id;}mstrmojo.all[Aa].set("isEditing",true);return mstrmojo.all[Aa];},getMultipleMetricsCalculationMenus:function m(Ad,AW,Ag){var Ac=new mstrmojo.ui.menus.MenuConfig(),Ai=mstrmojo.vi.ui.DatasetUnitMenuUtils.getMultiSelectionShortcutMetricFunctions(Ad),Aa=function(Ak,Al,Aj){return{dsid:AW,funcType:Al,funcType2:Aj,items:Ak};};Ac.useTooltip=true;Ai.forEach(function(Aj){Ac.addMenuItem(Aj.n,"",function(){Ag(Aa(Ad,Aj.t));});});if(Ad.length===2){var Ab=mstrmojo.mstr.EnumFunction,AZ=Ab.FunctionDivide,AX=Ab.FunctionMinus,Af=Ad[0],Ae=Ad[1],Ah=function(An,Al,Aj,Am,Ak){Ac.addMenuItem(An,"",function(){Ag(Aa([Al,Aj],Am,Ak));});},AY=[{n:function(Ak,Aj){return Ak.n+"/"+Aj.n;},fn:AZ},{n:function(Ak,Aj){return Ak.n+"-"+Aj.n;},fn:AX},{n:function(Ak,Aj){return"("+Ak.n+"-"+Aj.n+")/"+Aj.n;},fn:AX,fn2:AZ}];AY.forEach(function(Aj){Ac.addSeparator();Ah(Aj.n(Af,Ae),Af,Ae,Aj.fn,Aj.fn2);Ah(Aj.n(Ae,Af),Ae,Af,Aj.fn,Aj.fn2);});}return Ac;},getCalculationMetricEditor:function L(Ae,Af,Ad){var AY=[{n:"",css:"operator-plus",funcType:t.FunctionPlus},{n:"",css:"operator-minus",funcType:t.FunctionMinus},{n:"",css:"operator-multiply",funcType:t.FunctionTimes},{n:"",css:"operator-divide",funcType:t.FunctionDivide},{n:!mstrApp.isWSStyling?"%":"",css:"operator-percent-diff",funcType:t.FunctionMinus,funcType2:t.FunctionDivide}],AZ={m1:Af.did,m2:Ae[0].did,operator:t.FunctionPlus,u1:{id:Af.did,type:4},u2:null},AX=function(Ag){return{}.hasOwnProperty.call(Ag,"cst");},Ac=function(Ag){return typeof Ag==="string"&&!!Ag.length&&!isNaN(Number(Ag));};var AW="this.parent.popupConfig.valid || this.selectedIndex !== -1 || (!!this.selectedNode && this.selectedNode.innerHTML.length === 0)",Ab=function Ab(){var Ag=this.parent.popupConfig;if(Ag){Ag.set("okEnabled",this[this.editableSlot].innerHTML.length!==0);}};return new mstrmojo.ui.menus.EditorConfig({cssClass:"Calculation-MenuEditor",contents:[AQ({metrics:Ae,value:AZ.m1,propName:"u1",optionValueField:"did",bindings:{valid:AW},postkeyup:Ab}),{scriptClass:"mstrmojo.ButtonListHoriz",items:AY,selectedIndex:0,postselectionChange:function Aa(){this.parent.data.set("operator",this.selectedItem.funcType);this.parent.data.set("operator2",this.selectedItem.funcType2);}},AQ({metrics:Ae,value:null,propName:"u2",optionValueField:"did",bindings:{valid:AW},postkeyup:Ab})],data:AZ,okEnabled:false,bindings:{valid:function(){var Ai=this.data.u1,Ah=this.data.u2,Aj=this.data.operator;if(!Ai||!Ah||!Aj){return false;}var Ag=!(AX(Ai)&&AX(Ah))&&(!AX(Ai)||Ac(Ai.cst))&&(!AX(Ah)||Ac(Ah.cst));this.set("okEnabled",Ag);return Ag;}},fnOk:function(Ag){return Ad(Ag.u1,Ag.u2,Ag.operator,Ag.operator2);}});},getCfgForAddUnitFromAllObject:function(AW,AX){var AY=null,AZ=null,Aa=[],Ab=function(Ac,Ad){if(!Ad){return false;}return z.find((Ad.att||[]).concat(Ad.mx||[]),"did",Ac.did)>-1;};a.forEach(AX,function(Ad,Ac){if(Ad.idd){AY=Ac;AZ=Ad;return false;}return true;});if(!AY){AY="$GUID_141";Aa.push({act:"createDataset",mgo:true,prm:true,name:mstrApp.projectName,idd:true,newObjectIds:[AY]});}z.forEach(AW,function(Ac){if(!Ab(Ac,AZ)){Aa.push({act:"addUnitToDataset",dsid:AY,unitId:Ac.did,unitType:Ac.t});}});return{actions:Aa,dsid:AY};},getAggregateByMenu:function q(Ab,AZ){var AX=new mstrmojo.ui.menus.MenuConfig(),AY=function(Af,Ae){var Ah,Ag;if(Ae){var Ad=Af.mexp.args[0];Ah=Ad.did;Ag=Ad.t;}else{Ah=Af.did;Ag=Af.t;}return{did:Ah,t:Ag};},AW=this.getAvailableShortcutMetricFunctionsGroup(Ab),Ac=Ab.mexp?Ab.mexp.ft:null,Aa=Ab.mexp&&this.isAmongFunctions(Ac,AW);AW.forEach(function(Ad,Ae){if(Ae!==0){AX.addSeparator();}Ad.forEach(function(Af){AX.addMenuItem(Af.n,"",function(){AZ(AY(Ab,Aa),Af.t);});});});return AX;},showObjectPicker:function p(AX,AW){var AY="object_picker";return function(){var AZ=mstrmojo.all[AY];if(!AZ){AZ=new mstrmojo.vi.ui.editors.ObjectPicker({id:AY});if(AW){AZ.supportedTypes=z.hash(AW);AZ.ob.browsableTypes="8,"+AW.join(",");}AZ.render();}else{if(AW){AZ.supportedTypes=z.hash(AW);AZ.ob.browsableTypes="8,"+AW.join(",");}AZ.browse();}AZ.OKFn=AX||mstrmojo.emptyFn;AZ.open();};},getObjectPicker:function p(){var AW="object_picker";return mstrmojo.all[AW];},generateNumberFormat:function AB(Ab){var AW=W.DefaultFormat.FormattingNumber,AX=W.NumberFormatCategory,AZ=Ab||{},AY=AZ.nct,Aa=AY===AX.General&&AZ.nfs==="General";return{category:(AY===undefined||Aa)?AX.Automatic:AY,decimalPlaces:AZ.ndp===undefined?2:AZ.ndp,thousandSeparator:AZ.nth===undefined?parseInt(AW.ThousandSeparator,10):(AZ.nth?-1:0),currencySymbol:AZ.ncs||AW.CurrencySymbol,currencyPosition:AZ.ncp||AW.CurrencyPosition,format:AZ.nfs||"",negativeNumbers:AZ.nnn||AW.NegativeNumbers};},getNumberFormatEditor:function AH(AZ,AY,AX){var AW=this.generateNumberFormat(AY),Aa=a.clone(AW),Ac=a.clone(AW);return new mstrmojo.ui.menus.EditorConfig({data:Aa,bindings:{okEnabled:function(){return !(this.data.category===Ac.category&&this.data.format===Ac.format);}},cssClass:"NumberFormat-MenuEditor",contents:[{scriptClass:"mstrmojo.vi.ui.NumberFormatter",formatValue:AW,myData:Aa,oldData:Ac,adjustAfterCategoryChange:function(){this.parent.adjustCornersForPopupOverflow();}}],fnOk:function Ab(Ad){if(!(Ad.category===Ac.category&&Ad.format===Ac.format)){return AX(Ad,Ac);}}});},getHighlightElementHandler:function(AY,AX,AW){return function(){D.toggleClass(AX,AW||"open",AY);};},getConfDataTypeMenuCfg:function AL(AW,Ar,Aj,A5){var A0="ToString",Aq="ToNumber",Ao="ToDateTime",Ai="keepOriginal",AZ="Default",A1={ToString:u.DssXmlBaseFormText,ToNumber:u.DssXmlBaseFormNumber,ToDateTime:u.DssXmlBaseFormDate},Ae={ToString:"D1ED29645DEC4DBF99E8E09ED939074B",ToNumber:"399C3EC1041643F1ACE8F2A92B1C1F2F",ToDateTime:"0A558C7295DE42DAA8C5594F1724563F"},Ac="_pattern",A3="_func",Am="_bft",A8="_state",A6={UNCHANGED:0,TO_CREATE:1,TO_UPDATE:2},Ab={n:"Default",v:"Default"},Ay=[{n:"MM-DD-Year",v:"MM-DD-Year"},{n:"MM/DD/Year",v:"MM/DD/Year"},{n:"DD-MM-Year",v:"DD-MM-Year"},{n:"DD/mm/Year",v:"DD/mm/Year"},Ab],AY=[{n:mstrmojo.desc(13772,"Keep Original"),v:Ai},{n:mstrmojo.desc(12276,"String"),v:A0},{n:mstrmojo.desc(2052,"Date"),v:Ao},{n:mstrmojo.desc(3434,"Number"),v:Aq}];if(mstrApp&&mstrApp.showMultiDataType){AY=[{n:mstrmojo.desc(13772,"Keep Original"),v:Ai},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(3434,"Number"),v:Aq,bft:u.DssXmlBaseFormNumber},{n:mstrmojo.desc(9920,"Big Decimal"),v:Aq,bft:u.DssXmlBaseFormBigDecimal},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(2052,"Date"),v:Ao,bft:u.DssXmlBaseFormDate},{n:mstrmojo.desc(9919,"DateTime"),v:Ao,bft:u.DssXmlBaseFormDateTime},{n:mstrmojo.desc(2170,"Time"),v:Ao,bft:u.DssXmlBaseFormTime},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(3544,"Text"),v:A0,bft:u.DssXmlBaseFormText},{n:mstrmojo.desc(9921,"HTML Tag"),v:A0,bft:u.DssXmlBaseFormHTMLTag},{n:mstrmojo.desc(8984,"Phone Number"),v:A0,bft:u.DssXmlBaseFormPhoneNumber},{n:mstrmojo.desc(4530,"Symbol"),v:A0,bft:u.DssXmlBaseFormSymbol},{n:mstrmojo.desc(9922,"URL"),v:A0,bft:u.DssXmlBaseFormUrl},{n:mstrmojo.desc(4699,"Email"),v:A0,bft:u.DssXmlBaseFormEmail}];}var Ah=a.clone(AY).slice(1),Ap=Ar.fs.filter(function(BA){return Ar.da||BA.obf;}),A9=Ap.length>1,Al=Ap.length>5,Ad=false,Az=false,As=[],Ax=[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13773,"Select Data Type for New Attribute:"),cssClass:"menu-info-text menu-header-text"}],A7={okEnabled:false},A2=function(){var BA=false;Ap.forEach(function(BB){BA=BA||(A7[BB.fnm+A3+A8]!==A6.UNCHANGED)||(A7[BB.fnm+Ac+A8]!==A6.UNCHANGED);});return BA;},At=function(BC,BB){var BA=0;if(BC.da){z.forEach([A0,Ao,Aq],function(BF,BD){var BE=new RegExp("^\\s*"+BF+"\\s*(<.*>)?\\s*\\((.+)\\)\\s*$","i").exec(BB.f);if(BE&&BE[2]){BA=BD+1;return false;}});}return BA;},Aw=function(BC,BB){var BA=0;if(BC.da){var BD=BB&&BB.bftp;z.forEach(AY,function(BF,BE){if(BF.bft===BD){BA=BE;return false;}});}return BA;},Av=function(BC,BB){var BD=AZ;if(Ar.da){var BA=new RegExp("^\\s*"+BB+'\\s*<\\s*Pattern\\s*=\\s*"(.+)"\\s*>.*$',"i").exec(BC.f);if(!mstrmojo.string.isEmpty(BA&&BA[1])){BD=BA[1];}}return BD;},Au=function(){return Al?this.parent.parent.parent:(A9?this.parent.parent:this.parent);},An=function(BA){if(Al){BA.formList.updateScrollbars();}},Aa=function(BH,BI,BG){var BA=BI.fnm,BD=Al?BH.formList[BI.fnm+Ac]:BH[BI.fnm+Ac],BE=A9?BD.children[1]:BD,BF=A7[BA+A3],BC=Ad&&(BF===Ao||BF===A0),BB=BD.visible!==BC;if(BB){BD.set("visible",BC);if(BC){An(BH);}else{BE.hideTooltip();}}if(BG){BE.set("text",Av(BI,BF));BE.set("items",BF===Ao?Ay:[Ab]);}},Ak=function(BA){var BB=false;Ap.forEach(function(BC){if(A7[BC.fnm+A3]===Ao||A7[BC.fnm+A3]===A0){BB=true;return false;}});BA.advancedLabel.set("visible",BB);},AX=function(BC,BA,BD){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:BC,alias:BD.fnm+A3,selectedIndex:BA,onPopupWidgetOpened:function(){An(Au.call(this));},onitemSelected:function BB(BI,BG){var BH=Au.call(this),BJ=BH.data,BK=BD.fnm,BF=BI.v,BE=function(BL){if(BL){return(BC.length===3?A6.TO_UPDATE:A6.TO_CREATE);}return A6.UNCHANGED;};BJ.set(BK+A3,BF);BJ.set(BK+Ac,Av(BD,BF));BJ.set(BK+Am,BF===Ai?BD.bftp:(BI.bft?BI.bft:A1[BF]));BJ.set(BK+A3+A8,BE(BG!==BA));BJ.set("okEnabled",A2());Aa(BH,BD,true);Ak(BH);}};},Ag=function(BC,BD,BA){return{scriptClass:"mstrmojo.ui.SearchablePulldown",isHostedWithin:false,alias:BC.fnm+Ac,useRichTooltip:true,visible:BA,allowCustomText:true,allowEmptyText:true,onPopupWidgetOpened:function(){An(Au.call(this));},customizeSearchResult:function(BE){if(z.find(BE,"v","Default")===-1&&this.items.length>0){BE.push(Ab);}},onclick:function(BE){mstrmojo.ui.SearchablePulldown.prototype.onclick.call(this,BE);this.set("isEditing",true);},updateData:function(BG){var BE=Au.call(this),BF=BE.data,BH=BC.fnm;BF.set(BH+Ac,BG);BF.set(BH+Ac+A8,BD!==BG?A6.TO_UPDATE:A6.UNCHANGED);BF.set("okEnabled",A2());},onitemSelected:function BB(BE){if(BE){this.updateData(BE.v);}},onkeyup:function(BE){mstrmojo.ui.SearchablePulldown.prototype.onkeyup.call(this,BE);var BF=this[this.editableSlot],BG=BF.innerText||BF.textContent;this.updateData(BG);},updateTooltipConfig:function(BF){this.tooltipOpenDelay=BF?500:0;var BE=Y.position(this.domNode);this.richTooltip={content:mstrmojo.desc(14114,'Pattern determines the formatting for the resulting string of characters. You can use the custom numeric, date, and time formatting symbols. <br/> Example: if pattern is defined as "0,000.00" for "1001", it returns the string "1,001.00"'),posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:BE.y-2,left:BE.x+BE.w+10};}};},A4=function(BI,BH,BA,BB,BG){var BD=mstrApp&&mstrApp.showMultiDataType?Aw(BI,BH):At(BI,BH),BF=Av(BH,AY[BD].v),BC=BH.fnm,BE=AY;if(BD>0){BE=Ah;BD--;}BB[BC+Ac]="";BB[BC+A3]="";BB[BC+Am]="";BB[BC+A3+A8]=BB[BC+Ac+A8]=A6.UNCHANGED;if(BG){BA.push({scriptClass:"mstrmojo.HBox",cssClass:"func-input",alias:BC+A3,children:[{scriptClass:"mstrmojo.Label",text:BC,useRichTooltip:true,updateTooltipConfig:function(BL){this.tooltipOpenDelay=BL?500:0;var BK=this.domNode;var BJ=Y.position(BK);if(BK.scrollWidth>BK.offsetWidth){this.richTooltip={content:BK.innerText,posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-V",top:BJ.y-BJ.h-10,left:BJ.x-10};}}},a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown HBOXPullDown"},AX(BE,BD,BH,true))]});BA.push({scriptClass:"mstrmojo.HBox",cssClass:"pattern-input",alias:BC+Ac,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12078,"Pattern"),cssClass:"menu-info-text"},a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown HBOXPullDown"},Ag(BH,BF,true))]});}else{BA.push(a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown"},AX(BE,BD,BH,false)));BA.push(a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown"},Ag(BH,BF,false)));}};z.forEach(Ar.fs,function(BA){if(AW.als&&AW.als.links[Ar.did+" "+BA.fid]){Az=true;return false;}});if(A9){Ap.forEach(function(BA){A4(Ar,BA,Al?As:Ax,A7,true);});}else{A4(Ar,Ap[0],Ax,A7,false);}if(Al){Ax.push({scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"formList",cssClass:"formList",children:As});}Ax.push({scriptClass:"mstrmojo.Label",cssClass:"advancedLabel",alias:"advancedLabel",allowHTML:true,text:"<span>"+mstrmojo.desc(702,"Advanced")+"</span>",onclick:function(){var BB=this.parent,BC,BA,BD=true;Ad=!Ad;D.toggleClass(this.domNode,"expanded",Ad);Ap.forEach(function(BE){Aa(BB,BE,false);BC=Al?BB.formList[BE.fnm+Ac]:BB[BE.fnm+Ac];BA=A9?BC.children[1]:BC;if(BC.visible&&BD&&!Al){BD=false;BA.showTooltip();}});}});return new mstrmojo.ui.menus.EditorConfig({data:A7,cssClass:"ConfDataType-MenuEditor",contents:Ax,onOpen:function(){An(this);},bindings:{okEnabled:"this.data.okEnabled"},fnOk:function Af(BC){var BA=[],BE=[],BB=false,BD=function(BH,BI,BG){var BK=[],BJ=function(BL){var BM=BL.ftk&&BL.ftk.slice(2,-2);if(!BM){return null;}while((BM.shift()).v!=="("){}return BM;},BF=BJ(BG)||[AJ(Ar,BG)];BK.push({v:"!",tp:33,lv:4});if(BH!==Ai){BK.push({v:BH,oi:{did:Ae[BH],t:11,st:2816,n:BH}});if(!mstrmojo.string.isEmpty(BI)&&BI!==AZ&&(BH===Ao||BH===A0)){BK.push({v:'<Pattern="'+BI+'">(',tp:"2",lv:1});}else{BK.push({v:"(",tp:"2",lv:1});}BK=BK.concat(BF);BK.push({v:")",tp:"2",lv:1});}else{BK=BK.concat(BF);}BK.push({v:"",tp:-1,lv:4});return mstrmojo.ME.AttributeEditBox.getTokenStreamXML({items:BK});};if(Az){BB=true;}else{Ap.forEach(function(BF){if(BC[BF.fnm+A3+A8]===A6.TO_CREATE){BB=true;return false;}else{if(BC[BF.fnm+A3+A8]===A6.TO_UPDATE||(BC[BF.fnm+Ac+A8]===A6.TO_UPDATE&&(BC[BF.fnm+A3]===Ao||BC[BF.fnm+A3]===A0))){BE.push(BF);}}});}if(BB){Ap.forEach(function(BF){BA.push({n:BF.fnm,formula:BD(BC[BF.fnm+A3],BC[BF.fnm+Ac],BF),bft:BC[BF.fnm+Am]});});A5(BB,BA);}else{if(Ar.da){Z(AW.mid,Ar.did,BE,function(BF){BF.forEach(function(BG){BA.push({did:BG.fid,formula:BD(BC[BG.fnm+A3],BC[BG.fnm+Ac],BG),bft:BC[BG.fnm+Am]});});A5(BB,BA);});}}}});},getCreateTimeDAEditorCfg:function P(AZ,AY){var AW=d(AZ);if(!AW){return null;}return new mstrmojo.ui.menus.EditorConfig({data:{okEnabled:false},cssClass:"CreateTimeAttribute-MenuEditor",contents:[{scriptClass:"mstrmojo.ui.CheckList",alias:"time_type",items:[{n:mstrmojo.desc(873,"Year"),v:"Year"},{n:mstrmojo.desc(10051,"Quarter of Year"),v:"QuarterOfYear"},{n:mstrmojo.desc(10050,"Quarter"),v:"Quarter"},{n:mstrmojo.desc(10049,"Month of Year"),v:"MonthOfYear"},{n:mstrmojo.desc(871,"Month"),v:"Month"},{n:mstrmojo.desc(10047,"Week of Year"),v:"WeekOfYear"},{n:mstrmojo.desc(10048,"Week"),v:"Week"},{n:mstrmojo.desc(11608,"Day of Year"),v:"DayOfYear"},{n:mstrmojo.desc(10046,"Day of Month"),v:"DayOfMonth"},{n:mstrmojo.desc(10045,"Day of Week"),v:"DayOfWeek"}],onchange:function AX(){var Ab=false;a.forEach(this.selectedIndices,function(Ac){if(Ac){Ab=true;return false;}});this.parent.data.set("okEnabled",Ab);}}],bindings:{okEnabled:function(){return this.data.okEnabled;}},fnOk:function Aa(Af,Ad){var Ae=Ad.time_type,Ai=Ae.selectedIndices,Ac=Ae.items,Ah=[],Ab=[],Ag=function(Aj,Al,An){var Am=[{v:"!",tp:33,lv:4}],Ak;An.forEach(function(Ao){if(Ao===Q){Am.push(AJ(Aj,Al));}else{Ak=AM[Ao];if(Ak){Am.push({v:Ak,oi:{did:Ak,t:11,st:2816,n:Ak}});}else{Am.push({v:Ao,tp:"2",lv:1});}}});Am.push({v:"",tp:-1,lv:4});return mstrmojo.ME.AttributeEditBox.getTokenStreamXML({items:Am});};a.forEach(Ai,function(Aj,Ak){if(Aj){Ab=[];a.forEach(AS[Ac[Ak].v],function(Al,Am){Ab.push({n:Am,formula:Ag(AZ,AW,Al),bft:(Am==="DATE"?8:0)});});Ah.push({isTokenStream:true,forms:Ab,name:AZ.n+" ("+Ac[Ak].n+")"});}});return AY(Ah);}});},RefreshAndCloseAllObjectBrowserCallback:function(AX,AW){return mstrmojo.func.wrapMethods(AW.getDatasetsUpdateCallback(),{success:function(){if(z.find(AX,"act","createDataset")!==-1){AW.controller.datasetsPanel.set("allObjectBrowserOpened",false);}}});},getUnitFromDataset:function e(AX,AZ,AW){var AY=null;a.forEach(AX,function(Ab){var Aa=Ab.att||[];if(AW===4){Aa=Ab.mx||[];}z.forEach(Aa,function(Ac){if(Ac.did===AZ){AY=Ac;return false;}});if(AY){return false;}});return AY;},getDatasetFromId:function R(AW,AX){var AY=null;a.forEach(AW,function(AZ){if(AZ.did===AX){AY=AZ;return false;}});return AY;},getDatasetFromAttributeId:function R(AW,AX){var AY=null;a.forEach(AW,function(AZ){if(z.find(AZ.att,"did",AX)>=0){AY=AZ;return false;}});return AY;},getSortedDatasetUnits:function E(AW){var AX=function AX(AY){return AY.t===X.DssTypeMetric?2:1;};AW=AW.concat();AW.sort(function(Ab,AZ){if(!Ab||!AZ){return true;}var Ac=AX(Ab)-AX(AZ),Aa=Ab.n.toUpperCase(),AY=AZ.n.toUpperCase();return Ac!==0?Ac:(Aa!==AY?Aa.localeCompare(AY):Ab.n.localeCompare(AZ.n));});return AW;},isGeoAttr:function AN(AW,AX){return !!(AW.fs&&(AW.fs instanceof Array)&&AW.fs.length&&AW.fs.some(function(AY){return AY.fgr>0&&(!AX||(AX&&AY.obf));}));},isTimeAttr:function h(AW){return !!(AW.fs&&d(AW));},getUnitCssClass:function(AX){var AW=AX.t;if(this.isGeoAttr(AX,AX.useAvailGeoFmsOnly)){AW+="g";}else{if((AX.dm||AX.um)||AX.da){AW+="d";}else{if(AX.de){AW+="de";}else{if(this.isTimeAttr(AX)){AW+="t";}}}}if((AX.t===AV.Consolidation&&AX.st===N.ConsolidationManaged)||(AX.t===AV.Attribute&&AX.st&&AX.st===N.AttributeRecursive)){AW+=(" st"+AX.st);}if(AX.t===AV.Consolidation&&AX.st===N.ConsolidationManaged&&AX.ndetype===AG.DssRecursiveDerivedElement){AW+=" nde4ra";}return"ic"+AW;},hasMultiForms:function o(AX,AW){return w.getFormsByAttrId(AX,AW).length>1;},getDisplayFormsMenu:function F(Al,Aj,Ad,Ai){var Ah=[],Ak=[],Aa=[],Af=[{n:mstrmojo.desc(2411,"Off"),v:0},{n:mstrmojo.desc(2410,"On"),v:1},{n:mstrmojo.desc(8504,"Form Name Only"),v:2},{n:mstrmojo.desc(8505,"Show Attribute Name Once"),v:3},{n:mstrmojo.desc(4531,"Automatic"),v:4}];var Ae=Aj.model.data,AW=Ae.gts,Ag;var AZ=Al.t===AV.Consolidation&&Al.st===N.ConsolidationManaged;z.forEach((AW.row||[]).concat(AW.col||[]),function(Am){if(Am.id===Al.did){Ak=Ak.concat(Am.fs);}});Ag=w.getFormsByAttrId(Al.attId||Al.did,Ad);z.forEach(Ag||[],function(An){var Ao=An.fid;if(z.find(Ah,"id",Ao)<0){Ah.push({id:Ao,n:An.fnm});var Am=z.find(Ak,"id",Ao);if(Am>-1){Aa[Ah.length-1]=true;}}});var Ab=[{alias:"fs",scriptClass:"mstrmojo.ui.CheckList",minimumSelectCnt:1,items:Ah,selectedIndices:Aa},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11918,"Display attribute form names:"),cssClass:"menu-info-text"},{alias:"longNames",scriptClass:"mstrmojo.ui.Pulldown",items:Af,isHostedWithin:false,selectedIndex:z.find(Af,"v",Ae.lnm||0),onitemSelected:function AX(Am){this.v=String(Am.v);}}];if(Aj.getChartStyle&&Aj.getChartStyle()==="NewGraphMatrixVisualizationStyle"){Ab.splice(-2,2);}if(AZ){Ab.splice(-2,2);}return new mstrmojo.ui.menus.EditorConfig({cssClass:"displayForms",data:{item:Al,oldSelected:a.copy(Aa,{})},contents:Ab,okBtnText:mstrmojo.desc(1442,"Ok"),fnOk:function AY(Ar,Av){var Aq=Av.fs,Ao=Aq.selectedIndices,At=Aq.items,Az=[],As=[],Aw=[];if(!Aq.getSelectedItems().length){mstrmojo.alert("Please select at least one form!");return ;}var An=Ar.oldSelected,Ay=Ao,Ap,Au={},Ax={};for(Ap=0;Ap<At.length;Ap++){if(An[Ap]&&!Ay[Ap]){Au[Ap]=true;}else{if(!An[Ap]&&Ay[Ap]){Ax[Ap]=true;}}}a.forEach(Au,function(A0,A1){if(A0){As.push({act:"removeForm",unitId:Al.did,unitType:Al.t,attFormId:At[A1].id});}});var Am=Aj.model.data.gts;(Am.row||[]).concat(Am.col||[]).forEach(function(A0){if(A0.id===Al.did){(A0.fs||[]).forEach(function(A1){if(z.find(Ah,"id",A1.id)<0){As.push({act:"removeForm",unitId:Al.did,unitType:Al.t,attFormId:A1.id});}});}});a.forEach(Ax,function(A0,A1){if(A0){Az.push({act:"addForm",unitId:Al.did,unitType:Al.t,attFormId:At[A1].id,unitPos:0});}});Aw.push({act:"putProperties",prs:"Template Formatting",pr:"LongNames",v:Av.longNames?Av.longNames.v:0});if(Ai){Ai([{act:"updateTemplate",keyContext:Aj.k,partialRetrieval:{nodes:[Aj.k]},actions:As.concat(Az).concat(Aw)}]);}},onOpen:function Ac(){this.fs.updateScrollbars();}});},getAttributeLinkMenu:function j(Ai,Al,Ag,Ak,Ab){var Am=-2147483648,Ad=Ak.datasets,Ae=Ad[Ag],Aj=Ae.tables||[],AW={},Af=[],AZ=(Al.fs&&Al.fs[0])||{},Ah=[],Ac=779,AY=Al.art>1,AX=!AY&&a.keyarray(Ad).length>1,Aa=function(){mstrmojo.vi.ui.editors.AttributeLinkEditor.open({attribute:Al,docModel:Ak,datasetId:Ag});};if((Ae.st!==Ac)||Aj.length<=1||Al.da){if(AX){Ai.addMenuItem(mstrmojo.desc(11941,"Link to Other Dataset..."),"",Aa);}return ;}z.forEach(Ae.att,function(Ap){var Aq=true,Ao=null,An=(Ap.fs&&Ap.fs[0])||{};if(Ap.da){return ;}if(AZ.der===Am||An.der===Am||AZ.fgr===-1||An.fgr===-1||AZ.ftr===-1||An.ftr===-1){return ;}if(AZ.fgr&&An.fgr&&AZ.fgr!==An.fgr){return ;}if(AZ.ftr&&An.ftr&&AZ.ftr!==An.ftr){return ;}z.forEach(Aj,function(Ar){var As=z.find(Ar.attRefs,"did",Al.did),At=z.find(Ar.attRefs,"did",Ap.did);if(As>=0&&z.indexOf(Af,Ar.did)<0){Af.push(Ar.did);}if(At>=0){Ao=Ar.did;}if(As>=0&&At>=0){Aq=false;}});if(Aq&&!Ap.hide){AW[Ap.did]=Ao;Ah.push(Ap);}});if(Ah.length>0&&Ae.hcs!==true&&!Ak.isSparkDataset(Ae)){Ai.addEditorMenuItem(mstrmojo.desc(13172,"Map Attributes"),"",function(){return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"mapAttribute",okVisible:false,cancelVisible:false,contents:[{scriptClass:"mstrmojo.ui.ScrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:Ah,listHooks:{select:function An(Ao,Ap){Ak.warnForEditStandaloneDS(Ae,function(){z.forEach(Af,function(Aq){I({dsid:Ag,srcId:Al.did,srcTableId:Aq,tgtId:Ap.did,tgtTableId:AW[Ap.did]},Ak,Ab);});});}}}]}]});});}if(AX){Ai.addMenuItem(mstrmojo.desc(11941,"Link to Other Dataset..."),"",Aa);}},isDocumentLevelItem:function AA(AW){return AW&&(AW.um||AW.da||(AW.t===AV.Consolidation&&AW.st===N.ConsolidationManaged));},isLegalObjectName:function S(AW){var AX=/["\[\]\\]/g;if(AW.match(AX)){return false;}return true;},validateName:function l(AX,AY,AW){if(this.isLegalObjectName(AX)){AY();}else{mstrmojo.alert(mstrmojo.desc(8622,"The # cannot contain the reserved characters ##.").replace("##","'[', ']', '\"' and '\\'").replace("#",mstrmojo.desc(945,"Name")),AW,mstrmojo.desc(1388,"Rename"));}},hasCGorCon:function AU(AW){return AW.att.some(function(AX){return H(AX);});},isCGorCon:function AK(AW,AY){var AX=z.filterOne(AY&&AY.att,function(AZ){return AZ.did===AW.did;});return H(AX||AW);},hasOldDEOverDatasets:function(AZ,AY){var AX=false,AW;a.forEach(AY,function(Aa){AW=z.find((Aa.att||[]),"did",AZ);if(AW!==-1&&Aa.att[AW].de){AX=true;return false;}});return AX;},getMarkGeoRoleEditorCfg:function AR(AW,A8,Aq,An,BH,BJ){var Am=268435456,BE=536870912,Ab=1073741824,A0=268435456,BB=805306368,A6=805306368,Au=1879048192,BI=-2147483648,A9=0,BA=1,Ad=2,Al=3,Ap=4,Aj=5,BG=6,Ag=7,As=8,Ar=9,A2=10,AZ=2,Az=3,A7={v:A9,n:mstrmojo.desc(2057,"None")},BK={v:Al,n:mstrmojo.desc(7674,"Country"),der:Am},A5={v:Ad,n:mstrmojo.desc(7676,"State"),parents:[BK],der:BE},Ah={v:Ar,n:mstrmojo.desc(12919,"County"),parents:[BK,A5]},BC={v:BA,n:mstrmojo.desc(7675,"City"),parents:[BK,A5],der:Ab},Av={v:As,n:mstrmojo.desc(7677,"Zip Code"),parents:[BK,A5,BC]},Ao={v:Aj,n:mstrmojo.desc(7696,"Latitude")},A3={v:BG,n:mstrmojo.desc(7697,"Longitude")},Ak={v:Ap,n:mstrmojo.desc(7675,"City")+", "+mstrmojo.desc(7676,"State")},Ay={v:A2,n:mstrmojo.desc(12973,"Area Code")},A1={v:Ag,n:mstrmojo.desc(2056,"Custom")},Ai={ID:[A7,BK,A5,Ah,BC,Av,Ao,A3,Ak,Ay,A1],ID_NUMERIC:[A7,Av,Ay,Ao,A3],NON_ID:[A7,BK,A5,Ah,BC,Av,Ak,Ay,A1],NON_ID_NUMERIC:[A7,Av,Ay]},Aw=z.filter(A8.fs,function(BL){return(BL.bftp===AZ||BL.bftp===Az)&&BL.der!==BI;});var A4=(Aw.length>1),AY=z.find(Aw,"idf",true),Aa=(AY===-1?0:AY),Ax=Aw[Aa],Af,AX,At,Ac=[],Ae=function(BL){var BM=(BL.idf?"ID":"NON_ID")+(BL.bftp===AZ?"_NUMERIC":"");return Ai[BM];},BF=function(BM,BL){return z.find(Ae(BL),"v",BM);};if(Aw.length===0||z.find(A8.fs,"fgr",-1)!==-1||Ax.der===BI){return null;}z.forEach(Aw,function(BN,BL){var BM=a.clone(BN);BM.n=BM.fnm;Ac.push(BM);if(BN.fgr){Ax=BM;Aa=BL;}});Af=Ax.fid;At=Ax.fgr||0;AX=BF(At,Ax);return new mstrmojo.ui.menus.EditorConfig({data:{item:A8,geoForm:Ax,geoRole:At},cssClass:"MarkGeoRole-MenuEditor",contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13522,"Select Attribute Form:"),visible:A4},{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,cssClass:"MarkGeoRolePullDown",items:Ac,selectedIndex:Aa,alias:"formList",visible:A4,onitemSelected:function BD(BN){var BL=this.parent.data,BM=this.parent.geoRoleList;if(BL.geoForm.fid!==BN.fid){BL.set("geoForm",BN);BL.set("geoRole",BN.fgr);BM.set("items",Ae(BN));BM.set("selectedIndex",BF(BN.fgr,BN));}}},{scriptClass:"mstrmojo.ToolSeparator",visible:A4,markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13523,"Select Geographic Type:"),cssClass:"menu-info-text"},{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,cssClass:"MarkGeoRolePullDown",items:Ae(Ax),selectedIndex:AX,alias:"geoRoleList",onitemSelected:function BD(BR){var BQ=this.parent,BL=BQ.data,BS=BQ.geoDrvList;var BN=[],BP=[],BM=Ax.der,BO;BL.set("geoRole",BR.v);z.forEach(BR.parents,function(BT,BU){BO=BT;BN.push({n:BO.n,der:BO.der});if((BM&BO.der)!==0){BP[BU]=true;}});BS.set("items",BN);BS.set("selectedIndices",BP);z.forEach(["geoDrvSeparator","geoDrvLabel","geoDrvList"],function(BT){BQ[BT].set("visible",BN.length>0);});if(BQ.adjustCornersForPopupOverflow){BQ.adjustCornersForPopupOverflow();}}},{scriptClass:"mstrmojo.ToolSeparator",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},alias:"geoDrvSeparator"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13524,"(Optional) Create Additional Attributes:"),alias:"geoDrvLabel",cssClass:"menu-info-text"},{scriptClass:"mstrmojo.ui.CheckList",alias:"geoDrvList"}],fnOk:function(BQ,BP){var BM=function(BX){var BW=function(Bb){var Bc="<mpcs>";z.forEach(Bb,function(Bd){Bc+='<mpc did="'+Bd.did+'" n="'+Bd.n+'" georole="'+Bd.georole+'" drvflg="'+Bd.drvflg+'" />';});Bc+="</mpcs>";return Bc;},BS=function(Bb,Bd,Bf,Bc){var Be=function(Bj,Bg,Bi){var Bh=U(BX,Bj,Bg),Bk=n(Bh,Bi);return Bk&&Bk.did;};BH.forEach(function(Bg,Bh){var Bi=Be(Bg.did,A8.did,Bd.fid);if(Bi){Bb[Bh]=Bb[Bh]||[];Bb[Bh].push({did:Bi,n:Bd.fnm,georole:Bf,drvflg:Bc});}});},BU=[],Ba=[],BY=BP.geoDrvList,BT=0,BV=false,BZ={2:A0,1:BB,9:A6,8:Au}[BQ.geoRole]||0;a.forEach(BY.selectedIndices,function(Bc,Bb){if(Bc){BT|=BY.items[Bb].der;}});BT&=BZ;if(Ax.fgr!==BQ.geoRole||Ax.fid!==BQ.geoForm.fid||Ax.der!==BT){if(A4&&Ax.fid!==BQ.geoForm.fid){if(Ax.fgr!==A9){BS(Ba,Ax,A9,0);if(Ax.der>0){BV=true;}}}if(BQ.geoForm.fgr!==BQ.geoRole||BQ.geoForm.der!==BT){BS(Ba,BQ.geoForm,BQ.geoRole,BT);if((BT&BQ.geoForm.der)!==BQ.geoForm.der){BV=true;}}if(Ba.length>0){Ba.forEach(function(Bc,Bb){BU.push({act:"changeEMMAMapping",dsid:Aq,tbid:BH[Bb].did,mapping:BW(Bc)});});BJ(BU,BV);}}},BN=function(){C(AW.mid,Aq,{success:BM});};var BO=mstrApp.isAppStatePause();if(!An||BO){var BR,BL=BO?mstrmojo.desc(212,"Continue"):mstrmojo.desc(219,"Yes");if(An){BR=mstrmojo.desc(16237,"The operation requires the dataset to be unloaded from memory. It will be automatically reloaded when you resume data retrieval. Do you want to continue?");}else{BR=BO?mstrmojo.desc(16236,"The operation requires modifying the dataset and unloading it from memory. It will be automatically reloaded when you resume data retrieval, however the change will also affect other reports, documents, and dossiers that share the dataset. Do you want to continue?"):mstrmojo.desc(15493,"Modifications to this dataset will affect other reports, documents, and dossiers that share the dataset. Do you want to continue?");}mstrmojo.warn(BR,{},{buttons:[AC(BL,function(){BN();},true,{cssText:"min-Width: 60px"}),AC(mstrmojo.desc(221,"Cancel"),function(){})]});}else{BN();}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.DIPreviewSimpleGrid","mstrmojo.DI.DIFacebookPageItem");var I=mstrmojo.DI.DIConstants,A="grid",F="list",E="table",G=mstrmojo.DI.DIConstants.sourceType,J=mstrmojo.DI.DIFacebookPageItem;mstrmojo.DI.DIPreviewSimple=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIPreviewSimple",cssClass:"mstrmojo-di-dataPreviewSimple",previewType:A,markupString:'<div id="{@id}" class ="mstrmojo-DI-previewSlot {@previewType}"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{mappings:function(){return this.domNode;}},getListItems:function(M){var N=M.mi.ca.value;var K=[],L,O;for(L in N){O=N[L];K.push({n:O.n,d:O.cat,id:O.auto_id,pg_id:O.id,picUrl:O.picurl,likes:this.addCommas(O.likes),whCount:O.whCount,taCount:O.taCount});}return K;},addCommas:function D(O){O+="";var K=O.split("."),N=K[0],L=K.length>1?"."+K[1]:"",M=/(\d+)(\d{3})/;while(M.test(N)){N=N.replace(M,"$1,$2");}return N+L;},getTableItems:function(O,P){var S=[],Q,U=this.content,R;if(O.mi.ca.value.length===undefined){R=O.mi.ca.value;S.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:R.n,desc:R.cat,pg_id:R.id,picUrl:R.picurl,likes:this.addCommas(R.likes),link:R.link,slot:"0,0",source:U,advancedProperties:P});}else{var N=O.mi.ca.value;for(Q in N){R=N[Q];var L=Q,V,K,M;if(L%3===0){K=L/3;M=0;}else{K=Math.floor(L/3);M=M+1;}V=K+","+M;S.push({scriptClass:"mstrmojo.DI.DIFacebookPageItem",n:R.n,desc:R.cat,pg_id:R.id,picUrl:R.picurl,likes:this.addCommas(R.likes),link:R.link,slot:V,source:U,advancedProperties:P});}}return S;},populate:function C(K){if(this.previewType===A){this.content.populate(K);}else{var L=mstrApp.getRootController().model.externalSources[G.facebook].reports;if(this.previewType===F){this.content.set("items",this.getListItems(L));this.content.set("selectedIndex",0);}else{if(this.previewType===E){if(this.content.children){this.content.children=[];}this.content.addChildren(this.getTableItems(L,this.parent.advancedProperties));this.content.refresh();}}}},toggleDataPreview:function B(K){this.parent.toggleDataPreview(K);},preBuildRendering:function H(){if(this._super){this._super();}var L=mstrApp.getRootController(),K=L.model;if(this.previewType===A){this.set("class","mstrmojo-DI-previewSlot grid");this.addChildren({scriptClass:"mstrmojo.DI.DIPreviewSimpleGrid",alias:"content",slot:"mappings",columns:[],cssText:"height:100%;"});}else{if(this.previewType===F){this.set("class","mstrmojo-DI-previewSlot list");this.addChildren({scriptClass:"mstrmojo.List",cssText:"background-color: 0xffffff; overflow-x: hidden; overflow-y: auto; width: 100%",onchange:function(){var N=document.getElementById("mstrmojo-DI-FBList-row"+this.selectedIndex);mstrmojo.css.toggleClass(N,"selected",true);},itemMarkupFunction:function(S,O){var Q=" class = mstrmojo-DI-FBList-row",N=S.picUrl,P="",U=' id="mstrmojo-DI-FBList-row'+O+'"',R='<p style= "margin:0px; font-size:10pt;">';return"<div"+Q+'><table cellpadding="0" cellspacing="0" style="width: 100%; padding-left: 10px"><tr'+U+'class = "mstrmojo-DI-FBList-row"><td style="vertical-align: middle; width: 20%;"><img src='+N+'> </td><td style="vertical-align: middle; width: 40%;">'+S.n+"</td><td"+P+' style="vertical-align: middle; width: 40%;">'+R+S.d+"</p>"+R+"Likes: "+S.likes+"</p></td></tr></table></div>";},slot:"mappings",alias:"content"});}else{if(this.previewType===E){this.set("class","mstrmojo-DI-previewSlot table");this.addChildren({scriptClass:"mstrmojo.Table",slot:"mappings",alias:"content",cssClass:"mstrmojo-di-facebook-previewTable",bindings:{rows:function(){return 20;}},cols:3,selectedItem:undefined,handleSelectionChange:function M(O){var N=this.selectedItem;if(N){N.setUnSelectedItem();}O.setSelectedItem();this.selectedItem=O;mstrApp.getRootController().sourceSelected(true);}});}}}},children:[]});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefinePanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineSuggestionPreview","mstrmojo.Refine.RefineControlSplit","mstrmojo.Refine.RefineControlWhitespace","mstrmojo.Refine.RefineControlDelete","mstrmojo.Refine.RefineControlFacet","mstrmojo.Refine.RefineControlTransformCell","mstrmojo.Refine.RefineControlFindAndReplace","mstrmojo.Refine.RefineControlRemoveText","mstrmojo.Refine.RefineControlOther","mstrmojo.Refine.RefineSuggestions","mstrmojo.Refine.RefineControlExtract","mstrmojo.string","mstrmojo.array","mstrmojo.Refine.RefineTransformations","mstrmojo.Refine.RefineHelpers");mstrmojo.requiresDescs(12799);var K=mstrmojo.array,F=mstrmojo.Refine.RefineHelpers;function M(P){P=P.replace(/\n/g,"\\n");P=P.replace(/\t/g,"\\t");return P;}function L(P){return P.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}var A={};A.regex=function(){var Q={};var P=function(V){return[new RegExp(V),/\d+/];};var U=function(V){var W=[new RegExp(V),/[a-zA-Z]+/];if(V.toLowerCase()===V){W.push(/[a-z]+/);}else{if(V.toUpperCase()===V){W.push(/[A-Z]+/);}}return W;};var R=function(V){return[new RegExp(mstrmojo.string.regEscape(V))];};Q.candidates=function(X){if(X.length){var c=Q.parse(X[0].text,X[0].start,X[0].end),W=X.slice(0),a,d,Z,Y;a=(c.on||[]).map(function(e){return{on:e};});var b=c.before,V=c.after;if(b===undefined||b.length===0){d=V.map(function(e){return{after:e,on:/.*/};});}else{if(V===undefined||V.length===0){d=b.map(function(e){return{before:e,on:/.*/};});}else{d=V.map(function(e){return{after:e,on:/.*/};}).concat(b.map(function(e){return{before:e,on:/.*/};}));}}Y=a.concat(d);if(W.length===0){return Y;}Y=Y.filter(function(e){return W.filter(function(g){Z=A.regex.match(g.text,e);if(W.length===1){if((e.before===undefined)&&(e.after===undefined)){var f;if(e.on.source.length===1){f=e.on.source.charCodeAt(0);if(!(f>64&&f<91)&&!(f>96&&f<123)&&!(f>47&&f<58)){return false;}}if(e.on.source[0]==="\\"&&e.on.source.length===2){f=e.on.source.charCodeAt(1);if(!(f>64&&f<91)&&!(f>96&&f<123)&&!(f>47&&f<58)){return false;}}}}return(Z.length<2||((e.before===undefined)&&Z[1].start!==g.start)||((e.after===undefined)&&Z[1].end!==g.end));}).length===0;});return Y;}return[];};var S=function(V){var W=V.map(function(X){return X.toString().replace(/^\/|\/$/g,"");}).join("");return new RegExp(W);};Q.parse=function(l,b,a,f){l=String(l);var d=/([a-zA-Z]+)|([0-9]+)|([^a-zA-Z0-9])/g;var e=(l.substring(0,b).match(d)||[]).concat(l.substring(b,a).match(d)||[]).concat(l.substring(a).match(d)||[]);var k=f||{},V,m,Z,X,c=0,g,h,Y,n=k.matchAfter||2,W=k.matchBefore||2;if(!Array.prototype.filter){Array.prototype.filter=function(u){var q=0,o=this&&this.length||0,p=[],t;for(;q<o;++q){t=this[q];if(u(t,q,this)){p.push(t);}}return p;};}if(!Array.prototype.map){Array.prototype.map=function(t){var q=0,o=this&&this.length||0,p=new Array(o);for(;q<o;++q){p[q]=t(this[q],q,this);}return p;};}if(!Array.prototype.reduce){Array.prototype.reduce=function(x,p){if(this===null){throw new TypeError("Array.prototype.reduce called on null or undefined");}if(typeof x!=="function"){throw new TypeError(x+" is not a function");}var u=Object(this),o=u.length>>>0,q=0,w;if(arguments.length===2){w=p;}else{while(q<o&&!(q in u)){q++;}if(q>=o){throw new TypeError("Reduce of empty array with no initial value");}w=u[q++];}for(;q<o;q++){if(q in u){w=x(w,u[q],q,u);}}return w;};}if(!Array.prototype.forEach){Array.prototype.forEach=function(q){var p=0,o=this&&this.length||0;for(;p<o;++p){q(this[p],p,this);}};}e=e.filter(function(o){return o!==null;});m=e.map(function(o,p){V=o.charCodeAt(0);if(b>=c&&b<c+o.length){Z=p;}if(a>c&&a<=c+o.length){X=p;}c+=o.length;if((V>64&&V<91)||(V>96&&V<123)){return U(o);}if(V>47&&V<58){return P(o);}return R(o);});if(Z===undefined){Z=e.length-1;}if(X===undefined){X=e.length-1;}if(X-Z>10){g=[[]];m.slice(Z,X+1).forEach(function(o){g[0].push(o[0]);});}else{g=m.slice(Z,X+1).reduce(function(p,o){var q=[];p.forEach(function(t){o.forEach(function(u){q.push(t.concat(u));});});return q;},[[]]);}var j=function(p,o){var q=[];if(p.length){p.forEach(function(t){o.forEach(function(u){q.push(t.concat(u));});});return p.concat(q);}return o.map(function(t){return[t];});};Y=m.slice(Math.max(Z-n,0),Z).reverse().reduce(j,[]);h=m.slice(X+1,Math.min(X+W+1,m.length)).reduce(j,[]);return{on:g.map(S),after:(Y||[]).map(function(o){return S(o.reverse());}),before:(h||[]).map(function(o){return S(o);})};};return Q;};A.regex.record=function(U,V,P,Q,S,R){return{text:U,start:V,end:P,col:Q,row:S,table:R};};A.regex.friendly_description=function(P){var Q=P.toString().replace(/^\/|\/$/g,"");Q=Q.replace(/\n/g,"newline");Q=Q.replace(/ /g," ");Q=Q.replace(/\t/g,"tab");Q=Q.replace(/\(?(\[0\-9\]|\\d)\+\)?/g,"any number");Q=Q.replace(/\(?(\[a\-z\A\-Z\]|\[A\-Z\a\-\z\])\+\)?/g,"any word");Q=Q.replace(/\(?(\[a\-z\])\+\)?/g,"any lowercase word");Q=Q.replace(/\(?(\[A\-Z\])\+\)?/g,"any uppercase word");Q=Q.replace("\\","");if(Q==="newline"){return Q;}return Q;};A.regex.match=function(Y,Q){if(!Y){return"";}var V=Q.max_splits;if(V===undefined){V=1;}var P={start:0,end:Y.length,value:Y};var X=[];var W=0;var R=Number(Q.which);var Z;if(isNaN(R)){R=1;}while(V<=0||W<V*R){var b=A.regex.matchOnce(P.value,Q);if(b.length>1){P=b[2];X.push(b[0]);X.push(b[1]);Z=0;}else{break;}W++;if(W>1000){break;}}X.push(P);Z=0;var a=[];var U="";var S;for(S=0;S<X.length;++S){if(S%2===1){Z++;if(Z===R){a.push({value:U,start:0,end:U.length});a.push({start:U.length,end:U.length+X[S].value.length,value:X[S].value});Z=0;U="";continue;}}U+=X[S].value;}a.push({start:0,end:U.length,value:U});return a;};A.regex.matchOnce=function(c,U){var V=U.positions;var b=[];var Q,f;if(V&&V.length){if(V.length===2){if(c.length>=V[1]){Q=V[0];f=V[1];b.push({start:0,end:Q,value:c.substr(0,Q)});b.push({start:Q,end:f,value:c.substr(Q,f-Q)});b.push({start:f,end:c.length,value:c.substr(f)});return b;}return[{start:0,end:c.length,value:c}];}}var a=U.before;var P=U.after;var Y=U.on;var S=U.ignore_between;var e=c;var d=0;var X=0;var W;while(e.length){var Z=e;var R=0;X=d;if(S){W=e.match(S);if(W){Z=Z.substr(0,W.index);d+=W.index+W[0].length;e=e.substr(W.index+W[0].length);}else{e="";}}else{e="";}if(P){W=Z.match(P);if(W){R=W.index+W[0].length;Z=Z.substr(R);}else{continue;}}if(a){W=Z.match(a);if(W){Z=Z.substr(0,W.index);}else{continue;}}W=Z.match(Y);if(W){Q=X+R+W.index;f=Q+W[0].length;b.push({start:0,end:Q,value:c.substr(0,Q)});b.push({start:Q,end:f,value:c.substr(Q,f-Q)});b.push({start:f,end:c.length,value:c.substr(f)});return b;}}return[{start:0,end:c.length,value:c}];};function I(){var P=this.model;var S={success:function(V){if((P.start>=V.total)&&(V.total>0)){var U=Math.ceil((parseInt(V.total,10)/parseInt(P.limit,10)))-1;U=U<0?0:U;P.set("start",U*P.limit);}else{P.populateData(V);}},failure:function(U){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}};var Q={},R={};Q={project:P.projectID,start:P.start,limit:P.limit};R={engine:this.model.engine};this.dataService.getPreviewData(S,Q,R);}function O(P){var Q=this.model;var S={success:function(U){Q.populateColumns(U.columnModel);P&&P();},failure:function(U){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}};var R;R={project:Q.projectID};this.dataService.getColumns(S,R);}function D(){var P=this.model;var R={success:function(S){P.populateHistory(S);},failure:function(S){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,S.message||"");}};var Q={project:P.projectID};this.dataService.getHistory(R,Q);}function C(){var P=this.model;var Q=this;var S={success:function(W){P.populateOperations(W);Q.raiseEvent({name:"RefineStarted"});var X=Q.tableID;var V=mstrApp.getRootController();var U=V.model;var Y=U.importSources[X];if(!Y.inRefine){Y.inRefine=true;Y.RefineOperations=W.entries;}},failure:function(U){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}};var R={project:P.projectID};this.dataService.getOperations(S,R);}function B(S,U){var P=this;var R=this.model;var W={success:function(X){if(!X.processes.length){if(typeof U==="function"){U();}else{P.loadData();}}else{B.call(P,X.processes[0].progress/100);}},failure:function(X){var Y=mstrApp.getRootController();Y.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,X.message||"");}};var V={project:R.projectID};var Q={progress:0};if(S){Q.progress=S;}this.dataService.getProcesses(W,V,Q);}mstrmojo.Refine.RefineController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineController",refinePanel:null,parsePanel:null,records:[],start:function(P){if(!this.dataService){this.dataService=new mstrmojo.Refine.DataService({model:this.model,projectID:this.model.rpid,refineServerURL:P});}this.loadData();this.loadSampleStatus();this.model.attachEventListener("startChange",this.id,this.handleStartChanged);this.model.attachEventListener("columnUnSelected",this.id,this.handleColumnUnSelected);},applyOperations:function J(V,P){var U=this;var S=this.model;var X={success:function(Z){if(Z.code==="ok"){U.loadData();}else{if(Z.code==="pending"){B.call(U);}else{if(Z.code==="error"){U.loadData();var a=mstrApp.getRootController();a.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Z.message||"");}}}},failure:function(Z){var a=mstrApp.getRootController();a.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Z.message||"");}};var Q={project:S.projectID};var W=false,Y=true;if(V.hasOwnProperty("lastDoneID")){for(var R=0;R<S.history.future.length;R++){if(S.history.future[R].op){W=true;}if(V.lastDoneID.toString()===S.history.future[R].id.toString()){Y=false;break;}}}if(P){if(S.hasAddSample()&&W&&!Y){F.confirmFilldownOrBlankdown(function(){U.dataService.undoRedo(X,Q,V);});}else{this.dataService.undoRedo(X,Q,V);}}else{this.dataService.applyOperations(X,Q,V);}},MergeCluster:function H(V,U){var P=this;var Q=this.model;var S={success:function(W){if(W.code==="ok"){P.loadData();U();}else{if(W.code==="pending"){B.call(P);}}},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};var R={project:Q.projectID};this.dataService.massEdit(S,R,V);},handleNonExistColNameError:function(U,R){var Q,S=this.refinePanel.bottomPanal.splitter.facetPanel.facets,P;switch(R){case 1:Q=U.split(":")[1];break;case 2:Q=U.split("No column named ")[1];break;default:return ;}if(Q===undefined){return ;}for(P=0;P<S.length;P++){if(S[P].config.name===Q){S[P].remove();P=-1;}}this.computeFacets(true);},computeFacets:function(P){var R=this;var Q=this.model;var V={success:function(X){if(X.code==="error"){var W=X.message.indexOf("non exist column name in facet")>=0?1:(X.message.indexOf("No column named To ")?2:0);if(W&&!P){R.handleNonExistColNameError(X.message,W);return ;}var Y=mstrApp.getRootController();Y.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,X.message||"");return ;}R.refinePanel.bottomPanal.splitter.facetPanel.handleFacetsFetched(X);R.refinePanel.topPanal.RefineTransformations.transformationList.setItems();I.call(R);},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};var U={engine:this.refinePanel?JSON.stringify(this.refinePanel.bottomPanal.splitter.facetPanel.getJSON(true)):this.model.engine};var S={project:Q.projectID};this.dataService.computeFacets(V,S,U);},computeClusters:function(S){var P=this.model;var R={success:function(U){P.raiseEvent({name:"clustersFetched",clusters:U});P.raiseEvent({name:"columnUnSelected"});},failure:function(U){var V=mstrApp.getRootController();V.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}};var Q={project:P.projectID};this.dataService.computeClusters(R,Q,S);},loadData:function(){var P=this.computeFacets.bind(this);O.call(this,P);D.call(this);C.call(this);},rollBackOperations:function(V){var P=this;var Q=this.model;var S={project:Q.projectID};var R={success:function(){},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};var U={success:function(){P.dataService.applyOperations(R,S,V);},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};Q.start=0;Q.limit=50;this.dataService.undoRedo(U,S,{lastDoneID:0});},addFacets:function(Q,P){this.refinePanel.bottomPanal.splitter.facetPanel.addFacets(Q,P);},getRefinePanel:function G(){this.refinePanel=new mstrmojo.Refine.RefinePanel({controller:this});this.model.attachEventListener("sampleStatusChange",this.refinePanel.id,this.refinePanel.handleSampleStatusChanged);var Z=new mstrmojo.Refine.RefineDataPreview({controller:this});if(this.model.data.rows){Z.populate(this.model.data);}this.model.attachEventListener("dataChange",Z.id,Z.handleDataChanged);this.model.attachEventListener("columnsChange",Z.id,Z.handleColumnsChanged);this.model.attachEventListener("unHighlightSuggestion",Z.id,Z.handleUnHighlightSuggestion);this.model.attachEventListener("startChange",Z.id,Z.handleStartChange);this.model.attachEventListener("columnSelected",Z.id,Z.handleColumnSelected);this.model.attachEventListener("columnUnSelected",Z.id,Z.handleColumnUnSelected);Z.slot="firstSplitNode";Z.alias="refinePreview";this.refinePanel.bottomPanal.splitter.addChildren(Z);var d=new mstrmojo.Refine.RefineSuggestionPreview({controller:this});this.model.attachEventListener("previewSuggestion",d.id,d.handlePreviewSuggestion);this.model.attachEventListener("unPreviewSuggestion",d.id,d.handleUnPreviewSuggestion);this.model.attachEventListener("previewScrollTop",d.id,d.handlePreviewScrollTop);d.slot="firstSplitNode";this.refinePanel.bottomPanal.splitter.addChildren(d);var U=new mstrmojo.Refine.RefineTransformations({controller:this});this.model.attachEventListener("columnsChange",U.id,U.handleColumnsChanged);this.model.attachEventListener("columnSelected",U.id,U.handleColumnSelected);this.model.attachEventListener("columnUnSelected",U.id,U.handleColumnUnSelected);this.refinePanel.topPanal.addChildren([U]);var W=new mstrmojo.Refine.RefineHistoryList({controller:this});W.populate(this.model.history);this.model.attachEventListener("historyChange",W.id,W.handleListChanged);this.refinePanel.topPanal.addChildren([W]);var Y=new mstrmojo.Refine.RefineControlSplit({controller:this,operations:this.model.transformations.split,parentBox:U});Y.slot="controlNode";U.addChildren([Y]);var X=new mstrmojo.Refine.RefineControlWhitespace({controller:this,operations:this.model.transformations.Whitespace,parentBox:U});X.slot="controlNode";U.addChildren([X]);var Q=new mstrmojo.Refine.RefineControlTransformCell({controller:this,operations:this.model.transformations.TransformCell,parentBox:U});Q.slot="controlNode";U.addChildren([Q]);var P=new mstrmojo.Refine.RefineControlDelete({controller:this,operations:this.model.transformations.Delete,parentBox:U});P.slot="controlNode";U.addChildren([P]);var a=new mstrmojo.Refine.RefineControlExtract({controller:this,operations:this.model.transformations.Extract,parentBox:U});a.slot="controlNode";U.addChildren([a]);var R=new mstrmojo.Refine.RefineControlFacet({controller:this,operations:this.model.transformations.Facet,parentBox:U});R.slot="controlNode";U.addChildren([R]);var S=new mstrmojo.Refine.RefineControlFindAndReplace({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:U});S.slot="controlNode";U.addChildren([S]);var c=new mstrmojo.Refine.RefineControlRemoveText({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:U});c.slot="controlNode";U.addChildren([c]);var b=new mstrmojo.Refine.RefineControlOther({controller:this,operations:this.model.transformations.Other,parentBox:U});b.slot="controlNode";this.model.attachEventListener("columnsChange",b.id,b.handleColumnsChanged);this.model.attachEventListener("columnUnSelected",b.id,b.handleColumnUnSelected);U.addChildren([b]);var V=new mstrmojo.Refine.RefineSuggestions({controller:this});V.slot="suggestionsNode";U.addChildren([V]);this.model.attachEventListener("dataChange",V.id,V.handleDataChanged);this.model.attachEventListener("columnsChange",V.id,V.handleColumnsChanged);this.model.attachEventListener("gotSuggestions",V.id,V.handleGotSuggestions);this.model.attachEventListener("emptySuggestions",V.id,V.handleEmptySuggestions);return this.refinePanel;},generateSuggestions:function N(Z,U,e,h,n,Y,R,P){var o=1,l,d,k,f=[];var X,p,Q;while(true){p=U+" "+o;Q=true;for(l=0;l<R.length;l++){if(p===R[l].name){Q=false;break;}}o++;if(Q){X=p;break;}}if(n===0){d=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));d.description=d.description.replace("[column name]",U);d.columnName=U;d.fieldLengths.push(Y);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));k.operations=JSON.stringify([d]);k.startOffset=-1;k.endOffset=Y;k.index=Z;f.push(k);}else{if(h===Y){d=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));d.description=d.description.replace("[column name]",U);d.columnName=U;d.fieldForward=false;d.fieldLengths.push(Y-n);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));k.operations=JSON.stringify([d]);k.startOffset=Y-n;k.endOffset=-1;k.index=Z;f.push(k);}else{d=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));d.description=d.description.replace("[column name]",U);d.columnName=U;d.fieldLengths.push(n);d.fieldLengths.push(Y-n);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));k.operations=JSON.stringify([d]);k.startOffset=n;k.endOffset=Y;k.index=Z;f.push(k);}}var S={text:e,start:n,end:Y,col:Z,cell:P};if(this.records.length===0||S.col===this.records[0].col){if(this.records.length>0){for(l=0;l<this.records.length;l++){if(this.records[l].cell===P){this.records.splice(l,1);}}}this.records.push(S);}else{if(this.records.length!==0){this.resetRecords();}this.records=[S];}P.highlightSelectedText(n,Y);var a,V=A.regex().candidates(this.records);while(this.records.length>0&&V.length===0){this.records[0].cell.resetText();this.records=this.records.slice(1);V=A.regex().candidates(this.records);}for(l=0;l<V.length;l++){a=V[l];if(a.before!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.split.beforeFirst));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.before.toString()));d.columnName=U;d.separator=a.before.source;d.regex=true;d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[1]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.before),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.before;f.push(k);}else{if(a.after!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.split.afterFirst));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.after.toString()));d.columnName=U;d.separator=a.after.source;d.regex=true;d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[2]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.after),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.after;f.push(k);}else{d=JSON.parse(JSON.stringify(this.model.transformations.split.bySeparator));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.on.toString()));d.columnName=U;d.separator=a.on.source;d.regex=true;d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[3]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.on),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.on;f.push(k);}}}for(l=0;l<V.length;l++){a=V[l];if(a.before!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.Extract.beforeFirst));d.description=d.description.replace("[new column name]",X);d.description=d.description.replace("[column name]",U);d.description=d.description.replace("[index]",Z+1);d.description=d.description.replace("####",M(a.before.toString()));d.columnInsertIndex=Z+1;d.newColumnName=d.newColumnName.replace("[column name]",X);d.baseColumnName=d.baseColumnName.replace("[column name]",U);d.expression=d.expression.replace(new RegExp("\\[separator\\]","gm"),a.before);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[0]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.before),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.before;f.push(k);}else{if(a.after!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.Extract.afterFirst));d.description=d.description.replace("[new column name]",X);d.description=d.description.replace("[column name]",U);d.description=d.description.replace("[index]",Z+1);d.description=d.description.replace("####",M(a.after.toString()));d.columnInsertIndex=Z+1;d.newColumnName=d.newColumnName.replace("[column name]",X);d.baseColumnName=d.baseColumnName.replace("[column name]",U);d.expression=d.expression.replace(new RegExp("\\[separator\\]","gm"),a.after);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[1]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.after),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.after;f.push(k);}else{d=JSON.parse(JSON.stringify(this.model.transformations.Extract.on));d.description=d.description.replace("[new column name]",X);d.description=d.description.replace("[column name]",U);d.description=d.description.replace("[index]",Z+1);d.description=d.description.replace("####",M(a.on.toString()));d.columnInsertIndex=Z+1;d.newColumnName=d.newColumnName.replace("[column name]",X);d.baseColumnName=d.baseColumnName.replace("[column name]",U);d.expression=d.expression.replace(new RegExp("\\[separator\\]","gm"),a.on);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[2]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.on),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.on;f.push(k);}}}for(l=0;l<V.length;l++){a=V[l];if(a.before!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutBefore));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.before.toString()));d.columnName=U;d.expression=d.expression.replace(new RegExp("\\[separator\\]","gm"),a.before);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[0]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.before),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.before;f.push(k);}else{if(a.after!==undefined){d=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutAfter));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.after.toString()));d.columnName=U;d.expression=d.expression.replace(new RegExp("\\[separator\\]","gm"),a.after);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[1]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.after),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.after;f.push(k);}else{d=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutOn));d.description=d.description.replace("[column name]",U);d.description=d.description.replace("####",M(a.on.toString()));d.columnName=U;d.expression=d.expression.replace("[separator]",a.on);d.engineConfig=JSON.parse(this.model.engine);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[2]));k.description=k.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(a.on),false,true)+'"');k.operations=JSON.stringify([d]);k.index=Z;k.separator=a.on;f.push(k);}}}d=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsContains));d.engineConfig.facets[0].query=e.substring(n,Y);d.description=d.description.replace("####","'"+M(L(e.substring(n,Y)))+"'");d.description=d.description.replace("[column name]",U);d.engineConfig.facets[0].name=d.engineConfig.facets[0].columnName=U;d.engineConfig.facets[0].mode="text";d.engineConfig.facets=d.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);k=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.deleteRows[0]));k.description=k.description.replace("####","'"+mstrmojo.string.encodeHtmlString(M(L(e.substring(n,Y))),false,true)+"'");k.operations=JSON.stringify([d]);f.push(k);var q=(window.innerWidth||document.documentElement.clientWidth);var g=P.domNode.getBoundingClientRect();var b=g.left;var c=q-g.right;var W=P.preview.domNode.getBoundingClientRect();var m={tableTop:W.top,cellLeft:g.left,cellRight:g.right,distanceToLeft:b,distanceToRight:c};this.model.raiseEvent({name:"gotSuggestions",src:this,list:f,cellPos:m});},generateColumnSuggestions:function E(P,Z,a,V){var U,W,Y=[];var R=this.refinePanel.bottomPanal.splitter.refinePreview;var X=R.data;var S=R.columns;var c=S[P].name;var d=X.rows[0]?X.rows[0].cells[S[P].cellIndex]:null,b="text";if(d){if(d.t){b="date";}else{if(typeof d.v==="string"||d.v instanceof String){b="text";}else{b="number";}}}if(Z){U=JSON.parse(JSON.stringify(this.model.transformations.Other.TransposeColumnsIntoRows));U.description=U.description.replace("####",V);U.description=U.description.replace("@@@@",Z);U.description=U.description.replace("@@@@","Transpose:key");U.description=U.description.replace("@@@@","Transpose:value");U.startColumnName=Z;U.keyColumnName="Transpose:key";U.valueColumnName="Transpose:value";U.columnCount=V;W=JSON.parse(JSON.stringify(this.model.suggestions.column[8]));W.description=W.description.replace("####",Z);W.description=W.description.replace("@@@@",a);W.operations=JSON.stringify([U]);Y.push(W);}U=JSON.parse(JSON.stringify(this.model.transformations.Delete.Colomn));U.description=U.description.replace("[column name]",c);U.columnName=c;W=JSON.parse(JSON.stringify(this.model.suggestions.column[0]));W.operations=JSON.stringify([U]);Y.push(W);U=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.fillDown));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[1]));W.operations=JSON.stringify([U]);Y.push(W);U=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.blankDown));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[2]));W.operations=JSON.stringify([U]);Y.push(W);if(b==="text"){U=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.titlecase));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[3]));W.operations=JSON.stringify([U]);Y.push(W);U=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.uppercase));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[4]));W.operations=JSON.stringify([U]);Y.push(W);U=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.lowercase));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[5]));W.operations=JSON.stringify([U]);Y.push(W);U=JSON.parse(JSON.stringify(this.model.transformations.Whitespace.collapse));U.description=U.description.replace("[column name]",c);U.columnName=c;U.engineConfig=JSON.parse(this.model.engine);W=JSON.parse(JSON.stringify(this.model.suggestions.column[7]));W.operations=JSON.stringify([U]);Y.push(W);}var Q=c;if(c.length>50){Q=c.substring(0,50)+"...";}U=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsBlank));U.description=U.description.replace("[column name]",c);U.engineConfig.facets[0].name=U.engineConfig.facets[0].columnName=c;U.engineConfig.facets=U.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);W=JSON.parse(JSON.stringify(this.model.suggestions.column[6]));W.description=W.description.replace("[column name]",Q);W.operations=JSON.stringify([U]);Y.push(W);this.model.raiseEvent({name:"gotSuggestions",src:this,list:Y});},handleStartChanged:function(){I.call(this);},handleColumnUnSelected:function(){this.resetRecords();},resetRecords:function(){for(var P=0;P<this.records.length;P++){this.records[P].cell.resetText();}this.records=[];},setSampleData:function(Q,W){var S=this,U=mstrApp.getRootController(),P=S.model,V={project:P.projectID},X=W?{row_num:Q,first:true}:{row_num:Q};function R(Y){U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Y.message||"");}S.dataService.setSampleData({success:function(Y){if(Y.code==="error"){S.loadData();R(Y);return ;}P.populateSampleStatus(Y);S.loadData();},failure:R},V,X);},refreshSampleData:function(Q){var S=this,U=mstrApp.getRootController(),P=S.model,V={project:P.projectID};function R(W){U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}S.dataService.refreshSampleData({success:function(W){if(W.code==="error"){S.loadData();R(W);return ;}P.populateSampleStatus(W);S.loadData();},failure:R},V,{row_num:Q});},loadSampleStatus:function(){var R=this,S=mstrApp.getRootController(),P=R.model,U={project:P.projectID};function Q(V){S.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}R.dataService.getSampleStatus({success:function(V){if(V.code==="error"){Q(V);return ;}if(V.hasSample){P.hasUploadData=true;P.populateSampleStatus(V);}else{P.hasUploadData=false;}},failure:Q},U);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.date","mstrmojo.dom","mstrmojo.NumberFormat","mstrmojo.Button","mstrmojo.Serializer","mstrmojo.vi.ui.editors.PromptOptionEditor","mstrmojo.vi.ui.editors.ExportPDFEditor","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.util.NavUtility");var A=mstrmojo.desc,AW=mstrmojo.css,D=mstrmojo.Button.newWebButton,AH=mstrmojo.Serializer,AM=mstrmojo.date,c=mstrmojo.func,S=mstrmojo.hash,Q=mstrmojo.array,u=mstrmojo.dom,AQ=mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep),H="1:Width",l="2:Page",R=44,AF=28,AJ=29,AD=17,x=mstrmojo.vi.util.NavUtility,AA=mstrmojo.vi.enums.EnumFeatures,AB=function(){return mstrmojo.locales.datetime;};function Ab(Ac){x.checkSessionAndSendForm(Ac,null,"post");}function AZ(Ad,Af){var Ac=Ad.model;var Ae={evt:2048001,messageID:Ac.mid,rwb:Ac.bs};if(Af<50||Af===2048){Ae.visMode=0;Ae.currentViewMedia=Af;}else{Ae.visMode=Af;Ae.currentViewMedia=1;}Ab(Ae);}function AX(){var Ad=mstrApp.pathInfo.nb,Ac=mstrmojo.array.find(Ad,"n","Return");return Ac>-1?Ad[Ac].href:null;}function z(Ac){var Ad={};Ad.evt=3198;Ad.src=mstrApp.name+".3124";Ab(Ad);}function AO(Af,Ae,Ah,Ag){var Ad=Af.model,Ac=mstrConfig&&mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||false;Ab({evt:2048030,src:Ad.bp+".2048030",rePrompt:Ae,fresh:Ah,resolveOnly:Ac,regenerate:Ag,rwb:Ad.bs});}function Y(Al,Ad){var Ah=Al.model,Ai=(Ah&&Ah.zt)||0,Ae,Ag,Ac;switch(Ai){case 1:Ae="Width";Ac=H;Ag=A(4809);break;case 2:Ae="Page";Ac=l;Ag=A(4808);break;default:Ae=(Ah&&Ah.getZoomFactor())||1;Ac=Ai+":"+AQ.format(Ae);Ag=parseInt(Ae*100,10)+"%";}var Af=Al.zoomOptions,Aj;if(Af){var Ak=mstrmojo.array.find(Af,"dssid",Ac);if(Ak>-1){Aj=Af[Ak];}}if(!Aj){Aj={n:Ag,dssid:Ac,f:Ae,tp:Ai};}if(Ad===true){Al.view.zoomValue=Aj;}else{Al.view.set("zoomValue",Aj);}}function h(Ai,Al,Ac,Ad,Aj,Af,Ah,Ak){var Ae=Ai.model,Ag=Ae&&Ae.isnew;if(!Ag&&(!Ak||!mstrmojo.resolveFeature("save-analysis")||!(Ai.isDocChanged&&Ai.isDocChanged()))){Aj(Af);return ;}mstrmojo.warn(Ad,{confirmBtn:{t:mstrmojo.desc(118,"Save"),fn:function(){Ai.save(Ah);}},cancelBtn:{t:mstrmojo.desc(2140,"Cancel")}},{title:Al||mstrmojo.desc(11812,"Notification"),help:Ac});}function I(Ad){var Ac=Ad.model;Ac.showDialogBeforeSave=false;Ac.getDataService().setPreference("askBeforeSaveChanges\u001E2",{success:mstrmojo.emptyFn,failure:function(Ae){mstrmojo.alert(Ae.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}var k=-1,AY=3,t=4,AU=7,AP=10,j=18;mstrmojo._DocToolbarActions=mstrmojo.provide("mstrmojo._DocToolbarActions",{_mixinName:"mstrmojo._DocToolbarActions",staticViewMode:function AC(){AZ(this,1);},interactiveViewMode:function Aa(){AZ(this,2);},editableMode:function L(){this.model.updateWidgetsProps();AZ(this,4);},flashViewMode:function J(){AZ(this,8);},IVEMode:function C(){AZ(this,2048);},IVEHelp:function C(){var Ac=mstrmojo.helpPath();window.open(Ac+"Displaying_a_visual_representation_of_your_data__V.htm","_blank");return true;},remainExpressViewMode:function E(){},designViewMode:function O(Ac,Ad){this.model.updateWidgetsProps();Ab({evt:3104,rwDesignMode:1,convertFromVI:(Ad===true)?1:0,messageID:this.model.mid,rwb:this.model.bs,jsonMode:false});},onmodelChange:function f(){Y(this,true);},convertToDoc:function o(Ad){var Ac=this;if(Ac.model.hasMDXRADataset()){mstrmojo.alert(mstrmojo.desc(14692,'The "Convert to Document" option is currently not available for MDX cube with Hierarchical Attributes.'),null,mstrmojo.desc(3610,"MicroStrategy Web"));}else{mstrmojo.warn(mstrmojo.desc(15498,"Converting a dossier to a document cannot be undone. Do you want to convert?"),{confirmBtn:{t:mstrmojo.desc(13654,"Convert"),fn:function(){Ac.designViewMode(undefined,Ad);}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{title:mstrmojo.desc(5180,"Convert to Document")});}},saveAs:function(Ac){this.save();},save:function X(Ad,Ac){if(mstrApp.isSingleTier){FormWrapper.saveas();return ;}this.model.saveAsRW(Ad,Ac);},dSave:function w(Am,Ag,Al){var Aj=this,Ad=Aj.model,Ah=Ad&&Ad.isnew,Af=Ad&&Ad.isRWReadonly,Ae=60,Ai=Ad.n;if(mstrApp.isExpress){this.model.updateWidgetsProps();}if(mstrApp.isSingleTier){if(Al){FormWrapper.savePromptOption((Ad.prompt_option>=0)?Ad.prompt_option+1:3);}else{FormWrapper.save();}return ;}if(Ai.length>Ae){Ai=Ai.substr(0,Ae-1)+"...";}if(Ah||Af){this.save();}else{var An=mstrApp.features["ask-before-save-changes"];if(An){var Ac="dialogBeforeSave",Ak=function(){mstrmojo.all.dialogBeforeSave.destroy();};mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:Ac,title:A(5728),cssClass:"mstrmojo-dta save",btnAlignment:"right",modal:true,visible:true,onClose:Ak,buttons:[D(A(1442),function(){var Ao=mstrmojo.all[Ac];if(Ao.t.ctrlChk.checked){Aj.setDontAskAgain();mstrApp.features["ask-before-save-changes"]=false;}Aj.directSave(Am);Ak();},true),D(A(218),function(){var Ao=mstrmojo.all[Ac];if(Ao.t.ctrlChk.checked){I(Aj);}Aj.save();Ak();}),D(A(2140),Ak)],children:[{scriptClass:"mstrmojo.Table",alias:"t",rows:2,cols:1,children:[{scriptClass:"mstrmojo.Label",text:A(11165,"Are you sure you want to overwrite the existing copy of ##?").replace(/##/,"<b>"+Ai+"</b>"),visible:true,cssClass:"ucalert",slot:"0,0",allowHTML:true},{scriptClass:"mstrmojo.CheckBox",label:A(211),alias:"ctrlChk",visible:true,checked:false,slot:"1,0"}]}]}).render();}else{Aj.directSave(Am);}}},setDontAskAgain:function AI(){var Ad=this,Ac=Ad.model;Ac.showDialogBeforeSave=false;Ac.getDataService().setPreference("askBeforeSaveChanges\u001E0",{success:mstrmojo.emptyFn,failure:function(Ae){mstrmojo.alert(Ae.getResponseHeader("X-MSTR-TaskFailureMsg"));}});},directSave:function W(Aj){Aj=Aj||{};var Ai=this,Ad=Ai.model,Ac=mstrmojo.string.decodeHtmlString(Ad.n),Ag=mstrmojo.emptyFn,Ak=Aj.success||Ag,Af=Aj.failure||Ag,Ae=Aj.complete||Ag,Ah=mstrConfig&&mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||false;mstrApp.showWait({message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress",showCancel:true});mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(Al){var Am=function(){if(!Aj.ignoreOrgSucc){mstrApp.showWait({message:mstrmojo.desc(13781,"Saved Successfully"),cssClass:"save-successful-waitbox",_autoClose:true,timeout:2000});}Ai.cmdMgr.reset();};Ad.lastSavedStid=Ad.getDataService().stid;Ad.dty=false;Ak(Al);if(Al.needToGetResults){Ad.getDataService().retrieveServerJson({},c.wrapMethods(Ad.controller.getRefreshCallback(),{success:Am}),{preserveUndo:true,style:{name:"ServerJsonRWDStyle",params:{treesToRender:3}},params:{styleName:"ServerJsonRWDStyle"}});}else{Am();}},failure:function(Al){var An=Al.getResponseHeader("X-MSTR-TaskErrorCode"),Am=Al.getResponseHeader("X-MSTR-TaskFailureMsg");if(An==="-2147468986"||An==="-2147217126"||An==="-1"||mstrApp.isVI&&An<0&&Am){mstrmojo.alert(Am);}else{if(!Aj.ignoreOrgFail){mstrmojo.alert(A(4107));}}Af(Al);},complete:function(Al){mstrApp.hideWait();Ae(Al);}},{taskId:"saveRW",msgID:(Ad.dataService&&Ad.dataService.msgId)||Ad.mid,folderID:Ad.sfid||Ad.pfid,objName:Ac,objDesc:mstrmojo.string.decodeHtmlString(Ad.dsc),saveAsFlags:(Ad.prompt_option>=0)?Ad.prompt_option+1:3,taskEnv:"xhr",skipRebuild:Ah,taskContentType:"json"});},quickSave:function p(){this.model.saveRW();},browseParent:function m(){var Ac=this.model,Ad={evt:3010};if(!Ac.pfh){Ad.evt=2001;Ad.folderID=Ac.pfid;if(Ac.sysFolder){Ad.systemFolder=Ac.sysFolder;}}Ab(Ad);},close:function e(){z(this);},openPage:function AR(Ad){var Ac=this.model;Ab({evt:3124,src:mstrApp.name+"."+mstrApp.pageName+".3124",relativePageNumber:Ad,messageID:Ac.mid,rwb:Ac.bs});},saveToInbox:function d(){var Ad=this;mstrApp.serverRequest({taskId:"addDocToHistoryList",rwb:Ad.model.bs},{success:function(){var Ae=Ad.model.features;if(Ae){if(Ae.set){Ae.set("enable-add-history-list",false);}else{Ae["enable-add-history-list"]=false;}}mstrmojo.alert(A(8047));},failure:function Ac(Ae){if(Ae&&Ae.message){mstrmojo.alert(Ae.message);}else{mstrmojo.alert(A(15211));}}},{silent:true});},ShowSharingEditor:function AG(Al){var Af="sharingEditor",Ai=mstrmojo.all[Af],Aj=this,Ag=Aj.model,Ah=Ag.isnew,Ak=(Al&&Al.cls)?Al.cls:null,Ae=Ag.getDataService().stid,Ac=function(Am){if(Ai){Ai.set("oi",Am);S.copy({objectName:Ag.n,href:null,initTab:Ak,mid:Ag.mid,isLinkDirty:Ai.lastState!==Ae,lastState:Ae},Ai);}else{Ai=new mstrmojo.SharingEditor({guestModeEnabled:mstrApp.guestModeEnabled,mid:Ag.mid,id:Af,oi:Am,href:null,initTab:Ak,isLinkDirty:true,viewMode:1,lastState:Ae});}Ai.open();},Ad={success:function(Am){Ac(Am.objects[0]);},failure:function(Am){mstrmojo.alert(Am.getResponseHeader("X-MSTR-TaskFailureMsg"));}};if(Ah){mstrmojo.alert(mstrmojo.desc(15513,"You must save this dossier before you can share it."),null,mstrmojo.desc(8101,"Share ..."));}else{Ag.getDataService().getObjectInfo({objectIDs:this.model.oid,objectTypes:55,includeACL:mstrApp.features?!!mstrApp.features["web-use-sharing-editor"]:false},Ad);}},annotationMode:function F(){(mstrmojo.all.annotations||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.Annotations"})).displayAnnotations(this.rootCtrl.view);},createPersonalView:function n(){var Af=this,Ac=Af.model,Ad=Ac&&Ac.isnew;if(Ad){mstrmojo.alert(mstrmojo.desc(15504,"You must save your dossier before continuing."),null,mstrmojo.desc(9173,"Create Personal View"));}else{var Aj=Ac.n,Ae="mstrPVD",Ai={scriptClass:"mstrmojo.PersonalViewSaveAs",id:Ae,objectType:55,objectSubType:14081},Ah=mstrmojo.all[Ae]||mstrmojo.insert(Ai);if(Aj){var Ag=AM.getDateJson(new Date());Aj+=" "+AM.formatDateInfo(Ag,AB().DATEOUTPUTFORMAT)+" "+AM.formatTimeInfo(Ag,AB().TIMEOUTPUTFORMAT);Ah.set("name",Aj);}Ah.msgID=this.model.mid;Ah.open();}},reprompt:function V(){AO(this,true,false,false);},refresh:function q(){AO(this,false,false,false);},rerun:function B(){AO(this,false,true,false);},toggleAutoRefresh:function(Af){var Ae=Af.src,Ad=this.model.controller,Ac=Ad.isAutoRefreshStarted();Ad[(Ac?"stop":"start")+"AutoRefresh"]();Ae.set("iconClass",(Ac?"tbStart":"tbStop")+"AutoRefresh");Ae.domNode.setAttribute("title",Ac?"*Resume Auto Refresh*":"*Pause Auto Refresh*");},popPromptOption:function AK(Af){var Ac=this.model,Ae=new mstrmojo.vi.ui.editors.PromptOptionEditor({optVal:Ac.prompt_option===undefined?2:Ac.prompt_option,onSave:function Ad(){Ac.prompt_option=this.optVal;Af(Ac.prompt_option);}});Ae.open();},docVisualizationModeAJAX:function Z(){AZ(this,51);},docVisualizationModeFlash:function AL(){AZ(this,50);},sendNow:function K(){h(this,mstrmojo.desc(2331,"Send Now"),"Sending_an_analysis_in_an_email.htm",mstrmojo.desc(2513,"You must save the report/document before you can send it."),Ab,{evt:3037,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:2},false);},scheduleHL:function AN(){h(this,A(5017,"Subscribe to History List"),"",A(15504,"You must save your dossier before continuing."),Ab,{evt:3128,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:3},false);},scheduleEmail:function AV(){h(this,A(3282,"Schedule Delivery to E-mail"),"",A(15504,"You must save your dossier before continuing."),Ab,{evt:3036,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:3},false);},zoomValue:null,getRequiredZoomFactor:function AE(Aj){var Ai=this.model,Af=this.view.selected,Ag=(Af&&Af.docLayout)||null,Am=Ag&&(Ag.containerNode||Ag.domNode),Ae=Am&&Am.ownerDocument.documentElement,Ah=(Ai&&Ai.getZoomFactor())||1,Ak=Ah;var Ad=function(An){An-=R;if(Ai.multiLayout){An-=AF;}if(Ai.hasGroupby){An-=AJ;}return An;};var Ac=function(Ap){var An=Am&&Am["offset"+Ap];if(!An){return Ah;}var Ao=Math.max(1,Ae["client"+Ap]);if(Ap==="Height"){Ao=Ad(Ao);}return Math.min(4,Math.max(0.1,Math.floor(Ah*Ao*100/An)/100));};var Al=function(Aq){var An=Am&&Am.offsetHeight;if(An){var Ao=Math.max(1,Ae.clientWidth),Ap=Ad(Math.max(1,Ae.clientHeight));if(An*Aq/Ah>Math.max(1,Ap)){Aq=Math.floor(Aq*(Ao-AD)*100/Ao)/100;}}return Aq;};zf=Ac("Width");if(parseInt(Aj,10)===1){zf=Al(zf);}if(Aj===2){zf=Math.min(zf,Ac("Height"));}return zf;},zoom:function N(Af){var Ad=(Af!==null)?String(Af).split(":"):[],Ai=parseInt(Ad[0],10),Aj=Ad[1],Ac=AQ.parse(Aj),Ae=false;if(isNaN(Ai)||(!Ai&&isNaN(Ac))){return ;}var Ag=this.model;if(Ai===1||Ai===2){Aj=AQ.format(this.getRequiredZoomFactor(Ai));Ae=parseInt(Math.abs((AQ.parse(Aj)-Ag.getZoomFactor())*100),10)>2;}else{Ae=Aj!==AQ.format(Ag.getZoomFactor());}if(Ai!==Ag.zt||Ae){Ag.zoomFactorUpdating=true;var Ak=this;Ag.getDataService().setDocZoom({zoomType:Ai,zoomFactor:Aj,rwb:Ak.model.bs,currLayoutKey:Ag.currlaykey},{success:function(Ao){Ag.zoomFactorUpdating=false;if(Ai!==0){var Aq=Ak.view.children,An;for(An in Aq){var Ap=Aq[An];if(Ap.k===Ak.model.currlaykey){continue;}if(Ap.defn){Ap.defn.loaded=false;}}}Ag.zt=Ao.zt;Ag.replaceLayout(Ao.currlaykey,Ao);Ag.raiseEvent({name:"rebuildLayout"});Y(Ak,false);Ak=null;},failureName:"zoom.set"});}else{if((Ai===1||Ai===2)&&this.view.selected){Ag.zoomFactorUpdating=false;var Ah=this.view.selected.docLayout,Am=Ah&&(Ah.containerNode||Ah.domNode),Al=Am&&Am.style;if(Al){Al.visibility="visible";}}}},syncZoom:function(){var Ac=this.model,Ad=AQ.format(Ac.getZoomFactor());mstrApp.serverRequest({taskId:"setDocZoom",rwb:Ac.bs,styleName:"EmptyStyle",zoomFactor:Ad,zoomType:Ac.zt,layoutKey:Ac.currlaykey},null);},exportCmd:function AS(Ai,Aq,Au,As){Aq=typeof Aq!=="string"?undefined:Aq;if(!window.FormWrapper){var Al=this.model,Ah=this.view,Ac=(parseInt(Ai,10)===k)?3130:3132,Am=Al.exopt,Ap=Al.huc&&Ai===AU,Ak=Am.s&&(Ai===t||Ai===AY)&&!Aq,Ao=false,At=false;if(Ak){if(!!(Al.defn&&Al.defn.layouts&&Al.defn.layouts.length>1)){At=true;}else{var Ag=Ah.selected,Av=Ag&&Ag.gb&&Ag.children[1];Ao=(!Av||Av.areUnitsSetToAll());if(Ao){Ak=false;}}}var Aj=function(){var Ay={evt:Ac,src:mstrApp.name+"."+Ac};if(Ac===3132){Ay.executionMode=Ai;if(Aq!=null){Ay.gridKey=Aq;}if(Au>0){Ay.sliceId=Au;}}if(!Ak){Ay.rwb=Al.bs;}else{var Aw=[[2048062,Al.bp+".2048062","mode",Am.m,"range",Am.r],[]];S.forEach(Ay,function(A0,Az){if(Az==="executionMode"){Aw[1]=Aw[1].concat([Az,A0]);}else{Aw[1].push(A0);}});Ay.evt=1024001;Ay.src=Al.bp+".1024001";Ay.events=AH.serializeValueGroup(Aw);Ay["1024001"]=1;Ay.messageId=Al.mid;}Ay.name=Date.parse(new Date());var Ax=function(){var Az=(!(Am.n)&&Ai===AY&&(u.isIE||u.isIEW3C))?"GET":"POST";x.checkSessionAndSendForm(Ay,null,Az,(Am.n)?"_blank":"mstrExportWindow");};if(!u.isIE||Ai!==AU){Ax();}else{mstrmojo.alert(A(5873),Ax);}};var Af;if(Ak||Ap){Af=function(){var Ax="mojoExOpx9",Aw=function(){mstrmojo.all.mojoExOpx9.destroy();};mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:Ax,title:A(971),cssClass:"mstrmojo-dta export",btnAlignment:"right",onClose:Aw,draggable:false,buttons:[D(A(1442),function(){var Ay=mstrmojo.all[Ax];if(At){Am.r=Ay.ctrlLyt.selectedIndex;}if(!Ao){Am.m=(Ay.ctrlChk.checked)?0:1;}Aw();Aj();},true),D(A(2140),Aw)],children:[{scriptClass:"mstrmojo.Label",cssClass:"ucalert",text:A(7482),visible:Ap},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"exp_opts",cssDisplay:"block",alias:"ctrlLyt",visible:!!At,selectedIndex:Am.r,items:[{n:A(14583),v:0},{n:A(14582),v:1}]},{scriptClass:"mstrmojo.CheckBox",label:A(5165),cssDisplay:"block",alias:"ctrlChk",visible:!mstrApp.isVI&&!Ao&&Ak,checked:(Am.m===0)}]}).render();};}if(Ai===t&&Am.ds["3809"]!==undefined&&!Aq){mstrmojo.confirm(A(3809),{confirmBtn:{fn:Af||Aj,t:A(1442)},cancelBtn:{t:A(2140)}});}else{if(mstrApp.isVI&&As&&Ai==AY){var Ad;if(Aq){Ad=mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings;}var An=function(Ay){var Az={evt:3132,src:mstrApp.name+"."+3132};Az.executionMode=AY;if(Aq){Az.gridKey=Aq;}var Aw=[[2048062,Al.bp+".2048062"],[]];S.forEach(Ay,function(A1,A0){Aw[0].push(A0);Aw[0].push(A1);});S.forEach(Az,function(A1,A0){if(A0==="executionMode"){Aw[1]=Aw[1].concat([A0,A1]);}else{Aw[1].push(A1);}});Az.evt=1024001;Az.src=Al.bp+".1024001";Az.events=AH.serializeValueGroup(Aw);Az["1024001"]=1;if(Al.mid){Az.messageId=Al.mid;}Az.name=Date.parse(new Date());var Ax=function(){x.checkSessionAndSendForm(Az,null,"post",(Al.n)?"_blank":"mstrExportWindow");};if(!u.isIE||Ai!==AU){Ax();}else{mstrmojo.alert(A(5873),Ax);}};var Ae=new mstrmojo.vi.ui.editors.ExportPDFEditor({exOpts:Ad,exportHandler:An,singleVis:!!Aq});Ae.open();}else{if(!As&&Af){Af();}else{Aj();}}}}else{if(Aq!==undefined){var Ar={3:{mode:"2",version:""},4:{mode:"1",version:"4"},10:{mode:"5",version:""}};FormWrapper.doExport(Ar[Ai].mode,Ar[Ai].version,Aq);}}},printPDF:function U(Ac){var Ad=this;if(window.FormWrapper){Ad.exportCmd(AY,Ac,null,true);}else{mstrApp.featureFlagsCache=mstrApp.featureFlagsCache||{};if(mstrApp.featureFlagsCache["EE/NewEEExportOption"]===undefined){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(Ae){mstrmojo.hash.copy(Ae,mstrApp.featureFlagsCache);Ad.exportCmd(AY,Ac,null,Ae["EE/NewEEExportOption"]);}},{taskId:"getNeeFeatureFlags"});}else{Ad.exportCmd(AY,Ac,null,mstrApp.featureFlagsCache["EE/NewEEExportOption"]);}}},exportExcel:function g(Ac){this.exportCmd(t,Ac);},exportCSV:function P(Ac){this.exportCmd(AP,Ac);},exportHTML:function b(){this.exportCmd(k);},exportMSTR:function a(){var Af=this,Ag=Af.isDocChanged&&Af.isDocChanged(),Ad=mstrmojo.resolveFeature(AA.SAVE_ANALYSIS),Ae=Ag?Ad:true,Ac=function Ac(Ah){Af.exportCmd(Ah);};if(Ae){h(this,null,"",A(15504,"You must save your dossier before continuing."),Ac,j,{saveAsOrigin:14},true);}else{mstrmojo.alert(A(12933,"You do not have enough privileges to perform this operation"));}},openHome:function G(Ac){Ab({evt:3010,src:mstrApp.name});},updateZoom:function M(){Y(this,false);},resetSelections:function AT(){var Ae=this,Ad=Ae.model,Ac=!!Ad.hasGroupby;Ad.getDataService().resetSelections(null,Ac,{success:function(Ai){var Al=Ae.view.children,Af=(Al&&Al.length)||0,Am=Ad.getCurrentLayoutKey(),Ah;for(Ah=0;Ah<Af;Ah++){var Aj=Al[Ah];if(Aj.defn&&Aj.defn.loaded&&Am!==Aj.k){Aj.defn.loaded=false;}}if(Ac){Ad.loadLayout(Ai);return ;}if(Ai.pukeys){var Ak=Ad.partialUpdate(Ai.data,Ad.getUnitDefinitions(Ai.pukeys)),Ag=Ad.getLayoutDataCache(Ad.getCurrentLayoutKey());S.forEach(Ak.upd,function(Ap,Ar){var Ao=mstrmojo.all[Ar];if(Ao&&Ao.defn&&Ao.defn.t===mstrmojo.EnumRWUnitType.PANELSTACK){var An=Ag&&Ag[Ar]&&Ag[Ar].data,Aq=An&&An.selKey;if(Aq&&Ao.selectedKey!==Aq){Ao.defn.set("selKey",Aq);}Ao.setDirtyChildren();}});}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.qb.QBHelpers");mstrmojo.requiresDescs(221,1442,10492,12584,12585,12586,12588,12589,12590,12647,13031,13061,13062,13063,13064,13065,13066,13067,13068,13069,13070,13071,13520,13774,14204,14302,14663,15207,15209);var k=mstrmojo.DI.DIConstants,B,O=mstrmojo.array,c=mstrmojo.func,Q=mstrmojo.hash,S=mstrmojo.string,R=mstrmojo.DI.DIHelpers,M=mstrmojo.qb.QBHelpers,G=10,N=60*1000;function Y(){var l=mstrApp.getRootController();var n={success:function(){mstrApp.redirectToPage(mstrmojo.DI.DIExitOptions.getRedirectParams(mstrmojo.DI.DIExitOptions.pageRedirect.historyList,null,l.model.isDirectDataAccess));},failure:function(){l.displayError(mstrmojo.desc(13774,"Your history list is full. Please delete a few messages and try again."),false);l.model.getHistoryList().set("hasSentToHistoryList",false);}};var m={};if(l.model.operationMode===k.operationMode.create){m.name=l.model.cubeName;}if(!l.model.getHistoryList().hasSentToHistoryList){l.model.getHistoryList().set("hasSentToHistoryList",true);l.dataService.sendToHistoryList(n,m);}}function d(){var n=this,m=n.getModel(),q=true,p=m.getAllTableID(),o,l={model:this.model,zIndex:999};if(m.operationMode===k.operationMode.edit&&m.isCubePublished&&m.rawDataExistsInAE){O.forEach(p,function(t){o=m.getImportSource(t);if(o){q=q&&(o.executeAction===k.tableStatsExecutionAction.reserved&&!o.forceRepublish&&!o.hasRefreshedData);}});if(q){l.simpleProgressMode=true;l.showTitle=false;}}return this.showDialog(k.dialogType.publishStatusDialog,l);}function J(){var l=this;var m=l.model;var n={isDirectDataAccess:m.isDirectDataAccess},o={success:function(p){if(p.objectId){m.cubeID=p.objectId;}l.wrapUpDataImport();},failure:function(p){mstrApp.hideProgress();l.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,p&&p.message);}};m.cubeName=L.call(l,true);n.name=m.cubeName;this.dataService.createOneTierDoc(o,n);}function H(){var l=mstrApp.getRootController();var n={op:k.getCubeQuotaAndInfosOptions.GetCubeQuotaAndInfosQuotaOnly};var m=mstrmojo.desc(13410,"Unable to import your data since your remaining in-memory space of #### MB of the allocated @@@@ MB was deemed insufficient to store the result of the operation. Please try freeing some of the used in-memory space.");var o={success:function(t){var q=Math.round(t.cubes.cquota),u=Math.round(t.cubes.cusage);var w=q-u;var p=m.replace("####",w.toString()).replace("@@@@",q.toString());l.displayError(p,false);},failure:function(){m=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");l.displayError(m,false);}};l.dataService.getCubeQuota(o,n);}function h(q){var n;if(this.model.operationMode!==k.operationMode.refresh){this.dialogController.close(k.dialogType.publishStatusDialog);n=this.getModel().getAllTableID();if(n.length>0&&!mstrApp.isSingleTier){this.dataService.editEMMASourceTable(null,{did:this.getModel().getAllTableID()[0]});}}var u=q.code&&parseInt(q.code,10),o=this.getModel(),l,t=false,x=q.message,w,m=[];if(x){w=S.encodeHtmlString(x,true,true);}if(u===undefined||u===null){u=q.cubeStatus&&parseInt(q.cubeStatus,10);}if((u===undefined||u===null)&&q.getResponseHeader){u=parseInt(q.getResponseHeader("X-MSTR-TaskErrorCode"),10);x=q.getResponseHeader("X-MSTR-TaskFailureMsg");w=S.encodeHtmlString(x,true,true);}if(q.cubeStatus<0&&q.tables&&q.tables.length>0){x="";O.forEach(q.tables,function(AC){if(AC.emsg){var AD=AC.tableid;l=AD&&o.getImportSource(AD);var z=S.encodeHtmlString(l.sourceInfo.name,true,true);var AA=S.encodeHtmlString(AC.emsg,true,true);var AB=z+": "+AA;if(l){if(parseInt(AC.errc,10)!==k.backendError.queryEngineGeneralError){x="<li>"+z+"<br>"+AA+"</li>"+x;O.insert(m,0,[AB]);}else{x+="<li>"+z+"<br>"+AA+"</li>";m.push(AB);}}}});x="<ul>"+x+"</ul>";if(R.isWS()){w=m.join("<br>");}else{w=x;}}if(this.model.operationMode===k.operationMode.refresh){t=true;}O.forEach(o.getAllTableID(),function(z){l=o.getImportSource(z);if(l){delete l.status;}});var p=this.getPublishController().getErrorMessage(u,x,w,t,undefined,this.model.operationMode);if(p){this.displayError(p,false);}}function L(n){var m=this.model,l=[];if(m.cubeName&&!n){return m.cubeName;}O.forEach(m.getAllTableID(),function(o){l.push(m.getImportSource(o).sourceInfo.name||"");});return R.generateCubeName(l);}function D(o,m){if(!o){return m;}var n,q=true,p=0,l;for(n=0;n<o.length;n++){if(m===o[n].n){q=false;break;}}if(q){return m;}m=m+"_"+p;p++;n++;while(n<o.length&&m===o[n].n){l=m.lastIndexOf("_");m=m.substring(0,l)+"_"+p;p++;n++;}return m;}function X(){var m=mstrApp.getRootController();var n=m.model;var l="<ts>";mstrmojo.hash.forEach(n.importSources,function(o){if(n.operationMode===k.operationMode.edit){if(o.executeAction===k.tableStatsExecutionAction.reserved){l+='<tb did="'+o.tableID+'" ac="4"/>';}else{l+='<tb did="'+o.tableID+'" ac="'+o.executeAction+'"/>';}}else{if(o.refreshType===k.cubeRefreshType.preserve){l+='<tb did="'+o.tableID+'" ac="4"/>';}else{if(o.republishError){l+='<tb did="'+o.tableID+'" ac="4"/>';}else{l+='<tb did="'+o.tableID+'" ac="1"/>';}}}});l+="</ts>";return l;}function C(){var p=k.requestFlag.mapping|k.requestFlag.sourceInfo;var n=this;var l=n.model;var o={previewflag:p,poll:false};var q={success:function(m){l.populateEMMA(m,p);var t=l.getAllMissingColumns();if(t&&t.length>0){n.showDialog(k.dialogType.missingColumnsDialog,{mappings:t});}else{n.publishController.refreshCubeWithoutSave();}},failure:function(){mstrApp.hideProgress();}};this.dataService.getImportedData(q,o);}function P(){var l=this;var n=this.model;var o=n.operationMode;var q={extParams:"<result_flags_3>2048</result_flags_3>",isAsync:true,shouldRemoveFromHL:(!n.isManagedCube&&!n.analysisID)};var p=0;var m=d.call(l);var t={success:function(AB){var z,AC=[],AA=true,w=false,x=false,AD=false,AE,u;if(AB.tables){for(z=0;z<AB.tables.length;z++){AE=AB.tables[z];if(n.importSources[AE.tableid]){u=n.importSources[AE.tableid].sourceInfo.name;if(AE.status!=="3"&&AE.status!=="4"&&AE.status!=="6"){AA=false;}if(AE.status==="4"||AE.status==="6"){AD=true;if(parseInt(AE.errc,10)===k.backendError.missingColumn){x=true;}n.importSources[AE.tableid].republishError={errorMsg:AE.emsg,errorCode:AE.errc};}AC.push({n:u,complete:(AE.status==="3"),errorMsg:AE.emsg||"",errorCode:AE.errc||""});}}if(AB.cubeStatus===k.backendError.dataDiscoveryError){if(AA===false){w=true;}AA=true;}else{if(AB.cubeStatus===k.backendError.columnCountMatchError){AA=true;}else{if(AB.cubeStatus!==1){AA=false;}}}if(AB.cubeStatus<0){AA=true;AD=true;}if(m&&m.model){mstrmojo.array.forEach(AB.tables,function(AG){var AF=m.model.importSources[AG.tableid];if(AF){AF.status=AG.status;AF.errmsg=AG.emsg||"";}});m.model.raiseEvent({name:"PublishStatusUpdate",completed:AA,error:AD});}}else{if(AB.cubeStatus<0){AA=true;AD=true;}if(m&&m.model&&AB.cubeStatus===1){mstrmojo.hash.forEach(m.model.importSources,function(AF){if(AF.status!==3||AF.status!==4||AF.status!==6){AF.status=3;AF.errmsg="";}});m.model.raiseEvent({name:"PublishStatusUpdate",completed:AA,error:AD});}}if(AA){if((o===k.operationMode.create||o===k.operationMode.edit)&&AB.cubeStatus>=0){l.wrapUpDataImport();}else{if(x){C.call(l);}else{if(AB.cubeStatus===k.backendError.dataDiscoveryError&&w){AB.code=AB.cubeStatus;h.call(l,AB);}else{if(AB.cubeStatus<0){AB.code=AB.cubeStatus;h.call(l,AB);}else{if(n.analysisID){l.dataService.duplicateReportInstance({failure:function(){mstrApp.hideProgress();l.displayError(mstrmojo.desc(13066,"Error in refreshing the dataset."),false);}},{messageID:n.analysisID,datasetID:n.cubeID,duplicateRIMsgID:l.dataService.messageID});}else{if(mstrApp.isSingleTier){l.dataService.duplicateReportInstance({failure:function(){mstrApp.hideProgress();l.displayError(mstrmojo.desc(13066,"Error in refreshing the dataset."),false);}},{messageID:"",datasetID:n.cubeID,duplicateRIMsgID:l.dataService.messageID},{showProgress:false});}}}}}}}else{window.setTimeout(function(){l.dataService.pollEmmaStatus(t,q);},500);}},failure:function(u){if(parseInt(u.code,10)===k.backendError.requestTimeout&&p<G){window.setTimeout(function(){l.dataService.pollEmmaStatus(t,q);},N);p++;}else{h.call(l,u);}}};this.dataService.pollEmmaStatus(t,q);}function b(w){var p=this.model,u=this.dataService,t=p.getAllTableID(),q=[],o,n=[],l={complete:function(){if(w&&w.success){w.success();}if(w&&w.complete){w.complete();}}};O.forEach(t,function(m){o=p.getImportSource(m).tablePosition;if(o){if(o.hasOwnProperty("x")||o.hasOwnProperty("y")||o.hasOwnProperty("w")||o.hasOwnProperty("h")){q.push(m);}}});if(q.length===0){l.complete();}O.forEach(q,function(z){var x=p.getImportSource(z).tablePosition,m={did:z};if(x.hasOwnProperty("x")){m.fl=x.x===0?1:x.x;}if(x.hasOwnProperty("y")){m.ft=x.y===0?1:x.y;}if(x.hasOwnProperty("w")){m.fw=x.w;}if(x.hasOwnProperty("h")){m.fh=x.h;}n.push(m);});if(n.length>0){u.editEMMASourceTable(l,{commands:JSON.stringify(n),isBatched:true});}}function I(t){var l=this.model,q={},p=l.getAllTableID(),n=null,o;if(l.isManagedCube||mstrApp.isSingleTier){l.cubeName=L.call(this,true);}if(l.isDirectDataAccess&&l.isManagedCube){this.wrapUpDataImport();return ;}q.displayMode=12;q.saveAsFlags=0;q.extParams=X.call();q.saveAsFlags=k.saveAsFlags.saveAsOverWrite;if(l.isDirectDataAccess){q.shouldRefresh=false;q.saveAsFlags=q.saveAsFlags|k.saveAsFlags.saveAsDDA;n={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(5720,"Waiting...")};}else{q.saveAsFlags=q.saveAsFlags|k.saveAsFlags.saveAsInMemory;}if(l.isManagedCube){q.shouldSave=false;}else{q.saveAsFlags|=k.saveAsFlags.saveAsWithAnswers|k.saveAsFlags.saveAsWithPrompts;}q.folderID=l.folderID;q.objName=l.cubeName;if(l.cubeDesc!==null&&l.cubeDesc!==undefined){q.objDesc=l.cubeDesc;}if(mstrApp.isSingleTier&&!l.isManagedCube&&l.operationMode===k.operationMode.create){q.persist=1;}this.dataService.saveAndPublishEMMA(t,q,null,n);O.forEach(p,function(m){o=l.getImportSource(m);if(o){o.status="0";}});l.raiseEvent({name:"PublishStatusUpdate"});}function a(q,w){var p=this,o=p.getModel(),u=o.getAllTableID(),t=o.operationMode,n=[];var l={success:function(){w.success();},failure:function(m){p.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,m.message);q.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});}};O.forEach(u,function(z){var x=o.getImportSource(z),m;if(!x){return ;}if(t===k.operationMode.edit){if(x.executeAction===k.tableStatsExecutionAction.reserved){m={did:z,exef:k.tableStatsExecutionAction.ignore};}else{m={did:z,exef:x.executeAction};}}else{if(x.refreshType===k.cubeRefreshType.preserve){m={did:z,exef:k.tableStatsExecutionAction.ignore};}else{if(x.republishError){m={did:z,exef:k.tableStatsExecutionAction.ignore};}else{m={did:z,exef:k.tableStatsExecutionAction.forceExecution};}}}n.push(m);});if(n.length>0){p.dataService.editEMMASourceTable(l,{commands:JSON.stringify(n),isBatched:true});}else{w.success();}}function W(t){var m=this,n=m.getModel(),o=n.operationMode,q={},p=[];var l={success:function(w){var u=R.parseValidateSourceResults(w),x=u.isValidate;var z=w&&w.vts;O.forEach(z,function(AB){if(AB.dbRole){var AC=n.getImportSource(AB.tbid);AC.dbRole=AB.dbRole;}});var AA=!x||n.isDirectDataAccess!==n.origIsDirectDataAccess;if(o===k.operationMode.refresh&&AA&&n.writable===0&&n.isManagedCube===false){m.displayError(mstrmojo.desc(12647,"You do not have the permission to modify this object."),false);n.raiseEvent({name:"PublishStatusUpdate",error:true});return ;}if(x){if(t.success){t.success(u);}}else{if(t.failure){t.failure(u);}}if(t.complete){t.complete();}},failure:function(u){m.displayError(mstrmojo.desc(14302,"We encountered some errors while republishing the cube."),false,u.message);m.cancelRepublishError({errorTableTbids:p});}};O.forEach(n.getAllTableID(),function(u){var w=n.getImportSource(u);if(o===k.operationMode.refresh){if(w.refreshType!==k.cubeRefreshType.preserve){p.push(u);}}if(o===k.operationMode.edit){if(w.forceRepublish&&!w.hasRefreshedData){p.push(u);}}});if(p.length>0){q.tbid=p.join();m.dataService.validateSource(l,q);}else{if(t.success){t.success();}if(t.complete){t.complete();}}}function U(AE){var x=this,w=this.model,q=w.operationMode,t=w.cubeID,AA=this.showDialog(k.dialogType.publishStatusDialog,{model:this.model,zIndex:999});var u=[],l=false,m=true,p=false;var z={success:function(AF){a.call(x,AA,{success:function(){if(q===k.operationMode.refresh&&AF&&AF.isValidate&&u.length===0&&w.isDirectDataAccess===w.origIsDirectDataAccess){x.getPublishController().refreshCubeWithoutSave();}else{I.call(x,AE);}}});},failure:function(AF){x.showDialog(k.dialogType.missingColumnsDialog,{results:AF});}};if(q===k.operationMode.edit){l=true;m=true;}mstrmojo.hash.forEach(w.importSources,function(AF){if(q===k.operationMode.refresh){AF.published=false;if(!AF.checked){if(AF.refreshType!==k.cubeRefreshType.preserve){AF.refreshType=k.cubeRefreshType.preserve;}m=false;}else{if(AF.checked){AF.published=true;if(AF.refreshType===k.cubeRefreshType.preserve){if(AF.origRefreshType!==k.cubeRefreshType.preserve){AF.refreshType=AF.origRefreshType;}else{AF.refreshType=k.cubeRefreshType.replaceTable;}}l=true;if(AF.xdaType===k.xdaType.excel||AF.xdaType===k.xdaType.text){if(AF.sourceInfo.url===""&&!AF.hasSelectFile){m=false;AF.refreshType=k.cubeRefreshType.preserve;p=true;}}}}if(AF.checked&&AF.refreshType!==AF.origRefreshType){u.push({did:AF.tableID,tp:AF.refreshType});}}if(q===k.operationMode.edit){if(!x.model.isCubePublished||!x.model.rawDataExistsInAE){if(AF.xdaType===k.xdaType.excel||AF.xdaType===k.xdaType.text){if(AF.sourceInfo.url===""&&!AF.hasSelectFile&&!AF.hasRefreshedData){p=true;}}if(AF.tableState!==k.tableStates.newly){u.push({did:AF.tableID,tp:k.cubeRefreshType.replaceTable});AF.executeAction=k.tableStatsExecutionAction.forceExecution;}}else{if(AF.forceRepublish){if(AF.schemaChanged){AF.refreshType=k.cubeRefreshType.replaceTable;}if(AF.refreshType!==AF.origRefreshType){u.push({did:AF.tableID,tp:AF.refreshType});}if(!AF.hasRefreshedData){if(AF.xdaType===k.xdaType.excel||AF.xdaType===k.xdaType.text){if(AF.sourceInfo.url===""&&!AF.hasSelectFile){m=false;AF.refreshType=k.cubeRefreshType.preserve;p=true;}}}}else{if(AF.tableState!==k.tableStates.newly){if(AF.hasRefreshedData){if(AF.refreshType!==AF.origRefreshType){u.push({did:AF.tableID,tp:AF.refreshType});AF.executeAction=k.tableStatsExecutionAction.forceExecution;}}if(AF.executeAction===k.tableStatsExecutionAction.forceExecution&&!AF.hasRefreshedData){AF.refreshType=k.cubeRefreshType.replaceTable;if(AF.refreshType!==AF.origRefreshType){u.push({did:AF.tableID,tp:k.cubeRefreshType.replaceTable});}if(AF.xdaType===k.xdaType.excel||AF.xdaType===k.xdaType.text){if(AF.sourceInfo.url===""&&!AF.hasSelectFile){m=false;AF.refreshType=k.cubeRefreshType.preserve;p=true;}}}}}}}});if(l===false){x.displayError(mstrmojo.desc(13067,"Please select at least one table to publish."),false);AA.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}if(p){x.displayError(mstrmojo.desc(13068,"You have not uploaded the files for some of the tables. We could not find the data for them. Please upload them before you proceed."),false);AA.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}if(q===k.operationMode.refresh){if(!x.model.isCubePublished||!x.model.rawDataExistsInAE){if(!m){x.displayError(mstrmojo.desc(13068,"You have not uploaded the files for some of the tables. We could not find the data for them. Please upload them before you proceed."),false);AA.model.raiseEvent({name:"PublishStatusUpdate",reset:true});return ;}}}AA.model.raiseEvent({name:"PublishStatusUpdate",completed:false});var o=[];mstrmojo.hash.forEach(w.importSources,function(AF){if(AF.checked&&AF.hasSelectFile&&q===k.operationMode.refresh){o.push(AF.tableID);}if(AF.hasSelectFile&&q===k.operationMode.edit){o.push(AF.tableID);}});function AB(){var AF=-1,AG,AH;x=mstrApp.getRootController();var AI={success:function(){AF++;if(AF>=o.length){mstrApp.hideProgress();AA.toggleEnable(false);if(q===k.operationMode.refresh||q===k.operationMode.edit){W.call(x,z);}else{z.success();}}else{AG=x.model.importSources[o[AF]];AH={type:AG.subtype,tableID:AG.tableID,newRI:false,msgid:mstrApp.getRootController().dataService.messageID};if(AG.subtype===k.sourceSubtype.clipboard){AH.datasource=AG.fileUploader.ws.getData();if(!AH.datasource){AH.datasource=AG.fileUploader._data;}AH.dict=k.backendSourceSubtype.clipboard;}else{AH.datasource=AG.files[0];AH.dict=k.backendSourceSubtype.localFile;}AH.operationMode=x.model.operationMode;x.dataService.oneTierImportFile(AI,AH);}},failure:function(AJ){x.displayError(mstrmojo.desc(14663,"Unable to upload the files selected.")+AJ.message);AA.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});x.cancelRepublishError({errorTableTbids:[o[AF]]});},complete:function(){mstrApp.hideProgress();}};if(o.length>0){mstrApp.showProgress();}AI.success();}function AD(){var AI=0,AP,AK,AF,AM,AN,AQ,AL,AG,AH,AJ,AO;var AR={success:function(){AI++;if(AI>=o.length){mstrApp.hideProgress();AA.toggleEnable(false);if(q===k.operationMode.refresh||q===k.operationMode.edit){W.call(x,z);}else{z.success();}}else{AP=o[AI];AK=AA.getFileUploader(AP);AL={msgID:x.dataService.messageID,tableID:AP};if(t){AL.reportid=t;}x.dataService.importFile(AK,AR,AL);}},failure:function(AS){var AU=AF&&AF.dbTableName;var AT=x.getImportController().handleImportError(AS,AU);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,AT);x.getImportController().handleImportError(AS);AA.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});x.cancelRepublishError({errorTableTbids:[o[AI]]});},complete:function(){mstrApp.hideProgress();}};if(o.length>0){AN=true;AO=[];AJ=["<ul>"];for(AM=0;AM<o.length;AM++){AP=o[AM];AK=AA.getFileUploader(AP);AF=w.getImportSource(AP);AG=AK.getFileName?AK.getFileName():AF.name;if(AK.getFileSize){if(AK.getFileSize()>(mstrApp.diParams.UploadSizeLimit*1024*1024)){AQ=AK.value.substring(AK.value.lastIndexOf(".")+1);AO.push(AF.tableID);AH=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",AQ).replace("@@@@",mstrApp.diParams.UploadSizeLimit);AJ.push("<li>");AJ.push(AG+"<br>"+AH);AJ.push("</li>");}else{if(AK.getFileSize()<=0){AO.push(AF.tableID);AH=mstrmojo.desc(12510,"The import process cannot proceed with an empty file.");AJ.push("<li>");AJ.push(AG+"<br>"+AH);AJ.push("</li>");}}}}AJ.push("</ul>");if(AO.length>0){x.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,AJ.join(""));x.cancelRepublishError({errorTableTbids:AO});return ;}mstrApp.showProgress();AP=o[0];AK=AA.getFileUploader(AP);AL={fileName:AK.getFileName?AK.getFileName():AF.name,msgID:x.dataService.messageID,tableID:AP};if(t){AL.reportid=t;}x.dataService.importFile(AK,AR,AL);}else{AR.success();}}var n=0;var AC={success:function(){n++;if(n>=u.length){if(mstrApp.isSingleTier){AB();}else{AD();}}},failure:function(AF){x.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,AF.message);AA.model.raiseEvent({name:"PublishStatusUpdate",hasError:true});}};if(u.length>0){mstrmojo.array.forEach(u,function(AF){x.dataService.editEMMASourceTable(AC,AF);});}else{AC.success();}}function g(x,u){var l=this.model;var n={},o={},t=this;n.displayMode=12;n.extParams=X.call();if(l.isDirectDataAccess){n.shouldRefresh=false;n.saveAsFlags=k.saveAsFlags.saveAsDDA|k.saveAsFlags.saveAsOverWrite;}else{n.saveAsFlags=k.saveAsFlags.saveAsInMemory|k.saveAsFlags.saveAsOverWrite;}if(!u){if(R.isServerBasedWS()){o.taskId="openNativeWindow";o.windowType=3;var q={success:function(m){if(m&&m.fileName){l.folderID=m.folderID;n.folderID=m.folderID;n.objName=m.fileName;n.objDesc="";l.path=m.filePath+"\\"+m.fileName;t.dataService.saveAndPublishEMMA(x,n,null,{showProgress:true});}}};mstrApp.serverRequest(o,q,{});}else{B=this.showDialog(k.dialogType.saveAsDialog,{saveAsCallback:function(){return x;},name:l.cubeName,desc:"",saveParams:{},retainPrevFolder:true,rootFolderID:mstrApp.cubeSaveFolderId});this.dataService.saveAndPublishEMMA(x,n,B);}}else{n=Q.copy({taskId:"saveAndPublishCube",msgID:this.dataService.messageID},n);n=Q.copy(u,n);delete n.objPath;this.dataService.saveAndPublishEMMA(x,n,null,{showProgress:l.isDirectDataAccess});var p,w=l.importSources;for(p in w){w[p].status="0";}l.cubeName=u.objName||"";l.raiseEvent({name:"PublishStatusUpdate"});if(!l.isDirectDataAccess){this.showDialog(k.dialogType.publishStatusDialog,{model:l,zIndex:999});}}}function Z(p){var n=this;var l=this.model;var o=L.call(n);var q={folderID:l.folderID,searchPattern:o};var t={success:function(m){l.cubeName=D(m.items,o);if(l.isManagedCube===false){g.call(n,p);}else{U.call(n,p);}},failure:function(){n.displayError(mstrmojo.desc(13070,"Unable to fetch the content of cube folder."),false);}};this.dataService.fetchFolderContents(t,q);}function E(w){var q=this,o=this.model,x=o.getAllTableID(),t=[],l,u;var p={success:function(){mstrmojo.array.forEach(t,function(m){q.model.resetImportSource(m);q.navigationController.deleteRoute(m);});}};mstrmojo.array.forEach(x,function(m){l=o.getImportSource(m);if(l){u=l.getCurrentMappings(function(z){return z.selected;});if(!u||u.length<=0){t.push(m);}}});if(t.length){var n=mstrmojo.desc(14204,"Do you want to continue with empty tables? Continue will remove these empty tables:")+"<br><ul>";O.forEach(t,function(m){n+="<li>"+mstrmojo.string.encodeHtmlString(o.getImportSource(m).sourceInfo.name)+"</li>";});n+="</ul>";mstrmojo.confirm(n,{confirmBtn:{fn:function(){q.dataService.removeEMMASourceTable(mstrmojo.func.wrapMethods(p,w),{did:t.join()});return true;}},cancelBtn:{fn:function(){return true;}}},{zIndex:q.getDialogController().getNextZIndex(),allowHTML:true});}else{if(w.success){w.success();}if(w.complete){w.complete();}}}var f={success:function(o){var l=mstrApp.getRootController(),n=l.getModel(),m=mstrApp.saveCubeParams;if(o.objectId){n.cubeID=o.objectId;}if(m){n.path=m.objPath;delete mstrApp.saveCubeParams;}else{if(B){n.path=B.getObjectPath();}}if(n.isDirectDataAccess){l.wrapUpDataImport();}else{P.call(l);}},failure:function(l){h.call(mstrApp.getRootController(),l);}};function V(w){var p=this,o=p.getModel(),l=o.operationMode,q,t,x=false,n={shouldRefresh:false,displayMode:12,saveAsFlags:k.saveAsFlags.saveAsOverWrite},m={success:function(AA){o.set("isManagedCube",x);p.rootView.showFooter({managedCheckbox:{enabled:false}});if(AA&&AA.objectId){o.cubeID=AA.objectId;}if(t){o.path=t.getObjectPath();o.folderID=t.folderID;o.cubeName=t.name||"";o.cubeDesc=t.desc||"";}}};function z(){if(o.isManagedCube){return ;}if(o.isDirectDataAccess){n.saveAsFlags|=k.saveAsFlags.saveAsDDA;}else{n.saveAsFlags|=k.saveAsFlags.saveAsInMemory;}p.dataService.saveAndPublishEMMA(c.wrapMethods(m,w,{}),n,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(10492,"Saving...")});}function u(){p.dataService.clearRelationship({success:function(){z();},failure:function(){z();}});}if(o.cubeID&&o.cubeName&&!(o.isManagedCube&&!o.cubePersisted)&&!(!o.folderID&&l===k.operationMode.create)){if(!o.folderID&&o.cubeID){p.dataService.getObjectFolder({success:function(AA){if(AA&&AA.items&&AA.items.length===1){o.folderID=AA.items[0].fid;if(!o.isManagedCube&&!o.path){p.dataService.fetchFolderContents({success:function(AC){var AD="",AB="";if(AC&&AC.sc&&AC.sc.length>1){AD=AC.sc[0].did;AB=AC.sc[1].did;}p.dataService.getObjectFolder({success:function(AE){if(AE&&AE.items&&AE.items.length===1){o.path=AE.items[0].path;n.folderID=o.folderID;n.objName=o.cubeName;if(o.cubeDesc!==null&&o.cubeDesc!==undefined){n.objDesc=o.cubeDesc;}u();}},failure:function(AE){p.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AE.message);}},{dids:o.cubeID,types:3,sharedFolderId:AD,myReportsId:AB});},failure:function(AB){p.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AB.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{n.folderID=o.folderID;n.objName=o.cubeName;if(o.cubeDesc!==null&&o.cubeDesc!==undefined){n.objDesc=o.cubeDesc;}u();}}},failure:function(AA){p.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AA.message);}},{dids:o.cubeID,types:3});}else{if(!o.isManagedCube&&!o.path&&o.cubeID&&o.folderID){p.dataService.fetchFolderContents({success:function(AB){var AC="",AA="";if(AB&&AB.sc&&AB.sc.length>1){AC=AB.sc[0].did;AA=AB.sc[1].did;}p.dataService.getObjectFolder({success:function(AD){if(AD&&AD.items&&AD.items.length===1){o.path=AD.items[0].path;n.folderID=o.folderID;n.objName=o.cubeName;if(o.cubeDesc!==null&&o.cubeDesc!==undefined){n.objDesc=o.cubeDesc;}u();}},failure:function(AD){p.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AD.message);}},{dids:o.cubeID,types:3,sharedFolderId:AC,myReportsId:AA});},failure:function(AA){p.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AA.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{n.folderID=o.folderID;n.objName=o.cubeName;if(o.cubeDesc!==null&&o.cubeDesc!==undefined){n.objDesc=o.cubeDesc;}u();}}}else{if(R.isServerBasedWS()){u();}else{q={saveAsCallback:function(){return w;},saveCube:function(){n.folderID=this.folderID;n.objDesc=this.desc||"";n.objName=this.name||"";u();this.close();},name:L.call(p),desc:"",saveParams:n,retainPrevFolder:true,rootFolderID:mstrApp.cubeSaveFolderId};t=p.showDialog(k.dialogType.saveAsDialog,q);}}}mstrmojo.DI.controller.DIPublishController=mstrmojo.declare(mstrmojo.Obj,null,{hasPublishStarted:false,handleMissingColumns:function j(q){var p=mstrApp.getRootController();var t=this;var o=p.model;var n={skipTables:q};var x=[],u=[],l=0;mstrmojo.hash.forEach(o.importSources,function(z){if(z.getMissingColumns().length>0){if(!z.areAllColumnsMissing()){x.push(z.tableID);}else{u.push(z.tableID);}}});n.tableIds=x;var w={success:function(){t.refreshCubeWithoutSave();},failure:function(z){h.call(p,z);}};var m={success:function(){l++;if(l>=u.length){if(x.length>0){p.dataService.handleMissingColumns(w,n);}else{t.refreshCubeWithoutSave();}}}};if(u.length>0){O.forEach(u,function(z){o.getImportSource(z).refreshType=k.cubeRefreshType.preserve;p.dataService.editEMMASourceTable(m,{did:z,tp:k.cubeRefreshType.preserve});});}else{if(x.length>0){p.dataService.handleMissingColumns(w,n);}else{t.refreshCubeWithoutSave();}}},getErrorMessage:function(w,AA,AF,t,u,l){var AG,o=mstrApp.getRootController&&mstrApp.getRootController();switch(w){case k.backendError.unexpectedDataType:var AJ=AA.indexOf("#");var AC=AA.indexOf("#",AJ+1);var AI=AA.substring(AJ,AC);AJ=AI.indexOf("[");AC=AI.indexOf("]",AJ+1);AI=AI.substring(AJ+1,AC);var AD=[];AD=AI.split(",");var AB=[];var p=AD.length;var AE,z;for(AE=0;AE<p;AE++){z=AD[AE].split("=");AB.push(z[1]);}AG=mstrmojo.desc(13063,"Error converting the data type of the cell in row ## and column @@ with the value **.").replace("##",AB[0]).replace("@@",(AB[1]+1)).replace("**",AB[2]);break;case k.backendError.cubeQuotaExceeded:case k.backendError.notEnoughSpace:if(u&&l!==k.operationMode.refresh){AG=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");}else{H.call();}break;case k.backendError.noExternalSession:AG=mstrmojo.desc(12585,"The external session has expired.");break;case k.backendError.overwriteObject:AG=mstrmojo.desc(12586,"You are trying to overwrite an object which is not allowed");break;case k.backendError.noPermission:AG=mstrmojo.desc(12647,"You do not have the permission to modify this object");break;case k.backendError.invalidObjectName:AG=mstrmojo.desc(12588,"The name of the cube being saved in invalid. Please give a valid name.");break;case k.backendError.incrementalRefresh:AG=mstrmojo.desc(12589,"Incremental refresh of cube failed because the set of attributes is not the same as before.");break;case k.backendError.objectNameTooLong:AG=mstrmojo.desc(12590,"Name of at least one column header exceeds the limit of 250 characters. Please shorten the column name and try again.");break;case k.backendError.memoryGovernSizeExceeded:var AH="";if(AA.indexOf("Max memory size limit: ")>-1){var n=AA.indexOf("Max memory size limit: ")+23;var m=AA.indexOf(".",n);AH="("+AA.substring(n,m)+") ";}var q=mstrmojo.desc(13064,"Memory consumption limit during data fetching ## is exceeded.").replace("##",AH);if(!u||l===k.operationMode.refresh){o.displayError(q);}else{AG=q;}break;case k.backendError.reportTimeout:AG=mstrmojo.desc(13520,"The job execution time limit set in MicroStrategy Intelligence Server has been exceeded.");break;default:if(t){if(R.isWS()){o.displayError(null,false,AF,function(){o.getDialogController().close(k.dialogType.publishStatusDialog);},mstrmojo.desc(15209,"Refresh Dataset"),mstrmojo.desc(15207,"This dataset can not be refreshed."));}else{o.displayError(mstrmojo.desc(13065,"Unable to publish the cube."),false,AF,function(){o.getDialogController().close(k.dialogType.publishStatusDialog);});}}else{if(R.isWS()){o.displayError(null,false,AF,null,mstrmojo.desc(15209,"Refresh Dataset"),mstrmojo.desc(15207,"This dataset cannot be refreshed."));}else{if(!u||l===k.operationMode.refresh){o.displayError(mstrmojo.desc(13065,"Unable to publish the cube."),false,AF);}}}break;}return AG;},saveAndPublish:function e(){var m=mstrApp.getRootController(),o=m.model,q=o.isDirectDataAccess,l=o.origIsDirectDataAccess,p,t=m.getDDAController();this.hasPublishStarted=true;if(o.operationMode===k.operationMode.refresh){o.set("origIsDirectDataAccess",o.isDirectDataAccess);}if(t.shouldSupportDDA()){t.confirmDDA=false;o.set("isDirectDataAccess",true);}else{if(o.operationMode===k.operationMode.refresh){o.set("isDirectDataAccess",false);}}if(t.confirmDDA&&o.operationMode!==k.operationMode.refresh){p=t.canSupportDDA();if(!l&&p){var n={selectedIndex:q?0:1};m.showDialog(k.dialogType.ddaConfirmDialog,n);return ;}if(q&&!p){o.set("isDirectDataAccess",false);}}this.saveAndPublishNoConfirm();},saveAndPublishNoConfirm:function A(){var q=mstrApp.getRootController(),p=q.model,o=k.requestFlag.sourceInfo|k.requestFlag.mapping,m=k.browseFlag.dataPreview|k.browseFlag.publish,t;var u=function u(){if(p.operationMode===k.operationMode.edit){if(p.isDirectDataAccess){I.call(q,f);}else{q.dataService.getImportedData({success:function(x){p.populateEMMA(x,o,null,true);t=d.call(q);if(t.simpleProgressMode){a.call(q,t,{success:function(){I.call(q,f);}});}else{if(t.checkCanRefresh()&&!t.checkCanChange()){t.okButton.onclick();}}},failure:function(x){q.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,x.message);}},{previewflag:o,browsetype:m});}}else{U.call(q,f);}};function l(){if(p.isManagedCube){p.cubeName=L.call(q,true);if(!p.isDirectDataAccess){d.call(q);}I.call(q,f);q.enableFinishButton(false);}else{if(mstrApp.saveCubeParams){g.call(q,f,mstrApp.saveCubeParams);}else{if(p.cubeID&&p.cubeName&&p.folderID){I.call(q,f);}else{p.cubeName=L.call(q,true);g.call(q,f);}}}}function w(x,z){q.showDialog(k.dialogType.binaryUploadDialog,{sources:x,onOK:function(){z();}});}function n(){var x;if(mstrApp.isSingleTier){if(p.operationMode===k.operationMode.create){if(mstrApp.isWorkstation&&!mstrApp.isPopup){p.cubeName=L.call(q,true);if(!p.isDirectDataAccess){d.call(q);}I.call(q,f);q.enableFinishButton(false);return ;}J.call(q);}else{u();}return ;}if(p.folderID&&p.operationMode===k.operationMode.create&&!p.cubeID){Z.call(q,f);}else{if(p.operationMode===k.operationMode.create){x=[];O.forEach(p.getAllTableID(),function(z){var AA=p.getImportSource(z);if(((AA.type===k.sourceType.file&&AA.subtype===k.sourceSubtype.localFile)||(AA.type===k.sourceType.file&&AA.subtype===k.sourceSubtype.clipboard))&&!AA.hasRefreshedData){x.push(AA);}});if(x.length>0){w(x,l);}else{l();}}else{if((!p.isManagedCube||(p.isManagedCube&&p.cubePersisted))&&!p.folderID&&p.cubeID){q.dataService.getObjectFolder({success:function(z){if(z&&z.items&&z.items.length===1){p.folderID=z.items[0].fid;if(!p.isManagedCube&&!p.path){q.dataService.fetchFolderContents({success:function(AB){var AC="",AA="";if(AB&&AB.sc&&AB.sc.length>1){AC=AB.sc[0].did;AA=AB.sc[1].did;}q.dataService.getObjectFolder({success:function(AD){if(AD&&AD.items&&AD.items.length===1){p.path=AD.items[0].path;u();}},failure:function(AD){q.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AD.message);}},{dids:p.cubeID,types:3,sharedFolderId:AC,myReportsId:AA});},failure:function(AA){q.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,AA.message);}},{includeAncestorInfo:true,includeObjectDesc:false,folderLinksContextId:1,objectType:8});}else{u();}}},failure:function(z){q.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,z.message);}},{dids:p.cubeID,types:3});}else{if(R.isServerBasedWS()){p.path="serverBased";}u();}}}}E.call(q,{success:function(){b.call(q,{success:function(){var x={success:function(){if(p.operationMode!==k.operationMode.refresh){q.dataService.clearRelationship({success:function(){n();},failure:function(){n();}});}else{n();}},failure:function(z){q.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,z.message);}};q.dataService.toggleDatasetServeMode(x,{serveMode:p.isDirectDataAccess?k.datasetServeMode.dda:k.datasetServeMode.inMemory});}});}});},save:function(){var l=mstrApp.getRootController();var m={success:function(){l.showSaveVisual();}};var n={success:function(){var o=k.requestFlag.mapping|k.requestFlag.sourceInfo|k.requestFlag.relationship;l.model.set("isCubeSaved",true);l.getImportedDataEMMA(k.actions.none,o,undefined,undefined,undefined,undefined,m);},failure:function(o){l.displayError(mstrmojo.desc(13071,"Error in saving the cube."),false,o&&o.message);}};E.call(l,{success:function(){b.call(l,{success:function(){V.call(l,n);}});}});},startSaveAndPublish:function(){this.hasPublishStarted=true;U.call(mstrApp.getRootController(),f);},refreshCubeWithoutSave:function F(){var n=mstrApp.getRootController();var l=n.model;var o={objName:l.cubeName,shouldSave:false,extParams:X.call()};var p={success:function(){P.call(n);},failure:function(m){h.call(n,m);}};n.dataService.saveAndPublishEMMA(p,o);},handleRepublishError:function(o){var l=mstrApp.getRootController(),n=l.getModel(),q=[],p=o.missingTableTbids,m=o.missingColumnTbids;var t={success:function(){I.call(l,f);},failure:function(u){l.displayError(mstrmojo.desc(13069,"Set refresh policy error."),false,u.message);}};O.forEach(m,function(w){var u=n.getImportSource(w);u.origRefreshType=u.refreshType;u.set("refreshType",k.cubeRefreshType.replaceTable);if(u.refreshType!==u.origRefreshType){q.push({did:u.tableID,tp:u.refreshType});}});O.forEach(p,function(w){var u=n.getImportSource(w);u.origRefreshType=u.refreshType;u.set("checked",false);u.set("refreshType",k.cubeRefreshType.preserve);if(u.refreshType!==u.origRefreshType){q.push({did:u.tableID,tp:u.refreshType});}});if(q.length>0){O.forEach(q,function(u){l.dataService.editEMMASourceTable(t,u);});}else{t.success();}},cancelRepublishError:function(q){var l=mstrApp.getRootController(),o=l.getModel(),t=q.missingTableTbids,n=q.missingColumnTbids,p=q.mismatchedDatatypeTbids,m=q.errorTableTbids;this.hasPublishStarted=false;o.getHistoryList().detachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");o.getHistoryList().set("canSendToHistoryList",false);O.forEach(n,function(w){var u=o.getImportSource(w);u.set("hasSelectFile",false);});O.forEach(p,function(w){var u=o.getImportSource(w);u.set("hasSelectFile",false);});O.forEach(t,function(w){var u=o.getImportSource(w);u.set("hasSelectFile",false);});O.forEach(m,function(w){var u=o.getImportSource(w);u.set("hasSelectFile",false);});o.raiseEvent({name:"PublishStatusUpdate",reset:true,errors:q.errorTableErrCode});},sendToHistoryList:function K(){var l=mstrApp.getRootController();var m=l.model;if(m.getHistoryList().canSendToHistoryList){Y.call();}else{if(this.hasPublishStarted===false){m.getHistoryList().attachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");if(m.operationMode===k.operationMode.refresh){this.saveAndPublish();}if(m.operationMode===k.operationMode.edit){this.startSaveAndPublish();}}else{m.getHistoryList().attachEventListener("canSendToHistoryListChange",this.id,"sendToHistoryList");}}},});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPreview","mstrmojo.DI.DIMappingPreview","mstrmojo._HasLayout","mstrmojo.DI.DIConstants","mstrmojo.Container","mstrmojo.DI.DIXtabPreview","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(134,221,1052,1053,1054,1055,1823,2057,2966,3477,10986,12522,12532,12639,12838,12839,12840,12841,12842,12843,12844,12845,12846,12847);var N=mstrmojo.DI.DIConstants,G=mstrmojo.array,C=mstrmojo.hash,E={raw:0,xtab:1},M;function P(Q){return Q<0?Math.abs(parseInt(Q,10)+1):parseInt(Q,10);}function J(){var V=this;var S=mstrApp.getRootController();var Q=S.getModel();var U=Q.importSources[this.tableID];var R=true;if(!U){R=false;}else{if(V.sourceTableKey&&V.sourceTableKey!==U.key){R=false;}}return R;}function F(R){var Q;if(R){switch(R){case"none":Q=0;break;case",":Q=1;break;case";":Q=2;break;case"\t":Q=3;break;case" ":Q=4;break;default:Q=5;break;}}else{Q=0;}return Q;}function H(R){var Q;switch(R){case"'":Q=1;break;case'"':Q=2;break;default:Q=0;}return Q;}function L(R){var Q;switch(R){case'"':Q='\\"';break;case"'":Q="\\'";break;case"":Q="none";break;default:Q=R;break;}return Q;}mstrmojo.DI.ui.dialogs.DIParseDataDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.ui.dialogs.DIParseDataDialog",cssClass:"mstrmojo-di-parse-data-dialog",title:mstrmojo.desc(12838,"Parse Your Data"),mode:E.raw,noButtonCls:true,showTitle:true,originalDelimiter:"",originalQuotes:"",originalSkipRows:"",originalNewCH:false,originalMode:E.raw,bindings:{help:function(){if(mstrApp.isSingleTier){return"Parse_Your_Data_page.htm";}else{return"Parse_Your_Data_page.htm";}}},children:[{scriptClass:"mstrmojo.Label",cssClass:"view-Label",text:mstrmojo.desc(2966,"View: "),bindings:{visible:function(){var R=mstrmojo.all.DIModel;var S=R.importSources[this.parent.tableID].type;var Q=(S!==N.sourceType.hadoop);return Q;}}},{scriptClass:"mstrmojo.ui.CheckList",cssClass:"upload-options",multiSelect:false,orientation:"h",alias:"DIPreviewXtab",selectedIndex:0,items:[{did:"0",n:mstrmojo.desc(10986,"Tabular")},{did:"1",n:mstrmojo.desc(3477,"Crosstab")}],bindings:{visible:function(){var R=mstrmojo.all.DIModel;var S=R.importSources[this.parent.tableID].type;var Q=(S!==N.sourceType.hadoop);return Q;}},postBuildRendering:function(){var Q=mstrmojo.all.DIModel;Q.attachEventListener("changeToXtab",this.id,"changeToXtab");},changeToXtab:function(){var R=mstrApp.getRootController();var Q=R.getModel();var S=Q.importSources[this.parent.tableID];S.currentTransformations.xtab.set("isCrosstab",true);this.parent.set("mode",E.xtab);this.set("selectedIndex",1);},onchange:function(){var U=mstrApp.getRootController();var Q=U.getModel();var W=Q.importSources[this.parent.tableID];var V=W.sourceInfo;if(this.selectedIndex===0){if(W.currentTransformations.xtab.isCrosstab===true){this.parent.set("srcMode",E.raw);W.currentTransformations.xtab.set("isCrosstab",false);U.editImportedData(N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.sourceInfo|N.requestFlag.relationship,W.currentIndex,null,W.currentTransformations.xtab.getXML(),null,null,this.parent.tableID);}U.clearModalNodes();this.parent.set("mode",E.raw);}else{var S=N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.transformations|N.requestFlag.sourceInfo|N.requestFlag.relationship|N.requestFlag.anyState;var R=V.sheetIndex;var X={success:function(){U.getImportedDataEMMA(N.actions.transform,S,R,false,W.tableID);},failure:function(Y){U.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,Y.message||"");}};if(parseInt(this.parent.crosstab.skipRows.value,10)!==P(this.parent.originalSkipRows)||this.parent.newCH.checked){this.parent.originalSkipRows=V.skipRows;this.parent.newCH.set("checked",false);this.parent.set("srcMode",E.xtab);U.editImportedDataEMMA(S,R,"<chs/>",null,this.parent.tableID,-2,null,null,X);}else{this.parent.set("mode",E.xtab);}}this.parent.browserResized(M);}},{scriptClass:"mstrmojo.ImageCheckBox",cssClass:"di-parse-new-column-header",alias:"newCH",label:mstrmojo.desc(12522,"Insert new column headers"),enabled:true,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var Q=mstrmojo.all.DIModel;Q.attachEventListener("PreviewFetched",this.id,"insertHdrs");Q.attachEventListener("PreviewNotFetched",this.id,"insertHdrs");Q.attachEventListener("CurrentSourceChanged",this.id,"insertHdrs");Q.attachEventListener("sourceInfoFetched",this.id,"updateHdrs");Q.attachEventListener("CurrentSourceChanged",this.id,"updateHdrs");this.updateHdrs();},updateHdrs:function(){var R=mstrApp.getRootController();var Q=R.getModel();var S=Q.importSources[this.parent.tableID];if(S&&S.sourceInfo&&S.sourceInfo.hasNewHeaders){this.set("checked",true);this.parent.originalNewCH=true;}},insertHdrs:function(){var Y=this.parent;var R=mstrApp.getRootController();var Q=R.getModel();if(!J.call(Y)){return ;}var W=Y.DIPreviewXtab;var V=Q.importSources[this.parent.tableID];var X=V&&V.currentPreview;if(!X){this.set("visible",false);return ;}var U=V.type;var S=(U===N.sourceType.file||U===N.sourceType.dropbox||U===N.sourceType.googleDrive||U===N.sourceType.hadoop);if(W.selectedIndex===0&&Y.mode===E.raw&&S){this.set("visible",true);if(V.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}},onclick:function(){var R=mstrApp.getRootController();var Q=R.getModel();var U=Q.importSources[this.parent.tableID];var V=U.currentPreview;var S;var W="<chs>";if(this.checked){for(S=1;S<=V.chs.length;S++){W=W+"<ch>Column "+S+"</ch>";}U.set("hasNewHeaders",true);}else{U.set("hasNewHeaders",false);}W=W+"</chs>";mstrApp.getRootController().editImportedData(N.requestFlag.sourceInfo|N.requestFlag.mapping|N.requestFlag.relationship|N.requestFlag.preview,U.currentIndex,W,null,null,null,this.parent.tableID);},bindings:{visible:function(){var R=mstrmojo.all.DIModel;var S=R.importSources[this.parent.tableID].type;var Q=(S===N.sourceType.file||S===N.sourceType.dropbox||S===N.sourceType.googleDrive||S===N.sourceType.hadoop);return(this.parent.mode===E.raw&&Q);}}},{scriptClass:"mstrmojo.HBox",alias:"crosstab",cssClass:"di-preview-parse-options",postCreate:function K(){var S=this.parent;var R=mstrApp.getRootController();var Q=R.getModel();S.attachEventListener("modeChange",this.id,this.makeVisible);Q.attachEventListener("MappingsFetched",this.id,this.makeVisible);Q.attachEventListener("CurrentSourceChanged",this.id,this.makeVisible);},onRender:function O(){this.makeVisible();},makeVisible:function B(){var V=this.parent;var R=mstrApp.getRootController();var Q=R.getModel();var U=Q.importSources[this.parent.tableID];if(!J.call(V)){return ;}var S=U&&U.type;var Y=U&&U.xdaType;var X=U&&U.subtype;var W=U&&U.sourceInfo&&U.sourceInfo.mimetype;if(S===null){this.set("visible",false);return ;}if(S!==N.sourceType.file&&S!==N.sourceType.dropbox&&S!==N.sourceType.googleDrive&&S!==N.sourceType.hadoop){this.set("visible",false);return ;}if(V.mode===E.raw){if(U.canAutoMappingAndDetectRelation()){this.set("visible",true);}else{this.set("visible",false);}}else{this.set("visible",false);}if(((S===N.sourceType.file||S===N.sourceType.hadoop)&&Y===N.xdaType.text&&X!==N.sourceSubtype.clipboard)||(S===N.sourceType.googleDrive&&(W==="text/plain"||W==="text/csv"))||(S===N.sourceType.dropbox&&(W==="text/plain"||W!=="text/csv"))){this.delimiter.set("visible",true);this.delimiter_label.set("visible",true);this.quotes.set("visible",true);this.quotes_label.set("visible",true);}else{this.delimiter.set("visible",false);this.delimiter_label.set("visible",false);this.delimiterCustom.set("visible",false);this.quotes.set("visible",false);this.quotes_label.set("visible",false);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13266,"Skip"),alias:"skipRowsLabel1"},{scriptClass:"mstrmojo.TextBox",cssClass:"di-preview-skip-N-rows-input",alias:"skipRows",postCreate:function K(){var R=mstrApp.getRootController();var Q=R.getModel();Q.attachEventListener("CurrentSourceChanged",this.id,this.update);Q.attachEventListener("SourceInfoFetched",this.id,this.update);this.update();},postBuildRendering:function A(){var R=mstrApp.getRootController();var Q=R.getModel();var S=Q.importSources[this.parent.parent.tableID];this.parent.parent.originalSkipRows=S&&S.sourceInfo.skipRows;},update:function(){var R=mstrApp.getRootController();var Q=R.getModel();var U=Q.importSources[this.parent.parent.tableID];var S=U&&U.sourceInfo.skipRows;S=P(S);this.set("value",S);}},{scriptClass:"mstrmojo.Label",cssClass:"di-preview-skip-N-rows",text:mstrmojo.desc(13267,"rows from beginning"),alias:"skipRowsLabel2"},{scriptClass:"mstrmojo.Label",alias:"delimiter_label",cssClass:"delimiter_label",text:mstrmojo.desc(12840,"Delimiter")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"delimiter",title:mstrmojo.desc(12840,"Delimiter"),cssClass:"di-preview-delimiter pulldown",selectedIndex:0,items:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(1052,"Comma"),v:","},{n:mstrmojo.desc(1054,"Semicolon"),v:";"},{n:mstrmojo.desc(1053,"Tab"),v:"tab"},{n:mstrmojo.desc(1055,"Space"),v:"space"},{n:mstrmojo.desc(1823,"Custom"),v:""}],onSelectedItemChange:function(){if(this.selectedIndex===5){this.parent.delimiterCustom.set("visible",true);if(this.parent.delimiterCustom.inputNode){this.parent.delimiterCustom.focus();}}else{this.parent.delimiterCustom.set("visible",false);}},preBuildRendering:function(){var S=mstrApp.getRootController();var R=S.getModel();var W=R.importSources[this.parent.parent.tableID];var U=W&&W.sourceInfo.delimiter;var V=this.parent.parent;V.originalDelimiter=U;var Q=F(U);this.set("selectedIndex",Q);}},{scriptClass:"mstrmojo.TextBox",alias:"delimiterCustom",cssClass:"di-preview-delimiter-inputBox",maxLength:"1",postBuildRendering:function(){var S=mstrApp.getRootController();var R=S.getModel();var V=R.importSources[this.parent.parent.tableID];var U=V&&V.sourceInfo.delimiter;var Q=F(U);if(Q===5){this.set("value",U);}}},{scriptClass:"mstrmojo.Label",alias:"quotes_label",cssClass:"quotes-label",text:mstrmojo.desc(12841,"Quotes")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"quotes",title:mstrmojo.desc(12841,"Quotes"),cssClass:"di-preview-quotes pulldown",items:[{n:mstrmojo.desc(2057,"None"),v:"none"},{n:mstrmojo.desc(12842,"Single Quotes"),v:"\\'"},{n:mstrmojo.desc(12843,"Double Quotes"),v:'\\"'}],preBuildRendering:function(){var U=mstrApp.getRootController();var R=U.getModel();var W=R.importSources[this.parent.parent.tableID];var S=W&&W.sourceInfo.quotes;var V=this.parent.parent;V.originalQuotes=S;var Q=H(S);this.set("selectedIndex",Q);}},{scriptClass:"mstrmojo.Button",alias:"delimiterOK",text:mstrmojo.desc(134,"Apply"),cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(){var X=mstrApp.getRootController().model;var Q=X.importSources[this.parent.parent.tableID];var W=Q.nrows-1;var Z=this.parent.delimiter;var U=this.parent.quotes;var Y=this.parent.skipRows;var R,S,a;if(parseInt(Y.value,10)!==P(Q.sourceInfo.skipRows)){R=parseInt(Y.value,10);if(R>W){var V="There are only ## rows in the original data. Please input a number lower than that.";mstrApp.getRootController().displayError(V.replace("##",W));return ;}}if(Z.selectedIndex===5){var c=this.parent.delimiterCustom.value;switch(c){case" ":c="space";break;case"  ":c="tab";break;default:break;}S=c;}else{S=Z.items[Z.selectedIndex].v;}if(U.selectedIndex!==undefined){a=U.items[U.selectedIndex].v;U.set("idx",U.selectedIndex);}var b=N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.transformations|N.requestFlag.sourceInfo|N.requestFlag.sheets|N.requestFlag.relationship|N.requestFlag.anyState;var d=Q.sourceInfo.sheetIndex;if(Z.selectedIndex!==undefined){Z.set("idx",Z.selectedIndex);}mstrApp.getRootController().editImportedDataEMMA(b,d,null,null,this.parent.parent.tableID,R,S,a);}}]},{scriptClass:"mstrmojo.ImageCheckBox",alias:"mhb",label:mstrmojo.desc(12639,"No metric headers"),origMhb:null,postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";var Q=mstrmojo.all.DIModel;var R=this.parent;Q.attachEventListener("TransformationsFetched",this.id,"hasNoMetric");Q.attachEventListener("CurrentSourceChanged",this.id,"hasNoMetric");R.xtab_container.xtab.attachEventListener("NoMetricHeaderBlock",this.id,"hasNoMetric");},hasNoMetric:function(){var V=this.parent;var R=mstrApp.getRootController();var Q=R.getModel();var U=Q.importSources[this.parent.tableID];if(!J.call(V)){return ;}if(U===null){return ;}if(!U.currentTransformations){return ;}if(U.currentTransformations.xtab){var S=U.currentTransformations.xtab.mhb;if(S.startRow===-1||S.startColumn===-1){this.set("checked",true);this.origMhb=mstrmojo.hash.copy(S);S.set("startColumn",-1);S.set("startRow",-1);S.set("endColumn",-1);S.set("endRow",-1);}else{this.set("checked",false);}}},setDefaultMhb:function(R,Q){if(Q.startRow>0){R.set("startRow",Q.startRow-1);R.set("endRow",Q.startRow-1);R.set("startColumn",Q.startColumn);R.set("endColumn",-1);}else{if(Q.startColumn>0){R.set("startRow",Q.startRow);R.set("endRow",-1);R.set("startColumn",Q.startColumn-1);R.set("endColumn",Q.startColumn-1);}else{this.set("checked",true);}}},onclick:function(){var W=this.parent;var R=mstrApp.getRootController();var Q=R.getModel();var V=Q.importSources[this.parent.tableID];var U=V.currentTransformations.xtab.mhb;var S=V.currentTransformations.xtab.db;if(this.checked){this.origMhb=mstrmojo.hash.copy(U);U.set("startColumn",-1);U.set("startRow",-1);U.set("endColumn",-1);U.set("endRow",-1);}else{if(!this.origMhb){this.origMhb=mstrmojo.hash.copy(U);}if((this.origMhb.startRow===-1)||(this.origMhb.startColumn===-1)){this.setDefaultMhb(U,S);}else{if(this.origMhb.startRow===this.origMhb.endRow){if(this.origMhb.startRow>=S.startRow){this.setDefaultMhb(U,S);}else{U.set("startColumn",S.startColumn);U.set("endRow",this.origMhb.endRow);U.set("endColumn",this.origMhb.endColumn);U.set("startRow",this.origMhb.startRow);}}else{if(this.origMhb.startColumn>=S.startColumn){this.setDefaultMhb(U,S);}else{U.set("startRow",S.startRow);U.set("endRow",this.origMhb.endRow);U.set("endColumn",this.origMhb.endColumn);U.set("startColumn",this.origMhb.startColumn);}}}}W.xtab_container.xtab.draw();},bindings:{visible:function(){return(this.parent.mode===E.xtab);}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-preview-xtab-legend",alias:"xtabLegend",children:[{scriptClass:"mstrmojo.Label",cssClass:"attribute-headers",text:mstrmojo.desc(12844,"Attribute Headers")},{scriptClass:"mstrmojo.Label",cssClass:"attribute-elements",text:mstrmojo.desc(12845,"Attribute elements")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-headers",text:mstrmojo.desc(12846,"Metrics Headers")},{scriptClass:"mstrmojo.Label",cssClass:"metrics-values",text:mstrmojo.desc(12847,"Metrics values")}],bindings:{visible:function(){return(this.parent.mode===E.xtab);}}},{scriptClass:"mstrmojo.DI.DIMappingPreview",alias:"preGrid",hasContextMenu:false,columns:[],postCreate:function(){var R=mstrApp.getRootController();var Q=R.getModel();Q.attachEventListener("MappingsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){Q.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}},initPreview:function(){var Z=mstrApp.getRootController();var a=Z.getModel();var Q=a.importSources[this.parent.tableID];var V,X=[],W,S,U;if(!J.call(this.parent)){return ;}if(!Q){return ;}var R,b;if(this.parent.mode===E.raw){R=Q.currentMapping;if(!R){return ;}if(!Q.currentPreview){return ;}b=Q.currentPreview.data;}else{R=Q.transformedMapping;if(!R){return ;}if(!Q.transformedPreview){return ;}b=Q.transformedPreview.data;}G.forEach(R,function(c){V=c.subColumns;if(V&&V.length>=1){S=[];G.forEach(V,function(d){if(d.columnState!==4&&(d.type!=="cmps"||Q.executeAction!==0)){S.push(d);}});U=S.length;if(U>1){W={};C.copy(c,W);W.subColumns=S;X.push(W);}else{if(U===1){X.push(S[0]);}}}else{if(c.columnState!==4&&(c.type!=="cmps"||Q.executeAction!==0)){X.push(c);}}});var Y={mappings:X,dataset:b,supportTimeGeo:true,shapeKeys:a.shapeKeys,renameMapped:function(j,h,k){var d=this,e=d.mappings,l=false,f,g;for(f=0,g=e.length;f<g;f++){if(f!==h){if(k===e[f].alias&&e[h].tp===e[f].tp){l=true;break;}}}if(l){var c=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");mstrApp.getRootController().displayError(c.replace("##",k),null,d.alertTitle);return ;}d.mappings[h].alias=k;mstrApp.getRootController().model.raiseEvent({name:"MappingsFetched"});}};this.set("model",Y);if(!Y.mappings){return ;}this.populatePreview();if(M){this.parent.browserResized(M);}},bindings:{visible:function(){return(this.parent.mode===E.raw);},height:function(){var Q=mstrmojo.all.DIModel;var R=Q.importSources[this.parent.tableID].type;if(R!==N.sourceType.hadoop){return"80%";}else{return"86%";}}}},{scriptClass:"mstrmojo.Box",cssClass:"di-xtab-container",alias:"xtab_container",children:[{scriptClass:"mstrmojo.DI.DIXtabPreview",alias:"xtab",cssClass:"di-xtab",postCreate:function(){var R=mstrApp.getRootController();var Q=R.getModel();Q.attachEventListener("TransformationsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){Q.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}Q.attachEventListener("FlatPreviewFetched",this.id,"initPreview");},initPreview:function(){var U=this.parent.parent.DIPreviewXtab;var R=mstrApp.getRootController();var Q=R.getModel();var S=Q.importSources[this.parent.parent.tableID];if(!J.call(this.parent.parent)){return ;}if(!S){return ;}if(!S.currentTransformations){return ;}if(!S.currentTransformations.xtab){return ;}if(!S.currentPreview){return ;}this.initXtab(S.currentPreview.data,S.currentTransformations.xtab,S.currentPreview.chs);if(S.currentTransformations.xtab.isCrosstab===true){U.set("selectedIndex",1);if(S.executeAction===0){this.parent.parent.set("mode",E.xtab);}}else{U.set("selectedIndex",0);this.parent.parent.set("mode",E.raw);}},bindings:{visible:function(){return(this.parent.parent.mode===E.xtab);}}}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"applyBtn",enabled:true,onclick:function(){var R=this.parent.parent;var Q=mstrApp.getRootController();var V=Q.model.importSources[this.parent.parent.tableID];var U=V.sourceInfo;R.originalNewCH=R.newCH.checked;if(U.skipRows!==undefined){R.originalSkipRows=U.skipRows.toString();}if(U.delimiter){R.originalDelimiter=U.delimiter;}else{R.originalDelimiter="none";}if(U.quotes){R.originalQuotes=U.quotes;}else{R.originalQuotes="none";}R.originalMode=R.mode;var S=R.DIPreviewXtab;if(S.selectedIndex===1&&R.mode===E.xtab){V.currentTransformations.xtab.set("isCrosstab",true);R.set("mode",E.xtab);R.set("srcMode",E.xtab);Q.clearModalNodes();Q.editImportedData(N.requestFlag.transformedPreview|N.requestFlag.mapping|N.requestFlag.sourceInfo|N.requestFlag.relationship,V.currentIndex,null,V.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}R.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelBtn",onclick:function(){var a=this.parent.parent;var Y=mstrApp.getRootController();var V=Y.getModel();var S=V.importSources[this.parent.parent.tableID];var c=S.currentPreview;var X=false;var d=N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.transformations|N.requestFlag.sourceInfo|N.requestFlag.sheets|N.requestFlag.relationship|N.requestFlag.anyState;var g=S.sourceInfo.sheetIndex;var R=P(a.originalSkipRows);var b,Q,U,e;if(a.originalMode===a.mode&&a.mode===E.raw){if(parseInt(a.crosstab.skipRows.value,10)!==R){X=true;b=a.originalSkipRows<0?"-2":a.originalSkipRows;}if(a.newCH.checked!==a.originalNewCH){a.newCH.set("checked",a.originalNewCH);S.hasNewHeaders=a.originalNewCH;X=true;var W;Q="<chs>";if(a.originalNewCH){for(W=1;W<=c.chs.length;W++){Q=Q+"<ch>Column "+W+"</ch>";}}Q=Q+"</chs>";}var Z=a.crosstab.delimiter;var h=a.crosstab.quotes;if(Z.visible){if(Z.idx===5){var f=S.sourceInfo.delimiter;if(f!==a.originalDelimiter){X=true;U=a.originalDelimiter;}}else{if(Z.idx!==F(a.originalDelimiter)){X=true;U=a.originalDelimiter;}}}if(h.visible){if(h.idx!==H(a.originalQuotes)){X=true;e=L(a.originalQuotes);}}if(X){Y.editImportedDataEMMA(d,g,Q,null,this.parent.parent.tableID,b,U,e);}}else{if(a.originalMode===a.mode&&a.mode===E.xtab){if(a.srcMode===E.raw){d=N.requestFlag.transformedPreview|N.requestFlag.mapping|N.requestFlag.sourceInfo|N.requestFlag.relationship;S.currentTransformations.xtab.set("isCrosstab",true);a.set("mode",E.xtab);a.set("srcMode",E.xtab);Y.clearModalNodes();Y.editImportedDataEMMA(d,S.currentIndex,null,S.currentTransformations.xtab.getXML(),this.parent.parent.tableID,a.originalSkipRows,a.originalDelimiter,a.originalQuotes);}if(a.newCH.checked!==a.originalNewCH){a.newCH.set("checked",a.originalNewCH);S.hasNewHeaders=a.originalNewCH;}}else{if(a.originalMode!==a.mode&&a.originalMode===E.raw){if(S.currentTransformations.xtab.isCrosstab===true){S.currentTransformations.xtab.set("isCrosstab",false);a.set("srcMode",E.raw);Y.editImportedData(N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.sourceInfo|N.requestFlag.relationship,S.currentIndex,null,S.currentTransformations.xtab.getXML(),null,null,this.parent.parent.tableID);}Y.clearModalNodes();a.set("mode",E.raw);}else{if(a.originalMode!==a.mode&&a.originalMode===E.xtab){d=N.requestFlag.transformedPreview|N.requestFlag.mapping|N.requestFlag.sourceInfo|N.requestFlag.relationship;S.currentTransformations.xtab.set("isCrosstab",true);a.set("mode",E.xtab);a.set("srcMode",E.xtab);Y.clearModalNodes();Y.editImportedDataEMMA(d,S.currentIndex,null,S.currentTransformations.xtab.getXML(),this.parent.parent.tableID,a.originalSkipRows,a.originalDelimiter,a.originalQuotes);}}}}a.close();}}],browserResized:function I(R){var S=parseInt(R.w,10),Q=Math.floor(parseInt(R.h,10)*0.95),U=this.preGrid;M=R;if(isNaN(S)||S<0||!this.domNode){return ;}if(S<800){S=760;this.domNode.children[0].style.width="760px";}else{S=Math.ceil(S*0.95);this.domNode.children[0].style.width="";}if(S>40&&U.domNode){U.domNode.style.width=(S-40)+"px";U.itemsContainerNode.style.width=(S-40)+"px";if(Q>271){this.domNode.children[0].style.height=Q+"px";this.containerNode.style.height=(Q-112)+"px";U.domNode.style.height=(Q-250)+"px";U.scrollNode.style.height=(Q-271)+"px";this.xtabLegend.domNode.style.width=(S-40)+"px";this.xtab_container.domNode.style.width=(S-40)+"px";this.xtab_container.domNode.style.height=(Q-250)+"px";}U.widgetResized();}if(this.domNode.childNodes[0]){mstrmojo.dom.center(this.domNode.childNodes[0]);}},onOpen:function D(){var Y=mstrApp.getRootController();var V=Y.getModel();var Q=V.importSources[this.tableID];this.originalDelimiter=Q&&Q.sourceInfo.delimiter;this.originalQuotes=Q&&Q.sourceInfo.quotes;mstrApp.getRootController().selectSourceTable(this.tableID);if(this.originalMode===E.xtab){if(!Q.currentTransformations.xtab.isCrosstab){Q.currentTransformations.xtab.set("isCrosstab",true);}this.set("mode",E.xtab);}if((Y.model.operationMode!==N.operationMode.create&&Q.currentTransformations&&Q.currentTransformations.xtab&&Q.currentTransformations.xtab.isCrosstab)||!Q.currentPreview){var Z=N.requestFlag.preview|N.requestFlag.mapping|N.requestFlag.transformations;var U=Q.sourceInfo;var a=U.sheetIndex;Y.getImportedDataEMMA(N.actions.getFlatPreview,Z,a,false,this.tableID);this.originalMode=E.xtab;}this.preGrid.initPreview();this.xtab_container.xtab.initPreview();var X=F(this.originalDelimiter);this.crosstab.delimiter.set("selectedIndex",X);if(this.crosstab.delimiter.idx!==X){this.crosstab.delimiter.set("idx",X);}var W=H(this.originalQuotes);this.crosstab.quotes.set("selectedIndex",W);if(this.crosstab.quotes.idx!==W){this.crosstab.quotes.set("idx",W);}var S=P(this.originalSkipRows);this.crosstab.skipRows.set("value",S);var R=mstrmojo.hash.walk("sourceInfo.url",Q);if(R&&R.toLowerCase&&R.toLowerCase().startsWith&&R.toLowerCase().startsWith("hdfs")){this.newCH.set("enabled",false);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.DI.TableSources","mstrmojo.DI.DIDatabaseImportOption","mstrmojo.DI.DIMappingDeck");mstrmojo.requiresDescs(702,962,967,1388,3581,11403,12860,12861,13039);var M=mstrmojo.DI.DIConstants;var A=mstrmojo.DI.DIConstants.menuItems;var F=mstrmojo.dom;var G="databaseImportDialog";var E="__di_table_source_dialog";var K=mstrmojo.DI.DIConstants.pageType;function D(){var O=this.pageType;if(O){switch(O){case K.database:var P=mstrmojo.all[G];if(!P){var N={scriptClass:"mstrmojo.DI.DIDatabaseImportOption",domSrc:this.parent.parent.domSrc};P=mstrmojo.insert(N);}P.open();break;default:var Q=mstrApp.getRootController().navigationController.getPageSlot();Q.setConfig({properties:{operationMode:M.operationMode.create}});mstrApp.getRootController().showPage(O,this.sourceInfo,Q);mstrmojo.Obj.free(Q);}}}function B(P,N){var R=document.createElement("div"),Q=R.style,O=P.domNode;R.className="resize-handler-avatar";Q.width=O.clientWidth+"px";O.appendChild(R);P.avatar=R;return R;}function J(P,N){var O=N.src,R=O&&O.data;if(R&&R.node){var Q=P.avatar||B(P,N);Q.style.top=Math.max(R.pos.y,O.pos.y)+"px";Q.style.left=R.pos.x+"px";Q.style.display="block";Q.style.zIndex="9999";Q.style.width=R.pos.w+"px";return true;}}function H(O,N){if(O.avatar){O.avatar.style.display="none";}}function C(Q,N){var U=N.src;var P=N.src;if(!P){return false;}var S=P.data;var O=N.tgt,R=Q.avatar;if(R){R.style.top=Math.min(Math.max(S.pos.y+Q.minSpan,O.pos.y),S.pos.y+S.pos.h-Q.minSpan)+"px";}}mstrmojo.DI.DITableItem=mstrmojo.declare(mstrmojo.Container,null,{type:"",name:"",cm:"",cssClass:"",allowEdit:true,markupString:'<div id="{@id}" class="mstrmojo-di-tableitem {@cssClass}" style="{@cssText}" ><div class="mstrmojo-di-tableitem-icon t{@type}"></div><div class="mstrmojo-di-tableitem-name"></div><div class="mstrmojo-di-tableitem-button"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"table":"none";}},markupSlots:{textNode:function(){return this.domNode.children[1];},menuNode:function(){return this.domNode.children[2];}},rename:function(){this.text.rename();},children:[{slot:"textNode",alias:"text",scriptClass:"mstrmojo.InlineEditBox",getValueFromText:function(){return this.text?mstrmojo.string.decodeHtmlString(this.text):"";},rename:function(){if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}},onSave:function(){var N=this.text;this.parent.raiseEvent({name:"itemOnSave",src:this,text:N});},bindings:{allowEdit:"this.parent.allowEdit",text:"this.parent.name"}},{slot:"menuNode",scriptClass:"mstrmojo.MenuButton",postCreate:function(){if(this.parent.cm){this.cm=this.parent.cm;}else{this.set("visible",false);}this.menuZIndex=this.parent.menuZIndex||999;},onclick:function(){var N=this;if(!this._close_handler_onmouseup_set){if(this._close_handler){mstrmojo.dom.attachEvent(document.body,"mouseup",this._close_handler);}this._close_handler_onmouseup_set=true;}},onmousedown:function(N){N.cancel();},executeCommand:function(N){this.parent.raiseEvent({name:"executeCommand",src:this,item:N});}}]});mstrmojo.DI.DIMappingPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIMappingPanel",draggable:true,dropZone:true,ownAvatar:true,minSpan:80,markupString:'<div id="{@id}" class="mstrmojo-di-mapping-panel {@cssClass}" style="{@cssText}"><div class="table-list"></div><div class="table-deck"><div class="resize-handler __r0"></div></div><div class="table-deck"><div class="resize-handler __r1"></div></div><div class="table-deck"><div class="resize-handler __r2"></div></div><div class="unused-option"></div></div>',markupSlots:{tableListNode:function(){return this.domNode.children[0];},attrDeckNode:function(){return this.domNode.children[1];},metricDeckNode:function(){return this.domNode.children[2];},unusedDeckNode:function(){return this.domNode.children[3];},unusedOptionNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},layoutConfig:{h:{tableListNode:"20%",attrDeckNode:"40%",metricDeckNode:"40%",unusedDeckNode:"0%",unusedOptionNode:"20px"},w:{tableListNode:"100%",attrDeckNode:"100%",metricDeckNode:"100%",unusedDeckNode:"100%",unusedOptionNode:"100%"}},getDragData:function(R){var N=R.src;var O=N.node;var S,X;var U=null;if(O.className&&O.className.indexOf("resize-handler")>=0){var P=O.className.indexOf("__r");var W=parseInt(O.className.substr(P+3,1),10);switch(W){case 0:X=this.tableListNode;S=this.attrDeckNode;break;case 1:X=this.attrDeckNode;S=this.metricDeckNode;break;case 2:X=this.metricDeckNode;S=this.unusedDeckNode;break;}if(X&&S){var Q=F.position(X);var V=F.position(S);U={x:Q.x,y:Q.y,w:Q.w,h:Q.h+V.h};}return{node:O,pos:U,idx:W};}return null;},allowDrop:function(N){var O=N.src;return O&&O.data&&O.data.node;},isDragValid:function I(N){var O=N.src,P=O&&O.data;return !!(P&&P.node);},ondragstart:function(N){J(this,N);},ondragmove:function(N){C(this,N);},ondragend:function(R){var Y=R.src,U=Y&&Y.data;var O=null;if(U&&U.node){var N=this.avatar;if(N){O=parseInt(N.style.top,10)-U.pos.y;}}H(this,R);if(O){var X=U.idx;var V=F.position(this.domNode).h;var W=null,Q=null,S=null,P=null;switch(X){case 0:W=O/V*100;Q=(F.position(this.tableListNode).h+F.position(this.attrDeckNode).h-O)/V*100;S=F.position(this.metricDeckNode).h/V*100;P=F.position(this.unusedDeckNode).h/V*100;break;case 1:W=F.position(this.tableListNode).h/V*100;Q=O/V*100;S=(F.position(this.attrDeckNode).h+F.position(this.metricDeckNode).h-O)/V*100;P=F.position(this.unusedDeckNode).h/V*100;break;case 2:W=F.position(this.tableListNode).h/V*100;Q=F.position(this.attrDeckNode).h/V*100;S=O/V*100;P=(F.position(this.metricDeckNode).h+F.position(this.unusedDeckNode).h-O)/V*100;break;}if(W!==null&&Q!==null&&S!==null&&P!==null){W=Math.round(W);Q=Math.round(Q);if(P!==0){S=Math.round(S);P=100-W-Q-S;}else{S=100-W-Q;}this.layoutConfig.h={tableListNode:W+"%",attrDeckNode:Q+"%",metricDeckNode:S+"%",unusedDeckNode:P+"%",unusedOptionNode:"20px"};this.doLayout();}}},afterLayout:function(){var N;if(this.tableListNode){this.tableList.set("height",this.tableListNode.clientHeight);}if(this.attrDeckNode){N=this.attrDeckNode.children[0].clientHeight;this.attrDeck.set("height",this.attrDeckNode.clientHeight-N);}if(this.metricDeckNode){N=this.metricDeckNode.children[0].clientHeight;this.metricDeck.set("height",this.metricDeckNode.clientHeight-N);}if(this.unusedDeckNode){N=this.unusedDeckNode.children[0].clientHeight;this.unusedDeck.set("height",this.unusedDeckNode.clientHeight-N);}},reInitLayout:function(S){var V=this[S].visible;var N=["attrDeckNode","metricDeckNode","unusedDeckNode"];var X=this.layoutConfig.h;var U=0;var R,Q,O,P,W;P=N.length;for(R=0;R<N.length;R++){U+=parseInt(X[N[R]],10);}if(V){O=Math.round(U/P);}else{O=0;}Q=0;for(R=0;R<N.length;R++){W=N[R];if(W===S+"Node"){this.layoutConfig.h[W]=O+"%";}else{if(Q<P-2){this.layoutConfig.h[W]=Math.round((U-O)/(P-1))+"%";Q++;}else{this.layoutConfig.h[W]=U-O-Math.round((U-O)/(P-1))*(P-2)+"%";}}}this.doLayout();},preBuildRendering:function(){if(this._super){this._super();}this.model.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var N=this.model.currentSource;var O=true;if(N===null){O=false;}else{if(N.type===M.sourceType.querybuilder){if(N.xdaType===M.xdaType.qbSingleTable){O=true;}else{O=false;}}}if(O){this.unusedOption.set("visible",true);this.layoutConfig.w.unusedOptionNode="100%";this.layoutConfig.h.unusedOptionNode="20px";this.unusedDeck.set("visible",this.unusedOption.checked);}else{this.unusedOption.set("visible",false);this.layoutConfig.w.unusedOptionNode="0px";this.layoutConfig.h.unusedOptionNode="2px";this.unusedDeck.set("visible",false);}},children:[{slot:"tableListNode",alias:"tableList",scriptClass:"mstrmojo.Container",markupString:'<div class="tablelist" style="{@cssText}"><div></div><div></div></div>',markupSlots:{captionNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},onheightChange:function(N){this.list.set("height",(parseInt(N.value,10)-20)+"px");},children:[{slot:"captionNode",alias:"table",scriptClass:"mstrmojo.Table",cssClass:"titlebar-table",rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",cssClass:"titlebar-label",text:"Table",slot:"0,0"},{scriptClass:"mstrmojo.Button",cssClass:"titlebar-button",text:"+",slot:"0,1",onclick:function L(){var N=mstrmojo.all[E];if(!N){N=mstrmojo.insert({id:E,scriptClass:"mstrmojo.DI.TableSources",zIndex:999,domSrc:this.domNode,clickhandler:D});}N.open();}}]},{slot:"listNode",alias:"list",scriptClass:"mstrmojo.WidgetList",cssClass:"mstrmojo-di-mappingpanel-tablelist",itemFunction:function(Q,P,R){var N={type:Q.type,name:Q.n,cm:Q.cm,data:Q,parent:R,index:P};if(typeof Q.allowEdit==="boolean"){N.allowEdit=Q.allowEdit;}var O=new mstrmojo.DI.DITableItem(N);O.attachEventListener("executeCommand",R.id,"onExecuteCommand");O.attachEventListener("itemOnSave",R.id,"onTableItemRename");return O;},onheightChange:function(N){if(this.domNode){this.domNode.style.height=parseInt(N.value,10)+"px";}},onchange:function(){var Q=this.selectedItem;var P=this.parent.parent.model.currentSource?this.parent.parent.model.currentSource.tableID:-1;var O;if(!Q){return ;}for(O=0;O<this.items.length;O++){if(this.itemsContainerNode&&this.itemsContainerNode.childNodes){mstrmojo.css.toggleClass(this.itemsContainerNode.childNodes[O],"selected",(O===Q.index||this.itemsContainerNode.childNodes.length===1));}}var N=Q.dssid;mstrApp.getRootController().selectSourceTable(N);},postCreate:function(){var N=this.parent.parent.model;this.update();if(this.items.length>0){mstrApp.getRootController().selectSourceTable(this.items[0].dssid);}N.attachEventListener("MappingsFetched",this.id,"update");},update:function(){var Q=[];var P=this.parent.parent.model;var S;var O=[];O.push({n:mstrmojo.desc(1388,"Rename"),did:A.RENAME});O.push({n:mstrmojo.desc(12860,"Clean your data"),did:A.REFINE});O.push({n:mstrmojo.desc(702,"Advanced"),did:A.REFINE_WITHOUT_PARSING});O.push({did:A.SEPARATOR});O.push({n:mstrmojo.desc(13039,"Delete"),did:A.DELETE});if(P.operationMode===M.operationMode.edit){O.push({did:A.SEPARATOR});O.push({n:mstrmojo.desc(967,"Refresh Data"),did:A.REFRESH_DATA});}var N=P.getAllTableID();var R,U;for(R=0;R<N.length;R++){U=P.getImportSource(N[R]);if(U.sourceInfo){S={n:U.sourceInfo.name,type:U.type,dssid:U.key,cm:O,index:R+1};Q.push(S);}}if(Q.length>1){Q.splice(0,0,{n:"All",type:"All",dssid:-1,index:0,allowEdit:false});}this.set("items",Q);if(this.items.length>0){R=this.selectedIndex===-1?0:this.selectedIndex;if(R>=this.items.length){R=0;}this.set("selectedIndex",-1);this.set("selectedIndex",R);}},onTableItemRename:function(N){var R=N.src;var Q=N.text;var O=R.data.dssid;var P=mstrApp.getRootController().model.getImportSource(O);if(!P||!P.sourceInfo){return ;}if(Q===P.sourceInfo.name){return ;}mstrApp.getRootController().renameSourceTable(O,Q);},onExecuteCommand:function(N){var S=N.src;var R=N.item;switch(R.did){case A.REFINE:mstrApp.getRootController().startRefineStage(S.data.dssid,1);break;case A.REFINE_WITHOUT_PARSING:var O=mstrmojo.all.DIModel.importSources[S.data.dssid].sourceInfo.dbTableName;var U=O.lastIndexOf(".");var Q=O.substr(U+1);var P;if(Q==="xls"){P='<rss rfmt="binary/xls"><rpo>{"includeFileSources":false,"xmlBased":false,"storeBlankRows":true,"ignoreLines":-1,"storeBlankCellsAsNulls":true,"headerLines":1,"skipDataLines":0,"sheets":[0],"projectName":"lmy"}</rpo></rss>';}else{if(Q==="xlsx"){P='<rss rfmt="text/xml/xlsx"><rpo>{"includeFileSources":false,"xmlBased":true,"storeBlankRows":true,"ignoreLines":-1,"storeBlankCellsAsNulls":true,"headerLines":1,"skipDataLines":0,"sheets":[0],"projectName":"lmy"}</rpo></rss>';}else{P='<rss rfmt="text/line-based/*sv"><rpo>{"encoding":"","separator":"","ignoreLines":-1,"headerLines":0,"skipDataLines":0,"limit":-1,"storeBlankRows":true,"guessCellValueTypes":false,"processQuotes":true,"storeBlankCellsAsNulls":true,"includeFileSources":false,"projectName":"lmy"}</rpo></rss>';}}mstrApp.getRootController().startRefineStage(S.data.dssid,2,P);break;case A.RENAME:S.rename();break;case A.DELETE:mstrApp.getRootController().removeSourceTable(S.data.dssid);break;case A.REFRESH_DATA:mstrApp.getRootController().refreshSourceTable(S.data.dssid);break;}}}]},{slot:"attrDeckNode",alias:"attrDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",title:mstrmojo.desc(3581,"Attributes"),type:"amps",bindings:{model:"this.parent.model"}},{slot:"metricDeckNode",alias:"metricDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",title:mstrmojo.desc(962,"Metrics"),type:"mtmps",bindings:{model:"this.parent.model"}},{slot:"unusedDeckNode",alias:"unusedDeck",scriptClass:"mstrmojo.DI.DIMappingDeck",cssClass:"unused",title:mstrmojo.desc(12861,"Unused"),type:"cmps",visible:false,bindings:{model:"this.parent.model"},markupMethods:{onvisibleChange:function(){this.parent.unusedDeckNode.style.display=this.visible?"block":"none";this.parent.reInitLayout("unusedDeck");}}},{slot:"unusedOptionNode",alias:"unusedOption",scriptClass:"mstrmojo.ImageCheckBox",cssClass:"unusedOption",label:mstrmojo.desc(11403,"Show unused columns"),oncheckedChange:function(){var N=this.checked;this.parent.unusedDeck.set("visible",N);}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIAllObjectsGrid","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.Pulldown","mstrmojo.string");mstrmojo.requiresDescs(10,118,221,2177,4531,12667,12668,12954,13912,13913);var O=mstrmojo.array,L=mstrmojo.func,N=mstrmojo.string,S=[1,2,3,8,9,11],D="DI-All-Attributes-View",C="DI-All-Metrics-View",J="DI-Dist-Key-Selector",A="DI-Dist-Num-Input",Q=mstrmojo.desc(12666,"Search..."),B={id:"",alias:mstrmojo.desc(12667,"---- none ----")},R={id:"autopa",alias:mstrmojo.desc(4531,"Automatic")},V=null,P=null,K=mstrmojo.emptyFn;function I(X){if(X.isMultiForm){var Y,Z=X.subColumns.length;for(Y=0;Y<Z;Y++){if(X.subColumns[Y].fmn==="ID"){return X.subColumns[Y].dtp;}}}return X.dtp;}function E(){var Y,X;if(!P){return ;}Y=V.cubeConfig;X=mstrmojo.all[D];if(X){Y.sidxes=X.getSearchIdxes();}P.persistCubeConfig(Y);}mstrmojo.DI.DIAllObjectsView=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIAllObjectsView",cssClass:"mstrmojo-di-allObjects-dialog",id:"diAllObjectsViewDialog",title:mstrmojo.desc(12668,"All Objects View"),model:null,noButtonCls:true,showTitle:true,help:"All_Objects_View_Page.htm",init:function U(Y){var X;P=mstrApp.getRootController().allObjectsController;V=mstrApp.getRootController().model;K=mstrmojo.emptyFn;if(this._super){this._super(Y);}V.attachEventListener("MappingsFetched",this.id,"onMappingsChange");X=this.id;O.forEach([D,C],function(a){var Z=mstrmojo.all[a];Z.attachEventListener("beginSelectionItem",X,"gridBeginSelectionItem");});mstrmojo.all[D].attachEventListener("searchIndexChange",X,"onsearchIndexChange");},onOpen:function(){if(this._super){this._super();}K=L.debounce(E,500);},gridBeginSelectionItem:function(X){var Y=X.src;O.forEach([D,C],function(Z){if(Z!==Y.id){mstrmojo.all[Z].clearSelect();}});},onsearchIndexChange:function(){K();},onClose:function F(){this.destroy();},onMappingsChange:function(){var Z=mstrmojo.all[J];var Y;if(Z){Y=Z.updateKeys(true);}if(!Y){var X=mstrmojo.all[A];if(X){X.enableInput(false);}}},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),visible:false,onclick:function(){var Y=V.cubeConfig;var X=mstrmojo.all[D];if(X){Y.sidxes=X.getSearchIdxes();}P.persistCubeConfig(Y);this.parent.parent.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2177,"Close"),onclick:function(){this.parent.parent.close();}}],children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Box",cssClass:"all-objects-header cf",children:[{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"all-objects-search",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" mstrAttach:keyup,blur,focus/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',searchDelay:200,onSearch:false,setSearchTip:function(){this.inputNode.value=Q;},postBuildRendering:function W(X){if(this._super){this._super(X);}this.inputNode.setAttribute("placeholder",mstrmojo.desc(12666,"Search..."));},onfocus:function(){if(this.text){this.inputNode.value=this.text;}else{this.clearSearch(true);}},onblur:function(){if(!this.text){var X=mstrmojo.all[D];if(X.items.length===0){X.set("items",X.allItems);}X=mstrmojo.all[C];if(X.items.length===0){X.set("items",X.allItems);}}},searchTriggered:function(X){if(X===Q){return ;}var Y=mstrmojo.all[D];if(Y){Y.filterItems(X);}Y=mstrmojo.all[C];if(Y){Y.filterItems(X);}}},{scriptClass:"mstrmojo.HBox",cssClass:"distribution-key-box",cellPadding:5,bindings:{visible:function(){return mstrApp.getRootController().allObjectsController.isCubeConfigEnabled();}},children:[{scriptClass:"mstrmojo.Label",cssClass:"distribution-key-caption",text:mstrmojo.desc(13912,"Partition Attribute")},{scriptClass:"mstrmojo.Pulldown",id:J,itemField:"alias",itemIdField:"id",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup mstrmojo-di-Pulldown-scrollOnHover",postCreate:function(){if(this._super){this._super();}var X=mstrApp.getRootController().allObjectsController;X.attachEventListener("updateDistKey",this.id,"updateKeys");},onvalueChange:function(){if(this._super){this._super();}V.cubeConfig.distInfo.keyId=this.value;mstrmojo.all[A].enableInput(!!this.selectedIndex);K();},updateKeys:function(c){var d=mstrmojo.all[D].getAllItems(),Y=[];O.forEach(d,function Z(g){Y.push(g.col);});var f=O.filter(Y,function X(h){var g=I(h);return ~O.indexOf(S,g);});f.splice(0,0,R);f.splice(0,0,B);var e=V.cubeConfig.distInfo;var a=0;if(e&&e.keyId){var b;for(b=0;b<f.length;b++){if(f[b].id===e.keyId){a=b;break;}}}this.defaultSelection=a;O.forEach(f,function(g){g.alias=N.htmlAngles(g.alias);});this.items=f;if(c===true){this.paint();}return a;}},{scriptClass:"mstrmojo.Label",cssClass:"distribution-number-caption",text:mstrmojo.desc(13913,"Number of Partition")},{scriptClass:"mstrmojo.TextBox",id:A,cssClass:"mstrmojo-di-distribution-number-input",type:mstrmojo.dom.isIE9?"text":"number",value:0,max:128,min:2,tooltip:mstrmojo.desc(12954,"Enter an integer between 2 and 128"),valueChangeDelay:1000,validateInput:function M(X){if(this.enabled){if(X>this.max){this.set("value",this.max);}else{if(X!==""&&X<this.min){this.set("value",this.min);}}}},onvalueChange:function(X){if(this._super){this._super();}var Y=X.value;if(Y===""){return ;}this.validateInput(Y);V.cubeConfig.distInfo.pf=this.value;K();},onblur:function H(){if(this.value<this.min){this.set("value",this.min);V.cubeConfig.distInfo.pf=this.value;}},enableInput:function G(X){if(this.enabled!==X){this.set("enabled",X);if(X){this.set("value",4);}else{this.set("value",0);}}},postCreate:function(){this._super();this.set("value",V.cubeConfig.distInfo.pf);},postBuildRendering:function W(){if(this._super){this._super();}if(mstrmojo.all[J].defaultSelection===0){this.set("enabled",false);}}}]}]},{scriptClass:"mstrmojo.HBox",cssClass:"attribute-metric-box",cellPadding:5,children:[{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",cssClass:"mstrmojo-di-all-objects-grid",id:D,type:"amps"},{scriptClass:"mstrmojo.DI.DIAllObjectsGrid",cssClass:"mstrmojo-di-all-objects-grid",id:C,type:"mtmps"}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.WidgetTree","mstrmojo.Container","mstrmojo._DocToolbarActions","mstrmojo.DI.DIDatabaseHelper","mstrmojo.DI.DIHelpers","mstrmojo.onetier.vi.ui.DBCredentialEditor");mstrmojo.requiresDescs(221,3958,4444,7776,8516,8519,8533,8534,8541,8545,8552,8553,8556,8558,8560,8561,8708,9149,9213,10056,10058,10059,10062,12450,12991,12995,12997,12998,13107,13223,13224,13225,13980,13981,15517,14285,14286,14287,14328);var H=mstrmojo.array;var D=mstrmojo.hash;var A=mstrmojo.DI.DIDatabaseHelper;var I=mstrmojo.DI.DIHelpers;var C=30,B=function(K){return K.name||K.n;},E=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsTable",data:null,cssClass:"dataset-table",markupString:'<div id="{@id}" class="cf {@cssClass}" ><div class="dataset-table-status"></div><div></div><div></div></div>',markupSlots:{tableNode:function(){return this.domNode.children[1];},statusNode:function(){return this.domNode.children[0];},buttonNode:function(){return this.domNode.children[2];}},children:[{scriptClass:"mstrmojo.Label",slot:"tableNode",bindings:{text:function(){var K=B(this.parent.data);if(K.length>C){K=K.substr(0,C)+"...";}return K;},title:function(){var L="",K=B(this.parent.data);if(K.length>C){L=K;}return L;},cssClass:function(){var K="table-font-credentials-not-fetched";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.domNode,K);K="";}else{mstrmojo.css.addClass(this.domNode,K);}return"dataset-table-name "+K;}}},{scriptClass:"mstrmojo.Label",slot:"statusNode",tableStatusClass:{"0":"","1":"waiting","2":"finished","3":"warning"},bindings:{cssClass:function(){var K;if(this.parent.data.credentialsFetched){K=this.tableStatusClass[2];}else{if(this.parent.data.credentialsFetched===false){K=this.tableStatusClass[3];}else{K=this.tableStatusClass[0];}}mstrmojo.css.addClass(this.domNode,K);return K;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.data.credentialsFetched?mstrmojo.desc(14286,"Edit Credentials"):mstrmojo.desc(14287,"Input Credentials");},innerIconClass:function(){var K="button-font-input";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.textNode,K);K="";}else{mstrmojo.css.addClass(this.textNode,K);}return K;},visible:function(){return this.parent.idx===0;}},slot:"buttonNode",onclick:function(){var O=this.parent,Q=O.data,R=[Q.did],M=mstrApp.getRootController(),P=A.getOASTFromBEST(Q.dict);if(P>=0){if(!(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier||I.isServerBasedWS())){mstrmojo.alert(mstrmojo.desc(15600,"We are unable to connect to this data source because your web server is not set up for HTTPS connections. Please contact your administrator."));return ;}var K=M;if(!(M instanceof mstrmojo.DI.DIRootController)){var L={model:mstrmojo.all.CDDIModel||new mstrmojo.DI.DIModel({id:"CDDIModel"}),scriptClass:"mstrmojo.DI.DIRootController"};K=M.CDDIcontroller=mstrmojo.insert(L);K.addDisposable(mstrmojo.all.CDDIModel);O.addDisposable(K);K.oAuthController=new mstrmojo.DI.controller.DIOAuthController();K.dataService=new mstrmojo.DI.DIDataService();K.model.populateExternalSources();}K.setTableIDsForOAuth(R);K.gotoOAuthLogin(P,null,null,{success:function(){Q.set("credentialsFetched",true);}});}else{var N=Q.dbRole.dbmsObj;if(N.DBInfo.driverInstalled){new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:Q,zIndex:this.parent.parent.tree.parent.zIndex+1}).open();}else{mstrmojo.alert(mstrmojo.desc(14328,"There is no driver installed for ##. Please install it and try again.").replace("##",N.n));}}}}]});var G={IN_MEMORY:1,DIRECT_ACCESS:2};function J(L){var K=[];H.forEach(L,function(N){if(N.dsm===G.IN_MEMORY){return ;}var M=D.copy(N);M.tables=H.filter(M.tables,function(O){return !!O.dbRole;});if(M.tables.length){K.push(M);}});return K;}mstrmojo.DI.ui.dialogs.DICredentialsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsDialog",title:mstrmojo.desc(14285,"Connection Information"),cssClass:"mstrmojo-di-credentials-dialog",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var L=this.parent.parent,K=true;if(L.onOK){K=L.onOK();}if(K){L.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var L=this.parent.parent,K=true;if(L.onCancel){K=L.onCancel();}if(K){L.close();}}}],onOpen:function(){var K=this.filterDatasets?J.call(this,this.model.datasets):this.model.datasets;this.set("items",K);if(this._super){this._super();}},onOK:function(){mstrApp.getRootController().wrapUpDataImport();this.onOkAction=true;return true;},onCancel:function(){if(mstrApp.isSingleTier){mstrApp.serverRequest({taskId:"authenticationCancelled"},null,{doNotHold:true});}return true;},onClose:function(){window.setTimeout(function(){if(mstrApp.container){mstrApp.container.close();}},0);if(!mstrApp.isSingleTier&&!this.onOkAction){mstrmojo._DocToolbarActions.close.call({model:{mid:mstrApp.docModelData.mid,bs:mstrApp.docModelData.bs}});}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",text:mstrmojo.desc(15517,"Please enter credentials used to create these datasets in order to access the following datasets in the dossier:")},{scriptClass:"mstrmojo.WidgetTree",bindings:{items:"this.parent.items"},itemIdField:"did",itemDisplayField:"name",itemChildrenField:"tables",cssClass:"datasets-list",itemFunction:function F(N,L,M){var K=M.tree||M;return new mstrmojo.TreeNode({idx:L,data:N,state:1,parent:M,tree:K,multiSelect:M.multiSelect,text:N[M.itemDisplayField],textCssClass:K.item2textCss(N),items:N[M.itemChildrenField],itemIdField:M.itemIdField,itemDisplayField:M.itemDisplayField,itemIconField:M.itemIconField,itemChildrenField:M.itemChildrenField,itemFunction:function(Q,O,P){return new E({idx:O,data:Q,parent:P});},listSelector:M.listSelector});}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefineModel","mstrmojo.Refine.RefineController");var C=mstrmojo.DI.DIConstants;mstrmojo.Refine.Refine=mstrmojo.declare(mstrmojo.Obj,null,{start:function D(F,E,G){this.isBDE=false;var H=mstrApp.getRootController().model.importSources[G];if(H.type===C.sourceType.hadoop&&H.subtype===C.sourceSubtype.hadoop){this.isBDE=true;}if(!this.rootController){this.rootController=new mstrmojo.Refine.RefineController({model:new mstrmojo.Refine.RefineModel({projectID:E}),tableID:G});}else{this.rootController.model.projectID=E;this.rootController.model.columns={};this.rootController.model.data={};this.rootController.model.history={};this.rootController.model.operations={entries:[]};this.rootController.model.start=0;this.rootController.tableID=G;this.rootController.model.sampleStatus=null;}this.rootController.start(F);},getRefinePanel:function A(){return this.rootController.getRefinePanel();},stop:function B(){}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Splitter","mstrmojo.DI.DIPreviewSimple","mstrmojo.DI.DISearchBox");mstrmojo.requiresDescs(10,12882);var F="firstSplitNode",J="secondSplitNode",D={firstSplit:{v:"25%",min:"200px",max:undefined},secondSplit:{v:"75%",min:"150px",max:undefined},resizeHandle:{v:"2px"}};mstrmojo.DI.DISearchBoxPage=mstrmojo.declare(mstrmojo.ui.Splitter,null,{orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,showOperators:true,showAdvancedOptions:false,showFetchOptions:false,tableID:"",searchPanel:undefined,previewPanel:undefined,advancedProperties:undefined,headerLabelText:mstrmojo.desc(10,"Search"),placeHolderText:mstrmojo.desc(10,"Search"),searchTerm:undefined,iconCssClass:"",noDataErrorString:mstrmojo.desc(12882,"No data was returned, please try another search string."),hideSignout:false,searchBoxHint:"",config:{firstSplit:{v:"100%",min:"200px",max:undefined},secondSplit:{v:"0%",min:"0px",max:undefined},resizeHandle:{v:"0px"}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onSearchClick:function L(N){if(this.searchPanel&&this.searchPanel.searchFieldNode){this.searchPanel.searchFieldNode.blur();}},handleSearchChange:function B(N){this.searchText=this.searchPanel.getSearchQuery();if(N.e.keyCode===13&&this.searchText!==""){this.onSearchClick(this.searchText);}},refreshSearch:function H(){if(this.searchParam!==undefined){this.searchPanel.searchFieldNode.value=this.searchParam;}if(this.fetchNum){this.searchPanel.fetchNode.children[0].value=this.fetchNum;}},updatePageLayout:function M(){this.searchPanel.updateLayout();},toggleDataPreview:function C(N){this.refreshConfig();this.updatePageLayout();this.toggleSecondItemVisibility(N);},children:[{scriptClass:"mstrmojo.DI.DISearchBox",alias:"searchPanel",bindings:{headerLabelText:function(){return this.parent.headerLabelText;},placeHolderText:function(){return this.parent.placeHolderText;},showOperators:function(){return this.parent.showOperators;},showFetchOptions:function(){return this.parent.showFetchOptions;},showAdvancedOptions:function(){return this.parent.showAdvancedOptions;},noDataErrorString:function(){return this.parent.noDataErrorString;},hideSignout:function(){return this.parent.hideSignout;},hint:function(){return this.parent.searchBoxHint;},iconCssClass:function(){return this.parent.iconCssClass;}},slot:F},{scriptClass:"mstrmojo.DI.DIPreviewSimple",slot:J,alias:"previewPanel"}],setDimensions:function I(R,O){var P,N=parseInt(R,10),Q=parseInt(O,10);if(isNaN(N)||isNaN(Q)){return ;}if(this._super){this._super(R,O);}this.set("height",R);this.set("weight",O);if(!this.children){return ;}for(P=0;P<this.children.length;P++){if(this.children[P].setDimensions){this.children[P].setDimensions(R,O);}else{this.children[P].set("height",R);this.children[P].set("weight",O);}}},browserResized:function(Q,O){var P=parseInt(Q,10)+"px",N=parseInt(O,10)+"px";if(this.height&&N!==this.height){this.set("height",N);}else{this.height=N;}if(this.width&&P!==this.width){this.set("width",P);}else{this.width=P;}return true;},updatePageConfig:function(N){var O=this;if(N&&N.properties){mstrmojo.hash.forEach(N.properties,function(Q,P){O.set(P,Q);});}},populate:function E(N){if(N&&N.targetPageId){if(N.targetPageId!==this.id){return ;}}this.searchPanel.populate(N);},postBuildRendering:function A(){if(this._super){this._super();}this.browserResized(this.domNode.parentNode.style.width,this.domNode.parentNode.style.height);mstrApp.getRootController().model.externalSources[this.sourceObjectsInfo.type].attachEventListener("oAuthReportsFetched",this.id,this.populate);},getTableId:function K(){var N=this.tableID;if(N===""){N=this.searchPanel.previewTableId;}return N;},refreshConfig:function G(){this.config=D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.elementHelper","mstrmojo.func","mstrmojo.VisEnum","mstrmojo.num","mstrmojo.array","mstrmojo.VisMenuList","mstrmojo.mstr.EnumFunction","mstrmojo._HasMarkup","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.models.FormatModel","mstrmojo._FormatDefinition","mstrmojo.css","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.chart.model.enums.EnumDSSBaseFormType","mstrmojo.string","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui.rw.GhostImageContainer","mstrmojo.vi.ui.rw.FreezingImageContainer");mstrmojo.requiresClsP("mstrmojo.ui.menus","MenuConfig","EditorConfig");var N=document.getElementById("vis-measure-canvas"),E=document.getElementById("vis-measure-span"),f={},M={},q={},AF=mstrmojo.dom,d=mstrmojo.elementHelper,AW=mstrmojo.vi.ui.DatasetUnitMenuUtils,V=mstrmojo.VisEnum.EnumColorRankMode,p=mstrmojo.chart.model.enums.EnumDSSObjectType,AO=mstrmojo.chart.model.enums.EnumDSSBaseFormType,AU=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,AY=mstrmojo.chart.enums.EnumFontStyle,X=mstrmojo.hash,c=mstrmojo.string,Af=mstrmojo.func.wrapMethods,Z=mstrmojo.VisEnum,Q=mstrmojo._FormatDefinition,Ai=Z.SERVER_JSON_ERROR_TYPE,z=mstrmojo.vi.viz.EnumVizStyles,AP=mstrmojo.vi.enums.EnumFeatures,D=mstrmojo.vi.ui.rw.FreezingImageContainer,Ad=mstrmojo.vi.ui.rw.GhostImageContainer;var w=64,AH=128,C=4,AB=5,b=6,F=7,e=mstrmojo,S=e.array,Ag=mstrmojo.array,A=e.desc,j=e.mstr.EnumFunction,U=mstrmojo.vi.enums.EnumDerivedElementType,Ab=e._HasMarkup,Ae=e.css;var P;mstrmojo.requiresDescs(221,358,1422,2122,6017,5868,5869,11819,11827);function Ah(An,Am){var Al=mstrmojo.VisUtility;var Ao=Al.pluck(Am,"tid"),Ap=Al.pluck(Am,"eid"),Ak=(An.getDocModel&&An.getDocModel())||Al.getPropertyByPath(An,"model.docModel");if(Al.getPropertyByPath(Ak,"getColorBy") instanceof Function){return Ak.getColorBy(Ao,Ap);}}function Ac(Ak,Am,Ao){var An=Am.id,Al=Am.getHost();if(Al&&Al.observableModel){Ak.forEach(function(Aq){var Ap=Al.observableModel[Aq];if(Ap){Ap.attachEventListener("valueChanged",An,Ao);}});}}function Aj(Al){var Ak={SINGLE:[{text:A(358,"Absolute"),value:j.FunctionAbs,n:A(358,"Absolute"),v:j.FunctionAbs}],PAIR:[{text:A(6017,"Add"),value:j.FunctionAdd,n:A(6017,"Add"),v:j.FunctionAdd},{text:A(2122,"Average"),value:j.FunctionAverage,n:A(2122,"Average"),v:j.FunctionAverage},{text:A(5868,"Least"),value:j.FunctionLeast,n:A(5868,"Least"),v:j.FunctionLeast},{text:A(5869,"Greatest"),value:j.FunctionGreatest,n:A(5869,"Greatest"),v:j.FunctionGreatest},{text:"A-B",value:j.FunctionMinus+";0",n:"A-B",v:j.FunctionMinus+";0"},{text:"B-A",value:j.FunctionMinus+";1",n:"B-A",v:j.FunctionMinus+";1"},{text:"A/B",value:j.FunctionDivide+";0",n:"A/B",v:j.FunctionDivide+";0"},{text:"B/A",value:j.FunctionDivide+";1",n:"B/A",v:j.FunctionDivide+";1"}],MORE:[{text:A(6017,"Add"),value:j.FunctionAdd,n:A(6017,"Add"),v:j.FunctionAdd},{text:A(2122,"Average"),value:j.FunctionAverage,n:A(2122,"Average"),v:j.FunctionAverage},{text:A(5868,"Least"),value:j.FunctionLeast,n:A(5868,"Least"),v:j.FunctionLeast},{text:A(5869,"Greatest"),value:j.FunctionGreatest,n:A(5869,"Greatest"),v:j.FunctionGreatest}]};return Ak[Al];}function AT(Al,Ak){return !!(((Al&&Al.at)||0)&Ak);}function Y(Ak){return !Ak.cmSelCells.some(function(Al){var Am=Ak.getCellForNode(Al);return d.isNonGroupNull(Am)||!AT(Am,w)||Am.dei!==undefined||Ak.model.isRecursiveAttribute(Am.tid);});}function l(Al){var Ak;return !Al.cmSelCells.some(function(Am){Ak=Al.getCellForNode(Am);return(d.isNonGroupNull(Ak)||!AT(Ak,AH))||Al.model.isRecursiveAttribute(Ak.tid);});}function W(An,Am,Ap,Ao,Al){var Ak=Ap&&Ap.func;if((Ak===Ao)||(typeof Ao==="string"&&Ao.indexOf(Ak)===0&&Ao.indexOf(";0")>0)){return ;}if(Al){An.editDECalculation(Am,Ao);}else{An.derivedElementCalculation(Am,Ao);}}function m(Aw,Au,As){var Av=Au&&Au.es,Ak=(Av&&Av.length)||Aw.cmSelCells.length,An=(Ak===1)?"SINGLE":((Ak===2)?"PAIR":"MORE"),At=Aj(An),Am=(Au&&Au.func),Ao,Ax=Aw.cmSelCells,Al,Ar,Aq,Ap;if(An==="PAIR"){if(Au){Ap=Av[0].v>Av[1].v;if(Ap){Aq=Av[0].n;Ar=Av[1].n;At[4]={value:j.FunctionMinus+";1",v:j.FunctionMinus+";1"};At[5]={value:j.FunctionMinus+";0",v:j.FunctionMinus+";0"};At[6]={value:j.FunctionDivide+";1",v:j.FunctionDivide+";1"};At[7]={value:j.FunctionDivide+";0",v:j.FunctionDivide+";0"};}else{Ar=Av[0].n;Aq=Av[1].n;}}else{Ar=As(Ax[0]);Aq=As(Ax[1]);}At[C].text=Ar+" - "+Aq;At[AB].text=Aq+" - "+Ar;At[b].text=Ar+" / "+Aq;At[F].text=Aq+" / "+Ar;At[C].n=Ar+" - "+Aq;At[AB].n=Aq+" - "+Ar;At[b].n=Ar+" / "+Aq;At[F].n=Aq+" / "+Ar;}for(Ao in At){if(typeof At[Ao].value==="string"&&At[Ao].value.indexOf(Am)===0&&At[Ao].value.indexOf(";0")>0){Al=At[Ao];break;}if(At[Ao].value===Am){Al=At[Ao];break;}}return{items:At,selectedItem:Al};}function x(Ak,An){if(!Ak){return Ak;}if(An.length===1){return Ak[An[0]];}var Am=(An&&An.length)||0,Al;for(Al=0;Al<Am;Al++){Ak=Ak[An[Al]];if(!Ak){break;}}return Ak;}function AV(Am,Al,Ak){return Am.every(function(An){return An.ttp===Al||An.ttp===Ak;});}function G(Al,Ao,Ap){var An=(Ao&&Ao.length)||0,Am,Ak,Aq=Al;for(Am=0;Am<An-1;Am++){Ak=Ao[Am];if(!Aq[Ak]){Aq[Ak]={};}Aq=Aq[Ak];}Aq[Ao[An-1]]=Ap;}function AE(As){var At,Ar,An,Ap,Ak,Aq=this.model.docModel.datasets,Al=false,Ao=false,Am={isDM:false};for(At in Aq){if(Aq.hasOwnProperty(At)){Ar=Aq[At].mx;S.forEach((Ar||[]),function(Au){if(Au.did===As){if(Au.um||Au.rdm){Ao=true;}Al=true;return false;}});if(Al){break;}}}if(Ao){Ak=this.model.data.gts.col;An=(Ak&&Ak[Ak.length-1]);if(An&&An.otp===-1){Ap=An.es;}S.forEach((Ap||[]),function(Au){if(Au.oid===As){Am={isDM:true,id:Au.id};return false;}});}return Am;}function L(Ak,An){var Aq=[],Am={act:"updateElementsPropertiesMap",epm:Aq},Ao=[],Al={},As=[Al],Ar=this;Aq.push({epmk:Ao,epmv:As});Ak.forEach(function(Au){var Av=Au.tid,Ax=Au.tp,At=Av===-1,Aw={ob:{did:At?"":Av,tp:Ax}};Ao.push(Aw);});if(An&&An.indexOf("default")<0){Al.v={vv:An};}var Ap=[];Al.k={chn:Ap};Ak.forEach(function(Av){var Aw=Av.tid,At=Aw===-1,Au;if(At){Au=AE.call(Ar,Av.eid);if(Au.isDM){Ap.push({emt:2,ei:Au.id});}else{Ap.push({emt:2,mt:{did:Av.eid,tp:4,ql:0}});}}else{Ap.push({emt:1,ei:Av.eid,at:{did:Aw,tp:Av.tp,ql:0}});}});return Am;}function AQ(Ao,Am){var An="00000000000000000000000000000000",Al=Ao&&Ao.dropZones,Ak=S.find(Al,"id",Am);return Ak===-1?[]:S.filter(Al[Ak].items,function(Ap){return Ap.t===4&&Ap.id!==An;});}function AK(Ap,Am,Ao,Al,Ak){var Aq=Al?Ap:Ap&&Ap.parentNode;while(Aq&&(Aq!==Ak)){var An=Aq.getAttribute&&Aq.getAttribute(Am);if(An!==null&&An.indexOf(Ao)>=0){return true;}Aq=Aq.parentNode;}return false;}function AD(Al,Am){var Ak=X.walk("rootCtrl.docCtrl",mstrApp);if(Ak&&(typeof Ak.selectViPanel==="function")){Ak.selectViPanel(Am);}Al.getDocModel().selectVIUnit(Al.parent.id,true);}var H={sessions:{},instances:[],init:function AL(){this.supportedEventTypes=[];if(window.TouchEvent){this.supportedEventTypes.push("TouchEvent");}else{if(window.PointerEvent){this.supportedEventTypes.push("PointerEvent");}}if(window.MouseEvent){this.supportedEventTypes.push("MouseEvent");}return this;},startNewSessions:function AI(Ak){var Ao=this;var Am=this;var Al=document;var An=function(Ay){var At=Ak.callbacks.start.bind(Ak.callbackThis),Au=Ak.callbacks.change.bind(Ak.callbackThis),Av=Ak.callbacks.end.bind(Ak.callbackThis),Ax=Ak.callbacks.context;var Aq={};Aq.identifier=Ay.identifier;Aq.context=X.clone(Ax);Aq.clientX=Ay.clientX;Aq.clientY=Ay.clientY;var As=function As(Az){var A0=this.context;return At({api:Am,event:Az,session:this,context:A0});};var Aw=function Aw(A0,Az){var A1=this.context,A3=0,A2=0;A3=Az.clientX-this.clientX;A2=Az.clientY-this.clientY;this.clientX=Az.clientX;this.clientY=Az.clientY;var A4={api:Am,event:A0,deltaX:A3,deltaY:A2,session:this,context:A1};return Au(A4);};var Ar=function Ar(Az){var A0=this.context;return Av({api:Am,event:Az,session:this,context:A0});};Aq.onStart=As;Aq.onChange=Aw;Aq.onEnd=Ar;return Aq;};var Ap=function(Ar,Aq){Ar.listeners={};Ar.listeners.change=function(As){var At=Ao.getChangedSessions(As);for(var Au=0;Au<At.length;Au++){if(Ar.identifier===At[Au].identifier){return Ao.sessions[Ar.identifier].onChange(As,At[Au]);}}};Ar.listeners.end=function(At){var Au=Ao.getChangedSessions(At);for(var Av=0;Av<Au.length;Av++){if(Ar.identifier===Au[Av].identifier){if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(Aq)){Al.removeEventListener("touchmove",Ar.listeners.change);Al.removeEventListener("touchend",Ar.listeners.end);Al.removeEventListener("touchcancel",Ar.listeners.end);}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(Aq)&&(Aq.pointerType&&Aq.pointerType!=="mouse")){Al.removeEventListener("pointermove",Ar.listeners.change);Al.removeEventListener("pointerleave",Ar.listeners.end);Al.removeEventListener("pointerup",Ar.listeners.end);}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(Aq)&&!Aq.pointerType){Al.removeEventListener("mousemove",Ar.listeners.change);Al.removeEventListener("mouseup",Ar.listeners.end);}}}var As=Ao.sessions[Ar.identifier].onEnd(At);delete Ao.sessions[Ar.identifier];return As;}}};if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(Aq)){Al.addEventListener("touchmove",Ar.listeners.change);Al.addEventListener("touchend",Ar.listeners.end);Al.addEventListener("touchcancel",Ar.listeners.end);}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(Aq)&&(Aq.pointerType&&Aq.pointerType!=="mouse")){Al.addEventListener("pointermove",Ar.listeners.change);Al.addEventListener("pointerleave",Ar.listeners.end);Al.addEventListener("pointerup",Ar.listeners.end);}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(Aq)&&!Aq.pointerType){Al.addEventListener("mousemove",Ar.listeners.change);Al.addEventListener("mouseup",Ar.listeners.end);}}}};return function(As){var At=Ao.getChangedSessions(As),Ar=Ao.sessions,Au=At.filter(function(Av){if(Ar[Av.identifier]){return false;}else{return true;}});Au.forEach(function(Av){Ao.sessions[Av.identifier]=An(Av);Ap(Ao.sessions[Av.identifier],As);});var Aq=[];Au.forEach(function(Av){Aq.push(Ao.sessions[Av.identifier].onStart(As));});return Aq;};},newInstance:function AN(An,Aq,Ap){var Am,Al,Ak=this.getInstanceIndex(An);if(Ak!==-1){for(Am=0;Am<this.supportedEventTypes.length;Am++){Al=this.supportedEventTypes[Am];if(Al==="TouchEvent"){An.removeEventListener("touchstart",this.instances[Ak].starter);}else{if(Al==="PointerEvent"){An.removeEventListener("pointerdown",this.instances[Ak].starter);}else{if(Al==="MouseEvent"){An.removeEventListener("mousedown",this.instances[Ak].starter);}}}}delete this.instances[Ak];}var Ao={domNode:An,callbacks:Aq,callbackThis:Ap};Ao.starter=this.startNewSessions(Ao);if(Ak!==-1){this.instances[Ak]=Ao;}else{this.instances.push(Ao);}for(Am=0;Am<this.supportedEventTypes.length;Am++){Al=this.supportedEventTypes[Am];if(Al==="TouchEvent"){An.addEventListener("touchstart",Ao.starter);}else{if(Al==="PointerEvent"){An.addEventListener("pointerdown",Ao.starter);}else{if(Al==="MouseEvent"){An.addEventListener("mousedown",Ao.starter);}}}}return this;},getInstanceIndex:function J(Ak){return S.find(this.instances,"domNode",Ak);},getInstance:function o(Al){var Ak=this.getInstanceIndex(Al);return this.instances[Ak];},getChangedSessions:function AG(Ak){var Al=[];if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(Ak)){var Ao=Ak.changedTouches;for(var Am=0;Am<Ao.length;Am++){var An={};An.identifier=Ao[Am].identifier;An.clientX=Ao[Am].clientX;An.clientY=Ao[Am].clientY;Al.push(An);}}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(Ak)&&(Ak.pointerType&&Ak.pointerType!=="mouse")){Al.push({identifier:Ak.pointerId,clientX:Ak.clientX,clientY:Ak.clientY,});}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(Ak)&&!Ak.pointerType){Al.push({identifier:"mouse",clientX:Ak.clientX,clientY:Ak.clientY,});}}}return Al;}};var u=H.init();mstrmojo.VisUtility=mstrmojo.provide("mstrmojo.VisUtility",{getCache:function(){return JSON.stringify(q);},getUpdateColorMapAction:function(Al,Ak){return L.call(this,Al,Ak);},measureTextSize:function(Al,Ak,Am){return{width:this.measureTextWidth(Al,Ak,Am),height:this.measureTextHeight(Al,Ak,Am)};},measureTextWidth:function(An,Am,Ao,Al,Ak){if(AF.isIE||AF.isIEW3C){return this.measureTextWidthWithSpan(An,Am,Ao,Al,Ak);}return this.measureTextWidthWithCanvas(An,Am,Ao);},measureTextWidthWithCanvas:function(An,Ao,Ar,Ap){Ap=Ap||false;if(An===""){return 0;}if(An===" "){An="\u00A0";}var Aq=Ao.fontFamily,At=Ao.fontSize,Am=Ao.fontStyle,As=Ao.fontWeight;if(typeof At==="number"){At+="pt";}Am=Am||"normal";As=As||"normal";Ar=Ar||0;var Al=Ap?undefined:x(f,[Aq,At,Am,As,An]);if(!Al){if(!N){N=document.createElement("canvas");N.width=0;N.height=0;N.id="vis-measure-canvas";N.style.position="absolute";N.style.top="0";N.style.fontSize="medium";document.body.appendChild(N);}var Ak=N.getContext("2d");Ak.font=Am+" "+As+" "+At+" "+this.surroundWithQuotes(Aq);Al=Math.ceil(Ak.measureText(An).width);G(f,[Aq,At,Am,As,An],Al);}return Al+Ar;},measureTextWidthQuick:function(An,Ao,Ar,Ap){Ap=Ap||false;if(An===""){return 0;}if(An===" "){An="\u00A0";}var Aq=Ao.fontFamily,At=Ao.fontSize,Am=Ao.fontStyle,As=Ao.fontWeight;if(typeof At==="number"){At+="pt";}Am=Am||"normal";As=As||"normal";Ar=Ar||0;var Al=Ap?undefined:x(f,[Aq,At,Am,As,An]);if(!Al){if(!N){N=document.createElement("canvas");N.width=0;N.height=0;N.id="vis-measure-canvas";N.style.position="absolute";N.style.top="0";N.style.fontSize="medium";document.body.appendChild(N);}var Ak=N.getContext("2d");Ak.font=Am+" "+As+" "+At+" "+this.surroundWithQuotes(Aq);Al=Math.ceil(Ak.measureText(An).width);G(f,[Aq,At,Am,As,An],Al);}return Al+Ar;},measureTextWidthWithSpan:function(An,Ao,As,Au,Ap,Ak){if(An===""){return 0;}if(An===" "){An="\u00A0";}var Aq=Ao.fontFamily,Av=Ao.fontSize,Am=Ao.fontStyle,Ar=Ao.fontWeight;if(typeof Av==="number"){Av+="px";}Am=Am||"normal";Ar=Ar||"normal";Au=Au||"auto";As=As||0;Ap=!!Ap;if(typeof Au==="number"){Au+="px";}var Al=x(M,[Aq,Av,Am,Ar,Au,An]);if(!Al||Ak){var At;if(!E){E=document.createElement("span");At=E.style;E.id="vis-measure-span";At.position="absolute";At.top="0";At.visibility="hidden";At.width="auto";At.height="auto";if(Ap){At.whiteSpace="nowrap";}else{At.whiteSpace="normal";}document.body.appendChild(E);}At=E.style;if(Ap){At.whiteSpace="nowrap";}else{At.whiteSpace="normal";}At.width="auto";At.height=Au;At.fontFamily=this.surroundWithQuotes(Aq);At.fontSize=Av;At.fontStyle=Am;At.fontWeight=Ar;E.innerHTML=c.encodeHtmlString(An);Al=Math.ceil(E.clientWidth);G(M,[Aq,Av,Am,Ar,Au,An],Al);}return Al+As;},measureTextHeight:function(Am,An,As,Av,Ak,Ap,Ao){if(Am===""){return 0;}if(Am===" "){Am="\u00A0";}var Aq=An.fontFamily,Ax=An.fontSize,Al=An.fontStyle,Ar=An.fontWeight,Au=An.lineHeight||"inherit";Ak=Ak||"normal";Ao=!!Ao;if(typeof Ax==="number"){Ax+="px";}Al=Al||"normal";Ar=Ar||"normal";Av=Av||"auto";As=As||0;if(typeof Av==="number"){Av+="px";}var Aw=Ap?undefined:x(q,[Aq,Ax,Al,Ar,Av,Am]);if(!Aw){var At;if(!E){E=document.createElement("span");At=E.style;E.id="vis-measure-span";At.position="absolute";At.top="0";At.visibility="hidden";At.width="auto";At.height="auto";if(Ao){At.whiteSpace="nowrap";}else{At.whiteSpace="normal";}document.body.appendChild(E);}At=E.style;if(Ao){At.whiteSpace="nowrap";}else{At.whiteSpace="normal";}At.heigth="auto";At.width=Av;At.lineHeight=Au;At.fontFamily=this.surroundWithQuotes(Aq);At.fontSize=Ax;At.fontStyle=Al;At.fontWeight=Ar;At.wordBreak=Ak;E.innerHTML=c.encodeHtmlString(Am);Aw=E.clientHeight;if(!Ap){G(q,[Aq,Ax,Al,Ar,Av,Am],Aw);}}return Aw+As;},getVisEmptyMsg:function(Ak,Al){var Am="";switch(Ak){case"AE_ERROR":Am='<div class="gm-vis-msg-container"><div class="gm-vis-msg-vcenter"><div class="gm-vis-msg-hcenter"><div style="padding:25px"><div class="gm-warning-icon" style="padding-bottom:18px"></div><div style="padding-bottom:8px">'+(Al||this.errorMsg||"")+"</div><div></div></div></div></div></div>";break;case"NODATA_OTHERERROR":Am='<div class="error-msg"><div class="error-content"><div class="text" style="visibility: visible;padding-top:0px;"><div>'+(this.errorMsg||mstrmojo.desc(2388,"No data returned for this view. This might be because the applied filter excludes all data."))+"</div></div></div></div>";break;default:Am='<div class="mstrmojo-Label dropMsg" style="display: block;" >'+mstrmojo.desc(11668,"Drag objects here.")+"</div>";}return Am;},getVisEmptyMsgControls:function B(){var Am=this.error,Ar,Ap=this.errorType,Al;var An=mstrmojo.VisUtility;if(this.excludeData){Ar=An.getVisStyle.call(this);var Ao=An.getAttMetricCount.call(this);return[{scriptClass:"mstrmojo.vi.ui.rw.FreezingImageContainer",cssClass:Ar,visName:mstrConfig.pluginsVisList[Ar]&&mstrConfig.pluginsVisList[Ar].d,visDropzoneMsg:D.getVisDropzoneMsg(Ao.attCount,Ao.metricCount)}];}if(!this.hasError()){return ;}switch(Ap){case Ai.NO_DATASET:case Ai.NO_TEMPLATE_UNIT:if(mstrApp&&mstrApp.supportFeature&&mstrApp.supportFeature(AP.SUPPORT_GHOST_IMG)){Ar=An.getVisStyle.call(this);var As="",Aq="",Ak="";if(Ar===z.HEAT_MAP){As="heatmap";Aq=mstrmojo.desc(11819,"Heat Map");Ak=Ad.getVisDesc("heatmap");}else{if(Ar===z.NETWORK){As="network";Aq=mstrmojo.desc(11827,"Network");Ak=Ad.getVisDesc("network");}else{if(Ar===z.KPICARD){As="kpicard";Aq=mstrmojo.desc(15800,"KPI");Ak=Ad.getVisDesc("kpicard");}}}Al=[{scriptClass:"mstrmojo.vi.ui.rw.GhostImageContainer",cssClass:As,visName:Aq,visDesc:Ak}];}else{Al=[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:Am}];}break;case Ai.AE_ERROR:Al=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:An.getVisEmptyMsg("AE_ERROR",Am),markupSlots:{containerNode:function(){return this.domNode;}}}];break;default:Al=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content" style="visibility: visible">'+Am+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;}}}];break;}return Al;},applyStyles2DomNode:function(Ap,As){var Ak,Aq=Ap.style;if(Object.prototype.hasOwnProperty.call(As,"backgroundColor")&&As.backgroundColor!==""&&As.backgroundColor!=="transparent"){var Ao=1;if(Object.prototype.hasOwnProperty.call(As,"opacity")&&As.opacity!==""){Ao=As.opacity;}var Al=As.backgroundColor,Ar=function Ar(At){if(isNaN(At)){At=0;}At%=16777216;return{b:At%256,g:(At>>8)%256,r:(At>>16)%256};},An="";if(Al){var Am=function Am(Au,Av){if(Au==="transparent"){return"rgba(0,0,0,0)";}Au=this.parseCSSColor(Au,false);var At=Ar(Au);return"rgba("+At.r+" ,"+At.g+" ,"+At.b+" ,"+Av+" )";}.bind(this);if(Al.c1!==undefined&&Al.c2!==undefined&&Al.or!==undefined){An=(Ae.buildGradient(Al.or,Am(Al.c1,Ao),Am(Al.c2,Ao))).v;}else{An=Am(Al,Ao);}Aq.background=An;}}else{Aq.backgroundColor="rgba(0,0,0,0)";}for(Ak in As){if(Ak!=="backgroundColor"&&Ak!=="opacity"&&Object.prototype.hasOwnProperty.call(As,Ak)&&As[Ak]&&As[Ak]!==""){Aq[Ak]=As[Ak];if(Ak==="fontFamily"){Aq[Ak]="'"+As[Ak]+"'";}}}},parseCSSColor:function(Ao,Al){var Ak,Am;if(Ao.length===7){if(Al===true){Ak=Ao[5]+Ao[6]+Ao[3]+Ao[4]+Ao[1]+Ao[2];}else{Ak=Ao.slice(1);}}else{Ak=[];var An=Ao.slice(1);if(Al===true){for(Am=2;Am>=0;Am--){Ak.push(An[Am]);Ak.push(An[Am]);}}else{for(Am=0;Am<3;Am++){Ak.push(An[Am]);Ak.push(An[Am]);}}Ak=Ak.join("");}return parseInt(Ak,16);},positionDomNode:function(Am,Ao){var Al,Ar,Ap,An=["width","height","top","left","right","bottom"],Aq=An.length,Ak=Am.style;for(Al=0;Al<Aq;Al++){Ar=An[Al];Ap=Ao[Ar];if(Ap!==undefined){if((typeof Ap)==="number"){Ap+="px";}Ak[Ar]=Ap;}}},getComputedFontStyle:function K(Am){var Ak=mstrmojo.css.getComputedStyle(Am);var An={};An.fontFamily=Ak.fontFamily;An.fontSize=Ak.fontSize;An.fontStyle=Ak.fontStyle;An.fontWeight=Ak.fontWeight;An.fontVariant=Ak.fontVariant;var Al=parseInt(Ak.paddingLeft)||0,Ao=parseInt(Ak.paddingLeft)||0;An.bonus=Al+Ao;return An;},splitWordIfTooLong:function(Au,As,An){var Aq=[];var Ar=Au.length;var Ao;for(Ao=0;Ao<Ar;Ao++){var Al=Au[Ao];while(true){var Av=this.measureTextWidth(Al,An);if(Av>As){var At=(As/Av)*Al.length;var Ak=Math.max(Math.round(At),1);while(Ak>0){var Ap=Al.substr(0,Ak);var Am=Math.round(this.measureTextWidth(Ap,An));if(Am<=As||Ak===1){Aq.push(Ap);break;}else{Ak--;}}Al=Al.substr(Ak,Al.length-Ak);}else{Aq.push(Al);break;}}}return Aq;},truncateTextToLineWithWordWrap:function k(BA,A3,A1,Aq,A2,Au){var Ay=BA.split(" "),A4=Ay.length;if(!Au){Ay=this.splitWordIfTooLong(Ay,A1,A3);}var BH,Aw=[],BC=[],Ak=0,Ao=Ay.length,BJ=this.measureTextWidth(" ",A3),An=0,At=false,A0=(A4===Ay.length);BC.push(0);for(BH=0;BH<Ao;BH++){var A8=this.measureTextWidth(Ay[BH],A3);if(!Au&&A8>A1){var Al=Ay[BH];var BF=(A1/A8)*Al.length;Ay[BH]=Al.substr(0,parseInt(BF,10));A8=A1;}Aw.push(A8);Ak+=A8;BC.push(Ak);if(BH!==Ao-1){Ak+=BJ;}}var BE,BG,A6=Aq;for(BE=0,BG=0;BG<BC.length;){var As=BC[BG]-BC[BE];if(BE>0&&BG!==BE){As-=BJ;}var Ar=BC[BG+1]-BC[BE];if(BE>0&&BG+1!==BE){Ar-=BJ;}if(As<=A1&&((BG+1===BC.length)||(Ar>A1))){An=Math.max(An,As);A6--;if(A6===0||BG===Ao){break;}else{BE=BG;BG++;}}else{BG++;}}if(BG>Ao){BG=Ao;}var Av=BC[BG]-BC[BE];if(BE>0&&BG!==BE){Av-=BJ;}var A9;if(BG>=Ao&&Av<A1){A9=Ay.join(" ");}else{At=true;An=A1;A9=Ay.slice(0,BG).join(" ");var Ax=this.measureTextWidth("...",A3);if(Av+Ax<=A1){if(Av+BJ+Ax>A1){A9+="...";}else{var BI=Ay[BG],Az;for(var A5=1;A5<BI.length;A5++){Az=this.measureTextWidth(BI.substr(0,A5),A3);if(Av+BJ+Az+Ax>A1){break;}}A9+=" "+BI.substr(0,A5-1)+"...";}}else{if(A9.charAt(A9.length-1)===" "){A9=A9.substr(0,A9.length-1);}var A7=A9.lastIndexOf(" ");var Am=A9.length-1-A7;if(Am===3){A9=A9.substr(0,A9.length-3)+" ...";}else{var BB=0,Ap="",BD=0;while(BB<Ax&&A9.length>BD){BD++;Ap=A9.substr(A9.length-BD,A9.length);BB=this.measureTextWidth(Ap,A3);}A9=A9.substr(0,A9.length-BD)+"...";}}}if(A2){return{text:A9,truncated:At,maxLineLen:An,canWordWrap:A0};}return A9;},measureSuperTextWidth:function AA(Al,Am,Ak,An){return Al?this.measureTextWidth("<sup>"+Am+"</sup>",Ak,An):this.measureTextWidth(Am,Ak,An);},splitTokenIfTooLong:function h(Av,At,An){var Ar=[];var As=Av.length;var Ao,Al,Aw,Aq,Ax;for(Ao=0;Ao<As;Ao++){Al=Av[Ao];Aq=Al.isSuper;while(true){Aw=Al.v;if(Al.textWidth!==undefined){Ax=Al.textWidth;}else{Ax=Al.textWidth=this.measureSuperTextWidth(Aq,Aw,An);}if(Ax>At){var Au=(At/Ax)*Aw.length;var Ak=Math.max(Math.round(Au),1);while(Ak>0){var Ap=Aw.substr(0,Ak);var Am=Math.round(this.measureSuperTextWidth(Aq,Ap,An));if(Am<=At||Ak===1){Ar.push({v:Ap,isSuper:Aq,textWidth:Am});break;}else{Ak--;}}Al={v:Aw.substr(Ak,Aw.length-Ak),isSuper:Aq};}else{Ar.push(Al);break;}}}return Ar;},truncateTextToLineWithWordWrapForTokens:function AZ(Au,Ao,BD,A5,BE,A0){var A8=Au.length;Au=this.splitTokenIfTooLong(Au,BD,Ao);var BC,Az=[],Ak=0,A3=Au.length,Al=0,A4=false,Aq=(A8===Au.length),As,Ax,A6,Am,BA,At,Ay;if(A0&&!Aq){return{canWordWrap:Aq};}Az.push(0);for(BC=0;BC<A3;BC++){As=Au[BC];A6=As.v;Ax=As.isSuper;if(As.textWidth!==undefined){Am=As.textWidth;}else{Am=As.textWidth=this.measureSuperTextWidth(Ax,A6,Ao);}if(Am>BD){var BB=(BD/Am)*A6.length;As.v=A6.substr(0,parseInt(BB,10));Am=As.textWidth=BD;}Ak+=Am;Az.push(Ak);}var Aw,A7,Av=A5;for(Aw=0,A7=0;A7<Az.length;){var Ar=Az[A7]-Az[Aw];var Ap=Az[A7+1]-Az[Aw];if(Ar<=BD&&((A7+1===Az.length)||(Ap>BD))){Al=Math.max(Al,Ar);Av--;if(Av===0||A7===A3){break;}else{Aw=A7;A7++;}}else{A7++;}}if(A7>A3){A7=A3;}var A2=Az[A7]-Az[Aw];var BF;if(A7>=A3&&A2<BD){BF=Au;}else{A4=true;Al=BD;BF=Au.slice(0,A7);var An=this.measureTextWidth("...",Ao);if(A2+An<=BD){At=Au[A7];A6=At.v;Ax=At.isSuper;for(BA=1;BA<A6.length;BA++){Ay=this.measureSuperTextWidth(Ax,A6.substr(0,BA),Ao);if(A2+An+Ay>BD){break;}}if(BA>1){As={v:A6.substr(0,BA-1),isSuper:Ax};As.textWidth=this.measureSuperTextWidth(Ax,As.v,Ao);BF.push(As);BF.push({v:"...",textWidth:An});}}else{var A1=0,A9;for(BC=BF.length-1;BC>=0;BC--){As=BF[BC];A6=As.v;Ax=As.isSuper;A9=0;for(BA=A6.length-1;BA>=0;BA--){A9=this.measureSuperTextWidth(Ax,A6.substr(BA),Ao);if(A1+A9>=An){break;}}if(BA>=0){break;}else{A1+=A9;}}if(BC>=0){if(BA>0){As.v=A6.substr(0,BA);As.textWidth=this.measureSuperTextWidth(Ax,As.v,Ao);BF=BF.slice(0,BC+1);}else{if(BA===0){BF=BF.slice(0,BC);}}BF.push({v:"...",textWidth:An});}else{BF=[{v:"...",textWidth:An}];}}}if(BE){return{text:BF,truncated:A4,maxLineLen:Al,canWordWrap:Aq};}return BF;},getRankMode:function O(Aq){var As=1,Ar=2,Ap=3,Al=4,An=5,Ak=6,Ao=7,Am=V.INVALID;if(Aq){if(AV(Aq,Ap,Ar)){Am=V.TOP_PERCENT;}else{if(AV(Aq,Ap,As)){Am=V.BOTTOM_PERCENT;}else{if(AV(Aq,Ak,Al)){Am=V.BOTTOM;}else{if(AV(Aq,Ak,An)){Am=V.TOP;}else{if(AV(Aq,Ao)){Am=V.VALUE;}}}}}}return Am;},getColorByTitle:function a(Al,Ak){if(Ak===V.BOTTOM_PERCENT||Ak===V.TOP_PERCENT){Al=mstrmojo.desc(2787,"Percentage of ##").replace("'##'",Al);}else{if(Ak===V.BOTTOM||Ak===V.TOP){Al=mstrmojo.desc(2788,"Rank of ##").replace("'##'",Al);}}return Al;},getColorByFormatStr:function g(Al,Ak){if(Ak===V.BOTTOM_PERCENT||Ak===V.TOP_PERCENT){Al="0%;(0%)";}else{if(Ak===V.BOTTOM||Ak===V.TOP){Al="";}}return Al;},getColorByItems:function Aa(Ak,Au,A1,Ax,As,Aq,Ay){var Aw=[],A2,Am,Ar=mstrmojo.num,Ap,At;if(Ak===undefined||Ak.length===0){return Aw;}var A4=true;if(Ak.length>1){if(Ak[0].ceil===Ak[1].flr){A4=false;}else{A4=true;}}for(A2=0;A2<Ak.length;A2++){var A3=Ak[A2],Ao={},Al=A3.ceil,A0=A3.flr;if((A2===0&&A4)||(A2===Ak.length-1&&!A4)){if(Au===V.BOTTOM_PERCENT||Au===V.TOP_PERCENT){Ao.flr=A0/100;Ao.ceil=1;}else{if(Au===V.TOP||Au===V.BOTTOM){A0+=1;Ao.flr=Math.floor(A0);Ao.ceil=As;}else{Ao.flr=A0;Ao.ceil=A1;}}At=Ao.ceil;}else{if((A2===0&&!A4)||(A2===Ak.length-1&&A4)){if(Au===V.BOTTOM_PERCENT||Au===V.TOP_PERCENT){Ao.flr=0;Ao.ceil=Al/100;}else{if(Au===V.TOP||Au===V.BOTTOM){Ao.flr=0;Ao.ceil=Math.floor(Al);}else{Ao.flr=Ax;Ao.ceil=Al;}}Ap=Ao.flr;}else{if(Au===V.BOTTOM_PERCENT||Au===V.TOP_PERCENT){A0=A0/100;Al=Al/100;}else{if(Au===V.TOP||Au===V.BOTTOM){A0+=1;A0=Math.floor(A0);Al=Math.floor(Al);}}Ao.flr=A0;Ao.ceil=Al;}}if(Au===V.TOP||Au===V.BOTTOM){Ao.ceil=Ao.ceil>As?As:Ao.ceil;}if(Aq){Ao.label=Ar.formatByMask(Aq,Ao.flr);if(Ao.flr!==Ao.ceil){Ao.label+=" - "+Ar.formatByMask(Aq,Ao.ceil);}}else{Ao.label=Ao.flr;if(Ao.flr!==Ao.ceil){Ao.label+=" - "+Ao.ceil;}}if(A3.fmt&&A3.fmt.bc){Ao.color=A3.fmt.bc;}else{Ao.color=Ay;}Aw.push(Ao);}Aw=Aw.filter(function(A5){return A5.flr<=A5.ceil&&!(A5.flr>At||A5.ceil<Ap);});if(Au!==V.VALUE){if(Aw[0]&&(Aw[0].label===0)){Aw.shift();}}if(Au===V.TOP||Au===V.BOTTOM){Am=As;}else{if(Aw.length>0){if(A4){Am=Aw[0].ceil-Aw[(Aw.length-1)].flr;}else{Am=Aw[(Aw.length-1)].ceil-Aw[0].flr;}}}var Az=0,Av,An;for(A2=0;A2<Aw.length;A2++){if(A2===Aw.length-1){Aw[A2].scopePercent=1-Az;}else{if(Au===V.TOP||Au===V.BOTTOM){An=Aw[A2].ceil-Aw[A2].flr+1;}else{An=Aw[A2].ceil-Aw[A2].flr;}Av=An/Am;Aw[A2].scopePercent=Av;Az+=Av;}}return Aw;},getDefaultColorByItems:function(An,Al,Am){var Ak={};Ak.label=Am+" - "+Al;Ak.flr=Am;Ak.ceil=Al;Ak.color=An;Ak.scopePercent=1;return[Ak];},getNumberFormat:function(An,Al){var Ao=An.nf,Am=An.gvs;function Ak(){var Ar=(Am&&Am.items&&Am.items[0]&&Am.items[0].items)||[],Aq=Ar[Al]||{},Ap=Aq.nfs;return typeof Ap==="string"?Ap:"";}if(Ao[Al]&&typeof Ao[Al].nfs!=="string"){Ao[Al].nfs=Ak();}return Ao[Al]&&Ao[Al].nfs;},hasOnlyMetricsOnColumn:function(Al){var Ak=(Al&&Al.gts&&Al.gts.col)||[];return Ak.every(function(Am){return Am.otp===p.DssTypeUnknown&&(Am.es||[]).every(function(An){return An.otp===p.DssTypeMetric;});});},hasNoMetricOnRow:function(Al){var Am=(Al&&Al.gts&&Al.gts.row)||[],Ak=function(An){return An.otp!==p.DssTypeMetric;};return Am.every(Ak);},getAttMetricCount:function(){var An=this.getEditingGridData&&this.getEditingGridData()||this.model&&this.model.data,Ar=An&&An.gsi,Aq=Ar&&Ar.rows||[],Am=Ar&&Ar.cols||[],Al=[].concat(Aq).concat(Am),Ap=Ar&&Ar.mx||[],Ak=0,Ao=Ap.length;Ag.forEach(Al,function(As){if(As.t!==p.DssTypeMetric){Ak++;}});return{attCount:Ak,metricCount:Ao};},isOnExpressMode:function(){return mstrApp.isExpress;},modifyScExp:function(As,Ak,Aw,Aq){if(!As||!Ak){return ;}var An=As.nds,Ar,Al,At,Av,Au,Ap,Ao,Am;Ag.forEach(An||[],function(Ax){Ar=Ax.nds;Ag.forEach(Ar||[],function(Ay){Al=Ay.es;Ag.forEach(Al||[],function(Az){Av=Az.v;Ap=Aq[Av];if(!Ap){Ap=Aw.getNormalizedFormElementId(Av);Aq[Av]=Ap;}Ag.forEach(Ak||[],function(A0){At=A0.es;Ag.forEach(At||[],function(A1){Am=false;Au=A1.id;if(Au===Av){Am=true;}else{Ao=Aq[Au];if(!Ao){Ao=Aw.getNormalizedFormElementId(Au);Aq[Au]=Ao;}if(Ap===Ao){Am=true;}}if(Am){Az.v=A1.id;Az.n=A1.n;return false;}});if(Am){return false;}});});});});},modifyScExpDeprecated:function(Aq,Ar,Ao,Am){if(!Aq||!Ar){return ;}var An=Aq.nds,Al,Ak,Ap;Ag.forEach(An||[],function(As){Al=As.nds;Ag.forEach(Al||[],function(At){Ak=At.es;Ag.forEach(Ak||[],function(Au){Ag.forEach(Ar||[],function(Av){Ag.forEach(Av||[],function(Aw){Ap=Aw.es;Ag.forEach(Ap||[],function(Ax){if(Ao.call(Am,Ax.id,Au.v)){Au.v=Ax.id;Au.n=Ax.n;}});});});});});});},getMouseOffset:function(Al){var Ak=(Al.offsetX!==undefined)?Al.offsetX:(Al.layerX),Am=(Al.offsetY!==undefined)?Al.offsetY:(Al.layerY);return{x:Ak,y:Am};},translateLineStyle:function(Ak){var Am=["none","solid","solid","dashed","dotted"],Al=["1px","1px","2px","1px","1px"];return{width:Al[Ak]||"0px",style:Am[Ak]||"none"};},getVisStyle:function(){var Ak=mstrmojo.VisUtility;return Ak.getPropertyByPath(this,"model.data.visName")||Ak.getPropertyByPath(this,"model.data.vis.vn");},getGroupAndCalculationContextMenuForDataPoints:function(Av,A9){var Ax,Az=[],Am=[],A6=[],Ar=A9.fnCellName,A1=A9.fnUnique,Aq=A9.fnMakeNode,A4=Av.getCellForNode.bind(Av),BB=A9.selection;var Ap=new e.ui.menus.MenuConfig(),Al=new e.ui.menus.MenuConfig(),A3=new e.ui.menus.MenuConfig(),A8=new e.ui.menus.MenuConfig();function BA(BC){Av.cmSelCells=Az[BC].cmSelCells;Av.derivedElementGroup(A4(Av.cmSelCells[0]));}function As(BE){Av.cmSelCells=Am[BE].cmSelCells;var BD=A4(Am[BE].cmSelCells[0]),BC=Av.getDEInfo(BD);Av.derivedElementsEdit(A4(Av.cmSelCells[0]),BC);}function A0(BD){Av.cmSelCells=Am[BD].cmSelCells;var BC=A4(Am[BD].cmSelCells[0]);Av.removeQuickDE(BC);}function Ay(BD){Av.cmSelCells=Am[BD].cmSelCells;var BC=A4(Am[BD].cmSelCells[0]);Av.renameDEList(BC);}function A2(BC){W(Av,A4(Av.cmSelCells[0]),null,BC,false);}function Ak(BC){W(Av,A4(Av.cmSelCells[0]),null,BC,true);}function Ao(BD){var BC=A4(Am[BD].cmSelCells[0]);Av.removeQuickDE(BC);}function A7(BD){var BC=A4(Am[BD].cmSelCells[0]);Av.editDECalculation(BC);}function At(BD,BC){return function(){var BE=new e.ui.menus.MenuConfig();BE.addNonInteractiveMenuItem(mstrmojo.desc(11859,"Based on"),"xt",true);BE.addRadioMenuGroup(null,BD,BC,"checkMark",undefined,true);return BE;};}function Aw(BC){BC=BC||[];function BD(BH){var BE=BH.extra||{},BI=BH.setup||mstrmojo.emptyFn,BF=BH.action||mstrmojo.emptyFn,BG=[];BI(BG,BE);BF(BG,BE);}BC.forEach(BD);}var An=[{name:"group",setup:function(BC){Az.forEach(function(BD){Av.cmSelCells=Az[BD.v].cmSelCells;if(!Object.prototype.hasOwnProperty.call(Am,BD.v)&&Y(Av)){BC.push(BD);}});},action:function(BD){var BC;if(BD.length===1){BC=BD[0].v;Ap.addMenuItem(mstrmojo.desc(1911,"Group"),"xt",function(){Av.cmSelCells=Az[BC].cmSelCells;Av.derivedElementGroup(A4(Av.cmSelCells[0]));});}if(BD.length>1){Ap.addPopupMenuItem(mstrmojo.desc(1911,"Group"),Av.id,At(BA,BD),"xt");}}},{name:"edit-group",setup:function(BC){Am.forEach(function(BG){var BF=A4(Am[BG.v].cmSelCells[0]),BE=Av.getDEInfo(BF),BD=BE&&BE.de;if(BD&&BD.t===U.LIST){BC.push(BG);}});},action:function(BD){var BC,BF,BE;if(BD.length===1){BC=Am[BD[0].v].cmSelCells;BF=A4(BC[0]);BE=Av.getDEInfo(BF);Al.addMenuItem(mstrmojo.desc(13395,"Edit Group..."),"xt",function(){Av.cmSelCells=BC;Av.derivedElementsEdit(A4(Av.cmSelCells[0]),BE);});Al.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"xt",function(){Av.cmSelCells=BC;Av.removeQuickDE(BF);});A8.addMenuItem(mstrmojo.desc(13968,"Rename Group..."),"xt",function(){Av.cmSelCells=BC;Av.renameDEList(BF);});}if(BD.length>1){Al.addPopupMenuItem(mstrmojo.desc(13395,"Edit Group..."),Av.id,At(As,BD),"xt");Al.addPopupMenuItem(mstrmojo.desc(12195,"Ungroup"),Av.id,At(A0,BD),"xt");A8.addPopupMenuItem(mstrmojo.desc(13968,"Rename Group..."),Av.id,At(Ay,BD),"xt");}}},{name:"calculation",setup:function(BC){A6.forEach(function(BF,BE,BD){Av.cmSelCells=BD[BF.v].cmSelCells;var BH=A4(Av.cmSelCells[0]),BG=Av.getDEInfo(BH),BI=BG&&BG.de;if(!(BI&&BI.t===U.RESIDUE)&&l(Av)){BC.push(BF);}});},action:function(BC){if(BC.length===1){Ap.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),Av.id,function(){var BD=BC[0].v,BE=new e.ui.menus.MenuConfig();Av.cmSelCells=A6[BD].cmSelCells;BE.addRadioMenuGroup(null,A2,m(Av,null,Ar).items,"checkMark",undefined,true);return BE;},"xt");}if(BC.length>1){Ap.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),Av.id,function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:"base-on-calculation-editor",data:{},hasToggleItem:true,contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attrList",items:BC,selectedIndex:0,onitemSelected:function(BD){var BE=BD.v;Av.cmSelCells=A6[BE].cmSelCells;this.parent.checkList.set("items",[]);this.parent.checkList.set("items",m(Av,null,Ar).items);this.parent.data.set("valid",false);}},{scriptClass:"mstrmojo.VisMenuList",alias:"checkList"}],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(BE,BD){W(Av,A4(Av.cmSelCells[0]),null,BD.checkList.selectedItem.v,false);}});});}}},{name:"edit-calculation",setup:function(BC){Am.forEach(function(BG){var BF=A4(Am[BG.v].cmSelCells[0]),BE=Av.getDEInfo(BF),BD=BE&&BE.de;if(BD&&BD.t===U.CALCULATION&&l(Av)){BC.push(BG);}});},action:function(BC){function BD(){var BE=BC[0].v;Av.cmSelCells=Am[BE].cmSelCells;var BI=A4(Av.cmSelCells[0]),BH=Av.getDEInfo(BI),BJ=BH&&BH.de,BG=m(Av,BJ,Ar),BF=new e.ui.menus.MenuConfig();BF.addRadioMenuGroup(BG.selectedItem.value,Ak,BG.items,"checkMark",undefined,true);return BF;}if(BC.length===1){A3.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),Av.id,BD,"xt");A3.addMenuItem(mstrmojo.desc(12197,"Delete Calculation"),"xt",function(){var BE=BC[0].v;Av.cmSelCells=Am[BE].cmSelCells;var BF=A4(Av.cmSelCells[0]);Av.removeQuickDE(BF);});A8.addMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),"xt",function(){var BE=BC[0].v;Av.cmSelCells=Am[BE].cmSelCells;var BF=A4(Av.cmSelCells[0]);Av.editDECalculation(BF);});}if(BC.length>1){A3.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),Av.id,function(){return new mstrmojo.ui.menus.EditorConfig({data:{},hasToggleItem:true,contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attrList",items:BC,selectedIndex:0,onitemSelected:function(BH){var BI=BH.v;Av.cmSelCells=Am[BI].cmSelCells;var BG=A4(Av.cmSelCells[0]),BF=Av.getDEInfo(BG),BJ=BF&&BF.de;var BE=m(Av,BJ,Ar);this.parent.checkList.set("items",[]);this.parent.checkList.set("items",BE.items);this.parent.checkList.set("selectedItem",BE.selectedItem);this.parent.data.set("valid",false);}},{scriptClass:"mstrmojo.VisMenuList",alias:"checkList"}],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(BF,BE){W(Av,A4(Av.cmSelCells[0]),null,BE.checkList.selectedItem.v,true);}});});A3.addPopupMenuItem(mstrmojo.desc(12197,"Delete Calculation"),Av.id,At(Ao,BC),"xt");A8.addPopupMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),Av.id,At(A7,BC),"xt");}}}];Ax=A1(BB);Ax.forEach(function(BD){var BF=Aq(BD),BC=A4(BF),BE,BG,BH;if(!Av.model.supportsViewFilterActions(BC.tid)){return ;}BE=BC.dei===undefined?Az:Am;BG=BC.tid;BH=Av.model.getObjectInfo(BG).n;if(BE[BG]===undefined){BE[BG]={};BE[BG].cmSelCells=[];BE.push({n:BH,v:BG,text:BH,value:BG});}BE[BG].cmSelCells.push(BF);if(A6[BG]===undefined){A6[BG]={};A6[BG].cmSelCells=[];A6.push({n:BH,v:BG,text:BH,value:BG});}A6[BG].cmSelCells.push(BF);});var Au=mstrmojo.VisUtility;var A5=Au.getVisStyle.call(Av);if(A5===z.HEAT_MAP){An.splice(2,2);}Aw(An);return{createDe:Ap,editGroup:Al,editCalculation:A3,renameDe:A8};},getGroupAndCalculationContextMenu:function(As,A6,A3){var A5=As,Az=A3.skipSingleAttrCheck||A5.isSingleAttrSelection(),An=false,Ap=A5.isSingleContextMenuSelection(),At=A5.getDEInfo(A6),Ao=At&&At.deObject,A2=At&&At.de,Ax=Ao&&A5.getOthersDEInfo(Ao),Av=A5.getContextMenuSelections(),A1=true,Ar=A3.fnCellName,A4=this.getPropertyByPath(A5,"model.data.visName")||this.getPropertyByPath(A5,"model.data.vis.vn");var Aq=new e.ui.menus.MenuConfig(),Al=new e.ui.menus.MenuConfig(),Aw=new e.ui.menus.MenuConfig(),A0=new e.ui.menus.MenuConfig();A5.cmSelCells=A3.selection;if(As.model.supportsViewFilterActions(A6.tid)){if((An||Az)&&AT(A6,w)&&Y(A5)){Aq.addMenuItem(mstrmojo.desc(1911,"Group"),"xt",function(){As.derivedElementGroup(A6);});}if(Ap&&A2&&A2.t===U.LIST){Al.addMenuItem(mstrmojo.desc(13395,"Edit Group..."),"xt",function(){As.derivedElementsEdit(A6,At);});Al.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"xt",function(){As.removeQuickDE(A6);});A0.addMenuItem(mstrmojo.desc(13968,"Rename Group..."),"xt",function(){As.renameDEList(A6);});}var Au=function(A7){W(A5,A6,A2,A7,false);},Ay=function(A7){W(A5,A6,A2,A7,true);};if(Ax&&!Ap&&Az){S.forEach(Av,function(A7){if(A7[0]&&A7[0].eid.indexOf(Ax.id)>-1){A1=false;return false;}});}if(A4!=="VIHeatMapVisualizationStyle"&&!(Ap&&A2&&A2.t===U.RESIDUE)&&(An||Az)&&AT(A6,AH)&&l(A5)){var Ak=function(){var A7=new e.ui.menus.MenuConfig(),A8=m(A5,null,Ar);A7.addRadioMenuGroup(null,Au,A8.items,"checkMark",undefined,true);return A7;};Aq.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),this.id,Ak,"xt");}if(Ap&&A2&&A2.t===U.CALCULATION&&l(A5)){var Am=function(){var A7=new e.ui.menus.MenuConfig(),A8=m(A5,A2,Ar);A7.addRadioMenuGroup(A8.selectedItem.value,Ay,A8.items,"checkMark",undefined,true);return A7;};Aw.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),this.id,Am,"xt");Aw.addMenuItem(mstrmojo.desc(12197,"Delete Calculation"),"xt",function(){As.removeQuickDE(A6);});A0.addMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),"xt",function(){As.editDECalculation(A6);});}}return{createDe:Aq,editGroup:Al,editCalculation:Aw,renameDe:A0};},isHostedPopupNode:function(An,Am,Al,Ak){return AK(An,Am,"mstrmojo-popup-widget-hosted",Al,Ak);},isMojoEditorNode:function(An,Am,Al,Ak){return AK(An,Am,"mstrmojo-Editor",Al,Ak);},applyStyle2Legend:function(An,Am,Al){var Ak,Ap={},Ao={};for(Ak in An){if(Ak.indexOf("font")>=0||Ak.indexOf("color")>=0||Ak.indexOf("textDecoration")>=0){Ap[Ak]=An[Ak];}else{Ao[Ak]=An[Ak];}}if(Am){Am.style.background="";this.applyStyles2DomNode(Am,Ao);}if(Al){this.applyStyles2DomNode(Al,Ap);}},mergeMenuConfigs:function AJ(Al,Ak){function Am(Ao,Ap,An){if(!Ap){return ;}if(!An&&Ao.hasMenuItems()&&Ap.hasMenuItems()){Ao.addSeparator();}if(Ap.hasMenuItems()){Ao.absorbMenuItems(Ap);}}return Ak.reduce(function(An,Ao){Am(An,Al[Ao.name],Ao.noSeparator);return An;},new mstrmojo.ui.menus.MenuConfig());},absorbMenuItems:function(Al,Ak,Am){Al.addDisposable(Ak);Al.absorbMenuItems(Ak);if(Am&&Ak.menus.length>0){Al.addSeparator();}},addWheelListener:(function(){var An=mstrmojo.dom,Am=An.attachEvent,Al=An.preventDefault,Ao;function Ak(As,Ar,At,Aq){var Ap=(Ao==="wheel")?At:function(Au){if(!Au){Au=window.event;}var Aw={originalEvent:Au,target:Au.target||Au.srcElement,type:"wheel",deltaMode:(Au.deltaMode!==undefined?Au.deltaMode:1),deltaX:0,deltaZ:0,preventDefault:function(){Al(window,Au);}},Av=this;if(Ao==="mousewheel"){Aw.deltaY=-Au.wheelDelta;if(Au.wheelDeltaX!==undefined){Aw.deltaX=-Au.wheelDeltaX;}}else{Aw.deltaY=Au.detail;}return At.call(Av,Aw);};return Am(As,Ar,Ap,Aq);}if(Object.prototype.hasOwnProperty.call(document.createElement("div"),"onwheel")){Ao="wheel";}else{Ao=document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";}return function(Aq,Ar,Ap){return Ak(Aq,Ao,Ar,Ap);};}()),addTouchSupportHelper:function AM(Ak,Am,Al,Ap,Ao){Ak.style["touch-action"]="none";var An={MINDRAG:function(Aq){return(((Aq.event.type.indexOf("touch")===0)||(Aq.event.type.indexOf("pointer")===0))?5:1);},TAPHOLDDELAY:250,DBLCLICKDELAY:300};u.newInstance(Ak,{context:An,start:Al,change:Ap,end:Ao},Am);},addBasicTouchSupport:function AC(Ap,Ar,Au,Ao,At){function Av(Az){var Ay={left:0,top:0};function Aw(A0){if(A0===window||A0===document||A0===document.body){return Ay;}else{return A0.getBoundingClientRect();}}function Ax(A3,A4,A1){A4=A4||A3.currentTarget||A3.srcElement;if(!Array.isArray(A1)){A1=[0,0];}var A0=A3.clientX||0;var A5=A3.clientY||0;var A2=Aw(A4);A1[0]=A0-A2.left;A1[1]=A5-A2.top;return A1;}return Ax(Az.changedTouches?Az.changedTouches[0]:Az,document.body);}function An(Aw,Ay){if(Aw.touches.length>1||(Aw.type==="touchend"&&Aw.touches.length>0)){return undefined;}var Ax=null,A0=null;switch(Aw.type){case"touchstart":Ax="mousedown";A0=Aw.changedTouches[0];break;case"touchmove":Ax="mousemove";A0=Aw.changedTouches[0];break;case"touchend":Ax="click";A0=Aw.changedTouches[0];break;}if(Ay){Ax=Ay;}var Az={bubbles:Aw.bubbles,cancelable:Aw.cancelable,view:Aw.view,screenX:A0.screenX,screenY:A0.screenY,clientX:A0.clientX,clientY:A0.clientY};if(Ay==="contextmenu"){Az.button=2;Az.buttons=2;}return new MouseEvent(Ay,Az);}function Aq(Ay,Aw){var Ax;if(Ay.type.indexOf("touch")===0){Ax=An(Ay,Aw);}else{var Az=Av(Ay),A0={bubbles:Ay.bubbles,cancelable:Ay.cancelable,view:Ay.view,detail:Ay.detail,screenX:Ay.screenX,screenY:Ay.screenY,clientX:Az[0],clientY:Az[1]};if(Aw==="contextmenu"){A0.button=2;A0.buttons=2;}Ax=new MouseEvent(Aw,A0);}Ax.originEvent=Ay;return Ax;}function Am(Aw){if(Aw.stopPropagation){Aw.stopPropagation();}if(Aw.preventDefault){Aw.preventDefault();}Aw.cancelBubble=true;return false;}function Ak(Ax){var A0=Ax.event,Aw=Ax.context;Aw.startOffset=Av(A0);Aw._dragged=false;Aw._dragging=true;Aw._taphold=false;Aw.initialTarget=A0.target;var Az=(new Date()).getTime();if(Az-Aw._mouseDownTime<Aw.DBLCLICKDELAY){Aw.numClicks+=1;}else{Aw.numClicks=1;Aw._mouseDownTime=Az;}Aw.tapholdTimeoutId=setTimeout(function(){if((new Date()).getTime()-Aw._mouseDownTime>Aw.TAPHOLDDELAY&&!Aw._dragged){Aw._taphold=true;}if(!Aw._dragged&&Aw._taphold){Ax.session.listeners.end(A0);}},Aw.TAPHOLDDELAY+10);var Ay;if(Au){Ay=Au(Ax);}if(Ay===undefined||(Ay&&Ay.pause)){Am(Ax.event);}}function As(A0){var Aw=A0.event,Az=A0.context,A2=Av(Aw),Ay=A2[0]-Az.startOffset[0],Ax=A2[1]-Az.startOffset[1];if(Math.abs(Ay)<Az.MINDRAG(A0)){Ay=0;}if(Math.abs(Ax)<Az.MINDRAG(A0)){Ax=0;}if(Ay||Ax){Az._dragged=true;}if((new Date()).getTime()-Az._mouseDownTime>Az.TAPHOLDDELAY&&!Az._dragged){Az._taphold=true;}var A1;if(Ao){A1=Ao(A0);}if(A1===undefined||(A1&&A1.pause)){Am(A0.event);}}function Al(Ax){var Aw=Ax.context,Az=Ax.event;if(Aw.tapholdTimeoutId){clearTimeout(Aw.tapholdTimeoutId);}if(!Aw._dragging){Aw._dragged=false;return ;}Aw._dragging=false;if((new Date()).getTime()-Aw._mouseDownTime>Aw.DBLCLICKDELAY){Aw.numClicks=Math.max(Aw.numClicks-1,1);}if((new Date()).getTime()-Aw._mouseDownTime>Aw.TAPHOLDDELAY&&!Aw._dragged){Aw._taphold=true;}var Ay;if(At){Ay=At(Ax);}if(Az.type.indexOf("mouse")===0){Aw._dragged=false;Aw._taphold=false;return ;}else{if(!Aw._dragged){if(Aw._taphold){Aw.initialTarget.dispatchEvent(Aq(Az,"contextmenu"));}else{Aw.initialTarget.dispatchEvent(Aq(Az,"click"));}}Aw._dragged=false;Aw._taphold=false;if(Ay===undefined||(Ay&&Ay.pause)){Am(Ax.event);}}}this.addTouchSupportHelper(Ap,Ar,Ak,As,Al);},isNearZero:function(Al,Ak){Ak=Ak||5;var Am=1/Math.pow(10,Ak);return(Math.abs(Al)<Am);},hasMergedRowCells:function(Ak){return false;},getMockUpThresholds:function(Am,An){var Ak=[{tid:1,n:"threshold 0",scope:1,rtp:2,rtxt:"",fmt:{bc:"#cc2525",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"10%",dtp:5}],fn:2,fnt:3}],fn:19},ttp:1,flr:0,ceil:10},{tid:2,n:"threshold 1",scope:1,rtp:2,rtxt:"",fmt:{bc:"#e34b4b",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"10%",dtp:5},{v:"30%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:10,ceil:30},{tid:3,n:"threshold 2",scope:1,rtp:2,rtxt:"",fmt:{bc:"#e97d7d",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"30%",dtp:5},{v:"50%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:30,ceil:50},{tid:4,n:"threshold 3",scope:1,rtp:2,rtxt:"",fmt:{bc:"#79d479",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"50%",dtp:5},{v:"70%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:50,ceil:70},{tid:5,n:"threshold 4",scope:1,rtp:2,rtxt:"",fmt:{bc:"#57ba57",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"70%",dtp:5},{v:"90%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:70,ceil:90},{tid:6,n:"threshold 5",scope:1,rtp:2,rtxt:"",fmt:{bc:"#2ca02c",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"90%",dtp:5}],fn:5,fnt:3}],fn:19},ttp:1,flr:90,ceil:100}];S.forEach(Ak,function(Ap){var Ao=Ap.expr.nds[0].m;Ao.did=Am;Ao.n=An;});var Al={};Al[Am]=Ak;return Al;},generateThresholdsInfo:function(Am,Ar,Ak,Ao){var Aq=Ak.length,Al=[],Au,An,Av=0,At=0;for(var Ap=0;Ap<Aq;Ap++){An=Math.round(Ao[Ap]*100);At=Av;Av=An||100;Au={tid:Ap+1,n:"threshold "+Ap,scope:1,rtp:2,rtxt:"",fmt:{bc:Ak[Ap],bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:Am,n:Ar},cs:[{v:An+"%",dtp:5}],fn:2,fnt:3}],fn:19},ttp:1,ceil:Av,flr:At};Al.push(Au);}var As={};As[Am]=Al;return As;},psPt2CssPt:function(Am,Al){var Ak=parseInt(Am,10)*0.75;if(Al instanceof Function){Ak=Al(Ak);}return Ak+"pt";},captureEventOnce:function(Ap,Ao,Ak,An,Am){function Al(Aq){Ao.call(Ak,Ab.newDomEvent(Ap,window,Aq||window.event),Am);AF.detachEvent(An,Ap,Al);}Am=Am||{};An=An||document;AF.attachEvent(An,Ap,Al);},getPropertyByPath:function(Ao,An,Ak){var Al,Am;if(typeof An!=="string"){return Ak;}Al=An.split(".");Am=Al.every(function(Aq){var Ap=Ao[Aq];if(Ap!==undefined){Ao=Ap;return true;}return false;});return Am?Ao:Ak;},mergeHashes:function(){return Array.prototype.slice.apply(arguments).reduce(function(Ak,Al){if(Al){Object.keys(Al).forEach(function(Am){Ak[Am]=Al[Am];});}return Ak;},{});},toggleControlEnabled:function(Ak,Al){[].concat(Ak).forEach(function(Am){Am.set("enabled",!!Al);});},findInArray:function(An,Am,Al){var Ap=-1,Ao,Ak;if(!Array.isArray(An)){return Ap;}for(Ao=Al===undefined?0:Al,Ak=An.length;Ao<Ak;Ao+=1){if(Am(An[Ao])){return Ao;}}return Ap;},arrayUnique:function(Ak,Am){if(!Array.isArray(Ak)){return Ak;}var Al=mstrmojo.VisUtility;return Ak.filter(function(An,Ao){return Al.findInArray(Ak,function(Ap){return Am(An,Ap);},Ao+1)===-1;});},range:function(Ak,Ao,An){An=An||1;var Am,Al=[];for(Am=Ak;Am!==Ao;Am+=An){Al.push(Am);}return Al;},drawDashLine:function I(As,Am,Aq,Al,Ao,Ak,Ar){var Ap=(Am===Al),An;As.beginPath();As.moveTo(Am,Aq);if(Ap){An=0;Aq+=Ak;while(Aq<=Ao){if(An%2===0){As.lineTo(Am,Aq);Aq+=Ar;}else{As.moveTo(Am,Aq);Aq+=Ak;}An++;}if(An%2===0){As.lineTo(Al,Ao);}}else{An=0;Am+=Ak;while(Am<=Al){if(An%2===0){As.lineTo(Am,Aq);Am+=Ar;}else{As.moveTo(Am,Aq);Am+=Ak;}An++;}if(An%2===0){As.lineTo(Al,Ao);}}As.stroke();},repeat:function(Am,An){var Ak=[],Al;An=Math.max(0,An);for(Al=0;Al<An;Al+=1){Ak[Al]=Am;}return Ak;},isHierarchyObject:function(Ak){return(Ak&&Ak.t)===p.DssTypeDimension;},selectDropZonePanel:function(Ak){AD(Ak,"editPanel");},selectPropertyPanel:function(Al,Am){AD(Al,"propertiesPanel");var Ak=Al.edtModel;if(Ak){Ak.selectTargetByValue(Am);}},pluck:function(Al,Ak){if(!S.isArray(Al)){return Al;}return Al.map(function(Am){return Am&&Am[Ak];});},pick:function(Al,Ak){return Ak.reduce(function(An,Am){An[Am]=Al[Am];return An;},{});},isColorManuallySet:function(Am,Al){var Ak=Ah(Am,Al);if(Ak){return Ak.isManual;}},getCombColor:function(Am,Al){var Ak=Ah(Am,Al);if(Ak){return Ak.color;}},setColorPickerShowAutomatic:function(Al,Ak){Al.children[0].fillColor.colorPicker.showAutomatic=Ak;},getCharGroupValueChangeCb:function(Ak){var Al=(function(){var Am={};Am[AU.FONT_WEIGHT]=AY.FS_BOLD;Am[AU.FONT_STYLE]=AY.FS_ITALIC;Am[AU.UNDERLINE]=AY.FS_UNDERLINE;Am[AU.LINE_THROUGH]=AY.FS_STRIKETHROUGH;return function(An,Ao){return An^Am[Ao];};}());return function(An,Am){if(Ak instanceof Function){Ak=Ak();}if(!Ak){return ;}switch(An){case AU.COLOR:Ak.fontColor.fill.value.setValue(Am);break;case AU.FONT_SIZE:Ak.fontSize.setValue(Am);break;case AU.FONT_FAMILY:Ak.fontFamily.setValue(Am);break;case AU.FONT_WEIGHT:case AU.FONT_STYLE:case AU.UNDERLINE:case AU.LINE_THROUGH:Ak.fontStyle.setValue(Al(Ak.fontStyle.getValue(),An));break;}};},getMetricsInDropZone:AQ,addLegendFontChangeListeners:function(Al,Am){var Ak=["lgdFntClr","lgdFntSz","lgdFntFml","lgdFntStyle"];Ac(Ak,Al,Am);},addLegendBackgroundChangeListeners:function(Al,Am){var Ak=["lgdBgFillClr","lgdBgFillTrans"];Ac(Ak,Al,Am);},isValidDropZone:function(Ak){if(Ak===undefined){return false;}var Am=Object.keys(Ak).filter(function(An){return An!=="visProp";});var Al=X.copyProps(Am,Ak);return Ak&&!X.equals(Al,{});},unitExistInTemplate:function(An,Ak){var Am,Ap,Ao=Ak.row,Al=Ak.col;for(Am=0,Ap=Ao.length;Am<Ap;Am++){if(Ao[Am].id===An){return true;}}for(Am=0,Ap=Al.length;Am<Ap;Am++){if(Al[Am].id===An){return true;}}return false;},findDisabledUnits:function(At,Au){var Ap,Al,An=Au.docModel.datasets,Ak=At.gts,Ar=At.datasetId,Ao=An[Ar]||{},Aq=Ao.att||[],As=[];var Am=mstrmojo.VisUtility;if(Aq){for(Ap=0,Al=Aq.length;Ap<Al;Ap++){if(!Am.unitExistInTemplate(Aq[Ap].did,Ak)){As.push(Aq[Ap]);}}}return As;},getDrillCandidates:function(Ap,Aq){var As=Ap.modelData,Au=Ap.model,Ao=Au.docModel.datasets,Ak=As.gts,Am=mstrmojo.VisUtility,Av=Am.findDisabledUnits(As,Au),Al=[],An=(function(){var Aw;if(Aq){S.forEach(Ak.row.concat(Ak.col),function(Ax){if(Ax.id&&Ax.id===Aq){Aw=Ax.dp;}});}return Aw;}()),Ar=function(Aw,Az){var Ax=S.find(Aw,"did",Az.id),Ay=Aw[Ax];if(Ay&&!Ay.hide){Az.n=Ay.n;return true;}return false;},At=S.filter(An,function(Ay){var Aw;for(Aw in Ao){var Ax=Ao[Aw];if(Ar(Ax.att,Ay)){return true;}}return false;});if(At){Al=S.filter(Av,function(Ax){for(var Aw in At){if(At[Aw].n===Ax.n){return true;}}return false;});}return Al;},getDrillSubMenu:function(Ak){if(!Ak||!Ak.items||!Ak.drillAction){return{};}var Ao=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,isHostedWithin:false,alignWithAnchor:true,maxHeight:350}),Al=Ak.items,An=Ak.drillAction,Am=[];if(mstrmojo.resolveFeature("sort-drill-paths")){Al.sort(function(Aq,Ap){if(Aq.n>Ap.n){return 1;}if(Aq.n<Ap.n){return -1;}return 0;});}Al.forEach(function(Ar,Ap){if(Am.indexOf(Ar.did)===-1){Am.push(Ar.did);if(Ar.att){var Aq=mstrmojo.VisUtility;var As={};X.copy(Ak,As);As.items=Al[Ap].att;Ao.addPopupMenuItem(Ar.n,this.id,Aq.getDrillSubMenu,"xt",As);}else{Ao.addMenuItem(Ar.n,"xt",An,X.copy(Ak,{drillUnit:Ar}));}}});return Ao;},getDrillMenu:function(Aq,Ar,Aw,Ak){var As=Aq.model,An=mstrmojo.VisUtility,At=An.getDrillCandidates(Aq,Ar),Au=At.length,Ap=As.docModel,Am=Ap.datasets[Aq.modelData.datasetId],A0,Av=[],Ay=-1,Ax,Az,Ao,Al;if(Am&&Ap.isMDXDataset(Am)){An.sortMdxDrillCandidates(At);A0=Am.tables[0];A0.dimensions.forEach(function(A1){Ao=true;Ax=-1;A1.hierarchies.forEach(function(A2){Al=true;A2.att.forEach(function(A3){Az=Ag.findBin(At,A3,"did",Au);if(Az!==-1){if(Ao){Av.push({id:A1.did,did:A1.did,n:A1.n,att:[]});Ay++;Ao=false;}if(Al){Av[Ay].att.push({id:A2.did,did:A2.did,n:A2.n,att:[]});Ax++;Al=false;}Av[Ay].att[Ax].att.push(At[Az]);}});});});}else{Av=At;}return An.getDrillSubMenu(X.copy(Ak,{items:Av,drillAction:Aw}));},sortMdxDrillCandidates:function(Ak){Ak.sort(function(Am,Al){if(Am.did<Al.did){return -1;}if(Am.did>Al.did){return 1;}return 0;});return Ak;},getDrillMenuItemsCallback:function(Am,An,Ak,Al){return function(){var Ap=mstrmojo.VisUtility;var Aq=Ap.getDrillCandidates(Am,Al),Ao=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:350});Aq.forEach(function(Ar){Ao.addMenuItem(Ar.n,"xt",An,X.copy(Ak,{drillUnit:Ar}));});return Ao;};},doDrill:function(Am,A0,Av,A1){var A2=Am;function As(A4){return A4.model.controller.cmdMgr;}function Ay(){return{success:function A4(){var A5=mstrmojo.VisUtility;A5.visPrint("reaise");this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}var Al=A2.model,Az=(A2.getDocModel&&A2.getDocModel())||A2.model.docModel,Ax=Az.getDataService(),Ap=Ax.newUpdate();var Ar=true;if(Az.prefs&&Az.prefs.rtprnt){Ar=parseInt(Az.prefs.rtprnt,10)===1;}else{if(Al.xtab.defn.tkp!==undefined){Ar=parseInt(Al.xtab.defn.tkp,10)===-1;}}A1=A1||{};A1.keepParent=Ar;var Aq=Av.call(Am,A0,A1);var At=A2.zonesModel,A3=At.getUpdateCallback(),Au=A2.model.controller||Az.controller,An=Au._getXtabCallback(A2);Ap.add(Aq,Af(A3,An));var Ak=Al.getSelectorDataFromTemplateLimit(A2.model.data.tpl).concat({keepOnly:true,data:A2.getContextMenuSelections()}),Aw=Az.getKeepOnlyOrExcludeAction(A2.k,Ak);Ap.add(Aw,Ay.call(A2));As(A2).execute({execute:function Ao(){this.submitUpdate(Ap);},urInfo:{callback:Ap.callback}});},strStartsWith:function(Am,Al,Ak){Ak=Ak||0;return Am.lastIndexOf(Al,Ak)===Ak;},changeWidgetBackground:function(Am,An,Al){var Ak=Am.parent;if(Ak&&An!==Al){Ak.changeUnitFormats(false,1,Am.getFormats(),AU.BACKGROUND_COLOR,An,Al);Ak.raiseEvent({name:"BEMFormatChange",propertyName:AU.BACKGROUND_COLOR,value:An,isTitle:false});}},translateGridError:function(Al,Ak){if(Ak===undefined){Ak=Ai.AE_ERROR;}if(Ak===Ai.EMPTY_DATA){Al=mstrmojo.desc(2388,"No data returned for this view. This might be because the applied filter excludes all data.");}if(Ak===Ai.NO_DATASET||Ak===Ai.NO_TEMPLATE_UNIT){Al=mstrmojo.desc(11668,"Drag objects here.");}if(!Al){Al=mstrmojo.desc(13687,"Unknown error");}return{msg:Al,type:Ak};},hasValidValueInMetric:function(An,Al){var Ak=mstrmojo.VisUtility;var Am=Ak.getPropertyByPath(An,"model.data.gsi.mx");if(Am===undefined||Am.length<=Al||Al<0){return false;}var Ao=Am[Al];return["min","max"].every(function(Ap){var Aq=Ao[Ap];return Aq!==undefined&&Aq!==null&&Aq!=="";});},renderWidgetErrorRSD:function(An,Ap,Al){var Ar=document.createElement("div");var Aq='<div style="display: table; height: 100%; width: 100%; background-color:#F5F5F2; border: solid 1px #A7A7A7; box-sizing: border-box;"><div style="display: table-cell; vertical-align: middle; text-align: center; color: #000000; font-size: 14pt;">'+Ap+"</div></div>";Ar.innerHTML=Aq;Ar=Ar.firstChild;var Ak=An.width,Am=An.height;if(Ak!==undefined){Ar.style.width=Ak+"px";}if(Am!==undefined){Ar.style.height=Am+"px";}var Ao=An.domNode;if(Ao){Al.forEach(function(As){Ao["on"+As]=undefined;});while(Ao.firstChild){Ao.removeChild(Ao.firstChild);}Ao.appendChild(Ar);}else{An.parent.domNode.appendChild(Ar);}},visPrint:function(){var Ak=mstrmojo.VisUtility.enableInVis;if(Ak&&window.mstr_profile&&mstr_profile.enabled&&console){Function.prototype.apply.call(console.log,console,arguments);}},hasCGorCon:function(An,Ak){var Am=Ak&&Ak.did,Al=An.model.data.datasetId||"",Ao=null;if(Am){Ao=AW.getDatasetFromAttributeId(An.model.docModel.datasets,Am);}else{if(Al){Ao=AW.getDatasetFromId(An.model.docModel.datasets,Al);}}return Ao&&AW.hasCGorCon(Ao);},isCGorCon:function n(An,Ak){var Am=Ak&&Ak.did,Al=An.model.data.datasetId||"",Ao=null;if(Am){Ao=AW.getDatasetFromAttributeId(An.model.docModel.datasets,Am);}else{if(Al){Ao=AW.getDatasetFromId(An.model.docModel.datasets,Al);}}return Ao&&AW.isCGorCon(Ak,Ao);},findElementsByAttribute:function R(Am,Ao,An,Ak){Ak=!!Ak;var Ap=[];if(An.constructor!==Array){An=[An];}var Aq=function(Ar){if(Ak){return Ar.identity&&Ar.identity.tlOpt&&Ar.identity.tlOpt[Ao];}else{return Ar.getAttribute(Ao);}};function Al(At){var Ar=Aq(At),As;if(At.hasChildNodes()){As=At.firstChild;while(As){if(As.nodeType===1){Ar=Aq(As);if(An.indexOf(Ar)!==-1){Ap.push(As);}else{Al(As);}}As=As.nextSibling;}}}Al(Am);return Ap;},restoreEsForUnit:function AS(Ao){if(!Ao){return ;}var Ap=Ao.es,Al=Ao.fs,An=Ao.otp,Ak=Al&&Al.length||0;function Am(Aq){var Ar=document.createElement("div");Ar.innerHTML=Aq;return Ar.innerText;}if(Ap){S.forEach(Ap,function(Ar,Aq){Ar.n=c.decodeHtmlString(Ar.n);if(An===p.DssTypeAttribute&&Ak){switch(Al[Aq%Ak].bftp){case AO.DssBaseFormHTMLTag:Ar.n=Am(Ar.n);break;default:}}});}},isTrue:function AX(Ak){return Ak==="true"||Ak===true;},getFontFamilyItems:function t(){if(P){return P;}else{P=[];S.forEach(Q.Families.slice(1),function(Ak){P.push({n:Ak.n,id:Ak.n,did:Ak.n,preview:!Ak.symbolic});});return P;}},surroundWithQuotes:function AR(Ak){if(!Ak){return"";}return"'"+Ak.replace(/^['|"]+/,"").replace(/['|"]+$/,"")+"'";}});mstrmojo.VisUtility.enableInVis=true;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.ui.HierarchyElementsCheckListBrowser","mstrmojo.vi.ui.ElementsBrowser","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox","mstrmojo.Label","mstrmojo._IsList","mstrmojo.rw.ConditionWalkProviderBase","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown","mstrmojo.ui.CheckList","mstrmojo.ui.ColumnContainer","mstrmojo.vi.ui.DatasetUnitMenuUtils");var P=mstrmojo.array,W=mstrmojo.css,F=mstrmojo.string,M=mstrmojo.expr,X=mstrmojo.dom,Y=mstrmojo.hash,AB=M.ET,a=M.ET2TGT,o=M.DTP2FN_DTP,Z=M.FN,n=M.FNT,S=M.FN_MRP,u=mstrmojo.rw.ConditionWalkProviderBase,d=u.onWalkChange,q=u.updateList,AL=u.fnItem,AK=u.isComparisonAllowed,b=u.clearInvalid,D=u.shouldShowCst,e=u.getConstant,G=u.getConstantDataType,AA=u.getConstantValue,AM=u.isDATE,f=u.getCstListCompareTgts,g=u.fmJson,AE=u.allowedTargetTypes,L=u.updatePulldown,U=u.onWalkChangeThroughPulldown,p=mstrmojo.mstr.EnumDSSXMLObjectTypes,AI=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,AO=mstrmojo.vi.ui.DatasetUnitMenuUtils,B=mstrmojo.ui._HasListTooltip;var E=mstrmojo.ui.ColumnContainer.prototype.updateColumnContainer;var Q=mstrmojo.meta.TP,AH=mstrmojo.meta.STP,C="-2";var N={SELECT:0,QUALIFICATION:1};var h={TEMPLATE_LEVEL:0,DATASET_LEVEL:1};var V={VALUE:1,RANK_PERCENTAGE:2,BOTH:3};var m=0,t=1;var H=368,AG=H-5,AN=5,R=26,K=10;var z={};z[AB.MQ]={key:"metricFns",def:M.METRIC_FNS};z[AB.MC]={key:"metricFns",def:M.METRIC_FNS};z[AB.AQ]={key:"formFns",def:M.FORM_FNS};z[AB.AL]={key:"formFns",def:M.FORM_FNS};z[AB.AC]={key:"formFns",def:M.FORM_FNS};z[AB.AE]={key:"elemFns",def:M.ELEM_FNS};function AJ(AP){return'<div class="unit item '+AO.getUnitCssClass(AP)+'">'+F.encodeHtmlString(AP.n)+"</div>";}function AD(AP){var AQ=this.selectedNode;P.forEach(AQ.classList,function(AR){if(AR&&F.startsWith(AR,"ic")){W.removeClass(AQ,AR);}});W.addClass(AQ,"unit");W.addClass(AQ,"item");W.addClass(AQ,AO.getUnitCssClass(AP));return F.encodeHtmlString(AP.n);}function l(AQ,AY){var AU=AQ.model,AX=AU.et,AZ=AU&&AU[a[AX]]&&AU[a[AX]][AQ.columnWalk.target.itemIdField||"did"],AT=AU&&AU.fm,Ac=AT&&AT.dtp,AR=AK(AU,AQ.ets);if(this.targetsLastMod&&this.targetsLastMod===AQ.targetsLastMod&&AZ&&AZ===this._lastTargetId&&this.lastFmDtp===Ac&&this.lastFnTp===AR&&this.lastEt===AX){return ;}var AW=this.attMxPd,Ab=this.attMxLabel;if(!AR){AW.set("items",[]);Ab.set("visible",false);AW.set("visible",false);}else{var Aa=AU.a?mstrmojo.desc(518,"Attribute"):AU.m?mstrmojo.desc(517,"Metric"):"",AV=f(AQ),AP=AU[a[AU.et]+(2+AY)],AS=AP?P.find(AV,"did",AP.did):undefined;Ab.set("text",Aa);AW.items=AV;AW.selectedIndex=AS>=0?AS:undefined;AW.refresh();Ab.set("visible",true);AW.set("visible",true);}this._lastTargetId=AZ;this.lastFnTp=AR;this.lastFmDtp=Ac;this.lastEt=AX;this.targetsLastMod=AQ.targetsLastMod;}function J(AX,Aa){AX.updating=true;var AT=AX.parent.parent.parent,AZ=D(AT,Aa);if(!AZ){AX.updating=false;return ;}var AR=AT.model||{},AW=e(AT,Aa),AS=G(AT,AW),Ab=AA(AT,Aa),AY=AR.fn,AV=M.fn_List(AY,AR.fnt),AP=AM[AS];var AU=AP?AX.dateInput:AX.txtInput;var AQ=AP?AX.txtInput:AX.dateInput;AQ.set("visible",false);AU.updating=true;AU.set("dtp",AS);AU.set("isList",AV);AU.set("value",Ab);AU.set("visible",true);AU.set("hint",AV?mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep||";"):"");AU.updating=false;if(AY===1||AY===2){AU.constraints.min=0;}if(AU.clearValidation&&AU.inputNode){AU.clearValidation();}l.call(AX,AT,Aa);switch(AR.et){case AB.AQ:case AB.AL:case AB.MQ:AX.attMxPd.set("selectedIndex",undefined);break;}AX.updating=false;}function AF(){var AS=this.parent,AQ=AS.parent.parent.parent,AR=(this.isValid&&this.isValid())||(!this.isValid&&!F.isEmpty(this.value)),AP=AQ.model;AQ["invalid"+AS.cstIndex]=!AR;if(!this.updating){this.updating=true;if(AP){AP.edit(AS.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}if(AQ.updateOkBtn){AQ.updateOkBtn();}}function I(AP){if(AP){var AR=AP.n,AQ=AP.dsName;if(AR&&AQ){return'<div class="name">'+F.encodeHtmlString(AR,true)+'</div><div class="dsc dataset">'+F.encodeHtmlString(AQ,true)+"</div>";}else{return B.getTooltipText.call(this,AP);}}}function k(AP){return Y.copy(AP,{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ValidationTextBox",alias:"txtInput",cssText:"width: 100%",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.VALUESET},onValid:AF,onInvalid:AF,onClearValidation:b,size:6,visible:true},{scriptClass:"mstrmojo.DateTextBox",alias:"dateInput",cssDisplay:"inline-block",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:AF,onInvalid:AF,onClearValidation:b,calendarToBody:true,autoFormat:false,calConfig:{onmousedown:function(AS){X.stopPropogation(AS.hWin,AS.e);}},visible:true},{scriptClass:"mstrmojo.Label",cssClass:"attMxLabel",text:"Attribute",alias:"attMxLabel"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attMxPd",itemIdField:"did",cssClass:"conditionWalk-attMxPd",onSelectedItemChange:function AQ(AT,AU){if(this.hasRendered){var AS=this.parent.parent.parent.parent;U.call(this,AS,AT,"c0");}},getPulldownTextInnerHTML:AJ,getPopupListConfig:function AR(){var AS=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);AS.showTooltipForLargeText=false;AS.getItemProps=function AT(AW,AU){var AV=mstrmojo._IsList.getItemProps.call(this,AW,AU);AV.title="";AV.style=this.parent.itemCssText||"";AV.addCls("unit "+AO.getUnitCssClass(AW));return AV;};AS.getTooltipText=I;return AS;}}],update:function(){J(this,this.cstIndex);this.parent.updateScrollbars();},postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});}});}function w(AP){return AP[Q]===p.Attribute&&AP[AH]===AI.AttributeRecursive;}function x(AP){var AR=AP[Q]===p.Consolidation&&AP[AH]===AI.ConsolidationManaged,AQ=mstrApp&&mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model;if(AR&&AQ&&AQ.findUnitInDataSet){AP=AQ.findUnitInDataSet(AP.did);if(AP&&AP.attId){return w(AQ.findUnitInDataSet(AP.attId));}}}mstrmojo.vi.ui.ConditionWalkProvider=mstrmojo.declare(mstrmojo.rw.ConditionWalkProviderBase,null,{scriptClass:"mstrmojo.vi.ui.ConditionWalkProvider",getTargetNodeProps:function j(){var AZ=this;return{alias:"target",isAttribute:false,isMetric:false,showChooseMethod:true,showLevel:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(15115,"Based on")},{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"target",itemIdField:"did",cssClass:"conditionWalk-target",allowEmptyText:true,onRender:function(){if(this.hasRendered){this[this.editableSlot].setAttribute("placeholder",mstrmojo.desc(10,"Search"));}},postCreate:function(){this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},getEditableTextInnerHTML:function Aa(){var Ac=this.selectedIndex,Ab=this.getPopupList(),Ad=Ab&&Ab.items;if(this.selectedNode&&Ad&&Ad[Ac]){return this.getPulldownTextInnerHTML(Ad[Ac]);}else{return"";}},update:function AV(){var Ae=this.parent.parent.parent,Ad=Ae.model,Ab=Ae.targetsLastMod,Ah=Ad&&Ad.et;if(this.lastModel!==Ad||this.targetsLastMod!==Ab){this.lastModel=Ad;this.targetsLastMod=Ab;var Ac=Ae.targets,Af=Ae.ets;if(Af&&Ac&&Ac.length){var Ag=AE(Ae.ets);Ac=P.filter(Ac,function(Am){return Ag[Am[Q]];});}var Ak=Ad&&Ad[a[Ah]],Aj=Ae.objectBrowsingEnabled,Al=Aj&&(!Ac||P.find(Ac,"did",C)===-1);if(Ah===AB.ANDOR){Ak=Ad.a||Ad.m||null;}this.set("objectBrowsingEnabled",Aj);if(Al){Ac=Ac||[];var Ai=mstrmojo.desc(15346,"Browse Metadata Objects...");Ac.push({did:C,n:Ai,t:-1,title:Ai});}L(this,true,M.getSortedObjectsByTypeGroup(Ac),Ak);if((!Aj||Al)&&!Ak){this.set("isEditing",true);this.openPopup(this.getPopupList());}}},onitemSelected:function AQ(Ad,Ac){if(this.hasRendered){var Ab=this.parent.parent.parent;U.call(this,Ab,Ad,"target");}},preisEditingChange:function AW(){if(this.hasRendered&&this.isEditing){var Ab=this.selectedNode;this._lastText=Ab.innerHTML;W.removeClass(Ab,"unit");W.removeClass(Ab,"item");}return true;},postisEditingChange:function AX(){if(this.hasRendered&&!this.isEditing){var Ab=this.selectedNode;if(this._lastText){Ab.innerHTML=this._lastText;W.addClass(Ab,"unit");W.addClass(Ab,"item");}else{Ab.innerHTML="";}delete this._lastText;}},onPopupWidgetClosed:function AY(Ad){if(this.objectBrowsingEnabled&&Ad&&Ad.pressingEnter){var Ab=this.getPopupList(),Ag=Ab._oldItems,Af=this.text;if(Ag&&Af){var Ae=P.filterOne(Ag,function(Ah){return Ah.n===Af;});Ae=Ae||Ab.items[0];if(!Ae){delete Ab._oldItems;Ab.set("items",Ag);return ;}if(Ae.did===C){var Ac=this.parent.parent.parent;Ac.browse(this);delete Ab._oldItems;Ab.set("items",Ag);return ;}}}mstrmojo.ui.SearchablePulldown.prototype.onPopupWidgetClosed.call(this,Ad);},getPulldownTextInnerHTML:AD,getPopupListConfig:function AP(){var Ab=mstrmojo.ui.SearchablePulldown.prototype.getPopupListConfig.call(this);Ab.showTooltipForLargeText=false;Ab.getItemProps=function Ac(Ah,Af){var Ag=mstrmojo._IsList.getItemProps.call(this,Ah,Af);Ag.title="";Ag.style=this.parent.itemCssText||"";Ag.addCls("unit "+AO.getUnitCssClass(Ah));Ag.addCls(Ah.isInvalid?"invalid":"");return Ag;};Ab.doItemSelect=function Ad(Ai,Af){if(Ai.did===C){var Ag=this.parent;Ag.parent.parent.parent.browse(Ag);}else{if(Ai.isInvalid){var Ah=this;window.setTimeout(function(){Ah.showTooltip({target:Ah._getItemNode(Ai._renderIdx)},window);},0);}else{mstrmojo._IsList.doItemSelect.call(this,Ai,Af);}}};Ab.showTooltip=function Ae(Ak,Aj){if(!this.hasOpenTooltip&&!(this._lastOpened&&this._lastOpened.visible)){var Ai=X.eventTarget(Aj,Ak),Ah=this.getItemFromTarget(Ai);if(Ah&&Ah.isInvalid){var Ag=this.getItemNodeFromTarget(Ai),Af=X.position(Ag);this.richTooltip={content:mstrmojo.desc(15391,"This is an invalid object. Please contact your administrator for more information."),cssClass:"vi-warning triangle-warning vi-tooltip-C A-center",left:Af.x+168,top:Af.y};mstrmojo._HasTooltip.showTooltip.call(this,Ak,Aj);}else{this.constructor.prototype.showTooltip.call(this,Ak,Aj);}}};Ab.tooltipOpenDelay=700;Ab.getTooltipText=I;return Ab;}},{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(15116,"Choose elements by"),alias:"attrLabel",bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chooseMethodPd",items:null,visible:false,bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"},onitemSelected:function AQ(Ae){var Ad=this.parent.fm,Ac=Ad&&Ad.cssClass,Ab=Ad&&Ad.domNode,Af=Ad&&Ad.selectedItem;if(Ae.v===N.SELECT){W.toggleClass(Ab,"forms",false);if((Ac||"").indexOf(" forms")>-1){Ad.cssClass=Ac.replace(" forms","");}if((!Af)||Af.did!=="1,22"&&Af.did!=="1,57"){Ad.singleSelectByField("1,22","did");}}else{W.toggleClass(Ab,"forms",true);if((Ac||"").indexOf(" forms")===-1){Ad.cssClass=(Ac||"")+" forms";}if(!Af||Af.did==="1,22"||Af.did==="1,57"){Ad.singleSelect(2);}}Ad.updateScrollbars();},update:function AV(){var Ag=this.parent.parent.parent,Ae=Ag&&Ag.model,Ac=Ag&&Ag.disableElementsBrowsing,Ab=Ae&&Ae.a,Ad=Ab&&Ac&&Ac(Ab);if(Ad){this.set("items",[{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION}]);}else{if(Ab.ndetype===1){this.children[0].showTooltipForLargeText=false;this.set("items",[{n:mstrmojo.desc(15118,"Selecting in list"),v:N.SELECT,ttpDisabled:true},{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION,cls:"disabled",dsbld:true,ttp:mstrmojo.desc(16184,"This method is not available for this object type.")}]);}else{this.set("items",[{n:mstrmojo.desc(15118,"Selecting in list"),v:N.SELECT},{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION}]);}}var Af=this.getSelectedItem();switch(Ae.et){case AB.AQ:case AB.AL:case AB.AC:if(!Af||Af.v!==N.QUALIFICATION){this.selectItemByField("v",N.QUALIFICATION);}break;default:if(!Af||Af.v!==N.SELECT){this.selectItemByField("v",N.SELECT);}break;}}},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fm",fmPost:"",itemIdField:"did",filter:false,isFirstFm:true,multiSelect:false,minimumSelectCnt:0,hasDummyLabel:false,lastAttrId:null,height:AG-R*4-K*2-AN+"px",onchange:function AT(Ab){d.call(this,Ab,"fm");},bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"},onvisibleChange:function(){this.lastAttrId=null;}}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15119,"Output Level"),cssClass:"baseOn",alias:"metricLabel",bindings:{visible:"this.parent.isMetric && this.parent.showLevel"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"outputLevelPd",items:[{n:mstrmojo.desc(12178,"Visualization level"),v:h.TEMPLATE_LEVEL},{n:mstrmojo.desc(13519,"Dataset level"),v:h.DATASET_LEVEL}],selectedIndex:0,bindings:{visible:"this.parent.isMetric && this.parent.showLevel"},onSelectedItemChange:function AR(Ac,Ad){var Ab=this.parent.parent.parent,Ae=Ab.condition;Ae.level=Ac.v;}}],updateColumnContainer:function AS(){this.target.update();var Ae=this.parent,Aj=Ae.parent,Am=Aj.model,Au=Am&&Am.et,An=this.idx,Ar=this.next,As=Am&&Am.a,Ak=Am&&Am.fm,Ah=Aj&&Aj.inRelation;if(Au){switch(Au){case AB.AQ:case AB.AL:case AB.AC:case AB.AE:case AB.ANDOR:if(As){this.set("isMetric",false);this.set("isAttribute",true);var Aq=Aj.disableElementsBrowsing,Ad=As&&Aq&&Aq(As),Ao=Aj.getAttributeInfo(As.did),Ai=w(Ao)||x(Ao),Al=Aj.disableHierarchyLevel;if(Ai){Am.et=AB.AE;this.set("showChooseMethod",false);}var Ag=(Am.etWas&&Am.etWas===AB.AE)?t:m,Ap=m;if(Am.et===AB.AE&&!Ad){Ap=t;}if(Ag!==Ap||Ap===m||!Ae.next){Ae.removeTrailingContainer(An);if(Ap===m&&Ak){Ae.addNextColumn(AZ.getFnNodeProps());}else{if(Ap===t){Ae.addNextColumn(AZ.getEsNodeProps(Ai,Al));}}}Aj.condition.level=h.DATASET_LEVEL;var At=this.fm;At.updating=true;At.update();this.chooseMethodPd.update();At.updating=false;}break;case AB.MQ:case AB.MC:if(Am.m){this.set("isMetric",true);this.set("isAttribute",false);var Ac=Aj.isMDXDM(Am.m.did),Ab=Aj.condition.level,Af=Aj.editor&&Aj.editor.showLimits;if(Ab!==h.TEMPLATE_LEVEL&&Ab!==h.DATASET_LEVEL){Ab=Aj.condition.level=Af?h.TEMPLATE_LEVEL:h.DATASET_LEVEL;}if(!Ah&&!Ac&&Af){this.set("showLevel",true);this.outputLevelPd.set("selectedIndex",Ab);}else{this.set("showLevel",false);}if(!(Ar&&Ar.fn)){this.parent.insertAndRemoveTrailing(An,AZ.getFnNodeProps());}}break;case AB.R:case AB.F:case AB.XML:this.set("isMetric",false);this.set("isAttribute",false);Aj.condition.level=h.DATASET_LEVEL;this.parent.removeTrailingContainer(An);break;}}else{this.set("isMetric",false);this.set("isAttribute",false);}E.call(this);},setupScrollNodes:function AU(){this.scrollNode=null;}};},getEsNodeProps:function A(AW,AR){var AV=AW?"HierarchyElementsCheckListBrowser":"ElementsBrowser",AQ=[{scriptClass:"mstrmojo.vi.ui."+AV,alias:"es",height:AG-5+"px",disableLevel:AR,update:function AU(){var Aa=this.parent.parent.parent,Ab=Aa.model,AZ=Ab&&Ab.a,AY=!!AZ&&!AZ.ilk;if(!AY){return ;}this.set("ifDataSource",Aa.getIfDataSource());this.onUpdateBrowseElementsParams=function(Ae){Aa.onUpdateBrowseElementsParams(Ae);};if(!Ab.es){Ab.es=[];}if(AW){var Ad=Aa.getAttributeInfo(AZ.did);Y.copyProps(["t","st"],Ad,AZ);if(Ad&&Ad.attId){Ad=Aa.getAttributeInfo(Ad.attId);}Y.copyProps(["fs","lvfs"],Ad,AZ);}else{if(!AZ.fs){Y.copyProps(["fs"],Aa.getAttributeInfo(AZ.did),AZ);}}var Ac=Y.clone(AW?Ab.data:Ab.es);this.set("attribute",AZ);this.set("selectedItems",Ac);},onBrowseElementsFailure:function AP(){var Ab=this.attributeId,AY=this.parent.parent,Aa=AY.parent,AZ=P.filterOne(Aa.targets,function(Ad){return Ad.did===Ab;});AZ.isInvalid=true;AZ.cls=(AZ.cls||"")+" invalid";Aa.set("model",{et:5,isNew:true,defaultETAttr:5});var Ac=AY.target.target;Ac.openPopup(Ac.getPopupWidget());},onItemsSelectionChange:function AX(AY){var AZ=this.parent.parent.parent,Aa=AZ.model;Aa.edit(AW?"data":"es",AY);}}];return{alias:"es",children:AQ,cssClass:"lastStage",updateColumnContainer:function AS(){this.es.update();},setupScrollNodes:function AT(){this.scrollNode=null;}};},getFnNodeProps:function c(){var AT=this,AQ=[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrApp.isWSStyling?mstrmojo.desc(15006,"Operator"):mstrmojo.desc(9579,"Condition")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"fnTypePulldown",items:[{n:mstrmojo.desc(15302,"By Value"),v:V.VALUE},{n:mstrmojo.desc(15303,"By Rank"),v:V.RANK_PERCENTAGE}],onSelectedItemChange:function AU(AW,AY){var AX=this.parent;AX.fn.update();}},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fn",multiSelect:false,allowUnlistedValues:false,hideCheckMark:true,itemIdField:"did",onchange:function AP(AW){d.call(this,AW);},update:function(){var AY=this.parent,Ac=AY.parent.parent,AX=Ac.model||{},Ad=AX.et,Ab,Ae=false,Af,AW,Ah=V.BOTH;switch(Ad){case AB.AE:Ae=!!AX.a;break;case AB.AQ:case AB.AC:case AB.AL:Ae=!!(AX.fm&&AX.fm.did);Ab=Ae?AX.fm.dtp:null;break;case AB.MQ:case AB.MC:Ae=!!AX.m;Ab=Ae?M.METRIC_DTP:null;Ah=AY.fnTypePulldown.getSelectedItem().v;break;}if(!Ae){return ;}var Ag=o[Ab];if((this.lastEt!==Ad)||(this.lastFnDtp!==Ag)||(this.lastFnTypeToDisplay!==Ah)){this.lastEt=Ad;this.lastFnDtp=Ag;this.lastFnTypeToDisplay=Ah;var Aa=Ad?z[Ad]:null,AZ=Aa&&Aa.key;Af=(AZ&&Ac[AZ])||Aa.def||[];if(typeof (Af)==="object"){Af=Af[Ag]||Af["*"];}if(Ah!=V.BOTH){Af=P.filter(Af,function(Ai){var Aj=Ai.tp===n.PER||Ai.tp===n.RANK;return Ah===V.RANK_PERCENTAGE?Aj:!Aj;});}AW=AL(AX.fn,AX.fnt||1);AW=P.filterOne(Af,function(Ai){return Ai.did===(AW&&AW.did);});q(this,Ae,Af,AW);if(!AW){this.set("selectedIndex",0);}}this.parent.updateScrollbars();}})];return{alias:"fn",children:AQ,updateColumnContainer:function AV(){var Ae=this.parent,Aa=Ae.parent,AZ=Aa.model,Ab=AZ&&AZ.fn,Ad=AZ&&AZ.fnt,Ac=AZ&&AZ.et,AY=this.next,AX=Ab===Z.IS_NULL||Ab===Z.IS_NOT_NULL,AW=(Ac===AB.MC||Ac===AB.MQ);this.changeFnTypePdVisibility(AW);if(AW){this.fnTypePulldown.getPopupList().singleSelectByField((Ad===n.RANK||Ad===n.PER)?V.RANK_PERCENTAGE:V.VALUE,"v");}else{this.fn.update();}if(Ab&&AX){Ae.removeTrailingContainer(this.idx);}else{if(Ab&&!(AY&&AY.c0)){Ae.insertAndRemoveTrailing(this.idx,AT.getC0NodeProps());}}AY=this.next;if(AY){AY.updateColumnContainer();}},changeFnTypePdVisibility:function AS(AX){this.fnTypePulldown.set("visible",AX);var AW=AG-AN-R;if(AX){AW-=(R+K);}this.fn.set("height",AW+"px");},setupScrollNodes:function AR(){this.scrollNode=null;}};},getC0NodeProps:function O(){var AR=this;return{alias:"c0",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(527,"Value")},k({alias:"c0",cstIndex:0}),{scriptClass:"mstrmojo.Label",alias:"btwn",cssClass:"btwn",text:mstrmojo.desc(308,"and"),visible:false},k({alias:"c1",cstIndex:1,visible:false}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.c0);},visible:false},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fm2",fmPost:2,itemIdField:"did",filter:false,multiSelect:false,minimumSelectCnt:0,hasDummyLabel:false,height:AG-R*4-K*2-AN+"px",onchange:function AP(AT){d.call(this,AT,"fm2");}})],updateColumnContainer:function AS(){this.c0.update();var Ac=this.parent,AY=Ac.parent,AX=Ac.parent.model,Aa=AX&&AX.fn,AT=Aa===Z.BETWEEN||Aa===Z.NOT_BETWEEN||Aa===S.BETWEEN||Aa===S.BETWEEN_DESCENDING,AZ=Aa===Z.EQUAL||Aa===Z.NOT_EQUAL||Aa===Z.GREATER||Aa===Z.GREATER_EQUAL||Aa===Z.LESS||Aa===Z.LESS_EQUAL,Ab=this.idx,AW=this.next;this.browseLink.set("visible",AY.objectBrowsingEnabled&&AK(AX,AY.ets));this.btwn.set("visible",AT);var AV=this.c1;AV.set("visible",AT);if(AT){AV.update();}else{if(AX.c1){AX.edit("c1",{v:null,dtp:null,skipET:true},true);}}if((!AX.a)&&AX.m&&this.domNode){W.addClass(this.domNode,"lastStage");}var AU=this.fm2;if(AX.a2&&AZ){AU.update();AU.set("visible",true);}else{AU.set("visible",false);}E.call(this);},setupScrollNodes:function AQ(){this.scrollNode=null;}};},browseObjs:function AC(AU,AT,AW){var AS=X.position(AU.parent.containerNode);AW=AW||{};AW.x=AS.x+40;AW.y=AS.y;this._super(AU,AT,AW);var AQ=AU.ob.browser,AP=AU.parent.opener.docModel,AR=AT.alias,AV=AU.model.et;AP.controller.rootCtrl.loadDataProvider(function(AX){if(AR==="target"||AV===AB.AQ){AQ.rootFolder={did:"6F55FB47F9974EABA18CB0C5FF46785C"};}else{if(AV===AB.MQ){AQ.rootFolder={did:"E0CCB9CF22104A489CBE78D974AFD19E"};}}AQ.model=AP;AQ.set("dataProvider",AX);AQ.set("opened",true);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.DatasetUnitMenuUtils");var A=mstrmojo.vi.ui.DatasetUnitMenuUtils;mstrmojo.vi.ui._CanDropFromSchema=mstrmojo.provide("mstrmojo.vi.ui._CanDropFromSchema",{_mixinName:"mstrmojo.vi.ui._CanDropFromSchema",augmentDropContextForSchema:function B(E,C){var F=E.getCtxtDragData();if(F.src===mstrmojo.vi.models.EnumDragSources.ALL_OBJECT_LIST){var D=A.getCfgForAddUnitFromAllObject(F.items,C.datasets||{});F.dsid=D.dsid;if(D.actions.length){E.actions=D.actions;E.callback=C.getDatasetsUpdateCallback();}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.viz.DropZoneHelper","mstrmojo.string","mstrmojo.vi.ui.DatasetUnitMenuUtils");var G="mstrmojo-VIUnitList",I="icn clsx_sub",D=mstrmojo.vi.viz.DropZoneHelper.isMetricNames,C=mstrmojo.vi.ui.DatasetUnitMenuUtils,J=mstrmojo.string;mstrmojo.vi.ui.VIDragUnit=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.ui.VIDragUnit",getItemDisplayName:function F(K){return K.n;},getUnitAvatar:function A(N,Q){var M=document.createElement("div"),P=N.getCtxtDragData(),K=P.items,L=['<div class="',[G,mstrApp.getThemeClassName()].join(" "),'">'],O=this;K.forEach(function(S){var U=O.getItemDisplayName(S),R="item unit isAvatar "+C.getUnitCssClass(S);if(D(S)){U=mstrmojo.desc(3582,"Metrics");R+=" is-mh";}L.push('<div class="'+R+'"><span class="txt" unselectable="on">'+(Q?J.encodeHtmlString(U):U)+"</span></div>");});L.push("</div>");M.innerHTML=L.join("");return M.removeChild(M.firstChild);},getUnitDragData:function B(M,K){var L=this.setAvatarClass.bind(this);return{items:K,item:K[0],setAvatarClass:function N(P){L(M,P);},setInvalidAvatarClass:function O(){L(M,I);}};},getDragUnitOffsets:function E(){return{x:21,y:16};},setAvatarClass:function H(N,K){var L=N.avatar;if(L){var M=[G,"hasOwnAvatar",mstrApp.getThemeClassName(),K||""];L.className=M.join(" ");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.vi.ui.DatasetUnitMenuUtils");var B=mstrmojo.vi.ui.DatasetUnitMenuUtils;mstrmojo.vi.ui.UnitList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.vi.ui.UnitList",init:function C(D){this._super(D);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIUnitList");},getItemProps:function A(F,D){var E=this._super(F,D);E.addCls("unit "+B.getUnitCssClass(F));return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.ConditionInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-condition",folderLinksContextId:10,browsableTypes:[B.TP.FOLDER,B.TP.FILTER,B.STP.PROMPT_OBJECTS].join(","),noEditButton:true,maxObjectCount:1,getCandidatesThroughTaskCall:function A(D,C){D.rootFolderType=39;D.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getFilters(D,C);},hideItemWidgetBrowseButton:function(){return this.isDME;}});})();(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.TransformInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-transform",items:[],noEditButton:true,folderLinksContextId:26,browsableTypes:[B.TP.FOLDER,B.TP.ROLE].join(","),getCandidatesThroughTaskCall:function A(E,D){mstrmojo.ME.MetricDataService.getTransformations(E,D);},hideItemWidgetBrowseButton:function C(){return this.isDME;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ME.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME.Enum");mstrmojo.requiresDescs(1107,12178);var J=mstrmojo.expr,D=mstrmojo.ME.Enum.DYNAMIC_DIMTY;mstrmojo.ME.LevelInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-level",oncandidatesChange:function F(E){this.candidates.items=D.getItems("level").concat(this.candidates.items);},hidePulldownButton:function(){return !this.isDME;},hideItemWidgetBrowseButton:function(){return this.isDME;},folderLinksContextId:16,browsableTypes:[J.TP.FOLDER,J.TP.ATTR,J.TP.DIM].join(","),getCandidatesThroughTaskCall:function K(L,E){L.rootFolderType=39;L.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(L,E);},itemFunction:function B(M,E,L){M.filtering=M.filtering||1;M.grouping=M.grouping||1;var N=this._super(M,E,L,mstrmojo.ME.LevelObjectItem);N.optionButtonVisible=true;return N;},updateSuggestion:function C(E){E=[{n:this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level"),did:-1,t:-1,state:0}].concat(E);if(this._super){this._super(E);}},add:function H(L,E){var N=true,M=this.items;mstrmojo.array.forEach(L,function(O){mstrmojo.array.forEach(M,function(P){if(P.did&&P.did===O.did){N=false;return false;}});});if(N){this._super(L,E);}}});mstrmojo.ME.LevelObjectItem=mstrmojo.declare(mstrmojo.ME.ObjectItem,[mstrmojo._HasPopup],{optsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9598,"Level Options"),cssText:"width: 450px;",onOpen:function A(){var E=this.opener.data;this.filterOption.set("value",E.filtering);this.groupOption.set("value",E.grouping);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9599,"Relationship with Report Filter:")},{scriptClass:"mstrmojo.Pulldown",alias:"filterOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9600,"Standard - Metric calculates only for elements found in the filter"),did:1},{n:mstrmojo.desc(9601,"Absolute - Raises the calculation to the selected level, if possible"),did:2},{n:mstrmojo.desc(9602,"Ignore - Omit filtering criteria based on selected level and its related attributes"),did:3},{n:mstrmojo.desc(9603,"None - Unspecified - the selected level and group components define the filter"),did:4}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9604,"Metric Aggregations:")},{scriptClass:"mstrmojo.Pulldown",alias:"groupOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9605,"Standard - Metric calculates at the selected level, if possible"),did:1},{n:mstrmojo.desc(9606,"None - Exclude the selected level and children from the GROUP BY clause in the SQL"),did:2},{n:mstrmojo.desc(9607,"Beginning lookup - Use the first value of the lookup table"),did:3},{n:mstrmojo.desc(9608,"Ending lookup - Use the last value of the lookup table"),did:4},{n:mstrmojo.desc(9609,"Beginning fact - Use the first value of the fact table"),did:5},{n:mstrmojo.desc(9610,"Ending fact - Use the last value of the fact table"),did:6}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,L=E.opener;if(L.saveOnClose){L.saveOnClose(E.filterOption.value,E.groupOption.value);}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},saveOnClose:function G(E,M){var L=this.data;L.filtering=E;L.grouping=M;if(this.parent.onSaveOnClose){this.parent.onSaveOnClose();}},options:function I(){this.openPopup("optsRef",{title:'"'+this.data[this.itemField]+'" '+mstrmojo.desc(9598,"Level Options"),zIndex:40});}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISourceObjects","mstrmojo.DI.DIAnalytics","mstrmojo.date","mstrmojo.string");mstrmojo.requiresDescs(14214,14534);var H=["MM/DD/YYYY","today","yesterday"],Q=/^\d+daysAgo$/;var I=mstrmojo.DI.DIConstants.sourceType;var f=mstrmojo.DI.DIConstants;var D="###";var A="yyyy-MM-dd";var N=mstrmojo.string;var E=mstrmojo.DI.DIHelpers.isOperationMode,O=mstrmojo.array,R=mstrmojo.locales,a=mstrmojo.date;var J={scriptClass:"mstrmojo.DI.DIAnalytics",alias:"analyticsComponent",slot:"analyticsNode"};function U(j){var h;if(j.toUpperCase()==="MM/DD/YYYY"){h="YYYY-MM-DD";}else{if(mstrmojo.array.indexOf(H,j)!==-1||Q.test(j)){h=j;}else{var k=a.parseDate(j);var g=mstrmojo.date.getDateJson(k?new Date(k.year,k.month-1,k.day):"");if(g.day.toString()!=="NaN"){h=mstrmojo.date.formatDateInfo(g,"yyyy-MM-dd");}else{mstrApp.getRootController().displayError(mstrmojo.desc(14214,"Requests can only specify a date formatted as MM/DD/YYYY, or as a relative date (e.g., today, yesterday, or N days ago where N is a positive integer). Please change your input into any of the aforementioned formats."),false);return ;}}}return h;}function S(g){var j,h=g.dateTable;if(h.dates.selectedIndex===0){j="&start-date="+U(h.fromDate.value)+"&end-date="+U(h.toDate.value);}else{j="&dynamic-date={"+h.dates.items[h.dates.selectedIndex].qn+"}";}return j;}function F(g,h){var j,k;j=S(g);var l=h.address.replace("${PROFILEIDS}","ga:"+g.selectedProfile.id);k=l+j;return k;}function P(g){g=g.substr(g.indexOf("?")+1);return decodeURIComponent(g);}function Y(h,j){var k=h.indexOf(j);if(k===-1){return"";}var g=h.indexOf("&",k+j.length)===-1?h.length:h.indexOf("&",k+j.length);return h.substring(k,g);}function V(h,g){var j="";if(g.node){j=h+D+"accountID:"+this.selectedAccount.id+",webPropertyID:"+this.selectedWebProperty.id+",profileID:"+this.selectedProfile.id+",folderName:"+g.node.parent.text;}else{j=h+D+"accountID:"+this.selectedAccount.id+",webPropertyID:"+this.selectedWebProperty.id+",profileID:"+this.selectedProfile.id;}return j;}function L(h){var g,o,p,l,m,j;if(this.tableID){g=this.model.getImportSource(this.tableID);}if(this.currentSource){g=this.currentSource;}if(!g){return ;}o=g.sourceInfo.url.substr("SQL=".length);p=o.indexOf(D);if(p>-1){var k=o.substr(p+D.length,o.length);k=k.split(",");l=this.model.externalSources[I.googleAnalytics];var n=this.analyticsComponent.accountTable;switch(h){case"accountID":mstrmojo.array.forEach(k,function(t){var q=t.split(":");if(q[0]===h){m=mstrmojo.array.find(l.accounts,"id",q[1]);n.account.set("selectedIndex",m);}});break;case"webPropertyID":mstrmojo.array.forEach(k,function(t){var q=t.split(":");if(q[0]===h){m=mstrmojo.array.find(l.accounts[n.account.selectedIndex].webProperties,"id",q[1]);n.webproperty.set("selectedIndex",m);}});break;case"profileID":mstrmojo.array.forEach(k,function(t){var q=t.split(":");if(q[0]===h){m=mstrmojo.array.find(l.accounts[n.account.selectedIndex].webProperties[n.webproperty.selectedIndex].profiles,"id",q[1]);n.profiles.set("selectedIndex",m);}});break;case"folderName":mstrmojo.array.forEach(k,function(t){var q=t.split(":");if(q[0]===h){j=q[1];}});return j;}}}function e(){var h=mstrApp.getRootController().getModel(),k="CustomQuery",j=this.customQueryCnt,g;if(!j){j=1;}do{g=k+j;j++;}while(!h.isTableAliasUnique(g));return g;}function d(){var n=[];var q,k,j;var h=this.model.operationMode;var l=this.browser.fileTree,p,o=this.analyticsComponent;var m=this.tableID||null,g;if(E(this.operationMode)){h=this.operationMode;}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(this.analyticsComponent.ultp.selectedIndex===0){for(k=0;k<l.selectedNodes.length;k++){j=l.selectedNodes[k].data;q={n:j.n,desc:j.desc,type:j.type,tableID:m};if(!mstrApp.isSingleTier){q.node=l.selectedNodes[k];}p=F(this.analyticsComponent,j);p=P(p);p=V.call(o,p.trim(),j);q.query=p;n.push(q);}}else{if(this.analyticsComponent.ultp.selectedIndex===1){q={desc:"Google Analytics",type:"file",tableID:m,node:null};if(m){g=mstrApp.getRootController().getModel().getImportSource(m);if(g&&g.sourceInfo){q.n=g.sourceInfo.name;}else{q.n=e.call(this);}}else{q.n=e.call(this);}p=this.textarea.value.substr(this.textarea.value.indexOf("ids=ga"));p=P(p);p=V.call(o,p.trim(),q);q.query=p;n.push(q);}}return n;}function X(l){var h=true;var g=d.call(this),k=this.tableID||null,j=mstrApp.getRootController();if(k){mstrApp.getRootController().refreshDataOAuthReport(this.sourceObjectsInfo.type,this.sourceObjectsInfo.subtype,k,g[0],f.actions.refreshData);}else{mstrApp.getRootController().importMultiOAuthReports(this.sourceObjectsInfo.type,g,h,!mstrApp.getRootController().model.hasEMMAReportInstance(),l,this.sourceObjectsInfo.subtype,this.id);}}mstrmojo.DI.DISourceObjectsGA=mstrmojo.declare(mstrmojo.DI.DISourceObjects,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DISourceObjectsGA",cssClass:"mojo-di-sourceobjectsga",refreshed:false,populate:function(t){var w=[],m,h,g,k,q=this.analyticsComponent.accountTable;var l=this.model.externalSources[I.googleAnalytics];var j=this.model.operationMode;if(E(this.operationMode)){j=this.operationMode;}if(t&&t.targetPageId){if(t.targetPageId!==this.id){return ;}}for(m in l.accounts){w.push({n:l.accounts[m].n,v:m});}q.account.set("items",w);q.account.notExist=false;if(this.tableID&&(j===f.operationMode.refresh||j===f.operationMode.edit)){L.call(this,"accountID");if(q.account.selectedIndex===-1){q.account.notExist=true;mstrApp.getRootController().displayError(mstrmojo.desc(14534,"The user has not been granted permissions on the account."),false);if(q.account.items.length>0){q.account.set("selectedIndex",0);}}}else{q.account.set("selectedIndex",0);}q.account.refresh();var p=this.model.externalSources[this.sourceObjectsInfo.type].reports;var o=mstrApp.getRootController().parseOAuthSourceFolder(this.sourceObjectsInfo.type,p);this.browser.set("fileList",o);if(j===f.operationMode.refresh||j===f.operationMode.edit){if(this.tableID){g=this.model.getImportSource(this.tableID);}if(this.currentSource){g=this.currentSource;}if(g&&g.sourceInfo&&g.sourceInfo.name){var n=g.sourceInfo.dbTableName;var u=L.call(this,"folderName");if(n.indexOf("CustomQuery")<0&&n.indexOf("Google Analytics Query")<0&&!!u){h=this.browser.fileTree.items;if(u){for(k=0;k<h.length;k++){if(h[k].isFolder===true&&h[k].n===u){this.browser.autoSelectNode(h[k].node,"/"+n);h[k].fetched=true;h[k].node.set("state",1);}}}}}}},onHelpButtonClick:function c(){return"Importing_data_from_google_analytics.htm";},onNextButtonClick:function K(){X.call(this);},onFinishButtonClick:function(){X.call(this,f.actions.savePublish);},asDataPrepare:function(){return d.call(this);},handleImportError:function(h,g){if(this.analyticsComponent.ultp.selectedIndex===0){this.browser.set("forceEnableContinue",!this.tableID);O.forEach(h,function(k,j){if(g[j].success===true){k.node.deselect();}});}return true;},onEditButtonClick:function G(h){var g=this.analyticsComponent;var k=g.ultp;var j;j=F(g,h.data);h.data.browser.parent.textarea.value=j;k.setSelectedItems(k.items[1]);h.data.browser.parent.textarea.focus();},postBuildRendering:function b(){if(this._super){this._super();}this.model.externalSources[I.googleAnalytics].attachEventListener("analyticsWebPropertiesFetched",this.id,this.populateWebProperties);this.model.externalSources[I.googleAnalytics].attachEventListener("analyticsProfilesFetched",this.id,this.populateProfiles);this.populateDate();},populateDate:function Z(){var h=this.model.operationMode,j=this.analyticsComponent.dateTable,g;if(E(this.operationMode)){h=this.operationMode;}if(h===f.operationMode.refresh||h===f.operationMode.edit){if(this.tableID){g=this.model.getImportSource(this.tableID);}if(this.currentSource){g=this.currentSource;}if(g){var t=g.sourceInfo.url.substr("SQL=".length);t=t.substring(0,t.indexOf(D));if(t.indexOf("start-date=")!==-1){j.dates.set("selectedIndex",0);var q=Y(t,"start-date=").substr("start-date=".length);var n=Y(t,"end-date=").substr("end-date=".length);var w;w=a.parseDate(q,false,A);if(!w){w=a.parseDate(q);}q=w?a.formatDateInfo(w,R.datetime.DATEOUTPUTFORMAT):q;j.fromDate.set("value",q);w=a.parseDate(n,false,A);if(!w){w=a.parseDate(n);}n=w?a.formatDateInfo(w,R.datetime.DATEOUTPUTFORMAT):n;j.toDate.set("value",n);}else{if(t.indexOf("dynamic-date={")!==-1){var m=t.substring(t.indexOf("dynamic-date={")+"dynamic-date={".length,t.indexOf("}",t.indexOf("dynamic-date={")+"dynamic-date={".length));var p=3;var u=j.dates.items;for(var l=0,o=u&&u.length||0;l<o;l++){var k=u[l];if(k&&k.qn.indexOf(m)>-1){p=l;}}j.dates.set("selectedIndex",p);}}}}},postCreate:function C(){this.children=mstrmojo.hash.clone(this.children);if(this._super){this._super();}J.model=this.model;J.tableID=this.tableID;J.currentSource=this.currentSource;this.addChildren([new mstrmojo.DI.DIAnalytics(J)]);},populateWebProperties:function B(g){var k=this.model.operationMode,m=this.analyticsComponent.accountTable,n=m.account.selectedIndex;if(E(this.operationMode)){k=this.operationMode;}if(g&&g.targetPageId){if(g.targetPageId!==this.id){return ;}}var j=[],l;var h=this.model.externalSources[I.googleAnalytics];if(n!==undefined){for(l in h.accounts[n].webProperties){j.push({n:h.accounts[n].webProperties[l].n,v:l});}}m.webproperty.set("items",j);if((k===f.operationMode.refresh||k===f.operationMode.edit)&&(!this.refreshed)&&this.tableID){if(j.length!==0){if(!m.account.notExist){L.call(this,"webPropertyID");}else{m.webproperty.set("selectedIndex",0);}}else{m.webproperty.set("selectedIndex",-1);}}else{m.webproperty.set("selectedIndex",-1);m.webproperty.set("selectedIndex",0);}m.webproperty.refresh();},populateProfiles:function M(g){var j=[],n=this.analyticsComponent.accountTable,l,o=n.account.selectedIndex,k;var h=this.model.externalSources[I.googleAnalytics];var m=this.model.operationMode;if(E(this.operationMode)){m=this.operationMode;}if(g&&g.targetPageId){if(g.targetPageId!==this.id){return ;}}if(g.accountID&&g.accountID!==this.analyticsComponent.selectedAccount.id||g.webPropertyID&&g.webPropertyID!==this.analyticsComponent.selectedWebProperty.id){return ;}if(o!==undefined&&h.accounts[o].webProperties){k=h.accounts[o].webProperties[n.webproperty.selectedIndex];if(k){for(l in k.profiles){j.push({n:k.profiles[l].n,v:l});}}}n.profiles.set("items",j);if((m===f.operationMode.refresh||m===f.operationMode.edit)&&(!this.refreshed)&&this.tableID){if(j.length!==0){if(!n.account.notExist){L.call(this,"profileID");}else{n.profiles.set("selectedIndex",0);}this.refreshed=true;}else{n.profiles.set("selectedIndex",-1);}}else{n.profiles.set("selectedIndex",-1);n.profiles.set("selectedIndex",0);}n.profiles.refresh();},setDimensions:function W(l,j){var g=parseInt(l,10);var k=parseInt(j,10);if(isNaN(g)||isNaN(k)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=Math.max((g-250),0)+"px";this.layoutConfig.w.listNode=Math.max((k-40),0)+"px";if(this._super){this._super(g+"px",j);}if(this.analyticsComponent){this.analyticsComponent.fixObjectBrowserHeight();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo.ui.ColumnWalk","mstrmojo.Button","mstrmojo.mstr.EnumNodeDimty","mstrmojo.ConditionModel","mstrmojo.rw.ConditionWalkProvider");var S=mstrmojo.Widget,J=mstrmojo.array,F=mstrmojo.dom,O=mstrmojo.hash,A=mstrmojo.mstr.EnumNodeDimty,K=mstrmojo.rw.ConditionWalkProvider.setTip,Q=mstrmojo.expr,I=Q.ET;var C=mstrmojo.desc(11899,"Select a dataset object.");var M=J.hash([A.NodeDimtyOutputLevel]);function E(){var X=this.model;if(X){if(!X.attachEventListener){O.make(X,mstrmojo.ConditionModel,{});}X.attachEventListener("edit",this.id,"onmodeledit");}}function N(Y,X){if(X&&X.detachEventListener){X.detachEventListener("edit",Y.id,"onmodeledit");}}function P(c,X){var a=X,b=[],Z=[],Y=[],d=false;O.forEach(a,function(e){b=b.concat(e.att.filter(function(f){return f.did===c;}));});d=b[0]&&b[0].da;b.forEach(function(e){Z=Z.concat(e.fs||[]);});Z.forEach(function(e){if((e.obf||d)&&Y.filter(function(f){return f.did===e.fid;}).length===0){Y.push({did:e.fid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(e.bftp),n:e.fnm,t:e.t,isbf:e.isbf});}});return Y;}function D(c,X){var Y,a=X,b,Z=false;if(typeof microstrategy!=="undefined"){a=a||microstrategy.bones.rwb_viewer.datasetInfos;}O.forEach(a,function(d){Y=d.mx;O.forEach(Y,function(e){if(e.did===c){b=d;Z=e.um||e.rdm;return false;}});return !b;});return Z&&b&&b.isMDX;}mstrmojo.rw.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.rw.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="apply"></div></div>',markupSlots:{conditionNode:function(){return this.domNode.firstChild;},walkNode:function(){return this.domNode.children[1];},applyNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function L(){S.visibleMarkupMethod.call(this);if(this.visible){this.initWalk();}},onheightChange:S.heightMarkupMethod,onwidthChange:S.widthMarkupMethod},layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",applyNode:"auto"},xt:true},editor:undefined,columnWalk:undefined,tip:undefined,walkProvider:null,objectBrowsingEnabled:true,postCreate:function B(){if(this._super){this._super();}if(!this.walkProvider){this.walkProvider=mstrmojo.insert(mstrmojo.rw.ConditionWalkProvider);}},initWalk:function R(){var X=this.columnWalk,Y=this.walkProvider;K.call(this,C);X.removeTrailingContainer(-1);X.addNextColumn(Y.getTargetNodeProps());X.target.updateColumnContainer();this.updateOkBtn();},updateBrowseElementsParams:function(a,Z){a.attributeID=Z.did;a.otp=Z.t||12;var Y=this.editor,X=Y&&Y.onUpdateBrowseElementsParams;if(X){X.call(Y,a,Z);}},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"750px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var X=this.parent;if(X.close){X.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var X=this.parent;if(X.onOK){X.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:C,ignoreLayout:true}],eb:{scriptClass:"mstrmojo.Editor",cssClass:F.isIE7?"mstrmojo-ElementsEditorIE7":"mstrmojo-ElementsEditor",title:mstrmojo.desc(6149,"Select Elements"),help:"element_browser_dialog_box.htm",children:[{scriptClass:"mstrmojo.ElementsBrowser",alias:"browser",onUpdateBrowseElementsParams:function(Y){var X=this.parent.opener;X.updateBrowseElementsParams(Y,X.model.a);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-WebButton hot",cssText:"width: 66px;",onclick:function(){var X=this.parent.parent,Y=X&&X.opener;if(Y){Y.onEBSelect();Y.closePopup();}}},{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-WebButton",cssText:"min-width: 66px; margin-left: 11px;",onclick:function(){var X=this.parent.parent,Y=X&&X.opener;if(Y){Y.closePopup();}}}]}]},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,upButtonVisible:true,scrollableIncFetch:true,showCompletePath:false,closeable:false,closeOnSelect:false,browsableTypes:"3,4,8,10,12,256",includeObjectDesc:true,quickSearch:true,minSearchLength:1}]},_set_model:function V(a,X){var Y=this.model,Z=(X!==Y);if(Z){N.call(this,Y);X.dimtyTypes=this.dimtyTypes||M;this.model=X;E.call(this,X);if(this.hasRendered&&this.visible){this.columnWalk.target.updateColumnContainer();}}return Z;},onmodeledit:function H(Y){var X=Y.prop,a=X==="c0"||X==="c1",Z=this.columnWalk[a?"c0":X];if(a){Z.c1Selected=X==="c1";}Z.updateColumnContainer();Z.c1Selected=false;this.updateOkBtn();},browse:function G(Z){var b=this.parent.editorNode,a=function(d,f){var c=mstrmojo.dom.position(d,true),e=mstrmojo.dom.position(f,true);return{x:c.x+c.w,y:e.y};},X=this.columnWalk,Y=this.walkProvider;switch(Z&&Z.alias){case"target":case"dmy":Y.browseObjs(this,Z,a(Z.alias==="target"?X.target.domNode:this.dmyNode,b));break;case"c0":case"c1":Y.browseObjs(this,Z,a(X.c0.domNode,b));break;case"es":Y.browseEs(this,Z,a(X.es.domNode,b));break;}},onOBSelect:function(b){var Z=this.ob.browser,d=Z.target;this.closePopup();var Y=this.targets,c=d.itemIdField,a=Y||[],X=J.find(Y,c,b[c]);if(X===-1){a.push(b);this.targets=a;this.targetsLastMod=new Date();this.raiseEvent({name:"updateTargets",targets:this.targets});}d.setSelectedItems([b],d.multiSelect);if(d.onObjBrowsed){d.onObjBrowsed(b);}},onEBSelect:function(){var Y=this.eb.browser,a=this.columnWalk.es.es;a.set("selectedIndices",{});var X=a.items,Z=[];J.forEach(Y.selectedItems||[],function(c){if(J.find(a.items,"v",c.v)<0){Z.push(c);}});var b=a.insertUnlistedValuesAt||0;if(b<0){b=X.length;}a.set("items",X.slice(0,b).concat(Z).concat(X.slice(b)));a.setSelectedItems(Y.selectedItems,false);},destroy:function U(Y){var X=this.walkProvider;if(X&&X.destroy){this.walkProvider.destroy();}this._super(Y);},updateOkBtn:function W(){var a=true,X=this.model,Y,Z=X&&Q.fnCstCount(X.fn,X.fnt);if(!X){return ;}switch(X.et){case I.AQ:case I.AL:case I.MQ:for(Y=0;Y<Z;Y++){a=a&&!this["invalid"+Y];}break;}a=a&&!!X.completed;this.okBtn.set("visible",a);this.raiseEvent({name:"conditionWalkUpdateOkBtn",valid:a});}});mstrmojo.rw.ConditionWalk.getAttForms=P;mstrmojo.rw.ConditionWalk.isMdxDM=D;}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.dom","mstrmojo.Label","mstrmojo.tooltip","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.DI.DIHelpers","mstrmojo.locales","mstrmojo.date","mstrmojo.css","mstrmojo.string","mstrmojo.AS.DIAppSchemaService","mstrmojo.AS.DIAppSchemaRepublishOAuthButton");var E=mstrmojo.array,H=mstrmojo.hash,F=mstrmojo.DI.DIHelpers,G=mstrmojo.string,D=mstrmojo.DI.DIConstants,B=mstrmojo.css,A=4*1024*1024,C=[D.sourceType.dropbox,D.sourceType.googleAnalytics,D.sourceType.googleBigQuery,D.sourceType.googleDrive,D.sourceType.salesforce];mstrmojo.AS.DIAppSchemaRefreshFileEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.AS.DIAppSchemaRefreshFileEditor",cssClass:"mstrmojo-di-scheduleEMMA workstation mstrmojo-di-appschema-refresh-file-editor",title:"Update Tables",onClose:function(){mstrApp.getRootController().model.detachEventListener(this.OAuthInfoUpdateListener);},sourceData:null,postData:null,callback:mstrmojo.emptyFn,OAuthInfoUpdateListener:null,preBuildRendering:function(){this.OAuthInfoUpdateListener=mstrApp.getRootController().getModel().attachEventListener("OAuthInfoUpdate",this.id,"OAuthInfoUpdate");if(this._super){this._super();}},OAuthInfoUpdate:function(I){this.localFileList.render();this.checkCanFinish();},checkCanFinish:function(){var K=this.sourceData.fileData,J=mstrApp.getRootController().getModel(),I=true,L=0;E.forEach(K,function(M){sourceType=F.convertDataSourceType2SourceType(M.sourceType);if(M.isOAuth){L++;if(!J.externalSources[sourceType].isLogin){I=false;}}});if((K.length-L)!==H.valarray(this.postData).length){I=false;}this.okButton.set("enabled",I);},children:[{scriptClass:"mstrmojo.Label",text:"Tables below need to be updated."},{scriptClass:"mstrmojo.DataGrid",alias:"localFileList",resizableColumns:false,cssClass:"mstrmojo-di-tablestatuslist mstrmojo-di-appschema-tablestatuslist",columns:[{headerText:"Final Table",headerCss:"",dataField:"name",dataFunction:function(L,J,K){var I=["icon"];if(L.isSubNode===true){I.push("subNode");}else{if(L.isDerivedTable===true){I.push("derivedTableIcon");}else{I.push("tableIcon");}}I=I.join(" ");return'<div class="'+I+'"></div>&nbsp;<div style="width: 200px; text-overflow: ellipsis; overflow: hidden; display: inline-block; white-space: nowrap">'+L.name+"</div>";}},{headerCss:"",dataField:"button",colWidth:100,dataWidgetBuilder:function(M){if(!M.isSubNode){return false;}else{var I;var K=mstrmojo.DI.DIHelpers.convertDataSourceType2SourceType(M.sourceType);if(C.indexOf(K)>-1){var L=mstrApp.getRootController().getModel().externalSources[K],J=!!L.isLogin;M.isOAuth=true;I={scriptClass:"mstrmojo.AS.DIAppSchemaRepublishOAuthButton",cssClass:"mstrmojo-di-appschema-republish-oauth-button",sourceType:K,isLogin:J,tableId:M.tableId,pipelineId:M.pipelineId};}else{I={browseLabel:"",fileFieldName:"file",scriptClass:"mstrmojo.FileUploadBox",accept:".xls,.xlsx,.csv,.txt,.tsv,.prn,.json,.sas7bdat",onvalueChange:function(){var N=this.parent.parent.parent;this.inputNode.value=this.value;N.postData[M.tableId]=this;B.addClass(this.buttonNode,"mstrmojo-FileUploadBox-FileSelected-button");N.checkCanFinish();}};}return I;}}}]},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var I=this.parent;I.close();}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:"Finish",enabled:false,onclick:function(){var K=this.parent,I=0,L=K.sourceData,J=[];K.postData=H.valarray(K.postData);if(K.postData.length>0){E.forEach(K.postData,function(P,N,M){var O=L.fileData[N];mstrmojo.AS.DIAppSchemaService.uploadFile(P.fileNode,{uploadingId:O.fileId,tableId:O.tableId,pipelineId:O.pipelineId,sheetIndex:O.sheetIndex,workspaceId:mstrAppSchema.workspaceId,mode:D.operationMode.edit},function(Q){I++;if(I===K.postData.length){var R=[];E.forEach(K.postData,function(S){R.push(S.data);});E.forEach(K.sourceData.fileData,function(S){if(S.isOAuth){R.push(S);}});K.callback(R);}});});}else{E.forEach(K.sourceData.fileData,function(M){if(M.isOAuth){J.push(M);}});K.callback(J);}K.close();}}]});})();(function(){mstrmojo.requiresCls("mstrmojo.form","mstrmojo.hash","mstrmojo.Obj","mstrmojo.architect.ui.editors.NameEditor","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.obj.DBRole","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.warehouse.ui.editors.CatalogSQLEditor","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(16036);var R=mstrmojo.hash,u=mstrmojo.DI.DIHelpers,N=mstrmojo.func.wrapMethods,P=mstrmojo.warehouse.EnumDataChangeEvents,U=P.DBTABLES_CHANGED,AB=mstrmojo.warehouse.EnumObjectTypes,h=AB.DBROLE,o=mstrmojo.DI.DIConstants,S,C,d=57,E="sharingEditorID_WHController";function p(AN,AM){var AL;if(AN){AL=this.model.getDBRole(AN.did);if(AL){return AL;}}if(AM){AL=new mstrmojo.warehouse.obj.DBRole({mdl:this.model});if(AN&&AN.did){AL.did=AN.did;}return AL;}return null;}function W(){var AL="data_source_dialog.htm";if(mstrApp.type===o.xdaType.mdx){AL="Creating_a_data_source_connection_to_an_OLAP_source.htm";}else{if(mstrApp.subtype===o.sourceSubtype.searchOnSource){AL="Creating_a_data_source_connection_to_search.htm";}}return AL;}mstrmojo.warehouse.WHController=mstrmojo.declare(mstrmojo.Obj,null,{start:mstrmojo.emptyFn,getDataService:mstrmojo.emptyFn,loadDBRoles:function D(AM){var AL=this.model;if(mstrApp.isSingleTier){AL.loadDBRoles(AM);}else{AL.loadPrivileges(function(){AL.loadDBRoles(AM);});}},isCloud:function V(){return false;},isUsingCookieNamespace:function A(){return this.model.usingCookieNamespace;},getDBRoles:function G(){return this.model.dbrs;},getAllDBRoleNames:function c(){return this.model.allDBRoleNames;},loadDBObjects:function Q(AL){this.model.loadDBObjects(AL);},getDBObjects:function X(){return this.model.dbObjects;},setNameSpaceID:function f(AL){this.model.set("SelNameSpaceID",AL);},getNameSpaceID:function AA(){return this.model.SelNameSpaceID;},getNameSpaces:function AG(AL){this.model.SelNameSpaceID=undefined;this.model.getNameSpaces(AL);},cancelLoadNameSpaces:function F(){this.model.cancelNameSpaces();},cancelLoadTables:function AD(){this.model.cancelLoadTables();},getColumnsForDBTables:function H(AO,AP){var AL=this.model,AM=AO.tables,AN=AO.getFresh;R.forEach(AM,function(AR){AL.getColumnsForDBTable({data:AR,getFresh:AN},N({success:function AS(AT){AR.items=R.clone(AT.items);},complete:function AQ(){AL.raiseEvent({name:P.DBTABLE_UPDATED,item:AR});}},AP));});},getColumnsForDBTable:function a(AL,AM){if(S&&S.visible){AL.data.dbrole=S.dbRole.did;}this.model.getColumnsForDBTable(AL,AM);},setSelectedDBRoleID:function L(AM){var AL=AM&&AM.mdDBRole&&AM.mdDBRole.usable?parseInt(AM.mdDBRole.usable,10):true;if(AL){this.model.set("SelDBRoleID",AM.did);}else{mstrmojo.alert(mstrmojo.desc(16036,"You don't have 'Use' privilege to perform this operation."));return ;}},updateSelectedDBRoleId:function O(){var AL=this.model.SelDBRoleID;this.model.SelDBRoleID=undefined;this.model.set("SelDBRoleID",AL);},handleDBTableRefresh:function e(AM){var AL=this.model;AL.catalogRefresh=true;this.availableTableSearch("",R.copy(AM,{sourceInfo:"tablesPanel"}));},sqls:undefined,getCurrentZIndex:function b(){if(mstrApp.sessionManager){return mstrApp.sessionManager.zIndex;}else{if(u.getEnvObj().isWS()){return mstrApp.diCurrentZIndex;}}return undefined;},displayCatalogSQL:function AC(AN){var AM=this,AL=this.model,AO=AN||AL.SelDBRoleID;S=S||new mstrmojo.warehouse.ui.editors.CatalogSQLEditor({help:"edit_catalog_options_dialog.htm",cbkOnClose:function(){if(!!this.hasApplied){AL.sourceInfo="tablesPanel";AM.updateSelectedDBRoleId();}}});AM.getDataService().catalogAction({success:function AP(AR){S.options=AR.options;S.SQLStatements=AR.sqls;AL.getDBRole(AO).populate(function AQ(AT){S.dbRole=AT;S.supportsNameSpaces=AT.supportsNameSpaces;S.onUpdateInfo=function AV(AW){AM.getDataService().catalogAction({success:function AX(){if(AL.SelDBRoleID===AO&&AL.SelNameSpaceID){AM.availableTableSearch("",{sourceInfo:"tablesPanel"});}if(AW.callback){AW.callback();}}},{dbrid:AO,info:JSON.stringify(AW.options),flags:10003});};var AU=AM.getCurrentZIndex(),AS={};if(AU){AS.zIndex=AU+1;}S.open(null,AS);});}},{dbrid:AO,flags:10002});},attachDataChangeListeners:function l(AM){var AL=this.model;R.forEach(AM,function(AN,AO){R.forEach(AN,function(AQ,AP){AL.attachEventListener(AP,AO,AQ);});});},editDBRole:function g(AM,AO){var AN=this,AL=(u.isServerBasedWS()||u.isLocalWS())&&!mstrApp.isPopup&&!mstrApp.DIEmbeded;p.call(this,AM,true).populate(function(AP){AN.loadDBObjects({success:function AQ(){C=C||new mstrmojo.warehouse.dbroles.DBRoleEditor({help:W(),scrollable:AL});C.config=AN.model.dbRoleEditorCfg;C.config.showAddDriver=AN.model.showAddDriver;C.callback=AO||mstrmojo.emptyFn;C.dbrole=AP;C.container.dsninfo.clear();C.open();}});});},renameDBRole:function AK(AL){p.call(this,AL,false).populate(function(AM){if(!AM){return ;}var AO=new mstrmojo.architect.ui.editors.NameEditor({data:AM,tp:h,zIndex:9999,isNew:false,help:W(),onOK:function AN(AP){AM.rename(AP);}});AO.open();});},duplicateDBRole:function w(AL){var AM=this;p.call(AM,AL,false).populate(function(AN){if(!AN){return ;}AN.duplicate();});},deleteDBRole:function M(AL){var AM=this;p.call(AM,AL,false).populate(function(AO){var AN=mstrmojo.Button.newInteractiveButton;if(!AO){return ;}mstrmojo.confirm(mstrmojo.desc(10073,"Are you sure you want to delete the Database Connection")+" "+AO.n+"?",null,{buttons:[AN(mstrmojo.desc(219,"Yes"),function AP(){AM.model.deleteDBRole(AO.mdDBRole.did,{success:function AQ(){}});},null,{iconClass:"mstrmojo-Editor-button-Yes"}),AN(mstrmojo.desc(218,"no"),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3169,"delete"),zIndex:9999});});},setProjectPrimaryDBRole:function j(AM,AN){var AL=this.model;AL.SelDBRoleID=AM.did;AL.setProjectPrimaryDBRole(true,AN);},getProjectPrimaryDBRoleID:function K(){return this.model.projPrimaryDBRoleID;},saveDBRole:function I(AM,AL,AP){var AN=this;AN.model.saveDBRole(AM.mdDBRole,AL,N(AP,{success:function AO(AR){var AS=AR.dbr.did,AT=AR.dbr.n,AQ=p.call(AN,{did:AS},true);AQ.populated=false;AQ.n=AT;}}));},populateDBRole:function Z(AL,AM){this.model.populateDBRole(AL,AM);},navigateProject:function m(AL){if(AL){mstrmojo.form.send({evt:3010,Server:AL.sname,Project:AL.pname,Port:AL.port,loginReq:true},mstrApp.name,"POST",null,null,false);}else{mstrmojo.form.send({evt:3010},mstrApp.name,"POST",null,null,false);}},navigateArchitect:function AJ(AL){mstrmojo.form.send({evt:3176,Server:AL.sname,Project:AL.pname,Port:AL.port,loginReq:true},mstrApp.name,"POST",null,null,false);},availableTableSearch:function AF(AL,AM){this.model.getSelectedDBRoleTables(N({blockBegin:0,blockCount:1000,filterText:AL},AM||{}));},getPrimaryDBRoleTablesAndColumns:function AI(AL){this.model.getDBRoleTablesAndColumns({dbRoleID:this.model.projPrimaryDBRoleID},AL);},hasPrivilege:function k(AL){return mstrApp.isSingleTier||this.model.privileges[AL]||false;},validateName:function Y(AN,AL,AM,AO){return this.model.validateName(AN,AL,AM,AO);},findNextName:function AE(AL,AM,AN){return this.model.findNextName(AL,AM,AN);},findinArray:function AH(AL,AN,AM){return this.model.findinArray(AL,AN,AM);},getObjectCount:function B(AN){if(Object.keys){return Object.keys(AN).length;}var AL,AM=[];for(AL in AN){if(AN.hasOwnProperty(AL)){AM.push(AL);}}return AM.length;},destroy:function z(AL){if(C){C.destroy(AL);C=null;}this._super(AL);},cleanError:function t(AL){AL=AL.replace("com.microstrategy.webapi.MSTRWebAPIException:","");AL=AL.replace("Internal Error:","");return mstrmojo.string.trim(AL);},launchOneTierFileBrowser:function n(AL){window.FormWrapper.openFileDialog(AL);},launchOneTierAccessFileBrowser:function n(AL){window.FormWrapper.openAccessDialog(AL);},oneTierFileUploader:function q(AM,AL){mstrApp.serverRequest(R.copy(AL,{taskId:"addDriver"}),AM,true);},clearDBTables:function J(){this.model.raiseEvent({name:U,items:[],selectedItems:[]});},canDisplayCatalogSQL:function x(AP,AO){var AL=mstrmojo.hash.valarray(AP),AN=mstrmojo.array.find(AL,"v",AO),AM=AL[AN];if(mstrApp.isSingleTier){return false;}if((AM.disp&2)===2||(AM.disp&4)===4){return false;}if(!this.hasPrivilege(d)){return false;}return true;},shareDBRole:function(AM){var AL=this;if(!AM||!AM.did){return ;}AL.getDataService().getObjectInfo({success:function(AO){var AP=AO.objects[0],AN=mstrmojo.all[E];if(!AN){AN=new mstrmojo.SharingEditor({id:E,oi:AP,showSharingOptions:false});}else{AN.set("oi",AP);}AN.open();}},{objectIDs:AM.did,objectTypes:h,includeACL:true});}});}());(function(){mstrmojo.requiresCls("mstrmojo.warehouse.DBRoleSelector","mstrmojo.ui.Splitter","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.warehouse.ui.AvailableTablesPanel");var A=mstrmojo.warehouse.EnumDataChangeEvents;mstrmojo.warehouse.WHPanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"WHPanel",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,config:{firstSplit:{v:"300px",min:"100px"},secondSplit:{v:"100%",min:"100px"},resizeHandle:{v:"2px"}},getLayoutOffsets:function C(){return{h:0,w:0};},init:function B(E){this._super(E);var F={},D=F[this.id]={};D[A.DBROLE_SELECTION]=this.onDBRoleSelection;mstrApp.getRootController().attachDataChangeListeners(F);},onDBRoleSelection:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.warehouse.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Button","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.ImageCheckBox","mstrmojo.DI.DIConstants","mstrmojo.DI.FileDragDropBox","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIDragFiles","mstrmojo.DI.DIAuthenticationButton","mstrmojo.string");mstrmojo.requiresDescs(531,12444,12512,12691,12733,12734,12811,12812,13133,14767,15078,15084);var h=mstrmojo.DI.DIConstants,o=mstrmojo.DI.DIHelpers,R=o.isOperationMode,m=0,V=1,a=mstrmojo.array,k="TABLENAME=",l="GENERICPARA=",J=mstrmojo.dom,G="&userId=",b=mstrmojo.Button.newWebButton,L=mstrmojo.string,O="http://localhost?con=true",d="CE connector ready",Q=mstrmojo.hash;var M={ceil:"2.0.0.0",floor:undefined};function Y(z){var x,w,q=[];for(var t=0;t<z.tableList.length;t++){x=JSON.parse(JSON.stringify(z));w=x.tableList[t];for(var u in w){x[u]=w[u];}delete x.tableList;q[t]=k+"{"+w.tableName+"};"+l+"{"+JSON.stringify(x)+"};";}return q;}function U(t){var u=k.length;var q=t.indexOf(l)-1;return t.substring(u,q);}function I(q){if(q.isNewConnector){return h.URLMode.NewConnector;}else{if(q.currentSource&&q.currentSource.sourceInfo.sdkUrl){return h.URLMode.NewConnectorEdit;}else{if(q.isFromCloudElement||(q.currentSource&&q.currentSource.subtype===h.sourceSubtype.cloudElement)){return h.URLMode.CloudElement;}else{return h.URLMode.NormalUrl;}}}}function e(q){switch(q){case"Box":return"box";case"QuickBooks Online":return"quickbooks";case"Sugar CRM":return"sugarcrmv2";case"Microsoft Dynamics CRM":return"dynamicscrmadfs";case"Expensify":return"expensify";case"OneDrive":return"onedrivev2";case"Netsuite ERP 2016":return"netsuiteerpv2";case"Zoho CRM":return"zohocrm";case"SharePoint 2013":return"sharepoint";case"Zendesk":return"zendesk";case"Amazon S3":return"amazons3";case"Desk.com":return"desk";default:return null;}}function D(q){if(q.substring(0,10)===k){return true;}q=q.toLowerCase();q=q.replace(/\s+/g," ");return(q.indexOf("file://")===0)||(q.indexOf("ftp://")===0)||(q.indexOf("http://")===0)||(q.indexOf("https://")===0)||(q.indexOf("hdfs://")===0);}function F(q){var t={protocolDisabled:false,protocol:""};if(!mstrApp.diParams.EnableURLImport){t.protocolDisabled=true;t.protocol="url";}else{q.toLowerCase();q.replace(/\s+/g," ");if(!mstrApp.diParams.EnableFileImport&&(q.indexOf("file://")===0)){t.protocolDisabled=true;t.protocol+="file://";}if(!mstrApp.diParams.EnableFTPImport&&(q.indexOf("ftp://")===0)){t.protocolDisabled=true;t.protocol+="ftp://";}if(!mstrApp.diParams.EnableHttpImport&&(q.indexOf("http://")===0)){t.protocolDisabled=true;t.protocol+="http://";}if(!mstrApp.diParams.EnableHttpImport&&(q.indexOf("https://")===0)){t.protocolDisabled=true;t.protocol+="https://";}}return t;}function c(z){var x;var AA=[];var w;if(this.mode===m){mstrmojo.hash.copy(this.urlList.urls,AA);}else{mstrmojo.hash.copy(this.urlBrowse.getDropZone().urls,AA);}var t=mstrApp.getRootController();var q,AB,u;if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(this.mode===m){if(this.urlInput.value&&this.urlInput.value.length>0){AA.push(this.urlInput.value);}}for(x=0;x<AA.length;x++){u=AA[x].trim();AA[x]=u;if(!D.call(this,u)){t.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}q=F.call(this,u);if(q.protocolDisabled){AB=mstrmojo.desc(12811,"Unable to fetch data. Importing files using #### has been disabled by the administrator.").replace("####",q.protocol);t.displayError(AB,false);return ;}}if(this.mode===m){w=this.urlList;}else{w=this.urlBrowse.getDropZone();}t.importURLEMMA(w,AA,true,!t.model.hasEMMAReportInstance(),this.id,true,z,this.id);}function E(t,x,w,z,AB){var u=/\?/,AA=u.test(t)?"&":"?",q=AB?"env=WS":"",AC=AB?"":"?evt=3172",AD=!!z?("&parameter="+z):"";return t+AA+q+"&callback="+x+AC+w+AD;}function S(t,AB,AE,AA,z,x,w){var u=e(AB);var AC=t+"?sourceName="+(u?u:w)+(AA?"&env=WS":"")+"&tableSelect="+(z?"0":"1"),q,AD;if(x){q=AE.indexOf(l)+l.length+1;AD=window.btoa(encodeURI(AE.substring(q,AE.length-2)));AC=AC+"&parameter="+AD;}return AC;}function g(q){if(!o.isWS()&&!q){console.log("Old version connector (Get).");}else{console.log("New version connector (Post).");}}mstrmojo.DI.DIURLUpload=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.DIURLUpload",cssClass:"mstrmojo-di-fu",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload {@cssClass}" ><div class="mstrmojo-di-URLUpload-networkBrowser"></div><div class="mstrmojo-di-URLUpload-label"></div><div class="mstrmojo-di-URLUpload-urlInput"></div><div class="mstrmojo-di-URLUpload-urlList"></div><div class="mstrmojo-di-URLUpload-info"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},networkBrowserNode:function(){return this.domNode.children[0];},labelNode:function(){return this.domNode.children[1];},urlInputNode:function(){return this.domNode.children[2];},urlListNode:function(){return this.domNode.children[3];},infoNode:function(){return this.domNode.children[4];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},oriFileExt:"",mode:m,singleURL:false,isRefreshPartition:false,isNewConnector:false,isNewConnectorEdit:false,responseHandler:null,workstationResponseEvt:null,afterOAuth:function(){var q=this;window.setTimeout(function(){if(q.popupWnd&&!q.popupWnd.closed){q.popupWnd.close();}q.popupWnd=null;},0);},fetchCEData:function(AB,q){var w=this;if(w.workstationResponseEvt){mstrApp.getRootController().model.detachEventListener(w.workstationResponseEvt);}w.afterOAuth();J.detachEvent(window,"message",w.responseHandler);w.responseHandler=null;if(w.parent){var z;var t=AB.indexOf("&");var AA=AB.substring(t+6,AB.length);AA=decodeURI(window.atob(AA));z=JSON.parse(AA);g(z.isPost);var x=Y(z);for(var u=0;u<x.length;u++){w.urlList.addAuthURL(x[u],q);}w.onNextButtonClick();w.urlList.url=null;}},fetchData:function(t,AD,x){var AC=this;if(AC.workstationResponseEvt){mstrApp.getRootController().model.detachEventListener(AC.workstationResponseEvt);}AC.afterOAuth();J.detachEvent(window,"message",AC.responseHandler);AC.responseHandler=null;if(AC.parent){var w,q=true;var z=t.indexOf("&");var AB=t.substring(z+6,t.length);AC.parent.conParameter+=decodeURI(AB);AB=decodeURI(window.atob(AB));w=JSON.parse(AB);g(w.isPost);if(w&&w.versionNo){if(M.floor){q=(x(M.floor,w.versionNo)!==1?true:false);}if(q&&M.ceil){q=(x(M.ceil,w.versionNo)===1?true:false);}}if(q){var AA=Y(w);if(AC.urlList.visible===false){AC.urlList.set("visible",true);}for(var u=0;u<AA.length;u++){AC.urlList.addAuthURL(AA[u],AD);}AC.onNextButtonClick();AC.urlList.url=null;}else{mstrApp.getRootController().displayError(mstrmojo.desc(15084,"The Intelligence Server version and the SDK version are incompatible."),false);}}},matchAndUpdateTables:function(AA,AB,x,q){var z=this,AC=false,AE,w,AD;if(AB){AE=U(AB);}else{if(z.isRefreshPartition){AE=[];AD=[];Q.forEach(z.urlList.urls,function(AG){var AF=U(AG);AE.push(AF);AD.push("{"+AF+"}");});}else{AE="{"+z.urlInput.value+"}";AD="{"+AE+"}";}}if(z.isRefreshPartition){z.urlList.urls=[];for(var u=0;u<x.length;u++){for(var t=0;t<AE.length;t++){if(AE[t]===U(x[u])||AD[t]===U(x[u])){z.urlList.addAuthURL(x[u],AA);}}}AC=z.urlList.urls.length===AE.length;if(q){q();return ;}}else{for(var u=0;u<x.length;u++){if(x.length===1||AE===U(x[u])||AD===U(x[u])){z.urlInput.value="";AC=true;if(q){w=x[u];}else{z.urlList.addAuthURL(x[u],AA);}break;}}if(q){z.urlInput.value=w;q();return ;}}return AC;},EditData:function(t,AB,AC,q){var AA=this;if(AA.workstationResponseEvt){mstrApp.getRootController().model.detachEventListener(AA.workstationResponseEvt);}AA.afterOAuth();J.detachEvent(window,"message",AA.responseHandler);AA.responseHandler=null;if(AA.parent){var w=t.indexOf("&");var z=t.substring(w+6,t.length);AA.parent.conParameter+=decodeURI(z);z=decodeURI(window.atob(z));var u=JSON.parse(z);g(u.isPost);var x=Y(u);var AD=AA.matchAndUpdateTables(AB,AC,x,q);if(AD){AA.onNextButtonClick();}else{mstrApp.getRootController().displayError(mstrmojo.desc(15078,"Tablename ## cannot be found in the table list.".replace("##",AA.isRefreshPartition?currentTable.join():currentTable)));}if(!o.isServerBasedWS()){mstrApp.getRootController().onCancelButtonClick(true);}AA.urlList.url=null;}},detectCancel:function(w,q){var u=this;var t=setInterval(function(){if(u.popupWnd&&u.popupWnd.closed){w&&w.close();clearInterval(t);if(o.isWS()&&u.workstationResponseEvt){mstrApp.getRootController().model.detachEventListener(u.workstationResponseEvt);}else{J.detachEvent(window,"message",u.responseHandler);}if(!q){mstrApp.getRootController().onCancelButtonClick();}}},500);},init:function n(t){if(this._super){this._super(t);}var AJ={},AG=AJ[this.id]={},AN=mstrApp.getRootController();var AO=t.isSchedule,AU,q;var AY=this;var x=mstrApp.getRootController().getModel();var AI=x.operationMode===h.operationMode.refresh;var AD;this.tableID=this.tableID?this.tableID:(t.currentSource&&t.currentSource.tableID);this.sourceInfo=this.sourceInfo?this.sourceInfo:t.currentSource;if(t.onFinishButtonClick){AU=t.onFinishButtonClick.bind(this);}AG.windowSizeChanged=this.adjustSize;AN.attachDataChangeListeners(AJ);var AK=I(t);if(AK!==h.URLMode.NormalUrl){var AR="";var u=mstrmojo.alert(null,null,null,null,"mstrmojo-alert-hidden");if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}if(AY.workstationResponseEvt){x.detachEventListener(AY.workstationResponseEvt);}var z=window.location.origin+window.location.pathname;if(AK===h.URLMode.NewConnectorEdit){mstrApp.isNewConnectorEdit=true;AY.isNewConnectorEdit=true;AY.isNewConnector=true;mstrApp.newConDbroleId=t.currentSource.sourceInfo.dbRoleId;var AB=t.currentSource.sourceInfo.url;var AC=AB.indexOf(l)+l.length+1;var AQ=window.btoa(encodeURI(AB.substring(AC,AB.length-2)));AD=t.currentSource.sourceInfo.sdkUrl;var AF;var AE={did:mstrApp.newConDbroleId};if(t.currentSource.sourceInfo.clientId){AR=G+window.btoa(encodeURI(t.currentSource.sourceInfo.clientId));}mstrApp.conUrl=AD;if(AO){this.sdkUrl=AD;}if(o.isWS()){AF=E(AD,O,AR,AQ,true);AY.workstationResponseEvt=mstrApp.getRootController().model.attachEventListener("getConnectorParameter",this.id,function(AZ){u&&u.close();AY.EditData(AZ.data,AE);});}else{AF=E(AD,z,AR,AQ,false);q=function w(AZ){u&&u.close();if(AO){AY.EditData(AZ.data,AE,AB,AU);}else{AY.EditData(AZ.data,AE,null,null);}};}AY.popupWnd=o.openPopupWindow(AY.popupWnd,"Authorization",AF);if(!AY.popupWnd){AN.displayError(mstrmojo.desc(12894,"Your browser has blocked the popup for this site. Please enable the popup for this site in order to continue and sign in."),false);}AY.detectCancel(u);}else{if(AK===h.URLMode.NewConnector){AY.isNewConnector=true;AD=mstrApp.conUrl.trim();var AF;var AE={did:mstrApp.newConDbroleId};var AM=function(Aa,Ac){var AZ;Aa=Aa.split(".");Ac=Ac.split(".");for(var Ab=0;Ab<Aa.length;Ab++){var Ae=parseInt(Aa[Ab],10),Ad=parseInt(Ac[Ab],10);if(isNaN(Ae)&&!isNaN(Ad)){AZ=-1;break;}else{if(!isNaN(Ae)&&isNaN(Ad)){AZ=1;break;}else{if(isNaN(Ae)&&isNaN(Ad)){AZ=0;break;}else{if(!isNaN(Ae)&&!isNaN(Ad)){AZ=(Ae-Ad>0?1:(Ae===Ad?0:-1));if(0===AZ){continue;}break;}}}}}return AZ;};if(mstrApp.clientId){var AR=G+window.btoa(encodeURI(mstrApp.clientId));}if(o.isWS()){AF=E(AD,O,AR,null,true);AY.workstationResponseEvt=x.attachEventListener("getConnectorParameter",this.id,function(AZ){u&&u.close();AY.fetchData(AZ.data,AE,AM);});}else{AF=E(AD,z,AR,null,false);q=function w(AZ){u&&u.close();AY.fetchData(AZ.data,AE,AM);};}AY.popupWnd=o.openPopupWindow(AY.popupWnd,"Authorization",AF);if(!AY.popupWnd){AN.displayError(mstrmojo.desc(12894,"Your browser has blocked the popup for this site. Please enable the popup for this site in order to continue and sign in."),false);}AY.detectCancel(u,true);}else{if(AK===h.URLMode.CloudElement){var AX,AL,AW;var AP=AY.model.importSources[AY.tableID];var AA=(AP&&AP.sourceInfo&&AP.sourceInfo.dbRoleId)||(AY.sourceInfo&&AY.sourceInfo.did);var AH,AT;if(x.operationMode===h.operationMode.subscribe&&AP.alternateSource){AD=AP.alternateSource.tableName;}else{AD=AP&&AP.sourceInfo&&AP.sourceInfo.url;}if(AA){AL=a.find(AY.model.cloudElementDBRoles,"did",AA);if(AL>-1){AX=AY.model.cloudElementDBRoles[AL];}}AW={did:AA};var AS=function(Aa){if(Aa.data===d){var AZ={token:AH,callback:o.isWS()?O:z,baseURL:AT};o.sendResponse2Window(AZ,window.location.origin,AY.popupWnd);}else{u&&u.close();if(x.operationMode===h.operationMode.subscribe){var Ab=t.currentSource.sourceInfo.url;AY.EditData(Aa.data,AW,Ab,AU);return ;}if(!AI){AY.fetchCEData(Aa.data,AW);}else{AY.afterOAuth();}}};if(o.isWS()){AY.workstationResponseEvt=x.attachEventListener("getConnectorParameter",this.id,function(AZ){AS(AZ);});}q=function w(AZ){AS(AZ);};AY.popupWnd=o.openPopupWindow(AY.popupWnd,"Authorization","../html/CloudElementWaiting.html");if(!AY.popupWnd){AN.displayError(mstrmojo.desc(12894,"Your browser has blocked the popup for this site. Please enable the popup for this site in order to continue and sign in."),false);}var AV={success:function(Ab){var AZ=AY.sourceInfo.n||(AX&&AX.n);var Aa=AX&&AX.des;AH=Ab.token;AT=Ab.url;AY.popupWnd.location=S("../html/CloudElementWaiting.html",AZ,AD,o.isWS(),AI,AY.tableID,Aa);AY.detectCancel(u,!AY.tableID);},failure:function(AZ){u&&u.close();console.log("error happened when get token, detailed error message is"+JSON.stringify(AZ));}};mstrApp.getRootController().getDataService().getCloudElementToken(AV);}}}if(o.isIE()){window.postMessagePassthrough=function(Aa,AZ){q({origin:AZ,data:Aa});};}if(AY.responseHandler){J.detachEvent(window,"message",AY.responseHandler);}J.attachEvent(window,"message",q);AY.responseHandler=q;}},adjustSize:function p(t){var z=parseInt(t.size.w,10),q=parseInt(t.size.h,10),u,x=parseInt(t.size.layoutH),AA=z/2-340,AB;if(isNaN(z)){return ;}if(!isNaN(q)){this.domNode.style.height=q+"px";}u=this.urlInputNode.children;u[0].style.marginLeft=AA+"px";this.urlList.dnDNode.style.marginLeft=AA+"px";AB=Math.round(z*0.482);u[3].style.width=AB-22+"px";this.labelNode.firstChild.style.paddingTop=q*0.2+"px";var w=this.label.getImageSize().h?parseInt(this.label.getImageSize().h)+5:99;this.urlList.domNode.style.height=x-q*0.2-w-this.labelTitle.domNode.offsetHeight-this.urlInputNode.offsetHeight-2+"px";if(this.mode==m){this.urlList.size={w:u[2].offsetLeft-u[0].offsetLeft+u[2].offsetWidth+"px",h:this.urlList.domNode.style.height,urlpage:true};this.urlList.adjustSize(this.urlList.size);}this.urlBrowse.adjustSize(t.size);},preBuildRendering:function B(){if(this._super){this._super();}this.urlBrowse.multiSelect=!this.singleURL;},onclick:function(q){var u=mstrmojo.dom.eventTarget(q.hWin,q.e);var t=this.urlInput;if(u!==t.domNode){t.blur();}},postBuildRendering:function(){mstrmojo.dom.attachMarkupEvent(this.id,this.containerNode,"click");if(this.mode===h.URLMode.NormalUrl){this.getManagedAuthDBR(this.tableID);}if(this._super){return this._super();}},getManagedAuthDBR:function(t){var q=mstrApp.getRootController();q.getManagedAuthDBR(t);},onHelpButtonClick:function C(){return"Importing_data_from_URL.htm";},onNextButtonClick:function H(){c.call(this,this.tableID?h.actions.refreshData:h.actions.importSource);},onFinishButtonClick:function(){c.call(this,h.actions.savePublish);},onBackButtonClick:function P(){var q=mstrApp.getRootController();q.showPage(h.pageType.dataSelection);},updatePageConfig:function(t){var AA=this,u,x,AB=[],AD=this.urlList,w=this.urlInput,q,z,AC,AE;if(t&&t.properties){mstrmojo.hash.forEach(t.properties,function(AG,AF){AA.set(AF,AG);});}this.set("isRefreshPartition",this.isRefreshPartitionTable());if(this.isRefreshPartition){u=this.tableID;x=this.model.importSources[u];a.forEach(x.sourceInfo.partition.tables,function(AF){AB.push(AF.name||"");});}q=this.model.importSources[this.tableID];z=q&&q.sourceInfo&&q.sourceInfo.dbRoleId;if(z){this.dbroles.updateSelectedItemById(z);AC=a.find(this.model.authDBRoles,"did",z);if(AC>-1){AE=this.model.authDBRoles[AC];}}if(AB.length>1){w.set("value","");if(AD.visible===false){AD.set("visible",true);}a.forEach(AB,function(AF){if(AE){AD.addAuthURL(AF,AE);}else{AD.addURL(AF);}});}else{if(this.isFromCloudElement){}else{w.set("value",t.name);}}},setFilesObject:function(t){if(t.length>0){if(this.mode===m){var u=mstrmojo.string.trim(this.urlInput.value);var q=mstrmojo.array.indexOf(t,u);if(q>=0){t.splice(q,1);this.urlList.setURLsObject(t);}else{this.urlInput.set("value","");this.urlList.setURLsObject(t);}}else{this.urlBrowse.setURLsObject(t);}}},onforceEnableChange:function(){mstrApp.getRootController().sourceSelected(this.forceEnable);},getOperationMode:function(){var q=this.model.operationMode;if(R(this.operationMode)){q=this.operationMode;}return q;},enableImport:function X(){var q=mstrApp.getRootController();if(this.urlList.urls.length>0||(this.urlInput.value&&this.urlInput.value!==""&&this.mode===m)||this.forceEnable===true||(this.mode===V&&this.urlBrowse.getDropZone().urls.length>0)){q.sourceSelected(true);}else{q.sourceSelected(false);}},onmodeChange:function K(){var q;var t=this.urlBrowse.getDropZone();this.btnAdd.updateVisibility();if(this.mode===m){this.urlList.urls=[];this.urlList.dbrs=[];this.urlList.removeChildren();for(q=0;q<t.urls.length;q++){if(t.dbrs.length&&q<t.dbrs.length&&t.dbrs[q]){this.urlList.addAuthURL(t.urls[q],t.dbrs[q]);}else{this.urlList.addURL(t.urls[q]);}}if(this.urlList.urls.length>0){if(this.urlList.visible===false){this.urlList.set("visible",true);}}this.urlList.adjustSize(this.urlList.size);}else{this.urlList.set("visible",false);this.urlBrowse.getDropZone().urls=[];this.urlBrowse.getDropZone().dbrs=[];this.urlBrowse.getDropZone().removeChildren();for(q=0;q<this.urlList.urls.length;q++){if(this.urlList.dbrs.length&&q<this.urlList.dbrs.length&&this.urlList.dbrs[q]){this.urlBrowse.getDropZone().addURL(this.urlList.urls[q],this.urlList.urls[q].substr(this.urlList.urls[q].lastIndexOf("/")+1),false,this.urlList.urls[q],this.urlList.dbrs[q]);}else{this.urlBrowse.getDropZone().addURL(this.urlList.urls[q],this.urlList.urls[q].substr(this.urlList.urls[q].lastIndexOf("/")+1));}}}this.enableImport();},getURLs:function A(){var q=[];if(this.mode===m){q=this.urlList.urls.concat();if(this.urlInput.value.length>0){q.push(this.urlInput.value);}}else{q=this.urlBrowse.getDropZone().urls.concat();}a.forEach(q,function(t,u){q[u]=t.trim();});return q;},isRefreshPartitionTable:function j(){var x=this.getOperationMode(),t,u,q,w=false;if(x===h.operationMode.edit){t=this.tableID;u=this.model.importSources[t];q=u.sourceInfo.partition;w=!!q&&q.isPartition&&u.xdaType===h.xdaType.text;}return w;},children:[{slot:"networkBrowserNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-fu-link",text:mstrmojo.desc(12733,"Network Browser"),alias:"urlRadioList",onclick:function(){if(this.parent.mode===m){this.parent.set("mode",V);this.set("text",mstrmojo.desc(14767,"Data from URL"));this.parent.urlList.dnDNode.style.cssText="";var q=this.parent.urlBrowse.mainPage.content.objectListPanel.browser.domNode;q.style.maxWidth=q.offsetWidth+"px";}else{this.parent.set("mode",m);if(this.parent.currentSource&&this.parent.urlList.dnDNode){var w=this.parent.urlList.dnDNode,u=this.parent.urlInput.domNode,t=this.parent.dbroles.domNode;w.style.cssText="margin-left:"+u.offsetLeft+"px !important; width:"+(t.offsetLeft+t.offsetWidth-u.offsetLeft)+"px;";this.set("text",mstrmojo.desc(12733,"Network Browser"));}}},bindings:{text:function(){if(this.parent.mode===V){return mstrmojo.desc(14767,"Data from URL");}else{return mstrmojo.desc(12733,"Network Browser");}}}},{slot:"labelNode",scriptClass:"mstrmojo.Image",alias:"label",cssClass:"mstrmojo-di-fu-img",src:"../javascript/mojo/css/images/DI/crosstab.svg",bindings:{visible:function(){return this.parent.mode===m;}}},{slot:"labelNode",alias:"labelTitle",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-fu-title",text:mstrmojo.desc(12691,"Data can be in crosstab or tabular format"),bindings:{visible:function(){return this.parent.mode===m;}}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",initValue:false,onvalueChange:function(){if(this._super){this._super();}this.parent.enableImport();},bindings:{visible:function(){return this.parent.mode===m;}},postBuildRendering:function(){this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());if(this._super){return this._super();}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssClass:"mstrmojo-di-fu-url-supported",bindings:{text:function(){return"Use original URL or update with a new URL to refresh this table.";},visible:function(){return this.parent.mode===m&&this.parent.getOperationMode()!==h.operationMode.create;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";this.parent.urlListNode.style.display=this.visible?"none":"block";},ontextChange:function(){this.innerText=this.text;}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:"",cssClass:"mstrmojo-di-fu-url-previously",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===m;}},postBuildRendering:function N(){if((R(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==h.operationMode.create){this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:"));}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:"",cssClass:"mstrmojo-di-fu-url-info",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===m;}},postBuildRendering:function N(){var q=this.parent.model;var u=this.parent.tableID;var w;if(this.currentSource){w=this.currentSource;}else{w=q.importSources[u];}if((R(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==h.operationMode.create){var t=w.sourceInfo.url;if(t.length>90){this.set("text",t.substring(0,65)+"..."+t.substring(t.length-20));}else{this.set("text",t);}this.set("title",t);}}},{slot:"infoNode",scriptClass:"mstrmojo.Label",text:"",cssClass:"mstrmojo-di-url-browser-info",bindings:{visible:function(){return this.text!==""&&!this.parent.isRefreshPartition&&this.parent.mode===V;}},postBuildRendering:function N(){var q=this.parent.model;var u=this.parent.tableID;var w;if(this.currentSource){w=this.currentSource;}else{w=q.importSources[u];}if((R(this.parent.operationMode)?this.parent.operationMode:this.parent.model.operationMode)!==h.operationMode.create){var t=w.sourceInfo.url;if(t.length>75){this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:")+" "+t.substring(0,50)+"..."+t.substring(t.length-20));}else{this.set("text",mstrmojo.desc(13133,"Previously uploaded URL:")+" "+t);}this.set("title",t);}}},{slot:"urlInputNode",scriptClass:"mstrmojo.DI.DIAuthenticationButton",cssClass:"mstrmojo-di-add-authentication",alias:"dbroles",bindings:{visible:function(){return this.parent.mode===m;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";},onvalueChange:function(){if(this.textNode){this.textNode.innerHTML=L.encodeHtmlString(this.value)||"";}}}},{slot:"urlInputNode",alias:"btnAdd",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(531,"Add"),onclick:function(){var q=this.parent.urlInput.value;var t=this.parent.dbroles.getSelectedDBRole();if(q.length===0){return ;}if(this.parent.urlList.visible===false){this.parent.urlList.set("visible",true);}this.parent.urlList.addAuthURL(q,t);this.parent.urlInput.set("value","");},updateVisibility:function(){var q=this.parent;var t=q.getOperationMode();var u=true;if(t===h.operationMode.create){u=true;}else{u=q.isRefreshPartitionTable();}u=(this.parent.mode===m&&u&&!q.singleURL);this.set("visible",u);},postBuildRendering:function(){this.updateVisibility();},markupMethods:{ontextChange:function(){if(this.textNode.innerText){this.textNode.innerText=this.text;}else{this.textNode.innerHTML=L.encodeHtmlString(this.text)||"";}},onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}}},{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",alias:"urlBrowseInput",cssClass:"mstrmojo-di-url-browse-input",initValue:false,onvalueChange:function(){if(this._super){this._super();}this.parent.enableImport();},bindings:{visible:function(){return this.parent.mode===V;}},preBuildRendering:function(){if(this._super){this._super();}this.emptyText=mstrmojo.desc(12812,"Supported URL format: #### ").replace("####",mstrmojo.DI.DIHelpers.getURLCaption());}},{slot:"urlInputNode",alias:"urlBrowseAuthBtn",scriptClass:"mstrmojo.DI.DIAuthenticationButton",cssClass:"mstrmojo-di-browse-add-authentication",bindings:{visible:function(){return this.parent.mode===V;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";},onvalueChange:function(){if(this.textNode){this.textNode.innerHTML=L.encodeHtmlString(this.value)||"";}}}},{slot:"urlInputNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-add-url-browse-button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(12734,"Enter"),onclick:function(){var u=this.parent;var q=u.urlBrowse.getObjectBrowser();var t=u.urlBrowseAuthBtn.getSelectedDBRole();q.clickedNode=q.fileTree;if(t&&t.did!==-1){mstrApp.getRootController().browseURLPath(u.urlBrowseInput.value,u.urlBrowse,t.did);}else{var w=function(z,x){if((u.mode===V)&&x.length&&u.currentSource){z.fileTree.domNode.style.backgroundColor="transparent";z.fileTree.domNode.style.border="0";z.domNode.style.top="0px";z.domNode.style.marginTop="0px";}};mstrApp.getRootController().browseURLPath(u.urlBrowseInput.value,u.urlBrowse,null,w);}},bindings:{visible:function(){return this.parent.mode===V;}},markupMethods:{ontextChange:function(){if(this.textNode.innerText){this.textNode.innerText=this.text;}else{this.textNode.innerHTML=this.textNode.innerHTML=L.encodeHtmlString(this.text)||"";}},onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}}},{slot:"urlListNode",scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"urlList",text:"",draggable:false,fileUpload:false,cssClass:"mstrmojo-di-url-box",bindings:{visible:function(){var t=this.parent,u=t.getOperationMode(),q=this.urls.length>0&&t.mode===m;q=q&&(u===h.operationMode.create||t.isRefreshPartitionTable());return q;}},getFilesCnt:function(){var q=0;if(this.parent.urlInput.value&&this.parent.urlInput.value!==""){q=this.urls?this.urls.length+1:1;}else{q=this.urls?this.urls.length:0;}return q;},getFileUrl:function(q){var w="";if(q<this.urls.length){w=mstrmojo.string.trim(this.urls[q]);}else{if(this.parent.urlInput.value!==""){w=mstrmojo.string.trim(this.parent.urlInput.value);}}if(w.substring(0,10)==k){return w;}var u=w;try{var x=decodeURIComponent(w);w=x===w?w:x;var t=decodeURI(w);w=t===w?encodeURI(w):w;return w;}catch(z){return u;}},getFileUrlDBRole:function(t){var u=this.parent.dbroles,q;if(t<this.urls.length){q=this.dbrs[t];}else{q=u.getSelectedDBRole();}if(q&&q.did===-1){return null;}return q&&q.did;},onurlsChange:function(){if(this._super){this._super();}this.parent.enableImport();if(this.updateItemsCount){this.updateItemsCount(this.getURLCnt());var q=this.getURLCnt();this.updateItemsCount(q);}}},{slot:"urlListNode",scriptClass:"mstrmojo.DI.DIDragFiles",alias:"urlBrowse",supportFolderDrag:false,bindings:{visible:function(){return(this.parent.mode===V);}},postBuildRendering:function(){var q=this.parent,u=q.getOperationMode(),t=u===h.operationMode.create||q.isRefreshPartitionTable();if(mstrmojo.DI.DIDragFiles.prototype.postBuildRendering){mstrmojo.DI.DIDragFiles.prototype.postBuildRendering.call(this);}this.set("multiSelect",t);this.mainPage.content.objectListPanel.browser.set("showBrowseText",true);},ondrop:function Z(q){if(!this.droppable){return ;}var x=q.src.data,t;var w=this.parent.parent.parent;var u=w.parent.urlBrowseAuthBtn.getSelectedDBRole();for(t=0;t<x.length;t++){this.addURL(x[t].data.address,x[t].text,undefined,x[t].data.address,u);}mstrmojo.css.removeClass(this.dnDNode,"dragging");},browseFunction:function W(t){var q=this.parent.parent.parent.parent.parent.urlBrowseAuthBtn.getSelectedDBRole();if(q&&q.did!==-1){mstrApp.getRootController().urlBrowserFunction(t,q.did);}else{mstrApp.getRootController().urlBrowserFunction(t);}},setURLsObject:function f(x){var w,AA,u;var z=[];var t=this.mainPage.content.urlList;for(w=0;t.children&&w<t.children.length;w++){AA=t.children[w];z.push(AA);}u=z.length;for(w=0;w<u;w++){t.removeChildren(z[w]);}t.urls=[];for(w=0;w<x.length;w++){var q=decodeURI(x[w].substr(x[w].lastIndexOf("/")+1));t.addURL(null,q);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.thirdParty.BISourceSelector","mstrmojo.qb.thirdParty.SourceInput","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12384);var B=mstrmojo.DI.DIHelpers;var D="firstSplitNode",I="secondSplitNode";var H=0,C=1;mstrmojo.qb.thirdParty.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.thirdParty.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},bindings:{layoutConfig:function(){if(B.getEnvObj().isWSDossier()){return{h:{layout:"465px"},w:{layout:"1010px"}};}else{return{h:{layout:"100%"},w:{layout:"100%"}};}}},onError:mstrmojo.emptyFn,loadView:mstrmojo.emptyFn,toggleDatabaseView:mstrmojo.emptyFn,viewMode:H,fixedViewSize:null,init:function J(O){this._super(O);var P={},N=P[this.id]={},M,K,L;N.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(P);if(this.viewMode===H&&!mstrApp.isCloudPro){this.viewMode=C;L=mstrApp.container.size;if(L){M=parseInt(L.w,10);K=parseInt(L.h,10);}this.fixedViewSize=(!isNaN(M)&&!isNaN(K))?{w:M+"px",h:K+"px"}:{w:"1006px",h:"540px"};}if(this.viewMode===C){this.getBrowserDimensions=function Q(){return this.fixedViewSize;};}},preBuildRendering:function G(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel mstrmojo-bi-tools-main",config:{firstSplit:{v:"40%",min:"335px",max:undefined},secondSplit:{v:"60%",min:"550px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function F(){return{h:0,w:48};},slot:"layout",alias:"main",children:[{scriptClass:"mstrmojo.qb.thirdParty.BISourceSelector",slot:D,alias:"srcSelector"},{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",slot:I,alias:"srcInput"}]}],adjustSize:function(P){var S=P.size,M,N,L=mstrApp.isCloudPro,R=L?40:0,O=L?180:104;var K=parseInt(S.w,10)-R+"px",Q=parseInt(S.h,10)-O+"px";if(this.height&&Q!==this.height){this.set("height",Q);}else{this.height=Q;}if(this.width&&K!==this.width){this.set("width",K);}else{this.width=K;}if(B.isWS()){N=document.getElementById("QBContainer");N.style.height="100%";M=N.clientHeight;this.set("height",M);}return true;},getSrcCnt:function(){return this.main.srcInput.children.length;},getSrcUrls:function E(){return this.main.srcInput.getSrcs();},removeSrcs:function A(K){this.main.srcInput.removeSrcs(K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.qb.es.TableDropbox","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.WHPanel");mstrmojo.requiresDescs(531,12384,14083);var D=mstrmojo.desc,C=mstrmojo.dom,S=mstrmojo.array,O=mstrmojo.DI.DIHelpers,Y=mstrmojo.DI.DIConstants;var U="firstSplitNode",Q="secondSplitNode";var Z=0,I=1;var N="idx",A="li";var M=D(12384,"LIVE Data Connection does NOT support connection to multiple Database Instances currently. Please uncheck LIVE Data Connection to add table(s) from this Database Instance.");var L=D(14083,"The following table(s) cannot be added since they are not Information Views: ###");function J(d){var b=document.createElement("div"),k=C.findAncestorByAttr(d,N,true,this.domNode),h='<div class="item-ic"></div><div class="item-n" title="" style="max-width: 340px">{@n}</div><div class="item-del"></div>',e,j,a;function f(l){e=document.createElement("div");e.className="item cf";e.innerHTML=h.replace("{@n}",l).replace("\n","");return e;}if(k&&k.node){var c=this.userSelections;if(c[k.value]){var g=this.domNode.getElementsByTagName(A);S.forEach(g,function(l){a=l.getAttribute(N);if(c[a]===true){j=this.items[a].n;e=f(j);b.appendChild(e);}},this);}else{j=this.items[parseInt(k.value)].n;e=f(j);b.appendChild(e);}b.appendChild(document.createElement("div"));}b.className="mstrmojo-qb-emma-tablelist";return b;}function F(d,a){var c=this.avatar.style,b=this.restrictedToAxis;if(b!=="y"){c.left=d.x+1+"px";}if(b!=="x"){c.top=d.y+1+"px";}}mstrmojo.qb.es.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.es.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},bindings:{layoutConfig:function(){if(O.getEnvObj().isWSDossier()){return{h:{layout:"465px"},w:{layout:"1110px"}};}else{return{h:{layout:"100%"},w:{layout:"100%"}};}}},onError:mstrmojo.emptyFn,init:function P(d){this._super(d);var e={},c={},b;e[this.id]=c;c.directDataAccessTableError=this.onTableAdded;c.maxTableError=this.onTableAdded;c.SapHanaIncompatibleTypeError=this.onTableAdded;c.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(e);var f=this.getDBRoleSelector();var a=this.main.children[0].bottomPanel;a.getLayoutOffsets=function(){return{h:32,w:0};};f.getLayoutOffsets=function(){return{h:32,w:0};};a.searchBox.widthOffset=21;a.nameSpaces.heightOffset=35;f.heightOffset=31;a.heightOffset=31;f.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");b=a.dbTableTree;b.createAvatarFunc=J;b.positionAvatarFunc=F;b.showTablesNum=false;},getDBRoleSelector:function G(){return this.main.children[0].topPanel;},getDBConnectionList:function H(){return this.getDBRoleSelector().dbConnections;},preBuildRendering:function B(){var a=mstrApp.getRootController().model;if(this._super){this._super();}if(this.viewMode===I){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}a.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},onTableAdded:function K(a){var b="",c=[];switch(a.name){case"maxTableError":b=mstrApp.getRootController().getTableErrorMsg();break;case"directDataAccessTableError":b=M;break;case"SapHanaIncompatibleTypeError":S.forEach(a.data,function(d){c.push(d.n);});b=L.replace("###",c.join(", "));break;}mstrmojo.qb.alert(b,null,null,null,this.alertCfg);},renderPageLoadError:function E(){var c=this.error,b=c.message,d=c.title,a=c.btns;this.onError(c);if(!a||!a.length){mstrmojo.alert(b,null,d);}else{mstrmojo.confirm(b,null,{buttons:a,title:d});}},render:function X(){if(this.error){this.renderPageLoadError();}else{this._super();}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function V(){return{h:0,w:!!mstrApp.isWorkstation?32:36};},slot:"layout",alias:"main",toggleDatabaseView:function W(a){this.toggleFirstItemVisibility(a);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel",slot:U,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"300px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.es.TableDropbox",alias:"tableDropbox",slot:Q}]}],toggleDatabaseView:function W(a){this.main.toggleDatabaseView(a);},adjustSize:function(f){var j=f.size,c=mstrApp.isCloudPro,g=c?40:0,e=(c?180:104)-(!!mstrApp.isWorkstation?40:0),b=(Y.workstation.utils.shouldShowTitleBar())?20:0;var a=parseInt(j.w,10)-g+"px",h=parseInt(j.h,10)-e-b+"px",d=parseInt(j.h,10)-e-b-305+"px";if(this.height&&h!==this.height){this.set("height",h);}else{this.height=h;}if(this.width&&a!==this.width){this.set("width",a);}else{this.width=a;}return true;},postBuildRendering:function R(){var a=mstrApp.getRootController().model;if(this._super){this._super();}if(mstrApp.size){this.adjustSize({size:mstrApp.size});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.warehouse.DBRoleSelector","mstrmojo.warehouse.WHPanel","mstrmojo.warehouse.ui.AvailableTablesPanel");var B=mstrmojo.dom,C=mstrmojo.css,I=mstrmojo.warehouse.EnumDataChangeEvents;function A(O){var N="mstr-qb-oAuthSourcelogout",K=document.getElementById(N),J=mstrApp.getRootController().model,L=J.tableID,M=mstrApp.getRootController().getDataService();if(!K){K=document.createElement("IFRAME");K.id=N;document.body.appendChild(K);K.style.display="none";B.attachEvent(K,"load",function(Q){var R={};var P=function P(){M.signOutOAuthSource({success:function S(){mstrApp.getRootController().handleLogout();}},R);};R.dbRoleID=mstrApp.dbrid;if(mstrApp.said){R.sourceAccountID=mstrApp.said;}if(J.isNew&&L){M.removeEmmaTable({success:P},{did:L});}else{P();}});}K.src=O;}mstrmojo.qb.bigquery.BigQuerySignOut=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",cssClass:"mstrmojo-qb-bigquery-signout",bindings:{visible:function(){var K=mstrmojo.qb.EnumQBAppType,J=mstrApp.type;return J===K.BigQuery||J===K.BigQueryFFSQL||J===K.BigQuerySingleTable;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"username",postCreate:function F(){if(this._super){this._super();}this.set("text",mstrApp.userEmail||"");}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12735,"Sign Off..."),cssClass:"signout",onclick:function H(){A("https://www.google.com/accounts/logout");}}]});mstrmojo.qb.bigquery.DBRoleSelector=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{bqSignOutNode:function(){return this.domNode.children[0];},dbSelectorNode:function(){return this.domNode.children[1];}},slot:"firstSplitNode",alias:"topPanel",children:[{scriptClass:"mstrmojo.qb.bigquery.BigQuerySignOut",alias:"bqSignOut",slot:"bqSignOutNode"},{scriptClass:"mstrmojo.warehouse.DBRoleSelector",alias:"dbSelector",slot:"dbSelectorNode"}],init:function G(J){if(this._super){this._super(J);}var K=this.dbSelector.dbConnections;K.onclick=function(M){try{var P=M.target||B.eventTarget(M.hWin,M.e),O=B.findAncestorByAttr(P,"idx",true,this.domNode),L=O&&parseInt(O.value,10);if(P.className==="item-mn"&&L!==null&&!isNaN(L)){return false;}if(L!==null){mstrmojo.warehouse.ui.DBConnectionsList.prototype.onclick.call(K,M);}}catch(N){throw N;}};},setDimensions:function D(N,K){var J=parseInt(N,10);var M=parseInt(K,10),L;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}L=this.layoutConfig;if(this.bqSignOut.visible){L.h.bqSignOutNode="38px";L.h.dbSelectorNode=(J-38)+"px";}else{L.h.dbSelectorNode=J+"px";}L.w.bqSignOutNode=M+"px";L.w.dbSelectorNode=M+"px";if(this._super){this._super(J+"px",K);}}});mstrmojo.qb.bigquery.BigQueryWHPanel=mstrmojo.declare(mstrmojo.warehouse.WHPanel,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.qb.bigquery.BigQueryWHPanel",cssClass:"mstrmojo-qb-whpanel",children:[{scriptClass:"mstrmojo.qb.bigquery.DBRoleSelector",slot:"firstSplitNode",alias:"topPanel"},{scriptClass:"mstrmojo.warehouse.ui.AvailableTablesPanel",slot:"secondSplitNode",alias:"bottomPanel"}],init:function G(K){if(this._super){this._super(K);}var L={},J,M;J=L[this.id]={};M=this.bottomPanel;J[I.DBROLE_SELECTION]=function(N){if(M.refreshBtn){C.toggleClass(M.refreshBtn.domNode,"hidden",false);}};mstrApp.getRootController().attachDataChangeListeners(L);},preBuildRendering:function E(){if(this._super){this._super();}var J,K;J=this.topPanel.dbSelector;K=this.bottomPanel;J.title=mstrmojo.desc(37,"Projects");J.cssClass="bigquery-projects";K.title=mstrmojo.desc(12569,"Available Datasets");K.cssClass="AvailableTables bigquery-datasets";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui.Splitter","mstrmojo.warehouse.WHPanel","mstrmojo.qb.mdx.CubeDropbox","mstrmojo.hash","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(531,12932,12923,12941);var B=mstrmojo.hash,C=mstrmojo.DI.DIHelpers;var E="firstSplitNode",K="secondSplitNode";var D=1;mstrmojo.qb.mdx.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.mdx.RootView",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div><div></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},viewMode:D,init:function L(Q){this._super(Q);var S={};S[this.id]={maxCubeError:this.onErrorDisplay};S[this.id].windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(S);var M=this.main.whPanel;M.topPanel.title=mstrmojo.desc(12923,"MDX Connections");M.bottomPanel.title=mstrmojo.desc(12941,"Browse Catalog");M.bottomPanel.dbTableTree.getDragAction=function R(X){var Y=this.getNodeAttributes(X.src.node),W=Y&&this.getTreeItem(Y.index);if(W&&W.cubetp){return"addCube";}};this.getBrowserDimensions=function V(){return{w:"1010px",h:"552px"};};var P=M.bottomPanel;P.searchBox.widthOffset=21;var N=this.getDBRoleSelector();N.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");P.getLayoutOffsets=function(){return{h:32,w:0};};N.getLayoutOffsets=function(){return{h:32,w:0};};P.heightOffset=59;var U=P.dbTableTree,O=B.clone(U.tablesTreeHooks);O.isTable=function(W){return W&&W.cubetp;};U.tablesTreeHooks=O;},getDBRoleSelector:function I(){return this.main.children[0].topPanel;},preBuildRendering:function J(){var M=true;if(this._super){M=this._super();}if(this.viewMode===D){if(this._listenerProc){mstrmojo.dom.detachEvent(window,"resize",this._listenerProc);this._listenerProc=null;}}return M;},onErrorDisplay:function F(M){var N="";if(M.name==="maxCubeError"){N=mstrmojo.desc(12932,"A dataset can have only a single OLAP cube. Please create another dataset to import the second OLAP cube.");}mstrmojo.qb.alert(N,null,null,null,this.alertCfg);},bindings:{layoutConfig:function(){if(C.getEnvObj().isWSLiveMode()){return{h:{layout:"465px"},w:{layout:"1010px"}};}else{return{h:{layout:"100%"},w:{layout:"100%"}};}}},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-es-whole-panel",config:{firstSplit:{v:"50%",min:"350px",max:undefined},secondSplit:{v:"50%",min:"300px",max:undefined},resizeHandle:{v:"2px"}},getLayoutOffsets:function H(){return{h:0,w:36};},slot:"layout",alias:"main",toggleDatabaseView:function G(M){this.toggleFirstItemVisibility(M);},children:[{scriptClass:"mstrmojo.warehouse.WHPanel",cssClass:"mstrmojo-qb-es-whpanel mdx-panel",alias:"whPanel",slot:E,orientation:mstrmojo.ui.Splitter.ENUM_OR.HORIZONTAL,config:{firstSplit:{v:"50%",min:"200px"},secondSplit:{v:"50%",min:"200px"},resizeHandle:{v:"2px"}}},{scriptClass:"mstrmojo.qb.mdx.CubeDropbox",slot:K}]}],toggleDatabaseView:function G(M){this.main.toggleDatabaseView(M);},adjustSize:function(N){var O=N.size,Q=mstrApp.isCloudPro,U=Q?40:0,R=Q?180:104,S=C.isServerBasedWS()?50:0;var P=parseInt(O.w,10)-U+"px",M=parseInt(O.h,10)-R+S+"px";if(this.height&&M!==this.height){this.set("height",M);}else{this.height=M;}if(this.width&&P!==this.width){this.set("width",P);}else{this.width=P;}return true;},postBuildRendering:function A(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size});}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.mdx.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIHelpers");var P=mstrmojo.hash,F=mstrmojo.DI.DIHelpers,J=mstrmojo.qb.QBHelpers,V=mstrmojo.DI.DIConstants;function B(Z){var a=mstrApp.diShowFooterFunction;if(a){a({finish:{visible:Z}});}}function I(c){var b=c.SelDBRoleID;var e=c.dbrs;var d;var a;var Z;for(d=0;d<e.length;d++){if(b===e[d].did){a=e[d].n;break;}}Z=c.cubes[0].n;return{name:Z,desc:a};}mstrmojo.qb.mdx.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{start:function H(){var d=this.rootView,Z=this.model,a,f,c,b;this.dataService=mstrmojo.qb.mdx.DataService;d.render();this.toggleDatabaseView(true);Z.loadDBTypeFilters({success:function e(){Z.loadDBRoles({success:function g(){B(true);Z.initialize();}});}});a=mstrApp.diFooterID;f=a?mstrmojo.all[a]:undefined;if(f){c=f.next;b=f.finish;Z.attachEventListener("refreshTables",c.id,f.enableButton);Z.attachEventListener("refreshTables",b.id,f.enableButton);setTimeout(function(){f.mdxRA.update();},0);}},getDataService:function K(){return this.dataService;},toggleDatabaseView:function Y(Z){this.rootView.toggleDatabaseView(Z);},addCubes:function O(Z){this.model.addCubes(Z);},addTables:function L(Z){this.model.addCubes(Z);},removeCube:function Q(Z){this.model.removeCube(Z);},updateCube:function W(Z){this.model.updateCube(Z);},handleDBTableRefresh:function S(){var a=this.model,Z=a.SelDBRoleID;a.catalogRefresh=true;a.onSelNameSpaceIDChange({value:a.SelNameSpaceID});},attachDataChangeListeners:function N(a){var Z=this.model;P.forEach(a,function(b,c){P.forEach(b,function(e,d){Z.attachEventListener(d,c,e);});});},detachDataChangeListeners:function E(a){var Z=this.model;mstrmojo.array.forEach(a,function(b){Z.detachEventListener(b);});},onCancelButtonClick:function G(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},onFinishButtonClick:function U(){var Z=this.model,a={};a.onOK=function(c){if(c){Z.folderID=c.folderID;Z.cubeDesc=c.objDesc;Z.cubeName=c.objName;}Z.commitChanges({success:function b(g){var e=mstrApp.msgid,f=Z.isManagedCube,l,d;mstrApp.container.unloadQB();mstrApp.messageID=e;mstrApp.isDDA=true;mstrApp.saveCubeParams=c;mstrApp.isManagedCube=f;l=mstrApp.getRootController();if(Z.isNew){l.getDDAController().setDirectDataAccess(mstrApp.isDDA);l.dataService.set("messageID",mstrApp.messageID);l.model.isManagedCube=mstrApp.isManagedCube;d=l.model;d.cubeName=I(Z).name;if(mstrApp.isSingleTier){var j={isDirectDataAccess:d.isDirectDataAccess},k={success:function(m){if(m.objectId){d.cubeID=m.objectId;}l.wrapUpDataImport();},failure:function(m){mstrApp.hideProgress();l.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,m&&m.message);}},h={success:function(){l.dataService.createOneTierDoc(k,j);},failure:function(m){mstrApp.hideProgress();l.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,m&&m.message);}};if(d.operationMode===V.operationMode.edit||d.operationMode===V.operationMode.refresh){l.dataService.duplicateReportInstance(h,{messageID:d.analysisID,datasetID:d.cubeID,duplicateRIMsgID:l.dataService.messageID});}else{if(mstrApp.isSingleTier&&!Z.isManagedCube){if(g&&g.objectId){d.cubeID=g.objectId;}l.wrapUpDataImport();return ;}l.dataService.createOneTierDoc(k,j);}return ;}if(f){l.wrapUpDataImport();return ;}d=l.model;if(g&&g.objectId){d.cubeID=g.objectId;}d.path=c&&c.objPath;if(c&&c.folderID&&c!==""){d.folderID=c.folderID;}l.wrapUpDataImport();}else{if(F.isServerBasedWS()){d=l.model;d.path="serverBased";}l.wrapUpDataImport();return ;}}});};if(!Z.isManagedCube&&Z.isNew&&!F.isOnetier()){J.showSaveAsDialog(a,I(this.model));}else{a.onOK();}},onBackButtonClick:function A(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},onHelpButtonClick:function R(){mstrApp.showHelpTopic("Creating_a_data_source_connection_to_an_OLAP_source.htm");},getProjectPrimaryDBRoleID:function X(){return this.model.SelDBRoleID;},setRecursive:function M(Z){this.model.set("recursive",Z);},getRecursive:function C(){return this.model.recursive;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.DataService","mstrmojo.warehouse.WHController","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380,2171,9614,9621,1395,9613,9619,2265,8002,9612,9623,9616,9611,9622,9615,2052,2170,9620,9617,9618,5471,4444);var c=mstrmojo.array,V=mstrmojo.hash,f=mstrmojo.qb.QBHelpers,L=mstrmojo.desc,d=mstrmojo.DI.DIHelpers,k=mstrmojo.qb.EnumQBAppType,O=mstrmojo.DI.DIConstants;var j=1,R="mstr-qb-alternatesource";var H={1:L(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:L(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};function E(o){var p=mstrApp.diShowFooterFunction;if(p){p({finish:{visible:o}});}}function I(o,q){var p;p=mstrmojo.all[R]||(new mstrmojo.qb.es.AlternateSourceDialog({id:R}));if(q){p.set("zIndex",q);}p.items=o;p.open();}var G={0:L(2171,"Default"),1:L(9614,"Integer"),2:L(9621,"Unsigned"),3:L(1395,"Numeric"),4:L(9613,"Decimal"),5:L(9619,"Real"),6:L(2265,"Double"),7:L(8002,"Float"),8:L(9612,"Char"),9:L(9623,"VarChar"),10:L(9616,"Long VarChar"),11:L(9611,"Binary"),12:L(9622,"VarBin"),13:L(9615,"Long VarBin"),14:L(2052,"Date"),15:L(2170,"Time"),16:L(9620,"TimeStamp"),17:L(9617,"NChar"),18:L(9618,"NVarChar"),30:L(5471,"Big decimal")};function P(o){return G[o]||L(4444,"Unknown");}function C(AA){var x=[],u,w,z,AB,o,q,t,p;c.forEach(AA,function(AC){u=w=z=AB="";q=(AC.vt===3)?1:0;switch(AC.vt){case 0:case 1:case 2:case 3:u=AC.n;w=P(AC.ddt);o=AC.src;z=o.n;AB=P(o.ddt);break;case 4:u=AC.n;w=P(AC.ddt);break;case 8:o=AC.src;z=o.n;AB=P(o.ddt);break;}t=w?u+"("+w+")":u;p=AB?z+"("+AB+")":z;x.push([t,q,p]);});return x;}function Y(p){var o=[];c.forEach(p.tables,function(q){o.push(q.dbtn||"");});return{name:d.generateCubeName(o)};}mstrmojo.qb.es.Controller=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function W(){var u=this.rootView,q=this.model,t=this,o,w,p,AA;this.dataService=mstrmojo.qb.es.DataService;if(mstrApp.emmaIRRMessageID){this.dataService.emmaIRRMessageID=mstrApp.emmaIRRMessageID;}u.render();this.toggleDatabaseView(true);var x=function x(){t.loadDBRoles({success:function AB(){var AC;AC=(mstrApp.emmaTablesNum===0);E(AC);if(mstrApp.tableID&&mstrApp.msgid){q.loadTable(mstrApp.tableID);}else{if(!t.model.isForAlternateSource&&!mstrApp.msgid){t.dataService.createEmmaInstance({success:function AD(AE){mstrApp.msgid=AE.msgid;}});}}}});};if(q.specifyDBTypes){q.dbObjects.populateDBProperties({success:function z(){x();}});}else{q.loadDBTypeFilters({success:function z(){x();}});}o=mstrApp.diFooterID;w=o?mstrmojo.all[o]:undefined;if(w){p=w.next;AA=w.finish;q.attachEventListener("refreshTables",p.id,w.enableButton);q.attachEventListener("refreshTables",AA.id,w.enableButton);}},getCurrentZIndex:function X(){return mstrApp.diCurrentZIndex;},getDataService:function M(){return this.dataService;},toggleDatabaseView:function h(o){this.rootView.toggleDatabaseView(o);},openHelp:function Q(){var o=mstrmojo.helpPath()+(mstrApp.isFFSQL?"Importing_data_from_a_database_by_typing_a_query.htm":"Importing_data_from_a_database_by_picking_relation.htm");window.open(o);},addTable:function b(o){this.model.addTable(o);},addTables:function e(o){this.model.addTable(o);},removeTable:function U(o){this.model.removeTable(o);},removeDBRoleTables:function l(o){if(mstrApp.type===k.EmmaSingleTable){this.model.removeDBRoleTables(o);}},cancel:function F(){if(!mstrApp.isFromDI){var o=mstrApp.origin?"-2":"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:o},mstrApp.name,"POST",null,null,false);}},commitChanges:function a(){this.model.commitChanges({success:function o(p){var q=p.msgid;mstrmojo.form.send({evt:"3172",messageID:q,launchingApp:"QB"},mstrApp.name,"POST",null,null,false);}});},onNextButtonClick:function K(){var o=this;this.model.commitChanges({success:function p(w){var t=mstrApp.getRootController().model,x=t.isDDA,u=t.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=w.msgid;mstrApp.isDDA=x;mstrApp.isManagedCube=u;var q=(o.model.tableID&&o.model.isSapHana!==true)?o.model.tables:undefined;mstrApp.msgid=o.model.messageID;mstrApp.getRootController().getModel().originalMsgID=o.model.originalMsgID;mstrApp.getRootController().getModel().editingTableId=o.model.tableID;mstrApp.getRootController().afterQBProcess(undefined,q);}});},saveDDACube:function n(p){var q=this.model,t={},u;u={success:function(AD){var w=mstrApp.msgid,z=q.isDDA,AA,AE,AB,AC,x,AF=q.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=w;mstrApp.isDDA=z;mstrApp.isManagedCube=AF;AA=mstrApp.getRootController();AE=AA.model;AA.getDDAController().setDirectDataAccess(mstrApp.isDDA);AA.dataService.set("messageID",mstrApp.messageID);AE.isManagedCube=mstrApp.isManagedCube;AE.cubeName=Y(q).name;if(p&&p.folderID&&p.folderID!==""){AE.folderID=p.folderID;}if(mstrApp.isSingleTier){AB={isDirectDataAccess:AE.isDirectDataAccess,name:AE.cubeName};AC={success:function(AG){if(AG.objectId){AE.cubeID=AG.objectId;}AA.wrapUpDataImport();},failure:function(AG){mstrApp.hideProgress();AA.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,AG&&AG.message);}};x={success:function(){AA.dataService.createOneTierDoc(AC,AB);},failure:function(AG){mstrApp.hideProgress();AA.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,AG&&AG.message);}};if(AE.operationMode===O.operationMode.edit||AE.operationMode===O.operationMode.refresh){AA.dataService.duplicateReportInstance(x,{messageID:AE.analysisID,datasetID:AE.cubeID,duplicateRIMsgID:AA.dataService.messageID});}else{if(mstrApp.isSingleTier&&!q.isManagedCube){if(AD&&AD.objectId){AE.cubeID=AD.objectId;}AA.wrapUpDataImport();return ;}AA.dataService.createOneTierDoc(AC,AB);}return ;}if(AF){AA.wrapUpDataImport();return ;}AE=AA.model;if(AD&&AD.objectId){AE.cubeID=AD.objectId;}AE.path=p&&p.objPath;AA.wrapUpDataImport();}};function o(){if(q.isManagedCube){u.success();return ;}t.displayMode=12;t.shouldRefresh=false;if(q.isDDA){t.shouldRefresh=false;t.saveAsFlags=O.saveAsFlags.saveAsDDA|O.saveAsFlags.saveAsOverWrite;}else{t.saveAsFlags=O.saveAsFlags.saveAsInMemory|O.saveAsFlags.saveAsOverWrite;}t.saveAsFlags|=O.saveAsFlags.saveAsWithAnswers|O.saveAsFlags.saveAsWithPrompts;t.taskId="saveAndPublishCube";t.showWait=true;t=V.copy(p,t);t.saveAsOverwrite=true;if(mstrApp.isSingleTier&&!q.isManagedCube){t.persist=1;}t.objName=t.objName||Y(q).name;t.folderID=t.folderID||"";t.msgID=t.msgid||mstrApp.msgid;delete t.objPath;mstrApp.getRootController().model.submitRequest(u,t);}mstrApp.getRootController().model.submitRequest({success:function(){if(q.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){o();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{o();}}},{taskId:"DIToggleDatasetServeMode",serveMode:q.isDDA?O.datasetServeMode.dda:O.datasetServeMode.inMemory,showWait:true});},handleFinish:function N(){var o=this.model,q=this,p=o.operationMode,t={};t.onOK=function(w){o.commitChanges({success:function u(AA){var x=AA.msgid,AB=o.isDDA,z=o.isManagedCube;if(AB&&p!==1){q.saveDDACube(w);}else{mstrApp.container.unloadQB();mstrApp.messageID=x;mstrApp.isDDA=AB;mstrApp.saveCubeParams=w;mstrApp.isManagedCube=z;mstrApp.getRootController().afterQBProcess(true);}}});};if(p===1){t.onOK();}else{if(!o.isManagedCube&&!mstrApp.isSingleTier){f.showSaveAsDialog(t,Y(this.model));}else{t.onOK();}}},onFinishButtonClick:function m(){var p=this,o=this.model,t=p.getDDAController(),z,x,q,w=mstrApp.diCurrentZIndex,u=w?w+1:10;c.forEach(o.tables,function(AA){if(AA.extt||AA.hanai){x=true;o.isDDA=true;}});if(!o.origIsDDA&&t.allowDDA()&&!x){z={onOK:function(){p.handleFinish();}};q={callback:z,selectedIndex:o.isDDA?0:1,zIndex:u};t.showDDAConfirmDialog(q);return ;}this.handleFinish();},onBackButtonClick:function S(){mstrApp.container.unloadQB();mstrApp.getRootController().backFromQB();},onCancelButtonClick:function g(){this.exitApplication();},exitApplication:function D(){mstrApp.container.unloadQB();mstrApp.getRootController().onCancelButtonClick();},getTableErrorMsg:function(){return this.model.addTableErrorMsg;},selectAlternateSource:function Z(z,AB,t){var w=this,AA=w.dataService,u=this.model,AC=u.tables,AD,q,o,p=null,x={zIndex:t+1000};if(AC.length===0){return ;}AD=AC[0];if(AB.failure){p=function(AE){AB.failure(AE);};}q={success:function(){var AE;mstrApp.hasEditEmmaIRRSource=true;AE={success:function(AH){var AI,AG,AJ,AF;if(AH.vt===1){AG=mstrApp.msgid;AJ=AA.emmaIRRMessageID;mstrApp.container.unloadQB();AI=mstrApp.getRootController().dataService;mstrApp.messageID=AG;if(AG){AI.set("messageID",AG);}if(AJ){AI.set("emmaIRRMessageID",AJ);}if(AB.success){AB.success({tableName:AD.n});}}else{AF=C(AH.cols);I(AF,t);}},failure:p};AA.validateEmmaIRRAlternateSource(AE,{tbid:z,alertCfg:x});},failure:p};o={sourceType:j,tables:z,deleteTables:"0",dbRoleID:AD.dbr,dbTableName:AD.n,alertCfg:x};if(AD.ns){o.dbNamespace=AD.ns;}AA.editEmmaIRRSourceTable(q,o);},getDDAController:function J(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function u(){var AB=mstrApp.getRootController().model,AA=null,AD=!!AB.canSupportDDA,z,AC=AB.tables;if(!AD){return false;}if(AC.length>0){AA=AC[0].dbr;}z=AB.dbridForDDA;if(z&&AA!==null&&z!==AA){AD=false;}if(!AD){return false;}c.forEach(AC,function(AE){if(AE.dbr!==AA){AD=false;return false;}return true;});return AD;},onlyAllowDDA:function x(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function o(AC){var AA=mstrApp.getRootController().model,z=0,AB;if(AA.isDDA===AC){return ;}if(AC){AA.set("isDDA",true);if(!this.allowDDA()){z=1;AB=false;}}else{AA.set("isDDA",false);if(this.onlyAllowDDA()){z=2;AB=true;}}if(z){mstrmojo.qb.alert(H[z]);AA.set("isDDA",AB);}},checkDDACheckbox:function q(AB){var z=mstrApp.getRootController().model.ddaCheckboxID,AA;if(z){AA=mstrmojo.all[z];if(AA){AA.set("checked",AB);}}},tryEnableDDACheckbox:function t(AB){var z=mstrApp.getRootController().model.ddaCheckboxID,AA;if(z){AA=mstrmojo.all[z];}if(!AA||!AA.visible){return ;}if(!AB){if(AA.enabled&&!AA.checked&&!this.allowDDA()){AA.set("enabled",false);}}else{if(!AA.enabled&&!AA.checked&&this.allowDDA()){AA.set("enabled",true);}}},askUserAboutDDA:function w(z){if(z){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function p(z){var AA=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(z||{});AA.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function B(q){var p,o;if(!q){return ;}p=this.rootView.getDBConnectionList();o=c.find(p.items,"did",q);if(o>=0){p.set("selectedIndex",o);p.adjustScrollPosition(o);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.rw.ConditionWalk","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.expr","mstrmojo.css");var F=mstrmojo.expr.ET.MQ,H=mstrmojo.expr.ET.MC,C=mstrmojo.css,B=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var G=function(L,N){var K=L.et,I=L.m&&mstrmojo.rw.ConditionWalk.isMdxDM(L.m.did),M=((K===F||K===H)&&!this.inRelation&&!I)?"block":"none",J=(((N===1)||K!==F)&&!I)?1:0;C.toggleClass(this.toolNode,"unselectable",K===H);this.toolNode.style.display=M;this.level.set("selectedIndex",J);this.includeExist.set("visible",J===1&&(K===H||K===F));this.includeExist.set("checked",L.idcsi===undefined?false:L.idcsi);};mstrmojo.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,null,{scriptClass:"mstrmojo.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},postCreate:function E(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function I(J){var K=this.parent;if(K&&K.condition&&K.visible){K.includeExist.set("visible",J.v===1);K.condition.level=J.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=B;},oncheckedChange:function(){var J=this.parent;if(J){J.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function A(I){var J=this.condition;if(J&&this.toolNode&&this.visible){G.call(this,J.data,J.tree.level);}if(this._super){this._super(I);}},onmodeledit:function D(I){if(this._super){this._super(I);}if(this.toolNode){G.call(this,this.model.get(),this.model.level);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css","mstrmojo.Button","mstrmojo.Label","mstrmojo.rw.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.ui._IsIncFetchList","mstrmojo.ui.ColumnWalk","mstrmojo.mstr.DocElementDataHelper");var F=mstrmojo.expr.ET.MQ,B=mstrmojo.expr.ET.MC,H=mstrmojo.css,G=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var D=function(Q,S){var P=Q.et,N=this.parent&&this.parent.docModel&&this.parent.docModel.datasets,M=Q.m&&mstrmojo.rw.ConditionWalk.isMdxDM(Q.m.did,N),R=((P===F||P===B)&&!this.inRelation&&!M)?"block":"none",O=(((S===1)||P!==F)&&!M)?1:0;H.toggleClass(this.toolNode,"unselectable",P===B);this.toolNode.style.display=R;this.level.set("selectedIndex",O);this.includeExist.set("visible",O===1&&(P===B||P===F));this.includeExist.set("checked",Q.idcsi===undefined?false:Q.idcsi);};mstrmojo.vi.ui.editors.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,[mstrmojo.ui._IsIncFetchList],{scriptClass:"mstrmojo.vi.ui.editors.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"800px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var M=this.parent;if(M.close){M.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var M=this.parent;if(M.onOK){M.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:"",ignoreLayout:true}],init:function K(M){this._super(M);this.attachEventListener("conditionWalkUpdateOkBtn",this.id,function(N){var P=N.valid,O=this.parent;O.toggleOkButtonStatus(P);});},postCreate:function I(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function M(N){var O=this.parent;if(O&&O.condition&&O.visible){O.includeExist.set("visible",N.v===1);O.condition.level=N.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=G;},oncheckedChange:function(){var N=this.parent;if(N){N.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function J(M){var N=this.condition;if(N&&this.toolNode&&this.visible){D.call(this,N.data,N.tree.level);}if(this._super){this._super(M);}},onmodeledit:function A(M){if(this._super){this._super(M);}if(this.toolNode){D.call(this,this.model.get(),this.model.level);}},getAttributeForms:function L(M){return mstrmojo.rw.ConditionWalk.getAttForms(M,this.editor.docModel.datasets);},getElements:function E(P,R){var Q={},N=R.complete,O=this;this.scrollNode=this.columnWalk.es.scrollNode;var M=this.scrollNode&&this.scrollNode.style;if(M){M.height="100%";}if(!this.ifDataHelper){this.ifDataHelper=new mstrmojo.mstr.DocElementDataHelper({source:this.editor.docModel.getDataService()});}else{this.ifDataHelper.set("items",null);}this.columnWalk.es.es.allowUnlistedValues=false;this.updateBrowseElementsParams(Q,P);this.ifDataHelper.browseConfig=Q;R=mstrmojo.func.wrapMethods(R,{complete:function(S){O.initScroll();}});this.ifDataHelper.getItems(1,R);},postNext:function C(){this.columnWalk.es.updateList(this.ifDataHelper.items);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.vi.ui.theme","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui.VIDragUnit","mstrmojo.hash");var G=mstrmojo.css,E=mstrmojo.dom,B=mstrmojo.vi.ui.theme,F=mstrmojo.array,C=mstrmojo.hash;function D(P,Q,O){var N=false;F.forEach(this.getSelectedItems(),function(R){if(R.itemNode===Q||R===P){N=true;}});if(P&&!N){this.doItemSelect(P,O||{});}}var M={avatarCssClass:"mstrmojo-VIUnitList",encodeUnitAvatar:true,getDragData:function L(N){var O=N.src.node,Q=E.findAncestorByAttr(O,"idx",true,this.domNode);N.src.node=Q?Q.node:O;var P=(N.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit()).getUnitDragData(N,this.getSelectedItems());if(this.getItemDisplayName){mstrmojo.func.override({getItemDisplayName:this.getItemDisplayName},N.dragUnitHelper);}P.srcId=this.id;return P;},createAvatar:function A(O,N){if(N.dragUnitHelper){return N.dragUnitHelper.getUnitAvatar(N,this.encodeUnitAvatar);}},selectDragNode:function K(N){var O=N.src;D.call(this,this.getItemFromTarget(O.node),this.getItemNodeFromTarget(O.node),O);},onItemContextMenu:function J(O,N){D.call(this,O,this.getItemNodeFromTarget(N.getTarget()),N);if(this._super){return this._super(O,N);}},positionAvatar:function H(O,N){N.dragOffsets=N.dragUnitHelper.getDragUnitOffsets();if(this._super){this._super(O,N);}}},I=C.copy(M);I._mixinName="mstrmojo.vi.ui._HasUnitListAvatar2";I.getDragData=function(N){if(this.isDraggingItem&&!this.isDraggingItem(N)){if(this._super){return this._super(N);}}else{return M.getDragData.call(this,N);}};mstrmojo.vi.ui._HasUnitListAvatar2=mstrmojo.provide("mstrmojo.vi.ui._HasUnitListAvatar2",I);mstrmojo.vi.ui._HasUnitListAvatar=mstrmojo.provide("mstrmojo.vi.ui._HasUnitListAvatar",mstrmojo.mixin(M,mstrmojo.mixin(mstrmojo._HasOwnAvatar)));}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.hash","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._Formattable","mstrmojo._IsDocumentTemplate","mstrmojo.Label","mstrmojo.VisUtility","mstrmojo.ui.menus.MenuConfig","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.rw._SupportViewFilterInVizBox","mstrmojo.util.FontLoader");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");var R={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"};var L=["background-color","fx"],H={width:"width",height:"height"},Y=mstrmojo.array,K=mstrmojo.hash;mstrmojo.VisBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo._IsDocumentTemplate,mstrmojo.vi.ui.rw._SupportViewFilterInVizBox,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.VisBase",updated:false,waitingForData:false,node:null,excludeData:false,skipReRender:false,updateFormatsOnUpdate:true,bgFormats:{},init:function d(m){this.excludeData=!!(mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause());if(this._super){this._super(m);}},setModel:function g(m){this.set("model",m);},destroy:function c(){var m=this.model;if(m&&m.destroy){m.destroy();delete this.model;}this._super();},resize:function N(){var m=this.getFormats();if(parseInt(m.height,10)===0||parseInt(m.width,10)===0){this.domNode.style.display="none";}else{this.setDimensions(m.height,m.width);this.domNode.style.display="";}},setDimensions:function b(o,n){var m=this._super(o,n);if(m&&this.hasRendered&&!this.skipReRender){this.reRender();}return m;},reRender:function J(){this.unrender();this.render();},getWidth:function h(){return parseInt(this.width,10);},getHeight:function X(){return parseInt(this.height,10);},getLeft:function V(){return parseInt(this.left,10);},getTop:function B(){return parseInt(this.top,10);},getFonts:mstrmojo.emptyFn(),loadFonts:function E(m,n){if(mstrmojo.util.FontLoader.load(m,n)){n.success();}},preBuildRendering:function A(){if(this.requirePreload){var m=function m(){this.requirePreload=false;this.render();};if(mstrmojo.util.FontLoader.load(this.getFonts(),{success:m.bind(this),failure:m.bind(this)})){return this._super();}else{return false;}}return this._super();},buildRendering:function D(){this.height=this.getHeight();this.width=this.getWidth();this.left=this.getLeft();this.top=this.getTop();if(!this.updated){this.update();}this._super();},initFromVisProps:function a(){},postBuildRendering:function(){var m=this.isEmpty();this._super();this.raiseEvent({name:"toggleCtrlOverlay",visible:m||this.excludeData,controls:this.getVisEmptyMsgControls()});this.applyBackground();return !m;},applyBackground:function W(){var n=this.bgFormats,p,m,q,o;if(mstrApp.isExpress&&!K.isEmpty(n)){p=this.formatHandlers=this.formatHandlers||{};q=p.domNode=p.domNode||[];m="BG";o=Y.indexOf(q,m);if(o<0){q.push(m);}this.applyCSSFormatToNode("domNode",n);}},parseBgFormats:function G(){var m=this.id;return{success:function(u){var p,x,t,n,w,o,q=mstrmojo.all[m],z=q&&q.getDocModel();if(u.defn&&u.defn.layouts&&q&&z){x=u.defn.layouts;p=Y.find(x,"k",z.getCurrentLayoutKey());t=x[p];n=t&&t.units&&t.units[q.k];w=n&&n.fmts;if(w){o=q.bgFormats={};Y.forEach(L,function(AA){if(w[AA]){o[AA]=w[AA];}});}}}};},onAppStateChange:function(m){var n=mstrApp.isAppStatePause&&mstrApp.isAppStatePause(),o=m.valueWas&mstrmojo.vi.VisualInsightApp.APP_STATES.PAUSE;this.excludeData=!!(mstrConfig.resolveOnly||n);if(this._super){this._super(m);}if(n&&!o||(!n&&o&&!mstrApp.enableUpdate)){this.raiseEvent({name:"toggleCtrlOverlay",visible:this.excludeData||this.isEmpty(),controls:this.getVisEmptyMsgControls()});}},refresh:function j(m){if(this.excludeData){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});return ;}this._super(m);},update:function Z(p){p=p||this.node;if(p){var m=p.data;if(m){this.model.set("data",m);}this.waitingForData=!!m.nsj;if(this.waitingForData){var n="ServerJsonRWDStyle";var q=this.model,o=q.getDataService(),t={host:this,nodes:[this.k]},w;if(m.wid!==undefined){t.slices=[m.wid];}w=mstrmojo.func.wrapMethods(this.parseBgFormats(),q.docModel.getUpdateColorMapCallback(),q.docModel.getUpdateThemePaletteCallback(true),q.controller._getXtabCallback(this,false));o.retrieveServerJson(t,w,{preserveUndo:true,style:{name:n,params:{treesToRender:3}},params:{styleName:n}});this.updated=true;return false;}this.updateContentFormats(p);}if(this.model){var x=this.model&&this.model.docModel;this.initFromVisProps(this.model.vp);if(x&&x.getDocBuilder){var u=x.getDocBuilder().getMojoVisName(p);if(u){p.data.visName=u;}}}this.updated=true;if(this._super){return this._super(p);}return true;},updateContentFormats:function M(q){var o,t,n,p=q.defn,m=this.builder;if(this.updateFormatsOnUpdate&&p){if(m&&m.isPortlet&&m.isPortlet(p)){t=H;}else{t=R;}n=p.fmts||p.units[this.model.k].fmts;for(o in t){if(t.hasOwnProperty(o)&&n.hasOwnProperty(o)){this[t[o]]=n[o];}}}},isEmpty:function O(){return false;},getVisEmptyMsgControls:function I(){return[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:mstrmojo.desc(11668,"Drag objects here.")}];},getModel:function k(){return this.model;},getData:function Q(){return this.model.data;},getRowsAndCols:function(){var m=this.model.data.gts;return(m.row||[]).concat(m.col||[]);},getExp:function(){var m=this.model.data,n=m&&m.sc&&m.sc.exp;return n;},getDocModel:function e(){return this.model&&this.model.docModel;},getTitleRMCPopup:mstrmojo.emptyFn,getMenuHandler:function U(){return mstrmojo.emptyFn;},renderErrorMessage:function l(m){this.domNode.innerHTML='<div class="mstrmojo-message">'+m+"</div>";},getMessageID:function S(){return this.model.docModel.mid||this.model.mid;},performAction:function f(m){var n=this.model,q=this.scriptClass==="mstrmojo.heatmap.vi.VisHeatMap",p=q?n.getHMAction(m):n.getAction(m),o=p&&p.h;if(o&&this.controller[o]){this.controller[o](this,p.a);return true;}return false;},deleteSelectorControl:function P(){var m=this.getData(),n=m.sc;if(n&&parseInt(n.ct,10)===6){delete m.sc;}},findSelectorControl:function F(){var n=this.getData(),m=n&&n.sc;if(m&&parseInt(m.ct,10)===6){this.selectorControl=m;this.isMultiSelect=true;}else{delete this.selectorControl;}return this.selectorControl;},displayVizBoxVisFilterIndicator:function C(m,n){if(m&&n&&n.displayVisFilterIndicator){n.displayVisFilterIndicator();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.DI.DISearchBoxPage");mstrmojo.requiresDescs(12809,12810);var I=mstrmojo.DI.DIConstants;mstrmojo.DI.DITwitterPage=mstrmojo.declare(mstrmojo.DI.DISearchBoxPage,null,{scriptClass:"mstrmojo.DI.DITwitterPage",cssClass:"mstrmojo-di-twitter",preBuildRendering:function F(){if(this._super){this._super();}this.set("headerLabelText",mstrmojo.desc(12809,"Search for Tweets"));this.set("placeHolderText",mstrmojo.desc(12809,"Search for Tweets"));this.set("showOperators",true);this.set("showAdvancedOptions",false);this.set("showFetchOptions",true);this.set("noDataErrorString",mstrmojo.desc(12810,"No Tweets found, please try another search string."));this.set("iconCssClass","twitterIcon");this.previewPanel.previewType="grid";},handleDataPreview:function M(N){this.searchPanel.previewTableId=N.data;this.toggleDataPreview(true);this.searchPanel.populate(N);this.previewPanel.populate(N);this.adjustSize();},handleNoDataReturned:function K(){this.toggleDataPreview(false);},init:function H(O){var P,N;this._super(O);P={};N=P[this.id]={};N[I.dataEvents.DATA_PREVIEW_EVENT]=this.handleDataPreview;N[I.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;N.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(P);},adjustSize:function L(){var N=this.searchPanel.blockNode.clientWidth;if(N>90){this.searchPanel.searchFieldNode.style.width=(N-90)+"px";}},onSearchClick:function J(S){if(S===undefined||S===""){return ;}if(this._super){this._super(S);}var Q={query:S};var N=mstrApp.getRootController(),R="searchedTweets?q="+S+"###"+JSON.stringify(Q),P=(S.replace(/['"]/g,"")).substr(0,8)+" Twitter",O=[],U={query:R,n:P,max:this.searchPanel.getFetchValue().value};U.tableID=this.searchPanel.previewTableId;O.push(U);if(this.searchPanel.previewTableId!==""){N.refreshDataOAuthReport(this.sourceObjectsInfo.type,I.sourceSubtype.twitter,this.searchPanel.previewTableId,O[0],I.actions.quickPreview);}else{N.importMultiOAuthReports(this.sourceObjectsInfo.type,O,true,!N.model.hasEMMAReportInstance(),I.actions.quickPreview,I.sourceSubtype.twitter);}},toggleFooterButtons:function E(){if(this.searchText===undefined||this.searchText===""){mstrApp.getRootController().enableFinishButton(false);}else{mstrApp.getRootController().enableFinishButton(true);}},handleSearchChange:function B(N){if(this._super){this._super(N);}this.toggleFooterButtons();},getImportTable:function A(){var P=this.searchPanel.getSearchQuery();var R={query:P};var O=(P.replace(/['"]/g,"")).substr(0,8)+" Twitter",S="searchedTweets?q="+P+"###"+JSON.stringify(R),N=this.searchPanel.getFetchValue().value,Q=this.getTableId();return{query:S,tableID:Q,n:O,max:N};},performAction:function D(Q){this.searchTerm=this.searchPanel.getSearchQuery();var N=mstrApp.getRootController(),O=[],P=this.getTableId();O.push(this.getImportTable());if(O[0].tableID&&!this.tableID){N.dataService.removeEMMASourceTable(null,{did:O[0].tableID});O[0].tableID=null;}if(this.tableID!==""){if(this.searchPanel.previewTableId!==""){N.removeSourceTable(this.searchPanel.previewTableId);}N.refreshDataOAuthReport(this.sourceObjectsInfo.type,I.sourceSubtype.twitter,P,O[0],Q);}else{N.importMultiOAuthReports(this.sourceObjectsInfo.type,O,true,!N.model.hasEMMAReportInstance(),Q,I.sourceSubtype.twitter,this.id);}},onNextButtonClick:function(){this.performAction(this.tableID?I.actions.refreshData:I.actions.importSource);},onBackButtonClick:function G(){var N=mstrApp.getRootController(),O=[];O.push(this.getImportTable());if(O.length&&O[0].tableID&&!this.tableID){N.dataService.removeEMMASourceTable(null,{did:O[0].tableID});N.getModel().resetImportSource(O[0].tableID);O[0].tableID=null;}N.showPage(I.pageType.dataSelection);},onHelpButtonClick:function C(){return"Importing_data_from_Twitter.htm";},onFinishButtonClick:function(){this.performAction(I.actions.savePublish);},onCancelButtonClick:function(){var N=mstrApp.getRootController();if(this.searchPanel.previewTableId!==""){if(N.dialogController!==undefined&&N.dialogController.pageZIndex>0){N.removeSourceTable(this.searchPanel.previewTableId);}}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DISearchBoxPage","mstrmojo.DI.DIDateTextBox2","mstrmojo.DI.DIFacebookAdvancedEditor");mstrmojo.requiresDescs(221,1442,3653,12689,12690,14124);var M=mstrmojo.array,V=mstrmojo.DI.DIConstants,J=mstrmojo.DI.DIConstants.sourceType;function E(){var X=this.searchPanel.blockNode.clientWidth;if(X>90){this.searchPanel.searchFieldNode.style.width=(X-90)+"px";}}mstrmojo.DI.DIFacebookPage=mstrmojo.declare(mstrmojo.DI.DISearchBoxPage,null,{scriptClass:"mstrmojo.DI.DIFacebookPage",advancedProperties:null,groupID:"",searchBoxHint:mstrmojo.desc(12689,"Search for Pages"),signOutTooltipText:mstrmojo.desc(14124,"Please logout of Facebook in the popup window."),handleNoDataReturned:function L(){this.toggleDataPreview(false);},init:function R(Y){var Z,X;this._super(Y);Z={};X=Z[this.id]={};X[V.dataEvents.NO_DATA_RETURNED_EVENT]=this.handleNoDataReturned;X.oAuthReportsFetched=this.populate;X.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(Z);this.searchPanel.signOutTooltipText=this.signOutTooltipText;},adjustSize:function F(X){var Y=X.size,Z=Math.ceil(parseInt(Y.w,10)),a=this.previewPanel.content;if(!a){return ;}if(Z>=760&&Z<=950){if(a.cols!==2){a.cols=2;a.refresh();}}else{if(a.cols!==3){a.cols=3;a.refresh();}}E.call(this);},refreshConfig:function C(){this.config={firstSplit:{v:"60px",min:"60px",max:undefined},secondSplit:{v:"100%",min:"150px",max:undefined},resizeHandle:{v:"2px"}};},generateGUID:function W(){function X(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}return(X()+X()+"-"+X()+"-"+X()+"-"+X()+"-"+X()+X()+X());},populate:function H(X){var Y;if(this._super){this._super(X);}if(X&&X.targetPageId){if(X.targetPageId!==this.id){return ;}}Y=mstrApp.getRootController().model.externalSources[J.facebook].reports;if(!Y.mi.ca){mstrApp.getRootController().raiseModelEvent({name:V.dataEvents.NO_DATA_RETURNED_EVENT});return ;}this.toggleDataPreview(true);this.previewPanel.populate(X);E.call(this);},preBuildRendering:function D(){if(this._super){this._super();}this.set("headerLabelText",mstrmojo.desc(12689,"Search for Pages"));this.set("placeHolderText",mstrmojo.desc(12689,"Search for Pages"));this.set("showOperators",false);this.set("showAdvancedOptions",false);this.set("noDataErrorString",mstrmojo.desc(12690,"No Pages found, please try another search string."));this.set("iconCssClass","facebookIcon");this.previewPanel.previewType="table";},postBuildRendering:function U(){var X=mstrApp.getRootController();if(this.tableID!==undefined&&this.tableID!==""){if(this.advProps!==undefined){this.advancedProperties=this.advProps;}}X.sourceSelected(false);if(this._super){this._super();}},onSearchClick:function K(Z){if(Z===undefined||Z===""){return ;}if(this._super){this._super(Z);}var X=mstrApp.getRootController(),Y="searchedPage?q="+encodeURIComponent(Z);X.oAuthSourceFetchFunction(J.facebook,{fbPageSearchQuery:Y});},handleSearchChange:function G(X){if(this._super){this._super(X);}mstrApp.getRootController().enableFinishButton(false);},getSelectedPageInfo:function O(){return this.previewPanel.content.selectedItem;},getTimeFeed:function I(Z){var c=Z||"?since=-1%20days",Y=this.getSelectedPageInfo().advancedProperties;if(Y&&Y.getProperties){var d=Y.getProperties(),b=(!d.since||d.since==="MM/DD/YYYY")?"":encodeURIComponent(d.since),a=(!d.until||d.until==="MM/DD/YYYY")?"":encodeURIComponent(d.until),X="";if(b){c="?since="+b;}else{c="";}if(a){if(b){X="&";}else{X="?";}c+=X+"until="+a;}}return c;},getTableQuery:function P(Z,Y,e){var X=this.getSelectedPageInfo().pg_id,d=this.searchPanel.getSearchQuery(),c="",b=this.getSelectedPageInfo().advancedProperties;var a={query:encodeURIComponent(d),groupID:Z,advProps:b};e=this.getTimeFeed(e);a.timeFeed=e;switch(Y){case"page":a.name="page";c=X+"_Page###"+JSON.stringify(a);break;case"posts":a.name="posts";c=X+":feed_Posts"+e+"###"+JSON.stringify(a);break;case"comments":a.name="comments";c=X+":feed_Comments"+e+"###"+JSON.stringify(a);break;case"likes":a.name="likes";c=X+":feed_Likes"+e+"###"+JSON.stringify(a);break;}return c;},getItems:function B(a){var g=mstrApp.getRootController(),f=g.getModel(),b=this,h=[],Y=this.getSelectedPageInfo().n,X=Y.substr(0,10),d=this.generateGUID();if(a===""){var j={query:b.getTableQuery(d,"page"),n:X+" Page"};h.push(j);var l={query:b.getTableQuery(d,"posts"),n:X+" Posts"};h.push(l);var c={query:b.getTableQuery(d,"comments"),n:X+" Comments"};h.push(c);var e={query:b.getTableQuery(d,"likes"),n:X+" Likes"};h.push(e);}else{var k=this.groupID,Z=[];h=[];M.forEach(f.getAllTableID(),function(m){var n=f.getImportSource(m);try{var q=decodeURIComponent(n.sourceInfo.url.split("###")[1]);var p=JSON.parse(q);if(p&&p.groupID===k){Z.push(n);}}catch(o){}});if(Z.length>0){M.forEach(Z,function(o){var p=o.sourceInfo,u=decodeURIComponent(p.url.split("###")[1]),t=JSON.parse(u),m=t.name,q=t.timeFeed.replace(" ","%20"),n=o.tableID;switch(m){case"page":h.push({query:b.getTableQuery(k,"page",q),n:X+" Page",tableID:n});break;case"posts":h.push({query:b.getTableQuery(k,"posts",q),n:X+" Posts",tableID:n});break;case"comments":h.push({query:b.getTableQuery(k,"comments",q),n:X+" Comments",tableID:n});break;case"likes":h.push({query:b.getTableQuery(k,"likes",q),n:X+" Likes",tableID:n});break;}});}}return h;},performAction:function Q(Z){var X=mstrApp.getRootController(),Y=this.getItems(this.tableID);if(this.tableID!==""){X.refreshMultiOAuthReports(this.sourceObjectsInfo.type,V.sourceSubtype.facebook,Y,Z);}else{X.importMultiOAuthReports(this.sourceObjectsInfo.type,Y,true,!X.model.hasEMMAReportInstance(),Z,V.sourceSubtype.facebook,this.id);}},onNextButtonClick:function(){this.performAction(this.tableID?V.actions.refreshData:V.actions.importSource);},onBackButtonClick:function A(){var X=mstrApp.getRootController();X.showPage(V.pageType.dataSelection);},onHelpButtonClick:function S(){return"importing_data_from_Facebook.htm";},onFinishButtonClick:function(){this.performAction(V.actions.savePublish);},onadvancedSearchClick:function N(){var X=this;var Z=mstrApp.getRootController().dialogController.getCurrentZIndex()+1;var Y=new mstrmojo.Editor({cssClass:"mstrmojo-di-facebookAdvancedEditor",cssText:"background: white; width:460px;height: 380px",showTitle:true,title:"Filter Post Data by Date",zIndex:Z,onOpen:function(){var a=this.curtainNode.style;a.background="black";a.opacity=0.5;a.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.DI.DIFacebookAdvancedEditor",alias:"editorContent",bindings:{advancedProperties:function(){return X.advancedProperties||{};}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1442,"OK"),onclick:function(){var a=this.parent.parent;if(a.editorContent.onOk){a.editorContent.onOk();X.advancedProperties=a.editorContent.advancedProperties;}a.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var a=this.parent.parent;a.close();if(a.onCancel){a.onCancel();}}}]});Y.open();}});}());(function(){mstrmojo.requiresCls("mstrmojo.VisBase","mstrmojo.DocPortlet");var L={top:"top",left:"left","z-index":"zIndex",width:"width",height:"height"},P,B;mstrmojo.Vis=mstrmojo.declare(mstrmojo.VisBase,null,{scriptClass:"mstrmojo.Vis",offsetTop:0,offsetLeft:0,isAndroid:window.navigator.userAgent.indexOf("Android")!=-1,reRenderOnDimensionChg:true,isVis:function(){return true;},setModel:function Q(R){this._super(R);if(R.data){this.set("model",R.data);}this.xtabModel=R;if(this.controller&&typeof (this.controller.getPageByTree)!="undefined"){this.controller.getPageByTree(false);}},destroy:function O(){this._super();var R=this.xtabModel;if(R&&R.destroy){R.destroy();delete this.xtabModel;}},setDimensions:function N(U,S){var R=this._super(U,S);if(R&&this.hasRendered&&this.reRenderOnDimensionChg){this.reRender();}return R;},buildRendering:function M(){if(this.parent instanceof mstrmojo.DocPortlet){delete this.left;delete this.top;this.height=this.fmts&&this.fmts.height;}this._super();},postBuildRendering:function G(){P=this.width;B=this.height;this.adjustWidgetOffsets();this._super();},adjustWidgetOffsets:function E(){var R=mstrmojo.boxmodel.offset(this.domNode);this.offsetTop=R.top;this.offsetLeft=R.left;},update:function F(W){W=W||this.node;if(W){if(W.data){this.set("model",W.data);if(this.xtabModel&&this.xtabModel.set){this.xtabModel.set("data",W.data);}this.model=W.data;if(this.model.layoutModel){this.layoutModel=this.model.layoutModel;}if(this.model.layoutNode){this.layoutNode=this.model.layoutNode;}mstrmojo.hash.copy(W.data.extProps,this);}var U=this.controller,S=U.view,Y=(S.hasRendered&&S.getCurrentLayout&&S.getCurrentLayout());if(U.view.fullScreenInfoWindow&&(Y&&Y.defn.visName)){var X=mstrApp.rootView.getContentDimensions();this.height=X.h+"px";this.width=X.w+"px";}else{this.fmts=W.defn.fmts||W.defn.units[this.model.k].fmts;var R=this.fmts;if(R){for(var V in L){v=L[V];if(V in R){this[v]=R[V];}}}}}if(this.model){this.initFromVisProps(this.model.vp);}this.updated=true;return true;},getModel:function A(S){if(S){var R=mstrmojo.Vis.getVisGrid(this.layoutModel,this.layoutNode,S);if(R){return R.data;}else{alert(mstrmojo.desc(8427,"Incorrect visualization properties encountered.  Data may be inconsistent.  Please reset your properties."));return{};}}else{return this.model;}},getDataParser:function K(R){return new mstrmojo.Vis.DataParser(this.getModel(R));},renderErrorMessage:function H(R){this.domNode.innerHTML='<div class="mstrmojo-message">'+R+"</div>";},getMessageID:function J(){return this.model.mid&&this.model.mid||this.xtabModel&&this.xtabModel.docModel&&this.xtabModel.docModel.mid;},hasNoninfowindowTarget:function D(V){var c=this.xtabModel,b=(c&&c.docModel);var d=false;if(b){var a=b.defn&&b.defn.layouts,U=null;var S;if(a){for(S in a){if(a[S].loaded){U=a[S];break;}}}var W=U&&U.units;this.selectorTargets={};if(W&&V.scObjList){for(var S=0;S<V.scObjList.length;S++){var X=V.scObjList[S];var Y=X.sc.tks.split("\x1E");for(var R=0;R<Y.length;R++){var Z=W[Y[R]];if(Z){this.selectorTargets[Y[R]]=Z;if(!this.isChildOfIfw(W,Z)){d=true;}}}}}}return d;},isChildOfIfw:function I(R,S){while(S){if(S.ifw){return true;}S=R[S.pnk];}return false;},performAction:function C(R){var U=this.xtabModel.getAction(R),S=U&&U.h;if(S&&this.controller[S]){this.controller[S](this,U.a);return true;}return false;}});mstrmojo.Vis.getVisGrid=function(R,Z,S){var X=Z;var V=R.getChildren(Z,false);for(var U=0;U<V.length;U++){var Y=V[U];if(Y.k==S){return Y;}else{var W=mstrmojo.Vis.getVisGrid(R,Y,S);if(W){Z=X;return W;}}}};mstrmojo.Vis.DataParser=function(U){var b=mstrmojo.Vis;return{getRowTitles:function(){return new b.Titles(U,true);},getColTitles:function(){return new b.Titles(U,false);},findMetricValue:function(g,l){var k=U.ghs.rhs.items;for(var h in k){var j=k[h].items;var f=true;for(var d in g){if(g[d]!=j[d].idx){f=false;break;}}if(f){return new mstrmojo.Vis.MetricValue(U.gvs.items[h].items[l]);}}},getTotalRows:function X(){var c=U.ghs&&U.ghs.rhs&&U.ghs.rhs.items;return(U.eg||!c)?0:c.length;},getTotalColHeaderRows:function V(){return(!U.ghs.chs.items?0:U.ghs.chs.items.length);},getTotalCols:function R(){return this.getColHeaders(0).size();},getRowHeaders:function a(c){return new b.Headers(U,c,true);},getColHeaders:function Z(c){return new b.Headers(U,c,false);},getMetricValue:function Y(d,c){return new b.MetricValue(U,U.gvs.items[d].items[c]);},getColumnHeaderCount:function W(){return U.gvs.items[0].items.length;},getCSSString:function S(){return U.cssString;}};};mstrmojo.Vis.Titles=function(R,X){var W=(X)?R.gts.row:R.gts.col;return{size:function V(){return W.length;},getTitle:function U(Y){return new mstrmojo.Vis.Title(W[Y]);},getCSS:function S(Y){return R.css[W[Y].cni].n;}};};mstrmojo.Vis.Headers=function(S,U,Y){var Z=(Y)?S.gts.row:S.gts.col;var X=(Y)?S.ghs.rhs:S.ghs.chs;var V=X.items&&X.items[U].items;return{size:function a(){return(!V?0:V.length);},getHeader:function R(b){return V&&V[b]&&new mstrmojo.Vis.Header(V[b],Y?Z[b]:Z[U]);},getCSS:function W(b){return V&&S.css[V[b].cni].n;},getHeaderCell:function(b){return V&&V[b];}};};mstrmojo.Vis.Title=function(S){return{getActionType:function(){return S.at;},getDrillPath:function(){return S.dp;},getHeaderValues:function R(){return S.es;},getHeaderName:function U(W){return S.es[W].n;},getHeaderId:function U(W){return S.es[W].id;},getForms:function V(){return S.fs;},getFormId:function(){return S.fid;},getFormType:function(){return S.ftp;},getUnitId:function(){return S.id;},getLinkMap:function(){return S.lm;},getName:function(){return S.n;},getUnitDssType:function(){return S.otp;},getSelectorControl:function(){return S.sc;}};};mstrmojo.Vis.Header=function(U,R){return{getName:function W(){return(U.idx===-1)?"":R.es[U.idx].n;},getElementId:function Z(){return(U.idx===-1)?"":R.es[U.idx].id;},getObjectId:function V(){return(U.idx===-1)?"":R.es[U.idx].oid;},getElementIndex:function S(){return U.idx;},getActionType:function Y(){return U.at;},isTotal:function X(){return U.otr===1;}};};mstrmojo.Vis.MetricValue=function(R,Z){var Y=Z;return{getValue:function S(){return Y.v;},getThresholdType:function U(){return Y.ty;},getRawValue:function X(){return Y.rv;},getCSS:function V(){return R.css[Y.cni].n;},getThresholdValue:function a(b){if(Y.ti==undefined){return b;}return R.th[Y.ti].n;},getFillColor:function W(b){if(Y.ci==undefined){return b;}return R.fc[Y.ci].n;}};};})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.TreeBrowserSelector","mstrmojo.DynamicClassFactory","mstrmojo._HasLayout","mstrmojo.ObjectBrowserDataProvider","mstrmojo.ui._HasScroller","mstrmojo.ui.SearchBox","mstrmojo.ui._HasUITheme","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui._IsViPanel","mstrmojo.vi.ui.UnitList","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui.CollapsibleTitleBar","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.css","mstrmojo.vi.ui.theme");var G=mstrmojo.DynamicClassFactory,V=mstrmojo.array,I=mstrmojo.hash,H=mstrmojo.dom,A=mstrmojo.css,h=mstrmojo.string,F=mstrmojo.vi.ui.theme,b=mstrmojo.vi.ui.DatasetUnitMenuUtils,g=[4,12,1,47];var J={n:mstrmojo.desc(15348,"No applicable objects"),t:0},R={n:mstrmojo.desc(15559,"No result matches your search."),t:0};function L(p){var o=[],n=[],w=this._shiftStartIndex,u=this.selectedIndices,t=Math.min(w,p),q=Math.max(w,p);V.forEach(this.items,function(x,z){if(t<=z&&z<=q){if(!u[z]){o.push(z);}}else{if(u[z]){n.push(z);}}});this.addSelect(o);this.removeSelect(n);}function P(){return !mstrmojo.resolveFeature("hide-objects-description");}function Y(o){var n=mstrmojo.vi.enums.EnumDSSAccessRightFlags;return o.acg&&(o.acg&n.DssAccessRightUseFlag)&&(o.acg&n.DssAccessRightExecuteFlag);}function j(o,t){var q=o.itemsContainerNode,p=H.isMetaKey(t.src.hWin,t.src.e),w=H.eventTarget(t.src.hWin,t.src.e),n=-1;if(q&&w){V.forEach(q.childNodes,function(x,z){if(H.contains(x,w,true,x)){n=z;return false;}});}if(n!==-1){var u=o.items[n];if(!p&&!o.selectedIndices[n]){o.tree.clearTreeSelect();}if(V.indexOf(g,u.t)>=0){o.addSelect(n);}return true;}return false;}function c(p,n){var o=this.listSelector;if(o){o[p](this,this.itemsContainerNode,n);}}function M(o,p){var n=false;if(o.itemsContainerNode){V.forEach(o.ctxtBuilder.itemWidgets,function(q){if(H.contains(q.itemsContainerNode,p,q.domNode)){n=true;}});}return n;}mstrmojo.vi.ui.BrowserNodesAvatarContent=G.newComponent(mstrmojo.vi.ui.UnitList,null,{getItemProps:function(p,n){var o=this._super(p,n);o.addCls("isAvatar");return o;}});mstrmojo.vi.ui.TreeBrowserSelector=I.copy({premousedown:function(o,q,n){o.tree._selectNode=H.eventTarget(n.hWin,n.e);},premouseup:function D(AB,n,AD){if(H.isPrimaryMouseBtn(AD.e)){var t=AD.hWin,x=AD.e,z=H.eventTarget(t,x),q=H.shiftKey(AD.hWin,AD.e),AC=AB._shiftStartIndex,u=M(AB,z),AA=AB.listMapper.findIndex(AB,n,z);if(AA>-1&&!u&&AB.tree._selectNode===z){var o=V.indexOf(g,AB.items[AA].t)!==-1;if(q&&AC>-1&&o){AB.rangeSelect(AA);}else{AB.toggleSelect(AA);if(AB.selectedIndices[AA]&&o){AB._shiftStartIndex=AA;}}}}}},mstrmojo.TreeBrowserSelector);mstrmojo.vi.ui.TreeBrowser=G.newComponent(mstrmojo.TreeBrowser,[mstrmojo.vi.ui._HasUnitListAvatar],{containerResizable:false,draggable:true,avatarCssClass:"mstrmojo-VIUnitList",rangeSelect:L,_selectNode:null,_shiftStartIndex:-1,blockBegin:1,blockCount:50,getContent:function(o,u){o=o||this;var p=(o===this),n=this,x=function(w){if(p){mstrmojo.css.removeClass(n.domNode,["loading"]);}n.updateTreeContent(o,w);},q=function(w){o.contentRetrieved=true;o.set("items",[n.failItemCreaterFunc()]);mstrmojo.err(w);},t={success:x,failure:q};if(p){mstrmojo.css.addClass(n.domNode,["loading"]);}if(mstrApp.objectsBlockCount){this.blockCount=parseInt(mstrApp.objectsBlockCount,10);}this.getContentThroughTaskCall({isRoot:p,data:o.data,blockBegin:u||o.blockBegin,blockCount:parseInt(mstrApp.objectsBlockCount,10)||n.blockCount},t);},getDragData:function k(o){o.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit();var t=this,u=function(AA){V.forEach(AA.ctxtBuilder.itemWidgets,function(AB){var AC=H.eventTarget(o.src.hWin,o.src.e);if(AC&&H.contains(AB.itemsContainerNode,AC,true,AB.itemsContainerNode)){t=AB;u(AB);return false;}});};u(this);var p=j(t,o);var w=p?this.getSelectedItems().filter(function(AA){return V.indexOf(g,AA.t)!==-1;}):null;var n=this.id,q=function q(AA){var AD=mstrmojo.all[n],AB=AD.avatar;if(AB){var AC=[AD.avatarCssClass,"hasOwnAvatar",AA];AB.className=AC.join(" ");}};return{items:w,item:w&&w[0],src:mstrmojo.vi.models.EnumDragSources.ALL_OBJECT_LIST,setAvatarClass:function x(AA){q(AA);},setInvalidAvatarClass:function z(){q("icn clsx_sub");}};},getSelectedItems:function(){var n=this.ctxtBuilder,o=[];if(n){V.forEach(n.itemWidgets,function(p){if(p.state===1){o=o.concat(p.getSelectedItems());}});}o=(this._super()||[]).concat(o);return o;},createAvatar:function(p,o){var n=document.createElement("div");this.avatarContent=new mstrmojo.vi.ui.BrowserNodesAvatarContent({items:o.src.data.items});this.avatarContent.render();A.addClass(this.avatarContent.domNode,[F.getThemeClass.call(this)]);n.appendChild(this.avatarContent.domNode);return n;},ondragend:function(n){this._super(n);if(this.avatarContent&&this.avatarContent.destroy){this.avatarContent.destroy();}delete this.avatarContent;},isDragValid:function S(o){var n=o.src.data.items;return(n&&n.length)||this._super(o)||false;},contentRetrieved:false,onvisibleChange:function(){if(!this.contentRetrieved){this.getContent(this);}}});mstrmojo.vi.ui.TreeBrowserNode=G.newComponent(mstrmojo.TreeBrowserNode,[{_mixinName:"newClass"}],{containerResizable:false,draggable:false,_shiftStartIndex:-1,rangeSelect:L,premousedown:function(n){this.tree._selectNode=H.eventTarget(n.hWin,n.e);},premouseup:function(o){if(H.isPrimaryMouseBtn(o.e)){var u=H.isMetaKey(o.hWin,o.e),t=H.shiftKey(o.hWin,o.e),w=H.eventTarget(o.hWin,o.e),x=H.contains(this.itemsContainerNode,w,true,this.domNode),q=x&&M(this,w),p=(this.state===2),n=!p&&(w!==this.stateNode&&w!==this.textNode)&&!x;if(q||this.tree._selectNode!==w){return ;}if((!u&&!t)||this.tree.isSelectedFolder||n){this.tree.clearTreeSelect();}if(n){this.tree.isSelectedFolder=true;}else{if(!x){this.tree.isSelectedFolder=false;}}if(!p&&(w===this.stateNode||w===this.textNode)){this.toggleState();this.tree.updateScroller();H.stopPropogation(o.hWin,o.e);}else{if(x){c.call(this,"premouseup",o);}else{this.handleNodeClicked();}}}},getSelectedItems:function(){var n=this.ctxtBuilder,o=[];if(n){V.forEach(n.itemWidgets,function(p){if(p.state===1){o=o.concat(p.getSelectedItems());}});}o=(this._super()||[]).concat(o);return o;}});function Z(p){var o=this;return I.copy(p,{scriptClass:"mstrmojo.vi.ui.TreeBrowser",alias:"contents",slot:"containerNode",isSelectedFolder:false,browserNodeClass:mstrmojo.vi.ui.TreeBrowserNode,noCheckBox:true,itemIdField:"did",useRichTooltip:true,dataProvider:this.dataProvider,listSelector:mstrmojo.vi.ui.TreeBrowserSelector,showTooltip:function u(x,AE){var AD=x.target||H.eventTarget(x.hWin,x.e),AC=H.findWidget(AD),AB=AC.data;if(AB&&AB.n){var z=AC.domNode.firstChild;var AA='<div class="name">'+h.encodeHtmlString(AB.n,true)+"</div>"+(AB.desc?'<div  class="dsc">'+h.encodeHtmlString(AB.desc,true)+"</div>":"");var w=H.position(z);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",content:AA,top:w.y-4,left:w.x+w.w+6};this.constructor.prototype.showTooltip.call(this,x,AE);}},updateScroller:function(){o.updateScrollbars();},isBranch:function(w){return w.t===8;},items:null,bindings:{data:"this.parent.rootFolder"},setDimensions:mstrmojo.emptyFn,item2textCss:function n(x){var AA={8:"folder",3:"report",12:"attribute",4:"metric",47:"consolidation",1:"custom-group",0:"no-obj"},w=mstrmojo.TreeBrowser.prototype.item2textCss(x)||AA[x.t],z=this.parent&&this.parent.highlightItems;if(z&&z.indexOf(x.did)!==-1){w+=" highlight";}return w;},onnodechange:function t(w){this.constructor.prototype.onnodechange.call(this,w);this.parent.onSelectedItemsChange(w);},getTotalSelections:function(){return[];},getContentThroughTaskCall:function q(AE,AB){var w=this.parent,AA=AE.data||{fty:w.rootFolderType},z=AE.isRoot,x=w.folderList,AC=AE.blockBegin,AD=AE.blockCount;this.dataProvider.fetchFolderContents({sId:mstrApp.sessionState,browsableTypes:w.getObjectSubTypes().join(","),includeObjectDesc:true,folderLinksContextId:w.folderLinksContextId||29,blockCount:AD||50},{fid:AA.did,fty:AA.fty,blockBegin:AC||1},{success:function(AG){var AF=AG.items?AG.items.filter(function(AI){return AI.t===8||Y(AI);}):[];AB.success({items:AF.length?AF:[J],sz:AG.sz,bb:AG.bb,bc:AG.bc});if(z&&!x.initialized){x.set("items",AG.sc);var AH=V.find(AG.sc,"did",AG.did);if(AH!==-1){x.set("selectedIndex",AH);}}x.initialized=true;o.updateScrollbars();},failure:AB.failure});}});}function e(o,p){if(o.state===2){var n=o.data;A.toggleClass(o.textNode,"highlight",n&&(p.indexOf(n.did)!==-1));}else{o.ctxtBuilder.itemWidgets.forEach(function(q){e(q,p);});}}mstrmojo.vi.ui.AllObjectsBrowser=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._IsViPanel,mstrmojo.ui._HasScroller,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.vi.ui.AllObjectsBrowser",markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-VIAllObjectsBrowser {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIPanel-titlebar"></div><div class="filter"></div><div class="search-box"></div><div class="horizontal-line"></div><div class="mstrmojo-VIPanel-contentContainer"><div style="overflow:hidden;"><div class="mstrmojo-VIPanel-content"></div></div></div></div>',markupSlots:{titlebarNode:function l(){return this.domNode.firstChild;},filterNode:function B(){return this.domNode.childNodes[1];},searchBox:function Q(){return this.domNode.childNodes[2];},contentNode:function m(){return this.domNode.childNodes[4].firstChild;},containerNode:function U(){return this.domNode.childNodes[4].firstChild.firstChild;}},title:mstrmojo.desc(5679,"All Objects"),model:null,rootFolder:null,rootFolderType:null,highlightItems:null,getObjectSubTypes:function(){var n=[2048,3072,1024];if(!mstrApp.isSingleTier){n.push(12032);n.push(257);n.push(2560);}return n;},layoutConfig:{h:{titlebarNode:"30px",filterNode:"30px",searchBox:"33px",containerNode:"100%"},w:{titlebarNode:"100%",searchBox:"100%",containerNode:"100%"},xt:true},opened:false,dataProvider:null,onSelectedItemsChange:mstrmojo.emptyFn,onopenedChange:function(){if(!this.searchList&&this.opened){var n=this.folderList,o=n.getSelectedItem(),p=this.rootFolder;if(o&&p&&o.did!==p.did){n.initialized=false;}this.addChildren([Z.call(this,{ondataChange:function(){if(this.data){this.getContent(this);}},ondblclick:this.dblClickOnNodes.bind(this)}),Z.call(this,{alias:"searchList",visible:false,contentRetrieved:true,ondblclick:this.dblClickOnNodes.bind(this)})]);}},reset:function(){if(this.contents){this.removeChildren(this.contents);}if(this.searchList){this.removeChildren(this.searchList);}},dblClickOnNodes:function N(o){var t=o.getTarget(),q=H.findWidget(t).data,p=this.model,n=p.getSelectedViUnit();if(n&&q&&V.indexOf(g,q.t)!==-1){this.dataProvider.loadObjects([q],{success:function(){var u=b.getCfgForAddUnitFromAllObject([q],p.datasets);if(n){n.getZonesModel().addUnitsFromDataSource([q],u.dsid,u.actions,p.getDatasetsUpdateCallback());}}},true);}},getSelectedItems:function K(){var o=this.contents,n=o.visible?o:this.searchList;return n.getSelectedItems();},getLayoutOffsets:function(){return{w:18,h:0};},children:[{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",cssClass:"vi-allObjects-tb",slot:"titlebarNode",alias:"titleBar",editTitleOnDoubleClick:false,getLayoutOffsets:function(){return{w:0,h:5};},onclick:function W(){this.close();},close:function(){this.parent.close();},bindings:{title:"this.parent.title"}},{scriptClass:"mstrmojo.ui.Pulldown",slot:"filterNode",alias:"folderList",initialized:false,getLayoutOffsets:function(){return{w:0,h:9};},onitemSelected:function(n){if(this.initialized){this.parent.set("rootFolder",n);this.parent.obSearchBox.clearSearch(true);}}},{scriptClass:"mstrmojo.ui.SearchBox",slot:"searchBox",alias:"obSearchBox",getLayoutOffsets:function(){return{w:0,h:13};},searchTriggered:function O(u){this.text=u;if(!u){this.clearSearch(true);return ;}var n=this.parent,q=n.contents.visible?n.contents:n.searchList,x=q.getSelectedItems(),o=n.folderList,p=this.parent.dataProvider,w=o.items[o.selectedIndex].did,t=this;x.forEach(function(z){if(z.t===8){w=z.did;return false;}});A.addClass(q.domNode,["loading"]);p.fetchFolderContents({browsableTypes:n.getObjectSubTypes().join(","),includeObjectDesc:true,folderLinksContextId:n.folderLinksContextId||29,blockCount:50,enableQuickSearch:!!(mstrApp.useQuickSearch&&mstrApp.useQuickSearch())},{fid:w,searchPattern:u,recursive:1},{success:function(z){A.removeClass(q.domNode,["loading"]);if(t.inputNode.value===u){n.contents.set("visible",false);n.searchList.set("visible",true);(n.searchList||this).set("items",z.items||[R]);n.updateScrollbars();}}});},onkeyup:function f(o){var n=o.hWin,p=o.e||n.event;if((mstrApp.useQuickSearch&&mstrApp.useQuickSearch())||((p.keyCode===13||p.keyCode===27||!this.inputNode.value))){this.constructor.prototype.onkeyup.call(this,o);}},postClearSearch:function(){var n=this.parent,p=n.contents,o=n.searchList;if(p){p.set("visible",true);}if(o){o.set("visible",false);}}}],getDropAvatarIcon:function C(n){return" ";},passToolbarCfg:function E(n){this.titleBar.set("toolbarCfg",n);},updateToolbar:function a(n){n.hasCloseButton=true;n.closeButtonText="";return n;},onhighlightItemsChange:function X(){var n=this.highlightItems;if(n){e(this.contents,n);e(this.searchList,n);}},setupScrollNodes:function d(){this.scrollNode=this.containerNode;},updateScrollbars:function(){this._super();if(this.scrollNode&&this.hasCustomScrollbar){var o=this.scrollNode,n=H.getComputedScrollbarWidth(o);o.style.marginRight=-n+"px";o.style.paddingRight=n+"px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Dial","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Obj","mstrmojo.CheckBox","mstrmojo.mstr.EnumNodeProperties","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.fe.FilterExprTree","mstrmojo.fe.RelationFilterExprTree","mstrmojo.fe.CreateSetEditor","mstrmojo.fe.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.StatusButton");var a=mstrmojo.expr,I=a.ET,O=a.BRANCH_FNS,Y=mstrmojo.Obj,X=mstrmojo.dom,b=mstrmojo.array,S=mstrmojo.hash,e=mstrmojo.css,F=mstrmojo.mstr.EnumNodeProperties,C=mstrmojo.warehouse.EnumObjectTypes,K={TEMPLATE:0,DATASET:1},E=mstrmojo.mstr.EnumNodeDimty,Q=b.hash([E.NodeDimtyUnspecified,E.NodeDimtyNone]),M=200,H=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function Z(){var h=this.avatar;if(h){h.parentNode.removeChild(h);delete this.avatar;e.removeClass(h,[this.avatarCssClass]);}}mstrmojo.fe.FilterEditorBase=mstrmojo.declare(mstrmojo.Editor,null,{onSave:null,onCancel:null,title:mstrmojo.desc(12032,"View Filter Editor"),help:"view_filter_editor_for_report_services_documents.htm",cssClass:"mstrmojo-charcoalboxe mstrmojo-FE",showLimits:true,objectBrowsingEnabled:false,children:null,showCondWalk:false,isNewCond:false,vizTitle:"",init:function U(h){this.children=[{alias:"feContent",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-content",postCreate:function(){this.children=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-exprTool",children:[{scriptClass:"mstrmojo.ui.StatusButton",cssClass:"mstrmojo-FE-addCondition",postCreate:function j(){this.editor=this.parent.parent.parent;this.statusList=this.editor.getAddConditionList();this.status=this.statusList[0];},onButtonClick:function(k){if(k){k.handler.apply(this.editor);}}}]},this.parent.getExpressionContainerCfg()];}},this.getConditionWalkConfig(),{alias:"buttonBar",scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",toggleBtnStatus:function(j){this.children[0].btnSave.set("enabled",j);this.children[0].btnCancel.set("enabled",j);},children:[{scriptClass:"mstrmojo.HBox",cssText:"float:right; border-collapse: separate",cellSpacing:3,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),alias:"btnSave",onclick:function(){var j=this.editor;j.save();j.close();},bindings:{enabled:function(){return !this.editor.readOnly;},editor:"this.parent.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"btnCancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var j=this.editor;if(j.onCancel){j.onCancel(j.model);}j.close();},bindings:{editor:"this.parent.parent.parent"}}]}]}];this._super(h);this.model=this.model||new Y();},save:function W(){var h=this.model;h.expr=f(h.exprForest);h.limitExpr=f(c(h.limitExprForest));this.onSave(h);},getExpressionContainerCfg:function(){var h=this;return{alias:"feExpr",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-expr-list",postCreate:function(){this.children=h.getExpressionContentsConfig();},onRender:function(){X.attachMarkupEvent(this.id,this.domNode,"mousedown");},onmousedown:function(j){var k=X.eventTarget(j.hWin,j.e);if(this.isBlankArea(k)){this.clearSelect();}},isBlankArea:function(j){return j===this.domNode;},clearSelect:function(){}};},getExpressionContentsConfig:function(){return[];},getConditionWalkConfig:function(){var j=this;return{scriptClass:"mstrmojo.rw.ConditionWalk",width:"750px",objectBrowsingEnabled:false,dimtyTypes:Q,alias:"walk",visible:false,onOK:function h(){var l=this.condition;j.feContent.set("visible",true);this.set("visible",false);j.onConditionEdit(l,this.model.get());j.toggleButtonStatus(true);j.set("showCondWalk",false);},close:function k(){j.feContent.set("visible",true);this.set("visible",false);var l=this.condition;if(l&&l.isEmpty()){l.del();}j.toggleButtonStatus(true);j.set("showCondWalk",false);},targets:null,targetsLastMod:null,ets:null,condition:null,bindings:{disableElementsBrowsing:"this.parent.disableElementsBrowsing"}};},onConditionEdit:function(j,h){j.tree.modifyConditionNode(j,h);},getAddConditionList:function d(){return[{n:mstrmojo.desc(1994,"Add Condition"),handler:function(){this.mainExpr.newCondition(null,true);}}];},toggleButtonStatus:function B(h){this.buttonBar.toggleBtnStatus(h);},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-FE-andOrPopup mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",contentNodeCssClass:"mstrmojo-balloon",slot:"containerNode",modal:false,autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var h=this.condition,l=h&&h.data&&h.data.not,m=h&&h.parent,j=m&&m.data,k=(j&&j.fn)+(l?21:0);this.list.opening=true;this.list.set("selectedItem",isNaN(k)?null:{did:k});this.list.opening=false;},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",renderOnScroll:false,items:[{did:19,n:O[19]},{did:20,n:O[20]},{did:19+21,n:O["19_21"]},{did:20+21,n:O["20_21"]}],onchange:function(){if(this.opening){return ;}var j=this.parent,h=j.condition,o=this.selectedItem,n=o&&o.did,m=n>21?true:null,l=n-(m?21:0);j.close();var k=h&&h.parent;if(k&&k.data&&k.data.et===I.ANDOR){k.edit(h,l,m);}else{var p=h&&h.data;if(p&&(p.not!==m)){p.not=m;h.paint();}}}}]},createSetPopupRef:{scriptClass:"mstrmojo.fe.CreateSetEditor",contentNodeCssClass:"",cssClass:"CreateSet-Editor",title:mstrmojo.desc(12034,"Create a Set"),slot:"containerNode"},_set_busy:function(j,h){if(h){this.set("enabled",false);this.set("iconClass","mstrmojo-WaitIcon");}else{this.set("enabled",true);this.set("iconClass","");}},_set_model:function(m,j){var k=this.model,l=k!==j;if(l){this.model=j;this.modelLastSet=new Date();var h=function(n){return P(J(n));};j.exprForest=h(j.expr);j.limitExprForest=h(j.limitExpr);if(this.feContent&&this.feContent.feExpr.ve){this.feContent.feExpr.ve.nameFactory.clear();}}return l;},onUpdateBrowseElementsParams:mstrmojo.emptyFn,openWalk:function(q,t,z,AA){var w=this,j=X.delta(t.domNode,w.containerNode);j.y+=(z==="andor"?16:parseInt(t.domNode.offsetHeight,10));var x={condition:t,zIndex:w.zIndex+10,left:j.x+"px",top:j.y+"px"},h;switch(z){case"andor":if(w.skipAndOrPopup){return ;}h="andOrPopupRef";break;case"createSet":case"createSetOpt":if(AA&&AA.e&&AA.e.target){var m=AA&&AA.e&&AA.e.target,p=X.delta(m,w.containerNode);x.left=p.x+"px";x.top=p.y+parseInt(m.offsetHeight,10)+"px";}var u=w.model.targets;h="createSetPopupRef";x.type=z;x.model={attrs:b.filter(u,function(n){return n.t===C.ATTRIBUTE;}),metrics:b.filter(u,function(n){return n.t===C.METRIC;})};if(z==="createSetOpt"){x.condition=t.parent;x.model.childIdx=t.childIndex();}break;case"condition":var o=w.walk,k=t.textNode.cloneNode(true),l=o.conditionNode.firstChild;e.removeClass(k,"editable");e.addClass(o.conditionNode,"mstrmojo-ConditionNode");if(l.firstChild){l.removeChild(l.firstChild);}l.appendChild(k);o.set("objectBrowsingEnabled",w.objectBrowsingEnabled);o.set("targets",w.model.targets);o.set("targetsLastMod",w.modelLastSet);o.set("ets",t.tree.validExprTypes||w.validExprTypes);o.set("condition",t);o.set("model",S.clone(q));o.set("hasPrompt",w.model.hasPrompt);o.set("disableElementsBrowsing",w.disableElementsBrowsing||o.disableElementsBrowsing);o.set("editor",w);o.set("inRelation",t.inRelation);w.feContent.set("visible",false);o.set("visible",true);o.columnWalk.target.updateScrollbars();w.toggleButtonStatus(false);w.set("showCondWalk",true);w.set("isNewCond",!!q.isNew);return ;}w.openPopup(h,x);}});mstrmojo.fe._isReportFilterEditor=mstrmojo.provide("mstrmojo.fe._isReportFilterEditor",{_mixinName:"mstrmojo.fe._isReportFilterEditor",getExpressionContainerCfg:function(){var h=this._super();return mstrmojo.mixin({clearSelect:function(){this.re.clearTreeSelect();}},h);},getExpressionContentsConfig:function(){return[{alias:"re",scriptClass:"mstrmojo.fe.ReportFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}}];}});mstrmojo.fe.ReportFilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,[mstrmojo.fe._isReportFilterEditor],{scriptClass:"mstrmojo.fe.ReportFilterEditor"});mstrmojo.fe.ReportFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.ReportFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",onNew:function(h){h.data.isNew=true;this.editor.openWalk(h.data,h.widget.ctxtBuilder.itemWidgets[h.index],"condition");},onnodeclick:function A(h){var j=h.editor||this.tree.editor;j.openWalk(this.data,this,h&&h.part,h);},allowDrop:function G(h){var k=h&&h.src,m=k&&k.data,l=m&&m.et,j=k&&k.widget&&k.widget.tree;return l&&this!==j;}});mstrmojo.fe.FilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,null,{getExpressionContainerCfg:function(){var h=this._super();return mstrmojo.mixin({isBlankArea:function(j){if(this._super(j)){return true;}return !b.filterOne([this.ve,this.vle,this.re],function(k){if(k&&X.contains(k.domNode,j,true)){return true;}});},clearSelect:function(){this.ve.clearTreeSelect();this.vle.clearTreeSelect();}},h);},getExpressionContentsConfig:function(){return[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11746,"Dataset Level Conditions"),cssClass:"mstrmojo-FE-expr-header dl",bindings:{visible:"true || this.parent.parent.parent.showLimits"}},{alias:"ve",scriptClass:"mstrmojo.fe.RWViewFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},onBlankClick:function(h){this.parent.clearSelect(h);},supportRelation:true,postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11747,"Template Level Conditions"),cssClass:"mstrmojo-FE-expr-header tl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"vle",scriptClass:"mstrmojo.fe.RWViewLimitExprTree",level:K.TEMPLATE,bindings:{visible:"this.editor.showLimits",items:"this.editor.model.limitExprForest || []"},onBlankClick:function(h){this.parent.clearSelect(h);},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("limitExpr",this);}}];},getConditionWalkConfig:function(){var h=this._super();S.copy({scriptClass:"mstrmojo.fe.ConditionWalk"},h);return h;},getAddConditionList:function d(){var h=this._super();h.push({n:mstrmojo.desc(12055,"Add Dynamic Condition"),handler:function(){this.mainExpr.newCondition({et:I.XML,idc:1,ph:{}},true);}});return h;},onConditionEdit:function(k,j){if(k.tree.level===k.level||k.tree.level===undefined){this._super(k,j);}else{k.parent.remove(k.data);var h=K.TEMPLATE===k.level?this.limitExpr:this.mainExpr;h.addSingleCondition(j);}}});mstrmojo.fe.RWViewFilterExprTree=mstrmojo.declare(mstrmojo.fe.RelationFilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",levelSwitchValidTypes:[I.MQ],onNew:function(h){h.data.isNew=true;if(!h.data.ph){this.editor.openWalk(h.data,h.widget.ctxtBuilder.itemWidgets[h.index],"condition");}},onnodeclick:function A(j){var h=this.tree,l=j.editor||h.editor;this.level=h.level;var k=typeof (l.disableElementsBrowsing)==="function"&&l.disableElementsBrowsing();if(k&&this.data.et===I.AE){return ;}l.openWalk(this.data,this,j&&j.part,j);},ondragend:function N(k){var j=k&&k.tgt,h=j&&j.widget;if(this.tree&&h&&h.tree&&h.tree!==this.tree){Z.call(this);return ;}this._super(k);},getItemConfig:function(k,h,l){var j=this._super(k,h,l);return S.copy({getConditionTextPostfix:function(){if(this.data.et!==I.MQ){return"";}return'<img class="mstrmojo-moveToViewLimit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(4978,"Move to view limit")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewLimit(w); return false;\" />";}},j);},moveMQNodeToViewLimit:function(k){if(b.indexOf(this.levelSwitchValidTypes,k.data.et)===-1){return ;}var j=S.copy(k.data);k.parent.remove(k.data);var h=this.editor.limitExpr;h.addSingleCondition(j);},allowDrop:function G(h){var k=h&&h.src,n=k&&k.data,m=n&&n.et,l=this.tree,j=k&&k.widget&&k.widget.tree;return m&&(this===l?(j!==l):true);}});mstrmojo.fe.RWViewLimitExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewLimitExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-limitExpr",validExprTypes:b.hash([I.MQ]),levelSwitchValidTypes:[I.MQ],onnodeclick:function A(j){var h=this.tree,k=h.editor;this.level=h.level;k.openWalk(this.data,this,j&&j.part,j);},onConditionEdit:function(j,h){this._super(j,h);j.data.mdxUnitId=j.data.m.did;V(j);},addSingleCondition:function(j){var h=this._super(j);V(h);},allowDrop:function(h){var l=h&&h.src,n=l&&l.data,m=n&&n.et,k=this.tree,j=l&&l.widget&&l.widget.tree;if(k===j){return this!==j&&this.data&&(this===l.parent||this.data.mdxUnitId===(n&&n.mdxUnitId));}return !(b.indexOf(this.levelSwitchValidTypes,m)===-1);},ondrop:function L(j){var m=j&&j.src,h=m&&m.widget;if(h&&h.tree!==this.tree){var l=m&&m.data;if(l&&l.index!==null){var k=h.ctxtBuilder.itemWidgets[l.index];k.tree.moveMQNodeToViewLimit(k);}m.data=null;}this._super(j);},isEditable:function(h){return h.mdxUnitId&&this._super(h);},ondragend:function R(h){var l=h&&h.tgt,j=l&&l.widget;if(j&&j.tree!==this.tree){var k=h.src&&h.src.data;if(k&&(k.indices||(k.index!==null))){this.remove(k.indices||k.index);}Z.call(this);}else{this._super(h);}},moveMQNodeToViewFilter:function(j){var h=this.editor.mainExpr;j.parent.remove(j.data);h.addSingleCondition(j.data);},getItemConfig:function(k,h,l){k.mdxUnitId=D(k);var j=this._super(k,h,l);return S.copy({cssClass:g(k,h,l)?"per-metric-limit":"",forbidRelation:true,getConditionTextPostfix:function(){if(this.data.et!==I.MQ||mstrmojo.rw.ConditionWalk.isMdxDM(this.data.m.did)){return"";}return'<img class="mstrmojo-moveToViewFilter" src="../images/1ptrans.gif" title="'+mstrmojo.desc(9746,"Move to view filter")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewFilter(w); return false;\" />";}},j);}});function P(j){var h=[];b.forEach(j,function(k){if(!k){return ;}if(k.et===I.ANDOR&&!(k.node&F.CONDITION)){k.nds=P(k.nds);if(k.nds.length===0){return ;}else{if(k.nds.length===1){var l=k.nds[0];if(k.not){l.not=!l.not;}h.push(l);return ;}}}h.push(k);});return h;}function J(h){return h?[h]:[];}function f(h){return h&&h.length===1?h[0]:null;}function c(k){var j=P(k),h;if(!j[0]||j[0].mdxUnitId){h={et:I.ANDOR,fn:a.FN.AND,nds:j};}else{h=j[0];}return[h];}function g(j,h,k){return(k===k.tree||k.parent===k.tree)&&!!j.mdxUnitId;}function D(j){if(!("mdxUnitId" in j)){var h;switch(j.et){case I.MQ:case I.MC:h=j.m.did||null;break;case I.ANDOR:b.forEach(j.nds,function(l){var k=D(l);if(h===undefined){h=k;}else{if(h!==k){h=null;return false;}}return true;});break;default:h=undefined;break;}j.mdxUnitId=h;}return j.mdxUnitId;}function V(n){var p=n.tree,o=p.ctxtBuilder.itemWidgets[0],u=n.parent,q=b.indexOf(u.items,n.data),l=u.items[q],j=l.mdxUnitId;if(u===p){return ;}if(u.data.mdxUnitId===j){return ;}if(o.data.mdxUnitId){var k={et:I.ANDOR,fn:a.FN.AND,nds:[o.data,l]};p.remove(0);p.add([k]);p.ctxtBuilder.itemWidgets[0].ctxtBuilder.itemWidgets[0].remove(l);}else{var m=o,h;b.forEach(o.data.nds,function(x,w){if(x.mdxUnitId===l.mdxUnitId&&o.items[w]!==l){m=o.ctxtBuilder.itemWidgets[w];h=w;return false;}});if(m===u){return ;}if(m.data.et!==I.ANDOR){var t={et:I.ANDOR,fn:a.FN.AND,nds:[m.data,l]};o.add([t],h+1);o.remove(m.data);}else{m.add([l]);}u.remove(l);}}}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.Controller");mstrmojo.AS.ASQbEsController=mstrmojo.declare(mstrmojo.qb.es.Controller,null,{onFinishButtonClick:function A(){var C={};var E=mstrApp.rootController.model,D=E.dbrs,F=E.tables,B=D.find(function(G){return G.did===E.SelDBRoleID;});F.forEach(function(I){var H=I.dbr;I.name=I.n;if(!C[H]){var G=D.find(function(J){return J.did===H;});C[H]={id:H,type:G.mdDBRole.db_type,name:G.n,tables:[]};}C[H].tables.push(I);});window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(C);mstrApp.getRootController().exitApplication();}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._BigQueryController","mstrmojo.qb.es.Controller");mstrmojo.qb.bigquery.ESController=mstrmojo.declare(mstrmojo.qb.es.Controller,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.ESController"});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.RootView","mstrmojo.qb.QBHelpers");var C=mstrmojo.qb.QBHelpers;mstrmojo.qb.bigquery.ESRootView=mstrmojo.declare(mstrmojo.qb.es.RootView,null,{scriptClass:"mstrmojo.qb.bigquery.ESRootView",init:function A(D){this.children=C.clone(this.children);this.children[0].children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(D);}},getDBRoleSelector:function B(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery.ESController");var A=mstrmojo.DI.DIConstants;mstrmojo.AS.ASGBQController=mstrmojo.declare(mstrmojo.qb.bigquery.ESController,null,{onFinishButtonClick:function B(){var C={},D={};model=mstrApp.rootController.model,dbrId=model.dbrid,tables=model.tables,sourceAccountID=model.said;D.tables=new Array();tables.forEach(function(E){D.tables.push({id:E.dbr,ns:E.ns,account_id:sourceAccountID,n:E.n,dbtn:E.n,name:E.n});});D.name="Google Bigquery";D.id=dbrId;D.type=A.dbType.GOOGLE_BIGQUERY;C[dbrId]=D;window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(C);mstrApp.getRootController().exitApplication();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.fe.FilterUtils","mstrmojo.fe.FilterEditor","mstrmojo.MouseOverContainer");mstrmojo.requiresDescs(218,219,221,308,505,531,629,767,922,959,1088,1442,1825,2056,2102,2140,2156,3336,5657,8078,8079,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,9048,9149,9151,12085,12299,12436,12905,13082);var D=[1,4,8,16,32,64,128],A=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],V=["B","R","W","D","C","U","E"],m=[{n:mstrmojo.desc(16034,"Grant"),v:0},{n:mstrmojo.desc(16035,"Deny"),v:1},{n:mstrmojo.desc(8441,"Default"),v:2}],l="emmacubeSFE",R="93B9A8EB46D9C6A4ADA5FEBAB092A7CF",a=mstrmojo.array,N=mstrmojo.expr,Q=N.ET,J=mstrmojo.string.htmlAngles,d=mstrmojo.fe.FilterUtils.getExprXml,G=mstrmojo.desc(12905,"Security rules cannot be defined/updated for metric only datasets."),j=" ",O="{",e="}",k="(",P=")",F=mstrmojo.desc(308,"and");function W(o,p,n){return{scriptClass:"mstrmojo.HBox",alias:o,right:p,cssText:"height:20px;",children:[{scriptClass:"mstrmojo.Label",text:n,cssText:"width:80px"},{scriptClass:"mstrmojo.Pulldown",cssText:"width:100px",itemIdField:"v",items:m,defaultSelection:2,selectionPolicy:"reselect",_set_value:function(t,q){this.value=q;}}]};}function f(w){var n=[],t,o,q,u,p,x;if(w&&w.a&&w.a.n){n.push(J(w.a.n));if(w.fm&&w.fm.n){n.push(k+J(w.fm.n)+P);if(w.fn!==undefined){n.push(J(N.fnName(w.et,w.fn,w.fnt,w.fm.dtp)));t=N.fnCstCount(w.fn,w.fnt);if(w.et===Q.AC){if(t>=1){if(w.a2&&w.a2.n){n.push(J(w.a2.n));if(w.fm2&&w.fm2.n){n.push(k+J(w.fm2.n)+P);}}if(t>1){n.push(F);if(w.a3&&w.a3.n){n.push(J(w.a3.n));if(w.fm3&&w.fm3.n){n.push(J(w.fm3.n));}}}}}else{if(w.et===Q.AL){o=[];a.forEach(w.cs,function(z){o.push(z.v);});n.push(o.join(mstrConfig.listSep||j));}else{if(t>=1){q=w.cs;u=q&&q[0];x=u&&u.p&&u.p.n;n.push(x?(O+J(x)+e):J(u&&u.v));if(t>1){p=q&&q[1];n.push(F);x=p&&p.p&&p.p.n;n.push(x?(O+J(x)+e):J(p&&p.v));}}}}}}}return k+n.join(j)+P;}function Z(o){var n=[];if(!o){return"";}if(o.nds){a.forEach(o.nds,function(p){n.push(f(p));});}else{return f(o);}return n.join(j+N.BRANCH_FNS[o.fn]+j);}function X(){var o=this.oi,p=this,q=[];mstrmojo.array.forEach(o.acls,function(u){if(u.isDirty){q.push({uid:u.did,fg:u.fg,exp:d(u.filter)});}});mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function t(u){if(p.postSaveACL){p.postSaveACL(true);}p.close();},failure:function n(u){mstrmojo.alert(u.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{taskId:"DISetCubeSecurityFilter",cubeid:o.did,filter:JSON.stringify(q)});}function c(p){var n=this.dataGrid,o=function o(x,u){var w={expr:u,hasPrompt:true,targets:x.concat({n:"User Login",t:N.TP.PROMPT,did:R,st:N.STP.PROMPT_STRING})},q=function q(AA){var AB=AA.expr;p.isDirty=true;p.filter=AB;n.set("items",n.items.slice(0));},t,z=function z(){return true;};t=window.mstrmojo&&mstrmojo.all[l]||mstrmojo.insert({id:l,scriptClass:"mstrmojo.fe.FilterEditor",skipAndOrPopup:true,showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-SecurityFilter-editor"});t.validExprTypes=a.hash([mstrmojo.expr.ET.AQ,mstrmojo.expr.ET.AC]);t.set("title",mstrmojo.desc(12085,"Select a filter"));t.set("onSave",q);t.set("model",w);t.set("disableElementsBrowsing",z);t.open(null,{zIndex:n.parent.zIndex+10||10});};o(this.parent.dataGrid.parent.candidates,p.filter||"");}function B(q,u){var t=this,n=this.dataGrid,p=this.menuHelper=this.menuHelper||new mstrmojo.MenuButton({cm:[{n:mstrmojo.desc(1088,"Edit"),did:"Edit"},{n:mstrmojo.desc(629,"Delete"),did:"Delete"}],cmCssClass:"di-sf-cxt-menu",getMenuPosition:function o(){var w=mstrmojo.dom.position(u,true);return{x:Math.round(w.x),y:Math.round(w.y+w.h)};},executeCommand:function(w){switch(w.did){case"Edit":c.call(t,q);break;case"Delete":q.isDirty=true;q.filter=null;n.set("items",n.items.slice(0));break;}}});p.set("zIndex",n.parent.zIndex+10);p.showContextMenu();}function I(n){var p=[],u=Math.floor(n/1000),q=n%1000,w=D,x=A,t=w.length,z,o;for(o=0;o<t;o++){p.push(x[o]);p.push(" ");if((q&w[o])>0){p.push(mstrmojo.desc(8083,"Granted"));}else{if((u&w[o])>0){p.push(mstrmojo.desc(8084,"Denied"));}else{p.push(mstrmojo.desc(959,"Default"));}}p.push(",");}z=p.join("");return z.substring(z,z.length-1);}function Y(x){var t=[],w=x%1000,p=D,u=V,n=p.length,q,o;for(o=0;o<n;o++){if((w&p[o])>0){t.push(u[o]);t.push(",");}}q=t.join("");return q.substring(q,q.length-1);}function H(n){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[n]||n;}function E(n){return{"253000":255000,"253":255,"32221":223,"56197":199}[n]||n;}function K(p,q){var t=p.items,o=mstrmojo.array.find(t,p.itemIdField,q),x=p.customItem,n=t.length-2;if(o===-1){var u={n:Y(q),rgt:q};if(x){t.splice(n,1);}n=t.length-1;t.splice(n,0,u);p.customItem=u;}else{if(x&&o!==n){t.splice(n,1);p.customItem=null;}}p.set("title",I(q));p.value=q;}function C(n){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[n]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8092,"Custom Permission Level"),rgt:-1}];}function M(n){return(n&&n.t===8);}function U(w){var u=w.acls,n=w.inhs,t=[],z,p,x,o,q;if(M(w)){u=u.concat(mstrmojo.hash.valarray(n));}for(o=0,q=u.length;o<q;o++){z=u[o];x=z.rgt;if(x>1000){p=mstrmojo.hash.copy(z);p.den=true;p.rgt=Math.floor(x/1000);t.push(p);}if((x%1000)>0){p=mstrmojo.hash.copy(z);p.den=false;p.rgt=x%1000;t.push(p);}}w.acls=t;return w;}function L(o){var n={isSerializable:function(t,q,p){switch(t){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(t,p,q){if(t==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",o,n);}function g(q,p){var o=q&&q.oi,n;if(o){o=U(o);n=L(o);var t={taskId:"saveObjectACL",objectXML:n,objectType:o.t,objectID:o.did};mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(u){if(p){if(q.postSaveACL){q.postSaveACL(true);}q.close();}},failure:function(u){mstrmojo.alert(u.getResponseHeader("X-MSTR-TaskFailureMsg"));if(p){if(q.postSaveACL){q.postSaveACL(false);}q.close();}}},t);}}function h(z){var AE=z.aclList,AF=z.objectInputer,AA=z.rightPulldown,q=AF.getSelectedObjects(),u=q.length,AB=[],p,AD=AA.value,o,AC,n;if(!AF.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,z.alertTitle);return false;}for(o=0;o<u;o++){p=q[o];AC=mstrmojo.array.find(AE.items,"did",p.did);if(AC!==-1){n=AE.items[AC];if(z.uneditableRights[n.rgt]){continue;}}AB.push(new mstrmojo.Obj({n:p.n,did:p.did,st:p.st,rgt:AD,filter:"",fg:1,newItem:true}));}if(AB.length>0){var t=0;mstrmojo.array.forEach(AB,function(AG){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function AH(AJ){var AI=AJ.oi.gsfsr.u,AK;if(AI.mi){AK=AB[t];AK.partial=AI.partial_type;AK.fg=AI.partial_type||3;AK.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(AI.mi.exp.nd,[].concat(AI.mi["in"].oi),z.formTypes);AK.filterText=AI.mi.exp.content;}t++;if(t===AB.length){AE.add(AB);z.set("hasChanged",true);}}},{taskId:"DIGetCubeSecurityFilter",uid:AG.did,cubeid:z.cubeid});});var x=mstrmojo.array.findMulti(AE.items,"did",AB);if(x.count){var w=x.indices.concat().sort(mstrmojo.array.numSorter).slice(0,x.count);for(o=w.length-1;o>-1;o--){AE.remove(w[o]);}}}AF.set("items",[]);z.set("inEditMode",false);return true;}mstrmojo.DI.ui.dialogs.DIPermissionDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIPermissionDialog",cssClass:"mstrmojo-di-permissions",zIndex:10,inEditMode:false,hasChanged:false,showButtonText:true,showObjectNameOnTitle:true,uneditableRights:{},defaultRight:223,viewOnlyMode:false,title:mstrmojo.desc(13082,"Permissions"),userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),formTypes:{},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",anim:true,selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(o){var n=this.parent.parent,u=n.opener,t=u.objectInputer,q=n.userBrowser,p=q.getTotalSelections();if(p&&p.length>0){t.add(p,t.items.length-1);u.set("inEditMode",true);}n.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(n){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var w=this.rgt,x=Math.floor(w/1000),u=w%1000,p=this.children,q,t,o,n;for(o=0,n=7;o<n;o++){q=p[o];t=q.right;if((u&t)>0){q.children[1].value=0;}else{if((x&t)>0){q.children[1].value=1;}else{q.children[1].value=2;}}}this.refresh();},getACLValue:function(){var t=0,u=0,p=this.children,q,o,n;for(o=0,n=7;o<n;o++){q=p[o];if(q.children[1].value==0){t+=q.right;}else{if(q.children[1].value==1){u+=q.right;}}}return u*1000+t;},children:[W("browse",1,mstrmojo.desc(1825,"Browse")),W("read",4,mstrmojo.desc(8078,"Read")),W("write",8,mstrmojo.desc(8079,"Write")),W("delete",16,mstrmojo.desc(629,"Delete")),W("control",32,mstrmojo.desc(8080,"Control")),W("use",64,mstrmojo.desc(8081,"Use")),W("execute",128,mstrmojo.desc(8082,"Execute")),{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(n){var o=this.parent.parent;if(o.onOK){o.onOK();}o.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(221,"Cancel"),onclick:function(n){var o=this.parent.parent;if(o.onCancel){o.onCancel();}o.close();}}]}]},_set_oi:function(p,o){this.oi=this.preProcessACLs(o);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},preProcessACLs:function(x){if(x&&x.acls){var u=x.acls,t=u&&u.length,w=M(x),o={},z,n,p,q;if(w){p={};x.inhs=p;}for(q=0;q<t;q++){z=new mstrmojo.Obj(u[q]);if(z.den){z.rgt=z.rgt*1000;}if(w&&z.inh){p[z.n]=mstrmojo.hash.copy(z);continue;}n=o[z.did];if(!n){n=mstrmojo.hash.copy(z);n.rgt=0;delete n.den;o[z.did]=n;}n.rgt=n.rgt+z.rgt;if(n.rgt>=255000){n.rgt=Math.floor(n.rgt/1000)*1000;}}u=mstrmojo.hash.valarray(o);x.acls=u;}return x;},postSaveACL:function(){},getAvailableRightsForDisplay:function(){return C(this.oi.st);},getAvailableRightsForSelection:function(){return C(this.oi.st);},onOpen:function(){delete mstrmojo.all[l];var u=this.rightPulldown;u.set("items",this.getAvailableRightsForSelection());u.set("value",this.defaultRight);var z=this.objectInputer,p=this.userSelector,n=p&&p.userBrowser;z.zIndex=this.zIndex+1||11;if(n&&n.hasRendered){n.set("items",[]);n.getContent(n);}var w=mstrmojo.ACL.UserDataService,t=200,x=function(AA){z.set("candidates",AA);},o=function(AA){mstrmojo.alert(AA.getResponseHeader("X-MSTR-TaskFailureMsg"));},q={success:x,failure:o};w.getUserCandidates(t,q);this.set("inEditMode",false);this.set("hasChanged",false);},onClose:function(){var n=this.objectInputer;n.set("items",[]);this.aclList.clearSelect();this.destroy();},oninEditModeChange:function(){var n=this;if(n.inEditMode){mstrmojo.css.removeClass(n.objectInputer.domNode,"small");}else{mstrmojo.css.addClass(n.objectInputer.domNode,"small");}},children:[{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-ACLEditor-ACLList",cssText:"width: 100%",alias:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",dropZone:true,bindings:{items:"this.parent.oi.acls"},sortCol:"",sortAsc:new mstrmojo.Obj({n:true,rgt:true}),sort:function(q,o){var p=function n(u,t){return function(z,w){var AB=z[u],x=w[u],AA=AB>x;if(AB===x){return 0;}if(t===AA){return 1;}return -1;};};if(this.items){this.items.sort(p(q,o));this.render();}},onremove:function(o){var u=this.parent.oi;if(!M(u)){return ;}var w=u.inhs,q=o.value,n=q&&q.length,t,p;for(p=0;p<n;p++){t=q[p].did;delete w[t];}},onadd:function(o){var u=this.parent.oi;if(!M(u)){return ;}var w=u.inhs,q=o.value,n=q&&q.length,t,p;for(p=0;p<n;p++){t=q[p].did;w[t]=mstrmojo.hash.copy(q[p]);w[t].inh=true;}},onACLChanged:function(o){var n=this.parent.oi;this.parent.set("hasChanged",true);if(!M(n)){return ;}n.inhs[o.did]=mstrmojo.hash.copy(o);n.inhs[o.did].inh=true;},postCreate:function S(){this.columns=[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5657,"User/Group"),onclick:function(){var o=!(this.dataGrid.sortAsc.n);this.dataGrid.set("sortCol","n");this.dataGrid.sortAsc.set("n",o);this.dataGrid.sort("n",o);},postCreate:function(){if(this.dataGrid.sortCol==="n"){this.set("cssClass",(this.dataGrid.sortAsc.n)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},dataFunction:function(q,o,p){return'<div class="mstrmojo-ACLEditor-user '+(q.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(q.n)+"</div>";},colCss:"userCol"},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9149,"Access"),onclick:function(){var o=!(this.dataGrid.sortAsc.rgt);this.dataGrid.set("sortCol","rgt");this.dataGrid.sortAsc.set("rgt",o);this.dataGrid.sort("rgt",o);},postCreate:function(){if(this.dataGrid.sortCol==="rgt"){this.set("cssClass",(this.dataGrid.sortAsc.rgt)?"mstrmojo-sortAsc":"mstrmojo-sortDesc");}}},colCss:"rgtCol",dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"access-label",alias:"mouseoutItem",bindings:{text:function(){var p=this.parent.dataGrid.parent.getAvailableRightsForDisplay(),o=p.length,q;for(q=0;q<o;q++){if(p[q].rgt===this.parent.data.rgt){return p[q].n;}}return mstrmojo.desc(2056,"Custom");}}},{scriptClass:"mstrmojo.HBox",alias:"mouseoverItem",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",defaultSelection:0,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var o=this.parent.parent.data;this.set("value",o[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(w,p){var q=this.value,o=(q!==p);if(o){if(p===-1){var u=this.parent.parent.dataGrid.parent,t=this;u.openPopup("customACL",{zIndex:u.zIndex+10,rgt:q,twoStates:!!this.parent.parent.data.newItem,onOK:function(){t.set("value",this.getACLValue());},onCancel:function(){t.set("value",q);}});return false;}p=H(p);K(this,p);this.parent.parent.data.set(this.itemIdField,p);if(q!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(o){var p=this,q=function(){var t=p.parent.parent.dataGrid;t.remove(p.parent.parent.data);t.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:q}},{zIndex:9999});}}]}],postCreate:function(){var o=!this.dataGrid.parent.viewOnlyMode&&!this.dataGrid.parent.uneditableRights[this.data.rgt];this.set("doSwitch",o);}}}];if(this.parent.oi.canEdit){this.columns.push({headerText:mstrmojo.desc(12436,"Data Security"),headerCss:"di-security-header",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"security-filter-col",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click><span class="di-sf-icon"></span><span class="di-sf-n"></span><span class="di-sf-mn"></span></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){this.domNode.children[1].innerHTML=this.text||"";},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},onclick:function(o){var p=o.target||mstrmojo.dom.eventTarget(o.hWin,o.e);if(p.className.indexOf("di-sf-mn")>-1){B.call(this,this.parent.data,p);}else{if(!this.parent.data.filter){c.call(this,this.parent.data);}}},onRender:function n(){var o=this.parent.data;if(this.domNode){if(o.noElement){mstrmojo.css.toggleClass(this.domNode,"noEdit",true);this.domNode.title="Security rules cannot be defined/updated for metric only datasets.";}else{mstrmojo.css.toggleClass(this.domNode,"update",!!o.filter);}}},bindings:{text:function(){var o=this.parent.data;return o.filter?mstrmojo.desc(505,"Update"):mstrmojo.desc(922,"Add...");}}}});}}},{scriptClass:"mstrmojo.HBox",cssClass:"di-permission-MorePanel",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2156,"Add")+":",cssClass:"di-permission-addLabel"},{scriptClass:"mstrmojo.ACL.UserInputBox",emptyText:mstrmojo.desc(9151,"Type users or groups here."),cssClass:"mstrmojo-ObjectInputBox mstrmojo-ACLEditor-inputBox small",noCache:true,onRender:function(){var n=this.parent.parent;if(n){n.objectInputer=this;}},postBuildDom:function(){var n=this;this._clickHandler=function(o){n.parent.parent.set("inEditMode",true);};mstrmojo.dom.attachEvent(this.domNode,"click",this._clickHandler);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(n){var o=this.parent.parent;o.openPopup("userSelector",{zIndex:o.zIndex+10});},text:"..."},{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"rgt",value:-1,defaultSelection:0,selectionPolicy:"reselect",onRender:function(){var n=this.parent.parent;if(n){n.rightPulldown=this;}},postCreate:function(){this.items=this.parent.parent.getAvailableRightsForSelection();},_set_value:function(w,p){var q=this.value,o=(q!==p);if(o){if(p===-1){var u=this.parent.parent,t=this;u.openPopup("customACL",{zIndex:u.zIndex+10,rgt:q,twoStates:true,onOK:function(){t.set("value",this.getACLValue());},onCancel:function(){t.set("value",q);}});return false;}p=E(p);K(this,p);return true;}return true;},bindings:{visible:"this.parent.parent.inEditMode"}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",onclick:function(){var n=this.parent.parent;h(n);},text:mstrmojo.desc(2156,"Add"),bindings:{visible:"this.parent.parent.inEditMode"}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),bindings:{enabled:function(){var n=this.parent.parent.oi;return(n.acg&32)>0;},visible:"!this.parent.parent.viewOnlyMode"},onclick:function(n){var o=this.parent.parent;if(h(o)){g(o,true);}X.call(this.parent.parent);},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",onclick:function(n){var o=this.parent.parent;if(!o.inEditMode){o.close();o.set("hasChanged",false);}o.objectInputer.set("items",[]);o.set("inEditMode",false);},bindings:{iconClass:function(){if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){if(!this.parent.parent.showButtonText){return"";}if(this.parent.parent.inEditMode||this.parent.parent.hasChanged){return mstrmojo.desc(2140,"Cancel");}return mstrmojo.desc(2102,"Close");}}}]}]});$ENUM_DataType={Char:8,Date:14,Time:15,TimeStamp:16,BigDecimal:30,Int64:34};$PERMISSION_DIALOG=mstrmojo.DI.ui.dialogs.DIPermissionDialog;$PERMISSION_DIALOG.buildWalk=function b(q,AA,w){var AC,u,x,p,o,n,z,AB,t={1:$ENUM_DataType.TimeStamp,8:$ENUM_DataType.Date,9:$ENUM_DataType.Time,2:$ENUM_DataType.Int64,3:$ENUM_DataType.Char,11:$ENUM_DataType.BigDecimal,};if(q===undefined){return null;}if(q.op&&q.op.fnt===mstrmojo.expr.FN.AND){if(Object.prototype.toString.call(q.nd)==="[object Array]"){AC={fn:q.op.fnt,et:q.et,nds:[]};a.forEach(q.nd,function(AD){AC.nds.push(b(AD,AA,w));});}else{if(!q.nd){return null;}AC=b(q.nd,AA,w);}}else{AC={fn:q.op.fnt,et:q.et};a.forEach(a.ensureArray(q.nd),function(AD){if(AD.at&&AD.at.mi){u=AC.a?"a2":"a";o=AD.at.mi["in"].oi[0];z=o.did;AC[u]={did:z,n:o.n,t:o.tp};if(AD.fm){x=AC.fm?"fm2":"fm";n=AD.fm.mi["in"].oi[0];AB=n.did;AC[x]={did:AB,n:n.n,t:n.tp,dtp:t[w[z+AB]]||$ENUM_DataType.Char,ibf:true,idf:true,itf:true};}}else{if(AD.cst){if(AD.prompt_instances){p=AA[AD.prompt_instances.prompt_instance.pin];AC.cs=[{p:{did:p.did,n:p.n,st:p.stp,t:p.tp}}];}else{AC.cs=AC.cs||[];AC.cs.push({v:AD.cst.content,dtp:AD.ddt});}}else{if(AD.content!==undefined){AC.cs=AC.cs||[];AC.cs.push({v:AD.content,dtp:AD.ddt});}else{if(AD.mi&&q.op.fnt===N.FN.IN_LIST){u=AC.a?"a2":"a";o=AD.mi["in"].oi;z=o.did;AC[u]={did:z,n:o.n,t:o.tp};var AE=[];a.forEach(AD.mi.es.e,function(AF){AE.push({n:AF.disp_n,v:AF.ei});});AC.es=AE;}}}}});}return AC;};}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.fe.FilterEditor","mstrmojo.ui._HasScroller");var C=mstrmojo.hash,B=mstrmojo.expr,A=B.ET;mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree=mstrmojo.declare(mstrmojo.fe.RWViewLimitExprTree,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree",markupString:'<div id="{@id}"><div class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},levelSwitchValidTypes:[A.MQ,A.MC],getItemConfig:function(F,D,G){var E=this._super(F,D,G);return C.copy({getConditionTextPostfix:function(){return"";}},E);},setupScrollNodes:function(){this.scrollNode=this.scrollboxNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.fe.FilterEditor","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.fe.ConditionNode","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.editors.fe.RelationNode");var C=mstrmojo.hash,B=mstrmojo.expr,A=B.ET;mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree=mstrmojo.declare(mstrmojo.fe.RWViewFilterExprTree,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree",markupString:'<div id="{@id}"><div class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},nodeClassMap:{14:mstrmojo.fe.AndOrNode,15:mstrmojo.vi.ui.editors.fe.RelationNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},levelSwitchValidTypes:[A.MQ,A.MC],setupScrollNodes:function(){this.scrollNode=this.scrollboxNode;},getItemConfig:function(F,D,G){var E=this._super(F,D,G);return C.copy({getConditionTextPostfix:function(){return"";}},E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo._HasPopup","mstrmojo.Popup","mstrmojo.hash","mstrmojo.expr","mstrmojo.Container","mstrmojo.ConditionModel","mstrmojo.Widget","mstrmojo.Button","mstrmojo.ui.ColumnWalk","mstrmojo.rw.ConditionWalk","mstrmojo.mstr.EnumNodeDimty","mstrmojo.vi.ui.ConditionWalkProvider","mstrmojo.vi.ui.AllObjectsBrowser");var U=mstrmojo.Widget,M=mstrmojo.array,G=mstrmojo.dom,Q=mstrmojo.hash,b=mstrmojo.css,V=mstrmojo.Button.newWebButton,L=mstrmojo.expr,C=L.ET,A=mstrmojo.mstr.EnumNodeDimty,N=M.hash([A.NodeDimtyOutputLevel]);var O=mstrmojo.rw.ConditionWalk.getAttForms,E=mstrmojo.rw.ConditionWalk.isMdxDM;function F(){var d=this.model;if(d){if(!d.attachEventListener){Q.make(d,mstrmojo.ConditionModel,{defaultETAttr:d.defaultETAttr,data:d.data});}d.attachEventListener("edit",this.id,"onmodeledit");}}function P(e,d){if(d&&d.detachEventListener){d.detachEventListener("edit",e.id,"onmodeledit");}}mstrmojo.vi.ui.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.ConditionWalk",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-ConditionWalk" mstrAttach:click><div class="walk"></div></div>',markupSlots:{walkNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:U.visibleMarkupMethod,onheightChange:U.heightMarkupMethod,onwidthChange:U.widthMarkupMethod},layoutConfig:{h:{walkNode:"100%"},xt:true},editor:undefined,columnWalk:undefined,walkProvider:null,objectBrowsingEnabled:false,children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"370px",width:"600px"}],postCreate:function B(){if(this._super){this._super();}if(!this.walkProvider){this.walkProvider=this.addDisposable(mstrmojo.insert(mstrmojo.vi.ui.ConditionWalkProvider));}},initWalk:function W(){var d=this.columnWalk,e=this.walkProvider;d.removeTrailingContainer(-1);d.addNextColumn(e.getTargetNodeProps());d.target.updateColumnContainer();this.updateOkBtn();},ob:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-vi-ui-ConditionWalk ObjectBrowserPopup mojo-theme-light",children:[{scriptClass:"mstrmojo.vi.ui.AllObjectsBrowser",alias:"browser",title:mstrmojo.desc(5298,"Select an Object"),layoutConfig:null,onSelectedItemsChange:function K(){var d=this.getSelectedItems(),e=d&&d[0],f=e&&e.t;this.parent.buttons.selectBtn.set("enabled",f&&f!==L.TP.FOLDER);},browse:function R(d){Q.copy(d,this);},getObjectSubTypes:function(){var d=this.browsableTypes;if(d){return d.split(",");}return this.constructor.prototype.browsableTypes();},dblClickOnNodes:function a(d){var g=this.onSelectCB,f=d.getTarget(),e=G.findWidget(f).data;g[0][g[1]](e);}},{scriptClass:"mstrmojo.Box",alias:"buttons",cssClass:"buttons",children:[V(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.opener.closePopup();}),V(mstrmojo.desc(547,"Select"),function(){var f=this.parent.parent,g=f.browser,h=g.onSelectCB,e=g.getSelectedItems(),d=this.parent.parent.opener;if(e&&e.length>0){h[0][h[1]](e[0]);}else{d.closePopup();}},true,{alias:"selectBtn",enabled:false})]}],onOpen:function H(){var h=this.shadowNode,d=document.body,e=document.documentElement,g=h.style,f=this.domNode;this.browser.obSearchBox.clearSearch(true);g.width=Math.max(d.clientWidth,e.scrollWidth)+"px";g.height=Math.max(d.clientHeight,e.scrollHeight)+"px";window.setTimeout(function(){b.addClass(f,"open");},1);},onClose:function D(){b.removeClass(this.domNode,"open");var d=this.browser;d.opened=false;d.reset();}},_set_model:function Z(g,d){var e=this.model,f=(d!==e);if(f){P.call(this,e);d.dimtyTypes=this.dimtyTypes||N;this.model=d;F.call(this,d);this.initWalk();}return f;},onmodeledit:function J(e){var d=this.columnWalk[e.prop==="c1"?"c0":e.prop];if(e.prop==="fm"){d=this.columnWalk.target;}if(d){d.updateColumnContainer();}this.updateOkBtn();this.postmodeledit(e);},postmodeledit:mstrmojo.emptyFn,updateOkBtn:function c(){var g=true,d=this.model,e,f=d&&L.fnCstCount(d.fn,d.fnt);if(!d){return ;}switch(d.et){case C.AQ:case C.AL:case C.MQ:for(e=0;e<f;e++){g=g&&!this["invalid"+e];}break;}g=g&&!!d.completed;this.delegateUpdateOkBtn(g);},delegateUpdateOkBtn:mstrmojo.emptyFn,browse:function I(f){var h=this.parent.editorNode,g=function(k,m){var j=G.position(k,true),l=G.position(m,true);return{x:j.x+j.w,y:l.y};},d=this.columnWalk,e=this.walkProvider;switch(f&&f.alias){case"target":case"dmy":e.browseObjs(this,f);break;case"c0":case"c1":e.browseObjs(this,f);break;case"es":e.browseEs(this,f,g(d.es.domNode,h));break;}},onOBSelect:function(j){var l=j.t;if(l===L.TP.FOLDER||l===0||l===undefined){return ;}var g=this.ob.browser,m=g.target;this.closePopup();if(m.alias==="c0"){m=m.attMxPd;}var e=this.targets,k=m.itemIdField,h=e||[],d=M.find(e,k,j[k]);if(d===-1){h.push(j);this.targets=h;this.targetsLastMod=new Date();this.raiseEvent({name:"updateTargets",targets:this.targets});}m.list.set("selectedIndex",M.find(m.items,"did",j.did));if(m.onObjBrowsed){m.onObjBrowsed(j);}},getDatasets:mstrmojo.emptyFn,getAttributeForms:function X(f){var e=this.editor;if(e&&e.getAttributeForms){return e.getAttributeForms(f);}var d=this.getDatasets();return O(f,d);},getAttributeInfo:function Y(d){var e,g=this.editor;if(g&&g.model&&g.model.targets){M.forEach(g.model.targets,function(h){if(h.did===d){e=Q.clone(h);return false;}});}else{var f=this.getDatasets();Q.forEach(f,function(h){e=Q.clone(h.att.filter(function(j){return j.did===d;})[0]);if(e){return false;}});}if(e){e.fs=this.getAttributeForms(d);}return e?e:{};},isMDXDM:function S(d){return E(d,this.getDatasets());},getIfDataSource:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.color");var A=mstrmojo.css,G=mstrmojo.dom,D;mstrmojo.qb.QBTableLinker=mstrmojo.declare(mstrmojo.Vis,null,{scriptClass:"mstrmojo.qb.QBTableLinker",width:null,height:0,context:0,markupString:'<div id="{@id}" class="mstrmojo-Chart {@cssClass}" style="position:absolute;left:0px;top:0px;width:{@width}px;height:{@height}px;overflow:hidden;"  mstrAttach:mouseover,mousemove,click ><canvas width="{@width}px" height="{@height}px"></canvas><canvas style="position:absolute;left:0;top:0" width="{@width}px" height="{@height}px"></canvas><div id="{@id}-tooltip" class="mstrmojo-Map-tooltip"></div></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;},highlightCanvas:function(){return this.domNode.childNodes[1];},tooltip:function(){return this.domNode.childNodes[2];}},postBuildRendering:function F(){if(this._super){this._super();}if(D===undefined){D=this.canvas&&this.canvas.getContext&&this.canvas.getContext("2d");}if(D){this.context=this.canvas.getContext("2d");this.highlight=this.highlightCanvas.getContext("2d");}else{this.createVMLCanvas();}this.model=mstrmojo.all.QBuilderModel;},getCordValue:function H(L){return CordValue;},drawLinks:function I(){this.clearCanvas();var R=mstrmojo.all.QBuilderModel;if(R.linkerNeedRender){this.render();R.linkerNeedRender=false;}var L=this.model&&this.model.joinsInfo;for(var Q in L){var Y=L[Q],N=Y.links;for(linkid in N){var U=N[linkid].srcw,O=N[linkid].tgtw,W=U.parent.parent,S=O.parent.parent,a=parseInt(W.leftAnchor()),P=parseInt(W.rightAnchor()),M=parseInt(S.leftAnchor()),Z=parseInt(S.rightAnchor()),e=W.containerNode.clientWidth,V=G.position(U.domNode),X=G.position(O.domNode),c=G.position(this.domNode),d=G.position(W.containerNode),b=G.position(S.containerNode);if(V.y>d.y&&V.y+0.5*V.h<d.y+d.h){srcwy=V.y-c.y+0.5*U.domNode.clientHeight;}else{srcwy=d.y-c.y-0.5*W.titleNode.clientHeight;}if(X.y>b.y&&X.y+0.5*X.h<b.y+b.h){tgtwy=X.y-c.y+0.5*O.domNode.clientHeight;}else{tgtwy=b.y-c.y-0.5*S.titleNode.clientHeight;}if(M>a+0.5*e){srcwx=P;srcwx1=srcwx+20;tgtwx=M;tgtwx1=tgtwx-20;}else{if(M>a&&M<a+0.5*e){srcwx=P;srcwx1=srcwx+20;tgtwx=Z;tgtwx1=tgtwx+20;}else{if(M<a&&Z>a+0.5*e){srcwx=a;srcwx1=srcwx-20;tgtwx=M;tgtwx1=tgtwx-20;}else{srcwx=a;srcwx1=srcwx-20;tgtwx=Z;tgtwx1=tgtwx+20;}}}N[linkid].marker=[{x:srcwx,y:srcwy},{x:srcwx1,y:srcwy},{x:tgtwx1,y:tgtwy},{x:tgtwx,y:tgtwy}];N[linkid].coords=[srcwx,srcwy+5,srcwx,srcwy-5,srcwx1,srcwy-5,tgtwx1,tgtwy-5,tgtwx,tgtwy-5,tgtwx,tgtwy+5,tgtwx1,tgtwy+5,srcwx1,srcwy+5];this.drawLine(srcwx,srcwy,srcwx1,srcwy);this.drawLine(srcwx1,srcwy,tgtwx1,tgtwy);this.drawLine(tgtwx1,tgtwy,tgtwx,tgtwy);switch(Y.jt){case"3":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;case"1":this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy+5);this.drawLine(srcwx,srcwy,0.5*(srcwx+srcwx1),srcwy-5);break;case"2":this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy-5);this.drawLine(tgtwx,tgtwy,0.5*(tgtwx+tgtwx1),tgtwy+5);break;default:break;}}}if(D){this.context.stroke();}this.drawMarker();},clearCanvas:function K(){if(D){this.context.clearRect(0,0,this.width,this.height);this.context.beginPath();}else{var L=document.getElementById("vmlCanvas");if(L&&L.hasChildNodes()){while(L.childNodes.length>=1){L.removeChild(L.firstChild);}this.createVMLCanvasFrame();}}},clearHighLightCanvas:function(){if(D){this.highlight.clearRect(0,0,this.width,this.height);this.highlight.beginPath();}},drawMarker:function(){if(D){this.clearHighLightCanvas();if(!this.model.selLink){return ;}var P=this.model,Q=P.joinsInfo[P.selLink[0]],O=!!Q?Q.links[P.selLink[1]].marker:[],M=this.highlight;for(var N=0,L=O.length;N<L;N++){M.strokeStyle="blue";M.beginPath();M.arc(O[N].x,O[N].y,3,0,Math.PI*2,true);M.closePath();M.stroke();}}},drawLine:function C(N,P,M,O){if(D){this.context=this.canvas.getContext("2d");this.context.moveTo(N,P);this.context.lineTo(M,O);}else{var L=document.createElement("v:line");L.setAttribute("from",N+" "+P);L.setAttribute("to",M+" "+O);document.getElementById("vmlCanvas").appendChild(L);}},createVMLCanvasFrame:function J(){var L=document.createElement("v:rect");L.setAttribute("id","vmlFrame");L.setAttribute("stroke","true");L.setAttribute("strokecolor","red");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.style.zindex="-1";document.getElementById("vmlCanvas").appendChild(L);},createVMLCanvas:function E(){var N=parseInt(this.width);var M=parseInt(this.height);var L=document.createElement("v:group");L.setAttribute("id","vmlCanvas");L.style.width=isNaN(this.width)?"auto":this.width;L.style.height=isNaN(this.height)?"auto":this.height;L.setAttribute("coordorigin","0, 0");L.setAttribute("coordsize",N+", "+M);this.domNode.appendChild(L);this.createVMLCanvasFrame();return ;},renderTooltip:function B(O,R,Q,S){var L=this.model.gts;if(S>=0){var N=L.row[0].n+": "+O;var M;for(M=0,len=L.col[0].es.length;L&&L.col&&M<len;M++){var U=this.model.gvs.items[S].items[M];var P=U.v;if(U.ty==4){P='<img src="'+P+'" >';}N+="<br>"+L.col[0].es[M].n+": "+P;}this.tooltip.innerHTML=N;}if(R+this.tooltip.offsetWidth>this.width){R=R-this.tooltip.offsetWidth;}this.tooltip.style.webkitTransform="translate3d("+R+"px, "+Q+"px, 0)";this.tooltip.style.MozTransform="translate("+R+"px, "+Q+"px)";if(this.tooltip.className.indexOf("fadeIn")<0){this.tooltip.className=this.tooltip.className+" fadeIn";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.qb.FilterValueEditor","mstrmojo.qb.QBTableLinker","mstrmojo.qb.ConditionEditor","mstrmojo.qb.DBTable","mstrmojo.ui.menus.Menu","mstrmojo.qb.DBTableRowMenu");mstrmojo.requiresDescs(221,520,521,522,523,524,525,526,612,629,686,687,688,696,746,1442,2122,2123,2125,2127,2131,2151,2219,2220,2784,2785,2786,4449,5893,8571,9126,9127,9128,9129,9640,9641,9913,9938,9939,9940,9941,12736,15479,14909,14949,14905);var Z=mstrmojo.dom,L=mstrmojo.array,K="addTable",Y="264px",a=30;var N=[0,"tick",16,"mix"];var H=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var F=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")}];var P=[{n:"=",dssid:"0"},{n:">",dssid:"1"},{n:">=",dssid:"2"},{n:"<",dssid:"3"},{n:"<=",dssid:"4"},{n:"<>",dssid:"5"}];var d=[{did:"-2",n:mstrmojo.desc(4449,"Expression")},{did:-1,n:"-"},{did:2219,n:mstrmojo.desc(2219,"In list")},{did:2220,n:mstrmojo.desc(2220,"Not in list")},{did:-1,n:"-"},{did:520,n:mstrmojo.desc(520,"Exactly")},{did:612,n:mstrmojo.desc(612,"Not Exactly")},{did:-1,n:"-"},{did:521,n:mstrmojo.desc(521,"Greater than")},{did:523,n:mstrmojo.desc(523,"Less than")},{did:522,n:mstrmojo.desc(522,"Greater than equal")},{did:524,n:mstrmojo.desc(524,"Less than equal")},{did:-1,n:"-"},{did:"-5",n:mstrmojo.desc(9939,"Strings"),fns:[{did:525,n:mstrmojo.desc(525,"Like")},{did:526,n:mstrmojo.desc(526,"Not like")},{did:686,n:mstrmojo.desc(686,"Contains")},{did:2784,n:mstrmojo.desc(2784,"Does not contain")},{did:687,n:mstrmojo.desc(687,"Begins with")},{did:2785,n:mstrmojo.desc(2785,"Does not begin with")},{did:688,n:mstrmojo.desc(688,"Ends with")},{did:2786,n:mstrmojo.desc(2786,"Does not end with")}]},{did:-1,n:"-"},{did:"Between",n:mstrmojo.desc(696,"Between")},{did:"Not between",n:mstrmojo.desc(746,"Not between")}];var b=[{did:"0",n:mstrmojo.desc(4449,"Expression")},{did:"1",n:mstrmojo.desc(9913,"Aggregation Function"),fns:[{did:"-6",n:mstrmojo.desc(2131,"Sum"),idx:1},{did:"-6",n:mstrmojo.desc(2122,"Average"),idx:2},{did:"-6",n:mstrmojo.desc(2127,"Minimum"),idx:3},{did:"-6",n:mstrmojo.desc(2125,"Maximum"),idx:4},{did:"-6",n:mstrmojo.desc(2123,"Count"),idx:5},{did:"-6",n:mstrmojo.desc(9938,"Count Distinct"),idx:6}]},{did:"2",n:mstrmojo.desc(2151,"Filter"),fns:d}];function U(k){return a*(k?(k+2):1);}function M(q){var l=mstrmojo.all.QBuilderModel,n,o=[],p;if(!q.srcData){n=l.gettIndex(q.id);for(var m=1,k=q.Rows.children.length;m<k;m++){p=q.Rows.children[m];if(p.visible){o.push(p);}}}else{o.push(q);n=l.gettIndex(q.parent.parent.id);}l.addSelectedColumns(o,n,null,{success:function(){var x=0,t=o.length,u;for(x;x<t;x++){u=o[x];u.updateState(1);u.count++;}}});}var B=0,J=1,j=3;function g(k,m,o){var p="mstr-qb-table-moreCM",n=mstrmojo.all[p];if(!n){n=new mstrmojo.MenuButton({id:p,cmCssClass:"mstrmojo-CXM",alias:"fctmenu",itemChildrenField:"fns",itemIdField:"did",itemField:"n",iconClass:"mstrmojo-qb-ListIcon div",cm:b,domSrc:m,obj:o,dynamicUpdate:true,getMenuPosition:function l(){var q=mstrmojo.dom.position(this.domSrc,true);return{x:Math.round(q.x),y:Math.round(q.y+q.h)};},executeCommand:function(AL){var AE=this.obj,z=mstrmojo.all.QBuilderModel,x=AE.parent.parent,AK=z.gettIndex(AE.srcID);switch(AL.did){case"0":mstrApp.getRootController().openExpressionEditor({type:B,w:AE,tkn:AE.expr});break;case"-2":mstrApp.getRootController().openExpressionEditor({n:mstrmojo.desc(5893,"New Condition"),w:AE,tkn:AE.expr,callbacks:{success:function AD(AO){var w=AO.mi;mstrApp.getRootController().addNewFilter({et:"*",expr:w.items,n:AO.expr,sqltp:w.exp.sqltp});}}});break;case"-6":var q=z.selectedClns,AH=q.length,AJ=new Array(),AA=AE.parent.children,AI=x.selectedIndex;AJ.push(AE);var AG={success:function(){var AQ=0,AO=AJ.length,AP;for(AQ;AQ<AO;AQ++){AP=AJ[AQ];if(AP.state==0||AP.state==2){AP.state++;AP.images[1]=AP.img[AP.state];AP.render();}AP.count++;}},failure:function(){}};z.addSelectedColumns(AJ,AK,AL.idx,AG);break;default:var u=this.obj,AF=u.dt.tp,AB={14:true,15:true,16:true},AM={30:true},AC,AN,t;switch(AL.did){case"Between":case"Not between":t=2;break;default:t=1;}AN="mstr-qb-fve";AC=mstrmojo.all[AN]||(new mstrmojo.qb.FilterValueEditor({id:AN}));AC.n=AL.n;AC.operatorID=AL.did;AC.column=u.oriexpr;AC.isDateTime=AB[AF];AC.isBigDecimal=AM[AF];AC.paraNum=t;AC.open();}}});n.render();}else{n.set("domSrc",m);n.set("obj",o);}n.showContextMenu();n.onContextMenuClose=function(){m.style.visibility="inherit";};}function e(l,m){var o={success:function(){var q,p;q=l.menuHelper;if(!q){q=l.menuHelper=new mstrmojo.qb.DBTableRowMenu();}q.tableRow=l;p=q.getMenuConfig();p.hostId=l.id;p.hostElement=l.domNode;if(m.position){p.position=m.position;}p.isHostedWithin=false;l.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:p}));}},k=mstrApp.getRootController();if(k.getFunctionList()){o.success();return ;}k.model.getFunctions(false,{success:function n(){o.success();}},{showWait:true});}function G(o,n,m){var k=mstrmojo.all.QBuilderModel,p=Z.position(m.domNode),u=o.clientX,q=o.clientY,t=k.getTouchValue(u-p.x,q-p.y),l=Z.position(m.domNode,true);if(t){k.selLink=t;n.drawMarker();f.call(this,o,t,n,{x:u+(l.x-p.x),y:q+(l.y-p.y)});}else{k.selLink=null;n.clearHighLightCanvas();}}var S={};function f(x,l,o,u){var m=mstrApp.diCurrentZIndex,n=m>999?m+1:999,t=this,w=t.joinMenuOption.mappingKey,k=t.joinMenuOption.menuItems,p=S[w];if(!p){p=S[w]=new mstrmojo.MenuButton({cmCssClass:"mstrmojo-CXM",cm:k,zIndex:n,itemChildrenField:"fns",itemIdField:"did",itemField:"n",dynamicUpdate:true,obj:l,pos:u,linker:o,getMenuPosition:function q(){return this.pos;},queryChecked:function(AB){switch(AB.did){case"Delete":case -1:case"More Options":return false;default:var z=mstrmojo.all.QBuilderModel;var AA=z.selLink[0];return(z.joinsInfo[AA].jt==AB.did);}},executeCommand:function(AD){var AE=this.linker;var AA=mstrmojo.all.QBuilderModel;var AC=this.obj,AB=AD.did;switch(AB){case"Delete":var z={success:function(){AA.selLink=null;AE.drawLinks();},failure:function(){}};AA.removeLink(AC[1],AC[0],z);break;case"0":case"1":case"2":case"3":AA.editJoin({joinID:AC[0],linkID:AC[1],type:AB});break;case"More Options":R.call(t,x,AC,AE);break;default:break;}}});}else{p.set("pos",u);p.set("obj",l);p.set("linker",o);}p.showContextMenu();}var V={};function R(w,t,n,q){var z=this.joinMenuOption.joinItems,u=this.joinMenuOption.mappingKey,o=V[u],m=this.joinMenuOption.joinOperators;if(!o){o=V[u]=new mstrmojo.Editor({slink:t,linker:n,cssClass:"mstrmojo-Join-Options",title:mstrmojo.desc(9127,"Join Options"),help:(mstrApp.helpTopics&&mstrApp.helpTopics.tableJoin)||"join_options_dialog_box.htm",zIndex:100,cssText:"width:350px;",children:[{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding: 5px;",text:mstrmojo.desc(9128,"Join")},{scriptClass:"mstrmojo.ui.CheckList",alias:"radiolist",multiSelect:false,itemCssClass:"mstrmojo-QB-radiolist-item",items:z},{scriptClass:"mstrmojo.Label",cssText:"font-weight:bold; width:100%; padding-left: 5px;",text:mstrmojo.desc(9129,"Join Operator")},{scriptClass:"mstrmojo.Label",cssText:"padding-left:5px;",bindings:{text:"this.parent.srcText"}},{scriptClass:"mstrmojo.HBox",alias:"jop",cssText:"position:relative;width:86px;",children:[{scriptClass:"mstrmojo.Pulldown",bindings:{cssClass:function(){return !!mstrApp.isWorkstation?"mstrmojo-QB-PullDown-item":"mstrmojo-Pulldown";}},items:m,popupToBody:true}]},{scriptClass:"mstrmojo.Label",cssText:"padding-left:5px;",bindings:{text:"this.parent.tgtText"}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(AA){var AH=this.parent.parent;var AB=mstrmojo.all.QBuilderModel,AF=AH.radiolist.selectedItem.did,AE=AH.slink[1],AC=AH.slink[0],AD=AH.jop.children[0].selectedItem,AG=AB.brackets(AH.srcText)+AD.n+AB.brackets(AH.tgtText);AB.editJoin({joinID:AC,linkID:AE,type:AF,exp:AG,op:AD.dssid});if(AH.onOK){AH.onOK();}AH.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(AA){var AB=this.parent.parent;if(AB.onCancel){AB.onCancel();}AB.close();}}]}]});}else{o.set("slink",t);o.set("linker",n);}var k=mstrmojo.all.QBuilderModel,x=k.joinsInfo[t[0]].links[t[1]],l=x.srcw.oriexpr,p=x.tgtw.oriexpr;o.set("srcText",l);o.set("tgtText",p);o.radiolist.set("selectedIndex",parseInt(k.joinsInfo[t[0]].jt));o.jop.children[0].set("value",x.op||"0");o.open();}function C(n,o,t,q,m){var k=mstrmojo.all.QBuilderModel;var AA=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"opacity:0.3;filter:alpha(opacity=30);left:0px;top:0px;width:180px;height:"+o+"px;",title:m,visible:false,noCheckBox:true});AA.container=n.parent;AA.selectedIndex=new Array();var w=k.gettIndex(AA.id);n.addChildren([AA]);AA.maxHeight=AA.editorNode.clientHeight;AA.maxWidth=Math.max(AA.Rows.domNode.clientWidth,AA.titlebarNode.clientWidth);if(AA.maxHeight>parseInt(Y)){AA.set("height",Y);}var l=t+"px",u=q+"px",AB=t+AA.editorNode.clientWidth,p=q+AA.editorNode.clientHeight,z=AA.editorNode.style;z.left=l;z.top=u;z.width=AA.titlebarNode.clientWidth+"px";AA.left=l;AA.top=u;return AA;}function E(o){var n,m,l=0,q,p=10,k;L.forEach(o,function(t){k=mstrmojo.all[t];m=parseInt(k.left)+parseInt(k.editorNode.style.width);if(m>l){l=m;n=k;}});q=Math.ceil(l/200)*200+10;return{left:q,top:p};}function Q(AA,AS){var AP=AS.h,z=AS.w,u=AS.x,t=AS.y,m=AS.tbn,AQ=AS.did,AB=AS.dbtbn,AC=AS.ns,AM=AS.readOnly,o=mstrmojo.all.QBuilderModel,AU;var AD=U(AA.length);AU=E(o.dbtables);u=AU.left;t=AU.top;var AG=new mstrmojo.qb.DBTable({scriptClass:"mstrmojo.qb.DBTable",cssText:"position:absolute;left:0px;top:0px;width:"+(z?z:180)+"px;height:"+AD+"px;",left:u+"px",top:t+"px",readOnly:AM,title:m,visible:true,readOnly:AM,noCheckBox:true,onClose:function(){var x=this;var w={success:function(){x.parent.parent.linker.drawLinks();},failure:function(){}};o.removeTable(this,w);},onRender:function(){if(AM&&this.closeNode){this.closeNode.title=mstrmojo.desc(15479,"Cannot delete this table since it is being used by the dossier");mstrmojo.css.addClass(this.closeNode,"readonly");}}});if(this.parent.parent.fromAggregation){AG.ondblclick=function(){};}o.upttIndex(m,AB,AG.id,true,AQ,AC);o.raiseEvent({name:"refreshTables",items:o.dbtables.slice(0)});if(AQ){o.uiids[AQ]=AG.id;}AG.model=o;AG.container=this.parent;AG.selectedIndex=new Array();var AR=o.gettIndex(AG.id);var p,q,AF,AL,AO=AA.length,AK;if(AO){AK='* <span class = "all"> '+mstrmojo.desc(12736,"Add all columns")+"</span>";AG.addRow("* "+mstrmojo.desc(12736,"Add all columns"),0,["0","0"],"",AK);p=AG.Rows.children[0];p.draggable=false;p.dropZone=false;p.allowDrop=false;p.rIndex=-1;p.table=AG;p.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(AG);}};p.oncontextmenu=function AN(w){Z.preventDefault(window,w.e);};}for(AL=0;AL<AO;AL++){q=AA[AL].cln;AF=AA[AL].state?["0",N[AA[AL].state]]:["0","0"];AG.addRow(AA[AL].cln,0,AF,"");AG.selectedIndex[AL]=false;p=AG.Rows.children[AL+1];p.cssClass=(AL%2)?"odd":"even";p.srcTable=m;p.srcID=AG.id;p.srcData=AA[AL];p.oriexpr=AA[AL].exp?AA[AL].exp:(m+"."+AA[AL].cln);p.expr=[{isNew:true,v:o.brackets(p.oriexpr),oi:{tIndex:AR,rIndex:AL+1,t:"26",n:p.oriexpr}}];p.img=N;p.enableExpr=!AA[AL].hideExpr;p.state=!AA[AL].state?0:AA[AL].state;o.tables[AG.id].rows[p.id]=p;p.rIndex=AL;p.count=!AA[AL].count?0:AA[AL].count;p.dt=AA[AL].dt;p.updateState=function(x){if(this.count<=0){this.state=this.state&2;}this.state=this.state|x;var w=(this.state&1)+(this.state&2);this.images[1]=this.img[w];this.render();};p.ondblclick=function(w){if(mstrmojo.dom.eventTarget(w.hWin,w.e).className.indexOf("add")<0){M(this);}};p.oncontextmenu=function AN(w){Z.preventDefault(window,w.e);e(this,{position:Z.getMousePosition(w.e,window)});};if(AQ){o.uiids[AQ+AA[AL].did]=p.id;}}this.addChildren([AG]);AG.maxHeight=AD;var AV=AG.Rows.domNode.clientWidth;mstrmojo.array.forEach(AG.Rows.domNode.children,function(w){AV=Math.max(AV,w.firstChild.children[1].clientWidth+30);});AG.maxWidth=Math.max(AV,AG.titlebarNode.clientWidth);if(AP<AD){AG.set("height",AP+"px");}var AT=u+"px",AI=t+"px",AJ=u+AG.editorNode.clientWidth,l=t+AG.editorNode.clientHeight+10,AH=AG.editorNode.style,k=this.parent,n=this.domNode.style,AE=k.linker;AG.titlebarNode.style.width=parseInt(AH.width,10)-56+"px";AG.titleNode.style.width=AG.titlebarNode.style.width;AP=parseInt(k.domNode.clientHeight);z=parseInt(k.domNode.clientWidth);if(z<AJ&&k.maxWidth<AJ){k.maxWidth=AJ;k.canvasbox.set("width",k.maxWidth+"px");k.linker.set("width",k.maxWidth+"px");o.linkerNeedRender=true;}if(AP<l&&k.maxHeight<l){k.maxHeight=l;k.canvasbox.set("height",k.maxHeight+"px");k.linker.set("height",k.maxHeight+"px");o.linkerNeedRender=true;}k.domNode.style["overflow-x"]=(k.maxWidth>z)?"auto":"hidden";k.domNode.style["overflow-y"]=(k.maxHeight>AP)?"auto":"hidden";return AG;}mstrmojo.qb.QBTableView=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBTableView",joinMenuOption:{menuItems:H,joinItems:F,mappingKey:"database",joinOperators:P},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},init:function X(m){this._super(m);var p={},l=p[this.id]={},o=this;l.joinChanged=l.JoinsLoaded=l.JoinsAdded=function k(){o.scrollBox.linker.drawLinks();};l.BindingTableLoaded=function n(q){o.scrollBox.canvasbox.displayBindingTable(q);};l.refreshTables=o.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(p);},onTableRefresh:function W(k){var l=k.items.length>0;var m=this.scrollBox;mstrmojo.css.toggleClass(m.hintbox.domNode,["off"],l);mstrmojo.css.toggleClass(m.domNode,["active"],l);if(!l){mstrApp.getRootController().toggleDataPreview(false);}},children:[{scriptClass:"mstrmojo.Box",alias:"scrollBox",cssClass:"mstrmojo-qb-tableview-box",maxWidth:0,maxHeight:0,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',onmouseover:function(){var k=parseInt(this.domNode.clientHeight),m=parseInt(this.domNode.clientWidth),l=this.domNode.style;if(m<this.maxWidth){l.overflowX="auto";}else{l.overflowX="hidden";this.domNode.scrollLeft=0;}if(k<this.maxHeight){l.overflowY="auto";}else{l.overflowY="hidden";this.domNode.scrollTop=0;}},onmouseout:function(){this.domNode.style.overflow="hidden";},children:[{scriptClass:"mstrmojo.Box",alias:"hintbox",markupString:'<div class="mstrmojo-qb-EmptyHint">{@emptyHint}</div>',cssDisplay:"",emptyHint:mstrmojo.desc(14909,"Drag and Drop to Add Tables")},{scriptClass:"mstrmojo.qb.QBTableLinker",alias:"linker",cssClass:"mstrmojo-qb-tableview-linker",dropZone:true,allowDrop:function D(k){return(k.action===K);},ondrop:function c(k){this.parent.canvasbox.ondrop(k);mstrmojo.css.removeClass(this.domNode,"dragging");},ondragenter:function O(k){this.parent.canvasbox.ondragenter(k);mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function O(k){this.parent.canvasbox.ondragleave(k);mstrmojo.css.removeClass(this.domNode,"dragging");},onclick:function h(l){var k=this.parent.parent;G.call(k,l.e,this,this);}},{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousemove> </div>',cssClass:"mstrmojo-qb-tableview-canvas",alias:"canvasbox",dropZone:true,allowDrop:function D(k){return(k.action===K);},onclick:function h(l){var k=this.parent.parent;G.call(k,l.e,this.parent.linker,this);},displayBindingTable:function(w){var x=w.value,l=0,p=20,u=20,z=0,k=0,q,AB,m=0;for(var n=0,o=x.length;n<o;n++){AB=x[n];q=AB.pos;if(q){u=q.t;l=q.l;z=q.h;k=q.w;}else{z=U(AB.cs.length);l+=m+p;}AB.h=z>parseInt(Y)?parseInt(Y):z;AB.w=k;AB.x=l;AB.y=u;var AA=Q.call(this,AB.cs,AB);m=AA.editorNode.clientWidth;}},updateTableName:function(p){var o=p.tid;if(o&&mstrmojo.all[o]){var m=mstrmojo.all.QBuilderModel,n=mstrmojo.all[o],l=n.Rows.children,q,k=p.value;mstrmojo.array.forEach(l,function(u,t){if(t>0){u.oriexpr=k+"."+u.srcData.cln;u.expr[0].v=m.brackets(u.oriexpr);u.expr[0].n=u.oriexpr;m.tables[o].rows[u.id]=u;}});}},postCreate:function(){var k=mstrmojo.all.QBuilderModel;if(!k){return ;}k.attachEventListener("TableAdded",this.id,"drawTable");k.attachEventListener("TableNameChanged",this.id,"updateTableName");},ondrop:function c(k){var t=k.action,n=k.src;if(n&&n.data){var o=n.data;if(t===K){var m=k.tgt.pos,p=mstrmojo.dom.position(k.tgt.node),u=m.x-p.x;y=m.y-p.y;var l=n.widget.dataHelper,q=0;mstrmojo.array.forEach(o,function(x){l.fetch(x,{success:function w(z){x.x=u+q*15;x.y=y+q*15;q++;mstrApp.getRootController().addTable(x,z.items);}});});}}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},getAvatarIconClass:function I(k){return"enabled";},ondragenter:function O(k){var l=k.src.widget;if(l&&l.toggleAvatarClass&&this.allowDrop(k)){l.toggleAvatarClass(this.getAvatarIconClass(k),true);}mstrmojo.css.addClass(this.parent.domNode,"dragging");},ondragleave:function A(k){var l=k.src.widget;if(l&&l.toggleAvatarClass&&this.allowDrop(k)){l.toggleAvatarClass(this.getAvatarIconClass(k),false);}mstrmojo.css.removeClass(this.parent.domNode,"dragging");},drawTable:function(k){var n=k.data,m=k.table,l=U(n.length);l=(l>parseInt(Y,10))?parseInt(Y,10):l;m.h=l;m.w=null;Q.call(this,n,m);}}]}],onheightChange:function(m){var l=parseInt(m.value)-3;this.scrollBox.set("height",l+"px");var k=this.scrollBox.canvasbox;if((!k.height)||(k.domNode&&l>k.domNode.clientHeight)){k.set("height",l+"px");this.scrollBox.linker.set("height",l);}if(this.scrollBox.domNode){this.scrollBox.hintbox.domNode.style.lineHeight=l+100+"px";this.scrollBox.domNode.style.height=this.scrollBox.height;if(parseInt(this.scrollBox.height)<this.scrollBox.maxHeight){this.scrollBox.linker.set("height",parseInt(this.scrollBox.maxHeight));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.height=parseInt(this.scrollBox.maxHeight)+"px";}else{this.scrollBox.linker.set("height",l);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();k.domNode.style.height=l+"px";k.height=k.domNode.style.height;}}},onwidthChange:function(m){var k=parseInt(m.value)-2;this.scrollBox.set("width",k+"px");var l=this.scrollBox.canvasbox;if((!l.width)||(l.domNode&&k>l.domNode.clientWidth)){l.set("width",k+"px");this.scrollBox.linker.set("width",k);}if(this.scrollBox.domNode){this.scrollBox.domNode.style.width=this.scrollBox.width;if(parseInt(this.scrollBox.width)<this.scrollBox.maxWidth){this.scrollBox.linker.set("width",parseInt(this.scrollBox.maxWidth));this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();this.scrollBox.canvasbox.domNode.style.width=parseInt(this.scrollBox.maxWidth)+"px";}else{this.scrollBox.linker.set("width",k);this.scrollBox.linker.render();this.scrollBox.linker.drawLinks();l.domNode.style.width=k+"px";l.width=l.domNode.style.width;}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.mstr.EnumNodeDimty","mstrmojo.vi.ui.ConditionWalk","mstrmojo.fe.FilterUtils","mstrmojo.expr");mstrmojo.requiresDescs(15540);var I=mstrmojo.array,M=mstrmojo.hash,R=mstrmojo.Button.newWebButton,G=mstrmojo.mstr.EnumNodeDimty,P=I.hash([G.NodeDimtyUnspecified,G.NodeDimtyNone]),B=mstrmojo.fe.FilterUtils,J=mstrmojo.expr,Q=J.ET;mstrmojo.vi.ui.ConditionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.ConditionEditor",cssClass:"mstrmojo-vi-ui-ConditionEditor",help:"Creating_a_Metric_Qualification.htm",title:mstrmojo.desc(15540,"Edit Qualification"),objectBrowsingEnabled:false,targets:null,targetsLastMod:null,ets:null,condition:null,model:null,hasPrompt:false,disableElementsBrowsing:null,inRelation:null,editor:null,children:[{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',cssDisplay:"inline-block",cssClass:"conditionBar",model:null,alias:"conditionBar",bindings:{model:"this.parent.model"},update:function(){var E=this.model,U=B.getExprNodeHtmlAndText(E.data?E.data:E,{emptyText:mstrmojo.desc(15413,"Qualification Details"),elemsEmpty:" "});if(this.containerNode){this.containerNode.innerHTML=U.html;this.containerNode.title=U.text;}}},{scriptClass:"mstrmojo.vi.ui.ConditionWalk",alias:"walk",dimtyTypes:P,delegateUpdateOkBtn:function D(V){var E=this.parent,W=E&&E.btnHbox,U=W&&W.okBtn;if(U){U.set("enabled",!!V);}},onOK:function O(){var U=this.condition,E=this.editor;E.onConditionEdit(U,this.model.get());},close:function L(){var E=this.condition;if(E&&E.isEmpty()){E.del();}},postmodeledit:function H(E){this.parent.updateConditionBar();},getIfDataSource:function S(){return this.parent.getIfDataSource();},onUpdateBrowseElementsParams:function N(E){this.parent.onUpdateBrowseElementsParams(E);},getDatasets:function F(){return this.parent.getDatasets();}}],buttons:[R(mstrmojo.desc(1442,"OK"),function(){var E=this.parent.parent;E.walk.onOK();E.close();},true,{enabled:true,alias:"okBtn"}),R(mstrmojo.desc(221,"Cancel"),function(){var E=this.parent.parent;E.close();})],updateConditionBar:function A(){this.conditionBar.update();},open:function K(V,E){this._super(V,E);var U={objectBrowsingEnabled:this.objectBrowsingEnabled,targets:this.targets,targetsLastMod:this.targetsLastMod,ets:this.ets,condition:this.condition,hasPrompt:this.hasPrompt,disableElementsBrowsing:this.disableElementsBrowsing,disableHierarchyLevel:this.disableHierarchyLevel,inRelation:this.inRelation,editor:this.editor};M.copy(U,this.walk);if(!(this.disableElementsBrowsing&&this.disableElementsBrowsing())){this.model.defaultETAttr=Q.AE;}this.walk.set("model",this.model);this.updateConditionBar();},onClose:function C(){this.walk.close();},getDatasets:mstrmojo.emptyFn,getIfDataSource:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.Label","mstrmojo.DataGrid","mstrmojo.Table","mstrmojo.HBox","mstrmojo.form","mstrmojo.MenuButton","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIExitOptions","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.DI.ui.dialogs.DIPermissionDialog","mstrmojo.locales","mstrmojo.date","mstrmojo.css","mstrmojo.DI.DIHelpers","mstrmojo.expr");mstrmojo.requiresDescs(60,172,239,767,1085,1088,1279,3610,7559,9099,9101,9242,10216,10380,12855,13042,13043,13044,13045,13046,13047,13127,9252,13241,773,8733,1388,14055,14056,14452,14453,14454);var L=mstrmojo.array,S=mstrmojo.css,F=mstrmojo.DI.DIHelpers,K=mstrmojo.DI.DIExitOptions,E=mstrmojo.dom,B=mstrmojo.string,M=mstrmojo.expr,P=M.STP,V=mstrmojo.DI.DIConstants;var J="highlight",N={TYPE:"type",NAME:"n",SIZE:"sz",DATE:"dt",SCHEDULE:"sched"};function H(Y){var X=Y.canEdit,f,Z={};L.forEach(Y.mapping.datap,function j(n){L.forEach(n.maps&&n.maps.amps,function m(o){f=o.aimp.atid;L.forEach(o.afmps,function p(q){Z[f+q.fmid]=q.bft;});});});Y=Y.oi.gsfsr;var g=[].concat(Y.mi["in"].oi),e=g[0],b={ab:e.ab,acg:e.acg,desc:e.des,did:e.did,n:e.n,own:e.ow.content,st:e.stp,t:e.tp},d=[],c=[].concat(Y.mi.acl.ace),a,k,l,W;b.canEdit=X;if(!Y.mi.acl||Y.u===undefined){b.acls=[];return b;}W=[].concat(Y.u);L.forEach(c,function h(m){a=g[L.find(g,"id",m.trustee)];l={den:!!m.deny,did:a.did,inh:!!m.inheritable,n:a.n,rgt:m.rights,st:a.stp};k=W[L.find(W,"uid",a.did)];if(k.mi){l.partial=k.partial_type;l.fg=k.partial_type||3;l.filter=mstrmojo.DI.ui.dialogs.DIPermissionDialog.buildWalk(k.mi.exp.nd,[].concat(k.mi["in"].oi),Z);l.filterText=k.mi.exp.content;}else{l.filter="";l.filterText="";l.fg=1;}d.push(l);});b.acls=d;b.formTypes=Z;return b;}function G(Y){if(mstrApp.refreshMultipleCubes){if(Y.ddam===V.datasetServeMode.dda){return ;}var X=Y.st;if(X===P.REPORT_EMMACUBE||X===P.REPORT_GRID||X===P.REPORT_GRAPH||X===P.REPORT_GRIDGRAPH){var W={ReportId:Y.cube_id,CubeName:Y.cname,StatusCode:V.statusCode.republish};mstrApp.getRootController().getDialogController().show(V.dialogType.diPageDialog,{pageType:V.pageType.republish,diParams:W});}else{if(X===P.REPORT_CUBE){mstrApp.getRootController().publishNonEmmaCube(Y.cube_id);}}}else{if(Y.type==="Managed"){mstrApp.redirectToPage(K.getRedirectParams(K.pageRedirect.existingAnalysis,null,false,Y.docid));}else{mstrApp.redirectToPage(K.getRedirectParams(K.pageRedirect.analysis,Y.cube_id,Y.type==="Live"));}}}mstrmojo.DI.CubeListCubeMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.CubeListCubeMenu",menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-cubeListCubeMenu",data:null,cubeID:null,cubeName:null,subs:null,handleRepublish:function(W){mstrApp.fromCubesList=true;mstrApp.getRootController().resetAppforRepublish(W.ctxt);},handleEdit:function(X){var W=X.ctxt;mstrApp.getRootController().closeDialog(V.dialogType.cubesList);mstrApp.restart({ReportId:W.cubeID,CubeName:W.cubeName,StatusCode:V.statusCode.edit,AnalysisId:undefined,datasets:null});},handleEditSparkDataset:function(a){var W=a.ctxt;mstrApp.getRootController().closeDialog(V.dialogType.cubesList);var d=microstrategy.servletName,b={evt:"3199",src:d+".3199",cubeID:W.cubeID};var Y,c=[],Z=d+"?";for(Y in b){if(b.hasOwnProperty(Y)){c.push(Y+"="+b[Y]);}}Z+=c.join("&");var X=createDynamicForm(Z);submitForm(X);},handleShare:function(Z){var W=Z.ctxt,Y=W.cubeID,a=[],d="mstrACL",X=function(f){var e=mstrmojo.all[d];if(!e){e=new mstrmojo.DI.ui.dialogs.DIPermissionDialog({id:d,oi:f,cubeid:Y,candidates:a});}else{e.set("oi",f);e.cubeid=Y;e.candidates=a;}e.formTypes=f.formTypes;e.open(null,{zIndex:mstrApp.getRootController().getDialogController().getNextZIndex()});};var c=mstrApp.getRootController().getDataService();c.getSecurityFilter({success:function b(f){var g;L.forEach(f.mapping.datap,function e(j){L.forEach(j.maps&&j.maps.amps,function h(k){g=k.aimp;if(L.find(a,"did",g.atid)===-1){a.push({n:g.atnm,did:g.atid,t:12});}});});if(a.length===0){f.canEdit=0;}X(H(f));}},{cubeid:Y,isNew:true});},handleDelete:function(X){var a={objectID:X.ctxt.cubeID,objectType:3};var W=mstrApp.getRootController();var Z=mstrmojo.desc(13127,"Are you sure you want to delete the intelligent cube, ##?").replace("##",this.ctxt.cubeName);var b={success:function(){a={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};W.getCubeQuota({success:function(){W.getCubeQuota({success:function(){W.scheduleController.updateScheduleAndStatus();}},a);}},a);},failure:function(c){W.displayError(c.message||c.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var Y=function(){W.deleteObject(b,a);};W.displayWarning(Z,mstrmojo.desc(3610,"Microstrategy Web"),Y);},handleRename:function(W){W.ctxt.nameWidget.set("editMode",true);},handleShowInFolder:function(X){var W=mstrApp.getRootController();var Y={success:function(a){if(a&&a.items&&a.items.length===1){var Z=a.items[0].fid;mstrApp.redirectToPage({evt:"2001",folderID:Z});}},failure:function(Z){W.displayError(mstrmojo.desc(14056,"Error when getting the cube's folder id."),false,Z.message);}};W.dataService.getObjectFolder(Y,{dids:X.ctxt.cubeID,types:3});},handleRepublish2:function(Y){var W=Y.ctxt;var X={ReportId:W.cubeID,CubeName:W.cubeName,StatusCode:V.statusCode.republish,isSparkCube:W.isSparkCube};mstrApp.getRootController().getDialogController().show(V.dialogType.diPageDialog,{pageType:V.pageType.republish,diParams:X});return true;},handleAddSchedule:function(Y){var W=Y.ctxt;var X={ReportId:W.cubeID,CubeName:W.cubeName,StatusCode:V.statusCode.schedule};mstrApp.getRootController().getDialogController().show(V.dialogType.diPageDialog,{pageType:V.pageType.schedule,diParams:X});return true;},handleEditSubscription:function(Y){var W=Y.ctxt;var X={ReportId:W.contentID,CubeName:W.contentName,SubsId:W.did,SubsName:W.subsName,StatusCode:V.statusCode.schedule};mstrApp.getRootController().getDialogController().show(V.dialogType.diPageDialog,{pageType:V.pageType.schedule,diParams:X});return true;},handleDeleteSubscription:function(Y){var X=Y.ctxt.did;var W={success:function(){mstrApp.getRootController().getScheduleController().updateScheduleAndStatus();},failure:function(Z){mstrApp.getRootController().displayError(mstrmojo.desc(12855,"Cannot remove this subscription."),false,Z.message);}};mstrApp.getRootController().getScheduleController().removeSubscription([X],W);return true;},handleRefreshHistory:function(X){var W=X.ctxt.did;mstrApp.getRootController().getScheduleController().getScheduleStatus([W],{complete:function(){mstrApp.getRootController().getScheduleController().showScheduleStatusDialog(W);}});return true;},handleCreate:function(W){mstrApp.redirectToPage(K.getRedirectParams(W.ctxt.did,W.ctxt.cubeID,W.ctxt.isDDA));},getSubsMenuConfig:function(W){var Y=this,X=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu subscriptionMenu"});if(mstrApp.diParams.canSubscribe){X.addMenuItem(mstrmojo.desc(767,"Modify"),"",Y.handleEditSubscription,W);X.addMenuItem(mstrmojo.desc(9252,"Delete"),"",Y.handleDeleteSubscription,W);}else{X.addDisabledMenuItem(mstrmojo.desc(767,"Modify"),"");X.addDisabledMenuItem(mstrmojo.desc(9252,"Delete"),"");}X.addMenuItem(mstrmojo.desc(10216,"Refresh History"),"",Y.handleRefreshHistory,W);return X;},getCreateMenuConfig:function(){var X=this,W=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});W.addMenuItem(mstrmojo.desc(14825,"Create Dossier"),"dossier",X.handleCreate,{did:K.pageRedirect.analysis,cubeID:X.cubeID,isDDA:false});W.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",X.handleCreate,{did:K.pageRedirect.doc,cubeID:X.cubeID,isDDA:false});W.addMenuItem(mstrmojo.desc(5,"Create Report"),"report",X.handleCreate,{did:K.pageRedirect.report,cubeID:X.cubeID,isDDA:false});return W;},getCreateMenuConfigDDA:function(){var X=this,W=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});W.addMenuItem(mstrmojo.desc(14825,"Create Dossier"),"dossier",X.handleCreate,{did:K.pageRedirect.analysis,cubeID:X.cubeID,isDDA:true});W.addMenuItem(mstrmojo.desc(2918,"Create Document"),"document",X.handleCreate,{did:K.pageRedirect.doc,cubeID:X.cubeID,isDDA:true});return W;},getScheduleMenuConfig:function(){var X=this,W=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu mstrmojo-di-scheduleMenu"});if(mstrApp.diParams.canSubscribe){W.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",X.handleAddSchedule,{cubeID:X.cubeID,cubeName:X.cubeName});}else{W.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}if(X.subs&&X.subs.length>0){W.addSeparator();L.forEach(X.subs,function(Z){var b="",Y="subscription ",c=Z.status&&Z.status.length>0&&Z.status[Z.status.length-1],a;if(c){if(c.en===0){Y+="success";}else{Y+="fail";a=c.emsg;}}else{Y+="empty";}if(Z.subsName.indexOf(Z.contentName)===0){b="..."+Z.subsName.substr(Z.contentName.length);}else{b=Z.subsName;}if(b.length>50){b=b.substr(0,50);}W.addSubMenuItem(b,Y,X.id,X.getSubsMenuConfig,Z);});}return W;},getMenuConfig:function(){var Y=this,W,X,Z=Y.data&&Y.data.xt===V.xdaType.sparkDataset;W=new mstrmojo.ui.menus.MenuConfig({menuCssClass:Y.menuCssClass});if(mstrApp.refreshMultipleCubes){X=Y.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");W.addMenuItem(X,"republish",Y.handleRepublish2,{cubeID:Y.cubeID,cubeName:Y.cubeName});}else{if(Y.data.type!=="Managed"){if(Y.data.ddam===V.datasetServeMode.dda){W.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",Y.id,Y.getCreateMenuConfigDDA);}else{W.addSubMenuItem(mstrmojo.desc(3291,"Create"),"create",Y.id,Y.getCreateMenuConfig);}}X=Y.data.sz?mstrmojo.desc(9242,"Republish"):mstrmojo.desc(172,"Publish");W.addMenuItem(X,"republish",Y.handleRepublish2,{cubeID:Y.cubeID,cubeName:Y.cubeName,isSparkCube:Z});var a=Z?Y.handleEditSparkDataset:Y.handleEdit;if(Y.data.type!=="Managed"){W.addMenuItem(mstrmojo.desc(1088,"Edit"),"edit",a,{cubeID:Y.cubeID,cubeName:Y.cubeName});}if(!Z&&(Y.data.ddam!==V.datasetServeMode.dda)){if(Y.subs&&Y.subs.length>0){W.addSubMenuItem(mstrmojo.desc(1085,"Schedule"),"schedule",Y.id,Y.getScheduleMenuConfig);}else{if(mstrApp.diParams.canSubscribe){W.addMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add",Y.handleAddSchedule,{cubeID:Y.cubeID,cubeName:Y.cubeName});}else{W.addDisabledMenuItem(mstrmojo.desc(13043,"Add Schedule"),"add");}}}if(Y.data.type!=="Managed"){W.addMenuItem(mstrmojo.desc(9099,"Share"),"share",Y.handleShare,{cubeID:Y.cubeID,cubeName:Y.cubeName});W.addMenuItem(mstrmojo.desc(9252,"Delete"),"delete",Y.handleDelete,{cubeID:Y.cubeID,cubeName:Y.cubeName});W.addMenuItem(mstrmojo.desc(1388,"Rename"),"rename",Y.handleRename,{nameWidget:Y.opener.parent.children[0]});W.addMenuItem(mstrmojo.desc(14055,"Show in folder"),"show",Y.handleShowInFolder,{cubeID:Y.cubeID});}}return W;}});function D(X,Y){var W=X.menuHelper,Z;if(!X.openPopup){X.openPopup=function(b,a){mstrmojo._HasPopup.openPopup.call(X,b,a);};}if(!X.closePopup){X.closePopup=function(){mstrmojo._HasPopup.closePopup.call(X);};}if(!W){W=new mstrmojo.DI.CubeListCubeMenu();X.menuHelper=W;}W=X.menuHelper;W.data=Y;W.cubeID=Y.cube_id;W.cubeName=Y.cname;W.subs=Y.subs;W.opener=X;Z=W.getMenuConfig();Z.hostId=X.id;Z.hostElement=X.domNode;Z.position=E.position(X.domNode,true);Z.isHostedWithin=false;Z.zIndex=mstrApp.getRootController().getDialogController().getNextZIndex();X.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:Z}));}function U(W,Y){var X=null;switch(W){case N.TYPE:X=function(d,Z){var c=d.cname===undefined?"":d.cname,g=Z.cname===undefined?"":Z.cname,e=d.type===undefined?"":d.type,f=Z.type===undefined?"":Z.type;if(e.toString().toLowerCase()<f.toString().toLowerCase()){return Y;}else{if(e.toString().toLowerCase()===f.toString().toLowerCase()){if(c.toString().toLowerCase()<g.toString().toLowerCase()){return -1;}else{return 1;}}else{return(-Y);}}};break;case N.NAME:X=function(c,Z){var d=c.cname===undefined?"":c.cname,e=Z.cname===undefined?"":Z.cname;return(d.toString().toLowerCase()<e.toString().toLowerCase())?Y:(-Y);};break;case N.SIZE:X=function(c,Z){return(parseInt(c.sz||0,10)<parseInt(Z.sz||0,10))?Y:(-Y);};break;case N.DATE:X=function(c,Z){var e=c.mdt||c.nutm||c.utm||"",d=Z.mdt||Z.nutm||Z.utm||"";e=e.replace(/-/g,"/");d=d.replace(/-/g,"/");return(new Date(e).getTime()<(new Date(d).getTime()))?Y:(-Y);};break;case N.SCHEDULE:X=function(c,Z){return c.schedStatus>Z.schedStatus?Y:(-Y);};break;}return X;}function C(W,Z){var Y=[],a,X;if(!Z){return W;}for(X=0;W&&X<W.length;X++){a=W[X].cname===undefined?"":W[X].cname.toString().toUpperCase();if(a.indexOf(Z.toUpperCase())>-1){Y.push(W[X]);}}return Y;}mstrmojo.DI.DICubesList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DICubesList",markupString:'<div class="mstrmojo-di-cubes cf"><div></div><div></div></div>',markupSlots:{subTitleNode:function(){return this.domNode.children[0];},cubesNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},searchPattern:"",items:null,setDimensions:function O(Z,X){var W=parseInt(Z,10);var Y=parseInt(X,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.cubesNode=(W-10)+"px";this.layoutConfig.w.cubesNode=Y+"px";if(this._super){this._super(W+"px",X);}},preBuildRendering:function A(){if(this._super){this._super();}this.update();},postBuildRendering:function(){if(this._super){this._super();}var W=mstrApp.getRootController().getModel();W.attachEventListener("cubesInfoChange",this.id,"update");W.attachEventListener("subsInfoChange",this.id,"update");W.attachEventListener("subsStatusChange",this.id,"update");},populateACLItems:function(W){return H(W);},update:function(){var Y=mstrApp.getRootController().getModel(),Z,c=this.cubesList.curSortBy,W=null,a,d=0;if(Y.cubesInfo){Z=Y.cubesInfo;}if(this.cubesList.scrollNode){W=this.cubesList.scrollNode.scrollTop;}var X=Z.cubes&&Z.cubes.cube?[].concat(Z.cubes&&Z.cubes.cube):[];L.forEach(X,function(e){if(e.ddam===V.datasetServeMode.dda){e.type=mstrmojo.desc(14452,"Live");}else{e.type=mstrmojo.desc(11921,"In-Memory");d++;}});var b=Z.cubes&&Z.cubes.doc?[].concat(Z.cubes&&Z.cubes.doc):[];L.forEach(b,function(f){var e=f.cube?[].concat(f.cube):[];L.forEach(e,function(g){g.docn=f.docn;g.docid=f.id;g.docp=f.objp;g.type=mstrmojo.desc(14454,"Managed");X.push(g);});});if(c&&c.k){a=U(c.k,c.v);if(a){X=X.sort(a);}}this.set("items",X);this.cubesList.set("items",C(X,this.searchPattern));if(W!==null){this.cubesList.scrollNode.scrollTop=W;}if(!X||X.length===0||(d===0&&mstrApp.refreshMultipleCubes)){this.appendDDACubeToPublishedDataSets(X);Y.raiseEvent({name:"cubesFinishPublishing"});}},appendDDACubeToPublishedDataSets:function(Y){var X=mstrApp.getRootController().getModel(),W=X.publishedDatasets;L.forEach(Y,function(Z){if(Z.ddam===V.datasetServeMode.dda){W.push({did:Z.cube_id,isDDA:true});}});},onsearchPatternChange:function(){var W=this.items,X=this.searchPattern,Y;Y=C(W,X);this.cubesList.set("items",Y);},children:[{scriptClass:"mstrmojo.Box",slot:"subTitleNode",cssClass:"mstrmojo-di-cubes-subTitleBox cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-cubes-subTitle",postBuildRendering:function(){var W=mstrApp.getRootController().getModel();if(this._super){this._super();}this.update();W.attachEventListener("cubesInfoChange",this.id,"update");},update:function(){var Z=mstrApp.getRootController().model.cubesInfo,a,W,X;if(Z===undefined||!Z.cubes){return ;}var b=Z.cubes.cusage,Y=0;if(b<1){Y=2;}else{if(b<10){Y=1;}}if(b!==undefined){b=Number(b.toFixed(Y));if(Z.cubes.cquota===-1){W=mstrmojo.desc(12693,"##### MB used. You have unlimited storage!").replace("#####",Math.round(b*100)/100);}else{a=Z.cubes.cquota;X=Math.round(b/a*10000)/100;W=mstrmojo.desc(15111,"You are currently using ## MB (###) out of #### MB in allocated quota space.");W=W.replace("####",a).replace("###",X+"%").replace("##",b);}this.set("text",W);}if(mstrApp.refreshMultipleCubes){this.set("text",mstrmojo.desc(14192,"Please republish the following datasets by clicking on them."));}}},{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"mstrmojo-di-cubes-subTitle-search",searchDelay:600,searchTriggered:function(X){var W=this.parent.parent;W.set("searchPattern",X);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-cubes-subTitle-refresh",title:mstrmojo.desc(773,"Refresh"),bindings:{visible:"!mstrApp.refreshMultipleCubes"},onclick:function(){var W=mstrApp.getRootController();W.getCubeQuota({success:function(){W.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}}]},{scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-QuotaGrid",alias:"cubesList",slot:"cubesNode",resizableColumns:false,selectionPolicy:"reselect",setupScrollNodes:function I(){this.scrollNode=this.scrollboxNode;},bindings:{items:"this.parent.items"},shouldDisableItem:function(W){return W.ddam===V.datasetServeMode.dda&&mstrApp.refreshMultipleCubes;},sortBy:{n:1,sz:1,own:1,dt:1,sched:1,type:1},curSortBy:{k:null,v:1},onchange:function(W){if(mstrApp.refreshMultipleCubes){var X=W.src&&W.src.items&&W.added!=undefined&&W.src.items[W.added];X&&G(X);}},columns:[{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(8733,"Type"),onclick:function(){var Y=this.dataGrid;Y.sortBy.type=-Y.sortBy.type;var X=Y.sortBy.type;Y.curSortBy.k=N.TYPE;Y.curSortBy.v=X;var W=[];W=W.concat(Y.items);Y.set("items",W.sort(U(N.TYPE,X)));},postBuildRendering:function R(){var W=this.dataGrid;if(W.curSortBy.k===N.TYPE){S.addClass(this.domNode,J);}}},colCss:"typeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"typeLabel",bindings:{text:"this.parent.data.type"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7559,"Name"),onclick:function(){var Y=this.dataGrid;Y.sortBy.n=-Y.sortBy.n;var X=Y.sortBy.n;Y.curSortBy.k=N.NAME;Y.curSortBy.v=X;var W=[];W=W.concat(Y.items);Y.set("items",W.sort(U(N.NAME,X)));},postBuildRendering:function R(){var W=this.dataGrid;if(W.curSortBy.k===N.NAME){S.addClass(this.domNode,J);}}},colCss:"nameCol",dataWidget:{scriptClass:"mstrmojo.Table",cssClass:"nameTable",rows:1,cols:2,children:[{slot:"0,0",scriptClass:"mstrmojo.InlineEditBox",cssClass:"nameLabel",useRichTooltip:true,allowHighlight:true,okSave:true,bindings:{text:function(){var W=this.parent.data.cname+(this.parent.data.docn?" ("+this.parent.data.docn+")":"");return mstrmojo.string.escape4HTMLText(W);},richTooltip:function(){var W={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT};W.content=this.parent.data.docp?this.parent.data.docp:this.parent.data.objp;return W;}},postBuildRendering:function Q(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");this.tooltipNode=this.textNode;this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);var X=this.parent.parent.parent.parent.searchPattern;if(X&&X.length>0){var W=F.highlightKeyWords(X,this.text,"mstrmojo-di-cubelist-search-highlight");this.textNode.innerHTML=W;}},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}this.set("text",this.inputNode.value);if(this.onSave){this.onSave();}},onSave:function(){var X={objectid:this.parent.data.cube_id,objecttype:3,objectname:this.text};var W=mstrApp.getRootController();var Y={success:function(){X={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")};W.getCubeQuota({success:function(){W.getCubeQuota({success:function(){W.scheduleController.updateScheduleAndStatus();}},X);}},X);},failure:function(Z){W.displayError(Z.message||Z.getResponseHeader("X-MSTR-TaskFailureMsg"));}};W.renameObject(Y,X);},preclick:function(W){var Z=W.e,X=E.eventTarget(W.hWin,Z);if(X===this.okNode){this.save();}else{if(X===this.cancelNode){this.cancel();}else{if(X===this.textNode){var Y=this.parent.data;G(Y);}}}}},{slot:"0,1",scriptClass:"mstrmojo.MenuButton",cssClass:"cubeList-menu-button",cmCssClass:"cubeList-menu",menuZIndex:1000,preclick:mstrmojo.func.emptyFn,preBuildRendering:function(){var W=this.parent.data,X=true;if(this._super){this._super();}if(!W||!W.cube_id||mstrApp.refreshMultipleCubes){X=false;}this.set("visible",X);},onclick:function(){var X=this.parent.data,W=this;D(W,X);}}]}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13045,"Size(KB)"),onclick:function(){var Y=this.dataGrid;Y.sortBy.sz=-Y.sortBy.sz;var X=Y.sortBy.sz;Y.curSortBy.k=N.SIZE;Y.curSortBy.v=X;var W=[];W=W.concat(Y.items);Y.set("items",W.sort(U(N.SIZE,X)));},postBuildRendering:function R(){var W=this.dataGrid;if(W.curSortBy.k===N.SIZE){S.addClass(this.domNode,J);}}},colCss:"sizeCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"sizeLabel",bindings:{text:"this.parent.data.sz"}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13046,"Last Modified"),onclick:function(){var Y=this.dataGrid;Y.sortBy.dt=-Y.sortBy.dt;var X=Y.sortBy.dt;Y.curSortBy.k=N.DATE;Y.curSortBy.v=X;var W=[];W=W.concat(Y.items);Y.set("items",W.sort(U(N.DATE,X)));},postBuildRendering:function R(){var W=this.dataGrid;if(W.curSortBy.k===N.DATE){S.addClass(this.domNode,J);}}},colCss:"modifiedCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mtLabel",bindings:{text:function(){var X=this.parent.data;var W=X.mdt;if(W===undefined){W=X.nutm||X.utm;}if(W===undefined){return"";}return mstrmojo.DI.DIHelpers.formatDateAndTime(W,true);}}}},{headerWidget:{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13047,"Schedule Status"),onclick:function(){var Y=this.dataGrid;Y.sortBy.dt=-Y.sortBy.dt;var X=Y.sortBy.dt;Y.curSortBy.k=N.SCHEDULE;Y.curSortBy.v=X;var W=[];W=W.concat(Y.items);Y.set("items",W.sort(U(N.SCHEDULE,X)));},postBuildRendering:function R(){var W=this.dataGrid;if(W.curSortBy.k===N.SCHEDULE){S.addClass(this.domNode,J);}}},colCss:"scheStatusCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"scheStatus",bindings:{cssClass:function(){var X=["scheStatus"],Y=this.parent.data,W=V.cubeSchedStatus;switch(Y.schedStatus){case W.failed:X.push("fail");break;case W.successful:X.push("success");break;case W.unexecuted:X.push("empty");break;}return X.join(" ");},visible:function(){var W=this.parent.data.subs;return W&&W.length>0;}}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.DI.DICubesList");mstrmojo.requiresDescs(13058,13240,14192);mstrmojo.DI.ui.dialogs.DICubesListDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICubesListDialog",title:mstrmojo.desc(13058,"Data Storage"),showTitle:true,cssClass:"mstrmojo-di-diCubesListDialog",_evt:null,help:"Data_Storage_page.htm",children:[{scriptClass:"mstrmojo.DI.DICubesList",alias:"cubes"}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}],onOpen:function A(){var B=mstrApp.getRootController().getModel();this._evt=B.attachEventListener("cubesFinishPublishing",this.id,this.close);if(mstrApp.diParams.userName!==undefined&&!mstrApp.refreshMultipleCubes){this.set("title",mstrmojo.desc(13240,"###'s Data Storage").replace("###",mstrApp.diParams.userName));}if(mstrApp.refreshMultipleCubes){this.set("title",mstrmojo.desc(15829,"Republish Datasets"));}this.cubes.set("visible",true);this.cubes.update();if(this._super){this._super();}},onClose:function(){if(this._evt){var B=mstrApp.getRootController().getModel();B.detachEventListener(this._evt);}if(mstrApp.refreshMultipleCubes){mstrApp.getRootController().exitApplicationRefreshMultipleCubes();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.Box","mstrmojo.Button","mstrmojo.Editor","mstrmojo.Dial","mstrmojo.Label","mstrmojo.fe.CreateSetEditor","mstrmojo.fe.FilterEditor","mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.ui.ConditionWalk","mstrmojo.vi.ui.ConditionEditor","mstrmojo.vi.ui.editors.fe.ConditionWalk","mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree","mstrmojo.warehouse.EnumObjectTypes");mstrmojo.requiresDescs(118,2397,5758,14915,15540,15005,15014,15091);var b=mstrmojo.hash,W=mstrmojo.array,f=mstrmojo.css,L=mstrmojo.dom,Z=mstrmojo.expr,h=mstrmojo.mstr.EnumDSSXMLObjectTypes,S={TEMPLATE:0,DATASET:1},O=Z.ET,Y=Z.BRANCH_FNS,B=mstrmojo.warehouse.EnumObjectTypes,K=mstrmojo.mstr.EnumNodeProperties,I="VFEmpty";var G=10,U=46,H=116,P=286,R=369,F=42;DL_LABEL_HEIGHT=26;function g(k){var j={et:k.defaultExpressionType};if(k.disableElementsBrowsing&&k.disableElementsBrowsing()){j={et:O.AQ};}k.mainExpr.newCondition(j,true);}function N(j){var k=G;if(j<G){k=G;}else{if(j<=U){k=U;}else{k=H;}}return k;}function A(o,AC){var x=o&&o.domNode,u=AC&&AC.domNode,k=x&&x.style,w=u&&u.style;var m=o.parent.domNode.offsetHeight;if(!AC){k.height=m+"px";if(o.updateScrollbars){o.updateScrollbars();}return ;}if(x&&u){var t=R-P;if(!o.editor.showLimits){t-=F+DL_LABEL_HEIGHT;}var j=m-t;var l=L.position(o.itemsContainerNode),p=L.position(AC.itemsContainerNode),AA=l.h,AB=p.h;var n=N(AB),z=j-n;var q=Math.min(G+AA,z);k.height=q+"px";w.height=j-q+"px";if(o.updateScrollbars){o.updateScrollbars();}if(AC.updateScrollbars){AC.updateScrollbars();}}}function D(k){var l=b.clone(k);if(k&&k.et===O.ANDOR&&(k.node&K.CONDITION)){var m=b.valarray(Z.findTargets(k,"did"))[0],j={et:O.ANDOR,data:l};switch(m&&m.t){case h.Attribute:j.a=m;break;case h.Metric:j.m=m;break;}return j;}return l;}mstrmojo.vi.ui.editors.FilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditor,null,{scriptClass:"mstrmojo.vi.ui.editors.FilterEditor",titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-subtitle-container"></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:b.copy({subTitleNode:function X(){return this.showTitle?this.domNode.firstChild.children[1]:null;},containerNode:function d(){return this.domNode.firstChild.childNodes[3];},buttonNode:function J(){return this.domNode.firstChild.childNodes[4];},curtainNode:function E(){return this.domNode.lastChild;}},b.copy(mstrmojo.fe.FilterEditor.prototype.markupSlots)),help:"view_filter_editor_for_dossiers.htm",cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-vi-ui-FE",postCreate:function C(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Box",slot:"subTitleNode",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14915,"New Qualification"),cssDisplay:"inline-block",cssClass:"mstrmojo-relation-relateby-text",bindings:{text:function(){return this.editor.isNewCond?mstrmojo.desc(14915,"New Qualification"):mstrmojo.desc(15540,"Edit Qualification");},editor:"this.parent.parent",visible:function(){return !!this.editor.showCondWalk;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"newQualificationBtn",cssText:"float: left",cssDisplay:"inline-block",text:mstrmojo.desc(15005,"Add New Qualification"),onclick:function(){g(this.editor);},bindings:{enabled:function(){return !this.editor.readOnly;},visible:function(){return !this.editor.showCondWalk;},editor:"this.parent.parent"}}]}]);if(this._super){this._super();}},editorTitle:mstrmojo.desc(5758,"Filter Editor"),defaultExpressionType:O.AE,onvizTitleChange:function(){this.set("title",this.editorTitle+" - "+this.vizTitle);},getExpressionContainerCfg:function(){var j=this._super();j.cssDisplay="flex";return j;},onOpen:function M(){var j=this.mainExpr,k=this.limitExpr;if(j){A(j,k);}if(!this.model.expr){g(this);}},getExpressionContentsConfig:function(){return[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15091,"Metric values are not aggregated."),cssClass:"mstrmojo-FE-expr-header dl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"ve",scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree",level:S.DATASET,bindings:{items:"this.editor.model.exprForest || []"},onBlankClick:function(o){this.parent.clearSelect(o);},supportRelation:true,postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);},onNew:function(p){p.data.isNew=true;if(!p.data.ph){this.editor.openWalk(p.data,p.widget.ctxtBuilder.itemWidgets[p.index],"condition");}var o=this.parent.vle;A(this,o);},onadd:function j(){f.toggleClass(this.parent.domNode,I,this.items.length===0);var o=this.parent.vle;A(this,o);},onremove:function l(){f.toggleClass(this.parent.domNode,I,this.items.length===0);var o=this.parent.vle;A(this,o);},onnodeadd:function k(){var o=this.tree.parent.vle;A(this.tree,o);},onnoderemove:function n(){var o=this.tree.parent.vle;A(this.tree,o);},onitemsChange:function m(o){var q=this.items.length===0,p=this.parent;if(this.hasRendered){f.toggleClass(p.domNode,I,q);}else{if(q){f.addWidgetCssClass(p,I);}else{f.removeWidgetCssClass(p,I);}}}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15014,"Metric values are aggregated based on the attributes in the visualization."),cssClass:"mstrmojo-FE-expr-header tl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"vle",scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree",level:S.TEMPLATE,validExprTypes:W.hash([O.MQ,O.MC]),bindings:{visible:"this.editor.showLimits",items:"this.editor.model.limitExprForest || []"},onBlankClick:function(o){this.parent.clearSelect(o);},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("limitExpr",this);},onnodeadd:function k(){var o=this.tree.parent.ve;A(o,this.tree);},onnoderemove:function n(){var o=this.tree.parent.ve;A(o,this.tree);},onadd:function j(){var o=this.parent.ve;A(o,this);},onremove:function l(){var o=this.parent.ve;A(o,this);}}];},getConditionWalkConfig:function c(){return undefined;},toggleOkButtonStatus:function V(j){var k=this.buttonBar.children[0].btnSave;k.set("enabled",!!j);},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-FE-andOrPopup mstrmojo-ConditionWalk",contentNodeCssClass:"mstrmojo-balloon",slot:"containerNode",modal:false,autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var j=this.condition,m=j&&j.data&&j.data.not,n=j&&j.parent,k=n&&n.data,l=(k&&k.fn)+(m?21:0);this.list.opening=true;this.list.set("selectedItem",isNaN(l)?null:{did:l});this.list.opening=false;},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",animate:false,itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",renderOnScroll:false,items:[{did:19,n:Y[19]},{did:20,n:Y[20]},{did:19+21,n:Y["19_21"]},{did:20+21,n:Y["20_21"]}],onchange:function(){if(this.opening){return ;}var k=this.parent,j=k.condition,p=this.selectedItem,o=p&&p.did,n=o>21?true:null,m=o-(n?21:0);k.close();var l=j&&j.parent;if(l&&l.data&&l.data.et===O.ANDOR){l.edit(j,m,n);}else{var q=j&&j.data;if(q&&(q.not!==n)){q.not=n;j.paint();}}}}]},createSetPopupRef:{scriptClass:"mstrmojo.fe.CreateSetEditor",contentNodeCssClass:"",cssClass:"VI-CreateSet-Editor",slot:"containerNode",autoClose:true,showTitle:false,isHostedWithin:false},conditionEditorPopupRef:{scriptClass:"mstrmojo.vi.ui.ConditionEditor",isHostedWithin:false,getIfDataSource:function e(){return this.editor.getIfDataSource();},getDatasets:function Q(){return this.editor.getDatasets();},onUpdateBrowseElementsParams:function a(j){this.editor.onUpdateBrowseElementsParams(j);}},docModel:null,targetMetrics:null,_set_model:function(m,k){var l=this._super(m,k);if(l){var j=this.model.targets;this.targetMetrics=W.filter(j,function(n){n.title=n.n||"";return n.t===h.Metric;});}return l;},openWalk:function(o,p,w,x){var t=this,k=L.delta(p.domNode,t.containerNode);k.y+=(w==="andor"?16:parseInt(p.domNode.offsetHeight,10));var u={condition:p,zIndex:t.zIndex+10,left:k.x+"px",top:k.y+"px"},j;switch(w){case"andor":if(t.skipAndOrPopup){return ;}j="andOrPopupRef";break;case"createSet":case"createSetOpt":if(mstrApp&&mstrApp.isWSStyling&&x&&x.e&&x.e.target){var l=x&&x.e&&x.e.target,m=L.delta(l,t.containerNode);u.left=m.x+"px";u.top=m.y+parseInt(l.offsetHeight,10)+"px";}var q=t.model.targets;j="createSetPopupRef";u.type=w;u.model={attrs:W.filter(q,function(n){return n.t===B.ATTRIBUTE;}),metrics:W.filter(q,function(n){return n.t===B.METRIC;})};if(w==="createSetOpt"){u.condition=p.parent;u.model.childIdx=p.childIndex();}break;case"condition":var z=L.position(this.titleNode);u=b.copy({editor:t,objectBrowsingEnabled:t.objectBrowsingEnabled,showLimits:t.showLimits,targets:t.model.targets,targetsLastMod:t.modelLastSet,ets:p.tree.validExprTypes||t.validExprTypes,condition:p,hasPrompt:t.model.hasPrompt,disableElementsBrowsing:t.disableElementsBrowsing,inRelation:p.inRelation,model:D(o),left:z.x+50+"px",top:z.y+20+"px",draggable:!t.conditionEditorNotDraggable},u);if(!!o.isNew){u.title=mstrmojo.desc(14915,"New Qualification");}else{u.title=mstrmojo.desc(15540,"Edit Qualification");}j="conditionEditorPopupRef";}t.openPopup(j,u);},getIfDataSource:function e(){if(this.docModel){return this.docModel.getDataService();}return null;},onUpdateBrowseElementsParams:mstrmojo.emptyFn,getDatasets:function Q(){if(this.docModel){return this.docModel.datasets;}return null;},conditionEditorNotDraggable:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.css","mstrmojo.string","mstrmojo.qb.QBTableView","mstrmojo.qb.FFsqlEditor","mstrmojo.Label","mstrmojo.Table","mstrmojo.Button");mstrmojo.requiresDescs(2827,9130,9137,9141,9215,9927,12378,12417,13403,1281,14911);var K=mstrmojo.string,E=mstrmojo.css,C=mstrmojo.desc,G="on",O=mstrmojo.warehouse.EnumDataChangeEvents,N=mstrmojo.DI.DIConstants;var F=1,H=2;var A=mstrmojo.desc(9215,"Type multi-pass SQL or double-click a table name");mstrmojo.qb.Button=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.qb.Button",markupString:'<div id="{@id}" class="mstrmojo-Button mstrmojo-qb-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-qb-Button-icon {@innerIconClass}"></div><div class="mstrmojo-Button-text mstrmojo-qb-Button-text {@innerIconClass}" style="{@innerBtxCss}"></div></div>',markupSlots:{iconNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.lastChild;}},postBuildRendering:function(){var Q;if(this._super){Q=this._super();}var P=this;this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:this.text||""});if(!this._ontooltipover){this._ontooltipover=function(R){var S=P.textNode;if(S.offsetWidth<S.scrollWidth){P.showTooltip(R,self);}};this._ontooltipout=function(R){var S=P.textNode;if(S.offsetWidth<S.scrollWidth){P.hideTooltip(R,self);}};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return Q;}});mstrmojo.qb.QBPanel=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.QBPanel",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},cssText:"position:relative;",mode:F,children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",text:C(9130,"Execute SQL"),postCreate:function L(){var Q={},P=Q[this.id]={};P[O.DBTABLES_ENABLED]=function(R){this.set("enabled",R.value);};mstrApp.getRootController().attachDataChangeListeners(Q);},onclick:function(){var Q=mstrApp.getRootController(),P=this.parent.parent;if(P.mode===F){Q.autoMap();}else{Q.autoMapFFSQL(P.SQL.ffsql.getSQLstmt());}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon erase",text:C(2827,"Clear"),bindings:{visible:function(){return this.parent.parent.mode===H;}},postCreate:function L(){var Q={},P=Q[this.id]={};P[O.DBTABLES_ENABLED]=function(R){this.set("enabled",R.value);};mstrApp.getRootController().attachDataChangeListeners(Q);},onclick:function M(){var Q=this.parent.parent.SQL,R=Q.ffsql,P=mstrApp.getRootController();R.clearTokens();Q.updatepasses();if(P.hasDBRoleSelected()){P.autoMapFFSQL("");}if(P.canAddTableSQL(true,"")){P.enableAvailableTables();}}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon refresh",text:C(9927,"Update Tables"),bindings:{visible:function(){return(this.parent.parent.mode===F&&!mstrApp.isBigQuery);}},onclick:function(){mstrApp.getRootController().updateTableStructure();}}],preBuildRendering:function J(){if(this._super){this._super();}var Q=[];Q=[{scriptClass:"mstrmojo.qb.Button",cssClass:"mstrmojo-qb-tableview-toolbarIcon filter",text:C(1281,"Filter"),postBuildRendering:function P(){var S=this;mstrApp.getRootController().attachEventListener("reportModeChange",this.id,function(U){S.set("visible",U.mode!==2);});var R;if(this._super){R=this._super();}this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,top:32,content:C(1281,"Filter")});if(!this._ontooltipover){this._ontooltipover=function(U){S.showTooltip(U,self);};this._ontooltipout=function(U){S.hideTooltip(U,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return R;},onclick:function(){mstrApp.getRootController().openConditionDialog();}},{scriptClass:"mstrmojo.qb.Button",cssClass:"mstrmojo-qb-tableview-toolbarIcon sql",useRichTooltip:true,alias:"modeSwitcher",richTooltip:{cssClass:"vi-regular vi-tooltip-A",top:32,posType:mstrmojo.tooltip.POS_TOPLEFT},bindings:{text:function(){var R=this.parent.parent.mode===F;return R?C(9137,"Edit SQL"):C(14911,"Switch to Build Mode");},visible:function(){return !mstrApp.isFFSQL;}},onclick:function(){if(!mstrApp.isCloudPro||mstrApp.said){mstrApp.getRootController().convertMode(this.parent.parent.mode===F);}},postBuildRendering:function P(){var U=this;var S;if(this._super){S=this._super();}var R;if(!this._ontooltipover){this._ontooltipover=function(V){if(V.relatedTarget!==U.domNode&&V.relatedTarget!==U.domNode.childNodes[0]){R=mstrApp.isCloudPro?C(12417,"View SQL"):C(9137,"Edit SQL");U.richTooltip.refNode=U.domNode;if(U.parent.parent.mode===F){U.richTooltip.content=U.text;U.showTooltip(V,self);}else{U.richTooltip.content=U.text;U.showTooltip(V,self);}}};this._ontooltipout=function(V){U.hideTooltip(V,self);};}mstrmojo.dom.attachEvent(this.domNode,"mouseover",this._ontooltipover);mstrmojo.dom.attachEvent(this.domNode,"mouseout",this._ontooltipout);return S;}}];this.addChildren(Q);}},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",alias:"tables",bindings:{visible:function(){return(this.parent.mode===F);}}},{scriptClass:"mstrmojo.qb.FFsqlEditor",cssClass:"mstrmojo-qb-ffsqlview",alias:"SQL",bindings:{visible:function(){return(this.parent.mode===H);}}}],enterMode:function I(P){var S=P.mode;this.set("mode",S);var Q=(S===H);this.tables.set("visible",!Q);E.toggleClass(this.tables.domNode,G,!Q);E.toggleClass(this.SQL.domNode,G,Q);E.toggleClass(this.header.modeSwitcher.domNode,"switch_to_build",Q);this.SQL.set("visible",Q);if(Q){var R=this.SQL.ffsql;R.updateSQL(P);}else{this.tables.scrollBox.linker.drawLinks();}},onheightChange:function(P){if(this.domNode&&this.header.domNode){this.tables.set("height",parseInt(P.value,10)-this.header.domNode.clientHeight-3-(N.workstation.utils.shouldShowTitleBar()?35:0)+"px");this.SQL.set("height",this.tables.height);}},onwidthChange:function B(P){if(this.width!=="NaNpx"){this.tables.set("width",this.width);this.SQL.set("width",this.width);}},postBuildRendering:function D(){if(this._super){this._super();}var P=mstrApp.getRootController();P.attachEventListener("reportModeChange",this.id,this.enterMode);P.attachEventListener("addCandidateTables",this.SQL.ffsql.id,"addCandidateTables");}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.DI.DIConstants","mstrmojo.qb.QBPanel","mstrmojo.DI.DIHelpers","mstrmojo.ui.Splitter");mstrmojo.requiresDescs(1442,3416,6189,9130,15255);var E=mstrmojo.string.decodeHtmlString,H=mstrmojo.DI.DIConstants,D=H.browseFlag,A=mstrmojo.DI.DIHelpers,B=H.requestFlag;function G(L){return E(L).replace(/&apos;/g,"'");}mstrmojo.DI.ui.dialogs.DIAggregationDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAggregationDialog",title:mstrmojo.desc(15255,"Aggregation"),zIndex:10,cssClass:"mstrmojo-di-aggregationDialog",tableID:undefined,model:undefined,controller:undefined,onClose:mstrmojo.emptyFn,onPreClose:function(){window.setTimeout((function(L){return function(){L.btnGroup.btnClose.onclick();};})(this),0);return false;},onOpen:function F(){var M=this,L=this.model,O={success:function(P){mstrApp.msgid=P.msgid;L.loadReport(D.reportBindingTable+D.dataPreview,0,B.mapping,null,{success:function Q(R){L.loadDefinition(R);var S=M.splitter.tabPanel.tabView.scrollBox.domNode;S.style.overflowY="hidden";S.onmouseover=S.onmouseout=function(){};}});}};L.getFunctions(true);L.originalMsgID=mstrApp.msgid;mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:function N(P){mstrApp.msgid=P.msgid;if(M.hasAggFilter){L.firstTimeLoading=true;O.success({msgid:mstrApp.msgid});}else{M.controller.getDataService().submitRequest(O,{taskId:"DIStartOrCancelAggFilterChange",tbid:M.tableID});}}},{messageID:mstrApp.msgid});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",alias:"splitter",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function I(){return{h:2,w:2};},children:[{scriptClass:"mstrmojo.Box",slot:"firstSplitNode",alias:"tabPanel",children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",useRichTooltip:true,text:mstrmojo.desc(9130,"Execute SQL"),onclick:function(){mstrApp.getRootController().model.autoMap(null,false,false);}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon filter",useRichTooltip:true,text:mstrmojo.desc(12378,"Filter..."),cssText:"width:auto;",innerBtxCss:"width:auto;",onclick:function(){mstrApp.getRootController().openConditionDialog();}}]},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",alias:"tabView",fromAggregation:true}]},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",cssText:"position:relative;overflow:hidden;padding:0px;",onRender:function K(){this.set("height","300px");},slot:"secondSplitNode"}],config:{firstSplit:{v:"400px",min:"150px",max:undefined},secondSplit:{v:"215px",min:"150px",max:undefined},resizeHandle:{v:"5px"}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"btnGroup",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var M=this.parent.parent,L=M.model;L.autoMap({success:function N(){L.buildRelations({success:function(){L.cleanDuplicateRI(false);M.close();M.destroy();}});}},true);M.fromAggregation=true;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),alias:"btnClose",onclick:function(){var M=this.parent.parent,L=M.model;L.cleanDuplicateRI(true);M.fromAggregation=false;M.close();M.destroy();}}]}],toggleDataPreview:function C(){return ;},openExpressionEditor:function J(N,O){var L="qb-expr",M=mstrmojo.all[L]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ExpressionEditor",id:L});M.set("oi",mstrmojo.hash.copy(N,{mhfts:{},mvfts:{}}));M.open(null,{zIndex:O+1||10});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.vi.ui.editors.FilterEditor");mstrmojo.requiresDescs(5758,16037);var C=mstrmojo.array,A=mstrmojo.hash,B=mstrmojo.mstr.EnumDSSXMLObjectTypes,E=mstrmojo.mstr.EnumDSSXMLObjectSubTypes;mstrmojo.ME._HasConditionMetricFilterEditor=mstrmojo.provide("mstrmojo.ME._HasConditionMetricFilterEditor",{openConditionMetricFilterEditor:function D(G){var J="cmfe",K,H={},I=G.filter;function F(){C.forEach(G.att,function(N){if(N.t!==B.Attribute||N.da){return ;}var M=N.did,O=N.path;H[M]={did:M,n:N.n,t:N.t,st:N.st,fs:N.fs,da:N.da||false,datasetId:N.datasetId,ttp:N.n+(O?" - "+O:""),dsName:O};});C.forEach(G.mx,function(N){var M=N.did,O=N.path;H[M]={did:M,n:N.n,t:N.t,st:N.st||E.Metric,um:N.um,datasetId:N.datasetId,ttp:N.n+(O?" - "+O:""),dsName:O};});var L={expr:A.clone(I),targets:A.valarray(H)};K=J&&window.mstrmojo&&mstrmojo.all[J];if(!K){K=mstrmojo.insert({id:J,scriptClass:"mstrmojo.vi.ui.editors.FilterEditor",showLimits:false,docModel:G.docModel,title:mstrmojo.desc(11579,"Metric Editor")+" - "+mstrmojo.desc(16037,"Add Filter")});}if(G.zIndex){K.set("zIndex",G.zIndex);}K.set("model",L);K.targetMap=H;K.onSave=G.fnOk;K.onCancel=G.onCancel;K.onUpdateBrowseElementsParams=G.browseParam;K.open();}F();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.CheckBox","mstrmojo.StackContainer","mstrmojo.FileUploadBox","mstrmojo.DataGrid","mstrmojo.DI.DIHelpers","mstrmojo.fe.FilterEditor","mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.fe.FilterUtils","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.qb.QBAlertDialog","mstrmojo.ui.DIPublishSimpleTree","mstrmojo.WidgetTree","mstrmojo.AS.DIAppSchemaRepublishTreeNode","mstrmojo.onetier.vi.ui.DBCredentialEditor","mstrmojo.AS.DIPublishAppSchemaSheetsMatchEditor","mstrmojo.AS.DIAppSchemaRepublishOAuthButton");mstrmojo.requiresDescs(187,221,773,1088,1302,2461,9117,9118,12085,12393,12394,12395,12396,12397,12398,12399,12400,12401,12402,12491,12751,12814,12837,13048,13049,13050,13051,13052,13053,13054,13055,13056,13057,13099,1825,13275,13276,13277,12949,13942,13943,13959,13960,13969,13970,13971,13972,14215,6098,14767,15212);var M=mstrmojo.DI.DIConstants,K=4*1024*1024,H=mstrmojo.array,B=mstrmojo.hash,J=mstrmojo.css,F=mstrmojo.dom,C=mstrmojo.desc,D=mstrmojo.DI.DIHelpers,I="canSaveSchedule",L="canStartRefresh",G={"0":"tablestatus-col status waiting","1":"tablestatus-col status waiting","2":"tablestatus-col status waiting","3":"tablestatus-col status finished","4":"tablestatus-col status warning","5":"tablestatus-col status waiting","6":"tablestatus-col status warning"};function A(){return'<div class="tooltip-container"><div class="div-upper"><div class="top-title">'+mstrmojo.desc(11411,"Sample Data")+'</div><div class="upper-title"><div class="inner-title">'+mstrmojo.desc(15101,"Existing data")+'</div><div class="inner-title right">'+mstrmojo.desc(8616,"New data")+'</div></div><div class="wide short existing-new"></div></div><div class="div-lower"><div class="top-title">'+mstrmojo.desc(15102,"Different Refresh Policies and Results")+'</div><div class="right-content"><div class="inner-title padding-top">'+mstrmojo.desc(9117,"Replace existing data")+'</div><div class="narrow short replace"></div><div class="inner-title">'+mstrmojo.desc(9118,"Update existing data and add new data")+'</div><div class="narrow tall update-addnew"></div><div class="inner-title">'+mstrmojo.desc(12397,"Update existing data")+'</div><div class="narrow short update"></div/><div class="inner-title">'+mstrmojo.desc(12398,"Add new data")+'</div><div class="narrow tall addnew"></div></div></div></div>';}function E(P,R,U){var N=mstrApp.getRootController(),O=N.getModel();var S={success:function(V){O.externalSources[P].isLogin=true;O.externalSources[P].hasFetchedOAuthInfo=true;O.externalSources[P].userDisplayName=V.mi.sinf.un;O.externalSources[P].userEmail=V.mi.sinf.ea;O.raiseEvent({name:"OAuthInfoUpdate"});},failure:function(V){mstrmojo.alert("Fetching OAuth information failed.");}};var Q={dbRoleID:R,sourceAccountID:U};if(P===M.sourceType.googleBigQuery){Q.flags=M.sourcesInfoFlags.getGAnalyticsAccount|M.sourcesInfoFlags.getTokensInfo|M.sourcesInfoFlags.getUserName;}if(!O.externalSources[P].isFetchingInfo){N.dataService.getOAuthSourceReports(S,Q);}O.externalSources[P].isFetchingInfo=true;}mstrmojo.AS.DIAppSchemaTableStatusList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.AS.DIAppSchemaTableStatusList",bHasRefreshCheckbox:true,bHasRefreshPolicy:true,title:null,importFileFunc:mstrmojo.func.emptyFn,forceFullPublish:true,operationMode:null,cubeID:null,items:null,hasIRR:false,markupString:'<div id="{@id}" class="mstrmojo-di-tablestatuslist mstrmojo-di-appschema-tablestatuslist {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{titleNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function(){var N=this.model;if(N){mstrmojo.hash.forEach(N.importSources,function(R){var P=N.appSchemaTables&&mstrmojo.array.find(N.appSchemaTables,"mstrEmmaTableId",R.key),Q=N.appSchemaTables&&N.appSchemaTables[P],O=[];if(Q&&Q.tableGroups){Q.tableGroups.forEach(function(S){S.forEach(function(U){O.push({n:U.name,id:U.id,isLeaf:true,dataSourceType:U.dataSourceType});});});}R.items=O;});}this.update();N.attachEventListener("PublishStatusUpdate",this.id,"updateStatus");N.attachEventListener("OAuthInfoUpdate",this.id,"OAuthInfoUpdate");if(this._super){this._super();}},updateStatus:function(N){var O=this;if(N&&N.name){this.set("updateStarted",true);}if(N&&N.reset){this.set("updateStarted",false);window.setTimeout(function(){O.checkCanRefresh();},0);}},OAuthInfoUpdate:function(N){this.list.render();},update:function(N){var Q=this.model,O=[];if(N&&N.name){this.set("updateStarted",true);}try{var P=[];if(Q&&Q.appSchemaTables){P=Q.appSchemaTables.pipelineInfos;}else{if(this.items.pipelineInfos){P=this.items.pipelineInfos;}}P.forEach(function(U){var Z=U.mstrEmmaTableId,Y=U.mstrEmmaTableName,X,S=[],W=true;U.tableGroups.forEach(function(e){var a=[],h=[],d={},j,k,c,g,b,f;e.forEach(function(l){a.push(l.id);h.push(l.name);X=l.dataSourceType;j=l.fileAvailable;k=l.oAuthInfoMissing;g=U.id;c=l.id;b=l.dataSource&&l.dataSource.fileId;f=l.dataSource&&l.dataSource.fileName;dbRoleId=l.dataSource.dbRoleId;accountId=l.dataSource.accountId;});a=a.join("/");h=h.join("/");S.push({id:a,n:h,dataSourceType:X,isLeaf:true,extra:d,fileAvailable:j,oAuthInfoMissing:k,pipelineId:g,tableId:c,fileId:b,fileName:f,dbRoleId:dbRoleId,accountId:accountId});});var V=Q.importSources[Z];if(V){V.id=Z;V.name=Y;V.dataSourceType=X;V.items=S;V.checked=W;}else{if(Z){Q.importSources[Z]={id:Z,name:Y,dataSourceType:X,items:S,checked:W,tableID:Z};}}});mstrmojo.hash.forEach(Q.importSources,function(S){O.push(S);});this.set("items",O);}catch(R){console.log(R);mstrmojo.alert("Error! No data received for publish!");}if(Q){mstrmojo.hash.forEach(Q.importSources,function(S){if(S.checked===undefined){S.checked=true;}});}},getFileUploader:function(O){var N=this.model;var P=null;if(N&&N.importSources[O]){P=N.importSources[O].fileUploader;}return P;},checkCanRefresh:function(){var O=mstrApp.getRootController&&mstrApp.getRootController(),N=this.model,R=N.operationMode,Q=N.getAllTableID(),S=true,P=0;if(R===M.operationMode.refresh){H.forEach(Q,function(W){var V=N.getImportSource(W);if(V.checked){P++;switch(V.dataSourceType){case M.dataSourceType.FILE_LOCAL:H.forEach(V.items,function(X){if(X.fileAvailable!==true&&X.hasSelectFile!==true&&X.hasUsedCache!==true){S=false;return false;}});break;case M.dataSourceType.DROPBOX:case M.dataSourceType.GOOGLE_ANALYTICS:case M.dataSourceType.GOOGLE_BIGQUERY:case M.dataSourceType.GOOGLE_DRIVE:case M.dataSourceType.SALESFORCE:var U=D.convertDataSourceType2SourceType(V.dataSourceType);H.forEach(V.items,function(X){if(!N.externalSources[U].isLogin){S=false;return false;}});break;default:break;}}});if(0===P||(!N.checked&&!S)){S=false;}}if(R===M.operationMode.edit){H.forEach(Q,function(W){var V=N.getImportSource(W),U=false;if(V.type===M.sourceType.file){if(V.subtype===M.sourceSubtype.clipboard||V.subtype===M.sourceSubtype.localFile){if(!N.isCubePublished||!N.rawDataExistsInAE){U=!V.hasRefreshedData;}else{U=!V.isAll&&V.executeAction===M.tableStatsExecutionAction.forceExecution&&!V.hasRefreshedData;}if(U&&!V.hasSelectFile){S=false;}}}});}if(O){O.raiseModelEvent({name:L,value:S});}return S;},checkCanChange:function(){var N=this.model,Q=N.operationMode,O=N.getAllTableID(),P=false;if(Q===M.operationMode.refresh){P=true;}if(Q===M.operationMode.edit){if(!N.isCubePublished||!N.rawDataExistsInAE){P=false;}else{H.forEach(O,function(U){var S=N.getImportSource(U),R;R=S.hasRefreshedData&&(!S.forceRepublish||!S.schemaChanged);if(R){P=true;}});}}return P;},children:[{slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",bindings:{text:"this.parent.title",visible:"this.parent.title"}},{slot:"listNode",alias:"list",scriptClass:"mstrmojo.DataGrid",lockHeader:true,bindings:{items:"this.parent.items",forceFullPublish:"this.parent.forceFullPublish",updateStarted:"this.parent.updateStarted",cssClass:function(){if(this.parent.model.operationMode===M.operationMode.create){return"mstrmojo-di-tablestatuslist-list create";}if(this.parent.model.operationMode===M.operationMode.refresh){return"mstrmojo-di-tablestatuslist-list refresh";}else{return"mstrmojo-di-tablestatuslist-list edit";}},},columns:[],listSelector:null,resizableColumns:true,onitemsChange:function(){if(this._super){this._super();}var P=this.parent.bHasRefreshCheckbox,Q=this.parent.bHasRefreshPolicy,O=[],S={refreshBox:"28",refreshPolicy:"256"};if(P){O.push({headerWidget:{scriptClass:"mstrmojo.TristateCheckBox",cssClass:"tristate tablestatus-header refresh",grayed:false,checked:false,eventSubs:null,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var b;if(this.tooltipContent){b=F.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(b.y-3,0),left:Math.max(b.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var c={},b=c[this.id]={};b.scheduleCheckedChange=this.updateStatus;b.refreshCheckedChange=this.updateStatus;b.PublishStatusUpdate=this.updatePublishStatus;if(mstrApp.rootController){this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(c);}}this.updateStatus();},onUnRender:function W(){if(this.eventSubs){if(mstrApp.getRootController){mstrApp.getRootController().detachDataChangeListeners(this.eventSubs);}this.eventSubs=null;}if(this._super){this._super();}},updatePublishStatus:function U(b){if(b&&b.name){this.set("enabled",false);}if(b&&b.reset){this.set("enabled",this.origEnabled);}},updateStatus:function X(){if(!this.visible){return ;}var f=this,j=0,b=0,c,k,h=true,e=false,g=f.dataGrid.parent.model,d=g.operationMode;if(d===M.operationMode.create||d===M.operationMode.edit){f.dataGrid.parent.checkCanRefresh();this.set("visible",false);return ;}H.forEach(f.dataGrid.items,function(l){if(!l.isAll){if(l.checked){b++;}j++;}});if(!b){c=false;k=false;}else{if(b<j){c=true;k=true;}else{c=false;k=true;e=true;}}if(d===M.operationMode.refresh){h=!f.dataGrid.forceFullPublish;if(!h){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}}g.checked=e;this.set("grayed",c);this.set("checked",k);this.set("enabled",h);this.set("origEnabled",h);if(d===M.operationMode.refresh){f.dataGrid.parent.checkCanRefresh();}},onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}var h=this,c=h.dataGrid.parent.model.operationMode,l=[],b=[],e=this.checked,d=h.dataGrid.parent.hasIRR,g=mstrApp.getRootController&&mstrApp.getRootController(),j=h.dataGrid.parent.model,f=j.cubeID,k=h.dataGrid.items;j.checked=!this.grayed&&this.checked;if(c===M.operationMode.refresh||c===M.operationMode.subscribe){H.forEach(k,function(m){if(!m.isAll&&m.checked!==e){if(e&&c===M.operationMode.subscribe&&!m.canSubscribe()){return true;}if(c===M.operationMode.refresh&&m.forceRepublish){h.set("grayed, true");return true;}l.push(m.tableID);b.push(m.refreshType.toString());m.checked=e;}});if(l.length>0){if(g){g.raiseModelEvent({name:"allCheckedChange"});}}if(c===M.operationMode.refresh){h.dataGrid.parent.checkCanRefresh();}}}},colWidth:S.refreshBox,dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col refreshBox",colWidth:S.refreshBox,children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"refreshCheckbox",cssDisplay:"table",colWidth:S.refreshBox,visible:false,text:"",tooltipOpenDelay:0,useRichTooltip:true,preBuildRendering:function(){var b=this.parent.dataGrid,c=b.parent.model,e=this.parent.data,d;this.update();this.subEvts=[];d=c.attachEventListener("allCheckedChange",this.id,"updateCheck");this.subEvts.push(d);if(!e.isAll){}this.subEvts.push(c.attachEventListener("PublishStatusUpdate",this.id,"updatePublishStatus"),c.attachEventListener("refreshCheckedChange",this.id,"update"));},onUnRender:function(){var b=this.parent.dataGrid,d=this.parent.data,c=b.parent.model;H.forEach(this.subEvts,function(e){c.detachEventListener(e);});if(this.dataEvt){d.detachEventListener(this.dataEvt);}},updatePublishStatus:function(b){if(b&&b.name){this.set("enabled",false);}if(b&&b.reset){this.set("enabled",this.origEnabled);}},updateTooltipConfig:function(){var b;if(this.tooltipContent){b=F.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(b.y-3,0),left:Math.max(b.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},update:function(){var f=this.parent,e=this.parent.data,d=f.dataGrid.parent.model.operationMode,b=true,c=false;if(e.isAll){return false;}if(d===M.operationMode.refresh){b=!f.dataGrid.forceFullPublish&&!e.forceRepublish;c=f.dataGrid.forceFullPublish||f.data.checked===true||e.forceRepublish;if(!b){if(f.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}else{if(e.forceRepublish){this.set("tooltipContent",mstrmojo.desc(13969,"The edit operations require the following table to be refreshed."));}}}}else{if(d===M.operationMode.subscribe){b=f.data.canSubscribe();c=f.data.checked;if(!b){this.set("tooltipContent",mstrmojo.desc(13056,"No scheduling support for local files"));}}}this.set("enabled",b);this.set("origEnabled",b);this.set("checked",c);},updateCheck:function(){var b=this.parent.data;this.set("checked",!!b.checked);},oncheckedChange:function(){var j=this.parent,k=j.dataGrid.parent.model,h=mstrApp.getRootController&&mstrApp.getRootController(),l,g,e=k.cubeID,f=j.data,m,d=this.checked,c=j.dataGrid.parent.hasIRR,b=k.operationMode;if(f.checked===d){if(k.operationMode===M.operationMode.refresh){if(h){h.raiseModelEvent({name:"refreshCheckedChange",data:f});}}return ;}if(!f.isAll){if(d&&b===M.operationMode.subscribe&&!f.canSubscribe()){return ;}f.checked=d;k.importSources[f.id].checked=d;}if(k.operationMode===M.operationMode.refresh){if(h){h.raiseModelEvent({name:"refreshCheckedChange",data:f});}}}},{scriptClass:"mstrmojo.Label",cssClass:"refreshBox-status",visible:false,preBuildRendering:function(){var b=this.parent.dataGrid.parent.model;this.update();this.subEvt=b.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var b=this.parent.dataGrid.parent.model;if(this.subEvt){b.detachEventListener(this.subEvt);}},update:function(e){var f=this.parent.data,d=this.parent.dataGrid.parent.updateStarted,c=f&&f.status,g="",b="tablestatus-col status";if(String(c)==="4"||String(c)==="6"){g=f.errmsg||"";}if(G[c]){b=G[c];}else{if(d){b=G[0];}}if(e&&e.completed&&!e.error){b=G[3];}this.set("title",g);this.set("cssClass",b);if(this.domNode){this.domNode.className=b;}}}],preBuildRendering:function(){var b=this.dataGrid.parent.model;this.update();this.subEvt=b.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var b=this.dataGrid.parent.model;if(this.subEvt){b.detachEventListener(this.subEvt);}},update:function(c){var d=null,e=this.dataGrid.parent.model.operationMode,b=this.dataGrid.parent.updateStarted,f=this.data;if(c&&c.reset){b=false;}if(f.isAll){d=null;}else{d=this.children[0];if(e!==M.operationMode.subscribe&&f.checked){if((b&&f.published)||e!==M.operationMode.refresh){d=this.children[1];}}}this.set("selected",d);}}});}O.push({headerText:mstrmojo.desc(12949,"Data Source"),headerCss:"tablestatus-header label",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-col tableNameBox cf",preBuildRendering:function(){var b=this.dataGrid.parent.model,c=b.operationMode;if(c===M.operationMode.refresh){b.attachEventListener("refreshCheckedChange",this.id,"update");}if(c===M.operationMode.subscribe){if(!this.data.isAll&&!this.data.canSubscribe()){this.children[0].set("enabled",false);}}this.update();},update:function(){var h=this.data,f=h.checked,b=this.dataGrid.parent.model,d=true,c=false,g=this.children[0],e=g&&g.domNode,j=false;H.forEach(h.items,function(k){if(k.hasSelectFile!==true){d=false;}if(k.hasUsedCache===true){c=true;}});if(b.operationMode===M.operationMode.refresh){j=f;}if(b.operationMode===M.operationMode.edit){if(!b.isCubePublished||!b.rawDataExistsInAE){j=!h.hasRefreshedData;}else{j=!h.isAll&&h.executeAction===M.tableStatsExecutionAction.forceExecution&&!h.hasRefreshedData;}}if(e){J.toggleClass(e,"selected",f);J.toggleClass(e,"hasSelectFile",d||c||!j);}else{if(f){J.addWidgetCssClass(g,"selected");}else{J.removeWidgetCssClass(g,"selected");}if(d||!j){J.addWidgetCssClass(g,"hasSelectFile");}else{J.removeWidgetCssClass(g,"hasSelectFile");}}this.children[1].set("visible",j);},children:[{scriptClass:"mstrmojo.WidgetTree",bindings:{items:function(){var e=this.parent.data,d="",c=!(e.items&&e.items.length>0);if(e.sourceInfo){d=e.sourceInfo.dbTableName||e.sourceInfo.name;}else{d=e.name;}var b=this.streamlinePipelineStructure();return[{n:d,isLeaf:c,items:b}];}},needDisplayPipeline:true,streamlinePipelineStructure:function(){var d=this.parent.data,b=this,e={},c=[];H.forEach(d.items,function(h,g,f){if(f.length===1){c.push(h);b.needDisplayPipeline=false;return false;}else{if(f.length>1){c.push(h);}}});this.cssClass+=this.needDisplayPipeline?"":" hidePipeline";B.forEach(e,function(f){f.n=f.n.join(";");});if(!this.needDisplayPipeline){H.forEach(c,function(f){f.n=f.fileName?f.fileName+" - "+f.n:f.n;});}return c.concat(B.valarray(e));},itemIdField:"id",cssClass:"mstrmojo-DIPublishSimpleTree",itemDisplayField:"n",itemFunction:function R(g,d,e){var c=e.tree||e,f="dataset-table",b=g.items.length;f+=(b>1?" multipleTable":"");return new mstrmojo.TreeNode({idx:d,data:g,state:1,parent:e,tree:c,multiSelect:e.multiSelect,text:g[e.itemDisplayField],cssClass:"leaf",textCssClass:c.item2textCss(g),items:g[e.itemChildrenField],itemIdField:e.itemIdField,itemDisplayField:e.itemDisplayField,itemIconField:e.itemIconField,itemChildrenField:e.itemChildrenField,itemFunction:function(k,h,j){f+=(h===b-1?" last":"");return new mstrmojo.AS.DIAppSchemaRepublishTreeNode({idx:h,data:k,parent:j,cssClass:f,iconClass:k.dataSourceType,injectEvts:function(){var o=this.parent.parent.parent,l=o.dataGrid;if(l.parent.model.operationMode!==M.operationMode.refresh){return ;}var n=mstrApp.getRootController(),m=n.model;m.attachEventListener("onLocalFileStatusUpdate",this.id,"onLocalFileStatusUpdate");},getItemActionBtn:function(){var n,t=this.parent.parent.parent,m=t.dataGrid;if(m.parent.model.operationMode!==M.operationMode.refresh){return null;}switch(k.dataSourceType){case M.dataSourceType.FILE_LOCAL:n={browseLabel:"",fileFieldName:"file",scriptClass:"mstrmojo.FileUploadBox",accept:".xls,.xlsx,.csv,.txt,.tsv,.prn,.json,.sas7bdat",onvalueChange:function(u){if(u.value===-1){return ;}var w=mstrApp.getRootController(),z=this.parent.data,AA=(this.value!==""),x=true;this.inputNode.value=(AA?this.value:z.n);this.parent.tableNode.firstChild.innerText=(AA?this.value:z.n);if(AA||(!AA&&z.fileAvailable)){J.addClass(this.buttonNode,"mstrmojo-FileUploadBox-FileSelected-button");}else{J.removeClass(this.buttonNode,"mstrmojo-FileUploadBox-FileSelected-button");}B.copy({hasSelectFile:AA,fileUploader:AA?this:null,needUploadFile:AA},z);t.update();m.parent.checkCanRefresh();w.raiseModelEvent({name:"onLocalFileStatusUpdate",fileId:z.fileId,datasourceWidgetIndex:t.idx,sourceTableIndex:this.parent.idx,pickedFileName:this.value,data:z});H.forEach(t.data.items,function(AB){if(!AB.hasSelectFile&&!AB.fileAvailable){x=false;return false;}});t.data.checked=x||t.dataGrid.forceFullPublish||t.data.forceRepublish;w.raiseModelEvent({name:"refreshCheckedChange",data:t.data});},submit:function(w,x,u){x.success();},postBuildRendering:function(){this._super&&this._super();k.fileAvailable&&J.addClass(this.buttonNode,"mstrmojo-FileUploadBox-FileSelected-button");}};break;case M.dataSourceType.FILE_URL:n={browseLabel:"",scriptClass:"mstrmojo.Label",text:""};break;case M.dataSourceType.DROPBOX:case M.dataSourceType.GOOGLE_ANALYTICS:case M.dataSourceType.GOOGLE_BIGQUERY:case M.dataSourceType.GOOGLE_DRIVE:case M.dataSourceType.SALESFORCE:var p=D.convertDataSourceType2SourceType(k.dataSourceType),q=mstrApp.getRootController().getModel().externalSources[p],o=!!q.isLogin,l=!!q.hasFetchedOAuthInfo;if(!k.oAuthInfoMissing&&!l){E(p,k.dbRoleId,k.accountId);}n={scriptClass:"mstrmojo.AS.DIAppSchemaRepublishOAuthButton",cssClass:"mstrmojo-di-appschema-republish-oauth-button",sourceType:p,isLogin:o,tableId:k.tableId,pipelineId:k.pipelineId};break;default:break;}return n;},getMenuBtn:function(){var m,n=this.parent.parent.parent,l=n.dataGrid;if(l.parent.model.operationMode!==M.operationMode.refresh){return null;}switch(k.dataSourceType){case M.dataSourceType.FILE_LOCAL:m={scriptClass:"mstrmojo.Button",text:"",cssClass:"mstrmojo-buttonMenu",onclick:function(){var AA=l.parent,p=this,t=n.data,x=this.parent.data,q=p.domNode.parentNode.previousSibling,AB=q.previousSibling,u=q.firstChild.firstChild.childNodes[1].childNodes[1],AC=mstrApp.getRootController();var w=new mstrmojo.ui.menus.MenuConfig();w.hostElement=AA.domNode;w.isHostedWithin=false;w.position=F.position(p.domNode,true);var o=function o(AD){var AE=p.parent.data;u.value=null;AE.fileUploader&&AE.fileUploader.set("value","");AE.fileUploader=null;B.copy({hasSelectFile:false,hasUsedCache:true,needUploadFile:false},AE);AB.firstChild.innerText=p.parent.data.n;n.update();l.parent.checkCanRefresh();AC.raiseModelEvent({name:"onLocalFileStatusUpdate",fileId:AE.fileId,datasourceWidgetIndex:n.idx,sourceTableIndex:p.parent.idx,pickedFileName:"",data:AE});};var z=function z(AD){u.click();};if(x.hasSelectFile&&k.fileAvailable){w.addMenuItem("Use cached file","",o);}else{w.addDisabledMenuItem("Use cached file","");}w.addMenuItem("Upload new file","",z);AA.openPopup(w.newInstance());}};break;case M.dataSourceType.FILE_URL:case M.dataSourceType.DROPBOX:case M.dataSourceType.GOOGLE_ANALYTICS:case M.dataSourceType.GOOGLE_BIGQUERY:case M.dataSourceType.GOOGLE_DRIVE:case M.dataSourceType.SALESFORCE:m={browseLabel:"",scriptClass:"mstrmojo.Label",text:""};break;default:break;}return m;},onLocalFileStatusUpdate:function(AB){var t=this.data;if(t.dataSourceType===M.dataSourceType.FILE_LOCAL){var AC=this.parent.parent.parent,m=AC.dataGrid,n=AB.fileId,AA=AB.datasourceWidgetIndex,u=AB.sourceTableIndex,q=AB.data.fileUploader,z=AB.pickedFileName,w=AC.idx,l=this.idx,p=this.buttonNode.firstChild,o=p.firstChild,x=o.children[1];if(n===t.fileId&&AC.data.checked===true){if(w!==AA||l!==u){if(t.fileUploader){x.lastChild.value=null;t.fileUploader.set("value",-1);}B.copy({hasSelectFile:z===""?false:true,fileUploader:null,needUploadFile:false,hasUsedCache:AB.data.hasUsedCache},t);o.firstChild.value="";this.tableNode.firstChild.innerText=z||t.n;if(z!==""||(AB.data.fileAvailable)){J.addClass(x.firstChild,"mstrmojo-FileUploadBox-FileSelected-button");}else{J.removeClass(x.firstChild,"mstrmojo-FileUploadBox-FileSelected-button");}}m.parent.checkCanRefresh();}}}});},listSelector:e.listSelector});}},{scriptClass:"mstrmojo.StackContainer",renderMode:"notonShow",markupMethods:mstrmojo.hash.copy({onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},mstrmojo.StackContainer.prototype.markupMethods),cssClass:"tableNameBox-stack",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"tableNameBox-stack-edit",visible:false,text:mstrmojo.desc(1088,"Edit"),onclick:function(){}},{scriptClass:"mstrmojo.FileUploadBox",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,uploadTaskId:"importFile",action:mstrConfig.taskURL,fileFieldName:"myFile",initValue:false,browseLabel:mstrmojo.desc(1825,"Browse"),accept:".xls,.xlsx,.csv,.txt,.tsv,.prn,.json,.sas7bdat",onvalueChange:function(){var c=this.parent.parent.data,d=(this.value!==""),b=this.parent.parent.dataGrid;c.hasSelectFile=d;c.fileUploader=this;if(d){c.checked=true;model.importSources[c.id].checked=true;}this.parent.parent.update();if(d){this.parent.parent.children[0].set("text",this.getFileName());}else{this.parent.parent.children[0].resetText();}b.parent.checkCanRefresh();},getFileName:function(){var b;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){b=this.fileNode.files.length>0&&this.fileNode.files[0].name;}else{b=this.value;}return b;},getFileSize:function(){var b=0;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){b=this.fileNode.files.length>0&&this.fileNode.files[0].size;}else{try{var f=new ActiveXObject("Scripting.FileSystemObject");var c=f.getFile(this.fileNode.value);if(c){b=c.Size;}}catch(d){}}return b;},submit:function(b,o,l){function c(h){var p={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(o.failure){o.failure(h||p);}if(o.complete){o.complete();}}function f(){var h,p;b.fileName=e;b.index++;h=Math.min(m.size,j+K);p=m.slice(j,h);if(b.index===b.numberOfChunks){mstrApp.upload(o,b,p,l);}else{mstrApp.upload({success:function(){j=j+K;f();},failure:function(q){c(q);}},b,p,l);}}var d=true;var m,e,k,j;if(this.onsubmit){d=this.onsubmit();}if(d){b=b||{};b.fileFieldName=this.fileFieldName;b.taskId=this.uploadTaskId;b.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){l=mstrmojo.hash.copy(l,{async:true});m=this.fileNode.files[0];e=m.name;if(this.params){b=this.params;}if(m.size>K){k=Math.ceil(m.size/K);j=0;b.index=0;b.numberOfChunks=k;b.chunkSize=K;b.fileName=this.fileNode.files[0].name;b.fileSize=m.size;b.fileType="application/octet-stream";mstrApp.showProgress(l);mstrApp.upload({success:function(){f();},failure:function(h){c(h);}},b,null,l);}else{b.fileName=this.fileNode.files[0].name;mstrApp.upload(o,b,m.slice(0,m.size),l);}}else{b.taskEnv="jsonp2";b.fileName=this.value;var n=[],g;for(g in b){n.push('<input type="hidden" name="'+g+'" value="'+mstrmojo.string.encodeHtmlString(b[g])+'"/>');}if(this.params){b=this.params;for(g in b){n.push('<input type="hidden" name="'+g+'" value="'+mstrmojo.string.encodeHtmlString(b[g])+'"/>');}}this.paramsNode.innerHTML=n.join("");if(o){this.onSuccess=o.success;this.onFailed=o.failure;}this.formNode.submit();}this.set("status","loading");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,text:mstrmojo.desc(14287,"Input Credentials"),}],preBuildRendering:function(){var e=this.parent.data,b=this.parent.dataGrid.parent.model,c=null;switch(e.type){case M.sourceType.file:if(e.subtype===M.sourceSubtype.clipboard){c=this.children[2];}else{if(e.subtype===M.sourceSubtype.localFile){if(mstrApp.isSingleTier){c=this.children[2];}else{c=this.children[1];}}}break;default:c=null;if(mstrApp.isSingleTier&&b.missingCredentialsData){var d=this;mstrmojo.array.forEach(b.missingCredentialsData.datasets[0].tables,function(f){if(f.did===e.tableID){if(f.dbRole){e.dbRole=f.dbRole;}c=d.children[3];}});}break;}if(c){this.set("selected",c);}this.subEvt=b.attachEventListener("PublishStatusUpdate",this.id,"update");if(this._super){this._super();}},onUnRender:function(){var b=this.parent.dataGrid.parent.model;if(this.subEvt){b.detachEventListener(this.subEvt);}},update:function(b){if(b&&b.name&&this.selected){this.selected.set("enabled",false);}if(b&&b.reset&&this.selected){this.selected.set("enabled",true);this.parent.update();}if(b&&b.reset&&b.errors){switch(b.errors[this.parent.data.tableID]){case M.backendError.noExternalSession:case M.backendError.databaseCredentialsNotAvailable:this.selected=this.children[3];this.selected.set("visible",true);this.parent.update();break;case M.backendError.switchingFileType:if(this.selected){this.selected.set("enabled",true);this.parent.update();}break;}}}}]}});if(Q){var a={popupZIndex:9999,popupToBody:true,isHostedWithin:false,colWidth:"230",visible:false,items:[],tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var b;if(this.tooltipContent){b=F.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(b.y-3,0),left:Math.max(b.x,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},postCreate:function Z(){var f=this.parent.data,g=this.parent,c=true,d=this.parent.dataGrid.parent.model.operationMode,b=[{n:C(9117,"Replace existing data"),dssid:M.cubeRefreshType.replaceTable},{n:C(9118,"Update existing data and add new data"),dssid:M.cubeRefreshType.upsert},{n:C(12397,"Update existing data"),dssid:M.cubeRefreshType.update},{n:C(12398,"Add new data"),dssid:M.cubeRefreshType.add}];if(f.isAll){if(d===M.operationMode.subscribe){f.model.set("refreshType",M.cubeRefreshType.replaceTable);}b.push({n:"",dssid:M.cubeRefreshType.dummy});this.parent.set("visible",false);}else{if(d===M.operationMode.edit){if(g.dataGrid.forceFullPublish){c=false;}else{c=(!f.forceRepublish||!f.schemaChanged)&&f.hasRefreshedData;}this.set("enabled",c);if(!c){this.set("tooltipContent",mstrmojo.desc(13970,'The edit operations require the refresh policy to be "Replace existing data".'));}}if(d===M.operationMode.refresh){c=!g.dataGrid.forceFullPublish&&(!f.forceRepublish||!f.schemaChanged);this.set("enabled",c);if(!this.enabled){if(g.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13971,'Cube doesnot exist in memory so the refresh policy has to be "Replace existing data".'));}else{this.set("tooltipContent",mstrmojo.desc(13972,'The edit operations require the refresh policy to be "Replace existing data".'));}}}if(d===M.operationMode.subscribe){f.refreshType=M.cubeRefreshType.replaceTable;c=f.canSubscribe();this.set("enabled",c);if(!c){this.set("tooltipContent",mstrmojo.desc(13056,"No scheduling support for local files"));}}}this.set("origEnabled",this.enabled);this.set("items",b);var e=this.parent.data.isAll?this.parent.data.model.refreshType:this.parent.data.refreshType;this.initValue(e);},updateStatus:function X(){var f=this.parent,e=f.data,c=null,d=e.model.refreshType,b=true;H.forEach(f.dataGrid.items,function(g){if(!g.isAll){if(g.refreshType!==c){if(c===null){c=g.refreshType;}else{b=false;return false;}}}return true;});if(!b){c=M.cubeRefreshType.dummy;}if(c!==null&&c!==d){e.model.set("refreshType",c);}},updatePublishStatus:function(b){if(b&&b.name){this.set("enabled",false);}if(b&&b.reset){this.set("enabled",this.origEnabled);}},preBuildRendering:function V(){var c,b;if(this._super){this._super();}if(!this.parent.data.isAll){if(!this.eventSubs){c={};b=c[this.id]={};b.PublishStatusUpdate=this.updatePublishStatus;}return ;}if(!this.eventSubs){c={};b=c[this.id]={};b.scheduleRefreshTypeChange=this.updateStatus;b.PublishStatusUpdate=this.updatePublishStatus;}this.updateStatus();},onUnRender:function W(){if(this.eventSubs){this.eventSubs=null;}if(this._super){this._super();}},updateRefreshType:function(g){var j,l,f=this.parent.data,c,h=this.parent,k=[],b=[],e=h.dataGrid.parent.hasIRR,d=h.dataGrid.parent.model.operationMode;if(f.isAll){c=f.model.refreshType;if(g===c){return ;}f.model.refreshType=g;if(g===M.cubeRefreshType.dummy){return ;}H.forEach(h.dataGrid.items,function(m){if(!m.isAll&&m.refreshType!==g){if(m.checked){k.push(m.tableID);b.push(g.toString());}m.set("refreshType",g);}});return ;}c=f.refreshType;if(g===c){return ;}f.refreshType=g;if(!(e&&f.checked&&c!==g)){return ;}j=f.tableID;}};if(D.isWS()&&(D.getOperationMode()===M.operationMode.refresh||D.getOperationMode()===M.operationMode.subscribe)){B.copy({scriptClass:"mstrmojo.ui.Pulldown",onSelectedItemChange:function(b){this.updateRefreshType(b.dssid);},initValue:function(c){var b=H.find(this.items,"dssid",c);this.set("selectedIndex",(b<0)?0:b);}},a);}else{B.copy({scriptClass:"mstrmojo.Pulldown",onvalueChange:function(){var b=H.find(this.items,this.itemIdField,this.value);if(b<0){this.selectedIndex=0;}var c=this.items[this.selectedIndex].dssid;this.updateRefreshType(c);},initValue:function(b){this.set("value",b);},premousedown:function Y(b){if(this.enabled){mstrmojo.Pulldown.prototype.premousedown.call(this,b);}}},a);}var N={headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-header pulldown",children:[{scriptClass:"mstrmojo.Label",cssClass:"refresh-policy-label",text:mstrmojo.desc(13053,"Refresh Policy")},{scriptClass:"mstrmojo.Image",alias:"tooltipImage",cssClass:"refresh-policy-icon",useRichTooltip:true,tooltipOpenDelay:0,updateTooltipConfig:function(){var b=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular vi-taller vi-tooltip-A vi-tooltip-leftcenter",posType:mstrmojo.tooltip.POS_TOPLEFT,content:A(),top:b.y+25,left:b.x-95,enableHover:true};},bindings:{visible:function(){return D.isWS()&&(this.parent.dataGrid.parent.model.operationMode===M.operationMode.refresh||this.parent.dataGrid.parent.model.operationMode===M.operationMode.subscribe);}}}]},colWidth:S.refreshPolicy,dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col stack pulldown",colWidth:"65",children:[a,{scriptClass:"mstrmojo.Label",colWidth:"100",visible:false,bindings:{text:function(){var b="";var c=this.parent.data.xdaType;switch(c){case M.xdaType.excel:case M.xdaType.text:b=mstrmojo.desc(13056,"No scheduling support for local files");break;}return b;}}}],preBuildRendering:function(){this.set("selected",this.children[0]);if(this._super){this._super();}}}};O.push(N);}if(this.hasRendered){this.unrender();this.columns=O;this.render();}else{this.columns=O;}}}]});mstrmojo.AS.DIAppSchemaTableStatusList.OneTierFiles=function(O){var N=mstrmojo.all[mstrmojo.AS.DIAppSchemaTableStatusList.selectedUploader];N.replaceOneTierFile(O);};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.CheckBox","mstrmojo.StackContainer","mstrmojo.FileUploadBox","mstrmojo.DataGrid","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIDatabaseHelper","mstrmojo.fe.FilterEditor","mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.fe.FilterUtils","mstrmojo.ui.menus.Menu","mstrmojo.ui.menus.MenuConfig","mstrmojo.qb.QBAlertDialog","mstrmojo.onetier.vi.ui.DBCredentialEditor","mstrmojo.DI.DIURLUpload");mstrmojo.requiresDescs(187,221,773,1088,1302,2461,9117,9118,12085,12393,12394,12395,12396,12397,12398,12399,12400,12401,12402,12491,12751,12814,12837,13048,13049,13050,13051,13052,13053,13054,13055,13056,13057,13099,1825,13275,13276,13277,12949,13942,13943,13959,13960,13969,13970,13971,13972,14215,6098,14767,15212);var P=mstrmojo.DI.DIConstants,M=4*1024*1024,J=mstrmojo.array,D=mstrmojo.hash,L=mstrmojo.css,G=mstrmojo.dom,E=mstrmojo.desc,F=mstrmojo.DI.DIHelpers,K="canSaveSchedule",O="canStartRefresh",I={"0":"tablestatus-col status waiting","1":"tablestatus-col status waiting","2":"tablestatus-col status waiting","3":"tablestatus-col status finished","4":"tablestatus-col status warning","5":"tablestatus-col status waiting","6":"tablestatus-col status warning"},N=mstrmojo.DI.DIDatabaseHelper;function C(){return'<div class="tooltip-container"><div class="div-upper"><div class="top-title">'+mstrmojo.desc(11411,"Sample Data")+'</div><div class="upper-title"><div class="inner-title">'+mstrmojo.desc(15101,"Existing data")+'</div><div class="inner-title right">'+mstrmojo.desc(8616,"New data")+'</div></div><div class="wide short existing-new"></div></div><div class="div-lower"><div class="top-title">'+mstrmojo.desc(15102,"Different Refresh Policies and Results")+'</div><div class="right-content"><div class="inner-title padding-top">'+mstrmojo.desc(9117,"Replace existing data")+'</div><div class="narrow short replace"></div><div class="inner-title">'+mstrmojo.desc(9118,"Update existing data and add new data")+'</div><div class="narrow tall update-addnew"></div><div class="inner-title">'+mstrmojo.desc(12397,"Update existing data")+'</div><div class="narrow short update"></div/><div class="inner-title">'+mstrmojo.desc(12398,"Add new data")+'</div><div class="narrow tall addnew"></div></div></div></div>';}function B(R){var d=this.parent,a=this.parent.dataGrid.parent,W="di-alt-popup",Q,Z=a.parent.zIndex+10,X={emmaIRRMessageID:mstrApp.getRootController().dataService.emmaIRRMessageID,emmaSingleIsForAlternateSource:true,emmaSingleAlertCfg:{zIndex:Z+1000}},c=mstrApp.getRootController().getModel().getImportSource(R),e=P.xdaType,V=c.xdaType,j=true,f="";if(mstrApp.size){X.size=mstrApp.size;}else{mstrApp.size={};mstrApp.size.h="552px";mstrApp.size.w="1010px";X.size=mstrApp.size;}if(c.type===P.sourceType.file&&c.subtype===P.sourceSubtype.url&&!mstrApp.diParams.EnableURLImport){j=false;f=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}if(c.type===P.sourceType.querybuilder&&c.subtype===P.sourceSubtype.querybuilder&&!mstrApp.diParams.ImportDatabase){j=false;f=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}if(!j){mstrmojo.alert(f,mstrmojo.emptyFn,mstrApp.applicationName(),mstrApp.getRootController().getDialogController().getNextZIndex());return ;}if(V===e.excel||V===e.text){var U=mstrApp.getRootController(),S=U.navigationController.getPageSlot(),Y=false,k=(c.sourceInfo&&c.sourceInfo.sdkUrl)||c.subtype===P.sourceSubtype.cloudElement;S.setConfig({properties:{operationMode:P.operationMode.create,singleURL:true,currentSource:(k?c:undefined),isSchedule:true,onFinishButtonClick:function(){var m;if(this.getURLs){m=this.getURLs()||[];}else{m=[];m.push(this.outputGrid.selectedItem.url);}var l=(m.length===1)?m[0]:"",n={success:function(){var p,o;U.showPage(P.pageType.emmaPreview);p=d.data;if(!p.alternateSource){p.alternateSource={};}o=p.alternateSource;o.tableName=F.getURLFileName(l);d.update();},failure:function(o){if(F.isWS()){U.displayError(null,false,(o&&o.message)||"",null,mstrmojo.desc(14767,"Data from URL"),mstrmojo.desc(15212,"Alternate source cannot be set."));}else{U.displayError(mstrmojo.desc(12837,"Cannot set alternate source."),false,(o&&o.message)||"");}}};if(!l){return ;}U.getScheduleController().selectAlternateSourceURL(R,l,n);Y=true;},onCancelButtonClick:function(){if(Y){var l={success:function(){d.data.alternateSource=null;d.update();},failure:function(m){U.displayError(E(12394,"Cannot delete alternate source."),false,(m&&m.message)||"");}};U.getScheduleController().editEmmaIRRSourceTableSingleTable(R,null,"1",null,null,null,l);}}},footerConfig:{next:{visible:false},back:{visible:false},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false}}});if(c.subtype===P.sourceSubtype.publicData){U.showDialog(P.dialogType.diPageDialog,{slot:S,pageType:P.pageType.publicData,cssClass:"mstrmojo-di-SelectURLAlternateSource-editor"});}else{U.showDialog(P.dialogType.diPageDialog,{slot:S,pageType:P.pageType.file,sourceInfo:1,cssClass:"mstrmojo-di-SelectURLAlternateSource-editor"});}return ;}if(V!==e.qbSingleTable){return ;}Q=mstrmojo.all[W];var g=F.getEnvObj().isServerBasedWS(),h;if(g){X.size={w:1012,h:580};h=a.parent.title;window.FormWrapper&&window.FormWrapper.setTitle&&window.FormWrapper.setTitle(mstrmojo.desc(13048,"Select Alternate Source"));}if(!Q){Q=mstrmojo.insert({scriptClass:"mstrmojo.qb.QBContainer",id:W});mstrmojo.hash.copy(X,Q.QBParams);}a.openPopup({scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(13048,"Select Alternate Source"),cssClass:"mstrmojo-di-SelectAlternateSource-editor",alias:"selectAlternateSourceEditor",showTitle:!g,onPreClose:function b(){this.buttonBox.cancel.onclick();return true;},children:[Q,{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"buttonBox",children:[{scriptClass:"mstrmojo.Button",alias:"finish",text:mstrmojo.desc(1302,"Finish"),cssClass:"mstrmojo-WebButton hot",onclick:function(){var l=this.parent.parent,m=l&&l.opener,n;n={success:function(o){var q,p;q=d.data;if(!q.alternateSource){q.alternateSource={};}p=q.alternateSource;p.tableName=o.tableName;d.update();if(m){m.closePopup();if(g&&window.FormWrapper&&window.FormWrapper.setTitle){window.FormWrapper.setTitle(h);}}}};mstrApp.getRootController().selectAlternateSource(R,n,Z+10);}},{scriptClass:"mstrmojo.Button",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-WebButton",onclick:function(){var n=this.parent.parent,q=n&&n.opener,l,u,p,t,m;l=mstrApp.msgid;u=mstrApp.getRootController().dataService.emmaIRRMessageID;m=mstrApp.hasEditEmmaIRRSource;mstrApp.container.unloadQB();p=mstrApp.getRootController().dataService;mstrApp.messageID=l;if(l){p.set("messageID",l);}if(u){p.set("emmaIRRMessageID",u);}t={success:function(){d.data.alternateSource=null;d.update();if(q){q.closePopup();}},failure:function(o){mstrApp.getRootController().displayError(E(12394,"Cannot delete alternate source."),false,(o&&o.message)||"");}};if(m){mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(R,null,"1",null,null,null,t);}else{if(q){q.closePopup();if(g&&window.FormWrapper&&window.FormWrapper.setTitle){window.FormWrapper.setTitle(h);}}}}}]}]},{zIndex:Z});Q.loadQB();mstrmojo.dom.center(Q.domNode.parentNode.parentNode);mstrApp.hasEditEmmaIRRSource=false;}function H(S){var Q=this.parent.dataGrid,R=function R(Y,U){var X={expr:U,targets:Y.slice(0)},V=function V(d){var f=d.expr;S.filter=f;mstrApp.getRootController().getScheduleController().setEmmaIRRFilter(mstrmojo.fe.FilterUtils.getExprXml(f),{success:function e(){S.updateFilterUsedInTable();Q.refresh();},failure:function(g){mstrApp.getRootController().displayError(E(13099,"Failed to set refresh filter."),false,(g&&g.message)||"");}});},W="irrfe",Z,b=function b(){return true;};Z=W&&window.mstrmojo&&mstrmojo.all[W];if(!Z){var a=function c(d){return Z.IRRAttrForms&&Z.IRRAttrForms[d];};if(mstrApp.isWorkstation){Z=mstrmojo.insert({id:W,scriptClass:"mstrmojo.vi.ui.editors.FilterEditor",showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-vi-ui-FE",getAttributeForms:a});}else{Z=mstrmojo.insert({id:W,scriptClass:"mstrmojo.fe.FilterEditor",showLimits:false,cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-IRRFilter-editor"});Z.walk.getAttributeForms=a;}}Z.IRRAttrForms=S.IRRAttrForms;Z.objectBrowsingEnabled=false;Z.set("title",mstrmojo.desc(12085,"Select a filter"));Z.set("onSave",V);Z.set("model",X);Z.set("disableElementsBrowsing",b);Z.open(null,{zIndex:mstrApp.getRootController().getDialogController().getNextZIndex()});};R(S.IRRAttributes,S.filter||"");}mstrmojo.DI.AlternateSourceMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.AlternateSourceMenu",menuCssClass:"mstrmojo-di-AlternateSourceMenu",tableID:null,menuCfg:null,getMenuConfig:function(){var Q=this.menuCfg;if(!Q){Q=this.menuCfg=new mstrmojo.ui.menus.MenuConfig({menuCssClass:this.menuCssClass});}else{Q.clear();}Q.addMenuItem(E(12393,"Set Source"),"",this.handleSetSource,{tableID:this.tableID,cellWidget:this.cellWidget});Q.addMenuItem(E(12396,"Delete Source"),"",this.handleDeleteSource,{tableID:this.tableID,cellWidget:this.cellWidget});return Q;},handleSetSource:function(R){var Q=R.ctxt;B.call(Q.cellWidget,Q.tableID);return true;},handleDeleteSource:function(S){var Q=S.ctxt,R=Q.tableID,U=Q.cellWidget,V;V={success:function(){U.data.alternateSource=null;U.update();},failure:function(W){mstrApp.getRootController().displayError(E(12394,"Cannot delete alternate source."),false,(W&&W.message)||"");}};mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(R,null,"1",null,null,null,V);return true;}});function A(S,U){var R,Q;if(!S.openPopup){S.openPopup=function(W,V){mstrmojo._HasPopup.openPopup.call(S,W,V);};}if(!S.closePopup){S.closePopup=function(){mstrmojo._HasPopup.closePopup.call(S);};}R=S.menuHelper;if(!R){R=S.menuHelper=new mstrmojo.DI.AlternateSourceMenu();}R.tableID=U.tableID;R.cellWidget=U.cellWidget;Q=R.getMenuConfig();Q.hostId=S.id;Q.hostElement=S.domNode;Q.isHostedWithin=false;S.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:Q}));}mstrmojo.DI.DITableStatusList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DI.DITableStatusList",bHasRefreshCheckbox:true,bHasRefreshPolicy:true,bHasSourceFilter:false,bHasAlternateSource:false,title:null,items:null,importFileFunc:mstrmojo.func.emptyFn,forceFullPublish:true,editorZIndex:null,hasIRR:false,markupString:'<div id="{@id}" class="mstrmojo-di-tablestatuslist {@cssClass}" style="{@cssText}"><div></div><div></div></div>',markupSlots:{titleNode:function(){return this.domNode.children[0];},listNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function(){var Q=this.model;this.update();Q.attachEventListener("PublishStatusUpdate",this.id,"updateStatus");if(this._super){this._super();}},updateStatus:function(Q){var R=this;if(Q&&Q.name){this.set("updateStarted",true);}if(Q&&Q.reset){this.set("updateStarted",false);window.setTimeout(function(){R.checkCanRefresh();},0);}},update:function(Q){var S=this.model,R=[];if(Q&&Q.name){this.set("updateStarted",true);}mstrmojo.hash.forEach(S.importSources,function(U){if(U.checked===undefined){if(S.operationMode===P.operationMode.create||S.operationMode===P.operationMode.edit){U.checked=true;}else{U.checked=false;}if(S.operationMode===P.operationMode.refresh){if(U.canSubscribe()){U.checked=true;}else{U.checked=false;}}}if(U.fileName){U.fileName=mstrmojo.string.encodeHtmlString(U.fileName);}if(U.dbTableName){U.dbTableName=mstrmojo.string.encodeHtmlString(U.dbTableName);}R.push(U);});this.set("items",R);},getFileUploader:function(R){var Q=this.model;var S=null;if(Q.importSources[R]){S=Q.importSources[R].fileUploader;}return S;},checkCanRefresh:function(){var R=mstrApp.getRootController(),Q=this.model,V=Q.operationMode,U=Q.getAllTableID(),W=true,S=0;if(V===P.operationMode.refresh){J.forEach(U,function(Y){var X=Q.getImportSource(Y);if(X.checked){S++;if(X.type===P.sourceType.file){if(X.subtype===P.sourceSubtype.clipboard||X.subtype===P.sourceSubtype.localFile){if(!X.hasSelectFile){W=false;}}}}});if(S===0){W=false;}}if(V===P.operationMode.edit){J.forEach(U,function(Z){var Y=Q.getImportSource(Z),X=false;if(Y.type===P.sourceType.file){if(Y.subtype===P.sourceSubtype.clipboard||Y.subtype===P.sourceSubtype.localFile){if(!Q.isCubePublished||!Q.rawDataExistsInAE){X=!Y.hasRefreshedData;}else{X=!Y.isAll&&Y.executeAction===P.tableStatsExecutionAction.forceExecution&&!Y.hasRefreshedData;}if(X&&!Y.hasSelectFile){W=false;}}}});}R.raiseModelEvent({name:O,value:W});return W;},checkCanChange:function(){var Q=this.model,U=Q.operationMode,R=Q.getAllTableID(),S=false;if(U===P.operationMode.refresh){S=true;}if(U===P.operationMode.edit){if(!Q.isCubePublished||!Q.rawDataExistsInAE){S=false;}else{J.forEach(R,function(X){var W=Q.getImportSource(X),V;V=W.hasRefreshedData&&(!W.forceRepublish||!W.schemaChanged);if(V){S=true;}});}}return S;},children:[{slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",bindings:{text:"this.parent.title",visible:"this.parent.title"}},{slot:"listNode",alias:"list",scriptClass:"mstrmojo.DataGrid",cssClass:"mstrmojo-di-tablestatuslist-list",lockHeader:true,bindings:{items:"this.parent.items",forceFullPublish:"this.parent.forceFullPublish",updateStarted:"this.parent.updateStarted"},columns:[],listSelector:null,resizableColumns:true,onitemsChange:function(){if(this._super){this._super();}var U=this.parent.bHasRefreshCheckbox,V=this.parent.bHasRefreshPolicy,S=this.parent.bHasSourceFilter,X=this.parent.bHasAlternateSource,R=[],W={refreshBox:"28",refreshPolicy:"256"};if(U){R.push({headerWidget:{scriptClass:"mstrmojo.TristateCheckBox",cssClass:"tristate tablestatus-header refresh",grayed:false,checked:false,eventSubs:null,tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var f;if(this.tooltipContent){f=G.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(f.y-3,0),left:Math.max(f.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var g={},f=g[this.id]={};f.scheduleCheckedChange=this.updateStatus;f.refreshCheckedChange=this.updateStatus;f.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(g);}this.updateStatus();},onUnRender:function b(){if(this.eventSubs){mstrApp.getRootController().detachDataChangeListeners(this.eventSubs);this.eventSubs=null;}if(this._super){this._super();}},updatePublishStatus:function Y(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}},updateStatus:function a(){if(!this.visible){return ;}var k=this,n=0,f=0,g,o,m=true,j=false,l=k.dataGrid.parent.model,h=l.operationMode;if(h===P.operationMode.create||h===P.operationMode.edit){k.dataGrid.parent.checkCanRefresh();this.set("visible",false);return ;}J.forEach(k.dataGrid.items,function(p){if(!p.isAll){if(p.checked){f++;}n++;}});if(!f){g=false;o=false;}else{if(f<n){g=true;o=true;}else{g=false;o=true;j=true;}}if(h===P.operationMode.refresh){m=!k.dataGrid.forceFullPublish;if(!m){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}}l.checked=j;this.set("grayed",g);this.set("checked",o);this.set("enabled",m);this.set("origEnabled",m);if(h===P.operationMode.subscribe){mstrApp.getRootController().raiseModelEvent({name:K,value:f>0});}if(h===P.operationMode.refresh){k.dataGrid.parent.checkCanRefresh();}},onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}var n=this,g=n.dataGrid.parent.model.operationMode,t=[],f=[],j=this.checked,h=n.dataGrid.parent.hasIRR,l=mstrApp.getRootController(),o=l.getScheduleController(),m=n.dataGrid.parent.model,k=m.cubeID,q=n.dataGrid.items,p=false;m.checked=!this.grayed&&this.checked;if(g===P.operationMode.refresh||g===P.operationMode.subscribe){J.forEach(q,function(u){if(!u.isAll&&u.checked!==j){if(j&&g===P.operationMode.subscribe&&!u.canSubscribe()){return true;}if(g===P.operationMode.refresh&&u.forceRepublish){n.set("grayed, true");return true;}t.push(u.tableID);f.push(u.refreshType.toString());u.checked=j;}});if(t.length>0){l.raiseModelEvent({name:"allCheckedChange"});if(h){if(j){o.createEmmaIRRSourceTables(k,t,f);}else{o.deleteEmmaIRRSourceTable(t);}}}if(g===P.operationMode.subscribe){J.forEach(q,function(u){if(u.checked){p=true;return false;}});l.raiseModelEvent({name:K,value:p});}if(g===P.operationMode.refresh){n.dataGrid.parent.checkCanRefresh();}}}},colWidth:W.refreshBox,dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col refreshBox",colWidth:W.refreshBox,children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"refreshCheckbox",cssDisplay:"table",colWidth:W.refreshBox,visible:false,text:"",tooltipOpenDelay:0,useRichTooltip:true,preBuildRendering:function(){var f=this.parent.dataGrid,g=f.parent.model,j=this.parent.data,h;this.update();this.subEvts=[];h=g.attachEventListener("allCheckedChange",this.id,"updateCheck");this.subEvts.push(h);if(!j.isAll){this.dataEvt=j.attachEventListener("checkedChange",this.id,"updateCheck");}h=g.attachEventListener("PublishStatusUpdate",this.id,"updatePublishStatus");this.subEvts.push(h);},onUnRender:function(){var f=this.parent.dataGrid,h=this.parent.data,g=f.parent.model;J.forEach(this.subEvts,function(j){g.detachEventListener(j);});if(this.dataEvt){h.detachEventListener(this.dataEvt);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}},updateTooltipConfig:function(){var f;if(this.tooltipContent){f=G.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(f.y-3,0),left:Math.max(f.x-7,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});}},update:function(){var k=this.parent,j=this.parent.data,h=k.dataGrid.parent.model.operationMode,f=true,g=false;if(j.isAll){return false;}if(h===P.operationMode.refresh){f=!k.dataGrid.forceFullPublish&&!j.forceRepublish;g=k.dataGrid.forceFullPublish||k.data.checked===true||j.forceRepublish;if(!f){if(k.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13960,"Cube doesnot exist in memory so all tables must be republished."));}else{if(j.forceRepublish){this.set("tooltipContent",mstrmojo.desc(13969,"The edit operations require the following table to be refreshed."));}}}}else{if(h===P.operationMode.subscribe){f=k.data.canSubscribe();g=k.data.checked;if(!f){this.set("tooltipContent",mstrmojo.desc(15864,"No scheduling support for this data source"));}}}this.set("enabled",f);this.set("origEnabled",f);this.set("checked",g);},updateCheck:function(){var f=this.parent.data;this.set("checked",!!f.checked);},oncheckedChange:function(){var o=this.parent,q=o.dataGrid.parent.model,n=mstrApp.getRootController(),p=n.getScheduleController(),t,m,k=q.cubeID,l=o.data,u,j=this.checked,h=o.dataGrid.parent.hasIRR,g=q.operationMode;if(l.checked===j){if(q.operationMode===P.operationMode.refresh){n.raiseModelEvent({name:"refreshCheckedChange",data:l});}return ;}if(!l.isAll){if(j&&g===P.operationMode.subscribe&&!l.canSubscribe()){return ;}l.set("checked",j);}if(q.operationMode===P.operationMode.refresh){n.raiseModelEvent({name:"refreshCheckedChange",data:l});}if(q.operationMode===P.operationMode.subscribe){n.raiseModelEvent({name:"scheduleCheckedChange"});t=l.tableID;if(!h){return ;}if(j){m=l.refreshType.toString();u={failure:function f(w){n.displayError(E(12395,"Cannot create source table."),false,(w&&w.message)||"");}};p.createEmmaIRRSourceTables(k,[t],[m],u);}else{u={failure:function f(w){n.displayError(E(12394,"Cannot delete source table."),false,(w&&w.message)||"");}};p.deleteEmmaIRRSourceTable([t],u);}}}},{scriptClass:"mstrmojo.Label",cssClass:"refreshBox-status",visible:false,preBuildRendering:function(){var f=this.parent.dataGrid.parent.model;this.update();this.subEvt=f.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var f=this.parent.dataGrid.parent.model;if(this.subEvt){f.detachEventListener(this.subEvt);}},update:function(){var j=this.parent.data,h=this.parent.dataGrid.parent.updateStarted,g=j&&j.status,k="",f="tablestatus-col status";if(g==="4"||g==="6"){k=j.errmsg||"";}if(I[g]){f=I[g];}else{if(h){f=I[0];}}this.set("title",k);this.set("cssClass",f);if(this.domNode){this.domNode.className=f;}}}],preBuildRendering:function(){var f=this.dataGrid.parent.model;this.update();this.subEvt=f.attachEventListener("PublishStatusUpdate",this.id,"update");},onUnRender:function(){var f=this.dataGrid.parent.model;if(this.subEvt){f.detachEventListener(this.subEvt);}},update:function(g){var h=null,j=this.dataGrid.parent.model.operationMode,f=this.dataGrid.parent.updateStarted,k=this.data;if(g&&g.reset){f=false;}if(k.isAll){h=null;}else{h=this.children[0];if(j!==P.operationMode.subscribe&&k.checked){if((f&&k.published)||j!==P.operationMode.refresh){h=this.children[1];}}}this.set("selected",h);}}});}R.push({headerText:mstrmojo.desc(12949,"Data Source"),headerCss:"tablestatus-header label",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-col tableNameBox cf",preBuildRendering:function(){var f=this.dataGrid.parent.model,g=f.operationMode;if(g===P.operationMode.refresh){f.attachEventListener("refreshCheckedChange",this.id,"update");}if(g===P.operationMode.subscribe){if(!this.data.isAll&&!this.data.canSubscribe()){this.children[0].set("enabled",false);}}this.update();},update:function(){var l=this.data,j=l.checked,f=this.dataGrid.parent.model,g=l.hasSelectFile,k=this.children[0],h=k&&k.domNode,m=false;if(f.operationMode===P.operationMode.refresh){m=j;}if(f.operationMode===P.operationMode.edit){if(!f.isCubePublished||!f.rawDataExistsInAE){m=!l.hasRefreshedData;}else{m=!l.isAll&&l.executeAction===P.tableStatsExecutionAction.forceExecution&&!l.hasRefreshedData;}}if(h){L.toggleClass(h,"selected",j);L.toggleClass(h,"hasSelectFile",g||!m);}else{if(j){L.addWidgetCssClass(k,"selected");}else{L.removeWidgetCssClass(k,"selected");}if(g||!m){L.addWidgetCssClass(k,"hasSelectFile");}else{L.removeWidgetCssClass(k,"hasSelectFile");}}this.children[1].set("visible",m);},children:[{scriptClass:"mstrmojo.Label",useRichTooltip:true,updateTooltipConfig:function(){var f;if(this.title){f=G.position(this.domNode);if(mstrApp.isWorkstation){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C vi-refresh-smallWindow",top:f.y-8,left:f.x+f.w+8,posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title,enableHover:true});}else{this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-A",top:Math.max(f.y+f.h+2,0),left:Math.max(f.x+2,0),posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.title});}}},resetText:function(){var g=this.parent.data,f="";if(g.sourceInfo){f=g.sourceInfo.dbTableName||g.sourceInfo.name;}this.set("text",f);},bindings:{title:function(){var f=this.parent.data,g=f.getDataSourceDescription();return g;},cssClass:function(){var h=this.parent.data,g=this.parent.dataGrid.parent.model,f="tableNameBox-name";if(h.type===P.sourceType.file&&g.operationMode!==P.operationMode.create){if(h.subtype===P.sourceSubtype.localFile||h.subtype===P.sourceSubtype.clipboard){f+=" hasBrowse";}}return f;},text:function(){var g=this.parent.data,f="";if(g.sourceInfo){f=g.sourceInfo.dbTableName||g.sourceInfo.name;}return f;}}},{scriptClass:"mstrmojo.StackContainer",renderMode:"notonShow",markupMethods:mstrmojo.hash.copy({onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},mstrmojo.StackContainer.prototype.markupMethods),cssClass:"tableNameBox-stack",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"tableNameBox-stack-edit",visible:false,text:mstrmojo.desc(1088,"Edit"),onclick:function(){mstrApp.getRootController().showDialog(P.dialogType.diPageDialog,{tableID:this.parent.parent.data.tableID,left:"200px",top:"115px",cssClass:"mstrmojo-di-refresh-data-editor"});}},{scriptClass:"mstrmojo.FileUploadBox",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,uploadTaskId:"importFile",action:mstrConfig.taskURL,fileFieldName:"myFile",initValue:false,browseLabel:mstrmojo.desc(1825,"Browse"),accept:".xls,.xlsx,.csv,.txt,.tsv,.prn,.json,.sas7bdat",onvalueChange:function(){var g=this.parent.parent.data,h=(this.value!==""),f=this.parent.parent.dataGrid;g.hasSelectFile=h;g.fileUploader=this;if(h){g.set("checked",true);}this.parent.parent.update();if(h){this.parent.parent.children[0].set("text",this.getFileName());}else{this.parent.parent.children[0].resetText();}f.parent.checkCanRefresh();},getFileName:function(){var f;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){f=this.fileNode.files.length>0&&this.fileNode.files[0].name;}else{f=this.value;}return f;},getFileSize:function(){var f=0;if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)&&this.fileNode.files){f=this.fileNode.files.length>0&&this.fileNode.files[0].size;}else{try{var j=new ActiveXObject("Scripting.FileSystemObject");var g=j.getFile(this.fileNode.value);if(g){f=g.Size;}}catch(h){}}return f;},submit:function(f,w,q){function g(h){var p={code:0,message:mstrmojo.desc(12814,"Cannot read file content")};if(w.failure){w.failure(h||p);}if(w.complete){w.complete();}}function l(){var h,p;f.fileName=k;f.index++;h=Math.min(t.size,n+M);p=t.slice(n,h);if(f.index===f.numberOfChunks){mstrApp.upload(w,f,p,q);}else{mstrApp.upload({success:function(){n=n+M;l();},failure:function(x){g(x);}},f,p,q);}}var j=true;var t,k,o,n;if(this.onsubmit){j=this.onsubmit();}if(j){f=f||{};f.fileFieldName=this.fileFieldName;f.taskId=this.uploadTaskId;f.jsonp=this.jsonp.replace("{@id}",this.id);if(mstrmojo.dom.supports(mstrmojo.dom.htmlFeatures.FILE_READER)){q=mstrmojo.hash.copy(q,{async:true});t=this.fileNode.files[0];k=t.name;if(this.params){f=this.params;}if(t.size>M){o=Math.ceil(t.size/M);n=0;f.index=0;f.numberOfChunks=o;f.chunkSize=M;f.fileName=this.fileNode.files[0].name;f.fileSize=t.size;f.fileType="application/octet-stream";mstrApp.showProgress(q);mstrApp.upload({success:function(){l();},failure:function(h){g(h);}},f,null,q);}else{f.fileName=this.fileNode.files[0].name;mstrApp.upload(w,f,t.slice(0,t.size),q);}}else{f.taskEnv="jsonp2";f.fileName=this.value;var u=[],m;for(m in f){u.push('<input type="hidden" name="'+m+'" value="'+mstrmojo.string.encodeHtmlString(f[m])+'"/>');}if(this.params){f=this.params;for(m in f){u.push('<input type="hidden" name="'+m+'" value="'+mstrmojo.string.encodeHtmlString(f[m])+'"/>');}}this.paramsNode.innerHTML=u.join("");if(w){this.onSuccess=w.success;this.onFailed=w.failure;}this.formNode.submit();}this.set("status","loading");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,text:mstrmojo.desc(13052,"Upload"),replaceOneTierFile:function(j){var h=this.parent.parent.data,g=this.parent.parent.dataGrid;var l=0,n;if(!j){return ;}var m=j.split("*"),k,f=[];for(l=0;l<m.length;l++){k=m[l];f.push(k);n=k.lastIndexOf("\\");if(n===-1){n=k.lastIndexOf("/");}h.hasSelectFile=true;h.files=[];h.files.push(f[0]);this.parent.parent.children[0].set("text",f[0].substr(n+1));this.parent.parent.update();g.parent.checkCanRefresh();}},onclick:function(){var j=mstrApp.getRootController(),h=this.parent.parent.data,f=this.parent.parent.dataGrid,n=j.navigationController.getPageSlot(),g=P.pageType.dataSelection,l=null,k=this.parent.parent,m={next:{visible:true,text:mstrmojo.desc(13052,"Upload")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};switch(h.type){case P.sourceType.file:if(h.subtype===P.sourceSubtype.clipboard){n.setConfig({footerConfig:m,properties:{operationMode:P.operationMode.refresh,tableID:h.tableID,currentSource:h,onNextButtonClick:function(){j.showPage(P.pageType.emmaPreview);h.hasSelectFile=true;h.fileUploader=this;k.update();f.parent.checkCanRefresh();}}});this.pageSlot=n;g=P.pageType.clipboard;l=0;j.showDialog(P.dialogType.diPageDialog,{pageType:g,sourceInfo:l,slot:n});}else{if(h.subtype===P.sourceSubtype.localFile){mstrmojo.DI.DITableStatusList.selectedUploader=this.id;j.launchOneTierBrowser("mstrmojo.DI.DITableStatusList.OneTierFiles");}}break;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",visible:false,text:mstrmojo.desc(14287,"Input Credentials"),onclick:function(){var g=this.parent.parent.data,f=g.did,j=[f],l=mstrApp.getRootController(),k=mstrApp.getRootController().getModel(),n=g.type,m=g.subtype,o=N.isOAuthSourceType(n);if(m===P.sourceSubtype.cloudElement){this.addDisposable(new mstrmojo.DI.DIURLUpload({isFromCloudElement:true,model:k,sourceInfo:k.importSources[g.tableID].sourceInfo,tableID:g.tableID}));}else{if(o){if(!(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier||F.isServerBasedWS())){mstrmojo.alert(mstrmojo.desc(15600,"We are unable to connect to this data source because your web server is not set up for HTTPS connections. Please contact your administrator."));return ;}k.set("isInputCredential",true);l.setTableIDsForOAuth(j);l.gotoOAuthLogin(n);}else{var h=g.dbRole.dbmsObj;if(h.DBInfo.driverInstalled){this.addDisposable(new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:g,zIndex:l.getDialogController().getNextZIndex()})).open();}else{mstrmojo.alert(mstrmojo.desc(14328,"There is no driver installed for ##. Please install it and try again.").replace("##",h.n));}}}}}],preBuildRendering:function(){var l=this.parent.data,g=this.parent.dataGrid.parent.model,h=l.type,f=N.isOAuthSourceType(h),j=null;switch(h){case P.sourceType.file:if(l.subtype===P.sourceSubtype.clipboard){j=this.children[2];}else{if(l.subtype===P.sourceSubtype.localFile){if(mstrApp.isSingleTier){j=this.children[2];}else{j=this.children[1];}}}break;default:j=null;if(g.missingCredentialsData){var k=this;mstrmojo.array.forEach(g.missingCredentialsData.datasets[0].tables,function(m){if(m.did===l.tableID){if(m.dbRole){l.dbRole=m.dbRole;}if(!f&&!m.dbRole){return false;}j=k.children[3];return false;}});}break;}if(j){this.set("selected",j);}this.subEvt=g.attachEventListener("PublishStatusUpdate",this.id,"update");if(this._super){this._super();}},onUnRender:function(){var f=this.parent.dataGrid.parent.model;if(this.subEvt){f.detachEventListener(this.subEvt);}},update:function(f){if(f&&f.name&&this.selected){this.selected.set("enabled",false);}if(f&&f.reset&&this.selected){this.selected.set("enabled",true);this.parent.update();}if(f&&f.reset&&f.errors){switch(f.errors[this.parent.data.tableID]){case P.backendError.noExternalSession:case P.backendError.databaseCredentialsNotAvailable:case P.backendError.CECredentialNotAvailable:this.selected=this.children[3];this.selected.set("visible",true);this.parent.update();break;case P.backendError.AuthenticationError:if(this.parent.data.subtype===P.sourceSubtype.cloudElement){this.selected=this.children[3];this.selected.set("visible",true);this.parent.update();}break;case P.backendError.switchingFileType:if(this.selected){this.selected.set("enabled",true);this.parent.update();}break;}}}}]}});if(V){var e={popupZIndex:9999,popupToBody:true,isHostedWithin:false,colWidth:"230",visible:false,items:[],tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var f;f=G.position(this.domNode);this.set("richTooltip",{keepArrowXPos:true,cssClass:"vi-regular vi-tooltip-V",top:Math.max(f.y-3,0),left:Math.max(f.x,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.tooltipContent});},postCreate:function d(){var k=this.parent.data,l=this.parent,g=true,h=this.parent.dataGrid.parent.model.operationMode,f=[{n:E(9117,"Replace existing data"),dssid:P.cubeRefreshType.replaceTable},{n:E(9118,"Update existing data and add new data"),dssid:P.cubeRefreshType.upsert},{n:E(12397,"Update existing data"),dssid:P.cubeRefreshType.update},{n:E(12398,"Add new data"),dssid:P.cubeRefreshType.add}];if(k.isAll){if(h===P.operationMode.subscribe){k.model.set("refreshType",P.cubeRefreshType.replaceTable);}f.push({n:"",dssid:P.cubeRefreshType.dummy});this.parent.set("visible",false);}else{if(h===P.operationMode.edit){if(l.dataGrid.forceFullPublish){g=false;}else{g=(!k.forceRepublish||!k.schemaChanged)&&k.hasRefreshedData;}this.set("enabled",g);if(!g){this.set("tooltipContent",mstrmojo.desc(13970,'The edit operations require the refresh policy to be "Replace existing data".'));}}if(h===P.operationMode.refresh){g=!l.dataGrid.forceFullPublish&&(!k.forceRepublish||!k.schemaChanged);this.set("enabled",g);if(!this.enabled){if(l.dataGrid.forceFullPublish){this.set("tooltipContent",mstrmojo.desc(13971,'Cube doesnot exist in memory so the refresh policy has to be "Replace existing data".'));}else{this.set("tooltipContent",mstrmojo.desc(13972,'The edit operations require the refresh policy to be "Replace existing data".'));}}}if(h===P.operationMode.subscribe){k.set("refreshType",P.cubeRefreshType.replaceTable);g=k.canSubscribe();this.set("enabled",g);if(!g){this.set("tooltipContent",mstrmojo.desc(15864,"No scheduling support for this data source"));}}}this.set("origEnabled",this.enabled);this.set("items",f);var j=this.parent.data.isAll?this.parent.data.model.refreshType:this.parent.data.refreshType;this.initValue(j);},updateStatus:function a(){var k=this.parent,j=k.data,g=null,h=j.model.refreshType,f=true;J.forEach(k.dataGrid.items,function(l){if(!l.isAll){if(l.refreshType!==g){if(g===null){g=l.refreshType;}else{f=false;return false;}}}return true;});if(!f){g=P.cubeRefreshType.dummy;}if(g!==null&&g!==h){j.model.set("refreshType",g);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}},preBuildRendering:function Z(){var g,f;if(this._super){this._super();}if(!this.parent.data.isAll){if(!this.eventSubs){g={};f=g[this.id]={};f.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(g);}return ;}if(!this.eventSubs){g={};f=g[this.id]={};f.scheduleRefreshTypeChange=this.updateStatus;f.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(g);}this.updateStatus();},onUnRender:function b(){if(this.eventSubs){mstrApp.getRootController().detachDataChangeListeners(this.eventSubs);this.eventSubs=null;}if(this._super){this._super();}},updateRefreshType:function(m){var n=mstrApp.getRootController(),p=n.getScheduleController(),q,u,l=this.parent.data,h,o=this.parent,t=[],f=[],k=o.dataGrid.parent.hasIRR,j=o.dataGrid.parent.model.operationMode;u={failure:function g(w){n.displayError(mstrmojo.desc(13054,"Cannot edit source table."),false,(w&&w.message)||"");}};if(l.isAll){h=l.model.refreshType;if(m===h){return ;}l.model.refreshType=m;if(m===P.cubeRefreshType.dummy){return ;}J.forEach(o.dataGrid.items,function(w){if(!w.isAll&&w.refreshType!==m){if(w.checked){t.push(w.tableID);f.push(m.toString());}w.set("refreshType",m);}});if(j===P.operationMode.subscribe&&t.length>0&&k){p.editEmmaIRRSourceTableRefreshTypes(t,f,null,u);}return ;}h=l.refreshType;if(m===h){return ;}l.refreshType=m;n.raiseModelEvent({name:"scheduleRefreshTypeChange"});if(!(k&&l.checked&&h!==m)){return ;}q=l.tableID;p.editEmmaIRRSourceTableURL(q,m.toString(),null,null,u);}};if(F.isWS()&&(F.getOperationMode()===P.operationMode.refresh||F.getOperationMode()===P.operationMode.subscribe)){D.copy({scriptClass:"mstrmojo.ui.Pulldown",onSelectedItemChange:function(f){this.updateRefreshType(f.dssid);},initValue:function(h){var f=J.find(this.items,"dssid",h);this.set("selectedIndex",(f<0)?0:f);var g=this;var j=g.parent.dataGrid.parent.editorZIndex;if(j!==null){setTimeout(function(){var k=g[g.anchorSlot];k.style.zIndex=j;});}}},e);}else{D.copy({scriptClass:"mstrmojo.Pulldown",onvalueChange:function(){var f=J.find(this.items,this.itemIdField,this.value);if(f<0){this.selectedIndex=0;}var g=this.items[this.selectedIndex].dssid;this.updateRefreshType(g);},initValue:function(f){this.set("value",f);},premousedown:function c(f){if(this.enabled){mstrmojo.Pulldown.prototype.premousedown.call(this,f);}}},e);}var Q={headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-header pulldown",children:[{scriptClass:"mstrmojo.Label",cssClass:"refresh-policy-label",text:mstrmojo.desc(13053,"Refresh Policy")},{scriptClass:"mstrmojo.Image",alias:"tooltipImage",cssClass:"refresh-policy-icon",useRichTooltip:true,tooltipOpenDelay:0,updateTooltipConfig:function(){var f=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular vi-taller vi-tooltip-A vi-tooltip-leftcenter",posType:mstrmojo.tooltip.POS_TOPLEFT,content:C(),top:f.y+25,left:f.x-95,enableHover:true};},bindings:{visible:function(){return F.isWS()&&(this.parent.dataGrid.parent.model.operationMode===P.operationMode.refresh||this.parent.dataGrid.parent.model.operationMode===P.operationMode.subscribe);}}}]},colWidth:W.refreshPolicy,dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col stack pulldown",colWidth:"65",children:[e,{scriptClass:"mstrmojo.Label",colWidth:"100",visible:false,bindings:{text:function(){var f="";var g=this.parent.data.xdaType;switch(g){case P.xdaType.excel:case P.xdaType.text:f=mstrmojo.desc(13056,"No scheduling support for local files");break;default:f=mstrmojo.desc(15864,"No scheduling support for this data source");break;}return f;}}}],preBuildRendering:function(){this.set("selected",this.children[0]);if(this._super){this._super();}}}};R.push(Q);}if(S){R.push({headerWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-header sourceFilter cf",preBuildRendering:function(){var h=this.dataGrid.parent.model,g=false,f=false;D.forEach(h.isFilterInTable,function(j){if(j){g=true;return false;}});if(g){this.children[0].set("text",mstrmojo.desc(13275,"Edit Refresh Filter"));}else{this.children[0].set("text",mstrmojo.desc(13276,"Set Refresh Filter"));}this.children[1].set("visible",g);D.forEach(this.dataGrid.items,function(j){if(j.xdaType===P.xdaType.qbSingleTable){f=true;return false;}});this.children[0].set("enabled",f);},children:[{scriptClass:"mstrmojo.Label",cssClass:"filterLink",onclick:function(){H.call(this,this.parent.dataGrid.parent.model);},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var g={},f=g[this.id]={};f.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(g);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}}},{scriptClass:"mstrmojo.Button",cssClass:"deleteFilter",onclick:function(){var f=this.parent.dataGrid,g=f.parent.model;g.filter="";mstrApp.getRootController().getScheduleController().setEmmaIRRFilter(mstrmojo.fe.FilterUtils.getExprXml(""),{success:function h(){g.updateFilterUsedInTable();f.refresh();},failure:function(j){mstrApp.getRootController().displayError(E(13099,"Failed to set refresh filter."),false,(j&&j.message)||"");}});},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var f={},g=f[this.id]={};g.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(f);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}}}]},dataWidget:{scriptClass:"mstrmojo.StackContainer",cssClass:"tablestatus-col sourceFilterBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"sourceFilterButton",visible:false,bindings:{enabled:function(){var f=this.parent.data;return f.model&&f.model.IRRAttributes&&f.model.IRRAttributes.length>0;}},text:E(12400,"Set Filter"),onclick:function(){H.call(this,this.parent.data.model);}},{scriptClass:"mstrmojo.Label",cssClass:"sourceFilterLabel",visible:false,bindings:{text:function(){var h,g=this.parent.data,f=this.parent.dataGrid.parent.model;if(g.xdaType===P.xdaType.qbSingleTable){h=(f.isFilterInTable&&f.isFilterInTable[g.tableID])?E(14215,"Set"):E(12402,"Not Set");}else{h=mstrmojo.desc(6098,"N/A");}return h;},enabled:function(){return(this.parent.data.xdaType===P.xdaType.qbSingleTable);}}}],preBuildRendering:function(){var f;if(this.data.isAll){f=this.children[0];}else{f=this.children[1];}this.set("selected",f);if(this._super){this._super();}}}});}if(X){R.push({headerText:E(12401,"Alternate Source"),headerCss:"tablestatus-header alternateSource",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"tablestatus-col alternateSourceBox cf",preBuildRendering:function(){this.update();},update:function(){var l=this.data,h=l.canSetAlternateSource(),g,k=l.alternateSource,f=this.children[0],m;if(k){g=mstrmojo.desc(13277,"Edit Source");m=k.tableName;if(l.subtype===P.sourceSubtype.cloudElement){var j=k.tableName&&k.tableName.split(";");m=j&&j[0].replace("TABLENAME={","").replace(new RegExp("}$"),"");}f.set("title",m);}else{g=mstrmojo.desc(12393,"Set Source");f.set("title","");}g=h?g:mstrmojo.desc(6098,"N/A");f.set("text",g);this.children[1].set("visible",!!k);},children:[{scriptClass:"mstrmojo.Label",cssClass:"tablestatus-col alternateSource active",onclick:function(){var f=this.parent.data;if(!(f.checked&&mstrApp.getRootController().getScheduleController().isAdvMode())){return ;}B.call(this,f.tableID);},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var g={},f=g[this.id]={};f.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(g);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}},bindings:{enabled:function(){return this.parent.data.canSetAlternateSource();}}},{scriptClass:"mstrmojo.Button",cssClass:"deleteAltersource",onclick:function(){var g=this.parent,f=this.parent.data.tableID,h={success:function(){g.data.alternateSource=null;g.update();},failure:function(j){mstrApp.getRootController().displayError(E(12394,"Cannot delete alternate source."),false,(j&&j.message)||"");}};mstrApp.rootController.getScheduleController().editEmmaIRRSourceTableSingleTable(f,null,"1",null,null,null,h);},preBuildRendering:function(){this.evts=[];if(!this.eventSubs){var f={},g=f[this.id]={};g.PublishStatusUpdate=this.updatePublishStatus;this.eventSubs=mstrApp.getRootController().attachDataChangeListeners(f);}},updatePublishStatus:function(f){if(f&&f.name){this.set("enabled",false);}if(f&&f.reset){this.set("enabled",this.origEnabled);}}}]}});}if(this.hasRendered){this.unrender();this.columns=R;this.render();}else{this.columns=R;}}}]});mstrmojo.DI.DITableStatusList.OneTierFiles=function(R){var Q=mstrmojo.all[mstrmojo.DI.DITableStatusList.selectedUploader];Q.replaceOneTierFile(R);};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.Image","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.tooltip","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIModel","mstrmojo.DI.DITableStatusList","mstrmojo.locales","mstrmojo.date","mstrmojo.ProgressBar","mstrmojo.DI.DNTextBox","mstrmojo.css","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(221,773,1302,4311,4364,4996,8473,10160,12761,12509,12762,12763,12764,12765,12766,12767,12769,13005,13028,13029,2502,13257,9242,13274,13444,13882,15071,15072,15077,3464,5923,10639,10159,9705,9704,9380,15095,15096,15097,15098,15099,15100,15101,15102,15103,15104,15105,15205,15206,16017);var W=mstrmojo.array,R=mstrmojo.hash,A=mstrmojo.DI.DIHelpers,L=mstrmojo.string,Z=mstrmojo.DI.DIConstants,M="canSaveSchedule",E="canStartRefresh",D=mstrmojo.desc(13882,"Please upload the data or unselect the source in order to enable this option."),S={onLabel:6,wtime:2,mday:4},V=mstrmojo.css,I=0,G=1,K=2,Y=3,X={subscribe:"526px",subscribeChecked:"846px",refresh:"530px"};function H(a){this.set("onLabel",a&S.onLabel);this.set("wtime",a&S.wtime);this.set("mtime",a&S.mday);}function O(){var a=this.parent;switch(a.selectTimePulldown.stp){case"Daily":return mstrmojo.desc(10639,"Daily")+" "+a.time.items[a.time.selectedIndex].v;case"Weekday":return mstrmojo.desc(10159,"Weekday")+" "+a.time.items[a.time.selectedIndex].v;case"Weekly":return mstrmojo.desc(9705,"Weekly")+" "+a.wtime.items[a.wtime.selectedIndex].n+" "+a.time.items[a.time.selectedIndex].v;case"Monthly":return mstrmojo.desc(9704,"Monthly")+" "+a.mday.items[a.mday.selectedIndex].v+" "+a.time.items[a.time.selectedIndex].v;default:return a.selectTimePulldown.stp;}}function N(){var b=this.parent,a=b.selectTimePulldown.stp;switch(a){case"Daily":return a+" "+b.time.selectedIndex;case"Weekday":return a+" "+b.time.selectedIndex;case"Weekly":return a+" "+b.wtime.selectedIndex+" "+b.time.selectedIndex;case"Monthly":return a+" "+b.mday.selectedIndex+" "+b.time.selectedIndex;default:return a;}}function J(){var e=this.parent.parent.parent.model,h=e&&e.getSchedule(),c=this.parent.parent.chooseSchedPulldown.hasCustomSchedule,g=new Date();if(c){var f=O.call(this),a=N.call(this);h.set("trgName",f);h.set("curTrg",{n:f,id:a,isHidden:true});if(!h.subsID){var b=e.cubeName+" "+h.trgName+" "+g.toLocaleString();this.parent.parent.parent.secondBox.nameBox.set("sugName",b);h.set("subsName",b);}}}function Q(a){a.raiseEvent({name:"EditorResized"});}function C(a){var b=false;mstrmojo.hash.forEach(a.importSources,function(c){if(!c.checked){if(c.refreshType!==Z.cubeRefreshType.preserve){c.refreshType=Z.cubeRefreshType.preserve;}}else{if(c.checked){if(c.refreshType===Z.cubeRefreshType.preserve){if(c.origRefreshType!==Z.cubeRefreshType.preserve){c.refreshType=c.origRefreshType;}else{c.refreshType=Z.cubeRefreshType.replaceTable;}}if(c.xdaType===Z.xdaType.excel||c.xdaType===Z.xdaType.text){if(c.sourceInfo.url===""&&!c.hasSelectFile){c.refreshType=Z.cubeRefreshType.preserve;}}}}if(c.checked&&c.refreshType!==c.origRefreshType){b=true;return false;}});return b;}function P(b){var d={".xls":1,".xlsx":1,".txt":2,".csv":2};var c,k,g,j,f,h,e,a;for(e in b){a=b[e];if(!a.fileUploader||!a.sourceInfo){continue;}c=a.sourceInfo.dbTableName;j=a.fileUploader.value;if(!c||!j){continue;}g=c.lastIndexOf(".");h=j.lastIndexOf(".");if(g===-1||h===-1){continue;}k=c.substr(g);f=j.substr(h);if(d[k]&&d[f]&&d[k]!==d[f]){return true;}}return false;}mstrmojo.DI.DIRepublishScheduleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIRepublishScheduleEditor",cssClass:"mstrmojo-di-scheduleEMMA",title:"",allowHTMLTitle:true,simpleProgressMode:false,showTimeWarningMsg:false,width:"650px",height:"",canSaveScheduleJudgedByNameBox:false,canRefreshJudgedByTableStatusList:true,useRichTooltip:false,resetOKButtonText:function(){var b=this.model;var a=mstrmojo.desc(1302,"Finish");if(b.operationMode===Z.operationMode.refresh){a=mstrmojo.desc(773,"Refresh");}if(b.operationMode===Z.operationMode.subscribe){a=mstrmojo.desc(1085,"Schedule");}this.okButton.set("text",a);},onOpen:function(){var a=mstrApp.getRootController().model,c=this.model,e=false,b=false,g,f,d;if(this.opened){return ;}this.opened=true;if(this.subEvt){c.detachEventListener(this.subEvt);}this.resetOKButtonText();if(c.operationMode===Z.operationMode.refresh){this.subEvt=c.attachEventListener("PublishStatusUpdate",this.id,"update");this.set("title",mstrmojo.desc(15103,"Refresh ####").replace("####",L.htmlAngles(c.cubeName)));if(A.isWS()){this.set("height","460px");}else{this.set("height",(460+this.titleNode.parentNode.clientHeight+"px"));}this.set("showTimeWarningMsg",!!a.analysisID);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));this.set("width",X.refresh);}if(c.operationMode===Z.operationMode.subscribe){this.set("help","schedule_a_cube_refresh.htm");this.subEvt=c.attachEventListener("CreateScheduleUpdate",this.id,"update");if(A.isWS()){V.addClass(this.okButton.domNode,"emphasizeDisabled");this.toggleEnable(false);}this.set("title",mstrmojo.desc(12762,"Schedule for ####").replace("####",L.htmlAngles(c.cubeName)));this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));g=c.getAllTableID();for(d=0;d<g.length;d++){f=c.getImportSource(g[d]);if(f.canSetAlternateSource()){e=true;}if(f.type===Z.sourceType.hadoop||f.databaseType===mstrmojo.warehouse.EnumDatabaseType.BDE){b=true;}}if(b){e=false;}this.advLink.set("visible",e);this.set("width",X.subscribe);Q(this);}if(c.operationMode===Z.operationMode.create){this.subEvt=c.attachEventListener("CreateScheduleUpdate",this.id,"update");this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",L.htmlAngles(c.cubeName)));this.set("width","450px");mstrmojo.css.addClass(this.domNode,"pub-create");}if(c.operationMode===Z.operationMode.edit){this.subEvt=c.attachEventListener("PublishStatusUpdate",this.id,"update");this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));this.set("width","650px");if(a.isDirectDataAccess){this.set("title",mstrmojo.desc(13029,"### Saving Status").replace("###",L.htmlAngles(c.cubeName)));}else{this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",L.htmlAngles(c.cubeName)));}if(this.simpleProgressMode){this.okButton.set("visible",false);this.cancelButton.set("visible",false);this.progress.updateProgress(50);mstrApp.hideWait(true);}}},onClose:function(){var a=mstrApp.getRootController(),b=this.model,c=b.cubeID,d=this;this.opened=false;if(this.subEvt){b.detachEventListener(this.subEvt);}W.forEach(b.getAllTableID(),function(g){var f=b.getImportSource(g);f.hasSelectFile=false;f.republishError=undefined;});this.toggleEnable(true);this.statusList.updateStarted=false;this.stopPublishAnimation();this.destroy();if(this.onCompleted&&b.operationMode===Z.operationMode.subscribe&&a.dialogController.pageZIndex>0){window.setTimeout(function(){if(d.isSendNow){a.getCubeQuota({success:function(){a.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}else{a.scheduleController.updateScheduleAndStatus();}},1);}if(this.onCompleted&&b.operationMode===Z.operationMode.refresh&&a.dialogController.pageZIndex>0){window.setTimeout(function(){var j,g,h,f,k={did:c};if(mstrApp.refreshMultipleCubes){j=mstrApp.getRootController().getModel();j.publishedDatasets.push(k);g=j.cubesInfo;h=g&&g.cubes&&g.cubes.cube;f=W.find(h,"cube_id",c);if(f>=0){h.splice(f,1);j.raiseEvent({name:"cubesInfoChange"});}}},1);}if(b.operationMode===Z.operationMode.refresh||b.operationMode===Z.operationMode.subscribe){if(this.onCompleted&&!mstrApp.fromCubesList){mstrApp.getRootController().exitApplication();}else{if(mstrApp.fromCubesList){mstrApp.fromCubesList=false;var e=mstrApp.getRootController().model.cubeID;a.resetAppforImport();if(!mstrApp.refreshMultipleCubes){a.getCubeQuota();}else{a.getCubeInfo(e);}}else{mstrApp.getRootController().cancelApplication();}}}this.toggleEnable(true);this.statusList.updateStarted=false;},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width||"auto";}},startPublishAnimation:function(){var b=this.title,a=0,d=this;this._origTitle=b;var c=function(){var e,f;if(d._tickTimer===null||!d.titleNode){return ;}switch(a%3){case 0:f=".&nbsp;&nbsp;";break;case 1:f="..&nbsp;";break;case 2:f="...";break;}e='<span class="republish-success-label">'+d._origTitle+'</span><span class="republish-success-label color">(&nbsp;'+mstrmojo.desc(4311,"Processing")+f+"&nbsp)</span>";d.titleNode.innerHTML=e;a++;};if(this._tickTimer){return ;}this._tickTimer=window.setInterval(c,1000);},stopPublishAnimation:function(){if(this._tickTimer){window.clearInterval(this._tickTimer);this._tickTimer=null;this.titleNode.innerHTML=this._origTitle;}},update:function(b){var c=this.model,f,e,d,g;this.onCompleted=false;this.onError=false;if(c.operationMode===Z.operationMode.refresh||(c.operationMode===Z.operationMode.edit&&!this.simpleProgressMode)){this.startPublishAnimation();if(b.completed!==undefined){this.onCompleted=b.completed;}if(b.error!==undefined){this.onError=b.error;}if(this.onCompleted){this.toggleEnable(true);}else{this.toggleEnable(false);}this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));if(this.onError){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.sendToHistoryList.set("visible",false);this.statusBox.statusText.set("visible",false);this.stopPublishAnimation();V.removeClass(window.document.body,"invisible-wait");}else{if(this.onCompleted&&!this.onError){var a=mstrApp.launchingApp;if(a&&mstrmojo.vi&&mstrmojo.vi.VisualInsightApp&&a instanceof mstrmojo.vi.VisualInsightApp&&a.isAppStatePause()){if(R.valarray(c.importSources).every(function(h){return h.checked;})){a.getRootController().docCtrl.model.removeUnpublishedCubes(c.cubeID);}}this.stopPublishAnimation();g=this.title;if(g.indexOf('<span class="republish-success-label">')<0){g='<span class="republish-success-label">'+g+'</span><span class="republish-success-label color">'+mstrmojo.desc(13444,"( Successfully published to memory )")+"</span>";}this.set("title",g);this.okButton.set("visible",false);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.cancelButton.set("enabled",true);this.sendToHistoryList.set("visible",false);this.cancelButton.set("visible",true);if(c.operationMode===Z.operationMode.refresh){this.statusBox.statusText.set("text",mstrmojo.desc(15100,"Successfully refreshed."));V.addClass(this.statusBox.statusText.domNode,"finished");}V.removeClass(window.document.body,"invisible-wait");}}if(b&&b.reset){this.stopPublishAnimation();this.toggleEnable(true);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("enabled",true);this.statusBox.statusText.set("visible",false);V.removeClass(window.document.body,"invisible-wait");}}if(c.operationMode===Z.operationMode.subscribe){f=b.res;this.cancelButton.set("enabled",true);if(f.subsID){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.onCompleted=true;this.statusBusy.set("visible",false);}else{this.onError=true;if(A.isWS()){mstrApp.getRootController().displayError(null,false,f.message,null,mstrmojo.desc(15205,"Schedule Dataset Refresh"),mstrmojo.desc(15206,"This subscription cannot be saved."));}else{mstrApp.getRootController().displayError(mstrmojo.desc(12763,"Cannot save this subscription."),false,f.message);}}V.removeClass(window.document.body,"invisible-wait");}if(c.operationMode===Z.operationMode.edit&&this.simpleProgressMode){d=0;e=0;R.forEach(c.importSources,function(h){e++;if(h.status!=="3"&&h.status!=="4"&&h.status!=="6"){this.onCompleted=false;}if(h.status==="4"||h.status==="6"){this.onError=true;}if(h.status==="3"||h.status==="4"||h.status==="6"){d++;}},this);this.progress.updateProgress(50+d*50/e);}},toggleEnable:function(a){this.okButton.set("enabled",!!a);},getFileUploader:function(a){return this.statusList.getFileUploader(a);},checkCanRefresh:function(){return this.statusList.checkCanRefresh();},checkCanChange:function(){if(A.isWS()&&this.model.operationMode===Z.operationMode.refresh&&!this.okButton.enabled){return false;}return this.statusList.checkCanChange();},updateSchsStatus:function(a){this.advLink.set("enabled",!!a);this.scheduleBox.chooseSchedPulldown.set("enabled",!!a);this.secondBox.nameBox.set("enabled",!!a);var b=this.scheduleBox.selectTimeBox;if(b.visible){b.selectTimePulldown.set("enabled",!!a);b.wtime.set("enabled",!!a);b.mday.set("enabled",!!a);b.time.set("enabled",!!a);}this.advanceOpsCheckbox.set("enabled",!!a);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13005,"Building the cube"),cssClass:"simpleProgress-label",bindings:{visible:"this.parent.simpleProgressMode"}},{alias:"progress",scriptClass:"mstrmojo.ProgressBar",cssClass:"simpleProgress-progress",bindings:{visible:"this.parent.simpleProgressMode"}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13956,"Publishing time depends on your dataset. Are you sure you want to republish?"),cssClass:"timewarning-label",bindings:{visible:"this.parent.showTimeWarningMsg"}},{alias:"advLink",scriptClass:"mstrmojo.Label",cssClass:"advanceOpsLink",cssDisplay:"table",text:mstrmojo.desc(15095,"Show Advanced Options..."),postCreate:function B(){mstrmojo.ImageCheckBox.prototype.postCreate.call(this);var b={},a=b[this.id]={};a.isScheduleAdvancedChange=this.handleAdvMode;mstrApp.getRootController().attachDataChangeListeners(b);},postBuildRendering:function U(){this.set("checked",mstrApp.getRootController().getScheduleController().isAdvState());},handleAdvMode:function F(a){this.set("checked",a.value);},bindings:{visible:function(){return(this.parent.model.operationMode===Z.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},onclick:function(){this.set("checked",!this.checked);Q(this.parent);},oncheckedChange:function(){var e=this.checked,f=this.parent,j=f.statusList,c=mstrApp.getRootController(),d=c.getScheduleController(),b=f.model.cubeID,g={success:function h(){var k=[],l=[];d.setAdvMode(true);j.set("hasIRR",true);mstrmojo.array.forEach(j.items,function(m){if(!m.isAll&&m.checked){k.push(m.tableID);l.push(m.refreshType.toString());}});if(k.length>0){d.createEmmaIRRSourceTables(b,k,l);}},failure:function a(k){d.setAdvMode(false);c.displayError(mstrmojo.desc(12766,"Cannot create emma IRR report instance."),false,(k&&k.message)||"");}};j.set("bHasSourceFilter",e);j.set("bHasAlternateSource",e);j.refresh();if(e){this.set("text",mstrmojo.desc(15096,"Hide Advanced Options..."));f.set("width",X.subscribeChecked);f.scheduleBox.set("width","814px");V.toggleClass(f.scheduleBox.chooseSchedPulldown.domNode,"chooseSchedPulldownCheck",true);V.toggleClass(f.scheduleBox.selectTimeBox.domNode,"selectTimeBoxCheck",true);}else{this.set("text",mstrmojo.desc(15095,"Show Advanced Options..."));f.editorNode.style.width=X.subscribe;f.set("width",X.subscribe);f.scheduleBox.set("width","437px");V.toggleClass(f.scheduleBox.chooseSchedPulldown.domNode,"chooseSchedPulldownCheck",false);V.toggleClass(f.scheduleBox.selectTimeBox.domNode,"selectTimeBoxCheck",false);}f.positionDialog();if(e){if(!c.dataService.emmaIRRMessageID){d.createEmmaIRRReportInstance(c.model.IRRid,null,g);return ;}if(!j.hasIRR){j.set("hasIRR",true);}d.setAdvMode(true);d.setAdvState(true);}else{d.setAdvState(false);}}},{scriptClass:"mstrmojo.DI.DITableStatusList",alias:"statusList",bindings:{model:"this.parent.model",forceFullPublish:"(!this.parent.model.isCubePublished || !this.parent.model.rawDataExistsInAE)",bHasRefreshPolicy:function(){return this.parent.model.operationMode===Z.operationMode.refresh||this.parent.model.operationMode===Z.operationMode.subscribe||this.parent.model.operationMode===Z.operationMode.edit;},visible:"!this.parent.simpleProgressMode",editorZIndex:"this.parent.zIndex"}},{scriptClass:"mstrmojo.Box",cssClass:"cf scheduleBox",alias:"scheduleBox",bindings:{visible:function(){return(this.parent.model.operationMode===Z.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(3464,"Schedule:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chooseSchedPulldown",isHostedWithin:false,cssClass:"chooseSchedPulldown",hostedCSSClass:"mstrmojo-di-republishSchedule-chooseSched-hosted",popupToBody:true,popupZIndex:999,defaultSelection:-1,itemIdField:"id",itemField:"n",value:mstrmojo.desc(15097,"Choose a schedule template"),hasCustomSchedule:false,preBuildRendering:function(){var c=this.parent.parent.model,d=c&&c.getSchedule(),b=[{n:mstrmojo.desc(15098,"Custom Schedule..."),id:0}];if(d){var a=mstrmojo.hash.clone(d.availableTriggers);if(a.length>0){b=b.concat([{cls:"separator"}],a);}}this.set("items",b);},postselectedIndexChange:function(n){var m=this.parent.parent,g=m.model,h=g&&g.getSchedule(),j=mstrmojo.date,e=mstrmojo.locales,d,k,f,c,l,a=m.secondBox.nameBox;if(!g){return ;}l=n.value;if(l===0){this.set("hasCustomSchedule",true);J.call(this.parent.selectTimeBox.selectTimePulldown);}else{if(l>0){this.set("hasCustomSchedule",false);h.set("curTrg",this.items[l]);h.set("trgName",this.items[l].n);if(!h.subsID){d=new Date();k=j.getDateJson(d);f=j.formatDateInfo(k,e.datetime.DATEDISPLAYFORMAT);c=j.formatTimeInfo(k,e.datetime.TIMEDISPLAYFORMAT);var b=g.cubeName+" "+h.trgName+" "+f+" "+c;a.set("sugName",b);h.set("subsName",b);}}}Q(m);if(!a.enabled){a.set("enabled",true);}}},{scriptClass:"mstrmojo.Box",cssClass:"selectTimeBox",alias:"selectTimeBox",bindings:{visible:"this.parent.chooseSchedPulldown.hasCustomSchedule"},children:[{scriptClass:"mstrmojo.ui.Pulldown",alias:"selectTimePulldown",cssClass:"selectTimePulldown",stp:Z.schedule.WEEKLY,wday:"0",mday:"1",time:"8:00AM",items:[{n:mstrmojo.desc(10639,"Daily"),v:Z.schedule.DAILY},{n:mstrmojo.desc(10159,"Weekday"),v:Z.schedule.WEEKDAY},{n:mstrmojo.desc(9705,"Weekly"),v:Z.schedule.WEEKLY},{n:mstrmojo.desc(9704,"Monthly"),v:Z.schedule.MONTHLY}],value:mstrmojo.desc(9705,"Weekly"),onLabel:true,wtime:true,postselectedIndexChange:function(b){var a=b.value;this.set("stp",this.items[a].v);switch(a){case I:H.call(this,1);break;case G:H.call(this,1);break;case K:H.call(this,2);break;case Y:H.call(this,4);break;}J.call(this);}},{scriptClass:"mstrmojo.Label",alias:"onLabel",text:mstrmojo.desc(15099,"on"),bindings:{visible:"this.parent.selectTimePulldown.onLabel"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"wtime",cssClass:"mday",items:Z.weekDay,value:mstrmojo.desc(9380,"Monday"),bindings:{visible:"this.parent.selectTimePulldown.wtime"},preBuildRendering:function(){var a=W.find(this.items,this.itemIdField,this.parent.selectTimePulldown.wday);if(a>=0){this.set("selectedIndex",a);}},itemIdField:"v",postselectedIndexChange:function(a){var b=this.items[a.value];this.parent.parent.set("wday",b.v);J.call(this);}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"mday",cssClass:"mday",items:Z.dateMon,value:"1st",bindings:{visible:"this.parent.selectTimePulldown.mtime"},preBuildRendering:function(){var a=W.find(this.items,this.itemIdField,this.parent.selectTimePulldown.mday);if(a>=0){this.set("selectedIndex",a);}},itemIdField:"v",postselectedIndexChange:function(a){var b=this.items[a.value];this.parent.parent.set("mday",b.v);J.call(this);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5923,"at")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"time",cssClass:"time",items:Z.timeOfDay,value:"8:00AM",preBuildRendering:function(){var a=W.find(this.items,this.itemIdField,this.parent.selectTimePulldown.time);if(a>=0){this.set("selectedIndex",a);}},itemIdField:"v",postselectedIndexChange:function(a){var b=this.items[a.value];this.parent.parent.set("time",b.v);J.call(this);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:"cf secondBox",alias:"secondBox",bindings:{visible:function(){return(this.parent.model.operationMode===Z.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(12769,"Schedule Name:")},{scriptClass:"mstrmojo.DI.DNTextBox",cssClass:"inputName",alias:"nameBox",maxInput:250,userInput:false,sugName:"",enabled:false,valid:false,onvalueChange:function(){var a=this.parent.parent.model,b=a&&a.getSchedule();if(b){if(!this.userInput){this.set("userInput",b.subsName!==this.value?true:false);}b.set("subsName",this.value);}},onvalidChange:function(){var a=R.walk("parent.parent",this);if(typeof a==="undefined"){return ;}V.toggleClass(a.okButton.domNode,"emphasizeDisabled",!this.valid);a.set("canSaveScheduleJudgedByNameBox",this.valid);a.toggleEnable(a.canSaveScheduleJudgedByNameBox&&a.canRefreshJudgedByTableStatusList);},postBuildRendering:function(){var a=this.parent.parent.model,b=a&&a.getSchedule();this.update();if(b){b.attachEventListener("subsNameChange",this.id,"update");}},update:function(){var a=this.parent.parent.model,b=a&&a.getSchedule();if(b){if(!this.userInput){this.set("value",b.subsName||"");}else{if(b.subsName!==""&&this.value===""){this.set("value",this.sugName);}}}}}]},{slot:"buttonNode",scriptClass:"mstrmojo.CheckBox",alias:"advanceOpsCheckbox",cssClass:"advanceOpsCheckbox",label:mstrmojo.desc(13274,"Refresh data now"),postBuildRendering:function(){var a=this.parent.model,b=a&&a.getSchedule();this.update();if(b){b.attachEventListener("trgNameChange",this.id,"update");b.attachEventListener("isSendNowChange",this.id,"update");}},update:function(){var a=this.parent.model,b=a&&a.getSchedule();if(a){this.set("visible",a.operationMode===Z.operationMode.subscribe&&mstrApp.diParams.canSendNow);this.set("enabled",!!b.trgName);this.set("checked",b.isSendNow);}},oncheckedChange:function(){var a=this.parent.model,b=this.checked;if(a){a.getSchedule().set("isSendNow",b);}}},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var a=this.parent;a.close();},postBuildRendering:function(){var a=this.parent.model;a.attachEventListener("PublishStatusUpdate",this.id,"update");},update:function(a){if(a&&a.name&&!a.completed&&!a.hasError){this.set("enabled",false);}if(a&&a.reset){this.set("enabled",true);}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==Z.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1302,"Finish"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function B(){var e=this,c=this.parent,d={},b=d[this.id]={};var a=function(g){var h=e.parent.model,j=h.operationMode,k=h.getSchedule(),f=k&&k.trgName;c.set("canRefreshJudgedByTableStatusList",g.value);if(j===Z.operationMode.subscribe&&f){e.set("enabled",c.canRefreshJudgedByTableStatusList&&c.canSaveScheduleJudgedByNameBox);e.parent.resetOKButtonText();e.richTooltip.content=g.value?"":D;}else{if(j===Z.operationMode.refresh||j===Z.operationMode.edit){e.set("enabled",c.canRefreshJudgedByTableStatusList);e.parent.resetOKButtonText();e.richTooltip.content=g.value?"":D;}else{if(j===Z.operationMode.subscribe&&!f){e.set("enabled",false);}}}};b[M]=a;b[E]=a;mstrApp.getRootController().attachDataChangeListeners(d);},onclick:function(){var b=mstrApp.getRootController(),a=this.parent.model;if(P(a.importSources)){b.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}var d=a.isManagedCube===false&&a.operationMode===Z.operationMode.refresh&&(a.writable===0||a.copyable===0);if(d){var e=C(a),c=e||(a.isDirectDataAccess!==a.origIsDirectDataAccess);if(c){b.displayError(mstrmojo.desc(16017,"You need write access to cube # to the operation, because the cube have security filter or shared attribute associated.").replace("#",a.cubeName),false);return ;}}if(a.operationMode===Z.operationMode.subscribe){b.getScheduleController().createSchedule();this.parent.toggleEnable(false);this.parent.okButton.set("text",mstrmojo.desc(15104,"Scheduling..."));V.addClass(window.document.body,"invisible-wait");this.parent.statusBusy.set("visible",true);this.parent.updateSchsStatus(false);b.raiseModelEvent({name:"PublishStatusUpdate",completed:false});this.parent.isSendNow=this.parent.model.getSchedule().isSendNow;}if(a.operationMode===Z.operationMode.refresh){this.parent.toggleEnable(false);this.parent.okButton.set("text",mstrmojo.desc(15079,"Refreshing..."));this.parent.statusBox.statusText.set("visible",true);V.addClass(window.document.body,"invisible-wait");b.saveAndPublish();}if(a.operationMode===Z.operationMode.edit){this.parent.toggleEnable(false);b.getPublishController().startSaveAndPublish();}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==Z.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"sendToHistoryList",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton sendToHistory",text:mstrmojo.desc(4364,"Send to History List"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},onclick:function(){mstrApp.getRootController().getPublishController().sendToHistoryList();},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function B(){var d=this,c={},b=c[this.id]={};var a=function(e){var f=d.parent.model,g=f.operationMode;if(g===Z.operationMode.refresh||g===Z.operationMode.edit){d.set("enabled",e.value);d.richTooltip.content=e.value?"":D;}};b[E]=a;mstrApp.getRootController().attachDataChangeListeners(c);},bindings:{visible:function(){return(!A.isWS()&&mstrApp.getRootController().model.operationMode!==Z.operationMode.subscribe&&!mstrApp.isSingleTier&&!mstrApp.getRootController().model.analysisID&&!mstrApp.refreshMultipleCubes);}}},{scriptClass:"mstrmojo.Box",slot:"buttonNode",alias:"statusBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15105,"Loading data..."),alias:"statusText",cssClass:"republish-status-text",visible:false}]},{scriptClass:"mstrmojo.Label",slot:"buttonNode",alias:"statusBusy",cssClass:"schedule-status-busy",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.Image","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.tooltip","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIModel","mstrmojo.locales","mstrmojo.date","mstrmojo.ProgressBar","mstrmojo.DI.DNTextBox","mstrmojo.AS.DIAppSchemaTableStatusList","mstrmojo.AS.DIAppSchemaRefreshFileEditor","mstrmojo.DI.DIConfirmSaveEditor","mstrmojo.css","mstrmojo.string");mstrmojo.requiresDescs(221,773,1302,4311,4364,4996,8473,10160,12761,12762,12763,12764,12765,12766,12767,12769,13005,13028,13029,2502,13257,9242,13274,13444,13882,15071,15072,15077,3464,5923,10639,10159,9705,9704,9380,15095,15096,15097,15098,15099,15100,15101,15102,15103,15104,15105,15205,15206);var I=mstrmojo.array,C=mstrmojo.hash,E=mstrmojo.DI.DIHelpers,K=mstrmojo.string,M=mstrmojo.DI.DIConstants,N="canStartRefresh",B=mstrmojo.desc(13882,"Please upload the data or unselect the source in order to enable this option."),G=mstrmojo.css,D="712px",O="DIAppSchemaModel",J={Reserved:0,Waiting:1,Publishing:2,Completed:3,Error:4,SchemaComparisonCompleted:5,SchemaComparisonError:6},H={finished:1,jobExecutionError:3,executionError:18};function A(P){return mstrApp.getRootController().getModel();}function F(V,S,U,X,W){C.forEach(V.importSources,function(Y){I.forEach(Y.items,function(Z){Z.needUploadFile&&S.push(Z);});});if(S.length>0){var R=[],P=[],Q=0;I.forEach(S,function(b,Z,Y){var a,d;I.forEach((U.model.appSchemaTables&&U.model.appSchemaTables.pipelineInfos)||W,function(g){var e=g.tableGroups,f;I.forEach(e,function(j){var h=j[0];if(h.id===b.id){a=g;d=h.dataSource;return false;}});});var c={tableId:b.id,pipelineId:a.id,sheetIndex:d.sheetIndex,uploadingId:d.fileId,workspaceId:U.model.workspaceId,requestId:U.model.requestId,mode:M.operationMode.republish,showProgress:false};R.push(c);if(b.needUploadFile){mstrmojo.AS.DIAppSchemaService.uploadFile(b.fileUploader.fileNode,c,function(e){P.push(e);R[Q++]["uploadingId"]=e.uploadingId;if(Q===S.length){R=R.filter(function(f){return !!f.uploadingId;});X.call();}});}else{Q++;}});}else{X.call();}}mstrmojo.AS.DIPublishAppSchemaEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.AS.DIPublishAppSchemaEditor",cssClass:"mstrmojo-di-scheduleEMMA",title:"",allowHTMLTitle:true,simpleProgressMode:false,showTimeWarningMsg:false,height:"auto",useRichTooltip:false,operationMode:null,cubeName:"",cubeId:null,tablesInfo:null,dataService:null,publishCube:null,operationMode:null,forceFullPublish:null,closeAppSchema:null,onOpen:function(){var P=this.model=A(this.model);P.populateExternalSources();if(this.opened){return ;}this.opened=true;if(this.subEvt){P.detachEventListener(this.subEvt);}this.subEvt=P.attachEventListener("PublishStatusUpdate",this.id,"update");this.set("width",D);if(this.operationMode===M.operationMode.refresh){this.subEvt=P.attachEventListener("PublishStatusUpdate",this.id,"update");this.set("title",mstrmojo.desc(15103,"Refresh ####").replace("####",this.cubeName));if(this.publishCube){mstrmojo.css.addClass(this.domNode,"mstrmojo-di-publishAppSchema workstation");}if(E.isWS()){this.set("height","460px");}else{}this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));}if(this.operationMode===M.operationMode.create){this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",K.htmlAngles(this.cubeName)));mstrmojo.css.addClass(this.domNode,"pub-create mstrmojo-di-publishAppSchema workstation");this.model.raiseEvent({name:"PublishStatusUpdate"});}if(this.operationMode===M.operationMode.edit){this.subEvt=P.attachEventListener("PublishStatusUpdate",this.id,"update");this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",this.cubeName));mstrmojo.css.addClass(this.domNode,"mstrmojo-di-publishAppSchema workstation");if(this.simpleProgressMode){this.okButton.set("visible",false);this.cancelButton.set("visible",false);mstrmojo.css.addClass(this.domNode,"mstrmojo-hide-di-publishAppSchema");mstrmojo._IsWebApp.showWait({cssClass:"mstr-appschema-wait",message:mstrmojo.desc(15916,"Building the cube...")});}this.publishCube();this.model.raiseEvent({name:"PublishStatusUpdate",completed:false});}},updatePublishStatus:function(P){if(this.statusList&&this.statusList.items){var R=this.statusList.items,Q=false;I.forEach(R,function(V){if(P.tableStatus){var U=I.find(P.tableStatus,"tableId",V.id);var S=P.tableStatus[U];if(S){V.errmsg=S.errorMessage;V.status=J[S.status];}}Q=P.result.allCompleted&&P.result.hasError&&V.status===J.Reserved;if(Q){V.status=J.Error;}});}this.model.raiseEvent({name:"PublishStatusUpdate",completed:P.result.allCompleted,error:P.result.hasError});if(P.result.allCompleted&&P.result.hasError){this.publishErrorHandler(P);}},publishErrorHandler:function(U){var Q=mstrmojo.desc(13065,"Unable to publish the cube."),X="",V=parseInt(U.status,10),S=U.exceptionMessage;if(S){X=K.encodeHtmlString(S,true,true);}if(U.status<0&&U.tableStatus&&U.tableStatus.length>0){S="<ul>";var W=this.statusList&&this.statusList.items;I.forEach(U.tableStatus,function(Y){if(Y.errorMessage){var a=I.find(W,"id",Y.tableId),Z=W[a];if(Z){S+="<li>"+Z.name+"<br>"+Y.errorMessage+"</li>";}}});S+="</ul>";X=S;}var P=new mstrmojo.DI.controller.DIPublishController(),R=P.getErrorMessage(V,S,X,false,true,this.operationMode);X=R?R:X;mstrmojo.error({shortDesc:Q,longDesc:X},undefined,{title:mstrmojo.desc(11812,"Notification"),allowHTML:true});},finishPublish:function(Q,P){this.model.raiseEvent({name:"PublishStatusUpdate",completed:Q,error:P});},onClose:function(){var R=this.model,P,V,S=this,Q;if(mstrApp&&mstrApp.getRootController!=undefined){P=mstrApp.getRootController();}this.opened=false;if(this.subEvt){R.detachEventListener(this.subEvt);}I.forEach(R.getAllTableID(),function(X){var W=R.getImportSource(X);W.hasSelectFile=false;W.republishError=undefined;});this.toggleEnable(true);this.statusList.updateStarted=false;this.stopPublishAnimation();if(this.model.id===O){this.model.destroy();}this.destroy();if(this.onCompleted&&this.operationMode===M.operationMode.refresh&&P.dialogController.pageZIndex>0){V=R.cubeID;Q=function(){var Z,X,Y,W,a={did:V};if(mstrApp.refreshMultipleCubes){Z=mstrApp.getRootController().getModel();Z.publishedDatasets.push(a);X=Z.cubesInfo;Y=X&&X.cubes&&X.cubes.cube;W=I.find(Y,"cube_id",V);if(W>=0){Y.splice(W,1);Z.raiseEvent({name:"cubesInfoChange"});}}};}if(this.operationMode===M.operationMode.refresh){if(this.onCompleted&&!mstrApp.fromCubesList){mstrmojo.AS.DIAppSchemaService.deleteWorkspace({workspaceId:P.model.workspaceId},{complete:function(){Q&&window.setTimeout(Q,1);mstrApp.getRootController().exitApplication();}});}else{if(mstrApp.fromCubesList){Q&&window.setTimeout(Q,1);mstrApp.fromCubesList=false;var U=mstrApp.getRootController().model.cubeID;P.resetAppforImport();if(!mstrApp.refreshMultipleCubes){P.getCubeQuota();}else{P.getCubeInfo(U);}}else{mstrmojo.AS.DIAppSchemaService.deleteWorkspace({workspaceId:P.model.workspaceId},{complete:function(){Q&&window.setTimeout(Q,1);mstrApp.getRootController().cancelApplication();}});}}}this.toggleEnable(true);this.statusList.updateStarted=false;if(this.closeAppSchema){this.closeAppSchema();}},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width||"auto";}},startPublishAnimation:function(){var Q=this.title,P=0,S=this;this._origTitle=Q;var R=function(){var U,V;if(S._tickTimer===null||!S.titleNode){return ;}switch(P%3){case 0:V=".&nbsp;&nbsp;";break;case 1:V="..&nbsp;";break;case 2:V="...";break;}U='<span class="republish-success-label">'+S._origTitle+'</span><span class="republish-success-label color">(&nbsp;'+mstrmojo.desc(4311,"Processing")+V+"&nbsp)</span>";S.titleNode.innerHTML=U;P++;};if(this._tickTimer){return ;}this._tickTimer=window.setInterval(R,1000);},stopPublishAnimation:function(){if(this._tickTimer){window.clearInterval(this._tickTimer);this._tickTimer=null;this.titleNode.innerHTML=this._origTitle;}},update:function(P){var Q=this.model,U,S,R,V;this.onCompleted=false;this.onError=false;if(this.operationMode===M.operationMode.refresh||(this.operationMode===M.operationMode.edit&&!this.simpleProgressMode)){this.startPublishAnimation();if(P.completed!==undefined){this.onCompleted=P.completed;}if(P.error!==undefined){this.onError=P.error;}if(this.onCompleted){this.toggleEnable(true);}else{this.toggleEnable(false);}this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));if(this.onError){this.okButton.set("visible",false);if(this.operationMode===M.operationMode.refresh){this.cancelButton.set("visible",true);}else{this.cancelButton.set("visible",false);}this.sendToHistoryList.set("visible",false);this.statusBox.statusState.set("visible",true);this.statusBox.statusText.set("visible",true);if(this.onCompleted){this.statusBox.statusText.set("text",mstrmojo.desc(13065,"Unable to publish the cube."));G.removeClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status warning");this.stopPublishAnimation();}}else{if(this.onCompleted&&!this.onError){this.stopPublishAnimation();V=this.title;if(V.indexOf('<span class="republish-success-label">')<0){V='<span class="republish-success -label">'+V+'</span><span class="republish-success-label color">'+mstrmojo.desc(13444,"( Successfully published to memory )")+"</span>";}this.set("title",V);this.okButton.set("visible",false);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.cancelButton.set("enabled",true);this.sendToHistoryList.set("visible",false);this.cancelButton.set("visible",true);this.statusBox.statusText.set("text",mstrmojo.desc(15100,"Successfully refreshed."));G.addClass(this.statusBox.statusText.domNode,"finished");G.removeClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status finished");}else{if(!this.onCompleted&&!this.onError){this.toggleEnable(false);this.okButton.set("text",mstrmojo.desc(15079,"Refreshing..."));this.statusBox.statusText.set("visible",true);this.statusBox.statusState.set("visible",true);G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(window.document.body,"invisible-wait");}}}if(P&&P.reset){this.stopPublishAnimation();this.toggleEnable(true);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("enabled",true);this.statusBox.statusText.set("visible",false);this.statusBox.statusState.set("visible",false);}}if(this.operationMode===M.operationMode.create&&!this.simpleProgressMode){if(P.error){this.stopPublishAnimation();this.statusBox.statusText.set("text",mstrmojo.desc(13065,"Unable to publish the cube."));this.statusBox.statusState.set("visible",true);G.removeClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status warning");}else{if(P.completed&&!P.error){this.stopPublishAnimation();V=this.title;this.statusBox.statusText.set("visible",true);this.statusBox.statusText.set("text",mstrmojo.desc(13444,"( Successfully published to memory )"));this.statusBox.statusState.set("visible",true);G.removeClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status finished");}else{this.statusBox.statusText.set("visible",true);this.statusBox.statusState.set("visible",true);G.addClass(this.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(window.document.body,"invisible-wait");}}}if(this.operationMode===M.operationMode.edit&&this.simpleProgressMode){if(P.completed){mstrmojo._IsWebApp.hideWait(true);if(!P.error){this.onClose();}}}},toggleEnable:function(P){this.okButton.set("enabled",!!P);},getFileUploader:function(P){return this.statusList.getFileUploader(P);},checkCanRefresh:function(){return this.statusList.checkCanRefresh();},checkCanChange:function(){if(this.operationMode===M.operationMode.refresh&&E.isWS()&&!this.okButton.enabled){return false;}return this.statusList.checkCanChange();},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13956,"Publishing time depends on your dataset. Are you sure you want to republish?"),cssClass:"timewarning-label",bindings:{visible:"this.parent.showTimeWarningMsg"}},{scriptClass:"mstrmojo.AS.DIAppSchemaTableStatusList",alias:"statusList",forceFullPublish:true,cssText:"height: auto;",bindings:{model:function(){this.parent.model=A(this.parent.model);if(this.parent.operationMode){this.parent.model.operationMode=this.parent.operationMode;}return this.parent.model;},forceFullPublish:function(){var P=true;if(this.parent.operationMode===M.operationMode.refresh){P=(!this.parent.model.isCubePublished||!this.parent.model.rawDataExistsInAE);}else{if(this.parent.operationMode===constant.operationMode.edit){P=this.parent.forceFullPublish;}}return P;},items:"this.parent.items",bHasRefreshPolicy:function(){return this.parent.operationMode===M.operationMode.refresh||this.parent.operationMode===M.operationMode.edit;},visible:"!this.parent.simpleProgressMode"}},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),visible:false,onclick:function(){var P=this.parent;P.close();},postBuildRendering:function(){var P=this.parent.model;if(P){P.attachEventListener("PublishStatusUpdate",this.id,"update");}},update:function(P){if(P&&P.name&&!P.completed&&!P.hasError){this.set("enabled",false);}if(P&&P.reset){this.set("enabled",true);}},bindings:{visible:function(){return(this.parent.operationMode!==M.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(773,"Refresh"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function L(){var S=this,R={},Q=R[this.id]={};var P=function(U){var V=S.parent.model,W=S.parent.operationMode;if(W===M.operationMode.refresh||W===M.operationMode.edit){S.set("enabled",!!U.value);S.richTooltip.content=U.value?"":B;}};Q[N]=P;if(mstrApp&&mstrApp.rootController!=undefined){mstrApp.getRootController().attachDataChangeListeners(R);}},onclick:function(){var S,R=this,U=this.parent,Q=this.parent.model,V=this.parent.operationMode,P=[];if(mstrApp&&mstrApp.getRootController!=undefined){S=mstrApp.getRootController();}if(V===M.operationMode.refresh||V===M.operationMode.edit){this.parent.toggleEnable(false);this.parent.okButton.set("text",mstrmojo.desc(15079,"Refreshing..."));this.parent.statusBox.statusText.set("visible",true);this.parent.statusBox.statusState.set("visible",true);G.addClass(this.parent.statusBox.statusState.domNode,"tablestatus-col status waiting");G.addClass(window.document.body,"invisible-wait");}if(V===M.operationMode.refresh&&S){var W=R.parent.publishCube?function(){R.parent.publishCube();}:function(){S.saveAndPublish();};F(Q,P,S,W,R.parent.items&&R.parent.items.pipelineInfos);}if(V===M.operationMode.edit){if(this.parent.publishCube){this.parent.publishCube();}this.parent.model.raiseEvent({name:"PublishStatusUpdate",completed:false});}},bindings:{visible:function(){var P=me.parent.operationMode;return(P!==M.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"sendToHistoryList",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton sendToHistory",text:mstrmojo.desc(4364,"Send to History List"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},onclick:function(){if(mstrApp&&mstrApp.getRootController!=undefined){mstrApp.getRootController().getPublishController().sendToHistoryList();}},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function L(){var S=this,R={},Q=R[this.id]={};var P=function(U){var V=S.parent.model,W=S.parent.operationMode;if(W===M.operationMode.refresh||W===M.operationMode.edit){S.set("enabled",U.value);S.richTooltip.content=U.value?"":B;}};Q[N]=P;if(mstrApp&&mstrApp.rootController!=undefined){mstrApp.getRootController().attachDataChangeListeners(R);}},bindings:{visible:function(){var P=this.parent.operationMode;return false;}}},{scriptClass:"mstrmojo.Box",slot:"buttonNode",alias:"statusBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"appschema-refreshBox-status",alias:"statusState",cssText:"display: inline-block;",visible:false,text:""},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15105,"Loading data..."),alias:"statusText",cssClass:"republish-appschema-status-text",cssText:"display: inline-block;",visible:false}]},{scriptClass:"mstrmojo.Label",slot:"buttonNode",alias:"statusBusy",cssClass:"schedule-status-busy",visible:false}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.Table","mstrmojo.CheckBox","mstrmojo.UUID","mstrmojo.ME.LevelInputBox","mstrmojo.ME.ConditionInputBox","mstrmojo.ME.TransformInputBox","mstrmojo.ME.MetricDataService","mstrmojo.Button","mstrmojo.Box","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.vi.enums.EnumFeatures","mstrmojo.fe.FilterUtils","mstrmojo.ME._HasConditionMetricFilterEditor","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,2827,3324,3377,4788,6223,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853,15004,15646);var U=mstrmojo.expr,I=mstrmojo.array,X=mstrmojo.css,e=mstrmojo.dom,R=mstrmojo.hash,G=mstrmojo.UUID,j=mstrmojo.mstr.EnumDSSXMLObjectTypes,a=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,W=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.MetricToken.brackets,P=mstrmojo.vi.enums.EnumFeatures,f=mstrmojo.desc(15004,"Filter Applied"),A=mstrmojo.desc(15347,"Add Filter..."),g=mstrmojo.fe.FilterUtils.getExprXml,J=mstrmojo.ME.DerivedMetricOptions.isNonAFB;var Q,O;var F=function(){var E=this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level");return mstrmojo.hash.copy({n:E,did:-1,t:-1,state:0});};var k={level:-4,condition:-5,transformation:-6,simple:-7},b=function(E){return E===-4||E===-5||E===-6||E===-7;};var h={n:"",did:"-1",desc:""},D={1:"+",2:"*",3:"%",4:""},H={1:"",2:"!",3:"<",4:">",5:"<|",6:">|"};mstrmojo.ME._HasLevel=mstrmojo.provide("mstrmojo.ME._HasLevel",R.copy(mstrmojo.ME._HasConditionMetricFilterEditor,{_mixinName:"mstrmojo.ME._HasLevel",isAggFunction:false,init:function d(E){if(this._super){this._super(E);}Q=this.id;O=this;},onOpen:function N(){if(this._super){this._super();}if(!this.isAggFunction){return ;}O=this;var q=this.getLCTDefFromTokens();this.updateToggleBarStatus(q);var w=this.metricLCT.levelInput;w.set("candidates",this.getCandidates4LCT([U.TP.ATTR,U.STP.NDE]));w.set("items",q.level);var x=this.metricLCT.conditionInput;if(!this.isDME){if(!this.noCache&&!x.candidates){mstrmojo.ME.MetricDataService.getFilters({pattern:"*",blockBegin:1,blockCount:-1},{success:function(z){if(z){x.set("candidates",{items:z.items,isComplete:(z.bc===-1||(z.bb+z.bc>z.sz))});}},failure:function(z){mstrmojo.alert(z.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{x.candidates=this.getCandidates4LCT([U.TP.FILTER,U.STP.PROMPT_OBJECTS]);this.metricLCT.lblCondition.set("visible",q.filter.length>0);}x.set("items",q.filter);}var E=this.metricLCT.transformInput;if(!this.noCache&&!E.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getTransformations({pattern:"*",blockBegin:1,blockCount:-1},{success:function(z){if(z){E.set("candidates",{items:z.items,isComplete:(z.bc===-1||(z.bb+z.bc>z.sz))});}},failure:function(z){mstrmojo.alert(z.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{E.candidates=this.getCandidates4LCT(U.TP.ROLE);this.metricLCT.lblTransform.set("visible",q.tranformation.length>0);}E.set("items",q.tranformation);var p=this.metricLCT.addFilterBox,n=p.btnAddFilter,t=p.btnClearFilter,m=this.oi&&this.oi.conditions&&this.oi.conditions[0],o=m&&m.exp,u=q.filter&&q.filter[0],l={did:u&&u.did,n:u&&u.n,exp:o,isEmbedded:!!(o||(!u))};n.set("filter",l);t.set("filter",l);},hasConditionFilter:function V(){var l=this.metricLCT.addFilterBox,E=l.btnAddFilter;return !!(E.filter&&E.filter.did);},clearConditionFilter:function c(){var m=this,n=m.metricLCT.addFilterBox,l=n.btnAddFilter,E=n.btnClearFilter;l.set("filter",{isEmbedded:true});E.set("filter",{isEmbedded:true});m.onmetricModify();},onMpsChange:function M(){var m=this,n=m.metricLCT.addFilterBox,l=n.btnAddFilter,E=n.btnClearFilter;l.refresh();E.refresh();},useEmbeddedFilter:function C(){return this.isDME&&!this.ide.disableConditionMetric;},getLCTDefAsTokens:function S(){if(!this.isAggFunction){return[];}var x=this.metricLCT.levelInput.getSelectedObjects(),o=this.useEmbeddedFilter()?this.metricLCT.addFilterBox.btnAddFilter.getFilterObj():this.metricLCT.conditionInput.getSelectedObjects(),m=this.metricLCT.transformInput.getSelectedObjects(),t=[],l,n,p,E=function(AA,z){return AA.filtering===1?"("+z+")":z;};t.push({v:"{",isDelimiter:true});var u=null;for(n=0,p=x.length;n<p;n++){u=x[n];t.push({v:H[u.grouping],isDelimiter:true});if(W.isDimty(u.n)){t.push({v:E(u,u.n)});}else{if(/^@/.test(u.did)){t.push({v:E(u,u.did)});}else{if(u.did===-1){t.push({v:"~",isDelimiter:true});}else{t.push({v:B(u.n),oi:u});}}}t.push({v:D[u.filtering],isDelimiter:true});if(n<(p-1)){t.push({v:", ",isDelimiter:true});}}if(!this.levelFilterRest){t.push({v:";",isDelimiter:true});t.push({v:"-",isDelimiter:true});}if(!this.levelCanContinue){t.push({v:";",isDelimiter:true});t.push({v:"/",isDelimiter:true});}t.push({v:"}",isDelimiter:true});if(o.length>0){t.push({v:"<",isDelimiter:true});l={v:B(o[0].n)};if(o[0].did){l.oi=o[0];}t.push(l);t.push({v:";",isDelimiter:true});t.push({v:"@",isDelimiter:true});t.push({v:this.conditionEmbedMethod});t.push({v:";",isDelimiter:true});t.push({v:this.conditionIgnoreFilterElem?"-":"+",isDelimiter:true});t.push({v:">",isDelimiter:true});}var w=I.indexOf(m,h);p=w<0?m.length:w;if(p>0){t.push({v:"|",isDelimiter:true});var q=null;for(n=0;n<p;n++){q=m[n];l={v:B(q.n)};if(q.did){l.oi=q;}t.push(l);if(n<(p-1)){t.push({v:", ",isDelimiter:true});}}t.push({v:"|",isDelimiter:true});}for(n=0,p=t.length;n<p;n++){t[n].isNew=true;}return t;},getLCTDefFromTokens:function Y(){var l=[],n=false,u=[],q=[],x=this.oi.tks.items,w=x.length,t;if(this.insertMode||w===0){l.push(F.call(this));}else{for(t=0;t<w;t++){var o=x[t],z=o.tp,m=o.sctt;switch(m){case 262144:n=true;switch(z){case 64:case 126:case 264:case 265:case 310:var p=t,AA;if(z===64){var E=o.v+x[++t].v;o=x[t+1];if(o.tp===43||o.tp===45){E+=x[++t].v;E+=x[++t].v;}else{if(o.tp===41){t++;}}AA=mstrmojo.ME.Enum.DYNAMIC_DIMTY.getDimtyObject(E,this.isDME);}else{AA=z===126?F.call(this):o.oi;}AA.grouping=1;AA.filtering=4;switch(x[p-1].tp){case 33:AA.grouping=2;break;case 60:AA.grouping=3;break;case 62:AA.grouping=4;break;case 297:AA.grouping=5;break;case 298:AA.grouping=6;break;}switch(x[t+1].tp){case 37:AA.filtering=3;break;case 42:AA.filtering=2;break;case 43:AA.filtering=1;break;}l.push(AA);break;case 45:this.levelFilterRest=false;break;case 47:this.levelCanContinue=false;break;}break;case 327680:switch(z){case 270:case 273:u.push(o.oi);break;case 262:this.conditionEmbedMethod=o.v;break;case 43:this.conditionIgnoreFilterElem=false;break;case 45:this.conditionIgnoreFilterElem=true;break;}break;case 393216:switch(z){case 271:q.push(o.oi);break;}break;}}if(l.length===0&&!n){l.push(F.call(this));}}return{level:l,filter:u,tranformation:q};},levelCanContinue:true,levelFilterRest:true,conditionEmbedMethod:"2",conditionIgnoreFilterElem:true,_set_candidates:function(p,l){this.candidates=l;if(this.hasRendered){var E=this.metricLCT.levelInput,m=this.metricLCT.conditionInput,o=this.metricLCT.transformInput;E.candidates=this.getCandidates4LCT([U.TP.ATTR,U.STP.NDE]);m.candidates=this.getCandidates4LCT([U.TP.FILTER]);o.candidates=this.getCandidates4LCT([U.TP.ROLE]);}return true;},getCandidates4LCT:function L(n,E){var m=this.candidates,l;if(m){n=I.ensureArray(n);l=I.filter(m.items,function(o){return I.indexOf(n,o.t)>-1||I.indexOf(n,o.st)>-1;});if(I.indexOf(n,12)>-1&&E){if(this.replaceAttributeWithForms){l=this.replaceAttributeWithForms(l);}}return{items:l,isComplete:m.isComplete};}return null;},updateToggleBarStatus:function K(E){var l=false;if(E.level){l=E.level.length>1||E.level.length===1&&E.level[0].did!==-1;}if(E.filter){l=l||E.filter.length>0;}if(E.transformation){l=l||E.transformation.length>0;}if(b(this.did)){l=true;}this.metricLCT.toggle.set("selected",l);},levelAdvRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9577,"Level Advanced Options"),help:"Level_Advanced_Options_dialog_box.htm",cssClass:"mstrmojo-ME-level-options",onOpen:function(){var E=this.opener;this.contentTable.ccCheckBox.set("checked",E.levelCanContinue);this.contentTable.frCheckBox.set("checked",E.levelFilterRest);},children:[{scriptClass:"mstrmojo.Table",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.CheckBox",alias:"ccCheckBox",slot:"0,0",label:mstrmojo.desc(9583,"Allow other users to add extra units to this definition")},{scriptClass:"mstrmojo.CheckBox",alias:"frCheckBox",slot:"1,0",label:mstrmojo.desc(9584,"Include filter attributes which are not in report or level in metric calculation")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveLevelOptions(E.contentTable.ccCheckBox.checked,E.contentTable.frCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},conditionAdvRef:{scriptClass:"mstrmojo.Editor",title:"Condition Advanced Options",help:"Condition_Advanced_Options_dialog_box.htm",cssText:"width: 286px;",onOpen:function(){var E=this.opener;this.contentTable.emPulldown.set("value",E.conditionEmbedMethod);this.contentTable.irfeCheckBox.set("checked",E.conditionIgnoreFilterElem);},children:[{scriptClass:"mstrmojo.Table",cssText:"margin-top:5px;",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",text:mstrmojo.desc(9585,"Interaction between metric filter and report filter: ")},{scriptClass:"mstrmojo.Pulldown",alias:"emPulldown",itemField:"n",itemIdField:"did",slot:"1,0",value:"2",items:[{n:mstrmojo.desc(9586,"Merge into new"),did:"1"},{n:mstrmojo.desc(9587,"Merge report filter into metric"),did:"2"},{n:mstrmojo.desc(9588,"Merge metric condition into report"),did:"3"}]},{scriptClass:"mstrmojo.CheckBox",alias:"irfeCheckBox",slot:"2,0",label:mstrmojo.desc(9589,"Ignore related report filter elements")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveConditionOptions(E.contentTable.emPulldown.value,E.contentTable.irfeCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},getLCTComponent:function Z(){return{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-ME-LCT",alias:"metricLCT",layout:[{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{cssText:"width:252px;padding-right:6px;"}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]}],bindings:{visible:function(){return this.parent.isAggFunction;}},labelWidth:"auto",children:[{scriptClass:"mstrmojo.Button",cssClass:"toggle",alias:"toggle",text:mstrmojo.desc(6223,"Show All"),selected:false,bindings:{visible:function(){return !this.parent.parent.isDME;}},onclick:function(){var o=!this.selected;this.set("selected",o);},slot:"0,0"},{scriptClass:"mstrmojo.Label",alias:"lblLevel",text:mstrmojo.desc(4788,"Level"),bindings:{visible:function(){return this.parent.parent.isDME||!this.parent.parent.isDME&&this.parent.toggle.selected;},width:"this.parent.labelWidth"},onwidthChange:function(){if(this.hasRendered){this.domNode.style.width=this.width;}},slot:"1,0"},{scriptClass:"mstrmojo.ME.LevelInputBox",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),alias:"levelInput",dtp:-4,xacptSugItemOnly:true,bindings:{noCache:function(){return this.parent.parent.noCache;},isDME:function(){return this.parent.parent.isDME;},visible:function(){return this.parent.lblLevel.visible;}},reportLevelAdded:true,onadd:function(){var o=this.getSelectedObjects();this.set("reportLevelAdded",I.find(o,"did",-1)>-1);},onremove:function(){var o=this.getSelectedObjects();this.set("reportLevelAdded",I.find(o,"did",-1)>-1);},onitemchange:function(){this.parent.parent.onmetricModify();if(O.updateScrollbars){O.updateScrollbars();}},onSaveOnClose:function(){this.parent.parent.onmetricModify();},slot:"1,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold",text:mstrmojo.desc(9577,"Level Advanced Options"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},onclick:function(){var o=this.parent.parent;o.openPopup("levelAdvRef",{saveLevelOptions:function(q,p){o.levelCanContinue=q;o.levelFilterRest=p;},zIndex:o.zIndex+10});},slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"lblCondition",text:mstrmojo.desc(9579,"Condition"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"2,0"},{scriptClass:"mstrmojo.ME.ConditionInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-condition singleObject",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(1281,"Filter").toLowerCase()),alias:"conditionInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblCondition.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();},slot:"2,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold condition",text:mstrmojo.desc(9581,"Condition Advanced Options"),bindings:{visible:function(){return this.parent.lblCondition.visible&&!this.parent.parent.isDME;}},onclick:function(){var o=this.parent.parent;o.openPopup("conditionAdvRef",{saveConditionOptions:function(q,p){o.conditionEmbedMethod=q;o.conditionIgnoreFilterElem=p;},zIndex:o.zIndex+10});},slot:"2,1"},{scriptClass:"mstrmojo.Label",alias:"lblTransform",text:mstrmojo.desc(3324,"Transformation"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"3,0"},{scriptClass:"mstrmojo.ME.TransformInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-transform",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),alias:"transformInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblTransform.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();if(O.updateScrollbars){O.updateScrollbars();}},slot:"3,1"},{scriptClass:"mstrmojo.Label",alias:"lblFilter",text:mstrmojo.desc(1281,"Filter"),bindings:{visible:function(){return !!(this.parent.parent.isDME&&!this.parent.parent.ide.disableConditionMetric);}},slot:"4,0"},{scriptClass:"mstrmojo.Box",alias:"addFilterBox",slot:"4,1",cssClass:"addFilterBox",bindings:{visible:function(){return !!(this.parent.parent.isDME&&!this.parent.parent.ide.disableConditionMetric);}},children:[{scriptClass:"mstrmojo.Button",alias:"btnAddFilter",text:A,cssClass:"btnAddFilter",cssDisplay:"inline-block",getFilterObj:function m(){var p=this.filter,o=p&&p.isEmbedded;if(!p||!p.did){return[];}if(o){return[].concat(p.exp?{did:p.did,t:j.Filter,st:a.Filter,n:p.n,isEmbedded:true,condition:{did:p.did,exp:p.exp}}:[]);}return[{did:p.did,t:j.Filter,st:a.Filter,n:p.n}];},onfilterChange:function(){this.refresh();},buildRendering:function l(){if(!this.filter){this.filter={isEmbedded:true};}var u=this.filter,w=this.parent.parent,t=w.parent,x=t&&t.ide,p;t=x&&x.editor;p=t&&t.oi&&t.oi.mps;this.text=(u.did)?f:A;var q=this.constructor.prototype.buildRendering.call(this);X.toggleClass(this.domNode,"hasFilter",u.did);this.set("enabled",u.isEmbedded&&(!J(p)));var o=!!(u.did||(mstrApp.isVI&&w.parent.useEmbeddedFilter()));w.lblFilter.set("visible",o);w.addFilterBox.set("visible",o);return q;},useRichTooltip:true,updateTooltipConfig:function n(){var q=e.position(this.domNode),p=this.parent.parent.parent,t=p&&p.ide;p=t&&t.editor;var o=p&&p.oi&&p.oi.mps;this.richTooltip=!J(o)?null:{content:mstrmojo.desc(15646,"This metric is not configured to aggregate from the base dataset. Please go to the Metric Options to change this behavior."),cssClass:"vi-regular vi-tooltip-C A-center",left:q.x+q.w+10,top:q.y-4};},onclick:function E(){var t=this.parent.parent.parent,u=this.parent.btnClearFilter,AA=t.dsUnits,x=[],AB=[],AC=mstrApp.getRootController().docCtrl.model,z=AC&&AC.getDataService(),o=this.filter,q=o&&o.exp,w=this;I.forEach(AA&&AA.items,function(AD){if(AD.t===j.Attribute){x.push(AD);}else{if(AD.t===j.Metric){AB.push(AD);}}});var p=function(AE){var AD=G.create();w.filter={did:AD,n:AD,exp:AE.expr,isEmbedded:true};var AG=AE.expr;var AF=function(){w.text=AG?f:A;X.toggleClass(w.domNode,"hasFilter",AG);t.onmetricModify();w.refresh();u.set("filter",w.filter);};if(AG){z.createEmbeddedFilter({expr:g(AG),expJson:AG,filterId:w.filter.did,filterName:w.filter.n},{success:function(){AF();}});}else{w.filter={isEmbedded:true};AF();}};t.openConditionMetricFilterEditor({filter:q,att:x,mx:AB,docModel:AC,invalidItems:[],fnOk:p,onCancel:mstrmojo.emptyFn,browseParam:function(AD){AD.messageID=AC.mid;AD.datasetID=AC.findDatasetIdFromUnit(AD.attributeID);},zIndex:t.zIndex+1});}},{scriptClass:"mstrmojo.Button",alias:"btnClearFilter",text:mstrmojo.desc(2827,"Clear"),cssClass:"btnClearFilter",cssDisplay:"inline-block",buildRendering:function l(){var p=this.filter;var o=this.constructor.prototype.buildRendering.call(this);this.set("visible",p&&p.did);return o;},onfilterChange:function(){this.refresh();},onclick:function(){var p=this.parent.btnAddFilter,o=this.parent.parent.parent;p.set("filter",{isEmbedded:true});this.set("filter",{isEmbedded:true});o.onmetricModify();}}]}]};}}));mstrmojo.ME._HasLevel.EnumEditorComponents=k;}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPreview","mstrmojo.DI.DIMappingPreview","mstrmojo._HasLayout","mstrmojo.DI.DIConstants","mstrmojo.Container","mstrmojo.ui.Checkbox","mstrmojo.DI.ui.dialogs.DIAggregationDialog","mstrmojo.DI.ui.dialogs.DIParseDataDialog","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(221,1442,1995,2969,8972,9117,9118,9119,9120,9121,13899,14661,9113);var F=mstrmojo.array,R=mstrmojo.css,D=mstrmojo.dom,H=mstrmojo.DI.DIHelpers,I=mstrmojo.hash;var Q={raw:0,xtab:1},U=mstrmojo.DI.DIConstants;var L=mstrmojo.desc(8972,"Expand")+" "+mstrmojo.desc(3389,"Preview");var S=mstrmojo.desc(8973,"Collapse")+" "+mstrmojo.desc(3389,"Preview");function K(){var X=this;var W=true;if(!X.model.currentSource){W=false;}else{if(X.sourceTableKey&&X.sourceTableKey!==X.model.currentSource.key){W=false;}}return W;}mstrmojo.DI.DIPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIPreview",markupString:'<div id="{@id}" class="mstrmojo-di-datapreview {@cssClass}" style="overflow-y: hidden; {@cssText}"><div class="cf di-preview-options"></div><div class="di-preview-container"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},sheetsNode:function(){return this.domNode.children[0];},previewNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";}},widgetResized:function E(){if(this._super){this._super();}if(this.preGrid&&this.preGrid.hasRendered){this.preGrid.widgetResized();}},mode:Q.raw,preBuildRendering:function C(){if(this.parent.scriptClass!=="mstrmojo.StackContainer"){this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);}if(this._super){this._super();}},setDimensions:function J(Z,X){var W=parseInt(Z,10);var Y=parseInt(X,10);if(isNaN(W)||isNaN(Y)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.previewNode=(!!mstrApp.isWSStyling?Math.max((W-48),0):Math.max((W-68),0))+"px";this.layoutConfig.w.previewNode=Math.max((Y-36),0)+"px";if(this._super){this._super(W+"px",Y-36+"px");}},onBackButtonClick:function(){var W=false;if(this.mode===Q.xtab){this.set("mode",Q.raw);mstrApp.getRootController().setModalNodes([this.domNode]);W=true;}return W;},onNextButtonClick:function(){mstrApp.getRootController().saveAndPublish();},children:[{scriptClass:"mstrmojo.Box",slot:"sheetsNode",alias:"sheets",cssClass:"di-preview-options-left",children:[{scriptClass:"mstrmojo.ui.Checkbox",cssClass:"preview-toggle",alias:"previewToggler",markupString:'<div id="{@id}" class="mstrmojo-ui-Checkbox {@cssClass}" mstrAttach:click,mousedown,mouseup></div>',checked:true,useRichTooltip:true,isDynamicTooltip:true,postCreate:function A(){var W=mstrApp.getRootController().rootView.currentPage;this.checked=W.isPreviewMaximized;W.attachEventListener("isPreviewMaximizedChange",this.id,"onPreviewChange");},updateTooltipConfig:function(Y){var W=D.getMousePosition(Y);var X={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,top:Math.max(W.y-40,0),left:Math.max(W.x-16,0)};X.content=this.checked?S:L;this.set("richTooltip",X);},moveTooltip:function O(W,Y){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;if(this.hideTooltip){this.hideTooltip();}else{mstrmojo.tooltip.close();}}var a=this,X=W,Z=Y;this._tooltipTimeOut=setTimeout(function(){a.showTooltip(X,Z);},this.tooltipOpenDelay);},oncheckedChange:function P(X){var W=mstrApp.getRootController().rootView.currentPage;if(W){W.togglePreviewMaximized(X.value);}},onmousedown:function V(){R.toggleClass(this.domNode,"hit",true);},onmouseup:function G(){R.toggleClass(this.domNode,"hit",false);},onPreviewChange:function(W){this.set("checked",W.value);}},{scriptClass:"mstrmojo.Label",cssClass:"table-name",alias:"tableName",useRichTooltip:true,isDynamicTooltip:true,markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click,mouseenter,mouseleave></div>',updateTooltipConfig:function(Z){var Y=this.parent.previewToggler.checked?S:L;var W=D.getMousePosition(Z);var X={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPLEFT,content:Y,top:Math.max(W.y-40,0),left:Math.max(W.x-16,0)};this.set("richTooltip",X);},moveTooltip:function O(W,Y){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;if(this.hideTooltip){this.hideTooltip();}else{mstrmojo.tooltip.close();}}var a=this,X=W,Z=Y;this._tooltipTimeOut=setTimeout(function(){a.showTooltip(X,Z);},this.tooltipOpenDelay);},postCreate:function C(){var W=mstrmojo.all.DIModel;W.attachEventListener("SourceInfoFetched",this.id,"update");W.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var X=this.parent.parent;var W=X.model;if(!K.call(X)){return ;}var Y=W.currentSource.sourceInfo.name;this.set("text",Y);},onclick:function(){var W=this.parent.previewToggler;W.set("checked",!W.checked);},onmouseenter:function(){var W=this.parent.previewToggler;R.addClass(W.domNode,"highlight");},onmouseleave:function(){var W=this.parent.previewToggler;R.removeClass(W.domNode,"highlight");}},{scriptClass:"mstrmojo.Label",cssClass:"preview-label",alias:"tableName",bindings:{text:function(){return(!mstrApp.isWorkstation)?mstrmojo.desc(3389,"Preview"):mstrmojo.desc(9113,"Data Preview");}}},{scriptClass:"mstrmojo.Label",cssClass:"subTitle",alias:"subTitle",bindings:{visible:function(){return mstrApp.getRootController().rootView.currentPage.isPreviewOn;}},postBuildRendering:function C(){var X=mstrmojo.all.DIModel;this.update();X.attachEventListener("CurrentSourceChanged",this.id,"update");X.attachEventListener("TransformedPreviewFetched",this.id,"update");X.attachEventListener("MappingsFetched",this.id,"update");var W=mstrApp.getRootController().rootView.currentPage;W.attachEventListener("isPreviewOnChange",this.id,"onPreviewChange");},update:function(){var b=this.parent.parent;var X=mstrmojo.all.DIModel;var Y=X.currentSource;var a=this;if(!K.call(b)){return ;}var W=function(c){var d;if(c<50){d=mstrmojo.desc(13025,"(shows ## rows of data)").replace("##",c);}else{d=mstrmojo.desc(12418," (shows first 50 rows of data)");}a.set("text",d);};var Z=Y.currentTransformations;if(Z&&Z.xtab&&Z.xtab.isCrosstab&&Y.transformedPreview){W(Y.transformedPreview.numOfRows);}else{if(Y.currentPreview){W(Y.currentPreview.numOfRows);}}},onPreviewChange:function N(W){this.set("visible",W.value);}},{scriptClass:"mstrmojo.Label",cssClass:"refresh-time",alias:"timeStamp",postBuildRendering:function(){var X=mstrmojo.all.DIModel;X.attachEventListener("PreviewFetched",this.id,"update");X.attachEventListener("TransformedPreviewFetched",this.id,"update");X.attachEventListener("CurrentSourceChanged",this.id,"update");var W=mstrApp.getRootController().rootView.currentPage;W.attachEventListener("isPreviewOnChange",this.id,"onPreviewChange");this.update();},update:function(){var Y=mstrmojo.desc(12718,"Data Refreshed at");var X=this.parent.parent;var W=X.model;if(!K.call(X)){return ;}if(W.currentSource&&W.currentSource.lastRefreshedTime){Y+=" ";Y+=W.currentSource.lastRefreshedTime.toLocaleString();this.set("text",Y);}},bindings:{visible:function(){var X=(this.parent.parent.model.operationMode===U.operationMode.edit);var W=mstrApp.getRootController().rootView.currentPage.isPreviewOn;return X&W;}},onPreviewChange:function N(W){this.set("visible",W.value);}},{scriptClass:"mstrmojo.HBox",visible:false,cssClass:"di-preview-options-title",alias:"rightOptions",postCreate:function(){this.model=mstrmojo.all.DIModel;this.model.attachEventListener("PreviewFetched",this.id,"makeVisible");this.model.attachEventListener("CurrentSourceChanged",this.id,"makeVisible");this.parent.parent.attachEventListener("modeChange",this.id,"makeVisible");var W=mstrApp.getRootController().rootView.currentPage;W.attachEventListener("isPreviewOnChange",this.id,"makeVisible");this.makeVisible();},makeVisible:function(){var W=this.parent.parent;if(!K.call(W)){return ;}if(W.mode===Q.raw){this.set("visible",true);return ;}this.set("visible",false);},children:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13023,"Wrangle..."),cssClass:"refresh-options",useRichTooltip:true,visible:false,updateTooltipConfig:function(){var W=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular vi-tooltip-D",posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.title,top:W.y-10,left:W.x-10};},onclick:function(){var W=mstrApp.getRootController(),X=W.model.currentSource;if(X.canLaunchWrangler()){W.launchWranglerDialog(X);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(W.model)){W.model.isAddingNewTable=false;W.model.refreshToWrangle=X.tableID;W.refreshSourceTable(X.tableID);}else{W.displayError(mstrmojo.desc(14661,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}},postCreate:function B(){var W=mstrApp.getRootController().model;W.attachEventListener("SourceInfoFetched",this.id,"update");W.attachEventListener("CurrentSourceChanged",this.id,"update");this.update();},update:function(){var a=this.parent.parent.parent;var X=a.model;var Z=X.currentSource;var W=mstrApp.getRootController();var Y;if(!K.call(a)){return ;}this.set("enabled",true);this.title=mstrmojo.desc(13899,"Transform your data with Data Wrangler");Y=Z.canRefine()&&(!mstrApp.isWorkstation);this.set("visible",Y&&false);if(X.refreshToWrangle){W.launchWranglerDialog(X.importSources[X.refreshToWrangle]);X.refreshToWrangle=null;}}}]}]},{slot:"previewNode",scriptClass:"mstrmojo.DI.DIMappingPreview",alias:"preGrid",columns:null,initialRendering:null,postCreate:function(){var W=this.parent.model;this.columns=[];W.attachEventListener("MappingsFetched",this.id,"initPreview");if(mstrApp.isEMMACube){W.attachEventListener("CurrentSourceChanged",this.id,"initPreview");}this.initialRendering=true;},postBuildRendering:function M(){if(mstrmojo.DI.DIMappingPreview.prototype.postBuildRendering){mstrmojo.DI.DIMappingPreview.prototype.postBuildRendering.call(this);}if(this.initialRendering){this.initialRendering=false;this.initPreview();}if(H.isIEOrEdge()){this.disableScroll(false);}},initPreview:function(){var f=this.parent.model,Z,c=[],b,W,Y,e;if(!K.call(this.parent)){return ;}if(!f.currentSource){this.set("visible",false);return ;}var X,g,a;var h=function(l,k){var j=false;if(l&&l.length){if(l[0].hasOwnProperty("clix")){j=F.find(l,"clix",k.ix)>=0;}if(l[0].hasOwnProperty("did")){j=F.find(l,"did",k.did)>=0;}}return j;};if(!f.currentSource.currentTransformations||!f.currentSource.currentTransformations.xtab||!f.currentSource.currentTransformations.xtab.isCrosstab){X=f.currentSource.currentMapping;if(!X){return ;}if(!f.currentSource.currentPreview){return ;}g=f.currentSource.currentPreview.data;a=f.currentSource.currentPreview.dcns;}else{X=f.currentSource.transformedMapping||f.currentSource.currentMapping;if(!X){return ;}e=f.currentSource.transformedPreview||f.currentSource.currentPreview;if(!e){return ;}g=e.data;a=e.dcns;}F.forEach(X,function(j){Z=j.subColumns;if(Z&&Z.length>=1){W=[];F.forEach(Z,function(k){if(k.columnState!==4&&(k.type!=="cmps"||h(a,k))){W.push(k);}});Y=W.length;if(Y>1){b={};I.copy(j,b);b.subColumns=W;c.push(b);}else{if(Y===1){c.push(W[0]);}}}else{if(j.columnState!==4&&(j.type!=="cmps"||h(a,j))){c.push(j);}}});mstrmojo.DI.DIHelpers.setDataIdx(c,a,"dataIdx");var d={mappings:c,dataset:g,supportTimeGeo:true,shapeKeys:f.shapeKeys,renameMapped:function(p,o,q){var k=this,l=k.mappings,t=false,m,n;for(m=0,n=l.length;m<n;m++){if(m!==o){if(q===l[m].alias&&l[o].tp===l[m].tp){t=true;break;}}}if(t){var j=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");mstrApp.getRootController().displayError(j.replace("##",q),null,k.alertTitle);return ;}k.mappings[o].alias=q;mstrApp.getRootController().model.raiseEvent({name:"MappingsFetched"});}};this.set("model",d);if(!d.mappings){return ;}this.populatePreview();if(this.scrollNode&&mstrmojo.dom.isFF){R.addClass(this.domNode,"mstrmojo-firefox-only-scrolltrack");}},bindings:{visible:function(){return this.parent.mode===Q.raw;}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIMappingPanel","mstrmojo.ui.Splitter","mstrmojo.StackContainer","mstrmojo.DI.DITablePanel","mstrmojo.DI.DIPreview","mstrmojo.css","mstrmojo.hash");mstrmojo.requiresDescs(12668);var N=mstrmojo.DI.DIConstants,O=mstrmojo.Widget,F=mstrmojo.css,D=mstrmojo.hash;function G(Q){var P=0,R;for(R in Q){P++;}return P;}var A=function(W,Y,a,V,Z,Q){var X=true,P,U,S,R;for(S=0;S<a.length;S++){W[0].cells[a[S]].className=Q;}if(Z){for(S=0;S<Z.length;S++){P=Q?(Q+(X?" L":" R")):Q;W[1].cells[Z[S]].className=P;if(X&&(Z[S+1]-Z[S]>1)){P=Q?(Q+" M"):Q;for(R=Z[S]+1;R<Z[S+1];R++){W[1].cells[R].className=P;}}X=!X;}}for(U=0;U<Y.length;U++){for(S=0;S<V.length;S++){Y[U].cells[V[S]].className=Q;}}};mstrmojo.DI.DIMappingPage=mstrmojo.declare(mstrmojo.ui.Splitter,null,{cssClass:"mstrmojo-di-mappingpage",markupMethods:{onvisibleChange:O.visibleMarkupMethod,onheightChange:O.heightMarkupMethod,onwidthChange:O.widthMarkupMethod},orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,isPreviewOn:true,isPreviewMaximized:false,prviewMaxHeight:undefined,config:{firstSplit:{v:"100%",min:"296px",max:undefined},secondSplit:{v:"161px",min:"166px",max:undefined},resizeHandle:{v:"5px"}},children:[{slot:"firstSplitNode",scriptClass:"mstrmojo.DI.DITablePanel",bindings:{model:"this.parent.model"}},{slot:"secondSplitNode",scriptClass:"mstrmojo.StackContainer",cssClass:"mappingpage-bottom",alias:"bottomStack",setDimensions:function J(U,Q){var R;var P=parseInt(U,10);var S=parseInt(Q,10);if(isNaN(P)||isNaN(S)){return ;}if(this._super){this._super(U,Q);}this.set("height",U);this.set("width",Q);if(!this.children){return ;}for(R=0;R<this.children.length;R++){if(this.children[R].setDimensions){this.children[R].setDimensions(U,Q);}else{this.children[R].set("height",U);this.children[R].set("width",Q);}}},onremoveChild:function(P){var R=P.value;for(var Q=0;Q<R.length;Q++){R[Q].destroy();}}}],togglePreview:function I(Q){mstrmojo.css.toggleClass(this.domNode,"toggling",true);this.toggleSecondItemVisibility(Q);this.draggable=Q;this.set("isPreviewOn",Q);var P=this.domNode;F.toggleClass(P,"preview-collapse",!Q);setTimeout(function(){F.removeClass(P,["toggling"]);},500);},togglePreviewMaximized:function L(P){var R=this,Q=this.domNode;mstrmojo.css.toggleClass(Q,"toggling",true);if(P){this.layoutConfig.h={firstSplitNode:"296px",resizeHandle:"5px",secondSplitNode:"100%"};}else{this.layoutConfig.h={firstSplitNode:"100%",resizeHandle:"5px",secondSplitNode:"161px"};}this.doLayout();R.set("isPreviewMaximized",P);setTimeout(function(){F.removeClass(Q,["toggling"]);R.widgetResized();},500);},widgetResized:function H(){var Q=this.isPreviewMaximized,P;if(this._super){this._super();}P=this.layoutConfig&&this.layoutConfig.h;if(P){Q=P.firstSplitNode==="296px"&&P.secondSplitNode==="100%";}if(this.bottomStack.selected){this.bottomStack.selected.widgetResized();}this.set("isPreviewMaximized",Q);},toggleSecondItemVisibility:function M(P){if(P){this._super(P);}else{this.layoutConfig.h={firstSplitNode:"100%",resizeHandleNode:"0px",secondSplitNode:"40px"};}this.doLayout();},update:function(Q){if(Q&&Q.ignore){return ;}var P=this.model;var U=null;var S=null;var V,R;if(P.currentSource===null){this.toggleSecondItemVisibility(this.isPreviewOn);}else{if(G(P.importSources)===1){U=P.getAllTableID()[0];}else{U=P.currentSource.key;}V=P.getImportSource(U);R=!!V.currentPreview||!!V.transformedPreview;if(V&&!R){mstrApp.getRootController().selectSourceTable(V.tableID);}if(this.layoutConfig&&this.layoutConfig.h.secondSplitNode==="0px"){this.toggleSecondItemVisibility(this.isPreviewOn);}S=this.previewPageInstances[U];if(!S||S.destroyed){S=this.bottomStack.addChildren([mstrmojo.insert({scriptClass:"mstrmojo.DI.DIPreview",model:P,sourceTableKey:U})])[0];this.previewPageInstances[U]=S;if(S.setDimensions){S.setDimensions(this.bottomStack.height,this.bottomStack.width);}else{S.set("height",this.bottomStack.height);S.set("weight",this.bottomStack.width);}}this.bottomStack.set("selected",S);}},updateFooterButtons:function(){var Q=mstrApp.getRootController(),P=this.model,R=P.getAllTableID(),S=0,V,W,U=Q.model.writable;if(Q.dialogController.pageZIndex<=0){mstrmojo.array.forEach(R,function(X){V=P.getImportSource(X);if(V){W=V.getCurrentMappings(function(Y){return Y.selected;});if(W&&W.length){S+=W.length;}}});Q.rootView.showFooter({next:{enabled:S>0&&(U!==0||P.isManagedCube===true)}});Q.rootView.showFooter({save:{enabled:S>0&&(U!==0||P.isManagedCube===true)}});}},getSelectedChild:function(){return this.bottomStack.selected;},preBuildRendering:function K(){this.setDimensions(parseInt(this.parent.layoutNode.offsetHeight,10),this.parent.layoutNode.offsetWidth);if(this._super){this._super();}this.update();},postCreate:function(){var P=this.model;this.previewPageInstances={};P.attachEventListener("CurrentSourceChanged",this.id,"update");P.attachEventListener("PreviewFetched",this.id,"update");P.attachEventListener("PreviewNotFetched",this.id,"update");P.attachEventListener("MappingsFetched",this.id,"updateFooterButtons");P.attachEventListener("removeSourceTable",this.id,"removeSourceTablePreview");this.attachEventListener("scrollPreviewToCurItem",this.id,"scrollPreviewToCurItem");this.attachEventListener("highlightColumns",this.id,"highlightColumns");},removeSourceTablePreview:function(P){if(this.previewPageInstances[P.tableID]){this.bottomStack.removeChildren(this.previewPageInstances[P.tableID]);delete this.previewPageInstances[P.tableID];}},highlightColumns:function E(P){var Q;return function(){var X=P.tableId;var h=this.getSelectedChild();if(!h||h.sourceTableKey!==X){return ;}var R=h.preGrid,V=R.columns,m=R.headerRows,l=R.bodyRows,f=D.walk("0.cells.length",m),Y=P.data.length,U=P.data,b=[],Z=[],a=0,c=0,W,S=[],g,e,d;if(V.length===0){return ;}for(g=0;g<f;g++){if(m[0].cells[g].className){b.push(g);}}if(m[1].cells.length>0){for(g=0;g<m[1].cells.length;g++){if(m[1].cells[g].className){S.push(g);}}}for(g=0;g<l[0].cells.length;g++){if(l[0].cells[g].className){Z.push(g);}}if(b.length>0){window.clearTimeout(this.clearHighlight);A(m,l,b,Z,S,"");b=[];Z=[];S=[];}for(g=0;g<f;g++){for(e=0;e<Y;e++){if(V[g].headerWidget.name===U[e].n){b.push(g);Z.push(g+a);if(V[g].headerWidget.data.subColumns&&V[g].headerWidget.data.subColumns.length>1){W=V[g].headerWidget.data.subColumns.length;S.push(c);S.push(c+W-1);for(d=1;d<W;d++){Z.push(g+a+d);}}break;}}if(V[g].headerWidget.data.subColumns&&V[g].headerWidget.data.subColumns.length>1){W=V[g].headerWidget.data.subColumns.length;a+=(W-1);c+=W;}}A(m,l,b,Z,S,"highlight");this.clearHighlight=window.setTimeout(function(){A(m,l,b,Z,S,"");},1000);}.call(this);},scrollPreviewToCurItem:function B(Q){var S=Q.tableId;var W;var V=this.getSelectedChild();if(!V||V.sourceTableKey!==S){return ;}var R=V.preGrid;var U=V.preGrid.columns.length;if(!U||U<=0){return ;}W=R.getMappingColumnOffset(Q.data);var P={};P.scrollLeft={isStyle:false,start:R.scrollNode.scrollLeft,stop:W,ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:P,duration:20,interval:10,target:R.scrollNode})).play();},onNextButtonClick:function(){var P=this.getSelectedChild();if(P&&P.scriptClass==="mstrmojo.DI.DIPreview"){P.onNextButtonClick();}else{mstrApp.getRootController().saveAndPublish();}},onSaveButtonClick:function(){mstrApp.getRootController().save();},onCancelButtonClick:function(){var P=mstrApp.getRootController(),Q=P.getModel().isCubeSaved;if(Q){P.wrapUpDataImport(false);}else{P.cancelApplication();}return true;},onHelpButtonClick:function C(){return"Preview_page.htm";},onBackButtonClick:function(){var R=mstrApp.getRootController();var P=R.model;var W;var Q=this.getSelectedChild();if(P.currentSource){var V=P.currentSource.tableID;var U=R.navigationController.getPreviousPageSlot(V,N.pageType.emmaPreview);if(Q.onBackButtonClick&&!Q.onBackButtonClick()){if(U){var S=U.get();if(S){R.showPage(S.pageType,null,U);}else{var X=U.getConfig();if(X){R.showPage(X.pageType,null,U);}}}else{W=P.currentSource.type;if(W===N.sourceType.querybuilder){mstrApp.getRootController().showPage(N.pageType.database,{sourceType:N.sourceType.querybuilder,type:P.currentSource.xdaType,extParams:{tableID:P.currentSource.tableID}});}}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.ObjectInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(629,2148,3377,9582,12173,12179,12852);var J=mstrmojo.hash,m=mstrmojo.array,M=mstrmojo.expr,j=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricDataService,d=mstrmojo.mstr.EnumDSSXMLObjectTypes,p=mstrmojo.ME.Enum.DYNAMIC_DIMTY,O=mstrmojo.ME.Enum.UI_OBJECT_TYPE;var V,Y;var f=function(E){if(E.onmetricModify){E.onmetricModify();}},c=function(){if(Y.updateScrollbars){Y.updateScrollbars();}};var Z=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.ME.MetricToken.quotes,a=mstrmojo.ME.MetricToken.unquotes;var e=function(){var E={"9C374236DD9F11D3B98100C04F2233EA":"Forecast","9C374233DD9F11D3B98100C04F2233EA":"Growth","9C374233DD9F11D3B98100C04F2233EA":"Trend","677E93B2786B11D4B82F00C04F356781":"Case",C41C34F0786B11D4B82F00C04F356781:"CaseV",B2C0FA4420C711D6AD1400C04F0423DE:"IF","8107C324DD9911D3B98100C04F2233EA":"Not"};return E.hasOwnProperty(this.fctOi.did);};var h=function(w){var u=w.split(",")[0],t=u.replace(/\d$/,""),E=u.replace(t,"");return{prefix:t,startAt:parseInt(E,10)};};var G=function(AC){var AB=function(){if(AC.isRepeated){var w=this.parent.dataGrid.ctxtBuilder.itemWidgets[this.parent.idx].labelWidget;if(w){w.set("count",this.getSelectedObjects().length);}}};var t=Y.getParamObjectTypes();var E={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",slot:"0,0",cssClass:"mstrmojo-ME-param",dtp:AC.dtp,isDME:Y.isDME,hideEditButton:function(w){return true;},hideDelButton:function(w){return this.isFull;},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},browsableTypes:t.concat([M.TP.FOLDER]).join(","),folderLinksContextId:17,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),getCandidatesThroughTaskCall:function AA(AD,w){AD.objectType=t.join(",");AD.rootFolderType=39;AD.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AD,w);},postCreate:function(AG){var AF=this.parent.dataGrid,AI=AF&&AF.parent;this.noCache=AI.noCache;if(!this.noCache){this.candidates=AI.getCandidates(function(AJ){return mstrmojo.array.indexOf(t,AJ.t)>-1;});var w=this.candidates.items||[];if(Y.isDME){w=Y.replaceAttributeWithForms(m.filter(w,function(AJ){return m.indexOf(t,AJ.t)>-1&&AJ.st!==M.STP.NDE;}));}for(var AE=0,AD=(AC.items||[]).length;AE<AD;AE++){var AH=AC.items[AE];if(AH&&AH.t===mstrmojo.ME.Enum.UI_OBJECT_TYPE.Sub_Expression){w.push(AH);}}this.candidates.items=w;if(!AG){AF.candidatesListener.push(this.id);}}if(!AG){this.set("items",AC.items);}},onitemchange:function(){f(this.parent.dataGrid.parent);},onadd:function u(){AB.call(this);},onremove:function z(){AB.call(this);},obCfg:{folderLinksContextId:17,browsableTypes:t.concat([M.TP.FOLDER]).join(",")}}],getTokens:function(){var AF=this.paramInput.getSelectedObjects(),AG,w=AF.length,AE,AH=[],AD;if(w>0){for(AE=0;AE<w;AE++){AG=AF[AE];if(AG.state===mstrmojo.Enum_OIB_States.VALID&&AG.did){if(AG.t===O.Sub_Expression){AH=AH.concat(AG.tks);}else{AD={v:Z(AG.n)};if(AG.t===21){AD.oi=AG.oi;AD.exv=AG.fmdid||AG.exv;AD.extp=8;AD.v=AG.fnm?Z(AG.oi.n)+"@"+Z(AG.fnm):AD.v;}else{AD.oi=AG;}AH.push(AD);}}else{AD={v:L(AC.dtp,AG.n)};AH.push(AD);}AH.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}AH.pop();}return AH;}};var x=E.children&&E.children[0];if(!AC.isRepeated){x.cssClass="mstrmojo-ME-ObjectInputBox-param singleObject noVerify";x.maxObjectCount=1;}else{x.cssClass="mstrmojo-ME-ObjectInputBox-param noVerify";}return E;};var C=function(u){var t=mstrmojo.all[V];var E=null;if(u.isParam){E=t.getParamWidget(u);}else{switch(u&&u.dtp){case 11:E={scriptClass:"mstrmojo.Pulldown",cssClass:"bool mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"False",did:"0"},{n:"True",did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(w){var x=this.data;this.value=!!x.v?(x.v==="False"?0:-1):(x.dfv||0);},getTokens:function(){var w=this.data;if(!A.isValEqual(this.value,w.dfv)){return[{v:w.n},{v:"=",isDelimiter:true},{v:A.isValEqual(this.value,"-1")?"True":"False"}];}return[];},onvalueChange:function(){f(this.parent.dataGrid.parent);}};break;case -2:E=t.getBreakByWidget(u);break;case -1:E=t.getSortByWidget(u);break;default:E=t.getTextWidget(u);break;}}E.alias="inputWidget";return E;};var X=function(w,E,t){var u={scriptClass:"mstrmojo.ui.List",alias:"labelWidget",cssClass:"mstrmojo-FunctionWidzard-labels",count:w.items&&w.items.length||0,buildItems:function(){var x=[],AA=this.count,AC=(w.isParam?"*":"")+":",AB=w.np;if(AB){for(var z=0;z<=AA;z++){x.push({n:AB.n+(AB.startAt+z)+AC,title:w.desc||""});}}else{x.push({n:(w.dn||w.n)+AC,title:w.desc||""});}this.set("items",x);},postCreate:function(){this.buildItems();},oncountChange:function(){this.buildItems();}};return u;};var P=function(x){var t=mstrmojo.all[V];return{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"breakByInput",cssClass:"mstrmojo-ME-breakby",isDME:t.isDME,dtp:x.dtp,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),folderLinksContextId:16,browsableTypes:[M.TP.FOLDER,M.TP.ATTR].join(","),getCandidatesThroughTaskCall:function w(AA,z){AA.rootFolderType=39;AA.blockCount=AA.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(AA,z);},obCfg:{folderLinksContextId:16,browsableTypes:[M.TP.ATTR,M.TP.FOLDER].join(",")},postCreate:function(AB){var z=this.parent.dataGrid,AC=z&&z.parent;this.noCache=AC.noCache;if(!this.noCache){this.candidates=AC.getCandidates(function(AF){return AF.t===d.Attribute||AF.t===d.Consolidation;});if(this.isDME){this.candidates.items=p.getItems("breakby").concat(this.candidates.items);}if(!AB){z.candidatesListener.push(this.id);}}if(!AB){var AA=x.items||[],AD=t.oi.tks,AE=!AD.met||AD.items&&(AD.items.length===0);if(AE&&this.isDME){AA.push(p.getAutomaticDimtyObject());}this.set("items",AA);}},onitemchange:function(){f(this.parent.dataGrid.parent);},onadd:function E(){c();},onremove:function u(){c();},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},getTokens:function(){var AC=this.getSelectedObjects(),z=AC.length,AB,AE=[];if(z>0){AE.push({v:"BreakBy"});AE.push({v:"=",isDelimiter:true});AE.push({v:"{",isDelimiter:true});for(AB=0;AB<z;AB++){var AD=AC[AB],AA;if(j.isDimty(AD.n)){AA={v:AD.n};}else{if(/^@/.test(AD.did)){AA={v:AD.did};}else{AA={v:Z(AD.n),oi:AD};}}AE.push(AA);if(AB!==(z-1)){AE.push({v:",",isDelimiter:true});}}AE.push({v:"}",isDelimiter:true});}return AE;}};};var F=function(w,x){var t=w.length,E;for(E=0;E<t;E++){var u=mstrmojo.array.find(w[E].fns,"n",x);if(u>-1){return J.clone(w[E].fns[u]);}}return null;};var S=function(u,w){var t,E=w.length,x=u&&u.length;if(x>0){for(t=0;t<x-1;t++){u[t].items=[w[t]];u[t].dynamicVerify=true;}u[x-1].items=[];for(t=x-1;t<E;t++){u[x-1].items.push(w[t]);u[x-1].dynamicVerify=true;}}return u;};var N=function(t,u,z){var x={items:[]},w={301:"}",302:")"}[z],E=u[++t];while(E){if(E.oi){if(z==302){E.oi.selFrm=E.exv;E.oi.asc=E.asc;}x.items.push(E.oi);}if((E=u[++t]).v===w){break;}}return x;};mstrmojo.ME.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.FunctionWizard",cssClass:"mstrmojo-Editor-me mstrmojo-FunctionWidzard",title:mstrmojo.desc(9582,"Function Editor: "),help:"Function_Arguments_dialog_box.htm",fctOi:null,fctArgs:null,fctArgsDataGridCssClass:"functionArgs",fctSyntax:"",fctDesc:"",hiddenPs:[],bindings:{candidates:"this.opener.candidates"},getParamObjectTypes:function g(){var E=[M.TP.METRIC,M.TP.FACT];if(this.isAgg(this.fctOi)){E.push(M.TP.ATTR);}return E;},getCandidates:function R(u){var t=this.candidates,E;if(t){E=mstrmojo.array.filter(t.items,u);return{items:E,isComplete:t.isComplete};}return{};},_set_candidates:function(z,t){this.candidates=t;if(this.hasRendered&&this.visible){var w=this.argsGrid,x=w.candidatesListener,E=x.length,u;for(u=0;u<E;u++){if(mstrmojo.all[x[u]]){mstrmojo.all[x[u]].postCreate(true);}}}if(this._super){this._super(z,t);}return true;},postProcessParamsFromToken:function(w){if(this.refOi&&this.candidates){var x=this.refOi.did;this.refOi=mstrmojo.array.filterOne(this.candidates.items,function(AC){return AC.did===x;});}var AB=[],z,u,t=w.pars,E=(t&&t.length)||0;for(u=0;u<E;u++){z=J.copy(t[u]);z.isParam=true;if(u===0&&this.refOi){z.items=[this.refOi];this.refOi=null;}AB.push(z);}if(w.rpc>0&&!e.call(this)){z.isRepeated=true;var AA=h(z.n);z.np={n:AA.prefix,startAt:AA.startAt||1};}return AB;},postProcessProsFromToken:function(w){var x=[],u,E=(w.pros&&w.pros.length)||0,t=function(z){if(m.indexOf(mstrmojo.ME.Enum.NonExposableParams,z.n)>-1){z.itemCss="hidden";}return z;};for(u=0;u<E;u++){x.push(t(J.copy(w.pros[u])));}return x;},buildSyntax:function(u){var t=[],w,E;t.push(u.n);t.push("(");E=(u.pars&&u.pars.length)||0;for(w=0;w<E;w++){t.push(u.pars[w].n);if(w!==(E-1)){t.push(", ");}}t.push(")");return t;},onOpen:function(){V=this.id;this._setupCandidatesCache();var u=this.getArgsFromTokens();var x=this,w=u||this.fctOi;var E=this.buildSyntax(w),z=this.postProcessParamsFromToken(w);z=z.concat(this.postProcessProsFromToken(w));if(w.sqt===5){z.push({n:"BreakBy",dn:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:"Break By is a parameter representing the break by levels for this function.",items:w.bb&&w.bb.items});}if(w.ios){z.push({n:"SortBy",dn:mstrmojo.desc(12852,"Sort By"),dtp:-1,desc:"Sort By is a parameter representing the sort by levels for this function.",items:w.sb&&w.sb.items});}z=z.concat(this.hiddenPs||[]);x.set("fctArgs",z);x.set("fctSyntax",E.join(""));x.set("fctDesc",mstrmojo.ME.FunctionInfo.getDescAndExample(this.fctOi).desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(w.h));x.set("title",this.insertMode?w.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);x.set("fctName",w.n);this.raiseEvent({name:"fctDidChange",did:this.fctOi.did});this.set("isAggFunction",this.isAgg());this.set("ios",w.ios);if(this._super){this._super();}if(this.isAggFunction){var t=this.argsGrid.ctxtBuilder.itemWidgets;if(t&&t.length>0){this.metricLCT.set("labelWidth",t[0].labelWidget&&t[0].labelWidget.domNode.clientWidth+"px");}}},getArgsFromTokens:function Q(){if(!this.oi||this.oi.tks.items.length===0){return null;}var w={},z=this.oi.tks.items,AN=z.length,AI=[],t=[],AH=0,E=[],AM;for(AM=0;AM<AN;AM++){var AB=z[AM],u=AB.tp,AP=AB.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(AB.v)&&(AB.v!=="("&&AB.v!==")")||AB.v==="&gt;"||AB.v==="&lt;"){continue;}switch(AP){case 65536:w.n=AB.oi?AB.oi.n:AB.v;var AC=this.fctOi=F(this.functions,w.n);AI=AC.pars||[];t=AC.pros||[];w.rpc=AC.rpc;w.sqt=AC.sqt;w.ios=AC.ios;break;case 196608:var AL=[],AG=[],AE,AK,AJ;AB=z[++AM];while(AB&&(AB.sctt===196608||AB.sctt===196609)){if(AB.sctt===196608){AG.push(AB);}else{AL.push(AG);AG=[];}AB=z[++AM];}AL.push(AG);AL[AL.length-1].pop();for(AJ=0;AJ<AL.length;AJ++){AG=AL[AJ];var x={n:""};AE=AG.length;if(AE===1){AB=AG[0];if(AB.extp){x={n:AB.v,did:AB.oi.did+"@"+AB.exv,exv:AB.exv,extp:AB.extp,oi:AB.oi,t:21,tk:AB};}else{var AF=Math.min(AI.length-1,E.length),AO=a(AB,AB.v,AI[AF].dtp);x=AB.oi||{n:AO,v:AO,t:O.Sub_Expression};}}else{for(AK=0;AK<AE;AK++){x.n+=AG[AK].v+" ";}x.v=x.n;x.did=x.n;x.t=O.Sub_Expression;x.tks=AG;}E.push(x);}break;case 131072:if(u==301){var AD={};AB=z[++AM];while(AB){if(AB.tp!=282){if(AB.oi){AD.items=AD.items||[];AD.items.push(AB.oi);}else{if(AB.tp===64){AD.items=AD.items||[];var AA=AB.v+z[++AM].v;AB=z[AM+1];if(AB.tp===43||AB.tp===45){AA+=z[++AM].v;AA+=z[++AM].v;}AD.items.push(p.getDimtyObject(AA,this.isDME));}}}if((AB=z[++AM])["v"]==="}"){break;}}w.bb=AD;}else{if(u==302){w.sb={};}else{if(u==259){mstrmojo.array.forEach(t,function(AS){if(AS.n===z[AM].v){AM=AM+2;var AR=z[AM],AQ=[];do{AQ.push(z[AM++].v);if(z[AM].sctt===131072&&z[AM].tp===62||z[AM].sctt===131073){break;}}while(true);AQ=AQ.join("");AQ=a(AR,AQ,AS.dtp);AS.v=AQ;return false;}});}}}break;}}w.pars=S(AI,E);w.pros=t;return w;},getTokens:function H(){var x=this.argsGrid.ctxtBuilder.itemWidgets,AB=x.length,AA,AF,AC=[],u=[],AG=[],AD,z,t,E,AE=this.fctOi;for(AA=0;AA<AB;AA++){AF=x[AA].inputWidget;if(AF.data.isParam){u.push(AF.getTokens());}else{AC.push(AF.getTokens());}}AG.push({v:AE.n,oi:AE});AB=AC.length;if(AB>0){E=false;AG.push({v:"<",isDelimiter:true});for(AA=0;AA<AB;AA++){AD=AC[AA];t=AD.length;if(t===0){continue;}E=true;for(z=0;z<t;z++){AG.push(AD[z]);}AG.push({v:",",isDelimiter:true});}AG.pop();if(E){AG.push({v:">",isDelimiter:true});}}AB=u.length;AG.push({v:"(",isDelimiter:true});E=false;for(AA=0;AA<AB;AA++){AD=u[AA];t=AD.length;if(t===0){continue;}E=true;for(z=0;z<t;z++){AG.push(AD[z]);}AG.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}if(E){AG.pop();}AG.push({v:")",isDelimiter:true});for(AA=0,AB=AG.length;AA<AB;AA++){AG[AA].isNew=true;}return AG;},getMetricDefAsTokens:function q(){var E=this.getTokens();if(this.getLCTDefAsTokens){E=E.concat(this.getLCTDefAsTokens());}return E;},handleValidation:function o(w){if(w&&!w.rjec){return ;}var u=w&&w.rjec==="-2147214846";if(u){var t=w.items,x=mstrmojo.array.find(t,"sta",-1),E=t[x].v;mstrmojo.alert('More than one object with the name "#" found. Browse to select the object or retype to select it from the search autocomplete list.'.replace("#",E));}else{mstrmojo.alert(w&&w.rjed);}},getPROPBuilder:function b(){return X;},getDTPBuilder:function k(){return C;},getParamWidget:function B(E){return G(E);},getBreakByWidget:function U(E){return P(E);},getSortByWidget:function l(E){return this._super();},getTextWidget:function W(E){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(t){var u=this.data;this.value=u.v||((u.dfv||u.dfv===0)?u.dfv:"");},getTokens:function(){var t=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==t.dfv){return[{v:t.n},{v:"=",isDelimiter:true},{v:L(t.dtp,this.value)}];}return[];},onvalueChange:function(){f(this.parent.dataGrid.parent);}};},getDataGridRef:function D(){return{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:this.fctArgsDataGridCssClass,makeObservable:true,banding:false,columns:[{headerText:"Property Name",dataWidgetBuilder:this.getPROPBuilder(),colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:this.getDTPBuilder(),colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"},onadd:function(){c();}};},init:function n(E){this.children=this.getChildren();this._super(E);V=this.id;Y=this;},isAgg:function K(E){return(E||this.fctOi||{}).sqt===1;},getChildren:function I(){return[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,this.getDataGridRef(),this.getLCTComponent(),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode || this.parent.simplex",text:function(){return this.parent.fctDesc;}}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef];}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIModel","mstrmojo.DI.DIRepublishScheduleEditor","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12394,12836,12837,14767);var Z=mstrmojo.array,W=mstrmojo.hash,A=mstrmojo.DI.DIHelpers,b=mstrmojo.DI.DIConstants,J="CDE80A9048DB5E6E1B1A378503859835";var U=0,Y=1;var F={success:function K(c){mstrApp.getRootController().dataService.set("emmaIRRMessageID",c.msgid);}};function Q(d){var c=[];if(!d){return c;}if(d.fn===mstrmojo.expr.FN.AND||d.fn===mstrmojo.expr.FN.OR||d.fn===mstrmojo.expr.FN.NOT){if(Object.prototype.toString.call(d.nds)==="[object Array]"){Z.forEach(d.nds,function(e){c=c.concat(Q(e));});}}else{if(d.a){c.push(d.a.did);if(d.a2){c.push(d.a2.did);}}}return c;}function I(g,e){var c,h,f,d=0;g=g&&g.nd;if(g===undefined){return null;}if(g.op&&(g.op.fnt===mstrmojo.expr.FN.AND||g.op.fnt===mstrmojo.expr.FN.OR)){if(Object.prototype.toString.call(g.nds)==="[object Array]"){c={fn:g.op.fnt,et:g.et,nds:[]};Z.forEach(g.nds,function(j){c.nds.push(I(j,e));});}else{if(!g.nd){return null;}c=I(g.nd,e);}}else{if(g.op.fnt===mstrmojo.expr.FN.NOT){g=g.nds[0].nd;g.not=true;}c={fn:g.op.fnt,et:g.et,not:g.not||false};Z.forEach(g.nds,function(j){d=j.cst&&j.cst.ddt;});Z.forEach(g.nds,function(j){if(j.fmshct){h=c.a?"a2":"a";f=c.fm?"fm2":"fm";c[h]={did:j.fmshct.atid,n:e[j.fmshct.atid],t:12};c[f]={did:j.fmshct.fmid,n:e[j.fmshct.fmid],t:21,dtp:d||j.ddt};}else{if(j.cst){c.cs=c.cs||[];c.cs.push({v:j.cst.v,dtp:j.cst.ddt});}}});}return c;}mstrmojo.DI.controller.DIScheduleController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIScheduleController",getCubeSubscription:function(e){var d=mstrApp.getRootController();var c={success:function(f){d.getModel().populateSubscriptions(f);},failure:function(f){d.displayError(f.message||f.getResponseHeader("X-MSTR-TaskFailureMsg"));}};d.dataService.getObjectSubscriptions(mstrmojo.func.wrapMethods(c,e),{detailFlag:5});},getAvailableTriggers:function(e){var d=mstrApp.getRootController();var c={success:function(g){var f=d.model;f.getSchedule().populateTriggers(g);},failure:function(f){d.displayError(f.message||f.getResponseHeader("X-MSTR-TaskFailureMsg"));}};d.dataService.getAvailableTriggers(mstrmojo.func.wrapMethods(c,e),{});},getSubscriptionDefinition:function(c,e){var d=mstrApp.getRootController();d.dataService.getSubscriptionInfo(e,{subscriptionID:c});},launchScheduleEditor:function(){var j=this,e=mstrApp.getRootController(),f=mstrApp.getRootController().getModel(),g=f.getSchedule(),h=null,d;f.rawFilter=undefined;f.updateFilterUsedInTable=function l(){var o=Q(f.filter),n=o.length>0,m=f.isFilterInTable={};W.forEach(f.IRRTableAttrs,function(p,q){m[q]=true;Z.forEach(o,function(t){if(Z.indexOf(p,t)<0){m[q]=false;return false;}});m[q]=m[q]&&n;});};function c(){h=e.showDialog(b.dialogType.publishStatusDialog,{zIndex:999,model:f});}function k(){mstrmojo.hash.forEach(f.importSources,function(n){if(n.xdaType===b.xdaType.qbSingleTable){d=true;}});if(d){j.getEmmaIRRAttributes({success:function m(t){var o=[],w,x={},q={},n={},u;Z.forEach(t.ts,function p(AA){Z.forEach(AA.amps,function z(AC){u=AC.atid;w=AA.tbid;x[w]=x[w]||[];x[w].push(u);if(Z.find(o,"did",u)===-1){o.push({n:AC.atnm,did:u,t:12});}q[u]=AC.atnm;Z.forEach(AC.afmps,function AB(AD){q[AD.fmid]=AD.fmn;n[u]=n[u]||[];if(Z.find(n[u],"did",AD.fmid)<0){n[u].push({did:AD.fmid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(AD.bft),n:AD.fmn,t:21});}});});});f.filter=I(f.rawFilter,q);f.IRRAttributes=o;f.IRRTableAttrs=x;f.IRRAttrForms=n;f.updateFilterUsedInTable();c();}});}else{f.IRRAttributes=[];c();}}this.getAvailableTriggers({success:function(){if(g.subsID){j.getSubscriptionDefinition(g.subsID,{success:function(o){var p,q,m;g.set("trgID",o.trgID);g.set("trgName",o.trgName);m=Z.find(g.availableTriggers,"id",o.trgID);if(m<0){g.availableTriggers.push({n:o.trgName,id:o.trgID});g.set("curTrg",{n:o.trgName,id:o.trgID});}else{g.set("curTrg",g.availableTriggers[m]);}g.set("subsName",o.subsName);q=o.delta;if(q){mstrApp.getRootController().dataService.set("emmaIRRMessageID",null);j.createEmmaIRRReportInstance(f.IRRid,q,{success:function t(z){var w=z.def,AH,AA,x=b.xdaType,AE,AD,AB=[],AG;Z.forEach(w.datap,function AC(AI){p=f.getImportSource(AI.tbid);if(!p){AB.push(AI.tbid);return true;}p.checked=true;if(AI.crt!==undefined){p.refreshType=parseInt(AI.crt,10);}AA=null;AH=AI.srce;if(AH){switch(AH.xt){case x.qbSingleTable:AA={tableName:AH.tbn};break;case x.excel:case x.text:AE=AH.file_description;if(AE&&AE.url){AD=A.getURLFileName(AE.url);}else{AD=AH.tbal;}AA={tableName:AD};break;}}p.alternateSource=AA;});AG={success:function AF(){var AI=window.localStorage,AK,AJ=true;if(AI){AK=AI.getItem("irr"+g.subsID);if(AK==="true"){AJ=true;}if(AK==="false"){AJ=false;}}f.rawFilter=w.f.exp;k();j.setAdvMode(true);j.setOldIsAdvMode(true);j.setAdvState(AJ);},failure:function u(AI){e.displayError(mstrmojo.desc(12394,"Cannot delete source table."),false,(AI&&AI.message)||"");}};if(AB.length>0){j.deleteEmmaIRRSourceTable(AB,AG);}else{AG.success();}}});return ;}Z.forEach(o.ts,function n(u){p=f.getImportSource(u.did);if(!p){return true;}p.checked=true;if(u.crb!==undefined){p.refreshType=parseInt(u.crb,10);p.checked=true;}if(u.ac!==undefined){p.executeAction=parseInt(u.ac,10);p.checked=true;}});k();},failure:function(m){e.displayError(mstrmojo.desc(12836,"Cannot get definition about this subscription"),false,m.message||m.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{W.forEach(f.importSources,function(m){m.checked=m.canSubscribe();});k();}}});},createSchedule:function(o){var j=mstrApp.getRootController(),m=j.getModel(),n=m.getSchedule(),e=m.cubeID,d=n.subsID,k=n.subsName,g=[],c=[],l=[];var h={subscriptionName:k,contentID:e};var f={success:function(q){var t=q.subsID,p=window.localStorage;m.raiseEvent({name:"CreateScheduleUpdate",res:q});if(t&&p){p.setItem("irr"+t,n.showAdvanceState);}},failure:function(p){m.raiseEvent({name:"CreateScheduleUpdate",res:p});}};if(!n.curTrg){return ;}mstrmojo.hash.forEach(m.importSources,function(p){if(p.checked&&p.canSubscribe()){g.push(p.tableID);c.push(p.refreshType);l.push(1);}});h.tableIDs=g.join();h.refreshTypes=c.join();h.executeActions=l.join();if(n.curTrg.isHidden){h.triggerPattern=n.curTrg.id;}else{h.triggerID=n.curTrg.id;}if(d){h.subscriptionID=d;}if(this.isAdvMode()&&(this.hasRefreshFilter()||this.hasAlternateSource())){h.hasIRR=1;}if(this.getOldIsAdvMode()){h.oldHasIRR=1;}h.sendNow=n.isSendNow;j.dataService.saveEMMASchedule(mstrmojo.func.wrapMethods(f,o),h);},removeSubscription:function(d,c){mstrApp.getRootController().dataService.removeSubscription(c,{subscriptionID:d.join()});},getScheduleStatus:function(d,h){var f=mstrApp.getRootController();var e=f.getModel();var g={dids:d.join(),type:3,size:5};var c={success:function(j){e.populateScheduleStatus(j);}};f.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(c,h),g);},getScheduleStatusBySubscription:function(d,h){var f=mstrApp.getRootController(),e=f.getModel(),g={dids:d.join(),type:255,size:5};var c={success:function(j){e.populateScheduleStatus(j);}};f.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(c,h),g);},updateScheduleAndStatus:function(d){var c=mstrApp.getRootController();c.getScheduleController().getCubeSubscription({success:function(){var f=c.getModel(),g=f.subsInfo,e=[];Z.forEach(g,function(h){e.push(h.did);});if(e.length>0){c.getScheduleController().getScheduleStatusBySubscription(e,d);}else{if(d&&d.success){d.success();}if(d&&d.complete){d.complete();}}},failure:function(e){if(d&&d.failure){d.failure(e);}if(d&&d.complete){d.complete();}}});},showScheduleStatusDialog:function(d,g){var c=mstrApp.getRootController().getModel();var f=c.subsStatus&&c.subsStatus[d];if(f){f=f.slice().reverse();}else{f=[];}var e={subsStatus:f};if(g){e.onOK=g;}mstrApp.getRootController().showDialog(mstrmojo.DI.DIConstants.dialogType.refreshHistoryDialog,e);},selectAlternateSourceURL:function(f,e,j){var d=mstrApp.getRootController(),h=mstrApp.getRootController().dataService;var c={success:function(l){if(l.vt===1){if(j.success){j.success(l);}if(j.complete){j.complete();}}else{var k=A.parseAlternateSourceValidationResults(l.cols);d.showDialog(b.dialogType.alternateSourceValidateDialog,{items:k,zIndex:d.rootView.zIndex+10});}},failure:function(k){if(j.failure){j.failure(k);}if(j.complete){j.complete();}}};var g={success:function(k){if(k&&k.msgid){h.set("emmaIRRMessageID",k.msgid);}h.validateEmmaIRRAlternateSource(c,{tbid:f});},failure:function(k){if(A.isWS()){d.displayError(null,false,(k&&k.message)||"",null,mstrmojo.desc(14767,"Data from URL"),mstrmojo.desc(null,"Alternate source cannot be set."));}else{d.displayError(mstrmojo.desc(12837,"Cannot set alternate source."),false,(k&&k.message)||"");}}};this.editEmmaIRRSourceTableURL(f,null,"0",e,g);},isAdvMode:function L(){return mstrApp.rootController.model.getSchedule().isScheduleAdvanced;},setAdvMode:function D(d){var c=mstrApp.rootController.model,e=c.getSchedule();if(e.isScheduleAdvanced!==d){e.set("isScheduleAdvanced",d);}},setAdvState:function R(d){var c=mstrApp.rootController.model,e=c.getSchedule();e.set("showAdvanceState",d);},isAdvState:function G(){return mstrApp.rootController.model.getSchedule().showAdvanceState;},getOldIsAdvMode:function H(){return mstrApp.rootController.model.getSchedule().oldIsScheduleAdvanced;},setOldIsAdvMode:function a(d){var c=mstrApp.rootController.model,e=c.getSchedule();if(e.oldIsScheduleAdvanced!==d){e.oldIsScheduleAdvanced=d;}},createEmmaIRRReportInstance:function C(d,e,h){var g=mstrApp.getRootController().dataService,c;if(g.emmaIRRMessageID){return ;}c={success:function f(j){g.set("emmaIRRMessageID",j.msgid);}};g.createEmmaIRRReportInstance(mstrmojo.func.wrapMethods(c,h),{reportID:d||J,delta:e||""});},createEmmaIRRSourceTables:function B(g,d,c,h){var f=mstrApp.getRootController().dataService,e={};if(g){e.brid=g;}e.tbids=d.join(",");e.crts=c.join(",");f.createEmmaIRRSourceTables(mstrmojo.func.wrapMethods(F,h),e);},editEmmaIRRSourceTableURL:function O(f,d,e,c,j){var h=mstrApp.getRootController().dataService,g={sourceType:U,tables:f};if(d){g.refreshTypes=d;}if(e){g.deleteTables=e;}if(c){g.url=c;}h.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,j),g);},editEmmaIRRSourceTableSingleTable:function M(h,e,g,c,f,l,k){var j=mstrApp.getRootController().dataService,d={sourceType:Y,tables:h};if(e){d.refreshTypes=e;}if(g){d.deleteTables=g;}if(c){d.dbRoleID=c;}if(f){d.dbNamespace=f;}if(l){d.dbTableName=l;}j.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,k),d);},editEmmaIRRSourceTableRefreshTypes:function E(f,c,h,g){var e=mstrApp.getRootController().dataService,d={sourceType:Y,tables:f.join(",")};if(c){d.refreshTypes=c.join(",");}if(h){d.deleteTables=h.join(",");}e.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,g),d);},deleteEmmaIRRSourceTable:function S(c,d){mstrApp.getRootController().dataService.deleteEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,d),{tbids:c.join(",")});},getEmmaIRRAttributes:function V(c){mstrApp.getRootController().dataService.getEmmaIRRAttributes(c);},setEmmaIRRFilter:function N(c,d){mstrApp.getRootController().dataService.setEmmaIRRFilter(mstrmojo.func.wrapMethods(F,d),{exp:c});},hasRefreshFilter:function P(){var c=mstrApp.getRootController().getModel(),d=false;W.forEach(c.isFilterInTable,function(e){if(e){d=true;return false;}});return d;},hasAlternateSource:function X(){var c=mstrApp.getRootController().getModel(),d=false;W.forEach(c.importSources,function(e){if(e.alternateSource){d=true;return false;}});return d;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ui._HasScroller","mstrmojo.SearchableDropDownList","mstrmojo.ME.FunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs(3377,11569,12179);var A,C;mstrmojo.ME.DerivedFunctionWizard=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedFunctionWizard",init:function F(G){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(G);A=this.id;C=this;},setupScrollNodes:function E(){this.scrollNode=this.containerNode;},onOpen:function B(){this._super();if(this.ide&&this.ide.action.cmd===mstrmojo.ME.ENUM.METRIC_ACTIONS.EDIT_NEW){this.dirty=true;}if(this.updateScrollbars){this.updateScrollbars();}},getParamObjectTypes:function D(){var G=this.opener||{};return G.getValidFuncParamTypes?G.getValidFuncParamTypes(this.fctOi):this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.MetricDataService","mstrmojo.ME.AttributeEditBox","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");var G;var f=mstrmojo.ME.MetricDataService,V=mstrmojo.hash,N=mstrmojo.array,X=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,b=mstrmojo.expr.DTP,Q={SHOW_BAND_NAMES:-4,BANDON_UNITS:-6},B={START_END:'BandNames<ResidueName="All Others">(this@ID, "#s - #e")',BAND_NUM:'BandNames<ResidueName="All Others">(this@ID, "Band #b")',BAND_NUM_START_END:'BandNames<ResidueName="All Others">(this@ID, "Band #b: #s - #e")',NO:"No"},R=[{n:mstrmojo.desc(14145,"Start - End"),v:B.START_END},{n:mstrmojo.desc(14146,"Band #"),v:B.BAND_NUM},{n:mstrmojo.desc(14147,"Band #: Start - End"),v:B.BAND_NUM_START_END},{n:mstrmojo.desc(218,"No"),v:B.NO}],K={"8107C337DD9911D3B98100C04F2233EA":"BAND_SIZE","8107C338DD9911D3B98100C04F2233EA":"BAND_COUNT","8107C339DD9911D3B98100C04F2233EA":"BAND_POINTS"},D=function(){return[];};function Z(g){return g.replace(/\s/g,"").toLowerCase();}function O(g){var h=[{v:"BandNames",tp:279,lv:1,oi:{did:"ACA96B1F9F99412B867045747DD88575",n:"BandNames",st:2816,t:11}},{v:"<",tp:60,lv:1},{v:"ResidueName",tp:259,lv:1},{v:"=",tp:282,lv:1},{v:'"All Others"',tp:261,lv:1},{v:">",tp:62,lv:1},{v:"(",tp:40,lv:1},{lv:1,tp:275,v:"this@ID"},{v:",",tp:44,lv:1}];switch(g){case B.BAND_NUM:h.push({v:'"Band #b"',tp:261,lv:1});break;case B.BAND_NUM_START_END:h.push({v:'"Band #b: #s - #e"',tp:261,lv:1});break;case B.START_END:h.push({v:'"#s - #e"',tp:261,lv:1});break;}h.push({v:")",tp:41,lv:1});return h;}function e(g){var h="";N.forEach(g.slice(1,-1),function(j){h+=j.v;});return h;}function J(g){if(g.t===4){return"BandOn";}return g.n;}function E(g){if(g.t===4){return Q.BANDON_UNITS;}return g.dtp;}var C=function(g,h){return{did:"",n:"New Attribute",forms:[{n:"ID",tks:{items:[]}}]};};function U(h,g){return h.dtp===8&&h.n==="Delimiter"?'"'+g+'"':g;}function P(k){var j=k.split(",")[0],h=j.replace(/\d$/,""),g=j.replace(h,"");return{prefix:h,startAt:parseInt(g,10)};}function L(g,h){return{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:g,popupToBody:true,itemIdField:"v",postCreate:function(){var j=this.data;this.value=j.v||j.dfv;},getTokens:h||D,onvalueChange:function(){G.set("dirty",true);}};}function I(h,k){var g=function(l){return l.inputWidget&&l.inputWidget.widgetName===k;},j=mstrmojo.array.filterOne(h.argsGrid.ctxtBuilder.itemWidgets,g);return j&&j.inputWidget;}var H=function(h){var g=null;switch(h&&h.dtp){case Q.SHOW_BAND_NAMES:g=L(R);g.widgetName="bandNames";g.getDescTokens=function(){var j=this.selectedItem&&this.selectedItem.v;return j===B.NO?null:O(j);};break;case Q.BANDON_UNITS:g=G.getParamWidget(h);g.widgetName="bandOn";break;case b.DOUBLE:case b.INTEGER:case b.VARCHAR:g=G.getTextWidget(h);break;default:g=G.getParamWidget(h);g.onitemsChange=mstrmojo.emptyFn;break;}if(g){g.alias="inputWidget";}return g;};var M=function(o,p,l,q){var m=o.did,j=o.n,g=o.dsid,h=o.forms,n={items:p},k=function(t){if(t.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var w,u={n:"ID",formula:t.tokenXML};if(m){u.did=h[0].did;w={act:"updateDA",name:j,dsid:g,attrId:m,isTokenStream:true,update:[u]};if(l){if(l.did&&!l.del){w.update.push(l);}else{if(l.did&&l.del){w.del=[{did:l.did}];}else{w.add=[l];}}}}else{w={act:"addDAToDataset",dsid:g,name:j,evFlags:1,isTokenStream:true,forms:[u].concat(l?[l]:[])};}q(w);};mstrmojo.ME.AttributeEditBox.validateSyntax(m,n,true,k);};var a=function(m){var l=m.forms,h=l&&l.length,k=h&&l[0],j=h&&l[1],o=N.some(k&&k.ftk,function(p){return p.oi&&K[p.oi.did];});if(!o){return false;}if(h===1){return true;}if(j&&j.ftk&&h===2){var g=false,n=Z(e(j.ftk));V.forEach(B,function(p){if(Z(p)===n){g=true;return false;}});return g;}return false;};mstrmojo.ME.BandingDAEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,null,{scriptClass:"mstrmojo.ME.BandingDAEditor",ide:null,insertMode:false,init:function W(g){this._super(g);G=this;},getDTPBuilder:function Y(){return H;},getParamObjectTypes:function S(){return[mstrmojo.expr.TP.METRIC];},getTextWidget:function c(h){var j=P(h.n).prefix;return{scriptClass:"mstrmojo.ValidationTextBox",emptyText:(h.dtp===b.DOUBLE||h.dtp===b.INTEGER)?mstrmojo.desc(14143,"Type a number"):"",postCreate:function(){this.value=(h.items&&h.items[0].v)||h.dfv;},oninput:function k(l){G.set("dirty",true);this.createNextInputParamWidget();},constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},dtp:h.dtp,getTokens:function(){var l=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==l.dfv){return[{v:U(l,this.value)}];}return[];},createNextInputParamWidget:function g(){var p=this.data,o=this.dataGrid,q=G._lastRpIdx;if(!(p.isRepeated&&p.rpIdx===q)){return ;}var m=q+1,n=j+m,l=mstrmojo.hash.copy({desc:n,n:n,items:null,dn:n,rpIdx:m},mstrmojo.hash.copy(p));o.items.add([l],mstrmojo.array.indexOf(o.items,p)+1);G._lastRpIdx=l.rpIdx;if(G.updateScrollbars){G.updateScrollbars();}}};},onOpen:function F(){G=this;this.oi.tks=this.oi.forms[0].tks||{items:this.oi.forms[0].ftk};this._super();if(this.updateScrollbars){this.updateScrollbars();}},insertOnFinish:function(){var l=mstrmojo.all.mstrDAE.attrEditBox,g=l.inputBox,k=I(this,"bandNames"),h=this.getTokens(),j=k.getDescTokens();g.insertTokens(h);if(j){l.tabstrip.addTab();g.insertTokens(j);}},validateAndSave:function A(n,m){var l=this,k=l.ide.action,g=n.forms,h=I(this,"bandNames"),p=h.getDescTokens(),j=V.copy(p?{n:"DESC",formula:X({items:p})}:null,g[1]?{did:g[1].did}:null),o=function(t){m();l.ide.close();var q=n.did?k.onupdate:k.oncreate;if(q){q(t);}};if(p===null&&j){j.del=true;}M.call(l,l.oi,this.getTokens(),j,o);},postProcessParamsFromToken:function(k){var m=[],l,j,h=k.pars,g=(h&&h.length)||0;for(j=0;j<g;j++){l=V.copy(h[j]);l.dtp=E(l);l.n=J(l);l.isParam=true;m.push(l);}l=m[m.length-1];if(k.rpc>0){m=m.concat(this.postProcessRepeatParam(l));}return m;},postProcessRepeatParam:function d(o){var n=P(o.n),m=n.prefix,j=n.startAt||1,g=[],l,h;o.isRepeated=true;o.rpIdx=this._lastRpIdx=j;o.n=m+(j++);var k=o.items||[];if(k.length>0){o.items=[k[0]];for(h=1;h<=k.length;h++){l=V.copy(o);l.rpIdx=j;l.n=m+(j++);l.items=(h===k.length?null:[k[h]]);g.push(l);}this._lastRpIdx=l.rpIdx;}return g;},postProcessProsFromToken:function(g){var j=[],h={dfv:B.START_END,n:"ShowBandNames",desc:mstrmojo.desc(14144,"Show band names"),dtp:Q.SHOW_BAND_NAMES};if(this.oi.forms.length>1){var k=Z(e(this.oi.forms[1].ftk));V.forEach(B,function(l){if(Z(l)===k){h.v=l;return false;}});}else{if(this.oi.did!==""){h.v=B.NO;}}j.push(h);return j;}});mstrmojo.ME.BandingDAEditor.getNewDefinition=C;mstrmojo.ME.BandingDAEditor.showAsBandingEditor=a;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.tooltip","mstrmojo.SearchWidget","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.Enum","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(13141,9590,4561,9591,3273,9592,9579,9593,3324,9594,11656,11657,4565,9595,9925,1088,13141,9563,9597,221);var R=mstrmojo.hash,X=mstrmojo.dom,M=mstrmojo.css,Z=mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS;var D={n:mstrmojo.desc(9590,"Search Result"),did:-1,fns:[]},E={n:mstrmojo.desc(4561,"All Functions"),did:-2,fns:[]},Q={n:mstrmojo.desc(9591,"Metric Templates"),did:-3,fns:[{n:mstrmojo.desc(3273,"Level"),did:Z.Level,desc:mstrmojo.desc(9592,"Create a level metric."),h:"standard_functions_Level"},{n:mstrmojo.desc(9579,"Condition"),did:Z.Condition,desc:mstrmojo.desc(9593,"Create a conditional metric."),h:"standard_functions_condition"},{n:mstrmojo.desc(3324,"Transformation"),did:Z.Transformation,desc:mstrmojo.desc(9594,"Create a transformation metric."),h:"standard_functions_transformation"},{n:mstrmojo.desc(11656,"Row Count"),desc:mstrmojo.desc(11657,"Row Count calculates the total number of rows in the dataset."),did:Z.Row_Count,tks:{items:[{v:"Count",tp:280,oi:{n:"Count",did:"8107C31CDD9911D3B98100C04F2233EA",t:11,st:2816}},{v:"<",tp:60},{v:"Null",tp:259},{v:"=",tp:282},{v:"True",tp:299},{v:",",tp:44},{v:"UseLookupForAttributes",tp:259},{v:"=",tp:282},{v:"False",tp:300},{v:">",tp:62},{v:"(",tp:40},{v:'"*"',tp:261},{v:")",tp:41},{v:"{",tp:123},{v:"~",tp:126},{v:"}",tp:125}]}}]},G={n:mstrmojo.desc(4565,"Select a category:"),did:-4,fns:[]},F=function(a,b){var c=a.functionList;a.openWizard(c.items[c.selectedIndex],b);},H=function(){return mstrmojo.hash.copy(mstrmojo.ME.ENUM.NEW_METRIC_DEFINITION);};var Y=function(b){var a="mstrmojo-ME-fct-tip",c=this.tooltip&&this.tooltip.domNode;if(c){M.toggleClass(c,a,b);}};mstrmojo.ME.FunctionSelector=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.FunctionSelector",title:mstrmojo.desc(9595,"Select a function or template"),help:"Select_a_Function_dialog_box.htm",isDME:false,functions:null,includeFakeFuncs:true,functionItems:null,selectedCategory:1,selectedIndex:-1,init:function U(a){this._super(a);M.addWidgetCssClass(this,"mstrmojo-FunctionSelector");},getFunctionSyntax:function L(h,c){var e=this.functionItems;if(!e){return"";}var g=e[h].fns[c];if(g.did<0){return g.n;}var a=g.pars,k=g.pros,j=[],b,d;j.push(g.n);k=mstrmojo.hash.clone(k)||[];if(g.ios){k.push({n:"SortBy"});}if(g.sqt===5){k.push({n:"BreakBy"});}if(this.showFullSyntax){if(k.length>0){j.push("<");for(b=0,d=k.length;b<d;b++){j.push(k[b].n);j.push(", ");}j.pop();j.push(">");}}j.push("(");for(b=0,d=a.length;b<d;b++){j.push(a[b].n);if(b!==(d-1)){j.push(", ");}}j.push(")");return j.join("");},getFunctionDesc:function P(d,a){var c=this.functionItems;if(!c){return"";}var b=c[d].fns[a];return mstrmojo.ME.FunctionInfo.getDescAndExample(b).desc;},getFunctionHelpTopic:function O(d,a){var c=this.functionItems;if(!c){return"";}var b=c[d].fns[a];if(b.did===Z.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(b.h);},getMetricDefAsTokens:function S(){return this.getTokens();},getTokens:function K(){var b=this.functionList,a=b.items[b.selectedIndex],c=[];if(a){if(a.did<-1){switch(a.did){case -7:c=a.tks.items;break;case -4:case -5:case -6:break;}}else{c.push({v:a.n,oi:a,isNew:true});}}return c;},onfunctionsChange:function W(){if(!this.functions){return ;}this.selectedCategory=0;this.set("selectedCategory",1);this.set("selectedIndex",-1);var c=mstrmojo.hash.clone(this.functions),a=c.length;if(!c.add){c=R.make(c,mstrmojo.Arr);}if(a>=1&&this.includeFakeFuncs){var b=c[mstrmojo.ME.MetricDataService.getBasicCategoryIndex(c)];b.fns.push(Q.fns[0]);if(!this.isDME){b.fns.push(Q.fns[1]);b.fns.push(Q.fns[2]);}else{b.fns.push(Q.fns[3]);}}this.set("functionItems",c);},onPreClose:function N(){this.cleanup();return true;},cleanup:function I(){this.searchWidget.clearSearch();this.set("selectedIndex",-1);},handleCloseAction:function C(){this.close();},clearSearchResult:function V(b){var c=this.fcHBox.fcPulldown,d=this.functionItems,a=d.length-1;if(a>-1&&d[a]===D){if(this.selectedCategory===a){if(b!==false){this.set("selectedCategory",1);this.set("selectedIndex",-1);}}d.remove(a);c.refresh();}},clearSearchPattern:function A(){var a=this.searchWidget;if(a&&a.hasRendered){a.reset();this.clearSearchResult(false);}},openWizard:function J(d,c){var b=this,a;if(mstrmojo.ME.MetricDataService.isBasicAggMap(d.did)||d.did<-1){a={zIndex:b.zIndex+10,did:d.did,oi:H};a.insertMode=false;a.id="mstrSME";}else{a={functions:mstrmojo.ME.MetricDataService.getFunctionCatList(),fctOi:d,zIndex:b.zIndex+10,oi:H};a.id="mstrFE";}a.insertMode=this.insertMode;if(a.insertMode){a.insertOnFinish=this.insertOnFinish;}b.switch2Editor(a.id,a);},handleSelectedFunction:function(a){F(this);},onshowFullSyntaxChange:function B(){this.functionList.onchange();},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FunctionSelector-label",text:mstrmojo.desc(9925,"Functions")},{scriptClass:"mstrmojo.SearchWidget",alias:"searchWidget",cssClass:"mstrmojo-FunctionSelector-search",width:"65px",quickSearch:true,placeholderText:"",onsearch:function(h){var a=this.parent,g=a.fcHBox.fcPulldown,e=a.functionItems,j=a.functionList.itemDisplayField,f=[],b=function(l){var k=mstrmojo.hash.copy(l),n=k.n,m;try{m=new RegExp(h,"ig");}catch(o){m=new RegExp(mstrmojo.string.regEscape(h),"ig");}if(m.test(n)){k[j]=n.replace(m,function(p){return"<em>"+mstrmojo.string.encodeHtmlString(p)+"</em>";});f.push(k);}},c,d;for(c=0,d=e.length;c<d;c++){if(e[c]===D||e[c].did===E.did){continue;}if(h){mstrmojo.array.forEach(e[c].fns,b);}}D.fns=f;if(e[e.length-1]!==D){e.add([D]);}g.refresh();a.selectedCategory=0;a.set("selectedCategory",e.length-1);a.set("selectedIndex",-1);},onclear:function(a){if(a){this.parent.clearSearchResult();}}},{scriptClass:"mstrmojo.HBox",alias:"fcHBox",cssClass:"mstrmojo-FunctionSelector-fctBox",children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"fcPulldown",itemIdField:"did",itemField:"n",items:[],bindings:{items:function(){var b=this.parent.parent.functionItems,c=[];if(!b){return b;}c=mstrmojo.ME.MetricDataService.sortFunctions(b);if(b[0].did!==E.did){var a=E;a.fns=c;b.unshift(a);}return b;},selectedIndex:"this.parent.parent.selectedCategory",value:function(){var a=this.parent.parent.selectedCategory;return this.items[a][this.itemIdField];}},onvalueChange:function(a){var b=this.parent.parent;b.set("selectedCategory",this.selectedIndex);b.set("selectedIndex",-1);if(a.valueWas===D.did&&this.selectedItem.did!==D.did){this.parent.parent.clearSearchPattern();}}}]},{scriptClass:"mstrmojo.ME.FunctionList",alias:"functionList",itemIdField:"dssid",itemField:"n",itemDisplayField:"dn",items:[{n:"",cls:"wait"}],cssClass:"mstrmojo-FE-functionList mstrmojo-suggest-list",renderOnScroll:false,itemMarkupFunction:function(d,a,c){var b="mstrmojo-Button mstrmojo-Editor-button mstrmojo-WebButton tbFunction";if(!mstrApp.isWSStyling){b+=" hot";}return'<div class="mstrmojo-suggest-text '+(d.cls||"fn")+'" idx="'+a+'"'+(d.did<0?'did="'+d.did+'"':"")+" onmouseover=\"mstrmojo.all['"+c.id+"'].onmouseover(this, event)\" onmouseout=\"mstrmojo.all['"+c.id+"'].onmouseout(this, event)\">"+((c.itemDisplayField&&d[c.itemDisplayField])||d[c.itemField])+'<div class="'+b+'" t="edt"><div class="mstrmojo-Button-text" t="edt">'+mstrmojo.desc(1088,"Edit")+"</div></div></div>";},bindings:{items:function(){var a=this.parent.functionItems,b=this.parent.selectedCategory;return(a&&a[b].fns)||this.items;},selectedIndex:"this.parent.selectedIndex"},buffer:"",onkeypress:function(m){var l=this,h=m.e,d=h.keyCode||h.charCode,n=mstrmojo.Enum_Keys,a=function(p){var o=(X.isIE&&!X.isIE9)?p.keyCode:p.charCode;return(o>0)?String.fromCharCode(o):"";},j=this.items,g=j.length,b=this.selectedIndex,c=function(e){l.scrollTo(e);};switch(d){case n.UP_ARROW:this.set("selectedIndex",(b+g-1)%g);break;case n.DOWN_ARROW:this.set("selectedIndex",(b+1)%g);break;default:var f=(this.buffer+=a(h));if(g>0&&f.length>0){mstrmojo.array.forEach(j,function(p,k,e){var o=new RegExp("^"+f,"i");if(o.test(p[l.itemField])){if(k>-1){this.selectedIndex=-1;this.set("selectedIndex",k);}return false;}},this);}}if(this.selectedIndex>-1){c(this.selectedIndex);}window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){l.buffer="";},300);mstrmojo.dom.stopPropogation(m.hWin,h);return false;},onkeyup:function(a){this.onkeypress(a);},onchange:function(a){var c=this.parent;if(this.selectedIndex!==c.selectedIndex){c.set("selectedIndex",this.selectedIndex);}var e=c.selectedCategory,b=c.selectedIndex,d=e>-1&&b>-1;c.set("funcSyntax",d?c.getFunctionSyntax(e,b):"");c.set("funcDesc",d?c.getFunctionDesc(e,b)+"  "+c.getFunctionHelpTopic(e,b):"");if(this.changeByMouse){if(c.selectedCategory>-1&&c.selectedIndex>-1){c.handleSelectedFunction(false);}this.changeByMouse=false;}},onmouseup:function(a){var c=a.getTarget(),b=c.getAttribute("t");if(b==="edt"){mstrmojo.dom.stopPropogation(a.hWin,a.e);mstrmojo.dom.preventDefault(a.hWin,a.e);this.openFunctionEditor();return false;}},openFunctionEditor:function(){var c=this.parent.parent.parent,d=c.getTokenInputBox(),a={zIndex:c.zIndex+1,insertMode:true,oi:mstrmojo.ME.ENUM.getNewDefinition(),insertOnFinish:function(e){d.insertTokens(e);}},b=this.parent.functionList.selectedItem;if(c.isBanding&&c.isBanding(b.did)){a={zIndex:c.zIndex+1,insertMode:true,fctOi:b,id:"mstrBDAE_1",oi:mstrmojo.ME.BandingDAEditor.getNewDefinition(),ide:c};}else{if(mstrmojo.ME.MetricDataService.isBasicAggMap(b.did)||b.did<-1){a.candidates=d.candidates;a.did=b.did;a.id="mstrSME_1";a.useGUIDefault=true;}else{a.fctOi=b;a.id="mstrFE_1";a.paramItemsPath=c.feParamItemsPath;}}a.modal=true;c.getModalEditor(a).open(c);},ondblclick:function(a){var c=this.getItemNodeFromTarget(a.getTarget());if(c){var b=this.parent;if(b.selectedCategory>-1&&b.selectedIndex>-1){b.handleSelectedFunction(true);}}},useRichTooltip:false,onmouseover:function(c,k){var m=this,b=this.parent,l=b.selectedCategory,f=c.getAttribute("idx"),d=X.eventTarget(window,k),a=d.getAttribute("t")==="edt";if((!isNaN(f)&&f>-1)||a){window.clearTimeout(m.hideTmr);var j='<dl class="fct-info"><dt class="fct-syntax">'+b.getFunctionSyntax(l,f)+'</dt><dd class="fct-desc">'+(b.getFunctionDesc(l,f)+"  "+b.getFunctionHelpTopic(l,f))+"</dd></dl>";var n=mstrmojo.dom.position(c,true),o=function(){var p=(m.tooltip&&m.tooltip.domNode.offsetWidth+15)||200,e=n.x,w=n.y-c.offsetHeight/2,u=e<p?"left":"right",t=e<p?mstrmojo.tooltip.POS_TOPLEFT:mstrmojo.tooltip.POS_TOPRIGHT;e=e<p?n.x+n.w+8:e-10;return{arrow_css:u,contentNodeCssClass:"me-tooltip-content "+u,posType:t,left:e,top:w};},h=o(),g="hidden";m.richTooltip=a?m.getEditBtnTooltip(d,f,h):{cssClass:g,contentNodeCssClass:"me-tooltip-content "+h.arrow_css,posType:h.posType,left:h.left,top:h.top,content:j,areaId:f};m.useRichTooltip=true;m.hasOpenTooltip=false;m.showTooltip();window.clearInterval(m.posTmr);var q=0;if(!m.posTmr){m.posTmr=window.setInterval(function(){if(m.tooltip){var t=m.tooltip.domNode,p=t.childNodes[1].firstChild,e=h.posType;h=o();if(h.posType!==e){t.style.left=h.left+"px";M.addClass(p,[h.arrow_css]);}window.setTimeout(function(){M.removeClass(t,g);},10);window.clearInterval(m.posTmr);delete m.posTmr;}else{if(q++>10){window.clearInterval(m.posTmr);}}},200);}Y.call(this,!a);}},getEditBtnTooltip:function(b,c,a){if(a){return{posType:mstrmojo.tooltip.POS_TOPLEFT,content:mstrmojo.desc(13141,"Edit function parameters"),top:a.top+50,left:a.left+200,cssClass:"vi-regular vi-tooltip-A"};}return{posType:mstrmojo.tooltip.POS_TOPRIGHT,contentNodeCssClass:"me-tooltip-content regular up tbFunction",top:28,left:67,refNode:b,content:mstrmojo.desc(13141,"Edit function parameters"),areaId:c};},onmouseout:function(){var a=this;this.hideTmr=window.setTimeout(function(){Y.call(a);a.hideTooltip();a.useRichTooltip=false;},500);}},R.copy({slot:"buttonNode",cssText:"text-align: center; float:left;",text:mstrmojo.desc(9563,"Switch to Formula Editor"),title:mstrmojo.desc(9597,"Build a metric formula using metrics, facts, attributes and functions."),closeAfterSwitch:false,getEditor:function(){return this.parent;},postclick:function(){this.getEditor().buttonNode.style.visibility="hidden";},bindings:{visible:function(){return !this.parent.insertMode;}}},R.copy(mstrmojo.ME._MetricEditorHelper.switchRef)),{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.handleCloseAction();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.ui._HasScroller");var E=mstrmojo.dom;mstrmojo.ME.FunctionList=mstrmojo.declare(mstrmojo.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionList",setupScrollNodes:function D(){this.scrollNode=this.itemsContainerNode;this.scrollNode.style.height=this.scrollboxNode.offsetHeight+"px";this.scrollboxNode=this.itemsContainerNode;},getItemNodeFromTarget:function C(H){var G=mstrmojo.dom.findAncestorByAttr(H,"idx",true,this.domNode);return(G&&G.node)||null;},premousedown:function A(H){this.changeByMouse=false;if(E.isPrimaryMouseBtn(H.e)){var I=this.getItemNodeFromTarget(H.getTarget()),G=I&&parseInt(I.getAttribute("idx"),10);if(G!==null&&!isNaN(G)&&G!==this.selectedIndex){this.domNode.tabIndex=0;this.domNode.focus();this.changeByMouse=true;}this._super(H);}},getDragData:function B(G){return{item:this._super(G)};},premouseup:function F(G){if(E.getButton(G.hWin,G.e)===E.MOUSE_BUTTON.LEFT){this._super(G);return true;}mstrmojo.dom.stopPropogation(G.hWin,G.e);mstrmojo.dom.preventDefault(G.hWin,G.e);return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Editor","mstrmojo.List","mstrmojo.ME.MetricEditBox","mstrmojo.ME.FunctionSelector","mstrmojo.qb.FunctionWizard","mstrmojo.MenuButton","mstrmojo.qb.FFsqlToken","mstrmojo.array");mstrmojo.requiresDescs(221,2827,2919,4449,1442,9105,9106,9107,9108,9109,9110,9925);var Q=mstrmojo.string,S=mstrmojo.hash,O=mstrmojo.array,P={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3},Y={0:"valid",1:"unknown",2:"validating",3:"error"},U={0:mstrmojo.desc(9105,"Valid Expression Formula."),1:mstrmojo.desc(9106,"Require Validation?"),2:mstrmojo.desc(9107,"Validation in Progress..."),3:mstrmojo.desc(9108,"Validation Failed with Syntax Error")},B=0,Z=3;function D(a){return(a?P.ERROR:P.VALID);}function M(a){var b=[];O.forEach(a,function(c){b.push(c.v);});return b.join("").replace(/<\s/g,"<").replace(/>\s/g,">");}function A(f){var e=f[f.length-1],c,d,b=[],a="";if(f[0]&&f[0].tp!==64){b.push({v:"",tp:64,lv:3,sta:1});}O.forEach(f,function(g){if(!g.oi){a+=g.v;}else{if(!Q.isEmpty(a)){b.push({v:a,tp:2,lv:1});a="";}b.push(S.copy(g,{lv:1,tp:2,sta:1}));}});if(!Q.isEmpty(a)){b.push({v:a,tp:2,lv:1});a="";}if(e&&e.tp!==-1){b.push({v:"",tp:-1,lv:2,sta:1});}return{omit:b,cn:b.length};}function N(d){var c=A(d),b={v:true,tp:true,lv:true,n:true,did:true,t:true,st:true,cn:true,mi:true,omit:true,extra:true,tknctx:true,sqlti:true,tindex:true,cli:true,sta:true,ix:true},a={getArrItemName:function(){return"tkn";},isSerializable:function(e){return(b[e])?true:false;}};return mstrApp.getRootController().exprjson2xml("mi",c,a);}function R(f){var b="",e=1,d="",a=this.exprEditBox.inputBox;if(a.doubleByte){d=a.editNode.innerText||a.editNode.textContent;a.ime=false;}else{if(this.oi.type!==0&&this.oi.type!==3){d=M(a.items);e=2;}else{b=N(a.items);}}var c=this;mstrApp.getRootController().parseExpression({expr:d,tKnStrm:b,isNew:true,qbrex:e,vo:1},{success:function(h){if(h&&h.mi&&h.mi.items){var g=h.mi.exp.sqltp;if(g!==null){c.sqltp=g;}c.exprEditBox.handleValidation(h.mi,false);if(!h.mi.reject_error_code&&f&&f.success){f.success(h);}else{if(f&&f.failure){f.failure(h);}}}}});}function X(b){var c=[],a=b.length;O.forEach(b,function(e,d){var f=e.v;if(typeof f!=="string"&&f.toString){f=e.v=f.toString();}if(e.orf){if(d>0&&f.slice(0,1)!==" "){c.push({v:" "});}c.push(e);if(d<a-1&&f.slice(-1)!==" "){c.push({v:" "});}}else{c.push(e);}});O.forEach(c,function(e,d){b[d]=e;});}function V(b){if(!b.length){return ;}var a=b[b.length-1];if(a&&a.tp===-1){b.pop();}if(b[0]&&(b[0].tp===64||(b[0].tp===36&&b[0].v==="$"))){b.splice(0,1);}X(b);}function K(a){return["[",a,"]"].join("");}mstrmojo.qb.ExpressionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.qb.ExpressionEditor",cssClass:"mstrmojo-MetricEditor mstrmojo-qb-ExpressionEditor",zIndex:70,title:mstrmojo.desc(4449,"Expression"),functionSelector:{scriptClass:"mstrmojo.ME.FunctionSelector"},wizard:{scriptClass:"mstrmojo.qb.FunctionWizard"},model:null,selFuncItem:null,onfunclistChange:function I(){this.toolBox.toolBar.func.set("cm",[{n:mstrmojo.desc(9925,"Functions"),did:-3,fns:this.funclist}]);},onOpen:function E(){var d=this,c=this.oi,g=this.exprEditBox,h=g.inputBox;h.customFunctionMode=false;h.doubleByte=false;c.isSave=false;this.set("funclist",mstrApp.getRootController().rootView.scriptClass==="mstrmojo.DI.ui.dialogs.DIAggregationDialog"?O.filter(this.funclist||mstrApp.getRootController().getFunctionList(),function(j){return j.n&&(j.n.indexOf("Financial")===-1&&j.n.indexOf("Statistical")===-1);}):(this.funclist||mstrApp.getRootController().getFunctionList()));var f={items:mstrApp.getRootController().getSuggestionItems(false),isComplete:true};h.set("candidates",f);d.set("candidates",f);g.set("iStatus","");g.set("vStatus",0);var b={0:mstrmojo.desc(4449,"Expression"),1:mstrmojo.desc(9109,"Filter Expression"),3:mstrmojo.desc(4449,"Expression")},e={0:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm",3:(mstrApp.helpTopics&&mstrApp.helpTopics.expression)||"expression_dialog_box.htm"};this.set("title",[b[c.type]||"",c.n].join(""));this.set("help",e[c.type]||((mstrApp.helpTopics&&mstrApp.helpTopics.condition)||"new_condition_dialog_box.htm"));var a;if(c&&c.tkn){a=S.clone(c.tkn);V(a);h.set("items",a);}if(c&&c.selFuncItem){d.openPopup("wizard",{fctOi:c.selFuncItem,zIndex:d.zIndex+10,insertOnFinish:function(j){h.insertTokens(j);}});}},onClose:function C(){var a=this.exprEditBox.inputBox;a.set("items",[]);a.itemcount=0;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-toolBox",alias:"toolBox",children:[{scriptClass:"mstrmojo.Label",cssText:"font-size: 10pt",text:mstrmojo.desc(15415,"Type Expression")+":"},{scriptClass:"mstrmojo.ToolBar",cssClass:"mstrmojo-oivmSprite grouped",alias:"toolBar",cssText:"float: right",children:[{scriptClass:"mstrmojo.MenuButton",alias:"func",iconClass:"tbInsert",title:mstrmojo.desc(2919,"Insert"),zIndex:80,itemIdField:"did",itemField:"n",itemChildrenField:"fns",isSeparatorItem:function L(a){return a[this.itemIdField]===-1;},executeCommand:function W(b){var a=this.parent.parent.parent,c=a.exprEditBox.inputBox;if(b.did===-999){a.openPopup("functionSelector",{functions:a.funclist,zIndex:a.zIndex+10,openWizard:function(d){a.openPopup("wizard",{fctOi:d,zIndex:a.zIndex+10,insertOnFinish:function(e){c.insertTokens(e);}});}});}else{a.openPopup("wizard",{fctOi:b,zIndex:a.zIndex+10,insertOnFinish:function(d){c.insertTokens(d);}});}}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(9110,"Syntax Validation"),iconClass:"tbValidate",text:mstrmojo.desc(11897,"Validate"),onclick:function(){R.call(this.parent.parent.parent);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(2827,"Clear"),iconClass:"tbClear",text:mstrmojo.desc(2827,"Clear"),onclick:function(){var a=this.parent.parent.parent,b=[];a.oi.tkn=b;a.exprEditBox.inputBox.clearTokens(b);a.exprEditBox.resizeInputBox();}}]}]},{scriptClass:"mstrmojo.ME.MetricEditBox",alias:"exprEditBox",cssText:"height:132px;",children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",browseItemVisible:false,renderBlockSize:1000,item2textCss:function J(a){return" mstrmojo-qb-SuggestIcon t"+a.t;},itemFunction:function G(d,a,b){return new mstrmojo.ME.MetricToken({data:d,brackets:K,isDelimiter:function c(){return this.data.isDelimiter||(this.length()===1&&mstrmojo.qb.FFsqlToken.isDelimiter(this.data.v));}});},isDelimiter:mstrmojo.qb.FFsqlToken.isDelimiter}],markupMethods:{onvStatusChange:function(){var b=this.vStatus,a=this.vStatusNode;a.className="mstrmojo-MEBox-vStatus "+Y[b];a.innerHTML=U[b];},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;this.resizeInputBox();}},handleValidation:function F(d,f){if(!d){this.set("vStatus",P.ERROR);return ;}d.vs=D(d.reject_error_code);this.set("vStatus",d.vs);this.set("iStatus",d.reject_error_description||"");var e=d.items,h=[],g,a=".",c,b;O.forEach(e,function(k,j){h[j]={};if(k.tp===304&&!/^'.*'$/.test(k.v)){k.v=["'",k.v,"'"].join("");}if(k.tp===309){g=k.v;c=g.lastIndexOf(a);if(c>=1){k.v=g;h[j].oi={tn:g.slice(0,c),rn:g.slice(c+1),tp:26};}else{h[j].oi={tn:null,rn:g,tp:26};}}if(k.orf){h[j].oi=k.orf;k.v=[" ",k.v," "].join("");}h[j].v=!k.v||(typeof k.v)==="string"?k.v:k.v.toString();h[j].sta=k.sta;});this.inputBox.set("items",h);this.resizeInputBox();if(!f){this.inputBox.focus();}},resizeInputBox:function H(){var c=this.inputBox.domNode,b=this.iStatusNode.parentNode,d=parseInt(this.domNode.clientHeight,10)-7,a=b.offsetHeight;if(c){c.style.height=d-a+"px";}}},{scriptClass:"mstrmojo.HBox",cssText:"float: right; border-collapse: separate;margin:10px 0px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var f=this.parent.parent,e=f.oi,b=e.type,d=e.w,a=f.exprEditBox.inputBox,c=M(a.items),h={success:function g(){f.close();}};e.isSave=true;switch(b){case B:R.call(f,{success:function g(){mstrApp.getRootController().addColumnWithExpression(d,c,a.items,h);}});break;case Z:R.call(f,{success:function g(){mstrApp.getRootController().editColumnExpression(e.cIndex,c,a.items,h);}});break;default:R.call(f,mstrmojo.func.wrapMethods(e.callbacks,h));}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.string","mstrmojo.form","mstrmojo.qb.ExpressionEditor","mstrmojo.qb.MissingColumnWarning","mstrmojo.qb.DataService","mstrmojo.warehouse.EnumDataChangeEvents","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(218,219,1442,9220,9221,9222,9223,9224,9225,9226,9227,9228,9229,9230,9945,9946,11164,16115);var P=mstrmojo.string,V=mstrmojo.hash,Z=mstrmojo.array,Y=mstrmojo.css,BV=mstrmojo.DI.DIHelpers,AO=mstrmojo.DI.DIConstants,Ae=mstrmojo.mstr.EnumDSSXMLObjectTypes,BR=P.decodeHtmlString,A7=mstrmojo.warehouse.EnumDataChangeEvents,BT="    ",A8="A61B85F4485D3B953003B195E58B5138",BU=15,L=200,A5=200,m=0,R=0,b=["0DFE6FB4356F4FA2A0C1C10D0B415355","375104850C3E45EA889D9F5FEB37D317","B2C0FA4020C711D6AD1400C04F0423DE","B2C0FA4120C711D6AD1400C04F0423DE","9AD889E56E4D4E56A127207B4AF77166","8107C31BDD9911D3B98100C04F2233EA","8107C31DDD9911D3B98100C04F2233EA","8107C31EDD9911D3B98100C04F2233EA","8107C31FDD9911D3B98100C04F2233EA","8107C31CDD9911D3B98100C04F2233EA","AB08D4FC700B4EE58C021BFA2ABD77D0","993F6897863E43CFBEA4969F68BBDED7","C50F2A4F75AE49D6B20E00224967B500","0150F348CB0B4D9AB8CCA458C1ACC4B0","6F7DF5F2449111D5BEA300B0D01A55EF","6F7DF5F3449111D5BEA300B0D01A55EF","6F7DF5F4449111D5BEA300B0D01A55EF","6F7DF5FB449111D5BEA300B0D01A55EF","6F7DF5FE449111D5BEA300B0D01A55EF","6F7DF5FC449111D5BEA300B0D01A55EF","6F7DF5F6449111D5BEA300B0D01A55EF","A9A5B40DF7204F27A04AB3C74225477E","B651EC29A3074BA68F31DE99FC300AF7","7C63D4E70B2741C3A5B54A2EFD40961B","6F7DF5F7449111D5BEA300B0D01A55EF","6F7DF5FD449111D5BEA300B0D01A55EF","6F7DF5F5449111D5BEA300B0D01A55EF","6F7DF5F8449111D5BEA300B0D01A55EF","2146A148C528458181CD816CD96E71D3","8F090B600594488A8FF89A5867C78973","8107C33EDD9911D3B98100C04F2233EA","8107C33FDD9911D3B98100C04F2233EA","6F7DF5FF449111D5BEA300B0D01A55EF","8107C357DD9911D3B98100C04F2233EA","6F7DF606449111D5BEA300B0D01A55EF","6F7DF609449111D5BEA300B0D01A55EF","6F7DF600449111D5BEA300B0D01A55EF","6F7DF601449111D5BEA300B0D01A55EF","6F7DF602449111D5BEA300B0D01A55EF","6F7DF603449111D5BEA300B0D01A55EF","6F7DF608449111D5BEA300B0D01A55EF","6F7DF604449111D5BEA300B0D01A55EF","6F7DF605449111D5BEA300B0D01A55EF","6F7DF607449111D5BEA300B0D01A55EF","8107C347DD9911D3B98100C04F2233EA","8107C327DD9911D3B98100C04F2233EA","F262C811DDA611D3B98100C04F2233EA","F262C812DDA611D3B98100C04F2233EA","F262C813DDA611D3B98100C04F2233EA","F262C830DDA611D3B98100C04F2233EA","F262C814DDA611D3B98100C04F2233EA","F262C815DDA611D3B98100C04F2233EA","F262C816DDA611D3B98100C04F2233EA","F262C817DDA611D3B98100C04F2233EA","F262C818DDA611D3B98100C04F2233EA","F262C819DDA611D3B98100C04F2233EA","F262C81ADDA611D3B98100C04F2233EA","F262C81BDDA611D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA","F262C81DDDA611D3B98100C04F2233EA","F262C81EDDA611D3B98100C04F2233EA","F262C81FDDA611D3B98100C04F2233EA","F262C820DDA611D3B98100C04F2233EA","F262C821DDA611D3B98100C04F2233EA","F262C822DDA611D3B98100C04F2233EA","F262C831DDA611D3B98100C04F2233EA","F262C824DDA611D3B98100C04F2233EA","F262C825DDA611D3B98100C04F2233EA","F262C826DDA611D3B98100C04F2233EA","F262C828DDA611D3B98100C04F2233EA","F262C829DDA611D3B98100C04F2233EA","5CCBF590DAB311D5AD0E00C04F0423DE","F262C82ADDA611D3B98100C04F2233EA","F262C82BDDA611D3B98100C04F2233EA","F262C82CDDA611D3B98100C04F2233EA","F262C82DDDA611D3B98100C04F2233EA","F262C82EDDA611D3B98100C04F2233EA","F262C82FDDA611D3B98100C04F2233EA","A202C222DD9D11D3B98100C04F2233EA","A202C223DD9D11D3B98100C04F2233EA","A202C224DD9D11D3B98100C04F2233EA","A202C225DD9D11D3B98100C04F2233EA","A202C226DD9D11D3B98100C04F2233EA","A202C228DD9D11D3B98100C04F2233EA","A202C227DD9D11D3B98100C04F2233EA","A202C229DD9D11D3B98100C04F2233EA","A202C210DD9D11D3B98100C04F2233EA","A202C211DD9D11D3B98100C04F2233EA","A202C212DD9D11D3B98100C04F2233EA","A202C213DD9D11D3B98100C04F2233EA","A202C22ADD9D11D3B98100C04F2233EA","A202C22BDD9D11D3B98100C04F2233EA","A202C214DD9D11D3B98100C04F2233EA","A202C215DD9D11D3B98100C04F2233EA","A202C216DD9D11D3B98100C04F2233EA","A202C217DD9D11D3B98100C04F2233EA","A202C22DDD9D11D3B98100C04F2233EA","A202C218DD9D11D3B98100C04F2233EA","A202C22CDD9D11D3B98100C04F2233EA","A202C219DD9D11D3B98100C04F2233EA","A202C21ADD9D11D3B98100C04F2233EA","A202C22EDD9D11D3B98100C04F2233EA","A202C22FDD9D11D3B98100C04F2233EA","A202C230DD9D11D3B98100C04F2233EA","A202C231DD9D11D3B98100C04F2233EA","A202C21BDD9D11D3B98100C04F2233EA","A202C21CDD9D11D3B98100C04F2233EA","A202C232DD9D11D3B98100C04F2233EA","A202C233DD9D11D3B98100C04F2233EA","A202C234DD9D11D3B98100C04F2233EA","A202C21DDD9D11D3B98100C04F2233EA","A202C21EDD9D11D3B98100C04F2233EA","A202C236DD9D11D3B98100C04F2233EA","A202C21FDD9D11D3B98100C04F2233EA","A202C220DD9D11D3B98100C04F2233EA","A202C237DD9D11D3B98100C04F2233EA","A202C238DD9D11D3B98100C04F2233EA","A202C239DD9D11D3B98100C04F2233EA","A202C221DD9D11D3B98100C04F2233EA","A202C235DD9D11D3B98100C04F2233EA","A202C23ADD9D11D3B98100C04F2233EA","A202C23BDD9D11D3B98100C04F2233EA","9C374206DD9F11D3B98100C04F2233EA","9C374207DD9F11D3B98100C04F2233EA","9C374209DD9F11D3B98100C04F2233EA","9C374220DD9F11D3B98100C04F2233EA","9C37421CDD9F11D3B98100C04F2233EA","9C37420CDD9F11D3B98100C04F2233EA","9C374208DD9F11D3B98100C04F2233EA","9C37421DDD9F11D3B98100C04F2233EA","9C374236DD9F11D3B98100C04F2233EA","9C37420DDD9F11D3B98100C04F2233EA","9C374233DD9F11D3B98100C04F2233EA","9C37420EDD9F11D3B98100C04F2233EA","9C374214DD9F11D3B98100C04F2233EA","9C374216DD9F11D3B98100C04F2233EA","9C374215DD9F11D3B98100C04F2233EA","9C37421EDD9F11D3B98100C04F2233EA","9C374219DD9F11D3B98100C04F2233EA","9C37421ADD9F11D3B98100C04F2233EA","9C374218DD9F11D3B98100C04F2233EA","9C37421BDD9F11D3B98100C04F2233EA","9C37420FDD9F11D3B98100C04F2233EA","9C374210DD9F11D3B98100C04F2233EA","9C37420BDD9F11D3B98100C04F2233EA","9C37421FDD9F11D3B98100C04F2233EA","9C374211DD9F11D3B98100C04F2233EA","9C374221DD9F11D3B98100C04F2233EA","9C37420ADD9F11D3B98100C04F2233EA","9C374212DD9F11D3B98100C04F2233EA","9C374213DD9F11D3B98100C04F2233EA"],BF=12,B=4,AE=1,A3=2,Be=4,BD=256,BP=15,Bc=1,BB=2,AP=4,As=8,c=1,An=2,AK=8,Bm=16,AM=1,H=0,E=" ",d=".",Q="/",Av=";";function K(Bn){var Bo=P.trim(Bn);if(Bo.slice(-1)===Av){Bo=Bo.slice(0,-1);}return Bo;}function z(Bn,Bo){if(!Bo){return Bn;}return Bo.indexOf("#1")>-1?Bo.replace("#0.","").replace("#1",Bn):Bo.replace("#0",Bn);}function k(Bp,Bs,Bq){var Bu=[],Bo=Bq.length,Bt,Bn,Bv,Br,Bw=10;Bn=mstrApp.isBigQuery?"":((this.getDBRole&&this.getDBRole(this.SelDBRoleID).mdDBRole.cpat)||"");Bv=mstrApp.isBigQuery?"":((this.getDBRole&&this.getDBRole(this.SelDBRoleID).mdDBRole.tpat)||"");Bu.push({v:"select",oi:{n:"select",sta:100,t:100}},{isNew:true,v:" ",isDelimiter:true});Z.forEach(Bq,function(By,Bx){Bu.push({v:z(By.cln,Bn)});Bt=Bx<Bo-1;if(Bt){Bu.push({v:",",isDelimiter:true});}Bu.push({v:"\n",isDelimiter:true});if(Bt){for(Br=0;Br<Bw;++Br){Bu.push({v:" ",isDelimiter:true});}}});Bs=z(Bs,Bv);Bu.push({v:"from",oi:{n:"from",sta:100,t:100}},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:" ",isDelimiter:true},{v:(Bp?z(Bp,Bv)+d+Bs:Bs)},{v:";"});this.raiseEvent({name:"sqlTokensAdded",value:Bu});}function AB(Bo){if(!Bo||!Bo.length){return ;}var Bn=Bo[Bo.length-1];if(Bn&&Bn.tp===-1){Bo.pop();}if(Bo[0]&&(Bo[0].tp===64||(Bo[0].tp===36&&Bo[0].v==="$"))){Bo.splice(0,1);}}function C(Bo){var Bn=[];Z.forEach(Bo,function(Bp){Bn.push(Bp.v);});return Bn.join(" ");}function Aj(Bo){var Bn={">=":2,"<>":5,"<=":4,"<":3,">":1},Bp;for(Bp in Bn){if(Bo.indexOf(Bp)>-1){return Bn[Bp];}}return 0;}function D(Bp,Br){var Bn=function(Bt,Bs){return mstrmojo.array.stringSorter(Bt.n||Bt.did,Bs.n||Bs.did);},Bq,Bo=[];if(Br){Z.forEach(Bp,function(Bs){Z.forEach(Bs.fns,function(Bt){if(Z.indexOf(b,Bt.did)>-1){Bs.fns=Bs.fns.sort(Bn);Bq=[];Z.forEach(Bs.fns,function(Bu){if(Z.indexOf(b,Bu.did)>-1){Bq.push(Bu);}});Bs.fns=Bq;Bo.push(Bs);return false;}});});Bo=Z.filter(Bo,function(Bs){return Bs.n&&(Bs.n.indexOf("Financial")===-1&&Bs.n.indexOf("Statistical")===-1);});}else{Z.forEach(Bp,function(Bs){Z.forEach(Bs.fns,function(Bt){if(Z.indexOf(BW,Bt.did)>-1){Bs.fns=Bs.fns.sort(Bn);if(mstrApp.isCloudPro&&Bt.did===BW[2]){Z.removeItems(Bs.fns,"did",[{did:BM}]);}Bo.push(Bs);return false;}});});}Bo=Bo.sort(Bn);return Bo;}var AR={1:"Sum",2:"Avg",3:"Min",4:"Max",5:"Count",6:"Count<Distinct=true>"};var BW=["8107C31BDD9911D3B98100C04F2233EA","6F7DF5F8449111D5BEA300B0D01A55EF","4A257916A153468384320E8DB7FD338B","8107C345DD9911D3B98100C04F2233EA","6F7DF605449111D5BEA300B0D01A55EF","8107C324DD9911D3B98100C04F2233EA","F262C81CDDA611D3B98100C04F2233EA"];var BM="8107C344DD9911D3B98100C04F2233EA",Bh=".";function A6(Br,Bn,Bs){if(!Bs){return ;}var Bq=Bs.expr,Bo,Bp=Bs.cols;Z.forEach(Bq,function(Bt){Bo=Bt.tknctx&&Bt.tknctx.oi;if(Bo&&Bo.tp===26){if(Bt.extra.sqlti.als===Br){Bt.extra.sqlti.als=Bn;Bt.v=(Bt.v+"").replace(Br,Bn);}}});Z.forEach(Bp,function(Bt){if(Bt.t===Br){Bt.t=Bn;Bt.v=(Bt.v+"").replace(Br,Bn);}});Bs.n=(Bs.n+"").replace(Br,Bn);Z.forEach(Bs.nds,function(Bt){A6(Br,Bn,Bt);});}function I(Bv,Bn){Bv=Bv||{};if(!Bn){return ;}var Bs=Bn.expr,Bu,Bp,Bt=Bn.cols,Br,Bo,Bq=this;Z.forEach(Bs,function(Bx){if(Bx.tp===309){var Bw=Bq.resolveToken(Bx.v.toString());Bp=Bw.tableName;Bo=Bw.colName;if(Bp&&Bo){Bv[Bp]=Bv[Bp]||{};Bv[Bp][Bo]=true;}}});Z.forEach(Bt,function(Bw){Bp=Bw.t.toLowerCase();Bv[Bp]=Bv[Bp]||{};Bv[Bp][Bw.col.toLowerCase()]=true;});Z.forEach(Bn.nds,function(Bw){I.call(Bq,Bv,Bw);});}var X=mstrmojo.expr,BG=X.ET,A={19:" AND ",20:" OR ",21:"(NOT( "},AU="))";function Ao(Br){if(!Br){return"";}if(!Br.nds){return Br.n||"";}var Bp=[],Bq=Br.nds,Bo=Br.fn,Bn;Z.forEach(Bq,function(Bt,Bs){Bn=Bt.not;if(Bs!==0){Bp.push(A[Bo]);}Bn&&Bp.push(A[21]);Bp.push("(");Bp.push(Ao(Bt));Bp.push(")");Bn&&Bp.push(AU);});return Bp.join("");}function AJ(Bn){return BR(Bn).replace(/&apos;/g,"'");}function Ai(Bn){return Bn.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}var BI=function(Bn){if(Bn==null){return"null";}var Bo=typeof (Bn);if(Bo!="object"){return Bo;}else{if(Bn.length===undefined){return"object";}else{return"array";}}};var AF=[{n:"Text",v:"3"},{n:"Number",v:"2"},{n:"Date",v:"8"},{n:"Time",v:"9"},{n:"DateTime",v:"1"},{n:"URL",v:"5"},{n:"Email",v:"6"},{n:"HTML Tag",v:"7"},{n:"Symbol",v:"10"},{n:"Big Decimal",v:"11"},{n:"Phone Number",v:"12"}];function w(Br){var Bp=[],Bo=[];var Bq={mi:true,cn:true,v:true,tp:true,lv:true,sta:true,tkn:true};Bp.push({lv:3,sta:1,tp:64,v:""});Bp.push({lv:1,sta:1,tp:2,v:Br});Bp.push({lv:2,sta:1,tp:-1,v:""});var Bn={getArrItemName:function(Bu,Bs,Bt){return"tkn";},isSerializable:function(Bu,Bt,Bs){return(Bq[Bu])?true:false;}};Bo.push('<mi cn="3">');Bo.push(P.json2xml("tkn",Bp[0],Bn));Bo.push(P.json2xml("tkn",Bp[1],Bn));Bo.push(P.json2xml("tkn",Bp[2],Bn));Bo.push("</mi>");return Bo.join("");}var Al=0,g=1,p=2,Bg=3,Bf=4,Aw=5,F=6,AI=7,BQ=8,BH=9,Ar=10,Ad=11,AS=12;var Am={0:Al,1:p,2:p,3:p,4:p,5:p,6:p,7:p,8:Bg,9:Bg,10:Bg,11:Bg,12:Bg,13:Bg,14:BQ,15:BH,16:g,17:Bg,18:Bg,30:Ad,31:Al,33:Al};function t(Bp,Bt){var Br=[],Bo,Bs;for(var Bq=0,Bn=Bt.length;Bq<Bn;Bq++){Bo=Bt[Bq];if(Bp.uiids[Bo.tid+Bo.cid]){Bs=Bp.uiids[Bo.tid+Bo.cid];Br.push(Bs);}}return Br;}function AW(Bs,Bp,Bt,Bn,Bz,Bw){if(!Bp.ftype){var Bo=Ai(Bp.exp);if(Bo.indexOf("? aptqbr_prompt")>-1){Bw.push({n:Bo,cid:Bn.chn[0].cmid});return ;}var B0=t(Bs,AY(Bn,[])),Bv,Bx=[];Z.forEach(B0,function(B1){Bv=mstrmojo.all[B1];Bv&&Bv.updateState&&Bv.updateState(2);Bx.push({t:Bv.srcTable,col:Bv.text});});return Bt.push({et:"*",n:Bo,expr:[{v:Bo}],sqltp:Bz,cols:Bx});}switch(Bp.ftype){case 19:case 20:case 21:var Br=[],By;for(var Bq=0,Bu=Bp.children.length;Bq<Bu;Bq++){By=Bp.children[Bq];AW(Bs,By,Br,Bn.chn[Bq],Bz,Bw);}if(Br.length==0){return ;}if(Br.length<Bu&&Br.length==1){Bt.push(Br[0]);}else{Bt.push({et:14,fn:Bp.ftype,nds:Br,not:(Bp.ftype==21),sqltp:Bz});}break;default:break;}}function M(Bp,Br,Bn){if(!Br.ftype){Bn.push({lcid:Bp.chn[0].col,rcid:Bp.chn[1].col,exp:Br.exp});return Br.exp;}var Bq,Bo,Bs;switch(Br.ftype){case 19:case 20:Bq=M(Bp.chn[0],Br.children[0],Bn);Bo=M(Bp.chn[1],Br.children[1],Bn);Bs=Bq+((Br.ftype==19)?" AND ":" OR ")+Bo;break;case 21:Bs=" NOT "+M(Bp.chn[0],Br.children[0],Bn);break;default:break;}return Bs;}function AY(Bp,Bq){var Br=Bp.chn;if(!Br){if(Bp.col&&Bp.stbid){Bq.push({cid:Bp.col,tid:Bp.stbid});}return Bq;}for(var Bo=0,Bn=Br.length;Bo<Bn;Bo++){Bq=AY(Br[Bo],Bq);}return Bq;}function h(Bn){Bn.raiseEvent({name:"dataPreview",mappings:Bn.mappings,dataset:Bn.dataset,selectedColumns:Bn.selectedClns,isRefined:Bn.isRefined});}function BJ(Bn,Bq,Bo){var Bp=Bn[Bn.length-1].oi.def.csl.roo.chn[0].va.vv;Bp=Bp?Ai(Bp):"";mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:Bp});Bo.populateFFSQLMapping(Bq);if(Bo.firstTimeLoading){h(Bo);Bo.firstTimeLoading=false;}}function Au(CP,Bs){if(!CP||!CP.btb){return ;}var CA=CP.btb;var CU=CP.datap.maps;if(Bs.firstTimeLoading){Bs.orimaps=CU;}Bs.refresh_opt=CA[0].oi.def.crpt;var B9=null;if(CA[0].oi.ext_type===304){Bs.set("isFFSQL",true);Bs.set("FFSQLMode",true);mstrApp.isFFSQL=mstrApp.isFFSQLMode=true;for(var Ca=0,CB=CA.length;Ca<CB;Ca++){if(CA[Ca].oi.tp===53){B9=CA[Ca].oi.def.dbr.did;}}B9&&Bs._set_SelDBRoleID("SelDBRoleID",B9,false);BJ(CA,CU,Bs);return ;}var Cc={},Bp={},Bo,Br;for(var Ca=0,CB=CA.length;Ca<CB;Ca++){Br=CA[Ca].oi;switch(Br.tp){case 53:Cc[Br.did]={cs:Br.def.cs.cs,tbn:AJ(Br.def.tbn),did:Br.did,ns:Br.def.ns};break;case 26:Bp[Br.did]={did:Br.did,cln:AJ(Br.def.cln),dttp:Br.def.dt.tp,dtps:Br.def.dt.ps,dtsc:Br.def.dt.sc};break;case 3:Bo=Br.efd;break;default:break;}}var CC=null,CQ=null;for(var Ca=0,CB=Bo.length;Ca<CB;Ca++){CQ=Bo[Ca].oi;switch(CQ.tp){case 53:CC=CQ.def.sqs.c_c[0];B9=CQ.def.dbr.did;break;default:break;}}Bs._set_SelDBRoleID("SelDBRoleID",B9,false);if(CC===null){return ;}var CJ=CC.sqcs.c_c;var B5=CC.sjs.c_c;var Cb=CC.stbs.c_c;var B1=CC.whe;var CS=CC.w_cond;var Cf=CC.he;var Bu=CC.h_cond;Bs.selectedClns=[];Bs.dbtables=[];Bs.joins=[];Bs.joinsInfo={};Bs.uiids={};Bs.tables={};var CX=Bs.selectedClns;var CO={},B8,Cd,B0,B4,Bx;for(var Ca=0,CB=CJ.length;Ca<CB;Ca++){if(CJ[Ca].der&2147483648){CX.push({isDerived:true,existing:true});continue;}B8=AY(CJ[Ca].exp.roo,[]);Cd=AJ(CJ[Ca].exp.exp);CX.push({wid:[],expr:[{v:Cd}],existing:true});for(var CZ=0;CZ<B8.length;CZ++){Bx=B8[CZ];B0=Bx.cid;B4=Bx.tid;CO[B4]=CO[B4]||{};CO[B4][B0]=CO[B4][B0]||{};CO[B4][B0].state=1;CO[B4][B0].count=!CO[B4][B0].count?1:CO[B4][B0].count+1;CX[Ca].wid.push(B4+B0);}}Bs.tbns={};var B3=Bs.pos_hash;var Bw=Bs.tbns,CY=[];var CV,Bv,Bt,B0,CG,CT,B7;for(var Ca=0,CB=Cb.length;Ca<CB;Ca++){CY[Ca]={};CV=Cb[Ca];B4=CV.id;Bv=CV.dbt.did;B7=CV.als?AJ(CV.als):Cc[Bv].tbn;CG=Cc[Bv].cs;if(B3&&B3[B7]){CY[Ca].pos={w:B3[B7].w,h:B3[B7].h,t:B3[B7].t,l:B3[B7].l};}else{Bt=CV.sqltf;if(Bt&&Bt.length){CY[Ca].pos={w:(Bt[0]&&Bt[0].pdv)/BU||A5,h:(Bt[1]&&Bt[1].pdv)/BU||L,t:(Bt[2]&&Bt[2].pdv)/BU||m,l:(Bt[3]&&Bt[3].pdv)/BU||R};}}CT=[];for(var CZ=0,CE=CG.length;CZ<CE;CZ++){B0=CG[CZ].did;CT.push(V.copy(Bp[B0]));if(CO[B4]&&CO[B4][B0]){CT[CZ].state=1;CT[CZ].count=CO[B4][B0].count;}}CY[Ca].did=B4;CY[Ca].cs=CT;CY[Ca].tbn=B7;CY[Ca].ns=Cc[Bv].ns;CY[Ca].dbtbn=Cc[Bv].tbn;Bw[B7]=B7;}if(Bs.firstTimeLoading&&!Bs.isNew){Bs.orits=Bs.orits||CY.slice(0);}var B6=Bs.orits;Z.forEach(CY,function(Cg){if(Z.find(B6,"did",Cg.did)>-1){Cg.existing=true;Cg.readOnly=mstrApp.isCloudPro;}});Bs.raiseEvent({name:"BindingTableLoaded",value:CY});for(var Ca=0,CB=CX.length;Ca<CB;Ca++){var CW=CX[Ca].wid;if(CW){for(var CZ=0,CE=CW.length;CZ<CE;CZ++){CW[CZ]=Bs.uiids[CW[CZ]];}}}Bs.populateMappings(CU);if(CP.datap.data){Bs.populateDataset(CP.datap.data);}h(Bs);var B2,CM,Bq,By,CN,CH,CK,Bn,Cd,CD,Ce;for(var Ca=0,CB=B5.length;Ca<CB;Ca++){B2=B5[Ca];CM=B2.ltid,Bq=B2.rtid,By=B2.jt,idx=B2.ix;CH=B2.cdn.roo;Ce=[];Cd=AJ(M(CH,B2.exp_bo,Ce));CD=Bs.uiids[CM]+Bs.uiids[Bq];Bs.joins.push(CD);Bs.joinsInfo[CD]=new Object();Bs.joinsInfo[CD].jt=""+By;Bs.joinsInfo[CD].exp=Cd;Bs.joinsInfo[CD].srctID=Bs.uiids[CM];Bs.joinsInfo[CD].tgttID=Bs.uiids[Bq];if(!Bs.joinsInfo[CD].links){Bs.joinsInfo[CD].links=new Object();}if(Bs.tables[Bs.uiids[CM]].njoins){Bs.tables[Bs.uiids[CM]].njoins++;}else{Bs.tables[Bs.uiids[CM]].njoins=1;}if(Bs.tables[Bs.uiids[Bq]].njoins){Bs.tables[Bs.uiids[Bq]].njoins++;}else{Bs.tables[Bs.uiids[Bq]].njoins=1;}for(var CZ=0;CZ<Ce.length;CZ++){CK=Ce[CZ].lcid;Bn=Ce[CZ].rcid;Cd=AJ(Ce[CZ].exp);var CR=Bs.uiids[CM+CK],Bz=Bs.uiids[Bq+Bn];Bs.joinsInfo[CD].links[CR+Bz]={srcw:mstrmojo.all[CR],tgtw:mstrmojo.all[Bz],coords:[],exp:Cd,jid:CD,op:Aj(Cd)};if(Bs.joinsInfo[CD].nlinks){Bs.joinsInfo[CD].nlinks++;}else{Bs.joinsInfo[CD].nlinks=1;}}}Bs.raiseEvent({name:"JoinsLoaded"});var CA=[],CI=[];if(B1.exp!=""){AW(Bs,CS,CA,B1.roo,0,CI);CA.length&&(Bs.conditions.where=CA[0]);if(CI.length&&!Bs.isCubeReport){Bs.pattrs={};var CF=CU.amps,CL;Z.forEach(CF,function(Cg){if(Z.find(CI,"cid",Cg.afmps[0].sqc.id)>=0){CL=Cg.aimp;Bs.pattrs[CL.atid]={n:CL.atnm,tp:12};}});}}if(Cf.exp!=""){CA=[];AW(Bs,Bu,CA,Cf.roo,1);CA.length&&(Bs.conditions.having=CA[0]);}Bs.firstTimeLoading=false;}function AQ(Bp,Bo,Bn){mstrApp.getRootController().getDataService()[Bn||"submitRequest"](Bp,Bo);}function G(Bn,Bq,Bp){var Bo={};if(!Bn[Bq]){Bn[Bq]=Bp;}else{if(!Bn[Bp]){Bn[Bp]=Bq;}else{while(Bn[Bq]){Bo[Bq]=true;Bq=Bn[Bq];if(Bo[Bq]){return ;}}Bn[Bq]=Bp;}}}function BN(Bn,Bp,Bo){if(Bn[Bp]){delete Bn[Bp];}else{if(Bn[Bo]){delete Bn[Bo];}}}function BE(Bn,Bq,Bp){var Bo={};while(Bn[Bq]){Bo[Bq]=true;Bq=Bn[Bq];if(Bo[Bq]){return true;}}while(Bn[Bp]){Bo[Bp]=true;Bp=Bn[Bp];if(Bo[Bp]){return true;}}return Bq===Bp;}function Bj(Bs,Bq){var Bt=[],Bp,Bo,Bn,Br;for(Bo in Bs){Bn=Bs[Bo].links;Br=Bn[0];Bp={srcIndex:Bq.gettIndex(Br.srcw.srcID),destIndex:Bq.gettIndex(Br.tgtw.srcID),jtype:Br.jtype,jexp:Bs[Bo].jexp};Bt.push(Bp);}return Bt;}mstrmojo.qb._hasQBModel=mstrmojo.provide("mstrmojo.qb._hasQBModel",{id:"QBuilderModel",tables:{},selLink:null,dbtbls:{},uiids:{},riid:"",analysisID:null,alertTitle:null,msgid:"",dbtables:[],selectedClns:[],joins:[],joinsInfo:{},joinCols:{},dbrs:[],dsns:[],drivers:[],dbms:[],suppdbs:[],pos_hash:{},bindingT:[],tbns:{},catalogRefresh:false,SelDBRoleID:null,prevDBRoleID:null,isDI:false,FFSQLMode:false,isFFSQL:false,isCloud:false,supportTimeGeo:true,isCubeReport:true,autoRefreshSQL:false,isDirty:false,SQLPreviewStmt:"",SQLstmt:undefined,refresh_opt:1,mappings:[],cloneMappings:[],dataset:[],cacheMP:[],cacheDS:[],conditions:{},cnum:0,datatypes:AF,init:function Bi(Bn){if(this._super){this._super(Bn);}this.dbtables=[];this.tables={};this.selectedClns=[];this.tbns={};this.joins=[];this.joinsInfo={};this.joinCols={};this.uiids={};this.conditions={};this.mappings=[];this.cloneMappings=[];this.dataset=[];this.cacheMP=[];this.cacheDS=[];},addLink:function n(Bp,Bt,Bo,Bs){var Bq=this,Bx=Bp.id+Bt.id,By=Bq.joinsInfo[Bo].links,Br=Bq.joinsInfo[Bo].jt;var Bw=this.getjIndex(Bo),Bn=this.brackets(Bp.oriexpr)+"="+this.brackets(Bt.oriexpr),Bv=Bq.joinsInfo[Bo].exp+" AND "+Bn;if(By[Bx]||By[Bt.id+Bp.id]){return ;}var Bu={success:function(Bz){Bq.joinsInfo[Bo].exp=Bv;By[Bx]={};By[Bx].srcw=Bp;By[Bx].tgtw=Bt;By[Bx].coords=[];By[Bx].exp=Bn;By[Bx].jid=Bo;Bq.joinsInfo[Bo].exp=Bv;if(Bs&&Bs.success){Bs.success();}Bq.raiseEvent({name:"JoinsAdded"});}};G(Bq.joinCols,Bp.id,Bt.id);mstrApp.getRootController().getDataService().editJoin(Bu,{jindex:Bw,exp:Bv,tbid:Bq.tableID||"",jtype:Br});},removeLink:function AC(Bt,Bn,Bq){var Bo=this,Bw=Bo.joinsInfo[Bn].links,Bp=Bo.joinsInfo[Bn].jt,Bv=Bo.getjIndex(Bn),Bs="",Bu=Bw[Bt];V.forEach(Bw,function(By,Bx){if(Bx!==Bt){Bs+=(Bs?" AND ":"")+By.exp;}});BN(Bo.joinCols,Bu.srcw.id,Bu.tgtw.id);if(!Bs){Bo.removeJoin(Bn,Bq);}else{var Br={success:function(Bx){mstrApp.msgid=Bx.msgid;Bo.joinsInfo[Bn].exp=Bs;delete Bw[Bt];if(Bq&&Bq.success){Bq.success();}}};mstrApp.getRootController().getDataService().editJoin(Br,{jindex:Bv,exp:Bs,tbid:Bo.tableID||"",jtype:Bp});}},getTouchValue:function Ax(Bn,Bs){for(var Bq in this.joinsInfo){var Bp=this.joinsInfo[Bq].links;for(var Br in Bp){var Bo=Bp[Br].coords;if(this.inPoly(Bo,Bn,Bs)){return[Bq,Br];}}}return null;},inPoly:function BC(Bp,Bz,By){var Bv=Bp.length;var Bs,Bn,B0,Bu,Bq,Bx,Bo,Bw,Bt;var Br=false;if(Bv/2<3){return false;}B0=Bp[Bv-2];Bu=Bp[Bv-1];for(Bt=0;Bt<Bv;Bt=Bt+2){Bs=Bp[Bt];Bn=Bp[Bt+1];if(Bs>B0){Bq=B0;Bo=Bs;Bx=Bu;Bw=Bn;}else{Bq=Bs;Bo=B0;Bx=Bn;Bw=Bu;}if((Bs<Bz)==(Bz<=B0)&&((By-Bx)*(Bo-Bq)<(Bw-Bx)*(Bz-Bq))){Br=!Br;}B0=Bs;Bu=Bn;}return Br;},exprEditor:function(Bo,Bp,Bq,Bn){this.getFunctions();},brackets:function(Bn){return"["+Bn+"]";},isEquivalentExpr:function(Bp,Bo){var Bn=function Bn(Bq){return Bq.replace(/\s/g,"").replace(/\[+(.*?)\]+/g,"$1").replace(/\(+(.*?)\)+/g,"($1)").toUpperCase();};return(Bn(Bp)===Bn(Bo));},_set_SelDBRoleID:function(Bq,Bo){var Bn=this,Bp=(Bn.SelDBRoleID!==Bo);this._super&&this._super(Bq,Bo);Bn.SelDBRoleID=Bo;if(Bp&&Bo){Bn.setDBRole&&Bn.setDBRole(Bo);}Z.forEach(Bn.dbrs,function(Br){if(Br.data.isPrimary){Br.data.isPrimary=false;Bn.raiseEvent({name:A7.DBROLE_CHANGED,item:Br});}if(Br.did===Bo){Br.data.isPrimary=true;Bn.raiseEvent({name:A7.DBROLE_CHANGED,item:Br});}});if(Bp){Bn.raiseEvent({name:A7.DBTABLES_ENABLED,value:Bn.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}return Bp;},setDBRole:function(Bo){var Bn=this;Bn.connectLiveSupport=undefined;if(this.tableID){mstrApp.getRootController().getDataService().setDBRole({success:function(Bp){mstrApp.msgid=Bp.msgid;Bn.loadConnectLiveSupport();}},{dbrid:Bo,tbid:this.tableID});}},autoMap:function(Bp,Bo,Br){var Bq=this;if(!Bq.FFSQLMode){if(Bq.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(Bp&&Bp.failure){Bp.failure();}return ;}else{if(Bq.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(Bp&&Bp.failure){Bp.failure();}return ;}}}var Bn={success:function(Bt){Bq.isDirty=false;if(!Bo){var Bs=Bt.datap,Bw=Bs.maps,Bu=Bs.data;if(Bq.FFSQLMode){var Bv=[];Bq.populateFFSQLMapping(Bw);Bq.populateDataset(Bu);}else{Bq.populatePreview(Bw,Bu);}h(Bq);}if(Bp&&Bp.success){Bp.success(Bt);}}};Bq.loadReport(Be,BP,c+An,Br?H:AM,Bn);},convertToQueryBuilder:function AA(Bn){var Bo=this;mstrApp.getRootController().getDataService().convertToQB({success:function Bp(Bq){mstrApp.msgid=Bq.msgid;mstrApp.isFFSQLMode=false;Bo.isDirty=true;Bo.FFSQLMode=false;Bo.mappings=Bo.cacheMP;Bo.dataset=Bo.cacheDS;h(Bo);Bn&&Bn.success&&Bn.success(Bq);}},{tbid:Bo.tableID||""});},convertToFFSQL:function AH(Bq,Bo,Bn){var Bp=this;Bp.SQLstmt=Bq;mstrApp.getRootController().getDataService().convertToFFSQL({success:function Br(Bs){mstrApp.msgid=Bs.msgid;Bp.isDirty=true;Bp.FFSQLMode=true;mstrApp.isFFSQLMode=true;Bp.cacheMP=Bp.mappings;Bp.cacheDS=Bp.dataset;Bp.dataset=[];Bp.mappings=[];if(!Bn){h(Bp);}Bo&&Bo.success&&Bo.success(Bs);}},{tbid:Bp.tableID||"",exp:P.encodeXMLAttribute(Bq)});},isMultiPassSQL:function Ac(Bn){return K(Bn).indexOf(Av)>-1;},autoMapFFSQL:function Ab(Bo,Bq){var Bn=this;Bo=K(Bo);mstrApp.getRootController().getDataService().editFFSQL({success:function Bp(Br){Bn.isDirty=Bn.isDirty||(P.trim(Bn.SQLstmt)===P.trim(Bo)?false:true);Bn.SQLstmt=Bo;Bn.isDDA=Bn.isDDA&&!Bn.isMultiPassSQL(Bo);if(Bo){Bn.autoMap(Bq,undefined,undefined,true);}else{Bn.dataset=[];Bn.mappings=[];h(Bn);Bq&&Bq.success&&Bq.success({msgid:mstrApp.msgid});}}},{exp:P.encodeXMLAttribute(Bo).replace(/\t/g,BT),tbid:Bn.tableID||""});},editFFSQL:function BX(Bo,Bp){var Bn=this;if(this.SQLstmt===Bp){if(Bo&&Bo.success){Bo.success();return ;}}Bp=K(Bp);mstrApp.getRootController().getDataService().editFFSQL({success:function Bq(Br){mstrApp.msgid=Br.msgid;Bn.isDirty=true;Bn.SQLstmt=Bp;Bo&&Bo.success&&Bo.success(Br);}},{exp:P.encodeXMLAttribute(Bp).replace(/\t/g,BT),tbid:Bn.tableID||""});},updateSQL:function(Bn){this.getSQL(Bn);},getSQL:function f(Bo){var Bp=this;if((!Bp.SelDBRoleID&&Bp.riid===A8)||Bp.dbtables.length===0){var Bn="";if(Bo&&Bo.success){Bo.success(Bn);}}else{Bp.loadReport(A3,BP,null,null,{success:function Bq(Bs){var Bt=Bs.sqls[Bs.sqls.length-1],Br=Bt?Ai(Bt):"";if(Bo&&Bo.success){Bo.success(Br);}}},true);}},isNameUnique:function(Bs,Bo,Bp){var Bt=this,Br=Bt.mappings;for(var Bq=0,Bn=Br.length;Bq<Bn;Bq++){if(Bq!=Bo){if(Bp===Br[Bq].alias&&Br[Bo].tp==Br[Bq].tp){return false;}}}return true;},mapAttribute:function(Bz,Bo,Bq,Bv,Bw,Bx){var Bp=this,Bs=Bp.mappings;for(var Br=0,Bu=Bs.length;Br<Bu;Br++){if(Bs[Br].afid===(Bo+Bq)){if(Bw&&Bw.failure){Bw.failure(mstrmojo.desc(9926,"The attribute form you select has been mapped. Please choose a different one."));}return false;}}var Bt=Z.find(Bs,"did",Bz),Bn=Bs[Bt],By=function By(B0){mstrApp.getRootController().getDataService().remapObject({success:function B1(B2){Bp.autoMap();if(Bw&&Bw.success){Bw.success(B2);}}},{mpcs:JSON.stringify(B0),docid:mstrApp.docID||"",suppressError:true});};if(Bn.isIDForm&&Bn.multiForms&&!Bn.ipa){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var B0=[];Z.forEach(Bs,function(B1){if(B1.oid===Bx&&B1.did!==Bz){B0.push({did:B1.did,aid:"",ot:BF});}});B0.push({did:Bz,aid:Bo,fid:Bq});By(B0);}}});}else{By([{did:Bz,aid:Bo,fid:Bq}]);}},unmap:function(Br,Bq){var Bs=this,Bt=Bs.mappings,Bo=Z.find(Bt,"did",Br),Bn=Bt[Bo],Bp=function Bp(Bu){mstrApp.getRootController().getDataService().remapObject({success:function Bv(Bw){Bs.autoMap();}},{mpcs:JSON.stringify(Bu),docid:mstrApp.docID||"",suppressError:true});};if(Bn.isIDForm&&Bn.multiForms){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:function(){var Bu=[];Z.forEach(Bt,function(Bv){if(Bv.oid===Bq&&Bv.did!==Br){Bu.push({did:Bv.did,aid:"",ot:BF});}});Bu.push({did:Br,aid:"",ot:BF});Bp(Bu);}}});}else{Bp([{did:Br,aid:"",ot:BF}]);}},remap:function S(Bo,Bn){mstrApp.getRootController().getDataService().changeMapping({success:function Bp(Bq){if(Bn&&Bn.success){Bn.success(Bq);}}},{tbid:this.tableID||"",mpcs:JSON.stringify([Bo]),docid:mstrApp.docID||""});},commitMapping:function(Bu){var Bo=this;var Bv=this.cloneMappings,Bw=this.mappings;var Br,Bs=[],Bn,Bp,Bx;for(var Bq=0,Bt=Bv.length;Bq<Bt;Bq++){Bp=Bv[Bq];Bx=Bw[Bq];Br={};Bn=false;if(!Bx.selected){Bs.push({did:Bx.did,cmf:0});}else{if(Bx.alias!=Bp.alias){Br.alias=Bx.alias;Bn=true;}if(Bx.dtp!=Bp.dtp){Br.bft=Bx.dtp;Bn=true;}if(Bx.tp!=Bp.tp){Br.ot=Bx.tp;Bn=true;}if(Bn){Br.did=Bx.did;Bs.push(Br);}}}if(Bs.length>0){mstrApp.getRootController().getDataService().remapObject({success:function(By){if(Bu&&Bu.success){Bu.success(By);}}},{mpcs:JSON.stringify(Bs),docid:mstrApp.docID||""});}else{if(Bu&&Bu.success){Bu.success();}}},validateExpr:function J(Bo,Bn){this.parseExpression(Bo.vo===1,1,Bo.cIndex,null,Bo.qbrex,Bo.expr,Bo.tKnStrm,Bn);},parseExpression:function AL(Bu,Bo,Bv,Bn,Bt,Bq,Bs,Br){var Bp={qbrex:Bt};Bp.qindex=Bo||1;Bp.tbid=this.tableID||"";if(Bn!=null){Bp.jindex=Bn;}if(Bq!=null){Bp.exp=Bq;}if(Bs){Bp.tokenStrm=Bs;}Bp.vo=1;mstrApp.getRootController().getDataService().parse({success:function(Bw){if(Bw&&Bw.mi&&Bw.mi.items){var Bx=Bw.mi.items;AB(Bx);Bw.expr=C(Bx);}if(Br&&Br.success){Br.success(Bw);}}},Bp);},canAddTable:function Aq(Br){var Bq=this,Bo=Bq.SelDBRoleID,Bp=Bq.dbridForDDA,Bn;if(Bq.isDDA&&Bp&&Bo!==Bp){Bn={name:"directDataAccessTableError"};}if(Bn){if(!Br){this.raiseEvent(Bn);}return false;}return true;},addTable:function W(Bz,B0){var Bs=this,Br=Bz.tbn||Bz.did,Bx=Bs.tbns,By,Bu=1,Bv=[],Bq,Bt=Bs.SelDBRoleID,Bw;if(!this.canAddTable()){return ;}Br=Br.replace(/^[0-9]/,"L");By=Br;while(Bx[By]){By=Br+"_"+(Bu++);}Br=By;Z.forEach(B0,function(B1){Bq=B1.dt;Bv.push({cln:B1.cln,dtps:Bq.ps,dttp:Bq.tp,dtsc:Bq.sc});});var Bp={tbn:Bz.dbtn||Bz.tbn||Bz.did,clns:JSON.stringify(Bv),ns:Bz.ns,alias:Br,tbid:Bs.tableID||""},Bo=this.getMissingTableID(Bz.tbn,Br,Bz.ns);if(Bo){Bp.stbid=Bo;}var Bn={success:function(B1){Bx[Br]=Br;Bs.isDirty=true;mstrApp.msgid=B1.msgid;Bs.raiseEvent({name:"TableAdded",data:B0,table:{x:Bz.x,y:Bz.y,tbn:Br,dbtbn:Bz.tbn||Bz.did,ns:Bz.ns,did:Bo}});if(Bs.dbtables.length>1){Bs.autoJoin();}Bs.prevDBRoleID=Bt;if(!Bs.isDDA){Bw=mstrApp.getRootController().getDDAController();Bw.tryEnableDDACheckbox(false);}}};mstrApp.getRootController().getDataService().addTable(Bn,Bp);},resolveToken:function(Bp){var Bu=Bp.indexOf(Bh),Bs,Br,Bt,Bq,Bv;if(Bu>=1){Bs=Bp.slice(0,Bu).toLowerCase();Br=Bp.slice(Bu+1).toLowerCase();}else{Br=Bp.toLowerCase();Bt=this.tables;for(var Bn in Bt){Bq=Bt[Bn],Bv=Bq.rows;for(var Bo in Bv){if(Bv[Bo].text.toLowerCase()===Br){Bs=Bq.tbn.toLowerCase();break;}}if(Bs){break;}}}return{tableName:Bs,colName:Br};},removeTableFromCondition:function(Br,Bt){if(!Br){return false;}var Bn=Br.nds,Bo,Bq=this;if(Bn){var Bv=[],Bu,Bp;Z.forEach(Bn,function(Bx,Bw){Bq.removeTableFromCondition(Bx,Bt)&&Bv.push(Bw);});for(Bu=Bv.length-1;Bu>-1;Bu--){Bn.splice(Bv[Bu],1);}Bp=Bn.length;if(Bp===1){Br=Bn[0];}return(Bp===0);}var Bs;Z.forEach(Br.expr,function(Bw){if(Bw.tp===309){Bo=Bq.resolveToken(Bw.v).tableName;if(Bo===undefined||Bt===Bo){Bs=true;return false;}}});return Bs;},removeTable:function(Bo,Bq){var Bs=this,Bp=this.gettIndex(Bo.id),Br=Bo.Rows.children;var Bn={widget:Bo,success:function(B1){mstrApp.msgid=B1.msgid;Bs.isDirty=true;var B5,B6,B9=this.widget.id;var B4=Bs.tbns,B7=Bs.tables[B9],Bw=B7.tbn,Bt=B7.dbtbn,B2=B7.ns;if(B4[Bw]){delete B4[Bw];}for(var Bv in Bs.joinsInfo){var By=Bs.joinsInfo[Bv].srctID,Bu=Bs.joinsInfo[Bv].tgttID;if(B9==By||B9==Bu){B6=Bs.joinsInfo[Bv].links;for(B5 in B6){BN(Bs.joinCols,B6[B5].srcw.id,B6[B5].tgtw.id);}delete Bs.joinsInfo[Bv];mstrmojo.array.removeItem(Bs.joins,Bv);Bs.tables[By].njoins--;Bs.tables[Bu].njoins--;}if(Bs.selLink&&Z.indexOf(Bs.selLink[0],B9)>-1){Bs.selLink=null;}}Bs.upttIndex(Bw,Bt,B9,false,B7.did,B2);if(Bs.dbtables.length===0&&Bs.canAddTable(true)){Bs.raiseEvent({name:A7.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();}if(!Bs.isDDA){ddaController=mstrApp.getRootController().getDDAController();ddaController.tryEnableDDACheckbox(true);}var B0=Bs.selectedClns,B8=[],Bz;Z.forEach(Br,function(CA){Z.forEach(B0,function(CC,CB){Bz=Z.indexOf(CC.wid,CA.id);if(Bz>-1){Z.removeIndices(CC.wid,Bz,1);if(Z.indexOf(B8,CB)==-1){B8.push(CB);}}});});B8.sort(mstrmojo.array.numSorter);for(var Bx=B8.length-1;Bx>-1;Bx--){Bs.removeExpression(B8[Bx],true);}if(B8.length>0){h(Bs);}Bs.raiseEvent({name:"refreshTables",items:Bs.dbtables.slice(0)});var B3=Bs.conditions;Bw=Bw.toLowerCase();Bs.removeTableFromCondition(B3.where,Bw)&&(delete B3.where);Bs.removeTableFromCondition(B3.having,Bw)&&(delete B3.having);Bs.updateFilterLabel(B3);if(Bq&&Bq.success){Bq.success();}}};mstrApp.getRootController().getDataService().removeTable(Bn,{tbid:Bs.tableID||"",tindex:Bp});},getAvailableTablesEnabled:function Ap(){return(!mstrApp.isFFSQLMode)?this.canAddTable(true):this.canAddTableSQL(true);},addExpression:function A4(Bn,Bo){var Bt=C(this.selectedClns[Bn].expr);var Br={did:Bn+Bt,alias:Bt,n:Bt,selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:this.selectedClns[Bn].expr,dtp:1,colo:Bn,ix:Bn,tp:0};this.mappings.push(Br);var Bq=this.dataset.length;if(Bq>0){for(var Bp=0;Bp<Bq;Bp++){var Bs=this.dataset[Bp];Bs.push("");}}if(!Bo){mstrApp.getRootController().toggleDataPreview(true);h(this);}},removeExpression:function Bd(Bo,Bq){var Bn=this.selectedClns,Br,Bs=0,Bp;Z.forEach(Bn[Bo].wid,function(Bt){Br=mstrmojo.all[Bt];Br.count--;Br.updateState(0);});if(this.isRefined&&!mstrApp.isFFSQLMode){Bp=Bn[Bo].ix;Z.forEach(Bn,function(Bt){if(Bt.ix>Bp){Bs=Bs?Math.min(Bs,Bt.ix-Bp):Bt.ix-Bp;}});Z.forEach(Bn,function(Bt){if(Bt.ix>Bp){Bt.ix=Bt.ix-Bs;}});}else{Bp=this.mappings[Bo].ix;Z.forEach(this.mappings,function(Bt){if(Bt.ix>Bp){Bs=Bs?Math.min(Bs,Bt.ix-Bp):Bt.ix-Bp;}});Z.forEach(this.mappings,function(Bt){if(Bt.ix>Bp){Bt.ix=Bt.ix-Bs;Bt.colo=Bt.colo-1;}});Z.removeIndices(this.mappings,Bo,1);}Bn.splice(Bo,1);Z.forEach(this.dataset,function(Bt){Z.removeIndices(Bt,Bo,1);});if(!Bq){h(this);}},editExpression:function(Bn){var Bp=this.selectedClns[Bn-1],Bo=Bp.wid;this.exprEditor(Bp,3,null,Bn);},updateExpression:function Bk(Bn){var Bs=C(this.selectedClns[Bn].expr);var Bq=this.mappings[Bn];if(!Bq){return ;}Bq.did=Bn+Bs;Bq.alias=Bs;Bq.n=Bs;Bq.expr=this.selectedClns[Bn].expr,Bq.selected=false;Bq.hasMapped=false;Bq.tp=0;var Bp=this.dataset.length;if(Bp>0){for(var Bo=0;Bo<Bp;Bo++){var Br=this.dataset[Bo];Br[Bn]="";}}h(this);},addSelectedColumns:function AT(Bo,Br,Bq,Bx){var Bp=this,Bn,By,B0=[],Bw,Bu,Bv,Bt=Bp.tables[Bp.dbtables[Br-1]].existing;for(i=0;i<Bo.length;i++){Bw=Bo[i];Bv=Bw.dt;By={dt:Bv.tp,ps:Bv.ps,sc:Bv.sc,clix:Bw.rIndex+1,tblIdx:Br};if(Bq!=null){By.findex=Bq;Bu=[AR[Bq],"(",Bw.oriexpr,")"].join("");}else{Bu=Bw.expr[0].oi.n;}if(Bt){Bn=this.getMissingColumnID(Bu);if(Bn){By.cmid=Bn;}}B0.push(By);}var Bz=JSON.stringify(B0);var Bs={success:function(B3){Bp.isDirty=true;mstrApp.msgid=B3.msgid;for(var B2=0,B1=Bo.length;B2<B1;B2++){Bp.addColumnIndex(Bo[B2],Bq,null,!Bt,B0[B2].cmid,true);}mstrApp.getRootController().toggleDataPreview(true);h(Bp);if(Bx&&Bx.success){Bx.success(Bw);}}};mstrApp.getRootController().getDataService().addSelectedColumns(Bs,{tbid:Bp.tableID||"",colArray:Bz});},addColumnWithExpression:function Ba(Bq,Bu,Bv,Bt){var Bs=this,Br=Bq.dt,Bp={dt:Br.tp,ps:Br.ps,sc:Br.sc,tbid:Bs.tableID||"",exp:Bu||""},Bo=Bs.tables[Bq.srcID].existing;if(Bo){var Bn=this.getMissingColumnID(expr);if(Bn){Bp.cmid=Bn;}}mstrApp.getRootController().getDataService().addColumn({success:function(Bw){Bs.isDirty=true;mstrApp.msgid=Bw.msgid;Bw.cIndex=Bs.addColumnIndex(Bq,null,Bu,!Bo,Bn);mstrApp.getRootController().updateTableViewWithExpression(Bw.cIndex,Bv,true);if(Bt&&Bt.success){Bt.success();}}},Bp);},removeSelectedColumn:function(Bn,Bs){var Bq=this,Bp=Bq.mappings,Bo=Bq.selectedClns[Bn].ix,Br;if(this.isRefined&&!mstrApp.isFFSQLMode){Br=typeof Bo!=="undefined"?Bo+1:Bn+1;}else{Br=Bp[Bn].ix+1;}mstrApp.getRootController().getDataService().removeColumn({success:function(Bt){Bq.isDirty=true;mstrApp.msgid=Bt.msgid;Bq.removeExpression(Bn);if(Bs&&Bs.success){Bs.success();}}},{cindex:Br,tbid:Bq.tableID||""});},removeAllColumns:function AV(){var Bo=this,Br=Bo.mappings,Bn=Bo.selectedClns,Bp=Bn.length,Bq;mstrApp.getRootController().getDataService().removeColumn({success:function(Bs){Bo.isDirty=true;mstrApp.msgid=Bs.msgid;Z.forEach(Bo.selectedClns,function(Bt){Z.forEach(Bt.wid,function(Bu){Bq=mstrmojo.all[Bu];Bq.count--;Bq.updateState(0);});});Bo.selectedClns=[];Bo.mappings=[];Bo.dataset=[];h(Bo);}},{count:Bp,tbid:Bo.tableID||""});},editColumnExpression:function Ah(Bn,Bs,Bq,Bp){var Bo=this,Br={cindex:Bo.mappings[Bn].ix+1,exp:Bs||"",tbid:Bo.tableID||""};mstrApp.getRootController().getDataService().editColumn({success:function(Bt){Bo.isDirty=true;mstrApp.msgid=Bt.msgid;mstrApp.getRootController().updateTableViewWithExpression(Bn,Bq);if(Bp&&Bp.success){Bp.success();}}},Br);},editExpr:function(Bn){var Bo=this.selectedClns[Bn-1];this.exprEditor(Bo,3,null,Bn);},getColDataType:function Ag(Bn){return parseInt(Bn.dt.tp,10);},addJoinColInfo:function BA(Bo,Bn){G(this.joinCols,Bo,Bn);},autoJoin:function BS(){var B2=this.dbtables.length,B0,B3,B1,Bu=this.tables,Bx,Bs,Bv,B4,Bp,By,Bo,Bt,Bq,Bn={},Bz,Bw,Br;B0=this.dbtables[B2-1];B1=Bu[B0];B4=B1.rows;for(B3 in Bu){if(B3===B0){continue;}Bx=Bu[B3].rows;Br=B0+B3;for(Bp in B4){Bt=B4[Bp];By=Bt.srcData;Bo=this.getColDataType(By);if(Bo===AO.columnDataTypes.integer||Bo===AO.columnDataTypes.unsigned||Bo===AO.columnDataTypes.int64||Bo==="INTEGER"){for(Bs in Bx){Bq=Bx[Bs];Bv=Bq.srcData;if(By.cln===Bv.cln&&Bo===this.getColDataType(Bv)&&!BE(this.joinCols,Bp,Bs)){Bw=this.brackets(Bt.oriexpr)+"="+this.brackets(Bq.oriexpr);if(Bn[Br]){Bn[Br].jexp=Bn[Br].jexp+" AND "+Bw;}else{Bn[Br]={jexp:Bw,links:[]};}Bz={srcw:Bt,tgtw:Bq,jtype:0,jexp:Bw};Bn[Br].links.push(Bz);G(this.joinCols,Bt.id,Bq.id);break;}}}}}if(!V.isEmpty(Bn)){this.addJoins(Bn);}},addJoin:function U(Bp,Bn,Bo,Bu,Br){var Bq,Bs,Bt={};Bq=Bp.srcID+Bn.srcID;Bs={srcw:Bp,tgtw:Bn,jtype:Bo,jexp:this.brackets(Bp.oriexpr)+"="+this.brackets(Bn.oriexpr)};Bt[Bq]={links:[Bs],jexp:Bs.jexp};G(this.joinCols,Bp.id,Bn.id);this.addJoins(Bt,Br);},addJoins:function o(Bs,Bv){var Br=this,Bt,Bp,Bx,Bq,Bw,Bo,Bu,Bn={success:function(By){Br.isDirty=true;mstrApp.msgid=By.msgid;for(Bq in Bs){Bw=Bs[Bq].jexp;Bx=Bs[Bq].links;Br.joinsInfo[Bq]={jt:0,exp:Bw,links:{},nlinks:Bx.length};for(i=0;i<Bx.length;i++){Bp=Bx[i];Bo=Bp.srcw;Bu=Bp.tgtw;Br.joinsInfo[Bq].links[Bo.id+Bu.id]={srcw:Bo,tgtw:Bu,coords:[],exp:Bp.jexp,jid:Bq};Br.tables[Bo.srcID].njoins++;Br.tables[Bu.srcID].njoins++;}Br.joinsInfo[Bq].srctID=Bo.srcID;Br.joinsInfo[Bq].tgttID=Bu.srcID;Br.joins.push(Bq);}if(Bv&&Bv.success){Bv.success();}Br.raiseEvent({name:"JoinsAdded"});}};Bt=JSON.stringify(Bj(Bs,Br));mstrApp.getRootController().getDataService().addJoin(Bn,{joins:Bt,tbid:Br.tableID||""});},removeJoin:function(Bp,Br){var Bs=this;var Bq=Bs.joinsInfo[Bp],Bt=Bq.srctID,Bo=Bq.tgttID;var Bn={success:function(Bu){Bs.isDirty=true;mstrApp.msgid=Bu.msgid;Z.removeItem(Bs.joins,Bp);delete Bs.joinsInfo[Bp];Bs.tables[Bt].njoins--;Bs.tables[Bo].njoins--;if(Br&&Br.success){Br.success();}}};mstrApp.getRootController().getDataService().removeJoin(Bn,{jindex:Bs.getjIndex(Bp),tbid:Bs.tableID||""});},editJoin:function u(Bs){var Bu=this,Bq=Bs.linkID,Bn=Bs.joinID,Bv=Bs.exp||"",Bo=Bs.op,By=Bs.type,Bz=Bu.joinsInfo[Bn].links,Bw=Bu.getjIndex(Bn),Bp="",Br={jindex:Bw,jtype:By,tbid:Bu.tableID||""},Bt={success:function Bx(B0){mstrApp.msgid=B0.msgid;Bu.isDirty=true;Bu.joinsInfo[Bn].jt=By;if(Bv){Bz[Bq].op=Bo;Bz[Bq].exp=Bv;Bu.joinsInfo[Bn].exp=Bp;}Bu.raiseEvent({name:"joinChanged"});}};if(Bv){V.forEach(Bz,function(B1,B0){Bp+=(Bp?" AND ":"")+((B0!==Bq)?B1.exp:Bv);});Br.exp=Bp;}mstrApp.getRootController().getDataService().editJoin(Bt,Br);},renameTable:function BY(Bq,Bn,Bp){var Bo=this;mstrApp.getRootController().getDataService().editTable({success:function(Br){mstrApp.msgid=Br.msgid;delete Bo.tbns[Bn];Bo.tbns[Bp]=Bp;Bo.tables[Bq].tbn=Bp;V.forEach(Bo.conditions,function(Bs){A6(Bn,Bp,Bs);});Bo.raiseEvent({name:"TableNameChanged",value:Bp,tid:Bq});}},{tbid:Bo.tableID||"",tables:JSON.stringify([{alias:Bp,tindex:Bo.gettIndex(Bq)}])});},saveTableLayout:function BL(Bp){var Bo=[];for(var Bq in this.tables){var Bn=mstrmojo.all[Bq];if(Bn&&Bn.editorNode){Bo.push({tindex:this.gettIndex(Bq),t:parseInt(Bn.top,10)*BU,l:parseInt(Bn.left,10)*BU,w:Bn.editorNode.clientWidth*BU,h:Bn.editorNode.clientHeight*BU});}}mstrApp.getRootController().getDataService().editTable({success:function Br(Bs){mstrApp.msgid=Bs.msgid;if(Bp&&Bp.success){Bp.success();}}},{tbid:this.tableID||"",tables:JSON.stringify(Bo)});},loadReport:function A0(Bt,Bv,Bu,Br,Bs,Bn){var Bo=this;Bv=Bv||BP;var Bq={browsetype:Bt,bindingflag:Bv,suppressError:true,showWait:!Bn};if(Bu!=null){Bq.previewflag=Bu;}if(Br!=null){Bq.automap=Br;Bq.docid=mstrApp.docID||"";}Bq.tableID=Bo.tableID||"";var Bp={success:function(Bw){if(Bt&AE){if(Bw.btb){Bo.bindingT=Bw.btb.slice(0);}}if(Bs&&Bs.success){Bs.success(Bw);}}};mstrApp.getRootController().getDataService().getReportDefinition(Bp,Bq);},loadConnectLiveSupport:function q(){var Bo=this,Bn,Bq={browsetype:BD,bindingflag:0,previewflag:0,tableID:Bo.tableID||"",showWait:false};Bo.connectLiveSupport=undefined;Bn={success:function(Br){if(Br.prs&&Br.prs.dda!==undefined){Bo.connectLiveSupport=Br.prs.dda;}}};var Bp=mstrApp.getRootController().getDataService();typeof (Bp.getReportDefinition)==="function"&&Bp.getReportDefinition(Bn,Bq);},getcIndex:function Ay(Bn){return mstrmojo.array.indexOf(this.selectedClns,Bn)+1;},getRowWidget:function l(Bn,Br){var Bs=this.tables;Br=Br.toLowerCase();if(!Bn){for(var Bo in Bs){var Bq=Bs[Bo].rows;for(var Bp in Bq){if(Bq[Bp].text.toLowerCase()===Br){return mstrmojo.all[Bp];}}}}else{Bn=Bn.toLowerCase();for(var Bo in Bs){if(Bs[Bo].tbn.toLowerCase()===Bn){var Bq=Bs[Bo].rows;for(var Bp in Bq){if(Bq[Bp].text.toLowerCase()===Br){return mstrmojo.all[Bp];}}}}}},uptcIndex:function Ak(Bo,Bn){while(Bn>this.selectedClns.length){this.selectedClns.push("");}this.selectedClns[Bn]=Bo;},getjIndex:function Aa(Bn){return mstrmojo.array.indexOf(this.joins,Bn)+1;},gettIndex:function O(Bn){return mstrmojo.array.indexOf(this.dbtables,Bn)+1;},upttIndex:function Bl(Bp,Bn,Bo,Bv,Bu,Bs){var Bt=this.dbtables,Br=this.tables,Bq=function Bq(Bz,Bx,Bw,By){return{rows:{},njoins:0,tbn:Bz,ns:Bx,alias:"",dbtbn:Bw,did:By};};if(Bv){Br[Bo]=Bq(Bp,Bs,Bn,Bu);Bt.push(Bo);}else{delete Br[Bo];mstrmojo.array.removeItem(Bt,Bo);}},save:function(Bo,Bx,Bq,By,Bv,Bw,Bz){var Bt=this;var Bn={success:function(B2){var B1=B2.did;Bt.riid=B1;mstrApp.path=B2.path;mstrApp.reportID=B1;mstrApp.folderID=Bq;var B0={success:function(B3){if(Bz&&Bz.success){Bz.success({did:B1,path:mstrApp.path});}},failure:function(B8){var B7=Bt.dbtables,B5,B4=Bt.pos_hash;for(var B6=0,B3=B7.length;B6<B3;B6++){B5=mstrmojo.all[B7[B6]];if(B5&&B5.editorNode){B4[B5.title]={t:parseInt(B5.top,10),l:parseInt(B5.left,10),w:B5.editorNode.clientWidth,h:B5.editorNode.clientHeight};}if(B5){B5.set("visible",false);B5.set("opener",null);}delete mstrmojo.all[B7[B6]];}var CA=mstrmojo.all.CE,B9;if(CA&&(B9=CA.CEl)){B9.filterExpr.set("items",[]);B9.aggfilterExpr.set("items",[]);}Bt.createReportInstance();}};mstrApp.getRootController().getDataService().publishCube(B0,{reportid:B1});}};var Bp={success:function(){params={reportid:Bt.riid,folderID:Bq,isCube:Bt.isCubeReport,crb:Bt.refresh_opt,overwrite:!!By,autoName:!!Bv};if(Bo){params.name=Bo;}if(Bx){params.desc=Bx;}mstrApp.getRootController().getDataService().saveReport(Bn,params);}};var Br={success:function(){Bt.updateDerivedFlags(Bp);}};var Bs={success:function(){if(Bt.skipMissingCheck){Br.success();return ;}var B3=[],B2=Bt.getMissingMaps(B3);if(B2){var B1=B3.length>0,B0=mstrmojo.insert({scriptClass:"mstrmojo.qb.MissingColumnWarning",hasPT:B1,mappings:B1?B3:B2,isCube:Bt.isCubeReport,onOK:function(){Br.success();return true;}});B0.open();}else{Br.success();}}};var Bu={success:function(){if(Bt.isDirty){Bt.autoMap(Bs);}else{Bs.success();}}};if(!Bt.FFSQLMode){Bt.saveTableLayout(Bu);}else{Bt.editFFSQL(Bu,Bw);}},populatePreview:function BK(Bo,Bn){this.populateMappings(Bo);this.populateDataset(Bn);},populateMappings:function j(Bu){var Bv=Bu.amps,B2=Bu.mtmps,Bt=!mstrApp.isCloudPro&&(mstrApp.saveAsCube==2)&&(!this.isNew),B5=[];var B6=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var Bx,Bw,Bq,Bn,B7,By=0,Br,Bo,B4,B1,Bs=function(B8){var B9=0;Z.forEach(B8,function(CA){if(!(CA.sqc.der&2147483648)){B9++;}});return B9;};for(var Bz=0,B0=Bv.length;Bz<B0;Bz++){Bw=Bv[Bz];Bq=Bw.aimp;Bo=Bq.ipa;Bn=Bw.afmps;By+=Bn.length;B1=Bs(Bn);for(Bx=0,aflen=Bn.length;Bx<aflen;Bx++){B7=Bn[Bx].sqc;Br=mstrmojo.array.find(B6,"did",B7.id);B4=(B7.der&2147483648)?true:false;B5.push({did:B7.id,alias:AJ(Bq.atnm),n:AJ(Bw.afmps[Bx].cln),selected:(B7.se==1),hasMapped:true,isReadOnly:Bt,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Bn[Bx].bft,colo:Bn[Bx].colo-1,ix:B7.ix,tp:12,ipa:Bo,georole:(Br>=0)?B6[Br].georole:B7.geo,der:(Br>=0)?B6[Br].der:B7.der,oid:Bq.atid,fmid:Bn[Bx].fmid,afid:Bq.atid+Bn[Bx].fmid,fmn:AJ(Bn[Bx].fmn),shapeKey:AJ((Br>=0)?B6[Br].shapeKey:Bn[Bx].sha),toDel:(B7.ups&4)?true:false,isDerived:B4,multiForms:B1>1,isIDForm:Bx===0});}}for(var Bz=0,B0=B2.length;Bz<B0;Bz++){var Bp=B2[Bz],B7=Bp.sqc;B5.push({did:B7.id,alias:AJ(Bp.mtn),n:AJ(Bp.cln),selected:(B7.se==1),isReadOnly:Bt,hasMapped:true,isDI:this.isDI,isQB:!(this.FFSQLMode),dtp:Am[B7.dt.tp],colo:Bp.colo-1,ix:B7.ix,tp:4,oid:Bp.mtid,georole:B7.geo,der:B7.der,toDel:(B7.ups&4)?true:false});}Z.forEach(Bu.cmps,function(B8){B7=B8.sqc;B5.push({did:B7.id,alias:AJ(B7.exp.exp),n:AJ(B7.exp.exp),selected:false,hasMapped:false,isQB:!this.FFSQLMode,expr:B7.exp.exp,dtp:Am[B7.dt.tp],colo:B8.colo-1,ix:B7.ix,tp:0});});var B3;B5.sort(function(B9,B8){return(B9.ix<B8.ix)?-1:1;});for(var Bz=0,B0=B5.length;Bz<B0;Bz++){B3=B5[Bz];if(B3.toDel){this.selectedClns&&this.selectedClns[Bz]&&(this.selectedClns[Bz].missing=true);}else{if(B3.isDerived){this.selectedClns&&this.selectedClns[Bz]&&(this.selectedClns[Bz].isDerived=true);}else{this.mappings.push(B3);this.cloneMappings.push(V.copy(B3));}}}},populateDataset:function BO(Bn){var Bo;if(!(Bn instanceof Array)){Bn=Bn.dcs;if(!Bn||!Bn.length){this.dataset=[];return ;}}Bo=[];Z.forEach(Bn,function(Bp){Z.forEach(Bp.dvs,function(Br,Bq){Br=(Br===null)?"":BV.encodeData(Br);Bo[Bq]=Bo[Bq]||[];Bo[Bq].push(Br);});});this.dataset=Bo;},populateFFSQLMapping:function a(Bv){var Bw=Bv.amps,B3=Bv.mtmps;var Bo={};var B8=this.mappings.slice(0);this.mappings=[];this.cloneMappings=[];var By,Bx,Br,B6,Bz=0,B4,Bn,B5,Bp,B7,B2,Bt=function Bt(B9){var CA=0;Z.forEach(B9,function(CB){if(!(CB.col.oi.def.dicl.der&2147483648)){CA++;}});return CA;};for(var B0=0,B1=Bw.length;B0<B1;B0++){Bx=Bw[B0];Br=Bx.aimp;Bp=Br.ipa;Bn=Bx.afmps;B2=Bt(Bn);for(By=0,B4=Bn.length;By<B4;By++){B6=Bn[By].col.oi;pos=mstrmojo.array.find(B8,"did",B6.did);if(B6.def.dicl.ups&4){break;}B7=(B6.def.dicl.der&2147483648)?true:false;Bz++;B5={did:B6.did,alias:AJ(Br.atnm),n:BV.encodeData(B6.def.cln),selected:true,hasMapped:true,dtp:Bn[By].bft,georole:(pos>=0)?B8[pos].georole:B6.def.dicl.geo,shapeKey:AJ((pos>=0)?B8[pos].shapeKey:Bn[By].sha),oid:Br.atid,fmid:Bn[By].fmid,afid:Br.atid+Bn[By].fmid,fmn:AJ(Bn[By].fmn),ipa:Bp,colo:Bn[By].colo-1,ix:B6.def.dicl.clix-1,tp:12,der:(pos>=0)?B8[pos].der:B6.def.dicl.der,isDerived:B7,multiForms:B2>1,isIDform:By===0};Bo[B5.ix]=B5;}}var Bu=Bw.length;for(var B0=0,B1=B3.length;B0<B1;B0++){var Bq=B3[B0],B6=Bq.col.oi;if(B6.def.dicl.ups&4){continue;}Bz++;var B5={did:B6.did,alias:AJ(Bq.mtn),n:AJ(B6.def.cln),selected:true,hasMapped:true,dtp:Am[B6.def.dt.tp],colo:Bq.colo-1,ix:B6.def.dicl.clix-1,oid:Bq.mtid,tp:4,georole:B6.def.dicl.geo,der:B6.def.dicl.der};Bo[B5.ix]=B5;}var B5;var Bs=[];V.forEach(Bo,function(CA,B9){Bs.push(parseInt(B9,10));});Bs.sort(function(CA,B9){return CA-B9;});for(var B0=0;B0<Bs.length;B0++){B5=Bo[Bs[B0]];if(B5&&!B5.isDerived){this.mappings.push(B5);this.cloneMappings.push(V.copy(B5));}}},populateFFSQLSrcTblClnInfo:function(){var Bo=this.bindingT||[],Bq,Br,Bp,Bn=[];Z.forEach(Bo,function(Bs){if(V.walk("oi.tp",Bs)===Ae.DbTable){Br=Bs.oi;return false;}});Bp=V.walk("def.cs.cs",Br);Z.forEach(Bp,function(Bs){Z.forEach(Bo,function(Bt){if(V.walk("oi.did",Bt)===Bs.did&&V.walk("oi.tp",Bt)===Bs.tp){Bn.push(V.walk("oi.def",Bt));}});});Bn=Z.filter(Bn,function(Bs){return typeof Bs!=="undefined";});this.set("sourceTableColumns",Bn);return Bn;},updateDerivedFlags:function(Bq){var Bt=this.mappings;var Bo=[],Br;for(var Bp=0,Bn=Bt.length;Bp<Bn;Bp++){if(Bt[Bp].hasMapped){Bo.push({did:Bt[Bp].did,georole:Bt[Bp].georole,shapekey:Bt[Bp].shapeKey,drvflgs:Bt[Bp].der});}}if(Bo.length===0){Bq&&Bq.success&&Bq.success();}else{mstrApp.getRootController().getDataService().remapObject({success:function Bs(Bu){if(Bq&&Bq.success){Bq.success(Bu);}}},{mpcs:JSON.stringify(Bo),docid:mstrApp.docID||"",utm:1});}},getMissingMaps:function(B9){if(!this.orimaps){return null;}var By=[],B4,B3,B5,B6;var B7=this.orimaps;var Bq=this.mappings;var Bw=B7.amps,Bx=B7.mtmps;B7={};var Bs,B2,Bo,Bz,B8,Bu,B0,Bv=mstrApp.isFFSQL;for(B4=0,B5=Bw.length;B4<B5;B4++){B6=Bw[B4].aimp;Bs=B6.atid;B2=AJ(B6.atnm);B6=Bw[B4].afmps;for(B3=0;B3<B6.length;B3++){if(Bv){Bz=B6[B3].col.oi.def;if(Bz.dicl.der&2147483648){break;}Bu=Bz.cln;B0=B6[B3].col.oi.did;}else{B8=B6[B3].sqc;if(B8.der&2147483648){break;}Bu=B8.exp.exp;B0=B8.id;}B7[Bs]=B7[Bs]||{n:B2,oid:Bs,tp:12,fms:[]};B7[Bs].fms.push({fmid:B6[B3].fmid,fnm:AJ(B6[B3].fmn),exp:AJ(Bu),cmid:B0});}}for(B4=0,B5=Bx.length;B4<B5;B4++){if(Bv){Bu=Bx[B4].col.oi.def.cln;B0=Bx[B4].col.oi.did;}else{B8=Bx[B4].sqc;Bu=B8.exp.exp;B0=B8.id;}B7[Bx[B4].mtid]={oid:Bx[B4].mtid,n:AJ(Bx[B4].mtn),tp:4,exp:AJ(Bu),cmid:B0};}var B1=mstrmojo.hash.copy((this.pattrs||{}));var B5=Bq.length,Bn,Bp,Br,Bt;for(B4=0;B4<B5;B4++){Bn=Bq[B4].oid;Bp=B7[Bn];if(Bp&&Bp.tp==Bq[B4].tp){Br=Bp.fms;if(Br){Bt=Z.find(Br,"fmid",Bq[B4].fmid);if(Bt>-1){Z.removeIndices(Br,Bt,1);}}else{delete B7[Bn];}}if(B1[Bn]&&B1[Bn].tp==Bq[B4].tp){delete B1[Bn];}}if(B9){for(Bn in B1){B6=B1[Bn];B9.push(B6);}}for(Bn in B7){B6=B7[Bn];if(B6.tp===12){if(B6.fms.length){By.push(B6);}}else{By.push(B6);}}return((By.length>0)?By:null);},getMissingColumnID:function(Br){var Bo=this,Bn=Bo.getMissingMaps();if(!Bn){return null;}var Bq=null,Bs,Bp=Bo.mappings;Z.forEach(Bn,function(Bt){Bs=(Bt.tp===4)?[Bt]:Bt.fms;Z.forEach(Bs,function(Bu){if(Z.find(Bp,"did",Bu.cmid)===-1&&Bo.isEquivalentExpr(Bu.exp,Br)){Bq=Bu.cmid;return false;}});if(Bq){return false;}});if(Bq){Z.forEach(Bo.selectedClns,function(Bt){if(Bt.cmid===Bq&&!Bt.missing){Bq=null;return false;}});}return Bq;},getMissingTableID:function(Bn,Bp,Bs){var Bu=this.orits;if(!Bu){return null;}var Bt=this.dbtables,Br=this.tables,Bv;for(var Bo=0,Bq=Bt.length;Bo<Bq;Bo++){Bv=Br[Bt[Bo]];if(Bv.existing&&Bv.missing&&Bv.tbn===Bp&&Bv.dbtbn===Bn&&Bv.ns===Bs){return(!Bv.did?null:Bv.did);}}return null;},getTablesCount:function(){var Bq=this.tables,Br=this.dbtables,Bp=0;for(var Bo=0,Bn=Br.length;Bo<Bn;Bo++){!Bq[Br[Bo]].missing&&(Bp++);}return Bp;},getColumnsCount:function(){var Bo=this.selectedClns,Bq=0;for(var Bp=0,Bn=Bo.length;Bp<Bn;Bp++){!Bo[Bp].missing&&(Bq++);}return Bq;},addColumnIndex:function(B0,Br,Bx,Bn,Bp,Bv){var Bu=this.selectedClns,By=this.gettIndex(B0.parent.parent.id),Bq,Bw,Bz,Bt=Bu.length,Bs,Bo;if(!!Bx){Bq=Bx;}else{if(Br){Bq=AR[Br]+"("+(B0.oriexpr)+")";}else{Bq=this.brackets(B0.oriexpr);}}if(!Bn){for(Bs=0;Bs<Bt;Bs++){Bo=Bu[Bs];if(Bo.missing&&Bo.expr&&this.isEquivalentExpr(Bo.expr[0].v,Bq)){Bo.missing=false;Bo.wid=[B0.id];Bo.cmid=Bp;Bz=true;break;}}Bw=Bs;}else{Bw=Bt;}if(!Bz){if(Br){if(Br===6){Bu.push({wid:[B0.id],expr:[{isNew:true,v:"Count",oi:{t:"11",n:"Count"}},{isNew:true,v:"<Distinct=true>",oi:{t:"11",n:"<Distinct=true>"}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(B0.oriexpr),oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}else{Bu.push({wid:[B0.id],expr:[{isNew:true,v:AR[Br],oi:{t:"11",n:AR[Br]}},{isNew:true,v:"(",isDelimiter:true},{isNew:true,v:this.brackets(B0.oriexpr),oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}},{isNew:true,v:")",isDelimiter:true}]});}}else{Bu.push({wid:[B0.id],expr:[{isNew:true,v:Bq,oi:{tIndex:By,rIndex:B0.rIndex,t:"26",n:B0.oriexpr}}]});}}this.addExpression(Bw,Bv);return Bw;},compareDBTables:function(Bp){var Bo=this;if(Bo.dbtables.length===0){return ;}var Bn={success:function(Bt){var Bq=Bt.btb,Br=[],Bv,Bu;Z.forEach(Bq,function(Bw){Bv=Bw.oi;Bu=Bv.def;(Bv.tp===53&&Bu.xt===1)&&Br.push({tbid:Bv.did,tbn:AJ(Bu.tbn),ns:AJ(Bu.ns)});});if(Br.length==0){return ;}Bo.whts=Br;mstrApp.getRootController().getDataService().catalogAction({success:function Bs(Bw){var Bx=Bw.xrc.cas[0];Bo.whdef=Bx.tis?Bx.tis:[Bx];Bp&&Bp.success&&Bp.success();}},{dbrid:Bo.SelDBRoleID,flags:1073741824|2|524288,mid:mstrApp.msgid,dbts:JSON.stringify(Br),showWait:true});}};Bo.loadReport(AE+Be,BP,c,null,Bn);},updateDBTables:function(Bx){var Bp=this,Bz,Bt,Bo=[],Bq,Bn,Bv,Bu,Bs,Bw,By;for(Bu=0,Bw=Bp.whdef.length;Bu<Bw;Bu++){Bz=Bp.whdef[Bu];if(Bz.sta!=0){Bq={ns:Bz.ns,sta:Bz.sta,tbid:Bz.tbid,tbn:AJ(Bz.tbn),clis:[]};Bv=Bq.clis;Bn=Bz.clis;for(Bs=0;Bs<Bn.length;Bs++){By=Bn[Bs];Bv.push({cln:AJ(By.cln),cmid:By.cmid,sta:By.sta,prec:By.dt.prec,scl:By.dt.scl,tp:By.dt.tp});}Bo.push(Bq);}}if(Bo.length==0){return ;}var Br={success:function(B1){mstrApp.msgid=B1.msgid;var B0={success:function(B5){var CA=Bp.dbtables,B9,B4=Bp.pos_hash,B8,CB=[];for(var B2=0,B3=CA.length;B2<B3;B2++){B9=mstrmojo.all[CA[B2]];if(B9&&B9.editorNode){B4[B9.title]={t:parseInt(B9.top,10),l:parseInt(B9.left,10),w:B9.editorNode.clientWidth,h:B9.editorNode.clientHeight};}B9.set("visible",false);B9.set("opener",null);delete mstrmojo.all[CA[B2]];}var B7=mstrmojo.all.CE,B6;if(B7&&(B6=B7.CEl)){B6.filterExpr.set("items",[]);B6.aggfilterExpr.set("items",[]);}Bp.isDirty=true;if(Bp.loadDefinition){B8=Bp.firstTimeLoading;Bp.loadDefinition(B5);if(!B8){h(Bp);}}else{Au(B5,Bp);}if(Bo.length>0){Z.forEach(Bo,function(CC){if(CC.sta=="4"){CB.push("<li>"+P.htmlAngles(CC.tbn)+"</li>");}});if(CB.length>0){CB.unshift('<ul style="padding-left: 16px; max-height: 80px; overflow: auto;">');CB.push("</ul>");mstrmojo.error({shortDesc:"<strong>"+mstrmojo.desc(16115,"The following tables are not found from the database. They have been removed from the canvas. Please add new tables as you need.")+"</strong>"+CB.join("")},mstrmojo.emptyFn,{title:mstrmojo.desc(12537,"Data Import")});}}}};Bp.loadReport(AE+Be,BP,c,null,B0);}};mstrApp.getRootController().getDataService().updateTableStructure(Br,{tables:JSON.stringify(Bo),tbid:Bp.tableID||""});},isColumnUsed:function(Bv,Bt){var Bp=Bv.tbn,Bo=Bt.cln,Bq,Br,Bw;var Bs=this.tables;for(var Bn in Bs){if(Bs[Bn].dbtbn===Bp){Bw=Bs[Bn].rows;for(var Bu in Bw){if((Bw[Bu].text===Bo)&&(Bw[Bu].state!=0)){return true;}}}}return false;},hasMissingUsedDBColumns:function(){var Bq=this.whdef,Bu,Bt,Bs,Bn,Bp,Bo,Br;for(Bt=0,Bn=Bq.length;Bt<Bn;Bt++){Bu=Bq[Bt];switch(parseInt(Bu.sta,10)){case 0:case 64:break;default:Br=Bu.clis;for(Bs=0,Bp=Br.length;Bs<Bp;Bs++){Bo=Br[Bs];if(parseInt(Bo.sta,10)===4){if(this.isColumnUsed(Bu,Bo)){return true;}}}break;}if(Bu.sta==4){Br=Bu.clis;for(Bs=0,Bp=Br.length;Bs<Bp;Bs++){Bo=Br[Bs];if(this.isColumnUsed(Bu,Bo)){return true;}}}}return false;},getShapeKeys:function(){var Bo=this;var Bn={success:function(Bs){if(Bs&&Bs.ShapeFileMaps&&Bs.ShapeFileMaps.ShapeFileMap){var Bt=Bs.ShapeFileMaps.ShapeFileMap,Bq=[],Bu,Br,Bp=function Bp(Bx,Bw){var Bv=Bx.n.toLowerCase();var By=Bw.n.toLowerCase();if(Bv<By){return -1;}else{if(Bv>By){return 1;}else{return 0;}}};Z.forEach(Bt,function(Bv){Bu=Bv.descWeb;Br=Bu?mstrmojo.desc(Bu.slice(8)):AJ(Bv.name);Bq.push({did:Bv.shapeKey,n:Br});});Bq.sort(Bp);Bo.shapeKeys=Bq;}}};mstrApp.getRootController().getDataService().getShapeKeys(Bn,{});},createEmmaTable:function A9(){var Br=mstrApp.getRootController().getDataService(),Bp=this,Bo=mstrApp.isFFSQL,Bn=(Bo?304:352),Bs=function Bs(Bt){Br.createEmmaTable({success:function Bu(Bv){Bp.tableID=Bv.tbid;mstrApp.msgid=Bv.msgid;}},{xt:Bt});};mstrApp.msgid=mstrApp.msgID;if(mstrApp.msgid){Bs(Bn);}else{Br.createEmmaInstance({success:function Bq(Bt){mstrApp.msgid=Bt.msgid;Bs(Bn);}});}if(mstrApp.isFFSQL){Bp.set("isFFSQL",true);Bp.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},createReportInstance:function BZ(){var Bq=this,Bp=mstrApp.isCloudPro;Bq.msgid=mstrApp.msgid;Bq.riid=mstrApp.reportID||A8;Bq.supportTimeGeo=true;Bq.analysisID=mstrApp.analysisID;Bq.isNew=(Bq.riid==A8);Bq.alertTitle=Bp?"Oops!":null;if(mstrApp.isEMMACube){this.createEmmaTable();return ;}var Bo={success:function Bn(Br){Bq.msgid=Br.msgid;mstrApp.msgid=Br.msgid;if(Bq.riid!==A8){Bq.firstTimeLoading=true;var Bs={success:function Bt(Bv){var Bu;if(Bv&&(Bu=Bv.items)&&Bu.length){Bq.pattrs={};Z.forEach(Bu,function(Bw){Bw.ismapped&&(Bq.pattrs[Bw.did]={n:Bw.n,tp:12});});}Bq.loadReport(AE+Be,BP,c,null,{success:function(Bw){Au(Bw,Bq);if(Bp){mstrApp.getRootController().getDataService().autoClosePrompt({success:function Bx(By){mstrApp.msgid=By.msgid;}});}}});}};if(Bp&&mstrApp.analysisID&&mstrApp.saveAsCube!=2){mstrApp.getRootController().getDataService().getDocumentAttributes(Bs,{objectID:mstrApp.analysisID});}else{Bs.success();}}else{Bq.skipMissingCheck=true;if(mstrApp.isFFSQL){Bq.set("isFFSQL",true);Bq.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;Bq.convertToFFSQL("",null,true);}}Bq.set("isCloud",Bp);Bq.set("isCubeReport",mstrApp.saveAsCube!=2);}};mstrApp.getRootController().getDataService().createReportInstance(Bo,{reportid:Bq.riid});if(!mstrApp.isCloudPro){Bq.getShapeKeys();}Bq.getFunctions();},getAllowSave:function x(Bp){var Bo,Bn=mstrApp.isFFSQLMode;if(Bn&&Bp===undefined){Bp=mstrApp.getRootController().rootView.getSQLStatement();}if(this.isNew){Bo=Bn?(!!P.trim(Bp)):(this.dbtables.length>0&&this.selectedClns.length>0);Bo=Bo&&(!!this.SelDBRoleID);}else{Bo=Bn?(!!P.trim(Bp)):true;}Bo=Bo&&this.getAvailableTablesEnabled();return Bo;},getAutoReportName:function Az(){var Bn=this.tbns,Bo=[];V.forEach(Bn,function(Bq,Bp){Bo.push(Bp);});Bo=Bo.join("_");if(Bo==""){Bo="FFSQL";}return Bo.substring(0,252);},getFunctions:function At(Bq,Bp,Bo){var Bn=this;if(!this.functions){mstrApp.getRootController().getDataService().getSystemFunctions({success:function(Br){Bn.functions=D(Br.fncs,Bq);if(Bp&&Bp.success){Bp.success();}}},V.copy(Bo,{includeFunctionDetails:false,functionFlags:2}));}},getFunctionList:function Bb(){return this.functions;},getSuggestionItems:function AG(Bp){var Bn=[],Bq;if(Bp){var Bo=this.dbtbls[this.SelDBRoleID];V.forEach(Bo,function(Br,Bs){Bn.push({n:Bs,sta:2,t:15});});}else{V.forEach(this.tables,function(Br){V.forEach(Br.rows,function(Bs){Bq=Bs.oriexpr;Bn.push({n:Bq,cmid:Bs.srcData.id,rIndex:Bs.rIndex+1,t:26,display:['<span class="mstrmojo-qb-ListIconBlock t26 "></span><span>',Bq,"</span>"].join("")});});});}Z.forEach(this.functions,function(Br){Z.forEach(Br.fns,function(Bs){Bn.push(Bs);});});if(Bp){this.FFsqlComp=Bn;}return Bn;},getConditions:function AN(){return this.conditions;},setCondition:function AD(Bo,Br,Bp){var Bn=this;mstrApp.getRootController().getDataService().editCondition({success:function Bq(Bs){mstrApp.msgid=Bs.msgid;Bn.isDirty=true;if(Bp&&Bp.success){Bp.success(Bs);}}},{tbid:Bn.tableID||"",clause:Bo?"where":"having",exp:Br});},updateConditions:function e(Br,Bt){var Bo=this,Bs=this.conditions,Bq={success:function Bp(Bv){Bs.having=Bt;Bo.updateFilterLabel(Bs);}},Bn=function Bn(Bv){Bs.where=Br;if(Bt){Bo.setCondition(false,Ao(Bt),Bq);}else{if(Bs.having){Bo.setCondition(false,"",Bq);}else{Bq.success();}}},Bu={success:Bn};if(Br){this.setCondition(true,Ao(Br),Bu);}else{if(Bs.where){this.setCondition(true,"",Bu);}else{Bn();}}},appendCondition:function A2(Bo){var Bp=this.conditions,Bn=Bo.sqltp===0;condition=Bn?Bp.where:Bp.having;if(!condition){condition=Bo;}else{if(condition.nds){condition.nds.push(Bo);}else{condition={et:BG.ANDOR,fn:X.FN.AND,nds:[V.copy(condition),Bo]};}}Bp[Bn?"where":"having"]=condition;this.setCondition(Bn,Ao(condition),null);this.updateFilterLabel(Bp);},canAddTableSQL:function N(Br,Bq){var Bp=this,Bo=Bp.SelDBRoleID,Bn;dbridForDDA=this.dbridForDDA;if(Bp.isDDA&&dbridForDDA&&Bo!==dbridForDDA){Bn={name:"directDataAccessTableError"};}if(Bn){if(!Br){this.raiseEvent(Bn);}return false;}return true;},addTableSQL:function A1(Bo,Bn){k.call(this,Bo.ns,Bo.n,Bn);this.prevDBRoleID=this.SelDBRoleID;},updateFilterLabel:function AX(Bt){var Bq={},Bs=this,Bu=Bs.tables,Bp,Bv,Br,Bo,Bn;V.forEach(Bt,function(Bw){I.call(Bs,Bq,Bw);});V.forEach(Bu,function(Bw){Bv=Bw.rows;Bp=Bw.tbn.toLowerCase();Bo=Bq[Bp];V.forEach(Bv,function(Bx){Bn=Bx.state;Bn=(Bo&&Bo[Bx.text.toLowerCase()])?(Bn|2):(Bn&(~2));if(Bx.state!==Bn){Bx.state=Bn;Bx.images[1]=Bx.img[Bn];Bx.render();}});});},submitRequest:function Af(Bp,Bo,Bn){AQ(Bp,Bo,Bn);},onisDDAChange:function AZ(Bn){var Bo=this;mstrApp.getRootController().getDDAController().checkDDACheckbox(Bn.value);Bo.raiseEvent({name:A7.DBTABLES_ENABLED,value:Bo.getAvailableTablesEnabled()});mstrApp.getRootController().enableButton();}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb._hasQBModel");mstrmojo.qb.QBuilderModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.QBuilderModel"});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.qb._hasQBModel","mstrmojo.warehouse.WHModel","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.XMLParser","mstrmojo.warehouse.EnumDataChangeEvents");mstrmojo.requiresDescs(14098,9945,9946);var K=mstrmojo.warehouse.EnumDataChangeEvents,f=mstrmojo.string.decodeHtmlString,P=mstrmojo.hash,g=mstrmojo.array,Y=mstrmojo.DI.DIConstants,D=mstrmojo.warehouse.EnumObjectTypes,J=4000,U=15,R=200,L=200,n=0,e=0,l=mstrmojo.desc(14098,"There is no project ## in ###.");var H=mstrmojo.desc;function b(o){return o.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function V(o){return f(o).replace(/&apos;/g,"'");}function W(o){o.raiseEvent({name:"dataPreview",mappings:o.FFSQLMode?o.sourceTableColumns:o.mappings,dataset:o.dataset,selectedColumns:o.selectedClns,isRefined:o.isRefined});}function m(q){var z=q.datap,t=z.maps,p=z.srce,AA=p.csl,w=mstrApp.getRootController(),u=this,o=p.gbqp,x;if(this.firstTimeLoading){this.orimaps=t;}u.usingCookieNamespace=true;if(p.xt===304){u.prevDBRoleID=p.dbrid;x=w.selectDBRole(p.dbrid);}else{if(u.getProject(o)===null){mstrmojo.alert(l.replace("##",o).replace("###",mstrApp.userEmail));}}if(!u.isBigQuery&&!x){u.fetchAndAppendSingleDBR(p.dbrid);}AA=b(AA);this.SQLstmt=AA;mstrApp.getRootController().raiseEvent({name:"reportModeChange",mode:2,value:AA,keepFormat:true});this.populateFFSQLMapping(t);if(this.firstTimeLoading){W(this);this.firstTimeLoading=false;}}function X(o,p){var q=o.chn;if(!q){if(o.col&&o.stbid){p.push({cid:o.col,tid:o.stbid});}return p;}g.forEach(q,function(t){p=X(t,p);});return p;}function F(o){return o.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function d(p){var o={">=":2,"<>":5,"<=":4,"<":3,">":1},q;for(q in o){if(p.indexOf(q)>-1){return o[q];}}return 0;}function E(o,p){var q=[],t;g.forEach(p,function(u){t=o.uiids[u.tid+u.cid];if(t){q.push(t);}});return q;}function I(t,w,o){if(!w.ftype){o.push({lcid:t.chn[0].col,rcid:t.chn[1].col,exp:w.exp});return w.exp;}var u,q,p;switch(w.ftype){case 19:case 20:u=I(t.chn[0],w.children[0],o);q=I(t.chn[1],w.children[1],o);p=u+((w.ftype===19)?" AND ":" OR ")+q;break;case 21:p=" NOT "+I(t.chn[0],w.children[0],o);break;default:break;}return p;}function G(u,q,w,o,AB,z){if(!q.ftype){var p=F(q.exp);if(p.indexOf("? aptqbr_prompt")>-1){z.push({n:p,cid:o.chn[0].cmid});return ;}var AC=E(u,X(o,[])),x,AA=[];g.forEach(AC,function(AD){x=mstrmojo.all[AD];if(x&&x.updateState){x.updateState(2);}AA.push({t:x.srcTable,col:x.text});});return w.push({et:"*",n:p,expr:[{v:p}],sqltp:AB,cols:AA});}switch(q.ftype){case 19:case 20:case 21:var t=[];g.forEach(q.children,function(AE,AD){G(u,AE,t,o.chn[AD],AB,z);});if(!t.length){return ;}if(t.length<q.children.length&&t.length===1){w.push(t[0]);}else{w.push({et:14,fn:q.ftype,nds:t,not:(q.ftype===21),sqltp:AB});}break;default:break;}}function O(At){var AN=At.datap||[],Ak=AN.maps,u=this,AQ,AK,As=mstrApp.getRootController();if(u.firstTimeLoading){u.orimaps=Ak;}var AS,AP,Au={},q={},Al,p=true,Aa={53:function AL(Ax){if(Ax.ext_type===352||Ax.ext_type===341){AS=Ax.def.sqs.c_c[0];AP=Ax.def.dbr.did;AQ=Ax.ext_type;AK=Ax.def.sqs.big;}else{Au[Ax.did]={cs:Ax.def.cs.cs,tbn:V(Ax.n),did:Ax.did,ns:Ax.def.ns};if(Al===undefined){Al=Ax.def.ns;}p=p&&(Al===Ax.def.ns);if(Ax.ext_type===288){Au[Ax.did].alias=V(Ax.n);}}},26:function An(Ax){q[Ax.did]={did:Ax.did,cln:V(Ax.def.cln),dt:Ax.def.dt};}};g.forEach(At.btb,function(Ax){Ax=Ax.oi;if(Aa[Ax.tp]){Aa[Ax.tp](Ax);}});u.usingCookieNamespace=true;if(AQ===341){As.selectDBRole(AK);if(u.getProject(AK)===null){mstrmojo.alert(l.replace("##",AK).replace("###",mstrApp.userEmail));}}else{As.selectDBRole(AP);}u.prevDBRoleID=AP;if(!AS){return ;}var Ab=AS.sqcs.c_c,AF=AS.whe,Ah=AS.w_cond,Aw=AS.he,z=AS.h_cond;u.selectedClns=[];u.dbtables=[];u.joins=[];u.joinsInfo={};u.uiids={};u.tables={};var Aq=u.selectedClns,Ag={},AO,Ap,Av,AE,AJ;g.forEach(Ab,function(Ax){if(!(Ax.der&2147483648)){AO=X(Ax.exp.roo,[]);Av=V(Ax.exp.exp);Ap=[];g.forEach(AO,function(Ay){AE=Ay.cid;AJ=Ay.tid;Ag[AJ]=Ag[AJ]||{};Ag[AJ][AE]=Ag[AJ][AE]||{};Ag[AJ][AE].state=1;Ag[AJ][AE].count=!Ag[AJ][AE].count?1:Ag[AJ][AE].count+1;Ap.push(AJ+AE);});Aq.push({wid:Ap,expr:[{v:Av}],existing:true,ix:Ax.ix});}});u.tbns={};var AH=u.pos_hash,AC=u.tbns,Ar=[],AA,w,Ac,Aj,Am,t,AX;g.forEach(AS.stbs.c_c,function(Ay,Ax){AX={};AJ=Ay.id;AA=Ay.dbt.did;Am=Ay.als?V(Ay.als):(Au[AA].alias||Au[AA].tbn);Ac=Au[AA].cs;if(AH&&AH[Am]){AX.pos={w:AH[Am].w||L,h:AH[Am].h||R,t:AH[Am].t||n,l:AH[Am].l||e};}else{w=Ay.sqltf;if(w&&w.length){AX.pos={w:(w[0]&&w[0].pdv)/U||L,h:(w[1]&&w[1].pdv)/U||R,t:(w[2]&&w[2].pdv)/U||n,l:(w[3]&&w[3].pdv)/U||e};}}Aj=[];g.forEach(Ac,function(Az){AE=Az.did;t=P.copy(q[AE]);if(Ag[AJ]&&Ag[AJ][AE]){t.state=1;t.count=Ag[AJ][AE].count;}Aj.push(t);});AX.did=AJ;AX.cs=Aj;AX.tbn=Am;AX.ns=Au[AA].ns;AX.dbtbn=Au[AA].tbn;Ar[Ax]=AX;AC[Am]=Am;});if(u.firstTimeLoading&&!u.isNew){u.orits=u.orits||Ar.slice(0);}var AM=u.orits;g.forEach(Ar,function(Ax){if(g.find(AM,"did",Ax.did)>-1){Ax.existing=true;Ax.readOnly=mstrApp.isCloudPro;}});u.raiseEvent({name:"BindingTableLoaded",value:Ar});g.forEach(Aq,function(Ax){Ap=Ax.wid;g.forEach(Ap,function(Az,Ay){Ap[Ay]=u.uiids[Az];});});if(Ak){u.populateMappings(Ak);}if(AN.data){u.populateDataset(AN.data);}if(this.firstTimeLoading){W(u);}var AD,Ai,Af,x,Ao,AT,AY,AI,AW,Ad,o,AB,AG,AV;g.forEach(AS.sjs.c_c,function(Ax){AD=Ax.ltid;Af=Ax.rtid;AY=Ax.jt;AI=Ax.ix;AW=Ax.cdn.roo;AG=[];AB=u.uiids[AD]+u.uiids[Af];u.joins.push(AB);AV={jt:AY+"",exp:V(I(AW,Ax.exp_bo,AG)),srctID:u.uiids[AD],tgttID:u.uiids[Af],links:{}};Ai=u.tables[u.uiids[AD]];x=u.tables[u.uiids[Af]];Ai.njoins=(Ai.njoins||0)+1;x.njoins=(x.njoins||0)+1;g.forEach(AG,function(Ay){Ad=Ay.lcid;o=Ay.rcid;Av=V(Ay.exp);Ao=u.uiids[AD+Ad];AT=u.uiids[Af+o];AV.links[Ao+AT]={srcw:mstrmojo.all[Ao],tgtw:mstrmojo.all[AT],coords:[],exp:Av,jid:AB,op:d(Av)};AV.nlinks=(AV.nlinks||0)+1;u.addJoinColInfo(Ao,AT);});u.joinsInfo[AB]=AV;});u.raiseEvent({name:"JoinsLoaded"});var AR=[],AZ=[];if(AF.exp!==""){G(u,Ah,AR,AF.roo,0,AZ);if(AR.length){u.conditions.where=AR[0];}if(AZ.length&&!u.isCubeReport){u.pattrs={};var AU=Ak.amps,Ae;g.forEach(AU,function(Ax){if(g.find(AZ,"cid",Ax.afmps[0].sqc.id)>=0){Ae=Ax.aimp;u.pattrs[Ae.atid]={n:Ae.atnm,tp:12};}});}}if(Aw.exp!==""){AR=[];G(u,z,AR,Aw.roo,1);if(AR.length){u.conditions.having=AR[0];}}u.firstTimeLoading=false;}function C(p){var o=this;if(!o.FFSQLMode){if(o.getColumnsCount()===0){mstrmojo.alert(mstrmojo.desc(9945,"Please add at least one column and try again."));if(p&&p.failure){p.failure();}return false;}if(o.getTablesCount()===0){mstrmojo.alert(mstrmojo.desc(9946,"Please add at least one table and try again."));if(p&&p.failure){p.failure();}return false;}}return true;}function Z(p){var o=Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_DataInfo;if(p.isRefined){o=Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_InnerDataInfo;}if(!p.isFFSQL&&p.FFSQLMode){o=Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_DataInfo;}return Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_MappingInfo+o;}mstrmojo.qb.EmmaModel=mstrmojo.declare(mstrmojo.warehouse.WHModel,[mstrmojo.qb._hasQBModel],{scriptClass:"mstrmojo.qb.EmmaModel",originalMsgID:undefined,dbRolesVersionExcludeFilter:[223],isDataImport:true,init:function k(o){if(this._super){this._super(o);}if(o.dbIds){this.dbRoleEditorCfg.dbIdFilter=o.dbIds;}if(o.dbTypes!==undefined){this.specifyDBTypes=true;this.dbRolesTypeFilter=o.dbTypes;this.dbmsTypeFilter=this.dbRolesTypeFilter;}if(o.dbVersions){this.dbRolesVersionFilter=o.dbVersions;this.dbmsVersionFilter=o.dbVersions;}if(o.dbObjects!==undefined){this.dbObjects=o.dbObjects;}if(o.isHadoopQB){this.dbObjectsDisplayOptions=16;this.specifyDBTypes=true;this.dbRolesTypeFilter=Y.hadoopDbTypes.slice(0);this.dbmsTypeFilter=this.dbRolesTypeFilter.slice(0);this.dbRolesVersionExcludeFilter=Y.ibmDb2Versions.concat(this.dbRolesVersionExcludeFilter?this.dbRolesVersionExcludeFilter:[]);}this.dbRoleEditorCfg.dbIdExcludeFilter=!mstrApp.isFFSQL?[41,15]:[41];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=!mstrApp.isFFSQL?[3000]:[];},dbRoleEditorCfg:{hideShareConnection:true,dbIdExcludeFilter:[41]},createReportInstance:function Q(q,p){var u=this,o=u.isNew=!mstrApp.tableID;u.supportTimeGeo=true;u.analysisID=mstrApp.analysisID;u.tableID=mstrApp.tableID;var x=mstrApp.getRootController().getDataService(),t=mstrApp.isFFSQL,z=function z(AB,AA){x.createEmmaTable({success:function AC(AD){u.tableID=AD.tbid;mstrApp.msgid=AD.msgid;}},{xt:AB,dict:AA});};mstrApp.msgid=mstrApp.msgID;if(o){if(mstrApp.msgid){u.originalMsgID=mstrApp.msgid;x.removeOrDuplicateRI({success:function(AA){mstrApp.msgid=AA.msgid;z(q,p);}},{messageID:mstrApp.msgid});}else{x.createEmmaInstance({success:function w(AA){mstrApp.msgid=AA.msgid;z(q,p);}});}}else{u.originalMsgID=mstrApp.msgid;x.removeOrDuplicateRI({success:function(AA){mstrApp.msgid=AA.msgid;u.firstTimeLoading=true;var AB=Y.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_BINDINGTABLE+Y.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW;u.loadReport(AB,Y.ERDF.ENUM_LOAD_REPORT_BINDING_FLAG_ALL,Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_MappingInfo+Y.ERDF.ENUM_LOAD_REPORT_PREVIEW_FLAG_SourceInfo,null,{success:function AC(AD){if(t){u.populateFFSQLSrcTblClnInfo();m.call(u,AD);}else{var AF=!u.isBigQuery&&u.findManagedDBR();if(AF){u.fetchAndAppendSingleDBR(AF);}O.call(u,AD);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function AE(AG){mstrApp.msgid=AG.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){u.set("isFFSQL",true);u.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},loadDefinition:function A(o){O.call(this,o);},remap:function h(p,o){mstrApp.getRootController().getDataService().changeMapping({success:function q(t){if(o&&o.success){o.success(t);}}},{tbid:this.tableID,mpcs:JSON.stringify([p]),docid:mstrApp.docID||""});},loadEmmaReport:function M(q,o,z,u){var p=this,x=!u?Y.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW:Y.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_BINDINGTABLE+Y.ERDF.ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW,t=Z(p);if(!C.call(p,q)){return ;}p.loadReport(x,Y.ERDF.ENUM_LOAD_REPORT_BINDING_FLAG_ALL,t,null,{success:function w(AB){p.isDirty=false;if(!o){var AA=AB.datap,AD=AA.maps,AC=AA.data;if(p.FFSQLMode){p.populateFFSQLMapping(AD);p.populateFFSQLSrcTblClnInfo();p.populateDataset(AC);}else{p.populatePreview(AD,AC);}W(p);}if(q&&q.success){q.success(AB);}}});},autoMap:function c(w,x,o,q){var z=mstrApp.getRootController().getDataService(),t=this,p;if(!C.call(t,w)){return ;}p={tbid:t.tableID,isDB:true,taskId:"DIAutoMappingEMMASourceTable"};if(!t.isNew&&(mstrApp.isFFSQL||!t.FFSQLMode)){p.behaviorFlags=16;}if(!t.isDirty&&t.isNew){t.loadEmmaReport(w,x,o,q);return ;}var u=function(){t.submitRequest({success:function AC(){t.loadEmmaReport(w,x,o,q);},failure:function AB(AD){if(w&&w.failure){w.failure(AD);}}},p);};t.processEmmaTable({success:function AA(){u();},canceled:function(AD,AC){var AB={success:function(){if(w&&w.canceled){w.canceled();}},failure:function(){if(w&&w.canceled){w.canceled();}}};if(AC&&(AC.tid||AC.jid)){z.killJob(AB,{threadId:AC.tid,jobid:AC.jid});}else{AB.success();}}},{tables:t.tableID});},processEmmaTable:function(q,p){var o=mstrApp.getRootController().getDataService();o.clearDataCache({success:function(t){o.prepareData(q,p,1,1,H(9130,"Execute SQL"));},failure:function(t){o.prepareData(q,p,1,1,H(9130,"Execute SQL"));}},p);},buildRelations:function S(o){mstrApp.getRootController().getDataService().buildRelations({success:function p(q){if(o&&o.success){o.success(q);}}},{did:this.tableID});},loadDBTypeFilters:function B(q){var o=this;o.dbObjects.populateDBProperties(mstrmojo.func.wrapMethods({success:function p(){var u=[],t=o.dbObjectsDisplayOptions;P.forEach(o.dbObjects.dbTypes,function(w){if((w.disp&t)===t){u.push(w.v);}});o.dbmsTypeFilter=u;o.dbRolesTypeFilter=u;}},q));},cleanDuplicateRI:function N(p){var o;if(this.originalMsgID&&this.originalMsgID!==mstrApp.msgid){if(p){o=mstrApp.msgid;mstrApp.msgid=this.originalMsgID;}else{o=this.originalMsgID;}mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:mstrmojo.emptyFn},{add:false,messageID:o,showWait:false});delete this.originalMsgID;}},submitRequest:function j(q,p,o){if(p.showWait===undefined){p.showWait=true;}mstrApp.getRootController().getDataService()[o||"submitRequest"](q,p);},getHelpTopic:function a(){return this.FFSQLMode?"Importing_data_from_a_database_by_typing_a_query.htm":"Importing_data_from_a_database_by_building_a_SQL_q.htm";}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.warehouse.EnumDataChangeEvents");var F=mstrmojo.string;var E=4,A=15,D=5;function G(M){return M.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;apos;/g,'"').replace(/&apos;/g,"'").replace(/^\n+|\n+$/g,"").replace(/\t/g," ").replace(/&amp;/g,"&");}function I(O){var M=O.datap,N=M.srce,P=N.csl;this.set("SelDBRoleID",N.dbrid);P=G(P);this.SQLstmt=P;this.raiseEvent({name:"reportDefLoaded"});}function C(M){return M.dbRoleID+M.url;}mstrmojo.qb.thirdParty.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,null,{scriptClass:"mstrmojo.qb.thirdParty.Model",dbRolesVersionFilter:[223],dbRolesVersionExcludeFilter:[],dbObjectsDisplayOptions:8,xdaType:304,connectorType:131076,dbRoleEditorCfg:{hideShareConnection:true,hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[41],singleType:true},urlSrc:null,init:function L(M){this.dbRoleEditorCfg.showAddDriver=false;M.dbIds=null;M.dbVersions=null;this._super(M);this.urlSrc=[];this.dbRoleEditorCfg.dbIdExcludeFilter=[];this.dbRoleEditorCfg.cfgDbmsTypeExcludeFilter=[];},createReportInstance:function K(){var O=this,N=mstrApp.isFFSQL,M=O.isNew=!mstrApp.tableID,Q=mstrApp.getRootController().getDataService();O.supportTimeGeo=true;O.analysisID=mstrApp.analysisID;O.tableID=mstrApp.tableID;mstrApp.msgid=mstrApp.msgID;if(M){if(mstrApp.msgid){O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;}},{messageID:mstrApp.msgid});}else{Q.createEmmaInstance({success:function P(R){mstrApp.msgid=R.msgid;}});}}else{O.originalMsgID=mstrApp.msgid;Q.removeOrDuplicateRI({success:function(R){mstrApp.msgid=R.msgid;var S=E;O.loadReport(S,A,D,null,{success:function U(V){if(N){I.call(O,V);}if(mstrApp.isCloud){mstrApp.getRootController().getDataService().autoClosePrompt({success:function W(X){mstrApp.msgid=X.msgid;}});}}});}},{messageID:mstrApp.msgid});}if(mstrApp.isFFSQL){O.set("isFFSQL",true);O.set("FFSQLMode",true);mstrApp.isFFSQLMode=true;}},getAllowSave:function H(M){if(M&&M!==""){return true;}return false;},getHelpTopic:function J(){return"importing_data_from_a_BI_source.htm";},getNameSpaces:mstrmojo.emptyFn,autoMapFFSQL:function B(N,P){var M=this;mstrApp.getRootController().getDataService().editFFSQL({success:function O(){M.isDirty=true;M.SQLstmt=N;if(N){M.autoMap(P);}}},{exp:F.encodeXMLAttribute(N),tbid:M.tableID||""});}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._hasBigQueryModel","mstrmojo.hash");var C=mstrmojo.hash;mstrmojo.qb.bigquery.Model=mstrmojo.declare(mstrmojo.qb.EmmaModel,[mstrmojo.qb.bigquery._hasBigQueryModel],{setDBRole:function A(D){mstrApp.getRootController().getDataService().setDBRole({success:function(E){mstrApp.msgid=E.msgid;}},{dbrid:D,said:mstrApp.said,pid:this.selectedProject,tbid:this.tableID||""});},getRowWidget:function B(D,F){var G=this.tables,E,I,H;C.forEach(G,function(J){C.forEach(J.rows,function(L,K){if(D){I=D.toLowerCase()+"."+F.toLowerCase();E=J.tbn.toLowerCase();if(E+"."+L.text.toLowerCase()===I){H=L;return false;}}else{if(L.text.toLowerCase()===F){H=mstrmojo.all[K];return false;}}});if(!H){return false;}});return H;},catalogRefresh:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo._FillsBrowser","mstrmojo.Box","mstrmojo.Table","mstrmojo.Image","mstrmojo.Button","mstrmojo.qb.SplitPanel","mstrmojo.qb.VSplitPanel","mstrmojo.qb.QBuilderModel","mstrmojo.qb.QBPanel","mstrmojo.qb.QBMappings","mstrmojo.qb.MissingColumnWarning","mstrmojo.form","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.Toolbar","mstrmojo.qb.QBPageLayout","mstrmojo.qb.Footer","mstrmojo.DI.DIExitOptions");mstrmojo.requiresDescs(531,1143,3377,12408,12484);var R=mstrmojo.hash,F=mstrmojo.desc,C=mstrmojo.DI.DIHelpers;var M="qbexpr",X={scriptClass:"mstrmojo.qb.ExpressionEditor",id:M};var A=" ",L=".";var N=F(12408,"Please add tables from the same DB connection.");function B(b,c){if(!c){return b;}return(b.indexOf(A)>-1||b.indexOf(L)>-1)?c.replace("#0",b):b;}function Q(d,g,e){var m=[],c=mstrmojo.all.FFsql,n,j,k=e.length,l=c.items,h,f=this.main.WHTableTree,b=f.getDBRole(f.getDBRoleID()).cpat;n=j=c.itemCount;m.push({isNew:true,v:"select",oi:{n:"select",sta:100,t:100},did:j++},{isNew:true,v:" ",isDelimiter:true,did:j++});mstrmojo.array.forEach(e,function(p,o){m.push({isNew:true,v:B(p.cln,b),did:j++});h=o<k-1;if(h){m.push({isNew:true,v:",",isDelimiter:true,did:j++});}m.push({isNew:true,v:"\n",isDelimiter:true,did:j++});if(h){m.push({isNew:true,v:" ",isDelimiter:true,did:j++});}});g=B(g,b);m.push({isNew:true,v:"from",oi:{n:"from",sta:100,t:100},did:j++},{isNew:true,v:" ",isDelimiter:true,did:j++},{isNew:true,v:(d?B(d,b)+L+g:g),did:j++},{isNew:true,v:";",did:j++});if(n>0&&l[n-1]!=="\n"){l.push({isNew:true,v:"\n",isDelimiter:true,did:j++});}l=l.concat(m);c.itemCount=j;c.set("items",l);c.parent.updatepasses();}mstrmojo.qb.QBuilderPage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.qb.QBuilderPage",markupString:'<div id="{@id}" class="mstrmojo-qb {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-layout"></div></div>',markupSlots:{layout:function(){return this.domNode.firstChild;}},layoutConfig:{h:{layout:"100%"},w:{layout:"100%"}},id:"QBuilderPage",onError:mstrmojo.emptyFn,renderPageLoadError:function H(){var d=this.error,c=d.message,e=d.title,b=d.btns;this.onError(d);if(!b||!b.length){mstrmojo.alert(c,null,e);}else{mstrmojo.confirm(c,null,{buttons:b,title:e});}},render:function a(){if(this.error){this.renderPageLoadError();}else{this._super();}},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:mstrmojo.desc(3377,"Object"),browsableTypes:"3,8",showCompletePath:false,onObjectSaved:function(d){var c=this.opener,b=c&&c.oi;if(c&&b){b.did=d.did;b.n=d.name;b.desc=d.desc;c.set("title","QBReport: "+d.name);}}},children:[{scriptClass:"mstrmojo.qb.QBPageLayout",slot:"layout",alias:"main"}],init:function V(d){this._super(d);var e={},c=e[this.id]={};c.directDataAccessTableError=this.onTableAdded;c.diffDBInstTableError=this.onTableAdded;c.windowSizeChanged=this.adjustSize;mstrApp.getRootController().attachDataChangeListeners(e);var f=this.getDBRoleSelector(),b=this.main.children[0].bottomPanel;f.getLayoutOffsets=function(){return{h:9,w:0};};b.getLayoutOffsets=function(){return{h:16,w:0};};b.searchBox.widthOffset=10;b.nameSpaces.heightOffset=30;f.heightOffset=52;b.heightOffset=73;this.main.workPanel.getLayoutOffsets=function(){return{h:16,w:12};};f.newDBBtn.set("text",mstrmojo.desc(531,"Add")+"...");},getDBRoleSelector:function J(){return this.main.children[0].topPanel;},getDBConnectionList:function K(){return this.getDBRoleSelector().dbConnections;},onTableAdded:function P(b){var c="";switch(b.name){case"diffDBInstTableError":c=N;break;case"directDataAccessTableError":c=N;break;}mstrmojo.qb.alert(c);},openDialog:function Y(b){this.openPopup(b);},openExpressionEditor:function I(c,d){var b=mstrmojo.all[M]||mstrmojo.insert(X);b.set("oi",R.copy(c,{mhfts:{},mvfts:{}}));b.open(null,{zIndex:d||50});},addSQLFromColumn:function U(b){Q.call(this,b.ns,b.tbn,[b]);},addSQLFromTable:function S(c,d,b){Q.call(this,c,d,b);},getSQLStatement:function E(){return mstrmojo.all.FFsql.getSQLstmt();},toggleDatabaseView:function Z(b){this.main.toggleDatabaseView(b);},toggleDataPreview:function D(b){this.main.toggleDataPreview(b);},loadView:function O(){this.toggleDataPreview(true);this.toggleDataPreview(false);},showRedirectionPage:function G(b,c){this.set("children",[{scriptClass:"mstrmojo.Label",slot:"toolbar",text:mstrmojo.desc(12484,"Data Imported"),cssClass:"mstrmojo-qb-title"},{scriptClass:"mstrmojo.Image",cssClass:"mstrmojo-qb-toolbarIcon help",slot:"toolbar",title:mstrmojo.desc(1143,"help"),onclick:function(){var d=mstrmojo.helpPath()+"Interfaces_for_importing_data.htm";window.open(d);}},{scriptClass:"mstrmojo.DI.DIExitOptions",privileges:{CreateViewReport:mstrConfig.canCreateReport,CreateReportServices:mstrConfig.canCreateDocument,CreateAnalysis:mstrConfig.canCreateAnalysis},model:{cubeID:b,path:c,operationMode:mstrApp.getRootController().getOperationMode()},slot:"layout"},{scriptClass:"mstrmojo.qb.Footer",slot:"footer",alias:"footerWidget"}]);this.footerWidget.hidePublish();},adjustSize:function(h,b){var l=h.size,e=h.target,d=mstrApp.isCloudPro,k=d?40:0,g=d?180:101,f=!!mstrApp.isWorkstation?60:0;if(!C.acceptEventFromAncestor.call(this,e)){return ;}var c,j;if(b&&mstrmojo.DI.DIHelpers.getEnvObj().isWSLiveMode()){g+=45;k+=80;}j=parseInt(l.h,10)-g+f+"px";c=parseInt(l.w,10)-k+"px";if(this.height&&j!==this.height){this.set("height",j);}else{this.height=j;}if(this.width&&c!==this.width){this.set("width",c);}else{this.width=c;}return true;},postBuildRendering:function W(){if(this._super){this._super();}this.adjustSize({size:mstrApp.size},true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb.QBuilderModel");var C=mstrmojo.func.wrapMethods,E=mstrmojo.array;function D(H,G,F){G.showWait=F;mstrApp.getRootController().getDataService().submitRequest(H,G);}function B(F){if(!F){return"";}var G="hdfs://";var H="/";if(F.hadoopnameservice){return G+F.hadoopnameservice+H;}else{if(F.hadoopname){if(F.hdfsport&&F.hdfsport!=8020){return G+F.hadoopname+":"+F.hdfsport+H;}else{return G+F.hadoopname+H;}}else{return G+H;}}}mstrmojo.DI.DIHadoopModel=mstrmojo.declare(mstrmojo.qb.QBuilderModel,null,{scriptClass:"mstrmojo.DI.DIHadoopModel",dbObjectsDisplayOptions:32,dbRolesTypeFilter:[5400],dbRolesVersionFilter:[218],dbmsTypeFilter:[5400],saveDBRole:function A(G,F,I){D(C({success:function H(J){mstrApp.dbRoleID=J.dbr.did;var K=[];E.forEach(G.connstr.split(";"),function(M){var L=M.split("=");K[L[0].trim().toLowerCase()]=L[1];});mstrApp.hadoopConnURL=B(K);}},I),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(G),showWait:true},true);}});mstrmojo.DI.DIHadoopModel.prototype.populateURLPath=B;})();(function(){mstrmojo.requiresCls("mstrmojo.qb.QBPageLayout","mstrmojo.qb.QBuilderPage","mstrmojo.qb.bigquery.BigQueryWHPanel","mstrmojo.qb.QBHelpers");var F=mstrmojo.qb.QBHelpers;var B=[{did:"Delete",n:mstrmojo.desc(629,"Delete")},{did:-1,n:"-"},{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")},{did:-1,n:"-"},{did:"More Options",n:mstrmojo.desc(9126,"More Options")}];var C=[{did:"0",n:mstrmojo.desc(9640,"Inner Join")},{did:"1",n:mstrmojo.desc(9940,"Left Outer Join")},{did:"2",n:mstrmojo.desc(9941,"Right Outer Join")},{did:"3",n:mstrmojo.desc(9641,"Outer Join")},];var A=[{n:"=",dssid:"0"}];mstrmojo.qb.bigquery.QBPageLayout=mstrmojo.declare(mstrmojo.qb.QBPageLayout,null,{scriptClass:"mstrmojo.qb.bigquery.QBPageLayout",init:function D(H){var G;this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.BigQueryWHPanel";if(this._super){this._super(H);}G=this.workPanel.children[0].tables;G.joinMenuOption={menuItems:B,joinItems:C,mappingKey:"bigquery",joinOperators:A};}});mstrmojo.qb.bigquery.BigQueryBuilderPage=mstrmojo.declare(mstrmojo.qb.QBuilderPage,null,{scriptClass:"mstrmojo.qb.bigquery.BigQueryBuilderPage",init:function D(G){this.children=F.clone(this.children);this.children[0].scriptClass="mstrmojo.qb.bigquery.QBPageLayout";if(this._super){this._super(G);}},getDBRoleSelector:function E(){return this.main.children[0].topPanel.dbSelector;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.Serializer","mstrmojo.array","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBHelpers","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(218,219,221,1442,3179,3377,7985,7986,8041,9114,9139,9523,9915,11299,12379,12380,12922,13137,15125);var o=mstrmojo.hash,x=mstrmojo.array,AS=mstrmojo.string,j=mstrmojo.warehouse.EnumDataChangeEvents,AL=mstrmojo.qb.QBHelpers,h=mstrmojo.DI.DIConstants,Y=mstrmojo.desc;var N={1:Y(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),2:Y(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this.")};var M=function(AY){if(AY===null){return"null";}var AZ=typeof (AY);if(AZ!=="object"){return AZ;}else{if(AY.length===undefined){return"object";}else{return"array";}}};function H(AY){var AZ=mstrApp.diShowFooterFunction;if(AZ){AZ({finish:{visible:AY}});}}function z(AZ){var AY=AZ.FFSQLMode?"Type Query":"Build Query";return{name:AY};}mstrmojo.qb.RootController=mstrmojo.declare(mstrmojo.warehouse.WHController,null,{ddaController:null,start:function p(Ak,Ab){var Ae=this.rootView,Ad=this.model,Af=this,AZ,Ac,AY,Ah,Aa,Aj;this.dataService=mstrmojo.qb.DataService;Ae.render();if(mstrApp.isCloudPro){mstrApp.docID=mstrApp.docID||"";}else{mstrApp.docID=mstrApp.docID||mstrApp.analysisID||"";}if(mstrApp.isFFSQL){this.raiseEvent({name:"reportModeChange",mode:2,value:""});}this.toggleDatabaseView(true);Ae.loadView();var Ag=function Ag(){Af.loadDBRoles({success:function Al(){Ad.createReportInstance(Ak,Ab);var Am;Am=(Ad.isNew&&mstrApp.emmaTablesNum===0);H(Am);}});};if(Ad.specifyDBTypes){Ad.dbObjects.populateDBProperties({success:function Ai(){Ag();}});}else{Ad.loadDBTypeFilters({success:function Ai(){Ag();}});}AZ=mstrApp.diRootViewID;this.header=Ac=(AZ?(mstrmojo.all[AZ]&&mstrmojo.all[AZ].header):undefined);Ad.attachEventListener("dataPreview",this.id,function(){Af.enableButton(Ad.SQLstmt);});AY=mstrApp.diFooterID;Ah=AY?mstrmojo.all[AY]:undefined;if(Ah){Aa=Ah.next;Aj=Ah.finish;Af.attachEventListener("allowSave",Aa.id,Ah.enableButton);Af.attachEventListener("allowSave",Aj.id,Ah.enableButton);}},getDataService:function Z(){return this.dataService;},getModel:function AX(){return this.model;},toggleDatabaseView:function AP(AY){this.rootView.toggleDatabaseView(AY);},toggleDataPreview:function AF(AY){var Aa=this.rootView,AZ=this.model.FFSQLMode;Aa.toggleDataPreview(AY);if(!AZ){Aa.showQBPreview=AY;}if(AY){this.raiseEvent({name:"dataPreview"});}},openConditionDialog:function f(){var AZ=this.model,Ac=mstrApp.diCurrentZIndex,Ab=Ac?Ac+1:(this.zIndex||10)+1;if(AZ.dbtables.length===0){mstrmojo.alert(mstrmojo.desc(9114,"Cannot add Filter without any Tables being added, please add some Tables first"));return ;}var Aa="qbcondition",AY=mstrmojo.all[Aa]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ConditionEditor",id:Aa});AY.set("zIndex",Ab);if(!AY.hasRendered){AY.render();}AY.domNode.style.zIndex=AY.zIndex;AY.set("data",o.clone(AZ.getConditions()));AY.set("visible",true);},refreshConditionDialog:function L(){var AZ=this.model,Aa="qbcondition",AY=mstrmojo.all[Aa];if(AY&&AY.visible){AY.set("data",o.copy(AZ.getConditions()));}},openHelp:function l(){var AY=mstrmojo.helpPath()+(mstrApp.isFFSQL?"Importing_data_from_a_database_by_typing_a_query.htm":"Importing_data_from_a_database_by_picking_relation.htm");window.open(AY);},openExpressionEditor:function S(AZ){var AY=this,Ab={success:function Aa(){var Ad=mstrApp.diCurrentZIndex,Ac=AZ.zIndex?AZ.zIndex:(Ad?Ad+3:AY.zIndex);AY.rootView.openExpressionEditor(AZ,Ac);}};if(this.getFunctionList()){Ab.success();return ;}this.model.getFunctions(false,{success:function Aa(){Ab.success();}},{showWait:true});},getFunctionList:function AB(){return this.model.getFunctionList();},getSuggestionItems:function AQ(AY){return this.model.getSuggestionItems(AY);},exprjson2xml:function e(Ak,Ah,Ab){if(!(Ah instanceof Array)){Ah=[Ah];}var AZ=Ab&&Ab.isSerializable,Af=(Ab.convertBoolean===false)?false:true;var Ai=[],AY=[],Aa,Al;for(var Ae=0,Am=Ah.length;Ae<Am;Ae++){var An=Ah[Ae];for(Aa in An){if(AZ){var Ag=AZ(Aa,Ah,Ae);if(Ag!==true){if(Ag===false){continue;}else{if(Ag.att){Ai.push(Ag.att);}if(Ag.child){AY.push(Ag.child);}continue;}}}Al=An[Aa];switch(M(Al)){case"array":var Ac,Ad,Aj;if(Aa!=="omit"){AY.push(["<",Aa,">"].join(""));for(Ac=0,Ad=Al.length;Ac<Ad;Ac++){Aj=Ab.getArrItemName(Aa,Al,Ac)||Ac;AY.push(this.exprjson2xml(Aj,Al[Ac],Ab));}AY.push("</"+Aa+">");}else{for(Ac=0,Ad=Al.length;Ac<Ad;Ac++){Aj=Ab.getArrItemName(Aa,Al,Ac)||Ac;AY.push(this.exprjson2xml(Aj,Al[Ac],Ab));}}break;case"object":AY.push(this.exprjson2xml(Aa,Al,Ab));break;case"string":Ai.push([Aa,'="',mstrmojo.string.encodeXMLAttribute(Al),'"'].join(""));break;case"boolean":Ai.push([Aa,'="',((Af)?(Al?"-1":"0"):Al),'"'].join(""));break;case"null":if(!Ab.skipNull){Ai.push([Aa,'="',Ab.nullValue,'"'].join(""));}break;default:Ai.push([Aa,'="',Al,'"'].join(""));break;}}}return["<",Ak," ",Ai.join(" "),">",AY.join(""),"</",Ak,">"].join("");},parseExpression:function D(AZ,AY){this.model.validateExpr(AZ,AY);},autoMap:function AG(){var AY=this;if(!AY.hasDBConnection()){return ;}AY.model.autoMap({success:function(){AY.toggleDataPreview(true);}},false,false);},autoMapFFSQL:function t(AZ){var AY=this;if(!AY.hasDBConnection()){return ;}AY.model.autoMapFFSQL(AZ,{success:function Aa(){AY.enableButton(AZ);}});},getSQLPreview:function m(AY){this.model.getSQL(AY);},convertMode:function AN(Ad){var Aa=this,Ac=mstrApp.diCurrentZIndex,Ab=Ac?Ac+1:1000;Aa.model.connectLiveSupport=undefined;if(Ad){mstrmojo.confirm(mstrmojo.desc(15125,"All changes performed in Build Query mode will be lost. Do you want to leave Build Query mode?"),{confirmBtn:{fn:function(){Aa.model.getSQL({success:function Af(Ag){Aa.model.convertToFFSQL(Ag,{success:function Ah(){Aa.toggleDataPreview(false);Aa.raiseEvent({name:"reportModeChange",mode:2,value:Ag});}});}});}}},{zIndex:Ab});}else{var AZ=Aa.rootView.showQBPreview,Ae={success:function(){Aa.toggleDataPreview(AZ);Aa.raiseEvent({name:"reportModeChange",mode:1,showPreview:AZ});}},AY=mstrmojo.all.FFsql;if(AY.oriSQL===AY.getSQLstmt()){Aa.model.convertToQueryBuilder(Ae);}else{mstrmojo.confirm(mstrmojo.desc(9139,"All changes performed in FFSQL mode will be lost. Do you want to leave FFSQL mode?"),{confirmBtn:{fn:function(){Aa.model.convertToQueryBuilder(Ae);}}},{zIndex:Ab});}}},editSQL:function AT(AY,AZ){this.model.editFFSQL(AZ,AY);},addTable:function AC(AZ,AY){this.model.addTable(AZ,AY);},addTables:function AK(AZ){var Aa=this,AY=Aa.model;x.forEach(AZ,function(Ac){Aa.getColumnsForDBTable({data:Ac},{success:function Ab(Ad){if(AY.FFSQLMode){Aa.addTableSQL(Ac,Ad.items);Aa.enableButton();}else{Aa.addTable(Ac,Ad.items);}}});});},addSQLFromTable:function AI(AZ,Aa,AY){this.rootView.addSQLFromTable(AZ,Aa,AY);},addSQLFromColumn:function AD(AY){this.rootView.addSQLFromColumn(AY);},addSelectedColumns:function c(Ab,AY,Aa,AZ){this.model.addSelectedColumns(Ab,AY,Aa,AZ);},addColumnWithExpression:function R(AY,Ab,Aa,AZ){this.model.addColumnWithExpression(AY,Ab,Aa,AZ);},editColumnExpression:function u(AY,Ab,Aa,AZ){this.model.editColumnExpression(AY,Ab,Aa,AZ);},gettIndex:function b(AY){return this.model.gettIndex(AY);},updateTableViewWithExpression:function Q(AZ,AY,Af){var Ad=this.model,Ac=Ad.selectedClns[AZ],Ab=Ac.wid,Aa,Ae;Ac.expr=AY;x.forEach(Ab,function(Ag){Aa=mstrmojo.all[Ag];if(Aa&&!Af){if(Aa.count>0){Aa.count--;}Aa.updateState(0);}});Ab=[];x.forEach(AY,function(Ag){Ae=Ag.oi;if(Ae&&Ae.tp===26){Aa=Ad.getRowWidget(Ae.tn,Ae.rn);if(Aa){Aa.count++;Aa.updateState(1);Ab.push(Aa.id);}}});Ac.wid=Ab;Ad.updateExpression(AZ);},updateFilters:function AO(AY,AZ){this.model.updateConditions(AY,AZ);},addNewFilter:function V(AY){this.model.appendCondition(AY);},cancel:function K(){var AY=mstrApp.origin?(mstrApp.isBigQuery?"-3":"-2"):"-1";mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:AY},mstrApp.name,"POST",null,null,false);},onCancelButtonClick:function AM(){var AY;this.model.cleanDuplicateRI(true);AY=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=AY;mstrApp.getRootController().onCancelButtonClick();},onNextButtonClick:function X(){var AY=this;this.commit({success:function AZ(){var Aa,Ab=mstrApp.getRootController().model,Ad=Ab.isDDA,Ac=Ab.isManagedCube;if(AY.header&&AY.header.closeBtn){AY.header.closeBtn.set("visible",true);}Ab.cleanDuplicateRI(false);Aa=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Aa;mstrApp.isDDA=Ad;mstrApp.isManagedCube=Ac;mstrApp.getRootController().afterQBProcess();}});},saveDDACube:function AU(AZ){var Aa=this.model,Ab={},Ac;Ac={success:function(Aj){var Ad,Af=Aa.isDDA,Ag,Ak,Ah,Ai,Ae,Al=Aa.isManagedCube;Aa.cleanDuplicateRI(false);Ad=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Ad;mstrApp.isDDA=Af;mstrApp.isManagedCube=Al;Ag=mstrApp.getRootController();Ak=Ag.model;Ag.getDDAController().setDirectDataAccess(mstrApp.isDDA);Ag.dataService.set("messageID",mstrApp.messageID);Ag.model.isManagedCube=mstrApp.isManagedCube;Ak.cubeName=z(Aa).name;if(mstrApp.isSingleTier){Ah={isDirectDataAccess:Ak.isDirectDataAccess,name:Ak.cubeName};Ai={success:function(Am){if(Am.objectId){Ak.cubeID=Am.objectId;}Ag.wrapUpDataImport();},failure:function(Am){mstrApp.hideProgress();Ag.displayError(mstrmojo.desc(13061,"Error in creating the dataset."),false,Am&&Am.message);}};Ae={success:function(){Ag.dataService.createOneTierDoc(Ai,Ah);},failure:function(Am){mstrApp.hideProgress();Ag.displayError(mstrmojo.desc(13062,"Error in merging the duplicate report instance."),false,Am&&Am.message);}};if(Ak.operationMode===h.operationMode.edit||Ak.operationMode===h.operationMode.refresh){Ag.dataService.duplicateReportInstance(Ae,{messageID:Ak.analysisID,datasetID:Ak.cubeID,duplicateRIMsgID:Ag.dataService.messageID});}else{if(mstrApp.isSingleTier&&!Aa.isManagedCube){if(Aj&&Aj.objectId){Ak.cubeID=Aj.objectId;}Ag.wrapUpDataImport();return ;}Ag.dataService.createOneTierDoc(Ai,Ah);}return ;}if(Al){Ag.wrapUpDataImport();return ;}Ak=Ag.model;if(Aj&&Aj.objectId){Ak.cubeID=Aj.objectId;}Ak.path=AZ&&AZ.objPath;Ag.wrapUpDataImport();}};function AY(){if(Aa.isManagedCube){Ac.success();return ;}Ab.displayMode=12;Ab.shouldRefresh=false;if(Aa.isDDA){Ab.shouldRefresh=false;Ab.saveAsFlags=h.saveAsFlags.saveAsDDA|h.saveAsFlags.saveAsOverWrite;}else{Ab.saveAsFlags=h.saveAsFlags.saveAsInMemory|h.saveAsFlags.saveAsOverWrite;}Ab.saveAsFlags|=h.saveAsFlags.saveAsWithAnswers|h.saveAsFlags.saveAsWithPrompts;Ab.taskId="saveAndPublishCube";Ab.showWait=true;Ab=o.copy(AZ,Ab);Ab.saveAsOverwrite=true;if(mstrApp.isSingleTier&&!Aa.isManagedCube){Ab.persist=1;}Ab.objName=Ab.objName||z(Aa).name;Ab.folderID=Ab.folderID||"";Ab.msgID=Ab.msgid||mstrApp.msgid;delete Ab.objPath;mstrApp.getRootController().model.submitRequest(Ac,Ab);}mstrApp.getRootController().model.submitRequest({success:function(){if(Aa.operationMode!==2){mstrApp.getRootController().model.submitRequest({success:function(){AY();}},{taskId:"DIClearRelationshipEMMASourceTable",showWait:true});}else{AY();}}},{taskId:"DIToggleDatasetServeMode",serveMode:Aa.isDDA?h.datasetServeMode.dda:h.datasetServeMode.inMemory,showWait:true});},handleFinish:function a(){var AY=this.model,Aa=this,AZ=AY.operationMode,Ab={};Ab.onOK=function(Ad){Aa.commit({success:function Ac(){var Ae,Ag=AY.isDDA,Af=AY.isManagedCube;if(Ag&&AZ!==1){Aa.saveDDACube(Ad);}else{AY.cleanDuplicateRI(false);Ae=mstrApp.msgid;mstrApp.container.unloadQB();mstrApp.messageID=Ae;mstrApp.isDDA=Ag;mstrApp.saveCubeParams=Ad;mstrApp.isManagedCube=Af;mstrApp.getRootController().afterQBProcess(true);}}});};if(AZ===1){Ab.onOK();}else{if(!AY.isManagedCube&&!mstrApp.isSingleTier){AL.showSaveAsDialog(Ab,z(this.model));}else{Ab.onOK();}}},onBackButtonClick:function n(){var AZ=this.model,Aa=AZ.tableID,AY=this,Ac;Ac={success:function Ab(){var Ad=mstrApp.msgid,Ae;mstrApp.container.unloadQB();mstrApp.messageID=Ad;Ae=mstrApp.getRootController();if(Ad){Ae.dataService.set("messageID",Ad);}Ae.backFromQB();}};if(AZ.isNew&&Aa){AY.getDataService().removeEmmaTable(Ac,{did:Aa});}else{Ac.success();}},onFinishButtonClick:function AR(){var AZ=this,AY=this.model,Ab=AZ.getDDAController(),Ae,Aa,Ad=mstrApp.diCurrentZIndex,Ac=Ad?Ad+1:10;if(!AY.origIsDDA&&Ab.allowDDA()){Ae={onOK:function(){AZ.handleFinish();}};Aa={callback:Ae,selectedIndex:AY.isDDA?0:1,zIndex:Ac};Ab.showDDAConfirmDialog(Aa);return ;}this.handleFinish();},exitApplication:function G(){mstrApp.container.unloadQB();mstrApp.getRootController().exitApplication();},addSQLCandidateTables:function w(AY){this.model.raiseEvent({name:"addCandidateTables",value:AY});},hasDBConnection:function AA(){if(this.model.SelDBRoleID){return true;}mstrmojo.alert(mstrmojo.desc(9915,"Please select a database connection first."));return false;},hasDBRoleSelected:function(){return !!this.model.SelDBRoleID;},publish:function g(){var Aa=this.model,AY=Aa.FFSQLMode?this.rootView.getSQLStatement():"",Ac=Aa.isNew,Ad=mstrApp.folderID,Ab=this,AZ={success:function(Ai){if(mstrApp.analysisID||mstrApp.msgID){var Aj=mstrApp.analysisID?[3169,mstrApp.name+".3169","messageID",mstrApp.analysisID]:[3104,mstrApp.name+".3104","messageID",mstrApp.msgID,"rwDesignMode",1,"executionMode",2],Ah=[Aj,[2048007,mstrApp.name+".rwd.rwframe.rwb.2048007","dsObjectID",Ai.did,"dsType",3,"isDatasetAdded",false,"isDefault",false]];mstrApp.redirectToPage({evt:"1024001",events:mstrmojo.Serializer.serializeValueGroup(Ah),src:mstrApp.name+"."+mstrApp.pageName+".1024001","1024001":"1",evtorder:"1024001"});}else{if(mstrApp.isCloudPro){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:Ai.did,rwCreateFlags:"16",rwViewMode:"2048"});}else{Ab.gotoRedirectionPage(Ai.did,Ai.path);}}}};if(!this.hasDBConnection()){return ;}Aa.recoverMode=0;if(Ad||!Ac){var Ag=Ac&&mstrApp.isCloudPro;Aa.save((Ag?Aa.getAutoReportName():null),null,Ad,!Ac,Ag,AY,{success:function(Al){var Ak=mstrApp.analysisID,An=!Aa.isCubeReport,Ah=mstrApp.folderID,Aj=mstrApp.reportID,Am=mstrApp.refreshInDoc;if(!Ac&&Ak){mstrApp.hideWait(true);if(Am){if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ak);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ak});}}else{var Ai=mstrmojo.insert({scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-qb-ObjectInfoEditor run-dashboard",showTitle:false,analysisID:Ak,cssText:"width: 260px",children:[{scriptClass:"mstrmojo.Label",text:An?mstrmojo.desc(13137,"Edit data successfully!"):mstrmojo.desc(11299,"Data refresh successful!"),cssClass:"mstrmojo-AttCreator-Text"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-RunDashboard",onclick:function(Ap){var Ao=this.parent.parent;Ao.close();if(rrLockAndRunDashboard){rrLockAndRunDashboard(Ak);}else{mstrApp.redirectToPage({evt:"3104",rwDesignMode:"0",rwViewMode:"2048",executionMode:"1",objectType:"55",objectID:Ak});}}},{scriptClass:"mstrmojo.Button",id:"RefreshData",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-"+(An?"EditData":"RefreshData"),cssDisplay:"none",onclick:function(){if(An){refreshCube(Ak,Ah,"0",Aj,RRDIExtentedType.DATAIMPORT_DATABASE,false,true);}else{openCubeRefreshStatus(Ak,Ah);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-Editor-button-Exit",onclick:function(){var Ao=this.parent.parent;Ao.close();mstrApp.showWait();if(mstrApp.isCloud){rrOpenHomePage&&rrOpenHomePage();}else{mstrApp.redirectToPage({evt:3010});}}}]}]});Ai.open();}}else{AZ.success(Al);}}});}else{var Ae=this.rootView,Af=function Af(){Ae.openPopup("saveasRef",{folderLinksContextId:mstrConfig.hasProfileReports?28:1,name:mstrmojo.desc(8041,"New Cube"),saveAs:function(){var Ao=this,Ah=Ao.contPanel,Ai=Ah.name.value,An=Ao.ob.currentFolder,Ak=An.did,Aj={success:function Am(Aq){AZ.success(Aq);},failure:function Al(Ar){var Aq=parseInt(Ar.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296;if(Aq===2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",mstrmojo.desc(3377)).replace("###",Ai),{confirmBtn:{fn:function(){Ap(true);}}},{title:mstrmojo.desc(3179,"Confirm Overwrite")});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+Ar.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};if(!Ai){mstrmojo.alert(mstrmojo.desc(9523,"Enter a Name"));return ;}var Ap=function Ap(Aq){Aa.save(Ai||"",Ah.desc.value||"",Ak,Aq,mstrApp.isCloudPro,AY,Aj);Ao.close();};Ap();}});};Af();}},updateTableStructure:function I(){var AY=this.model;AY.compareDBTables({success:function(){if(AY.hasMissingUsedDBColumns()){mstrmojo.confirm(mstrmojo.desc(12922,"There are missing columns used in expressions. Do you want to update?"),null,{buttons:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(219),function(){AY.updateDBTables(true);},null,{iconClass:"mstrmojo-Editor-button-Yes"}),mstrmojo.Button.newInteractiveButton(mstrmojo.desc(218),null,null,{iconClass:"mstrmojo-Editor-button-No"})],title:mstrmojo.desc(3179)});}else{AY.updateDBTables();}}});},gotoRedirectionPage:function C(AY,AZ){if(mstrApp.isNewAnalysis){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"1",rwDesignMode:"0",objectType:"3",objectID:AY,rwCreateFlags:"16",rwViewMode:"2048"});return ;}if(mstrApp.msgID){mstrApp.redirectToPage({evt:"3104",src:mstrApp.name+".3104",executionMode:"2",rwDesignMode:"1",objectType:"3",objectID:AY});return ;}this.rootView.showRedirectionPage(AY,AZ);},save:function k(){this.model.save();},enableButton:function(AZ){var AY=this.model.getAllowSave(AZ);this.raiseEvent({name:"allowSave",value:AY});},addWHTable:function J(Ab){var Aa=this.model,AZ=0,AY=Ab.x,Ac=Ab.y;x.forEach(Ab,function(Ae){Aa.getColumnsForDBTable({data:Ae},{success:function Ad(Af){Ae.x=AY+AZ*15;Ae.y=Ac+AZ*15;AZ++;Aa.addTable(Ae,Af.items);}},this);});},canAddTableSQL:function AE(AZ,AY){return this.model.canAddTableSQL(AZ,AY);},addTableSQL:function O(AZ,AY){this.model.addTableSQL(AZ,AY);},getFFsqlComp:function AV(){return this.model.FFsqlComp;},getOperationMode:function AJ(){return(this.model.isNew)?0:1;},checkDBTables:function q(){this.model.checkDBTables();},markFailureLabel:function U(AY){this.raiseEvent({name:"failureLabel",value:AY});},attachDataChangeListeners:function AH(AZ){var AY=this.model;o.forEach(AZ,function(Aa,Ab){o.forEach(Aa,function(Ad,Ac){AY.attachEventListener(Ac,Ab,Ad);});});},editColumn:function d(Ab){var Ac=3,Aa=Ab.columnIndex,AY=this.model,AZ=AY.selectedClns[Aa];this.openExpressionEditor({type:Ac,w:AZ,tkn:AZ.expr,cIndex:Aa});},deleteColumn:function B(Aa){var AZ=Aa.columnIndex,AY=this.model;if(AY.removeSelectedColumn){AY.removeSelectedColumn(AZ);}},deleteAllColumns:function P(){this.model.removeAllColumns();},enableAvailableTables:function AW(){this.model.raiseEvent({name:j.DBTABLES_ENABLED,value:true});mstrApp.getRootController().enableButton();},getDDAController:function W(){if(this.ddaController===null){this.ddaController={shouldAskUser:true,allowDDA:function Ac(){var Aj=mstrApp.getRootController(),Ak=Aj.model,Al=Aj.rootView,Ah=!!Ak.canSupportDDA,Af,Am,Ai=Ak.connectLiveSupport,An,Ag;if(!Ah||(Ai===h.connectLiveSupport.connectLiveSupportInMemoryOnly)){return false;}else{if(Ai===undefined||!mstrApp.isFFSQLMode){An=Ak.getDBRole(Ak.SelDBRoleID);Ag=An&&An.mdDBRole&&An.mdDBRole.db_type===3000;if(Ag){return false;}}}Af=Ak.dbridForDDA;if(Af){if(!mstrApp.isFFSQLMode&&Ak.dbtables.length>0&&Af!==Ak.prevDBRoleID){Ah=false;}else{if(mstrApp.isFFSQLMode){Am=Al.getSQLStatement();if(Ak.prevDBRoleID&&AS.trim(Am)&&Af!==Ak.prevDBRoleID){Ah=false;}}}}return Ah&&!(mstrApp.isFFSQLMode&&Ak.isMultiPassSQL(Al.getSQLStatement()));},onlyAllowDDA:function Ae(){return !!mstrApp.getRootController().model.shouldSupportDDA;},onToggleDDA:function AY(Ai){var Ag=mstrApp.getRootController().model,Af=0,Ah;if(Ag.isDDA===Ai){return ;}if(Ai){Ag.set("isDDA",true);if(!this.allowDDA()){Af=1;Ah=false;}}else{Ag.set("isDDA",false);if(this.onlyAllowDDA()){Af=2;Ah=true;}}if(Af){mstrmojo.qb.alert(N[Af]);Ag.set("isDDA",Ah);}},checkDDACheckbox:function Aa(Ah){var Af=mstrApp.getRootController().model.ddaCheckboxID,Ag;if(Af){Ag=mstrmojo.all[Af];if(Ag){Ag.set("checked",Ah);}}},tryEnableDDACheckbox:function Ab(Ah){var Af=mstrApp.getRootController().model.ddaCheckboxID,Ag;if(Af){Ag=mstrmojo.all[Af];}if(!Ag||!Ag.visible){return ;}if(!Ah){if(Ag.enabled&&!Ag.checked&&!this.allowDDA()){Ag.set("enabled",false);}}else{if(!Ag.enabled&&!Ag.checked&&this.allowDDA()){Ag.set("enabled",true);}}},askUserAboutDDA:function Ad(Af){if(Af){this.shouldAskUser=false;}return this.shouldAskUser;},showDDAConfirmDialog:function AZ(Af){var Ag=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog(Af||{});Ag.open();}};}return this.ddaController;},onHelpButtonClick:function A(){mstrApp.showHelpTopic(this.model.getHelpTopic());},selectDBRole:function E(Aa){var AZ,AY;if(!Aa){return ;}AZ=this.rootView.getDBConnectionList&&this.rootView.getDBConnectionList();if(!AZ){return ;}AY=x.find(AZ.items,"did",Aa);if(AY>=0){AZ.set("selectedIndex",AY);AZ.adjustScrollPosition(AY);}return(AY>=0);},hasTableJoin:function F(AY){var AZ=this.model.tables[AY];return(AZ&&AZ.njoins>0)?true:false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController");var B=mstrmojo.func.wrapMethods;mstrmojo.DI.controller.DIHadoopWHController=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopWHController",saveDBRole:function A(D,C,G){var E=this;E.model.saveDBRole(D.mdDBRole,C,B(G,{success:function F(){}}));}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController");mstrmojo.qb.EmmaController=mstrmojo.declare(mstrmojo.qb.RootController,null,{commit:function A(F){var C=this.model,D,B={success:function E(){C.buildRelations(F);}};if(C.FFSQLMode){C.autoMapFFSQL(mstrApp.getRootController().rootView.getSQLStatement(),B);}else{C.autoMap(B);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController","mstrmojo.warehouse.WHController","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12752,12898,13324);var L=mstrmojo.array,I=mstrmojo.DI.DIHelpers;function G(){return mstrApp.container.launchingApp.getRootController();}function E(S){var R=[];var U=[];var V=S.urlSrc;var W="<ul>";mstrmojo.hash.forEach(V,function(X){if(X.fail===true){R.push(X.tableID);W+="<li>"+X.url+"<br>"+X.errorMsg||" </li>";}else{U.push(X.tableID);}});W+="</ul>";return W;}function H(S,X,W){var Z=E(S);var R={detailErrorMessage:Z,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:W};var Y=mstrmojo.desc(12752,"BI Sources"),V=mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),U=G();U.displayWarning(V,Y,X,R);}function P(R){var S=G();var U=E(R);S.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,U);}function M(W,X,V,S,Z){var R={success:function Y(){W.buildRelations(Z);},failure:function U(){W.urlSrc[S].fail=true;Z.success();}};W.setDBRole(X);W.autoMapFFSQL(V,R);}function C(U,X,Y,R){var W=mstrApp.getRootController().getDataService();if(mstrApp.msgid&&X.tableID){U.tableID=X.tableID;M(U,X.dbRoleID,X.url,R,Y);}else{W.createEmmaTable({success:function V(Z){U.tableID=Z.tbid;mstrApp.msgid=Z.msgid;X.tableID=Z.tbid;M(U,X.dbRoleID,X.url,R,Y);},failure:function S(){U.urlSrc[R].fail=true;P(U);}},{xt:U.xdaType,dict:U.connectorType});}}function B(V){var R=V.getDBRole(V.SelDBRoleID);var S=R?R.n:"";var U="BI Source from "+S;return{name:U};}function O(a,e){var c=mstrApp.getRootController().getDataService();var W=a.urlSrc,Y=[],S=[];L.forEach(W,function(f){if(f.fail){S.push(f.tableID);}else{Y.push(f);}});var X=function(){e.success();},V=function(){var f=mstrApp.getRootController();f.removeImportedSrc(Y);};var b=(S.length===W.length);var Z={success:function d(){L.forEach(W,function(f){if(f.fail){f.tableID=undefined;}});if(b){P(a);}else{H(a,X,V);}},failure:function R(){var f=G();f.displayError(mstrmojo.desc(12898,"Delete failed table failure!"),true);}};var U=S.length;if(U===0){e.success();}else{if(a.isNew){c.removeEmmaTable(Z,{did:S.join()});}else{P(a);}}}mstrmojo.qb.thirdParty.Controller=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.qb.thirdParty.Controller",proIdx:-1,commit:function J(Z){var S=this.model,W=mstrApp.getRootController().rootView,U=W.getSrcUrls(),Y=U.length,V=this,X;S.urlSrc=U;V.proIdx=0;if(Y>0){X=U[0];var R={success:function(){V.proIdx++;X=U[V.proIdx];if(X){C(S,X,R,V.proIdx);}else{O(S,Z);}}};if(S.isNew){C(S,X,R,V.proIdx);}else{M(S,X.dbRoleID,X.url,0,Z);}}},onBackButtonClick:function Q(){mstrApp.container.unloadQB();var R=mstrApp.getRootController();var S=R.rootView.header;if(S){S.set("subtitleText","");}R.backFromQB();},handleFinish:function K(){var R=this.model,U=this,S=R.operationMode,V={};V.onOK=function(X){U.commit({success:function W(){var Y=mstrApp.msgid,Z=R.isManagedCube;mstrApp.container.unloadQB();mstrApp.messageID=Y;mstrApp.saveCubeParams=X;mstrApp.isManagedCube=Z;mstrApp.getRootController().afterQBProcess(true);}});};if(S===1){V.onOK();}else{if(!R.isManagedCube&&!mstrApp.isSingleTier){mstrmojo.qb.QBHelpers.showSaveAsDialog(V,B(this.model));}else{V.onOK();}}},onFinishButtonClick:function F(){this.handleFinish();},removeImportedSrc:function D(R){this.rootView.removeSrcs(R);},canDisplayCatalogSQL:function N(){return false;},handleServerRequestError:function A(S,Y,X,W,U){var R=this.proIdx;if(R<0){mstrmojo.DI.controller.DIDialogController.showErrorDialog(S,Y,X,W,U);}else{var V=this.model.urlSrc[R];if(V){V.errorMsg=Y;}if(X){X();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.EmmaController","mstrmojo.DI.DIConstants","mstrmojo.AS.ASFFSQLRootController");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASQbFFSQLController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.AS.ASFFSQLRootController],{scriptClass:"mstrmojo.AS.ASQbFFSQLController",onFinishButtonClick:function C(){var H=mstrApp.rootController.model,G=H.dbrs,I=H.tableID,E,J,F,D;J=mstrApp.getRootController().rootView.getSQLStatement();F=J.split(".");F=F[F.length-1];E=G.find(function(K){return K.did===H.SelDBRoleID;});D={ns:H.SelNameSpaceID,id:E.mdDBRole.did,type:E.mdDBRole.db_type,dbr:E.mdDBRole.did,dbrn:E.mdDBRole.n,sql:J,dbtn:"Custom Query",n:"Custom Query",name:"Custom Query"};D.connection={connectionType:E.mdDBRole.db_type,connectionName:E.mdDBRole.n};D.tables=[];D.tables.push({dbr:E.mdDBRole.did,dbrn:E.mdDBRole.n,ns:H.SelNameSpaceID,type:E.mdDBRole.db_type,sql:J,name:"Custom Query"});this._super(D);},autoMapFFSQL:function A(J){var E=mstrApp.getRootController(),G=E.model;if(J===""){G.raiseEvent({name:"dataPreview",mappings:null,dataset:null,selectedColumns:null,isRefined:false});return ;}var D=window.mstrAppSchema.workspaceManager.currentClientId,H=window.mstrAppSchema.workspaceManager.initialWorkspaceId,F="",K=G.SelDBRoleID;var I={clientId:D,requestId:"",workspaceId:H,pipelineId:F,datasource:{dbRoleId:K,sql:J}};this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.qb.bigquery._BigQueryController");mstrmojo.requiresDescs(12385);var F=mstrmojo.hash,E=mstrmojo.desc;mstrmojo.qb.bigquery.RootController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.RootController",isCloud:function C(){return mstrApp.isCloudPro;},getColumnsForDBTable:function A(G,H){this.model.getColumnsForDBTable(G,H);},attachDataChangeListeners:function D(H){var G=this.model;F.forEach(H,function(I,J){F.forEach(I,function(L,K){G.attachEventListener(K,J,L);});});},hasDBConnection:function B(){if(this.model.selectedProject){return true;}mstrmojo.alert(E(12385,"Please select a project first."));return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery.RootController","mstrmojo.DI.DIConstants","mstrmojo.AS.ASFFSQLRootController");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASGBQFFSQLController=mstrmojo.declare(mstrmojo.qb.bigquery.RootController,[mstrmojo.AS.ASFFSQLRootController],{scriptClass:"mstrmojo.AS.ASGBQFFSQLController",onFinishButtonClick:function C(){var G=mstrApp.rootController.model,H=G.dbrid,I=G.tableID,E,J,F,D;J=mstrApp.getRootController().rootView.getSQLStatement();F=J.split(".");F=F[F.length-1];D={ns:G.selectedDataset,id:H,type:B.dbType.GOOGLE_BIG_QUERY_FFSQL_MODEL,sql:J,dbtn:"Custom Query",n:"Custom Query",name:"Google Bigquery",accountId:G.said};D.connection={connectionType:B.dbType.GOOGLE_BIG_QUERY_FFSQL_MODEL,};D.tables=[];D.tables.push({dbr:H,ns:G.selectedDataset,type:B.dataSourceType.GOOGLE_BIGQUERY,sql:J,name:"Custom Query",accountId:G.said});this._super(D);},autoMapFFSQL:function A(J){var F=mstrApp.getRootController(),H=F.model;if(J===""){H.raiseEvent({name:"dataPreview",mappings:null,dataset:null,selectedColumns:null,isRefined:false});return ;}var E=window.mstrAppSchema.workspaceManager.currentClientId,I=window.mstrAppSchema.workspaceManager.initialWorkspaceId,G="",K=H.SelDBRoleID;var D={accountId:H.said,clientId:E,requestId:"",workspaceId:I,pipelineId:G,datasource:{accountId:H.said,dbRoleId:K,sql:J}};this._super(D);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._IsWebApp","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.warehouse.WHModel","mstrmojo.warehouse.WHController","mstrmojo.qb.QBuilderPage","mstrmojo.qb.QBuilderModel","mstrmojo.qb.EmmaModel","mstrmojo.qb.RootController","mstrmojo.qb.EmmaController","mstrmojo.qb.bigquery.RootController","mstrmojo.qb.bigquery.ESRootView","mstrmojo.qb.bigquery.BigQueryBuilderPage","mstrmojo.qb.es.Model","mstrmojo.qb.es.Controller","mstrmojo.qb.EnumQBAppType","mstrmojo.qb.QBAlertDialog","mstrmojo.qb.thirdParty.Controller","mstrmojo.qb.thirdParty.Model","mstrmojo.qb.thirdParty.RootView","mstrmojo.DI.DIConstants","mstrmojo.string","mstrmojo.hash");mstrmojo.requiresDescs(37,889,1442,9944,11583,11584,11585,11622,11623,11624,11625,12569,12920,12921,12923,12941,5781,14297,12933);var O=mstrmojo.string,F=mstrmojo.DI.DIHelpers,X=mstrmojo.hash;var Q="QBwaitBox",a={scriptClass:"mstrmojo.Editor",id:Q,draggable:false,showTitle:false,zIndex:9999,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],counter:0,displayMsg:null,ondisplayMsgChange:function J(){if(this.progress){this.progress.set("progressText",this.displayMsg);}},oncounterChange:function h(){var l=this.counter,n=this.visible;if(l===0&&n){this.close();}else{if(l>0&&!n){var k=mstrApp.container;var m={};if(k&&k.domNode){var j=mstrmojo.dom.position(k.domNode);if(j){m={top:j.y+"px"};}}this.open(null,m);}}}};var N=-2147215346,K=-2147071825,g=-2147212035,H=-2147206925,A=-2147206924,G=-2147209051,D=-2147207419,e=-2147071870,B=-2147216373,L=-2147214579;var f={};f[N]=mstrmojo.desc(11583,"Failed to execute query.");f[K]=mstrmojo.desc(11584,"Insufficient storage space to upload your data.");f[g]=mstrmojo.desc(11622,"Please unmap the attribute's non-key form first.");f[H]=mstrmojo.desc(11623,"Your session has expired.");f[A]=mstrmojo.desc(11623,"Your session has expired.");f[G]=mstrmojo.desc(11623,"Your session has expired.");f[D]=mstrmojo.desc(11623,"Your session has expired.");f[e]=mstrmojo.desc(11624,"No quota left to create cube.");f[B]=mstrmojo.desc(11625,"Failed to create report instance.");f[L]=mstrmojo.desc(12933,"You don't have enough privileges to perform this operation");var R="A61B85F4485D3B953003B195E58B5138";var C=mstrmojo.DI.DIConstants;function c(t,j,q){var n=mstrApp.isSingleTier?mstrmojo.desc(14297,"There is an error."):mstrmojo.desc(11585,"There is an error on the server."),p=mstrApp.getRootController(),w=t.code||(t.getResponseHeader&&t.getResponseHeader("X-MSTR-TaskErrorCode"))||"",l=t.message||(t.getResponseHeader&&t.getResponseHeader("X-MSTR-TaskFailureMsg"))||"",k="",o="",u;l=(l.length>2000)?l.substring(0,2000)+"...":l;u=l.replace(/com\.microstrategy(\.\w+)*: \(?/,"").replace(/\)$/,"");w=parseInt(w,10);switch(w){case N:if(p.model.FFSQLMode){k=l.replace(/com\.microstrategy(\.\w+)*: \(/,"").replace(/\)$/,"");if(k.match(/(.\s)*DataImport\)?\[(\d+)\](.\s)*/)){var m=parseInt(RegExp.$2,10);p.markFailureLabel(m);o=mstrmojo.desc(9944,"SQL Pass ## failed to execute.").replace("##",m);u=O.encodeHtmlString(k);}}u=O.htmlAngles(u);mstrmojo.qb.alert(o||f[w],u,j,null,q);break;case K:l=l.match(/currently using(.*)space/g)[0];l=l.match(/\d+../g);k=mstrmojo.desc(12920,"You are currently using ## of the allocated ### space.");mstrmojo.qb.alert(f[w],k.replace("##",l[0]).replace("###",l[1]),j,null,q);break;case g:mstrmojo.qb.alert(f[w],u,j,null,q);break;case e:mstrmojo.qb.alert(f[w],u,function(){mstrmojo.form.send({evt:"3124",src:mstrApp.name+".qbuilder.3124",relativePageNumber:"-1"},mstrApp.name,"POST",null,null,false);},null,q);break;case B:if(p.model.riid===R){mstrmojo.alert(mstrmojo.desc(12921,"Please contact your Administrator to update the Project Metadata."),function(){mstrApp.redirectToPage({evt:3010});});}else{mstrmojo.qb.alert(f[w],u,j,null,q);}break;case H:case A:case G:case D:if(mstrApp.isCloudPro){rrOpenHomePage&&rrOpenHomePage();}else{mstrmojo.form.send({evt:"3010"},mstrApp.name,"POST",null,null,false);}break;case L:mstrmojo.qb.alert(f[w],u,j,null,q);break;default:if(u){mstrmojo.qb.alert(n,u,j,null,q);}else{l=t.responseText;l=l&&l.match(/\[HttpException \(0x80004005\): (.)+\]/);mstrmojo.qb.alert(n,(l&&l[0]&&l[0].replace(/\[HttpException \(0x80004005\): |\]/gi,""))||mstrmojo.desc(5781,"Request timed out."),j,null,q);}break;}mstrmojo.all.WaitBoxTip&&mstrmojo.all.WaitBoxTip.closeWait();mstrmojo.all.waitBoxTipForAvailableTablesTree&&mstrmojo.all.waitBoxTipForAvailableTablesTree.closeWait();}function U(j){if(!!j&&j.taskId==="saveAndPublishCube"){if(!!j.msgID&&!!j.msgid){delete j.msgid;}}}mstrmojo.qb.QBApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{scriptClass:"mstrmojo.qb.QBApp",isQB:true,enableWaitBox:true,getWaitBoxPosition:function(){var k=mstrApp.container;var l={};if(!F.getEnvObj().isAppSchema()){if(k&&k.domNode){var j=mstrmojo.dom.position(k.domNode,true);if(j){l={top:j.y};}}else{if(this.rootController&&this.rootController.rootView&&this.rootController.rootView.titleContainerNode){var o=mstrmojo.dom.position(this.rootController.rootView.titleContainerNode,true);if(o&&o.h!==0&&o.y!==0){l.top=o.h+o.y;}}}}else{if(k&&k.parent&&k.parent.domNode){var n=mstrmojo.dom.position(k.parent.domNode),m=48;if(n){l={top:n.y+n.h/2-m/2};}}}return l;},init:function Z(j){this._super(j);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:function E(t,l){var p,k=mstrmojo.qb.EnumQBAppType,u,q,o=mstrmojo.hash.clone(l),n,j=C.backendSourceSubtype,m=false;switch(parseInt(t,10)){case k.BigQuery:mstrApp.isBigQuery=true;u=mstrApp.isFFSQL?C.xdaType.googleBigQueryFFSQL:C.xdaType.googleBigQuery;n=j.googleBigQuery;this.dbroleID=mstrApp.dbrid;p=this.rootController=new mstrmojo.qb.bigquery.RootController();p.dataService=mstrmojo.qb.DataService;o.id="QBuilderModel";p.model=new mstrmojo.qb.bigquery.Model(o);p.rootView=new mstrmojo.qb.bigquery.BigQueryBuilderPage({placeholder:this.placeholder});break;case k.BigQueryFFSQL:mstrApp.isBigQuery=true;u=mstrApp.isFFSQL?C.xdaType.googleBigQueryFFSQL:C.xdaType.googleBigQuery;n=j.googleBigQueryFFSQLModel;this.dbroleID=mstrApp.dbrid;p=this.rootController=mstrmojo.insert({scriptClass:l.rootControllerCls||"mstrmojo.qb.bigquery.RootController"});p.dataService=mstrmojo.qb.DataService;o.id="QBuilderModel";p.model=new mstrmojo.qb.bigquery.Model(o);p.rootView=new mstrmojo.qb.bigquery.BigQueryBuilderPage({placeholder:this.placeholder});break;case k.BigQuerySingleTable:mstrApp.isBigQuery=true;u=345;this.dbroleID=mstrApp.dbrid;p=this.rootController=mstrmojo.insert({scriptClass:l.rootControllerCls||"mstrmojo.qb.bigquery.ESController"});p.dataService=mstrmojo.qb.es.DataService;p.model=new mstrmojo.qb.bigquery.ESModel(o);p.rootView=new mstrmojo.qb.bigquery.ESRootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case k.EmmaSingleTable:p=this.rootController=mstrmojo.insert({scriptClass:l.rootControllerCls||"mstrmojo.qb.es.Controller"});p.dataService=mstrmojo.qb.es.DataService;if(o.hasOwnProperty("emmaSingleIsForAlternateSource")){o.isForAlternateSource=o.emmaSingleIsForAlternateSource;delete o.emmaSingleIsForAlternateSource;}p.model=new mstrmojo.qb.es.Model(o);q={placeholder:this.placeholder};if(o.hasOwnProperty("emmaSingleAlertCfg")){q.alertCfg=o.emmaSingleAlertCfg;}p.rootView=new mstrmojo.qb.es.RootView(q);this.msgid=this.msgID;m=true;break;case k.MDX:p=this.rootController=new mstrmojo.qb.mdx.Controller();p.dataService=mstrmojo.qb.mdx.DataService;delete o.dbObjectsDisplayOptions;p.model=new mstrmojo.qb.mdx.Model(o);p.rootView=new mstrmojo.qb.mdx.RootView({placeholder:this.placeholder});this.msgid=this.msgID;break;case k.BISource:mstrApp.isBISource=true;u=mstrApp.isFFSQL?304:352;p=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.Controller"});p.dataService=mstrmojo.qb.DataService;p.model=new mstrmojo.qb.thirdParty.Model(o);p.rootView=new mstrmojo.qb.thirdParty.RootView({placeholder:this.placeholder});break;default:u=mstrApp.isFFSQL?304:352;n=mstrApp.isFFSQL?j.customSQL:j.customSQLWizard;if(mstrApp.isEMMACube){p=this.rootController=mstrmojo.insert({scriptClass:l.rootControllerCls||"mstrmojo.qb.EmmaController"});p.dataService=mstrmojo.qb.DataService;o.canSupportDDA=mstrApp.canSupportDDA;o.shouldSupportDDA=mstrApp.shouldSupportDDA;o.dbridForDDA=mstrApp.dbridForDDA;o.isDDA=mstrApp.isDDA;o.ddaCheckboxID=mstrApp.ddaCheckboxID;p.model=new mstrmojo.qb.EmmaModel(o);p.model.set("id","QBuilderModel");m=true;}else{p=this.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.RootController"});p.dataService=mstrmojo.qb.DataService;p.model=new mstrmojo.qb.QBuilderModel({id:"QBuilderModel"});}p.rootView=new mstrmojo.qb.QBuilderPage({placeholder:this.placeholder});break;}if(!m){p.model.dbObjects.populateDBProperties({});}p.rootView.inPageDialog=!!l.inPageDialog;p.start(u,n);},getRootController:function Y(j){var k=X.walk("container.launchingApp",mstrApp)||mstrApp.launchingApp;if(k&&(k.placeholder==="DIApp"||k.placeholder==="mainDIApp")&&j==="DI"){return k.getRootController();}return this.rootController;},hideProgress:function P(k){var l=mstrmojo.all.progressBar,j={manually:!!k};if(l){l.close(j);}},redirectToPage:function d(j){this.showWait();mstrmojo.form.send(j,mstrApp.name,"POST",null,null,false);},serverResponse:function M(n,k,l,j,m){mstrmojo.all[n][k](l,!!j,m);},serverRequest:function V(o,u,n,p,w,j,q,t){var m={},k;if(!o.sessionState&&this.sessionState){o.sessionState=this.sessionState;}o.msgid=j||mstrApp.msgid;U(o);if(typeof n==="object"){mstrmojo.hash.copy(n,m);}m.hideFailureErr=true;if(!p){k=u.failure;u.failure=function l(x){c(x,k,q);};}m.waitBoxCfg=t||{showCancel:false};m.waitBoxCfg.position=this.getWaitBoxPosition();m.waitBoxCfg.message=w;m.silent=!n;this._super(o,u,m);},serverRequestQueue:function W(l,m,j){if(F.getEnvObj().isWS()){this.serverRequestParallelNative(l,m,j);}else{var k=j||new mstrmojo.SimpleXHR();k.request("POST",mstrConfig.taskURL,{success:function(n){if(m.success){m.success(n);}},failure:function(n){if(m.failure){m.failure({code:n.getResponseHeader("X-MSTR-TaskErrorCode"),message:n.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(m.complete){m.complete();}}},l);}},serverRequestParallel:function I(l,q,k,m,t,j,n){if(k===true){this.showWait(t);}if(!l.sessionState&&this.sessionState){l.sessionState=this.sessionState;}l.msgid=j||mstrApp.msgid;try{var p=this;window.setTimeout(function(){var x=q.failure;q.failure=function w(AA){c(AA,x,n);};var z=mstrmojo.func.wrapMethods(q,{complete:function u(){if(k){p.hideWait();}}});window.setTimeout(p.serverProxy.serverRequestParallel.bind(p.serverProxy,l,{success:function(AA){if(z.success){z.success(AA);}},failure:function(AA){if(z.failure){z.failure(AA);}},complete:function(){if(z.complete){z.complete();}}},p.xhrQueue),0);},0);}catch(o){mstrmojo.err(o);}},showProgress:function S(j){if(!j){j={message:mstrmojo.desc(5720,"Waiting...")};}if(j.showCancel===undefined){j.showCancel=false;}if(j.showProgressText&&j.progressText){j.message=j.progressText;}this.showWait(j);},getSearchAutoCompleteDelay:mstrmojo.emptyFn,executeCommand:function b(j,l){var k=this.container&&this.container.launchingApp;if(k){return k.executeCommand(j,l);}}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBApp","mstrmojo.Container","mstrmojo.DI.DIHelpers","mstrmojo.hash");var B=mstrmojo.css,A=mstrmojo.DI.DIHelpers,F=mstrmojo.DI.DIConstants;mstrmojo.qb.QBContainer=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.QBContainer",markupString:'<div id="QBContainer"><div id="QBApp"></div></div>',launchingApp:null,init:function D(G){if(this._super){this._super(G);}this.QBParams={placeholder:"QBApp",Privs:'<uaps><pris pgd="67070C7C481676FC38A28595E71ED85D"><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-1</pri><pri>-2130706433</pri></pris></uaps>',msgID:"",type:"368",reportID:"",folderID:"",docID:"",isFFSQL:"",isCloud:false,saveAsCube:"",analysisID:"",isNewAnalysis:"",isEMMACube:true,FlashResBundleURL:"../resBundles/DashboardViewerBundle_1033.xml",name:"mstrWeb",pageName:"qbuilder",helpUrl:"",helpTopics:{mainDB:"database_import_page.htm",mainSQL:"freeform_import_page.htm",tableJoin:"join_options_dialog_box.htm",filterValue:"Enter_Value_dialog_box.htm",expression:"expression_dialog_box.htm",condition:"new_condition_dialog_box.htm"},localeId:mstrApp.localeId,displayLocaleId:"1033",jsRoot:"../javascript/",jsMojoRoot:"../javascript/mojo/js/source/",persistTaskParams:{},getPersistParams:function(){return this.persistTaskParams;},isOIVM:function(){return true;},isTouchApp:function(){return false;}};},loadQB:function C(){var G=this.QBParams;if(G.shouldSupportDDA&&!G.canSupportDDA){return ;}this.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrmojo.hash.copy(G,mstrApp);mstrApp.sessionState=this.launchingApp.sessionState;mstrApp.msgID=mstrApp.messageID;mstrApp.docID=mstrApp.messageID;mstrApp.xhrQueue=this.launchingApp.xhrQueue;mstrApp.isSingleTier=this.launchingApp.isSingleTier;mstrApp.diParams=this.launchingApp.diParams;mstrApp.serverProxy=this.launchingApp.serverProxy;mstrApp.features=this.launchingApp.features;mstrApp.DIEmbeded=this.launchingApp.DIEmbeded;delete mstrApp.messageID;mstrApp.container=this;G.dbTypes=this.launchingApp.dbTypes;G.dbObjects=this.launchingApp.supportDBObjects;G.dbIds=this.launchingApp.dbIds;G.dbVersions=this.launchingApp.dbVersions;if(this.launchingApp.dbObjectsDisplayOptions){G.dbObjectsDisplayOptions=this.launchingApp.dbObjectsDisplayOptions;if(this.launchingApp.dbObjectsDisplayOptions===16){G.dbRolesVersionExcludeFilter=this.launchingApp.dbRolesVersionExcludeFilter;}}G.hasNonRADataset=this.launchingApp.diParams&&this.launchingApp.diParams.hasNonRADataset;G.inPageDialog=this.launchingApp.getRootController().rootView.inPageDialog;delete this.launchingApp.dbTypes;delete this.launchingApp.supportDBObjects;delete this.launchingApp.dbIds;delete this.launchingApp.dbVersions;delete this.launchingApp.dbObjectsDisplayOptions;this.domNode.style.display="block";mstrApp.sessionManager=this.launchingApp.sessionManager;mstrApp.enableAutomaticSessionRecovery=this.launchingApp.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=this.launchingApp.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=this.launchingApp.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=this.launchingApp.enableWarningSessionTimeout;mstrApp.projectName=this.launchingApp.projectName;mstrApp.serverName=this.launchingApp.serverName;mstrApp.serverPort=this.launchingApp.serverPort;mstrApp.authMode=this.launchingApp.authMode;mstrApp.name=this.launchingApp.name;mstrApp.persistTaskParams=this.launchingApp.persistTaskParams;mstrApp.helpUrl=this.launchingApp.helpUrl;mstrApp.userHelpPage=this.launchingApp.userHelpPage;mstrApp.autocomplete=this.launchingApp.autocomplete;mstrApp.isPopup=this.launchingApp.isPopup;mstrApp.isWorkstation=this.launchingApp.isWorkstation;mstrApp.isFromVI=this.launchingApp.isFromVI;mstrApp.taskQueue=this.launchingApp.taskQueue;var H=mstrApp.size;if(A.isServerBasedWS()){mstrApp.size=mstrmojo.dom.windowDim();}if(this.parent&&this.parent.alias==="selectAlternateSourceEditor"){mstrApp.size=H;}if(this.launchingApp.cubeSaveFolderId){mstrApp.cubeSaveFolderId=this.launchingApp.cubeSaveFolderId;}mstrApp.dbRoles=this.launchingApp.dbRoles;if(F.xdaType.qbSingleTable===mstrApp.type||F.xdaType.googleBigQuerySingleTable===mstrApp.type){if(this.domNode){B.addClass(this.domNode,"qb-select-table");}}mstrApp.start(mstrApp.type,G);},unloadQB:function E(){var G=mstrApp.getRootController();var J=G.rootView;var H=G.model;if(H){H.destroy();}if(J){J.destroy();}G.destroy();var I=window.mstrApp;window.mstrApp=this.launchingApp;mstrApp.size=I.size;I.destroy();this.domNode.style.display="none";this.destroy();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.hash","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.DI.DIHadoopModel","mstrmojo.DI.DIHelpers","mstrmojo.DI.controller.DIHadoopWHController","mstrmojo.warehouse.obj.DBRole","mstrmojo.qb.DataService");mstrmojo.requiresDescs(12773,12774,12815,12816,12817,14950,14951,16148);var G=mstrmojo.array;var C=mstrmojo.hash;var A=mstrmojo.DI.DIHelpers;var K=mstrmojo.warehouse.EnumDatabaseType;var B="AFAD9E7E8D7E4DA0AEED8FD5AADFC99C",I=";MSTR_CUSTOM=true;";function J(O){var L=O.mi.ftree.fl;var N=0,P,M;if(L!==undefined){for(M=0;M<L.length;M++){P=L[M];N+=P.sz;}}return N;}mstrmojo.DI.controller.DIHadoopController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopController",dbRoleID:B,hadoopConnURL:"",dbRole:"",saveDBRole:function H(O,N){var M=mstrApp.getRootController(),P=this;N.set("visible",false);N.close();M.getDataService().saveDBRole({success:function Q(R){P.dbRoleID=R.dbr.did;P.hadoopConnURL=mstrmojo.DI.DIHadoopModel.prototype.populateURLPath(O);M.model.raiseEvent({name:"HadoopDBRoleSaved"});},fail:function L(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(O)});},loadBDEDBRole:function(R){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return ;}var Q=this,M=new mstrmojo.DI.DIHadoopDBRole(),L=mstrApp.getRootController(),N=L.getModel(),O=N&&N.getImportSource(R),P=C.walk("sourceInfo.dbRoleId",O);L=mstrApp.getRootController();M.mdDBRole.did=B;M.populate(function(U){var S=U.mdDBRole.connstr;function V(){if(S===""||S===I){Q.renderDBRoleEditor(M);Q.dbRoleID=B;Q.dbRole=M;}else{G.forEach(S.split(";"),function(X){var W=X.split("=");U[W[0].trim().toLowerCase()]=W[1];});Q.hadoopConnURL=mstrmojo.DI.DIHadoopModel.prototype.populateURLPath(U);Q.dbRoleID=B;Q.dbRole=M;L.model.raiseEvent({name:"BDEDBRoleLoaded"});}}if(P&&P!==B){mstrmojo.warn(mstrmojo.desc(16148,"The current being used Hadoop Gateway connection is out of date and click OK to use the upgraded connection to browse Hadoop HDFS. The original connection info will be overridden once the dataset is updated."),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){V();}},cancelBtn:{cfg:{visible:false}}});}else{V();}});},populateDBRole:function F(M,N){var L=mstrApp.getRootController();L.model.populateDBRole(M,N);},doRenderDBRoleEditor:function(W,V){var Q=this;var L=mstrApp.getRootController();var P=L.getHadoopGatewayController();var R=L.dialogController.getNextZIndex();var O,S=!mstrApp.isSingleTier&&mstrApp.isWorkstation&&!mstrApp.isPopup;this.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrApp.sessionState=this.launchingApp.sessionState;mstrApp.msgID=mstrApp.messageID;mstrApp.docID=mstrApp.messageID;mstrApp.placeholder="QBApp";mstrApp.isSingleTier=this.launchingApp.isSingleTier;mstrApp.diParams=this.launchingApp.diParams;mstrApp.isWorkstation=this.launchingApp.isWorkstation;mstrApp.serverProxy=this.launchingApp.serverProxy;mstrApp.isPopup=this.launchingApp.isPopup;delete mstrApp.messageID;delete this.launchingApp.dbType;delete this.launchingApp.supportDBObjects;mstrApp.sessionManager=this.launchingApp.sessionManager;mstrApp.enableAutomaticSessionRecovery=this.launchingApp.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=this.launchingApp.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=this.launchingApp.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=this.launchingApp.enableWarningSessionTimeout;mstrApp.projectName=this.launchingApp.projectName;mstrApp.serverName=this.launchingApp.serverName;mstrApp.serverPort=this.launchingApp.serverPort;mstrApp.authMode=this.launchingApp.authMode;mstrApp.name=this.launchingApp.name;mstrApp.persistTaskParams=this.launchingApp.persistTaskParams;mstrApp.hideProgress=this.launchingApp.hideProgress;mstrApp.taskQueue=this.launchingApp.taskQueue;mstrApp.diRootCtrl=L;var N=mstrApp.rootController=new mstrmojo.DI.controller.DIHadoopWHController();N.showDialog=function(Y,X){L.showDialog(Y,X);};N.getHadoopGatewayController=function(){return P;};N.getHadoopController=function(){return Q;};N.dataService=mstrmojo.qb.DataService;var M=N.model=new mstrmojo.DI.DIHadoopModel();M.dbRoleEditorCfg={hideLogin:true,hidePwd:true,hideShareLink:true,hideShareConnection:true,showShareLink:!!W,hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[42]};M.loadDBObjects({success:function U(){var X=new mstrmojo.warehouse.dbroles.DBRoleEditor({zIndex:R,cssClass:A.getEnvObj().isWS()?"mstrmojo-rootview-hadoop mstrmojo-wh-DBRoleEditor":"mstrmojo-wh-DBRoleEditor",scrollable:S,isHadoopGateWay:true});X.config=M.dbRoleEditorCfg;X.callback={close:function(){if(mstrmojo.all.QBuilderModel){mstrmojo.all.QBuilderModel.destroy();}if(mstrmojo.all.QBuilderPage){mstrmojo.all.QBuilderPage.destroy();}mstrApp.getRootController().destroy();var c=window.mstrApp;window.mstrApp=Q.launchingApp;mstrApp.sessionState=c.sessionState;mstrApp.msgID=c.messageID;mstrApp.docID=c.messageID;if(c.dbRoleID){mstrApp.getRootController().hadoopController.dbRoleID=c.dbRoleID;mstrApp.getRootController().hadoopController.hadoopConnURL=c.hadoopConnURL;mstrApp.getRootController().model.raiseEvent({name:"HadoopDBRoleSaved"});}c.destroy();}};if(!W){W=new mstrmojo.warehouse.obj.DBRole({mdl:M});}X.listOptions={};O=X.listOptions[14956]=[];G.forEach(V,function(c){O.push({v:c.hgosName,data:c});});if(!O.length){O.push({v:""});}X.labelClickFn={};X.labelClickFn[14906]=function(){P.showGatewayListDialog();};if(V){for(var a=0;a<V.length;a++){var Z=V[a];var b=V[a].config.hostAddr;var Y=V[a].config.tcpPort;if(V[a].config.hostAddr==W.BDEIP&&V[a].config.tcpPort==W.BDEPORT){X.oldIndex=a;if(V[a].config.sparkConfig.props){X.AuthMode=V[a].config.sparkConfig.props.AuthMode;}else{X.AuthMode=0;}break;}}}X.dbrole=W;X.disableTest=true;X.open();Q.dbrEditor=X;}});},updateDBRoleEditor:function(){var L=mstrApp.getRootController(),O=this.dbrEditor;var P=O.children[0].children[2].children[4].dbp_hg.children[1];var N=P.selectedIndex;var M=[];L.getHadoopGatewayController().listGateways({success:function(S){var R=S&&S[0].entity;var Q=[];G.forEach(R,function(U){Q.push({v:U.hgosName,data:U,n:U.hgosName});});if(!Q.length){Q.push({v:""});}P.set("items",Q);P.set("selectedIndex",N);},failure:function(){}});},renderDBRoleEditor:function(L){this.doRenderDBRoleEditor(L);},hadoopBrowserFunction:function(L){this.browseHadoop(L.data.address,L.data.browser,L);},browseHadoop:function D(O,P,Q){var M=mstrApp.getRootController(),R={},L=P,N=Q;if(O===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(O.substring(0,1)==="\\"){O=O.replace(/\\\\/g,"file://");O=O.replace(/\\/g,"/");}R.urlPath=O;R.dbRoleID=this.dbRoleID;var S={success:function(U){if(U.mi.ftree===""){L.set("fileList",[]);}L.set("fileList",M.parseURLFolders(U));if(N){N.data.isMouseOver=true;if(U.mi.ftree===""){N.totalSize=0;}else{var V=U.mi.ftree.fl;if(V){N.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(U));}else{N.totalSize="---";}}}},failure:function(U){L.set("fileList",[]);M.displayError(mstrmojo.desc(12816,"Uh-Oh, Error fetching the list of files for the given network path: ####").replace("####",U.message),false);}};M.dataService.getOAuthSourceReports(S,R);},browseHadoopForFolderSize:function E(N,R){var M=mstrApp.getRootController(),P={},O=R,L=R.tree.parent;if(N===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(N.substring(0,1)==="\\"){N=N.replace(/\\\\/g,"file://");N=N.replace(/\\/g,"/");}P.urlPath=N;P.dbRoleID=this.dbRoleID;var Q={success:function(S){if(S.mi.ftree===""){O.totalSize=0;}else{var U=S.mi.ftree.fl;if(U){O.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(S));}else{O.totalSize="---";}}L.setFileListForNode(M.parseURLFolders(S),R);O.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:O.textNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:-5,content:mstrmojo.desc(12817,"Name: #### Size: @@@@").replace("####",O.text).replace("@@@@",O.totalSize)});},failure:function(){}};M.dataService.getHadoopFolderSize(Q,P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(212,373,946,1143,1902,2102,12668,12726,12727,12315,14512,14821,1281,14822,14823,12666,15614);var U=mstrmojo.css,E=mstrmojo.dom,M=mstrmojo.hash,W=mstrmojo.DI.DIConstants,A="inline-block",L=W.mainPage.GRID_MODE,J=W.mainPage.LIST_MODE;var F={LEFT:1,RIGHT:2,GRID:3,LIST:4,LIVE:5,EDIT:6,FILTER:7,SEARCH:8,OBJECTS:9,WRANGLE:10};function C(){if(window.mstrAppSchema){return false;}var Y=mstrApp.getRootController().model;if(mstrApp.showDDAOptions===false){return false;}if(mstrApp.diParams.ImportDatabase===0){return false;}if(Y.currentDataset){return false;}var Z=0,a,X=Y.importSources;for(a in X){if(X.hasOwnProperty(a)){Z++;}}return Z<1;}function K(){var X=mstrApp.getRootController(),Y=X.getModel(),Z=!Y.isDirectDataAccess;X.getDDAController().setDirectDataAccess(Z);}function G(Z,b,a){var X=mstrApp.getRootController(),c=X.rootView,Y=c.currentPage;switch(b){case F.LEFT:X.onBackButtonClick();break;case F.RIGHT:X.onNextButtonClick();break;case F.GRID:c.setSourceListMode(L);break;case F.LIST:c.setSourceListMode(J);break;case F.LIVE:K.call(Z);break;case F.EDIT:X.showPage(W.pageType.sourceAdmin);break;case F.SEARCH:c.setSearchPattern(a);break;case F.FILTER:if(Y.pageType===W.pageType.dataSelection){Y.showEditorConfig({hostId:Y.id,hostElement:Z.domNode});}break;case F.OBJECTS:X.allObjectsController.showAllObjects();break;case F.WRANGLE:X.launchWrangleForTable();break;default:break;}}function D(X){var Y=E.position(X.domNode);X.set("richTooltip",{cssClass:"vi-regular vi-tooltip-A root-toolbar-tooltip",top:Math.max(Y.y+Y.h+5,0),left:Y.x+2,posType:mstrmojo.tooltip.POS_TOPLEFT,content:X.title});}var O={scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-close",alias:"closeBtn",title:mstrmojo.desc(2102,"Close"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){D(this);},onclick:function(){this._ontooltipout();mstrApp.getRootController().onCancelButtonClick();},premousedown:function(){U.toggleClass(this.domNode,"hit",true);},premouseup:function(){U.toggleClass(this.domNode,"hit",false);}};function S(){this.set("visible",false);this.set("cssText","");return[M.copy(O,{visible:this.showCloseBtn})];}function N(){this.set("visible",true);this.set("cssText","");return[{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item btn grid",alias:"gridBtn",cssDisplay:A,title:mstrmojo.desc(14821,"Icon View"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){D(this);},onclick:function(){G(this,F.GRID);},visible:false},{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item btn list",alias:"listBtn",cssDisplay:A,title:mstrmojo.desc(946,"List View"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){D(this);},onclick:function(){G(this,F.LIST);},visible:false},{scriptClass:"mstrmojo.Button",bindings:{cssClass:function(){var Y=mstrApp.getRootController(),Z=Y.getModel(),a=Z.isDirectDataAccess;if(a){return"toolbar-item btn dda on";}else{return"toolbar-item btn dda";}},visible:function(){return C();}},alias:"liveBtn",cssDisplay:A,title:mstrmojo.desc(14822,"Live Connect Only"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.title=!!mstrApp.getRootController().model.isDirectDataAccess?mstrmojo.desc(15614,"All connectors"):mstrmojo.desc(14822,"Live Connect Only");D(this);},onclick:function(){G(this,F.LIVE);}},{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item btn admin",cssDisplay:A,title:mstrmojo.desc(14823,"Customize Shortcuts"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){D(this);},onclick:function(){this.hideTooltip();G(this,F.EDIT);}},M.copy(O,{visible:this.showCloseBtn}),{scriptClass:"mstrmojo.ui.SearchBox",cssClass:"toolbar-item searchBox",cssDisplay:A,searchDelay:600,alias:"searchSource",searchTriggered:function(Y){G(this,F.SEARCH,Y);},postBuildRendering:function X(){if(this._super){this._super();}this.inputNode.setAttribute("placeholder",mstrmojo.desc(12666,"Search..."));}},{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item btn advSearch",alias:"filter",cssDisplay:A,title:mstrmojo.desc(1281,"Filter"),tooltipOpenDelay:0,useRichTooltip:true,visible:true,updateTooltipConfig:function(){D(this);},onclick:function(){G(this,F.FILTER);}}];}function V(g){var j="aggEditor",d=j&&window.mstrmojo&&mstrmojo.all[j],a,f=mstrApp.getRootController().getDialogController().getNextZIndex(),c=mstrApp.getRootController().dataService.messageID,e,h,Z,b,Y,X=function X(){var l=window.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();window.mstrApp.isWorkstation=l.isWorkstation;mstrApp.sessionState=l.sessionState;mstrApp.msgid=c;mstrApp.isSingleTier=l.isSingleTier;mstrApp.serverProxy=l.serverProxy;mstrApp.sessionManager=l.sessionManager;mstrApp.enableAutomaticSessionRecovery=l.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=l.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=l.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=l.enableWarningSessionTimeout;mstrApp.projectName=l.projectName;mstrApp.serverName=l.serverName;mstrApp.serverPort=l.serverPort;mstrApp.authMode=l.authMode;mstrApp.name=l.name;mstrApp.persistTaskParams=l.persistTaskParams;mstrApp.helpUrl=l.helpUrl;mstrApp.userHelpPage=l.userHelpPage;mstrApp.autocomplete=l.autocomplete;mstrApp.localeId=(l.helpLocaleId||l.localeId);a=mstrApp.rootController=mstrmojo.insert({scriptClass:"mstrmojo.qb.EmmaController"});a.dataService=mstrmojo.qb.DataService;a.model=new mstrmojo.qb.EmmaModel({tableID:e});a.model.set("id","QBuilderModel");a.isBDE=true;if(!d){d=mstrmojo.insert({id:j,scriptClass:"mstrmojo.DI.ui.dialogs.DIAggregationDialog",onClose:function k(){var m=window.mstrApp;c=mstrApp.msgid;window.mstrApp=window.launchingApp;a.model.destroy();a.destroy();m.destroy();mstrApp.getRootController().dataService.messageID=c;if(d.fromAggregation){d.opener.parent.parent.currentPage.parent.fromAggregation=true;mstrApp.getRootController().getImportedDataEMMA(W.actions.refreshData,W.requestFlag.mapping|W.requestFlag.sourceInfo|W.requestFlag.relationship|W.requestFlag.preview,null,null,e);}}});}d.hasAggFilter=b;a.rootView=d;a.zIndex=f;d.model=a.model;d.tableID=e;d.controller=a;d.open(g,{zIndex:f});};h=mstrApp.getRootController().model.currentSource;e=h.tableID;Y=h.sourceInfo;Z=Y.isRefined;b=Y.hasAggFilter;if(Z){mstrmojo.confirm(mstrmojo.desc(12717,"Previous changes made in wrangle will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){mstrApp.getRootController().dataService.cancelRefineStage({success:function k(m){c=m.msgid;mstrApp.getRootController().dataService.set("messageID",c);var n=mstrApp.getRootController().model.currentSource;delete n.projectID;var l=W.requestFlag.mapping|W.requestFlag.sourceInfo|W.requestFlag.relationship|W.requestFlag.preview|W.requestFlag.transformations;mstrApp.getRootController().editImportedDataEMMA(l,null,null,null,n.tableID,null,null,null,null,true,{success:X.bind(d)});}},{did:e,automap:1,dbr:Y.dbRoleId,shtIx:Y.sheetIndex?Y.sheetIndex:""});}}});}else{X();}}function H(){this.set("visible",true);this.set("cssText","background-color:#fafafa");return[{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item  mtdi-preview objects",cssDisplay:A,text:mstrmojo.desc(12668,"All Objects View"),onclick:function(){G(this,F.OBJECTS);}},{scriptClass:"mstrmojo.Button",alias:"wrangleBtn",cssClass:"toolbar-item mtdi-preview wrangle",cssDisplay:A,text:mstrmojo.desc(12315,"Wrangle"),onclick:function(){G(this,F.WRANGLE);},postCreate:function X(){var Y=mstrApp.getRootController().model;Y.attachEventListener("SourceInfoFetched",this.id,"update");Y.attachEventListener("CurrentSourceChanged",this.id,"update");},update:function(){var Y=mstrmojo.all.DIModel;var Z=Y.currentSource;if(Z){this.set("visible",Z.canRefine());}}},{scriptClass:"mstrmojo.Button",cssClass:"toolbar-item mtdi-preview aggregation",cssDisplay:A,postCreate:function(){this.model=mstrmojo.all.DIModel;this.model.attachEventListener("CurrentSourceChanged",this.id,"makeVisible");this.makeVisible();},makeVisible:function(){var Y=mstrmojo.all.DIModel;var Z=Y.currentSource;var a=false;if(Z&&Z.type===W.sourceType.hadoop&&Z.subtype===W.sourceSubtype.hadoop){a=true;}this.set("visible",a);},text:mstrmojo.desc(15255,"Aggregation"),onclick:function(){V(this);}},M.copy(O,{visible:this.showCloseBtn}),{scriptClass:"mstrmojo.DI.DISearchTableBox",alias:"searchTable",cssDisplay:A}];}mstrmojo.DI.DIToolbar=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.DI.DIToolbar",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-DI-DIToolbar {@cssClass}" style="{@cssText}"></div>',titleText:"",subtitleText:"",showCloseBtn:false,pageType:null,ontitleTextChange:function(){if(window.FormWrapper.setTitle&&!mstrApp.isPopup){window.FormWrapper.setTitle(this.titleText);}},onsubtitleTextChange:function(){},preBuildRendering:function B(){var X=mstrApp.getRootController(),Y=X.getModel(),Z=this.parent;if(this._super){this._super();}Z.attachEventListener("preShowRootViewPage",this.id,"onpreShowRootViewPage");Y.attachEventListener("isDirectDataAccessChange",this.id,"onisDirectDataAccessChange");Y.attachEventListener("CurrentSourceChanged",this.id,"onCurrentSourceChanged");Y.attachEventListener("sourceListModeChange",this.id,"onSourceListModeChange");},onpreShowRootViewPage:function I(X){var Y=X.pageType;var Z;this.pageType=Y;switch(Y){case W.pageType.dataSelection:Z=N.call(this);break;case W.pageType.emmaPreview:Z=H.call(this);break;case W.pageType.suggestNewSource:case W.pageType.sourceIntro:return ;default:Z=S.call(this);break;}U.toggleClass(this.domNode,"grey",Y===W.pageType.emmaPreview);this.removeChildren();this.addChildren(Z);},onSourceListModeChange:function Q(X){var Y=X&&X.mode;if(this.hasRendered&&this.pageType===W.pageType.dataSelection){U.toggleClass(this.gridBtn.domNode,"on",Y===L);U.toggleClass(this.listBtn.domNode,"on",Y===J);}},onisDirectDataAccessChange:function R(X){var Y=X.value;if(this.hasRendered&&this.pageType===W.pageType.dataSelection){U.toggleClass(this.liveBtn.domNode,"on",Y);}},onCurrentSourceChanged:function P(){var X=mstrApp.getRootController().getModel();var Y=X.currentSource;var Z=false;if(this.hasRendered&&this.pageType===W.pageType.emmaPreview){if(Y){Z=Y.canRefine();}this.wrangleBtn.set("visible",Z);}}});}());(function(){mstrmojo.requiresCls("mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.DI.DIFooter","mstrmojo.DI.DIFileUpload","mstrmojo.DI.DIURLUpload","mstrmojo.DI.DISampleFiles","mstrmojo.DI.DIPreview","mstrmojo.DI.DIExitOptions","mstrmojo.DI.DISourceList","mstrmojo.DI.DICubesList","mstrmojo.DI.DISourceIntro","mstrmojo.DI.DIDatabaseIntro","mstrmojo.DI.ProgressPolyfill","mstrmojo.DI.DISourceObjects","mstrmojo.DI.DISourceObjectsGA","mstrmojo.DI.DIDataset","mstrmojo.DI.DIMappingPage","mstrmojo.DI.TableSources","mstrmojo.DI.DIClipboard","mstrmojo.DI.DIPublicData","mstrmojo.qb.QBContainer","mstrmojo.DI.DIHadoop","mstrmojo.DI.DITwitterPage","mstrmojo.DI.DIFacebookPage","mstrmojo.DI.DISourceObjectsDnD","mstrmojo.ui.SearchablePulldown","mstrmojo.DI.DIRemoteProjects","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIWorkstationHelpers","mstrmojo.css","mstrmojo.DI.DISourceListAdmin","mstrmojo.DI.DISearchTableBox","mstrmojo.DI.DIToolbar","mstrmojo.hash");mstrmojo.requiresDescs(118,172,531,773,1059,1143,1302,3389,7972,10236,10766,11677,12446,12479,12480,12484,12490,12715,12716,12721,12722,12723,12752,12805,12806,13152,13308,13466,13467,13468,13469,13612,13781,13852,13978,14512,14791,4381,14825,14826,12444,12712,14907,14908,15350,15351,15352,15353);var S=mstrmojo.Widget,U=mstrmojo.dom,AQ=mstrmojo.DI.DIHelpers,k=mstrmojo.hash,AF=mstrmojo.DI.DIConstants,z=mstrmojo.DI.DIWorkstationHelpers,c=AF.pageType,AL=AF.operationMode,x=mstrmojo.array,E=mstrmojo.css,h=AF.mainPage.GRID_MODE,K=AF.mainPage.LIST_MODE;var M=[c.dataSelection,c.sourceAdmin,c.emmaPreview];var a={scriptClass:"mstrmojo.DI.DIRemoteProjects",alias:"allProjectPage",pageType:c.allProjectSource,slot:"layoutNode"};var p={scriptClass:"mstrmojo.DI.DIHadoop",alias:"hadoopPage",pageType:c.hadoop,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var Z={scriptClass:"mstrmojo.DI.DIMstrUpload",alias:"mstrFileUpload",slot:"layoutNode"};var C={scriptClass:"mstrmojo.DI.DIFileUpload",pageType:c.file,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var V={scriptClass:"mstrmojo.DI.DIURLUpload",pageType:c.file,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var AJ={scriptClass:"mstrmojo.DI.DIClipboard",alias:"clipboardPage",cssClassLabel:"mstrmojo-clipboard-label",pageType:c.clipboard,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var j={scriptClass:"mstrmojo.DI.DIPublicData",pageType:c.publicData,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var L={scriptClass:"mstrmojo.DI.DIDatabaseIntro",pageType:c.database,slot:"layoutNode",size:{w:"1328px",h:"636px"}};var l={scriptClass:"mstrmojo.qb.QBContainer",pageType:c.database,slot:"layoutNode",size:{w:"1328px",h:"636px"}};var e={scriptClass:"mstrmojo.DI.DIDataset",pageType:c.dataset,slot:"layoutNode"};var AM={scriptClass:"mstrmojo.DI.DISampleFiles",pageType:c.sampleFiles,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var Y={scriptClass:"mstrmojo.DI.DISourceList",alias:"sourceList",pageType:c.dataSelection,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var X={scriptClass:"mstrmojo.DI.DISourceObjects",pageType:c.sourceObjects,slot:"layoutNode"};var D={scriptClass:"mstrmojo.DI.DISourceObjectsDnD",pageType:c.sourceObjectsDnD,slot:"layoutNode",size:{h:"556px",w:"1010px"}};var AG={scriptClass:"mstrmojo.DI.DISourceObjectsGA",alias:"sourceObjectsPage",pageType:c.sourceObjects,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var m={scriptClass:"mstrmojo.Box",alias:"emptyPage",slot:"layoutNode",size:{h:"557px",w:"1010px"}};var q={scriptClass:"mstrmojo.DI.DIPreview",pageType:c.preview,slot:"layoutNode"};var R={scriptClass:"mstrmojo.DI.DIMappingPage",pageType:c.emmaPreview,slot:"layoutNode",size:{w:"95%",h:"95%"},pageRatio:0.95};var O={scriptClass:"mstrmojo.DI.DIFooter",slot:"footerNode",alias:"footer"};var u={scriptClass:"mstrmojo.DI.DIExitOptions",pageType:c.redirect,slot:"layoutNode",size:{h:"380px",w:"440px"}};var W={scriptClass:"mstrmojo.DI.DITwitterPage",pageType:c.twitter,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var AH={scriptClass:"mstrmojo.DI.DIFacebookPage",pageType:c.facebook,slot:"layoutNode",size:{h:"552px",w:"1010px"}};var AE={scriptClass:"mstrmojo.DI.DISourceListAdmin",pageType:c.sourceAdmin,slot:"layoutNode",size:{h:"557px",w:"1010px"}};var g={scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-virtul-header-container",slot:"virtualHeaderNode",alias:"virtualHeader",isHeader:true,ontitleTextChange:function(){if(this.hasRendered){this.title.set("text",this.titleText);}},onsubtitleTextChange:function(){if(this.hasRendered){this.subtitle.set("text",this.subtitleText);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title",alias:"title",text:mstrmojo.desc(4381,"Data Sources")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title mstrmojo-di-subtitle",alias:"subtitle",ontextChange:function J(AT){if(AT.value!==""){this.text="("+AT.value+")";}else{this.text="";}}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-close",alias:"closeBtn",title:mstrmojo.desc(2102,"Close"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){this._ontooltipout();mstrApp.getRootController().onCancelButtonClick();},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-help",title:mstrmojo.desc(1143,"Help"),tooltipOpenDelay:0,useRichTooltip:true,bindings:{visible:function(){return true;}},updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().onHelpButtonClick();},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}},{alias:"customizeButton",scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-customize",title:mstrmojo.desc(14512,"Customize your page"),tooltipOpenDelay:0,useRichTooltip:true,visible:false,updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().showPage(AF.pageType.sourceAdmin);},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}}]};var G={scriptClass:"mstrmojo.Box",slot:"headerNode",alias:"header",isHeader:true,ontitleTextChange:function(){if(this.hasRendered){this.title.set("text",this.titleText);}},onsubtitleTextChange:function(){if(this.hasRendered){this.subtitle.set("text",this.subtitleText);}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title",alias:"title",text:mstrmojo.desc(4381,"Data Sources")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-title mstrmojo-di-subtitle",alias:"subtitle",ontextChange:function J(AT){if(AT.value!==""){this.text="("+AT.value+")";}else{this.text="";}}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-close",alias:"closeBtn",title:mstrmojo.desc(2102,"Close"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){this._ontooltipout();mstrApp.getRootController().onCancelButtonClick();},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}},{scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-help",title:mstrmojo.desc(1143,"Help"),tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().onHelpButtonClick();},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}},{alias:"customizeButton",scriptClass:"mstrmojo.Button",cssClass:"di-title-btn",iconClass:"mstrmojo-di-customize",title:mstrmojo.desc(14512,"Customize your page"),tooltipOpenDelay:0,useRichTooltip:true,visible:false,updateTooltipConfig:function(){var AT=U.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AT.y+40,0),left:Math.max(AT.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});},onclick:function(){mstrApp.getRootController().showPage(AF.pageType.sourceAdmin);},premousedown:function(){E.toggleClass(this.domNode,"hit",true);},premouseup:function(){E.toggleClass(this.domNode,"hit",false);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12668,"All Objects View")+"...",visible:false,cssClass:"all-objects-view-link",alias:"allObjectsLink",onclick:function N(){mstrApp.getRootController().allObjectsController.showAllObjects();}},{scriptClass:"mstrmojo.DI.DISearchTableBox",alias:"searchTable",visible:false}]};var AA={};var o={};var n=new Array(c.emmaPreview,c.dataSelection);function I(){var AX={};var AV=window.screenX||window.screenLeft||0,AU=window.screenY||window.screenTop||0,AW=800,AT=600,AY;if(document.body&&document.body.offsetWidth){AW=document.body.offsetWidth;AT=document.body.offsetHeight;}if(document.compatMode==="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){AW=document.documentElement.offsetWidth;AT=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){AW=window.innerWidth;AT=window.innerHeight;}if(window.outerWidth){AW=window.outerWidth;}if(window.outerHeight){AT=window.outerHeight;}AX.height=AT*0.5;AX.width=AW*0.8;if(AX.height<600||isNaN(AX.height)){AX.height=600;}if(AX.width<800||isNaN(AX.width)){AX.width=800;}AX.left=AV+(AW-AX.width)/2;AX.top=AU+(AT-AX.height)/8;AY="width="+AX.width+",height="+AX.height;AY+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";AY+=",left="+AX.left+",top="+AX.top;return AY;}function F(AT){var AU,AV;AV=I();if(!AT){AT="";}AU=window.open(AT,"Authorization",AV);return{wnd:AU};}function AS(AV,AT){var AU;if(AV&&!AV.closed){AV.location=AT;AV.focus();}else{AU=F(AT);AV=AU.wnd;if(AV){AV.focus();}}return AV;}function t(AX){var AW=JSON.parse(AX);var AT=new Array();for(var AU=0;AU<AW.tableList.length;AU++){var AV=AW.tableList[AU];AT[AU]="TABLENAME="+AV.tableName+";GENERICPARA={"+JSON.stringify(AW)+"};";}return AT;}function d(AU,AW,AZ,Ab,AT){var AY=null;var AX=AU,AV,Aa=0;if(Ab){AY=Ab.get();}if((AX.pageType===c.emmaPreview||AX.pageType===c.dataSelection)&&this.toolbarNode){Aa=this.toolbarNode.offsetHeight;}if(!!AQ.isWS()&&!mstrApp.isPopup&&!AT&&AX.size){z.setNativeWindow(AX.size.w,AX.size.h);}if(!!AQ.isWS()&&this.header&&!!AX.pageType&&(n.indexOf(AX.pageType))<0){this.headerNode.style.display="none";this.layoutNode.style.height=parseInt(this.height,10)-(this.footerHeight+this.layoutBorder+this.virtualHeaderHeight)+"px";this.set("headerHeight",0);this.setDimensions(this.height,this.width);this.windowResize({h:this.height,w:this.width});}else{this.headerNode.style.display="block";this.set("headerHeight",this.headerNode?this.headerNode.offsetHeight:0);this.layoutNode.style.height=parseInt(this.height,10)-(this.headerHeight+this.footerHeight+this.layoutBorder+this.virtualHeaderHeight+Aa)+"px";this.setDimensions(this.height,this.width);this.windowResize({h:this.height,w:this.width});}if(!!AQ.isWS()&&(!!mstrApp.isPopup||!!AT)){this.virtualHeaderNode.style.display="block";}else{this.virtualHeaderNode.style.display="none";}if(!AY){if(AW){AU.model=AW;}if(Ab&&Ab.getConfig()){AX=Ab.getConfig().properties||{};AX=mstrmojo.hash.copy(AU,AX);}if(!!AQ.isWS()&&!mstrApp.isPopup&&!!AT&&AX.size.h){AV=JSON.parse(JSON.stringify(AX));AV.size.h=parseInt(AV.size.h,10)+this.virtualHeaderHeight+"px";AV.model=AW;AY=this.addChildren(mstrmojo.insert(AV));}else{AY=this.addChildren(mstrmojo.insert(AX));}AY.render();if(AY.alias==="sourceIntroPage"){o[AU.sourceInfo.id]=AY;}if(AU.sourceObjectsInfo){AA[AU.sourceObjectsInfo.name]=AY;}if(Ab){Ab.set(AY);}}this.currentPage=AY;if(Ab.getConfig()&&AY.updatePageConfig){AY.updatePageConfig(Ab.getConfig());}if(this.header&&!this.virtualHeader){this.header.set("titleText",AZ);}else{if(this.virtualHeader){this.virtualHeader.set("titleText",AZ);}}if(AZ==="Preview"&&AQ.getEnvObj().isWSWin()&&!AQ.getEnvObj().isDIinVI()){this.headerNode.style.borderTop="solid 1px #d7d7d7";}if(Ab){window.setTimeout(function(){Ab.destroy();},0);}}function AI(){var AW=this.curtainNode;if(!AW){return ;}var AT=document.body,AU=document.documentElement,AV=AW.style;AV.width=Math.max(AT.clientWidth,AU.scrollWidth)+"px";AV.height=Math.max(AT.clientHeight,AU.scrollHeight)+"px";}function f(){if(this.domNode){var AT=this.domNode,AU=AT&&AT.style;if(AU){AU.height=this.height;AU.width=this.width;}mstrmojo.dom.center(this.domNode);AQ.reevaluatePopupPosition(this.domNode);if(this.parent&&this.parent.setPosition){this.parent.setPosition(AU.left,AU.top);}}}function b(AT){var AU;switch(AT){case AF.sourceType.salesforce:AU=mstrmojo.desc(15350,"Data from Salesforce");break;case AF.sourceType.dropbox:AU=mstrmojo.desc(15351,"Data from Dropbox");break;case AF.sourceType.googleAnalytics:AU=mstrmojo.desc(15352,"Data from Google Analytics");break;case AF.sourceType.googleDrive:AU=mstrmojo.desc(15353,"Data from Google Drive");break;default:AU=mstrmojo.desc(10766,"Select Data");break;}return AU;}function AC(AU,AT){var AY=this.getBrowserDimensions(),AV={},AW=k.walk("currentPage.pageType",this);var AX=parseInt(AY.w,10);if(M.indexOf(AW)>=0){if(AW===c.emmaPreview&&(AQ.getEnvObj().isWeb()||AQ.getEnvObj().isWSDossier())){return z.getResponsivePageSize.call(this,AT,this.inPageDialog,R.pageRatio);}return z.getResponsivePageSize.call(this,AT,this.inPageDialog);}if(AU.h.match(/%$/)){AV.h=parseInt(AY.h,10)*parseInt(AU.h,10)/100+"px";}else{AV.h=AU.h;}if(mstrApp.isPopup){if(AX>=800&&AX<=1063){AV.w=(AX*0.95)+"px";return AV;}}if(mstrApp.isPopup){if(AX<800){AV.w="760px";return AV;}}if(AU.w.match(/%$/)){AV.w=AX*parseInt(AU.w,10)/100+"px";}else{AV.w=AU.w;}return AV;}function B(AT){var AV=mstrApp.getRootController().getModel().getImportSource(AT),AU=false;if(!AV){return AU;}switch(AV.databaseType){case 3100:case 4100:case 7300:case 6800:case 6400:case 8100:AU=true;break;case 700:AU=x.indexOf(AF.ibmDb2Versions,AV.databaseVersion)===-1;break;default:break;}return AU;}mstrmojo.DI.DIRootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout],{scriptClass:"mstrmojo.DI.DIRootView",markupString:'<div id="{@id}" class="mstrmojo-di-view {@cssClass}" mstrAttach:contextmenu><div class="mstrmojo-di-virtul-header"></div><div class="mstrmojo-di-header"></div><div class="mstrmojo-di-toolbar"></div><div class="mstrmojo-di-layout"></div><div class="mstrmojo-di-footer"></div><div class="mstrmojo-di-curtain"></div></div>',markupSlots:{virtualHeaderNode:function(){return this.domNode.children[0];},headerNode:function(){return this.domNode.children[1];},toolbarNode:function(){return this.domNode.children[2];},layoutNode:function(){return this.domNode.children[3];},footerNode:function(){return this.domNode.children[4];},curtainNode:function(){return this.domNode.children[5];}},offsetHeight:45,offsetWidth:1,headerHeight:41,footerHeight:56,layoutBorder:2,virtualHeaderHeight:0,showHeader:true,visible:false,saveVisualTime:4000,saveVisualTimeoutID:null,saveVisualTimeoutFn:null,inPageDialog:false,markupMethods:{onvisibleChange:S.visibleMarkupMethod,onheightChange:S.heightMarkupMethod,onwidthChange:S.widthMarkupMethod},showPage:function AP(Aa,Ax,AY,Av){var Aj=mstrApp.getRootController(),AZ=Aj.getModel();if(Ax){if((AQ.isOnetier()||AQ.isWS())&&Ax.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var Ao=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),Al='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";Ao=Ao.replace("#",Al)+".";Aj.displayError(Ao,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}}this.set("visible",true);this.clearModalNodes();this.raiseEvent({name:"preShowRootViewPage",currentPage:this.currentPage,pageType:Aa});if(this.currentPage){this.currentPage.set("visible",false);}var Af={};var AT=mstrmojo.desc(13852,"Prepare Data"),As=AZ.operationMode===AF.operationMode.edit?mstrmojo.desc(13850,"Update Dataset"):mstrmojo.desc(1302,"Finish");var Ae=AT,AV=AY&&AY.getConfig(),AX,Ad,Ar=Aj.dialogController,Ak=false,Aw,Aq=mstrApp.container,Ai=mstrApp.isEMMACube,Ac,Au=AF.xdaType;if(!Av&&AV){Av=AV.footerConfig;}mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD",(AZ.operationMode===AL.refresh)?"refresh":"select",0];switch(Aa){case c.dataSelection:Y.size=z.getResponsivePageSize.call(this,false,this.inPageDialog);d.call(this,Y,AZ,(!!AQ.isWS())?mstrmojo.desc(4381,"Data Sources"):mstrmojo.desc(12721,"Connect to Your Data"),AY,this.inPageDialog);Af={next:{visible:false,enabled:false,text:Ae},back:{visible:false},cancel:{visible:false},finish:{visible:false},cubeQuota:{visible:true},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false},sourceAdmin:{visible:true},};if(!(AQ.isOnetier()||AQ.isWS())&&mstrApp.launchingApp&&mstrApp.launchingApp.pageName==="Html5Vi"){if(!AZ.hasEMMAReportInstance()){Af.managedCheckbox={visible:false,enabled:true};}}if(AZ.analysisID){Af.cubeQuota={visible:false};}if(!AQ.isOnetier()&&AZ.operationMode===AF.operationMode.edit&&!AZ.cubesInfo){Aj.getCubeQuota();}break;case c.mstrFile:d.call(this,Z,AZ,mstrmojo.desc(12479,"Mstr File upload"),AY,this.inPageDialog);Af={next:{visible:false,text:Ae},back:{visible:false},cancel:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.allProjectSource:d.call(this,a,AZ,mstrmojo.desc(12480,"Connect to MicroStrategy Projects"),AY,this.inPageDialog);Af={next:{visible:false,text:Ae},back:{visible:true},finish:{visible:true,enabled:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.hadoop:p.refreshMode=Av&&Av.next.visible&&(!!Av.next.isRefresh);d.call(this,p,AZ,mstrmojo.desc(12805,"Connect to Hadoop"),AY,this.inPageDialog);Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.dataset:d.call(this,e,AZ,mstrmojo.desc(11677,"Select a dataset"),AY,this.inPageDialog);Af={next:{visible:true,text:Ae},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.file:if(Ax!==null){if(Ax===1){if(AZ.operationMode!==AF.operationMode.create&&mstrApp.diParams.EnableURLImport===false){Ax=0;}}}if(AY.getConfig()&&AY.getConfig().sourceInfo!==undefined){Ax=AY.getConfig().sourceInfo;}if(Ax===0){C.sourceSubtype=AF.sourceSubtype.localFile;d.call(this,C,AZ,(!!AQ.isWS())?mstrmojo.desc(14826,"Local Drive"):mstrmojo.desc(12715,"Upload your files"),AY,this.inPageDialog);}else{V.sourceSubtype=AF.sourceSubtype.url;V.isNewConnector=false;V.isFromCloudElement=false;mstrApp.isNewConnectorEdit=false;mstrApp.isNewConnector=false;d.call(this,V,AZ,(!!AQ.isWS())?mstrmojo.desc(14767,"Data from URL"):mstrmojo.desc(14791,"Paste your URLs"),AY,this.inPageDialog);var Am=(AZ.operationMode===AF.operationMode.subscribe&&AV&&AV.properties&&AV.properties.currentSource&&AV.properties.currentSource.subtype===AF.sourceSubtype.cloudElement);if(mstrApp.isNewConnectorEdit||Am){this.set("visible",false);}}Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.database:if(Ax!==null){L.sourceInfo=Ax;}if(Ai){Ae=AT;if(!AQ.isWS()){Aw=(Ax&&Ax.type===AF.xdaType.mdx)?mstrmojo.desc(13152,"Import From Cubes"):mstrmojo.desc(12716,"Import From Tables");}else{if(Ax){switch(Ax.type){case AF.xdaType.mdx:Aw=mstrmojo.desc(13152,"Import From Cubes");break;case AF.xdaType.qbSingleTable:case AF.xdaType.googleBigQuerySingleTable:Aw=mstrmojo.desc(14907,"Import from Table - Select");break;case AF.xdaType.querybuilder:case AF.xdaType.ffsql:case AF.xdaType.googleBigQuery:case AF.xdaType.googleBigQueryFFSQL:Aw=mstrmojo.desc(14908,"Import from Table - SQL Editor");break;default:Aw=mstrmojo.desc(12752,"BI Sources");break;}}}d.call(this,l,AZ,Aw,AY,this.inPageDialog);Ad=Aj.getQueryBuilderParams(Ax.type,Ax.extParams||null);AV=AY&&AY.getConfig();AX=AV&&AV.properties&&AV.properties.tableID;if(AX){Ad.tableID=AX;Ad.isHadoopQB=B(AX);}var At=this,Ap=false,Ab=false;mstrmojo.hash.forEach(Aj.model.importSources,function(Ay){if(Ay.subtype===AF.sourceSubtype.hanaSingleTable){Ap=true;}else{Ab=true;}});Ad.isSapHanaSingleTable=Ap;Ad.hasNonSapHana=Ab;if(Ap){mstrApp.supportDBObjects=Aj.model.supportDBObjects;}Ad.diShowFooterFunction=function(Ay){At.showFooter(Ay);};if(!mstrApp.isPopup&&!this.inPageDialog){Ad.size=mstrApp.size;}this.currentPage.size=Ad.size;mstrmojo.hash.copy(Ad,this.currentPage.QBParams);if(Aj.dataService.messageID){if(this.currentPage.QBParams.size){this.currentPage.QBParams.size=AC.call(At,this.currentPage.QBParams.size);}this.currentPage.loadQB();}else{Aj.createNewReportInstance({success:function(){var Ay=At.currentPage.QBParams;Ay.size=AC.call(At,Ay.size);Ay.messageID=Aj.dataService.messageID;Aj.getQBParamsDDA(Ay);Ay.operationMode=AZ.operationMode;At.currentPage.loadQB();},failure:function(Ay){Aj.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,Ay.message||"");}});}}else{d.call(this,L,AZ,mstrmojo.desc(10766,"Select Data"),AY,this.inPageDialog);}Af=Av||{next:{visible:true,enabled:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};if(Ai){Af.next.enabled=false;Af.finish.enabled=false;AX=Ad&&Ad.tableID;if(AX){Ac=Ax.type;Af.back.visible=false;}}if(Ax.type===AF.xdaType.mdx){Af.next.visible=false;}else{if(Ax.sourceType===AF.sourceType.bisource){Af.cancel.visible=true;if(this.header){this.header.set("titleText",mstrmojo.desc(12752,"BI Sources"));this.header.set("subtitleText",mstrmojo.desc(12806,"Import from SAP Business Object, Cognos, and OBIEE"));}}}break;case c.newConnector:if(Ax===1){if(AZ.operationMode!==AF.operationMode.create&&mstrApp.diParams.EnableURLImport===false){Ax=0;}}if(AY.getConfig()&&AY.getConfig().sourceInfo!==undefined){Ax=AY.getConfig().sourceInfo;}if(Ax===0){C.sourceSubtype=AF.sourceSubtype.localFile;d.call(this,C,AZ,(!!mstrApp.isWorkstation)?mstrmojo.desc(14826,"Local Drive"):mstrmojo.desc(12715,"Upload your files"),AY);}else{V.sourceSubtype=AF.sourceSubtype.url;V.isNewConnector=true;if(AQ.isServerBasedWS()&&AQ.getEnvObj().isMac()){V.size={h:"768px",w:"1366px"};}d.call(this,V,AZ,(!!mstrApp.isWorkstation)?mstrmojo.desc(14767,"Data from URL"):mstrmojo.desc(14791,"Paste your URLs"),AY);var Aj=mstrApp.getRootController();Aj.showPage(AF.pageType.dataSelection);}Af=Av||{next:{visible:false,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.cloudElement:if(AY.getConfig()&&AY.getConfig().sourceInfo!==undefined){Ax=AY.getConfig().sourceInfo;}V.sourceSubtype=AF.sourceSubtype.cloudElement;V.isFromCloudElement=true;V.isNewConnector=false;V.sourceInfo=Ax;if(AQ.isServerBasedWS()&&AQ.getEnvObj().isMac()){V.size={h:"768px",w:"1366px"};}d.call(this,V,AZ,(!!mstrApp.isWorkstation)?mstrmojo.desc(14767,"Data from URL"):mstrmojo.desc(14791,"Paste your URLs"),AY);if(AY.getConfig()&&AY.getConfig().properties&&AY.getConfig().properties.tableID){this.set("visible",false);}else{mstrApp.getRootController().showPage(AF.pageType.dataSelection);}Af=Av||{next:{visible:false,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.sampleFiles:d.call(this,AM,AZ,(!!AQ.isWS())?mstrmojo.desc(12712,"Sample Files"):mstrmojo.desc(12446,"File Samples"),AY,this.inPageDialog);Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false,text:mstrmojo.desc(1302,"Finish")},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.emmaPreview:R.size=z.getResponsivePageSize.call(this,null,null,R.pageRatio);var Ah=mstrmojo.desc(13612,"Save Progress");if((AQ.isOnetier()||AQ.isWS())){Af={next:{visible:true,text:As},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{Af={next:{visible:true,text:As},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:true,text:Ah},managedCheckbox:{visible:false}};}if(AZ.isManagedCube){Af.save={visible:false};}d.call(this,R,AZ,mstrmojo.desc(3389,"Preview"),AY,this.inPageDialog);this.header.set("subtitleText","");mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];Ak=true;break;case c.preview:d.call(this,q,AZ,mstrmojo.desc(3389,"Preview"),AY,this.inPageDialog);Af={next:{visible:true},back:{visible:true},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};mstrApp.QTtabIndex=[mstrApp.diParams.isMDD?"EDD":"TD","review",0];break;case c.redirect:d.call(this,u,AZ,mstrmojo.desc(13308,"Start your analysis"),AY,this.inPageDialog);this.domNode.className+=" start-your-analysis";Af={next:{visible:false},back:{visible:false},cancel:{visible:false},previewNote:{visible:false},finish:{visible:false},dda:{visible:false},cubeQuota:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.sourceIntro:mstrApp.getRootController().getOAuthSourceReports(Ax.type,false,AY);break;case c.sourceObjects:Aw=b(Ax.type);if(AF.sourceType.googleAnalytics===Ax.type){AG.sourceObjectsInfo=Ax;d.call(this,AG,AZ,Aw,AY,this.inPageDialog);}else{X.sourceObjectsInfo=Ax;d.call(this,X,AZ,Aw,AY,this.inPageDialog);}Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.sourceObjectsDnD:Aw=b(Ax.type);if(AF.sourceType.googleAnalytics===Ax.type){AG.sourceObjectsInfo=Ax;d.call(this,AG,AZ,Aw,AY,this.inPageDialog);}else{D.sourceObjectsInfo=Ax;d.call(this,D,AZ,Aw,AY,this.inPageDialog);}Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.suggestNewSource:var Ag="productfeedback@microstrategy.com",AU=(AQ.isOnetier()||AQ.isWS())?"Analytics%20Desktop":"Analytics%20Enterprise",An="New%20Data%20Source%20Suggestion";mstrApp.getRootController().openMailClient("mailto:"+Ag+"?subject="+AU+":%20"+An);break;case c.clipboard:AJ.url=Ax;d.call(this,AJ,AZ,mstrmojo.desc(12490,"Create custom data"),AY,this.inPageDialog);if(AZ.operationMode===AF.operationMode.refresh){Af=Av||{next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}break;case c.twitter:W.sourceObjectsInfo=Ax;d.call(this,W,AZ,mstrmojo.desc(12722,"Import data from Twitter"),AY,this.inPageDialog);Af=Av||{next:{visible:true,enabled:false,text:Ae},cancel:{visible:true},finish:{visible:true,enabled:false},back:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.facebook:AH.sourceObjectsInfo=Ax;d.call(this,AH,AZ,mstrmojo.desc(12723,"Import data from Facebook"),AY,this.inPageDialog);Af=Av||{next:{visible:true,enabled:false,text:Ae},cancel:{visible:true},finish:{visible:true,enabled:false},back:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;case c.publicData:j.url=Ax;d.call(this,j,AZ,mstrmojo.desc(13978,"Public Data"),AY,this.inPageDialog);if(AZ.operationMode===AF.operationMode.refresh){Af={next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}else{Af=Av||{next:{visible:true,text:Ae},back:{visible:true},cancel:{visible:true},finish:{visible:true,enabled:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};}break;case c.sourceAdmin:AE.size=z.getResponsivePageSize.call(this,false,this.inPageDialog);d.call(this,AE,AZ,mstrmojo.desc(4381,"Data Sources"),AY,this.inPageDialog);Af=Av||{next:{visible:false},back:{visible:false},cancel:{visible:true},finish:{visible:true,enabled:true,text:mstrmojo.desc(118,"Save")},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};break;}if(Aa===c.dataSelection||Aa===c.redirect||Aa===c.sourceIntro||Aa===c.suggestNewSource||Aa===c.newConnector){this.showFooterDividerLine(false);}else{this.showFooterDividerLine(true);}if(Aj.model.isAddingNewTable&&Aa!==c.sourceAdmin){if(Af.next&&Aa!=c.emmaPreview){Af.next.text=mstrmojo.desc(531,"Add");}if(Af.finish){Af.finish.visible=false;}}if(!Af.mdxRACheckbox){Af.mdxRACheckbox={visible:false};}if(Aa!==c.newConnector&&Aa!==c.cloudElement){this.showFooter(Af);}this.currentPage.set("visible",true);this.raiseEvent({name:"postShowRootViewPage",currentPage:this.currentPage});if(this.currentPage.size&&(Aq||this.inPageDialog)){this.windowResize(this.currentPage.size);}if(!mstrApp.isPopup&&!this.inPageDialog){this.windowResize({h:this.height,w:this.width});}if(Ar&&Ar.pageZIndex>0){Ar.centerPageDialog();}if(Aj.connectorScrollTop){var AW=this.currentPage.sourceTable;AW&&(AW.domNode.scrollTop=Aj.connectorScrollTop);delete Aj.connectorScrollTop;}return this.currentPage;},showFooter:function AO(AT){this.raiseEvent({name:"updateFooterConfig",config:AT});this.footer.showControls(AT);},showFooterDividerLine:function AD(AT){if(AT){this.layoutNode.className="mstrmojo-di-layout";this.footerNode.className="mstrmojo-di-footer";}else{this.layoutNode.className="mstrmojo-di-layout-noborder";this.footerNode.className="mstrmojo-di-footer-noborder";}},setModalNodes:function(AW,AT){var AV=this.curtainNode;if(!AV){return ;}this.clearModalNodes();var AX=AT||9999;var AU;if(!AW||!AW.length){return ;}this.modalNodes=AW;for(AU=0;AU<AW.length;AU++){this.modalNodesZIndexes.push(AW[AU].style.zIndex);}for(AU=0;AU<AW.length;AU++){AW[AU].style.zIndex=AX;if(AW[AU].style.position===""){AW[AU].style.position="relative";}}this.curtainNode.style.display=this.visible?"block":"none";this.curtainNode.style.zIndex=AX-1;AI.call(this);AW[0].focus();},clearModalNodes:function(){var AW=this.curtainNode;if(!AW){return ;}var AU,AV,AT,AX;AT=this.modalNodes;AV=this.modalNodesZIndexes;for(AU=0;AT&&AU<AT.length;AU++){AX=AT[AU];if(AX&&AX.style){AX.style.zIndex=AV[AU];}}this.modalNodes=[];this.modalNodesZIndexes=[];this.curtainNode.style.height="0px";this.curtainNode.style.weight="0px";this.curtainNode.style.display="none";},windowResize:function P(Ab,AV){var Aa,AU,AT,AW,AZ,AY=0,AX=this;if(!Ab||!Ab.h||!Ab.w){return ;}AT=AC.call(this,Ab,AV);mstrApp.size=AT;Aa=AT.h;AU=AT.w;if(this.currentPage&&this.currentPage.pageType==c.hadoop&&this.domNode){if(parseInt(AU)+parseInt(this.domNode.style.left)>document.body.clientWidth){AU=(document.body.clientWidth-parseInt(this.domNode.style.left)*2);AU=(AU<863?863:AU)+"px";}if(parseInt(Aa)+parseInt(this.domNode.style.top)>document.body.clientHeight){Aa=(document.body.clientHeight-parseInt(this.domNode.style.top)*2);Aa=(Aa<200?200:Aa)+"px";}}if(!AQ.isWS()&&this.currentPage&&(this.currentPage.pageType===c.emmaPreview||this.currentPage.pageType===c.dataSelection)&&this.toolbarNode&&this.domNode){AY=this.toolbarNode.offsetHeight;}if(mstrApp.isWorkstation&&mstrApp.isPopup&&parseInt(AU)<979){AU="979px";AT.w=AU;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.w.layoutNode=AU;AZ=parseInt(Aa,10)-(this.headerHeight+this.footerHeight+this.layoutBorder+this.virtualHeaderHeight)-AY+"px";this.layoutConfig.h.layoutNode=AZ;AT.layoutH=AZ;this.setDimensions(Aa,AU);if(mstrApp.isPopup||this.inPageDialog){AI.call(this);f.call(this);}AW=mstrApp.getRootController().model;if(AW){AW.raiseEvent({name:"windowSizeChanged",size:AT,target:AX.domNode});}},browserResized:function AK(AU){var AT,AV,AW;if(this.domNode){if(document.createEvent){AW=document.createEvent("MouseEvents");AW.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);this.domNode.dispatchEvent(AW);}else{if(document.createEventObject){AW=document.createEventObject();this.domNode.fireEvent("onmousedown",AW);}}}if(mstrApp.isPopup){AT=this.height;AV=this.width;this.setDimensions(AT,AV);if(this.currentPage){this.windowResize(this.currentPage.size);}AI.call(this);f.call(this);}else{if((AQ.isOnetier()||AQ.isWS())){AT=parseInt(AU.h,10);AV=parseInt(AU.w,10);}else{AT=(parseInt(AU.h,10)-this.offsetHeight);AV=(parseInt(AU.w,10)-this.offsetWidth);}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}if(!this.inPageDialog){this.layoutConfig.w.layoutNode=AV+"px";this.layoutConfig.h.layoutNode=AT-(this.headerHeight+this.footerHeight+this.layoutBorder+this.virtualHeaderHeight)+"px";this.setDimensions(AT+"px",AV+"px");}this.windowResize({h:AT+"px",w:AV+"px"},true);}return true;},preBuildRendering:function A(){if(this._super){this._super();}mstrmojo.DI.ProgressPolyfill.createProgressPolyfill();var AT=[];if(!this.footer){O.model=mstrApp.getRootController().getModel();AT.push(O);}if(!this.header&&this.showHeader){if(AQ.isWS()){if(!!AQ.isWS()&&(!!mstrApp.isPopup||!!this.inPageDialog)){this.set("virtualHeaderHeight",29);AT.push(g);}else{this.set("virtualHeaderHeight",0);}AT.push(new mstrmojo.DI.DIToolbar({slot:"headerNode",alias:"header",showCloseBtn:false}));}else{AT.push(G);AT.push(new mstrmojo.DI.DIToolbar({slot:"toolbarNode",alias:"toolbar",showCloseBtn:false}));}}this.addChildren(AT);if(!!AQ.isWS()&&!mstrApp.isPopup){this.header.set("titleText",mstrmojo.desc(4381,"Data Sources"));}this.footer.showControls({next:{visible:false},back:{visible:false},cancel:{visible:false}});if(!this.emptyPage){this.currentPage=this.addChildren(m);if(this.currentPage.size&&mstrApp.container){this.windowResize(this.currentPage.size);}}if(mstrApp.isPopup){mstrmojo.css.addWidgetCssClass(this,"mstrmojo-di-view-popup");}if(!!AQ.isWS()&&!mstrApp.isPopup&&!this.inPageDialog){z.lockResize();}},oncontextmenu:function AB(AT){var AV=U.eventTarget(AT.hWin,AT.e),AU;if(AV&&AV.tagName){AU=AV.tagName.toLowerCase();}if(AU!=="input"&&AU!=="textarea"&&AV.contentEditable!=="true"){U.preventDefault(window,AT.e);return false;}},setHomepageViewMode:function H(AT){Y.mode=AT;},focusFooter:function AR(){if(this.footer&&this.footer.containerNode){this.footer.containerNode.focus();}},showSaveVisual:function(){var AU=this,AT=AU.header&&AU.header.subtitle&&AU.header.subtitle.text,AV=mstrmojo.desc(13781,"Saved Successfully");if(!AU.header.isHeader){return ;}if(AU.saveVisualTimeoutID){window.clearTimeout(AU.saveVisualTimeoutID);}else{AU.header.subtitle.set("text",AV);E.toggleClass(AU.header.subtitle.domNode,"saveVisual",true);AU.saveVisualTimeoutFn=function(){AU.header.subtitle.set("text",AT||"");E.toggleClass(AU.header.subtitle.domNode,"saveVisual",false);AU.saveVisualTimeoutID=null;};}AU.saveVisualTimeoutID=window.setTimeout(AU.saveVisualTimeoutFn,AU.saveVisualTime);},destroy:function(AT){if(this.saveVisualTimeoutID){window.clearTimeout(this.saveVisualTimeoutID);}this._super(AT);},setSourceListMode:function Q(AU){var AT=this.currentPage;if(AT&&AT.pageType===AF.pageType.dataSelection){AT.set("mode",AU);}},updateSourceListPage:function w(){var AT=this.currentPage;if(AT&&AT.pageType===AF.pageType.dataSelection){AT.update();}},setSearchPattern:function AN(AU){var AT=this.currentPage;if(AT&&AT.pageType===AF.pageType.dataSelection){if(AT.mode===K){AT.onSearch(AU);}else{AT.onSearchGridView(AU);}}},setDimensions:function(AU,AT){if(AQ.getEnvObj().isWS()&&!mstrApp.isPopup&&!this.inPageDialog&&z.isDIFullScreenModeOnMac()){this._super(window.innerHeight+"px",window.innerWidth+"px");}else{this._super(AU,AT);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIRootView","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.Editor");mstrmojo.requiresDescs(14155);var F=mstrmojo.DI.DIHelpers,D=mstrmojo.DI.DIConstants;function H(){try{if(this.domNode&&this.containerNode){this.containerNode.style.padding=0;}if(this.domNode&&this.buttonNode){this.buttonNode.style.padding=0;}}catch(I){console.log(I,"Dom Manipulation Error! Swallowed!");}}function E(J,K){var I=window.document.getElementById("DIContainer");if(I&&this.rootView){this.rootView.windowResize({h:(I.clientHeight*K).toString()+"px",w:(I.clientWidth*J).toString()+"px"});}if(this.editNode){mstrmojo.dom.center(this.editNode);}}mstrmojo.DI.ui.dialogs.DIPageDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.DI.ui.dialogs.DIPageDialog",showTitle:false,zIndex:999,launcher:null,getMovingHandle:function G(){return this.rootView.headerNode;},browserResized:function C(I){if(this.editorNode){mstrmojo.dom.center(this.editorNode);F.reevaluatePopupPosition(this.editorNode);}if(this.pageType===D.pageType.sourceAdmin||this.pageType===D.pageType.dataSelection){this.hasRendered&&E.call(this,0.8,0.8);}},postBuildRendering:function(){if(this._super){this._super();}if(this.pageType===D.pageType.dataSelection){window.setTimeout(E.bind(this,0.8,0.8),0);}},onOpen:function B(){var I=mstrApp.getRootController(),P=this.slot,L=this,N=mstrmojo.desc(14155,"Please input your original data into clipboard because you have parsed or wrangled the data."),O={success:function(Q){H.call(L);P.getConfig().properties.content=Q;I.showPage(D.pageType.clipboard,0,P||null);L.raiseEvent({name:"EditorResized"});},failure:function(Q){I.showPage(D.pageType.clipboard,0,P||null);I.displayError(mstrmojo.desc(12795,"Could not load clipboard data!"),false,Q.message);}},K,M,J;this.set("visible",false);this.launcher=I.rootView;this.origTitleText=I.rootView.header&&I.rootView.header.titleText;I.rootView=this.rootView;switch(this.pageType){case D.pageType.emmaPreview:I.fetchCubeInfoEMMA();break;case D.pageType.dataSelection:I.showPage(this.pageType,null,this.slot||null);break;case D.pageType.file:I.showPage(this.pageType,this.sourceInfo,this.slot||null);break;case D.pageType.clipboard:K=P.getConfig().properties.tableID;J=!!P.getConfig().properties.donotFetchData;M={previewflag:D.requestFlag.fullData,browsetype:4,sheetIndex:0,bindingflag:0,tableID:K};if(!J&&!I.getModel().isParsed(K)&&!I.getModel().isRefined(K)){I.dataService.getImportedData(O,M,0);}else{I.showPage(D.pageType.clipboard,0,this.slot||null);mstrApp.getRootController().displayWarning(N,null,mstrmojo.emptyFn,{showCancel:false});}H.call(this);break;case D.pageType.schedule:case D.pageType.republish:this.origModel=I.getModel();this.origMessageID=I.dataService.messageID;this.origIRRMessageID=I.dataService.emmaIRRMessageID;this.model=new mstrmojo.DI.DIModel();this.addDisposable(this.model);this.model.initParams(this.diParams);I.model=this.model;I.dataService.messageID=null;I.dataService.emmaIRRMessageID=null;I.restoreForLaunchingApp();break;case D.pageType.publicData:I.showPage(this.pageType,null,this.slot||null);break;default:break;}},onClose:function A(){var I=mstrApp.getRootController();I.rootView=this.launcher;if(I.rootView.header){I.rootView.header.set("titleText","");I.rootView.header.set("titleText",this.origTitleText);}I.dialogController.pageZIndex--;this.sourceInfo=null;this.slot=null;if(this.origModel){I.model=this.origModel;this.origModel=null;}if(this.origMessageID!==undefined){I.dataService.messageID=this.origMessageID;this.origMessageID=null;}if(this.origIRRMessageID!==undefined){I.dataService.emmaIRRMessageID=this.origIRRMessageID;this.origIRRMessageID=null;}this.destroy();},children:[{scriptClass:"mstrmojo.DI.DIRootView",alias:"rootView",showHeader:true,inPageDialog:true,onvisibleChange:function(){this.parent.set("visible",this.visible);},}]});}());(function(){var A=mstrmojo.DI.DIConstants.pageType;mstrmojo.DI.DIExpressView=mstrmojo.declare(mstrmojo.DI.DIRootView,null,{id:"DIRootView",scriptClass:"mstrmojo.DI.DIExpressView",offsetWidth:40,headerHeight:25,footerHeight:40,offsetHeight:175});}());function rrResize(){var A={h:mstr.utils.BoxModel.getBrowserWindowHeight(document),w:mstr.utils.BoxModel.getBrowserWindowWidth(document)};var B=mstrmojo.all.DIRootView;if(B){B.browserResized(A);}}(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.Obj","mstrmojo.Editor","mstrmojo.qb.es.AlternateSourceDialog","mstrmojo.DI.DIProjectsAttribute","mstrmojo.DI.DIHelpers","mstrmojo.vi.ui.editors.ObjectPicker","mstrmojo.SharingEditor");mstrmojo.requiresClsP("mstrmojo.DI","DIConstants","DIRootView","DIAllObjectsView","DIRepublishScheduleEditor","DIMultiFormEditor","DIPartitionGroupDialog","DIOAuthParaEditor","DIWhiteListEditor","DIProjectsAttribute","DITwitterAdvancedOptions");mstrmojo.requiresClsP("mstrmojo.DI.ui.dialogs","DICubesListDialog","DIMissingColumnsDialog","DIPageDialog","DIRefreshHistoryDialog","DIDirectAccessConfirmDialog","DISaveAsDialog","DISheetsSelectionDialog","DIParseDataDialog","DIQBImportOptionDialog","DICredentialsDialog","DIMapProjectAttributeDialog","DIBinaryUploadDialog","DIAuthenticationDialog","DIHadoopGatewayDialog","DIHadoopGatewayManagerDialog","DIHierarchyAttributeDialog","DIAddCustomConnectorDialog","ErrorDialog");mstrmojo.requiresClsP("mstrmojo.Refine","RefineClusteringDialog","RefineExtractDialog","RefineImportDialog");mstrmojo.requiresDescs(1789,189,221,1442,3610,8973,11581,12579,12580,13010,13191,13192,13193,13194,13309,13310,13311,13312,13313,13314,13315,13316,13317,13329,13330,13303,14296,15061);var q=mstrmojo,AE=q.DI.DIConstants,t=q.array,Q=q.dom,D=q.css,S=q.hash,AO=q.DI.DIHelpers,u=15;var K=mstrmojo.desc(1798,"Select Tables"),Y=mstrmojo.desc(1798,"Select Tables"),N=mstrmojo.desc(13310,"Select single or multiple tables to import via 'SQL on hadoop'"),AF=mstrmojo.desc(13193,"Build a Query"),F=mstrmojo.desc(13311,"Use a graphical interface to build a 'SQL on hadoop' query to import a table"),AN=mstrmojo.desc(13194,"Type a Query"),B=mstrmojo.desc(13312,"Paste or write a query script to import a table via 'SQL on Hadoop' or Pig"),U=mstrmojo.desc(13313,"Browse Hadoop Files using MicroStrategy Big Data Engine"),j=mstrmojo.desc(13314,"Import tables by browsing HDFS(Hadoop Distributed File System)"),M=mstrmojo.desc(13315,"Select single or multiple tables to import"),AG=mstrmojo.desc(13316,"Use a graphical interface to build a SQL query to import a table"),G=mstrmojo.desc(13317,"Paste or write a query script to import a table");var AR=[K,AF,AN];var AC=[U,K,AF,AN];var k=[K,AF,AN,Y];var AJ=[N,F,B];var C=[j,N,F,B];var H=[M,AG,G];var m="fixRefreshDialog",AP={scriptClass:"mstrmojo.Editor",id:m,showTitle:false,zIndex:999,onOpen:function d(){var AS=mstrApp.getRootController();AS.rootView=this.rootView;AS.fetchCubeInfoEMMA();},onClose:function n(){var AS=mstrApp.getRootController();AS.dialogController.pageZIndex--;},children:[{scriptClass:"mstrmojo.DI.DIRootView",alias:"rootView"}]};function e(){return true;}var Z={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-errorBox",draggable:false,showTitle:true,zIndex:99999,showCancel:false,errorMessage:mstrmojo.desc(12579,"Error when running the application"),onmousedown:function(AS){Q.stopPropogation(AS.hWin,AS.e);},onClose:function(){if(this.onOK&&!this.cancelButton.visible){this.onOK();}},onOpen:function(){this.helpNode.style.display="none";var AT=this.curtainNode.style;var AU=this;AT.background="black";AT.opacity=0.5;AT.filter="alpha(opacity=50)";this.message.domNode.innerHTML=this.errorMessage+" ";var AS=document.createElement("A");AS.href="#";AS.innerHTML=mstrmojo.desc(189,"Details");AS.className="mstrmojo-di-error-link";D.toggleClass(AU.message.domNode,"off",true);Q.attachEvent(AS,"click",function(AV){var AW=AO.expandNode(AU.detailMessage);D.toggleClass(AU.message.domNode,"off",!AW);D.toggleClass(AS,"on",AW);Q.preventDefault(window,AV);});this.detailMessage.domNode.innerHTML=this.detailErrorMessage;if(this.cancelBtnText){this.cancelButton.set("text",this.cancelBtnText);}if(this.okBtnText){this.okButton.set("text",this.okBtnText);}if(e()){if(this.detailErrorMessage){this.message.domNode.appendChild(AS);}this.detailMessage.set("visible",false);}else{this.detailMessage.set("visible",false);}this.cancelButton.set("visible",this.showCancel);},children:[{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage off",alias:"message",text:mstrmojo.desc(12580,"Unexpected error occured during an operation. Please try again."),cssDisplay:""},{scriptClass:"mstrmojo.Label",cssClass:"cf mstrmojo-di-errorMessage-detail",alias:"detailMessage",visible:false},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",alias:"cancelButton",text:mstrmojo.desc(221,"Cancel"),cssText:"float:right; margin-left:10px;",onclick:function(){var AS=this.parent;AS.close();if(AS.onCancel){AS.onCancel();}}},{slot:"buttonNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"okButton",onclick:function(){var AS=this.parent;AS.close();if(AS.onOK&&AS.cancelButton.visible){AS.onOK();}}}]};var b="inputNameBox",P={scriptClass:"mstrmojo.Editor",id:b,cssClass:"mstrmojo-di-inputNameBox",draggable:true,showTitle:true,zIndex:999,title:mstrmojo.desc(13329,"Please rename the attribute to unmap it"),noButtonCls:true,text:mstrmojo.desc(13330,"Please rename to unmap this attribute"),buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(13303,"Unmap"),onclick:function(){var AT=this.parent.parent;var AS=AT.input.value;if(AT.onOk){if(AT.onOk(AS)){AT.close();}}else{AT.close();}},bindings:{enabled:function(){return this.parent.parent.input.value.length>0;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var AS=this.parent.parent;AS.close();if(AS.onCancel){AS.onCancel();}}}],children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-inputNameBox-text",bindings:{text:"this.parent.text"}},{scriptClass:"mstrmojo.Box",markupString:'<span id="{@id}" class="{@cssClass}">{@text}</span>',cssClass:"mstrmojo-di-inputNameBox-inputText",cssDisplay:"inline",text:mstrmojo.desc(13010,"New Name:")},{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-inputNameBox-input",alias:"input",onEnter:function(){var AT=this.parent;var AS=this.value;if(AT.onOk){if(AT.onOk(AS)){AT.close();}}else{AT.close();}}}],onOpen:function(){this.input.set("value",this.curName);this.input.focus();}};var W,X,I,AM,o,L,l,AL,V,J,c,AI,a,AB,x,R,AD,AK,w,p,AA,AQ;var E="sharingEditorDIDialog";mstrmojo.DI.controller.DIDialogController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDialogController",pageZIndex:0,hasDialog:function f(AU){var AS=false;switch(AU){case AE.dialogType.publishStatusDialog:var AT=mstrmojo.all[o];if(AT){AS=true;}break;case AE.dialogType.cubesList:if(mstrmojo.all[I]){AS=true;}break;}return AS;},getNextZIndex:function A(){var AS=u;u+=2;if(mstrApp.sessionManager){mstrApp.sessionManager.set("zIndex",u+1);}return AS;},getCurrentZIndex:function h(){return u;},centerPageDialog:function(){if(R&&mstrmojo.all[R]){mstrmojo.dom.center(mstrmojo.all[R].editorNode);}},close:function AH(AT){var AS;switch(AT){case AE.dialogType.publishStatusDialog:AS=mstrmojo.all[o];break;case AE.dialogType.cubesList:AS=mstrmojo.all[I];break;case AE.dialogType.errorDialog:AS=mstrmojo.all[AI];break;}if(AS&&AS.visible){AS.close();}},destroyAll:function O(){if(mstrmojo.all[o]){mstrmojo.all[o].destroy();}if(mstrmojo.all[W]){mstrmojo.all[W].destroy();}if(mstrmojo.all[p]){mstrmojo.all[p].destroy();}if(mstrmojo.all[X]){mstrmojo.all[X].destroy();}if(mstrmojo.all[I]){mstrmojo.all[I].destroy();}if(mstrmojo.all[AM]){mstrmojo.all[AM].destroy();}if(mstrmojo.all[l]){mstrmojo.all[l].destroy();}if(mstrmojo.all[L]){mstrmojo.all[L].destroy();}if(mstrmojo.all[AL]){mstrmojo.all[AL].destroy();}if(mstrmojo.all[V]){mstrmojo.all[V].destroy();}if(mstrmojo.all[X]){mstrmojo.all[X].destroy();}if(mstrmojo.all[AK]){mstrmojo.all[AK].destroy();}if(mstrmojo.all[w]){mstrmojo.all[w].destroy();}if(c){t.forEach(c,function(AS){if(mstrmojo.all[AS]){mstrmojo.all[AS].destroy();}});}if(mstrmojo.all[E]){mstrmojo.all[E].destroy();}},show:function z(Aa,AT){var AY=null,AV,AW,Ad;AT=AT||{};AT.zIndex=this.getNextZIndex();switch(Aa){case AE.dialogType.setOAuthParaDialog:AY=mstrmojo.all[AD];if(!AY){AY=new mstrmojo.DI.DIOAuthParaEditor();}AY.open(null,AT);AD=AY.id;break;case AE.dialogType.setWhiteListDialog:AY=mstrmojo.all[AA];if(!AY){AY=new mstrmojo.DI.DIWhiteListEditor();}AY.open(null,AT);AA=AY.id;break;case AE.dialogType.fixRefreshErrorDialog:AY=mstrmojo.all[m];if(!AY){AY=mstrmojo.insert(mstrmojo.hash.copy(AT,AP));}AY.open(null,AT);this.pageZIndex++;break;case AE.dialogType.allObjectsViewDialog:AY=mstrmojo.all[X];if(!AY){AY=new mstrmojo.DI.DIAllObjectsView();}AY.open(null,AT);X=AY.id;break;case AE.dialogType.missingColumnsDialog:AY=mstrmojo.all[W];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DIMissingColumnsDialog();}AY.open(null,AT);W=AY.id;break;case AE.dialogType.credentialsDialog:AY=mstrmojo.all[p];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DICredentialsDialog();}AY.open(null,AT);p=AY.id;break;case AE.dialogType.diPageDialog:AY=new mstrmojo.DI.ui.dialogs.DIPageDialog();AY.open(null,AT);R=AY.id;this.pageZIndex++;break;case AE.dialogType.ddaConfirmDialog:AY=new mstrmojo.DI.ui.dialogs.DIDirectAccessConfirmDialog();AY.open(null,AT);break;case AE.dialogType.refreshHistoryDialog:AY=mstrmojo.all[AM];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DIRefreshHistoryDialog();}AY.open(null,AT);AM=AY.id;break;case AE.dialogType.alternateSourceValidateDialog:AY=mstrmojo.all[l];if(!AY){AY=new mstrmojo.qb.es.AlternateSourceDialog();}AY.open(null,AT);l=AY.id;break;case AE.dialogType.publishStatusDialog:AY=mstrmojo.all[o];Ad="mstrmojo-di-scheduleEMMA ";AV=mstrApp.getRootController().getModel();switch(AV.operationMode){case AE.operationMode.create:Ad+="createMode";break;case AE.operationMode.refresh:Ad+="refreshMode";break;case AE.operationMode.edit:Ad+="editMode";break;case AE.operationMode.subscribe:Ad+="subscribeMode";break;}if(AT.simpleProgressMode){Ad+=" simpleProgressMode";}if(!AY){if((mstrApp.diParams&&mstrApp.diParams.isSparkCube)||(AV.isSparkCube)){AY=new mstrmojo.AS.DIPublishAppSchemaEditor({cssClass:Ad,operationMode:AE.operationMode.refresh,cubeId:AV.cubeId,cubeName:AV.cubeName});}else{AY=new mstrmojo.DI.DIRepublishScheduleEditor({cssClass:Ad});}}AY.open(null,AT);o=AY.id;break;case AE.dialogType.saveAsDialog:AY=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.cubesList:AY=mstrmojo.all[I];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DICubesListDialog();I=AY.id;}AY.open(null,AT);break;case AE.dialogType.refinePage:AW=mstrApp.getRootController();AY=new mstrmojo.Refine.RefinePopupPage({controller:AW});var AU=AW.refineApp.getRefinePanel();AU.slot="refinePanelNode";AY.addChildren([AU]);AY.open(null,AT);break;case AE.dialogType.refineClusteringPage:AY=new mstrmojo.Refine.RefineClusteringDialog();AY.open(null,AT);break;case AE.dialogType.refineExtractDialog:AY=new mstrmojo.Refine.RefineExtractDialog();AY.open(null,AT);break;case AE.dialogType.refineImportDialog:AW=mstrApp.getRootController();AY=new mstrmojo.Refine.RefineImportDialog();AY.open(null,AT);break;case AE.dialogType.multiFormEditor:AY=new mstrmojo.DI.DIMultiFormEditor();AY.open(null,AT);this.addDisposable(AY);break;case AE.dialogType.sheetsSelectionDialog:AY=V&&mstrmojo.all[V];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DISheetsSelectionDialog();}AY.open(null,AT);V=AY.id;break;case AE.dialogType.partitionGroupDialog:AY=J&&mstrmojo.all[J];if(!AY){AY=new mstrmojo.DI.DIPartitionGroupDialog();}AY.open(null,AT);J=AY.id;break;case AE.dialogType.parseDataDialog:var Ae=AT.id;AY=Ae&&mstrmojo.all[Ae];if(!c){c=[];}if(!AY){c.push(Ae);AY=new mstrmojo.DI.ui.dialogs.DIParseDataDialog({id:Ae,tableID:AT.tableID});}AY.open(null,AT);if(/^hdfs:.*/.test(AT.model.currentSource.fileName)){D.addClass(AY.domNode,"hadoop");}else{D.removeClass(AY.domNode,"hadoop");}break;case AE.dialogType.errorDialog:AY=AI&&mstrmojo.all[AI];if(!AY){if(AO.isWS()){AY=new mstrmojo.DI.ui.dialogs.ErrorDialog();}else{AY=mstrmojo.insert(Z);}}AY.open(null,AT);AI=AY.id;break;case AE.dialogType.warningDialog:AY=a&&mstrmojo.all[a];if(!AY){AY=mstrmojo.insert(Z);}AY.open(null,AT);a=AY.id;break;case AE.dialogType.relationDefineDialog:AY=AB&&mstrmojo.all[AB];if(!AY){AY=new mstrmojo.DI.DIRelationshipDefineEditor();}AY.open(null,AT);AB=AY.id;break;case AE.dialogType.qbImportOptionDialog:AY=x&&mstrmojo.all[x];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DIQBImportOptionDialog();}var AS=!AO.getEnvObj().isAppSchema()?[{did:"2",n:AR[1],sub:AJ[1]},{did:"3",n:AR[2],sub:AJ[2]},{did:"1",n:AR[0],sub:AJ[0]}]:[{did:"3",n:AC[3],sub:C[3]},{did:"1",n:AC[1],sub:C[1]}],Ab=!AO.getEnvObj().isAppSchema()?[{did:"0",n:AC[0],sub:C[0]},{did:"2",n:AC[2],sub:C[2]},{did:"3",n:AC[3],sub:C[3]},{did:"1",n:AC[1],sub:C[1]}]:[{did:"3",n:AC[3],sub:C[3]},{did:"1",n:AC[1],sub:C[1]}],AZ=!AO.getEnvObj().isAppSchema()?[{did:"2",n:k[1],sub:H[1]},{did:"3",n:k[2],sub:H[2]},{did:"1",n:k[3],sub:H[0]}]:[{did:"3",n:k[2],sub:H[2]},{did:"1",n:k[3],sub:H[0]}],AX=[{did:"1",n:k[0],sub:H[0]}],Ac=[{did:"2",n:k[1],sub:H[1]},{did:"3",n:k[2],sub:H[2]}];if(AT.isContainHadoop&&!mstrApp.isSingleTier){AY.set("items",Ab);}else{if(AT.isSAPHanaDDA){AY.set("items",AX);}else{if(AT.isSAPHana){AY.set("items",mstrApp.isSingleTier?Ac:AZ);}else{if(AT.isODBC){AY.set("items",AZ);}else{AY.set("items",AS);}}}}AY.set("srcInfo",AT.srcInfo);AY.open(null,AT);x=AY.id;break;case AE.dialogType.previewRenameDialog:AY=mstrmojo.all[b];if(!AY){AY=mstrmojo.insert(mstrmojo.hash.copy(AT,P));}AY.open(null,AT);this.pageZIndex++;break;case AE.dialogType.mapProjectsAttributeDialog:AY=mstrmojo.all[AK];if(!AY){AY=new mstrmojo.DI.DIProjectsAttribute();}AY.set("attribute",AT.attribute);AY.set("formMaps",AT.formMaps);AY.set("projectAttribute",null);AY.set("projectFormMaps",null);AY.open(null,AT);AY.updateHintText();AK=AY.id;break;case AE.dialogType.mapProjectsAttributeDialog2:AY=new mstrmojo.DI.ui.dialogs.DIMapProjectAttributeDialog(AT);AY.open(null,AT);this.addDisposable(AY);break;case AE.dialogType.objectPicker:AY=new mstrmojo.vi.ui.editors.ObjectPicker(AT);if(AT.oTypes){AY.browsableTypes=t.hash(AT.oTypes);AY.ob.browsableTypes="8,"+AT.oTypes.join(",");}this.addDisposable(AY);AY.open();break;case AE.dialogType.twitterAdvOptDialog:AY=mstrmojo.all[w];if(!AY){AY=new mstrmojo.DI.DITwitterAdvancedOptions(AT);}AY.open(null,AT);break;case AE.dialogType.binaryUploadDialog:AY=new mstrmojo.DI.ui.dialogs.DIBinaryUploadDialog(AT);AY.open(null,AT);this.addDisposable(AY);break;case AE.dialogType.authenticationDialog:AY=new mstrmojo.DI.ui.dialogs.DIAuthenticationDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.hadoopGatewayManagerDialog:AY=new mstrmojo.DI.ui.dialogs.DIHadoopGatewayManagerDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.hadoopGatewayDialog:AY=new mstrmojo.DI.ui.dialogs.DIHadoopGatewayDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.sharingDialog:AY=mstrmojo.all[E];if(!AY){AY=new mstrmojo.SharingEditor(S.copy(AT,{id:E}));}else{S.forEach(AT,function(Ag,Af){this.set(Af,Ag);},AY);}AY.open();break;case AE.dialogType.hierarchyAttributeDialog:AY=new mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.hierarchyAttributeResetDialog:AY=new mstrmojo.DI.ui.dialogs.DIHierarchyAttributeResetDialog();this.addDisposable(AY);AY.open(null,AT);break;case AE.dialogType.addConnectorDialog:AY=AQ&&mstrmojo.all[AQ];if(!AY){AY=new mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog();}this.addDisposable(AY);AY.open(null,S.copy(AT,{title:mstrmojo.desc(15061,"Add a New connector"),isNew:true,name:"",url:"",desc:"",introductionUrl:"",iconData:"",oid:"",type:AE.authMode.ANONYMOUS,user:"",pwd:"",isMstrcc:false}));AQ=AY.id;break;}if(AY){mstrmojo.dom.center(AY.editorNode);mstrmojo.css.toggleClass(AY.domNode,"mstrmojo-di-popup-dialog",true);AO.reevaluatePopupPosition(AY.editorNode);}return AY;}});var g;mstrmojo.DI.controller.DIDialogController.showErrorDialog=function(AT,AY,AX,AW,AV){var AS,AU={title:AW||(mstrApp.isSingleTier?(!!mstrApp.isWorkstation?mstrmojo.desc(null,"MicroStrategy Workstation"):mstrmojo.desc(14296,"MicroStrategy Desktop")):mstrmojo.desc(3610,"MicroStrategy Web")),errorMessage:AT,detailErrorMessage:AY||"",onOK:AX||null};if(AV){mstrmojo.hash.copy(AV,AU);}AS=g&&mstrmojo.all[g];if(!AS){AS=mstrmojo.insert(Z);}AS.open(null,AU);g=AS.id;};mstrmojo.DI.controller.DIDialogController.showConnectionError=function(){var AV=null;mstrmojo.DI.controller.DIDialogController.hideConnectionError=function(){mstrmojo.all[AV].close();};var AS=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),AU='<a href="" onclick=" mstrmojo.DI.controller.DIDialogController.hideConnectionError(); delete  mstrmojo.DI.controller.DIDialogController.hideConnectionError; window.FormWrapper.showProxyEditor();return false;">'+mstrmojo.desc(14125,"settings")+"</a>";AS=AS.replace("#",AU)+".";var AT=mstrmojo.insert(Z);AT.open(null,{title:mstrmojo.desc(11812,"Notification"),errorMessage:AS,detailErrorMessage:"",onOK:AT.close()});AV=AT.id;};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.Button","mstrmojo.DI.DIDataService","mstrmojo.DI.DIConstants","mstrmojo.Editor","mstrmojo.dom","mstrmojo.DI.DIObjectBrowser","mstrmojo.Refine.Refine","mstrmojo.Refine.RefinePopupPage","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIRelationshipDefineEditor","mstrmojo.DI.DINavigationController","mstrmojo.DI.controller.DIScheduleController","mstrmojo.DI.controller.DIDialogController","mstrmojo.DI.controller.DIFormsController","mstrmojo.DI.controller.DIPartitionController","mstrmojo.DI.controller.DIOAuthController","mstrmojo.DI.controller.DIMappingMenuController","mstrmojo.DI.controller.DIMappingController","mstrmojo.DI.controller.DIDirectAccessController","mstrmojo.DI.controller.DIHadoopController","mstrmojo.DI.controller.DIPublishController","mstrmojo.DI.controller.ImportController","mstrmojo.DI.controller.DIDocController","mstrmojo.DI.controller.DIRemoteProjectsController","mstrmojo.DI.controller.DIAllObjectsViewController","mstrmojo.DI.controller.DIHadoopGatewayController","mstrmojo.QueueNative","mstrmojo.vi.models.OneTierServerTransport","mstrmojo.DI.WorkstationServerTransport");mstrmojo.requiresDescs(212,218,219,221,422,640,773,1302,1442,9117,9118,9119,12581,12609,12611,12612,12618,12619,12624,12626,12770,12771,12772,12773,12774,12775,12776,12777,12778,12779,12780,12781,12782,12783,12784,12785,12786,12787,12788,12789,12790,12791,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12900,13264,13265,13278,13279,13280,13282,13320,13321,13322,13323,13324,10065,13104,13100,11465,9229,9228,9220,9221,9222,9223,9224,9225,9226,9227,9230,13445,13446,13646,13883,13914,13991,14096,14097,14155,14205,14206,14207,14610,14657,14658,14707,14869,14870,14888,14889,14890,14891,14892,15207,15208,11812,16032);var Ac=mstrmojo.DI.DIConstants,Bt=mstrmojo.hash,Bl=mstrmojo.array,p=mstrmojo.func,A2=mstrmojo.desc,Bo=mstrmojo.Button.newWebButton,Ap=mstrmojo.DI.DIExitOptions,BA=mstrmojo.DI.DIHelpers,As=mstrmojo.string,j=4000,A4="TABLENAME=",Ao=1024*1024,An="#DESCRIPTION#INTRODUCTION#";var BF=Ac.actions;var w;function Az(CB){CB=CB.toLowerCase();CB=CB.replace(/\s+/g," ");return(CB.indexOf("file://")===0)||(CB.indexOf("ftp://")===0)||(CB.indexOf("http://")===0)||(CB.indexOf("https://")===0)||(CB.indexOf("hdfs://")===0);}function g(CE,CC,CB,CF){var CD=mstrmojo.array.find(CB[CE].sheetsInfo,"index",CC);if(CB[CE].sheetsInfo.length!==0){if(CD>=0){CB[CE].sheetsInfo[CD].isAutoMapped=true;CB[CE].sheetsInfo[CD].isAutoMapppingSuccessed=CF;}}else{CB[CE].isAutoMapped=true;CB[CE].isAutoMapppingSuccessed=CF;}}function k(CC){var CD,CE,CI,CH,CG,CF,CB;for(CD in CC){CI=CC[CD].sheetsInfo;CH=CC[CD].sourceInfo;CG=CH&&CH.partition.isPartition;if(this.model.operationMode===Ac.operationMode.edit){if(CH){continue;}}CB=CC[CD].subtype;if(CB===Ac.sourceSubtype.localFile||CB===Ac.sourceSubtype.url||CB===Ac.sourceSubtype.samplefile||CB===Ac.sourceSubtype.publicData||CB===Ac.sourceSubtype.cloudElement){if(CC[CD].isMergedCube){continue;}if(!CI){return false;}if(CI.length===0){if(!CC[CD].isAutoMapped){return false;}}CF=false;for(CE=0;CE<CI.length;CE++){if(!CI[CE].isAutoMapped&&CI[CE].selected&&!CG){return false;}else{if(CI[CE].isAutoMapped&&CI[CE].selected&&CG){CF=true;}}}if(CG&&!CF){return false;}}}return true;}function CA(CC,CG){var CD,CE,CH,CB;var CF=false,CI=true;for(CD in CC){CH=CC[CD].sheetsInfo;CB=CC[CD].subtype;if(this.model.operationMode===Ac.operationMode.edit||CG===Ac.actions.importSource){if(CC[CD].sourceInfo){continue;}}if(CB===Ac.sourceSubtype.localFile||CB===Ac.sourceSubtype.url||CB===Ac.sourceSubtype.samplefile||CB===Ac.sourceSubtype.hadoop||CB===Ac.sourceSubtype.publicData||CB===Ac.sourceSubtype.cloudElement){if(CC[CD].isMergedCube){continue;}if(CH.length===0){if(CC[CD].isAutoMapped&&!CC[CD].isAutoMapppingSuccessed){CF=true;}else{if(CC[CD].isAutoMapped&&CC[CD].isAutoMapppingSuccessed){CI=false;}}}else{for(CE=0;CE<CH.length;CE++){if(CH[CE].isAutoMapped&&!CH[CE].isAutoMapppingSuccessed){CF=true;}else{if(CH[CE].isAutoMapped&&CH[CE].isAutoMapppingSuccessed){CI=false;}}}}}}if(CI){return 3;}if(CF){return 2;}return 1;}var Ar="sheetsDialog",J={scriptClass:"mstrmojo.Editor",id:Ar,cssClass:"mstrmojo-di-sheetsDialog",width:"300px",model:null,onOpen:function(){this.closeNode.style.display="none";this.helpNode.style.display="none";},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button primary-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var CC=this.parent.parent;var CB=Ac.requestFlag.preview|Ac.requestFlag.mapping|Ac.requestFlag.transformations|Ac.requestFlag.sourceInfo|Ac.requestFlag.sheets|Ac.requestFlag.anyState;if(mstrApp.isEMMACube){mstrApp.getRootController().editImportedDataEMMA(CB,CC.children[0].preShtsPD.selectedIndex,null,null);}else{mstrApp.getRootController().editImportedData(CB,CC.children[0].preShtsPD.selectedIndex,null,null);}CC.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button secondary-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();this.parent.parent.destroy();}}],children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12581,"Select Sheet to Import:")},{scriptClass:"mstrmojo.Pulldown",alias:"preShtsPD",cssClass:"mstrmojo-di-sheetsDialog-pulldown",bindings:{items:function(){var CB=mstrApp.getRootController().getModel();var CE=CB.currentSource.sheets;var CD=[];var CC;if(CE){for(CC=0;CC<CE.length;CC++){if(CE[CC]!=="*"){CD.push({dssid:CC,n:CE[CC].name});}}}return CD;},defaultSelection:function(){var CC=mstrApp.getRootController().getModel();var CB=0;if(CC.currentSource.sourceInfo){CB=mstrmojo.array.find(CC.currentSource.sheets,"index",CC.currentSource.sourceInfo.sheetIndex);if(CB<0){CB=0;}}return CB;}}}]}]},B1="refreshOptions",e={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-refresh-dialog",id:B1,showTitle:true,zIndex:10000,title:mstrmojo.desc(12770,"Refresh Data Options"),onOpen:function(){var CB=this.curtainNode.style;CB.background="black";CB.opacity=0.5;CB.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.RadioList",alias:"radiolist",itemCssClass:"mstrmojo-di-refresh-options",items:[{did:"1",n:mstrmojo.desc(9117,"Replace existing data")},{did:"4",n:mstrmojo.desc(9118,"Update existing data and add new data")},{did:"2",n:mstrmojo.desc(9119,"Keep existing data and add new data")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(){var CB=this.parent.parent;CB.model.refresh_opt=CB.radiolist.selectedItem.did;if(CB.onOK){CB.onOK();}CB.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var CB=this.parent.parent;if(CB.onCancel){CB.onCancel();}CB.close();}}]}]};function Au(CE){var CB=this,CD=[];function CC(){window.setTimeout(function(){CB.dialogController.close(Ac.dialogType.publishStatusDialog);CB.dialogController.destroyAll();var CF=mstrApp.container;if(CF){mstrApp.hideProgress(true);mstrApp.container.close();if(CF.dataImportCallback){CF.dataImportCallback(CD);}}else{if(!BA.isServerBasedWS()){mstrApp.redirectToPage(Ap.getRedirectParams(Ap.pageRedirect.flashVI,CB.model.cubeID,CB.model.isDirectDataAccess));}else{CB.shutDownServerBased(JSON.stringify({}));}}},0);}if(CE!==undefined){CD=[{acg:255,did:CE,st:779,t:3,mngd:CB.getModel().isManagedCube,isDDA:CB.getModel().isDirectDataAccess}];}if((CB.getModel().isManagedCube||mstrApp.isSingleTier)&&CE!==undefined){CB.getDocController().getVIDocData({success:function(CF){CD[0]=CF&&CF.datasets&&CF.datasets[CE];if(CD[0]){CD[0].did=CE;}CC();}});}else{CC();}}function B5(CF,CB){var CC="";var CH;if(CF){CH=this.model.getImportSource(CF).getMappingChanges();}else{CH=this.model.currentSource.getMappingChanges();}var CE,CG,CD;if(CH.length>0){CC+="<mpcs>";}for(CE=0;CE<CH.length;CE++){CG=CH[CE];CC+="<mpc ";for(CD in CG){if(CG[CD]!==undefined){CC+=CD+'="'+CG[CD]+'" ';}}if(CB){CC+='fg="'+CB+'" ';}CC+=" />";}if(CH.length>0){CC+="</mpcs>";}return CC;}function Aq(){var CD=this.model.operationMode;var CC=this,CB={success:function(){if(mstrApp.diParams.ImportDatabase&&CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.enterCredentials){CC.getDBMSObjects();}if(CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.enterCredentials){CC.getAuthenticationDBRoles();}if(!mstrApp.diParams.disableCESource){CC.getCloudElementDBRoles();}if(!mstrApp.diParams.disableCustomerConnector){CC.getCustomConnector();}}};if(mstrApp.isSingleTier){this.dataService.getPreferences({success:function(CG){var CF=CG&&(CG.diConnectorConfig||CG.diconnectorConfig);if(CF){if(typeof CF==="string"){try{CF=JSON.parse(CF);}catch(CH){CF=null;}}mstrApp.diParams.connectorConfig=CF;if(CF&&(CF.resourceConfig||CF.dbRoleConfig)){CC.getModel().populateSourceListAdminConfig(CF.resourceConfig,CF.dbRoleConfig);}}CC.oAuthController.getExternalSourcesInfo();if(CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.enterCredentials){CC.getAuthenticationDBRoles();}if(CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.enterCredentials){CC.getDBMSObjects();}if(!mstrApp.diParams.disableCESource){CC.getCloudElementDBRoles();}if(!mstrApp.diParams.disableCustomerConnector){CC.getCustomConnector();}}},{fordiConnectorConfig:true});}else{this.getDIProjectSettings(CB);}if(CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.enterCredentials){this.fetchSampleFileList();}if(!mstrApp.isSingleTier&&!BA.isServerBasedWS()&&!BA.getEnvObj().isWSLiveMode()){mstrmojo.locales.load(mstrmojo.emptyFn);}if(!BA.isOnetier()&&CD!==Ac.operationMode.refresh&&CD!==Ac.operationMode.subscribe&&CD!==Ac.operationMode.edit){if(!this.model.analysisID){var CE={op:Ac.getCubeQuotaAndInfosOptions.GetCubeQuotaAndInfosQuotaOnly};this.getCubeQuota(null,CE);}this.getShapekeys();}}function AU(CC){var CD=CC.code;var CE=CC.message;if(CD===null||CD===undefined){CE=CC.getResponseHeader("X-MSTR-TaskFailureMsg");}var CF=CE.indexOf("("),CB=CE.lastIndexOf(")");if(CF>=0&&CB>CF){CE=CE.substring(CF+1,CB);}return CE;}function B7(CD){var CC=this;var CF=[];var CB=[];var CE=CC.rootView.currentPage;var CG="<ul>";mstrmojo.hash.forEach(CD.files,function(CH){if(CH.failed===true){CB.push(CH.fileName);CG+="<li>"+CH.fileName+"<br>"+AU(CH.errRes)||" </li>";}else{CF.push(CH.fileName);}});CG+="</ul>";CE.set("forceEnable",CF.length>0?true:false);if(CE.setFilesObject){CE.setFilesObject(CB);}CC.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CG);}function l(CE,CF){var CB=[],CC=mstrApp.getRootController(),CD=CC.getModel();Bl.forEach(CE,function(CG){if(CD.getImportSource(CG)){CB.push(CG);}});if(CB.length>0){CC.removeEMMASourceTable(CF,{did:CB.join()});}else{if(CF.success){CF.success();}if(CF.complete){CF.complete();}}}function A5(CB){CB=CB.split("&").join("&amp;");CB=CB.split("<").join("&lt;");CB=CB.split(">").join("&gt;");CB=CB.split("%").join("&#37;");return CB;}function A6(CG){var CD=this.getModel().importSources,CE,CC,CF=[],CB=false;for(CE in CD){if(CD.hasOwnProperty(CE)&&CD[CE].isHierarchyRelationTable()&&CD[CE].shouldDoNotImportHierarchy()){CC=CD[CE].currentMapping;Bl.forEach(CC,function(CI){var CJ=false;if(CI.subColumns&&(CI.subColumns.length>0)){for(var CH=0;CH<CI.subColumns.length;CH++){if(CI.subColumns[CH].recursive===true){CJ=true;}}}CI.selected=!!CI.recursive||CJ;});CF=CF.concat(CC);CB=true;}}if(CF.length>0){this.mappingController.setMultipleImport(CF,CG,true);}return CB;}function BY(CD,CC){var CB=CD.indexOf(An);if(CB<0){return CC==="desc"?CD:"";}else{return CC==="desc"?CD.substring(0,CB):CD.substring(CB+An.length,CD.length);}}mstrmojo.DI.DIRootController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRootController",start:function BZ(){var CB=this.rootView;this.dataService=new mstrmojo.DI.DIDataService();this.navigationController=new mstrmojo.DI.DINavigationController();this.dialogController=new mstrmojo.DI.controller.DIDialogController();this.formsController=new mstrmojo.DI.controller.DIFormsController();this.partitionController=new mstrmojo.DI.controller.DIPartitionController();this.mappingMenuController=new mstrmojo.DI.controller.DIMappingMenuController();this.mappingController=new mstrmojo.DI.controller.DIMappingController();this.hadoopController=new mstrmojo.DI.controller.DIHadoopController();this.oAuthController=new mstrmojo.DI.controller.DIOAuthController();this.projectController=new mstrmojo.DI.controller.DIRemoteProjectsController();this.allObjectsController=new mstrmojo.DI.controller.DIAllObjectsViewController();this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();if(BA.getEnvObj().isWSDossierLocalMode()){w=new mstrmojo.QueueNative({transport:mstrmojo.vi.models.OneTierServerTransport});}else{if(BA.getEnvObj().isWSDataSet()||BA.getEnvObj().isWSLiveMode()){w=new mstrmojo.QueueNative({transport:mstrmojo.DI.WorkstationServerTransport});}else{w=new mstrmojo.QueuedXHR();}}mstrApp.taskQueue=w;this.model.initParams(mstrApp.diParams);CB.render();this.addDisposable(CB);this.addDisposable(this.model);this.addDisposable(this.dataService);this.addDisposable(this.dialogController);this.addDisposable(this.navigationController);Aq.call(this);},getModel:function BB(){return this.model;},getDataService:function Be(){return this.dataService;},getMappingMenu:function Ba(CB){return this.mappingMenuController.getMappingMenu(CB);},forceImport:true,fetchPreview:true,refineApp:null,scheduleController:null,ddaController:null,tablesSrc:{},deleteObject:function BR(CC,CB){this.dataService.deleteObject(CC,CB);},renameObject:function P(CC,CB){this.dataService.renameObject(CC,CB);},getScheduleController:function Bc(){if(this.scheduleController===null){this.scheduleController=new mstrmojo.DI.controller.DIScheduleController();}return this.scheduleController;},getDDAController:function B6(){if(this.ddaController===null){this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();}return this.ddaController;},getDialogController:function BE(){if(this.dialogController===null){this.dialogController=new mstrmojo.DI.controller.DIDialogController();}return this.dialogController;},getImportController:function(){if(!this.importController){this.importController=new mstrmojo.DI.controller.ImportController();}return this.importController;},getDocController:function(){if(!this.docController){this.docController=new mstrmojo.DI.controller.DIDocController();}return this.docController;},getHadoopGatewayController:function(){var CB=this;if(!this.hadoopGatewayController){this.hadoopGatewayController=new mstrmojo.DI.controller.DIHadoopGatewayController({rootController:CB});}return this.hadoopGatewayController;},showPage:function BL(CB,CC,CE,CD){if(CB===Ac.pageType.emmaPreview&&this.dialogController.pageZIndex>0){this.rootView.parent.close();return null;}if(!this.rootView.parent){this.rootView.parent=mstrApp.container;}if(mstrApp.container&&!mstrApp.container.rootView){mstrApp.container.rootView=this.rootView;}if(!CE){if(this["getNewPageSlotForPage"+CB]){CE=this["getNewPageSlotForPage"+CB]();}else{CE=this.navigationController.getPageSlot();}}if(CE.getConfig()&&CE.getConfig().newPage){this.showDialog(Ac.dialogType.diPageDialog,CE.getConfig().newPageConfig);}return this.rootView.showPage(CB,CC,CE,CD);},getNewPageSlotForPage6:function(){var CE=this,CH=CE.navigationController.getPageSlot(),CD=CE.model,CC=true,CG=false,CB,CF=(CD.operationMode===Ac.operationMode.create);Bt.forEach(CD.importSources,function(CI){CC=false;if(CI.databaseType===j&&CI.xdaType===Ac.xdaType.qbSingleTable){CG=true;return false;}else{CB=true;}});CH.setConfig({properties:{hasDDAOnlySource:CC,isFilterDDA:CF,isSAPHana:CG,hasNonSAPHana:CB}});return CH;},showSheetsSelectionDialog:function AE(CF,CN,CX,CT,CM,CD){var CW;var CQ,CO,CU,CE,CR,CL=[],CS,CI=false,CJ=0;var CG=CF||this.model.getAllTableID();for(CQ=0;CQ<CG.length;CQ++){CU=this.model.importSources[CG[CQ]];CE=CU.sheetsInfo;CR=[];var CY;if(CE){if(CE.length>1){CI=true;if(CU.currentIndex&&CU.currentIndex!==-1){CJ=Bl.find(CE,"index",CU.currentIndex);if(CJ<0){CJ=0;}}for(CO=0;CO<CE.length;CO++){if(CO===CJ){CR.push({idx:CO,n:CE[CO].name,selected:true,title:CE[CO].name});}else{CR.push({idx:CO,n:CE[CO].name,title:CE[CO].name});}}var Ca=this.model.importSources[CG[CQ]].sourceInfo;var CH=this.model.importSources[CG[CQ]].currentMapping;if(this.model.operationMode===Ac.operationMode.create){if(CH){CS=Ca&&Ca.partition.isPartition?true:false;}else{CS=true;}}else{if(Ca&&Ca.partition.type!==0){CS=true;}else{if(!Ca){CS=true;}else{CS=false;}}}if(CM&&CM.files){for(var CZ in CM.files){if(CM.files[CZ].tableID===CG[CQ]){if(BA.getEnvObj().isWSDossierLocalMode()){if(typeof CM.files[CZ].fileName!=="undefined"){CY=BA.getAbsoluteFileName(CM.files[CZ].fileName);}}else{CY=CM.files[CZ].fileName;}}}}CL.push({n:CY||CU.fileName||CX||CU.dbTableName,id:CU.tableID,sheets:CR,multiSelection:CS,defaultSheetsIndex:CJ});}}}if(CI){CW={items:CL,onOK:function(){var Cb=this;var Ck=this.items;var Cq=mstrApp.getRootController(),Ci=Cq.model,Ce=Ci.importSources,Cg=this.items[0].id,Cy=Ci.importSources[Cg].sourceInfo,Cs,Cx={},Cn,Cu,Cm,Cp,Cc;var Co=function(Cz){return Cz.selected;};mstrmojo.array.forEach(this.items,function(Cz){CE=Ce[Cz.id].sheetsInfo;mstrmojo.array.forEach(CE,function(C1,C0){if(Cz.sheets[C0].selected){C1.selected=true;}else{C1.selected=false;}});});function Ch(Cz){var C0=[];mstrmojo.hash.forEach(Ce[Cz].sheetsInfo,function(C1){if(C1.selected){C0.push({name:C1.name,index:C1.index});}});return C0;}if((Ci.operationMode===Ac.operationMode.create&&(Cy&&!Cy.partition.isPartition))||!Cy){for(Cs=0;Cs<Ck.length;Cs++){Cg=Ck[Cs].id;Cm=mstrmojo.array.filter(Ce[Cg].sheetsInfo,Co);Cu=Cm.length;Cp=Cu>1;for(CQ=0;CQ<Cu;CQ++){if(Cp){Cx.behaviorFlags=Ac.behaviorChangeFlag.multiSheet;}Cn=Cm[CQ].index;if(CQ===0){Cx.shtIx=Cn;Cq.autoMappingSourceTable(CD,Cg,Cx,Cg,CN,CM);}else{Cc=Cx.tbid=Cg;if(mstrmojo.all[CT].scriptClass==="mstrmojo.DI.DIHadoop"){var Cr=Cq.rootView.hadoopPage.getDropZone();Cx.url=Ce[Cg].fileName;var Cd="?hdfsURL=";var Cv={};for(CZ in Cr.fileTypeMap){var Cw=CZ.indexOf(Cd);var Cj=Cw>=0?CZ.substring(Cw+Cd.length):CZ;Cv[Cj]=Cr.fileTypeMap[CZ];}if(Cv&&Cv[Cx.url]){Cx.fileType=Cv[Cx.url];}else{Cx.fileType=BA.extractFileExtensionFromHadoopURL(Cx.url);}Cx.xt=(Cx.fileType.toUpperCase()===Ac.fileTypes[0].v)?Ac.xdaType.dataImportFileText:Ac.xdaType.dataImportFileExcel;}Cq.createEMMASourceTableMultiSheets(Cx,Cn,Cc,Ce[Cg].type,Ce[Cg].subtype,CN,CT);}}Cx={};}}else{var Ct=Cb.filesAndSheets.rightPanel.sheets;var Cf;Cm=Ci.importSources[Cg].sheetsInfo;Cu=Cm.length;if(Cy&&Cy.partition&&Cy.partition.isPartition){Cf=Ct.selected.selectedIndices;for(CQ=0;CQ<Cu;CQ++){if(Cf[CQ]){Cm[CQ].selected=true;}else{Cm[CQ].selected=false;}}Cq.setPartition(Cg);}else{Cf=Ct.selected.selectedIndex;if(Cf===-1){var Cl=Ct.selected.selectedIndices;for(CQ in Cl){if(Cl.hasOwnProperty(CQ)&&Cl[CQ]){Cf=parseInt(CQ);break;}}}for(CQ=0;CQ<Cu;CQ++){if(CQ!==Cf){Cm[CQ].selected=false;}}Cm[Cf].selected=true;Cn=Cm[Cf].index;Cx.shtIx=Cn;Cq.setDataImportInfo(Cg,Cx,Cg,CN,CM,CD);}}Cb.destroy();},onBack:function(){var Ce=this,Cc=mstrApp.getRootController(),Cd=this.items,Cf=[],Cb=Cc.model.importSources,Cg={success:function(Ch){Cc.dataService.set("messageID",Ch.msgid);Bl.forEach(Cf,function(Ci){delete Cb[Ci];});Ce.unrender();},failure:function(Ch){Cc.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,Ch.message||"");}};if(mstrmojo.all[CT]&&!mstrmojo.all[CT].tableID){Bl.forEach(Cd,function(Ch){Cf.push(Ch.id);});Cc.removeEMMASourceTable(Cg,{did:Cf.join()});}else{delete Cb[Cd[0].id].sheetsInfo;Cb[Cd[0].id].sheetsInfo=Cb[Cd[0].id].originalSheetsInfo;Ce.unrender();}}};var CB=this.model.importSources;if(CB[CG[0]].tableIdx>=0){var CP;var CC,CV={};var CK=mstrApp.getRootController();for(CP=0;CP<CL.length;CP++){CC=CL[CP].id;CV.shtIx=CB[CG[CP]].tableIdx;CK.autoMappingSourceTable(CP===CL.length-1?CD:null,CC,CV,CC,CN,CM);CV={};}}else{this.showDialog(Ac.dialogType.sheetsSelectionDialog,CW);}}},restoreForLaunchingApp:function E(){var CB=this;var CD=CB.model;var CF=mstrApp.launchingApp;var CC=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;var CE;switch(CF){case"QB":CE=mstrApp.tableID;if(mstrApp.messageID){CB.dataService.set("messageID",mstrApp.messageID);CB.getImportedDataEMMA(BF.importSource,CC);}break;default:if(CD.operationMode===Ac.operationMode.create){CB.showPage(Ac.pageType.dataSelection);}else{if(CD.operationMode===Ac.operationMode.enterCredentials){CB.showDialog(Ac.dialogType.credentialsDialog,{model:CD.documentModel});}else{if(mstrApp.isEMMACube&&(CD.operationMode===Ac.operationMode.refresh)){if(CB.model.datasets){CB.showDialog(Ac.dialogType.cubesList,{left:"200px"});}else{this.republishEMMACube();}}else{if(mstrApp.isEMMACube&&(CD.operationMode===Ac.operationMode.subscribe)){this.republishEMMACube();}else{if(CD.operationMode===Ac.operationMode.pickTable){CB.showPage(Ac.pageType.database,{sourceType:Ac.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:Ac.xdaType.qbSingleTable,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId}});}else{if(CD.operationMode===Ac.operationMode.hadoopPickTable){CB.showPage(Ac.pageType.database,{sourceType:Ac.sourceType.querybuilder,name:"hadoop",step2:mstrmojo.desc(12460,"Select one or more tables"),type:Ac.xdaType.qbSingleTable,subtype:Ac.sourceSubtype.hadoop,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId,isHadoopQB:true}});}else{if(CD.operationMode===Ac.operationMode.ffsql){CB.showPage(Ac.pageType.database,{sourceType:Ac.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:Ac.xdaType.ffsql,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId}});}else{if(CD.operationMode===Ac.operationMode.hadoopFFsql){CB.showPage(Ac.pageType.database,{sourceType:Ac.sourceType.querybuilder,name:"hadoop",step2:mstrmojo.desc(12460,"Select one or more tables"),type:Ac.xdaType.ffsql,subtype:Ac.sourceSubtype.hadoop,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId,isHadoopQB:true}});}else{this.fetchCubeInfoEMMA();}}}}}}}}break;}},checkAndShowPrivilegeMsg:function Ax(){var CB=this,CD=this.getModel(),CC=CD.hasPrivilegesForAllTables(Bt.valarray(CD.importSources)),CE=mstrmojo.desc(13914,"You do not have the right privilege to make changes. Contact your administrator."),CF;CF=function(){CB.cancelApplication();};if(!CC){mstrmojo.alert(CE,CF,"",CB.getDialogController().getNextZIndex());}return CC;},setModalNodes:function(CE,CD,CC){var CB=[];CB=CB.concat(CE);if(CD!==false){CB.push(this.rootView.footerNode);}return this.rootView.setModalNodes(CB,CC);},clearModalNodes:function(){return this.rootView.clearModalNodes();},getCubeInfo:function AA(CC){var CB=this,CD={success:function(CE){var CF=mstrmojo.hash.copy(CB.model.cubesInfo);mstrmojo.hash.forEach(CF.cubes.cube,function(CG){if(CG.cube_id===CC){CG.mdt=CE[CC].mdt;}});CB.model.set("cubesInfo",-1);CB.model.set("cubesInfo",CF);}};this.dataService.getUserDICubeInfo(CD,{cubeIds:CC});},getCubeQuota:function AY(CB,CC){if(BA.isWS()){this.getCubeQuotaForRest(CB);}else{this.getCubeQuotaForWeb(CB,CC);}},getCubeQuotaForWeb:function(CB,CD){var CC=this;var CE={success:function(CF){if(!mstrApp.diParams){return ;}if(CF.cubes&&CF.cubes.cube){CF.cubes.cube=[].concat(CF.cubes.cube);}if(CF.cubes&&CF.cubes.doc){CF.cubes.doc=[].concat(CF.cubes.doc);}CC.model.set("cubesInfo",CF);},failure:function(){CC.model.set("cubesInfo",-1);}};if(CB){CE=mstrmojo.func.wrapMethods(CE,CB,{});}mstrApp.serverRequestParallel(mstrmojo.hash.copy(CD,{taskId:"qBuilder.GetQuota"}),CE);},getCubeQuotaForRest:function(CB){var CC=this;var CD={success:function(CG){if(CG&&CG.usage!==undefined&&CG.size!==undefined){var CF=(CG.size<=0)?CG.size:CG.size/Ao;var CE={cubes:{cusage:CG.usage/Ao,cquota:CF}};CC.model.set("cubesInfo",CE);}else{CC.model.set("cubesInfo",-1);}},failure:function(){CC.model.set("cubesInfo",-1);}};if(CB){CD=mstrmojo.func.wrapMethods(CD,CB,{});}this.dataService.getCubeQuotaByRestAPI(CD);},openMailClient:function BX(CB){this.getDataService().openMailClient(CB);},displayCubesInfo:function BM(){var CD=this,CC=Ac.dialogType.cubesList;if(this.model.cubesInfo===0){var CB=mstrmojo.desc(14657,"We are still fetching your cubes information. Please try again later."),CE=mstrmojo.desc(14658,"Cube Quota Unavailable");this.displayWarning(CB,CE);return ;}if(this.model.cubesInfo===-1){return ;}if(CD.getDialogController().hasDialog(CC)){CD.showDialog(CC,{left:"200px"});}else{CD.getScheduleController().updateScheduleAndStatus({complete:function(){CD.showDialog(CC,{left:"200px"});}});}},openOAuthParaDialog:function BI(CC,CB){this.showDialog(Ac.dialogType.setOAuthParaDialog,CB);},openWhiteListDialog:function AJ(CC,CB){this.showDialog(Ac.dialogType.setWhiteListDialog,CB);},openEditConnectorDialog:function BK(CC,CB){this.showDialog(Ac.dialogType.addConnectorDialog,CB);},getAnalyticsWebProperties:function Bz(CB){this.oAuthController.getAnalyticsWebProperties(CB);},getAnalyticsProfiles:function A1(CC,CB){this.oAuthController.getAnalyticsProfiles(CC,CB);},getOAuthSourceReports:function AZ(CD,CC,CF,CE,CB){this.oAuthController.getOAuthSourceReports(CD,CC,CF,CE,CB);},oAuthSourceBrowserFunction:function(CC,CD,CE,CB){this.oAuthController.oAuthSourceBrowserFunction(CC,CD,CE,CB);},oAuthSourceFetchFunction:function(CB,CC){this.oAuthController.oAuthSourceFetchFunction(CB,CC);},projectSourceBrowserFunction:function(CC,CB,CF){var CD=this;var CE={success:function(CG){var CH=CD.parseProjectSourceFolder(CG);CC.set("fileList",CH);},failure:function(){CC.set("fileList",[]);}};this.getProjectSourceFolderContents(CE,CB,CF);},getProjectSourceFolderContents:function f(CE,CD,CB){var CC={objectType:"8,768,769,774,776",dbrid:CB};if(CD){CC.objectId=CD;}this.dataService.fetchRemoteFolderContents(CE,CC);},parseProjectSourceFolder:function BJ(CE){if(!CE.items){return[];}var CG=CE.items,CC=[],CB,CF,CD;if(!CG.length){return[];}for(CD=0;CD<CG.length;CD++){CB=CG[CD];CF={isFolder:false};switch(CB.t){case 8:CF.isFolder=true;if(CB.isc===true){CF.type="shortcut";CF.iconFolderClosed="mstrmojo-di-tree-node-icon shortcut-closed";CF.iconFolderOpen="mstrmojo-di-tree-node-icon shortcut-open";}else{CF.type="folder";}break;case 3:switch(CB.st){case 768:CF.type="grid";break;case 769:CF.type="graph";break;case 774:CF.type="gridGraph";break;case 776:CF.type="cube";break;case 779:CF.type="emmaCube";break;}break;}CF.n=CB.n;CF.address=CB.did;CF.desc=CB.desc;CC.push(CF);}return CC;},getOAuthSourceFolderContents:function Ay(CB,CC,CD){this.oAuthController.getOAuthSourceFolderContents(CB,CC,CD);},oneTierImportFile:function AK(CC,CB){this.dataService.oneTierImportFile(CC,CB);},launchOneTierBrowser:function B(CB){this.dataService.launchOneTierBrowser(CB);},scrapeWiki:function A9(CD,CB){var CC=this,CF={success:function(CG){mstrApp.hideProgress();if(CB){CC.model.populateWikiSuggestions(CG);}else{CC.model.populateWikiSearchResults(CG);}},failure:function(CG){mstrApp.hideProgress();if(CB){CC.model.populateWikiSuggestions([undefined,[]]);}else{CC.displayError(mstrmojo.desc(640,"Your request could not be processed due to a server error."),false,CG.message);}},canceled:function(){mstrApp.hideProgress();if(CB){CC.model.populateWikiSuggestions([undefined,[]]);}else{CC.model.populateWikiSearchResults([]);}}},CE={searchString:CD};if(CB){CE.shouldSuggest=true;}this.getDataService().scrapeWiki(CF,CE);},parseOAuthSourceFolder:function x(CC,CB){return this.oAuthController.parseOAuthSourceFolder(CC,CB);},readyForSubscription:function BO(){mstrmojo.all.mstrOAuthFW.set("oAuthReady",true);},sourceSelected:function t(CB){if(CB){this.rootView.showFooter({next:{enabled:true}});this.rootView.showFooter({finish:{enabled:true}});this.forceImport=true;}else{this.rootView.showFooter({next:{enabled:false}});this.rootView.showFooter({finish:{enabled:false}});}},enableFinishButton:function BH(CB){if(CB){this.rootView.showFooter({finish:{enabled:true}});}else{this.rootView.showFooter({finish:{enabled:false}});}this.sourceSelected(CB);},showPreview:function Bi(CB){var CC=false;if(this.model.operationMode===Ac.operationMode.create){CC=true;}if(CB){this.rootView.showFooter({next:{text:mstrmojo.desc(212,"Continue"),enabled:CC}});}else{this.rootView.showFooter({next:{text:mstrmojo.desc(1302,"Finish"),enabled:CC}});}},onBackButtonClick:function A7(){this.rootView.currentPage.onBackButtonClick();},onNextButtonClick:function AF(){this.rootView.currentPage.onNextButtonClick();},onSaveButtonClick:function BP(){if(this.rootView.currentPage.onSaveButtonClick){this.rootView.currentPage.onSaveButtonClick();}},onFinishButtonClick:function I(){this.rootView.currentPage.onFinishButtonClick();},onCancelButtonClick:function BD(CB){if(!CB){this.model.refreshToWrangle=null;}if(typeof this.rootView.currentPage.onCancelButtonClick==="function"){if(this.rootView.currentPage.onCancelButtonClick()){return ;}}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{this.cancelApplication();}},onHelpButtonClick:function O(){mstrApp.showHelpTopic(this.rootView.currentPage.onHelpButtonClick());},gotoOAuthLogin:function F(CF,CC,CG,CB){if(mstrApp.isSingleTier||BA.isServerBasedWS()){if(window.FormWrapper.testInternetConnection()!==0){var CD=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),CE='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";CD=CD.replace("#",CE)+".";this.displayError(CD,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}this.oAuthController.oneTierOAuth(CF,CC,CG,CB);}else{mstrApp.originUrl=window.location.href;this.oAuthController.getWebServiceURL(CF,CC,CG,CB);}},setTableIDsForOAuth:function Aj(CB){this.oAuthController.tableIDs=CB;},oAuthSignOut:function BT(CB){this.oAuthController.oAuthSignOut(CB);},launchWranglerDialog:function A(CC){var CB=this;var CD=function CD(){if(!CC.projectID){var CE="<rss><rpo></rpo></rss>";CB.startRefineStage(CC.tableID,2,CE,CC.sourceInfo.isRefined);}else{CB.refine(CC.projectID,CC.tableID);}};if(!(CC.sourceInfo&&CC.sourceInfo.hasAggFilter)){CD();}else{mstrmojo.confirm(mstrmojo.desc(12720,"Previous changes made in aggregation will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){CB.dataService.cancelAggFilter({success:function CE(CH){CB.dataService.set("messageID",CH.msgid);var CG=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship|Ac.requestFlag.preview|Ac.requestFlag.transformations;var CF={success:function(){CD();}};mstrApp.getRootController().editImportedDataEMMA(CG,null,null,null,CC.tableID,null,null,null,null,true,CF);}},{tbid:CC.tableID});}}});}},refine:function AT(CB,CC){if(!this.refineApp){this.refineApp=new mstrmojo.Refine.Refine();}this.refineApp.start(this.getModel().refineServerURL,CB,CC);this.showDialog(Ac.dialogType.refinePage,{tableID:CC});},importFile:function Av(CC,CE,CJ,CH){if(!this.forceImport){this.showPage(Ac.pageType.preview);return ;}this.fetchPreview=CJ;var CF=this.model;var CB=this.model.cubeID;var CG=this;var CD={fileName:CE};if(CB){CD.reportid=CB;}CD.behaviorFlags=Ac.importBehaviorFlag.reserved;if(this.model.operationMode===Ac.operationMode.refresh||this.model.operationMode===Ac.operationMode.edit){if(mstrApp.isCloudPro){CD.behaviorFlags=Ac.importBehaviorFlag.newColumnsSilent|Ac.importBehaviorFlag.dataTypeSilent;}}var CI={success:function(CN){var CK=Ac.requestFlag.anyState|Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.sheets|Ac.requestFlag.preview|Ac.requestFlag.transformations,CM=CJ?0:-1;var CL=CN.msg_id||CN.content.mst_id;if(CH){CF.importSources.tableID=CL;return ;}CG.dataService.set("messageID",CL);mstrApp.hideProgress();CG.getImportedData(BF.refine,CK,CM,undefined,0);},failure:function(CK){mstrApp.hideProgress();CG.displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,CK&&CK.message);},progress:function(CL,CM){if(CL.lengthComputable){var CK=(CL.loaded/CL.total);mstrApp.setProgressParams(CK,CM);}}};CG.dataService.importFile(CC,CI,CD);},importFileEMMA:function Bs(CF,CH,CB,CE,CD,CG,CC){this.getImportController().importFile(CF,CH,CB,CE,CD,CG,CC);},resetAppforRepublish:function At(CB){this.model.initParams({ReportId:CB.cubeID,CubeName:CB.cubeName,StatusCode:Ac.statusCode.republish,AnalysisId:undefined,datasets:null});this.republishEMMACube();},resetAppforImport:function AS(){this.model.resetImportSource();this.model.initParams({ReportId:undefined,CubeName:undefined,StatusCode:undefined,AnalysisId:undefined,datasets:null});this.dataService.messageID=undefined;},browseURLPath:function AL(CC,CI,CE,CD){var CB=this,CG={};CC=CC.trim();if(CC===""){CB.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(!Az.call(this,CC)){CB.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}try{if(decodeURI(CC)===CC&&!mstrmojo.string.startsWith(CC.toLowerCase(),"file://")){CC=encodeURI(CC);}}catch(CF){}if(CC.substring(0,1)==="\\"){CC=CC.replace(/\\\\/g,"file://");CC=CC.replace(/\\/g,"/");}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}CC=CC.trim();if(CC.charAt(CC.length-1)!=="/"){CC=CC+"/";}CG.urlPath=CC;if(CE){CG.dbRoleID=CE;}var CH={success:function(CK){var CJ=CB.parseURLFolders(CK);if(CK.mi.ftree===""||CJ.length<=0){CB.displayError(mstrmojo.desc(12774,"We could not find anything. Please verify that you have entered a valid network path."),false);}if(CI.getObjectBrowser){CI.getObjectBrowser().set("fileList",CJ);if(CD){CD(CI.getObjectBrowser(),CJ);}}else{CI.set("fileList",CJ);}},failure:function(CJ){CB.displayError(mstrmojo.desc(12775,"Uh-Oh, Error fetching the list of files for the given network path: "),false,CJ&&CJ.message);}};this.dataService.getOAuthSourceReports(CH,CG);},urlBrowserFunction:function(CC,CB){this.browseURLPath(CC.data.address,CC.data.browser,CB);},executeCommand:function B3(CB,CC){switch(CB){case"loginToProxy":this.loginToProxy(CC);break;case"loginToWebserver":this.loginToWebserver(CC);break;case"loginToProject":this.loginToProject(CC);break;case"shutDownDesktop":this.shutDownDesktop(CC);break;default:break;}},loginToWebserver:function Bb(CB){mstrmojo.onetier.controllers.RootController.prototype.loginToWebserver.call(this,CB);},loginToProxy:function u(CB){mstrmojo.onetier.controllers.RootController.prototype.loginToProxy.call(this,CB);},loginToProject:function Aa(CB){mstrmojo.onetier.controllers.RootController.prototype.loginToProject.call(this,CB);},shutDownDesktop:function V(CB){mstrmojo.onetier.controllers.RootController.prototype.shutDownDesktop.call(this,CB);},shutDownServerBased:function(CB){window.FormWrapper.closeWindow(CB);},parseURLFolders:function Bp(CF){var CC=[];var CH=CF.mi.ftree.fd?[].concat(CF.mi.ftree.fd):[];var CB=CF.mi.ftree.fl?[].concat(CF.mi.ftree.fl):[];var CE,CI,CD,CG;for(CD=0;CD<CH.length;CD++){CE=CH[CD];CG={isFolder:true};CG.n=(CE.n===null?"null":CE.n.toString());CG.desc=CE.des;CG.address=CE.address;CC.push(CG);}for(CD=0;CD<CB.length;CD++){CI=CB[CD];CG={isFolder:false};CG.n=(CI.n===null?"null":CI.n.toString());CG.address=CI.address;CG.type=CI.mimetype;CG.desc=CI.des;CG.size=CI.sz;CC.push(CG);}return CC;},importURL:function B8(CD,CC){if(!this.forceImport){this.showPage(Ac.pageType.preview);return ;}this.fetchPreview=CC;var CF={url:A5(CD.trim())};var CE=this.model.cubeID;if(CE){CF.reportid=CE;}CF.behaviorFlags=Ac.importBehaviorFlag.reserved;if(this.model.operationMode===Ac.operationMode.refresh||this.model.operationMode===Ac.operationMode.edit){if(mstrApp.isCloudPro){CF.behaviorFlags=Ac.importBehaviorFlag.newColumnsSilent|Ac.importBehaviorFlag.dataTypeSilent;}}var CB=this;var CG={success:function(CI){var CJ=Ac.requestFlag.sourceInfo|Ac.requestFlag.sheets|Ac.requestFlag.preview|Ac.requestFlag.mapping|Ac.requestFlag.transformations,CH=CB.fetchPreview?0:-1;CB.dataService.set("messageID",CI.msg_id);CB.getImportedData(BF.importSource,CJ,CH);},failure:function(CH){CB.displayError(mstrmojo.desc(12776,"Error importing the URL. Please check the URL being imported"),false,CH&&CH.message);}};this.dataService.importURL(CG,CF);},importURLEMMA:function N(CB,CD,CC,CG,CF,CH,CE){this.getImportController().importURL(CB,CD,CC,CG,CF,CH,CE);},createEMMASourceTableMultiSheets:function D(CD,CL,CK,CH,CJ,CE,CC){var CF=this,CB,CG;if(!CD){CD={};}if(mstrmojo.all[CC].scriptClass==="mstrmojo.DI.DIHadoop"){CD.xt=CD.xt||Ac.xdaType.dataImport;}else{CD.xt=Ac.xdaType.dataImport;}CD.dict=BA.getBackendSourceType(CJ);var CM=CF.model.importSources[CK].fileName;if(As.startsWith(CM,A4)&&CJ!==Ac.sourceSubtype.cloudElement){CD.dict=Ac.backendSourceSubtype.newConnector;}var CI={success:function(CQ){var CR=CQ.tbid,CO,CT=CF.model.importSources[CK],CS;CD.shtIx=CL;CS=mstrmojo.hash.clone(CD);CS.url=CT.fileName;CF.model.createImportSource(CH,CJ,CR);var CN=CF.model.importSources[CR];mstrmojo.DI.DIHelpers.setTablesrc(CF,CC,CR);CN.srcTableID=CK;CN.sheetsInfo=CT.sheetsInfo;function CP(){CF.setDataImportInfoURL(CO,CS,CR);}CO={success:function(CU){CF.autoMappingSourceTable({failure:function(CV){CF.removeEMMASourceTable(null,{did:CR});CF.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CV&&CV.message);}},CR,CS,CK,CE);},failure:function(){CF.removeEMMASourceTable(null,{did:CR});CF.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CQ&&CQ.message);}};if(mstrApp.getRootController().rootView.currentPage.pageType===Ac.pageType.hadoop){CP();}else{CO.success();}},failure:function(CN){CF.displayError(mstrmojo.desc(12777,"Error creating EMMA Source Table"),false,CN&&CN.message);}};CB=CF.getModel().getImportSource(CK);CG=CB&&CB.dbRoleId;if(CG){this.dataService.createEMMASourceTable({success:function(CN){CF.getDataService().setDBRole({success:function(){CI.success(CN);},failure:function(CO){if(CI.failure){CI.failure(CO);}}},{tbid:CN.tbid,dbrid:CG});},failure:function(CN){CI.failure(CN);}},CD);}else{this.dataService.createEMMASourceTable(CI,CD);}},autoMappingSourceTable:function AV(CN,CM,CF,CO,CG,CH){var CK=this;var CP=CF.shtIx;var CJ=CK.model;var CE=CJ.importSources;var CL=CE[CM];var CC=CE[CM].sourceInfo;var CB;var CD=[];if(CM){if(!CF){CF={};}CF.tbid=CM;delete CF.xt;}if(CL.fileName&&BA.strStartsWith(CL.fileName.toLowerCase(),"hdfs://")){CF.dbRoleID=CK.hadoopController.dbRoleID;CF.isUrl=true;}if(CL&&(CL.subtype===Ac.sourceSubtype.url||CL.subtype===Ac.sourceSubtype.samplefile||CL.subtype===Ac.sourceSubtype.publicData||CL.subtype===Ac.sourceSubtype.cloudElement)){CF.isUrl=true;if(CL.xdaType===Ac.xdaType.excel){CF.url=CL.fileName||CL.sourceInfo.url;}}if(CC){CF.behaviorFlags=Ac.behaviorChangeFlag.refreshData;}var CI={success:function(){g(CO,CP,CE,true);if(CG!==Ac.actions.refreshData&&(CJ.operationMode===Ac.operationMode.create||(CJ.operationMode!==Ac.operationMode.create&&!CC))){var CQ=k.call(CK,CE);if(CQ){CB=CA.call(CK,CE,CG);if(CJ.operationMode===Ac.operationMode.create){if(CB===1){for(var CR in CE){CD.push(CR);}CK.detectRelationshipSourceTable(null,CD,CG);}}else{if(CB===1){for(var CR in CE){if(!CE[CR].sourceInfo){CD.push(CR);}}CK.detectRelationshipSourceTable(null,CD,CG);}}}}else{CK.detectRelationshipSourceTable(null,[CM],CG);}if(CN&&CN.success&&CB!==1){CN.success();}},failure:function(CR){var CQ;g(CO,CP,CE,false);if(CM&&CH){mstrmojo.hash.forEach(CH.files,function(CT,CS){if(CT.tableID===CM){CQ=CS;return false;}return true;});}if(CQ!==undefined){CH.files[CQ].failed=true;CH.files[CQ].errRes=CR;CH.idx=CQ;}if(mstrApp.isNewConnectorEdit&&parseInt(CR.code,10)===Ac.backendError.switchingFileType&&CK.rootView.currentPage.pageType===Ac.pageType.emmaPreview){CK.rootView.footer.next.set("enabled",false);CK.rootView.footer.save.set("enabled",false);CH.files[CQ].errRes=AU(CR)+" "+mstrmojo.desc(16032,"You need to cancel and check file type.");}if(CN&&CN.failure){CN.failure(CR);}}};CK.dataService.autoMappingSourceTable(CI,CF);},setDataImportInfo:function Ak(CF,CH,CE,CG,CD,CB){var CC=this;CH.tbid=CF;var CI={success:function(){CC.autoMappingSourceTable(CB,CF,CH,CF,CG,CD);},failure:function(CJ){CC.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,CJ&&CJ.message);}};CC.dataService.setDataImportInfo(CI,CH);},setPartition:function AN(CH,CJ){var CK=this,CC=CK.model.importSources[CH],CE=0,CD=mstrmojo.desc(14707,"Do you want to group these sheets into a single partition table?");if(CC.xdaType===Ac.xdaType.excel){var CB=CC.sheetsInfo;var CF,CG=CB.length;var CL=[],CI=[];for(CF=0;CF<CG;CF++){if(CB[CF].selected){CE++;CL.push(CB[CF].name);CI.push(CB[CF].index);}}if(CE>1){mstrmojo.confirm(CD,{confirmBtn:{fn:function(){CK.partitionController.setPartitionExcel(CH,CL,CI);}},cancelBtn:{fn:function(){if(CC&&CC.originalSheetsInfo){CC.sheetsInfo=CC.originalSheetsInfo;}}}});}else{CK.partitionController.setPartitionExcel(CH,CL,CI);}}else{if(CC.xdaType===Ac.xdaType.text){this.partitionController.setPartitionURL(CH,CJ);}}},setDataImportInfoURL:function Bv(CB,CH,CD){var CC=this;var CE=CC.model;CH.tbid=CD;var CF=CE.importSources[CD];var CG=CC.rootView.hadoopPage?CC.rootView.hadoopPage.getDropZone():null;if(CF.fileName&&BA.strStartsWith(CF.fileName.toLowerCase(),"hdfs://")){CH.dbRoleID=CC.hadoopController.dbRoleID;}var CI={success:function(CJ){var CK=CE.getImportSource(CD);if(CK){CK.fileName=CH.url;if(CG&&CG.isFolder){CK.isFolder=CG.isFolder(CK.fileName);}}if(CE.operationMode===Ac.operationMode.edit){CC.dataService.editEMMASourceTable(CB,{did:CD,tp:Ac.cubeRefreshType.replaceTable,exef:Ac.tableStatsExecutionAction.forceExecution,bin:1});}else{if(CB.success){CB.success(CJ);}}},failure:function(CJ){if(CB.failure){CB.failure(CJ);}CC.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,CJ&&CJ.message);CC.sourceSelected(false);}};CC.dataService.setDataImportInfo(CI,CH);},autoDetectPartitionGroups:function Ai(CB,CJ,CF,CI){var CH=this,CG=this.model,CC=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship|Ac.requestFlag.stateInfo,CE,CD;CE={previewflag:CC};if(CJ!==undefined){CE.sheetIndex=CJ;}if(!CH.dataService.messageID&&CG.cubeID){CE.reportid=CG.cubeID;}CD={success:function(CN){if(CF){mstrmojo.array.forEach(CN.datap,function(CR){CR.isMergedCube=CF;});}var CM=false;if(CI&&CG.refreshToWrangle){CM=true;CG.refreshToWrangle=null;}if(CI){CG.populateEMMA(CN,CC,undefined,true);}else{CG.populateEMMA(CN,CC);}var CL,CP,CQ=CH.partitionController,CO={onOK:function(){if(CI){var CS={success:function(){if(CM){CG.refreshToWrangle=CG.editingTableId;}mstrmojo.array.forEach(CI,function(CV){if(CV.tid){CG.resetImportSource(CV.tid);}});CB.onOK();},failure:function(CV){CH.displayError(mstrmojo.desc(12778,"Encountered an error when doing auto mapping!"),false,CV.message||"",function(){CB.onCancel();});}},CT=CG.importSources[CG.editingTableId],CU={tables:JSON.stringify([{tid:CT.tableID}]),flag:16};var CR={success:function(){CH.dataService.autoMap(CS,CU);},failure:function(CV){CB.onCancel();}};CH.dataService.prepareData(CR,{tables:CG.editingTableId},true);return ;}CB.onOK();},onCancel:function(){var CR=CI?undefined:CN;CB.onCancel(CR);}};CL=CI?CI.map(function(CS,CR){return CS.tid;}):CG.getAllTableID();var CK=CI&&CI.length>0;CP=CG.detectPartitionGroups(CL,CK);CO.success=CO.onOK;CO.failure=function(CR){CH.displayError(mstrmojo.desc(12391,"Cannot group partitions."),false,CR.message||"",function(){CB.onCancel();});};if(CI&&CP.length<=1){CH.partitionController.setPartition(CG.editingTableId,CI.map(function(CS,CR){return CS.tid;}),CO);return ;}if(CP.length>0&&!CQ.isSamePartitionGroups(CP,CG.partitionGroups)){CG.partitionGroups=CP;CQ.openPartitionGroupDialog(CP,CO,CK);return ;}CO.onCancel();},failure:function(CK){CH.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};CH.dataService.getImportedData(CD,CE);},detectRelationshipSourceTable:function G(CH,CF,CG){var CC=this,CE=0,CD;var CB={success:function(){CE++;if(CE>=CD){var CI=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship|Ac.requestFlag.stateInfo,CK,CJ;if(CG===BF.refreshData){CG=CG||Ac.actions.importSource;CC.model.importSources[CC.model.currentSource.key].invalidPreview();}CK={onOK:function(){CC.getImportedDataEMMA(CG,CI);},onCancel:function(CL){CC.getImportedDataEMMA(CG,CI,undefined,undefined,undefined,undefined,undefined,CL);}};CJ=CC.getModel().getAllTableID();if(!CC.rootView.currentPage.tableID&&!CC.model.isDirectDataAccess&&CJ.length>=2){CC.autoDetectPartitionGroups(CK);}else{CC.getImportedDataEMMA(CG,CI);}}},failure:function(CI){B7.call(CC,CI);}};CD=CF.length;CG=CG||Ac.actions.importSource;if(CF.length>0){Bl.forEach(CF,function(CI){CC.dataService.detectRelationshipSourceTable(CB,{did:CI});});}},importOAuthReport:function AW(CG,CB,CF,CI,CL,CH){var CK=this.model.externalSources[CG];var CD=this;var CE=Ac.requestFlag.sourceInfo|Ac.requestFlag.preview|Ac.requestFlag.mapping|Ac.requestFlag.anyState;if(CG===Ac.sourceType.googleDrive||CG===Ac.sourceType.dropbox){CE=CE|Ac.requestFlag.sheets|Ac.requestFlag.transformations;}this.fetchPreview=CL;var CC=CK.getSourceParams();CC.reportAddress=CI;CC.reportDesc=CF;CC.reportMimetype=CH;CC.reportName=CB;if(this.model.cubeID){CC.cubeID=this.model.cubeID;}CC.behaviorFlags=Ac.importBehaviorFlag.reserved;if(this.model.operationMode===Ac.operationMode.refresh||this.model.operationMode===Ac.operationMode.edit){if(mstrApp.isCloudPro){CC.behaviorFlags=Ac.importBehaviorFlag.newColumnsSilent|Ac.importBehaviorFlag.dataTypeSilent;}}var CJ={success:function(CM){CD.dataService.set("messageID",CM.xmlAPIResponse.mid);CD.getImportedData(BF.importSource,CE);},failure:function(){CD.displayError(mstrmojo.desc(12611,"Error importing the selected report."));}};this.dataService.importOAuthReport(CJ,CC);},importMultiOAuthReports:function(CK,CJ,CP,CM,CE,CO,CL){var CG=this,CI=CG.rootView.currentPage,CF,CB=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;var CD={success:function(){var CQ;if(CL){CQ=CG.model.getAllTableID();CG.tablesSrc[CL]=BA.findNewElements(CF,CQ);}}};var CN={success:function(){CE=CE||Ac.actions.importSource;CG.getImportedDataEMMA(CE,CB,undefined,undefined,undefined,0,CD);},failure:function(CW){var CU=true,CY="",CR="",CS,CT=[],CQ,CX=true;if(CK===Ac.sourceType.twitter||CK===Ac.sourceType.facebook){if(CW.status){for(CS=0;CS<CW.status.length;CS++){var CV=CW.status[CS].tableID;if(CV){CT.push(CV);}}if(CT.length>0){CG.getImportController().removeMultipleSourceTables(CT);}}}switch(CK){case Ac.sourceType.twitter:CR=mstrmojo.desc(12780,"Error importing results from Twitter.");break;case Ac.sourceType.facebook:CR=mstrmojo.desc(12781,"Error importing results from Facebook.");break;default:CR=mstrmojo.desc(12782,"Error importing following reports. Please check the files or delete them.");}if(CU){if(CW.reports&&CW.status&&CW.reports.length===CW.status.length&&CW.reports.length>0){CY="<ul>";Bl.forEach(CW.reports,function(Ca,CZ){if(CW.status[CZ].success===false){CY+="<li>"+As.htmlAngles(Ca.n)+"<br>"+As.htmlAngles(CW.status[CZ].errMsg)||" </li>";}else{CX=false;}});CY+="</ul>";}else{if(CW.status&&CW.status.errMsg){CY=As.htmlAngles(CW.status.errMsg);}}if(CI.handleImportError){CU=CI.handleImportError(CW.reports,CW.status,CX);}if(CK===Ac.sourceType.twitter||CK===Ac.sourceType.facebook||CX){CG.displayError(CR,false,CY);}else{CQ={detailErrorMessage:CY,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:mstrmojo.emptyFn};CG.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),null,function(){CE=CE||Ac.actions.importSource;CG.getImportedDataEMMA(CE,CB,undefined,undefined,undefined,0,CD);},CQ);}}}};var CH={success:function(){if(CK===Ac.sourceType.googleDrive||CK===Ac.sourceType.dropbox){CG.getImportController().importMultiOAuthFileReports(CK,CO,CJ,CN);}else{if(CK===Ac.sourceType.facebook){CG.getImportController().importMultiFBReports(CK,CO,CJ,CN);}else{CG.getImportController().importMultiOAuthReports(CK,CO,CJ,CN);}}},failure:function(CQ){CG.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CQ.message||"");}};var CC={success:function(){CG.tablesSrc[CL]=[];CF=CG.model.getAllTableID();if(CM){CG.createNewReportInstance(CH);}else{CH.success();}}};if(CL){l(CG.tablesSrc[CL],CC);}else{CC.success();}},refreshDataOAuthReport:function(CE,CI,CD,CC,CH){var CB=this,CG=CB.getModel().getImportSource(CD);var CF={success:function(){var CJ=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;CH=CH||Ac.actions.importSource;CG.invalidPreview();CB.getImportedDataEMMA(CH,CJ);},failure:function(CJ){CB.displayError(mstrmojo.desc(12784,"Error importing the report."),false,CJ.message);}};if(CE===Ac.sourceType.googleDrive||CE===Ac.sourceType.dropbox){CB.getImportController().refreshDataOAuthFileReport(CE,CI,CD,CC,CB.getModel().operationMode,CF);}else{CB.getImportController().refreshDataOAuthReport(CE,CI,CD,CC,CB.getModel().operationMode,CF);}},refreshMultiOAuthReports:function(CH,CI,CG,CE){var CF=this,CD=0;var CC={success:function(){CF.getModel().getImportSource(CG[CD].tableID).invalidPreview();CD++;if(CD>=CG.length){CJ.success();}else{CB(CG[CD],CC);}},failure:function(CK){CJ.failure(CK);}};var CJ={success:function(){var CK=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;CE=CE||Ac.actions.importSource;CF.getImportedDataEMMA(CE,CK);},failure:function(CK){CF.displayError(mstrmojo.desc(12785,"Error refreshing the report(s)."),false,CK&&CK.message);}};function CB(CK,CL){if(CH===Ac.sourceType.googleDrive||CH===Ac.sourceType.dropbox){CF.getImportController().refreshDataOAuthFileReport(CH,CI,CK.tableID,CK,CF.getModel().operationMode,CL);}else{CF.getImportController().refreshDataOAuthReport(CH,CI,CK.tableID,CK,CF.getModel().operationMode,CL);}}if(CG.length<=0){CJ.failure();}CB(CG[0],CC);},importClipboard:function(CG,CE,CF,CH){var CB=this,CI;var CD={success:function(){CB.getImportController().importClipboard({uploader:CG},{success:function(){var CK=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship,CL;CF=CF||Ac.actions.importSource;var CJ={success:function(){if(CH){CL=CB.model.getAllTableID();CB.tablesSrc[CH]=BA.findNewElements(CI,CL);}if(CF===Ac.actions.importSource){CG.destroy();}}};CB.getImportedDataEMMA(CF,CK,undefined,undefined,undefined,0,CJ);},failure:function(CJ){CB.displayError(mstrmojo.desc(12609,"Error in importing the file. Please check the file being imported."),false,CJ.message);}});},failure:function(CJ){CB.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CJ.message||"");}};var CC={success:function(){CB.tablesSrc[CH]=[];CI=CB.model.getAllTableID();if(CE){CB.createNewReportInstance(CD);}else{CD.success();}}};if(CH){l(CB.tablesSrc[CH],CC);}else{CC.success();}},refreshDataClipboard:function(CC,CG,CF){var CB=this,CE=CB.getModel().getImportSource(CC);var CD={success:function(){var CH=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;CF=CF||Ac.actions.importSource;CE.invalidPreview();CB.getImportedDataEMMA(CF,CH);},failure:function(CH){CB.displayError(mstrmojo.desc(12784,"Error importing the report."),false,CH.message);}};CB.getImportController().refreshDataClipboard(CC,{uploader:CG},CB.getModel().operationMode,CD);},getImportedData:function o(CE,CG,CD,CF){var CH={previewflag:CG};if(CF!==undefined){CH.poll=CF;}if(CD>=0){CH.sheetIndex=CD;}if(CE===BF.refine){CH.refine=32;}var CC=this;var CB=this.model;var CI={success:function(CJ){if(CE===BF.refine){CC.refine(CJ.rpid);return ;}var CK;if(CE===BF.importSource||CE===BF.changeSheet){if(CB.currentSource){CB.currentSource.reset();}CB.populate(CJ,CG);if(CB.operationMode!==Ac.operationMode.create){if(CB.currentSource.sheets&&CB.currentSource.sheets.length>1){CK=mstrmojo.all[Ar];if(!CK){CK=mstrmojo.insert(J);CK.model=CB;CK.open();}else{if(!CC.fetchPreview){CC.saveAndPublish();return ;}}}else{if(!CC.fetchPreview){CC.saveAndPublish();return ;}}}}if(CE===BF.importSource||CE===BF.changeSheet){if(CC.fetchPreview){CC.forceImport=false;CC.showPage(Ac.pageType.preview);}if(CB.currentSource){CB.currentSource.reset();}if(CK){CK.destroy();}}var CL=CB.populate(CJ,CG);if(CE===BF.importSource){if((CL&Ac.requestFlag.preview)!==Ac.requestFlag.preview){return ;}}if((CL&Ac.requestFlag.mapping)!==Ac.requestFlag.mapping){CC.getImportedData(CE,CG,CD,false);return ;}},failure:function(CL){var CK=parseInt(CL.getResponseHeader("X-MSTR-TaskErrorCode"),10);var CJ=Ac.statusCode;if(CK===CJ.mappingError||CK===CJ.xformsError||CK===CJ.obtainSource){CC.getImportedData(CE,CG,CD,false);}else{if(CK===Ac.backendError.fileVersionError){CC.displayError(mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher."));}else{if(CK===Ac.backendError.salesforceUnsavedReport){CC.displayError(mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!"));}else{if(CK===Ac.backendError.maxSizeExceeded){CC.displayError(mstrmojo.desc(12787,"The maximum file size for files is #### MB.").replace("####",mstrApp.diParams.UploadSizeLimit));}else{CC.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}}}}}};this.dataService.getImportedData(CI,CH);},getAttributeGroupInfo:function AB(CD){var CE={tableID:CD,browsetype:32};var CC=this;var CB=CC.model;var CF={success:function(CG){CB.populateAttributeGroup(CG,CD);},failure:function(CG){CC.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};this.dataService.getImportedData(CF,CE);},getShapekeys:function AR(){var CC=this.getModel();var CB={success:function(CG){if(CG&&CG.ShapeFileMaps&&CG.ShapeFileMaps.ShapeFileMap){var CH=CG.ShapeFileMaps.ShapeFileMap,CE=[],CI,CF,CD=function CD(CL,CK){var CJ=CL.n.toLowerCase();var CN=CK.n.toLowerCase();var CM;if(CJ<CN){CM=-1;}else{if(CJ>CN){CM=1;}else{CM=0;}}return CM;};mstrmojo.array.forEach(CH,function(CJ){CI=CJ.descWeb;CF=CI?mstrmojo.desc(CI.slice(8)):mstrmojo.string.decodeHtmlString(CJ.name).replace(/&apos;/g,"'");CE.push({did:CJ.shapeKey,n:CF});});CE.sort(CD);CC.shapeKeys=CE;}}};this.dataService.getShapeKeys(CB,{fileNumber:2});},getCustomConnector:function Ah(){var CC=this.getModel();var CB=this;var CD={typeFilter:Ac.dbType.newConnector,taskId:"arch.getCustomConnector",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:Ac.dbType.newConnector};var CE={success:function(CF){var CG=[];var CI=[];var CH=Bt.walk("connectorConfig.resourceConfig",mstrApp.diParams);Bl.forEach(CF.els,function(CN){if(Bl.find(CC.sourceItems,"oid",CN.oid)<0){var CJ,CM,CL;CJ=Bt.copy(CC.customConnector,CJ),CL=CH&&Array.prototype.indexOf.call(CH,CN.oid)<0;var CK=CN.url,CO=Ac.authModePrefix,CP=Ac.authMode;if(BA.strStartsWith(CK,CO.USERNAME)){CK=CK.substring(CO.USERNAME.length);CK=CK.substring(0,CK.length-1);CM=CP.USERNAME;}else{if(BA.strStartsWith(CK,CO.OAUTH)){CK=CK.substring(CO.OAUTH.length);CK=CK.substring(0,CK.length-1);CM=CP.OAUTH;}else{if(BA.strStartsWith(CK,CO.ANONYMOUS)){CK=CK.substring(CO.ANONYMOUS.length);CK=CK.substring(0,CK.length-1);CM=CP.ANONYMOUS;}}}CC.staticSourceList.push({n:CN.n,url:CK,oid:CN.oid,user:CN.user,pageType:Ac.pageType.newConnector,initial:/[a-z]/i.test(CN.n.charAt(0))?CN.n.charAt(0).toUpperCase():"Others",checkConectivity:true,dbObjectsDisplayOptions:8,tags:["Customized"],oneTier:true,privilege:Ac.privilegeType.accessDatabase,title:function(){var CQ="";if(!mstrApp.diParams.EnableURLImport){CQ=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){CQ=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}}return CQ;},isEnabled:function(){return mstrApp.diParams.EnableURLImport;},sourceInfo:{sourceType:Ac.sourceType.bisource,name:"New connector",type:500,subtype:Ac.sourceSubtype.bisource}});CI.push(CC.staticSourceList[CC.staticSourceList.length-1]);CG.push(Bt.copy({n:CN.n,url:CK,connectorDesc:BY(CN.desc,"desc"),introductionUrl:BY(CN.desc,"introduction"),iconData:window.atob&&window.atob(CN.iconData)||"",oid:CN.oid,type:CM,user:CN.user,pwd:CN.pwd,oneTier:true,selected:CL},CJ));}});if(CG.length){CC.set("sourceItems",CC.sourceItems.concat(CG));CC.set("customConnectorDBRoles",CF.els);}CC.addfromStaticSources(CI);CC.sortSourceList();CC.raiseEvent({name:Ac.srcItemTypes.CUSTOM_CONNECTOR,src:CC});}};mstrApp.serverRequestQueue(CD,CE,w);},getSheetsInfo:function AD(CC,CH,CI,CE,CF){var CD={tableID:CH,previewflag:CI};var CG=this;var CB=CG.model;var CJ={success:function(CN){var CL=function(CR){if(CR==="*"){return false;}return true;};var CP=CN.datap.shts,CK=mstrmojo.array.filter(CP,CL);var CO;var CM=false;for(CO=0;CO<CP.length;CO++){if(CP[CO]!=="*"){CM=true;break;}}if(!CM){CJ.failure(mstrmojo.desc(15810,"The file being imported is not supported or the file might be corrupted. Please check the URL and the file."));return ;}if(CK.length<2){if((CI&Ac.requestFlag.sheets)===Ac.requestFlag.sheets){CB.importSources[CH].populateSheets(CN.datap.shts,CO);}var CQ={shtIx:CO};CG.autoMappingSourceTable(CC,CH,CQ,CH,CE,CF);}else{if((CI&Ac.requestFlag.sheets)===Ac.requestFlag.sheets){CB.importSources[CH].originalSheetsInfo=CB.importSources[CH].sheetsInfo;CB.importSources[CH].populateSheets(CN.datap.shts,CO);}if(CC){CC.success();}}},failure:function(CK){CF.files[CF.idx].failed=true;CF.files[CF.idx].errRes=CK;if(CC){CC.failure();}}};this.dataService.getImportedData(CJ,CD);},getImportedDataEMMA:function Y(CH,CG,CN,CC,CL,CB,CE,CI){var CJ=this,CD=CJ.getModel(),CK;var CF={previewflag:CG};if(CC!==undefined){CF.poll=CC;}if(CN>=0){CF.sheetIndex=CN;}if(CL){CF.tableID=CL;}if(!this.dataService.messageID&&this.model.cubeID){CF.reportid=this.model.cubeID;}var CM={success:function(CW){var CO,CS,CX,CP,CU,CQ,CR=null,CV,CT;if(CH===BF.refine){CO=CD.importSources[CL];CO.projectID=CW.datap.srce.rimp.rpid;CJ.refine(CO.projectID,CL);return ;}if(CH===BF.getFlatPreview){CD.populateEMMA(CW,CG,CL,true);CJ.raiseModelEvent({name:"FlatPreviewFetched"});return ;}CT=CD.populateEMMA(CW,CG,CL,CH===BF.quickPreview);if(CH===BF.savePublish){if(CJ.dialogController.pageZIndex>0){CJ.rootView.parent.close();}window.setTimeout(function(){CJ.saveAndPublish();},0);return ;}for(CS=0;CS<CW.datap.length;CS++){CU=CW.datap[CS].state;if(CU&&CU.errc===Ac.backendError.refineApplyError){CJ.displayError(CU.emsg);}}CX=CD.getAllTableID();CV=CJ.model.currentSource;if(CH===BF.importSource){CR=CX[CJ.dialogController.pageZIndex>0?CX.length-1:0];}else{if(CH===BF.none||CH===BF.refreshData){if(CV&&Bl.indexOf(CX,CV.tableID)>=0){CR=CV.tableID;}else{if(CX.length>0){if(CJ.dialogController.pageZIndex===0){CR=CX[0];}}}}}CP=CG|Ac.requestFlag.preview|Ac.requestFlag.transformations;if(CL===undefined&&CX.length>0&&CH===BF.quickPreview&&CR!==CX[CX.length-1]){CO=CD.getImportSource(CX[CX.length-1]);CQ=false;if(CO&&CO.currentTransformations&&CO.currentTransformations.xtab&&CO.currentTransformations.xtab.isCrosstab){CQ=!!CO.currentMapping&&!!CO.transformedPreview;}else{if(CO){CQ=!!CO.currentMapping&&!!CO.currentPreview&&!(CH===BF.quickPreview);}}if(!CQ){if(CO&&CO.currentTransformations&&CO.currentTransformations.xtab&&CO.currentTransformations.xtab.isCrosstab){CP=CP&(~Ac.requestFlag.preview);CP|=Ac.requestFlag.transformedPreview;}else{CP=CP&(~Ac.requestFlag.transformedPreview);CP|=Ac.requestFlag.preview;}if(CO.type===Ac.sourceType.querybuilder){CP=CP&(~Ac.requestFlag.sheets);CP=CP&(~Ac.requestFlag.transformations);CP=CP&(~Ac.requestFlag.sourceInfo);}if(CO.type===Ac.sourceType.twitter){CP=CP&(~Ac.requestFlag.sheets);}if(CO.subtype===Ac.sourceSubtype.googleBigQuerySingleTable){CP=775;}if(CO.databaseType===j&&CO.xdaType===Ac.xdaType.qbSingleTable){CP=CP&(~Ac.requestFlag.preview);}CJ.getImportedDataEMMA(CH,CP,CN,CC,CX[CX.length-1]);return ;}}if(CH===BF.importSource||CH===BF.changeSheet||CH===BF.refreshData){CJ.forceImport=false;CJ.showPage(Ac.pageType.emmaPreview,null);}if(CR){window.setTimeout(function(){CJ.selectSourceTable(CR);},0);}if(CH===BF.quickPreview){CJ.raiseModelEvent({name:Ac.dataEvents.DATA_PREVIEW_EVENT,data:CL});return ;}if(CH===BF.transform){CD.currentSource.currentTransformations.xtab.set("isCrosstab",true);CJ.raiseModelEvent({name:"changeToXtab"});}if(CH===BF.importSource||CH===BF.refreshData){if((CT&Ac.requestFlag.preview)!==Ac.requestFlag.preview){return ;}}if((CT&Ac.requestFlag.mapping)!==Ac.requestFlag.mapping){CJ.getImportedDataEMMA(CH,CG,CN,false);return ;}},failure:function(CQ){var CP=parseInt(CQ.code||(CQ.getResponseHeader?CQ.getResponseHeader("X-MSTR-TaskErrorCode"):-1),10),CO=Ac.statusCode;if(CP===CO.mappingError||CP===CO.xformsError||CP===CO.obtainSource){CJ.getImportedDataEMMA(CH,CG,CN,false);}else{var CR;if(CL){CR=CJ.getImportController().handleImportError(CQ,CD.importSources[CL].dbTableName);}CJ.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CR);}}};CK=mstrmojo.func.wrapMethods(CM,CE,{});if(CI===undefined){this.dataService.getImportedData(CK,CF);}else{CK.success(CI);}},fetchCubeInfo:function AO(){var CF=Ac.requestFlag.sourceInfo|Ac.requestFlag.mapping|Ac.requestFlag.anyState,CE=this.model,CD=this,CC=this.rootView,CB=mstrApp.diParams.StatusCode;if(CB===Ac.statusCode.xformsError||CB===Ac.statusCode.mappingError){CF=Ac.requestFlag.sourceInfo|Ac.requestFlag.mapping|Ac.requestFlag.preview|Ac.requestFlag.sheets|Ac.requestFlag.transformations|Ac.requestFlag.anyState;}var CH={success:function(CI){if(mstrApp.isEMMACube){CE.populateEMMA(CI,CF);}else{CE.populate(CI,CF);}switch(mstrApp.diParams.StatusCode){case Ac.statusCode.xformsError:CC.showPage(Ac.pageType.preview);break;case Ac.statusCode.mappingError:CC.showPage(Ac.pageType.preview);break;default:if(CE.currentSource.type===Ac.sourceType.file&&CE.currentSource.subtype!==Ac.sourceSubtype.samplefile&&CE.currentSource.subtype!==Ac.sourceSubtype.publicData){CC.showPage(Ac.pageType.file,CE.currentSource.subtype-1);}else{if(CE.currentSource.subtype===Ac.sourceSubtype.samplefile){CC.showPage(Ac.pageType.sampleFiles);}else{if(CE.currentSource.subtype===Ac.sourceSubtype.publicData){CC.showPage(Ac.pageType.publicData);}else{if(CE.currentSource.type===Ac.sourceType.salesforce||CE.currentSource.type===Ac.sourceType.googleDrive||CE.currentSource.type===Ac.sourceType.dropbox||CE.currentSource.type===Ac.sourceType.googleAnalytics){if(mstrApp.diParams.StatusCode){CD.getOAuthSourceReports(CE.currentSource.type,false);}}}}}break;}},failure:function(CI){CD.displayError(CI.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var CG={reportid:this.model.cubeID,previewflag:CF};if(mstrApp.isEMMACube){this.dataService.getImportedDataEMMA(CH,CG);}else{this.dataService.getImportedData(CH,CG);}},handleSecurityFilterAccess:function(CC){var CB=this,CD=mstrmojo.desc(16017,"You need write access to cube # to the operation, because the cube have security filter or shared attribute associated.").replace("#",CC),CE=function(){CB.exitApplication();};CB.displayError(CD,false,undefined,CE);},fetchCubeInfoEMMA:function(){var CB=this,CD=CB.model,CF=Ac.requestFlag.sourceInfo|Ac.requestFlag.mapping|Ac.requestFlag.relationship,CE=null,CC=null,CG;var CI={success:function(CL){CD.writable=CL.writable;CD.copyable=CL.copyable;if(CL.copyable===0){CB.handleSecurityFilterAccess(CD.cubeName);return ;}CD.populateEMMA(CL,CF);if(!CB.checkAndShowPrivilegeMsg()){return ;}mstrmojo.hash.forEach(CD.importSources,function(CM){if(CM.xdaType===Ac.xdaType.mdx){CC=CM;return false;}});if(CC){CG=mstrApp.diParams;CB.showPage(Ac.pageType.database,{sourceType:CC.type,type:CC.xdaType,extParams:{tableID:CC.tableID,cubeName:CG.CubeName,cubeDesc:CG.CubeDesc,folderID:CG.FolderId,reportID:CG.ReportId}});return ;}CE=CD.getAllTableID();if(CE.length<=0){CB.showPage(Ac.pageType.dataSelection);return ;}else{CB.showPage(Ac.pageType.emmaPreview,null,null);}if(CD.isDirectDataAccess===false){var CJ=CB.getDDAController().checkIfDDA(CD.cubesInfo.cubes);var CK=CB.getDDAController().canSupportDDA();if(CJ&&CK){CD.set("isDirectDataAccess",true);CD.weakDDA=true;}}CB.selectSourceTable(CE[0]);},failure:function(CJ){CB.displayError(mstrmojo.desc(12793,"Fetch cube info failed."),false,CJ.message||"",function(){CB.cancelApplication();});}};var CH={success:function(CJ){if(CJ&&CJ.msgid){CB.dataService.set("messageID",CJ.msgid);}CB.dataService.getImportedData(CI,{previewflag:CF,browsetype:Ac.browseFlag.dataPreview|Ac.browseFlag.publish|Ac.browseFlag.reportBindingTable|Ac.browseFlag.reportLevelProperty});},failure:function(CJ){CB.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CJ.message||"",function(){CB.cancelApplication();});}};if(mstrApp.isSingleTier){CB.dataService.duplicateReportInstance(CH,{datasetID:CD.cubeID});}else{if(CD.analysisID){CB.dataService.duplicateReportInstance(CH,{datasetID:CD.cubeID,messageID:CD.analysisID});}else{CB.dataService.createEMMAReportInstance(CH,{reportID:CD.cubeID});}}},duplicateSelectedDataset:function(CI){var CG=this,CF=CG.getModel(),CH=CG.dataService,CD=Ac.requestFlag.sourceInfo|Ac.requestFlag.mapping|Ac.requestFlag.relationship,CC=CF.currentDataset,CJ=false,CB={success:function(CM){var CP=null,CN=false,CL=false,CO=false,CK=0,CR="",CQ=function(){CH.set("messageID",null);CF.resetImportSource();if(CF.datasets&&CF.datasets.length){CF.selectDataset(CF.datasets[0]);}CG.showPage(Ac.pageType.dataSelection);};CF.populateEMMA(CM,CD);CP=CF.getAllTableID();Bl.forEach(CP,function(CT){var CS=CF.getImportSource(CT);if(CS&&CS.xdaType===Ac.xdaType.mdx){CN=true;CR=mstrmojo.desc(13320,"We do not allow add to operation on cubes that have sources based on MDX.");}if(CS&&CS.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){CL=true;CR=mstrmojo.desc(13321,"We do not allow add to operation on cubes that have sources based on Solr.");}if(CS&&CS.type===Ac.sourceType.remoteProject){CO=true;CR=mstrmojo.desc(13322,"We do not allow add to operation on cubes that have sources based on MicroStrategy Project.");}if(CS&&CF.isDDAOnlySource(CS.subtype)){CK++;}});if(CN||CL||CO){CG.displayError(CR,false,null,CQ);}else{CF.set("isDirectDataAccess",CF.isDirectDataAccess&CG.getDDAController().canSupportDDA());CF.set("cubeID",CC.did);CF.set("cubeName",CC.name);CF.set("cubeDesc",CC.dsc);CF.set("operationMode",Ac.operationMode.edit);if(CI&&CI.success){CI.success(CM);}}}},CE={success:function(CK){CJ=true;if(CK&&CK.msgid){CH.set("messageID",CK.msgid);}CH.getImportedData(CB,{previewflag:CD});},failure:function(CK){if(CI.failure){CI.failure(CK);}},complete:function(){if(!CJ&&CI.complete){CI.complete();}}};if(!CC||!CC.did){if(CI.success){CI.success();}if(CI.complete){CI.complete();}}CH.duplicateReportInstance(CE,{datasetID:CC.did,messageID:CF.analysisID});},getRepublishInfoEMMA:function(){var CB=this,CD=CB.model,CE=Ac.requestFlag.sourceInfo|Ac.requestFlag.mapping,CC=Ac.browseFlag.dataPreview|Ac.browseFlag.publish|Ac.browseFlag.reportBindingTable|Ac.browseFlag.reportLevelProperty;var CF={success:function(CP){var CK,CJ=false,CH=false,CT=false,CL=false,CQ=0,CO=0,CI,CM;CD.writable=CP.writable;CD.copyable=CP.copyable;CD.populateEMMA(CP,CE);var CG=CD.isFromPushApi();if(!CB.checkAndShowPrivilegeMsg()){return ;}if(CD.isDirectDataAccess===false){var CS=CB.getDDAController().shouldSupportDDA();if(CS){CD.set("isDirectDataAccess",true);}}CK=CD.getAllTableID();CI=CK.length;Bl.forEach(CK,function(CV){var CU=CD.getImportSource(CV);if(CU&&CU.xdaType===Ac.xdaType.mdx){CJ=true;CM=mstrmojo.desc(13278,'A schedule cannot be created on this dataset as all its tables are from the "OLAP Sources" connector which is only supported in the Connect Live? Mode.');}if(CU&&CU.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){CH=true;CM=mstrmojo.desc(13279,'A schedule cannot be created on this dataset as all its tables are from the "Search as a Source" connector which is only supported in the Connect Live? Mode.');}if(CU&&CU.type===Ac.sourceType.remoteProject){CT=true;CM=mstrmojo.desc(13323,'A schedule cannot be created on this dataset as all its tables are from the "MicroStrategy Project" connector which is only supported in the Connect Live? Mode.');}if(CU&&CU.xdaType===Ac.xdaType.qbSingleTable&&CU.databaseType===4000){CL=true;CM=mstrmojo.desc(14206,"A schedule cannot be created on this dataset as all its tables are from HANA which is only supported in the Connect Live? Mode.");}if(CU&&CU.type===Ac.sourceType.file){if(CU.subtype===Ac.sourceSubtype.clipboard||CU.subtype===Ac.sourceSubtype.localFile){CQ++;}}if(CU&&CD.isDDAOnlySource(CU.subtype)){CO++;}});if(CD.operationMode===Ac.operationMode.refresh){if(BA.isRefreshable(CD)){if(CJ){CB.displayError(mstrmojo.desc(13264,'We do not allow the "Publish" operation on cubes that access OLAP sources.'),false,null,function(){CB.cancelApplication();});}else{if(CH){CB.displayError(mstrmojo.desc(13265,"We do not allow publish operation on cubes that have sources based on Solr."),false,null,function(){CB.cancelApplication();});}else{if(CL){CB.displayError(mstrmojo.desc(14207,"We do not allow publish operation on cubes that have sources based on HANA."),false,null,function(){CB.cancelApplication();});}else{if(CG){CM=mstrmojo.desc(14869,"The in-memory dataset cannot be republished as it contains a table that was created via the MicroStrategy Data Push api.");if(BA.isWS()){CB.displayError(CM,false,null,function(){if(BA.getEnvObj().isDIinVI()){Au.call(CB);}},"",mstrmojo.desc(15207,"This dataset cannot be refreshed."),false);}else{CB.displayError(CM,false,null,function(){CB.cancelApplication();});}}else{CB.showDialog(Ac.dialogType.publishStatusDialog,{model:CD});}}}}}else{CB.displayError(mstrmojo.desc(13280,"Administrator has disabled importing a file from a URL."),false,null,function(){CB.cancelApplication();});}}if(CD.operationMode===Ac.operationMode.subscribe){if(CQ===CI||CG){CM=mstrmojo.desc(14870,'A schedule cannot be created on this dataset as all its tables either require manual input, as they were built from the "File From Disk" or "Clipboard" connectors, or are created via the MicroStrategy Data Push api.');if(BA.isWS()){CB.displayError(CM,false,null,null,"",mstrmojo.desc(15208,"Schedule cannot be created on this dataset."),false);}else{CB.displayError(CM,false,null,function(){CB.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}}else{if(CO===CI){CB.displayError(CM,false,null,function(){CB.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}else{var CN=false,CR;Bl.forEach(CK,function(CU){CN=CD.importSources[CU]&&CD.importSources[CU].subtype===Ac.sourceSubtype.cloudElement&&!(CD.cloudElementDBRoles&&CD.cloudElementDBRoles.length>0);if(CN){CR={success:function(){CB.getScheduleController().launchScheduleEditor();}};CB.getCloudElementDBRoles(CR);return false;}});if(!CN){CB.getScheduleController().launchScheduleEditor();}}}}},failure:function(CG){CB.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CG.message,function(){mstrApp.getRootController().cancelApplication();});}};if(CD.operationMode===Ac.operationMode.subscribe){CC=Ac.browseFlag.dataPreview;}CB.dataService.getImportedData(CF,{previewflag:CE,browsetype:CC});},republishEMMACube:function(){var CB=this;var CC=CB.model;var CD={success:function(CE){if(CE&&CE.msgid){CB.dataService.set("messageID",CE.msgid);}if(CE.publishInfo){var CF=JSON.parse(CE.publishInfo);CB.model.requestId=CF.requestId;CB.model.appSchemaTables=CF.data;CB.model.workspaceId=CF.workspaceId;}CB.getRepublishInfoEMMA();},failure:function(CE){if(BA.isWS()){CB.displayError(null,false,CE.message||"",null,"",mstrmojo.desc(12794,"Run EMMA cube error."),false);}else{CB.displayError(mstrmojo.desc(12794,"Run EMMA cube error."),false,CE.message||"",function(){mstrApp.getRootController().cancelApplication();});}}};if(mstrApp.isSingleTier){CB.dataService.duplicateReportInstance(CD,{datasetID:CC.cubeID});}else{if(CC.analysisID){CB.dataService.duplicateReportInstance(CD,{datasetID:CC.cubeID,messageID:CC.analysisID});}else{CB.dataService.createEMMAReportInstance(CD,{reportID:CC.cubeID});}}},fetchSampleFileList:function Ad(){var CB=this.model;var CC={success:function(CD){CB.sampleFiles=CD.samplefiles.file;}};},getDIProjectSettings:function BQ(CB){var CC=this;var CD={success:function(CE){if(!mstrApp.sessionManager){mstrApp.projectName=mstrConfig.projectName;mstrApp.serverName=mstrConfig.serverName;mstrApp.serverPort=mstrConfig.serverPort;mstrApp.authMode=mstrConfig.authMode;mstrApp.enableAutomaticSessionRecovery=CE.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=CE.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=CE.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=CE.enableWarningSessionTimeout;if(!BA.getEnvObj().isWS()){mstrApp.startSessionManager();}}mstrmojo.hash.copy(CE,mstrApp.diParams);},failure:function(){CC.oAuthController.getExternalSourcesInfo();}};this.dataService.getDIProjectSettings(mstrmojo.func.wrapMethods(CD,CB,{success:function(CF){var CH=mstrmojo.desc(13991,'The Project is locked because it is being used by "###". The EMMA Cube cannot be opened until the Project is no longer in use.'),CE=null;if(CF&&CF.projectLocked){CC.displayError(CH.replace("###",CF.projectLockedOwner),false,null,function(){CC.cancelApplication();});return ;}if(CF&&CF.connectorConfig){try{CE=JSON.parse(CF.connectorConfig);}catch(CG){console.log("Invalid DI connector configuration");}mstrApp.diParams.connectorConfig=CE;if(CE&&(CE.resourceConfig||CE.dbRoleConfig)){CC.getModel().populateSourceListAdminConfig(CE.resourceConfig,CE.dbRoleConfig);}}CC.oAuthController.getExternalSourcesInfo();}}));},getDBMSObjects:function AG(){var CB=this;var CD={success:function(CE){if(CE.DBInfo){CB.model.populateDBRoles(CE.DBInfo);}},failure:function(CE){CB.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,CE.message);}};var CC={taskId:"arch.getDBObjects",flags:8};mstrApp.serverRequestQueue(CC,CD,w);},editImportedData:function n(CD,CL,CB,CG,CJ,CC,CH){if(mstrApp.isEMMACube){this.editImportedDataEMMA(CD,CL,CB,CG,CH);return ;}var CE={shtIx:CL};var CI=this.model.currentSource.type;if(CI===Ac.sourceType.dropbox||CI===Ac.sourceType.googleDrive){var CM=this.model.externalSources[CI];CE=CM.getSourceParams();CE.shtIx=CL;}if(CB){CE.chs=CB;}if(CG){CE.trans=CG;}if(this.model.currentSource.subtype===Ac.sourceSubtype.url||this.model.currentSource.subtype===Ac.sourceSubtype.samplefile||this.model.currentSource.subtype===Ac.sourceSubtype.publicData||this.model.currentSource.subtype===Ac.sourceSubtype.cloudElement){CE.isUrl=true;}CE.behaviorFlags=Ac.importBehaviorFlag.reserved;if(this.model.operationMode===Ac.operationMode.refresh||this.model.operationMode===Ac.operationMode.edit){if(mstrApp.isCloudPro){CE.behaviorFlags=Ac.importBehaviorFlag.newColumnsSilent|Ac.importBehaviorFlag.dataTypeSilent;}}if(CJ){CE.refine=CJ;if(CC===0){CE.flags=536870920;}else{CE.flags=0;}}var CF=this;var CK={success:function(CN){CF.dataService.set("messageID",CN.msg_id||CN.msgid);if(CC===0){CF.getImportedData(BF.refine,CD,CL,undefined,1);}else{if(CF.model.operationMode!==Ac.operationMode.create&&!CB&&!CG){CF.getImportedData(BF.changeSheet,CD,CL,undefined,CF.model.currentSource.tableID);}else{CF.getImportedData(BF.editImport,CD,CL,undefined,CF.model.currentSource.tableID);}}},failure:function(){CF.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."));}};this.dataService.editImportedData(CK,CE);},editImportedDataEMMA:function BG(CH,CG,CN,CB,CC,CE,CS,CM,CO,CR,CK){var CL,CQ={};if(CC){CL=this.model.importSources[CC];CG=CL.currentIndex;}else{CL=this.model.currentSource;CC=CL.tableID;}if(CG>=0){CQ.shtIx=CG;}var CD=CL.type;if(CL.type===Ac.sourceType.googleDrive||CL.type===Ac.sourceType.dropbox||CL.type===Ac.sourceType.salesforce||CL.type===Ac.sourceType.twitter||CL.type===Ac.sourceType.facebook||CL.type===Ac.sourceType.googleAnalytics){var CI=this.model.externalSources[CD];CQ=CI.getSourceParams();}if(CN){CQ.chs=CN;}if(CB){CQ.trans=CB;}if(CL.subtype===Ac.sourceSubtype.url||CL.type===Ac.sourceType.hadoop||CL.subtype===Ac.sourceSubtype.samplefile||CL.subtype===Ac.sourceSubtype.publicData||CL.subtype===Ac.sourceSubtype.cloudElement){CQ.isUrl=true;}if(CL.subtype===Ac.sourceSubtype.querybuilder||(CL.type===Ac.sourceType.querybuilder&&CL.subtype===Ac.sourceSubtype.hadoop)){CQ.isDB=true;CQ.dbTableName=CL.sourceInfo.dbTableName;CQ.dbRoleID=CL.sourceInfo.dbRoleId;if(CL.sourceInfo.dbNamespace){CQ.dbNamespace=CL.sourceInfo.dbNamespace;}}if(CE||CE===0){CQ.sr=CE;}if(CS){CQ.dlmt=CS;}if(CM){CQ.qt=CM;}CQ.behaviorFlags=Ac.importBehaviorFlag.reserved;if(this.model.operationMode===Ac.operationMode.refresh||this.model.operationMode===Ac.operationMode.edit){if(mstrApp.isCloudPro){CQ.behaviorFlags=Ac.importBehaviorFlag.newColumnsSilent|Ac.importBehaviorFlag.dataTypeSilent;}}if(CR){CQ.behaviorFlags|=Ac.behaviorChangeFlag.refreshData;}else{CQ.behaviorFlags|=Ac.behaviorChangeFlag.remapping;}var CJ=this;var CP={success:function(){CJ.getImportedDataEMMA(BF.none,CH,CG,undefined,CC,null,CK);},failure:function(CT){CJ.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CT.message||"");}};var CF={success:function(CT){if(CT&&CT.msgid){CJ.dataService.set("messageID",CT.msgid);}CJ.dataService.detectRelationshipSourceTable(CO||CP,{did:CC||CJ.model.currentSource.tableID});},failure:function(CT){CJ.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,CT.message||"");CJ.handleImportEMMAerror(CT.code);}};CQ.tbid=CC;this.dataService.autoMappingSourceTable(CF,CQ);},handleImportEMMAerror:function(CB){var CC=mstrApp.getRootController();CB=parseInt(CB,10);if(CB===undefined||CB===null){return ;}if(CB===Ac.backendError.emptySheet){CC.rootView.footer.next.set("enabled",false);}},openRefreshOptions:function q(){var CD=this.model.refresh_opt,CB;if(CD==="2"){CB=2;}else{if(CD==="4"){CB=1;}else{CB=0;}}var CC=mstrmojo.all[B1];if(!CC){CC=mstrmojo.insert(e);CC.model=this.model;CC.render();}CC.radiolist.set("selectedIndex",CB);CC.open();},loadProject:function A3(CE,CC){var CK,CH,CD=0,CG=0,CF=0,CB,CI,CJ;CK={};CH={success:function(CL){if(!CL||!CL.servers){return ;}for(CG=0;CG<CL.servers.length;CG++){CB=CL.servers[CG];if(CB&&CB.projects){for(CF=0;CF<CB.projects.length;CF++){CI=CB.projects[CF];if(CI){CE[CD]={nt:"\\\\"+CB.name+"\\"+CI.name,n:CI.name,id:CI.id,sn:CB.name,port:CB.port};if((CI.name===mstrApp.projectName)&&(CB.name===mstrApp.serverName)){CE[CD].ls=true;CE[CD].ss=mstrApp.sessionState;CJ=CD;}else{CE[CD].ls=false;CE[CD].ss=null;}CD++;}}}}CC.set("items",CE);CC.set("selectedIndex",CJ);CC.set("text",CE[CJ].nt);},failure:function(CL){mstrmojo.alert(CL.getResponseHeader("X-MSTR-TaskFailureMsg"));}};this.dataService.loadProject(CH,CK);},loginProjects:function Q(CE,CF){var CC=1,CG=CE.parent,CI=CE.mstrUserAlias.value,CL=CE.mstrPasswordAlias.value,CH=CE.loginErrorBoxAlias,CD=CG.selectedIndex,CB=CG.port,CK={userid:CI,server:CG.serverName,password:CL,project:CG.projectName,authMode:CC,port:CB},CJ={success:function(CM){CF[CD].ls=true;CF[CD].ss=CM.sessionState;CH.set("visible",false);CG.close();CG.projectListNode.set("selectedIndex",CD);},failure:function(CM){CH.set("visible",true);CH.errorMsgAlias.set("text",mstrmojo.desc(422));}};this.dataService.loginProject(CJ,CK);},getPublishController:function Bj(){if(this.publishController===undefined){this.publishController=new mstrmojo.DI.controller.DIPublishController();}return this.publishController;},saveAndPublish:function M(){var CB={success:this.getPublishController().saveAndPublish.bind(this.getPublishController())};if(!A6.call(this,CB)){CB.success();}},publishNonEmmaCube:function AM(CE){var CC=this;var CG={success:function CF(){CC.displayError(mstrmojo.desc(14096,"The cube was published successfully!"),false,null,function(){var CK,CI,CJ,CH,CL={did:CE};if(mstrApp.refreshMultipleCubes){CK=CC.getModel();CK.publishedDatasets.push(CL);CI=CK.cubesInfo;CJ=CI&&CI.cubes&&CI.cubes.cube;CH=Bl.find(CJ,"cube_id",CE);if(CH>=0){CJ.splice(CH,1);CK.raiseEvent({name:"cubesInfoChange"});}}});},failure:function CD(CH){CC.displayError(mstrmojo.desc(14097,"There was an error publishing the cube."),false,CH.message||"");}};var CB={success:function(CH){switch(parseInt(CH.status)){case Ac.cubePollStatus.msgID:case Ac.cubePollStatus.result:case Ac.cubePollStatus.xmlResult:CG.success();break;case Ac.cubePollStatus.prompt:CG.failure();break;case Ac.cubePollStatus.error:CG.failure();break;default:CC.dataService.pollStatus(CB,{msgID:CH.id,stateID:parseInt(CH.st)});break;}},failure:function(CH){CG.failure(CH);}};this.dataService.publishNonEmmaCube(CB,{reportID:CE});},save:function BS(){var CB={success:this.getPublishController().save.bind(this.getPublishController())};if(!A6.call(this,CB)){CB.success();}},handleMissingColumns:function BW(CB){this.getPublishController().handleMissingColumns(CB);},handleRepublishError:function Ae(CB){this.getPublishController().handleRepublishError(CB);},cancelRepublishError:function Bx(CB){this.getPublishController().cancelRepublishError(CB);},exitApplication:function B0(){if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{Au.call(this,this.model.cubeID);}},exitApplicationRefreshMultipleCubes:function(){var CB=this;if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){var CD=CB.model.publishedDatasets;CB.dialogController.close(Ac.dialogType.publishStatusDialog);CB.dialogController.destroyAll();var CC=mstrApp.container;if(CC){mstrApp.container.close();if(CC.dataImportCallback){CC.dataImportCallback(CD);}}},0);}},cancelApplication:function Bu(){var CB=this,CC=this.getModel();if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){CB.dialogController.close(Ac.dialogType.publishStatusDialog);CB.dialogController.destroyAll();var CD=mstrApp.container;if(CD){if(!CC.hasMergedReportInstance){mstrApp.container.close();if(CD.dataImportCallback){CD.dataImportCallback();}}else{mstrApp.container.close();}}else{if(mstrApp.isSingleTier){CB.shutDownDesktop();}else{if(BA.isServerBasedWS()){CB.shutDownServerBased("{}");}else{mstrApp.redirectToPage(Ap.getRedirectParams(Ap.pageRedirect.flashVI,CB.model.cubeID,CB.model.isDirectDataAccess));}}}},100);}},wrapUpDataImport:function Bd(CJ){var CG=this,CF=this.model,CK=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship,CD,CE,CI;if(CJ===undefined){CJ=true;}var CB={success:function(){CF.hasMergedReportInstance=true;if(CF.operationMode===Ac.operationMode.create&&(CF.isManagedCube||mstrApp.isSingleTier)){CG.docController.renameDataset((CF.curDataset&&CF.curDataset.id)?CF.curDataset.id:CF.cubeID,CF.cubeName,{success:function(){Au.call(CG,CF.cubeID);}});}else{Au.call(CG,CF.cubeID);}},failure:function(CL){mstrApp.hideProgress();CG.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,CL&&CL.message);}};this.dialogController.close(Ac.dialogType.publishStatusDialog);function CH(){CG.dataService.duplicateReportInstance(CB,{messageID:CF.analysisID,datasetID:(CF.curDataset&&CF.curDataset.id)?CF.curDataset.id:CF.cubeID,duplicateRIMsgID:CG.dataService.messageID});}function CC(){var CL=CG.getDocController(),CM=CG.getDocController().getVIModelDatasets();CL.createNewManagedDataset({success:function(CN){var CO=[],CP;Bt.forEach(CN.datasets,function(CQ,CR){if(Bl.find(CM,"did",CR)<0){CO.push(CR);}});if(CO.length>0){CP=CO[0];CF.curDataset=CN.datasets[CP];CF.hasCreateDataset=true;CF.curDataset.id=CP;CF.cubeID=CP;CH();}},failure:function(CN){CG.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,CN&&CN.message);}},{newObjectIds:[CF.reportDefinitionId]});}if(!CF.analysisID&&!mstrApp.isSingleTier){if(CG.rootView.currentPage&&CG.rootView.currentPage.scriptClass!=="mstrmojo.DI.DIExitOptions"){if(CF.path!==undefined&&CJ){if(BA.isServerBasedWS()||CF.path==="serverBased"){CI={objectId:CF.cubeID,folderId:CF.folderID};this.shutDownServerBased(JSON.stringify(CI));}else{CG.showPage(Ac.pageType.redirect);}}else{CG.exitApplication();}}}else{if(CF.operationMode===Ac.operationMode.create&&(CF.isManagedCube||(CF.curDataset&&CF.curDataset.id)||!mstrApp.isPopup)){CG.dataService.getImportedData({success:function(CL){CF.populateEMMA(CL,CK,true);if(mstrApp.isSingleTier&&!mstrApp.isPopup){CE={objectId:CF.cubeID,objectType:3,objectSubtype:779,name:CF.cubeName,duplicateRIMsgId:CG.dataService.messageID};CD='window.setTimeout(function () { mstrApp.executeCommand("addNamedDataset",'+JSON.stringify(CE)+"); }, 1000)";window.FormWrapper.closeDataImportWindow();return ;}CC();},failure:function(CL){CG.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CL.message);}},{previewflag:CK});}else{if(CF.operationMode===Ac.operationMode.edit){CH();}else{Au.call(CG,CF.cubeID);}}}},getQBParamsDDA:function Al(CE){var CB,CD=this.getDDAController(),CC={};CB=CD.canSupportDDA(CC);CE.canSupportDDA=CB;CE.shouldSupportDDA=CD.shouldSupportDDA();CE.isManagedCube=this.model.isManagedCube;CE.dbridForDDA=CC.dbrid;CE.isDDA=this.model.isDirectDataAccess;CE.origIsDDA=this.model.origIsDirectDataAccess;CE.ddaCheckboxID=CD.getDDACheckboxID();},getQueryBuilderParams:function B9(CE,CB){var CD={isEMMACube:mstrApp.isEMMACube,type:CE};switch(CE){case Ac.xdaType.ffsql:case Ac.xdaType.googleBigQuery:case Ac.xdaType.googleBigQueryFFSQL:case Ac.xdaType.querybuilder:CD.size={h:"95%",w:"95%"};break;case Ac.xdaType.qbSingleTable:case Ac.xdaType.googleBigQuerySingleTable:CD.size={h:"552px",w:"1110px"};break;case Ac.xdaType.dataImportBISource:case Ac.xdaType.mdx:CD.size={h:"552px",w:"1010px"};break;default:CD.size={h:"549px",w:"1010px"};}CD.isFFSQL=(CE===Ac.xdaType.ffsql||CE===Ac.xdaType.googleBigQueryFFSQL||CE===Ac.xdaType.dataImportBISource)?true:false;if(CE===Ac.xdaType.googleBigQuery||CE===Ac.xdaType.googleBigQueryFFSQL||CE===Ac.xdaType.googleBigQuerySingleTable){var CC=this.model.externalSources[Ac.sourceType.googleBigQuery];if(CC){CD.dbrid=CC.dbRoleID;if(CC.sourceAccountID){CD.said=CC.sourceAccountID;}if(CC.userDisplayName){CD.userName=CC.userDisplayName;}if(CC.userEmail){CD.userEmail=CC.userEmail;}}}if(mstrApp.isCloudPro){CD.isCloud=true;if(this.model.cubeID){CD.reportID=this.model.cubeID;}if(this.model.analysisID){CD.analysisID=this.model.analysisID;}if(this.model.folderID){CD.folderID=this.model.folderID;}if(mstrApp.diParams.isMDD){CD.isCube=2;}else{CD.isCube=1;}}else{if(this.model.analysisID){CD.messageID=mstrApp.messageID||this.dataService.messageID||"";}else{CD.messageID=this.dataService.messageID||"";}CD.analysisID=this.model.analysisID||"";CD.isNewAnalysis=mstrApp.isNewAnalysis;}CD.origin="di";CD.emmaTablesNum=this.model.getAllTableID().length;this.getQBParamsDDA(CD);CD.diFooterID=this.rootView.footer.id;CD.diRootViewID=this.rootView.id;CD.tableID=(CB&&CB.tableID)||"";CD.subtype=(CB&&CB.subtype)||undefined;CD.isRefined=(CB&&CB.isRefined);CD.diCurrentZIndex=this.getDialogController().getCurrentZIndex();CD.operationMode=this.model.operationMode;CD=mstrmojo.hash.copy(CD,CB);return CD;},afterQBProcess:function Bh(CH,CF){var CE=this;var CJ=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship,CG=mstrApp.tableID,CB,CC,CI=!!(CE.rootView.currentPage&&CE.rootView.currentPage.tableID),CD=CI?Ac.actions.refreshData:Ac.actions.importSource;if(mstrApp.hasOwnProperty("isDDA")){CC=mstrApp.isDDA;CE.getDDAController().setDirectDataAccess(CC);}if(mstrApp.hasOwnProperty("isManagedCube")){CE.model.isManagedCube=mstrApp.isManagedCube;}if(CH){CE.dataService.set("messageID",mstrApp.messageID);CE.getDDAController().confirmDDA=false;if(CH.mdx){CE.saveAndPublish();return ;}CE.getImportedDataEMMA(BF.savePublish,CJ);return ;}if(mstrApp.messageID){CE.dataService.set("messageID",mstrApp.messageID);if((!CG&&!CE.model.isDirectDataAccess)||(CF!==undefined)){var CK=function(CM,CL){if(!CF){CE.getImportedDataEMMA(CD,CJ);}else{CE.getModel().cleanDuplicateRI(CL,{success:function(){if(CL){mstrmojo.array.forEach(CF,function(CN){if(CN.tid){CE.model&&CE.model.resetImportSource(CN.tid);}});}CE.getImportedDataEMMA(CD,CJ,undefined,undefined,undefined,undefined,undefined,CM);}});}};CB={onOK:function(){CK();},onCancel:function(CM){var CL=true;CK(CM,CL);}};CE.autoDetectPartitionGroups(CB,undefined,undefined,CF);}else{CE.getImportedDataEMMA(CD,CJ);}}},afterBigQueryProcess:function S(CB){var CD=Ac.pageType,CC=this.model.externalSources[Ac.sourceType.googleBigQuery];CC.reset();this.showPage(CB?CD.emmaPreview:CD.dataSelection);},displayError:function W(CF,CI,CE,CC,CH,CD,CG){var CB;if(mstrApp.isPopup){CI=false;}CB={title:CH||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),showTitle:CG===false?false:true,summary:CD||"",errorMessage:CF,detailErrorMessage:CE||"",onOK:CC||null};if(mstrApp.hideProgress){mstrApp.hideProgress(true);}else{if(mstrApp.hideWait){mstrApp.hideWait();}}mstrmojo.error({shortDesc:CF,longDesc:CE},CC,{title:mstrmojo.desc(11812,"Notification"),allowHTML:true});if(CI){mstrApp.onSessionExpired();}},displayWarning:function K(CB,CF,CE,CD){var CC={title:CF||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),errorMessage:CB,showCancel:true,onOK:CE};mstrmojo.hash.forEach(CD,function(CH,CG){CC[CG]=CH;});mstrApp.hideProgress(true);this.showDialog(Ac.dialogType.warningDialog,CC);},filterSourcesByPrivileges:function(CC){var CB=[];mstrmojo.hash.forEach(CC,function(CD){if(CD.privilege===Ac.privilegeType.accessCloud&&mstrApp.diParams.AccessDataFromCloudApp){CB.push(CD);}if(CD.privilege===Ac.privilegeType.accessDatabase&&mstrApp.diParams.ImportDatabase){CB.push(CD);}if(CD.privilege===Ac.privilegeType.accessFile&&mstrApp.diParams.AccessDataFromFiles){CB.push(CD);}});return CB;},filterSourcesForOneTier:function(CB){var CC=[],CF=0,CD=0,CE;mstrmojo.hash.forEach(CB,function(CG){CE=null;if(CG.oneTier){CE=mstrmojo.hash.copy(CG,CE);if(CD>3){CF++;CD=0;}CD++;CC.push(CE);}});return CC;},filterSourcesByDDA:function(CC){var CB=[],CF=0,CD=0,CE;mstrmojo.hash.forEach(CC,function(CH){CE=null;var CG,CI;if(CH.sourceInfo&&CH.sourceInfo.subtype){CG=CH.sourceInfo.subtype;}else{CG=CH.subtype;}if(CH.sourceInfo&&CH.sourceInfo.dbType){CI=CH.sourceInfo.dbType;}else{CI=CH.dbType;}if(mstrApp.getRootController().model.canAddToDDACube(CG,CI)){CE=mstrmojo.hash.copy(CH,CE);if(CD>3){CF++;CD=0;}CD++;CB.push(CE);}});return CB;},filterSourcesByDDAOnly:function(CF,CB){var CE=this.getModel(),CD=[],CC;if(!CB){Bl.forEach(CF,function(CG){if(CG.sourceInfo&&CG.sourceInfo.subtype){CC=CG.sourceInfo.subtype;}else{CC=CG.subtype;}if(!CE.isDDAOnlySource(CC)){CD.push(CG);}});}else{CD=CF;}return CD;},filterSourcesByText:function AC(CE,CD,CH){var CC,CG,CB=[],CI=0,CF=0;for(CC=0;CC<CE.length;CC++){CG=CE[CC].n.toLowerCase().indexOf(CD.toLowerCase());if(CG>-1){CB.push(CE[CC]);CF++;if(CF===CH){CF=0;CI=CI+1;}}}return CB;},filterSourcesbyTag:function a(CE,CI,CF){var CD,CC,CJ=[],CH=0,CB=0,CG;for(CC=0;CC<CE.length;CC++){if(CE[CC].tags){for(CD=0;CD<CE[CC].tags.length;CD++){CG=CE[CC].tags[CD];if(CI[CG]){CJ.push(CE[CC]);CB++;if(CB===CF){CB=0;CH=CH+1;}break;}}}}return CJ;},selectSourceTable:function AI(CH,CJ){var CF=this,CE=CF.model,CB=null,CC=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship|Ac.requestFlag.preview|Ac.requestFlag.transformations,CG=false,CI=CE.currentSource?CE.currentSource.tableID:-1;if(CH!==-1){CB=CF.model.getImportSource(CH);}if(CH===CI&&CB&&CB.cannotFetchPreview){if(CJ){CE.raiseEvent({name:"scrollToTable",value:CH});}return ;}var CK={success:function(CL){CF.model.selectSourceTable(CH);CE.populateEMMA(CL,CC,CH);CB.selectPending=false;if(CJ){CE.raiseEvent({name:"scrollToTable",value:CH});}},failure:function(CL){CB.selectPending=false;if(CE.operationMode===Ac.operationMode.create&&parseInt(CL.code,10)!==Ac.backendError.shouldBeIgnored){CF.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CL.message||"");}else{if(CB){CB.cannotFetchPreview=true;CE.raiseEvent({name:"PreviewNotFetched"});}}if(CJ){CE.raiseEvent({name:"scrollToTable",value:CH});}}};if(CB){var CD=(!!CB.currentMapping&&!!CB.currentPreview)||(!!CB.transformedMapping&&!!CB.transformedPreview);if(!CD){if(CB&&CB.currentTransformations&&CB.currentTransformations.xtab&&CB.currentTransformations.xtab.isCrosstab){CC=CC&(~Ac.requestFlag.preview);CC=CC&(~Ac.requestFlag.transformations);CC|=Ac.requestFlag.transformedPreview;}else{CC=CC&(~Ac.requestFlag.transformedPreview);CC|=Ac.requestFlag.preview;}if(CB.type===Ac.sourceType.querybuilder){CC=CC&(~Ac.requestFlag.sheets);CC=CC&(~Ac.requestFlag.transformations);CC=CC&(~Ac.requestFlag.sourceInfo);}if(CE.operationMode===Ac.operationMode.edit||CE.operationMode===Ac.operationMode.refresh){CC=CC&(~Ac.requestFlag.sheets);}if(CB.subtype===Ac.sourceSubtype.googleBigQuerySingleTable){CC=775;}if(CB.databaseType===j&&CB.xdaType===Ac.xdaType.qbSingleTable){CC=CC&(~Ac.requestFlag.preview);}CG=true;}}if(CG&&!CB.cannotFetchPreview){if(CB.selectPending&&CC===CB.selectPendingFlags){return ;}CB.selectPending=true;CB.selectPendingFlags=CC;CF.model.selectSourceTable(CH);CF.dataService.getImportedData(CK,{previewflag:CC,sheetIndex:0,tableID:CH},{showProgress:false});}else{CF.model.selectSourceTable(CH);if(CJ){CE.raiseEvent({name:"scrollToTable",value:CH});}}},removeSourceTable:function A0(CG){var CF=this,CB=CF.getModel().getImportSource(CG);var CD={did:CG};var CH=mstrmojo.desc(13646,"Oops ... Empty Dataset"),CE=mstrmojo.desc(13883,"The dataset cannot be empty. Please add more tables before deleting this one."),CC=CF.getModel().getAllTableID();function CJ(CK){var CN=mstrApp.getRootController().getModel().importSources,CM=[],CP=false,CQ;if(CK.isLinked){for(var CL in CN){if(CN.hasOwnProperty(CL)&&CL!==CK.tableId){CQ=CN[CL].findMappingItem(CK);if(CQ){CM.push(CQ);CP=true;}}}}for(var CO=0;CO<CM.length;CO++){CM[CO].recursive=0;}CF.changeEMMAMappings({success:function(){CF.dataService.removeEMMASourceTable(CI,CD);}},undefined,true);}if(CG===-1){return ;}var CI={success:function(CL){CF.dataService.set("messageID",CL.msgid);CF.model.resetImportSource(CG);CF.model.raiseEvent({name:"removeSourceTable",tableID:CG});CF.navigationController.deleteRoute(CG);var CK=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;if(CF.model.getAllTableID().length>0){CF.getImportedDataEMMA(BF.none,CK);}else{CF.showPage(Ac.pageType.dataSelection);}},failure:function(CK){CF.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,CK.message||"");}};if(CC.length===1){mstrmojo.alert(CE,mstrmojo.emptyFn,CH,CF.getDialogController().getNextZIndex());}else{if(CB.isHierarchyRelationTable()){mstrmojo.confirm(A2(null,"If you remove this hierarchy relation table, we will reset all the recursive attribute linking to it. Are you sure about doing this?"),{},{buttons:[Bo(A2(1442,"OK"),function(){var CK=CB.getRecursiveAttrAndMFA()||{};CJ(CK);CF.dataService.removeEMMASourceTable(CI,CD);},true),Bo(A2(221,"Cancel"))]});}else{CF.dataService.removeEMMASourceTable(CI,CD);}}},autoMappingAfterRefine:function d(CD,CE,CF){var CG={};if(CF){CG.behaviorFlags=Ac.behaviorChangeFlag.refreshData;}else{CG.behaviorFlags=Ac.behaviorChangeFlag.remapping;}var CC=this;var CB={success:function(){CC.getImportedDataEMMA(BF.none,CD,undefined,undefined,CE);},failure:function(CI){CC.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CI.message||"");}};var CH={success:function(CI){if(CI&&CI.msgid){CC.dataService.set("messageID",CI.msgid);}CC.dataService.detectRelationshipSourceTable(CB,{did:CE});},failure:function(CI){CC.displayError(mstrmojo.desc(12798,"Error when auto mapping after wrangle."),false,CI.message||"");}};CG.tbid=CE;this.dataService.autoMappingSourceTable(CH,CG);},startRefineStage:function R(CF,CC,CE,CH){var CB=this;var CD=CB.model;var CG={did:CF,flag:CC,xml:CE};var CI={success:function(CL){if(CL){CB.dataService.set("messageID",CL.msgid);}if(CC!==3){var CJ=8;CB.getImportedDataEMMA(BF.refine,CJ,undefined,undefined,CF,CC-1);}else{var CM=CB.model.getImportSource(CF);var CK=Ac.requestFlag.preview|Ac.requestFlag.mapping|Ac.requestFlag.transformations|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;if(CM&&CM.currentTransformations&&CM.currentTransformations.xtab&&CM.currentTransformations.xtab.isCrosstab){CK=CK&(~Ac.requestFlag.preview);CK=CK&(~Ac.requestFlag.transformations);CK|=Ac.requestFlag.transformedPreview;}else{CK=CK&(~Ac.requestFlag.transformedPreview);CK|=Ac.requestFlag.preview;}CB.editImportedDataEMMA(CK,null,null,null,CF);}},failure:function(CJ){CB.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,CJ.message||"");}};if(CC===3){CB.model.cleanDuplicateRI(false,{success:function(CJ){CB.dataService.startRefineStage(CI,CG);}});}else{CD.originalMsgID=CB.dataService.messageID;CB.dataService.removeOrDuplicateRI({success:function(CJ){mstrApp.msgid=CJ.msgid;if(CH){if(CI&&CI.success){CI.success(CJ);}}else{CB.dataService.set("messageID",CJ.msgid);CB.dataService.startRefineStage(CI,CG);}}},{messageID:CD.originalMsgID});}},cancelRefineStage:function H(CD,CC){var CB=this;var CE={did:CD};var CF={success:function(CI){if(mstrApp.msgid){CB.dataService.set("messageID",mstrApp.msgid);}var CJ=CB.model.importSources[CD];delete CJ.projectID;var CH=Ac.requestFlag.preview|Ac.requestFlag.mapping|Ac.requestFlag.transformations|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;if(CJ&&CJ.currentTransformations&&CJ.currentTransformations.xtab&&CJ.currentTransformations.xtab.isCrosstab){CH=CH&(~Ac.requestFlag.preview);CH=CH&(~Ac.requestFlag.transformations);CH|=Ac.requestFlag.transformedPreview;}else{CH=CH&(~Ac.requestFlag.transformedPreview);CH|=Ac.requestFlag.preview;}if(CC){CB.dataService.cancelRefineStage({success:function(CK){CB.editImportedDataEMMA(CH,null,null,null,CD,null,null,null,null,true);}},CE);}else{var CG=CJ&&CJ.currentIndex;CB.getImportedDataEMMA(BF.none,CH,CG,undefined,CD,null,null);}},failure:function(CG){CB.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,CG.message||"");}};CB.getModel().cleanDuplicateRI(!CC,CF);},refreshSourceTable:function Bg(CJ){var CI=this;var CB=CI.model.getImportSource(CJ);var CD=CB.sourceInfo.dbTableName.replace(/^file:\/\/\//,"");var CM;var CC={next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};var CE=mstrmojo.desc(14155,"Please input your original data into clipboard because you have parsed or wrangled the data.");var CL={success:function(CN){CM.getConfig().properties.content=CN;CI.showPage(Ac.pageType.clipboard,0,CM,CC);},failure:function(CN){CI.showPage(Ac.pageType.clipboard,0,CM,CC);CI.displayError(mstrmojo.desc(12795,"Could not load clipboard data!"),false,CN.message);}};if(!CB){return ;}delete CB.projectID;CM=CI.navigationController.getPageSlot();CM.setConfig({name:CD,properties:{tableID:CJ,currentSource:CB,isMultiSelect:false,operationMode:Ac.operationMode.edit},footerConfig:CC,newPage:true,newPageConfig:{cssClass:"mstrmojo-di-refresh-data-editor"}});if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.localFile){if(CI.model.refreshToWrangle&&mstrApp.isSingleTier&&window.FormWrapper.isFilePathExist(CB.sourceInfo.url)){CI.refreshOnetierLocalFile(CJ);}else{CI.showPage(Ac.pageType.file,CB.subtype-1,CM,CC);}}else{if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.url){CC.next.enabled=true;CI.showPage(Ac.pageType.file,CB.subtype-1,CM,CC);}else{if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.cloudElement){CC.next.enabled=true;CI.showPage(Ac.pageType.cloudElement,CB.subtype-1,CM,CC);}else{if(CB.type===Ac.sourceType.hadoop&&CB.subtype===Ac.sourceSubtype.hadoop){if(CC&&CC.next){CC.next.isRefresh=true;}CI.showPage(Ac.pageType.hadoop,CB.subtype-1,CM,CC);}else{if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.clipboard){var CG={previewflag:Ac.requestFlag.fullData,browsetype:4,sheetIndex:0,bindingflag:0,tableID:CJ};if(!CB.isParsed()&&!CB.isRefined()){this.dataService.getImportedData(CL,CG,0);}else{CI.showPage(Ac.pageType.clipboard,0,CM,CC);mstrApp.getRootController().displayWarning(CE,null,mstrmojo.emptyFn,{showCancel:false});}}else{if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.samplefile){CI.showPage(Ac.pageType.sampleFiles,null,CM,CC);}else{if(CB.type===Ac.sourceType.file&&CB.subtype===Ac.sourceSubtype.publicData){CI.showPage(Ac.pageType.publicData,null,CM,CC);this.scrapeWiki(CB.sourceInfo.url,false);}else{if(CB.type===Ac.sourceType.querybuilder){mstrApp.getRootController().showPage(Ac.pageType.database,{sourceType:CB.type,type:CB.xdaType,extParams:{tableID:CJ,isRefined:CB.sourceInfo.isRefined,subtype:CB.subtype,databaseType:CB.databaseType}},CM,CC);}else{if(CB.type===Ac.sourceType.salesforce||CB.type===Ac.sourceType.googleDrive||CB.type===Ac.sourceType.dropbox||CB.type===Ac.sourceType.googleAnalytics||CB.type===Ac.sourceType.googleBigQuery){CI.getOAuthSourceReports(CB.type,false,CM);}else{if(CB.type===Ac.sourceType.bisource){mstrApp.getRootController().showPage(Ac.pageType.database,{sourceType:Ac.sourceType.bisource,type:Ac.xdaType.dataImportBISource,extParams:{tableID:CJ}},CM,CC);}else{if(CB.type===Ac.sourceType.twitter||CB.type===Ac.sourceType.facebook){var CF,CH,CK;if(CB.type===Ac.sourceType.twitter){CF=BA.spliceUrlBySeparator(CB.sourceInfo.url);CH=JSON.parse(CF);CK=CM.getConfig().properties;if(CH!==undefined){CK.searchParam=CH.query;}if(CB.fetchNum){CK.fetchNum=CB.fetchNum;}}else{CF=decodeURIComponent(CB.sourceInfo.url.split("###")[1]);CH=JSON.parse(CF);if(CH!==undefined){CM.getConfig().properties.searchParam=CH.query;CM.getConfig().properties.groupID=CH.groupID;if(CH.advProps){CM.getConfig().properties.advProps=CH.advProps;}}}CI.getOAuthSourceReports(CB.type,true,CM,"");}}}}}}}}}}}CB.invalidPreview();},refreshOnetierLocalFile:function(CF){var CB=this,CD=this.getModel(),CH=this.getDataService(),CG=CD.getImportSource(CF),CC=CG.sourceInfo.url;function CE(CI){CB.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CI&&CI.message);}if(CC.indexOf("file:///")===0){CC=CC.substr(8);}CB.oneTierImportFile({success:function(CI){if(CI&&CI.msgid){CH.set("messageID",CI.msgid);}CH.autoMappingSourceTable({success:function(){CB.detectRelationshipSourceTable(null,[CF],Ac.actions.refreshData);},failure:CE},{tbid:CF,shtIx:CG.sourceInfo.sheetIndex,behaviorFlags:Ac.behaviorChangeFlag.refreshData});},failure:CE},{msgID:CH.messageID,tableID:CF,datasource:CC,dict:Ac.backendSourceSubtype.localFile,fileName:CC,__index:0,behaviorFlags:0});},openRenameTextBox:function Bk(CB,CD,CC){this.mappingController.openRenameTextBox(CB,CD,CC);},changeEMMAMappings:function h(CL,CK,CJ){var CH=this;var CG=CH.model;var CI=[];var CB=CG.getAllTableID();var CE,CF;var CD;var CC={success:function(){var CN=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;if(!CJ){CH.getImportedDataEMMA(BF.none,CN);}else{CH.getImportedDataEMMA(Ac.actions.none,CN,null,null,null,null,CL);}},failure:function(CN){CH.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CN.message);}};for(CE=0;CE<CB.length;CE++){CF=CG.getImportSource(CB[CE]).getMappingChanges();if(CF&&CF.length>0){CI.push(CB[CE]);}}CE=0;var CM={success:function(CO){CH.dataService.set("messageID",CO.msgid);var CP=0;CE++;if(CE<CI.length){CD={tbid:CI[CE],mapping:B5.call(CH,CI[CE])};CG.getImportSource(CI[CE]).invalidPreview();CH.dataService.changeMappingSourceTable(CM,CD);}else{var CN=[];mstrmojo.array.forEach(CI,function(CR){var CQ=CG.getImportSource(CR);if(CQ.canAutoMappingAndDetectRelation()){CN.push(CR);}});if(CN.length>0){Bl.forEach(CN,function(CQ){CH.dataService.detectRelationshipSourceTable({success:function(){CP++;if(CP>=CN.length){CC.success();}},failure:function(CR){CH.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CR.message);}},{did:CQ});});}else{CC.success();}}},failure:function(CP){var CO=parseInt(CP.code,10);var CQ=mstrmojo.desc(12800,"Cannot change mapping.");switch(CO){case Ac.backendError.invalidObjectName:CQ=mstrmojo.desc(12801,"Cannot change mapping with invalid characters");break;case Ac.backendError.stringTooLong:CQ=mstrmojo.desc(12802,"Cannot change mapping with a too long string");break;}CH.displayError(CQ,false,CP.message);var CN=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;CH.getImportedDataEMMA(BF.none,CN);}};if(CE<CI.length){CD={tbid:CI[CE],mapping:B5.call(CH,CI[CE],CK)};CG.getImportSource(CI[CE]).invalidPreview();CH.dataService.changeMappingSourceTable((CL&&!CJ)?CL:CM,CD);}},editRelationship:function z(CH,CG,CI){var CC=this;if(!CH||!CG||!CH.length){return ;}var CE=0;var CD={success:function(){var CJ=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship;CC.getImportedDataEMMA(BF.none,CJ);},failure:function(CJ){CC.displayError(mstrmojo.desc(12803,"Cannot edit relationship."),false,CJ.message||"");}};var CB=mstrmojo.func.wrapMethods(CD,CI,{});var CF={success:function(){CE++;if(CE<CH.length){CG.did=CH[CE];CC.dataService.editRelationshipSourceTable(CF,CG);}else{CB.success();if(CB.complete){CB.complete();}}},failure:function(CJ){CB.failure(CJ);if(CB.complete){CB.complete();}}};CG.did=CH[0];CC.dataService.editRelationshipSourceTable(CF,CG);},openRelationsDefineEditor:function(CC){var CB;if(!CC){return ;}CB={tableID:CC};this.showDialog(Ac.dialogType.relationDefineDialog,CB);},removeEMMASourceTable:function Bn(CC,CB){this.dataService.removeEMMASourceTable(CC,CB||{});},showDialog:function BN(CC,CB){return this.dialogController.show(CC,CB);},hasDialog:function Z(CB){this.dialogController.hasDialog(CB);},closeDialog:function A8(CB){this.dialogController.close(CB);},closePageDialog:function B4(){if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}},toAttribute:function m(CB){this.mappingController.toAttribute(CB);},toMetric:function L(CB){this.mappingController.toMetric(CB);},setMultipleImport:function AH(CB){this.mappingController.setMultipleImport(CB);},setGeoRoles:function Br(CB){this.mappingController.setGeoRoles(CB);},setTimeDimension:function b(CB){this.mappingController.setTimeDimension(CB);},setTimeRole:function Am(CB){this.mappingController.setTimeRole(CB);},toUnused:function BC(CB){this.mappingController.toUnused(CB);},openUnLinkDialog:function Ag(CB){this.mappingController.openUnLinkDialog(CB);},unlinkAll:function Bw(CC,CB){this.mappingController.unlinkAll(CC,CB);},unlinkAllCubeLevel:function BU(CB){this.mappingController.unlinkAllCubeLevel(CB);},linkAttributes:function X(CC,CB){this.mappingController.linkAttributes(CC,CB);},toProjectAttribute:function Bq(CC,CB){this.mappingController.toProjectAttribute2(CC,CB);},unmap:function c(CB){this.mappingController.unmap(CB);},importItem:function U(CB){this.mappingController.importItem(CB);},changeDataType:function Af(CC,CB,CD){this.mappingController.changeDataType(CC,CB,CD);},attachDataChangeListeners:function Bm(CD){var CB=this.model,CC=[];Bt.forEach(CD,function(CE,CF){Bt.forEach(CE,function(CH,CG){CC.push(CB.attachEventListener(CG,CF,CH));});});return CC;},detachDataChangeListeners:function B2(CC){var CB=this.model;Bl.forEach(CC,function(CD){CB.detachEventListener(CD);});},raiseModelEvent:function AQ(CB){this.model.raiseEvent(CB);},getTableNames:function Ab(){var CD=this.model,CB=CD.importSources,CE,CC=[],CF;for(CF in CB){if(CB.hasOwnProperty(CF)){CE=CB[CF];if(CE&&CE.tableID){CC.push({n:CE.sourceInfo.name,id:CE.tableID});}}}return CC;},getCurrentSource:function AX(){return this.model.currentSource;},createNewReportInstance:function(CG){var CB=this,CC=this.getModel(),CE=CC.currentDataset,CD=CC.isManagedCube,CF=null;if(!CE){if(CD){CF={extParams:"<mgo>1</mgo>"};}CB.dataService.createEMMAReportInstance(CG,CF);}else{CB.duplicateSelectedDataset(CG);}},removeCurrentReportInstance:function(CH){var CC=this,CE=CC.getDocController(),CD=this.getModel(),CG=CC.dataService,CF=CD.curDataset;var CB={success:function(){CD.curDataset=null;CD.currentDataset=null;CG.messageID=null;if(CH.success){CH.success();}},failure:function(CI){CC.displayError(CI&&CI.message,false);},complete:function(){if(CH.complete){CH.complete();}}};if(CF&&CF.id){CE.removeDataset(CB,CF);}else{CB.success();CB.complete();}},backFromQB:function(){var CB=this;if(CB.dialogController.pageZIndex===0){CB.removeCurrentReportInstance({success:function(){CB.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}});}else{CB.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}},saveSourceListAdminConfig:function(CF,CE){var CB=this,CD=this.getModel(),CC={};var CG={success:function(){CB.showPage(Ac.pageType.dataSelection);}};CD.populateSourceListAdminConfig(CF,CE);if(CF||CE){if(mstrApp.diParams.connectorConfig){CC=mstrApp.diParams.connectorConfig;}else{CC={};}if(CF){CC.resourceConfig=CF;}if(CE){CC.dbRoleConfig=CE;}if(mstrApp.isSingleTier){this.dataService.updatePreferences(CG,"diConnectorConfig",JSON.stringify(CC));}else{this.dataService.setPreference(CG,{prefs:"diConnectorConfig\u001E"+JSON.stringify(CC)});}}else{CG.success();}},saveUserDefined:function(CH,CF){var CG=mstrApp.getRootController().getModel(),CB=CG.externalSources[CH],CC=mstrApp.getRootController(),CI=[],CD,CJ={success:function(){CB.userDefined=!!CF;},failure:function(){CC.displayError(mstrmojo.desc(null,"Saving user preconfig error! Please connect to the Administrator"));}};if(CF){CI.push(CH);}for(var CE in CG.externalSources){if(CG.externalSources.hasOwnProperty(CE)){if(CG.externalSources[CE].userDefined&&CG.externalSources[CE].type!==CH){CI.push(CG.externalSources[CE].type);}}}CD={diOauthConfig:CI};this.dataService.setPreference(CJ,{prefs:"diOauthConfig\u001E"+JSON.stringify(CD)});},showSaveVisual:function(){this.rootView.showSaveVisual();},closeDIPopup:Au,getAttributesAndMetrics:function BV(CH,CJ){var CB,CG,CE=[],CI=[],CD=12,CC=4,CF=CJ?CJ.toUpperCase():"";CB=this.getModel().getImportSource(CH);if(!CB){return[CE,CI];}CG=CB.getCurrentMappings(function(CK){return CK.selected&&(!CF||CK.alias.toUpperCase().indexOf(CF)!==-1);});CE=mstrmojo.array.filter(CG,function(CK){return CK.tp===CD;});CI=mstrmojo.array.filter(CG,function(CK){return CK.tp===CC;});return[CE,CI];},getDBRoles:function C(CC,CB){var CE={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1+2048,typeFilter:(CC||[]).join(","),versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",isDataImport:true};var CF={success:function CD(CG){if(mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp"){mstrApp.dbRoles=CG;mstrApp.dbRolesAdminConfig=Bl.map(CB,function(CH){return CH;});}},failure:function(CG){}};mstrApp.serverRequestQueue(CE,CF,w);},getCloudElementDBRoles:function AP(CD){var CB=this.model;var CC={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:"18200",versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",};var CE={success:function(CF){var CG=Bl.map(CF.dbRoles,function(CH){return(function(CJ){var CI=Bt.copy(CB.cloudElement,{}),CL=Bt.walk("connectorConfig.resourceConfig",mstrApp.diParams),CK=CL&&Array.prototype.indexOf.call(CL,CJ.did)<0;return Bt.copy({n:CJ.n,desc:mstrmojo.desc(12876,"Connect to ####").replace("####",CJ.n),onclick:function(CM){var CO=Bt.walk("rootView.currentPage.pageType",mstrApp.getRootController()),CN=Object.getPrototypeOf(this);if(CO===Ac.pageType.sourceAdmin){CN.onclick.call(this,CM);}else{this.handleSourceSelect(this,CJ);}},selected:CK,oid:CJ.did,},CI);})(CH);});if(CG.length){CB.set("sourceItems",CB.sourceItems.concat(CG));CB.set("cloudElementSrcItems",CG);}CB.populateCloudElementDBRole(CF);CB.raiseEvent({name:Ac.srcItemTypes.CLOUDELEMENT_CONNECTOR,src:CB});if(CD&&CD.success){CD.success();}}};mstrApp.serverRequestQueue(CC,CE,w);},getAuthenticationDBRoles:function Aw(CE){var CC=this.model;var CG={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:"7700",versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",isDataImport:false};var CB=3;function CD(){mstrApp.serverRequestQueue(CG,CH,w);}var CH={success:function CF(CI){CC.populateAuthenticationDBRole(CI);CE&&CE();},failure:function(){if(CB-->0){console.log("fail");window.setTimeout(function(){CD();},1);}}};CD();},getManagedAuthDBR:function(CE){if(!CE){return ;}var CD=this.getModel(),CC=CD.getImportSource(CE),CB=Bt.walk("sourceInfo.dbRoleId",CC);if(CB&&CB!==""&&[Ac.urlAuthDBRoles.anonymous,Ac.urlAuthDBRoles.windows,Ac.urlAuthDBRoles.kerberos,Ac.urlAuthDBRoles.integrated].indexOf(CB)<0&&(CD.authDBRoles&&Array.prototype.indexOf.call(CD.authDBRoles,CB)<0)){this.dataService.getSingleDBRole({success:function(CG){var CF=typeof (CG.dbr)==="object"?CG.dbr:JSON.parse(CG.dbr),CH=CF.dbRoles[0];CH.isManagedDBR=true;var CI=CD.authDBRoles.concat(CH);CD.set("authDBRoles",CI);}},{dbrId:CB});}},archSearch:function Bf(CC,CB){if(mstrApp.isSingleTier){mstrApp.serverRequestQueue(CB,CC,w);}else{mstrApp.serverRequestQueue(Bt.copy(CB,{taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,}),CC,w);}},beforeDIUnload:function(CC){var CD=mstrmojo.desc(14610,"Are you sure you want to navigate away from this page? Any unsaved work will be lost."),CG=this.getModel().operationMode,CF=this.rootView,CB=this.dialogController,CE=false;if(CG===Ac.operationMode.create||CG===Ac.operationMode.edit){if(CB.pageZIndex>0){CE=true;}else{if(CF&&CF.currentPage&&CF.currentPage.pageType===Ac.pageType.emmaPreview){CE=true;}if(this.model.getHistoryList().hasSentToHistoryList){CE=false;}}}if(CE){CC.returnValue=CD;return CD;}},launchWrangleForTable:function By(CD){var CB=this;var CC=this.getModel();var CE;CE=CC.getImportSource(CD);if(!CE){CE=CC.currentSource;}if(!CE){return ;}if(CE.canLaunchWrangler()){CB.launchWranglerDialog(CE);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(CB.model)){CB.model.isAddingNewTable=false;CB.model.refreshToWrangle=CE.tableID;CB.refreshSourceTable(CE.tableID);}else{CB.displayError(mstrmojo.desc(14200,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}},importFromCube:function(CK,CJ,CD){var CF=this,CE=CF.getModel(),CC=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.relationship,CB;function CI(CO){var CL=CE.cubeName;var CS=mstrmojo.desc(14888,"We detected that the datasets contain identical tables. The definition from ### will be used. The following tables are affected:").replace("###",CL);var CP=mstrmojo.desc(14889,"We detected that the datasets contain identical tables. The definition from the current dataset will be used. The following tables are affected:");var CR;var CM;function CN(){CH();}try{CO=JSON.parse(CO);}catch(CQ){CN();return ;}if(!CO||!CO.table){CN();return ;}CM=CO.table;CM=[].concat(CM);if(CM.length<0){CN();return ;}CR="<ul>";Bl.forEach(CM,function(CT){CR+="<li>"+CT.n+"</li>";});CR+="</ul>";mstrApp.getRootController().displayError(CL?CS:CP,false,CR,CN);}function CH(){var CL=mstrApp.getRootController();var CN={success:function(){var CQ=CE.getAllTableID(),CP;CP=Bl.difference(CQ,CB);CP=Bl.filter(CP,function(CT){var CS=CE.getImportSource(CT);var CR=CS&&CS.xdaType;if(CR===Ac.xdaType.excel||CR===Ac.xdaType.text){return true;}return false;});Bl.forEach(CP,function(CS){var CR=Ac.requestFlag.mapping|Ac.requestFlag.sourceInfo|Ac.requestFlag.transformations;CL.getImportedDataEMMA(Ac.actions.none,CR,undefined,undefined,CS);});}};var CO={onOK:function(){CL.getImportedDataEMMA(CD,CC,undefined,undefined,undefined,0,CN);},onCancel:function(CP){CL.getImportedDataEMMA(CD,CC,undefined,undefined,undefined,0,CN,CP);}};var CM=true;CL.autoDetectPartitionGroups(CO,undefined,CM);}var CG={success:function(){CB=CE.getAllTableID();CF.getImportController().importFromCube(CK,{success:function(CL){if(CL&&CL.dupts){CI(CL.dupts);}else{CH();}},failure:function(CL){if(parseInt(CL.code,10)===Ac.backendError.ddasupportIncompatible){mstrApp.getRootController().displayError(mstrmojo.desc(14890,"Cannot perform the action since one of the cube support Direct Data Access only while the other is In-Memory only."),false,CL.message);}else{if(parseInt(CL.code,10)===Ac.backendError.mergeInvalidXdatype){mstrApp.getRootController().displayError(mstrmojo.desc(14891,"Import from a cube of some XDAType is not supported, such as MDX, Search Engine Indices."),false,CL.message);}else{if(parseInt(CL.code,10)===Ac.backendError.notFullyControl){mstrApp.getRootController().displayError(mstrmojo.desc(14892,"User dont have full control for the merge cube."),false,CL.message);}else{mstrApp.getRootController().displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),false,CL.message);}}}}});},failure:function(CL){CF.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CL.message||"");}};if(CJ){CF.createNewReportInstance(CG);}else{CG.success();}},searchObjectName:function(CD,CB){var CC={success:function(CE){if(CE&&CE==="existed"){CD.rename();}else{CD.saveDirectly();}},failure:function(CE){}};this.getDataService().searchObjectName(CC,CB);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.string","mstrmojo.DI.DIRootController","mstrmojo.AS.ASQbEsController","mstrmojo.AS.ASQbFFSQLController","mstrmojo.AS.ASGBQController","mstrmojo.DI.DIConstants","mstrmojo.AS.DIAppSchemaRefreshFileEditor","mstrmojo.AS.ASGBQFFSQLController");mstrmojo.requiresDescs(12779);var K=mstrmojo.hash,V=mstrmojo.DI.DIConstants,I=mstrmojo.array,H=mstrmojo.string,A=4*1024*1024,E={url:"fileUrl",localFile:"fileLocal",googleDrive:"googleDrive",salesForce:"salesforce",dropBox:"dropbox"},Q={url:"Data from URL",localFile:"File from Disk"},F=0;function G(X){window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(X);}function D(Z){var X=Z.trim().split("/");var Y=X[X.length-1];return Y;}function P(Y,X,Z){I.forEach(Y,function(c,b,a){var d=(X===c.n);c.n=(c.n&&c.n.replace?c.n.replace(d?X:X+"_",d?Z:""):c.n);c.title=(c.title&&c.title.replace?c.title.replace(d?X:X+"_",d?Z:""):c.title);});}function W(b,Z,Y,a){var X;switch(Y){case V.pageType.file:X=R(b,Z);break;case V.pageType.sourceObjectsDnD:X=N(b,Z,a);break;}G(X);mstrApp.getRootController().exitApplication();}function B(e,k){var c=window.mstrAppSchema.workspaceManager.initialWorkspaceId,Y=window.mstrAppSchema.workspaceManager.currentClientId,f=mstrApp.getRootController(),h=this,b={clientId:Y,requestId:"",workspaceId:c,datasource:{}},g=[],a=[],Z=[],X=0,j={success:function(m){var n,p=[];m=m.body;if(!m.sheetsInfo){f.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,m&&m.message);return ;}n=m.sheetsInfo;I.forEach(n.sheetsNames,function(u,t,q){!n.isEmptySheets[t]&&p.push({idx:t,n:u,title:u,selected:t===0});});if(e.length===1&&p.length===0){mstrmojo.alert("The file sheet is empty");return ;}if(e.length===1&&p.length===1){var o=[];o.push({sheets:p,isSingleSheet:true});W(e,o,h.pageType,k);return ;}if(p.length===1){a.push({sheets:p,isSingleSheet:true});Z.push(X);}else{if(/\.json$/i.test(e[X].name)){P(p,e[X].url,e[X].name);}g.push({defaultSheetsIndex:0,multiSelection:true,n:e[X].name||e[X].url,sheets:p,id:e[X].url});}X++;if(X===e.length){if(a.length===e.length){W(e,a,h.pageType,k);}else{var l={items:g,onOK:function(){var q=this.items.slice(0);if(a.length>0){I.forEach(a,function(w,u,t){q.splice(Z[u],0,w);});}W(e,q,h.pageType,k);},onBack:function(){this.unrender();}};f.showDialog(V.dialogType.sheetsSelectionDialog,l);}}}},d;f.dataService=new mstrmojo.DI.DIDataService();I.forEach(e,function(n,m,l){K.copy(n,b.datasource);d={path:"/workspaces/"+c+"/file-sheets-info",form:JSON.stringify(b),method:"POST"};f.dataService.archSpark(j,d);});}function M(Z,Y){var X={},a=-1;X[a]={id:a,name:Z,type:V.dbType.URL,tables:[{name:Z,dbr:a,url:Y,type:"fileLocal"}]};return X;}function R(a,Z){var X={};table=[],params={};I.forEach(a,function(h,f,c){var e=h.url,b=h.dbRoleId,d=D(e),g=Z[f].sheets;I.forEach(g,function(n,l,k){var m=!!Z[f].isSingleSheet;if(n.selected||m){table.push({dbr:b,fileName:h.name,name:m?(h.name||d):(n.n+" - "+(h.name||d)),ns:e,url:e,type:h.type,sheetIndex:n.idx});}});});params.tables=table;params.id=a[0].type===E.url?V.dbType.URL:V.dbType.LOACLFILE;params.name=a[0].type===E.url?Q.url:Q.localFile;params.type=params.id;var Y=Math.random();X[Y]=params;return X;}function U(Z,c,b){var X={},d={},a=[];d.id=Z.dbRoleID;d.name=b;d.type=V.dbType.GOOGLE_ANALYTICS;for(var Y=0;Y<c.length;Y++){a[Y]={dbr:Z.dbRoleID,dbtn:c[Y].n,n:c[Y].n,name:c[Y].n,url:c[Y].query,account_id:Z.sourceAccountID,_renderIdx:0};}d.tables=a;X[Z.dbRoleID]=d;return X;}function N(b,Z,a){var X={};table=new Array(),params={};I.forEach(b,function(j,g,d){var f=j.url,c=j.dbRoleId,e=D(f),h=Z[g].sheets;I.forEach(h,function(n,l,k){var m=!!Z[g].isSingleSheet;if(n.selected){table.push({dbr:c,name:m?e:n.n+" - "+e,type:j.type,url:f,sheetIndex:n.idx,account_id:a.said,});}});});params.id=a.dbRoleID;params.tables=table;params.name=a.name;if(a.type===V.sourceType.googleDrive){params.type=V.dbType.GOOGLE_DRIVE;}else{if(a.type===V.sourceType.salesforce){params.type=V.dbType.SALESFORCE;}else{if(a.type===V.sourceType.dropbox){params.type=V.dbType.DROPBOX;}else{mstrmojo.alert("The source type match failed.");return ;}}}var Y=Math.random();X[Y]=params;return X;}function J(f,Z,g,d,e,h){var b=arguments.callee,Y=f.files,a=Y[0];if(!a){mstrApp.hideProgress(true);f.set("files",f.shiftedFiles);delete f.shiftedFiles;h.complete();return ;}if(Z===undefined&&g===null){mstrApp.upload({success:function(j){b(f,0,j,d,e,h);},failure:function(j){mstrApp.hideProgress(true);}},K.copy(d,{index:-1}),null,e);}else{var c=Math.min(a.size,Z+A),X=a.slice(Z,c),e=K.copy({async:true},e);mstrApp.upload({success:function(j){if(Z+A<a.size){Z+=A;b(f,Z,j,d,e,h);}else{var k=Y.shift();f.shiftedFiles instanceof Array?f.shiftedFiles.push(k):(f.shiftedFiles=[k]);h.success(k.name,j.uploadingId);b(f,undefined,null,d,e,h);}},failure:function(j){mstrApp.hideProgress(true);}},K.copy(d,{index:g.index+1,uploadingId:g.uploadingId,fileName:a.name,fileFieldName:"file"}),X,e);}}function L(X,e){var c="<ul>",d=true,b=false,Y=mstrApp.getRootController();I.forEach(X.files,function(j,h,g){var n="C:\\fakepath\\"+j.name,f=[],l,m=n.substring(n.lastIndexOf(".")+1);if(j!==undefined){l=j.size;}if(l>(mstrApp.diParams.UploadSizeLimit*1024*1024)){b=true;f.push(j.name);var k=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",m).replace("@@@@",mstrApp.diParams.UploadSizeLimit);c+="<li>"+encodeURIComponent(j.name)+"<br>"+k||" </li>";j.toDel=true;}else{d=false;}if(m==="mstr"){Y.displayError(mstrmojo.desc(14194,"Error: Only Excel Text, CSV can be uploaded. Please use the Upload MicroStrategy File to import .MSTR files."),false);return ;}});if(b){c+="</ul>";if(d){Y.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,c);}else{var a=function(){for(i=0;i<X.files.length;i++){var f=X.files[i];if(f.toDel){I.removeItem(X.files,f);}}e();};var Z={detailErrorMessage:c,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){}};Y.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),a,Z);}}else{e();}}mstrmojo.AS.ASDIRootController=mstrmojo.declare(mstrmojo.DI.DIRootController,null,{scriptClass:"mstrmojo.AS.ASDIRootController",showPage:function O(X,Y,a,Z){return this._super(X,Y,a,{finish:{visible:true},next:{visibile:false},cancel:{visible:true},save:{visible:false},back:{visible:true},cubeQuota:{visible:false}});},getQueryBuilderParams:function C(Z,X){var Y="";if(Z===V.xdaType.googleBigQuerySingleTable){Y="mstrmojo.AS.ASGBQController";}else{if(Z===V.xdaType.ffsql){Y="mstrmojo.AS.ASQbFFSQLController";}else{if(Z===V.xdaType.googleBigQueryFFSQL){Y="mstrmojo.AS.ASGBQFFSQLController";}else{Y="mstrmojo.AS.ASQbEsController";}}}return this._super(Z,K.copy({rootControllerCls:Y,pageName:mstrConfig.pageName,servletState:mstrConfig.servletState},X||{}));},doLocalFileImport:function(a){var X=this.rootView.currentPage.dnDBox,Z={taskId:"arch.sparkFileUpload",taskContentType:"json",taskEnv:"xhr",fileType:"application/octet-stream",workspaceId:window.mstrAppSchema.workspaceManager.initialWorkspaceId},Y={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")};X.fileMap=[];if(Y.showProgress){mstrApp.showProgress(Y);}L(X,function(){J(X,undefined,null,Z,Y,{complete:function(){typeof a==="function"&&a(X.fileMap);},success:function(d,c){var b=M(d,c);X.fileMap.push(b);}});});},onFinishButtonClick:function S(){var a=mstrApp.getRootController();a.dataService=new mstrmojo.DI.DIDataService();var e=this.rootView.currentPage;switch(e.pageType){case V.pageType.file:var Y=[];if(e.sourceSubtype===V.sourceSubtype.url){var g,X,b;if(e.mode===F){g=e.urlList.urls.slice(0);X=e.urlList.dbrs.slice(0);if(e.urlInput.value&&e.urlInput.value.length>0){g.push(e.urlInput.value);X.push(e.dbroles.getSelectedDBRole());}}else{g=e.urlBrowse.getDropZone().urls.slice(0);b=e.dbroles.getSelectedDBRole();}I.forEach(g,function(o,n,m){Y.push({dbRoleId:e.mode===F?X[n].did:b.did,url:o.trim(),type:E.url});});B.call(e,Y);}else{if(e.sourceSubtype===V.sourceSubtype.localFile){this.doLocalFileImport(function(m){I.forEach(m,function(p,o,n){p=p["-1"];Y.push({dbRoleId:p.id,url:p.tables[0].url,name:H.htmlAngles(p.tables[0].name),type:E.localFile});});B.call(e,Y);});}}break;case V.pageType.sourceObjects:var a=mstrApp.getRootController();var Z=a.getModel();var h=Z.externalSources[V.sourceType.googleAnalytics];var l=h.getSourceInfoParam(true);var c=e.asDataPrepare();var f=e.sourceObjectsInfo.name;var k=U(l,c,f);G(k);mstrApp.getRootController().exitApplication();break;case V.pageType.sourceObjectsDnD:var a=mstrApp.getRootController();var Z=a.getModel();var j=e.sourceObjectsInfo;var c=e.asDataPrepare();var Y=[];var d="";switch(j.type){case V.sourceType.googleDrive:type=E.googleDrive;break;case V.sourceType.salesforce:type=E.salesForce;break;case V.sourceType.dropbox:type=E.dropBox;break;default:mstrmojo.alert("The source type match failed.");return ;}I.forEach(c,function(m,n){Y.push({dbRoleId:j.dbRoleID,url:m.query,type:d,accountId:j.said});});B.call(e,Y,j);break;default:this.rootView.currentPage.onFinishButtonClick();break;}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIRootView","mstrmojo.DI.DIExpressView","mstrmojo.DI.DIModel","mstrmojo.DI.DIRootController","mstrmojo.Editor","mstrmojo.DI.DIConstants","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.form","mstrmojo._IsWebApp","mstrmojo.AS.ASDIRootController");mstrmojo.requiresDescs(12537,12538);var d=mstrmojo.DI.DIConstants,b=mstrmojo.css,B=mstrmojo.dom,V=null,D=mstrmojo.DI.DIHelpers;var E="progressBar",X={scriptClass:"mstrmojo.Editor",id:E,showTitle:false,help:null,zIndex:99,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],onremoveChild:function(e){var g=e.value;for(var f=0;f<g.length;f++){g[f].destroy();}},postCreate:function(){this.counter=0;},updateProgress:function S(e){this.progress.updateProgress(e);},progressTextValue:function N(e){if(this.progress){this.progress.set("progressText",e);}},open:function I(f,e){if((++this.counter>0&&!this.visible)||e.manually){mstrmojo.Editor.prototype.open.call(this,f,e);}},close:function K(f){var e=this.counter=Math.max(0,this.counter-1);if((e<=0&&this.visible)||f.manually){if(!this.manually||f.manually){this.counter=0;this.manually=false;mstrmojo.Editor.prototype.close.call(this,f);this.updateProgress(0);}}}};mstrmojo.DI.DIApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{isDI:true,enableWaitBox:true,getWaitBoxPosition:function(){var e={};if(!D.getEnvObj().isAppSchema()){var k=mstrmojo.dom.position(this.rootController.rootView.headerNode,true);if(k&&k.h!==0&&k.y!==0){e.top=k.h+k.y;}}else{var h=mstrmojo.dom.position(this.rootController&&this.rootController.rootView&&this.rootController.rootView.headerNode),g=mstrmojo.dom.position(this.rootController&&this.rootController.rootView&&this.rootController.rootView.footerNode),f=h&&h.y!==0&&g&&g.h!==0&&g.y!==0,j=48;if(f){e.top=(g.h+g.y-h.y-j)/2;}}return e;},start:function C(){b.addClass(document.body,mstrApp.isSingleTier&&B.getOSInfo().name.toLowerCase().indexOf("mac")>-1?"mac":"none-mac");if(mstrApp.isWorkstation||mstrApp.isFromVI){b.addClass(document.body,"workstation");}else{if(!mstrApp.isSingleTier){this.addedWSClass=true;b.addClass(document.body,"workstation");}}var f;if(mstrApp.diParams.StatusCode===undefined||mstrApp.diParams.StatusCode===d.operationMode.edit||mstrApp.diParams.StatusCode===d.operationMode.create||mstrApp.diParams.StatusCode===d.statusCode.pickTable||mstrApp.diParams.StatusCode===d.statusCode.hadoopPickTable||mstrApp.diParams.StatusCode===d.statusCode.ffsql||mstrApp.diParams.StatusCode===d.statusCode.hadoopFFsql){f=mstrApp.isCloudPro?new mstrmojo.DI.DIExpressView({placeholder:this.placeholder}):new mstrmojo.DI.DIRootView({placeholder:this.placeholder,cssClass:"mojo-theme-light"});}else{f=new mstrmojo.Box({placeholder:this.placeholder});}var g={model:new mstrmojo.DI.DIModel({id:"DIModel"}),rootView:f,scriptClass:this.rootControllerCls||"mstrmojo.DI.DIRootController"};var e=this.rootController=mstrmojo.insert(g);this.addDisposable(e);e.start();V=this.beforeUnload.bind(e);B.attachEvent(window,"beforeunload",V);},destroy:function a(e){if(V){B.detachEvent(window,"beforeunload",V);V=null;}this._super(e);if(this.addedWSClass){b.removeClass(document.body,"workstation");}this.cleanUpDIStyles();},beforeUnload:function(e){var f=this;return f.beforeDIUnload(e);},restart:function R(e){var f=document.getElementById(this.rootController.rootView.id);var g=document.createElement("div");g.id=this.placeholder||"DIApp";mstrmojo.dom.replace(f,g);this.rootController.destroy();if(mstrmojo.all[E]){mstrmojo.all[E].destroy();}mstrmojo.hash.copy(e,this.diParams);this.start();},getRootController:function U(){return this.rootController;},applicationName:function H(){var f=d.application,e;if(this.diParams.CloudEdition===f.cloudProfessional){e=mstrmojo.desc(12538,"MicroStrategy Express");}else{if(this.diParams.CloudEdition===f.cloudPersonal){e=mstrmojo.desc(12538,"MicroStrategy Express");}else{e=mstrmojo.desc(12537,"Data Import");}}return e;},executeCommand:function W(e,f){this.serverProxy.cancelRequests();if(typeof this[e]==="function"){this[e](f);}else{this.getRootController().executeCommand(e,f);}},showProgress:function O(e){if(!e){e={message:mstrmojo.desc(5720,"Waiting...")};}if(e.showCancel===undefined){e.showCancel=false;}if(e.showProgressText&&e.progressText){e.message=e.progressText;}this.showWait(e);},hideProgress:function J(e){this.hideWait(e);},setProgressParams:function c(e,f){var g=mstrmojo.all[E];if(g){if(f&&f.showProgressText){g.progressTextValue(f.progressText);X.progressTextValue(f.progressText);}if(e){g.updateProgress(e);}}else{if(f&&f.showProgressText){X.progressTextValue(f.progressText);}if(e){X.updateProgress(e);}}},onFormWrapperClick:function A(){window.document.body.dispatchEvent(new Event("mousedown"));},serverResponse:function G(j,f,g,e,h){if(h===undefined){h={};}mstrmojo.all[j][f](g,!!e,h);},activeRequests:[],serverRequest:function P(j,k,e,f){var h={},g=this;if(e.hideFailureErr===undefined){h.hideFailureErr=true;}mstrmojo.hash.copy(e,h);h.silent=!e.showProgress;h.waitBoxCfg=f||{showCancel:false};h.waitBoxCfg.position=g.getWaitBoxPosition();if(e.showProgress&&e.showProgressText){h.waitBoxCfg.message=e.progressText;}this.activeRequests.push(j);k=mstrmojo.func.wrapMethods({complete:function(){g.activeRequests.splice(mstrmojo.array.indexOf(g.activeRequests,j),1);}},k,{});this._super(j,k,h);},serverRequestQueue:function Q(f,g,e){if(D.getEnvObj().isWS()){this.serverRequestParallelNative(f,g,e);}else{this.serverRequestParallel(f,g,e);}},serverRequestParallel:function F(f,g,e){window.setTimeout(this.serverProxy.serverRequestParallel.bind(this.serverProxy,f,g,e),0);},redirectToPage:function Z(e){this.showProgress();mstrmojo.form.send(e,mstrApp.name,"POST",null,null,false);},updateSessionState:function L(e){this._super(e);if(this.activeRequests){this.activeRequests.forEach(function(f){if(f.sessionState){f.sessionState=e;}});}},oneTierOAuthHandler:function Y(e){if(this.rootController.oAuthController){this.rootController.oAuthController.oneTierOAuthHandler(e);}},sdkConnectorOAuthHandler:function M(e){mstrApp.getRootController().model.raiseEvent({name:"getConnectorParameter",data:e});},cleanUpDIStyles:function(){var f,e;if(D.getEnvObj().isWeb()){f=document.querySelectorAll('link[rel=stylesheet][href*="/data-import"]');if(f.length>0){e=f[0];if(e.parentNode){e.parentNode.removeChild(e);if(window.microstrategy!==undefined&&microstrategy){var g=microstrategy.resourceLoader.buildURI("data-import.css","css",true);if(microstrategy.resourceLoader.status){delete microstrategy.resourceLoader.status[g];}}}}}}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIApp","mstrmojo._IsPopup","mstrmojo.Container","mstrmojo.hash","mstrmojo._IsMovable","mstrmojo.DI.WorkstationServerProxy","mstrmojo.DI.WorkstationServerTransport");var E=mstrmojo.css;function H(){this.dataImportParams={isNewAnalysis:true,isEdit:false,isCloudPro:false,isEmmaCube:true,isDirectDataAccess:false,isManagedCube:false,ReportId:undefined,CubeName:undefined,FolderId:undefined,CubeDesc:undefined,AnalysisId:undefined,StatusCode:0,CreateAnalysis:1,CreateReportServices:1,CreateViewReport:1,CubeQuota:200,Delete:1,EnableFTPImport:true,EnableFileImport:true,EnableHttpImport:true,EnableURLImport:true,ShowDDAOptions:true,ImportDatabase:1,AccessDataFromFiles:1,AccessDataFromCloudApp:1,Republish:1,Share:1,Subscriptions:1,UploadSizeLimit:100,datasets:null,hasNonRADataset:false,documentModel:null,missingCredentialsData:null,refreshMultipleCubes:false};}mstrmojo.DI.DIContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.DI.DIContainer",id:"DIContainer",cssClass:"mstrmojo-di-popup",markupString:'<div id="{@id}" class="{@cssClass}"><div id="DIApp"></div><div class="mstrmojo-DIEditor-curtain"></div></div>',markupSlots:{curtainNode:function(){return this.domNode.lastChild;}},draggable:true,launchingApp:null,dataImportParams:null,init:function(I){if(this._super){this._super(I);}H.call(this);},getMovingHandle:function G(){return this.rootView.headerNode;},onOpen:function B(){this.launchingApp=mstrApp;var I=this.dataImportParams;window.mstrApp=new mstrmojo.DI.DIApp();mstrmojo.hash.copy({placeholder:"DIApp",isEdit:I.isEdit,isNewAnalysis:I.isNewAnalysis,isCloudPro:I.isCloudPro,isEMMACube:I.isEmmaCube,isPopup:true,showDDAOptions:I.showDDAOptions,diParams:I,refreshMultipleCubes:I.refreshMultipleCubes,features:this.launchingApp.features,cubeSaveFolderId:I.cubeSaveFolderId,rootControllerCls:I.rootControllerCls},mstrApp);var J=["isSingleTier","isWorkstation","projectName","serverName","serverPort","authMode","sessionManager","servletState","enableWarningSessionTimeout","maxSessionIdleTime","timeBeforeSessionTimeoutWarning","name","sessionState","persistTaskParams","helpUrl","helpLocaleId","localeId","userHelpPage","autocomplete","isCloud","features","isWSStyling"];if(this.launchingApp.serverProxy){J.push("serverProxy");}mstrmojo.hash.copyProps(J,this.launchingApp,mstrApp);var K=this.launchingApp.getWSLiveMode?this.launchingApp.getWSLiveMode():false;if(K){mstrApp.isSingleTier=false;mstrApp.serverProxy=new mstrmojo.DI.WorkstationServerProxy({transport:mstrmojo.DI.WorkstationServerTransport});}mstrApp.launchingApp=this.launchingApp;mstrApp.isFromVI=this.launchingApp.isVI;mstrApp.container=this;this.curtainNode.style.zIndex=this.domNode.style.zIndex-1;this.domNode.style.display="block";this.curtainNode.style.display="block";mstrApp.start();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("disable");}this.docMouseDown=document.onmousedown;document.onmousedown=null;this.docMouseMove=document.onmousemove;document.onmousemove=null;this.docMouseUp=document.onmouseup;document.onmouseup=null;E.toggleClass(document.body,"user-select-none",true);},close:function F(){if(this._super){this._super();}var I=window.mstrApp;window.mstrApp=this.launchingApp;mstrApp.sessionState=I.sessionState;I.destroy();this.domNode.style.display="none";this.curtainNode.style.display="none";H.call(this);this.destroy();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("enable");}if(typeof (mstrApp.isWSStyling)!="undefined"&&!mstrApp.isVI){delete mstrApp.isWSStyling;}document.onmousedown=this.docMouseDown;document.onmousemove=this.docMouseMove;document.onmouseup=this.docMouseUp;E.toggleClass(document.body,"user-select-none",false);},preBuildRendering:function D(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},setPosition:function C(K,J){var I=this.domNode,L=I&&I.style;if(L){L.left=K;L.top=J;}},isDragValid:function A(I){var J=this.rootView.header.searchTable,K;K=this._super(I);if(K&&J.visible){K=!mstrmojo.dom.contains(J.domNode,I.src.node,true,this.getMovingHandle());}return K;}});}());