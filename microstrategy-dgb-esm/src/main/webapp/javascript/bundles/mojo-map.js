(function(){mstrmojo.gmaps.layer._LassoSelectHelper=mstrmojo.provide("mstrmojo.gmaps.layer._LassoSelectHelper",{_mixinName:"mstrmojo.gmaps.layer._LassoSelectHelper",handleLassoSelection:function A(H){var D=this.searchGraphicsContained(H),E,C,G=this.map,F=G&&G.parent;if(D&&D.length>0){for(E=0,C=D.length;E<C;E++){this.addToSelectedGraphics(D[E]);}G.displayVizBoxVisFilterIndicator(true,F);}},searchGraphicsContained:function B(F){var D=this._viewer,E=this.selectedGraphics||[],C;if(D){C=D.getGraphicsContained(F,E.length>0);if(C){D.highlightGraphics(E.concat(C));}return C;}}});}());mstrmojo.gmaps.MapLegendEnums={};mstrmojo.gmaps.LegendStyles={TITLE_HEIGHT:14,TITLE_MARGIN_HEIGHT:4,CONTENT_NAME_HEIGHT:14,CONTENT_NAME_ALTER_HEIGHT:28,CONTENT_NAME_MARGIN_HEIGHT:4,CONTENT_NAME_MARGIN_LEFT:17,CONTENT_DATA_LINE_HEIGHT:22,CONTENT_DATA_MARGIN_LEFT:13,CONTENT_DATA_COLOR_BLOCK_WIDTH:16,CONTENT_DATA_TEXT_MARGIN_LEFT:5,CONTENT_PADDING_HEIGHT:6,SECTION_DIVIDER_HEIGHT:1};mstrmojo.gmaps.LegendContainerStyles={TITLE_HEIGHT:18,PADDING_HEIGHT:2,PADDING_RIGHT:12};mstrmojo.gmaps.LegendSizeLimits={MAX_CON_WIDTH:300,MIN_TEXT_WIDTH:70};mstrmojo.gmaps.LegendDefaultFontStyles={FONT_SIZE:"11px",FONT_FAMILY:"Verdana"};mstrmojo.gmaps.LegendInteractiveType={LGD_COLOR_BLOCK_CON:"lcbc",LGD_COLOR_SVG_CON:"lcsc",LGD_COLOR_SVG_SHAPE:"lcss"};mstrmojo.gmaps.ShapeType={CIRCLE:1,PIN:2,RECT:3,DIAMOND:4,POLYGON:5};mstrmojo.gmaps.LEGEND_FORMAT_PROPERTY={COLOR_SQUARE_COLOR:"clrSqrClr"};(function(){mstrmojo.requiresCls("mstrmojo.dom");var F=mstrmojo.dom;function G(O,Q,N,R){var P=new XMLHttpRequest();P.onload=function(){if(this.status===200){var V=new Uint8Array(this.response);var U=V.length;var S=new Array(U);while(U--){S[U]=String.fromCharCode(V[U]);}var W=S.join("");var T=window.btoa(W);N.src="data:image/png;base64,"+T;N.origNode=O;O.parentNode.replaceChild(N,O);}if(R){R();}};P.onerror=P.onabort=P.ontimeout=function(){if(R){R();}};P.open("GET",Q,true);P.setRequestHeader("X-Requested-With","XMLHttpRequest");P.responseType="arraybuffer";P.send();}function I(R){var P=this.getRootDivForPDF().getElementsByTagName("img"),O=P.length,Q=0,S,N=function(){Q++;if(Q===O){if(R){R();}}};for(S=0;S<O;S++){var T=P[S];G(T,T.src,T.cloneNode(true),N);}}function M(N){if(N&&N[1]==="matrix"){return N[2].split(",").map(function(P){return parseFloat(P.trim());});}else{if(N&&N[1]==="matrix3d"){var O=N[2].split(",").map(function(P){return parseFloat(P.trim());});return[O[0],O[1],O[4],O[5],O[12],O[13]];}}}function K(P){var N=this.getCssTransform?this.getCssTransform():F.CSS3_TRANSFORM;function O(U){var S=mstrmojo.css.getStyleValue(U,N);var Q=S?M(S.match(/(matrix|matrix3d)\((.+)\)/)):null;var R=Q||[1,0,0,1,0,0];if(R.join(",")!=="1,0,0,1,0,0"){U.exportHack=mstrmojo.hash.copy({left:U.style.left,top:U.style.top,transform:S},U.exportHack);U.style.left=((parseInt(U.style.left,10)||0)+R[4])+"px";U.style.top=((parseInt(U.style.top,10)||0)+R[5])+"px";U.style[N]="none";}if(U.style.clip.match(/^rect\(auto,? auto,? auto,? auto\)$/)){U.exportHack=mstrmojo.hash.copy({clip:U.style.clip},U.exportHack);U.style.clip="auto";}if(U.children){for(var T=0;T<U.children.length;T++){O(U.children[T]);}}}O(P);}function A(P){var N=this.getCssTransform?this.getCssTransform():F.CSS3_TRANSFORM;function O(R){if(R.exportHack){if(R.exportHack.transform){R.style.left=R.exportHack.left;R.style.top=R.exportHack.top;R.style[N]=R.exportHack.transform;}if(R.exportHack.clip){R.style.clip=R.exportHack.clip;}delete R.exportHack;}if(R.children){for(var Q=0;Q<R.children.length;Q++){O(R.children[Q]);}}}O(P);}function H(){var N=this.getRootDivForPDF().getElementsByTagName("img"),O;for(O=0;O<N.length;O++){var P=N[O];if(P.origNode){P.parentNode.replaceChild(P.origNode,P);delete P.origNode;}}}function C(T){var N=new jsPDF("l","pt","letter"),R={top:25,bottom:60,left:60},Q={w:792-2*R.left,h:612-2*R.top};var P=Math.min(Q.w/T.width,Q.h/T.height),S={h:(Q.w-T.width*P)/2,v:(Q.h-T.height*P)/2},O=[T.toDataURL("image/png"),R.left+S.h,R.top+S.v,T.width*P,T.height*P,"JPEG",null,"SLOW"];N.addImage.apply(N,O);return N;}mstrmojo.gmaps._CanExportPDF=mstrmojo.provide("mstrmojo.gmaps._CanExportPDF",{isClientExport:true,getExtraNodeForPDF:function J(){return[];},getRootDivForPDF:function B(){return this.parent.domNode;},preExportHook:function E(N){if(N){N();}},postExportHook:mstrmojo.emptyFn,hideMapTools:mstrmojo.emptyFn,showMapTools:mstrmojo.emptyFn,replaceImage:G,replaceMapTiles:I,substituteStyles:K,reviveStyles:A,reviveImages:H,exportVisualization:function D(P){if(P!=3){return ;}if(mstrApp.isSingleTier){var Q=this;var N=this.toolbar.domNode.style.display;this.hideMapTools();this.toolbar.domNode.style.display="none";setTimeout(function(){var S=Q.getRootDivForPDF().getBoundingClientRect();var U=window.FormWrapper.getScreenCapture();U="data:image/png;base64,".concat(U);Q.toolbar.domNode.style.display=N;Q.showMapTools();mstrApp.showWait({showCancel:true});if(mstrmojo.all.waitBox){var R=mstrmojo.all.waitBox.cancelBtn.onclick;mstrmojo.all.waitBox.cancelBtn.onclick=function(){mstrApp.hideWait();mstrmojo.all.waitBox.cancelBtn.onclick=R;};}var T=new Image();T.onload=function(){var Y=document.createElement("canvas");Y.width=S.width;Y.height=S.height;var W=Y.getContext("2d");var Z;try{Z=(T.width/document.body.getBoundingClientRect().width)||1;}catch(a){Z=1;}W.drawImage(T,S.left*Z,(S.top-30)*Z,S.width*Z,S.height*Z,0,0,S.width,S.height);var V=C(Y);window.FormWrapper.saveToLocalDisk(btoa(V.output()),".pdf",Q.parent.title||"visualization");mstrApp.hideWait();};T.src=U;},100);}else{mstrApp.showWait({showCancel:true});if(mstrmojo.all.waitBox){var O=mstrmojo.all.waitBox.cancelBtn.onclick;mstrmojo.all.waitBox.cancelBtn.onclick=function(){mstrApp.hideWait();mstrmojo.all.waitBox.cancelBtn.onclick=O;};}if(!window.jsPDF||!window.html2canvas||!window.canvg){this.loadScripts();}else{this.renderVis();}}},loadScripts:function(){var O=[];O.push({url:"../javascript/libraries/html2canvas.js"});O.push({url:"../javascript/libraries/html2canvas.svg.js"});O.push({url:"../javascript/libraries/jspdf.js"});O.push({url:"../javascript/libraries/canvg/rgbcolor.js"});O.push({url:"../javascript/libraries/canvg/StackBlur.js"});O.push({url:"../javascript/libraries/canvg/canvg.js"});var N=this;N.requiresExternalScripts(O,function(){N.renderVis();});},renderVis:function(){var Q=this,P={useCORS:true,pagesplit:true,logging:false},N=this.toolbar.domNode.style.display;this.toolbar.domNode.style.display="none";this.hideMapTools();function O(X){var T=C(X);var V=true,U="dataurlnewwindow",S=(Q.parent.title||"visualization")+".pdf";if(V){U="save";}else{var R=2097152,W=T.output("dataurlstring");if(W.length*2>R){U="save";}}T.output(U,S);mstrApp.hideWait();Q.toolbar.domNode.style.display=N;Q.showMapTools();if(Q.postExportHook){Q.postExportHook();}}P.onrendered=function(V){var S=0,R=Q.getExtraNodeForPDF();if(R.length>0){var T=function(W){canvg(V,R[W].outerHTML,{ignoreClear:true,ignoreDimensions:true,renderCallback:function(){S++;if(S>=R.length){O(V);}else{T(W+1);}}});};try{T(0);}catch(U){O(V);}}else{O(V);}};if(this.preExportHook){this.preExportHook(function(){html2canvas(Q.getRootDivForPDF(),P);});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.PerformanceLogOutput");var M=false,V=null,J=null,C=null,F=null,X=null,Q="quarterly",K=mstrmojo.PerformanceLogOutput;mstrmojo.gmaps.basemap._CanLoadGoogleMapScript=mstrmojo.provide("mstrmojo.gmaps.basemap._CanLoadGoogleMapScript",{_mixinName:"mstrmojo.gmaps.basemap._CanLoadGoogleMapScript",callback:null,setPremiere:function R(Y){M=Y;},isPremiere:function B(){return M;},setPremiereKey:function A(Y){V=Y;},getPremiereKey:function S(){return V;},setTrialKey:function I(Y){F=Y;},getTrialKey:function D(){return F;},setLocaleLang:function P(Y){J=Y;},getLocaleLang:function H(){return J;},setLocaleRegion:function U(Y){C=Y;},getLocaleRegion:function W(){return C;},setChannel:function T(Y){X=Y;},getChannel:function G(){return X;},loadExternalScript:function O(a){K.visPrint("Load Google Map modules start");timerid_loadExternalScript=K.startTimer({functionName:"_CanLoadGoogleMapScript.loadExternalScript: ",purpose:"load Google external script"});var Y,Z=this.getChannel();if(window.location.protocol==="https:"){Y="https://maps-api-ssl.google.com/maps/api/js?v="+Q+"&libraries=drawing,geometry";}else{Y="http://maps.google.com/maps/api/js?v="+Q+"&libraries=drawing,geometry";}Y+="&language="+this.getLocaleLang()+"&region="+this.getLocaleRegion();if(this.isPremiere()){Y=Y+"&client="+this.getPremiereKey();}else{Y=Y+"&key="+this.getTrialKey();}if(!!Z){Y+="&channel="+Z;}this.callback=a;mstrmojo._LoadsScript.requiresExternalScripts([{url:Y,callbackParamName:"callback",forceReload:true,onError:{callback:this.loadMap,params:mstrmojo.gmaps}}],this.loadMainModule,this);},loadMainModule:function N(){var Z=this,Y;mstrmojo.googleMapLibLoaded=true;if(mstrmojo._LoadsScript.esScritsContext===this){mstrmojo._LoadsScript.esScritsContext=null;}K.endTimer("timerid_callback_LoadMainModule");K.endTimer(timerid_loadExternalScript);K.visPrint("load Google external script end");Y=window.setInterval(function(){window.clearInterval(Y);Z.loadMap(mstrmojo.gmaps);},50);},loadCoreCss:function E(){var b=document.styleSheets;if(b){var Z,a;for(Z=0;Z<b.length;Z++){a=b[Z];if(a.id==="mojocore"){return ;}}}var Y=document.createElement("link");Y.setAttribute("rel","stylesheet");Y.setAttribute("type","text/css");Y.setAttribute("href",mstrmojo.getJsRoot()+"mojo/css/core.css"+((window.mstrConfig&&mstrConfig.webVersion)?"?v="+mstrConfig.webVersion:""));Y.setAttribute("id","mojocore");document.getElementsByTagName("head")[0].appendChild(Y);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var Z=mstrmojo,P=Z.array;mstrmojo._CanDrawHeatMap=mstrmojo.provide("mstrmojo._CanDrawHeatMap",{_mixinName:"mstrmojo._CanDrawHeatMap",callback:null,canvas:null,latlngArr:null,originalzIndex:1,themeId:null,themeLoaded:false,themeData:null,bounds:null,xOffset:0,yOffset:0,radius:10,locationMap:null,presetThemeData:[[4,5,88,0,3,4,91,0,2,4,96,0,1,5,100,0,1,6,105,0,1,6,105,0,1,8,109,0,0,9,114,0,0,12,119,0,0,15,125,0,0,15,125,0,0,18,130,0,0,21,135,0,0,25,141,0,0,29,146,0,0,29,146,0,0,34,151,0,0,39,156,0,0,45,161,0,0,51,166,0,0,51,166,0,0,57,170,0,0,64,174,0,0,70,179,0,0,77,183,0,0,85,188,0,0,85,188,0,0,92,192,0,0,98,195,0,0,106,199,0,0,111,203,0,0,111,203,0,0,116,205,0,0,121,208,0,0,129,213,0,0,138,218,0,0,138,218,0,0,146,222,0,0,155,228,0,0,163,232,0,0,172,236,0,0,172,236,0,0,179,240,0,0,187,244,0,0,194,247,0,0,202,250,0,0,208,252,0,0,208,252,0,0,214,254,0,0,219,255,0,0,224,255,0,0,228,255,0,0,228,255,0,0,232,255,0,0,234,255,0,0,234,254,0,0,234,251,0,0,234,251,0,0,234,248,0,0,234,246,0,0,234,242,0,0,234,238,0,0,234,238,0,0,234,234,0,0,234,230,0,0,234,225,0,0,234,220,0,0,234,214,0,0,234,214,0,0,233,209,0,0,231,203,0,0,229,196,0,0,227,189,0,0,227,189,0,0,224,183,0,0,222,177,0,0,219,170,0,0,216,164,0,0,216,164,0,0,215,159,0,0,213,155,0,0,211,150,0,0,209,146,0,0,209,146,0,0,207,142,0,0,205,137,0,0,203,133,0,0,201,128,0,0,200,124,0,0,200,124,0,0,197,119,0,0,195,115,0,0,193,111,0,0,192,107,0,0,192,107,0,0,190,103,0,0,189,98,0,0,187,94,0,0,186,91,0,0,186,91,0,0,185,87,0,0,183,83,0,0,183,79,0,0,182,76,0,0,182,76,0,0,181,73,0,0,181,69,0,0,180,67,0,0,179,64,0,0,179,61,0,0,179,61,0,0,179,59,0,1,179,56,0,3,179,54,0,6,180,52,0,6,180,52,0,9,180,50,0,12,181,47,0,15,182,45,0,19,183,43,0,19,183,43,0,22,184,42,0,26,186,39,0,30,187,38,0,35,189,36,0,35,189,36,0,39,190,34,0,44,193,33,0,49,195,32,0,54,197,30,0,59,200,29,0,59,200,29,0,65,202,27,0,70,204,25,0,75,207,24,0,81,209,23,0,81,209,23,0,87,211,22,0,92,214,21,0,98,216,20,0,104,218,19,0,104,218,19,0,109,221,19,0,115,223,18,0,121,226,17,0,127,228,16,0,127,228,16,0,133,231,15,0,139,233,14,0,145,236,14,0,150,238,13,0,157,240,12,0,157,240,12,0,163,242,11,0,168,244,11,0,173,246,10,0,179,247,9,0,179,247,9,0,184,249,9,0,190,251,8,0,196,252,8,0,201,252,7,0,201,252,7,0,206,252,7,0,211,252,6,0,216,252,5,0,220,252,5,0,220,252,5,0,225,252,4,0,229,252,4,0,233,252,3,0,237,252,3,0,241,252,3,0,241,252,3,0,244,252,2,0,248,252,2,0,250,252,1,0,253,252,0,0,253,252,0,0,255,251,0,0,255,250,0,0,255,247,0,0,255,245,0,0,255,245,0,0,255,242,0,0,255,238,0,0,255,235,0,0,255,232,0,0,255,232,0,0,255,227,0,0,255,222,0,0,255,218,0,0,255,213,0,0,255,208,0,0,255,208,0,0,255,203,0,0,255,197,0,0,255,191,0,0,255,186,0,0,255,186,0,0,255,180,0,0,255,174,0,0,255,168,0,0,255,162,0,0,255,162,0,0,255,155,0,0,255,149,0,0,255,143,0,0,255,136,0,0,255,136,0,0,255,130,0,0,255,123,0,0,255,117,0,0,255,110,0,0,255,104,0,0,255,104,0,0,255,98,0,0,255,92,0,0,255,85,0,0,255,80,0,0,255,80,0,0,255,73,0,0,255,67,0,0,255,61,0,0,255,56,0,0,255,56,0,0,255,50,0,0,255,44,0,0,255,40,0,0,255,35,0,0,255,35,0,0,255,30,0,0,255,25,0,0,255,21,0,0,255,18,0,0,255,14,0,0,255,14,0,0,255,10,0,0,255,6,0,0,255,4,0,0,255,1,0,0,255,1,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255,1,1,0,255,1,1,0,255,2,2,0,255,2,2,0],[159,159,159,0,158,158,158,0,157,157,157,0,156,156,156,0,155,155,155,0,155,155,155,0,154,154,154,0,153,153,153,0,152,152,152,0,151,151,151,0,151,151,151,0,150,150,150,0,149,149,149,0,148,148,148,0,147,147,147,0,147,147,147,0,146,146,146,0,144,144,144,0,143,143,143,0,142,142,142,0,142,142,142,0,141,141,141,0,140,140,140,0,139,139,139,0,138,138,138,0,137,137,137,0,137,137,137,0,135,135,135,0,134,134,134,0,133,133,133,0,132,132,132,0,132,132,132,0,131,131,131,0,131,130,130,0,130,128,128,0,129,127,127,0,129,127,127,0,130,126,126,0,130,125,125,0,129,123,123,0,129,122,122,0,129,122,122,0,129,121,121,0,129,120,120,0,128,118,118,0,129,117,117,0,129,116,116,0,129,116,116,0,129,115,115,0,129,113,113,0,129,112,112,0,130,111,111,0,130,111,111,0,131,110,110,0,130,108,108,0,131,107,107,0,132,106,106,0,132,106,106,0,132,104,104,0,133,103,103,0,134,102,102,0,134,100,100,0,134,100,100,0,135,99,99,0,137,98,98,0,138,97,97,0,139,95,95,0,140,94,94,0,140,94,94,0,141,93,93,0,141,91,91,0,143,90,90,0,145,89,89,0,145,89,89,0,146,88,88,0,148,87,87,0,149,86,86,0,152,86,86,0,152,86,86,0,153,85,85,0,155,84,84,0,157,84,84,0,159,83,83,0,159,83,83,0,161,82,82,0,164,82,82,0,165,81,81,0,168,81,81,0,169,80,80,0,169,80,80,0,172,79,79,0,174,79,79,0,176,78,78,0,178,77,77,0,178,77,77,0,180,77,77,0,182,76,76,0,185,75,75,0,187,75,75,0,187,75,75,0,189,74,74,0,191,73,73,0,193,73,73,0,195,72,72,0,195,72,72,0,199,72,72,0,200,71,71,0,203,70,70,0,205,70,70,0,207,69,69,0,207,69,69,0,209,68,68,0,211,68,68,0,213,67,67,0,216,66,66,0,216,66,66,0,218,66,66,0,219,65,65,0,222,65,65,0,224,64,64,0,224,64,64,0,226,63,63,0,228,63,63,0,229,62,62,0,232,61,61,0,232,61,61,0,234,61,61,0,235,60,60,0,238,60,60,0,239,59,59,0,240,58,58,0,240,58,58,0,242,58,58,0,244,57,57,0,246,56,56,0,247,56,56,0,247,56,56,0,248,55,55,0,250,55,55,0,251,54,54,0,253,53,53,0,253,53,53,0,253,53,53,0,255,52,52,0,255,54,52,0,255,54,51,0,255,54,51,0,255,56,50,0,255,58,50,0,255,59,49,0,255,62,49,0,255,64,48,0,255,64,48,0,255,66,47,0,255,69,47,0,255,71,46,0,255,75,46,0,255,75,46,0,255,78,45,0,255,80,44,0,255,84,44,0,255,88,43,0,255,88,43,0,255,91,43,0,255,94,42,0,255,98,41,0,255,102,41,0,255,102,41,0,255,106,40,0,255,110,40,0,255,114,39,0,255,118,39,0,255,123,38,0,255,123,38,0,255,127,38,0,255,131,37,0,255,135,36,0,255,140,36,0,255,140,36,0,255,144,35,0,255,149,35,0,255,153,34,0,255,158,34,0,255,158,34,0,255,162,33,0,255,167,33,0,255,171,32,0,255,175,31,0,255,175,31,0,255,181,31,0,255,185,30,0,255,189,30,0,255,193,29,0,255,199,29,0,255,199,29,0,255,203,28,0,255,207,28,0,255,210,27,0,255,215,27,0,255,215,27,0,255,218,26,0,255,222,26,0,255,226,25,0,255,229,25,0,255,229,25,0,255,232,24,0,255,236,24,0,255,239,23,0,255,242,23,0,255,242,23,0,255,245,22,0,255,247,22,0,255,250,21,0,255,251,21,0,255,254,22,0,255,254,22,0,255,255,24,0,255,255,25,0,255,255,28,0,255,255,30,0,255,255,30,0,255,255,33,0,255,255,37,0,255,255,38,0,255,255,42,0,255,255,42,0,255,255,45,0,255,255,49,0,255,255,52,0,255,255,56,0,255,255,56,0,255,255,60,0,255,255,64,0,255,255,69,0,255,255,73,0,255,255,77,0,255,255,77,0,255,255,81,0,255,255,86,0,255,255,90,0,255,255,96,0,255,255,96,0,255,255,101,0,255,255,105,0,255,255,110,0,255,255,115,0,255,255,115,0,255,255,120,0,255,255,125,0,255,255,131,0,255,255,135,0,255,255,135,0,255,255,141,0,255,255,146,0,255,255,151,0,255,255,156,0],[243,127,22,0,243,126,22,0,242,126,22,0,241,125,22,0,241,125,22,0,241,125,22,0,240,124,22,0,240,124,22,0,239,123,22,0,239,123,22,0,239,123,22,0,238,122,22,0,237,121,22,0,237,121,22,0,236,120,21,0,236,120,21,0,235,120,21,0,234,119,21,0,234,119,21,0,233,118,21,0,233,118,21,0,232,118,21,0,231,117,21,0,231,116,21,0,230,116,21,0,229,115,21,0,229,115,21,0,229,115,21,0,228,114,21,0,227,113,20,0,227,113,20,0,227,113,20,0,226,112,20,0,225,112,20,0,224,111,20,0,223,110,20,0,223,110,20,0,222,110,20,0,222,109,20,0,221,108,20,0,220,108,20,0,220,108,20,0,219,107,19,0,218,106,19,0,217,106,19,0,216,105,19,0,215,104,19,0,215,104,19,0,215,104,19,0,214,103,19,0,214,102,19,0,213,102,19,0,213,102,19,0,212,101,19,0,211,99,19,0,210,99,19,0,209,99,19,0,209,99,19,0,208,98,19,0,207,98,19,0,206,97,19,0,205,96,19,0,205,96,19,0,204,95,19,0,204,95,19,0,203,93,18,0,202,92,18,0,201,92,18,0,201,92,18,0,200,91,18,0,199,90,18,0,197,89,18,0,196,89,18,0,196,89,18,0,195,89,18,0,195,88,18,0,193,86,18,0,192,86,18,0,192,86,18,0,191,85,19,0,191,84,19,0,190,83,19,0,189,82,19,0,189,82,19,0,188,82,20,0,187,81,20,0,186,80,20,0,185,79,21,0,183,78,21,0,183,78,21,0,182,77,22,0,181,76,22,0,180,75,22,0,179,74,23,0,179,74,23,0,178,73,23,0,177,72,24,0,175,70,24,0,174,70,25,0,174,70,25,0,173,69,25,0,172,68,26,0,171,67,27,0,169,66,28,0,169,66,28,0,168,65,28,0,167,64,29,0,166,62,29,0,164,61,30,0,163,60,31,0,163,60,31,0,162,59,32,0,161,58,32,0,159,57,33,0,159,56,34,0,159,56,34,0,158,56,35,0,156,54,35,0,154,52,36,0,153,51,37,0,153,51,37,0,152,50,37,0,151,49,38,0,150,48,39,0,149,47,40,0,149,47,40,0,148,46,40,0,145,44,41,0,144,43,41,0,143,42,42,0,142,41,43,0,142,41,43,0,141,41,44,0,140,40,45,0,139,39,45,0,137,38,46,0,137,38,46,0,136,37,47,0,134,35,47,0,133,34,48,0,132,33,49,0,132,33,49,0,131,32,50,0,130,31,51,0,129,30,52,0,127,29,53,0,127,29,53,0,126,28,53,0,124,26,53,0,123,25,54,0,121,24,55,0,120,23,56,0,120,23,56,0,119,22,57,0,119,21,57,0,118,21,58,0,117,21,59,0,117,21,59,0,114,19,59,0,113,19,60,0,112,18,60,0,111,18,61,0,111,18,61,0,110,17,62,0,109,16,63,0,108,16,63,0,107,15,64,0,107,15,64,0,106,14,65,0,105,13,65,0,104,12,65,0,103,11,66,0,102,11,66,0,102,11,66,0,101,10,67,0,100,10,68,0,99,9,68,0,98,9,69,0,98,9,69,0,96,7,68,0,95,7,69,0,95,7,69,0,94,7,70,0,94,7,70,0,93,7,70,0,93,7,71,0,92,7,71,0,91,7,72,0,91,7,72,0,90,7,72,0,88,6,72,0,87,6,72,0,87,6,73,0,86,6,73,0,86,6,73,0,85,6,74,0,84,6,74,0,83,6,75,0,82,6,75,0,82,6,75,0,82,6,75,0,80,5,76,0,79,5,76,0,79,5,77,0,79,5,77,0,79,5,77,0,78,5,77,0,77,5,78,0,76,5,78,0,76,5,78,0,76,5,78,0,75,5,79,0,74,5,79,0,72,4,78,0,72,4,79,0,72,4,79,0,71,4,79,0,70,4,79,0,70,4,80,0,69,4,80,0,69,4,80,0,68,4,80,0,68,4,81,0,67,4,81,0,66,4,81,0,66,4,81,0,65,3,81,0,64,3,81,0,63,3,81,0,63,3,81,0,63,3,81,0,62,3,82,0,62,3,82,0,61,3,82,0,60,4,82,0,60,4,83,0,60,4,83,0,59,4,83,0,59,4,83,0,58,5,83,0,58,4,83,0,58,4,83,0,57,4,83,0,56,5,83,0,56,5,83,0,55,5,84,0,55,5,84,0,55,5,84,0,54,6,84,0,54,6,84,0,53,6,84,0,53,6,84,0,53,7,85,0,52,7,85,0,52,7,85,0,50,6,85,0],[57,62,47,0,58,63,47,0,58,64,47,0,58,64,46,0,59,65,46,0,59,65,46,0,60,66,46,0,61,66,46,0,62,67,46,0,63,68,46,0,63,68,46,0,63,68,45,0,64,70,45,0,65,70,45,0,66,71,45,0,66,71,45,0,67,72,45,0,68,73,45,0,69,73,44,0,70,74,44,0,70,74,44,0,70,74,44,0,72,75,44,0,73,77,44,0,74,77,43,0,74,78,43,0,74,78,43,0,76,79,43,0,77,79,43,0,79,81,43,0,79,81,42,0,79,81,42,0,80,82,42,0,82,83,42,0,83,84,42,0,84,85,42,0,84,85,42,0,85,85,41,0,86,86,41,0,88,88,41,0,89,89,41,0,89,89,41,0,91,89,41,0,91,90,40,0,93,91,40,0,95,92,40,0,96,93,40,0,96,93,40,0,98,95,40,0,98,95,39,0,100,95,39,0,101,97,39,0,101,97,39,0,103,98,39,0,105,99,39,0,106,100,38,0,107,101,38,0,107,101,38,0,109,102,38,0,111,103,38,0,112,103,37,0,114,104,37,0,114,104,37,0,115,106,37,0,117,107,37,0,119,108,37,0,120,109,36,0,121,110,36,0,121,110,36,0,123,111,36,0,125,112,36,0,126,112,35,0,128,114,35,0,128,114,35,0,129,115,35,0,131,116,35,0,133,117,35,0,134,118,34,0,134,118,34,0,136,119,34,0,138,120,34,0,139,121,34,0,140,122,33,0,140,122,33,0,142,123,33,0,144,125,33,0,146,126,33,0,147,126,32,0,149,128,32,0,149,128,32,0,150,129,32,0,152,130,32,0,153,131,31,0,156,132,31,0,156,132,31,0,158,133,31,0,160,134,31,0,161,135,30,0,163,136,30,0,163,136,30,0,164,137,30,0,166,138,30,0,168,139,29,0,169,140,29,0,169,140,29,0,171,141,29,0,173,143,29,0,174,143,28,0,176,145,28,0,178,146,28,0,178,146,28,0,180,147,28,0,181,148,27,0,183,149,27,0,185,150,27,0,185,150,27,0,186,151,27,0,188,152,26,0,189,153,26,0,191,154,26,0,191,154,26,0,192,156,26,0,194,156,25,0,196,157,25,0,197,158,25,0,197,158,25,0,200,160,25,0,202,160,24,0,203,161,25,0,204,162,25,0,206,164,25,0,206,164,25,0,208,165,25,0,209,165,24,0,211,166,24,0,212,168,25,0,212,168,25,0,214,169,25,0,215,169,24,0,217,170,24,0,219,171,25,0,219,171,25,0,220,172,25,0,221,174,24,0,222,175,24,0,224,175,25,0,224,175,25,0,226,176,25,0,227,177,24,0,228,178,24,0,229,179,25,0,230,180,25,0,230,180,25,0,232,180,24,0,233,181,24,0,235,182,25,0,236,183,25,0,236,183,25,0,236,184,24,0,238,185,24,0,239,186,24,0,240,186,24,0,240,186,24,0,241,187,24,0,243,188,24,0,244,189,25,0,245,190,25,0,245,190,25,0,246,191,24,0,247,191,25,0,248,192,25,0,248,193,25,0,249,194,25,0,249,194,25,0,250,194,25,0,251,195,26,0,252,196,26,0,253,197,26,0,253,197,26,0,254,199,26,0,254,199,27,0,255,199,27,0,255,201,28,0,255,201,28,0,255,202,28,0,255,204,29,0,255,205,31,0,255,206,32,0,255,206,32,0,255,208,32,0,255,208,33,0,255,209,35,0,255,211,36,0,255,212,38,0,255,212,38,0,255,213,38,0,255,214,40,0,255,215,41,0,255,216,42,0,255,216,42,0,255,218,43,0,255,219,45,0,255,220,46,0,255,221,48,0,255,221,48,0,255,222,50,0,255,222,51,0,255,223,53,0,255,224,55,0,255,224,55,0,255,225,57,0,255,225,59,0,255,226,60,0,255,227,62,0,255,228,64,0,255,228,64,0,255,229,66,0,255,230,68,0,255,230,69,0,255,231,71,0,255,231,71,0,255,232,73,0,255,233,76,0,255,233,78,0,255,234,79,0,255,234,79,0,255,235,81,0,255,235,83,0,255,236,86,0,255,237,88,0,255,237,88,0,255,236,89,0,255,237,91,0,255,237,94,0,255,238,96,0,255,238,98,0,255,238,98,0,255,239,99,0,255,239,101,0,255,240,104,0,255,240,106,0,255,240,106,0,255,241,108,0,255,241,110,0,255,242,111,0,255,242,113,0,255,242,113,0,255,243,116,0,255,243,118,0,255,244,120,0,255,244,122,0,255,244,122,0,255,245,124,0,255,245,126,0,255,245,128,0,255,246,129,0],[223,145,187,0,223,143,184,0,223,142,182,0,224,141,180,0,225,139,177,0,225,139,177,0,226,138,175,0,227,137,172,0,227,135,169,0,228,134,167,0,228,134,167,0,229,132,164,0,230,131,161,0,230,129,158,0,232,128,156,0,232,128,156,0,232,126,153,0,233,125,150,0,234,123,147,0,235,122,144,0,235,122,144,0,236,120,141,0,237,119,139,0,238,117,135,0,239,116,133,0,240,114,129,0,240,114,129,0,241,112,126,0,242,111,124,0,243,109,121,0,244,108,118,0,244,108,118,0,245,106,115,0,246,104,112,0,247,103,110,0,248,101,107,0,248,101,107,0,249,99,104,0,249,98,102,0,251,96,99,0,251,95,97,0,251,95,97,0,252,93,95,0,253,91,92,0,254,90,91,0,254,88,88,0,255,86,86,0,255,86,86,0,255,85,84,0,255,85,84,0,255,84,83,0,255,84,83,0,255,84,83,0,255,84,82,0,255,84,82,0,255,84,81,0,255,84,81,0,255,84,81,0,255,83,80,0,255,82,79,0,255,83,79,0,255,82,78,0,255,82,78,0,255,83,78,0,255,83,77,0,255,83,78,0,255,82,77,0,255,83,77,0,255,83,77,0,255,82,76,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,75,0,255,82,74,0,255,82,74,0,255,82,74,0,255,82,74,0,255,82,74,0,255,83,74,0,255,82,74,0,255,82,74,0,255,82,73,0,255,82,73,0,255,83,74,0,255,83,74,0,255,84,74,0,255,83,74,0,255,83,74,0,255,83,74,0,255,83,74,0,255,83,74,0,255,84,75,0,255,84,75,0,255,84,74,0,255,84,75,0,255,84,74,0,255,84,75,0,255,84,75,0,255,84,75,0,255,85,76,0,255,85,76,0,255,86,76,0,255,86,76,0,255,86,76,0,255,86,77,0,255,86,77,0,255,86,77,0,255,87,78,0,255,87,78,0,255,87,78,0,255,88,78,0,255,88,78,0,255,88,79,0,255,88,79,0,255,88,79,0,255,88,81,0,255,88,80,0,255,89,81,0,255,89,81,0,255,89,81,0,255,90,82,0,255,90,82,0,255,91,83,0,255,91,84,0,255,91,84,0,255,92,84,0,255,92,84,0,255,92,85,0,255,93,85,0,255,93,85,0,255,94,87,0,255,94,87,0,255,95,88,0,255,95,88,0,255,95,88,0,255,96,88,0,255,96,89,0,255,97,90,0,255,97,90,0,255,97,90,0,255,98,91,0,255,98,92,0,255,99,93,0,255,99,93,0,255,100,95,0,255,100,95,0,255,100,95,0,255,101,95,0,255,101,96,0,255,102,97,0,255,102,97,0,255,102,97,0,255,103,98,0,255,103,98,0,255,104,100,0,255,104,100,0,255,105,100,0,255,105,101,0,255,106,101,0,255,106,103,0,255,106,103,0,255,107,103,0,255,108,104,0,255,108,104,0,255,109,106,0,255,109,106,0,255,109,106,0,255,110,107,0,255,110,107,0,255,111,109,0,255,112,110,0,255,112,110,0,255,112,110,0,255,113,111,0,255,113,112,0,255,114,113,0,255,114,113,0,255,114,113,0,255,116,114,0,255,116,115,0,255,117,115,0,255,117,115,0,255,118,117,0,255,118,117,0,255,119,118,0,255,120,119,0,255,121,120,0,255,121,120,0,255,121,120,0,255,122,121,0,255,122,121,0,255,123,123,0,255,123,123,0,255,124,124,0,255,124,124,0,255,125,125,0,255,126,126,0,255,126,126,0,255,126,126,0,255,127,127,0,255,128,128,0,255,130,130,0,255,130,130,0,255,131,131,0,255,133,133,0,255,135,135,0,255,136,136,0,255,138,138,0,255,138,138,0,255,140,140,0,255,142,142,0,255,144,144,0,255,146,146,0,255,146,146,0,255,148,148,0,255,150,150,0,255,152,152,0,255,154,154,0,255,154,154,0,255,157,157,0,255,159,159,0,255,161,161,0,255,163,163,0,255,163,163,0,255,166,166,0,255,168,168,0,255,170,170,0,255,172,172,0,255,175,175,0,255,175,175,0,255,177,177,0,255,179,179,0,255,182,182,0,255,184,184,0,255,184,184,0,255,187,187,0,255,188,188,0,255,191,191,0,255,193,193,0,255,193,193,0,255,196,196,0,255,199,199,0,255,202,202,0,255,204,204,0,255,204,204,0,255,206,206,0,255,208,208,0,255,210,210,0,255,213,213,0]],drawDensity:function O(){if(!this.hasMapBoundsChanged()){return ;}this.clearDensity();this.cleanLocationMap();this.createDensity();},getThemeUrl:function Y(){var e;switch(this.themeId){case 5:e=Z.getStyleRoot()+"/images/heatmap5.png";break;case 4:e=Z.getStyleRoot()+"/images/heatmap4.png";break;case 3:e=Z.getStyleRoot()+"/images/heatmap3.png";break;case 2:e=Z.getStyleRoot()+"/images/heatmap2.png";break;default:e=Z.getStyleRoot()+"/images/heatmap1.png";}return e;},getThemeFromPreset:function b(){switch(this.themeId){case 5:this.themeData=this.presetThemeData[4];break;case 4:this.themeData=this.presetThemeData[3];break;case 3:this.themeData=this.presetThemeData[2];break;case 2:this.themeData=this.presetThemeData[1];break;default:this.themeData=this.presetThemeData[0];}},createThemeColourGradient:function R(f){if(f){var g=this,e=new Image();e.onload=function(){g.drawTheme(this);e.onload=null;};e.src=f;}return null;},dumpThemeColor:function V(){var f=""+this.themeId+":";if(this.themeData){var e=this.themeData.length;for(var g=0;g<e;g++){f+=this.themeData[g];if(g!=e-1){f+=",";}}}console.log(f);},drawTheme:function A(j){var h=document.createElement("canvas");var g=h.getContext("2d");h.width=j.width;h.height=j.height;g.drawImage(j,0,0,j.width,j.height);var k=g.getImageData(0,3,j.width,1).data;var e=g.getImageData(0,0,256,1).data,i;for(i=0;i<e.length;){var f=Math.floor(j.width*(0.1+0.8*i/1020))*4;e[i]=k[f];e[i+1]=k[f+1];e[i+2]=k[f+2];i+=4;}this.themeData=e;this.dumpThemeColor();this.cleanLocationMap();this.createDensity();},createColourGradient:function J(){if(!this.themeData){this.getThemeFromPreset();}return this.themeData;},createDefaultColourGradient:function Q(){var f=document.createElement("canvas").getContext("2d");var e=f.createLinearGradient(0,0,256,0);e.addColorStop(0,"magenta");e.addColorStop(0.25,"blue");e.addColorStop(0.5,"green");e.addColorStop(0.75,"yellow");e.addColorStop(1,"red");f.fillStyle=e;f.fillRect(0,0,256,1);return f.getImageData(0,0,256,1).data;},clearDensity:function D(){var e=this.canvas,f=e&&e.getContext("2d");if(f){f.clearRect(0,0,e.width,e.height);}},zeroLayer:function C(e){this.div_.style.left=Math.floor(e.x)+"px";this.div_.style.top=Math.floor(e.y)+"px";},cleanLocationMap:function S(){this.locationMap={};},addToLocationMap:function N(f,h,g){var e=Math.ceil(h);var i=Math.ceil(g);if(!this.locationMap[e]){this.locationMap[e]={};}if(!this.locationMap[e][i]){this.locationMap[e][i]=[];}this.locationMap[e][i].push(f);},createDensity:function c(){var e=this.canvas,f=this._initContextWithGradient(this.graphics);if(f){this._putGradientColourToContext(f);f.fillRect(0,0,e.width,e.height);}},_initContextWithGradient:function T(g){if(!g||g.length<1||!this.canvas){return ;}var h=this.canvas.getContext("2d"),e=this.radius||10,i=2*e,f=this.getTopLeft();P.forEach(g,function(j){this._drawSinglePoint(j,h,f,i,e);},this);return h;},_drawSinglePoint:function d(i,e,l,m,h){var g=i&&this.getScreenPointForLocation(i.getPositionInfo()),k,j,f;if(!e||!l||!g||isNaN(g.x)||isNaN(g.y)){return false;}k=g.x;j=g.y;this.addToLocationMap(i,k,j);k=this.zeroX(k,l);j=this.zeroY(j,l);f=e.createRadialGradient(k,j,0,k,j,h);f.addColorStop(0,"rgba(0, 0, 0, 0.10)");f.addColorStop(1,"transparent");e.fillStyle=f;e.fillRect(k-h,j-h,m,m);},_putGradientColourToContext:function U(e){var f=this._getGradientDataForContext(e);if(f){e.putImageData(f,0,0);}},_getGradientDataForContext:function B(i){var g=this.canvas,e=this.createColourGradient(),k=i&&i.getImageData(0,0,g.width,g.height),h=k&&k.data,f,l,j;if(!e||!h){return ;}for(l=0,j=h.length;l<j;){f=h[l+3]*4;h[l]=e[f];h[l+1]=e[f+1];h[l+2]=e[f+2];h[l+3]=Math.min(255,h[l+3]*5);l+=4;}return k;},getAttrsFromLocationMap:function X(g,f){var h=this.locationMap;if(!h){return[];}var e=g-this.xOffset;var i=f-this.yOffset;if(h[e]&&h[e][i]){return h[e][i];}return[];},getAttrsFromLocationMapRange:function M(e,l){var h=[],f=this.radius||10;for(var k=e-f;k<e+f;k++){for(var g=l-f;g<l+f;g++){h=h.concat(this.getAttrsFromLocationMap(k,g));}}return h;},setTransform:function E(e){if(!!this.canvas&&!!e&&e.x!=undefined&&e.y!=undefined){this.canvas.style.left=parseInt(e.x)+"px";this.canvas.style.top=parseInt(e.y)+"px";}},getBounds:function G(){return null;},getTopLeft:function a(){return null;},getScreenPointForLocation:function W(e){return null;},hasMapBoundsChanged:function F(){return true;},zeroX:function I(e,f){return e;},zeroY:function H(f,e){return f;},getDrawingLayerWidth:function K(){return this.width;}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.vi.ui.rw._HasVisSelections");var I=mstrmojo.array,F=mstrmojo.hash,H=mstrmojo.vi.ui.rw.SelectionType;function K(U){var b=this.getDataModel(),f=b&&b.getRowTitles(),a=this.getAttrFormIndices(),P,V,R=a.length,N,d,X,T,S,O,Z,c,Y,Q,e,W;X=b.getRowHeaders(U);N=X.size();d=[];for(S=0;S<R;S++){P=a[S];V=P.length;c=f.getTitle(S);Y=c.getName();Q=c.getUnitId();for(Z=0;Z<V;Z++){O=P[Z];if(O<N){T=X.getHeader(O);if(T.t&&T.h.stt===1){return[];}e=T.getName();W=T.getElementId();d.push({n:Y,nid:Q,v:e,vid:W});}}}return d;}function M(U){var b=this.getDataModel(),f=b&&b.getRowTitles(),a=this.getAttrFormIndices(),P,V,R=a.length,N,d,X,T,S,O,Z,c,Y,Q,e,W;X=b.getRowHeaders(U);N=X.size();d=[];for(S=0;S<R;S++){P=a[S];V=P.length;c=f.getTitle(S);Y=c.getName();Q=c.getUnitId();for(Z=0;Z<V;Z++){O=P[Z];if(O<N){T=X.getHeader(O);if(T.t&&T.h.stt===1){continue;}e=T.getName();W=T.getElementId();d.push({n:Y,tid:Q,v:e,eid:W});}}}return d;}mstrmojo.vi.ui.rw._HasGraphicsSelections=mstrmojo.provide("mstrmojo.vi.ui.rw._HasGraphicsSelections",{_mixinName:"mstrmojo.vi.ui.rw._HasGraphicsSelections",init:function(N){if(this._super){this._super(N);}this._selectedGraphicsInfo={};},shouldEnableSelectedGraphics:function G(){return mstrApp&&mstrApp.isEmbedded;},getDataModel:function E(){var N=this.model.data;return this.addDisposable(new mstrmojo.models.template.DataInterface(N));},addSelectedGraphicInfo:function D(N,O){if(!this.shouldEnableSelectedGraphics()){return ;}if(!this._selectedGraphicsInfo){this._selectedGraphicsInfo={};}this._selectedGraphicsInfo[N]=O;},removeSelectedGraphicInfo:function A(N){if(!this.shouldEnableSelectedGraphics()){return ;}if(!this._selectedGraphicsInfo||!this._selectedGraphicsInfo[N]){return ;}delete this._selectedGraphicsInfo[N];},clearSelectedGraphicInfo:function C(){if(!this.shouldEnableSelectedGraphics()){return ;}this._selectedGraphicsInfo={};},getSelectedGraphicsInfo:function J(){if(!this.shouldEnableSelectedGraphics()){return ;}var N=[];F.forEach(this._selectedGraphicsInfo,function(O){N.push(O);});return N;},addRowIndicesSelection:function B(N){if(!this.shouldEnableSelectedGraphics()){return ;}var P,O=this;I.forEach(N,function(Q){P=K.call(O,Q);if(P.length>0){O.addSelectedGraphicInfo(Q,P);}});}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.Container");mstrmojo.requiresDescs(1442,2140);var C=mstrmojo.dom;mstrmojo.ui.menus.ToolbarEditor=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._IsMenuPopup,mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.menus.ToolbarEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-ToolbarEditor mstrmojo-ui-MenuEditor {@cssClass}" style="..." mstrAttach:mouseover,mouseout,click><div class="te-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},popupConfig:null,children:null,autoCloses:false,locksHover:true,visible:true,onclick:function B(E){C.stopPropogation(null,E.e);},init:function D(F){this._super(F);var E=this.popupConfig,G=E.contents;if(!G){throw new Error("Cannot open editor without editor content.");}this.cssClass=E.cssClass;this.addChildren(G);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Popup","mstrmojo.CheckBox","mstrmojo.gmaps.MapEnums");var D=mstrmojo,E=D.css,G=D.gmaps,C=G.EnumPropertyType;mstrmojo.gmaps.MapMoreControls=mstrmojo.declare(mstrmojo.Popup,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.gmaps.MapMoreControls",cssClass:"moreCtrlBox",sourceToolbar:null,maxHeight:null,alias:"moreCtrlBox",slot:"popupNode",locksHover:true,autoCloses:true,onOpen:function B(){var O=this.sourceToolbar,M=O&&O.moreCtrlNode,Q=this.parent;if(!M||!Q){return ;}E.addClass(M,"open");Q.set("useRichTooltip",false);var J=O.parent,P=false,K=false,I;J.forEachGraphicLayer(function(R){I=R.canShowLegend();K=K||(I&&R.needShowLegend());P=P||I;},false,true);if(P){E.removeClass(this.legendCtrl.domNode,"disabled");this.legendCtrl.set("checked",K);}else{E.addClass(this.legendCtrl.domNode,"disabled");this.legendCtrl.domNode.firstChild.disabled=true;}var H=O&&O.map,N=H&&H.getPropertyValue(C.tooltipSwitch);this.tooltipCtrl.set("checked",N!=="false");},onClose:function A(){var J=this.sourceToolbar,I=this.parent,H=J&&J.moreCtrlNode;if(!H){return ;}E.removeClass(H,"open");I.set("useRichTooltip",true);this.destroy();},children:[{alias:"legendCtrl",scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(12001,"Show Legend"),align:"left",cssDisplay:"block",checked:false,onclick:function(){var J=this.parent,H=J.sourceToolbar,K=H&&H.map,I=this.checked;if(!K){return ;}K.handleShowAllLegends(I);this.set("checked",I);}},{alias:"tooltipCtrl",scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15859,"Enable Tooltips"),align:"left",cssDisplay:"block",checked:true,onclick:function(){var J=this.parent,H=J.sourceToolbar,K=H&&H.map,I=this.checked;if(!K){return ;}K.writeProperties(C.tooltipSwitch,I.toString());this.set("checked",I);}}],destroy:function F(H){var I=this.popupRef;if(this.popupToBody&&I.hasRendered){I.unrender(false);}delete this.sourceToolbar;this._super(H);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.ToolbarEditor","mstrmojo.hash");mstrmojo.ui.menus.ToolbarEditorConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.ToolbarEditorConfig",cssClass:"",contents:null,init:function C(D){this._super(D);this.initBindings();},clear:function A(){this._super();this.contents=null;},newInstance:function B(D){return new mstrmojo.ui.menus.ToolbarEditor(mstrmojo.hash.copy({popupConfig:this},D));}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.Box","mstrmojo.VBox","mstrmojo.Popup","mstrmojo.RadioList","mstrmojo.CheckBox","mstrmojo.gmaps.MapEnums");var O=mstrmojo,J=O.array,G=O.gmaps,I=G.EnumToolbarState;mstrmojo.gmaps.MapLayerControlList=mstrmojo.declare(mstrmojo.Popup,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.gmaps.MapLayerControlList",cssClass:"layerSelectBox",sourceToolbar:null,maxHeight:null,alias:"layerSelectBox",slot:"popupNode",locksHover:true,autoCloses:true,layerCount:null,layersRendered:null,onOpen:function F(){var U=this.sourceToolbar,S=this.layerCtrlContentWrapper.layerContentBox.layerSelectVBox,T=S.allLayers,R;if(!U){return ;}U.set("state",I.LAYERS_SELECT);this.set("selected",true);if(T){R=T;}else{R=S.children[0]&&S.children[0].children[0];}if(R&&R.domNode){R.domNode.style["margin-top"]="4px";}this.addEventsForLayerCheckbox();},onClose:function K(){this.set("selected",false);this.sourceToolbar&&this.sourceToolbar.set("state",I.NORMAL);},addEventsForLayerCheckbox:function C(){var S=this.domNode&&this.domNode.getElementsByClassName("gridLayerNames"),V,T,U,R;for(U=0,R=S.length;U<R;U++){V=S[U];T=V.childNodes&&V.childNodes[1];if(T){T.removeAttribute("for");T.onclick=function(){var W=this.parentNode.childNodes[0];W&&W.click();};}}},children:[{alias:"layerCtrlContentWrapper",scriptClass:"mstrmojo.Box",cssClass:"layerCtrlContentWrapper",children:[{alias:"layerContentBox",scriptClass:"mstrmojo.Box",cssClass:"layerContentBox",children:[{alias:"layerSelectVBox",scriptClass:"mstrmojo.VBox",cssClass:"layerSelectVBox",cssText:"",postCreate:function(){var R=this.parent&&this.parent.parent&&this.parent.parent.parent;R&&R.createLayerListContent(this);}}]}]}],createLayerListContent:function Q(T){var R=this.sourceToolbar&&this.sourceToolbar.getLayerCtrlList(),S=[];if(!R||!T){return ;}this.layerCount=R.length;this.layersRendered=0;this.addLayerItemsNode(S,R);this.addAllCheckBox(S,R);T.set("children",S);},addAllCheckBox:function E(T,S){var R;if(S.length>1){R=this._createAllCheckBox(S);T.splice(0,0,R);R.set("checked",(this.layersRendered===this.layerCount));}},_createAllCheckBox:function B(R){if(!J.isArray(R)){return ;}var S=this;return mstrmojo.insert({scriptClass:"mstrmojo.CheckBox",cssClass:"allLayer gridLayerNames",label:mstrmojo.desc(10371,"All Layers"),alias:"allLayers",cssDisplay:"block",align:"left",postCreate:function(){this.set("checked",true);},onclick:function(){var W=this.parent,Y=S.sourceToolbar,V={},T={},Z,b,U,X,a;if(!W||!Y){return ;}for(X=0,a=R.length;X<a;X++){if(!R[X]){continue;}b=R[X].id;U=W["layersbox"+b];Z=U&&U.children&&U.children[0];if(Z&&this.checked!=Z.checked){V[b]={isVisible:Z.checked};T[b]={isVisible:this.checked};Z.processMe(this.checked,true);}}Y.submitLayerVisibleChanges(V,T);}});},addLayerItemsNode:function A(U,S){if(!J.isArray(U)||!J.isArray(S)){return ;}var V,W,T,R;for(T=0,R=S.length;T<R;T++){V=S[T];if(V){W=this._createSingleLayerNode(V);U.push(W);}}},_createSingleLayerNode:function D(W){if(!W){return ;}var V=this,U=W.id,S=W.n,T=W.metrics,R=W.isVisible;this.layersRendered+=(R)?1:0;return mstrmojo.insert({scriptClass:"mstrmojo.VBox",cssClass:"layerSelectVBox",alias:"layersbox"+U,halign:"left",cssText:"margin-top:3px;margin-bottom:5px;width:100%;",children:[V._createSingleLayerCheckbox(S,U,R),V._createMetricRadioList(U,T,R)]});},_createSingleLayerCheckbox:function N(R,T,V){var U=this;return{scriptClass:"mstrmojo.CheckBox",cssClass:"gridLayerNames",label:R,tooltip:R,align:"left",cssDisplay:"block",layerKey:T,checked:V,processMe:function S(Z,Y){var X=U.sourceToolbar,W=this.layerKey;if(!X){return ;}U.layersRendered+=(Z?1:-1);if(!Y){X.setLayerVisibility(W,Z);}this.set("checked",Z);this.parent["metricSelector_"+W]&&this.parent["metricSelector_"+W].set("enabled",Z);},onclick:function(W){this.processMe(this.checked);if(this.parent.parent.allLayers){this.parent.parent.allLayers.set("checked",(U.layersRendered==U.layerCount));}}};},_createMetricRadioList:function M(U,T,R){if(U==undefined||!J.isArray(T)||T.length<1){return ;}var V=this;return{scriptClass:"mstrmojo.RadioList",alias:"metricSelector_"+U,layerKey:U,cssClass:"layerMetrics",itemTitleField:"n",items:T,enabled:R,postCreate:function S(W){var X=V.sourceToolbar;if(X){this.selectedIndex=X.getLayerSelectedMetricIdx(this.layerKey);}},postselectionChange:function(W){var Z,X=this.items,Y=V.sourceToolbar;if(X&&Y&&this.parent.children[0].checked){Z=X[W.added[0]];if(Z.v!=-1){Y.onselectedMetricIdxChange(Z.layerKey,W.added[0],Z.id);}}}};},getDomStyleVal:function H(S,T){var R;if(S&&T){if(!window.getComputedStyle){R=parseInt(S[T],10);}else{R=parseInt(S.getPropertyValue(T),10);}}return isNaN(R)?0:R;},destroy:function P(R){var S=this.popupRef;if(this.popupToBody&&S.hasRendered){S.unrender(false);}delete this.sourceToolbar;this._super(R);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.tooltip","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.PanelPortlet");var J=mstrmojo,G=J.css,E=J.dom,C=J.hash,A=J.tooltip;function F(){G.toggleClass(this.titleBar.leftToolNode,"hidden",this.hideCollapse);}mstrmojo.gmaps.MapLayerPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.gmaps.MapLayerPortlet",cssClass:"map-layer-portlet",showTitleBarContextMenu:true,zoomLevelSub:null,getTitleBarCfg:function N(){var O=this._super(),P=this;if(this.isVisFilterSource){O.getTitleChildren=function(){return(this.constructor.prototype.getTitleChildren.call(this)).concat([{scriptClass:"mstrmojo.Button",slot:"textNode",iconClass:"source-vis",useRichTooltip:true,customTooltipHandler:function(Q){Q.stopPropagation();},updateTooltipConfig:function(){var Q=E.position(this.domNode);this.richTooltip={content:mstrmojo.desc(15709,"This layer is used to target other visualizations."),posType:A.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:Q.y-Q.h+1,left:Q.x+Q.w+6};}}]);};}O.useRichTooltip=true;O.shouldShowTooltip=function(){return this.useRichTooltip;};O.updateTooltipConfig=function(){if(P.canShowLayer()){this.richTooltip=null;return ;}var Q=E.position(this.domNode);this.richTooltip={content:mstrmojo.desc(15710,"This layer is not visible at the current zoom level due to the zoom through layer setting."),posType:A.POS_TOPLEFT,cssClass:"vi-warning vi-regular vi-tooltip-C",top:Q.y-5,left:Q.x+Q.w+3};};return O;},postBuildRendering:function(){this._super();var Q=this.children,P,O,R=this;if(!Q||Q.length<2){this.disableExpand();}F.call(this);P=this.getMapViewer();O=P&&P.baseLayer;if(O){this.zoomLevelSub=O.attachEventListener("zoomLevelChanged",this.id,function(){R.refreshNodeStatus();});}this.refreshNodeStatus();},refreshNodeStatus:function B(){var P="state-show",Q="state-hide",R="state-invisible",O=C.walk("titleBar.tbToolbar.itemsNode",this),S=this.isLayerVisible&&this.canShowLayer();if(S){this.enableExpand();if(O){G.removeClass(O,Q);G.removeClass(O,R);G.addClass(O,P);}}else{this.disableExpand();if(O){G.removeClass(O,P);G.addClass(O,Q);G.toggleClass(O,R,!this.canShowLayer());}}},disableExpand:function I(){this.togglePortlet(true);this.canCollapse=false;this.titleBar.canCollapse=false;G.addClass(this.domNode,"disableExpand");},enableExpand:function D(){this.canCollapse=true;this.titleBar.canCollapse=true;G.removeClass(this.domNode,"disableExpand");},destroy:function K(){var Q=this.getMapViewer(),O=Q&&Q.baseLayer,P=this.zoomLevelSub;if(O&&P){O.detachEventListener(this.zoomLevelSub);}delete this.zoomLevelSub;},getMapViewer:function H(){return C.walk("parent.parent.parent.parent.parent.parent.parent.parent",this);},onclick:function M(O){var P=this.getMapViewer(),Q=P&&P.parent;if(mstrApp&&mstrApp.isDossier&&Q&&Q.isInFilterPanel()&&O){O.cancel();}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.gmaps.MapLayerPortlet,{onhideCollapseChange:function(){F.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.Box","mstrmojo.VBox","mstrmojo.tooltip","mstrmojo.Popup","mstrmojo.RadioList","mstrmojo.CheckBox","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapLayerPortlet","mstrmojo.VisUtility");var S=mstrmojo,J=S.array,U=S.css,D=S.dom,P=S.tooltip,F=S.gmaps,Q=F.EnumToolbarState,I=F.EnumPropertyType,V=F.EnumClusterMode,N=F.EnumDataLabelShowOption,R=F.EnumDataLabel,M="unit-name",G=S.VisUtility;function C(Z,X){var W=Z&&Z.mapViewer,Y=W&&W.getGraphicLayer(X);if(Y){return Y.getLayerProp(R.DATA_LABEL_SHOW);}}function A(Y){var X="10px Arial",Z=220-17-26-10,b=G.measureTextWidth(Y,X,true),W=Y.length-8,a;while(b>Z){a=Y.slice(0,W)+"..."+Y.slice(-5);W-=1;Y=a;b=G.measureTextWidth(Y,X,true);}return Y;}mstrmojo.gmaps.MapLayerControlListNew=mstrmojo.declare(mstrmojo.Popup,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.gmaps.MapLayerControlListNew",cssClass:"layerSelectBox",sourceToolbar:null,maxHeight:null,alias:"layerSelectBox",slot:"popupNode",locksHover:true,autoCloses:true,layerCount:null,onOpen:function E(){var Z=this.sourceToolbar,X=this.layerCtrlContentWrapper.layerContentBox.layerSelectVBox,a=Z&&Z.layerCtrlNode,Y=this.parent,W;if(!a||!Y){return ;}Z.set("state",Q.LAYERS_SELECT);this.set("selected",true);U.addClass(a,"open");W=X.children[0]&&X.children[0].children[0];if(W&&W.domNode){W.domNode.style["margin-top"]="4px";}Y.set("useRichTooltip",false);},onClose:function B(){var X=this.sourceToolbar,W=this.parent,Y=X&&X.layerCtrlNode;if(!Y){return ;}this.set("selected",false);U.removeClass(Y,"open");X.set("state",Q.NORMAL);W.set("useRichTooltip",true);this.destroy();},children:[{alias:"layerCtrlContentWrapper",scriptClass:"mstrmojo.Box",cssClass:"layerCtrlContentWrapper",children:[{alias:"layerContentBox",scriptClass:"mstrmojo.Box",cssClass:"layerContentBox",children:[{alias:"layerSelectVBox",scriptClass:"mstrmojo.VBox",cssClass:"layerSelectVBox",cssText:"",postCreate:function(){var W=this.parent&&this.parent.parent&&this.parent.parent.parent;W&&W.createLayerListContent(this);}}]}]}],createLayerListContent:function O(Y){var W=this.sourceToolbar&&this.sourceToolbar.getLayerCtrlList(),X=[];if(!W||!Y){return ;}this.layerCount=W.length;this.addLayerItemsNode(X,W);Y.set("children",X);},addLayerItemsNode:function K(X,e){if(!J.isArray(X)||!J.isArray(e)){return ;}var a=this,d=this,b="state-show",c="state-hide",Y,W,Z,f;for(Z=0,f=e.length;Z<f;Z++){Y=e[Z];W=this._createSingleLayerControls(Y);if(Y){X.push({scriptClass:"mstrmojo.gmaps.MapLayerPortlet",isCollapsed:f!==1||Z!==0||(W&&W.length===0),title:Y.n,layerKey:Y.id,isLayerVisible:Y.isVisible,isVisFilterSource:Y.isVisFilterSource,children:W,canShowLayer:function(){var h=d.sourceToolbar,g=h&&h.getGraphicLayer(this.layerKey);return !!g&&g.isLayerInZoomRange();},addMenuItems:function(g){var h=this;g.addToolbarBtn(null,"visible-icn "+(this.canShowLayer()&&this.isLayerVisible?b:c),function(k,j){var i=a&&a.sourceToolbar;if(!h.canShowLayer()){return ;}h.isLayerVisible=!h.isLayerVisible;h.refreshNodeStatus();if(i){i.setLayerVisibility(h.layerKey,h.isLayerVisible);}});}});}}},_createSingleLayerControls:function H(b){var Z=b.id,d=b.dlAttr,X=b.dlMetric,Y=this.sourceToolbar,c=C(Y&&Y.map,Z),a=this,W=[];if(b.isClustered!==undefined){W.push({scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15705,"Enable Clustering"),align:"left",cssDisplay:"block",layerKey:Z,checked:!!b.isClustered,useRichTooltip:true,updateTooltipConfig:function(){if(!this.checked){this.richTooltip=null;return ;}var e=D.position(this.domNode),g=a.sourceToolbar,f=g&&g.getGraphicLayer(this.layerKey);if(f&&!f.isLayerInClusterRange()){this.richTooltip={content:mstrmojo.desc(15706,"Clustering is not enabled at current zoom level due to clustering settings."),posType:P.POS_TOPLEFT,cssClass:"vi-warning vi-regular vi-tooltip-C",top:e.y-e.h+2,left:e.x+e.w-10};}else{this.richTooltip=null;}},onclick:function(i){var f=a.sourceToolbar,h=f&&f.map,g=this.checked;if(!h){return ;}this.set("checked",g);this.hasOpenTooltip=false;h.writeProperties(I.clusterMode,g?V.ON:V.OFF,this.layerKey);this.showTooltip(i);}});W.push({scriptClass:"mstrmojo.Label",text:"",cssClass:M});}if(d){W.push({scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15707,"Show Text Label"),align:"left",cssDisplay:"block",layerKey:Z,checked:c===N.SHOW_TEXT||c===N.SHOW_BOTH,onclick:function(){var f=a.sourceToolbar,i=f&&f.map,e=this.layerKey,h=C(i,e),g=this.checked;if(!i){return ;}this.set("checked",g);if(g){switch(h){case N.NONE:h=N.SHOW_TEXT;break;case N.SHOW_VALUE:h=N.SHOW_BOTH;break;default:break;}}else{switch(h){case N.SHOW_TEXT:h=N.NONE;break;case N.SHOW_BOTH:h=N.SHOW_VALUE;break;default:break;}}i.writeProperties(R.DATA_LABEL_SHOW,h,e);}});W.push({scriptClass:"mstrmojo.Label",text:A(d.n),cssClass:M});}if(X){W.push({scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15708,"Show Value Label"),align:"left",cssDisplay:"block",layerKey:Z,checked:c===N.SHOW_VALUE||c===N.SHOW_BOTH,onclick:function(){var f=a.sourceToolbar,i=f&&f.map,e=this.layerKey,h=C(i,e),g=this.checked;if(!i){return ;}this.set("checked",g);if(g){switch(h){case N.NONE:h=N.SHOW_VALUE;break;case N.SHOW_TEXT:h=N.SHOW_BOTH;break;default:break;}}else{switch(h){case N.SHOW_VALUE:h=N.NONE;break;case N.SHOW_BOTH:h=N.SHOW_TEXT;break;default:break;}}i.writeProperties(R.DATA_LABEL_SHOW,h,e);}});W.push({scriptClass:"mstrmojo.Label",text:A(X.n),cssClass:M});}return W;},destroy:function T(W){var X=this.popupRef;if(this.popupToBody&&X.hasRendered){X.unrender(false);}delete this.sourceToolbar;this._super(W);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.ui.List","mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Popup","mstrmojo.VisUtility");var X=mstrmojo.array,W=mstrmojo.css,I=mstrmojo.dom,O=mstrmojo.hash,U=mstrmojo.VisUtility,A=2,b=5,G=40;function S(h,d){var f,c,g,e=[],j;for(f=0,c=h.length;f<c;f++){g=h[f];j=g.label?"displayMenuTitle"+(g.isCloud?" geo":""):"hideMenuTitle";e.push({scriptClass:"mstrmojo.Box",cssClass:"suggestionBlock",children:[{scriptClass:"mstrmojo.Label",allowHTML:true,text:"<div>"+g.label+(g.isCloud?"":" ("+g.items.length+")")+"</div>",cssClass:"layerLabel "+j},{scriptClass:"mstrmojo.ui.List",cssClass:"searchSuggestion "+(g.label?"sub":"top"),alias:"list",items:g.items,onchange:function(){if(!d.opener){return ;}var i=d.opener.suggestionSource;if(i&&i.onSuggestionItemSelected&&this.selectedItem){i.onSuggestionItemSelected(this.selectedItem);if(d.opener&&d.opener.search){d.opener.search.inputNode.value=this.selectedItem.n;}d.close();}}}]});}return{scriptClass:"mstrmojo.Box",alias:"suggestion",cssClass:"suggestionList",children:e};}function P(d){var c=0;X.forEach(d,function(e){c+=e.items?e.items.length:0;});return c;}function T(e,h,c,i){var g,f=c,d;X.forEach(e,function(j){if(h){d=j[h]&&j[h].items;}else{d=j.items;}if(!d){return true;}if(f>=0&&f<d.length){if(i){i.call(j,f);}g=d[f];return false;}else{f-=d.length;}});return g;}function H(e,f){if(!e||!f){return ;}var d=e.getBoundingClientRect(),h=f.getBoundingClientRect(),c=h.top-d.top,g=h.top+h.height-d.top-d.height;if(g>0){e.scrollTop+=g;}else{if(c<0){e.scrollTop+=c;}}}function C(c){var f=this.suggestion.children,e=c,d=this;if(this.selectedNode){W.removeClass(this.selectedNode,"selected");}T(f,"list",e,function(g){d.selectedNode=this.list._getItemNode(g);W.addClass(d.selectedNode,"selected");H(this.list.domNode,d.selectedNode);H(this.parent.domNode,this.domNode);});}mstrmojo.gmaps.MapSearchWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.gmaps.MapSearchWidget",markupString:'<div id="{@id}" class="mstrmojo-SearchWidget-WithSuggestion {@cssClass}"><div class="searchbox" mstrAttach:keydown></div><div class="suggestion"></div></div>',markupSlots:{searchNode:function(){return this.domNode.firstChild;},popupNode:function(){return this.domNode.lastChild;}},suggestionResults:null,popupOpenConfig:null,suggestionSource:null,displayResults:function(c){this.set("suggestionResults",c);this.adjustPopupSize(c);this.openPopup("popupRef",this.popupOpenConfig);this.updatePopupPosition();},clearResults:function(){this.set("suggestionResults",null);this.closePopup();},adjustPopupSize:function Q(g){var f=this.parent&&this.parent.map;if(f){var e=Math.floor((2/3)*f.getWidth()),d=W.getComputedStyle(this.domNode);O.copy({cssText:"max-width: "+e+"px"},this.popupRef);if(d){var c={fontFamily:d.fontFamily,fontSize:d.fontSize,fontStyle:d.fontStyle,fontWeight:d.fontWeight,fontVariant:d.fontVariant};X.forEach(g,function(h){X.forEach(h.items,function(j){var l=j.n,k=U.measureTextWidth(l,c,1),i=k+G;if(i>e){O.copy({title:j.n},j);}});});}}},updatePopupPosition:function Z(){var g=this.parent&&this.parent.map,f=this.domNode&&this.domNode.getElementsByClassName("suggestionList")[0],c=g&&g.domNode,e,d;if(f&&c){e=f.getBoundingClientRect();d=c.getBoundingClientRect();f.style["max-height"]=(d.height-(e.top-d.top)-b)+"px";}},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",autoCloses:false,autoClose:false,locksHover:true,closeOnClick:true,currentIdx:-1,onOpen:function K(){var c;this.destroyChildren();this.currentIdx=-1;this.addChildren(S(this.opener.suggestionResults,this));this.refresh();C.call(this,0);},selectNext:function B(){var e=this.opener.suggestionResults,c=P(e),d=this.currentIdx;d=++d%c;C.call(this,d);this.currentIdx=d;return T(e,null,d).n;},selectPrevious:function E(){var e=this.opener.suggestionResults,c=P(e),d=this.currentIdx;d=(c+d-1)%c;C.call(this,d);this.currentIdx=d;return T(e,null,d).n;}},onkeydown:function M(f){var c=f.hWin,i=f.e||c.event,g=i.keyCode;if(g===38||g===40){this.search.quickSearch=false;I.stopPropogation(c,i);}else{var d=this.popupRef,j=d.suggestion&&d.suggestion.children,h=d.currentIdx;if(g===13&&j){h=h<0?0:h;T(j,"list",h,function(e){this.list.select(e);});this.closePopup();this.search.quickSearch=false;}else{this.search.quickSearch=true;}}},children:[{scriptClass:"mstrmojo.SearchWidget",alias:"search",slot:"searchNode",quickSearch:true,placeholderText:mstrmojo.desc(12666,"Search..."),showClearNode:false,onsearch:function J(){var d=this.getSearchPattern(),e=this.parent,c=e.suggestionSource;if(this.quickSearch&&d.length>=A&&c&&c.getSearchSuggestions){c.getSearchSuggestions(d,function(f){if(f&&f.length>0){e.displayResults(f);}else{e.clearResults();}});}},onEnter:function N(c){this.onsearch(this.getSearchPattern());this.quickSearch=true;this.setClearIcon();},onArrowUp:function D(){var c=this.parent.popupRef,d;if(c.visible){d=c.selectPrevious();if(d){this.inputNode.value=d;this.quickSearch=true;this.setClearIcon();}}},onArrowDown:function F(){var c=this.parent.popupRef,d;if(c.visible){d=c.selectNext();if(d){this.inputNode.value=d;this.quickSearch=true;this.setClearIcon();}}},onclear:function a(){this.parent.clearResults();}}],isFocus:function R(){var c=this.search;return !!c&&c.isFocus;},unrender:function V(c){var d=this.popupRef;if(this.popupToBody&&d.hasRendered){d.unrender(false);}if(this._super){this._super(c);}},destroy:function Y(c){delete this.suggestionSource;this._super(c);}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var O=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,N=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(P){return P.model.controller.cmdMgr;}function M(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function P(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(Q,S){var P,V,R,T,U={};U.tks=this.k;U.selectorObjects=Q;U.keepOnly=!!S;U.isDocVis=true;P=M.call(this);V=P.getDataService();R=V.getGMViewFilterAction(U);T=P.getSliceCallback(U);return{action:R,callbacks:T};}function B(R,Q){var P,T,S;P=M.call(this);S=P.getDataService();if(!this.isXMLDirty()){S.submitUpdates(R,Q);}else{T=this.getPersistAction();S.submitUpdates([R,T],Q);this.resetXMLDirtyFlag();}}function A(){var c=this.modelData||this.model.data,T=c.k,a,Z="FormattingWidget",V,U,Y,Q,R,S=[],X=[],W=this.edtModel;if(!c){console.log("warning: modelData is missing");return null;}var b=function(e,g){var d=U.createElement(g),f;if(e instanceof Object){for(f in e){if(e.hasOwnProperty(f)){var h=b(e[f],f);if(h){d.appendChild(h);}}}}else{d.setAttribute("value",e);}return d;};var P=function(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");};Y=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!Y||Y.length===0){V=this.getProperties(T);if(this.useCompatibleXML){U=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");U.firstChild.appendChild(b(V,"fmt"));}else{U=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");U.firstChild.firstChild.appendChild(b(V,"fmt"));}Y=(new XMLSerializer()).serializeToString(U);}Q=P(Y);R={act:"setProperty",nodeKey:T,prs:Z,pri:4,v:Q};S.push(R);return S;}function F(Q,R,P,U){if(!(U instanceof Function)){return D;}var T=this.id;function S(V){return function(){var X=mstrmojo.all[T],W;if(!X){return ;}W=X.getProperties();W[Q]=V;U.call(X,V,true);X.getDocModel().selectVIUnit(X.parent.id,true);};}return{silent:true,undo:S(P),redo:S(R)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(S){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var R=this,Q,P=(R.getDocModel&&R.getDocModel())||R.model.docModel;if(P){return P.attachEventListener("colorMapChanged",R.id,function(U){Q=R.parent&&R.parent.parent;if(R.forceUpdateColorMap||(Q&&Q.isPanelDisplaying())){S.call(R);}else{var T=Q.attachEventListener("panelDisplaying",R.id,function(V){if(R.postBuilderingCalled){S.call(R);}Q.detachEventListener(T);});}});}},detachUpdateColorMapListener:function(Q){if(!Q){return ;}var P=(this.getDocModel&&this.getDocModel())||this.model.docModel;P.detachEventListener(Q);},updateTargets:function(Q){var T={},R=this,P=M.call(this);T.fromGM=true;T.type=1;T.src=this.k;T.selectorObjects=Q;function S(W){var U=R.modelData||R.model.data,V=U.sc;if(V!==undefined){return V[W];}return undefined;}T.keepOnly=true;T.ck=S.call(this,"ck");T.keyContext=T.ck;T.tks=S.call(this,"tks");T.ckey=S.call(this,"ckey");T.isDocVis=true;T.include=true;T.showall=S.call(this,"showall");P.slice(T);},updateAfterViewFilter:function(R,P){var W,V,Q,U,T,X,S;W=M.call(this);V=W.getDataService();U=E.call(this,R,P);Q=U.action;T=U.callbacks;S=this.model.controller||W.controller;if(this.currKeepOnlyAction){X=[C.clone(this.currKeepOnlyAction)];}else{X=E.call(this,[],false).action;}this.currKeepOnlyAction=Q;S.submitUndoRedoUpdates([Q],X,T);},updateAfterKeepOnly:function(R){var Q=M.call(this),P=this.model.controller||Q.controller,S=N(P._getXtabCallback(this),H.call(this));P.applyKeepOnly(this,S,{keepOnly:R,data:this.getContextMenuSelections()},R?-2:undefined);},updateAfterKeepOnlyForMultiTemplate:function(R){var Q=M.call(this),P=this.model.controller||Q.controller,S=N(P._getXtabCallback(this),H.call(this));P.applyKeepOnlyForMutilTemplate(R,S,true);},updateAfterDrill:function(P,d,Z){var a=this,e=M.call(this),c=e.getDataService(),U=c.newUpdate(),S=this.getContextMenuSelections(),Q=Z||this,T=Q.model,V=Q.model.data||Q.node.data,Y=T.getSelectorDataFromTemplateLimit(V.tpl).concat({keepOnly:true,data:S}),R=e.getKeepOnlyOrExcludeAction(V.k,Y),W=a.model.controller||e.controller,X=W._getXtabCallback(a);U.add(P,N(d,X));U.add(R,H.call(a));K(a).execute({execute:function b(){this.submitUpdate(U);},urInfo:{callback:U.callback}});},updateAfterSort:function(S){var Q=this,P=M.call(this),T=P.getDataService(),U=P.getSliceCallback({tks:Q.k});K(Q).execute({execute:function R(){var W=T.newUpdate(this,undefined),V={act:"sortGM",nodeKey:Q.k,subActions:S,partialUpdate:{nodes:[Q.k]}};W.add(V,U,undefined);if(Q.isXMLDirty()){W.addActions(Q.getPersistAction());}this.submitUpdate(W,undefined);},urInfo:{callback:U}});},updateAfterAction:function(U,P,Q,b,Y){if(!U){return ;}var W=this,R=W.parent&&W.parent.id,c=W.model.docModel,V=W.model.controller||c.controller,a,Z,T={},X,S=Y||D;if(Q){a=mstrmojo.emptyFn;X=function(){this.submitSilent(U);};}else{a=c.getSliceCallback({tks:this.k});a.success=G([a.success,function(){c.selectVIUnit(R,true);}]);X=function(){this.submit(U,a,T);};}Z=V._getXtabCallback(W);if(P){a=N(a,P);Z=N(Z,P);}Z.success=G([Z.success,function(){c.selectVIUnit(R,true);}]);if(Q){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,T);}if(b){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,T);}K(this).execute({execute:X,urInfo:{silent:S.silent,callback:Z,redo:S.redo,undo:S.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(Q,R,P,S){this.updateAfterAction(A.call(this),Q,R,P,S);},setProperty:function(W,S,U){var Q=U.callback,R=!!U.suppressData,Y=U.requestDefinition,T=U.clientUndoRedoCallback,X=this.getProperties(),P=X[W],V;if(W===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,S);}}else{if(X&&(X[W]===undefined||X[W].toString()!==S.toString())){X[W]=S;V=F.call(this,W,S,P,T);this.updateAfterPropertiesChange(Q,R,Y,V);}}},showData:function(P){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.string","mstrmojo.ui._HasScroller","mstrmojo.VisUtility");var B=mstrmojo.css,I=mstrmojo.dom,Y=mstrmojo.VisUtility,X=mstrmojo.array,l=mstrmojo.string,J=mstrmojo.hash,W="new-vis-tooltip",C=16,M=12,R=20,e=5,c=20,V=2,P=220,h=120,n="px",Q=200,D=["mouseover","mouseout"];function m(o){var q=this.tableNode;q.innerHTML="";for(var p=0;p<o;p++){q.appendChild(document.createElement("COL"));}return q;}function b(r,s){r=r||"";s.innerHTML=l.encodeHtmlString(r,true);var o,q=Y.getComputedFontStyle(s),p=Math.ceil(Y.measureTextWidth(s.innerHTML,q,q.bonus));if(p>P){o=Y.truncateTextToLineWithWordWrap(r,q,P,3,true);s.innerHTML=l.encodeHtmlString(o.text,true);s.setAttribute("title",r);}return Math.min(p,P);}function K(t,s){var q=t.childNodes,u=(s&&s.length)||0,o=0,p,r;for(p=0;p<u;p++){r=s[p]+((p<u-1)?C:1);q[p].style.width=r+n;o+=r;}t.style.width=o+n;}mstrmojo.NewVisTooltip=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.NewVisTooltip",prevInfoObj:null,hideTooltipHandler:null,domEventListeners:{},markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="new-vis-tooltip-container-wrapper"><div class="new-vis-tooltip-container"><div  class="new-vis-tooltip-table"></div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild.firstChild;},tableNode:function(){return this.domNode.firstChild.firstChild.firstChild;}},init:function k(o){this._super(o);B.addWidgetCssClass(this,(o&&o.widgetClass)?[o.widgetClass,W]:W);},postBuildRendering:function O(){this._super();this.attachListeners();},attachListeners:function S(){this.detachListeners();X.forEach(D,function(o){this.domEventListeners[o]=I.attachMarkupEvent(this.id,this.domNode,o);},this);},setupScrollNodes:function d(){this.scrollNode=this.containerNode;this.scrollbarHostNode=this.domNode;},toggle:function T(o){var p=mstrApp.isAppStatePrintPreview&&mstrApp.isAppStatePrintPreview();if(this.domNode){this.domNode.style.display=o&&!p?"block":"none";}},isVisible:function E(){return this.domNode&&(this.domNode.style.display!=="none");},hasTableContent:function A(){return this.tableNode;},clearTooltipHandler:function F(){if(this.hideTooltipHandler){clearTimeout(this.hideTooltipHandler);this.hideTooltipHandler=null;}},renderTooltip:function a(o,p){if(!o||o.length===0){return ;}this.toggle(true);if(X.isArray(o)){this.showSimpleInfo(o,p);}else{this.showGridInfo(o,p);}this.prevInfoObj=o;},showTooltipDelay:function j(p,q){this.clearTooltipHandler();var o=this;this.showTooltipHandler=setTimeout(function(){o.renderTooltip(p,q);},200);},showDossierTtp:function g(o,p){this.clearTooltipHandler();if(this.isVisible()&&J.equals(this.prevInfoObj,o)){this.moveTo(p,true);}else{this.renderTooltip(o,p);}},showSimpleInfo:function H(p,t){if(!p||p.length<=0){return ;}var r=m.call(this,2),q=document.createElement("tbody"),s=0,o=0;r.appendChild(q);X.forEach(p,function(v){var w=q.insertRow(-1),x=w.insertCell(-1),u=w.insertCell(-1);B.addClass(x,"name");s=Math.max(s,b(v.n,x));o=Math.max(o,b(v.v,u));});K.call(this,r,[s,o]);this.moveTo(t);},showGridInfo:function U(o,z){var p=o&&o.header,t=o&&o.body,x=o&&o.attrCount,AB,q,u;if(!p||p.length<=0){return ;}var w=p.length,AA=m.call(this,w),y=document.createElement("thead"),s=document.createElement("tbody"),v=y.insertRow(-1),r=[];AA.appendChild(y);AA.appendChild(s);X.forEach(p,function(AD,AC){q=v.insertCell(-1);B.addClass(q,"header");if(AC>=x){B.addClass(q,"metric");}r[AC]=b(AD,q);});X.forEach(t,function(AC,AD){AB=s.insertRow(-1);for(u=0;u<w;u++){q=AB.insertCell(-1);if(AD===0){B.addClass(q,"firstRow");}if(u>=x){B.addClass(q,"metric");}r[u]=Math.max(r[u],b(AC[u],q));}});K.call(this,AA,r);this.moveTo(z);},moveTo:function(AD,q){if(!AD||isNaN(AD.x)||isNaN(AD.y)||!this.tableNode){return ;}var AB=mstrmojo.dom.position(document.body),v=this.domNode,z=this.containerNode,AH=this.tableNode,r=v.style,u=z.style,AF=AH.offsetWidth+c+V,AA=AH.offsetHeight+c+V,t=AB.x+AB.w,AG=AB.y+AB.h,AE=AD.x,AC=AD.y,p=AE+M,o=AC+R,s;if(AF>AB.w*0.8){AF=AB.w*0.8;}s=AF<h?(h-AF)/2:0;u.paddingLeft=s+n;if(AF<h){AF=h;}u.width=AF-c-V-s+n;if(AA>AB.h*0.8){AA=AB.h*0.8;}u.height=AA-c-V+n;AF+=e;AA+=e;if(p+AF<=t&&o+AA>AG){o=AG-AA;}else{if(p+AF>t&&o+AA<=AG){p=t-AF;}else{if(p+AF>t&&o+AA>AG){p=t-AF;if(AC>=AA+e){o=AC-AA-e;}else{if(AC>AG-AC){o=e;u.height=AC-2*e-c-V+n;}else{u.height=AG-AC-R-e-c-V+n;}}}}}r.left=p+n;r.top=o+n;this.updateScrollbars();if(u.overflowY==="scroll"||u.overflowX==="scroll"){if(!q){z.scrollLeft=0;z.scrollTop=0;}}},onmouseover:function G(){this.clearTooltipHandler();},onmouseout:function i(){this.hide(true);},hide:function f(o){var p=this;if(this.isVisible()){if(o){if(!this.hideTooltipHandler){this.hideTooltipHandler=setTimeout(function(){p.toggle(false);},Q);}}else{this.clearTooltipHandler();this.toggle(false);}}},detachListeners:function N(){X.forEach(D,function(o){var p=this.domEventListeners[o];if(p){I.detachEvent(this.domNode,o,p);}},this);this.domEventListeners={};},destroy:function Z(){this.detachListeners();this.clearTooltipHandler();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var E=mstrmojo.array,D=mstrmojo.hash,A=mstrmojo.func.wrapMethods;function B(F){return F.model.controller.cmdMgr;}mstrmojo._colorPalette=mstrmojo.provide("mstrmojo._colorPalette",{listenToUpdateColorMap:function(I){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var H=this,G,F=(H.getDocModel&&H.getDocModel())||H.model.docModel;if(F){return F.attachEventListener("colorMapChanged",H.id,function(K){G=H.parent.parent;if(G.isPanelDisplaying()){I.call(H);}else{var J=G.attachEventListener("panelDisplaying",H.id,function(M){if(H.postBuilderingCalled){I.call(H);}G.detachEventListener(J);});}});}},detachUpdateColorMapListener:function(G){if(!G){return ;}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel;F.detachEventListener(G);},submitUpdatesAndPersistXML:function C(H,M,F,Q){if(!H||H.length===0){return ;}var G={},N=this,R=(N.getDocModel&&N.getDocModel())||N.model.docModel,P=R.getDataService(),I=N.model.controller||R.controller,J=I._getXtabCallback(N);if(F){D.copy(mstrmojo.DocDataService.SUPPRESS_DATA,G);}if(Q){D.copy(mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION,G);}var K=false;E.forEach(H,function(S){if(S.act==="updateElementsPropertiesMap"){K=true;}});if(K){A(R.getUpdateColorMapCallback(),J);}B(N).execute({execute:function O(){var S=P.newUpdate(this,undefined);S.add(H,M,G);this.submitUpdate(S);},urInfo:{callback:J}});},updateColorMap:function(I,G){if(!E.isArray((G))){G=[G];I=[I];}if(I.length!==G.length){throw new Error("comb and color number mismatch");}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel,J=mstrmojo.VisUtility.getUpdateColorMapAction.bind(this),H=I.map(function(M,K){return J(M,JSON.stringify({color:G[K]}));});this.submitUpdatesAndPersistXML(H,F.getUpdateColorMapCallback(),false,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.VisUtility","mstrmojo.gmaps.MapEnums","mstrmojo.chart.enums.EnumFontStyle");var B=mstrmojo,A=B.color,C=B.VisUtility,G=B.gmaps.EnumDataLabel,F=B.chart.enums.EnumFontStyle;function E(M){var K,J,I=M[G.DATA_LABEL_FONT_STYLE],H={isCenterAlign:true,fontFamily:M[G.DATA_LABEL_FONT_FAMILY],fontSize:M[G.DATA_LABEL_FONT_SIZE]};if(I&F.FS_BOLD){H.fontWeight="bold";}else{H.fontWeight="normal";}if(I&F.FS_ITALIC){H.fontStyle="italic";}else{H.fontStyle="normal";}if((I&F.FS_STRIKETHROUGH)&&(I&F.FS_UNDERLINE)){K="line-through underline";}else{if(I&F.FS_STRIKETHROUGH){K="line-through";}else{if(I&F.FS_UNDERLINE){K="underline";}else{K="none";}}}H.dlFntHaloClr=M.dlFntHaloClr;H.textDecoration=K;J=M[G.DATA_LABEL_FONT_COLOR];H.fillColor=J==="transparent"?"rgba(0,0,0,0)":A.decodeColor(J);return H;}mstrmojo.gmaps._MapDataLabel=mstrmojo.provide("mstrmojo.gmaps._MapDataLabel",{_mixinName:"mstrmojo.gmaps._MapDataLabel",getLabelConfig:function D(){var I=this.layerProps,H=this.supportDataLabel(),J=E(I);if(H){return{showAllDataLabel:I[G.DATA_LABEL_SHOW_ALL],dlShowOption:I[G.DATA_LABEL_SHOW],dlFontStyle:J,dlFontHeight:C.measureTextHeight("Style",J)};}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.array","mstrmojo.dom","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.color","mstrmojo.VisUtility");var c=mstrmojo,d=c.array,M=c.dom,K=c.gmaps,C=K.MapUtils,V=K.MarkerAlignOption,N=K.EnumGeometryType,T=K.EnumDefaultShapeFormatStyle,Y=c.emptyFn,W=6378137,J=c.color,O=c.VisUtility;mstrmojo.gmaps.geometry.Geometry=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gmaps.geometry.Geometry",type:null,node:null,useSvg:true,nodeTag:null,defaultClass:"mstrMap-geometry",defaultFillColor:T.FILL_COLOR,fillColor:null,fillOpacity:T.FILL_OPACITY_VALUE,strokeColor:T.BORDER_COLOR,strokeWidth:T.BORDER_WIDTH,strokeOpacity:0.8,strokeDashArray:null,visibility:null,currentFillOpacity:null,_isSelected:false,_isHover:false,strokeScale:2,mXMLNS:"http://www.w3.org/2000/svg",init:function m(q){this._super(q);this.fillColor=this.fillColor||this.defaultFillColor;this.currentFillOpacity=this.fillOpacity;this.node=this.createNode(this.nodeTag);this.initNodeStyles();this._addEventListeners();this.update(q);},_addEventListeners:function D(){var q=this.getNode();if(q){M.attachEvent(q,"mousedown",this.handleMouseDownEvt.bind(this));}},_removeEventListeners:function B(){var q=this.getNode();if(q){M.detachEvent(q,"mousedown",this.handleMouseDownEvt);}},handleMouseDownEvt:function o(q){if(q){q.preventDefault();}},createNode:function p(q){return(this.useSvg!==true)?C.createNormalNode(q):C.createSvgNode(q);},initNodeStyles:function a(){C.setNodeAttributes(this.node,{"class":this.defaultClass,fill:this.fillColor,"fill-opacity":this.fillOpacity,visibility:this.visibility});this.setStrokeStyles();},setStrokeStyles:function P(){if(!!this.skipStrokeProperty){return ;}C.setNodeAttributes(this.node,{stroke:this.strokeColor,"stroke-width":this.strokeWidth,"stroke-opacity":this.strokeOpacity,"stroke-dasharray":this.strokeDashArray});},setStrokeColor:function U(q){if(!this.skipStrokeProperty){C.setNodeAttributes(this.node,{stroke:q});}this.strokeColor=q;},setStrokeWidthAndStyle:function e(s,r,q){if(!this.skipStrokeProperty){C.setNodeAttributes(this.node,{"stroke-width":s,"stroke-style":r,"stroke-dasharray":q});}this.strokeWidth=s;this.strokeStyle=r;this.strokeDashArray=q;},setFillColor:function X(q){C.setNodeAttributes(this.node,{fill:q});this.fillColor=q;},setFillOpacity:function i(q){C.setNodeAttributes(this.node,{"fill-opacity":q});this.fillOpacity=q;this.currentFillOpacity=this.fillOpacity;},setVisibility:function S(q){C.setNodeAttributes(this.node,{visibility:q});this.visibility=q;},setSelection:function f(q){var u=(q!==true)?this.strokeWidth:(this.strokeWidth*this.strokeScale),t=(q!==true)?this.strokeColor:"#000000",r=this.node,s;if(!r){return ;}this.currentFillOpacity=(q!==true)?this.fillOpacity:1;s={"stroke-width":u,"fill-opacity":this.currentFillOpacity,fill:this.fillColor};if(C.checkDefined(O.getPropertyByPath(this,"node.attributes.stroke",undefined))){s.stroke=t;}C.setNodeAttributes(this.node,s);},setUnSelection:function g(){var t=this.strokeWidth,s=this.strokeColor,q=this.node,r;if(!q){return ;}this.currentFillOpacity=this.fillOpacity*0.5;r={"stroke-width":t,"fill-opacity":this.currentFillOpacity,fill:this.fillColor};if(C.checkDefined(O.getPropertyByPath(this,"node.attributes.stroke",undefined))){r.stroke=s;}C.setNodeAttributes(this.node,r);},setContextMenuSelection:function n(q,s){var u,t,r;if(s){t=this.fillColorAjustForCMSelection(s);this.currentFillOpacity=1;u=(q!==true)?this.strokeWidth:(this.strokeWidth*this.strokeScale);r={fill:t,"stroke-width":u,"fill-opacity":this.currentFillOpacity};if(C.checkDefined(O.getPropertyByPath(this,"node.attributes.stroke",undefined))){if(q){r.stroke="#000000";}else{r.stroke=this.fillColor;}}C.setNodeAttributes(this.node,r);}else{this.setSelection(q);}},fillColorAjustForCMSelection:function E(x){var v,z,r,q,t,u,s,w,y=this.fillColor;if(x){if(y.length===7){v=parseInt(y.substring(1,3),16);z=parseInt(y.substring(3,5),16);r=parseInt(y.substring(5,7),16);}else{if(y.length===4){v=parseInt(y.substring(1,2)+y.substring(1,2),16);z=parseInt(y.substring(2,3)+y.substring(2,3),16);r=parseInt(y.substring(3,4)+y.substring(3,4),16);}else{return y;}}q=J.rgb2hsv(v,z,r);q[1]=q[1]*0.5;q[2]=parseInt(q[2]*1.2>100?100:q[2]*1.2,10);t=J.hsv2rgb(q[0],q[1],q[2]);v=parseInt(t[0],10);z=parseInt(t[1],10);r=parseInt(t[2],10);u=v<16?"0"+v.toString(16):v.toString(16);s=z<16?"0"+z.toString(16):z.toString(16);w=r<16?"0"+r.toString(16):r.toString(16);y="#"+u+s+w;}return y;},setHover:function G(r){var q=(r!==true)?this.currentFillOpacity:(this.currentFillOpacity*0.5);C.setNodeAttributes(this.node,{"fill-opacity":q});},intersect:function Z(t,r){var s=t&&t.type,q=false;switch(s){case N.Point:q=this.contains(t,r);break;case N.Extent:q=this.intersectExtent(t);break;case N.Polygon:q=this.intersectPolygon(t,r);break;default:break;}return q;},coolWPDistance:function A(s,AH,q,AG){if(!C.checkVal(s)||!C.checkVal(AH)||!C.checkVal(q)||!C.checkVal(AG)){return ;}var t,AF,y,z,AE,v,u,AC=this._getRad((s+q)/2),AB=this._getRad((s-q)/2),AA=this._getRad((AH-AG)/2),AJ=Math.sin(AC),AI=Math.sin(AB),AD=Math.sin(AA),x=1/298.257;AI=AI*AI;AD=AD*AD;AJ=AJ*AJ;t=AI*(1-AD)+(1-AJ)*AD;AF=(1-AI)*(1-AD)+AJ*AD;y=Math.atan(Math.sqrt(t/AF));z=Math.sqrt(t*AF)/y;AE=2*y*W;v=(3*z-1)/2/AF;u=(3*z+1)/2/t;t=AE*(1+x*(v*AJ*(1-AI)-u*(1-AJ)*AI));t/=1000;return t;},_getRad:function I(q){if(C.checkVal(q)){return q*Math.PI/180;}},getGeometrySize:function h(){if(C.checkVal(this.width)&&C.checkVal(this.height)){return{width:this.width,height:this.height};}else{return null;}},getGeometryAlignOption:function R(){return V.CENTER;},getNode:function F(){return this.node;},getPercentage:function k(){return"100%";},isSelected:function l(){return this._isSelected;},containVertexInPolylineArr:function H(r){var q=false;d.forEach(r,function(s){q=this.containVertexInPolyline(s);if(q===true){return false;}},this);return q;},containVertexInPolyline:function Q(r){var q=false;d.forEach(r,function(s){q=this.contains(s);if(q===true){return false;}},this);return q;},update:function b(q){this.loadProps(q);},loadProps:Y,getScreenExtent:Y,contains:Y,intersectExtent:Y,intersectPolygon:Y,destroy:function j(){C.destroyNode(this.node);delete this.node;if(this.geoExtent&&this.geoExtent.destroy instanceof Function){this.geoExtent.destroy();}this.geoExtent=null;this._removeEventListeners();}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.vi.viz.MapHelper");var g=mstrmojo,J=g.dom,b=g.hash,W=g.array,O=g.gmaps,T=O.MapUtils,a=g.vi.viz.MapHelper,h=O.EnumThresholdType,N=O.EnumBaseMapType;var j=["table","tr","th","td"],C=["class","style"];var X=mstrmojo.desc(14141,"Percent Contribution");function S(){var s=this.getDataRows(),t=s&&s.length,p=[],m,w,r,k,l,o,v={},q,n,u=function(y){var x=false;k=y.fs;if(!k){return true;}for(o=0;o<k.length;o++){l=k[o];if(!a.isLatitude(l.fnm,l.fgr)&&!a.isLongitude(l.fnm,l.fgr)){x=true;}}if((a.isLatitude(y.n)||a.isLongitude(y.n))&&k.length===1){x=false;}return x;};for(r=0;r<t;r++){m=s[r];w=m&&m.id;if(!v[w]){v[w]=[];}v[w].push(m);}for(w in v){q=v[w];n=false;for(r=0;r<q.length;r++){m=q[r];if(u(m)){n=true;}else{m.isLatLng=true;}}q.hasExtraForm=n;}for(r=0;r<t;r++){m=s[r];w=m&&m.id;q=v[w];if(q.hasExtraForm&&m.isLatLng){p.push(r);}}return p;}function P(l,o){var n=false,m,k;if(!(o instanceof Array)){return false;}if(l<0){return false;}for(m=0,k=o.length;m<k;m++){if(l===o[m]){n=true;break;}}return n;}function Z(k){return(!!k&&(k.toLowerCase().indexOf("latitude")>-1||k.toLowerCase().indexOf("longitude")>-1));}function f(){var k=this.sliceEnabled;if(!!k&&k instanceof Function){return k.call(this);}return false;}function e(){var k=this.map;return k&&k.scriptClass==="mstrmojo.mapbox.VisMapbox";}mstrmojo.gmaps.layer._InfoWindowHelper=mstrmojo.provide("mstrmojo.gmaps.layer._InfoWindowHelper",{_mixinName:"mstrmojo.gmaps.layer._InfoWindowHelper",showTooltip:function H(l,q){var m=this.getTooltipWin(),k=m&&m.domNode,o=this.getTooltipContent(l),p=this.dropZones&&this.dropZones.tooltips,n=function(){return e.call(this)&&(!p||p.length===0);};if(!k||!T.checkDefined(o)||n.call(this)||!q||!T.checkVal(q.x)||!T.checkVal(q.y)){return ;}if(!k.parentNode){document.body.appendChild(k);}if(T.isExpress()){k.innerHTML=o;m.moveTo(q.x,q.y);m.toggle(true);}else{m.showDossierTtp(o,q);}},hideTooltip:function M(){var k=this.parent;if(k){k.hideTooltip();}},getTooltipWin:function K(){return this.parent&&this.parent.tooltipWin;},getTooltipContent:function i(l){var m=this.getGraphicsDataRowIndices(l)||[],r,k,q,o,p,n;if(!l){return ;}if(l[0]&&m.length===1){r=f.call(this);k=l[0].attributes;if(k&&r){q=l[0].geometry;if(q&&q.getPercentage instanceof Function){o=q.getPercentage();p=T.replaceSpace(X);k=b.copy(k,{});k[p]=o;}}if(T.isExpress()){n=this.generateSimpleInfoDOM(k);}else{n=this.generateSimpleInfoObj(k);}}else{if(m.length>1){if(T.isExpress()){n=this.generateGridInfoDOM(m,l[0]&&l[0].attributes.columnIndices);}else{n=this.generateGridInfoObj(m,l[0]&&l[0].attributes.columnIndices);}}}return n;},prepareDivs:function F(){var l=this.createEmptyGridInfoWindowTable(),m=this.createInfoTabDivCSSStyle(),k=document.createElement("div");k.id="infoDiv";k.style.paddingTop="3px";k.style.overflow="auto";k.appendChild(l);if(T.checkDefined(m)){k.appendChild(m);}this.infoTabDiv=k;},createEmptyGridInfoWindowTable:function d(){var l=document.createElement("table"),k=document.createElement("tHead"),m=document.createElement("tBody");l.className="gridInfoWindowTable";l.setAttribute("cellspacing","0");l.setAttribute("cellpadding","2");l.appendChild(k);l.appendChild(m);return l;},createInfoTabDivCSSStyle:function R(){var o=null,k=this.getData(),n=k.cssString,l;if(n!==undefined){o=document.createElement("style");o.type="text/css";l=o.styleSheet||o;if(J.isWK){if(l.firstChild){l.firstChild.nodeValue=n;}else{l.appendChild(document.createTextNode(n));}}else{l[J.isIE?"cssText":"innerHTML"]=n;}}return o;},parseCustomInfoWinTplHTML:function V(t){var AA="",u=0,w=t.indexOf("${",u),q=t.indexOf("}",w+1),x={},z=this.getDataRows(),r=this.getDataCols(),l,y,k,v,n,p,s,m,o;if(!z||!r){return ;}for(p=0,s=z.length;p<s;p++){y=z[p];x[y.id+"|"+y.fid]=y.n;}for(p=0,s=r.length;p<s;p++){k=r[p];if(k.otp===-1){v=k.es;for(m=0,o=v.length;m<o;m++){n=v[m];x[n.id]=n.n;}break;}}while(w>=0&&q>w){l=t.substring(w+2,q);if(x.hasOwnProperty(l)){AA+=t.substring(u,w+2)+x[l];}else{AA+=t.substring(u,q);}u=q;w=t.indexOf("${",u);q=t.indexOf("}",w+1);}AA+=t.substring(u);return T.removeHTMLTagsAndProps(AA,j,C);},getDefaultInfoTplHTML:function B(AG,v,y){if(!AG||!v){return"";}var o='<table class="nonGridInfoWindow">',AB=this.tooltipContentObj=[],m=this.getDataRowHeaders(),x=this.getDataRows(),u=this.getDataCols(),s=this.showMetric(),t=[],AE=W.ensureArray(v&&v.tooltips),n,w,p,AD,r,AF,l,AA,q,AH,AC;if(!W.isArray(m)||!m[0]||!W.isArray((x))){return"";}this.extraLatLnFormIndices=S.call(this);n=m[0].items;if(!W.isArray(n)){return"";}r=n.length;q=e.call(this)?true:(s||y.length!==r||this.getBaseMapType()===N.Image);AF=x.length;for(AD=0;AD<r&&q;AD++){if(this._canSkipItem(v,AD,y)){t[AD]=true;}}for(AD=r-1;AD>=0;AD--){if(!t[AD]){break;}}l=AD;for(AD=0;AD<r;AD++){if(t[AD]){continue;}if(!s&&(AD===l)){o+='<tr class="lastRow">';}else{o+="<tr>";}w=n[AD];AA=AF<r?w.tui:AD;p=x[AA].n;AH=this.getAttributeName(AA);AC=T.replaceSpace(p);o+="<th>"+AH+":</th><td> ${"+AC+"}</td>";o+="</tr>";AB.push({n:AH,v:T.replaceSpace(AC)});}if(s){var z=false;if(typeof this.sliceEnabled==="function"){z=this.sliceEnabled();}n=u[0].es;r=n.length;for(AD=0;AD<r;AD++){if(this._canSkipMetricItem(v,AD)){continue;}o+=((AD<r-1)||z)?"<tr>":'<tr class="lastRow">';p=n[AD].n;AC=T.replaceSpace(p);o+="<th>"+p+":</th><td>${"+AC+"}</td>";o+="</tr>";AB.push({n:p,v:AC});}if(z){o+='<tr class="lastRow">';AC=T.replaceSpace(X);o+="<th>"+X+":</th><td>${"+AC+"}</td>";o+="</tr>";AB.push({n:X,v:AC});}}o+="</table>";return o;},_canSkipItem:function c(m,w,y){var r=this.getDataRows(),u=r.length,l=m.tooltips,n=r[w].id,k=this.getDataRowHeaders(),p=k&&k[0].items,s=p.length,t=p[w],v=u<s?r[t.tui].n:r[w].n,q=this.getBaseMapType(),x=e.call(this),o=!l||mstrmojo.array.indexOf(l,n)<0;if(x&&((P(w,this.extraLatLnFormIndices))||o)){return true;}if(o){if((q===N.Image||!!m.geoAttribute)&&(P(w,y)||Z(v))){return true;}}return false;},_canSkipMetricItem:function E(l,k){var o=this.getDataCols(),m=l.tooltips,n=o&&o[0]&&o[0].es,p=n&&n[k]&&n[k].oid;if(e.call(this)&&(!m||mstrmojo.array.indexOf(m,p)<0)){return true;}return false;},generateSimpleInfoDOM:function I(l){if(!this.infoTemplate){return ;}var o=this.infoTemplate.content,s="",p=0,r=o.indexOf("${",p),m=o.indexOf("}",r+1),k,q;while(r>=0&&m>r){k=o.substring(r+2,m);var n=k.indexOf(":");if(n>=0){q=k.substring(0,n)+" "+k.substring(n+1);}else{q=k;}q=T.replaceSpace(q);if(l.hasOwnProperty(q)){s+=o.substring(p,r)+l[q];}else{if(l.hasOwnProperty(k)){s+=o.substring(p,r)+l[k];}else{s+=o.substring(p,m+1);}}p=m+1;r=o.indexOf("${",p);m=o.indexOf("}",r+1);}s+=o.substring(p,o.length);return s!==o?s:null;},generateSimpleInfoObj:function G(m){var r=this.tooltipContentObj,l=[],o=[],p=(r&&r.length)||0,n,u,k,t,s;for(n=0;n<p;n++){u=r[n];k=u.n;t=u.v;var q=t.indexOf(":");if(q>=0){s=t.substring(0,q)+" "+t.substring(q+1);}else{s=t;}s=T.replaceSpace(s);if(m.hasOwnProperty(s)){t=m[s];}else{if(m.hasOwnProperty(t)){t=m[t];}}if(o.indexOf(k)===-1){l.push({n:k,v:t});o.push(k);}else{l[l.length-1].v=l[l.length-1].v+" "+t;}}return l;},generateGridInfoDOM:function D(r,t){if(!this.infoTabDiv){this.prepareDivs();}var s=this,l=this.infoTabDiv,u=l.childNodes[0],o=this.data,v=this.getDataRows(),n=this.getDataRowHeaders(),m=this.getDataColHeaders(),q=n&&n.length>0?n[0].items.length:0,k=function(AH){var AA=AH.tHead,z=false,AC,AB,AF,AE,y,AG,x,AD,w;if(!AA){return z;}while(AA.rows.length>0){AA.deleteRow(AA.rows.length-1);}AB=AA.insertRow(AA.rows.length);AC=m&&m.length>0?m[0].items.length:0;for(x=0;x<q;x++){if(s._canSkipItem(s.dropZones,x,t)){continue;}w=AB.insertCell(AB.cells.length);AF=document.createElement("span");AF.innerHTML=s.getAttributeName(x);w.appendChild(AF);z=true;}for(x=0;x<AC;x++){w=AB.insertCell(AB.cells.length);AE=m[0].items[x];AG=AE.tui;AD=AE.idx;y=o.gts.col[AG].es[AD];AF=document.createElement("span");AF.innerHTML=y.n;w.appendChild(AF);z=true;}return z;},p=function(AO){var w=AO.tBodies[0],AA=r.length,AG=o.gvs.items,AR=!!AG?AG[0].items.length:0,AJ,AF,AK,z,x,AC,AI,AE,AB,y,AN,AM,AL,AD,AH;for(AN=0;AN<AA;AN++){AE=r[AN];x=w.insertRow(w.rows.length);AB=n[AE].items;for(AM=0;AM<q;AM++){if(s._canSkipItem(s.dropZones,AM,t)){continue;}y=AB[AM];if(!y||y.idx<0){AD=x.insertCell(x.cells.length);AD.innerHTML=" ";continue;}AH=y.idx;AD=x.insertCell(x.cells.length);AJ=v[AM].es[AH].n;AD.innerHTML="    "+AJ+"    ";}for(AL=0;AL<AR;AL++){AF=AG[AE].items[AL];AK=AF&&AF.v;z=AF&&AF.rv;AC=s.getThresholdInfo(AE,AL);AI=AC&&AC.type;if(!z&&!AK){continue;}AD=x.insertCell(x.cells.length);if(AI===h.Url||AI===h.Text){AD.innerHTML="    "+z+"    ";}else{AD.innerHTML="    "+AK+"    ";}}}var AQ,AP=[];for(AN=0;AN<w.rows.length;AN++){AQ=w.rows[AN].innerText;if(AP.indexOf(AQ)>-1){w.rows[AN].remove();AN--;}else{AP.push(AQ);}}};while(!!u&&u.rows.length>0){u.deleteRow(u.rows.length-1);}if(!k(u)){return null;}p(u);return l.innerHTML;},generateGridInfoObj:function A(s,v){var u=this,l={header:[],body:[],attrCount:0},p=this.data,o=this.dropZones,w=this.getDataRows(),n=this.getDataRowHeaders(),m=this.getDataColHeaders(),r=n&&n.length>0?n[0].items.length:0,t=m&&m.length>0?m[0].items.length:0,k=function(){var AD=l.header,AB=false,AC=[],y,AE,AA,z,x;for(z=0;z<r;z++){if(u._canSkipItem(o,z,v)){continue;}if(AC.indexOf(w[z].id)===-1){AD.push(u.getAttributeName(z));AC.push(w[z].id);}AB=true;}l.attrCount=AD.length;for(z=0;z<t;z++){if(u._canSkipMetricItem(o,z)){continue;}y=m[0].items[z];AA=y.tui;x=y.idx;AE=p.gts.col[AA].es[x];AD.push(AE.n);AB=true;}return AB;},q=function(){var AP=l.body,z=s.length,AF=p.gvs.items,AO=AF&&AF.length>0?AF[0].items.length:0,AE,AI,y,AC,AB,AH,AD,AA,x,AL,AK,AJ,AG,AM;for(AL=0;AL<z;AL++){AC=[];AP.push(AC);AD=s[AL];AA=n[AD].items;AM=[];for(AK=0;AK<r;AK++){if(u._canSkipItem(o,AK,v)){continue;}x=AA[AK];if(!x||x.idx<0){AC.push("");continue;}AG=x.idx;if(AM.indexOf(w[AK].id)===-1){AC.push(w[AK].es[AG].n);AM.push(w[AK].id);}else{AC[AC.length-1]=AC[AC.length-1]+" "+w[AK].es[AG].n;}}for(AJ=0;AJ<AO;AJ++){if(u._canSkipMetricItem(o,AJ)){continue;}AE=AF[AD].items[AJ];AI=AE&&AE.v;y=AE&&AE.rv;AB=u.getThresholdInfo(AD,AJ);AH=AB&&AB.type;if(!y&&!AI){continue;}AC.push(AI);}}var AN;AM=[];for(AL=0;AL<AP.length;AL++){AN=AP[AL].toString();if(AM.indexOf(AN)>-1){AP.splice(AL,1);AL--;}else{AM.push(AN);}}};if(!k()){return l;}q();return l;},getInfoWindowHTML:function U(){if(this.infoTemplate&&this.infoTemplate.content){return this.infoTemplate.content;}else{return"";}},setInfoWindowHTML:function Y(k){this.infoTemplate.content=this.customInfoTemplateHTML=T.removeHTMLTagsAndProps(k,j,C);},replaceInfoWindowHTMLMacros:function Q(u){var s="",w=0,n=u.indexOf("${",w),k=u.indexOf("}",n+1),l={},q=this.getDataRows(),t=this.getDataCols(),m,p,o,AB,v,z,r,y,AA;for(z=0,r=q.length;z<r;z++){p=q[z];l[T.replaceSpace(p.n)]=p.id+"|"+p.fid;}for(z=0,r=t.length;z<r;z++){o=t[z];if(o.otp===-1){AB=o.es;for(y=0,AA=AB.length;y<AA;y++){v=AB[y];l[T.replaceSpace(v.n)]=v.id;}break;}}while(n>=0&&k>n){m=u.substring(n+2,k);var x=m.indexOf(":");if(x>=0){m=m.substring(0,x)+" "+m.substring(x+1);}m=T.replaceSpace(m);if(l.hasOwnProperty(m)){s+=u.substring(w,n+2)+l[m];}else{s+=u.substring(w,k);}w=k;n=u.indexOf("${",w);k=u.indexOf("}",n+1);}s+=u.substring(w);return s;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.vi.ui.rw._HasVisSelections");var c=mstrmojo,Y=c.array,V=c.hash,D=c.gmaps.MapUtils,K=mstrmojo.vi.ui.rw.SelectionType;var B="OA:(All)";var J=2;function T(){var v=this.getLayerModel(),y=v.getRowTitles(),w,u,s=y.size(),t={},x;if(s>0){for(u=0;u<s;u++){x=y.getTitle(u);w=x.getUnitId();t[w]=u;}}return t;}function W(w,v,s,u){var y,t,x=!!w?w.length:0;for(t=0;t<x;t++){y=w[t];if(!v[y.id]&&a.call(this,y,s,u)){return y;}}return null;}function a(s,t,z){var AA,u,x,AB,v=this.getLayerModel(),AC,y,w;if(!s){return false;}u=s.getDataRowIndices();AB=(u&&u.length)||0;for(x=0;x<AB;x++){AA=u[x];AC=v.getRowHeaders(AA);y=AC.getHeader(z);if(y){w=y.getElementId();if(this.model.compareElementsId(w,t)){return true;}}}return false;}function n(AF,v,x,AD){var t,y,w,u,AE,z,s,AC,AA=!!AF?AF.length:0,AB=x&&x.length;for(y=0;y<AA;y++){t=AF[y];if(t&&!v[t.id]){for(w=0;w<AB;w++){u=x[w];z=u.id;AC=u.columnIndex;AE=AD[z]&&AD[z][0];s=AE&&AE.id;if(!a.call(this,t,s,AC)){break;}}if(w===AB){v[t.id]=t;return ;}}}}function P(t){var x=t[V.keyarray(t)[0]],v=V.keyarray(x),AA={},u=[],s=this.getAllGraphicsForHighlight(),z=this.getCommonAttributes(v),w,y;if(!z||z.length===0){return u;}for(w in t){if(t.hasOwnProperty(w)){n.call(this,s,AA,z,t[w]);}}for(y in AA){u.push(AA[y]);}return u;}function X(AI){var y,AC,AE,AB,u,AA,z,v,w=this.getAllGraphicsForHighlight(),s=T.call(this),AH,t={},AD=[],AG,AF,AJ,x;for(y in AI){if(AI.hasOwnProperty(y)){AC=AI[y];for(AE in AC){x=this.model.getLinkedAttributes(AE)||[];x=[AE].concat(x);if(AC.hasOwnProperty(AE)){AB=AC[AE];AA=AB.length;for(AG=0;AG<AA;AG++){u=AB[AG];z=u.id;for(AF=0;AF<x.length;AF++){if(s.hasOwnProperty(x[AF])){AH=s[x[AF]];v=W.call(this,w,t,z,AH);if(!!v&&!t[v.id]){t[v.id]=v;}break;}}}}}}}for(AJ in t){AD.push(t[AJ]);}return AD;}function d(u){var s={type:mstrmojo.vi.ui.rw.SelectionType.ATTS,data:u},t=function(v,w){if(parseInt(v.fn,10)===22&&parseInt(w,10)===19){s.type=mstrmojo.vi.ui.rw.SelectionType.METRICS;}Y.forEach((v.nds||[]),function(x){t(x,v.fn);});};t(u,null);return s;}function N(u){var w=u.tks;if(u&&w){var t=mstrApp.docModel,s=w.split("\u001E");var v=[];Y.forEach(s,function(z){var y=t.getTargetDefn(z),x=y[z];if(x&&x.ifw){v.push(z);}});return v;}}function g(AB){var AC=this,AE=AC.selectedGraphics,AF=AE.length,u=AE[0]||AC.graphics[0];if(!u){return ;}if(u.parentGraphic){u=u.parentGraphic;}var v="\x1e",AD=u.attributes,s=AD.columnIndices,AH=u.parent.data.gts.row,AA=AH[s[AB]],t=AA&&AA.sc;if(t&&t.tks){var w=t.tks,z=t.ck,AG=t.ckey,y=[];Y.forEach(AE,function(AL){var AI=AL.attributes,AK=AH[AI.columnIndices[AB]];if(AK.did===AA.did){var AJ=AI.geoIndices;if(AJ){Y.forEach(AJ,function(AM){y.push(AK.es[AM].id);});}else{y.push(AK.es[AI.geoIndex].id);}}});if(mstrApp.docModel&&AF>0){var x=N(t);V.forEach(x,function(AI){mstrApp.docModel.showInfoWin(AI,AE[AF-1].geometry.node);});}if(D.isExpress()){return{key:AC.key+AG,type:mstrmojo.EnumRWUnitType.GRID,ck:z,ctlKey:AG,tks:w,suppressIW:true,eid:y.length===0?B:y.join(v)};}else{if(this.isViewerSliceable()){return microstrategy.updateManager.createActionObject(null,mstrUpdateManager.SET_CUR_CTL_ELEMENTS,this.map.getMapConfig().common.beanPath,["2048130","2048127","2048137","2048138","2048018"],[AG,y,z,"1","false"],[]);}}}}mstrmojo.gmaps.layer._GraphicLayerDataSelectionHelper=mstrmojo.provide("mstrmojo.gmaps.layer._GraphicLayerDataSelectionHelper",{highlightFromViSelection:function S(){if(this.highlight&&this.highlight instanceof Function){this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}},initViSelectionFromScExp:function f(){this._super&&this._super();var s=mstrApp.isInVFConfigMode?null:this.findSelectorControl();if(s&&!V.isEmpty(s.exp)&&this.addSelectionsFromExpression){this.addSelectionsFromExpression(d(s.exp));}if(this.isInFilterPanel()){this.update();}},showData:function(){var t=this.map,s=this.getXtab();if(!t.gridData){t.gridData=s&&s.getData();}mstrmojo.vi.ui.ViewDataDialog.open(t.parent,true);},getAssociatedNodes:function A(){var u=this.getXtab(),t=u&&u.node,s=t&&t.defn&&t.defn.an;return s&&s.length>0?s:[];},isVisFilterSource:function Z(){var s=this.getAssociatedNodes();return s&&s.length>0;},canDoMultiSelect:function i(){var s=this.getGeoColumnAttribute();return this.supportsViewFilterActions(s);},getZoneModelByZoneId:function h(s){var t=this.getDropZonesInZoneModel(),u=undefined;Y.forEach(t,function(v){if(v.id===s){u=v;return false;}});return u;},getDropZonesInZoneModel:function e(){var u=this.map,v=u.zonesModel,t=this.key,s=null;if(v&&t){s=v.getDropZones(true,t).zones||[];}return s;},getItemInZoneModel:function p(x){var u=this.map,w=u.zonesModel,t=this.key,s=null,v=this.data&&this.data.gsi;if(w&&t){(w.getDropZones(true,t).zones||[]).some(function(y){return !!y.items.some(function(z){if(z.did===x){s=z;return true;}});});}else{if(v){Y.forEach((v.cols||[]).concat(v.rows||[]),function(y){if(y.did===x){s=y;return false;}});}}return s;},supportsViewFilterActions:function Q(w){var t=this.getItemInZoneModel(w),u=function(x){return x.de;},v=function(x){return x.t===1||x.t===47;},s=function(x){return x.t===47&&x.st===12033;};return t&&(!u(t)&&!v(t)||s(t));},getSelectedObjectMetricInfo:function q(z,s){var t,v,u={},x=this.getObjInfo(z,s),y=x.length,w;for(t=0;t<y;t++){v=x[t];w=v.v;if(u[v.tid]&&u[v.tid][0]&&u[v.tid][0].n){w=u[v.tid][0].n+":"+v.v;}u[v.tid]=[{id:v.eid,n:w}];}return u;},getObjInfo:function C(z,AA){var AH=this.getLayerModel(),AL=AH&&AH.getRowTitles(),AG=this.getAttrFormIndices(AA),u,AB,w=AG.length,s,AJ,AD,y,x,t,AF,AI,AE,v,AK,AC;AD=AH.getRowHeaders(z);s=AD.size();AJ=[];for(x=0;x<w;x++){u=AG[x];AB=u.length;AI=AL.getTitle(x);AE=AI.getName();v=AI.getUnitId();for(AF=0;AF<AB;AF++){t=u[AF];if(t<s){y=AD.getHeader(t);if(y.t&&y.h.stt===1){return[];}AK=y.getName();AC=y.getElementId();AJ.push({n:AE,tid:v,v:AK,eid:AC});}}}return AJ;},getGeoColumnAttribute:function k(){var t=this.getGeoColumnIndex(),s=this.getLayerModel(),u;u=s.getRowTitles().getTitle(t);if(!!u){return u.getUnitId();}return null;},getCommonAttributes:function M(y){var s=[],w,u,t=T.call(this),v=!!y?y.length:0,x,z;for(w=0;w<v;w++){x=y[w];z=this.model.getLinkedAttributes(x)||[];z=[x].concat(z);for(u=0;u<z.length;u++){if(t.hasOwnProperty(z[u])){s.push({id:x,columnIndex:t[z[u]]});break;}}}return s;},addVisSelection:function E(t){if(!D.isOIVM()){return ;}var w,s,u,v;t=Y.ensureArray(t);s=t.length;for(u=0;u<s;u++){w=t[u];v=this.getSelectedObjectMetricInfo(w);if(Object.keys(v).length>0){this.addMetricValueSelection(v);}}this.addRowIndicesSelection(t);},addVisContextMenuSelection:function U(t){if(!D.isOIVM()){return ;}var w,s,u,v;t=Y.ensureArray(t);s=t.length;for(u=0;u<s;u++){w=t[u];v=this.getSelectedObjectMetricInfo(w,true);if(Object.keys(v).length>0){this.addContextMenuMetricValueSelection(v);}}},removeVisSelection:function j(u){if(!D.isOIVM()){return ;}var y,t,w,x,s=this.getGeoColumnIndex(),v;u=Y.ensureArray(u);t=u.length;for(w=0;w<t;w++){y=u[w];if(this.getSelectionType()===K.ATTS){x=this.getObjInfo(y);v=x[s];if(v){this.removeAttributeSelection(v.tid,v.eid);}}else{if(this.getSelectionType()===K.METRICS){x=this.getSelectedObjectMetricInfo(y);if(Object.keys(x).length>0){this.removeMetricValueSelection(x);}this.removeSelectedGraphicInfo(y);}}}},isClearAllDisabled:function G(){var s=this.findSelectorControl();return !!s&&!s.showall;},clearSelections:function b(){if(D.isOIVM()){if(this._super){this._super();}}},clearCxtMnuSelection:function l(){if(this._super){this._super();}},getAttrFormIndices:function F(y){var AB=this,AC=AB.getLayerModel(),AA=AC.getRowTitles(),w,v,u=0,t=[],s=AA.size(),x=function(AM){var AJ=AB.data,AF=AJ&&AJ.dz,AH=AF&&AF.AdditionalMetrics,AL=Y.ensureArray(AH&&AH.TemplateUnit),AI=Y.map(["Geo","Lat","Long","ColorBy","SliceBy"],function(AN){return Y.ensureArray(AF&&AF[AN]&&AF[AN].TemplateUnit);}),AG=false,AK=Y.difference.apply(this,[AL].concat(AI).concat("id"));Y.forEach(AK,function(AN){if(AM===AN.id){AG=true;return false;}});return AG;};if(s>0){var AE=0;for(w=0;w<s;w++){var AD=AA.getTitle(w),z=AD.getForms();t.push([]);if(z){for(v=0;v<z.length;v++){t[u].push(AE++);}}else{AE++;}if(!y&&x(AD.getUnitId())){t[u]=[];}u++;}}else{t=null;}this.attributeFormIndices=t;return t;},isUseAsFilter:function H(){var v=this.map,u=v.fnGetWidget(this.key),t=u&&u.node,s=t&&t.defn&&t.defn.an;return !!s&&s.length>0;},deleteSelectorControl:function O(){var t=this.map,s=t.getGridData(this.key),u=s&&s.sc;if(u&&parseInt(u.ct,10)===6){delete s.sc;}},findSelectorControl:function I(){var u=this.map,t=u.getGridData(this.key),s=t&&t.sc;if(s&&parseInt(s.ct,10)===6){this.selectorControl=s;this.isMultiSelect=true;}else{delete this.selectorControl;}return this.selectorControl;},highlight:function o(s,w,v){if(this._super){this._super.apply(this,arguments);}var u,t=this._viewer;if(!v){this.clearSelections();}if(s==="empty"||V.isEmpty(w)){this.initViSelectionFromScExp();s=this.getSelectionType();w=this.getSelectionHash();}if(s===K.METRICS){u=P.call(this,w);}else{if(s===K.ATTS){u=X.call(this,w);}}Y.forEach(u,function(x){this.addToSelectedGraphics(x);},this);if(t){t.highlightGraphics(u);}},isViewerSliceable:function m(){var t=this.getGeoColumnIndex(),u=this.data.ghs.rhs.items[0].items[t],s;if(!!u){s=u.at;if(s===undefined||isNaN(s)){return false;}if((s&J)>0){return true;}}return false;},addTemplateUnitSelection:function r(y){var z=this.selectedGraphics[0]||this.graphics[0];if(!z){return ;}if(z.parentGraphic){z=z.parentGraphic;}var t=z.attributes,v=t.columnIndices,x=z.parent.data.gts.row,w=x[v[0]],s=x[v[1]],u;u=g.call(this,0);if(u){y.push(u);}if(s&&s.id!==w.id){u=g.call(this,1);if(u){y.push(u);}}},getAllGraphicsForHighlight:function R(){var u=this._viewer,t=[],s=u&&u.graphics||this.graphics;Y.forEach(s,function(v){t=t.concat(v.getGraphicsForSelection());});return t;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils");var H=null,E="3.17",B="js.arcgis.com/"+E,C=mstrmojo.gmaps.MapUtils;mstrmojo.gmaps.basemap._CanLoadESRIMapScript=mstrmojo.provide("mstrmojo.gmaps.basemap._CanLoadESRIMapScript",{_mixinName:"mstrmojo.gmaps.basemap._CanLoadESRIMapScript",callback:null,esriAPIServer:null,setEsriConfig:function I(J){H=J;},getEsriConfig:function F(){return H;},parseEsriAPIServer:function G(){var J=H&&!!H.useESRICloud&&(parseInt(H.useESRICloud)===1),K=H&&H.jsapiurl;if(!J&&K){K=K.trim();K=K.replace(/^.*:\/{2,}/,"");K=K.replace(/\/+$/,"");if(K){this.esriAPIServer="//"+K;return ;}}this.esriAPIServer="//"+B;},loadExternalScript:function A(K,J){this.parseEsriAPIServer();this.loadJsScript(this.getURL(this.esriAPIServer+"/init.js"),K,J);},loadMainModule:function D(){if(!window.dojo){this.loadMap(mstrmojo.esrimap);return ;}window.dojo.require("esri.map");window.dojo.require("esri.tasks.query");window.dojo.require("esri.arcgis.utils");var N=window.location.protocol;if(mstrApp.isSingleTier){N="http:";}var M=N+this.esriAPIServer+"/esri/css/esri.css";C.loadCss("esricss",M);var K=N+this.esriAPIServer+"/dijit/themes/claro/claro.css";C.loadCss("esriClaro",K);var J=this;window.dojo.addOnLoad(function(){var O=window.setInterval(function(){window.clearInterval(O);J.loadMap(mstrmojo.esrimap);},50);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.vi.controllers.UICmdMgr");var M=mstrmojo,H=M.dom,B=M.hash,I=M.array,D=M.gmaps,G=D.SelectionHashType,J=D.MapUtils,A=mstrmojo.vi.controllers.UICmdMgr.STATES;mstrmojo.gmaps._MapInteractivity=mstrmojo.provide("mstrmojo.gmaps._MapInteractivity",{_mixinName:"mstrmojo.gmaps._MapInteractivity",graphicMenuOnCloseFlag:false,handleMouseClickEvt:function O(T,Q){var S=this.parent,R;if(S){S.selectionHashType=G.TEMPLATE_SELECTION;R=B.clone(S.getSelectionHash());this.handleClickEvt(T,Q);if(!B.equals(R,S.getSelectionHash())){S.endSelections();}else{S.raiseGraphicsSelectedEvent();}S.handleTemplateUnitSelections();}},handleClickEvt:function C(T,R){if(this.enablePopup!==true||!T||!J.checkVal(T.clientX)||!J.checkVal(T.clientY)){return ;}var Q,S=this.parent;this._preClickHandler();S.clearCxtMnuSelection();T.graphics=R;if(R&&R.length>0){Q=this.getGraphicLayerFromGraphic(T,R);Q.handleGraphicsClick(R,T);}else{if(this.graphicMenuOnCloseFlag===false){S.clearSelections(true);}}this.graphicMenuOnCloseFlag=false;},handleContextMenuEvt:function E(R,T){var V=this,X=this.parent;if(!R){return false;}this.hideTooltip();this.handleContextMenuClickEvt(R,T||this.getGraphicsFromPoint(R));X.handleTemplateUnitSelections();var W=X.controller.cmdMgr,Q=A.BUSY,T=R&&R.graphics;if(W.state!==Q){X.handleContextMenuEvt(R);if(X.contextMenu&&T&&T.length>0){X.contextMenu.onCloseMenuCallBack=function(){var Y=X.mapViewer;X.clearContextMenuSelectionHighLights();V.graphicMenuOnCloseFlag=true;if(Y){Y.highlightAllLayers();}};}}else{var U=X.getTargetConfig(T),S=X.getMenuConfig(U);if(S.hasMenuItems()){H.stopPropogation(window,R);H.preventDefault(window,R);}this.handleContextMenuInterval=window.setInterval(function(){if(W.state!==Q){window.clearInterval(V.handleContextMenuInterval);if(!V.destroyed){V.handleContextMenuInterval=undefined;X.handleContextMenuEvt(R);}}},10);}return false;},handleContextMenuClickEvt:function K(R,T){if(this.enablePopup!==true||!R||!J.checkVal(R.clientX)||!J.checkVal(R.clientY)){return ;}var S,V=this.parent,Q,U;this._preContextMenuClickHandler();V.clearCxtMnuSelection();R.graphics=T;if(T&&T.length>0){Q=T[0];U=Q&&Q.isSelected();if(!U){S=Q&&Q.getGraphicLayer();S.handleGraphicsContextMenuClick(T,R);}else{this.forEachGraphicLayer(function(W){if(J.checkHasFunction(W,"cloneSelectionToContextMenuSelection")){W.cloneSelectionToContextMenuSelection();}},true);}}this.highlightAllLayers();this.graphicMenuOnCloseFlag=false;},getGraphicLayerFromGraphic:function F(S,R){var Q=R&&R[0];if(Q){return Q.getGraphicLayer();}},_preClickHandler:function N(){this.forEachGraphicLayer(function(Q){if(J.checkHasFunction(Q,"handleClickEvt")){Q.handleClickEvt();}},true);},_preContextMenuClickHandler:function P(){this.forEachGraphicLayer(function(Q){if(J.checkHasFunction(Q,"handleContextMenuClickEvt")){Q.handleContextMenuClickEvt();}},true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils");var Z=mstrmojo,W=Z.hash,N=Z.array,D=Z.gmaps,R=Z.mapbox,M=D.MapUtils,V=R.FILTER,Q=R.ID_SUFFIX,b={Small:"#0096FF",Medium:"#FF9300",Large:"#FF2600",Small_Hover:"#6DBDF5",Medium_Hover:"#FFB34C",Large_Hover:"#FF7158"},O={Small_Hover:"#E1F2FF",Medium_Hover:"#FFECD2",Large_Hover:"#FFE4E0"},E={Small:15,Large:30,Medium:21,Small_Border:5,Medium_Border:8,Large_Border:10,Border_Selection:2,Border_ContextMenu:1},a=[0,10,100];function Y(c){if(c){return{property:"point_count",type:"interval",stops:N.map(a,function(e,d){return[e,c[d]];})};}}function S(c){return["in","cluster_id"].concat(N.isArray(c)?c:[]);}mstrmojo.gmaps.layer.mapbox._ClusterViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.mapbox._ClusterViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.mapbox._ClusterViewerWrapper",getClusterLayerId:function X(){var c=this.getLayerId();return c+Q.Cluster;},addClusterLayers:function T(h,g){var d=this.getClusterLayerId(),c=d+Q.DataLabel,f=this._layerIds,e={layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12,"text-allow-overlap":true},paint:{"text-color":"#ffffff"}};h.addLayer(W.copy(this.getClusterLayerOptions(),this.getLayerCtrlProps(d,"circle",g,V.CLUSTER)));f.push(d);h.addLayer(W.copy(this.getClusterLayerOptionsHover(),this.getLayerCtrlProps(d+Q.Hover,"circle",g,V.NOCLUSTER)));f.push(d+Q.Hover);h.addLayer(W.copy(this.getClusterLayerOptionsSelection(),this.getLayerCtrlProps(d+Q.Selection,"circle",g,V.NOCLUSTER)));f.push(d+Q.Selection);h.addLayer(W.copy(this.getClusterLayerOptionsContextMenu(),this.getLayerCtrlProps(d+Q.ContextMenu,"circle",g,V.NOCLUSTER)));f.push(d+Q.ContextMenu);h.addLayer(W.copy(e,this.getLayerCtrlProps(c,"symbol",g,V.CLUSTER)));f.push(c);},getClusterLayerOptions:function U(){return{paint:{"circle-color":Y([b.Small,b.Medium,b.Large]),"circle-radius":Y([E.Small,E.Medium,E.Large]),"circle-opacity":this.getFillOpacityForZoomAnimation(1),"circle-stroke-color":Y([b.Small,b.Medium,b.Large]),"circle-stroke-width":Y([E.Small_Border,E.Medium_Border,E.Large_Border]),"circle-stroke-opacity":this.getFillOpacityForZoomAnimation(0.35)}};},getClusterLayerOptionsHover:function C(){return{paint:{"circle-opacity":0.9,"circle-color":Y([b.Small_Hover,b.Medium_Hover,b.Large_Hover]),"circle-radius":Y([E.Small,E.Medium,E.Large]),"circle-stroke-color":Y([O.Small_Hover,O.Medium_Hover,O.Large_Hover]),"circle-stroke-width":Y([E.Small_Border,E.Medium_Border,E.Large_Border]),"circle-stroke-opacity":0.3}};},getClusterLayerOptionsSelection:function A(){return{paint:{"circle-opacity":0,"circle-radius":Y([E.Small+E.Small_Border,E.Medium+E.Medium_Border,E.Large+E.Large_Border]),"circle-stroke-color":"#000000","circle-stroke-width":E.Border_Selection,"circle-stroke-opacity":this.getFillOpacityForZoomAnimation(1)}};},getClusterLayerOptionsContextMenu:function P(){return{paint:{"circle-opacity":0,"circle-radius":Y([E.Small+E.Small_Border-E.Border_ContextMenu,E.Medium+E.Medium_Border-E.Border_ContextMenu,E.Large+E.Large_Border-E.Border_ContextMenu]),"circle-stroke-color":Y([b.Small,b.Medium,b.Large]),"circle-stroke-width":E.Border_ContextMenu}};},desolveFeature:function G(e){var f=this.getMapInstance(),c=this.cluster,d=e&&e.properties.cluster_id;return(M.checkDefined(d)&&c)?c.getLeaves(d,Math.floor(f.getZoom()),Infinity):[e];},isClusterFeature:function K(c){return !!(c&&c.properties.cluster);},handleClusterHover:function J(d){var e=this.getMapInstance(),c=this.getClusterLayerId()+Q.Hover,f=d&&d.properties.cluster_id;if(!e){return ;}if(M.checkDefined(f)){e.setFilter(c,S([f]));}else{e.setFilter(c,V.NOCLUSTER);}},_getAllClusters:function H(e){var c=this.cluster,d=this;if(e&&c){return N.filter(c.getClusters([-180,-90,180,90],Math.floor(e.getZoom())),function(f){return d.isClusterFeature(f);});}},_findClustersFromFeatures:function B(g,e){var c=this.cluster,d=[],f;if(!g||!c||!e||e.length<1){return ;}f=this._getAllClusters(g);N.forEach(f,function(i){var h=this.desolveFeature(i);if(N.some(h,function(j){return e.indexOf(j.properties.id)!==-1;})){d.push(i.properties.cluster_id);}},this);return d;},handleClusterSelection:function I(e){var f=this.getMapInstance(),d=this.getClusterLayerId(),c=this._findClustersFromFeatures(f,e);if(!f){return ;}if(!c||c.length<1){f.setFilter(d,V.CLUSTER);f.setFilter(d+Q.Selection,V.NOCLUSTER);f.setFilter(d+Q.ContextMenu,V.NOCLUSTER);}else{f.setFilter(d+Q.Selection,S(c));}},handleClusterContextMenu:function F(e){var f=this.getMapInstance(),d=this.getClusterLayerId(),c=this._findClustersFromFeatures(f,e);if(!f){return ;}if(!c||c.length<1){f.setFilter(d,V.CLUSTER);f.setFilter(d+Q.ContextMenu,V.NOCLUSTER);}else{f.setFilter(d+Q.ContextMenu,S(c));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.form","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.elementHelper");var j=mstrmojo.array,y=mstrmojo.string,J=mstrmojo.gmaps,D=J.MapUtils,a=J.EnumGraphicType,x=J.EnumThresholdType,z=J.EnumDrillLinkAnswerType,c=mstrmojo.elementHelper;var w=4;var C="2";var G=55,P=3,u=14081,AD=769;var T=2048001,AC=32001,q=4001;var p=1,E=2;function v(AH,AU){var AG,AF=AH.ans;var AL=function(AW,AX){return" "+AW+'="'+AX+'"';},AK=function(AW,AX){return" "+AW+'="'+y.encodeXMLAttribute(AX)+'"';},AT=function(AW){AG+="<e"+AK("ei",AW)+AL("emt","1")+"/>";};AG="<hl"+AL("mid",mstrApp.getMsgID())+AL("srct",this.getExecutionScope())+AL("aopam",AH.daMode)+">";if(AF!==null){AG+="<prms>";var AQ=this.primaryModel.getRowTitles().getTitle(AU),AI=AQ&&AQ.title.es,AE=[],AS,AR,AV=AF.length;j.forEach(this.selectedGraphics,function(AY){var AW=AY.attributes,AX=AW.geoIndices;if(AX){j.forEach(AX,function(AZ){AE.push(AI[AZ].id);});}else{AE.push(AI[AW.geoIndex].id);}});for(AS=0;AS<AV;AS++){var AP=AF[AS],AN=AP.pid,AO=AP.m,AJ=AP.values,AM=AP.dispNames;AG+="<prm"+AL("id",AN)+AL("am",AO);if(AP.po&&AP.po.did){AG+=AL("orid",AP.po.did)+AL("ortp",AP.po.t);}AG+=">";switch(AO){case z.DO_NOT_ANSWER:case z.CLOSE:case z.USE_DEFAULT_ANSWER:case z.SAME_PROMPT:break;case z.STATIC:if(AJ!==null){AG+='<pa ia="1"><es>';for(AR=0;AR<AJ.length;AR++){AG+="<e"+AL("ei",AJ[AR])+AK("disp_n",AM[AR])+AL("emt","1")+"/>";}AG+="</es></pa>";}break;case z.DYNAMIC:case z.DYNAMIC_OR_SAME_PROMPT:AG+='<pa ia="1">';AG+="<es "+AL("dispForms","")+">";j.forEach(AE,AT);AG+="</es></pa>";break;case z.ALL_VALID_UNITS:AG+='<pa ia="1"><attGroups><attGroup>';AG+="<a"+AL("id",AQ.getUnitId())+AK("n",AQ.getName())+">";AG+="<es "+AL("dispForms","")+">";j.forEach(AE,AT);AG+="</es></a>";AG+="</attGroup></attGroups></pa>";break;case z.CURRENT_UNIT:if(AE&&AE.length>0){AG+='<pa ia="1">';AG+="<a"+AL("id",AQ.getUnitId())+AK("n",AQ.getName())+"><es "+AL("dispForms",AQ.getFormId())+"><e"+AK("ei",AE[0])+AL("emt","1")+"/></es></a>";AG+="</pa>";}break;}AG+="</prm>";}AG+="</prms>";}AG+="</hl>";return AG;}mstrmojo.gmaps.layer._GraphicLayerDataHelper=mstrmojo.provide("mstrmojo.gmaps.layer._GraphicLayerDataHelper",{viewCache:null,getLayerModel:function r(){return this.primaryModel;},getData:function W(){return this.data;},getDropZones:function l(){return this.dropZones;},getDataRows:function B(){var AE=this.getData();if(AE&&AE.gts){return AE.gts.row;}},getDataCols:function Y(){var AE=this.getData();if(AE&&AE.gts){return AE.gts.col;}},getDataRowHeaders:function AB(){var AE=this.getData(),AF=AE&&AE.ghs;if(AF&&AF.rhs){return AF.rhs.items;}},getDataColHeaders:function A(){var AE=this.getData(),AF=AE&&AE.ghs;if(AF&&AF.chs){return AF.chs.items;}},getDataColTitles:function F(){var AE=this.getLayerModel();return AE&&AE.getColTitles();},getDataThresholds:function m(){var AE=this.getData();return AE&&AE.gsi&&AE.gsi.thresholds;},getElementValue:function R(AI,AF){var AH=this.getDataRows(),AE=this.getDataRowHeaders(),AG=AE[AI].items[AF];if(AH&&AG){return D.trimString(y.decodeHtmlString(AH[AF].es[AG.idx].n));}},getExecutionScope:function(){if(D.isExpress()){return C;}return microstrategy.EXECUTION_SCOPE;},getMetricCount:function O(){var AE=this.getData(),AF=AE&&AE.gsi;if(!!AF&&!!AF.mx){return AF.mx.length;}},hasMetrics:function h(){var AE=this.getMetricCount();return !!AE&&AE>0;},showMetric:function V(){var AE=this.getDataCols();return AE&&(AE.length===1&&AE[0].otp===-1);},retrieveDataRows:function o(AR){var AW,AV,AP,AF,AE,AM,AY,AJ,AT,AO,AN,AS,AQ,AL,AK,AX,AG,AZ=[],AH=this.getDataRowHeaders(),AI=AH.length,AU={};if(AR){AP=AR.elementIndex;AF=AP.length;AE=AR.longElementIndex;AM=parseInt(AR.pos[0],10);AY=parseInt(AR.pos[1],10);AJ=(typeof AR.sfv==="string")?AR.sfv.toLowerCase():AR.sfv;AT=this.geoSecondaryRolePosition;for(AW=0;AW<AF;AW++){if(AU.hasOwnProperty(AP[AW])){continue;}AU[AP[AW]]=AP[AW];AO=parseInt(AP[AW],10);AN=parseInt(AE[AW],10);AS=[];AQ=AO+"#"+AN;if(!this.viewCache){this.viewCache={};}if(this.viewCache[AM]===undefined||this.viewCache[AM]===null){this.viewCache[AM]={};}if(this.viewCache[AM]&&this.viewCache[AM][AQ]){AS=this.viewCache[AM][AQ];}else{for(AV=0;AV<AI;AV++){AL=AH[AV].items;AK=AL[AM];AX=AL[AY];if(AK&&AK.idx===AO&&AX&&AX.idx===AN){AG=this.getElementValue(AV,AT);AG=(typeof AG==="string")?AG.toLowerCase():AG;if(AJ!==undefined&&AJ!==AG){continue;}AS.push(AV);}}this.viewCache[AM][AQ]=AS;}AZ=AZ.concat(AS);}}return AZ;},getAttributeName:function(AJ){var AK,AE,AL,AH,AM,AF=this.getData(),AI=AF.lnm,AG=this.getDataRows()||[];AK=AG[AJ];if(AK){if(D.isExpress()){return AK.n;}AE=AK.fs&&AK.fs[0];AL=(AE&&AE.n)||"";if(AI===2){return AL;}AM=(AF.gsi.rows||[]).concat(AF.gsi.cols||[]);j.forEach(AM,function(AN){if(AN.did===AK.id){AH=AN.n;return false;}});if(AH===undefined){AH=AK.dn||AK.n;}if(AI===1){return AL?AH+" "+AL:AH;}return AH;}return"";},justMetricId:function I(AG){if(!AG){return ;}var AF=AG,AE;if(AG.indexOf("CD:")===0){AE=AG.match(/(CD:=?)([0-9a-zA-Z]*)/);if(AE){AF=AE[2];}}else{if(AG.indexOf("i")===0){AE=AG.match(/(i=?)([0-9a-zA-Z]*)(?=;)/);if(AE){AF=AE[2];}else{AE=AG.split(";");if(AE&&AE.length>0){AF=AE[AE.length-1];}}}}return AF;},getGraphicsDataRowIndices:function N(AE){var AF=[],AG=this;if(!j.isArray(AE)||AE.length<1){return AF;}if(this.graphicType!==a.Area){j.forEach(AE,function(AH){if(AH){AF=AF.concat(AH.getDataRowIndices());}});}else{j.forEach(AE,function(AI){var AH=AI&&AI.attributes;if(AH){AF=AF.concat(AG.retrieveDataRows({pos:AH.columnIndices,elementIndex:[AH.geoIndex],longElementIndex:[AH.geoIndex],setViewDataFlag:false,applyControl:false,sfv:AH.sfv}));}});}return AF;},getThresholdInfo:function g(AJ,AG,AH){if(!this.applyThreshold||!this.primaryModel){return ;}var AF=AH?AH:this.getLayerModel(),AE=AF&&AF.getMetricValue(AJ,AG),AI=AE&&AE.data||this.getData();if(!AI||!AE){return ;}if(AI.th&&AI.fc){return this._getThresholdInfoFromWebJson(AE);}else{return this._getThresholdInfoFromServerJson(AG,AE);}},_getThresholdInfoFromWebJson:function d(AF){if(!AF||!AF.value){return ;}var AE={},AG=AE.type=this.getThresholdType(AF);switch(AG){case x.Image:this.ImageThreshold=true;AE.url=AF.getThresholdValue();break;case x.Url:AE.url=AF.getThresholdValue();break;case x.Text:case x.QuickSymbol:AE.colorStr=AF.getThresholdValue();AE.text=this.getQuickSymbol(AF.getValue());break;default:AE.colorStr=AF.getFillColor();break;}return AE;},_getThresholdInfoFromServerJson:function M(AH,AJ){if(!AJ){return ;}var AL=AJ.value,AK=this.getDataThresholds(),AE=this.findMetricId(AH),AM,AI,AF,AG;if(!AK||!AL||!AL.hasOwnProperty("ti")||!D.checkDefined(AE)){return ;}AI=AK[AE];if(!AI){return ;}AF=AI[AL.ti];if(!AF){return ;}AM={};AG=AJ.getThresholdType();switch(AG){case x.Image:this.ImageThreshold=true;AM.url=AF.rtxt;break;case x.Url:AM.url=AF.rtxt;break;case x.Text:case x.QuickSymbol:if(AF.fmt&&AF.fmt.fc){AM.colorStr=AF.fmt.fc;}AM.text=this.getQuickSymbol(AJ.value.v);break;default:if(AF.fmt&&AF.fmt.bc){AM.colorStr=AF.fmt.bc;}break;}AM.type=this.getThresholdType(AJ,AF);return AM;},getThresholdType:function k(AF,AE){if(!AF){return ;}var AH=AF.getThresholdType(),AG;if(AH===x.Image||AH===x.Url){AG=x.Url;}else{if(AH===x.Text||AH===x.QuickSymbol){AG=x.Text;}else{if(AE&&AE.fmt&&AE.fmt.bc){AG=x.Default;}else{AG=AH;}}}return AG;},getQuickSymbol:function f(AF){var AE;switch(AF){case"&#9679;":case'<font face="Wingdings">\u006c</font>':AE="\u25CF";break;case"&#9632;":case'<font face="Wingdings">\u006e</font>':AE="\u25a0";break;case"&#9830;":case'<font face="Wingdings">\u0074</font>':AE="\u2666";break;case"&#9670;":case'<font face="Wingdings">\u0075</font>':AE="\u25C6";break;case"&#10070;":case'<font face="Wingdings">\u0053</font>':AE="\u2756";break;case"&#9784;":case'<font face="Wingdings">\u005D</font>':AE="\u2638";break;case"&#10047;":case'<font face="Wingdings">\u007C</font>':AE="\u273F";break;case"&#8984;":case'<font face="Wingdings">\u007a</font>':AE="\u2318";break;case"&#10003;":case'<font face="Wingdings">\u0009</font>':AE="\u2713";break;case"&#10007;":case'<font face="Wingdings">\u000a</font>':AE="\u2717";break;case"&#8680;":case'<font face="Wingdings">\u00e8</font>':AE="\u21E8";break;case"&#8679;":case'<font face="Wingdings">\u00e9</font>':AE="\u21E7";break;case"&#8681;":case'<font face="Wingdings">\u00ea</font>':AE="\u21E9";break;default:AE=AF;}return decodeURI(AE);},findMetricId:function AA(AG){var AJ=this.getDataColTitles(),AK=AJ&&AJ.size(),AF,AE,AI,AL,AH;if(!AK){return ;}for(AH=0;AH<AK;AH++){AF=AJ.getTitle(AH);if(AF&&AF.getUnitDssType()===-1){AL=AF.getHeaderValues();AE=AL&&AL[AG];if(!!AE){AI=this.justMetricId(AE.id);}break;}}return AI;},findAttrIdx:function s(AF){var AE=this.getDataRows();return j.find(j.ensureArray(AE),"id",AF);},findAttrIdxs:function S(AI){var AH=j.ensureArray(this.getDataRows()),AE=AH.length,AF=[],AG,AJ;for(AG=0;AG<AE;AG++){AJ=AH[AG];if(AJ&&AJ.id===AI){AF.push(AG);}}return AF;},findMetricIdx:function K(AJ,AI){if(!j.isArray(AJ)||!AI){return -1;}var AE,AM,AG,AL,AF,AH,AK;for(AG=0,AL=AJ.length;AG<AL;AG++){AE=AJ[AG];if(!AE||AE.otp!==-1){continue;}AM=AE.es;AH=AM&&AM.length;if(!D.checkDefined(AM)||!D.checkDefined(AH)){continue;}for(AF=0;AF<AH;AF++){if(AI===this.justMetricId(AM[AF].id)){AK=AF;break;}}}return AK;},stripNumberFormat:function n(AF){var AJ=this.map&&this.map.getMapConfig(),AH=AJ&&AJ.common,AG=AF.replace(AH.currencySymbol,""),AE,AI;do{AE=AG;AG=AG.replace(AH.groupingSeparator,"");}while(AE!=AG);AI=AG.replace(AH.decimalSeparator,".");return AI;},isDrillable:function H(){if(this.data.eg!==undefined||this.primaryModel.getTotalRows()===0){return false;}var AF=this.getGeoColumnIndex(),AG=this.primaryModel.getRowTitles().getTitle(AF),AE=AG&&AG.getActionType();if(AE===undefined||isNaN(AE)){return false;}return(AE&w)>0;},performDrill:function X(AH){if(!this.isDrillable()){return ;}var AI=this.primaryModel.getRowTitles().getTitle(AH),AE=AI.getLinkMap()[0],AJ=AE.links,AG=AE.di,AF=AJ[AG];if(AF){this[!AF.url?"execDynamiclLink":"execUrlLink"](AE,AF,AH);}},execDynamiclLink:function b(AE,AH,AI){var AG=v.call(this,AH,AI),AF=AE.onw;if(D.isExpress()){this.execDynamiclLinkOIVM(AH,AG,AF);}else{this.execDynamiclLinkIM(AH,AG,AF);}},execDynamiclLinkOIVM:function t(AG,AE,AF){var AI=AG.target,AK=AI&&AI.t,AJ,AH=AI.did;switch(parseInt(AK,10)){case G:if(parseInt(AI.st,10)===u){AJ={evt:T,objectID:AH};}else{AJ={evt:AC,documentID:AH};}break;case P:AJ={evt:q,reportID:AH,reportViewMode:AI.st===AD?E:p};}if(AJ){if(AE){AJ.linkAnswers=AE;}this.linkDrill(AJ,AG,AF);}},linkDrill:function U(AG,AF,AE){mstrmojo.form.send(AG,null,"POST",AE?"_blank":null);},execDynamiclLinkIM:function Z(AK,AI,AM){try{var AL=null,AH=[AK.target.did],AE=null;if(AK.target.t===P){AE=mstrUpdateManager.RUN_REPORT;AL=["1001"];if(AI){AL.push("4222");AH.push(AI);}AL.push("4115");AH.push(microstrategy.getReportViewMode(AK.target.st));}else{if(AK.target.t===G){if(AK.target.st===u){AE=mstrUpdateManager.RUN_RW_DOCUMENT;AL=["2048001"];if(AI){AL.push("2048140");AH.push(AI);}}else{AE=mstrUpdateManager.RUN_DOCUMENT;AL=["1001"];if(AI){AL.push("32351");AH.push(AI);}}}}var AJ=microstrategy.updateManager,AG=AJ.useIframe,AN=AJ.newWindow;AJ.useIframe=false;AJ.newWindow=AM;if(AJ.hasChangesToSubmit()){AJ.add([AJ.createActionObject(null,mstrUpdateManager.APPLY_CHANGES,mstrUpdateManager.applyChangesBeanPath,[],[],[])]);}AJ.add([AJ.createActionObject(this.elem,AE,"",AL,AH,[])]);AJ.flushAndSubmitChanges();AJ.acknowledgeRequest();AJ.newWindow=AN;AJ.useIframe=AG;}catch(AF){microstrategy.errors.log(AF);}},execUrlLink:function Q(AE,AF){var AG=mstrmojo.form.createDynamicForm(AF.url);if(AE.onw){AG.target="_blank";}AG.submit();},getElementIdWithoutAttributeID:function i(AE){var AF,AH=c.getIdPresentation(AE),AG="",AI=0;switch(AH){case"terse":case"terseLong":for(AF=0;AF<AE.length;AF++){if(AE.charAt(AF)===";"){AI++;}if(AI===1){continue;}AG+=AE.charAt(AF);}return AG;case"old":for(AF=0;AF<AE.length;AF++){if(AE.charAt(AF)===":"){AI++;continue;}if(AI===0){continue;}AG+=AE.charAt(AF);}return AG;case"oldLong":for(AF=0;AF<AE.length;AF++){if(AE.charAt(AF)===":"){AI++;}if(AI===1){continue;}AG+=AE.charAt(AF);}return AG;}return AE;},isGridDataEmpty:function e(){return !this.data||this.data.eg!==undefined||!this.map||this.map.excludeData;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.gmaps.MapUtils");var B=mstrmojo.vi.ui.rw.SelectionType,F=mstrmojo.gmaps.MapUtils,H=mstrmojo.array;mstrmojo.gmaps._SupportMapBrushesAndHighlights=mstrmojo.provide("mstrmojo.gmaps._SupportMapBrushesAndHighlights",{_mixinName:"mstrmojo.gmaps._SupportMapBrushesAndHighlights",mapSelectionType:B.METRICS,init:function E(I){if(this._super){this._super(I);}},highlight:function A(I,P,J){if(this._super){this._super.apply(this,arguments);}this.clearSelections();var N=this.mapViewer,M=N&&N.graphicLayerMapping,K;if(!M||Object.keys(M).length<1){return ;}for(K in M){var Q=M[K];if(I==="allLayers"){var O=P[Q.key];if(O){Q.highlight(O.selType,O.selHash,J);}}else{Q.highlight(I,P,J);}}if(N){N.highlightAllLayers();}},clearSelections:function C(I){if(this._super){this._super();}var J=this.mapViewer;if(F.checkHasFunction(J,"clearAllSelectedGraphics")){J.clearAllSelectedGraphics(I);}},clearCxtMnuSelection:function G(){if(this._super){this._super();}var I=this.mapViewer;if(F.checkHasFunction(I,"clearAllContextMenuSelection")){I.clearAllContextMenuSelection();}},clearContextMenuSelectionHighLights:function D(){var I=this.mapViewer;if(F.checkHasFunction(I,"clearAllContextMenuSelectionHighLights")){I.clearAllContextMenuSelectionHighLights();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.array","mstrmojo.VisEnum","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils");var K=mstrmojo.array,d=mstrmojo.func,AL=mstrmojo.gmaps,n=mstrmojo.gmaps.MapUtils,w=AL.EnumBaseMapType,AG=AL.EnumDefaultMapStyle,u=AL.EnumPropertyType,m=AL.EnumZoomBehavior,I=AL.EnumGraphicType,z=AL.EnumClusterMode,AU=AL.EnumMarkerType,S=AL.EnumDataLabel,Q=mstrmojo.VisEnum,AF=Q.EnumLegendMode,AD=Q.EnumSingleLegendMode,C=Q.LegendPropertyTag,AM=AL.EnumShapeFormatting,AX=AL.EnumCombinedLineStyle,t=AL.EnumDistUnitType,W=u.collapseLegend,AQ=u.legendSwitch,o=u.legendSize;var AN=[u.baseMapType,u.mapStyle,u.zoomSetting,u.editingLayerIdx,u.keepZoomAndPos,u.zoomLevel,u.mapCenter,u.mapBearing,u.mapPitch,u.enableZoomThroughLayer,u.showMapLable,u.mapLabelOnTop,u.distUnit,u.languageType,u.tooltipSwitch],AY=[S.DATA_LABEL_SHOW,S.DATA_LABEL_SHOW_ALL,S.DATA_LABEL_FONT_FAMILY,S.DATA_LABEL_FONT_SIZE,S.DATA_LABEL_FONT_STYLE,S.DATA_LABEL_FONT_COLOR],AA=[AM.SHAPE_FORMAT_FILL_COLOR,AM.SHAPE_FORMAT_FILL_OPACITY,AM.SHAPE_FORMAT_BORDER_COLOR,AM.SHAPE_FORMAT_BORDER_STYLE],AC=[u.MAX_SIZE_TYPE,u.MAX_SIZE_VALUE,u.MIN_SIZE_TYPE,u.MIN_SIZE_VALUE];function B(AZ,Ac,Aa){var Ag,Ad,Ab,Af;try{Ag=parseFloat(Ac[u.zoomLevel]);Ad=JSON.parse(Ac[u.mapCenter]);if(Aa[u.zoomLevel]===Ag&&AZ.isSameCenter(Aa[u.mapCenter],Ad)){if(!Aa.supportBearingAndPitch){return true;}Ab=parseFloat(Ac[u.mapBearing]);Af=parseFloat(Ac[u.mapPitch]);if(Aa[u.mapBearing]===Ab&&Aa[u.mapPitch]===Af){return true;}}return false;}catch(Ae){n.log("Parse Zoom Level and Center Point Error");return false;}}mstrmojo.gmaps._MapProperty=mstrmojo.provide("mstrmojo.gmaps._MapProperty",{_mixinName:"mstrmojo.gmaps._MapProperty",handlePropValChange:function AJ(Aa,Ab,Ac,AZ){if(!n.checkDefined(Aa)||!n.checkDefined(Ab)){return ;}if(AY.indexOf(Ab)>=0){this.onDataLabelFormattingChange(Aa);return ;}if(AA.indexOf(Ab)>=0){this.onShapeFomattingChange(Aa,Ab,Ac);return ;}if(AC.indexOf(Ab)>=0){this.onMaxMinSizeOptionChange(Aa);if(Ab===u.MIN_SIZE_TYPE){this.resetLegendSizeByData(Aa);}return ;}switch(Ab){case u.baseMapType:this.onBaseMapTypeChange();break;case u.mapStyle:this.onMapStyleChange();break;case u.languageType:this.onLanguageChange();break;case u.zoomSetting:this.onZoomSettingChange(Ac);break;case u.graphicType:this.onGraphicTypeChange(Aa,Ac,AZ);break;case u.markerType:this.onMarkerTypeChange(Aa,Ac);break;case u.themeType:this.onDensityThemeChange(Aa);break;case u.clusterMode:this.onClusterModeChange(Aa,Ac);break;case u.clusterRadius:this.onClusterRadiusChange(Aa,Ac);break;case u.clusterMaxZoom:this.onClusterMaxZoomChange(Aa,Ac);break;case u.shapeFile:this.onBoundariesChange(Aa,Ac);break;case u.legendSwitch:this.onLegendSwitch(Aa,Ac);break;case u.isHidden:this.onLayerVisibleChange(Aa,Ac);break;case C.LEGEND_MODE:this.onLegendCollapseChange(Aa,Ac);break;case C.SCALE_LEGEND_WIDTH:this.onLegendResized(Aa,Ac);break;case u.collapseLegend:this.handleLegendCollapsePropChange(Aa,Ac);break;case C.LEGEND_POSITION:this.onLegendPosChange(Ac);break;case u.layerName:this.synchronizeLayerName(Aa,Ac);break;case u.enableZoomThroughLayer:this.onLayerZoomRangeChange();break;case u.minLayerZoomLvl:case u.maxLayerZoomLvl:this.onLayerZoomRangeChange();this.refreshLegendNodes();break;case u.showMapLable:this.toggleBaseMapLabels(Ac);break;case u.mapLabelOnTop:this.toggleBaseMapLabelsPos(Ac);break;case u.colorByOpacity:this.onLayerColorByOpacityChange(Aa,Ac);break;case u.legendSize:this.handleLegendConSizePropChange(Ac);break;default:break;}},onBaseMapTypeChange:function AS(){var Aa=this.mapViewer,Ab=this.getProperties(),AZ=u.baseMapType,Ad=this.edtModel,Ac=Ab&&Ab[AZ];if(!Aa||!n.checkDefined(Ac)){return ;}if(Ad){this.propEditorListener={listener:Ad,callback:function(){Ad.onBaseMapTypeChange();}};}this.updateProperties(u.mapStyle,this.getDefaultMapStyle(Ac));Aa.switchBaseMap(Ac);},getDefaultMapStyle:function R(Aa){var AZ;switch(Aa){case w.Esri:AZ=AG.Esri;break;case w.Google:AZ=AG.Google;break;case w.Image:AZ=AG.Image;break;case w.Mapbox:AZ=AG.Mapbox;break;default:break;}return AZ;},onMapStyleChange:function AV(){var Aa=this.mapViewer,AZ=Aa&&Aa.baseLayer,Ac=u.mapStyle,Ab=this.getProperties();if(!AZ||!Ab){return ;}if(AZ.setMapStyle instanceof Function){AZ.setMapStyle(Ab[Ac]);}},onLanguageChange:function g(){var Ab=this.mapViewer,AZ=Ab&&Ab.baseLayer,Aa=u.languageType,Ac=this.getProperties();if(!AZ||!Ac){return ;}if(AZ.setLanguage instanceof Function){AZ.setLanguage(Ac[Aa]);}},onZoomSettingChange:function p(Ab){var Aa=this.mapViewer,AZ=Aa&&Aa.baseLayer;if(!AZ){return ;}switch(Ab){case m.Automatic:this.updateProperties(u.mapGeoExtent);break;case m.Keep:this.updateProperties(u.mapGeoExtent);break;default:break;}if(Aa.updateMapExtent instanceof Function){Aa.updateMapExtent();}},onGraphicTypeChange:function J(Ad,Ag,Aa){var Ac=this.mapViewer,Af=this.getGraphicLayer(Ad),Ae=this.edtModel,AZ="",Ab;switch(Ag){case I.Marker:AZ=this.defaultMarkerType;break;case I.Bubble:AZ=AU.Circle;Ab=this.getPropertyValue(u.clusterMode,Ad);if(Ab===z.PIE){this.updateProperties(u.clusterMode,z.ON,Ad);}break;case I.Area:this.updateProperties(u.shapeFile,Ae.getAreaShape(),Ad);this.updateProperties(u.clusterMode,"",Ad);break;default:this.updateProperties(u.clusterMode,"",Ad);break;}this.updateProperties(u.markerType,AZ,Ad);if(Aa&&Ac&&Af){Ac.rebuildGraphicLayer(Af.data);}},onShapeFomattingChange:function H(AZ,Aa,Ac){var Ab=this.getGraphicLayer(AZ);if(!!Ab){this.updateGraphicShapeFormat(AZ,Aa,Ac);}},updateGraphicShapeFormat:function(Ac,Ad,Af){var Ae=this.getGraphicLayer(Ac),Aa=Ae&&Ae._viewer,AZ=Ae&&Ae.getAllGraphicsForHighlight();if(Aa){switch(Ad){case AM.SHAPE_FORMAT_BORDER_STYLE:this.convertLineStyle(Af);Aa.setShapeStrokeStyle({shapeBorderWidth:this.shapeBorderWidth,shapeBorderStyle:this.shapeBorderStyle,shapeBorderLineDash:this.shapeBorderLineDash},AZ);break;case AM.SHAPE_FORMAT_FILL_OPACITY:var Ab=this.mapViewer;this.convertShapeFillOpacity(Af);this.resetLegendColorByData(Ac);Aa.setShapeFillOpacity(this.shapeFillOpacity,AZ);if(Ab){Ab.highlightAllLayers();}break;case AM.SHAPE_FORMAT_FILL_COLOR:Aa.setShapeFillColor(Af,AZ);break;case AM.SHAPE_FORMAT_BORDER_COLOR:Aa.setShapeStrokeColor(Af,AZ);break;}}},convertLineStyle:function b(AZ){var Aa=parseInt(AZ,10),Ac=1,Ab="solid",Ad=[];switch(Aa){case AX.THIN:Ac=1;Ab="solid";break;case AX.THICK:Ac=2;Ab="solid";break;case AX.DASHED:Ac=1;Ab="dashed";Ad=[2];break;case AX.DOTTED:Ac=1;Ab="dotted";Ad=[1];break;case AX.NONE:Ac=0;Ab="none";break;default:Ac=1;Ab="solid";}this.shapeBorderWidth=Ac;this.shapeBorderStyle=Ab;this.shapeBorderLineDash=Ad;},convertShapeFillOpacity:function P(AZ){var Aa=parseInt(AZ,10);this.shapeFillOpacity=Aa/100;},onMarkerTypeChange:function AP(Aa,Ac){var Ab=this.getGraphicLayer(Aa),AZ=this.mapViewer;if(!!Ab&&Ab.switchMarkerType instanceof Function){Ab.switchMarkerType(Ac);}if(AZ){AZ.highlightAllLayers();}},onDensityThemeChange:function AW(AZ){var Aa=this.getGraphicLayer(AZ);if(!!Aa&&Aa.updateGraphics instanceof Function){Aa.updateGraphics();}},onClusterModeChange:function V(Aa,Ac){var Ab=this.getGraphicLayer(Aa),AZ=this.mapViewer;if(!!Ab&&Ab.switchClusterMode instanceof Function){Ab.switchClusterMode(Ac);}if(AZ){AZ.highlightAllLayers();}},onClusterRadiusChange:function i(AZ,Ab){var Aa=this.getGraphicLayer(AZ);if(!!Aa&&Aa.changeClusterRadius instanceof Function){Aa.changeClusterRadius(parseInt(Ab,10));}},onClusterMaxZoomChange:function Z(AZ,Ab){var Aa=this.getGraphicLayer(AZ);if(!!Aa&&Aa.changeClusterMaxZoom instanceof Function){Aa.changeClusterMaxZoom(parseInt(Ab,10));}},onBoundariesChange:function c(Aa){var AZ=this.mapViewer,Ab=this.getGraphicLayer(Aa);if(!!AZ&&AZ.rebuildGraphicLayer instanceof Function&&!!Ab){AZ.rebuildGraphicLayer(Ab.data);}},onLayerVisibleChange:function AO(Ab){var Ac=this.getGraphicLayer(Ab),AZ=Ac.isVisible(),Aa=this.mapViewer;if(!Ac||!Aa){console.log("onLayerVisibleChange: invalid graphicLayer/mapViewer.");return ;}Ac.setVisibility(AZ);if(AZ){Ac.updateGraphics();}this.handleLegendOnLayerVisibleChange(Ab);Aa.updateBaseMap();Aa.highlightAllLayers();},onLegendCollapseChange:function a(Ab,Ad){var Ac=this.getGraphicLayer(Ab),AZ=this.legendCon,Ae=parseInt(this.getPropertyValue(u.collapseLegend,Ab,false)),Aa=AZ.isMinimal=(Ad===AF.MINIMIZED);Ac.hEvalSize4Legend();Ac.updateLegend();if(!Aa&&Ae===AD.COLLAPSE){Ac.renderCollapseMode();}if(Aa){AZ.triBtn.setAttribute("class","gm-legend-tri-button-collapsed");if(this.autoCollapse){AZ.triBtn.setAttribute("title",mstrmojo.desc(13682,"There is not enough space to display the legend"));}else{AZ.triBtn.setAttribute("title",mstrmojo.desc(13683,"Maximize Legend"));}AZ.closeBtn.style.display="none";AZ.splitter.style.display="none";AZ.domNode.style.overflow="hidden";AZ.isMinimal=true;}else{AZ.triBtn.setAttribute("class","gm-legend-tri-button");AZ.triBtn.setAttribute("title",mstrmojo.desc(13684,"Minimize Legend"));AZ.closeBtn.style.display="block";AZ.closeBtn.setAttribute("title",mstrmojo.desc(12002,"Hide Legend"));AZ.closeBtn.setAttribute("title",mstrmojo.desc(12002,"Hide Legend"));AZ.domNode.style.overflow="visible";AZ.isMinimal=false;}},onLegendPosChange:function AK(Ag){var Ad=this,AZ=Ad.legendCon,Aa=AZ&&AZ.dockedPositions,Ac,Af,Ab=Ad.layerIdxMappingArr,Ae;K.forEach(Aa,function(Ah,Ai){if(parseInt(Ah.pos)===parseInt(Ag)){Ac=Ah;Af=Ai;return false;}});AZ.updateDropZonePosition(Ac);AZ.currDockedPositionIdx=Af;AZ.updateAlignClass();K.forEach(Ab,function(Ah){Ae=Ad.getGraphicLayer(Ah);if(Ae&&Ae.legend){Ae.updateSingleLegendAlignClass();}});},synchronizeLayerName:function AI(AZ,Aa){this.updateLegendTitle(AZ,Aa);},onLegendResized:function s(AZ,Ab){var Aa=this.getGraphicLayer(AZ);Aa.resizeLegend(Ab);Aa.updateLegend();},onLegendSwitch:function N(Aa,Ab){var AZ=this.legendCon;if(AZ&&AZ.isMinimal){this.updateProperties(C.LEGEND_MODE,AF.MINIMIZED,Aa);}else{this.updateProperties(C.LEGEND_MODE,AF.RESTORED,Aa);}this.getGraphicLayer(Aa).toggleLegend(Ab);},onDataLabelFormattingChange:function k(Ab){var Aa=this.getGraphicLayer(Ab),AZ=Aa&&Aa._viewer;if(AZ){AZ.updateDataLabelLayer();}},onMaxMinSizeOptionChange:function x(Ab){var AZ=this.getGraphicLayer(Ab),Aa=this.mapViewer;if(AZ&&AZ.switchMaxMinOption){AZ.switchMaxMinOption();}if(Aa){Aa.highlightAllLayers();}},onLayerZoomRangeChange:function D(Ab){var Aa=function(Ac){if(!!Ac&&Ac.onLayerZoomRangeChange instanceof Function){Ac.onLayerZoomRangeChange();}},AZ=this.mapViewer;if(Ab){Aa(this.getGraphicLayer(Ab));}else{AZ.forEachGraphicLayer(function(Ac){Aa(Ac);},false,true);AZ.reorderGraphicLayers();}if(AZ){AZ.highlightAllLayers();}},toggleBaseMapLabels:function v(AZ){var Ab=this.mapViewer,Aa=Ab&&Ab.baseLayer;if(Aa){Aa.toggleBaseMapLabels(AZ);}},toggleBaseMapLabelsPos:function y(Ab){var Aa=this.mapViewer,AZ=Aa&&Aa.baseLayer;if(AZ){AZ.toggleBaseMapLabelsPos(Ab);}},onLayerColorByOpacityChange:function AE(Aa,Ab){var AZ=this.getGraphicLayer(Aa);AZ.handleLayerColorByOpacity(Ab);},isLbGrpEstInBaseLayer:function U(){var Aa=this.mapViewer,AZ=Aa&&Aa.baseLayer;if(AZ){return AZ.isLabelGroupExist();}return false;},getDefaultDistanceUnit:function AB(){var AZ=navigator.language||navigator.userLanguage;if(typeof AZ==="string"){AZ=AZ.substr(0,2).toLowerCase();}return AZ==="en"?t.Miles:t.KM;},getDistanceUnit:function AH(){var AZ=this.getPropertyValue(u.distUnit);if(AZ===undefined){AZ=this.getDefaultDistanceUnit();}return AZ===t.KM?{unit:"kilometers",unitStr:"km"}:{unit:"miles",unitStr:"miles"};},updateProperties:function h(AZ,Ad,Ab){if(!AZ){return ;}var Aa=this.getPropertyValue(AZ,Ab,true),Ac=true;if(!Aa){console.log("invalid properties");return ;}if(!n.checkDefined(Ad)){delete Aa[AZ];}else{if(Aa[AZ]===undefined||Aa[AZ].toString()!==Ad.toString()){Aa[AZ]=Ad;}else{Ac=false;}}if(Ac){Aa[u.dirtyVp]=true;}return Ac;},getGraphicLayer:function M(Aa){var AZ=this.mapViewer;if(!AZ){return ;}Aa=Aa||this.getEditingGridKey();return AZ.getGraphicLayer(Aa);},getPropertyBelongingKey:function Y(AZ,Aa){if(AN.indexOf(AZ)>=0){return this.getGridKey();}return Aa||this.getEditingGridKey();},getPropertyValue:function e(Ab,Ad,Ae){var Aa=this.getPropertyBelongingKey(Ab,Ad),Ac=this.getProperties(Aa);if(Ae){return Ac;}if(Ac){var AZ=Ac[Ab];return Ab===u.legendSwitch&&!AZ?false:AZ;}},writeProperties:function O(Ah,Ab,Al,An){if(Ah===AQ){this.handleLegendSwitch(Al,Ab);}var Ag,Ap,Ak=this.id,Ai=Al||this.getPropertyBelongingKey(Ah),AZ=this.getPropertyValue(Ah,Ai),Aa=this.updateProperties(Ah,Ab,Ai),Af=true,Ac=Ah===u.graphicType,Am=false,Aj=[],Ae=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ad=this.getExtraActionsforPropetyChange(Ah,Ab,Ai),Ao=function(Aq,As){var Ar=mstrmojo.all[Ak];if(!Ar){return ;}if(As){Ar.updateProperties(Ah,Aq,Ai);}if(Ah!==o||As){Ar.handlePropValChange(Ai,Ah,Aq,Af);}if(Af&&Ae&&!An){Ae.success();}};if(Ac){Aj=this.edtModel&&this.edtModel.getActionsWithUpdateProperty(AZ);K.forEach(Aj,function(Aq){if(Aq&&Aq.act==="updateTemplate"){Am=true;return false;}});Af=!Am;Ad=Ad.concat(Aj||[]);}if(Aa){Ao(Ab,false);Ag={undo:function(){Ao(AZ,true);},redo:function(){Ao(Ab,true);}};if(Af){Ag.silent=true;}else{Ap=this.getDocModel().controller._getXtabCallback(this);}if(Ap){Ag.callback=Ap;}this.submitMapUpdates({actions:Ad,requestCallback:Ap,urInfo:Ag},Af);}},getExtraActionsforPropetyChange:function F(AZ,Ac,Aa){var Ad=[],Ab;switch(AZ){case u.layerName:Ab=this.fnGetWidget(Aa);Ad.push(this.getDocModel().getUnitFormatAction(Ab,1,({FormattingAppearance:{Name:Ac}})));break;default:break;}return Ad;},writeMultipleProperties:function T(An,Am){var Af,Ai=this.id,Ak={},Ad=true,Ac=this.zonesModel&&this.zonesModel.getUpdateCallback(),Aj,Ah,Ae,Ab,AZ,Aa,Ag=false,Al=function(Ap,Aq){var Ao=mstrmojo.all[Ai];if(!Ao){return ;}for(Aj in Ap){Ah=Ap[Aj];for(Ae in Ah){Ab=Ah[Ae];if(Aq){Ao.updateProperties(Ae,Ab,Aj);}Ao.handlePropValChange(Aj,Ae,Ab,Ad);}}if(Ad&&Ac){Ac.success();}};for(Aj in An){Ak[Aj]={};Ah=An[Aj];for(Ae in Ah){AZ=this.getPropertyValue(Ae,Aj);Ab=Ah[Ae];Aa=this.updateProperties(Ae,Ab,Aj);if(Aa){Ak[Aj][Ae]=AZ;Ag=true;}else{delete An[Aj][Ae];}}}if(Ag){Al(An,false);Af={silent:true,undo:function(){Al(Ak,true);},redo:function(){Al(An,true);}};this.submitMapUpdates({urInfo:Af},Ad);}else{if(Am){Al(An,false);}}},handleLegendConCloseChange:function f(Ad,AZ){var Ac,Ae=this,Af=Ae.id,Ag=[],Ab=true,Aa=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ai,Ah=function(Ak,Aj){K.forEach(Ak,function(Al){Ai=mstrmojo.all[Af];if(!Ai){return ;}Ai.updateProperties(Ad,Aj,Al);Ai.handlePropValChange(Al,Ad,Aj,Ab);});if(Ab&&Aa){Aa.success();}};K.forEach(Ae.layerIdxMappingArr,function(Aj){Ae.updateProperties(Ad,AZ,Aj);Ag.push(Aj);});if(Ag.length){Ah(Ag,AZ);Ac={silent:true,undo:function(){Ah(Ag,true);},redo:function(){Ah(Ag,false);}};this.submitMapUpdates({urInfo:Ac},Ab);}},handleLegendSwitch:function r(Aj,Ab){var Ac,Ae=this,Ai=Ae.id,Aa=true,AZ=this.zonesModel&&this.zonesModel.getUpdateCallback(),Al,Ah=this.getPropertyValue(AQ,Aj),Ag=Ah==="true"||Ah===true,Ad=this.isLegendExist(Aj),Af=this.getPropertyValue(o),Ak=function(Ap,Aq,Ar,Am,As){var An,Ao=Am;Al=mstrmojo.all[Ai];if(!Al){return ;}An=Al.getPropertyBelongingKey(o);if(As){Al.updateProperties(AQ,Aq,Ap);}if(!Ar){if(!Aq){Al.removeLegendBySwitchProp(Ap);}else{if(Al.createSingleLegend(Ap)){Al.resetLegendContainerHeight();Ao=Al.getLegendConSizeProp();}}Al.updateProperties(o,Ao,An);Al.handlePropValChange(An,o,Ao,Aa);}Al.handlePropValChange(Ap,AQ,Aq,Aa);if(Aa&&AZ){AZ.success();}};if(Ae.updateProperties(AQ,Ab,Aj)){Ak(Aj,Ab,Ad,Af,false);Ac={silent:true,undo:function(){Ak(Aj,Ag,Ad,Af,true);},redo:function(){Ak(Aj,Ab,Ad,Af,true);}};this.submitMapUpdates({urInfo:Ac},Aa);}},handleShowAllLegends:function G(Ah){var Ab,Ac=this,Ae=Ac.id,Ag={},Aa=true,AZ=this.zonesModel&&this.zonesModel.getUpdateCallback(),Aj,Af=!Ah,Ad=this.getPropertyValue(o),Ai=function(Ar,Ap,Ak){var Am,An=Ak,Aq=false,Al=false;Aj=mstrmojo.all[Ae];if(!Aj){return ;}Am=Ac.getPropertyBelongingKey(o);for(var Ao in Ar){Aj.updateProperties(AQ,Ap,Ao);if(Ar[Ao]===false){Al=true;if(Ap){if(Aj.createSingleLegend(Ao)){Aq=true;}}else{Aj.removeLegendBySwitchProp(Ao);}}}if(Al){if(Aq){Aj.resetLegendContainerHeight();An=Aj.getLegendConSizeProp();}Aj.updateProperties(o,An,Am);Aj.handlePropValChange(Am,o,An,Aa);}for(var Ao in Ar){Aj.handlePropValChange(Ao,AQ,Ap,Aa);}if(Aa&&AZ){AZ.success();}};K.forEach(Ac.layerIdxMappingArr,function(Ak){if(Ac.updateProperties(AQ,Ah,Ak)){Ag[Ak]=Ac.isLegendExist(Ak);}});if(Ag!=={}){Ai(Ag,Ah,Ad);Ab={silent:true,undo:function(){Ai(Ag,Af,Ad);},redo:function(){Ai(Ag,Ah,Ad);}};this.submitMapUpdates({urInfo:Ab},Aa);}},closeLegendConWithSizeUpdate:function A(){var Ad,Af=this,Ag=Af.id,Aa=[],Ac=true,Ab=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ai,Ae=this.getLegendConSizeProp(),AZ=this.getPropertyValue(o),Ah=function(Al,Am,Ak){var Aj;Ai=mstrmojo.all[Ag];if(!Ai){return ;}Aj=Af.getPropertyBelongingKey(o);Ai.updateProperties(o,Ak,Aj);Ai.handlePropValChange(Aj,o,Ak,Ac);K.forEach(Al,function(An){Ai.updateProperties(AQ,Am,An);Ai.handlePropValChange(An,AQ,Am,Ac);});if(Ac&&Ab){Ab.success();}};K.forEach(Af.layerIdxMappingArr,function(Aj){if(Af.updateProperties(AQ,false,Aj)){Aa.push(Aj);}});if(Aa.length){Ah(Aa,false,Ae);Ad={silent:true,undo:function(){Ah(Aa,true,AZ);},redo:function(){Ah(Aa,false,Ae);}};this.submitMapUpdates({urInfo:Ad},Ac);}},handleLegendCollapse:function j(Ag,Ah){var Ab,Ad=this,Af=Ad.id,Aa=true,AZ=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ak,Ac=parseInt(this.getPropertyValue(W,Ag)),Aj=this.getLegendConSizeProp(),Ae=this.getPropertyValue(o),Ai=function(Ao,Al,An,Ap){var Am;Ak=mstrmojo.all[Af];if(!Ak){return ;}Am=Ad.getPropertyBelongingKey(o);if(Ap){Ak.updateProperties(W,Al,Ao);Ak.handlePropValChange(Ao,W,Al,Aa);}Ak.updateProperties(o,An,Am);Ak.handlePropValChange(Am,o,An,Aa);if(Aa&&AZ){AZ.success();}};if(Ad.updateProperties(W,Ah,Ag)){Ai(Ag,Ah,Aj,false);Ab={silent:true,undo:function(){Ai(Ag,Ac,Ae,true);},redo:function(){Ai(Ag,Ah,Aj,true);}};this.submitMapUpdates({urInfo:Ab},Aa);}},handleLegendConStatusChange:function q(Af,Aa){var Ae,Ag=this,Ah=Ag.id,Ai=this.getGridKey(),AZ=this.getPropertyValue(Af,Ai),Ab=this.updateProperties(Af,Aa,Ai),Ad=true,Ac=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ak,Aj=function(Al){K.forEach(Ag.layerIdxMappingArr,function(Am){Ak=mstrmojo.all[Ah];if(!Ak){return ;}Ak.updateProperties(Af,Al,Am);Ak.handlePropValChange(Am,Af,Al,Ad);});if(Ad&&Ac){Ac.success();}};if(Ab){Aj(Aa);if(Af===C.SCALE_LEGEND_WIDTH){AZ=Aa?-Aa:0;}Ae={silent:true,undo:function(){Aj(AZ);},redo:function(){Aj(Aa);}};this.submitMapUpdates({urInfo:Ae},Ad);}},saveGraphicLayerOrder:function AR(AZ,Ab){var Aa,Ae=this.id,Ad=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ac=function(Af){var Ag=mstrmojo.all[Ae];if(!Ag){return ;}Ag.updateEditingLayerIdx(Af.edtIdx);Ag.layerIdxMappingArr=Af.idxMap.slice(0);Ag.refreshLegendNodes();Ag.updateGraphicLayerOrder(Af.startIdx);if(Ad){Ad.success();}};Ac(Ab);Aa={silent:true,undo:function(){Ac(AZ);},redo:function(){Ac(Ab);}};this.submitMapUpdates({urInfo:Aa},true);},saveGraphicLayerVisibleInfo:function l(AZ,Ab){var Aa,Ae=this.id,Ad=this.zonesModel&&this.zonesModel.getUpdateCallback(),Ac=function(Ag){var Ak=mstrmojo.all[Ae],Ai=Ak&&Ak.mapViewer,Am,Al,Aj,Ah,Af;if(!Ag||!Ai||!Ak){return ;}for(Ah in Ag){Aj=Ag[Ah];Al=Aj.isVisible?"0":"1";Ak.updateProperties(u.isHidden,Al,Ah);Am=Ai.getGraphicLayer(Ah);Af=Am.isVisible();if(!Af){Am.setVisibility(false);}else{Am.updateGraphics();}Ak.handleLegendOnLayerVisibleChange(Ah);}if(Ad){Ad.success();}Ai.updateBaseMap();};Ac(Ab);Aa={silent:true,undo:function(){Ac(AZ);},redo:function(){Ac(Ab);}};this.submitMapUpdates({urInfo:Aa},true);},saveGraphicLayerInfoHTML:function AT(AZ,Ab){var Aa,Ad=this.id,Ac=function(Ae){var Ai=mstrmojo.all[Ad],Ag=Ai&&Ai.mapViewer,Ak,Ah,Af,Aj;if(!Ae||!Ag||!Ai){return ;}for(Af in Ae){Ah=Ae[Af];Aj=Ah.value;Ak=Ag.getGraphicLayer(Af);if(Ak){Ai.updateProperties(u.customInfoWinTpl,Ak.replaceInfoWindowHTMLMacros(Aj),Af);Ak.setInfoWindowHTML(Aj);}}};Ac(Ab);Aa={silent:true,undo:function(){Ac(AZ);},redo:function(){Ac(Ab);}};this.submitMapUpdates(Aa,true);},saveZoomLevelandPosition:function E(){var Aj=this.getDocModel(),AZ=this.mapViewer,Ai=AZ&&AZ.baseLayer,Ag=this.getProperties(),Ah=Ag[u.zoomSetting]!==m.Automatic,Ab=Ag[u.keepZoomAndPos]===true||Ag[u.keepZoomAndPos]==="true",Af,Ae;if(!Ah||!Ab||!mstrApp||!Aj||!Ai){return ;}Af=Ai.getMapZoomAndPosition();if(B(Ai,Ag,Af)){return ;}this.updateProperties(u.zoomLevel,Af[u.zoomLevel]);this.updateProperties(u.mapCenter,JSON.stringify(Af[u.mapCenter]));if(Af.supportBearingAndPitch){this.updateProperties(u.mapBearing,Af[u.mapBearing]);this.updateProperties(u.mapPitch,Af[u.mapPitch]);}Ae=this.getUpdateLayersFormatActions();var Ac={actions:Ae,style:{params:{treesToRender:2},name:"RWIVEMojoStyle"}},Aa={preserveUndo:false,silent:true,doNotHold:true},Ad={taskId:"mojoRWManipulation",rwb:Aj.bs,messageID:Aj.mid,stateID:-1,params:JSON.stringify(Ac),styleName:"RWIVEMojoStyle",suppressData:true,zoomFactor:Aj.getZoomFactor(),saveZoomLevelandPosition:true};mstrApp.serverProxy.request({},Ad,false,Aa);},autoSaveZoomAndPos:function X(){if(!mstrApp.isDossier){return ;}if(!this.autoSavingFunc){this.autoSavingFunc=d.debounce(this.saveZoomLevelandPosition,200);}this.autoSavingFunc();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.vi.viz.MapHelper","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils");var X=mstrmojo.vi.viz,K=mstrmojo.array,V=mstrmojo.func,S=X.MapHelper,E=mstrmojo.gmaps,R=E.MapUtils,G=E.EnumPropertyType;mstrmojo.gmaps._LayerManipulation=mstrmojo.provide("mstrmojo.gmaps._LayerManipulation",{_mixinName:"mstrmojo.gmaps._LayerManipulation",_isUndo:null,addMapLayer:function Z(){this.submitMapUpdates(this.getUpdatesInfoForAddLayer(),false);},removeMapLayers:function U(c){var b=this.layerIdxMappingArr;if(!K.isArray(c)||!K.isArray(b)){return ;}if(c.length<b.length){this.submitMapUpdates(this.getUpdatesInfoForRemoveMultiLayers(c),true);}else{this.reset();}},getResetMapUpdatesInfo:function N(){var c=this.getUpdatesInfoForRemoveAllLayers(),b;this.layerCount=0;b=this.wrapUpdatesInfo(this.getUpdatesInfoForAddLayer(),c)||{};b.treesToRender=3;return b;},getUpdatesInfoForRemoveAllLayers:function C(){return this.getUpdatesInfoForRemoveMultiLayers(this.layerIdxMappingArr);},getUpdatesInfoForRemoveMultiLayers:function D(c){var b={},d=K.isArray(c)&&c.slice();K.forEach(d,function(e){b=this.wrapUpdatesInfo(this.getUpdatesInfoForRemoveLayer(e),b);},this);return b;},getUpdatesInfoForAddLayer:function Q(g){var d=K.isArray(g)?g:[],h=this.id,k=this.getDocModel(),i=this.createDefaultVp(),b=this.getEditingLayerIdx(),f=i[G.layerIdx],c,e,j;this.updateEditingLayerIdx(f);j=k.addMapLayerActions(this,d,S.getXmlFromJson(i),i[G.layerName]);c={layerKey:j,editingIdx:f};this.syncLayerProperties(i,c);e=this._getUndoRedoInfoForAddLayer(j,b,c);return{actions:d,requestCallback:{success:function(l){var m=mstrmojo.all[h];k.updateDefnCache(l.defn,[j]);k.updateDataCache(l.data,k.getTargetDefn(j));m.addLayerCallback(c,l);m.layerCount++;}},urInfo:e,treesToRender:3};},getUpdatesInfoForRemoveLayer:function O(d){var h=[],b=this.getDocModel(),e=b&&b.clearVisAsFilterActionForMapLayer(this.parent,this.fnGetWidget(d),true),g=this.zonesModel,c,f;if(e&&e.actions){h=h.concat(e.actions);}c=this._getUndoRedoInfoForRemoveLayer(d,e);c.redo();if(this.isPrimaryKey(d)){if(g){f=g.getClearAllUnitsActions(d);h.push(g.getUpdateTemplateAction(f,d));}}else{b.removeMapLayerActions(this,d,h);}return{actions:h,urInfo:c};},_getUndoRedoInfoForAddLayer:function M(f,d,c){var e=this.id,b=this.getDocModel();if(!b){return{};}return{undo:function(){var g=b.getLayoutUnitDefn(f),h=mstrmojo.all[e];g._isDeleted=true;h.removeLayerCallback(f,d);h._isUndo=true;return true;},redo:function(){var g=b.getLayoutUnitDefn(f),h=mstrmojo.all[e];delete g._isDeleted;h._isUndo=false;return false;},callback:{success:function(g){var h=mstrmojo.all[e];if(!h._isUndo){h.addLayerCallback(c,g);}}},treesToRender:2};},_getUndoRedoInfoForRemoveLayer:function B(c,d){var e=this.id,b=this.getDocModel(),f=this.isPrimaryKey(c);if(!b){return{};}return{undo:function(){var h=mstrmojo.all[e];if(f){h.updateProperties(G.isRemoved,"0",c);}else{var g=b.getLayoutUnitDefn(c);delete g._isDeleted;}h._isUndo=true;return false;},redo:function(){var h=mstrmojo.all[e];if(f){h.updateProperties(G.isRemoved,"1",c);}else{var g=b.getLayoutUnitDefn(c);g._isDeleted=true;}h.removeLayerCallback(c);h._isUndo=false;return true;},callback:this.getUndoRedoCallbackForRemoveLayer(c,d),treesToRender:2};},getUndoRedoCallbackForRemoveLayer:function T(c,e){var f=this.id,d={layerKey:c,editingIdx:this.getEditingLayerIdx()},b={success:function(g){var h=mstrmojo.all[f];if(h._isUndo){h.addLayerCallback(d,g);}}};this.syncLayerProperties(this.getProperties(c),d);if(e&&K.isArray(e.actions)&&e.actions.length>0&&e.callback){b=V.wrapMethods(b,e.callback);}return b;},addLayerCallback:function F(b,f){if(!b){return ;}var h,e,i=this.getDocModel(),g=b.layerKey,d=this.builder,j=this.model.data,c=j&&j.sdp;if(!this.isPrimaryKey(g)&&i&&f){i.updatePrimaryScdpMap(this.k,g,true);e=i.getMapLayerDataByLayerKey(g);if(c){c[g]=e;}if(d&&e){h=this.createSdpXtab(g,i,e,this.getVisName(e));this.syncPropsForSdpXtab(h);}}this.addGraphicLayerCallback(b);},removeLayerCallback:function I(e,g){if(!this.isPrimaryKey(e)){var f=this.fnGetWidget(e),d=this.model.data,c=this.getDocModel(),b=d&&d.sdp;if(b){delete b[e];}c.updatePrimaryScdpMap(this.k,e,false);this.unRegisterSdpInDocModel([e]);if(f&&f.destroy){f.destroy();}}this.removeGraphicLayerCallback(e,g);},handleZoomThroughLayerChange:function A(){if(this.isMapbox()&&R.checkHasFunction(this,"onLayerZoomRangeChange")){this.onLayerZoomRangeChange();}},addGraphicLayerCallback:function W(f){var g=f.layerKey,e=f[G.layerIdx],d=this.getGridData(g),c=this.mapViewer,b=this.layerIdxMappingArr;if(!d||!c||!b){return ;}R.showWait();b.splice(e,0,g);this.updateGraphicLayerOrder(e);this.updateEditingLayerIdx(f.editingIdx);this.syncLayerProperties(f,this.getProperties(g));c.addGraphicLayer(d);this.handleZoomThroughLayerChange();c.highlightAllLayers();this.layerZoneCacheInfo=null;this.findSelectorControl();this.refreshDzPropPanels();R.hideWait();},removeGraphicLayerCallback:function P(e,g){if(!e){return ;}var d=this.mapViewer,c=this.layerIdxMappingArr,b=K.indexOf(c,e),f=this.widgetIdMapping;if(!d||!c||b<0){return ;}R.showWait();c.splice(b,1);this.updateGraphicLayerOrder(b);if(R.checkVal(g)){this.updateEditingLayerIdx(g);}else{this.resetEditingLayerIdx(b);}d.removeGraphicLayer(e);if(f){delete f[e];}this.handleZoomThroughLayerChange();d.highlightAllLayers();this.findSelectorControl();this.layerZoneCacheInfo=null;this.refreshDzPropPanels();this.raiseEvent({name:"toggleCtrlOverlay",visible:this.isEmpty()||this.excludeData,controls:this.getVisEmptyMsgControls()});this.applyBackground();R.hideWait();},renameGraphicLayerCallback:function a(c,b){if(!!c&&!!b){this.writeProperties(G.layerName,b,c);}},layerDroppedCallback:function Y(d,h){var i=this.layerIdxMappingArr,j=this.getEditingLayerIdx(),e={edtIdx:j,idxMap:i.slice(0)},c={},b,f,g;h=parseInt(h);if(!this.k||isNaN(j)||!K.isArray(d)||isNaN(h)||!i||!K.isArray(i)||(d.length===1&&d[0]===h)){return ;}g=Math.min(Math.min.apply(Math.min,d),h);b=this.reorderLayerItems(d,h);f=K.indexOf(i,b);c.edtIdx=f;c.idxMap=i.slice(0);c.startIdx=e.startIdx=g;this.saveGraphicLayerOrder(e,c);},reorderLayerItems:function H(e,f){var c=this.layerIdxMappingArr,b=[],g="#",d;if(!K.isArray(e)||!K.isArray(c)){return ;}this.layerZoneCacheInfo=null;K.forEach(e,function(h){b.push(c[h]);c[h]=g;});K.insert(c,f,b);for(d=c.length-1;d>=0;d--){if(c[d]===g){c.splice(d,1);}}return b[0];},updateGraphicLayerOrder:function J(g){var c=this.layerIdxMappingArr,f=this.mapViewer,h=G.layerIdx,e,d,b;g=parseInt(g);if(!f||!c||!K.isArray(c)||isNaN(g)){return ;}for(d=g,b=c.length;d<b;d++){e=c[d];if(!!e){this.updateProperties(h,d,e);}}f.reorderGraphicLayers(c.slice(g));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.dom","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils");var c=mstrmojo,N=c.gmaps,J=c.dom,Q=c.array,P=N.MapUtils,U=N.EnumDataLabelShowOption,V=c.emptyFn,M=20;function H(i){if(i){clearTimeout(i);}}mstrmojo.gmaps.layer.AbstractGraphicLayerViewer=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gmaps.layer.AbstractGraphicLayerViewer",key:null,parent:null,graphics:null,graphicType:null,markerType:null,isCluster:false,applyThreshold:true,updateStartTime:null,_updateStartIdx:0,getVisMap:function T(){var i=this.parent;if(i){return i.map;}},getWidth:function F(){var i=this.parent;if(i){return i.getWidth();}},getHeight:function R(){var i=this.parent;if(i){return i.getHeight();}},getGraphicsOffset:function O(){var i=this.parent;if(i){return i.getGraphicsOffset();}},setVisibility:function W(i){var j=this.getNode();if(j&&j.style){j.style.display=(!!i)?"block":"none";}},resize:function e(m,i){var l=this.getNode(),n=this.svgNode,k=J.position(l),j=k.w,o=k.h;if(P.checkVal(i)&&P.checkVal(m)&&!(i===o&&m===j)){i=parseInt(i);m=parseInt(m);P.setCssStyles(l,{height:i+"px",width:m+"px"});P.setCssStyles(n,{height:i+"px",width:m+"px"});}},getMapZoom:function f(){var i=this.getMapInstance();if(i){return i.getZoom();}},getNode:V,setTransform:V,clean:V,update:V,setShapeFillColor:V,setShapeFillOpacity:V,setShapeStrokeColor:V,setShapeStrokeStyle:V,getMapInstance:function S(){var i=this.execMethodOfParent("getBaseLayer");if(i){return i.getBaseMap();}},getFmts:function B(){return this.execMethodOfParent("getLayerFmts");},hasSizeby:function I(){return this.execMethodOfParent("hasSizeByMetric");},isVisible:function Y(){return this.execMethodOfParent("isVisible");},hasThreshold:function h(){return this.execMethodOfParent("hasColorByMetric");},hasColorByAttr:function K(){return this.execMethodOfParent("hasColorByAttribute");},hasColorBy:function A(){return this.hasThreshold()||this.hasColorByAttr();},getLabelOffset:function b(){return[0,0];},getFontSize:function E(){var i=this.execMethodOfParent("getLabelConfig");if(i){return parseInt(i.dlFontStyle.fontSize);}},execMethodOfParent:function G(i){var j=this.parent;if(i&&P.checkHasFunction(j,i)){return j[i]();}else{console.log("method doesn't exist");}},setLayerZIndex:function a(j){var i=this.getNode();if(i&&i.style&&P.checkVal(j)){i.style.zIndex=parseInt(j);}},needLabel:function X(){var i=this.execMethodOfParent("getLabelConfig");return !!i&&i.dlShowOption!==U.NONE;},getGraphicsContained:function g(o){var l=[],k=this.graphics,n,m,j;if(!k||k.length<1){return ;}for(m=0,j=k.length;m<j;m++){n=k[m];if(n&&(n.intersect(o)===true)){l.push(n);}}return l;},updateGraphicsPositionInScreen:function D(k){var p=this.graphics,o=(p&&p.length)||0,l=o,n=this,m=(new Date()).valueOf(),j=this._updateStartIdx;if(!this.updateStartTime){this.updateStartTime=m;}this._updateStartIdx=(P.checkVal(j))?j:0;(function q(){var s=n.graphics,t,r=n._updateStartIdx,i=new Date();if((m!==n.updateStartTime)||!Q.isArray(s)||s.length<1||!k){H(n.updateGraphicTimer);l=o;r=n._updateStartIdx=0;n.updateStartTime=m;}if(l<=0){H(n.updateGraphicTimer);n.parent.callbackForUpdateGraphics();n.updateStartTime=null;return ;}while(l>0){t=s[r<o?r:0];if(P.checkHasFunction(t,"updatePosition")){t.updatePosition(k.getScreenPositionInfo(t));}l--;r++;if((new Date()-i)>=M){break;}}n._updateStartIdx=(r>=o)?0:r;H(n.updateGraphicTimer);n.updateGraphicTimer=setTimeout(q,0);})();},stopUpdate:function Z(){if(this.updateGraphicTimer){clearTimeout(this.updateGraphicTimer);}},setMarkerType:V,updateDataLabelLayer:V,highlightGraphics:V,desolveClustersIfZoomChanged:c.emptyFn,clearHighlights:function C(i){Q.forEach(i,function(j){j.setSelection(false);},this);},destroy:function d(){delete this.parent;delete this.graphics;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.gmaps.MapUtils");var J=mstrmojo.gmaps.MapUtils;mstrmojo.gmaps._MapAffinityLine=mstrmojo.provide("mstrmojo.gmaps._MapAffinityLine",{_mixinName:"mstrmojo.gmaps._MapAffinityLine",aftTempFirstAttrIndex:0,aftTempSecondAttrIndex:-1,aftTempSecnodMetricIndex:-1,aftTempMetricMaxVal:-Infinity,affinityLineDefaultColor:undefined,affinityLineGraphicsConfig:undefined,createAffinityLinesConfig:function E(){if(!this.wpDisPlayAffinityLines){return ;}var Y=this.secondaryModel;if(!Y){mstrmojo.alert(mstrmojo.desc(10366,"Secondary data provider could not be found. In order to see the Affinity Lines, please reset the secondary data provider in the design mode."),null,mstrmojo.desc(14815,"Affinity Lines Error"));return ;}if(this.findAftTempAttrIndices()===-1){return ;}if(this.useAttribute&&!this.checkLookUpAttrInAftTemp()){mstrmojo.alert(mstrmojo.desc(10367,"Lookup Attribute must be present in the affinity data provider."),null,mstrmojo.desc(14815,"Affinity Lines Error"));return ;}if(Y.getColTitles().size()===0){mstrmojo.alert(mstrmojo.desc(10368,"No Metric is present on the secondary data provider."),null,mstrmojo.desc(14815,"Affinity Lines Error"));return ;}this.computeAftTempMetricMaxVal();this.findAftTempSecondMetricIndex();if(!this.affinityLineDefaultColor){this.affinityLineDefaultColor=this.parent.getNextDefaultAffinityLineColor();}var S=this.affinityLineGraphicsConfig=[];var Q,T,W,X,R,a,O,V,Z,P,U=Y.getTotalRows();for(W=0;W<U;W++){a=Y.getRowHeaders(W);O=a.getHeader(this.aftTempFirstAttrIndex);V=a.getHeader(this.aftTempSecondAttrIndex);Q=this.getElementIdWithoutAttributeID(O.getElementId());T=this.getElementIdWithoutAttributeID(V.getElementId());Z=this.markerElementIDs[Q];P=this.markerElementIDs[T];if(!Z||!P){continue;}X=this.getAffinityLineColor(W);R=this.getAffinityLineThickness(W);S.push({sourceLocation:Z,destLocation:P,strokeColor:X,strokeWidth:R});}},isAffinityLineShown:function K(){if(this._viewer&&(typeof this._viewer.isAffinityLineShown==="function")){return this._viewer.isAffinityLineShown();}return false;},isAffinityLineHide:function H(){if(this._viewer&&(typeof this._viewer.isAffinityLineHide==="function")){return this._viewer.isAffinityLineHide();}return true;},showAffinityLineLayer:function M(){var O=this._viewer;if(J.checkHasFunction(O,"showAffinityLineLayer")){return O.showAffinityLineLayer();}},hideAffinityLineLayer:function I(){var O=this._viewer;if(J.checkHasFunction(O,"hideAffinityLineLayer")){return O.hideAffinityLineLayer();}},isAffinityLineLayerEnabled:function F(){return this.wpDisPlayAffinityLines;},findAftTempAttrIndices:function A(){var Q,R,O=this.secondaryModel.getRowTitles(),P=O.size();if(P<2){return -1;}R=O.getTitle(0).getUnitId();for(Q=1;Q<P;Q++){if(O.getTitle(Q).getUnitId()!==R){this.aftTempSecondAttrIndex=Q;return Q;}}return -1;},findAftTempSecondMetricIndex:function D(){var O=this.secondaryModel.getColTitles().getTitle(0).getHeaderValues();this.aftTempSecnodMetricIndex=(O.length>1)?1:-1;},checkLookUpAttrInAftTemp:function C(){var O=this.secondaryModel.getRowTitles(),P=O.size();for(var Q=0;Q<P;Q++){if(O.getTitle(Q).getUnitId()===this.wpLookupAttId){return true;}}return false;},computeAftTempMetricMaxVal:function G(){var V,P,U,R,T,S=-Infinity,O=this.secondaryModel,Q=O.getTotalRows();for(V=0;V<Q;V++){P=O.getMetricValue(V,0);U=P.getValue();if(U){T=P.getRawValue();R=parseFloat(!T?this.stripNumberFormat(U):T);S=(R>S)?R:S;}}this.aftTempMetricMaxVal=S;},getAffinityLineColor:function B(Q){var O=this.secondaryModel,P=this.getThresholdInfo(Q,0,O);if(this.aftTempSecnodMetricIndex!==-1){P=this.getThresholdInfo(Q,this.aftTempSecnodMetricIndex,O);}return P?P.colorStr:this.affinityLineDefaultColor;},getAffinityLineThickness:function N(T){var O=this.secondaryModel.getMetricValue(T,0),R=O.getValue(),Q=1,S,P;if(R){S=O.getRawValue();P=parseFloat(!S?this.stripNumberFormat(R):S);Q=(P*this.wpMaxLineThickness)/this.aftTempMetricMaxVal;}return Q;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.vi.enums.EnumFilterClearActionType","mstrmojo.vi.enums.EnumVisFilterType");var S=mstrmojo.hash,P=mstrmojo.array,b=mstrmojo.gmaps.SelectionHashType,N=mstrmojo.gmaps.MapUtils,K=mstrmojo.vi.enums.EnumFilterClearActionType,R=mstrmojo.vi.enums.EnumVisFilterType,I="OA:(All)";mstrmojo.gmaps._MapDataSelectionHelper=mstrmojo.provide("mstrmojo.gmaps._MapDataSelectionHelper",{_mixinName:"mstrmojo.gmaps._MapDataSelectionHelper",showData:function Q(){var e;this.selectionHashType=b.RMC_LAYER;if(!this.gridData){e=this.getXtabForSelection();if(!e){e=this;}this.gridData=e&&e.getData();}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);},endSelections:function V(){if(N.isOIVM()){this.selectionHashType=b.TEMPLATE_SELECTION;this._super();}},raiseGraphicsSelectedEvent:function A(){if(N.isEmbedded()){var f=this.mapViewer,e=[];f.forEachGraphicLayer(function(g){e.push({key:g.key,name:g.getLayerName(),graphics:g.getSelectedGraphicsInfo()});},true);mstrApp.raiseEvent({name:"graphicsSelected",value:{graphics:e,vizKey:this.k}});}},handleTemplateUnitSelections:function H(e){if(!N.isVI()){var f=this.mapViewer,g=[];f.forEachGraphicLayer(function(h){h.addTemplateUnitSelection(g);},null,true);g=this.reorderTemplateSelectionActions(g);if(g.length>0&&(!S.equals(g,this.lastTemplateUnitSelection)||e)){this.submitTemplateUnitSelection(g);this.lastTemplateUnitSelection=g;}}},reorderTemplateSelectionActions:function M(g){var e=[],f=[];P.forEach(g,function(h){if(h&&h.eid===I){e.push(h);}else{f.push(h);}});return e.concat(f);},getGraphicLayerForTemplateSelection:function c(){var f=this.getKeyForTemplateSelection(),e=this.mapViewer;return e.getGraphicLayer(f);},getGraphicLayerForSelection:function D(){var e,f=this.mapViewer;switch(this.selectionHashType){case b.PRIMARY:e=this.k;break;case b.TEMPLATE_SELECTION:e=this.getKeyForTemplateSelection();break;case b.EDITING_LAYER:e=this.getEditingGridKey();break;case b.RMC_LAYER:e=this.RMCSelectedLayerKey||this.k;break;default:e=this.k;}return f&&f.getGraphicLayer(e);},getXtabForSelection:function Z(){var f=this.getGraphicLayerForSelection(),e=f&&f.getXtab();return e;},getSelectionHash:function J(){var e=this.getGraphicLayerForSelection();return e&&e.getSelectionHash();},getSelectionSize:function a(){var e=this.getSelectionHash();return(e&&S.keyarray(e).length)||0;},getSelectionType:function(){var e=this.getGraphicLayerForSelection();return e&&e.getSelectionType();},getContextMenuSelectionHash:function X(){var e=this.getGraphicLayerForSelection();return e&&e.getContextMenuSelectionHash();},getContextMenuSelectionType:function(){var e=this.getGraphicLayerForSelection();return e&&e.getContextMenuSelectionType();},deleteSelectorControl:function F(){var e=this.getKeyForTemplateSelection(),f=this.getGridData(e),g=f.sc;if(g&&parseInt(g.ct,10)===6){delete f.sc;}},findSelectorControl:function U(){var f=this.getKeyForTemplateSelection(),g=this.getGridData(f),e=g&&g.sc;if(e&&parseInt(e.ct,10)===6){this.selectorControl=e;this.isMultiSelect=true;}else{delete this.selectorControl;}this.controller=!!this.model?this.model.controller:null;this.sid=g&&g.sid;return this.selectorControl;},isSupportViewFilterForSelection:function G(f){var e=this.getGraphicLayerForTemplateSelection();return e&&e.supportsViewFilterActions(f);},getAssociatedNodes:function d(){var e=this.getGraphicLayerForTemplateSelection();return e&&e.getAssociatedNodes();},submitTemplateUnitSelection:function C(f){if(N.isOIVM()){var e={};P.forEach(f,function(g){e[g.key]=g;});(mstrApp.docModel||this.parent.model.docModel).slice({events:e});}else{microstrategy.updateManager.add(f);microstrategy.updateManager.flushAndSubmitChanges();}},getSelectorObjectsFromViewFilter:function W(){var g=this,f=g.mapViewer,e={};if(f){f.forEachGraphicLayer(function(k){var j=k.getXtab(),i=k.key,h=j&&j.getSelObjsFromVFHandler&&j.getSelObjsFromVFHandler();if(h&&h.length>0){e[i]=h;}},false,true);}return e;},getSelectorObjectsFromTemplateLimit:function O(){var g=this,f=g.mapViewer,e={};if(f){f.forEachGraphicLayer(function(k){var j=k.getXtab(),i=k.key,h=j&&j.getSelObjsFromTemlateLimitHandler&&j.getSelObjsFromTemlateLimitHandler();if(h&&h.length>0){e[i]=h;}},false,true);}return e;},getFilterMenuPairs:function T(q){var n=this,g=[],e=this.mapViewer,s=mstrmojo.desc(2827,"Clear"),j,h,i,m,p,r,o,l,f,k;for(p in q){r=q[p];h=e.getGraphicLayer(p);i=h&&h.getLayerName();o=r.length;for(k=0;k<o;k++){l=r[k];j=n.getSelectorExpr(l);f=n.getSelectorExpr(l,true);m=p+";"+k;if(j){g.push({menuString:i+": "+s+' "'+j+'"',menuTtpString:i+": "+s+' "'+f+'"',ctxt:m});}}}return g;},filterMenuHandler:function Y(e,k){var h,i,g,f=this.controller,j;switch(e.type){case K.CLEAR_KEEP_ONLY:e=e.idx;if(e&&e.split&&e.split instanceof Function){h=e.split(";");if(h&&h.length===2){i=h[0];g=parseInt(h[1],10);}}else{g=e;}j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,g,i);f.applyKeepOnlyForMutilTemplate(j,k);break;case K.CLEAR_ALL:j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,-1,undefined);f.clearFiltersForVisMultipleTemplate(j,[R.KEEP_ONLY,R.LINKING,R.DRILLING],k);break;case K.CLEAR_ADV_QUALIFICATION:j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,undefined,undefined);f.clearFiltersForVisMultipleTemplate(j,[R.ADV_QUALIFICATION],k);break;case K.CLEAR_KEEP_ONLY_AND_LINKING:j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,undefined,undefined);f.clearFiltersForVisMultipleTemplate(j,[R.KEEP_ONLY,R.LINKING],k);break;case K.CLEAR_LINKING:j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,undefined,undefined);f.clearLinkingMultiFilter(e,j,k);break;case K.CLEAR_DRILLING:j=this.constructSelectionInfos&&this.constructSelectionInfos(null,true,undefined,undefined);f.clearFiltersForVisMultipleTemplate(j,[R.DRILLING],k);break;default:break;}},hasKeepOnly:function E(e){return e===null||Object.keys(e).length>0;},genSelectionMapping:function B(){var f=this.mapViewer,e={};if(f){f.forEachGraphicLayer(function(g){e[g.key]={selType:g.getSelectionType(),selHash:g.getSelectionHash()};});}return e;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.PerformanceLogOutput");var B=mstrmojo,C=B.gmaps.MapUtils,E=B.PerformanceLogOutput;mstrmojo.gmaps.basemap._CanLoadMapExternalScript=mstrmojo.provide("mstrmojo.gmaps.basemap._CanLoadMapExternalScript",{_mixinName:"mstrmojo.gmaps.basemap._CanLoadMapExternalScript",callback:null,jsURL:null,loadJsScript:function A(I,H,G){var K=this;this.callback=H;if(!I){return ;}C.loadExternalScript(I,function M(){E.endTimer("timerid_callback_LoadMainModule");E.visPrint("Load Map modules start");var N=E.startTimer({functionName:"_CanLoadMapExternalScript.loadMainModule: "+I,purpose:"Load Map Modules"});K.loadMainModule();E.endTimer(N);E.visPrint("Load Map modules end");},function J(){if(G){K.loadMap(G);}});},getURL:function D(G){var H=mstrApp.isSingleTier?"http:":window.location.protocol;return H+G;},loadMap:function F(I){if(!I){return ;}E.visPrint("Load and create map start");var M=E.startTimer({functionName:"_CanLoadMapScript.loadMap: ",purpose:"Load map, and create map, sync"});var N,J,P=[],H,G,O,K=I.loadScriptListeners.length;this.callback.call(this);P.push({caller:this,method:this.callback});for(N=0;N<K;N++){G=I.loadScriptListeners[N];O=false;for(J=0;J<P.length;J++){H=P[J];if(G.caller===H.caller&&G.method===H.method){O=true;break;}}if(!O){G.method.call(G.caller);P.push({caller:G.caller,method:G.method});}}E.endTimer(M);E.visPrint("Load and create map end");E.startTimer({functionName:"_CanLoadMapScript.loadMap: ",purpose:"time gap between map creation and render graphics"},"timerid_callback_handleExtentChange");}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils");var X=mstrmojo,N=X.array,G=X.gmaps,K=G.MapUtils,b=G.LAYER_INDEX_MAX,E=G.EnumBaseMapType;function H(d,g,f){if(!N.isArray(d)||!N.isArray(g)){return ;}var c=g[0],e,h;if(c.isSelected()){e=c.getGraphicsForSelection();h=N.intersection(e,d,"id");if(f||(e.length===d.length&&d.length===h.length)){return false;}}return true;}mstrmojo.gmaps.layer._LayerInteractivity=mstrmojo.provide("mstrmojo.gmaps.layer._LayerInteractivity",{_mixinName:"mstrmojo.gmaps.layer._LayerInteractivity",selectedGraphics:[],preCssTransform:null,panBy:function F(d){var c=this._viewer;if(c){c.stopUpdate();c.setTransform(d);}},resetCssTransform:function R(){var c=this._viewer;if(c){c.setTransform({x:0,y:0});}this.preCssTransform=null;},handleGraphicsClick:function A(i,j){if(!i||i.length<1||!this.map){return ;}var e=this.map,f=j&&(j.ctrlKey||j.metaKey),h=i[0],k=h&&h.isSelected(),d,g,c;if(f){this.handleGraphicsSelection(i,!k);}else{d=this.isUseAsFilter();g=H(this.selectedGraphics,i,this.isForPremium());c=!(d&&g);e.clearSelections(c);if(g){this.handleGraphicsSelection(i,true);}}},handleGraphicsContextMenuClick:function U(c){if(!c||c.length<1||!this.map){return ;}N.forEach(c,function(d){this.addToContextMenuSelection(d,true);},this);},handleGraphicsSelection:function P(g,d){var e=false,f=this.map,c=f&&f.parent;N.forEach(g,function(h){if(!d){this.removeSelectedGraphics(h);}else{this.addToSelectedGraphics(h);e=true;}},this);f.displayVizBoxVisFilterIndicator(e,c);},addToSelectedGraphics:function T(e){if(!e){return ;}if(!this.selectedGraphics){this.selectedGraphics=[];}var c=this._viewer,d=e.getGraphicsForSelection();N.forEach(d,function(f){if(this.findIdxInSelectedGraphics(f)>-1){return ;}this.selectedGraphics.push(f);f.setSelection(true);},this);if(K.checkHasFunction(c,"moveGraphicToTop")){c.moveGraphicToTop(e);}this.originSelectedGraphics.push(e);this.addVisSelection(this.getGraphicsDataRowIndices([e]));},addToContextMenuSelection:function C(f,e){if(!f){return ;}if(!this.contextMenuSelection){this.contextMenuSelection=[];}var c=this._viewer,d=f.getGraphicsForSelection();if(e&&K.checkHasFunction(c,"moveGraphicToTop")){c.moveGraphicToTop(f);}N.forEach(d,function(g){if(this.findIdxInContextMenuSelectedGraphics(g)>-1){return ;}this.contextMenuSelection.push(g);g.setContextMenuSelection(f.isSelected(),true);},this);this.addVisContextMenuSelection(this.getGraphicsDataRowIndices([f]));},cloneSelectionToContextMenuSelection:function W(){var e,d=this.originSelectedGraphics,c=d&&d.length;for(e=0;e<c;e=e+1){this.addToContextMenuSelection(d[e]);}},removeSelectedGraphics:function Q(f){if(!f||!this.selectedGraphics){return ;}var c=this._viewer,d=f.getGraphicsForSelection(),e=this.originSelectedGraphics.indexOf(f);N.forEach(d,function(h){var g=this.findIdxInSelectedGraphics(h);if(g<0){return ;}this.selectedGraphics.splice(g,1);h.setSelection(false);},this);if(K.checkHasFunction(c,"moveGraphicToBottom")){c.moveGraphicToBottom(f);}if(e!==-1){this.originSelectedGraphics.splice(e,1);}this.removeVisSelection(f.getDataRowIndices());},clearAllSelectedGraphics:function B(c){var f=this.map,d=this._viewer,e=this.selectedGraphics;if(!f||!d||(c&&K.isVI()&&this.isUseAsFilter()&&this.isClearAllDisabled())){return ;}if(e&&e.length>0){d.clearHighlights(e);}this.selectedGraphics=[];this.originSelectedGraphics=[];this.clearSelections();},clearAllContextMenuSelection:function M(){if(!this.map){return ;}N.forEach(this.contextMenuSelection,function(c){c.setContextMenuSelection(c.isSelected(),false);});this.contextMenuSelection=[];this.clearCxtMnuSelection();},clearAllContextMenuSelectionHighLights:function J(){var c=this._viewer;N.forEach(this.contextMenuSelection,function(d){d.setContextMenuSelection(d.isSelected(),false);if(!d.isSelected()&&K.checkHasFunction(c,"moveGraphicToBottom")){c.moveGraphicToBottom(d);}});if(K.checkHasFunction(c,"handleContextMenu")){c.handleContextMenu();}this.contextMenuSelection=[];},findIdxInSelectedGraphics:function V(c){if(!c||!this.selectedGraphics){return -1;}return this.selectedGraphics.indexOf(c);},findIdxInContextMenuSelectedGraphics:function S(c){if(!c||!this.contextMenuSelection){return -1;}return this.contextMenuSelection.indexOf(c);},getGraphicsFromPoint:function D(c){var d=this.getTargetFromPoint(c);return N.ensureArray(this.findTouchedGraphic(d));},getTargetFromPoint:function Z(d){if(!this._viewer){return ;}var g,f=this._viewer,c=f.isDataLabelShown(),e=f.isAffinityLineShown();if(c){f.hideDataLabelLayer();}if(e){f.hideAffinityLineLayer();}if(f){f.setLayerZIndex(b);}g=document.elementFromPoint(d.clientX,d.clientY);this.setLayerZIndex();if(c){f.showDataLabelLayer();}if(e){f.showAffinityLineLayer();}return g;},findTouchedGraphic:function a(d){var c=d&&d.graphicID;if(c){return mstrmojo.all[c];}return null;},hasGraphicSelected:function I(){return !!this.selectedGraphics&&(this.selectedGraphics.length>0);},isInFilterPanel:function O(){var c=this.map;return !!c&&c.isInFilterPanel();},handleClickEvt:mstrmojo.emptyFn,handleContextMenuEvt:function Y(f,c){var d=this.map;if(f&&c){f.graphics=c;d.handleContextMenuEvt(f);this.handleGraphicsContextMenuClick(c);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums");var Y=mstrmojo,Z=Y.array,H=Y.dom,I=Y.hash,j=Y.VisUtility,G=Y.gmaps,B=G.MapUtils,D=G.EnumBaseMapType;var U=2;var f="pinchstart",h="pinchend",C=1,k=0.5;function b(s,t){if(s&&t&&B.checkVal(s.clientX)&&B.checkVal(s.clientY)&&B.checkVal(t.x)&&B.checkVal(t.y)){return Math.abs(s.clientX-t.x)<=U&&Math.abs(s.clientY-t.y)<=U;}}function P(t){var s=t&&t.center,u=B.getBoundingRect(this.graphicLayerDiv);if(s&&u){return{x:s.x-u.left,y:s.y-u.top};}}function F(s,t){Z.forEach(s,function(v){var u=v.getGraphicsForSelection();Z.forEach(u,function(w){var x=w.geometry;if(x){t.call(x,w.isSelected());}});});}mstrmojo.gmaps._CustomMapInteractivity=mstrmojo.provide("mstrmojo.gmaps._CustomMapInteractivity",{_mixinName:"mstrmojo.gmaps._CustomMapInteractivity",dragStartPos:null,mouseDownPos:null,isMouseMove:null,isMouseDown:null,cssTransform:null,prevGraphicsHovered:null,_hammer:null,addEventListeners:function O(){var s=this.graphicLayerDiv;if(!s){return ;}H.attachEvent(s,"mousedown",this.handleMouseDownEvt.bind(this));H.attachEvent(s,"mouseup",this.handleMouseUpEvt.bind(this));H.attachEvent(s,"mousemove",this.handleMouseMoveEvt.bind(this));H.attachEvent(s,"mouseleave",this.handleMouseLeaveEvt.bind(this));H.attachEvent(s,"dblclick",this.handleDoubleClickEvt.bind(this));H.attachEvent(s,"contextmenu",this.handleContextMenuEvt.bind(this));j.addWheelListener(s,this.handleMouseWheelEvt.bind(this));if(H.supportsTouches){this.addTouchEventListeners(s);}},removeEventListeners:function g(){var s=this.graphicLayerDiv;if(!s){return ;}H.detachEvent(s,"mousedown",this.handleMouseDownEvt);H.detachEvent(s,"mouseup",this.handleMouseUpEvt);H.detachEvent(s,"mousemove",this.handleMouseMoveEvt);H.detachEvent(s,"mouseleave",this.handleMouseLeaveEvt);H.detachEvent(s,"dblclick",this.handleDoubleClickEvt);H.detachEvent(s,"contextmenu",this.handleContextMenuEvt);if(H.supportsTouches){this.removeTouchEventListeners(s);}},addTouchEventListeners:function r(s){var t=this._hammer=new Hammer.Manager(s),u=new Hammer.Tap({event:"doubletap",taps:2}),v=new Hammer.Pinch({threshold:0});t.add([u,v]);t.on("doubletap",this.handleDoubleTapEvt.bind(this));t.on(f+" "+h,this.handlePinchEvt.bind(this));H.attachEvent(s,"touchstart",this.handleMouseDownEvt.bind(this));H.attachEvent(s,"touchend",this.handleMouseUpEvt.bind(this));H.attachEvent(s,"touchmove",this.handleMouseMoveEvt.bind(this));},removeTouchEventListeners:function A(s){var t=this._hammer;if(t){t.off("doubletap",this.handleDoubleTapEvt);t.off(f+" "+h,this.handlePinchEvt);}H.detachEvent(s,"touchstart",this.handleMouseDownEvt.bind(this));H.detachEvent(s,"touchend",this.handleMouseUpEvt.bind(this));H.detachEvent(s,"touchmove",this.handleMouseMoveEvt.bind(this));},handleMouseDownEvt:function n(s){if(B.checkHasFunction(s,"preventDefault")){s.preventDefault();}s=B.getEvent(s);if(this.mouseDownPos||this.enablePopup!==true||!s||!B.checkVal(s.clientX)||!B.checkVal(s.clientY)){return ;}this.mouseDownPos={x:s.clientX,y:s.clientY};if(!B.isRMClick(s)){this.isMouseDown=true;}},handleMouseUpEvt:function e(s){s=B.getEvent(s);var t=this.mouseDownPos,u=B.isRMClick(s);if(this.isMouseMove){this._panEnd();}if(t&&b(s,t)&&!u){this.handleMouseClickEvt(s,this.getGraphicsFromPoint(s));this.highlightAllLayers();}this.stopMouseEvents();},stopMouseEvents:function i(){this.dragStartPos=null;this.mouseDownPos=null;this.isMouseDown=false;this.isMouseMove=false;},handleMouseMoveEvt:function T(u){if(this.enablePopup!==true||!u){return ;}if(B.checkHasFunction(u,"preventDefault")){u.preventDefault();}var x=u.touches,s=x&&x.length>1,w=x&&x.length===1;u=B.getEvent(u);if(this.isMouseDown===true||w){if(!s){var t=this.dragStartPos,v={x:u.clientX,y:u.clientY};if(t&&!b(u,t)){this.panHandler({x:v.x-t.x,y:v.y-t.y},t,v);}this.isMouseMove=true;this.dragStartPos=v;}}else{this.handleGraphicsHover(u);}},handleMouseLeaveEvt:function S(s){if(this.isMouseDown===true){this.handleMouseUpEvt();}this.hideTooltip(true);this.handleGraphicsHover(s);},handleDoubleClickEvt:function Q(t){if(this.enablePopup!==true){return ;}var s=this.baseLayer;if(s){s.handleMouseWheel({position:B.getEvtCoordInsideNode(t,this.graphicLayerDiv),zoomDelta:1});}},handleMouseWheelEvt:function o(t){if(this.enablePopup!==true||!t){return ;}var s=this.baseLayer,u=t.deltaY>0?-1:1;if(s){s.handleMouseWheel({position:B.getEvtCoordInsideNode(t.originalEvent,this.graphicLayerDiv),zoomDelta:u});}t.preventDefault();},handleDoubleTapEvt:function K(t){var s=this.baseLayer;if(this.enablePopup!==true||!s){return ;}s.handleMouseWheel({position:P.call(this,t),zoomDelta:1});},handlePinchEvt:function N(s){if(this.enablePopup!==true||!s){return ;}switch(s.type){case f:this._handlePinchStartEvt(s);break;case h:this._handlePinchEndEvt(s);break;}},_handlePinchStartEvt:function V(s){this._pinchCenter=P.call(this,s);this.stopMouseEvents();},_handlePinchEndEvt:function X(t){var s=this.baseLayer,v=t.scale,u=parseInt((v-C)/k);if(s){s.handleMouseWheel({position:this._pinchCenter,zoomDelta:u});}delete this._pinchCenter;},panHandler:function d(v,u,t){var s=this.baseLayer;if(!s){return ;}this.updateCssTransform(v);s.panBy(v,u,t);this.panAllGraphicLayers();this.hideTooltip();},_panEnd:function c(){switch(this.getBaseMapType()){case D.Esri:this.updateCoordForAllGraphicLayers();break;case D.Google:setTimeout(this.updateCoordForAllGraphicLayers.bind(this),20);break;}this._cachePreCssTransform();},panAllGraphicLayers:function m(){var s=this.cssTransform;this.forEachGraphicLayer(function(t){if(t){t.panBy(s);}},null,true);},_cachePreCssTransform:function a(){var s=this.cssTransform;this.forEachGraphicLayer(function(t){t.preCssTransform=I.clone(s);},null,true);},updateCssTransform:function R(u){var t=this.cssTransform=this.cssTransform||{},s,v;if(!!u&&B.checkVal(u.x)&&B.checkVal(u.y)){s=(!B.checkVal(t.x))?0:t.x;v=(!B.checkVal(t.y))?0:t.y;this.cssTransform={x:s+u.x,y:v+u.y};}},resetCssTransform:function J(){this.cssTransform=null;this.forEachGraphicLayer(function(s){s.resetCssTransform();},null,true);},handleGraphicsHover:function q(s){var t=[],u;this.forEachGraphicLayer(function(v){t=v.getGraphicsFromPoint(s);if(t&&t.length>0){u=v;return false;}},true);this.setGraphicsHovered(t);this.setTooltip(u,t,{x:s.clientX,y:s.clientY});},setGraphicsHovered:function E(s){var t=this.prevGraphicsHovered;if(!Z.isArray(s)||(s.length<1&&Z.isArray(t)&&t.length<1)){return ;}Z.forEach(t,function(u){if(u&&Z.indexOf(s,u)===-1){u.setHover(false);}});Z.forEach(s,function(u){if(u&&Z.indexOf(t,u)===-1){u.setHover(true);}});this.prevGraphicsHovered=s;},getGraphicsFromPoint:function M(s){var t;this.forEachGraphicLayer(function(u){t=u&&u.getGraphicsFromPoint(s);if(t&&t.length>0){return false;}},true);return t;},setTooltip:function W(t,s,u){if(t){this.showTooltip(t,s,u);}else{this.hideTooltip(true);}},showTooltip:function p(t,s,u){if(t){t.showTooltip(s,u);}},highlightAllLayers:function l(){var t=false,s=this;if(s){s.forEachGraphicLayer(function(u){if(u&&((u.selectedGraphics&&u.selectedGraphics.length>0)||(u.contextMenuSelection&&u.contextMenuSelection.length>0))){t=true;}});if(t){s.forEachGraphicLayer(function(u){if(u){F(u.graphics,function(){if(B.checkHasFunction(this,"setUnSelection")){this.setUnSelection();}});F(u.selectedGraphics,function(){if(B.checkHasFunction(this,"setSelection")){this.setSelection(true);}});F(u.contextMenuSelection,function(v){if(B.checkHasFunction(this,"setContextMenuSelection")){this.setContextMenuSelection(v,true);}});}});}else{s.forEachGraphicLayer(function(u){if(u){F(u.graphics,function(){if(B.checkHasFunction(this,"setSelection")){this.setSelection(false);}});}});}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils");var M=mstrmojo,J=M.array,D=M.gmaps.MapUtils;mstrmojo.mapbox._MapboxInteractivity=mstrmojo.provide("mstrmojo.mapbox._MapboxInteractivity",{_mixinName:"mstrmojo.mapbox._MapboxInteractivity",_listeners:null,addEventListeners:function B(){var O=this.getMapboxInstance(),N=this._listeners=[{evt:"click",fn:this.onMouseClick.bind(this)},{evt:"contextmenu",fn:this.onContextMenu.bind(this)},{evt:"mousemove",fn:this.onMouseMove.bind(this)},{evt:"mouseout",fn:this.onMouseOut.bind(this)}];if(O){J.forEach(N,function(P){O.on(P.evt,P.fn);});}},getAllQueryLayers:function C(){var N=[];this.forEachGraphicLayer(function(P){var O=P._viewer;if(D.checkHasFunction(O,"getQueryLayers")){N=N.concat(O.getQueryLayers());}});return N;},getGraphicsFromFeature:function H(O){var N=[];if(O){this.forEachGraphicLayer(function(Q){var P=Q&&Q._viewer;if(P&&P.contain(O)){N=P.getGraphicsFromFeature(O);return false;}});}return N;},onMouseClick:function E(R){if(!R){return ;}var Q=this.getMapboxInstance(),N=R.point,P=Q&&Q.queryRenderedFeatures([N.x,N.y],{layers:this.getAllQueryLayers()}),O=P&&P[0];this.handleMouseClickEvt(R.originalEvent,this.getGraphicsFromFeature(O));this.forEachGraphicLayer(function(U){var T=U.selectedGraphics,S=U._viewer;if(D.checkHasFunction(S,"contain")&&S.contain(O)){S.highlightGraphics(T);}});this.highlightAllLayers();},highlightAllLayers:function G(){var N=false;this.forEachGraphicLayer(function(O){if(O&&((O.selectedGraphics&&O.selectedGraphics.length>0)||(O.contextMenuSelection&&O.contextMenuSelection.length>0))){N=true;}});if(N){this.forEachGraphicLayer(function(R){if(R){var O=R._viewer,Q=R.selectedGraphics,P=R.contextMenuSelection;if(D.checkHasFunction(O,"handleHighlight")){O.handleHighlight(Q,P);}}});}else{this.forEachGraphicLayer(function(P){var O=P&&P._viewer;if(D.checkHasFunction(O,"handleSelections")){O.handleSelections();}if(D.checkHasFunction(O,"handleContextMenu")){O.handleContextMenu();}});}},onContextMenu:function F(R){if(!R){return ;}var Q=this.getMapboxInstance(),N=R.point,P=Q&&Q.queryRenderedFeatures([N.x,N.y],{layers:this.getAllQueryLayers()}),O=P&&P[0];this.handleContextMenuEvt(R.originalEvent,this.getGraphicsFromFeature(O));this.forEachGraphicLayer(function(U){var T=U.contextMenuSelection,S=U._viewer;if(S&&S.contain(O)){S.handleContextMenu(T);}});this.highlightAllLayers();this.cntMenuShowTime=new Date();},onMouseMove:function A(T){if(this.cntMenuShowTime&&(new Date()-this.cntMenuShowTime)<100){this.cntMenuShowTime=undefined;return ;}var S=this.getMapboxInstance(),R=this.getAllQueryLayers(),O=T&&T.point,N=T&&T.originalEvent,Q,P;if(!S||!R||R.length<1){return ;}if(O){Q=S.queryRenderedFeatures([O.x,O.y],{layers:R});}P=Q&&Q[0];if(!P){this.hideTooltip(true);}this.forEachGraphicLayer(function(V){var U=V&&V._viewer;if(D.checkHasFunction(U,"handleHover")){if(U.contain(P)){U.handleHover(P,N);}else{U.handleHover();}}});},onMouseOut:function I(){this.onMouseMove();},removeEventListeners:function K(){var P=this.getMapboxInstance(),N=this._listeners,O=this.getMapboxInstance();if(!O||!N){return ;}J.forEach(N,function(Q){P.off(Q.evt,Q.fn);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps._AreaMapHelper");var J=mstrmojo.array,G=mstrmojo.gmaps,K=G.MapUtils,A=G._AreaMapHelper,N=G.EnumGeographicRole,M=",";mstrmojo.gmaps.layer._SecondaryGeoRoleHelper=mstrmojo.provide("mstrmojo.gmaps.layer._SecondaryGeoRoleHelper",{_mixinName:"mstrmojo.gmaps.layer._SecondaryGeoRoleHelper",initWebMapConfig:function E(Y){var T=this.map.getMapConfig().common,O=T.shapes,R=T.layers,X=this.layerProps,b={},P=this.parent,c,V,S,U,a,Q,Z,W;if(!O||!O.length||!X){return ;}U=X.lid;if(!!U){V=A.getMatchingShape(O,U,null);}else{a=A.getShapeAttributeGeoRole(this.data,this.dropZones.geoAttribute);if(!a){K.log("Geo role not found in the GeoAttribute. Can not render area.");}W=P.getBaseMapType();O=A.getAvailableShapes(O,R,a,W);V=A.getMatchingShape(O,null,a);}if(!!V){X.lid=V.id;b.qf=this._extractShapeQf(V.qf);b.ea=V.ea||V.shapeKey;b.ml=null;b.sf=V.sf;b.sfr=parseInt(V.sfr);for(Q=0,Z=R.length;Q<Z;Q++){S=R[Q];if(V.layerId===S.id){b.ml=K._verifyProtocol(S.ml);break;}}}if(Y){c=this.geoSecondaryRolePosition=this.getSecondaryFieldRoleAttributeIndex(b);if(K.isVI()&&P&&!!V&&V.roleId==N.EnumGeographicRoleCounty){if(c===-1){P.showToast(mstrmojo.desc(13835,"County names are not necessarily unique. Please add State as an attribute in the tooltip drop zone."));}else{P.destroyToast();}}}return b;},_extractShapeQf:function B(Q){if(Q&&!J.isArray(Q)){var P=Q.substring(1,Q.length-1).split(/\s*,\s*/),O=P.length,S,R;for(R=0;R<O;R++){S=P[R];P[R]=S.substring(1,S.length-1);}return P;}else{return Q;}},getSecondaryFieldRoleAttributeIndex:function H(V){var W=this.getDataRows(),X=-1,O,U,T,R,S,P,Q;if(!V||!W){return ;}for(R=0,S=W.length;R<S;R++){T=W[R];if(T.otp!==12){continue;}O=T.fs;for(P=0,Q=O.length;P<Q;P++){U=O[P].fgr;if(isNaN(U)||parseInt(U,10)<0||parseInt(U,10)>parseInt(N.EnumGeographicRoleLastOne,10)){continue;}if(parseInt(U)===V.sfr){X=R;break;}}}return X;},getIdStringForRow:function D(R,Q,O){var P=this.getElementValue(R,Q);if(K.checkDefined(O)&&O!==-1){P+=M+this.getElementValue(R,O);}return P;},createLookup:function I(){return this._shapeToRowIndexMap;},getNameConversionMap:function F(){var T=this.parent&&this.parent.getBaseMapType(),U=this.map.getMapConfig().common.nameConversions,P=(U&&U.length)||0,O={},S,R,Q;for(R=0;R<P;R++){S=U[R];if(S.scope===T){Q=S.n;Q=(Q&&Q.toLowerCase)?Q.toLowerCase():Q;if(!O[Q]){O[Q]=[];}O[Q].push(S);}}return O;},convertName:function C(T,X){var Y=this.nameConversionMap,V=T,O=(T&&T.toLowerCase)?T.toLowerCase():T,Q,P,W,S,U,R;if(Y&&Y[O]){Q=Y[O];U=Q.length;for(R=0;R<U;R++){P=Q[R];S=P.role;if(!S||X===S){W=K.trimString(P.value);V=W;this._convertedNameMap[W]=T;break;}}}return K.trimString(V);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils");var P=mstrmojo,K=P.array,D=P.hash,G=P.mapbox,O=G.ID_SUFFIX,F=P.gmaps.EnumDataLabelShowOption,J=G.FONT_FAMILIES_MAPPING;var M=J.ArialUnicodeMS.normal,C=[J.Arial.normal,M],N="white",I=1;function B(S){if(!S){return C;}var X=S.fontStyle,T=S.fontWeight,R=S.fontFamily,W,V,U;if(!R){return C;}V=R.split(" ").join("");W=J[V];if(!W){return C;}if(X!=="italic"){if(T!=="bold"){U=W.normal;}else{U=W.bold;}}else{if(X==="italic"){if(T!=="bold"){U=W.italic;}else{U=W.bolditalic;}}}return[U,M];}mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper",addDataLabelLayer:function E(S){var Z=this.getSourceId(),T=this.getLayerId()+O.DataLabel,R=this._layerIds,X=this.execMethodOfParent("getLabelConfig"),W=X&&X.dlFontStyle,a=this.getFontSize(),V=this.getDataLabelSourceLayer(),Y,U;if(!Z||!this.needLabel()||!W){return ;}Y=parseInt(X.dlFontHeight)/a;U={layout:{"text-field":this.getLabelField(X.dlShowOption),"text-font":B(W),"text-size":parseInt(W.fontSize),"text-line-height":Y,"text-allow-overlap":!!X.showAllDataLabel,"text-offset":this.getLabelTextOffset(),"text-anchor":this.labelTextAnchor,"text-padding":0,visibility:this.isVisible()?"visible":"none"},paint:{"text-color":X.dlFontStyle.fillColor,"text-halo-color":X.dlFontStyle.dlFntHaloClr||N,"text-halo-width":X.dlFontStyle.dlFntHaloWidth||I,"text-opacity":this.getFillOpacityForZoomAnimation(1)}};S.addLayer(D.copy(U,this.getLayerCtrlProps(T,"symbol",Z,undefined,V)));R.push(T);},getLabelField:function Q(R){switch(R){case F.SHOW_TEXT:return"{labelText}";case F.SHOW_VALUE:return"{labelValues}";case F.SHOW_BOTH:return"{labelText}\n{labelValues}";default:return"";}},getLabelLayerId:function H(){return this.getLayerId()+O.DataLabel;},updateDataLabelLayer:function A(){var S=this.getMapInstance(),R=this.getLabelLayerId();if(!S){return ;}if(S.getLayer(R)){S.removeLayer(R);K.removeItem(this._layerIds,R);}this.addDataLabelLayer(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo._LoadsScript","mstrmojo.gmaps.MapUtils","mstrmojo.PerformanceLogOutput");var G=mstrmojo.array,F=mstrmojo.gmaps,E=mstrmojo.PerformanceLogOutput,A=F.MapUtils;function D(H){var I=this;return G.map(H,function(J){return{url:J,forceReload:true,onError:{callback:I.loadMap,params:mstrmojo.mapbox}};});}mstrmojo.gmaps.basemap._CanLoadMapboxScript=mstrmojo.provide("mstrmojo.gmaps.basemap._CanLoadMapboxScript",{_mixinName:"mstrmojo.gmaps.basemap._CanLoadMapboxScript",callback:null,loadExternalScript:function C(H){this.callback=H;this.loadMainModule();},loadMainModule:function B(){var I=this,H;if(mstrmojo._LoadsScript.esScritsContext===this){mstrmojo._LoadsScript.esScritsContext=null;}E.endTimer("timerid_callback_LoadMainModule");E.visPrint("load Mapbox external script end");H=window.setInterval(function(){window.clearInterval(H);I.loadMap(mstrmojo.mapbox);},50);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo._CanDrawHeatMap","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.AbstractGraphicLayerViewer");var M=mstrmojo,I=M.array,J=mstrmojo.gmaps.MapUtils;function F(){var P=document.createElement("canvas");J.setCssStyles(P,{position:"absolute",top:"0px",left:"0px"});return P;}mstrmojo.gmaps.layer.canvas.DensityLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractGraphicLayerViewer,[mstrmojo._CanDrawHeatMap],{scriptClass:"mstrmojo.gmaps.layer.canvas.DensityLayerViewer",parentDom:null,div_:null,themeData:null,init:function O(P){this._super(P);this._initLayerDomTree();},_initLayerDomTree:function K(){var P=this.div_,Q=this.parentDom;if(!P){P=this.div_=document.createElement("div");J.setLayerNodeProps(P,null,"mstrMap-graphicLayer",this.getWidth(),this.getHeight());}this.canvas=F();J.appendNode(P,this.canvas);if(Q){Q.appendChild(P);}},getNode:function B(){return this.div_;},update:function C(R){var Q=this.canvas,P=R&&R.themeId;if(!Q){return ;}this.themeId=P;this.themeData=null;this.setTransform({x:0,y:0});Q.width=this.getWidth();Q.height=this.getHeight();this.drawDensity();},refresh:function H(){J.appendNode(this.getNode(),this.canvas);},getGraphicsFromPoint:function D(P){var Q=J.getEvtCoordInsideNode(P,this.parentDom);if(!!Q&&J.checkVal(Q.x)&&J.checkVal(Q.y)){return I.ensureArray(this.getAttrsFromLocationMapRange(Math.ceil(Q.x),Math.ceil(Q.y)));}},getScreenPointForLocation:function A(P){if(!P){return ;}var Q=this.getGraphicsOffset();return(Q&&J.checkVal(Q.x)&&J.checkVal(Q.y))?{x:P.x+Q.x,y:P.y+Q.y}:{x:P.x,y:P.y};},getTopLeft:function E(){var P=this.canvas;return(!P)?null:{x:parseFloat(P.style.left.split("px")[0]),y:parseFloat(P.style.top.split("px")[0])};},clean:function G(){this.clearDensity();},destroy:function N(){this.cleanLocationMap();this.clearDensity();delete this.canvas;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Geometry");var M=mstrmojo.array,E=mstrmojo.gmaps,N=E.MapUtils,F=E.EnumGeometryType;mstrmojo.gmaps.geometry.Polygon=mstrmojo.declare(mstrmojo.gmaps.geometry.Geometry,null,{scriptClass:"mstrmojo.gmaps.geometry.Polygon",nodeTag:"path",type:F.Polygon,geoPolylineArr:null,screenPolylineArr:null,geoExtent:null,strokeScale:1,update:function D(Q){this._super(Q);var P=this.generatePath(this.screenPolylineArr);this.setPath(P);},addScreenPoint:function A(P){this._addPointToScreenCoordArr(P);this.setPath(this._addPointToScreenPath(P));},setPath:function I(P){if(!!P){N.setNodeAttributes(this.node,{d:P});}},loadProps:function H(P){if(!!P&&M.isArray(P.screenPolylineArr)){this.screenPolylineArr=P.screenPolylineArr;}},generatePath:function O(P){var Q="";M.forEach(P,function(R){Q+=this.generatePathStrOfPolyline(R);},this);return Q;},generatePathStrOfPolyline:function J(Q){var T="",P,S,R;if(!M.isArray(Q)){return T;}P=Q[0];if(!P||!N.checkVal(P.x)||!N.checkVal(P.y)){return T;}T="M "+P.x+" "+P.y+" ";for(S=1,R=Q.length;S<R;S++){P=Q[S];if(!!P&&N.checkVal(P.x)&&N.checkVal(P.y)){T+="L "+P.x+" "+P.y+" ";}}return T;},_addPointToScreenPath:function K(P){var Q=this.node&&this.node.getAttribute("d");if(!P||!N.checkVal(P.x)||!N.checkVal(P.y)){return Q;}else{if(!!Q){return Q+"L "+P.x+" "+P.y+" ";}else{return"M "+P.x+" "+P.y+" ";}}},_addPointToScreenCoordArr:function B(P){if(!P||!N.checkVal(P.x)||!N.checkVal(P.y)){return ;}if(!M.isArray(this.screenPolylineArr)){this.screenPolylineArr=[[]];}this.screenPolylineArr[this.screenPolylineArr.length-1].push(P);},contains:function C(a){var U=this.screenPolylineArr,W=!1,Z,Q,Y,V,P,T,b,S,X,R;if(!a||!N.checkVal(a.x)||!N.checkVal(a.y)||!M.isArray(U)){console.log("Polygon.contains(): invalid point/screenPolylineArr");return W;}Y=a.x;V=a.y;for(T=0,b=U.length;T<b;T++){P=U[T];if(!M.isArray(P)){continue;}for(S=R=0,X=P.length;S<X;S++){R++;if(R===X){R=0;}Z=P[S];Q=P[R];if(!!Z&&!!Q&&(Z.y<V&&Q.y>=V||Q.y<V&&Z.y>=V)&&Z.x+(V-Z.y)/(Q.y-Z.y)*(Q.x-Z.x)<Y){W=!W;}}}return W;},intersectPolygon:function G(P){if(!P||!M.isArray(P.screenPolylineArr)||!(P.containVertexInPolylineArr instanceof Function)){console.log("intersectPolygon(): invalid polygon");return false;}return this.containVertexInPolylineArr(P.screenPolylineArr)||P.containVertexInPolylineArr(this.screenPolylineArr);}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Geometry");var D=mstrmojo.gmaps,M=D.MapUtils,G=D.EnumGeometryType;mstrmojo.gmaps.geometry.Extent=mstrmojo.declare(mstrmojo.gmaps.geometry.Geometry,null,{scriptClass:"mstrmojo.gmaps.geometry.Extent",nodeTag:"rect",type:G.Extent,x:null,y:null,width:null,height:null,latSouth:null,latNorth:null,lngWest:null,lngEast:null,isGeo:true,update:function C(Q){this._super(Q);this.setPosition(Q);this.setDimension(Q);},setPosition:function O(Q){if(Q&&M.checkVal(Q.x)&&M.checkVal(Q.y)){this.x=Q.x;this.y=Q.y;}if(M.checkVal(this.x)&&M.checkVal(this.y)){M.setNodeAttributes(this.node,{x:this.x,y:this.y});}},setDimension:function N(Q){if(Q&&M.checkVal(Q.width)&&M.checkVal(Q.height)){this.width=Q.width;this.height=Q.height;}if(M.checkVal(this.width)&&M.checkVal(this.height)){M.setNodeAttributes(this.node,{width:this.width,height:this.height});}},union:function K(Q){if(Q&&M.checkVal(Q.latSouth)&&M.checkVal(Q.latNorth)&&M.checkVal(Q.lngWest)&&M.checkVal(Q.lngEast)){this.mergePoint(Q.latSouth,Q.lngWest);this.mergePoint(Q.latNorth,Q.lngEast);}},eql:function P(Q){return(!!Q)&&(this.latSouth===Q.latSouth&&this.latNorth===Q.latNorth&&this.lngWest===Q.lngWest&&this.lngEast===Q.lngEast);},mergePoint:function F(R,Q){this._mergePointLat(R);this._mergePointLng(Q);},_mergePointLat:function B(Q){if(M.checkVal(Q)){this.latSouth=(!M.checkVal(this.latSouth)||Q<this.latSouth)?Q:this.latSouth;this.latNorth=(!M.checkVal(this.latNorth)||Q>this.latNorth)?Q:this.latNorth;}},_mergePointLng:function E(R){if(!M.checkVal(R)){return ;}var S=this.lngEast,Q=this.lngWest;if(!this.isGeo){this.lngWest=(!M.checkVal(this.lngWest)||R<this.lngWest)?R:this.lngWest;this.lngEast=(!M.checkVal(this.lngEast)||R>this.lngEast)?R:this.lngEast;return ;}if(!M.checkVal(this.lngWest)){this.lngWest=this.lngEast=R;}else{if(!this._containsLng(R)){if(this._distBetweenPointLng(R,Q)<this._distBetweenPointLng(S,R)){this.lngWest=R;}else{this.lngEast=R;}}}},_distBetweenPointLng:function J(S,R){var Q=R-S;return Q>=0?Q:(Q+360);},_containsLng:function I(Q){Q=(Q===-180)?180:Q;if(this.lngWest>this.lngEast){return(Q>=this.lngWest||Q<=this.lngEast);}else{return(Q>=this.lngWest&&Q<=this.lngEast);}},contains:function A(S){if(!S||!M.checkVal(S.x)||!M.checkVal(S.y)||!M.checkVal(this.x)||!M.checkVal(this.y)||!M.checkVal(this.width)||!M.checkVal(this.height)){console.log("Extent.contains(): invalid params");return false;}var R=S.x,W=S.y,V=this.x,T=this.x+this.width,U=this.y,Q=this.y+this.height;return(R<=T&&R>=V&&W<=Q&&W>=U);},intersectPolygon:function H(Q){if(!Q||!Q.screenPolylineArr||!(Q.containVertexInPolyline instanceof Function)){console.log("intersectPolygon(): invalid polygon");return false;}return !!Q.containVertexInPolyline([{x:this.x,y:this.y},{x:this.x+this.width,y:this.y},{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height}])||!!this.containVertexInPolylineArr(Q.screenPolylineArr);}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.Geometry","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums");var D=mstrmojo.gmaps,B=D.MapUtils,C=D.EnumGeometryType;mstrmojo.gmaps.geometry.Point=mstrmojo.declare(mstrmojo.gmaps.geometry.Geometry,null,{scriptClass:"mstrmojo.gmaps.geometry.Point",type:C.Point,markerType:null,lat:null,lng:null,x:null,y:null,update:function E(F){this._super(F);this.setPosition(F);},setPosition:function A(F){if(!!F&&B.checkVal(F.x)&&B.checkVal(F.y)){this.x=F.x;this.y=F.y;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.gmaps.MapLegendEnums","mstrmojo.ui.editors.controls.AdvancedColorPicker");var R=mstrmojo,E=R.dom,N=R.hash,S=R.css,K=R.VisUtility,H=R.gm,A=H.GMUtility,G=R.ui.editors.controls.AdvancedColorPicker,B=R.gmaps.LEGEND_FORMAT_PROPERTY;function D(T){return R.all[T];}function M(T){var U=D(this.widgetId),V=U.colorSqureIdentity.decodedColor;if(!N.equals(T,V)){T=A.encodeColor(T);U.setProperty(B.COLOR_SQUARE_COLOR,T,{});}}function C(T){var U=this,V=D(this.widgetId);V.colorSqureIdentity=T;return new mstrmojo.ui.menus.ToolbarEditorConfig({cssClass:"cbsquare-colorpicker",contents:[new mstrmojo.ui.editors.controls.AdvancedColorPicker({showAutomatic:!T.isDefaultColor,color:T.decodedColor,colorChanged:function(W){W=(this.showAutomatic&&W===G.VAL_AUTOMATIC)?"default":W;M.call(U,W);U.hideToolbar();},colorCanceled:function(){U.hideToolbar();}})]});}function O(X){var V=D(this.widgetId),T=V.domToolbarPH,U=this,W;V._lastOpened=null;T.innerHTML="";document.body.appendChild(T);S.toggleClass(T,mstrApp.getThemeClassName(),true);X.hostId=V.id;X.hostElement=T;W=V.toolEditor=X.newInstance({unrender:function(){}});V.toolEditorClosefn=function(Y){var a=Y.target,Z=W.domNode;if(!E.contains(Z,a,true,Z)&&!K.isHostedPopupNode(a,"class",true,document.body)){U.hideToolbar();}};E.attachEvent(document.body,"mousedown",V.toolEditorClosefn,true);V.openPopup(W);S.toggleClass(document.body,"hasToolbarPopup",true);}function P(T){var V=E.position(T),U={};U.x=V.x+V.w;U.y=V.y+V.h;return U;}function F(W){var T=D(this.widgetId),b=T.domToolbarPH,a=b.firstChild,e,V,X,d,Y,Z,c,U;if(!a){return ;}e=a.offsetWidth;V=a.offsetHeight;X=document.body.offsetWidth;d=document.body.offsetHeight;Y=10;Z=5;c={w:e,h:V};U=0;a.style.left="0";a.style.right="auto";a.style.top="0";a.style.bottom="auto";b.style.left=W.x+"px";b.style.top=W.y-V-Y/2+"px";if(W.x+c.w>X){b.style.left=W.x-e+"px";}if(W.y-V-Y/2<Z){U=Z;b.style.top=U+"px";}else{if(W.y+Y/2>d){U=Math.max(d-Y-V,Z);b.style.top=U+"px";}}}mstrmojo.gmaps._MapLegendInteractivity=mstrmojo.provide("mstrmojo.gmaps._MapLegendInteractivity",{_mixinName:"mstrmojo.gmaps._MapLegendInteractivity",initializePH:function Q(){var U=D(this.widgetId),T;if(!U.domToolbarPH){T=document.createElement("div");T.setAttribute("class","map-legend-placeholder");U.domToolbarPH=T;}},handleRMCColorPicker:function I(U){var T,W,V;T=U.colorIdentity;W=C.call(this,T);V=P(U);if(W){O.call(this,W);}F.call(this,V);},hideToolbar:function J(){var V=D(this.widgetId),U=V.domToolbarPH,X=U.firstChild,T=U.parentNode,W;if(X){U.removeChild(X);}if(T){T.removeChild(U);}W=V.toolEditor;if(W){W.unrender=function(){W._super();};W.destroy();W.unrender=function(){};delete V.toolEditor;S.toggleClass(document.body,"hasToolbarPopup",false);S.toggleClass(U,mstrApp.getThemeClassName(),false);}if(V.toolEditorClosefn){E.detachEvent(document.body,"mousedown",V.toolEditorClosefn,true);delete V.toolEditorClosefn;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.gm.GMUtility","mstrmojo.gmaps.MapColorUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps._AreaMapHelper","mstrmojo.PerformanceLogOutput","mstrmojo.ui.menus.MenuConfig","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.viz.MapHelper","mstrmojo.VisUtility");mstrmojo.requiresDescs(11701,3946,11476,13272,13273,5752);var r=mstrmojo.array,d=mstrmojo.hash,U=mstrmojo.dom,AO=mstrmojo.vi.viz.MapHelper,h=mstrmojo.vi.enums.EnumFeatures,C=mstrmojo.css,R=mstrmojo.gmaps,p=R.SelectionHashType,Z=R.EnumPropertyType,AN=R.EnumBaseMapType,E=R.EnumShapeFormatting,T=R.EnumDefaultShapeFormatStyle,b=R.EnumGraphicType,AL=R.EnumMarkerType,a=R._AreaMapHelper,Q=mstrmojo.gmaps.MapUtils,AJ=mstrmojo.vi.viz.EnumDSSDropZones,AF=AJ.GeoAttribute,J=AJ.AdditionalMetrics,y=R.EnumGeographicRole,D=parseInt(y.EnumGeographicRoleLatitiude,10),AP=parseInt(y.EnumGeographicRoleLongitude,10),AD=1,l={3:2,2:9,9:8},x=mstrmojo.PerformanceLogOutput,v=mstrmojo.VisUtility,i=mstrmojo.gm.GMUtility,F=R.MapColorUtils;function AE(AR,AT){if(AR===AD){return l[AT];}else{var AS=null;d.forEach(l,function(AV,AU){if(AV===AT){AS=AU;return false;}});return parseInt(AS,10);}}function AI(AS,AR){var AT=0;if(AS){if(AS.fgr){return AS.fgr;}else{if(AS.fs){r.forEach(AS.fs,function(AU){if(AU.fgr>0){if(AR){if(AO.isGeoRoleSupportArea(AU.fgr)){AT=AU.fgr;return false;}}else{AT=AU.fgr;return false;}}});return AT;}}}}function K(AS,AW,AZ){var AT=AS[AW],AV=AT.att,AY=undefined,AU,AX,AR;r.forEach(AV,function(Aa){for(AU=0,AX=Aa.fs.length;AU<AX;AU++){AR=Aa.fs[AU];if(parseInt(AR.fgr)===parseInt(AZ)){AY={did:Aa.did,t:Aa.t,fgr:AZ};break;}}if(AY){return false;}});return AY;}function I(AW,AT){var AS=this,AU=document.createElement("div"),AR=this;if(AS._lastOpened){AS.closePopup();}AS._lastOpened=null;function AV(AX,AY){AX.hostId=this.id;AX.hostElement=AY;}AU.setAttribute("class","gm-menu-placeholder");this.domToolbarPH=AU;AU.style.top=AW.y+"px";AU.style.left=AW.x+"px";AU.innerHTML="";document.body.appendChild(AU);C.toggleClass(AU,mstrApp.getThemeClassName(),true);AV.call(this,AT,AU);AS.toolEditor=AT.newInstance({unrender:function(){}});AS.toolEditorClosefn=function(AY){var Aa=AY.target,AZ=AS.toolEditor.domNode;if(!U.contains(AZ,Aa,true,AZ)&&!v.isHostedPopupNode(Aa,"class",true,document.body)){if(AS.menuEditor){var AX=AS.menuEditor.domNode;if(!U.contains(AX,Aa,true,AX)){AR.hideToolbar();}}else{AR.hideToolbar();}}};U.attachEvent(document.body,"mousedown",AS.toolEditorClosefn,true);AS.openPopup(AS.toolEditor);C.toggleClass(document.body,"hasToolbarPopup",true);}function V(AS,AR){AS=AS||[];AR=AR||"";r.forEach(AS,function(AT){AT.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:AR,children:AS};}function AB(AR,AS){return new mstrmojo.Box({children:AR||[],cssText:AS});}function H(AV,AW,AX,AR){var AS=new mstrmojo.Label({text:AV}),AU=AB(AS,"white-space: nowrap; margin-right:9px;");var AT=[AU,AW];if(AX){AT=[AW,AU];}return V(AT,AR);}function f(AS,AT,AR){r.forEach(AR,function(AU){var AV=AS.getPropertyValue(AU,AS.RMCSelectedLayerKey);if(!AV){switch(AU){case E.SHAPE_FORMAT_FILL_OPACITY:AV=T.FILL_OPACITY;break;case E.SHAPE_FORMAT_FILL_COLOR:AV=T.FILL_COLOR;break;case E.SHAPE_FORMAT_BORDER_STYLE:AV=T.BORDER_STYLE;break;case E.SHAPE_FORMAT_BORDER_COLOR:AV=T.BORDER_COLOR;break;}}AT.syncControls(function(){AT.setChildValue(AU,AV);});});}function c(AS,AR){return function(AV){var AU=AS.getPropertyValue(AR,AS.RMCSelectedLayerKey),AT=AV===AU;if(!AT){AS&&AS.writeProperties(AR,AV,AS.RMCSelectedLayerKey);}};}function s(AV,AT,AU,AS,AR){AT=AT||{};if(AT.propNames===undefined){AT.propNames=AU;}if(AT.onGroupValueChange===undefined){AT.onGroupValueChange=function(AW,AY,AX){if(AY!==AX&&AY!==undefined){c(AV,AW,AS,AR).call(this,AY,AX);}};}return AT;}function o(AW,AS,AV,AU,AR,AT){AT=s(AW,AT,AV,AU,AR);d.copy({cssClass:"mstrmojo-ui-ToolBarLineGroup",layoutConfig:null,width:AT.width||"125px",showNoFillInColor:false},AT);var AX=new mstrmojo.ui.editors.controls.LineConfigGroup(AT);if(AX){AX.height="22px;";AX.iniChildrenComp(AV);f(AW,AX,AV,AU,AR);}if(typeof AS==="string"){return H(AS,AX,false,(AT||[]).rowContainerCSSClass);}return AX;}function N(AV,AR,AU,AT,AS){AS=s(AV,AS,AU,AT);d.copy({width:AS.width||"140px",height:"22px",colorPickerHostWithin:true},AS);var AW=new mstrmojo.ui.editors.controls.FillConfigGroup(AS);if(AW){AW.iniChildrenComp(AU);f(AV,AW,AU,AT);}if(typeof AR==="string"){return H(AR,AW);}return AW;}function P(AT,AV){var AS=N(AT,mstrmojo.desc(13658,"Fill Opacity"),[E.SHAPE_FORMAT_FILL_OPACITY],null,{width:"60px",visibleControls:mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS.FILL_TRANSPARENCY}),AR=[AS];if(!AV){var AU=o(AT,mstrmojo.desc(3538,"Border Style"),[E.SHAPE_FORMAT_BORDER_STYLE],null,undefined,{width:"60px",hideColorControl:true,rowContainerCSSClass:"mstrmojo-ui-rowContainer"});AR.push(AU);}return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-FillOpacityAndBorderStyleToolbar",children:AR}]});}function n(AT,AY){var AX=mstrmojo.desc(2885,"Fill"),AW="ShapeClr",AV="ShapeFillTrans",AU=AY&&AY.onFillChanged&&AY.onOpacityChanged,AR=AU?function(Aa,AZ){if(Aa===AW){AY.onFillChanged.call(this,AZ,function(Ab){AS.syncControls(function(){this.setChildValue(AW,Ab);});});v.setColorPickerShowAutomatic(AS,AZ!=="automatic");}else{if(Aa===AV){AY.onOpacityChanged.call(this,AZ);}}}:mstrmojo.emptyFn,AS=new mstrmojo.ui.editors.controls.FillConfigGroup({colorPickerHostWithin:true,onGroupValueChange:AR,width:"125px"});if(AS){AS.fillColorAndTrans.layoutConfig={w:{col1Node:"50%",dividerNode:"5px",col2Node:"50%"},xt:true};AS.iniChildrenComp([AW,AV]);AS.syncControls(function(){this.setChildValue(AW,AT.color);this.setChildValue(AV,AT.opacity);});v.setColorPickerShowAutomatic(AS,AT.showAutomatic);}return H(AX,AS);}function AH(AZ,Aa){var Af=Aa.getFormatColorByElements(),AS=Aa.getContextMenuColorBySelections(),Ab,AY,AV,AT,AW,Ae,AR=N(AZ,mstrmojo.desc(13658,"Fill Opacity"),[E.SHAPE_FORMAT_FILL_OPACITY],null,{width:"60px",visibleControls:mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS.FILL_TRANSPARENCY}),AU=[AR],Ac,Ad,AX;if(AS===undefined||AS===null||AS.length===0){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-FillOpacityAndBorderStyleToolbar",children:AU}]});}Ab=AS.length;if(Ab>1){Ac=F.cbSelectionToIndices(AS,Af);Ad=[];r.forEach(Ac,function(Ag){Ad.push(Af[Ag]);});AX=F.getColorInfoForItemAll(Ad);AY={color:AX.color,opacity:AX.opacity};}else{AV=d.clone(AS[0]);AT=v.findInArray(Af,function(Ag){return i.isEqualComb(AV,d.clone(Ag.comb));});if(AT===-1){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-FillOpacityAndBorderStyleToolbar",children:AU}]});}AY=Af[AT];}AW={color:AY.color,opacity:AY.opacity,showAutomatic:AS.some(function(Ag){return v.isColorManuallySet(AZ,Ag);})};Ae={onFillChanged:function(Ak,Ai){var Aj=Ak,Ag=Aj==="automatic",Ah;if(Ag){Ak="default";}else{Ak=i.encodeColor(Ak);}Ah=AZ.listenToUpdateColorMap(function(){var Al="#ffffff",Am=AS.length;if(Ag){if(Am===1){Al=i.decodeColor(v.getCombColor(AZ,AY.comb));}if(Ai instanceof Function){Ai(Al);}Aj=Al;}AZ.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});AZ.raiseEvent({name:"colorByColorChange",type:"fill",fill:Aj,showAutomatic:!Ag});AZ.detachUpdateColorMapListener(Ah);});AZ.updateColorMap(AS,v.repeat(Ak,AS.length));},onOpacityChanged:function(Ag){Aa.updateLayerColorByOpacity(AS,v.repeat(Ag,AS.length));AZ.raiseEvent({name:"colorByColorChange",type:"opacity",opacity:Ag});}};AU=[n.call(this,AW,Ae)];return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-FillOpacityAndBorderStyleToolbar",children:AU}]});}function AM(AV,AU,AY,AT,AX){var AS=N(AV,mstrmojo.desc(2885,"Fill"),AY,AT,{showGradient:false}),AR=[AS];if(!AX){var AW=o(AV,mstrmojo.desc(9736,"Border"),AU,AT,undefined,{rowContainerCSSClass:"mstrmojo-ui-rowContainer",showNoneOption:false});AR.push(AW);}return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolbarBorderAndFill",children:AR}]});}function X(AX){if(!AX){return null;}var AW=AX.getXtab(),AT=AW&&AW.model,AR=AT&&AT.docModel,AS=AR&&AR.datasets,AU=AT.data.datasetId,AV;if(AS&&AU){AV=AS[AU];}return AV;}function m(AT,AW,AV){if(!AT||!AW){return ;}var AS=new AO(),AU=AW.graphicType,AR=!!AS.getLatitudeForm(AT)&&!!AS.getLatitudeForm(AT);if(AU!==b.Area){if(!AR&&AV){return b.Area;}}else{if(!AV&&AR){return undefined;}}return AU;}mstrmojo.gmaps._HasContextMenu=mstrmojo.provide("mstrmojo.gmaps._HasContextMenu",{_mixinName:"mstrmojo.gmaps._HasContextMenu",EnumContextMenuTargetType:{GeoGraphic:1,BlankSpace:2,DensityGraphic:3,SelectionArea:4},contextMenu:null,showMenu:function AG(AU,AS){if(mstrApp.isInVFInteractMode){U.stopPropogation(window,AU);U.preventDefault(window,AU);return false;}var AR=this.getMenuConfig(AS),AT;if(!AR.hasMenuItems()){AT=false;}else{AR.hostId=this.id;AR.isHostedWithin=false;AR.position=this.getMousePositionFromEvent(AU);if(Q.checkHasFunction(this.contextMenu,"destroy")){this.contextMenu.destroy();}this.contextMenu=AR.newInstance();this.openPopup(this.contextMenu);AT=true;}return AT;},_isESRIOrMapbox:function t(){var AR=this.mapViewer,AS=AR.getBaseMapType();return AS===AN.Esri||AS===AN.Mapbox;},_validGeoAttribute:function AK(AS){var AR=0,AV=false,AU=false,AT,AX,AW=this._isESRIOrMapbox();r.forEach(AS.fs,function(AY){AT=AY.fgr;AX=AY.fnm;if(AT>0&&AT!==D&&AT!==AP&&AW){AR=AT;return false;}else{if(AT===D||(AX&&AX.toLowerCase().indexOf("latitude")>-1)){AV=true;}else{if(AT===AP||(AX&&AX.toLowerCase().indexOf("longitude")>-1)){AU=true;}}}});return !!AR||(AV&&AU);},findDrillableUnits:function A(AV){var AU=X(AV),AY=AU&&AU.att,AS=AV.getDropZones(),AW=AS&&AS.geoAttribute,AT=[],AR,AX;for(AR=0,AX=AY.length;AR<AX;AR++){if((AW&&AY[AR].did!==AW)&&this._validGeoAttribute(AY[AR])){AT.push(AY[AR]);}}return AT;},getMenuConfig:function W(AY){var AS=this.getGraphicLayerForRMC();if(!AS){return new mstrmojo.ui.menus.MenuConfig();}var AR=this.mapViewer,AX=AR.hasSelectedGraphics(),AV=new mstrmojo.ui.menus.MenuConfig(),Aa=AS.graphicType,AT=AS.getMarkerType(),AW=this,AZ;if(AY&&AY.type===this.EnumContextMenuTargetType.GeoGraphic&&Q.isVI()){if(this.isLinkedFilterEnabled&&this.isLinkedFilterEnabled()){if(!this.isVisMap||this.mapViewer.getGraphicLayer(this.getKeyForTemplateSelection()).isVisible()){var AU=function(){AW.handleContextMenuSelectionData(true);};AV.addMenuItem(mstrmojo.desc(15070,"Go to Targets"),"",AU);AV.addSeparator();}}if(this.canDoMultiSelect()){AV.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));AV.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(h.WEB_DRILL_AND_LINK)){AZ=this.findDrillableUnits(AS);if(AZ&&AZ.length>0){AV.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,function(){var Ad=AZ.length,Ab=new mstrmojo.ui.menus.MenuConfig(),Ac;for(Ac=0;Ac<Ad;Ac++){Ab.addMenuItem(AZ[Ac].n,"xt",AW.getMenuHandler("drill"),{drillUnit:AZ[Ac]});}return Ab;},"xt");}}AV.addSeparator();}if(!mstrApp.isDossier){if(!this.excludeData){AV.addMenuItem(mstrmojo.desc(11476,"Show Data"),"xt",this.getMenuHandler("showData"));}if(Aa!==undefined&&(Aa!==b.Density&&!(Aa===b.Marker&&AT===AL.Image))){AV.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",this.getMenuHandler("shapeFormat"));}}}if(AY&&AY.type===this.EnumContextMenuTargetType.GeoGraphic){if(AS&&AS.isVisible()&&AS.isAffinityLineLayerEnabled()){if(AV.hasMenuItems()){AV.addSeparator();}if(AS.isAffinityLineShown()){AV.addMenuItem(mstrmojo.desc(13650,"Hide affinity lines"),"xt",this.getMenuHandler("hideAffinityLines",AY.object));}else{AV.addMenuItem(mstrmojo.desc(13651,"Show affinity lines"),"xt",this.getMenuHandler("showAffinityLines",AY.object));}}}else{if(AY&&AY.type===this.EnumContextMenuTargetType.BlankSpace){if(AR.isMapEnabledAffinityLine()){if(AV.hasMenuItems()){AV.addSeparator();}if(AR.isMapShownAffinityLine()){AV.addMenuItem(mstrmojo.desc(13650,"Hide affinity lines"),"xt",this.getMenuHandler("hideAllAffinityLines"));}if(AR.isMapHideAffinityLine()){AV.addMenuItem(mstrmojo.desc(13651,"Show affinity lines"),"xt",this.getMenuHandler("showAllAffinityLines"));}}}}if((AX||(AY&&AY.type===this.EnumContextMenuTargetType.GeoGraphic)||(AY&&AY.type===this.EnumContextMenuTargetType.DensityGraphic))&&!Q.isVI()){if(this.isMapDrillEnabled(AS)){if(AV.hasMenuItems()){AV.addSeparator();}AV.addMenuItem(mstrmojo.desc(5752,"Links"),"xt",this.getMenuHandler("linkDrill"));}}return AV;},getMenuHandler:function(AR,AZ){var Af;if(this._super){Af=this._super(AR,AZ);}if(Af!==mstrmojo.emptyFn){return Af;}var Ac=this,AT=AZ,AU={keepOnly:function AY(){x.startTimer({functionName:"Vis.keepOnly",purpose:"from KeepOnly to End"},"timerid_Vis_keepOnly");Ac.processCommon();Ac.isKeepOnlyExclude=true;Ac.processKeepOnly(true);},drill:function Ag(Ah){x.startTimer({functionName:"Vis.drill",purpose:"from drill to End"},"timerid_Vis_drill");Ac.processCommon();Ac.processDrillWithin(Ah);},exclude:function Ae(){x.startTimer({functionName:"Vis.exclude",purpose:"from exclude to End"},"timerid_Vis_exclude");Ac.processCommon();Ac.isKeepOnlyExclude=true;Ac.processExclude();},showData:function AS(){Ac.processCommon();Ac.processShowData();},linkDrill:function AW(){Ac.processCommon();Ac.processDrill();},hideAffinityLines:function AX(){Ac.processCommon();Ac.mapViewer.hideAffinityLinesLayer(AT);},showAffinityLines:function Aa(){Ac.processCommon();Ac.mapViewer.displayAffinityLinesLayer(AT);},hideAllAffinityLines:function Ab(){Ac.processCommon();Ac.mapViewer.hideAllAffinityLinesLayer();},showAllAffinityLines:function Ad(){Ac.processCommon();Ac.mapViewer.showAllAffinityLinesLayer();},shapeFormat:function AV(){Ac.processCommon();Ac.processShapeFormat();}};if(AU.hasOwnProperty(AR)){return AU[AR];}return mstrmojo.emptyFn;},getMousePositionFromEvent:function u(AR){return U.getMousePosition(AR,window);},getTargetConfig:function k(AT){var AR,AS;if(AT&&AT.length>0){AS=AT[0]&&AT[0].getGraphicLayer();this.RMCSelectedLayerKey=AS&&AS.key;AR={type:this.EnumContextMenuTargetType.GeoGraphic,object:AT};}else{AR={type:this.EnumContextMenuTargetType.BlankSpace,object:null};}return AR;},handleContextMenuEvt:function S(AR){var AS=AR&&AR.graphics,AT=this.getTargetConfig(AS),AU=this.showMenu(AR,AT);if(AU||!Q.isVI()){U.stopPropogation(window,AR);U.preventDefault(window,AR);}},getGraphicLayerForRMC:function M(){var AR=this.mapViewer,AS=this.RMCSelectedLayerKey;return AR.getGraphicLayer(AS);},processCommon:function O(){},constructSelectionInfos:function w(AR,AU,AY,AT){var AV=[],AS=this.mapViewer,AX,AW;if(AU){AS.forEachGraphicLayer(function(AZ){AV.push({vis:AZ.getXtab(),graphicLayer:AZ,selectorData:null,nodeIdxToRemove:(AT&&AZ.key!==AT)?undefined:AY});},false,true);}else{AS.forEachGraphicLayer(function(AZ){AW=AZ.getContextMenuSelections();AX={vis:AZ.getXtab(),graphicLayer:AZ,selectorData:null};if(AW&&AW.length>0){AX.nodeIdxToRemove=AR?-2:undefined;AX.selectorData={data:AZ.getContextMenuSelections(),keepOnly:AR};}AV.push(AX);});}return AV;},processKeepOnly:function j(AR){var AS=this.constructSelectionInfos(AR);this.updateAfterKeepOnlyForMultiTemplate(AS);},processDrillTo:function G(AT){var AY=this.zonesModel,AU=AY.getZoneModelByZoneId(AF),AZ=AI(AU.items[0]),AR=this.model.data,AS=AR.datasetId,AV=a.getMatchingShape(this.getMenuConfig().common.shapes,null,AZ),AW=AE(AT,AZ),AX;if(AW&&AV){AX=K(this.model.docModel.datasets,AS,AW);}if(AX){this.processDrillWithin({ctxt:{drillUnit:AX}});}},getValidShapeConfig:function AA(AU){var AX=this.getMapConfig(),AT=AX&&AX.common,AR=AT&&AT.shapes,AW=AT&&AT.layers,AS=this.mapViewer,AV=AS.getBaseMapType(),AY;if(AT&&AU){AY=a.getAvailableShapes(AR,AW,AU,AV);return a.getMatchingShape(AY,null,AU);}},processDrillWithin:function e(AT){var Al=AT.ctxt.drillUnit,Ai=this.getGraphicLayerForRMC(),AU=Ai&&Ai.getContextMenuSelections(),Am=Ai&&Ai.getXtab(),Af=Am&&Am.getData(),Ae=[],Ah=this.zonesModel,AY,AZ={did:Al.did,t:Al.t},Ag={id:J},AV=this.model.docModel.controller._getXtabCallback(this),AX=Af.datasetId,Aj="00000000000000000000000000000000",Ad=0,AS=3,Ao=Ai.key,Ac=AI(Al,true),An=this.getValidShapeConfig(Ac),AR,Ab,Aa,AW={datasetId:AX,datasetType:AX===Aj?Ad:AS},Ak=m(Al,Ai,An);this.selectionHashType=p.RMC_LAYER;if(!Ai||AU.length<=0){return ;}this.updateEditingLayerIdx(Ai.getLayerIdx());v.selectDropZonePanel(this);Ah.getDropZones();AY=Ah.getZoneModelByZoneId(AF);if(AY&&AY.items&&AY.items.length>0&&Al){Ae=Ae.concat(Ah.getActionsForDeleteItem(AY,0));this.updateProperties(Z.graphicType,Ak,Ao);if(!Ak||Ak===b.Area){this.updateProperties(Z.markerType,undefined,Ao);}this.updateProperties("sa",undefined,Ao);this.updateProperties("sm",undefined,Ao);Ah.getDropZones();Aa={allowedItems:[Al],idx:0,edge:0,item:Al,removeReplaced:false};Ab=Ah.getDropActions(AY,Aa,AX);if(Ab&&Ab.actions&&Ab.actions.length>0){Ae=Ae.concat(Ab.actions);}if(Ak===b.Area&&An&&An.sfr){AZ=K(this.model.docModel.datasets,AX,An.sfr);if(AZ){r.insert(Ae,null,Ah.getAddDropZoneUnitsActions(Ag,[AZ],Ah.getItemCountInZone(J),AW));}}AR=[{act:"updateTemplate",keyContext:Ao,actions:Ae}];AR.push(Ah.getWidgetPropsAction());this.updateAfterDrill(AR,AV,Am);}},processExclude:function z(){this.processKeepOnly(false);},processShowData:function B(){this.showData();},hideToolbar:function(){var AV=this.domToolbarPH,AW=AV.firstChild,AR=AV.parentNode,AU=this;function AS(AX,AY){if(AY){r.removeItem(AX.disposables,AY);AY.destroy();}}AS(AU,AU.toolEditor);if(AW){AV.removeChild(AW);}if(AR){AR.removeChild(AV);}var AT=AU.toolEditor;if(AT){AU.removeChildren(AT);AT.unrender=function(){AT._super();};AT.destroy();AT.unrender=function(){};delete AU.toolEditor;C.toggleClass(document.body,"hasToolbarPopup",false);C.toggleClass(AV,mstrApp.getThemeClassName(),false);}if(AU.toolEditorClosefn){U.detachEvent(document.body,"mousedown",AU.toolEditorClosefn,true);delete AU.toolEditorClosefn;}},processShapeFormat:function q(){var AR=this.contextMenu,AU=AR&&AR.popupConfig&&AR.popupConfig.position,AS=this.getEditingHost(),AT;v.selectPropertyPanel(this,this.isMapbox()?R.TARGET_FORMATTING_LAYERS:R.TARGET_MAPOPTIONS);this.selectRMCLayer();AS.parent.selectVIUnit();AT=this.getShapeFormatToolbarConfig();if(AT){I.call(this,AU,AT);}},selectRMCLayer:function AQ(){var AR=this.edtModel;if(AR&&typeof AR.selectLayerForRMCFmt==="function"){AR.selectLayerForRMCFmt(this.RMCSelectedLayerKey);}},getShapeFormatToolbarConfig:function(){var AV=[E.SHAPE_FORMAT_BORDER_COLOR,E.SHAPE_FORMAT_BORDER_STYLE],Aa=[E.SHAPE_FORMAT_FILL_COLOR,E.SHAPE_FORMAT_FILL_OPACITY],AT;var AU=this.getGraphicLayerForRMC(),AZ=this.RMCSelectedLayerKey,Ab=AU.graphicType,AS=AU.map,AX=AS.isEditingDropZoneColorByAttr(),Ac=AS.getDropZoneItems(mstrmojo.vi.viz.EnumDSSDropZones.ColorBy,AZ),AW=AX===false&&Ac&&Ac.length>0,AY=AX===true&&Ac&&Ac.length>0,AR=Ab===b.Marker;if(AW){AT=P(this,AR,AZ);}else{if(AY){AT=AH(this,AU);}else{AT=AM(this,AV,Aa,null,AR);}}return AT;},processDrill:function g(){this.getGraphicLayerForRMC().processDrill();},isMapDrillEnabled:function Y(AR){return AR.isDrillable();},canDoMultiSelect:function AC(){var AS=this.mapViewer,AR=true;AS.forEachGraphicLayer(function(AU){var AT=function(AV){return AV.graphics&&AV.graphics.length>0;};if(AT(AU)&&!AU.canDoMultiSelect()){AR=false;}});return AR;}});})();(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.string","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapLegendEnums","mstrmojo.gmaps._MapLegendInteractivity");var Y=mstrmojo,Z=Y.css,I=Y.gmaps,A=Y.string,M=I.MapUtils,H=I.ShapeType,K=I.LegendInteractiveType;function V(c){return c.replace(/ {2,}/g," ");}function S(e,c){var d;d=V(c);e.innerHTML=A.encodeHtmlString(d,true);}function a(d,e,c){return e.map(function(g,f){return{eid:g,tid:d[f],tp:c[f]};});}function Q(i,d){var f=M.createSvgNode("svg"),c,h,g,e;M.setNodeAttributes(f,{width:14,height:14});M.setNodeAttributes(f,{type:K.LGD_COLOR_SVG_CON});M.setNodeAttributes(i,{type:K.LGD_COLOR_SVG_SHAPE});M.appendNode(f,i);if(this.isColorByAttr){c=d.token;h=c.elements||[];g=c.levels||[];e=c.types||[];i.colorIdentity={comb:a(g,h,e),decodedColor:d.decodedColor,isDefaultColor:d.isDefaultColor};}return f;}function B(c){var d=M.createSvgNode("circle");M.setNodeAttributes(d,{r:5,cx:7,cy:7,fill:c.decodedColor||c.color,"fill-opacity":c.opacity});return Q.call(this,d,c);}function J(c){var d=M.createSvgNode("rect");M.setNodeAttributes(d,{width:10,height:10,x:2,y:2,fill:c.decodedColor||c.color,"fill-opacity":c.opacity});return Q.call(this,d,c);}function C(c){var d=M.createSvgNode("rect");M.setNodeAttributes(d,{width:8,height:8,x:2.9568542,y:2.9568542,transform:"translate(6.956854, 6.956854) rotate(45.000000) translate(-6.956854, -6.956854) ",fill:c.decodedColor||c.color,"fill-opacity":c.opacity});return Q.call(this,d,c);}function F(c){var d=M.createSvgNode("polygon");M.setNodeAttributes(d,{points:"3.30359173 3.63001678 9.94312408 1.75 12.5 9.30555556 7 12.4201117 1.5 9.30555556",fill:c.decodedColor||c.color,"fill-opacity":c.opacity});return Q.call(this,d,c);}function O(c){var d=M.createSvgNode("path");M.setNodeAttributes(d,{d:"M7,1.25 C4.51836842,1.25 2.5,3.26753947 2.5,5.74810526 C2.5,6.80051316 3.18234211,8.18994737 4.31278947,9.72740789 C5.16684211,10.8888816 6.24542105,12.0607763 6.79039474,12.4630526 L7.00082895,12.6184211 L7.21221053,12.4643553 C7.75765789,12.0669342 8.83564474,10.9003684 9.68946053,9.73960526 C10.81825,8.20486842 11.5,6.81117105 11.5,5.74810526 C11.5,3.26753947 9.48163158,1.25 7,1.25",fill:c.decodedColor||c.color,"fill-opacity":c.opacity});return Q.call(this,d,c);}function P(d){var c=document.createElement("div");M.setNodeAttributes(c,{"class":"map-legend-text-cell",title:d});c.innerHTML=d;return c;}function E(d){var c=document.createElement("div");M.setNodeAttributes(c,{"class":"map-legend-color-image-block"});if(d){c.style.backgroundImage=d;}return c;}function X(c,g){var j,d,m,l,e,f,h,k;d=c.length;l=document.createDocumentFragment();for(j=0;j<d;j+=1){h=c[j];m=document.createElement("div");M.setNodeAttributes(m,{"class":"map-legend-content-table-row"});e=document.createElement("div");M.setNodeAttributes(e,{"class":"map-legend-color-block-container",type:K.LGD_COLOR_BLOCK_CON});if(!h.image){switch(g){case H.CIRCLE:k=B.call(this,h);break;case H.PIN:k=O.call(this,h);break;case H.RECT:k=J.call(this,h);break;case H.DIAMOND:k=C.call(this,h);break;case H.POLYGON:k=F.call(this,h);break;default:k=J.call(this,h);break;}e.appendChild(k);}else{e.appendChild(E(h.image));}m.appendChild(e);m.appendChild(P(h.label));l.appendChild(m);}return l;}function R(c,e){var d;d=document.createElement("div");M.setNodeAttributes(d,{"class":"map-legend-content-table-row"});d.appendChild(c);d.appendChild(P(e));return d;}function U(i){var g,e,c,h,j,d,f;f=document.createDocumentFragment();e="Min: "+i[i.length-1];h=document.createElement("div");M.setNodeAttributes(h,{"class":"map-legend-origin-size-block"});d=document.createElement("div");M.setNodeAttributes(d,{"class":"map-legend-size-block-min-container"});d.appendChild(h);g="Max: "+i[0];c=document.createElement("div");M.setNodeAttributes(c,{"class":"map-legend-origin-size-block"});j=document.createElement("div");M.setNodeAttributes(j,{"class":"map-legend-size-block-max-container"});j.appendChild(c);f.appendChild(R.call(this,d,e));f.appendChild(R.call(this,j,g));return f;}function b(d){var c=d.getAttribute("type");if(c===K.LGD_COLOR_SVG_SHAPE){d=d.parentNode;c=d.getAttribute("type");}if(c===K.LGD_COLOR_SVG_CON){d=d.parentNode;c=d.getAttribute("type");}if(c===K.LGD_COLOR_BLOCK_CON){return d;}return null;}mstrmojo.gmaps.MapSingleLegendContent=mstrmojo.declare(mstrmojo.Vis,[mstrmojo.gmaps._MapLegendInteractivity],{scriptClass:"mstrmojo.gmaps.MapSingleLegendContent",isColorByAttr:false,initTableOffsetHeight:-1,widgetId:null,markupString:'<div class="map-legend-content" mstrAttach:click,mouseover,mouseout,contextmenu><div class="map-legend-content-name"></div><div class="map-legend-content-container"><div class="map-legend-content-table"></div></div></div>',markupSlots:{domLgdContent:function(){return this.domNode;}},postBuildRendering:function T(){this._super();var f=this.domLgdContent,d=f.firstChild,c=f.lastChild,e=c.firstChild;this.addSlots({contentName:d,contentElementTable:e});},handleColorBy:function N(d,f,c,e){var g=this.contentName,h=this.contentElementTable;if(c){this.isColorByAttr=c;this.widgetId=e;this.initializePH();}S.call(this,g,d.item);h.appendChild(X.call(this,d.elements,f));},handleSizeBy:function W(c){var d=this.contentName,e=this.contentElementTable;S.call(this,d,c.item);e.appendChild(U.call(this,c.elements));},onmouseover:function G(c){var d=c.getTarget();if(this.isColorByAttr){d=b(d);if(d){Z.addClass(d,"hover");}}},onmouseout:function D(c){var d=c.getTarget();if(this.isColorByAttr){d=b(d);if(d){Z.removeClass(d,"hover");}}},oncontextmenu:function(c){var e=c.getTarget(),d=e.getAttribute("type");if(this.isColorByAttr){if(d===K.LGD_COLOR_BLOCK_CON){e=e.firstChild;d=e.getAttribute("type");}if(d===K.LGD_COLOR_SVG_CON){e=e.firstChild;d=e.getAttribute("type");}if(d===K.LGD_COLOR_SVG_SHAPE){c.cancel();c.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()||mstrApp.isInVFInteractMode){return ;}this.handleRMCColorPicker(e);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var D=mstrmojo.gmaps.MapUtils,C=15;mstrmojo.gmaps.geometry.Square=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.Square",nodeTag:"rect",width:15,height:15,initNodeStyles:function G(){this._super();this.setDimension(this.width,this.height);},setPosition:function B(H){this._super(H);if(D.checkVal(this.x)&&D.checkVal(this.y)&&D.checkVal(this.width)&&D.checkVal(this.height)){D.setNodeAttributes(this.node,{x:this.x-this.width/2,y:this.y-this.height/2});}},setDimension:function A(I,H){if(D.checkVal(I)&&D.checkVal(H)){D.setNodeAttributes(this.node,{width:I,height:H});}},loadProps:function E(H){if(!!H&&D.checkVal(H.width)&&D.checkVal(H.height)){this.width=H.width;this.height=H.height;}},getGeometrySize:function F(){return{width:C,height:C};}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var M=mstrmojo,F=M.gmaps,J=F.MapUtils,G=F.MarkerAlignOption;mstrmojo.gmaps.geometry.SVGImage=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.SVGImage",nodeTag:"image",imgUrl:null,width:null,height:null,actualWidth:null,actualHeight:null,defaultWidth:19,defaultHeight:24,opacity:1,initNodeStyles:function P(){this.width=(J.checkVal(this.width))?this.width:this.defaultWidth;this.height=(J.checkVal(this.height))?this.height:this.defaultHeight;this.setDimension(this.width,this.height);this.setImageUrl(J.convertImageUrl(this.imgUrl));},loadProps:function H(Q){if(!!Q){this._super(Q);if(J.checkVal(Q.actualWidth)&&J.checkVal(Q.actualHeight)){this.actualWidth=Q.actualWidth;this.actualHeight=Q.actualHeight;}}},setPosition:function O(Q){this._super(Q);if(J.checkVal(this.x)&&J.checkVal(this.y)&&J.checkVal(this.actualWidth)&&J.checkVal(this.actualHeight)){J.setNodeAttributes(this.node,{x:this.x-this.actualWidth/2,y:this.y-this.actualHeight});}},setDimension:function K(R,Q){if(!J.checkVal(R)||!J.checkVal(Q)){return ;}J.setNodeAttributes(this.node,{width:R,height:Q});this.actualWidth=R;this.actualHeight=Q;},setFillColor:function E(){return null;},setSelection:function N(Q){this.opacity=1;this._setHighlight(Q);this.disableHover=Q;},setUnSelection:function D(){this.opacity=0.5;this._setHighlight(false);},setHover:function A(Q){if(!this.disableHover){this._setHighlight(Q);}},setImageUrl:function B(Q){if(this.node&&Q){this.node.setAttributeNS("http://www.w3.org/1999/xlink","href",Q);}},_setHighlight:function I(Q){if(J.checkVal(this.width)&&J.checkVal(this.height)){if(Q){this.setDimension(this.width+10,this.height+10);}else{this.setDimension(this.width,this.height);}}this.setPosition();if(J.checkVal(this.opacity)){J.setNodeAttributes(this.node,{opacity:this.opacity});}},getGeometryAlignOption:function C(){return G.BOTTOM;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var C=mstrmojo.gmaps.MapUtils,D=16,B="M {x},{y-8} l 8,8 l -8,8 l -8,-8 Z";mstrmojo.gmaps.geometry.Diamond=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.Diamond",nodeTag:"path",setPosition:function A(F){this._super(F);if(C.checkVal(this.x)&&C.checkVal(this.y)){C.setNodeAttributes(this.node,{d:B.replace("{x}",this.x).replace("{y-8}",this.y-8)});}},getGeometrySize:function E(){return{width:D,height:D};}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var C=mstrmojo.gmaps.MapUtils;function A(G){return G*Math.PI/180;}mstrmojo.gmaps.geometry.PieSlice=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.PieSlice",nodeTag:"path",isRing:true,startDegree:0,endDegree:90,innerR:15,outterR:25,strokeScale:1.2,getSlicePath:function D(U,T){var X=A(this.startDegree),G=A(this.endDegree),O=Math.abs(G-X)>Math.PI?1:0,N=this.outterR,R=this.innerR,W=U+N*Math.cos(X),M=T+N*Math.sin(X),V=U+N*Math.cos(G),K=T+N*Math.sin(G),S,J,Q,I,P,H=function(Z){var Y;for(Y=0;Y<Z.length;Y++){if(isNaN(Z[Y])){console.log("invalid param for drawing pie slice");return false;}}return true;};if(!H([U,T,N,X,G])){return ;}if(this.isRing){S=U+R*Math.cos(X);J=T+R*Math.sin(X);Q=U+R*Math.cos(G);I=T+R*Math.sin(G);P="M "+W+","+M+" A "+N+","+N+" 0 "+O+",1 "+V+","+K+" L "+Q+","+I+" A "+R+","+R+" 0 "+O+",0 "+S+","+J+" Z";}else{P="M "+W+","+M+" A "+N+","+N+" 0 "+O+",1 "+V+","+K+" L "+U+","+T+" Z";}return P;},setPosition:function B(G){this._super(G);if(!!C.checkVal(this.x)&&!!C.checkVal(this.y)){C.setNodeAttributes(this.node,{d:this.getSlicePath(this.x,this.y)});}},getGeometrySize:function F(){if(C.checkVal(this.outterR)){var G=2*this.outterR;return{width:G,height:G};}},getPercentage:function E(){if(C.checkVal(this.startDegree)&&C.checkVal(this.endDegree)){return(Math.abs((this.endDegree-this.startDegree)/360)*100).toFixed(2)+"%";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var C=mstrmojo.gmaps.MapUtils,F={fontFamily:"font-family",fontSize:"font-size",fontWeight:"font-weight",fontStyle:"font-style",textDecoration:"text-decoration"};mstrmojo.gmaps.geometry.Text=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.Text",nodeTag:"text",text:"",fontSize:10,fontFamily:"Arial",defaultFillColor:"#ffffff",isCenterAlign:false,skipStrokeProperty:true,initNodeStyles:function H(){this._super();this.applyTextContent(this.text);this.applyFontFormat(this);this.applyAlignment();},applyTextContent:function D(J){var I=this.node;if(I){if(I.textContent!==undefined){I.textContent=J;}else{I.innerText=J;}}this.text=J;},applyFontFormat:function A(K){if(!K){return ;}var I={},J;for(J in F){if(K[J]){I[F[J]]=this[J]=K[J];if(J==="fontFamily"){I[F[J]]="'"+K[J]+"'";}}}C.setNodeAttributes(this.node,I);},applyAlignment:function E(){if(this.isCenterAlign){C.setNodeAttributes(this.node,{"text-anchor":"middle",dy:".35em"});}},setPosition:function B(I){this._super(I);if(C.checkVal(this.x)&&C.checkVal(this.y)){C.setNodeAttributes(this.node,{x:this.x,y:this.y});}},update:function G(I){if(!I){return ;}this._super(I);var J=I.text;if(C.checkDefined(J)){this.applyTextContent(J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var D=mstrmojo.gmaps.MapUtils;mstrmojo.gmaps.geometry.Circle=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.Circle",nodeTag:"circle",defaultRadius:10,radius:null,geoRadius:null,update:function H(I){this._super(I);if(!!I&&D.checkVal(I.radius)){this.radius=I.radius;}this.setRadius(this.radius);},setPosition:function C(I){this._super(I);if(D.checkVal(this.x)&&D.checkVal(this.y)){D.setNodeAttributes(this.node,{cx:this.x,cy:this.y});}},setRadius:function B(I){this.radius=(D.checkVal(I))?I:this.defaultRadius;this.setPosition();if(D.checkVal(this.radius)){D.setNodeAttributes(this.node,{r:parseInt(this.radius)});}},getGeometrySize:function G(){if(D.checkVal(this.radius)){var I=2*this.radius;return{width:I,height:I};}},contains:function E(J,K){var I,N,J=K||J;if(!J||!D.checkVal(this.geoRadius)){console.log("Circle.contains(): invalid geo point/radius");return false;}if(J.lat){I=J.lng;N=J.lat;}else{I=J.x;N=J.y;}var M=this.coolWPDistance(this.lat,this.lng,N,I);return M<=this.geoRadius;},intersectPolygon:function F(J,I){if(!J){console.log("intersectPolygon(): invalid polygon");return false;}return this._isCenterContained(J)||this.containVertexInPolylineArr(I);},_isCenterContained:function A(I){return !!I&&(I.contains instanceof Function)&&I.contains({x:this.x,y:this.y});}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Point");var B=mstrmojo.gmaps,E=B.MapUtils,C=B.MarkerAlignOption,F=17,D=20;mstrmojo.gmaps.geometry.Pin=mstrmojo.declare(mstrmojo.gmaps.geometry.Point,null,{scriptClass:"mstrmojo.gmaps.geometry.Pin",nodeTag:"path",pathStr:"M{x},{y-19}c0.7,0,2,0.2,2.4,0.4c4,1.4,5.9,5.5,4.5,9.7c-1.2,3.6-3.5,6.5-6,9.2c-0.5,0.6-1.2,0.6-1.7,0.1c-2.9-3.1-5.6-6.4-6.5-10.7c-0.8-4,1.8-7.7,5.8-8.5C{x-1.2},{y-18.9},{x-0.6},{y-19},{x},{y-19}L{x},{y-19}z",setPosition:function G(J){this._super(J);E.setNodeAttributes(this.node,{d:this._generatePathStr()});},_generatePathStr:function I(){var K=this.x,J=this.y,M=this.pathStr;if(E.checkVal(K)&&E.checkVal(J)&&!!M){return M.replace(/\{x\}/g,K).replace(/\{y\-19\}/g,J-19).replace("{x-1.2}",K-1.2).replace("{x-0.6}",K-0.6).replace("{y-18.9}",J-18.9);}},getGeometrySize:function H(){return{width:F,height:D};},getGeometryAlignOption:function A(){return C.BOTTOM;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.geometry.Extent");var F=mstrmojo,D=F.array,H=F.gmaps.geometry.Extent;function C(Q){if(!Q||Q.length<=0){return 0;}var R=0,J=Q.length,P,O,M,N,K;for(P=0;P<J-1;P++){O=Q[P][0];M=Q[P][1];N=Q[P+1][0];K=Q[P+1][1];R+=(O*K-N*M);}O=Q[J-1][0];M=Q[J-1][1];N=Q[0][0];K=Q[0][1];R+=(O*K-N*M);return Math.abs(R);}function E(N){var M,P=(N&&N.length)||0,O,J=Number.NEGATIVE_INFINITY,K=-1;if(P===1){return 0;}for(M=0;M<P;M++){O=C(N[M]);if(O>J){J=O;K=M;}}return K;}function I(N,M){if(!D.isArray(N)||N.length<1){return ;}var K=new H({isGeo:!M}),J,O,P;for(O=0,P=N.length;O<P;O++){J=N[O];K.mergePoint(J.lat,J.lng);}return K;}mstrmojo.gmaps.GraphicUtils=mstrmojo.provide("mstrmojo.gmaps.GraphicUtils",{_mixinName:"mstrmojo.gmaps.GraphicUtils",getCentroidOfPolygon:function G(U){var N=E(U);if(N<0){return null;}U=U[N];var J=0,S,O=U.length,M,T,R,Q,P,K=[0,0];for(M=0;M<O-1;M++){T=U[M][0];R=U[M][1];Q=U[M+1][0];P=U[M+1][1];S=(T*P-Q*R);J+=S;K[0]+=(T+Q)*S;K[1]+=(R+P)*S;}T=U[O-1][0];R=U[O-1][1];Q=U[0][0];P=U[0][1];S=(T*P-Q*R);J+=S;K[0]+=(T+Q)*S;K[1]+=(R+P)*S;J=J*3;K=[K[0]/J,K[1]/J];return K;},calGeoExtent:function B(M,O){var J,N,K;if(!D.isArray(O)||O.length<1){return ;}J=new H({isGeo:!M});for(N=0,K=O.length;N<K;N++){J.union(I(O[N],M));}return J;},unifyPolygonJSON:function A(J){if(!J){return ;}return D.map(J,function(K){return D.map(K,function(M){if(M){return[M.x,M.y];}});});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Extent");var T=mstrmojo,B=T.emptyFn,G=T.gmaps,J=G.MapUtils,W=G.geometry.Extent;mstrmojo.gmaps.layer.Layer=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gmaps.layer.Layer",parent:null,map:null,div_:null,key:null,_active:false,geoExtent:null,mXMLNS:"http://www.w3.org/2000/svg",init:function P(Y){this._super(Y);if(this.parent){this.map=this.parent.parent;}this._initLayerDomTree();},_initLayerDomTree:B,updateMapExtent:function E(){var Y=this.parent;if(!!Y&&Y.updateMapExtent instanceof Function){this._active=true;Y.updateMapExtent(this.key);}},setVisibility:function O(Y){var Z=this.getNode();if(Z&&Z.style){Z.style.display=(!!Y)?"block":"none";}},getCurrentSize:function R(){var Y=this.getNode(),Z=Y&&Y.getBoundingClientRect();if(Z){return{width:Z.width,height:Z.height};}},resize:function V(b,Y){var a=this.div_,Z=this.getCurrentSize();if(!!a&&J.checkVal(Y)&&J.checkVal(b)&&Z&&!(Y===Z.height&&b===Z.width)){J.setCssStyles(a,{height:parseInt(Y)+"px",width:parseInt(b)+"px"});return true;}},panBy:B,getNode:function C(){return this.div_;},getBaseLayer:function I(){return this.parent&&this.parent.baseLayer;},getGeoExtent:function X(){return this.cloneExtent(this.geoExtent);},getWidth:function A(){var Y=this.map;if(Y){return parseInt(Y.width);}},getHeight:function M(){var Y=this.map;if(Y){return parseInt(Y.height);}},getGraphicsOffset:function H(){var Y=this.parent,Z=Y&&Y.cssTransform;return(!!Z&&J.checkVal(Z.x)&&J.checkVal(Z.y))?Z:null;},isActive:function Q(){return !!this._active;},isForPremium:function K(){var Y=this.parent;return !!(Y&&Y.constructor===T.mapbox.MapboxViewer);},cloneExtent:function N(b){if(!b){return ;}var c=b.latSouth,Z=b.latNorth,Y=b.lngWest,a=b.lngEast;if(J.checkVal(c)&&J.checkVal(Z)&&J.checkVal(Y)&&J.checkVal(a)){return new W({isGeo:b.isGeo,latSouth:c,latNorth:Z,lngWest:Y,lngEast:a});}},addEventListeners:B,removeEventListeners:B,destroyLayerDom:function D(){this.removeEventListeners();if(!!this.div_){this.div_.innerHTML="";if(this.div_.parentNode){this.div_.parentNode.removeChild(this.div_);}}delete this.div_;},unrender:function S(){this._active=false;},destroyObj:function F(Z){var Y=this.parent;if(Y&&Y.destroyObj instanceof Function){Y.destroyObj(Z);}},destroy:function U(){this.unrender();delete this.parent;delete this.map;this.destroyObj(this.geoExtent);delete this.geoExtent;this.destroyLayerDom();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.Polygon");function B(J){var H=J.rA,G=J.rB,F=J.xA,D=J.yA,E=J.xB,C=J.yB;var I=((F-E)*(H-G)+(D-C)*Math.sqrt((F-E)*(F-E)+(D-C)*(D-C)-(H-G)*(H-G)))/((F-E)*(F-E)+(D-C)*(D-C));var K=((D-C)*(H-G)-(F-E)*Math.sqrt((F-E)*(F-E)+(D-C)*(D-C)-(H-G)*(H-G)))/((F-E)*(F-E)+(D-C)*(D-C));return[{x:(E-G*I),y:(C-G*K)},{x:(F-H*I),y:(D-H*K)}];}mstrmojo.gmaps.geometry.TangentPath=mstrmojo.declare(mstrmojo.gmaps.geometry.Polygon,null,{scriptClass:"mstrmojo.gmaps.geometry.TangentPath",radiusA:1,radiusB:1,update:function A(I){var H;this.loadProps(I);if(this.screenPolylineArr){var J=this.screenPolylineArr[0],F=J[0],D=J[1];if(F&&D){var C={rA:this.radiusA,rB:this.radiusB,xA:F.x,yA:F.y,xB:D.x,yB:D.y};var G=B(C);C.rA*=-1;C.rB*=-1;var E=B(C);H=this.generatePath([[G[0],G[1],E[1],E[0]]]);}}this.setPath(H);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.Layer","mstrmojo.gmaps.basemap._CanLoadMapExternalScript","mstrmojo.PerformanceLogOutput");var p=mstrmojo,e=p.emptyFn,q=p.array,K=p.gmaps,C=K.MapUtils,m=K.EnumTransformState,U=K.EnumGeometryType,H=K.EnumPropertyType,r=p.PerformanceLogOutput,v=1e-7,g={lat:31,lng:-97};mstrmojo.gmaps.layer.BaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.Layer,[mstrmojo.gmaps.basemap._CanLoadMapExternalScript],{scriptClass:"mstrmojo.gmaps.layer.BaseLayer",_baseMap:null,baseMapType:null,mapStyle:null,eventListenerArr:null,gridParams:null,mstProp:null,attributeMapping:null,isOnPremise:null,isSupport:true,minZoom:0,maxZoom:16,defaultZoom:1,wgs84SP:{wkid:4326},originalZoom:null,originalLatLngCenter:null,originalGeoExtent:null,originalBearing:null,originalPitch:null,mapZoom:null,mapCenter:null,hasLoaded:false,transformState:null,_xCoordsMin:0,_xCoordsMax:0,xCoordsMinForG:null,xCoordsMaxForG:null,geoScreenRange:0,showZoomBtns:true,mvo:null,typeForThumbnail:null,lastPointX:null,lastPointLng:null,needResize:false,domId:null,toUpdateLayers:null,supportLayerZoomRange:false,init:function AG(AL){this._super(AL);this.eventListenerArr=[];this.isBaseMapReady=false;this._initDefaultZoom();},_initLayerDomTree:function M(){var AN=this.parent,AM=AN&&AN.getBaseLayerContainer(),AL=this.div_=document.createElement("div");this.domId=this.id+"-baseLayer-content";C.setLayerNodeProps(AL,this.domId,"mstrMap-baseLayer-content",this.getWidth(),this.getHeight());if(AM){AM.appendChild(AL);}},_initDefaultZoom:function l(){var AM=this.getWidth(),AL=this.getHeight(),AO,AN;if(C.checkVal(AM)&&C.checkVal(AL)){AO=Math.max(parseInt(AM),parseInt(AL));AN=Math.floor(Math.log(AO)/Math.LN2)-7;this.defaultZoom=AN>1?AN:1;}},loadBaseMap:function AB(){var AL=this.parent;if(AL&&AL.cloudLayerInit!==true){AL.cloudLayerInit=true;AL.refreshCloudLayers();}},render:function n(){C.showWait();this.processConfigInfo();this.initBaseMap();C.hideWait();},resize:function X(AN,AL){if(!this._super(AN,AL)){return ;}var AM=this.parent;this.needResize=AM&&AM.isDynamicZoom()===true;},updateForResizing:function AH(){var AL=this.needResize,AM=this.parent;this.needResize=null;if(AL&&AM){this.isBaseMapReady=false;this.setExtent(AM.getMapGeoExtent(),true);}},updateExtent:function AJ(AL){var AN,AM;this.isBaseMapReady=false;if(C.checkVal(this.originalZoom)&&this.originalLatLngCenter){if(this.supportBearingAndPitch()){this.setBearing(this.originalBearing);this.setPitch(this.originalPitch);}this.centerAndZoom(this.originalLatLngCenter,this.originalZoom);this.originalZoom=null;this.originalLatLngCenter=null;this.originalBearing=null;this.originalPitch=null;}else{if(AL){AN=Math.abs(AL.latNorth-AL.latSouth);AM=Math.abs(AL.lngEast-AL.lngWest);}if(AN<v&&AM<v){this.toUpdateLayers=true;this.centerAndZoom({lat:AL.latNorth,lng:AL.lngEast},this.maxZoom);}else{this.setExtent(AL);}}},setZoom:function Y(AM){var AL=this._baseMap;if(AL&&AL.setZoom instanceof Function&&C.checkVal(AM)){AL.setZoom(this.validateZoomLevel(AM));}},getZoom:function V(){var AL=this._baseMap;if(AL&&(AL.getZoom instanceof Function)){return AL.getZoom();}},validateZoomLevel:function R(AM){var AL=AM;if(AM<this.minZoom){AL=this.minZoom;}else{if(AM>this.maxZoom){AL=this.maxZoom;}}return AL;},getScreenPositionInfo:function Z(AN){if(!AN){return ;}var AM=AN.type,AL=AN.geoData;switch(AM){case U.Point:return this.getScreenPointInfo(AL);case U.Polygon:return this.getScreenPolygonInfo(AL);default:break;}},getScreenPolygonInfo:function Q(AM){var AL=[];q.forEach(AM,function(AN){var AO=this.getScreenPolylineInfo(AN);if(q.isArray(AO)){AL=AL.concat(AO);}},this);return{screenPolylineArr:AL};},getScreenPolylineInfo:function D(AM){this.transformState=m.ReadyToUse;this.lastPointLng=null;this.lastPointX=null;var AL=[[]];q.forEach(AM,function(AN){if(!!AN){var AO=this.getScreenPointInfo(AN);if(AO){AN.x=AO.x;AN.y=AO.y;}this._updateStateForPolylineTransform(AO,AN);this._addPointToScreenPolylines(AO,AL);}},this);delete this.transformState;return AL;},getScreenPointInfo:function N(AL){var AN=this.getGraphicsOffset(),AM=this.latLngToPixelXY(AL);if(!AN||!C.checkVal(AN.x)||!C.checkVal(AN.y)){return AM;}else{if(AM&&C.checkVal(AM.x)&&C.checkVal(AM.y)){return{x:AM.x-AN.x,y:AM.y-AN.y};}}},adjustPointInsideViewer:function a(AL,AN){var AO=this.geoScreenRange,AM;if(!C.checkVal(AO)||!C.checkVal(AN)||(AO===0)||!AL||!C.checkVal(AL.x)){return AL;}AM=(AL.x-AN)%AO;while(AM<0){AM+=AO;}AL.x=AM+AN;return AL;},_addPointToScreenPolylines:function G(AO,AL){if(!AO||!C.checkVal(AO.x)||!C.checkVal(AO.y)||!q.isArray(AL)){return ;}var AN=AL[0],AM=AL[1],AP=function(AR,AW,AS,AT,AV){var AU=AW[AW.length-1],AQ=(AR.y+AU.y)/2;if(AR.x<AU.x){AW.push({x:AV,y:AQ});AS.push({x:AT,y:AQ});}else{AW.push({x:AT,y:AQ});AS.push({x:AV,y:AQ});}};switch(this.transformState){case m.UseExistingLine:default:AN.push(AO);break;case m.UseNewLine:AM.push(AO);break;case m.CrossFromExistingToNewLine:if(!q.isArray(AM)){AM=AL[1]=[];}AP(AO,AN,AM,this.xCoordsMinForG,this.xCoordsMaxForG);AM.push(AO);break;case m.CrossFromNewToExistingLine:AP(AO,AM,AN,this.xCoordsMinForG,this.xCoordsMaxForG);AN.push(AO);break;}},_updateStateForPolylineTransform:function w(AM,AL){if(!C.checkDefined(this.transformState)){return ;}var AN=this.checkXBoundary(AM,AL);if(!!AN){switch(this.transformState){case m.UseExistingLine:case m.CrossFromNewToExistingLine:this.transformState=m.CrossFromExistingToNewLine;break;case m.UseNewLine:case m.CrossFromExistingToNewLine:this.transformState=m.CrossFromNewToExistingLine;break;default:break;}}else{switch(this.transformState){case m.ReadyToUse:case m.CrossFromNewToExistingLine:this.transformState=m.UseExistingLine;break;case m.CrossFromExistingToNewLine:this.transformState=m.UseNewLine;break;default:break;}}},checkXBoundary:function j(AM,AL){if(!AM||!C.checkVal(AM.x)||!C.checkVal(AM.y)||!AL||!C.checkVal(AL.lat)||!C.checkVal(AL.lng)){return ;}var AO,AN;if(C.checkVal(this.lastPointX)&&C.checkVal(this.lastPointLng)){AO=((AL.lng>this.lastPointLng)&&(AM.x<this.lastPointX))||((AL.lng<this.lastPointLng)&&(AM.x>this.lastPointX));AN=this.checkCrossLng180(AL.lng,this.lastPointLng);}this.lastPointLng=AL.lng;this.lastPointX=AM.x;return(!!AN)?!AO:!!AO;},checkCrossLng180:function AI(AM,AL){return(C.checkVal(AM)&&C.checkVal(AL))&&(Math.abs(AM-AL)>180);},updateMapExtent:function f(){this.hasLoaded=true;this._super();},updateGraphicLayers:function B(){var AL=this.parent;if(AL&&AL.hasInit===true&&this.canUpdateLayers()){AL.resetCssTransform();AL.updateCoordForAllGraphicLayers();this.toUpdateLayers=false;}},canUpdateLayers:function y(){return !!this.toUpdateLayers;},handleZoomStart:function O(){var AL=this.parent;if(AL){AL.hideAllGraphicLayers();}},handleZoomChange:function W(){this.mapZoom=this.getZoom();this.toUpdateLayers=true;if(typeof this.autoSwitchStyles==="function"){this.autoSwitchStyles();}this.autoSaveZoomAndPos();},handleExtentChangeEvt:function E(){r.endTimer("timerid_callback_handleExtentChange");r.visPrint("render All Graphic Layers start");r.startTimer({functionName:"BaseLayer.handleExtentChange: ",purpose:"render all graphic layers"},"timerid_handleExtentChange");var AM=!(this.resetExtentConfig||this.needResize),AL=this.map;if(!AL){return ;}if(AM){this.updateGraphicLayers();}if(this.resetExtentConfig){if(AL.needMapReadyEvent()){this.isBaseMapReady=false;}this.setExtent(this.resetExtentConfig);this.resetExtentConfig=null;}this.updateForResizing();this.handleExtentChange();},handleExtentChange:function k(){this.mapCenter=this.getLngLatCenter();this.autoSaveZoomAndPos();},autoSaveZoomAndPos:function A(){var AL=this.map;if(AL){AL.autoSaveZoomAndPos();}},handleMouseWheel:function AC(AN){if(!AN||!AN.zoomDelta){return ;}var AM=this._baseMap,AL;if(!!AM){AL=this.validateZoomLevel(AM.getZoom()+AN.zoomDelta);AM.setZoom(AL);}},isDHTMLinIE:function(){var AM=window.navigator.appVersion,AL=(AM.indexOf("MSIE")!==-1||AM.indexOf("Trident/")>0),AN=this.map&&this.map.getMapConfig();return(AN&&AN.common.isRW&&(typeof (microstrategy)!=="undefined")&&AL);},isProjectionReady:function h(){return true;},removeEventListeners:function u(){var AN=this.eventListenerArr,AO,AM,AL;if(!!AN){for(AM=0,AL=AN.length;AM<AL;AM++){AO=AN[AM];if(!AO){continue;}if(!!AO.remove){AO.remove();}else{dojo.disconnect(AO);}}}this.eventListenerArr=null;},getViewport:function(){return null;},getMapStyleData:function s(){var AP=[],AL=this.getMapStyles(),AO=(this.mapStyle+"").replace(/(\s+)|(\s+$)/g,""),AQ,AN,AS,AR,AM;if(!AL||!q.isArray(AL)){return ;}for(AR=0,AM=AL.length;AR<AM;AR++){AQ=AL[AR];if(!!AQ){AN=this.getStyleIdForToolbar(AQ).replace(/(\s+)|(\s+$)/g,"");AS=(AQ.id+"").replace(/(\s+)|(\s+$)/g,"");AP.push({id:AN,n:AQ.n,v:AQ.id,selected:AO===AS,type:this.typeForThumbnail});}}return AP;},getStyleIdForToolbar:function F(AL){return AL.id+"";},updateMapToolbar:function x(){var AL=this.parent;if(AL){AL.updateMapToolbar();}},getSearchSuggestions:function i(AL,AN){var AM=this.getInHouseResults(AL)||[];AN(AM);},getInHouseResults:function T(AO){var AM=this.parent,AP=[],AL,AN=function(AQ){AL.push(AQ);return AL.length>=5;};if(!AM){return ;}AM.forEachGraphicLayer(function(AR){var AQ=[];AL=[];if(!!AR){AL=AR.filterElements(AO);if(AL.length>0){q.forEach(AL,function(AS){AS.cls="elem";AQ.push(AS);});AP.push({label:AR.getLayerName(),items:AQ});}}},true);return AP;},onSuggestionItemSelected:function d(AL){if(!AL){return ;}if(AL.geo){this.navToCloudLocation(AL);}else{if(AL.v){this.navToInHouseLocation(AL);}}},navToInHouseLocation:function P(AM){var AN=this._baseMap,AO=AM.v,AL;if(!AN||!AO){return ;}AL=AO.getGeoExtent();if(AL){this.setExtent(AL);}else{if(AO.getGeoCenter instanceof Function){this.centerAndZoom(AO.getGeoCenter(),10);}}},displayError:function t(AL){var AM=this.map;if(!!AM&&AM.displayError instanceof Function){AM.displayError(AL);}},getBaseMap:function AK(){return this._baseMap;},setExtent:function(AL){this.toUpdateLayers=true;this.geoExtent=this.cloneExtent(AL);},updateXCoordsRange:function AF(){var AM=this.getGeoScreenRange(),AL=this.getWidth(),AN=this.getGraphicsOffset();if(C.checkVal(AM)&&C.checkVal(AL)){this._xCoordsMin=this.xCoordsMinForG=(AL-AM)/2;this._xCoordsMax=this.xCoordsMaxForG=this._xCoordsMin+AM;this.geoScreenRange=AM;}if(AN&&C.checkVal(AN.x)){this.xCoordsMinForG-=AN.x;this.xCoordsMaxForG-=AN.x;}},addEventListeners:function b(AM){if(!AM){return ;}var AN=this,AP=this._baseMap,AO=AN.eventListenerArr=[],AL=this.map;AO.push(AP.on(AM["extent-change"],this.handleExtentChangeEvt.bind(this)));if(AM["zoom-start"]){AO.push(AP.on(AM["zoom-start"],this.handleZoomStart.bind(this)));}AO.push(AP.on(AM["zoom-end"],function(){if(AL.needMapReadyEvent()){AN.isBaseMapReady=false;AL.graphicsReady=false;}AN.handleZoomChange();}));AO.push(AP.on(AM.load,this.handleOnLoad.bind(this)));},handleOnLoad:function AD(){var AL=this.map;if(AL&&AL.needMapReadyEvent()){this.isBaseMapReady=true;if(C.checkHasFunction(AL,"checkForMapReady")){AL.checkForMapReady();}}},processConfigInfo:e,getGeoScreenRange:function AE(){var AM=this.latLngToPixelXY({lat:0,lng:180},true),AL=this.latLngToPixelXY({lat:0,lng:-180},true);if(!!AM&&C.checkVal(AM.x)&&!!AL&&C.checkVal(AL.x)){return Math.abs(AM.x-AL.x);}},handleNoInternet:function c(){this.displayError(C.getNoInternetMessage());},getDefaultCenter:function J(){return g;},triggerEvt:e,setCenter:e,centerAndZoom:function I(AL,AM){this.setCenter(AL);this.setZoom(AM);},isSameCenter:function o(AM,AL){return AM.lat===AL.lat&&AM.lng===AL.lng;},supportBearingAndPitch:function S(){return false;},getMapZoomAndPosition:function AA(){var AM={},AL=this.supportBearingAndPitch();AM[H.mapCenter]=this.getLngLatCenter();AM[H.zoomLevel]=this.getZoom();AM.supportBearingAndPitch=AL;if(AL){AM[H.mapBearing]=this.getBearing();AM[H.mapPitch]=this.getPitch();}return AM;},setMapStyle:e,latLngToPixelXY:e,pixelXYtoLatLng:e,getLngLatCenter:e,getDefaultMapStyle:e,getMapStyles:e,getDefaultStyleIdx:e,hideMapTools:e,showMapTools:e,panBy:e,toggleBaseMapLabels:e,toggleBaseMapLabelsPos:e,isLabelGroupExist:e,isLabelGropOnTop:e,destroy:function z(AL){this._super(AL);this.eventListenerArr=null;this._baseMap=null;}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.VisTooltip","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Extent","mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.Polygon","mstrmojo.gmaps.layer.Layer");var b=mstrmojo,J=b.dom,K=b.hash,F=b.gmaps,A=F.MapUtils,E=b.VisTooltip,U=F.EnumToolbarState,e=F.geometry,V=F.LASSOLAYER_ZINDEX;var C={fillColor:"#FFF",fillOpacity:0.5,strokeColor:"#444649",strokeWidth:1,strokeOpacity:0.8,strokeDashArray:[3,3]},D="kilometers",Q=0.621371192;function P(s,t){if(s.unit==="miles"){t*=Q;}return t;}function c(x,s){var w=this.rectSelcCenter,y=this.selectionShape,v=this.getDistanceUnit(),t,u;if(!w){return ;}if(!A.checkDefined(x.lat)){this.addGeoInfo2Point(x);}if(!A.checkDefined(s.lat)){this.addGeoInfo2Point(s);}t=y.coolWPDistance(x.lat,x.lng,x.lat,s.lng);u=y.coolWPDistance(x.lat,x.lng,s.lat,x.lng);t=parseInt(P(v,t));u=parseInt(P(v,u));w.update({x:(x.x+s.x)/2,y:(x.y+s.y)/2,text:t+" x "+u+" "+v.unitStr});}mstrmojo.gmaps.layer.LassoLayer=mstrmojo.declare(mstrmojo.gmaps.layer.Layer,null,{scriptClass:"mstrmojo.gmaps.layer.LassoLayer",selectionType:null,selectionShape:null,startPoint:null,isMouseDown:false,indicatorTooltip:null,offset:null,gNode:null,init:function q(s){this._super(s);this.addEventListeners();},_initLayerDomTree:function H(){var u=this.map,s=u&&u.mapDiv,t=this.div_;if(!s){return ;}if(!t){t=this.div_=A.createSvgNode("svg");A.appendNode(s,t);}A.setLayerNodeProps(t,null,"mstrMap-lassoLayer",u.width,u.height);t.style["z-index"]=V;this.gNode=A.appendGNode(t);this._loadOffset();},_loadOffset:function I(){var s=this.getGraphicsOffset();if(s&&A.checkVal(s.x)&&A.checkVal(s.y)&&!(s.x===0&&s.y===0)){this.offset=s;A.setCssTransform(this.gNode,s);}},initIndicatorTooltip:function l(){var s=new E({placeholder:document.body.appendChild(document.createElement("div")),owner:this});s.render();s.toggle(false);s.domNode.onmouseover=function(){s.toggle(false);};this.toggleCircleSelectionIndicator(true);this.indicatorTooltip=s;},toggleCircleSelectionIndicator:function a(s){var t=this.gNode;if(!t){return ;}if(s){if(!this.circleSelcDec){this.circleSelcCenter=A.createSvgNode("circle");this.circleSelcDec=A.createSvgNode("path");this.circleSelcLine=A.createSvgNode("line");A.setNodeAttributes(this.circleSelcCenter,{r:"3px",fill:C.strokeColor});this.circleSelcDec.style.fill=C.strokeColor;this.circleSelcLine.style.stroke=C.strokeColor;this.circleSelcLine.style.strokeWidth=C.strokeWidth;t.appendChild(this.circleSelcCenter);t.appendChild(this.circleSelcDec);t.appendChild(this.circleSelcLine);}}else{if(this.circleSelcDec){t.removeChild(this.circleSelcCenter);t.removeChild(this.circleSelcDec);t.removeChild(this.circleSelcLine);delete this.circleSelcCenter;delete this.circleSelcDec;delete this.circleSelcLine;}}},addEventListeners:function R(){var s=this.getNode();if(!!s){J.attachEvent(s,"mousedown",this.handleMouseDownEvt.bind(this));J.attachEvent(s,"mouseup",this.handleMouseUpEvt.bind(this));J.attachEvent(s,"mousemove",this.handleMouseMoveEvt.bind(this));J.attachEvent(s,"mouseleave",this.handleMouseLeaveEvt.bind(this));J.attachEvent(s,"contextmenu",this.handleContextMenuEvt.bind(this));if(J.supportsTouches){J.attachEvent(s,"touchstart",this.handleMouseDownEvt.bind(this));J.attachEvent(s,"touchend",this.handleMouseUpEvt.bind(this));J.attachEvent(s,"touchmove",this.handleMouseMoveEvt.bind(this));}}},removeEventListeners:function j(){var s=this.getNode();if(!!s){J.detachEvent(s,"mousedown",this.handleMouseDownEvt);J.detachEvent(s,"mouseup",this.handleMouseUpEvt);J.detachEvent(s,"mousemove",this.handleMouseMoveEvt);J.detachEvent(s,"mouseleave",this.handleMouseLeaveEvt);J.detachEvent(s,"contextmenu",this.handleContextMenuEvt);if(J.supportsTouches){J.detachEvent(s,"touchstart",this.handleMouseDownEvt);J.detachEvent(s,"touchend",this.handleMouseUpEvt);J.detachEvent(s,"touchmove",this.handleMouseMoveEvt);}}},handleContextMenuEvt:function G(s){if(this.RMCInSelectionState){var t=this.parent,u=t&&t.toolbar;if(u){u.resetSelectionState();}J.stopPropogation(window,s);J.preventDefault(window,s);}},handleMouseDownEvt:function r(s){if(!this.div_){return ;}s=A.getEvent(s);var u=this.parent,v=u&&u.toolbar,t=v.inSelectionState();if(A.isRMClick(s)&&t){this.RMCInSelectionState=true;return ;}this.RMCInSelectionState=false;this.isMouseDown=true;this.initSelectionShape(this._posFromMapContainerToGNode(A.getEvtCoordInsideNode(s,this.getNode())));},handleMouseUpEvt:function i(){this.isMouseDown=false;if(this.indicatorTooltip){this.indicatorTooltip.toggle(false);}if(this.RMCInSelectionState){return ;}var t=this.selectionShape,s=t&&t.screenPolylineArr;if(this.selectionType===U.FREE_SELECT&&s){s[0].push(s[0][0]);}if(this.parent){this.parent.handleLassoDrawEnd(this.selectionShape);}},handleMouseLeaveEvt:function W(t){if(this.isMouseDown!==true){return ;}var s=t&&t.toElement;if(!!s&&((s.className.indexOf("vis-tooltip")!==-1)||(!!s.parentNode&&s.parentNode.className.indexOf("vis-tooltip")!==-1))){return ;}this.handleMouseUpEvt();},handleMouseMoveEvt:function X(s){if(this.isMouseDown!==true||!this.div_){return ;}s=A.getEvent(s);var t=this.indicatorTooltip;this.updateDrawing(this._posFromMapContainerToGNode(A.getEvtCoordInsideNode(s,this.getNode())));if(this.selectionType===U.CIRCLE_SELECT&&t){t.moveTo(s.x,s.y);}},initSelectionShape:function Y(u){var t=this.gNode,v=this.createSelectionShape(u),s;if(!t||!v){return ;}s=v.getNode();A.insertAsFirstChild(t,s);this.startPoint=u;this.selectionShape=v;},createSelectionShape:function h(u){var t={},s=this.selectionType,v;if(!u||!A.checkVal(u.x)||!A.checkVal(u.y)){return ;}K.copy(C,t);switch(s){case U.RECTANGLE_SELECT:v=this._createRectShape(t,u);break;case U.CIRCLE_SELECT:this.initIndicatorTooltip();v=this._createCircleShape(t,u);break;case U.FREE_SELECT:t.screenPolylineArr=[[{x:u.x,y:u.y}]];v=new e.Polygon(t);break;default:break;}return v;},_createRectShape:function m(t,v){var s=this.gNode,u=this.rectSelcCenter=new e.Text({fontSize:12,isCenterAlign:true,fillColor:"#444649",fillOpacity:1});if(s){s.appendChild(u.getNode());}t.x=v.x;t.y=v.y;return new e.Extent(t);},_createCircleShape:function O(t,u){var s=this.circleSelcCenter;A.setNodeAttributes(s,{cx:u.x,cy:u.y});u=this.addGeoInfo2Point(u);K.copy(u,t);t.radius=0;return new e.Circle(t);},addGeoInfo2Point:function S(s){if(!s||!A.checkVal(s.x)||!A.checkVal(s.y)){return s;}var t=this.getBaseLayer(),u=t&&t.pixelXYtoLatLng(this._posFromGNodeToMapContainer(s));if(u){s.lat=u.lat;s.lng=u.lng;}return s;},_posFromGNodeToMapContainer:function Z(s){var t=this.offset;if(!t||!A.checkVal(s.x)||!A.checkVal(s.y)){return s;}else{return{x:s.x+t.x,y:s.y+t.y};}},_posFromMapContainerToGNode:function M(s){var t=this.offset;if(!t||!A.checkVal(s.x)||!A.checkVal(s.y)){return s;}else{return{x:s.x-t.x,y:s.y-t.y};}},updateDrawing:function f(s){var t=this.selectionType,v=this.selectionShape,u=this.startPoint;if(!u||!s||!A.checkVal(s.x)||!A.checkVal(s.y)){return ;}switch(t){case U.RECTANGLE_SELECT:this.updateDrawingRect({x:u.x,y:u.y},s);break;case U.CIRCLE_SELECT:this.updateDrawingCircle(u,s);break;case U.FREE_SELECT:v.addScreenPoint(s);break;default:break;}},updateDrawingRect:function n(w,u){if(!w||!u){return ;}var v=u.x-w.x,t=u.y-w.y,AA=this.selectionShape,s,z;s=(v<0)?u.x:w.x;z=(t<0)?u.y:w.y;AA.update({x:s,y:z,width:Math.abs(v),height:Math.abs(t)});c.call(this,w,u);},updateDrawingCircle:function p(w,u){if(!w||!u){return ;}var t=u.x-w.x,v=u.y-w.y,s=Math.sqrt(t*t+v*v),x=this.selectionShape;if(!x||!A.checkVal(s)){return ;}x.setRadius(s);if(this.indicatorTooltip){this.updateCircleSelectionIndicator(w,u);this.indicatorTooltip.toggle(true);}},updateCircleSelectionIndicator:function g(t,s){if(this.selectionType!==U.CIRCLE_SELECT){return ;}this.updateIndicateTooltipContent(t,s);this.updateIndicateArrow(t,s);},updateIndicateTooltipContent:function N(w,t){var s=this.getNode(),u=this.indicatorTooltip,y=this.selectionShape,v=this.getDistanceUnit(),x;if(!s||!u||!y||!w||!t){return ;}t=this.addGeoInfo2Point(t);x=y.coolWPDistance(t.lat,t.lng,w.lat,w.lng);y.geoRadius=x;x=P(v,x);u.displayInfo([{n:"Radius",v:x.toFixed(2)+" "+v.unitStr},{n:"Longitude",v:t.lng.toFixed(3)},{n:"Latitude",v:t.lat.toFixed(3)}]);},getDistanceUnit:function k(){var s=this.parent,t=s&&s.parent;return t?t.getDistanceUnit():{unit:D,unitStr:"km"};},updateIndicateArrow:function d(AF,AD){if(!this.circleSelcDec||!this.circleSelcLine||!AF||!AD){return ;}var AE=this.circleSelcDec,w=this.circleSelcLine,AH=function(AM,AS,AR,AP){var AO=AM*Math.cos(AR)-AS*Math.sin(AR),AN=AM*Math.sin(AR)+AS*Math.cos(AR),AQ=Math.sqrt(AO*AO+AN*AN);if(AP&&AQ!==0){AO=AO/AQ*AP;AN=AN/AQ*AP;}return{x:AO,y:AN};},AL=AF.x,y=AF.y,AJ=AD.x,x=AD.y,AC=10,AB=4,AK=Math.atan(AB/AC),z=Math.sqrt(AB*AB+AC*AC),t=AH(AJ-AL,x-y,AK,z),s=AH(AJ-AL,x-y,-AK,z),AI=AJ-t.x,v=x-t.y,AG=AJ-s.x,u=x-s.y,AA="M "+AJ+" "+x+" L"+AI+" "+v+" L"+AG+" "+u;A.setNodeAttributes(AE,{d:AA});A.setNodeAttributes(w,{x1:AL,y1:y,x2:AJ,y2:x});},destroySelectionShape:function T(){var s=this.gNode,t=this.selectionShape;if(!s){return ;}s.innerHTML="";if(t){t.destroy();}this.selectionShape=null;},destroyIndicator:function B(){var s=this.indicatorTooltip,t=this.rectSelcCenter;A.destroyObj(s);this.toggleCircleSelectionIndicator(false);delete this.indicatorTooltip;A.destroyObj(t);delete this.rectSelcCenter;},destroy:function o(){this.destroyIndicator();this.destroySelectionShape();this.gNode=null;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.GraphicUtils","mstrmojo.gmaps.layer.mapbox._ClusterViewerWrapper","mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper","mstrmojo.gmaps.layer.AbstractGraphicLayerViewer");var i=mstrmojo,K=i.emptyFn,Q=i.all,P=i.array,AR=i.hash,AW=i.gmaps,AA=AW.EnumPropertyType,M=i.mapbox,AP=AW.MapUtils,AV=AW.GraphicUtils,F=AW.EnumDefaultShapeFormatStyle,v=M.FILTER,s={fillColor:F.FILL_COLOR,fillOpacity:0.85,strokeColor:F.BORDER_COLOR,strokeWidth:parseInt(F.BORDER_WIDTH),strokeOpacity:0.8},U=M.ID_SUFFIX,AC=AW.ZoomAnimationDelta;function S(Ax,Aw,Av){if(!Av||!Ax||!Aw){return ;}var Ay=[[Av.x,Av.y],[Av.x+Av.width,Av.y+Av.height]];return Ax.queryRenderedFeatures(Ay,{layers:Aw});}function H(Av,A6,Aw){if(!Aw||!Aw.radius||!Av||!A6){return ;}var A0=Aw.radius,A2=Aw.x,A1=Aw.y,Ax=Aw.geoRadius,A5=[A2-A0,A1-A0,A2+A0,A1+A0],Az=Av.unproject([A2,A1]),A4=turf.point([Az.lng,Az.lat]),Ay,A3="kilometers";if(Ax&&A4){Ay=turf.circle([Aw.lng,Aw.lat],Ax,1024,A3);return Ay&&Ag(Av,A6,Ay,A5,function(A7){return turf.distance(A4,A7,A3)<=Ax;});}}function Ag(Ax,Aw,A0,Az,Ay){if(!A0||!Ax||!Aw||!Az||Az.length<1){return ;}var Av=Ax.queryRenderedFeatures([[Az[0],Az[1]],[Az[2],Az[3]]],{layers:Aw});Av=P.filter(Av,function(A2){var A1;switch(r(A2)){case"Point":if(Ay){return Ay(A2);}else{return turf.inside(A2,A0);}case"Polygon":case"MultiPolygon":try{A1=turf.intersect(turf.buffer(A2,0),turf.buffer(A0,0));return !!A1.geometry;}catch(A3){console.log("Invalid selection shape.");return false;}default:return false;}});return Av;}function z(Aw,Ax){if(!Aw||!Ax){return ;}var Av,Ay=P.map(Aw.geometry.coordinates,function(Az){return P.map(Az,function(A0){if(A0){Av=Ax.unproject(A0);return[Av.lng,Av.lat];}});});return turf.polygon(Ay);}function r(Av){if(Av&&Av.geometry){return Av.geometry.type;}}function AQ(Av,Aw){if(typeof Av==="number"){Av=Av*Aw;}else{var Ax=Av.stops;Av["default"]=Aw*Av["default"];if(Ax){P.forEach(Ax,function(Ay){Ay[1]=Aw*Ay[1];});}}return Av;}mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractGraphicLayerViewer,[mstrmojo.gmaps.layer.mapbox._ClusterViewerWrapper,mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper],{scriptClass:"mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer",data:null,type:"fill",_layerIds:null,cluster:null,strokeColorSelection:"#000000",fillOpacitySelection:1,labelTextAnchor:"top",hoverOpacity:0.9,shapeFmtNames:null,init:function AG(Av){this._super(Av);this.data=this.data||this.getData(Av.graphics);delete this.graphics;this.addComponents();this.setVisibility(this.isVisible());},addComponents:function W(){this.initCluster();var Av=this.addSource();if(Av){this.addLayers();}},initCluster:function N(){var Aw;if(this.isCluster){var Av=this.cluster=supercluster({radius:this.clusterRadius,maxZoom:this.clusterMaxZoom-1});Av.load(this.data.features);Aw=this.parent&&this.parent.getBaseLayer();this.zoomLevelChangeListener=Aw&&Aw.attachEventListener("zoomLevelChanged",this.id,function(Ax){this.highlightGraphics(this.parent.selectedGraphics);});}},getLayerId:function n(){return this.key;},getSourceId:function T(){return this.getLayerId()+U.Source;},getLayerCtrlProps:function AY(A1,Ay,A0,Ax,Az,Av){var Aw={id:A1,type:Ay,source:A0};if(Ax){Aw.filter=Ax;}if(Az){Aw["source-layer"]=Az;}if(!Av){Av=this.getLayerZoomRange();}Aw.minzoom=Av.minzoom;Aw.maxzoom=Av.maxzoom;return Aw;},getDataLabelSourceLayer:K,getLabelTextOffset:function Ah(){return{type:"identity",property:"labelOffset"};},addSource:function Z(){var Aw=this.getMapInstance(),Av=this.getSourceId();if(Aw){if(Aw.getSource(Av)){Aw.removeSource(Av);}Aw.addSource(Av,AR.copy(this.getExtraSourceProps(),{type:"geojson",data:this.data,cluster:this.isCluster,clusterMaxZoom:this.clusterMaxZoom-1,clusterRadius:this.clusterRadius}));return true;}else{return false;}},addLayers:function AU(){var Ax=this.getMapInstance(),Ay=this.getLayerId(),Av=this.type,Aw=this.getSourceId();if(!Ax){return ;}this._layerIds=[Ay,Ay+U.Unselected,Ay+U.Selection,Ay+U.ContextMenu,Ay+U.Hover];Ax.addLayer(AR.copy(this.getLayerOptions(),this.getLayerCtrlProps(Ay,Av,Aw,this.getBaseFilters())));Ax.addLayer(AR.copy(this.getLayerOptionsUnselected(),this.getLayerCtrlProps(Ay+U.Unselected,Av,Aw,v.NOFEATURE)));Ax.addLayer(AR.copy(this.getLayerOptionsSelection(),this.getLayerCtrlProps(Ay+U.Selection,Av,Aw,v.NOFEATURE)));Ax.addLayer(AR.copy(this.getLayerOptionsContextMenu(),this.getLayerCtrlProps(Ay+U.ContextMenu,Av,Aw,v.NOFEATURE)));Ax.addLayer(AR.copy(this.getLayerOptionsHover(),this.getLayerCtrlProps(Ay+U.Hover,Av,Aw,v.NOFEATURE)));if(this.isCluster){this.addClusterLayers(Ax,Aw);}this.addDataLabelLayer(Ax);},getQueryLayers:function t(){var Aw=this.getLayerId(),Av=[];if(Aw){Av=[Aw+U.Hover,Aw+U.Selection,Aw+U.Unselected,Aw+U.ContextMenu,Aw];if(this.isCluster){Av.push(Aw+U.Cluster);}}return this.validLayers(Av);},setVisibility:function AK(Av){var Aw=this.getMapInstance();if(Aw){P.forEach(this.validLayers(this._layerIds),function(Ax){Aw.setLayoutProperty(Ax,"visibility",Av?"visible":"none");});}},setLayerZIndex:function Ai(A0,Az){var Ay=this.getMapInstance(),Aw=this._layerIds,Av=Ay&&Ay.getStyle(),Ax=Av&&Av.layers;if(!Ay||!P.isArray(Aw)){return ;}if(Az&&P.find(Ax,"id",Az)<0){return ;}P.forEach(this.validLayers(Aw),function(A1){Ay.moveLayer(A1,Az);});},hide:function AJ(){var Av=this.getMapInstance();if(Av){P.forEach(this._layerIds,function(Aw){Av.setLayoutProperty(Aw,"visibility","none");});}},getBaseFilters:function Ao(){return v.SINGLE;},getFilters4MainLayer:function A(Ax,Av){var Aw=this.getBaseFilters();if(Ax){return Aw;}else{return["all",Aw,["!in","id"].concat(Av)];}},getHoverLayerFromFeature:function AB(Av){return Av.layer.id;},handleHover:function AM(Aw,A0){var Az=this.getMapInstance(),Ay=this.getPrimaryShapeLayers();if(!Az||!Ay){return ;}if(Aw){if(this.isClusterFeature(Aw)){this.handleClusterHover(Aw);}else{this.handleFeatureHover(Az,this.getHoverLayerFromFeature(Aw),Aw);}var Av=this.parent&&this.parent.map,Ax=Av&&Av.getPropertyValue(AA.tooltipSwitch);if(Ax!=="false"){this.showTooltip(Aw,A0);}}else{P.forEach(Ay,function(A1){this.handleFeatureHover(Az,A1);},this);if(this.isCluster){this.handleClusterHover();}}},handleFeatureHover:function E(Ax,Av,Aw){Av=this.getLayerId();if(Ax&&Av){if(Aw){Ax.setFilter(Av+U.Hover,["==","id",Aw.properties.id]);}else{Ax.setFilter(Av+U.Hover,v.NOFEATURE);}}},handleColorByOpacityChange:function Ab(Av){this.data.opacityStops=Av;this.setShapeFillOpacity(this.getFillOpacity());},handleColorByColorChange:function Af(Ay,Av,Ax,Aw){this.data.colorStops=Ay;this.data.seleColorStops=Av;this.data.hoverColorStops=Ax;this.data.unSelectedColorStops=Aw;this.setShapeFillColor();},handleContextMenu:function Aj(Aw){var Az=this.getMapInstance(),Ay=this.getFeatureIDsFromGraphics(Aw),Av=this.getLayerId(),Ax=this.isCluster;if(!Az||!Az.getLayer(Av)){return ;}if(Ax){this.handleClusterContextMenu(Ay);}if(!Ay||Ay.length<1){Az.setFilter(Av,this.getFilters4MainLayer(true));Az.setFilter(Av+U.ContextMenu,["==","id",""]);}},handleSelections:function Ae(Ax){var Ay=this.getMapInstance(),Av=this.getLayerId(),Aw=this.isCluster;if(!Ay||!Ay.getLayer(Av)){return ;}if(Aw){this.handleClusterSelection(Ax);}if(!Ax||Ax.length<1){Ay.setFilter(Av,this.getFilters4MainLayer(true));Ay.setFilter(Av+U.Selection,v.NOFEATURE);Ay.setFilter(Av+U.ContextMenu,v.NOFEATURE);Ay.setFilter(Av+U.Unselected,v.NOFEATURE);}},handleHighlight:function AE(Ax,A0){var Az=this.getFeatureIDsFromGraphics(Ax),Av=this.getFeatureIDsFromGraphics(A0);var A1=this.getMapInstance(),Aw=this.getLayerId(),Ay=this.isCluster;if(!A1||!A1.getLayer(Aw)){return ;}if(Ay){this.handleClusterSelection(Az);this.handleClusterContextMenu(Av);}A1.setFilter(Aw,v.NOFEATURE);A1.setFilter(Aw+U.Selection,["in","id"].concat(Az));A1.setFilter(Aw+U.ContextMenu,["in","id"].concat(Av));A1.setFilter(Aw+U.Unselected,this.getFilters4MainLayer(false,Az.concat(Av)));},contain:function b(Aw){var Av=Aw&&Aw.layer.id,Ax=this.getQueryLayers();return Ax&&Av&&Ax.indexOf(Av)!==-1;},showTooltip:function Al(Av,Ay){var Ax=this.getMapInstance(),Aw=this.parent;if(Ax&&Aw&&Av&&Ay){Aw.showTooltip(this.getGraphicsFromFeature(Av),{x:Ay.clientX,y:Ay.clientY});}},getData:function Aq(Ax){var Az=this,Aw=[],Av=[],A0=[],Ay=[],A1=[],A2;P.forEach(Ax,function(A5){var A3=A5.attributes,A4=Az.extractShapeProps(A3);A2=A5.id;if(A2&&A4.fillColor){Aw.push([A2,A4.fillColor]);Av.push([A2,A4.fillOpacity]);A0.push([A2,AP.fillColorAjustForCMSelection(A4.fillColor)]);Ay.push([A2,AP.fillColorAjustForHover(A4.fillColor)]);A1.push([A2,A4.fillColor]);}});return{type:"FeatureCollection",colorStops:Aw,opacityStops:Av,seleColorStops:A0,hoverColorStops:Ay,unSelectedColorStops:A1,features:P.map(Ax,function(A3){var A4=A3&&A3.geoData;if(A4){return{type:"Feature",geometry:{type:A3.type,coordinates:[A4.lng,A4.lat]},properties:AR.copy(Az.extractShapeProps(A3.attributes),{id:A3.id})};}})};},getExtraSourceProps:K,extractShapeProps:function X(Ax){if(!Ax){return ;}var Ay=Ax.threshold,Aw=Ax.color,Av=s.fillColor,A3=this.getFontSize(),A0=this.getLabelOffset(Ax),A1=Ax.values,A2,Az=s.fillOpacity;if(Ay){Av=Ay.colorStr||Av;A2=this.getIconInStudio(Ay.url);}else{if(Aw){Av=Aw.value;Az=Aw.opacity;}}if(A0&&A3){A0=P.map(A0,function(A4){return A4/A3;});}return{fillColor:Av,fillColorCMSelection:AP.fillColorAjustForCMSelection(Av),imgUrl:A2,labelText:Ax.dataLabelText,labelValues:(A1&&A1.length>0)?A1.join(", "):"",labelOffset:A0,fillOpacity:Az};},getIconInStudio:function j(Ax){if(!Ax){return ;}var Av=Ax.split("/"),Aw;if(Av.length>0){Aw=Av[Av.length-1];return Aw&&Aw.split(".")[0];}},getGraphicIDsFromFeatureIDs:function f(Av){var Aw=[];P.forEach(Av,function(Ax){P.forEach(this.desolveFeature(Ax),function(Ay){Aw.push(Ay.properties.id);});},this);return Aw;},getGraphicsFromFeature:function AL(Aw){var Ax=this.desolveFeature(Aw),Av=this.getGraphicIDsFromFeatureIDs(Ax);return P.map(Av,function(Ay){if(Ay){return Q[Ay];}});},getGraphicsFromFeatures:function Aa(Aw){var Av=this.getGraphicIDsFromFeatureIDs(Aw);return P.map(Av,function(Ax){if(Ax){return Q[Ax];}});},getFeatureIDsFromGraphics:function AD(Av){return P.map(Av,function(Aw){return Aw.id;});},isLayerZoomRangeAnimationEnable:function AO(){var Ax=this.minzoom,A0=this.maxzoom,Aw=this.parent.getBaseLayer(),Az=Aw.minZoom,Ay=Aw.maxZoom,A1=Ax>Az,A2=A0<Ay,Av=(A2||A1)&&((A0-Ax)>AC*2);return{enableAnimation:Av,enableMaxZoomAnimation:A2,enableMinZoomAnimation:A1};},getLayerPropVal:function R(Aw,Az,Ax,Av){var Ay=[];if(!Ax||Ax.length===0){return Az;}P.forEach(Ax,function(A0){Ay.push([A0,Av]);});return{property:Aw,type:"categorical","default":Az,stops:Ay};},getFillOpacityForZoomAnimation:function e(A0){var Ay,Ax=this.minzoom,Az=this.maxzoom,Aw=this.isLayerZoomRangeAnimationEnable(),A1=Aw.enableMinZoomAnimation,A2=Aw.enableMaxZoomAnimation,Av=Aw.enableAnimation;if(Av){Ay={stops:[]};Ay["default"]=A0;if(A1){Ay.stops.push([Ax,0]);Ay.stops.push([Ax+AC,A0]);}if(A2){Ay.stops.push([Az-(this.hasConnectingLayer?2:1)*AC,A0]);Ay.stops.push([Az,0]);}}else{Ay=A0;}return Ay;},getFillOpacityNormal:function AN(Ax){var Av=this.getFmts(),Ay=Av.fillOpacity,Aw;Aw=this.getLayerPropVal("id",Ay,Ax,Ay*F.FILL_OPACITY_FACTOR_HOVER);return this.getFillOpacityForZoomAnimation(Aw);},getFillOpacity:function o(Aw){var Av;if(this.hasColorByAttr()){Av=this.getFillOpacityInColorByAttr(Aw);}else{Av=this.getFillOpacityNormal(Aw);}return Av;},getFillOpacityInColorByAttr:function AZ(A2){var A7=this.getFmts(),BB=A7.fillOpacity,A1=[],A9=this.data.opacityStops,A4,Ax,A5=null,A0=this.minzoom,A3=this.maxzoom,Ay=[],BC=[],Aw=[],A6=[],BA=this.isLayerZoomRangeAnimationEnable(),A8=BA.enableMinZoomAnimation,Av=BA.enableMaxZoomAnimation,Az=BA.enableAnimation;if(A2&&A2.length>=1){A5=A2[0];}if(!A9){return BB;}P.forEach(A9,function(BD){Ax=BD[0];A4=BD[1];if(A5===Ax){A4*=F.FILL_OPACITY_FACTOR_HOVER;}if(Az){if(A8){Ay.push([{zoom:A0,value:Ax},0]);BC.push([{zoom:A0+AC,value:Ax},A4]);}if(Av){Aw.push([{zoom:A3-(this.hasConnectingLayer?2:1)*AC,value:Ax},A4]);A6.push([{zoom:A3,value:Ax},0]);}}else{A1.push([Ax,A4]);}});if(Az){A1=Ay.concat(BC,Aw,A6);}return{property:"id",type:"categorical","default":BB,stops:A1};},getFillColorPropVal:function Am(Ax,Av){var Aw=Av;if(!this.hasColorBy()||!Av||Av.length===0){Aw=[["",Ax]];}return{property:"id",type:"categorical","default":Ax,stops:Aw};},getFillColor:function u(){var Av=this.getFmts(),Aw=(Av&&Av.fillColor)||s.fillColor;return this.getFillColorPropVal(Aw,this.data.colorStops);},getFillColorHover:function d(){var Av=this.getFmts(),Aw=AP.fillColorAjustForHover((Av&&Av.fillColor)||s.fillColor);return this.getFillColorPropVal(Aw,this.data.hoverColorStops);},getFillColorCMSelection:function C(){var Av=this.getFmts(),Aw=AP.fillColorAjustForCMSelection((Av&&Av.fillColor)||s.fillColor);return this.getFillColorPropVal(Aw,this.data.seleColorStops);},getFillColorUnselected:function V(){var Av=this.getFmts(),Aw=(Av&&Av.fillColor)||s.fillColor;return this.getFillColorPropVal(Aw,this.data.unSelectedColorStops);},getFmts:function w(){return AR.copy(this._super(),AR.clone(s));},validLayers:function G(Av){var Aw=this.getMapInstance();return Aw?P.filter(Av,function(Ax){return !!Aw.getLayer(Ax);}):[];},getPrimaryShapeLayers:function c(){var Av=this.getLayerId();return this.validLayers([Av,Av+U.Hover,Av+U.ContextMenu,Av+U.Selection,Av+U.Unselected]);},getStrokeClrFmtLayers:function g(){var Av=this.getLayerId();return[Av];},setPaintProperty:function Ap(Aw,Av){var Ay=this.getPrimaryShapeLayers(),Ax=this.getMapInstance();if(Ax&&Aw){P.forEach(Ay,function(Az){Ax.setPaintProperty(Az,Aw,Av);});}},setShapeFillColor:function a(){var A0=this.getMapInstance(),Aw=this.getLayerId(),Ax=this.shapeFmtNames,Az=Ax&&Ax.fillColor,Ay=Ax&&Ax.strokeColor,Av=this.getFillColor();if(A0&&Az){P.forEach([Aw,Aw+U.Selection],function(A1){A0.setPaintProperty(A1,Az,Av);});A0.setPaintProperty(Aw+U.ContextMenu,Az,this.getFillColorCMSelection());A0.setPaintProperty(Aw+U.Hover,Az,this.getFillColorHover());A0.setPaintProperty(Aw+U.Unselected,Az,this.getFillColorUnselected());this.setCMBorderColor(A0,Aw,Ay,Av);}},setCMBorderColor:function At(Ay,Aw,Ax,Av){Ay.setPaintProperty(Aw+U.ContextMenu,Ax,Av);},setShapeFillOpacity:function l(Ax){var A0=this.getMapInstance(),Av=this.getLayerId(),Aw=this.shapeFmtNames,Ay=Aw&&Aw.fillOpacity,Az;if(typeof Ax==="number"){Az=this.getFillOpacityForZoomAnimation(F.FILL_OPACITY_FACTOR_UNSEL*Ax);Ax=this.getFillOpacityForZoomAnimation(Ax);}else{Az=AR.clone(Ax);Az=AQ(Az,F.FILL_OPACITY_FACTOR_UNSEL);}if(A0&&Ax&&Ay){A0.setPaintProperty(Av,Ay,Ax);A0.setPaintProperty(Av+U.Unselected,Ay,Az);}},setShapeStrokeColor:function x(){var Az=this.getMapInstance(),Aw=this.shapeFmtNames,Ay=Aw&&Aw.strokeColor,Av=this.getFmts(),Ax=(Av&&Av.strokeColor)||s.strokeColor;if(Az&&Ax&&Ay){P.forEach(this.getStrokeClrFmtLayers(),function(A0){Az.setPaintProperty(A0,Ay,Ax);});}},setShapeStrokeStyle:function AT(Aw){var Av=this.shapeFmtNames,A1=Aw&&Aw.shapeBorderWidth,A0=this.getLayerId(),Az=this.getPrimaryShapeLayers(),Ay=this.getMapInstance(),Ax=Av&&Av.strokeWidth;if(Ay&&Ax){P.forEach(Az,function(A2){if(A2===A0+U.Selection&&A1===0){Ay.setPaintProperty(A2,Ax,1);}else{Ay.setPaintProperty(A2,Ax,A1);}});}},setClusterMode:function y(Av,Aw){this.changeClusterProps({clusterMode:Av,isCluster:Aw});},changeClusterProps:function p(Av){var Aw=this.getMapInstance();AR.copy(Av,this);if(Aw){this.removeComponents();this.addComponents();}},changeLayerZoomRange:function AH(Av){var Aw=this.getMapInstance();this.minzoom=Av.minzoom;this.maxzoom=Av.maxzoom;if(Aw){P.forEach(this.validLayers(this._layerIds),function(Ax){Aw.setLayerZoomRange(Ax,Av.minzoom,Av.maxzoom);});}},getLayerZoomRange:function AF(){return{minzoom:this.minzoom,maxzoom:this.maxzoom};},getLayerOptions:function B(){return{layout:this.getLayout()||{},paint:this.getPaint()||{}};},getLayerOptionsContextMenu:function As(){return{layout:this.getLayoutContextMenu()||{},paint:this.getPaintContextMenu()||{}};},getLayerOptionsSelection:function AX(){return{layout:this.getLayoutSelection()||{},paint:this.getPaintSelection()||{}};},getLayerOptionsHover:function J(){return{layout:this.getLayoutHover()||{},paint:this.getPaintHover()||{}};},getLayerOptionsUnselected:function Y(){return{layout:this.getLayout()||{},paint:this.getPaintUnselected()||{}};},getPaint:function Ad(){var Av=this.getFmts(),Aw=this.shapeFmtNames,Ax={};if(Aw){if(Aw.fillColor){Ax[Aw.fillColor]=this.getFillColor();}if(Aw.fillOpacity){Ax[Aw.fillOpacity]=this.getFillOpacity();}if(Aw.strokeColor){Ax[Aw.strokeColor]=Av.strokeColor;}if(Aw.strokeWidth){Ax[Aw.strokeWidth]=Av.strokeWidth;}}return Ax;},getPaintHover:function m(){var Aw=this.getPaint(),Av=this.shapeFmtNames;if(Av){if(Av.fillColor){Aw[Av.fillColor]=this.getFillColorHover();}if(Av.fillOpacity){Aw[Av.fillOpacity]=this.hoverOpacity;}if(Av.strokeWidth){Aw[Av.strokeWidth]=0;}}return Aw;},getPaintContextMenu:function AI(){var Aw=this.getPaint(),Av=this.shapeFmtNames;if(Aw&&Av){if(Av.fillColor){Aw[Av.fillColor]=this.getFillColorCMSelection();}if(Av.fillOpacity){Aw[Av.fillOpacity]=this.fillOpacitySelection;}if(Av.strokeColor){Aw[Av.strokeColor]=this.getFillColor();}return Aw;}},getPaintSelection:function O(){var Ax=this.getPaint(),Av=this.getFmts(),Aw=this.shapeFmtNames;if(Ax&&Aw){if(Aw.fillOpacity){Ax[Aw.fillOpacity]=this.getFillOpacityForZoomAnimation(this.fillOpacitySelection);}if(Aw.strokeColor){Ax[Aw.strokeColor]=this.strokeColorSelection;}if(Aw.strokeWidth){if(Av.strokeWidth>0){Ax[Aw.strokeWidth]=Av.strokeWidth*2;}else{Ax[Aw.strokeWidth]=2;}}return Ax;}},getPaintUnselected:function Ak(){var Aw=this.getPaint();shapeFmtNames=this.shapeFmtNames;if(Aw&&shapeFmtNames&&shapeFmtNames.fillOpacity){var Av=this.getFillOpacity();Av=AQ(Av,F.FILL_OPACITY_FACTOR_UNSEL);Aw[shapeFmtNames.fillOpacity]=Av;}return Aw;},getLayout:K,getLayoutContextMenu:function An(){return this.getLayout();},getLayoutSelection:function q(){return this.getLayout();},getLayoutHover:function Ar(){return this.getLayout();},getGraphicsContained:function I(A0,Ay){var Az=this.getMapInstance(),Ax=[this.getLayerId()],Aw=[],Av;if(this.isCluster){Ax.push(this.getClusterLayerId());}if(Ay){Ax.push(this.getLayerId()+U.Unselected);}switch(A0.scriptClass){case"mstrmojo.gmaps.geometry.Extent":Aw=S(Az,Ax,A0);break;case"mstrmojo.gmaps.geometry.Circle":Aw=H(Az,Ax,A0);break;case"mstrmojo.gmaps.geometry.Polygon":Av=turf.feature({type:"Polygon",coordinates:AV.unifyPolygonJSON(A0.screenPolylineArr)});Aw=Ag(Az,Ax,z(Av,Az),turf.bbox(Av));break;default:break;}return this.getGraphicsFromFeatures(Aw);},highlightGraphics:function Ac(Av){var Aw=P.map(Av,function(Ax){if(Ax){return Ax.id;}});this.handleSelections(Aw);},clearHighlights:function h(Av){this._super(Av);this.handleSelections();},removeLayers:function k(){var Aw=this.getMapInstance(),Av=this._layerIds;if(Aw){P.forEach(this.validLayers(Av),function(Ax){Aw.removeLayer(Ax);});}},removeSource:function AS(){var Ax=this.getMapInstance(),Aw=this.getLayerId()+U.Source,Av;if(Ax&&Ax.getSource(Aw)){Ax.removeSource(Aw);}delete this.cluster;if(this.zoomLevelChangeListener){Av=this.parent&&this.parent.getBaseLayer();Av&&Av.detachEventListener(this.zoomLevelChangeListener);delete this.zoomLevelChangeListener;}},removeComponents:function Au(){this.removeLayers();this.removeSource();},destroy:function D(){this.removeComponents();delete this.data;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.GraphicUtils");var d=mstrmojo,V=d.hash,Q=d.array,I=d.gmaps,U=I.EnumGeometryType,P=I.MapUtils,Y=I.GraphicUtils;mstrmojo.gmaps.graphic.Graphic=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gmaps.graphic.Graphic",type:null,parent:null,geoData:null,screenData:null,geometry:null,attributes:null,init:function X(h){this._super(h);if(!!this.geometry){this.setGeometry(this.geometry);}},setGeometry:function O(h){if(!h){console.log("setGeometry(): invalid geometry");return ;}if(this.geometry!==h){this.destroyGeometry();}this.geometry=h;this._addGraphicIDToNode();},_addGraphicIDToNode:function b(){var h=this.geometry&&this.geometry.node;if(h){h.graphicID=this.id;}},getGeometryArr:function T(){var h=this.geometry;if(this.parent instanceof I.layer.DensityLayer&&!h){h=V.copy(this.screenData,{type:U.Point});}return(!!h)?[h]:[];},getPositionInfo:function E(){return this.screenData;},updatePosition:function A(h){var i=this.geometry;this.screenData=h;if(!!i&&i.update instanceof Function){i.update(h);}},setHover:function J(h){var i=this.geometry;if(i&&(i.setHover instanceof Function)){i.setHover(h);}},setSelection:function G(h){var i=this.geometry;if(i&&(i.setSelection instanceof Function)){i.setSelection(h);}this.setIsSelected(h);},setContextMenuSelection:function c(h,i){var j=this.geometry;if(P.checkHasFunction(j,"setContextMenuSelection")){j.setContextMenuSelection(h,i);}},setIsSelected:function Z(h){this._isSelected=!!h;},isSelected:function N(){return this._isSelected;},getDataRowIdx:function R(){var h=this.attributes&&this.attributes.rowIndices;if(!!Q.isArray(h)){return h[0];}},getDataRowIndices:function D(){var h=this.attributes&&this.attributes.rowIndices;if(!Q.isArray(h)){console.log("getDataRowIndices@Graphic: Graphic with no attributes or rowIndex");return[];}return h;},getLayerKey:function B(){if(this.parent){return this.parent.key;}},getGeoName:function C(){var h=this.attributes;return h&&(h.originGeoName||h.geoName);},matchLocationName:function H(i){if(!i){return[];}var j=this.getGeoName(),h=new RegExp(i,"i");return(!!j&&h.test(j))?[this]:[];},getGraphicsForSelection:function M(){return[this];},getGraphicSize:function W(){var h=this.geometry;return(h&&h.getGeometrySize instanceof Function&&h.getGeometrySize())||0;},isClusterGraphic:function F(){return false;},getGeoExtent:function f(h){if(this.type===U.Polygon&&!this.geoExtent){this.geoExtent=Y.calGeoExtent(h,this.geoData);}return this.geoExtent;},getGeoCenter:function K(){var h=this.geoData;if(h&&!Q.isArray(h)){return{lat:h.lat,lng:h.lng};}},intersect:function a(h){var m=this.getGeometryArr(),k=false,l,j;if(!Q.isArray(m)||!h||!(h.intersect instanceof Function)){return k;}for(l=0,j=m.length;l<j;l++){if(m[l]){k=h.intersect(m[l],this.geoData);if(k===true){break;}}}return k;},getGraphicLayer:function S(){var h=this.parentGraphic||this;return h.parent;},moveGraphicToTop:mstrmojo.emptyFn,moveGraphicToBottom:mstrmojo.emptyFn,destroyGeometry:function g(){var h=this.geometry;if(P.checkHasFunction(h,"destroy")){h.destroy();}this.geometry=null;},destroy:function e(){this.parent=null;this.parentGraphic=null;this.destroyGeometry();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisUtility","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Text");var e=mstrmojo,R=e.array,C=e.VisUtility,H=e.gmaps,Q=H.MapUtils,T=H.EnumDataLabelShowOption,E=H.MarkerAlignOption,X=H.geometry.Text,K=2,V=10,d=4,B=["bottom","top","left","right"];function I(l,k,i,g,j,h,m){return l>h||k>m||(l+i<j)||(k+g<0);}function D(l,k,i,g,j,h,m){return l>=j&&(l+i<=h)&&k>=0&&(k+g<=m);}function G(k,j,i,h){var g={};g.rowStart=Math.floor(j/V);g.colStart=Math.floor(k/V);g.rowEnd=Math.floor((j+h)/V);g.colEnd=Math.floor((k+i)/V);return g;}function a(m,k){var o;if(k.x<m.x){o=k;k=m;m=o;}var p=m.x,i=p+m.w,l=m.y,h=l+m.h,n=k.x,j=k.y,g=j+k.h;return n<=i&&j<=h&&g>=l;}function N(p,o){var k,j,l,g={width:0},m=(p&&p.length)||0,h=[];for(k=0;k<m;k++){j=p[k];if(j){l=C.measureTextWidth(j,o&&o.dlFontStyle);if(g.width<l){g.width=l;}h.push({label:j,width:l});}}g.height=h.length*(o&&o.dlFontHeight);return{labels:h,size:g};}mstrmojo.gmaps.layer.svg._DataLabelViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.svg._DataLabelViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.svg._DataLabelViewerWrapper",dataLabelsHostNode:null,dataLabelsGraphics:[],updateDataLabelLayer:function Y(){var l,g,h,r,m=this.isMarkerMapType?B:["center"],s=m.length,j=this.execMethodOfParent("getLabelConfig"),q=j&&j.dlFontStyle,o;if(!this.needLabel()){this.removeDataLabelLayer();return ;}this.setGlobalOption();o=this.createLabelsConfig();this.createDataLabelLayer();try{this.updateScreenPoint(o);}catch(p){this.removeDataLabelLayer();return ;}if(this.isMarkerMapType){this._addMarkerRectange(o,j);}for(l=0,g=o&&o.length;l<g;l++){if(!o[l].disableLabel){for(h=0;h<s;h++){r=this._getLabelsRectConfig(o[l],m[h],j);if(this._canBeShown(r,j)){this._drawDataLabels(r.labels,q);break;}}}}},setGlobalOption:function S(){this.cellMatrix={};this.rectPool={};},createLabelsConfig:function M(){if(!this.execMethodOfParent("supportDataLabel")){return ;}var m,g,l,p,j,r,k=[],q=this.graphics,h=(q&&q.length)||0,o=this.isMarkerMapType;for(m=0;m<h;m++){g=q[m];l=g.attributes;r=g.geoData;p=g.geometry;j={rowIndex:g.getDataRowIdx(),mapPoint:o?{lat:r.lat,lng:r.lng}:{lat:g.lat,lng:g.lng}};if(o){j.graphicSize=g.getGraphicSize();j.alignOption=p.getGeometryAlignOption();}if(g.isClusterGraphic()){j.disableLabel=true;}else{j.text=l.dataLabelText;}if(l.values){j.values=l.values;}k.push(j);}return k;},_addMarkerRectange:function Z(t,s){var AB,AF,h,AA,l,u,y,v,p,AE,AG,z,AC,r,m,q,o,k=this.cellMatrix,AD=this.rectPool,g=s&&s.showAllDataLabel,x=(t&&t.length)||0,w=this.getVisMap(),j=this.execMethodOfParent("getBaseLayer");if(!w||!j){return ;}z=w.getWidth();AC=w.getHeight();AE=j.xCoordsMinForG||0;AG=j.xCoordsMaxForG||z;for(AB=0;AB<x;AB++){AF=t[AB];q="marker#"+AF.rowIndex;h=AF.graphicSize;y=h.width;v=h.height;AA=AF.screenPoint;l=AA.x-y/2;u=AA.y-v/2;switch(AF.alignOption){case E.TOP:u=AA.y;break;case E.TOP_LEFT:l=AA.x;u=AA.y;break;case E.TOP_RIGHT:l=AA.x-y;u=AA.y;break;case E.LEFT:l=AA.x;break;case E.RIGHT:l=AA.x-y;break;case E.BOTTOM:u=AA.y-v;break;case E.BOTTOM_LEFT:l=AA.x;u=AA.y-v;break;case E.BOTTOM_RIGHT:l=AA.x-y;u=AA.y-v;break;}o={x:l,y:u,w:y,h:v};AF.markerRect=o;if(g||I(l,u,y,v,AE,AG,AC)){continue;}AD[q]=o;p=G(l,u,y,v);for(r=p.rowStart;r<=p.rowEnd;r++){for(m=p.colStart;m<=p.colEnd;m++){if(!k[r]){k[r]={};}if(!k[r][m]){k[r][m]={};}k[r][m][q]=true;}}}},_drawDataLabels:function J(j,n){var h,q,p,i=this.dataLabelsHostNode,l=this.dataLabelsGraphics,o=n||{},g=j.length;for(h=0;h<g;h++){q=j[h];o.text=q.label;p=new X(o);p.update(q.point);i.appendChild(p.node);l.push(p);}},_canBeShown:function b(AB,q){if(!AB||!q){return false;}var n,o,m,g,i,z,s,r,AA,AC,x,u,AG,AI,p,AF,AH,y,AD,k=this.cellMatrix,AE=this.rectPool,v=this.getVisMap(),j=this.execMethodOfParent("getBaseLayer");if(!v||!j){return ;}p=AB.index;i=AB.rect;z=i.x;s=i.y;r=i.w;AA=i.h;AC=z-K;x=s-K;u=r+K*2;AG=AA+K*2;y=v.getWidth();AD=v.getHeight();AF=j.xCoordsMinForG||0;AH=j.xCoordsMaxForG||y;if(!D(AC,x,u,AG,AF,AH,AD)){return false;}if(q.showAllDataLabel){return true;}n=G(AC,x,u,AG);for(o=n.rowStart;o<=n.rowEnd;o++){for(m=n.colStart;m<=n.colEnd;m++){if(k[o]&&k[o][m]){g=k[o][m];for(AI in g){if(g.hasOwnProperty(AI)&&a({x:AC,y:x,w:u,h:AG},AE[AI])){return false;}}}}}AE[p]=i;for(o=n.rowStart;o<=n.rowEnd;o++){for(m=n.colStart;m<=n.colEnd;m++){if(!k[o]){k[o]={};}if(!k[o][m]){k[o][m]={};}k[o][m][p]=true;}}return true;},_getLabelsRectConfig:function U(h,g,j){var i;switch(j&&j.dlShowOption){case T.SHOW_TEXT:i=[h.text];break;case T.SHOW_VALUE:i=h.values||[];break;case T.SHOW_BOTH:i=[h.text].concat(h.values||[]);break;}return this._addLabelRect(h,i,g,j);},_addLabelRect:function F(AE,g,AF,p){var z,x,AB,l,s,o,v,u,m,j,AA,t=p&&p.dlFontHeight,AG=this.isMarkerMapType,y=AE.screenPoint,r=N(g,p),h=r.size.width,q=r.size.height,k=h/2,AD=q/2,AC=r.labels,w=AC.length;if(w===0){return null;}AA={labels:[],index:"label#"+AE.rowIndex};l=y.x-k;s=y.y-AD;if(AG){o=AE.markerRect;m=o.w/2;j=o.h/2;v=o.x+m;u=o.y+j;l=v-k;s=u-AD;switch(AF){case"left":l=v-m-h-d;break;case"top":s=u-j-q-d;break;case"right":l=v+m+d;break;case"bottom":s=u+j+d;break;}}AA.rect={x:l,y:s,w:h,h:q};x=l+k;for(z=0;z<w;z++){AB=s+(z+0.5)*t;AA.labels.push({label:AC[z].label,point:{x:x,y:AB}});}return AA;},createDataLabelLayer:function P(){this.removeDataLabelLayer();this.dataLabelsHostNode=Q.appendGNode(this.gNode);this.dataLabelsGraphics=[];},removeDataLabelLayer:function f(){var h,g=this.dataLabelsGraphics,j=this.dataLabelsHostNode,k=(g&&g.length)||0;for(h=0;h<k;h++){g[h].destroy();}this.dataLabelsGraphics=[];if(j&&j.parentNode){j.parentNode.removeChild(j);this.dataLabelsHostNode=null;}},isDataLabelShown:function O(){return this.dataLabelsHostNode&&this.dataLabelsHostNode.style.display!=="none";},showDataLabelLayer:function A(){if(this.dataLabelsHostNode){this.dataLabelsHostNode.style.display="block";}},hideDataLabelLayer:function W(){if(this.dataLabelsHostNode){this.dataLabelsHostNode.style.display="none";}},updateScreenPoint:function c(h){var i,g=this.execMethodOfParent("getBaseLayer");if(!g){return ;}R.forEach(h,function(j){if(j){i=g.getScreenPointInfo(j.mapPoint);if(!i){throw new Error("Projection didn't prepared!");}j.screenPoint=i;}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.SVGImage");var D=mstrmojo.gmaps,G=D.MapUtils,E=D.MarkerAlignOption;mstrmojo.gmaps.geometry.ClusterImage=mstrmojo.declare(mstrmojo.gmaps.geometry.SVGImage,null,{scriptClass:"mstrmojo.gmaps.geometry.ClusterImage",setPosition:function I(J){this._super(J);if(G.checkVal(this.x)&&G.checkVal(this.y)&&G.checkVal(this.actualWidth)&&G.checkVal(this.actualHeight)){G.setNodeAttributes(this.node,{x:this.x-this.actualWidth/2,y:this.y-this.actualHeight/2});}},_setHighlight:function F(J){if(G.checkVal(this.width)&&G.checkVal(this.height)){if(J){this.setDimension(this.width*1.2,this.height*1.2);}else{this.setDimension(this.width,this.height);}}this.setPosition({x:this.x,y:this.y});},getGeometryAlignOption:function C(){return E.CENTER;},setSelection:function H(J){var K=J===true?this.imgUrlA:this.imgUrl;this.setImageUrl(K);},setHover:function A(J){if(!this.disableHover){this._setHighlight(J);}},setContextMenuSelection:function B(J,K){var M;if(K){M=J===true?this.imgUrlC:this.imgUrlB;this.setImageUrl(M);}else{this.setSelection(J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.css","mstrmojo.dom","mstrmojo.VisEnum","mstrmojo.gmaps.MapSingleLegendContent","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapLegendEnums","mstrmojo.gmaps.MapUtils");var Z=mstrmojo,c=Z.css,F=Z.dom,I=Z.gmaps,O=I.MapUtils,H=I.ShapeType,J=I.EnumGraphicType,D=I.EnumMarkerType,a=I.MapSingleLegendContent,M=Z.VisEnum,b=M.EnumSingleLegendMode,T=I.EnumPropertyType.collapseLegend;function S(g,f){if(g.parentNode===f){f.removeChild(g);return true;}return false;}function e(h,j,f,i){var k,g,l=this.domLgd;g=this.sizeBySlot;k=this.colorBySlot=new a();k.render();k.handleColorBy(h,j,f,i);if(g&&g.domLgdContent&&g.domLgdContent.parentNode===l){l.insertBefore(k.domLgdContent,g.domLgdContent);}else{l.appendChild(k.domLgdContent);}}function N(f){var g;g=this.sizeBySlot=new a();g.render();g.handleSizeBy(f);this.domLgd.appendChild(g.domLgdContent);}function B(l,k,h,j){var f=this.triButton,i=l.colorByData,g=l.sizeByData;O.setNodeAttributes(f,{title:mstrmojo.desc(8973,"Collapse")});if(!l){return ;}if(i&&i.item&&i.elements){if(!this.colorBySlot){e.call(this,i,k,h,j);}}if(g&&g.item&&g.elements){if(!this.sizeBySlot){N.call(this,g);}}}function G(g){var f=g.getMarkerType();switch(f){case D.Pin:return H.PIN;case D.Square:return H.RECT;case D.Diamond:return H.DIAMOND;case D.Circle:return H.CIRCLE;case D.Image:return H.RECT;default:return H.CIRCLE;}}function R(g){var f=g.graphicType;switch(f){case J.Bubble:return H.CIRCLE;case J.Area:return H.POLYGON;case J.Marker:return G(g);default:return H.RECT;}}mstrmojo.gmaps.MapSingleLegend=mstrmojo.declare(mstrmojo.Vis,[],{scriptClass:"mstrmojo.gmaps.MapSingleLegend",colorBySlot:null,sizeBySlot:null,displayStatus:false,collapse:false,widgetId:null,layerKey:null,markupString:'<div class="map-legend" mstrAttach:click><div class="map-legend-title-bar"><div class="map-legend-tri-button"></div><div class="map-legend-layer-icon"></div><div class="map-legend-title-text"></div></div></div>',markupSlots:{domLgd:function(){return this.domNode;}},postBuildRendering:function Y(){this._super();var i=this.domLgd,h=i.firstChild,g=h.firstChild,f=h.lastChild;this.addSlots({titleBar:h,triButton:g,titleText:f});},initializeLegend:function E(m,l,f,i,h,k){this.domLgd.id=m;this.displayStatus=k;this.updateLegendTitle(l);var g=R(i),j=i.isColorByAttr,n=parseInt(i.getLayerProp(T));B.call(this,f,g,j,h);this.widgetId=h;this.layerKey=i.key;if(n===b.COLLAPSE){this.collapseContent();}},updateLegendTitle:function Q(g){var f=this.titleText;f.innerHTML=g;O.setNodeAttributes(f,{title:g});},resetColorByData:function V(f,h,j){if(f&&f.item&&f.elements){var k=this.colorBySlot,i=R(h),g=h.isColorByAttr,l=this.domLgd;if(k){S(k.domNode,l);delete this.colorBySlot;}e.call(this,f,i,g,j);k=this.colorBySlot;if(this.collapse&&k){S(k.domLgdContent,l);}}},resetSizeByData:function d(g){if(g&&g.item&&g.elements){var f=this.sizeBySlot;if(f){S(f.domNode,this.domLgd);delete this.sizeBySlot;}N.call(this,g);}},showLegend:function X(){this.displayStatus=true;},hideLegend:function K(){this.displayStatus=false;},isShown:function C(){return this.displayStatus;},collapseContent:function U(){var f=this.triButton,g=this.sizeBySlot,h=this.colorBySlot,i=this.domLgd;this.collapse=true;O.setNodeAttributes(f,{title:mstrmojo.desc(8972,"Expand")});c.addClass(f,"collapsed");if(h){S(h.domLgdContent,i);}if(g){S(g.domLgdContent,i);}},restoreContent:function P(){var f=this.triButton,g=this.sizeBySlot,h=this.colorBySlot,i=this.domLgd;this.collapse=false;O.setNodeAttributes(f,{title:mstrmojo.desc(8973,"Collapse")});c.removeClass(f,"collapsed");if(h){i.appendChild(h.domLgdContent);}if(g){i.appendChild(g.domLgdContent);}},onclick:function(f){var h=f.getTarget(),g;if(h===this.triButton){g=Z.all[this.widgetId];if(this.collapse){this.restoreContent();g.legendCon.checkLastCollapse();g.handleLegendCollapse(this.layerKey,b.RESTORE);}else{g.legendCon.checkFirstCollapse();this.collapseContent();g.handleLegendCollapse(this.layerKey,b.COLLAPSE);}}F.stopPropogation(null,f.e);},isCollapse:function W(){return this.collapse;},handleLegendCollapsePropChange:function A(f){if(f===b.COLLAPSE){this.collapseContent();}else{if(f===b.RESTORE){this.restoreContent();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.Vis","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapLegendEnums","mstrmojo.gmaps.MapSingleLegend","mstrmojo._HasOwnAvatar","mstrmojo.gmaps.MapUtils");var g=mstrmojo,Al=g.css,AI=g.dom,Ab=g.gmaps,s=Ab.MapUtils,O=g.array,AF=Ab.LegendContainerStyles,AO=AF.PADDING_RIGHT,W=Ab.LegendSizeLimits,Ah=W.MAX_CON_WIDTH,AY=W.MIN_TEXT_WIDTH,w=Ab.LegendStyles,a=w.CONTENT_DATA_MARGIN_LEFT,t=w.CONTENT_DATA_COLOR_BLOCK_WIDTH,H=w.CONTENT_DATA_TEXT_MARGIN_LEFT,Am=6,y=34,u=Ab.MapSingleLegend,o=4,X=60,AN=38,AA=30,Ac=44,Ag=18,J=6,p=7,h=1,AJ=2,AE="px",Z=Ab.EnumPropertyType.legendSize;function Ae(Au,At){if(Au.parentNode===At){At.removeChild(Au);return true;}return false;}function AX(Av){var At=this.lgdConBody,Aw=this.legendSlots,Au;if(!this.isLegendExist(Av)){return false;}Au=Aw[Av].domLgd;if(Ae(Au,At)){this.lgdDisplayCount-=1;if(this.lgdDisplayCount<=0){this.hideLegendCon();}}return true;}function f(Ax){var Ay=this.widget,Aw=Ay.layerIdxMappingArr,Au,Av=-1,At;for(Au=0;Au<Aw.length;Au+=1){At=Aw[Au];if(Av<0&&Ax===At){Av=Au;}else{if(Av>=0&&this.checkLegendDisplay(At)){return At;}}}return null;}function T(Av){var At=this.lgdConBody,Au,Aw=this.legendSlots,Ax;if(!this.isLegendExist(Av)){return false;}Au=Aw[Av].domLgd;if(!AI.contains(At,Au)){Ax=f.call(this,Av);if(Ax){At.insertBefore(Au,Aw[Ax].domLgd);}else{At.appendChild(Au);}this.lgdDisplayCount+=1;this.showLegendCon();}return true;}function Af(Au,At){var Av=this.legendSlots;if(!Au||this.isLegendExist(At)){return ;}Av[At]=Au;}function An(Au,Aw){var Av=Aw&&Aw.min,At=Aw&&Aw.max;if(Av!==undefined){Au=Math.max(Au,Av);}if(At!==undefined){Au=Math.min(Au,At);}return Au;}mstrmojo.gmaps.MapLegendContainer=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gmaps.MapLegendContainer",widget:null,defaultAnchorPoint:null,legendSlots:null,lgdDisplayCount:0,conPosition:null,manualConHeight:-1,manualConHeightCollapse:-1,zoomLevelSub:null,markupString:'<div id="@id" class="map-legend-container-dockedNode" mstrAttach:click,mouseover,mouseout><div class="map-legend-container"><div class="map-legend-container-title-bar"><div class="map-legend-container-close-button"></div></div><div class="map-legend-container-content"></div></div><div class="map-legend-right-splitter"></div><div class="map-legend-top-splitter"></div><div class="map-legend-resizeRect"></div></div>',markupSlots:{dockedDom:function(){return this.domNode;},domLgdCon:function(){return this.domNode.firstChild;}},isDragValid:function q(At){return !mstrApp.isInVFInteractMode;},init:function AQ(At){this._super(At);this.legendSlots={};this.defaultAnchorPoint={left:Am,bottom:y};},destroyLegendCon:function Ak(){var Ax=this.widget,Av=Ax.layerIdxMappingArr,At,Aw,Au=Ax&&Ax.mapViewer&&Ax.mapViewer.baseLayer;for(At=0;At<Av.length;At+=1){Aw=Av[At];delete this.legendSlots[Aw];}if(Au){Au.detachEventListener(this.zoomLevelSub);}this.zoomLevelSub=null;this.widget=null;},initializeLgdCon:function I(Az){var Ay,Aw,At=Az.mapViewer.baseLayer,Ax=this,Au=Az.getPropertyValue(Z),Av=this.dockedDom.style;this.widget=Az;Ay=Math.max(Az.getWidth()*0.2,Ah);Aw=AY+a+t+H+AO;Av.maxWidth=Ay+AE;Av.minWidth=Aw+AE;this.setLegendConSizeByProp(Au);s.setNodeAttributes(this.closeBtn,{title:mstrmojo.desc(12002,"Hide Legend")});this.zoomLevelSub=At.attachEventListener("zoomLevelChanged",this.id,function(){Ax.refreshMapLegendNodes();});if(this.lgdDisplayCount<=0){this.hideLegendCon();}},setLegendConSizeByProp:function n(Au){var Ay=Au?JSON.parse(Au):{},Ax=Ay.w,At=Ay.h,Aw=Ay.ch,Av=this.dockedDom.style;if(Ax&&Ax>0){Av.width=Ax+AE;}else{Av.width="auto";}if(At&&At>0){this.manualConHeight=At;Av.height=At+AE;}else{this.manualConHeight=-1;Av.height="auto";}if(Aw&&Aw>0){this.manualConHeightCollapse=Aw;}else{this.manualConHeightCollapse=-1;}},handleLegendConSizePropChange:function x(At){this.setLegendConSizeByProp(At);this.resetAndHandleLayerLegendsHeight();},calDefaultDockedPositions:function AZ(){var At=this.defaultAnchorPoint;this.conPosition={left:At.left,bottom:At.bottom};this.updateLegendContainerPosition();},updateLegendContainerPosition:function AH(){var At=this.dockedDom,Au=this.conPosition;At.style.left=Au.left+AE;At.style.bottom=Au.bottom+AE;},postBuildRendering:function As(){this._super();var Aw=this.dockedDom,Au=this.domLgdCon,Ax=Au.firstChild,A0=Ax.lastChild,Av=Au.childNodes[1],Ay=Aw.childNodes[1],At=Aw.childNodes[2],Az=Aw.lastChild;this.addSlots({titleBar:Ax,closeBtn:A0,lgdConBody:Av,rightSplitter:Ay,topSplitter:At,resizeRect:Az});Al.addClass(this.closeBtn,"disable");},createSingleMapLegend:function Ap(Aw,A0){var Av,Az=this.widget,Au=Az.getGraphicLayer(Aw),Ay=Aw+"-legend",At=Au.getLayerName(),Ax={colorByData:Au.colorByInfo,sizeByData:Au.sizeByInfo};if(this.isLegendExist(Aw)){return false;}Av=new u();Av.render();Av.initializeLegend(Ay,At,Ax,Au,Az.id,A0);Af.call(this,Av,Aw);this.refreshSingleMapLegendNode(Aw);return true;},refreshSplitter:function r(){this.rightSplitter.style.height=this.dockedDom.offsetHeight+AE;this.rightSplitter.style.left=this.dockedDom.offsetWidth-o+AE;this.topSplitter.style.width=this.dockedDom.offsetWidth+AE;this.topSplitter.style.bottom=this.dockedDom.offsetHeight-o+AE;},getMaxConHeight:function AT(){var Aw=this.widget,Au=this.dockedDom,At=Aw.getHeight()-Au.offsetTop-Au.offsetHeight,Av=Aw.isTitleBarVisible()?AN:X;return Aw.getHeight()-At-Av;},checkLegendDisplay:function b(Au){var Av=this.widget,At;At=Av.getGraphicLayer(Au);return this.isLegendExist(Au)&&this.isLegendVisible(Au)&&At&&At.isVisible()&&At.isLayerInZoomRange();},refreshSingleMapLegendNode:function AL(At){if(!this.isLegendExist(At)){return ;}if(this.checkLegendDisplay(At)){T.call(this,At);}else{AX.call(this,At);}this.resetAndHandleLayerLegendsHeight();},refreshMapLegendNodes:function Ar(){var Ay=this.widget,Av=Ay.layerIdxMappingArr,At,Ax,Au=this.lgdConBody,Az=this.legendSlots,Aw;this.lgdDisplayCount=0;for(At=0;At<Av.length;At+=1){Ax=Av[At];if(this.isLegendExist(Ax)){Aw=Az[Ax].domLgd;Ae(Aw,Au);}}for(At=0;At<Av.length;At+=1){Ax=Av[At];if(this.checkLegendDisplay(Ax)){Aw=Az[Ax].domLgd;Au.appendChild(Aw);this.lgdDisplayCount+=1;}}if(this.lgdDisplayCount>0){this.showLegendCon();}else{this.hideLegendCon();}this.resetAndHandleLayerLegendsHeight();},hideAllMapLegendNodes:function V(){var Aw=this.widget,Au=Aw.layerIdxMappingArr,At,Av;for(At=0;At<Au.length;At+=1){Av=Au[At];this.hideSingleLegend(Av);}},showSingleLegend:function AM(At){if(!this.isLegendExist(At)||this.isLegendVisible(At)){return ;}this.legendSlots[At].showLegend();this.refreshSingleMapLegendNode(At);},hideSingleLegend:function v(At){if(!this.isLegendExist(At)||!this.isLegendVisible(At)){return ;}this.legendSlots[At].hideLegend();this.refreshSingleMapLegendNode(At);},hideLegendCon:function d(){Al.addClass(this.dockedDom,"disable");},showLegendCon:function AD(){Al.removeClass(this.dockedDom,"disable");},isLegendExist:function i(At){return !!this.legendSlots[At];},isLegendVisible:function K(At){if(this.isLegendExist(At)){return this.legendSlots[At].isShown();}return false;},handleWidgetResize:function M(){this.resetAndHandleLayerLegendsHeight();},resetLegendColorByData:function Y(Aw,At){var Ax,Av,Au;if(this.isLegendExist(Aw)){Ax=this.widget;Av=Ax.getGraphicLayer(Aw);Au=this.legendSlots[Aw];Au.resetColorByData(At,Av,Ax.id);this.refreshSingleMapLegendNode(Aw);}},resetLegendSizeByData:function c(Au,Av){var At;if(this.isLegendExist(Au)){At=this.legendSlots[Au];At.resetSizeByData(Av);this.refreshSingleMapLegendNode(Au);}},removeLegendBySwitchProp:function U(At){var Au;if(this.isLegendExist(At)){Au=this.legendSlots;AX.call(this,At);delete Au[At];}},destroyLegend:function Ai(At){if(this.isLegendExist(At)){AX.call(this,At);delete this.legendSlots[At];this.resetAndHandleLayerLegendsHeight();}},resetLegendConHeight:function Q(){this.manualConHeight=-1;this.manualConHeightCollapse=-1;this.resetLayerLegendsHeight();},resetAndHandleLayerLegendsHeight:function k(){this.resetLayerLegendsHeight();if(this.lgdDisplayCount>0){this.handleHeight();}},resetLayerLegendsHeight:function AG(){var Az=this.legendSlots,At,Aw,Ay,Av,Au,Ax=Object.keys(Az);for(Av=0;Av<Ax.length;Av+=1){Au=Ax[Av];At=Az[Au];if(At){Ay=At.colorBySlot;if(Ay){Ay.initTableOffsetHeight=-1;Ay.contentElementTable.style.height="auto";}Aw=At.sizeBySlot;if(Aw){Aw.initTableOffsetHeight=-1;Aw.contentElementTable.style.height="auto";}}}this.dockedDom.style.height="auto";},resetSize:function z(){this.dockedDom.style.width="auto";this.resetLegendConHeight();},onclick:function(At){var Au=At.getTarget();if(Au===this.closeBtn){this.hideAllMapLegendNodes();this.resetSize();this.widget.closeLegendConWithSizeUpdate();}AI.stopPropogation(null,At.e);},getHSplitterInfo:function N(Az,Ay){if(!Az){return{};}var Ax={},Au=Az.offsetLeft,Aw=this.dockedDom.offsetWidth,Av=Math.min(this.widget.getWidth()*0.25,Ah),At=AY+a+t+H+AO;if(Ay){Ax.min=At-o;Ax.max=Av-o;}else{Ax.min=Aw-Av;Ax.max=Aw-At;}Ax.startLeft=Au;return Ax;},getSectionCount:function AK(){var Ay=this.legendSlots,At,Ax=0,Av,Au,Aw=Object.keys(Ay);for(Av=0;Av<Aw.length;Av+=1){Au=Aw[Av];At=Ay[Au];if(At.colorBySlot){Ax+=1;}if(At.sizeBySlot){Ax+=1;}}return Ax;},getTopSplitterInfo:function AP(Aw){if(!Aw){return{};}var Av={},Au=this.dockedDom,At=-Aw.offsetTop+Au.offsetHeight;Av.max=this.getMaxConHeight()-o;Av.min=this.getSectionCount()*Ac+AA-o;Av.startBottom=At;return Av;},positionHResizeRect:function Ad(Ax,Au){var Av=Ax.offsetLeft,Aw=Au?0:Av,At=Au?Av+o:0;this.resizeRect.style.bottom="0px";this.resizeRect.style.left=Aw+AE;this.resizeRect.style.width=At+AE;},positionTopResizeRect:function l(Au){var At=-Au.offsetTop+this.dockedDom.offsetHeight;this.resizeRect.style.bottom="0px";this.resizeRect.style.left="0px";this.resizeRect.style.height=At-o+AE;},ondragstart:function E(At){var Au=At.src.e.target;if(Au===this.rightSplitter){At.src.posInfo=this.getHSplitterInfo(Au,true);this.positionHResizeRect(Au,true);this.resizeRect.style.height=this.dockedDom.offsetHeight+AE;Al.addClass(this.resizeRect,"resizing");}else{if(Au===this.topSplitter){At.src.posInfo=this.getTopSplitterInfo(Au);this.positionTopResizeRect(Au);this.resizeRect.style.width=this.dockedDom.offsetWidth+AE;Al.addClass(this.resizeRect,"resizing");}}},getHSplitterPosition:function e(Au){var Av=Au.src.posInfo,At=Av.startLeft+Au.tgt.pos.x-Au.src.pos.x;return An(At,Av);},getTopSplitterPosition:function Aj(Au){var Av=Au.src.posInfo,At=Av.startBottom-Au.tgt.pos.y+Au.src.pos.y;return An(At,Av);},ondragmove:function B(At){var Aw=At.src.e.target,Av,Au;if(Aw===this.rightSplitter){Av=this.getHSplitterPosition(At);Aw.style.left=Av+AE;this.positionHResizeRect(Aw,true);}else{if(Aw===this.topSplitter){Au=this.getTopSplitterPosition(At);Aw.style.bottom=Au+AE;this.positionTopResizeRect(Aw);}}},ondragend:function S(Au){var Aw=Au.src.e.target,Av,At;if(Aw===this.rightSplitter){Al.removeClass(this.resizeRect,"resizing");this.dockedDom.style.width=Aw.offsetLeft+o+AE;this.handleHeight();this.writeLegendSize();}else{if(Aw===this.topSplitter){Al.removeClass(this.resizeRect,"resizing");if(!this.isAllLegendsCollapse()){Av=-1*Aw.offsetTop+this.dockedDom.offsetHeight;At=Av-o;if(!this.hasLegendCollapse()){this.manualConHeight=At;}else{this.manualConHeightCollapse=At;}this.handleHeight(true);this.writeLegendSize();}}}},onmouseover:function G(At){Al.removeClass(this.closeBtn,"disable");},onmouseout:function m(At){Al.addClass(this.closeBtn,"disable");},isManualHeight:function Ao(){return this.manualConHeight>0;},isManualHeightCollapse:function AU(){return this.manualConHeightCollapse>0;},getAllLgdContentSlots:function D(){var A0=this.legendSlots,Au,A3=[],Av,At,A2=[],Az=0,Ay=0,A5=0,A1,A7=0,Ax,Aw,A4,A6=Object.keys(A0);for(Ax=0;Ax<A6.length;Ax+=1){A4=A6[Ax];if(!this.checkLegendDisplay(A4)){continue;}Au=A0[A4];if(!Au.isCollapse()){At=Au.colorBySlot;if(At){if(At.initTableOffsetHeight<0){At.initTableOffsetHeight=At.contentElementTable.offsetHeight;}A1=At.initTableOffsetHeight;if(A1>=A7){A7=A1;A3.push(At);}else{for(Aw=Ay-1;Aw>=0;Aw-=1){if(A3[Aw].initTableOffsetHeight<=A1){O.insert(A3,Aw+1,At);break;}}if(Aw===-1){O.insert(A3,0,At);}}Ay+=1;}Av=Au.sizeBySlot;if(Av){if(Av.initTableOffsetHeight<0){Av.initTableOffsetHeight=Av.contentElementTable.offsetHeight;}A2.push(Av);A5+=1;}}Az+=1;}return{lgdCount:Az,slotCount:Ay+A5,cSlots:A3,sSlots:A2};},adjustHeightConst:function P(At){this.heightAdjust(At);},adjustHeightManual:function j(Au){var At=this.heightAdjust(this.manualConHeight);if(Au===true){this.manualConHeight=At;}},adjustHeightManualCollapse:function AB(Au){var At=this.heightAdjust(this.manualConHeightCollapse);if(Au===true){this.manualConHeightCollapse=At;}if(this.isManualHeight()&&this.manualConHeightCollapse>this.manualConHeight){this.manualConHeight=this.manualConHeightCollapse;}},handleHeight:function Aa(Av){var Au=this.dockedDom,Aw=this.getMaxConHeight(),At=2;if(this.hasLegendCollapse()){if(this.isManualHeightCollapse()){this.adjustHeightManualCollapse(Av);if(Au.offsetHeight>Aw+At){this.resetLegendConHeight();this.adjustHeightConst(Aw);}}else{if(Au.offsetHeight>Aw){this.adjustHeightConst(Aw);}}}else{if(this.isManualHeight()){this.adjustHeightManual(Av);if(Au.offsetHeight>Aw+At){this.resetLegendConHeight();this.adjustHeightConst(Aw);}}else{if(Au.offsetHeight>Aw){this.adjustHeightConst(Aw);}}}this.refreshSplitter();},heightAdjust:function AC(Ay){var A4=this.titleBar.offsetHeight,A9=this.getAllLgdContentSlots(),At=A9.lgdCount,BC=A9.slotCount,A8=A9.cSlots,BA=A9.sSlots,Aw=Ag*At,Az=(BC-1)*p+J,A3=0,A6,A7,BE,BG,A2=BA.length,BF=A8.length,A5=A2+BF*2,BB,BD,Av,Au,A1=0,Ax=0,A0;A6=Ay-h*2-Az-Aw-A4-AJ;if(A5>0){for(A7=0;A7<A2;A7+=1){BE=BA[A7];A3+=BE.contentName.offsetHeight;}for(A7=0;A7<BF;A7+=1){BG=A8[A7];A3+=BG.contentName.offsetHeight;}A6-=A3;if(A2>0){BB=Math.min(A6/A5,BA[0].initTableOffsetHeight);for(A7=0;A7<A2;A7+=1){BE=BA[A7];BE.contentElementTable.style.height=BB+AE;}A6-=BB*A2;}Au=BF;while(Ax<BF){BD=A6/Au;for(A7=Ax;A7<BF;A7+=1){BG=A8[A7];Av=BG.contentElementTable;if(BG.initTableOffsetHeight<BD){A6-=BG.initTableOffsetHeight;Av.style.height=BG.initTableOffsetHeight+AE;Ax+=1;Au-=1;}}if(A1===Ax){for(A7=A1;A7<BF;A7+=1){BG=A8[A7];Av=BG.contentElementTable;A6-=BD;Av.style.height=BD+AE;}break;}A1=Ax;}}A0=Ay-A6;this.dockedDom.style.height=A0+AE;return A0;},checkFirstCollapse:function AW(){if(!this.hasLegendCollapse()){this.manualConHeightCollapse=this.manualConHeight;}},checkLastCollapse:function Aq(){if(!this.hasLegendCollapse()){this.manualConHeightCollapse=-1;}},handleLegendCollapsePropChange:function AR(Au,Aw){var Av=this.legendSlots,At=Av&&Au&&Av[Au];if(At){At.handleLegendCollapsePropChange(Aw);}},hasLegendCollapse:function A(){var Ay=this.legendSlots,Au,Aw,Av,Ax=Object.keys(Ay),At=Ax.length;for(Aw=0;Aw<At;Aw+=1){Av=Ax[Aw];Au=Ay[Av];if(Au.isCollapse()){return true;}}return false;},isAllLegendsCollapse:function C(){var Ay=this.legendSlots,Au,Aw,Av,Ax=Object.keys(Ay),At=Ax.length;if(!(Ax&&At>0)){return false;}for(Aw=0;Aw<At;Aw+=1){Av=Ax[Aw];Au=Ay[Av];if(!Au.isCollapse()){return false;}}return true;},updateLegendTitle:function R(Au,At){if(this.isLegendExist(Au)){this.legendSlots[Au].updateLegendTitle(At);}},writeLegendSize:function F(){var Au=this.widget,At=Au.getPropertyBelongingKey(Z);Au.writeProperties(Z,this.getLegendConSizeProp(),At);},getLegendConSizeProp:function AV(){var At=this.dockedDom,Av=At.style.width,Au=Av&&Av!==""&&Av!=="auto",Aw=Au?At.offsetWidth:-1;return JSON.stringify({w:Aw,h:this.manualConHeight,ch:this.manualConHeightCollapse});},handleLayerVisibleChange:function AS(At){this.refreshSingleMapLegendNode(At);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.geometry.Polygon");var Z=mstrmojo,M=Z.array,G=Z.gmaps,K=G.MapUtils,A=G.geometry.Polygon,R=G.graphic.Graphic,Y="http://www.w3.org/2000/svg",J=10,T={S:1,C:2,E:3};function D(d,c,e){var b=d.length,a=e?c-1:c+1;while(a<b&&a>=0){if(Math.pow(d[a].x-d[c].x,2)+Math.pow(d[a].y-d[c].y,2)>100){return a;}a=e?a-1:a+1;}return -1;}mstrmojo.gmaps.layer.svg._AffinityLineViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.svg._AffinityLineViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.svg._AffinityLineViewerWrapper",affinityLinesHostNode:null,affinityLinesGraphics:undefined,affinityLinesArrows:undefined,createAffinityLineLayer:function H(){if(!this.parent.wpDisPlayAffinityLines){return ;}this.removeAffinityLineLayer();this.affinityLinesHostNode=K.appendGNode(this.gNode);this.affinityLinesGraphics=[];this.affinityLinesArrows=[];var c,a=this.parent.affinityLineGraphicsConfig||[],d=this.affinityLinesHostNode,b=this.affinityLinesGraphics;M.forEach(a,function(e){c=new A({sourceLocation:e.sourceLocation,destLocation:e.destLocation,fillOpacity:"0",strokeColor:e.strokeColor,strokeOpacity:"1",strokeWidth:e.strokeWidth});b.push(new R({type:"Polygon",geometry:c}));d.appendChild(c.node);});},reGenerateAffinityLineLayer:function P(){this.createAffinityLineLayer();this.updateAffinityLineLayer();},removeAffinityLineLayer:function N(){var c,a=this.affinityLinesGraphics,b=this.affinityLinesHostNode,d=(a&&a.length)||0;for(c=0;c<d;c++){a[c].destroy();}this.affinityLinesGraphics=[];this.removeAffinityLineArrows();if(b&&b.parentNode){b.parentNode.removeChild(b);this.affinityLinesHostNode=null;}},removeAffinityLineArrows:function(){var b,c,a=this.affinityLinesArrows,d=(a&&a.length)||0;for(b=0;b<d;b++){c=a[b];if(c.parentNode){c.parentNode.removeChild(c);}}this.affinityLinesArrows=[];},isAffinityLineShown:function B(){return this.affinityLinesHostNode&&this.affinityLinesHostNode.style.display!=="none";},isAffinityLineHide:function C(){return this.affinityLinesHostNode&&this.affinityLinesHostNode.style.display!=="block";},showAffinityLineLayer:function O(){if(this.affinityLinesHostNode){this.affinityLinesHostNode.style.display="block";}},hideAffinityLineLayer:function W(){if(this.affinityLinesHostNode){this.affinityLinesHostNode.style.display="none";}},getNumOfPoints:function Q(e,d,c){var b=Math.abs(e.lng-d.lng),a;b=b===180?0:b;b=b>180?360-b:b;if(b<=90){a=0.5;}else{a=Math.pow(b/90,3);}b=b*a*c/4;return Math.max(10,Math.ceil(b));},updateAffinityLineLayer:function U(){if(!this.parent.wpDisPlayAffinityLines){return ;}var c=this,e=this.parent.wpDrawArcsLines==="Arcs",b=this.affinityLinesGraphics,a=this.parent.getBaseLayer(),d=(a&&a.getZoom())||4;this.removeAffinityLineArrows();M.forEach(b,function(l){var k=l.geometry;if(k.zoomLevel===undefined||k.zoomLevel!==d){var j=k.sourceLocation,i=k.destLocation,f,g;if(e){f=c.getNumOfPoints(j,i,d);g=c.findPointsOnArc(j,i,f);k.geoPolylineArr=[g];}else{k.geoPolylineArr=[[j,i]];}k.zoomLevel=d;}l.geoData=k.geoPolylineArr;k.update(a.getScreenPositionInfo(l));var h;if(e){h=c.generateArrowConfigsForArcLine(k);}else{h=c.generateArrowConfigsForStraightLine(k);}c.drawDirectedArrows(h,k.strokeColor);});},drawDirectedArrows:function V(e,a){var c,f,g=e.length,b=this.affinityLinesHostNode,d=this.affinityLinesArrows;for(c=0;c<g;c++){f=document.createElementNS(Y,"path");f.setAttribute("fill",a);f.setAttribute("stroke",a);f.setAttribute("stroke-width","1");f.setAttribute("d",e[c].arrowStr);f.setAttribute("transform",e[c].rotate);b.appendChild(f);d.push(f);}},generateArrowConfigsForArcLine:function S(o){var e,q,p,m,h,a=o.geoPolylineArr&&o.geoPolylineArr[0],f=o.screenPolylineArr,l=(a&&a.length)||10,k=[],c=(f&&f.length)||0,b=Math.round(l/J),d=b,g=0;for(e=0;e<c;e++){q=f[e];p=q.length;if(p<2){continue;}if(e===0){h=D(q,0);if(h<0){continue;}k.push(this.getArrowConfigOfLine(q[0],q[h],T.S));}while((d-g)<p){m=Math.max(Math.floor(d-g),0);h=D(q,m);if(h<0){break;}k.push(this.getArrowConfigOfLine(q[m],q[h],T.S));d=Math.max(d+b,h+g);}if(e===c-1){h=D(q,p-1,true);if(h<0){break;}k.push(this.getArrowConfigOfLine(q[h],q[p-1],T.E));}g+=p;}return k;},generateArrowConfigsForStraightLine:function X(k){var d,c,o,l,f,a=k.geoPolylineArr&&k.geoPolylineArr[0],e=k.screenPolylineArr,b=(e&&e.length)||0,g=[],p=[],h=[],m=0;if(!a||a.length<2||b<1){return g;}for(d=0;d<b;d++){o=e[d];if(o.length<2){return g;}p[d]=Math.abs(o[1].x-o[0].x);m+=p[d];}if(m===0||a[0].lng===a[1].lng){h[0]=J;}else{for(d=0;d<b;d++){h[d]=Math.max(Math.floor(p[d]/m*J),1);}}b=h.length;for(d=0;d<b;d++){o=e[d];o=this.findPointsOnLine(o[0],o[1],h[d]);l=o.length;c=1;if(d===0){f=D(o,0);if(f<0){continue;}c=f;g.push(this.getArrowConfigOfLine(o[0],o[f],T.S));}while(c<l-1){f=D(o,c);if(f<0){break;}g.push(this.getArrowConfigOfLine(o[c],o[f],T.S));c=f;}if(d===b-1){f=D(o,l-1,true);if(f<0){break;}g.push(this.getArrowConfigOfLine(o[f],o[l-1],T.E));}}return g;},findPointsOnArc:function F(p,e,d){var r,v,t,s,n,m,l,o,k,q=[],c=180/Math.PI,j=p.lat/c,w=p.lng/c,h=e.lat/c,u=e.lng/c,g=2*Math.asin(Math.sqrt(Math.pow((Math.sin(j-h)/2),2)+Math.cos(j)*Math.cos(h)*Math.pow((Math.sin(w-u)/2),2)));for(r=0;r<=d;r++){s=Number(r/d);v=Math.sin((1-s)*g)/Math.sin(g);t=Math.sin(s*g)/Math.sin(g);n=v*Math.cos(j)*Math.cos(w)+t*Math.cos(h)*Math.cos(u);m=v*Math.cos(j)*Math.sin(w)+t*Math.cos(h)*Math.sin(u);l=v*Math.sin(j)+t*Math.sin(h);o=Math.atan2(l,Math.sqrt(Math.pow(n,2)+Math.pow(m,2)));k=Math.atan2(m,n);q.push({lat:o*c,lng:k*c});}return q;},findPointsOnLine:function I(j,k,f){var h,g,d,a,e,b=Infinity,l=[];if(k.x-j.x!==0){b=(k.y-j.y)/(k.x-j.x);e=j.y-b*j.x;a=(k.x-j.x)/f;}else{a=(k.y-j.y)/f;}for(d=0;d<=f;d++){if(b===Infinity){h=j.x;g=j.y+a*d;}else{h=j.x+a*d;g=b*h+e;}l.push({x:h,y:g});}return l;},getArrowConfigOfLine:function E(d,b,c){var e=Math.atan2(b.y-d.y,b.x-d.x)/Math.PI*180,a=function(f,g){return{arrowStr:"M"+f+" "+g+" L"+(f-10)+" "+(g-4)+" L"+(f-8)+" "+g+" L"+(f-10)+" "+(g+4)+"Z",rotate:"rotate("+e+" "+f+" "+g+")"};};if(c===T.S){return a(d.x,d.y);}else{if(c===T.E){return a(b.x,b.y);}else{return a((d.x+b.x)/2,(d.y+b.y)/2);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.Graphic");var M=mstrmojo,I=M.array,C=M.gmaps.MapUtils;mstrmojo.gmaps.graphic.ClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.Graphic,null,{scriptClass:"mstrmojo.gmaps.graphic.ClusterGraphic",type:"Point",subGraphics:null,idxOfFirstSlice:0,init:function Q(R){if(!R){return ;}this.subGraphics=[];this._super(R);},_checkProps:function K(U){if(!U||!U.points){return false;}var R=U.clusterCount,W=U.geoData,V=W&&W.lat,S=W&&W.lng,T=U.points;if(!R){U.clusterCount=T.length;}if(isNaN(V)||isNaN(S)){W=T[0]&&T[0].geoData;V=W&&W.lat;S=W&&W.lng;if(isNaN(V)||isNaN(S)){return false;}U.geoData=W;}return true;},addSubGraphic:function J(R){this.subGraphics.push(R);R.parentGraphic=this;},getSubGraphics:function O(){return this.subGraphics;},getGeometryArr:function E(){var R=this.getSubGraphics(),S=[];if(!I.isArray(R)){return ;}I.forEach(R,function(T){S.push(T.geometry);});return S;},updatePosition:function G(T){var R=this.getSubGraphics(),S;for(S in R){R[S].updatePosition(T);}},isSelected:function B(){var S=this.getSubGraphics(),R=true;I.forEach(S,function(T){if(!T.isSelected()){R=false;return false;}});return R;},getGraphicsForSelection:function A(){if(!this.subGraphics){return null;}return this.subGraphics;},getFirstNode:function H(){var S=this.subGraphics,R=S&&S[this.idxOfFirstSlice],T=R&&R.geometry;if(T){return T.getNode();}},getLastNode:function F(){var S=this.subGraphics,R=S&&S[S.length-1],T=R&&R.geometry;if(T){return T.getNode();}},moveGraphicToTop:function D(V){var S=this.getLastNode(),R=this.subGraphics,U=V&&V.geometry,T=U&&U.getNode();if(!S||!I.isArray(R)||!T){return ;}C.insertAfter(T,S);I.removeItem(R,V);R.push(V);},moveGraphicToBottom:function P(R,W){var T=this.getFirstNode(),S=this.subGraphics,V=W&&W.geometry,U=V&&V.getNode();if(!R||!T||!I.isArray(S)||!U){return ;}R.insertBefore(U,T);I.removeItem(S,W);I.insert(S,this.idxOfFirstSlice,W);},destroy:function N(){if(this.subGraphics){I.forEach(this.subGraphics,function(R){R.destroy();});delete this.subGraphics;}this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.PieSlice");var B=mstrmojo.gmaps.geometry,F=mstrmojo.gmaps.MapUtils,E=mstrmojo.hash;mstrmojo.gmaps.graphic._HasPieSlices=mstrmojo.provide("mstrmojo.gmaps.graphic._HasPieSlices",{_mixinName:"mstrmojo.gmaps.graphic._HasPieSlices",getTotalValue:function D(){var H=this.totalValue,K=this.points,N=K&&K.length,G,J,M,I;if(!F.checkVal(H)){H=0;for(I=0;I<N;I++){G=K[I];J=G&&G.attributes;M=J&&J.absAngleMetricVal;if(F.checkVal(M)){H+=M;}}this.totalValue=H;}return H;},createPieSliceGraphics:function A(P,Y,G,R,Q){var V,T,O,S,H,I,N=0,J,K,U=this.points||[],M=this.getTotalValue();this.pieSlices=[];var W=(this.parent&&this.parent.getLayerFmts())||{},X=U.length;for(V=0;V<X;V++){T=U[V];O=T.attributes;H=O&&O.absAngleMetricVal;K=O&&O.threshold;if(K&&K.colorStr){W.fillColor=K.colorStr;}if(X===1){S=new mstrmojo.gmaps.graphic.Graphic({geometry:new B.Circle(E.copy({radius:Y,x:R,y:Q},W)),attributes:O,geoData:this.geoData});}else{I=M===0?(1/this.clusterCount):(F.checkVal(H)?(H/M):0);if(I===0){continue;}J=N+360*I;if(N===0&&J===360){J=359.9999;}S=new mstrmojo.gmaps.graphic.Graphic({geometry:new B.PieSlice(E.copy({startDegree:N,endDegree:J,innerR:G,outterR:Y,isRing:P,x:R,y:Q},W)),attributes:O,geoData:this.geoData});N=J;}this.pieSlices.push(S);if(this.addSubGraphic instanceof Function){this.addSubGraphic(S);}}},destroy:function C(){if(this.pieSlices){delete this.pieSlices;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer");var e=mstrmojo,V=e.hash,f=e.array,I=e.gmaps,W=e.mapbox,l=I.MapUtils,K=I.EnumDataLabelShowOption,F=W.ID_SUFFIX,Z=W.FILTER.NOFEATURE;function H(q){if(!q||q.length<=0){return null;}else{if(q.length===1){return q.concat(q);}}return q;}mstrmojo.gmaps.layer.mapbox.PolygonLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.mapbox.PolygonLayerViewer",type:"fill",borderType:"line",labelTextAnchor:"center",shapeFmtNames:{fillColor:"fill-color",fillOpacity:"fill-opacity",strokeWidth:"line-width",strokeColor:"line-color",strokeStyle:"line-dasharray"},getData:function U(y){var x=this,u={polyFilters:["in","id"],colorStops:[],opacityStops:[],seleColorStops:[],hoverColorStops:[],unSelectedColorStops:[],textStops:{},featureIdGraphicIdMap:{}},q=u.polyFilters,r=u.colorStops,v=u.opacityStops,AA=u.seleColorStops,AB=u.hoverColorStops,z=u.unSelectedColorStops,t=u.textStops,w=u.featureIdGraphicIdMap,s;f.forEach([K.SHOW_TEXT,K.SHOW_VALUE,K.SHOW_BOTH],function(AC){t[AC]=[];});f.forEach(y,function(AE){var AC=AE.attributes,AD=x.extractShapeProps(AC);s=AC.geoId;if(s){q.push(s);r.push([s,AD.fillColor]);v.push([s,AD.fillOpacity]);AA.push([s,l.fillColorAjustForCMSelection(AD.fillColor)]);AB.push([s,l.fillColorAjustForHover(AD.fillColor)]);z.push([s,AD.fillColor]);t[K.SHOW_TEXT].push([s,AD.labelText]);t[K.SHOW_VALUE].push([s,AD.labelValues]);t[K.SHOW_BOTH].push([s,AD.labelText+"\n"+AD.labelValues]);w[s]=AE.id;}});return u;},getMapID:function S(){return V.walk("parent.lookUpTable.TilesetName",this);},getPolygonLayerName:function h(){return V.walk("parent.lookUpTable.PolyLayerName",this);},getDataLabelSourceLayer:function n(){return V.walk("parent.lookUpTable.PointLayerName",this);},getLabelTextOffset:function E(){return[0,0];},addSource:function N(){var s=this.getMapInstance(),q=this.getMapID(),r=this.getSourceId();if(s&&q){if(s.getSource(r)){s.removeSource(r);}s.addSource(r,{type:"vector",url:"mapbox://"+q});return true;}else{return false;}},addPolygonLayers:function Y(q,t,u,v){var r=this.getMapInstance(),s=this.getLayerId(),w=s+q,x=this.getSourceId(),y=this.getPolygonLayerName();r.addLayer(V.copy(u,this.getLayerCtrlProps(w,this.type,x,t,y)));this._layerIds.push(w);if(v){w=s+F.Border+q;r.addLayer(V.copy(v,this.getLayerCtrlProps(w,this.borderType,x,t,y)));this._layerIds.push(w);}},getWorldViewFilter:function D(){return["in","worldview","all","US"];},getBaseFilters:function b(){return this.data.polyFilters;},getEmptyFilter:function T(){return Z;},getQualifiedFilter:function O(q){return q;},addLayers:function d(){var q=this.getMapInstance();if(!q){return ;}this._layerIds=[];this.addPolygonLayers("",this.getBaseFilters(),this.getLayerOptions(),this.getLayerBorderOptions());this.addPolygonLayers(F.Unselected,Z,this.getLayerOptionsUnselected());this.addPolygonLayers(F.Selection,Z,this.getLayerOptionsSelection(),this.getLayerBorderOptionsSelection());this.addPolygonLayers(F.ContextMenu,Z,this.getLayerOptionsContextMenu(),this.getLayerBorderOptionsContextMenu());this.addPolygonLayers(F.Hover,Z,this.getLayerOptionsHover());this.addDataLabelLayer(q);},getStrokeClrFmtLayers:function M(){var q=this.getLayerId();return[q+F.Border];},getQueryLayers:function a(){var q=this.getLayerId();if(q){return this.validLayers([q+F.Hover,q+F.ContextMenu,q+F.Selection,q,q+F.Border+F.ContextMenu,q+F.Border+F.Selection,q+F.Border,q+F.Unselected]);}return[];},handleContextMenu:function B(r){var u=this.getMapInstance(),t=this.getFeatureIDsFromGraphics(r),q=this.getLayerId(),s;if(!u||!u.getLayer(q)){return ;}if(!t){u.setFilter(q,this.getFilters4MainLayer(true));u.setFilter(q+F.Border,this.getFilters4MainLayer(true));u.setFilter(q+F.ContextMenu,this.getEmptyFilter());u.setFilter(q+F.Border+F.ContextMenu,this.getEmptyFilter());}},handleSelections:function Q(r){var s=this.getMapInstance(),q=this.getLayerId();if(!s||!s.getLayer(q)){return ;}if(!r){s.setFilter(q,this.getFilters4MainLayer(true));s.setFilter(q+F.Border,this.getFilters4MainLayer(true));s.setFilter(q+F.Selection,this.getEmptyFilter());s.setFilter(q+F.Border+F.Selection,this.getEmptyFilter());s.setFilter(q+F.ContextMenu,this.getEmptyFilter());s.setFilter(q+F.Border+F.ContextMenu,this.getEmptyFilter());s.setFilter(q+F.Unselected,this.getEmptyFilter());}},handleHighlight:function j(s,w){var x=this.getMapInstance(),r=this.getLayerId(),v=this.getFeatureIDsFromGraphics(s),q=this.getFeatureIDsFromGraphics(w),t=v.concat(q),u;if(!x||!x.getLayer(r)){return ;}x.setFilter(r,this.getEmptyFilter());x.setFilter(r+F.Border,this.getFilters4MainLayer(false,t));u=this.getQualifiedFilter(["in","id"].concat(v));x.setFilter(r+F.Selection,u);x.setFilter(r+F.Border+F.Selection,u);u=this.getQualifiedFilter(["in","id"].concat(q));x.setFilter(r+F.ContextMenu,u);x.setFilter(r+F.Border+F.ContextMenu,u);x.setFilter(r+F.Unselected,this.getFilters4MainLayer(false,t));},getHoverLayerFromFeature:function C(s){var r=this.getLayerId(),q=s.layer.id;switch(q){case r+F.Border+F.Selection:return r+F.Selection;case r+F.Border+F.ContextMenu:return r+F.ContextMenu;case r+F.Border:return r;default:return q;}},highlightGraphics:function J(r){var t=this.getMapInstance(),q=this.getLayerId(),s=this.getFeatureIDsFromGraphics(r);if(!t||!t.getLayer(q)||!s||s.length<1){return ;}this.handleSelections(s);},getPaint:function k(){var q=this.shapeFmtNames,r={};r[q.fillColor]=this.getFillColor();r[q.fillOpacity]=this.getFillOpacity();return r;},getPaintHover:function c(){var r={},q=this.shapeFmtNames;r[q.fillColor]=this.getFillColorHover();r[q.fillOpacity]=this.hoverOpacity;return r;},getPaintContextMenu:function o(){var r={},q=this.shapeFmtNames;r[q.fillColor]=this.getFillColorCMSelection();r[q.fillOpacity]=this.fillOpacitySelection;return r;},getPaintSelection:function m(){var r={},q=this.shapeFmtNames;r[q.fillColor]=this.getFillColor();r[q.fillOpacity]=this.fillOpacitySelection;return r;},getLayerBorderOptions:function P(){var q=this.getFmts(),r=this.shapeFmtNames,s={},t=H(q.strokeDashArray);s[r.strokeColor]=q.strokeColor;s[r.strokeWidth]=q.strokeWidth;if(t){s[r.strokeStyle]=t;}return{paint:s};},getLayerBorderOptionsContextMenu:function G(){var q=this.shapeFmtNames,r=this.getLayerBorderOptions(),s=r.paint;s[q.strokeColor]=this.getFillColor();return r;},getLayerBorderOptionsSelection:function R(){var q=this.shapeFmtNames,r=this.getLayerBorderOptions(),s=r.paint;s[q.strokeColor]=this.strokeColorSelection;if(s[q.strokeWidth]<=0){s[q.strokeWidth]=1;}return r;},setShapeStrokeStyle:function g(r){var s=this.getMapInstance(),q=this.shapeFmtNames,v=this.getLayerId(),u=r&&r.shapeBorderWidth,t=r&&r.shapeBorderLineDash;t=H(t);f.forEach(this.validLayers([v+F.Border,v+F.Border+F.ContextMenu,v+F.Border+F.Selection]),function(w){if(w===v+F.Border+F.Selection&&u===0&&t===null){s.setPaintProperty(w,q.strokeWidth,1);}else{s.setPaintProperty(w,q.strokeWidth,u);}s.setPaintProperty(w,q.strokeStyle,t);});},getLabelField:function A(q){return{property:"id",type:"categorical",stops:this.data.textStops[q]};},getGraphicIDsFromFeatureIDs:function X(q){var r=this.data.featureIdGraphicIdMap;return f.map(q,function(s){return r[s&&s.properties.id];});},getFeatureIDsFromGraphics:function i(q){var s,r=this.data.featureIdGraphicIdMap;return f.map(q,function(t){for(s in r){if(t&&r[s]===t.id){return s;}}});},setCMBorderColor:function p(t,r,s,q){t.setPaintProperty(r+F.Border+F.ContextMenu,s,q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer");var K=mstrmojo,E=K.hash,H=K.array,J=K.gmaps.EnumMarkerType,I=["map_marker Regular"],G={"text-line-height":1,"text-padding":0,"text-anchor":"center","text-allow-overlap":true,"icon-optional":true,"text-font":I};function N(O){switch(O){case J.Square:return String.fromCharCode("0xe802");case J.Diamond:return String.fromCharCode("0xe800");case J.Pin:return String.fromCharCode("0xe801");case J.Circle:default:return String.fromCharCode("0xe804");}}function F(O){switch(O){case J.Square:return 8;case J.Diamond:case J.Pin:case J.Circle:default:return 11;}}mstrmojo.gmaps.layer.mapbox.MarkerLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.mapbox.MarkerLayerViewer",type:"symbol",markerType:null,shapeFmtNames:{fillColor:"text-color",fillOpacity:"text-opacity",strokeColor:"text-halo-color",strokeWidth:"text-halo-width"},getExtraSourceProps:function D(){return{buffer:10};},getLayout:function B(){var O=this.markerType;return E.copy(G,{"text-field":N(O),"text-size":F(O)});},getPaint:function A(){return E.copy({"text-translate-anchor":"viewport"},this._super());},setMarkerType:function C(O){var Q=this.getPrimaryShapeLayers(),P=this.getMapInstance();if(P){H.forEach(Q,function(R){P.setLayoutProperty(R,"text-field",N(O));P.setLayoutProperty(R,"text-size",F(O));});}this.markerType=O;},getLabelOffset:function M(){return[0,3];}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer");var E=mstrmojo.emptyFn,K=1.5,F=14,G=0.7;mstrmojo.gmaps.layer.mapbox.ImageLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.mapbox.ImageLayerViewer",type:"symbol",markerType:null,shapeFmtNames:{fillOpacity:"icon-opacity"},imgId:null,imgUrl:"../images/balloonpp.png",getExtraSourceProps:function C(){return{buffer:30};},getLayout:function B(){return{"icon-image":this.getIconImg(),"icon-size":G,"icon-allow-overlap":true,"icon-offset":[0,-F]};},getLayoutContextMenu:function I(){return this.getLayoutSelection();},getLayoutHover:function I(){return this.getLayoutSelection();},getLayoutSelection:function A(){return{"icon-image":this.getIconImg(),"icon-size":G*K,"icon-allow-overlap":true,"icon-offset":[0,-F]};},getFillOpacity:function H(){return this.getFillOpacityForZoomAnimation(1);},getPaintContextMenu:E,getIconImg:function D(){return this.execMethodOfParent("hasImgThreshold")?"{imgUrl}":this.getIconInStudio(this.imgUrl);},getLabelOffset:function J(){return[0,10];}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer");var A=mstrmojo,H=A.hash,C=5;mstrmojo.gmaps.layer.mapbox.CircleLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.mapbox.GraphicLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.mapbox.CircleLayerViewer",type:"circle",shapeFmtNames:{fillColor:"circle-color",fillOpacity:"circle-opacity",strokeColor:"circle-stroke-color",strokeWidth:"circle-stroke-width"},getExtraSourceProps:function F(){return{buffer:0};},getCircleRadius:function B(){return this.hasSizeby()?{type:"identity",property:"radius"}:C;},getPaint:function D(){return H.copy({"circle-radius":this.getCircleRadius()},this._super());},extractShapeProps:function E(I){return H.copy({radius:I.radius},this._super(I));},getLabelOffset:function G(I){if(I){return[0,I.radius];}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.ui.menus.MenuConfig","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.tooltip","mstrmojo.Button","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapSearchWidget","mstrmojo.gmaps.MapLayerControlList","mstrmojo.gmaps.layer.LassoLayer");mstrmojo.requiresDescs(1158,8218,10372,1442,221,10979,10980,10981,9879,9876,9881);var l=mstrmojo,V=l.dom,m=l.array,G=l.css,AC=l.tooltip,O=l.gmaps,E=O.MapUtils,e=O.layer.LassoLayer,J=O.EnumPropertyType,t=O.EnumGraphicType,j=O.EnumToolbarButtonType,A=O.EnumToolbarState,B=O.MapSearchWidget,i=O.MapLayerControlList;var H="30px",Q=96,D=200;mstrmojo.gmaps.MapToolbar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui._HasScroller,mstrmojo._HasPopup],{scriptClass:"mstrmojo.gmaps.MapToolbar",markupString:'<div id="{@id}-toolbarwrapper" class="toolbarBoxWrapper mstrMapToolBarBox" mstrAttach:scroll><div class="map-toolbar-selection map-toolbar-item"></div><div class="map-toolbar-edtInfoWin map-toolbar-item"></div><div class="map-toolbar-searchbar map-toolbar-item" mstrAttach:mousedown></div><div class="map-toolbar-layerCtrl map-toolbar-item"></div><div class="map-toolbar-styleCtrl map-toolbar-item"></div></div>',markupSlots:{selectionBarNode:function(){return this.domNode.firstChild;},edtInfoWinNode:function(){return this.domNode.childNodes[1];},searchBarNode:function(){return this.domNode.childNodes[2];},layerCtrlNode:function(){return this.domNode.childNodes[3];},styleCtrlNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},layoutConfig:{h:{selectionBarNode:H,edtInfoWinNode:H,layerCtrlNode:H,styleCtrlNode:H},w:{selectionBarNode:"auto",edtInfoWinNode:"auto",searchBarNode:D+"px",layerCtrlNode:"auto",styleCtrlNode:"auto"}},BTNCOUNT:13,TOOLBAR_HEIGHT:"30px",mapStyleData:null,lassoLayer:null,parent:null,map:null,init:function z(AD){this._super(AD);this.initComponents();},initComponents:function v(){var AD=this.map;this.initSelectionBar();this.initInfoWinEdtBtn();this.initSearchBar();if(AD&&!AD.isInFilterPanel()){this.initLayerCtrl();}this.initMapStyleCtrl();},setVisibility:function b(AD){if(this.domNode&&E.checkDefined(this.domNode.style)){this.domNode.style.display=(!!AD)?"block":"none";}},postBuildRendering:function Z(){this._super();var AD=this.map&&this.map.toolBarDiv;if(!!AD&&!!this.domNode){AD.appendChild(this.domNode);this.set("height",H);}this.refreshMapStyleCtrl();},update:function n(){this.refreshMapStyleCtrl();this.refreshSearchBar();},preRefresh:function o(){var AD=this.searchBar;return AD&&AD.isFocus();},resize:function Y(){var AD=this.map&&this.map.toolBarDiv,AE=this.domNode;if(!!AD&&!AD.contains(AE)){AD.appendChild(AE);}this.refreshSearchBar();},inSelectionState:function w(){var AD=parseInt(this.state,10);return AD===A.SINGLE_SELECT||AD===A.RECTANGLE_SELECT||AD===A.FREE_SELECT||AD===A.CIRCLE_SELECT;},onstateChange:function f(){var AH=this.parent,AJ=parseInt(this.state,10),AF=this.selectionBar,AD=this.layerCtrl&&this.layerCtrl.layerSelectorList,AG,AE,AK,AI;if(!AH||!AF){return ;}AG=AF.rectSelect;if(AG){AG.set("enabled",AJ===A.NORMAL||AJ===A.RECTANGLE_SELECT);AG.set("selected",AJ===A.RECTANGLE_SELECT);}AE=AF.circleSelect;if(AE){AE.set("enabled",AJ===A.NORMAL||AJ===A.CIRCLE_SELECT);AE.set("selected",AJ===A.CIRCLE_SELECT);}AK=AF.freeSelect;if(AK){AK.set("enabled",AJ===A.NORMAL||AJ===A.FREE_SELECT);AK.set("selected",AJ===A.FREE_SELECT);}AI=AF.clearAll;if(AI){AI.set("enabled",AJ===A.NORMAL||AJ===A.CLEAR_ALL);AI.set("selected",AJ===A.CLEAR_ALL);}if(AD){AD.set("enabled",AJ===A.NORMAL||AJ===A.LAYERS_SELECT);AD.set("selected",AJ===A.LAYERS_SELECT);}AH.set("enablePopup",AJ===A.NORMAL);},initSelectionBar:function AA(){var AE=this,AD=mstrmojo.insert({alias:"selectionBar",scriptClass:"mstrmojo.HBox",slot:"selectionBarNode",buttonCount:AE.BTNCOUNT,defaultButtonCount:AE.BTNCOUNT,state:A.NORMAL,barLength:520,children:[AE.getSelectionBtn("rectSelect","mstrtbMapRectangleSearch",mstrmojo.desc(10979,"Rectangular selection tool"),j.RECTANGLE_SELECT,A.RECTANGLE_SELECT),AE.getSelectionBtn("circleSelect","mstrtbMapCircleSelectButton",mstrmojo.desc(10980,"Circular selection tool"),j.CIRCLE_SELECT,A.CIRCLE_SELECT),AE.getSelectionBtn("freeSelect","mstrtbMapFreeSelectButton",mstrmojo.desc(10981,"Freeform selection tool"),j.FREE_SELECT,A.FREE_SELECT),AE.getClearSelectionBtn()]});this.addChildren(AD);},getSelectionBtn:function k(AH,AD,AJ,AG,AE){var AI=this;return{alias:AH,scriptClass:"mstrmojo.Button",iconClass:AD,tooltipContent:AJ,updateTooltipConfig:AI.updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:AG,onclick:function AF(){AI.onClickSelectionBar(this,AE);}};},getClearSelectionBtn:function T(){var AE=this;return{alias:"clearAll",scriptClass:"mstrmojo.Pulldown",popupToBody:true,cssClass:"mstrtbMapClearAll",height:H,tooltipContent:mstrmojo.desc(9879,"Remove selections"),updateTooltipConfig:AE.updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:j.CLEAR_ALL,onmousedown:function AD(){var AF=AE.parent;if(AF&&AF.hideInfoWindow instanceof Function){AF.hideInfoWindow();}this.set("selected",!this.selected);AE.set("state",this.selected?A.CLEAR_ALL:A.NORMAL);},popupRef:AE.createClearSelectionPopupRef(mstrmojo.desc(9876,"Are you sure you wish to remove all selections?"),mstrmojo.desc(1442,"OK"),function(){var AG=AE.map;if(!!AG&&AG.clearSelections instanceof Function){var AF=AG.mapViewer;AG.clearSelections(true);AG.endSelections();AG.handleTemplateUnitSelections();if(AF){AF.highlightAllLayers();}}AE.set("state",A.NORMAL);})};},onClickSelectionBar:function F(AD,AF){var AG=this.parent,AE=this.selectionBar;if(!AG||!AE){return ;}if(!AD.selected){this.set("state",AF);AG.set("enablePopup",false);AG.set("infoWindowVisible",false);this.appendLassoLayer();}else{this.resetSelectionState();}if(AG.hideInfoWindow instanceof Function){AG.hideInfoWindow();}window.clearTimeout(this.timer);},initInfoWinEdtBtn:function I(){var AF=this,AG=this.map,AE;if(!AG||E.isVI()){return ;}AE=mstrmojo.insert({alias:"edtInfoWin",slot:"edtInfoWinNode",scriptClass:"mstrmojo.Button",iconClass:"mstrtbMapCustomizeInfoWindow",cssDisplay:"table",tooltipContent:mstrmojo.desc(8218,"Edit custom infoWindow"),updateTooltipConfig:this.updateButtonTooltipConfig,useRichTooltip:true,toolbarButtonType:j.EDIT_INFO_WINDOW,onclick:function AD(){var AH=AF.parent;if(!!AH&&AH.hideInfoWindow instanceof Function){AH.hideInfoWindow();}AF.openPopup(AF.getInfoWinEdtPopupRef());}});this.addChildren(AE);},getInfoWinEdtPopupRef:function a(){var AE=this;return{scriptClass:"mstrmojo.Editor",contentNodeCssClass:"mstrmojo-balloon",alias:"infoWinEditor",title:mstrmojo.desc(8218,"Edit custom infoWindow"),left:"100px",top:"100px",width:"200px",locksHover:true,onOpen:function(){var AJ=this.opener.domNode,AF=V.position(AJ),AI=AF.y+50,AH=AF.x+100,AG=this.gridSelectorHBox.gridSelector;this.set("top",AI+"px");this.set("left",AH+"px");this.editorNode.style.width="300px";this.editorNode.style.zIndex=9999;AG.previousSelection=AG.items[0];},children:[{alias:"gridSelectorHBox",scriptClass:"mstrmojo.HBox",halign:"left",cssText:"margin:3px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(10372,"Select a Grid: "),align:"left"},{alias:"gridSelector",scriptClass:"mstrmojo.SelectBox",bindings:{items:function(){return AE.getLayerCtrlList(true);}},size:1,selectedIndex:0,previousSelection:null,cssText:"white-space: nowrap; width: 200px",onchange:function AD(){if(!this.selectedItem){return ;}var AG=this.parent.parent.opener.parent,AH=this.selectedItem.id,AF=AG.getGraphicLayer(AH);if(this.previousSelection){this.previousSelection.htmlVal=this.parent.parent.desc.value;}this.parent.parent.desc.set("value",AF.getInfoWindowHTML());this.previousSelection=this.selectedItem;}}]},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",alias:"desc",bindings:{value:function(){if(!this.parent.opener){return"";}else{var AF=this.parent.opener.parent,AG=AF&&AF.getGraphicLayerByIdx(0);return AG.getInfoWindowHTML();}}},maxLength:1024,cols:80,rows:7},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.HTMLButton",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-Editor-button",onclick:function(){var AK=this.parent.parent.gridSelectorHBox.gridSelector,AG=AK.items,AI=this.parent.parent.opener.parent,AJ=AI&&AI.parent,AF={},AH={};if(!AJ){return ;}AK.previousSelection.htmlVal=this.parent.parent.desc.value;m.forEach(AG,function(AO){var AN=AO&&AO.id,AM,AL,AP;if(AN){AM=AI.getGraphicLayer(AN);AL=AM.getInfoWindowHTML();AP=AO.htmlVal;if(E.checkDefined(AP)&&AP!==AL){AF[AN]={value:AL};AH[AN]={value:AO.htmlVal};}}});this.parent.parent.close();AJ.saveGraphicLayerInfoHTML(AF,AH);}},{scriptClass:"mstrmojo.HTMLButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-Editor-button",onclick:function(){this.parent.parent.close();}}]},{alias:"editInfoWindowTriangle",scriptClass:"mstrmojo.Label",cssClass:"editInfoWindowTriangle"}]};},initSearchBar:function P(){var AD=this;this.addChildren(new B({slot:"searchBarNode",alias:"searchBar",suggestionSource:AD.getBaseLayer()}));},refreshSearchBar:function U(){if(this.searchBar){this.searchBar.suggestionSource=this.getBaseLayer();}var AH=this.searchBarNode,AI=function(AQ){if(!AQ){return 0;}var AP=G.getComputedStyle(AQ);return parseInt(AP.paddingLeft,10)+parseInt(AP.paddingRight,10);},AO=AI(AH),AM=AI(this.domNode),AL=this.map.getWidth(),AG=this.selectionBarNode.offsetWidth,AJ=this.layerCtrlNode.offsetWidth,AK=this.styleCtrlNode.offsetWidth,AF=AH.offsetWidth,AE=AL-(AG+AJ+AK)-AM,AN=AE-AO,AD=AH.style;if(AF>AE){AD.width=Math.max(Q,AN)+"px";}else{AD.width=Math.min(D,AN)+"px";}},initLayerCtrl:function r(){var AF=this,AG=this.map,AE;if(!!AG){AE=((parseInt(AG.height)-parseInt(H))*0.9)+"px";}this.addChildren(mstrmojo.insert({alias:"layerCtrl",slot:"layerCtrlNode",scriptClass:"mstrmojo.HBox",height:H,children:[{alias:"layerSelectorList",scriptClass:"mstrmojo.Pulldown",popupToBody:true,cssClass:"mstrtbMapGridSelector",height:H,tooltipContent:mstrmojo.desc(9881,"Multiple grids"),updateTooltipConfig:AF.updateButtonTooltipConfig,enabled:true,toolbarButtonType:j.LAYERS_SELECT,layerCtrlList:null,onmousedown:function AD(){var AI=AF.parent,AH=this.layerCtrlList;if(AI&&(AI.hideInfoWindow instanceof Function)){AI.hideInfoWindow();}this.set("selected",!this.selected);if(AH&&AH.destroy instanceof Function){AH.destroy();}delete this.layerCtrlList;this.closePopup();this.layerCtrlList=new i({sourceToolbar:AF,maxHeight:AE});this.openPopup(this.layerCtrlList);}}]}));},initMapStyleCtrl:function s(){this.addChildren(mstrmojo.insert({alias:"mapStyleCtrl",slot:"styleCtrlNode",scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",height:H}));},refreshMapStyleCtrl:function N(){var AD=this.mapStyleCtrl,AE=new mstrmojo.ui.menus.ToolbarConfig(),AG=this._getMapStyleMenuConfig(),AF;if(!AD){return ;}AF=AD.toolbarCfg;if(AF){AD.toolbarCfg=null;if(AF.destroy instanceof Function){AF.destroy();}}if(!!AG){AE.addDisposable(AG);AE.addMenuToolbarBtn(mstrmojo.desc(4157,"STYLES"),"mapStyleSelectVBox",AG);}AD.set("toolbarCfg",AE);AD.render();},_getMapStyleMenuConfig:function AB(){var AH=new mstrmojo.ui.menus.MenuConfig(),AL=this._getMapStyleData(),AI=this,AK=function(AN){return function(){var AO="{@cls}"+(AN?" selected":"");return'<div class="'+AO+'" idx="{@idx}"><div class="label">{@en@n}</div><div class="state">'+mstrmojo.desc(514,"Selected")+"</div></div>";};},AM=function(AN){return function(){var AO=AI.map;if(E.checkDefined(AN)&&E.checkHasFunction(AO,"writeProperties")){AO.writeProperties(J.mapStyle,AN);}};},AD,AG,AF,AE,AJ;if(!AL||!m.isArray(AL)||AL.length<1){return ;}AH.menuCssClass=this.getStyleCssClassName("mapStylesMenu");AH.isHostedWithin=false;for(AE=0,AJ=AL.length;AE<AJ;AE++){AD=AL[AE];AG=AD.v;AF=AD.n;AH.addCustomMenuItem(AF,"CSS"+AD.type+(AD.id||AE),AM(AG),AK(AD.selected));}return AH;},_getMapStyleData:function C(){var AD=this.getBaseLayer();if(AD&&AD.getMapStyleData instanceof Function){return AD.getMapStyleData();}},getBaseLayer:function p(){return this.parent&&this.parent.baseLayer;},appendLassoLayer:function q(){this.lassoLayer=new e({parent:this.parent,selectionType:this.state});},removeLassoLayer:function y(){var AD=this.lassoLayer;if(AD&&AD.destroy instanceof Function){AD.destroy();}delete this.lassoLayer;},updateButtonTooltipConfig:function R(){var AD=V.position(this.domNode);this.richTooltip={content:this.tooltipContent,cssClass:"vi-regular vi-tooltip-A",posType:AC.POS_TOPLEFT,top:AD.y+AD.h+3,left:AD.x};},createClearSelectionPopupRef:function W(AG,AH,AI,AD){var AF=this;return{alias:"messagePopup",scriptClass:"mstrmojo.Popup",cssClass:"messagePopupWindow",slot:"popupNode",locksHover:false,autoCloses:false,children:[{alias:"popupLabel",scriptClass:"mstrmojo.Label",cssClass:"messageLabel",text:AG},{alias:"popupVBox",scriptClass:"mstrmojo.HBox",children:[{alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:E.isVI()?"messageBoxOkButton mstrmojo-WebButton hot":"messageBoxOkButton-nonVI",text:AH,bindings:{popup:"this.parent.parent"},onclick:function AE(){AI.call(this);this.popup.close();}},{alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:E.isVI()?"messageBoxCancelButton mstrmojo-WebButton":"messageBoxCancelButton-nonVI",text:mstrmojo.desc(221,"Cancel"),bindings:{popup:"this.parent.parent"},onclick:function AE(){if(AD){AD.call(this);}else{AF.set("state",A.NORMAL);}this.popup.close();}}]}]};},getStyleCssClassName:function h(AD){var AE=E.getThemeClass();if(E.checkDefined(AE)){AD+=AE;}return AD;},getLayerCtrlList:function X(AD){var AJ=[],AF=this.parent,AL=this.map&&this.map.layerIdxMappingArr,AK,AI,AH,AG,AE;if(!AF||!m.isArray(AL)||AL.length<1){console.log("getLayerCtrlList(): no graphic layer found");return AJ;}for(AG=0,AE=AL.length;AG<AE;AG++){AK=AL[AG];AI=AF.getGraphicLayer(AK);if(AI){AH={v:AG,id:AK,n:AI.getLayerName(),metrics:[],isVisible:AI.isVisible(),getLayerKey:function(){return this.id;}};AJ.push(AH);}}if(AD!==true){this.addMetricsToLayerItems(AJ);}return AJ;},addMetricsToLayerItems:function d(AE){if(E.isVI()||!m.isArray(AE)){return ;}var AF=this.parent,AD=function(AO){var AN=AO.getData(),AS=AO.key,AQ=AN.eg===undefined&&AO.getDataColTitles(),AP=[],AU=mstrmojo.desc(1158,"Metrics"),AI,AT,AJ,AM,AR,AK,AL;if(!AQ||AQ.length<1){return AP;}for(AM=0,AR=AQ.size();AM<AR;AM++){AI=AQ.getTitle(AM);if(AI.getName()==AU){AT=AI.getHeaderValues();for(AK=0,AL=AT.length;AK<AL;AK++){AJ={v:AK,n:AT[AK].n,id:AT[AK].id,layerKey:AS};AP.push(AJ);}break;}}return AP;},AG,AH;m.forEach(AE,function(AI){AG=AI&&AI.getLayerKey();AH=AF.getGraphicLayer(AG);if(AH&&AH.graphicType!==t.Density){AI.metrics=AD(AH);}});},onselectedMetricIdxChange:function K(AG,AE,AF){var AH=this.getGraphicLayer(AG),AD=this.parent;if(AH){AH.handleMetricSelectionChange(AE,AF);}if(AD){AD.highlightAllLayers();}},getLayerSelectedMetricIdx:function g(AE){var AD=this.getGraphicLayer(AE);if(AD&&AD.getSelectedMetricIdx instanceof Function){return AD.getSelectedMetricIdx();}},getGraphicLayer:function M(AE){var AD=this.parent;if(AD&&AD.getGraphicLayer instanceof Function){return AD.getGraphicLayer(AE);}},setLayerVisibility:function c(AE,AD){var AF=AD?"0":"1",AG=this.map;if(AG&&AE){AG.writeProperties(J.isHidden,AF,AE);}},submitLayerVisibleChanges:function u(AD,AE){var AF=this.map;if(AF){AF.saveGraphicLayerVisibleInfo(AD,AE);}},resetSelectionState:function S(){var AD=this.parent;if(!AD){return ;}this.set("state",A.NORMAL);AD.set("enablePopup",true);AD.set("infoWindowVisible",true);this.removeLassoLayer();},destroy:function x(){delete this.parent;delete this.map;this._super();}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.ui.menus.MenuConfig","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.tooltip","mstrmojo.Button","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapSearchWidget","mstrmojo.gmaps.MapLayerControlListNew","mstrmojo.gmaps.MapMoreControls","mstrmojo.gmaps.layer.LassoLayer","mstrmojo.hash");mstrmojo.requiresDescs(1158,8218,10372,1442,221,10979,10980,10981,9879,9876,9881,5567,15636,15752,15753);var n=mstrmojo,Y=n.dom,H=n.css,o=n.array,AM=n.tooltip,S=n.gmaps,F=S.MapUtils,h=S.layer.LassoLayer,M=S.EnumPropertyType,AC=S.EnumGraphicType,l=S.EnumToolbarButtonType,A=S.EnumToolbarState,B=S.MapSearchWidget,y=S.MapLayerControlListNew,E=S.MapMoreControls,s=n.vi.viz.EnumDSSDropZones,Z=n.hash;var J="28px";mstrmojo.gmaps.MapToolbarNew=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.gmaps.MapToolbarNew",markupString:'<div id="{@id}-toolbarwrapper" class="mstrMapToolBarBoxNew"><div class="map-toolbar-searchbar" mstrAttach:mousedown></div><div class="map-toolbar-mapCtrlBar"><div class="map-toolbar-selection"></div><div class="map-toolbar-ctrl map-toolbar-layerCtrl"></div><div class="map-toolbar-ctrl map-toolbar-styleCtrl"></div><div class="map-toolbar-ctrl map-toolbar-moreCtrl"></div></div><div class="mapboxgl-ctrl-bottom-right"><div></div><div class="mapboxgl-ctrl mapboxgl-ctrl-group" style="width: 28px"><div style="height: 28px"></div><div style="height: 28px"></div><div style="height: 28px"></div></div></div></div>',markupSlots:{searchBarNode:function(){return this.domNode.firstChild;},mapCtrlNode:function(){return this.domNode.childNodes[1];},selectionBarNode:function(){return this.domNode.childNodes[1].childNodes[0];},layerCtrlNode:function(){return this.domNode.childNodes[1].childNodes[1];},styleCtrlNode:function(){return this.domNode.childNodes[1].childNodes[2];},moreCtrlNode:function(){return this.domNode.childNodes[1].childNodes[3];},bottomRightNode:function(){return this.domNode.childNodes[2];},resetBtnNode:function(){return this.domNode.childNodes[2].childNodes[0];},zoomInBtnNode:function(){return this.domNode.childNodes[2].childNodes[1].childNodes[0];},zoomOutBtnNode:function(){return this.domNode.childNodes[2].childNodes[1].childNodes[1];},compassBtnNode:function(){return this.domNode.childNodes[2].childNodes[1].childNodes[2];}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},mapStyleData:null,lassoLayer:null,parent:null,map:null,mapStyleMenu:null,init:function AJ(AN){this._super(AN);this.initComponents();},initComponents:function AE(){this.initSearchBar();this.initMapCtrlBar();this.initBottomRightBar();},initSearchBar:function T(){var AN=this;this.addChildren(new B({slot:"searchBarNode",alias:"searchBar",suggestionSource:AN.getBaseLayer()}));},initMapCtrlBar:function u(){this.initMapStyleCtrl();this.initSelectionBar();this.initLayerCtrl();this.initMoreCtrl();},initBottomRightBar:function q(){this.initBottomRightBtn("resetBtn","resetBtnNode","mapboxgl-ctrl mapboxgl-ctrl-reset",15752,"Reset view");this.initBottomRightBtn("zoomInBtn","zoomInBtnNode","mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in",5567,"Zoom in");this.initBottomRightBtn("zoomOutBtn","zoomOutBtnNode","mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out",15636,"Zoom out");this.initCompassBtn();},initBottomRightBtn:function f(AQ,AT,AN,AR,AS){var AP=mstrmojo.insert({alias:AQ,slot:AT,scriptClass:"mstrmojo.Button",iconClass:AN,getTooltipContent:function(){return mstrmojo.desc(AR,AS);},updateTooltipConfig:this.updateBottomRightTooltipConfig,useRichTooltip:true,enabled:true,onclick:function AO(){var AV=Z.walk("parent.map.domNode",this),AW=AV&&AV.getElementsByClassName(AN)[1];if(AW){var AU=document.createEvent("MouseEvents");AU.initEvent("click",true,false);AW.dispatchEvent(AU);}}});this.addChildren(AP);},initCompassBtn:function K(){var AN=mstrmojo.insert({alias:"compassBtn",slot:"compassBtnNode",scriptClass:"mstrmojo.Button",iconClass:"mapboxgl-ctrl-icon mapboxgl-ctrl-compass",getTooltipContent:function(){return mstrmojo.desc(15753,"Rotate and Tilt");},updateTooltipConfig:this.updateBottomRightTooltipConfig,useRichTooltip:true,enabled:true});this.addChildren(AN);},setVisibility:function d(AN){if(this.domNode&&F.checkDefined(this.domNode.style)){this.domNode.style.display=(!!AN)?"block":"none";}},postBuildRendering:function c(){this._super();var AN=this.map&&this.map.toolBarDiv;if(!!AN&&!!this.domNode){AN.appendChild(this.domNode);}this.updateToolbarStyle();this.refreshMapStyleCtrl();},updateToolbarStyle:function g(){this.updateSearchBarStyle();this.updateMapCtrlStyle();this.updateBottomRightStyle();},updateSearchBarStyle:function P(){var AO=this.map,AP=this.searchBar,AN=AO&&AO.isTitleBarVisible();if(!AN){this.searchBarNode.style.top="24px";}else{this.searchBarNode.style.top="3px";}if(AP){AP.updatePopupPosition();}},updateMapCtrlStyle:function z(){var AP=this.map,AN=AP&&AP.getHeight(),AO=this.mapCtrlNode,AQ=this.layerCtrlNode;if(AN&&AO){AO.style.bottom=-(AN-6)+"px";}},updateBottomRightStyle:function x(){var AP=this.map,AO=AP&&AP.getHeight(),AN=this.bottomRightNode;if(AO&&AN){AN.style.bottom=-AO+"px";}},update:function p(){this.refreshMapStyleCtrl();this.refreshSearchBar();},preRefresh:function r(){var AN=this.searchBar;return AN&&AN.isFocus();},resize:function b(){var AN=this.map&&this.map.toolBarDiv,AO=this.domNode;if(!!AN&&!AN.contains(AO)){AN.appendChild(AO);}this.updateToolbarStyle();},inSelectionState:function AF(){var AN=parseInt(this.state,10);return AN===A.SINGLE_SELECT||AN===A.RECTANGLE_SELECT||AN===A.FREE_SELECT||AN===A.CIRCLE_SELECT;},onstateChange:function i(){var AR=this.parent,AS=parseInt(this.state,10),AP=this.selectionBar,AN=this.layerCtrl&&this.layerCtrl.layerSelectorList,AQ,AO,AT;if(!AR||!AP){return ;}AQ=AP.rectSelect;if(AQ){AQ.set("selected",AS===A.RECTANGLE_SELECT);}AO=AP.circleSelect;if(AO){AO.set("selected",AS===A.CIRCLE_SELECT);}AT=AP.freeSelect;if(AT){AT.set("selected",AS===A.FREE_SELECT);}if(AN){AN.set("selected",AS===A.LAYERS_SELECT);}AR.set("enablePopup",AS===A.NORMAL);if(!this.inSelectionState()){this.removeLassoLayer();}},initSelectionBar:function AI(){var AO=this,AN=mstrmojo.insert({alias:"selectionBar",scriptClass:"mstrmojo.HBox",slot:"selectionBarNode",state:A.NORMAL,children:[AO.getSelectionBtn("rectSelect","mstrtbMapRectangleSearch",mstrmojo.desc(15641,"Box Select"),l.RECTANGLE_SELECT,A.RECTANGLE_SELECT),AO.getSelectionBtn("freeSelect","mstrtbMapFreeSelectButton",mstrmojo.desc(15642,"Lasso Select"),l.FREE_SELECT,A.FREE_SELECT),AO.getSelectionBtn("circleSelect","mstrtbMapCircleSelectButton",mstrmojo.desc(15711,"Range Select"),l.CIRCLE_SELECT,A.CIRCLE_SELECT)]});this.addChildren(AN);},getSelectionBtn:function m(AR,AN,AT,AQ,AO){var AS=this;return{alias:AR,scriptClass:"mstrmojo.Button",iconClass:"map-toolbar-ctrl "+AN,getTooltipContent:function(){return this.tooltipContent;},tooltipContent:AT,updateTooltipConfig:AS.updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:AQ,onclick:function AP(){AS.onClickSelectionBar(this,AO);}};},onClickSelectionBar:function D(AN,AP){var AQ=this.parent,AO=this.selectionBar;if(!AQ||!AO){return ;}if(!AN.selected){this.set("state",AP);AQ.set("enablePopup",false);AQ.set("infoWindowVisible",false);this.appendLassoLayer();}else{this.resetSelectionState();}if(AQ.hideInfoWindow instanceof Function){AQ.hideInfoWindow();}window.clearTimeout(this.timer);},refreshSearchBar:function X(){var AN=this.searchBar;if(AN){AN.suggestionSource=this.getBaseLayer();}},initLayerCtrl:function AA(){var AP=this,AO="22px";this.addChildren(mstrmojo.insert({alias:"layerCtrl",slot:"layerCtrlNode",scriptClass:"mstrmojo.HBox",height:AO,children:[{alias:"layerSelectorList",scriptClass:"mstrmojo.Pulldown",popupToBody:true,cssClass:"mstrtbMapGridSelector",height:AO,popupZIndex:999,getTooltipContent:function(){return mstrmojo.desc(15712,"Controller on layers");},updateTooltipConfig:AP.updateButtonTooltipConfig,useRichTooltip:true,enabled:true,toolbarButtonType:l.LAYERS_SELECT,layerCtrlList:null,onmousedown:function AN(){var AR=AP.parent,AQ=this.layerCtrlList;if(F.checkHasFunction(AR,"hideInfoWindow")){AR.hideInfoWindow();}this.set("selected",!this.selected);if(F.checkHasFunction(AQ,"destroy")){AQ.destroy();}delete this.layerCtrlList;this.closePopup();this.layerCtrlList=new y({sourceToolbar:AP});this.openPopup(this.layerCtrlList);F.addArrowNode(this.layerCtrlList.domNode);}}]}));},initMoreCtrl:function G(){var AO=this;this.addChildren(mstrmojo.insert({alias:"moreCtrl",scriptClass:"mstrmojo.Pulldown",slot:"moreCtrlNode",popupToBody:true,cssClass:"moreCtrlSelector",popupZIndex:999,getTooltipContent:function(){return mstrmojo.desc(15860,"More controls");},updateTooltipConfig:AO.updateButtonTooltipConfig,useRichTooltip:true,enabled:true,moreCtrlBox:null,onmousedown:function AN(){var AQ=AO.parent,AP=this.moreCtrlBox;if(F.checkHasFunction(AQ,"hideInfoWindow")){AQ.hideInfoWindow();}this.set("selected",!this.selected);if(F.checkHasFunction(AP,"destroy")){AP.destroy();}delete this.moreCtrlBox;this.closePopup();this.moreCtrlBox=new E({sourceToolbar:AO});this.openPopup(this.moreCtrlBox);F.addArrowNode(this.moreCtrlBox.domNode);}}));},initMapStyleCtrl:function AB(){var AN=this;this.addChildren(mstrmojo.insert({alias:"mapStyleCtrl",slot:"styleCtrlNode",scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",useRichTooltip:true,getTooltipContent:function(){return this.getTooltipText();},offsetTop:18,updateTooltipConfig:this.updateButtonTooltipConfig,getTooltipText:function(){return mstrmojo.desc(15713,"Map styles");},height:J,postclick:function(){var AO=this._lastOpened;F.addArrowNode(AO&&AO.domNode);},openMenu:function(AS,AQ){var AO;AS.hostId=this.id;AS.hostElement=this._getItemNode(AQ._renderIdx);if(AS.hostElement){AS.anchorElement=AS.hostElement.childNodes[0];}this.openPopup(AS.newInstance());AO=this._lastOpened;if(AO&&AO.domNode){var AT=AO.items.length,AP=AO._getItemNode(AT-1),AR=(AT%2===0)?AO._getItemNode(AT-2):null;if(AP){AP.style.marginBottom=0;}if(AR){AR.style.marginBottom=0;}AO.domNode.style.overflow="visible";AO.domNode.style.paddingBottom="8px";}AN.setMapStyleMenuEventHandler(AO);}}));},setMapStyleMenuEventHandler:function I(AN){var AO=this,AP=AN.onmouseover,AQ=AN.onmouseout;AO.mapStyleMenu=AN;AN.onCloseMenuCallBack=function(){AO.mapStyleMenu=null;};AN.onmouseover=function(AR){var AS=AR.e.fromElement;if(AP){AP.call(AN,AR);}if(!Y.contains(this.domNode,AS,true)){AO.forceToolbarVisible();}};AN.onmouseout=function(AR){var AS=AR.e.toElement;if(AQ){AQ.call(AN,AR);}if(!Y.contains(AO.map.domNode,AS,true)&&!Y.contains(this.domNode,AS,true)){this.domNode.style.display=AO.map.isCurrentVizBoxSelected()?"":"none";AO.resetToolbarVisiblilityToCSS();}};},refreshMapStyleCtrl:function R(){var AN=this.mapStyleCtrl,AQ=new mstrmojo.ui.menus.ToolbarConfig(),AS=this._getMapStyleMenuConfig(),AR,AP=this;if(!AN){return ;}AR=AN.toolbarCfg;if(AR){AN.toolbarCfg=null;if(AR.destroy instanceof Function){AR.destroy();}}if(!!AS){AQ.addDisposable(AS);AQ.addMenuToolbarBtn("","mapStyleSelectVBox",AS);}AN.set("toolbarCfg",AQ);AN.render();if(!!AS){var AO=document.createElement("div");AO.style.width="auto";AO.style.height="20px";AO.style.top="-11px";AO.style.position="relative";AN.itemsNode.appendChild(AO);AS.anchorElement=AO;}},_getMapStyleMenuConfig:function AL(){var AR=new mstrmojo.ui.menus.MenuConfig(),AV=this._getMapStyleData(),AS=this,AU=function(){return'<div class="{@cls} test" idx="{@idx}"><div>{@en@n}</div></div>';},AW=function(AX){return function(){var AY=AS.map;if(F.checkDefined(AX)&&F.checkHasFunction(AY,"writeProperties")){AY.writeProperties(M.mapStyle,AX);}};},AN,AQ,AP,AO,AT;if(!AV||!o.isArray(AV)||AV.length<1){return ;}AR.menuCssClass=this.getStyleCssClassName("mapStylesMenuNew");AR.isHostedWithin=false;AR.supportsScroll=true;for(AO=0,AT=AV.length;AO<AT;AO++){AN=AV[AO];AQ=AN.v;AP=AN.n;AR.addCustomMenuItem(AP,"CSS"+AN.type+(AN.id||AO),AW(AQ),(function(AX){return function(){var AY="{@cls}"+(AX?" selected":"");return'<div class="'+AY+'" idx="{@idx}"><div class="label">{@en@n}</div><div class="state">'+mstrmojo.desc(514,"Selected")+"</div></div>";};})(AN.selected));}return AR;},_getMapStyleData:function C(){var AN=this.getBaseLayer();if(AN&&AN.getMapStyleData instanceof Function){return AN.getMapStyleData();}},forceToolbarVisible:function U(){this.domNode.style.display="block";this.bottomRightNode.style.display="block";},resetToolbarVisiblilityToCSS:function O(){this.domNode.style.display="";this.bottomRightNode.style.display="";},changeMapStyleMenuVisibilityWithMapToolBar:function t(AO){if(this.mapStyleCtrl&&this.mapStyleMenu){if(AO.e.type==="mouseout"){var AN=AO.e.toElement;if(Y.contains(this.mapStyleMenu.domNode,AN,true)){this.forceToolbarVisible();}else{if(!Y.contains(this.map.domNode,AN,true)){this.resetToolbarVisiblilityToCSS();this.mapStyleMenu.domNode.style.display=this.map.isCurrentVizBoxSelected()?"":"none";}}}else{if(AO.e.type==="mouseover"){this.resetToolbarVisiblilityToCSS();this.mapStyleMenu.domNode.style.display="";}}}},getBaseLayer:function v(){return this.parent&&this.parent.baseLayer;},appendLassoLayer:function w(){this.removeLassoLayer();this.lassoLayer=new h({parent:this.parent,selectionType:this.state});},removeLassoLayer:function AH(){var AN=this.lassoLayer;if(AN&&AN.destroy instanceof Function){AN.destroy();}delete this.lassoLayer;},updateButtonTooltipConfig:function V(){var AN=Y.position(this.domNode);this.richTooltip={content:this.getTooltipContent(),cssClass:"vi-regular vi-tooltip-V V-center",posType:AM.POS_TOPCENTER,top:AN.y-AN.h-(this.offsetTop||24),left:AN.x+13};},updateBottomRightTooltipConfig:function AK(){var AN=Y.position(this.domNode);this.richTooltip={content:this.getTooltipContent(),cssClass:"vi-regular vi-tooltip-D",top:AN.y-5,left:AN.x-9,posType:AM.POS_TOPRIGHT};},getStyleCssClassName:function k(AN){var AO=F.getThemeClass();if(F.checkDefined(AO)){AN+=AO;}return AN;},getLayerCtrlList:function a(){var AP=[],AQ=this.parent,AO=this.map&&this.map.layerIdxMappingArr,AR,AU,AT,AN,AS;if(!AQ||!o.isArray(AO)||AO.length<1){console.log("getLayerCtrlList(): no graphic layer found");return AP;}for(AN=0,AS=AO.length;AN<AS;AN++){AR=AO[AN];AU=AQ.getGraphicLayer(AR);if(AU){AT={v:AN,id:AR,n:AU.getLayerName(),isVisible:AU.isVisible(),isVisFilterSource:!!AU.isVisFilterSource(),dlAttr:AU.getDropZonesItem(s.GeoAttribute)||"",dlMetric:AU.hasColorByAttribute()?"":(AU.getDropZonesItem(s.ColorBy)||"")};if(AU.graphicType===AC.Marker||AU.graphicType===AC.Bubble){AT.isClustered=!!AU.isClustered;}AP.push(AT);}}return AP;},onselectedMetricIdxChange:function N(AP,AN,AO){var AQ=this.getGraphicLayer(AP);if(AQ){AQ.handleMetricSelectionChange(AN,AO);}},getLayerSelectedMetricIdx:function j(AO){var AN=this.getGraphicLayer(AO);if(AN&&AN.getSelectedMetricIdx instanceof Function){return AN.getSelectedMetricIdx();}},getGraphicLayer:function Q(AO){var AN=this.parent;if(AN&&AN.getGraphicLayer instanceof Function){return AN.getGraphicLayer(AO);}},setLayerVisibility:function e(AO,AN){var AP=AN?"0":"1",AQ=this.map;if(AQ&&AO){AQ.writeProperties(M.isHidden,AP,AO);}},submitLayerVisibleChanges:function AD(AN,AO){var AP=this.map;if(AP){AP.saveGraphicLayerVisibleInfo(AN,AO);}},resetSelectionState:function W(){var AN=this.parent;if(!AN){return ;}this.set("state",A.NORMAL);AN.set("enablePopup",true);AN.set("infoWindowVisible",true);this.removeLassoLayer();},destroy:function AG(){var AN=Z.walk("parent.baseLayer",this);if(AN){AN.detachCompassEvent();}delete this.parent;delete this.map;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer","mstrmojo.gmaps.basemap._CanLoadESRIMapScript","mstrmojo.PerformanceLogOutput");var g=mstrmojo,h=g.array,M=g.hash,C=g.gmaps.MapUtils,U="20160",u="client_credentials",B="https://www.arcgis.com/sharing/oauth2/token",k=g.PerformanceLogOutput,G=1209600,A={},O=-19971868.880408604,AA=19971868.8804085,S=-20037507.067161843,AG=20037507.067161843,D={"extent-change":"extent-change","zoom-start":"zoom-start","zoom-end":"zoom-end",load:"update-end"},V="Light Gray Map",t="Topographic Map";function Y(AI){if(!AI||AI.length<1){return ;}var AJ=[];h.forEach(AI,function(AK){AJ.push({n:AK.text,v:AK.magicKey,cls:"geo",geo:AK});});return{items:AJ};}mstrmojo.gmaps.basemap.EsriBaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BaseLayer,[mstrmojo.gmaps.basemap._CanLoadESRIMapScript],{scriptClass:"mstrmojo.gmaps.basemap.EsriBaseLayer",isOnPremise:null,esriBaseLayers:null,mapStylesCache:null,styleTitleMap:{"World Street Map":mstrmojo.desc(13821,"Street"),"Light Gray Map":mstrmojo.desc(13822,"Light gray"),"Relief Map":mstrmojo.desc(13823,"Relief"),"Topographic Map":mstrmojo.desc(11852,"Topographic"),"Physical Map":mstrmojo.desc(13824,"Physical"),"Terrain Map":mstrmojo.desc(8102,"Terrain"),"Satellite View Map":mstrmojo.desc(8068,"Satellite")},_locatorService:null,typeForThumbnail:"_ESRI_",mapOptions:null,resetExtentConfig:null,init:function AB(AI){this._super(AI);this.mapOptions={slider:!!this.showZoomBtns,minZoom:this.minZoom,maxZoom:this.maxZoom,zoom:this.defaultZoom,wrapAround180:true,smartNavigation:false};},processConfigInfo:function o(){this._super();var AP={},AO=this.map&&this.map.getMapConfig(),AM=AO&&AO.esri,AN,AL,AI,AK,AJ;if(!AM){return ;}this.isOnPremise=(AM.useESRICloud!=="1");AL=AM.pjs;for(AN in AL){if(!AN){continue;}if(AL.hasOwnProperty(AN)&&!!AL[AN].at){for(AK=0,AJ=AL[AN].at.length;AK<AJ;AK++){AI=AL[AN].at[AK];AP[AI.id]=AI;}}}this.attributeMapping=AP;},render:function e(){this.isSupport=this.checkSupport();if(this.isSupport!==true){console.log("Esri map is not supported");this.updateMapExtent();return ;}this._super();},initBaseMap:function AF(){var AJ=this,AK=this.map&&this.map.getMapConfig(),AI=AK&&AK.esri;if(!AI){return ;}C.showWait();this.setEsriConfig(AI);if(mstrmojo.esriMapLib===undefined){mstrmojo.esriMapLib={};mstrmojo.esrimap.loadScriptListeners=[];this.loadExternalScript(this.loadBaseMap,mstrmojo.esrimap);}else{if(typeof (esri)!=="undefined"){this.loadBaseMap();}else{mstrmojo.esrimap.loadScriptListeners.push({caller:AJ,method:AJ.loadBaseMap});C.hideWait();}}},loadBaseMap:function x(){try{var AI=this.getConfig();this.checkGlobalProxy(AI);this._super();C.hideWait();if(!!this.isOnPremise){this.loadOnPremiseBaseMap(AI);}else{this.loadCloudBaseMap(AI);}}catch(AJ){this.handleNoInternet();C.hideWait();}},loadOnPremiseBaseMap:function AH(AI){var AN=AI&&this.getDefaultBmForOnPremise(AI.bms),AK=this,AJ,AO,AL;if(!this.div_){return ;}if(!!AN){AO=(AN.isDyn=="1");AL=AN.value;}else{AL=null;AO=false;}if(!AL||C.trimString(AL).length===0){AJ="The map visualization has not been configured properly. Please contact your administrator to resolve this issue.";this.displayError(AJ);return ;}C.showWait();try{require(["esri/tasks/locator","dojo/_base/connect","esri/layers/layer","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/geometry/screenUtils","esri/SpatialReference"],function(){AK.mapOptions.extent=new esri.geometry.Extent(S,O,AG,AA,new esri.SpatialReference({wkid:102100}));AK._baseMap=new esri.Map(AK.div_.id,AK.mapOptions);AK.initOnPremiseBaseLayer(AL,AO);});}catch(AM){C.log(AM.stack);this.updateMapExtent();}finally{C.hideWait();}},loadCloudBaseMap:function AE(AI){try{this.createWebMap(AI);}catch(AJ){C.log(AJ.stack);this.updateMapExtent();}},createWebMap:function T(AI){var AN=this,AO=this.getDefaultWebMap(AI.webmaps),AM=AI.token,AL=false,AK,AJ;if(!!AO){AK=AO.id;AL=AO.hasOwnProperty("isPublic")&&AO.isPublic;}if((!AM||AM.length===0)&&!AL){this._fetchTokenFromESRICloud();return ;}if(!AK){C.log("No webmap id is specified in config file.");return ;}C.showWait();AJ={server:"http://www.arcgis.com/sharing/rest",token:AM,ssl:false,expires:G};require(["esri/arcgis/utils","esri/IdentityManager","esri/tasks/locator","dojo/_base/connect","esri/layers/layer","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/geometry/screenUtils","esri/SpatialReference"],function(AT,AQ){if(!AL){if(!mstrmojo.esrimap.esriTokens){mstrmojo.esrimap.esriTokens=[];}if(AM&&mstrmojo.esrimap.esriTokens.indexOf(AM)<0){AQ.registerToken(AJ);mstrmojo.esrimap.esriTokens.push(AM);}}if(mstrApp.isSingleTier){AT.arcgisUrl=AT.arcgisUrl.replace("file","http");}var AS=AN.mapDeferred,AR=AN.div_;if(!AR){C.hideWait();return ;}if(!AS){AS=AT.createMap(AK,AR.id,{mapOptions:AN.mapOptions,ignorePopups:true});AN.mapDeferred=AS;}k.endTimer("timerid_callback_mapDeferred.then");k.visPrint("ESRI mapDeferred start");var AP=k.startTimer({functionName:"EsriBaseLayer.mapDeferred.then: ",purpose:"create Map"});AS.then(function(AW){k.endTimer(AP);k.visPrint("ESRI mapDeferred end");k.startTimer({functionName:"EsriBaseLayer.mapDeferred.then: ",purpose:"time gap between mapDeferred completion and map response"},"timerid_callback_initCloudLayer");var AZ=AW.map,AX=AW.itemInfo.itemData.operationalLayers,Ab=AW.itemInfo.itemData.baseMap.baseMapLayers,AU=[],AY=AN.map&&AN.map.getMapConfig().esri,Aa=(Ab||[]).concat(AX||[]);if(!AY){C.hideWait();return ;}AN.mapStylesCache=AY.mapStylesCache;if(!AN.mapStylesCache||!(h.isArray(AN.mapStylesCache))){dojo.map(Aa,function(Ac){if(Ac&&Ac.layerObject&&(!Ac.layerObject.type||Ac.layerObject.type!=="Feature Layer")){if(!Ac.title){Ac.title=M.walk("resourceInfo.documentInfo.Title",Ac)||Ac.id;}AU.push(Ac.title);}});AN.mapStylesCache=AU;AY.mapStylesCache=AU;}AN.esriBaseLayers=Aa;AN._baseMap=AZ;AN.buildLevelInfo4Layers();AN.resetBaseLayerMaxZoom();if(AZ.loaded){k.visPrint("init ESRI Base Layer start");var AV=k.startTimer({functionName:"EsriBaseLayer.initCloudBaseLayer: ",purpose:"init ESRI Map Base Layer (setMapType, UpdateMapExtent)"});AN.initCloudBaseLayer();k.endTimer(AV);k.visPrint("init ESRI Base Layer end");k.startTimer({functionName:"EsriBaseLayer.initCloudBaseLayer: ",purpose:"time gap between initCloudBaseLayer completion and render Graphics"},"timerid_callback_handleExtentChange");}else{AN.eventListenerArr.push(dojo.connect(AZ,"onLoad",function(){AN.initCloudBaseLayer();AN.eventListenerArr.push(dojo.connect(AN.div_,"resize",AZ,function(){AZ.resize();}));}));}C.hideWait();},function(){AN.handleNoInternet();AN.updateMapExtent();C.hideWait();});});},buildLevelInfo4Layers:function l(){var AM=this.esriBaseLayers,AI=(AM&&AM.length)||0,AL={},AK,AJ,AN;for(AK=0;AK<AI;AK++){AJ=AM[AK];AN=M.walk("layerObject.tileInfo.lods",AJ);if(AN&&AN.length>0){AL[AJ.title]=AN[AN.length-1].level;}}this.layerLevels=AL;},resetBaseLayerMaxZoom:function Z(){var AP=this.layerLevels,AJ=this._baseMap,AO=this.esriBaseLayers,AI=(AO&&AO.length)||0,AM,AL,AN,AK;for(AM=0;AM<AI;AM++){AL=AO[AM];if(AL.baseMapLayer&&(!AN||AL.firstLayer)){AN=AL.title;}}if(!AN&&AI>0){AN=AO[0].title;}AK=AN&&AP[AN];if(C.checkVal(AK)&&AK<this.maxZoom){if(AJ&&AJ._params){AJ._params.maxZoom=AK;}this.maxZoom=AK;}},autoSwitchStyles:function H(AK){var AM=this.layerLevels||{},AI=this.mapStyle,AJ=this.displayStyle,AN=this.getZoom(),AL;if(!AI){return ;}if(this.isOnPremise||!AM[AI]){AL=AK;}else{if(AN<=AM[AI]){AL=AK?AK:AI;}else{if(AM[t]>=AN){AL=t;}}}if(AL&&(AJ!==AL)){this.displayStyle=this.switchESRIStyles(AL);}},initOnPremiseBaseLayer:function N(AJ,AL){var AK=this._baseMap,AI=this;if(!AK||!AJ){return ;}this.baseLayer=AL?new esri.layers.ArcGISDynamicMapServiceLayer(AJ):new esri.layers.ArcGISTiledMapServiceLayer(AJ);AK.addLayer(this.baseLayer);this.addEventListeners(D);this.eventListenerArr.push(dojo.connect(AK,"onLoad",this,function(){AI.updateMapExtent();}));},initCloudBaseLayer:function n(){var AJ=this.map&&this.map.getProperties(),AI=AJ&&AJ.dv;this.setMapStyle(AI);this.addEventListeners(D);this.updateMapExtent();},setExtent:function p(AI,AJ,AM){if(!AI){return ;}this._super(AI);var AK=new esri.geometry.Extent({xmin:AI.lngWest,ymin:AI.latSouth,xmax:(AI.lngEast<0&&AI.lngWest>0)?AI.lngEast+360:AI.lngEast,ymax:AI.latNorth,spatialReference:this.wgs84SP}),AL=this._baseMap;if(AJ&&this.checkExtentMinEqual(AK)){this.resetExtentConfig=AI;}if(AL&&AL.setExtent instanceof Function){AL.setExtent(AK,!AM);}},checkExtentMinEqual:function(AJ){var AL=this._baseMap,AM=AL.extent,AK,AI=function(AN){return Math.round(1000000*AN);};if(C.checkHasFunction(AL,"_fixExtent")&&C.checkHasFunction(AL,"_convertGeometry")){AK=AL._fixExtent(AL._convertGeometry(AL,AJ),true);AK=AK&&AK.extent;}return !!(AK&&AM&&AI(AM.xmin)===AI(AK.xmin));},setCenter:function j(AJ){if(!this._baseMap||!AJ||!AJ.lat||!AJ.lng){return ;}var AI=new esri.geometry.Point(AJ.lng,AJ.lat);this._baseMap.centerAt(AI);},centerAndZoom:function F(AJ,AK){if(this._baseMap&&AJ&&C.checkVal(AJ.lat)&&C.checkVal(AJ.lng)&&C.checkVal(AK)){var AI=new esri.geometry.Point(AJ.lng,AJ.lat);this._baseMap.centerAndZoom(AI,parseInt(AK));}},canUpdateLayers:function q(){var AI=this.parent;return !!(AI&&!AI.isMouseDown);},getMapStyles:function R(){var AM=[],AI=this.mapStylesCache,AL=this.styleTitleMap,AN,AK,AJ;if(this.isOnPremise!==true&&AL&&AI&&h.isArray(AI)){AL=this.styleTitleMap;for(AK=0,AJ=AI.length;AK<AJ;AK++){AN=AI[AK];AM.push({n:AL[AN]?AL[AN]:AN,id:AN});}}return AM;},isStyleExist:function r(AI){return h.find(this.esriBaseLayers,"title",AI)>=0;},getDefaultMapStyle:function s(){var AI=this.esriBaseLayers;if(AI&&AI[1]&&(AI[1].title===V)){return V;}return AI&&AI[0]&&AI[0].title;},getDefaultStyleIdx:function AD(){var AI=this.esriBaseLayers;if(AI&&AI[1]&&(AI[1].title===V)){return 1;}return 0;},checkGlobalProxy:function P(AI){var AJ,AK;if(this.isOnPremise){AK=AI&&this.getDefaultBmForOnPremise(AI.bms);}if(!!AI&&!!AI.proxyURLs&&AI.proxyURLs.length>0){AJ=AI.proxyURLs[0];esri.config.defaults.io.proxyUrl=AJ.value;esri.config.defaults.io.alwaysUseProxy=(AJ.alwaysUse==="true");}else{if(!!AK&&!!AK.proxyURL&&C.trimString(AK.proxyURL).length>0){esri.config.defaults.io.proxyUrl=AK.proxyURL;esri.config.defaults.io.alwaysUseProxy=true;}else{if(C.isAsp()){esri.config.defaults.io.proxyUrl="../asp/esriproxy.ashx";}else{esri.config.defaults.io.proxyUrl="../jsp/esriproxy.jsp";}esri.config.defaults.io.alwaysUseProxy=false;}}},switchESRIStyles:function(AN){var AP=this.esriBaseLayers,AO=this._baseMap,AI=this.baseLayer,AM=function(AQ,AR){if(AQ){AQ.setVisibility(AR);AQ.setOpacity(AR?1:0);}},AL,AK,AJ;if(!AO){return ;}for(AK=0,AJ=AP.length;AK<AJ;AK++){AL=AP[AK];if(AL.title===AN){AI=AL.layerObject;}else{if(!AL.layerObject.type||AL.layerObject.type!=="Feature Layer"){AM(AL.layerObject,false);}}}if(AI){this.baseLayer=AI;}else{if(AP[0]){this.baseLayer=AP[0].layerObject;AN=AP[0].title;}}AM(this.baseLayer,true);return AN;},setMapStyle:function K(AI){if(!AI||!this.isStyleExist(AI)){this.mapStyle=this.switchESRIStyles();this.displayStyle=this.mapStyle;}else{this.mapStyle=AI;this.autoSwitchStyles(AI);}this.updateMapToolbar();},getViewport:function(){var AI=this.getNode();try{AI=AI&&AI.firstChild.firstChild;return AI&&AI.style.clip||null;}catch(AJ){console.log("failed to get clip from esri container node");return this._super();}},handleExtentChange:function c(){this._super();var AI=this.baseLayer;if(!AI){return ;}if(!AI.visible){AI.setVisibility(true);}if(AI.opacity!==1){AI.setOpacity(1);}},panBy:function f(AP,AM,AL){var AO=this._baseMap,AJ=AO&&AO.navigationManager,AI=C.createMouseEvt("mousedown"),AK,AN;if(!AJ||!AM||!AL||!C.checkVal(AM.x)||!C.checkVal(AM.y)||!C.checkVal(AL.x)||!C.checkVal(AL.y)){return ;}AK=new esri.geometry.ScreenPoint(AM.x,AM.y);AN=new esri.geometry.ScreenPoint(AL.x,AL.y);AI.screenPoint=AK;AJ._panInit(AI);AJ._panStart({screenPoint:AK});AJ._pan({screenPoint:AN});AJ._panEnd({screenPoint:AN});},handleMouseWheel:function y(AL){var AI=AL&&AL.position,AK=this._baseMap,AJ;if(!AI||!C.checkVal(AI.x)||!C.checkVal(AI.y)||!C.checkVal(AL.zoomDelta)||!AK){console.log("EsriBaseLayer.handleMouseWheel(): invalid params.");return ;}AJ=new esri.geometry.ScreenPoint(AI);AK._extentUtil({numLevels:AL.zoomDelta,screenAnchor:AJ,mapAnchor:AK.toMap(AJ)});},getLngLatCenter:function E(){var AJ=this._baseMap&&this._baseMap.extent.getCenter(),AI;if(!AJ){return ;}AI=esri.geometry.xyToLngLat(AJ.x,AJ.y);return !!AI&&{lng:AI[0],lat:AI[1]};},getDefaultBmForOnPremise:function i(AK){var AL,AJ,AI;if(h.isArray(AK)){for(AJ=0,AI=AK.length;AJ<AI;AJ++){if(!!AK[AJ].key&&AK[AJ].key==="default"){AL=AK[AJ];break;}}}return AL;},getDefaultWebMap:function Q(AJ){if(!AJ){return ;}if(!!AJ){for(var AI in AJ){if(!!AJ[AI]["default"]&&AJ[AI]["default"]==true){return AJ[AI];}}}return null;},_fetchTokenFromESRICloud:function X(){var AK=this,AI=this.getConfig(),AJ=AI.extrainfo,AM,AO,AL,AP;if(!!AJ&&!!AJ.primaryId&&!!AJ.secondaryId){AM=AJ.primaryId;AO=AJ.secondaryId;AL={client_id:encodeURIComponent(AM),client_secret:encodeURIComponent(AO),grant_type:encodeURIComponent(u),expiration:encodeURIComponent(U)};AP={success:function(AQ){if(!!AQ.error){AK.displayError("Error retrieving token using the given AppID and AppSecret. "+AQ.error.message);AK.updateMapExtent();return ;}var AR=AK.getConfig();if(!AR){AK.updateMapExtent();return ;}if(!A[AM]){A[AM]=AR.token=AQ.access_token;AK._cacheTheTokenInServer(AM,AQ);}else{AR.token=A[AM];}AK.createWebMap(AR);},failure:function(AQ){AK.displayError("Error retrieving token using the given AppID and AppSecret. "+AQ);AK.updateMapExtent();}};var AN=new mstrmojo.SimpleXHR({isTask:false,async:true});mstrmojo.xhr.request("POST",B,AP,AL);}else{C.log("ExtraInfo not present to fetch token from ESRI Cloud in client authentication mode.");}},getConfig:function J(){var AI=this.map,AJ=AI&&AI.getMapConfig();if(AJ){return AJ.esri;}},_cacheTheTokenInServer:function b(AL,AI,AK){var AJ={taskId:"getESRIConfig",key:AK,taskEnv:"xhr",taskContentType:"json",tokenJson:JSON.stringify(AI),id:AL},AM={success:function(AN){if(AN){if(!!AN.ec&&AN.ec==1){C.log("Successfully cached the token in client authentication mode");}else{C.log("Error caching the token on web server in client authentication mode : "+AN);}}},failure:function(AN){C.log("Error caching the token on web server in client authentication mode : "+AN);}};mstrApp.serverRequest(AJ,AM);},isWebMercator:function I(AI){var AJ=AI&&AI.wkid;return AJ===102100||AJ===102113||AJ===3857||AJ===3785;},latLngToPixelXY:function w(AI,AK){var AJ;if(!AI||!this.isProjectionReady()||!C.checkVal(AI.lat)||!C.checkVal(AI.lng)){C.log("Catch invalid point");return ;}AJ=this._toScreen(AI.lng,AI.lat);if(AK!==true){AJ=this.adjustPointInsideViewer(AJ,this._xCoordsMin);}if(AJ&&C.checkVal(AJ.x)&&C.checkVal(AJ.y)){return{x:parseInt(AJ.x),y:parseInt(AJ.y)};}},_toScreen:function d(AI,AM){if(!this._baseMap){return ;}var AL=this._baseMap,AJ=AL.spatialReference,AO=esri.geometry,AK=new AO.Point(AI,AM,this.wgs84SP),AN=this.isWebMercator(AJ)?AO.geographicToWebMercator(AK):AK;return new AO.toScreenGeometry(AL.extent,AL.width,AL.height,AN);},pixelXYtoLatLng:function z(AJ){var AM=this._baseMap,AK=AM.spatialReference,AO=esri.geometry,AI,AN,AL;if(!AM||!this.isProjectionReady()||!AJ||!C.checkVal(AJ.x)||!C.checkVal(AJ.y)){C.log("Catch invalid map/point/projection");return ;}AI=new AO.ScreenPoint(AJ.x,AJ.y);AN=AO.toMapGeometry(AM.extent,AM.width,AM.height,AI);if(AN){AL=this.isWebMercator(AK)?AO.webMercatorToGeographic(AN):AN;return{lat:AL.y,lng:AL.x};}},isProjectionReady:function W(){try{return !!esri&&!!esri.geometry;}catch(AI){}},getSearchSuggestions:function a(AJ,AL){var AI=this.getLocatorService(),AK=this.getInHouseResults(AJ)||[];if(!AI){return ;}AI.suggestLocations({text:AJ}).then(function(AM){var AN=Y(AM);if(AN){AK.push(AN);}AL(AK);});},navToCloudLocation:function m(AJ){var AK=this._baseMap,AI=this.getLocatorService();if(!AK||!AI){return ;}AI.addressToLocations({address:{SingleLine:AJ.n},magicKey:AJ.v});AI.on("address-to-locations-complete",function(AL){var AM,AO,AN;h.forEach(AL.addresses,function(AP){if(AP.score>80){AM=AP.location;AO=AP.extent;AN=new esri.geometry.Extent(AO.xmin,AO.ymin,AO.xmax,AO.ymax,AK.spatialReference);return false;}});if(!AM&&AL.addresses&&AL.addresses.length>0){AM=AL.addresses[0].location;AO=AL.addresses[0].extent;AN=new esri.geometry.Extent(AO.xmin,AO.ymin,AO.xmax,AO.ymax,AK.spatialReference);}if(AM){AK.setExtent(AN);AK.centerAt(AM);}});},checkSupport:function AC(){var AM=this.map.getMapConfig(),AI=AM&&AM.esri,AL=AI&&AI.err,AK,AJ;if(AL&&AL.length>0){this.displayError(AL);return false;}if(mstrApp.isSingleTier&&(typeof (FormWrapper)!=="undefined")&&parseInt(FormWrapper.testInternetConnection(),10)!==0){AK="Unable to download the ESRI map. No Internet connection. You can configure an Internet proxy through your computer's #";AJ='<a href="" style="color:#7CC5EC" onclick="window.FormWrapper.showProxyEditor(); return false;">'+mstrmojo.desc(7831,"Settings")+"</a>.";AK=AK.replace("#",AJ);this.displayError(AK);return false;}return true;},getLocatorService:function(){var AK=C.getProtocol(),AI=this._locatorService,AJ=this._baseMap;if(!!AJ&&!!AK&&!AI){AI=new esri.tasks.Locator(AK+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer");AI.outSpatialReference=AJ.spatialReference;this._locatorService=AI;}return this._locatorService;},showMapTools:function(){var AI=this._baseMap;if(!AI){return ;}if(!AI._isPanArrows){AI.showPanArrows();}if(!AI._isZoomSlider){AI.showZoomSlider();}},hideMapTools:function(){var AI=this._baseMap;if(!AI){return ;}if(AI.isPanArrows){AI.hidePanArrows();}if(AI.isZoomSlider){AI.hideZoomSlider();}},destroy:function v(AI){mstrmojo.esrimap.loadScriptListeners=[];this._super(AI);}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer","mstrmojo.gmaps.basemap._CanLoadGoogleMapScript","mstrmojo.PerformanceLogOutput");var S=mstrmojo,T=S.array,I=S.dom,J=S.hash,F=S.gmaps,B=F.MapUtils,X=S.PerformanceLogOutput,E=F.ZOOMBTN_ZINDEX;var d=256;function A(p){var o=Math.sin(p.lat()*Math.PI/180);o=Math.min(Math.max(o,-0.9999),0.9999);return new google.maps.Point(d*(0.5+p.lng()/360),d*(0.5-Math.log((1+o)/(1-o))/(4*Math.PI)));}function G(){var r=this._baseMap,p=r.getBounds(),t=r.getZoom(),s=1<<t,o=A(p.getSouthWest()),q=A(p.getNorthEast());return{swx:o.x*s,swy:o.y*s,nex:q.x*s,ney:q.y*s};}function V(o,p){if(!o||!p){return false;}return p.swx>=o.swx&&p.swy<=o.swy&&p.nex<=o.nex&&p.ney>=o.ney;}function Y(){try{return !!google;}catch(o){return false;}}mstrmojo.gmaps.basemap.GoogleBaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BaseLayer,[mstrmojo.gmaps.basemap._CanLoadGoogleMapScript],{scriptClass:"mstrmojo.gmaps.basemap.GoogleBaseLayer",mapStylesCache:null,mapStyleIds:null,typeForThumbnail:"_GOOGLE_",_overlay:null,lastZoom:null,tileRangeInPixelCoord:null,processConfigInfo:function b(){this._super();var p=this.map&&this.map.getMapConfig(),o=p&&p.google;if(!o){return ;}this.mstProp=o.mstProp;},initBaseMap:function n(){var o=this.map.getMapConfig().google;this.isSupport=this.checkSupport(o);if(this.isSupport!==true){console.log("Fail to init google map.");this.updateMapExtent();return ;}if(!!o.clientId){this.setPremiere(true);this.setPremiereKey(o.clientId);}else{this.setTrialKey(o.trialKey);}this.setLocaleLang(o.lang);this.setLocaleRegion(o.region);if(!!o.channel){this.setChannel(o.channel);}this.loadGoogleScripts();},loadGoogleScripts:function Q(){B.showWait();try{var p=this;if(mstrmojo.googleMapLib===undefined){mstrmojo.googleMapLib={};mstrmojo.gmaps.loadScriptListeners=[];this.loadExternalScript(this.loadBaseMap,mstrmojo.gmaps);}else{if(typeof (mstrmojo.googleMapLibLoaded)!=="undefined"&&mstrmojo.googleMapLibLoaded==true){this.loadBaseMap();}else{mstrmojo.gmaps.loadScriptListeners.push({caller:p,method:this.loadBaseMap});B.hideWait();}}}catch(o){B.log("BaseLayer.loadExternalScripts(): "+o);this.displayError(mstrmojo.desc(15715,"Failed to load google map"));this.updateMapExtent();B.hideWait();}},loadBaseMap:function h(){this._super();B.hideWait();if(!Y()){this.handleNoInternet();return ;}B.showWait();var p=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.HYBRID],r=this.getDefaultCenter(),o,s,q;for(q in this.mstProp){p.push(q);}this.mapStyleIds=p;if(this.isDHTMLinIE()||!this._baseMap){o={center:new google.maps.LatLng(r.lat,r.lng),minZoom:this.minZoom,maxZoom:this.maxZoom,zoom:this.defaultZoom,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,panControl:false,zoomControl:!!this.showZoomBtns,streetViewControl:false,fullscreenControl:false};this.mapStylesCache=[];this.mapStylesCache.push({n:"Road Map",id:google.maps.MapTypeId.ROADMAP});this.mapStylesCache.push({n:"Satellite",id:google.maps.MapTypeId.SATELLITE});this.mapStylesCache.push({n:"Terrain",id:google.maps.MapTypeId.TERRAIN});this.mapStylesCache.push({n:"Hybrid",id:google.maps.MapTypeId.HYBRID});if(this.mvo&&this.mvo!=="0"){s={style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:p};o.mapTypeControlOptions=s;}if(this.showZoomBtns==="0"){o.zoomControl=false;}this._baseMap=new google.maps.Map(this.div_,o);this._overlay=new google.maps.OverlayView();this._overlay.draw=function(){};this._overlay.setMap(this._baseMap);this.loadMapTheme();this.addEventListeners();}this.setMapStyle(this.mapStyle);this.updateMapExtent();B.hideWait();},getMapStyles:function N(){var p=[{n:mstrmojo.desc(7736,"Map"),id:0},{n:mstrmojo.desc(8068,"Satellite"),id:1},{n:mstrmojo.desc(8102,"Terrain"),id:2},{n:mstrmojo.desc(8069,"Hybrid"),id:3}],s=this.mstProp,q,r,o;if(s){r={4:mstrmojo.desc(9237,"Desert"),5:mstrmojo.desc(2797,"Blank"),6:mstrmojo.desc(11845,"Ice"),7:mstrmojo.desc(8958,"Dark"),8:mstrmojo.desc(11846,"Nature"),9:mstrmojo.desc(11847,"Arctic")};for(o in s){q=r[o];if(!!q){p.push({n:q,id:o});}}}return p;},getDefaultMapStyle:function e(){return 0;},getDefaultStyleIdx:function m(){return 0;},setMapStyle:function H(q){var r=this.mapStyleIds,p=parseInt(q),o;if(!r||!T.isArray(r)){return ;}if(isNaN(p)){p=0;}o=r[p]||r[0];if(B.checkDefined(o)){this._baseMap.setMapTypeId(o);}this.mapStyle=q;this.updateMapToolbar();},loadMapTheme:function j(){var q=this.mstProp;var r={4:"Desert",5:"Blank",6:"Ice",7:"Dark",8:"Nature",9:"Arctic"};var p=["4","5","6","8","9","7"],t={},o,s;for(o in q){t[o]=new google.maps.StyledMapType(JSON.parse(q[o]),{name:r[o]});}for(o in p){s=p[o];this._baseMap.mapTypes.set(s,t[s]);this._baseMap.setMapTypeId(s);this.mapStylesCache.push({n:t[s].name,id:s});}},addEventListeners:function O(){var p=this,o=p.map,r=this._baseMap,q=this.eventListenerArr=[];if(!r){return ;}q.push(google.maps.event.addListener(r,"idle",function(){X.endTimer("timerid_callback_handleExtentChange");X.visPrint("handleExtentChange() start");X.startTimer({functionName:"GoogleBaseLayer.this.handleExtentChange: ",purpose:"render all graphic layers"},"timerid_handleExtentChange");p.updateGraphicLayers();p.handleExtentChange();p.lastZoom=p.getZoom();}));q.push(google.maps.event.addListener(r,"bounds_changed",function(){var u=p._baseMap,t=p.map,s;google.maps.event.trigger(u,"resize");p.updateForResizing();if(o.needMapReadyEvent()){s=p.tileRangeInPixelCoord;if(s&&V(s,G.call(p))){p.isBaseMapReady=true;t.checkForMapReady();}}}));q.push(google.maps.event.addListener(r,"zoom_changed",function(){p.handleZoomChange();}));q.push(google.maps.event.addListenerOnce(r,"tilesloaded",function(){var w=p.getNode(),u=w&&w.getElementsByClassName("gm-style"),t=u&&u.length>0&&u[0];if(t){w.style.removeProperty("transform");t.style.removeProperty("z-index");}if(B.isWorkstation()&&I.isMac()){var v=u&&t.getElementsByTagName("iframe"),s=v&&v.length>0&&v[0];if(s){s.style.display="none";}}}));q.push(google.maps.event.addListener(r,"tilesloaded",function(){if(o.needMapReadyEvent()){var u=p.map,t=function(v,w){var y=v/d;return(w?Math.ceil(y):Math.floor(y))*d;},s=G.call(p);p.isBaseMapReady=true;if(B.checkHasFunction(u,"checkForMapReady")){u.checkForMapReady();}p.tileRangeInPixelCoord={swx:t(s.swx,false),swy:t(s.swy,true),nex:t(s.nex,true),ney:t(s.ney,false)};}}));this.attachMapRemoveEvent();},attachMapRemoveEvent:function Z(){var p=this.div_,q=this,o=this.parent;this.mapRemovehandler=function(r){if(r.target&&r.target.parentNode===p){if(o){o.hideAllGraphicLayers();}I.detachEvent(p,"DOMNodeRemoved",q.mapRemovehandler);}};I.attachEvent(p,"DOMNodeRemoved",this.mapRemovehandler);},handleZoomChange:function K(){var o=this.parent;if(o&&this.mapZoom!==this.getZoom()){o.hideAllGraphicLayers();}this._super();},resize:function M(q,o){var r=this._baseMap;this._super(q,o);if(r){var p=J.walk("parent.baseLayer",this);if(p){p.toUpdateLayers=true;}google.maps.event.trigger(r,"resize");}},panBy:function R(s){var p=this._baseMap,r,q,o;if(!!p&&!!s&&B.checkVal(s.x)&&B.checkVal(s.y)){r=Math.pow(2,p.getZoom());q=p.getProjection();o=q.fromLatLngToPoint(p.getCenter());o.x-=s.x/r;o.y-=s.y/r;p.setCenter(q.fromPointToLatLng(o));}},getLngLatCenter:function C(){var p=this._baseMap,o,q;if(!p){return ;}o=p.getCenter();q=o&&new google.maps.LatLng(o.lat(),o.lng(),false);return !!q&&{lat:q.lat(),lng:q.lng()};},setExtent:function c(o){if(!o||!B.checkVal(o.latSouth)||!B.checkVal(o.latNorth)||!B.checkVal(o.lngWest)||!B.checkVal(o.lngEast)){return ;}this._super(o);var q=new google.maps.LatLng(o.latSouth,o.lngWest),p=new google.maps.LatLng(o.latNorth,o.lngEast),r=new google.maps.LatLngBounds(q,p);this.mstrFitBounds(r);},setCenter:function W(p){if(!this._baseMap||!p||!B.checkVal(p.lat)||!B.checkVal(p.lng)){return ;}var o=new google.maps.LatLng(p.lat,p.lng);this._baseMap.setCenter(o);},mstrFitBounds:function D(p){var q=this._baseMap,o;if(!q||!p){console.log("Invalid bounds/baseMap");return ;}o=q.getBounds();q.fitBounds(p);if(o&&o.equals(p)&&B.checkVal(this.lastZoom)){q.setZoom(this.lastZoom);}},latLngToPixelXY:function g(p){var o=this._getMapProjection(),q;if(!p||!this.isProjectionReady()||!B.checkVal(p.lat)||!B.checkVal(p.lng)){B.log("Catch invalid point/projection");return ;}q=o.fromLatLngToContainerPixel(new google.maps.LatLng(p.lat,p.lng));if(!!q){return{x:q.x,y:q.y};}},pixelXYtoLatLng:function i(p){var o=this._getMapProjection(),q;if(!p||!this.isProjectionReady()||!B.checkVal(p.x)||!B.checkVal(p.y)){B.log("Catch invalid point/projection");return ;}q=o.fromContainerPixelToLatLng(new google.maps.Point(p.x,p.y));return{lat:q.lat(),lng:q.lng()};},isProjectionReady:function P(){var o=this._getMapProjection();return B.checkHasFunction(o,"fromContainerPixelToLatLng");},getGeoScreenRange:function k(){var o=this._getMapProjection();return o&&o.getWorldWidth();},_getMapProjection:function U(){return this._overlay&&this._overlay.getProjection();},showMapTools:function(){var o=this._baseMap;if(!o){return ;}if(!o.panControl){o.setOptions({panControl:true});}if(!o.zoomControl){o.setOptions({zoomControl:true});}},hideMapTools:function(){var o=this._baseMap;if(!o){return ;}if(o.panControl){o.setOptions({panControl:false});}if(o.zoomControl){o.setOptions({zoomControl:false});}},checkSupport:function l(o){if(!o||(o.clientId==="InvalidPremierKey")||(!o.clientId&&!o.trialKey)){this.displayError(mstrmojo.desc(11186,"The Google map requires a valid key"));return false;}return true;},removeEventListeners:function a(){this._super();I.detachEvent(this.div_,"DOMNodeRemoved",this.mapRemovehandler);delete this.mapRemovehandler;},destroy:function f(){if(!!this._overlay){this._overlay.draw=function(){};}delete this._overlay;this._super();}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.xhr","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer","mstrmojo.gmaps.geometry.Extent","mstrmojo.gmaps.basemap._CanLoadMapboxScript","mstrmojo.PerformanceLogOutput","mstrmojo.hash","mstrmojo.gmaps.MapEnums");var U=mstrmojo,q=U.dom,I=U.array,AL=U.gmaps,Y=AL.EnumLanguageType,h=AL.MapUtils,l=U.PerformanceLogOutput,i="all-label-group",N=U.hash;var AG="0.40.1",AA=mstrmojo.desc(7736,"Map"),Z="bottom-right",AV="mapbox://styles/microstrategy/{$style}",g=[{id:AV.replace("{$style}","cj4huc3z734b32sqpcyursd8s"),rn:"Basic",n:mstrmojo.desc(7227,"Basic")},{id:AV.replace("{$style}","cj8o35v4u8ayz2rqutqgwhvxp"),rn:"White",n:mstrmojo.desc(2293,"White")},{id:AV.replace("{$style}","cj4fnd0xu1ax82rnuq287rwvu"),rn:"Light",n:mstrmojo.desc(8959,"Light")},{id:AV.replace("{$style}","cj4gonmj72rih2ss2n132hwla"),rn:"Dark",n:mstrmojo.desc(8958,"Dark")},{id:AV.replace("{$style}","cj4fdoz771jrx2rmhajhl8yxv"),rn:"Street",n:mstrmojo.desc(13821,"Street")},{id:AV.replace("{$style}","cj4gpwfca95l52so2gkz3y2is"),rn:"Topographic",n:mstrmojo.desc(11852,"Topographic")},{id:AV.replace("{$style}","cj4grefys96zg2smv7okfp8c5"),rn:"Physical",n:mstrmojo.desc(13824,"Physical")},{id:AV.replace("{$style}","cj4guy8nn2y7e2so0c9h2uiav"),rn:"Relief",n:mstrmojo.desc(13823,"Relief")},{id:AV.replace("{$style}","cj621ujgo32ve2rmpuxixebjq"),rn:"Satellite",n:mstrmojo.desc(8068,"Satellite")},{id:AV.replace("{$style}","cj4gnpv6t2r9m2rpe417d51s1"),rn:"SatelliteStreet",n:mstrmojo.desc(15716,"Satellite Street")}],AR={"extent-change":"moveend","zoom-start":"zoomstart","zoom-end":"zoomend",load:"load"},o={top:80,bottom:80,left:80,right:80};function O(AW){this._parent=AW;}function AO(AW,AX){if(AW){AW.setAttribute("style","transform: rotate("+AX*(180/Math.PI)+"deg); margin: 0");}}function m(AW,AX,AY){return N.walk(AX+"parent.toolbar.compassBtn.domNode"+AY,AW);}function AD(AY,AW){var AX=document.createEvent("MouseEvents");AX.initEvent(AW,false,false);AY.dispatchEvent(AX);}O.prototype.onAdd=function(AX){var AW=this._container=document.createElement("button");AW.className="mapboxgl-ctrl mapboxgl-ctrl-reset";this._onClick=(function(){var Ab=this._parent,Aa=this._map,AZ=Ab&&Ab.parent,AY=m(this,"_parent.",".firstChild");if(AZ&&Aa){if(AY){AD(AY,"click");}Ab.updateExtent(AZ.getMapGeoExtent(),true);}}).bind(this);q.attachEvent(AW,"click",this._onClick);this._map=AX;return this._container;};O.prototype.onRemove=function(){var AW=this._container;q.detachEvent(AW,"click",this._onClick);if(AW.parentNode){AW.parentNode.removeChild(AW);}this._map=undefined;this._parent=undefined;};O.prototype.getDefaultPosition=function(){return"bottom-right";};function j(AX){if(!AX||AX.length<1){return ;}var AW=[];I.forEach(AX,function(AY){AW.push({n:AY.place_name,cls:"geo",geo:AY});});return{label:AA,isCloud:true,items:AW};}function AE(AW){return typeof AW==="string"&&AW.indexOf("{name")>-1;}function AC(AW){return AW.stops&&AW.stops.filter(function(AX){return AX[1].indexOf("{name")>-1;}).length>0;}function k(AW,AY){var AX;if(AW.indexOf(Y.Both)>-1){AX=AW.replace(Y.Both,AY);}else{if(AW.indexOf(Y.Local)>-1){AX=AW.replace(Y.Local,AY);}else{AX=AW.replace(Y.English,AY);}}return AX;}mstrmojo.gmaps.basemap.MapboxGLBaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BaseLayer,[mstrmojo.gmaps.basemap._CanLoadMapboxScript],{scriptClass:"mstrmojo.gmaps.basemap.MapboxGLBaseLayer",navigationCtrl:null,resetCtrl:null,typeForThumbnail:"_MAPBOX_",maxZoom:22,labelGroupExist:false,init:function x(AW){this._super(AW);this.supportLayerZoomRange=true;this.cssUrl=this.getURL("//api.tiles.mapbox.com/mapbox-gl-js/v"+AG+"/mapbox-gl.css");},initBaseMap:function n(){var AW=this.getConfig();this.isSupport=this.checkSupport(AW);if(this.isSupport!==true){console.log("Fail to init mapbox map.");this.updateMapExtent();return ;}h.showWait();if(this.isLibLoaded()){this.loadBaseMap();}},isLibLoaded:function AM(){return !!(window.mapboxgl&&typeof (mapboxgl.Map)!=="undefined");},loadBaseMap:function C(){this._super();this.createMapObj();},createMapObj:function d(){if(!mapboxgl){console.log("Fail to load mapbox resources.");this.updateMapExtent();return ;}var AY=this.getConfig(),Aa=this.getDefaultCenter(),AX={container:this.domId,center:[Aa.lng,Aa.lat],minZoom:this.minZoom,maxZoom:this.maxZoom,zoom:this.defaultZoom,attributionControl:false};mapboxgl.accessToken=AY.token;this._baseMap=new mapboxgl.Map(AX).addControl(new mapboxgl.AttributionControl({compact:true}),"bottom-left");this.addNavigationCtrl();this.addEventListeners(AR);var AZ=this,AW=N.walk("map.parent.parent",AZ);if(AW){this.panelDisplayListener=AW.attachEventListener("panelDisplaying",AZ.id,function(Ab){if(AZ._baseMap.getCanvas().height!==AZ.map.getHeight()||AZ._baseMap.getCanvas().width!==AZ.map.getWidth()){AZ._baseMap.resize();}});}this.setMapStyle(this.mapStyle);h.hideWait();},handleOnLoad:function b(){this._super();this.setCompassButton();},setCompassButton:function G(){var AW=this.getNode(),AY=AW&&AW.getElementsByClassName("mapboxgl-ctrl-compass"),AX=AY&&AY[0];if(AX&&!this.isForPremium()){h.setCssStyles(AX,{display:"none"});}},attachClickDisplayEvent:function(){if(this.clickDisplayListener){return ;}var AX=this._baseMap,AW=m(this,"",".firstChild");this.clickDisplayListener=function(){var AY;if(AX){AX.easeTo({bearing:0,pitch:0});AY=setInterval(function(){if(AX.transform.angle!==0){AO(AW,AX.transform.angle);}else{clearInterval(AY);}},10);}};if(AW){q.attachEvent(AW,"click",this.clickDisplayListener,true);}},attachDownDisplayEvent:function(){if(this.downDisplayListener){return ;}var AX=this._baseMap,AW=m(this,"",".firstChild"),AY=N.walk("navigationCtrl._compassArrow",this);this.downDisplayListener=function(){if(AX){AD(AY,"mousedown");this.rotateMoveListener=function(){AO(AW,AX.transform.angle);};q.attachMouseMoveEvents(this.rotateMoveListener);}};if(AW){q.attachEvent(AW,"mousedown",this.downDisplayListener,true);}},attachMapRotateEvent:function(){if(this.mapRotateListener){return ;}var AY=this._baseMap,AX=this.div_,AW=m(this,"",".firstChild");this.mapRotateListener=function(AZ){if(AY){if(AZ.ctrlKey||(AZ.which===3)){this.mapRotateMoveListener=function(){AO(AW,AY.transform.angle);};q.attachMouseMoveEvents(this.mapRotateMoveListener);}}};if(AX){q.attachEvent(AX,"mousedown",this.mapRotateListener,true);}},detachCompassEvent:function c(){var AX=this.div_,AW=m(this,"",".firstChild");if(this.clickDisplayListener){q.detachEvent(AW,"click",this.clickDisplayListener,true);delete this.clickDisplayListener;}if(this.downDisplayListener){q.detachEvent(AW,"mousedown",this.downDisplayListener,true);delete this.downDisplayListener;}if(this.mapRotateListener){q.detachEvent(AX,"mousedown",this.mapRotateListener,true);delete this.mapRotateListener;}},addNavigationCtrl:function M(){var AY=this,AW=this.getNode(),Ab=AW&&AW.getElementsByClassName("mapboxgl-ctrl-bottom-right")[0],AZ=this._baseMap,AX=m(this,"","");if(!AZ){return ;}this.navigationCtrl=new mapboxgl.NavigationControl();this.resetCtrl=new O(this);AZ.addControl(this.navigationCtrl,Z);if(AX){var Aa=AY.originalBearing?(0-AY.originalBearing):0;AX.innerHTML='<span class="mapboxgl-ctrl-compass-arrow" style="transform: rotate('+Aa+'deg); margin: 0"></span>';this.attachClickDisplayEvent();this.attachDownDisplayEvent();this.attachMapRotateEvent();Ab.setAttribute("style","visibility: hidden");}AZ.addControl(this.resetCtrl,Z);if(Ab){Ab.style["z-index"]=AL.ZOOMBTN_ZINDEX;}},addEventListeners:function t(AW){if(this.isForPremium()){this._addPremiumMapListeners();}else{this._addBaseTypeMapListeners();}},_addPremiumMapListeners:function AJ(){var AY=this._baseMap,AW=this,AX;if(!AY){return ;}AX=this.eventListenerArr=[{type:"render",listener:(function(){var AZ=AW.map;if(AW._baseMap.loaded()){if(!AW.isJsHeapRecorded){l.endTimer("timerid_handleExtentChange");l.endTimer("timerid_fromBuildtoEnd");l.endTimer("timerid_fromResponsetoEnd");l.recordJSHeapMemory("PremiumMapbox Memory usage at the end");AW.isJsHeapRecorded=true;}if(h.checkHasFunction(AZ,"checkForMapReady")){AZ.checkForMapReady();}l.endTimer("timerid_VisFilter_updateSelections");l.endTimer("timerid_VisFilter_unsetFilter");l.endTimer("timerid_Vis_keepOnly");l.endTimer("timerid_Vis_drill");l.endTimer("timerid_Vis_exclude");}}).bind(this)},{type:"style.load",listener:(function(){var Ac=AW.map,Aa=AW.parent,AZ;this.setLanguage(this.languageType);this.toggleBaseMapLabels(this.showMapLabels);if(Ac&&Aa){this._active=true;var Ab=Aa.graphicLayerMapping;if(Object.keys(Ab).length===0){Aa.initGraphicLayers();Ac.postViewerInit();}else{for(AZ in Ab){if(Ab.hasOwnProperty(AZ)){Ab[AZ].buildViewer();}}Aa.toolbar.refreshMapStyleCtrl();}}}).bind(this)},{type:AR["extent-change"],listener:(function(){AW.updateForResizing();AW.autoSaveZoomAndPos();}).bind(this)},{type:AR["zoom-end"],listener:(function(){AW.raiseEvent({name:"zoomLevelChanged",zoomLevel:AW.getZoom()});}).bind(this)}];I.forEach(AX,function(AZ){AY.on(AZ.type,AZ.listener);});},_addBaseTypeMapListeners:function AI(){var AZ=this._baseMap,AW=this.map,AX=this,AY;if(!AZ){return ;}AY=this.eventListenerArr=[{type:AR["extent-change"],listener:this.handleExtentChangeEvt.bind(this)},{type:AR["zoom-start"],listener:this.handleZoomStart.bind(this)},{type:AR["zoom-end"],listener:(function(){if(AW.needMapReadyEvent()){AX.isBaseMapReady=false;AW.graphicsReady=false;}AX.handleZoomChange();}).bind(this)},{type:AR.load,listener:this.handleOnLoad.bind(this)},{type:"resize",listener:(function(){AX.toUpdateLayers=true;}).bind(this)}];I.forEach(AY,function(Aa){AZ.on(Aa.type,Aa.listener);});},handleMouseWheel:function p(Aa){if(!Aa||!Aa.zoomDelta){return ;}var AZ=this._baseMap,AW=this.pixelXYtoLatLng(Aa.position),AX=3,AY;if(AW){AY=[AW.lng,AW.lat];}if(!!AZ){AZ.easeTo({zoom:this.validateZoomLevel(AZ.getZoom()+Aa.zoomDelta/AX),around:AY,animate:false});}},navToInHouseLocation:function AH(AW){var AX=this._baseMap,AZ=AW.v,AY;if(!AX||!AZ){return ;}if(AZ.attributes.geoId){AY=AZ.attributes.bbox;if(AY){AX.fitBounds([[AY[0],AY[1]],[AY[2],AY[3]]],{padding:o,linear:true});}}else{if(AZ.getGeoCenter instanceof Function){this.centerAndZoom(AZ.getGeoCenter(),10);}}},setExtent:function AN(AW,AY){var Ab=this._baseMap;if(Ab&&AW){this._super(AW);var AZ=AW.latSouth<AW.latNorth?AW.latSouth:AW.latNorth,Ac=AW.latSouth<AW.latNorth?AW.latNorth:AW.latSouth,AX=AW.lngWest<AW.lngEast?AW.lngWest:AW.lngEast,Aa=AW.lngWest<AW.lngEast?AW.lngEast:AW.lngWest;AZ=AZ<=-90?-89:AZ;Ac=Ac>=90?89:Ac;if(AY===undefined){if(this.clickDisplayListener){this.clickDisplayListener();}}Ab.fitBounds([[AX,AZ],[Aa,Ac]],{padding:o});}},setCenter:function AU(AW){var AX=this._baseMap;if(AX&&AW&&h.checkVal(AW.lat)&&h.checkVal(AW.lng)){AX.setCenter([AW.lng,AW.lat]);}},centerAndZoom:function f(AW,AY){var AX=this._baseMap;if(AX&&AW&&h.checkVal(AW.lat)&&h.checkVal(AW.lng)&&h.checkVal(AY)){AX.easeTo({zoom:AY,center:[AW.lng,AW.lat]});}},supportBearingAndPitch:function A(){return true;},getBearing:function AS(){var AW=this._baseMap;if(AW&&(AW.getBearing instanceof Function)){return AW.getBearing();}},setBearing:function R(AW){var AX=this._baseMap;if(AX&&AX.setBearing instanceof Function&&h.checkVal(AW)){AX.setBearing(AW);}},getPitch:function r(){var AW=this._baseMap;if(AW&&(AW.getPitch instanceof Function)){return AW.getPitch();}},setPitch:function K(AX){var AW=this._baseMap;if(AW&&AW.setPitch instanceof Function&&h.checkVal(AX)){AW.setPitch(AX);}},panBy:function u(AX){var AW=this._baseMap;if(!!AW&&!!AX&&h.checkVal(AX.x)&&h.checkVal(AX.y)){AW.panBy([-AX.x,-AX.y],{animate:false});}},getMapStyles:function E(){return g;},getDefaultMapStyle:function Q(){return g[2].id;},getDefaultStyleIdx:function w(){return 2;},getStyleIdForToolbar:function AQ(AW){return AW.rn+"";},setMapStyle:function AF(AX){var AY=this._baseMap,AW=this.parent;if(!AY||!AW){return ;}if(this.isForPremium()){AW.destroyAllGraphicLayerViewers();}AX=AX||this.getDefaultMapStyle();AY.setStyle(AX);this.mapStyle=AX;},setLanguage:function AK(Ac){var Ab=this._baseMap,AX=this.parent;if(!Ab||!AX){return ;}var Aa=Ab.getStyle().layers,AW,AZ,AY;I.forEach(Aa,function(Ad){AW=Ad.layout&&Ad.layout["text-field"];if(AW){if(AE(AW)){AZ=k(AW,Ac);Ab.setLayoutProperty(Ad.id,"text-field",AZ);}else{if(AC(AW)){AY=AW.stops.map(function(Ae){if(Ae[1].indexOf("{name")>-1){AZ=k(Ae[1],Ac);return[Ae[0],AZ];}return Ae;});AW.stops=AY;Ab.setLayoutProperty(Ad.id,"text-field",AW);}}}});this.languageType=Ac;},resize:function H(AZ,AW){this._super(AZ,AW);var Ab=this._baseMap,AY=this.parent,AX=N.walk("resetCtrl._container",this);if(Ab&&Ab.resize){Ab.resize();var Aa=m(this,"","");if(Aa&&(!Aa.querySelector("span"))){Aa.innerHTML='<span class="mapboxgl-ctrl-compass-arrow" style="transform: rotate(0deg); margin: 0"></span>';this.attachClickDisplayEvent();this.attachDownDisplayEvent();this.attachMapRotateEvent();}if(AX&&AY&&(AY.isDynamicZoom()===true)){AD(AX,"click");}}},getLngLatCenter:function z(){var AX=this._baseMap,AW=AX&&AX.getCenter();return AW&&AW.wrap();},getConfig:function T(){var AW=this.map,AX=AW&&AW.getMapConfig();if(AX){return AX.mapbox;}},getToken:function AT(){var AW=this.getConfig();if(AW){return AW.token;}},latLngToPixelXY:function J(AW,AZ){var AY=this._baseMap,AX;if(!AY||!AW||!h.checkVal(AW.lat)||!h.checkVal(AW.lng)){h.log("Catch invalid point");return ;}AX=AY.project([AW.lng,AW.lat]);if(AZ!==true){AX=this.adjustPointInsideViewer(AX,this._xCoordsMin);}if(AX&&h.checkVal(AX.x)&&h.checkVal(AX.y)){return{x:parseInt(AX.x),y:parseInt(AX.y)};}},pixelXYtoLatLng:function e(AW){var AY=this._baseMap,AX;if(!AY||!AW||!h.checkVal(AW.x)||!h.checkVal(AW.y)){h.log("Catch invalid map/point/projection");return ;}AX=AY.unproject(AW);if(AX){return{lat:AX.lat,lng:AX.lng};}},checkSupport:function F(AW){if(!AW||!AW.token){this.displayError(mstrmojo.desc(11726,"Please contact MicroStrategy Technical Support to obtain a map key."));return false;}return true;},showMapTools:function s(){var AY=this.navigationCtrl=this.navigationCtrl||new mapboxgl.NavigationControl(),AW=this.resetCtrl,AX=this._baseMap;if(AX){AX.addControl(AY,Z);AX.addControl(AW,Z);}},hideMapTools:function D(){var AY=this._baseMap,AX=this.navigationCtrl,AW=this.resetCtrl;if(AY&&AX){if(AX){AY.removeControl(AX);}if(AW){AY.removeControl(AW);}}},getSearchSuggestions:function AP(AX,Aa){var AZ=this.getInHouseResults(AX)||[],AW=this.getToken(),AY;if(!AW||!AX){return ;}AY=new mstrmojo.SimpleXHR({isTask:false,async:true});AY.request("GET","https://api.mapbox.com/geocoding/v5/mapbox.places/"+AX+".json",{success:function(Ac){var Ab=j(Ac&&Ac.features);if(Ab){AZ.push(Ab);}Aa(AZ);},failure:function(Ab){console.log("Fail to search using Mapbox api...",Ab);Aa(AZ);}},{access_token:AW});},navToCloudLocation:function W(AX){var AZ=this._baseMap,AY=AX&&AX.geo,Aa,AW;if(!AZ||!AY){return ;}Aa=AY.bbox;AW=AY.center;if(Aa){AZ.fitBounds([[Aa[0],Aa[1]],[Aa[2],Aa[3]]],{padding:o,linear:true});}else{if(AW){AZ.easeTo({center:AW,zoom:12});}}},removeEventListeners:function X(){var AW=this.eventListenerArr,AX=this._baseMap;I.forEach(AW,function(AY){AX.off(AY.type,AY.listener);});this.eventListenerArr=null;},getAllLabelsGroupId:function S(){var Ac=this._baseMap,AZ=Ac&&Ac.getStyle(),AY=AZ&&AZ.metadata,Aa=AY&&AY["mapbox:groups"],AX,Ab,AW;if(Aa){for(AX in Aa){Ab=Aa[AX];if(Ab.name===i){AW=AX;break;}}}return AW;},toggleBaseMapLabels:function v(AW){var Ac=this._baseMap,AZ=Ac&&Ac.getStyle(),Ab=AZ&&AZ.layers,AY=this.getAllLabelsGroupId(),AX,Aa;if(AW!==undefined){this.showMapLabels=AW;}else{AW=this.showMapLabels;}if(AY){this.labelGroupExist=true;I.forEach(Ab,function(Ad){AX=Ad.metadata;Aa=AX&&AX["mapbox:group"];if(Aa===AY){Ac.setLayoutProperty(Ad.id,"visibility",AW?"visible":"none");}});}else{this.labelGroupExist=false;}},isLabelGroupExist:function V(){return this.labelGroupExist;},getBottomExistLayerKey:function y(AW){var AY=this.parent,Aa=AY&&AY.parent,Ab=Aa&&Aa.layerIdxMappingArr,AX,AZ;if(!Ab||Ab.length<1||!AW){return undefined;}AX=Ab.length-1;while(AX>=0){AZ=Ab[AX];if(I.find(AW,"id",AZ)>=0){return AZ;}AX--;}return undefined;},toggleBaseMapLabelsPos:function AB(Ad){var Ac=this._baseMap,AY=Ac&&Ac.getStyle(),Ab=AY&&AY.layers,AX=this.getAllLabelsGroupId(),AW,AZ,Aa;if(Ad!==undefined){this.mapLabelsOnTop=Ad;}else{Ad=this.mapLabelsOnTop;}if(AX){if(!Ad){Aa=this.getBottomExistLayerKey(Ab);}I.forEach(Ab,function(Ae){AW=Ae.metadata;AZ=AW&&AW["mapbox:group"];if(AZ===AX){if(Ad){Ac.moveLayer(Ae.id);}else{if(Aa){Ac.moveLayer(Ae.id,Aa);}}}});}},isLabelGropOnTop:function P(){return this.mapLabelsOnTop;},removeControls:function a(){var AW=this._baseMap;if(!AW){return ;}I.forEach([this.navigationCtrl,this.resetCtrl],function(AX){if(AX){AW.removeControl(AX);}});this.navigationCtrl=null;this.resetCtrl=null;},destroy:function B(AX){var AY=this._baseMap;this.detachCompassEvent();this.removeControls();var AW=N.walk("map.parent.parent",this);if(AW&&this.panelDisplayListener){AW.detachEventListener(this.panelDisplayListener);this.panelDisplayListener=null;}if(h.checkHasFunction(AY,"remove")){AY.remove();}mstrmojo.mapbox.loadScriptListeners=[];this._super(AX);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer");var J=mstrmojo.gmaps.MapUtils,B={"extent-change":"extent-change","zoom-start":"zoom-start","zoom-end":"zoom-end"},F=200,W=0.1;function T(){var Y=this.img;if(Y){return{width:parseInt(Y.naturalWidth),height:parseInt(Y.naturalHeight)};}}function A(){var Y=document.getElementById(this.containerId);if(Y){return{width:parseFloat(Y.style.width),height:parseFloat(Y.style.height)};}}function M(){var Y=this.img;if(Y){return{left:parseFloat(Y.style.left),top:parseFloat(Y.style.top),width:parseFloat(Y.style.width),height:parseFloat(Y.style.height)};}}function C(){var Y=A.call(this);if(Y){return{x:Y.width/2,y:Y.height/2};}}mstrmojo.gmaps.basemap.ImageMap=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gmaps.basemap.ImageMap",mapOptions:null,img:null,containerId:null,_eventMap:null,_zoomStep:0.1,init:function Q(a){if(!a){return ;}this._super(a);var Y=document.getElementById(a.containerId),Z=this.img=J.createNormalNode("img");Z.style.position="absolute";J.appendNode(Y,Z);this._eventMap={};},on:function I(b,c){var a=this._eventMap,Y=this.img,Z=this;if(!a||!Y||!b){return ;}switch(b){case"load":return Y.addEventListener(b,function(){var d=Z.img,e=d.naturalWidth,f=d.naturalHeight;d.style.left=d.style.top=0;d.style.width=e+"px";d.style.height=f+"px";Z._zoomStep=F/Math.max(e,f);c();});case"error":return Y.addEventListener(b,c);default:a[b]=c;return{name:b,remove:function(){var d=Z._event;if(d){delete d.evtName;}}};}},trigger:function O(Z){var Y=this._eventMap;if(Z&&Y[Z]){Y[Z]();}if(Z===B["extent-change"]){this.show();}},show:function V(){var Y=this.img;if(Y){Y.style.display="block";}},hide:function K(){var Y=this.img;if(Y){Y.style.display="none";}},setExtent:function D(Y){if(!this.img){return ;}var g=this.img,k=A.call(this),f=k.width,i=k.height,Z=g.naturalWidth,e=g.naturalHeight,h=Y?{top:Y.latSouth-W*i,bottom:Y.latNorth+W*i,left:Y.lngWest-W*f,right:Y.lngEast+W*f}:{top:0,bottom:e,left:0,right:Z},c=h.right-h.left,m=h.bottom-h.top,l=f/c,a=i/m,n=this.zoom=Math.min(l,a),d,b,j;if(l<a){d=(i-m*n)/2;b=-f*h.left/c;j=-(n*h.top-d);}else{d=(f-c*n)/2;j=-i*h.top/m;b=-(n*h.left-d);}J.setCssStyles(g,{width:(Z*n)+"px",height:(e*n)+"px",left:b+"px",top:j+"px"});this.trigger(B["extent-change"]);},setStyle:function E(Z){var Y=this.img;if(Y&&Z){J.setNodeAttributes(Y,{src:Z});this.style=Z;}},panBy:function G(a){var Y=this.img,Z=Y&&Y.style;if(Z&&a){Z.left=(parseFloat(Z.left)+a.x)+"px";Z.top=(parseFloat(Z.top)+a.y)+"px";this.trigger(B["extent-change"]);}},setZoom:function H(d,a){var b=T.call(this),Z=this.img,Y=A.call(this),c;if(d<=0||!Z||!Y){return ;}this.trigger(B["zoom-start"]);if(!a){a={x:Y.width/2,y:Y.height/2};}c=this.toRaw(a);J.setCssStyles(Z,{left:(a.x-c.x*d)+"px",top:(a.y-c.y*d)+"px",height:(b.height*d)+"px",width:(b.width*d)+"px"});this.zoom=d;this.trigger(B["zoom-end"]);this.trigger(B["extent-change"]);},getZoom:function N(){return this.zoom;},setCenter:function P(Y){var Z=this.toScreen(Y),c=C.call(this),b=M.call(this),a=this.img;if(a&&Z&&c&&b){J.setCssStyles(a,{left:(b.left+c.x-Z.x)+"px",top:(b.top+c.y-Z.y)+"px"});}},getCenter:function S(){return this.toRaw(C.call(this));},toScreen:function R(Y){var a=M.call(this),Z=T.call(this),b;if(!a||!Y||!J.checkVal(Y.x)||!J.checkVal(Y.y)){J.log("Catch invalid point");return ;}b=a.width/Z.width;return{x:Y.x*b+a.left,y:Y.y*b+a.top};},toRaw:function X(Z){var Y=M.call(this),b=T.call(this),a;if(!Y||!Z||!J.checkVal(Z.x)||!J.checkVal(Z.y)){J.log("Catch invalid map/point/projection");return ;}a=Y.width/b.width;return{x:(Z.x-Y.left)/a,y:(Z.y-Y.top)/a};},destroy:function U(){this._eventMap=null;this.img=null;}});})();(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer","mstrmojo.gmaps.basemap.ImageMap");var T=mstrmojo,P=T.emptyFn,G=T.gmaps,I=G.MapUtils,O=G.basemap.ImageMap,B={"extent-change":"extent-change","zoom-start":"zoom-start","zoom-end":"zoom-end",load:"load"};mstrmojo.gmaps.basemap.ImageBaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BaseLayer,null,{scriptClass:"mstrmojo.gmaps.basemap.ImageBaseLayer",initBaseMap:function X(){this._baseMap=new O({containerId:this.div_.id});this._baseMap.hide();this.setMapStyle(this.mapStyle);this.addEventListeners();},addEventListeners:function H(){this._super(B);var Y=this,a=this._baseMap,Z=Y.eventListenerArr=Y.eventListenerArr||[];if(!a){return ;}Z.push(a.on("resize",function(){Y.updateForResizing();}));Z.push(a.on("error",function(){Y.handleNoInternet();Y.updateMapExtent();I.hideWait();}));},handleOnLoad:function C(){this._super();var Y=this.map;if(Y){Y.clearMapError();}this.loadBaseMap();I.hideWait();this.updateMapExtent();},setExtent:function D(Y){if(!this._baseMap||!this.map){return ;}this._super(Y);var Z=this._baseMap;if(Z){Z.setExtent(Y);}},setMapStyle:function A(Z){var a=this._baseMap,Y=this.parent;if(!Z){this.displayError(mstrmojo.desc(null,"Please configure a valid image URL"));return ;}if(Y&&a&&Z){Y.hasInit=false;I.showWait();a.setStyle(Z);this.mapStyle=Z;}},getMapStyles:function Q(){return[this.mapStyle];},getMapStyleData:P,panBy:function E(Z){var Y=this._baseMap;if(Y){Y.panBy(Z);}},handleMouseWheel:function R(d){if(!d){return ;}var Y=d.position,Z=this._baseMap&&this._baseMap._zoomStep,c=(d.zoomDelta>0)?Z:-Z,b=this.getZoom(),a;if(!Y||!I.checkVal(c)||!I.checkVal(Y.x)||!I.checkVal(Y.y)||!I.checkVal(c)){console.log("ImageBaseLayer.handleMouseWheel(): invalid params.");return ;}a=this.validateZoomLevel(b+c);if(a!==b){this.setZoom(a,Y);}},setZoom:function F(a,Y){if(!this.isProjectionReady()){return ;}var Z=this._baseMap;if(Z){Z.setZoom(a,Y);}},setCenter:function N(Y){var Z=this._baseMap;if(!Z||!Y){return ;}Y.x=I.checkVal(Y.x)?Y.x:Y.lng;Y.y=I.checkVal(Y.y)?Y.y:Y.lat;Z.setCenter(Y);},isSameCenter:function J(Z,Y){return Z.x===Y.x&&Z.y===Y.y;},getLngLatCenter:function M(){var Y=this._baseMap;if(Y){return Y.getCenter();}},latLngToPixelXY:function W(Y){var Z=this._baseMap;if(!this.isProjectionReady()||!Z||!Y){I.log("Catch invalid point");return ;}return Z.toScreen({x:Y.lng,y:Y.lat});},pixelXYtoLatLng:function S(Z){var a=this._baseMap,Y=a&&a.toRaw(Z);if(this.isProjectionReady()&&Y){return{lng:Y.x,lat:Y.y};}},isProjectionReady:function K(){return !!this.mapStyle;},resize:function V(Z,Y){this._super(Z,Y);var a=this._baseMap;if(a){a.trigger("resize");}},updateXCoordsRange:P,destroy:function U(){var Y=this._baseMap;if(Y){Y.destroy();}this._super();}});})();(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.basemap.MapboxGLBaseLayer");var H=mstrmojo.gmaps,J=H.MapUtils;var K="//api.mapbox.com/mapbox.js/v3.1.1",N="bottomright",D={"extent-change":"moveend","zoom-start":"zoomstart","zoom-end":"zoomend",load:"load"};mstrmojo.gmaps.basemap.MapboxBaseLayer=mstrmojo.declare(mstrmojo.gmaps.basemap.MapboxGLBaseLayer,null,{scriptClass:"mstrmojo.gmaps.basemap.MapboxBaseLayer",init:function O(U){this._super(U);this.jsURLs=[this.getURL(K+"/mapbox.js")];this.cssUrl=this.getURL(K+"/mapbox.css");},isLibLoaded:function C(){return !!(window.L&&typeof (L.Map)!=="undefined");},createMapObj:function I(){if(!window.L||!L.mapbox){console.log("Fail to load mapbox resources.");this.updateMapExtent();return ;}var V=this.getConfig(),X=this.getDefaultCenter(),U={center:L.latLng(X.lat,X.lng),minZoom:this.minZoom,maxZoom:this.maxZoom,zoom:this.defaultZoom},W;L.mapbox.accessToken=V.token;W=this._baseMap=new L.mapbox.map(this.domId,undefined,U);this.navigationCtrl=W.zoomControl;this.navigationCtrl.setPosition(N);this.addEventListeners(D);this.updateMapExtent();this.setMapStyle(this.mapStyle);J.hideWait();},handleMouseWheel:function P(W){if(!W||!W.zoomDelta){return ;}var V=this._baseMap,U=this.pixelXYtoLatLng(W.position);if(!!V){V.setZoomAround(L.latLng(U.lat,U.lng),this.validateZoomLevel(V.getZoom()+W.zoomDelta));}},setExtent:function E(U){var V=this._baseMap;if(V&&U){this._super(U);V.fitBounds(L.latLngBounds(L.latLng(U.latSouth,U.lngWest),L.latLng(U.latNorth,U.lngEast)));}},setCenter:function M(U){var V=this._baseMap;if(V&&U&&J.checkVal(U.lat)&&J.checkVal(U.lng)){V.setView(new L.latLng(U.lat,U.lng));}},centerAndZoom:function F(U,W){var V=this._baseMap;if(V&&U&&J.checkVal(U.lat)&&J.checkVal(U.lng)&&J.checkVal(W)){V.setView(new L.latLng(U.lat,U.lng),parseInt(W));}},panBy:function G(V){var U=this._baseMap;if(U&&V&&J.checkVal(V.x)&&J.checkVal(V.y)){U.panBy([-V.x,-V.y],{animate:false});}},setMapStyle:function B(U){var V=this._baseMap;if(!V){return ;}U=U||this.getDefaultMapStyle();L.mapbox.styleLayer(U).addTo(V);this.mapStyle=U;},resize:function T(V,U){this._super(V,U);var W=this._baseMap;if(W){W.invalidateSize();}},latLngToPixelXY:function S(U,X){var W=this._baseMap,V;if(!W||!U||!J.checkVal(U.lat)||!J.checkVal(U.lng)){J.log("Catch invalid point");return ;}V=W.latLngToContainerPoint(L.latLng(U.lat,U.lng));if(X!==true){V=this.adjustPointInsideViewer(V,this._xCoordsMin);}if(V&&J.checkVal(V.x)&&J.checkVal(V.y)){return{x:parseInt(V.x),y:parseInt(V.y)};}},pixelXYtoLatLng:function Q(U){var W=this._baseMap,V;if(!W||!U||!J.checkVal(U.x)||!J.checkVal(U.y)){J.log("Catch invalid map/point/projection");return ;}V=W.containerPointToLatLng(L.point(U.x,U.y));if(V){return{lat:V.lat,lng:V.lng};}},showMapTools:function R(){var V=this.navigationCtrl=this.navigationCtrl||new L.control.zoom({position:N}),U=this._baseMap;if(U){V.addTo(U);}},hideMapTools:function A(){var V=this._baseMap,U=this.navigationCtrl;if(V&&U){V.removeControl(U);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.geometry.PieSlice","mstrmojo.gmaps.graphic.ClusterGraphic","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic._HasPieSlices");var N=10,F=100;var H=mstrmojo.gmaps.geometry,J=mstrmojo.array;function K(O){if(O<N){return"rgba(0, 150, 255, 0.75)";}else{if(O<F){return"rgba(255, 147, 0, 0.75)";}else{return"rgba(255, 38, 0, 0.75)";}}}mstrmojo.gmaps.graphic.PieClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.ClusterGraphic,[mstrmojo.gmaps.graphic._HasPieSlices],{scriptClass:"mstrmojo.gmaps.graphic.PieClusterGraphic",totalValue:null,centerCircle:null,textLabel:null,pieSlices:null,innerR:15,outterR:25,idxOfFirstSlice:2,init:function M(R){if(!this._checkProps(R)){return ;}var T=R.screenData,O=T&&T.x,S=T&&T.y,P=R.clusterCount,Q=this;this.geometry=new H.Circle({setHover:function(U){Q.setHover(U);},defaultFillColor:K(P),radius:this.innerR,x:O,y:S});this.centerCircle=new mstrmojo.gmaps.graphic.Graphic({geometry:this.geometry});this.textLabel=new mstrmojo.gmaps.graphic.Graphic({geometry:new H.Text({text:P,isCenterAlign:true,setHover:function(U){Q.setHover(U);},x:O,y:S})});this._super(R);this.addSubGraphic(this.centerCircle);this.addSubGraphic(this.textLabel);this.createPieSliceGraphics(true,this.outterR,this.innerR,O,S);},_addGraphicIDToNode:function G(){var O=[this.centerCircle,this.textLabel];J.forEach(O,function(R){var Q=R&&R.geometry,P=Q&&Q.node;if(P){P.graphicID=this.id;}},this);},setHover:function A(O){J.forEach(this.pieSlices,function(Q){var P=Q&&Q.geometry;if(P){P.setHover(O);}});},getGraphicSize:function B(){var O=this.pieSlices&&this.pieSlices[0],P=O&&O.geometry;return(P&&P.getGeometrySize())||0;},isSelected:function D(){var P=this.pieSlices,O=true;J.forEach(P,function(Q){if(!Q.isSelected()){O=false;return false;}});return O;},matchLocationName:function I(Q){if(!Q){return[];}var P=new RegExp(Q,"i"),O=[];J.forEach(this.subGraphics,function(R){var S=R.getGeoName();if(S&&P.test(S)){O.push(R);}});return O;},getGraphicsForSelection:function C(){if(!this.pieSlices){return null;}return this.pieSlices;},isClusterGraphic:function E(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.geometry.PieSlice","mstrmojo.gmaps.graphic.ClusterGraphic","mstrmojo.gmaps.graphic._HasPieSlices");var G=mstrmojo.array,B=25;mstrmojo.gmaps.graphic.PieBubbleGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.ClusterGraphic,[mstrmojo.gmaps.graphic._HasPieSlices],{scriptClass:"mstrmojo.gmaps.graphic.PieBubbleGraphic",totalValue:null,pieSlices:null,init:function F(K){if(!this._checkProps(K)){return ;}var O=K.screenData,I=O&&O.x,N=O&&O.y,J;this._super(K);J=this.attributes||{};this.createPieSliceGraphics(false,J.radius||B,0,I,N);var H=this.pieSlices,M=H&&H[0];this.geometry=M&&M.geometry;},_addGraphicIDToNode:function D(){return ;},getPositionInfo:function A(){var H=this.pieSlices,I=H&&H[0];if(this.screenData){return this.screenData;}if(I&&I.getPositionInfo){return I.getPositionInfo();}},getDataRowIndices:function C(){var I=this.subGraphics,H=[];if(!I||!G.isArray(I)){console.log("getDataRowIndices@Graphic: ClusterGraphic with no points");return H;}G.forEach(I,function(K){var J=K.getDataRowIndices();if(G.isArray(J)){H=H.concat(J);}});return H;},matchLocationName:function E(H){var I=this.subGraphics&&this.subGraphics[0];if(I){return I.matchLocationName(H);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.ClusterImage","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.graphic.ClusterGraphic","mstrmojo.array");var N=10,D=100,M=50;var R=mstrmojo,B=R.gmaps.geometry,A=R.gmaps.graphic.Graphic,J=R.array;mstrmojo.gmaps.graphic.ImageClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.ClusterGraphic,null,{scriptClass:"mstrmojo.gmaps.graphic.ImageClusterGraphic",centerCircle:null,textLabel:null,geometry:null,init:function O(X){if(!this._checkProps(X)){return ;}var V=X.clusterCount,W=X.screenData,a=W&&W.x,Y=W&&W.y,U=this._getImageUrlPrefix(),b=this._getImageUrlColor(V),Z=this._getImageUrlSuffix(),T=this.geometry=new B.ClusterImage({imgUrl:U+b+"_rest"+Z,imgUrlA:U+b+"_highlight_a"+Z,imgUrlB:U+b+"_highlight_b"+Z,imgUrlC:U+b+"_highlight_c"+Z,width:M,height:M,x:a,y:Y});this.centerCircle=new A({geometry:T});this.textLabel=new A({geometry:new B.Text({setHover:function(c){T.setHover(c);},text:V,isCenterAlign:true,x:a,y:Y})});this._super(X);this.addSubGraphic(this.centerCircle);this.addSubGraphic(this.textLabel);},_getImageUrlPrefix:function C(){return R.getStyleRoot()+"/images/";},_getImageUrlSuffix:function C(){return"@2x.png";},_getImageUrlColor:function K(T){if(isNaN(T)){console.log("_getImageUrl(): invalid clusterCount.");return ;}if(T<N){return"blue";}if(T<D){return"orange";}return"red";},_addGraphicIDToNode:function Q(){var T=[this.centerCircle,this.textLabel];J.forEach(T,function(W){var V=W&&W.geometry,U=V&&V.node;if(U){U.graphicID=this.id;}},this);},setHover:function G(T){var U=this.geometry;if(U){U.setHover(T);}},setIsSelected:function P(T){var U=this.points;if(!U||U.length<=0){return ;}J.forEach(U,function(V){var W=V.attributes;if(!W){V.attributes={};}W._isSelected=T;});},isSelected:function H(){var U=this.points,T=true;if(!U||U.length<=0){return false;}J.forEach(U,function(V){var W=V.attributes;if(!W||!W._isSelected){T=false;return false;}});return T;},matchLocationName:function F(V){if(!V){return false;}var U=new RegExp(V,"i"),T=[];J.forEach(this.points,function(W){if(W){var X=W.attributes&&W.attributes.geoName;if(X&&U.test(X)){T.push(new A({attributes:W.attributes,geometry:new B.Point(W.geoData)}));}}});return T;},getGraphicsForSelection:function I(){return[this];},isClusterGraphic:function E(){return true;},destroy:function S(T){this.centerCircle=null;this.textLabel=null;this.geometry=null;this._super(T);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.AbstractGraphicLayerViewer","mstrmojo.gmaps.layer.svg._DataLabelViewerWrapper","mstrmojo.gmaps.layer.svg._AffinityLineViewerWrapper");var c=mstrmojo,R=c.array,J=c.gmaps,P=J.MapUtils,E=J.geometry,H=J.EnumGraphicType,C=J.EnumDefaultShapeFormatStyle,K={fillColor:C.FILL_COLOR,strokeColor:C.BORDER_COLOR};mstrmojo.gmaps.layer.svg.GraphicLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractGraphicLayerViewer,[mstrmojo.gmaps.layer.svg._DataLabelViewerWrapper,mstrmojo.gmaps.layer.svg._AffinityLineViewerWrapper],{scriptClass:"mstrmojo.gmaps.layer.svg.GraphicLayerViewer",parentDom:null,div_:null,svgNode:null,gNode:null,_gNodeForGraphics:null,init:function X(f){this._super(f);this._initLayerDomTree();this.setVisibility(false);this.buildGeometries();this.createAffinityLineLayer();},_initLayerDomTree:function Q(){var f=this.div_,i=this.parentDom,h,g;if(!f){f=this.div_=document.createElement("div");P.setLayerNodeProps(f,null,"mstrMap-graphicLayer",this.getWidth(),this.getHeight());}h=this.svgNode=P.appendSvgNode(f);if(h){g=this.gNode=P.appendGNode(h);P.setCssTransform(g,this.getGraphicsOffset());this._gNodeForGraphics=P.appendGNode(g);}if(i){i.appendChild(f);}},getNode:function G(){return this.div_;},buildGeometries:function b(){R.forEach(this.graphics,function(f){if(this.isClusterGraphic(f)){R.forEach(f.points,function(g){if(P.checkHasFunction(g,"setGeometry")){g.setGeometry(this.buildGeometry(g));}},this);}else{if(!this.isPieBubble){f.setGeometry(this.buildGeometry(f));}}f.setSelection(f.isSelected());this.appendGraphicNode(f);},this);},appendGeometries:function N(){R.forEach(this.graphics,function(f){this.appendGraphicNode(f);},this);},buildGeometry:function D(h){var g=this.getGmtCls(h.attributes);if(g instanceof Function){var f=this.getGeometryParams(h);return new g(f);}return h.geometry;},appendGraphicNode:function Y(i,h){var f=this._gNodeForGraphics,g;if(!f||!P.checkHasFunction(i,"getGeometryArr")){return ;}g=i.getGeometryArr();R.forEach(g,function(k){var j=k&&k.getNode();if(j&&(h||!j.parentNode)){f.appendChild(j);}});},appendGraphicNodeToBottom:function S(i){var f=this._gNodeForGraphics,h=f&&f.firstChild,g;if(!h||!P.checkHasFunction(i,"getGeometryArr")){return ;}g=i.getGeometryArr();R.forEach(g,function(k){var j=k&&k.getNode();if(j){f.insertBefore(j,h);}});},setTransform:function F(f){P.setCssTransform(this.gNode,f);},getGmtCls:function O(){switch(this.graphicType){case H.Area:return E.Polygon;}},getGeometryParams:mstrmojo.emptyFn,isClusterGraphic:function I(g){var f=g&&g.attributes;if(f){return f.clusterCount>1;}},setShapeFillColor:function B(g,f){g=g===undefined?K.fillColor:g;R.forEach(f,function(h){if(h&&h.geometry){h.geometry.setFillColor(g);}});},setShapeFillOpacity:function a(g,f){if(g){R.forEach(f,function(h){if(h&&h.geometry){h.geometry.setFillOpacity(g);}});}},setShapeStrokeColor:function W(g,f){g=g===undefined?K.strokeColor:g;R.forEach(f,function(h){if(h&&h.geometry){h.geometry.setStrokeColor(g);}});},setShapeStrokeStyle:function Z(g,f){if(g){R.forEach(f,function(h){if(h&&h.geometry){h.geometry.setStrokeWidthAndStyle(g.shapeBorderWidth,g.shapeBorderStyle,g.shapeBorderLineDash);}});}},moveGraphicToTop:function T(g){var f=g.parentGraphic;if(f){this.appendGraphicNode(f,true);f.moveGraphicToTop(g);}else{this.appendGraphicNode(g,true);}},moveGraphicToBottom:function e(g){var f=g.parentGraphic;if(f){f.moveGraphicToBottom(this._gNodeForGraphics,g);}else{this.appendGraphicNodeToBottom(g);}},update:function M(){this.updateDataLabelLayer();this.updateAffinityLineLayer();},destroyGeometries:function V(){R.forEach(this.graphics,function(g){if(P.checkHasFunction(g,"getGeometryArr")){var f=g&&g.getGeometryArr();R.forEach(f,function(h){if(P.checkHasFunction(h,"destroy")){h.destroy();delete g.gmt;}});}else{console.log("Graphic has already been destroyed.");}},this);},clean:function U(){P.emptyDomElement(this._gNodeForGraphics);},destroy:function d(){this.removeDataLabelLayer();delete this.parentDom;P.destroyNode(this.div_);delete this.div_;delete this.svgNode;delete this.gNode;delete this._gNodeForGraphics;this.destroyGeometries();this._super();},clearHighlights:function A(){R.forEach(this.graphics,function(g){var f=g.getGraphicsForSelection();R.forEach(f,function(h){h.setSelection(false);});});}});}());(function(){mstrmojo.requiresCls("mstrmojo.num","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.gmaps.MapLegendContainer","mstrmojo.gmaps.MapLegendEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums");var f=mstrmojo,e=f.num,W=f.array,A=f.VisUtility,N=f.gmaps,V=N.MapUtils,X=N.EnumPropertyType,Q=N.EnumMinSizeType,c=N.MapLegendContainer;function I(m,k){var l=m.nf||[],j=l.length,i;if(k>=0&&k<j){i=A.getNumberFormat(m,k);return i.replace(/'/g,'"');}return"";}function G(s){var w=s.dropZones&&s.dropZones.colorBy,q=s.data,u=q&&q.gsi,v=u&&u.mx,x=u&&u.thresholds,j=null,k=null,m=s.getLayerFmts(),n,p,t,r,l,o,i;if(w&&x){W.forEach(v,function(z,y){if(z.did===w){j=z;k=y;}});if(j){n=x[w];p=n&&n[0];if(!p){return null;}o=p.rtp===4;if(p&&(o||(p.fmt&&p.fmt.bc))){t=A.getRankMode(n);r=A.getColorByFormatStr(I(q,k),t);l=A.getColorByItems(n,t,j.max,j.min,j.cnt,r);if(o){W.forEach(l,function(z,y){if(n[y]){i=V.convertImageUrl(n[y].rtxt);z.image="url("+i+")";}});}else{W.forEach(l,function(y){y.opacity=m.fillOpacity;});}return{item:A.getColorByTitle(j.n,t),elements:l};}}}return null;}function R(n,p){var o,j,r,t,s,l,m,u,q,k;j=n&&n.length;if(j===undefined){return{min:undefined,max:undefined};}m=undefined;q=undefined;for(o=0;o<j;o+=1){r=n[o].items||[];t=r.length;if(p<t&&p>=0){l=r[p];if(l!==undefined){l=parseFloat(l.rv);if(!isNaN(l)){s=Math.abs(l);if(m===undefined||m>s){m=s;u=l;}if(q===undefined||q<s){q=s;k=l;}}}}}return{min:u,max:k};}function a(p){var l=p.dropZones&&p.dropZones.sizeBy,m=p.data,r=m&&m.gsi,t=r&&r.mx,u=r&&r.thresholds,n=null,i=null,o,k,j=m&&m.gvs,q,s;if(l&&u){W.forEach(t,function(w,v){if(w.did===l){n=w;i=v;}});if(n){q=parseInt(p.getLayerProp(X.MIN_SIZE_TYPE))===Q.PROPORTIONAL;o=I(m,i);k=[];if(q&&n.min<0){s=R(j.items,i);if(s.min===undefined||s.max===undefined){return null;}k.push(e.formatByMask(o,s.max));k.push(e.formatByMask(o,s.min));}else{k.push(e.formatByMask(o,n.max));k.push(e.formatByMask(o,n.min));}return{item:n.n,elements:k};}}return null;}function U(i){i.colorByInfo=i.isColorByAttr?i.legendColorByElements:G(i);i.sizeByInfo=a(i);}function F(i){var j=this;if(j.hasColorByOrSizeBy(i.key)){U(i);return true;}return false;}mstrmojo.gmaps._MapLegendController=mstrmojo.provide("mstrmojo.gmaps._MapLegendController",{_mixinName:"mstrmojo.gmaps._MapLegendController",legendCon:null,legendSlots:{},initializeLegendCon:function d(){var i,k=this,j=k.legendPlaceholder;if(!!k.legendCon){return ;}i=this.legendCon=new c({placeholder:j});i.render();i.domNode.id="map-legend-container-docked-node";i.initializeLgdCon(k);i.calDefaultDockedPositions();},createSingleLegend:function T(k){var i,j=this.getGraphicLayer(k);if(!this.legendCon){this.initializeLegendCon();}i=this.legendCon;if(!F.call(this,j)){return false;}i.createSingleMapLegend(k,j.getLegendShowProperty());return true;},isLegendExist:function P(j){var i=this.legendCon;if(!i){return false;}return i.isLegendExist(j);},switchLegend:function g(k,j){var i=this.legendCon;if(!i){return ;}if(k){i.showSingleLegend(j);}else{if(k===false){i.hideSingleLegend(j);}}},refreshLegendNodes:function H(){if(!this.legendCon){return ;}this.legendCon.refreshMapLegendNodes();},resizeLegendByWidget:function S(){if(!this.legendCon){return ;}this.legendCon.handleWidgetResize();},resetLegendColorByData:function M(j){if(!this.legendCon){return ;}var i=this.getGraphicLayer(j);i.colorByInfo=i.isColorByAttr?i.legendColorByElements:G(i);this.legendCon.resetLegendColorByData(j,i.colorByInfo);},resetLegendSizeByData:function E(j){if(!this.legendCon){return ;}var i=this.getGraphicLayer(j);i.sizeByInfo=a(i);this.legendCon.resetLegendSizeByData(j,i.sizeByInfo);},refreshLegendColorByData:function K(j){if(!this.legendCon){return ;}var i=this.getGraphicLayer(j);this.legendCon.resetLegendColorByData(j,i.colorByInfo);},destroyLegend:function D(i){if(!this.legendCon){return ;}this.legendCon.destroyLegend(i);},destroyLegendCon:function Y(){if(!this.legendCon){return ;}this.legendCon.destroyLegendCon();this.legendCon=null;},updateLegendTitle:function b(j,i){if(!this.legendCon){return ;}this.legendCon.updateLegendTitle(j,i);},handleLegendOnLayerVisibleChange:function C(i){if(!this.legendCon){return ;}this.legendCon.handleLayerVisibleChange(i);},handleLegendConSizePropChange:function J(i){if(!this.legendCon){return ;}this.legendCon.handleLegendConSizePropChange(i);},removeLegendBySwitchProp:function O(i){if(!this.legendCon){return ;}this.legendCon.removeLegendBySwitchProp(i);},resetLegendContainerHeight:function Z(){if(!this.legendCon){return ;}this.legendCon.resetLegendConHeight();},getLegendConSizeProp:function h(){if(!this.legendCon){return undefined;}return this.legendCon.getLegendConSizeProp();},handleLegendCollapsePropChange:function B(i,j){if(!this.legendCon){return ;}this.legendCon.handleLegendCollapsePropChange(i,j);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.geometry.Polygon","mstrmojo.gmaps.layer.svg.GraphicLayerViewer");var F=mstrmojo,A=F.hash,E=F.array,D=F.gmaps.geometry.Polygon;function G(K){if(!E.isArray(K)){return ;}var M=[],J;E.forEach(K,function(N){J=[];E.forEach(N,function(O){if(O){J.push({lat:O[1],lng:O[0]});}});M.push(J);});return M;}function C(J){var K=J&&J[0]&&J[0].geoData,M=K&&K[0]&&K[0][0];if(M){return E.isArray(M);}}mstrmojo.gmaps.layer.svg.PolygonLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.GraphicLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.svg.PolygonLayerViewer",init:function I(K){this._super(K);var J=this.graphics;if(C(J)){E.forEach(J,function(M){if(M){M.geoData=G(M.geoData);}});}},getGmtCls:function B(){return D;},getGeometryParams:function H(N){if(!N||!N.attributes){return ;}var K=N.attributes.threshold,J=N.screenData&&N.screenData.screenPolylineArr,M=A.copy({screenPolylineArr:J},this.getFmts());if(K){M.fillColor=K.colorStr;}return M;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.ImageClusterGraphic","mstrmojo.gmaps.graphic.PieClusterGraphic");var K=mstrmojo,I=K.array,A=K.hash,F=K.gmaps,G=F.MapUtils,B=F.EnumClusterMode;function H(N,M){delete N.clusterId;M.push(N);}function C(M,R){if(!M||!R){return ;}var S=R.geoData,Q=R.screenData,N=M.geoData,P=M.screenData,O=M.attributes.clusterCount;if(S&&Q&&N&&P){P.x=(Q.x+(P.x*O))/(O+1);P.y=(Q.y+(P.y*O))/(O+1);N.lat=(S.lat+(N.lat*O))/(O+1);N.lng=(S.lng+(N.lng*O))/(O+1);}}mstrmojo.gmaps.layer.svg._ClusterViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.svg._ClusterViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.svg._ClusterViewerWrapper",buildClusterGraphics:function D(){var M=this.graphics,N=this.parent;if(N&&I.isArray(M)&&M.length>0){this._createAndAddClusters(M);if(G.checkHasFunction(N,"highlightFromViSelection")){N.highlightFromViSelection();}}},_createAndAddClusters:function(M){var N=this._createAllClusters(M);this._addAllClusters(N);},_createAllClusters:function(O){var T,N,M,U,S=[],R,P,Q=O.length;for(P=0;P<Q;P++){T=O[P];N=false;M=S.length;for(R=0;R<M;R++){U=S[R];if(this._clusterTest(T,U)){this._clusterAddPoint(T,U);N=true;break;}}if(!N){S.push(this._clusterCreate(T,S.length+1));}}return S;},_clusterTest:function(Q,N){var O=Q&&(Q.screenData||Q.getPositionInfo()),M=N&&N.screenData,R,P=function(S){return S&&!isNaN(S.x)&&!isNaN(S.y);};if(P(O)||P(M)){R=Math.sqrt(Math.pow((M.x-O.x),2)+Math.pow((M.y-O.y),2));return R<=this.clusterRadius;}else{return false;}},_clusterAddPoint:function(P,M){var O=P.attributes,N=M.attributes;C(M,P);N.clusterCount++;if(!P.hasOwnProperty("attributes")){O={};}O.clusterId=N.clusterId;if(!N.geoIndices){N.geoIndices=[];}if(!N.longGeoIndices){N.longGeoIndices=[];}N.geoIndices.push(O.geoIndex);N.longGeoIndices.push(O.longGeoIndex);if(!N.rowIndices){N.rowIndices=[];}N.rowIndices=N.rowIndices.concat(O.rowIndices);if(!N.columnIndices){N.columnIndices=O.columnIndices;}if(this.isCluster){M.points.push(P);}},_clusterCreate:function(R,O){var P=R.attributes,Q=R.getPositionInfo(),M,N;if(!P){P={};}P.clusterId=O;M={parent:R.parent,geoData:A.clone(R.geoData),screenData:A.clone(Q),points:[R]};N=A.clone(P);N.clusterCount=1;N.clusterId=O;N.geoIndices=[P.geoIndex];N.longGeoIndices=[P.longGeoIndex];N.dlTextName=P.dataLabelText;M.attributes=N;return M;},_addAllClusters:function(O){var N=this.getClusterGraphicCls(this.clusterMode),M=this.graphics=[],P;I.forEach(O,function(Q){P=this._createAndAddGraphic(Q,N);if(P){M.push(P);}},this);},_createAndAddGraphic:function(N,M){if(!N||!M){return ;}if(!this.isClusterGraphic(N)){return N.points[0];}else{return new M(N);}},getClusterGraphicCls:function E(M){if(M===B.PIE){return F.graphic.PieClusterGraphic;}else{return F.graphic.ImageClusterGraphic;}},desolveClusterGraphics:function J(){var N=this.graphics,M=this.parent;if(!M){return ;}I.forEach(N,function(O){if((O instanceof F.graphic.ImageClusterGraphic)&&this.isClusterGraphic(O)){O.points=null;if(G.checkHasFunction(O,"destroy")){O.destroy();}}},this);this.graphics=M.graphics;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.basemap.EsriBaseLayer","mstrmojo.gmaps.basemap.GoogleBaseLayer","mstrmojo.gmaps.basemap.ImageBaseLayer","mstrmojo.gmaps.basemap.MapboxGLBaseLayer","mstrmojo.gmaps.basemap.MapboxBaseLayer");var G=mstrmojo.gmaps,H=G.basemap,A=G.EnumBaseMapType;function F(I,J){if((I.getZoom instanceof Function)&&(I.getLngLatCenter instanceof Function)){J.originalZoom=parseInt(I.getZoom());J.originalLatLngCenter=I.getLngLatCenter();if(J.GL_SUPPORTED){if(I.baseMapType===A.Mapbox){J.originalZoom++;}else{if(J.baseMapType===A.Mapbox){J.originalZoom--;}}}}return J;}function E(I){if(!I.GL_SUPPORTED){return new H.MapboxBaseLayer(I);}return new H.MapboxGLBaseLayer(I);}mstrmojo.gmaps.basemap.BaseLayerFactory=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.gmaps.basemap.BaseLayerFactory",_baseLayer:null,create:function D(J){var I=this._baseLayer;if(I&&I.baseMapType!==J.baseMapType){J=F(I,J);this.destroy();}if(!this._baseLayer){switch(J.baseMapType){case A.Esri:default:this._baseLayer=new H.EsriBaseLayer(J);break;case A.Google:this._baseLayer=new H.GoogleBaseLayer(J);break;case A.Image:this._baseLayer=new H.ImageBaseLayer(J);break;case A.Mapbox:this._baseLayer=E(J);break;}}return this._baseLayer;},get:function B(){return this._baseLayer;},destroy:function C(){if(this._baseLayer&&this._baseLayer.destroy){this._baseLayer.destroy();}delete this._baseLayer;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.SVGImage","mstrmojo.gmaps.geometry.Pin","mstrmojo.gmaps.geometry.Square","mstrmojo.gmaps.geometry.Diamond","mstrmojo.gmaps.layer.svg.GraphicLayerViewer","mstrmojo.gmaps.layer.svg._ClusterViewerWrapper");var R=mstrmojo,M=R.hash,E=R.gmaps,J=E.MapUtils,C=E.geometry,Q=E.EnumThresholdType,S=E.EnumMarkerType,K=mstrmojo.getStyleRoot()+"/../images/balloonpp.png",N={fontFamily:"Serif",fontSize:"12pt",fontWeight:"bold",fontStyle:"normal"};function A(U,W){var V;if(!U){return ;}W.imgUrl=U.url||W.imgUrl;W.fillColor=U.colorStr||W.fillColor;V=U.text;if(J.checkDefined(V)){W.text=V;M.copy(N,W);}}mstrmojo.gmaps.layer.svg.MarkerLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.GraphicLayerViewer,[mstrmojo.gmaps.layer.svg._ClusterViewerWrapper],{scriptClass:"mstrmojo.gmaps.layer.svg.MarkerLayerViewer",imageMarkerUrl:null,isCluster:null,clusterMode:null,isMarkerMapType:true,getGmtCls:function I(V){var W,U=V&&V.threshold;switch(this.markerType){case S.Pin:default:W=C.Pin;break;case S.Square:W=C.Square;break;case S.Diamond:W=C.Diamond;break;case S.Image:W=C.SVGImage;break;}return U?this.getThresholdGeometryClass(W,U):W;},getThresholdGeometryClass:function T(W,V){var U=W;if(this.applyThreshold){if(this.needApplyThresholdForImages(V)){U=C.Pin;}else{switch(V.type){case Q.Url:U=C.SVGImage;break;case Q.Text:U=C.Text;break;}}}return U;},needApplyThresholdForImages:function F(U){return !!U&&(U.type===Q.Number||U.type===Q.Default)&&this.markerType===S.Image&&this.imageMarkerUrl;},getGeometryParams:function O(X){if(!X||!X.attributes){return ;}var V=X.screenData,U=X.attributes.threshold,W=M.copy(this.getFmts());if(V&&J.checkVal(V.x)&&J.checkVal(V.y)){W.x=V.x;W.y=V.y;}if(this.markerType===S.Image){W.imgUrl=this.imageMarkerUrl?mstrmojo.getStyleRoot()+"/../"+this.imageMarkerUrl:K;}A(U,W);return W;},setMarkerType:function P(U){if(U===this.markerType){return ;}this.markerType=U;this.buildGeometries();},setClusterMode:function B(U,V){this.clusterMode=U;this.isCluster=V;this.setVisibility(false);this.clean();this.desolveClusterGraphics();if(V){this.buildClusterGraphics();}this.appendGeometries();this.setVisibility(true);},desolveClustersIfZoomChanged:function D(){if(this._zoom!==this.getMapZoom()){this.desolveClusterGraphics();}},isZoomChanged:function H(){var U=this.getMapZoom();if(this._zoom!==U){this._zoom=U;return true;}},update:function G(){var U=this.isCluster;if(U&&this.isZoomChanged()){this.setClusterMode(this.clusterMode,U);}this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.layer.svg.MarkerLayerViewer");var D=mstrmojo.gmaps,B=D.geometry.Circle;mstrmojo.gmaps.layer.svg.BubbleLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.MarkerLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.svg.BubbleLayerViewer",isMarkerMapType:true,getGmtCls:function A(){return B;},getGeometryParams:function C(G){if(!G){return ;}var E=G.attributes,F=this._super(G)||{};F.radius=E&&E.radius;return F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.geometry.Polygon","mstrmojo.gmaps.geometry.TangentPath","mstrmojo.gmaps.layer.svg.BubbleLayerViewer");var H=mstrmojo,F=H.array,D=H.gmaps,G=D.MapUtils,E=D.geometry;mstrmojo.gmaps.layer.svg.PathLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.BubbleLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.svg.PathLayerViewer",textLabelBox:null,textLabel:null,init:function J(N){this._super(N);var M=this.graphics=this.graphics||[],S=M[0]&&M[0].geoData;var Q=new E.Polygon({fillColor:"white",fillOpacity:1,strokeColor:"#000000",strokeWidth:0.8,strokeOpacity:1}),K=this.textLabelBox=new D.graphic.Graphic({parent:this,attributes:{},geometry:Q,isText:true});M.push(K);Q.getNode().setAttribute("cursor","pointer");if(S){var R=this.parent&&this.parent.data.n,P=new E.Text({text:R,fontFamily:"Roboto",fontSize:"12px",fillColor:"#343434",fillOpacity:1,skipStrokeProperty:true,lat:S.lat,lng:S.lng}),O=this.textLabel=new D.graphic.Graphic({parent:this,attributes:{},geometry:P,isText:true});M.push(O);P.getNode().setAttribute("cursor","pointer");}},buildGeometries:function B(){F.forEach(this.graphics,function(K){if(K.isPath){K.setGeometry(this.buildPathGeometry(K));}else{K.setGeometry(this.buildGeometry(K));}K.setSelection(K.isSelected());this.appendGraphicNode(K);},this);},buildPathGeometry:function A(N){var K=N.graphicFrom.geometry,M=N.graphicTo.geometry;if(!K||!M){return ;}return new E.TangentPath({fillColor:N.attributes.fillColor,radiusA:K.radius||K.outterR,radiusB:M.radius||M.outterR,strokeWidth:0,strokeOpacity:1,visibility:"hidden"});},update:function C(){this._super();G.showWait();var P=-20,T=10,K=4,U=8;var M=this.textLabel.geometry,N=M.node,R=M.x+P,Q=M.y+T,S=N.clientWidth,O=N.clientHeight;M.update({x:R+K,y:Q+O});this.textLabelBox.geometry.update({screenPolylineArr:[[{x:R,y:Q},{x:R+S+U,y:Q},{x:R+S+U,y:Q+O+U},{x:R,y:Q+O+U},{x:R,y:Q}]]});G.hideWait();},destroy:function I(){G.destroyObj(this.textLabelBox);G.destroyObj(this.textLabel);delete this.textLabelBox;delete this.textLabel;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Container","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.VisualizationEditorUnitList");var q=mstrmojo,U=q.Widget,V=q.dom,D=q.css,r=q.array,Y=q.hash,f=q.emptyFn,O=q.gmaps,B=O.MapUtils,K=q.vi.models.EnumDragSources,I=O.EnumPropertyType,w=q.vi.ui.DatasetUnitMenuUtils,b=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,AH=b.ABOVE,AG=b.ON,W=b.BELOW,v="mstrmojo-VIVizEditor-Menu";var Z={};Z[AH]="Top";Z[AG]="";Z[W]="Bottom";var n=[];var X=false;function y(){return{scriptClass:"mstrmojo.gmaps.MapLayerItemContainer",items:[],alias:"layerList"};}function z(){return{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(531,"Add"),alias:"addBtn",cssClass:"link-btn",onclick:function(){this.parent.onaddLayer();}};}function E(AI,AL,AJ,AM){var AK=this;AI.addMenuItem(mstrmojo.desc(1388,"Rename"),"xt",function(){if(!AM){return ;}w.renameItem(AM,AL,function(AO){var AN=AO.text.trim(),AR=function(){var AS=AK.parent;if(AS){AS.onrenameLayer(AL,AN);}},AQ=function(){AO.set("text",AL.n);},AP=AJ.some(function(AS){return AS.n===AN;});if(AP){mstrmojo.warn(mstrmojo.desc(11664,'"##" already exists in the map. Do you want to proceed?').replace("##",AN),{confirmBtn:{fn:AR},cancelBtn:{fn:AQ}});}else{AR();}},{allowEmptyText:false,cssClass:AM.className});});}function k(AI,AJ){var AK=this;AI.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){AK.onremoveItems(AJ);});}function x(AN,AK,AI){var AM=new mstrmojo.ui.menus.MenuConfig({menuCssClass:v,hostId:this.id,position:AI,hostElement:this.itemsContainerNode,isHostedWithin:false}),AJ=this.items,AL=this.getLabelNode(AK);if(AN&&AN.length===1){E.call(this,AM,AN[0],AJ,AL);}if(AJ&&AJ.length>1){k.call(this,AM,AN);}this.openPopup(AM.newInstance());}function AF(AJ,AI){if(AI){D.addClass(AJ,"select");if(AJ.children&&AJ.children[0]){D.addClass(AJ.children[0],"select");}}else{D.removeClass(AJ,"select");if(AJ.children&&AJ.children[0]){D.removeClass(AJ.children[0],"select");}}}mstrmojo.gmaps.MapLayerItemContainer=mstrmojo.declare(mstrmojo.vi.ui.VisualizationEditorUnitList,null,{scriptClass:"mstrmojo.gmaps.MapLayerItemContainer",cssClass:"MapLayerItemContainer",icnCss:"MapLayerItemContainer-container",multiSelect:X,zoomLevelSub:null,getItemMarkup:function R(AJ){var AI=this._super(AJ);AI=AI.replace("zone","{@zoneCls}");return AI;},getItemProps:function(AK,AI){var AJ=this._super(AK,AI);AJ.zoneCls="zone eye";return AJ;},enableSetLayerVisibility:function(){var AK=this,AJ=Y.walk("parent.vis.mapViewer",this);r.forEach(this.items,function(AL){AK.refreshNodeStatus(AL.k);});var AI=AJ&&AJ.baseLayer;if(AI){AK.zoomLevelSub=AI.attachEventListener("zoomLevelChanged",AK.id,function(){r.forEach(AK.items,function(AL){AK.refreshNodeStatus(AL.k);});});}},postBuildRendering:function(){var AI=this.parent,AJ=Y.walk("parent.vis.mapViewer.graphicLayerMapping",this);if(AI){this.zonesModel=AI.zonesModel;this.selectedIndices=AI.selectedIndices;this._shiftStartIndex=AI._shiftStartIndex;this.updateSelectedItems();this.showContextMenu();}if(AJ&&Object.keys(AJ).length>0){this.enableSetLayerVisibility();}},updateSelectedItems:function P(AK){var AM=this.selectedIndices,AJ=this.itemsContainerNode.children,AO=this.getSelectedItems(),AL=this.parent,AN,AI;if(!AL||!AM||Object.keys(AM).length<1||!AJ||AJ.length<1||!r.isArray(AO)){return ;}for(AI in AJ){AF(AJ[AI],!!AM[AI]);}this.cacheSelectedInfo();if(!!AK){AN=this.selectedItem||AO[0];AL.onselectLayer(AN);}},getItemDisplayName:function(AI){return AI.n;},onItemContextMenu:function e(AL,AI){var AK=this.parent,AM=AK&&AK.vis,AJ=AM&&AM.getEditingGridKey();if(AL&&(AL.k===AJ)){this._super(AL,AI);}else{if(AL&&AM){AM.layerZoneCxtMnInfo={item:AL,source:AK.source,mousePos:V.getMousePosition(AI.e,AI.hWin)};this.closePopup();this.handleSelect(AI);}}},showContextMenu:function m(){var AJ=this.parent,AL=AJ&&AJ.vis,AI=AL&&AL.layerZoneCxtMnInfo,AK,AM;if(AI&&(AI.source===AJ.source)){AK=AI.item;AM=this.domNode.querySelector('div.item.unit[idx="'+AK._renderIdx+'"]');this.showItemMenu(AK,AM,AI.mousePos);delete AL.layerZoneCxtMnInfo;}},showItemMenu:function N(AK,AJ,AI){x.call(this,[AK],AJ,AI);},showMultiSelectionMenu:function h(AJ,AK,AI){x.call(this,AJ,AK,AI);},isInEditingMode:function J(){var AI=this.domNode.querySelectorAll("div.mstrmojo-EditableLabel.editable");if(AI.length>0){AI[0].blur();return true;}return false;},isLayerVisible:function(AJ){var AI=this.parent.vis.mapViewer,AK=AI.getGraphicLayer(AJ);return AK&&AK.isVisible();},canShowLayer:function(AJ){var AI=this.parent.vis.mapViewer,AK=AI.getGraphicLayer(AJ);return AK&&AK.isLayerInZoomRange();},refreshNodeStatus:function S(AP){var AI="state-show",AL="state-hide",AQ="state-invisible",AJ=this.isLayerVisible(AP),AO=this.canShowLayer(AP),AM=AJ&&AO,AK,AN=this;r.forEach(this.items,function(AR){if(AR.k==AP){var AS=AN._getItemNode(AR._renderIdx);AK=AN.getZoneNode(AS);}});if(AM){D.removeClass(AK,AL);D.removeClass(AK,AQ);D.addClass(AK,AI);}else{D.removeClass(AK,AI);D.addClass(AK,AL);D.toggleClass(AK,AQ,!AO);}},onclick:function t(AI){if(this.handleSetLayerVisibility(AI)){return ;}this.handleSelect(AI);},handleSetLayerVisibility:function u(AJ){var AP=AJ.getTarget(),AK=AP.className;if(AK.indexOf("eye")!==-1){if(AK.indexOf("state-invisible")===-1){var AM=this.getItemFromTarget(AP),AL=AM.k;if(this.canShowLayer(AL)){var AO=this.parent&&this.parent.vis,AI=this.isLayerVisible(AL);AI=!AI;if(AO){var AN=AI?"0":"1";AO.writeProperties(I.isHidden,AN,AL);}}}return true;}return false;},handleSelect:function AC(AI){try{var AM=AI.getTarget(),AJ=AM.className,AN={};if(AJ.indexOf("editable")!==-1){return ;}if(this.isInEditingMode()){return ;}Y.copy(this.selectedIndices,AN);var AL=this.getItemFromTarget(AM);if(AL){AI.cancel();this.doItemSelect(AL,AI||{});}if(this.selectedIndices&&Object.keys(this.selectedIndices).length<1){this.selectedIndices=AN;}else{this.updateSelectedItems(true);}}catch(AK){mstrApp.onerror(AK);}},cacheSelectedInfo:function T(){var AI=this.parent,AJ=AI&&AI.vis;if(AJ){AJ.layerZoneCacheInfo={selectedIndices:this.selectedIndices,_shiftStartIndex:this._shiftStartIndex};}},onmouseover:f,onmouseout:f,onremoveItems:function l(AI){var AJ=this.parent;if(AJ){AJ.onremoveLayers(AI);}},onclearSelections:function AB(){try{var AI=this.itemsContainerNode.childNodes,AM,AL,AJ;for(AL=0,AJ=AI.length;AL<AJ;AL++){AM=AI[AL].children[0].className;AI[AL].children[0].className=AM.replace(/(?:^|\s)select(?!\S)/g,"");}}catch(AK){mstrApp.onerror(AK);}},getDragData:function s(AI){var AK=this._super(AI),AJ=this;AK.src=K.VIZ_LAYER;AK.onRemove=function(AL){AJ.onremoveItems(AL);};return AK;},ondragover:function p(AL){var AT=this,AR=AL.tgt,AK=AT.getItemNodeFromTarget(AR.node)||AR.node,AM=AL.tgtData,AN=AM&&AM.node,AJ,AP,AO,AS,AI,AQ;if(!AM||AN!==AK){AM=AL.tgtData={item:AT.items[parseInt(AK.getAttribute("idx"),10)],node:AK,pos:V.position(AK,true)};if(AN){this.clearBorderClasses(AN);}}this.clearBorderClasses(AK);AJ=this.getTargetEdgeAndIndex(AM.pos,AR.e,AL,AK);AP=AJ&&AJ.edge;AO=this.getContextDragData(AL);AS=AJ&&Y.copy(AJ,this.getAllowDropInfo(AO.items,AJ.idx,AJ.edge));if(AS&&AS.allowedItems.length){if(AO.setAvatarClass){AI=AO.src;AQ="";if(AI===K.VIZ_LAYER&&(AP===AH||AP===W)){AQ="move";D.addClass(AK,"dragIn"+Z[AP]);n.push(AK);}AO.setAvatarClass(AQ);}}else{if(AO.setInvalidAvatarClass){AO.setInvalidAvatarClass();}}},ondrop:function o(AJ){if(!AJ||!AJ.tgtData){return ;}var AM=AJ.tgt,AK=AJ.getCtxtDragData(),AI=this.getTargetEdgeAndIndex(AJ.tgtData.pos,AM.e,AJ,this.getItemNodeFromTarget(AM.node)||AM.node),AL=AI&&AI.edge,AO=AI&&Y.copy(AI,this.getAllowDropInfo(AK.items,AI.idx,AL)),AQ=this.parent,AN=AO&&AO.allowedItems,AP;this._super(AJ);if(AN&&AN.length>0){AP=(AL===W)?AI.idx+1:AI.idx;this.updateSelectedItems();if(AQ){AQ.onLayerDropped(r.map(AN,function(AR){return AR&&AR._renderIdx;}),AP);}}},getAllowDropInfo:function A(AJ,AI,AK){return{allowedItems:AJ.concat(),removeReplaced:AK===b.ON&&r.find(AJ,"k",this.items[AI].k)===-1};},isDragValid:function g(AI){var AJ=AI.src.e;return(!(AJ.ctrlKey||AJ.shiftKey||AJ.metaKey)||this._super(AI)||false);},createAvatar:function j(AO,AL){var AK=document.createElement("div"),AN=AL.getCtxtDragData(),AI=AN.items,AJ=['<div class="',AO.parentNode.className,'">'],AM=this;AK.className=mstrApp.getThemeClassName();AI.forEach(function(AQ){var AR=AM.getItemDisplayName(AQ),AP="MapLayerZoneItem item unit isAvatar";AJ.push('<div class="'+AP+'"><div class="outer-wrap"><div class="inner-wrap"><span class="txt">'+AR+'</span><div class="icon"></div></div></div></div>');});AJ.push("</div>");AK.innerHTML=AJ.join("");return AK;},allowDrop:function G(AI){var AJ=AI.getCtxtDragData();return AJ&&(AJ.src===K.VIZ_LAYER);},getDropAvatarIcon:function C(){return"pivot";},destroy:function AA(){var AI=Y.walk("parent.vis.mapViewer.baseLayer",this),AJ=this.zoomLevelSub;if(AI&&AJ){AI.detachEventListener(this.zoomLevelSub);}delete this.zoomLevelSub;this._super();}});mstrmojo.gmaps.MapLayerZone=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.gmaps.MapLayerZone",markupString:'<div id="{@id}" class="mstrmojo-ui-MapLayerZone {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:U.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod,onheightChange:U.heightMarkupMethod,onwidthChange:U.widthMarkupMethod},ignoreLayout:false,items:null,shouldPropagateEnabled:true,selectedItemIdx:null,selectedIndices:null,vis:null,source:undefined,zonesModel:null,children:[y(),z()],init:function AE(AI){this._super(AI);this.items=this.items||[];var AJ=this.vis;if(AJ){this.zonesModel=AJ.zonesModel;this._loadSelectionInfo(AJ.layerZoneCacheInfo);}this.onitemsChange();},_loadSelectionInfo:function AD(AL){var AJ=this.selectedItemIdx,AK,AI;if(X){Y.copy(AL,this);AK=this.selectedIndices=this.selectedIndices||{};AI=this._shiftStartIndex;if(!B.checkVal(AI)||AI===-1){this._shiftStartIndex=parseInt(AJ);}}else{AK=this.selectedIndices={};}AK[AJ]=true;},onitemsChange:function a(){this.layerList.set("items",this.items);},getSelectedItem:function d(){return this.layerList.selectedItem;},selectItemByField:function c(AJ,AI){this.layerList.singleSelect(r.find(this.layerList.items,AJ,AI));},onselectLayer:function H(AI){var AJ=this.vis;if(AJ&&AI&&AI.k){AJ.writeProperties(I.editingLayerIdx,AI._renderIdx);if(AJ.excludeData){AJ.refresh();}}},onaddLayer:function M(){var AI=this.vis;if(AI){AI.addMapLayer();}},onremoveLayers:function Q(AI){var AJ=this.vis;if(AJ){AJ.removeMapLayers(r.map(r.ensureArray(AI),function(AK){return AK&&AK.k;}));}},onLayerDropped:function F(AI,AK){var AJ=this.vis;if(AJ){AJ.layerDroppedCallback(AI,AK);}},onrenameLayer:function i(AJ,AI){var AK=this.vis;if(AK&&AJ&&AJ.k){AK.renameGraphicLayerCallback(AJ.k,AI);}},destroy:function AA(){delete this.vis;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.svg.GraphicLayerViewer","mstrmojo.gmaps.layer.svg.MarkerLayerViewer","mstrmojo.gmaps.layer.svg.BubbleLayerViewer","mstrmojo.gmaps.layer.svg.PolygonLayerViewer","mstrmojo.gmaps.layer.svg.PathLayerViewer","mstrmojo.gmaps.layer.canvas.DensityLayerViewer","mstrmojo.gmaps.layer.mapbox.CircleLayerViewer","mstrmojo.gmaps.layer.mapbox.ImageLayerViewer","mstrmojo.gmaps.layer.mapbox.MarkerLayerViewer","mstrmojo.gmaps.layer.mapbox.PolygonLayerViewer");var B=mstrmojo.gmaps,G=B.MapUtils,A=B.layer,I=B.EnumGraphicType,H=B.EnumMarkerType,E=B.EnumRenderMethod;F:function F(M,K){var J;if(K===E.mapbox){switch(M.graphicType){case I.Area:return"PolygonLayerViewer";case I.Bubble:return"CircleLayerViewer";case I.Density:return"CircleLayerViewer";case I.Marker:J=M.parent&&M.parent.hasImgThreshold();if(J||M.markerType===H.Image){return"ImageLayerViewer";}else{if(M.markerType&&M.markerType!==H.Circle){return"MarkerLayerViewer";}}default:return"CircleLayerViewer";}}else{if(K===E.svg){switch(M.graphicType){case I.Area:return"PolygonLayerViewer";case I.Bubble:return"BubbleLayerViewer";case I.Path:return"PathLayerViewer";case I.Marker:default:return"MarkerLayerViewer";}}else{if(K===E.canvas){return"DensityLayerViewer";}}}}mstrmojo.gmaps.layer.GraphicLayerViewerFactory=mstrmojo.provide("mstrmojo.gmaps.layer.GraphicLayerViewerFactory",{_mixinName:"mstrmojo.gmaps.layer.GraphicLayerViewerFactory",create:function C(N,M){if(N&&M){var K=F(N,M),J=A[M][K];if(J){return new J(N);}}},callFnForViewer:function D(K,M){var J=Array.prototype.slice.call(arguments,2);if(G.checkHasFunction(K,M)){K[M].apply(K,J);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.css","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.util.TemplateUtils","mstrmojo.gmaps.layer.Layer","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps._MapDataLabel","mstrmojo.gmaps._MapAffinityLine","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.vi.ui.rw._HasGraphicsSelections","mstrmojo.gmaps.layer._GraphicLayerDataHelper","mstrmojo.gmaps.layer._GraphicLayerDataSelectionHelper","mstrmojo.gmaps.layer._InfoWindowHelper","mstrmojo.gmaps.layer._LassoSelectHelper","mstrmojo.gmaps.layer.GraphicLayerViewerFactory","mstrmojo.gm.GMEnums","mstrmojo.gmaps.layer._LayerInteractivity","mstrmojo.models.template.DataInterface","mstrmojo.PerformanceLogOutput","mstrmojo.vi.viz.MapHelper","mstrmojo.gm.GMUtility","mstrmojo.gmaps.MapColorUtils");var o=mstrmojo,S=o.array,A2=o.gm,Ar=o.gmaps,y=Ar.MapUtils,b=o.hash,k=o.vi.viz.EnumDSSDropZones,AA=mstrmojo.vi.util.TemplateUtils,AK=Ar.EnumPropertyType,K=Ar.EnumDataLabel,AU=Ar.EnumBaseMapType,Aw=Ar.EnumDynamicZoomStatus,A7=Ar.EnumRenderMethod,A3=Ar.EnumShapeFormatting,AQ=Ar.ZoomAnimationDelta,Av=Ar.layer.GraphicLayerViewerFactory,A6=Ar.graphic.Graphic,BB=Ar.LAYER_INDEX_MAX,AF=o.PerformanceLogOutput,BA=o.vi.viz.MapHelper,AG=o.VisUtility,Aj=A2.GMUtility,a=Ar.MapColorUtils;var Ao=Ar.DEFAULT_DATA_LABEL_PROPS,AC=o.mapbox.DEFAULT_DATA_LABEL_PROPS_MAPBOX,A1=A7.svg,h="automatic",Ae=/\<\/?span.*?\>/ig;function f(BF,BG,BE){return BG.map(function(BI,BH){return{eid:BI,tid:BF[BH],tp:BE[BH]};});}mstrmojo.gmaps.layer.GraphicLayer=mstrmojo.declare(mstrmojo.gmaps.layer.Layer,[mstrmojo.gmaps._MapDataLabel,mstrmojo.gmaps._MapAffinityLine,mstrmojo.gmaps.layer._LassoSelectHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw._HasGraphicsSelections,mstrmojo.gmaps.layer._GraphicLayerDataHelper,mstrmojo.gmaps.layer._GraphicLayerDataSelectionHelper,mstrmojo.gmaps.layer._InfoWindowHelper,mstrmojo.gmaps.layer._LayerInteractivity],{scriptClass:"mstrmojo.gmaps.layer.GraphicLayer",graphicType:null,shapeInfoArr:null,graphics:null,_viewer:null,data:null,dropZones:null,layerProps:null,primaryModel:null,useSelectedMetric:false,selectedMetricIdx:0,colorMetricIdx:-1,colorAttrIdxs:null,colorAttrs:null,legendColorByElements:null,originColorMap:null,isColorByAttr:false,sizeMetricIdx:-1,angleMetricIdx:-1,sliceAttrIdxs:null,colorByLabelAttr:null,infoTemplate:null,defaultInfoTemplateHTML:null,customInfoTemplateHTML:null,infoTabDiv:null,useAttribute:false,applyThreshold:true,thresholdType:null,supportImgThreshold:null,isAggregate:null,wpAggregateAttributeForm:null,wpLookupAttId:null,selectedGraphics:null,contextMenuSelection:null,originSelectedGraphics:null,init:function AS(BE){if(!BE){return ;}this._super(BE);this.graphics=[];this.selectedGraphics=[];this.contextMenuSelection=[];this.originSelectedGraphics=[];this.initParams();if(this.initViSelectionFromScExp){this.initViSelectionFromScExp();}},initParams:function Y(){var BG=this.map,BE=this.parent,BF;if(!BG){return ;}this.layerProps=this.getLayerProps();if(BG.getDropZones instanceof Function){this.dropZones=BG.getDropZones(this.key);}BF=this.dropZones.geoAttribute;if(BG.dynZoomStatus===Aw.INIT){if(BE.getGraphicLayerCount()===1&&BF===null){BG.dynZoomStatus=Aw.NO_GEO_ATTR;}else{BG.dynZoomStatus=Aw.FIRST_GEO_ADD_FINISHED;}}if(BG.dynZoomStatus===Aw.NO_GEO_ATTR&&BF!==null){BG.dynZoomStatus=Aw.FIRST_ADD_GEO_ARR;}this.primaryModel=this.addDisposable(new mstrmojo.models.template.DataInterface(this.data));this.initMetricIdxs();this.loadLayerProps(this.layerProps);},refresh:function An(BE){if(!this.map||BE===this.data){return ;}this.unrender();if(!!BE&&BE.k===this.key){this.data=BE;}this.initParams();if(!this.isGridDataEmpty()){this.initGraphics();}},initGraphics:function A4(){y.showWait();},dataValidate:function W(){var BH=this.getDataRows(),BE=this.getDataRowHeaders(),BG,BJ,BF,BI;if(!BH||!BE){return false;}BF=BH.length;BI=BE.length;for(BG=0;BG<BI;BG+=1){BJ=BE[BG].items;if(BJ.length>BF){return false;}}return true;},getColorInfoBySingleAttr:function x(BG,BK){var BJ=[],BH=[],BI,BF,BE;BJ.push(BG);BH.push(BK);BI=this.model.docModel.getColorBy(BJ,BH);BE=this.getAttrColorByOpacity(BJ,BH)/100;BF={value:Aj.decodeColor(BI.color),opacity:BE};return BF;},getColorAttrIdx:function t(){var BE=this.colorAttrIdxs||[];return BE.length===1?BE[0]:-1;},getColorRHIdx:function AX(BJ,BF){var BG=-1,BE=this.getDataRowHeaders(),BH,BI;BH=BE[BJ].items;if(BF<BH.length){BI=BH[BF];BG=BI.idx;}return BG;},getColorElemId:function As(BG,BE){var BF,BH=null;if(BG>=0){BF=BE.es[BG];BH=BF.id;}return BH;},generateColorInfo:function BD(BG,BH){var BK=this.getDataRows(),BI,BO,BJ,BF,BM,BN,BL,BE;BI=BK[BH];BO=BI.id;BJ=BI.otp;BF=BG.rowIndices;if(BF.length>0){BM=BF[0];BN=this.getColorRHIdx(BM,BH);BL=this.getColorElemId(BN,BI);BE=this.getColorInfoBySingleAttr(BO,BL);BG.colorByAttributeIds=[BO];BG.colorByElementIds=[BL];BG.colorByTypes=[BJ];BG.color=BE;}},generateColorMapElem:function Af(BI,BH,BE,BG){var BF;BF=this.generateColorByLabel(BG);this.originColorMap.push({elemId:BI,attrId:BH,type:BE,label:BF});},generateColorMap:function AP(BQ,BE){var BF,BK=this.getDataRows(),BH,BR,BI,BN,BP,BM,BJ=[],BO,BL,BG=BQ.length;BH=BK[BE];BR=BH.id;BI=BH.otp;this.originColorMap=[];this.getColorByLabelAttr(BR);for(BF=BG-1;BF>=0;BF-=1){BN=BQ[BF];BP=this.getColorRHIdx(BN,BE);BM=this.getColorElemId(BP,BH);if(BJ.indexOf(BM)<0){BJ.push(BM);BO=[];BL=[];BO.push(BR);BL.push(BM);this.model.docModel.getColorBy(BO,BL);this.generateColorMapElem(BM,BR,BI,BP);}}},getColorByLabelAttr:function Ak(BK){var BG=this.getDataRows(),BF,BL,BH,BJ,BI=true,BE;BE=this.colorByLabelAttr=[];BF=BG.filter(function(BM){return BK===BM.id;});BL=BF.length;for(BJ=0;BJ<BL;BJ=BJ+1){BH=BF[BJ];if(BA.isAxisAttribute(BH)===false){BI=false;BE.push(BH);}}if(BI){for(BJ=0;BJ<BL;BJ=BJ+1){BE.push(BF[BJ]);}}},generateColorByLabel:function g(BH){var BE=this.colorByLabelAttr,BG=BE.length,BJ,BI,BK="",BF;for(BF=0;BF<BG;BF=BF+1){BJ=BE[BF];BI=BJ.es[BH];BK+=BI.n+" ";}BK=BK.substring(0,BK.length-1);return BK;},getAttrColorByOpacity:function Au(BG,BF,BH){var BL=this.getLayerProps(),BN=BL.cbo,BE=BH===undefined?(BN?JSON.parse(BN):{}):BH,BM,BI,BK,BJ;BG=BG||[];BF=BF||[];BM=BG.join("|");BI=BF.join("|");BK=BE[BM]||{};BJ=BK[BI];if(BJ===undefined){BJ=85;}return BJ;},getLegendColorByItemNameById:function AT(BF,BH){var BE=AG.isHierarchyObject(BH)?"hid":"id",BI=BH.id,BG="";S.forEach(BF,function(BJ){if(BJ[BE]===BI){BG+=(BJ.dn||BJ.n)+" ";}});return BG;},processLegendColorByItemName:function Ag(){var BF,BE=this.colorAttrs,BI=this.map,BK,BJ,BG,BH="";BK=BI&&BI.getColorByDzRawData(this.key);if(!BK){return BH;}BG=BK&&BK.length;if(!BG||BG<=0){return BH;}for(BF=0;BF<BG;BF+=1){BJ=BK[BF];BH+=this.getLegendColorByItemNameById(BE,BJ);}BH=BH.substring(0,BH.length-1);return BH;},processLegendColorByElements:function r(){var BG=this.originColorMap,BH,BM,BO,BE,BP,BJ,BN,BF,BQ,BL,BI,BK=[];if(!BG){return BK;}BH=BG.length;for(BI=0;BI<BH;BI=BI+1){BM={};BO="";BE=[];BP=[];BJ=[];BN=BG[BI];BQ=BN.attrId;BL=BN.elemId;BF=this.getColorInfoBySingleAttr(BQ,BL);BM.color=BF.value;BM.decodedColor=BM.color;BM.encodedColor=Aj.encodeColor(BM.color);BM.opacity=BF.opacity;BM.label=BN.label;BM.isDefaultColor=!BN.isManual;BE.push(BL);BP.push(BQ);BJ.push(BN.type);BM.token={elements:BE,levels:BP,types:BJ};BK.push(BM);}return BK;},processLegendColorByInfo:function AJ(){if(this.isColorByAttr){var BF=this.processLegendColorByItemName(),BE=this.processLegendColorByElements();this.legendColorByElements={item:BF,elements:BE};}},getFormatColorByElements:function z(){var BE=this.legendColorByElements,BF,BG;if(!BE){this.processLegendColorByInfo();BE=this.legendColorByElements||{};}BF=(BE.elements||[]).map(function(BJ){var BH=BJ.token,BL=BH.elements||[],BK=BH.levels||[],BI=BH.types||[];return{text:BJ.label,color:BJ.color,opacity:BJ.opacity*100,comb:f(BK,BL,BI)};});BG=a.getColorInfoForItemAll(BF);BF.unshift({text:mstrmojo.desc(2461,"All"),color:BG.color,opacity:BG.opacity,comb:[]});return BF;},getContextMenuColorBySelections:function BC(){var BE=this.contextMenuSelection||[],BF=BE.filter(function(BH){var BG=BH.attributes,BI=BG.colorByAttributeIds,BJ=BG.colorByElementIds;return BI&&BJ&&BI.length===BJ.length;}).map(function(BH){var BG=BH.attributes,BJ=BG.colorByAttributeIds,BK=BG.colorByElementIds,BI=BG.colorByTypes;return BJ.map(function(BM,BL){return{tid:BM,eid:BK[BL],tp:BI[BL]};});});return AG.arrayUnique(BF,function(BG,BH){BG=b.clone(BG);BH=b.clone(BH);return Aj.isEqualComb(BG,BH);});},generateUpdatedOpacityPalette:function Ai(BG,BE){var BF=this.getLayerProps(),BI=BF.cbo,BH=BI?JSON.parse(BI):{};BG=[].concat(BG);BE=[].concat(BE);if(BG.length!==BE.length){throw new Error("comb and opacity number not match");}BG.forEach(function(BL,BK){var BN=BL.map(function(BO){return BO.tid;}).join("|"),BM=BL.map(function(BO){return BO.eid;}).join("|"),BJ=BH[BN];if(BJ===undefined){BJ={};BH={};}BJ[BM]=BE[BK];BH[BN]=BJ;});return BH;},generateColorData:function I(BF,BG,BI,BE,BJ){var BH=this;S.forEach(BF,function(BN){var BK=BN.attributes,BM=BH.model.docModel.getColorBy(BK.colorByAttributeIds,BK.colorByElementIds),BL=Aj.decodeColor(BM.color);BK.color.value=BL;BG.push([BN.id,BL]);BI.push([BN.id,y.fillColorAjustForCMSelection(BL)]);BE.push([BN.id,y.fillColorAjustForHover(BL)]);BJ.push([BN.id,BL]);});},updateLayerColorByColor:function Ab(){var BF=this.graphics,BG=[],BH=[],BE=[],BK=[],BI=this.map,BJ=this._viewer;if(!BJ){return ;}this.generateColorData(BF,BG,BH,BE,BK);this.processLegendColorByInfo();BJ.handleColorByColorChange(BG,BH,BE,BK);BI.resetLegendColorByData(this.key);},generateOpacityData:function J(BE,BH,BF){var BG=this;S.forEach(BE,function(BK){var BI=BK.attributes,BJ=BG.getAttrColorByOpacity(BI.colorByAttributeIds,BI.colorByElementIds,BH)/100;BI.color.opacity=BJ;BF.push([BK.id,BJ]);});},updateLayerColorByOpacity:function Al(BF,BE){var BI,BH=this.map,BG;BG=this.generateUpdatedOpacityPalette(BF,BE);BI=JSON.stringify(BG);BH.writeProperties("cbo",BI,this.key,true);},handleLayerColorByOpacity:function c(BI){var BE=this.graphics,BH=this.map,BG,BF=[];BG=!!BI?JSON.parse(BI):{};this.generateOpacityData(BE,BG,BF);this.processLegendColorByInfo();this._viewer.handleColorByOpacityChange(BF);BH.resetLegendColorByData(this.key);BH.raiseEvent({name:"colorByColorChange",type:"opacityFullUpdate"});},getLegendShowProperty:function U(){var BE=this.map.getProperties(this.key);return !!(!!BE.ls&&BE.ls.toString()==="true");},buildGraphics:function AI(BE){S.forEach(BE,function(BF){this.addGraphic(this.buildGraphic(BF));},this);this.createDataLabelsConfig();this.createAffinityLinesConfig();this.buildViewer();},createDataLabelsConfig:function A0(){if(this.supportDataLabel()){this.populateDataLabelMetricValues();}},populateDataLabelMetricValues:function AD(){var BI,BH=this.colorMetricIdx,BG=this.getLayerModel(),BF,BJ,BE;if(isNaN(BH)||BH<0||!BG){return ;}S.forEach(this.graphics,function(BK){BE=BK&&BK.attributes;if(BE&&!BK.isClusterGraphic()){BE.values=[];BJ=BK.getDataRowIdx();BF=BG.getMetricValue(BJ,BH);BI=BF&&BF.getValue();if(BI){if(typeof BI==="string"&&BI.toLowerCase().indexOf("<span")>=0){BI=BI.replace(Ae,"");}BE.values.push(BI);}}});},buildGraphic:function v(BE){return new A6(b.copy({parent:this},BE));},buildViewer:function At(){var BF=this.parent,BE=BF&&BF.baseLayer;if(!BE){return ;}this.destroyViewer();this._viewer=Av.create(b.copy({key:this.key,graphics:this.graphics,parent:this,parentDom:BF&&BF.graphicLayerDiv},this.getViewerProps()),this.renderMethod||BF.renderMethod||A1);this.setLayerZIndex();if(this.highlightFromViSelection&&this.highlightFromViSelection instanceof Function){this.highlightFromViSelection();}},getViewerProps:function A(){return{graphicType:this.getLayerProp(AK.graphicType),applyThreshold:this.applyThreshold,minzoom:this.minzoom,maxzoom:this.maxzoom,hasConnectingLayer:this.hasConnectingLayer};},getLayerFmts:function u(){var BF=this.layerProps,BG=this.map,BE={};if(!BF||!BG){return BE;}if(BF[A3.SHAPE_FORMAT_FILL_COLOR]){BE.fillColor=BF[A3.SHAPE_FORMAT_FILL_COLOR];}if(BF[A3.SHAPE_FORMAT_BORDER_COLOR]){BE.strokeColor=BF[A3.SHAPE_FORMAT_BORDER_COLOR];}if(BF[A3.SHAPE_FORMAT_BORDER_STYLE]){BG.convertLineStyle(BF[A3.SHAPE_FORMAT_BORDER_STYLE]);BE.strokeDashArray=BG.shapeBorderLineDash;BE.strokeWidth=BG.shapeBorderWidth;}if(BF[A3.SHAPE_FORMAT_FILL_OPACITY]){BG.convertShapeFillOpacity(BF[A3.SHAPE_FORMAT_FILL_OPACITY]);BE.fillOpacity=BG.shapeFillOpacity;}return BE;},getLayerProp:function n(BF){var BE=this.getLayerProps();if(BE){return BE[BF];}},getLayerProps:function P(){return this.data&&this.data.vp;},getMarkerType:function Ap(){return this.getLayerProp(AK.markerType);},getDropZones:function N(){return this.dropZones;},getLayerName:function V(){return this.layerProps&&this.layerProps[AK.layerName];},getLayerIdx:function j(){var BE=parseInt(this.layerProps&&this.layerProps[AK.layerIdx]);return !y.checkVal(BE)?0:BE;},_getLayerZIndex:function AR(){var BE=this.getLayerIdx();return y.checkVal(BE)&&(BB-BE-10);},setLayerZIndex:function Az(){var BE=this._viewer,BF=this._getNextLayerKey();if(y.checkHasFunction(BE,"setLayerZIndex")){BE.setLayerZIndex(this._getLayerZIndex(),BF);}this.updateBmpLabelsPos(BF);},updateBmpLabelsPos:function O(BH){var BF=this.parent,BE=BF&&BF.baseLayer,BG=BE&&BE.isLabelGropOnTop();if(!BH&&BE&&BG){BE.toggleBaseMapLabelsPos();}},_getNextLayerKey:function Aq(){var BH=this.map,BG=this.key,BF=BH&&BH.layerIdxMappingArr,BE;if(!S.isArray(BF)){return ;}BE=BF.indexOf(BG);if(BE!==-1){return BF[BE-1];}},isAftLnTmptHit:function H(BE){var BF=this.layerProps;return(BF[AK.showAffinityLines]==="1")&&(BF[AK.affinityLineGrid]===BE);},updateGraphics:function G(){var BE=this.getBaseLayer(),BF=this._viewer;if(!BE||!BF||(BE.isForPremium&&BE.isForPremium())){return ;}y.showWait();BE.updateXCoordsRange();BF.desolveClustersIfZoomChanged();BF.updateGraphicsPositionInScreen(BE);y.hideWait();},getPropsForViewerUpdate:mstrmojo.emptyFn,callbackForUpdateGraphics:function q(){var BF=this.map,BE=this._viewer;if(!BF||!BE){return ;}BE.update(this.getPropsForViewerUpdate());this.setVisibility(this.isVisible());BF.needUpdateGraphicLayersCnt--;if(BF.needUpdateGraphicLayersCnt===0){BF.graphicsReady=true;if(y.checkHasFunction(BF,"checkForMapReady")){BF.checkForMapReady();}AF.endTimer("timerid_handleExtentChange");AF.endTimer("timerid_fromBuildtoEnd");AF.endTimer("timerid_fromResponsetoEnd");AF.endTimer("timerid_VisFilter_updateSelections");AF.endTimer("timerid_VisFilter_unsetFilter");AF.endTimer("timerid_Vis_keepOnly");AF.endTimer("timerid_Vis_drill");AF.endTimer("timerid_Vis_exclude");AF.visPrint("End All Graphic Layers");AF.recordJSHeapMemory("Memory usage at the end");}},toggleLegend:function AW(BH){if(!y.isVI()){return ;}var BF=this,BG=BF.map,BE=this.parent;BH=BH&&this.isVisible();BG.switchLegend(BH,this.key);if(BE){BE.updateMapToolbar();}},resize:function R(BG,BE){var BF=this._viewer;if(BF){BF.resize(BG,BE);BF.stopUpdate();}},updateMapExtent:function Aa(){var BF=this.parent,BE=this.getBaseLayer(),BG=this.map;if(!BF||BF.destroyed||!y.checkHasFunction(BF,"isDynamicZoom")){y.hideWait();return ;}this._active=true;if(this.getLegendShowProperty()){BG.createSingleLegend(this.key);}if(BF.hasInit===true&&(BF.isDynamicZoom()!==true||BG.isKeepOnlyExclude)){this.updateGraphics();BF.updateMapComponents(BG);BF.updateNeedUpdLayers(BG,this.key);if(BG.needUpdateLayers.length===0){BG.isKeepOnlyExclude=false;}}else{if(BE&&BE.isProjectionReady()&&BF.getBaseMapType()===AU.Google){this.updateGraphics();}this._super();}y.hideWait();},getXtab:function A5(){var BE=this.map;if(this.key){return BE.fnGetWidget(this.key);}return null;},addGraphic:function Ad(BF){var BE=this.graphics;if(BF&&S.isArray(BE)){BE.push(BF);}},appendGraphicNodeToBottom:function C(BF){var BE=this._viewer;if(BE){BE.appendGraphicNodeToBottom(BF);}},setVisibility:function AZ(BE){this._super(BE);this.setLayerZIndex();var BF=this._viewer;if(BF){BF.setVisibility(BE);}},clean:function AY(){var BE=this._viewer;if(BE){BE.clean();}},loadLayerProps:function A8(BF){var BE=y.isVI();if(!BF){return ;}if(b.keyarray(BF).length===0){BF.sm="0";BF.sa="1";}if(BF[AK.customInfoWinTpl]){this.customInfoTemplateHTML=this.parseCustomInfoWinTplHTML(unescape(BF[AK.customInfoWinTpl]));}if(BF[AK.useAttributeForm]&&parseInt(BF[AK.useAttributeForm],10)===0){this.useAttribute=true;}if(BF.at){this.applyThreshold=(BF.at==="1");}if(y.checkDefined(BF.dm)){this.isAggregate=(BF.dm==="1");}else{if(BE){this.isAggregate=true;}}if(y.checkDefined(BF.dmaf)){this.wpAggregateAttributeForm=(BF.dmaf==="1");}else{if(BE){this.wpAggregateAttributeForm=true;}}if(y.checkDefined(BF.latt)){this.wpLookupAttId=BF.latt;}if(BF[A3.SHAPE_FORMAT_FILL_COLOR]===h){delete BF[A3.SHAPE_FORMAT_FILL_COLOR];}if(BF[A3.SHAPE_FORMAT_BORDER_COLOR]===h){delete BF[A3.SHAPE_FORMAT_BORDER_COLOR];}this.parseDataLabelProperties(BF);this.parseZoomThroughtLayerProps(BF);},populateInfoTemplate:function d(BE){var BF=!!BE?BE:[];return{content:(!this.customInfoTemplateHTML)?this.getDefaultInfoTplHTML(this.data,this.dropZones,BF):this.customInfoTemplateHTML};},isVisible:function Ax(){return !!this.layerProps&&(this.layerProps[AK.isHidden]!=="1");},parseDataLabelProperties:function AV(BG){var BE,BF=this.isForPremium()?AC:Ao;for(BE in BF){if(BF.hasOwnProperty(BE)){if(!BG[BE]){BG[BE]=BF[BE][0];}if(BE===K.DATA_LABEL_FONT_COLOR&&!isNaN(BG[BE])){BG[BE]=parseInt(BG[BE]);}else{if(BE===K.DATA_LABEL_FONT_STYLE||BE===K.DATA_LABEL_SHOW){BG[BE]=parseInt(BG[BE]);}else{if(BE===K.DATA_LABEL_SHOW_ALL){BG[BE]=BG[BE]===true||BG[BE]==="true";}}}}}},parseZoomThroughtLayerProps:function AN(BK){var BL=this.getBaseLayer(),BE=this.map,BH=BE.isZoomThroughLayerEnable&&BE.isZoomThroughLayerEnable(),BG=this.parent,BM=this.key,BF=(BH&&y.checkDefined(BK[AK.minLayerZoomLvl]))?parseFloat(BK[AK.minLayerZoomLvl]):BL.minZoom,BI=(BH&&y.checkDefined(BK[AK.maxLayerZoomLvl]))?parseFloat(BK[AK.maxLayerZoomLvl]):BL.maxZoom,BJ=false;BG.forEachGraphicLayer(function(BP){var BN=BP.key,BQ=BP.getLayerProps(),BO=(BH&&y.checkDefined(BQ[AK.minLayerZoomLvl]))?parseFloat(BQ[AK.minLayerZoomLvl]):BL.minZoom;if(BM!==BN&&BI===BO){BI=Math.min(BI+AQ,BL.maxZoom);BJ=true;return false;}},null,true);this.minzoom=BF;this.maxzoom=BI+0.0001;this.hasConnectingLayer=BJ;},isLayerInZoomRange:function Z(){var BE=this.getBaseLayer(),BF=BE&&BE.getZoom();return BE.supportLayerZoomRange===false||(this.minzoom<=BF&&BF<this.maxzoom);},isLayerInClusterRange:function A9(){if(!this.isClustered){return false;}var BE=this.getBaseLayer(),BF=BE&&BE.getZoom();return BF<this.clusterMaxZoom;},getDropZonesItems:function Ay(BF){var BE=this.getZoneModelByZoneId(BF);return BE&&BE.items;},getDropZonesItem:function Q(BE){var BG=this.map,BF=BG&&BG.getDropZoneItems(BE,this.key),BH=BF&&BF[0]&&BF[0].id;return AA.findUnitsById(this.data.gsi,BH)[0];},showDataLabelValues:function e(){return !this.hasColorByAttribute()&&!!this.getDropZonesItem(k.ColorBy);},showDataLabelText:function AH(){return !!this.getDropZonesItem(k.GeoAttribute);},enableMinSizeOption:function s(){return !!this.getDropZonesItem(k.SizeBy);},hasSizeByMetric:function Ac(){var BE=this.primaryModel.getTotalCols();return this.sizeMetricIdx>-1&&this.sizeMetricIdx<BE;},hasColorByMetric:function E(){var BE=this.primaryModel.getTotalCols();return this.colorMetricIdx>-1&&this.colorMetricIdx<BE;},hasColorByAttribute:function D(){return this.isColorByAttr;},canShowLegend:function Ah(){return !this.isGridDataEmpty()&&(!!(this.hasSizeByMetric()||this.hasColorByMetric()||this.hasColorByAttribute()));},needShowLegend:function T(){var BE=this.getLayerProp(AK.legendSwitch)||"";return(BE&&BE.toString()==="true")?true:false;},hasImgThreshold:function m(){var BG=this.graphics&&this.graphics[0],BF=BG&&BG.attributes,BE=BF&&BF.threshold;return BE&&BE.url;},initMetricIdxs:function B(){var BE=this.dropZones;if(!BE){return ;}this._initMetricIdxsFromDropZones();if(this.useSelectedMetric||(!y.isVI()&&this.hasMetrics()&&!BE.colorBy&&!BE.sizeBy)){this.colorMetricIdx=this.sizeMetricIdx=this.selectedMetricIdx;this.useSelectedMetric=true;}},_initMetricIdxsFromDropZones:function p(){var BL=this,BF=this.dropZones,BN=this.getDataCols(),BQ=this.getDataRows(),BO=[],BH,BP,BI,BM,BK=[],BE,BJ,BG;if(!BF){return ;}this.colorAttrIdxs=null;this.colorAttrs=null;this.isColorByAttr=false;if(BF.isColorByAttr===true){if(BF.colorBy){S.forEach(BF.colorBy,function(BR){BO=BO.concat(BL.findAttrIdxs(BR));});BH=BO.length;if(BH>0){BE=[];BJ=[];for(BG=0;BG<BH;BG=BG+1){BP=BO[BG];BI=BQ[BP];BM=BI.id;if(BK.indexOf(BM)<0){BE.push(BP);BJ.push(BI);BK.push(BM);}}this.colorAttrIdxs=BE;this.colorAttrs=BJ;this.isColorByAttr=true;}}}else{this.colorMetricIdx=this.findMetricIdx(BN,this.justMetricId(BF.colorBy));}this.sizeMetricIdx=this.findMetricIdx(BN,this.justMetricId(BF.sizeBy));this.angleMetricIdx=this.findMetricIdx(BN,this.justMetricId(BF.angle));if(BF.sliceBy){this.sliceAttrIdxs=[];S.forEach(BF.sliceBy,function(BR){BL.sliceAttrIdxs=BL.sliceAttrIdxs.concat(BL.findAttrIdxs(BR));});}else{this.sliceAttrIdxs=null;}},getGeoColumnIndex:function X(){return -1;},handleMetricSelectionChange:function w(BE){this.colorMetricIdx=this.sizeMetricIdx=this.selectedMetricIdx=BE;this.useSelectedMetric=true;this.refresh();},onLayerZoomRangeChange:function M(){var BE=this._viewer,BF=this.getLayerProps();if(!BE){return ;}y.showWait();this.parseZoomThroughtLayerProps(BF);this.buildViewer();y.hideWait();},getSelectedMetricIdx:function AM(){return this.colorMetricIdx;},filterElements:function Am(BG,BE){var BH=[],BI=false,BF;S.forEach(this.graphics,function(BK){var BJ=BK.matchLocationName(BG);S.forEach(BJ,function(BL){if(BL){BF={n:BL.getGeoName(),v:BL};if(BE&&BE(BF)){BI=true;BH.push(BF);return false;}else{BH.push(BF);}}});});return BH;},processDrill:function l(){this.performDrill(this.getGeoColumnIndex());},getBaseMapType:function AO(){if(this.parent){return this.parent.getBaseMapType();}},isGeoDataLayer:function AL(){var BE=this.getBaseMapType();return BE!==AU.Image;},supportDataLabel:function(){return true;},isMarkerMap:function(){return false;},destroyAllGraphics:function i(){S.forEach(this.graphics,function(BE){if(BE){BE.destroy();}});this.graphics=[];this.selectedGraphics=[];this.contextMenuSelection=[];this.originSelectedGraphics=[];this.destroyViewer();},destroyViewer:function AB(){var BE=this._viewer;if(BE){BE.destroy();}delete this._viewer;},unrender:function AE(){this.originColorMap=null;this.colorAttrIdxs=null;this.colorAttrs=null;this.legendColorByElements=null;this.map.destroyLegend(this.key);this.destroyAllGraphics();this.primaryModel=null;this.infoTemplate=null;this._super();},destroy:function F(){delete this.infoTabDiv;delete this.shapeInfoArr;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.GraphicLayer","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.Extent","mstrmojo.gm.GMUtility","mstrmojo.vi.viz.MapHelper");var Q=mstrmojo,O=Q.hash,I=Q.gmaps,K=I.EnumThresholdType,H=I.EnumBaseMapType,N=I.MapUtils,T=I.geometry.Extent,M=Q.gm,A=M.GMUtility;mstrmojo.gmaps.layer.AbstractMarkerLayer=mstrmojo.declare(mstrmojo.gmaps.layer.GraphicLayer,null,{scriptClass:"mstrmojo.gmaps.layer.AbstractMarkerLayer",rowCount:null,markerElementIDs:null,lookupColumnIndex:-1,initGraphics:function P(){this._super();this.ImageThreshold=false;var U=this.shapeInfoArr=this.loadShapeInfo();if(this.ImageThreshold&&this.getBaseMapType()===H.Mapbox){U=U.filter(function(V){return V.attributes.threshold;});}if(U){this.buildGraphics(U);}this.updateMapExtent();},loadShapeInfo:function B(){var s=this.dropZones,d=[],y=this.getDataRows(),AE=this.getDataRowHeaders(),a=AE&&AE.length,w={},t=new T({isGeo:this.isGeoDataLayer()}),AA=[],AF,e,r="",U,v,j,h,b,z,l,x,AD,p,q,n,Y,W,i,V,g=this.primaryModel.getTotalCols(),u=this.minMaxMap={},X=Infinity,c=-Infinity,f=Infinity,m=0,k,AC={},Z=this.getColorAttrIdx(),AB=[],o;this.markerElementIDs={};q=this.findMappableAttributes(y,d,s,this.useAttribute);if(!q){this.updateMapExtent();N.log("No Mappable attributes present on the report.");return ;}if(!this.dataValidate()){this.updateMapExtent();N.log("Unsupported NDE format.");return ;}AD=q[0];p=q[1];AF=q[2];i=this.lookupColumnIndex;if(AD===undefined||p===undefined){this.updateMapExtent();return ;}if(!this.infoTemplate){this.infoTemplate=this.populateInfoTemplate([AD,p]);}for(U=a-1;U>=0;){v=AE[U].items;if(AF!==null&&AF>=0){e=v[AF];r=y[AF].es[e.idx].id;}j=v[AD];if(!j||j.idx<0){U--;continue;}b=y[AD].es[j.idx].n;b=b.replace(",",".");l=y[AD].es[j.idx].id;if(l.indexOf("DB:")===0||N.trimString(b)===""){U--;continue;}h=v[p];if(!h||h.idx<0){U--;continue;}z=y[p].es[h.idx].n;z=z.replace(",",".");x=y[p].es[h.idx].id;if(x.indexOf("DB:")===0||N.trimString(z)===""){U--;continue;}if(this.isGeoDataLayer()&&!N.isValidLatLng(b,z)){U--;continue;}if(l===x){k=l;}else{if(this.showOneMarkerForSameLocation){k=l+"|"+x;}else{k=l+"|"+x+"|"+r;}}if(AC[k]!==undefined){AC[k].rowIndices.push(U);U--;continue;}if(this.useAttribute&&i>=0){Y=v[i];W=y[i].es[Y.idx].id;}else{W=l;}V=this.getElementIdWithoutAttributeID(W);w=this.populateGraphicAttributes(U,AD,p,v,y,d);AC[k]=w;if(this.isColorByAttr===true&&Z>=0){AB.push(U);}if(this.sizeMetricIdx>-1&&this.sizeMetricIdx<g){o=w.sizeByMetricVal;o=N.checkVal(o)?o:0;c=Math.max(c,o);X=Math.min(X,o);m=Math.max(m,Math.abs(o));f=Math.min(f,Math.abs(o));}b=parseFloat(b);z=parseFloat(z);t.mergePoint(b,z);this.markerElementIDs[V]={lat:b,lng:z};n={type:"Point",geoData:{lat:b,lng:z},attributes:w};AA.push(n);U--;}if(this.sizeMetricIdx>-1&&this.sizeMetricIdx<g){u[this.sizeMetricIdx]={min:X,max:c,absMin:f,absMax:m};}this.geoExtent=t;if(this.isColorByAttr===true&&Z>=0){this.generateColorMap(AB,Z);this.addColorInfoBySingleAttr(AA,Z);this.processLegendColorByInfo();}return AA;},addColorInfoBySingleAttr:function S(V,U){var W,X=V.length,Y;for(W=0;W<X;W++){Y=V[W]&&V[W].attributes;this.generateColorInfo(Y,U);}},populateGraphicAttributes:function C(g,U,b,l,f,k){var W={},a,c,e,Z,X,h,d="",V=this.sliceAttrIdxs||[],j,Y;for(X=0,h=l.length;X<h;X++){a=l[X];j=a.idx;Y=f[X];if(j<0){continue;}if(X===U){c=j;}if(X===b){e=j;}if(V.indexOf(X)<0){Z=Y.es[j]&&Y.es[j].n;W[N.replaceSpace(Y.n)]=Z;}if(k.indexOf(X)>=0){d+=!d?Z:" "+Z;}}W.dataLabelText=W.geoName=d;W.geoIndex=c;W.longGeoIndex=e;W.rowIndices=[g];W.columnIndices=[U,b];if(V.length>0){this.getSliceAttributeInfo(g,W,U,b);}else{this.getGraphicMetricValues(g,W);}return W;},getSliceAttributeInfo:function F(V,a,f,b){var Y=this.getDataRows(),X=this.getDataRowHeaders(),d,l,c,e,h,n,W=[],o,U,k,Z=this.sliceAttrIdxs||[],j=false,m;for(d=V;d>=0&&!j;){e=X[d].items;m=false;o={};O.copy(a,o);for(l=0,c=e.length;l<c;l++){h=e[l];if(h.idx<0){continue;}if(l===f){U=h.idx;}if(l===b){k=h.idx;}if(N.checkVal(U)&&U!==a.geoIndex&&N.checkVal(k)&&k!==a.longGeoIndex){j=true;break;}if(h.stt===1){m=true;}if(Z.indexOf(l)>=0&&!m){n=Y[l].es[h.idx].n;o[N.replaceSpace(Y[l].n)]=n;}}if(!j){this.getGraphicMetricValues(d,o);if(m){if(this.sizeMetricIdx>=0){a.sizeByMetricVal=o.sizeByMetricVal;}a.rowIndices=[d];}else{o.rowIndices=[d];W.push({attributes:o});}d--;}}if(!N.checkVal(a.sizeByMetricVal)&&this.sizeMetricIdx>=0){a.sizeByMetricVal=0;for(var g=0;g<W.length;g++){a.sizeByMetricVal+=W[g].attributes.sizeByMetricVal;}}a.slices=W;},getGraphicMetricValues:function J(g,V){var c=this.data,U=this.getDataColHeaders(),e=c.gts.col,Z=c.gvs,l=!!Z.items?Z.items[g].items:[],d=this.getThresholdInfo(g,this.colorMetricIdx),Y=this.sizeMetricIdx,W=this.angleMetricIdx,b,j,a,k,f,X,h;if(U&&U.length!==1){return ;}if(!!d&&d.type!==undefined){V.threshold=d;}for(b=0,j=l.length;b<j;b++){k=U[0].items[b];a=e[k.tui].es[k.idx].n;if(!a){continue;}f=l[b];h=f.ty;if(!h||h===K.Number||(!mstrApp.isExpress&&h===K.Image)){V[N.replaceSpace(a)]=f.v;}else{V[N.replaceSpace(a)]=f.rv;}X=parseFloat(!f.rv?this.stripNumberFormat(f.v):f.rv);if(b===Y){V.sizeByMetricVal=X;}if(b===W){V.absAngleMetricVal=Math.abs(X);}}},getGeoColumnIndex:function G(){return N.checkVal(this.latIndex)?this.latIndex:-1;},findMappableAttributes:function R(f,j,W,U){var e=f.length,V=W.latitude,c=W.longitude,b=W.geoAttribute,h=this.wpLookupAttId,a,g,d,Z;function X(m){var i,n=-1,l=-1,k=null;for(Z=0;Z<e;Z++){i=f[Z].id;if(!U){if(i===m){g=f[Z].fid;if(g===V){n=Z;}else{if(g===c){l=Z;}else{k=Z;j.push(Z);}}}}else{if(i===V){n=Z;}else{if(i===c){l=Z;}else{if(i===m){k=Z;}}}if(i===h){this.lookupColumnIndex=Z;}}}this.latIndex=n;this.longIndex=l;return(n<0||l<0)?false:[n,l,k];}function Y(){var m=f.length,k=-1,l=-1,o={},n;for(n=0;n<m;n++){if(!U){g=f[n].fid;if(g===V){k=n;o[f[n].id]=true;}else{if(g===c){l=n;o[f[n].id]=true;}}}}return(k>=0&&l>=0&&O.keyarray(o).length===1)?O.keyarray(o)[0]:null;}a=X.call(this,b);if(a){return a;}d=Y.call(this);if(d){return X.call(this,d);}return false;},getAngleMetricValue:function E(Z){var Y=this.primaryModel,U=Y.getTotalCols(),X,W,V=0;if(this.angleMetricIdx>=0&&this.angleMetricIdx<U){X=Y.getMetricValue(Z,this.angleMetricIdx);W=X.getValue();V=X.getRawValue();V=parseFloat(!V?this.stripNumberFormat(W):V);if(isNaN(V)){V=0;}}return V;},resetInfoTemplate:function D(){var V=this.dropZones,Z=[],U=this.getDataRows(),X,Y,W;X=this.findMappableAttributes(U,Z,V,this.useAttribute);Y=X[0];W=X[1];this.infoTemplate=this.populateInfoTemplate([Y,W]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.GraphicLayer","mstrmojo.PerformanceLogOutput","mstrmojo.gm.GMUtility");var c=mstrmojo,d=c.emptyFn,S=c.array,I=c.gmaps,Q=I.MapUtils,Y=I.EnumGeographicRole,K=I.EnumThresholdType,J=mstrmojo.PerformanceLogOutput,P=c.gm,B=P.GMUtility,M=I.EnumPropertyType;mstrmojo.gmaps.layer.PolygonLayer=mstrmojo.declare(mstrmojo.gmaps.layer.GraphicLayer,null,{scriptClass:"mstrmojo.gmaps.layer.PolygonLayer",_features:null,_returnedQuery:0,init:function a(i){if(!i){return ;}this._super(i);var j=this.getBaseMapType();if(!j){Q.log("no base layer found");}},initGraphics:function Z(){var j=this.getLayerProp(M.shapeFile),i=this.getColorAttrIdx();this.findMappableAttributes(j);if(!this.dataValidate()){this.updateMapExtent();Q.log("Unsupported NDE format.");return false;}if(this.isColorByAttr===true&&i>=0){this.initColorMap();}return true;},initColorMap:function W(){var p={},l=this.getDataRowHeaders(),w=this.getDataRows(),s,n,j,t=this.geoPosition,u=[],o=this.getColorAttrIdx(),i=l.length,r,q,v,m,k;if(o<0||t<0){return ;}for(s=i-1;s>=0;s-=1){r=l[s];q=r.items;n=q[t];v=w[t];m=v.es;k=m[n.idx];j=k.n;j=Q.trimString(j);j=j.toLowerCase?j.toLowerCase():j;if(!!p[j]){continue;}p[j]=s;u.push(s);}this.generateColorMap(u,o);this.processLegendColorByInfo();},buildLayerContent:function h(k,n,l,i){J.endTimer("timerid_callback_initShapeInfo");J.visPrint("create shape info start");var m=J.startTimer({functionName:"PolygonLayer.buildLayerContent: ",purpose:"create Polygon Layer, update Map Extent"});var j=this.shapeInfoArr=this.initShapeInfo(k,n,l,i);if(!this.infoTemplate){this.infoTemplate=this.populateInfoTemplate();}this.buildGraphics(j);this.updateMapExtent();J.endTimer(m);J.visPrint("create Polygon Layer, updateMapExtent end");},initShapeInfo:function N(l,n,m,i){var o=this.createLookup(n),j=[],k=i?"getSingleShapeInfoFromCache":"getSingleShapeInfo";if(!S.isArray(l)||l.length<1){Q.log("Returned featureSet is empty.");return ;}Q.log("featureSet size="+l.length);if(!o){return ;}S.forEach(l,function(p){var q=this[k](p,o,n,m);if(q){j.push(q);}else{if(q===false){return false;}}},this);delete this._shapeInfoArrCache;return j;},getSingleShapeInfoFromCache:function X(j,l,k){if(j){var i=this.populateGraphicAttributes(this.data,l,k,j.geoName,j.sfv)||{};this.populateGeoIdAndBBoxInfo(j,i);return{geoData:j.geoData,screenData:j.screenData,attributes:this.wrapOutfieldsAttrs(j.outFieldsAttrs,i),lat:j.lat,lng:j.lng,type:j.type};}},populateGeoIdAndBBoxInfo:function A(j,i){i.geoId=j.id;i.bbox=j.bbox;},createLookup:d,onIncrementalQueryFeaturesComplete:d,populateColorInfo:function R(j){var i=this.getColorAttrIdx();if(i>=0){this.generateColorInfo(j,i);}},populateGraphicAttributes:function D(AC,l,k,t,z){if(!AC||!l||!(l instanceof Object)||!Q.checkDefined(t)||!Q.checkDefined(k)){return ;}var q={},p=AC.gts&&AC.gts.col,y=AC.gvs&&AC.gvs.items,u=t,j,s,w,m,v,o,AB,n,x,AA,r;q.geoName=t;t=(t.toLowerCase)?t.toLowerCase():t;j=l[t];if(j===undefined){return ;}s=j.rowIndex;q.rowIndices=[s];q.geoIndex=j.geoIndex;q.columnIndices=[k,k];q.dataLabelText=j.dlText||u;q.originGeoName=j.originGeoName;if(s===undefined){Q.log("Missing..."+t);return ;}q=this.formatAttribute(q,s);if(!!p&&p.length===1&&p[0].otp===-1){w=y[s].items;m=p[0].es;for(AA=0,r=w.length;AA<r;AA++){v=w[AA];o=m[AA].n;AB=w[AA].v;x=w[AA].ty;if(!x||x===K.Number){q[Q.replaceSpace(o)]=AB;}else{q[Q.replaceSpace(o)]=w[AA].rv;}}}if(this.isColorByAttr===true){this.populateColorInfo(q);}n=this.getThresholdInfo(s,this.colorMetricIdx);if(!!n){q.threshold=n;}if(z){q.sfv=z;}else{if(j.sfv){q.sfv=j.sfv;}}return q;},getCoordinateArr:function E(j,m){var l,k;if(S.isArray(j)&&S.isArray(j[0])&&S.isArray(j[0][0])){for(l=0,k=j.length;l<k;l++){E(j[l],m);}}else{if(S.isArray(j)&&S.isArray(j[0])){m.push(j);}else{if(S.isArray(j)){m.push([j]);}}}},getGeoColumnIndex:function H(){return Q.checkVal(this.geoPosition)?this.geoPosition:-1;},findMappableAttributes:function f(p){var n=-1,o=this.dropZones&&this.dropZones.geoAttribute,j=this.getDataRows(),m,l,k;if(!j){this.geoPosition=n;return ;}m=j.length;for(k=0;k<m;k++){l=j[k];if(this.isGeoAttribute(o,l)&&n<0&&this.verifyGeoRole(l)){n=k;}}if(n<0){for(k=0;k<m;k++){l=j[k];if(o===l.id&&!!p&&this.verifyGeoRole(l,true)){n=k;}}}if(n<0){Q.log("No Mappable attributes present on the report.");}this.geoPosition=n;},verifyGeoRole:function U(p,l){var q=false,k=p.fs,o,n,m,j;if(!k||k.length<1){return q;}for(m=0,j=k.length;m<j;m++){o=k[m];if(!!o&&Q.checkDefined(o.fgr)){n=o.fgr.toString();}if((l||n!==Y.EnumGeographicRoleNone)&&n!==Y.EnumGeographicRoleLatitiude&&n!==Y.EnumGeographicRoleLongitude){q=true;break;}}return q;},formatAttribute:function O(m,r){var p=this.getDataRows(),j=this.getDataRowHeaders(),o=j&&j[r].items,n,l,i=o.length,q,s,t;for(l=0;l<i;l++){q=o[l];s=p[l].n;t=Q.trimString(p[l].es[q.idx].n);n=Q.replaceSpace(s);if(!m[n]){m[n]=t;}}return m;},getGeoExtent:function g(){if(!this.geoExtent){this.geoExtent=this._calGeoExtent(!this.isGeoDataLayer());}return this._super();},_calGeoExtent:function F(n){var m=this.graphics,j,p,l,o,k;if(!m||!S.isArray(m)){return ;}for(o=0,k=m.length;o<k;o++){p=m[o];l=p&&p.getGeoExtent(n);if(!l){continue;}if(!j){j=l;}else{j.union(l);}}return j;},wrapOutfieldsAttrs:function T(j,i){return i;},_cacheShapeInfo:function C(i){var k=this,j=this._shapeInfoArrCache=[];S.forEach(i,function(m){if(!m){return ;}var l=m.attributes;if(l){j.push({id:l.geoId,geoName:l.geoName,sfv:l.sfv,bbox:l.bbox,geoData:m.geoData,screenData:m.screenData,lat:m.lat,lng:m.lng,type:m.type,outFieldsAttrs:k.wrapOutfieldsAttrs(l,{})});}});},generateColorData:function G(j,k,m,i){var l=this;S.forEach(j,function(q){var n=q.attributes,p=l.model.docModel.getColorBy(n.colorByAttributeIds,n.colorByElementIds),o=B.decodeColor(p.color);n.color.value=o;k.push([n.geoId,o]);m.push([n.geoId,Q.fillColorAjustForCMSelection(o)]);i.push([n.geoId,Q.fillColorAjustForHover(o)]);});},generateOpacityData:function V(i,l,j){var k=this;S.forEach(i,function(o){var m=o.attributes,n=k.getAttrColorByOpacity(m.colorByAttributeIds,m.colorByElementIds,l)/100;m.color.opacity=n;j.push([m.geoId,n]);});},unrender:function b(){this._cacheShapeInfo(this.graphics);this._super();},destroy:function e(){this._features=null;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.GraphicUtils","mstrmojo.gmaps.layer.PolygonLayer");var U=mstrmojo,M=U.array,C=U.string,G=U.gmaps,K=G.MapUtils,T=G.GraphicUtils,I=G.EnumPropertyType,R=G.EnumShapeType,F="getMapBoundaryConfig";mstrmojo.gmaps.layer.CustomLayer=mstrmojo.declare(mstrmojo.gmaps.layer.PolygonLayer,null,{scriptClass:"mstrmojo.gmaps.layer.CustomLayer",initGraphics:function S(V){if(!this._super()){return ;}K.showWait();var Y=this.getLayerProp(I.shapeFile),X=this.geoPosition,W=this._shapeInfoArrCache;if(!K.checkVal(X)||X<0||(K.isSingleTier()&&!K.isWSLiveMode())){this.updateMapExtent();return ;}if(V&&M.isArray(W)&&W.length>0){this.buildLayerContent(W,X,null,V);}else{this.requestAndInitShapeInfo(X,Y);}},requestAndInitShapeInfo:function P(W,X){if(!K.checkVal(W)){this.updateMapExtent();return ;}try{K.showWait();this.createShapesUsingIncrementFetching(W,X);}catch(V){K.log("error: "+V);K.hideWait();this.updateMapExtent();}},createShapesUsingNormalFetching:function E(a,V,Z,Y,W){var X=this._generateTaskParams(a,V,Z);if(!X){throw"createShapesUsingNormalFetching(): failed";}if(mstrApp.isDossier){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:Y,failure:function(b){console.log("Polygon data request failed! "+b.getResponseHeader("X-MSTR-TaskFailureMsg"));if(W&&b){W(b);}}},X);}else{mstrApp.serverRequest(X,{success:Y,failure:function(b){console.log("Polygon data request failed!");if(W&&b){W(b);}}});}},getQueryField:function B(W){var X=this.createLookup(W),V=K.checkDefined(X)&&Object.keys(X).length;if(!K.checkVal(V)){throw"createShapesUsingIncrementFetching(): failed";}return Object.keys(X).join("\u001E").toLowerCase();},createShapesUsingIncrementFetching:function D(X,Y){var V=this.id;this._returnedQuery=this.getQueryField(X);this.reqOffset=0;this._features=[];function W(){var b=K.getGraphicLayerById(V);if(!b||isNaN(b.reqOffset)||b.reqOffset<0){return ;}b.createShapesUsingNormalFetching(Y,b._returnedQuery,b.reqOffset,function a(d){var c=K.getGraphicLayerById(V);if(c){c.reqOffset=parseInt(d.offset);W();c.onIncrementalQueryFeaturesComplete(d.features,X);}else{K.hideWait();}},function Z(d){K.log("Error incremental fetching: "+d);var c=K.getGraphicLayerById(V);if(c){c.reqOffset=-1;c.onIncrementalQueryFeaturesComplete([],X);}else{K.hideWait();}});}W();},onIncrementalQueryFeaturesComplete:function N(V,W){this._features=(this._features||[]).concat(V);if(this.reqOffset<0){this.buildLayerContent(this._features,W);delete this._features;K.hideWait();}},createLookup:function O(a){var c={},X=this.getDataRowHeaders(),Z=this.getDataRows(),b,V,Y,W;for(b=0,V=X.length;b<V;b++){Y=X[b].items[a];W=C.decodeHtmlString(Z[a].es[Y.idx].n);W=K.trimString(W);W=W.toLowerCase?W.toLowerCase():W;if(!!c[W]){continue;}c[W]={rowIndex:b,geoIndex:Y.idx};}return c;},getSingleShapeInfo:function H(Y,a,Z){if(!Y){return ;}var W=this.populateGraphicAttributes(this.data,a,Z,Y.name)||{},X=this._extractPolygonData(Y),V=T.getCentroidOfPolygon(X);if(X&&V){return{type:"Polygon",geoData:X,attributes:W,lat:V[1],lng:V[0]};}},_extractPolygonData:function Q(Z){if(!Z){return ;}var Y=[],X=Z.type,a,W,V;X=(X&&X.toLowerCase)?X.toLowerCase():X;if(X===R.multiPolygon){a=Z.data;for(W=0,V=a.length;W<V;W++){this.getCoordinateArr(a[W],Y);}}else{this.getCoordinateArr(Z.data,Y);}return Y;},_generateTaskParams:function A(W,V,X){if(K.checkDefined(W)&&K.checkDefined(V)){return{taskId:F,shapeId:W,queryField:V,offset:X};}},isGeoAttribute:function J(W,V){return K.checkDefined(W)&&!!V&&(W===V.id);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.GraphicUtils","mstrmojo.gmaps.layer.PolygonLayer","mstrmojo.gmaps._AreaMapHelper","mstrmojo.gmaps.layer._SecondaryGeoRoleHelper");var P=mstrmojo.array,E=mstrmojo.gmaps,O=E.MapUtils,X=E.GraphicUtils,D=E.EnumBaseMapType,F=500,M=",";mstrmojo.gmaps.layer.CloudLayer=mstrmojo.declare(mstrmojo.gmaps.layer.PolygonLayer,[mstrmojo.gmaps.layer._SecondaryGeoRoleHelper],{scriptClass:"mstrmojo.gmaps.layer.CloudLayer",isOnPremise:null,attributeMapping:null,spatialReference:null,geoSecondaryRolePosition:null,_shapeToRowIndexMap:null,_convertedNameMap:null,nameConversionMap:null,initGraphics:function W(b){if(!this.readyToInit()){return ;}if(!this._super()){return ;}O.showWait();var e=this.geoPosition,d=this.parent&&this.parent.getBaseMapType(),c=this._shapeInfoArrCache;if(e<0){O.log("Invalid geoPosition");this.updateMapExtent();return ;}this.loadExtraProps();switch(d){case D.Esri:if(b&&P.isArray(c)&&c.length>0){this.buildLayerContent(c,e,this.mappedValue,b);}else{this._initEsriGraphics(e);}break;default:console.log("Requested cloud layer is not supported");this.updateMapExtent();break;}},_initEsriGraphics:function K(d){var c=this.getDataRows(),e=c&&c[d]&&c[d].id,b=this.mappedValue=this.getMappedValue(e);this._shapeToRowIndexMap=this._shapeToRowIndexMap||{};this._convertedNameMap=this._convertedNameMap||{};this.nameConversionMap=this.getNameConversionMap();if(!O.checkDefined(e)||!O.checkDefined(b)){console.log("initEsriGraphics: invalid geoAttributeId or mappedValue");this.updateMapExtent();return ;}this.requestAndInitShapeInfo(d,b);},requestAndInitShapeInfo:function T(g,e){var b=this.getDataRowHeaders(),d=b&&b.length,f;if(!d){console.log("initEsriGraphics: invalid geoCount");this.updateMapExtent();return ;}f=G()?50:F;try{O.showWait();if(d>f){this.createShapesUsingIncrementFetching(d,e,f,g);}else{this.createShapesUsingNormalFetching(d,e,g);}}catch(c){O.log("error: "+c);O.hideWait();this.updateMapExtent();}},createShapesUsingNormalFetching:function B(f,e,i){if(!O.checkVal(f)||!e||!e.ml||!O.checkVal(i)){throw"createShapesUsingNormalFetching: invalid params";}var h=new esri.tasks.QueryTask(e.ml),g=new esri.tasks.Query(),c=this.id;g.returnGeometry=true;g.outFields=this._getOutFieldsArr(e);g.outSpatialReference=this.spatialReference;g.where=this.buildQueryWhere(0,f,e.ea,i);h.execute(g,function b(k){var j=O.getGraphicLayerById(c);if(j){j.buildLayerContent(k.features,i,e);}O.hideWait();},function d(j){var k=O.getGraphicLayerById(c);if(k){k.updateMapExtent();}if(!!j.description&&j.description.indexOf("esri.config.defaults.io.proxyUrl is not set")>-1){console.log("Query request too large. Please configure proxy setting in the esriconfig.xml and try again");}else{console.log("queryTask error:"+j.name+":"+j.description);}O.hideWait();});},createShapesUsingIncrementFetching:function A(g,k,o,m){if(!O.checkVal(g)||!k||!O.checkVal(o)||!O.checkDefined(m)){throw"createShapesUsingIncrementFetching(): failed";}var d=this.id,n=new esri.tasks.QueryTask(k.ml),f=this._getOutFieldsArr(k),j,b,c,e,l;if(!O.checkDefined(f)){throw"createShapesUsingIncrementFetching(): invalid outFields";}this._returnedQuery=0;this._features=[];for(e=0,l=Math.ceil(g/o);e<l;e++){b=e*o;c=Math.min(b+o,g);j=new esri.tasks.Query();j.returnGeometry=true;j.outFields=f;j.outSpatialReference=this.spatialReference;j.where=this.buildQueryWhere(b,c,k.ea,m);n.execute(j,function p(q){var i=O.getGraphicLayerById(d);if(i){i.onIncrementalQueryFeaturesComplete(q.features,m,l,k);}else{O.hideWait();}},function h(q){O.log("Error incremental fetching: "+q);var i=O.getGraphicLayerById(d);if(i){i.onIncrementalQueryFeaturesComplete([],m,l,k);}else{O.hideWait();}});}},onIncrementalQueryFeaturesComplete:function Q(b,e,d,c){this._returnedQuery++;this._features=(this._features||[]).concat(b);if(this._returnedQuery===d){this.buildLayerContent(this._features,e,c);delete this._features;O.hideWait();}},getSingleShapeInfo:function H(h,b,k,i){if(!h||!i||!b||!O.checkVal(k)){return ;}var g=i.ea,e=this._extractGeoName(h,i),d=h.attributes,c,f,j,l;if(!e){O.log("Warning: "+g+" not found in featureSet from ESRI server! Please ensure the field "+g+" is present in FeatureLayer specified by  <ml> value in esriConfig.xml");return false;}if(e.length===0||!this._shapeToRowIndexMap[e.toLowerCase?e.toLowerCase():e]){O.log("skipping "+e);return ;}j=b[e.toLowerCase?e.toLowerCase():e].rowIndex;if(j!==undefined){c=h.geometry&&h.geometry.rings;f=X.getCentroidOfPolygon(c);if(!!c&&f){l=this.populateGraphicAttributes(this.data,b,k,e,d&&d.sfv)||{};return{type:"Polygon",geoData:c,attributes:this.wrapOutfieldsAttrs(d,l),lat:f[1],lng:f[0]};}}else{O.log("Missing..."+e);}},wrapOutfieldsAttrs:function R(c,b){var d=this._extractShapeQf(this.mappedValue&&this.mappedValue.qf);P.forEach(d,function(e){if(e&&(c[e]||c[e=e.toUpperCase()]||c[e=e.toLowerCase()])&&!b[e]){b[e]=c[e];}});return b;},_extractGeoName:function Z(d,f){var c=d&&d.attributes;if(!c||!f){return ;}var i=f.ea,h=c[i]||c[f.ea=i.toLowerCase()]||c[f.ea=i.toUpperCase()],b=(this._convertedNameMap[h])?this._convertedNameMap[h]:h,e=f.sf,g;if(b&&this.geoSecondaryRolePosition!==-1&&e&&e.length>0){g=c[e]||c[f.sf=e.toLowerCase()]||c[f.sf=e.toUpperCase()];b+=M+g;}c.sfv=g;return O.trimString(b);},buildQueryWhere:function a(c,f,m,k){var l=[],d=this.getDataRowHeaders(),j=this.geoSecondaryRolePosition,e,b,n,h,g;for(h=c;h<f;h++){b=this.getIdStringForRow(h,k,j);b=b.toLowerCase?b.toLowerCase():b;g=this.checkName(h,k);if(g){l.push("N'"+g+"'");}else{continue;}if(!!this._shapeToRowIndexMap[b]){continue;}e=d[h].items[k];this._shapeToRowIndexMap[b]={rowIndex:h,geoIndex:e.idx};}n="("+m+" in ("+l.join(", ")+")) AND (1=1)";return n;},checkName:function J(b,c){return this.escapeSingleQuote(this.convertName(this.getElementValue(b,c)));},escapeSingleQuote:function C(b){return b.replace("'","''");},_getOutFieldsArr:function I(c){if(!c){console.log("_getOutFieldsArr(): invalid mappedValue");return ;}try{var b=c.sf,f=this._extractShapeQf(c.qf);if(!P.isArray(f)){return ;}if(b&&b.length>0){f.push(b);}return f;}catch(d){console.log("err: "+d);}},getMappedValue:function V(c){var b;if(this.isOnPremise){b=this.attributeMapping[c];if(b&&b.ml){b.ml=O._verifyProtocol(b.ml);}}else{b=this.initWebMapConfig(true);}if(b){b.sf=O.trimString(b.sf);}return b;},loadLayerProps:function Y(c){this._super(c);var b=this.parent&&this.parent.baseLayer;this.attributeMapping=b&&b.attributeMapping;},loadExtraProps:function U(){var b=this.parent&&this.parent.baseLayer;if(b){this.isOnPremise=b.isOnPremise;this.spatialReference=b.wgs84SP;}},isGeoAttribute:function N(e,c){var d=this.attributeMapping,b=c&&c.id;return !!d&&(O.checkDefined(b))&&((!this.isOnPremise&&e===b)||(this.isOnPremise&&d[b]));},supportDataLabel:function(){var b=this.parent&&this.parent.getBaseMapType();return b===D.Esri;},readyToInit:function S(){var b=this.parent;return !!b&&!!b.cloudLayerInit;}});function G(){return mstrApp.isSingleTier&&mstrmojo.dom.getOSInfo().name.toLowerCase().indexOf("mac")>=0;}}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.AbstractMarkerLayer","mstrmojo.gmaps.layer.GraphicLayerViewerFactory","mstrmojo.gmaps.layer.mapbox.ImageLayerViewer");var O=mstrmojo,D=O.hash,I=O.gmaps,K=I.MapUtils,P=I.EnumPropertyType,G=I.EnumClusterMode,M=I.EnumMarkerType,N=I.layer.GraphicLayerViewerFactory;mstrmojo.gmaps.layer.MarkerLayer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractMarkerLayer,null,{scriptClass:"mstrmojo.gmaps.layer.MarkerLayer",isClustered:null,clusterMode:null,clusterRadius:50,clusterMaxZoom:22,secondaryModel:null,showOneMarkerForSameLocation:false,wpDisPlayAffinityLines:false,wpDrawArcsLines:null,wpMaxLineThickness:null,supportImgThreshold:true,setClusterMode:function A(S){if(K.checkDefined(S)){this.clusterMode=S;switch(this.clusterMode){case G.ON:case G.PIE:case G.MOBILE_ON:this.isClustered=true;break;case G.OFF:case G.MOBILE_OFF:default:this.isClustered=false;break;}}if(this.wpDisPlayAffinityLines){this.isClustered=false;}},initAffinityLineDataModel:function H(S){var V=S[P.affinityLineGrid],U=this.parent&&this.parent.parent,T=U&&U.getAffinityLineTemplate(V);this.secondaryModel=this.addDisposable(new mstrmojo.models.template.DataInterface(T));},loadLayerProps:function J(S){if(!S){return ;}this._super(S);if(S[P.showAffinityLines]==="1"){this.wpDisPlayAffinityLines=true;this.wpDrawArcsLines=S[P.showArcsLines];this.wpMaxLineThickness=parseFloat(S[P.maxLineThickness]);this.initAffinityLineDataModel(S);}if(S[P.dm]==="1"){this.showOneMarkerForSameLocation=true;}this.setClusterMode(S[P.clusterMode]);this.clusterRadius=parseInt(S[P.clusterRadius],10)||this.clusterRadius;this.clusterMaxZoom=parseInt(S[P.clusterMaxZoom],10)||this.clusterMaxZoom;if(S[P.imageUrl]!==undefined){this.imageMarkerUrl=S[P.imageUrl];}},switchClusterMode:function F(T){var S=this._viewer;if(!S){return ;}K.showWait();this.setClusterMode(T);N.callFnForViewer(S,"setClusterMode",this.clusterMode,this.isClustered);S.highlightGraphics(this.selectedGraphics);this.setVisibility(this.isVisible());K.hideWait();},changeClusterProps:function Q(T){var S=this._viewer;if(!S){return ;}K.showWait();N.callFnForViewer(S,"changeClusterProps",T);S.highlightGraphics(this.selectedGraphics);this.setVisibility(this.isVisible());K.hideWait();},changeClusterRadius:function C(S){this.clusterRadius=S;this.changeClusterProps({clusterRadius:S});},changeClusterMaxZoom:function B(S){this.clusterMaxZoom=S;this.changeClusterProps({clusterMaxZoom:S});},switchMarkerType:function E(S){var U=this._viewer,V=this.map,W=V.scriptClass==="mstrmojo.mapbox.VisMapbox",T;if(!U){return ;}K.showWait();this.setVisibility(false);T=W&&(U instanceof mstrmojo.gmaps.layer.mapbox.ImageLayerViewer||S==M.Image||U instanceof mstrmojo.gmaps.layer.mapbox.CircleLayerViewer||S==M.Circle);if(T){this.buildViewer();}else{if(K.checkHasFunction(U,"setMarkerType")){U.setMarkerType(S);}U.highlightGraphics(this.selectedGraphics);}V.refreshLegendColorByData(this.key);this.setVisibility(this.isVisible());K.hideWait();},isMarkerMap:function(){return true;},getViewerProps:function R(){return D.copy({markerType:this.getMarkerType(),imageMarkerUrl:this.imageMarkerUrl,isCluster:!!this.isClustered,isPieBubble:!!this.isPieBubble,clusterMode:this.clusterMode,clusterRadius:this.clusterRadius,clusterMaxZoom:this.clusterMaxZoom},this._super());},sliceEnabled:function(){return this.clusterMode===G.PIE;}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.layer.AbstractMarkerLayer","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums");var A=mstrmojo.gmaps,I=A.MapUtils,C=A.EnumRenderMethod;mstrmojo.gmaps.layer.DensityLayer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractMarkerLayer,null,{scriptClass:"mstrmojo.gmaps.layer.DensityLayer",renderMethod:C.canvas,refresh:function H(K){this._super(K);var J=this._viewer;if(J){J.refresh();}},getPropsForViewerUpdate:function E(){return{themeId:this.getThemeId()};},getThemeId:function D(){var J=this.layerProps;if(J&&I.checkDefined(J.dms)){return parseInt(J.dms,10);}},getGraphicsFromPoint:function B(J){var K=this._viewer;if(K){return K.getGraphicsFromPoint(J);}},panBy:function G(K){if(!K||!I.checkVal(K.x)||!I.checkVal(K.y)){return ;}this._super(K);var O=this.preCssTransform,N=K.y,M=K.x,J=this._viewer;if(this.isGeoDataLayer()&&O&&I.checkVal(O.x)&&I.checkVal(O.y)){N-=O.y;M-=O.x;}if(J){J.setTransform({x:M,y:N});}},clean:function F(){this._super();var J=this._viewer;if(J){J.clean();}},supportDataLabel:function(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.MarkerLayer","mstrmojo.gmaps.graphic.PieBubbleGraphic");var a=mstrmojo,Q=a.array,H=a.gmaps,O=H.MapUtils,K=H.EnumPropertyType,J=H.EnumMaxSizeType,X=H.EnumMinSizeType;var V={"size-by":0.9,"no-size-by":0.2},G={"size-by":0.9,"no-size-by":0.5},Z=0.2,R=50,W=4,D=H.ENABLE_MAX_MIN_SIZE_CONTROL,I=10,U=25,P=3.5;mstrmojo.gmaps.layer.BubbleLayer=mstrmojo.declare(mstrmojo.gmaps.layer.MarkerLayer,null,{scriptClass:"mstrmojo.gmaps.layer.BubbleLayer",isPieBubble:null,initParams:function T(){this.maxRadius=R;this.minRadius=W;this.maxSizeInRWD=undefined;this.sizedAtFixedVal=false;this.useAbsolute=!D;this.minMaxMap=null;this.maxMinDataRange=null;this.maxMinSizeRange=null;this.supportImgThreshold=null;this._super();this.isPieBubble=Q.isArray(this.sliceAttrIdxs)&&this.sliceAttrIdxs.length>0;},loadLayerProps:function c(d){this._super(d);if(!this.primaryModel){return ;}if(d[K.maxBubbleSize]!=undefined){this.maxSizeInRWD=parseInt(d[K.maxBubbleSize],10)/2;}if(d[K.useAbsolute]!=undefined){this.useAbsolute=(d[K.useAbsolute]==="0");this.sizedAtFixedVal=(d[K.useAbsolute]==="1");}},switchMaxMinOption:function M(){this.maxMinDataRange=null;this.maxMinSizeRange=null;this.initMaxMinSizeRange();this.destroyAllGraphics();if(this.map&&this.map.excludeData){return ;}this.buildGraphics(this.shapeInfoArr);this.updateGraphics();},getMaxMinSizeType:function b(e){var d=this.layerProps;if(d[e]===undefined){d[e]=e===K.MAX_SIZE_TYPE?J.AUTOMATIC:X.PROPORTIONAL;}return parseFloat(d[e]);},getMaxMinSizeValue:function A(f,d){var e=this.layerProps;if(f===K.MAX_SIZE_VALUE){if(d===J.MANUAL&&e[f]){return parseFloat(e[f]);}if(this.isPieBubble){return G[this.hasSizeByMetric()?"size-by":"no-size-by"];}return V[this.hasSizeByMetric()?"size-by":"no-size-by"];}else{if(d===X.ADJUSTED_RANGE&&e[f]){return parseFloat(e[f]);}return Z;}},initMaxMinDataRange:function N(i){var f=this.minMaxMap[this.sizeMetricIdx],g=f.min,d=f.max,e=f.absMax,h=f.absMin;if(this.useAbsolute||i){this.maxMinDataRange={min:h,max:e};}else{this.maxMinDataRange={min:g,max:d};}},initMaxMinSizeRange:function E(){var d=this.getMaxMinSizeType(K.MAX_SIZE_TYPE),h=this.getMaxMinSizeValue(K.MAX_SIZE_VALUE,d),e=this.getMaxMinSizeType(K.MIN_SIZE_TYPE),k=this.getMaxMinSizeValue(K.MIN_SIZE_VALUE,e),m=false,j=W,i=this.maxSizeInRWD!==undefined?this.maxSizeInRWD:h*this.maxRadius,f,l,g;if(this.hasSizeByMetric()){this.initMaxMinDataRange(e===X.PROPORTIONAL);l=this.maxMinDataRange.max;g=this.maxMinDataRange.min;switch(e){case X.PROPORTIONAL:if(l===0){f=j;}else{f=i*Math.sqrt(g/l);}m=true;break;case X.FULL_RANGE:f=j;break;case X.ADJUSTED_RANGE:f=i*k;break;default:f=j;break;}}else{f=i;}if(i<j){i=j;}if(f<j){f=j;}this.maxMinSizeRange={min:f,max:i,area:m};},buildGraphics:function F(d){if(this.map&&this.map.excludeData){return ;}this.initMaxMinSizeRange();this._super(d);},buildGraphic:function C(g){var e=g&&g.attributes,d=this.getBubbleRadius(g),f=e&&e.slices;if(e&&d){e.radius=d;}if(this.isPieBubble){e.clusterCount=f.length;return new H.graphic.PieBubbleGraphic({parent:this,attributes:e,points:f,geoData:g.geoData});}else{return this._super(g);}},sliceEnabled:function(){return this.sliceAttrIdxs.length>0;},getBubbleRadius:function S(f){if(!f){return ;}var d=f.attributes,e=d&&d.sizeByMetricVal;return D?this._calculateBubbleRadius(e):this._calculateBubbleRadiusWithoutMaxMinCtrl(e);},_calculateBubbleRadius:function B(l){if(!this.maxMinSizeRange){return ;}var f,h,m,g,e=this.maxMinSizeRange,j=this.maxMinDataRange,k=e.max,d=e.min,i=e.area;if(!j){return d;}l=O.checkVal(l)?l:0;if(l<0){if(this.sizedAtFixedVal){return P;}if(this.useAbsolute||i){l=Math.abs(l);}}m=j.max;g=j.min;if(g===m){f=k;}else{h=(l-g)/(m-g);if(i){h=Math.sqrt(h);}f=d+(k-d)*h;}return f;},_calculateBubbleRadiusWithoutMaxMinCtrl:function Y(d){if(!this.hasSizeByMetric()){return this.isPieBubble?U:I;}if(isNaN(d)){return W;}if(d<0){if(this.useAbsolute!==true){return W;}else{d=Math.abs(d);}}return Math.max(this.maxRadius*Math.sqrt(d/this.maxMinDataRange.max),W);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.CustomLayer","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.gmaps._AreaMapHelper","mstrmojo.gmaps.layer._SecondaryGeoRoleHelper");var a=mstrmojo,Q=a.array,b=a.css,F=a.gmaps,N=F.MapUtils,E=F._AreaMapHelper,J=F.EnumPropertyType,Z=a.vi.viz.EnumDSSDropZones,W=F.EnumGeographicRole,K=",";var A={"2101":"https://dl.dropbox.com/s/9huptsjkm74linh/a0.json","2102":"https://dl.dropbox.com/s/cghcc7tt1d45wvh/a1.json","2103":"https://dl.dropbox.com/s/4lpaoirbnd06vbm/a2.json","2104":"https://dl.dropbox.com/s/i9605oi39asvkkt/a3.json","2105":"https://dl.dropbox.com/s/yb0u612rbixazdn/a4.json","2106":"https://dl.dropbox.com/s/oi0o5ngq5nchl77/a5.json","2107":"https://dl.dropbox.com/s/ypeweq4lfp4dyfe/p2.json"};var D={"0":["1","2","3"],"1":["2","3"],"2":["3"],"8":["3"],"9":["2","3"]};var U={"1":2,"2":1,"3":0};function O(g,d,j){function i(k){if(j){return j(k,g);}throw k+" ("+g+")";}try{var f=new XMLHttpRequest();f.open("GET",g,true);f.onreadystatechange=function(){if(f.readyState!==4){return ;}if(f.status===200){var e=f.responseText;var k=JSON.parse(e);d(k);return ;}throw"Failed to fetch URL: "+g+"state: "+f.readyState+"; status: "+f.status;};f.send();}catch(h){i(h);}}function Y(d,f){var e=document.querySelector("div.mstrmojo-VIVizEditor .mstrmojo-VIUnitList .unit.icz12[idx='"+d+"'] .inner-wrap .zone");if(d===0){b.toggleClass(e,"warn",f);}else{b.toggleClass(e,"secd",f);b.toggleClass(e,"warn",!f);}}mstrmojo.gmaps.layer.MapBoxPolygonLayer=mstrmojo.declare(mstrmojo.gmaps.layer.PolygonLayer,[mstrmojo.gmaps.layer._SecondaryGeoRoleHelper],{scriptClass:"mstrmojo.gmaps.layer.MapBoxPolygonLayer",duplicateGeoNamePercent:0,geoSecondaryRolePosition:null,_shapeToRowIndexMap:null,_convertedNameMap:null,nameConversionMap:null,mapConfig:null,lookUpTable:null,mainGeoRole:null,getGeoRole4MainGeoAttr:function S(){var g=this.getLayerProp(J.shapeFile),f=this.map.getMapConfig().common,d=f.shapes,e=E.getMatchingShape(d,g,null);return e&&e.roleId;},initGraphics:function X(d){var f,h,g,e=this._shapeInfoArrCache;if(!this._super()){return ;}N.showWait();this.mapConfig=this.initWebMapConfig(false);h=this.getLayerProp(J.shapeFile);g=this.geoPosition;if(!N.checkVal(g)||g<0){this.updateMapExtent();return ;}if(d&&Q.isArray(e)&&e.length>0){this.buildLayerContent(e,g,null,d);}else{this._shapeToRowIndexMap={};this._convertedNameMap={};this.mainGeoRole=this.getGeoRole4MainGeoAttr();this.nameConversionMap=this.getNameConversionMap();this.secondaryGeoInfo=this.getSecondaryGeoInfo();f=this.initDataLookup(g);this.fetchGeoIDByGeoName(h,f,g);}},initDataLookup:function c(e){var d=[],j=this.getDataRowHeaders(),t=j.length,v=this._shapeToRowIndexMap,n=this.secondaryGeoInfo,m=n&&n.index,r=n&&n.geoRole,q=this.mainGeoRole,h,o,s,k,l,u,g,f,p;for(s=0;s<t;s++){l=this.getElementValue(s,e);if(!l){continue;}p=l;u=this.convertName(l,q);o=u;k={n:u};if(n){g=this.getElementValue(s,m);if(g){p+=K+g;f=this.convertName(g,r);o+=K+f;k.pn=f;}}o=o.toLowerCase?o.toLowerCase():o;if(v[o]){continue;}d.push(k);h=j[s].items[e];v[o]={rowIndex:s,geoIndex:h.idx,dlText:l,originGeoName:p,sfv:g};}return d.length===0?null:JSON.stringify(d).toLowerCase();},fetchLookUpTable:function C(k){var g=this,f=[],i=this.mapConfig,h=i.ea?i.ea:"name",d=this._shapeToRowIndexMap,e=A[this.mainGeoRole],j;if(e){j=h.split(",");O(e,function(o){var n,m,r,l,q,p=o.data;g.lookUpTable=o;for(n in p){m=p[n];for(l=0;l<j.length;l++){q=j[l];if(q.toLowerCase()==="zip_code"){r=n.substring(4);}else{r=m[q]?m[q].toLowerCase():"";}if(d[r]){f.push({id:n,geoName:r});break;}}}k(f);});}},createFeatures:function I(k){var n,o,i,m,e,d,j,l=[],f=[],g=k.data||{},h=this._shapeToRowIndexMap;for(n in g){o=g[n];i=o.n;m=o.pn;e=i;if(m){e+=K+m;}if(h[e]){d=o.bd;f.push({id:n,geoName:e,bbox:d});if(d){l.push(turf.bboxPolygon(d));}}}j=turf.featureCollection(l);this.polyBBox=turf.bbox(j);return f;},_calGeoExtent:function B(d){var e=this.polyBBox;if(e){return{lngWest:e[0],latSouth:e[1],lngEast:e[2],latNorth:e[3]};}},fetchGeoIDByGeoName:function R(o,d,p){if(!(o&&N.checkDefined(d)&&N.checkDefined(p))){console.log("fetchGeoIDByGeoName failed: invalid params!");this.updateMapExtent();return ;}var g,f,n=this,i=new Date(),j=this.map.getMapConfig().common,e=j.shapes,l=this.secondaryGeoInfo,k={taskId:"getMapBoxGeoID",shapeId:o,queryField:d,worldView:"US"},m=function(r){n.lookUpTable=r;console.log("Geo Name convert time: "+(new Date()-i)+" ms");var s=n.createFeatures(r),q=n.parent;if(!s||s.length===0){n.updateMapExtent();N.hideWait();return ;}n.calculateGeoNameDupPercent(s);n.showInfoIcon4GeoItem();n.buildLayerContent(s,p);if(q){q.highlightAllLayers();}N.hideWait();},h=function(q){N.log("Mapbox geo id conversion Error: "+q);N.hideWait();N.hideWait();};if(l){g=l.geoRole;f=E.getMatchingShape(e,null,g);if(f){k.parentKey="parent_"+U[g];k.secondShapeId=f.id;}}N.showWait();if(mstrApp.isDossier){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:m,failure:function(q){console.log("Mapbox geo id conversion failed! "+q.getResponseHeader("X-MSTR-TaskFailureMsg"));if(h&&q){h(q);}}},k);}else{mstrApp.serverRequest(k,{success:m,failure:function(q){console.log("Mapbox geo id conversion failed!");if(h&&q){h(q);}}});}},getSingleShapeInfo:function H(e,g,f){if(!e||!g||!N.checkVal(f)){return ;}var d=this.populateGraphicAttributes(this.data,g,f,e.geoName)||{};this.populateGeoIdAndBBoxInfo(e,d);return{attributes:d};},isGeoAttribute:function M(e,d){return N.checkDefined(e)&&!!d&&(e===d.id);},calculateGeoNameDupPercent:function G(h){var d=this._shapeToRowIndexMap,j=d?Object.keys(d).length:0,e={},g=0,f,k;for(f=0;f<h.length;f++){k=h[f].geoName;if(!e[k]){e[k]=1;}else{e[k]++;}}for(k in e){if(e[k]>1){g++;}}this.duplicateGeoNamePercent=j===0?0:g/j;},showInfoIcon4GeoItem:function V(){var e=this.map,d=e&&e.getEditingGridKey(),f=e&&e.isCurrentVizBoxSelected();if(f&&(d===this.key)){Y(0,this.duplicateGeoNamePercent>0);Y(1,!!this.secondaryGeoInfo);}},getSecondaryGeoInfo:function P(){var e=this.map,r=e&&e.getDropZoneItems(Z.GeoAttribute,this.key),h=r&&r[1],q=this.getDataRows(),m=(q&&q.length)||0,p=D[this.mainGeoRole],f,n,d,o,l,g,k;if(h&&p){f=h.id;for(l=0;l<m;l++){n=q[l];if(n.id===f){d=n.fs;k=(d&&d.length)||0;for(g=0;g<k;g++){o=(d[g].fgr).toString();if(o&&p.indexOf(o)>=0){this.geoSecondaryRolePosition=l;return{geoRole:o,index:l};}}}}}},getTtpContent4GeoItem:function T(f){var j,i,h="",g=this.duplicateGeoNamePercent,e=!!this.secondaryGeoInfo,d=function(m,k){var l='<div class="name">'+m+"</div>";if(k){l+='<div class="dsc">'+k+"</div>";}return l;};if(f===0&&g>0){j=mstrmojo.desc(15717,"We were unable to resolve the exact location for ## of your data.").replace("##",Math.ceil(g*100)+"%");h=d(j);if(!e){j=mstrmojo.desc(15719,"Please add one or more geographic attributes to this drop zone to refine the results.");i=mstrmojo.desc(15720,"For example, if you want to plot states, add the country attribute as a secondary identifier.");h+='<div class="dividingLine"></div>'+d(j,i);}return h;}else{if(f===1){if(!e){j=mstrmojo.desc(15721,"This is not a valid secondary geo role.");if(this.mainGeoRole===W.EnumGeographicRoleZipCode){i=mstrmojo.desc(16132,"Please use Country as the secondary geo role.");}else{i=mstrmojo.desc(15722,"Please make sure the geography type is defined and is higher level than primary geo attribute. Otherwise, please remove it.");}return d(j,i);}else{return d(mstrmojo.desc(15723,"This is secondary geo attribute that is helping define your data."));}}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.BubbleLayer");var Q=mstrmojo.array,V=mstrmojo.hash,H=mstrmojo.gmaps,W=H.EnumPropertyType;var T=1,M=2,O=10;function A(b){return Q.filter(b,function(c){return !c.isPath&&!c.isText;});}function J(b,c,g,e){if(!c){clearTimeout(e?this.bubbleTimer:this.pathTimer);}c=c||0;b[c].geometry.setVisibility("visible");if(++c<b.length){var d=this,f=setTimeout(function(){J.call(d,b,c,g,e);},g);if(e){this.bubbleTimer=f;}else{this.pathTimer=f;}}}function F(c,b,d){clearTimeout(d);Q.forEach(c,function(e){e.geometry.setVisibility(b);});}mstrmojo.gmaps.layer.PathLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BubbleLayer,null,{scriptClass:"mstrmojo.gmaps.layer.PathLayer",pathFillColor:"#FF0000",bubbleGraphics:null,pathGraphics:null,bubbleTimer:null,pathTimer:null,zoomLevel:null,initParams:function U(){this._super();this.bubbleGraphics=[];this.pathGraphics=[];this.minRadius=T;this.maxRadius=M;},loadLayerProps:function a(c){this._super(c);var b=c[W.pathColor];if(b){this.pathFillColor="#"+b;}this.isClustered=false;},initMaxMinSizeRange:function G(){if(this.hasSizeByMetric()){this.initMaxMinDataRange();this.maxMinSizeRange={min:this.minRadius,max:this.maxRadius};}else{this.maxMinSizeRange={min:O,max:O};}},buildGraphics:function I(j){if(!j||!(Q.isArray(j))){return ;}var b=this.bubbleGraphics,g,h,l=null,k=j[0],e=k&&k.geoData||{},c=k&&k.geoData.lng,f,d;for(d=0;d<j.length;d++){k=j[d];g=this.buildGraphic(k);b.push(g);this.addGraphic(g);if(d>0){h=this.buildPathGraphic(l,g,k);this.pathGraphics.push(h);}l=g;f=k.geoData.lng;if(f>c){c=f;e=k.geoData;}}Q.forEach(this.pathGraphics,function(i){this.addGraphic(i);},this);this.buildViewer();},buildPathGraphic:function P(d,c,b){return new H.graphic.Graphic({parent:this,type:"Polygon",geoData:[[d.geoData,c.geoData]],graphicFrom:d,graphicTo:c,attributes:V.copy(b.attributes,{fillColor:this.pathFillColor}),infoTemplate:this.infoTemplate,isPath:true});},callbackForUpdateGraphics:function E(){this._super();F(this.pathGraphics,"hidden",this.pathTimer);this.animatePaths();},animateBubbles:function N(){J.call(this,this.bubbleGraphics,0,50,true);},animatePaths:function K(){J.call(this,this.pathGraphics,0,150,false);},handleClickEvt:function S(){F(this.bubbleGraphics,"hidden",this.bubbleTimer);},handleGraphicsClick:function D(e,c,g){if(!this.map){return ;}var f=Q.filterOne(e,function(h){return h.isPath;});if(f){var d=this.bubbleGraphics;clearTimeout(this.bubbleTimer);this.bubbleTimer=setTimeout(function(){F(d,"visible");},100);return ;}var b=Q.filterOne(e,function(h){return h.isText;});if(b){this.animateBubbles();return ;}this._super(A(e),c,g);},getTooltipContent:function Z(b){return this._super(A(b));},searchGraphicsContained:function R(b){return A(this._super(b));},clearAllSelectedGraphics:function C(b){F(this.bubbleGraphics,"hidden",this.bubbleTimer);this._super(b);},supportDataLabel:function B(){return false;},unrender:function X(){clearTimeout(this.bubbleTimer);clearTimeout(this.pathTimer);this._super();},destroy:function Y(){delete this.bubbleGraphics;delete this.pathGraphics;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.layer.MarkerLayer","mstrmojo.gmaps.layer.BubbleLayer","mstrmojo.gmaps.layer.DensityLayer","mstrmojo.gmaps.layer.CloudLayer","mstrmojo.gmaps.layer.PathLayer","mstrmojo.gmaps.layer.CustomLayer","mstrmojo.gmaps.layer.MapBoxPolygonLayer");var E=mstrmojo.gmaps,D=E.layer,F=E.EnumGraphicType,C=E.EnumPolygonSource;mstrmojo.gmaps.layer.GraphicLayerFactory=mstrmojo.provide("mstrmojo.gmaps.layer.GraphicLayerFactory",{_mixinName:"mstrmojo.gmaps.layer.GraphicLayerFactory",create:function B(H){var G=H&&H.graphicType,I;switch(G){case F.Marker:default:I=new D.MarkerLayer(H);break;case F.Bubble:I=new D.BubbleLayer(H);break;case F.Area:I=this.createPolygonLayer(H);break;case F.Density:I=new D.DensityLayer(H);break;case F.Path:I=new D.PathLayer(H);break;}return I;},createPolygonLayer:function A(I){var H=I&&I.polygonSource,G;switch(H){case C.Cloud:default:G=new D.CloudLayer(I);break;case C.Custom:G=new D.CustomLayer(I);break;case C.MapBoxPolygon:G=new D.MapBoxPolygonLayer(I);break;}return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.VisTooltip","mstrmojo.NewVisTooltip","mstrmojo.VisUtility","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapLayerZone","mstrmojo.gmaps._AreaMapHelper","mstrmojo.gmaps._MapInteractivity","mstrmojo.gmaps.basemap.BaseLayerFactory","mstrmojo.gmaps.layer.GraphicLayerFactory");var c=mstrmojo,P=c.array,a=c.VisTooltip,AP=c.NewVisTooltip,AZ=c.gmaps,r=AZ.MapUtils,N=AZ.EnumGraphicType,t=AZ.EnumPolygonSource,o=AZ.EnumZoomBehavior,AD=AZ.EnumPropertyType,Ad=mstrmojo.gmaps.EnumDynamicZoomStatus,f=AZ.EnumLanguageType,Aj=AZ._AreaMapHelper,Ac=AZ.layer.GraphicLayerFactory,i=AZ.basemap.BaseLayerFactory,AJ=["#FF0000","#F98435","#EA0F87","#06CCC2"],D=true,g=false,E;mstrmojo.gmaps.MapViewer=mstrmojo.declare(mstrmojo.Obj,[mstrmojo.gmaps._MapInteractivity],{scriptClass:"mstrmojo.gmaps.MapViewer",baseLayer:null,graphicLayerMapping:null,toolbar:null,toolbarInit:false,_graphics:null,gridsMapping:null,k:null,beanPath:null,useAttribute:false,hasInit:false,baseLayerFactory:null,tooltipWin:null,enablePopup:true,infoWindowVisible:true,affinityLineColorIndex:0,supportDensity:false,init:function AI(Ao){this._super(Ao);var Ap=this.gridsMapping;if(!Ap){return ;}this._graphics=[];this.graphicLayerMapping={};this.baseLayerFactory=new i();this.initMapToolbar();this.initMapTooltip();},initMapTooltip:function Z(){if(!this.tooltipWin){this.tooltipWin=this.addDisposable(r.isExpress()?new a():new AP());this.tooltipWin.render();}},initMapToolbar:function O(){if(!this.parent){return ;}var Ao=this.toolbar=new mstrmojo.gmaps.MapToolbarNew({map:this.parent,parent:this});Ao.render();},updateMapToolbar:function H(){var Ao=this.toolbar;if(!Ao){return ;}if(this.needMapToolbar()!==true){Ao.setVisibility(false);}else{if(Ao.update instanceof Function){Ao.update();}}},initAllLayers:function AF(){var Ap=this.parent,Aq=this.getBaseMapType()||Ap.getDefaultBaseMapType(),Ao=this.baseLayer;this.gridsMapping=this.gridsMapping||{};if(Ao){this.loadExistingBaseLayer(Ao);this.initGraphicLayers();}else{this.initBaseLayer(Aq);}this.addEventListeners();},loadExistingBaseLayer:function AX(Ao){Ao.parent=this;Ao.map=this.parent;this.restoreBaseLayerNode();this.resize();},initBaseLayer:function k(Ar){var As=this.parent,Aq=As&&As.baseLayerDiv,Ao,Ap;E=window.mapboxgl&&window.mapboxgl.supported();if(!E&&As.constructor===c.mapbox.VisMapbox){As.displayError(mstrmojo.desc(15714,"Please upgrade your browser"));return ;}if(!Aq||!Ar||!this.baseLayerFactory){this.updateMapExtent();return ;}Ap=this.getBaseMapConfig(Ar);Ao=this.baseLayer=this.baseLayerFactory.create(Ap);if(Ao){Ao.render();}else{console.log("initBaseLayer(): invalid node");this.updateMapExtent();}},initGraphicLayers:function K(){var Ap=this.gridsMapping,Ao;if(!Ap){console.log("initGraphicLayers(): no grid data found");this.updateMapExtent();return ;}for(Ao in Ap){if(Ap.hasOwnProperty(Ao)){this.initGraphicLayer(Ap[Ao]);}}this.highlightAllLayers();this.parent.refreshDzPropPanels();this.parent.raiseEvent({name:"regenerateToolbar"});},refreshCloudLayers:mstrmojo.emptyFn,refreshMapBoxPolygonLayers:mstrmojo.emptyFn,resizeGraphicLayers:mstrmojo.emptyFn,applyViewPort2Graphics:mstrmojo.emptyFn,initGraphicLayer:function AC(Aq){var Ap=this.graphicLayerMapping=this.graphicLayerMapping||{},As,Ao,Ar;Aq=this._preprocessSingleGrid(Aq);Ao=Aq&&Aq.key;if(Ao){As=Ap[Ao];if(As){As.destroy();}As=Ap[Ao]=Ac.create(Aq);Ar=As.data;if(!As.isGridDataEmpty()){As.initGraphics();}else{if(Ar&&Ar.eg!==undefined){console.log("eg in data: "+Ar.eg);}As.updateMapExtent();}return As;}},switchBaseMap:mstrmojo.emptyFn,addGraphicLayer:function AN(Ap){var Ao=Ap&&Ap.k;if(!Ao){return ;}this.initGraphicLayer({data:Ap});},removeGraphicLayer:function s(Ao){var Ap;if(!Ao){return ;}if(!this.gridsMapping||!this.graphicLayerMapping){this.gridsMapping={};this.graphicLayerMapping={};}else{Ap=this.graphicLayerMapping[Ao];if(Ap&&Ap.destroy instanceof Function){Ap.destroy();}delete this.gridsMapping[Ao];if(this.cloudLayersMapping){delete this.cloudLayersMapping[Ao];}delete this.graphicLayerMapping[Ao];}this.updateMapToolbar();},updateGraphicLayer:function Ai(Ap,Ao){if(this.parent&&this.parent.excludeData){return ;}if(!!Ao){this.refreshGraphicLayer(Ap);}else{this.rebuildGraphicLayer(Ap);}},rebuildGraphicLayer:function AA(Ap){var Ao=Ap&&Ap.k;if(!Ao){return ;}this.removeGraphicLayer(Ao);this.initGraphicLayer({data:Ap});this.highlightAllLayers();},refreshGraphicLayer:function Aa(Ap){var Ao=Ap&&Ap.k,Aq=this.graphicLayerMapping&&this.graphicLayerMapping[Ao],Ar=this.parent;if(!Ao||!Aq){console.log("Fail to refresh graphic layer");return ;}if(!Ar.hasColorByOrSizeBy(Ao)&&Aq.legend&&Ar.legendCon){Aq.destroyLegend();Ar.legendCon.calculateLegendDockedPositions(Ar.getWidth(),Ar.getHeight());}Aq.refresh(Ap);this.highlightAllLayers();},reorderGraphicLayers:function n(Ap){var As=this.graphicLayerMapping,At=this.parent,Ar,Aq,Ao;Ap=Ap||(At&&At.layerIdxMappingArr);if(!Ap||!P.isArray(Ap)||Ap.length<1||!As){return ;}for(Aq=0,Ao=Ap.length;Aq<Ao;Aq++){Ar=Ap[Aq];if(Ar&&!!As[Ar]){As[Ar].setLayerZIndex();}}},onSecondaryDataSliced:function AK(Ao){this.forEachGraphicLayer(function(Ap){if(Ap.isAftLnTmptHit(Ao)){Ap.initAffinityLineDataModel(Ap.layerProps);Ap.createAffinityLinesConfig();if(Ap._viewer&&(typeof Ap._viewer.reGenerateAffinityLineLayer==="function")){Ap._viewer.reGenerateAffinityLineLayer();}}});},getWidgetProps:function AV(){return this.parent&&this.parent.getProperties();},getBaseMapType:mstrmojo.emptyFn,getMapGeoExtent:function Ae(){var Ao;this.forEachGraphicLayer(function(Ap){if(Ap&&Ap.getGeoExtent instanceof Function){if(!Ao){Ao=Ap.getGeoExtent();}else{Ao.union(Ap.getGeoExtent());}}});return Ao;},updateNeedUpdLayers:function h(Aq,Ap){if(Ap&&Aq.needUpdateLayers&&Aq.needUpdateLayers.length>0){var Ao=Aq.needUpdateLayers.indexOf(Ap);if(Ao>=0){Aq.needUpdateLayers.splice(Ao,1);}}},updateMapExtent:function AM(Ao){var Ap=this.parent;this.updateNeedUpdLayers(Ap,Ao);if(Ap.needUpdateLayers.length>0){return ;}if(!this.baseLayer.isActive()){return ;}this.updateBaseMap();this.updateMapComponents(Ap);Ap.editorContentReady=true;Ap.updatePropEditor();if(r.checkHasFunction(Ap,"checkForMapReady")){Ap.checkForMapReady();}if(Ap.dynZoomStatus===Ad.FIRST_ADD_GEO_ARR){Ap.dynZoomStatus=Ad.FIRST_GEO_ADD_FINISHED;}},updateMapComponents:function AS(Ao){this.updateMapToolbar();Ao.toggleBaseMapLabels();this.reorderGraphicLayers();},updateBaseMap:function A(){var Ao=this.baseLayer;if(Ao.isSupport===true&&(this.hasInit!==true||this.isDynamicZoom()===true)&&(Ao.updateExtent instanceof Function)){this.hasInit=true;Ao.updateExtent(this.getMapGeoExtent());}},hasSelectedGraphics:function AR(){var Ao=false;this.forEachGraphicLayer(function(Ap){Ao=Ap&&Ap.hasGraphicSelected();return !Ao;},null,true);return Ao;},clearAllSelectedGraphics:function AY(Ao){this.forEachGraphicLayer(function(Ap){Ap.clearAllSelectedGraphics(Ao);});},clearAllContextMenuSelection:function AW(){this.forEachGraphicLayer(function(Ao){Ao.clearAllContextMenuSelection();});},clearAllContextMenuSelectionHighLights:function U(){this.forEachGraphicLayer(function(Ao){Ao.clearAllContextMenuSelectionHighLights();});},updateCoordForAllGraphicLayers:mstrmojo.emptyFn,hideAllGraphicLayers:function e(){this.forEachGraphicLayer(function(Ao){Ao.setVisibility(false);});},destroyAllGraphicLayerViewers:function An(){this.forEachGraphicLayer(function(Ao){Ao.destroyViewer();},false,true);},buildAllGraphicLayerViewers:function AB(){this.forEachGraphicLayer(function(Ao){Ao.buildViewer();},false,true);},containsLayerInMap:function v(Ao){var Ap=this.graphicLayerMapping,Ar,Aq;if(!Ap){return false;}for(Aq in Ap){if(Ap.hasOwnProperty(Aq)){Ar=Ap[Aq];if(Ar&&Ar.isVisible()&&Ar[Ao]&&Ar[Ao]()){return true;}}}return false;},isMapEnabledAffinityLine:function m(){return this.containsLayerInMap("isAffinityLineLayerEnabled");},isMapShownAffinityLine:function S(){return this.containsLayerInMap("isAffinityLineShown");},isMapHideAffinityLine:function S(){return this.containsLayerInMap("isAffinityLineHide");},showAllAffinityLinesLayer:function Ag(){this.forEachGraphicLayer(function(Ao){Ao.showAffinityLineLayer();});},hideAllAffinityLinesLayer:function y(){this.forEachGraphicLayer(function(Ao){Ao.hideAffinityLineLayer();});},hideAffinityLinesLayer:function T(Ao){var As=Ao&&Ao[0],Aq=As&&As.getLayerKey(),Ap=this.graphicLayerMapping,Ar=Ap&&Ap[Aq];if(Ar){Ar.hideAffinityLineLayer();}},displayAffinityLinesLayer:function AL(Ao){var As=Ao&&Ao[0],Aq=As&&As.getLayerKey(),Ap=this.graphicLayerMapping,Ar=Ap&&Ap[Aq];if(Ar){Ar.showAffinityLineLayer();}},forEachGraphicLayer:function AU(As,A0,Aw,Ay){var Ao=this.parent,Az=Ao.layerIdxMappingArr,At=this.graphicLayerMapping,Ax=function(A2,A1){if(A1){return As.call(A1,A2);}else{return As(A2);}},Aq=function(A1){return A1&&(A1.isVisible instanceof Function)&&A1.isVisible();},Ar,Av,Ap,Au;if(!At||Object.keys(At).length<1){return ;}if(!!A0){if(!Az){return ;}for(Ap=0,Au=Az.length;Ap<Au;Ap++){Av=Az[Ap];Ar=At[Av];if(!Aw&&!Aq(Ar)){continue;}if(Ax(Ar,Ay)===false){break;}}}else{for(Av in At){if(At.hasOwnProperty(Av)){Ar=At[Av];if(!Aw&&!Aq(Ar)){continue;}if(Ax(Ar,Ay)===false){break;}}}}},handleLassoDrawEnd:function I(Ap){var Ao=this.toolbar;this.handleLassoSelection(Ap);if(Ao&&(Ao.resetSelectionState instanceof Function)){Ao.resetSelectionState();}},handleLassoSelection:function G(Ap){this.forEachGraphicLayer(function(Aq){if(Aq&&Aq.handleLassoSelection instanceof Function){Aq.handleLassoSelection(Ap);}});this.highlightAllLayers();var Ao=this.parent;Ao.endSelections();Ao.handleTemplateUnitSelections();},_preprocessSingleGrid:function Ak(Ao){var Ax=this.parent,At=Ao&&Ao.data,Aw=this.baseLayer,Ay,Ar,Ap,As,Au,Aq,Av,Az;if(!At||!At.k||!Ax){return Ao;}Ay=At.k;Ao.key=Ay;Ao.dropZones=Ax.getDropZones(Ay);Az=Ax.fnGetWidget(Ay);Ao.model=Az&&Az.model;Ao.defn=Az&&Az.defn;Au=At.vp||{};if(!Au.sa&&!Au[AD.graphicType]&&!Au.sm&&At.ghs){Aq=At.ghs.rhs;Av=(!Aq||!Aq.items||!Aq.items.length)?0:Aq.items.length;Au[AD.graphicType]=(this.supportDensity&&Av>500)?N.Density:N.Marker;}Ao.graphicType=this._getGraphicType(Ao);if(!r.checkDefined(Au[AD.layerName])){Au[AD.layerName]=Ax.generateNewLayerName();}if(!r.checkDefined(Au[AD.layerIdx])){Au[AD.layerIdx]=Ax.generateNewLayerIdx();}Ao.parent=this;if(Ao.graphicType===N.Area){Ar=Ax.getMapConfig()&&Ax.getMapConfig().common;Ap=Ar&&Ar.shapes;As=Ar&&Ar.layers;if(!!Ap){if(Aw&&Aw.isOnPremise){Ao.polygonSource=t.Cloud;}else{Ao.polygonSource=Aj.getPolygonSource(Ao,Ap,As,this.getBaseMapType());}}}this.gridsMapping[Ay]=Ao;return Ao;},getBaseMapConfig:function Y(Aq){var Ap=this.getWidgetProps(),Ao={parent:this,baseMapType:Aq,GL_SUPPORTED:E};if(!Ap){return Ao;}Ao.mvo=Ap.mvo;Ao.showZoomBtns=(Ap[AD.showZoomBtns]!=="0");Ao.mapStyle=Ap[AD.mapStyle];Ao.languageType=Ap[AD.languageType]||f.English;this.loadZoomLevelAndPosition(Ap,Ao);this.loadMapboxLabelProps(Ap,Ao);return Ao;},loadZoomLevelAndPosition:function B(Aq,Ap){var Ao=Aq[AD.zoomSetting]!==o.Automatic,As=Aq[AD.keepZoomAndPos]===true||Aq[AD.keepZoomAndPos]==="true";if(Ao&&As){try{Ap.originalZoom=parseFloat(Aq[AD.zoomLevel]);Ap.originalLatLngCenter=JSON.parse(Aq[AD.mapCenter]);Ap.originalBearing=parseFloat(Aq[AD.mapBearing]);Ap.originalPitch=parseFloat(Aq[AD.mapPitch]);}catch(Ar){r.log("Parse Zoom Level and Center Point Error");}}},loadMapboxLabelProps:function AO(Aq,Ap){var Ar=Aq[AD.showMapLable],Ao=Aq[AD.mapLabelOnTop];if(Ar!==undefined){Ap.showMapLabels=Ar===true||Ar==="true";}else{Ap.showMapLabels=D;Aq[AD.showMapLable]=D;}if(Ao!==undefined){Ap.mapLabelsOnTop=Ao===true||Ao==="true";}else{Ap.mapLabelsOnTop=g;Aq[AD.mapLabelOnTop]=g;}},getGraphicLayer:function R(Ap){var Ao=this.graphicLayerMapping;if(Ap&&Ao){return Ao[Ap];}},getGraphicLayerByIdx:function Al(Ao){Ao=parseInt(Ao);if(!isNaN(Ao)){var Ap=this.parent&&this.parent.getGridKeyByIdx(0);return this.getGraphicLayer(Ap);}},getGraphicLayerCount:function z(){return(!this.gridsMapping)?0:Object.keys(this.gridsMapping).length;},getLayerCount:function AG(){return this.getGraphicLayerCount()+1;},getActiveLayerCount:function p(){var Ao=0;this.forEachGraphicLayer(function(Ap){if(Ap&&Ap.isActive()){Ao++;}},null,true);if(this.baseLayer&&this.baseLayer.isActive()){Ao++;}return Ao;},getVisibleGraphicLayerCount:function AT(){var Ao=0;this.forEachGraphicLayer(function(Ap){if(Ap){Ao++;}});return Ao;},getVisibleGraphicLayers:function b(){var Ao=[];this.forEachGraphicLayer(function(Ap){if(Ap){Ao.push(Ap.key);}});return Ao;},needMapToolbar:function Q(){var Ao=this.parent&&this.parent.getProperties();return !!Ao&&Ao[AD.needMapToolbar]!=="0";},isDynamicZoom:function J(){var Ap=this.getWidgetProps(),Ao=Ap&&(Ap.rosa===o.Automatic),Aq=this.parent;return Ao||Aq.dynZoomStatus===Ad.FIRST_ADD_GEO_ARR;},_getGraphicType:function AQ(Aq){var Ar=Aq&&Aq.data&&Aq.data.vp,Ao,Ap;if(!Ar){return ;}Ap=Ar[AD.graphicType];if(!!Ap&&(Ap===N.Density)){if(r.isCanvasSupported()){Ap=N.Density;}else{Ap=N.Marker;mstrmojo.alert(mstrmojo.desc(9281,"Density Maps is not supported on this Browser version."));}}if(Ap===N.Marker&&!(Aq.dropZones.latitude&&Aq.dropZones.longitude)&&!!Ao&&Ao==="1"){Ap=N.Area;}return Ap;},hideInfoWindow:function AH(){this.hideTooltip();},getNextDefaultAffinityLineColor:function V(){var Ao=this.affinityLineColorIndex++;return AJ[Ao%(AJ.length-1)];},getBaseLayerContainer:function AE(){var Ao=this.parent;if(Ao){return Ao.baseLayerDiv;}},restoreBaseLayerNode:function Ab(){var Ao=this.baseLayer,Ap=Ao&&Ao.getNode(),Aq=this.getBaseLayerContainer();if(Aq&&Ap){Aq.appendChild(Ap);}},restore:function X(){if(!this.parent){return ;}var Ap=this.parent,Ao=Ap.legendPlaceholder;this.restoreBaseLayerNode();if(Ao&&Ao.parentNode&&Ap.legendCon){Ao.parentNode.replaceChild(Ap.legendCon.domNode,Ao);}this._restoreToolbar(Ap.toolBarDiv);this.restoreToast();},_restoreToolbar:function j(Ao){var Aq=this.toolbar,Ap=Aq&&Aq.domNode;if(Ao&&Ap&&!Ao.contains(Ap)){Ao.appendChild(Aq.domNode);}},resize:function M(){if(!this.parent){return ;}var As=this.parent,Aq=As.width,Ao=As.height,Ap=this.baseLayer,Ar=this.toolbar;if(!Ap){return ;}if(As.needMapReadyEvent()){As.duringResize=true;Ap.isBaseMapReady=false;As.graphicsReady=false;}this.resizeGraphicLayers(Aq,Ao);if(Ar){Ar.resize();}Ap.resize(Aq,Ao);},getToastId:function C(){return((this.parent&&this.parent.id)||this.id)+"-mojoMapToast";},showToast:function Af(Ao){var Ap=this.getToastId();this.destroyToast();mstrmojo.insert({id:Ap,scriptClass:"mstrmojo.Label",cssClass:"mapToastCss",text:Ao}).render();this.restoreToast();},destroyToast:function Am(){try{var Aq=this.getToastId(),Ao=mstrmojo.all[Aq];if(Ao){Ao.destroy();}}catch(Ap){}},getToastNode:function x(){var Ap=this.getToastId(),Ao=mstrmojo.all[Ap];return Ao&&Ao.domNode;},restoreToast:function d(){var Ar=this.getToastId(),Ap=this.parent&&this.parent.domNode,Ao=mstrmojo.all[Ar],Aq=Ao&&Ao.domNode;if(Ap&&Aq){Ap.appendChild(Aq);}},hideTooltip:function w(Ao){if(this.tooltipWin){this.tooltipWin.hide(Ao);}},preRefresh:function W(){var Ao=this.toolbar;return Ao&&Ao.preRefresh();},unrender:function u(){if(this._super){this._super();}},destroyBaseLayer:function q(Ao){if(!Ao){r.destroyObj(this.baseLayerFactory);}delete this.baseLayer;delete this.baseLayerFactory;},destroyGraphicLayers:function l(){this.forEachGraphicLayer(function(Ao){if(Ao){Ao.destroy();}},true,true);delete this.graphicLayerMapping;delete this.cloudLayersMapping;},destroyToolbar:function Ah(){r.destroyObj(this.toolbar);delete this.toolbar;},destroy:function F(Ap,Ao){this.destroyToolbar();delete this.tooltipWin;this.destroyGraphicLayers();this.destroyBaseLayer(Ao);delete this.gridsMapping;delete this.parent;this._super(Ap);}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapViewer","mstrmojo.mapbox._MapboxInteractivity");var A=mstrmojo,F=A.gmaps,B=F.EnumBaseMapType,D=F.EnumRenderMethod;mstrmojo.mapbox.MapboxViewer=mstrmojo.declare(mstrmojo.gmaps.MapViewer,[mstrmojo.mapbox._MapboxInteractivity],{scriptClass:"mstrmojo.mapbox.MapboxViewer",renderMethod:D.mapbox,getBaseMapType:function G(){return B.Mapbox;},getMapboxInstance:function E(){var H=this.baseLayer;if(H){return H.getBaseMap();}},destroy:function C(I,H){this.removeEventListeners();delete this._listeners;this._super(I,H);}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapViewer","mstrmojo.gmaps.MapToolbar","mstrmojo.gmaps._CustomMapInteractivity");var D=mstrmojo.gmaps,H=D.MapUtils,F=D.EnumPropertyType,I=D.EnumPolygonSource;mstrmojo.gmaps.CustomMapViewer=mstrmojo.declare(mstrmojo.gmaps.MapViewer,[mstrmojo.gmaps._CustomMapInteractivity],{scriptClass:"mstrmojo.gmaps.CustomMapViewer",graphicLayerDiv:null,cloudLayersMapping:null,cloudLayerInit:false,supportDensity:true,init:function M(U){this._super(U);this.cloudLayersMapping={};this.initGraphicLayerContainer();},initGraphicLayerContainer:function G(){var U=this.parent,V=this.graphicLayerDiv=this.graphicLayerDiv||document.createElement("div");if(!U){return ;}H.setNodeAttributes(V,{id:U.id+"-graphicLayerDiv"});H.setCssStyles(V,{position:"absolute",top:"0px",left:"0px"});H.setCssStyles(V,{width:U.getWidth()+"px",height:U.getHeight()+"px"});this.addGraphicLayerContainer();},addGraphicLayerContainer:function T(){var V=this.parent,U=V&&V.mapDiv,W=this.graphicLayerDiv;if(!U.contains(W)){H.appendNode(U,W);}},initAllLayers:function K(){if(!this.baseLayer){this._super();this.initGraphicLayers();}else{this._super();}},initGraphicLayer:function J(U){var V=this._super(U);if(V&&U.polygonSource===I.Cloud){this.cloudLayersMapping[U.key]=V;}},initMapToolbar:function C(){if(!this.parent){return ;}var X=this.parent,W=this.toolbar=new mstrmojo.gmaps.MapToolbar({map:X,parent:this}),U=X.toolBarDiv,V=X.mapDiv;if(!!W&&!!U&&!!V){W.render();V.style.height=parseInt(this.height)-U.offsetHeight+"px";}},refreshCloudLayers:function A(){var U=this.cloudLayersMapping,W,V;if(!U){return ;}for(V in U){if(U.hasOwnProperty(V)){W=U[V];if(W){W.refresh();}}}},refreshMapBoxPolygonLayers:function E(){this.forEachGraphicLayer(function(U){if(U&&U.scriptClass==="mstrmojo.gmaps.layer.MapBoxPolygonLayer"){U.refresh();}});},loadExistingBaseLayer:function B(U){this._super(U);this.cloudLayerInit=true;},switchBaseMap:function O(V){var W=this.parent,U=W&&W.baseLayerDiv;if(!U||W&&W.excludeData){return ;}W.clearMapError();this.hasInit=false;this.cloudLayerInit=false;U.innerHTML="";this.initBaseLayer(V);this.refreshMapBoxPolygonLayers();},restore:function N(){this._super();this.addGraphicLayerContainer();},resizeGraphicLayers:function P(V,U){var W=this.graphicLayerDiv;if(W&&H.checkVal(V)&&H.checkVal(U)){H.setCssStyles(W,{height:U+"px",width:V+"px"});}this.forEachGraphicLayer(function(X){X.resize(V,U);},null,true);},updateCoordForAllGraphicLayers:function S(){H.showWait();this.applyViewPort2Graphics(null);var U=mstrmojo.PerformanceLogOutput.startTimer({functionName:"MapViewer.handleGraphicsTransform: ",purpose:"graphic transform"});this.parent.needUpdateGraphicLayersCnt=this.getVisibleGraphicLayerCount();this.forEachGraphicLayer(function(V){V.updateGraphics();});mstrmojo.PerformanceLogOutput.endTimer(U);H.hideWait();},applyViewPort2Graphics:function(V){var U=this.baseLayer&&this.baseLayer.getViewport()||V;var W=this.graphicLayerDiv;if(W){W.style.clip=U;W.style.width="100%";}},getBaseMapType:function Q(){var U=this.getWidgetProps();return U&&U[F.baseMapType];},destroy:function R(V,U){this.removeEventListeners();this._super(V,U);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.func","mstrmojo.array","mstrmojo.css","mstrmojo.VisBase","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl","mstrmojo._VizSelectionHelper","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights","mstrmojo.gmaps._SupportMapBrushesAndHighlights","mstrmojo.gmaps._MapDataSelectionHelper","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapLayerZone","mstrmojo.gmaps.CustomMapViewer","mstrmojo.gmaps._MapProperty","mstrmojo.gmaps._CanExportPDF","mstrmojo.gmaps._HasContextMenu","mstrmojo.gmaps._LayerManipulation","mstrmojo.PerformanceLogOutput","mstrmojo.gmaps._MapLegendController","mstrmojo._colorPalette");var U=mstrmojo,Al=U.dom,m=U.func,AO=U.hash,BK=U.array,A8=U.css,c=U.gmaps,AG=c.MapUtils,BS=U.VisUtility,BQ=U.vi.viz,BW=BQ.EnumDSSDropZones,A7=mstrmojo.VisEnum,BO=A7.LegendPropertyTag,T=A7.MAPS_PROPERTIES,o=BQ.EnumVizStyles,v=c.EnumBaseMapType,BX=c.EnumGraphicType,AC=c.EnumMarkerType,AU=c.EnumClusterMode,AB=c.EnumPropertyType,y=mstrmojo.gmaps.EnumDynamicZoomStatus,F=new RegExp(".{32}","g"),B=AB.dirtyVp,BD=A7.EnumLegendMode,At=A7.EnumSingleLegendMode,AT=mstrmojo.gm.EnumLegendSlot,M=U.PerformanceLogOutput;var BU,Aw,A6=["mousedown","contextmenu","mouseover","mouseout"],Af=false;var BP={"com.microstrategy.web.vf.viewer.EsriMapApplicationViewer":o.ESRI_MAP,"com.microstrategy.web.vf.viewer.GoogleMapApplicationViewer":o.GOOGLE_MAP};function BL(Bg,Bh){return Bg!==undefined&&Bh!==undefined&&Bh!=="";}mstrmojo.VisMapBase=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo._colorPalette,mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.gmaps._SupportMapBrushesAndHighlights,mstrmojo.gmaps._MapDataSelectionHelper,mstrmojo.gmaps._MapProperty,mstrmojo.gmaps._HasContextMenu,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.gmaps._MapLegendController,mstrmojo.gmaps._LayerManipulation],{scriptClass:"mstrmojo.VisMapBase",formatHandlers:{domNode:["RW"]},markupString:'<div id="{@id}" class="claro mstrmojo-Map {@cssClass} {@iconClass}" sty="gmap" style="position:{@position};overflow:hidden;width:{@width}px;height:{@height}px; left:{@left}px; top:{@top}px; z-index: {@zIndex};" mstrAttach:contextmenu,mousedown,mouseover,mouseout><div id="{@id}-toolbar"></div><div id="{@id}-map" style="height:{@height}px"><div id="{@id}-baseLayerDiv" style="height:{@height}px;position:absolute;top:0px;left:0px"></div></div><div id="{@id}-clearAllWindow"></div><div id="{@id}-metricSelectDiv"></div><div id="{@id}-clearAllPopupDiv"></div><div id="{@id}-singleSelectPopupDiv"></div><div id="{@id}-legend"></div><div class="map-err-message" style="font-size:15px;height:100px;width:100%;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;text-align:center;z-index:100;display:none"></div></div>',markupSlots:{toolBarDiv:function(){return this.domNode.firstChild;},mapDiv:function(){return this.domNode.childNodes[1];},baseLayerDiv:function(){return this.domNode.childNodes[1].firstChild;},clearAllWindowDiv:function(){return this.domNode.childNodes[2];},metricSelectDiv:function(){return this.domNode.childNodes[3];},clearAllPopupDiv:function(){return this.domNode.childNodes[4];},singleSelectPopupDiv:function(){return this.domNode.childNodes[5];},legendPlaceholder:function(){return this.domNode.childNodes[6];},errorMsgDiv:function(){return this.domNode.childNodes[7];}},isVisMap:true,viewerCls:c.CustomMapViewer,mapViewer:null,mapDiv:null,tempMapDiv:null,reuseDOM:false,position:"absolute",gridParams:null,mapStylesCache:null,editorContentReady:false,propEditorListener:null,previousMapStyleId:null,isClientExport:null,mapEventListeners:null,refitContent:false,layerIdxMappingArr:[],widgetIdMapping:null,layerCount:0,isRefresh:null,isKeepOnlyExclude:false,needUpdateLayers:[],vpNameMappings:{ga:"ga",lat:"lat",lng:"lng"},oldVpNameMappings:{ga:"ma",lat:"flat",lng:"flong"},canOnlyDragOnTitleBar:true,visPropsUpdated:false,affinityLineTempKeys:{},previousWidth:null,previousHeight:null,layerZoneCacheInfo:null,registeredSDPKeys:null,errorMsg:null,defaultMarkerType:AC.Pin,init:function BZ(Bg){this._super(Bg);if(Al.isIE){this.tempMapDiv=document.createElement("div");}this.mapEventListeners=[];this.registeredSDPKeys={};if(Al.isIE9){this.isClientExport=false;}if(!AG.isOIVM()){this.position="relative";}this.loadMapCss();this.dynZoomStatus=y.INIT;},setMapDimension:function S(){var Bg=(this.getFormats&&this.getFormats())||(this.defn&&this.defn.fmts);if(AG.isExpress()&&Bg){if(Bg.width!==undefined){this.width=parseInt(Bg.width,10);}if(Bg.height!==undefined){this.height=parseInt(Bg.height,10);}}},isMapbox:function An(){return this.scriptClass==="mstrmojo.mapbox.VisMapbox";},buildRendering:function Au(){if(AG.isVI()){this.zIndex=1;}this._super();},postBuildRendering:function AX(){M.endTimer("timerid_DataModel");M.visPrint("postBuildRendering start");M.startTimer({functionName:"VisMapBase.postBuildRendering: ",purpose:"from Build to End"},"timerid_fromBuildtoEnd");if(this.waitingForData){return ;}if(BS.isOnExpressMode()&&this.isEmpty()){BS.renderWidgetErrorRSD(this,this.error,A6);return ;}this._super();var Bh=this,Bg,Bi;if(this.isLoadingExtraConfig){return ;}this.setMapDimension();if(!BU){if(AG.isOIVM()){Bg={taskId:"getMultiMapConfig",key:this.node.k,taskEnv:"xhr",taskContentType:"json"};Bi={success:function(Bj){delete Bh.isLoadingExtraConfig;if(Bj){Bh.processData(Bj);Bh.buildMap();if(mstrmojo.vi.VisualInsightApp&&AG.checkHasFunction(mstrApp,"isAppStateSelection")&&mstrApp.isAppStateSelection()){Bh.getDocModel().raiseEvent({name:"buildBoxLayoutComplete"});}}},failure:function(Bj){var Bk=Bj&&Bj.getResponseHeader&&Bj.getResponseHeader("X-MSTR-TaskFailureMsg");delete Bh.isLoadingExtraConfig;AG.hideWait(true);if(Bk){Bh.displayError("Error loading Configuration: "+Bj.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{Bh.displayError("Error loading Configuration.");}}};this.isLoadingExtraConfig=true;mstrApp.serverRequest(Bg,Bi);}else{Bh.processData(this.gridParams);Bh.buildMap();}}else{if(this.isRefresh!==true||this.requiresBuildByVF){if(!mstrApp.requireRestoreVFConfigMode){this.buildMap();this.requiresBuildByVF=false;}else{this.requiresBuildByVF=true;}}else{this.updateMap();}}this.isRefresh=null;},buildMap:function BA(){M.endTimer("timerid_callback_buildMap");M.visPrint("buildMap start");var Bh=this,Bg=this.getDocModel(),Bi=M.startTimer({functionName:"VisMapBase.buildMap",purpose:"build Map and Graphics"});try{this.initBaseMapProps();this.initMapViewer();this.registerSdpInDocModel(AO.keyarray(this.affinityLineTempKeys));if(Bg){this.sliceEvtListener=Bg.attachEventListener("secondaryDataSliced",this.id,function(Bk){Bh.onSecondaryDataSliced(Bk.key,Bk.data);});this.docSaveListener=Bg.attachEventListener("updWgtsProps",this.id,function(){Bh.saveZoomLevelandPosition();});}this.previousWidth=this.width;this.previousHeight=this.height;}catch(Bj){console.log("build map error");console.log(Bj.stack);AG.hideWait(true);}M.endTimer(Bi);M.visPrint("buildMap end");M.startTimer({functionName:"VisMapBase.postBuildRendering: ",purpose:"time gap between buildMap completion and map load"},"timerid_callback_LoadMainModule");M.startTimer({functionName:"VisMapBase.postBuildRendering: ",purpose:"time gap between buildMap completion and map load"},"timerid_callback_CustomLayerinitShapeInfo");},onSecondaryDataSliced:function AH(Bj,Bl){var Bh=this.model.data,Bg=Bh&&Bh.sdp,Bi=this.mapViewer,Bk=this.affinityLineTempKeys;if(Bg&&Bg[Bj]){Bg[Bj]=Bl;}if(Bk[Bj]){Bk[Bj]=Bl;}if(Bi){Bi.onSecondaryDataSliced(Bj);}},initMapViewer:function t(){var Bg=this.mapViewer&&this.mapViewer.baseLayer,Bm={};if(Bg&&Bg.isActive()){Bg.parent=null;Bm={baseLayer:Bg,hasInit:true};}else{Bg=null;}this.destroyComponents(!!Bg);var Bl=this.loadGridData(),Bk=BU.common,Bj,Bi,Bh;if(!Bl){return ;}if(Bk){if(!!Bk.beanPath){Bi=Bk.beanPath;}else{if(!!Bk.boneId&&typeof (microstrategy)!==undefined){Bh=microstrategy.bone(Bk.boneId);Bi=Bh&&Bh.getDocViewer().beanPath;}}}Bj=this.mapViewer=new (this.viewerCls)(AO.copy(Bm,{parent:this,gridsMapping:Bl,beanPath:Bi,k:(this.node&&this.node.k)||this.model.data.k}));this.needUpdateLayers=Object.keys(Bl);Bj.initAllLayers();},needMapReadyEvent:function d(){return !!mstrApp.isExporting;},checkForMapReady:function Av(){var Bi=this.mapViewer,Bg=Bi.baseLayer,Bk=this;if(!this.graphicsReady){var Bj=Bi.getMapGeoExtent();if(!Bj){var Bh=true;if(Bg.baseMapType===v.Esri){Bi.forEachGraphicLayer(function(Bl){if(Bl&&Bl.scriptClass==="mstrmojo.gmaps.layer.CloudLayer"){if(Bl.geoPosition>=0&&!Bl.shapeInfoArr){Bh=false;}}});}if(Bh){this.graphicsReady=true;}}}if(!this.needMapReadyEvent()||!this.graphicsReady){return ;}if(Bg.isBaseMapReady&&!this.firstRenderFinish&&Bi.hasInit){window.setTimeout(function(){Bk.raiseEvent({name:"mapReady",id:Bk.k});Bk.firstRenderFinish=true;Bg.isBaseMapReady=false;},0);}if(this.duringResize&&Bg.isBaseMapReady){window.setTimeout(function(){Bk.raiseEvent({name:"mapReadyAfterResize",id:Bk.k});Bk.duringResize=false;},0);}},updateMap:function w(){AG.showWait();var Bg=this.mapViewer;if(Bg){Bg.restore();this.updateMapViewer();if(this.hasResized()){this.resizeLegendByWidget();Bg.resize();this.displayError();}}AG.hideWait();},updateMapViewer:function Ad(){var Bn,Bj,Bl,Bk,Bi=this.mapViewer,Bh=Bi&&Bi.graphicLayerMapping,Bg={};if(!Bh){return ;}this.loadGridData();this.needUpdateGraphicLayersCnt=Bi.getVisibleGraphicLayerCount();this.needUpdateLayers=Bi.getVisibleGraphicLayers();var Bm=true;for(Bj in Bh){Bn=Bh[Bj];Bk=this.getGridData(Bj);if(Bk!==Bn.data){Bg[Bj]=Bk;}else{Bi.updateNeedUpdLayers(this,Bj);}}for(Bj in Bg){Bk=Bg[Bj];Bm=false;Bl=this.fnGetWidget(Bj);Bi.gridsMapping[Bj]={data:Bk};Bi.updateGraphicLayer(Bk,Bl&&Bl.useRefresh);if(Bl){delete Bl.useRefresh;}}if(!Bm){Bi.highlightAllLayers();}if(Bm){M.endTimer("timerid_fromBuildtoEnd");}Bi.applyViewPort2Graphics();},hasResized:function AR(){var Bg=AG.checkVal(this.previousWidth)&&AG.checkVal(this.previousHeight)&&(this.previousWidth!==this.width||this.previousHeight!==this.height);this.previousWidth=this.width;this.previousHeight=this.height;return Bg;},processData:function AY(Bg){BU=Bg;if(Bg.err&&!Aw){mstrmojo.alert(Bg.err);Aw=true;}},loadGridData:function C(){var Bh=this.getData();if(!Bh){return ;}var Bk={},Bi=this,Bg=Bh.k,Bj;if(this.isGraphicLayerGrid(Bh)===true){Bk[Bg]={data:Bh};}this.forEachSecondaryProvider(function(Bm,Bl){if(!Bm){return ;}Bk[Bl]={data:Bm};Bj=Bi.fnGetWidget(Bl,Bm);Bi.syncPropsForSdpXtab(Bj);});return Bk;},update:function g(Bi){var Bh=this._super(Bi),Bg=this;if(Bh!==false){this.preparePropsForDocument();this.forEachSecondaryProvider(function(Bl,Bj){var Bk=Bg.fnGetWidget(Bj,Bl);if(Bk){Bk.node.data=Bl;}});this.oldDataAdaptor();if(!this.visPropsUpdated){this.visPropsUpdated=true;this.initLayerIdxMappingArr();}}return Bh;},hasError:function(){var Bh=this.model.data,Bi=(Bh&&Bh.sdp)||{},Bn=[],Bk,Bg,Bl,Bo,Bm=this,Bp=this.layerIdxMappingArr,Bj=Bp.length;this.clearError();if(!Bh){return false;}Bn.push(Bh);for(Bo in Bi){Bn.push(Bi[Bo]);}BK.forEach(Bn,function(Bq){BK.forEach(Bp,function(Br){if(Bq&&Bq.k===Br){Bg=Bq&&Bq.egt;Bk=Bq&&Bq.eg;Bl=Bq&&Bq.vp&&Bq.vp.ln;if(BL(Bg,Bk)){Bm.error.push(Bl?(Bl+": "+Bk):Bk);Bm.errorType.push(Bg);}return false;}});});return(Bm.errorType.indexOf(2)>-1)?true:(Bm.errorType.length===Bj);},clearError:function(){this.error=[];this.errorType=[];},isEmpty:function(){return !this.excludeData&&this.hasError();},isBaseMapValid:function K(){return AO.walk("mapViewer.baseLayer.isSupport",this);},getVisEmptyMsgControls:function(){if(this.excludeData){return BS.getVisEmptyMsgControls.call(this);}if(!this.hasError()){return ;}var Bg="";BK.forEach(this.error,function(Bh){Bg+='<div style="padding-bottom:8px">'+Bh+"</div>";});return[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content" style="visibility: visible">'+Bg+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;}}}];},preparePropsForDocument:function AK(){var Bn,Bp={},Bm=this.k,Bk=this.getData(),Bg=Bk&&Bk.vp,Bi=(Bg&&Bg.sgProps)||{},Bo=this.getDocModel(),Bj=Bk&&Bk.sdp,Bl=AB.affinityLineGrid,Bh=function(Bq){if(Bq&&(Bq[AB.showAffinityLines]==="1")&&Bq[Bl]){Bp[Bq[Bl]]=true;}};if(Bo){if(!Bj){Bj=Bo.getMapLayersDataByHostKey(Bm);Bk.sdp=Bj;}else{BK.forEach(AO.keyarray(Bj),function(Bq){Bo.updatePrimaryScdpMap(Bm,Bq,true);});}}Bj=Bj||{};Bh(Bg);for(Bn in Bj){if(Bi[Bn]){Bg=Bi[Bn];if(Bj[Bn]){Bj[Bn].vp=Bg;}}else{Bg=Bj[Bn]&&Bj[Bn].vp;}Bh(Bg);}for(Bn in Bp){Bp[Bn]=Bj[Bn]||{};}this.affinityLineTempKeys=Bp;},forEachSecondaryProvider:function i(Bk){var Bi,Bh=this.model.data,Bg=(Bh&&Bh.sdp)||{},Bj=this.affinityLineTempKeys;for(Bi in Bg){if(!Bj[Bi]){Bk(Bg[Bi],Bi);}}},getAffinityLineTemplate:function Am(Bg){return this.affinityLineTempKeys[Bg];},updatePropEditor:function J(){var Bg=this.propEditorListener;if(!!Bg&&Bg.listener&&Bg.callback){Bg.callback.call(Bg.listener,Bg.args);}this.propEditorListener=null;},hasColorByOrSizeBy:function AF(Bg){var Bi=this.getDropZoneItems(BW.ColorBy,Bg),Bh=this.getDropZoneItems(BW.SizeBy,Bg);return Bi&&Bi.length||(Bh&&Bh.length);},hasSizeBy:function As(Bg){var Bh=this.getDropZoneItems(BW.SizeBy,Bg);return Bh&&Bh.length;},upgradeWidgetProperties:function E(Bg){if(!Bg){return ;}Bg.separateColorSize="1";},getWidgetForTemplateSelection:function AM(Bh){var Bg=Bh||this.getKeyForTemplateSelection();return this.fnGetWidget(Bg);},getDefnAnForTemplateSelection:function Be(){var Bi=this.getWidgetForTemplateSelection(),Bh=Bi&&Bi.node,Bg=Bh&&Bh.defn.an;return Bg;},getAllLayerKeys:function N(Bj){var Bh=this.mapViewer,Bg=Bh&&Bh.graphicLayerMapping,Bi=(Bg&&Object.keys(Bg))||[];if(Bj&&Bi.indexOf(this.k)<0){Bi=Bi.concat(this.k);}return BK.ensureArray(Bi);},getKeyForTemplateSelection:function Ah(Bh){var Bg=this.layerIdxMappingArr,Bm=this,Bl,Bk,Bj,Bi;BK.forEach(Bg,function(Bn){Bl=Bm.fnGetWidget(Bn);Bk=Bl&&Bl.node;if(!!Bk){Bj=Bk.defn&&Bk.defn.an;if(Bj&&Bj.length>0){Bi=Bn;}}});if(!Bi&&!Bh){Bi=this.getGridKeyByIdx(0);}return Bi;},getEditingLayerIdx:function A5(){var Bh=this.getProperties(),Bg=Bh&&Bh[AB.editingLayerIdx];return(isNaN(Bg))?0:Bg;},updateEditingLayerIdx:function AZ(Bg){this.updateProperties(AB.editingLayerIdx,Bg);},getEditingGridKey:function z(){var Bg=this.getEditingLayerIdx();if(isNaN(Bg)){Bg=0;}if(this.layerIdxMappingArr){return this.layerIdxMappingArr[Bg];}},getEditingHost:function BR(){var Bg=this.getEditingGridKey();return this.fnGetWidget(Bg);},getEditingGridData:function Aj(){var Bg=this.getEditingGridKey();return this.getGridData(Bg);},getEditingGridProps:function AN(){var Bg=this.getEditingGridData();return Bg&&Bg.vp;},getEditingDz:function j(){var Bg=this.getEditingGridData();return Bg&&Bg.dz;},getEditingDropZoneItems:function BH(Bg){var Bh=this.getEditingGridKey();return this.getDropZoneItems(Bg,Bh);},isEditingDropZoneColorByAttr:function Y(){var Bg=this.getEditingGridKey();return this.isColorByAttribute(Bg);},fnGetWidget:function r(Bh,Bj){var Bg,Bi,Bk;if(!AG.checkDefined(Bh)||Bh===this.k){return this;}else{if(this.affinityLineTempKeys[Bh]){return undefined;}else{Bg=this.getDocModel();if(Bg){Bk=this.getWidgetId(Bh);if(Bk){Bi=mstrmojo.all[Bk];}if(this.builder&&!Bi&&Bj&&(!AG.isVI()||Bg.getLayoutUnitDefn(Bh))){Bi=this.createSdpXtab(Bh,Bg,Bj,this.getVisName(Bj));}if(Bi&&Bi.model&&Bi.model.data&&!(Bi.model.data.visName)){Bi.model.data.visName=this.getVisName(Bi.model.data);}if(Bi&&Bi.node&&Bi.node.data&&Bi.node.data.gsi&&!(Bi.gridInfo)){Bi.gridInfo=Bi.node.data.gsi;}return Bi;}}}},getWidgetId:function Bb(Bg){if(this.widgetIdMapping){return this.widgetIdMapping[Bg];}},getTopLayerHost:function Ba(){var Bg=this.layerIdxMappingArr&&this.layerIdxMappingArr[0];return this.fnGetWidget(Bg);},registerSdpInDocModel:function BG(Bj){var Bl,Bh,Bk,Bi,Bg=this.getDocModel();if(Bg){Bl=this.getData();Bi=this.registeredSDPKeys;Bh=Bl.k;Bk=Bl.visName;BK.forEach(Bj,function(Bm){Bg.addSDP(Bm,{k:Bh,visName:Bk});Bi[Bm]=true;});}},unRegisterSdpInDocModel:function Az(Bi){var Bh,Bg=this.getDocModel();if(Bg){Bh=this.registeredSDPKeys;BK.forEach(Bi,function(Bj){if(Bh[Bj]){Bg.removeSDP(Bj);delete Bh[Bj];}});}},createSdpXtab:function l(Bk,Bo,Bi,Bn){var Bj=this,Bl=Bj.builder,Bg=this.widgetIdMapping=this.widgetIdMapping||{};if(!Bo||!Bi||!Bn||!Bl){return ;}Bn=(Bn===o.ESRI_MAP)?o.GOOGLE_MAP:Bn;Bi.wid=1;var Bh=Bl.newXtab(Bo,{data:Bi,defn:Bo.getLayoutUnitDefn(Bk)||{},id:Bo.getWidgetId(Bi)}),Bm=Bl.getModelClassByVisName(Bn);Bh.isSdp=true;Bg[Bk]=Bh.id;this.registerSdpInDocModel([Bk]);if(Bm){Bh.setModel(new Bm({xtab:Bh,controller:Bj.controller,docModel:Bo,data:Bi}));Bh.k=Bk;this.addMethods2SdpXtab(Bh);return Bh;}},updateXtabProps:function s(Bl){var Bi,Bk=Bl.k,Bm=this.getData(),Bh=Bm&&Bm.vp,Bj=(Bh&&Bh.sgProps)||{},Bg=Math.max(0,this.layerIdxMappingArr.indexOf(Bk));Bi=Bj[Bk]?Bj[Bk]:Bl.vp;Bl.vp=this.vpAdapter(Bi,Bg);},addMethods2SdpXtab:function BF(Bj){var Bk,Bg,Bh=this,Bi=function(Bl,Bm){Bj[Bl]=Bm;Bj.methodArr.push(Bl);};if(Bh&&Bj&&!(Bj instanceof mstrmojo.VisMapBase)){Bk=Bj.update;Bg=function(Bm){var Bl=true;if(this._super){Bl=this._super(Bm);}if(Bm&&Bm.data){Bh.updateXtabProps(Bm.data);}return Bl;};Bj.methodArr=[];Bi("update",function(){var Bm=this._super;this._super=Bk;var Bl=Bg.apply(this,arguments||[]);this._super=Bm;return Bl;});Bi("getData",function(){return this.node&&this.node.data;});Bi("refresh",function(){var Bo=Bh&&Bh.mapViewer,Bq=Bo.parent,Bp=Bo&&(Bo.getGraphicLayer instanceof Function)&&Bo.getGraphicLayer(this.k),Bl=this.useRefresh,Bn=this.getData();if(!Bo||!Bp||!Bn){return ;}if(Bn!==Bp.data){var Br=Bn.eg,Bm=Bn.egt;Bh.model.data.sdp[this.k]=Bn;if(!BL(Bm,Br)){if(Bq.needUpdateLayers.length===0){if(Bq.isKeepOnlyExclude){Bq.needUpdateLayers=Bo.getVisibleGraphicLayers();}else{Bq.needUpdateLayers.push(Bp.key);}}Bo.updateGraphicLayer(Bn,Bl);}Bh.raiseEvent({name:"toggleCtrlOverlay",visible:Bh.isEmpty()||Bh.excludeData,controls:Bh.getVisEmptyMsgControls()});Bh.applyBackground();}delete this.useRefresh;});Bi("fnGetWidget",function(){return Bh;});}},applyBackground:function AE(){var Bj=this.parent,Bh=Bj&&Bj.ctrlOverlay,Bk=Bh&&Bh.domNode,Bl=Bj&&Bj.domNode,Bg=Bl&&Bl.style,Bi;if(Bk&&Bg){Bi=Bg.backgroundColor;Bk.style.backgroundColor=Bi;Bk.style.visibility="visible";}this._super();},getSdpKeyArr:function p(){var Bj=this.layerIdxMappingArr,Bi=this.k,Bh,Bg;if(!Bj||!(Bj instanceof Array)||!AG.checkDefined(Bi)){return[];}Bh=Bj.slice();Bg=Bh.indexOf(Bi);if(Bg!==-1){Bh.splice(Bg,1);}return Bh;},getGridData:function R(Bg){var Bi=this.getData(),Bh;if(!AG.checkDefined(Bg)||(Bi.k&&Bi.k===Bg)){return Bi;}Bh=this.fnGetWidget(Bg);return AG.checkHasFunction(Bh,"getData")?Bh.getData():(Bi&&Bi.sdp&&Bi.sdp[Bg]);},getGridKey:function f(Bg){Bg=Bg||this;var Bh=Bg&&Bg.getData();return !!Bh&&Bh.k;},getGridKeyByIdx:function BI(Bg){Bg=parseInt(Bg);if(!isNaN(Bg)){return this.layerIdxMappingArr&&this.layerIdxMappingArr[Bg];}},getBottomGridKey:function Ap(){var Bh=this.layerIdxMappingArr,Bg=(Bh&&Bh.length)||0;return Bg>0?Bh[Bg-1]:"";},getDz:function Bc(Bg){var Bh=this.getGridData(Bg);return Bh&&Bh.dz;},getProperties:function AL(Bg){var Bh=this.getGridData(Bg);return Bh&&Bh.vp;},isColorByAttribute:function Aa(Bh){var Bg=this.getDz(Bh);if(Bg&&Bg.ColorBy&&Bg.ColorBy.TemplateUnit){return true;}return false;},showInfoIcon4GeoItem:function I(){var Bi=this.getEditingGridKey(),Bh=this.mapViewer,Bg=Bh&&Bh.getGraphicLayer(Bi);if(Bg&&typeof Bg.showInfoIcon4GeoItem==="function"){Bg.showInfoIcon4GeoItem();}},getTtpContent4GeoItem:function Ac(Bg){var Bj=this.getEditingGridKey(),Bi=this.mapViewer,Bh=Bi&&Bi.getGraphicLayer(Bj);if(Bh&&typeof Bh.getTtpContent4GeoItem==="function"){return Bh.getTtpContent4GeoItem(Bg);}},getDropZoneItems:function BN(Bk,Bl){var Bn=this.getGridData(Bl),Bv=this.getDz(Bl),Bi=this.getProperties(Bl),Bh=[],Bs=this,Bj,Bq,Bg,Bp,Bm,Bu,Br,Bo,Bt,Bw;if(!Bn){return ;}switch(Bk){case BW.GeoAttribute:if(Bv&&Bv.Geo){Bh=Bv.Geo.TemplateUnit||[];}else{Bj=(!!Bi&&Bi[AB.graphicType]===BX.Area&&Bi[AB.attributeId])?Bi[AB.attributeId]:(!!Bi&&Bi[AB.geoAttribute]);Bh=Aq.call(this,Bj,Bn);}for(Bm=0;Bm<Bh.length;Bm++){Bh[Bm].zone=BW.GeoAttribute;}break;case BW.Latitude:if(Bv&&Bv.Lat){Bh=Bv.Lat.TemplateUnit||[];}else{Bu=!!Bi&&Bi[AB.latitude];Br=Aq.call(this,Bu,Bn);if(Bu){Bh=Br.length?Br:[{id:Bu,t:21}];}}break;case BW.Longitude:if(Bv&&Bv.Long){Bh=Bv.Long.TemplateUnit||[];}else{Bo=!!Bi&&Bi[AB.longitute];Bt=Aq.call(this,Bo,Bn);if(Bo){Bh=Bt.length?Bt:[{id:Bo,t:21}];}}break;case BW.Angle:if(Bv&&Bv.AngleBy){Bh=Bv.AngleBy.TemplateMetric||[];}else{Bh=Aq.call(this,!!Bi&&Bi.amt,Bn);}break;case BW.ColorBy:if(Bv&&Bv.ColorBy){Bw=Bv.ColorBy;if(Bw.TemplateMetric){Bh=Bw.TemplateMetric||[];}else{if(Bw.TemplateUnit){Bh=Bw.TemplateUnit||[];}}}else{Bh=Aq.call(this,!!Bi&&Bi.cmt,Bn);}break;case BW.SizeBy:if(Bv&&Bv.SizeBy){Bh=Bv.SizeBy.TemplateMetric||[];}else{Bh=Aq.call(this,!!Bi&&Bi.smt,Bn);}break;case BW.SliceBy:if(Bv&&Bv.SliceBy){Bh=Bv.SliceBy.TemplateUnit||[];}else{Bg=!!Bi&&Bi[AB.slice];Bg=Bg?Bg.match(F):[];BK.forEach(Bg,function(Bx){Bp=Aq.call(Bs,Bx,Bn);if(Bp.length){Bh=Bh.concat(Bp);}});}break;case BW.AdditionalMetrics:Bq=Bv&&Bv.AdditionalMetrics;if(Bq){Bh=(Bq.TemplateMetric||[]).concat(Bq.TemplateUnit||[]).sort(function(By,Bx){return By.idx-Bx.idx;});}else{Bg=!!Bi&&Bi.tooltip;Bg=Bg?Bg.match(F):[];BK.forEach(Bg,function(Bx){Bp=Aq.call(Bs,Bx,Bn);if(Bp.length){Bh=Bh.concat(Bp);}});}break;default:break;}BK.forEach(Bh,function(Bx){if(!Bx.did){Bx.did=Bx.id;}});return Bh;},getDropZones:function k(Bl){var Bj={};var Bo=this.getDropZoneItems(BW.GeoAttribute,Bl);Bj.geoAttribute=n(Bo);var Bi=this.getDropZoneItems(BW.Latitude,Bl);Bj.latitude=n(Bi);var Bm=this.getDropZoneItems(BW.Longitude,Bl);Bj.longitude=n(Bm);var Bk=this.getDropZoneItems(BW.SliceBy,Bl);Bj.sliceBy=BK.map(Bk,function(Br){return Br&&Br.id;});var Bg=this.getDropZoneItems(BW.Angle,Bl);Bj.angle=n(Bg);var Bn=this.isColorByAttribute(Bl);var Bp=this.getDropZoneItems(BW.ColorBy,Bl);if(Bn===true){Bj.colorBy=BK.map(Bp,function(Br){return Br&&Br.id;});Bj.isColorByAttr=true;}else{Bj.colorBy=n(Bp);Bj.isColorByAttr=false;}var Bh=this.getDropZoneItems(BW.SizeBy,Bl);Bj.sizeBy=n(Bh);var Bq=this.getDropZoneItems(BW.AdditionalMetrics,Bl);Bj.tooltips=AD(Bq);return Bj;},getColorByDzRawData:function P(Bh){var Bg=this.getDz(Bh);return Bg&&Bg.ColorBy&&Bg.ColorBy.TemplateUnit;},getBaseMapType:function Ak(){var Bg=this.getProperties();return Bg&&Bg[AB.baseMapType];},replaceSpace:function AW(Bi,Bh){var Bg=Bh;if(Bg===undefined){Bg="_";}return Bi.replace(/ /g,Bg);},getVisName:function a(Bg){var Bi=Bg.vis,Bh=Bg.visName||(Bi&&Bi.vn);if(!Bh&&Bi&&Bi.we&&Bi.wcn){Bh=BP[Bi.wcn];}return Bh||o.ESRI_MAP;},getLayerZoneControl:function Ao(Bg){return new c.MapLayerZone({items:this.getGraphicLayerNameArr(),selectedItemIdx:this.getEditingLayerIdx(),source:Bg,vis:this});},wrapUpdatesInfo:function A9(Bh,Bg){Bg=Bg||{};if(!!Bh){Bg.actions=(Bg.actions)?Bg.actions.concat(Bh.actions):Bh.actions;Bg.urInfo=this.wrapUndoRedoInfo(Bh.urInfo,Bg.urInfo);Bg.treesToRender=Bh.treesToRender;Bg.requestCallback=m.wrapMethods(Bh.requestCallback,Bg.requestCallback);}return Bg;},wrapUndoRedoInfo:function Ab(Bh,Bg){Bg=Bg||{};if(!!Bh){var Bi=Bg.callback;delete Bg.callback;Bg=m.wrapMethods(Bh,Bg);Bg.callback=m.wrapMethods(Bh.callback,Bi);}return Bg;},submitMapUpdates:function A3(Bi,Bl){if(!Bi){return ;}var Bh=this.getDocModel(),Bn=Bi.actions||[],Bm=Bh&&Bh.getDataService(),Bj=Bi.urInfo,Bg={style:{params:{treesToRender:(AG.checkDefined(Bi.treesToRender))?Bi.treesToRender:2}}},Bk;Bn=Bn.concat(this.getUpdateLayersFormatActions());if(!Bm||!Bh||!Bh.controller||Bn.length===0){return ;}if(Bl){Bg.style=mstrmojo.DocDataService.SUPPRESS_DATA;}Bk=Bh.controller.cmdMgr;if(Bk){Bk.execute({execute:function(){var Bo=Bm.newUpdate();Bo.add(Bn,Bi.requestCallback,Bg);if(Bl){this.submitSilent(Bo.actions);}else{this.submitUpdate(Bo);}},urInfo:Bj});}},getUpdateLayersFormatActions:function q(){var Bg,Bj=[],Bi=this,Bk=this.k,Bh=[];AO.copy(this.layerIdxMappingArr,Bh);if(Bh.indexOf(Bk)<0){Bh.unshift(Bk);}if(AG.isExpress()){Bg=Bi.getProperties(Bk);delete Bg.sgProps;delete Bg[B];if(Bh.length>1){Bg.sgProps=this.updateSgPropsUsingLayerProps(Bh,Bk);}delete Bi.modelData;Bj=Bi.getSetPropertiesAction();}else{BK.forEach(Bh,function(Bl){Bg=Bi.getProperties(Bl);if(Bg[B]){delete Bg[B];if(Bl===Bk){delete Bi.modelData;}else{Bi.modelData=Bi.getGridData(Bl);}Bj=Bj.concat(Bi.getSetPropertiesAction());}});delete Bi.modelData;}return Bj;},syncPropsForSdpXtab:function W(Bh){var Bg=this.defn;if(!Bh||!Bg){console.log("syncPropsForSdpXtab: invalid xtab/defn");return ;}Bh.defn={t:Bg.t,tt:Bg.tt};Bh.parent=this.parent;},resetEditingLayerIdx:function BM(Bi){var Bg=parseInt(this.getEditingLayerIdx()),Bh=this.layerIdxMappingArr,Bj;if(!Bh||isNaN(Bg)||!BK.isArray(Bh)||Bh.length<1){return ;}if(Bg>Bi){Bj=Bg-1;}else{if(Bg===Bi&&(Bh[Bi]===undefined)){Bj=Bh.length-1;}}if(!isNaN(Bj)&&Bj!==Bg){this.updateEditingLayerIdx(Bj);}},syncLayerProperties:function AS(Bh,Bg){var Bi=[AB.graphicType,AB.markerType,AB.layerIdx,AB.layerName];if(!Bh||!Bg){return ;}Bi.forEach(function(Bj){if(Bh[Bj]!==undefined&&Bg[Bj]!==Bh[Bj]){Bg[Bj]=Bh[Bj];Bg[B]=true;}});},isCurrentVizBoxSelected:function AI(){var Bh=this.getDocModel(),Bi,Bg;if(Bh&&typeof Bh.getSelectedViUnit==="function"){Bi=Bh.getSelectedViUnit();Bg=Bi&&Bi.boxContent;return Bg===this;}},refreshDzPropPanels:function h(){var Bg=this.parent;if(Bg&&(typeof Bg.selectVIUnit==="function")&&this.isCurrentVizBoxSelected()){Bg.selectVIUnit(true);}},isPrimaryKey:function b(Bg){return Bg===this.k;},displayError:function X(Bh){var Bg=this.mapViewer,Bi=this.errorMsg||Bh;if(this.errorMsgDiv&&Bi){if(Bg){Bg.hideAllGraphicLayers();}this.errorMsgDiv.innerHTML=this.errorMsg=Bi;this.errorMsgDiv.style.display="block";}},clearMapError:function u(){if(this.errorMsgDiv){this.errorMsgDiv.innerHTML="";this.errorMsg=null;this.errorMsgDiv.style.display="none";}},reset:function Ay(){this.submitMapUpdates(this.getResetMapUpdatesInfo(),false);},preRefresh:function A2(){var Bg=this.mapViewer;if(Bg){this.reuseDOM=Al.isAndroid&&!!Bg.preRefresh();}},postViewerInit:mstrmojo.emptyFn,redraw:function x(){if(this.reuseDOM){return true;}return this._super();},stageMapNodes:function(){var Bi=this.tempMapDiv,Bh=this.mapViewer,Bg=Bh&&Bh.getToastNode();if(Al.isIE&&Bi){BK.forEach([this.toolBarDiv,this.mapDiv,this.legendPlaceholder,Bg],function(Bj){if(Bj){Bi.appendChild(Bj);}});}},refresh:function(){if(this.hasRendered){this.isRefresh=true;this.stageMapNodes();}this.preRefresh();this._super();if(this.reuseDOM){this.updateMap();this.reuseDOM=false;}},reRender:function V(){if(this.hasRendered){this.isRefresh=true;this.stageMapNodes();}this._super();},createDefaultVp:function BV(Bg){var Bh=Bg||{};Bh[AB.graphicType]=BX.Marker;Bh[AB.markerType]=AC.Pin;Bh[AB.layerIdx]=this.generateNewLayerIdx();Bh[AB.layerName]=this.generateNewLayerName();Bh[AB.isHidden]="0";Bh[BO.LEGEND_MODE]=BD.RESTORED;Bh[BO.LEGEND_POSITION]=AT.RIGHT_MIDDLE;Bh[T.SHOW_LEGEND]=false;Bh[AB.collapseLegend]=At.RESTORE;Bh[AB.legendSwitch]=false;Bh[AB.clusterRadius]=50;Bh[AB.clusterMaxZoom]=22;return Bh;},generateNewLayerIdx:function A1(){var Bg=this.layerIdxMappingArr;return(Bg&&BK.isArray(Bg))?Bg.length:0;},generateNewLayerName:function AJ(){return mstrmojo.desc(14750,"Layer")+" "+(this.layerCount+1);},updateSgPropsUsingLayerProps:function Ai(Bj,Bk){var Bh,Bi=this,Bg={};BK.forEach(Bj,function(Bl){if(Bl!==Bk){Bh=Bi.getProperties(Bl);if(AO.isEmpty(Bh)){return ;}delete Bh[B];Bg[Bl]=Bh;}});return Bg;},createLayersPropsXml:function Bd(Bi){var Bk,Bj,Bg,Bh="<sgProps>";for(Bj in Bi){Bk=Bi[Bj];if(AO.isEmpty(Bk)){return ;}delete Bk[B];Bh+='<g k="'+Bj+'">';for(Bg in Bk){Bh+="<"+Bg+' value="'+Bk[Bg]+'" />';}Bh+="</g>";}Bh+="</sgProps>";return Bh;},createWidgetPropsXML:function Ar(){var Bh,Bg,Bi,Bj;if(AG.isExpress()){Bi="<widgetProps><fmt>";Bg=this.getProperties(this.k);for(Bh in Bg){if(Bh==="sgProps"&&Bg[Bh]){Bj=this.createLayersPropsXml(Bg[Bh]);}else{Bj=Bg[Bh];}Bi+="<"+Bh+' value="'+AG.encode(AG.encode(Bj))+'" />';}Bi+="</fmt></widgetProps>";}return Bi;},initLayerIdxMappingArr:function Ax(){var Bi=this.layerIdxMappingArr=[],Bk=this.node,Bl=this.getData(),Bj=(Bk&&Bk.k)?Bk.k:Bl.k,Bh=Bl&&Bl.vp,Bm=AB.layerIdx,Bg;if(!Bh){return ;}if(!Bj){Bj=Bl.k="unique_map_key";}Bg=Bh[Bm];if(!isNaN(Bg)&&Bh[AB.isRemoved]!=="1"){Bi[Bg]=Bj;}this.forEachSecondaryProvider(function(Bo,Bn){Bh=Bo&&Bo.vp;Bg=Bh&&Bh[Bm];if(!isNaN(Bg)){Bi[Bg]=Bn;}});this.layerCount=Bi.length;},getNodeKeys:function BC(){return this.layerIdxMappingArr;},initBaseMapProps:function AQ(){var Bh=this.getData(),Bg=Bh&&Bh.vp;if(!Bg){return ;}if(Bg[AB.baseMapType]===v.Reserved){Bg[AB.baseMapType]=this.getDefaultBaseMapType();}if(!AG.checkDefined(Bg[AB.mapStyle])){Bg[AB.mapStyle]=this.getDefaultMapStyle(Bg[AB.baseMapType]);}},oldDataAdaptor:function H(){var Bk=this.getData(),Bg=Bk&&Bk.vp,Bj=false,Bh=this,Bi=0;if(!Bk){return ;}if(!Bg||AO.keyarray(Bg).length<=0){Bj=true;}Bg=Bk.vp=this.vpAdapter(Bg,Bi,Bk.visName);if(!AG.checkDefined(Bg[AB.baseMapType])){Bg[AB.baseMapType]=Bj?v.Reserved:this._initBaseMapType(this.getVisName(Bk));}if(!AG.checkDefined(Bg[AB.editingLayerIdx])){Bg[AB.editingLayerIdx]=0;}if(Bg[AB.isRemoved]!=="1"){Bi++;}this.forEachSecondaryProvider(function(Bl){if(!Bl){return ;}Bl.vp=Bh.vpAdapter(Bl.vp,Bi);Bi++;});},vpAdapter:function BJ(Bi,Bl,Bm){var Bh=this.oldVpNameMappings,Bj=this.vpNameMappings,Bk=AB.graphicType,Bg=AB.markerType,Bn;if(!Bi){return this.createDefaultVp(Bi);}if(AG.checkDefined(Bi[Bk])){this._markerTypeAdaptor4RWDFromNewMap(Bi);return Bi;}for(Bn in Bh){if(Bi[Bh[Bn]]){Bi[Bj[Bn]]=Bi[Bh[Bn]];delete Bi[Bh[Bn]];}}Bi[Bk]=Bi[Bg];if(Bi.sa==="1"&&Bi.sm!=="1"){Bi[Bk]=BX.Area;}this._markerTypeAdapter(Bi,Bm);if(Bi[Bk]===BX.Bubble&&Bi[AB.clusterMode]===AU.PIE){Bi[AB.clusterMode]=AU.ON;}if(!AG.checkDefined(Bi[AB.layerIdx])){Bi[AB.layerIdx]=Bl;}if(!AG.checkDefined(Bi[AB.layerName])){Bi[AB.layerName]=mstrmojo.desc(14750,"Layer")+" "+(Bl+1);}if(!AG.checkDefined(Bi[AB.isHidden])){Bi[AB.isHidden]="0";}return Bi;},_markerTypeAdapter:function Bf(Bh,Bi){if(!Bh){return ;}if(Bh[AB.graphicType]===BX.Marker){var Bg=Bh[AB.imageUrl];if(Bg){Bh[AB.markerType]=AC.Image;}else{if(Bg===""&&Bh[AB.markerType]===AC.Pin){Bh[AB.markerType]=AC.Diamond;}else{Bh[AB.markerType]=(Bi===o.ESRI_MAP&&Bh[AB.markerType]===AC.Pin)?AC.Diamond:AC.Pin;delete Bh[AB.imageUrl];}}}else{delete Bh[AB.markerType];}},_markerTypeAdaptor4RWDFromNewMap:function A0(Bh){if(Bh[AB.graphicType]===BX.Marker){var Bg=Bh[AB.imageUrl];if(Bg===""&&Bh[AB.markerType]===AC.Pin){Bh[AB.markerType]=AC.Diamond;}}},_initBaseMapType:function BB(Bh){var Bg;switch(Bh){case o.ESRI_MAP:Bg=v.Esri;break;case o.GOOGLE_MAP:Bg=v.Google;break;case o.MAPBOX:Bg=v.Mapbox;break;default:Bg=v.Esri;break;}return Bg;},getDefaultBaseMapType:function Ag(){var Bg=this.isESRIKeyValid(),Bh=this.hasGooglePlugin();if(!Bg&&Bh){return v.Google;}return v.Esri;},getGraphicLayerNameArr:function AV(){var Bi=this.getData(),Bo=this.layerIdxMappingArr,Bh=[],Bg=AB.layerName,Bl=AB.layerIdx,Bn,Bk;if(!Bi||!Bo){return ;}for(var Bj=0,Bm=Bo.length;Bj<Bm;Bj++){Bn=Bo[Bj];Bl=this.getProperties(Bn);if(!!Bl){Bk=Bl[Bg];Bh[Bj]={n:Bk,k:Bn};}}return Bh;},isGraphicLayerGrid:function O(Bg){var Bh=Bg&&Bg.vp;if(!Bh){return false;}return Bh[AB.isRemoved]!=="1";},loadMapCss:function BT(){if(!Af){mstrmojo.insertCSSLinks([U.getJsRoot()+"mojo/css/vi-map.css"]);mstrmojo.insertCSSLinks([U.getStyleRoot()+"/mstr/googleMap.css"]);Af=true;}},getMapConfig:function D(){return BU;},hasGooglePlugin:function Ae(){var Bh=this.getMapConfig(),Bg=Bh&&Bh.google;return !!Bg&&!!(Bg.clientId||Bg.trialKey);},isESRIKeyValid:function AA(){var Bi=this.getMapConfig(),Bh=Bi&&Bi.esri,Bg=Bh&&Bh.err;return !(Bg&&Bg.length>0);},postExportHook:function(){var Bj,Bi,Bh,Bg;if(Al.isIE9||Al.isIE10||Al.isIEW3C){this.reviveImages();this.reviveStyles(this.getRootDivForPDF());}else{A8.toggleClass(this.mapDiv,"clientExportAdjust",false);Bj=this.getRootDivForPDF().getElementsByTagName("svg");for(Bh=0,Bg=Bj.length;Bh<Bg;Bh++){Bi=Bj[Bh];Bi.removeAttribute("xmlns");Bi.removeAttribute("xmlns:xlink");if(Al.isChrome){Bi.parentNode.style.transform=0;}}}},hideMapTools:function(){var Bg=this.mapViewer&&this.mapViewer.baseLayer;Bg.hideMapTools();},showMapTools:function(){var Bg=this.mapViewer&&this.mapViewer.baseLayer;Bg.showMapTools();},oncontextmenu:function A4(Bg){var Bh=Bg&&Bg.e;if(Bh!==null){Al.stopPropogation(Bh.hWin,Bh);Al.preventDefault(Bh.hWin,Bh);return false;}},isTitleBarVisible:function A(){var Bg=this.parent&&this.parent.titleBar;return !!Bg&&Bg.visible;},destroyAllSdp:function BE(){var Bg=this.getDocModel(),Bi=BK.ensureArray(this.getSdpKeyArr()),Bk,Bj,Bh;if(!Bi){return ;}for(Bj=0,Bh=Bi.length;Bj<Bh;Bj++){Bk=Bi[Bj];if(!AG.checkDefined(Bk)){continue;}this.destroySdpXtab(Bk);}this.widgetIdMapping=null;if(Bg&&this.sliceEvtListener){Bg.detachEventListener(this.sliceEvtListener);this.sliceEvtListener=null;}this.unRegisterSdpInDocModel(AO.keyarray(this.registeredSDPKeys));},destroySdpXtab:function AP(Bg){var Bh=this.fnGetWidget(Bg);if(Bh){Bh.destroy();BK.forEach(Bh.methodArr,function(Bi){delete Bh[Bi];});}},destroyComponents:function BY(Bh){var Bi=this.mapViewer,Bg=this.getDocModel();this.destroyLegendCon();if(AG.checkHasFunction(Bi,"destroy")){Bi.destroy(undefined,Bh);}delete this.mapViewer;delete this.isRefresh;delete this.errorMsg;if(Bg&&this.docSaveListener){Bg.detachEventListener(this.docSaveListener);this.docSaveListener=null;}this.destroyAllSdp();},destroy:function Z(Bg){this.destroyComponents();this._super(Bg);},unrender:function Q(Bh){if(AG.isOIVM()){this.clearCache();}var Bg=this._lastOpened;if(Bg){this.closePopup();}this._super(Bh);if(!AG.isOIVM()){this.updated=false;this.visPropsUpdated=false;this.isRefresh=false;}},updateColorPaletteChange:function G(){var Bh=this.mapViewer,Bg=this.getGraphicLayer();Bh.forEachGraphicLayer(function(Bi){if(Bi.isColorByAttr){Bi.updateLayerColorByColor();}},false,true,undefined);if(Bg.isColorByAttr){this.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});this.raiseEvent({name:"colorByColorChange",type:"colorFullUpdate"});}},setModel:function e(Bg){this._super(Bg);this.listenToUpdateColorMap(this.updateColorPaletteChange);}});function Aq(Bh,Bi){var Bj=Bi.gsi||{},Bg=[];if(Bh){BK.forEach((Bj.rows||[]).concat(Bj.cols||[]),function(Bk){if(Bk.did===Bh){Bg=[{id:Bh,t:Bk.t}];return false;}});if(!Bg.length){BK.forEach(Bj.mx||[],function(Bk){if(Bk.did===Bh){Bg=[{id:Bh,t:4}];return false;}});}}return Bg;}function n(Bg){if(!!Bg&&Bg.length>0){return Bg[0].id;}return null;}function AD(Bh){if(!!Bh&&Bh.length>0){var Bk=Bh.length,Bj,Bg=[],Bi;for(Bi=0;Bi<Bk;Bi++){Bj=Bh[Bi];Bg.push(Bj.id);}return Bg;}return null;}}());(function(){mstrmojo.requiresCls("mstrmojo.VisMapBase","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.mapbox.MapboxViewer","mstrmojo.PerformanceLogOutput");var N=mstrmojo,D=N.gmaps,G=D.MapUtils,O=D.EnumPropertyType,J=D.EnumMarkerType,H=D.EnumBaseMapType,M=N.PerformanceLogOutput,C=false;mstrmojo.mapbox.VisMapbox=mstrmojo.declare(mstrmojo.VisMapBase,null,{scriptClass:"mstrmojo.mapbox.VisMapbox",viewerCls:N.mapbox.MapboxViewer,defaultMarkerType:J.Circle,buildMap:function K(){this._super();M.endTimer("timerid_callback_LoadMainModule");M.endTimer("timerid_callback_CustomLayerinitShapeInfo");},oldDataAdaptor:function A(){var Q=this.getProperties();if(Q){Q[O.baseMapType]=H.Mapbox;}this._super();},createDefaultVp:function I(){var Q=this._super()||{};Q[O.markerType]=J.Circle;return Q;},loadMapCss:function F(){this._super();if(!C){N.insertCSSLinks([N.getStyleRoot()+"/mstr/mapbox-gl.css"]);C=true;}},isZoomThroughLayerCtrlShown:function B(){var Q=this.mapViewer,R=Q&&Q.getGraphicLayerCount();return R>1;},isZoomThroughLayerEnable:function E(){var R=O.enableZoomThroughLayer,Q=G.parseBoolean(this.getPropertyValue(R));return Q&&this.isZoomThroughLayerCtrlShown();},postViewerInit:function P(){this._super();var Q=this.srcFilterPortlet;if(Q){Q.updateVisFilterTitle();}},onmouseout:function(R){var Q=this.mapViewer&&this.mapViewer.toolbar;if(Q){Q.changeMapStyleMenuVisibilityWithMapToolBar(R);}},onmouseover:function(R){var Q=this.mapViewer&&this.mapViewer.toolbar;if(Q){Q.changeMapStyleMenuVisibilityWithMapToolBar(R);}}});}());