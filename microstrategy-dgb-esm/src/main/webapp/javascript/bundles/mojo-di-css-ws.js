(function(){mstrmojo.Refine.RefineConstants=mstrmojo.provide("mstrmojo.Refine.RefineConstants",{transformationType:{Whitespace:0,TransformCell:1,Delete:2,Split:3,Extract:4,FindAndReplace:5,Facet:6,Other:7,RemoveText:8},transformationSubType:{TrimLeadingTrailingWhitespace:0,CollapseConsecutiveWhitespace:1,Titlecase:10,Uppercase:11,Lowercase:12,UnescapeHTML:13,ChangeDataType:14,FillDown:15,BlankDown:16,PadBefore:17,PadAfter:18,DeleteColumn:20,DeleteRow:21,RemoveDuplicateCells:22,RemoveDuplicateRows:23,DeleteRowsInTheView:24,DeleteRowsNotInTheView:25,SplitByFixedLength:30,SplitOnSeparator:31,SplitBeforeSeparator:32,SplitAfterSeparator:33,SplitCellIntoRows:34,ExtractByFixedLength:40,ExtractBeforeSeparator:41,ExtractAfterSeparator:42,FindAndReplaceCharactersInCell:50,FindAndReplaceCell:51,TextFacet:60,NumericFacet:61,TimelineFacet:62,SearchFacet:63,ClusterAndEdit:70,Duplicate:71,Rename:72,ConcatenateColumns:73,TransposeColumnsToRows:74,RemoveTheText:80,RemoveTheTextBefore:81,RemoveTheTextAfter:82},menuItems:{SEPARATOR:-1,REFINE_RENAME:0,REFINE_DELETE:1,REFINE_DELETE_ALL:2,REFINE_RESET:3,REFINE_RESET_ALL:4,REFINE_SORT_NAME:5,REFINE_SORT_COUNT:6,REFINE_CLUSTER:7,REFINE_NUMERIC_FACET:8,REFINE_TEXT_FACET:9,REFINE_DUPLICATE:10,REFINE_FILL_DOWN:11,REFINE_TITLE_CASE:12,REFINE_UPPERCASE:13,REFINE_LOWERCASE:14,REFINE_DELETE_ROWS_IN_THE_VIEW:15,REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:16}});}());(function(){mstrmojo.vi.models.OneTierServerTransport={serverRequest:function A(F,E,D){var C=window.FormWrapper;if(C){C.serverRequest(E,JSON.stringify(D.params),F,"response");}else{window.console.log(E,JSON.stringify(D.params),F,"response");}},cancelRequest:function B(C){return false;}};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASFFSQLRootController=mstrmojo.provide("mstrmojo.AS.ASFFSQLRootController",{onFinishButtonClick:function C(D){if(window.mstrAppSchema){window.mstrAppSchema.callbacks.freeformSQLCallback(D);}mstrApp.getRootController().exitApplication();},autoMapFFSQL:function A(F){var D=mstrApp.getRootController(),E=D.model;var G={path:"/ffsql/results",form:JSON.stringify(F),method:"POST"};var H={success:function(I){try{var K=I.body;if(I.httpStatus===500&&K.message){mstrmojo.alert(K.message);return ;}E.mappings=[];for(var J=0;J<K.rows.length;J++){for(var M=0;M<K.rows[J].length;M++){if(K.rows[J][M]===null){K.rows[J][M]="";}}}E.dataset=K.rows;K.headers.forEach(function(N){E.mappings.push({n:N.name,ix:N.index,dtp:B.columnDataTypes[N.datatype]});});E.raiseEvent({name:"dataPreview",mappings:E.mappings,dataset:E.dataset,selectedColumns:E.selectedClns,isRefined:E.isRefined});}catch(L){mstrmojo.alert("Error! Data from spark is unexpected.");}}};D.dataService.archSpark(H,G,{showCancel:true});}});}());(function(){mstrmojo.requiresDescs(12575,12316,12317,12319,12331,14244,14245,14246,14247,14248,14249,14250,14251,14252,14253,14254,14255,14256,14257,14258,14259,14260,14261,14262,14263,14264,14265,14266,14267,12339,12341,12342,13957,13958,12344,12345,14268,14269,14270,14271,14272,14273,14274,14275,14276,14277,14278,14279,14280,14288,14289,14762,14763,14764,14765);mstrmojo.requiresCls("mstrmojo.hash");var F=mstrmojo.hash;mstrmojo.Refine.RefineModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineModel",data:{},start:0,limit:50,columns:{},history:{},operations:{entries:[]},engine:JSON.stringify({facets:[],mode:"row-based"}),hasUploadData:false,sampleStatus:null,transformations:{Delete:{Colomn:{op:"core/column-removal",description:mstrmojo.desc(12575,"Delete Column")+" [[column name]]",columnName:"[column name]"},RowsContains:{op:"core/row-removal",description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBegins:{op:"core/row-removal",description:mstrmojo.desc(14245,"Delete Row(s) Where Cell Begins With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsEnds:{op:"core/row-removal",description:mstrmojo.desc(14263,"Delete Row(s) Where Cell Ends With ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{query:"[text]",name:"[column name]",caseSensitive:true,columnName:"[column name]",type:"text",mode:"regex"}],mode:"row-based"}},RowsBlank:{op:"core/row-removal",description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{expression:"value",invert:false,selectError:false,omitError:false,name:"[column name]",selectBlank:true,columnName:"[column name]",omitBlank:false,type:"list",selection:[]}],mode:"row-based"}},RowsEquals:{op:"core/row-removal",description:mstrmojo.desc(14288,"Delete Row(s) Where Cell Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:false,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RowsNotEquals:{op:"core/row-removal",description:mstrmojo.desc(14289,"Delete Row(s) Where Cell Not Equals To ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[{invert:true,expression:"value",selectError:false,omitError:false,selectBlank:false,name:"[column name]",omitBlank:false,columnName:"[column name]",type:"list",selection:[{v:{v:"[value]",l:"[value]"}}]}],mode:"row-based"}},RemoveDuplicateCells:{op:"core/row-deduplicate",description:mstrmojo.desc(12316,"Remove Duplicate Cells")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",columnName:"[column name]",engineConfig:{facets:[],mode:"row-based"},mode:"column-based"},RemoveDuplicateRows:{op:"core/row-deduplicate",description:mstrmojo.desc(12317,"Remove Duplicate Rows")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},mode:"row-based"},DeleteRowsInTheView:{op:"core/row-removal",description:mstrmojo.desc(14764,"Deleted rows meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"}},DeleteRowsNotInTheView:{op:"core/row-removal",description:mstrmojo.desc(14765,"Deleted rows not meeting the requirement")+": [Requirement] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},invert:true}},Extract:{on:{op:"core/column-addition",description:mstrmojo.desc(14247,"Extract On ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[1])",onError:"store-error"},fromTo:{op:"core/column-addition",description:mstrmojo.desc(12319,"Extract By Fixed Length")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:substring(value, [from], [to])",onError:"set-to-blank"},beforeFirst:{op:"core/column-addition",description:mstrmojo.desc(14248,"Extract Before First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0])",onError:"store-error"},afterFirst:{op:"core/column-addition",description:mstrmojo.desc(14249,"Extract After First ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(partition(value, [separator])[2])",onError:"store-error"},beforeLast:{op:"core/column-addition",description:mstrmojo.desc(14264,"Extract Before Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[0])",onError:"set-to-blank"},afterLast:{op:"core/column-addition",description:mstrmojo.desc(14265,"Extract After Last ####")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:trim(rpartition(value, [separator])[2])",onError:"store-error"}},FindAndReplace:{CharInCell:{op:"core/text-transform",description:mstrmojo.desc(14250,"Find And Replace Characters In Cell From #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [from], [to])",onError:"keep-original",repeat:false,repeatCount:10},CellContains:{op:"core/text-transform",description:mstrmojo.desc(14251,"Find And Replace Cell Where Cell Contains #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(contains(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellBeginsWith:{op:"core/text-transform",description:mstrmojo.desc(14252,"Find And Replace Cell Where Cell Begins With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(startsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CellEndsWith:{op:"core/text-transform",description:mstrmojo.desc(14253,"Find And Replace Cell Where Cell Ends With #### To @@@@")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:if(endsWith(value, [from]), replace(value, value, [to]), value)",onError:"keep-original",repeat:false,repeatCount:10},CutOn:{op:"core/text-transform",description:mstrmojo.desc(14514,"Remove Characters")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:replace (value, [separator], '')",onError:"keep-original",repeat:false,repeatCount:10},CutBefore:{op:"core/text-transform",description:mstrmojo.desc(14515,"Remove Characters Before")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(if(isBlank(partition(value, [separator])[1]), value, partition(value, [separator])[1] + partition(value, [separator])[2]))",onError:"keep-original",repeat:false,repeatCount:10},CutAfter:{op:"core/text-transform",description:mstrmojo.desc(14516,"Remove Characters After")+" #### [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:trim(partition(value, [separator])[0] + partition(value, [separator])[1])",onError:"keep-original",repeat:false,repeatCount:10}},split:{bySeparator:{op:"core/column-split",description:mstrmojo.desc(14260,"Split On ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:0,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:0},byFieldLengths:{op:"core/column-split",description:mstrmojo.desc(12331,"Split By Fixed Length")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},fieldForward:true,keepRest:true,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"lengths",fieldLengths:[]},beforeFirst:{op:"core/column-split",description:mstrmojo.desc(14257,"Split Before First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:1,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterFirst:{op:"core/column-split",description:mstrmojo.desc(14258,"Split After First ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:3,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},afterLast:{op:"core/column-split",description:mstrmojo.desc(14259,"Split After Last ####")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},separatorSolutionInt:4,columnName:"[column name]",guessCellType:true,removeOriginalColumn:true,mode:"separator",separator:",",regex:false,maxColumns:2},cellIntoRow:{op:"core/multivalued-cell-split",description:mstrmojo.desc(13884,"Split Cell Into Rows On Separator")+" [column name]",columnName:"[column name]",keyColumnName:"[key column name]",separator:",",mode:"plain"}},TransformCell:{titlecase:{op:"core/text-transform",description:mstrmojo.desc(14268,"To Title Case")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[[column name]]",expression:"value.toTitlecase()",onError:"keep-original",repeat:false,repeatCount:10},uppercase:{op:"core/text-transform",description:mstrmojo.desc(14269,"To Uppercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toUppercase()",onError:"keep-original",repeat:false,repeatCount:10},lowercase:{op:"core/text-transform",description:mstrmojo.desc(14270,"To Lowercase")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toLowercase()",onError:"keep-original",repeat:false,repeatCount:10},unescape:{op:"core/text-transform",description:mstrmojo.desc(12339,"Unescape HTML")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.unescape('html')",onError:"keep-original",repeat:false,repeatCount:10},number:{op:"core/text-transform",description:mstrmojo.desc(14271,"To Number")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.toNumber()",onError:"set-to-blank",repeat:false,repeatCount:10},text:{op:"core/text-transform",description:mstrmojo.desc(14272,"To Text")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"toString(value)",onError:"set-to-blank",repeat:false,repeatCount:10},date:{op:"core/text-transform",description:mstrmojo.desc(14273,"To Date")+" [format] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"grel:toDate(value, [format])",onError:"set-to-blank",repeat:false,repeatCount:10},fillDown:{op:"core/fill-down",description:mstrmojo.desc(12341,"Fill Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},blankDown:{op:"core/blank-down",description:mstrmojo.desc(12342,"Blank Down")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]"},padBefore:{op:"core/text-transform",description:mstrmojo.desc(13957,"Pad Before")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:[string] + if(isNull(value), "", value)',onError:"keep-original",repeat:false,repeatCount:10},padAfter:{op:"core/text-transform",description:mstrmojo.desc(13958,"Pad After")+" [string] [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"record-based"},columnName:"[column name]",expression:'grel:if(isNull(value), "", value) + [string]',onError:"keep-original",repeat:false,repeatCount:10}},Whitespace:{trim:{op:"core/text-transform",description:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.trim()",onError:"keep-original",repeat:false,repeatCount:10},collapse:{op:"core/text-transform",description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value.replace(/\\s+/,' ')",onError:"keep-original",repeat:false,repeatCount:10}},Other:{duplicate:{op:"core/column-addition",description:mstrmojo.desc(14274,"Duplicate Column")+" {[new column name]} [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:1,baseColumnName:"[column name]",expression:"grel:value",onError:"set-to-blank"},Rename:{op:"core/column-rename",description:mstrmojo.desc(14275,"Rename Column [####] To {@@@@}"),oldColumnName:"[column name]",newColumnName:"[column name]"},ConcatenateColumns:{op:"core/column-addition",description:mstrmojo.desc(14276,"Concatenate Column [####] And Column [@@@@] To Column {@@@@}")+" (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name 1]",expression:'grel:if(isNull(cells["[column name 1]"]),"",cells["[column name 1]"].value) + "" + if(isNull(cells["[column name 2]"]), "", cells["[column name 2]"].value)',onError:"set-to-blank"},TransposeColumnsIntoRows:{op:"core/transpose-columns-into-rows",description:mstrmojo.desc(14278,"Transpose cells in #### column(s) starting with [@@@@] into rows in two new columns named [@@@@] and [@@@@]"),startColumnName:"[start column]",columnCount:7,ignoreBlankCells:true,fillDown:true,keyColumnName:"[new column 1]",valueColumnName:"[new column 2]"}},URL:{newColumnName:"[column name]",columnInsertIndex:"[index]",baseColumnName:"[column name]",urlExpression:"[ex]",onError:"set-to-blank",delay:5000},EditCell:{applyToAll:{op:"core/mass-edit",description:mstrmojo.desc(14279,"Edit Cell")+" [[column name]] (#### "+mstrmojo.desc(2968,"Rows")+")",engineConfig:{facets:[],mode:"row-based"},columnName:"[column name]",expression:"value",edits:[{fromBlank:false,fromError:false,from:["[from]"],to:"[to]",type:"text"}]},singleEdit:{op:"core/single-edit",description:mstrmojo.desc(14280,"Edit cell in row #### at cell #### value is: ####"),engineConfig:{facets:[],mode:"row-based"},row:0,col:0,to:"[to]"}}},suggestions:{partialCell:{split:[{description:mstrmojo.desc(12331,"Split By Fixed Length"),suggestion_type:1,suggestion_subtype:0,operations:[{}]},{description:mstrmojo.desc(14266,"Split Before ####"),suggestion_type:1,suggestion_subtype:3,operations:[{}]},{description:mstrmojo.desc(14267,"Split After ####"),suggestion_type:1,suggestion_subtype:2,operations:[{}]},{description:mstrmojo.desc(14260,"Split On ####"),suggestion_type:1,suggestion_subtype:1,operations:[{}]}],extract:[{description:mstrmojo.desc(14261,"Extract Before ####"),suggestion_type:1,suggestion_subtype:6,operations:[{}]},{description:mstrmojo.desc(14262,"Extract After ####"),suggestion_type:1,suggestion_subtype:5,operations:[{}]},{description:mstrmojo.desc(14247,"Extract On ####"),suggestion_type:1,suggestion_subtype:4,operations:[{}]}],cut:[{description:mstrmojo.desc(14515,"Remove Characters Before")+" ####",suggestion_type:1,suggestion_subtype:9,operations:[{}]},{description:mstrmojo.desc(14516,"Remove Characters After")+" ####",suggestion_type:1,suggestion_subtype:8,operations:[{}]},{description:mstrmojo.desc(14514,"Remove Characters")+" ####",suggestion_type:1,suggestion_subtype:7,operations:[{}]}],deleteRows:[{description:mstrmojo.desc(14244,"Delete Row(s) Where Cell Contains ####"),operations:[{}]},{description:mstrmojo.desc(14762,"Delete Row Included In Selectors"),suggestion_type:2,operations:[{}]},{description:mstrmojo.desc(14763,"Delete Row Not-included In Selectors"),suggestion_type:2,operations:[{}]}]},cell:[{}],row:[{}],column:[{description:mstrmojo.desc(12575,"Delete Column"),operations:[{}]},{description:mstrmojo.desc(12341,"Fill Down"),operations:[{}]},{description:mstrmojo.desc(12342,"Blank Down"),operations:[{}]},{description:mstrmojo.desc(14268,"To Title Case"),operations:[{}]},{description:mstrmojo.desc(14269,"To Uppercase"),operations:[{}]},{description:mstrmojo.desc(14270,"To Lowercase"),operations:[{}]},{description:mstrmojo.desc(14246,"Remove Row(s) Where Cell Is Empty")+" [[column name]]",operations:[{}]},{description:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),operations:[{}]},{description:mstrmojo.desc(14277,"Transpose Columns to Row from [####] to [@@@@]"),operations:[{}]}]},populateData:function G(H){this.set("data",H);},populateColumns:function A(H){this.set("columns",H);},populateHistory:function E(H){this.set("history",H);},populateOperations:function D(H){this.set("operations",H);},getCurrentOperations:function(){var J=F.clone(this.operations),I,H,L,K;for(K=0;K<J.entries.length;K++){L=J.entries[K];L.selected=true;}H=J&&J.entries;if(H&&H.length>0){I=H.length;L=H[I-1];if(!("op" in L.operation)||("estimatedRow" in L.operation)){H.pop();}}return J;},populateSampleStatus:function B(H){this.set("sampleStatus",H);},hasAddSample:function C(){var H=!!this.sampleStatus;if(H&&!this.sampleStatus.random){H=false;}return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.dom");var H=mstrmojo.array,F=mstrmojo.hash;var G={pages:[],refCnt:[]};var C={};var D=0;function B(){return D++;}function E(K){if(!K){return ;}var J=G.pages;var I=H.indexOf(J,K);if(I!==-1){G.refCnt[I]=G.refCnt[I]+1;}else{G.pages.push(K);G.refCnt.push(1);}}function A(M){if(!M){return ;}var J=G.pages;var I=H.indexOf(J,M);var L,K;if(I!==-1){G.refCnt[I]=G.refCnt[I]-1;if(G.refCnt[I]===0){L=G.pages[I];G.pages.splice(I,1);G.refCnt.splice(I,1);for(K in C){if(L===C[K].page){C[K].page=null;}}L.destroy();}}}mstrmojo.DI.DIPagePoolSlot=mstrmojo.declare(mstrmojo.Obj,null,{key:null,get:function(){return C[this.key].page||null;},set:function(J){var I=this.key;C[I].page=J;J.pageSlotKey=I;},getConfig:function(){return C[this.key].config||null;},setConfig:function(J){var I=this.key;C[I].config=J;},postCreate:function(){if(this._super){this._super();}var I=this.key;if(I&&!C[I]){C[I]={slot:this,page:null};}},destroy:function(J){var I=this.key;if(I){delete C[I];}if(this._super){this._super(J);}}});mstrmojo.DI.DINavigationController=mstrmojo.declare(mstrmojo.Obj,null,{routes:{},postCreate:function(){this.routes={};this.pagePool=C;this.pageInstanceRef=G;},destroy:function(I){F.forEach(C,function(J){if(J.page&&!J.page.destroyed){J.page.destroy();}});this.routes={};C={};G={pages:[],refCnt:[]};if(this._super){this._super(I);}},addRoute:function(I){if(this.routes[I]){return false;}this.routes[I]=[];return true;},deleteRoute:function(K){var I=this.routes[K];var J,L;if(I){for(J=I.length-1;J>-1;J--){L=I[J].slot.get();I[J].slot.destroy();A(L);}}delete this.routes[K];},getPreviousPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L>0){M=I[L-1].slot;}return M;},getNextPageSlot:function(K,N){var I=this.getRoute(K);var J,M=null;var L=-1;if(I){for(J=0;J<I.length;J++){if(I[J].type===N){L=J;break;}}}if(L+1<I.length){M=I[L+1].slot;}return M;},getRoute:function(I){return this.routes[I];},pushPage:function(K,J,M,L,N){var I;var P;var O;if(!this.getRoute(K)){this.addRoute(K);}I=this.getRoute(K);if(!L){P=B().toString();O=this.getPageSlot(P);}else{O=L;}if(M){O.set(M);E(O.get());}if(N){O.setConfig(N);}I.push({type:J,slot:O});return O;},getCurrentPageSlot:function(M,J){var I=this.getRoute(M);var K=null;var L;if(I){for(L=0;L<I.length;L++){if(I[L].type===J){K=I[L].slot;}}}return K;},getPageSlot:function(J){var K=null;var I=B().toString();J=J||I;K=C[J]&&C[J].slot;if(!K){K=new mstrmojo.DI.DIPagePoolSlot({key:J});}return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12379,12380);var E=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIDirectAccessController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDirectAccessController",shouldAskUser:true,confirmDDA:true,canSupportDDA:function C(I){var M=mstrApp.getRootController().model,K=true,N=-1,P=-1,J=-1,L,R=E.sourceSubtype,Q,O=M.getAllTableID().length;if(M.connectLiveSupport===E.connectLiveSupport.connectLiveSupportInMemoryOnly&&O>0){K=false;}else{mstrmojo.hash.forEach(M.importSources,function(S){Q=S.subtype;if(Q===R.googleBigQueryFFSQL||Q===R.googleBigQuerySingleTable){Q=R.googleBigQuery;}if(M.isSupportedDDASource(Q)){if(N===-1){N=Q;}else{if(N!==Q){K=false;return false;}}switch(N){case R.hanaSingleTable:case R.querybuilder:case R.searchOnSource:case R.mdx:if(P===-1){P=S.dbrid;}else{if(P!==S.dbrid){K=false;return false;}}break;case R.googleBigQuery:L=S.sourceInfo;if(J===-1){J=L.said;}else{if(J!==L.said){K=false;return false;}}break;default:break;}}else{K=false;return false;}});if(I){I.dbrid=(P===-1?undefined:P);}if(M.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportInMemoryOnly||O===0){K=true;}}return K;},shouldSupportDDA:function D(){var I=mstrApp.getRootController().model;var J=false;if(I.connectLiveSupport!==E.connectLiveSupport.connectLiveSupportUnknown){if(I.connectLiveSupport===E.connectLiveSupport.connectLiveSupportDDAOnly){J=true;}}else{mstrmojo.hash.forEach(I.importSources,function(K){if(I.isDDAOnlySource(K.subtype)||(K.xdaType===E.xdaType.qbSingleTable&&K.databaseType===4000)){J=true;}});}return J;},onToggleDDA:function A(J){var I=mstrApp.getRootController();if(J===true){I.model.set("isDirectDataAccess",true);if(!this.canSupportDDA()){I.displayError(mstrmojo.desc(12379,"We cannot convert the cube to a DDA cube because you are importing some tables that cannot support it. Remove them to enable this feature."),false);I.model.set("isDirectDataAccess",false);}}else{I.model.set("isDirectDataAccess",false);if(this.shouldSupportDDA()){I.displayError(mstrmojo.desc(12380,"The cube has to be a direct data access cube due to some of the sources selected. You will have to delete them if you want to change this."),false);I.model.set("isDirectDataAccess",true);}}},askUserAboutDDA:function G(I){if(I){this.shouldAskUser=false;}return this.shouldAskUser;},checkIfDDA:function H(K){var I=mstrApp.getRootController();var J=I.model,L;if(J.isDirectDataAccess){return true;}if(J.operationMode===E.operationMode.edit){if(K){for(L=0;L<K.cn;L++){if(K.cube[L].cube_id===J.cubeID&&K.cube[L].sz===undefined&&this.canSupportDDA()){return true;}}}}return false;},getDDACheckboxID:function F(){var I=mstrApp.getRootController().rootView.footer.ddaCheckbox;return I?I.id:"";},setDirectDataAccess:function B(I){mstrApp.getRootController().model.set("isDirectDataAccess",I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(12746,12747);var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIHadoopDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIHadoopDBRole",init:function D(F){var E=this.mdDBRole;E.n=mstrmojo.desc(12746,"Hadoop Connection");E.des=mstrmojo.desc(12747,"Hadoop Connection Description");E.dbr_type="2";E.stp=7424;E.owned="1";E.writable="1";E.ln="UserName";E.password=B;E.tp=44;E.db_type=A.BDE;E.db_version=218;E.dbms="85649E2005E343A19269C39CC3DE9E42";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:44,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresDescs(14723,14735);mstrmojo.Refine.RefineHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.Refine.RefineHelpers.completely=function(N,R){R=R||{};R.fontSize=R.fontSize||"16px";R.fontFamily=R.fontFamily||"sans-serif";R.promptInnerHTML=R.promptInnerHTML||"";R.color=R.color||"#000";R.hintColor=R.hintColor||"#aaa";R.backgroundColor=R.backgroundColor||"#fff";R.dropdownBackgroundColor=R.dropdownBackgroundColor||"#f3f3f4";R.dropDownBorderColor=R.dropDownBorderColor||"#aaa";R.dropDownZIndex=R.dropDownZIndex||"100";R.dropDownOnHoverBackgroundColor=R.dropDownOnHoverBackgroundColor||"#dadada";var C=document.createElement("input");C.type="text";C.spellcheck=false;C.style.fontSize=R.fontSize;C.style.fontFamily=R.fontFamily;C.style.color=R.color;C.style.backgroundColor=R.backgroundColor;C.style.width="100%";C.style.outline="0";C.style.border="0";C.style.margin="0";C.style.padding="0";var P=C.cloneNode();P.disabled="";P.style.position="absolute";P.style.top="0";P.style.left="0";P.style.borderColor="transparent";P.style.boxShadow="none";P.style.color=R.hintColor;P.style.visibility="hidden";C.style.backgroundColor="transparent";C.style.verticalAlign="top";C.style.position="relative";var F=document.createElement("div");F.style.position="relative";F.style.outline="0";F.style.border="0";F.style.margin="0";F.style.padding="0";var O=document.createElement("div");O.style.position="absolute";O.style.outline="0";O.style.margin="0";O.style.padding="0";O.style.border="0";O.style.fontSize=R.fontSize;O.style.fontFamily=R.fontFamily;O.style.color=R.color;O.style.backgroundColor=R.backgroundColor;O.style.top="0";O.style.left="0";O.style.overflow="hidden";O.innerHTML=R.promptInnerHTML;O.style.background="transparent";if(document.body===undefined){throw"document.body is undefined. The library was wired up incorrectly.";}document.body.appendChild(O);var K=O.getBoundingClientRect().right;F.appendChild(O);O.style.visibility="visible";O.style.left="-"+K+"px";F.style.marginLeft=K+"px";F.appendChild(P);F.appendChild(C);var D=document.createElement("div");D.style.position="absolute";D.style.visibility="hidden";D.style.padding="5px 0px";D.style.backgroundColor=R.dropdownBackgroundColor;D.style.borderWidth="1px";D.style.borderColor=R.dropDownBorderColor;D.style.borderStyle="solid";var A=document.createElement("div");A.style.position="relative";A.style.outline="0";A.style.margin="0";A.style.padding="0";A.style.textAlign="left";A.style.fontSize=R.fontSize;A.style.fontFamily=R.fontFamily;A.style.zIndex=R.dropDownZIndex;A.style.cursor="default";A.style.overflowX="hidden";A.style.whiteSpace="pre";A.style.overflowY="scroll";A.style.width=R.width+"px";var J=function(U,a){var b=[];var V=0;var Y=-1;var W=function(){this.style.backgroundColor="#e6e6e6";};var X=function(){if(b.indexOf(this)===Y){this.style.backgroundColor=R.dropDownOnHoverBackgroundColor;}else{this.style.backgroundColor=R.dropdownBackgroundColor;}};var Z=function(){T.hide();T.onmouseselection(this.__hint);};var T={hide:function(){a.style.visibility="hidden";},refresh:function(f,h){a.style.visibility="hidden";V=-1;U.innerHTML="";var d=(window.innerHeight||document.documentElement.clientHeight);var j=a.parentNode.getBoundingClientRect();var c=j.top-6;var e=d-j.bottom-6;b=[];var g;for(g=0;g<h.length;g++){if(h[g].toLowerCase().indexOf(f.toLowerCase())!==0){continue;}var k=document.createElement("div");k.style.color=R.color;k.style.padding="0px 0px 0px 9px";k.style.height="22px";k.style.lineHeight="22px";k.style.overflow="hidden";k.style.textOverflow="ellipsis";k.style.whiteSpace="nowrap";k.onmouseover=W;k.onmouseout=X;k.onmousedown=Z;k.title=k.__hint=h[g];k.innerHTML=mstrmojo.string.encodeHtmlString(h[g].substr(0,f.length),false,true)+mstrmojo.string.encodeHtmlString(h[g].substring(f.length),false,true);b.push(k);}for(g=0;g<b.length;g++){U.appendChild(b[g]);}if(b.length===0){return ;}if(b.length===1&&f===b[0].__hint){return ;}if(b.length<1){return ;}var l=22*9;if(e<l){a.style.top="";a.style.bottom=R.bottom+"px";}else{a.style.top=R.top+"px";a.style.bottom="";}U.style.maxHeight=l+"px";a.style.visibility="visible";},highlight:function(d){if(b.length===0){return ;}if(Y!==-1&&b[Y]){b[Y].style.backgroundColor=R.dropdownBackgroundColor;}b[d].style.backgroundColor=R.dropDownOnHoverBackgroundColor;Y=d;var e=b[d];var c=e.parentNode;if(e.offsetTop+e.clientHeight>c.scrollTop+c.clientHeight){c.scrollTop=e.offsetTop+e.clientHeight-c.clientHeight;}else{if(e.offsetTop<c.scrollTop){c.scrollTop=e.offsetTop;}}},move:function(c){if(a.style.visibility==="hidden"){return"";}if(V+c===-2||V+c===-1){V=b.length-1;}else{if(V+c===b.length){V=0;}else{V+=c;}}T.highlight(V);return b[V].__hint;},onmouseselection:function(){}};return T;};var M=J(A,D);M.onmouseselection=function(T){C.value=P.value=G+T;H.onChange(C.value);B=C.value;setTimeout(function(){C.focus();P.scrollLeft=C.scrollLeft;},0);};D.appendChild(A);F.appendChild(D);N.appendChild(F);var I;var G;function L(T){if(I===undefined){I=document.createElement("span");I.style.visibility="hidden";I.style.position="fixed";I.style.outline="0";I.style.margin="0";I.style.padding="0";I.style.border="0";I.style.left="0";I.style.whiteSpace="pre";I.style.fontSize=R.fontSize;I.style.fontFamily=R.fontFamily;I.style.fontWeight="normal";document.body.appendChild(I);}I.innerHTML=String(T).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return I.getBoundingClientRect().right;}var H={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(T){T.preventDefault();T.stopPropagation();},onTab:function(){},onChange:function(){H.repaint();},startFrom:0,options:[],wrapper:F,input:C,hint:P,dropDown:A,prompt:O,setText:function(T){P.value=T;C.value=T;},getText:function(){return C.value;},hideDropDown:function(){M.hide();},repaint:function(){var Z=C.value;var Y=H.startFrom;var U=H.options;var T=U.length;var X=Z.substring(Y);G=Z.substring(0,Y);P.value="";for(var W=0;W<T;W++){var V=U[W];if(V.toLowerCase().indexOf(X.toLowerCase())===0){break;}}A.parentNode.style.left=L(G)-R.left+"px";M.refresh(X,H.options);B=Z;}};var B;var Q=function(T,W){B=T.value;var U=function(){var X=T.value;if(B!==X){B=X;W(X);}P.scrollLeft=C.scrollLeft;};var V=function(){P.value="";};if(T.addEventListener){T.addEventListener("input",U,false);T.addEventListener("keyup",U,false);T.addEventListener("change",U,false);T.addEventListener("blur",V,false);}else{T.attachEvent("oninput",U);T.attachEvent("onkeyup",U);T.attachEvent("onchange",U);T.attachEvent("onblur",V);}};Q(C,function(T){H.onChange(T);});var S=function(W){W=W||window.event;var V=W.keyCode;var X,T;if(W.keyCode===17){return ;}if(V===33){return ;}if(V===34){return ;}if(V===27){M.hide();P.value=C.value;C.focus();return ;}if(V===39||V===35||V===9){if(V===9){W.preventDefault();W.stopPropagation();if(P.value.length===0){H.onTab();}}if(P.value.length>0){var U=(A.style.visibility==="hidden");if(!U){M.hide();}if(C.value!==P.value){C.value=P.value;}X=B!==C.value;B=C.value;if(X){H.onChange(C.value);}}return ;}if(V===13){if(P.value.length===0){return ;}else{var U=(A.style.visibility==="hidden");if(!U){M.hide();}if(U){P.value=C.value;C.focus();H.onEnter(W);return ;}C.value=P.value;X=B!==C.value;B=C.value;if(X){H.onChange(C.value);}W.preventDefault();W.stopPropagation();}return ;}if(V===40){T=M.move(+1);if(T===""){H.onArrowDown();}P.value=G+T;return ;}if(V===38){T=M.move(-1);if(T===""){H.onArrowUp();}P.value=G+T;W.preventDefault();W.stopPropagation();return ;}if(C.value===""&&(V===8)||(V===46)){return ;}P.value="";};var E=function(){this.parentNode.childNodes[1].scrollTop=this.scrollTop;};if(C.addEventListener){C.addEventListener("keydown",S,false);C.addEventListener("scroll",E,false);}else{C.attachEvent("onkeydown",S);C.attachEvent("scroll",E);}return H;};mstrmojo.Refine.RefineHelpers.confirmFilldownOrBlankdown=function(F,C){var D=mstrmojo.desc(14723,'The column is going to be "fill down" or "blank down" using the data order of the random sample in the preview page. When the dataset is eventually published, the entire table in the correct order will be utilized by the wrangler to populate the correct "fill down" or "blank down" values in the final in-memory dataset'),B=mstrmojo.desc(14735,"Warning: Final table data may differ from current preview due to Fill Down / Blank Down operation."),A=mstrmojo.desc(12537,"Data Import");var E=mstrApp.getRootController();if(F){E.displayError(B,false,D,F,A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.Refine.DateTimeUtil=mstrmojo.declare(mstrmojo.Obj,null,null);Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var B=Date,A=B.prototype,D=B.CultureInfo,G=function(I,H){if(!H){H=2;}return("000"+I).slice(H*-1);};A.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};A.setTimeToNow=function(){var H=new Date();this.setHours(H.getHours());this.setMinutes(H.getMinutes());this.setSeconds(H.getSeconds());this.setMilliseconds(H.getMilliseconds());return this;};B.today=function(){return new Date().clearTime();};B.compare=function(I,H){if(isNaN(I)||isNaN(H)){throw new Error(I+" - "+H);}else{if(I instanceof Date&&H instanceof Date){return(I<H)?-1:(I>H)?1:0;}else{throw new TypeError(I+" - "+H);}}};B.equals=function(I,H){return(I.compareTo(H)===0);};B.getDayNumberFromName=function(I){var M=D.dayNames,H=D.abbreviatedDayNames,L=D.shortestDayNames,K=I.toLowerCase();for(var J=0;J<M.length;J++){if(M[J].toLowerCase()==K||H[J].toLowerCase()==K||L[J].toLowerCase()==K){return J;}}return -1;};B.getMonthNumberFromName=function(I){var L=D.monthNames,H=D.abbreviatedMonthNames,K=I.toLowerCase();for(var J=0;J<L.length;J++){if(L[J].toLowerCase()==K||H[J].toLowerCase()==K){return J;}}return -1;};B.isLeapYear=function(H){return((H%4===0&&H%100!==0)||H%400===0);};B.getDaysInMonth=function(H,I){return[31,(B.isLeapYear(H)?29:28),31,30,31,30,31,31,30,31,30,31][I];};B.getTimezoneAbbreviation=function(K){var J=D.timezones,I;for(var H=0;H<J.length;H++){if(J[H].offset===K){return J[H].name;}}return null;};B.getTimezoneOffset=function(H){var K=D.timezones,J;for(var I=0;I<K.length;I++){if(K[I].name===H.toUpperCase()){return K[I].offset;}}return null;};A.clone=function(){return new Date(this.getTime());};A.compareTo=function(H){return Date.compare(this,H);};A.equals=function(H){return Date.equals(this,H||new Date());};A.between=function(I,H){return this.getTime()>=I.getTime()&&this.getTime()<=H.getTime();};A.isAfter=function(H){return this.compareTo(H||new Date())===1;};A.isBefore=function(H){return(this.compareTo(H||new Date())===-1);};A.isToday=function(){return this.isSameDay(new Date());};A.isSameDay=function(H){return this.clone().clearTime().equals(H.clone().clearTime());};A.addMilliseconds=function(H){this.setMilliseconds(this.getMilliseconds()+H);return this;};A.addSeconds=function(H){return this.addMilliseconds(H*1000);};A.addMinutes=function(H){return this.addMilliseconds(H*60000);};A.addHours=function(H){return this.addMilliseconds(H*3600000);};A.addDays=function(H){this.setDate(this.getDate()+H);return this;};A.addWeeks=function(H){return this.addDays(H*7);};A.addMonths=function(H){var I=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+H);this.setDate(Math.min(I,B.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};A.addYears=function(H){return this.addMonths(H*12);};A.add=function(I){if(typeof I=="number"){this._orient=I;return this;}var H=I;if(H.milliseconds){this.addMilliseconds(H.milliseconds);}if(H.seconds){this.addSeconds(H.seconds);}if(H.minutes){this.addMinutes(H.minutes);}if(H.hours){this.addHours(H.hours);}if(H.weeks){this.addWeeks(H.weeks);}if(H.months){this.addMonths(H.months);}if(H.years){this.addYears(H.years);}if(H.days){this.addDays(H.days);}return this;};var E,F,C;A.getWeek=function(){var O,N,M,L,K,J,I,H,Q,P;E=(!E)?this.getFullYear():E;F=(!F)?this.getMonth()+1:F;C=(!C)?this.getDate():C;if(F<=2){O=E-1;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=0;J=C-1+(31*(F-1));}else{O=E;N=(O/4|0)-(O/100|0)+(O/400|0);M=((O-1)/4|0)-((O-1)/100|0)+((O-1)/400|0);Q=N-M;K=Q+1;J=C+((153*(F-3)+2)/5)+58+Q;}I=(O+N)%7;L=(J+I-K)%7;H=(J+3-L)|0;if(H<0){P=53-((I-Q)/5|0);}else{if(H>364+Q){P=1;}else{P=(H/7|0)+1;}}E=F=C=null;return P;};A.getISOWeek=function(){E=this.getUTCFullYear();F=this.getUTCMonth()+1;C=this.getUTCDate();return G(this.getWeek());};A.setWeek=function(H){return this.moveToDayOfWeek(1).addWeeks(H-this.getWeek());};B._validate=function(K,J,H,I){if(typeof K=="undefined"){return false;}else{if(typeof K!="number"){throw new TypeError(K+" is not a Number.");}else{if(K<J||K>H){throw new RangeError(K+" is not a valid value for "+I+".");}}}return true;};B.validateMillisecond=function(H){return B._validate(H,0,999,"millisecond");};B.validateSecond=function(H){return B._validate(H,0,59,"second");};B.validateMinute=function(H){return B._validate(H,0,59,"minute");};B.validateHour=function(H){return B._validate(H,0,23,"hour");};B.validateDay=function(I,H,J){return B._validate(I,1,B.getDaysInMonth(H,J),"day");};B.validateMonth=function(H){return B._validate(H,0,11,"month");};B.validateYear=function(H){return B._validate(H,0,9999,"year");};A.set=function(H){if(B.validateMillisecond(H.millisecond)){this.addMilliseconds(H.millisecond-this.getMilliseconds());}if(B.validateSecond(H.second)){this.addSeconds(H.second-this.getSeconds());}if(B.validateMinute(H.minute)){this.addMinutes(H.minute-this.getMinutes());}if(B.validateHour(H.hour)){this.addHours(H.hour-this.getHours());}if(B.validateMonth(H.month)){this.addMonths(H.month-this.getMonth());}if(B.validateYear(H.year)){this.addYears(H.year-this.getFullYear());}if(B.validateDay(H.day,this.getFullYear(),this.getMonth())){this.addDays(H.day-this.getDate());}if(H.timezone){this.setTimezone(H.timezone);}if(H.timezoneOffset){this.setTimezoneOffset(H.timezoneOffset);}if(H.week&&B._validate(H.week,0,53,"week")){this.setWeek(H.week);}return this;};A.moveToFirstDayOfMonth=function(){return this.set({day:1});};A.moveToLastDayOfMonth=function(){return this.set({day:B.getDaysInMonth(this.getFullYear(),this.getMonth())});};A.moveToNthOccurrence=function(I,J){var H=0;if(J>0){H=J-1;}else{if(J===-1){this.moveToLastDayOfMonth();if(this.getDay()!==I){this.moveToDayOfWeek(I,-1);}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(I,+1).addWeeks(H);};A.moveToDayOfWeek=function(H,I){var J=(H-this.getDay()+7*(I||+1))%7;return this.addDays((J===0)?J+=7*(I||+1):J);};A.moveToMonth=function(J,H){var I=(J-this.getMonth()+12*(H||+1))%12;return this.addMonths((I===0)?I+=12*(H||+1):I);};A.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};A.getTimezone=function(){return B.getTimezoneAbbreviation(this.getUTCOffset());};A.setTimezoneOffset=function(J){var H=this.getTimezoneOffset(),I=Number(J)*-6/10;return this.addMinutes(I-H);};A.setTimezone=function(H){return this.setTimezoneOffset(B.getTimezoneOffset(H));};A.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};A.isDaylightSavingTime=function(){return(this.hasDaylightSavingTime()&&new Date().getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset());};A.getUTCOffset=function(){var I=this.getTimezoneOffset()*-10/6,H;if(I<0){H=(I-10000).toString();return H.charAt(0)+H.substr(2);}else{H=(I+10000).toString();return"+"+H.substr(1);}};A.getElapsed=function(H){return(H||new Date())-this;};if(!A.toISOString){A.toISOString=function(){function H(I){return I<10?"0"+I:I;}return'"'+this.getUTCFullYear()+"-"+H(this.getUTCMonth()+1)+"-"+H(this.getUTCDate())+"T"+H(this.getUTCHours())+":"+H(this.getUTCMinutes())+":"+H(this.getUTCSeconds())+'Z"';};}A._toString=A.toString;A.toString=function(J){var H=this;if(J&&J.length==1){var K=D.formatPatterns;H.t=H.toString;switch(J){case"d":return H.t(K.shortDate);case"D":return H.t(K.longDate);case"F":return H.t(K.fullDateTime);case"m":return H.t(K.monthDay);case"r":return H.t(K.rfc1123);case"s":return H.t(K.sortableDateTime);case"t":return H.t(K.shortTime);case"T":return H.t(K.longTime);case"u":return H.t(K.universalSortableDateTime);case"y":return H.t(K.yearMonth);}}var I=function(L){switch(L*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return J?J.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(L){if(L.charAt(0)==="\\"){return L.replace("\\","");}H.h=H.getHours;switch(L){case"hh":return G(H.h()<13?(H.h()===0?12:H.h()):(H.h()-12));case"h":return H.h()<13?(H.h()===0?12:H.h()):(H.h()-12);case"HH":return G(H.h());case"H":return H.h();case"mm":return G(H.getMinutes());case"m":return H.getMinutes();case"ss":return G(H.getSeconds());case"s":return H.getSeconds();case"yyyy":return G(H.getFullYear(),4);case"yy":return G(H.getFullYear());case"dddd":return D.dayNames[H.getDay()];case"ddd":return D.abbreviatedDayNames[H.getDay()];case"dd":return G(H.getDate());case"d":return H.getDate();case"MMMM":return D.monthNames[H.getMonth()];case"MMM":return D.abbreviatedMonthNames[H.getMonth()];case"MM":return G((H.getMonth()+1));case"M":return H.getMonth()+1;case"t":return H.h()<12?D.amDesignator.substring(0,1):D.pmDesignator.substring(0,1);case"tt":return H.h()<12?D.amDesignator:D.pmDesignator;case"S":return I(H.getDate());default:return L;}}):this._toString();};}());(function(){var Q=Date,G=Q.prototype,R=Q.CultureInfo,K=Number.prototype;G._orient=+1;G._nth=null;G._is=false;G._same=false;G._isSecond=false;K._dateElement="day";G.next=function(){this._orient=+1;return this;};Q.next=function(){return Q.today().next();};G.last=G.prev=G.previous=function(){this._orient=-1;return this;};Q.last=Q.prev=Q.previous=function(){return Q.today().last();};G.is=function(){this._is=true;return this;};G.same=function(){this._same=true;this._isSecond=false;return this;};G.today=function(){return this.same().day();};G.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}return false;};G.at=function(V){return(typeof V==="string")?Q.parse(this.toString("d")+" "+V):this.set(V);};K.fromNow=K.after=function(V){var W={};W[this._dateElement]=this;return((!V)?new Date():V.clone()).add(W);};K.ago=K.before=function(V){var W={};W[this._dateElement]=this*-1;return((!V)?new Date():V.clone()).add(W);};var E=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),H=("january february march april may june july august september october november december").split(/\s/),J=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),L=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),B=("final first second third fourth fifth").split(/\s/),T;G.toObject=function(){var W={};for(var V=0;V<J.length;V++){W[J[V].toLowerCase()]=this["get"+L[V]]();}return W;};Q.fromObject=function(V){V.week=null;return Date.today().set(V);};var S=function(V){return function(){if(this._is){this._is=false;return this.getDay()==V;}if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}this._isSecond=false;var X=this._nth;this._nth=null;var W=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(V,X);if(this>W){throw new RangeError(Q.getDayName(V)+" does not occur "+X+" times in the month of "+Q.getMonthName(W.getMonth())+" "+W.getFullYear()+".");}return this;}return this.moveToDayOfWeek(V,this._orient);};};var F=function(V){return function(){var X=Q.today(),W=V-X.getDay();if(V===0&&R.firstDayOfWeek===1&&X.getDay()!==0){W=W+7;}return X.addDays(W);};};for(var P=0;P<E.length;P++){Q[E[P].toUpperCase()]=Q[E[P].toUpperCase().substring(0,3)]=P;Q[E[P]]=Q[E[P].substring(0,3)]=F(P);G[E[P]]=G[E[P].substring(0,3)]=S(P);}var U=function(V){return function(){if(this._is){this._is=false;return this.getMonth()===V;}return this.moveToMonth(V,this._orient);};};var I=function(V){return function(){return Q.today().set({month:V,day:1});};};for(var O=0;O<H.length;O++){Q[H[O].toUpperCase()]=Q[H[O].toUpperCase().substring(0,3)]=O;Q[H[O]]=Q[H[O].substring(0,3)]=I(O);G[H[O]]=G[H[O].substring(0,3)]=U(O);}var C=function(V){return function(){if(this._isSecond){this._isSecond=false;return this;}if(this._same){this._same=this._is=false;var a=this.toObject(),Z=(arguments[0]||new Date()).toObject(),Y="",X=V.toLowerCase();for(var W=(J.length-1);W>-1;W--){Y=J[W].toLowerCase();if(a[Y]!=Z[Y]){return false;}if(X==Y){break;}}return true;}if(V.substring(V.length-1)!="s"){V+="s";}return this["add"+V](this._orient);};};var D=function(V){return function(){this._dateElement=V;return this;};};for(var N=0;N<J.length;N++){T=J[N].toLowerCase();G[T]=G[T+"s"]=C(J[N]);K[T]=K[T+"s"]=D(T);}G._ss=C("Second");var A=function(V){return function(W){if(this._same){return this._ss(arguments[0]);}if(W||W===0){return this.moveToNthOccurrence(W,V);}this._nth=V;if(V===2&&(W===undefined||W===null)){this._isSecond=true;return this.addSeconds(this._orient);}return this;};};for(var M=0;M<B.length;M++){G[B[M]]=(M===0)?A(-1):A(M);}}());(function(){Date.Parsing={Exception:function(I){this.message="Parse error at '"+I.substring(0,10)+" ...'";}};var A=Date.Parsing;var C=A.Operators={rtoken:function(I){return function(J){var K=J.match(I);if(K){return([K[0],J.substring(K[0].length)]);}else{throw new A.Exception(J);}};},token:function(I){return function(J){return C.rtoken(new RegExp("^s*"+J+"s*"))(J);};},stoken:function(I){return C.rtoken(new RegExp("^"+I));},until:function(I){return function(J){var K=[],M=null;while(J.length){try{M=I.call(this,J);}catch(L){K.push(M[0]);J=M[1];continue;}break;}return[K,J];};},many:function(I){return function(J){var M=[],K=null;while(J.length){try{K=I.call(this,J);}catch(L){return[M,J];}M.push(K[0]);J=K[1];}return[M,J];};},optional:function(I){return function(J){var K=null;try{K=I.call(this,J);}catch(L){return[null,J];}return[K[0],K[1]];};},not:function(I){return function(J){try{I.call(this,J);}catch(K){return[null,J];}throw new A.Exception(J);};},ignore:function(I){return I?function(J){var K=null;K=I.call(this,J);return[null,K[1]];}:null;},product:function(){var J=arguments[0],K=Array.prototype.slice.call(arguments,1),L=[];for(var I=0;I<J.length;I++){L.push(C.each(J[I],K));}return L;},cache:function(K){var I={},J=null;return function(L){try{J=I[L]=(I[L]||K.call(this,L));}catch(M){J=I[L]=M;}if(J instanceof A.Exception){throw J;}else{return J;}};},any:function(){var I=arguments;return function(K){var L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){L=null;}if(L){return L;}}throw new A.Exception(K);};},each:function(){var I=arguments;return function(K){var N=[],L=null;for(var J=0;J<I.length;J++){if(I[J]==null){continue;}try{L=(I[J].call(this,K));}catch(M){throw new A.Exception(K);}N.push(L[0]);K=L[1];}return[N,K];};},all:function(){var J=arguments,I=I;return I.each(I.optional(J));},sequence:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;if(I.length==1){return I[0];}return function(O){var P=null,Q=null;var S=[];for(var N=0;N<I.length;N++){try{P=I[N].call(this,O);}catch(R){break;}S.push(P[0]);try{Q=J.call(this,P[1]);}catch(M){Q=null;break;}O=Q[1];}if(!P){throw new A.Exception(O);}if(Q){throw new A.Exception(Q[1]);}if(K){try{P=K.call(this,P[1]);}catch(L){throw new A.Exception(P[1]);}}return[S,(P?P[1]:O)];};},between:function(J,K,I){I=I||J;var L=C.each(C.ignore(J),K,C.ignore(I));return function(M){var N=L.call(this,M);return[[N[0][0],r[0][2]],N[1]];};},list:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return(I instanceof Array?C.each(C.product(I.slice(0,-1),C.ignore(J)),I.slice(-1),C.ignore(K)):C.each(C.many(C.each(I,C.ignore(J))),px,C.ignore(K)));},set:function(I,J,K){J=J||C.rtoken(/^\s*/);K=K||null;return function(X){var L=null,N=null,M=null,O=null,P=[[],X],W=false;for(var R=0;R<I.length;R++){M=null;N=null;L=null;W=(I.length==1);try{L=I[R].call(this,X);}catch(U){continue;}O=[[L[0]],L[1]];if(L[1].length>0&&!W){try{M=J.call(this,L[1]);}catch(V){W=true;}}else{W=true;}if(!W&&M[1].length===0){W=true;}if(!W){var S=[];for(var Q=0;Q<I.length;Q++){if(R!=Q){S.push(I[Q]);}}N=C.set(S,J).call(this,M[1]);if(N[0].length>0){O[0]=O[0].concat(N[0]);O[1]=N[1];}}if(O[1].length<P[1].length){P=O;}if(P[1].length===0){break;}}if(P[0].length===0){return P;}if(K){try{M=K.call(this,P[1]);}catch(T){throw new A.Exception(P[1]);}P[1]=M[1];}return P;};},forward:function(I,J){return function(K){return I[J].call(this,K);};},replace:function(J,I){return function(K){var L=J.call(this,K);return[I,L[1]];};},process:function(J,I){return function(K){var L=J.call(this,K);return[I.call(this,L[0]),L[1]];};},min:function(I,J){return function(K){var L=J.call(this,K);if(L[0].length<I){throw new A.Exception(K);}return L;};}};var H=function(I){return function(){var J=null,M=[];if(arguments.length>1){J=Array.prototype.slice.call(arguments);}else{if(arguments[0] instanceof Array){J=arguments[0];}}if(J){for(var L=0,K=J.shift();L<K.length;L++){J.unshift(K[L]);M.push(I.apply(null,J));J.shift();return M;}}else{return I.apply(null,arguments);}};};var G="optional not ignore cache".split(/\s/);for(var D=0;D<G.length;D++){C[G[D]]=H(C[G[D]]);}var F=function(I){return function(){if(arguments[0] instanceof Array){return I.apply(null,arguments[0]);}else{return I.apply(null,arguments);}};};var E="each any all".split(/\s/);for(var B=0;B<E.length;B++){C[E[B]]=F(C[E[B]]);}}());(function(){var E=Date,K=E.prototype,F=E.CultureInfo;var G=function(M){var N=[];for(var L=0;L<M.length;L++){if(M[L] instanceof Array){N=N.concat(G(M[L]));}else{if(M[L]){N.push(M[L]);}}}return N;};E.Grammar={};E.Translator={hour:function(L){return function(){this.hour=Number(L);};},minute:function(L){return function(){this.minute=Number(L);};},second:function(L){return function(){this.second=Number(L);};},meridian:function(L){return function(){this.meridian=L.slice(0,1).toLowerCase();};},timezone:function(L){return function(){var M=L.replace(/[^\d\+\-]/g,"");if(M.length){this.timezoneOffset=Number(M);}else{this.timezone=L.toLowerCase();}};},day:function(L){var M=L[0];return function(){this.day=Number(M.match(/\d+/)[0]);};},month:function(L){return function(){this.month=(L.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(L)/4:Number(L)-1;};},year:function(L){return function(){var M=Number(L);this.year=((L.length>2)?M:(M+(((M+2000)<F.twoDigitYearMax)?2000:1900)));};},rday:function(L){return function(){switch(L){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(L){L=(L instanceof Array)?L:[L];for(var N=0;N<L.length;N++){if(L[N]){L[N].call(this);}}var M=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=M.getDate();}if(!this.year){this.year=M.getFullYear();}if(!this.month&&this.month!==0){this.month=M.getMonth();}if(!this.day){this.day=1;}if(!this.hour){this.hour=0;}if(!this.minute){this.minute=0;}if(!this.second){this.second=0;}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.day>E.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}var O=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){O.set({timezone:this.timezone});}else{if(this.timezoneOffset){O.set({timezoneOffset:this.timezoneOffset});}}return O;},finish:function(L){L=(L instanceof Array)?G(L):[L];if(L.length===0){return null;}for(var Q=0;Q<L.length;Q++){if(typeof L[Q]=="function"){L[Q].call(this);}}var N=E.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else{if(this.now){N=new Date();}}var R=!!(this.days&&this.days!==null||this.orient||this.operator);var S,P,O;O=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){N.setTimeToNow();}if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;R=true;}}if(!R&&this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(!this.month){this.month=M.getMonth();}this.year=M.getFullYear();}if(R&&this.weekday&&this.unit!="month"){this.unit="day";S=(E.getDayNumberFromName(this.weekday)-N.getDay());P=7;this.days=S?((S+(O*P))%P):(O*P);}if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}if(this.month&&!this.day&&this.value){N.set({day:this.value*1});if(!R){this.day=this.value*1;}}if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;R=true;}if(R&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";S=(this.month-N.getMonth());P=12;this.months=S?((S+(O*P))%P):(O*P);this.month=null;}if(!this.unit){this.unit="day";}if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*O;}else{if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}this[this.unit+"s"]=this.value*O;}}if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else{if(this.meridian=="a"&&this.hour==12){this.hour=0;}}}if(this.weekday&&!this.day&&!this.days){var M=Date[this.weekday]();this.day=M.getDate();if(M.getMonth()!==N.getMonth()){this.month=M.getMonth();}}if((this.month||this.month===0)&&!this.day){this.day=1;}if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}if(R&&this.timezone&&this.day&&this.days){this.day=this.days;}return(R)?N.add(this):N.set(this);}};var H=E.Parsing.Operators,D=E.Grammar,J=E.Translator,B;D.datePartDelimiter=H.rtoken(/^([\s\-\.\,\/\x27]+)/);D.timePartDelimiter=H.stoken(":");D.whiteSpace=H.rtoken(/^\s*/);D.generalDelimiter=H.rtoken(/^(([\s\,]|at|@|on)+)/);var A={};D.ctoken=function(P){var O=A[P];if(!O){var Q=F.regexPatterns;var N=P.split(/\s+/),M=[];for(var L=0;L<N.length;L++){M.push(H.replace(H.rtoken(Q[N[L]]),N[L]));}O=A[P]=H.any.apply(null,M);}return O;};D.ctoken2=function(L){return H.rtoken(F.regexPatterns[L]);};D.h=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),J.hour));D.hh=H.cache(H.process(H.rtoken(/^(0[0-9]|1[0-2])/),J.hour));D.H=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),J.hour));D.HH=H.cache(H.process(H.rtoken(/^([0-1][0-9]|2[0-3])/),J.hour));D.m=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.minute));D.mm=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.minute));D.s=H.cache(H.process(H.rtoken(/^([0-5][0-9]|[0-9])/),J.second));D.ss=H.cache(H.process(H.rtoken(/^[0-5][0-9]/),J.second));D.hms=H.cache(H.sequence([D.H,D.m,D.s],D.timePartDelimiter));D.t=H.cache(H.process(D.ctoken2("shortMeridian"),J.meridian));D.tt=H.cache(H.process(D.ctoken2("longMeridian"),J.meridian));D.z=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zz=H.cache(H.process(H.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),J.timezone));D.zzz=H.cache(H.process(D.ctoken2("timezone"),J.timezone));D.timeSuffix=H.each(H.ignore(D.whiteSpace),H.set([D.tt,D.zzz]));D.time=H.each(H.optional(H.ignore(H.stoken("T"))),D.hms,D.timeSuffix);D.d=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1]|\d)/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.dd=H.cache(H.process(H.each(H.rtoken(/^([0-2]\d|3[0-1])/),H.optional(D.ctoken2("ordinalSuffix"))),J.day));D.ddd=D.dddd=H.cache(H.process(D.ctoken("sun mon tue wed thu fri sat"),function(L){return function(){this.weekday=L;};}));D.M=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d|\d)/),J.month));D.MM=H.cache(H.process(H.rtoken(/^(1[0-2]|0\d)/),J.month));D.MMM=D.MMMM=H.cache(H.process(D.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),J.month));D.y=H.cache(H.process(H.rtoken(/^(\d\d?)/),J.year));D.yy=H.cache(H.process(H.rtoken(/^(\d\d)/),J.year));D.yyy=H.cache(H.process(H.rtoken(/^(\d\d?\d?\d?)/),J.year));D.yyyy=H.cache(H.process(H.rtoken(/^(\d\d\d\d)/),J.year));B=function(){return H.each(H.any.apply(null,arguments),H.not(D.ctoken2("timeContext")));};D.day=B(D.d,D.dd);D.month=B(D.M,D.MMM);D.year=B(D.yyyy,D.yy);D.orientation=H.process(D.ctoken("past future"),function(L){return function(){this.orient=L;};});D.operator=H.process(D.ctoken("add subtract"),function(L){return function(){this.operator=L;};});D.rday=H.process(D.ctoken("yesterday tomorrow today now"),J.rday);D.unit=H.process(D.ctoken("second minute hour day week month year"),function(L){return function(){this.unit=L;};});D.value=H.process(H.rtoken(/^\d\d?(st|nd|rd|th)?/),function(L){return function(){this.value=L.replace(/\D/g,"");};});D.expression=H.set([D.rday,D.operator,D.value,D.unit,D.orientation,D.ddd,D.MMM]);B=function(){return H.set(arguments,D.datePartDelimiter);};D.mdy=B(D.ddd,D.month,D.day,D.year);D.ymd=B(D.ddd,D.year,D.month,D.day);D.dmy=B(D.ddd,D.day,D.month,D.year);D.date=function(L){return((D[F.dateElementOrder]||D.mdy).call(this,L));};D.format=H.process(H.many(H.any(H.process(H.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(L){if(D[L]){return D[L];}else{throw E.Parsing.Exception(L);}}),H.process(H.rtoken(/^[^dMyhHmstz]+/),function(L){return H.ignore(H.stoken(L));}))),function(L){return H.process(H.each.apply(null,L),J.finishExact);});var I={};var C=function(L){return I[L]=(I[L]||D.format(L)[0]);};D.formats=function(M){if(M instanceof Array){var N=[];for(var L=0;L<M.length;L++){N.push(C(M[L]));}return H.any.apply(null,N);}else{return C(M);}};D._formats=D.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);D._start=H.process(H.set([D.date,D.time,D.expression],D.generalDelimiter,D.whiteSpace),J.finish);D.start=function(L){try{var M=D._formats.call({},L);if(M[1].length===0){return M;}}catch(N){}return D._start.call({},L);};E._parse=E.parse;E.parse=function(L){var M=null;if(!L){return null;}if(L instanceof Date){return L;}try{M=E.Grammar.start.call({},L.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(N){return null;}return((M[1].length===0)?M[0]:null);};E.getParseFunction=function(M){var L=E.Grammar.formats(M);return function(N){var O=null;try{O=L.call({},N);}catch(P){return null;}return((O[1].length===0)?O[0]:null);};};E.parseExact=function(L,M){return E.getParseFunction(M)(L);};}());}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B="PWDHIDDEN123!@#",A=mstrmojo.warehouse.EnumDatabaseType;mstrmojo.DI.DIRemoteProjectDBRole=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRemoteProjectDBRole",init:function D(F){var E=this.mdDBRole;E.n="Project Source Name";E.des="Remote project source name";E.dbr_type="5";E.stp=7424;E.owned="1";E.writable="1";E.tp=5;E.db_type=5;E.db_version=218;E.dbms="00000000000000000000000000000000";E.odbcv="";E.cefu="1";},mdDBRole:{},n:"",did:"",tp:5,data:undefined,populated:false,populate:function C(F){var E=this;if(this.populated){F(E);}else{mstrApp.getRootController().getDataService().populateDBRoles({success:function(G){E.populated=true;E.mdDBRole=G.dbrs[0];E.n=E.mdDBRole.n.toString();E.did=E.mdDBRole.did;F(E);}},{objectID:this.mdDBRole.did});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.SliderWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.SliderWidget",sliderNode:null,options:null,range:{min:0,max:1,step:1,from:0,to:0},drag:null,postCreate:function(){var A=this;this._mouseMoveHandler=function(B){return A._onMouseMove(B);};this._mouseUpHandler=function(B){return A._onMouseUp(B);};this.initializeUI();this.updateRange();},initializeUI:function(){var A=this;this.leftTintedRect=document.createElement("div");this.leftTintedRect.className="slider-widget-tint left";this.sliderNode.appendChild(this.leftTintedRect);this.rightTintedRect=document.createElement("div");this.rightTintedRect.className="slider-widget-tint right";this.sliderNode.appendChild(this.rightTintedRect);this.highlightRect=document.createElement("div");this.highlightRect.className="slider-widget-highlight slider-widget-draggable";this.highlightRect.setAttribute("part","highlight");this.sliderNode.appendChild(this.highlightRect);this.highlightRect.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.leftBracket=document.createElement("div");this.leftBracket.className="slider-widget-bracket slider-widget-draggable left";this.leftBracket.setAttribute("part","left");this.sliderNode.appendChild(this.leftBracket);this.leftBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);this.rightBracket=document.createElement("div");this.rightBracket.className="slider-widget-bracket slider-widget-draggable right";this.rightBracket.setAttribute("part","right");this.sliderNode.appendChild(this.rightBracket);this.rightBracket.addEventListener("mousedown",function(B){return A._onMouseDown(B,this.getAttribute("part"));},false);},_onMouseDown:function(A,C){if(this.drag){return ;}document.addEventListener("mousemove",this._mouseMoveHandler,false);document.addEventListener("mouseup",this._mouseUpHandler,false);var B=document.createElement("div");B.className="slider-widget-overlay";document.body.appendChild(B);this.drag={sureDrag:false,overlay:B};if("highlight"===C){this.drag.elmt=this.highlightRect;this.drag.value=this.range.from;this.drag.overlay.style.cursor="move";}else{if("left"===C){this.drag.elmt=this.leftBracket;this.drag.overlay.style.cursor="e-resize";}else{if("right"===C){this.drag.elmt=this.rightBracket;this.drag.overlay.style.cursor="w-resize";}}}this.drag.what=C;this.drag.from=this.range.from;this.drag.to=this.range.to;this.drag.down={x:A.pageX,y:A.pageY};},_onMouseUp:function(){if(!(this.drag)){return ;}document.removeEventListener("mousemove",this._mouseMoveHandler,false);document.removeEventListener("mouseup",this._mouseUpHandler,false);if(this.drag.sureDrag){this.updateRange();this.trigger("stop");}document.body.removeChild(this.drag.overlay);this.drag=null;},_onMouseMove:function(H){if(!(this.drag)){return true;}var C=this.drag;var D=this.range;var F=H.pageX-C.down.x;if(Math.abs(F)>=2){C.sureDrag=true;}var E=this.sliderNode.clientWidth;var A=E/(D.max-D.min);var I=F/A;var G=function(){D.from=C.from+Math.floor(I/D.step)*D.step;D.from=Math.max(Math.min(D.from,D.max),D.min);};var B=function(){D.to=C.to+Math.floor(I/D.step)*D.step;D.to=Math.max(Math.min(D.to,D.max),D.min);};if(C.what==="left"){G();D.to=Math.min(Math.max(D.to,D.from+D.step),D.max);}else{if(C.what==="right"){B();D.from=Math.max(Math.min(D.from,D.to-D.step),D.min);}else{G();B();}}this.updateRange();this.trigger("slide");H.preventDefault();return false;},trigger:function(A){this.parent.raiseEvent({name:A,from:this.range.from,to:this.range.to});},updateRange:function(){var A=this.range;var F=this.sliderNode.clientWidth;var E=F/(A.max-A.min);var B=function(G){return(G-A.min)*E;};var C=Math.floor(B(A.from));var D=Math.floor(B(A.to));if(A.from===A.min&&A.to===A.max){this.leftTintedRect.style.display="none";this.rightTintedRect.style.display="none";}else{this.leftTintedRect.style.display="block";this.leftTintedRect.style.width=C+"px";this.rightTintedRect.style.display="block";this.rightTintedRect.style.width=(F-D)+"px";}this.highlightRect.style.width=(D-C)+"px";this.highlightRect.style.left=C+"px";this.leftBracket.style.left=C+"px";this.rightBracket.style.left=D+"px";},update:function(B,A,C,E,D){if(C<=0){C=1;}A=Math.max(A,B+C);E=E!==null?Math.max(B,E):B;D=D!==null?Math.min(A,D):A;this.range={min:B,max:A,step:C,from:E,to:D};this.updateRange();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.Refine.HistogramWidget=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Refine.HistogramWidget",options:null,binMatrix:null,range:null,markupString:"<canvas></canvas>",update:function(D,A,E,F){if(D===undefined||A===undefined||F.length===0||F[0].length===0){this.range=null;this.binMatrix=null;this.parent.histogramNode.style.display="none";}else{this.range={min:D,max:A,step:E};this.binMatrix=F;this.peak=0;var C,B;for(C=0;C<F.length;C++){var G=F[C];for(B=0;B<G.length;B++){this.peak=Math.max(this.peak,G[B]);}}}if(this.binMatrix!==null){this.parent.histogramNode.style.display="block";this.resize();this._render();}},resize:function(){var A=this.options.height||(this.parent.hasOtherChoices()?54:73);this.domNode.height=A;this.domNode.width=this.parent.histogramNode.clientWidth;this.parent.histogramNode.style.height=A+"px";},_render:function(){var D=this;var F=this.options;var E=this.domNode;var B=E.getContext("2d");B.fillStyle="white";B.fillRect(0,0,E.width,E.height);B.save();B.translate(0,E.height);B.scale(1,-1);var G=E.width/this.binMatrix[0].length;B.save();B.strokeStyle=F.emptyBinColor||"#faa";B.lineWidth=1;B.moveTo(0,0);B.lineTo(E.width,0);B.stroke();B.restore();var A=function(I){var K=Math.floor(15*(D.binMatrix.length-I)/D.binMatrix.length);var J=K.toString(16);return"#"+J+J+J;};var C=function(M,J,P){B.save();B.lineWidth=0;B.fillStyle=J;B.strokeStyle=P;var O;for(O=0;O<M.length;O++){var N=M[O];if(N>0){var L=O*G;var K=Math.ceil(G);var I=Math.max(2,Math.ceil(N*E.height/D.peak));B.fillRect(L,0,K,I);B.strokeRect(L,0,K,I);}}B.restore();};var H;for(H=0;H<this.binMatrix.length;H++){C(this.binMatrix[H],F.hasOwnProperty("binBorderColors")&&H<F.binColors.length?F.binColors[H]:A(H),F.hasOwnProperty("binBorderColors")&&H<F.binBorderColors.length?F.binBorderColors[H]:A(H));}B.restore();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ServerProxy");mstrmojo.DI.WorkstationServerProxy=mstrmojo.declare(mstrmojo.ServerProxy,null,{workstationEnv:null,createRequest:function(B,D,C,A){return this._super(B,D,C,A);},serverRequestParallel:function(C,D,A){var B=mstrmojo.hash.copy(C);B.taskContentType=B.taskContentType||"json";B.taskEnv=B.taskEnv||"xhr";this.request(D,C,false,{});},upload:function(J,E,G,D,B,C,A){if(G===null){this.request(J,E,G,D);}else{var H=new FileReader();var I=this;var F=function(){H.onload=null;};if(!this.fileReaderUnloader){this.fileReaderUnloader={};}this.fileReaderUnloader[E.tableID]=F;H.onload=function(K){E.myFile=K.target.result.split("base64,")[1];I.request(J,E,G,D);};H.readAsDataURL(G);}},cancelFileReader:function(C){var B=this.fileReaderUnloader||{};var A=B[C];if(A){A();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.base64","mstrmojo.SimpleXHR","mstrmojo.XHRServerTransport","mstrmojo.DI.WorkstationServerProxy");mstrmojo.requiresDescs(15068);var B="DI.WorkstationServerTransport";var C=mstrmojo.hash;var E=mstrmojo.desc(15068,"Server internal error");mstrmojo.DI.WorkstationServerTransport={serverRequest:function A(H,G,F){if(F.params.taskId==="openNativeWindow"){window.FormWrapper.openNativeWindow(JSON.stringify(F.params),F.params.windowType,G,H);}else{F.params.DITask="1";window.FormWrapper.serverDIRequest(G,JSON.stringify(F.params),H,"response");}},cancelRequest:function D(F){return false;},};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.array","mstrmojo.Refine.DateTimeUtil","mstrmojo.Refine.RefineHelpers","mstrmojo.string");mstrmojo.requiresDescs(221,12366,2164,13188,14517);var A=mstrmojo.dom;var D=mstrmojo.array;var F=mstrmojo.Refine.DateTimeUtil;function C(G){return !isNaN(parseFloat(G))&&isFinite(G);}mstrmojo.Refine.PopupEditBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.PopupEditBox",text:"",value:"",top:0,left:0,markupString:'<div id="{@id}" class="refine-cell-editor {@cssClass}" style="top: {@top}; left: {@left};" mstrAttach:click,keydown><div class="refine-menu-overlay"></div><div class="refine-menu-container" style="width: {@width};"><div class="refine-cell-editor-text"></div><div class="refine-cell-editor-actions"><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div><div class="refine-cell-editor-action"></div></div></div></div>',markupSlots:{overlayNode:function(){return this.domNode.firstChild;},autoNode:function(){return this.domNode.lastChild.childNodes[0];},buttonNode:function(){return this.domNode.lastChild.lastChild;},applyToAllNode:function(){return this.domNode.lastChild.lastChild.childNodes[2];},applyNode:function(){return this.domNode.lastChild.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild.childNodes[0];}},children:[{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply-to-all",title:mstrmojo.desc(12366,"Apply To All")+" (Enter)",slot:"applyToAllNode",onclick:function(){this.parent.applyToAll();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-apply",title:mstrmojo.desc(2164,"Apply")+" (Ctrl + Enter)",slot:"applyNode",alias:"applyButton",bindings:{visible:function(){return(!this.parent.fromFacet)&&(!mstrApp.getRootController().refineApp.isBDE);}},onclick:function(){this.parent.apply();this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}},{scriptClass:"mstrmojo.Button",cssClass:"refine-cell-editor-cancel",title:mstrmojo.desc(221,"Cancel"),alias:"cancel",slot:"cancelNode",onclick:function(){this.hideTooltip();this.parent.destroy();},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var G=A.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+30,0),left:Math.max(G.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}}],applyToAll:function(){var K=this.autoNode.childNodes[0].childNodes[2].value;if(String(this.text)!==K){var M=this.preview.controller;var L=M.model;var I=this.columnName;var G=[],J,O;var H="yyyy-MM-ddTHH:mm:ssZ";var N=this.type;J=JSON.parse(JSON.stringify(L.transformations.EditCell.applyToAll));J.description=J.description.replace("[column name]",I);J.columnName=I;J.edits[0].to=K;if(this.type==="number"){if(!C(K)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}O=parseFloat(K);J.edits[0].to=O;}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){O=Date.parse(K);if(!O){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date"));return ;}J.edits[0].to=K;N="date";}}if(this.text===""||(this.text==="(blank)"&&this.blankChoice)){J.edits[0].fromBlank=true;J.edits[0].from[0]="";}else{J.edits[0].from[0]=this.value||this.text;}J.edits[0].type=N;if(!this.fromFacet){J.engineConfig=JSON.parse(L.engine);}G.push(J);this.preview.controller.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});}},apply:function(){var M=this.autoNode.childNodes[0].childNodes[2].value;if(this.text.toString()!==M){var H=this.preview.controller;var K=H.model;var J=[],I,L;var G="yyyy-MM-ddTHH:mm:ssZ";I=JSON.parse(JSON.stringify(K.transformations.EditCell.singleEdit));I.description=I.description.replace("####",this.row);I.description=I.description.replace("####",this.cell);I.row=this.row;I.col=this.cell;L=M;if(this.type==="number"){if(!C(M)){mstrmojo.alert(mstrmojo.desc(13188,"Not a valid Number. Convert data type of column to Text"));return ;}L=parseFloat(M);}else{if(this.type==="date"||this.type==="time"||this.type==="datetime"){L=Date.parse(M);if(!L){mstrmojo.alert(mstrmojo.desc(14517,"Not a valid Date."));return ;}L=M;}}I.to=L;I.description=I.description.replace("####",L);J.push(I);this.preview.controller.applyOperations({operations:JSON.stringify(J),engine:JSON.stringify({facets:[],mode:"row-based"})});}},onclick:function(G){var I=G.e,H=A.eventTarget(G.hWin,I);if(H===this.overlayNode){this.destroy();}},prekeydown:function(H){var K=H.e,I=K.keyCode||K.charCode,G=this.preview.controller,J=G.model;if(K.ctrlKey&&I===mstrmojo.Enum_Keys.ENTER){if(!this.fromFacet&&!J.hasAddSample()){this.apply();this.destroy();}}else{if(I===mstrmojo.Enum_Keys.ENTER){this.applyToAll();this.destroy();}else{if(I===mstrmojo.Enum_Keys.ESCAPE){this.destroy();}}}},preBuildRendering:function B(){var G=this.preview.controller,H=G.model;this.placeholder=document.body.appendChild(document.createElement("div"));if(H.hasAddSample()){this.applyButton.set("visible",false);}return this._super();},postBuildRendering:function E(){this._super();this.autoNode.style.width=(parseInt(this.width)-(this.fromFacet?43:88))+"px";if(this.floatLeft){this.autoNode.style["float"]="left";this.autoNode.style.marginRight="3px";this.buttonNode.style["float"]="left";}else{this.autoNode.style["float"]="right";this.autoNode.style.marginLeft="3px";this.buttonNode.style["float"]="right";}var I=this;var M=mstrmojo.Refine.RefineHelpers.completely(this.autoNode,{bottom:(this.fromFacet?14:16),top:(this.fromFacet?15:17),left:(this.fromFacet?0:10),fontSize:"8pt",fontFamily:"monospace",width:(parseInt(this.width)-(this.fromFacet?43:77))});setTimeout(function(){M.input.focus();M.setText(I.text);M.input.select();M.repaint();},0);var H={facets:[{type:"list",name:this.columnName,columnName:this.columnName,expression:"value",omitBlank:false,omitError:false,selection:[],selectBlank:false,selectError:false,invert:false}],mode:"row-based"};var G=[];var L={success:function(O){var P=O.facets[0].choices,N;if(P){for(N=0;N<P.length;N++){G.push(P[N].v.l);}}G.sort(function(R,Q){return R.localeCompare(Q);});M.options=G;setTimeout(function(){M.repaint();},0);}};var K={engine:JSON.stringify(H)};var J={project:this.preview.controller.model.projectID};this.preview.controller.dataService.computeFacetsQuiet(L,J,K);return true;},destroy:function(){D.forEach(this.children,function(G){if(G.hasOpenTooltip){G.hideTooltip();}},this);this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.css,G=mstrmojo.dom;mstrmojo.Refine.RefineTagBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Refine.RefineTagBox",markupString:'<div id="{@id}" class="refine-tag-box-container {@cssClass}" style="{@cssText}"><div class="refine-tag-box"></div></div>',markupSlots:{boxNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function C(){var H={scriptClass:"mstrmojo.Refine.RefineTagBoxNew",slot:"boxNode"};this.inputBox=this.addChildren(H);return this._super();},setupScrollNodes:function D(){this.scrollNode=this.boxNode;},onaddChild:function B(){if(this.children.length>1){this.inputBox.input.emptyText="";A.toggleClass(this.inputBox.input.domNode,"short",true);}},onremoveChild:function(H){var J=H.value;for(var I=0;I<J.length;I++){J[I].destroy();}this.updateScrollbars();if(this.children.length===1){this.inputBox.input.emptyText=mstrmojo.desc(14518,"Press Enter Key to input multiple keywords");A.toggleClass(this.inputBox.input.domNode,"short",false);}},removeTags:function E(){for(var H=this.children.length-2;H>=0;H--){this.removeChildren(this.children[H]);}}});mstrmojo.Refine.RefineTagBoxNew=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxNew",markupString:'<div id="{@id}" class="refine-tag-box-new {@cssClass}" style="{@cssText}" mstrAttach:keydown></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},children:[{scriptClass:"mstrmojo.TextBox",alias:"input",slot:"domNode",cssClass:"refine-tag-box-new-input",useRichTooltip:true,tooltipOpenDelay:0,updateTooltipConfig:function(){var H=this.domNode.clientHeight;this.set("richTooltip",{refNode:this.domNode,cssClass:"vi-regular vi-tooltip-A",top:H,posType:mstrmojo.tooltip.POS_TOPLEFT,content:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords"),});},emptyText:mstrmojo.desc(14518,"Press Enter Key to input multiple keywords")}],onkeydown:function F(L){var H=13;var J=8;var I={scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",slot:"boxNode"};if(L.e.keyCode===H){if(this.input.value){I.text=this.input.value;this.input.set("value","");this.parent.addChildren([I],this.parent.children.length-1);this.parent.updateScrollbars();}}else{if(L.e.keyCode===J&&this.input.value===""){var K=this.parent.children.length;if(K>1){var M=this.parent.children[K-2];this.parent.removeChildren(M);}}}}});mstrmojo.Refine.RefineTagBoxLabel=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineTagBoxLabel",markupString:'<div id="{@id}" class="refine-tag-box-label {@cssClass}" style="{@cssText}"><span class="refine-tag-box-label-text">{@text}</span><a class="refine-tag-box-close"><span class="refine-tag-box-icon" mstrAttach:click></span></div>',text:"",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline-block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];}},onclick:function(){this.parent.removeChildren(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.Refine.RefineImportDialog","mstrmojo.Refine.RefineExtractDialog","mstrmojo.List");mstrmojo.requiresDescs(12350,12351,3482,3473,8118,246,14817,118,1905);var A=mstrmojo.css,F=mstrmojo.dom;var D=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineHistoryList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineHistoryList",markupString:'<div id="{@id}" class="refine-history-list-box"><div class="refine-history-header"></div><div class="refine-history-box"><div class="refine-history-inner-box"></div></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[0];},historyNode:function(){return this.domNode.children[1];},sequenceNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onundoIDChange:function(){if(this.undoID===-1){this.undo.set("enabled",false);}else{this.undo.set("enabled",true);}},onredoIDChange:function(){if(this.redoID===-1){this.redo.set("enabled",false);}else{this.redo.set("enabled",true);}}},undoID:-1,redoID:-1,setDimensions:function C(K,I){var G=parseInt(K,10);var J=parseInt(I,10);if(isNaN(G)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var L=44;var H=J-Math.max(Math.floor(J*0.65),618)-1;this.layoutConfig.h.headerNode=(L-16)+"px";this.layoutConfig.w.headerNode=(H-9)+"px";this.layoutConfig.h.sequenceNode=(G-L-14-3)+"px";this.layoutConfig.w.sequenceNode=(H-14)+"px";if(this._super){this._super(G+"px",H+"px");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"refine-history-label",cssDisplay:"inline-block",text:mstrmojo.desc(14817,"Script"),slot:"headerNode"},{slot:"headerNode",alias:"undo",cssClass:"refine-history-undo",cssDisplay:"inline-block",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3482,"Undo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.undoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{slot:"headerNode",alias:"redo",cssClass:"refine-history-redo",cssDisplay:"inline-block",scriptClass:"mstrmojo.Button",title:mstrmojo.desc(3473,"Redo"),onclick:function(){this.parent.controller.applyOperations({lastDoneID:this.parent.redoID},true);},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(118,"Save"),slot:"headerNode",cssClass:"refine-history-export",cssDisplay:"inline-block",alias:"export",onclick:function(){var G=mstrApp.getRootController();G.showDialog(D.dialogType.refineExtractDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(8118,"Import"),slot:"headerNode",cssClass:"refine-history-import",cssDisplay:"inline-block",alias:"import",onclick:function(){var G=mstrApp.getRootController();G.showDialog(D.dialogType.refineImportDialog,{controller:this.parent.controller});},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){A.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;}},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.Button",title:mstrmojo.desc(1905,"Reset"),cssClass:"refine-history-reset",cssDisplay:"inline-block",slot:"headerNode",alias:"reset",enable:false,visible:true,onclick:function(){var G,H;if(this.enable){G=this.parent.controller;if(G.refinePanel&&G.refinePanel.bottomPanal&&G.refinePanel.bottomPanal.splitter){H=G.refinePanel.bottomPanal.splitter.facetPanel;H.resetAllFacets();}G.applyOperations({lastDoneID:0},true);}},onenableChange:function(){A.toggleClass(this.domNode,"enable",this.enable);},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){this.parent.updateTooltip.call(this);}},{scriptClass:"mstrmojo.List",cssClass:"refine-history-list",slot:"sequenceNode",itemMarkup:'<div class="list-item {@cssClass}" title="{@description}">{@description}</div>',alias:"sequence",populateChange:false,populate:function E(I){if(I.past&&I.future){var H,G,J;for(H=0;H<I.past.length;H++){J=I.past[H];J.description=H+") "+mstrmojo.string.encodeHtmlString(J.description,null,true);J.cssClass="past";}for(G=0;G<I.future.length;G++){J=I.future[G];J.description=(H+G)+") "+mstrmojo.string.encodeHtmlString(J.description,null,true);J.cssClass="future";}this.set("items",I.past.concat(I.future));if(this.selectedIndex!==I.past.length-1){this.populateChange=true;}this.set("selectedIndex",I.past.length-1);this.render();if(I.past.length===0){this.parent.set("undoID",-1);}else{if(I.past.length===1){this.parent.set("undoID",0);}else{this.parent.set("undoID",I.past[this.selectedIndex-1].id);}}if(I.future.length===0){this.parent.set("redoID",-1);}else{this.parent.set("redoID",I.future[0].id);}}},onchange:function(G){if(this.populateChange===true){this.populateChange=false;}else{this.parent.controller.applyOperations({lastDoneID:G.src.selectedItem.id},true);}},multiSelect:false}],populate:function E(G){this.sequence.populate(G);if(G&&G.past&&G.past.length>0){this.reset.set("enable",true);}else{this.reset.set("enable",false);}},handleListChanged:function B(G){this.populate(G.value);},updateTooltip:function(){var G=F.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(G.y+25,0),left:Math.max(G.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Label","mstrmojo.dom");mstrmojo.requiresDescs(162,5961,3012,163);function A(){var D=mstrApp.getRootController().refineApp.rootController,C=D.model,B=parseInt(this.parent.currentPage.value,10);if(!B){return ;}C.set("start",(B-1)*C.limit);}mstrmojo.Refine.RefinePagination=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefinePagination",markupString:'<div class="mstrmojo-Refine-RefinePagination refine-viewpanel-paging" mstrAttach:click><div class="refine-viewpanel-paging-currentRows"></div><div class="refine-viewpanel-paging-of"></div><div class="refine-viewpanel-paging-totalRows"></div><div class="refine-viewpanel-paging-pages"></div></div>',markupSlots:{currentRows:function(){return this.domNode.children[0];},ofNode:function(){return this.domNode.children[1];},totalRows:function(){return this.domNode.children[2];},pageNode:function(){return this.domNode.children[3];}},totalPages:null,children:[{scriptClass:"mstrmojo.Label",alias:"currentRows",slot:"currentRows",text:"",},{scriptClass:"mstrmojo.Label",slot:"ofNode",text:"",},{scriptClass:"mstrmojo.Label",alias:"totalRows",slot:"totalRows",text:"",},{scriptClass:"mstrmojo.HBox",alias:"right",slot:"pageNode",cssClass:"",children:[{scriptClass:"mstrmojo.Button",alias:"firstNode",text:"",cssClass:"pagination-firstNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(162,"First page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",0);}},{scriptClass:"mstrmojo.Button",alias:"previousNode",text:"",cssClass:"pagination-previousNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(5961,"Previous page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===0){return ;}B.set("start",B.start-B.limit);}},{scriptClass:"mstrmojo.TextBox",alias:"currentPage",cssClass:"pagination-currentPage",width:"40px",onvalueChange:function(B){var C=B.value.toString();if(!C){return ;}C=C.replace(/[^0-9,]/g,"");C=parseInt(C)>parseInt(this.parent.parent.totalPages)?this.parent.parent.totalPages:C;C=parseInt(C)===0?1:C;this.set("value",C);},onEnter:A,onblur:A},{scriptClass:"mstrmojo.Label",alias:"totalPages",text:"",cssClass:"pagination-totalPages"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3687,"Page"),cssClass:"pagination-Page"},{scriptClass:"mstrmojo.Button",alias:"nextNode",text:"",cssClass:"pagination-nextNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(3012,"Next page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;if(B.start===(B.data.filtered-1)-((B.data.filtered-1)%B.limit)){return ;}B.set("start",B.start+B.limit);}},{scriptClass:"mstrmojo.Button",alias:"lastNode",text:"",cssClass:"pagination-lastNode",useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:"BL",top:"-2px",left:"-8px",content:mstrmojo.desc(163,"Last page")});},onclick:function(){var C=mstrApp.getRootController().refineApp.rootController,B=C.model;B.set("start",(B.data.filtered-1)-((B.data.filtered-1)%B.limit));}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.PopupEditBox");var A=mstrmojo.dom;var F=mstrmojo.DI.DIHelpers;function E(G){var H=this.columnIndex;var I=this.rowIndex;this.preview.downColumn=H;this.preview.downRow=I;this.preview.controller.isClickedInDatePreview=true;this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.columnName,isCtrlKey:F.isCtrlKey(G.hWin,G.e)});}function C(N){var I=N.e.srcElement;var H=this.columnIndex;var Q=this.rowIndex;if(this.preview.downColumn===H&&this.preview.downRow===Q){var M=null,J,K,L;var P=String(this.text).length;var O=String(this.text);if(window.getSelection){M=window.getSelection();J=M.getRangeAt(0);K=J.startOffset;L=J.endOffset;if(!J.collapsed&&J.startContainer===J.endContainer){this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}else{this.preview.controller.resetRecords();}}else{M=document.selection;J=M.createRange();var G=J.duplicate();G.moveToElementText(I);G.setEndPoint("EndToEnd",J);K=G.text.length-J.text.length;L=K+J.text.length;this.preview.controller.generateSuggestions(H,this.preview.columns[H].name,O,P,K,L,this.preview.columns,this);}}}function B(){var K=this.parent.parent.controller;K.resetRecords();K.model.raiseEvent({name:"columnUnSelected"});var H=this.columnIndex;var P=this.column[H].cellIndex;var Q=this.rowIndex;var G=A.position(this.domNode);var L=A.position(this.preview.dataNode);var O=(G.x+G.w)-(L.x+L.w);if(O>0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft+O;G=A.position(this.domNode);L=A.position(this.preview.dataNode);}else{if(G.x-L.x<0){this.preview.tableNode.scrollLeft=this.preview.tableNode.scrollLeft-(L.x-G.x);G=A.position(this.domNode);L=A.position(this.preview.dataNode);}}var J=(G.x+G.w+72)<=(L.x+L.w);var I=(J?(G.x):(G.x-72-3))-1-1-3;var N=G.y-1-1-3;var M=this.preview;mstrmojo.insert({scriptClass:"mstrmojo.Refine.PopupEditBox",top:N+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+72+2+3+"px",text:String(this.text).replace(/\n/g," "),value:String(this.text),preview:M,columnName:this.columnName,row:Q,cell:P,type:this.cssClass,floatLeft:J}).render();}function D(){if(this.preview.columnIndex>=0){if(this.preview.lastColumnIndex>=0&&this.preview.columnIndex>=this.preview.lastColumnIndex){this.preview.controller.generateColumnSuggestions(this.preview.columnIndex,this.preview.lastColumnName,this.preview.columnIndex-this.preview.lastColumnIndex+1);}else{this.preview.controller.generateColumnSuggestions(this.preview.columnIndex);}}if(this.preview.controller.isClickedInTransformation){this.preview.controller.resetRecords();this.preview.controller.isClickedInTransformation=false;}if(window.getSelection){window.getSelection().removeAllRanges();}else{document.selection.empty();}}mstrmojo.Refine.RefineDataCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineDataCell",markupString:'<div tabindex="-1" id="{@id}" class="refine-cell-node {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,blur,dblclick><div class="refine-cell-text-container"><div class="refine-cell-pseudo-text"></div><div class="refine-cell-text"></div></div></div>',markupSlots:{pseudoNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.children[1];}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);this.textNode.title=this.text;this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).replace(/\n/g," ")||"",null,true);}},resetText:function(){if(this.pseudoNode){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text)||"",null,true);}},highlightSelectedText:function(G,H){this.pseudoNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.text).substring(0,G),null,true)+'<span class="refine-selected-text">'+mstrmojo.string.encodeHtmlString(String(this.text).substring(G,H),null,true)+"</span>"+mstrmojo.string.encodeHtmlString(String(this.text).substring(H),null,true);},columnIndex:null,preview:null,onmousedown:E,onmouseup:C,ondblclick:B,onblur:D});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.Refine.RefineHelpers","mstrmojo.ui._HasScroller","mstrmojo.hash","mstrmojo.string");var C=mstrmojo.hash,N=mstrmojo.string;var D=mstrmojo.Refine.RefineHelpers;mstrmojo.requiresDescs(8953);function I(a,R,T,U,W){var S,b=[],Q,Z,V,X,Y;if(T===0){if(U!==-1&&W!==-1){if(a.length>W){b.push(a.substring(0,U));b.push(a.substring(U,W));b.push(a.substring(W));}else{if(a.length>U){b.push(a.substring(0,U));b.push(a.substring(U));}else{b.push(a);}}}else{if(U===-1){if(a.length>W){b.push(a.substring(0,W));b.push(a.substring(W));}else{b.push(a);}}else{if(a.length>U){b.push(a.substring(0,a.length-U));b.push(a.substring(a.length-U));}else{b.push("");b.push(a);}}}}else{if(T===1){S=a.split(R);for(Q=0;Q<S.length;Q++){b.push(S[Q]);}}else{if(T===2){if(a.match(R)){V=a.match(R)[0];Z=a.search(R);X=V.length+Z;b.push(a.substring(0,X));b.push(a.substring(X));}else{b.push(a);}}else{if(T===3){if(a.match(R)){X=a.search(R);b.push(a.substring(0,X));b.push(a.substring(X));}else{b.push(a);}}else{if(T===4){if(a.match(R)){b.push(a.match(R)[0]);}}else{if(T===5){if(a.match(R)){V=a.match(R)[0];Z=a.search(R);X=V.length+Z;b.push(a.substring(X));}}else{if(T===6){if(a.match(R)){X=a.search(R);b.push(a.substring(0,X));}else{b.push(a);}}else{if(T===7){Y=new RegExp(R.source,"g");b.push(a.replace(Y,""));}else{if(T===8){if(a.match(R)){V=a.match(R)[0];Z=a.search(R);X=V.length+Z;b.push(a.substring(0,X));}else{b.push(a);}}else{if(T===9){if(a.match(R)){X=a.search(R);b.push(a.substring(X));}else{b.push(a);}}}}}}}}}}}return b;}function L(W,T,a,U,V,X){var R,Q=0,Z,Y,S;if(U===0){if(V!==-1&&X!==-1){return 3;}else{return 2;}}else{if(U===1){for(R=0;R<a.length;R++){Z=a[R].cells;if(Z[W]){Y=Z[W].v;S=Y.toString().split(T);Q=Math.max(S.length,Q);}}}else{if(U===2){return 2;}else{if(U===3){return 2;}else{if(U===4){return 1;}else{if(U===5){return 1;}else{if(U===6){return 1;}else{if(U===7){return 1;}else{if(U===8){return 1;}else{if(U===9){return 1;}}}}}}}}}}return Q;}function P(Q,R,Z,T){var V=[],Y,W,S;switch(Z){case 0:case 1:case 2:case 3:for(Y=0;Y<Q;Y++){S={};if(Q>4&&Y>=2&&Y<=Q-1){if(Y===2){S.suggestionPreview=true;S.cellIndex=Y;S.name="...";S.columnNumber=(Q>4?4:Q);V.push(S);}if(Y===Q-1){S.suggestionPreview=true;S.cellIndex=3;S.name="New Column "+Y;S.columnNumber=(Q>4?4:Q);V.push(S);}continue;}S.suggestionPreview=true;S.cellIndex=Y;S.name="New Column "+Y;S.columnNumber=(Q>4?4:Q);V.push(S);}break;case 4:case 5:case 6:var a,U,X;S={};Y=1;while(true){a=R+" "+Y;U=true;for(W=0;W<T.length;W++){if(a===T[W].name){U=false;break;}}Y++;if(U){X=a;break;}}S.suggestionPreview=true;S.cellIndex=0;S.name=X;S.columnNumber=1;V.push(S);break;case 7:case 8:case 9:S={};S.suggestionPreview=true;S.cellIndex=0;S.name=R;S.columnNumber=1;V.push(S);break;}return V;}function G(X,U,c,V,Q,W,Y){var T,S;for(T=0;T<c.length;T++){var b=c[T].cells,a={};var R=[];if(b[X]){var Z=I(b[X].v.toString(),U,V,W,Y);for(S=0;S<Q;S++){a={};if(S<Z.length){a.v=Z[S];}else{a.v="";}if(Q>4&&S>=2&&S<Q-1){if(S===2){a.v="...";}else{continue;}}a.columnNumber=(Q>4?4:Q);R.push(a);}}else{for(S=0;S<Q;S++){a={};a.v="";if(Q>4&&S>=2&&S<Q-1){if(S===2){a.v="...";}else{continue;}}a.columnNumber=(Q>4?4:Q);R.push(a);}}c[T].cells=[].concat(R);}}function O(S,Q){var R=Q.controller;if(S===1){R.model.raiseEvent({name:"unPreviewSuggestion"});}Q.highlighted=false;}function H(Q){O(Q.src.data.suggestion_type,Q.src.suggestions);}function K(Z){var X=Z.src.suggestions;var U=Z.src.data;var S=JSON.parse(JSON.stringify(X.columns));var W=JSON.parse(JSON.stringify(X.data));if(!X.highlighted){var V=X.controller;if(U.suggestion_type===1){var T,Y,Q;var R={};C.copy(S[U.index],R);Y=R.cellIndex;Q=L(Y,U.separator,W.rows,U.suggestion_subtype,U.startOffset,U.endOffset);T=P(Q,R.name,U.suggestion_subtype,S);G(Y,U.separator,W.rows,U.suggestion_subtype,Q,U.startOffset,U.endOffset);V.model.raiseEvent({name:"previewSuggestion",columns:T,data:W,scrollTop:U.scrollTop,cellPos:X.cellPos});}Z.src.suggestions.highlighted=true;}}mstrmojo.Refine.RefineSuggestions=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Refine.RefineSuggestions",markupString:'<div id="{@id}" class="refine-suggestions"><div class="refine-suggestions-list"></div></div>',markupSlots:{listNode:function(){return this.domNode.children[0];}},setupScrollNodes:function E(){this.scrollNode=this.listNode;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function J(T,R){var Q=parseInt(T,10);var S=parseInt(R,10);if(isNaN(Q)||isNaN(S)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.listNode=(Q-3)+"px";this.layoutConfig.w.listNode=(S)+"px";if(this._super){this._super((Q)+"px",(S)+"px");}},highlighted:false,children:[{scriptClass:"mstrmojo.WidgetList",renderOnScroll:false,slot:"listNode",alias:"suggestions",itemFunction:function B(T,Q,R){var S=new mstrmojo.Widget({data:T,markupString:'<div class="list-item" mstrAttach:mouseover,mouseout>'+N.encodeHtmlString(T.description)+"</div>"});if(T.suggestion_type!==undefined){S.onmouseover=K;S.onmouseout=H;S.suggestions=R.parent;}return S;},populate:function F(W){this.unrender();var T,S,Q=[];var R=this.parent.controller;var U=R.model;var V=R.refinePanel.bottomPanal.splitter.facetPanel;if(V.hasSelection()){T=JSON.parse(JSON.stringify(U.transformations.Delete.DeleteRowsInTheView));T.engineConfig=V.getJSON();var X=V.getRequirementDiscription();T.description=T.description.replace("[Requirement]",X);S=JSON.parse(JSON.stringify(U.suggestions.partialCell.deleteRows[1]));S.operations=JSON.stringify([T]);Q.push(S);T=JSON.parse(JSON.stringify(U.transformations.Delete.DeleteRowsNotInTheView));T.engineConfig=V.getJSON();T.description=T.description.replace("[Requirement]",X);S=JSON.parse(JSON.stringify(U.suggestions.partialCell.deleteRows[2]));S.operations=JSON.stringify([T]);Q.push(S);W=Q.concat(W);}this.set("items",W);this.set("selectedIndex",-1);this.render();this.set("visible",W.length);this.parent.label.set("visible",!W.length);},onchange:function(T){var Q=this.parent.controller,R,U,S,V;if(this.selectedIndex===-1){return ;}if(T.src.selectedItem.suggestion_type===2){R=Q.refinePanel.bottomPanal.splitter.facetPanel;R.resetAllFacets();}S=JSON.parse(T.src.selectedItem.operations);if(S&&S.length){V=S[0];}U={operations:T.src.selectedItem.operations,engine:JSON.stringify({facets:[],mode:"row-based"})};if(Q.model.hasAddSample()&&V&&(V.op==="core/fill-down"||V.op==="core/blank-down")){D.confirmFilldownOrBlankdown(function(){Q.applyOperations(U);});}else{Q.applyOperations(U);}O(this.selectedItem.suggestion_type,this.parent);},multiSelect:false,visible:false},{scriptClass:"mstrmojo.Label",slot:"listNode",alias:"label",cssClass:"refine-suggestions-label",text:mstrmojo.desc(8953,"Suggestions")}],populate:function F(Q){this.suggestions.populate(Q);this.updateScrollbars();},handleDataChanged:function(Q){this.data=Q.value;},handleColumnsChanged:function(Q){this.columns=Q.value.columns;},handleGotSuggestions:function M(Q){this.populate(Q.list);if(Q.cellPos){this.cellPos=Q.cellPos;}},handleEmptySuggestions:function A(){this.populate([]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Box","mstrmojo.Editor","mstrmojo.Widget","mstrmojo.hash");var G=mstrmojo.hash;mstrmojo.requiresDescs(12705,14760);function I(T){var R="";var S;for(S in T){if(T.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(T[S]);}}return R;}function M(T){var R="";var S;for(S in T){if(T.hasOwnProperty(S)){R+="&"+S+"="+encodeURIComponent(T[S]);}}return R;}function D(S,W,Y,V,X,R){if(R.showProgress){mstrApp.showProgress(R);}var T=W+"?"+I.call(this,V);var U={taskId:"DataWranglerServer",command:T};if(S){U.postData=M.call(this,X);}window.setTimeout(function(){mstrApp.serverProxy.request(mstrmojo.func.wrapMethods({success:mstrmojo.emptyFn,complete:function(){if(R.showProgress){mstrApp.hideProgress();}},failure:mstrmojo.emptyFn},Y),U,false,{});},0);}mstrmojo.Refine.DataService=mstrmojo.declare(mstrmojo.Obj,null,{projectID:null,refineServerURL:null,getPreviewData:function J(T,R,S){D.call(this,true,"command/core/get-rows",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getColumns:function Q(S,R){D.call(this,false,"command/core/get-models",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getHistory:function E(S,R){D.call(this,false,"command/core/get-history",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getOperations:function F(S,R){D.call(this,false,"command/core/get-operations",S,R,null,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getProcesses:function C(T,S,R){D.call(this,false,"command/core/get-processes",T,S,null,{showProgress:true,progressValue:R.progress,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},applyOperations:function L(T,R,S){D.call(this,true,"command/core/apply-operations",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacets:function A(T,R,S){D.call(this,true,"command/core/compute-facets",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeFacetsQuiet:function N(T,R,S){D.call(this,true,"command/core/compute-facets",T,R,S,{showProgress:false,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},computeClusters:function B(T,R,S){D.call(this,true,"command/core/compute-clusters",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},massEdit:function K(T,R,S){D.call(this,true,"command/core/mass-edit",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},undoRedo:function P(T,R,S){D.call(this,true,"command/core/undo-redo",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},addSampleData:function O(T,R,S){D.call(this,true,"command/core/append-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},setSampleData:function H(T,R,S){D.call(this,true,"command/core/set-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},getSampleStatus:function H(T,R,S){D.call(this,true,"command/core/get-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12705,"Wrangling...")});},refreshSampleData:function H(T,R,S){D.call(this,true,"command/core/refresh-sample",T,R,S,{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(14760,"Refreshing...")});},});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.HTMLButton","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(24,221,5369,13085,13086,13087,13088,13089,13090);var C,H=mstrmojo.array,F=mstrmojo.dom,G,E;C=function C(M){var Q=M;var P=Q.vBoxAlias,L=P.iServerNameNodeHBox.iServerNameNodeAlias.value,N=P.iServerPortHBox.iServerPortAlias.value,R=P.loginHBox.loginAlias.value,S=P.passwordHBox.passwordAlias.value,I=P.dsNameHBox.dsNameAlias.value,K,O;if(Q.dbrole){K=Q.dbrole;}else{K=new mstrmojo.DI.DIRemoteProjectDBRole();K.init();}O=K.mdDBRole;var J={str:"hostname="+L+"; Port="+N+"; ProjectID="+E+";",err:"error Msg"};O.n=I;O.connstr=J.str;O.ln=R;O.password=S;O.dbr_type="5";O.dbms="00000000000000000000000000000000";O.hostname=L;O.Port=N;O.selectedProjectName=G;O.ProjectID=E;mstrApp.getRootController().projectController.saveDBRole(O,Q);};mstrmojo.DI.DIProjectDBRoleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIProjectDBRoleEditor",title:mstrmojo.desc(24,"Data Source"),id:"projectDBRoleEditor",help:"Select_Objects_dialog_box_.htm",cssClass:"mstrmojo-project-login",dbrole:undefined,buttons:[{scriptClass:"mstrmojo.HTMLButton",alias:"submitButtonAlias",cssClass:"mstrmojo-Editor-button mstr-submit-button",text:mstrmojo.desc(5369,"Submit"),onclick:function(){C(this.parent.parent);}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button mstr-cancel-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var I=this.parent.parent;I.close();}}],preBuildRendering:function B(){if(this._super){this._super();}if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);},onOpen:function A(){if(this._super){this._super();}mstrApp.getRootController().model.attachEventListener("projectsLoaded",this.id,this.projectsLoaded);var J=this.dbrole;this.set("dbrole",new mstrmojo.DI.DIRemoteProjectDBRole());this.set("dbrole",J);if(this.dbrole&&this.dbrole.hostname&&this.dbrole.Port){mstrApp.getRootController().projectController.getProjectsFromRemote(this.dbrole.hostname,this.dbrole.Port);}else{var I=this.vBoxAlias.iServerProjectHBox.iServerProject;I.set("items",[]);I.set("defaultSelection",0);I.set("selectedIndex",-1);I.set("text","");}},projectsLoaded:function D(K){var L=K.data.srps.sp,M=this.vBoxAlias.iServerProjectHBox.iServerProject;if(Object.prototype.toString.call(L)!=="[object Array]"){L=[].concat(L);}M.set("items",L);if(!this.dbrole){M.set("defaultSelection",0);G=L[0].pn;E=L[0].pgd;}else{var J=this.dbrole.ProjectID,I=H.find(L,"pgd",J);E=J;if(I!==-1){M.set("defaultSelection",I);M.set("selectedIndex",I);}else{M.set("selectedIndex",-1);M.set("defaultSelection",-1);M.set("text","");}}M.render();},children:[{scriptClass:"mstrmojo.VBox",alias:"vBoxAlias",cssClass:"login_Vbox",children:[{scriptClass:"mstrmojo.HBox",alias:"iServerNameNodeHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13085,"Remote I-Server Location")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerNameNodeAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.hostname;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerPortHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13086,"Remote I-Server Port")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"iServerPortAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.Port;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"iServerProjectHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13087,"Remote Server Project")},{scriptClass:"mstrmojo.Pulldown",alias:"iServerProject",popupToBody:true,itemField:"pn",itemIdField:"pgd",bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},onvalueChange:function(){var J=this,I=J.selectedIndex;G=J.items[I].pn;E=J.items[I].pgd;},premousedown:function(I){if(!this.items||(this.items.length===0)){var K=this.parent.parent.iServerNameNodeHBox.iServerNameNodeAlias.value;var J=this.parent.parent.iServerPortHBox.iServerPortAlias.value;if(K&&J){mstrApp.getRootController().projectController.getProjectsFromRemote(K,J);}}else{if(F.getButton(I.hWin,I.e)===F.MOUSE_BUTTON.LEFT){this.togglePopup();}}}}]},{scriptClass:"mstrmojo.HBox",alias:"loginHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13088,"Project Login")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"loginAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.ln;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"passwordHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13089,"Project Password")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"passwordAlias",type:"password",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.mdDBRole.password;}return"";}}}]},{scriptClass:"mstrmojo.HBox",alias:"dsNameHBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"login_label",text:mstrmojo.desc(13090,"Data Source Name")},{scriptClass:"mstrmojo.TextBox",cssClass:"input_textbox",alias:"dsNameAlias",bindings:{value:function(){var I=this.parent.parent.parent.dbrole;if(I){return I.n;}return"";}}}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Refine.RefineHelpers","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(1388,629,14539,14540);var C=mstrmojo.Refine.RefineConstants;var F=mstrmojo.Refine.RefineHelpers;var B=C.menuItems;var E=mstrmojo.array;mstrmojo.Refine.RefineMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(1388,"Rename"),did:B.REFINE_RENAME},{did:B.SEPARATOR},{n:mstrmojo.desc(12575,"Delete Column"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14274,"Duplicate Column"),did:B.REFINE_DUPLICATE},{did:B.SEPARATOR},{n:mstrmojo.desc(12341,"Fill Down"),did:B.REFINE_FILL_DOWN},{did:B.SEPARATOR},{n:mstrmojo.desc(14539,"Text Selector"),did:B.REFINE_TEXT_FACET},{n:mstrmojo.desc(14540,"Numeric Selector"),did:B.REFINE_NUMERIC_FACET},{did:B.SEPARATOR},{n:mstrmojo.desc(14268,"To Title Case"),did:B.REFINE_TITLE_CASE},{n:mstrmojo.desc(14269,"To Uppercase"),did:B.REFINE_UPPERCASE},{n:mstrmojo.desc(14270,"To Lowercase"),did:B.REFINE_LOWERCASE}],queryEnabled:function H(){return true;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_TEXT_FACET:case B.REFINE_NUMERIC_FACET:J=!mstrApp.getRootController().refineApp.isBDE;break;default:J=true;break;}return J;},queryChecked:function A(){return false;},executeCommand:function(X){var J={},T;var I,N,K=this.target.text;var S=this.target.preview.controller;var R=S.model;var U=R.columns.columns;var M;switch(X.did){case B.REFINE_RENAME:this.target.inlineEdit.ondblclick();break;case B.REFINE_DELETE:this.target.inlineEdit.handleDelete();break;case B.REFINE_DUPLICATE:I=[];var W,V,P,Q=1,O;var L=this.target.preview.columns;while(true){W=K+" "+Q;P=true;for(O=0;O<L.length;O++){if(W===(L[O]).name){P=false;break;}}Q++;if(P){V=W;break;}}N=JSON.parse(JSON.stringify(R.transformations.Other.duplicate));N.description=N.description.replace("[new column name]",V);N.description=N.description.replace("[column name]",K);N.columnInsertIndex=this.target.columnIndex+1;N.newColumnName=N.newColumnName.replace("[column name]",V);N.baseColumnName=N.baseColumnName.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_FILL_DOWN:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.fillDown));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);M={operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})};if(R.hasAddSample()){F.confirmFilldownOrBlankdown(function(){S.applyOperations(M);});}else{S.applyOperations(M);}break;case B.REFINE_TEXT_FACET:J.name=this.target.text;J.columnName=this.target.text;J.columnIndex=this.target.columnIndex;if(U[this.target.columnIndex]===undefined){J.originalName=null;}else{J.originalName=U[this.target.columnIndex].originalName;}T="list";J.expression="value";this.target.preview.controller.addFacets(T,J);break;case B.REFINE_NUMERIC_FACET:J.name=this.target.text;J.columnName=this.target.text;if(U[this.target.columnIndex]===undefined){J.originalName=null;}else{J.originalName=U[this.target.columnIndex].originalName;}T="range";J.expression="value";J.mode="range";this.target.preview.controller.addFacets(T,J);break;case B.REFINE_TITLE_CASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.titlecase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_UPPERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.uppercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_LOWERCASE:I=[];N=JSON.parse(JSON.stringify(R.transformations.TransformCell.lowercase));N.columnName=K;N.description=N.description.replace("[column name]",K);N.engineConfig=JSON.parse(R.engine);I.push(N);S.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var N=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-di-mapping-menu",useTooltip:true}),O=this.id,I,M=false,L=null,K=J||this.cm;E.forEach(K,function(Q){I=(Q.did===C.menuItems.SEPARATOR);if(this.queryVisible(Q)){if(I){if(null!==L){M=true;}}else{if(null===L){L=Q;}else{if(M){N.addSeparator();M=false;}}var P=[Q.icn||""],R=function R(){this.executeCommand(Q);};if(this.queryEnabled(Q)===false){N.addDisabledMenuItem(Q.n,P.join(" "));if(Q.title){N.menus[N.menus.length-1].title=Q.title;}}else{if(Q.items){N.addSubMenuItem(Q.n,"",O,Q.buildSubMenuConfig||this.getMenuConfig,Q.items);}else{if(Q.hasEdt){N.addEditorMenuItem(Q.n,O,Q.buildSubMenuConfig);}else{N.addToggleMenuItem(Q.n||"",P.join(" "),R,R,O,this.queryChecked(Q));}}}}}},this);return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(12346,12355,12356,1905,14543,10380,14544,14738,14739);var C=mstrmojo.Refine.RefineConstants;var E=mstrmojo.DI.DIConstants;var B=C.menuItems;var F=mstrmojo.array;mstrmojo.Refine.RefineFacetMenu=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineFacetMenu",dynamicUpdate:true,type:null,cm:[{n:mstrmojo.desc(12346,"Cluster and Edit"),did:B.REFINE_CLUSTER},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(12355,"Sort by Name"),did:B.REFINE_SORT_NAME},{n:mstrmojo.desc(12356,"Sort by Count"),did:B.REFINE_SORT_COUNT},{type:"list",did:B.SEPARATOR},{n:mstrmojo.desc(1905,"Reset"),did:B.REFINE_RESET},{n:mstrmojo.desc(14543,"Reset ALL Selector"),did:B.REFINE_RESET_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(13039,"Delete"),did:B.REFINE_DELETE},{n:mstrmojo.desc(14544,"Delete ALL Selector"),did:B.REFINE_DELETE_ALL},{did:B.SEPARATOR},{n:mstrmojo.desc(14738,"Delete Row Included In Selectors"),did:B.REFINE_DELETE_ROWS_IN_THE_VIEW},{n:mstrmojo.desc(14739,"Delete Row Not-included In Selectors"),did:B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW}],queryEnabled:function H(L){var J=true;var I=this.target.parent.parent.parent.parent.controller;switch(L.did){case B.REFINE_DELETE_ROWS_IN_THE_VIEW:case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:var K=I.refinePanel.bottomPanal.splitter.facetPanel;J=K.hasSelection();break;default:J=true;break;}return J;},queryVisible:function D(I){var J=true;switch(I.did){case B.REFINE_CLUSTER:case B.REFINE_SORT_NAME:case B.REFINE_SORT_COUNT:J=(this.target.type==="list");break;case B.SEPARATOR:if(I.type==="list"){J=(this.target.type==="list");}break;default:J=true;break;}return J;},queryChecked:function A(J){var I=false;switch(J.did){case B.REFINE_SORT_NAME:I=(this.target.options.sort==="name");break;case B.REFINE_SORT_COUNT:I=(this.target.options.sort!=="name");break;}return I;},executeCommand:function(P){var J,M,K,I=[],Q;var N=this.target.parent.parent.parent.parent.controller;switch(P.did){case B.REFINE_CLUSTER:var L=mstrApp.getRootController();var O=L.showDialog(E.dialogType.refineClusteringPage,{columnName:this.target.config.name,controller:N});N.model.attachEventListener("clustersFetched",O.id,O.handleClustersFetched);break;case B.REFINE_SORT_NAME:this.target.sortByName();break;case B.REFINE_SORT_COUNT:this.target.sortByCount();break;case B.REFINE_RESET:J=this.target.parent;this.target.reset();J.updateEngine(true);break;case B.REFINE_RESET_ALL:J=this.target.parent;J.resetAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE_ALL:J=this.target.parent;J.removeAllFacets();J.updateEngine(true);break;case B.REFINE_DELETE:this.target.remove();break;case B.REFINE_DELETE_ROWS_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;case B.REFINE_DELETE_ROWS_NOT_IN_THE_VIEW:M=JSON.parse(JSON.stringify(N.model.transformations.Delete.DeleteRowsNotInTheView));K=N.refinePanel.bottomPanal.splitter.facetPanel;M.engineConfig=K.getJSON();Q=K.getRequirementDiscription();M.description=M.description.replace("[Requirement]",Q);I.push(M);K.resetAllFacets();N.applyOperations({operations:JSON.stringify(I),engine:JSON.stringify({facets:[],mode:"row-based"})});break;default:return false;}return true;},getMenuConfig:function G(J){var M=new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-refine-menu"}),N=this.id,I,K=false,L=J||this.cm;F.forEach(L,function(P){I=(P.did===C.menuItems.SEPARATOR);if(this.queryVisible(P)){var O=[P.icn||""],Q=function Q(){this.executeCommand(P);};if(this.queryEnabled(P)===false||I){if((I&&!K)||!I){O.push(I?"separator":"");M.addDisabledMenuItem(P.n,O.join(" "));}if(I){K=true;}}else{if(P.items){M.addSubMenuItem(P.n,"",N,P.buildSubMenuConfig||this.getMenuConfig,P.items);K=false;}else{if(P.hasEdt){M.addEditorMenuItem(P.n,N,P.buildSubMenuConfig);K=false;}else{M.addToggleMenuItem(P.n||"",O.join(" "),Q,Q,N,this.queryChecked(P));K=false;}}}}},this);return M;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134,12361,13574,14178,14179,12348);var C=mstrmojo.Refine.RefineConstants;var D=mstrmojo.DI.DIConstants;var A=mstrmojo.css;function G(){var W=1,V,I,Z=[],P,O,J,M,K,b,R,a,X,c;O=this.parent;J=O.columns;M=J.selectedIndex;c=J.items[J.selectedIndex].columnIndex;if(M===undefined){return ;}K=(J.items[M]).name;b=O.transformationList;R=b.subType%10;if(R===0){var S=mstrApp.getRootController();var Y=S.showDialog(D.dialogType.refineClusteringPage,{columnName:K,controller:this.controller});this.controller.model.attachEventListener("clustersFetched",Y.id,Y.handleClustersFetched);return ;}while(true){X=K+" "+W;I=true;for(V=0;V<J.items.length;V++){if(X===(J.items[V]).name){I=false;break;}}W++;if(I){a=X;break;}}switch(R){case 1:P=JSON.parse(JSON.stringify(this.operations.duplicate));P.description=P.description.replace("[new column name]",a);P.description=P.description.replace("[column name]",K);P.columnInsertIndex=c+1;P.newColumnName=P.newColumnName.replace("[column name]",a);P.baseColumnName=P.baseColumnName.replace("[column name]",K);break;case 2:a=this.optionsBox.name.value;if(a===""){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}P=JSON.parse(JSON.stringify(this.operations.Rename));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",a);P.oldColumnName=K;P.newColumnName=a;break;case 3:var N=this.optionsBox.columns.selectedIndex;if(N===undefined){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q=(this.optionsBox.columns.items[N]).name;P=JSON.parse(JSON.stringify(this.operations.ConcatenateColumns));P.description=P.description.replace("####",K);P.description=P.description.replace("@@@@",Q);P.description=P.description.replace("@@@@",a);P.baseColumnName=K;P.newColumnName=a;P.columnInsertIndex=Math.max(c,N)+1;P.expression=P.expression.replace(new RegExp("\\[column name 1\\]","gm"),K);P.expression=P.expression.replace(new RegExp("\\[column name 2\\]","gm"),Q);break;case 4:var U=this.optionsBox.name2.value;var T=this.optionsBox.name3.value;var H=this.optionsBox.columns;if(H.selectedIndex===undefined||!U||!H){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var L=H.items[H.selectedIndex].columnIndex-c+1;P=JSON.parse(JSON.stringify(this.operations.TransposeColumnsIntoRows));P.description=P.description.replace("####",L);P.description=P.description.replace("@@@@",K);P.description=P.description.replace("@@@@",U);P.description=P.description.replace("@@@@",T);P.startColumnName=K;P.keyColumnName=U;P.valueColumnName=T;P.columnCount=L;}if(!(R===2||R===4)){P.engineConfig=JSON.parse(this.controller.model.engine);}Z.push(P);this.controller.applyOperations({operations:JSON.stringify(Z),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.name.set("value","");}mstrmojo.Refine.RefineControlOther=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlOther",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===70||this.subType===71){this.optionsBox.apply.onclick();}if(this.subType===74){var I=this.parent.columns;var H=I.selectedIndex;var J=I.items[H].columnIndex;this.populate(this.columns.slice(J+1),J+1);this.handleColumnUnSelected();}else{if(this.subType===73){this.populate(this.columns);this.handleColumnUnSelected();}}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===C.transformationType.Other);},subType:function(){return((this.parentBox.transformationList.type===C.transformationType.Other)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",alias:"columns",cssClass:"refine-pulldown refine-other-columns",onitemSelected:function(H){A.toggleClass(this.domNode,"selected",true);this.set("value",H.name);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===3||this.parent.parent.parentBox.transformationList.subType%10===4);}},getPopupListConfig:function B(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",useRichTooltip:true,selectionPolicy:"reselect",locksHover:true,listHooks:{select:function H(K,L,J){this.parent.set("selectedIndex",J);this.close();}},getItemProps:function I(K,J){return mstrmojo._IsList.getItemProps.call(this,K,J);}};}},{scriptClass:"mstrmojo.TextBox",alias:"name",emptyText:mstrmojo.desc(12361,"Column Name"),tooltip:mstrmojo.desc(12361,"Column Name"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===2);}}},{scriptClass:"mstrmojo.TextBox",alias:"name2",emptyText:mstrmojo.desc(14178,"Key Column"),tooltip:mstrmojo.desc(14178,"Key Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"name3",emptyText:mstrmojo.desc(14179,"Value Column"),tooltip:mstrmojo.desc(14179,"Value Column"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){G.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==1);}}}]}],populate:function F(J,K){if(!K){K=0;}var H=[],I;for(I=0;I<J.length;I++){H.push({n:J[I].name,name:J[I].name,columnIndex:I+K,originalName:J[I].originalName});}this.optionsBox.columns.set("items",H);},handleColumnsChanged:function E(H){this.columns=H.value.columns;this.populate(this.columns);},handleColumnUnSelected:function(){this.optionsBox.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.optionsBox.columns.selectedIndex=undefined;this.optionsBox.columns.list.set("selectedIndex",null);A.toggleClass(this.optionsBox.columns.domNode,"selected",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,9305,3124,12359,686,13059,13060,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var E=[],I,K,H,J,F,G,N;K=this.parent;H=K.columns;J=H.selectedIndex;if(J===undefined){return ;}F=(H.items[J]).name;G=K.transformationList;N=G.subType%10;switch(N){case 0:I=JSON.parse(JSON.stringify(this.operations.CharInCell));break;case 1:if(this.optionsBox.type.selectedIndex===0){I=JSON.parse(JSON.stringify(this.operations.CellContains));}else{if(this.optionsBox.type.selectedIndex===1){I=JSON.parse(JSON.stringify(this.operations.CellBeginsWith));}else{I=JSON.parse(JSON.stringify(this.operations.CellEndsWith));}}break;}var M=this.optionsBox.find.from.value;var L=this.optionsBox.find.to.value;if(!M||!L){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);I.description=I.description.replace("####","'"+B(D(M))+"'");I.description=I.description.replace("@@@@","'"+B(D(L))+"'");I.columnName=F;I.expression=I.expression.replace("[from]","'"+D(M)+"'");I.expression=I.expression.replace("[to]","'"+D(L)+"'");I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.to.set("value","");}mstrmojo.Refine.RefineControlFindAndReplace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFindAndReplace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.FindAndReplace);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell"),bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends with")}],selectedIndex:0,bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{scriptClass:"mstrmojo.HBox",alias:"find",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",emptyText:mstrmojo.desc(9305,"From")},{scriptClass:"mstrmojo.TextBox",alias:"to",emptyText:mstrmojo.desc(3124,"To")}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Refine.RefineHelpers","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(13574,134,3434,1013,2052,14533);var A=mstrmojo.Refine.RefineConstants,C=mstrmojo.Refine.RefineHelpers;function B(F){F=F.replace(/\n/g,"\\n");F=F.replace(/\t/g,"\\t");return F;}function E(F){return F.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function D(){var F=[],J,M,I,K,G,H,N,L;M=this.parent;I=M.columns;K=I.selectedIndex;L=I.items[I.selectedIndex].cellIndex;if(K===undefined){return ;}G=(I.items[K]).name;H=M.transformationList;N=H.subType%10;switch(N){case 0:J=JSON.parse(JSON.stringify(this.operations.titlecase));break;case 1:J=JSON.parse(JSON.stringify(this.operations.uppercase));break;case 2:J=JSON.parse(JSON.stringify(this.operations.lowercase));break;case 3:J=JSON.parse(JSON.stringify(this.operations.unescape));break;case 4:switch(this.optionsBox.datatype.type.selectedIndex){case 0:J=JSON.parse(JSON.stringify(this.operations.number));break;case 1:J=JSON.parse(JSON.stringify(this.operations.text));var O=this.parentBox.controller.model.data.rows[0].cells[L];if(!!O&&O.t){if(O.v.indexOf("T")!==-1){J.expression="toString(value, 'yyyy-MM-dd HH:mm:ss')";}else{J.expression="toString(value, 'yyyy-MM-dd')";}}break;case 2:if(!this.optionsBox.datatype.format.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}J=JSON.parse(JSON.stringify(this.operations.date));J.description=J.description.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");J.expression=J.expression.replace("[format]","'"+this.optionsBox.datatype.format.value+"'");break;}break;case 5:J=JSON.parse(JSON.stringify(this.operations.fillDown));break;case 6:J=JSON.parse(JSON.stringify(this.operations.blankDown));break;case 7:J=JSON.parse(JSON.stringify(this.operations.padBefore));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;case 8:J=JSON.parse(JSON.stringify(this.operations.padAfter));J.description=J.description.replace("[string]","'"+B(E(this.optionsBox.padString.value))+"'");J.expression=J.expression.replace("[string]","'"+E(this.optionsBox.padString.value)+"'");break;}J.columnName=G;J.description=J.description.replace("[column name]",G);J.engineConfig=JSON.parse(this.controller.model.engine);F.push(J);this.controller.applyOperations({operations:JSON.stringify(F),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.datatype.format.set("value","");this.optionsBox.padString.set("value","");}mstrmojo.Refine.RefineControlTransformCell=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlTransformCell",markupString:'<div id="{@id}" class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===10||this.subType===11||this.subType===12||this.subType===13||this.subType===15||this.subType===16){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.TransformCell);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.TransformCell)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"datatype",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(3434,"Number")},{n:mstrmojo.desc(1013,"Text")},{n:mstrmojo.desc(2052,"Date")}],selectedIndex:0},{scriptClass:"mstrmojo.TextBox",alias:"format",visible:false,cssClass:"Date",emptyText:mstrmojo.desc(14533,"Input Date Format"),bindings:{visible:function(){return(this.parent.type.selectedIndex===2);}}},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-refine-help",title:mstrmojo.desc(1143,"Help"),onclick:function(){var F="Valid_date_and_time_forms_for_wrangling_your_data.htm";mstrApp.showHelpTopic(F);},bindings:{visible:function(){return(this.parent.type.selectedIndex===2)&&(!mstrApp.isWorkstation);}}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.TextBox",alias:"padString",bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){var H=this.parent.parent,G=H.controller.model,I=H.subType,F=A.transformationSubType;if((I===F.FillDown||I===F.BlankDown)&&G.hasAddSample()){C.confirmFilldownOrBlankdown(function(){D.call(H);});}else{D.call(H);}},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4||this.parent.parent.parentBox.transformationList.subType%10===7||this.parent.parent.parentBox.transformationList.subType%10===8);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(134,13574);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(F,E){F=F.replace(/\$/g,"$$$$");if(!E){F=F.replace(/[\\"']/g,"\\$&");}return F;}function C(){var E=[],I,M,H,L,F,G,O;M=this.parent;H=M.columns;L=H.selectedIndex;if(L===undefined){return ;}F=(H.items[L]).name;G=M.transformationList;O=G.subType%10;var P,Q,K,J;switch(O){case 0:I=JSON.parse(JSON.stringify(this.operations.CutOn));Q=this.optionsBox.find.tagBox.children;P="";for(K=0;K<Q.length-1;K++){P+=mstrmojo.string.regEscape(Q[K].text);if(K!==Q.length-2){P+="|";}}J=Q[Q.length-1].input.value;if(J){if(Q.length>1){P+="|";}P+=mstrmojo.string.regEscape(J);}break;case 1:I=JSON.parse(JSON.stringify(this.operations.CutBefore));break;case 2:I=JSON.parse(JSON.stringify(this.operations.CutAfter));break;}var N=this.optionsBox.find.from.value;if((O===0&&!P)||(O!==0&&!N)){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[column name]",F);if(O===0){I.description=I.description.replace("####","/"+B(D(P,true))+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+D(P,true)+"/");}else{I.description=I.description.replace("####","'"+B(D(N))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(N)+"'");}I.columnName=F;I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.find.from.set("value","");this.optionsBox.find.tagBox.removeTags();this.optionsBox.find.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlRemoveText=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlRemoveText",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.RemoveText);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"find",cssClass:"refine-controls-remove-text-box",children:[{scriptClass:"mstrmojo.TextBox",alias:"from",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox",bindings:{visible:function(){return(this.parent.parent.parent.parentBox.transformationList.subType%10===0);}}}]},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown","mstrmojo.string");var K=mstrmojo.array,M=mstrmojo.hash,A=19,F=13,L=27;var S=mstrmojo.css,E=mstrmojo.dom,J=mstrmojo.string;mstrmojo.Refine.RefineSearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",editableSlot:"selectedNode",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-label" title="{@title}">'+mstrmojo.desc(10,"Search")+'</div><div class="mstrmojo-ui-Pulldown-text" title="{@title}" style="{@labelCssText}"></div><div class="container"></div></div>',markupSlots:{selectedNode:function R(){return this.domNode.children[1];},labelNode:function I(){return this.domNode.children[0];},containerNode:function Q(){return this.domNode.lastChild;}},allowCustomText:false,isSearching:false,editOnClick:false,init:function O(X){this._super(X);var U=this.getPopupList();U.renderOnScroll=this.renderOnScroll||U.renderOnScroll;U.renderBlockSize=this.renderBlockSize||U.renderBlockSize;mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-SearchablePulldown mstrmojo-Refine-SearchablePulldown");var W=U.constructor.prototype,V=U.getItemProps?U.getItemProps:W.getItemProps,Y=U.getItemMarkup?U.getItemMarkup:W.getItemMarkup;U.getItemProps=function(d,Z){var a=this._spft||"",e=d.n,b=e.toUpperCase().indexOf(a);if(b===-1){a="";}var c=V.call(this,d,Z);c.before=e.slice(0,b);c.input=e.substring(b,b+a.length);c.after=e.slice(b+a.length,e.length);return c;};U.getItemMarkup=function(a,Z){return Y.call(this,a,Z).replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");};},onclick:function T(U){var X=this.selectedNode,Y=U.getTarget(),Z=U.e.offsetX>=(X.offsetWidth-A),W=this.getPopupWidget(),V=W.visible;if(Y===X&&(!V||(V&&Z))){this.set("isEditing",!V);this.labelNode.style.display=V?"none":"block";S.toggleClass(this.labelNode,"hidden",false);this._super(U);}},onPopupWidgetClosed:function B(){this.set("isEditing",false);this.labelNode.style.display="none";var W=this.getPopupList(),X=W._oldItems,V=this.text;delete W._oldItems;if(X){var U=K.find(X,"n",V);if(U===-1&&!this.allowCustomText){W.set("items",X);return ;}W.set("items",X);this.set("selectedIndex",U);}},_set_selectedIndex:function C(Y,V){if(this.allowCustomText&&V===-1){this.selectedIndex=-1;this.onitemSelected(null,V);}else{this.isSearching=false;this._super(Y,V);if(this.hasRendered){var X=this.getPopupList();var W=this.selectedIndex;var U=X.items;this.text=U[W].n;}}return true;},onkeydown:function H(V){this._super(V);var U=window.event||V.e;if(U.keyCode===F){this.getPopupList().close();}},onkeyup:function P(W){this._super(W);var U=window.event||W.e,X=U.keyCode,V=this.getPopupList();if(X===L||X===F){V.close();}else{this.processSearch();}},onblur:function D(){},processSearch:function N(){this.isSearching=true;this.hideTooltip();var U=[],W=this.getPopupList(),X=this.selectedNode.innerHTML,Y=W._oldItems||W.items,V=X.toUpperCase();if(X){S.toggleClass(this.labelNode,"hidden",true);}else{S.toggleClass(this.labelNode,"hidden",false);}V=V.replace(/<BR>/,"");V=V.replace(/&NBSP;/,"");V=V.replace(/\s+/g,"");if(V.length>0){K.forEach(Y,function(Z){var a=Z.n.toUpperCase().replace(/\s+/g,"");if(a.indexOf(V)>-1&&!Z.skipSearch){U.push(M.clone(Z));}},this);}else{U=Y;}W._spft=V;if(this.customizeSearchResult){this.customizeSearchResult(U);}W.set("items",U);W.adjustCornersForPopupOverflow();delete W._spft;W._oldItems=Y;W.set("visible",U.length!==0);},onisEditingChange:function G(){if(this.hasRendered){var U=this[this.editableSlot],V=!!this.isEditing;U.contentEditable=V;U.spellcheck=false;S.toggleClass(U,"editable",V);if(V){U.innerHTML="";U.focus();E.setElementSelection(U);}else{U.innerHTML=J.encodeHtmlString(this.text);U.blur();U.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.RadioList","mstrmojo.ui.Pulldown","mstrmojo.Refine.RefineTagBox","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,686,13059,13060,12359,12360,134,14290,14291);var A=mstrmojo.Refine.RefineConstants;function B(){var C=[],H,M,G,K,D,F,N;var E,Q;M=this.parent;K=M.columns.selectedIndex;F=M.transformationList;G=M.columns;N=F.subType%10;if(K===undefined&&!F.noColumn){return ;}if(!F.noColumn){D=(G.items[K]).name;}switch(N){case 0:H=JSON.parse(JSON.stringify(this.operations.Colomn));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 1:var L=this.optionsBox.rows.type.selectedIndex;var O=this.optionsBox.rows.text.value;var P,J,I;switch(L){case 0:H=JSON.parse(JSON.stringify(this.operations.RowsContains));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I);}break;case 1:H=JSON.parse(JSON.stringify(this.operations.RowsBegins));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+="^"+mstrmojo.string.regEscape(P[J].text);if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+="^"+mstrmojo.string.regEscape(I);}break;case 2:H=JSON.parse(JSON.stringify(this.operations.RowsEnds));P=this.optionsBox.rows.tagBox.children;O="";for(J=0;J<P.length-1;J++){O+=mstrmojo.string.regEscape(P[J].text)+"$";if(J!==P.length-2){O+="|";}}I=P[P.length-1].input.value;if(I){if(P.length>1){O+="|";}O+=mstrmojo.string.regEscape(I)+"$";}break;case 3:H=JSON.parse(JSON.stringify(this.operations.RowsBlank));break;case 4:H=JSON.parse(JSON.stringify(this.operations.RowsEquals));break;case 5:H=JSON.parse(JSON.stringify(this.operations.RowsNotEquals));break;}if(L!==3&&!O){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(L===0||L===1||L===2){H.engineConfig.facets[0].query=H.engineConfig.facets[0].query.replace("[text]",O);H.description=H.description.replace("####","/"+O+"/");}else{if(L===4||L===5){H.engineConfig.facets[0].selection[0].v.v=O;H.engineConfig.facets[0].selection[0].v.l=O;H.description=H.description.replace("####","'"+O+"'");}}H.engineConfig.facets[0].name=H.engineConfig.facets[0].columnName=D;H.description=H.description.replace("[column name]",D);break;case 2:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateCells));H.description=H.description.replace("[column name]",D);H.columnName=D;break;case 3:H=JSON.parse(JSON.stringify(this.operations.RemoveDuplicateRows));break;case 4:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;case 5:H=JSON.parse(JSON.stringify(this.operations.DeleteRowsNotInTheView));E=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;H.engineConfig=E.getJSON();Q=E.getRequirementDiscription();H.description=H.description.replace("[Requirement]",Q);E.resetAllFacets();break;}if(N===1||N===2||N===3){H.engineConfig.facets=H.engineConfig.facets.concat(JSON.parse(this.controller.model.engine).facets);}C.push(H);this.controller.applyOperations({operations:JSON.stringify(C),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.rows.text.set("value","");this.optionsBox.rows.tagBox.removeTags();this.optionsBox.rows.tagBox.inputBox.input.set("value","");}mstrmojo.Refine.RefineControlDelete=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlDelete",markupString:'<div class="refine-controls delete"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType===20||this.subType===22||this.subType===23||this.subType===24||this.subType===25){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Delete);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Delete)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"rows",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12359,"Where Cell")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"type",items:[{n:mstrmojo.desc(686,"Contains")},{n:mstrmojo.desc(13059,"Begins With")},{n:mstrmojo.desc(13060,"Ends With")},{n:mstrmojo.desc(12360,"Is Empty")},{n:mstrmojo.desc(14290,"Equals To")},{n:mstrmojo.desc(14291,"Not Equals To")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===3){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",false);}else{if(this.selectedIndex===0||this.selectedIndex===1||this.selectedIndex===2){this.parent.text.set("visible",false);this.parent.tagBox.set("visible",true);}else{this.parent.text.set("visible",true);this.parent.tagBox.set("visible",false);}}}},{scriptClass:"mstrmojo.TextBox",alias:"text"},{scriptClass:"mstrmojo.Refine.RefineTagBox",alias:"tagBox"}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}},{slot:"optionsNode",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===1);}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(12792,12804);var J=mstrmojo.array,D=mstrmojo.hash,L=mstrmojo.DI.DIConstants,F=mstrmojo.DI.DIConstants.actions;function C(N,M){var O=M;if(N.isMultiForm){if(!M.isMultiForm){O=N;}else{var Q=N.subColumns,P=M.subColumns.concat();J.forEach(Q,function(S){var R=J.find(P,"afid",S.afid);if(R<0){P.push(S);}});O=D.copy(M);O.subColumns=P;}}if(!O.linkedTbs){O.linkedTbs={};O.linkedTbs[M.tableId]=true;O.linkedTbs[N.tableId]=true;}else{O.linkedTbs[N.tableId]=true;}return O;}function A(O){var M=O.initialSet.distInfo,N=O.distInfo;if(M.keyId===N.keyId&&M.pf===N.pf){return null;}else{return N;}}function B(Q){var N=Q.initialSet.sidxes,O=Q.sidxes,R={},M=false;if(O.length<N.length){M=true;}else{J.forEach(N,function P(S){R[S.atid+S.afid]=true;});J.forEach(O,function P(S){if(R[S.atid+S.afid]!==true){M=true;return false;}});}return M?O:null;}mstrmojo.DI.controller.DIAllObjectsViewController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIAllObjectsViewController",controller:null,init:function K(M){this._super(M);this.controller=mstrApp.getRootController();},getAllMappings:function(){var P,O,Q,S,T;var R=[],M=this.controller.model.importSources;for(P in M){Q=M[P];if(Q.currentTransformations&&Q.currentTransformations.xtab&&Q.currentTransformations.xtab.isCrosstab){T=Q.transformedMapping;}else{T=Q.currentMapping;}if(T){for(O=0;T&&O<T.length;O++){S=T[O];var N=mstrmojo.array.find(R,"id",S.id);if(N<0){R.push(mstrmojo.hash.copy(S));}else{R[N]=C(S,R[N]);}}}}return R;},getAllImportSources:function(){return this.controller.model.importSources;},getCubeConfig:function E(){var N=this.controller;var M=N.model;var O={browsetype:L.browseFlag.cubeConfig,previewflag:L.requestFlag.mapping};var P={success:function(Q){M.populateCubeConfig(Q);},failure:function(Q){N.displayError(mstrmojo.desc(12792,"Cannot retrieve cube config info.")+Q);}};N.dataService.getImportedData(P,O);},isCubeConfigEnabled:function G(){var M=this.controller.model;if(mstrApp.isSingleTier){return true;}else{if(M.isDirectDataAccess&&M.weakDDA!==true){return false;}else{return true;}}},persistCubeConfig:function I(S){var O=this.controller,N=A(S),R=B(S),P=[],Q=[],T={};if(!N&&!R){return ;}if(R){J.forEach(R,function(U){P.push(U.atid);Q.push(U.afid);});T.statid=P.join();T.stafid=Q.join();T.stic=true;}if(N){T.keyid=N.keyId;T.n=N.pf;}var M={success:function(){delete S.initialSet;S.initialSet=D.clone(S);O.model.set("isDirectDataAccess",false);var U=L.requestFlag.mapping|L.requestFlag.sourceInfo|L.requestFlag.relationship;O.getImportedDataEMMA(F.none,U);},failure:function(U){var V=mstrmojo.desc(12804,"Persist cube configurations failed:");O.displayError(V,false,U.message);}};O.dataService.persistCubeConfigInfo(M,T);},showAllObjects:function H(){var M=this.controller;M.model.attachEventListener("CubeConfigFetched",this.id,function(){M.showDialog(L.dialogType.allObjectsViewDialog,null);});this.getCubeConfig();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(14959,14960,1162,9935,14968,14969,14970,14971,14972,14973,14974,14975,14976,14977,14978,14979,14980,14981,14982,14983,14984,14985,14986,14987,14988,14989,14990,14991,14992,14993,14994,14995,14996,14997,14998,1149,14999);var C=mstrmojo.DI.DIConstants;var B={HGoS_CONFIG_HAS_EXIT:{TITLE:mstrmojo.desc(14968,"Configuration Conflict"),MSG:mstrmojo.desc(14969,"Please specfiy gateway propertoes"),DETAIL:mstrmojo.desc(14970,"Hadoop gateway with same host name and port number already exists;")+"\n"+mstrmojo.desc(14971,"please modify the gateway definition.")},CONNOT_AUTHENTICATE:{TITLE:mstrmojo.desc(14972,"Gateway Authentication Error"),MSG:mstrmojo.desc(14973,"You may solve this problem by checking followings:"),DETAIL:mstrmojo.desc(14974,"1. Username or password is not correct.")+"\n"+mstrmojo.desc(14975,"2. Gateway host is down.")+"\n"+mstrmojo.desc(14976,"3. Network problem (Gateway host is unreachable, firewall blocking, etc.).")+"\n"+mstrmojo.desc(14977,"4. Connection time out.")},SPACE_OVER:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14979,"Insufficient disk space to deploy Hadoop Gateway. Minimum required disk space is 200M.")},FAIL_COPY_TO_HOST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14980,"Unable to copy application files to host. It may be caused by:"),DETAIL:mstrmojo.desc(14981,"1. Insufficient permissions")+"\n"+mstrmojo.desc(14982,"2. Gateway host being down")+"\n"+mstrmojo.desc(14983,"3. Network problem (Gateway host is unreachable, firewall blocking, etc.)")+"\n"+mstrmojo.desc(14984,"4. Connection time out")},INSUFFICIENT:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14985,"Insufficient disk space on host. Minimum required disk space is 200M.")},DIRECTORY_NO_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14997,"Folder '####' does not exist. This may be caused by insufficient permission to create the folder.")},HGOS_DEPLOYED:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14986,"Hadoop Gateway has been already deployed.")},HGOS_DEPLOYING:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14987,"Hadoop Gateway is being deployed. Please wait the operation complete.")},CONNOT_AUTHENTICATE2:{TITLE:mstrmojo.desc(14972,"Gateway Authentication Error"),MSG:mstrmojo.desc(14973,"You may solve this problem by checking followings:"),DETAIL:mstrmojo.desc(14974,"1. Username or password is not correct")+"\n"+mstrmojo.desc(14975,"2. Gateway host is down")+"\n"+mstrmojo.desc(14976,"3. Network problem (Gateway host is unreachable, firewall blocking, etc)")+"\n"+mstrmojo.desc(14977,"4. Connection time out")},HGOS_RUNNING:{TITLE:mstrmojo.desc(14988,"Failed to start Hadoop Gateway"),MSG:mstrmojo.desc(14989,"Hadoop Gateway is already running.")},HGOS_STOPPED:{TITLE:mstrmojo.desc(14990,"Failed to stop Hadoop Gateway"),MSG:mstrmojo.desc(14991,"Hadoop Gateway has already stopped.")},HGOS_NOT_DEPLOYING:{TITLE:mstrmojo.desc(14992,"Failed to start/stop Hadoop Gateway"),MSG:mstrmojo.desc(14993,"Failed to start/ stop Hadoop Gateway. This may be due to Hadoop Gateway not being deployed, or been removed.")},HGOST_TAR_NOT_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14994,"Unable to copy tar file to host. Please make sure that the tar file exists under the folder:")+"\n"+mstrmojo.desc(14999,"[MicroStrategy Install Path]/IntelligenceServer/hgos-manager.")},HGOS_CONF_NOT_EXIST:{TITLE:mstrmojo.desc(14978,"Failed to deploy Hadoop Gateway"),MSG:mstrmojo.desc(14995,"Hadoop Gateway configuration file is not found.")},DEFAULT:{TITLE:mstrmojo.desc(14996,"Operation failed"),MSG:mstrmojo.desc(15617,"Unknown error.")}};function A(D){return encodeURI(D);}mstrmojo.DI.controller.DIHadoopGatewayController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopGatewayController",submitActions:function(I,J,E){var D=this.rootController||mstrApp.getRootController(),F=D.dataService;var H=this;var G={actions:I,success:function(K,L){if(K&&(typeof (K[0].success)!=="undefined")&&K[0].success===true){J.success(K);}else{if(K&&(typeof (K[0].success)!=="undefined")&&K[0].success===false){H.popUpErrorWin4HGW(K[0],JSON.parse(L.params.json));J.success(K);}else{D.displayError(mstrmojo.desc(null,"IServer returns a invalid result"),false,"");}}},failure:function(K){D.displayError(mstrmojo.desc(null,"Failed to connect to webServer"),false,"");J.failure(K);}};F.DIManageHadoopGateway(G,{json:JSON.stringify(I)},E);},popUpErrorWin4HGW:function(F,J){var E=mstrApp.diRootCtrl,G=F.code||null,I,H,D;switch(G){case C.hadoopGateWay.HGoS_CONFIG_HAS_EXIT:I=B.HGoS_CONFIG_HAS_EXIT.TITLE,H=B.HGoS_CONFIG_HAS_EXIT.MSG,D=B.HGoS_CONFIG_HAS_EXIT.DETAIL;break;case C.hadoopGateWay.CONNOT_AUTHENTICATE:I=B.CONNOT_AUTHENTICATE.TITLE,H=B.CONNOT_AUTHENTICATE.MSG,D=B.CONNOT_AUTHENTICATE.DETAIL;break;case C.hadoopGateWay.SPACE_OVER:I=B.SPACE_OVER.TITLE,H=B.SPACE_OVER.MSG;break;case C.hadoopGateWay.FAIL_COPY_TO_HOST:I=B.FAIL_COPY_TO_HOST.TITLE,H=B.FAIL_COPY_TO_HOST.MSG,D=B.FAIL_COPY_TO_HOST.DETAIL;break;case C.hadoopGateWay.INSUFFICIENT:I=B.INSUFFICIENT.TITLE,H=B.INSUFFICIENT.MSG;break;case C.hadoopGateWay.DIRECTORY_NO_EXIST:I=B.DIRECTORY_NO_EXIST.TITLE;H=B.DIRECTORY_NO_EXIST.MSG.replace("####",J[0]["remoteDir"]);break;case C.hadoopGateWay.HGOS_DEPLOYED:I=B.HGOS_DEPLOYED.TITLE,H=B.HGOS_DEPLOYED.MSG;break;case C.hadoopGateWay.HGOS_DEPLOYING:I=B.HGOS_DEPLOYING.TITLE,H=B.HGOS_DEPLOYING.MSG;break;case C.hadoopGateWay.CONNOT_AUTHENTICATE2:I=B.CONNOT_AUTHENTICATE2.TITLE,H=B.CONNOT_AUTHENTICATE2.MSG,D=B.CONNOT_AUTHENTICATE2.DETAIL;break;case C.hadoopGateWay.HGOS_RUNNING:I=B.HGOS_RUNNING.TITLE,H=B.HGOS_RUNNING.MSG;break;case C.hadoopGateWay.HGOS_STOPPED:I=B.HGOS_STOPPED.TITLE,H=B.HGOS_STOPPED.MSG;break;case C.hadoopGateWay.HGOS_NOT_DEPLOYING:I=B.HGOS_NOT_DEPLOYING.TITLE,H=B.HGOS_NOT_DEPLOYING.MSG;break;case C.hadoopGateWay.HGOST_TAR_NOT_EXIST:I=B.HGOST_TAR_NOT_EXIST.TITLE,H=B.HGOST_TAR_NOT_EXIST.MSG;break;case C.hadoopGateWay.HGOS_CONF_NOT_EXIST:I=B.HGOS_CONF_NOT_EXIST.TITLE,H=B.HGOS_CONF_NOT_EXIST.MSG;break;default:I=B.DEFAULT.TITLE,H=B.DEFAULT.MSG,H=mstrmojo.desc(1149,"Error Code")+" : "+G;break;}E.displayError(H,false,D,null,I);},createGateway:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}if(D.sparkConfig.props["spark.master"]===undefined||D.sparkConfig.props["spark.master"].trim()===""){D.sparkConfig.props["spark.master"]="local[*]";}F.push({path:"hgosmgr/conf/hgos/",method:"POST",body:D});this.submitActions(F,G);},updateSparkConfig:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}if(D.sparkConfig.props["spark.master"]===undefined||D.sparkConfig.props["spark.master"].trim()===""){D.sparkConfig.props["spark.master"]="local[*]";}D.httpPort=4020;F.push({path:"hgosmgr/deploy/update/hgosConf/"+A(D.name),method:"PUT",body:D.passwd});this.submitActions(F,G);},updateGateway:function(D,G){var F=[];if(D.sparkConfig===undefined){var E={props:null};D.sparkConfig=E;}D.httpPort=4020;F.push({path:"hgosmgr/conf/hgos/"+A(D.name),method:"PUT",body:D});this.submitActions(F,G);},deleteGateway:function(D,F){var E=[];E.push({path:"hgosmgr/conf/hgos/"+A(D.name),method:"DELETE",body:D});this.submitActions(E,F);},listGateways:function(F,D){var E=[];E.push({path:"hgosmgr/status/hgos",method:"GET"});this.submitActions(E,F,D);},startGateway:function(D,F){var E=[];E.push({path:"hgosmgr/launch/start/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},stopGateway:function(D,F){var E=[];E.push({path:"hgosmgr/launch/stop/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},installGateway:function(D,F){var E=[];E.push({path:"hgosmgr/deploy/install/"+A(D.name),method:"POST",remoteDir:D.remoteDir,body:D.passwd});this.submitActions(E,F);},uninstallGateway:function(D,F){var E=[];E.push({path:"hgosmgr/deploy/uninstall/"+A(D.name),method:"POST",body:D.passwd});this.submitActions(E,F);},showGatewayListDialog:function(){var D=this.rootController||mstrApp.getRootController();this.listGateways({success:function(E){D.showDialog(C.dialogType.hadoopGatewayManagerDialog,{controller:D,items:E[0].entity});},failure:function(){D.showDialog(C.dialogType.hadoopGatewayManagerDialog,{controller:D});}});},confirmAuthentication:function(H){var D,G,E,F;D={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayDialog-AuthenticationEditor",zIndex:10000,title:mstrmojo.desc(14959,"Gateway Authentication"),visible:true,check:function(){var I=E&&E.length&&F!==undefined;this.btnHbox.children[0].set("enabled",I);},children:[{scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:mstrmojo.desc(14960,"Username:")},{scriptClass:"mstrmojo.TextBox",onvalueChange:function(){E=this.value;this.parent.parent.check();}}]},{scriptClass:"mstrmojo.Box",cssClass:"ctrl-box cf",children:[{scriptClass:"mstrmojo.Label",cssClass:"ctrl-label",text:mstrmojo.desc(1162,"Password:")},{scriptClass:"mstrmojo.TextBox",type:"password",onvalueChange:function(){F=this.value;this.parent.parent.check();}}]}],buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(9935,"Log In"),function(){H.call(this.parent.parent,E,F);},true,{enabled:false})]};G=new mstrmojo.Editor(D);G.render();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIConstants","mstrmojo.DI.DIModel");mstrmojo.requiresDescs(641,12783,12897,12899,12900,12901,12902,12903,12904,12510,12537,13324,12392,14708);var j=mstrmojo.DI.DIConstants,O=mstrmojo.array,Y=mstrmojo.func,C=mstrmojo.string,J=j.xdaType,M=j.actions,V=mstrmojo.DI.DIHelpers,K="TABLENAME=",G="GENERICPARA=";var W=V.extractFileExtensionFromHadoopURL;var B=function(n,l){if(n.fileTypeMap&&n.fileTypeMap[l]){return n.fileTypeMap[l];}else{var k=W(l).toUpperCase();var m=j.fileTypes[0].v;O.some(j.fileTypes,function(o){if(o.n===k){m=o.v;return true;}});return m;}};var N=function(k){return(k.toUpperCase()===j.fileTypes[0].v)?J.dataImportFileText:J.dataImportFileExcel;};function U(k){var n=k.idx;var l={idx:0,files:{}};for(var m=0;m<n;++m){if(!k.files[m].cancelled){l.files[l.idx]=k.files[m];++l.idx;}}return l;}function Z(s,p,t){var o=mstrApp.getRootController(),q=o.dataService,l=null,n=[];var m={success:function(w){var v=w.datap.shts,u=0;n=[];O.forEach(v,function(x){if(x!=="*"){n.push({idx:u,n:x});}u++;});if(n.length>0){if(t.success){t.success({sheets:n});}}else{if(t.failure){t.failure({message:mstrmojo.desc(12510,"The import process cannot proceed with an empty file.")});}}if(t.complete){t.complete();}},failure:function(u){if(t.failure){t.failure(u);}if(t.complete){t.complete();}}};var k={success:function(){l={tableID:p,previewflag:j.requestFlag.sheets};q.getImportedData(m,l);},failure:function(u){if(t.failure){t.failure(u);}if(t.complete){t.complete();}}};l=mstrmojo.hash.copy(s,{tbid:p});q.setDataImportInfo(k,l);}function X(p,s,o){var l=this;var n=p&&p.length;var m=0;var q;if(!n){if(s&&s.success){s.success();}if(s&&s.complete){s.complete();}return ;}var k={success:function(t){l.dataService.set("messageID",t.msgid);l.model.resetImportSource(p[m]);if(o){O.removeItem(l.tablesSrc[o],p[m]);}m++;if(m<n){q={did:p[m]};l.removeEMMASourceTable(k,q);}else{if(s&&s.success){s.success();}if(s&&s.complete){s.complete();}}},failure:function(t){if(s&&s.failure){s.failure(t);}}};if(m<n){q={did:p[m]};l.removeEMMASourceTable(k,q);}}function f(m,p,u,s){var q=this;var k=this.model.cubeID;var o=m.getFileName(p.idx);var n={msgID:q.dataService.messageID,tableID:s,__index:p.idx,fileName:o};var l={failure:function(v){var w=q.getImportController().handleImportError(v,o);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,w);},complete:function(){mstrApp.hideProgress();}};var t=function(){var v=p.files[p.idx];v.cancelled=true;if(v.tableID&&v.toDel){q.model.resetImportSource(v.tableID);q.removeEMMASourceTable(null,{did:v.tableID});}u.success&&u.success();};if(k){n.reportid=k;}n.behaviorFlags=j.importBehaviorFlag.reserved;if(this.model.operationMode===j.operationMode.refresh||this.model.operationMode===j.operationMode.edit){if(mstrApp.isCloudPro){n.behaviorFlags=j.importBehaviorFlag.newColumnsSilent|j.importBehaviorFlag.dataTypeSilent;}}q.dataService.importFile(m,Y.wrapMethods(l,u,{cancel:t}),n);}function b(m,o,t,AB){var v=this;var u=v.model;var y=mstrmojo.all[m].tableID;var l;var p={xt:j.xdaType.dataImport};var k=u.getImportSource(y);t.files[t.idx].tableID=y;if(k.type===j.sourceType.file&&(k.subtype===j.sourceSubtype.localFile||k.subtype===j.sourceSubtype.clipboard)){var s=o.getFileName(t.idx);t.files[t.idx].fileName=s;f.call(v,o,t,{success:function(){if(AB.success){AB.success();}},failure:function(AC){if(AB.failure){AB.failure(AC);}}},y);}else{if((k.type===j.sourceType.file&&(k.subtype===j.sourceSubtype.cloudElement||k.subtype===j.sourceSubtype.url||k.subtype===j.sourceSubtype.samplefile||k.subtype===j.sourceSubtype.publicData))||k.type===j.sourceType.hadoop){t.files[t.idx].fileName=o.getFileUrl(t.idx);k.originTableInfo={};var n=k.sourceInfo;var q=n&&n.url;var AA=n&&n.sheetIndex;var x=n&&n.dbRoleId;if(k.subtype===j.sourceSubtype.cloudElement||k.subtype===j.sourceSubtype.url){var w=o.getFileUrl(t.idx);t.files[t.idx].isSDKBased=w&&w.indexOf(K)>-1;k.originTableInfo=mstrmojo.hash.copy(k.originTableInfo,{url:q,shtIx:AA,dbRoleId:x,fileType:n&&n.filet});}p.isUrl=true;p.url=o.getFileUrl(t.idx);if(k.type===j.sourceType.hadoop){p.fileType=B(o,p.url);var z=p.url.match(/.+\?hdfsURL=(.+)/);p.url=z?z[1]:p.url;p.xt=N(p.fileType);k.originTableInfo=mstrmojo.hash.copy(k.originTableInfo,{fileType:n&&n.filet,url:q,xt:k.xdaType});}if(o.tableidx){k.set("tableIdx",o.getUrlTableIndices(t.idx));k.set("currentIndex",o.getUrlTableIndices(t.idx));p.shtIx=k.tableIdx;}if(o.getFileUrlDBRole){l=o.getFileUrlDBRole(t.idx);}if((k.subtype===j.sourceSubtype.url||k.subtype===j.sourceSubtype.cloudElement)&&l){v.getDataService().setDBRole({success:function(){k.dbRoleId=l;v.setDataImportInfoURL(AB,p,y);},failure:function(AC){if(AB.failure){AB.failure(AC);}}},{tbid:y,dbrid:l});}else{v.setDataImportInfoURL(AB,p,y);}}}}function e(l,n,q,w,m){var t=this;var s=t.model;var o={success:function(x){var z=x.msgid;var y=x.tbid;if(z){t.dataService.set("messageID",z);}var AA=s.createImportSource(j.sourceType.file,m,y);var AB=n.getFileName(q.idx);q.files[q.idx].tableID=y;q.files[q.idx].toDel=true;AA.set("fileName",V.getAbsoluteFileName(AB));V.setTablesrc(t,l,y);f.call(t,n,q,w,y);},failure:function(x){if(w&&w.failure){w.failure(x);}}};var p={xt:j.xdaType.dataImport,dict:V.getBackendSourceType(m)};if(n.getFileTableID(q.idx)){if(w.success){w.success();}if(w.complete){w.complete();}return ;}if(!q.files[q.idx]){q.files[q.idx]={};}if(q.idx===0&&mstrmojo.all[l].tableID){b.call(t,l,n,q,w);return ;}if(m===j.sourceSubtype.localFile){q.files[q.idx].fileName=n.getFileName(q.idx);t.dataService.createEMMASourceTable(o,p);}else{if(m===j.sourceSubtype.url||m===j.sourceSubtype.samplefile||m===j.sourceSubtype.publicData||m===j.sourceSubtype.cloudElement){var u=n.getFileUrl(q.idx);var v;q.files[q.idx].fileName=u;q.files[q.idx].isSDKBased=u&&u.indexOf(K)>-1;p.isUrl=true;p.url=u;p.fileType=B(n,p.url);if(mstrmojo.all[l].scriptClass==="mstrmojo.DI.DIHadoop"){p.xt=N(p.fileType);p.url=u.match(/.+\?hdfsURL=(.+)/);p.url=p.url?p.url[1]:u;}if(n.getFileUrlDBRole){v=n.getFileUrlDBRole(q.idx);}if(v===null){v=t.hadoopController.dbRoleID;}var k={success:function(y){var AA=y.msgid;var z=y.tbid;p.tbid=z;if(AA){t.dataService.set("messageID",AA);}V.setTablesrc(t,l,z);function x(){var AB=s.createImportSource(j.sourceType.file,m,z);var AC=n.getFileUrl(q.idx);q.files[q.idx].tableID=z;q.files[q.idx].toDel=true;if(v){AB.dbRoleId=v;}AB.set("fileName",AC);if(n.tableidx){AB.set("tableIdx",n.getUrlTableIndices(q.idx));AB.set("currentIndex",n.getUrlTableIndices(q.idx));p.shtIx=AB.tableIdx;}AB.fileType=p.fileType;t.setDataImportInfoURL(w,p,z);}if(v){t.getDataService().setDBRole({success:function(){x();},failure:function(AB){if(w.failure){w.failure(AB);}}},{tbid:z,dbrid:v});}else{x();}}};if(C.startsWith(p.url,K)&&m!==j.sourceSubtype.cloudElement){p.dict=j.backendSourceSubtype.newConnector;}t.dataService.createEMMASourceTable(k,p);}}}function S(k,o,q,v,m,u){var t=this;var l=o.getFilesCnt();var p={idx:0,files:{}};function s(){var AA=[],AB=[],AC=[],z=0,y;mstrmojo.hash.forEach(p.files,function(AE,AD){if(AE.failed===true){AA.push(AD);if(AE.tableID&&AE.toDel){AB.push(AE.tableID);t.model.resetImportSource(AE.tableID);}}else{if(AE.tableID){AC.push(AE.tableID);}}});y=AC.length;var w={success:function(){z++;if(z>=y){if(AA.length>0){if(u&&u.failure){u.failure(p);}}else{if(u&&u.success){u.success(p);}}}},failure:function(){t.displayError(mstrmojo.desc(12897,"RS detection failure."));},complete:function(){if(z>=y){if(u&&u.complete){u.complete();}}}};var x={success:function(AD){if(AD&&AD.msgid){t.dataService.set("messageID",AD.msgid);}if(AC.length>0){O.forEach(AC,function(AE){t.dataService.detectRelationshipSourceTable(w,{did:AE});});}else{w.success();}},failure:function(){t.displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),true);}};if(AB.length>0){t.removeEMMASourceTable(x,{did:AB.join()});}else{x.success();}}var n={success:function(w){if(w&&w.msgid){t.dataService.set("messageID",w.msgid);}p.idx++;if(p.idx<l){e.call(t,k,o,p,n,m);}else{s();}},failure:function(w){p.files[p.idx].failed=true;p.files[p.idx].errRes=w;p.idx++;if(p.idx<l){e.call(t,k,o,p,n,m);}else{s();}}};if(l>0){e.call(t,k,o,p,n,m);}else{if(u&&u.success){u.success(p);}if(u&&u.complete){u.complete();}}}function E(l){var m,n,o;for(m in l){o=l[m].sheetsInfo;if(this.model.operationMode===j.operationMode.edit){if(l[m].sourceInfo){continue;}}if(l[m].subtype===j.sourceSubtype.localFile){if(!o){return false;}if(o.length===0){if(!l[m].isAutoMapped){return false;}}for(n=0;n<o.length;n++){if(!o[n].isAutoMapped&&o[n].selected){return false;}}}else{if(l[m].subtype===j.sourceSubtype.url||l[m].subtype===j.sourceSubtype.samplefile||l[m].subtype===j.sourceSubtype.publicData||l[m].subtype===j.sourceSubtype.cloudElement){if(!o){return false;}if(o.length===0){if(!l[m].isAutoMapped){return false;}}for(n=0;n<o.length;n++){if(!o[n].isAutoMapped&&o[n].selected){return false;}}}}}return true;}function L(m){var o,q,t,s,l,n=j.sourceSubtype,p=[];for(o in m){s=m[o];t=s.sheetsInfo;l=s.subtype;switch(l){case n.localFile:case n.url:case n.samplefile:case n.publicData:case n.hadoop:case n.cloudElement:if(!t){break;}if(t.length===0){if(!s.isAutoMapped){p.push(o);break;}}for(q=0;q<t.length;q++){if(!t[q].isAutoMapped&&t[q].selected&&t[q].is1stSheetAutoMapped!==true){p.push(o);break;}}break;}}return p;}function A(q,l){var k=this,n=k.model,o,p;o=mstrmojo.all[q]&&mstrmojo.all[q].tableID||l.files[l.idx-1]&&l.files[l.idx-1].tableID;p=n.getImportSource(o);if(p&&p.type===j.sourceType.hadoop){k.setDataImportInfoURL({},mstrmojo.hash.copy(p.originTableInfo,{isUrl:true}),o);}else{var m=p&&p.originTableInfo;if(m&&m.dbRoleId){k.getDataService().setDBRole({success:function(){k.setDataImportInfoURL({},mstrmojo.hash.copy(m,{isUrl:true}),o);},failure:function(s){console.log("revert dbrole on table failed with details:"+s);}},{tbid:o,dbrid:p.originTableInfo.dbRoleId});}else{if(m){k.setDataImportInfoURL({},mstrmojo.hash.copy(m,{isUrl:true}),o);}}}}function d(o,l,n,k,s){var p=this;o.idx=0;var t=true;var u=[];var m=function(){var y=p.model;var w=y.importSources,x,z=[];var v=E.call(p,w);if(v){if(y.operationMode===j.operationMode.create){for(x in w){z.push(x);}}else{for(x in w){if(!w[x].sourceInfo){z.push(x);}}}p.detectRelationshipSourceTable(null,z,n);}else{if(t){p.showSheetsSelectionDialog(u,n,null,k,v,q);t=false;}}};var q={success:function(){if(o.files[o.idx]){u.push(o.files[o.idx].tableID);}o.idx++;if(!s&&o.idx<l){p.getSheetsInfo(q,o.files[o.idx].tableID,j.requestFlag.sheets|0,n,o);}else{var w=[];var v=false;mstrmojo.hash.forEach(o.files,function(z){if(z.failed){v=true;w.push(z.tableID);}});if(v){var y={success:function(){p.tablesSrc[k]=[];Q.call(p,o,m);for(var z in o.files){if(o.files[z].failed){delete o.files[z];}}}};X.call(p,w,y,k);}else{if(t){var x=L.call(p,p.model.importSources);p.showSheetsSelectionDialog(x,n,null,k,o,q);t=false;}}}},failure:function(){o.idx++;var x=p.model.operationMode,v=mstrmojo.all[k]&&mstrmojo.all[k].tableID?true:false;if(x===j.operationMode.create||(x===j.operationMode.edit&&!v)){if(o.idx<l){p.getSheetsInfo(q,o.files[o.idx].tableID,j.requestFlag.sheets|0,n,o);}else{var y=[];var w=true;mstrmojo.hash.forEach(o.files,function(AA){if(AA.failed){y.push(AA.tableID);}else{w=false;}});var z={success:function(){if(w){F.call(p,o);A.call(p,k,o);}else{p.tablesSrc[k]=[];Q.call(p,o,m);for(var AA in o.files){if(o.files[AA].failed){delete o.files[AA];}}}}};if(mstrmojo.all[k]&&!mstrmojo.all[k].tableID){X.call(p,y,z,k);}else{z.success();}}}else{F.call(p,o);A.call(p,k,o);}},complete:mstrmojo.emptyFn};p.getSheetsInfo(q,o.files[o.idx].tableID,j.requestFlag.sheets|0,n,o);}function h(z,o,p,v,y,s){var q=mstrApp.getRootController(),w=q.dataService,l=[],n=0,u=[],t=[],m=[];function k(AB,AD){var AC=mstrmojo.hash.copy(z,{shtIx:AB.idx});if(AB.tableID){AC.tbid=AB.tableID;}else{AC.srctbid=v;AC.xt=o;}if(l.length>1){AC.behaviorFlags=j.behaviorChangeFlag.multiSheet;}w.autoMappingSourceTable(AD,AC);}function x(){mstrApp.hideProgress();if(m.length>0){u=u.concat(t);}if(u.length>0){if(!s){w.removeEMMASourceTable({success:function(){if(y.success){if(t.length>0){y.success({tableIDs:t});}else{y.failure({tableIDs:null,res:m[0]});}}if(y.complete){y.complete();}},failure:function(AB){if(y.failure){y.failure(AB);}if(y.complete){y.complete();}}},{did:u.join()});}else{if(y.failure){y.failure(m[0]);}if(y.complete){y.complete();}}}else{if(y.success){y.success({tableIDs:t});}if(y.complete){y.complete();}}}var AA={success:function(AB){if(AB&&AB.tbid){t.push(AB.tbid);}else{t.push(v);}},failure:function(AB){if(l[n].tableID){u.push(l[n].tableID);}m.push(AB);},complete:function(){n++;if(n<l.length){k(l[n],AA);}else{x();}}};O.forEach(p,function(AB){if(AB.selected){l.push(AB);}});if(l.length<=0){w.removeEMMASourceTable(y,{did:v});}else{mstrApp.showProgress();l[0].tableID=v;k(l[0],AA);}}function T(l){var m=l.code;var n=l.message;if(m===null||m===undefined){n=l.getResponseHeader("X-MSTR-TaskFailureMsg");}var o=n.indexOf("("),k=n.lastIndexOf(")");if(o>=0&&k>o){n=n.substring(o+1,k);}return n;}function R(m){var l=this;var k=[];var o=[];var n=l.rootView.currentPage;var q="<ul>";var p=false;mstrmojo.hash.forEach(m.files,function(v,u){var x=v.fileName;if(v.failed===true){k.push(x);if(v.isSDKBased){p=v.isSDKBased;var w=K.length;var s=x.indexOf(G)-1;x=x.substring(w,s);}var t=(typeof v.errRes==="string"||v.errRes instanceof String)?v.errRes:T(v.errRes);q+="<li>"+C.htmlAngles(x)+"<br>"+C.htmlAngles(t)||" </li>";}else{o.push(x);}});q+="</ul>";n.set("forceEnable",o.length>0?true:false);if(n.setFilesObject){n.setFilesObject(k);}if(p&&o.length===0){if(l.dialogController.pageZIndex>0){l.rootView.parent.close();}}return q;}function F(l){var k=this;var m=R.call(k,l);k.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,m);}function Q(l,o,n){var k=this;var p=R.call(k,l);var m={detailErrorMessage:p,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:n};k.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),o,m);}function c(o,m,n){var k=this,q=false,p,l;if(o===j.operationMode.edit&&m===j.sourceSubtype.url&&n){p=k.model.importSources[n];l=p.sourceInfo.partition;q=!!l&&l.isPartition&&p.xdaType===j.xdaType.text;}return q;}function g(l,s,x,AA,n,v){var y=this;var m=s.getFilesCnt();var w={idx:0,files:{}};var o=y.model.operationMode,z=false;if(mstrmojo.DI.DIHelpers.isOperationMode(mstrmojo.all[l].operationMode)){o=mstrmojo.all[l].operationMode;}var q={success:function(k){if(k&&k.msgid){y.dataService.set("messageID",k.msgid);}w.idx++;if(!z&&w.idx<m){e.call(y,l,s,w,q,n);}else{w=U(w);m=w.idx;if(m>0){d.call(y,w,m,v,l,z);}}},failure:function(AB){var k=w.files[w.idx];k.failed=true;k.errRes=AB;w.idx++;if(!z&&k.tableID&&k.toDel){y.model.resetImportSource(k.tableID);y.removeEMMASourceTable(null,{did:k.tableID});}mstrApp.hideProgress();var AC=y.getImportController().handleImportError(AB);mstrApp.getRootController().displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,AC);if(!z&&w.idx<m){e.call(y,l,s,w,q,n);}}};if(m>0){z=c.call(y,o,n,mstrmojo.all[l].tableID);if(z){I.call(y,l,s,w,q,n);}else{e.call(y,l,s,w,q,n);}}else{if(y.model.getAllTableID().length>0){var u=y.model.importSources;var p=[];for(var t in u){p.push(t);}if(E.call(y,y.model.importSources)){y.detectRelationshipSourceTable(null,p,v);}else{y.showSheetsSelectionDialog(p,v,null,l);}}}}function I(y,t,v,o,p){var q=this,k=mstrmojo.all[y].tableID,s,AB=t.getFilesCnt(),w,x=[],n,AA={xt:j.xdaType.dataImport},AC,u,l=q.model,m;function z(AD){q.getDataService().setDBRole({success:function(){u.dbRoleId=m;AD();},failure:function(AE){s.failure(AE);}},{tbid:k,dbrid:m});}if(!v.files[v.idx]){v.files[v.idx]={};}AC=t.getFileUrl(v.idx);v.files[v.idx].fileName=AC;v.files[v.idx].tableID=k;u=l.getImportSource(k);s={success:function(AD){var AE=AD.msgid;if(AE){q.dataService.set("messageID",AE);}if(u&&!u.fileName){u.set("fileName",AC);}AA.isUrl=true;AA.url=AC;q.setDataImportInfoURL(o,AA,k);},failure:function(){mstrApp.hideProgress();q.displayError(mstrmojo.desc(12392,"Encounter error when set partition!"));}};for(w=0;w<AB;w++){n=t.getFileUrl(w);x.push(n);}m=t.getFileUrlDBRole(0);if(x.length>1){mstrmojo.confirm(mstrmojo.desc(14708,"Do you want to group these files into a single partition table?"),{confirmBtn:{fn:function(){if(m){z(function(){q.partitionController.setPartitionURL(k,x,s);});}else{q.partitionController.setPartitionURL(k,x,s);}}}});}else{if(m){z(function(){q.partitionController.setPartitionURL(k,x,s);});}else{q.partitionController.setPartitionURL(k,x,s);}}}mstrmojo.DI.controller.ImportController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.ImportController",importMultiOAuthReports:function(k,AA,m,o){var w=mstrApp.getRootController();var l=w.getModel();var u=l.externalSources[k];var z=u.getSourceInfoParam(true);var p=null;var y=0,n=null;var x=[];var AD=[];function v(){if(o.failure){o.failure({reports:m,status:x});}if(o.complete){o.complete();}}function AB(){if(o.success){o.success({reports:m,status:x});}if(o.complete){o.complete();}}function q(AE,AG){var AF=mstrmojo.hash.copy(z,{reportAddress:AE.query,reportDesc:AE.desc===undefined?"":AE.desc,reportMimetype:AE.type===undefined?"":AE.type,reportName:AE.n});if(AE.tableID){AF.tbid=AE.tableID;}else{AF.xt=p;}if(AE.max){AF.reportMax=AE.max;}AF.dict=V.getBackendSourceType(AA);w.dataService.autoMappingSourceTable(AG,AF);}var AC={success:function(){if(AD.length>0){v();}else{AB();}}};function s(){var AH=[],AF=0,AG;var AE={success:function(){AF++;if(AF>=AG&&AC.success){AC.success();}},failure:function(AI){w.displayError(mstrmojo.desc(12901,"RS detection error."),false,AI.message);},complete:function(){if(AF>=AG&&AC.complete){AC.complete();}}};mstrmojo.array.forEach(x,function(AJ,AI){if(AJ.success){AH.push(AJ.tableID);}else{AD.push(AI);}});mstrApp.hideProgress();AG=AH.length;if(AH.length>0){O.forEach(AH,function(AI){w.dataService.detectRelationshipSourceTable(AE,{did:AI});});}else{v();}}var t={success:function(AE){n={success:true};if(AE&&AE.tbid){n.tableID=AE.tbid;}else{n.tableID=m[y].tableID;}x.push(n);},failure:function(AE){n={success:false,errCode:AE.code,errMsg:AE.message};x.push(n);},complete:function(){y++;if(y>=m.length){s();}else{q(m[y],t);}}};z.behaviorFlags=j.importBehaviorFlag.reserved;if(l.operationMode===j.operationMode.refresh||l.operationMode===j.operationMode.edit){if(mstrApp.isCloudPro){z.behaviorFlags=j.importBehaviorFlag.newColumnsSilent|j.importBehaviorFlag.dataTypeSilent;}}if(!m||m.length<=0){AB();return ;}switch(k){case j.sourceType.googleDrive:p=J.dataImportOAuthGDrive;break;case j.sourceType.dropbox:p=J.dataImportOAuthDropbox;break;case j.sourceType.salesforce:p=J.dataImportOAuthSalesforce;break;case j.sourceType.googleAnalytics:p=J.dataImportOAuthGAnalytics;break;case j.sourceType.googleBigQuery:p=J.dataImportOAuthGBigQuery;break;case j.sourceType.twitter:p=J.twitter;break;case j.sourceType.facebook:p=J.facebook;break;}if(p===null){return ;}mstrApp.showProgress();q(m[0],t);},refreshDataOAuthReport:function(v,z,u,p,n,y){var s=mstrApp.getRootController(),q=s.getModel(),x=s.dataService,AA=q.externalSources[v],AB=AA&&AA.getSourceInfoParam(true),o,k;function w(AC){if(y.failure){y.failure(AC);}if(y.complete){y.complete();}}function m(){x.detectRelationshipSourceTable(y,{did:u});}var t={success:function(){m();},failure:function(AC){w(AC);}};if(!AA||!p||!u){w();}var l={success:function(){o=mstrmojo.hash.copy(AB,{behaviorFlags:j.behaviorChangeFlag.refreshData,reportAddress:p.query,reportDesc:p.desc,reportMimetype:p.type,reportName:p.n,reportMax:p.max===undefined?"":p.max,dict:V.getBackendSourceType(z),tbid:u});x.autoMappingSourceTable(t,o);},failure:function(AC){w(AC);}};k=q.getImportSource(u);if(k.sourceInfo.isRefined){o=mstrmojo.hash.copy(AB,{reportAddress:p.query,reportDesc:p.desc,reportMimetype:p.type,reportName:p.n,tbid:u});x.setDataImportInfo(l,o);}else{l.success();}},importMultiFBReports:function(l,AA,n,o){var v=mstrApp.getRootController(),m=v.getModel(),x=v.dataService,t=m.externalSources[l],z=t.getSourceInfoParam(true),p=j.xdaType.facebook,AD={},k=[],w=[],AC,y=0,q;function u(){if(o.failure){o.failure({reports:n});}if(o.complete){o.complete();}}function AB(){if(o.success){o.success({reports:n,status:w});}if(o.complete){o.complete();}}var AE={success:function(){var AF={success:true};w.push(AF);y++;if(q&&y>=q.length){AB();}},failure:function(AF){var AG={success:false,errCode:AF.code,errMsg:AF.message};w.push(AG);}};var s={success:function(AF){q=AF&&AF.tbids;if(q.length>0){O.forEach(q,function(AG){v.dataService.detectRelationshipSourceTable(AE,{did:AG.tbid});});}else{u();}},failure:function(AF){var AG={success:false,errCode:AF.code,errMsg:AF.message};w.push(AG);u();}};O.forEach(n,function(AF){k.push({reportName:AF.n,reportAddress:AF.query,reportMimetype:AF.type===undefined?"":AF.type,reportDesc:AF.desc===undefined?"":AF.desc});});AD.reports=k;AC=mstrmojo.hash.copy(z,{xt:p,hasMultiOAuth:true,multiOAuthReports:JSON.stringify(AD),dict:V.getBackendSourceType(AA)});x.autoMappingSourceTable(s,AC);},importMultiOAuthFileReports:function(k,AC,m,n){var w=mstrApp.getRootController(),l=w.getModel(),y=w.dataService,u=l.externalSources[k],AB=u&&u.getSourceInfoParam(true),AA=0,z=null,s=null,t=[],AF;function AE(){var AG=false,AH=[];O.forEach(m,function(AI){AH.push(AI.status);if(AI.status&&AI.status.success===false){AG=true;}});if(AG){if(n.failure){n.failure({reports:m,status:AH});}}else{if(n.success){n.success({reports:m,status:AH});}}if(n.complete){n.complete();}}function q(AG,AJ){var AI={success:function(AK){AG.id=AG.tableID;AG.sheets=AK.sheets;if(AG.sheets.length>0){AG.sheets[0].selected=true;}AG.multiSelection=true;if(AJ.success){AJ.success();}if(AJ.complete){AJ.complete();}},failure:function(AK){if(AJ.failure){AJ.failure(AK);}if(AJ.complete){AJ.complete();}}};var AH={success:function(AK){if(AK&&AK.tbid){AG.tableID=AK.tbid;}AF=mstrmojo.hash.copy(AB,{reportAddress:AG.query,reportDesc:AG.desc,reportMimetype:AG.type,reportName:AG.n});Z(AF,AG.tableID,AI);},failure:function(AK){if(AJ.failure){AJ.failure(AK);}if(AJ.complete){AJ.complete();}}};y.createEMMASourceTable(AH,{xt:s,dict:V.getBackendSourceType(AC)});}function p(){var AH=0,AI;mstrApp.showProgress();var AG={success:function(){AH++;if(AH>=AI){AE();}},failure:function(AJ){w.displayError(mstrmojo.desc(12901,"RS detection error."),false,AJ.message);},complete:function(){if(AH>=AI){mstrApp.hideProgress();mstrApp.hideProgress();}}};AI=t.length;if(t.length>0){O.forEach(t,function(AJ){y.detectRelationshipSourceTable(AG,{did:AJ});});}else{AG.success();AG.complete();}}function v(AG,AH){AF=mstrmojo.hash.copy(AB,{reportAddress:AG.query,reportDesc:AG.desc,reportMimetype:AG.type,reportName:AG.n});h(AF,s,AG.sheets,AG.tableID,AH);}var AD={success:function(AG){if(AG.tableIDs&&AG.tableIDs.length>0){t=t.concat(AG.tableIDs);}AA++;if(AA<m.length){z=m[AA];v(z,AD);}else{p();}},failure:function(AG){z.status.success=false;z.status.errCode=AG&&AG.res&&AG.res.code;z.status.errMsg=AG&&AG.res&&AG.res.message;AA++;if(AA<m.length){z=m[AA];v(z,AD);}else{p();}}};function x(){mstrApp.showProgress();AA=0;z=m[AA];AF=mstrmojo.hash.copy(AB,{reportAddress:z.query,reportDesc:z.desc,reportMimetype:z.type,reportName:z.n});h(AF,s,z.sheets,z.tableID,AD);}var o={failure:function(AG){z.status.success=false;z.status.errCode=AG.code;z.status.errMsg=AG.message;},complete:function(){var AG=false,AJ=[],AI=[],AH;AA++;if(AA<m.length){z=m[AA];z.status={success:true};q(z,o);}else{O.forEach(m,function(AK){if(AK.sheets&&AK.sheets.length>1){AG=true;AI.push(AK);}else{AJ.push(AK);}});if(AG){AH={items:AI,onOK:function(){m=this.items?this.items.concat(AJ):AJ;this.close();x();},onBack:function(){var AK=[];O.forEach(m,function(AL){if(AL.tableID){AK.push(AL.tableID);}});if(AK.length>0){w.dataService.removeEMMASourceTable(null,{did:AK.join()});}}};w.showDialog(j.dialogType.sheetsSelectionDialog,AH);}else{x();}}}};if(!u||!m||m.length<=0){AE();return ;}switch(k){case j.sourceType.googleDrive:s=J.dataImportOAuthGDrive;break;case j.sourceType.dropbox:s=J.dataImportOAuthDropbox;break;}if(s===null){return ;}z=m[AA];z.status={success:true};q(z,o);},refreshDataOAuthFileReport:function(v,z,u,q,m,y){var t=mstrApp.getRootController(),x=t.dataService,AA=t.getModel().externalSources[v],k=null,AB=AA&&AA.getSourceInfoParam(true),l=t.getModel().getImportSource(u),p=mstrmojo.hash.copy(AB,{reportAddress:q.query,reportDesc:q.desc,reportMimetype:q.type,reportName:q.n});function w(AC){if(y.failure){y.failure(AC);}if(y.complete){y.complete();}}var o={success:function(){x.detectRelationshipSourceTable(y,{did:u});},failure:function(AC){w(AC);}};function s(){h(mstrmojo.hash.copy(p,{behaviorFlags:j.behaviorChangeFlag.refreshData}),k,q.sheets,u,o,true);}var n={success:function(AE){var AD,AC;q.sheets=AE.sheets;q.multiSelection=false;q.defaultSheetsIndex=0;if(l&&l.sourceInfo){AC=O.find(AE.sheets,"idx",l.sourceInfo.sheetIndex);if(AC>-1){q.defaultSheetsIndex=AC;}}if(q.sheets.length>1){AD={items:[q],onOK:function(){q=this.items[0];this.close();s();}};t.showDialog(j.dialogType.sheetsSelectionDialog,AD);}else{q.sheets[0].selected=true;s();}},failure:function(AC){w(AC);}};switch(v){case j.sourceType.googleDrive:k=J.dataImportOAuthGDrive;break;case j.sourceType.dropbox:k=J.dataImportOAuthDropbox;break;}if(k===null){return ;}if(l){if(!l.isExtensionValid(q.n)){t.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}}Z(p,u,n);},importProjects:function(s,o,p){var k=mstrApp.getRootController(),q=k.dataService,n=null;function m(u){var t={code:u.code,message:u.message};if(n){q.removeEMMASourceTable({success:function(){if(s.failure){s.failure(t);}if(s.complete){s.canceled();}},failure:function(v){k.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,v.message);}},{did:n});}else{if(s.failure){s.failure(t);}if(s.complete){s.complete();}}}var l={success:function(t){if(t&&t.tbid){n=t.tbid;}if(s.success){s.success(t);}},failure:function(t){m(t);}};q.createEMMASourceTable(l,{xt:j.xdaType.projectsImport,dbrId:o,cubeId:p});},importClipboard:function(l,u){var o=mstrApp.getRootController(),q=o.dataService,p=null,m=l.uploader;function s(w){var v={code:w.code,message:w.message};if(p){q.removeEMMASourceTable({success:function(){if(u.failure){u.failure(v);}if(u.complete){u.canceled();}},failure:function(x){o.displayError(mstrmojo.desc(12902,"Remove EMMA Source Table Error."),false,x.message);}},{did:p});}else{if(u.failure){u.failure(v);}if(u.complete){u.complete();}}}var n={success:function(){q.detectRelationshipSourceTable(u,{did:p});},failure:function(v){s(v);}};var k={success:function(){q.autoMappingSourceTable(n,{tbid:p,shtIx:0,dlmt:",",qt:'\\"'});},failure:function(v){s(v);},complete:function(){mstrApp.hideProgress();}};var t={success:function(v){if(v&&v.tbid){p=v.tbid;}q.importFile(m,k,{msgID:q.messageID,tableID:p});},failure:function(v){s(v);}};q.createEMMASourceTable(t,{xt:j.xdaType.dataImport,dict:j.backendSourceSubtype.clipboard});},refreshDataClipboard:function(q,m,l,u){var p=mstrApp.getRootController(),s=p.dataService,n=m.uploader;function t(v){if(u.failure){u.failure(v);}if(u.complete){u.complete();}}var o={success:function(){s.detectRelationshipSourceTable(u,{did:q});},failure:function(v){t(v);}};var k={success:function(){s.autoMappingSourceTable(o,{tbid:q,shtIx:0,behaviorFlags:j.behaviorChangeFlag.refreshData});},failure:function(v){t(v);},complete:function(){mstrApp.hideProgress();}};s.importFile(n,k,{msgID:s.messageID,tableID:q});},handleImportError:function P(t,p){var q=t.code,x=t.message;if(q===undefined||q===null){q=parseInt(t.getResponseHeader("X-MSTR-TaskErrorCode"),10);x=t.getResponseHeader("X-MSTR-TaskFailureMsg");}var s=mstrApp.getRootController();var l=s.model;if(q===j.backendError.cubeQuotaReached){x=mstrmojo.desc(13031,"We could not import your data because there is not enough space left. Please consider removing some rows/columns and try again or contact your administrator.");}else{if(q===j.backendError.fileVersionError){x=mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher.");}else{if(q===j.backendError.salesforceUnsavedReport){x=mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!");}else{if(q===j.backendError.emptySheet){x=mstrmojo.desc(12618,"The import process cannot proceed with an empty sheet.");}else{if(q===j.backendError.salesforceUnresolvedFilter){x=mstrmojo.desc(12789,"You cannot import a Salesforce report with any unresolved filters.");}else{if(q===j.backendError.noExternalSourceInfo){var k=x.indexOf("Google Analytics");var o=x.indexOf("\t");x=x.substring(k,o);}else{if(q===j.backendError.switchingFileType){x=mstrmojo.desc(12790,"Switching the source file type between Excel, CSV and Text is not allowed. You had previously used ####. Please use the same file type.").replace("####",l.currentSource.sourceInfo.name);}else{if(q===j.backendError.memoryConsumptionExceeded){var n="";if(x.indexOf("Max memory size limit: ")>-1){var v=x.indexOf("Max memory size limit: ")+23;var u=x.indexOf(".",v);n="("+x.substring(v,u)+") ";}x=mstrmojo.desc(12791,"Memory consumption limit during data fetching #### is exceeded.").replace("####",n);}else{if(q===j.backendError.switchingFileType){x=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");}else{if(q===j.backendError.unsupportedFileFormat){x=mstrmojo.desc(12619,"Only UTF 8/16 CSV or text files are supported. Save the file as UTF or 16 codepage and import again.");}}}}}}}}}}var w="<ul><li>"+p+"<br>"+x||T(t)+"</li></ul>";return w;},importFile:function a(o,q,y,w,k,l,p){var v=mstrApp.getRootController();var u,t,s=null;var n={success:function(){var AB=v.model.getAllTableID();if(k){v.tablesSrc[k]=[];for(t=0;t<AB.length;t++){if(O.indexOf(u,AB[t])===-1){v.tablesSrc[k].push(AB[t]);}}if(s&&s.length){for(t=0;t<AB.length;t++){v.navigationController.deleteRoute(s[t]);}}}var z=j.requestFlag.mapping|j.requestFlag.sourceInfo|j.requestFlag.relationship,AA=y?0:-1;v.getImportedDataEMMA(M.importSource,z,AA);},failure:function(z){F.call(v,z);},complete:function(){mstrApp.hideProgress();}};var x={success:function(z){if(z&&z.msgid){v.dataService.set("messageID",z.msgid);}if(l){g.call(v,k,o,q,y,j.sourceSubtype.localFile,p);}else{S.call(v,k,o,q,y,j.sourceSubtype.localFile,n);}},failure:function(z){v.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,z.message||"");}};var m={success:function(){u=v.model.getAllTableID();if(w){v.createNewReportInstance(x);}else{if(l){g.call(v,k,o,q,y,j.sourceSubtype.localFile,p);}else{S.call(v,k,o,q,y,j.sourceSubtype.localFile,n);}}},failure:function(){v.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(k){s=[];for(t=0;v.tablesSrc[k]&&t<v.tablesSrc[k].length;t++){if(v.model.getImportSource(v.tablesSrc[k][t])){s.push(v.tablesSrc[k][t]);}}X.call(v,s,m,k);}else{m.success();}},importURL:function H(n,k,z,x,l,m,q){var v=mstrApp.getRootController();var u,t,s;var w=j.sourceSubtype.url;if(n.scriptClass==="mstrmojo.DI.DISampleFiles"){w=j.sourceSubtype.samplefile;}if(n.scriptClass==="mstrmojo.DI.DIPublicData"){w=j.sourceSubtype.publicData;}if(mstrmojo.all[l].isFromCloudElement){w=j.sourceSubtype.cloudElement;}var p={success:function(){var AC=v.model.getAllTableID();if(l){v.tablesSrc[l]=[];for(t=0;t<AC.length;t++){if(O.indexOf(u,AC[t])===-1){v.tablesSrc[l].push(AC[t]);}}if(s&&s.length){for(t=0;t<AC.length;t++){v.navigationController.deleteRoute(s[t]);}}}var AA=j.requestFlag.mapping|j.requestFlag.sourceInfo|j.requestFlag.relationship,AB=z?0:-1,AD;AD={onOK:function(){v.getImportedDataEMMA(M.importSource,AA,AB);},onCancel:function(AE){v.getImportedDataEMMA(M.importSource,AA,AB,undefined,undefined,undefined,undefined,AE);}};if(!v.rootView.currentPage.tableID){v.autoDetectPartitionGroups(AD,AB);}else{v.getImportedDataEMMA(M.importSource,AA,AB);}},failure:function(AA){F.call(v,AA);}};var y={success:function(AA){if(AA&&AA.msgid){v.dataService.set("messageID",AA.msgid);}g.call(v,l,n,k,z,w,q);},failure:function(AA){v.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,AA.message||"");}};var o={success:function(){u=v.model.getAllTableID();if(x){v.createNewReportInstance(y);}else{if(m){g.call(v,l,n,k,z,w,q);}else{S.call(v,l,n,k,z,w,p);}}},failure:function(){v.displayError(mstrmojo.desc(12903,"remove previous imported table failed"));}};if(l){s=[];for(t=0;v.tablesSrc[l]&&t<v.tablesSrc[l].length;t++){if(v.model.getImportSource(v.tablesSrc[l][t])){s.push(v.tablesSrc[l][t]);}}X.call(v,s,o,l);}else{o.success();}},removeMultipleSourceTables:function D(l){var k=mstrApp.getRootController();var m={success:function(){},failure:function(){k.displayError(mstrmojo.desc(12904,"Failed to remove 1 or more tables"));}};X.call(k,l,m);},importFromCube:function(l,m){var k=mstrApp.getRootController();k.getDataService().getImportFromCube(m,{did:l});},refreshDataLocalFile:function(s,n,m,v){var q=mstrApp.getRootController(),u=q.dataService,o=n.uploader,k=q.getModel().getImportSource(s);function t(w){if(v.failure){v.failure(w);}if(v.complete){v.complete();}}var p={success:function(){u.detectRelationshipSourceTable(v,{did:s});},failure:function(w){t(w);}};var l={success:function(){u.autoMappingSourceTable(p,{tbid:s,shtIx:k.sourceInfo.sheetIndex,behaviorFlags:j.behaviorChangeFlag.refreshData});},failure:function(w){t(w);},complete:function(){mstrApp.hideProgress();}};u.importFile(o,l,{msgID:u.messageID,tableID:s,fileName:o.getFileName?o.getFileName():k.name,});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIModel","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(11636);var C=mstrmojo.func,D=mstrmojo.hash,A={style:{params:{treesToRender:1}},hideCancel:true};mstrmojo.DI.controller.DIDocController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIDocController",submitUpdate:function(I,J,H){var G=mstrApp,F=mstrApp.launchingApp,E={success:function(K){window.mstrApp=G;if(K&&K.mid){mstrApp.getRootController().getModel().analysisID=K.mid;}},failure:function(){window.mstrApp=G;}};window.mstrApp=F;if(mstrApp.rootCtrl.docCtrl){mstrApp.rootCtrl.docCtrl.cmdMgr.getInterimCmd().submitInterim(I,C.wrapMethods(E,J,{}),H);}else{E.success();J.success();}},createNewManagedDataset:function(G,F){var E={act:"createDataset",mgo:true,name:mstrmojo.desc(11636,"New Dataset"),prm:true,rid:"4B43EC5548911FC01AF5D3ACE3F16256",disablePU:true,execFlags:131072};this.submitUpdate(D.copy(F,E),G,{style:{params:{treesToRender:1}},hideCancel:true});},removeDataset:function(G,F){var E={act:"removeDataset",did:F&&F.id,disablePU:true};if(F&&F.id){this.submitUpdate(E,G,A);}},renameDataset:function B(F,E,H){var G={act:"renameDataset",datasetID:F,name:E};this.submitUpdate(G,H,A);},setDatasetDDA:function(H,G){var F={act:"toggleDatasetServeMode",execFlags:131072,dsid:G&&G.id,dsm:2};var E={style:{params:{treesToRender:1}},params:{stateID:-1}};if(G&&G.id){this.submitUpdate(F,H,E);}},getVIModelDatasets:function(){var E=mstrApp.launchingApp,F=null,G=[];if(E&&E.rootCtrl&&E.rootCtrl.docCtrl&&E.rootCtrl.docCtrl.model){F=E.rootCtrl.docCtrl.model.datasets;D.forEach(F,function(H){G.push(H);});}return G;},getVIDocData:function(F){var E={style:{params:{treesToRender:0}},hideCancel:true};this.submitUpdate([],F,E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIConstants","mstrmojo.DI.DIMultiFormEditor","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(13134,13136,13396,13887,14451);var g=mstrmojo.DI.DIConstants,D=mstrmojo.DI.DIConstants.formsOptions,O=mstrmojo.array,Y=mstrmojo.hash,J=mstrmojo.DI.DIHelpers;function L(l,k){var n=l.linkedTbs,h=l.tableId,m=k.linkedTbs,q=k.tableId,o,p,j;if(!n&&!m){return h===q;}if(n&&m){o=false;Y.forEach(m,function(s,t){if(s){if(n[t]){o=true;return false;}}});return o;}p=n||m;j=n?q:h;return p[j];}function H(j,k,l,m){var h=O.find(j,k,m);if(h<0){return"";}return Y.walk(h.toString()+"."+l,j);}function F(k,j){var h=O.map(k,function(l){if(l.formId===j){return 0;}else{return 1;}});return h.join(",");}function X(s,o,m){var x="ID",t,h,AB,AA="DESC",u,j,v,p,q,z,k,w,n="",l,y;if((s&&s.length===0)||o.length===0){return"";}w=Y.walk("0.forms",o);t=H(w,"fmn","fmid",x);u=H(w,"fmn","fmid",AA);h=H(o,"formId","columnId",t);j=H(o,"formId","columnId",u);AB=H(s,"columnId","georole",h);v=H(s,"columnId","georole",j);if(m){if(!AB){AB=H(m,"did","georole",h);}if(!v){v=H(m,"did","georole",j);}}if(AB>0){n=F(o,t);}else{if(v>0){n=F(o,u);}else{l=O.filter(s,function(AC){return AC.georole>0;});if(m){y=O.filter(m,function(AC){return AC.georole>0;});}if(l.length===0){n=O.map(o,function(AC){return"0";}).join(",");return n;}p=H(l,"dtp","columnId",g.dataTypeMenuItems.TEXT);if(m&&!p){p=H(y,"dtp","did",g.dataTypeMenuItems.TEXT);}if(p){q=H(o,"columnId","formId",p);n=F(o,q);}else{z=l[0].columnId;if(m&&!z){z=y[0].did;}k=H(o,"columnId","formId",z);n=F(o,k);}}}return n;}mstrmojo.DI.controller.DIFormsController=mstrmojo.declare(mstrmojo.Obj,null,{getLinkedAttribute:function a(h){var j,k=[];for(j=0;j<h.length;j++){if(this.isLinkedAttribute(h[j])){k.push(h[j]);}}return k;},countLinkedAttribute:function a(h){var k=0,j;for(j=0;j<h.length;j++){if(this.isLinkedAttribute(h[j])){k++;}}return k;},countSingleFormLinkedAttribute:function R(h){var k=0,j;for(j=0;j<h.length;j++){if(this.isLinkedAttribute(h[j])&&this.isAllSingleFormAttribute(h[j])){k++;}}return k;},getLinkedColumnId:function K(l,h,m){var k,j;if(this.isLinkedAttribute(l)&&!this.isSingleFormAttribute(l)){j=l.subColumns;for(k=0;k<j.length;k++){if(j[k].fmid===m||j[k].isIdForm){return j[k].did;}}}else{for(k=0;k<h.length;k++){if(this.isLinkedAttribute(h[k])){return h[k].did;}}}},isLinkedAttribute:function f(h){return h.isLinked;},isSingleFormAttribute:function Q(h){return !(h.isMultiForm);},isAllSingleFormAttribute:function(k){var j=true,h;if(!k.isLinked){j=!(k.isMultiForm);}else{h=mstrApp.getRootController().getModel().findMappingItem(k);O.forEach(h,function(l){if(l.isMultiForm){j=false;return false;}});}return j;},isVisible:function W(j,h){switch(j){case D.ADDTO_MULTIFORM_ATTRIBUTE:return this.isVisibleAddtoMultiformAttribute(h);case D.CREATE_MULTIFORM_ATTRIBUTE:return this.isVisibleCreateMultiformAttribute(h);case D.EDIT_MULTIFORM_ATTRIBUTE:return this.isVisibleEditMultiformAttribute(h);}return false;},isVisibleAddtoMultiformAttribute:function P(j){if(j.length<2){return false;}var k=0,h;for(h=0;h<j.length;h++){if(!(this.isAllSingleFormAttribute(j[h]))){k++;}if(k>=2){return false;}if(j[h].ipa){return false;}if(!L(j[0],j[h])){return false;}}return(k===1);},isVisibleCreateMultiformAttribute:function c(j){if(j.length<2){return false;}var h;for(h=0;h<j.length;h++){if(!(this.isAllSingleFormAttribute(j[h]))){return false;}if(j[h].ipa){return false;}}return true;},isVisibleEditMultiformAttribute:function V(h){if(h.length!==1){return false;}return !(this.isSingleFormAttribute(h[0]))&&h[0].subColumns&&h[0].subColumns[0].ipa!==1;},onClick:function I(j,l,k,h){switch(j){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.onClickAddtoMultiformAttribute(l,h);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.onClickCreateMultiformAttribute(l,k,h);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.onClickEditMultiformAttribute(l,k);break;}},onClickAddtoMultiformAttribute:function C(l,j){var k=null,h;for(h=0;h<j.length;h++){if(!(this.isAllSingleFormAttribute(j[h]))){if(k!==null){return ;}k=j[h];}}var m=this.countSingleFormLinkedAttribute(j);if(this.isLinkedAttribute(k)){if(m>=1){this.showUnlinkError();}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,l,k,j,true);}}else{if(m>=2){this.showUnlinkError();}else{if(m===1){k=this.getLinkedAttribute(j)[0];this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,l,k,j,true);}else{this.showMultiformDialog(D.ADDTO_MULTIFORM_ATTRIBUTE,l,k,j,false);}}}},checkMultiLinkedAttributes:function N(s){var p=this.getLinkedAttribute(s);var o=mstrApp.getRootController();var n=o.model;var v,u=[],q;O.forEach(p,function(j){q="";v=n.findMappingSource(j);O.forEach(v,function(w){q+=w.tableID;q+=";";});u.push(q);});var t=u[0].split(";");var m,l,k=false,h=t.length;for(m=0;m<u.length;m++){if(u[m].split(";").length!==h){k=true;break;}}if(k){return false;}for(m=0;m<t.length;m++){for(l=1;l<u.length;l++){if(u[l].indexOf(t[m])===-1){k=true;break;}}}if(k){return false;}return true;},onClickCreateMultiformAttribute:function B(n,m,l){var k=this.countLinkedAttribute(l),o=mstrApp.getRootController(),h=false,p=false;for(var j=0;j<l.length;j++){if(l[j].recursive){h=true;}else{if(l[j].isLinked){p=true;}}}if(h&&p){o.displayError(mstrmojo.desc(null,"We do not support a MFA with a linked non-hierarchy attribute."));return ;}if(k>=2){if(!this.checkMultiLinkedAttributes(l)){this.showCreateMFAError();return ;}m=this.getLinkedAttribute(l)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,n,m,l,true,true);}else{if(k===1){m=this.getLinkedAttribute(l)[0];this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,n,m,l,true);}else{this.showMultiformDialog(D.CREATE_MULTIFORM_ATTRIBUTE,n,m,l,false);}}},onClickEditMultiformAttribute:function b(j,h){if(this.isLinkedAttribute(h)){this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,j,h,[h],true);}else{this.showMultiformDialog(D.EDIT_MULTIFORM_ATTRIBUTE,j,h,[h],false);}},showMultiformDialog:function e(o,j,h,n,q,m){var p=mstrApp.getRootController(),s=this.showMultiformDialog2,l="",t;for(t=0;t<n.length;t++){l+=n[t].oid;if(t<n.length-1){l+=",";}}var k={tableID:j,selectedAttributeIds:l};var u={success:function(v){s(o,j,h,n,q,v,m);},failure:function(v){p.displayError(mstrmojo.desc(13134,"Cannot retrieve attribute form info.")+v);}};p.dataService.getAttributeGroupInfo(u,k);},showMultiformDialog2:function A(p,n,o,m,k,AA,j){var q=[],h=[],y=[],l=null,s={},z,t,v;var x=function(AC,AB){return AC.name===AB.name;};s.tableIds=[n];s.tables={};h=AA.agi.fms;y=AA.agi.attribute_forms;l=AA.agi.ts;if(p===D.EDIT_MULTIFORM_ATTRIBUTE&&k&&l.length>1){v=l[0].maps;for(t=1;t<l.length;t++){v=J.getCommonElements(v,l[t].maps,x);}if(v.length>=2){j=true;}}for(t=0;t<l.length;t++){var w=l[t];q=w.maps;var u=w.tbid;if(u!==n){s.tableIds.push(u);}z=mstrApp.getRootController().formsController.populateMFACommand(q,h,y,p,k,o,m,w.tbid,w.tbn,j);s.tables[u]=z;}mstrApp.getRootController().showDialog(g.dialogType.multiFormEditor,s);},populateMFACommand:function d(AA,j,AK,y,q,x,u,w,m,k){var s=[],AI=null,v,AG,AC,AF,AD;v=j[0].fmid;AG=j[0].fmn;AC=j.slice(0);O.forEach(AA,function(AO){var l=O.find(AC,"fmid",AO.fmid);if(l<0){var AN=O.find(AK,"fmid",AO.fmid);if(AN>=0){AC.push({fmid:AK[AN].fmid,fmn:AK[AN].fmn,});}else{AC.push({fmid:AO.fmid,fmn:AO.fmn||AO.name});}}});if(q&&!k){if(AC[0].fmn==="ID"){AC.splice(0,1);}}for(AF=0,AD=AA.length;AF<AD;AF++){var o=AA[AF],h=o.cmid,AM=o.name,AL=o.fmid,p=o.flags,AB=o.alias,t=o.isdf?"1":"0",n=o.atid;var z=O.find(u,"did",h);if(z!==-1){AM=u[z].alias;}var AH={columnId:h,name:AM,formId:AL,displayForm:t,remove:"0",forms:AC,flags:p,alias:AB,atid:n};s.push(AH);if(AL===v){AI=AH;}}var AJ={};AJ.formsOption=y;AJ.tableId=w;AJ.tableName=m;AJ.attribute=x;AJ.attributes=u;AJ.isShared=q;AJ.isMultiLinked=k;AJ.formMaps=s;AJ.idMap=AI;AJ.idFormId=v;AJ.idFormName=AG;if(q){var AE=mstrApp.getRootController().formsController.getLinkedColumnId(x,u,v);if(AE){AJ.linkedColumnId=AE;}}return AJ;},showUnlinkError:function M(){var h=mstrApp.getRootController();h.displayError(mstrmojo.desc(13396,"Unlink the Attribute that you want to use as the Non-ID form."));},showCreateMFAError:function U(){var h=mstrApp.getRootController();h.displayError(mstrmojo.desc(14451,"Unable to create Multi-form attribute since the selected attributes are not present in all tables."));},updateMapping:function G(k,m,l,h,n,p,j,o){switch(k){case D.ADDTO_MULTIFORM_ATTRIBUTE:this.updateMappingAddtoMultiformAttribute(m,l,h,n,p,j,o,514);break;case D.CREATE_MULTIFORM_ATTRIBUTE:this.updateMappingCreateMultiformAttribute(m,l,n,p,j,o,514,h);break;case D.EDIT_MULTIFORM_ATTRIBUTE:this.updateMappingEditMultiformAttribute(m,l,h,n,p,j,o,640);break;}},updateMappingAddtoMultiformAttribute:function T(m,l,j,n,p,k,o,h){this.updateMappingSourceTable(m,false,l.oid,l.alias,p,k,o,h,j);},updateMappingCreateMultiformAttribute:function E(m,l,n,p,k,o,h,j){if(n){this.updateMappingSourceTable(m,true,l.oid,l.alias,p,k,o,h,j);}else{this.updateMappingSourceTable(m,true,"",l.alias,p,k,o,h,j);}},updateMappingEditMultiformAttribute:function Z(m,l,j,n,p,k,o,h){this.updateMappingSourceTable(m,false,l.oid,l.alias,p,k,o,h);},updateMappingSourceTable:function S(x,j,AC,AA,s,AJ,n,p,u){if(j){AC="";}var AD="",q="",t="",m="",AH="",AB="",z="",AG,AL,AF,o,v,w=u?O.find(u,"columnId",AJ.columnId):-1,l=mstrApp.getRootController().getModel();for(AG=0;AG<s.length;AG++){AD+=s[AG].columnId;if(AG<s.length-1){AD+=",";}q+=s[AG].formId;if(AG<s.length-1){q+=",";}t+=s[AG].displayForm;if(AG<s.length-1){t+=",";}m+=s[AG].remove;if(AG<s.length-1){m+=",";}var AE=s[AG].flags;if((AE&g.formMappingFlag.formMappingFlagRemoveGeoRole)===g.formMappingFlag.formMappingFlagRemoveGeoRole){AH+="1";}else{AH+="0";}if(AG<s.length-1){AH+=",";}if((AE&g.formMappingFlag.formMappingFlagRemoveTimeRole)===g.formMappingFlag.formMappingFlagRemoveTimeRole){AB+="1";}else{AB+="0";}if(AG<s.length-1){AB+=",";}if((AE&g.formMappingFlag.formMappingFlagRemoveDeriveFlags)===g.formMappingFlag.formMappingFlagRemoveDeriveFlags){z+="1";}else{z+="0";}if(AG<s.length-1){z+=",";}}if(j){AH=X(u,s);}else{var h=H(u,"isMultiForm","subColumns",true);AH=X(u,s,h);}var AI={newAttribute:j,tableId:x,attributeId:AC,attributeName:AA,idMapColumnId:AJ.columnId,idMapFormId:AJ.formId,idMapDisplayForm:AJ.displayForm,formMapsColumnIds:AD,formMapsFormIds:q,formMapsDisplayForms:t,formMapsRemoves:m,formMapsRemoveGeoRoleFlags:AH,formMapsRemoveTimeRoleFlags:AB,formMapsRemoveDeriveFlags:z,};if(w>=0&&u[w].recursive){o=u[w];l.set("hierarchyMFA",true);AI.recursive="1";AL=l.getHierarchyRdcs(o.oid);AF=l.getHierarchyRelationTabele(o.oid);v={tbid:AF,mapping:J.getHierarchyMappingXML(null,AL)};l.set("hierarchyMFAMapping",JSON.stringify(v));}if(p!==undefined){AI.formMapsFlags=p;}var y=mstrApp.getRootController();var AK=this;var k={success:function(AN){var AM=y.model;var AO=AM.getImportSource(x);AO.invalidPreview();if(AO.canAutoMappingAndDetectRelation()){y.dataService.detectRelationshipSourceTable(n||AK.onRSDetected,{did:x});}else{if(n&&n.success){n.success(AN);}else{AK.onRSDetected.success(AN);}}},failure:function(AN){var AM=mstrApp.getRootController();AM.displayError(mstrmojo.desc(13136,"Cannot remap columns. "),false,AN.message);}};y.dataService.updateMappingSourceTable(k,AI);},onRSDetected:{success:function(k){var j=mstrApp.getRootController();j.dataService.set("messageID",k.msgid);var h=g.requestFlag.mapping|g.requestFlag.sourceInfo|g.requestFlag.relationship;j.getImportedDataEMMA(g.actions.none,h);},failure:function(){var h=mstrApp.getRootController();h.displayError(mstrmojo.desc(13136,"Cannot remap columns."));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,12365,3627,14549,14550);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var L=1,K,J,E=[],I,O,H,M,F,G,R,T,S,N;O=this.parent;H=O.columns;M=H.selectedIndex;N=H.items[H.selectedIndex].columnIndex;if(M===undefined){return ;}F=(H.items[M]).name;G=O.transformationList;R=G.subType%10;while(true){S=F+" "+L;J=true;for(K=0;K<H.items.length;K++){if(S===(H.items[K]).name){J=false;break;}}L++;if(J){T=S;break;}}switch(R){case 0:I=JSON.parse(JSON.stringify(this.operations.fromTo));var Q=this.optionsBox.fromto.from.value;var P=this.optionsBox.fromto.to.value;if(!Q||!P){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}I.description=I.description.replace("[new column name]",T);I.description=I.description.replace("[column name]",F);I.description=I.description.replace("[from]",parseInt(Q)-1);I.description=I.description.replace("[to]",P);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",T);I.baseColumnName=I.baseColumnName.replace("[column name]",F);I.expression=I.expression.replace("[from]",parseInt(Q)-1);I.expression=I.expression.replace("[to]",P);break;case 1:case 2:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(R===1){I=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{I=JSON.parse(JSON.stringify(this.operations.afterLast));}I.description=I.description.replace("[new column name]",T);I.description=I.description.replace("[column name]",F);I.columnInsertIndex=N+1;I.newColumnName=I.newColumnName.replace("[column name]",T);I.baseColumnName=I.baseColumnName.replace("[column name]",F);if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){I.description=I.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"/"+this.optionsBox.separatorBox.separator.value+"/");}else{I.description=I.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");I.expression=I.expression.replace(new RegExp("\\[separator\\]","gm"),"'"+D(this.optionsBox.separatorBox.separator.value)+"'");}break;}I.engineConfig=JSON.parse(this.controller.model.engine);E.push(I);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fromto.from.set("value","");this.optionsBox.fromto.to.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");}mstrmojo.Refine.RefineControlExtract=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlExtract",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Extract);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fromto",children:[{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"from",tooltip:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14549,"Start Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}},{scriptClass:"mstrmojo.TextBox",cssClass:"refine-extract-fromto",alias:"to",tooltip:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",emptyText:mstrmojo.desc(14550,"End Index")+" (1, 2, ...)",valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9]/g,"");if(F!==""){if(parseInt(F)===0){F="";}}this.set("value",F);}}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"comma")},{n:mstrmojo.desc(1053,"tab")},{n:mstrmojo.desc(12343,"whitespace")},{n:mstrmojo.desc(12362,"newline")},{n:mstrmojo.desc(12363,"pipe")},{n:mstrmojo.desc(12364,"period")},{n:mstrmojo.desc(3627,"other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.TextBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(13574,134,1052,1053,12343,12362,12363,12364,3627,12365,13995,14551);var A=mstrmojo.Refine.RefineConstants;function B(E){E=E.replace(/\n/g,"\\n");E=E.replace(/\t/g,"\\t");return E;}function D(E){return E.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}function C(){var K,E=[],J,N,I,L,F,G,P;N=this.parent;I=N.columns;L=I.selectedIndex;if(L===undefined){return ;}F=(I.items[L]).name;G=N.transformationList;P=G.subType%10;switch(P){case 0:if(!this.optionsBox.fixed.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}var Q="["+this.optionsBox.fixed.value+"]";var H=[];try{var O=JSON.parse(Q);for(K=0;K<O.length;K++){if(typeof O[K]==="number"){H.push(O[K]);}}if(H.length===0){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}}catch(M){mstrmojo.alert(mstrmojo.desc(13995,"The given field lengths are not properly formatted."));return ;}J=JSON.parse(JSON.stringify(this.operations.byFieldLengths));J.description=J.description.replace("[column name]",F);J.columnName=F;J.fieldLengths=H;break;case 1:case 2:case 3:if(!this.optionsBox.separatorBox.separator.value){mstrmojo.alert(mstrmojo.desc(13574,"Please fill out all fields before apply."));return ;}if(P===1){J=JSON.parse(JSON.stringify(this.operations.bySeparator));}else{if(P===2){J=JSON.parse(JSON.stringify(this.operations.beforeFirst));}else{J=JSON.parse(JSON.stringify(this.operations.afterLast));}}J.description=J.description.replace("[column name]",F);J.columnName=F;J.separator=this.optionsBox.separatorBox.separator.value;if(this.optionsBox.separatorBox.separatorList.selectedIndex===7){J.regex=true;J.description=J.description.replace("####","/"+this.optionsBox.separatorBox.separator.value+"/");}else{J.description=J.description.replace("####","'"+B(D(this.optionsBox.separatorBox.separator.value))+"'");}break;case 4:J=JSON.parse(JSON.stringify(this.operations.cellIntoRow));J.description=J.description.replace("[column name]",F);J.columnName=F;J.keyColumnName=this.controller.model.columns.keyColumnName;J.separator=this.optionsBox.separatorBox2.separator.value;break;}J.engineConfig=JSON.parse(this.controller.model.engine);E.push(J);this.controller.applyOperations({operations:JSON.stringify(E),engine:JSON.stringify({facets:[],mode:"row-based"})});this.optionsBox.fixed.set("value","");this.optionsBox.separatorBox.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox.separator.set("value",",");this.optionsBox.separatorBox2.separatorList.set("selectedIndex",0);this.optionsBox.separatorBox2.separator.set("value",",");}mstrmojo.Refine.RefineControlSplit=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlSplit",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Split);}},operations:null,children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fixed",cssClass:"refine-split-fromto",emptyText:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),tooltip:mstrmojo.desc(14551,"List of integers separated by commas, e.g., 5, 7, 15"),valueChangeDelay:200,onvalueChange:function(E){var F=E.value;F=F.replace(/[^0-9,]/g,"");this.set("value",F);},bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===0);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")},{n:mstrmojo.desc(12365,"regex")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6||this.selectedIndex===7){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10!==0&&this.parent.parent.parentBox.transformationList.subType%10!==4);}}},{scriptClass:"mstrmojo.HBox",alias:"separatorBox2",children:[{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"refine-pulldown",alias:"separatorList",items:[{n:mstrmojo.desc(1052,"Comma")},{n:mstrmojo.desc(1053,"Tab")},{n:mstrmojo.desc(12343,"Whitespace")},{n:mstrmojo.desc(12362,"Newline")},{n:mstrmojo.desc(12363,"Pipe")},{n:mstrmojo.desc(12364,"Period")},{n:mstrmojo.desc(3627,"Other")}],selectedIndex:0,onitemSelected:function(){if(this.selectedIndex===6){this.parent.separator.set("value","");this.parent.separator.set("visible",true);}else{this.parent.separator.set("visible",false);if(this.selectedIndex===0){this.parent.separator.set("value",",");}else{if(this.selectedIndex===1){this.parent.separator.set("value","\t");}else{if(this.selectedIndex===2){this.parent.separator.set("value"," ");}else{if(this.selectedIndex===3){this.parent.separator.set("value","\n");}else{if(this.selectedIndex===4){this.parent.separator.set("value","|");}else{if(this.selectedIndex===5){this.parent.separator.set("value",".");}}}}}}}}},{scriptClass:"mstrmojo.TextBox",alias:"separator",visible:false,value:","}],bindings:{visible:function(){return(this.parent.parent.parentBox.transformationList.subType%10===4);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),onclick:function(){C.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.VBox","mstrmojo.RadioList","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Refine.RefineConstants","mstrmojo.Pulldown");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var H=[],E,J,I,G,D,F,C;J=this.parent;I=J.columns;G=I.selectedIndex;if(G===undefined){return ;}D=(I.items[G]).name;F=J.transformationList;C=F.subType%10;switch(C){case 0:E=JSON.parse(JSON.stringify(this.operations.trim));break;case 1:E=JSON.parse(JSON.stringify(this.operations.collapse));break;}E.columnName=D;E.description=E.description.replace("[column name]",D);E.engineConfig=JSON.parse(this.controller.model.engine);H.push(E);this.controller.applyOperations({operations:JSON.stringify(H),engine:JSON.stringify({facets:[],mode:"row-based"})});}mstrmojo.Refine.RefineControlWhitespace=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlWhitespace",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Whitespace);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Whitespace)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",visible:false,onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.HBox","mstrmojo.RadioList","mstrmojo.Button","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(134);var A=mstrmojo.Refine.RefineConstants;function B(){var J,H,G,D,F,C;J=this.parent;H=J.columns;G=H.selectedIndex;if(G===undefined){return ;}name=(H.items[G].originalName);D=(H.items[G]).name;F=J.transformationList;C=F.subType%10;var I;var E={};E.originalName=name;E.name=D;E.columnName=D;if(C===0){I="list";E.expression="value";}else{if(C===1){I="range";E.expression="value";E.mode="range";}else{if(C===2){I="timerange";E.expression="value";E.mode="range";}else{if(C===3){I="text";E.caseSensitive=false;E.mode="text";}}}}this.controller.addFacets(I,E);}mstrmojo.Refine.RefineControlFacet=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Refine.RefineControlFacet",markupString:'<div class="refine-controls"><div></div></div>',markupSlots:{optionsNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onsubTypeChange:function(){if(this.subType!==-1){this.optionsBox.apply.onclick();}}},operations:null,bindings:{visible:function(){return(this.parentBox.transformationList.type===A.transformationType.Facet);},subType:function(){return((this.parentBox.transformationList.type===A.transformationType.Facet)?this.parentBox.transformationList.subType:-1);}},children:[{scriptClass:"mstrmojo.HBox",slot:"optionsNode",alias:"optionsBox",visible:false,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(134,"Apply"),alias:"apply",onclick:function(){B.call(this.parent.parent);}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog");mstrmojo.requiresDescs(12390,12391,12392);var K=mstrmojo.DI.DIConstants,D=K.actions,I=mstrmojo.array,C=mstrmojo.desc,G={UPDATE_SINGLE_PARTITION:0,ADD_MULTI_PARTITION:1,SET_SINGLE_PARTITION:2,SET_SINGLE_PARTITION_URL:3,SET_SINGLE_PARTITION_EMMA:4,SET_SINGLE_PARTITION_EXCEL:5};mstrmojo.DI.controller.DIPartitionController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIPartitionController",getAllPartitionTables:function J(P,O){var N=mstrApp.getRootController();return N.model.getAllPartitionTables(P,O);},changePartition:function M(S,Q,P,U){var O=mstrApp.getRootController(),N,T,R;R=O.model.getImportSource(S);R.invalidPreview();N={success:function(W){var V=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",W.msgid);O.getImportedDataEMMA(D.none,V);},failure:function(V){O.displayError(C(12390,"Cannot change partition group."),false,V.message||"");}};T={mode:G.UPDATE_SINGLE_PARTITION,partitionId:S,addTables:JSON.stringify(Q),delTables:JSON.stringify(P)};O.dataService.changePartition(U||N,T);},setPartition:function H(R,P,T){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(V){var U=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",V.msgid);O.getImportedDataEMMA(D.none,U);},failure:function(U){O.displayError(C(12390,"Cannot change partition group."),false,U.message||"");}};S={mode:G.SET_SINGLE_PARTITION,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(T||N,S);},addMultiPartitions:function E(S,U){var O=mstrApp.getRootController(),P=O.model,T,Q=[],N,R;I.forEach(S,function(V){Q.push(V.tableIds.join(","));R=P.getImportSource(V.tableIds[0]);R.invalidPreview();});T={mode:G.ADD_MULTI_PARTITION,partitions:Q.join("|")};N={success:function(W){var V=K.requestFlag.mapping|K.requestFlag.sourceInfo|K.requestFlag.relationship;O.dataService.set("messageID",W.msgid);if(U&&U.onOK){U.onOK();}else{O.getImportedDataEMMA(D.none,V);}},failure:function(V){O.displayError(C(12391,"Cannot group partitions."),false,V.message||"",U&&U.onCancel);}};O.dataService.changePartition(N,T);},setPartitionURL:function B(R,P,T){var O=mstrApp.getRootController(),N,S,Q;Q=O.model.getImportSource(R);Q.invalidPreview();N={success:function(U){var V=U.msgid,W={};if(V){O.dataService.set("messageID",V);}W.url=P[0];O.autoMappingSourceTable(null,R,W);},failure:function(){O.displayError(C(12392,"Encounter error when set partition!"));}};S={mode:G.SET_SINGLE_PARTITION_URL,partitionId:R,addTables:JSON.stringify(P)};O.dataService.changePartition(T||N,S);},setPartitionExcel:function A(S,O,Q){var P=mstrApp.getRootController(),N,T,R;if(Q.length<=0){return ;}R=P.model.getImportSource(S);R.invalidPreview();N={success:function(V){var W={shtIx:Q[0]};P.autoMappingSourceTable(null,S,W,S);for(var U=1;U<Q.length;U++){R.sheetsInfo[U].is1stSheetAutoMapped=true;}},failure:function(){P.displayError(C(12392,"Encounter error when set partition!"));}};T={mode:G.SET_SINGLE_PARTITION_EXCEL,partitionId:S,addSheetsName:JSON.stringify(O),addsheetsIndex:Q.join(",")};P.dataService.changePartition(N,T);},openPartitionGroupDialog:function F(N,P,O){mstrApp.getRootController().showDialog(K.dialogType.partitionGroupDialog,{groups:N,callback:P,isEditMode:O});},isSamePartitionGroups:function L(U,S){var Q={},N=true,P=U?U.length:0,O=S?S.length:0,T=0,R=0;if(P!==O){return false;}I.forEach(U,function(V){I.forEach(V.tableIds,function(W){Q[W]=true;T++;});});I.forEach(S,function(V){I.forEach(V.tableIds,function(W){if(!Q[W]){N=false;return false;}R++;});if(!N){return false;}});N=N&&(T===R);return N;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIPartitionGroupDialog","mstrmojo.DI.DIInlineEditBox","mstrmojo.DI.DIHelpers","mstrmojo.UUID","mstrmojo.hash");mstrmojo.requiresDescs(218,219,517,518,221,8149,9912,11164,12532,12818,12819,12820,12821,12822,12823,12824,12825,12826,12827,12828,12829,12830,12831,12832,12833,12834,12835,12892,13266,13301,13331,13332,13333,13334,13335,13336,13337,13338,14196,14197);var c=mstrmojo.array,u=mstrmojo.string,o=mstrmojo.DI.DIHelpers,d=mstrmojo.UUID,T=mstrmojo.hash,l=mstrmojo.DI.DIConstants,j=l.actions,G=4;function g(w,y,AA){var z={},AB=w;var x,v;for(x=0,v=y.length;x<v;x++){if(y[x].tp===AA){z[y[x].alias]=1;}}x=0;while(z[AB]){AB=w+" ("+(++x)+")";}return AB;}function D(z,v){var y,x,w,AA;for(y=0;y<v.length;y++){w=v[y];for(x=0;x<z.length;x++){AA=z[x];if(AA.fmid===w.fmid){w.georole=AA.georole;w.der=AA.der;}}}}function P(y,v){var x,w;for(x=0;x<v.length;x++){w=v[x];if(w.fmn===y){return w;}}return null;}function K(w,y,v){var x=false;c.forEach(y,function(z){if(z.fmid===v.fmid&&z[w]!==v[w]){if(z[w]&&z[w]!==0){v[w]=z[w];x=true;}else{if(v[w]&&v[w]!==0){z[w]=v[w];x=true;}}}});return x;}function J(x,v){var w=false;c.forEach(x,function(y){if(y.fmid===v.fmid&&y.der!==v.der){y.der=v.der|y.der;v.der=v.der|y.der;w=true;}});return w;}function k(w,v){var x=false;if(w.isMultiForm&&v.isMultiForm){c.forEach(w.subColumns,function(y){x=x||K("georole",v.subColumns,y);});}else{if(w.isMultiForm&&!v.isMultiForm){x=K("georole",w.subColumns,v);}else{if(!w.isMultiForm&&v.isMultiForm){x=K("georole",v.subColumns,w);}else{if(w.georole!==v.georole){if(w.georole&&w.georole!==0){v.georole=w.georole;x=true;}}}}}return x;}function B(w,v){var x=false;if(w.isMultiForm&&v.isMultiForm){c.forEach(w.subColumns,function(y){x=x||J(v.subColumns,y);});}else{if(w.isMultiForm&&!v.isMultiForm){x=J(w.subColumns,v);}else{if(!w.isMultiForm&&v.isMultiForm){x=J(v.subColumns,w);}else{if(w.der!==v.der){v.der=w.der|v.der;w.der=w.der|v.der;x=true;}}}}return x;}function e(w,v){var x=false;if(w.isMultiForm&&v.isMultiForm){c.forEach(w.subColumns,function(y){x=x||K("timerole",v.subColumns,y);});}else{if(w.isMultiForm&&!v.isMultiForm){x=K("timerole",w.subColumns,v);}else{if(!w.isMultiForm&&v.isMultiForm){x=K("timerole",v.subColumns,w);}else{if(w.timerole!==v.timerole){if(w.timerole&&w.timerole!==0){v.timerole=w.timerole;x=true;}else{if(v.timerole&&v.timerole!==0){w.timerole=v.timerole;x=true;}}}}}}return x;}function C(w,v){w.tp=12;w.selected=true;w.georole=v.georole;w.der=v.der;w.shapeKey=v.shapeKey;}function H(w,v){w.tp=12;w.selected=true;w.timerole=v.timerole;}function a(v){var x=this;var w=x.model.importSources;c.forEach(v,function(AB){var z=w[AB.tableId];var y=z.currentIndex;var AC=z.originalMappings[y];var AA=z.mappings[y];c.forEach(AC,function(AE,AD){if(AE.id===AB.id){AA[AD]=mstrmojo.hash.clone(AE);return false;}});});}function N(x,y,w){var v=false;c.forEach(y,function(z){if(z.fmid===w.fmid){if(z[x]!==0&&w[x]!==0&&z[x]!==w[x]){v=true;return false;}}});return v;}function L(AA,v,z){var w=mstrApp.getRootController();var y=false;if(AA.ipa){w.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var x=false;c.forEach(v,function(AD){if(AD.ipa){x=true;return false;}if(AD.recursive||AA.recursive){y=true;}if(AD.isMultiForm||AA.isMultiForm){var AE=(AD.subColumns||[]).concat(AA.subColumns||[]);c.some(AE,function(AF){if(AF.recursive){y=true;return true;}});}});if(y){w.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}if(x){w.displayError(mstrmojo.desc(14196,"Please unmap project attribute before trying to map it to other attributes."));return ;}var AB={success:function(AD){if(AD&&AD.msgid){w.dataService.set("messageID",AD.msgid);}t(AA,v,z,null,16);},failure:function(){a.call(w,v);w.displayError(mstrmojo.desc(13334,"Error to map two attributes"));}};var AC={success:function(){var AE=false;var AD=false;c.forEach(v,function(AF){if(AA.georole&&AF.georole&&AA.georole!==0&&AF.georole!==0&&AA.georole!==AF.georole){if(AA.isMultiForm&&AF.isMultiForm){c.forEach(AA.subColumns,function(AG){if(N("georole",AF.subColumns,AG)){AD=true;return false;}});}else{if(AA.isMultiForm&&!AF.isMultiForm){if(N("georole",AA.subColumns,AF)){AD=true;return false;}}else{if(!AA.isMultiForm&&AF.isMultiForm){if(N("georole",AF.subColumns,AA)){AD=true;return false;}}else{AD=true;}}}if(AD){w.displayError(mstrmojo.desc(13332,"Cannot map two attribute which has different geo role"));a.call(w,v);return false;}}if(AA.timerole&&AF.timerole&&AA.timerole!==0&&AF.timerole!==0&&AA.timerole!==AF.timerole){if(AA.isMultiForm&&AF.isMultiForm){c.forEach(AA.subColumns,function(AG){if(N("timerole",AF.subColumns,AG)){AD=true;return false;}});}else{if(AA.isMultiForm&&!AF.isMultiForm){if(N("timerole",AA.subColumns,AF)){AD=true;return false;}}else{if(!AA.isMultiForm&&AF.isMultiForm){if(N("timerole",AF.subColumns,AA)){AD=true;return false;}}else{AD=true;}}}if(AD){this.displayError(mstrmojo.desc(13333,"Cannot map two attribute which has different time role"));a.call(w,v);return false;}}AE=k.call(w,AA,AF)||AE;AE=B.call(w,AA,AF)||AE;AE=e.call(w,AA,AF)||AE;if(AE){w.changeEMMAMappings(AB);}else{AB.success();return false;}});},failure:function(AE){var AF;var AG=/\(.*\)/g.exec(AE.message);if(AG&&AG.length>0){AF=AG[0].substr(1,AG[0].length-2);}var AD=function(){var AH=l.requestFlag.mapping|l.requestFlag.sourceInfo|l.requestFlag.relationship;w.getImportedDataEMMA(j.none,AH);};w.displayError(AF,false,null,AD);a.call(w,v);}};t(AA,v,z,AC,1);}function F(x,AB,z){var w=mstrApp.getRootController(),y=w.getModel(),AA,v;if(!x||!AB||!x.tableId||!AB.tableId){return ;}AA=y.getImportSource(x.tableId).findMappingItem(x);v=y.findMappingItem(AB);L(AA,v,z);}function t(z,v,y,AA,x){var w=mstrApp.getRootController();c.forEach(v,function(AB){AB.alias=y;AB.oid=z.id;AB.linkObjID=z.id;});w.changeEMMAMappings(AA,x);}function I(x,z,v){var w=this.model;var AA=w.findMappingItem(x);var y;for(y=0;y<AA.length;y++){if(AA[y].tableId===x.tableId){AA[y].alias=z;AA[y].linkObjID="";if(AA[y].tp===12){AA[y].formID="";AA[y].oid="";}AA[y].lv=0;}}if(!v){this.changeEMMAMappings();}}function h(AA,v){var w,x,y,z;for(w in v){y=v[w];if(y.currentTransformations&&y.currentTransformations.xtab&&y.currentTransformations.xtab.isCrosstab){z=y.transformedMapping;}else{z=y.currentMapping;}for(x=0;x<z.length;x++){if(z[x].alias===AA){return z[x];}}}return null;}function S(x,w){var v;for(v=0;v<x.length;v++){x[v].alias=w;if(this.linkObjID){x[v].linkObjID=this.linkObjID;this.linkObjID=null;}if(x.length>1){x[v].lv=1;}}mstrApp.getRootController().changeEMMAMappings();}mstrmojo.DI.controller.DIMappingController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingController",changeDataType:function Y(AE,AC,y){if(!AE||!AE.data||isNaN(AE.data[0].tp)){return ;}var AB=mstrApp.getRootController();var w=AE.data[0];var x=AB.model;var AA,z;var AD;var v;AD=x.findMappingItem(w);for(AA=0;AA<AD.length;AA++){if(AD[AA].isMultiForm){v=AD[AA].subColumns;for(z=0;z<v.length;z++){if(v[z].afid===w.afid){v[z].dtp=AC;if(typeof y==="number"&&!isNaN(y)){v[z].ctp=y;}v[z].selected=true;break;}}}else{AD[AA].dtp=AC;if(typeof y==="number"&&!isNaN(y)){AD[AA].ctp=y;}AD[AA].selected=true;}}AB.changeEMMAMappings();},linkAttributes:function Q(y,AG){if(!y||!AG){return ;}var AA=y.data[0],AE,x,AB,v=y.widget,AD=mstrmojo.dom.position(v.domNode),AF=mstrmojo.dom.position(y.node).y-AD.y,AC=mstrApp.getRootController(),z=0;if(AF>=22*3){if(v.containerNode.scrollTop<v.containerNode.scrollHeigh-v.containerNode.clientHeight){v.containerNode.scrollTop+=22;}else{}}AF=mstrmojo.dom.position(y.node).y-AD.y-5+z;if(AF<-40){AF=-7;}var w={scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-di-linkPopup",locksHover:true,slot:"domNode",children:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13301,"Map?"),cssClass:"mstrmojo-di-link-button",onclick:function(AH){mstrmojo.dom.stopPropogation(AH.hWin,AH.e);F(AA,AG.data[0],AA.alias);this.set("visible",false);}}],onOpen:function(){var AH=this.txt,AI=this.txtConfig;mstrmojo.hash.forEach(AI,function(AJ,AK){AH.set(AK,AJ);});}};AE=AG.data[0];if(AA.id===AE.id){AC.displayError(mstrmojo.desc(13335,"#### and @@@@ are already mapped.").replace("####",AA.alias).replace("@@@@",AE.alias));return ;}x=AC.getModel().getImportSource(AE.tableId);AB=AC.getModel().getImportSource(AA.tableId);if(AB.findMappingItem(AE)){AC.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AE.alias).replace("@@@@",AB.sourceInfo.name));return ;}if(x.findMappingItem(AA)){AC.displayError(mstrmojo.desc(13336,"#### is already mapped to another column in table @@@@.").replace("####",AA.alias).replace("@@@@",x.sourceInfo.name));return ;}window.setTimeout(function(){v.openPopup(w,{left:"9px",top:AF+"px"});for(var AH=0;AH<v.containerNode.childNodes.length;AH++){if(v.containerNode.childNodes[AH].className.indexOf("selected")>=0){v.containerNode.childNodes[AH>0?AH-1:AH].scrollIntoView();break;}}},100);},renameSourceTable:function M(AB,AD){var AA=mstrApp.getRootController();var z=AA.model;var v=z.importSources;var AC=z.getImportSource(AB);if(!AC){return ;}if(AC.sourceInfo&&AC.sourceInfo.name===AD){return ;}if(!AD||AD.length<=0){AA.displayError(mstrmojo.desc(12824,"Cannot rename table alias with empty string."));z.raiseEvent({name:"MappingsFetched"});return ;}if(AD.length>=250){AA.displayError(mstrmojo.desc(12825,"Cannot rename table alias with a too long string."));z.raiseEvent({name:"MappingsFetched"});return ;}if(l.invalidObjectNameCharsRegex.test(AD)){AA.displayError(mstrmojo.desc(12826,"Cannot rename table alis with string contains the following characters: ####.").replace("####",l.invalidObjectNameChars));z.raiseEvent({name:"MappingsFetched"});return ;}for(var y in v){if(v[y].tableID!==AB&&v[y].sourceInfo&&v[y].sourceInfo.name===AD){AA.displayError(mstrmojo.desc(14197,"Cannot rename table alias with a used name."));return ;}}var w={success:function(){var AE=l.requestFlag.mapping|l.requestFlag.sourceInfo|l.requestFlag.relationship;AA.getImportedDataEMMA(j.none,AE);},failure:function(AF){var AE=parseInt(AF.code,10);var AG=mstrmojo.desc(12827,"Cannot rename table alias.");switch(AE){case l.backendError.invalidObjectName:AG=mstrmojo.desc(12828,"Cannot rename table alias with invalid characters.");break;case l.backendError.stringTooLong:AG=mstrmojo.desc(12825,"Cannot rename table alias with a too long string.");break;}mstrApp.getRootController().displayError(AG,false,AF.message);z.raiseEvent({name:"MappingsFetched"});}};var x={did:AB,xml:"",n:AD};AA.dataService.editEMMASourceTable(w,x);},renameTableItem:function R(AC,z){var AE=mstrApp.getRootController(),AD=AE.model;var AG=mstrmojo.string.trim(AC.text);var AA=0,y,AH=false;var AF,w,x;if(AG===z.alias){return false;}if(!AG||AG.length<=0){AE.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));AD.raiseEvent({name:"MappingsFetched"});return false;}if(AG.length>=250){AE.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));AD.raiseEvent({name:"MappingsFetched"});return false;}if(l.invalidObjectNameCharsRegex.test(AG)){AE.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",l.invalidObjectNameChars));AD.raiseEvent({name:"MappingsFetched"});return false;}var v=AD.findMappingSource(z);if(v.length===0){return false;}for(y=0;y<v.length;y++){w=v[y];if(z.tp===G&&!z.linkedTbs&&z.tableId!==w.tableID){continue;}if(w.currentTransformations&&w.currentTransformations.xtab&&w.currentTransformations.xtab.isCrosstab){AF=w.transformedMapping;}else{AF=w.currentMapping;}for(AA=0;AA<AF.length;AA++){if(AG===AF[AA].alias&&z.tp===AF[AA].tp){AH=true;break;}}}if(AH){x=mstrmojo.desc(12532,"The name ## has been used by another column. Please give a new name.");AE.displayError(u.encodeHtmlString(x.replace("##",AG)));AD.raiseEvent({name:"MappingsFetched"});return false;}var AB=h(AG,AD.importSources);if(AB&&AB.tp!==G&&z.tp!==G){x=mstrmojo.desc(13337,"#### is already being used by other attributes. Would you like to map to those attributes?").replace("####",AG);mstrmojo.confirm(x,{confirmBtn:{t:mstrmojo.desc(13301,"Map?"),fn:function(){AF=AD.findMappingItem(z);F(AB,AF[0],AG);return true;}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}else{if(z.tp===4&&!z.linkedTbs){AF=AD.findMappingItem(z,z.tableId);}else{AF=AD.findMappingItem(z);}S(AF,AG);return true;}},openRenameTextBox:function W(AD,AE,v,AF){var w=v.data[0],AC=w.alias||w.n,z=this;var AA=AE;var y=AE.parentNode;var AB=mstrmojo.insert({scriptClass:"mstrmojo.DI.DIInlineEditBox",text:AC||"",cssDisplay:"inline-block",placeholder:AE,onSave:function x(){var AG;if(AD===l.contextMenuType.ITEM_MENU){AG=z.renameTableItem(this,w);if(!AG){y.replaceChild(AA,this.domNode);}}else{if(AD===l.contextMenuType.TABLE_MENU){y.replaceChild(AA,this.domNode);z.renameSourceTable(w.id,this.text);}else{if(AD===l.contextMenuType.LINK_MENU){F(w,AF.data[0],mstrmojo.string.decodeHtmlString(this.text));}}}}});if(parent&&parent.draggable){AB.parent=parent;}AB.render();AB.set("editMode",true);},openUnLinkDialog:function V(x){if(!x||!x.data||isNaN(x.data[0].tp)||!x.data[0].selected){return ;}var y=x.data[0];var w=y.alias;var v=y.tp===12?mstrmojo.desc(518,"attribute"):mstrmojo.desc(517,"metric");mstrApp.getRootController().showDialog(l.dialogType.previewRenameDialog,{curName:y.alias,text:mstrmojo.desc(13338,"#### is currently being used by other @@@@. Please rename to unmap this @@@@").replace("####",w).replace(/@@@@/g,v),onOk:function(z){var AA=mstrApp.getRootController();var AB=mstrmojo.string.encodeXMLAttribute(z);if(AB===y.alias){AA.displayError(mstrmojo.desc(12834,"Please input a different name."));return false;}if(AB.length<=0){AA.displayError(mstrmojo.desc(12829,"Cannot rename column with empty string."));return false;}if(AB.length>=250){AA.displayError(mstrmojo.desc(12830,"Cannot rename column with a too long string."));return false;}if(l.invalidObjectNameCharsRegex.test(AB)){AA.displayError(mstrmojo.desc(12835,"Cannot rename column with string contains the following characters: ")+l.invalidObjectNameChars);return false;}I.call(AA,y,AB);return true;}});},unlinkAll:function p(AE,AC){var AB=mstrApp.getRootController(),AA=AB.getModel(),w=AA.importSources,AD=AE.data,z=false,v,y=[],x=false;if(!AC){AC=AD[0].tableId;}v=AA.getImportSource(AC);c.forEach(AD,function(AG){var AI;if(AG.recursive&&AG.rdcs){if(AG.rdcs.length===0){y.push(AG);}else{if(AG.isLinked){for(var AF in w){if(w.hasOwnProperty(AF)&&AF!==AG.tableId){AI=w[AF].findMappingItem(AG);if(AI){y.push(AI);x=true;}}}}}}else{if(AG.isMultiForm){for(var AH=0;AH<AG.subColumns.length;AH++){if(AG.subColumns[AH].recursive&&AG.subColumns[AH].rdcs){y.push(AG);}}}}});if(y.length){AB.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}c.forEach(AD,function(AF){var AG;if(AF.selected&&AF.tp===12&&AF.isLinked){AG=AF.alias+" - "+v.sourceInfo.name;AG=AA.getUniqueAlias(12,AG);I.call(AB,AF,u.encodeXMLAttribute(AG),true);z=true;}});if(z){AB.changeEMMAMappings();}},unlinkAllCubeLevel:function m(y){var v=mstrApp.getRootController(),w=v.getModel(),z=y.data,AA=false,x=false;x=c.some(z,function(AB){if(AB.recursive){return true;}else{if(AB.isMultiForm){return c.some(AB.subColumns,function(AC){if(AC.recursive){return true;}});}}});if(x){v.displayError(mstrmojo.desc(null,"We don't support this operation, because there's a recursive attribute"));return ;}c.forEach(z,function(AB){var AC;if(AB.selected&&AB.tp===12&&AB.isLinked){AC=w.findMappingItem(AB);c.forEach(AC,function(AF){var AE=w.getImportSource(AF.tableId),AD;AD=AF.alias+" - "+AE.sourceInfo.name;AD=w.getUniqueAlias(12,AD);I.call(v,AF,u.encodeXMLAttribute(AD),true);AA=true;});}});if(AA){v.changeEMMAMappings();}},unmap:function f(AM){var AC=AM.data[0]||AM.data;if(!AM||!AM.data||isNaN(AC.tp)||(AC.tp===4&&AC.selected)){return ;}var AJ,AH;var y=mstrApp.getRootController();var AI=y.model;AH=AI.findMappingItem(AC);var AG,AA,w=true;var z=function AD(){for(AJ=0;AJ<AH.length;AJ++){mstrmojo.array.forEach(AH[AJ].subColumns,function(AN){AN.oid="";AN.fmid="";AG=AN.originalAlias;AN.alias=AG;});}y.changeEMMAMappings();};var AE=[],AK=AC.alias,AB={success:function(){var AQ,AN,AP;for(var AO=0;AO<AE.length;AO++){AQ=T.walk("importSources."+AE[AO].tid+".currentMapping",AI);AN=c.find(AQ,"did",AE[AO].did);if(AN<0){console.warn("error when finding attribute ",AE[AO]);continue;}AP=AQ[AN];AP.alias=AE[AO].name;}mstrApp.getRootController().changeEMMAMappings();}};for(AJ=0;AJ<AH.length;AJ++){if(AH[AJ].isMultiForm&&w){mstrmojo.confirm(mstrmojo.desc(11164,"All other forms of the attribute will be unmapped. Do you want to continue?"),{confirmBtn:{fn:z}});w=false;}else{AH[AJ].oid="";AH[AJ].fmid="";AG=AH[AJ].originalAlias;var x=mstrApp.rootController.model,v=x?x.importSources:null,AF=v?v[AH[AJ].tableId].sourceInfo:null,AL=AF?AF.name:null;if(AG===AK){AH[AJ].alias=AL?AG+" - "+AL:AG;}else{AH[AJ].alias=AG;}}}if(w){if(AE.length===0){y.changeEMMAMappings();}else{y.changeEMMAMappings(AB,undefined,true);}}},isSingleFormAttribute:function U(v){return !(v.isMultiForm);},toProjectAttribute:function s(AL,AE){var AA=AL.data[0]||AL.data;if(!AL||!AL.data||isNaN(AA.tp)||(AA.tp===4&&AA.selected)){return ;}var AF=[];var AK,AI,AH,AM,y=[],AG;var v;var z=mstrApp.getRootController().model;if(AL.data.length>1){this.toProjectAttribute2(AL,AE);return ;}v=z.findMappingSource(AA);for(AK=0;AK<v.length;AK++){AG=v[AK];if(AG.currentTransformations&&AG.currentTransformations.xtab&&AG.currentTransformations.xtab.isCrosstab){AF=AF.concat(AG.transformedMapping);}else{AF=AF.concat(AG.currentMapping);}}if(AF){for(AI=0;AF&&AI<AF.length;AI++){AM=AF[AI];if(AM.type!=="amps"){continue;}if((AM.id===AA.id)&&(AM.isLinked||AM.isMultiForm)){var x=AM.subColumns,AD;for(AH=0;x&&AH<x.length;AH++){AD=x[AH];if(AD.georole){AA.georole=1;}var AC=mstrmojo.array.find(y,"fmid",AD.fmid);if(AC<0){y.push(AD);}}}}}var w=function AB(){var AP={};AP.attribute=AA;if(AA.isMultiForm||AA.isLinked){var AN=y,AQ,AO;AO=c.find(AN,"isIdForm",true);if(AO>0){AQ=AN[AO];AN.splice(AO,1);AN.unshift(AQ);}AP.formMaps=AN;}mstrApp.getRootController().showDialog(l.dialogType.mapProjectsAttributeDialog,AP);},AJ={confirmBtn:{fn:function(){w();}}};if(AA.georole){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AJ);}else{if(AA.timerole){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AJ);}else{w();}}},toProjectAttribute2:function(y,x){var AB=y.data,v=c.some(AB,function(AC){return AC.georole;}),z=c.some(AB,function(AC){return AC.timerole;}),w=function(){var AC={tableId:x||AB[0].tableId,attributes:AB};mstrApp.getRootController().showDialog(l.dialogType.mapProjectsAttributeDialog2,AC);},AA={confirmBtn:{fn:function(){w();}}};if(v){mstrmojo.confirm(mstrmojo.desc(9912,"Mapping this column to a project attribute will remove its geographical role and any derived attributes. Do you want to continue?"),AA);}else{if(z){mstrmojo.confirm(mstrmojo.desc(13297,"Mapping this column to a project attribute will remove all related derived date/time attributes, Do you want to continue?"),AA);}else{w();}}},toUnused:function q(AB){if(!AB||!AB.data||isNaN(AB.data[0].tp)||!AB.data[0].selected){return ;}var z=mstrApp.getRootController();var w=AB.data;var v=z.model;var AA,y,x,AC;for(AA=0;AA<w.length;AA++){x=w[AA];AC=v.findMappingItem(x);for(y=0;y<AC.length;y++){if(x.linkedTbs){AC[y].selected=false;}else{if(AC[y].tp===12){AC[y].selected=false;}else{if(AC[y].tableId===x.tableId){AC[y].selected=false;}}}}}z.changeEMMAMappings();},toAttribute:function b(AB){var AD=[],w=[],AC;var y,AA,v;var z=mstrApp.getRootController();var x=z.model;mstrmojo.array.forEach(AB,function(AE){if(!AE||isNaN(AE.tp)||(AE.tp===12&&AE.selected)){return ;}AC=[];w=x.findMappingSource(AE);for(y=0;y<w.length;y++){v=w[y];if(v.currentTransformations&&v.currentTransformations.xtab&&v.currentTransformations.xtab.isCrosstab){AC=AC.concat(v.transformedMapping);}else{AC=AC.concat(v.currentMapping);}}if(AE.tp!==12){AA=g(AE.alias,AC,12);}else{AA=AE.alias;}AD=x.findMappingItem(AE);for(y=0;y<AD.length;y++){AD[y].alias=AA;AD[y].tp=12;AD[y].selected=true;}});z.changeEMMAMappings();},toMetric:function Z(AB){var z=mstrApp.getRootController();var x=z.model;var w=[],AD=[],AC;var y,AA,v;mstrmojo.array.forEach(AB,function(AE){if(!AE||isNaN(AE.tp)||(AE.tp===4&&AE.selected)){return ;}AC=[];w=x.findMappingSource(AE);for(y=0;y<w.length;y++){v=w[y];if(v.currentTransformations&&v.currentTransformations.xtab&&v.currentTransformations.xtab.isCrosstab){AC=AC.concat(v.transformedMapping);}else{AC=AC.concat(v.currentMapping);}}if(AE.tp!==4){AA=g(AE.alias,AC,4);}else{AA=AE.alias;}AD=x.findMappingItem(AE);for(y=0;y<AD.length;y++){AD[y].alias=AA;AD[y].tp=4;AD[y].selected=true;}});z.changeEMMAMappings();},importItem:function n(z){var w=mstrApp.getRootController();var v=w.model;var AA=[],y,x;if(!z||isNaN(z.tp)){return ;}AA=v.findMappingItem(z);for(y=0;y<AA.length;y++){if(AA[y].idot===12){AA[y].alias=x;AA[y].tp=AA[y].idot;AA[y].selected=true;}else{if(AA[y].tableId===z.tableId){AA[y].alias=x;AA[y].tp=AA[y].idot;AA[y].selected=true;}}}w.changeEMMAMappings();},setMultipleImport:function O(AA,AE,AB){var y=mstrApp.getRootController();var w=y.model;var v=[],AD=[],AC;var x,z;mstrmojo.array.forEach(AA,function(AF){if(!AF||isNaN(AF.tp)){return ;}AC=[];v=w.findMappingSource(AF);if(AF.tp===0&&AF.selected){AD=w.findMappingItem(AF);for(x=0;x<AD.length;x++){if(AD[x].idot===12){AD[x].alias=z;AD[x].tp=AD[x].idot;AD[x].selected=true;}else{if(AD[x].tableId===AF.tableId){AD[x].alias=z;AD[x].tp=AD[x].idot;AD[x].selected=true;}}}}});y.changeEMMAMappings(AE,undefined,AB);},setTimeDimension:function A(y){if(!y||isNaN(y.tp)||(y.tp===4&&y.selected)){return ;}var x,z;var w=mstrApp.getRootController();var v=w.model;z=v.findMappingItem(y);for(x=0;x<z.length;x++){if(z[x].isMultiForm){z[x].subColumns=y.subColumns;}else{z[x].tp=12;z[x].selected=true;z[x].der=y.der;}}w.changeEMMAMappings();},setTimeRole:function X(z){if(!z||isNaN(z.tp)||(z.tp===4&&z.selected)){return ;}var AB=mstrApp.getRootController();var AA,y,AD,x,AC;var w=AB.model;AD=w.findMappingItem(z);for(AA=0;AA<AD.length;AA++){var v=AD[AA];if(AD[AA].isMultiForm){if(z.isMultiForm){AD[AA].subColumns=z.subColumns;}else{for(y=0;y<v.subColumns.length;y++){if(v.subColumns[y].isIdForm){x=v.subColumns[y];break;}}H(x,z);}}else{if(z.isMultiForm){for(y=0;y<z.subColumns.length;y++){if(z.subColumns[y].isIdForm){AC=z.subColumns[y];break;}}H(v,AC);}else{H(v,z);}}}AB.changeEMMAMappings();},setGeoRoles:function E(AC){if(!AC||isNaN(AC.tp)||(AC.tp===4&&AC.selected)){return ;}var AD,AB,AG,AA,AF,v;var AE=mstrApp.getRootController();var y=AE.model;AG=y.findMappingItem(AC);if(AC.isMultiForm){if(AC.mergeSubColumns){D(AC.mergeSubColumns,AC.subColumns);}}for(AD=0;AD<AG.length;AD++){var w=AG[AD];if(w.isMultiForm){if(AC.isMultiForm){if(w.tableId===AC.tableId){w.subColumns=AC.subColumns;}else{for(AB=0;AB<AC.mergeSubColumns.length;AB++){var x=AC.mergeSubColumns[AB];var z=P(x.fmn,w.subColumns);if(x.georole&&z){AA=z;AA.georole=x.georole;break;}}v=AA.fmn;for(AB=0;AB<w.subColumns.length;AB++){if(w.subColumns[AB].fmn!==v){w.subColumns[AB].georole=0;}}}}else{for(AB=0;AB<w.subColumns.length;AB++){if(w.subColumns[AB].isIdForm){AA=w.subColumns[AB];}else{w.subColumns[AB].georole=0;}}C(AA,AC);}}else{if(AC.isMultiForm){for(AB=0;AB<AC.subColumns.length;AB++){if(AC.subColumns[AB].isIdForm){AF=AC.subColumns[AB];break;}}C(w,AF);}else{C(w,AC);}}}AE.changeEMMAMappings();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineSearchablePulldown","mstrmojo.Refine.RefineConstants");mstrmojo.requiresDescs(629,6052,6051,12316,12317,12318,12319,12320,12321,4728,14539,14540,14541,14542,12327,12328,12329,12330,12331,12332,12333,12334,12335,14268,14269,14270,12339,12340,12341,12342,12343,12344,12345,3627,12346,14274,1388,12347,12348,12349,13647,13884,13957,13958,12575,12577,190,14514,14515,14516,14738,14739);var H=mstrmojo.Refine.RefineConstants;var C=mstrmojo.css;var I=mstrmojo.dom;var E=[{name:mstrmojo.desc(629,"Delete"),type:H.transformationType.Delete,items:[{name:mstrmojo.desc(12575,"Delete Column"),subType:H.transformationSubType.DeleteColumn},{name:mstrmojo.desc(12577,"Delete Row"),subType:H.transformationSubType.DeleteRow},{name:mstrmojo.desc(12316,"Remove Duplicate Cells"),subType:H.transformationSubType.RemoveDuplicateCells},{name:mstrmojo.desc(12317,"Remove Duplicate Rows"),subType:H.transformationSubType.RemoveDuplicateRows,noColumn:true},{name:mstrmojo.desc(14738,"Delete Row Included In Selectors"),subType:H.transformationSubType.DeleteRowsInTheView},{name:mstrmojo.desc(14739,"Delete Row Not-included In Selectors"),subType:H.transformationSubType.DeleteRowsNotInTheView}]},{name:mstrmojo.desc(12318,"Extract"),type:H.transformationType.Extract,items:[{name:mstrmojo.desc(12319,"Extract By Fixed Length"),subType:H.transformationSubType.ExtractByFixedLength},{name:mstrmojo.desc(12320,"Extract Before Separator"),subType:H.transformationSubType.ExtractBeforeSeparator},{name:mstrmojo.desc(12321,"Extract After Separator"),subType:H.transformationSubType.ExtractAfterSeparator}]},{name:mstrmojo.desc(4728,"Selector"),type:H.transformationType.Facet,items:[{name:mstrmojo.desc(14539,"Text Selector"),subType:H.transformationSubType.TextFacet},{name:mstrmojo.desc(14540,"Numeric Selector"),subType:H.transformationSubType.NumericFacet},{name:mstrmojo.desc(14541,"Timeline Selector"),subType:H.transformationSubType.TimelineFacet},{name:mstrmojo.desc(14542,"Text Search"),subType:H.transformationSubType.SearchFacet}]},{name:mstrmojo.desc(12327,"Find And Replace"),type:H.transformationType.FindAndReplace,items:[{name:mstrmojo.desc(12328,"Find And Replace Characters In Cell"),subType:H.transformationSubType.FindAndReplaceCharactersInCell},{name:mstrmojo.desc(12329,"Find And Replace Cell"),subType:H.transformationSubType.FindAndReplaceCell}]},{name:mstrmojo.desc(190,"Remove"),type:H.transformationType.RemoveText,items:[{name:mstrmojo.desc(14514,"Remove Characters"),subType:H.transformationSubType.RemoveTheText},{name:mstrmojo.desc(14515,"Remove Characters Before"),subType:H.transformationSubType.RemoveTheTextBefore},{name:mstrmojo.desc(14516,"Remove Characters After"),subType:H.transformationSubType.RemoveTheTextAfter}]},{name:mstrmojo.desc(12330,"Split"),type:H.transformationType.Split,items:[{name:mstrmojo.desc(12331,"Split By Fixed Length"),subType:H.transformationSubType.SplitByFixedLength},{name:mstrmojo.desc(12332,"Split On Separator"),subType:H.transformationSubType.SplitOnSeparator},{name:mstrmojo.desc(12333,"Split Before Separator"),subType:H.transformationSubType.SplitBeforeSeparator},{name:mstrmojo.desc(12334,"Split After Separator"),subType:H.transformationSubType.SplitAfterSeparator},{name:mstrmojo.desc(13884,"Split Cell Into Rows On Separator"),subType:H.transformationSubType.SplitCellIntoRows}]},{name:mstrmojo.desc(12335,"Transform Cell"),type:H.transformationType.TransformCell,items:[{name:mstrmojo.desc(14268,"To Title Case"),subType:H.transformationSubType.Titlecase},{name:mstrmojo.desc(14269,"To Uppercase"),subType:H.transformationSubType.Uppercase},{name:mstrmojo.desc(14270,"To Lowercase"),subType:H.transformationSubType.Lowercase},{name:mstrmojo.desc(12339,"Unescape HTML"),subType:H.transformationSubType.UnescapeHTML},{name:mstrmojo.desc(12340,"Change Data Type"),subType:H.transformationSubType.ChangeDataType},{name:mstrmojo.desc(12341,"Fill Down"),subType:H.transformationSubType.FillDown},{name:mstrmojo.desc(12342,"Blank Down"),subType:H.transformationSubType.BlankDown},{name:mstrmojo.desc(13957,"Pad Before"),subType:H.transformationSubType.PadBefore},{name:mstrmojo.desc(13958,"Pad After"),subType:H.transformationSubType.PadAfter}]},{name:mstrmojo.desc(12343,"Whitespace"),type:H.transformationType.Whitespace,items:[{name:mstrmojo.desc(12344,"Trim Leading And Trailing Whitespace"),subType:H.transformationSubType.TrimLeadingTrailingWhitespace},{name:mstrmojo.desc(12345,"Collapse Consecutive Whitespace"),subType:H.transformationSubType.CollapseConsecutiveWhitespace}]},{name:mstrmojo.desc(3627,"Other"),type:H.transformationType.Other,items:[{name:mstrmojo.desc(12346,"Cluster And Edit"),subType:H.transformationSubType.ClusterAndEdit},{name:mstrmojo.desc(14274,"Duplicate Column"),subType:H.transformationSubType.Duplicate},{name:mstrmojo.desc(1388,"Rename"),subType:H.transformationSubType.Rename},{name:mstrmojo.desc(12347,"Concatenate Columns"),subType:H.transformationSubType.ConcatenateColumns},{name:mstrmojo.desc(13975,"Transpose Columns To Rows"),subType:H.transformationSubType.TransposeColumnsToRows}]}];mstrmojo.Refine.RefineTransformations=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineTransformations",alias:"RefineTransformations",markupString:'<div class="refine-transformations" mstrAttach:mousedown><div class="refine-transformations-top"><div class="refine-transformations-columns"></div><div class="refine-transformations-functions"></div><div class="refine-transformations-control"></div></div><div class="refine-transformations-suggestions"></div></div>',markupSlots:{transformationNode:function(){return this.domNode.children[0];},columnsNode:function(){return this.domNode.children[0].children[0];},functionNode:function(){return this.domNode.children[0].children[1];},controlNode:function(){return this.domNode.children[0].children[2];},suggestionsNode:function(){return this.domNode.children[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},setDimensions:function G(N,L){var J=parseInt(N,10);var M=parseInt(L,10);if(isNaN(J)||isNaN(M)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var O=44;C.toggleClass(this.domNode,"selected",true);var K=Math.floor(M*0.65);if(K<980){C.toggleClass(this.domNode,"short",true);}else{C.toggleClass(this.domNode,"short",false);}K=Math.max(Math.floor(M*0.65),618);this.layoutConfig.h.transformationNode=O+"px";this.layoutConfig.w.transformationNode=K+"px";this.layoutConfig.h.suggestionsNode=(J-O-14)+"px";this.layoutConfig.w.suggestionsNode=(K-14)+"px";if(this._super){this._super(J+"px",K+"px");}},postBuildRendering:function B(){this.setDimensions(this.parent.domNode.style.height,this.parent.domNode.style.width);if(this._super){this._super();}},onmousedown:function(J){var L=J.e,K=I.eventTarget(J.hWin,L);if(K.className.indexOf("mstrmojo-scrollbar")===-1){this.controller.isClickedInTransformation=true;I.stopPropogation(J.hWin,J.e);}},populate:function F(L){var J=[],K;for(K=0;K<L.columns.length;K++){J.push({n:L.columns[K].name,name:L.columns[K].name,columnIndex:K,cellIndex:L.columns[K].cellIndex,originalName:L.columns[K].originalName});}J.sort(function(N,M){return N.n.localeCompare(M.n);});this.columns.selectedIndex=null;this.columns.set("items",J);},handleColumnsChanged:function A(J){this.populate(J.value);},handleColumnSelected:function(L){var K,J=this.columns.list.items;for(K=0;K<J.length;K++){if(L.columnIndex===J[K].columnIndex){if(this.columns.list.selectedIndex!==K){this.columns.list.set("selectedIndex",K);}}}},handleColumnUnSelected:function(){this.columns.set("value",mstrmojo.desc(12348,"Select Column"));this.columns.set("text",mstrmojo.desc(12348,"Select Column"));this.columns.selectedIndex=undefined;this.columns.list.set("selectedIndex",null);C.toggleClass(this.columns.domNode,"selected",false);this.transformationList.set("value",mstrmojo.desc(12349,"Select Function"));this.transformationList.set("text",mstrmojo.desc(12349,"Select Function"));this.transformationList.list.set("selectedIndex",null);this.transformationList.set("type",-1);this.transformationList.set("subType",-1);C.toggleClass(this.transformationList.domNode,"selected",false);C.toggleClass(this.transformationList.domNode,"disable",true);this.transformationList.selectedNode.title=mstrmojo.desc(13647,"Select a column for more functions");},children:[{slot:"columnsNode",scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-column-pulldown",cssClass:"refine-pulldown",alias:"columns",allowHTML:false,title:mstrmojo.desc(13647,"Select a column for more functions"),onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);C.toggleClass(this.parent.transformationList.domNode,"disable",false);this.parent.transformationList.selectedNode.title="";this.parent.controller.model.raiseEvent({name:"columnSelected",columnIndex:J.columnIndex,columnName:J.n,updateScrollLeft:true});if(this.parent.transformationList.subType===74){this.parent.transformationList.subType=-1;this.parent.transformationList.set("subType",74);}}},{scriptClass:"mstrmojo.Refine.RefineSearchablePulldown",hostedCSSClass:"refine-transformation-pulldown",cssClass:"refine-pulldown disable",slot:"functionNode",alias:"transformationList",type:-1,subType:-1,preBuildRendering:function(){this.setItems();},setItems:function(){var U,T,K,N,R=[],Q,M,S;var O,L,P;P=mstrmojo.hash.clone(E);if(mstrApp.getRootController().refineApp.isBDE){P[0].items=P[0].items.slice(0,2);P.splice(2,1);}for(O=0;O<P.length;O++){Q=P[O];K=Q.name;S=Q.items;U={};U.type=Q.type;U.n=K;U.cls="refine-transformations-list-big";U.skipSearch=true;R.push(U);for(L=0;L<S.length;L++){U={};M=S[L];N=M.name;U.subType=M.subType;U.type=Q.type;T="refine-transformations-list-small";if(M.noColumn===true){U.noColumn=true;T="refine-transformations-list-small noColumn";}if(M.subType===H.transformationSubType.DeleteRowsInTheView||M.subType===H.transformationSubType.DeleteRowsNotInTheView){var J=this.parent.controller.refinePanel.bottomPanal.splitter.facetPanel;if(!J.hasSelection()){U.disable=true;T="refine-transformations-list-small disable";}else{U.noColumn=true;T="refine-transformations-list-small noColumn";}}U.n=N;U.cls=T;R.push(U);}}this.set("items",R);},onitemSelected:function(J){C.toggleClass(this.domNode,"selected",true);this.set("noColumn",J.noColumn);this.set("subType",J.subType);this.set("type",J.type);},getPopupListConfig:function D(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,cssText:"",listHooks:{select:function J(M,P,L){var O=this.parent.parent;var N=O.columns.selectedIndex;if((N===undefined&&P.noColumn!==true)||P.subType===undefined||P.disable===true){return true;}this.parent.set("selectedIndex",L);this.close();}},getItemProps:function K(M,L){return mstrmojo._IsList.getItemProps.call(this,M,L);}};}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Refine.HistogramWidget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(1395,12353,2797,96,1905,8445,13687);var A=mstrmojo.dom;var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.inputNode){if(this.label===mstrmojo.desc(1395,"Numeric")){this.parent.selectNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12353,"Non-numeric")){this.parent.selectNonNumeric=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.RangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RangeFacet",config:null,options:null,from:null,to:null,selectNumeric:true,selectNonNumeric:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var F=this.parent;var D=mstrmojo.Refine.RangeFacet;var E=D.menuHelper=D.menuHelper||new mstrmojo.Refine.RefineFacetMenu();E.target=F;E.type=0;var C=E.getMenuConfig();C.hostId=F.id;C.hostElement=this.domNode;C.isHostedWithin=false;C.position=A.position(this.domNode,true);F.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:C}));}}],onclick:function(C){var E=C.e,D=A.eventTarget(C.hWin,E);if(D===this.resetNode){this.reset();this.parent.updateEngine(true);}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectNumeric=true;this.selectNonNumeric=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(this.from===null||this.to===null){return ;}this.statusNode.innerHTML=this.addCommas(this.from.toFixed(2))+" &mdash; "+this.addCommas(this.to.toFixed(2));},addCommas:function(G){var C,F,D;G+="";C=G.split(".");F=C[0];D=C.length>1?"."+C[1]:"";var E=/(\d+)(\d{3})/;while(E.test(F)){F=F.replace(E,"$1,$2");}return F+D;},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectNumeric||!this.selectNonNumeric||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var C='{cells in "'+this.config.name+'" are';var D="";if(this.selectNumeric&&this.numericCount>0){D+=" "+this.statusNode.innerHTML;}if(this.selectNonNumeric&&this.nonNumericCount){if(D){D+=" /";}C+=" (Non-Numeric)";}if(this.selectBlank&&this.blankCount){if(D){D+=" /";}C+=" (blank)";}D+="}";return C+D;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(C){if(C.hasOwnProperty("min")&&C.hasOwnProperty("max")){this.error=false;this.config.min=C.min;this.config.max=C.max;this.config.step=C.step;this.baseBins=C.baseBins;this.bins=C.bins;switch(this.config.mode){case"min":this.from=Math.max(C.from,this.config.min);break;case"max":this.to=Math.min(C.to,this.config.max);break;default:this.from=Math.max(C.from,this.config.min);if(C.to!==undefined){this.to=Math.min(C.to,this.config.max);}else{this.to=C.max;}}this.baseNumericCount=C.baseNumericCount;this.baseNonNumericCount=C.baseNonNumericCount;this.baseBlankCount=C.baseBlankCount;this.baseErrorCount=C.baseErrorCount;this.numericCount=C.numericCount;this.nonNumericCount=C.nonNumericCount;this.blankCount=C.blankCount;this.errorCount=C.errorCount;}else{this.error=true;this.errorMessage=C.hasOwnProperty("error")?C.error:mstrmojo.desc(13687,"Unknown error");}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(C){this.from=C.from;this.to=C.to;this.setRangeIndicators();},handleStop:function(C){this.from=C.from;this.to=C.to;this.selectNumeric=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonNumericCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(!this.hasOtherChoices()){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var C=[];B.slot="choicesNode";B.label=mstrmojo.desc(1395,"Numeric");B.count=this.numericCount;B.checked=(this.selectNumeric&&this.baseNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12353,"Non-numeric");B.count=this.nonNumericCount;B.checked=(this.selectNonNumeric&&this.baseNonNumericCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);C.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);C.push(new mstrmojo.Widget(B));this.addChildren(C);},getJSON:function(){var C;var D=mstrApp.rootController.refineApp.rootController.model;var E=D.columns.columns;var G=false;if(this.config.originalName!==undefined){G=true;for(C=0;C<E.length;C++){if(E[C].originalName===this.config.originalName){break;}}if(C===E.length){G=false;}}var F={type:"range",name:G?E[C].name:this.config.name,columnName:G?E[C].name:this.config.columnName,expression:this.config.expression,selectNumeric:this.selectNumeric,selectNonNumeric:this.selectNonNumeric,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){F.from=this.from;}if(this.to!==null){F.to=this.to;}return F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.PopupEditBox","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Widget","mstrmojo.dom");mstrmojo.requiresDescs(3946,3945,12352,1905,8445,1088);var A=mstrmojo.dom;var B=mstrmojo.css;var D=100;var C={scriptClass:"mstrmojo.Widget",choiceIndex:null,label:null,count:null,s:false,markupString:'<div class="facet-choice" mstrAttach:click,mouseover,mouseout><a class="facet-choice-link"></a><a class="facet-choice-link">'+mstrmojo.desc(1088,"Edit")+'</a><div class="facet-choice-label"></div><span class="facet-choice-count">({@count})</span><div class="facet-choice-count-bar"></div></div>',markupSlots:{toggleNode:function(){return this.domNode.children[0];},editNode:function(){return this.domNode.children[1];},labelNode:function(){return this.domNode.children[2];},countNode:function(){return this.domNode.children[3];},barNode:function(){return this.domNode.children[4];}},markupMethods:{onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(String(this.label)||"",null,true);}},onmouseover:function(){if(!this.s){this.toggleNode.style.visibility="visible";}this.editNode.style.visibility="visible";},onmouseout:function(){if(!this.s){this.toggleNode.style.visibility="hidden";}this.editNode.style.visibility="hidden";},onclick:function(E){var J=E.e,F=A.eventTarget(E.hWin,J);if(F===this.labelNode){this.parent.labelClick(this.choiceIndex);}else{if(F===this.toggleNode){this.parent.toggleClick(this.choiceIndex);}else{if(F===this.editNode){var G=A.position(this.domNode);var I=G.x-1;var H=G.y-1;mstrmojo.insert({scriptClass:"mstrmojo.Refine.PopupEditBox",cssClass:"facet",top:H+document.body.scrollTop+"px",left:I+document.body.scrollLeft+"px",width:G.w+"px",text:this.blankChoice?"":this.label,preview:this.parent.parent.parent.parent.parent,columnName:this.parent.config.name,type:"text",blankChoice:this.blankChoice,fromFacet:true,floatLeft:true}).render();}}}},postBuildRendering:function(){if(this.s){B.toggleClass(this.domNode,"facet-choice-selected",true);}this.toggleNode.style.visibility=(this.s?"visible":"hidden");this.toggleNode.innerHTML=(this.parent.config.invert!==this.s?mstrmojo.desc(3946,"exclude"):mstrmojo.desc(3945,"include"));this.editNode.style.visibility="hidden";if(this.toggleNode.clientWidth+this.editNode.clientWidth+this.labelNode.clientWidth+this.countNode.offsetWidth+21>291){this.toggleNode.style.maxWidth="45px";this.editNode.style.maxWidth="45px";}this.barNode.style.right=(1-this.bar)*100+"%";}};mstrmojo.Refine.ListFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.ListFacet",config:null,options:null,selection:[],blankChoice:null,errorChoice:null,data:null,_dataIndex:0,_childrenNodes:[],markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><a class="facet-choice-link" >'+mstrmojo.desc(12352,"invert")+'</a><div class="facet-column-name"></div><div class="choiceCountContainer"></div> </div><div class="facet-menu"></div></div><div class="facet-body"><div class="facet-body-inner"></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},invertNode:function(){return this.domNode.children[0].children[0].children[1];},choiceCountNode:function(){return this.domNode.children[0].children[0].children[3];},titleNode:function(){return this.domNode.children[0].children[0].children[2];},bodyInnerNode:function(){return this.domNode.children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var H=this.parent;var F=mstrmojo.Refine.ListFacet;var G=F.menuHelper=F.menuHelper||new mstrmojo.Refine.RefineFacetMenu();G.target=H;G.type=0;var E=G.getMenuConfig();E.hostId=H.id;E.hostElement=this.domNode;E.isHostedWithin=false;E.position=A.position(this.domNode,true);H.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:E}));}}],labelClick:function(G){var H=this.data.choices,F;var E=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);if(G===-1){F=this.blankChoice;}else{if(G===-2){F=this.errorChoice;}else{F=H[G];}}if(F.s){if(E>1){this.select(F,true);}else{this.deselect(F);}}else{if(E>0){this.select(F,true);}else{this.select(F,false);}}},toggleClick:function(F){var G=this.data.choices,E;if(F===-1){E=this.data.blankChoice;}else{E=G[F];}if(E.s){this.deselect(E);}else{this.select(E,false);}},select:function(E,F){if(F){this.selection=[];if(this.blankChoice!==null){this.blankChoice.s=false;}if(this.errorChoice!==null){this.errorChoice.s=false;}}E.s=true;if(E!==this.errorChoice&&E!==this.blankChoice){this.selection.push(E);}this.parent.updateEngine(true);},deselect:function(E){var F;if(E===this.errorChoice||E===this.blankChoice){E.s=false;}else{for(F=this.selection.length-1;F>=0;F--){if(this.selection[F]===E){this.selection.splice(F,1);break;}}}this.parent.updateEngine(true);},onclick:function(E){var G=E.e,F=A.eventTarget(E.hWin,G);if(F===this.invertNode){this.config.invert=!this.config.invert;this.parent.updateEngine(true);}else{if(F===this.resetNode){this.reset();this.parent.updateEngine(true);}}},sortByName:function(){if(this.options.sort!=="name"){this.options.sort="name";this.reSortChoices();this.update();}},sortByCount:function(){if(this.options.sort!=="count"){this.options.sort="count";this.reSortChoices();this.update();}},reset:function(){this.selection=[];this.blankChoice=null;this.errorChoice=null;this.config.invert=false;},remove:function(){this.parent.removeFacet(this);this.config=null;this.selection=null;this.blankChoice=null;this.errorChoice=null;this.data=null;},hasSelection:function(){return this.selection.length>0||(this.blankChoice!==null&&this.blankChoice.s)||(this.errorChoice!==null&&this.errorChoice.s);},getRequirementDiscription:function(){var F,E='{cells in "'+this.config.name+'" '+(this.config.invert?"are not equal to ":"are equal to ");for(F=0;F<this.selection.length;F++){var G=this.selection[F];E+='"'+G.v.l+'"';if(F!==this.selection.length-1){E+=" / ";}}E+="}";return E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.config.invert=false;this.update();this.bodyInnerNode.onscroll=function(){var E=A.findWidget(this.parentNode.parentNode);if(this.scrollTop+this.clientHeight+3>=this.scrollHeight){if(E._dataIndex<E._childrenNodes.length-1){E.incrementalRender(E._childrenNodes,E._dataIndex);}}};},updateState:function(I){this.maxCount=0;this.data=I;var F,H=false;if(I.choices){var G=[];var J=I.choices;for(F=0;F<J.length;F++){var E=J[F];this.maxCount=Math.max(this.maxCount,E.c);if(E.s){if(E.c===0){H=true;}else{G.push(E);}}}this.selection=G;this.reSortChoices();this.blankChoice=null;if(I.blankChoice){this.maxCount=Math.max(this.maxCount,I.blankChoice.c);if(I.blankChoice.c===0){I.blankChoice=null;H=true;}else{this.blankChoice=I.blankChoice;}}this.errorChoice=I.errorChoice||null;}if(H===true){this.parent.updateEngine(true);return ;}this.update();},reSortChoices:function(){this.data.choices.sort(this.options.sort==="name"?function(F,E){return F.v.l.toLowerCase().localeCompare(E.v.l.toLowerCase());}:function(F,E){var G=E.c-F.c;return G!==0?G:F.v.l.localeCompare(E.v.l);});},update:function(){var I,J;var K=this.config.invert;if(K){B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",true);B.toggleClass(this.invertNode,"facet-mode-inverted",true);}else{B.toggleClass(this.bodyInnerNode,"facet-mode-inverted",false);B.toggleClass(this.invertNode,"facet-mode-inverted",false);}while(this.bodyInnerNode.hasChildNodes()){this.bodyInnerNode.removeChild(this.bodyInnerNode.firstChild);}if(!this.data){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=mstrmojo.desc(8445,"Loading")+"...";this.bodyInnerNode.appendChild(J);return ;}if(this.data.hasOwnProperty("error")){J=document.createElement("div");J.className="facet-body-message";J.innerHTML=this.data.error;this.bodyInnerNode.appendChild(J);return ;}var L=this.data.choices;var G=this.selection.length+(this.blankChoice!==null&&this.blankChoice.s?1:0)+(this.errorChoice!==null&&this.errorChoice.s?1:0);this.choiceCountNode.innerHTML="("+L.length+")";if(G>0){this.invertNode.style.display="block";this.resetNode.style.display="block";}else{this.invertNode.style.display="none";this.resetNode.style.display="none";}var E=[];var H,F;for(I=0;I<L.length;I++){H=L[I];if(H.c===0){continue;}C.slot="bodyInnerNode";C.choiceIndex=I;C.label=H.v.l;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;C.blankChoice=false;F=new mstrmojo.Widget(C);E.push(F);}if(this.blankChoice!==null){H=this.blankChoice;C.slot="bodyInnerNode";C.choiceIndex=-1;C.label="(blank)";C.blankChoice=true;C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}if(this.errorChoice!==null){H=this.errorChoice;C.slot="bodyInnerNode";C.choiceIndex=-2;C.label="(error)";C.count=H.c;C.bar=H.c/this.maxCount;C.s=H.s;F=new mstrmojo.Widget(C);E.push(F);}this.set("_dataIndex",0);this.set("_childrenNodes",E);this.incrementalRender(this._childrenNodes,this._dataIndex);},incrementalRender:function(F,H){var I=H===0?H:H+1,G=I+D-1,E=F.slice(I,G+1);this.set("_dataIndex",G);this.addChildren(E);},getJSON:function(){var I,E;var G=mstrApp.rootController.refineApp.rootController.model;var H=G.columns.columns;var K=false;if(this.config.originalName!==undefined){K=true;for(E=0;E<H.length;E++){if(H[E].originalName===this.config.originalName){break;}}if(E===H.length){K=false;}}var J={type:"list",name:K?H[E].name:this.config.name,columnName:K?H[E].name:this.config.columnName,expression:this.config.expression,omitBlank:this.config.omitBlank||false,omitError:this.config.omitError||false,selection:[],selectBlank:this.blankChoice!==null&&this.blankChoice.s,selectError:this.errorChoice!==null&&this.errorChoice.s,invert:this.config.invert};for(I=0;I<this.selection.length;I++){var F={v:this.selection[I].v};J.selection.push(F);}return J;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu");mstrmojo.requiresDescs(4326,8983);var A=mstrmojo.dom;mstrmojo.Refine.TextSearchFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TextSearchFacet",config:null,options:null,query:null,timerID:null,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><div class="facet-column-name text"></div></div><div class="facet-menu"></div></div><div class="facet-text-body"><div class="input-container" mstrAttach:keyup><textarea></textarea></div><div class="facet-text-options"><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(4326,"Case Sensitive")+'</label></div><div class="facet-text-item"><input type="checkbox"/><label>'+mstrmojo.desc(8983,"Regular Expression")+"</label></div></div></div></li>",markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},titleNode:function(){return this.domNode.children[0].children[0].children[0];},inputNode:function(){return this.domNode.children[1].children[0].children[0];},caseSensitiveNode:function(){return this.domNode.children[1].children[1].children[0].children[0];},regexNode:function(){return this.domNode.children[1].children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var E=this.parent;var C=mstrmojo.Refine.RangeFacet;var D=C.menuHelper=C.menuHelper||new mstrmojo.Refine.RefineFacetMenu();D.target=E;D.type=0;var B=D.getMenuConfig();B.hostId=E.id;B.hostElement=this.domNode;B.isHostedWithin=false;B.position=A.position(this.domNode,true);E.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:B}));}}],onkeyup:function(){this.query=this.inputNode.value;this.scheduleUpdate();},onclick:function(B){var D=B.e,C=A.eventTarget(B.hWin,D);if(C===this.removeNode){this.remove();}else{if(C===this.caseSensitiveNode){this.config.caseSensitive=!this.config.caseSensitive;if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}else{if(C===this.regexNode){if(this.config.mode==="regex"){this.config.mode="text";}else{this.config.mode="regex";}if(this.query!==null&&this.query.length>0){this.scheduleUpdate();}}}}},scheduleUpdate:function(){var B=this;if(!this.timerID){this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}else{window.clearTimeout(this.timerID);this.timerID=window.setTimeout(function(){B.timerID=null;B.parent.updateEngine(true);},500);}},reset:function(){this.query=null;this.inputNode.value="";this.parent.updateEngine(true);},remove:function(){this.parent.removeFacet(this);this.config=null;this.options=null;},hasSelection:function(){return(this.query!==null&&this.query!=="");},getRequirementDiscription:function(){var B='{cells in "'+this.config.name+'" contains "'+this.query+'"}';return B;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(B){this.config.caseSensitive=B.caseSensitive;this.config.mode=B.mode;if(this.config.caseSensitive){this.caseSensitiveNode.checked=true;}if(this.config.mode==="regex"){this.regexNode.checked=true;}},getJSON:function(){var B;var C=mstrApp.rootController.refineApp.rootController.model;var D=C.columns.columns;var E=false;if(this.config.originalName!==undefined){E=true;for(B=0;B<D.length;B++){if(D[B].originalName===this.config.originalName){break;}}if(B===D.length){E=false;}}return{type:"text",name:E?D[B].name:this.config.name,columnName:E?D[B].name:this.config.columnName,mode:this.config.mode,caseSensitive:this.config.caseSensitive,query:this.query};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.Button","mstrmojo.ui.menus.Menu","mstrmojo._HasPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.Refine.RefineFacetMenu","mstrmojo.Refine.HistogramWidget","mstrmojo.Refine.SliderWidget");mstrmojo.requiresDescs(487,12354,2797,96,1905,8445);var A=mstrmojo.dom;function C(F){var D=new Date(),G=window.Date.prototype.getTimezoneOffset.call(D),E=F-G*60*1000;return new Date(E);}var B={scriptClass:"mstrmojo.Widget",count:null,label:null,checked:null,markupString:'<div class="facet-range-item" mstrAttach:click><input type="checkbox" id="{@id}"><label for="{@id}"><span class="facet-range-choice-label">{@label}</span><div class="facet-range-choice-count">({@count})</div></label></div>',markupSlots:{inputNode:function(){return this.domNode.children[0];}},onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.inputNode){if(this.label===mstrmojo.desc(487,"Time")){this.parent.selectTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(12354,"Non-Time")){this.parent.selectNonTime=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(2797,"Blank")){this.parent.selectBlank=!this.checked;this.parent.parent.updateEngine(true);}else{if(this.label===mstrmojo.desc(96,"Error")){this.parent.selectError=!this.checked;this.parent.parent.updateEngine(true);}}}}}},postBuildRendering:function(){if(this.checked){this.inputNode.setAttribute("checked","checked");}}};mstrmojo.Refine.TimeRangeFacet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.TimeRangeFacet",config:null,options:null,from:null,to:null,step:null,selectTime:true,selectNonTime:true,selectBlank:true,selectError:true,markupString:'<li class="facet-container" id="{@id}" mstrAttach:click><div class="facet-title"><div class="facet-text"><a class="facet-choice-link" >'+mstrmojo.desc(1905,"reset")+'</a><div class="facet-column-name"></div></div><div class="facet-menu"></div></div><div class="facet-range-body"><div class="facet-range-message">'+mstrmojo.desc(8445,"Loading")+'...</div><div class="facet-range-slider slider-widget"><div class="facet-range-histogram"></div></div><div class="facet-range-status"></div><div class="facet-range-other-choices"><div class="facet-range-choices time"></div></div></div></li>',markupSlots:{menuNode:function(){return this.domNode.children[0].children[1];},resetNode:function(){return this.domNode.children[0].children[0].children[0];},titleNode:function(){return this.domNode.children[0].children[0].children[1];},messageNode:function(){return this.domNode.children[1].children[0];},statusNode:function(){return this.domNode.children[1].children[2];},otherChoicesNode:function(){return this.domNode.children[1].children[3];},choicesNode:function(){return this.domNode.children[1].children[3].children[0];},sliderNode:function(){return this.domNode.children[1].children[1];},histogramNode:function(){return this.domNode.children[1].children[1].children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var G=this.parent;var E=mstrmojo.Refine.RangeFacet;var F=E.menuHelper=E.menuHelper||new mstrmojo.Refine.RefineFacetMenu();F.target=G;F.type=0;var D=F.getMenuConfig();D.hostId=G.id;D.hostElement=this.domNode;D.isHostedWithin=false;D.position=A.position(this.domNode,true);G.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:D}));}}],onclick:function(D){var F=D.e,E=A.eventTarget(D.hWin,F);if(E===this.removeNode){this.remove();}else{if(E===this.resetNode){this.reset();this.parent.updateEngine(true);}}},reset:function(){this.from=null;this.to=null;this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.selectTime=true;this.selectNonTime=true;this.selectBlank=true;this.selectError=true;this.setRangeIndicators();},setRangeIndicators:function(){if(!this.from||!this.to){return ;}var F=C(this.from);var E=C(this.to);var D="yyyyMMdd";var G="HH:mm:ss";if(this.config.step>2629746000){this.statusNode.innerHTML=(F.getFullYear()+" &mdash; "+E.getFullYear());}else{if(this.config.step>3600000){this.statusNode.innerHTML=(F.toString(D)+" &mdash; "+E.toString(D));}else{this.statusNode.innerHTML=(F.toString(D)+" "+F.toString(G)+" &mdash; "+E.toString(D)+" "+E.toString(G));}}},remove:function(){this.parent.removeFacet(this);this.config=null;this.data=null;},hasSelection:function(){if(!this.selectTime||!this.selectNonTime||!this.selectBlank||!this.selectError){return true;}return(this.from!==null&&(!this.initializedUI||this.from>this.config.min))||(this.to!==null&&(!this.initializedUI||this.to<this.config.max));},getRequirementDiscription:function(){var D='{cells in "'+this.config.name+'" are';var E="";if(this.selectTime&&this.timeCount>0){E+=" "+this.statusNode.innerHTML;}if(this.selectNonTime&&this.nonTimeCount>0){if(E){E+=" /";}E+=" (Non-Time)";}if(this.selectBlank&&this.blankCount){if(E){E+=" /";}E+=" (blank)";}E+="}";return D+E;},postBuildRendering:function(){if(this._super){this._super();}this.titleNode.innerHTML=this.config.name;this.titleNode.title=this.config.name;},updateState:function(D){if(D.hasOwnProperty("min")&&D.hasOwnProperty("max")&&D.baseTimeCount!==0){this.error=false;this.config.min=D.min;this.config.max=D.max;this.config.step=D.step;this.baseBins=D.baseBins;this.bins=D.bins;switch(this.config.mode){case"min":this.from=Math.max(D.from,this.config.min);break;case"max":this.to=Math.min(D.to,this.config.max);break;default:this.from=Math.max(D.from,this.config.min);if(D.to){this.to=Math.min(D.to,this.config.max);}else{this.to=D.max;}}this.baseTimeCount=D.baseTimeCount;this.baseNonTimeCount=D.baseNonTimeCount;this.baseBlankCount=D.baseBlankCount;this.baseErrorCount=D.baseErrorCount;this.timeCount=D.timeCount;this.nonTimeCount=D.nonTimeCount;this.blankCount=D.blankCount;this.errorCount=D.errorCount;}else{if(D.baseTimeCount===0){this.error=true;this.errorMessage="No date value present.";}else{this.error=true;this.errorMessage=D.hasOwnProperty("error")?D.error:"Unknown error.";}}this._render();},initializeUI:function(){this.histogram=new mstrmojo.Refine.HistogramWidget({slot:"histogramNode",options:{binColors:["#dad8d8","#67c0f0"],binBorderColors:["cbcbcb","4bafe5"]}});this.addChildren([this.histogram]);this.sliderWidget=new mstrmojo.Refine.SliderWidget({sliderNode:this.sliderNode});this.addChildren([this.sliderWidget]);this.attachEventListener("slide",this.id,this.handleSlide);this.attachEventListener("stop",this.id,this.handleStop);},handleSlide:function(D){this.from=D.from;this.to=D.to;this.setRangeIndicators();},handleStop:function(D){this.from=D.from;this.to=D.to;this.selectTime=true;this.parent.updateEngine(true);},_render:function(){if(!this.initializedUI){this.initializeUI();this.initializedUI=true;}if(this.error){this.messageNode.innerHTML=this.errorMessage;this.messageNode.style.display="block";this.sliderNode.style.display="none";this.histogramNode.style.display="none";this.statusNode.style.display="none";this.otherChoicesNode.style.display="none";return ;}this.messageNode.style.display="none";this.sliderNode.style.display="block";this.histogramNode.style.display="block";this.statusNode.style.display="block";this.otherChoicesNode.style.display="block";this.sliderWidget.update(this.config.min,this.config.max,this.config.step,this.from,this.to);this.histogram.update(this.config.min,this.config.max,this.config.step,[this.baseBins,this.bins]);this.setRangeIndicators();this.renderOtherChoices();},hasOtherChoices:function(){if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return false;}return true;},renderOtherChoices:function(){while(this.otherChoicesNode.hasChildNodes()){this.otherChoicesNode.removeChild(this.otherChoicesNode.lastChild);}if(this.baseNonTimeCount===0&&this.baseBlankCount===0&&this.baseErrorCount===0){return ;}this.choicesNode=document.createElement("div");this.choicesNode.className="facet-range-choices";this.otherChoicesNode.appendChild(this.choicesNode);var D=[];B.slot="choicesNode";B.label=mstrmojo.desc(487,"Time");B.count=this.timeCount;B.checked=(this.selectTime&&this.baseTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(12354,"Non-Time");B.count=this.nonTimeCount;B.checked=(this.selectNonTime&&this.baseNonTimeCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(2797,"Blank");B.count=this.blankCount;B.checked=(this.selectBlank&&this.baseBlankCount!==0);D.push(new mstrmojo.Widget(B));B.slot="choicesNode";B.label=mstrmojo.desc(96,"Error");B.count=this.errorCount;B.checked=(this.selectError&&this.baseErrorCount!==0);D.push(new mstrmojo.Widget(B));this.addChildren(D);},getJSON:function(){var D;var E=mstrApp.rootController.refineApp.rootController.model;var F=E.columns.columns;var H=false;if(this.config.originalName!==undefined){H=true;for(D=0;D<F.length;D++){if(F[D].originalName===this.config.originalName){break;}}if(D===F.length){H=false;}}var G={type:"timerange",name:H?F[D].name:this.config.name,columnName:H?F[D].name:this.config.columnName,expression:this.config.expression,selectTime:this.selectTime,selectNonTime:this.selectNonTime,selectBlank:this.selectBlank,selectError:this.selectError};if(this.from!==null){G.from=this.from;}if(this.to!==null){G.to=this.to;}return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.RefineMenu","mstrmojo.InlineEditBox","mstrmojo.DI.DIConstants");var A=mstrmojo.dom;var C=0;var D=mstrmojo.DI.DIHelpers;var B=mstrmojo.DI.DIConstants;mstrmojo.Refine.RefineDataHeader=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.Refine.RefineDataHeader",text:"",markupString:'<div id="{@id}" class="refine-data-header {@cssClass}" style="{@cssText}" mstrAttach:mousedown><div class="refine-data-header-text"></div><div class="refine-data-header-menu"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{textNode:function(){return this.domNode.children[0];},menuNode:function(){return this.domNode.children[1];}},onmousedown:function(E){this.preview.controller.model.raiseEvent({name:"columnSelected",columnIndex:this.columnIndex,columnName:this.text,isCtrlKey:D.isCtrlKey(E.hWin,E.e)});this.preview.controller.isClickedInDatePreview=true;this.preview.controller.resetRecords();},children:[{slot:"textNode",alias:"inlineEdit",scriptClass:"mstrmojo.InlineEditBox",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:mousedown,dblclick><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div><div class="mstrmojo-InlineEditBox-overlay"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},inputNode:function(){return this.domNode.childNodes[1].firstChild;},okNode:function(){return this.domNode.childNodes[1].childNodes[1];},cancelNode:function(){return this.domNode.childNodes[1].lastChild;},overlayNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text||"",null,true);this.textNode.title=mstrmojo.string.encodeHtmlString(this.text||"",null,true);},oneditModeChange:function(){var K=this.editMode,H=this.domNode,F=this.textNode,G=this.overlayNode,J=this.editNode;mstrmojo.css.toggleClass(H,["edit"],K);if(K){F.style.display="none";J.style.display="block";G.style.display="block";F=this.inputNode;var I=F.style;F.value=this.text||"";I.width=(this.nodeWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";I.height=this.nodeHeight+"px";F.select();F.focus();if(F.createTextRange){var L=F.createTextRange(),E=F.value.length;L.move("character",E);L.select();}}else{F.style.display="block";J.style.display="none";G.style.display="none";}},onokSaveChange:function(){var E=this.okSave?"inline":"none";this.okNode.style.display=E;this.cancelNode.style.display=E;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},bindings:{text:"this.parent.text"},ondblclick:function(){this.nodeWidth=this.domNode.clientWidth;this.nodeHeight=this.domNode.clientHeight;this.set("editMode",this.allowEdit);},onmousedown:function(E){var G=E.e,F=A.eventTarget(E.hWin,G);if(F===this.okNode){this.save();}else{if(F===this.cancelNode){this.cancel();}}},save:function(){this.oldColumn=this.text;this.newColumn=this.inputNode.value;this.set("editMode",false);if(this.oldColumn===this.newColumn){return ;}if(this.onSave){this.onSave();}},onSave:function(){this.handleRename();},handleRename:function(){var E=this.parent.preview.controller;var I=mstrApp.getRootController();var H=E.model;var J=this.oldColumn;var K=this.newColumn;var G=[],F;if(B.invalidObjectNameCharsRegex.test(K)){I.displayError(mstrmojo.desc(12831,"Cannot rename column with string contains the following characters: ####").replace("####",B.invalidObjectNameChars));return false;}F=JSON.parse(JSON.stringify(H.transformations.Other.Rename));F.description=F.description.replace("####",J);F.description=F.description.replace("@@@@",K);F.oldColumnName=J;F.newColumnName=K;G.push(F);E.applyOperations({operations:JSON.stringify(G),engine:JSON.stringify({facets:[],mode:"row-based"})});},handleDelete:function(){var F=this.parent.preview.controller;var I=F.model;var E=this.text;var H=[],G;G=JSON.parse(JSON.stringify(I.transformations.Delete.Colomn));G.description=G.description.replace("[column name]",E);G.columnName=E;H.push(G);F.applyOperations({operations:JSON.stringify(H),engine:JSON.stringify({facets:[],mode:"row-based"})});},_attachEvents:function(){var E=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var F=A.eventTarget(self,arguments[0]);if(F===E.overlayNode){E.save();}};}A.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){A.detachEvent(document.body,"mousedown",this._save_handler);}}}},{slot:"menuNode",alias:"menu",iconClass:"refine",scriptClass:"mstrmojo.Button",onclick:function(){var H=this.parent;var F=mstrmojo.Refine.RefineDataHeader;var G=F.menuHelper=F.menuHelper||new mstrmojo.Refine.RefineMenu();G.target=H;G.data=[H.data];G.type=C;var E=G.getMenuConfig();E.hostId=H.id;E.hostElement=this.domNode;E.isHostedWithin=false;E.position=A.position(this.domNode,true);E.isRefine=!!mstrApp.isWorkstation?true:false;H.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:E}));},bindings:{visible:function(){return(!this.parent.suggestionPreview);}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.dom");var B={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var A={scriptClass:"mstrmojo.Refine.RefineDataCell"};mstrmojo.Refine.RefineSuggestionPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineSuggestionPreview",markupString:'<div class="refine-suggestion-preview"><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner"></div></div></div>',markupSlots:{dataNode:function(){return this.domNode.children[0];},tableNode:function(){return this.domNode.children[0].children[0];}},enableEdit:true,scrollTop:0,setDimensions:function C(E){var D=parseInt(E,10);if(isNaN(D)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.dataNode=(this.enableEdit?(D-56-2):(D-2))+"px";this.layoutConfig.w.dataNode="auto";this.layoutConfig.h.tableNode=(this.enableEdit?(D-56-2):(D-2))+"px";this.layoutConfig.w.tableNode="auto";if(this.domNode){if(this.cellPos){this.domNode.style.top=(this.cellPos.tableTop+30)+"px";if(this.domNode.clientWidth+10<this.cellPos.distanceToRight){this.domNode.style.left=this.cellPos.cellRight+10+"px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview left";}else{if(this.domNode.clientWidth+10<this.cellPos.distanceToLeft){this.domNode.style.right=(this.cellPos.cellRight+this.cellPos.distanceToRight)-this.cellPos.cellLeft+10+"px";this.domNode.style.left="";this.domNode.className="refine-suggestion-preview right";}else{if(this.cellPos.distanceToRight>=this.cellPos.distanceToLeft){this.domNode.style.left="";this.domNode.style.right="0px";this.domNode.className="refine-suggestion-preview left";}else{this.domNode.style.left="0px";this.domNode.style.right="";this.domNode.className="refine-suggestion-preview right";}}}}}if(this._super){this._super((D-2)+"px","auto");}},children:[{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(D){var F=D.value;for(var E=0;E<F.length;E++){F[E].destroy();}},populateData:function(G,H){if(!G||!H){this.parent.domNode.style.display="none";return ;}else{this.parent.domNode.style.display="block";this.parent.domNode.style.left="";this.parent.domNode.style.right="";}this.removeChildren();this.unrender();var F=0,E,D;this.rows=H.rows.length+1;this.cols=G.length;for(E=0;E<G.length;E++){B.slot=F+","+E;B.columnIndex=E;B.text=G[E].name;B.preview=this.parent;B.suggestionPreview=G[E].suggestionPreview;B.cssClass="suggestion-preview columnNumber"+G[E].columnNumber;B.allowEdit=this.parent.enableEdit;this.addChildren(B);}for(F=1;F<=H.rows.length;F++){for(E=0;E<G.length;E++){D=A;D.slot=F+","+E;D.columnIndex=E;D.column=G;D.rowIndex=H.rows[F-1].i;var I=H.rows[F-1].cells[G[E].cellIndex];if(I===null||I===undefined){I={v:""};}if(I.v===null||I.v===undefined){I.v="";}D.text=I.v;if(I.t){D.cssClass="date";}else{if(typeof I.v==="string"||I.v instanceof String){D.cssClass="text";D.text=I.v;}else{D.cssClass="number";}}D.cssClass+=" suggestion-preview";D.cssClass+=" columnNumber"+I.columnNumber;D.preview=this.parent;D.columnName=G[E].name;this.addChildren(D);}}this.render();this.updateCellClass(G,H);this.parent.setDimensions(parseInt(this.parent.domNode.style.height,10)+2);},updateCellClass:function(G,I){var F,E;var H=this.domNode.firstChild.children;for(F=0;F<=I.rows.length;F++){var J=H[F];var D=J.children;for(E=0;E<G.length;E++){if(F===0){D[E].className="refine-header";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}if(0<E<G.length-1){D[E].className+=" center";}}else{D[E].className="refine-cell";if(E===0){D[E].className+=" left";}if(E===G.length-1){D[E].className+=" right";}if(F===I.rows.length){D[E].className+=" bottom";}}}}this.parent.tableNode.scrollTop=this.parent.scrollTop;}}],populate:function(D,E){this.dataTable.populateData(D,E);},handlePreviewSuggestion:function(D){this.cellPos=D.cellPos;this.populate(D.columns,D.data);},handleUnPreviewSuggestion:function(){this.populate();},handlePreviewScrollTop:function(D){this.scrollTop=D.scrollTop;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.PopupEditBox","mstrmojo.Widget","mstrmojo.Table","mstrmojo.DataGrid","mstrmojo.Container","mstrmojo.Refine.RefineDataHeader","mstrmojo.Refine.RefineDataCell","mstrmojo.Refine.RefinePagination","mstrmojo.dom");mstrmojo.requiresDescs(4046,4049,1058,1059,2968,773,11411);var D=mstrmojo.css;var C={scriptClass:"mstrmojo.Refine.RefineDataHeader"};var B={scriptClass:"mstrmojo.Refine.RefineDataCell"};var F="### rows";function A(G){return G.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");}mstrmojo.Refine.RefineDataPreview=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineDataPreview",markupString:'<div class="refine-data-preview"><div class="refine-datapreivew-title cf"></div><div class="fixed-width-preview-container"><div class="fixed-width-preview-container-inner" mstrAttach:scroll></div></div><div class="refine-viewpanel-header"></div></div>',markupSlots:{headerNode:function(){return this.domNode.children[2];},dataNode:function(){return this.domNode.children[1];},tableNode:function(){return this.domNode.children[1].children[0];},titleNode:function(){return this.domNode.firstChild;}},enableEdit:true,columnIndex:-1,lastColumnIndex:-1,markupMethods:{onvisibleChange:function(){this.headerNode.style.display=this.enableEdit?"block":"none";}},onscroll:function(){this.controller.model.raiseEvent({name:"previewScrollTop",scrollTop:this.tableNode.scrollTop});},setDimensions:function E(K,H){var G=parseInt(K,10);var J=parseInt(H,10);var I=6;if(isNaN(G)||isNaN(J)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}G-=32;this.layoutConfig.h.dataNode=(this.enableEdit?(G-26-2):(G-2))+"px";this.layoutConfig.w.dataNode=(J-2)+"px";this.layoutConfig.h.tableNode=(this.enableEdit?(G-26-2-I):(G-2-I))+"px";this.layoutConfig.w.tableNode=(J-2)+"px";this.layoutConfig.w.headerNode=(J-16-2)+"px";if(this._super){this._super((G-2)+"px",(J-2)+"px");}},children:[{scriptClass:"mstrmojo.Refine.RefinePagination",slot:"headerNode",alias:"pagingNode"},{scriptClass:"mstrmojo.Table",slot:"tableNode",cssClass:"refine-table",alias:"dataTable",onremoveChild:function(G){var I=G.value;for(var H=0;H<I.length;H++){I[H].destroy();}},populateData:function(J,K){this.removeChildren();this.unrender();var I=0,H,G;this.rows=K.rows.length+1;this.cols=J.length;for(H=0;H<J.length;H++){C.slot=I+","+H;C.columnIndex=H;C.text=J[H].name;C.preview=this.parent;C.allowEdit=this.parent.enableEdit;this.addChildren(C);}for(I=1;I<=K.rows.length;I++){for(H=0;H<J.length;H++){G=B;G.slot=I+","+H;G.columnIndex=H;G.column=J;G.rowIndex=K.rows[I-1].i;var L=K.rows[I-1].cells[J[H].cellIndex];if(L===null||L===undefined){L={v:""};}if(L.v===null||L.v===undefined){L.v="";}G.text=L.v;if(L.t){G.cssClass=L.t;}else{if(typeof L.v==="string"||L.v instanceof String){G.cssClass="text";G.text=L.v;}else{G.cssClass="number";}}G.preview=this.parent;G.columnName=J[H].name;this.addChildren(G);}}this.render();this.updateCellClass(J,K);},updateCellClass:function(J,L){var I,H;var K=this.domNode.firstChild.children;for(I=0;I<=L.rows.length;I++){var M=K[I];var G=M.children;for(H=0;H<J.length;H++){if(I===0){G[H].className="refine-header";}else{G[H].className="refine-cell";}if(this.parent.columnIndex>=0&&this.parent.columnIndex===H){G[H].className+=" selected";if(I===L.rows.length){G[H].className+=" last";}}if(this.parent.lastColumnIndex>=0&&this.parent.lastColumnIndex===H){G[H].className+=" last-selected";if(I===L.rows.length){G[H].className+=" last";}}}}}},{alias:"previewTitle",slot:"titleNode",scriptClass:"mstrmojo.Label",cssClass:"refine-title-label"},{slot:"titleNode",scriptClass:"mstrmojo.Refine.RefineSampleButton",cssClass:"refine-title-sampleButton",},{scriptClass:"mstrmojo.Button",slot:"titleNode",alias:"refreshButton",cssClass:"mstrmojo.Refine.RefreshButton",iconClass:"mstrmojo-refine-refresh-button",visible:false,onclick:function(){var I=mstrApp.getRootController(),H=I.refineApp.rootController,G=H.model;if(G.hasUploadData){H.refreshSampleData(0);}},useRichTooltip:true,updateTooltipConfig:function(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPCENTER,left:(parseInt(this.domNode.offsetWidth,10)+6).toString()+"px",top:"-"+(parseInt(this.domNode.offsetHeight,10)+21).toString()+"px",content:mstrmojo.desc(773,"refresh")});}}],columns:null,populate:function(I,L){var H=this.controller.model;var J=this.controller.tableID;var K;var G="";K=mstrApp.getRootController().getModel().getImportSource(J);if(K){G=K.sourceInfo.name;}if(!!this.previewTitle){this.previewTitle.set("text",mstrmojo.desc(11411,"Sample Data")+": "+G);}this.dataTable.populateData(I,L);this.pagingNode.children[1].set("text","/");this.pagingNode.children[2].set("text",A(H.data.filtered)+" "+mstrmojo.desc(2968,"Rows"));this.pagingNode.right.totalPages.set("text","/ "+Math.ceil((parseInt(H.data.filtered,10)/parseInt(H.limit,10))).toString());this.pagingNode.set("totalPages",Math.ceil((parseInt(H.data.filtered,10)/parseInt(H.limit,10))).toString());this.handleStartChange();},handleDataChanged:function(G){this.data=G.value;this.populate(this.columns,this.data);this.controller.model.raiseEvent({name:"columnUnSelected"});},handleColumnsChanged:function(G){this.columns=G.value.columns;},handleColumnSelected:function(G){if(this.columnIndex!==G.columnIndex){if(G.isCtrlKey){this.lastColumnIndex=this.columnIndex;this.lastColumnName=this.columnName;}else{this.lastColumnIndex=-1;}this.columnIndex=G.columnIndex;this.columnName=G.columnName;this.dataTable.updateCellClass(this.columns,this.data);if(G.updateScrollLeft){this.tableNode.scrollLeft=this.dataTable["0,"+this.columnIndex].offsetLeft;}}if(this.lastColumnIndex>=0){if(this.lastColumnIndex<this.columnIndex){this.controller.generateColumnSuggestions(this.columnIndex,this.lastColumnName,this.columnName,this.columnIndex-this.lastColumnIndex+1);}else{this.controller.generateColumnSuggestions(this.columnIndex,this.columnName,this.lastColumnName,this.lastColumnIndex-this.columnIndex+1);}}else{this.controller.generateColumnSuggestions(this.columnIndex);}},handleColumnUnSelected:function(){this.columnIndex=-1;this.lastColumnIndex=-1;if(this.data){this.dataTable.updateCellClass(this.columns,this.data);}this.controller.model.raiseEvent({name:"emptySuggestions"});},handleStartChange:function(){var G=this.controller.model;if(G.start===0){this.pagingNode.right.firstNode.set("enabled",false);this.pagingNode.right.firstNode.set("useRichTooltip",false);this.pagingNode.right.previousNode.set("enabled",false);this.pagingNode.right.previousNode.set("useRichTooltip",false);}else{this.pagingNode.right.firstNode.set("enabled",true);this.pagingNode.right.firstNode.set("useRichTooltip",true);this.pagingNode.right.previousNode.set("enabled",true);this.pagingNode.right.previousNode.set("useRichTooltip",true);}if(G.start+G.limit>=G.data.filtered){this.pagingNode.right.nextNode.set("enabled",false);this.pagingNode.right.nextNode.set("useRichTooltip",false);this.pagingNode.right.lastNode.set("enabled",false);this.pagingNode.right.lastNode.set("useRichTooltip",false);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(G.start,10)/parseInt(G.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(G.start,10)+1)+" - "+A(G.data.filtered));}else{this.pagingNode.right.nextNode.set("enabled",true);this.pagingNode.right.nextNode.set("useRichTooltip",true);this.pagingNode.right.lastNode.set("enabled",true);this.pagingNode.right.lastNode.set("useRichTooltip",true);this.pagingNode.right.currentPage.set("value",parseInt(parseInt(G.start,10)/parseInt(G.limit,10),10)+1);this.pagingNode.children[0].set("text",A(parseInt(G.start,10)+1)+" - "+A(parseInt(G.start,10)+parseInt(G.limit,10)));}},});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Refine.ListFacet","mstrmojo.Refine.RangeFacet","mstrmojo.Refine.TimeRangeFacet","mstrmojo.Refine.TextSearchFacet");var A=mstrmojo.dom;mstrmojo.Refine.RefineFacetPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineFacetPanel",facets:[],markupString:'<div class="refine-facet-panel"><div class="browsing-panel-header"><div class="browsing-panel-indicator"><img src="../javascript/mojo/css/images/Refine/small-spinner.gif"> Refreshing facets...</div><div class="browsing-panel-controls"  mstrAttach:click><div class="browsing-panel-controls-refresh"><a class="button" title="Update all facets">Refresh</a></div><a class="button button-pill-left" title="Clear selection in all facets">Reset All</a><a class="button button-pill-right" title="Remove all facets">Remove All</a></div></div><ul class="facets-container ui-sortable"></ul></div>',markupSlots:{ulNode:function(){return this.domNode.children[1];},indicatornNode:function(){return this.domNode.children[0].children[0];},controlsNode:function(){return this.domNode.children[0].children[1];},refreshNode:function(){return this.domNode.children[0].children[1].children[0].children[0];},resetNode:function(){return this.domNode.children[0].children[1].children[1];},removeNode:function(){return this.domNode.children[0].children[1].children[2];},headerNode:function(){return this.domNode.children[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onclick:function(C){var F=C.e,E,D=A.eventTarget(C.hWin,F);if(D===this.refreshNode){this.updateEngine(true);}else{if(D===this.resetNode){this.resetAllFacets();this.updateEngine(true);}else{if(D===this.removeNode){this.removeAllFacets();this.updateEngine(true);}}}},resetAllFacets:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];D.reset();}},removeAllFacets:function(){var D;while(this.facets.length){var C=this.facets[0];this.facets.splice(0,1);this.removeChildren(C);C.destroy();}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}},hasSelection:function(){var C;for(C=0;C<this.facets.length;C++){var D=this.facets[C];if(D.hasSelection()){return true;}}return false;},getRequirementDiscription:function(){var D,C="";var E=[],F;for(D=0;D<this.facets.length;D++){F=this.facets[D];if(F.hasSelection()){E.push(F);}}for(D=0;D<E.length;D++){F=E[D];C+=F.getRequirementDiscription();if(D!==E.length-1){C+=" & ";}}return C;},getJSON:function(D){var E;var C={facets:[],mode:"row-based"};for(E=0;E<this.facets.length;E++){var F=this.facets[E];if(D||F.hasSelection()){C.facets.push(F.getJSON());}}return C;},updateEngine:function(E){var C=this.parent.parent.parent.controller;var D=C.model;if(E){this.parent.toggleSecondItemVisibility(true);this.controlsNode.style.visibility="hidden";this.indicatornNode.style.visibility="visible";D.engine=JSON.stringify(this.getJSON());D.start=0;C.loadData();}else{D.engine=JSON.stringify(this.getJSON());}},addFacets:function(D,C){var E;switch(D){case"range":E=new mstrmojo.Refine.RangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"timerange":E=new mstrmojo.Refine.TimeRangeFacet({slot:"ulNode",type:D,config:C,options:{}});break;case"text":E=new mstrmojo.Refine.TextSearchFacet({slot:"ulNode",type:D,config:C,options:{}});break;default:E=new mstrmojo.Refine.ListFacet({slot:"ulNode",type:D,config:C,options:{sort:"name"}});}this.addChildren([E]);this.facets.push(E);this.updateEngine(true);},removeFacet:function(F){var D;var E=F.hasSelection();for(D=this.facets.length-1;D>=0;D--){var C=this.facets[D];if(C===F){this.facets.splice(D,1);this.removeChildren(C);C.destroy();break;}}for(D=0;D<this.facets.length;D++){if(typeof this.facets[D].update==="function"){this.facets[D].update();}}if(E){this.updateEngine(true);}else{this.updateEngine(false);if(this.facets.length===0){this.parent.toggleSecondItemVisibility(false);}}},handleFacetsFetched:function(E){var D=E.facets,C;for(C=0;C<D.length;C++){this.facets[C].updateState(D[C]);}this.indicatornNode.style.visibility="hidden";if(this.facets.length>0){this.controlsNode.style.visibility="visible";}else{this.parent.toggleSecondItemVisibility(false);}this.updateEngine(false);},children:[],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(isNaN(C)||isNaN(E)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}if(C<2){C=2;}this.layoutConfig.h.ulNode=(C-2)+"px";this.layoutConfig.w.ulNode=(E-2)+"px";if(this._super){this._super((C-2)+"px",(E-2)+"px");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSearchOnSource=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSearchOnSource",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.MARK_GEO_ROLES:E=false;break;case A.CREATE_TIME_ATTRIBUTES:E=false;break;case A.CREATE_MULTIFORM_ATTRIBUTE:E=false;break;case A.MAP_TO_PROJECT_ATTRIBUTE:E=false;break;case A.UNMAP:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuHadoop=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuHadoop",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var B=mstrmojo.DI.DIConstants,A=B.menuItems;mstrmojo.DI.DIMappingMenuSAPHana=mstrmojo.declare(mstrmojo.DI.DIMappingMenu,null,{scriptClass:"mstrmojo.DI.DIMappingMenuSAPHana",queryVisible:function C(D){var E=true;if(this._super){E=this._super(D);}switch(D.did){case A.CREATE_MULTIFORM_ATTRIBUTE:case A.ADDTO_MULTIFORM_ATTRIBUTE:case A.EDIT_MULTIFORM_ATTRIBUTE:case A.CHANGE_DATA_TYPE:case A.DO_NOT_IMPORT:case A.TO_ATTRIBUTE:case A.DEFINE_RELATIONSHIPS:case A.TO_METRIC:case A.MARK_GEO_ROLES:case A.CREATE_TIME_ATTRIBUTES:case A.SHOW_ALL_COLUMNS:E=false;break;}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIConstants","mstrmojo.DI.DIMappingMenu","mstrmojo.DI.DIMappingMenuSearchOnSource","mstrmojo.DI.DIMappingMenuHadoop","mstrmojo.DI.DIMappingMenuSAPHana");var A=mstrmojo.DI.DIConstants;mstrmojo.DI.controller.DIMappingMenuController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIMappingMenuController",getMappingMenu:function B(E){var D=mstrApp.getRootController().getModel();var F=D.importSources[E],C;if(F!==undefined&&F.type===A.sourceType.querybuilder&&F.subtype===A.sourceSubtype.searchOnSource){C=new mstrmojo.DI.DIMappingMenuSearchOnSource();}else{if(F!==undefined&&F.type===A.sourceType.hadoop&&F.subtype===A.sourceSubtype.hadoop){C=new mstrmojo.DI.DIMappingMenuHadoop();}else{if(F!==undefined&&F.databaseType===4000&&F.xdaType===A.xdaType.qbSingleTable){C=new mstrmojo.DI.DIMappingMenuSAPHana();}else{C=new mstrmojo.DI.DIMappingMenu();}}}return C;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.List","mstrmojo.ui.LayoutBox","mstrmojo.ui.Splitter","mstrmojo.Refine.RefineFacetPanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineHistoryList");mstrmojo.Refine.RefinePanel=mstrmojo.declare(mstrmojo.ui.Splitter,null,{scriptClass:"mstrmojo.Refine.RefinePanel",alias:"refinePanel",cssClass:"refine-panal",markupString:'<div id="{@id}" class="mstrmojo-Splitter {@orientationCss} {@cssClass}"><div class="mstrmojo-SplitterPanel refine-transformation-panal"></div><div class="mstrmojo-SplitterHandle refine-panal-middle"></div><div class="mstrmojo-SplitterPanel"></div><div class="mstrmojo-clearingDiv"></div></div>',setDimensions:function B(G,E){var C=parseInt(G,10);var F=parseInt(E,10);if(isNaN(C)||isNaN(F)){return ;}if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}var D=Math.max(F,980);this.layoutConfig.w.firstSplitNode=D+"px";this.layoutConfig.w.resizeHandleNode=D+"px";this.layoutConfig.w.secondSplitNode=D+"px";if(this._super){this._super(C+"px",F+"px");}},postBuildRendering:function A(){this.setDimensions("0px","0px");this.setDimensions(this.parent.refinePanelNode.style.height,this.parent.refinePanelNode.style.width);if(this._super){this._super();}},handleSampleStatusChanged:function(){var C=this.bottomPanal.splitter.facetPanel;if(C&&C.hasRendered){C.resetAllFacets();}C.updateEngine(false);},config:{firstSplit:{v:"150px",min:"100px",max:undefined},secondSplit:{v:"100%",min:"100px",max:undefined},resizeHandle:{v:"2px"}},orientation:1,children:[{slot:"firstSplitNode",alias:"topPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-top",setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=C+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",(E-22)+"px");}}},{slot:"secondSplitNode",alias:"bottomPanal",scriptClass:"mstrmojo.ui.LayoutBox",cssClass:"refine-panal-bottom",children:[{alias:"splitter",scriptClass:"mstrmojo.ui.Splitter",orientation:1,draggable:false,config:{firstSplit:{v:"100%"},secondSplit:{v:"127px"},resizeHandle:{v:"11px"}},children:[{slot:"secondSplitNode",alias:"facetPanel",scriptClass:"mstrmojo.Refine.RefineFacetPanel"}]}],setDimensions:function B(F,D){var C=parseInt(F,10);var E=parseInt(D,10);var G=(!!mstrApp.isWorkstation)&&(C>0)?3:28;if(!this.layoutConfig){this.layoutConfig={h:{},w:{}};}this.layoutConfig.h.containerNode=(C-G)+"px";this.layoutConfig.w.containerNode=(E)+"px";if(mstrmojo.ui.LayoutBox.prototype.setDimensions){mstrmojo.ui.LayoutBox.prototype.setDimensions.call(this,C+"px",E+"px");}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefinePanel","mstrmojo.Refine.RefineDataPreview","mstrmojo.Refine.RefineSuggestionPreview","mstrmojo.Refine.RefineControlSplit","mstrmojo.Refine.RefineControlWhitespace","mstrmojo.Refine.RefineControlDelete","mstrmojo.Refine.RefineControlFacet","mstrmojo.Refine.RefineControlTransformCell","mstrmojo.Refine.RefineControlFindAndReplace","mstrmojo.Refine.RefineControlRemoveText","mstrmojo.Refine.RefineControlOther","mstrmojo.Refine.RefineSuggestions","mstrmojo.Refine.RefineControlExtract","mstrmojo.string","mstrmojo.array","mstrmojo.Refine.RefineTransformations","mstrmojo.Refine.RefineHelpers");mstrmojo.requiresDescs(12799);var K=mstrmojo.array,F=mstrmojo.Refine.RefineHelpers;function M(P){P=P.replace(/\n/g,"\\n");P=P.replace(/\t/g,"\\t");return P;}function L(P){return P.replace(/\$/g,"$$$$").replace(/[\\"']/g,"\\$&");}var A={};A.regex=function(){var Q={};var P=function(U){return[new RegExp(U),/\d+/];};var T=function(U){var V=[new RegExp(U),/[a-zA-Z]+/];if(U.toLowerCase()===U){V.push(/[a-z]+/);}else{if(U.toUpperCase()===U){V.push(/[A-Z]+/);}}return V;};var R=function(U){return[new RegExp(mstrmojo.string.regEscape(U))];};Q.candidates=function(W){if(W.length){var b=Q.parse(W[0].text,W[0].start,W[0].end),V=W.slice(0),Z,c,Y,X;Z=(b.on||[]).map(function(d){return{on:d};});var a=b.before,U=b.after;if(a===undefined||a.length===0){c=U.map(function(d){return{after:d,on:/.*/};});}else{if(U===undefined||U.length===0){c=a.map(function(d){return{before:d,on:/.*/};});}else{c=U.map(function(d){return{after:d,on:/.*/};}).concat(a.map(function(d){return{before:d,on:/.*/};}));}}X=Z.concat(c);if(V.length===0){return X;}X=X.filter(function(d){return V.filter(function(f){Y=A.regex.match(f.text,d);if(V.length===1){if((d.before===undefined)&&(d.after===undefined)){var e;if(d.on.source.length===1){e=d.on.source.charCodeAt(0);if(!(e>64&&e<91)&&!(e>96&&e<123)&&!(e>47&&e<58)){return false;}}if(d.on.source[0]==="\\"&&d.on.source.length===2){e=d.on.source.charCodeAt(1);if(!(e>64&&e<91)&&!(e>96&&e<123)&&!(e>47&&e<58)){return false;}}}}return(Y.length<2||((d.before===undefined)&&Y[1].start!==f.start)||((d.after===undefined)&&Y[1].end!==f.end));}).length===0;});return X;}return[];};var S=function(U){var V=U.map(function(W){return W.toString().replace(/^\/|\/$/g,"");}).join("");return new RegExp(V);};Q.parse=function(k,a,Z,e){k=String(k);var c=/([a-zA-Z]+)|([0-9]+)|([^a-zA-Z0-9])/g;var d=(k.substring(0,a).match(c)||[]).concat(k.substring(a,Z).match(c)||[]).concat(k.substring(Z).match(c)||[]);var j=e||{},U,l,Y,W,b=0,f,g,X,m=j.matchAfter||2,V=j.matchBefore||2;if(!Array.prototype.filter){Array.prototype.filter=function(s){var p=0,n=this&&this.length||0,o=[],q;for(;p<n;++p){q=this[p];if(s(q,p,this)){o.push(q);}}return o;};}if(!Array.prototype.map){Array.prototype.map=function(q){var p=0,n=this&&this.length||0,o=new Array(n);for(;p<n;++p){o[p]=q(this[p],p,this);}return o;};}if(!Array.prototype.reduce){Array.prototype.reduce=function(u,o){if(this===null){throw new TypeError("Array.prototype.reduce called on null or undefined");}if(typeof u!=="function"){throw new TypeError(u+" is not a function");}var q=Object(this),n=q.length>>>0,p=0,s;if(arguments.length===2){s=o;}else{while(p<n&&!(p in q)){p++;}if(p>=n){throw new TypeError("Reduce of empty array with no initial value");}s=q[p++];}for(;p<n;p++){if(p in q){s=u(s,q[p],p,q);}}return s;};}if(!Array.prototype.forEach){Array.prototype.forEach=function(p){var o=0,n=this&&this.length||0;for(;o<n;++o){p(this[o],o,this);}};}d=d.filter(function(n){return n!==null;});l=d.map(function(n,o){U=n.charCodeAt(0);if(a>=b&&a<b+n.length){Y=o;}if(Z>b&&Z<=b+n.length){W=o;}b+=n.length;if((U>64&&U<91)||(U>96&&U<123)){return T(n);}if(U>47&&U<58){return P(n);}return R(n);});if(Y===undefined){Y=d.length-1;}if(W===undefined){W=d.length-1;}if(W-Y>10){f=[[]];l.slice(Y,W+1).forEach(function(n){f[0].push(n[0]);});}else{f=l.slice(Y,W+1).reduce(function(o,n){var p=[];o.forEach(function(q){n.forEach(function(s){p.push(q.concat(s));});});return p;},[[]]);}var h=function(o,n){var p=[];if(o.length){o.forEach(function(q){n.forEach(function(s){p.push(q.concat(s));});});return o.concat(p);}return n.map(function(q){return[q];});};X=l.slice(Math.max(Y-m,0),Y).reverse().reduce(h,[]);g=l.slice(W+1,Math.min(W+V+1,l.length)).reduce(h,[]);return{on:f.map(S),after:(X||[]).map(function(n){return S(n.reverse());}),before:(g||[]).map(function(n){return S(n);})};};return Q;};A.regex.record=function(T,U,P,Q,S,R){return{text:T,start:U,end:P,col:Q,row:S,table:R};};A.regex.friendly_description=function(P){var Q=P.toString().replace(/^\/|\/$/g,"");Q=Q.replace(/\n/g,"newline");Q=Q.replace(/ /g," ");Q=Q.replace(/\t/g,"tab");Q=Q.replace(/\(?(\[0\-9\]|\\d)\+\)?/g,"any number");Q=Q.replace(/\(?(\[a\-z\A\-Z\]|\[A\-Z\a\-\z\])\+\)?/g,"any word");Q=Q.replace(/\(?(\[a\-z\])\+\)?/g,"any lowercase word");Q=Q.replace(/\(?(\[A\-Z\])\+\)?/g,"any uppercase word");Q=Q.replace("\\","");if(Q==="newline"){return Q;}return Q;};A.regex.match=function(X,Q){if(!X){return"";}var U=Q.max_splits;if(U===undefined){U=1;}var P={start:0,end:X.length,value:X};var W=[];var V=0;var R=Number(Q.which);var Y;if(isNaN(R)){R=1;}while(U<=0||V<U*R){var a=A.regex.matchOnce(P.value,Q);if(a.length>1){P=a[2];W.push(a[0]);W.push(a[1]);Y=0;}else{break;}V++;if(V>1000){break;}}W.push(P);Y=0;var Z=[];var T="";var S;for(S=0;S<W.length;++S){if(S%2===1){Y++;if(Y===R){Z.push({value:T,start:0,end:T.length});Z.push({start:T.length,end:T.length+W[S].value.length,value:W[S].value});Y=0;T="";continue;}}T+=W[S].value;}Z.push({start:0,end:T.length,value:T});return Z;};A.regex.matchOnce=function(b,T){var U=T.positions;var a=[];var Q,e;if(U&&U.length){if(U.length===2){if(b.length>=U[1]){Q=U[0];e=U[1];a.push({start:0,end:Q,value:b.substr(0,Q)});a.push({start:Q,end:e,value:b.substr(Q,e-Q)});a.push({start:e,end:b.length,value:b.substr(e)});return a;}return[{start:0,end:b.length,value:b}];}}var Z=T.before;var P=T.after;var X=T.on;var S=T.ignore_between;var d=b;var c=0;var W=0;var V;while(d.length){var Y=d;var R=0;W=c;if(S){V=d.match(S);if(V){Y=Y.substr(0,V.index);c+=V.index+V[0].length;d=d.substr(V.index+V[0].length);}else{d="";}}else{d="";}if(P){V=Y.match(P);if(V){R=V.index+V[0].length;Y=Y.substr(R);}else{continue;}}if(Z){V=Y.match(Z);if(V){Y=Y.substr(0,V.index);}else{continue;}}V=Y.match(X);if(V){Q=W+R+V.index;e=Q+V[0].length;a.push({start:0,end:Q,value:b.substr(0,Q)});a.push({start:Q,end:e,value:b.substr(Q,e-Q)});a.push({start:e,end:b.length,value:b.substr(e)});return a;}}return[{start:0,end:b.length,value:b}];};function I(){var P=this.model;var S={success:function(U){if((P.start>=U.total)&&(U.total>0)){var T=Math.ceil((parseInt(U.total,10)/parseInt(P.limit,10)))-1;T=T<0?0:T;P.set("start",T*P.limit);}else{P.populateData(U);}},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var Q={},R={};Q={project:P.projectID,start:P.start,limit:P.limit};R={engine:this.model.engine};this.dataService.getPreviewData(S,Q,R);}function O(P){var Q=this.model;var S={success:function(T){Q.populateColumns(T.columnModel);P&&P();},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var R;R={project:Q.projectID};this.dataService.getColumns(S,R);}function D(){var P=this.model;var R={success:function(S){P.populateHistory(S);},failure:function(S){var T=mstrApp.getRootController();T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,S.message||"");}};var Q={project:P.projectID};this.dataService.getHistory(R,Q);}function C(){var P=this.model;var Q=this;var S={success:function(V){P.populateOperations(V);Q.raiseEvent({name:"RefineStarted"});var W=Q.tableID;var U=mstrApp.getRootController();var T=U.model;var X=T.importSources[W];if(!X.inRefine){X.inRefine=true;X.RefineOperations=V.entries;}},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var R={project:P.projectID};this.dataService.getOperations(S,R);}function B(S,T){var P=this;var R=this.model;var V={success:function(W){if(!W.processes.length){if(typeof T==="function"){T();}else{P.loadData();}}else{B.call(P,W.processes[0].progress/100);}},failure:function(W){var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");}};var U={project:R.projectID};var Q={progress:0};if(S){Q.progress=S;}this.dataService.getProcesses(V,U,Q);}mstrmojo.Refine.RefineController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.Refine.RefineController",refinePanel:null,parsePanel:null,records:[],start:function(P){if(!this.dataService){this.dataService=new mstrmojo.Refine.DataService({model:this.model,projectID:this.model.rpid,refineServerURL:P});}this.loadData();this.loadSampleStatus();this.model.attachEventListener("startChange",this.id,this.handleStartChanged);this.model.attachEventListener("columnUnSelected",this.id,this.handleColumnUnSelected);},applyOperations:function J(U,P){var T=this;var S=this.model;var W={success:function(Y){if(Y.code==="ok"){T.loadData();}else{if(Y.code==="pending"){B.call(T);}else{if(Y.code==="error"){T.loadData();var Z=mstrApp.getRootController();Z.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Y.message||"");}}}},failure:function(Y){var Z=mstrApp.getRootController();Z.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,Y.message||"");}};var Q={project:S.projectID};var V=false,X=true;if(U.hasOwnProperty("lastDoneID")){for(var R=0;R<S.history.future.length;R++){if(S.history.future[R].op){V=true;}if(U.lastDoneID.toString()===S.history.future[R].id.toString()){X=false;break;}}}if(P){if(S.hasAddSample()&&V&&!X){F.confirmFilldownOrBlankdown(function(){T.dataService.undoRedo(W,Q,U);});}else{this.dataService.undoRedo(W,Q,U);}}else{this.dataService.applyOperations(W,Q,U);}},MergeCluster:function H(U,T){var P=this;var Q=this.model;var S={success:function(V){if(V.code==="ok"){P.loadData();T();}else{if(V.code==="pending"){B.call(P);}}},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};var R={project:Q.projectID};this.dataService.massEdit(S,R,U);},handleNonExistColNameError:function(T,R){var Q,S=this.refinePanel.bottomPanal.splitter.facetPanel.facets,P;switch(R){case 1:Q=T.split(":")[1];break;case 2:Q=T.split("No column named ")[1];break;default:return ;}if(Q===undefined){return ;}for(P=0;P<S.length;P++){if(S[P].config.name===Q){S[P].remove();P=-1;}}this.computeFacets(true);},computeFacets:function(P){var R=this;var Q=this.model;var U={success:function(W){if(W.code==="error"){var V=W.message.indexOf("non exist column name in facet")>=0?1:(W.message.indexOf("No column named To ")?2:0);if(V&&!P){R.handleNonExistColNameError(W.message,V);return ;}var X=mstrApp.getRootController();X.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,W.message||"");return ;}R.refinePanel.bottomPanal.splitter.facetPanel.handleFacetsFetched(W);R.refinePanel.topPanal.RefineTransformations.transformationList.setItems();I.call(R);},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};var T={engine:this.refinePanel?JSON.stringify(this.refinePanel.bottomPanal.splitter.facetPanel.getJSON(true)):this.model.engine};var S={project:Q.projectID};this.dataService.computeFacets(U,S,T);},computeClusters:function(S){var P=this.model;var R={success:function(T){P.raiseEvent({name:"clustersFetched",clusters:T});P.raiseEvent({name:"columnUnSelected"});},failure:function(T){var U=mstrApp.getRootController();U.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,T.message||"");}};var Q={project:P.projectID};this.dataService.computeClusters(R,Q,S);},loadData:function(){var P=this.computeFacets.bind(this);O.call(this,P);D.call(this);C.call(this);},rollBackOperations:function(U){var P=this;var Q=this.model;var S={project:Q.projectID};var R={success:function(){},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};var T={success:function(){P.dataService.applyOperations(R,S,U);},failure:function(V){var W=mstrApp.getRootController();W.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}};Q.start=0;Q.limit=50;this.dataService.undoRedo(T,S,{lastDoneID:0});},addFacets:function(Q,P){this.refinePanel.bottomPanal.splitter.facetPanel.addFacets(Q,P);},getRefinePanel:function G(){this.refinePanel=new mstrmojo.Refine.RefinePanel({controller:this});this.model.attachEventListener("sampleStatusChange",this.refinePanel.id,this.refinePanel.handleSampleStatusChanged);var Y=new mstrmojo.Refine.RefineDataPreview({controller:this});if(this.model.data.rows){Y.populate(this.model.data);}this.model.attachEventListener("dataChange",Y.id,Y.handleDataChanged);this.model.attachEventListener("columnsChange",Y.id,Y.handleColumnsChanged);this.model.attachEventListener("unHighlightSuggestion",Y.id,Y.handleUnHighlightSuggestion);this.model.attachEventListener("startChange",Y.id,Y.handleStartChange);this.model.attachEventListener("columnSelected",Y.id,Y.handleColumnSelected);this.model.attachEventListener("columnUnSelected",Y.id,Y.handleColumnUnSelected);Y.slot="firstSplitNode";Y.alias="refinePreview";this.refinePanel.bottomPanal.splitter.addChildren(Y);var c=new mstrmojo.Refine.RefineSuggestionPreview({controller:this});this.model.attachEventListener("previewSuggestion",c.id,c.handlePreviewSuggestion);this.model.attachEventListener("unPreviewSuggestion",c.id,c.handleUnPreviewSuggestion);this.model.attachEventListener("previewScrollTop",c.id,c.handlePreviewScrollTop);c.slot="firstSplitNode";this.refinePanel.bottomPanal.splitter.addChildren(c);var T=new mstrmojo.Refine.RefineTransformations({controller:this});this.model.attachEventListener("columnsChange",T.id,T.handleColumnsChanged);this.model.attachEventListener("columnSelected",T.id,T.handleColumnSelected);this.model.attachEventListener("columnUnSelected",T.id,T.handleColumnUnSelected);this.refinePanel.topPanal.addChildren([T]);var V=new mstrmojo.Refine.RefineHistoryList({controller:this});V.populate(this.model.history);this.model.attachEventListener("historyChange",V.id,V.handleListChanged);this.refinePanel.topPanal.addChildren([V]);var X=new mstrmojo.Refine.RefineControlSplit({controller:this,operations:this.model.transformations.split,parentBox:T});X.slot="controlNode";T.addChildren([X]);var W=new mstrmojo.Refine.RefineControlWhitespace({controller:this,operations:this.model.transformations.Whitespace,parentBox:T});W.slot="controlNode";T.addChildren([W]);var Q=new mstrmojo.Refine.RefineControlTransformCell({controller:this,operations:this.model.transformations.TransformCell,parentBox:T});Q.slot="controlNode";T.addChildren([Q]);var P=new mstrmojo.Refine.RefineControlDelete({controller:this,operations:this.model.transformations.Delete,parentBox:T});P.slot="controlNode";T.addChildren([P]);var Z=new mstrmojo.Refine.RefineControlExtract({controller:this,operations:this.model.transformations.Extract,parentBox:T});Z.slot="controlNode";T.addChildren([Z]);var R=new mstrmojo.Refine.RefineControlFacet({controller:this,operations:this.model.transformations.Facet,parentBox:T});R.slot="controlNode";T.addChildren([R]);var S=new mstrmojo.Refine.RefineControlFindAndReplace({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:T});S.slot="controlNode";T.addChildren([S]);var b=new mstrmojo.Refine.RefineControlRemoveText({controller:this,operations:this.model.transformations.FindAndReplace,parentBox:T});b.slot="controlNode";T.addChildren([b]);var a=new mstrmojo.Refine.RefineControlOther({controller:this,operations:this.model.transformations.Other,parentBox:T});a.slot="controlNode";this.model.attachEventListener("columnsChange",a.id,a.handleColumnsChanged);this.model.attachEventListener("columnUnSelected",a.id,a.handleColumnUnSelected);T.addChildren([a]);var U=new mstrmojo.Refine.RefineSuggestions({controller:this});U.slot="suggestionsNode";T.addChildren([U]);this.model.attachEventListener("dataChange",U.id,U.handleDataChanged);this.model.attachEventListener("columnsChange",U.id,U.handleColumnsChanged);this.model.attachEventListener("gotSuggestions",U.id,U.handleGotSuggestions);this.model.attachEventListener("emptySuggestions",U.id,U.handleEmptySuggestions);return this.refinePanel;},generateSuggestions:function N(Y,T,d,g,m,X,R,P){var n=1,k,c,h,e=[];var W,o,Q;while(true){o=T+" "+n;Q=true;for(k=0;k<R.length;k++){if(o===R[k].name){Q=false;break;}}n++;if(Q){W=o;break;}}if(m===0){c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldLengths.push(X);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=-1;h.endOffset=X;h.index=Y;e.push(h);}else{if(g===X){c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldForward=false;c.fieldLengths.push(X-m);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=X-m;h.endOffset=-1;h.index=Y;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.split.byFieldLengths));c.description=c.description.replace("[column name]",T);c.columnName=T;c.fieldLengths.push(m);c.fieldLengths.push(X-m);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[0]));h.operations=JSON.stringify([c]);h.startOffset=m;h.endOffset=X;h.index=Y;e.push(h);}}var S={text:d,start:m,end:X,col:Y,cell:P};if(this.records.length===0||S.col===this.records[0].col){if(this.records.length>0){for(k=0;k<this.records.length;k++){if(this.records[k].cell===P){this.records.splice(k,1);}}}this.records.push(S);}else{if(this.records.length!==0){this.resetRecords();}this.records=[S];}P.highlightSelectedText(m,X);var Z,U=A.regex().candidates(this.records);while(this.records.length>0&&U.length===0){this.records[0].cell.resetText();this.records=this.records.slice(1);U=A.regex().candidates(this.records);}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.split.beforeFirst));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.before.toString()));c.columnName=T;c.separator=Z.before.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.split.afterFirst));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.after.toString()));c.columnName=T;c.separator=Z.after.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.split.bySeparator));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.on.toString()));c.columnName=T;c.separator=Z.on.source;c.regex=true;c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.split[3]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.Extract.beforeFirst));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.before.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.before);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[0]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.Extract.afterFirst));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.after.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.after);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.Extract.on));c.description=c.description.replace("[new column name]",W);c.description=c.description.replace("[column name]",T);c.description=c.description.replace("[index]",Y+1);c.description=c.description.replace("####",M(Z.on.toString()));c.columnInsertIndex=Y+1;c.newColumnName=c.newColumnName.replace("[column name]",W);c.baseColumnName=c.baseColumnName.replace("[column name]",T);c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.on);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.extract[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}for(k=0;k<U.length;k++){Z=U[k];if(Z.before!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutBefore));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.before.toString()));c.columnName=T;c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.before);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[0]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.before),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.before;e.push(h);}else{if(Z.after!==undefined){c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutAfter));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.after.toString()));c.columnName=T;c.expression=c.expression.replace(new RegExp("\\[separator\\]","gm"),Z.after);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[1]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.after),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.after;e.push(h);}else{c=JSON.parse(JSON.stringify(this.model.transformations.FindAndReplace.CutOn));c.description=c.description.replace("[column name]",T);c.description=c.description.replace("####",M(Z.on.toString()));c.columnName=T;c.expression=c.expression.replace("[separator]",Z.on);c.engineConfig=JSON.parse(this.model.engine);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.cut[2]));h.description=h.description.replace("####",'"'+mstrmojo.string.encodeHtmlString(A.regex.friendly_description(Z.on),false,true)+'"');h.operations=JSON.stringify([c]);h.index=Y;h.separator=Z.on;e.push(h);}}}c=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsContains));c.engineConfig.facets[0].query=d.substring(m,X);c.description=c.description.replace("####","'"+M(L(d.substring(m,X)))+"'");c.description=c.description.replace("[column name]",T);c.engineConfig.facets[0].name=c.engineConfig.facets[0].columnName=T;c.engineConfig.facets[0].mode="text";c.engineConfig.facets=c.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);h=JSON.parse(JSON.stringify(this.model.suggestions.partialCell.deleteRows[0]));h.description=h.description.replace("####","'"+mstrmojo.string.encodeHtmlString(M(L(d.substring(m,X))),false,true)+"'");h.operations=JSON.stringify([c]);e.push(h);var p=(window.innerWidth||document.documentElement.clientWidth);var f=P.domNode.getBoundingClientRect();var a=f.left;var b=p-f.right;var V=P.preview.domNode.getBoundingClientRect();var l={tableTop:V.top,cellLeft:f.left,cellRight:f.right,distanceToLeft:a,distanceToRight:b};this.model.raiseEvent({name:"gotSuggestions",src:this,list:e,cellPos:l});},generateColumnSuggestions:function E(P,Y,Z,U){var T,V,X=[];var R=this.refinePanel.bottomPanal.splitter.refinePreview;var W=R.data;var S=R.columns;var b=S[P].name;var c=W.rows[0]?W.rows[0].cells[S[P].cellIndex]:null,a="text";if(c){if(c.t){a="date";}else{if(typeof c.v==="string"||c.v instanceof String){a="text";}else{a="number";}}}if(Y){T=JSON.parse(JSON.stringify(this.model.transformations.Other.TransposeColumnsIntoRows));T.description=T.description.replace("####",U);T.description=T.description.replace("@@@@",Y);T.description=T.description.replace("@@@@","Transpose:key");T.description=T.description.replace("@@@@","Transpose:value");T.startColumnName=Y;T.keyColumnName="Transpose:key";T.valueColumnName="Transpose:value";T.columnCount=U;V=JSON.parse(JSON.stringify(this.model.suggestions.column[8]));V.description=V.description.replace("####",Y);V.description=V.description.replace("@@@@",Z);V.operations=JSON.stringify([T]);X.push(V);}T=JSON.parse(JSON.stringify(this.model.transformations.Delete.Colomn));T.description=T.description.replace("[column name]",b);T.columnName=b;V=JSON.parse(JSON.stringify(this.model.suggestions.column[0]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.fillDown));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[1]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.blankDown));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[2]));V.operations=JSON.stringify([T]);X.push(V);if(a==="text"){T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.titlecase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[3]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.uppercase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[4]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.TransformCell.lowercase));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[5]));V.operations=JSON.stringify([T]);X.push(V);T=JSON.parse(JSON.stringify(this.model.transformations.Whitespace.collapse));T.description=T.description.replace("[column name]",b);T.columnName=b;T.engineConfig=JSON.parse(this.model.engine);V=JSON.parse(JSON.stringify(this.model.suggestions.column[7]));V.operations=JSON.stringify([T]);X.push(V);}var Q=b;if(b.length>50){Q=b.substring(0,50)+"...";}T=JSON.parse(JSON.stringify(this.model.transformations.Delete.RowsBlank));T.description=T.description.replace("[column name]",b);T.engineConfig.facets[0].name=T.engineConfig.facets[0].columnName=b;T.engineConfig.facets=T.engineConfig.facets.concat(JSON.parse(this.model.engine).facets);V=JSON.parse(JSON.stringify(this.model.suggestions.column[6]));V.description=V.description.replace("[column name]",Q);V.operations=JSON.stringify([T]);X.push(V);this.model.raiseEvent({name:"gotSuggestions",src:this,list:X});},handleStartChanged:function(){I.call(this);},handleColumnUnSelected:function(){this.resetRecords();},resetRecords:function(){for(var P=0;P<this.records.length;P++){this.records[P].cell.resetText();}this.records=[];},setSampleData:function(Q,V){var S=this,T=mstrApp.getRootController(),P=S.model,U={project:P.projectID},W=V?{row_num:Q,first:true}:{row_num:Q};function R(X){T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,X.message||"");}S.dataService.setSampleData({success:function(X){if(X.code==="error"){S.loadData();R(X);return ;}P.populateSampleStatus(X);S.loadData();},failure:R},U,W);},refreshSampleData:function(Q){var S=this,T=mstrApp.getRootController(),P=S.model,U={project:P.projectID};function R(V){T.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,V.message||"");}S.dataService.refreshSampleData({success:function(V){if(V.code==="error"){S.loadData();R(V);return ;}P.populateSampleStatus(V);S.loadData();},failure:R},U,{row_num:Q});},loadSampleStatus:function(){var R=this,S=mstrApp.getRootController(),P=R.model,T={project:P.projectID};function Q(U){S.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,U.message||"");}R.dataService.getSampleStatus({success:function(U){if(U.code==="error"){Q(U);return ;}if(U.hasSample){P.hasUploadData=true;P.populateSampleStatus(U);}else{P.hasUploadData=false;}},failure:Q},T);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.qb.DataService","mstrmojo.DI.DIProjectDBRoleEditor","mstrmojo.DI.DIRemoteProjectDBRole");mstrmojo.requiresDescs(12815,13098);var E=mstrmojo.array;mstrmojo.DI.controller.DIRemoteProjectsController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIRemoteProjectsController",dbRoleID:"",hadoopConnURL:"",dbRole:"",saveDBRole:function J(P,O){var N=mstrApp.getRootController(),Q=this;O.set("visible",false);O.close();N.getDataService().saveDBRole({success:function R(S){Q.dbRoleID=S.dbr.did;N.model.raiseEvent({name:"projectDBRoleSaved",data:{dbrid:S.dbr.did,dbrn:S.dbr.n}});},fail:function M(S){mstrmojo.alert(S.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(P)});},deleteDBRole:function L(Q){var N=mstrApp.getRootController(),O=this;N.getDataService().deleteDBRole({success:function P(R){O.dbRoleID=undefined;O.dbRole=undefined;N.model.raiseEvent({name:"deleteDBRole"});},fail:function M(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{objectid:Q});},loadRemoteProjectsDBRole:function H(){var M=mstrApp.getRootController(),O=this,N=[];var P={success:function(Q){var R=Q.dbrs;if(R){E.forEach(R,function(S){if(S.dbr_type==="5"){N.push({dbrid:S.did,dbrn:S.n});}});}if(N){M.model.raiseEvent({name:"projectsDBRoleLoaded",data:N});}},failure:function(){O.displayError(mstrmojo.desc(12815,"Error when loading DB Roles."));}};M.getDataService().loadDBRoles(P,{});},loadDBRoleByID:function G(Q,O){var P=this,N=new mstrmojo.DI.DIRemoteProjectDBRole(),M=mstrApp.getRootController();N.mdDBRole.did=Q;N.populate(function(S){var R=S.mdDBRole.connstr;E.forEach(R.split(";"),function(U){var T=U.split("=");S[T[0].trim().toLowerCase()]=T[1];});P.dbRoleID=Q;P.dbRole=N;if(O){M.model.raiseEvent({name:"DuplicateDBRole"});}else{M.model.raiseEvent({name:"DBRoleLoadedById"});}});},populateDBRole:function D(N,O){var M=mstrApp.getRootController();M.model.populateDBRole(N,O);},renderDBRoleEditor:function I(N){var M=mstrmojo.all.projectDBRoleEditor;if(M){M.set("dbrole",N);M.open();}else{mstrmojo.insert(new mstrmojo.DI.DIProjectDBRoleEditor({zIndex:9999}));M=mstrmojo.all.projectDBRoleEditor;M.set("dbrole",N);M.render();}},editDBRole:function F(M){this.loadDBRoleByID(M);},getProjectSourceFolderId:function K(N){var M=mstrApp.getRootController();var O={dbrid:N};var P={success:function(Q){mstrApp.getRootController().model.raiseEvent({name:"getFolderId",data:Q});},failure:function(){mstrApp.getRootController().model.raiseEvent({name:"getFolderIdFailure"});mstrmojo.alert(mstrmojo.desc(13098,"Invalid Username, Password. Please check your login credentials to browse the Project"));}};M.dataService.fetchRemoteFolderID(P,O);},getProjectsFromRemote:function A(Q,O){var M=mstrApp.getRootController();var N={serverName:Q,serverPort:O};var P={success:function(R){mstrApp.getRootController().model.raiseEvent({name:"projectsLoaded",data:R});},failure:function(){}};M.dataService.getProjectsFromRemote(P,N);},duplicateDBRole:function B(M){this.loadDBRoleByID(M,true);},duplicate:function C(){var M=this.dbRole,O=new mstrmojo.DI.DIRemoteProjectDBRole({mdDBRole:M.mdDBRole}),N="Duplicate "+M.n;O.hostname=M.hostname;O.Port=M.Port;O.ProjectID=M.ProjectID;O.did="";O.mdDBRole.did="";O.mdDBRole.n=N;O.n=N;O.des=N;O.mdDBRole.ln=M.mdDBRole.ln;O.mdDBRole.connstr="";delete O.mdDBRole.password;this.renderDBRoleEditor(O);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Refine.RefineModel","mstrmojo.Refine.RefineController");var C=mstrmojo.DI.DIConstants;mstrmojo.Refine.Refine=mstrmojo.declare(mstrmojo.Obj,null,{start:function D(F,E,G){this.isBDE=false;var H=mstrApp.getRootController().model.importSources[G];if(H.type===C.sourceType.hadoop&&H.subtype===C.sourceSubtype.hadoop){this.isBDE=true;}if(!this.rootController){this.rootController=new mstrmojo.Refine.RefineController({model:new mstrmojo.Refine.RefineModel({projectID:E}),tableID:G});}else{this.rootController.model.projectID=E;this.rootController.model.columns={};this.rootController.model.data={};this.rootController.model.history={};this.rootController.model.operations={entries:[]};this.rootController.model.start=0;this.rootController.tableID=G;this.rootController.model.sampleStatus=null;}this.rootController.start(F);},getRefinePanel:function A(){return this.rootController.getRefinePanel();},stop:function B(){}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery._BigQueryController","mstrmojo.qb.es.Controller");mstrmojo.qb.bigquery.ESController=mstrmojo.declare(mstrmojo.qb.es.Controller,[mstrmojo.qb.bigquery._BigQueryController],{scriptClass:"mstrmojo.qb.bigquery.ESController"});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.es.Controller");mstrmojo.AS.ASQbEsController=mstrmojo.declare(mstrmojo.qb.es.Controller,null,{onFinishButtonClick:function A(){var C={};var E=mstrApp.rootController.model,D=E.dbrs,F=E.tables,B=D.find(function(G){return G.did===E.SelDBRoleID;});F.forEach(function(I){var H=I.dbr;I.name=I.n;if(!C[H]){var G=D.find(function(J){return J.did===H;});C[H]={id:H,type:G.mdDBRole.db_type,name:G.n,tables:[]};}C[H].tables.push(I);});window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(C);mstrApp.getRootController().exitApplication();}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery.ESController");var A=mstrmojo.DI.DIConstants;mstrmojo.AS.ASGBQController=mstrmojo.declare(mstrmojo.qb.bigquery.ESController,null,{onFinishButtonClick:function B(){var C={},D={};model=mstrApp.rootController.model,dbrId=model.dbrid,tables=model.tables,sourceAccountID=model.said;D.tables=new Array();tables.forEach(function(E){D.tables.push({id:E.dbr,ns:E.ns,account_id:sourceAccountID,n:E.n,dbtn:E.n,name:E.n});});D.name="Google Bigquery";D.id=dbrId;D.type=A.dbType.GOOGLE_BIGQUERY;C[dbrId]=D;window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(C);mstrApp.getRootController().exitApplication();}});}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIModel","mstrmojo.DI.DIRepublishScheduleEditor","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(12394,12836,12837,14767);var Y=mstrmojo.array,V=mstrmojo.hash,A=mstrmojo.DI.DIHelpers,a=mstrmojo.DI.DIConstants,J="CDE80A9048DB5E6E1B1A378503859835";var T=0,X=1;var F={success:function K(b){mstrApp.getRootController().dataService.set("emmaIRRMessageID",b.msgid);}};function Q(c){var b=[];if(!c){return b;}if(c.fn===mstrmojo.expr.FN.AND||c.fn===mstrmojo.expr.FN.OR||c.fn===mstrmojo.expr.FN.NOT){if(Object.prototype.toString.call(c.nds)==="[object Array]"){Y.forEach(c.nds,function(d){b=b.concat(Q(d));});}}else{if(c.a){b.push(c.a.did);if(c.a2){b.push(c.a2.did);}}}return b;}function I(f,d){var b,g,e,c=0;f=f&&f.nd;if(f===undefined){return null;}if(f.op&&(f.op.fnt===mstrmojo.expr.FN.AND||f.op.fnt===mstrmojo.expr.FN.OR)){if(Object.prototype.toString.call(f.nds)==="[object Array]"){b={fn:f.op.fnt,et:f.et,nds:[]};Y.forEach(f.nds,function(h){b.nds.push(I(h,d));});}else{if(!f.nd){return null;}b=I(f.nd,d);}}else{if(f.op.fnt===mstrmojo.expr.FN.NOT){f=f.nds[0].nd;f.not=true;}b={fn:f.op.fnt,et:f.et,not:f.not||false};Y.forEach(f.nds,function(h){c=h.cst&&h.cst.ddt;});Y.forEach(f.nds,function(h){if(h.fmshct){g=b.a?"a2":"a";e=b.fm?"fm2":"fm";b[g]={did:h.fmshct.atid,n:d[h.fmshct.atid],t:12};b[e]={did:h.fmshct.fmid,n:d[h.fmshct.fmid],t:21,dtp:c||h.ddt};}else{if(h.cst){b.cs=b.cs||[];b.cs.push({v:h.cst.v,dtp:h.cst.ddt});}}});}return b;}mstrmojo.DI.controller.DIScheduleController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIScheduleController",getCubeSubscription:function(d){var c=mstrApp.getRootController();var b={success:function(e){c.getModel().populateSubscriptions(e);},failure:function(e){c.displayError(e.message||e.getResponseHeader("X-MSTR-TaskFailureMsg"));}};c.dataService.getObjectSubscriptions(mstrmojo.func.wrapMethods(b,d),{detailFlag:5});},getAvailableTriggers:function(d){var c=mstrApp.getRootController();var b={success:function(f){var e=c.model;e.getSchedule().populateTriggers(f);},failure:function(e){c.displayError(e.message||e.getResponseHeader("X-MSTR-TaskFailureMsg"));}};c.dataService.getAvailableTriggers(mstrmojo.func.wrapMethods(b,d),{});},getSubscriptionDefinition:function(b,d){var c=mstrApp.getRootController();c.dataService.getSubscriptionInfo(d,{subscriptionID:b});},launchScheduleEditor:function(){var h=this,d=mstrApp.getRootController(),e=mstrApp.getRootController().getModel(),f=e.getSchedule(),g=null,c;e.rawFilter=undefined;e.updateFilterUsedInTable=function k(){var n=Q(e.filter),m=n.length>0,l=e.isFilterInTable={};V.forEach(e.IRRTableAttrs,function(o,p){l[p]=true;Y.forEach(n,function(q){if(Y.indexOf(o,q)<0){l[p]=false;return false;}});l[p]=l[p]&&m;});};function b(){g=d.showDialog(a.dialogType.publishStatusDialog,{zIndex:999,model:e});}function j(){mstrmojo.hash.forEach(e.importSources,function(m){if(m.xdaType===a.xdaType.qbSingleTable){c=true;}});if(c){h.getEmmaIRRAttributes({success:function l(q){var n=[],t,u={},p={},m={},s;Y.forEach(q.ts,function o(w){Y.forEach(w.amps,function v(y){s=y.atid;t=w.tbid;u[t]=u[t]||[];u[t].push(s);if(Y.find(n,"did",s)===-1){n.push({n:y.atnm,did:s,t:12});}p[s]=y.atnm;Y.forEach(y.afmps,function x(z){p[z.fmid]=z.fmn;m[s]=m[s]||[];if(Y.find(m[s],"did",z.fmid)<0){m[s].push({did:z.fmid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(z.bft),n:z.fmn,t:21});}});});});e.filter=I(e.rawFilter,p);e.IRRAttributes=n;e.IRRTableAttrs=u;e.IRRAttrForms=m;e.updateFilterUsedInTable();b();}});}else{e.IRRAttributes=[];b();}}this.getAvailableTriggers({success:function(){if(f.subsID){h.getSubscriptionDefinition(f.subsID,{success:function(n){var o,p,l;f.set("trgID",n.trgID);f.set("trgName",n.trgName);l=Y.find(f.availableTriggers,"id",n.trgID);if(l<0){f.availableTriggers.push({n:n.trgName,id:n.trgID});f.set("curTrg",{n:n.trgName,id:n.trgID});}else{f.set("curTrg",f.availableTriggers[l]);}f.set("subsName",n.subsName);p=n.delta;if(p){mstrApp.getRootController().dataService.set("emmaIRRMessageID",null);h.createEmmaIRRReportInstance(e.IRRid,p,{success:function q(v){var t=v.def,AD,w,u=a.xdaType,AA,z,x=[],AC;Y.forEach(t.datap,function y(AE){o=e.getImportSource(AE.tbid);if(!o){x.push(AE.tbid);return true;}o.checked=true;if(AE.crt!==undefined){o.refreshType=parseInt(AE.crt,10);}w=null;AD=AE.srce;if(AD){switch(AD.xt){case u.qbSingleTable:w={tableName:AD.tbn};break;case u.excel:case u.text:AA=AD.file_description;if(AA&&AA.url){z=A.getURLFileName(AA.url);}else{z=AD.tbal;}w={tableName:z};break;}}o.alternateSource=w;});AC={success:function AB(){var AE=window.localStorage,AG,AF=true;if(AE){AG=AE.getItem("irr"+f.subsID);if(AG==="true"){AF=true;}if(AG==="false"){AF=false;}}e.rawFilter=t.f.exp;j();h.setAdvMode(true);h.setOldIsAdvMode(true);h.setAdvState(AF);},failure:function s(AE){d.displayError(mstrmojo.desc(12394,"Cannot delete source table."),false,(AE&&AE.message)||"");}};if(x.length>0){h.deleteEmmaIRRSourceTable(x,AC);}else{AC.success();}}});return ;}Y.forEach(n.ts,function m(s){o=e.getImportSource(s.did);if(!o){return true;}o.checked=true;if(s.crb!==undefined){o.refreshType=parseInt(s.crb,10);o.checked=true;}if(s.ac!==undefined){o.executeAction=parseInt(s.ac,10);o.checked=true;}});j();},failure:function(l){d.displayError(mstrmojo.desc(12836,"Cannot get definition about this subscription"),false,l.message||l.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{V.forEach(e.importSources,function(l){l.checked=l.canSubscribe();});j();}}});},createSchedule:function(n){var h=mstrApp.getRootController(),l=h.getModel(),m=l.getSchedule(),d=l.cubeID,c=m.subsID,j=m.subsName,f=[],b=[],k=[];var g={subscriptionName:j,contentID:d};var e={success:function(p){var q=p.subsID,o=window.localStorage;l.raiseEvent({name:"CreateScheduleUpdate",res:p});if(q&&o){o.setItem("irr"+q,m.showAdvanceState);}},failure:function(o){l.raiseEvent({name:"CreateScheduleUpdate",res:o});}};if(!m.curTrg){return ;}mstrmojo.hash.forEach(l.importSources,function(o){if(o.checked&&o.canSubscribe()){f.push(o.tableID);b.push(o.refreshType);k.push(1);}});g.tableIDs=f.join();g.refreshTypes=b.join();g.executeActions=k.join();if(m.curTrg.isHidden){g.triggerPattern=m.curTrg.id;}else{g.triggerID=m.curTrg.id;}if(c){g.subscriptionID=c;}if(this.isAdvMode()&&(this.hasRefreshFilter()||this.hasAlternateSource())){g.hasIRR=1;}if(this.getOldIsAdvMode()){g.oldHasIRR=1;}g.sendNow=m.isSendNow;h.dataService.saveEMMASchedule(mstrmojo.func.wrapMethods(e,n),g);},removeSubscription:function(c,b){mstrApp.getRootController().dataService.removeSubscription(b,{subscriptionID:c.join()});},getScheduleStatus:function(c,g){var e=mstrApp.getRootController();var d=e.getModel();var f={dids:c.join(),type:3,size:5};var b={success:function(h){d.populateScheduleStatus(h);}};e.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(b,g),f);},getScheduleStatusBySubscription:function(c,g){var e=mstrApp.getRootController(),d=e.getModel(),f={dids:c.join(),type:255,size:5};var b={success:function(h){d.populateScheduleStatus(h);}};e.dataService.getScheduleStatus(mstrmojo.func.wrapMethods(b,g),f);},updateScheduleAndStatus:function(c){var b=mstrApp.getRootController();b.getScheduleController().getCubeSubscription({success:function(){var e=b.getModel(),f=e.subsInfo,d=[];Y.forEach(f,function(g){d.push(g.did);});if(d.length>0){b.getScheduleController().getScheduleStatusBySubscription(d,c);}else{if(c&&c.success){c.success();}if(c&&c.complete){c.complete();}}},failure:function(d){if(c&&c.failure){c.failure(d);}if(c&&c.complete){c.complete();}}});},showScheduleStatusDialog:function(c,f){var b=mstrApp.getRootController().getModel();var e=b.subsStatus&&b.subsStatus[c];if(e){e=e.slice().reverse();}else{e=[];}var d={subsStatus:e};if(f){d.onOK=f;}mstrApp.getRootController().showDialog(mstrmojo.DI.DIConstants.dialogType.refreshHistoryDialog,d);},selectAlternateSourceURL:function(e,d,h){var c=mstrApp.getRootController(),g=mstrApp.getRootController().dataService;var b={success:function(k){if(k.vt===1){if(h.success){h.success(k);}if(h.complete){h.complete();}}else{var j=A.parseAlternateSourceValidationResults(k.cols);c.showDialog(a.dialogType.alternateSourceValidateDialog,{items:j,zIndex:c.rootView.zIndex+10});}},failure:function(j){if(h.failure){h.failure(j);}if(h.complete){h.complete();}}};var f={success:function(j){if(j&&j.msgid){g.set("emmaIRRMessageID",j.msgid);}g.validateEmmaIRRAlternateSource(b,{tbid:e});},failure:function(j){if(A.isWS()){c.displayError(null,false,(j&&j.message)||"",null,mstrmojo.desc(14767,"Data from URL"),mstrmojo.desc(null,"Alternate source cannot be set."));}else{c.displayError(mstrmojo.desc(12837,"Cannot set alternate source."),false,(j&&j.message)||"");}}};this.editEmmaIRRSourceTableURL(e,null,"0",d,f);},isAdvMode:function L(){return mstrApp.rootController.model.getSchedule().isScheduleAdvanced;},setAdvMode:function D(c){var b=mstrApp.rootController.model,d=b.getSchedule();if(d.isScheduleAdvanced!==c){d.set("isScheduleAdvanced",c);}},setAdvState:function R(c){var b=mstrApp.rootController.model,d=b.getSchedule();d.set("showAdvanceState",c);},isAdvState:function G(){return mstrApp.rootController.model.getSchedule().showAdvanceState;},getOldIsAdvMode:function H(){return mstrApp.rootController.model.getSchedule().oldIsScheduleAdvanced;},setOldIsAdvMode:function Z(c){var b=mstrApp.rootController.model,d=b.getSchedule();if(d.oldIsScheduleAdvanced!==c){d.oldIsScheduleAdvanced=c;}},createEmmaIRRReportInstance:function C(c,d,g){var f=mstrApp.getRootController().dataService,b;if(f.emmaIRRMessageID){return ;}b={success:function e(h){f.set("emmaIRRMessageID",h.msgid);}};f.createEmmaIRRReportInstance(mstrmojo.func.wrapMethods(b,g),{reportID:c||J,delta:d||""});},createEmmaIRRSourceTables:function B(f,c,b,g){var e=mstrApp.getRootController().dataService,d={};if(f){d.brid=f;}d.tbids=c.join(",");d.crts=b.join(",");e.createEmmaIRRSourceTables(mstrmojo.func.wrapMethods(F,g),d);},editEmmaIRRSourceTableURL:function O(e,c,d,b,h){var g=mstrApp.getRootController().dataService,f={sourceType:T,tables:e};if(c){f.refreshTypes=c;}if(d){f.deleteTables=d;}if(b){f.url=b;}g.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,h),f);},editEmmaIRRSourceTableSingleTable:function M(g,d,f,b,e,k,j){var h=mstrApp.getRootController().dataService,c={sourceType:X,tables:g};if(d){c.refreshTypes=d;}if(f){c.deleteTables=f;}if(b){c.dbRoleID=b;}if(e){c.dbNamespace=e;}if(k){c.dbTableName=k;}h.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,j),c);},editEmmaIRRSourceTableRefreshTypes:function E(e,b,g,f){var d=mstrApp.getRootController().dataService,c={sourceType:X,tables:e.join(",")};if(b){c.refreshTypes=b.join(",");}if(g){c.deleteTables=g.join(",");}d.editEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,f),c);},deleteEmmaIRRSourceTable:function S(b,c){mstrApp.getRootController().dataService.deleteEmmaIRRSourceTable(mstrmojo.func.wrapMethods(F,c),{tbids:b.join(",")});},getEmmaIRRAttributes:function U(b){mstrApp.getRootController().dataService.getEmmaIRRAttributes(b);},setEmmaIRRFilter:function N(b,c){mstrApp.getRootController().dataService.setEmmaIRRFilter(mstrmojo.func.wrapMethods(F,c),{exp:b});},hasRefreshFilter:function P(){var b=mstrApp.getRootController().getModel(),c=false;V.forEach(b.isFilterInTable,function(d){if(d){c=true;return false;}});return c;},hasAlternateSource:function W(){var b=mstrApp.getRootController().getModel(),c=false;V.forEach(b.importSources,function(d){if(d.alternateSource){c=true;return false;}});return c;}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.QBuilderModel");var C=mstrmojo.func.wrapMethods,E=mstrmojo.array;function D(H,G,F){G.showWait=F;mstrApp.getRootController().getDataService().submitRequest(H,G);}function B(F){if(!F){return"";}var G="hdfs://";var H="/";if(F.hadoopnameservice){return G+F.hadoopnameservice+H;}else{if(F.hadoopname){if(F.hdfsport&&F.hdfsport!=8020){return G+F.hadoopname+":"+F.hdfsport+H;}else{return G+F.hadoopname+H;}}else{return G+H;}}}mstrmojo.DI.DIHadoopModel=mstrmojo.declare(mstrmojo.qb.QBuilderModel,null,{scriptClass:"mstrmojo.DI.DIHadoopModel",dbObjectsDisplayOptions:32,dbRolesTypeFilter:[5400],dbRolesVersionFilter:[218],dbmsTypeFilter:[5400],saveDBRole:function A(G,F,I){D(C({success:function H(J){mstrApp.dbRoleID=J.dbr.did;var K=[];E.forEach(G.connstr.split(";"),function(M){var L=M.split("=");K[L[0].trim().toLowerCase()]=L[1];});mstrApp.hadoopConnURL=B(K);}},I),{skipSchemaIDCheck:true,taskId:"arch.saveDBRole",dbroleinfo:JSON.stringify(G),showWait:true},true);}});mstrmojo.DI.DIHadoopModel.prototype.populateURLPath=B;})();(function(){mstrmojo.requiresCls("mstrmojo.qb.RootController");var B=mstrmojo.func.wrapMethods;mstrmojo.DI.controller.DIHadoopWHController=mstrmojo.declare(mstrmojo.qb.RootController,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopWHController",saveDBRole:function A(D,C,G){var E=this;E.model.saveDBRole(D.mdDBRole,C,B(G,{success:function F(){}}));}});})();(function(){mstrmojo.requiresCls("mstrmojo.qb.EmmaController","mstrmojo.DI.DIConstants","mstrmojo.AS.ASFFSQLRootController");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASQbFFSQLController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.AS.ASFFSQLRootController],{scriptClass:"mstrmojo.AS.ASQbFFSQLController",onFinishButtonClick:function C(){var H=mstrApp.rootController.model,G=H.dbrs,I=H.tableID,E,J,F,D;J=mstrApp.getRootController().rootView.getSQLStatement();F=J.split(".");F=F[F.length-1];E=G.find(function(K){return K.did===H.SelDBRoleID;});D={ns:H.SelNameSpaceID,id:E.mdDBRole.did,type:E.mdDBRole.db_type,dbr:E.mdDBRole.did,dbrn:E.mdDBRole.n,sql:J,dbtn:"Custom Query",n:"Custom Query",name:"Custom Query"};D.connection={connectionType:E.mdDBRole.db_type,connectionName:E.mdDBRole.n};D.tables=[];D.tables.push({dbr:E.mdDBRole.did,dbrn:E.mdDBRole.n,ns:H.SelNameSpaceID,type:E.mdDBRole.db_type,sql:J,name:"Custom Query"});this._super(D);},autoMapFFSQL:function A(J){var E=mstrApp.getRootController(),G=E.model;if(J===""){G.raiseEvent({name:"dataPreview",mappings:null,dataset:null,selectedColumns:null,isRefined:false});return ;}var D=window.mstrAppSchema.workspaceManager.currentClientId,H=window.mstrAppSchema.workspaceManager.initialWorkspaceId,F="",K=G.SelDBRoleID;var I={clientId:D,requestId:"",workspaceId:H,pipelineId:F,datasource:{dbRoleId:K,sql:J}};this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.qb.bigquery.RootController","mstrmojo.DI.DIConstants","mstrmojo.AS.ASFFSQLRootController");var B=mstrmojo.DI.DIConstants;mstrmojo.AS.ASGBQFFSQLController=mstrmojo.declare(mstrmojo.qb.bigquery.RootController,[mstrmojo.AS.ASFFSQLRootController],{scriptClass:"mstrmojo.AS.ASGBQFFSQLController",onFinishButtonClick:function C(){var G=mstrApp.rootController.model,H=G.dbrid,I=G.tableID,E,J,F,D;J=mstrApp.getRootController().rootView.getSQLStatement();F=J.split(".");F=F[F.length-1];D={ns:G.selectedDataset,id:H,type:B.dbType.GOOGLE_BIG_QUERY_FFSQL_MODEL,sql:J,dbtn:"Custom Query",n:"Custom Query",name:"Google Bigquery",accountId:G.said};D.connection={connectionType:B.dbType.GOOGLE_BIG_QUERY_FFSQL_MODEL,};D.tables=[];D.tables.push({dbr:H,ns:G.selectedDataset,type:B.dataSourceType.GOOGLE_BIGQUERY,sql:J,name:"Custom Query",accountId:G.said});this._super(D);},autoMapFFSQL:function A(J){var F=mstrApp.getRootController(),H=F.model;if(J===""){H.raiseEvent({name:"dataPreview",mappings:null,dataset:null,selectedColumns:null,isRefined:false});return ;}var E=window.mstrAppSchema.workspaceManager.currentClientId,I=window.mstrAppSchema.workspaceManager.initialWorkspaceId,G="",K=H.SelDBRoleID;var D={accountId:H.said,clientId:E,requestId:"",workspaceId:I,pipelineId:G,datasource:{accountId:H.said,dbRoleId:K,sql:J}};this._super(D);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.hash","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.warehouse.dbroles.DBRoleEditor","mstrmojo.DI.DIHadoopModel","mstrmojo.DI.DIHelpers","mstrmojo.DI.controller.DIHadoopWHController","mstrmojo.warehouse.obj.DBRole","mstrmojo.qb.DataService");mstrmojo.requiresDescs(12773,12774,12815,12816,12817,14950,14951,16148);var G=mstrmojo.array;var C=mstrmojo.hash;var A=mstrmojo.DI.DIHelpers;var K=mstrmojo.warehouse.EnumDatabaseType;var B="AFAD9E7E8D7E4DA0AEED8FD5AADFC99C",I=";MSTR_CUSTOM=true;";function J(O){var L=O.mi.ftree.fl;var N=0,P,M;if(L!==undefined){for(M=0;M<L.length;M++){P=L[M];N+=P.sz;}}return N;}mstrmojo.DI.controller.DIHadoopController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.controller.DIHadoopController",dbRoleID:B,hadoopConnURL:"",dbRole:"",saveDBRole:function H(O,N){var M=mstrApp.getRootController(),P=this;N.set("visible",false);N.close();M.getDataService().saveDBRole({success:function Q(R){P.dbRoleID=R.dbr.did;P.hadoopConnURL=mstrmojo.DI.DIHadoopModel.prototype.populateURLPath(O);M.model.raiseEvent({name:"HadoopDBRoleSaved"});},fail:function L(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{dbroleinfo:JSON.stringify(O)});},loadBDEDBRole:function(R){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return ;}var Q=this,M=new mstrmojo.DI.DIHadoopDBRole(),L=mstrApp.getRootController(),N=L.getModel(),O=N&&N.getImportSource(R),P=C.walk("sourceInfo.dbRoleId",O);L=mstrApp.getRootController();M.mdDBRole.did=B;M.populate(function(T){var S=T.mdDBRole.connstr;function U(){if(S===""||S===I){Q.renderDBRoleEditor(M);Q.dbRoleID=B;Q.dbRole=M;}else{G.forEach(S.split(";"),function(W){var V=W.split("=");T[V[0].trim().toLowerCase()]=V[1];});Q.hadoopConnURL=mstrmojo.DI.DIHadoopModel.prototype.populateURLPath(T);Q.dbRoleID=B;Q.dbRole=M;L.model.raiseEvent({name:"BDEDBRoleLoaded"});}}if(P&&P!==B){mstrmojo.warn(mstrmojo.desc(16148,"The current being used Hadoop Gateway connection is out of date and click OK to use the upgraded connection to browse Hadoop HDFS. The original connection info will be overridden once the dataset is updated."),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){U();}},cancelBtn:{cfg:{visible:false}}});}else{U();}});},populateDBRole:function F(M,N){var L=mstrApp.getRootController();L.model.populateDBRole(M,N);},doRenderDBRoleEditor:function(V,U){var Q=this;var L=mstrApp.getRootController();var P=L.getHadoopGatewayController();var R=L.dialogController.getNextZIndex();var O,S=!mstrApp.isSingleTier&&mstrApp.isWorkstation&&!mstrApp.isPopup;this.launchingApp=mstrApp;window.mstrApp=new mstrmojo.qb.QBApp();mstrApp.sessionState=this.launchingApp.sessionState;mstrApp.msgID=mstrApp.messageID;mstrApp.docID=mstrApp.messageID;mstrApp.placeholder="QBApp";mstrApp.isSingleTier=this.launchingApp.isSingleTier;mstrApp.diParams=this.launchingApp.diParams;mstrApp.isWorkstation=this.launchingApp.isWorkstation;mstrApp.serverProxy=this.launchingApp.serverProxy;mstrApp.isPopup=this.launchingApp.isPopup;delete mstrApp.messageID;delete this.launchingApp.dbType;delete this.launchingApp.supportDBObjects;mstrApp.sessionManager=this.launchingApp.sessionManager;mstrApp.enableAutomaticSessionRecovery=this.launchingApp.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=this.launchingApp.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=this.launchingApp.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=this.launchingApp.enableWarningSessionTimeout;mstrApp.projectName=this.launchingApp.projectName;mstrApp.serverName=this.launchingApp.serverName;mstrApp.serverPort=this.launchingApp.serverPort;mstrApp.authMode=this.launchingApp.authMode;mstrApp.name=this.launchingApp.name;mstrApp.persistTaskParams=this.launchingApp.persistTaskParams;mstrApp.hideProgress=this.launchingApp.hideProgress;mstrApp.taskQueue=this.launchingApp.taskQueue;mstrApp.diRootCtrl=L;var N=mstrApp.rootController=new mstrmojo.DI.controller.DIHadoopWHController();N.showDialog=function(X,W){L.showDialog(X,W);};N.getHadoopGatewayController=function(){return P;};N.getHadoopController=function(){return Q;};N.dataService=mstrmojo.qb.DataService;var M=N.model=new mstrmojo.DI.DIHadoopModel();M.dbRoleEditorCfg={hideLogin:true,hidePwd:true,hideShareLink:true,hideShareConnection:true,showShareLink:!!V,hideDSNOption:true,hideDriverCheck:true,dbIdFilter:[42]};M.loadDBObjects({success:function T(){var W=new mstrmojo.warehouse.dbroles.DBRoleEditor({zIndex:R,cssClass:A.getEnvObj().isWS()?"mstrmojo-rootview-hadoop mstrmojo-wh-DBRoleEditor":"mstrmojo-wh-DBRoleEditor",scrollable:S,isHadoopGateWay:true});W.config=M.dbRoleEditorCfg;W.callback={close:function(){if(mstrmojo.all.QBuilderModel){mstrmojo.all.QBuilderModel.destroy();}if(mstrmojo.all.QBuilderPage){mstrmojo.all.QBuilderPage.destroy();}mstrApp.getRootController().destroy();var b=window.mstrApp;window.mstrApp=Q.launchingApp;mstrApp.sessionState=b.sessionState;mstrApp.msgID=b.messageID;mstrApp.docID=b.messageID;if(b.dbRoleID){mstrApp.getRootController().hadoopController.dbRoleID=b.dbRoleID;mstrApp.getRootController().hadoopController.hadoopConnURL=b.hadoopConnURL;mstrApp.getRootController().model.raiseEvent({name:"HadoopDBRoleSaved"});}b.destroy();}};if(!V){V=new mstrmojo.warehouse.obj.DBRole({mdl:M});}W.listOptions={};O=W.listOptions[14956]=[];G.forEach(U,function(b){O.push({v:b.hgosName,data:b});});if(!O.length){O.push({v:""});}W.labelClickFn={};W.labelClickFn[14906]=function(){P.showGatewayListDialog();};if(U){for(var Z=0;Z<U.length;Z++){var Y=U[Z];var a=U[Z].config.hostAddr;var X=U[Z].config.tcpPort;if(U[Z].config.hostAddr==V.BDEIP&&U[Z].config.tcpPort==V.BDEPORT){W.oldIndex=Z;if(U[Z].config.sparkConfig.props){W.AuthMode=U[Z].config.sparkConfig.props.AuthMode;}else{W.AuthMode=0;}break;}}}W.dbrole=V;W.disableTest=true;W.open();Q.dbrEditor=W;}});},updateDBRoleEditor:function(){var L=mstrApp.getRootController(),O=this.dbrEditor;var P=O.children[0].children[2].children[4].dbp_hg.children[1];var N=P.selectedIndex;var M=[];L.getHadoopGatewayController().listGateways({success:function(S){var R=S&&S[0].entity;var Q=[];G.forEach(R,function(T){Q.push({v:T.hgosName,data:T,n:T.hgosName});});if(!Q.length){Q.push({v:""});}P.set("items",Q);P.set("selectedIndex",N);},failure:function(){}});},renderDBRoleEditor:function(L){this.doRenderDBRoleEditor(L);},hadoopBrowserFunction:function(L){this.browseHadoop(L.data.address,L.data.browser,L);},browseHadoop:function D(O,P,Q){var M=mstrApp.getRootController(),R={},L=P,N=Q;if(O===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(O.substring(0,1)==="\\"){O=O.replace(/\\\\/g,"file://");O=O.replace(/\\/g,"/");}R.urlPath=O;R.dbRoleID=this.dbRoleID;var S={success:function(T){if(T.mi.ftree===""){L.set("fileList",[]);}L.set("fileList",M.parseURLFolders(T));if(N){N.data.isMouseOver=true;if(T.mi.ftree===""){N.totalSize=0;}else{var U=T.mi.ftree.fl;if(U){N.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(T));}else{N.totalSize="---";}}}},failure:function(T){L.set("fileList",[]);M.displayError(mstrmojo.desc(12816,"Uh-Oh, Error fetching the list of files for the given network path: ####").replace("####",T.message),false);}};M.dataService.getOAuthSourceReports(S,R);},browseHadoopForFolderSize:function E(N,R){var M=mstrApp.getRootController(),P={},O=R,L=R.tree.parent;if(N===""){M.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(N.substring(0,1)==="\\"){N=N.replace(/\\\\/g,"file://");N=N.replace(/\\/g,"/");}P.urlPath=N;P.dbRoleID=this.dbRoleID;var Q={success:function(S){if(S.mi.ftree===""){O.totalSize=0;}else{var T=S.mi.ftree.fl;if(T){O.totalSize=mstrmojo.DI.DIHelpers.getRoundSize(J(S));}else{O.totalSize="---";}}L.setFileListForNode(M.parseURLFolders(S),R);O.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",refNode:O.textNode,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:-5,content:mstrmojo.desc(12817,"Name: #### Size: @@@@").replace("####",O.text).replace("@@@@",O.totalSize)});},failure:function(){}};M.dataService.getHadoopFolderSize(Q,P);}});}());(function(){var A=mstrmojo.DI.DIConstants.pageType;mstrmojo.DI.DIExpressView=mstrmojo.declare(mstrmojo.DI.DIRootView,null,{id:"DIRootView",scriptClass:"mstrmojo.DI.DIExpressView",offsetWidth:40,headerHeight:25,footerHeight:40,offsetHeight:175});}());function rrResize(){var A={h:mstr.utils.BoxModel.getBrowserWindowHeight(document),w:mstr.utils.BoxModel.getBrowserWindowWidth(document)};var B=mstrmojo.all.DIRootView;if(B){B.browserResized(A);}}(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.Button","mstrmojo.DI.DIDataService","mstrmojo.DI.DIConstants","mstrmojo.Editor","mstrmojo.dom","mstrmojo.DI.DIObjectBrowser","mstrmojo.Refine.Refine","mstrmojo.Refine.RefinePopupPage","mstrmojo.DI.DIHelpers","mstrmojo.DI.DIRelationshipDefineEditor","mstrmojo.DI.DINavigationController","mstrmojo.DI.controller.DIScheduleController","mstrmojo.DI.controller.DIDialogController","mstrmojo.DI.controller.DIFormsController","mstrmojo.DI.controller.DIPartitionController","mstrmojo.DI.controller.DIOAuthController","mstrmojo.DI.controller.DIMappingMenuController","mstrmojo.DI.controller.DIMappingController","mstrmojo.DI.controller.DIDirectAccessController","mstrmojo.DI.controller.DIHadoopController","mstrmojo.DI.controller.DIPublishController","mstrmojo.DI.controller.ImportController","mstrmojo.DI.controller.DIDocController","mstrmojo.DI.controller.DIRemoteProjectsController","mstrmojo.DI.controller.DIAllObjectsViewController","mstrmojo.DI.controller.DIHadoopGatewayController","mstrmojo.QueueNative","mstrmojo.vi.models.OneTierServerTransport","mstrmojo.DI.WorkstationServerTransport");mstrmojo.requiresDescs(212,218,219,221,422,640,773,1302,1442,9117,9118,9119,12581,12609,12611,12612,12618,12619,12624,12626,12770,12771,12772,12773,12774,12775,12776,12777,12778,12779,12780,12781,12782,12783,12784,12785,12786,12787,12788,12789,12790,12791,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12900,13264,13265,13278,13279,13280,13282,13320,13321,13322,13323,13324,10065,13104,13100,11465,9229,9228,9220,9221,9222,9223,9224,9225,9226,9227,9230,13445,13446,13646,13883,13914,13991,14096,14097,14155,14205,14206,14207,14610,14657,14658,14707,14869,14870,14888,14889,14890,14891,14892,15207,15208,11812,16032);var AY=mstrmojo.DI.DIConstants,Bp=mstrmojo.hash,Bh=mstrmojo.array,o=mstrmojo.func,Ay=mstrmojo.desc,Bk=mstrmojo.Button.newWebButton,Al=mstrmojo.DI.DIExitOptions,A6=mstrmojo.DI.DIHelpers,Ao=mstrmojo.string,h=4000,A0="TABLENAME=",Ak=1024*1024,Aj="#DESCRIPTION#INTRODUCTION#";var BB=AY.actions;var t;function Av(B7){B7=B7.toLowerCase();B7=B7.replace(/\s+/g," ");return(B7.indexOf("file://")===0)||(B7.indexOf("ftp://")===0)||(B7.indexOf("http://")===0)||(B7.indexOf("https://")===0)||(B7.indexOf("hdfs://")===0);}function f(CA,B8,B7,CB){var B9=mstrmojo.array.find(B7[CA].sheetsInfo,"index",B8);if(B7[CA].sheetsInfo.length!==0){if(B9>=0){B7[CA].sheetsInfo[B9].isAutoMapped=true;B7[CA].sheetsInfo[B9].isAutoMapppingSuccessed=CB;}}else{B7[CA].isAutoMapped=true;B7[CA].isAutoMapppingSuccessed=CB;}}function j(B8){var B9,CA,CE,CD,CC,CB,B7;for(B9 in B8){CE=B8[B9].sheetsInfo;CD=B8[B9].sourceInfo;CC=CD&&CD.partition.isPartition;if(this.model.operationMode===AY.operationMode.edit){if(CD){continue;}}B7=B8[B9].subtype;if(B7===AY.sourceSubtype.localFile||B7===AY.sourceSubtype.url||B7===AY.sourceSubtype.samplefile||B7===AY.sourceSubtype.publicData||B7===AY.sourceSubtype.cloudElement){if(B8[B9].isMergedCube){continue;}if(!CE){return false;}if(CE.length===0){if(!B8[B9].isAutoMapped){return false;}}CB=false;for(CA=0;CA<CE.length;CA++){if(!CE[CA].isAutoMapped&&CE[CA].selected&&!CC){return false;}else{if(CE[CA].isAutoMapped&&CE[CA].selected&&CC){CB=true;}}}if(CC&&!CB){return false;}}}return true;}function B6(B8,CC){var B9,CA,CD,B7;var CB=false,CE=true;for(B9 in B8){CD=B8[B9].sheetsInfo;B7=B8[B9].subtype;if(this.model.operationMode===AY.operationMode.edit||CC===AY.actions.importSource){if(B8[B9].sourceInfo){continue;}}if(B7===AY.sourceSubtype.localFile||B7===AY.sourceSubtype.url||B7===AY.sourceSubtype.samplefile||B7===AY.sourceSubtype.hadoop||B7===AY.sourceSubtype.publicData||B7===AY.sourceSubtype.cloudElement){if(B8[B9].isMergedCube){continue;}if(CD.length===0){if(B8[B9].isAutoMapped&&!B8[B9].isAutoMapppingSuccessed){CB=true;}else{if(B8[B9].isAutoMapped&&B8[B9].isAutoMapppingSuccessed){CE=false;}}}else{for(CA=0;CA<CD.length;CA++){if(CD[CA].isAutoMapped&&!CD[CA].isAutoMapppingSuccessed){CB=true;}else{if(CD[CA].isAutoMapped&&CD[CA].isAutoMapppingSuccessed){CE=false;}}}}}}if(CE){return 3;}if(CB){return 2;}return 1;}var An="sheetsDialog",J={scriptClass:"mstrmojo.Editor",id:An,cssClass:"mstrmojo-di-sheetsDialog",width:"300px",model:null,onOpen:function(){this.closeNode.style.display="none";this.helpNode.style.display="none";},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button primary-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var B8=this.parent.parent;var B7=AY.requestFlag.preview|AY.requestFlag.mapping|AY.requestFlag.transformations|AY.requestFlag.sourceInfo|AY.requestFlag.sheets|AY.requestFlag.anyState;if(mstrApp.isEMMACube){mstrApp.getRootController().editImportedDataEMMA(B7,B8.children[0].preShtsPD.selectedIndex,null,null);}else{mstrApp.getRootController().editImportedData(B7,B8.children[0].preShtsPD.selectedIndex,null,null);}B8.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button secondary-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();this.parent.parent.destroy();}}],children:[{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12581,"Select Sheet to Import:")},{scriptClass:"mstrmojo.Pulldown",alias:"preShtsPD",cssClass:"mstrmojo-di-sheetsDialog-pulldown",bindings:{items:function(){var B7=mstrApp.getRootController().getModel();var CA=B7.currentSource.sheets;var B9=[];var B8;if(CA){for(B8=0;B8<CA.length;B8++){if(CA[B8]!=="*"){B9.push({dssid:B8,n:CA[B8].name});}}}return B9;},defaultSelection:function(){var B8=mstrApp.getRootController().getModel();var B7=0;if(B8.currentSource.sourceInfo){B7=mstrmojo.array.find(B8.currentSource.sheets,"index",B8.currentSource.sourceInfo.sheetIndex);if(B7<0){B7=0;}}return B7;}}}]}]},Bx="refreshOptions",d={scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-di-refresh-dialog",id:Bx,showTitle:true,zIndex:10000,title:mstrmojo.desc(12770,"Refresh Data Options"),onOpen:function(){var B7=this.curtainNode.style;B7.background="black";B7.opacity=0.5;B7.filter="alpha(opacity=50)";},children:[{scriptClass:"mstrmojo.RadioList",alias:"radiolist",itemCssClass:"mstrmojo-di-refresh-options",items:[{did:"1",n:mstrmojo.desc(9117,"Replace existing data")},{did:"4",n:mstrmojo.desc(9118,"Update existing data and add new data")},{did:"2",n:mstrmojo.desc(9119,"Keep existing data and add new data")}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",cssText:"float:right;",text:mstrmojo.desc(1442,"OK"),onclick:function(){var B7=this.parent.parent;B7.model.refresh_opt=B7.radiolist.selectedItem.did;if(B7.onOK){B7.onOK();}B7.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var B7=this.parent.parent;if(B7.onCancel){B7.onCancel();}B7.close();}}]}]};function Aq(CA){var B7=this,B9=[];function B8(){window.setTimeout(function(){B7.dialogController.close(AY.dialogType.publishStatusDialog);B7.dialogController.destroyAll();var CB=mstrApp.container;if(CB){mstrApp.hideProgress(true);mstrApp.container.close();if(CB.dataImportCallback){CB.dataImportCallback(B9);}}else{if(!A6.isServerBasedWS()){mstrApp.redirectToPage(Al.getRedirectParams(Al.pageRedirect.flashVI,B7.model.cubeID,B7.model.isDirectDataAccess));}else{B7.shutDownServerBased(JSON.stringify({}));}}},0);}if(CA!==undefined){B9=[{acg:255,did:CA,st:779,t:3,mngd:B7.getModel().isManagedCube,isDDA:B7.getModel().isDirectDataAccess}];}if((B7.getModel().isManagedCube||mstrApp.isSingleTier)&&CA!==undefined){B7.getDocController().getVIDocData({success:function(CB){B9[0]=CB&&CB.datasets&&CB.datasets[CA];if(B9[0]){B9[0].did=CA;}B8();}});}else{B8();}}function B1(CB,B7){var B8="";var CD;if(CB){CD=this.model.getImportSource(CB).getMappingChanges();}else{CD=this.model.currentSource.getMappingChanges();}var CA,CC,B9;if(CD.length>0){B8+="<mpcs>";}for(CA=0;CA<CD.length;CA++){CC=CD[CA];B8+="<mpc ";for(B9 in CC){if(CC[B9]!==undefined){B8+=B9+'="'+CC[B9]+'" ';}}if(B7){B8+='fg="'+B7+'" ';}B8+=" />";}if(CD.length>0){B8+="</mpcs>";}return B8;}function Am(){var B9=this.model.operationMode;var B8=this,B7={success:function(){if(mstrApp.diParams.ImportDatabase&&B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.enterCredentials){B8.getDBMSObjects();}if(B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.enterCredentials){B8.getAuthenticationDBRoles();}if(!mstrApp.diParams.disableCESource){B8.getCloudElementDBRoles();}if(!mstrApp.diParams.disableCustomerConnector){B8.getCustomConnector();}}};if(mstrApp.isSingleTier){this.dataService.getPreferences({success:function(CC){var CB=CC&&(CC.diConnectorConfig||CC.diconnectorConfig);if(CB){if(typeof CB==="string"){try{CB=JSON.parse(CB);}catch(CD){CB=null;}}mstrApp.diParams.connectorConfig=CB;if(CB&&(CB.resourceConfig||CB.dbRoleConfig)){B8.getModel().populateSourceListAdminConfig(CB.resourceConfig,CB.dbRoleConfig);}}B8.oAuthController.getExternalSourcesInfo();if(B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.enterCredentials){B8.getAuthenticationDBRoles();}if(B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.enterCredentials){B8.getDBMSObjects();}if(!mstrApp.diParams.disableCESource){B8.getCloudElementDBRoles();}if(!mstrApp.diParams.disableCustomerConnector){B8.getCustomConnector();}}},{fordiConnectorConfig:true});}else{this.getDIProjectSettings(B7);}if(B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.enterCredentials){this.fetchSampleFileList();}if(!mstrApp.isSingleTier&&!A6.isServerBasedWS()&&!A6.getEnvObj().isWSLiveMode()){mstrmojo.locales.load(mstrmojo.emptyFn);}if(!A6.isOnetier()&&B9!==AY.operationMode.refresh&&B9!==AY.operationMode.subscribe&&B9!==AY.operationMode.edit){if(!this.model.analysisID){var CA={op:AY.getCubeQuotaAndInfosOptions.GetCubeQuotaAndInfosQuotaOnly};this.getCubeQuota(null,CA);}this.getShapekeys();}}function AQ(B8){var B9=B8.code;var CA=B8.message;if(B9===null||B9===undefined){CA=B8.getResponseHeader("X-MSTR-TaskFailureMsg");}var CB=CA.indexOf("("),B7=CA.lastIndexOf(")");if(CB>=0&&B7>CB){CA=CA.substring(CB+1,B7);}return CA;}function B3(B9){var B8=this;var CB=[];var B7=[];var CA=B8.rootView.currentPage;var CC="<ul>";mstrmojo.hash.forEach(B9.files,function(CD){if(CD.failed===true){B7.push(CD.fileName);CC+="<li>"+CD.fileName+"<br>"+AQ(CD.errRes)||" </li>";}else{CB.push(CD.fileName);}});CC+="</ul>";CA.set("forceEnable",CB.length>0?true:false);if(CA.setFilesObject){CA.setFilesObject(B7);}B8.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CC);}function k(CA,CB){var B7=[],B8=mstrApp.getRootController(),B9=B8.getModel();Bh.forEach(CA,function(CC){if(B9.getImportSource(CC)){B7.push(CC);}});if(B7.length>0){B8.removeEMMASourceTable(CB,{did:B7.join()});}else{if(CB.success){CB.success();}if(CB.complete){CB.complete();}}}function A1(B7){B7=B7.split("&").join("&amp;");B7=B7.split("<").join("&lt;");B7=B7.split(">").join("&gt;");B7=B7.split("%").join("&#37;");return B7;}function A2(CC){var B9=this.getModel().importSources,CA,B8,CB=[],B7=false;for(CA in B9){if(B9.hasOwnProperty(CA)&&B9[CA].isHierarchyRelationTable()&&B9[CA].shouldDoNotImportHierarchy()){B8=B9[CA].currentMapping;Bh.forEach(B8,function(CE){var CF=false;if(CE.subColumns&&(CE.subColumns.length>0)){for(var CD=0;CD<CE.subColumns.length;CD++){if(CE.subColumns[CD].recursive===true){CF=true;}}}CE.selected=!!CE.recursive||CF;});CB=CB.concat(B8);B7=true;}}if(CB.length>0){this.mappingController.setMultipleImport(CB,CC,true);}return B7;}function BU(B9,B8){var B7=B9.indexOf(Aj);if(B7<0){return B8==="desc"?B9:"";}else{return B8==="desc"?B9.substring(0,B7):B9.substring(B7+Aj.length,B9.length);}}mstrmojo.DI.DIRootController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DI.DIRootController",start:function BV(){var B7=this.rootView;this.dataService=new mstrmojo.DI.DIDataService();this.navigationController=new mstrmojo.DI.DINavigationController();this.dialogController=new mstrmojo.DI.controller.DIDialogController();this.formsController=new mstrmojo.DI.controller.DIFormsController();this.partitionController=new mstrmojo.DI.controller.DIPartitionController();this.mappingMenuController=new mstrmojo.DI.controller.DIMappingMenuController();this.mappingController=new mstrmojo.DI.controller.DIMappingController();this.hadoopController=new mstrmojo.DI.controller.DIHadoopController();this.oAuthController=new mstrmojo.DI.controller.DIOAuthController();this.projectController=new mstrmojo.DI.controller.DIRemoteProjectsController();this.allObjectsController=new mstrmojo.DI.controller.DIAllObjectsViewController();this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();if(A6.getEnvObj().isWSDossierLocalMode()){t=new mstrmojo.QueueNative({transport:mstrmojo.vi.models.OneTierServerTransport});}else{if(A6.getEnvObj().isWSDataSet()||A6.getEnvObj().isWSLiveMode()){t=new mstrmojo.QueueNative({transport:mstrmojo.DI.WorkstationServerTransport});}else{t=new mstrmojo.QueuedXHR();}}mstrApp.taskQueue=t;this.model.initParams(mstrApp.diParams);B7.render();this.addDisposable(B7);this.addDisposable(this.model);this.addDisposable(this.dataService);this.addDisposable(this.dialogController);this.addDisposable(this.navigationController);Am.call(this);},getModel:function A7(){return this.model;},getDataService:function Ba(){return this.dataService;},getMappingMenu:function BW(B7){return this.mappingMenuController.getMappingMenu(B7);},forceImport:true,fetchPreview:true,refineApp:null,scheduleController:null,ddaController:null,tablesSrc:{},deleteObject:function BN(B8,B7){this.dataService.deleteObject(B8,B7);},renameObject:function P(B8,B7){this.dataService.renameObject(B8,B7);},getScheduleController:function BY(){if(this.scheduleController===null){this.scheduleController=new mstrmojo.DI.controller.DIScheduleController();}return this.scheduleController;},getDDAController:function B2(){if(this.ddaController===null){this.ddaController=new mstrmojo.DI.controller.DIDirectAccessController();}return this.ddaController;},getDialogController:function BA(){if(this.dialogController===null){this.dialogController=new mstrmojo.DI.controller.DIDialogController();}return this.dialogController;},getImportController:function(){if(!this.importController){this.importController=new mstrmojo.DI.controller.ImportController();}return this.importController;},getDocController:function(){if(!this.docController){this.docController=new mstrmojo.DI.controller.DIDocController();}return this.docController;},getHadoopGatewayController:function(){var B7=this;if(!this.hadoopGatewayController){this.hadoopGatewayController=new mstrmojo.DI.controller.DIHadoopGatewayController({rootController:B7});}return this.hadoopGatewayController;},showPage:function BH(B7,B8,CA,B9){if(B7===AY.pageType.emmaPreview&&this.dialogController.pageZIndex>0){this.rootView.parent.close();return null;}if(!this.rootView.parent){this.rootView.parent=mstrApp.container;}if(mstrApp.container&&!mstrApp.container.rootView){mstrApp.container.rootView=this.rootView;}if(!CA){if(this["getNewPageSlotForPage"+B7]){CA=this["getNewPageSlotForPage"+B7]();}else{CA=this.navigationController.getPageSlot();}}if(CA.getConfig()&&CA.getConfig().newPage){this.showDialog(AY.dialogType.diPageDialog,CA.getConfig().newPageConfig);}return this.rootView.showPage(B7,B8,CA,B9);},getNewPageSlotForPage6:function(){var CA=this,CD=CA.navigationController.getPageSlot(),B9=CA.model,B8=true,CC=false,B7,CB=(B9.operationMode===AY.operationMode.create);Bp.forEach(B9.importSources,function(CE){B8=false;if(CE.databaseType===h&&CE.xdaType===AY.xdaType.qbSingleTable){CC=true;return false;}else{B7=true;}});CD.setConfig({properties:{hasDDAOnlySource:B8,isFilterDDA:CB,isSAPHana:CC,hasNonSAPHana:B7}});return CD;},showSheetsSelectionDialog:function AA(CB,CJ,CT,CP,CI,B9){var CS;var CM,CK,CQ,CA,CN,CH=[],CO,CE=false,CF=0;var CC=CB||this.model.getAllTableID();for(CM=0;CM<CC.length;CM++){CQ=this.model.importSources[CC[CM]];CA=CQ.sheetsInfo;CN=[];var CU;if(CA){if(CA.length>1){CE=true;if(CQ.currentIndex&&CQ.currentIndex!==-1){CF=Bh.find(CA,"index",CQ.currentIndex);if(CF<0){CF=0;}}for(CK=0;CK<CA.length;CK++){if(CK===CF){CN.push({idx:CK,n:CA[CK].name,selected:true,title:CA[CK].name});}else{CN.push({idx:CK,n:CA[CK].name,title:CA[CK].name});}}var CW=this.model.importSources[CC[CM]].sourceInfo;var CD=this.model.importSources[CC[CM]].currentMapping;if(this.model.operationMode===AY.operationMode.create){if(CD){CO=CW&&CW.partition.isPartition?true:false;}else{CO=true;}}else{if(CW&&CW.partition.type!==0){CO=true;}else{if(!CW){CO=true;}else{CO=false;}}}if(CI&&CI.files){for(var CV in CI.files){if(CI.files[CV].tableID===CC[CM]){if(A6.getEnvObj().isWSDossierLocalMode()){if(typeof CI.files[CV].fileName!=="undefined"){CU=A6.getAbsoluteFileName(CI.files[CV].fileName);}}else{CU=CI.files[CV].fileName;}}}}CH.push({n:CU||CQ.fileName||CT||CQ.dbTableName,id:CQ.tableID,sheets:CN,multiSelection:CO,defaultSheetsIndex:CF});}}}if(CE){CS={items:CH,onOK:function(){var CX=this;var Cg=this.items;var Cm=mstrApp.getRootController(),Ce=Cm.model,Ca=Ce.importSources,Cc=this.items[0].id,Cu=Ce.importSources[Cc].sourceInfo,Co,Ct={},Cj,Cq,Ci,Cl,CY;var Ck=function(Cv){return Cv.selected;};mstrmojo.array.forEach(this.items,function(Cv){CA=Ca[Cv.id].sheetsInfo;mstrmojo.array.forEach(CA,function(Cx,Cw){if(Cv.sheets[Cw].selected){Cx.selected=true;}else{Cx.selected=false;}});});function Cd(Cv){var Cw=[];mstrmojo.hash.forEach(Ca[Cv].sheetsInfo,function(Cx){if(Cx.selected){Cw.push({name:Cx.name,index:Cx.index});}});return Cw;}if((Ce.operationMode===AY.operationMode.create&&(Cu&&!Cu.partition.isPartition))||!Cu){for(Co=0;Co<Cg.length;Co++){Cc=Cg[Co].id;Ci=mstrmojo.array.filter(Ca[Cc].sheetsInfo,Ck);Cq=Ci.length;Cl=Cq>1;for(CM=0;CM<Cq;CM++){if(Cl){Ct.behaviorFlags=AY.behaviorChangeFlag.multiSheet;}Cj=Ci[CM].index;if(CM===0){Ct.shtIx=Cj;Cm.autoMappingSourceTable(B9,Cc,Ct,Cc,CJ,CI);}else{CY=Ct.tbid=Cc;if(mstrmojo.all[CP].scriptClass==="mstrmojo.DI.DIHadoop"){var Cn=Cm.rootView.hadoopPage.getDropZone();Ct.url=Ca[Cc].fileName;var CZ="?hdfsURL=";var Cr={};for(CV in Cn.fileTypeMap){var Cs=CV.indexOf(CZ);var Cf=Cs>=0?CV.substring(Cs+CZ.length):CV;Cr[Cf]=Cn.fileTypeMap[CV];}if(Cr&&Cr[Ct.url]){Ct.fileType=Cr[Ct.url];}else{Ct.fileType=A6.extractFileExtensionFromHadoopURL(Ct.url);}Ct.xt=(Ct.fileType.toUpperCase()===AY.fileTypes[0].v)?AY.xdaType.dataImportFileText:AY.xdaType.dataImportFileExcel;}Cm.createEMMASourceTableMultiSheets(Ct,Cj,CY,Ca[Cc].type,Ca[Cc].subtype,CJ,CP);}}Ct={};}}else{var Cp=CX.filesAndSheets.rightPanel.sheets;var Cb;Ci=Ce.importSources[Cc].sheetsInfo;Cq=Ci.length;if(Cu&&Cu.partition&&Cu.partition.isPartition){Cb=Cp.selected.selectedIndices;for(CM=0;CM<Cq;CM++){if(Cb[CM]){Ci[CM].selected=true;}else{Ci[CM].selected=false;}}Cm.setPartition(Cc);}else{Cb=Cp.selected.selectedIndex;if(Cb===-1){var Ch=Cp.selected.selectedIndices;for(CM in Ch){if(Ch.hasOwnProperty(CM)&&Ch[CM]){Cb=parseInt(CM);break;}}}for(CM=0;CM<Cq;CM++){if(CM!==Cb){Ci[CM].selected=false;}}Ci[Cb].selected=true;Cj=Ci[Cb].index;Ct.shtIx=Cj;Cm.setDataImportInfo(Cc,Ct,Cc,CJ,CI,B9);}}CX.destroy();},onBack:function(){var Ca=this,CY=mstrApp.getRootController(),CZ=this.items,Cb=[],CX=CY.model.importSources,Cc={success:function(Cd){CY.dataService.set("messageID",Cd.msgid);Bh.forEach(Cb,function(Ce){delete CX[Ce];});Ca.unrender();},failure:function(Cd){CY.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,Cd.message||"");}};if(mstrmojo.all[CP]&&!mstrmojo.all[CP].tableID){Bh.forEach(CZ,function(Cd){Cb.push(Cd.id);});CY.removeEMMASourceTable(Cc,{did:Cb.join()});}else{delete CX[CZ[0].id].sheetsInfo;CX[CZ[0].id].sheetsInfo=CX[CZ[0].id].originalSheetsInfo;Ca.unrender();}}};var B7=this.model.importSources;if(B7[CC[0]].tableIdx>=0){var CL;var B8,CR={};var CG=mstrApp.getRootController();for(CL=0;CL<CH.length;CL++){B8=CH[CL].id;CR.shtIx=B7[CC[CL]].tableIdx;CG.autoMappingSourceTable(CL===CH.length-1?B9:null,B8,CR,B8,CJ,CI);CR={};}}else{this.showDialog(AY.dialogType.sheetsSelectionDialog,CS);}}},restoreForLaunchingApp:function E(){var B7=this;var B9=B7.model;var CB=mstrApp.launchingApp;var B8=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;var CA;switch(CB){case"QB":CA=mstrApp.tableID;if(mstrApp.messageID){B7.dataService.set("messageID",mstrApp.messageID);B7.getImportedDataEMMA(BB.importSource,B8);}break;default:if(B9.operationMode===AY.operationMode.create){B7.showPage(AY.pageType.dataSelection);}else{if(B9.operationMode===AY.operationMode.enterCredentials){B7.showDialog(AY.dialogType.credentialsDialog,{model:B9.documentModel});}else{if(mstrApp.isEMMACube&&(B9.operationMode===AY.operationMode.refresh)){if(B7.model.datasets){B7.showDialog(AY.dialogType.cubesList,{left:"200px"});}else{this.republishEMMACube();}}else{if(mstrApp.isEMMACube&&(B9.operationMode===AY.operationMode.subscribe)){this.republishEMMACube();}else{if(B9.operationMode===AY.operationMode.pickTable){B7.showPage(AY.pageType.database,{sourceType:AY.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:AY.xdaType.qbSingleTable,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId}});}else{if(B9.operationMode===AY.operationMode.hadoopPickTable){B7.showPage(AY.pageType.database,{sourceType:AY.sourceType.querybuilder,name:"hadoop",step2:mstrmojo.desc(12460,"Select one or more tables"),type:AY.xdaType.qbSingleTable,subtype:AY.sourceSubtype.hadoop,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId,isHadoopQB:true}});}else{if(B9.operationMode===AY.operationMode.ffsql){B7.showPage(AY.pageType.database,{sourceType:AY.sourceType.querybuilder,name:"Database",step2:mstrmojo.desc(12460,"Select one or more tables"),type:AY.xdaType.ffsql,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId}});}else{if(B9.operationMode===AY.operationMode.hadoopFFsql){B7.showPage(AY.pageType.database,{sourceType:AY.sourceType.querybuilder,name:"hadoop",step2:mstrmojo.desc(12460,"Select one or more tables"),type:AY.xdaType.ffsql,subtype:AY.sourceSubtype.hadoop,extParams:{defaultDbrId:mstrApp.diParams&&mstrApp.diParams.defaultDbrId,isHadoopQB:true}});}else{this.fetchCubeInfoEMMA();}}}}}}}}break;}},checkAndShowPrivilegeMsg:function At(){var B7=this,B9=this.getModel(),B8=B9.hasPrivilegesForAllTables(Bp.valarray(B9.importSources)),CA=mstrmojo.desc(13914,"You do not have the right privilege to make changes. Contact your administrator."),CB;CB=function(){B7.cancelApplication();};if(!B8){mstrmojo.alert(CA,CB,"",B7.getDialogController().getNextZIndex());}return B8;},setModalNodes:function(CA,B9,B8){var B7=[];B7=B7.concat(CA);if(B9!==false){B7.push(this.rootView.footerNode);}return this.rootView.setModalNodes(B7,B8);},clearModalNodes:function(){return this.rootView.clearModalNodes();},getCubeInfo:function w(B8){var B7=this,B9={success:function(CA){var CB=mstrmojo.hash.copy(B7.model.cubesInfo);mstrmojo.hash.forEach(CB.cubes.cube,function(CC){if(CC.cube_id===B8){CC.mdt=CA[B8].mdt;}});B7.model.set("cubesInfo",-1);B7.model.set("cubesInfo",CB);}};this.dataService.getUserDICubeInfo(B9,{cubeIds:B8});},getCubeQuota:function AU(B7,B8){if(A6.isWS()){this.getCubeQuotaForRest(B7);}else{this.getCubeQuotaForWeb(B7,B8);}},getCubeQuotaForWeb:function(B7,B9){var B8=this;var CA={success:function(CB){if(!mstrApp.diParams){return ;}if(CB.cubes&&CB.cubes.cube){CB.cubes.cube=[].concat(CB.cubes.cube);}if(CB.cubes&&CB.cubes.doc){CB.cubes.doc=[].concat(CB.cubes.doc);}B8.model.set("cubesInfo",CB);},failure:function(){B8.model.set("cubesInfo",-1);}};if(B7){CA=mstrmojo.func.wrapMethods(CA,B7,{});}mstrApp.serverRequestParallel(mstrmojo.hash.copy(B9,{taskId:"qBuilder.GetQuota"}),CA);},getCubeQuotaForRest:function(B7){var B8=this;var B9={success:function(CC){if(CC&&CC.usage!==undefined&&CC.size!==undefined){var CB=(CC.size<=0)?CC.size:CC.size/Ak;var CA={cubes:{cusage:CC.usage/Ak,cquota:CB}};B8.model.set("cubesInfo",CA);}else{B8.model.set("cubesInfo",-1);}},failure:function(){B8.model.set("cubesInfo",-1);}};if(B7){B9=mstrmojo.func.wrapMethods(B9,B7,{});}this.dataService.getCubeQuotaByRestAPI(B9);},openMailClient:function BT(B7){this.getDataService().openMailClient(B7);},displayCubesInfo:function BI(){var B9=this,B8=AY.dialogType.cubesList;if(this.model.cubesInfo===0){var B7=mstrmojo.desc(14657,"We are still fetching your cubes information. Please try again later."),CA=mstrmojo.desc(14658,"Cube Quota Unavailable");this.displayWarning(B7,CA);return ;}if(this.model.cubesInfo===-1){return ;}if(B9.getDialogController().hasDialog(B8)){B9.showDialog(B8,{left:"200px"});}else{B9.getScheduleController().updateScheduleAndStatus({complete:function(){B9.showDialog(B8,{left:"200px"});}});}},openOAuthParaDialog:function BE(B8,B7){this.showDialog(AY.dialogType.setOAuthParaDialog,B7);},openWhiteListDialog:function AF(B8,B7){this.showDialog(AY.dialogType.setWhiteListDialog,B7);},openEditConnectorDialog:function BG(B8,B7){this.showDialog(AY.dialogType.addConnectorDialog,B7);},getAnalyticsWebProperties:function Bv(B7){this.oAuthController.getAnalyticsWebProperties(B7);},getAnalyticsProfiles:function Ax(B8,B7){this.oAuthController.getAnalyticsProfiles(B8,B7);},getOAuthSourceReports:function AV(B9,B8,CB,CA,B7){this.oAuthController.getOAuthSourceReports(B9,B8,CB,CA,B7);},oAuthSourceBrowserFunction:function(B8,B9,CA,B7){this.oAuthController.oAuthSourceBrowserFunction(B8,B9,CA,B7);},oAuthSourceFetchFunction:function(B7,B8){this.oAuthController.oAuthSourceFetchFunction(B7,B8);},projectSourceBrowserFunction:function(B8,B7,CB){var B9=this;var CA={success:function(CC){var CD=B9.parseProjectSourceFolder(CC);B8.set("fileList",CD);},failure:function(){B8.set("fileList",[]);}};this.getProjectSourceFolderContents(CA,B7,CB);},getProjectSourceFolderContents:function e(CA,B9,B7){var B8={objectType:"8,768,769,774,776",dbrid:B7};if(B9){B8.objectId=B9;}this.dataService.fetchRemoteFolderContents(CA,B8);},parseProjectSourceFolder:function BF(CA){if(!CA.items){return[];}var CC=CA.items,B8=[],B7,CB,B9;if(!CC.length){return[];}for(B9=0;B9<CC.length;B9++){B7=CC[B9];CB={isFolder:false};switch(B7.t){case 8:CB.isFolder=true;if(B7.isc===true){CB.type="shortcut";CB.iconFolderClosed="mstrmojo-di-tree-node-icon shortcut-closed";CB.iconFolderOpen="mstrmojo-di-tree-node-icon shortcut-open";}else{CB.type="folder";}break;case 3:switch(B7.st){case 768:CB.type="grid";break;case 769:CB.type="graph";break;case 774:CB.type="gridGraph";break;case 776:CB.type="cube";break;case 779:CB.type="emmaCube";break;}break;}CB.n=B7.n;CB.address=B7.did;CB.desc=B7.desc;B8.push(CB);}return B8;},getOAuthSourceFolderContents:function Au(B7,B8,B9){this.oAuthController.getOAuthSourceFolderContents(B7,B8,B9);},oneTierImportFile:function AG(B8,B7){this.dataService.oneTierImportFile(B8,B7);},launchOneTierBrowser:function B(B7){this.dataService.launchOneTierBrowser(B7);},scrapeWiki:function A5(B9,B7){var B8=this,CB={success:function(CC){mstrApp.hideProgress();if(B7){B8.model.populateWikiSuggestions(CC);}else{B8.model.populateWikiSearchResults(CC);}},failure:function(CC){mstrApp.hideProgress();if(B7){B8.model.populateWikiSuggestions([undefined,[]]);}else{B8.displayError(mstrmojo.desc(640,"Your request could not be processed due to a server error."),false,CC.message);}},canceled:function(){mstrApp.hideProgress();if(B7){B8.model.populateWikiSuggestions([undefined,[]]);}else{B8.model.populateWikiSearchResults([]);}}},CA={searchString:B9};if(B7){CA.shouldSuggest=true;}this.getDataService().scrapeWiki(CB,CA);},parseOAuthSourceFolder:function u(B8,B7){return this.oAuthController.parseOAuthSourceFolder(B8,B7);},readyForSubscription:function BK(){mstrmojo.all.mstrOAuthFW.set("oAuthReady",true);},sourceSelected:function q(B7){if(B7){this.rootView.showFooter({next:{enabled:true}});this.rootView.showFooter({finish:{enabled:true}});this.forceImport=true;}else{this.rootView.showFooter({next:{enabled:false}});this.rootView.showFooter({finish:{enabled:false}});}},enableFinishButton:function BD(B7){if(B7){this.rootView.showFooter({finish:{enabled:true}});}else{this.rootView.showFooter({finish:{enabled:false}});}this.sourceSelected(B7);},showPreview:function Be(B7){var B8=false;if(this.model.operationMode===AY.operationMode.create){B8=true;}if(B7){this.rootView.showFooter({next:{text:mstrmojo.desc(212,"Continue"),enabled:B8}});}else{this.rootView.showFooter({next:{text:mstrmojo.desc(1302,"Finish"),enabled:B8}});}},onBackButtonClick:function A3(){this.rootView.currentPage.onBackButtonClick();},onNextButtonClick:function AB(){this.rootView.currentPage.onNextButtonClick();},onSaveButtonClick:function BL(){if(this.rootView.currentPage.onSaveButtonClick){this.rootView.currentPage.onSaveButtonClick();}},onFinishButtonClick:function I(){this.rootView.currentPage.onFinishButtonClick();},onCancelButtonClick:function A9(B7){if(!B7){this.model.refreshToWrangle=null;}if(typeof this.rootView.currentPage.onCancelButtonClick==="function"){if(this.rootView.currentPage.onCancelButtonClick()){return ;}}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{this.cancelApplication();}},onHelpButtonClick:function O(){mstrApp.showHelpTopic(this.rootView.currentPage.onHelpButtonClick());},gotoOAuthLogin:function F(CB,B8,CC,B7){if(mstrApp.isSingleTier||A6.isServerBasedWS()){if(window.FormWrapper.testInternetConnection()!==0){var B9=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),CA='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";B9=B9.replace("#",CA)+".";this.displayError(B9,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}this.oAuthController.oneTierOAuth(CB,B8,CC,B7);}else{mstrApp.originUrl=window.location.href;this.oAuthController.getWebServiceURL(CB,B8,CC,B7);}},setTableIDsForOAuth:function Af(B7){this.oAuthController.tableIDs=B7;},oAuthSignOut:function BP(B7){this.oAuthController.oAuthSignOut(B7);},launchWranglerDialog:function A(B8){var B7=this;var B9=function B9(){if(!B8.projectID){var CA="<rss><rpo></rpo></rss>";B7.startRefineStage(B8.tableID,2,CA,B8.sourceInfo.isRefined);}else{B7.refine(B8.projectID,B8.tableID);}};if(!(B8.sourceInfo&&B8.sourceInfo.hasAggFilter)){B9();}else{mstrmojo.confirm(mstrmojo.desc(12720,"Previous changes made in aggregation will be discarded. Would you like to continue?"),{confirmBtn:{fn:function(){B7.dataService.cancelAggFilter({success:function CA(CD){B7.dataService.set("messageID",CD.msgid);var CC=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship|AY.requestFlag.preview|AY.requestFlag.transformations;var CB={success:function(){B9();}};mstrApp.getRootController().editImportedDataEMMA(CC,null,null,null,B8.tableID,null,null,null,null,true,CB);}},{tbid:B8.tableID});}}});}},refine:function AP(B7,B8){if(!this.refineApp){this.refineApp=new mstrmojo.Refine.Refine();}this.refineApp.start(this.getModel().refineServerURL,B7,B8);this.showDialog(AY.dialogType.refinePage,{tableID:B8});},importFile:function Ar(B8,CA,CF,CD){if(!this.forceImport){this.showPage(AY.pageType.preview);return ;}this.fetchPreview=CF;var CB=this.model;var B7=this.model.cubeID;var CC=this;var B9={fileName:CA};if(B7){B9.reportid=B7;}B9.behaviorFlags=AY.importBehaviorFlag.reserved;if(this.model.operationMode===AY.operationMode.refresh||this.model.operationMode===AY.operationMode.edit){if(mstrApp.isCloudPro){B9.behaviorFlags=AY.importBehaviorFlag.newColumnsSilent|AY.importBehaviorFlag.dataTypeSilent;}}var CE={success:function(CJ){var CG=AY.requestFlag.anyState|AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.sheets|AY.requestFlag.preview|AY.requestFlag.transformations,CI=CF?0:-1;var CH=CJ.msg_id||CJ.content.mst_id;if(CD){CB.importSources.tableID=CH;return ;}CC.dataService.set("messageID",CH);mstrApp.hideProgress();CC.getImportedData(BB.refine,CG,CI,undefined,0);},failure:function(CG){mstrApp.hideProgress();CC.displayError(mstrmojo.desc(12771,"Error in importing the file. Please check the file being imported"),false,CG&&CG.message);},progress:function(CH,CI){if(CH.lengthComputable){var CG=(CH.loaded/CH.total);mstrApp.setProgressParams(CG,CI);}}};CC.dataService.importFile(B8,CE,B9);},importFileEMMA:function Bo(CB,CD,B7,CA,B9,CC,B8){this.getImportController().importFile(CB,CD,B7,CA,B9,CC,B8);},resetAppforRepublish:function Ap(B7){this.model.initParams({ReportId:B7.cubeID,CubeName:B7.cubeName,StatusCode:AY.statusCode.republish,AnalysisId:undefined,datasets:null});this.republishEMMACube();},resetAppforImport:function AO(){this.model.resetImportSource();this.model.initParams({ReportId:undefined,CubeName:undefined,StatusCode:undefined,AnalysisId:undefined,datasets:null});this.dataService.messageID=undefined;},browseURLPath:function AH(B8,CE,CA,B9){var B7=this,CC={};B8=B8.trim();if(B8===""){B7.displayError(mstrmojo.desc(12773,"Please enter a valid network path."),false);return ;}if(!Av.call(this,B8)){B7.displayError(mstrmojo.desc(12512,"We do not support the URL protocol you provided."),false);return ;}try{if(decodeURI(B8)===B8&&!mstrmojo.string.startsWith(B8.toLowerCase(),"file://")){B8=encodeURI(B8);}}catch(CB){}if(B8.substring(0,1)==="\\"){B8=B8.replace(/\\\\/g,"file://");B8=B8.replace(/\\/g,"/");}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}B8=B8.trim();if(B8.charAt(B8.length-1)!=="/"){B8=B8+"/";}CC.urlPath=B8;if(CA){CC.dbRoleID=CA;}var CD={success:function(CG){var CF=B7.parseURLFolders(CG);if(CG.mi.ftree===""||CF.length<=0){B7.displayError(mstrmojo.desc(12774,"We could not find anything. Please verify that you have entered a valid network path."),false);}if(CE.getObjectBrowser){CE.getObjectBrowser().set("fileList",CF);if(B9){B9(CE.getObjectBrowser(),CF);}}else{CE.set("fileList",CF);}},failure:function(CF){B7.displayError(mstrmojo.desc(12775,"Uh-Oh, Error fetching the list of files for the given network path: "),false,CF&&CF.message);}};this.dataService.getOAuthSourceReports(CD,CC);},urlBrowserFunction:function(B8,B7){this.browseURLPath(B8.data.address,B8.data.browser,B7);},executeCommand:function Bz(B7,B8){switch(B7){case"loginToProxy":this.loginToProxy(B8);break;case"loginToWebserver":this.loginToWebserver(B8);break;case"loginToProject":this.loginToProject(B8);break;case"shutDownDesktop":this.shutDownDesktop(B8);break;default:break;}},loginToWebserver:function BX(B7){mstrmojo.onetier.controllers.RootController.prototype.loginToWebserver.call(this,B7);},loginToProxy:function s(B7){mstrmojo.onetier.controllers.RootController.prototype.loginToProxy.call(this,B7);},loginToProject:function AW(B7){mstrmojo.onetier.controllers.RootController.prototype.loginToProject.call(this,B7);},shutDownDesktop:function U(B7){mstrmojo.onetier.controllers.RootController.prototype.shutDownDesktop.call(this,B7);},shutDownServerBased:function(B7){window.FormWrapper.closeWindow(B7);},parseURLFolders:function Bl(CB){var B8=[];var CD=CB.mi.ftree.fd?[].concat(CB.mi.ftree.fd):[];var B7=CB.mi.ftree.fl?[].concat(CB.mi.ftree.fl):[];var CA,CE,B9,CC;for(B9=0;B9<CD.length;B9++){CA=CD[B9];CC={isFolder:true};CC.n=(CA.n===null?"null":CA.n.toString());CC.desc=CA.des;CC.address=CA.address;B8.push(CC);}for(B9=0;B9<B7.length;B9++){CE=B7[B9];CC={isFolder:false};CC.n=(CE.n===null?"null":CE.n.toString());CC.address=CE.address;CC.type=CE.mimetype;CC.desc=CE.des;CC.size=CE.sz;B8.push(CC);}return B8;},importURL:function B4(B9,B8){if(!this.forceImport){this.showPage(AY.pageType.preview);return ;}this.fetchPreview=B8;var CB={url:A1(B9.trim())};var CA=this.model.cubeID;if(CA){CB.reportid=CA;}CB.behaviorFlags=AY.importBehaviorFlag.reserved;if(this.model.operationMode===AY.operationMode.refresh||this.model.operationMode===AY.operationMode.edit){if(mstrApp.isCloudPro){CB.behaviorFlags=AY.importBehaviorFlag.newColumnsSilent|AY.importBehaviorFlag.dataTypeSilent;}}var B7=this;var CC={success:function(CE){var CF=AY.requestFlag.sourceInfo|AY.requestFlag.sheets|AY.requestFlag.preview|AY.requestFlag.mapping|AY.requestFlag.transformations,CD=B7.fetchPreview?0:-1;B7.dataService.set("messageID",CE.msg_id);B7.getImportedData(BB.importSource,CF,CD);},failure:function(CD){B7.displayError(mstrmojo.desc(12776,"Error importing the URL. Please check the URL being imported"),false,CD&&CD.message);}};this.dataService.importURL(CC,CB);},importURLEMMA:function N(B7,B9,B8,CC,CB,CD,CA){this.getImportController().importURL(B7,B9,B8,CC,CB,CD,CA);},createEMMASourceTableMultiSheets:function D(B9,CH,CG,CD,CF,CA,B8){var CB=this,B7,CC;if(!B9){B9={};}if(mstrmojo.all[B8].scriptClass==="mstrmojo.DI.DIHadoop"){B9.xt=B9.xt||AY.xdaType.dataImport;}else{B9.xt=AY.xdaType.dataImport;}B9.dict=A6.getBackendSourceType(CF);var CI=CB.model.importSources[CG].fileName;if(Ao.startsWith(CI,A0)&&CF!==AY.sourceSubtype.cloudElement){B9.dict=AY.backendSourceSubtype.newConnector;}var CE={success:function(CM){var CN=CM.tbid,CK,CP=CB.model.importSources[CG],CO;B9.shtIx=CH;CO=mstrmojo.hash.clone(B9);CO.url=CP.fileName;CB.model.createImportSource(CD,CF,CN);var CJ=CB.model.importSources[CN];mstrmojo.DI.DIHelpers.setTablesrc(CB,B8,CN);CJ.srcTableID=CG;CJ.sheetsInfo=CP.sheetsInfo;function CL(){CB.setDataImportInfoURL(CK,CO,CN);}CK={success:function(CQ){CB.autoMappingSourceTable({failure:function(CR){CB.removeEMMASourceTable(null,{did:CN});CB.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CR&&CR.message);}},CN,CO,CG,CA);},failure:function(){CB.removeEMMASourceTable(null,{did:CN});CB.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CM&&CM.message);}};if(mstrApp.getRootController().rootView.currentPage.pageType===AY.pageType.hadoop){CL();}else{CK.success();}},failure:function(CJ){CB.displayError(mstrmojo.desc(12777,"Error creating EMMA Source Table"),false,CJ&&CJ.message);}};B7=CB.getModel().getImportSource(CG);CC=B7&&B7.dbRoleId;if(CC){this.dataService.createEMMASourceTable({success:function(CJ){CB.getDataService().setDBRole({success:function(){CE.success(CJ);},failure:function(CK){if(CE.failure){CE.failure(CK);}}},{tbid:CJ.tbid,dbrid:CC});},failure:function(CJ){CE.failure(CJ);}},B9);}else{this.dataService.createEMMASourceTable(CE,B9);}},autoMappingSourceTable:function AR(CJ,CI,CB,CK,CC,CD){var CG=this;var CL=CB.shtIx;var CF=CG.model;var CA=CF.importSources;var CH=CA[CI];var B8=CA[CI].sourceInfo;var B7;var B9=[];if(CI){if(!CB){CB={};}CB.tbid=CI;delete CB.xt;}if(CH.fileName&&A6.strStartsWith(CH.fileName.toLowerCase(),"hdfs://")){CB.dbRoleID=CG.hadoopController.dbRoleID;CB.isUrl=true;}if(CH&&(CH.subtype===AY.sourceSubtype.url||CH.subtype===AY.sourceSubtype.samplefile||CH.subtype===AY.sourceSubtype.publicData||CH.subtype===AY.sourceSubtype.cloudElement)){CB.isUrl=true;if(CH.xdaType===AY.xdaType.excel){CB.url=CH.fileName||CH.sourceInfo.url;}}if(B8){CB.behaviorFlags=AY.behaviorChangeFlag.refreshData;}var CE={success:function(){f(CK,CL,CA,true);if(CC!==AY.actions.refreshData&&(CF.operationMode===AY.operationMode.create||(CF.operationMode!==AY.operationMode.create&&!B8))){var CM=j.call(CG,CA);if(CM){B7=B6.call(CG,CA,CC);if(CF.operationMode===AY.operationMode.create){if(B7===1){for(var CN in CA){B9.push(CN);}CG.detectRelationshipSourceTable(null,B9,CC);}}else{if(B7===1){for(var CN in CA){if(!CA[CN].sourceInfo){B9.push(CN);}}CG.detectRelationshipSourceTable(null,B9,CC);}}}}else{CG.detectRelationshipSourceTable(null,[CI],CC);}if(CJ&&CJ.success&&B7!==1){CJ.success();}},failure:function(CN){var CM;f(CK,CL,CA,false);if(CI&&CD){mstrmojo.hash.forEach(CD.files,function(CP,CO){if(CP.tableID===CI){CM=CO;return false;}return true;});}if(CM!==undefined){CD.files[CM].failed=true;CD.files[CM].errRes=CN;CD.idx=CM;}if(mstrApp.isNewConnectorEdit&&parseInt(CN.code,10)===AY.backendError.switchingFileType&&CG.rootView.currentPage.pageType===AY.pageType.emmaPreview){CG.rootView.footer.next.set("enabled",false);CG.rootView.footer.save.set("enabled",false);CD.files[CM].errRes=AQ(CN)+" "+mstrmojo.desc(16032,"You need to cancel and check file type.");}if(CJ&&CJ.failure){CJ.failure(CN);}}};CG.dataService.autoMappingSourceTable(CE,CB);},setDataImportInfo:function Ag(CB,CD,CA,CC,B9,B7){var B8=this;CD.tbid=CB;var CE={success:function(){B8.autoMappingSourceTable(B7,CB,CD,CB,CC,B9);},failure:function(CF){B8.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,CF&&CF.message);}};B8.dataService.setDataImportInfo(CE,CD);},setPartition:function AJ(CD,CF){var CG=this,B8=CG.model.importSources[CD],CA=0,B9=mstrmojo.desc(14707,"Do you want to group these sheets into a single partition table?");if(B8.xdaType===AY.xdaType.excel){var B7=B8.sheetsInfo;var CB,CC=B7.length;var CH=[],CE=[];for(CB=0;CB<CC;CB++){if(B7[CB].selected){CA++;CH.push(B7[CB].name);CE.push(B7[CB].index);}}if(CA>1){mstrmojo.confirm(B9,{confirmBtn:{fn:function(){CG.partitionController.setPartitionExcel(CD,CH,CE);}},cancelBtn:{fn:function(){if(B8&&B8.originalSheetsInfo){B8.sheetsInfo=B8.originalSheetsInfo;}}}});}else{CG.partitionController.setPartitionExcel(CD,CH,CE);}}else{if(B8.xdaType===AY.xdaType.text){this.partitionController.setPartitionURL(CD,CF);}}},setDataImportInfoURL:function Br(B7,CD,B9){var B8=this;var CA=B8.model;CD.tbid=B9;var CB=CA.importSources[B9];var CC=B8.rootView.hadoopPage?B8.rootView.hadoopPage.getDropZone():null;if(CB.fileName&&A6.strStartsWith(CB.fileName.toLowerCase(),"hdfs://")){CD.dbRoleID=B8.hadoopController.dbRoleID;}var CE={success:function(CF){var CG=CA.getImportSource(B9);if(CG){CG.fileName=CD.url;if(CC&&CC.isFolder){CG.isFolder=CC.isFolder(CG.fileName);}}if(CA.operationMode===AY.operationMode.edit){B8.dataService.editEMMASourceTable(B7,{did:B9,tp:AY.cubeRefreshType.replaceTable,exef:AY.tableStatsExecutionAction.forceExecution,bin:1});}else{if(B7.success){B7.success(CF);}}},failure:function(CF){if(B7.failure){B7.failure(CF);}B8.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,CF&&CF.message);B8.sourceSelected(false);}};B8.dataService.setDataImportInfo(CE,CD);},autoDetectPartitionGroups:function Ae(B7,CF,CB,CE){var CD=this,CC=this.model,B8=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship|AY.requestFlag.stateInfo,CA,B9;CA={previewflag:B8};if(CF!==undefined){CA.sheetIndex=CF;}if(!CD.dataService.messageID&&CC.cubeID){CA.reportid=CC.cubeID;}B9={success:function(CJ){if(CB){mstrmojo.array.forEach(CJ.datap,function(CN){CN.isMergedCube=CB;});}var CI=false;if(CE&&CC.refreshToWrangle){CI=true;CC.refreshToWrangle=null;}if(CE){CC.populateEMMA(CJ,B8,undefined,true);}else{CC.populateEMMA(CJ,B8);}var CH,CL,CM=CD.partitionController,CK={onOK:function(){if(CE){var CO={success:function(){if(CI){CC.refreshToWrangle=CC.editingTableId;}mstrmojo.array.forEach(CE,function(CR){if(CR.tid){CC.resetImportSource(CR.tid);}});B7.onOK();},failure:function(CR){CD.displayError(mstrmojo.desc(12778,"Encountered an error when doing auto mapping!"),false,CR.message||"",function(){B7.onCancel();});}},CP=CC.importSources[CC.editingTableId],CQ={tables:JSON.stringify([{tid:CP.tableID}]),flag:16};var CN={success:function(){CD.dataService.autoMap(CO,CQ);},failure:function(CR){B7.onCancel();}};CD.dataService.prepareData(CN,{tables:CC.editingTableId},true);return ;}B7.onOK();},onCancel:function(){var CN=CE?undefined:CJ;B7.onCancel(CN);}};CH=CE?CE.map(function(CO,CN){return CO.tid;}):CC.getAllTableID();var CG=CE&&CE.length>0;CL=CC.detectPartitionGroups(CH,CG);CK.success=CK.onOK;CK.failure=function(CN){CD.displayError(mstrmojo.desc(12391,"Cannot group partitions."),false,CN.message||"",function(){B7.onCancel();});};if(CE&&CL.length<=1){CD.partitionController.setPartition(CC.editingTableId,CE.map(function(CO,CN){return CO.tid;}),CK);return ;}if(CL.length>0&&!CM.isSamePartitionGroups(CL,CC.partitionGroups)){CC.partitionGroups=CL;CM.openPartitionGroupDialog(CL,CK,CG);return ;}CK.onCancel();},failure:function(CG){CD.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};CD.dataService.getImportedData(B9,CA);},detectRelationshipSourceTable:function G(CD,CB,CC){var B8=this,CA=0,B9;var B7={success:function(){CA++;if(CA>=B9){var CE=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship|AY.requestFlag.stateInfo,CG,CF;if(CC===BB.refreshData){CC=CC||AY.actions.importSource;B8.model.importSources[B8.model.currentSource.key].invalidPreview();}CG={onOK:function(){B8.getImportedDataEMMA(CC,CE);},onCancel:function(CH){B8.getImportedDataEMMA(CC,CE,undefined,undefined,undefined,undefined,undefined,CH);}};CF=B8.getModel().getAllTableID();if(!B8.rootView.currentPage.tableID&&!B8.model.isDirectDataAccess&&CF.length>=2){B8.autoDetectPartitionGroups(CG);}else{B8.getImportedDataEMMA(CC,CE);}}},failure:function(CE){B3.call(B8,CE);}};B9=CB.length;CC=CC||AY.actions.importSource;if(CB.length>0){Bh.forEach(CB,function(CE){B8.dataService.detectRelationshipSourceTable(B7,{did:CE});});}},importOAuthReport:function AS(CC,B7,CB,CE,CH,CD){var CG=this.model.externalSources[CC];var B9=this;var CA=AY.requestFlag.sourceInfo|AY.requestFlag.preview|AY.requestFlag.mapping|AY.requestFlag.anyState;if(CC===AY.sourceType.googleDrive||CC===AY.sourceType.dropbox){CA=CA|AY.requestFlag.sheets|AY.requestFlag.transformations;}this.fetchPreview=CH;var B8=CG.getSourceParams();B8.reportAddress=CE;B8.reportDesc=CB;B8.reportMimetype=CD;B8.reportName=B7;if(this.model.cubeID){B8.cubeID=this.model.cubeID;}B8.behaviorFlags=AY.importBehaviorFlag.reserved;if(this.model.operationMode===AY.operationMode.refresh||this.model.operationMode===AY.operationMode.edit){if(mstrApp.isCloudPro){B8.behaviorFlags=AY.importBehaviorFlag.newColumnsSilent|AY.importBehaviorFlag.dataTypeSilent;}}var CF={success:function(CI){B9.dataService.set("messageID",CI.xmlAPIResponse.mid);B9.getImportedData(BB.importSource,CA);},failure:function(){B9.displayError(mstrmojo.desc(12611,"Error importing the selected report."));}};this.dataService.importOAuthReport(CF,B8);},importMultiOAuthReports:function(CG,CF,CL,CI,CA,CK,CH){var CC=this,CE=CC.rootView.currentPage,CB,B7=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;var B9={success:function(){var CM;if(CH){CM=CC.model.getAllTableID();CC.tablesSrc[CH]=A6.findNewElements(CB,CM);}}};var CJ={success:function(){CA=CA||AY.actions.importSource;CC.getImportedDataEMMA(CA,B7,undefined,undefined,undefined,0,B9);},failure:function(CS){var CQ=true,CU="",CN="",CO,CP=[],CM,CT=true;if(CG===AY.sourceType.twitter||CG===AY.sourceType.facebook){if(CS.status){for(CO=0;CO<CS.status.length;CO++){var CR=CS.status[CO].tableID;if(CR){CP.push(CR);}}if(CP.length>0){CC.getImportController().removeMultipleSourceTables(CP);}}}switch(CG){case AY.sourceType.twitter:CN=mstrmojo.desc(12780,"Error importing results from Twitter.");break;case AY.sourceType.facebook:CN=mstrmojo.desc(12781,"Error importing results from Facebook.");break;default:CN=mstrmojo.desc(12782,"Error importing following reports. Please check the files or delete them.");}if(CQ){if(CS.reports&&CS.status&&CS.reports.length===CS.status.length&&CS.reports.length>0){CU="<ul>";Bh.forEach(CS.reports,function(CW,CV){if(CS.status[CV].success===false){CU+="<li>"+Ao.htmlAngles(CW.n)+"<br>"+Ao.htmlAngles(CS.status[CV].errMsg)||" </li>";}else{CT=false;}});CU+="</ul>";}else{if(CS.status&&CS.status.errMsg){CU=Ao.htmlAngles(CS.status.errMsg);}}if(CE.handleImportError){CQ=CE.handleImportError(CS.reports,CS.status,CT);}if(CG===AY.sourceType.twitter||CG===AY.sourceType.facebook||CT){CC.displayError(CN,false,CU);}else{CM={detailErrorMessage:CU,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:mstrmojo.emptyFn};CC.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),null,function(){CA=CA||AY.actions.importSource;CC.getImportedDataEMMA(CA,B7,undefined,undefined,undefined,0,B9);},CM);}}}};var CD={success:function(){if(CG===AY.sourceType.googleDrive||CG===AY.sourceType.dropbox){CC.getImportController().importMultiOAuthFileReports(CG,CK,CF,CJ);}else{if(CG===AY.sourceType.facebook){CC.getImportController().importMultiFBReports(CG,CK,CF,CJ);}else{CC.getImportController().importMultiOAuthReports(CG,CK,CF,CJ);}}},failure:function(CM){CC.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CM.message||"");}};var B8={success:function(){CC.tablesSrc[CH]=[];CB=CC.model.getAllTableID();if(CI){CC.createNewReportInstance(CD);}else{CD.success();}}};if(CH){k(CC.tablesSrc[CH],B8);}else{B8.success();}},refreshDataOAuthReport:function(CA,CE,B9,B8,CD){var B7=this,CC=B7.getModel().getImportSource(B9);var CB={success:function(){var CF=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;CD=CD||AY.actions.importSource;CC.invalidPreview();B7.getImportedDataEMMA(CD,CF);},failure:function(CF){B7.displayError(mstrmojo.desc(12784,"Error importing the report."),false,CF.message);}};if(CA===AY.sourceType.googleDrive||CA===AY.sourceType.dropbox){B7.getImportController().refreshDataOAuthFileReport(CA,CE,B9,B8,B7.getModel().operationMode,CB);}else{B7.getImportController().refreshDataOAuthReport(CA,CE,B9,B8,B7.getModel().operationMode,CB);}},refreshMultiOAuthReports:function(CD,CE,CC,CA){var CB=this,B9=0;var B8={success:function(){CB.getModel().getImportSource(CC[B9].tableID).invalidPreview();B9++;if(B9>=CC.length){CF.success();}else{B7(CC[B9],B8);}},failure:function(CG){CF.failure(CG);}};var CF={success:function(){var CG=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;CA=CA||AY.actions.importSource;CB.getImportedDataEMMA(CA,CG);},failure:function(CG){CB.displayError(mstrmojo.desc(12785,"Error refreshing the report(s)."),false,CG&&CG.message);}};function B7(CG,CH){if(CD===AY.sourceType.googleDrive||CD===AY.sourceType.dropbox){CB.getImportController().refreshDataOAuthFileReport(CD,CE,CG.tableID,CG,CB.getModel().operationMode,CH);}else{CB.getImportController().refreshDataOAuthReport(CD,CE,CG.tableID,CG,CB.getModel().operationMode,CH);}}if(CC.length<=0){CF.failure();}B7(CC[0],B8);},importClipboard:function(CC,CA,CB,CD){var B7=this,CE;var B9={success:function(){B7.getImportController().importClipboard({uploader:CC},{success:function(){var CG=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship,CH;CB=CB||AY.actions.importSource;var CF={success:function(){if(CD){CH=B7.model.getAllTableID();B7.tablesSrc[CD]=A6.findNewElements(CE,CH);}if(CB===AY.actions.importSource){CC.destroy();}}};B7.getImportedDataEMMA(CB,CG,undefined,undefined,undefined,0,CF);},failure:function(CF){B7.displayError(mstrmojo.desc(12609,"Error in importing the file. Please check the file being imported."),false,CF.message);}});},failure:function(CF){B7.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CF.message||"");}};var B8={success:function(){B7.tablesSrc[CD]=[];CE=B7.model.getAllTableID();if(CA){B7.createNewReportInstance(B9);}else{B9.success();}}};if(CD){k(B7.tablesSrc[CD],B8);}else{B8.success();}},refreshDataClipboard:function(B8,CC,CB){var B7=this,CA=B7.getModel().getImportSource(B8);var B9={success:function(){var CD=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;CB=CB||AY.actions.importSource;CA.invalidPreview();B7.getImportedDataEMMA(CB,CD);},failure:function(CD){B7.displayError(mstrmojo.desc(12784,"Error importing the report."),false,CD.message);}};B7.getImportController().refreshDataClipboard(B8,{uploader:CC},B7.getModel().operationMode,B9);},getImportedData:function n(CA,CC,B9,CB){var CD={previewflag:CC};if(CB!==undefined){CD.poll=CB;}if(B9>=0){CD.sheetIndex=B9;}if(CA===BB.refine){CD.refine=32;}var B8=this;var B7=this.model;var CE={success:function(CF){if(CA===BB.refine){B8.refine(CF.rpid);return ;}var CG;if(CA===BB.importSource||CA===BB.changeSheet){if(B7.currentSource){B7.currentSource.reset();}B7.populate(CF,CC);if(B7.operationMode!==AY.operationMode.create){if(B7.currentSource.sheets&&B7.currentSource.sheets.length>1){CG=mstrmojo.all[An];if(!CG){CG=mstrmojo.insert(J);CG.model=B7;CG.open();}else{if(!B8.fetchPreview){B8.saveAndPublish();return ;}}}else{if(!B8.fetchPreview){B8.saveAndPublish();return ;}}}}if(CA===BB.importSource||CA===BB.changeSheet){if(B8.fetchPreview){B8.forceImport=false;B8.showPage(AY.pageType.preview);}if(B7.currentSource){B7.currentSource.reset();}if(CG){CG.destroy();}}var CH=B7.populate(CF,CC);if(CA===BB.importSource){if((CH&AY.requestFlag.preview)!==AY.requestFlag.preview){return ;}}if((CH&AY.requestFlag.mapping)!==AY.requestFlag.mapping){B8.getImportedData(CA,CC,B9,false);return ;}},failure:function(CH){var CG=parseInt(CH.getResponseHeader("X-MSTR-TaskErrorCode"),10);var CF=AY.statusCode;if(CG===CF.mappingError||CG===CF.xformsError||CG===CF.obtainSource){B8.getImportedData(CA,CC,B9,false);}else{if(CG===AY.backendError.fileVersionError){B8.displayError(mstrmojo.desc(12612,"Excel 5.0/7.0 files are not supported. Save the file to Excel version 97/2000/XP/2003 or higher."));}else{if(CG===AY.backendError.salesforceUnsavedReport){B8.displayError(mstrmojo.desc(12786,"Cannot upload data because the Salesforce report Active Accounts has not been saved. Please save the report and try again!"));}else{if(CG===AY.backendError.maxSizeExceeded){B8.displayError(mstrmojo.desc(12787,"The maximum file size for files is #### MB.").replace("####",mstrApp.diParams.UploadSizeLimit));}else{B8.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}}}}}};this.dataService.getImportedData(CE,CD);},getAttributeGroupInfo:function x(B9){var CA={tableID:B9,browsetype:32};var B8=this;var B7=B8.model;var CB={success:function(CC){B7.populateAttributeGroup(CC,B9);},failure:function(CC){B8.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."));}};this.dataService.getImportedData(CB,CA);},getShapekeys:function AN(){var B8=this.getModel();var B7={success:function(CC){if(CC&&CC.ShapeFileMaps&&CC.ShapeFileMaps.ShapeFileMap){var CD=CC.ShapeFileMaps.ShapeFileMap,CA=[],CE,CB,B9=function B9(CH,CG){var CF=CH.n.toLowerCase();var CJ=CG.n.toLowerCase();var CI;if(CF<CJ){CI=-1;}else{if(CF>CJ){CI=1;}else{CI=0;}}return CI;};mstrmojo.array.forEach(CD,function(CF){CE=CF.descWeb;CB=CE?mstrmojo.desc(CE.slice(8)):mstrmojo.string.decodeHtmlString(CF.name).replace(/&apos;/g,"'");CA.push({did:CF.shapeKey,n:CB});});CA.sort(B9);B8.shapeKeys=CA;}}};this.dataService.getShapeKeys(B7,{fileNumber:2});},getCustomConnector:function Ad(){var B8=this.getModel();var B7=this;var B9={typeFilter:AY.dbType.newConnector,taskId:"arch.getCustomConnector",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:AY.dbType.newConnector};var CA={success:function(CB){var CC=[];var CE=[];var CD=Bp.walk("connectorConfig.resourceConfig",mstrApp.diParams);Bh.forEach(CB.els,function(CJ){if(Bh.find(B8.sourceItems,"oid",CJ.oid)<0){var CF,CI,CH;CF=Bp.copy(B8.customConnector,CF),CH=CD&&Array.prototype.indexOf.call(CD,CJ.oid)<0;var CG=CJ.url,CK=AY.authModePrefix,CL=AY.authMode;if(A6.strStartsWith(CG,CK.USERNAME)){CG=CG.substring(CK.USERNAME.length);CG=CG.substring(0,CG.length-1);CI=CL.USERNAME;}else{if(A6.strStartsWith(CG,CK.OAUTH)){CG=CG.substring(CK.OAUTH.length);CG=CG.substring(0,CG.length-1);CI=CL.OAUTH;}else{if(A6.strStartsWith(CG,CK.ANONYMOUS)){CG=CG.substring(CK.ANONYMOUS.length);CG=CG.substring(0,CG.length-1);CI=CL.ANONYMOUS;}}}B8.staticSourceList.push({n:CJ.n,url:CG,oid:CJ.oid,user:CJ.user,pageType:AY.pageType.newConnector,initial:/[a-z]/i.test(CJ.n.charAt(0))?CJ.n.charAt(0).toUpperCase():"Others",checkConectivity:true,dbObjectsDisplayOptions:8,tags:["Customized"],oneTier:true,privilege:AY.privilegeType.accessDatabase,title:function(){var CM="";if(!mstrApp.diParams.EnableURLImport){CM=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){CM=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}}return CM;},isEnabled:function(){return mstrApp.diParams.EnableURLImport;},sourceInfo:{sourceType:AY.sourceType.bisource,name:"New connector",type:500,subtype:AY.sourceSubtype.bisource}});CE.push(B8.staticSourceList[B8.staticSourceList.length-1]);CC.push(Bp.copy({n:CJ.n,url:CG,connectorDesc:BU(CJ.desc,"desc"),introductionUrl:BU(CJ.desc,"introduction"),iconData:window.atob&&window.atob(CJ.iconData)||"",oid:CJ.oid,type:CI,user:CJ.user,pwd:CJ.pwd,oneTier:true,selected:CH},CF));}});if(CC.length){B8.set("sourceItems",B8.sourceItems.concat(CC));B8.set("customConnectorDBRoles",CB.els);}B8.addfromStaticSources(CE);B8.sortSourceList();B8.raiseEvent({name:AY.srcItemTypes.CUSTOM_CONNECTOR,src:B8});}};mstrApp.serverRequestQueue(B9,CA,t);},getSheetsInfo:function z(B8,CD,CE,CA,CB){var B9={tableID:CD,previewflag:CE};var CC=this;var B7=CC.model;var CF={success:function(CJ){var CH=function(CN){if(CN==="*"){return false;}return true;};var CL=CJ.datap.shts,CG=mstrmojo.array.filter(CL,CH);var CK;var CI=false;for(CK=0;CK<CL.length;CK++){if(CL[CK]!=="*"){CI=true;break;}}if(!CI){CF.failure(mstrmojo.desc(15810,"The file being imported is not supported or the file might be corrupted. Please check the URL and the file."));return ;}if(CG.length<2){if((CE&AY.requestFlag.sheets)===AY.requestFlag.sheets){B7.importSources[CD].populateSheets(CJ.datap.shts,CK);}var CM={shtIx:CK};CC.autoMappingSourceTable(B8,CD,CM,CD,CA,CB);}else{if((CE&AY.requestFlag.sheets)===AY.requestFlag.sheets){B7.importSources[CD].originalSheetsInfo=B7.importSources[CD].sheetsInfo;B7.importSources[CD].populateSheets(CJ.datap.shts,CK);}if(B8){B8.success();}}},failure:function(CG){CB.files[CB.idx].failed=true;CB.files[CB.idx].errRes=CG;if(B8){B8.failure();}}};this.dataService.getImportedData(CF,B9);},getImportedDataEMMA:function X(CD,CC,CJ,B8,CH,B7,CA,CE){var CF=this,B9=CF.getModel(),CG;var CB={previewflag:CC};if(B8!==undefined){CB.poll=B8;}if(CJ>=0){CB.sheetIndex=CJ;}if(CH){CB.tableID=CH;}if(!this.dataService.messageID&&this.model.cubeID){CB.reportid=this.model.cubeID;}var CI={success:function(CS){var CK,CO,CT,CL,CQ,CM,CN=null,CR,CP;if(CD===BB.refine){CK=B9.importSources[CH];CK.projectID=CS.datap.srce.rimp.rpid;CF.refine(CK.projectID,CH);return ;}if(CD===BB.getFlatPreview){B9.populateEMMA(CS,CC,CH,true);CF.raiseModelEvent({name:"FlatPreviewFetched"});return ;}CP=B9.populateEMMA(CS,CC,CH,CD===BB.quickPreview);if(CD===BB.savePublish){if(CF.dialogController.pageZIndex>0){CF.rootView.parent.close();}window.setTimeout(function(){CF.saveAndPublish();},0);return ;}for(CO=0;CO<CS.datap.length;CO++){CQ=CS.datap[CO].state;if(CQ&&CQ.errc===AY.backendError.refineApplyError){CF.displayError(CQ.emsg);}}CT=B9.getAllTableID();CR=CF.model.currentSource;if(CD===BB.importSource){CN=CT[CF.dialogController.pageZIndex>0?CT.length-1:0];}else{if(CD===BB.none||CD===BB.refreshData){if(CR&&Bh.indexOf(CT,CR.tableID)>=0){CN=CR.tableID;}else{if(CT.length>0){if(CF.dialogController.pageZIndex===0){CN=CT[0];}}}}}CL=CC|AY.requestFlag.preview|AY.requestFlag.transformations;if(CH===undefined&&CT.length>0&&CD===BB.quickPreview&&CN!==CT[CT.length-1]){CK=B9.getImportSource(CT[CT.length-1]);CM=false;if(CK&&CK.currentTransformations&&CK.currentTransformations.xtab&&CK.currentTransformations.xtab.isCrosstab){CM=!!CK.currentMapping&&!!CK.transformedPreview;}else{if(CK){CM=!!CK.currentMapping&&!!CK.currentPreview&&!(CD===BB.quickPreview);}}if(!CM){if(CK&&CK.currentTransformations&&CK.currentTransformations.xtab&&CK.currentTransformations.xtab.isCrosstab){CL=CL&(~AY.requestFlag.preview);CL|=AY.requestFlag.transformedPreview;}else{CL=CL&(~AY.requestFlag.transformedPreview);CL|=AY.requestFlag.preview;}if(CK.type===AY.sourceType.querybuilder){CL=CL&(~AY.requestFlag.sheets);CL=CL&(~AY.requestFlag.transformations);CL=CL&(~AY.requestFlag.sourceInfo);}if(CK.type===AY.sourceType.twitter){CL=CL&(~AY.requestFlag.sheets);}if(CK.subtype===AY.sourceSubtype.googleBigQuerySingleTable){CL=775;}if(CK.databaseType===h&&CK.xdaType===AY.xdaType.qbSingleTable){CL=CL&(~AY.requestFlag.preview);}CF.getImportedDataEMMA(CD,CL,CJ,B8,CT[CT.length-1]);return ;}}if(CD===BB.importSource||CD===BB.changeSheet||CD===BB.refreshData){CF.forceImport=false;CF.showPage(AY.pageType.emmaPreview,null);}if(CN){window.setTimeout(function(){CF.selectSourceTable(CN);},0);}if(CD===BB.quickPreview){CF.raiseModelEvent({name:AY.dataEvents.DATA_PREVIEW_EVENT,data:CH});return ;}if(CD===BB.transform){B9.currentSource.currentTransformations.xtab.set("isCrosstab",true);CF.raiseModelEvent({name:"changeToXtab"});}if(CD===BB.importSource||CD===BB.refreshData){if((CP&AY.requestFlag.preview)!==AY.requestFlag.preview){return ;}}if((CP&AY.requestFlag.mapping)!==AY.requestFlag.mapping){CF.getImportedDataEMMA(CD,CC,CJ,false);return ;}},failure:function(CM){var CL=parseInt(CM.code||(CM.getResponseHeader?CM.getResponseHeader("X-MSTR-TaskErrorCode"):-1),10),CK=AY.statusCode;if(CL===CK.mappingError||CL===CK.xformsError||CL===CK.obtainSource){CF.getImportedDataEMMA(CD,CC,CJ,false);}else{var CN;if(CH){CN=CF.getImportController().handleImportError(CM,B9.importSources[CH].dbTableName);}CF.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CN);}}};CG=mstrmojo.func.wrapMethods(CI,CA,{});if(CE===undefined){this.dataService.getImportedData(CG,CB);}else{CG.success(CE);}},fetchCubeInfo:function AK(){var CB=AY.requestFlag.sourceInfo|AY.requestFlag.mapping|AY.requestFlag.anyState,CA=this.model,B9=this,B8=this.rootView,B7=mstrApp.diParams.StatusCode;if(B7===AY.statusCode.xformsError||B7===AY.statusCode.mappingError){CB=AY.requestFlag.sourceInfo|AY.requestFlag.mapping|AY.requestFlag.preview|AY.requestFlag.sheets|AY.requestFlag.transformations|AY.requestFlag.anyState;}var CD={success:function(CE){if(mstrApp.isEMMACube){CA.populateEMMA(CE,CB);}else{CA.populate(CE,CB);}switch(mstrApp.diParams.StatusCode){case AY.statusCode.xformsError:B8.showPage(AY.pageType.preview);break;case AY.statusCode.mappingError:B8.showPage(AY.pageType.preview);break;default:if(CA.currentSource.type===AY.sourceType.file&&CA.currentSource.subtype!==AY.sourceSubtype.samplefile&&CA.currentSource.subtype!==AY.sourceSubtype.publicData){B8.showPage(AY.pageType.file,CA.currentSource.subtype-1);}else{if(CA.currentSource.subtype===AY.sourceSubtype.samplefile){B8.showPage(AY.pageType.sampleFiles);}else{if(CA.currentSource.subtype===AY.sourceSubtype.publicData){B8.showPage(AY.pageType.publicData);}else{if(CA.currentSource.type===AY.sourceType.salesforce||CA.currentSource.type===AY.sourceType.googleDrive||CA.currentSource.type===AY.sourceType.dropbox||CA.currentSource.type===AY.sourceType.googleAnalytics){if(mstrApp.diParams.StatusCode){B9.getOAuthSourceReports(CA.currentSource.type,false);}}}}}break;}},failure:function(CE){B9.displayError(CE.getResponseHeader("X-MSTR-TaskFailureMsg"));}};var CC={reportid:this.model.cubeID,previewflag:CB};if(mstrApp.isEMMACube){this.dataService.getImportedDataEMMA(CD,CC);}else{this.dataService.getImportedData(CD,CC);}},handleSecurityFilterAccess:function(B8){var B7=this,B9=mstrmojo.desc(16017,"You need write access to cube # to the operation, because the cube have security filter or shared attribute associated.").replace("#",B8),CA=function(){B7.exitApplication();};B7.displayError(B9,false,undefined,CA);},fetchCubeInfoEMMA:function(){var B7=this,B9=B7.model,CB=AY.requestFlag.sourceInfo|AY.requestFlag.mapping|AY.requestFlag.relationship,CA=null,B8=null,CC;var CE={success:function(CH){B9.writable=CH.writable;B9.copyable=CH.copyable;if(CH.copyable===0){B7.handleSecurityFilterAccess(B9.cubeName);return ;}B9.populateEMMA(CH,CB);if(!B7.checkAndShowPrivilegeMsg()){return ;}mstrmojo.hash.forEach(B9.importSources,function(CI){if(CI.xdaType===AY.xdaType.mdx){B8=CI;return false;}});if(B8){CC=mstrApp.diParams;B7.showPage(AY.pageType.database,{sourceType:B8.type,type:B8.xdaType,extParams:{tableID:B8.tableID,cubeName:CC.CubeName,cubeDesc:CC.CubeDesc,folderID:CC.FolderId,reportID:CC.ReportId}});return ;}CA=B9.getAllTableID();if(CA.length<=0){B7.showPage(AY.pageType.dataSelection);return ;}else{B7.showPage(AY.pageType.emmaPreview,null,null);}if(B9.isDirectDataAccess===false){var CF=B7.getDDAController().checkIfDDA(B9.cubesInfo.cubes);var CG=B7.getDDAController().canSupportDDA();if(CF&&CG){B9.set("isDirectDataAccess",true);B9.weakDDA=true;}}B7.selectSourceTable(CA[0]);},failure:function(CF){B7.displayError(mstrmojo.desc(12793,"Fetch cube info failed."),false,CF.message||"",function(){B7.cancelApplication();});}};var CD={success:function(CF){if(CF&&CF.msgid){B7.dataService.set("messageID",CF.msgid);}B7.dataService.getImportedData(CE,{previewflag:CB,browsetype:AY.browseFlag.dataPreview|AY.browseFlag.publish|AY.browseFlag.reportBindingTable|AY.browseFlag.reportLevelProperty});},failure:function(CF){B7.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CF.message||"",function(){B7.cancelApplication();});}};if(mstrApp.isSingleTier){B7.dataService.duplicateReportInstance(CD,{datasetID:B9.cubeID});}else{if(B9.analysisID){B7.dataService.duplicateReportInstance(CD,{datasetID:B9.cubeID,messageID:B9.analysisID});}else{B7.dataService.createEMMAReportInstance(CD,{reportID:B9.cubeID});}}},duplicateSelectedDataset:function(CE){var CC=this,CB=CC.getModel(),CD=CC.dataService,B9=AY.requestFlag.sourceInfo|AY.requestFlag.mapping|AY.requestFlag.relationship,B8=CB.currentDataset,CF=false,B7={success:function(CI){var CL=null,CJ=false,CH=false,CK=false,CG=0,CN="",CM=function(){CD.set("messageID",null);CB.resetImportSource();if(CB.datasets&&CB.datasets.length){CB.selectDataset(CB.datasets[0]);}CC.showPage(AY.pageType.dataSelection);};CB.populateEMMA(CI,B9);CL=CB.getAllTableID();Bh.forEach(CL,function(CP){var CO=CB.getImportSource(CP);if(CO&&CO.xdaType===AY.xdaType.mdx){CJ=true;CN=mstrmojo.desc(13320,"We do not allow add to operation on cubes that have sources based on MDX.");}if(CO&&CO.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){CH=true;CN=mstrmojo.desc(13321,"We do not allow add to operation on cubes that have sources based on Solr.");}if(CO&&CO.type===AY.sourceType.remoteProject){CK=true;CN=mstrmojo.desc(13322,"We do not allow add to operation on cubes that have sources based on MicroStrategy Project.");}if(CO&&CB.isDDAOnlySource(CO.subtype)){CG++;}});if(CJ||CH||CK){CC.displayError(CN,false,null,CM);}else{CB.set("isDirectDataAccess",CB.isDirectDataAccess&CC.getDDAController().canSupportDDA());CB.set("cubeID",B8.did);CB.set("cubeName",B8.name);CB.set("cubeDesc",B8.dsc);CB.set("operationMode",AY.operationMode.edit);if(CE&&CE.success){CE.success(CI);}}}},CA={success:function(CG){CF=true;if(CG&&CG.msgid){CD.set("messageID",CG.msgid);}CD.getImportedData(B7,{previewflag:B9});},failure:function(CG){if(CE.failure){CE.failure(CG);}},complete:function(){if(!CF&&CE.complete){CE.complete();}}};if(!B8||!B8.did){if(CE.success){CE.success();}if(CE.complete){CE.complete();}}CD.duplicateReportInstance(CA,{datasetID:B8.did,messageID:CB.analysisID});},getRepublishInfoEMMA:function(){var B7=this,B9=B7.model,CA=AY.requestFlag.sourceInfo|AY.requestFlag.mapping,B8=AY.browseFlag.dataPreview|AY.browseFlag.publish|AY.browseFlag.reportBindingTable|AY.browseFlag.reportLevelProperty;var CB={success:function(CL){var CG,CF=false,CD=false,CP=false,CH=false,CM=0,CK=0,CE,CI;B9.writable=CL.writable;B9.copyable=CL.copyable;B9.populateEMMA(CL,CA);var CC=B9.isFromPushApi();if(!B7.checkAndShowPrivilegeMsg()){return ;}if(B9.isDirectDataAccess===false){var CO=B7.getDDAController().shouldSupportDDA();if(CO){B9.set("isDirectDataAccess",true);}}CG=B9.getAllTableID();CE=CG.length;Bh.forEach(CG,function(CR){var CQ=B9.getImportSource(CR);if(CQ&&CQ.xdaType===AY.xdaType.mdx){CF=true;CI=mstrmojo.desc(13278,'A schedule cannot be created on this dataset as all its tables are from the "OLAP Sources" connector which is only supported in the Connect Live? Mode.');}if(CQ&&CQ.databaseType===mstrmojo.warehouse.EnumDatabaseType.SearchEngineSOLR){CD=true;CI=mstrmojo.desc(13279,'A schedule cannot be created on this dataset as all its tables are from the "Search as a Source" connector which is only supported in the Connect Live? Mode.');}if(CQ&&CQ.type===AY.sourceType.remoteProject){CP=true;CI=mstrmojo.desc(13323,'A schedule cannot be created on this dataset as all its tables are from the "MicroStrategy Project" connector which is only supported in the Connect Live? Mode.');}if(CQ&&CQ.xdaType===AY.xdaType.qbSingleTable&&CQ.databaseType===4000){CH=true;CI=mstrmojo.desc(14206,"A schedule cannot be created on this dataset as all its tables are from HANA which is only supported in the Connect Live? Mode.");}if(CQ&&CQ.type===AY.sourceType.file){if(CQ.subtype===AY.sourceSubtype.clipboard||CQ.subtype===AY.sourceSubtype.localFile){CM++;}}if(CQ&&B9.isDDAOnlySource(CQ.subtype)){CK++;}});if(B9.operationMode===AY.operationMode.refresh){if(A6.isRefreshable(B9)){if(CF){B7.displayError(mstrmojo.desc(13264,'We do not allow the "Publish" operation on cubes that access OLAP sources.'),false,null,function(){B7.cancelApplication();});}else{if(CD){B7.displayError(mstrmojo.desc(13265,"We do not allow publish operation on cubes that have sources based on Solr."),false,null,function(){B7.cancelApplication();});}else{if(CH){B7.displayError(mstrmojo.desc(14207,"We do not allow publish operation on cubes that have sources based on HANA."),false,null,function(){B7.cancelApplication();});}else{if(CC){CI=mstrmojo.desc(14869,"The in-memory dataset cannot be republished as it contains a table that was created via the MicroStrategy Data Push api.");if(A6.isWS()){B7.displayError(CI,false,null,function(){if(A6.getEnvObj().isDIinVI()){Aq.call(B7);}},"",mstrmojo.desc(15207,"This dataset cannot be refreshed."),false);}else{B7.displayError(CI,false,null,function(){B7.cancelApplication();});}}else{B7.showDialog(AY.dialogType.publishStatusDialog,{model:B9});}}}}}else{B7.displayError(mstrmojo.desc(13280,"Administrator has disabled importing a file from a URL."),false,null,function(){B7.cancelApplication();});}}if(B9.operationMode===AY.operationMode.subscribe){if(CM===CE||CC){CI=mstrmojo.desc(14870,'A schedule cannot be created on this dataset as all its tables either require manual input, as they were built from the "File From Disk" or "Clipboard" connectors, or are created via the MicroStrategy Data Push api.');if(A6.isWS()){B7.displayError(CI,false,null,null,"",mstrmojo.desc(15208,"Schedule cannot be created on this dataset."),false);}else{B7.displayError(CI,false,null,function(){B7.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}}else{if(CK===CE){B7.displayError(CI,false,null,function(){B7.cancelApplication();},mstrmojo.desc(13282,"Cannot Create Schedule"));}else{var CJ=false,CN;Bh.forEach(CG,function(CQ){CJ=B9.importSources[CQ]&&B9.importSources[CQ].subtype===AY.sourceSubtype.cloudElement&&!(B9.cloudElementDBRoles&&B9.cloudElementDBRoles.length>0);if(CJ){CN={success:function(){B7.getScheduleController().launchScheduleEditor();}};B7.getCloudElementDBRoles(CN);return false;}});if(!CJ){B7.getScheduleController().launchScheduleEditor();}}}}},failure:function(CC){B7.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CC.message,function(){mstrApp.getRootController().cancelApplication();});}};if(B9.operationMode===AY.operationMode.subscribe){B8=AY.browseFlag.dataPreview;}B7.dataService.getImportedData(CB,{previewflag:CA,browsetype:B8});},republishEMMACube:function(){var B7=this;var B8=B7.model;var B9={success:function(CA){if(CA&&CA.msgid){B7.dataService.set("messageID",CA.msgid);}if(CA.publishInfo){var CB=JSON.parse(CA.publishInfo);B7.model.requestId=CB.requestId;B7.model.appSchemaTables=CB.data;B7.model.workspaceId=CB.workspaceId;}B7.getRepublishInfoEMMA();},failure:function(CA){if(A6.isWS()){B7.displayError(null,false,CA.message||"",null,"",mstrmojo.desc(12794,"Run EMMA cube error."),false);}else{B7.displayError(mstrmojo.desc(12794,"Run EMMA cube error."),false,CA.message||"",function(){mstrApp.getRootController().cancelApplication();});}}};if(mstrApp.isSingleTier){B7.dataService.duplicateReportInstance(B9,{datasetID:B8.cubeID});}else{if(B8.analysisID){B7.dataService.duplicateReportInstance(B9,{datasetID:B8.cubeID,messageID:B8.analysisID});}else{B7.dataService.createEMMAReportInstance(B9,{reportID:B8.cubeID});}}},fetchSampleFileList:function AZ(){var B7=this.model;var B8={success:function(B9){B7.sampleFiles=B9.samplefiles.file;}};},getDIProjectSettings:function BM(B7){var B8=this;var B9={success:function(CA){if(!mstrApp.sessionManager){mstrApp.projectName=mstrConfig.projectName;mstrApp.serverName=mstrConfig.serverName;mstrApp.serverPort=mstrConfig.serverPort;mstrApp.authMode=mstrConfig.authMode;mstrApp.enableAutomaticSessionRecovery=CA.enableAutomaticSessionRecovery;mstrApp.maxSessionIdleTime=CA.maxSessionIdleTime;mstrApp.timeBeforeSessionTimeoutWarning=CA.timeBeforeSessionTimeoutWarning;mstrApp.enableWarningSessionTimeout=CA.enableWarningSessionTimeout;if(!A6.getEnvObj().isWS()){mstrApp.startSessionManager();}}mstrmojo.hash.copy(CA,mstrApp.diParams);},failure:function(){B8.oAuthController.getExternalSourcesInfo();}};this.dataService.getDIProjectSettings(mstrmojo.func.wrapMethods(B9,B7,{success:function(CB){var CD=mstrmojo.desc(13991,'The Project is locked because it is being used by "###". The EMMA Cube cannot be opened until the Project is no longer in use.'),CA=null;if(CB&&CB.projectLocked){B8.displayError(CD.replace("###",CB.projectLockedOwner),false,null,function(){B8.cancelApplication();});return ;}if(CB&&CB.connectorConfig){try{CA=JSON.parse(CB.connectorConfig);}catch(CC){console.log("Invalid DI connector configuration");}mstrApp.diParams.connectorConfig=CA;if(CA&&(CA.resourceConfig||CA.dbRoleConfig)){B8.getModel().populateSourceListAdminConfig(CA.resourceConfig,CA.dbRoleConfig);}}B8.oAuthController.getExternalSourcesInfo();}}));},getDBMSObjects:function AC(){var B7=this;var B9={success:function(CA){if(CA.DBInfo){B7.model.populateDBRoles(CA.DBInfo);}},failure:function(CA){B7.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,CA.message);}};var B8={taskId:"arch.getDBObjects",flags:8};mstrApp.serverRequestQueue(B8,B9,t);},editImportedData:function m(B9,CH,B7,CC,CF,B8,CD){if(mstrApp.isEMMACube){this.editImportedDataEMMA(B9,CH,B7,CC,CD);return ;}var CA={shtIx:CH};var CE=this.model.currentSource.type;if(CE===AY.sourceType.dropbox||CE===AY.sourceType.googleDrive){var CI=this.model.externalSources[CE];CA=CI.getSourceParams();CA.shtIx=CH;}if(B7){CA.chs=B7;}if(CC){CA.trans=CC;}if(this.model.currentSource.subtype===AY.sourceSubtype.url||this.model.currentSource.subtype===AY.sourceSubtype.samplefile||this.model.currentSource.subtype===AY.sourceSubtype.publicData||this.model.currentSource.subtype===AY.sourceSubtype.cloudElement){CA.isUrl=true;}CA.behaviorFlags=AY.importBehaviorFlag.reserved;if(this.model.operationMode===AY.operationMode.refresh||this.model.operationMode===AY.operationMode.edit){if(mstrApp.isCloudPro){CA.behaviorFlags=AY.importBehaviorFlag.newColumnsSilent|AY.importBehaviorFlag.dataTypeSilent;}}if(CF){CA.refine=CF;if(B8===0){CA.flags=536870920;}else{CA.flags=0;}}var CB=this;var CG={success:function(CJ){CB.dataService.set("messageID",CJ.msg_id||CJ.msgid);if(B8===0){CB.getImportedData(BB.refine,B9,CH,undefined,1);}else{if(CB.model.operationMode!==AY.operationMode.create&&!B7&&!CC){CB.getImportedData(BB.changeSheet,B9,CH,undefined,CB.model.currentSource.tableID);}else{CB.getImportedData(BB.editImport,B9,CH,undefined,CB.model.currentSource.tableID);}}},failure:function(){CB.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."));}};this.dataService.editImportedData(CG,CA);},editImportedDataEMMA:function BC(CD,CC,CJ,B7,B8,CA,CO,CI,CK,CN,CG){var CH,CM={};if(B8){CH=this.model.importSources[B8];CC=CH.currentIndex;}else{CH=this.model.currentSource;B8=CH.tableID;}if(CC>=0){CM.shtIx=CC;}var B9=CH.type;if(CH.type===AY.sourceType.googleDrive||CH.type===AY.sourceType.dropbox||CH.type===AY.sourceType.salesforce||CH.type===AY.sourceType.twitter||CH.type===AY.sourceType.facebook||CH.type===AY.sourceType.googleAnalytics){var CE=this.model.externalSources[B9];CM=CE.getSourceParams();}if(CJ){CM.chs=CJ;}if(B7){CM.trans=B7;}if(CH.subtype===AY.sourceSubtype.url||CH.type===AY.sourceType.hadoop||CH.subtype===AY.sourceSubtype.samplefile||CH.subtype===AY.sourceSubtype.publicData||CH.subtype===AY.sourceSubtype.cloudElement){CM.isUrl=true;}if(CH.subtype===AY.sourceSubtype.querybuilder||(CH.type===AY.sourceType.querybuilder&&CH.subtype===AY.sourceSubtype.hadoop)){CM.isDB=true;CM.dbTableName=CH.sourceInfo.dbTableName;CM.dbRoleID=CH.sourceInfo.dbRoleId;if(CH.sourceInfo.dbNamespace){CM.dbNamespace=CH.sourceInfo.dbNamespace;}}if(CA||CA===0){CM.sr=CA;}if(CO){CM.dlmt=CO;}if(CI){CM.qt=CI;}CM.behaviorFlags=AY.importBehaviorFlag.reserved;if(this.model.operationMode===AY.operationMode.refresh||this.model.operationMode===AY.operationMode.edit){if(mstrApp.isCloudPro){CM.behaviorFlags=AY.importBehaviorFlag.newColumnsSilent|AY.importBehaviorFlag.dataTypeSilent;}}if(CN){CM.behaviorFlags|=AY.behaviorChangeFlag.refreshData;}else{CM.behaviorFlags|=AY.behaviorChangeFlag.remapping;}var CF=this;var CL={success:function(){CF.getImportedDataEMMA(BB.none,CD,CC,undefined,B8,null,CG);},failure:function(CP){CF.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CP.message||"");}};var CB={success:function(CP){if(CP&&CP.msgid){CF.dataService.set("messageID",CP.msgid);}CF.dataService.detectRelationshipSourceTable(CK||CL,{did:B8||CF.model.currentSource.tableID});},failure:function(CP){CF.displayError(mstrmojo.desc(12626,"Error when making modifications to the imported data."),false,CP.message||"");CF.handleImportEMMAerror(CP.code);}};CM.tbid=B8;this.dataService.autoMappingSourceTable(CB,CM);},handleImportEMMAerror:function(B7){var B8=mstrApp.getRootController();B7=parseInt(B7,10);if(B7===undefined||B7===null){return ;}if(B7===AY.backendError.emptySheet){B8.rootView.footer.next.set("enabled",false);}},openRefreshOptions:function p(){var B9=this.model.refresh_opt,B7;if(B9==="2"){B7=2;}else{if(B9==="4"){B7=1;}else{B7=0;}}var B8=mstrmojo.all[Bx];if(!B8){B8=mstrmojo.insert(d);B8.model=this.model;B8.render();}B8.radiolist.set("selectedIndex",B7);B8.open();},loadProject:function Az(CA,B8){var CG,CD,B9=0,CC=0,CB=0,B7,CE,CF;CG={};CD={success:function(CH){if(!CH||!CH.servers){return ;}for(CC=0;CC<CH.servers.length;CC++){B7=CH.servers[CC];if(B7&&B7.projects){for(CB=0;CB<B7.projects.length;CB++){CE=B7.projects[CB];if(CE){CA[B9]={nt:"\\\\"+B7.name+"\\"+CE.name,n:CE.name,id:CE.id,sn:B7.name,port:B7.port};if((CE.name===mstrApp.projectName)&&(B7.name===mstrApp.serverName)){CA[B9].ls=true;CA[B9].ss=mstrApp.sessionState;CF=B9;}else{CA[B9].ls=false;CA[B9].ss=null;}B9++;}}}}B8.set("items",CA);B8.set("selectedIndex",CF);B8.set("text",CA[CF].nt);},failure:function(CH){mstrmojo.alert(CH.getResponseHeader("X-MSTR-TaskFailureMsg"));}};this.dataService.loadProject(CD,CG);},loginProjects:function Q(CA,CB){var B8=1,CC=CA.parent,CE=CA.mstrUserAlias.value,CH=CA.mstrPasswordAlias.value,CD=CA.loginErrorBoxAlias,B9=CC.selectedIndex,B7=CC.port,CG={userid:CE,server:CC.serverName,password:CH,project:CC.projectName,authMode:B8,port:B7},CF={success:function(CI){CB[B9].ls=true;CB[B9].ss=CI.sessionState;CD.set("visible",false);CC.close();CC.projectListNode.set("selectedIndex",B9);},failure:function(CI){CD.set("visible",true);CD.errorMsgAlias.set("text",mstrmojo.desc(422));}};this.dataService.loginProject(CF,CG);},getPublishController:function Bf(){if(this.publishController===undefined){this.publishController=new mstrmojo.DI.controller.DIPublishController();}return this.publishController;},saveAndPublish:function M(){var B7={success:this.getPublishController().saveAndPublish.bind(this.getPublishController())};if(!A2.call(this,B7)){B7.success();}},publishNonEmmaCube:function AI(CA){var B8=this;var CC={success:function CB(){B8.displayError(mstrmojo.desc(14096,"The cube was published successfully!"),false,null,function(){var CG,CE,CF,CD,CH={did:CA};if(mstrApp.refreshMultipleCubes){CG=B8.getModel();CG.publishedDatasets.push(CH);CE=CG.cubesInfo;CF=CE&&CE.cubes&&CE.cubes.cube;CD=Bh.find(CF,"cube_id",CA);if(CD>=0){CF.splice(CD,1);CG.raiseEvent({name:"cubesInfoChange"});}}});},failure:function B9(CD){B8.displayError(mstrmojo.desc(14097,"There was an error publishing the cube."),false,CD.message||"");}};var B7={success:function(CD){switch(parseInt(CD.status)){case AY.cubePollStatus.msgID:case AY.cubePollStatus.result:case AY.cubePollStatus.xmlResult:CC.success();break;case AY.cubePollStatus.prompt:CC.failure();break;case AY.cubePollStatus.error:CC.failure();break;default:B8.dataService.pollStatus(B7,{msgID:CD.id,stateID:parseInt(CD.st)});break;}},failure:function(CD){CC.failure(CD);}};this.dataService.publishNonEmmaCube(B7,{reportID:CA});},save:function BO(){var B7={success:this.getPublishController().save.bind(this.getPublishController())};if(!A2.call(this,B7)){B7.success();}},handleMissingColumns:function BS(B7){this.getPublishController().handleMissingColumns(B7);},handleRepublishError:function Aa(B7){this.getPublishController().handleRepublishError(B7);},cancelRepublishError:function Bt(B7){this.getPublishController().cancelRepublishError(B7);},exitApplication:function Bw(){if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{Aq.call(this,this.model.cubeID);}},exitApplicationRefreshMultipleCubes:function(){var B7=this;if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){var B9=B7.model.publishedDatasets;B7.dialogController.close(AY.dialogType.publishStatusDialog);B7.dialogController.destroyAll();var B8=mstrApp.container;if(B8){mstrApp.container.close();if(B8.dataImportCallback){B8.dataImportCallback(B9);}}},0);}},cancelApplication:function Bq(){var B7=this,B8=this.getModel();if(mstrApp.serverProxy){mstrApp.serverProxy.cancelRequests();}mstrmojo.xhr.cancel();if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}else{window.setTimeout(function(){B7.dialogController.close(AY.dialogType.publishStatusDialog);B7.dialogController.destroyAll();var B9=mstrApp.container;if(B9){if(!B8.hasMergedReportInstance){mstrApp.container.close();if(B9.dataImportCallback){B9.dataImportCallback();}}else{mstrApp.container.close();}}else{if(mstrApp.isSingleTier){B7.shutDownDesktop();}else{if(A6.isServerBasedWS()){B7.shutDownServerBased("{}");}else{mstrApp.redirectToPage(Al.getRedirectParams(Al.pageRedirect.flashVI,B7.model.cubeID,B7.model.isDirectDataAccess));}}}},100);}},wrapUpDataImport:function BZ(CF){var CC=this,CB=this.model,CG=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship,B9,CA,CE;if(CF===undefined){CF=true;}var B7={success:function(){CB.hasMergedReportInstance=true;if(CB.operationMode===AY.operationMode.create&&(CB.isManagedCube||mstrApp.isSingleTier)){CC.docController.renameDataset((CB.curDataset&&CB.curDataset.id)?CB.curDataset.id:CB.cubeID,CB.cubeName,{success:function(){Aq.call(CC,CB.cubeID);}});}else{Aq.call(CC,CB.cubeID);}},failure:function(CH){mstrApp.hideProgress();CC.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,CH&&CH.message);}};this.dialogController.close(AY.dialogType.publishStatusDialog);function CD(){CC.dataService.duplicateReportInstance(B7,{messageID:CB.analysisID,datasetID:(CB.curDataset&&CB.curDataset.id)?CB.curDataset.id:CB.cubeID,duplicateRIMsgID:CC.dataService.messageID});}function B8(){var CH=CC.getDocController(),CI=CC.getDocController().getVIModelDatasets();CH.createNewManagedDataset({success:function(CJ){var CK=[],CL;Bp.forEach(CJ.datasets,function(CM,CN){if(Bh.find(CI,"did",CN)<0){CK.push(CN);}});if(CK.length>0){CL=CK[0];CB.curDataset=CJ.datasets[CL];CB.hasCreateDataset=true;CB.curDataset.id=CL;CB.cubeID=CL;CD();}},failure:function(CJ){CC.displayError(mstrmojo.desc(12796,"Unable to update the dataset after editing."),false,CJ&&CJ.message);}},{newObjectIds:[CB.reportDefinitionId]});}if(!CB.analysisID&&!mstrApp.isSingleTier){if(CC.rootView.currentPage&&CC.rootView.currentPage.scriptClass!=="mstrmojo.DI.DIExitOptions"){if(CB.path!==undefined&&CF){if(A6.isServerBasedWS()||CB.path==="serverBased"){CE={objectId:CB.cubeID,folderId:CB.folderID};this.shutDownServerBased(JSON.stringify(CE));}else{CC.showPage(AY.pageType.redirect);}}else{CC.exitApplication();}}}else{if(CB.operationMode===AY.operationMode.create&&(CB.isManagedCube||(CB.curDataset&&CB.curDataset.id)||!mstrApp.isPopup)){CC.dataService.getImportedData({success:function(CH){CB.populateEMMA(CH,CG,true);if(mstrApp.isSingleTier&&!mstrApp.isPopup){CA={objectId:CB.cubeID,objectType:3,objectSubtype:779,name:CB.cubeName,duplicateRIMsgId:CC.dataService.messageID};B9='window.setTimeout(function () { mstrApp.executeCommand("addNamedDataset",'+JSON.stringify(CA)+"); }, 1000)";window.FormWrapper.closeDataImportWindow();return ;}B8();},failure:function(CH){CC.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CH.message);}},{previewflag:CG});}else{if(CB.operationMode===AY.operationMode.edit){CD();}else{Aq.call(CC,CB.cubeID);}}}},getQBParamsDDA:function Ah(CA){var B7,B9=this.getDDAController(),B8={};B7=B9.canSupportDDA(B8);CA.canSupportDDA=B7;CA.shouldSupportDDA=B9.shouldSupportDDA();CA.isManagedCube=this.model.isManagedCube;CA.dbridForDDA=B8.dbrid;CA.isDDA=this.model.isDirectDataAccess;CA.origIsDDA=this.model.origIsDirectDataAccess;CA.ddaCheckboxID=B9.getDDACheckboxID();},getQueryBuilderParams:function B5(CA,B7){var B9={isEMMACube:mstrApp.isEMMACube,type:CA};switch(CA){case AY.xdaType.ffsql:case AY.xdaType.googleBigQuery:case AY.xdaType.googleBigQueryFFSQL:case AY.xdaType.querybuilder:B9.size={h:"95%",w:"95%"};break;case AY.xdaType.qbSingleTable:case AY.xdaType.googleBigQuerySingleTable:B9.size={h:"552px",w:"1110px"};break;case AY.xdaType.dataImportBISource:case AY.xdaType.mdx:B9.size={h:"552px",w:"1010px"};break;default:B9.size={h:"549px",w:"1010px"};}B9.isFFSQL=(CA===AY.xdaType.ffsql||CA===AY.xdaType.googleBigQueryFFSQL||CA===AY.xdaType.dataImportBISource)?true:false;if(CA===AY.xdaType.googleBigQuery||CA===AY.xdaType.googleBigQueryFFSQL||CA===AY.xdaType.googleBigQuerySingleTable){var B8=this.model.externalSources[AY.sourceType.googleBigQuery];if(B8){B9.dbrid=B8.dbRoleID;if(B8.sourceAccountID){B9.said=B8.sourceAccountID;}if(B8.userDisplayName){B9.userName=B8.userDisplayName;}if(B8.userEmail){B9.userEmail=B8.userEmail;}}}if(mstrApp.isCloudPro){B9.isCloud=true;if(this.model.cubeID){B9.reportID=this.model.cubeID;}if(this.model.analysisID){B9.analysisID=this.model.analysisID;}if(this.model.folderID){B9.folderID=this.model.folderID;}if(mstrApp.diParams.isMDD){B9.isCube=2;}else{B9.isCube=1;}}else{if(this.model.analysisID){B9.messageID=mstrApp.messageID||this.dataService.messageID||"";}else{B9.messageID=this.dataService.messageID||"";}B9.analysisID=this.model.analysisID||"";B9.isNewAnalysis=mstrApp.isNewAnalysis;}B9.origin="di";B9.emmaTablesNum=this.model.getAllTableID().length;this.getQBParamsDDA(B9);B9.diFooterID=this.rootView.footer.id;B9.diRootViewID=this.rootView.id;B9.tableID=(B7&&B7.tableID)||"";B9.subtype=(B7&&B7.subtype)||undefined;B9.isRefined=(B7&&B7.isRefined);B9.diCurrentZIndex=this.getDialogController().getCurrentZIndex();B9.operationMode=this.model.operationMode;B9=mstrmojo.hash.copy(B9,B7);return B9;},afterQBProcess:function Bd(CD,CB){var CA=this;var CF=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship,CC=mstrApp.tableID,B7,B8,CE=!!(CA.rootView.currentPage&&CA.rootView.currentPage.tableID),B9=CE?AY.actions.refreshData:AY.actions.importSource;if(mstrApp.hasOwnProperty("isDDA")){B8=mstrApp.isDDA;CA.getDDAController().setDirectDataAccess(B8);}if(mstrApp.hasOwnProperty("isManagedCube")){CA.model.isManagedCube=mstrApp.isManagedCube;}if(CD){CA.dataService.set("messageID",mstrApp.messageID);CA.getDDAController().confirmDDA=false;if(CD.mdx){CA.saveAndPublish();return ;}CA.getImportedDataEMMA(BB.savePublish,CF);return ;}if(mstrApp.messageID){CA.dataService.set("messageID",mstrApp.messageID);if((!CC&&!CA.model.isDirectDataAccess)||(CB!==undefined)){var CG=function(CI,CH){if(!CB){CA.getImportedDataEMMA(B9,CF);}else{CA.getModel().cleanDuplicateRI(CH,{success:function(){if(CH){mstrmojo.array.forEach(CB,function(CJ){if(CJ.tid){CA.model&&CA.model.resetImportSource(CJ.tid);}});}CA.getImportedDataEMMA(B9,CF,undefined,undefined,undefined,undefined,undefined,CI);}});}};B7={onOK:function(){CG();},onCancel:function(CI){var CH=true;CG(CI,CH);}};CA.autoDetectPartitionGroups(B7,undefined,undefined,CB);}else{CA.getImportedDataEMMA(B9,CF);}}},afterBigQueryProcess:function S(B7){var B9=AY.pageType,B8=this.model.externalSources[AY.sourceType.googleBigQuery];B8.reset();this.showPage(B7?B9.emmaPreview:B9.dataSelection);},displayError:function V(CB,CE,CA,B8,CD,B9,CC){var B7;if(mstrApp.isPopup){CE=false;}B7={title:CD||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),showTitle:CC===false?false:true,summary:B9||"",errorMessage:CB,detailErrorMessage:CA||"",onOK:B8||null};if(mstrApp.hideProgress){mstrApp.hideProgress(true);}else{if(mstrApp.hideWait){mstrApp.hideWait();}}mstrmojo.error({shortDesc:CB,longDesc:CA},B8,{title:mstrmojo.desc(11812,"Notification"),allowHTML:true});if(CE){mstrApp.onSessionExpired();}},displayWarning:function K(B7,CB,CA,B9){var B8={title:CB||mstrApp.applicationName&&mstrApp.applicationName()||mstrmojo.desc(3610),errorMessage:B7,showCancel:true,onOK:CA};mstrmojo.hash.forEach(B9,function(CD,CC){B8[CC]=CD;});mstrApp.hideProgress(true);this.showDialog(AY.dialogType.warningDialog,B8);},filterSourcesByPrivileges:function(B8){var B7=[];mstrmojo.hash.forEach(B8,function(B9){if(B9.privilege===AY.privilegeType.accessCloud&&mstrApp.diParams.AccessDataFromCloudApp){B7.push(B9);}if(B9.privilege===AY.privilegeType.accessDatabase&&mstrApp.diParams.ImportDatabase){B7.push(B9);}if(B9.privilege===AY.privilegeType.accessFile&&mstrApp.diParams.AccessDataFromFiles){B7.push(B9);}});return B7;},filterSourcesForOneTier:function(B7){var B8=[],CB=0,B9=0,CA;mstrmojo.hash.forEach(B7,function(CC){CA=null;if(CC.oneTier){CA=mstrmojo.hash.copy(CC,CA);if(B9>3){CB++;B9=0;}B9++;B8.push(CA);}});return B8;},filterSourcesByDDA:function(B8){var B7=[],CB=0,B9=0,CA;mstrmojo.hash.forEach(B8,function(CD){CA=null;var CC,CE;if(CD.sourceInfo&&CD.sourceInfo.subtype){CC=CD.sourceInfo.subtype;}else{CC=CD.subtype;}if(CD.sourceInfo&&CD.sourceInfo.dbType){CE=CD.sourceInfo.dbType;}else{CE=CD.dbType;}if(mstrApp.getRootController().model.canAddToDDACube(CC,CE)){CA=mstrmojo.hash.copy(CD,CA);if(B9>3){CB++;B9=0;}B9++;B7.push(CA);}});return B7;},filterSourcesByDDAOnly:function(CB,B7){var CA=this.getModel(),B9=[],B8;if(!B7){Bh.forEach(CB,function(CC){if(CC.sourceInfo&&CC.sourceInfo.subtype){B8=CC.sourceInfo.subtype;}else{B8=CC.subtype;}if(!CA.isDDAOnlySource(B8)){B9.push(CC);}});}else{B9=CB;}return B9;},filterSourcesByText:function y(CA,B9,CD){var B8,CC,B7=[],CE=0,CB=0;for(B8=0;B8<CA.length;B8++){CC=CA[B8].n.toLowerCase().indexOf(B9.toLowerCase());if(CC>-1){B7.push(CA[B8]);CB++;if(CB===CD){CB=0;CE=CE+1;}}}return B7;},filterSourcesbyTag:function Z(CA,CE,CB){var B9,B8,CF=[],CD=0,B7=0,CC;for(B8=0;B8<CA.length;B8++){if(CA[B8].tags){for(B9=0;B9<CA[B8].tags.length;B9++){CC=CA[B8].tags[B9];if(CE[CC]){CF.push(CA[B8]);B7++;if(B7===CB){B7=0;CD=CD+1;}break;}}}}return CF;},selectSourceTable:function AE(CD,CF){var CB=this,CA=CB.model,B7=null,B8=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship|AY.requestFlag.preview|AY.requestFlag.transformations,CC=false,CE=CA.currentSource?CA.currentSource.tableID:-1;if(CD!==-1){B7=CB.model.getImportSource(CD);}if(CD===CE&&B7&&B7.cannotFetchPreview){if(CF){CA.raiseEvent({name:"scrollToTable",value:CD});}return ;}var CG={success:function(CH){CB.model.selectSourceTable(CD);CA.populateEMMA(CH,B8,CD);B7.selectPending=false;if(CF){CA.raiseEvent({name:"scrollToTable",value:CD});}},failure:function(CH){B7.selectPending=false;if(CA.operationMode===AY.operationMode.create&&parseInt(CH.code,10)!==AY.backendError.shouldBeIgnored){CB.displayError(mstrmojo.desc(12624,"Error fetching information about the imported data. Please check the data being imported."),false,CH.message||"");}else{if(B7){B7.cannotFetchPreview=true;CA.raiseEvent({name:"PreviewNotFetched"});}}if(CF){CA.raiseEvent({name:"scrollToTable",value:CD});}}};if(B7){var B9=(!!B7.currentMapping&&!!B7.currentPreview)||(!!B7.transformedMapping&&!!B7.transformedPreview);if(!B9){if(B7&&B7.currentTransformations&&B7.currentTransformations.xtab&&B7.currentTransformations.xtab.isCrosstab){B8=B8&(~AY.requestFlag.preview);B8=B8&(~AY.requestFlag.transformations);B8|=AY.requestFlag.transformedPreview;}else{B8=B8&(~AY.requestFlag.transformedPreview);B8|=AY.requestFlag.preview;}if(B7.type===AY.sourceType.querybuilder){B8=B8&(~AY.requestFlag.sheets);B8=B8&(~AY.requestFlag.transformations);B8=B8&(~AY.requestFlag.sourceInfo);}if(CA.operationMode===AY.operationMode.edit||CA.operationMode===AY.operationMode.refresh){B8=B8&(~AY.requestFlag.sheets);}if(B7.subtype===AY.sourceSubtype.googleBigQuerySingleTable){B8=775;}if(B7.databaseType===h&&B7.xdaType===AY.xdaType.qbSingleTable){B8=B8&(~AY.requestFlag.preview);}CC=true;}}if(CC&&!B7.cannotFetchPreview){if(B7.selectPending&&B8===B7.selectPendingFlags){return ;}B7.selectPending=true;B7.selectPendingFlags=B8;CB.model.selectSourceTable(CD);CB.dataService.getImportedData(CG,{previewflag:B8,sheetIndex:0,tableID:CD},{showProgress:false});}else{CB.model.selectSourceTable(CD);if(CF){CA.raiseEvent({name:"scrollToTable",value:CD});}}},removeSourceTable:function Aw(CC){var CB=this,B7=CB.getModel().getImportSource(CC);var B9={did:CC};var CD=mstrmojo.desc(13646,"Oops ... Empty Dataset"),CA=mstrmojo.desc(13883,"The dataset cannot be empty. Please add more tables before deleting this one."),B8=CB.getModel().getAllTableID();function CF(CG){var CJ=mstrApp.getRootController().getModel().importSources,CI=[],CL=false,CM;if(CG.isLinked){for(var CH in CJ){if(CJ.hasOwnProperty(CH)&&CH!==CG.tableId){CM=CJ[CH].findMappingItem(CG);if(CM){CI.push(CM);CL=true;}}}}for(var CK=0;CK<CI.length;CK++){CI[CK].recursive=0;}CB.changeEMMAMappings({success:function(){CB.dataService.removeEMMASourceTable(CE,B9);}},undefined,true);}if(CC===-1){return ;}var CE={success:function(CH){CB.dataService.set("messageID",CH.msgid);CB.model.resetImportSource(CC);CB.model.raiseEvent({name:"removeSourceTable",tableID:CC});CB.navigationController.deleteRoute(CC);var CG=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;if(CB.model.getAllTableID().length>0){CB.getImportedDataEMMA(BB.none,CG);}else{CB.showPage(AY.pageType.dataSelection);}},failure:function(CG){CB.displayError(mstrmojo.desc(12797,"Cannot remove source table."),false,CG.message||"");}};if(B8.length===1){mstrmojo.alert(CA,mstrmojo.emptyFn,CD,CB.getDialogController().getNextZIndex());}else{if(B7.isHierarchyRelationTable()){mstrmojo.confirm(Ay(null,"If you remove this hierarchy relation table, we will reset all the recursive attribute linking to it. Are you sure about doing this?"),{},{buttons:[Bk(Ay(1442,"OK"),function(){var CG=B7.getRecursiveAttrAndMFA()||{};CF(CG);CB.dataService.removeEMMASourceTable(CE,B9);},true),Bk(Ay(221,"Cancel"))]});}else{CB.dataService.removeEMMASourceTable(CE,B9);}}},autoMappingAfterRefine:function c(B9,CA,CB){var CC={};if(CB){CC.behaviorFlags=AY.behaviorChangeFlag.refreshData;}else{CC.behaviorFlags=AY.behaviorChangeFlag.remapping;}var B8=this;var B7={success:function(){B8.getImportedDataEMMA(BB.none,B9,undefined,undefined,CA);},failure:function(CE){B8.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CE.message||"");}};var CD={success:function(CE){if(CE&&CE.msgid){B8.dataService.set("messageID",CE.msgid);}B8.dataService.detectRelationshipSourceTable(B7,{did:CA});},failure:function(CE){B8.displayError(mstrmojo.desc(12798,"Error when auto mapping after wrangle."),false,CE.message||"");}};CC.tbid=CA;this.dataService.autoMappingSourceTable(CD,CC);},startRefineStage:function R(CB,B8,CA,CD){var B7=this;var B9=B7.model;var CC={did:CB,flag:B8,xml:CA};var CE={success:function(CH){if(CH){B7.dataService.set("messageID",CH.msgid);}if(B8!==3){var CF=8;B7.getImportedDataEMMA(BB.refine,CF,undefined,undefined,CB,B8-1);}else{var CI=B7.model.getImportSource(CB);var CG=AY.requestFlag.preview|AY.requestFlag.mapping|AY.requestFlag.transformations|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;if(CI&&CI.currentTransformations&&CI.currentTransformations.xtab&&CI.currentTransformations.xtab.isCrosstab){CG=CG&(~AY.requestFlag.preview);CG=CG&(~AY.requestFlag.transformations);CG|=AY.requestFlag.transformedPreview;}else{CG=CG&(~AY.requestFlag.transformedPreview);CG|=AY.requestFlag.preview;}B7.editImportedDataEMMA(CG,null,null,null,CB);}},failure:function(CF){B7.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,CF.message||"");}};if(B8===3){B7.model.cleanDuplicateRI(false,{success:function(CF){B7.dataService.startRefineStage(CE,CC);}});}else{B9.originalMsgID=B7.dataService.messageID;B7.dataService.removeOrDuplicateRI({success:function(CF){mstrApp.msgid=CF.msgid;if(CD){if(CE&&CE.success){CE.success(CF);}}else{B7.dataService.set("messageID",CF.msgid);B7.dataService.startRefineStage(CE,CC);}}},{messageID:B9.originalMsgID});}},cancelRefineStage:function H(B9,B8){var B7=this;var CA={did:B9};var CB={success:function(CE){if(mstrApp.msgid){B7.dataService.set("messageID",mstrApp.msgid);}var CF=B7.model.importSources[B9];delete CF.projectID;var CD=AY.requestFlag.preview|AY.requestFlag.mapping|AY.requestFlag.transformations|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;if(CF&&CF.currentTransformations&&CF.currentTransformations.xtab&&CF.currentTransformations.xtab.isCrosstab){CD=CD&(~AY.requestFlag.preview);CD=CD&(~AY.requestFlag.transformations);CD|=AY.requestFlag.transformedPreview;}else{CD=CD&(~AY.requestFlag.transformedPreview);CD|=AY.requestFlag.preview;}if(B8){B7.dataService.cancelRefineStage({success:function(CG){B7.editImportedDataEMMA(CD,null,null,null,B9,null,null,null,null,true);}},CA);}else{var CC=CF&&CF.currentIndex;B7.getImportedDataEMMA(BB.none,CD,CC,undefined,B9,null,null);}},failure:function(CC){B7.displayError(mstrmojo.desc(12799,"Encounter error when wrangling your data."),false,CC.message||"");}};B7.getModel().cleanDuplicateRI(!B8,CB);},refreshSourceTable:function Bc(CF){var CE=this;var B7=CE.model.getImportSource(CF);var B9=B7.sourceInfo.dbTableName.replace(/^file:\/\/\//,"");var CI;var B8={next:{visible:true,text:mstrmojo.desc(773,"Refresh")},back:{visible:false},cancel:{visible:true},finish:{visible:false},cubeQuota:{visible:false},dda:{visible:false},save:{visible:false},managedCheckbox:{visible:false}};var CA=mstrmojo.desc(14155,"Please input your original data into clipboard because you have parsed or wrangled the data.");var CH={success:function(CJ){CI.getConfig().properties.content=CJ;CE.showPage(AY.pageType.clipboard,0,CI,B8);},failure:function(CJ){CE.showPage(AY.pageType.clipboard,0,CI,B8);CE.displayError(mstrmojo.desc(12795,"Could not load clipboard data!"),false,CJ.message);}};if(!B7){return ;}delete B7.projectID;CI=CE.navigationController.getPageSlot();CI.setConfig({name:B9,properties:{tableID:CF,currentSource:B7,isMultiSelect:false,operationMode:AY.operationMode.edit},footerConfig:B8,newPage:true,newPageConfig:{cssClass:"mstrmojo-di-refresh-data-editor"}});if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.localFile){if(CE.model.refreshToWrangle&&mstrApp.isSingleTier&&window.FormWrapper.isFilePathExist(B7.sourceInfo.url)){CE.refreshOnetierLocalFile(CF);}else{CE.showPage(AY.pageType.file,B7.subtype-1,CI,B8);}}else{if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.url){B8.next.enabled=true;CE.showPage(AY.pageType.file,B7.subtype-1,CI,B8);}else{if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.cloudElement){B8.next.enabled=true;CE.showPage(AY.pageType.cloudElement,B7.subtype-1,CI,B8);}else{if(B7.type===AY.sourceType.hadoop&&B7.subtype===AY.sourceSubtype.hadoop){if(B8&&B8.next){B8.next.isRefresh=true;}CE.showPage(AY.pageType.hadoop,B7.subtype-1,CI,B8);}else{if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.clipboard){var CC={previewflag:AY.requestFlag.fullData,browsetype:4,sheetIndex:0,bindingflag:0,tableID:CF};if(!B7.isParsed()&&!B7.isRefined()){this.dataService.getImportedData(CH,CC,0);}else{CE.showPage(AY.pageType.clipboard,0,CI,B8);mstrApp.getRootController().displayWarning(CA,null,mstrmojo.emptyFn,{showCancel:false});}}else{if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.samplefile){CE.showPage(AY.pageType.sampleFiles,null,CI,B8);}else{if(B7.type===AY.sourceType.file&&B7.subtype===AY.sourceSubtype.publicData){CE.showPage(AY.pageType.publicData,null,CI,B8);this.scrapeWiki(B7.sourceInfo.url,false);}else{if(B7.type===AY.sourceType.querybuilder){mstrApp.getRootController().showPage(AY.pageType.database,{sourceType:B7.type,type:B7.xdaType,extParams:{tableID:CF,isRefined:B7.sourceInfo.isRefined,subtype:B7.subtype,databaseType:B7.databaseType}},CI,B8);}else{if(B7.type===AY.sourceType.salesforce||B7.type===AY.sourceType.googleDrive||B7.type===AY.sourceType.dropbox||B7.type===AY.sourceType.googleAnalytics||B7.type===AY.sourceType.googleBigQuery){CE.getOAuthSourceReports(B7.type,false,CI);}else{if(B7.type===AY.sourceType.bisource){mstrApp.getRootController().showPage(AY.pageType.database,{sourceType:AY.sourceType.bisource,type:AY.xdaType.dataImportBISource,extParams:{tableID:CF}},CI,B8);}else{if(B7.type===AY.sourceType.twitter||B7.type===AY.sourceType.facebook){var CB,CD,CG;if(B7.type===AY.sourceType.twitter){CB=A6.spliceUrlBySeparator(B7.sourceInfo.url);CD=JSON.parse(CB);CG=CI.getConfig().properties;if(CD!==undefined){CG.searchParam=CD.query;}if(B7.fetchNum){CG.fetchNum=B7.fetchNum;}}else{CB=decodeURIComponent(B7.sourceInfo.url.split("###")[1]);CD=JSON.parse(CB);if(CD!==undefined){CI.getConfig().properties.searchParam=CD.query;CI.getConfig().properties.groupID=CD.groupID;if(CD.advProps){CI.getConfig().properties.advProps=CD.advProps;}}}CE.getOAuthSourceReports(B7.type,true,CI,"");}}}}}}}}}}}B7.invalidPreview();},refreshOnetierLocalFile:function(CB){var B7=this,B9=this.getModel(),CD=this.getDataService(),CC=B9.getImportSource(CB),B8=CC.sourceInfo.url;function CA(CE){B7.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,CE&&CE.message);}if(B8.indexOf("file:///")===0){B8=B8.substr(8);}B7.oneTierImportFile({success:function(CE){if(CE&&CE.msgid){CD.set("messageID",CE.msgid);}CD.autoMappingSourceTable({success:function(){B7.detectRelationshipSourceTable(null,[CB],AY.actions.refreshData);},failure:CA},{tbid:CB,shtIx:CC.sourceInfo.sheetIndex,behaviorFlags:AY.behaviorChangeFlag.refreshData});},failure:CA},{msgID:CD.messageID,tableID:CB,datasource:B8,dict:AY.backendSourceSubtype.localFile,fileName:B8,__index:0,behaviorFlags:0});},openRenameTextBox:function Bg(B7,B9,B8){this.mappingController.openRenameTextBox(B7,B9,B8);},changeEMMAMappings:function g(CH,CG,CF){var CD=this;var CC=CD.model;var CE=[];var B7=CC.getAllTableID();var CA,CB;var B9;var B8={success:function(){var CJ=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;if(!CF){CD.getImportedDataEMMA(BB.none,CJ);}else{CD.getImportedDataEMMA(AY.actions.none,CJ,null,null,null,null,CH);}},failure:function(CJ){CD.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CJ.message);}};for(CA=0;CA<B7.length;CA++){CB=CC.getImportSource(B7[CA]).getMappingChanges();if(CB&&CB.length>0){CE.push(B7[CA]);}}CA=0;var CI={success:function(CK){CD.dataService.set("messageID",CK.msgid);var CL=0;CA++;if(CA<CE.length){B9={tbid:CE[CA],mapping:B1.call(CD,CE[CA])};CC.getImportSource(CE[CA]).invalidPreview();CD.dataService.changeMappingSourceTable(CI,B9);}else{var CJ=[];mstrmojo.array.forEach(CE,function(CN){var CM=CC.getImportSource(CN);if(CM.canAutoMappingAndDetectRelation()){CJ.push(CN);}});if(CJ.length>0){Bh.forEach(CJ,function(CM){CD.dataService.detectRelationshipSourceTable({success:function(){CL++;if(CL>=CJ.length){B8.success();}},failure:function(CN){CD.displayError(mstrmojo.desc(12795,"RS detection failure!"),false,CN.message);}},{did:CM});});}else{B8.success();}}},failure:function(CL){var CK=parseInt(CL.code,10);var CM=mstrmojo.desc(12800,"Cannot change mapping.");switch(CK){case AY.backendError.invalidObjectName:CM=mstrmojo.desc(12801,"Cannot change mapping with invalid characters");break;case AY.backendError.stringTooLong:CM=mstrmojo.desc(12802,"Cannot change mapping with a too long string");break;}CD.displayError(CM,false,CL.message);var CJ=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;CD.getImportedDataEMMA(BB.none,CJ);}};if(CA<CE.length){B9={tbid:CE[CA],mapping:B1.call(CD,CE[CA],CG)};CC.getImportSource(CE[CA]).invalidPreview();CD.dataService.changeMappingSourceTable((CH&&!CF)?CH:CI,B9);}},editRelationship:function v(CD,CC,CE){var B8=this;if(!CD||!CC||!CD.length){return ;}var CA=0;var B9={success:function(){var CF=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship;B8.getImportedDataEMMA(BB.none,CF);},failure:function(CF){B8.displayError(mstrmojo.desc(12803,"Cannot edit relationship."),false,CF.message||"");}};var B7=mstrmojo.func.wrapMethods(B9,CE,{});var CB={success:function(){CA++;if(CA<CD.length){CC.did=CD[CA];B8.dataService.editRelationshipSourceTable(CB,CC);}else{B7.success();if(B7.complete){B7.complete();}}},failure:function(CF){B7.failure(CF);if(B7.complete){B7.complete();}}};CC.did=CD[0];B8.dataService.editRelationshipSourceTable(CB,CC);},openRelationsDefineEditor:function(B8){var B7;if(!B8){return ;}B7={tableID:B8};this.showDialog(AY.dialogType.relationDefineDialog,B7);},removeEMMASourceTable:function Bj(B8,B7){this.dataService.removeEMMASourceTable(B8,B7||{});},showDialog:function BJ(B8,B7){return this.dialogController.show(B8,B7);},hasDialog:function Y(B7){this.dialogController.hasDialog(B7);},closeDialog:function A4(B7){this.dialogController.close(B7);},closePageDialog:function B0(){if(this.dialogController.pageZIndex>0){this.rootView.parent.close();}},toAttribute:function l(B7){this.mappingController.toAttribute(B7);},toMetric:function L(B7){this.mappingController.toMetric(B7);},setMultipleImport:function AD(B7){this.mappingController.setMultipleImport(B7);},setGeoRoles:function Bn(B7){this.mappingController.setGeoRoles(B7);},setTimeDimension:function a(B7){this.mappingController.setTimeDimension(B7);},setTimeRole:function Ai(B7){this.mappingController.setTimeRole(B7);},toUnused:function A8(B7){this.mappingController.toUnused(B7);},openUnLinkDialog:function Ac(B7){this.mappingController.openUnLinkDialog(B7);},unlinkAll:function Bs(B8,B7){this.mappingController.unlinkAll(B8,B7);},unlinkAllCubeLevel:function BQ(B7){this.mappingController.unlinkAllCubeLevel(B7);},linkAttributes:function W(B8,B7){this.mappingController.linkAttributes(B8,B7);},toProjectAttribute:function Bm(B8,B7){this.mappingController.toProjectAttribute2(B8,B7);},unmap:function b(B7){this.mappingController.unmap(B7);},importItem:function T(B7){this.mappingController.importItem(B7);},changeDataType:function Ab(B8,B7,B9){this.mappingController.changeDataType(B8,B7,B9);},attachDataChangeListeners:function Bi(B9){var B7=this.model,B8=[];Bp.forEach(B9,function(CA,CB){Bp.forEach(CA,function(CD,CC){B8.push(B7.attachEventListener(CC,CB,CD));});});return B8;},detachDataChangeListeners:function By(B8){var B7=this.model;Bh.forEach(B8,function(B9){B7.detachEventListener(B9);});},raiseModelEvent:function AM(B7){this.model.raiseEvent(B7);},getTableNames:function AX(){var B9=this.model,B7=B9.importSources,CA,B8=[],CB;for(CB in B7){if(B7.hasOwnProperty(CB)){CA=B7[CB];if(CA&&CA.tableID){B8.push({n:CA.sourceInfo.name,id:CA.tableID});}}}return B8;},getCurrentSource:function AT(){return this.model.currentSource;},createNewReportInstance:function(CC){var B7=this,B8=this.getModel(),CA=B8.currentDataset,B9=B8.isManagedCube,CB=null;if(!CA){if(B9){CB={extParams:"<mgo>1</mgo>"};}B7.dataService.createEMMAReportInstance(CC,CB);}else{B7.duplicateSelectedDataset(CC);}},removeCurrentReportInstance:function(CD){var B8=this,CA=B8.getDocController(),B9=this.getModel(),CC=B8.dataService,CB=B9.curDataset;var B7={success:function(){B9.curDataset=null;B9.currentDataset=null;CC.messageID=null;if(CD.success){CD.success();}},failure:function(CE){B8.displayError(CE&&CE.message,false);},complete:function(){if(CD.complete){CD.complete();}}};if(CB&&CB.id){CA.removeDataset(B7,CB);}else{B7.success();B7.complete();}},backFromQB:function(){var B7=this;if(B7.dialogController.pageZIndex===0){B7.removeCurrentReportInstance({success:function(){B7.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}});}else{B7.showPage(mstrmojo.DI.DIConstants.pageType.dataSelection);}},saveSourceListAdminConfig:function(CB,CA){var B7=this,B9=this.getModel(),B8={};var CC={success:function(){B7.showPage(AY.pageType.dataSelection);}};B9.populateSourceListAdminConfig(CB,CA);if(CB||CA){if(mstrApp.diParams.connectorConfig){B8=mstrApp.diParams.connectorConfig;}else{B8={};}if(CB){B8.resourceConfig=CB;}if(CA){B8.dbRoleConfig=CA;}if(mstrApp.isSingleTier){this.dataService.updatePreferences(CC,"diConnectorConfig",JSON.stringify(B8));}else{this.dataService.setPreference(CC,{prefs:"diConnectorConfig\u001E"+JSON.stringify(B8)});}}else{CC.success();}},saveUserDefined:function(CD,CB){var CC=mstrApp.getRootController().getModel(),B7=CC.externalSources[CD],B8=mstrApp.getRootController(),CE=[],B9,CF={success:function(){B7.userDefined=!!CB;},failure:function(){B8.displayError(mstrmojo.desc(null,"Saving user preconfig error! Please connect to the Administrator"));}};if(CB){CE.push(CD);}for(var CA in CC.externalSources){if(CC.externalSources.hasOwnProperty(CA)){if(CC.externalSources[CA].userDefined&&CC.externalSources[CA].type!==CD){CE.push(CC.externalSources[CA].type);}}}B9={diOauthConfig:CE};this.dataService.setPreference(CF,{prefs:"diOauthConfig\u001E"+JSON.stringify(B9)});},showSaveVisual:function(){this.rootView.showSaveVisual();},closeDIPopup:Aq,getAttributesAndMetrics:function BR(CD,CF){var B7,CC,CA=[],CE=[],B9=12,B8=4,CB=CF?CF.toUpperCase():"";B7=this.getModel().getImportSource(CD);if(!B7){return[CA,CE];}CC=B7.getCurrentMappings(function(CG){return CG.selected&&(!CB||CG.alias.toUpperCase().indexOf(CB)!==-1);});CA=mstrmojo.array.filter(CC,function(CG){return CG.tp===B9;});CE=mstrmojo.array.filter(CC,function(CG){return CG.tp===B8;});return[CA,CE];},getDBRoles:function C(B8,B7){var CA={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1+2048,typeFilter:(B8||[]).join(","),versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",isDataImport:true};var CB={success:function B9(CC){if(mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp"){mstrApp.dbRoles=CC;mstrApp.dbRolesAdminConfig=Bh.map(B7,function(CD){return CD;});}},failure:function(CC){}};mstrApp.serverRequestQueue(CA,CB,t);},getCloudElementDBRoles:function AL(B9){var B7=this.model;var B8={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:"18200",versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",};var CA={success:function(CB){var CC=Bh.map(CB.dbRoles,function(CD){return(function(CF){var CE=Bp.copy(B7.cloudElement,{}),CH=Bp.walk("connectorConfig.resourceConfig",mstrApp.diParams),CG=CH&&Array.prototype.indexOf.call(CH,CF.did)<0;return Bp.copy({n:CF.n,desc:mstrmojo.desc(12876,"Connect to ####").replace("####",CF.n),onclick:function(CI){var CK=Bp.walk("rootView.currentPage.pageType",mstrApp.getRootController()),CJ=Object.getPrototypeOf(this);if(CK===AY.pageType.sourceAdmin){CJ.onclick.call(this,CI);}else{this.handleSourceSelect(this,CF);}},selected:CG,oid:CF.did,},CE);})(CD);});if(CC.length){B7.set("sourceItems",B7.sourceItems.concat(CC));B7.set("cloudElementSrcItems",CC);}B7.populateCloudElementDBRole(CB);B7.raiseEvent({name:AY.srcItemTypes.CLOUDELEMENT_CONNECTOR,src:B7});if(B9&&B9.success){B9.success();}}};mstrApp.serverRequestQueue(B8,CA,t);},getAuthenticationDBRoles:function As(CA){var B8=this.model;var CC={taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,typeFilter:"7700",versionFilter:"",typeExcludeFilter:"",versionExcludeFilter:"",isDataImport:false};var B7=3;function B9(){mstrApp.serverRequestQueue(CC,CD,t);}var CD={success:function CB(CE){B8.populateAuthenticationDBRole(CE);CA&&CA();},failure:function(){if(B7-->0){console.log("fail");window.setTimeout(function(){B9();},1);}}};B9();},getManagedAuthDBR:function(CA){if(!CA){return ;}var B9=this.getModel(),B8=B9.getImportSource(CA),B7=Bp.walk("sourceInfo.dbRoleId",B8);if(B7&&B7!==""&&[AY.urlAuthDBRoles.anonymous,AY.urlAuthDBRoles.windows,AY.urlAuthDBRoles.kerberos,AY.urlAuthDBRoles.integrated].indexOf(B7)<0&&(B9.authDBRoles&&Array.prototype.indexOf.call(B9.authDBRoles,B7)<0)){this.dataService.getSingleDBRole({success:function(CC){var CB=typeof (CC.dbr)==="object"?CC.dbr:JSON.parse(CC.dbr),CD=CB.dbRoles[0];CD.isManagedDBR=true;var CE=B9.authDBRoles.concat(CD);B9.set("authDBRoles",CE);}},{dbrId:B7});}},archSearch:function Bb(B8,B7){if(mstrApp.isSingleTier){mstrApp.serverRequestQueue(B7,B8,t);}else{mstrApp.serverRequestQueue(Bp.copy(B7,{taskId:"arch.search",objecttypes:29,skipSchemaIDCheck:true,flags:1+2+256+512+8192+16384,domain:4,specialparse:"getDBRoles",xmlflags:1,}),B8,t);}},beforeDIUnload:function(B8){var B9=mstrmojo.desc(14610,"Are you sure you want to navigate away from this page? Any unsaved work will be lost."),CC=this.getModel().operationMode,CB=this.rootView,B7=this.dialogController,CA=false;if(CC===AY.operationMode.create||CC===AY.operationMode.edit){if(B7.pageZIndex>0){CA=true;}else{if(CB&&CB.currentPage&&CB.currentPage.pageType===AY.pageType.emmaPreview){CA=true;}if(this.model.getHistoryList().hasSentToHistoryList){CA=false;}}}if(CA){B8.returnValue=B9;return B9;}},launchWrangleForTable:function Bu(B9){var B7=this;var B8=this.getModel();var CA;CA=B8.getImportSource(B9);if(!CA){CA=B8.currentSource;}if(!CA){return ;}if(CA.canLaunchWrangler()){B7.launchWranglerDialog(CA);}else{if(mstrmojo.DI.DIHelpers.isRefreshable(B7.model)){B7.model.isAddingNewTable=false;B7.model.refreshToWrangle=CA.tableID;B7.refreshSourceTable(CA.tableID);}else{B7.displayError(mstrmojo.desc(14200,"Administrator has disabled importing a file from a URL. Hence we cannot proceed to wrangle the table."));}}},importFromCube:function(CG,CF,B9){var CB=this,CA=CB.getModel(),B8=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.relationship,B7;function CE(CK){var CH=CA.cubeName;var CO=mstrmojo.desc(14888,"We detected that the datasets contain identical tables. The definition from ### will be used. The following tables are affected:").replace("###",CH);var CL=mstrmojo.desc(14889,"We detected that the datasets contain identical tables. The definition from the current dataset will be used. The following tables are affected:");var CN;var CI;function CJ(){CD();}try{CK=JSON.parse(CK);}catch(CM){CJ();return ;}if(!CK||!CK.table){CJ();return ;}CI=CK.table;CI=[].concat(CI);if(CI.length<0){CJ();return ;}CN="<ul>";Bh.forEach(CI,function(CP){CN+="<li>"+CP.n+"</li>";});CN+="</ul>";mstrApp.getRootController().displayError(CH?CO:CL,false,CN,CJ);}function CD(){var CH=mstrApp.getRootController();var CJ={success:function(){var CM=CA.getAllTableID(),CL;CL=Bh.difference(CM,B7);CL=Bh.filter(CL,function(CP){var CO=CA.getImportSource(CP);var CN=CO&&CO.xdaType;if(CN===AY.xdaType.excel||CN===AY.xdaType.text){return true;}return false;});Bh.forEach(CL,function(CO){var CN=AY.requestFlag.mapping|AY.requestFlag.sourceInfo|AY.requestFlag.transformations;CH.getImportedDataEMMA(AY.actions.none,CN,undefined,undefined,CO);});}};var CK={onOK:function(){CH.getImportedDataEMMA(B9,B8,undefined,undefined,undefined,0,CJ);},onCancel:function(CL){CH.getImportedDataEMMA(B9,B8,undefined,undefined,undefined,0,CJ,CL);}};var CI=true;CH.autoDetectPartitionGroups(CK,undefined,CI);}var CC={success:function(){B7=CA.getAllTableID();CB.getImportController().importFromCube(CG,{success:function(CH){if(CH&&CH.dupts){CE(CH.dupts);}else{CD();}},failure:function(CH){if(parseInt(CH.code,10)===AY.backendError.ddasupportIncompatible){mstrApp.getRootController().displayError(mstrmojo.desc(14890,"Cannot perform the action since one of the cube support Direct Data Access only while the other is In-Memory only."),false,CH.message);}else{if(parseInt(CH.code,10)===AY.backendError.mergeInvalidXdatype){mstrApp.getRootController().displayError(mstrmojo.desc(14891,"Import from a cube of some XDAType is not supported, such as MDX, Search Engine Indices."),false,CH.message);}else{if(parseInt(CH.code,10)===AY.backendError.notFullyControl){mstrApp.getRootController().displayError(mstrmojo.desc(14892,"User dont have full control for the merge cube."),false,CH.message);}else{mstrApp.getRootController().displayError(mstrmojo.desc(641,"Please try again. If the problem persists, contact the server Administrator."),false,CH.message);}}}}});},failure:function(CH){CB.displayError(mstrmojo.desc(12783,"Create EMMA Report Instance error. Please check the metadata."),false,CH.message||"");}};if(CF){CB.createNewReportInstance(CC);}else{CC.success();}},searchObjectName:function(B9,B7){var B8={success:function(CA){if(CA&&CA==="existed"){B9.rename();}else{B9.saveDirectly();}},failure:function(CA){}};this.getDataService().searchObjectName(B8,B7);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.string","mstrmojo.DI.DIRootController","mstrmojo.AS.ASQbEsController","mstrmojo.AS.ASQbFFSQLController","mstrmojo.AS.ASGBQController","mstrmojo.DI.DIConstants","mstrmojo.AS.DIAppSchemaRefreshFileEditor","mstrmojo.AS.ASGBQFFSQLController");mstrmojo.requiresDescs(12779);var K=mstrmojo.hash,U=mstrmojo.DI.DIConstants,I=mstrmojo.array,H=mstrmojo.string,A=4*1024*1024,E={url:"fileUrl",localFile:"fileLocal",googleDrive:"googleDrive",salesForce:"salesforce",dropBox:"dropbox"},Q={url:"Data from URL",localFile:"File from Disk"},F=0;function G(W){window.mstrAppSchema&&window.mstrAppSchema.callbacks.fetchTablesCallback(W);}function D(Y){var W=Y.trim().split("/");var X=W[W.length-1];return X;}function P(X,W,Y){I.forEach(X,function(b,a,Z){var c=(W===b.n);b.n=(b.n&&b.n.replace?b.n.replace(c?W:W+"_",c?Y:""):b.n);b.title=(b.title&&b.title.replace?b.title.replace(c?W:W+"_",c?Y:""):b.title);});}function V(a,Y,X,Z){var W;switch(X){case U.pageType.file:W=R(a,Y);break;case U.pageType.sourceObjectsDnD:W=N(a,Y,Z);break;}G(W);mstrApp.getRootController().exitApplication();}function B(d,j){var b=window.mstrAppSchema.workspaceManager.initialWorkspaceId,X=window.mstrAppSchema.workspaceManager.currentClientId,e=mstrApp.getRootController(),g=this,a={clientId:X,requestId:"",workspaceId:b,datasource:{}},f=[],Z=[],Y=[],W=0,h={success:function(l){var m,o=[];l=l.body;if(!l.sheetsInfo){e.displayError(mstrmojo.desc(12779,"Encounter error when set data import info!"),false,l&&l.message);return ;}m=l.sheetsInfo;I.forEach(m.sheetsNames,function(s,q,p){!m.isEmptySheets[q]&&o.push({idx:q,n:s,title:s,selected:q===0});});if(d.length===1&&o.length===0){mstrmojo.alert("The file sheet is empty");return ;}if(d.length===1&&o.length===1){var n=[];n.push({sheets:o,isSingleSheet:true});V(d,n,g.pageType,j);return ;}if(o.length===1){Z.push({sheets:o,isSingleSheet:true});Y.push(W);}else{if(/\.json$/i.test(d[W].name)){P(o,d[W].url,d[W].name);}f.push({defaultSheetsIndex:0,multiSelection:true,n:d[W].name||d[W].url,sheets:o,id:d[W].url});}W++;if(W===d.length){if(Z.length===d.length){V(d,Z,g.pageType,j);}else{var k={items:f,onOK:function(){var p=this.items.slice(0);if(Z.length>0){I.forEach(Z,function(t,s,q){p.splice(Y[s],0,t);});}V(d,p,g.pageType,j);},onBack:function(){this.unrender();}};e.showDialog(U.dialogType.sheetsSelectionDialog,k);}}}},c;e.dataService=new mstrmojo.DI.DIDataService();I.forEach(d,function(m,l,k){K.copy(m,a.datasource);c={path:"/workspaces/"+b+"/file-sheets-info",form:JSON.stringify(a),method:"POST"};e.dataService.archSpark(h,c);});}function M(Y,X){var W={},Z=-1;W[Z]={id:Z,name:Y,type:U.dbType.URL,tables:[{name:Y,dbr:Z,url:X,type:"fileLocal"}]};return W;}function R(Z,Y){var W={};table=[],params={};I.forEach(Z,function(g,e,b){var d=g.url,a=g.dbRoleId,c=D(d),f=Y[e].sheets;I.forEach(f,function(m,k,h){var l=!!Y[e].isSingleSheet;if(m.selected||l){table.push({dbr:a,fileName:g.name,name:l?(g.name||c):(m.n+" - "+(g.name||c)),ns:d,url:d,type:g.type,sheetIndex:m.idx});}});});params.tables=table;params.id=Z[0].type===E.url?U.dbType.URL:U.dbType.LOACLFILE;params.name=Z[0].type===E.url?Q.url:Q.localFile;params.type=params.id;var X=Math.random();W[X]=params;return W;}function T(Y,b,a){var W={},c={},Z=[];c.id=Y.dbRoleID;c.name=a;c.type=U.dbType.GOOGLE_ANALYTICS;for(var X=0;X<b.length;X++){Z[X]={dbr:Y.dbRoleID,dbtn:b[X].n,n:b[X].n,name:b[X].n,url:b[X].query,account_id:Y.sourceAccountID,_renderIdx:0};}c.tables=Z;W[Y.dbRoleID]=c;return W;}function N(a,Y,Z){var W={};table=new Array(),params={};I.forEach(a,function(h,f,c){var e=h.url,b=h.dbRoleId,d=D(e),g=Y[f].sheets;I.forEach(g,function(n,l,k){var m=!!Y[f].isSingleSheet;if(n.selected){table.push({dbr:b,name:m?d:n.n+" - "+d,type:h.type,url:e,sheetIndex:n.idx,account_id:Z.said,});}});});params.id=Z.dbRoleID;params.tables=table;params.name=Z.name;if(Z.type===U.sourceType.googleDrive){params.type=U.dbType.GOOGLE_DRIVE;}else{if(Z.type===U.sourceType.salesforce){params.type=U.dbType.SALESFORCE;}else{if(Z.type===U.sourceType.dropbox){params.type=U.dbType.DROPBOX;}else{mstrmojo.alert("The source type match failed.");return ;}}}var X=Math.random();W[X]=params;return W;}function J(e,Y,f,c,d,g){var a=arguments.callee,X=e.files,Z=X[0];if(!Z){mstrApp.hideProgress(true);e.set("files",e.shiftedFiles);delete e.shiftedFiles;g.complete();return ;}if(Y===undefined&&f===null){mstrApp.upload({success:function(h){a(e,0,h,c,d,g);},failure:function(h){mstrApp.hideProgress(true);}},K.copy(c,{index:-1}),null,d);}else{var b=Math.min(Z.size,Y+A),W=Z.slice(Y,b),d=K.copy({async:true},d);mstrApp.upload({success:function(h){if(Y+A<Z.size){Y+=A;a(e,Y,h,c,d,g);}else{var j=X.shift();e.shiftedFiles instanceof Array?e.shiftedFiles.push(j):(e.shiftedFiles=[j]);g.success(j.name,h.uploadingId);a(e,undefined,null,c,d,g);}},failure:function(h){mstrApp.hideProgress(true);}},K.copy(c,{index:f.index+1,uploadingId:f.uploadingId,fileName:Z.name,fileFieldName:"file"}),W,d);}}function L(W,d){var b="<ul>",c=true,a=false,X=mstrApp.getRootController();I.forEach(W.files,function(h,g,f){var m="C:\\fakepath\\"+h.name,e=[],k,l=m.substring(m.lastIndexOf(".")+1);if(h!==undefined){k=h.size;}if(k>(mstrApp.diParams.UploadSizeLimit*1024*1024)){a=true;e.push(h.name);var j=mstrmojo.desc(12738,"The maximum file size for #### files is @@@@ MB. ").replace("####",l).replace("@@@@",mstrApp.diParams.UploadSizeLimit);b+="<li>"+encodeURIComponent(h.name)+"<br>"+j||" </li>";h.toDel=true;}else{c=false;}if(l==="mstr"){X.displayError(mstrmojo.desc(14194,"Error: Only Excel Text, CSV can be uploaded. Please use the Upload MicroStrategy File to import .MSTR files."),false);return ;}});if(a){b+="</ul>";if(c){X.displayError(mstrmojo.desc(12900,"Error importing following files. Please check the files or delete them."),false,b);}else{var Z=function(){for(i=0;i<W.files.length;i++){var e=W.files[i];if(e.toDel){I.removeItem(W.files,e);}}d();};var Y={detailErrorMessage:b,okBtnText:mstrmojo.desc(219,"Yes"),cancelBtnText:mstrmojo.desc(218,"No"),onCancel:function(){}};X.displayWarning(mstrmojo.desc(13324,"Error importing the following files. Click 'Yes' to ignore the erroneous files and proceed with the successful files. Otherwise, click 'No' to check the erroneous files or delete them."),mstrmojo.desc(12537,"Data Import"),Z,Y);}}else{d();}}mstrmojo.AS.ASDIRootController=mstrmojo.declare(mstrmojo.DI.DIRootController,null,{scriptClass:"mstrmojo.AS.ASDIRootController",showPage:function O(W,X,Z,Y){return this._super(W,X,Z,{finish:{visible:true},next:{visibile:false},cancel:{visible:true},save:{visible:false},back:{visible:true},cubeQuota:{visible:false}});},getQueryBuilderParams:function C(Y,W){var X="";if(Y===U.xdaType.googleBigQuerySingleTable){X="mstrmojo.AS.ASGBQController";}else{if(Y===U.xdaType.ffsql){X="mstrmojo.AS.ASQbFFSQLController";}else{if(Y===U.xdaType.googleBigQueryFFSQL){X="mstrmojo.AS.ASGBQFFSQLController";}else{X="mstrmojo.AS.ASQbEsController";}}}return this._super(Y,K.copy({rootControllerCls:X,pageName:mstrConfig.pageName,servletState:mstrConfig.servletState},W||{}));},doLocalFileImport:function(Z){var W=this.rootView.currentPage.dnDBox,Y={taskId:"arch.sparkFileUpload",taskContentType:"json",taskEnv:"xhr",fileType:"application/octet-stream",workspaceId:window.mstrAppSchema.workspaceManager.initialWorkspaceId},X={showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12963,"Uploading File...")};W.fileMap=[];if(X.showProgress){mstrApp.showProgress(X);}L(W,function(){J(W,undefined,null,Y,X,{complete:function(){typeof Z==="function"&&Z(W.fileMap);},success:function(c,b){var a=M(c,b);W.fileMap.push(a);}});});},onFinishButtonClick:function S(){var Z=mstrApp.getRootController();Z.dataService=new mstrmojo.DI.DIDataService();var d=this.rootView.currentPage;switch(d.pageType){case U.pageType.file:var X=[];if(d.sourceSubtype===U.sourceSubtype.url){var f,W,a;if(d.mode===F){f=d.urlList.urls.slice(0);W=d.urlList.dbrs.slice(0);if(d.urlInput.value&&d.urlInput.value.length>0){f.push(d.urlInput.value);W.push(d.dbroles.getSelectedDBRole());}}else{f=d.urlBrowse.getDropZone().urls.slice(0);a=d.dbroles.getSelectedDBRole();}I.forEach(f,function(n,m,l){X.push({dbRoleId:d.mode===F?W[m].did:a.did,url:n.trim(),type:E.url});});B.call(d,X);}else{if(d.sourceSubtype===U.sourceSubtype.localFile){this.doLocalFileImport(function(l){I.forEach(l,function(o,n,m){o=o["-1"];X.push({dbRoleId:o.id,url:o.tables[0].url,name:H.htmlAngles(o.tables[0].name),type:E.localFile});});B.call(d,X);});}}break;case U.pageType.sourceObjects:var Z=mstrApp.getRootController();var Y=Z.getModel();var g=Y.externalSources[U.sourceType.googleAnalytics];var k=g.getSourceInfoParam(true);var b=d.asDataPrepare();var e=d.sourceObjectsInfo.name;var j=T(k,b,e);G(j);mstrApp.getRootController().exitApplication();break;case U.pageType.sourceObjectsDnD:var Z=mstrApp.getRootController();var Y=Z.getModel();var h=d.sourceObjectsInfo;var b=d.asDataPrepare();var X=[];var c="";switch(h.type){case U.sourceType.googleDrive:type=E.googleDrive;break;case U.sourceType.salesforce:type=E.salesForce;break;case U.sourceType.dropbox:type=E.dropBox;break;default:mstrmojo.alert("The source type match failed.");return ;}I.forEach(b,function(l,m){X.push({dbRoleId:h.dbRoleID,url:l.query,type:c,accountId:h.said});});B.call(d,X,h);break;default:this.rootView.currentPage.onFinishButtonClick();break;}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DI.DIRootView","mstrmojo.DI.DIExpressView","mstrmojo.DI.DIModel","mstrmojo.DI.DIRootController","mstrmojo.Editor","mstrmojo.DI.DIConstants","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.form","mstrmojo._IsWebApp","mstrmojo.AS.ASDIRootController");mstrmojo.requiresDescs(12537,12538);var c=mstrmojo.DI.DIConstants,a=mstrmojo.css,B=mstrmojo.dom,U=null,D=mstrmojo.DI.DIHelpers;var E="progressBar",W={scriptClass:"mstrmojo.Editor",id:E,showTitle:false,help:null,zIndex:99,cssClass:"mstrmojo-di-progressBar",children:[{scriptClass:"mstrmojo.ProgressBar",alias:"progress",cssClass:"mstrmojo-di-progress stripes"}],onremoveChild:function(d){var f=d.value;for(var e=0;e<f.length;e++){f[e].destroy();}},postCreate:function(){this.counter=0;},updateProgress:function S(d){this.progress.updateProgress(d);},progressTextValue:function N(d){if(this.progress){this.progress.set("progressText",d);}},open:function I(e,d){if((++this.counter>0&&!this.visible)||d.manually){mstrmojo.Editor.prototype.open.call(this,e,d);}},close:function K(e){var d=this.counter=Math.max(0,this.counter-1);if((d<=0&&this.visible)||e.manually){if(!this.manually||e.manually){this.counter=0;this.manually=false;mstrmojo.Editor.prototype.close.call(this,e);this.updateProgress(0);}}}};mstrmojo.DI.DIApp=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{isDI:true,enableWaitBox:true,getWaitBoxPosition:function(){var d={};if(!D.getEnvObj().isAppSchema()){var j=mstrmojo.dom.position(this.rootController.rootView.headerNode,true);if(j&&j.h!==0&&j.y!==0){d.top=j.h+j.y;}}else{var g=mstrmojo.dom.position(this.rootController&&this.rootController.rootView&&this.rootController.rootView.headerNode),f=mstrmojo.dom.position(this.rootController&&this.rootController.rootView&&this.rootController.rootView.footerNode),e=g&&g.y!==0&&f&&f.h!==0&&f.y!==0,h=48;if(e){d.top=(f.h+f.y-g.y-h)/2;}}return d;},start:function C(){a.addClass(document.body,mstrApp.isSingleTier&&B.getOSInfo().name.toLowerCase().indexOf("mac")>-1?"mac":"none-mac");if(mstrApp.isWorkstation||mstrApp.isFromVI){a.addClass(document.body,"workstation");}else{if(!mstrApp.isSingleTier){this.addedWSClass=true;a.addClass(document.body,"workstation");}}var e;if(mstrApp.diParams.StatusCode===undefined||mstrApp.diParams.StatusCode===c.operationMode.edit||mstrApp.diParams.StatusCode===c.operationMode.create||mstrApp.diParams.StatusCode===c.statusCode.pickTable||mstrApp.diParams.StatusCode===c.statusCode.hadoopPickTable||mstrApp.diParams.StatusCode===c.statusCode.ffsql||mstrApp.diParams.StatusCode===c.statusCode.hadoopFFsql){e=mstrApp.isCloudPro?new mstrmojo.DI.DIExpressView({placeholder:this.placeholder}):new mstrmojo.DI.DIRootView({placeholder:this.placeholder,cssClass:"mojo-theme-light"});}else{e=new mstrmojo.Box({placeholder:this.placeholder});}var f={model:new mstrmojo.DI.DIModel({id:"DIModel"}),rootView:e,scriptClass:this.rootControllerCls||"mstrmojo.DI.DIRootController"};var d=this.rootController=mstrmojo.insert(f);this.addDisposable(d);d.start();U=this.beforeUnload.bind(d);B.attachEvent(window,"beforeunload",U);},destroy:function Z(d){if(U){B.detachEvent(window,"beforeunload",U);U=null;}this._super(d);if(this.addedWSClass){a.removeClass(document.body,"workstation");}this.cleanUpDIStyles();},beforeUnload:function(d){var e=this;return e.beforeDIUnload(d);},restart:function R(d){var e=document.getElementById(this.rootController.rootView.id);var f=document.createElement("div");f.id=this.placeholder||"DIApp";mstrmojo.dom.replace(e,f);this.rootController.destroy();if(mstrmojo.all[E]){mstrmojo.all[E].destroy();}mstrmojo.hash.copy(d,this.diParams);this.start();},getRootController:function T(){return this.rootController;},applicationName:function H(){var e=c.application,d;if(this.diParams.CloudEdition===e.cloudProfessional){d=mstrmojo.desc(12538,"MicroStrategy Express");}else{if(this.diParams.CloudEdition===e.cloudPersonal){d=mstrmojo.desc(12538,"MicroStrategy Express");}else{d=mstrmojo.desc(12537,"Data Import");}}return d;},executeCommand:function V(d,e){this.serverProxy.cancelRequests();if(typeof this[d]==="function"){this[d](e);}else{this.getRootController().executeCommand(d,e);}},showProgress:function O(d){if(!d){d={message:mstrmojo.desc(5720,"Waiting...")};}if(d.showCancel===undefined){d.showCancel=false;}if(d.showProgressText&&d.progressText){d.message=d.progressText;}this.showWait(d);},hideProgress:function J(d){this.hideWait(d);},setProgressParams:function b(d,e){var f=mstrmojo.all[E];if(f){if(e&&e.showProgressText){f.progressTextValue(e.progressText);W.progressTextValue(e.progressText);}if(d){f.updateProgress(d);}}else{if(e&&e.showProgressText){W.progressTextValue(e.progressText);}if(d){W.updateProgress(d);}}},onFormWrapperClick:function A(){window.document.body.dispatchEvent(new Event("mousedown"));},serverResponse:function G(h,e,f,d,g){if(g===undefined){g={};}mstrmojo.all[h][e](f,!!d,g);},activeRequests:[],serverRequest:function P(h,j,d,e){var g={},f=this;if(d.hideFailureErr===undefined){g.hideFailureErr=true;}mstrmojo.hash.copy(d,g);g.silent=!d.showProgress;g.waitBoxCfg=e||{showCancel:false};g.waitBoxCfg.position=f.getWaitBoxPosition();if(d.showProgress&&d.showProgressText){g.waitBoxCfg.message=d.progressText;}this.activeRequests.push(h);j=mstrmojo.func.wrapMethods({complete:function(){f.activeRequests.splice(mstrmojo.array.indexOf(f.activeRequests,h),1);}},j,{});this._super(h,j,g);},serverRequestQueue:function Q(e,f,d){if(D.getEnvObj().isWS()){this.serverRequestParallelNative(e,f,d);}else{this.serverRequestParallel(e,f,d);}},serverRequestParallel:function F(e,f,d){window.setTimeout(this.serverProxy.serverRequestParallel.bind(this.serverProxy,e,f,d),0);},redirectToPage:function Y(d){this.showProgress();mstrmojo.form.send(d,mstrApp.name,"POST",null,null,false);},updateSessionState:function L(d){this._super(d);if(this.activeRequests){this.activeRequests.forEach(function(e){if(e.sessionState){e.sessionState=d;}});}},oneTierOAuthHandler:function X(d){if(this.rootController.oAuthController){this.rootController.oAuthController.oneTierOAuthHandler(d);}},sdkConnectorOAuthHandler:function M(d){mstrApp.getRootController().model.raiseEvent({name:"getConnectorParameter",data:d});},cleanUpDIStyles:function(){var e,d;if(D.getEnvObj().isWeb()){e=document.querySelectorAll('link[rel=stylesheet][href*="/data-import"]');if(e.length>0){d=e[0];if(d.parentNode){d.parentNode.removeChild(d);if(window.microstrategy!==undefined&&microstrategy){var f=microstrategy.resourceLoader.buildURI("data-import.css","css",true);if(microstrategy.resourceLoader.status){delete microstrategy.resourceLoader.status[f];}}}}}}});window.$MAPF=function(){return false;};}());(function(){mstrmojo.requiresCls("mstrmojo.DI.DIApp","mstrmojo._IsPopup","mstrmojo.Container","mstrmojo.hash","mstrmojo._IsMovable","mstrmojo.DI.WorkstationServerProxy","mstrmojo.DI.WorkstationServerTransport");var E=mstrmojo.css;function H(){this.dataImportParams={isNewAnalysis:true,isEdit:false,isCloudPro:false,isEmmaCube:true,isDirectDataAccess:false,isManagedCube:false,ReportId:undefined,CubeName:undefined,FolderId:undefined,CubeDesc:undefined,AnalysisId:undefined,StatusCode:0,CreateAnalysis:1,CreateReportServices:1,CreateViewReport:1,CubeQuota:200,Delete:1,EnableFTPImport:true,EnableFileImport:true,EnableHttpImport:true,EnableURLImport:true,ShowDDAOptions:true,ImportDatabase:1,AccessDataFromFiles:1,AccessDataFromCloudApp:1,Republish:1,Share:1,Subscriptions:1,UploadSizeLimit:100,datasets:null,hasNonRADataset:false,documentModel:null,missingCredentialsData:null,refreshMultipleCubes:false};}mstrmojo.DI.DIContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.DI.DIContainer",id:"DIContainer",cssClass:"mstrmojo-di-popup",markupString:'<div id="{@id}" class="{@cssClass}"><div id="DIApp"></div><div class="mstrmojo-DIEditor-curtain"></div></div>',markupSlots:{curtainNode:function(){return this.domNode.lastChild;}},draggable:true,launchingApp:null,dataImportParams:null,init:function(I){if(this._super){this._super(I);}H.call(this);},getMovingHandle:function G(){return this.rootView.headerNode;},onOpen:function B(){this.launchingApp=mstrApp;var I=this.dataImportParams;window.mstrApp=new mstrmojo.DI.DIApp();mstrmojo.hash.copy({placeholder:"DIApp",isEdit:I.isEdit,isNewAnalysis:I.isNewAnalysis,isCloudPro:I.isCloudPro,isEMMACube:I.isEmmaCube,isPopup:true,showDDAOptions:I.showDDAOptions,diParams:I,refreshMultipleCubes:I.refreshMultipleCubes,features:this.launchingApp.features,cubeSaveFolderId:I.cubeSaveFolderId,rootControllerCls:I.rootControllerCls},mstrApp);var J=["isSingleTier","isWorkstation","projectName","serverName","serverPort","authMode","sessionManager","servletState","enableWarningSessionTimeout","maxSessionIdleTime","timeBeforeSessionTimeoutWarning","name","sessionState","persistTaskParams","helpUrl","helpLocaleId","localeId","userHelpPage","autocomplete","isCloud","features","isWSStyling"];if(this.launchingApp.serverProxy){J.push("serverProxy");}mstrmojo.hash.copyProps(J,this.launchingApp,mstrApp);var K=this.launchingApp.getWSLiveMode?this.launchingApp.getWSLiveMode():false;if(K){mstrApp.isSingleTier=false;mstrApp.serverProxy=new mstrmojo.DI.WorkstationServerProxy({transport:mstrmojo.DI.WorkstationServerTransport});}mstrApp.launchingApp=this.launchingApp;mstrApp.isFromVI=this.launchingApp.isVI;mstrApp.container=this;this.curtainNode.style.zIndex=this.domNode.style.zIndex-1;this.domNode.style.display="block";this.curtainNode.style.display="block";mstrApp.start();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("disable");}this.docMouseDown=document.onmousedown;document.onmousedown=null;this.docMouseMove=document.onmousemove;document.onmousemove=null;this.docMouseUp=document.onmouseup;document.onmouseup=null;E.toggleClass(document.body,"user-select-none",true);},close:function F(){if(this._super){this._super();}var I=window.mstrApp;window.mstrApp=this.launchingApp;mstrApp.sessionState=I.sessionState;I.destroy();this.domNode.style.display="none";this.curtainNode.style.display="none";H.call(this);this.destroy();if(mstrApp.isSingleTier){window.FormWrapper.toggleNetMenu("enable");}if(typeof (mstrApp.isWSStyling)!="undefined"&&!mstrApp.isVI){delete mstrApp.isWSStyling;}document.onmousedown=this.docMouseDown;document.onmousemove=this.docMouseMove;document.onmouseup=this.docMouseUp;E.toggleClass(document.body,"user-select-none",false);},preBuildRendering:function D(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},setPosition:function C(K,J){var I=this.domNode,L=I&&I.style;if(L){L.left=K;L.top=J;}},isDragValid:function A(I){var J=this.rootView.header.searchTable,K;K=this._super(I);if(K&&J.visible){K=!mstrmojo.dom.contains(J.domNode,I.src.node,true,this.getMovingHandle());}return K;}});}());