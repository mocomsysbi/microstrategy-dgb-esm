var xmjd=mstrmojo&&mstrmojo.descriptors;var mstrmojo={helpPath:function(){return(mstrApp.helpUrl||"../help/")+"MSTRWeb/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/Content/";},helpPathMobileAdmin:function(){return(mstrApp.helpUrl||"../help/")+"MobileAdmin/WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/";},upgradeHelpPath:function(){return(mstrApp.upgradeHelpUrl||"../help/")+"WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/Content/";},descriptors:xmjd||{},meta:{TP:"t",STP:"st"},emptyFn:function(){},tstid:function(B){var A;if(B){if(typeof (B)==="object"){A=B.tstid;}else{A=B;}}return A?'tstid="'+A+'"':"";},getMissingFn:function getMissingFn(){return function(){var C=this.scriptClass,A;try{for(A in this){if(this[A]===arguments.callee){C+="."+A;break;}}}catch(B){}throw new Error("Missing abstract method: "+C);};},now:function now(){return new Date().getTime();},usesFrames:false};(function(){mstrmojo.global=(function(){var F=function(){return this;};return F.call(null);}());mstrmojo.dbg=mstrmojo.emptyFn;mstrmojo.dbg_stack=mstrmojo.emptyFn;mstrmojo.dbg_xhr=mstrmojo.emptyFn;mstrmojo.dbg_profile=mstrmojo.emptyFn;mstrmojo.debugBundles=(function(){return(window.mstrConfig&&(mstrConfig.debugFlags!==undefined)&&((mstrConfig.debugFlags&4)>0));})();mstrmojo.platform={};mstrmojo.prompt={};mstrmojo.settings={};mstrmojo.models={datasets:{},template:{}};mstrmojo.ui={editors:{controls:{}},menus:{},pathbar:{}};mstrmojo.prefs={};mstrmojo.ACL={};mstrmojo.CMS={};mstrmojo.storage={};mstrmojo.maps={};mstrmojo.maps.androidmap={};mstrmojo.maps.jsmap={};mstrmojo.graph={};mstrmojo.IPA={};mstrmojo.IPA.Monitors={};mstrmojo.IPA.Alerts={};mstrmojo.IPA.Environment={};mstrmojo.IPA.Groups={};mstrmojo.IPA.Heartbeat={};mstrmojo.IPA.Managers={};mstrmojo.sm={};mstrmojo.sort={};mstrmojo.ME={};mstrmojo.architect={ui:{editors:{},panels:{},factories:{}},obj:{},menu:{},projectmanagement:{}};mstrmojo.warehouse={ui:{editors:{}},obj:{},dbroles:{},menu:{}};mstrmojo.plugins={};mstrmojo.AS={};mstrmojo.DI={controller:{},model:{},ui:{dialogs:{}}};mstrmojo.Refine={};mstrmojo.qb={bigquery:{},es:{},mdx:{},menu:{},thirdParty:{}};mstrmojo.WH={};mstrmojo.fe={};mstrmojo.txEditor={};mstrmojo.condTx={};mstrmojo.threshold={};mstrmojo.express={ui:{}};mstrmojo.rw={model:{},xtab:{}};mstrmojo.util={ui:{}};mstrmojo.android={controllers:{},factories:{},inputControls:{},large:{controllers:{},factories:{},ui:{}},medium:{controllers:{},factories:{},ui:{nativebar:{}}},selectors:{},ui:{},nativedialog:{}};mstrmojo.vi={controllers:{},factories:{},models:{editors:{}},enums:{},ui:{menus:{},editors:{fe:{},cm:{},nlp:{}},rw:{selectors:{},xtab:{}},tabs:{},toolbars:{},tutorial:{}},viz:{},util:{}};mstrmojo.onetier={controllers:{},vi:{acl:{},prefs:{model:{}},ui:{tutorial:{}}}};mstrmojo.config={vi:{},onetier:{}};mstrmojo.chart={common:{},enums:{},model:{enums:{}}};mstrmojo.nativeandroid={};mstrmojo.gm={};mstrmojo.ngm={};mstrmojo.heatmap={vi:{}};mstrmojo.netviz={};mstrmojo.imagelayout={};mstrmojo.kpicard={layout:{},editors:{}};mstrmojo.iphone={};mstrmojo.winphone={};mstrmojo.mstr={search:{}};mstrmojo.mstr.ui={};mstrmojo.gmaps={basemap:{},graphic:{},geometry:{},layer:{svg:{},canvas:{},mapbox:{}}};mstrmojo.esrimap={};mstrmojo.mapbox={ui:{selectors:{}}};mstrmojo.examples={};mstrmojo.home={controllers:{},models:{},views:{},ui:{}};mstrmojo.workstation={pages:{}};mstrmojo.err=function D(I,H){var G=I.name+': "'+I.message+'"';if(mstrmojo.debug){if(I.fileName){G+=" at\n    "+I.fileName;}if(I.hasOwnProperty("lineNumber")){G+=": "+I.lineNumber;}else{if(I.hasOwnProperty("line")&&I.sourceURL){var F=I.sourceURL.split("/");G+="("+F[F.length>1?F.length-1:0]+":"+I.line+")";}}}this.dbg(G);if(mstrmojo.Dialog){mstrmojo.error({longDesc:I.message,code:I.code},H,{title:I.name});}else{window.alert(G);}};mstrmojo.confirm=function B(F){return window.confirm(F);};mstrmojo.alert=function E(F){window.alert(F);};var C=!!(/return true/.test(String(function(){return true;})));mstrmojo.mixin=function A(J,H){if(J){H=H||{};var I=/this\.\_super/;var G=function(N,M){return function L(){var P=this._super;this._super=M;var O=N.apply(this,arguments||[]);this._super=P;return O;};};var F=J.__onmixin__;if(F){delete J.__onmixin__;}var K;for(K in J){if((typeof J[K]==="function")&&(!C||I.test(J[K]))){H[K]=G(J[K],H[K]);}else{H[K]=J[K];}}if(F){J.__onmixin__=F;}}return H;};}());(function(){var $XHR;var $MISSING={};var getApp=function(){return mstrmojo.global.mstrApp||{};},getJsRoot=function(){return getApp().jsRoot||"../javascript/";},getJsBundlesRoot=function(){return getJsRoot()+"bundles/";},getJsMojoRoot=function(){return getApp().jsMojoRoot||"../javascript/mojo/js/source/";},getPluginRoot=function(){return getApp().pluginRoot||"../plugins/";},getPluginMojoRoot=function(){return getApp().pluginMojoRoot||getJsMojoRoot();},isIE=!!document.all;function getXHR(){$XHR=self.XMLHttpRequest?new XMLHttpRequest():(self.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null);}function encodeParams(params){var x=-1,url=[],p;if(params){for(p in params){if(params.hasOwnProperty(p)){url[++x]=p+"="+encodeURIComponent(params[p]);}}}return url.join("&");}function appendUrlParams(method,baseUrl,params){if(method!=="GET"||!params){return baseUrl;}return baseUrl+"?"+encodeParams(params);}function syncXHR(method,baseUrl,params){var result=null;method=method.toUpperCase();if(!$XHR){getXHR();}if($XHR){try{var m=null,app=window.mstrApp;if(window.microstrategy!==undefined&&microstrategy){m=microstrategy;}params.taskContentType=params.taskContentType||"json";params.taskEnv="xhr";params.xts=mstrmojo.now();params=mstrmojo.addCSRFTokenToTaskParams(params);var ptp=(app&&app.persistTaskParams)||(m&&m.persistParams);if(ptp){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.hash.copy(ptp,params);}$XHR.open(method,appendUrlParams(method,baseUrl,params),false);$XHR.setRequestHeader("X-Requested-With","XMLHttpRequest");if(method!=="POST"){params=null;}else{params=encodeParams(params);$XHR.setRequestHeader("Content-type","application/x-www-form-urlencoded");}$XHR.send(params);result=$XHR.responseText||null;}catch(localerr){if(window.console){window.console.log(localerr);}}}return result;}function _jsGet(file,nullCheck){var js=mstrmojo.loadFileSync(file);if(js){try{eval(js);return nullCheck?!!verifyJsLoaded(nullCheck):true;}catch(localerr){window.alert("JavaScript compile error:\n\nFile: "+file+"\n\nError: "+localerr.message);}}return false;}mstrmojo.requiresBundle=function reqBundle(bundleName){return _jsGet(getJsBundlesRoot()+bundleName);};mstrmojo.requiresDepLib=function requiresDepLib(file,AMD){if(reqCache[file]){return true;}function isAMD(){return"function"===typeof define&&define.amd;}var AMDCache=window.define;if(!AMD&&isAMD()){delete window.define;}var value=_jsGet(file);reqCache[file]=true;window.define=AMDCache;return value;};mstrmojo.loadFileSync=function loadFileSync(file){var result=null;if(!$XHR){getXHR();}if($XHR){try{$XHR.open("GET",file+((window.mstrConfig&&mstrConfig.webVersion)?"?v="+mstrConfig.webVersion:""),false);$XHR.setRequestHeader("X-Requested-With","XMLHttpRequest");$XHR.send(null);result=$XHR.responseText||null;}catch(localerr){}if(!isIE&&$XHR.abort){$XHR.abort();}}return result;};mstrmojo.insertCSSLinks=function insertCSSLinks(files){var css,firsthead;if(files&&files.length>0){firsthead=document.getElementsByTagName("head")[0];files.forEach(function(file){css=document.createElement("link");css.setAttribute("id",file.replace(/[^a-zA-Z0-9]/g,""));css.setAttribute("rel","stylesheet");css.setAttribute("type","text/css");css.setAttribute("href",file);firsthead.appendChild(css);});}};mstrmojo.loader={loaded:{mstrmojo:true,"mstrmojo.loader":true},isLoaded:function isLd(fqcn){var isLoaded=!!verifyJsLoaded(fqcn);if(isLoaded){this.loaded[fqcn]=true;}return isLoaded;},load:function ld(fqcn){if($MISSING[fqcn]){return false;}if(this.loaded[fqcn]||this.isLoaded(fqcn)){return true;}if(_jsGet(this.fqcnToFile(fqcn),fqcn)){this.loaded[fqcn]=true;return true;}$MISSING[fqcn]=true;return false;},fqcnToFile:function fqcnToFile(fqcn){if(fqcn.match(/^mstrmojo\.plugins\./)){var pluginName=fqcn.substring(17,fqcn.indexOf(".",17)),pluginFile=pluginName+"/javascript/"+getPluginMojoRoot()+fqcn.replace("mstrmojo.plugins."+pluginName+".","").replace(/\./gm,"/");if(mstrApp&&mstrApp.supportFeature&&mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode()&&mstrConfig.dossierServerPluginNames&&mstrConfig.dossierServerPluginNames.indexOf(pluginName)>-1){fqcn=mstrApp.dossierServerBaseUrl+"plugins/"+pluginFile;}else{fqcn=getPluginRoot()+pluginFile;}}else{if(fqcn.match(/^mstrmojo\./)){fqcn=getJsMojoRoot()+fqcn.replace("mstrmojo.","").replace(/\./gm,"/");}else{fqcn=getJsRoot()+fqcn.replace(/\./gm,"/");}}return fqcn+".js";}};var $LOADER=mstrmojo.loader,isLoaded=$LOADER.loaded;var reqCache={},addPackagesToReqCache=function addPkg(n,ns){var ps=n.split("."),klen=ps.length,k;for(k=1;k<klen;k++){var s=ps.slice(0,k).join(".");if(!reqCache[s]){ns.push(s);reqCache[s]=true;}}},loadInputScripts=function loadInputScripts(ns){var jlen=ns.length,j;for(j=0;j<jlen;j++){if(!$LOADER.load(ns[j])){window.alert("Warning: Javascript class not found:\n"+ns[j]);break;}}};mstrmojo.requiresCls=function reqCls(){var argLen=arguments.length,ns=[],i,len;for(i=0,len=argLen;i<len;i++){var n=arguments[i];if(!n||isLoaded[n]||$MISSING[n]){continue;}else{if(reqCache[n]){loadInputScripts([n]);reqCache[n]=false;continue;}}if(!n.match(/^mstrmojo\.plugins\./)){addPackagesToReqCache(n,ns);}ns.push(n);reqCache[n]=true;}loadInputScripts(ns);return true;};mstrmojo.requiresClsP=function reqClsP(){var argLen=arguments.length,ns=[],pkgName=arguments[0],i,len;addPackagesToReqCache(pkgName,ns);for(i=1,len=argLen;i<len;i++){var n=pkgName+"."+arguments[i];if(!n||isLoaded[n]||$MISSING[n]){continue;}else{if(reqCache[n]){loadInputScripts([n]);reqCache[n]=false;continue;}}if(!n.match(/^mstrmojo\.plugins\./)){ns.push(n);reqCache[n]=true;}}loadInputScripts(ns);return true;};var $DESCRIPTORS=mstrmojo.descriptors,descPrefix="mstrWeb.";function populateDescriptors(ds){if(ds){var dlen=ds.length,di;for(di=0;di<dlen;di++){var d=ds[di];$DESCRIPTORS[d.key]=d.v;}}}mstrmojo.populateDescriptors=populateDescriptors;if(window.mstrConfig!==undefined){populateDescriptors(mstrConfig.mstrDescs&&mstrConfig.mstrDescs.descriptors);mstrConfig.mstrDescs=null;}if(window.mstrApp!==undefined){populateDescriptors(mstrApp.mstrDescs&&mstrApp.mstrDescs.descriptors);}var requestDescriptor=function(prefix,ids){var ns=[],len=ids.length,i;for(i=0;i<len;i++){var k=ids[i];if(k&&!($DESCRIPTORS.hasOwnProperty(prefix+k))){ns.push(k);}}if(ns.length>0){var response=syncXHR("POST",(window.mstrConfig&&mstrConfig.taskURL)||"taskProc",{taskId:"getDescriptors",keys:ns.join(","),prefix:prefix});if(response){var r=JSON.parse(response.replace(/\\'/g,"'"));populateDescriptors(r&&r.descriptors);}}};mstrmojo.requiresDescsWPrefix=function reqDescP(prefix){var args=[].slice.call(arguments);args[0]=null;requestDescriptor(prefix,args);};mstrmojo.requiresDescs=function reqDesc(){if(window.mstrConfig!==undefined&&!mstrConfig.onMobileDevice){requestDescriptor(descPrefix,arguments);}};mstrmojo.desc=function desc(descID,defText){if(descID!==null&&descID!==undefined){mstrmojo.requiresDescs(descID);if($DESCRIPTORS.hasOwnProperty(descPrefix+descID)){return $DESCRIPTORS[descPrefix+descID];}defText=defText||"No string descriptor found for descID="+descID;}var decDefText="["+defText+"]";$DESCRIPTORS[descPrefix+descID]=decDefText;return decDefText;};mstrmojo.descP=function descP(prefix,descID,defText){mstrmojo.requiresDescsWPrefix(prefix,descID);if($DESCRIPTORS.hasOwnProperty(prefix+descID)){return $DESCRIPTORS[prefix+descID];}defText=defText||"No string descriptor found for descID="+descID;var decDefText="*"+defText+"*";$DESCRIPTORS[prefix+descID]=decDefText;return decDefText;};mstrmojo.provide=function prv(fqcn,cls){isLoaded[fqcn]=!!cls;return cls;};mstrmojo.invalidateCls=function rel(fqcn){reqCache[fqcn]=false;isLoaded[fqcn]=false;this.invalidateJsLoaded(fqcn);};var mx=mstrmojo.mixin;mstrmojo.declare=function declare(SuperCls,mixins,config){function Constr(props){if((!props||!props.dontInit)&&this.init){this.init(props);}}if(SuperCls){Constr.prototype=new SuperCls({dontInit:true});Constr.prototype.constructor=Constr;}var proto=Constr.prototype;var cnt=(mixins&&mixins.length)||0,i;for(i=0;i<cnt;i++){mx(mixins[i],proto);}if(config){mx(config,proto);if(config.scriptClass){isLoaded[config.scriptClass]=true;}}return Constr;};mstrmojo.findAncestor=function findAncestor(src,property,value,limitClass){var ancestor=src&&src.parent;while(ancestor&&(!limitClass||!(ancestor instanceof limitClass))){var targetProperty=ancestor[property];if(targetProperty!==undefined){if(value!==undefined&&value!==null){if(targetProperty===value){return ancestor;}}else{return ancestor;}}ancestor=ancestor.parent;}return null;};mstrmojo.isDescendant=function isDescendant(parent,child){var ancestor;if(!child||!parent){return false;}ancestor=child.parent;while(ancestor){if(ancestor===parent){return true;}ancestor=ancestor.parent;}return false;};mstrmojo.getCSRFToken=function getCSRFToken(url){var tkn=null;try{if(url){if(url.indexOf("validateRandNum=")>=0){return tkn;}if(this.isUrlExternal(url)){return tkn;}}if(window.mstrApp&&mstrApp.validateRandNum){tkn=mstrApp.validateRandNum;}else{if(window.mstrConfig&&mstrConfig.validateRandNum){tkn=mstrConfig.validateRandNum;}else{if(window.microstrategy!==undefined&&microstrategy&&microstrategy.validateRandNum){tkn=microstrategy.validateRandNum;}}}}catch(err){}return tkn;};mstrmojo.addCSRFTokenToURL=function addCSRFTknToURL(url){if(!url){return"";}var tkn=mstrmojo.getCSRFToken(url);if(tkn&&tkn.length>0){if(url.indexOf("?")>-1){url+="&";}else{url+="?";}url+="validateRandNum="+tkn;}return url;};mstrmojo.addCSRFTokenToTaskParams=function addCSRFTknToTaskParams(params){if(params){var tkn=mstrmojo.getCSRFToken();if(tkn&&tkn.length>0){params.validateRandNum=tkn;}}return params;};mstrmojo.getInstance=function getInstance(config){var Clazz=mstrmojo.hash.walk(config.scriptClass,window);if(Clazz){return new Clazz(config);}return null;};mstrmojo.isUrlExternal=function isUrlExternal(url){var curURL=window.location.href;var servletName=window.mstrApp&&mstrApp.name,taskProcName=window.mstrConfig.taskURL&&mstrConfig.taskURL,isSameWebApp=(url.indexOf("?")===0||url.indexOf(servletName)===0||url.indexOf("./"+servletName)===0||url.indexOf(taskProcName)===0||url.indexOf("./"+taskProcName)===0||url.indexOf(curURL)===0||((curURL.indexOf("?")>0)&&(url.indexOf(curURL.substring(0,curURL.indexOf("?")))===0)));return !isSameWebApp;};mstrmojo.resolveFeature=function resolveFeature(feature){var features=mstrApp.features;return features&&features[feature];};mstrmojo.getStyleRoot=function getStyleRoot(){var c=mstrConfig||{},styleRoot=c.styleRoot||"../style";return styleRoot;};mstrmojo.getJsRoot=getJsRoot;function verifyJsLoaded(name){name=name.trim();var path=name.split(".");var o=window;for(var i=0;i<path.length;i++){o=o[path[i]];if(!o){break;}}return o;}mstrmojo.invalidateJsLoaded=function invalidateJsLoaded(name){var path=name&&name.trim().split("."),len=(path&&path.length)||0,tmp=window,i;for(i=0;i<len-1;i++){if(!tmp){return ;}tmp=tmp[path[i]];}if(tmp&&path[i]){tmp[path[i]]=undefined;}};}());(function(){function D(K){var J=this.h.idx;if(J!==-1){return this.t.es[J][K];}return"";}mstrmojo.models.template.Header=mstrmojo.declare(null,null,{init:function H(J){this.h=J.h;this.t=J.t;},getName:function A(){return D.call(this,"n");},getElementId:function I(){return D.call(this,"id");},getObjectId:function B(){return D.call(this,"oid");},getElementIndex:function G(){return this.h.idx;},getActionType:function F(){return this.h.at;},isTotal:function E(){return this.h.otr===1;},getFormIndex:function C(){return this.h.fi;}});}());(function(){function B(J,E){if(!E.domNode){return 0;}var K="_fixed"+J;if(E[K]){return E[K];}var H=E.getFormats(),I=J.toLowerCase();if(H&&H.hasOwnProperty(I)){var F=H[I];if(F.charAt(F.length-1)!=="%"){var G=parseInt(F,10);if(!isNaN(G)){E[K]=G;return G;}}}return(E.domNode["client"+J]||0);}mstrmojo._ContainsDocObjects=mstrmojo.provide("mstrmojo._ContainsDocObjects",{getHeight:function D(){return B("Height",this);},getWidth:function A(){return B("Width",this);},getMaxZIndex:function C(){var F=0;mstrmojo.array.forEach(this.children,function E(G){F=Math.max(F,G.getFormats()["z-index"]);});return F;}});}());mstrmojo.EnumSelectionType={ALL:0,ELEMENT:1,BRANCH:2,LEVEL:3,BRANCH_LEVEL:4};mstrmojo.chart.model.enums.EnumDSSGraphMarkerShape={DssGraphMarkerShapeNone:0,DssGraphMarkerShapeRectangle:1,DssGraphMarkerShapeStar45:2,DssGraphMarkerShapePlus:3,DssGraphMarkerShapeCircle:4,DssGraphMarkerShapeDiamond:5,DssGraphMarkerShapeSpikedX:6,DssGraphMarkerShapePlainX:7,DssGraphMarkerShapeTriangle1:8,DssGraphMarkerShapeFatPlus:10,DssGraphMarkerShapeSquare:24,DssGraphMarkerShapeHouse:27,DssGraphMarkerShapeStar5:37,DssGraphMarkerShapeGMTick:200,DssGraphMarkerShape2DPie:201,DssGraphMarkerShape2DRingPie:202,DssGraphMarkerShapeCombined:203,DssGraphMarkerShapeGMPolyLine:204,DssGraphMarkerShapeGMBar:205,DssGraphMarkerShapeGMArea:206,DssGraphMarkerBullet:207};mstrmojo.mstr.EnumNodeDimty={NodeDimtyReserved:0,NodeDimtyNone:1,NodeDimtyContinuation:2,NodeDimtyExclusiveContinuation:3,NodeDimtyOutputLevel:4,NodeDimtyBreakBy:5,NodeDimtyEmbedded:6,NodeDimtyUnspecified:7};mstrmojo.mstr.EnumDSSEmptyGraphMsgType={DssEmptyData:0,DssNoDataSet:1,DssAEErrorMessage:2,DssNoTemplateUnit:3};(function(){mstrmojo.vi._MonitorsAppState=mstrmojo.provide("mstrmojo.vi._MonitorsAppState",{onAppStateChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("appStateChange",this.id,"onAppStateChange");}}});}());(function(){function AM(Ax,Ay){return Ay||(Ax||window).event;}function p(Ax){var Ay=parseInt(Ax,10);return Ay===null||isNaN(Ay)?0:Ay;}mstrmojo.PositionType=null;var At=!!document.all,AK=document.documentMode,v=navigator.userAgent,n=false,l=false,j=false,h=false,V=false,S=!At&&"ActiveXObject" in window,x=false;At=At||S;if(At){if(window.mstrConfig&&mstrConfig.isEdgeModeEnabled){n=!!v.match(/MSIE 6/);l=((!!v.match(/MSIE 7/)&&!AK)||AK===7);j=(AK===8);h=(AK===9);V=(AK===10);x=(!AK||AK<=9);}else{n=!!v.match(/MSIE 6/);l=!!v.match(/MSIE 7/);j=!!v.match(/MSIE 8/);h=!!v.match(/MSIE 9/);V=!!v.match(/MSIE 10/);x=!V;}}var g=!At&&!!v.match(/Firefox/),q=0,w=!!v.match(/Android/),Aj=!!v.match(/iPad/),AR=!!v.match(/iPhone/),AZ=!!document.createTouch||w,u=!!v.match(/PlayBook/),Q=!!v.match(/Windows Phone/),Au=!At&&!!v.match(/Trident.*rv/),f=g?"-moz-":(At||Au)?"":"-webkit-",AL=g?"Moz":(V||Au)?"":At?"ms":"webkit",AW=((V||Au)?"t":"T"),AQ=AL+AW+"ransition";function Ao(){return AL+AW+"ransform";}function AI(){return AQ+"Property";}function W(){return AQ+"Duration";}function P(){return(V||g)?"transitionend":"webkitTransitionEnd";}function k(){return AL+"BoxShadow";}var Ar=Ao(),Af=AI(),AD=W(),A=P(),s=k();function AV(){if(!q&&g){var Ax=v.match(/.*Firefox\/([\d|\.]*).*/);if(Ax){q=parseFloat(Ax[1]);}}return q;}function Ab(){var Ay=0,A2=0,Az=window,A0=document,Ax=A0.body,A1=A0.documentElement;if(typeof Az.pageYOffset==="number"){A2=Az.pageYOffset;Ay=Az.pageXOffset;}else{if(Ax&&(Ax.scrollLeft||Ax.scrollTop)){A2=Ax.scrollTop;Ay=Ax.scrollLeft;}else{if(A1&&(A1.scrollLeft||A1.scrollTop)){A2=A1.scrollTop;Ay=A1.scrollLeft;}}}return{x:Ay,y:A2};}function AJ(Ax){Ax=Ax||0;Ax=String(Ax);return((Ax.indexOf("%",0))!==-1)?Ax:(Ax+"px");}function AT(Az,A3,A2,A1,A0){if(!mstrmojo.dom.isWinPhone){A1=(A1||false||this.isHWAccelerated);}else{A1=false;}var Ay=A0+(A1?"3d":"")+"(",Ax=A1?(","+A2+")"):")";return Ay+Az+","+A3+Ax;}var Ah=2,Z=3;function z(A3,A2,A6){var A5=A3.style,Az=A5.display,A1=this.windowDim(),A0=Ab();A5.display="block";var A4=A1.w-A3.clientWidth,A7=Math.max(A1.h-A3.clientHeight,0),Ax={4:0,5:A4,3:A4/2},Ay={1:0,3:A7/2,2:A7};A5.left=Ax[A2]+A0.x+"px";A5.top=Ay[A6]+A0.y+"px";A5.display=Az;}function r(A0,Az,A1,Ax){if(A0.addEventListener){return A0.addEventListener(Az,A1,!!Ax);}A1._id=A1._id||r.guid++;A0.events=A0.events||{};var Ay=A0.events[Az];if(!Ay){Ay=A0.events[Az]={};if(A0["on"+Az]){Ay[0]=A0["on"+Az];}}Ay[A1._id]=A1;function A2(A5){A5=A5||window.event;var A4=this.events[A5.type],A3;for(A3 in A4){A4[A3].call(this,A5);}}A0["on"+Az]=A2;}r.guid=1;function m(Az,Ay,A0,Ax){if(!Az){return ;}if(Az.removeEventListener){Az.removeEventListener(Ay,A0,!!Ax);}else{if(Az.events&&Az.events[Ay]){delete Az.events[Ay][A0._id];}}}mstrmojo.Enum_Keys={BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};mstrmojo.dom=mstrmojo.provide("mstrmojo.dom",{userAgent:v,isIE:At,isIE6:n,isIE7:l,isIE8:j,isIE9:h,isIE10:V,isIE11:S,isIEW3C:Au,isNSIE:x,isDXIE:x,isFF:g,isWK:!!v.match(/AppleWebKit/),isSafari:!!v.match(/Safari/)&&!v.match(/Chrome/),isChrome:!!v.match(/AppleWebKit/)&&v.match(/Chrome/),isEdge:!!v.match(/Edge/),isHWAccelerated:!w,isAndroid:w,isIPad:Aj,isPlayBook:u,isWinPhone:Q,isMobile:Aj||AR||Q||w,isIOSTouch:(Aj||AR)&&!window.MSStream,supportsTouches:AZ,TOUCHSTART:AZ?"touchstart":"mousedown",TOUCHMOVE:AZ?"touchmove":"mousemove",TOUCHEND:AZ?"touchend":"mouseup",TOUCHCANCEL:AZ?"touchcancel":"",RESIZE:AZ?"orientationchange":"resize",CSS3_PREFIX:f,CSS3_BOXSHADOW:s,CSS3_TRANSFORM:Ar,CSS3_TRANSITION:AQ,CSS3_TRANSITION_PROPERTY:Af,CSS3_TRANSITION_DURATION:AD,CSS3_TRANSITION_END:A,cssFeatures:{GRADIENTS:"gd",ROUND_CORNERS:"rc",TEXT_ROTATION:"tr",DROP_SHADOW:"sh"},htmlFeatures:{FILE_READER:"fr"},MOUSE_BUTTON:{LEFT:1,RIGHT:2},supports:function B(Ax){var Ay=this.isFF&&AV();switch(Ax){case this.cssFeatures.GRADIENTS:return(this.isIE||this.isIEW3C||this.isWK||Ay>=3.6||this.isWinPhone);case this.cssFeatures.ROUND_CORNERS:return(this.isWK||this.isFF||this.isWinPhone||this.isIE10);case this.cssFeatures.TEXT_ROTATION:case this.cssFeatures.DROP_SHADOW:return(this.isIE||this.isWK||Ay>=3.5||this.isWinPhone||this.isIE10||this.isIEW3C);case this.htmlFeatures.FILE_READER:return !!(window.FileReader);}return false;},getOSInfo:function AS(){var A2="Unknown",Ay=navigator.appVersion,A1=navigator.userAgent,A0=A2;var Ax=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];var Az;for(Az=0;Az<Ax.length;Az++){var A4=Ax[Az];if(A4.r.test(A1)){A0=A4.s;break;}}var A3=A2;if(/Windows/.test(A0)){A3=/Windows (.*)/.exec(A0)[1];A0="Windows";}switch(A0){case"Mac OS X":A3=/Mac OS X (10[\.\_\d]+)/.exec(A1)[1];break;case"Android":A3=/Android ([\.\_\d]+)/.exec(A1)[1];break;case"iOS":A3=/OS (\d+)_(\d+)_?(\d+)?/.exec(Ay);A3=A3[1]+"."+A3[2]+"."+(A3[3]|0);break;}return{name:A0,version:A3};},transEndEvtNames:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},animationEndEvtNames:{WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",MozAnimation:"animationend",animation:"animationend"},replace:function t(Az,Ax){if(Az&&Ax){var Ay=Az.parentNode;if(Ay){Ay.replaceChild(Ax,Az);}}return Ax;},attachEvent:function b(Az,Ay,A0,Ax){if(Az.addEventListener){return Az.addEventListener(Ay,A0,!!Ax);}return Az.attachEvent("on"+Ay,A0);},detachEvent:function Ad(Az,Ay,A0,Ax){if(!Az){return ;}if(Az.removeEventListener){Az.removeEventListener(Ay,A0,!!Ax);}else{Az.detachEvent("on"+Ay,A0);}},attachMarkupEvent:function AB(A0,Az,Ax){var Ay=function(A1){mstrmojo.all[A0].captureDomEvent(Ax,window,A1);};this.attachEvent(Az,Ax,Ay);return Ay;},attachOneTimeEvent:function a(A0,Ay,A1,Ax){var Az=function(A2){A1(A2);if(Ax){m(this,Ay,Az);}else{mstrmojo.dom.detachEvent(this,Ay,Az);}};if(Ax){r(A0,Ay,Az);}else{this.attachEvent(A0,Ay,Az);}A0=null;return Az;},attachMouseMoveEvents:function D(A0,Ax){var Az=this,Ay=function(A1){if(Ax){Ax(A1);}Az.detachEvent(document,"mousemove",A0);Az.detachEvent(document,"mouseup",Ay);};Az.attachEvent(document,"mousemove",A0);Az.attachEvent(document,"mouseup",Ay);},captureDomEvent:function AP(A2,A0,Ay,A1,Az){var Ax=mstrmojo.all[A2];if(Ax){Ax.captureDomEvent(A0,Ay,A1,Az);}},captureEventInfo:function AO(A0){var Ay=mstrmojo.hash.copy(A0,{}),Az=Ay.hWin=Ay.hWin||window,Ax=Ay.e=Ay.e||Az.event;Ay.node=this.eventTarget(Az,Ax);Ay.pos=this.getMousePosition(Ax,Az);return Ay;},translate:function N(Az,Ay,A2,A1,Ax,A0){Ax=(Ax&&" "+Ax)||"";Az.style[((mstrmojo.dom.isWinPhone||mstrmojo.dom.isIE9||mstrmojo.dom.isIE10)?"ms":"webkit")+"Transform"]=this.createTranslateString(Ay,A2,A1,A0)+Ax;},createTranslateString:function R(Ax,A0,Az,Ay){Ax=AJ(Ax);A0=AJ(A0);Az=AJ(Az);return AT(Ax,A0,Az,Ay,"translate");},createScaleString:function AA(Ax,A0,Az,Ay){Ax=Ax||0;A0=A0||0;Az=Az||0;return AT(Ax,A0,Az,Ay,"scale");},_bufferSize:200,_bufferConnects:{},attachBufferedEvent:function C(Az,Ax,A0,A2){var Ay=Az.id+"-"+Ax,A1=this._bufferConnects[Ay];if(!A1){A1=this._bufferConnects[Ay]={elId:Az.id,eventName:Ax,timer:null,bufferSize:A2,listeners:[],callback:function(A3){mstrmojo.dom._callback(A3,mstrmojo.global,Ay);return true;}};this.attachEvent(Az,Ax,A1.callback);}A1.listeners.push(A0);},_callback:function An(A1,Ax,Az){var A0=this._bufferConnects[Az],A2=A0&&A0.timer;if(A0&&!A2){var Ay=(A0.bufferSize===null)?this._bufferSize:A0.bufferSize;if(A0.bufferSize){A0.timer=Ax.setTimeout(function(){mstrmojo.dom.updateBuffers(Az);},Ay);}else{mstrmojo.dom.updateBuffers(Az);}}},updateBuffers:function J(A0){var A1=this._bufferConnects[A0],Ay=A1&&A1.listeners,Ax=(Ay&&Ay.length)||0,Az;for(Az=0;Az<Ax;Az++){Ay[Az]();}if(A1&&A1.timer){delete A1.timer;}},detachBufferedEvent:function AG(Ay,A2,A3){if(!Ay){return ;}var A5=Ay.id+"-"+A2,Az=this._bufferConnects[A5],A1=Az&&Az.listeners,A4=(A1&&A1.length)||0,A0;if(A4){for(A0=A4-1;A0>-1;A0--){if(A1[A0]===A3){A1.splice(A0,1);}}if(!A1.length){this.detachEvent(Ay,A2,Az.callback);delete this._bufferConnects[A5];if(Az.timer){var Ax=mstrmojo.global;Ax.clearTimeout(Az.timer);}}}},eventTarget:function AE(Ax,Ay){Ay=AM(Ax,Ay);return Ay.target||Ay.srcElement;},isMac:function AC(){return this.getOSInfo().name.toLowerCase().indexOf("mac")>=0;},isMetaKey:function L(Ax,A0){var Az=this.getOSInfo().name.toLowerCase().indexOf("mac")>=0,Ay=AM(Ax,A0)||{};return(Ay.ctrlKey&&!Az)||(Ay.metaKey&&Az);},ctrlKey:function Aq(Ax,Ay){return(AM(Ax,Ay)||{}).ctrlKey;},shiftKey:function AF(Ax,Ay){return(AM(Ax,Ay)||{}).shiftKey;},metaKey:function d(Ax,Ay){return(AM(Ax,Ay)||{}).metaKey;},getButton:function AX(Ax,Ay){return((Number(AM(Ax,Ay).button))===2)?2:1;},isPrimaryMouseBtn:function Ak(Ay,Ax){return this.getButton(Ax||window,Ay)===1;},isRMC:function Ag(Ay,Ax){return Ay&&(Ay.button===2||Ay.type==="contextmenu"||this.isMac()&&this.ctrlKey(Ax,Ay)&&Ay.button===0);},getMousePosition:function o(A0,Az){Az=Az||window;var Ay,A3;if(mstrmojo.dom.isIE){A0=A0||Az.event;var A1=document,Ax=A1.body,A2=A1.documentElement;Ay=A0.clientX+Ax.scrollLeft+(A2.scrollLeft||0);A3=A0.clientY+Ax.scrollTop+(A2.scrollTop||0);}else{Ay=A0.pageX;A3=A0.pageY;}return{x:Ay,y:A3};},position:function AY(Ay,Az){var A2={x:0,y:0,w:0,h:0};if(Ay&&Ay.getBoundingClientRect){try{A2=Ay.getBoundingClientRect();}catch(A1){A2={left:0,top:0,right:0,bottom:0,height:0,width:0};}A2={x:A2.left,y:A2.top,w:A2.right-A2.left,h:A2.bottom-A2.top};if(this.isIE6||this.isIE7){var Ax=Ay.ownerDocument;if(Ax){var A4=Ax.documentElement,A3=A4.getBoundingClientRect();A2.x-=A3.left;A2.y-=A3.top;}}}if(Az){var A0=Ab();A2.x+=A0.x;A2.y+=A0.y;}return A2;},delta:function G(Az,Ax){Ax=Ax||document.body;var Ay=this.position(Az),A0=this.position(Ax);return{x:Math.round(Ay.x-A0.x),y:Math.round(Ay.y-A0.y)};},windowDim:function U(){var Ax=0,Az=0,A0=window,A1=document,A2=A1.documentElement,Ay=A1.body;if(typeof (A0.innerWidth)=="number"&&typeof (A0.innerHeight)=="number"){Ax=A0.innerWidth;Az=A0.innerHeight;}else{if(A2&&(A2.clientWidth||A2.clientHeight)){Ax=A2.clientWidth;Az=A2.clientHeight;}else{if(Ay&&(Ay.clientWidth||Ay.clientHeight)){Ax=Ay.clientWidth;Az=Ay.clientHeight;}}}return{w:Ax,h:Az};},center:function AN(Ax){z.call(this,Ax,Z,Z);},bottomCenter:function E(Ax){z.call(this,Ax,Z,Ah);},clearBrowserHighlights:function M(Ax){Ax=Ax||self;if(!Ax.getSelection){var A3=Ax.document,A2=A3&&A3.selection,A0=A2&&A2.empty;if(A0){try{A2.empty();}catch(Az){}}}else{var Ay=Ax.getSelection,A1=Ay&&Ax.getSelection();if(A1&&!A1.isCollapsed){if(A1.empty){A1.empty();}else{if(A1.removeAllRanges){A1.removeAllRanges();}}}}},findAncestorByAttr:function AU(A1,Az,Ay,Ax){var A2=Ay?A1:A1&&A1.parentNode;while(A2&&(A2!==Ax)){var A0=A2.getAttribute&&A2.getAttribute(Az);if(A0!=null){return{node:A2,value:A0};}A2=A2.parentNode;}return null;},findAncestorByName:function Ap(Az,A2,Ay,Ax){A2=A2&&A2.toLowerCase();var A0=Ay?Az:Az&&Az.parentNode;while(A0&&(A0!==Ax)){var A1=A0.nodeName;if(A1&&(A1.toLowerCase()===A2)){return A0;}A0=A0.parentNode;}return null;},contains:function K(A0,A1,Ay,Ax){var Az=A1;if(!Ay){Az=Az.parentNode;}while(Az){if(Az===A0){return true;}if(Az===Ax){break;}Az=Az.parentNode;}return false;},toggleSelection:function Av(Ay,Ax){Ay.setAttribute("unselectable",Ax?"off":"on");mstrmojo.css.toggleClass(Ay,"unselectable",!Ax);Ay.onselectstart=function(){return Ax;};if(!Ax){this.clearBrowserHighlights();}},preventDefault:function Y(Ax,Ay){Ay=Ay||Ax.event;if(Ay.preventDefault){Ay.preventDefault();}else{Ay.returnValue=false;}},stopPropogation:function O(Ax,Ay){Ay=Ay||Ax.event;if(Ay.stopPropagation){Ay.stopPropagation();}else{Ay.cancelBubble=true;}},firstTouch:function Aa(Ax,Ay){return Ay&&Ay.touches&&Ay.touches.length?Ay.touches[0]:(Ay||Ax.event);},firstChangedTouch:function Ai(Ax,Ay){return Ay&&Ay.changedTouches&&Ay.changedTouches.length?Ay.changedTouches[0]:(Ay||Ax.event);},isLandscape:function X(){return !this.supportsTouches||(Math.abs(window.orientation)===90);},findWidget:function Ac(Ax){while(Ax){var Ay=Ax.mstrmojoId;if(Ay!==null&&Ay!==undefined){return mstrmojo.all[Ay];}Ax=Ax.parentNode;}return null;},setCaret:function H(Ax,Az){if(Ax.setSelectionRange){Ax.focus();Ax.setSelectionRange(Az,Az);}else{if(Ax.createTextRange){var Ay=Ax.createTextRange();Ay.move("character",Az);Ay.select();}}},setInputSelection:function c(Ax){if(Ax.select){Ax.focus();Ax.select();}else{if(Ax.createTextRange){Ax.createTextRange().select();}}},setElementSelection:function e(Az){if(window.getSelection){var Ax=document.createRange(),Ay=window.getSelection();Ax.selectNodeContents(Az);Ay.removeAllRanges();Ay.addRange(Ax);}else{if(document.body.createTextRange){var A0=document.body.createTextRange();A0.moveToElementText(Az);A0.select();}}},getHorizontalScroll:function As(){return Ab().x;},getVerticalScroll:function AH(){return Ab().y;},getMaxScrollHeight:function I(){return mstrmojo.dom.windowDim().h-22;},getComputedScrollbarWidth:function Al(Ay){if(Ay){var Ax=mstrmojo.css.getComputedStyle(Ay);if(Ax){return(Ay.offsetWidth-p(Ax.borderLeftWidth)-p(Ax.borderRightWidth)-Ay.clientWidth);}}return null;},removeNode:function Am(Az){var Ay=document.getElementById(Az),Ax=Ay&&Ay.parentNode;if(Ax){return Ax.removeChild(Ay);}},redirectUrlToFormWrapper:function Ae(A0){var Az=function Az(A2){A2.preventDefault();var A4=A2.target,A3=A4&&A4.href;if(A3&&window&&window.FormWrapper){window.FormWrapper.openPage(A3.replace(/ /g,"%20"));}};var A1=A0&&A0.getElementsByTagName("a"),Ay=A1.length;for(var Ax=0;Ax<Ay;Ax++){if(!A1[Ax].openWithFormWrapper){A1[Ax].addEventListener("click",Az,true);A1[Ax].openWithFormWrapper=true;}}},checkTagName:function Aw(Ay,Ax){return Ay&&Ay.tagName&&Ay.tagName.toLowerCase()===Ax;},getComputedMargin:function F(Ay){var Ax=mstrmojo.css.getComputedStyle(Ay);return[parseInt(Ax.marginTop,10)||0,parseInt(Ax.marginRight,10)||0,parseInt(Ax.marginBottom,10)||0,parseInt(Ax.marginLeft,10)||0];}});}());(function(){mstrmojo.vi.ui._IsValidURL=mstrmojo.provide("mstrmojo.vi.ui._IsValidURL",{_mixinName:"mstrmojo.vi.ui._IsValidURL",isValidURL:function A(B){var C=!!B&&B.toLowerCase();return !!C&&(C.indexOf("javascript:")===-1)&&(!mstrApp.isSingleTier||C.startsWith("http://")||C.startsWith("https://"));}});}());mstrmojo.vi.viz.EnumVizStyles={GRAPH_MATRIX:"GraphMatrixVisualizationStyle",NETWORK:"NetworkVisualizationStyle",HEAT_MAP:"VIHeatMapVisualizationStyle",GOOGLE_MAP:"GoogleMapVisualizationStyle",ESRI_MAP:"ESRIMapVisualizationStyle",IMAGE_LAYOUT:"ImageLayoutVisualizationStyle",NEW_GRAPH_MATRIX:"NewGraphMatrixVisualizationStyle",MAPBOX:"MapboxVisualizationStyle",KPICARD:"KPICardVisualizationStyle"};mstrmojo.gm.GMEnums={};mstrmojo.gm.DualAxisSubAxisBit={PRIMARY:0,SECONDARY:1};mstrmojo.gm.StackExetrmeId={PRIMARY_Y_AXIS:-2,SECONDARY_Y_AXIS:-18,PRIMARY_X_AXIS:-1,SECONDARY_X_AXIS:-17};mstrmojo.gm.FormNameType={OFF:0,ON:1,FORM_NAME_ONLY:2,SHOW_ATT_NAME_ONCE:3,AUTO:4};mstrmojo.gm.EnumSelectionOptionLevel={GLOBAL:1,ITSELF:2,ATTS_METRIC_COMBINATION:3,METRIC_AXIS:4,METRIC:5,AXIS:6,COLOR_BY:7,ALL_SHAPE:8,ITSELF_RESOLVED:9};mstrmojo.gm.EnumLabelRotation={VERTICAL:2,HORIZONTAL:0,AUTOMATIC:-1};mstrmojo.gm.EnumIdentityType={LEGEND:Math.pow(2,0),GRAPH_SHAPE:Math.pow(2,1),X_AXIS:Math.pow(2,2),Y_AXIS:Math.pow(2,3),X2_AXIS:Math.pow(2,4),Y2_AXIS:Math.pow(2,5),GRID_LINE:Math.pow(2,6),TREND_LINE:Math.pow(2,7),REF_LINE:Math.pow(2,8),DATA_LABEL:Math.pow(2,9),COLOR_SQUARE:Math.pow(2,10),ROW_TITLE:Math.pow(2,11),COL_TITLE:Math.pow(2,12),ROW_HEADER:Math.pow(2,13),COL_HEADER:Math.pow(2,14),LOG_SCALE:Math.pow(2,15),H_MATRIX_LINE:Math.pow(2,16),V_MATRIX_LINE:Math.pow(2,17),LEGEND_TEXT:Math.pow(2,18),SHAPE_COLLECTION:Math.pow(2,19),MINOR_GRID_LINE:Math.pow(2,20),AXIS_SCALE:Math.pow(2,22),AXIS_ORIGIN:Math.pow(2,23),ROWS_BACKGROUND:Math.pow(2,24),COLS_BACKGROUND:Math.pow(2,25),X_NUMERIC:Math.pow(2,26),X_CATEGORY:Math.pow(2,27),Y_NUMERIC:Math.pow(2,28),Y_CATEGORY:Math.pow(2,29),X_METRIC_AXIS_TITLE:Math.pow(2,30),Y_METRIC_AXIS_TITLE:Math.pow(2,31),VIZ_BOX_TITLE:Math.pow(2,32),REF_LINE_LABEL:Math.pow(2,33),LINE_MARKER:Math.pow(2,34),X_AXIS_ORIGIN_LABEL:Math.pow(2,35),Y_AXIS_ORIGIN_LABEL:Math.pow(2,36),X_AXIS_ORIGIN_LINE:Math.pow(2,37),Y_AXIS_ORIGIN_LINE:Math.pow(2,38),Y_ATTRIBUTE_AXIS_TITLE:Math.pow(2,39),ROW_HEADER_TEXT:Math.pow(2,40),ROW_TITLE_TEXT:Math.pow(2,41),COL_HEADER_TEXT:Math.pow(2,42),COL_TITLE_TEXT:Math.pow(2,43),VIZ_BOX_CONTAINER:Math.pow(2,44),X_ATTRIBUTE_AXIS_TITLE:Math.pow(2,45),AXIS_ORIGIN_DEFINE:Math.pow(2,46)};mstrmojo.gm.EnumGMZoneIds={ROWS:1,COLUMNS:2,XAXIS:3,YAXIS:4,BREAKBY:5,SLICEBY:6,COLORBY:7,SIZEBY:8,TOOLTIP:9,ANGLEBY:10};mstrmojo.gm.EnumClickType={NONE:-1,LEFT_CLICK:1,RIGHT_CLICK:2,DOUBLE_CLICK:3};mstrmojo.gm.EnumLegendSlot={RIGHT_TOP:1,RIGHT_MIDDLE:2,RIGHT_BOTTOM:3,LEFT_TOP:4,LEFT_MIDDLE:5,LEFT_BOTTOM:6,LEFT:7,RIGHT:8};mstrmojo.gm.EnumAxisType={ATTRIBUTE:0,METRIC:1};mstrmojo.gm.EnumGraphType={UNDEFINED:-1,AREA:1,BAR:2,LINE:3,SCATTER:4,BUBBLE:5,PIE:6,GRID:7,HISTOGRAM:8,BOXPLOT:9,WATERFALL:10};mstrmojo.gm.EnumContextMenu={SEPARATOR:0,KEEP_ONLY:1,EXCLUDE:2,SORT_ASCENDING:3,SORT_DESCENDING:4,CLEAR_SORT:5,SHOW_DATA:6,SWITCH_THEME:7,KEEP_ONLY_AND_SHOW:8,CLOSE_LEGEND:9,OPEN_LEGEND:10,AXIS_SCALE:11,DRILL_TO:100,CHART_TYPE:200,AREA_ABS:201,AREA_STACKED:202,AREA_PERCENT:203,BAR_SBS:204,BAR_ABS:205,BAR_STACKED:206,BAR_PERCENT:207,LINE_ABS:208,LINE_STACKED:209,LINE_PERCENT:210,BUBBLE:211,SCATTER:212,H_AREA_ABS:213,H_AREA_STACKED:214,H_AREA_PERCENT:215,H_BAR_SBS:216,H_BAR_ABS:217,H_BAR_STACKED:218,H_BAR_PERCENT:219,H_LINE_ABS:220,H_LINE_STACKED:221,H_LINE_PERCENT:222,GRID:223,CIRCLE:224,SQUARE:225,PIE:226,TICKER:227,RING:228,CANVAS:229,SVG:230,LARGE_ABL:231,OUTPUT_EXTREMES:232,COMBINATION:233,ENABLE_PARTIAL_RENDERING:234,DISABLE_PARTIAL_RENDERING:235,OUTPUT_DATA_COUNT:236,ENABLE_TIMER:239,DISABLE_TIMER:240,ENABLE_CE_TIMER:241,DISABLE_CE_TIMER:242};mstrmojo.gm.EnumColorRankMode={RANK_MODE_VALUE:0,RANK_MODE_TOP:1,RANK_MODE_BOTTOM:2,RANK_MODE_TOP_PERCENT:3,RANK_MODE_BOTTOM_PERCENT:4};mstrmojo.gm.EnumColorByType={NULL:0,ATT:1,METRICS_ITEM:2,METRICS:3,ATT_METRICS:4};mstrmojo.gm.EnumDockPosition={TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};mstrmojo.gm.EnumXAxisLabelStatus={NORMAL:1,STAGGER:2,ROTATE:3,HORI_DROP:4};mstrmojo.gm.EnumABLDirection={UNDEFINED:-1,NONE:0,HORIZONTAL:1,VERTICAL:2};mstrmojo.gm.EnumMetricsPosition={MetricsByRow:0,MetricsByColumn:1,MetricsByAxis:2,MetricsByBreakBy:3,MetricsBySlice:4,MetricsByXAxis:5,MetricsByYAxis:6};mstrmojo.gm.EnumDrawingAPI={GET_CHART_WIDTH:0,GET_CHART_HEIGHT:1,GET_ROW_HEADER:2,GET_COLUMN_HEADER:3,CREATE_UNIT_Y_AXIS:4,CREATE_UNIT_X_AXIS:5,GET_FULL_FLEDGED_CHART:6,GET_ROW_SPAN:7,GET_COLUMN_SPAN:8,GET_METRICS_ON_X:9,GET_METRICS_ON_Y:10,GET_METRICS_ON_SIZE_BY:11,UPDATE_MINI_CHART:12,UPDATE_X_AXIS:13,UPDATE_Y_AXIS:14,MAX_RADIUS_CALC:15,GET_EXTRA_COLUMN_HEADER:16,UPDATE_COLUMN_HEADER:17,UPDATE_ROW_HEADER:18,LAYOUT_ALL_X_AXIS_LABELS:19,LAYOUT_ONE_X_AXIS_LABELS:20};mstrmojo.gm.WidgetPropertyTag={FIT_TO:"FitTo",AXIS_SCALE:"MinMax",SHAPE:"Shape",SUB_TYPE:"Subtype",VIS_TYPE:"visType",DATA_LABEL:"DataLabel",DATA_LABELS_PLACEMENT:"DataLabelPalcement",METRIC_LEVEL_DATA_LABEL:"mtcLvlDataLabel",DATA_LABEL_FONT_SIZE_CONSTRAINT:"DataLabelFontSizeConstraint",DATA_LABEL_TEXT_ANGLE:"DataLabelTextAngle",BANDING:"Banding",LEGEND_VISIBLE:"LegendVisibleness",COL_ALIGNMENT:"Columnalignment",ROW_ALIGNMENT:"Rowalignment",MAX_SIZE_TYPE:"SizeType",MAX_SIZE_VALUE:"SizeValue",MIN_SIZE_TYPE:"minSizeType",MIN_SIZE_VALUE:"minSizeValue",OUTSIDE_BORDER:"OutSideBorder",AXES:"AxisLine",MATRIX_LINES:"MatrixLine",GRID_LINES:"GridLine",SELECTION_TYPE:"SelectionType",SELECTIONS:"Selections",LEGEND_MODE:"lm",LEGEND_POSITION:"LegendPosition",SCALE_LEGEND_WIDTH:"lwr",SCALE_CHART_HEIGHT:"rr",SCALE_CHART_WIDTH:"cr",SCALE_ROW_HEADERS:"rvr",SCALE_COL_HEADERS:"chr",SCALE_Y:"yr",SCALE_X:"xr",SCALE_Y2:"y2r",SCALE_X2:"x2r",SCALE_ALL:"scales",SCALE_V_EXTRA_LINE:"vExtraLine",SORT_ORDER:"so",SORT_INDEX:"si",AXIS_SCALE_DATA:"AxisScale",AXIS_SCALE_REAL_MIN:"rMin",AXIS_SCALE_REAL_MAX:"rMax",AXIS_SCALE_MANUAL_MIN:"mMin",AXIS_SCALE_MANUAL_MAX:"mMax",AXIS_SCALE_AUTO_MIN:"autoMin",AXIS_SCALE_AUTO_MAX:"autoMax",SINGLE_AXIS_SCALE_TYPE:"scaleType",LOG_SCALE:"logScale",GROUP_INFO:"groupInfo",METRIC_SHAPES:"metricShapes",AXIS_ORIGIN:"axisOrigin",AXIS_ORIGIN_AUTO:"axOriAuto",AXIS_ORIGIN_VALUE:"axOriValue",TREND_LINE_DEF:"trdDef",REF_LINE_DEF:"refDef",TREND_TYPE:"trdTp",TREND_LEVEL:"trdLvl",TREND_ENABLED:"trdEnabled",TREND_INCLUDE_BREAK_BY:"trdIncBB",TREND_POLY_DEGREE:"trdDgr",TREND_FORECAST_ENABLED:"trdFstEnabled",TREND_BWD_FORECAST:"trdBwdFst",TREND_FWD_FORECAST:"trdFwdFst",TREND_SEASONALITY:"trdSeason",TREND_BUBBLE_FORE_DEF:"trdBbForeDef",TREND_BUBBLE_FORE_FWD:"trdBbForeFwd",TREND_BUBBLE_FORE_BWD:"trdBbForeBwd",TREND_BUBBLE_FORE_ENABLED:"trdBbForeEnabled",TREND_BUBBLE_MAX:"trdBbMax",TREND_BUBBLE_MIN:"trdBbMin",REF_TYPE:"refTp",REF_LEVEL:"refLvl",REF_ENABLED:"refEnabled",REF_SHOW_LABEL:"refLbShw",REF_LABEL_TYPE:"refLbTp",REF_CONST_VALUE:"refCstVl",REF_LINE_NAME:"refLnName",TREND_REF_LINE_THICKNESS:"trdRefLnThk",TREND_REF_LINE_COLOR:"trdRefLnClr",TREND_REF_LINE_STYLE:"trdRefLnStyle",TREND_REF_LINE_COMBINED_STYLE:"trdRefLnCmbStyle",FORMATS_ON_COMBINATION:"fmtOnComb",PARTIAL_RENDER:"prtRdn",SHOW_BOTH_TOTALS:"totalShw:intSumShw"};mstrmojo.gm.FormatingPropertyTag={IS_DEFAULT_VALUE:"_default",MODIFIED_DEF_FILL_COLOR:"modDefFillClr",ALL_SHAPE_FORMAT:"allShpFmt",SHAPE_LINE_THICKNESS:"shpLnThk",SHAPE_LINE_COLOR:"shpLnClr",SHAPE_LINE_STYLE:"shpLnStyle",SHAPE_LINE_COMBINED_STYLE:"shpLnCmbStyle",SHAPE_FILL_COLOR:"shpFillClr",SHAPE_FILL_COLOR_DEFAULT:"shpFillClr_default",SHAPE_FILL_STYLE:"shpFillStyle",SHAPE_FILL_TRANSPARENCY:"shpFillTrans",SHAPE_FILL_EFFECT:"shpFillEff",SHAPE_BORDER_COLOR:"shpBdrClr",SHAPE_BORDER_STYLE:"shpBdrStyle",SHAPE_BORDER_COMBINED_STYLE:"shpBdrCmbStyle",SHAPE_BORDER_THICKNESS:"shpBdrThk",LINE_MARKER_SHOW:"lnMkShw",LINE_MARKER_SHAPE:"lnMkShp",LINE_MARKER_SIZE:"lnMkSz",LINE_MARKER_COLOR:"lnMkClr",LINE_MARKER_COLOR_EQUAL:"lnMkClrEq",LINE_MARKER_BORDER_COLOR:"lnMkBdrClr",PIE_EXPLODE:"pieExpl",DATA_LABELS_SHOW:"dlShw",DATA_LABELS_FONT_FAMILY:"dlFntFml",DATA_LABELS_FONT_SIZE:"dlFntSz",DATA_LABELS_FONT_STYLE:"dlFntStyle",DATA_LABELS_FONT_COLOR:"dlFntClr",REF_LABELS_FONT_FAMILY:"rfLnFntFml",REF_LABELS_FONT_SIZE:"rfLnFntSz",REF_LABELS_FONT_STYLE:"rfLnFntStyle",REF_LABELS_FONT_COLOR:"rfLnFntClr",LEGEND_BG_COLOR:"lgdBgFillClr",LEGEND_BG_FILL_STYLE:"lgdBgFillStyle",LEGEND_BG_FILL_EFFECT:"lgdBgFillEff",LEGEND_BG_FILL_TRANSPARENCY:"lgdBgFillTrans",LEGEND_FONT_SIZE:"lgdFntSz",LEGEND_FONT_FAMILY:"lgdFntFml",LEGEND_FONT_STYLE:"lgdFntStyle",LEGEND_FONT_COLOR:"lgdFntClr",LEGEND_BORDER_SHOW:"lgdBdrShw",LEGEND_BORDER_COLOR:"lgdBdrClr",LEGEND_BORDER_THICKNESS:"lgdBdrThk",LEGEND_BORDER_LINE_STYLE:"lgdBdrStyle",LEGEND_BORDER_LINE_COMBINED_STYLE:"lgdBdrCmbStyle",ALL_LINE_SHOW:"allLnShw",ALL_LINE_COLOR:"allLnClr",ALL_LINE_STYLE:"allLnStyle",ALL_LINE_COMBINED_STYLE:"allLnCmbStyle",ALL_LINE_THICKNESS:"allLnThk",ALL_AXIS_ORIGIN_LINE_SHOW:"axOriLnShw",ALL_AXIS_ORIGIN_LINE_COLOR:"axOriLnClr",ALL_AXIS_ORIGIN_LINE_COMBINED_STYLE:"axOriLnCmbStyle",X_AXIS_ORIGIN_LINE_SHOW:"xAxOriLnShw",X_AXIS_ORIGIN_LINE_COLOR:"xAxOriLnClr",X_AXIS_ORIGIN_LINE_STYLE:"xAxOriLnStyle",X_AXIS_ORIGIN_LINE_COMBINED_STYLE:"xAxOriLnCmbStyle",X_AXIS_ORIGIN_LINE_THICKNESS:"xAxOriLnThk",Y_AXIS_ORIGIN_LINE_SHOW:"yAxOriLnShw",Y_AXIS_ORIGIN_LINE_COLOR:"yAxOriLnClr",Y_AXIS_ORIGIN_LINE_STYLE:"yAxOriLnStyle",Y_AXIS_ORIGIN_LINE_COMBINED_STYLE:"yAxOriLnCmbStyle",Y_AXIS_ORIGIN_LINE_THICKNESS:"yAxOriLnThk",ALL_AXIS_LINE_SHOW:"allAxLnShw",ALL_AXIS_LINE_COLOR:"allAxLnClr",ALL_AXIS_LINE_STYLE:"allAxLnStyle",ALL_AXIS_LINE_COMBINED_STYLE:"allAxLnCmbStyle",ALL_AXIS_LINE_THICKNESS:"allAxLnThk",ALL_AXIS_TITLE_SHOW:"allAxTtShw",ALL_AXIS_TITLE_CONTENT:"allAxTtCtt",ALL_AXIS_TITLE_FONT_COLOR:"allAxTtFntClr",ALL_AXIS_TITLE_FONT_FAMILY:"allAxTtFntFml",ALL_AXIS_TITLE_FONT_STYLE:"allAxTtFntStyle",ALL_AXIS_TITLE_FONT_SIZE:"allAxTtFntSz",ALL_AXIS_LABELS_FONT_SIZE:"allAxLbFntSz",ALL_AXIS_LABELS_FONT_FAMILY:"allAxLbFntFml",ALL_AXIS_LABELS_FONT_STYLE:"allAxLbFntStyle",ALL_AXIS_LABELS_FONT_COLOR:"allAxLbFntClr",ALL_AXIS_LABELS_ROTATION:"allAxLbRtt",ALL_AXIS_LABELS_SHOW:"allAxLbShw",X_AXIS_LINE_SHOW:"xAxLnShw",X_AXIS_LINE_COLOR:"xAxLnClr",X_AXIS_LINE_STYLE:"xAxLnStyle",X_AXIS_LINE_COMBINED_STYLE:"xAxLnCmbStyle",X_AXIS_LINE_THICKNESS:"xAxLnThk",X_AXIS_TITLE_SHOW:"xAxTtShw",X_AXIS_TITLE_CONTENT:"xAxTtCtt",X_AXIS_TITLE_FONT_COLOR:"xAxTtFntClr",X_AXIS_TITLE_FONT_FAMILY:"xAxTtFntFml",X_AXIS_TITLE_FONT_STYLE:"xAxTtFntStyle",X_AXIS_TITLE_FONT_SIZE:"xAxTtFntSz",X_AXIS_LABELS_FONT_SIZE:"xAxLbFntSz",X_AXIS_LABELS_FONT_FAMILY:"xAxLbFntFml",X_AXIS_LABELS_FONT_STYLE:"xAxLbFntStyle",X_AXIS_LABELS_FONT_COLOR:"xAxLbFntClr",X_AXIS_LABELS_ROTATION:"xAxLbRtt",X_AXIS_LABELS_SHOW:"xAxLbShw",Y_AXIS_LINE_SHOW:"yAxLnShw",Y_AXIS_LINE_COLOR:"yAxLnClr",Y_AXIS_LINE_STYLE:"yAxLnStyle",Y_AXIS_LINE_COMBINED_STYLE:"yAxLnCmbStyle",Y_AXIS_LINE_THICKNESS:"yAxLnThk",Y_AXIS_TITLE_SHOW:"yAxTtShw",Y_AXIS_TITLE_CONTENT:"yAxTtCtt",Y_AXIS_TITLE_FONT_COLOR:"yAxTtFntClr",Y_AXIS_TITLE_FONT_FAMILY:"yAxTtFntFml",Y_AXIS_TITLE_FONT_STYLE:"yAxTtFntStyle",Y_AXIS_TITLE_FONT_SIZE:"yAxTtFntSz",Y_AXIS_LABELS_FONT_SIZE:"yAxLbFntSz",Y_AXIS_LABELS_FONT_FAMILY:"yAxLbFntFml",Y_AXIS_LABELS_FONT_STYLE:"yAxLbFntStyle",Y_AXIS_LABELS_FONT_COLOR:"yAxLbFntClr",Y_AXIS_LABELS_ROTATION:"yAxLbRtt",Y_AXIS_LABELS_SHOW:"yAxLbShw",ALL_FILL_COLOR:"allFillClr",ALL_FILL_TRANSPARENCY:"allFillTrans",BG_COLOR:"bgFillClr",BG_FILL_EFFECT:"bgFillEff",BG_FILL_STYLE:"bgFillStyle",BG_FILL_TRANSPARENCY:"bgFillTrans",ROW_HEADER_FILL_COLOR:"rwHdrFillClr",ROW_HEADER_FILL_EFFECT:"rwHdrFillEff",ROW_HEADER_FILL_STYLE:"rwHdrFillStyle",ROW_HEADER_FILL_TRANSPARENCY:"rwHdrFillTrans",COLUMN_HEADER_FILL_COLOR:"colHdrFillClr",COLUMN_HEADER_FILL_EFFECT:"colHdrFillEff",COLUMN_HEADER_FILL_STYLE:"colHdrFillStyle",COLUMN_HEADER_FILL_TRANSPARENCY:"colHdrFillTrans",ALL_MATRIX_LINES_SHOW:"allMatrixLnShw",ALL_MATRIX_LINES_COLOR:"allMatrixLnClr",ALL_MATRIX_LINES_THICKNESS:"allMatrixLnThk",ALL_MATRIX_LINES_STYLE:"allMatrixLnStyle",ALL_MATRIX_LINES_COMBINED_STYLE:"allMatrixLnCmbStyle",V_MATRIX_LINES_SHOW:"vMatrixLnShw",V_MATRIX_LINES_COLOR:"vMatrixLnClr",V_MATRIX_LINES_THICKNESS:"vMatrixLnThk",V_MATRIX_LINES_STYLE:"vMatrixLnStyle",V_MATRIX_LINES_COMBINED_STYLE:"vMatrixLnCmbStyle",H_MATRIX_LINES_SHOW:"hMatrixLnShw",H_MATRIX_LINES_COLOR:"hMatrixLnClr",H_MATRIX_LINES_THICKNESS:"hMatrixLnThk",H_MATRIX_LINES_STYLE:"hMatrixLnStyle",H_MATRIX_LINES_COMBINED_STYLE:"hMatrixLnCmbStyle",OUTSIDE_BORDER_SHOW:"outBdrShw",OUTSIDE_BORDER_COLOR:"outBdrClr",OUTSIDE_BORDER_STYLE:"outBdrStyle",OUTSIDE_BORDER_THICKNESS:"outBdrThk",OUTSIDE_BORDER_COMBINED_STYLE:"outBdrCmbStyle",GRID_LINE_AUTO:"gridLineAuto",ALL_GRID_LINES_SHOW:"allGridLnShw",ALL_GRID_LINES_COLOR:"allGridLnClr",ALL_GRID_LINES_THICKNESS:"allGridLnThk",ALL_GRID_LINES_STYLE:"allGridLnStyle",ALL_GRID_LINES_COMBINED_STYLE:"allGridLnCmbStyle",AUTO_GRID_LINES_COLOR:"autoGridLnClr",AUTO_GRID_LINES_COMBINED_STYLE:"autoGridLnCmbStyle",MAJOR_GRID_LINES_SHOW:"majorGridLnShw",MAJOR_GRID_LINES_COLOR:"majorGridLnClr",MAJOR_GRID_LINES_THICKNESS:"majorGridLnThk",MAJOR_GRID_LINES_STYLE:"majorGridLnStyle",MAJOR_GRID_LINES_COMBINED_STYLE:"majorGridLnCmbStyle",MINOR_GRID_LINES_SHOW:"minerGridLnShw",MINER_GRID_LINES_COLOR:"minerGridLnClr",MINER_GRID_LINES_THICKNESS:"minerGridLnThk",MINER_GRID_LINES_STYLE:"minerGridLnStyle",MINER_GRID_LINES_COMBINED_STYLE:"minerGridLnCmbStyle",ALL_NGM_GRID_LINES_SHOW:"allNGMGridLnShw",X_GRID_LINES_SHOW:"xGridLnShw",Y_GRID_LINES_SHOW:"yGridLnShw",ALL_ROW_COLUMN_SHOW:"allRwColShw",COLUMN_TEXT_SHOW:"colTxtShw",ROW_TEXT_SHOW:"rwTxtShw",COLUMN_HEADER_SHOW:"colHdrShw",ROW_HEADER_SHOW:"rwHdrShw",COLUMN_VALUES_SHOW:"colVlShw",ROW_VALUES_SHOW:"rwVlShw",ALL_TEXT_FONT_COLOR:"allTxtFntClr",ALL_TEXT_FONT_SIZE:"allTxtFntSz",ALL_TEXT_FONT_FAMILY:"allTxtFntFml",ALL_TEXT_FONT_STYLE:"allTxtFntStyle",ALL_ROW_COLUMN_TEXT_FONT_COLOR:"allRwColTxtFntClr",ALL_ROW_COLUMN_TEXT_FONT_SIZE:"allRwColTxtFntSz",ALL_ROW_COLUMN_TEXT_FONT_FAMILY:"allRwColTxtFntFml",ALL_ROW_COLUMN_TEXT_FONT_STYLE:"allRwColTxtFntStyle",ALL_ROW_COLUMN_TEXT_ALIGNMENT_HORIZONTAL:"allRwColTxtAlignH",ALL_ROW_COLUMN_TEXT_ALIGNMENT_VERTICAL:"allRwColTxtAlignV",ROW_TEXT_TEXT_FONT_COLOR:"rwTxtTxtFntClr",ROW_TEXT_TEXT_FONT_SIZE:"rwTxtTxtFntSz",ROW_TEXT_TEXT_FONT_FAMILY:"rwTxtTxtFntFml",ROW_TEXT_TEXT_FONT_STYLE:"rwTxtTxtFntStyle",ROW_TEXT_TEXT_ALIGNMENT_HORIZONTAL:"rwTxtTxtAlignH",ROW_TEXT_TEXT_ALIGNMENT_VERTICAL:"rwTxtTxtAlignV",COLUMN_TEXT_TEXT_FONT_COLOR:"colTxtTxtFntClr",COLUMN_TEXT_TEXT_FONT_SIZE:"colTxtTxtFntSz",COLUMN_TEXT_TEXT_FONT_FAMILY:"colTxtTxtFntFml",COLUMN_TEXT_TEXT_FONT_STYLE:"colTxtTxtFntStyle",COLUMN_TEXT_TEXT_ALIGNMENT_HORIZONTAL:"colTxtTxtAlignH",COLUMN_TEXT_TEXT_ALIGNMENT_VERTICAL:"colTxtTxtAlignV",ROW_HEADER_TEXT_FONT_COLOR:"rwHdrTxtFntClr",ROW_HEADER_TEXT_FONT_SIZE:"rwHdrTxtFntSz",ROW_HEADER_TEXT_FONT_FAMILY:"rwHdrTxtFntFml",ROW_HEADER_TEXT_FONT_STYLE:"rwHdrTxtFntStyle",ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL:"rwHdrTxtAlignH",ROW_HEADER_TEXT_ALIGNMENT_VERTICAL:"rwHdrTxtAlignV",COLUMN_HEADER_TEXT_FONT_COLOR:"colHdrTxtFntClr",COLUMN_HEADER_TEXT_FONT_SIZE:"colHdrTxtFntSz",COLUMN_HEADER_TEXT_FONT_FAMILY:"colHdrTxtFntFml",COLUMN_HEADER_TEXT_FONT_STYLE:"colHdrTxtFntStyle",COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL:"colHdrTxtAlignH",COLUMN_HEADER_TEXT_ALIGNMENT_VERTICAL:"colHdrTxtAlignV",ROW_VAVLUE_TEXT_FONT_COLOR:"rwVlTxtFntClr",ROW_VAVLUE_TEXT_FONT_SIZE:"rwVlTxtFntSz",ROW_VAVLUE_TEXT_FONT_FAMILY:"rwVlTxtFntFml",ROW_VAVLUE_TEXT_FONT_STYLE:"rwVlTxtFntStyle",ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:"rwVlTxtAlignH",ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL:"rwVlTxtAlignV",COLUMN_VAVLUE_TEXT_FONT_COLOR:"colVlTxtFntClr",COLUMN_VAVLUE_TEXT_FONT_SIZE:"colVlTxtFntSz",COLUMN_VAVLUE_TEXT_FONT_FAMILY:"colVlTxtFntFml",COLUMN_VAVLUE_TEXT_FONT_STYLE:"colVlTxtFntStyle",COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:"colVlTxtAlignH",COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL:"colVlTxtAlignV",TITLE_FONT_COLOR:"ttlFntClr",TITLE_FONT_SIZE:"ttlFntSz",TITLE_FONT_FAMILY:"ttlFntFml",TITLE_FONT_STYLE:"ttlFntStyle",COLOR_SQUARE_COLOR:"clrSqrClr",SELECTION_LIMIT:"slctnLmt",CONTAINER_FIT_MODE:"cntrFitMode",SHOW_MODEBAR:"showModeBar",MEAN_SD:"meanSD",POINT_SIZE:"ptSize",PTSZ_TYPE:"ptSzType",JITTER:"jitter",JTR_TYPE:"jtrType",POINT_POS:"ptPos",PTPOS_TYPE:"ptPosType",SHOW_OUTLIERS:"shwOutliers",CUSTOM_BINS_MODE:"custMode",MANUAL_BINS_MODE:"manualBinsMode",RANGE_TYPE:"rangeType",NUM_BINS:"numBins",XBINS_START:"xBinsStart",XBINS_END:"xBinsEnd",XBINS_SIZE:"xBinsSize",HAS_UNCHECKED_AUTO:"hasUncheckedAuto",HAS_UNCHECKED_DATASET_RANGE:"hasUncheckedDstRng",TOTAL_SHOW:"totalShw",TOTAL_LABEL:"totalLabel",INT_SUM_SHOW:"intSumShw",POSITIVE_COLOR:"posClr",NEGATIVE_COLOR:"negClr",TOTAL_COLOR:"totalClr",INT_SUM_COLOR:"intSumClr",INT_SUM_FULL:"intSumFull"};mstrmojo.gm.EnumAxis={DssAxisReserved:0,DssAxisRows:1,DssAxisColumns:2,DssAxisPages:3,DssAxisChapters:4,DssAxisAll:5};mstrmojo.gm.EnumCombinedLineStyle={NONE:99,THIN:1,THICK:2,DASHED:3,DOTTED:4};mstrmojo.gm.EnumSizeByType={SQUARE:1,CIRCLE:4};mstrmojo.gm.EnumTheme={DARK:0,LIGHT:1};mstrmojo.gm.EnumFitTo={NONE:1,AUTOMATIC:2,COMPACT:3,MANUAL:4};mstrmojo.gm.EnumAxisScale={GLOBAL:0,PERROWCOL:1,PERCELL:2,CUSTOM:3,DIFFERENT:4};mstrmojo.gm.EnumShape={GENERIC:-1,AREA:0,BAR:1,LINE:2,STEPLINE:3,CIRCLE:4,RECTANGLE:5,SQUARE:6,TICK:7,PIESLICE:8,POLYGON:9,PIE:10,RING:11,DEFAULT:12,BULLET:13};mstrmojo.gm.EnumSubtype={AUTO:1,ABSOLUTE:2,STACKED:3,CLUSTERED:4,PERCENT:5};mstrmojo.gm.EnumDataLabels={HIDE:1,SHOW_VALUE_ONLY:2,SHOW_TEXT_ONLY:3};mstrmojo.gm.EnumDataLabelPlacements={AUTOMATIC:1,GENERIC:2,RESERVED:3};mstrmojo.gm.EnumLegend={SHOW:0,HIDE:1,MINIMIZED:2};mstrmojo.gm.EnumLegendMode={RESTORED:1,MINIMIZED:2};mstrmojo.gm.EnumTextAlignH={LEFT:0,MIDDLE:1,RIGHT:2};mstrmojo.gm.EnumTextAlignV={TOP:0,MIDDLE:1,BOTTOM:2};mstrmojo.gm.EnumMaxSizeType={AUTO:1,MANUAL:2,AUTO_FIT:3};mstrmojo.gm.EnumMinSizeType={AUTO:1,MANUAL:2,PROPORTIONAL:3};mstrmojo.gm.EnumAxes={SHOW_BOTH:1,SHOW_NONE:2,SHOW_X:3,SHOW_Y:4};mstrmojo.gm.EnumMatrixLines={SHOW_ALL:1,SHOW_NONE:2,SHOW_HORIZONTAL:3,SHOW_VERTICAL:4};mstrmojo.gm.EnumGridLines={AUTO:1,SHOW:2,HIDE:3,SHOW_MAJOR_ONLY:4};mstrmojo.gm.EnumNGMGridLines={SHOW_Y:1,SHOW_X:2,SHOW:3,HIDE:4,AUTO:5};mstrmojo.gm.LineMarkerShape={Circle:4,Square:1};mstrmojo.gm.ShapeFillType={Solid:0,Gradient:14,Pattern:3};mstrmojo.gm.ShapeFillEffect={None:1,Bevel:2};mstrmojo.gm.Enum3DGMapping={SizeType:"9999_1002",SizeValue:"9999_1003",lgdBgFillClr:"6_564",lgdBgFillStyle:"6_10002",lgdBgFillEff:"6_608",lgdFntSz:"9_603",lgdFntFml:"9_576",lgdFntStyle:"9_584",lgdFntClr:"9_574",LegendVisibleness:"9999_116",xAxShw:"9999_124",xAxTtCtt:"293_9999",xAxTtFntClr:"293_574",xAxTtFntFml:"293_576",xAxTtFntStyle:"293_584",xAxLbFntSz:"272_603",xAxLbFntFml:"272_576",xAxLbFntStyle:"272_584",yAxShw:"9999_125",yAxTtCtt:"299_9999",yAxTtFntClr:"299_574",yAxTtFntFml:"299_576",yAxTtFntStyle:"299_584",yAxLbFntSz:"296_603",yAxLbFntFml:"296_576",yAxLbFntStyle:"296_584",bgFillClr:"1_564",bgFillEff:"1_879",bgFillTrans:"1_608",outBdrClr:"1_588"};mstrmojo.gm.EnumRefLineModelType={MAX:1,MIN:2,AVG:3,MED:4,FIRST:5,LAST:6,CONST:7};mstrmojo.gm.EnumTrendLineModelType={BEST_FIT:256,LINEAR:257,LOG:258,EXP:259,POW:260,POLY:261};mstrmojo.gm.EnumTrendRefLevel={DssModelLevelReserved:0,DssModelLevelPerCell:1,DssModelLevelPerRow:2,DssModelLevelPerColumn:3,DssModelLevelPerPanel:4,DssModelLevelLastOne:5};mstrmojo.gm.EnumTimeRole={None:0,YearOfDecade:3083,QuarterOfYear:2826,MonthOfYear:2825,MonthOfQuarter:2569,WeekOfYear:2824,WeekOfQuarter:2568,WeekOfMonth:2312,DayOfYear:2823,DayOfQuarter:2567,DayOfMonth:2311,DayOfWeek:2055,HourOfDay:1798,MinuteOfDay:1797,MinuteOfHour:1541,SecondOfDay:1796,SecondOfHour:1540,SecondOfMinute:1284};mstrmojo.gm.EnumTrendRefModelLabels={DssModelLabelsReserved:-1,DssModelLabelsNone:0,DssModelLabelsType:1,DssModelLabelsMetric:2,DssModelLabelsValue:4};mstrmojo.gm.EnumTRFManipulations={AddTRLine:"141",RemoveTRLine:"142",UpdateTRLine:"143",UpdateForecastInfo:"144"};mstrmojo.gm.EnumShapeFormatStatus={NORMAL:0,PER_COLORBY:1,PER_SHAPE:2};mstrmojo.gm.EnumNGMSubtype={CLUSTERED:0,STACKED:1,PERCENT:2};mstrmojo.gm.EnumBoxPlotMean={NO_MEAN:0,ONLY_MEAN:1,MEAN_STDEV:2};mstrmojo.gm.EnumBoxPlotOutliers={OUTLIERS:0,ALL_POINTS:1,JITTER:0,JTR_MAN:0.5,POINT_POS:0,POS_MAN:-1.8,POINT_SIZE:6,SIZE_MAN:10,MANUAL:1};mstrmojo.gm.EnumHistogram={AUTOMATIC:1,MANUAL:0,CUST_INPUT:2,DATASET:3,BY_BIN_SIZE:4,BY_BIN_NUMBER:5};mstrmojo.gm.EnumContainerFitModes={AUTOMATIC:0,FIT_TO_CONTAINER:1,FIT_TO_CONTENT:2};(function(){function E(H,G,F){return H>=G&&H<=F;}function A(G,F){return{start:G,end:F};}function C(I,G){var L=this.renderedRowsArr,K=B.call(this,I,1),J=K.index,H=L[J],F;if(!K.between){if(H&&I>H.end+1){J++;L.splice(J,0,A(I,G));}else{L.splice(J,0,A(I,G));}H=L[J];}else{H.end=Math.max(H.end,G);}while(J<L.length-1){J++;F=L[J];if(H.end+1>=F.start){H.end=Math.max(H.end,F.end);L.splice(J,1);J--;}else{break;}}}function B(G,L){var K=this.renderedRowsArr,H=0,I=K.length-1,F,J;while(H<=I){F=(H+I)/2|0;J=K[F];if(E(G,J.start,J.end+L||0)){return{between:true,index:F};}else{if(G<J.start){I=F-1;}else{H=F+1;}}}return{between:false,index:F};}mstrmojo._RowRendTracker=mstrmojo.provide("mstrmojo._RowRendTracker",{_mixinName:"mstrmojo._RowRendTracker",renderedRowsArr:undefined,init:function D(F){this._super(F);this.renderedRowsArr=[];},markPages:function(G,F){C.call(this,G,F);},searchRow:function(H){var G=B.call(this,H,0),F;if(G.between){F=this.renderedRowsArr[G.index];return{rendered:true,min:F.start,max:F.end};}return null;},unMarkAllPages:function(){this.renderedRowsArr.length=[];}});}());mstrmojo.chart.model.enums.EnumDSSGraphObject={DssGraphNull:-3,DssGraphBackground:1,DssGraphFrame:2,DssGraphFootnote:3,DssGraphSubtitle:4,DssGraphTitle:5,DssGraphLegendArea:6,DssGraphLegendLine:7,DssGraphLegendMarker:8,DssGraphLegendText:9,DssGraphCurve:257,DssGraphDataLine:258,DssGraphDataMarker:259,DssGraphDataText:260,DssGraphDivBiPolar:261,DssGraphErrorBar:262,DssGraphLinrExp:263,DssGraphLinrLine:264,DssGraphLinrLog:265,DssGraphLinrNatLog:266,DssGraphLinrNPoly:267,DssGraphLinrText:268,DssGraphMeanLine:269,DssGraphMovAvgLine:270,DssGraphO1Body:271,DssGraph2DO1Label:272,DssGraphO1Major:273,DssGraphO1Minor:274,DssGraphO1Super:275,DssGraphO1Title:276,DssGraphO2Body:277,DssGraph2DO2Label:278,DssGraphO2Major:279,DssGraphO2Minor:280,DssGraphO2Title:281,DssGraphConnectDataLine:282,DssGraphRiser:286,DssGraphRiserShadow:287,DssGraphStdDevLine:288,DssGraphX1Body:289,DssGraphX1Label:290,DssGraphX1Major:291,DssGraphX1Minor:292,DssGraphXTitle:293,DssGraphY1Body:295,DssGraphY1Label:296,DssGraphY1Major:297,DssGraphY1Minor:298,DssGraphY1Title:299,DssGraphY2Body:301,DssGraphY2Label:302,DssGraphY2Major:303,DssGraphY2Minor:304,DssGraphY2Title:305,DssGraph3DShowColumnHeaders:318,DssGraph3DShowLeftHeaders:321,DssGraph3DShowRightHeaders:323,DssGraph3DShowRowHeaders:325,DssGraphOBPBox:329,DssGraphOBPMedian:330,DssGraphOBPStem:331,DssGraphOBPTail:332,DssGraphPieFeelerLine:337,DssGraphPieFeelerLabel:338,DssGraphPieGroupLabel:339,DssGraphPieRingLabel:340,DssGraphPieSlice:341,DssGraphSeriesTitle:398,DssGraphConnectStackLine:399,DssGraphDataTextStackTotal:401,DssGraphOPILBLValue:418,DssGraphUserLine1:414,DssGraphUserLine2:415,DssGraphUserLine3:416,DssGraphUserLine4:417,DssGraphDataTextConnectLine:431,DssGraphGauge:444,DssGraphGaugeTitle:450,DssGraphGaugeRange:451,DssGraphY3Body:477,DssGraphY3Label:478,DssGraphY3Major:479,DssGraphY3Minor:480,DssGraphY4Body:483,DssGraphY4Label:484,DssGraphY4Major:485,DssGraphY4Minor:486,DssGraph3DColHeader:512,DssGraph3DColTitle:515,DssGraph3DDataText:518,DssGraph3DRowHeader:552,DssGraph3DRowTitle:555,DssGraph3DRYHeader:558,DssGraph3DRYTitle:561,DssGraphGaugeBorder:1319,DssGraphGaugeNeedleBase:1320,DssGraphGaugeNeedleBaseLine:1330,DssGraphZBody:10003,DssGraphTrendLine:10004,DssGraphY1RightBody:10005,DssGraphY1RightTitle:10006,DssGraphReferenceLine:10007,DssGraphStraightLine:10008,DssGraphTargetLine:10009,DssGraphRefLineText:10010,DssGraphTrendLineText:10011,DssGraphUserLabel1:100100,DssGraphUserLabel2:100101,DssGraphUserLabel3:100102,DssGraphUserLabel4:100103,DssGraphX2Body:100200,DssGraphX2Label:100201,DssGraphX2Major:100202,DssGraphX2Minor:100203,DssGraphX2Title:100204};mstrmojo.vi.enums.EnumFilterClearActionType={CLEAR_ALL:0,CLEAR_KEEP_ONLY:1,CLEAR_ADV_QUALIFICATION:2,CLEAR_LINKING:3,CLEAR_KEEP_ONLY_AND_LINKING:4,CLEAR_DRILLING:5};(function(){mstrmojo.vi.ui._MonitorsTocPage=mstrmojo.provide("mstrmojo.vi.ui._MonitorsTocPage",{tocPanel:null,currentLayoutKey:undefined,currentPanelKey:undefined,onTocPageChange:function(B){if(B.value){this.currentLayoutKey=B.value.layoutKey;this.currentPanelKey=B.value.panelKey;}if(this._super){this._super(B);}},init:function A(B){this._super(B);if(!this.tocPanel){throw new Error("You must pass the tocPanel when instantiating mstrmojo.vi.ui._MonitorsTocPage.");}if(this.tocPanel.attachEventListener){this.tocPanel.attachEventListener("displayPageInfoChange",this.id,"onTocPageChange");}}});}());(function(){mstrmojo.ui.editors._HostsControls=mstrmojo.provide("mstrmojo.ui.editors._HostsControls",{_mixinName:"mstrmojo.ui.editors._HostsControls",setFormatSource:function C(E){this.throwAbstractMethodError("setFormatSource");},syncControls:function A(E){var F=this._sync;this._sync=true;E.call(this);this._sync=F;},raiseFormatValueChange:function D(F,G,E){if(this._sync){return false;}this.onGroupValueChange(F,G,E);return true;},onGroupValueChange:function B(F,G,E){}});}());mstrmojo.vi.viz.EnumWidgetTypes={GRID:0,GRAPH_MATRIX:1,HEATMAP:2,NETWORK:3,IMAGELAYOUT:4,ESRIMAP:5,GOOGLEMAP:6,CUSTOM:7,MAPBOX:8,KPICARD:9};(function(){var A=/^mstrmojo./;mstrmojo.DynamicClassFactory={newComponent:function(C,B,F){var H=C.prototype.scriptClass.replace(A,"");for(var E=0,D=B&&B.length||0;E<D;E++){if(!B[E]._mixinName){throw new Error('Mixins must have a "_mixinName" property to be used with DynamicClassFactory');}H+="_"+B[E]._mixinName.replace(A,"");}var G=mstrmojo[H];if(!G){G=mstrmojo.declare(C,B,F);mstrmojo[H]=G;}return G;}};}());mstrmojo.mstr.EnumWebAPIErrorCodes={MSI_INBOX_MSG_NOT_FOUND:-2147468986,POOL_OBJECT_NOT_FOUND_BY_ID:-2147467398,DOCDATA_PREPARE_TASK_REPORT_INCOMP:-2147466604,AUTHEN_E_LOGIN_FAIL_EXPIRED_PWD:-2147216963,AUTHEN_E_LOGIN_FAILED_NEW_PASSWORD_REQD:-2147216960,AUTHEN_E_LOGIN_FAIL:-2147216959,E_INVALID_EXPRESSION:-2147214839,MSI_ADDUSERJOB_ERROR:-2147209185,E_MSI_USERMGR_USER_NOTFOUND:-2147209051,MSI_SERVER_NOT_FOUND:-2147206923,DFC_QRYENG_RES_TRUNC:-2147205488,MSI_CUBE_NOT_PUBLISHED:-2147072488,ERROR_CREATE_REPORT_INSTANCE:-2147216373,E_UNUSED:4294967295,UICMD_DEFAULT_ERROR:10};mstrmojo.mstr.EnumDSSXMLTokenTypes={EndOfInput:-1,Reserved:0,Error:1,Unknown:2,Empty:3,ExclamationPoint:33,NumberSign:35,Dollar:36,Percent:37,Ampersand:38,LeftParen:40,RightParen:41,Asterisk:42,PlusSign:43,Comma:44,MinusSign:45,Dot:46,FwdSlash:47,Colon:58,Semicolon:59,LeftAngleBracket:60,EqualSign:61,RightAngleBracket:62,QuestionMark:63,AtSign:64,LeftSquareBracket:91,RightSquareBracket:93,Caret:94,Underscore:95,LeftAccolade:123,VerticalBar:124,RightAccolade:125,Tilda:126,Literal:258,Identifier:259,Reserved1:260,DoubleQString:261,Integer:262,Float:263,AttrRef:264,DimRef:265,MetricRef:266,AggMetricRef:267,FactRef:268,ReportRef:269,FilterRef:270,RoleRef:271,TableRef:272,PromptRef:273,ColumnRef:274,AttrFormRef:275,DimFormRef:276,SimpInfixFun1:277,SimpInfixFun2:278,SimpPrefixFun:279,AggFun:280,RelativeFun:281,CompareFun:282,AndFun:283,OrFun:284,NotFun:285,BoolPrefixFun:286,IntersectFun:287,Reserved2:288,InSetFun:289,BetweenFun:290,LikeFun:291,EnhCompareFun:292,EnhBetweenFun:293,ArrowUp:294,ArrowDown:295,ArrowUpDown:296,AggFirstInFact:297,AggLastInFact:298,KwdTrue:299,KwdFalse:300,KwdBreakBy:301,KwdSortBy:302,KwdFactID:303,DateTime:304,CaseFun:305,FreeVariable:306,LongNumber:307,RWMetricRef:308,CSQLRef:309,ConsolidationRef:310,DssTokenTypeKwdCSIUpdate:312,DssTokenTypeKwdCSISet:313,DssTokenTypeKwdCSIInsert:314,DssTokenTypeKwdCSIDelete:315,DssTokenTypeKwdCSIWhere:316,DssTokenTypeKwdCSIInto:317,DssTokenTypeKwdCSIValues:318,DssTokenTypeKwdCSIFrom:319,DssTokenTypeCSIFieldUnit:321,Elements:323,ConsolidationElementRef:324,EndOfTypes:340};(function(){var A=400,B=1500;mstrmojo._CanHandleTwoClicks=mstrmojo.provide("mstrmojo._CanHandleTwoClicks",{firstClickTimeStamp:undefined,firstClickTarget:undefined,onclick:function(C){var D=new Date();timeStamp=D.getTime();if(D-this.firstClickTimeStamp<B&&D-this.firstClickTimeStamp>A){C.secondTarget=C.getTarget();C.firstTarget=this.firstClickTarget;this.onTwoClicks(C);C.cancel();}else{this.firstClickTarget=C.getTarget();this.firstClickTimeStamp=timeStamp;}if(this._super){this._super(C);}},onTwoClicks:mstrmojo.emptyFn});}());mstrmojo.vi.controllers.EnumEvents={UPDATE_TOC:"updateTOC",MANIPULATE_LAYOUT:"layoutManipulation",MANIPULATE_PANEL:"panelManipulation",LAST_MODIFIED_CHANGE:"lastModifiedChange",CHANGE_COVER_IMAGE:"changeCoverImage",WSITEM_DRAG_OVER:"WSItemDragOver",WSITEM_DRAG_ENTER:"WSItemDragEnter",WSITEM_DRAG_EXIT:"WSItemDragExit",WSITEM_DROP:"WSItemDrop",CONTENTS_PANEL_VISIBILITY_CHANGE:"contentPanelVisibilityChange",DO_LAYOUT:"doLayout"};(function(){function A(C){return C.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");}mstrmojo._ImageHelper=mstrmojo.provide("mstrmojo._ImageHelper",{getImage:function B(D){var E=mstrApp,C=E.getConfiguration();if(D){if(D.indexOf("\\")>=0){D=D.replace(/\\/g,"/");}D=A(D);if(D===decodeURI(D)){D=encodeURI(D);}}if(C&&D&&D.indexOf("://")===-1){D=C.getHostUrlByProject(E.getCurrentProjectId())+D;}return(mstrApp.useBinaryFormat)?String(mstrMobileApp.getImage(D)):D;}});}());mstrmojo.vi.controllers.EnumLayoutSelectorPosition={TOP:0,BOTTOM:1,LEFT:2};mstrmojo.chart.model.enums.EnumDSSBaseFormType={DssBaseFormReserved:0,DssBaseFormDateTime:1,DssBaseFormNumber:2,DssBaseFormText:3,DssBaseFormPicture:4,DssBaseFormUrl:5,DssBaseFormEmail:6,DssBaseFormHTMLTag:7,DssBaseFormDate:8,DssBaseFormTime:9,DssBaseFormSymbol:10,DssBaseFormBigDecimal:11};mstrmojo.EnumAuthenticationModes={DEFAULT:0,STANDARD:1,NTCREDENTIAL:2,PASSTHRU:4,ANONYMOUS:8,LDAP:16,DATABASE:32,PLUGIN:64,INTEGRATED:128,USHER:256};mstrmojo.chart.model.enums.EnumDSSAxisName={DssAxisReserved:0,DssAxisRows:1,DssAxisColumns:2,DssAxisPages:3,DssAxisChapters:4,DssAxisAll:5,DssAxisDropZoneIndexRoot:8,DssAxisDropZoneIndexEnd:8+255,DssAxisDynamicShortcutRoot:300,DssAxisDynamicShortcutEnd:300+255};mstrmojo.vi.enums.EnumDSSAccessRightFlags={DssAccessRightReservedFlag:0,DssAccessRightBrowseFlag:1,DssAccessRightUseExecuteFlag:2,DssAccessRightReadFlag:4,DssAccessRightWriteFlag:8,DssAccessRightDeleteFlag:16,DssAccessRightControlFlag:32,DssAccessRightUseFlag:64,DssAccessRightExecuteFlag:128,DssAccessRightFullControlFlag:255,DssAccessRightInheritable:536870912,DssAccessRightAudit:1073741824,DssAccessRightAuditInheritable:1610612736};mstrmojo.mstr.EnumFunction={FunctionCustom:-1,FunctionReserved:0,FunctionPlus:1,FunctionMinus:2,FunctionTimes:3,FunctionDivide:4,FunctionUnaryMinus:5,FunctionEquals:6,FunctionNotEqual:7,FunctionGreater:8,FunctionLess:9,FunctionGreaterEqual:10,FunctionLessEqual:11,FunctionSum:12,FunctionCount:13,FunctionAvg:14,FunctionMin:15,FunctionMax:16,FunctionBetween:17,FunctionLike:18,FunctionAnd:19,FunctionOr:20,FunctionNot:21,FunctionIn:22,FunctionRank:23,FunctionAbs:24,FunctionRunningSum:25,FunctionRunningAvg:26,FunctionMovingSum:28,FunctionMovingAvg:27,FunctionProduct:29,FunctionMedian:30,FunctionMode:31,FunctionStdev:32,FunctionVar:33,FunctionGeomean:34,FunctionEqualEnhanced:35,FunctionNotEqualEnhanced:36,FunctionGreaterEqualEnhanced:37,FunctionLessEqualEnhanced:38,FunctionBetweenEnhanced:39,FunctionBanding:40,FunctionBandingC:41,FunctionBandingP:42,FunctionNotLike:43,FunctionNotBetween:44,FunctionIntersect:45,FunctionIntersectIn:46,FunctionNullToZero:47,FunctionZeroToNull:48,FunctionApplySimple:49,FunctionApplyAggregation:50,FunctionApplyLogic:51,FunctionApplyComparison:52,FunctionApplyRelative:53,FunctionIsNull:54,FunctionIsNotNull:55,FunctionUcase:56,FunctionNotIn:57,FunctionNTile:58,FunctionPercentile:59,FunctionMovingMax:60,FunctionMovingMin:61,FunctionMovingDifference:62,FunctionMovingStdev:63,FunctionExpWghMovingAvg:64,FunctionMovingCount:65,FunctionRunningMax:66,FunctionRunningMin:67,FunctionRunningStdev:68,FunctionRunningCount:69,FunctionExpWghRunningAvg:70,FunctionNotBetweenEnhanced:71,FunctionConcat:72,FunctionFirstInRange:73,FunctionLastInRange:74,FunctionValueSegment:75,FunctionContains:76,FunctionBeginsWith:77,FunctionEndsWith:78,FunctionNotContains:79,FunctionNotBeginsWith:80,FunctionNotEndsWith:81,FunctionCase:82,FunctionCaseV:83,FunctionStdevP:84,FunctionRunningStdevP:85,FunctionMovingStdevP:86,FunctionNTileS:87,FunctionNTileVS:88,FunctionVarP:89,FunctionCurrentDate:90,FunctionDayOfMonth:91,FunctionDayOfWeek:92,FunctionDayOfYear:93,FunctionWeek:94,FunctionMonth:95,FunctionQuarter:96,FunctionYear:97,FunctionCurrentDateTime:98,FunctionCurrentTime:99,FunctionHour:100,FunctionMinute:101,FunctionSecond:102,FunctionMilliSecond:103,FunctionConcatNoBlank:104,FunctionLength:105,FunctionLower:106,FunctionLTrim:107,FunctionPosition:108,FunctionRTrim:109,FunctionSubStr:110,FunctionInitCap:111,FunctionTrim:112,FunctionRightStr:113,FunctionLeftStr:114,FunctionGreatest:115,FunctionLeast:116,FunctionFirst:117,FunctionLast:118,FunctionAdd:134,FunctionAverage:135,FunctionMultiply:136,FunctionBandingM:137,FunctionOLAPSum:138,FunctionOLAPAvg:139,FunctionOLAPCount:140,FunctionOLAPMax:141,FunctionOLAPMin:142,FunctionLag:143,FunctionLead:144,FunctionPercentRank:166,FunctionConcatAgg:177,FunctionTuple:1000};mstrmojo.mstr.EnumDSSXMLObjectTypes={Generic:-2,Unknown:-1,Reserved:0,Filter:1,Template:2,ReportDefinition:3,Metric:4,Style:6,AggMetric:7,Folder:8,SubscriptionDevice:9,Prompt:10,Function:11,Attribute:12,Fact:13,Dimension:14,Table:15,DatamartReport:16,FactGroup:17,Shortcut:18,Resolution:19,Monitor:20,AttributeForm:21,Schema:22,Format:23,Catalog:24,CatalogDefn:25,Column:26,PropertySet:28,DBRole:29,DBLogin:30,DBConnection:31,Project:32,ServerDef:33,User:34,Configuration:36,Request:37,Script:38,Search:39,SearchFolder:40,Datamart:41,FunctionPackageDefinition:42,Role:43,SecurityRole:44,Locale:45,Consolidation:47,ConsolidationElement:48,ScheduleEvent:49,ScheduleObject:50,ScheduleTrigger:51,Link:52,DbTable:53,TableSource:54,DocumentDefinition:55,DrillMap:56,DBMS:57,MDSecurityFilter:58,PromptAnswer:59,PromptAnswers:60,ObjectTag:65,ReservedLastOne:66};(function(){mstrmojo._CanRenderChildrenOnShow=mstrmojo.provide("mstrmojo._CanRenderChildrenOnShow",{_subs_renderOnShow:null,childRenderCheck:function B(D){if(this.renderMode!=="onshow"){return this._super(D);}if(D.visible){return this._super(D);}var C=this._subs_renderOnShow;if(!C){C={};this._subs_renderOnShow=C;}if(!C[D.id]){C[D.id]=D.attachEventListener("visibleChange",this.id,"_on_child_visibleChange");}return false;},_on_child_visibleChange:function A(C){if(this.hasRendered){var E=C&&C.src;if(E&&this.childRenderCheck(E)){var D=this._subs_renderOnShow;if(D){E.detachEventListener(D[E.id]);delete D[E.id];}E.render();}}}});}());(function(){mstrmojo.hash=mstrmojo.provide("mstrmojo.hash",{copy:function B(S,R){if(S){R=R||{};var U;for(U in S){R[U]=S[U];}}return R;},copyProps:function C(U,W,R){R=R||{};if(W){var V=(U&&U.length)||0,S;for(S=0;S<V;S++){var X=U[S];if(W[X]!==undefined){R[X]=W[X];}}}return R;},forEach:function I(V,U,S){if(V){var R;for(R in V){if(S){if(U.call(S,V[R],R,V)===false){break;}}else{if(U(V[R],R,V)===false){break;}}}}return V;},walk:function P(W,S){if(!S){S=mstrmojo.global;}var V=W.split(".");if(V.length===1){return S[W];}var U=(V&&V.length)||0,R;for(R=0;R<U;R++){S=S[V[R]];if(!S){break;}}return S;},isEmpty:function F(S){if(!S){return true;}var R;for(R in S){if(S[R]!==null&&S[R]!==undefined){return false;}}return true;},clear:function G(S){if(S){var R;for(R in S){delete S[R];}}return S;},any:function J(V,W){var U;if(V){var S=this.keyarray(V);if(S.length>0){var R=S[0];U=W?R:V[R];}}return U;},clone:function M(W){if(!W){return null;}var Y;if(W.constructor===Array){Y=W.concat();var X=Y[0];if(X&&typeof X==="object"){var R=Y.length,V;for(V=0;V<R;V++){Y[V]=this.clone(W[V]);}}}else{Y={};var U;for(U in W){var S=W[U];if(S&&typeof S==="object"){Y[U]=this.clone(S);}else{Y[U]=S;}}}return Y;},cloneArray:function E(S){var U=[],R=(S&&S.length)||0,V;for(V=0;V<R;V++){U[V]=this.clone(S[V]);}return U;},keyarray:function K(U,V){var R=[],S;if(U){if(Object.keys&&!V){R=Object.keys(U);}else{for(S in U){R.push(V?Number(S):S);}}}return R;},valarray:function L(U){var R=[];if(U){var S;for(S in U){R.push(U[S]);}}return R;},equals:function Q(Z,Y){var S=mstrmojo.hash,X=(Z&&Y)||(!Z&&!Y&&(Z===Y));if(X&&Z){X=(Z.constructor===Y.constructor);if(X){if(Z.constructor===Array){var W=Z.length;X=(W===Y.length);if(X&&W){var U;for(U=0;U<W;U++){X=X&&S.equals(Z[U],Y[U]);}}}else{if(typeof Z==="object"){var a=S.keyarray(Z),V=S.keyarray(Y);X=a.length===V.length;if(X){var R;for(R in Z){X=X&&(S.equals(Z[R],Y[R]));}}}else{X=(Z===Y);}}}}return X;},obj2array:function O(X){var Y;for(Y in X){var W=X[Y];if(W&&typeof W==="object"){X[Y]=this.obj2array(W);}}var S=X.isArray;if(S!==undefined&&S===true){var V=[],R=X.length,U;for(U=0;U<R;U++){V.push(X[U]);}return V;}return X;},min:function D(V,W,X){var R=null,U;if(V){for(U in V){var S=W?V[U]:U;if(X){S=Number(S);}if((R===null)||(S<R)){R=S;}}}return R;},max:function N(V,W,X){var R=null,U;if(V){for(U in V){var S=W?V[U]:U;if(X){S=Number(S);}if((R===null)||(S>R)){R=S;}}}return R;},make:function A(S,U,R){if(!S||!U){return null;}if(S.attachEventListener){return S;}if(U.makeObservable){S=U.makeObservable(S,R)||S;}else{this.copy(U.prototype,S);if(S.init){S=S.init(R)||S;}}return S;},mergeHashes:function H(R,S){R=this.clone(R)||{};if(S){mstrmojo.array.forEach(mstrmojo.array.distinct(this.keyarray(S).concat(this.keyarray(R))),function(U){var W=R[U],V=S[U];if(W===undefined){R[U]=V;}else{if(W&&V){if(typeof W==="object"){if(W.constructor===Array){R[U]=W.concat(V);}else{R[U]=this.mergeHashes(W,V);}}else{R[U]=V;}}}},this);}return R;},invert:function(S){var U={};if(S){var R;for(R in S){if(S.hasOwnProperty(R)){if(typeof R==="number"||typeof R==="string"){U[S[R].toString()]=R;}}}}return U;}});}());mstrmojo.chart.model.enums.EnumDSSGraphDataTextShowType={DssGraphDataTextNone:0,DssGraphDataTextValue:1,DssGraphDataTextLabel:2,DssGraphDataTextBoth:3,DssGraphDataTextAbs:4,DssGraphDataTextAbsValue:5,DssGraphDataTextAbsBoth:7,DssGraphDataTextTotal:8,DssGraphDataTextZValue:16,DssGraphDataTextPercent:32,DssGraphDataTextYValue:64,DssGraphDataTextInternal:128,DssGraphDataTextSeriesDependent:256,DssGraphDataTextQualityObjectMode:512};(function(){if(!mstrmojo.PerformanceLogOutput){var G={},D=true;mstrmojo.PerformanceLogOutput=mstrmojo.provide("mstrmojo.PerformanceLogOutput",{mTimers:[],mUseTimer:true,timerId:0,startTimer:function C(L,K){if(this.mUseTimer){if(K&&this.getTimerIdByName(K)>=0){return ;}var J=this.timerId++;this.mTimers.push({timeStamp:new Date(),timerId:J,desc:L.functionName+": "+L.purpose});if(K){G[K]=J;}return J;}},getTimerIdByName:function F(J){var K=G[J];return isNaN(K)?-1:K;},endTimer:function A(M){var K;if(typeof M==="string"){K=this.getTimerIdByName(M);}else{K=M;}if(this.mUseTimer){var J,P=this.mTimers;if(K===undefined){J=P.pop();}else{var L,R;for(L=0;L<P.length;L++){R=P[L];if(R.timerId===K){J=R;P.splice(L,1);break;}}}if(J){var O=J.desc;var N=new Date()-J.timeStamp;var Q=[O,N];this.visPrint("%c"+J.desc+": "+N+"ms","color: blue");H(Q);delete G[M];}}},visPrint:function I(){if(D&&window.mstr_profile&&mstr_profile.enabled&&console){Function.prototype.apply.call(console.log,console,arguments);}},recordJSHeapMemory:function E(L){var N=window.performance,M=N&&N.memory;if(this.mUseTimer&&M){L=L?(L+": "):"";var K=["usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit"],J=this;K.forEach(function(P){var Q=L+P,O=M[P]/1000;J.visPrint("%c"+Q+": "+O+"KB","color: blue");H([Q,O]);});}},exportToCsv:function B(){var K=mstrApp.rootCtrl.docCtrl.model.n+".csv",P=window.perfResults;var Q=function(W,U){var V="";var S=W[U]===null?"":W[U].toString();if(W[U] instanceof Date){S=W[U].toLocaleString();}var R=S.replace(/"/g,'""');if(R.search(/("|,|\n)/g)>=0){R='"'+R+'"';}V+=R;return V+",";};var O="";for(var M=0;M<P.length;M++){O+=Q(P[M],0);}O+="\n";for(var M=0;M<P.length;M++){O+=Q(P[M],1);}O+="\n";var J=new Blob([O],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob){navigator.msSaveBlob(J,K);}else{var N=document.createElement("a");if(N.download!==undefined){var L=URL.createObjectURL(J);N.setAttribute("href",L);N.setAttribute("download",K);N.style.visibility="hidden";document.body.appendChild(N);N.click();document.body.removeChild(N);}}window.perfResults=[];}});function H(K){var J=window.perfResults;if(!J){J=window.perfResults=[];}J.push(K);}}})();(function(){function A(C){return function B(H){if(!this.domNode){return 0;}var G=this.children;if(H!==undefined&&!isNaN(H)){G=(G&&[G[H-1]]);}var E=(G&&G.length)||0,D=0,F;for(F=0;F<E;F++){D+=G[F]["get"+C]();}return D;};}mstrmojo._CanMeasureChildren=mstrmojo.provide("mstrmojo._CanMeasureChildren",{getHeight:A("Height"),getWidth:A("Width")});}());mstrmojo.chart.model.enums.EnumDSSGraphProperty={DssGraphTextContent:9999,DssGraphContent:9999,DssGraphPropertyReserved:0,DssGraphAutoFitO1:4,DssGraphAutoFitO2:5,DssGraphAutoFitX:6,DssGraphAutoFitY1:7,DssGraphAutoFitY2:8,DssGraphGroupSpacing:10,DssGraphRiserWidth:11,DssGraphColorBySeries:12,DssGraphCurveColorAsSeries:13,DssGraphSDMOVAFactor:14,DssGraph2DAngle:18,DssGraph2DDepth:20,DssGraphDepthMode:21,DssGraph2ScaleDirectionX:22,DssGraph2ScaleDirectionY1:23,DssGraph2ScaleDirectionY2:24,DssGraph2ExcludeZeroX:25,DssGraph2ExcludeZeroY1:26,DssGraph2ExcludeZeroY2:27,DssGraphFormatDataTextX:28,DssGraphFormatDataTextY1:29,DssGraphFormatDataTextY2:30,DssGraphFormatX:33,DssGraphFormatY1:34,DssGraphFormatY2:35,DssGraphFormatZ:36,DssGraphGridLineO1:37,DssGraphGridLineO2:38,DssGraphGridLineX:39,DssGraphGridLineY1:40,DssGraphGridLineY2:41,DssGraphLabelModeO1:48,DssGraphLabelModeO2:49,DssGraphLegendLocation:52,DssGraphTitleXLocation:54,DssGraphTitleY1Location:55,DssGraphTitleY2Location:56,DssGraph2LogScaleX:57,DssGraph2LogScaleY1:58,DssGraph2LogScaleY2:59,DssGraphMarkerShape:60,DssGraphMarkerSize:61,DssGraph2DPlaceX:65,DssGraph2DPlaceY1:66,DssGraph2DPlaceY2:67,DssGraphConnectLine:68,DssGraphShowStepLine:70,DssGraph2ScaleEndX:74,DssGraph2ScaleEndY1:75,DssGraph2ScaleEndY2:76,DssGraph2DScaleFreqO1:87,DssGraph2DScaleFreqO2:88,DssGraph2DScaleFreqX:89,DssGraph2DScaleFreqY1:90,DssGraph2DScaleFreqY2:91,DssGraphScaleX:92,DssGraphScaleY1:93,DssGraphScaleY2:94,DssGraphShowSDDataLineType:96,DssGraphSDRiserType:97,DssGraphShowSDLine:98,DssGraphShowSDCurve:99,DssGraphShowSDLinrCorr:101,DssGraphShowSDLinrExp:102,DssGraphShowSDLinrFormula:103,DssGraphShowSDLinrLine:104,DssGraphShowSDLinrLog:105,DssGraphShowSDLinrNatLog:106,DssGraphShowSDLinrNPoly:107,DssGraphSDPolyFactor:108,DssGraphShowSDMeanLine:109,DssGraphShowSDMOVALine:110,DssGraphShowSDSTDDLine:111,DssGraphShowDataText:113,DssGraphShowDivBiPolar:114,DssGraphShowErrorBar:115,DssGraphShowLegendText:116,DssGraphShow2DO1Label:117,DssGraphShow2DO1:-117,DssGraphShow2DO2:118,DssGraphOffScaleTypeX:119,DssGraphOffScaleTypeY1:120,DssGraphOffScaleTypeY2:121,DssGraphShowQuadrants:122,DssGraphShowRiserShadows:123,DssGraphShow2DXTitle:124,DssGraphShow2DY1Title:125,DssGraphShow2DY2Title:126,DssGraphShow2DXLabel:127,DssGraphShow2DX:-127,DssGraphShow2DY1Label:128,DssGraphShow2DY1:-128,DssGraphShow2DY2Label:129,DssGraphShow2DY2:-129,DssGraphShowZeroLineX:130,DssGraphShowZeroLineY1:131,DssGraphShowZeroLineY2:132,DssGraph2DSideO1:133,DssGraph2DSideO2:134,DssGraph2DSideX:135,DssGraph2DSideY1:136,DssGraph2DSideY2:137,DssGraph2DSDSplitY:140,DssGraphStaggerO1:142,DssGraphStaggerO2:143,DssGraphStaggerX:144,DssGraphStaggerY1:145,DssGraphStaggerY2:146,DssGraphUniformBorders:148,DssGraphPieDepthValue:192,DssGraphPieHoleSizeValue:198,DssGraphPieInset:200,DssGraphPiesPerRowValue:201,DssGraphPieRotationValue:202,DssGraphShowFeeler:204,DssGraphShowLBLFeelerLabel:205,DssGraphShowLBLFeeler:-205,DssGraphShowLBLPie:206,DssGraphShowLBLRing:207,DssGraphDeleteSlice:208,DssGraphDetachSlice:209,DssGraphPieRestore:210,DssGraphPieTiltValue:211,DssGraphPieTiltOn:212,DssGraphShowPolarCoordinateAxis:215,DssGraphShowPolarConnectLines:218,DssGraphStockDataValueType:222,DssGraphShowBubbleGrid:245,DssGraphSDShowDataText:247,DssGraphShowTitleSeries:248,DssGraphConnectStackBars:249,DssGraphLegendBox:250,DssGraphLinkColors:260,DssGraph3DCustomView:265,DssGraph3DGridFloor:277,DssGraph3DGridLWall:278,DssGraph3DGridRiser:279,DssGraph3DGridRWall:280,DssGraph3DColTitleLocation:285,DssGraph3DLYTitleLocation:287,DssGraph3DRowTitleLocation:288,DssGraph3DRYTitleLocation:289,DssGraph3DScalefreqX:299,DssGraph3DScalefreqY:300,DssGraph3DScalefreqZ:301,DssGraphShow3DScatterLine:308,DssGraphShow3DLineToLWall:309,DssGraphShow3DLineToFloor:310,DssGraphShow3DLineToRWall:311,DssGraphSD3DRiserType:312,DssGraphShow3DShowDataLabelsBox:313,DssGraph3DOffScaleTypeX:314,DssGraph3DOffScaleTypeY:315,DssGraph3DOffScaleTypeZ:316,DssGraphShow3DCHeader:318,DssGraphShow3DColTitle:319,DssGraph3DShowDataText:320,DssGraphShow3DLNumber:321,DssGraphShow3DLYTitle:322,DssGraphShow3DRNumber:323,DssGraphShow3DRYTitle:324,DssGraphShow3DRHeader:325,DssGraphShow3DRowTitle:326,DssGraphShow3DFloor:327,DssGraphShow3DLegend:328,DssGraphShow3DLWall:329,DssGraphShow3DRWall:330,DssGraph3DViewStruct:337,DssGraphACMColorModel:549,DssGraphLegendItems:554,DssGraphSeriesColor:556,DssGraphReverseGroup:558,DssGraphReverseSeries:559,DssGraphSeriesByColumn:560,DssGraphAreaBackColor:561,DssGraphAreaTransparency:563,DssGraphAreaColor:564,DssGraphAreaPattern:566,DssGraphAreaSFX:567,DssGraphFontAlign:570,DssGraphFontTransparency:573,DssGraphFontColor:574,DssGraphFontName:576,DssGraphFontRotation:578,DssGraphVirtualFontSize:583,DssGraphFontStyle:584,DssGraphType:585,DssGraphLineTransparency:587,DssGraphLineColor:588,DssGraphLinePattern:589,DssGraphVirtualLineWidth:591,DssGraphFootnoteLocation:592,DssGraphFrameLocation:593,DssGraphSubTitleLocation:594,DssGraphTitleLocation:595,DssGraphShowfootnote:596,DssGraphShowSubtitle:597,DssGraphShowTitle:598,DssGraphFontBox:601,DssGraphFontSize:603,DssGraphLockFontSize:604,DssGraphLineWidth:605,DssGraphAreaAlpha:608,DssGraphLineAlpha:609,DssGraphFontAlpha:610,DssGraphAreaCustomBevelEffect:612,DssGraphFormatDataTextAdv:616,DssGraphFormatXAdv:618,DssGraphFormatY1Adv:619,DssGraphFormatY2Adv:620,DssGraphFormatZAdv:621,DssGraphMiddleValue:630,DssGraphSplitYPosition:631,DssGraphAxisShowUserLine:632,DssGraphAxisUserLineValue:633,DssGraphAxisUserLineAxis:634,DssGraphMarkerLayout:637,DssGraphPieDataValueLoc:638,DssGraphPieDataLabelLoc:639,DssGraph2DOrdSpaceMode:642,DssGraphLegendLock:644,DssGraphGridStepY1:645,DssGraphGridStepY2:646,DssGraphGridStepX:647,DssGraphDataTextShowConnectLine:652,DssGraphGridLineZ:658,DssGraphScaleZ:659,DssGraphStaggerZ:660,DssGraph2ScaleEndZ:662,DssGraph2ExcludeZeroZ:663,DssGraph2ScaleDirectionZ:664,DssGraphGridStepZ:665,DssGraphGaugeInfo:668,DssGraphGaugeFancyBox:669,DssGraphSDMarkerSize:671,DssGraphSDMarkerShape:683,DssGraphMetric1:690,DssGraphMetric2:691,DssGraphStockStyle:692,DssGraph2ScaleDirectionY3:693,DssGraph2ExcludeZeroY3:694,DssGraphGridLineY3:697,DssGraphFormatY3Adv:699,DssGraphGridStepY3:701,DssGraphOffScaleTypeY3:702,DssGraphShow2DY3:704,DssGraph2DSideY3:706,DssGraphStaggerY3:707,DssGraph2DPlaceY3:709,DssGraph2ScaleEndY3:710,DssGraph2DScaleFreqY3:713,DssGraphScaleY3:714,DssGraph2ScaleDirectionY4:715,DssGraph2ExcludeZeroY4:716,DssGraphGridLineY4:719,DssGraphFormatY4Adv:721,DssGraphGridStepY4:723,DssGraphOffScaleTypeY4:724,DssGraphShow2DY4:726,DssGraph2DSideY4:728,DssGraphStaggerY4:729,DssGraph2DPlaceY4:731,DssGraph2ScaleEndY4:732,DssGraph2DScaleFreqY4:735,DssGraphScaleY4:736,DssGraphSpiderLines:739,DssGraphPolarStartAngle:740,DssGraphMetric3:742,DssGraphRadarCircularDataLines:782,DssGraphRemoteAxis:784,DssGraphConnectFirstLast:790,DssGraphGaugeShowAxisLabelsOutside:791,DssGraphGaugeShowNeedle:792,DssGraphTailShape:793,DssGraphPieForceRound:794,DssGraphGaugeStyleValue:795,DssGraphGaugeBorderStyleValue:796,DssGraphGaugeBorderThicknessValue:797,DssGraphGaugeRangeThicknessValue:798,DssGraphGaugeRangeStartAngleValue:799,DssGraphGaugeRangeStopAngleValue:800,DssGraphGaugeNeedleStyleValue:801,DssGraphCurvedLines:804,DssGraphAreaBevelEffect:879,DssGraphFontAntiAlias:881,DssGraphFormatDataTextY3:695,DssGraphFormatDataTextY4:717,DssGraphColorPalette:10000,DssGraphOriContent:10001,DssGraphFillEffect:10002,DssGraphGradient:10003,DssGraphSDShowToolTip:10004,DssGraphSDToolTip:10005,DssGraphSDRegressionType:10006,DssGraph2LogScale:10007,DssGraphManualMajor:10008,DssGraphManualMinor:10009,DssGraph2ScaleDirection:10010,DssGraphShow2DAxisLine:10011,DssGraph2ExcludeZero:10012,DssGraph2ScaleUseMax:10013,DssGraph2ScaleUseMin:10014,DssGraph2ScaleMax:10015,DssGraph2ScaleMin:10016,DssGraphShow2DAxisLabels:10017,DssGraph2ScaleEndMax:10018,DssGraph2ScaleEndMin:10019,DssGraphShow2DAxisMajor:10020,DssGraphShow2DAxisMinor:10021,DssGraph2DSide:10022,DssGraphStyleMajor:10023,DssGraphStyleMinor:10024,DssGraphCountMajor:10025,DssGraphCountMinor:10026,DssGraphShowTotalValue:10027,DssGraph2DPie:10028,DssGraphShowDataValue:10029,DssGraphShowDVPercent:10030,DssGraphShowDataLabel:10031,DssGraphShowPieLabelOnSide:10032,DssGraphShowMarker:10033,DssGraphShowMetric1:10034,DssGraphShowMetric2:10035,DssGraphShowMetric3:10036,DssGraphMetric1Style:10037,DssGraphMetric2Style:10038,DssGraphMetric3Style:10039,DssGraphShowLine:10040,DssGraphShowToolTip:10041,DssGraphToolTip:10042,DssGraphAxisAutoFit:10043,DssGraphAxisStagger:10044,DssGraphAxisScaleFreq:10045,DssGraphMetric1Value:10046,DssGraphMetric2Value:10047,DssGraphMetric3Value:10048,DssGraph2AxisFormatText:10049,DssGraph2AxisFormatDataText:10050,DssGraphDPI:10051,DssGraphDocSize:10052,DssGraphAutoArrange:10053,DssGraph2DSplitYAutomatic:10054,DssGraphHistogramRangeMin:10055,DssGraphHistogramRangeMax:10056,DssGraphHistogramBuckets:10057,DssGraphGaugeSAngle:10058,DssGraphGaugeEAngle:10059,DssGraphGaugeThickness:10060,DssGraphGauge1Show:10061,DssGraphGauge1Min:10062,DssGraphGauge1Max:10063,DssGraphGauge2Show:10064,DssGraphGauge2Min:10065,DssGraphGauge2Max:10066,DssGraphGauge3Show:10067,DssGraphGauge3Min:10068,DssGraphGauge3Max:10069,DssGraphGauge4Show:10070,DssGraphGauge4Min:10071,DssGraphGauge4Max:10072,DssGraphGauge5Show:10073,DssGraphGauge5Min:10074,DssGraphGauge5Max:10075,DssGraphAxisDataTextPlace:10076,DssGraphAxisNumberFormat:10077,DssGraphAxisDataNumberFormat:10078,DssGraphAxisHasErrorBar:10079,DssGraphAxisHasMiddleValue:10080,DssGraphHeight:10081,DssGraphWidth:10082,DssGraphPicture:10083,DssGraph3DTurnXCounterClockwise:10084,DssGraph3DTurnYCounterClockwise:10085,DssGraph3DTurnZCounterClockwise:10086,DssGraph3DTurnXClockwise:10087,DssGraph3DTurnYClockwise:10088,DssGraph3DTurnZClockwise:10089,DssGraph3DMoveXTowardsOrigin:10090,DssGraph3DMoveYTowardsOrigin:10091,DssGraph3DMoveZTowardsOrigin:10092,DssGraph3DMoveXAwayFromOrigin:10093,DssGraph3DMoveYAwayFromOrigin:10094,DssGraph3DMoveZAwayFromOrigin:10095,DssGraph3DDecreaseCubeX:10096,DssGraph3DDecreaseCubeY:10097,DssGraph3DDecreaseCubeZ:10098,DssGraph3DIncreaseCubeX:10099,DssGraph3DIncreaseCubeY:10100,DssGraph3DIncreaseCubeZ:10101,DssGraph3DDecreaseWallX:10102,DssGraph3DDecreaseWallY:10103,DssGraph3DDecreaseWallZ:10104,DssGraph3DIncreaseWallX:10105,DssGraph3DIncreaseWallY:10106,DssGraph3DIncreaseWallZ:10107,DssGraph3DPanXLeft:10108,DssGraph3DPanYUp:10109,DssGraph3DRelative:10110,DssGraph3DPanXRight:10111,DssGraph3DPanYDown:10112,DssGraph3DAbsolute:10113,DssGraph3DZoomIn:10114,DssGraph3DIncreasePerspectiveDistortion:10115,DssGraph3DStepSize:10116,DssGraph3DZoomOut:10117,DssGraph3DDecreasePerspectiveDistortion:10118,DssGraph3DInitMatrix:10119,DssGraphGaugeQBShow:10120,DssGraphGaugeQBStart:10121,DssGraphGaugeQBStop:10122,DssGraphEnhancedSeriesEffect:10123,DssGraphLocale:10124,DssGraph3DViewStructName:10125,DssGraphLabelsDistance:10126,DssGraphLegendDetails:10127,DssGraphDefaultsInitialized:10128,DssGraphShow3DAxisMajor:10129,DssGraphGradientColorMode:10130,DssGraphLegendDetailsNEW:10131,DssGraphFrameLocationNEW:10132,DssGraph3DColTitleLocationNEW:10133,DssGraph3DRowTitleLocationNEW:10134,DssGraphLabelsDistanceNEW:10135,DssGraphDocSizeNEW:10136,DssGraphUseManualHistogramBuckets:10137,DssGraphFontSize100:10138,DssGraphUseSpecialSeries:10140,DssGraphIsOnlyAdditionalMetrics:10170};mstrmojo.vi.controllers.EnumLayoutManipulationType={RENAME:1,MOVE:2,DUPLICATE:3,DELETE:4,NEW:5};(function(){var B=1,C=2,A=4;mstrmojo._IsThresholdConditionTarget=mstrmojo.provide("mstrmojo._IsThresholdConditionTarget",{_mixinName:"mstrmojo._IsThresholdConditionTarget",update:function D(G){var E=G.data.tta;var F=(E&B)>0,H=(E&C)>0;if(F&&this.preservedEnabled===undefined){this.preservedEnabled=!!this.enabled;}if(H&&this.preservedVisible===undefined){this.preservedVisible=!!this.visible;}this.set("enabled",F?false:this.preservedEnabled!==undefined?this.preservedEnabled:this.enabled);this.set("visible",H?false:this.preservedVisible!==undefined?this.preservedVisible:this.visible);this.set("required",(E&A)>0);if(this._super){this._super(G);}}});}());mstrmojo.mstr.EnumDSSXMLTokenStates={Error:-1,Reserved:0,Initial:1,Okay:2};mstrmojo._ShowsStatus=mstrmojo.provide("mstrmojo._ShowsStatus",{showStatus:function showStatus(A,G,D){var C=this._STATUS;if(!this.hasRendered||!C){return ;}var E=C.style;if(!A){if(this.showingStatus){E.display="none";}}else{if(C){var F=this._STATUS_TXT;if(F){F.innerHTML=G||"";}var B=this._STATUS_BAR;if(B){B.style.width=(D||0)+"%";}if(!this.isStatusBarPositioned){E.top=Math.max((this.scrollboxHeight||0)-50,12)+"px";this.isStatusBarPositioned=true;}if(!this.showingStatus){E.display="block";}}}this.showingStatus=A;},updateStatus:function updateStatus(A,B){this.showStatus(this.showingStatus,A,B);}});(function(){mstrmojo.vi.ui.theme=mstrmojo.provide("mstrmojo.vi.ui.theme",{getThemeClass:function A(){var D=this.parent||this.opener,C="",B;while(D){var E=D.themeClassName;if(E){C=E;break;}B=D.parent||D.opener;if(B===D){break;}D=B;}return C;}});}());mstrmojo.warehouse.EnumObjectTypes={FILTER:1,METRIC:4,ATTRIBUTE:12,FACT:13,DIMENSION:14,TABLE:15,TABLE_LOGICAL_VIEW:151,TABLE_PARTITION:152,FORM:21,COLUMN:26,DBROLE:29,PROJECT:32,TRANSFORMATION:43,DBTABLE:53,LAYER:70,RELATIONSHIP:99,COMPOUND_FORM:1001,RELATIONSHIP_ATTRIBUTE:1002};mstrmojo.mstr.EnumDataType={DataTypeUnknown:-1,DataTypeReserved:0,DataTypeInteger:1,DataTypeUnsigned:2,DataTypeNumeric:3,DataTypeDecimal:4,DataTypeReal:5,DataTypeDouble:6,DataTypeFloat:7,DataTypeChar:8,DataTypeVarChar:9,DataTypeLongVarChar:10,DataTypeBinary:11,DataTypeVarBin:12,DataTypeLongVarBin:13,DataTypeDate:14,DataTypeTime:15,DataTypeTimeStamp:16,DataTypeShort:21,DataTypeLong:22,DataTypeMBChar:23,DataTypeBool:24,DataTypePattern:25,DataTypeBigDecimal:30,DataTypeCellFormatData:31,DataTypeInt64:34};mstrmojo.vi.models.EnumFieldTypes={TEXT:3,IMAGE:2,HTML_CONTAINER:10};mstrmojo.vi.ui.rw.selectors.EnumVizSelectorMode={CONFIGURATION:"configure",INTERACTIVE:"interactive"};if(!mstrmojo.LoadedExternalJSURLs){mstrmojo.LoadedExternalJSURLs={};}function LoadScriptsExternalJSCallback(){mstrmojo.LoadedExternalJSURLs[mstrmojo._LoadsScript.esScripts.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(mstrmojo._LoadsScript.esScripts,mstrmojo._LoadsScript.callback,mstrmojo._LoadsScript.esScritsContext);mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=false;}if(!mstrmojo._LoadsScript){mstrmojo._LoadsScript=mstrmojo.provide("mstrmojo._LoadsScript",{_meta_usesSuper:false,requiresMethod:function requiresMethod(B){if(!B){return false;}if(typeof this[B]==="function"){return true;}var A=this[B]||(this.methods&&(this.methods[B]||this.methods["*"]));if(typeof A==="string"){this.requiresCls(A);return typeof this[B]==="function";}return false;},requiresCls:function req(mixins,callback){if(mixins){if(typeof mixins==="string"){mixins=[mixins];}mstrmojo.requiresCls.apply(mstrmojo,mixins);var p=this.constructor.prototype,pm=p.mixins;if(!pm){p.mixins={};pm=p.mixins;}var mx=mstrmojo.mixin,i,len;for(i=0,len=mixins.length;i<len;i++){var fqcn=mixins[i];if(!pm[fqcn]){var m=eval(mixins[i]);mx(m,p);pm[fqcn]=true;if(m.__onmixin__){m.__onmixin__.apply(this,[]);}}}if(callback){callback.apply(this,[]);}}},requiresContrib:function reqCb(C,B){var A=this[C];if(A){var E,D=false;if(typeof A==="string"){E=mstrmojo.registry.ref(A);this[C]=E;D=true;}else{E=A;}if(E&&(D||B)){E.parent=this;if(E.startup){E.startup();}}return E;}return null;},requiresExternalScripts:function requiresExternalScripts(G,H,C){if(G&&G instanceof Array){if(G.length===0){if(H){H.call(C);}return false;}if(G[0]&&G[0].forceReload===false&&mstrmojo.LoadedExternalJSURLs[G[0].url]){G.splice(0,1);return this.requiresExternalScripts(G,H,C);}var A=document.createElement("script"),D=!!document.all,B=G[0].url,F=G[0].onError;if(B.substr(0,7)==="file://"){B=B.substr(7);}else{if(mstrApp.isSingleTier&&B.substr(0,4)!=="http"){B="http:"+B;}}A.type="text/javascript";A.src=B;if(F){A.onerror=function(){if(F&&F.callback&&C){F.callback.call(C,F.params);}};}if(!G[0].callbackParamName){if(D){A.onreadystatechange=function(){if(A.readyState==="loaded"||A.readyState==="complete"){A.onreadystatechange=null;A.onerror=null;if(G.length>1){mstrmojo.LoadedExternalJSURLs[G.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(G,H,C);}else{if(G.length===1){mstrmojo.LoadedExternalJSURLs[G[0].url]=true;if(H){H.call(C);}}}}};}else{A.onload=function(){A.error=null;A.onload=null;if(G.length>1){mstrmojo.LoadedExternalJSURLs[G.splice(0,1)[0].url]=true;mstrmojo._LoadsScript.requiresExternalScripts(G,H,C);}else{if(G.length===1){mstrmojo.LoadedExternalJSURLs[G[0].url]=true;if(H){H.call(C);}}}};}}else{if(G[0].callbackParamName.length!==0){if(mstrmojo._LoadsScript.ExternalJSCallbackIsBusy&&mstrmojo._LoadsScript.ExternalJSCallbackIsBusy===true){var E=this;window.setTimeout(function(){E.requiresExternalScripts(G,H,C);},500);return ;}mstrmojo._LoadsScript.ExternalJSCallbackIsBusy=true;A.src+="&"+G[0].callbackParamName+"=LoadScriptsExternalJSCallback";mstrmojo._LoadsScript.esScripts=G;mstrmojo._LoadsScript.callback=H;mstrmojo._LoadsScript.esScritsContext=C;}}document.getElementsByTagName("head")[0].appendChild(A);}}});}(function(){var B={NetworkVisualizationStyle:{b:"vi-network.js",s:"VisualizationServerJsonDataStyle",c:"netviz.VisNetwork",oivmb:"oivm-network.js",vib:"vi-network.js"},ReportTimelineAjaxVisualizationStyle:{s:"TimelineMojoVisualizationDataStyle",c:"VisTimeline"},visAjaxDatePicker:{s:"AjaxDatePickerReportStyle",c:"VisDateSelection"},SurveyVisualizationStyle:{s:"VisualizationDataStyle",c:"SurveyVis"},VIHeatMapVisualizationStyle:{b:"vi-heatmap.js",s:"VisualizationServerJsonDataStyle",c:"heatmap.vi.VisHeatMap",oivmb:"oivm-heatmap.js",vib:"vi-heatmap.js"},KPICardVisualizationStyle:{b:"vi-kpi.js",s:"VisualizationServerJsonDataStyle",c:"kpicard.VisKPICard",lib:'[["libraries/echarts.common.min.js"],["libraries/slick/slick.min.js"]]'},GraphMatrixVisualizationStyle:{b:"vi-gm.js",s:"VisualizationServerJsonDataStyle",c:"gm.VisGraphMatrix",oivmb:"oivm-gm.js",vib:"vi-gm.js"},ESRIMapVisualizationStyle:{b:"mojo-map.js",s:"MojoXtabMapStyle",c:"VisMapBase"},MapboxVisualizationStyle:{b:"mojo-map.js",s:"MojoXtabMapStyle",c:"mapbox.VisMapbox",lib:'[["libraries/mapbox/mapbox-gl.js"],["libraries/mapbox/supercluster.min.js"],["libraries/mapbox/turf.min.4.7.3.js"]]'},NewGraphMatrixVisualizationStyle:{b:"vi-ngm.js",s:"VisualizationServerJsonDataStyle",c:"ngm.VisNewGraphMatrix",lib:'[["../VisFramework/ngm/dist/bundle/ngm.js"]]',oivmb:"oivm-ngm.js",vib:"vi-ngm.js"},GoogleMapVisualizationStyle:{b:"mojo-map.js",s:"MojoXtabMapStyle",c:"VisMapBase"}};var E={"com.microstrategy.web.vf.viewer.EsriMapApplicationViewer":"ESRIMapVisualizationStyle","com.microstrategy.web.vf.viewer.HeatMapApplicationViewer":"VIHeatMapVisualizationStyle","com.microstrategy.flex.viewer.GraphMatrixViewer":"GraphMatrixVisualizationStyle","com.microstrategy.flex.viewer.NewGraphMatrixViewer":"NewGraphMatrixVisualizationStyle","com.microstrategy.web.vf.viewer.DatePickerApplicationViewer":"visAjaxDatePicker","com.microstrategy.flex.viewer.NetViz":"NetworkVisualizationStyle"};mstrmojo.ExpressVisList=mstrmojo.provide("mstrmojo.ExpressVisList",{getVis:function D(F){return B[F]||(mstrConfig&&mstrConfig.pluginsVisList&&mstrConfig.pluginsVisList[F])||null;},findVisName:function(F){return E[F]||(mstrConfig&&mstrConfig.pluginsWidgetVisMap[F])||null;},findWidgetName:function C(H){var G;for(var F in E){if(E.hasOwnProperty(F)&&E[F]===H){G=F;break;}}if(!G&&mstrConfig&&mstrConfig.pluginsWidgetVisMap){for(var F in mstrConfig.pluginsWidgetVisMap){if(mstrConfig.pluginsWidgetVisMap.hasOwnProperty(F)&&mstrConfig.pluginsWidgetVisMap[F]===H){G=F;break;}}}return G;},getVisClass:function A(F,G){if(G.txi&&G.t===115){F=mstrmojo.DynamicClassFactory.newComponent(F,[mstrmojo._CanSupportTransaction,mstrmojo._IsEditableXtab]);}return F;}});}());(function(){mstrmojo.url=mstrmojo.provide("mstrmojo.url",{isAbsoluteURL:function(B){return(/^(http|https|ftp|file):\/\//i.test(B));},getAbsoluteURL:function(B,C){if(this.isAbsoluteURL(B)){return B;}if(C){return C+(/\/$/.test(C)?"":"/")+B;}return"http://"+B;},getWebServerUrl:function(F){var J=null;if(F){if(mstrApp!==undefined&&mstrApp.getConfiguration){J=mstrApp.getConfiguration().getCurrentProjectWebServerUrl();}}else{var D=document.location&&document.location.href;if(D){var E=D.toLowerCase();var C="/app/",L="/servlet/",K="/asp/";var B=E.indexOf(C),H=E.indexOf(L),I=E.indexOf(K);if(B>=0){J=D.substr(0,B+1);}else{if(H>=0){if(I<0){J=D.substr(0,H+1);}else{if(I>=0){var G=(H>I)?I:H;J=D.substr(0,G+1);}}}else{if(H<0){if(I>=0){J=D.substr(0,I+1);}}}}}}return J;},getFullPath:function A(J){var E=J,C=/^[A-z]:\/\//,I,D;if(!(mstrApp&&mstrApp.isDossier)||!J||J.indexOf("data:image")===0){return J;}if(C.test(J)){E=J;}else{var H=/^(\.\.\/|\.\.\\)/;var G=/^(\.\/|\.\\)/;var F=/^(\/|\\)/;J=J.replace(H,"");J=J.replace(G,"");J=J.replace(F,"");if(mstrApp&&mstrApp.getConfiguration){var B=this.getWebServerUrl(this.isTablet);if(!B){E=J;}else{E=this.getAbsoluteURL(J,B);}}}return E;}});}());(function(){mstrmojo.StringBuffer=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.StringBuffer",append:function A(C){if(!this.buf){this.reset();}this.buf[++this.len]=C;return this;},reset:function B(){this.buf=[];this.len=-1;}});mstrmojo.StringBuffer.prototype.toString=function(D){var C=this.buf;return(C&&C.join(D||""))||"";};}());(function(){mstrmojo.vi._MonitorsLayoutMode=mstrmojo.provide("mstrmojo.vi._MonitorsLayoutMode",{onLayoutModeChange:function(B){if(this._super){this._super(B);}},init:function A(B){this._super(B);if(mstrApp.attachEventListener){mstrApp.attachEventListener("layoutModeChange",this.id,"onLayoutModeChange");}}});}());mstrmojo.mstr.EnumNodeProperties={NORMAL:0,DRILL:1,CONDITION:2};mstrmojo.warehouse.EnumDatabaseType={SAP:1200,MSAS:1500,EssBase:1600,TM1:2900,SAPHana:4000,BDE:5400,SearchEngineSOLR:5500,Hive:3100,Impala:4100,SearchEngineSPLUNK:5600,Pig:6400,PHOENIX:6800,IBMBigInsights:700,Drill:7300,DB_TYPE_NEWDB_1:8100,DB_TYPE_NEWDB_5:8500,AzureCosmosDB:8700};mstrmojo.vi.models.EnumDragSources={DATASETS:1,VIZ_EDITOR:2,FILTERS:3,ALL_OBJECT_LIST:4,VIZ:5,TOC_CHAPTER:6,TOC_PAGES_LIST:7,VIZ_LAYER:8};(function(){var E=new RegExp("^[A-Z0-9]{8}[A-Z0-9]{4}[A-Z0-9]{4}[A-Z0-9]{4}[A-Z0-9]{12}$","i");var A=2147483648;var G=Array.apply(null,Array(256)).map(function(H,I){return(I<16?"0":"")+I.toString(16).toUpperCase();});var F=(window.crypto&&window.crypto.getRandomValues)?function(){var H=new Uint32Array(4);window.crypto.getRandomValues(H);return{d0:H[0],d1:H[1],d2:H[2],d3:H[3]};}:function(){return{d0:Math.abs(Math.floor(Math.random()*A)^(+new Date())),d1:Math.abs(Math.floor(Math.random()*A)^(+new Date())),d2:Math.abs(Math.floor(Math.random()*A)^(+new Date())),d3:Math.abs(Math.floor(Math.random()*A)^(+new Date()))};};function D(H){var L=H.d0,K=H.d1,J=H.d2,I=H.d3;return G[L&255]+G[L>>8&255]+G[L>>16&255]+G[L>>24&255]+G[K&255]+G[K>>8&255]+G[K>>16&15|64]+G[K>>24&255]+G[J&63|128]+G[J>>8&255]+G[J>>16&255]+G[J>>24&255]+G[I&255]+G[I>>8&255]+G[I>>16&255]+G[I>>24&255];}mstrmojo.UUID=mstrmojo.provide("mstrmojo.UUID",{create:function C(){return D(F());},isUUID:function B(H){return H&&E.test(H.toString());}});mstrmojo.UUID.EMPTY="00000000000000000000000000000000";}());(function(){function B(L,Q,N){var M,O;M=0;if(N){M=Math.max(L,L-Q);M=Math.max(M,-Q);}else{M=L-Q;}if(M===0){this.mIsShown=false;return 1;}var P=M;O=1;while(M<1){M*=10;O/=10;}while(M>=10){M/=10;O*=10;}if(M<1.8){O*=2;O/=10;}else{if(M<3.1){O*=4;O/=10;}else{if(M<4.6){O*=5;O/=10;}else{if(M>=8.1){O*=2;}}}}return O;}function K(P){var L,N;this.mStep=B.call(this,this.mMaximum,this.mMinimum,P.mAlwaysIncludeZero);this.mMaxTick=Math.ceil(this.mMaximum/this.mStep)*this.mStep;this.mMinTick=Math.floor(this.mMinimum/this.mStep)*this.mStep;this.mMinTick=(this.mMinTick*this.mMinimum<0)?0:this.mMinTick;if(P.mAlwaysIncludeZero){this.mMaxTick=(this.mMaximum<0)?0:this.mMaxTick;this.mMinTick=(this.mMinimum>0)?0:this.mMinTick;}var M=this.mMaxTick-this.mMinTick;if(this.mStep>=M){return ;}L=Math.floor((this.mMaxTick-this.mMinTick+this.mStep/100)/this.mStep)+1;for(N=1;N<L-1;++N){var O=this.mMinTick+N*this.mStep;this.mTicks.push(O);}}function C(M){var L;this.mMaxTick=1;this.mStep=this.mMinimum<0?0.2:0.1;if(M.mUseCustomMinMax){this.mMaxTick=M.mAxisMaxValue;this.mMinTick=M.mAxisMinValue;this.mMaxTick=Math.min(1,this.mMaxTick);this.mMinTick=Math.max(-1,this.mMinTick);this.mStep=0.1;}else{if(this.mMaximum>=0.5){this.mMaxTick=1;this.mMinTick=Math.floor(this.mMinimum/this.mStep)*this.mStep;this.mMinTick=(this.mMinTick*this.mMinimum<0)?0:(this.mMinTick>0?0:this.mMinTick);if(this.mMinimum<-0.5){this.mMinTick=-1;}}else{if(this.mMaximum>0){this.mMaxTick=Math.ceil(this.mMaximum/this.mStep)*this.mStep;this.mMinTick=-1;}else{this.mStep=0.1;this.mMaxTick=0;this.mMinTick=-1;}}}for(L=this.mMinTick+this.mStep;L+0.01<this.mMaxTick;L+=this.mStep){this.mTicks.push(Math.round(L*100)/100);}}function I(L){return Math.log(L)/Math.log(10);}function H(O){var N,L,M;this.mStep=1;if(this.mMaximum<=0){this.mMinTick=1;this.mMaxTick=10;return ;}if(this.mMinimum<=0){L=this.mMaximum>1?0:-1;this.mMinTick=Math.pow(10,L);if(O.mUseCustomMinMax){this.mMaxTick=this.mMaximum;N=Math.floor(I.call(this,this.mMaximum));if(I.call(this,this.mMaximum)===N){N--;}}else{N=Math.ceil(I.call(this,this.mMaximum));this.mMaxTick=Math.pow(10,N);}for(M=L+1;M<N;++M){this.mTicks.push(Math.pow(10,Math.floor(M)));}return ;}if(O.mUseCustomMinMax){N=I.call(this,this.mMaximum);L=I.call(this,this.mMinimum);this.mMaxTick=this.mMaximum;this.mMinTick=this.mMinimum;}else{N=Math.ceil(I.call(this,this.mMaximum));L=Math.floor(I.call(this,this.mMinimum));this.mMaxTick=Math.pow(10,N);this.mMinTick=Math.pow(10,L);}for(M=L+1;M<N;++M){this.mTicks.push(Math.pow(10,Math.floor(M)));}}function J(L){this.mTicks.splice(0,this.mTicks.length);if(this.mIsPercent){return C.call(this,L);}if(L.mUseLogarithmicScale){return H.call(this,L);}K.call(this,L);}function G(Q){if(Q.mUseCustomMinMax||Q.mUseLogarithmicScale){return ;}var M=0.1,O=false,L=false,P=[];this.GetTicks(P);if(P.length>=2){var N=P.length;L=((Math.abs(this.mMaximum-P[N-2])<M*this.mStep));O=((Math.abs(this.mMinimum-P[1])<M*this.mStep));if(this.mIsPercent){L=false;}}if(L&&O){this.mMinTick=this.mMinimum;this.mMaxTick=this.mMaximum;Q.mUseMinValue=Q.mShowMinLabel=true;Q.mUseMaxValue=Q.mShowMaxLabel=true;}else{if(L){this.mMaxTick=this.mMaximum;Q.mUseMaxValue=Q.mShowMaxLabel=true;}else{if(O){this.mMinTick=this.mMinimum;Q.mUseMinValue=Q.mShowMinLabel=true;}else{}}}if(Q.mAlwaysIncludeZero){this.mMaxTick=(this.mMaximum<0)?0:this.mMaxTick;this.mMinTick=(this.mMinimum>0)?0:this.mMinTick;}}mstrmojo.chart.common.ScalePlate=mstrmojo.provide("mstrmojo.chart.common.ScalePlate",{mOptions:{mShowMinLabel:true,mShowMaxLabel:true},isStackedChart:false,mStep:0,mIsPercent:false,mMinimum:0,mMaximum:0,mMaxTick:0,mMinTick:0,mTicks:[],clear:function F(){this.isStackedChart=this.mIsPercent=false;this.mMinimum=this.mMaximum=0;this.mMinTick=this.mMaxTick=0;this.mStep=0;this.mTicks=[];},GetTicks:function A(M){if(this.mOptions.mShowMinLabel){M.push(this.mMinTick);}var L;for(L=0;L<this.mTicks.length;++L){M.push(this.mTicks[L]);}if(this.mOptions.mShowMaxLabel){M.push(this.mMaxTick);}},getMaxMinTickValue:function D(O,N,L,M){this.computeTicks(O,N,L,M);return{Max:this.mMaxTick,Min:this.mMinTick};},computeTicks:function E(Q,P,L,N){this.mMinimum=N;this.mMaximum=L;this.mIsPercent=!!(P&1);this.isStackedChart=!!(P&2);var O=1e-14;if(!Q.mUseLogarithmicScale&&this.isStackedChart){this.mMinimum=Math.min(this.mMinimum,0);this.mMaximum=Math.max(this.mMaximum,0);}if(Q.mDrawCustomLine){this.mMinimum=Math.min(this.mMinimum,Q.mAxisCustomValue);this.mMaximum=Math.max(this.mMaximum,Q.mAxisCustomValue);}if(this.mIsPercent&&this.mMinimum===this.mMaximum&&1===this.mMaximum){if(this.mMinimum===1){this.mMinimum=0;}}if(Math.abs(this.mMinimum-this.mMaximum)<O){if(this.mMinimum<-O||this.mMinimum>O){var M=Math.abs(this.mMinimum)*0.5;this.mMaximum=this.mMaximum+M;this.mMinimum=this.mMinimum-M;}else{this.mMinimum=-6;this.mMaximum=6;}}J.call(this,Q);if(Q.mUseLogarithmicScale&&this.isStackedChart){this.mMaximum=Q.mDrawCustomLine?Math.max(this.mMaximum+this.mMinTick,Q.mAxisCustomValue):this.mMaximum+this.mMinTick;this.mMinimum=Math.min(this.mMinimum,0);this.mTicks.splice(0,this.mTicks.length);H.call(this,Q);}G.call(this,Q);}});}());mstrmojo.vi.models.EnumPanelTypes={FILTERS:1,VIS_CONTENT:2,PAGEBY:3,VISUALIZATION:4};(function(){mstrmojo.vi.ui.rw._SavesChildPositions=mstrmojo.provide("mstrmojo.vi.ui.rw._SavesChildPositions",{scriptClass:"mstrmojo.vi.ui.rw._SavesChildPositions",getChildPositionActions:function A(){var B=this.children,C=[];B.forEach(function(D){if(D.addFormatProps){C.push(D.addFormatProps());}if(D.getChildPositionActions){C=C.concat(D.getChildPositionActions());}});return C;}});}());(function(){var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",G=String.fromCharCode;function D(H){H=H.replace(/\r\n/g,"\n");var I="";for(var K=0;K<H.length;K++){var J=H.charCodeAt(K);if(J<128){I+=G(J);}else{if((J>127)&&(J<2048)){I+=G((J>>6)|192);I+=G((J&63)|128);}else{I+=G((J>>12)|224);I+=G(((J>>6)&63)|128);I+=G((J&63)|128);}}}return I;}function F(L){var H="",J=0,M=0,K=0,I=0;while(J<L.length){M=L.charCodeAt(J);if(M<128){H+=G(M);J++;}else{if((M>191)&&(M<224)){K=L.charCodeAt(J+1);H+=G(((M&31)<<6)|(K&63));J+=2;}else{K=L.charCodeAt(J+1);I=L.charCodeAt(J+2);H+=G(((M&15)<<12)|((K&63)<<6)|(I&63));J+=3;}}}return H;}mstrmojo.base64=mstrmojo.provide("mstrmojo.base64",{decodeHttpHeader:function E(K){var I=/\=\?UTF-8\?B\?(.+?)\?\=/g;if(K&&K.indexOf("=?UTF-8?B?")===0){var J="",H;while((H=I.exec(K))!==null){J+=mstrmojo.base64.decode(H[1]);}return J;}return K;},encode:function B(J){var H="";var Q,O,M,P,N,L,K;var I=0;J=D(J);while(I<J.length){Q=J.charCodeAt(I++);O=J.charCodeAt(I++);M=J.charCodeAt(I++);P=Q>>2;N=((Q&3)<<4)|(O>>4);L=((O&15)<<2)|(M>>6);K=M&63;if(isNaN(O)){L=K=64;}else{if(isNaN(M)){K=64;}}H+=A.charAt(P)+A.charAt(N)+A.charAt(L)+A.charAt(K);}return H;},decode:function C(J){var H="",I=0;var Q,O,M,P,N,L,K;J=J.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(I<J.length){P=A.indexOf(J.charAt(I++));N=A.indexOf(J.charAt(I++));L=A.indexOf(J.charAt(I++));K=A.indexOf(J.charAt(I++));Q=(P<<2)|(N>>4);O=((N&15)<<4)|(L>>2);M=((L&3)<<6)|K;H+=G(Q);if(L!==64){H+=G(O);}if(K!==64){H+=G(M);}}H=F(H);return H;}});})();(function(){mstrmojo._IsSelectorTarget=mstrmojo.provide("mstrmojo._IsSelectorTarget",{_mixinName:"mstrmojo._IsSelectorTarget",setDirty:function A(C){var D=(C?"add":"remove")+"DirtyKey",B=this.parent;if(B&&B[D]){this.parent[D](this.k);}}});}());mstrmojo.vi.viz.EnumAxisNames={RESERVED:0,ROWS:1,COLUMNS:2,PAGES:3,CHAPTERS:4,ALL:5};(function(){mstrmojo.requiresDescs(9380,9381,9382,9383,9384,9385,9379,15106,15107,10639,10159,9705,9704);mstrmojo.DI.DIConstants=mstrmojo.provide("mstrmojo.DI.DIConstants",{invalidObjectNameChars:'\\"[]',invalidObjectNameCharsRegex:/[\\"\[\]]/,sourceItemLinkType:{dbList:0,oauthPara:1},setDefaultOAuthParamCMD:"MSTR_DEFAULT_OAUTH_PARAMS",actions:{none:0,importSource:1,editImport:2,transform:3,changeSheet:4,publish:5,changeMappings:6,refine:7,quickPreview:8,savePublish:9,getFlatPreview:10,refreshData:11,mergeCube:12},localStorageKey:{HGOSFileTypeTooltipPop:"HGOSFileTypeTooltipPop"},requestFlag:{mapping:1,preview:2,sourceInfo:4,refineSourceInfo:8,sheets:16,crb:32,transformations:64,transformedPreview:128,relationship:256,stateInfo:512,anyState:268435456,fullData:1024,refineInnerData:2048},formMappingFlag:{formMappingFlagReserved:0,formMappingFlagRemoveGeoRole:1,formMappingFlagRemoveTimeRole:2,formMappingFlagRemoveDeriveFlags:4},browseFlag:{reportBindingTable:1,dataPreview:4,publish:16,cubeConfig:68,reportLevelProperty:256},importBehaviorFlag:{reserved:0,newColumnsSilent:1,dataTypeSilent:2},saveAsFlags:{saveAsOverWrite:32,saveAsManaged:524288,saveAsDDA:33554432,saveAsInMemory:67108864,saveAsWithPrompts:4096,saveAsWithAnswers:4},connectLiveSupport:{connectLiveSupportUnknown:0,connectLiveSupportDDAOrInMemory:1,connectLiveSupportInMemoryOnly:2,connectLiveSupportDDAOnly:3},xdaType:{excel:272,text:288,refine:384,salesforce:337,querybuilder:352,ffsql:304,mdx:2,customFreeFormSQL:3,googleAnalytics:390,googleBigQuery:341,googleBigQueryFFSQL:342,googleBigQuerySingleTable:345,qbSingleTable:368,twitter:343,facebook:344,dataImport:256,projectsImport:400,sparkDataset:416,dataImportFileExcel:16|256,dataImportFileText:32|256,dataImportCustomSQL:48|256,dataImportTable:64|256,dataImportOAuth:80|256,dataImportBISource:144|256,dataImportOAuthSalesforce:1|336,dataImportOAuthGDocs:2|336,dataImportOAuthGDrive:2|336,dataImportOAuthDropbox:3|336,dataImportOAuthGAnalytics:4|336,dataImportOAuthGBigQuery:5|336,dataImportOAuthGBigQueryFFSQL:6|336,dataImportOAuthGBigQuerySingleTable:9|336,spark:160|256},fileTypes:[{n:"CSV/TXT",v:"CSV"},{n:"PARQUET",v:"PARQUET"},{n:"AVRO",v:"AVRO"},{n:"ORC",v:"ORC"},{n:"JSON",v:"JSON"},{n:"PARQ",v:"PARQUET",visible:false}],sourceInfoDesc:{json:"DB_FILE_TYPE_JSON"},sourceType:{file:1,salesforce:2,dropbox:3,googleDrive:4,googleAnalytics:5,googleBigQuery:6,querybuilder:7,mstrFile:8,mdx:9,hadoop:10,twitter:11,facebook:12,bisource:13,remoteProject:14,importfromcube:15,dataFromPushApi:16,newConnector:17,cloudElement:18},sourceSubtype:{localFile:1,url:2,salesforce:3,dropbox:4,googleDrive:5,googleAnalytics:6,googleBigQuery:7,querybuilder:8,samplefile:9,clipboard:10,googleBigQueryFFSQL:11,searchOnSource:12,mdx:13,hadoop:14,twitter:15,facebook:16,bisource:17,remoteProject:18,googleBigQuerySingleTable:19,hanaSingleTable:20,publicData:21,importfromcube:22,dataFromPushApi:23,cloudElement:24,},backendSourceSubtype:{localFile:65537,url:65539,samplefile:65540,clipboard:65538,newConnector:65544,cloudElement:65552,hadoopFileBrowser:65541,customSQL:131073,customSQLWizard:131074,singleTable:131075,bISources:131076,searchAsASource:131078,salesforce:196609,dropbox:196610,facebook:196611,twitter:196612,googleDrive:196613,googleAnalytics:196614,googleBigQuery:196615,googleBigQueryFFSQLModel:196616,googleBigQuerySingleTable:196617,OLAPSources:327681,publicData:65542,dataFromPushApi:65543,dataFromPushApiV2:65545,cloudElement:65552,},sourceItemType:{file:0,url:1,database:2,hadoop:3,olap:4,publicData:5,salesforce:6,googleAnalytics:7,googleBigQuery:8,googleDrive:9,dropbox:10,searchAsASource:11,clipboard:12,bISources:13,facebook:14,twitter:15,samplefile:16,importFromCube:17,addNewConnector:18,newConnector:19,cloudElement:20,unknow:-1},columnState:{reserved:0,unchanged:1,newColumn:2,missing:4,changed:8},operationMode:{create:0,edit:1,refresh:2,subscribe:3,enterCredentials:4,oauth:5,pickTable:6,hadoopPickTable:7,ffsql:8,hadoopFFsql:9},statusCode:{obtainSource:-2147071874,xformsError:-2147071872,mappingError:-2147071871,edit:1,republish:2,schedule:3,enterCredentials:4,pickTable:5,hadoopPickTable:6,ffsql:7,hadoopFFsql:8},pageType:{intro:0,file:1,database:2,emmaPreview:3,redirect:4,analytics:5,dataSelection:6,suggestNewSource:7,sourceIntro:8,sourceObjects:10,sampleFiles:11,dataset:12,externalPage:13,preview:14,clipboard:15,refine:16,parse:17,mstrFile:18,allProjectSource:19,hadoop:20,twitter:21,facebook:22,sourceObjectsDnD:23,schedule:24,publicData:25,republish:26,sourceAdmin:27,importFromCube:28,addNewConnector:29,newConnector:30,addConnectorList:31,cloudElement:32},backendError:{overwriteObject:-2147212339,noPermission:-2147214579,invalidObjectName:-2147213715,unexpectedDataType:-2147212539,noExternalSession:-2147071844,noPrivilege:-2147212082,salesforceUnsavedReport:-2147212081,salesforceObsoleteReport:-2147212080,maxSizeExceeded:-2147212076,maxSizeExceededURL:-2147212121,salesforceUnresolvedFilter:-2147212074,incrementalRefresh:-2147212287,invalidUrl:-2147212062,fileVersionError:-2147212064,emptySheet:-2147212144,refreshTokenUnavailable:-2147202875,cubeQuotaExceeded:-2147071825,notEnoughSpace:-2147071811,importedURLInvalid:-2147212122,unsupportedFileFormat:-2147212063,objectNameTooLong:-2147217407,noExternalSourceInfo:-2147215346,memoryConsumptionExceeded:-2147215346,cubeQuotaReached:-2147071870,switchingFileType:-2147212140,memoryGovernSizeExceeded:-2147181051,stringTooLong:-2147213718,missingColumn:-2147071871,dataDiscoveryError:-2147211998,refineApplyError:-2147202299,serverOutOfMemory:-2147212055,columnCountMatchError:-2147467259,incompatibleDataTypeError:-2147211983,reportTimeout:-2147212335,requestTimeout:-2147206497,databaseCredentialsNotAvailable:-2147212037,ddasupportIncompatible:-2147215326,mergeInvalidXdatype:-2147215325,notFullyControl:-2147214579,shouldBeIgnored:-2147212123,CECredentialNotAvailable:-2147215317,AuthenticationError:-2147215346,queryEngineGeneralError:-2147212544},transformation:{xtab:1,delimiter:2},application:{platform:"Platform",cloudPersonal:"Personal",cloudProfessional:"Professional"},refreshOptions:{replace:1,append:2,update:4},cubeRefreshType:{dummy:-1,reserved:0,add:1,remove:2,update:3,upsert:4,addNewTable:5,deleteTable:6,replaceTable:7,preserve:8},tableStatsExecutionAction:{reserved:0,forceExecution:1,ignore:4,requireFreshData:268435456},sourcesInfoFlags:{none:0,getReports:1,getUserName:2,getTokensInfo:4,revokeSession:8,getGAnalyticsAccount:64},queryBuilderType:{individualTable:1,multipleTables:2,queryScript:3},relationshipEditType:{create:1,changeERType:2,remove:3,flip:8001},ERType:{reserved:0,ERType11:1,ERType1M:2,ERTypeM1:3,ERTypeMM:4,ERTypeParallel:5,ERTypePerpendicular:6},RSType:{reserved:0,auto:1,geo:2,defined:3},tableStates:{newly:1,old:2},behaviorChangeFlag:{multiSheet:4,remapping:8,refreshData:16},menuItems:{SEPARATOR:-1,NONE:0,TABLE_RENAME:1,DO_NOT_IMPORT:2,FLIP_ORDER:3,DELETE:4,RELATIONSHIP_TYPE:5,ONE_TO_ONE:6,ONE_TO_MANY:7,MANY_TO_ONE:8,MANY_TO_MANY:9,REMOVE:10,REFRESH_DATA:11,REFINE:12,CANCEL_REFINE:13,UNLINK:14,CHANGE_DATA_TYPE:15,MARK_GEO_ROLES:16,CREATE_TIME_ATTRIBUTES:17,TO_METRIC:18,TO_ATTRIBUTE:19,MAP_TO_PROJECT_ATTRIBUTE:20,UNMAP:21,MODIFY_ATTRIBUTE_GROUP:22,CREATE_ATTRIBUTE_GROUP:23,HIDE_ALL_ATTRIBUTE_FORMS:24,DEFINE_RELATIONSHIPS:25,LINK:26,ITEM_RENAME:27,CREATE_MULTIFORM_ATTRIBUTE:28,EDIT_MULTIFORM_ATTRIBUTE:29,ADDTO_MULTIFORM_ATTRIBUTE:30,SHOW_ALL_ATTRIBUTE_FORMS:31,SHOW_ALL_COLUMNS:32,PARTITION:33,REFINE_RENAME:34,REFINE_DELETE:35,REFINE_DELETE_ALL:36,REFINE_RESET:37,REFINE_RESET_ALL:38,PARSE:39,IMPORT:40,UNLINK_ALL:41,CREATE_HIERARCHY_ATTRIBUTE:42,EDIT_HIERARCHY_ATTRIBUTE:43,RESET_HIERARCHY_ATTRIBUTE:44},dataTypeMenuItems:{DATE_TIME:"1",NUMBER:"2",TEXT:"3",URL:"5",EMAIL:"6",HTML_TAG:"7",DATE:"8",TIME:"9",SYMBOL:"10",BIG_DECIMAL:"11",PHONE_NUMBER:"12"},columnDataTypes:{reserved:0,integer:1,unsigned:2,numeric:3,decimal:4,real:5,dtdouble:6,dtfloat:7,dtchar:8,varChar:9,longVarChar:10,binary:11,varBin:12,longVarBin:13,date:14,dttime:15,timeStamp:16,nChar:17,nVarChar:18,nlong:22,bigDecimal:30,cellFormatData:31,utf8Char:33,int64:34},formsOptions:{CREATE_MULTIFORM_ATTRIBUTE:1,EDIT_MULTIFORM_ATTRIBUTE:2,ADDTO_MULTIFORM_ATTRIBUTE:3},hierarchyOptions:{CREATE_HIERARCHY_ATTRIBUTE:1,EDIT_HIERARCHY_ATTRIBUTE:2,RESET_HIERARCHY_ATTRIBUTE:3},rdcsFlag:{ID:1,JOIN_ID:2,FILTER_ID:3,DISTANCE:4},timeRoles:{NONE:0,DATE:1,DATE_TIME:2,TIME:3,SECOND:4,MINUTE:5,HOUR:6,DAY:7,WEEK:8,MONTH:9,QUARTER:10,YEAR:11},contextMenuType:{ITEM_MENU:0,TABLE_MENU:1,PREVIEW_ITEM_MENU:2,LINK_MENU:3},dialogType:{fixRefreshErrorDialog:1,allObjectsViewDialog:2,missingColumnsDialog:3,diPageDialog:4,refreshHistoryDialog:5,alternateSourceValidateDialog:6,ddaConfirmDialog:7,publishStatusDialog:8,saveAsDialog:9,cubesList:10,refinePage:11,multiFormEditor:12,sheetsSelectionDialog:13,partitionGroupDialog:14,parseDataDialog:15,errorDialog:16,warningDialog:17,relationDefineDialog:18,qbImportOptionDialog:19,previewRenameDialog:20,mapProjectsAttributeDialog:21,setOAuthParaDialog:22,objectPicker:23,refineClusteringPage:24,refineExtractDialog:25,refineImportDialog:26,twitterAdvOptDialog:27,credentialsDialog:28,mapProjectsAttributeDialog2:29,setWhiteListDialog:30,binaryUploadDialog:31,authenticationDialog:32,sharingDialog:33,hadoopGatewayManagerDialog:34,hadoopGatewayDialog:35,addConnectorDialog:36,hierarchyAttributeDialog:37,hierarchyAttributeResetDialog:38},dataEvents:{DATA_PREVIEW_EVENT:"dataReturned",NO_DATA_RETURNED_EVENT:"noDataReturned"},cubeSchedStatus:{unexecuted:1,successful:2,unscheduled:3,failed:4},privilegeType:{accessDatabase:1,accessFile:2,accessCloud:3},dbType:{MS_ACCESS:100,ORACLE:200,SQL_SERVER:300,INFORMIX:400,SYBASE:500,REDBRICK:600,DB2:700,TANDEM:800,TERADATA:900,UNKNOWN:1000,GENERIC:1100,SAP:1200,NETEZZA:1300,EXCEL:1400,MSFT_AS:1500,ESSBASE:1600,MYSQL:1700,POSTGRESQL:1800,HPNEOVIEW:1900,METAMATRIX:2000,DATALLEGRO:2100,COMPOSITE:2200,ASTER:2300,VERTICA:2400,OPENACCESS:2500,SYBASE_SQL_ANY:2600,SYBASE_IQ:2700,PARACCEL:2800,TM1:2900,XQUERY:3000,HIVE:3100,SAND:3200,SALESFORCE:3300,HIVETHRIFT:3400,VECTORWISE:3500,ENTERPRISEDB:3600,KOGNITIOWX2:3700,EXASOLUTION:3800,INFORMATICA:3900,SAPHANA:4000,IMPALA:4100,AMAZON_REDSHIFT:4200,DENODO:4300,GOOGLE_DRIVE:4400,DROPBOX:4500,GOOGLE_ANALYTICS:4600,GOOGLE_BIGQUERY:4700,CONNECTION_CLOUD:4800,GOOGLE_BIG_QUERY_FFSQL_MODEL:4900,PARSTREAM:5100,MONGODB:5200,MARKLOGIC:5300,BIG_DATA_ENGINE:5400,SEARCH_ENGINE_SOLR:5500,SPLUNK:5600,TWITTER:5700,FACEBOOK:5800,PIG:6400,URL:7700,newConnector:7900,LOACLFILE:8200},getCubeQuotaAndInfosOptions:{GetCubeQuotaAndInfosReserved:0,GetCubeQuotaAndInfosDefault:1,GetCubeQuotaAndInfosQuotaOnly:2,GetCubeQuotaAndInfosAll:3,GetCubeQuotaAndInfosVI:4},homepageViewMode:{GRID_VIEW:0,LIST_VIEW:1},datasetServeMode:{inMemory:1,dda:2,unknow:3},cubePollStatus:{msgID:0,result:1,prompt:2,error:3,xmlResult:21},ibmDb2Versions:[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232],hadoopDbTypes:[3100,1100,700,4100,7300,6800,6400,8100],formCategory:{longitude:"2345134F4F5E261C3BB902A874467080",latitude:"B191051C48221A6AE44CA2B65B1B65E3"},urlAuthDBRoles:{anonymous:"CB1CB472A07E41D5AE038232839F2064",windows:"95A5ACC02FE94CBABCB65E4F2D2415B2",kerberos:"317D6F016D784836A724AD4D739E1E9C",integrated:"E966E1A0A4C949108287B2E5086B68EB"},urlAuthDBMSId:"497F2406FA154B86810C71EA3D401D6D",newConnectorDBMSId:"565D5DC3A1124726B85FE53EF992472A",hadoopGateWay:{HGoS_CONFIG_HAS_EXIT:1510,CONNOT_AUTHENTICATE:1511,SPACE_OVER:1512,FAIL_COPY_TO_HOST:1513,INSUFFICIENT:1514,DIRECTORY_NO_EXIST:1515,HGOS_DEPLOYED:1518,HGOS_DEPLOYING:1519,CONNOT_AUTHENTICATE2:1520,HGOS_RUNNING:1521,HGOS_STOPPED:1522,HGOS_NOT_DEPLOYING:1523,HGOST_TAR_NOT_EXIST:1524,HGOS_CONF_NOT_EXIST:1530},workstation:{filerBreakLine:new RegExp("[\r\n]","g"),utils:{shouldShowTitleBar:function(){var A=mstrApp.getRootController().rootView.inPageDialog;return !!mstrApp.isWorkstation&&(!!mstrApp.isPopup||!!A);},setNativeWindow:function(C,F){var B=1110,E=590,D=parseInt(C,10),A=parseInt(F,10);if(!window.FormWrapper||!window.FormWrapper.setWindowFrame){return ;}if(C.match(/%$/)&&F.match(/%$/)){window.FormWrapper.setWindowContentSize(1200,680);}else{D=D<B?B:D;A=A<E?E:A;window.FormWrapper.setWindowContentSize(D,A);}},lockResize:function(){if(!window.FormWrapper||!window.FormWrapper.lockResize){return ;}window.FormWrapper.lockResize();},unlockResize:function(){if(!window.FormWrapper||!window.FormWrapper.unlockResize){return ;}window.FormWrapper.unlockResize();}}},authMode:{ANONYMOUS:0,USERNAME:1,OAUTH:2},authModePrefix:{ANONYMOUS:"AuthMode=Anonymous;URL=",USERNAME:"AuthMode=Basic;URL=",OAUTH:"AuthMode=OAuth;URL="},sdkUrl:{MARKPLACE_URL:"https://community.microstrategy.com/s/gallery?tabset-89baf=202df",QUICK_START_URL:"https://lw.microstrategy.com/msdz/MSDL/GARelease_Current/docs/projects/DataConnectorSDK/Content/topics/Quick_Start_Guide.htm"},originalConnector:{elastic:"DE4A8E15405A36D80BF1E1A2BA6F9B66",tapClicks:"1E8ADD3975DA4609B8D00E6211ACAB6A"},googleAnalyticsUrl:{queryExplorer:"https://ga-dev-tools.appspot.com/query-explorer/"},weekDay:[{n:mstrmojo.desc(9380,"Monday"),v:0},{n:mstrmojo.desc(9381,"Tuesday"),v:1},{n:mstrmojo.desc(9382,"Wednesday"),v:2},{n:mstrmojo.desc(9383,"Thursday"),v:3},{n:mstrmojo.desc(9384,"Friday"),v:4},{n:mstrmojo.desc(9385,"Saturday"),v:5},{n:mstrmojo.desc(9379,"Sunday"),v:6}],dateMon:[{n:mstrmojo.desc(15106,"1st day"),v:"1"},{n:mstrmojo.desc(15107,"15th day"),v:"15"}],timeOfDay:[{n:"12:00AM",v:"12:00AM"},{n:"1:00AM",v:"1:00AM"},{n:"2:00AM",v:"2:00AM"},{n:"3:00AM",v:"3:00AM"},{n:"4:00AM",v:"4:00AM"},{n:"5:00AM",v:"5:00AM"},{n:"6:00AM",v:"6:00AM"},{n:"7:00AM",v:"7:00AM"},{n:"8:00AM",v:"8:00AM"},{n:"9:00AM",v:"9:00AM"},{n:"10:00AM",v:"10:00AM"},{n:"11:00AM",v:"11:00AM"},{n:"12:00PM",v:"12:00PM"},{n:"1:00PM",v:"1:00PM"},{n:"2:00PM",v:"2:00PM"},{n:"3:00PM",v:"3:00PM"},{n:"4:00PM",v:"4:00PM"},{n:"5:00PM",v:"5:00PM"},{n:"6:00PM",v:"6:00PM"},{n:"7:00PM",v:"7:00PM"},{n:"8:00PM",v:"8:00PM"},{n:"9:00PM",v:"9:00PM"},{n:"10:00PM",v:"10:00PM"},{n:"11:00PM",v:"11:00PM"}],schedule:{DAILY:"Daily",WEEKDAY:"Weekday",WEEKLY:"Weekly",MONTHLY:"Monthly"},mainPage:{GRID_MODE:0,LIST_MODE:1},sourceIconClsName:{0:"ds-Generic",1:"ds-DB2",2:"ds-DB2",3:"ds-DB2",4:"ds-InformixWire",5:"ds-InformixXPS",6:"ds-PostgreSQL",7:"ds-SAP",8:"ds-SAP",9:"ds-Oracle",10:"ds-MicroSoft",11:"ds-Teradata",12:"ds-MySQL",13:"ds-GreenPlum",14:"ds-Netezza",15:"ds-WebServices",17:"ds-Infobright",18:"ds-Salesforce",19:"ds-MicroSoft",20:"ds-Actian-n",21:"ds-Amazon-Redshift",22:"ds-Impala",23:"ds-Aster",25:"ds-Actian-n",26:"ds-EnterpriseDB",27:"ds-Vertica",28:"ds-Denodo",29:"ds-CiscoDataVirtualization",31:"ds-MicroSoft",32:"ds-GoogleBigQuery",33:"ds-SAP",35:"ds-IBMBigInsights",39:"ds-TM1",41:"ds-WebServices",43:"ds-Amazon-EMR",44:"ds-Apache-Hive",45:"ds-ClouderaHive",46:"ds-HortonworksHive",47:"ds-MapRHive",48:"ds-apache",49:"ds-SharkSpark",50:"ds-MongoDB",52:"ds-MariaDB",51:"ds-MarkLogic",54:"ds-Splunk",55:"ds-DataDirectCloud",56:"ds-ParStream",58:"ds-Phoenix",59:"ds-MicroSoft",60:"ds-DB2",61:"ds-Oracle",62:"ds-Teradata",63:"ds-SAP",65:"ds-PostgreSQL",66:"ds-MySQL",67:"ds-MariaDB",68:"ds-Amazon-EMR",69:"ds-Apache-Hive",70:"ds-ClouderaHive",71:"ds-HortonworksHive",72:"ds-MapRHive",73:"ds-SharkSpark",75:"ds-Amazon-Redshift",76:"ds-PIVOTALHAWQ",77:"ds-MemSQL",78:"ds-Arcadia-Platform",79:"ds-Altibase",80:"ds-MongoDB",81:"ds-Presto",82:"ds-DB2",83:"ds-DB2",84:"ds-InformixWire",85:"ds-SAP",86:"ds-MicroSoft",87:"ds-MicroSoft",88:"ds-MemSQL",90:"ds-GreenPlum",91:"ds-PIVOTALHAWQ",92:"ds-Netezza",93:"ds-Infobright",94:"ds-Actian-n",95:"ds-Impala",96:"ds-IBMBigInsights",97:"ds-Aster",99:"ds-Actian-n",100:"ds-EnterpriseDB",101:"ds-Vertica",102:"ds-Denodo",103:"ds-CiscoDataVirtualization",105:"ds-DataDirectCloud",106:"ds-ParStream",107:"ds-Arcadia-Platform",109:"ds-Presto",110:"ds-Phoenix",111:"ds-Kognitio",112:"ds-Kognitio",113:"ds-Informatica",114:"ds-Informatica",115:"ds-Apache-Cassandra-JDBC",116:"ds-SAP",117:"ds-Actian",118:"ds-Actian",119:"ds-InformixXPS",120:"ds-Apache-Cassandra-JDBC",121:"ds-MapRDrill",122:"ds-Cirro",123:"ds-EXASolution",124:"ds-EXASolution",125:"ds-Oracle",126:"ds-Oracle",127:"ds-Snowflake",128:"ds-Snowflake",129:"ds-Amazon-Aurora",130:"ds-Amazon-Aurora",131:"ds-Amazon-Athena",132:"ds-Amazon-Athena",133:"ds-MapRDrill",134:"ds-Druid",135:"ds-Druid",139:"ds-MongoBI",157:"ds-GoogleBigQuery",161:"ds-MapD",168:"ds-HortonworksSpark",169:"ds-HortonworksSpark",170:"ds-Yellowbrick",},dispTag:{1:"Database",2:"OLAP",4:"BigData",8:"Database",16:"BigData",32:"BigData"},searchTags:{100:["Database","ODBC"],200:["Database","ODBC"],300:["Database","ODBC"],400:["Database","ODBC"],500:["Database","ODBC"],600:["Database","ODBC"],700:["Database","ODBC"],900:["Database","ODBC"],1100:["Database","ODBC"],1200:["OLAP","Cube"],1300:["Database","ODBC"],1400:["Database"],1500:["OLAP","Cube"],1600:["OLAP","Cube"],1700:["Database","ODBC"],1800:["Database","ODBC"],2200:["Database","ODBC"],2300:["Database","ODBC"],2400:["Database","ODBC"],2800:["Database","ODBC"],2900:["OLAP","Cube"],3000:["Database"],3100:["Database","BigData","Hadoop"],3300:["Cloud"],3500:["Database","ODBC"],3600:["Database","ODBC","BigData"],3800:["Database"],3900:["Database"],4000:["Database","ODBC"],4100:["Database","BigData","Hadoop"],4200:["Database","ODBC"],4300:["Database","ODBC"],4700:["Database","Cloud","BigData"],4800:["Cloud"],5200:["Database","NoSQL"],5300:["Database","NoSQL"],5400:["Hadoop"],6400:["Database","BigData","Hadoop"],6600:["Database"],6700:["Database"],6800:["BigData"],6900:["BigData"],7100:["NoSQL"],7200:["Database"],7300:["BigData","Hadoop"],7500:["Database"],7600:["Database"],8000:["Database"],8100:["BigData"],},srcItemTypes:{ALL_SOURCES:"ALL_SOURCES",STATIC_SOURCE:"STATIC_SOURCE",DBTYPE_SOURCE:"DBTYPE_SOURCE",CUSTOM_CONNECTOR:"CUSTOM_CONNECTOR",CLOUDELEMENT_CONNECTOR:"CLOUDELEMENT_CONNECTOR"},combination:{BigData:["BigData","NoSQL","Search","Hadoop"],Apps:["Apps","oAuth","Cloud","Social","BI","PublicData","CE"]},GenericDBStr:"Generic",dataSourceType:{MONGODB:"mongodb",FILE_URL:"fileUrl",FILE_LOCAL:"fileLocal",ES:"elasticsearch",DROPBOX:"dropbox",GOOGLE_DRIVE:"googleDrive",GOOGLE_ANALYTICS:"googleAnalytics",GOOGLE_BIGQUERY:"googleBigQuery",SALESFORCE:"salesforce",FILE:"file",GENERIC_JDBC:"genericJdbc"},ERDF:{ENUM_LOAD_REPORT_BROWSE_TYPE_BINDINGTABLE:1,ENUM_LOAD_REPORT_BROWSE_TYPE_DATAPREVIEW:4,ENUM_LOAD_REPORT_BINDING_FLAG_ALL:15,ENUM_LOAD_REPORT_PREVIEW_FLAG_MappingInfo:1,ENUM_LOAD_REPORT_PREVIEW_FLAG_DataInfo:2,ENUM_LOAD_REPORT_PREVIEW_FLAG_SourceInfo:4,ENUM_LOAD_REPORT_PREVIEW_FLAG_InnerDataInfo:2048,},DSSSubType:{DSSSUBTYPEATTRIBUTE:3072,DSSSUBTYPEATTRIBUTEROLE:3073,DSSSUBTYPEATTRIBUTETRANSFORMATION:3074,DSSSUBTYPEATTRIBUTEABSTRACT:3075,DSSSUBTYPEATTRIBUTERECURSIVE:3076},DSSExType:{DSSEXDISPARK:416},URLMode:{NormalUrl:0,NewConnector:1,NewConnectorEdit:2,CloudElement:3},disableFeatures:{DISABLE_CUSTOM_CONNECTOR:"disableCustomerConnector",DISABLE_DDA:"disableDDA",DISABLE_QUOTA:"disableQuota",DISABLE_HADOOP:"disableHadoop",DISABLE_BI_TOOLS:"disableBITools",DISABLE_CLIP_BOARD:"disableClipboard",DISABLE_FACE_BOOK:"disableFacebook",DISABLE_TWITTER:"disableTwitter",DISABLE_SAMPLE_FILES:"disableSampleFiles",DISABLE_PUBLIC_DATA:"disablePublicData",DISABLE_MERGE_CUBE:"disableMergeCube",DISABLE_CE_SOURCE:"disableCESource",DISABLE_FLATTERN_DB_SOURCE:"disabledSources"},DssXmlPrivileges:{DssXmlPrivilegesUseDatabaseInstanceManager:57},Enum_SourceCategoryType:{File:1,BigData:2,Database:3,OLAP:4,Customized:5,Apps:6,}});}());(function(){mstrmojo._HasPopup=mstrmojo.provide("mstrmojo._HasPopup",{_mixinName:"mstrmojo._HasPopup",_lastOpened:null,openPopup:function A(G,E){var C=!!G&&(typeof G==="string")&&!G.match(/\./)&&!!this[G],D=mstrmojo.registry.ref(C?this[G]:G);if(D&&D.open){if(C){this[G]=D;}if(D.disposable!==false){this.addDisposable(D);}var J=D.slot&&this[D.slot];if(J){if(D.parent!==this){if(this.addChildren){this.addChildren([D]);}else{var I=false,F=D.domNode||D.placeholder;if(F&&typeof F==="string"){F=document.getElementById(F);}if(!F){I=true;F=document.createElement("span");D.placeholder=F;}if(I||(F.parentNode!==J)){J.appendChild(F);}}}}try{D.open(this,E);}catch(H){console.log("Error opening popup: "+H);}this._lastOpened=D;}},closePopup:function B(){var C=this._lastOpened;if(C&&C.visible&&C.close){C.close();delete this._lastOpened;}}});}());mstrmojo.mapbox.MapboxEnums={};mstrmojo.mapbox.ID_SUFFIX={Source:"-source",Hover:"-hover",Selection:"-selection",Unselected:"-unselected",ContextMenu:"-contextmenu",SelectionContextMenu:"-selection-contextmenu",Cluster:"-clusters",DataLabel:"-datalabel",Border:"-border"};mstrmojo.mapbox.FILTER={SINGLE:["!has","point_count"],CLUSTER:["has","point_count"],NOFEATURE:["==","id",""],NOCLUSTER:["==","cluster_id",""]};mstrmojo.mapbox.DEFAULT_DATA_LABEL_PROPS_MAPBOX={dlShw:[0],dlShwAll:[false],dlFntFml:["Arial Unicode"],dlFntSz:["10pt"],dlFntStyle:[0],dlFntClr:[0],dlFntHaloClr:["white"]};mstrmojo.mapbox.EXCLUDED_FONT_FAMILIES=["Batang","Bookshelf Symbol 1","Bookshelf Symbol 2","Bookshelf Symbol 3","Map Symbols","Marlett","Monotype Sorts","MS Outlook","MT Extra","Symbol","Webdings","Wingdings","Wingdings 2","Wingdings 3"];mstrmojo.mapbox.FONT_FAMILIES_MAPPING={Arial:{normal:"Arial WGL Regular",bold:"Arial WGL Bold",italic:"Arial WGL Italic",bolditalic:"Arial WGL Bold Italic"},ArialBlack:{normal:"Arial Black Regular",italic:"Arial Black Italic"},ArialNarrow:{normal:"Arial Narrow MT Pro Regular",bold:"Arial Narrow MT Std Bold",italic:"Arial Narrow MT Std Italic",bolditalic:"Arial Narrow MT Std Bold Italic"},ArialUnicodeMS:{normal:"Arial Unicode MS Regular",bold:"Arial Unicode MS Bold",italic:"Arial Unicode MS Italic",bolditalic:"Arial Unicode MS Bold Italic"},Batang:{normal:"Batang Regular"},BookAntiqua:{normal:"Book Antiqua Regular",bold:"Book Antiqua Bold",italic:"Book Antiqua Italic",bolditalic:"Book Antiqua Bold Italic"},BookmanOldStyle:{normal:"Bookman Old Style Regular",bold:"Bookman Old Style Bold",italic:"Bookman Old Style Italic",bolditalic:"Bookman Old Style Bold Italic"},BookshelfSymbol1:{normal:"Bookshelf Symbol 1 Regular"},BookshelfSymbol2:{normal:"Bookshelf Symbol 2 Regular"},BookshelfSymbol3:{normal:"Bookshelf Symbol 3 Regular"},ComicSansMS:{normal:"Comic Sans MS Regular",bold:"Comic Sans MS Bold",italic:"Comic Sans MS Italic",bolditalic:"Comic Sans MS Bold Italic"},CourierNew:{normal:"Courier New Regular",bold:"Courier New Bold",italic:"Courier New Italic",bolditalic:"Courier New Bold Italic"},Garamond:{normal:"Garamond Regular",bold:"Garamond Bold",italic:"Garamond Italic",bolditalic:"Garamond MT Bold Italic"},Haettenschweiler:{normal:"Haettenschweiler Regular"},Helvetica:{normal:"Helvetica LT Pro Regular",bold:"Helvetica LT Pro Bold",italic:"Helvetica LT Pro Italic",bolditalic:"Helvetica LT Pro Bold Italic"},Impact:{normal:"Impact Regular"},LucidaConsole:{normal:"Lucida Console Regular"},LucidaSansUnicode:{normal:"Lucida Sans Unicode Regular"},MapSymbols:{normal:"Map Symbols Regular"},Marlett:{normal:"Marlett Regular"},MonotypeCorsiva:{normal:"Monotype Corsiva Regular"},MonotypeSorts:{normal:"Monotype Sorts Regular"},MSGothic:{normal:"MS Gothic Regular"},MSOutlook:{normal:"MS Outlook Regular"},MicrosoftSansSerif:{normal:"Microsoft Sans Serif Regular"},MTExtra:{normal:"MT Extra Regular"},OpenSans:{normal:"Open Sans Regular"},OpenSansSemiBold:{normal:"Open Sans SemiBold"},Symbol:{normal:"Symbol Regular"},Tahoma:{normal:"Tahoma Regular",bold:"Tahoma Bold",italic:"Tahoma Italic",bolditalic:"Tahoma Bold Italic"},TimesNewRoman:{normal:"Times New Roman MT Regular",bold:"Times New Roman MT Bold",italic:"Times New Roman MT Italic",bolditalic:"Times New Roman MT Bold Italic"},TrebuchetMS:{normal:"Trebuchet MS Regular",bold:"Trebuchet MS Bold",italic:"Trebuchet MS Italic",bolditalic:"Trebuchet MS Bold Italic"},Verdana:{normal:"Verdana Regular"},Webdings:{normal:"Webdings Regular"},Wingdings:{normal:"Wingdings Regular"},Wingdings2:{normal:"Wingdings 2 Regular"},Wingdings3:{normal:"Wingdings 3 Regular"}};mstrmojo.EnumDSSDisplayMode={RESERVED:0,GRID:1,GRAPH:2,ENGINE:3,TEXT:4,DATAMART:5,BASE:6,GRIDGRAPH:7,NONINTERACTIVE:8};(function(){mstrmojo.vi.ui.tabs.LayoutTabHelper=mstrmojo.provide("mstrmojo.vi.ui.tabs.LayoutTabHelper",{position:0,saveTabBarPosition:function B(C){var D=C.tabContainerNode;if(D){this.position=D.firstChild.offsetLeft;}},applyTabBarPosition:function A(D){var C=D.tabContainerNode;if(C){C.firstChild.style.left=this.position+"px";}}});}());mstrmojo.vi.viz.EnumVisualizationTemplates={UNKNOWN_GRAPHMATRIX_TYPE:-1,GRID:0,HEATMAP:1,GOOGLEMAP:2,PIE:3,RING:4,GRAPHMATRIXVERTICALBARSTACKED:6,GRAPHMATRIXVERTICALBARCLUSTERED:7,GRAPHMATRIXVERTICALBARPERCENT:8,GRAPHMATRIXHORIZONTALBARSTACKED:9,GRAPHMATRIXHORIZONTALBARCLUSTERED:10,GRAPHMATRIXHORIZONTALBARPERCENT:11,GRAPHMATRIXVERTICALLINESTACKED:12,GRAPHMATRIXVERTICALLINECLUSTERED:13,GRAPHMATRIXVERTICALLINEPERCENT:14,GRAPHMATRIXHORIZONTALLINESTACKED:15,GRAPHMATRIXHORIZONTALLINECLUSTERED:16,GRAPHMATRIXHORIZONTALLINEPERCENT:17,GRAPHMATRIXSCATTERCIRCLEMM:18,GRAPHMATRIXSCATTERGRIDCIRCLEAA:19,GRAPHMATRIXBUBBLECIRCLEMM:21,GRAPHMATRIXBUBBLEGRIDCIRCLEAA:22,GRAPHMATRIXSCATTERSQUAREAM:23,GRAPHMATRIXSCATTERSQUAREMM:24,GRAPHMATRIXSCATTERGRIDSQUAREAA:25,GRAPHMATRIXBUBBLESQUAREAM:26,GRAPHMATRIXBUBBLESQUAREMM:27,GRAPHMATRIXBUBBLEGRIDSQUAREAA:28,GRAPHHORIZONTALBARCLUSTERED:29,GRAPHMATRIXVERTICALAREASTACKED:30,GRAPHMATRIXVERTICALAREAPERCENT:31,GRAPHMATRIXVERTICALAREACLUSTERED:32,GRAPHMATRIXHORIZONTALAREASTACKED:40,GRAPHMATRIXHORIZONTALAREAPERCENT:41,GRAPHMATRIXHORIZONTALAREACLUSTERED:42,GRAPHHORIZONTALBARDUALAXISCLUSTERED:33,GRAPHHORIZONTALBARDUALAXISABSOLUTE:34,GRAPHHORIZONTALLINEABSOLUTE:35,GRAPHHORIZONTALLINEDUALAXISABSOLUTE:36,GRAPHHORIZONTALAREAABSOLUTE:37,GRAPHHORIZONTALAREADUALAXISABSOLUTE:38,GRAPHVERTICALBARCLUSTERED:39,GRAPHVERTICALBARDUALAXISCLUSTERED:43,GRAPHVERTICALBARDUALAXISABSOLUTE:44,GRAPHVERTICALBARDUALAXISSTACKED:45,GRAPHVERTICALLINEABSOLUTE:46,GRAPHVERTICALLINESTACKED:47,GRAPHVERTICALLINEPERCENT:48,GRAPHVERTICALLINEDUALAXISABSOLUTE:49,GRAPHVERTICALLINEDUALAXISSTACKED:50,GRAPHVERTICALAREAABSOLUTE:51,GRAPHVERTICALAREAPERCENT:52,GRAPHVERTICALAREASTACKED:53,GRAPHVERTICALAREADUALAXISABSOLUTE:54,GRAPHVERTICALAREADUALAXISSTACKED:55,GRAPHCOMBINATIONBARAREA:56,GRAPHCOMBINATIONBARAREADUALAXIS:57,NETWORK:58,IMAGELAYOUT:59,GOOGLEMAPDENSITY:60,GRAPHMATRIXPIE:61,GRAPHMATRIXRING:62,GRAPHHORIZONTALBARABSOLUTE:63,GRAPHHORIZONTALBARPERCENT:64,GRAPHHORIZONTALBARSTACKED:65,GRAPHVERTICALBARABSOLUTE:66,GRAPHVERTICALBARPERCENT:67,GRAPHVERTICALBARSTACKED:68,ESRIMAP:69,GRAPHMATRIXVERTICALBARAUTOMATIC:70,GRAPHMATRIXHORIZONTALBARAUTOMATIC:71,GRAPHMATRIXVERTICALLINEAUTOMATIC:72,GRAPHMATRIXHORIZONTALLINEAUTOMATIC:73,GRAPHMATRIXVERTICALAREAAUTOMATIC:74,GRAPHMATRIXHORIZONTALAREAAUTOMATIC:75,GRAPHMATRIXVERTICALHISTOGRAM:76,GRAPHMATRIXGRIDCHART:78,GRAPHMATRIXVERTICALBOXPLOT:79,GRAPHMATRIXHORIZONTALBOXPLOT:80,GRAPHMATRIXVERTICALWATERFALL:81,GRAPHMATRIXHORIZONTALWATERFALL:82,KPICARD:83};var T=mstrmojo.vi.viz.EnumVisualizationTemplates;mstrmojo.vi.viz.EnumAggregatedVisTemplates={COMBOCHART:[T.GRAPHHORIZONTALBARDUALAXISCLUSTERED,T.GRAPHHORIZONTALBARDUALAXISABSOLUTE,T.GRAPHHORIZONTALLINEDUALAXISABSOLUTE,T.GRAPHHORIZONTALAREADUALAXISABSOLUTE,T.GRAPHVERTICALBARDUALAXISCLUSTERED,T.GRAPHVERTICALBARDUALAXISABSOLUTE,T.GRAPHVERTICALBARDUALAXISSTACKED,T.GRAPHVERTICALLINEDUALAXISABSOLUTE,T.GRAPHVERTICALLINEDUALAXISSTACKED,T.GRAPHVERTICALAREADUALAXISABSOLUTE,T.GRAPHVERTICALAREADUALAXISSTACKED,T.GRAPHCOMBINATIONBARAREADUALAXIS,T.GRAPHCOMBINATIONBARAREA],BUBBLECHART:[T.GRAPHMATRIXSCATTERCIRCLEMM,T.GRAPHMATRIXSCATTERGRIDCIRCLEAA,T.GRAPHMATRIXBUBBLECIRCLEMM,T.GRAPHMATRIXBUBBLEGRIDCIRCLEAA,T.GRAPHMATRIXSCATTERSQUAREAM,T.GRAPHMATRIXSCATTERSQUAREMM,T.GRAPHMATRIXSCATTERGRIDSQUAREAA,T.GRAPHMATRIXBUBBLESQUAREAM,T.GRAPHMATRIXBUBBLESQUAREMM,T.GRAPHMATRIXBUBBLEGRIDSQUAREAA],BARCHART:[T.GRAPHMATRIXVERTICALBARSTACKED,T.GRAPHMATRIXVERTICALBARCLUSTERED,T.GRAPHMATRIXVERTICALBARPERCENT,T.GRAPHMATRIXHORIZONTALBARSTACKED,T.GRAPHMATRIXHORIZONTALBARCLUSTERED,T.GRAPHMATRIXHORIZONTALBARPERCENT,T.GRAPHHORIZONTALBARCLUSTERED,T.GRAPHVERTICALBARCLUSTERED,T.GRAPHHORIZONTALBARABSOLUTE,T.GRAPHHORIZONTALBARPERCENT,T.GRAPHHORIZONTALBARSTACKED,T.GRAPHVERTICALBARABSOLUTE,T.GRAPHVERTICALBARPERCENT,T.GRAPHVERTICALBARSTACKED,T.GRAPHMATRIXVERTICALBARAUTOMATIC,T.GRAPHMATRIXHORIZONTALBARAUTOMATIC],LINECHART:[T.GRAPHMATRIXVERTICALLINESTACKED,T.GRAPHMATRIXVERTICALLINECLUSTERED,T.GRAPHMATRIXVERTICALLINEPERCENT,T.GRAPHMATRIXHORIZONTALLINESTACKED,T.GRAPHMATRIXHORIZONTALLINECLUSTERED,T.GRAPHMATRIXHORIZONTALLINEPERCENT,T.GRAPHHORIZONTALLINEABSOLUTE,T.GRAPHVERTICALLINEABSOLUTE,T.GRAPHVERTICALLINESTACKED,T.GRAPHVERTICALLINEPERCENT,T.GRAPHMATRIXVERTICALLINEAUTOMATIC,T.GRAPHMATRIXHORIZONTALLINEAUTOMATIC],PIECHART:[T.PIE,T.RING,T.GRAPHMATRIXPIE,T.GRAPHMATRIXRING],AREACHART:[T.GRAPHMATRIXVERTICALAREASTACKED,T.GRAPHMATRIXVERTICALAREAPERCENT,T.GRAPHMATRIXVERTICALAREACLUSTERED,T.GRAPHMATRIXHORIZONTALAREASTACKED,T.GRAPHMATRIXHORIZONTALAREAPERCENT,T.GRAPHMATRIXHORIZONTALAREACLUSTERED,T.GRAPHHORIZONTALAREAABSOLUTE,T.GRAPHVERTICALAREAABSOLUTE,T.GRAPHVERTICALAREAPERCENT,T.GRAPHVERTICALAREASTACKED,T.GRAPHMATRIXVERTICALAREAAUTOMATIC,T.GRAPHMATRIXHORIZONTALAREAAUTOMATIC],HISTOGRAM:[T.GRAPHMATRIXVERTICALHISTOGRAM,],BOXPLOT:[T.GRAPHMATRIXVERTICALBOXPLOT,T.GRAPHMATRIXHORIZONTALBOXPLOT],WATERFALL:[T.GRAPHMATRIXVERTICALWATERFALL,T.GRAPHMATRIXHORIZONTALWATERFALL]};(function(){function Q(V,R,S){if(V.nodeType===3&&R){return V;}else{var U=(R&&V.nodeType===1&&V.lastChild)?V.lastChild:F(V,S);return U?D(U,S):null;}}function F(S,R){return(S===R)?null:(S.previousSibling||F(S.parentNode,R));}function D(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.lastChild){return D(S.lastChild);}else{return D(F(S,R));}}}function I(R){return R.textContent||R.nodeValue||R.innerText;}function M(V,R,S){if(V.nodeType===3&&R){return V;}else{var U=(R&&V.nodeType===1&&V.firstChild)?V.firstChild:B(V,S);return U?E(U,S):null;}}function B(S,R){return(S===R)?null:(S.nextSibling||B(S.parentNode,R));}function E(S,R){if(S===R){return null;}if(S.nodeType===3&&I(S)){return S;}else{if(S.nodeType===1&&S.firstChild){return E(S.firstChild);}else{return E(B(S,R));}}}mstrmojo.range=mstrmojo.provide("mstrmojo.range",{EDGE:{EDGE_BEGIN:1,EDGE_END:2,EDGE_MIDDLE:-1},getEdgeInfo:function P(U,V){var R=0,S;if(U.nodeType===1){if(window.getSelection){S=document.createRange();S.selectNode(U);R=S.toString().length;}else{S=document.body.createTextRange();S.moveToElementText(U);R=S.text.length;}}else{R=I(U).length;}return V===R?this.EDGE.EDGE_END:(V===0?this.EDGE.EDGE_BEGIN:this.EDGE.EDGE_MIDDLE);},collapseOnNode:function K(V,S){if(!V.offsetParent){return ;}var U=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(V);R.collapse(S);U.removeAllRanges();U.addRange(R);}else{R.moveToElementText(V);R.collapse(S);R.select();}},collapseOnTextNode:function L(V,W){var U=this.getSelection(),S=this.getRange();if(window.getSelection){var R=M(V,true);S.setStart(R,W);S.collapse(true);U.removeAllRanges();U.addRange(S);}else{S.moveToElementText(V);S.collapse(true);S.move("character",W);S.select();}},collapseOnTextNodeIE:function C(S,U){var V=M(S,true),R;while(V!==null){R=I(V).length;if(R>=U){this.collapseOnTextNode(V,U);break;}else{U-=R;V=M(V,false);}}},getRangeInfo:function J(Y,f){var a=null,l,d=this.getRange(),c;if(Y&&Y===d.startContainer){var h=d.startContainer.firstChild,V=h&&h.firstChild,e=V&&V.firstChild;if(e){d.setStart(e,d.startOffset);d.setEnd(e,d.endOffset);}}if(window.getSelection){var X=function(n,p,o){var m=n.cloneRange();m.collapse(o);m.setStartBefore(p);return m.toString().length;},S=d.startContainer,g=d.startOffset;if(S.nodeType===1){g=X(d,S,true);}a={collapsed:d.collapsed,startContainer:S,startOffset:f?f.startOffset:g};if(!d.collapsed){var W=d.endContainer,R=d.endOffset;if(W.nodeType===1){R=X(d,W,false);}a.endContainer=W;a.endOffset=R;}a.range=d;}else{var k,b,Z=function(p,q){var o=p.duplicate(),m=document.body.createTextRange(),n;o.collapse(q);n=o.parentElement();m.moveToElementText(n);m.setEndPoint("EndToStart",o);return{container:n,offset:m.text.length};},j=Z(d,true),U;a={collapsed:(d.compareEndPoints("StartToEnd",d)===0),startContainer:j.container,startOffset:j.offset};if(!a.collapsed){U=Z(d,false);a.endContainer=U.container;a.endOffset=U.offset;}}return a;},collapse:function O(S){if(window.getSelection){var U=this.getSelection();if(S){U.collapseToStart();}else{U.collapseToEnd();}}else{var R=this.getRange();R.collapse(S);R.select();}},selectSingleNode:function H(U){var S=this.getSelection(),R=this.getRange();if(window.getSelection){R.selectNodeContents(U);S.removeAllRanges();S.addRange(R);}else{R.moveToElementText(U);R.select();}},selectMultipleNodes:function N(X,S,Y,V){var W=this.getSelection(),U=this.getRange();if(window.getSelection){U.setStart(X,S);U.setEnd(Y,V);W.removeAllRanges();W.addRange(U);}else{X=(X.nodeType===3)?X.parentNode:X;U.moveToElementText(X);U.move("character",S);Y=(Y.nodeType===3)?Y.parentNode:Y;var R=document.body.createTextRange();R.moveToElementText(Y);R.move("character",V);U.setEndPoint("EndToStart",R);U.select();}},getSelection:function G(){if(window.getSelection){return window.getSelection();}else{return document.selection;}},getRange:function A(){if(window.getSelection){selection=window.getSelection();if(selection.rangeCount>0){return selection.getRangeAt(0);}else{return document.createRange();}}else{return document.selection.createRange();}}});}());mstrmojo.chart.enums.EnumFontStyle={FS_NORMAL:0,FS_BOLD:1,FS_ITALIC:2,FS_BOTH:3,FS_UNDERLINE:4,FS_STRIKETHROUGH:8};(function(){mstrmojo.requiresDescs(5774,2266,2287,2496,2495,2493,2267,2498,2500,2279,2491,2476,2271,2478,2268,2492,2273,2280,2490,2488,2494,2487,2269,2477,2499,2292,2489,2281,2484,2483,2480,2497,2274,2485,2486,2282,2481,2479,2482,2290,2293);var A=[{n:mstrmojo.desc(5774,"No Fill"),id:"transparent"},{n:mstrmojo.desc(2266,"Black"),id:"#000000"},{n:mstrmojo.desc(2287,"Brown"),id:"#993300"},{n:mstrmojo.desc(2496,"Olive Green"),id:"#333300"},{n:mstrmojo.desc(2495,"Dark Green"),id:"#003300"},{n:mstrmojo.desc(2493,"Dark Teal"),id:"#003366"},{n:mstrmojo.desc(2267,"Dark Blue"),id:"#000080"},{n:mstrmojo.desc(2498,"Indigo"),id:"#333399"},{n:mstrmojo.desc(2500,"Grey-80%"),id:"#333333"},{n:mstrmojo.desc(2279,"Dark Red"),id:"#800000"},{n:mstrmojo.desc(2491,"Orange"),id:"#ff6600"},{n:mstrmojo.desc(2476,"Dark Yellow"),id:"#808000"},{n:mstrmojo.desc(2271,"Green"),id:"#008000"},{n:mstrmojo.desc(2478,"Teal"),id:"#008080"},{n:mstrmojo.desc(2268,"Blue"),id:"#0000ff"},{n:mstrmojo.desc(2492,"Blue-Grey"),id:"#666699"},{n:mstrmojo.desc(2273,"Grey-50%"),id:"#808080"},{n:mstrmojo.desc(2280,"Red"),id:"#ff0000"},{n:mstrmojo.desc(2490,"Light Orange"),id:"#ff9900"},{n:mstrmojo.desc(2488,"Lime"),id:"#99cc00"},{n:mstrmojo.desc(2494,"Sea Green"),id:"#339966"},{n:mstrmojo.desc(2487,"Aqua"),id:"#33cccc"},{n:mstrmojo.desc(2269,"Light Blue"),id:"#3366ff"},{n:mstrmojo.desc(2477,"Violet"),id:"#800080"},{n:mstrmojo.desc(2499,"Grey-40%"),id:"#969696"},{n:mstrmojo.desc(2292,"Pink"),id:"#ff00ff"},{n:mstrmojo.desc(2489,"Gold"),id:"#ffcc00"},{n:mstrmojo.desc(2281,"Yellow"),id:"#ffff00"},{n:mstrmojo.desc(2484,"Bright Green"),id:"#00ff00"},{n:mstrmojo.desc(2483,"Turquoise"),id:"#00ffff"},{n:mstrmojo.desc(2480,"Sky Blue"),id:"#00ccff"},{n:mstrmojo.desc(2497,"Plum"),id:"#993366"},{n:mstrmojo.desc(2274,"Grey-25%"),id:"#c0c0c0"},{n:mstrmojo.desc(2485,"Rose"),id:"#ff99cc"},{n:mstrmojo.desc(2486,"Tan"),id:"#ffcc99"},{n:mstrmojo.desc(2282,"Light Yellow"),id:"#ffff99"},{n:mstrmojo.desc(2481,"Light Green"),id:"#ccffcc"},{n:mstrmojo.desc(2479,"Light Turquoise"),id:"#ccffff"},{n:mstrmojo.desc(2482,"Pale Blue"),id:"#99ccff"},{n:mstrmojo.desc(2290,"Lavender"),id:"#cc99ff"},{n:mstrmojo.desc(2293,"White"),id:"#ffffff"}];var E=[];mstrmojo.util.ui.ColorPicker={getBasicColors:function B(){return A.slice();},getCustomColors:function D(){return E.slice();},addCustomColor:function C(G){var F=function(H){return H.id===G;};if(!A.filter(F)[0]&&!E.filter(F)[0]){E.push({n:G,id:G});if(E.length>8){E.shift();}}}};}());mstrmojo.mstr.EnumDSSXMLBaseFormType={DssXmlBaseFormReserved:0,DssXmlBaseFormHidden:-1,DssXmlBaseFormDateTime:1,DssXmlBaseFormNumber:2,DssXmlBaseFormText:3,DssXmlBaseFormPicture:4,DssXmlBaseFormUrl:5,DssXmlBaseFormEmail:6,DssXmlBaseFormHTMLTag:7,DssXmlBaseFormDate:8,DssXmlBaseFormTime:9,DssXmlBaseFormSymbol:10,DssXmlBaseFormBigDecimal:11,DssXmlBaseFormPhoneNumber:12};mstrmojo.mstr.EnumDSSXMLBaseFormType.convertDataType2BaseFormType=function(B){var A={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2};return A[B]||0;};(function(){mstrmojo.func=mstrmojo.provide("mstrmojo.func",{composite:function D(E){if(!E||!E.length){return mstrmojo.emptyFn;}return function(){var F=E.length,G;for(G=0;G<F;G++){E[G].apply(this,arguments);}};},wrapMethods:function C(J,H){function I(L,K){K=K||{};mstrmojo.hash.forEach(L,function(M,N){K[N]=(K.hasOwnProperty(N)&&typeof M==="function")?mstrmojo.func.composite([M,K[N]]):M;});return K;}if(arguments.length<3){return I(J,H);}var F=arguments.length,G=[].slice.call(arguments,0,F-1).reverse(),E=arguments[F-1];mstrmojo.array.forEach(G,function(K){E=I(K,E);});return E;},override:function A(G,E){var F=function(J,I){return function H(){var L=this._super,K;this._super=I||mstrmojo.emptyFn;try{K=J.apply(this,arguments||[]);}finally{this._super=L;}return K;};};E=E||{};mstrmojo.hash.forEach(G,function(H,I){E[I]=F(H,E[I]);});return E;},throttle:function(G,I,E){var F,K,N,L=null,J=0,M=E||{};var H=function(){J=M.leading===false?0:mstrmojo.date.now();L=null;N=G.apply(F,K);F=K=null;};return function(){var O=mstrmojo.date.now();if(!J&&M.leading===false){J=O;}var P=I-(O-J);F=this;K=arguments;if(P<=0){clearTimeout(L);L=null;J=O;N=G.apply(F,K);F=K=null;}else{if(!L&&M.trailing!==false){L=setTimeout(H,P);}}return N;};},debounce:function(H,J,G){var M,L,F,K,N,E=mstrmojo.date.now;var I=function(){var O=E()-K;if(O<J){M=setTimeout(I,J-O);}else{M=null;if(!G){N=H.apply(F,L);F=L=null;}}};return function(){F=this;L=arguments;K=E();var O=G&&!M;if(!M){M=setTimeout(I,J);}if(O){N=H.apply(F,L);F=L=null;}return N;};},addMethods:function B(F,E){E=E||{};mstrmojo.hash.forEach(F,function(G,H){if(!E.hasOwnProperty(H)&&typeof G==="function"){E[H]=G;}});return E;}});}());mstrmojo.kpicard.KPICardEnum={};mstrmojo.kpicard.KPI_PROPERTIES={SHOW_METRIC_NAME:"smn",AUTO_PLAY:"ap",DISPLAY_MODE:"dm",KPI_STYLE:"ks",FONT:"fts",NEW_FONT:"nfts",UNIFY_TEXT_SIZE:"uts",TEXT_SIZE_TYPE:"tst",UNIFY_STEPS:"us",PREVIOUS_METRIC_NAME:"pmn",BADGE_MODE:"bm",INCREASE_BG_COLOR:"ibc",DECREASE_BG_COLOR:"dbc",COLOR_THRESHOLDS:"cts",CURRENT_SLIDE_ELEMENT:"cse",FIX_CARD_HEIGHT:"fch",CARD_HEIGHT:"ch",GRID_COLUMN_COUNT:"gcc",CUSTOM_KPI_STYLE:"cks",};mstrmojo.kpicard.TEXT_SIZE_TYPE={UNIFIED:"0",FIT_TO_CONTAINER:"1",FIXED:"2",};mstrmojo.kpicard.DISPLAY_MODE={STACKED:"1",DEFAULT:"2",HORIZONTAL:"3",VERTICAL:"4",GRID:"5"};mstrmojo.kpicard.BADGE_MODE={NONE:"1",PERCENTAGE:"2",VALUE:"3"};mstrmojo.kpicard.KPI_STYLES={LIGHT:"1",NIGHT:"2",DESERT:"3",OCEAN:"4",};mstrmojo.kpicard.KPI_STYLES_CONFIG={};mstrmojo.kpicard.KPI_STYLES_CONFIG[mstrmojo.kpicard.KPI_STYLES.LIGHT]={bgColor:"#ffffff",bgOpacity:1,chartColor:"#F1F1F1",chartOpacity:1};mstrmojo.kpicard.KPI_STYLES_CONFIG[mstrmojo.kpicard.KPI_STYLES.NIGHT]={bgColor:"#313855",bgOpacity:1,chartColor:"#539CAE",chartOpacity:1};mstrmojo.kpicard.KPI_STYLES_CONFIG[mstrmojo.kpicard.KPI_STYLES.DESERT]={bgColor:"#606060",bgOpacity:1,chartColor:"#FFD333",chartOpacity:1};mstrmojo.kpicard.KPI_STYLES_CONFIG[mstrmojo.kpicard.KPI_STYLES.OCEAN]={bgColor:"#5181D7",bgOpacity:1,chartColor:"#83C8F4",chartOpacity:1};mstrmojo.kpicard.DEFAULT_PROPS={smn:"false",ap:"true",dm:"2",ks:"1",fts:"Arial",uts:"true",us:"0",bm:"2",ibc:"#83C962",dbc:"#DB6657",fch:"false",ch:"0",gcc:"4",tst:mstrmojo.kpicard.TEXT_SIZE_TYPE.UNIFIED,};mstrmojo.kpicard.SINGLE_METRIC_DISPLAY_MODE={HORIZONTAL:0,VERTICAL:1};mstrmojo.kpicard.KPI_TEMPLATE_MODE={ONLY_METRIC:0,METRIC_WITH_TREND:1,METRIC_WITH_BREAKBY:2,METRIC_WITH_TREND_AND_BREAKBY:3};mstrmojo.kpicard.CAN_SET_FONT_PARTS={LABEL:"label",PRIMARY_VALUE:"primary_value",PREVIOUS_VALUE:"previous_value",TREND_IDENTITY:"trend_identity",};mstrmojo.kpicard.CARDLIMIT=80;mstrmojo.kpicard.NEW_STYLE_MARGIN=4;mstrmojo.kpicard.SELECTION_BORDER_COLOR="#3B92ED";(function(){mstrmojo.models.template.MetricValue=mstrmojo.declare(null,null,{init:function G(H){this.data=H.data;this.value=H.value;},getValue:function B(){return this.value.v;},getThresholdType:function D(){return this.value.ty;},getRawValue:function A(){return this.value.rv;},getCSS:function C(){return this.data.css[this.value.cni].n;},getThresholdValue:function F(H){if(this.value.ti===undefined){return H;}return this.data.th[this.value.ti].n;},getFillColor:function E(H){if(this.value.ci===undefined){return H;}return this.data.fc[this.value.ci].n;}});}());mstrmojo.vi.enums.EnumVisFilterType={KEEP_ONLY:0,ADV_QUALIFICATION:1,LINKING:2,DRILLING:3};mstrmojo.mstr.EnumDSSXMLObjectSubTypes={Unknown:-1,Reserved:0,Filter:256,CustomGroup:257,Template:512,ReportGrid:768,ReportGraph:769,ReportEngine:770,ReportText:771,ReportDatamart:772,ReportBase:773,ReportGridAndGraph:774,ReportNonInteractive:775,ReportCube:776,ReportIncrementalRefresh:777,ReportTransaction:778,ReportEmmaCube:779,ReportEmmaIncrementalRefresh:780,Metric:1024,SubtotalDefinition:1025,SystemSubtotal:1026,MetricDMX:1027,DssSubTypeMetricTraining:1028,Style:1536,AggMetric:1792,Folder:2048,Device:2304,Prompt:2560,PromptBoolean:2561,PromptLong:2562,PromptString:2563,PromptDouble:2564,PromptDate:2565,PromptObjects:2566,PromptElements:2567,PromptExpression:2568,PromptExpressionDraft:2569,PromptDimty:2570,PromptBigDecimal:2571,Function:2816,Attribute:3072,AttributeRole:3073,AttributeTransformation:3074,AttributeAbstract:3075,AttributeRecursive:3076,Fact:3328,DimensionSystem:3584,DimensionUser:3585,DimensionOrdered:3586,DimensionUserHierarchy:3587,Table:3840,TablePartitionMD:3841,TablePartitionWH:3842,DatamartReport:4096,FactGroup:4352,Resolution:4864,AttributeForm:5376,FormSystem:5377,FormNormal:5378,Schema:5632,Format:5888,Catalog:6144,CatalogDefn:6400,Column:6656,PropertyGroup:6912,PropertySet:7168,DBRole:7424,DBRoleDataImport:7425,DBRoleOAuth:7427,DBRoleGenericDataConnector:7430,DBLogin:7680,DBConnection:7936,Project:8192,ServerDef:8448,User:8704,UserGroup:8705,Transmitter:8705,Configuration:9216,Request:9472,Search:9984,SearchFolder:10240,Datamart:10496,FunctionPackageDefinition:10752,Role:11008,RoleTransformation:11009,SecurityRole:11264,InBox:11520,InBoxMsg:11776,Consolidation:12032,ConsolidationManaged:12033,ConsolidationElement:12288,ScheduleEvent:12544,ScheduleObject:12800,ScheduleTrigger:13056,Link:13312,DBTable:13568,DBTablePMT:13569,TableSource:13824,DocumentDefinition:14080,ReportWritingDocument:14081,DocumentTheme:14082,DrillMap:14336,DBMS:14592,MDSecurityFilter:14848,MonitorPerformance:15104,MonitorJobs:15105,MonitorUserConnections:15106,MonitorDBConnections:15107,PromptAnswer:15232,PromptAnswers:15360,PromptAnswerBoolean:15233,PromptAnswerLong:15234,PromptAnswerString:15235,PromptAnswerDouble:15236,PromptAnswerDate:15237,PromptAnswerObjects:15238,PromptAnswerElements:15239,PromptAnswerExpression:15240,PromptAnswerExpressionDraft:15241,PromptAnswerDimty:15242,PromptAnswerBigDecimal:15243,PromptAnswerInt64:15244,GraphStyle:15616,ChangeJournalSearch:15872,BlobUnknown:16128,BlobOther:16129,BlobImage:16130,BlobProjectPackage:16131,BlobExcel:16132,BlobHTMLTemplate:16133,DashboardTemplate:16384,Flag:16640,ChangeJournal:16896,ExternalShortcutUnknown:17152,ExternalShortcutURL:17153,ExternalShortcutSnapshot:17154,ExternalShortcutTarget:17408,Reconciliation:17664,DerivedAttribute:3077,PaletteSystem:17920,PaletteCustom:17921,Thresholds:18432,SubscriptionAddress:65281,SubscriptionContact:65282,SubscriptionInstance:65283};(function(){mstrmojo.models.template.Title=mstrmojo.declare(null,null,{init:function G(J){this.title=J.title;},getActionType:function(){return this.title.at;},getDrillPath:function(){return this.title.dp;},getHeaderValues:function B(){return this.title.es;},getHeaderName:function F(J){return this.title.es[J].n;},getHeaderId:function F(J){return this.title.es[J].id;},getForms:function E(){return this.title.fs;},getFormId:function D(){return this.title.fid;},getFormType:function I(){return this.title.ftp;},getUnitId:function H(){return this.title.id;},getLinkMap:function C(){return this.title.lm;},getName:function A(){return this.title.n;},getUnitDssType:function(){return this.title.otp;},getSelectorControl:function(){return this.title.sc;}});}());(function(){mstrmojo._Fetchable=mstrmojo.provide("mstrmojo._Fetchable",{_mixinName:"mstrmojo._Fetchable",blockBegin:1,blockCount:-1,concat:false,items:null,size:function A(){var B=this.items;return(B&&B.length)||0;},next:function(B){if(this.hasNext()){this.getItems(this.blockBegin+this.blockCount,B);}},previous:function(B){if(this.hasPrevious()){var C=this.blockBegin-this.blockCount;C=C<0?0:C;this.getItems(C,B);}},getItems:function(H,F,B){F=F||{};var E=this,D=mstrmojo.emptyFn,C=F.success||D,G=F.failure||D,I=F.complete||D;this._retrieveItems(H,{success:function(J){E.blockBegin=H;E.blockCount=J.bc||30;E.set("items",(E.concat?(E.items||[]).concat(J.items||[]):(J.items||[])));if(J.totalSize){E.totalSize=J.totalSize;}C(J);},failure:function(J){G(J);},complete:function(J){I(J);}},B);},_retrieveItems:function(D,C,B){alert("Object which mixes in this mixin has not implemented this method - _retrieveItems().");},hasNext:function(){return(((this.concat?1:this.blockBegin)+((this.items&&this.items.length)||0))<((mstrApp.isAppStatePause&&mstrApp.isAppStatePause())?this.totalSize:(this.totalSize+1)));},hasPrevious:function(){return this.blockBegin>1;}});}());(function(){var C="xviPopopNode";function A(G){var H={};H[C]=G;return H;}mstrmojo.ui.menus._IsMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._IsMenuPopup",{init:function E(G){this._super(G);var J=this.popupConfig;if(!J){throw new Error("Cannot instantiate popup without supplying the popupConfig property.");}this.addDisposable(J);var H=mstrmojo.all[J.hostId],I=J.hostElement;if(J.isHostedWithin&&H&&I){H.addSlots(A(I));this.slot=C;}},closeAllMenus:function F(){var G=this.opener;if(G&&G.closePopup){G.closePopup();}if(G&&G.closeAllMenus){G.closeAllMenus();}},open:function B(H,G){if(this._super){this._super(H,G);}},close:function D(G){if(this.slot===C){this.opener.removeSlots(A(null));}if(this._super){this._super(G);}var H=mstrmojo.all[this.popupConfig.hostId];if(H){H.closePopup();}this.destroy();}});}());mstrmojo.VisEnum={ControlType:{BUTTON:"button",LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",SPLITTER:"splitter",GM_ROW_HEADER:"rh",GM_ROW_HEADER_TEXT:"rhtext",GM_ROW_HEADER_EXTRA:"rhext",GM_COL_HEADER:"ch",GM_COL_HEADER_TEXT:"chtext",GM_COL_HEADER_EXTRA:"chext",GM_YAXIS:"y",GM_XAXIS:"x",GM_YLABEL:"y-label",GM_XLABEL:"x-label",GM_ROW_HEADER_TITLE:"rht",GM_ROW_HEADER_TITLE_TEXT:"rhttext",GM_COL_HEADER_TITLE:"cht",GM_COL_HEADER_TITLE_TEXT:"chttext",GM_MINI_CHART:"chart",GM_TEXT_BODY:"text-body",GM_SHAPE:"shape",GM_MARKER:"marker",GM_SET_SHAPE:"set-shape",GM_YAXIS2:"y2",GM_XAXIS2:"x2",GM_TREND_LINE:"trendLine",GM_TREND_LINE_HOVER:"trendLineHover",GM_TREND_LINE_SELECT:"trendLineSelect",GM_REF_LINE:"referenceLine",GM_REF_LINE_HOVER:"referenceLineHover",GM_REL_LINE_SELECT:"referenceLineSelect",GM_HIGHLIGHT_BOX:"highlight-box",GM_AXIS_TEXT:"axis-text",GM_AXIS_WORD:"axis-word",GM_SVG_X_NUMERIC:"svg-x-numeric",GM_SVG_X_CATEGORY:"svg-x-category",GM_SVG_Y_NUMERIC:"svg-y-numeric",GM_SVG_Y_CATEGORY:"svg-y-category",GM_X_NUMERIC:"x-numeric",GM_X_CATEGORY:"x-category",GM_Y_NUMERIC:"y-numeric",GM_Y_CATEGORY:"y-category",GM_SVG_CHART:"svg-chart",GM_DATA_LABEL:"data-label",GM_YAXIS_LINE:"y-line",GM_XAXIS_LINE:"x-line",GM_YAXIS2_LINE:"y2-line",GM_XAXIS2_LINE:"x2-line",LGD_TITLE:"lgd-title",LGD_TEXT:"lgd-text",LGD_COLORBOX:"lgd-colorbox",LGD_COLORBOX_CTN:"lgd-colorbox-ctn",LGD_CANVAS:"lgd-canvas",LINE_CONTAINER:"line-ctn",GM_V_MATRIX_LINE:"v-line",GM_H_MATRIX_LINE:"h-line",GM_V_CHART_LINE:"v-ctline",GM_H_CHART_LINE:"h-ctline",GM_CHART_ROW:"ct-row",GM_CHART_COL:"ct-col",GM_H_GRID_LINE:"h-gline",GM_V_GRID_LINE:"v-gline",GM_H_MINOR_GRID_LINE:"h-gline-minor",GM_V_MINOR_GRID_LINE:"v-gline-minor",GM_ORIGIN_LINE:"originLine",GM_ORIGIN_LABEL:"origin-label",GM_ORIGIN_LINE_H:"origin-line-h",GM_ORIGIN_LINE_V:"origin-line-v",GM_ORIGIN_LABEL_H:"origin-label-h",GM_ORIGIN_LABEL_V:"origin-label-v",GM_DUMMY_A:"dummy-a",GM_V_EXTRA_LINE:"v-extra-line",GM_REF_LABEL:"ref-label",GM_RIGHT_BORDER:"border-r",GM_BOTTOM_BORDER:"border-b",KPI_V_SCROLLBAR:"kpi-vertical-scrollbar",KPI_H_SCROLLBAR:"kpi-horizontal-scrollbar"},GMDropZoneID:{ROWS:1,COLUMNS:2,XAXIS:3,YAXIS:4,BREAKBY:5,SLICEBY:6,COLORBY:7,SIZEBY:8,TOOLTIP:9,ANGLEBY:10},NETWORK_LOCAL_PROPS:{ZOOM_FACTOR:"zf",NODE_POSITION:"np"},NETWORK_PROPERTIES:{showLegend:"showLegend",showEdgeDirection:"showedgearrow",showTransition:"animatelayout",nodeSizeAggregation:"nodesizeaggfunc",minNodeSize:"minns",maxNodeSize:"maxns",themeType:"th",circleLabelFont:"BubFnt",modifiedNodes:"mn",layoutMode:"layout",legendPosition:"legendposition",dragMode:"mode",bubbleStyle:"bbs",propsCategory:"pc",lgdBgFillClr:"lgdBgFillClr",lgdBgFillTrans:"lgdBgFillTrans",lgdFntClr:"lgdFntClr",lgdFntSz:"lgdFntSz",lgdFntFml:"lgdFntFml",lgdFntStyle:"lgdFntStyle"},NETWORK_LAYOUT:{CIRCULAR:"circular",LINEAR:"linear",FORCE_DIRECTED:"forceDirected"},NETWORK_DRAG_MODE:{pan:0,select:1},NETWORK_AGGREGATION_METHOD:{"Count of":0,"Sum of":1,"Average of":2,"Min of":3,"Max of":4},NETWORK_MIN_NODE_SIZE_TYPE:{PROPORTIONAL:1,FULL_RANGE:2,ADJUSTED_RANGE:3},NETWORK_MAX_NODE_SIZE_TYPE:{AUTOMATIC:1,MANUAL:2},NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE:[0,0.2],HEATMAP_PROPERTIES:{showLegend:"showLegend",deleteButton:"ed",showMetricValues:"mv",labelSize:"lb",layout:"la",themeType:"th",headerType:"he",deletedList:"dl",refreshType:"rt",metricList:"ml",colorByType:"cbt",absoluteFixed:"abs",blendColor:"blc",background:"bg",legendBackground:"lbg",headerColors:"hcl",fonts:"fts",propsCategory:"pc",attrColorByOpacity:"acbo",metricColorByOpacity:"mcbo"},HEATMAP_LABEL_SIZE:{On:0,Off:1,Proportional:2},MAPS_PROPERTIES:{SHOW_LEGEND:"showLegend"},VIS_CARDLIMIT:{GRID:250,NON_GRID:8000,AREA_MAP:1000},GMLegendDataType:{COLOR_BY:1,SIZE_BY:2},GMLegendFormatingPropertyTag:{LEGEND_BG_COLOR:"lgdBgFillClr",LEGEND_BG_FILL_STYLE:"lgdBgFillStyle",LEGEND_BG_FILL_EFFECT:"lgdBgFillEff",LEGEND_BG_FILL_TRANSPARENCY:"lgdBgFillTrans",LEGEND_FONT_SIZE:"lgdFntSz",LEGEND_FONT_FAMILY:"lgdFntFml",LEGEND_FONT_STYLE:"lgdFntStyle",LEGEND_FONT_COLOR:"lgdFntClr",LEGEND_BORDER_SHOW:"lgdBdrShw",LEGEND_BORDER_COLOR:"lgdBdrClr",LEGEND_BORDER_THICKNESS:"lgdBdrThk",LEGEND_BORDER_LINE_STYLE:"lgdBdrStyle",LEGEND_BORDER_LINE_COMBINED_STYLE:"lgdBdrCmbStyle",COLOR_SQUARE_COLOR:"clrSqrClr"},LegendPropertyTag:{LEGEND_MODE:"lm",LEGEND_POSITION:"LegendPosition",SCALE_LEGEND_WIDTH:"lwr"},EnumLegendMode:{RESTORED:1,MINIMIZED:2},EnumSingleLegendMode:{RESTORE:1,COLLAPSE:2},EnumColorRankMode:{INVALID:-1,VALUE:0,TOP:1,BOTTOM:2,TOP_PERCENT:3,BOTTOM_PERCENT:4},FormNameDisplayType:{OFF:0,ON:1,FORM_NAME_ONLY:2,SHOW_ATT_NAME_ONCE:3,AUTO:4},SERVER_JSON_ERROR_TYPE:{EMPTY_DATA:0,NO_DATASET:1,AE_ERROR:2,NO_TEMPLATE_UNIT:3},NETWORK_CIRCLE_BORDER_WIDTH:8,IMAGELAYOUT_PROPERTIES:{DISPLAY_MODE:"mt",MAX_SIZE_TYPE:"ty",MAX_SIZE_VALUE:"val",MIN_SIZE_TYPE:"mst",MIN_SIZE_VALUE:"msv",MAP_FILE_PATH:"mf",SHAPE_FILL_OPC_PER:"shapeFillTrans",SHAPE_FILL_COLOR:"shapeClr",SHAPE_BORDER_STYLE:"shapeBorderCmbStyle",SHAPE_BORDER_COLOR:"shapeBorderClr",DATA_LABEL_SWITCH:"dls",DATA_LABEL_FONT_SIZE:"dlFntSz",DATA_LABEL_FONT_FAMILY:"dlFntFml",DATA_LABEL_FONT_COLOR:"dlFntClr",DATA_LABEL_FONT_STYLE:"dlFntStyle",BLANK_MAP_BORDER_STYLE:"blankMapBorderStyle",BLANK_MAP_BORDER_COLOR:"blankMapBorderClr",BLANK_MAP_COLOR:"blankMapClr",DEFAULT_MAP_COLOR:"dftMapClr",DEFAULT_BUBBLE_COLOR:"dftBubbleClr",DEFAULT_MAP_BORDER_COLOR:"dftMapBorderClr",DEFAULT_BUBBLE_BORDER_COLOR:"dftBubbleBorderClr",LEGEND_FONT_SIZE:"lgFntSz",LEGEND_FONT_FAMILY:"lgFntFml",LEGEND_FONT_COLOR:"lgFntClr",LEGEND_FONT_STYLE:"lgFntStyle",LEGEND_BACKGROUND_COLOR:"lgBgClr",LEGEND_OPC_PER:"lgBgFillTrans",LEGEND_POSITION:"lgPos",LEGEND_SHOW:"lgShow",LEGEND_MODE:"lgMode",LEGEND_SCALE:"lgScale",H_MATRIX_LINE_COLOR:"hMatrixLnClr",V_MATRIX_LINE_COLOR:"vMatrixLnClr",ALL_MATRIX_LINE_COLOR:"allMatrixLnClr",H_MATRIX_LINE_STYLE:"hMatrixLnCmbStyle",V_MATRIX_LINE_STYLE:"vMatrixLnCmbStyle",ALL_MATRIX_LINE_STYLE:"allMatrixLnCmbStyle"}};mstrmojo.vi.viz.EnumDSSDropZones={Reserved:0,Rows:1,Columns:2,XAxis:3,YAxis:4,BreakBy:5,SliceBy:6,ColorBy:7,SizeBy:8,AdditionalMetrics:9,Angle:10,Grouping:11,GeoAttribute:12,Layout:13,FromItem:14,ToItem:15,ItemSize:16,Latitude:17,Longitude:18,Metric:19,Trend:20};(function(){mstrmojo.boxmodel=mstrmojo.provide("mstrmojo.boxmodel",{rangeIntersect:function E(J,H,I,G){if(J<I){return I<=H;}if(J>I){return J<=G;}return true;},px2Inches:function C(H,G){G=parseInt(G,10);return mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep).format(parseFloat((G/H.zf/H.dpi).toFixed(4)));},offset:function F(I,H){var L=I,G=0,K=0;while(I){G+=I.offsetLeft;K+=I.offsetTop;I=I.offsetParent;if(I===H){break;}}var J;for(J=L&&L.parentNode;J&&J!==H;J=J.parentNode){if(J.scrollTop){K-=J.scrollTop;}if(J.scrollLeft){G-=J.scrollLeft;}}return{left:G,top:K};},convert2px:function D(K,I){if(!/px$/.test(I)){var H=document.createElement("img"),G=H.style,J;G.zIndex=-1;G.left=I;K.appendChild(H);J=G.pixelLeft;K.removeChild(H);return J+"px";}return I;},getEdgeQuadrantByPoint:function B(I,H){var G=H.x-I.x,M=H.y-I.y,J=I.w,L=I.h,K=[["Left","Bottom"],["Top","Right"]];if(M>L/J*G){K=K[0];}else{K=K[1];}return(M<-L/J*G+L)?K[0]:K[1];},isPtInPolygon:function A(I,K){var G=I.x,J=I.y,H=false;K.forEach(function(N,L){var M=K[L-1]||K[K.length-1];if((N.y>=J)!==(M.y>=J)){if((G<(M.x-N.x)*(J-N.y)/(M.y-N.y)+N.x)){H=!H;}}});return H;}});}());mstrmojo.mstr.EnumDSSConsolidationType={DssNormal:0,DssDerivedElement:1,DssRecursiveDerivedElement:2};(function(){mstrmojo._IsGraphDataService=mstrmojo.provide("mstrmojo._IsGraphDataService",{handleUserSingleTap:function A(D,E,B,G,C,F){if(mstrApp.onMobileDevice()){mstrApp.serverRequest({taskId:"handleUserSingleTap",sliceID:D,nodekey:E,x:B,y:G,selectable:C},F);}}});}());(function(){var A={};mstrmojo.NumberFormat={getInstance:function B(F,G){var E=F+"--"+G;if(E in A){return A[E];}var C={parse:function(H){},format:function(H){}};if(F==="."&&G===","){C.parse=function(H){if(!H){return NaN;}var I=H.replace(/,/g,"");return Number(I);};C.format=function(H){return Number(H).toString();};}else{var D=new RegExp("\\"+G,"g");C.parse=function(I){if(!I){return NaN;}var H=I.replace(D,"").replace(F,".");return Number(H);};C.format=function(I){var H=Number(I).toString();return H.replace(".",F);};}A[E]=C;return C;}};})();mstrmojo.chart.model.enums.EnumDSSXMLAxesBitMap={DssXmlAxisNone:0,DssXmlAxisRowsBit:1,DssXmlAxisColumnsBit:2,DssXmlAxisPagesBit:4,DssXmlAxisChaptersBit:8};mstrmojo.vi.enums.EnumFeatures={SUPPORT_RESPONSIVE:"support-responsive",SUPPORT_RESPONSIVE_RESIZING:"support-responsive-resizing",SUPPORT_GHOST_IMG:"support-ghost-img",SUPPORT_NLP:"use-natural-language",SUPPORT_CONDITION_METRIC:"support_condition_metric",USE_WORKSTATION_NAMING_STYLE:"use-workstation-naming-style",SUPPORT_TOC_UPDATEPOISITION:"support-toc-updatePosition",SUPPORT_LIVEMODE:"support-livemode",NUMBER_FORMATTING:"number-formatting",SAVE_ANALYSIS:"save-analysis",INSERT_NEW_METRIC:"insert-new-metric",DATA_ENGINE_VERSION:"data-engine-version",WEB_DRILL_AND_LINK:"web-drill-and-link",WEB_IMPORT_DATABASE:"web-import-database"};(function(){function Z(c){var d=[].slice.call(c),e=d[d.length-1],f=function(h,g){return h===g;};if(/function|string/.test(typeof e)){f=typeof e==="function"?e:function(h,g){return h[e]===g[e];};d=d.slice(0,d.length-1);}return{sets:d,compareFunc:f};}mstrmojo.array=mstrmojo.provide("mstrmojo.array",{indexOf:function D(d,f){var c=(d&&d.length)||0,e;for(e=0;e<c;e++){if(d[e]==f){return e;}}return -1;},indexOfMulti:function V(c,d){var h=[],g={},f=0,e=this;e.forEach(c,function(k,j){e.forEach(d,function(l,m){var n=(l===k);if(n){h[m]=g[m]=j;f++;}return !n;});});return{indices:h.length?h:null,map:g,count:f};},forEach:function S(d,j,g){var c=(d&&d.length)||0,e;for(e=0;e<c;e++){var h=e===(c-1);if(g){if(j.call(g,d[e],e,d,h)===false){break;}}else{if(j(d[e],e,d,h)===false){break;}}}return d;},map:function a(d,h){var c=(d&&d.length)||0,e=[],g;for(g=0;g<c;g++){e[g]=h(d[g],g);}return e;},filter:function J(e,f,g){var k=[],j=0,d=(e&&e.length)||0,c=(g&&g.max)||0,h;for(h=0;h<d;h++){if(f(e[h],h,e)){k[j]=e[h];j++;if(c&&j>=c){break;}}}return k;},filterOne:function M(c,d){var e=this.filter(c,d,{max:1});if(e.length){return e[0];}return null;},ensureArray:function Q(c){return[].concat(c||[]);},find:function N(d,h,e){var c=(d&&d.length)||0,f;for(f=0;f<c;f++){var g=d[f];if(g&&g[h]==e){return f;}}return -1;},distinct:function B(d,h){if(d.reduce&&!h){return d.reduce(function(k,j){if(k.indexOf(j)<0){k.push(j);}return k;},[]);}var c=(d&&d.length)||0,e,g,f=[];for(e=0;e<c;e++){g=d[e];if((g!==undefined)&&((h&&this.find(f,h,g[h])<0)||(!h&&this.indexOf(f,g)<0))){f.push(g);}}return f;},findBin:function E(e,k,n,d){var j=(d||e.length)-1,f=0,c,g=k[n];while(j-f>1){if(e[c=j+f>>1][n]<g){f=c;}else{j=c;}}if(e[f][n]===g){return f;}return e[j][n]===g?j:-1;},search:function I(n,f,j){var g=n.length,e=-1,d,k=f.toUpperCase(),c=f.length;while(g-e>1){if(n[d=g+e>>1][j].substr(0,c).toUpperCase()<k){e=d;}else{g=d;}}return g;},findMulti:function R(l,e,o){if(!o){return{indices:null,map:{},count:0};}var m=o.length,r=[],d={},p=0,g=(l&&l.length)||0,h;for(h=0;h<g;h++){var q=l[h][e],f;for(f=0;f<m;f++){if(o[f][e]===q){r[f]=h;d[f]=h;p++;break;}}}return{indices:r,map:d,count:p};},removeItem:function Y(c,e){var d=this.indexOf(c,e);if(d>-1){this.removeIndices(c,d,1);}return d;},removeItems:function O(c,h,d){var e=this.findMulti(c,h,d);if(e.count){var g=e.indices.concat().sort(this.numSorter).slice(0,e.count),f;for(f=g.length-1;f>-1;f--){c.splice(g[f],1);}}},numSorter:function b(d,c){return Number(d)-Number(c);},stringSorter:function K(e,d){var c=e.toLowerCase(),f=d.toLowerCase();if(c<f){return -1;}if(c>f){return 1;}return 0;},removeIndices:function P(c,e,d){c.splice(e,d);},insert:function F(d,c,e){if(!d){d=[];}if(c===null||c===undefined){c=d.length;}Array.prototype.splice.apply(d,[c,0].concat(e));return d;},hash:function C(d,f){f=f||{};var c=(d&&d.length)||0,e;for(e=0;e<c;e++){f[d[e]]=true;}return f;},get:function W(d,g){if(!g){return null;}var e=[],c=g.length,f;for(f=0;f<c;f++){e[f]=d[g[f]];}return e;},deepSortArr:function G(d,f,c,e){return d.sort(function(j,g){var k=j[c][f],h=g[c][f];if(!e){return(k<=h);}return(k>h)?-1:1;});},isArray:function(c){var d=Array.isArray;if(d){return d(c);}return Object.prototype.toString.call(c)==="[object Array]";},some:function L(d,e){if(!d){return false;}if(d.some){return d.some(e);}var c=false;this.forEach(d,function(g,f){c=e(g,f,d);return !c;});return c;},difference:function X(){if(arguments.length<2){throw new Error("difference should get at least 2 parameters");}var f=Z(arguments),d=f.sets,e=f.compareFunc,g=d[0],c=[].concat.apply([],d.slice(1));return g.filter(function(h){return !c.some(function(j){return e(h,j);});});},intersection:function U(){if(arguments.length<2){throw new Error("intersection should get at least 2 parameters");}var g=Z(arguments),e=g.sets,f=g.compareFunc,c=e[0],d=e.slice(1);d.forEach(function(h){c=c.filter(function(j){return h.some(function(k){return f(j,k);});});});return c;},fnReduceNumber:function A(c,d){return c+d;},applyLargeArray:function H(f,j,l,m){var g=f.length,k=1000,c,d,e,h=l;if(g){for(c=0,d=k;c<g;c=d,d+=k){e=j.apply(m,f.slice(c,d));h=j.apply(m,[h,e]);}}else{h=j.apply(m,f);}return h;}});}());mstrmojo.gmaps.MapEnums={};mstrmojo.gmaps.EnumBaseMapType={Reserved:"-1",Esri:"1",Google:"2",Image:"3",Mapbox:"4"};mstrmojo.gmaps.EnumDefaultMapStyle={Esri:"Light Gray Map",Google:"0",Image:"",Mapbox:"mapbox://styles/microstrategy/cj4fnd0xu1ax82rnuq287rwvu"};mstrmojo.gmaps.EnumLanguageType={Local:"{name}",English:"{name_en}",Both:"{name_en}\n{name}"};mstrmojo.gmaps.EnumGraphicType={Marker:"1",Bubble:"2",Area:"3",Density:"4",Path:"5"};mstrmojo.gmaps.EnumMarkerType={Pin:"1",Square:"2",Diamond:"3",Image:"4",Circle:"5"};mstrmojo.gmaps.EnumPolygonSource={Cloud:"1",Custom:"2",MapBoxPolygon:"3"};mstrmojo.gmaps.EnumShapeType={polygon:"polygon",multiPolygon:"multipolygon"};mstrmojo.gmaps.EnumGeometryType={Point:"Point",Extent:"2",Polygon:"Polygon"};mstrmojo.gmaps.EnumExtraCfgTaskId={Esri:"getESRIExtraConfig",Google:"getGoogleExtraConfig"};mstrmojo.gmaps.EnumGlobalCfgName={Esri:"esriConfig",Google:"googleConfig"};mstrmojo.gmaps.EnumThresholdType={Default:-1,Number:2,Text:3,Image:4,Url:5,QuickSymbol:10};mstrmojo.gmaps.EnumPropertyType={applyThreshold:"at",clusterMode:"mc",clusterRadius:"cr",clusterMaxZoom:"cmz",shapeFile:"lid",mapStyle:"dv",languageType:"lang",themeType:"dms",markerType:"mtp",zoomSetting:"rosa",legendSwitch:"ls",tooltipSwitch:"ts",legendWidthScale:"lwr",imageUrl:"mstyl",needMapToolbar:"mt",attributeId:"atf",useAttributeForm:"af",showZoomBtns:"zb",showAffinityLines:"da",showArcsLines:"dal",maxLineThickness:"lwm",maxBubbleSize:"mbs",useAbsolute:"mss",customInfoWinTpl:"iwd",pathColor:"pcp",affinityLineGrid:"ag",collapseLegend:"clgd",legendSize:"lgds",satf:"satf",dm:"dm",mvo:"mvo",baseMapType:"bmt",editingLayerIdx:"elx",mapGeoExtent:"mext",graphicType:"gtp",layerName:"ln",layerIdx:"lx",isRemoved:"ird",isHidden:"ih",enableZoomThroughLayer:"eztl",minLayerZoomLvl:"minlzl",maxLayerZoomLvl:"maxlzl",MAX_SIZE_TYPE:"maxst",MAX_SIZE_VALUE:"maxsv",MIN_SIZE_TYPE:"minst",MIN_SIZE_VALUE:"minsv",showMapLable:"mlb",mapLabelOnTop:"mlbt",distUnit:"mdu",geoAttribute:"ga",latitude:"lat",longitute:"lng",slice:"slc",angle:"amt",colorby:"cmt",sizeby:"smt",tooltip:"tooltip",keepZoomAndPos:"kzp",zoomLevel:"mz",mapCenter:"mp",mapBearing:"mbr",mapPitch:"mpt",dirtyVp:"dirtyVp",colorByOpacity:"cbo"};mstrmojo.gmaps.EnumGeographicRole={EnumGeographicRoleNone:"0",EnumGeographicRoleCity:"1",EnumGeographicRoleState:"2",EnumGeographicRoleCountry:"3",EnumGeographicRoleLocation:"4",EnumGeographicRoleLatitiude:"5",EnumGeographicRoleLongitude:"6",EnumGeographicRoleOther:"7",EnumGeographicRoleZipCode:"8",EnumGeographicRoleCounty:"9",EnumGeographicRoleLastOne:"10"};mstrmojo.gmaps.EnumClusterMode={MOBILE_OFF:"0",MOBILE_ON:"1",ON:"2",OFF:"3",PIE:"4"};mstrmojo.gmaps.EnumZoomBehavior={Keep:"0",Automatic:"1"};mstrmojo.gmaps.EnumDistUnitType={KM:"0",Miles:"1"};mstrmojo.gmaps.EnumDataLabel={DATA_LABEL_SHOW:"dlShw",DATA_LABEL_SHOW_ALL:"dlShwAll",DATA_LABEL_FONT_SIZE:"dlFntSz",DATA_LABEL_FONT_FAMILY:"dlFntFml",DATA_LABEL_FONT_COLOR:"dlFntClr",DATA_LABEL_FONT_STYLE:"dlFntStyle",DATA_LABEL_FONT_HALO_COLOR:"dlFntHaloClr",DATA_LABEL_FONT_HALO_WIDTH:"dlFntHaloWidth"};mstrmojo.gmaps.EnumShapeFormatting={SHAPE_FORMAT_FILL_COLOR:"shapeClr",SHAPE_FORMAT_FILL_OPACITY:"shapeFillTrans",SHAPE_FORMAT_BORDER_COLOR:"shapeLineClr",SHAPE_FORMAT_BORDER_STYLE:"shapeLineStyle"};mstrmojo.gmaps.EnumCombinedLineStyle={NONE:99,THIN:1,THICK:2,DASHED:3,DOTTED:4};mstrmojo.gmaps.EnumDefaultShapeFormatStyle={FILL_COLOR:"#436CD3",FILL_OPACITY:"85",FILL_OPACITY_VALUE:"0.85",FILL_OPACITY_FACTOR_HOVER:0.75,FILL_OPACITY_FACTOR_UNSEL:0.5,BORDER_STYLE:mstrmojo.gmaps.EnumCombinedLineStyle.THIN,BORDER_COLOR:"#FFFFFF",BORDER_WIDTH:"1"};mstrmojo.gmaps.DEFAULT_DATA_LABEL_PROPS={dlShw:[0],dlShwAll:[false],dlFntFml:["Arial"],dlFntSz:["8pt"],dlFntStyle:[0],dlFntClr:[0]};mstrmojo.gmaps.EnumDataLabelShowOption={NONE:0,SHOW_TEXT:1,SHOW_VALUE:2,SHOW_BOTH:3};mstrmojo.gmaps.MarkerAlignOption={CENTER:0,TOP:1,LEFT:2,RIGHT:3,BOTTOM:4,TOP_LEFT:5,TOP_RIGHT:6,BOTTOM_LEFT:7,BOTTOM_RIGHT:8};mstrmojo.gmaps.EnumToolbarButtonType={DRILL:1,SINGLE_SELECT:2,RECTANGLE_SELECT:4,EDIT_INFO_WINDOW:8,CLEAR_ALL:16,AFFINITY:32,FREE_SELECT:64,CIRCLE_SELECT:128,ZOOM:256,LAYERS_SELECT:512,KEEP_ONLY:1024,EXCLUDE:2048,SHOW_DATA:4096,SEARCH_BAR:8192,MAP_STYLE:16384};mstrmojo.gmaps.EnumToolbarState={NORMAL:0,SINGLE_SELECT:1,RECTANGLE_SELECT:2,ZOOM:3,AFFINITY:4,FREE_SELECT:5,CIRCLE_SELECT:6,CLEAR_ALL:7,LAYERS_SELECT:8,MARKERTYPE:9,CLUSTER:10,MAP_TYPE:11};mstrmojo.gmaps.EnumActions={rename:"renameUnit",remove:"removeDropZoneUnit",add:"addDropZoneUnit",addForm:"addForm",removeForm:"removeForm"};mstrmojo.gmaps.TARGET_MAPOPTIONS=1;mstrmojo.gmaps.TARGET_FORMATTING_LAYERS=2;mstrmojo.gmaps.SelectionHashType={PRIMARY:0,TEMPLATE_SELECTION:1,EDITING_LAYER:2,RMC_LAYER:3};mstrmojo.gmaps.EnumTransformState={ReadyToUse:-1,UseExistingLine:0,CrossFromExistingToNewLine:1,UseNewLine:2,CrossFromNewToExistingLine:3};mstrmojo.gmaps.EnumDrillLinkAnswerType={SAME_PROMPT:1,DO_NOT_ANSWER:2,CLOSE:3,DYNAMIC:4,STATIC:5,CURRENT_UNIT:6,ALL_VALID_UNITS:7,USE_DEFAULT_ANSWER:8,DYNAMIC_OR_SAME_PROMPT:9};mstrmojo.gmaps.EnumMinSizeType={PROPORTIONAL:1,FULL_RANGE:2,ADJUSTED_RANGE:3};mstrmojo.gmaps.EnumMaxSizeType={AUTOMATIC:1,MANUAL:2};mstrmojo.gmaps.EnumDynamicZoomStatus={INIT:0,NO_GEO_ATTR:1,FIRST_ADD_GEO_ARR:2,FIRST_GEO_ADD_FINISHED:3};mstrmojo.gmaps.ZoomAnimationDelta=0.15;mstrmojo.gmaps.LAYER_INDEX_MAX=100;mstrmojo.gmaps.LASSOLAYER_ZINDEX=mstrmojo.gmaps.LAYER_INDEX_MAX+1;mstrmojo.gmaps.ZOOMBTN_ZINDEX=mstrmojo.gmaps.LAYER_INDEX_MAX+50;mstrmojo.gmaps.ENABLE_MAX_MIN_SIZE_CONTROL=true;mstrmojo.gmaps.EnumRenderMethod={svg:"svg",canvas:"canvas",mapbox:"mapbox"};mstrmojo.gmaps.EnumLayerZoneSource={DROP_ZONE:"dzpn",PROPERTY_PANEL:"pppn"};mstrmojo.chart.enums.EnumGraphMajorType={GMT_INVALID:0,GMT_CATEGORY:1,GMT_PIE:2,GMT_SCATTER:3,GMT_POLAR:4,GMT_RADAR:5,GMT_BUBBLE:6,GMT_STOCK:7,GMT_HISTOGRAM:8,GMT_GAUGE:9,GMT_FUNNEL:10,GMT_BOX:11,GMT_GANTT:12,GMT_SPECTRAL:13,GMT_TABLE:14,GMT_3D_CATEGORY:15,GMT_3D_SCATTER:16,GMT_GRID:17};mstrmojo.vi.controllers.EnumPanelManipulationType={RENAME:1,MOVE:2,DUPLICATE:3,DELETE:4,NEW:5,CROSS_CHAPTER_MOVE:6,MOVE_TO_NEW_CHAPTER:7};(function(){mstrmojo.vi.ui._IsUnitContainerTitleBar=mstrmojo.provide("mstrmojo.vi.ui._IsUnitContainerTitleBar",{_mixinName:"mstrmojo.vi.ui._IsUnitContainerTitleBar",layoutConfig:{w:{leftToolNode:"auto",textNode:"100%",rightToolNode:"auto"},xt:true},setDimensions:function A(D,C){return this._super("auto",C);},getTitleChildrenLayoutOffsets:function B(){return{h:0,w:12};}});}());mstrmojo.EnumRWUnitType={LAYOUT:0,HEADER:2,FOOTER:3,SUBSECTION:4,DETAILS:5,PAGEHEADER:6,PAGEFOOTER:7,PANELSTACK:8,PANEL:9,UNITCONTAINER:11,GRID:521,GRAPH:522,GRIDGRAPH:527,RECTANGLE:101,IMAGE:102,LINE:105,TEXTFIELD:106,HTMLCONTAINER:107,SELECTOR:111,ROUNDEDRECTANGLE:112,VISUALIZATION:114,MOJOVISUALIZATION:115};mstrmojo.EnumReadystate={IDLE:1,WAITING:3,ERROR:4,SUCCESS:5,CANCELLED:6,TIMEOUT:7};mstrmojo.chart.model.enums.EnumDSSDynamicShortcut={DssDynamicShortcutReserved:0,DssDynamicShortcutAuto:1,DssDynamicShortcutAcrossThenDown:2,DssDynamicShortcutDownThenAcross:3,DssDynamicShortcutColumns:4,DssDynamicShortcutRows:5,DssDynamicShortcutCell:6,DssDynamicShortcutShape:7,DssDynamicShortcutLastOne:8,DssDynamicShortcutRangeEnd:255};mstrmojo.vi.enums.EnumDerivedElementType={LIST:1,CALCULATION:2,RESIDUE:4};mstrmojo.mstr.EnumDSSXMLDrillType={DssXmlDrillReserved:0,DssXmlDrillToParent:1,DssXmlDrillToChild:2,DssXmlDrillToUnit:3,DssXmlDrillToTemplate:4,DssXmlDrillToForm:5,DssXmlDrillToDetails:6,DssXmlDrillToMetric:7,DssXmlDrillFixTemplate:8,DssXmlDrillRemoveMetric:9,DssXmlDrillRemoveUnit:10,DssXmlDrillToGraphCoordinates:11};mstrmojo.chart.model.enums.EnumDSSObjectType={DssTypeUnknown:-1,DssTypeReserved:0,DssTypeGeneric:5,DssTypeFormatBAD:46,DssTypeFilter:1,DssTypeTemplate:2,DssTypeReportDefinition:3,DssTypeMetric:4,DssTypeStyle:6,DssTypeAggMetric:7,DssTypeFolder:8,DssTypeDevice:9,DssTypePrompt:10,DssTypeFunction:11,DssTypeAttribute:12,DssTypeFact:13,DssTypeDimension:14,DssTypeTable:15,DssTypeDatamartReport:16,DssTypeFactGroup:17,DssTypeShortcut:18,DssTypeResolution:19,DssTypeMonitor:20,DssTypeAttributeForm:21,DssTypeSchema:22,DssTypeFormat:23,DssTypeCatalog:24,DssTypeCatalogDefn:25,DssTypeColumn:26,DssTypePropertyGroup:27,DssTypePropertySet:28,DssTypeDBRole:29,DssTypeDBLogin:30,DssTypeDBConnection:31,DssTypeProject:32,DssTypeServerDef:33,DssTypeUser:34,DssTypeTransmitter:35,DssTypeConfiguration:36,DssTypeRequest:37,DssTypeScript:38,DssTypeSearch:39,DssTypeSearchFolder:40,DssTypeDatamart:41,DssTypeFunctionPackageDefinition:42,DssTypeRole:43,DssTypeSecurityRole:44,DssTypeLocale:45,DssTypeConsolidation:47,DssTypeConsolidationElement:48,DssTypeScheduleEvent:49,DssTypeScheduleObject:50,DssTypeScheduleTrigger:51,DssTypeLink:52,DssTypeDbTable:53,DssTypeTableSource:54,DssTypeDocumentDefinition:55,DssTypeDrillMap:56,DssTypeDBMS:57,DssTypeMDSecurityFilter:58,DssTypePromptAnswer:59,DssTypePromptAnswers:60,DssTypeGraphStyle:61,DssTypeChangeJournalSearch:62,DssTypeNCSObjects:255,DssTypeReservedLastOne:63};(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.hash");var I=mstrmojo.array,B=mstrmojo.hash,D="u;",C="-1";ELEM_HIDDEN_PROP="hid";mstrmojo.elementHelper=mstrmojo.provide("mstrmojo.elementHelper",{buildElemsTerseID:function F(R,Q,V){var P,O;for(O in R){P=R[O];if(P.v){var S=P.v.replace(/\\\\/g,"\u001e").replace(/\\\;/g,"\u001f");var U=S.split(";");if(U&&U.length>1){U[1]=Q;if(V&&U.length>2){U.pop();}P.v=U.join(";").replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\;");}}}return R;},buildElemsCountStr:function K(U,Q,P){U=(!U||!U.length)?[]:U;Q=(!Q||!Q.length)?[]:Q;function S(V){return V.filter(function(W){return !W[ELEM_HIDDEN_PROP];});}var R=S(U).length,O=S(Q).length;if(I.find(Q,"v",D)>-1){O-=1;}if(I.find(Q,"v",C)>-1){O-=1;}if(P){R=(R<O)?O-R:0;}if(I.find(U,"v",D)>-1||I.indexOf(U,D)>-1){R=O;}return this.buildElemsCountStrByNum(R,O);},buildElemsCountStrByNum:function K(P,O){if(P===O){if(O===0){return"";}return O.toString();}else{if(O===0){return P+" "+mstrmojo.desc(514);}else{if(P>O){return"("+O+")";}}}return mstrmojo.desc(4891,"").replace("##",String(P)).replace("###",String(O));},browseElements:function G(Q,R,P){var O={doNotHold:!(P&&mstrApp.serverProxy),silent:true};mstrApp.serverRequest(mstrmojo.hash.copy(P,R),Q,O);},getIdPresentation:function J(R){if(!!R){var Q=R.charAt(0),O,P,S;if((Q>="g"&&Q<="w")||(Q>="V"&&Q<="Z")){P=false;for(S=1;S<R.length;++S){if(P){P=false;}else{switch(R.charAt(S)){case";":return"terseLong";case"\\":P=true;break;}}}return"terse";}if(Q>="B"&&Q<="Q"){if(R.length>2){O=R.charAt(1);if(O>="A"&&O<="Q"){if(R.charAt(2)===":"){return"oldLong";}}}}if(R.length>=33&&R.charAt(32)===":"){return"old";}}return null;},terseLong2OldShort:function N(P){if(this.getIdPresentation(P)!=="terseLong"){return P;}var O=P.replace(/\\\\/g,"\u001e").replace(/\\\;/g,"\u001f"),Q=O.substring(1,O.length).split(";");return(Q[1]+":"+Q[0]).replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\;");},oldShort2terseLong:function L(P,S){if(this.getIdPresentation(P)!=="old"){return P;}var O=P.replace(/\\\\/g,"\u001e").replace(/\\\:/g,"\u001f"),R=O.split(":"),Q=R.shift();return(S||"h")+(R.join(":")+";"+Q).replace(/\u001e/g,"\\\\").replace(/\u001f/g,"\\:");},isNullElem:function H(O){if(!O){return true;}var R=this.getIdPresentation(O),P=false,Q;switch(R){case"terse":case"terseLong":Q=O.substring(1,O.length).split(";");P=Q[0].indexOf(this.TERSE_NULL)>-1;break;case"old":case"oldLong":P=O.indexOf(this.OLD_NULL)>-1;break;}return P;},isNonGroupNull:function(Q){var O=Q.eid||(Q._e&&Q._e.id),P=O&&O.split(":")[0];return P&&P===this.NON_GROUP_NULL;},getAttributeId:function M(Q){var P,O;if(Q){O=Q.split(";");P=O[1];}return P;},getElementValue:function A(P){var Q,O;if(P){O=P.split(";");if(O.length>2){Q=O[0]+" "+O[2];}else{Q=O[0];}}return Q;},isAttributeIdsLinked:function E(P,O,Q){var S=false,R=B.keyarray(Q);I.forEach(R,function(U){if(U===P){I.forEach(Q[U],function(V){if(V===O){S=true;return false;}});}if(S){return false;}});return S;},ELEM_ALL_ID:"u;",ELEM_DUMMY_ID:"-1",ELEM_SEPARATOR:"\u001E",OLD_NULL:"~!@@~~!@@~",TERSE_NULL:"\\N",NON_GROUP_NULL:"n00000000000000000000000000000000",ELEM_ALL:{t:mstrmojo.chart.model.enums.EnumDSSObjectType.DssTypeDimension,v:"u;",n:"(All)"}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumReadystate");var C=mstrmojo.EnumReadystate;function E(G){return(G.getKey&&G.getKey())||G.k;}mstrmojo._IsDocController={_mixinName:"mstrmojo._IsDocController",_getXtabCallback:function(L,H){var G={},J=G[E(L)]=L.defn,K=this,I=K.model;return I.newCallback({submission:function(){if(J.set){J.set("readyState",C.WAITING);}},success:function(N){var M=N.pukeys,O=M&&M.split("\u001E");if(M){G=I.getUnitDefinitions(M);}I.partialUpdate(N.data,G,H===false?undefined:N.defn,O,N.puFilters);},failure:function(M){if(!(mstrApp.isSingleTier&&M.code===403)){mstrmojo.alert(M.code+": "+M.message);}},complete:function(){if(J.set){J.set("readyState",C.IDLE);}K.docRequestComplete();}});},_addNodeKeyToAction:function(G,H){H.nodeKey=E(G);return H;},onGridSelector:function(H,K){var G=this.model,J=[].concat(G.getTargetInfoWin(K.ifw)).concat(G.getTargetInfoWin(K.tks));K.sid=H.sid;if(H.isInFilterPanel&&H.isInFilterPanel()&&H.filterCtrl){H.filterCtrl.cacheUpdateAction(K);}else{G.slice(K);}if(J&&J.length){var I;for(I=0;I<J.length;I++){G.showInfoWin(J[I],K.anchor,"h",true,null,K.sid);}}},onVisSelector:function(H,J){if(J.anchor){var G=this.model,I=G.getTargetInfoWin(J.tks);if(I&&I.length){G.showInfoWin(I[0],J.anchor,"h",true);}}if(H.xtabModel&&H.xtabModel.docModel&&H.xtabModel.docModel.slice){H.xtabModel.docModel.slice(J);}},isInRequest:function D(){var G=!!this._inProcess;if(!G){this._inProcess=true;}return G;},docRequestComplete:function F(){this._inProcess=false;},nudgeWidget:mstrmojo.emptyFn,getGroupByElements:function B(I){var M=[],L;while(I){L=I.node&&I.node.data&&I.node.data.pbes;if(L){break;}I=I.parent;}if(L){var J=this.model.data.elems;var H=L.length,K;for(K=0;K<H;K++){var G=L[K];M.push(isNaN(G)?G:J&&J[G]);}}return M;},setData:function A(H,J){var G=this.view,I=J;if(J&&G&&G.unloadLayouts){G.unloadLayouts(null,false);I=false;}this.model.loadLayout(H,I);if(this.hasPageBy&&this.hasPageBy()){this.getPageByTree(true);}}};}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums");var E=mstrmojo.gmaps,M=E.EnumGeographicRole,G=E.EnumBaseMapType,L=E.EnumPolygonSource,J="4-s";function K(O){return !!(O&&O.custom&&(O.custom==="true"||O.custom===true));}mstrmojo.gmaps._AreaMapHelper=mstrmojo.provide("mstrmojo.gmaps._AreaMapHelper",{_mixinName:"mstrmojo.gmaps._AreaMapHelper",getAvailableShapes:function N(O,W,U,V){var R=[],Q,S,P;if(!O||U==undefined){return R;}if(V===G.Mapbox){return this.getShapesForMapbox(O,W);}for(S=0,P=O.length;S<P;S++){Q=O[S];if(V!==G.Esri&&!K(Q)){continue;}if(this.isMapBoxShapeConfig(Q,W)){continue;}if(U===M.EnumGeographicRoleNone||U===M.EnumGeographicRoleOther&&K(Q)||U==Q.roleId){R.push(Q);}}return R;},getShapesForMapbox:function C(O,U){var R=[],Q,S,P;for(S=0,P=O.length;S<P;S++){Q=O[S];if(this.isMapBoxShapeConfig(Q,U)){Q.supportedGeoRoles=[Q.roleId];if(Q.roleId===M.EnumGeographicRoleCity){Q.supportedGeoRoles.push(M.EnumGeographicRoleCounty);}R.push(Q);}}return R;},getPolygonSource:function D(O,P,Q,U){var R=O&&O.data,V=R&&R.vp,W=V&&V.lid,S,X;if(!V){return L.Cloud;}if(!!W){S=this.getMatchingShape(P,W,null);}else{X=this.getShapeAttributeGeoRole(R,O.dropZones.geoAttribute);P=this.getAvailableShapes(P,Q,X,U);S=this.getMatchingShape(P,null,X);}if(!!S){if(!W){V.lid=S.id;}if(K(S)){if(this.isMapBoxShapeConfig(S,Q)){return L.MapBoxPolygon;}return L.Custom;}}return L.Cloud;},isMapBoxShapeConfig:function A(O,S){var Q,P,R=(S&&S.length)||0;for(Q=0;Q<R;Q++){P=S[Q];if(O.layerId===P.id){return parseInt(P.scope)===parseInt(G.Mapbox);}}return false;},isMapboxStatisticalShape:function B(O,S){var Q,P,R=(S&&S.length)||0;for(Q=0;Q<R;Q++){P=S[Q];if(O&&O.layerId===P.id){return P.scope===J;}}return false;},getShapeAttributeGeoRole:function F(S,V){var P=S.gts,a=P&&P.row,O,Z,Y,U,X,Q,R,W=false;if(!a||!a.length){return ;}X=a.length;if(!!V){for(U=0;U<X;U++){Y=a[U];if(Y.id!==V){continue;}O=Y.fs;for(Q=0,R=O.length;Q<R;Q++){Z=O[Q].fgr;if(Z==undefined){continue;}Z=Z.toString();if(Z!==M.EnumGeographicRoleNone&&Z!==M.EnumGeographicRoleLatitiude&&Z!==M.EnumGeographicRoleLongitude){W=true;break;}}if(W){break;}}}else{for(U=0;U<X;U++){Y=a[U];O=Y.fs;for(Q=0,R=O.length;Q<R;Q++){Z=O[Q].fgr;if(Z!==M.EnumGeographicRoleNone&&Z!==M.EnumGeographicRoleLatitiude&&Z!==M.EnumGeographicRoleLongitude){break;}}}}return Z;},getMatchingShape:function I(P,U,X){var R,S,W,O,Q,V;if(!P){return null;}if(X===M.EnumGeographicRoleNone){X=null;}if(!!U){for(Q=0,V=P.length;Q<V;Q++){if(P[Q].id==U){R=P[Q];break;}}}else{if(!!X){for(Q=0,V=P.length;Q<V;Q++){O=P[Q];if(K(O)&&(O.roleId==X||(O.supportedGeoRoles&&O.supportedGeoRoles.indexOf(X)>-1))){if(!S){S=O;}if(!!O["default"]&&(O["default"]+"").toLowerCase()==="true"){R=O;break;}}else{if(!W&&O.roleId==X&&!!O["default"]&&(O["default"]+"").toLowerCase()==="true"){W=O;}}}if(!R){if(!!S){R=S;}else{if(!!W){R=W;}}}}}return R;},getShape4MapboxSecondGeoAttr:function H(P,Q,V,Y){var O,S,R,W,X,U;P=this.getAvailableShapes(P,Q,M.EnumGeographicRoleOther,G.Mapbox);W=(P&&P.length)||0;S=this.getMatchingShape(P,V,null);for(R=0;R<W;R++){O=P[R];if(O.roleId==Y||(O.supportedGeoRoles&&O.supportedGeoRoles.indexOf(Y)>-1)){if(Y==M.EnumGeographicRoleCountry){return O;}X=this.isMapboxStatisticalShape(S,Q);U=this.isMapboxStatisticalShape(O,Q);if(X===U){return O;}}}return null;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");mstrmojo.vi.ui.rw.SelectionType={EMPTY:"empty",ATTS:"att",METRICS:"metric",COL_HEADERS:"col-headers",ROW_HEADERS:"row-headers",METRIC_VALUES:"metric-values"};var A=function(z){var w=(mstrApp&&mstrApp.docModelData&&mstrApp.docModelData.mid)||"",x=z.k||z.key;return x+"-"+w;},F={},o={},R=mstrmojo.hash,X=mstrmojo.array,L=function(z){var w=R.keyarray(z).sort(),x=[],AA;X.forEach(w,function(AB){AA=[];X.forEach(z[AB],function(AC){AA.push(this.model.getNormalizedFormElementId(AC.id));},this);x.push(AB+"-"+AA.sort().join("@"));},this);return x.join("#");},K=function(w){var x=L.call(this,w);if(!this._viSelections[x]){this._viSelections[x]=w;if(mstrApp&&mstrApp.isInVFConfigMode){return ;}F[A(this)]={_selectionType:this.getSelectionType(),_viSelections:this.getSelectionHash()};}},v=function(w){var x=L.call(this,w);if(!this._viContextMenuSelections[x]){this._viContextMenuSelections[x]=w;}},m=function(x){var z=L.call(this,x),w=this._viSelections[z];if(w){delete this._viSelections[z];if(mstrApp&&mstrApp.isInVFConfigMode){return ;}F[A(this)]={_selectionType:this.getSelectionType(),_viSelections:this.getSelectionHash()};}return w;},c=function(x){var z=L.call(this,x),w=this._viContextMenuSelections[z];if(w){delete this._viContextMenuSelections[z];}return w;},j=function(){var w=A(this);o=o||{};if(F[w]){o[w]=R.clone(F[w]);}},u=function(AA,z,AE,AB,w,AD,x){var AC={};AC[AA]=[{id:z,n:AE,fm:x,ui:AB,o:w,axis:AD}];return AC;},G=mstrmojo.vi.ui.rw.SelectionType;mstrmojo.vi.ui.rw._HasVisSelections=mstrmojo.provide("mstrmojo.vi.ui.rw._HasVisSelections",{_mixinName:"mstrmojo.vi.ui.rw._HasVisSelections",init:function(w){if(this._super){this._super(w);}this._viSelections={};},update:function b(x){var w=true;if(this._super){w=this._super(x);}if(!mstrApp.isInVFConfigMode){R.copy(F[A(this)],this);}if(!this.updateForInteractiveMode){j.call(this);}return w;},onSelectionChange:function J(w){if(this._super){this._super(w);}},_viSelections:{},_viContextMenuSelections:{},_selectionType:G.EMPTY,_contextMenuSelectionType:G.EMPTY,_cellSelections:[],getSelectionType:function(){return this._selectionType;},getContextMenuSelectionType:function(){return this._contextMenuSelectionType;},isSingleAttrSelection:function(){var x=null,w;if(this.getSelectionType()===G.ATTS){w=this.getSelections();if(w.length>1){return !w.some(function(z){if(!x){x=z[0].tid;return false;}return x!=z[0].tid;},this);}return true;}return false;},isSingleContextMenuAttrSelection:function(){var x=null,w;if(this.getContextMenuSelectionType()===G.ATTS){w=this.getContextMenuSelections();if(w.length>1){return !w.some(function(z){if(!x){x=z[0].tid;return false;}return x!=z[0].tid;},this);}return true;}return false;},isSingleSelection:function(){return(this._viSelections&&R.keyarray(this._viSelections).length===1);},isSingleContextMenuSelection:function(){return(this._viContextMenuSelections&&R.keyarray(this._viContextMenuSelections).length===1);},getSelectionSize:function p(){return(this._viSelections&&R.keyarray(this._viSelections).length)||0;},getCxtMnuSelectionSize:function C(){return(this._viContextMenuSelections&&R.keyarray(this._viContextMenuSelections).length)||0;},getSelectionHash:function Q(){return this._viSelections;},getContextMenuSelectionHash:function h(){return this._viContextMenuSelections;},getSelectionCache:function B(){return F[A(this)];},setSelectionCache:function V(w){F[A(this)]=w;},getPrevSelectionInfo:function I(){return o[A(this)];},getSelections:function l(){var w=[],x;R.forEach(this.getSelectionHash(),function(z){x=[];w.push(x);R.forEach(z,function(AA,AB){X.forEach(AA,function(AC){x.push({tid:AB,eid:AC.id,v:AC.n,level:AC.level});});});});return w;},getContextMenuSelections:function a(){var w=[],x;R.forEach(this.getContextMenuSelectionHash(),function(z){x=[];w.push(x);R.forEach(z,function(AA,AB){X.forEach(AA,function(AC){x.push({tid:AB,eid:AC.id,fm:AC.fm,v:AC.n,axis:AC.axis,o:AC.o,ui:AC.ui});});});});return w;},isMetricValueSelected:function r(w){return !!this._viSelections[L.call(this,w)];},isAttSelected:function S(x,w){return this.isMetricValueSelected(u(x,w));},addAttributeSelection:function f(x,w,z){if(this._selectionType!==G.ATTS){this.clearSelections();this._selectionType=G.ATTS;}var AA=u.call(this,x,w,z);K.call(this,AA);return AA[x];},addContextMenuAttributeSelection:function d(AA,z,AD,AB,w,AC,x){if(this._contextMenuSelectionType!==G.ATTS){this.clearCxtMnuSelection();this._contextMenuSelectionType=G.ATTS;}var AE=u.call(this,AA,z,AD,AB,w,AC,x);v.call(this,AE);return AE[AA];},removeAttributeSelection:function H(x,w){return m.call(this,u.call(this,x,w));},removeContextMenuAttributeSelection:function U(x,w){return c.call(this,u.call(this,x,w));},addMetricValueSelection:function k(w){if(this._selectionType!==G.METRICS){this.clearSelections();this._selectionType=G.METRICS;}K.call(this,w);},addContextMenuMetricValueSelection:function k(w){if(this._contextMenuSelectionType!==G.METRICS){this.clearCxtMnuSelection();this._contextMenuSelectionType=G.METRICS;}v.call(this,w);},addAttrOrMetricCellSelection:function s(z,x,w){this._cellSelections.push({parentElementIds:z,target:{selectionType:w?G.ATTS:G.METRICS,id:x}});},getCellSelections:function g(){var w=this;w.clearCellSelections();var x=function(AA,z){var AB=[];if(AA){while(z.hasOwnProperty("_p")){AB.push(z._p._e.id);z=z._p;}}else{var AC=w.model.getCellDataUnion(z);X.forEach(AC,function(AD){AB.push(AD.eid);});}return AB;};X.forEach(w.highlights,function(AD){var z=w.getCellForNode(AD),AE=!z.hasOwnProperty("mix")&&z._e&&!z.fi,AC=x(AE,z);if(AE){var AA=z._e.id;w.addAttrOrMetricCellSelection(AC,AA,true);}else{var AB=z._tp._e.oid;w.addAttrOrMetricCellSelection(AC,AB,false);}});return this._cellSelections;},removeMetricValueSelection:function M(w){return m.call(this,w);},removeContextMenuMetricValueSelection:function N(w){return c.call(this,w);},clearSelections:function Z(){if(this._super){this._super();}this._viContextMenuSelections={};this._contextMenuSelectionType=G.EMPTY;this._viSelections={};this._selectionType=G.EMPTY;if(typeof this.clearSelectedGraphicInfo==="function"){this.clearSelectedGraphicInfo();}},clearCxtMnuSelection:function q(){if(this._super){this._super();}this._viContextMenuSelections={};this._contextMenuSelectionType=G.EMPTY;},clearCellSelections:function O(){this._cellSelections=[];},clearSelectionsCache:function P(){F={};},clearUnitSelections:function Z(x){if(this._super){this._super();}var w={};R.forEach(this._viSelections,function(AA,z){if(R.keyarray(AA)[0]!==x){w[z]=AA;}});this._viSelections=w;},clearAllSelectionsAndHighlight:function e(){this.clearSelections(true);this.endSelections();},endSelections:function E(){if(mstrApp&&mstrApp.isInVFConfigMode){return ;}F[A(this)]={_selectionType:this.getSelectionType(),_viSelections:this.getSelectionHash()};this.raiseGraphicsSelectedEvent(this);if(this.isInFilterPanel()&&mstrApp&&mstrApp.isDossier){this.raiseGraphicsSelectionChangeEvent();return ;}this.onSelectionChange(this.getSelectionHash());},isInFilterPanel:function D(){var w=this.node&&this.node.defn;return w.iifp;},addSelectionsFromExpression:function t(z){this.clearSelections();this._selectionType=z.type;var w=this,x=function(AF){var AG=20,AD=19,AE=function(AH){return AH.nds.length===1?AG:AH.fn;},AC=function(AH){return parseInt(AH.et,10)===5||parseInt(AE(AH),10)===AD;},AA=function(AH){X.forEach(AH.es,function(AI){w.addAttributeSelection(AH.a.did,AI.v,AI.n);});},AB=function(AJ){var AI={},AH=function(AK){X.forEach(AK.es,function(AL){R.copy(u.call(w,AK.a.did,AL.v,AL.n),AI);});};if(AJ.nds){X.forEach(AJ.nds,AH);}else{if(AJ.es){AH(AJ);}}w.addMetricValueSelection(AI);};if(AC(AF)){AF={nds:[AF]};}X.forEach(AF.nds,function(AH){if(AC(AH)){if(z.type===G.ATTS){AA(AH);}else{AB(AH);}}else{x(AH);}});};x(z.data);},raiseGraphicsSelectedEvent:function n(){if(window.mstrApp&&window.mstrApp.isEmbedded){var AD=this,AC=AD.model,AB=AC&&AC.data,z=AB&&AB.k,w=AB&&AB.gts,AH=w&&w.row,AA=w&&w.col,AE=X.ensureArray(AH).concat(AA||[]),x=function(AJ){var AI;X.forEach(AE,function(AK){if(AK&&AK.id===AJ){AI=AK.n;return false;}});return AI;},AF=[],AG=this.getSelectionHash();R.forEach(AG,function(AJ){var AI=[];R.forEach(AJ,function(AM,AL){var AK=x(AL);X.forEach(AM,function(AN){AI.push({n:AK,nid:AL,v:AN.n,vid:AN.id});});});AF.push(AI);});mstrApp.raiseEvent({name:"graphicsSelected",value:{graphics:AF,vizKey:z}});}},raiseGraphicsSelectionChangeEvent:function Y(){if(mstrApp&&(typeof mstrApp.raiseEvent==="function")){mstrApp.raiseEvent({name:"graphicsSelectionChange",value:{selections:F[A(this)],vizKey:this.k}});}}});mstrmojo.vi.ui.rw._HasVisSelections.VisSelectionType=null;mstrmojo.vi.ui.rw._HasVisSelections.clearAllSelectionsCache=function W(){F={};o={};};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var I=mstrmojo.array,M=mstrmojo.hash;function J(V){if(V!==null){return(V.constructor!==Array)?[V]:V;}return null;}function F(f,d,Z){if(!d){return null;}var g=[],W=f.selectedIndices,V=f.allIdx,b=f.noneIdx;if(f.multiSelect&&(b>-1)&&(I.indexOf(d,b)>-1)){return g;}var Y,a,e=f.items,c=f.itemIdField,X=f.selectedItems,j;if(f.multiSelect&&(V>-1)&&(I.indexOf(d,f.allIdx)>-1)){for(Y=0,a=e.length;Y<a;Y++){if(!W[Y]){g.push(Y);W[Y]=true;f.selectedIndex=Y;f.selectedItem=e[Y];}}}else{for(Y=0,a=d.length;Y<a;Y++){var h=d[Y];if(!W[h]){W[h]=true;if(Z){g.push({idx:h,positions:Z});}else{g.push(h);}f.selectedIndex=h;j=f.selectedItem=e[h];if(X){X[j[c]]=j;}}}}return g;}function D(Y,V){var X=[],Z=Y.selectedIndices,a=Y.selectedItems,W;for(W in Z){delete Z[W];if(V){X.push({idx:parseInt(W,10),positions:V});}else{X.push(parseInt(W,10));}}Y.selectedIndex=-1;Y.selectedItem=null;if(a){Y.selectedItems={};}return X;}function U(f,e,Z){if(!e){return null;}var b=[],W=f.selectedIndices,h=I.indexOf,V=f.allIdx,c=f.noneIdx,d=f.itemIdField,X=f.selectedItems;if(f.multiSelect&&(((V>-1)&&(h(e,V)>-1))||((c>-1)&&(h(e,c)>-1)))){return D(f);}if(e.length>0&&W[V]){if(h(e,V)<0){e.push(V);}}var a=e.length,Y;for(Y=0;Y<a;Y++){var g=e[Y];if(W[g]){delete W[g];if(Z){b.push({idx:g,positions:Z});}else{b.push(g);}if(X){delete X[f.items[g][d]];}if(f.selectedIndex===g){f.selectedIndex=-1;f.selectedItem=null;}}}return b;}function C(Y,Z,W,V){if(V){return ;}if(this.raiseEvent){if((Y&&Y.length)||(Z&&Z.length)){try{this.raiseEvent({name:"selectionChange",added:Y,removed:Z});}catch(X){U(this,Y);F(this,Z);throw X;}}}}function B(W){var X=this.itemIdField,V=this.items;if(typeof W==="object"&&X){return I.find(V,X,W[X]);}return I.indexOf(V,W);}mstrmojo._ListSelections={multiSelect:false,allIdx:-1,noneIdx:-1,itemIdField:"",items:null,selectedIndices:null,selectedIndex:-1,selectedIndices_bindEvents:"selectionChange",selectedIndex_bindEvents:"selectionChange",selectedItem:null,selectedItem_bindEvts:"selectionChange",allowUnlistedValues:true,selectedItems:null,supportsIncFetch:false,init:function(V){this._super(V);if(this.supportsIncFetch&&this.itemIdField){this.selectedItems={};}if(!this.items){this.items=[];}if(!this.selectedIndices){this.selectedIndices={};if(this.selectedIndex>-1){this._set_selectedIndex("selectedIndex",this.selectedIndex,true);}else{if(this.selectedItem){this._set_selectedItem("selectedItem",this.selectedItem,true);}}}},addItems:function K(e){e=J(e);if(!e){return ;}var b=this.items,V=this.items.length,X=this.selectedItems,Z=[],W;b=this.items=b.concat(e);W=b.length;if(X){var a=this.itemIdField,Y,d;for(Y=V;Y<b.length;Y++){d=b[Y];if(X[d[a]]){Z.push(Y);}}}if(Z&&Z.length){F(this,Z);}if(W>V){var c=this.itemsContainerNode;if(c){c.innerHTML+=this._buildItemsMarkup(V,W-1).join("");}}},addSelectedItems:function S(V){this.selectItems(V,false);},setSelectedItems:function L(V){this.selectItems(V,true);},selectItems:function R(d,f){d=J(d);if(!d){return ;}if(f&&this.selectedItems){this.selectedItems={};}var X=this.selectedItems,b=this.itemIdField,V=[],Z=this.items.length,a=[],W=this.allowUnlistedValues,e,c,Y;for(Y=0;Y<d.length;Y++){e=d[Y];c=B.call(this,e);if(c<0){if(X===null){if(W){V.push(e);c=Z++;a.push(c);}}else{X[e[b]]=e;}}else{a.push(c);}}if(V.length>0){this.addItems(V);}if(a.length>0){if(f){this.select(a);}else{this.addSelect(a);}}},unselectItems:function A(W){W=J(W);if(!W){return ;}var b=this.selectedItems,X=[],a=this.itemIdField,Z,V,Y;if(b===null){return ;}for(Y=0;Y<W.length;Y++){Z=W[Y];if(b){delete b[Z[a]];}V=B.call(this,Z);if(V<0){X.push(V);}}if(X.length>0){this.removeSelect(X);}},getSelectedItems:function G(){if(this.selectedItems){return M.valarray(this.selectedItems);}return I.get(this.items,M.keyarray(this.selectedIndices,true));},singleSelect:function(W,X,V){if(W!==-1){this.select([W],X,V);}},singleSelectByField:function O(W,X,V){this.singleSelect(I.find(this.items,X,W),V);},toggleSelect:function Q(V){var X,W;if(this.selectedIndices[V]){W=U(this,[V]);}else{X=F(this,[V]);}C.call(this,X,W,[V]);},select:function(X,W,V){X=J(X);if(!X){return ;}var Z=D(this,V),b=F(this,X,V),Y;if(this.selectionPolicy!=="reselect"){for(Y=Z.length-1;Y>=0;Y--){var a=I.indexOf(b,Z[Y]);if(a>-1){Z.splice(Y,1);b.splice(a,1);}}}C.call(this,b,Z,X,W);},rangeSelect:function H(W,V){var b=this.selectedIndex,Z=b,a=this.allIdx,X=[],Y;if(W===a||this.selectedIndices[a]){X.push(a);}else{if(Z===-1&&this.selectedIndices){for(Y in this.selectedIndices){Z=parseInt(Y,10);break;}}Z=Z===-1?0:Z;if(Z>W){Z=W;W=b;}for(Y=Z;Y<=W;Y++){X.push(Y);}}this.select(X,V);this.selectedIndex=b;},clearSelect:function(V){C.call(this,null,D(this),[],V);if(!V){this.raiseEvent({name:"clearSelection"});if(this.parent){this.parent.raiseEvent({name:"clearSelection"});}}},addSelect:function(Y,V,W){Y=J(Y);if(!Y){return ;}var X=F(this,Y,W),a=null,Z=this.noneIdx;if(this.multiSelect&&(Z>-1&&I.indexOf(Y,Z)>-1)){a=U(this,Y);}C.call(this,X,a,Y,V);},removeSelect:function(X,V,W){X=J(X);if(!X){return ;}C.call(this,null,U(this,X,W),X,V);},_set_selectedIndices:function P(X,d,V){if(this.selectedItems){this.selectedItems={};}var W=this.selectedIndices;if(W===d){return false;}if(!W){W={};this.selectedIndices=W;}if(!d){d={};}var b=this.selectedIndex,a=[],c;for(c in W){if(!d[c]){c=parseInt(c,10);delete W[c];a.push(c);if(b===c){this.selectedIndex=-1;this.selectedItem=null;}}}var g=[],e=this.items,Z=this.itemIdField,f;for(c in d){if(!W[c]){c=parseInt(c,10);W[c]=true;g.push(c);this.selectedIndex=c;f=this.selectedItem=e[c];if(this.selectedItems){this.selectedItems[f[Z]]=f;}}}if(V!==true){var Y=[];for(c in d){if(W[c]){c=parseInt(c,10);Y.push(c);}}C.call(this,g,a,Y);}return(g.length||a.length);},_set_selectedIndex:function N(Y,W,V){var X={};if(W>-1){X[W]=true;}return this._set_selectedIndices("selectedIndices",X,V);},_set_selectedItem:function E(Y,X,W){var V=B.call(this,X);if((V<0)&&(X!==null&&X!==undefined)&&this.allowUnlistedValues&&this.items){this.set("items",this.items.concat(X));V=this.items.length-1;}return this._set_selectedIndex("selectedIndex",V,W);},_addSelections:function(V){return F(this,V);},_removeAll:function(){return D(this);}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var F=mstrmojo.array;mstrmojo._IsPanelStack=mstrmojo.provide("mstrmojo._IsPanelStack",{_mixinName:"mstrmojo._IsPanelStack",TTL_SRC_PANEL:0,model:null,selectedIdx:undefined,init:function K(P){this._super(P);var O=this.defn;if(!O){O=this.defn=this.node&&this.node.defn;this.titleSrc=this.titleSrc||O.ttlSrc;}var N=this.selectedKey=this.defn.selKey=this.node.data.selKey;this.set("selectedIdx",F.find(this.node.data.panels,"k",N));O.attachEventListener("selKeyChange",this.id,function(Q){this.set("selectedKey",Q.value);});},addChildren:function M(P,W,U){var V=this.getFormats(),R=V&&V.overflow,Q=P.length,S;for(S=0;S<Q;S++){var O=P[S],X=O.k;if(X){O.selected=O.visible=X===this.selectedKey;if(R){var N=O.getFormats()||O.createEmptyFormats();if(N){N.overflow=R;}}}}return this._super(P,W,U);},refresh:function G(){if(this.hasRendered){var N=this.defn.newSelKey||this.selectedKey,P=this.selectedVisFilterContainerKey,O;F.forEach(this.children,function(R){var Q=R.k;if(Q){R._delayRefresh=(Q!==N);O=mstrApp.isInVFConfigMode&&Q===P;if(!R._delayRefresh&&!O){R.refresh();}}});}delete this.defn.newSelKey;},selectPanel:function B(O,P,N){var Q=this.model.getDataService(),R=Q.newUpdateWithoutCmd();this.selectPanelDeferred(R,O,P,N);if(R.actions&&R.actions.length>0){Q.addSuppressData(R.extras);R.submit();}},selectPanelDeferred:function(Q,O,P,N){if(O!==this.selectedKey){this.defn.set("selKeyChange",O);this.model.selectPanelDeferred(Q,this.k,O,this.node.data.wid,P,N);}},onselectedKeyChange:function L(O){var P=0,S,N,Q;F.forEach(this.children||this.node.data.panels,function(V,U){var W=V.k;if(W){if(O.value===W){N=V;Q=U-P;if(V.set){V.set("visible",true);V.set("selected",true);}}else{if(O.valueWas===W){S=V;if(V.set){V.set("selected",false);V.set("visible",false);}}}if(N&&S){return false;}}else{P++;}return true;});if(this.titleSrc===this.TTL_SRC_PANEL&&this.title){var R=N&&N.title;this.set("title",R);this.defn.ttl=R;}this.prevSelectIdx=this.selectedIdx;this.set("selectedIdx",Q);this.raiseEvent({name:"panelSelected",key:N.k});return{on:N,off:S};},getSelectedPanel:function D(){var N=0,O=this.selectedIdx,P;F.forEach(this.children,function(R,Q){if(R.k){if(Q-N===O){P=R;return false;}}else{N++;}return true;});return P;},setDirtyChildren:function I(N){var O=this.selectedKey;F.forEach(this.children,function(Q){var P=Q.k;if(P){Q[((N||P!==O)?"add":"remove")+"DirtyKey"](P);}});},clearDirtyChild:function J(P){var O=this.children,N=O[F.find(O,"k",P)];if(N){N.removeDirtyKey(N.k);}},isPanelStack:true,checkRequiredObjects:function C(){var N=this.txWidgets||{},O=true,P;for(P in N){O&=!!N[P].checkRequiredObjects();}return O;},isAutoApply:function E(){return this.defn.cas;},updateSelectedIdx:mstrmojo.emptyFn,unrender:function H(N){delete this.defn.newSelKey;this._super(N);},switchToPanel:function A(N,O){if(O!==undefined){this.set("selectedIdx",O);}else{this.updateSelectedIdx(N);}this.children[this.selectedIdx]&&this.selectPanel(this.children[this.selectedIdx].k);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");var H=mstrmojo.array,B=mstrmojo.hash,J=B.isEmpty;var G=1;function D(Q){return(typeof Q==="object")?Q:{};}function E(R,Q){B.forEach(Q,function(S,W){var U=R[W];if(U===undefined){delete Q[W];return true;}S=Q[W]=D(S);U=R[W]=D(U);if(J(S)&&J(U)){throw (G);}else{if(J(U)){delete R[W];if(J(R[W])){E(R,Q);}}else{if(J(S)){delete R[W];if(J(R[W])){E(R,Q);}}else{try{E(R[W],Q[W]);}catch(V){switch(V){case G:R[W]=Q[W]={};break;}}}}}});}function I(Q){B.forEach(Q,function(R){B.forEach(R,function(V,S){var U=V.include,X=V.exclude;if(J(U)||J(X)){return true;}if(!J(U)&&!J(X)){try{E(X,U);}catch(W){switch(W){case G:R[S]={};break;}}}});});return Q;}function F(S,R,Q){B.forEach(S,function(V,U){if(V===true||J(V)){Q.push(R+U);}else{F(V,R+U+".",Q);}});return Q;}function P(Q){B.forEach(Q,function(R){B.forEach(R,function(V,S){var U=[];F(V.include,"",U);F(V.exclude,"!",U);R[S]=U.join(";");});});return Q;}function K(Q,R){B.forEach(Q,function(S,V){var U=R[V];if(U!==undefined){if(S!==true&&U!==true){K(S,U);}else{if(S===true&&U!==true){R[V]=true;}else{if(S!==true&&U===true){Q[V]=true;}}}}});}function L(R,S){var Q=true;B.forEach(R,function(Z,U){var X=S[U];if(X){var V=Z.include,a=Z.exclude,Y=X.include,W=X.exclude;if(!J(W)&&!J(a)){Q=false;return Q;}if(!J(Y)&&!J(V)){K(Y,V);}}return Q;});return Q;}function C(S,Q){Q=Q||{};if(S){var R=Q;H.forEach(S.split("."),function(X,V,U,W){R[X]=W?true:{};R=R[X];});}return Q;}mstrmojo.rw.model.RetrievalKeysConfig=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.rw.model.RetrievalKeysConfig",init:function M(){this.nodes=[];this.filters={};},addNode:function A(R,U){var S=this.filters,Q=S[R];if(!Q){this.nodes.push(R);Q=S[R]={data:{},defn:{}};}if(U){if(L(Q,U)){S[R]=B.mergeHashes(Q,U);}else{throw ("The new filters for node key ## cannot be merged with the filters currently defined".replace("##",R));}}return this;}});mstrmojo.rw.model.RetrievalKeysConfig.getConsolidatedConfig=function O(U){var Q={},V={},S={};H.forEach(U,function R(X){var W=X.partialRetrieval;if(W){H.forEach(W.nodes,function(Y){V[Y]=true;});S=B.mergeHashes(S,W.filters);delete X.partialRetrieval;}H.forEach(X.actions,R);});if(!J(V)){Q.nodes=B.keyarray(V);}if(!J(S)){Q.filters=P(I(S));}return Q;};mstrmojo.rw.model.RetrievalKeysConfig.parseResponseFilters=function N(R){var Q=function(U){var S={};B.forEach(U,function(X,W){var V=S[W]={serialized:X,include:{},exclude:{}};H.forEach(X.split(";"),function(Z){var Y=Z.indexOf("!")===0;Z=Y?Z.slice(1):Z;C(Z,Y?V.exclude:V.include);});});return S;};return{data:Q(R.data),defn:Q(R.defn)};};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var G=function(X){var W=(mstrApp.docModelData&&mstrApp.docModelData.mid)||"";return X.k+"-"+W;},O={},K=mstrmojo.array;mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights",{_mixinName:"mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights",postBuildRendering:function J(){this._super();this.setup();this.initialHighlight();},initialHighlight:function B(){if(!this.getExp()){if(O[G(this)]){this.highlight.apply(this,O[G(this)]);}else{if(this.isVisMap){this.highlight("allLayers",this.genSelectionMapping(),true);}else{this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}}}},getExp:function(){var W=this.model.data,X=W&&W.sc&&W.sc.exp;return X;},clearsBrushingOnHighlight:true,brushSub:null,clearSub:null,getAssociatedNodes:function V(){var W=this.defn&&this.defn.an;return W&&W.length>0?W:[];},hasAssociatedNodes:function M(){var W=this.getAssociatedNodes();return W.length>0;},getDocModelForEvent:function H(){return this.model&&this.model.docModel;},setup:function Q(){var W=this.getDocModelForEvent(),X=this.id;if(W){[this.brushSub,this.clearSub].forEach(function(Y){if(Y){Y.clear();}});this.brushSub=W.attachEventListener("brushing",X,this.onBrushing);this.clearSub=W.attachEventListener("clearBrush",X,this.onClearBrushing);}},handlesMultiSelection:function F(){return(this._super&&this._super())||this.getAssociatedNodes().length>0;},getHighlightKeys:function P(){var X=[],W=this.getAssociatedNodes();W.forEach(function(Y){X.push(Y.k);});return X;},onSelectionChange:function L(W){var X=false;if(this._super){X=this._super(W);}return this.clearHighlightForSelectionChange(X);},onContextMenuSelectionChange:function I(W){var X=false;if(this._super){X=this._super(W);}return this.clearHighlightForSelectionChange(X);},clearHighlightForSelectionChange:function U(X){var W=this.getDocModelForEvent();if(this.clearsBrushingOnHighlight){W.raiseEvent({name:"clearBrush",from:this});}if(this.handlesMultiSelection()&&!X){W.raiseEvent({name:"brushing",from:this,keys:this.getHighlightKeys()});return true;}return false;},onBrushing:function A(X){var W=X.keys.slice();if(W.indexOf(this.k)!==-1){if(this.highlight){var Y=X.from;this.highlight(Y.getSelectionType(),Y.getSelectionHash());W.push(Y.k);this.getDocModelForEvent().raiseEvent({name:"clearBrush",from:this,excludeKeys:W});}else{throw new Error(this.scriptClass+" must implement highlight method.");}}},onClearBrushing:function S(X){var W=false;if(K.indexOf(X.excludeKeys,this.k)===-1){if(this._super){W=this._super(X);}if(!W){var Y=this.getAssociatedNodes();if(K.find(Y,"k",X.from.k)!==-1){this.clearSelections(true);}}}return true;},highlight:function E(){O[G(this)]=arguments;if(this._super){this._super.apply(this,arguments);}},clearSelections:function C(){delete O[G(this)];if(this._super){this._super.apply(this,arguments);}},clearCxtMnuSelection:function D(){if(this._super){this._super.apply(this);}},clearHighlightsCache:function R(){delete O[G(this)];},updateAssociatedNodesOnMove:function N(){this.clearSelections(true);this.endSelections();if(this.isLinkedFilter&&this.isLinkedFilter()){return ;}delete this.defn.an;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var B=mstrmojo.array;function A(C){if(C.parent){if(C.parent.shouldEllipsizeChildren===undefined){mstrmojo.mixin(mstrmojo._HasEllipsis,C.parent);}C.parent.set("shouldEllipsizeChildren",true);}}mstrmojo._HasEllipsis=mstrmojo.provide("mstrmojo._HasEllipsis",{shouldEllipsize:false,shouldEllipsizeChildren:false,doEllipsize:function(){if(this.shouldEllipsizeChildren){B.forEach(this.children,function(D,C){if(D.hasRendered&&D.doEllipsize){D.doEllipsize();}});}},onshouldEllipsizeChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsize,this.shouldEllipsizeChildren);},onshouldEllipsizeChildrenChange:function(){this._onEllipsizeFlagChange(this.shouldEllipsizeChildren,this.shouldEllipsize);},_onEllipsizeFlagChange:function(D,C){if(D&&!C){A(this);this.markupMethods=mstrmojo.mixin({onvisibleChange:function(){if(this._super){this._super();}if(this.visible&&this.hasRendered){this.doEllipsize();}}},mstrmojo.hash.copy(this.markupMethods));}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array,B=mstrmojo.hash;mstrmojo.models.datasets.DataInterface=mstrmojo.provide("mstrmojo.models.datasets.DataInterface",{getFormsByAttrId:function A(F,E){var D=[];E=E||[];B.forEach(E,function(G){C.forEach(G.att||[],function(H){if(H.did===F){D=D.concat(H.fs||[]);return false;}});});D=C.filter(D,function(G){return !!G.obf;});return C.distinct(D,"fid");}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");var C=mstrmojo.hash,E=mstrmojo.array;function D(F){return function(G){F[G]=true;};}mstrmojo.rw.model.UpdateKeysConfig=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.rw.model.UpdateKeysConfig",init:function B(){this.nodes=[];this.selectors={};this.objects={};}});mstrmojo.rw.model.UpdateKeysConfig.getConsolidatedConfig=function A(J){var F={},K={},G={},I={};E.forEach(J,function H(M){var L=M.partialUpdate;if(L){E.forEach(L.nodes,D(K));E.forEach(L.selectors,D(G));E.forEach(L.objects,function(N){if(!I[N.id]||N.flag>I[N.id].flag){I[N.id]=N;}});delete M.partialUpdate;}E.forEach(M.actions,H);});if(!C.isEmpty(K)){F.nodes=C.keyarray(K);}if(!C.isEmpty(G)){F.selectors=C.keyarray(G);}if(!C.isEmpty(I)){F.objects=C.valarray(I);}return F;};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.array");var D=mstrmojo.dom,G=mstrmojo.array;function F(P){var O=this.model,N=O.data.gts,Q=O.getCellTitleInfo(P).title,S=[],M=[],L=[];function R(U){L.push(U);(U.ch||[]).forEach(function(V){R(V);});}if(N){S=G.filterOne(N.row.concat(N.col),function(U){return U.id===Q.id;}).es;S.forEach(function(U){delete U.ch;});S.forEach(function(W,U,X){var V=X[W.p_index];if(O.compareElementsId(W.id,P._e.id)){M.push(W);}if(V){if(V.ch){V.ch.push(W);}else{V.ch=[W];}}});M.forEach(function(U){R(U);});}return L;}mstrmojo.vi.ui.rw._XtabRA=mstrmojo.provide("mstrmojo.vi.ui.rw._XtabRA",{_mixinName:"mstrmojo.vi.ui.rw._XtabRA",_highlightTimer:null,highlightRAcells:function J(M,L){var N=this;if(this.allowRAcellsHighlight()){return ;}this.resetRAcellsHighlight();this.highlightGroupCells(this.getRACellGroups(M));if(L){this._highlightTimer=window.setTimeout(function(){N.clearGroupHighlights();},1000);}},resetRAcellsHighlight:function I(){if(this.allowRAcellsHighlight()){return ;}if(this._highlightTimer){window.clearTimeout(this._highlightTimer);this._highlightTimer=null;}this.clearHighlights();},allowRAcellsHighlight:function H(){return D.isIE||D.isIEW3C;},onclick:function K(N){var S=N.getTarget&&N.getTarget();if(S&&S.hasAttribute("rabtn")){var Q=this,O=this.model,M=S&&D.findAncestorByName(S,"td",true,this.viewport),P=this.getCellForNode(M);this.highlightRAcells(P);var R=O.getRAExpandAction(P,this.sid),L={success:function(){Q.highlightRAcells(P,true);}};if(this.isCustomSort){this.delegateToActionMgr(R,this.getCallbackForRACollapseExpand(P));}else{this.controller.submitTemplateUpdates(this,R,L,null,null,true);}}else{this._super(N);}},raExpandAll:function C(M,N){var L=this.model.getRAExpandAllAction(M.id,N);if(this.isCustomSort){this.delegateToActionMgr(L);}else{this.controller.submitTemplateUpdates(this,L,null,null,null,true);}},raExpandDescendants:function A(M){var L=this.model.getRAExpandAction(M,this.sid,true);if(this.isCustomSort){this.delegateToActionMgr(L,null,null,{needDataReady:true});}else{this.controller.submitTemplateUpdates(this,L,null,null,null,true);}},getRACellGroups:function B(O){var N=this.model,Q=N.getCellTitleInfo(O).title,P=[],L=[],M=F.call(this,O);G.forEach(this.interactiveCellsArray,function(R){var U=R._e&&R._e.id,S=U&&!R.hasOwnProperty("mix")&&R.fi===undefined;if(S&&N.getCellTitleInfo(R).title.id===Q.id){if(N.compareElementsId(U,O._e.id)||G.find(M,"id",U)===-1){if(P.length>0){L.push(P);P=[];}}if(G.find(M,"id",U)>-1){P.push(R);}}});if(P.length>0){L.push(P);}return L;},getAncestors:function E(N,U){var R=this,U=U||G.map(R.selCells,function(W){return R.getCellForNode(W);}),L=this.model.data.gts,S=G.filterOne(L.row.concat(L.col),function(W){return W.id===N;}).es,V=[],M=U[0]&&U[0].lv||0,Q,P,O=0;U.forEach(function(W,X){Q=W.idx;while(Q>=0){if(X>0){P=V.indexOf(Q);if(P>=0){O=Math.max(O,P);break;}}else{V.push(Q);}Q=S[Q].p_index;}});return G.map(G.get(S,V.slice(O)),function(X,W){var Y=X.id.substring(1).split(";");return{id:Y[1]+":"+Y[0],n:X.n,level:M-O-W};});}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array");var H=mstrmojo.array,G=mstrmojo.dom;mstrmojo._IsDocXtab={_mixinName:"mstrmojo._IsDocXtab",isDocXtab:true,formatHandlers:{domNode:["RW","T","font"],msgNode:["height","background-color"],viewport:["D","background-color","B","fx"]},preBuildRendering:function B(){var I=this.getFormats(),L="",K=function K(M){if(I[M]){var N=this[M]||I[M];this[M]=N;if(this.isFullScreenWidget){I[M]=N;}this[M+"Limit"]=parseInt(N,10);}};K.call(this,"height");K.call(this,"width");var J=function(P,O){var M=I[P];if(M&&M.charAt(M.length-1)!=="%"){var N=parseInt(M,10);if(!isNaN(N)){if(O){N-=O;}L+=P+":"+N+"px;";}}return null;};J("height",0);J("width",0);this.scrollboxNodeCssText=L;return this._super();},postBuildRendering:function D(){var J=this._super();var I=this.gridData;if((I.afw||I.afc)&&this.hasCustomScrollbar&&!this.node.data.eg&&this.scrollboxNode.firstChild){this.scrollboxNode.firstChild.style.width=this.getFormats().width;}return J;},resize:function A(){this.clearCache();var K=this.getFormats(),J=parseInt(K.height,10),I=parseInt(K.width,10);if(I>0&&J>0){if(!this.visible&&this.forcedHidden){this.set("visible",true);this.forcedHidden=false;}H.forEach([this.scrollboxNode,this.viewport],function(M){var L=M.style;L.height=J+"px";L.width=I+"px";});if(this.scrollboxNode){this.scrollboxHeightFixed=J&&(J!=="auto");if(this.scrollboxHeightFixed){this.scrollboxHeight=parseInt(J,10);this.heightLimit=this.scrollboxHeight;this.scrollboxBottom=this.scrollboxTop+J;}if(I>0){this.widthLimit=I;}if(this.lockHeadersCase){this.resizeScrollBox(G.isIE);}}this.delegateGridAction(function(L){if(L&&L.onscroll){L.onscroll();}},"scrollOnResize");if(!(this.gridData&&this.gridData.eg!==undefined)){this.onGridWidthChanged();this.refreshResizeHandlers();}if(this.lockHeadersCase){this._refreshClonedNodes();}}else{if(this.visible){this.set("visible",false);this.forcedHidden=true;}}},renderPortalState:function E(){this.clearCache();this.unrender();this.render();},unrender:function F(I){this.clearCache();if(this._super){this._super(I);}},defaultAction:function C(N,I){if(this._super(N,I)){var M=this.model.sti,L=M&&M.titleId,K=M&&M.deselectCurrent;this._currentSelectedTD=K?undefined:N;if(L){var J=this.zone;this.delegateGridAction(function(P){var O=P.domNode,Q=O&&O.firstChild;if(!J&&Q&&(N.offsetParent===Q||N.offsetParent===O)){J=P;}},"defaultClickAction");if(J){J.clearHilites(L);if(!K){J.setHilites(L,N);}J.hiliteKey=L;this.model.sti=null;}}return true;}return false;}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.StringBuffer");var G=mstrmojo.dom,U=mstrmojo.hash,P=mstrmojo.array;function Y(){U.forEach(this.ifwMap,function(b){b.destroy();});this.ifwMap={};}function A(){var b=[],d=null,c=null;U.forEach(this.ifwMap,function(e){if(e.visible){b.push({psId:e.psId,psKey:e.psKey,autoCloseLocks:e.autoCloseLocks,lockInfoWinId:e.lockIW?e.lockIW.id:false,anchorPos:e.anchorPosition||G.position(e.anchor,true),anchorOrn:e.anchorOrientation});}});if(b.length>0){d=this.getSelectedLayoutWidget();c=d&&d.getScrollPos();}return{ifwRecords:b,docScrollRecord:c};}function O(k){var c=(k&&k.ifwRecords)||[],h=k&&k.docScrollRecord,f=this.getSelectedLayoutWidget(),g=this,j={};if(c.length>0){if(h&&f){f.scrollTo(h);}var d=this.model,e=d.getCurrentLayoutKey(),b=d.getLayoutDataCache(e);P.forEach(c,function(l){if(l.lockInfoWinId){j.lockInfoWinId=l.lockInfoWinId;}var m=window.setInterval(function(){if(b[l.psId]){window.clearInterval(m);g.showInfoWindow(l.psId,l.psKey,j,null,l.anchorOrn,l.anchorPos,l.autoCloseLocks);}},10);});}}function K(){if(mstrmojo.DICPopup&&mstrmojo.DICPopup.cancel){mstrmojo.DICPopup.cancel();}}function S(){P.forEach(this.xtabStyleSheets,function(c){var b=c.parentNode;if(b){b.removeChild(c);}});}function a(c,f){var d=this.getLayout(c),b=d.docGroupBy,e=this.controller;if(b){b.set("data",f.groupbys);d.gb=f;}if(e.getPageByTree){e.getPageByTree(true);}}mstrmojo._IsRwDocument=mstrmojo.provide("mstrmojo._IsRwDocument",{_mixinName:"mstrmojo._IsRwDocument",updateXtabStyles:function M(h,d){var o=this.xtabStyleSheets&&this.xtabStyleSheets[0],n=this.styleList||{},c=function(u,s){var t;for(t in s){var r=s[t].css||"";if(s[t].app){r=(u[t]||"")+r;}u[t]=r;}return u;},p=document;if(!n[h]){n[h]=c({},this.model.getSelectedXtabStyles(h));}c(n[h],d);if(!this.xtabStyleSheets){this.xtabStyleSheets=[];o=this.xtabStyleSheets[0]=p.getElementsByTagName("head")[0].appendChild(p.createElement("style"));}var q=new mstrmojo.StringBuffer(),f,g;for(f in n){for(g in n[f]){q.append(n[f][g]);}q.append("\n");}var e=q.toString();if(o&&e){o=o.styleSheet||o;if(G.isWK){var m=o.firstChild;if(m){m.nodeValue=e;}else{o.appendChild(p.createTextNode(e));}}else{if(G.isIE6||G.isIE7||G.isIE8||G.isIE9){o.cssText=e;var l,k,b,j;for(l=1;o.rules.length===4095&&p.styleSheets.length<31;l++){k=o.rules[4094];b=new RegExp(k.selectorText,"i");j=e.search(b);if(j===-1){break;}j=e.indexOf("}",j+1);e=e.slice(j+1);if(!this.xtabStyleSheets[l]){this.xtabStyleSheets[l]=p.getElementsByTagName("head")[0].appendChild(p.createElement("style"));}o=this.xtabStyleSheets[l].styleSheet;o.cssText=e;}}else{o.innerHTML=e;}}}this.styleList=n;},postBuildRendering:function X(){var b=document.getElementsByTagName("head")[0];P.forEach(this.xtabStyleSheets,function(c){b.appendChild(c);});return this._super();},buildChildren:function B(f){var k;try{var g=this.model;if(g){var h=this.buildSubs||{},q=g.id+"-partialUpdate",c=g.id+"-rebuildLayout",n=g.id+"-updateStyles",e=g.id+"-showInfoWin",d=this.id;var l=this,p=function(){P.forEach(l.getLayouts(),function(m){if(m.k!==g.currlaykey){m.defn.loaded=false;}});};if(h[q]===undefined){var o=function b(z){var t=this.model,s=t&&t.getLayoutDataCache(t.getCurrentLayoutKey()),r=z&&z.ids;if(U.isEmpty(s)||!r){return ;}P.forEach(z&&z.tree&&z.tree.layouts,function(m){if(m.k===t.currlaykey){this.updateXtabStyles(m.k,m.xtabStyles);if(m.gbys){a.call(this,m.k,m.gbys);}return false;}return true;},this);var v=U.forEach,AA=false,w={update:r.upd,refresh:r.tgts,adjustSectionSize:r.secs};v(r.ifws,function(AC,AB){var m=mstrmojo.all[AC+"_ifw"];if(m&&m.visible){this.updateInfoWindowPS(AC,AB);}},this);v(w,function(AB,m){v(AB,function(AE,AI){var AD=mstrmojo.all[AI],AH;if(AD&&AD[m]!==undefined){var AG=s[AI],AC=(m==="update"?AG:null),AF=m;if(m==="update"){if(AD.updateForPU){AF="updateForPU";}else{AD.node=AG;}}else{if(m==="refresh"&&AD.refreshForPU){AF="refreshForPU";}}AH=AD[AF](AC);if(m==="adjustSectionSize"&&AH){AA=AA||(!!AH.heightReduced);}}},this);},this);var u=this.getSelectedLayoutWidget();if(AA){u.notifyScrollListeners();}var x=u.docLayout;if(x){x.resizeOrReposition();}if(z&&z.unloadCache){p();}};h[q]=g.attachEventListener("partialUpdate",d,o);}h[c]=h[c]||g.attachEventListener("rebuildLayout",d,function(m){var s=m&&m.restoreIW,r;if(s){r=A.call(this);this.model.aws=null;}this.onLayoutRebuilt(this.rebuildLayout(m.src.currlaykey,this.getLayouts()));if(m&&m.unloadCache){p();}if(s){O.call(this,r);}});h[n]=h[n]||g.attachEventListener("updateStyles",d,function(m){this.updateXtabStyles(m.key,m.updatedStyles);});h[e]=h[e]||g.attachEventListener("showInfoWin",d,function(m){this.showInfoWindow(m.psId,m.psKey,m.anchor,m.invalidate,m.anchorOrientation,m.anchorPosition);});this.updateXtabStyles(g.getCurrentLayoutKey());g.attachEventListener("refresh",this.id,function(){this.refresh();});}k=this._super(f);}catch(j){mstrmojo.err(j);}return k;},updateInfoWindowPS:mstrmojo.emptyFn,showInfoWindow:function J(c,t,l,n,q,r,AC){var e=this.model,h=e.getLayoutDataCache(e.getCurrentLayoutKey()),w=this.builder,b=h[c]&&h[c].defn,g=b&&b.iwpl,v=c+"_ifw",AB=mstrmojo.all[v],x=this.domNode,d=mstrmojo.DocInfoWindow.PLACEMENT.FIXED,z=function(AD,AE,AF,AH,AG){if(g===d){if(AE){var AI=G.delta(AE,x);AD.popPosition={left:(AI&&AI.x)?AH+AI.x:AH,top:(AI&&AI.y)?AG+AI.y:AG};}else{if(AF){AD.popPosition={left:(AF.scrollboxLeft)?AH-AF.scrollboxLeft:AH,top:(AF.scrollboxTop)?AG-AF.scrollboxTop:AG};}else{AD.popPosition={left:AH,top:AG};}}}};var p=this.getLayout(e.getCurrentLayoutKey());if(AB){if(n){AB.refresh();}AB.anchorOrientation=q;AB.anchorPosition=r;if(g===d){if(!AB._ifwpdn){var m=h[c]&&h[c].p,s=m&&e.getUnitInstance(m.k,m.wid);AB._ifwpdn=s&&s.domNode;}else{if(AB._ifwpdn.style.display==="none"){AB._ifwpdn=document.getElementById(AB._ifwpdn.id);}}}z(AB,AB._ifwpdn,p,AB._ifwfl,AB._ifwft);AB.open(this,{anchor:l,boundary:x});}else{var j={opener:this,anchor:l,anchorOrientation:q,boundary:x,parent:this,builder:w,model:this.model,psKey:t,psId:c,id:v,autoCloses:true,locksHover:true,closeOnClick:false,autoCloseLocks:AC,anchorPosition:r};if(g){g=parseInt(g,10);j.placement=g;if(g===d){var k=b.fmts,f=j._ifwfl=k&&k.left&&parseInt(k.left.replace("px",""),10),u=j._ifwft=k&&k.top&&parseInt(k.top.replace("px",""),10),m=h[c]&&h[c].p,s=m&&e.getUnitInstance(m.k,m.wid),o=j._ifwpdn=s&&s.domNode;z(j,o,p,f,u);}}AB=w.newInfoWindow(j);this.renderInfoWindow(AB);var AA=this.ifwMap=(this.ifwMap||{});AA[c]=AB;}},renderInfoWindow:function L(b){b.render();},_lockInfoWinContainer:function I(d){var g=this.ifwMap,c=function(h,j){return function(){h.releaseLock(j);};},b;for(b in g){var e=g[b],f=d.xtab;if(e&&f&&G.contains(e.infoNode,f.domNode,true,document.body)){e.registerLock(f);d.onClose=c(e,f);break;}}},unrender:function W(b){Y.call(this);this._super(b);S.call(this);},getLayouts:function Q(){return this._layouts;},getLayout:function V(b){b=b||this.model.getCurrentLayoutKey();var c=this.getLayouts();return c[P.find(c,"k",b)];},getSelectedLayoutWidget:mstrmojo.emptyFn,needLoadLayout:function R(b,c){return b.defn&&(c&&c.reload||(!!(c&&c.panelKey))||(b.defn.loaded===false)||(this.model.zt&&(window.mstrMobileApp!==undefined)&&(b.defn.lastOrientation!==mstrMobileApp.getOrientation())));},getNewLayout:function F(c,h,b,l,d){var g=this,e=g.model,k=c.layoutKey,f=h[P.find(h,"k",k)];if(this.needLoadLayout(f,c)){var j=l.success;l.success=function(m){e.replaceLayout(k,m,false);e.currlaykey=k;if(b){g.selectLayout(f,false,null,d);}var n=g.rebuildLayout(k,h,false);if(g.controller.getPageByTree){g.controller.getPageByTree(true);}j(n);};this.loadDocLayout(c,l,d);}else{if(b){this.selectLayout(f,true,{success:function(m){U.copyProps(["bs"],m,e);}},d);}if(!f.hasRendered){f=this.rebuildLayout(k,h);if(g.controller.getPageByTree){g.controller.getPageByTree(true);}}l.success(f);}},selectLayout:function E(e,f,h,g){var b=this.model,c=e.k,d=(c!==b.currlaykey);b.currlaykey=c;if(this.controller){this.controller.updateZoom();}this.restoreLayoutState(e);if(f&&d){this.setCurrentDocLayout(c,h,g);}else{if(h&&h.complete){h.complete();}}return e;},rebuildLayout:function C(d,l,m){var f=this.model,e=P.find,g=l[e(l,"k",d)],b=f.getChildren(this.node,false);var h=b[e(b,"k",d)];if(window.mstrMobileApp!==undefined){h.defn.lastOrientation=mstrMobileApp.getOrientation();}var j=this.replaceLayout(g,h);this.updateXtabStyles(d,f.getSelectedXtabStyles(d));if(m!==false){Y.call(this);}K();return j;},destroy:function Z(){Y.call(this);if(this._super){this._super();}S.call(this);},replaceLayout:mstrmojo.emptyFn,restoreLayoutState:mstrmojo.emptyFn,onLayoutRebuilt:mstrmojo.emptyFn,unloadGbLayuts:function H(d){var j=this.getLayouts(),f=this.model.getCurrentLayoutKey(),h,g,l,c,e,b;h=this.getLayout();c=h.gb&&h.gb.groupbys;for(e=0;e<c.length;e++){l=c[e];if(l.k===d){b=l.unit.target.did;break;}}for(g=0;g<j.length;g++){h=j[g];if(h.k===f){continue;}c=h.gb&&h.gb.groupbys;if(c&&c.length){for(e=0;e<c.length;e++){l=c[e];if(l.unit.target.did===b){h.defn.loaded=false;break;}}}}},loadDocLayout:function N(b,d,c){this.model.getDataService().loadDocLayout(b,d,c);},setCurrentDocLayout:function D(b,d,c){this.model.getDataService().setCurrentDocLayout(b,d,c);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");var B={};var E={};mstrmojo.publisher=mstrmojo.provide("mstrmojo.publisher",{publish:function F(H,Q,L){var M=B[H]&&B[H][Q],O;if(!M){return ;}for(O in M){var J=null;if(O){J=mstrmojo.all[O];if(!J){delete M[O];continue;}}var R=M[O].methods;if(R){var P=J||mstrmojo.global,I;for(I in R){if(P[I]){P[I](L);}}}var N=M[O]&&M[O].functions,S=(N&&N.length)||0;if(S){var K;if(J){for(K=S-1;K>-1;K--){if(N[K]){N[K].apply(J,[L]);}}}else{for(K=S-1;K>-1;K--){if(N[K]){N[K](L);}}}}}},subscribe:function D(I,N,R,J){var S=B[I];if(!S){S={};B[I]=S;}var M=S[N];if(!M){M={};S[N]=M;}var K=M[J||""];if(!K){K={};M[J||""]=K;}if(typeof R==="function"){var L=K.functions;if(!L){L=[];K.functions=L;}L.push(R);}else{var H=K.methods;if(!H){H={};K.methods=H;}H[R]=true;}var Q=E,P=Q[J||""];if(!P){P={};Q[J||""]=P;}var O=P[I];if(!O){O={};P[I]=O;}O[N]=true;return{id:I,type:N,callback:R,listener:J,clear:function(){mstrmojo.publisher.unsubscribe(this);}};},unsubscribe:function C(I){var R=B[I.id],O=R&&R[I.type],L=O&&O[I.listener||""];if(!L){return ;}var K=mstrmojo.array,Q=mstrmojo.hash,P=typeof I.callback,M=false;if(P==="function"){var N=L.functions;if(N){K.removeItem(N,I.callback);if(!N.length){delete L.functions;if(Q.isEmpty(L.methods)){M=true;}}}}else{var J=L.methods;if(J){delete J[I.callback];if(Q.isEmpty(J)){delete L.methods;if(!L.functions||!L.functions.length){M=true;}}}}if(M){delete O[I.listener||""];if(Q.isEmpty(O)){delete R[I.type];}}},hasSubs:function G(K,J){var I=B[K],H=I&&I[J];return !!H;},clearSubscriptions:function A(I){if(!I){I="";}var P=B,M=mstrmojo.hash,H;if(P[I]){delete P[I];}var O=E[I];if(O){for(H in O){var N=P[H],L=O[H],K;if(!N){continue;}for(K in L){var J=N[K];if(!J){continue;}delete J[I];if(M.isEmpty(J)){delete N[K];}}}}delete E[I];}});mstrmojo.publisher.NO_SRC="NO_SRC";mstrmojo.publisher.CONNECTIVITY_CHANGED_EVENT="CONNECTIVITY_CHANGED";mstrmojo.publisher.RECONCILE_END_EVENT="RECONCILE_END";}());(function(){mstrmojo.requiresCls("mstrmojo.array");var A=mstrmojo,D=A.array;mstrmojo.vi.util.TemplateUtils=mstrmojo.provide("mstrmojo.vi.util.TemplateUtils",{getTemplateUnits:function B(F){var E=[].concat(F.mx);(F.rows||[]).concat(F.cols||[]).forEach(function(G){if(G.did!=="-1"){E.push({did:G.did,t:G.t,n:G.n});}});return E;},findUnitsById:function C(H,F){var E=mstrmojo.vi.util.TemplateUtils.getTemplateUnits(H),G=[];D.ensureArray(F).forEach(function(K){var J=D.find(E,"did",K),I=J>-1?E[J]:null;if(I){G.push(I);}});return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var E=mstrmojo.array;mstrmojo._BindTargetChildren=mstrmojo.provide("mstrmojo._BindTargetChildren",{target:null,targetProps:null,addTabButtons:null,removeTabButtons:null,clearButtons:null,ontargetChange:function D(L){var M=L&&L.valueWas;if(M){var J=this._targetSubs;if(J){M.detachEventListener(J.add);M.detachEventListener(J.rem);M.detachEventListener(J.sel);}this.clearButtons();}var N=this.target;if(N){var I=this.targetProps,H=(I&&I.children)||"children",F=N[H];this.addTabButtons(F,0);this._onTargetSelChg();if(N.attachEventListener){var G=this.id,K="attachEventListener";this._targetSubs={add:N[K]("addChild",G,"_onTargetAddChild"),rem:N[K]("removeChild",G,"_onTargetRemoveChild"),sel:N[K]("selectedChange",G,"_onTargetSelChg")};}}this._ontargetChange();},_ontargetChange:mstrmojo.emptyFn,_onTargetAddChild:function A(F){var G=F&&F.value;if(G&&G.length){this.addTabButtons(G,F.index);}this._postTargetAddChild();},_postTargetAddChild:mstrmojo.emptyFn,_onTargetRemoveChild:function B(G){var F=G&&G.value,H;for(H=((F&&F.length)||0)-1;H>-1;H--){this.removeTabButton(F[H]);}this._postTargetRemoveChild();},_postTargetRemoveChild:mstrmojo.emptyFn,_onTargetSelChg:function C(L){var G=this.targetProps||{},F=this[G.names||"children"],J=function(O,P){if(O.set){O.set("selected",P);}else{O.selected=P;}};if(L){var H=L.valueWas,K=H?E.find(F,"target",H):-1;if(K>-1){J(F[K],false);}}var M=this.target,N=M&&M.selected,I=N?E.find(F,"target",N):-1;if(I>-1){J(F[I],true);}this._postTargetSelChg();},_postTargetSelChg:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var I=mstrmojo.array,Q=mstrmojo.desc(2412,"Default"),P=mstrmojo.desc(3433,"Font"),K=mstrmojo.desc(3434,"Number"),D=mstrmojo.desc(3435,"Alignment"),N=mstrmojo.desc(2886,"Borders"),E=mstrmojo.desc(3905,"Background"),R="-1,234.12",C="1,234.12",M="(1,234.12)",H="-$1,234.12",B="$1,234.12",J="($1,234.12)";var O=[{n:Q,v:"pru"}];I.forEach(["Arial","Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Bookshelf Symbol 1","Bookshelf Symbol 2","Bookshelf Symbol 3","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Open Sans SemiBold","Open Sans","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Wingdings 2","Wingdings 3"],function(S){O.push({n:S,v:S,symbolic:true});});function G(U,S,V){return(S&&S>=U)?G(U,S-V,V).concat(S):[];}var A=G(2,12,1);A=A.concat(G(14,24,2));A=A.concat(G(36,48,12));A=A.concat(G(72,72,1));var F=[{n:Q,v:"pru"}];I.forEach(A,function(S){F.push({n:String(S),v:String(S)});});mstrmojo._FormatDefinition={Formats:[{n:P},{n:K},{n:D},{n:mstrmojo.desc(3436,"Color and Lines")}],FormatTarget:[{n:mstrmojo.desc(7942,"Element Header"),v:1,p:"header_format"},{n:mstrmojo.desc(7943,"Element Value"),v:2,p:"grid_format"},{n:mstrmojo.desc(7944,"Individual Items Header"),v:3,p:"child_header_format"},{n:mstrmojo.desc(7945,"Individual Items Value"),v:4,p:"child_grid_format"}],MetricFormatTarget:[{n:mstrmojo.desc(9710,"Metric Headers"),v:1,p:"header_format"},{n:mstrmojo.desc(9711,"Metric Values"),v:2,p:"grid_format"}],MetricValueFormats:[{n:K},{n:D},{n:P},{n:N},{n:E}],MetricHeaderFormats:[{n:K},{n:D},{n:P},{n:N},{n:E},{n:mstrmojo.desc(12139,"Chart")}],NumberFormatCategory:{Automatic:-3,Default:-2,General:9,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7},DefaultFormat:{FormattingAlignment:{Horizontal:"1",Vertical:"1",TextWrap:"0",TextDirection:"0"},FormattingBorder:{HInsideStyle:"1",VInsideStyle:"1",TopStyle:"1",LeftStyle:"1",BottomStyle:"1",RightStyle:"1",HInsideColor:"0",VInsideColor:"0",TopColor:"0",LeftColor:"0",BottomColor:"0",RightColor:"0",Border3DStyle:"0",Border3DWeight:"0",Border3DBottomColor:"0",Border3DLeftColor:"0",Border3DRightColor:"0",Border3DTopColor:"0"},FormattingFont:{Name:"Arial",Bold:"0",Italic:"0",Size:"10",Strikeout:"0",Underline:"0",Color:"0",Script:"0"},FormattingNumber:{Category:"9",DecimalPlaces:"0",ThousandSeparator:"-1",CurrencySymbol:"$",CurrencyPosition:"0",Format:"General",NegativeNumbers:"3"},FormattingPadding:{LeftPadding:"1",RightPadding:"1",TopPadding:"1",BottomPadding:"1",LineSpacing:"0"},FormattingPatterns:{FillColor:"16777215",PatternColor:"8650752",PatternStyle:"1",FillStyle:"0",ApplyToGraphThreshold:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0",SelectorSelectionColor:"16167264",SelectorSelectionFillStyle:"0",SeriesFillColor:"pru",SeriesPatternColor:"8650752",SeriesPatternStyle:"1",SeriesFillStyle:"0",SeriesApplyToGraphThreshold:"0",SeriesGradientColor:"16777215",SeriesGradientAngle:"0",SeriesGradientXOffset:"0",SeriesGradientYOffset:"0",SeriesSelectorSelectionColor:"16167264",SeriesSelectorSelectionFillStyle:"0"}},Families:O,Sizes:F,SizesInVI:F.slice(7,19),Styles:[{n:Q,v:"pru"},{n:mstrmojo.desc(3440,"Regular"),v:"0,0"},{n:mstrmojo.desc(2718,"Bold"),v:"-1,0",v2:"-1,"},{n:mstrmojo.desc(2719,"Italic"),v:"0,-1",v2:",-1"},{n:mstrmojo.desc(3441,"Bold Italic"),v:"-1,-1"}],Effects:[{n:"Underline",v:0},{n:"Strike",v:1}],Category:[{n:Q,v:-2},{n:mstrmojo.desc(2378,"General"),v:9},{n:mstrmojo.desc(2050,"Fixed"),v:0},{n:mstrmojo.desc(2051,"Currency"),v:1},{n:mstrmojo.desc(2052,"Date"),v:2},{n:mstrmojo.desc(2170,"Time"),v:3},{n:mstrmojo.desc(2053,"Percentage"),v:4},{n:mstrmojo.desc(2054,"Fraction"),v:5},{n:mstrmojo.desc(2055,"Scientific"),v:6},{n:mstrmojo.desc(2056,"Custom"),v:7}],MaxNegativeDidigts:30,FixedNegative:[{n:R,v:1,f:"#,##0.00"},{n:R,r:true,v:5,f:"#,##0.00;[RED]-#,##0.00"},{n:C,r:true,v:2,f:"#,##0.00;[RED]#,##0.00"},{n:M,v:3,f:"#,##0.00;(#,##0.00)"},{n:M,r:true,v:4,f:"#,##0.00;[RED](#,##0.00)"}],CurrencyNegative:[{n:H,v:1,f:'"$"#,##0.00'},{n:H,r:true,v:5,f:'"$"#,##0.00;[RED]-"$"#,##0.00'},{n:B,r:true,v:2,f:'"$"#,##0.00;[RED]"$"#,##0.00'},{n:J,v:3,f:'"$"#,##0.00;("$"#,##0.00)'},{n:J,r:true,v:4,f:'"$"#,##0.00;[RED]("$"#,##0.00)'}],CurrencyPosition:[{n:mstrmojo.desc(2194,"Left"),v:0},{n:mstrmojo.desc(2195,"Right"),v:1},{n:mstrmojo.desc(2183,"Left with space"),v:2},{n:mstrmojo.desc(2182,"Right with space"),v:3}],Date:[{n:mstrmojo.desc(2231,"4/7"),v:"m/d"},{n:mstrmojo.desc(2232,"04/07"),v:"mm/dd"},{n:mstrmojo.desc(2233,"4/7/98"),v:"m/d/yy"},{n:mstrmojo.desc(2234,"04/07/98"),v:"mm/dd/yy"},{n:mstrmojo.desc(2235,"04/07/1998"),v:"mm/dd/yyyy"},{n:mstrmojo.desc(2236,"7-Apr"),v:"d-mmm"},{n:mstrmojo.desc(2237,"7-Apr-98"),v:"d-mmm-yy"},{n:mstrmojo.desc(2238,"Apr-98"),v:"mmm-yy"},{n:mstrmojo.desc(2239,"Apr '98"),v:"mmm 'yy"},{n:mstrmojo.desc(2240,"April 1998"),v:"mmmm yyyy"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2243,"April 7, 1998"),v:"mmmm d, yyyy"}],Time:[{n:mstrmojo.desc(2244,"15:41"),v:"h:mm"},{n:mstrmojo.desc(2245,"3:41 PM"),v:"h:mm AM/PM"},{n:mstrmojo.desc(2246,"15:41:46"),v:"h:mm:ss"},{n:mstrmojo.desc(2247,"3:41:46 PM"),v:"h:mm:ss AM/PM"},{n:mstrmojo.desc(2241,"4/7/98 15:41"),v:"m/d/yy h:mm"},{n:mstrmojo.desc(2242,"4/7/98 3:41 PM"),v:"m/d/yy h:mm AM/PM"},{n:mstrmojo.desc(2250,"04/07/98 15:41"),v:"mm/dd/yy h:mm"},{n:mstrmojo.desc(2248,"04/07/98 3:41 PM"),v:"mm/dd/yy h:mm AM/PM"}],PercentNegative:[{n:"-12.12%",v:1,f:"0.00%"},{n:"-12.12%",r:true,v:5,f:"0.00%;[RED]-0.00%"},{n:"12.12%",r:true,v:2,f:"0.00%;[RED]0.00%"},{n:"(12.12%)",v:3,f:"0.00%;(0.00%)"},{n:"(12.12%)",r:true,v:4,f:"0.00%;[RED](0.00%)"}],Fraction:[{n:"12 1/3",v:"# ?/?"},{n:"37/3",v:"?/?"},{n:"12 26/81",v:"# ??/??"},{n:"998/81",v:"??/??"}],TextDirection:[{n:Q,v:"pru"},{n:mstrmojo.desc(4601,"Horizontal"),v:0},{n:mstrmojo.desc(5156,"-90 Degree"),v:-90}],Horizontal:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2378,"General"),v:1},{n:mstrmojo.desc(2194,"Left"),v:2},{n:mstrmojo.desc(2193,"Center"),v:3},{n:mstrmojo.desc(2195,"Right"),v:4},{n:mstrmojo.desc(2068,"Justify"),v:6}],Vertical:[{n:mstrmojo.desc(2296,"Use Default"),v:"pru"},{n:mstrmojo.desc(2256,"Top"),v:1},{n:mstrmojo.desc(2067,"Center"),v:2},{n:mstrmojo.desc(2257,"Bottom"),v:3}],TextWrap:[{v:0},{v:-1}],BorderStyles:[{n:Q,v:"pru"},{n:mstrmojo.desc(2258,"None"),v:0},{n:mstrmojo.desc(2259,"Dashed"),v:3},{n:mstrmojo.desc(2260,"Dotted"),v:4},{n:mstrmojo.desc(2261,"Hair"),v:7},{n:mstrmojo.desc(2262,"Thin"),v:1},{n:mstrmojo.desc(2264,"Thick"),v:5},{n:mstrmojo.desc(15361,"Double"),v:6}],extractModel:function(V,X,U){var Z=U||this.DefaultFormat,Y;for(Y in V){var S=V[Y];if(!S.attachEventListener){if(!mstrmojo.hash.isEmpty(S)){X[Y]=S;}}else{var W;for(W in S){if(Z[Y]&&Z[Y][W]){if(!X[Y]){X[Y]={};}X[Y][W]=S[W];}}}}},getAvailableFonts:function L(){var S={success:function(V){if(V.name==="fontPicker"){var U=[{n:Q,v:"pru"}];I.forEach(V.shortcuts,function(X){var Y=X.attributes,Z=I.filterOne(Y,function(a){return a.value;}),W=I.filterOne(Y,function(a){return a.symbolic;});U.push({n:Z&&Z.value,v:Z&&Z.value,symbolic:(W&&W.symbolic||"false").toUpperCase()==="TRUE"});});mstrmojo._FormatDefinition.Families=U;}}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,S,{taskId:"getSystemPickerJson",name:"fontPicker"},false,null,true);},getStandardFormat:function(U,S){var W=mstrmojo.hash.clone(S||this.DefaultFormat),V;U=U||{};for(V in W){U[V]=U[V]||{};}for(V in U){if(!U[V].attachEventListener){U[V]=mstrmojo.hash.make(U[V],mstrmojo.Obj);}}return U;},saveFormatModel:function(X,d,U,e){var c=e||this.DefaultFormat,Z,S;for(Z=0;Z<U.length;Z++){var Y=U[Z],W=d[Y]||null,b=X[Y];if(b===undefined){delete d[Y];continue;}for(S in c){var a=c[S],V;if((!W&&!b)||(W&&!W[S]&&!b[S])){continue;}for(V in a){if(b[S]===undefined||b[S]===""||b[S][V]==="pru"||b[S][V]===undefined){if(W&&W[S]&&(W[S][V]!==undefined&&W[S][V]!==null&&W[S][V]!=="pru")){W[S][V]="pru";}}else{W=W||{};W[S]=W[S]||{};W[S][V]=b[S][V];}}}if(W){d[Y]=W;}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var E=mstrmojo.array,D=mstrmojo.hash;mstrmojo.vi.ui.rw._HasBufferSlice=mstrmojo.provide("mstrmojo.vi.ui.rw._HasBufferSlice",{_mixinName:"mstrmojo.vi.ui.rw._HasBufferSlice",_bufferedSlices:null,bufferSlice:function B(G){var F=this._bufferedSlices=this._bufferedSlices||{};if(G.ctlKey){F[G.ctlKey]=G;this.set("applyEnabled",true);}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){mstrApp.enableUpdate=true;}},getBufferedSlice:function C(F){var G=this._bufferedSlices||{};return G[F];},applyBufferedSlices:function A(H,L,G){var J=this._bufferedSlices;if(!J){return ;}var K,I;for(I in J){K=J[I]&&J[I].tks;if(K){break;}}var F={tks:K,events:J};if(H){if(G){E.forEach(this.model.buildSliceUrInfo(F).extraPuKeys,function(M){G.push(M);});}this.model.sliceDeferred(L,F);}else{this.model.slice(F);}this.clearBuffSlices();},clearBuffSlices:function(){this._bufferedSlices=null;this.set("applyEnabled",false);},clearSingleBuffSlice:function(F){var G=this._bufferedSlices;if(G&&G[F]){delete G[F];if(D.isEmpty(G)){this.set("applyEnabled",false);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var D=mstrmojo.array,B=mstrmojo.hash;mstrmojo.vi.ui.rw._IsPanelStack=mstrmojo.provide("mstrmojo.vi.ui.rw._IsPanelStack",{_mixinName:"mstrmojo.vi.ui.rw._IsPanelStack",getFormats:function A(){return{};},selectPanel:function C(H,I,G,K,J){var E=false,F=this.selectedKey;if(!K){K=this.model.getDataService().newUpdateWithoutCmd({callback:J});E=true;}this.selectPanelDeferred(K,H,I,G);this.model.getDataService().addSuppressData(K.extras);D.forEach(this.children,function(L){if(L.visible&&L.hasRendered&&L.children&&L.children.length===0){L.refresh();}});if(!G&&K.actions&&K.actions.length>0){if(E){this.controller.cmdMgr.execute({execute:function(){var L=this.urInfo,M=function(){L.extras.params.suppressData=false;}.bind(this);L=B.copy({undo:function(){L.puKeys=[F];M();},redo:function(){L.puKeys=[H];M();},},L);K.cmd=this;K.submit();},urInfo:{extras:{style:{params:{treesToRender:3}},params:{suppressData:true}}},isUntracked:mstrApp.isAppStateSelection()});}else{K.submit();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var C=mstrmojo.array;function A(E){var D=(E&&E.gts&&E.gts.col)||[],G=(E&&E.gts&&E.gts.row)||[];var F=C.filter(D.concat(G),function(H){return H.otp===-1;})[0];return{tpltProp:E.prop,mxProp:C.map((F&&F.es)||[],function(H){var I={};I[H.oid]=mstrmojo.hash.copy(H.prop,{n:H.n,t:H.otp});return I;})};}mstrmojo._IsDocumentTemplate=mstrmojo.provide("mstrmojo._IsDocumentTemplate",{_mixinName:"mstrmojo._IsDocumentTemplate",gridInfo:null,tmsProps:null,update:function B(D){if(D&&D.data){this.gridInfo=D.data.gsi;this.tmsProps=A(D.data);}if(this._super){return this._super(D);}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");var A=mstrmojo.array;mstrmojo.fe._IsRelationTreeNode=mstrmojo.provide("mstrmojo.fe._IsRelationTreeNode",{createSetHtml:'<span class="mstrmojo-textset mstrmojo-create-set-text" mstrAttach:click >'+mstrmojo.desc(12034,"Create a Set")+"</span>",syncRootOperator:function(){var F=this.parent,H=function(){var J=this.parent,I=[];if(J){I=J.ctxtBuilder.itemWidgets;}return I;},E,D,B,C,G;if(F){E=H.call(this);B=E.length;D=A.find(E,"noRelationOperator",true)!==-1;for(C=0;C<B;C++){G=E[C];G&&G.set("noRelationOperator",D);}this.set("noRelationOperator",D);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.vi.controllers.EnumEvents");var E=mstrmojo.array,A=mstrmojo.func,B=mstrmojo.vi.controllers.EnumEvents;mstrmojo.vi.controllers.ControlUtils=mstrmojo.provide("mstrmojo.vi.controllers.ControlUtils",{findNewSelectedIndex:function C(H,J,L){H.sort(function(N,M){return N-M;});var F=H.indexOf(J);var I={};E.forEach(H,function(M){I[M]=true;});var K=1;if(J+(H.length-F)===L){K=-1;}var G=J+K;while(I[G]){G+=K;}return G;},rebuildAndUpdateTOCcallback:function D(){var F=this;return A.wrapMethods(F.getRebuildCallback(),{success:function(){F.raiseEvent({name:B.UPDATE_TOC});}});}});})();(function(){mstrmojo.requiresCls("mstrmojo.array");var I="#000000",E=Math.round;function O(Z){return("0"+parseInt(Z,10).toString(16)).slice(-2);}mstrmojo.color=mstrmojo.provide("mstrmojo.color",{rgbStr2rgb:function X(Z){if(Z==="transparent"){return["0","0","0"];}else{return Z.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i).slice(1);}},rgbStr2hex:function G(Z){if(Z.indexOf("rgb")>=0){var a=this.rgbStr2rgb(Z);return"#"+this.rgb2hex(a[0],a[1],a[2]);}return Z;},rgb2hex:function B(c,a,Z){return O(c)+O(a)+O(Z);},rgb2hsv:function W(Z,j,l){var e=Math.min(Z,j,l),m=Math.max(Z,j,l),f=0,p,o;o=m/255;p=(m!==0)?(parseFloat(m)-parseFloat(e))/parseFloat(m):0;if(p===0){f=0;}else{var k=m-e,a=(m-Z)/k,c=(m-j)/k,n=(m-l)/k;if(Z===m){f=n-c;}else{if(j===m){f=2+a-n;}else{f=4+c-a;}}f=f/6;if(f<0){f=f+1;}}return[E(f*360),E(p*100),E(o*100)];},rgb2hsl:function D(Z,e,f){Z/=255;e/=255;f/=255;var j=Math.max(Z,e,f),c=Math.min(Z,e,f),a=(j+c)/2,d,m;if(j===c){d=m=0;}else{var k=j-c;m=a>0.5?k/(2-j-c):k/(j+c);switch(j){case Z:d=(e-f)/k+(e<f?6:0);break;case e:d=(f-Z)/k+2;break;case f:d=(Z-e)/k+4;break;}d/=6;}return[d,m,a];},hsl2rgb:function C(f,m,e){var d=function d(h,g,b){if(b<0){b+=1;}if(b>1){b-=1;}if(b<1/6){return h+(g-h)*6*b;}if(b<1/2){return g;}if(b<2/3){return h+(g-h)*(2/3-b)*6;}return h;},Z,j,k;if(m===0){Z=j=k=e;}else{var a=e<0.5?e*(1+m):e+m-e*m,c=2*e-a;Z=d(c,a,f+1/3);j=d(c,a,f);k=d(c,a,f-1/3);}return[E(Z*255),E(j*255),E(k*255)];},hsl2hex:function J(b,a,Z){return"#"+mstrmojo.array.map(this.hsl2rgb(b,a,Z),function(c){return O(c);}).join("");},hex2rgb:function Q(c){var Z=this.fixFullHexValue("#"+c.replace("#","")),a=[],b;Z=Z.replace("#","");for(b=0;b<3;b++){a.push(parseInt(Z.substr(b*2,2),16));}return a;},hex2bgr:function L(Z){return this.hex2rgb(Z).reverse();},hex2hsv:function U(a){var Z=this.hex2rgb(a);return this.rgb2hsv(Z[0],Z[1],Z[2]);},hex2hsl:function Y(Z){return this.rgb2hsl.apply(this,this.hex2rgb(Z));},hsv2rgb:function H(k,w,o){k=k/360;w=w/100;o=o/100;var Z,l,n;if(w===0){Z=o*255;l=o*255;n=o*255;}else{var d=k*6;if(d===6){d=0;}var j=Math.floor(d);var c=o*(1-w);var a=o*(1-w*(d-j));var u=o*(1-w*(1-(d-j)));var m,e,f;switch(j){case 0:m=o;e=u;f=c;break;case 1:m=a;e=o;f=c;break;case 2:m=c;e=o;f=u;break;case 3:m=c;e=a;f=o;break;case 4:m=u;e=c;f=o;break;default:m=o;e=c;f=a;break;}Z=m*255;l=e*255;n=f*255;}return[E(Z),E(l),E(n)];},hsv2hex:function M(c,b,Z){var a=this.hsv2rgb(c,b,Z);return this.rgb2hex(a[0],a[1],a[2]);},getContrastingColor:function N(c,a,Z){var b=this.hex2rgb(c);return(((b[0]*299)+(b[1]*587)+(b[2]*114))/1000<125)?a:Z;},getLuminance:function F(a){var Z=this.hex2rgb(a);return 0.2126*Z[0]+0.7152*Z[1]+0.0722*Z[2];},getHighlightColor:function S(j,f){var Z,h,k,l,m=this.hex2rgb(!f?"#FFCE7F":"#EFE6D8"),e=parseInt(j[0],10),c=parseInt(j[1],10),o=parseInt(j[2],10),d=parseInt(m[0],10),a=parseInt(m[1],10),n=parseInt(m[2],10);Z=(e*d)/255;h=(c*a)/255;k=(o*n)/255;l=e*0.3+c*0.59+o*0.11;if(l<85){Z=Z+(63*(85-l)/85);Z=Z>255?255:Z;h=h+(63*(85-l)/85);h=h>255?255:h;k=k+(63*(85-l)/85);k=k>255?255:k;}return"#"+this.rgb2hex(E(Z),E(h),E(k));},get3DBorderColor:function R(c,f){var a=parseInt(c[0],10)*0.3+parseInt(c[1],10)*0.59+parseInt(c[2],10)*0.11;var e=parseInt(c[0],10);var d=parseInt(c[1],10);var Z=parseInt(c[2],10);switch(f){case"light":if(a>150){e=e*0.9;d=d*0.9;Z=Z*0.9;}else{e=e*0.6+102;d=d*0.6+102;Z=Z*0.6+102;}break;case"dark":if(a>10){e=e*0.4;d=d*0.4;Z=Z*0.4;}else{e=e*0.8+30;d=d*0.8+30;Z=Z*0.8+30;}break;}return"#"+this.rgb2hex(E(e),E(d),E(Z));},encodeColor:function K(Z,a){if(a!==undefined&&(Z===null||Z.length===0||Z==="undefined")){Z=a;}if(Z==="transparent"){return -1;}if(parseInt(Z,10)===-2){return -2;}if(Z.substring(0,1)==="#"){Z=Z.substring(1);}return parseInt(Z.substring(4)+Z.substring(2,4)+Z.substring(0,2),16);},decodeColor:function A(Z){Z=parseInt(Z,10);if(Z===0){return I;}var a=16777216+(Z&255)*65536+(Z&65280)+(Z&16711680)/65536;return"#"+a.toString(16).substring(1).toUpperCase();},fixFullHexValue:function V(Z){if(Z&&Z.length===4){return Z.replace(/([0-9a-f])/ig,"$1$1");}return Z;},findMidColorHex:function P(c,b){var d=this.hex2rgb(c),Z=this.hex2rgb(b),a=[];d.forEach(function(e,f){a.push(parseInt((e+Z[f])/2,10));});return("#"+this.rgb2hex(a[0],a[1],a[2]));}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var O=/\{\@(en@)?([^\}]+)\}/gm,K=/\</gm,S=/\>/gm,F=/\S/,R=["$","^","=","!",":","/",".","*","+","?","|","(",")","[","]","{","}","\\"],G=new RegExp("(\\"+R.join("|\\")+")","g"),U={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;","\u0009":"&#x09;","\n":"&#x0A;","\r":"&#x0D;",'"':"&quot;"},X={"&amp;":"&","&lt;":"<","&gt;":">","&#x09;":"\u0009","&#x0A;":"\n","&#x0D;":"\r","&quot;":'"'},D={"&":{k:"&(?!#?\\w+;)",v:"&amp;"},"<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br/>","\r":"&nbsp;&nbsp;&nbsp;&nbsp;","'":"&#39;",'"':"&#34;"},N={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","<br/>":"\n","&nbsp;&nbsp;&nbsp;&nbsp;":"\r","&#39;":"'","&#34;":'"'},E={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&#34;","\u20ac":"&#8364;"},L={"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&#34;":'"',"&#8364;":"\u20ac"};var M=function(Y){if(Y===null){return"null";}var Z=typeof Y;if(Z!=="object"){return Z;}if(Y.length===undefined){return"object";}return"array";};var V={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};mstrmojo.string=mstrmojo.provide("mstrmojo.string",{multiReplace:function H(Z,c,b){var Y;b=b||[];if(!Z){return"";}var a=[];for(Y in c){if(mstrmojo.array.indexOf(b,Y)===-1){a.push(Y.k||Y);}}return Z.replace(new RegExp(a.join("|"),"g"),function(d){var e=c[d];return e.v||e;});},trim:function Q(Y){return(Y&&Y.replace)?Y.replace(/^\s+/,"").replace(/\s+$/,""):Y;},startsWith:function W(Z,Y){return Z.length>=Y.length&&Z.substring(0,Y.length)==Y;},ellipsize:function A(a,Z){var Y=this.trim(a.substr(0,(Z||1)-1));if(Y!==a){Y+="&hellip;";}return Y;},isEmpty:function J(Y){return(Y===null)||(Y===undefined)||!(F.test(Y));},regEscape:function P(Y){return Y.replace(G,"\\$1");},escapeIllegalXML:function C(Y){if(!Y||!Y.replace){return Y;}var Z=/\u001a/gm,a="";return Y.replace(Z,a);},encodeXMLAttribute:function(Y){return mstrmojo.string.multiReplace(Y,U);},decodeXMLAttribute:function(Y){return mstrmojo.string.multiReplace(Y,X);},encodeHtmlString:function(Z,Y,a){if(!Z||!Z.replace){return Z;}if(a){return mstrmojo.string.multiReplace(Z,E);}return mstrmojo.string.multiReplace(Z,D,Y?[" "]:[]);},decodeHtmlString:function(Z,Y){return Y?mstrmojo.string.multiReplace(Z,L):mstrmojo.string.multiReplace(Z,N);},htmlAngles:function(Y){if(!mstrmojo.string.isEmpty(Y)){Y=String(Y);return Y.replace(K,"&lt;").replace(S,"&gt;");}return Y;},apply:function I(Y,a){if(!Y){return"";}var Z=this;return Y.replace(O,function b(e,f,g){var c;try{c=mstrmojo.hash.walk(g,a);}catch(d){}c=(c===null||c===undefined)?"":c;return(!!f)?Z.encodeHtmlString(c,true):c;});},json2xml:function(Y,o,p){if(!(o instanceof Array)){o=[o];}var Z=p&&p.isSerializable,m=(p.convertBoolean!==false),r=p&&p.skipFunctions,l,e;var g=[],c=[],f,b,d;for(l=0,e=o.length;l<e;l++){var k=o[l];for(f in k){if(r&&typeof k[f]==="function"){continue;}if(Z){var q=Z(f,o,l);if(q!==true){if(q===false){continue;}else{if(q.att){g.push(q.att);}if(q.child){c.push(q.child);}continue;}}}b=k[f];d=M(b);switch(d){case"array":var h,j;c.push("<"+f+">");for(h=0,j=b.length;h<j;h++){var a=p.getArrItemName(f,b,h)||h;c.push(this.json2xml(a,b[h],p));}c.push("</"+f+">");break;case"object":c.push(this.json2xml(f,b,p));break;case"string":g.push(f+'="'+mstrmojo.string.encodeXMLAttribute(b)+'"');break;case"boolean":g.push(f+'="'+(m?(b?"-1":"0"):b)+'"');break;case"null":if(!p.skipNull){g.push(f+'="'+p.nullValue+'"');}break;default:g.push(f+'="'+b+'"');break;}}}return"<"+Y+" "+g.join(" ")+">"+c.join("")+"</"+Y+">";},escape4HTMLText:function B(f){if(!f||!f.replace){return f;}var c=/"/gm;var a="&quot;";var g=/&/gm;var e="&amp;";var d=/</gm;var Y="&lt;";var b=/>/gm;var Z="&gt;";return f.replace(g,e).replace(c,a).replace(d,Y).replace(b,Z);},parseUri:function(c,Z){Z=Z||V;var Y=Z.parser[((Z.strictMode)?"strict":"loose")].exec(c),b={},a=14;while(a--){b[Z.key[a]]=Y[a]||"";}b[Z.q.name]={};b[Z.key[12]].replace(Z.q.parser,function(e,d,f){if(d){b[Z.q.name][d]=f;}});return b;},removeSpecialChars:function(Y){return Y.replace(/[^a-zA-Z0-9]/g,"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom");var E=mstrmojo.dom,K=mstrmojo.array,N=mstrmojo.hash;function C(a){var Y=0,Z=a.childNodes;K.forEach(Z,function(b){Y+=(b.colSpan||1)-1;});return Y;}function H(Z){var Y=this;Y.selectedRows=[];Y.headersData="";Y.rowsData="";if(Z){Y.clipBoardTextRMC="";}else{Y.clipBoardText="";}Y.globalRowCounter=0;Y.allRows=[];}function J(Z,f){H.call(this,f);var d,Y=Z.length;var c=R.call(this,E.findAncestorByName(Z[0],"tr",true,this.domNode)),e=c.headerRowCount,a=c.maxHeaderChildCount,b=c.gridOffset;for(d=0;d<Y;d++){G.call(this,Z[d],"tr",true,this.domNode,e,a,b);}}function R(h){var Y=this.rhsCP.startIndexInContainer||0,d=0;var b,a=0,c=h&&h.parentNode;while(c.hasAttribute("n")&&parseInt(c.getAttribute("n"),10)>0){c=c.previousElementSibling;}var Z=c.firstChild,f=Z.childNodes;for(b=0;b<f.length;b++){d+=parseInt(f[b].getAttribute("colspan"));}var e=S(Z,Y,d);this.headersData=e.headerText;var g=e.firstDataRow;if(g&&g.childElementCount>d){a=1;}return{headerRowCount:Y,maxHeaderChildCount:d,gridOffset:a};}function S(g,e,Z){var b=0,a,d="",Y=0,h,f,c;while(Y<e){c=g.childNodes;h=c.length;if(Y!==0){d+="\n";for(b=0;b<(Z-h);b++){d+="\t";}}for(b=0;g&&b<h;b++){a=c[b].innerText||c[b].textContent;d+=a?(a+"\t"):"";f=c[b].getAttribute("colspan");while(f>1){d+="\t";f--;}}g=g.nextSibling;Y++;}return{headerText:d,firstDataRow:g};}function M(Y){return this.allRows[this.globalRowCounter>0?this.globalRowCounter-1:0][Y];}function G(j,Z,c,o,d,g,b){var f=[],e=[],l=j.rowSpan,m=0,Y="",n=0,a="",p=E.findAncestorByName(j,Z,c,o),q=this,h=q.allRows,k;if((p.childElementCount-b)<g){e=q.rhsCP.getUnmergedCells(j.getAttribute("r")-d);for(m=0;m<e.length;m++){f[m]=(e[m]._e)?e[m]._e.n:" ";}}if(l===1){h[q.globalRowCounter]=new Array(g);n=0;if(f.length>0){f.forEach(function(r){Y+=r+"\t";h[q.globalRowCounter][n++]=r;});}Y=I.call(q,p,Y,n);U.call(q,Y);this.globalRowCounter++;}else{while(l>0){n=0;h[q.globalRowCounter]=new Array(g);Y="";k=C(p);m=g-(p.childElementCount-b)-k;while(m>0){a=f[n]?f[n]:M.call(q,n);Y+=a+"\t";h[q.globalRowCounter][n++]=a;m--;}Y=I.call(q,p,Y,n);U.call(q,Y);q.globalRowCounter++;p=p.nextSibling;l--;}}}function I(e,d,a){var Z,Y,g=e.childNodes,f=this.allRows[this.globalRowCounter],b;for(Z=0;Z<g.length;Z++){var c=g[Z];Y=c.innerText||c.textContent;d+=Y?(Y+"\t"):"";f[a++]=Y?(Y):"";b=c.colSpan;while(b-->1){d+="\t";f[a++]="\t";}}return d;}function U(Y){if(K.indexOf(this.selectedRows,Y)<0){this.selectedRows.push(Y);this.rowsData+=Y+"\n";}}function D(){this.clipBoardText=(this.headersData)?this.headersData+"\n"+this.rowsData:this.rowsData;}function P(){this.clipBoardTextRMC=(this.headersData)?this.headersData+"\n"+this.rowsData:this.rowsData;}function W(){var Y=this.xTabHiddenTextArea;Y.readOnly=false;Y.value=this.clipBoardText;Y.readOnly=true;Y.focus();Y.select();}function V(){var Y=this.xTabHiddenTextArea;Y.readOnly=false;Y.value=this.clipBoardTextRMC;Y.readOnly=true;Y.focus();Y.select();}function A(){try{document.execCommand("copy");}catch(Y){console.log("Exception while copying data"+Y);}}function L(){var Y=this;Y.selectedRows=null;Y.allRows=null;Y.headersData=null;Y.rowsData=null;}mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste=mstrmojo.provide("mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",{_mixinName:"mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",xTabHiddenTextArea:undefined,isCopySupported:false,selectedRows:[],headersData:"",rowsData:"",clipBoardText:"",clipBoardTextRMC:"",globalRowCounter:0,allRows:undefined,init:function Q(Y){this._super(Y);this.isCopySupported=!(mstrApp.isSingleTier&&E.isMac()||E.isSafari||E.isFF);},onclick:function X(Y){this._super(Y);var Z=N.walk("node.data.olm",this)&&!(N.walk("node.data.rw.row.bc",this)>0);if(this.cmSelCells.length>0&&!E.isMobile&&!Z){this.prepareClipBoardDataRMC.call(this,this.cmSelCells);}if(this.selCells.length>0&&!E.isMobile&&!Z){this.prepareClipBoardData.call(this,this.selCells);}},prepareClipBoardData:function O(Y){J.call(this,Y,false);D.call(this);W.call(this);L.call(this);},prepareClipBoardDataRMC:function F(Y){J.call(this,Y,true);P.call(this);},copyRowsFromXtab:function B(Z,Y){if(Y.length<1){return ;}if(this.isCopySupported){V.call(this);A.call(this);}L.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash");var K=mstrmojo.array,D=mstrmojo.hash;function E(W,U){var X=[],Q=W.selectedIndices,P=W.allIdx;var R,S,V=W.items;if(W.multiSelect&&(P>-1)&&(K.indexOf(U,W.allIdx)>-1)){for(R=0,S=V.length;R<S;R++){if(!Q[R]){X.push(R);Q[R]=true;W.selectedIndex=R;W.selectedItem=V[R];}}}else{for(R=0,S=U.length;R<S;R++){var Y=U[R];if(!Q[Y]){Q[Y]=true;X.push(Y);W.selectedIndex=Y;W.selectedItem=V[Y];}}}return X;}function J(R){var Q=[],S=R.selectedIndices,P;for(P in S){delete S[P];Q.push(parseInt(P,10));}R.selectedIndex=-1;R.selectedItem=null;return Q;}function H(W,V){var S=[],Q=W.selectedIndices,Y=K.indexOf,P=W.allIdx;if(W.multiSelect&&(P>-1)&&(Y(V,P)>-1)){return J(W);}if(V.length>0&&Q[P]){if(Y(V,P)<0){V.push(P);}}var U=V.length,R;for(R=0;R<U;R++){var X=V[R];if(Q[X]){delete Q[X];S.push(X);if(W.selectedIndex===X){W.selectedIndex=-1;W.selectedItem=null;}}}return S;}function A(S,R){var P=S.selectedIndices;if(!P){P={};S.selectedIndices=P;}if(!R){R={};}var V=S.selectedIndex,U=[],W,Q;for(Q in P){if(!R[Q]){W=parseInt(Q,10);delete P[Q];U.push(W);if(V===W){S.selectedIndex=-1;S.selectedItem=null;}}}var Y=[],X=S.items;for(Q in R){if(!P[Q]){W=parseInt(Q,10);P[Q]=true;Y.push(W);S.selectedIndex=W;S.selectedItem=X&&X[W];}}return{add:Y,rmv:U};}function G(Q,P,R){if(Q.raiseEvent&&((P&&P.length)||(R&&R.length))){Q.raiseEvent({name:"change",added:P,removed:R});}}mstrmojo._ListBase2Selections=mstrmojo.provide("mstrmojo._ListBase2Selections",{multiSelect:false,selectedIndices:null,selectedIndex:-1,selectedItem:null,selectedIndices_bindEvents:"change",selectedIndex_bindEvents:"change",selectedItem_bindEvents:"change",allowUnlistedValues:true,insertUnlistedValuesAt:-1,allIdx:-1,singleSelect:function F(P,Q){if(!this.selectedIndices[P]||(this.selectionPolicy==="reselect")||(P!==this.allIdx&&this.selectedIndices[this.allIdx])){var R=J(this),S=E(this,[P]);if(Q!==true){G(this,S,R);}}},toggleSelect:function O(P,Q){var S,R;if(this.selectedIndices[P]){R=H(this,[P]);}else{S=E(this,[P]);}if(Q!==true){G(this,S,R);}},rangeSelect:function N(P,Q){this.singleSelect(P,Q);},clearSelect:function I(P){var Q=J(this);if(P!==true){G(this,null,Q);}},select:function L(R,P){var Q=A(this,K.hash(R));if((P!==true)&&(Q.add.length||Q.rmv.length)){G(this,Q.add,Q.rmv);}},addSelect:function B(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=E(this,R);if(P!==true){G(this,Q,null);}return Q;},removeSelect:function M(R,P){if(R===null||R===undefined){return null;}if(R.constructor!==Array){R=[R];}var Q=H(this,R);if(P!==true){G(this,null,Q);}return Q;},_set_selectedIndices:function(S,Q,P){if(this.selectedIndices===Q){return false;}var R=A(this,Q);if(R.add.length||R.rmv.length){if(P!==true){G(this,R.add,R.rmv);}}return false;},_set_selectedIndex:function(S,Q,P){var R={};if(Q>-1){R[Q]=true;}return this._set_selectedIndices(null,R,P);},_set_selectedItem:function(X,U,S){var R=U&&(typeof U==="object"),W=this.itemIdField,Q=-1,V=this.items;if(R&&W!=null){Q=K.find(V,W,U[W]);}else{if(U!=null){Q=K.indexOf(V,U);}}if((Q===-1)&&(U!=null)&&this.allowUnlistedValues){var P=this.insertUnlistedValuesAt;if(P==null||P<0){P=(V&&V.length)||0;}Q=P;this.add([U],Q);}return this._set_selectedIndex(null,Q,S);},initSelections:function C(U,Q,P,S,R){if(!this.selectedIndices){this.selectedIndices={};this.selectedIndex=-1;}if(U){this._set_selectedIndices(null,U,R);}else{if(Q){this.select(Q,R);}else{if(S){this._set_selectedItem(null,S,R);}else{if(P!==null&&P!==undefined){this._set_selectedIndex(null,P,R);}}}}},sortSelectedIndices:function(){return D.keyarray(this.selectedIndices,true).sort(K.numSorter);},removeSelectedItems:function(){var R=this.sortSelectedIndices(),P=R.length,S=R[P-1],Q=this.remove(R);S=Math.min(S+1-P,this.items.length-1);if(S>=0){this.singleSelect(S);}return Q;},getSelectedItems:function(){return K.get(this.items,this.sortSelectedIndices())||[];},setSelectedItems:function(Q,e){if(!Q||!Q.length){return ;}var S=this.items||[],t=this.itemIdField!=null?K.findMulti(S,this.itemIdField,Q):K.indexOfMulti(S,Q),W=Q.length,U=W-t.count,r=this.allowUnlistedValues,d=this.insertUnlistedValuesAt,Y=(r&&(d>-1))?U:0;if(d<0){d=S.length;}var R=[],V=[],g=t.map;if(U&&r){var q=0,f;for(f=0;f<W;f++){if(g[f]==null){R.push(Q[f]);V.push(d+q++);}}this.add(R,d);}var X=[],l;for(l in g){var p=g[l];if(p>=d){p+=Y;}X.push(p);}var s=X.concat(V),Z=this.addSelect(s,!e);if(!e){var a=K.hash(Z),h=this.selectedIndices,b=[],o;for(o in h){if(!a[o]){b.push(parseInt(o,10));}}var P=this.removeSelect(b,true);G(this,Z,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array");function C(G,H,E){var F=G.createElement("input");F.name=H;F.type="hidden";F.value=E;return F;}function B(K,J){J=J.substring(J.indexOf("?")+1,J.length);var M=J.split("&"),L="",G="";var N=/\+/g,H,E;for(H=0,E=M.length;H<E;H++){var I=M[H].indexOf("=");if(I>=0){L=M[H].substring(0,I);G=M[H].substring(I+1);}else{L=M[H];G="";}if(G){G=decodeURIComponent(G.replace(N," "));}var F=document.createElement("INPUT");F.type="HIDDEN";F.name=L;F.value=G;K.appendChild(F);}return false;}mstrmojo.form={createDynamicForm:function A(E,H){var F=document.createElement("FORM"),G=E.indexOf("?")>0;F.name="dynamic_form";F.method=H||"POST";F.action=(G?E.substring(0,E.indexOf("?")):E);if(G){B(F,E);}document.body.appendChild(F);return F;},sendLinkAsForm:function(E,G,H){var F=this.createDynamicForm(E,H);this.send({},F.action,F.method,G,null,null,F);},sendLink:function(E,H,I){var G=mstrmojo.array.indexOf(["_new","_blank"],H)>-1,F=!mstrmojo.isUrlExternal(E);if(!G&&F){mstrApp.showWait&&mstrApp.showWait({showCancel:true,onCancel:mstrApp.hideWait});}if(!mstrmojo.isUrlExternal(E)){mstrmojo.form.sendLinkAsForm(E,H,I);}else{if(G){window.open(E);}else{window.location.href=E;}}},send:function D(L,M,F,O,J,H,G){var Q=((J&&J.hWin)||window).document,N=G||Q.createElement("form"),K=mstrApp;L=mstrmojo.addCSRFTokenToTaskParams(L);N.method=F||"POST";if(O){N.target=O;}N.action=M||K.name;H=(H!==undefined)?H:!(N.action&&N.action.indexOf("aspx")>0)&&mstrConfig.addTimeStampToPreventCaching;if(!!K.addJSessionIdToURL&&K.httpSessionId){N.action+=";jsessionid="+K.httpSessionId;}if(H){N.action+=";uxts"+mstrmojo.now();}N.appendChild(C(Q,"xts",String(mstrmojo.now())));var R,E=K.persistTaskParams||microstrategy.persistParams;for(R in E){L[R]=E[R];}if(K.servletState&&K.name){L[K.name]=K.servletState;}if(L){var I;for(I in L){if(L[I].constructor===Array){mstrmojo.array.forEach(L[I],function(S){N.appendChild(C(Q,I,S));});}else{N.appendChild(C(Q,I,L[I]));}}}Q.body.appendChild(N);try{N.submit();}catch(P){if(O&&P.result===2147500037&&!window.open("","","width=1,height=1,left=0,top=0,scrollbars=no")){mstrmojo.alert("*This action requires popups to be allowed in the browser.*");}else{mstrmojo.err("Form submission failed for an unknown reason.");}}Q.body.removeChild(N);},addURLAsHiddenInputsToForm:B};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var G=mstrmojo.array;function B(){var H=this.buildConfig=this.buildConfig||{};H.pk=this.k;H.fgk=this.defn&&this.defn.fgk;return H;}mstrmojo._HasBuilder={builder:null,postBuildRendering:function D(){if(!this.builtChildren){this.buildChildren();}return this._super();},getChildren:function F(){return this.model.getChildren(this.node,false);},buildChildren:function E(H){if(!this.builder||!this.model){return false;}var J=this.children;if(J&&J.length){this.set("children",[]);}var I=this.builder.build(this.getChildren(),this.model,B.call(this));if(!H){this.addChildren(I);}this.builtChildren=true;return H?I:true;},rebuildChildren:function C(J){var P=this.children.slice(0),L=this.model,K=[],I,H=this,M=mstrApp.restoreVFKey,N,O;J=J||P.slice(0);J.forEach(function(S){var Q=G.indexOf(P,S),R=S.k;if(Q===-1){throw new Error("Invalid child requested rebuild in mstrmojo._HasBuilder::rebuildChild.");}this.removeChildren(S);S.destroy();K.push(R);},this);if(mstrApp.isInVFConfigMode&&(mstrApp.showBandingInVFConfigMode||mstrApp.showOutlineInVFConfigMode)&&!!J&&J.length===1&&!!J[0]&&J[0].k===M){delete mstrApp.showBandingInVFConfigMode;delete mstrApp.showOutlineInVFConfigMode;N=L.insertVizBox(M,H,{});L.selectVIUnit(N.id,true,{});I=[N];}else{O=L.getChildrenByKey(this.node,false,K);I=this.builder.build(O,L,B.call(this));this.addChildren(I);}return I;},rebuildChild:function A(H){return this.rebuildChildren([H])[0];}};}());(function(){mstrmojo.requiresCls("mstrmojo.array");var E="*",A=".",C="-",J="_",H="<";var M=new RegExp("[\\"+E+"\\"+A+"\\"+C+"\\"+J+"\\"+H+"]","g"),G=E+"$&";mstrmojo.Serializer={scriptClass:"mstrmojo.Serializer",serializeValueGroup:function F(B){mstrmojo.array.forEach(B,function(D,K){B[K]=mstrmojo.Serializer.serializeValues(D);});return C+this.serializeValues(B)+J;},serializeValues:function I(D){var B=[];mstrmojo.array.forEach(D,function(K){if(typeof K==="Boolean"){K=K?"1":"0";}B.push(String(K).replace(M,G));});return B.join(A);}};}());(function(){mstrmojo.requiresCls("mstrmojo.models.template.Title");mstrmojo.models.template.Titles=mstrmojo.declare(null,null,{init:function D(G){var F=this.gridData=G.data,E=F.gts;this.titles=G.isRow?E.row:E.col;},size:function C(){return this.titles.length;},getTitle:function B(E){return new mstrmojo.models.template.Title({title:this.titles[E]});},getCSS:function A(E){return this.gridData.css[this.titles[E].cni].n;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash");var E=mstrmojo.func.wrapMethods;function B(L,I,K,H,J){return E({success:function(M){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("success",I.target,JSON.stringify(I.memo),JSON.stringify(M));}},complete:function(){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("complete",I.target,JSON.stringify(I.memo));}J.removeCallback(K,H);},failure:function(M){if(mstrMobileApp&&mstrMobileApp.sendCallback){mstrMobileApp.sendCallback("failure",I.target,JSON.stringify(I.memo),JSON.stringify(M));}}},L);}mstrmojo._CanProxyCallback=mstrmojo.provide("mstrmojo._CanProxyCallback",{_mixinName:"mstrmojo._CanProxyCallback",callbacks:null,isCallbackReceiver:false,newCallback:function D(O){return O;var K=this.callbacks,I=mstrmojo.hash.copy(O),P=(O.index!==undefined)?String(O.index):"index",N=arguments.callee.caller.arguments,L,J,M,H=O.method||"anonymous";if(!K){K=this.callbacks={};}if(!K[H]){K[H]={};}if(!this.isCallbackReceiver){for(J=0,M=N.length;J<M;J++){L=N[J];if(L&&L.target){I=B(I,L,H,P,this);break;}}}if(!O.method){I.proxy=this.getCallbackMemo();}K[H][P]=I;return I;},anonymous:function(J,K,I,H){if(!this.isCallbackReceiver){K=B(K,H,"anonymous","index",this);mstrApp.serverRequest(J,K,I);}},getCallback:function C(K,J){var H=J||"index",I=this.callbacks;return I&&I[K]&&I[K][H];},removeCallback:function G(K,J){var H=J||"index",I=this.callbacks;if(I&&I[K]){delete I[K][H];if(mstrmojo.hash.isEmpty(I[K])){delete I[K];}}},getCallbackMemo:function F(I,H){return{target:'mstrmojo.all["'+this.id+'"].receiveCallback',memo:{method:I||"anonymous",index:H||"index"}};},receiveCallback:function A(L,J,K){var M=J.method,I=J.index,H=this.getCallback(M,I);if(H&&L&&H[L]){H[L](K);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.url");var B=mstrmojo.func,A=mstrmojo.url;mstrmojo.imageUtils=mstrmojo.provide("mstrmojo.imageUtils",{compress:function(F,K,J){var H="image/jpeg";if(J==="png"||J==="image/png"){H="image/png";}var G=parseInt(K);G=G>1&&G<=100?G:100;var I=document.createElement("canvas");if(!!(I.getContext&&I.getContext("2d"))){I.width=F.naturalWidth;I.height=F.naturalHeight;I.getContext("2d").drawImage(F,0,0);var E=I.toDataURL(H,G/100);var D=new Image();D.src=E;return D;}return F;},dataURLToBlob:function(J){var D=";base64,",I,K,E;J=J||"";if(J.indexOf(D)===-1){I=J.split(",");K=I[0].split(":")[1];E=decodeURIComponent(I[1]);return new Blob([E],{type:K});}I=J.split(D);K=I[0].split(":")[1];E=window.atob(I[1]);var H=E.length;var G=new Uint8Array(H);for(var F=0;F<H;++F){G[F]=E.charCodeAt(F);}return new Blob([G],{type:K});},isImageAccessible:function C(F,G){var E=document.createElement("img");var D=function(){E=null;};if(mstrApp&&mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode()&&F.indexOf(";base64,")===-1){E.src=A.getAbsoluteURL(F,window.FormWrapper.getDossierServerURL());}else{E.src=F;}E.onload=B.composite([G&&G.success||mstrmojo.emptyFn,D]);E.onerror=B.composite([G&&G.failure||mstrmojo.emptyFn,D]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.func");mstrmojo.ACL.UserDataService=mstrmojo.provide("mstrmojo.ACL.UserDataService",{topgroups:null,userCandidates:null,getMembers:function(G,E){var F={taskId:"getUserEntityInfo",blockBegin:G.blockBegin,blockCount:G.blockCount,userEntityID:G.data.did,userEntityName:G.data.n||"",incremental:true,outputElements:G.outputElements||3};mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);},getTopLevelGroups:function D(G,F){var E=this;if(this.topgroups){F.success({items:this.topgroups});return ;}F.success=mstrmojo.func.composite([F.success,function(H){E.topgroups=H.items;}]);this.getUsers({topGroupsOnly:true},F);},searchUserCandidates:function C(F,I,G,E){var H={blockBegin:1,blockCount:G,searchPattern:F,nameWildcards:I?4:2};this.getUsers(H,E);},getUserCandidates:function B(H,G){if(this.userCandidates){G.success(this.userCandidates);return ;}var E=G.success,F=this;G.success=function(J){F.userCandidates={items:J.items,isComplete:(parseInt(J.bc,10)===-1||(J.bb+J.bc>J.sz))};E(F.userCandidates);};var I={blockBegin:1,blockCount:H,nameWildcards:1};this.getUsers(I,G);},getUsers:function A(G,E){var F={taskId:"getUserServices"};mstrmojo.hash.copy(G,F);mstrmojo.xhr.request("POST",mstrConfig.taskURL,E,F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumDSSDisplayMode");mstrmojo.requiresDescs(981);var B=mstrmojo.vi.viz;mstrmojo.vi.viz.KnownVisualizations={CUSTOM:-2,UNKNOWN:-1,GRID:0,ESRIMAP:2,GRAPHMATRIX:3,NEWGRAPHMATRIX:13,IMAGELAYOUT:4,HEATMAP:16,GOOGLEMAP:17,NETWORK:18,MAPBOX:19,KPICARD:20,getDefinition:function A(E){var F=B.KnownVisualizations,H={Grid:{id:F.GRID,displayMode:mstrmojo.EnumDSSDisplayMode.GRID,title:mstrmojo.desc(981,"Grid")},visAjaxDatePicker:{id:1},ESRIMapVisualizationStyle:{id:F.ESRIMAP,mobileVIStyles:{IPhoneVisualization:"ViEsriMapAdapter",IPadVisualization:"ViEsriMapAdapter"}},GraphMatrixVisualizationStyle:{id:F.GRAPHMATRIX,displayMode:mstrmojo.EnumDSSDisplayMode.GRID,widgetEnable:"-1",mobileVIStyles:{IPadVisualization:"IPadGraphMatrix2Style"}},NewGraphMatrixVisualizationStyle:{id:F.NEWGRAPHMATRIX,displayMode:mstrmojo.EnumDSSDisplayMode.GRID,widgetEnable:"-1",mobileVIStyles:{IPadVisualization:"IPadGraphMatrix2Style"}},ImageLayoutVisualizationStyle:{id:F.IMAGELAYOUT,mobileVIStyles:{IPadVisualization:"IPhoneImageMapStyle",ATabletVisualization:"AndroidImageMapStyle"}},SurveyVisualizationStyle:{id:8,mobileVIStyles:{IPadVisualization:"SurveyVisualizationStyle"}},VIHeatMapVisualizationStyle:{id:F.HEATMAP,mobileVIStyles:{IPadVisualization:"IPadHeatMapStyle",ATabletVisualization:"HeatMapVisualizationStyle"}},GoogleMapVisualizationStyle:{id:F.GOOGLEMAP,mobileVIStyles:{IPhoneVisualization:"IPhoneMapStyle",IPadVisualization:"IPadMapStyle"}},MapboxVisualizationStyle:{id:F.MAPBOX,mobileVIStyles:{IPhoneVisualization:"IPhoneMapboxStyle",IPadVisualization:"IPhoneMapboxStyle"}},NetworkVisualizationStyle:{id:F.NETWORK,mobileVIStyles:{IPadVisualization:"IPhoneNetVizStyle"}},KPICardVisualizationStyle:{id:F.KPICARD,mobileVIStyles:{IPadVisualization:"IPhoneKPICardStyle"}}};var G=H[E];if(!G){var C=mstrConfig.pluginsVisList,D=C&&C[E];G={id:D?F.CUSTOM:F.UNKNOWN};G.mobileVIStyles=(D&&D.mobileVIStyles)||{};}return G;}};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources");function D(H){this.cleanUpAfterTarget(H);var G=H.tgtData;if(G){delete H.tgtData;}var I=this.getContextDragData(H);if(I&&I.setAvatarClass){I.setAvatarClass("");}}mstrmojo.vi.ui._IsDropTarget=mstrmojo.provide("mstrmojo.vi.ui._IsDropTarget",{_mixinName:"mstrmojo.vi.ui._IsDropTarget",dropZone:true,getDropAvatarIcon:function B(G){return"add";},getContextDragData:function F(G){return G.getCtxtDragData();},cleanUpAfterTarget:mstrmojo.emptyFn,ondragenter:function A(G){var H=this.getContextDragData(G);if(H&&H.setAvatarClass){H.setAvatarClass(this.getDropAvatarIcon(G));}if(this._super){this._super(G);}},ondragleave:function E(G){D.call(this,G);if(this._super){this._super(G);}},ondrop:function C(G){D.call(this,G);if(this._super){this._super(G);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var B=mstrmojo.hash;mstrmojo.Base=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Base",init:function A(C){B.copy(C,this);if(this.postApplyProperties){this.postApplyProperties();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var D=mstrmojo.dom,L=mstrmojo.hash;var O=100;var F=D.supportsTouches?0.5:1;var G=1;var R=100;var P={onvscrollVisibleChange:function(){var V=this.vscrollNode,W=V&&V.style;if(!W){return ;}if(this.vscrollVisible){var U=this.maxPos,X=this.clientSize;W.height=Math.round(X.y*X.y/U.y)+"px";W.left=(X.x-5)+"px";W.display="block";W.opacity=0.5;}else{W.opacity=0;}},onhscrollVisibleChange:function(){var W=this.hscrollNode,V=W&&W.style;if(!V){return ;}if(this.hscrollVisible){var U=this.maxPos,X=this.clientSize;V.width=Math.round(X.x*X.x/U.x)+"px";V.top=(X.y-5)+"px";V.display="block";V.opacity=0.5;}else{V.opacity=0;}}};var M=L.copy({onposChange:function(){var W=this.clientSize,V=this.maxPos,U=0,X=0;if(this.scrollsVert){X=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style[D.CSS3_TRANSFORM]="translateY("+Math.round((W.y-(W.y*W.y/V.y))*this.pos.y/V.y)+"px)";}}if(this.scrollsHoriz){U=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style[D.CSS3_TRANSFORM]="translateX("+Math.round((W.x-(W.y*W.x/V.x))*this.pos.x/V.x)+"px)";}}this.scrollChild.style[D.CSS3_TRANSFORM]="translate3d(-"+parseInt(U,10)+"px, -"+parseInt(X,10)+"px, 0px)";},ondeceleratingChange:function(){this.scrollChild.style[D.CSS3_TRANSITION]=this.decelerating?(D.CSS3_PREFIX+"transform 0.2s linear"):"";}},L.copy(P));var H=L.copy({onposChange:function(){var W=this.clientSize,V=this.maxPos,U=0,Y=0,X=this.scrollboxNode;if(this.scrollsVert){Y=this.pos.y;if(this.vscrollVisible){this.vscrollNode.style.top=Math.round((W.y-(W.y*W.y/V.y))*this.pos.y/V.y)+"px";}X.scrollTop=parseInt(Y,10);}if(this.scrollsHoriz){U=this.pos.x;if(this.hscrollVisible){this.hscrollNode.style.left=Math.round((W.x-(W.y*W.x/V.x))*this.pos.x/V.x)+"px";}X.scrollLeft=parseInt(U,10);}}},L.copy(P));mstrmojo._TouchScrolling=mstrmojo.provide("mstrmojo._TouchScrolling",{FRICTION:0.65,BOUNCEFRICTION:0.5,usesTouches:false,bounces:true,scrollsHoriz:true,scrollsVert:true,pos:null,preBuildRendering:function N(){this.usesTouches=(mstrmojo.dom.supportsTouches&&this.usesTouches&&(this.scrollsHoriz||this.scrollsVert));if(this.usesTouches){this.pos={x:0,y:0};}if(this._super){this._super();}},postBuildRendering:function C(){if(this._super){this._super();}if(this.usesTouches){var X=this.scrollboxNode,W=this.itemsContainerNode||X.firstChild;if(X&&X!==W){this.scrollChild=W;var U=X.style;U.position="relative";U.overflow="hidden";var V=W.style;V.position="absolute";V.left=0;V.top=0;this.markupMethods=L.copy(D.isSafari?M:H,L.copy(this.markupMethods));this.attachTouchEvents();}}},unrender:function(U){if(this.usesTouches){this.detachTouchEvents();}this._super(U);},attachTouchEvents:function(){var V=this.touchNode||this.scrollboxNode;if(V){if(!this._tsCallback){var U=this;this._tsCallback=function(W){U.touchesBegin(self,W);};this._tmCallback=function(W){U.touchesMoved(self,W);};this._teCallback=function(W){U.touchesEnd(self,W);};}D.attachEvent(V,D.TOUCHSTART,this._tsCallback);this._tsNode=V;}},detachTouchEvents:function(){var U=this._tsNode;if(U){D.detachEvent(U,D.TOUCHSTART,this._tsCallback);delete this._tsNode;}},touchesBegin:function J(U,W){var V=W.target&&W.target.tagName;if(V&&(V==="SELECT"||V==="INPUT")){return ;}D.preventDefault(U,W);this.stopDeceleration();this.startTime=new Date();this.startTimePos={x:this.pos.x,y:this.pos.y};this.startTouchPos=D.getMousePosition(D.firstTouch(U,W),U);this.dragging=false;D.attachEvent(window,D.TOUCHMOVE,this._tmCallback);D.attachEvent(window,D.TOUCHEND,this._teCallback);},touchesMoved:function E(c,f){var a=D.getMousePosition(D.firstTouch(c,f),c);D.preventDefault(c,f);if(!this.dragging){var U=5,j=Math.abs;if((this.scrollsHoriz&&j(a.x-this.pos.x)>U)||(this.scrollsVert&&j(a.y-this.pos.y)>U)){this.dragging=true;this.dragStartTime=new Date();this.startTouchPos=a;var W=this.scrollboxNode,Z={x:W.clientWidth,y:W.clientHeight},g={x:W.scrollWidth,y:W.scrollHeight};this.clientSize=Z;this.scrollSize=g;this.maxPos={x:Math.max(g.x-Z.x,0),y:Math.max(g.y-Z.y,0)};this.showScroll();}}if(this.dragging){D.stopPropogation(c,f);var d=this.startTimePos,Y=this.startTouchPos,b=this.maxPos;var X={x:this.scrollsHoriz?Math.max(Math.min(d.x-(a.x-Y.x),b.x),0):0,y:this.scrollsVert?Math.max(Math.min(d.y-(a.y-Y.y),b.y),0):0};this.set("pos",X);this.nextLastDragPos=this.lastDragPos;this.lastDragPos=a;var V=new Date(),h=this.lastDragTime;this.nextLastDragTime=h;this.lastDragTime=V;if((V-h)>R){this.startTime=this.lastDragTime;this.dragStartTime=this.startTime;this.startTimePos={x:X.x,y:X.y};this.startTouchPos=a;}}},touchesEnd:function I(U,V){D.preventDefault(U,V);D.detachEvent(window,D.TOUCHMOVE,this._tmCallback);D.detachEvent(window,D.TOUCHEND,this._teCallback);if(this.dragging){this.dragging=false;D.stopPropogation(U,V);if((new Date())-this.lastDragTime<=R){this.startDeceleration(U,V);}else{this.hideScroll();}}},startDeceleration:function B(Z,a){var X=D.getMousePosition(D.firstChangedTouch(Z,a),Z),d=((mstrmojo.dom.supportsTouches===null)?this.lastDragPos:this.nextLastDragPos)||X,c={x:X.x-d.x,y:X.y-d.y},U=((mstrmojo.dom.supportsTouches===null)?this.lastDragTime:this.nextLastDragTime),f=U?(new Date())-U:0,W={x:f?Number(c.x*O*F/f).toFixed(2):0,y:f?Number(c.y*O*F/f).toFixed(2):0};var b=this,V=function(e){return(b.scrollsHoriz&&Math.abs(e.x)>=G)||(b.scrollsVert&&Math.abs(e.y)>=G);};if(V(W)){this.velocity=W;this.friction={x:this.FRICTION,y:this.FRICTION};this.set("decelerating",true);var Y=function(){b.decelerate();if(!V(b.velocity)){b.stopDeceleration();b=null;}};Y();if(this.decelerating){this.decelerationTimer=window.setInterval(Y,O);}}else{this.hideScroll();}},stopDeceleration:function A(){this.set("decelerating",false);delete this.velocity;if(this.decelerationTimer){window.clearTimeout(this.decelerationTimer);delete this.decelerationTimer;}this.hideScroll();},decelerate:function S(){var X=this.pos,W=this.velocity,V=this.friction,a=this.maxPos,Y={x:X.x-W.x,y:X.y-W.y},c=this.bounces,U=this.BOUNCEFRICTION;var b=Y.x;if(b<0||b>a.x){Y.x=(b<0)?0:a.x;W.x*=c?-U:0;V.x=U;}var Z=Y.y;if(Z<0||Z>a.y){Y.y=(Z<0)?0:a.y;W.y*=c?-U:0;V.y=U;}this.set("pos",Y);this.velocity={x:V.x*W.x,y:V.y*W.y};},hideScroll:function K(){this.set("vscrollVisible",false);this.set("hscrollVisible",false);},showScroll:function Q(){var U=this.maxPos;if(this.scrollsVert&&U.y&&this.vscrollNode){this.set("vscrollVisible",true);}if(this.scrollsHoriz&&U.x&&this.hscrollNode){this.set("hscrollVisible",true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.requiresDescs(521,522,523,524,525,526,529,530,534,535,546,547,587,686,687,688,696,746,1101,1102,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,2171,2202,2203,2204,2219,2220,2784,2785,2786,2795,2796,3086,3344,3852,3853,3854,3855,3856,3857,3858,3859,3860,3861,3862,3863,3945,3946,4406,4407,5282,5283,5924,5925,6076,6077,6078,6079,6080,6081,6082,7899,7900,7901,7902,7903,9379,9380,9381,9382,9383,9384,9385,12298,13889,13890,13896,13897);mstrmojo.locales=mstrmojo.provide("mstrmojo.locales",{load:function(C){var A=this;if(this.isLoaded){C();C=null;}else{var B={taskId:"getLocaleInfo"};if(mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){B.sessionState=mstrApp.sessionState;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(D){A.update(D);C();C=null;if(mstrmojo.expr){mstrmojo.expr.onLocaleUpdated();}mstrmojo.locales.isLoaded=true;},failure:function(D){alert(D.getResponseHeader("X-MSTR-TaskFailureMsg"));}},B);}},update:function(A){if(A){mstrmojo.hash.copy(mstrmojo.hash.obj2array(A),this);}},isLoaded:false,datetime:{MONTHNAME_SHORT:[mstrmojo.desc(3852,"Jan"),mstrmojo.desc(3853,"Feb"),mstrmojo.desc(3854,"Mar"),mstrmojo.desc(3855,"Apr"),mstrmojo.desc(3856,"May"),mstrmojo.desc(3857,"Jun"),mstrmojo.desc(3858,"Jul"),mstrmojo.desc(3859,"Aug"),mstrmojo.desc(3860,"Sep"),mstrmojo.desc(3861,"Oct"),mstrmojo.desc(3862,"Nov"),mstrmojo.desc(3863,"Dec")],MONTHNAME_FULL:[mstrmojo.desc(1956,"January"),mstrmojo.desc(1957,"February"),mstrmojo.desc(1958,"March"),mstrmojo.desc(1959,"April"),mstrmojo.desc(1960,"May"),mstrmojo.desc(1961,"June"),mstrmojo.desc(1962,"July"),mstrmojo.desc(1963,"August"),mstrmojo.desc(1964,"September"),mstrmojo.desc(1965,"October"),mstrmojo.desc(1966,"November"),mstrmojo.desc(1967,"December")],dayShortNames:["S","M","T","W","T","F","S"],dayNames:[mstrmojo.desc(9379,"Sunday"),mstrmojo.desc(9380,"Monday"),mstrmojo.desc(9381,"Tuesday"),mstrmojo.desc(9382,"Wednesday"),mstrmojo.desc(9383,"Thursday"),mstrmojo.desc(9384,"Friday"),mstrmojo.desc(9385,"Saturday")],DATEINPUTFORMATS:["M/d/yy","M/d/yyyy","MMM d, yy"],TIMEINPUTFORMATS:["h:mm a","H:mm","h:mm:ss a","H:mm:ss","h:mm:ss a z"],DATEOUTPUTFORMAT:"M/d/yyyy",TIMEOUTPUTFORMAT:"h:mm:ss a",DATEDISPLAYFORMAT:"M/d/yy",TIMEDISPLAYFORMAT:"h:mm:ss",AM_NAME:"AM",PM_NAME:"PM",TWODIGITYEARSTART:"2029"},number:{NUMBERINPUTFORMATS:{"0":"#,##0.###"},INTEGERINPUTFORMATS:{"0":"#,##0"},NUMBEROUTPUTFORMAT:"#0.##########",INTEGEROUTPUTFORMAT:"#0",DECIMALSEPARATOR:".",THOUSANDSEPARATOR:","},expression:{METRICVALIDATIONLEVEL:"0",PRESERVEWHITESPACE:false,Include:[{did:"1",n:mstrmojo.desc(3945,"Include")},{did:"2",n:mstrmojo.desc(3946,"Exclude")}],BranchQual:[{did:"19",n:mstrmojo.desc(5282,"AND")},{did:"20",n:mstrmojo.desc(5283,"OR")},{did:"21",n:mstrmojo.desc(12298,"NOT")},{did:"19_21",n:mstrmojo.desc(5924,"AND NOT")},{did:"20_21",n:mstrmojo.desc(5925,"OR NOT")}],RootOperator:[{did:"19",n:mstrmojo.desc(534,"All selections")},{did:"20",n:mstrmojo.desc(535,"Any selection")}],ExprType:[{did:"2",n:mstrmojo.desc(546,"Qualify")},{did:"5",n:mstrmojo.desc(547,"Select")}],DimtyLevels:[{did:"1",n:mstrmojo.desc(2171,"Default")},{did:"2",n:mstrmojo.desc(3086,"Metric")},{did:"3",n:mstrmojo.desc(3344,"Report")}],Attribute:[{did:"1,6",n:mstrmojo.desc(2795,"Equals"),t:1,tp:1},{did:"1,7",n:mstrmojo.desc(2796,"Does not equal"),t:1,tp:1},{did:"1,8",n:mstrmojo.desc(521,"Greater than"),t:1,tp:1},{did:"1,10",n:mstrmojo.desc(522,"Greater than or equal to"),t:1,tp:1},{did:"1,9",n:mstrmojo.desc(523,"Less than"),t:1,tp:1},{did:"1,11",n:mstrmojo.desc(524,"Less than or equal to"),t:1,tp:1},{did:"1,17",n:mstrmojo.desc(696,"Between"),t:1,tp:1},{did:"1,44",n:mstrmojo.desc(746,"Not between"),t:1,tp:1},{did:"1,76",n:mstrmojo.desc(686,"Contains"),t:1,tp:1},{did:"1,79",n:mstrmojo.desc(2784,"Does not contain"),t:1,tp:1},{did:"1,77",n:mstrmojo.desc(687,"Begins with"),t:1,tp:1},{did:"1,80",n:mstrmojo.desc(2785,"Does not begin with"),t:1,tp:1},{did:"1,78",n:mstrmojo.desc(688,"Ends with"),t:1,tp:1},{did:"1,81",n:mstrmojo.desc(2786,"Does not end with"),t:1,tp:1},{did:"1,18",n:mstrmojo.desc(525,"Like"),t:1,tp:1},{did:"1,43",n:mstrmojo.desc(526,"Not Like"),t:1,tp:1},{did:"1,54",n:mstrmojo.desc(2202,"Is Null"),t:1,tp:1},{did:"1,55",n:mstrmojo.desc(2203,"Is Not Null"),t:1,tp:1},{did:"1,22",n:mstrmojo.desc(587,"In"),t:1,tp:1},{did:"1,57",n:mstrmojo.desc(2204,"Not In"),t:1,tp:1}],Metric:[{did:"1,6",n:mstrmojo.desc(2795,"Equals"),t:1,tp:1},{did:"1,7",n:mstrmojo.desc(2796,"Does not equal"),t:1,tp:1},{did:"1,8",n:mstrmojo.desc(521,"Greater than"),t:1,tp:1},{did:"1,10",n:mstrmojo.desc(522,"Greater than or equal to"),t:1,tp:1},{did:"1,9",n:mstrmojo.desc(523,"Less than"),t:1,tp:1},{did:"1,11",n:mstrmojo.desc(524,"Less than or equal to"),t:1,tp:1},{did:"1,17",n:mstrmojo.desc(696,"Between"),t:1,tp:1},{did:"1,44",n:mstrmojo.desc(746,"Not between"),t:1,tp:1},{did:"1,54",n:mstrmojo.desc(2202,"Is Null"),t:1,tp:1},{did:"1,55",n:mstrmojo.desc(2203,"Is Not Null"),t:1,tp:1},{did:"1,22",n:mstrmojo.desc(587,"In"),t:1,tp:1},{did:"1,57",n:mstrmojo.desc(2204,"Not In"),t:1,tp:1},{did:"2,1",n:mstrmojo.desc(529,"Highest"),t:2,tp:2},{did:"2,2",n:mstrmojo.desc(530,"Lowest"),t:2,tp:2},{did:"3,1",n:mstrmojo.desc(4407,"Highest %"),t:3,tp:3},{did:"3,2",n:mstrmojo.desc(4406,"Lowest %"),t:3,tp:3}],MetricRP:[{did:"2,13",n:mstrmojo.desc(13897,"Rank between highest"),t:2,tp:2},{did:"2,4",n:mstrmojo.desc(1101,"Exclude highest"),t:2,tp:2},{did:"2,3",n:mstrmojo.desc(13896,"Rank between lowest"),t:2,tp:2},{did:"2,5",n:mstrmojo.desc(1102,"Exclude lowest"),t:2,tp:2},{did:"3,13",n:mstrmojo.desc(13890,"Between highest")+"%",t:3,tp:3},{did:"3,4",n:mstrmojo.desc(1101,"Exclude highest")+"%",t:3,tp:3},{did:"3,3",n:mstrmojo.desc(13889,"Between lowest")+"%",t:3,tp:3},{did:"3,5",n:mstrmojo.desc(1102,"Exclude lowest")+"%",t:3,tp:3}],MDXAttribute:[{did:"1,6",n:mstrmojo.desc(2795,"Equals"),t:1,tp:1},{did:"1,7",n:mstrmojo.desc(2796,"Does not equal"),t:1,tp:1},{did:"1,8",n:mstrmojo.desc(521,"Greater than"),t:1,tp:1},{did:"1,10",n:mstrmojo.desc(522,"Greater than or equal to"),t:1,tp:1},{did:"1,9",n:mstrmojo.desc(523,"Less than"),t:1,tp:1},{did:"1,11",n:mstrmojo.desc(524,"Less than or equal to"),t:1,tp:1},{did:"1,17",n:mstrmojo.desc(696,"Between"),t:1,tp:1},{did:"1,44",n:mstrmojo.desc(746,"Not between"),t:1,tp:1},{did:"1,22",n:mstrmojo.desc(587,"In"),t:1,tp:1},{did:"1,57",n:mstrmojo.desc(2204,"Not In"),t:1,tp:1}],MDXMetric:[{did:"1,6",n:mstrmojo.desc(2795,"Equals"),t:1,tp:1},{did:"1,7",n:mstrmojo.desc(2796,"Does not equal"),t:1,tp:1},{did:"1,8",n:mstrmojo.desc(521,"Greater than"),t:1,tp:1},{did:"1,10",n:mstrmojo.desc(522,"Greater than or equal to"),t:1,tp:1},{did:"1,9",n:mstrmojo.desc(523,"Less than"),t:1,tp:1},{did:"1,11",n:mstrmojo.desc(524,"Less than or equal to"),t:1,tp:1},{did:"1,17",n:mstrmojo.desc(696,"Between"),t:1,tp:1}],SAPAttribute:[{did:"1,6",n:mstrmojo.desc(2795,"Equals"),t:1,tp:1},{did:"1,7",n:mstrmojo.desc(2796,"Does not equal"),t:1,tp:1},{did:"1,22",n:mstrmojo.desc(587,"In"),t:1,tp:1},{did:"1,57",n:mstrmojo.desc(2204,"Not In"),t:1,tp:1},{did:"1,8",n:mstrmojo.desc(521,"Greater than"),t:1,tp:1},{did:"1,10",n:mstrmojo.desc(522,"Greater than or equal to"),t:1,tp:1},{did:"1,9",n:mstrmojo.desc(523,"Less than"),t:1,tp:1},{did:"1,11",n:mstrmojo.desc(524,"Less than or equal to"),t:1,tp:1},{did:"1,17",n:mstrmojo.desc(696,"Between"),t:1,tp:1}],Element:[{did:"1,22",n:mstrmojo.desc(2219,"In List"),t:1,tp:1},{did:"1,57",n:mstrmojo.desc(2220,"Not In List"),t:1,tp:1}]},validation:{requiredFieldError:mstrmojo.desc(6078,"This field is required."),invalidCharError:mstrmojo.desc(7899,"This field contains invalid characters for #."),invalidDateStringError:mstrmojo.desc(7900,"This field contains invalid date/time string."),invalidNumericFormatError:mstrmojo.desc(7901,"This field contains numeric value with incorrect format."),outofRangeError:mstrmojo.desc(6079,"This field should be # between ## and ###."),noLessMinError:mstrmojo.desc(6081,"This field should be # greater than or equal to ##."),noGreaterMaxError:mstrmojo.desc(6080,"This field should be # less than or equal to ###."),failRegexTestError:mstrmojo.desc(6082,"This field failed regular expression validation."),invalidValueInListError:mstrmojo.desc(7902,"One of the value (#) in this list is not valid."),integerDataType:mstrmojo.desc(6076,"an Integer value"),numericDataType:mstrmojo.desc(6077,"a Number value"),dateDataType:mstrmojo.desc(7903,"a Date/Time value")},color:{colors:[{n:"Black",v:"#000000"},{n:"Brown",v:"#993300"},{n:"Olive Green",v:"#333300"},{n:"Dark Green",v:"#003300"},{n:"Dark Teal",v:"#003366"},{n:"Dark Blue",v:"#000080"},{n:"Indigo",v:"#333399"},{n:"Grey-80%",v:"#333333"},{n:"Dark Red",v:"#800000"},{n:"Orange",v:"#FF6600"},{n:"Dark Yellow",v:"#808000"},{n:"Green",v:"#008000"},{n:"Teal",v:"#008080"},{n:"Blue",v:"#0000FF"},{n:"Blue-Grey",v:"#666699"},{n:"Grey-50%",v:"#808080"},{n:"Red",v:"#FF0000"},{n:"Light Orange",v:"#FF9900"},{n:"Lime",v:"#99CC00"},{n:"Sea Green",v:"#339966"},{n:"Aqua",v:"#33CCCC"},{n:"Light Blue",v:"#3366FF"},{n:"Violet",v:"#800080"},{n:"Grey-40%",v:"#969696"},{n:"Pink",v:"#FF00FF"},{n:"Gold",v:"#FFCC00"},{n:"Yellow",v:"#FFFF00"},{n:"Bright Green",v:"#00FF00"},{n:"Turquoise",v:"#00FFFF"},{n:"Sky Blue",v:"#00CCFF"},{n:"Plum",v:"#993366"},{n:"Grey-25%",v:"#C0C0C0"},{n:"Rose",v:"#FF99CC"},{n:"Tan",v:"#FFCC99"},{n:"Light Yellow",v:"#FFFF99"},{n:"Light Green",v:"#CCFFCC"},{n:"Light Turquoise",v:"#CCFFFF"},{n:"Pale Blue",v:"#99CCFF"},{n:"Lavender",v:"#CC99FF"},{n:"White",v:"#ffffff"}],userPalette:[{n:"#F00E0E",v:"#F00E0E"},{n:"#080000",v:"#080000"},{n:"#E81A1A",v:"#E81A1A"},{n:"#6E0909",v:"#6E0909"},{n:"#4F2828",v:"#4F2828"},{n:"#141212",v:"#141212"},{n:"#D60202",v:"#D60202"},{n:"#C40404",v:"#C40404"}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.vi.ui.rw.selectors._IsPageBySelector=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsPageBySelector",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsPageBySelector",isViPageBy:true,preBuildRendering:function A(){var C=this.defn;C.horiz=true;var B=mstrmojo.hash.copyProps(["n","srcid","srct","style","ck","ckey","tks"],C);B.n=C.ttl||B.n||"";B.id=this.id;this.parent.set("unit",B);delete this.getFormats().color;return this._super();}});mstrmojo.vi.ui.rw.selectors._IsPageBySelector.PageByUnitType=null;}());mstrmojo.DPIManager={classes:[],registerClass:function registerClass(B,C,D,A){this.classes.push({c:B,d:C,s:D,v:A});},setDPI:function(){var A=mstrMobileApp.getDeviceDPI();mstrmojo.array.forEach(this.classes,function(B){B.c.prototype.layoutConfig[B.d][B.s]=B.v[A]+"px";});this.classes=[];}};(function(){document.msCSSOMElementFloatMetrics=true;mstrmojo.requiresCls("mstrmojo.hash");var S=mstrmojo.hash,H="containerNode",G="auto",Q="px";var I={v:G,c:undefined,sv:G};function E(d,g,f){var h=this._layoutWidgets[g],l=d.slot||H,j=h.f,k=h.p,e=(j&&j[l]!==undefined),c=(k&&k[l]!==undefined);if(l&&((!f&&e)||c)){return e?j[l]:(h.x*parseInt(k[l],10)/100)+Q;}return d[(g==="h")?"height":"width"];}function K(j,e,c){if(j.ignoreLayout){return ;}var d=(e===G)||e==="NaNpx",g=(c===G)||c==="NaNpx";var f=j.getLayoutOffsets&&j.getLayoutOffsets();if(f){if(!d){e=(parseInt(e,10)-f.h)+Q;}if(!g){c=(parseInt(c,10)-f.w)+Q;}}if(j.setDimensions){j.setDimensions(e,c);}else{if(j.set){if(!d){j.set("height",e);}if(!g){j.set("width",c);}}}}function a(f){var d=this.children,j,l;for(j=0,l=(d&&d.length)||0;j<l;j++){var e=d[j],m=e.slot||H;if(m){var k=E.call(this,e,"h",f),n=E.call(this,e,"w",f);this.setSlotDimensions(m,k,n);K(e,k,n);var c=E.call(this,e,"h",f),g=E.call(this,e,"w",f);if(c!==k||g!==n){K(e,c,g);}this.setSlotDimensions(m,c,g);}}this.afterLayout();}function B(){var d=this.children,c=this._layoutWidgets;S.forEach(this.slotNames,function(j,k){if(!j||this.skipsSlotLayout(k)){return ;}var g=(c.h&&c.h.getSlotSizeInfo(k,d))||I,e=(c.w&&c.w.getSlotSizeInfo(k,d))||I,f=g.c||e.c;mstrmojo.array.forEach(f,function(h){K(h,g.v,e.v);});this.setSlotDimensions(k,g.sv,e.sv);},this);this.afterLayout();}function D(d){var c=this.layoutConfig.xt?B:a;c.call(this,d);}function U(k,f,h){var j=k.slot||H,g=f&&f.a;if(!g||g[j]===undefined){return ;}var c=this[j]["offset"+h],e=g[j];if(c===e){return ;}f.x-=(c-e);g[j]=c;}function J(c){this.beforeLayout();var d=this._layoutWidgets,e=c.src;U.call(this,e,d.h,"Height");U.call(this,e,d.w,"Width");D.call(this,true);}function O(e,j){if(!e){return null;}var c=this.children,s=j.toLowerCase(),k=parseInt(this[s],10),m=k,o={},q={},h={},d={},p={},l,n,f,t,r;for(r in e){if(!e.hasOwnProperty(r)){continue;}t=e[r];if(t.match(/px$/)){k-=parseInt(t,10);o[r]=t;}else{if(t.match(/%$/)){q[r]=t;}else{if(t.match(/all/)){p[r]=m;}else{h[r]=t;}}}}if(!S.isEmpty(h)&&!S.isEmpty(q)){for(l=0,n=(c&&c.length)||0;l<n;l++){f=c[l];r=f.slot||H;if(r&&h[r]&&!f.ignoreLayout){if(f.hasRendered){var g=this[r];d[r]=g.getBoundingClientRect?Math.round(g.getBoundingClientRect()[j.toLowerCase()]):g["offset"+j];k-=d[r];}else{d[r]=0;f.attachEventListener((f instanceof mstrmojo.Container)?"childrenRendered":"renderComplete",this.id,J);}}}}return{f:S.isEmpty(o)?undefined:o,p:S.isEmpty(q)?undefined:q,a:S.isEmpty(d)?undefined:d,n:S.isEmpty(p)?undefined:p,x:k,getSlotSizeInfo:function(AC,w){if(!e[AC]){return I;}var v=mstrmojo.array.filter(w,function(AE){var AD=AE.slot;return AD===AC||(AC===H&&!AD);}),AA,AB;var u=o[AC];if(u){AB=u;}var z=q[AC];if(z){AB=(this.x*parseInt(z,10)/100)+Q;}if(h[AC]){AB=d[AC];if(AB){AB+=Q;}else{AB=G;}AA=G;}var x=p[AC];if(x){AB=AA=x+Q;}AB=AB||"0px";return{v:AB,c:v,sv:AA||AB};}};}function R(d){var c=this.domNode;if(!c||!this.layoutConfig){return ;}c.style[d]=this[d];this.doLayout();}mstrmojo._HasLayout=mstrmojo.provide("mstrmojo._HasLayout",{_mixinName:"mstrmojo._HasLayout",height:"auto",width:"auto",ignoreLayout:false,beforeLayout:mstrmojo.emptyFn,afterLayout:mstrmojo.emptyFn,forceLayout:false,layoutConfig:null,init:function W(c){this._super(c);this.layoutConfig=S.clone(this.layoutConfig);},preBuildRendering:function C(){var e=this.cssText||"";var c=this.height;if(c&&c!==G){e+="height:"+this.height+";";}var d=this.width;if(d&&d!==G){e+="width:"+this.width+";";}this.cssText=e;return(this._super)?this._super():true;},postBuildRendering:function X(){this.doLayout();return this._super();},modifyLayoutConfig:function Z(e,d){var c=this.layoutConfig=this.layoutConfig||{};c.h=S.copy(e,c.h);c.w=S.copy(d,c.w);this.doLayout();},getLayoutOffsets:mstrmojo.emptyFn,set:function P(e,c){var d=this._super(e,c);if(e==="visible"&&this._pendingLayoutOnVisible){delete this._pendingLayoutOnVisible;this.doLayout();}return d;},doLayout:function A(){var c=this.layoutConfig;if(!c||(this.height===G&&this.width===G)){return ;}if(c.xt){if(!this.visible){this._pendingLayoutOnVisible=true;return ;}}this.beforeLayout();this._layoutWidgets={h:O.call(this,c.h,"Height"),w:O.call(this,c.w,"Width")};D.call(this,false);this.widgetResized();},browserResized:function F(c){this.setDimensions(c.h,c.w);return true;},onwidthChange:function N(){R.call(this,"width");},onheightChange:function M(){R.call(this,"height");},skipsSlotLayout:function(c){return false;},adjustParentDimensions:function L(){var d=this.parent,c=d&&d._layoutWidgets;if(c){U.call(d,this,c.h,"Height");U.call(d,this,c.w,"Width");}},setDimensions:function V(f,d){var e=(f===G)||f==="NaNpx",g=(d===G)||d==="NaNpx";if((!e&&parseInt(this.height,10)!==parseInt(f,10))||(!g&&parseInt(this.width,10)!==parseInt(d,10))||this.forceLayout){if(!e){this.height=f;}if(!g){this.width=d;}var c=this.domNode,j=c&&c.style;if(j){if(!e){j.height=f;}if(!g){j.width=d;}this.doLayout();}return true;}return false;},setSlotDimensions:function Y(f,e,d){var c=this[f]&&this[f].style;if(!c){return ;}if(e!==G&&e!==undefined&&e!=="NaNpx"&&c.height!==e&&parseInt(e)>=0){c.height=e;}if(d!==G&&d!==undefined&&d!=="NaNpx"&&c.width!==d&&parseInt(d)>=0){c.width=d;}}});mstrmojo._HasLayout.getSlotSize=function b(f,g){var d=f&&f.prototype.layoutConfig;if(d){var e=d.h,c=d.w;return{h:(e&&e[g])||undefined,w:(c&&c[g])||undefined};}return null;};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var E=mstrmojo.hash;var B=function(G){return(mstrmojo.now()-G.getTime());};mstrmojo.storage.DOMStorage=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.storage.DOMStorage",mIsSupported:false,mStorageObj:null,itemTimeToLive:3600,init:function F(G){E.copy(G,this);return this;},isSupported:function C(){return this.mIsSupported;},checkVersion:function A(G){var H=this.getItem("__version__");if(H&&H<G){mstrmojo.dbg("DOMStorage data is old - clearing, v="+H);this.clear();}this.setItem("__version__",G,-1);return this;},length:function(){return(this.mIsSupported?this.mStorageObj.length:0);},_keyExpired:function D(G){return(G&&(G.ts>0)&&(mstrmojo.now()>G.ts));},key:function(G){return(this.mIsSupported?this.mStorageObj.key(G):null);},getItemAsString:function(H){var G=this.getItem(H);if(G){if(typeof G=="object"){G=JSON.stringify(G);}else{G=G+"";}}return G;},getItem:function(H){var G=null;if(this.mIsSupported){var J=this.mStorageObj.getItem(H);if(J){try{J=JSON.parse(J);}catch(I){}if(this._keyExpired(J)){this.removeItem(H);}else{G=J.data;}}}return G;},setItem:function(H,J,G){G=G||this.itemTimeToLive;try{if(this.mIsSupported){this.mStorageObj.removeItem(H);var L=(G>0)?(mstrmojo.now()+(G*1000)):-1;var I={ts:L,data:J};this.mStorageObj.setItem(H,JSON.stringify(I));}}catch(K){if(K!==QUOTA_EXCEEDED_ERR){throw K;}}finally{}return this;},removeItem:function(G){if(this.mIsSupported){this.mStorageObj.removeItem(G);}return this;},clear:function(){if(this.mIsSupported){this.mStorageObj.clear();}return this;}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.all={};var E=mstrmojo.all,G=mstrmojo.hash;var A=0;function D(){var I;while(!I){var H="mstr"+(A++);if(!E[H]){I=H;}}return I;}mstrmojo.registry=mstrmojo.provide("mstrmojo.registry",{add:function F(H){if(!H){return ;}var I=H.id;if(!I){H.id=I=D();}else{if(E[I]){throw new Error("Tried to register 2 objects with same id: "+I);}}E[I]=H;},remove:function C(H){if(H&&H.id){delete E[H.id];}},dumpAll:function(){var H;for(H in E){var I=E[H].id;if(I){mstrmojo.dbg(I+"("+(E[H].scriptClass||"[unknown class]")+")");}}},ref:function B(I,H){H=H||{};if(I){var L=I;while(L){switch(typeof L){case"string":if(H.skipLoadChecks!==true){mstrmojo.requiresCls(L);}L=G.walk(L,window);break;case"function":return(H.dontInst!==true)?new L():L;case"object":if(L.constructor===Object){var K=L.scriptClass;if(K){if(H.skipLoadChecks!==true){mstrmojo.requiresCls(K);}var J=G.walk(K,window);if(J){return new J((H.clone===true)?G.clone(L):L);}return null;}return L;}return L;default:return null;}}}return null;}});mstrmojo.insert=mstrmojo.registry.ref;}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.requiresDescs(2213,3326,3327,3329,4531,13283,13284,13285,13286);mstrmojo.ME.Enum={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EDIT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};},FBFlag:{Automatic:0,Manual:3},AFB:{Automatic:-1,False:0,True:1},SFB:{Automatic:-1,False:1,True:2},UI_OBJECT_TYPE:{Dimty:-1,Sub_Expression:-2,Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},UI_DATA_TYPE:{Sortby:-1,Breakby:-2,Level:-4,Condition:-5,Transformation:-6},SHORTCUT_FUNCTIONS:{Level:-4,Condition:-5,Transformation:-6,Row_Count:-7},DYNAMIC_DIMTY:{CODES:{auto:{n:mstrmojo.desc(4531,"Automatic"),did:"@auto",t:-1},page:{n:mstrmojo.desc(3329,"Grand Total"),did:"@p",t:-1},byCol:{n:mstrmojo.desc(3326,"By Columns"),did:"@cols",t:-1},byRow:{n:mstrmojo.desc(3327,"By Rows"),did:"@rows",t:-1},byCell:{n:mstrmojo.desc(13283,"By Cell"),did:"@cell",t:-1},byShape:{n:mstrmojo.desc(13284,"By Shape"),did:"@shape",t:-1},downCross:{n:mstrmojo.desc(13285,"Down, Then Across"),did:"@cr",t:-1},crossDown:{n:mstrmojo.desc(13286,"Across, Then Down"),did:"@rc",t:-1}},getItems:function D(G){var F=this.CODES,E=[];switch(G){case"breakby":E=[F.auto,A.copy({n:mstrmojo.desc(2057,"None")},A.copy(F.page)),A.copy({n:mstrmojo.desc(122,"Columns")},A.copy(F.byCol)),A.copy({n:mstrmojo.desc(2968,"Rows")},A.copy(F.byRow)),A.copy({n:mstrmojo.desc(13399,"Cell")},A.copy(F.byCell)),A.copy({n:mstrmojo.desc(2923,"Shape")},A.copy(F.byShape))];break;case"level":E=[F.auto,F.page,F.byCol,F.byRow,F.byCell,F.byShape];break;case"sortby":E=[F.auto,F.downCross,F.crossDown];}return E;},getAutomaticDimtyObject:function C(){return A.copy(this.CODES.auto);},getDimtyObject:function B(E,H){var F=null;var G=false;if(H){A.forEach(mstrmojo.ME.Enum.DYNAMIC_DIMTY.CODES,function(I){if(I.did===E){F=A.copy(I);G=true;return false;}});}if(!G){F={n:E,t:-1,dimty:true};}return F;}},NonExposableParams:["IsNewOLAP","OLAPPattern","OLAPHasWindow"]};mstrmojo.ME.Enum.DEFAULT_MPS={mps:{afb:mstrmojo.ME.Enum.AFB.False,sfb:mstrmojo.ME.Enum.SFB.False,fbf:mstrmojo.ME.Enum.FBFlag.Automatic}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash");var O=/this\.([\w\.\[\]\'\"\-]+)/m,D=/this\./m,M=/mstrmojo\.all\[[\'\"]([\w]+)[\'\"]\]\.([\w\.\[\]\'\"\-]+)/m,R=/mstrmojo\.all\[/m,L=/mstrmojo\.all\.([\w]+)\.([\w\.\[\]\'\"\-]+)/m,B=/mstrmojo\.all\./m,C=/\[(\d+)\]/g,E=/\[\'([\w\-]+)\'\]/g,P=/\[\"([\w\-]+)\"\]/g,H=/([\[\]].*)/;mstrmojo.Binding=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.Binding",parent:null,source:null,destination:null,enabled:false,setter:"set",executing:0,init:function N(S){mstrmojo.hash.copy(S,this);mstrmojo.registry.add(this);},destroy:function F(){mstrmojo.publisher.clearSubscriptions(this.id);mstrmojo.registry.remove(this);},exec:function K(){this.executing++;var X=this._sourceFn;if(!X){var W=this.source;if(W!=null){if(typeof (W)=="string"){if(!(W.match("return "))&&!(W.match(/\;\s*\S/))){W="return "+W;}X=new Function(W);}else{if(typeof (W)=="function"){X=W;}}this._sourceFn=X;}}var S,Y=this.parent;if(X){try{S=X.apply(Y,[]);}catch(V){}}var U=this.setter,Z=this.destination;if(U==null){Y[Z]=S;}else{if(typeof (U)=="string"){Y[U](Z,S);}else{if(typeof (U)=="function"){U.apply(Y,[Z,S]);}}}this.executing--;},enable:function A(){if(!this.enabled){this.exec();var U=this._chains;if(!U){this._parseChains();U=this._chains;}for(var S in U){this._attachChain(U[S]);}this.enabled=true;}},disable:function J(){if(this.enabled){var U=this._chains;if(U){for(var S in U){this._detachChain(U[S]);}}this.enabled=false;}},_chains:null,_parseChains:function(){this._chains={};var V=this._chains;var U=this.source;if(U&&(typeof (U)=="function")){U=U.toString&&U.toString();}if(!U){return ;}function S(c,f,W,Y){var X=c,a;while(a=X.match(f)){var d=a[0],b=d.length,e=true;d=d.replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"");for(var Z in V){if(Z.substr(0,b)===d){e=false;break;}else{if(d.indexOf(Z)===0){delete V[Z];}}}if(e){V[d]={host:(W==null)?null:a[W],parts:a[Y].replace(C,".$1").replace(E,".$1").replace(P,".$1").replace(H,"").split(".")};}X=X.substr(a.index+b);}}if(D.test(U)){S(U,O,null,1);}if(R.test(U)){S(U,M,1,2);}if(B.test(U)){S(U,L,1,2);}},_attachChain:function Q(S,V){if(!S.evt2idx){S.evt2idx={};}if(!S.idx2evt){S.idx2evt=[];}var e=S.evt2idx,h=S.idx2evt,a=S.parts;var f=(V>=0)?V:0,c=this.id,X=mstrmojo.all,d=(V>0)?X[h[f-1].context][a[f-1]]:(S.host?X[S.host]:this.parent),U=a[f];var W=mstrmojo.array;while(d&&U){if(d.attachEventListener){var g=d[U+"_bindEvents"]||(U+"Change");if(typeof (g)=="string"){g=[g];}var Z=[];for(var b=0,Y=g.length;b<Y;b++){Z[b]=d.attachEventListener(g[b],c,"_callback");}for(var b=0;b<g.length;b++){e[d.id+"_"+g[b]]=f;}h[f]={context:d.id,evts:g,subs:Z};}d=d[U];U=S.parts[++f];}},_detachChain:function G(S,U){var V=mstrmojo.all,k=S.idx2evt,e=S.evt2idx,b=this.id;var Z=(U>-1)?U:0,c=k.length;if(Z<c){for(;Z<c;Z++){var a=k[Z];if(!a){break;}var X=a.context,d=V[X],h=a.evts;if(d&&d.detachEventListener){var l=a.subs;for(var g=0,W=l.length;g<W;g++){d.detachEventListener(l[g]);}}k[Z]=null;for(var Y=0,f=h.length;Y<f;Y++){delete e[X+"_"+h[Y]];}}}},_callback:function I(U){this.exec();if(!U||!U.name||!U.src){return ;}var V=U.src.id+"_"+U.name,X=this._chains;for(var Y in X){var W=X[Y],S=W.evt2idx[V];if(S!=null){this._detachChain(W,S+1);this._attachChain(W,S+1);}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash");var E=mstrmojo.dom,M=mstrmojo.hash,B,I=mstrmojo.global.document,K="mousedown",O="mousemove",Q="mouseup";function G(Y){if(E.isPrimaryMouseBtn(Y)){B.startDragCheck(self,Y);}}var V,P,A="mstrmojo-dnd-avatar",U;function F(Z,Y){if(Y!==undefined&&Y!==null){P.innerHTML=Y;}U.left=Z.x+"px";U.top=Z.y+"px";}function L(Z,Y){if(!V){V=I.createElement("div");U=V.style;V.className=A;V.innerHTML='<div class="'+A+'-inner"></div>';P=V.firstChild;I.body.appendChild(V);}F(Z,Y);U.display="block";}function R(){if(U){U.display="none";}}function H(Y){var Z=++B.ctxt.moveCount;if(Z>=B.minMoves){B.stopDragCheck();if((Y.buttons===1||Y.buttons===undefined||E.isIE9)&&(Y.which===1||Y.button===0||E.isIE8)){B.startDrag(self,Y);}}}function N(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDragCheck();delete B.ctxt;}}function D(Y){B.onDragMove(self,Y);}function C(Y){if(E.isPrimaryMouseBtn(Y)){B.stopDrag(window,Y);}}function J(Z){var Y=E.findWidget(Z);while(Y){if(Y.draggable){return Y;}Y=Y.parent;}return null;}function S(Y){var a=Y.src,Z=J(a.node);if(!Z){return null;}if(Z.getDragAction){Y.action=Z.getDragAction(Y);}a.widget=Z;a.data=Z.getDragData&&Z.getDragData(Y);if(Z.isDragValid){if(!Z.isDragValid(Y)){if(!mstrApp.isInVFInteractMode&&(!Z.shouldDragBubble||Z.shouldDragBubble(Y)===true)){Y.src.node=Z.domNode.parentNode;return S(Y);}return null;}}if(Z.ondragstart){Z.ondragstart(Y);}return Z;}function X(a,Z){var Y=E.findWidget(a),b=Z.tgt&&Z.tgt.widget;while(Y){if(Y.dropZone){if(Y===b){return Y;}if(Y.allowDrop&&Y.allowDrop(Z)){return Y;}}Y=Y.parent;}return null;}function W(){if(this.set){this.set("allowingDrop",false);}}mstrmojo.dnd=mstrmojo.dnd||mstrmojo.provide("mstrmojo.dnd",{minMoves:3,enable:function(){if(!mstrmojo.dndEnabled){E.attachEvent(I,K,G);mstrmojo.dndEnabled=true;}},disable:function(){mstrmojo.dndEnabled=false;E.detachEvent(I,K,G);},startDragCheck:function(Y,Z){delete this.ctxt;var a=E.captureEventInfo({hWin:Y,e:Z});this.ctxt={src:a,moveCount:0,last:M.copy(a.pos),getDirection:function(b){return !!this.dir[b];},getCtxtDragData:function(){var b=this.src;return(b&&b.data)||{};},getCtxtDropData:function(){var b=this.tgt;return(b&&b.data)||{};}};if(this.minMoves){E.attachEvent(I,O,H);E.attachEvent(I,Q,N);}else{this.startDrag(Y,Z);}},stopDragCheck:function(){E.detachEvent(I,O,H);E.detachEvent(I,Q,N);},startDrag:function(Y,b){var Z=this.ctxt;Z.id=mstrmojo.now();var a=S(Z);if(!a){return ;}E.clearBrowserHighlights(Y);E.preventDefault(self,b);E.attachEvent(I,O,D);E.attachEvent(I,Q,C);var d=window.mstrApp;if(d&&d.setInteractive){this._changeAppStatus=d.setInteractive(false);}if(!a.ownAvatar){var c=Z.src;L(c.pos,c.data&&c.data.html);}},stopDrag:function(Y,f){E.detachEvent(I,O,D);E.detachEvent(I,Q,C);var b=this.ctxt,a=b.tgt||{},Z=E.captureEventInfo({hWin:Y,e:f,data:a.data}),d=X(Z.node,b);Z.widget=d;b.tgt=Z;if(d){if(d.ondrop){d.ondrop(b);}else{W.call(d);}}var c=b.src.widget;if(c&&c.ondragend){c.ondragend(b);}if(c&&!c.ownAvatar){R();}if(this._changeAppStatus){window.mstrApp.setInteractive(true);delete this._changeAppStatus;}},onDragMove:function(c,f){if(E.isSafari){E.clearBrowserHighlights();}var Y=this.ctxt,b=Y.tgt||{},Z=b.widget,d=E.captureEventInfo({hWin:c,e:f,data:b.data}),j=d.widget=X(d.node,Y),h=Y.last,a=d.pos;Y.dir={x:a.x>h.x,y:a.y>h.y};Y.last=M.copy(d.pos);Y.tgt=d;if(Z!==j){if(Z){if(Z.ondragleave){Z.ondragleave(Y);}else{W.call(Z);}}if(j){Y.tgt.data=(j.getDropData&&j.getDropData(Y))||{};if(j.ondragenter){j.ondragenter(Y);}else{if(j.set){j.set("allowingDrop",true);}}}}if(j){if(j.ondragover){j.ondragover(Y);}}var g=Y.src.widget;if(g&&g.ondragmove){g.ondragmove(Y);}if(g&&!g.ownAvatar){F(d.pos);}}});B=mstrmojo.dnd;B.enable();}());(function(){mstrmojo.requiresCls("mstrmojo.EnumAuthenticationModes");var A=mstrmojo.EnumAuthenticationModes;function C(G){var H,F,E={success:function(I){H=I.identityToken;},complete:function(){if(H){G=G+"?idToken="+H;}F.location.href=G;}};if(mstrConfig.seamlessLoginEnabled){if(mstrConfig.authMode===A.INTEGRATED.toString()){G+="?loginMode="+A.INTEGRATED;window.open(G,"_blank");}else{F=window.open();mstrmojo.xhr.request("GET",mstrConfig.taskURL,E,{taskId:"createIdentityToken"});}}else{window.open(G,"_blank");}}function D(){return mstrConfig&&mstrConfig.features&&mstrConfig.features["show-dossier-library-link"]&&!!mstrConfig.libraryWebBaseURL;}function B(F){var E=mstrConfig.libraryWebBaseURL+"app";if(F){E+="/"+mstrConfig.projectId+"/"+F;}return E;}mstrmojo.util.LibraryHelper=mstrmojo.provide("mstrmojo.util.LibraryHelper",{createTokenAndOpenLink:C,isLibraryConfigured:D,constructLibraryUrl:B});})();mstrmojo.requiresCls("mstrmojo.gm.GMEnums");var $GM=mstrmojo.gm,CHART_TYPE=$GM.EnumGraphType,PRP_DATA_LABELS=$GM.EnumDataLabels,PRP_LEGEND=$GM.EnumLegend,PRP_MIN_SIZE_TYPE=$GM.EnumMinSizeType,PRP_FIT_TO=$GM.EnumFitTo,ENUM_FIT_MODES=$GM.EnumContainerFitModes,NGM_GRID_LINE=$GM.EnumNGMGridLines;var ARIAL="Arial",OPEN_SANCE="Open Sans",ALL="ALL";var ENUM_LAYOUT_THEME={DEFAULT:"spatial",CLASSIC:"classic"};var classicProps={THEME_STYLE:ENUM_LAYOUT_THEME.CLASSIC,LAYOUT:{allFF:ARIAL,titleFF:ARIAL,dlvPadding:2,dlvMargin:4,dlvLOH_Compensation:1,ucTBLOHeight:1,drpChildPadding:4,drpLOHW_Compensation:0,cueBottomOffset:1},GRID:{paddingSize:5,mRatio:2,lRatio:3,gridTemplateVisible:false},HEATMAP:{smallGap:2,middleGap:4,largeGap:6,largerGap:8},NGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={cntrFitMode:ENUM_FIT_MODES.AUTOMATIC};return A;}())},OGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE,minRowHeight:20,fitTo:PRP_FIT_TO.AUTOMATIC};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={};A[CHART_TYPE.BAR]={shpBdrThk:1,shpBdrStyle:0};A[CHART_TYPE.PIE]={shpBdrThk:1,shpBdrStyle:0};A[CHART_TYPE.GRID]={shpFillTrans:70};return A;}())},KPI:{fontFamily:ARIAL,defaultFontClr:{1:"#444649",2:"#FFFFFF",3:"#FFFFFF",4:"#FFFFFF"}}},defaultProps={THEME_STYLE:ENUM_LAYOUT_THEME.DEFAULT,LAYOUT:{allFF:OPEN_SANCE,titleFF:OPEN_SANCE,dlvPadding:0,dlvMargin:0,dlvLOH_Compensation:0,ucTBLOHeight:0,drpChildPadding:12,drpLOHW_Compensation:12,cueBottomOffset:-2},GRID:{paddingSize:4.52,mRatio:1050/452,lRatio:1205/452,gridTemplateVisible:true},HEATMAP:{smallGap:1,middleGap:3,largeGap:5,largerGap:5,cellTextSize:11,fontFamily:"Open Sans SemiBold",leftPadding:10,topPadding:8,lineHeightTime:1.3,marginTop:"3px"},NGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE};A[CHART_TYPE.WATERFALL]={dataLabels:PRP_DATA_LABELS.HIDE};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={cntrFitMode:ENUM_FIT_MODES.FIT_TO_CONTENT,dlFntFml:OPEN_SANCE,rfLnFntFml:OPEN_SANCE,lgdFntFml:OPEN_SANCE,xAxTtFntFml:OPEN_SANCE,xAxLbFntFml:OPEN_SANCE,yAxTtFntFml:OPEN_SANCE,yAxLbFntFml:OPEN_SANCE,allTxtFntFml:OPEN_SANCE,rwHdrTxtFntFml:OPEN_SANCE,colHdrTxtFntFml:OPEN_SANCE,rwVlTxtFntFml:OPEN_SANCE,colVlTxtFntFml:OPEN_SANCE,ttlFntFml:OPEN_SANCE,dlFntSz:"9pt",rfLnFntSz:"9pt",lgdFntSz:"9pt",xAxTtFntSz:"9pt",xAxLbFntSz:"9pt",yAxTtFntSz:"9pt",yAxLbFntSz:"9pt",allTxtFntSz:"9pt",rwHdrTxtFntSz:"9pt",colHdrTxtFntSz:"9pt",rwVlTxtFntSz:"9pt",colVlTxtFntSz:"9pt",ttlFntSz:"9pt"};A[CHART_TYPE.WATERFALL]={yGridLnShw:NGM_GRID_LINE.AUTO,xGridLnShw:NGM_GRID_LINE.AUTO};return A;}())},OGM:{GENERAL_PROPS:(function(){var A={};A[ALL]={dataLabels:PRP_DATA_LABELS.HIDE,minRowHeight:20,fitTo:PRP_FIT_TO.NONE};A[CHART_TYPE.PIE]={legend:PRP_LEGEND.HIDE,legendShow:false,dataLabels:PRP_DATA_LABELS.SHOW_TEXT_ONLY};A[CHART_TYPE.SCATTER]={minSizeType:PRP_MIN_SIZE_TYPE.AUTO};return A;}()),DEFAULT_PROPS:(function(){var A={};A[ALL]={rwHdrShw:false,colHdrShw:false,dlFntFml:OPEN_SANCE,rfLnFntFml:OPEN_SANCE,lgdFntFml:OPEN_SANCE,xAxTtFntFml:OPEN_SANCE,xAxLbFntFml:OPEN_SANCE,yAxTtFntFml:OPEN_SANCE,yAxLbFntFml:OPEN_SANCE,allTxtFntFml:OPEN_SANCE,rwHdrTxtFntFml:OPEN_SANCE,colHdrTxtFntFml:OPEN_SANCE,rwVlTxtFntFml:OPEN_SANCE,colVlTxtFntFml:OPEN_SANCE,ttlFntFml:OPEN_SANCE,dlFntClr:3815477,rfLnFntClr:3815477,lgdFntClr:3815477,xAxTtFntClr:3815477,xAxLbFntClr:3815477,yAxTtFntClr:3815477,yAxLbFntClr:3815477,allTxtFntClr:3815477,rwHdrTxtFntClr:3815477,colHdrTxtFntClr:3815477,rwVlTxtFntClr:3815477,colVlTxtFntClr:3815477,ttlFntClr:3815477,yAxTtFntStyle:1,xAxTtFntStyle:1,rwHdrTxtFntStyle:1,colHdrTxtFntStyle:1,dlFntSz:"9pt",rfLnFntSz:"9pt",lgdFntSz:"9pt",xAxTtFntSz:"9pt",xAxLbFntSz:"9pt",yAxTtFntSz:"9pt",yAxLbFntSz:"9pt",allTxtFntSz:"9pt",rwHdrTxtFntSz:"9pt",colHdrTxtFntSz:"9pt",rwVlTxtFntSz:"9pt",colVlTxtFntSz:"9pt",ttlFntSz:"9pt"};A[CHART_TYPE.AREA]={shpBdrThk:1,shpFillTrans:100,shpBdrClr:15461355};A[CHART_TYPE.BAR]={shpBdrClr:15461355,shpBdrStyle:0,shpBdrThk:1,shpFillTrans:100};A[CHART_TYPE.LINE]={shpFillTrans:100};A[CHART_TYPE.PIE]={shpBdrThk:1,shpBdrStyle:0,shpFillTrans:100,shpBdrClr:15461355};A[CHART_TYPE.SCATTER]={shpBdrStyle:99,shpFillTrans:40};A[CHART_TYPE.BUBBLE]={shpBdrStyle:99,shpFillTrans:40};A[CHART_TYPE.GRID]={shpBdrThk:1,shpFillTrans:100};return A;}())},KPI:{fontFamily:OPEN_SANCE,defaultFontClr:{1:"#35383A",2:"#FFFFFF",3:"#FFFFFF",4:"#FFFFFF"}}};mstrmojo.vi.enums.EnumThemeProperties={CLASSIC_THEME_PROPS:classicProps,DEFAULT_THEME_PROPS:defaultProps};mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE={GRID:"GRID",LAYOUT:"LAYOUT",HEATMAP:"HEATMAP"};mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_THEME=ENUM_LAYOUT_THEME;mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_STYLE={DEFAULT:0,CARD:1,FLAT:2};(function(){mstrmojo.requiresCls("mstrmojo.dom");var D=mstrmojo.dom;mstrmojo._FillsBrowser=mstrmojo.provide("mstrmojo._FillsBrowser",{_mixinName:"mstrmojo._FillsBrowser",getBrowserDimensions:function F(H){if(H){return{w:H.innerWidth,h:H.innerHeight};}var G=D.windowDim(),I=(D.isFF||D.isWK)?0:2;return{w:Math.max(G.w,0)+"px",h:Math.max(G.h-I,0)+"px"};},preBuildRendering:function B(){var I=this._super(),H=this.getBrowserDimensions();if(!this.browserResized||this.browserResized(H)!==true){this.height=H.h;this.width=H.w;}if(!this._listenerProc){var K=this.id,J=null,G=this._listenerProc=function(M){if(mstrApp&&mstrApp.isExporting){var L=M||window.event;mstrmojo.all[K].monitorWindow(L);}else{window.clearTimeout(J);J=window.setTimeout(function(){var N=M||window.event;mstrmojo.all[K].monitorWindow(N);},150);}};D.attachEvent(window,"resize",G);}return I;},destroy:function C(G){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);}this._super(G);},getResizeDimensions:function A(G){var J=G.currentTarget,I=this.getBrowserDimensions(),H={w:(J?J.innerWidth+"px":I.w),h:(J?J.innerHeight+"px":I.h)};return H;},monitorWindow:function E(G){var H=this.getResizeDimensions(G);if((H.h===this.height&&H.w===this.width)||parseInt(H.h,10)<=20||parseInt(H.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(H,true)!==true){if(H.h!==this.height){this.set("height",H.h);}if(H.w!==this.width){this.set("width",H.w);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");function G(J){return(J&&J.id);}mstrmojo._HasScrollbox=mstrmojo.provide("mstrmojo._HasScrollbox",{_mixinName:"mstrmojo._HasScrollbox",scrollListeners:null,scrollListenerCount:0,scrollInterval:50,scrollboxNode:undefined,scrollTo:function F(L,K){var J=this.scrollboxNode;J.scrollLeft=L.x;J.scrollTop=L.y;if(K){this.notifyScrollListeners(L);}},connectScrollbox:function E(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(!L){L={};this.scrollListeners=L;}if(!L[J]){L[J]=K;this.scrollListenerCount++;if(this.scrollListenerCount===1){this._attachScrollDom();}}},disconnectScrollbox:function D(K){if(!G(K)){return ;}var L=this.scrollListeners,J=K.id;if(L&&L.hasOwnProperty(J)){delete this.scrollListeners[J];this.scrollListenerCount--;if(!this.scrollListenerCount){this._detachScrollDom();}}},notifyScrollListeners:function C(K){var N=K||this.getScrollPos(),M=N.y,L=N.x;this.scrollboxTop=M;this.scrollboxLeft=L;this.scrollboxRight=L+this.scrollboxWidth;this.scrollboxBottom=M+this.scrollboxHeight;var J=this.scrollListeners,O;for(O in J){J[O].onscroll(this);}},getScrollPos:function H(){var J=this.scrollboxNode;return{x:J.scrollLeft,y:J.scrollTop};},_attachScrollDom:function A(){var M=this.scrollboxNode;if(M){var L=this.usesTouches;if(!L){if(!this.scrollCallback){var K=this.id;this.scrollCallback=function(){mstrmojo.all[K].notifyScrollListeners();};}mstrmojo.dom.attachBufferedEvent(M,"scroll",this.scrollCallback,this.scrollInterval);}if(this.scrollboxTop===null){this.scrollboxTop=L?0:M.scrollTop;}if(this.scrollboxLeft===null){this.scrollboxLeft=L?0:M.scrollLeft;}var J=function(P){var O=P.toLowerCase();var N=M.style[O];return(!isNaN(N)&&N.charAt(N.length-1)!=="%")?parseInt(N,10):M["client"+P];};if(this.scrollboxHeight===null){this.scrollboxHeight=J("Height");}if(this.scrollboxWidth===null){this.scrollboxWidth=J("Width");}this.scrollboxBottom=this.scrollboxTop+this.scrollboxHeight;this.scrollboxRight=this.scrollboxLeft+this.scrollboxWidth;this._attachedScrollbox=M;}},_detachScrollDom:function I(){var J=this._attachedScrollbox;if(J&&this.scrollCallback){mstrmojo.dom.detachBufferedEvent(J,"scroll",this.scrollCallback,this.scrollInterval);}delete this._attachedScrollbox;},scrollboxTop:null,scrollboxLeft:null,scrollboxHeight:null,scrollboxBottom:null,buildRendering:function B(){this._detachScrollDom();this._super();if(this.scrollListenerCount){this._attachScrollDom();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var J=mstrmojo.dom;var Z=5;var l=1;var W=2;var N=4;var k=0;var O=true;var I=0;var F=86400000;mstrmojo.VisChartUtils=mstrmojo.provide("mstrmojo.VisChartUtils",{getScreenZoomFactor:function a(){if(I==0){if(mstrMobileApp){var p=mstrMobileApp.getDeviceDPI();console.log("dpi:"+p);I=p/160;}else{I=1;}}return I;},changeElementSize:function b(s,w,v){if(w=="fontSize"||w=="height"||w=="line-height"){var u=mstrmojo.css.getStyleValue(s,w);var r=Math.round(v*parseInt(u));s.style[w]=r+"px";}else{if(w=="font"){var t=mstrmojo.css.getStyleValue(s,"fontSize");var r=Math.round(v*parseInt(t));var q=mstrmojo.css.getStyleValue(s,"fontWeight");var p=mstrmojo.css.getStyleValue(s,"fontFamily");s.style.font=q+" "+r+"px "+p;}}},rgbaStr2rgba:function L(p){var r=null;p=p.replace(/ /g,"");var q=p.indexOf("rgba");if(q>=0){p=p.substring(q+5,p.length-1);r=p.split(",");}return r;},fillBackground:function c(s,p,AB,q,u){var t=q||s.context,r=p||s.canvas.width,x=AB||s.canvas.height,z=s.themeColor||"#000000",w=null,AA=u||1;if(!t){t=s.canvas.getContext("2d");if(!t){return ;}}t.save();if(s.noBackground){}else{if(!s.isAndroid&&!s.isTimeSeries){w=t.createLinearGradient(0,0,0,x/2);t.fillStyle=z;t.fillRect(0,0,r,x);t.globalAlpha=0.4;w.addColorStop(0,"#fff");w.addColorStop(0.1,"#fff");w.addColorStop(1,z);t.fillStyle=w;t.rect(0,0,r,x/2);t.fill();t.globalAlpha=0.1;t.fillStyle="#fff";t.fillRect(0,0,r,x/2);}else{if(s.isTimeSeries){var v=s.formatProp;w=t.createLinearGradient(0,0,0,x);t.globalAlpha=v.backgroundAlpha;t.fillStyle=this.rgb2rgbStr(v.backgroundClr)||"#000000";t.rect(0,0,r,x);t.fill();}else{t.globalAlpha=AA;t.fillStyle=z;t.fillRect(0,0,r,x);}}}t.restore();},rgb2rgbStr:function X(q,r){var p="";if(!q||q.length!=3){return p;}if(r||r==0){p="rgba("+q[0]+","+q[1]+","+q[2]+","+r+")";}else{p="rgb("+q[0]+","+q[1]+","+q[2]+")";}return p;},getRGBWithOpacity:function R(q,p,r){if(isNaN(p)){return ;}if(!r){r=[255,255,255];}var s=[];for(color in q){s[color]=parseInt(q[color]*(1-p)+r[color]*p);}return s;},fillMasterChartBackground:function S(w,q,p,s,AD,v,t){var x=t||w.context,u=s||w.canvas.width,AB=AD||w.canvas.height,AC=w.themeColor,AA=null;var z=w.formatProp;x.save();x.globalAlpha=z.backgroundAlpha;x.fillStyle=this.rgb2rgbStr(z.backgroundClr)||"#000000";x.fillRect(0,0,u,p+AD+v);x.globalAlpha=1;x.strokeStyle=this.rgb2rgbStr(w.formatProp.textClr,0.5);x.lineWidth=1;var r=p+0.5;this.drawLineSet(this,[{x:q,y:r},{x:q+u,y:r}],false,x);r=p+AB-0.5;this.drawLineSet(this,[{x:q,y:r},{x:q+u,y:r}],false,x);x.restore();},drawLineSetWithSplit:function(u,z,x,q,v){var r=z.length,w=Math.ceil(r/v),p,s;for(var t=0;t<w;t++){p=t*v;s=Math.min(p+v+1,r);this.drawLineSet(u,z.slice(p,s),x,q);}},drawLineSet:function M(t,AA,z,p){var u=null,r=AA.length,x=null;if(p){u=p;}else{u=t.context;}var v=null,q=false;u.beginPath();var s=0;while(s<r){if(AA[s]){u.moveTo(AA[s].x,AA[s].y);v=AA[s];q=true;s++;break;}s++;}var w=false;for(;s<r;s++){x=AA[s];if(x){if(!w){u.lineTo(x.x,x.y);q=false;}else{u.moveTo(x.x,x.y);q=true;v=x;w=false;}}else{if(!w){w=true;if(q){u.arc(v.x,v.y,1,0,Math.PI*2,false);}}}}if(z){u.closePath();u.fill();}else{u.stroke();}},getMinYPosition:function H(q,t,p){var s=t,r;while(s<=p){if(q[s]){r=q[s].y;break;}s++;}for(s=t;s<=p;s++){if(q[s]){r=Math.min(r,q[s].y);}}return r;},drawLineAreaWithSplit:function(v,AC,p,t,s,w,q,x){var r=t-p+1,AA=Math.ceil(r/x),AB,z;for(var u=0;u<AA;u++){AB=p+u*x;z=Math.min(AB+x,p+r-1);this.drawLineArea(v,AC,AB,z,s,w,q);}},drawLineArea:function M(u,p,x,t,w,AC,r){var AB=null,AF=p.length,AA=null,AG=0,z=0;if(r){AB=r;}else{AB=u.context;}var s=null,AE=false;AB.save();AB.lineWidth=0;AB.beginPath();var AH=x,v;while(AH<=t){if(p[AH]){AG=p[AH].x;AB.moveTo(AG,w);s=p[AH];AE=true;break;}AH++;}v=AH;var AD=false;for(;AH<=t;AH++){AA=p[AH];if(AA){if(!AD){AB.lineTo(AA.x,AA.y);AE=false;z=AA.x;}else{AG=AA.x;AB.moveTo(AG,w);if(AH+1<=t&&p[AH+1]){AB.lineTo(AA.x,AA.y);}s=AA;AD=false;v=AH;}}else{if(!AD){AD=true;if(!AE){AB.lineTo(z,w);AB.lineTo(AG,w);var q=this.getMinYPosition(p,v,AH)||0;AB.fillStyle=this.rgb2rgbStr(AC,1);AB.globalAlpha=0.65;AB.fill();}}}}if(!AE){AB.lineTo(z,w);AB.lineTo(AG,w);var q=this.getMinYPosition(p,v,t)||0;AB.closePath();AB.fillStyle=this.rgb2rgbStr(AC,1);AB.globalAlpha=0.65;AB.fill();}AB.restore();},drawRectangle:function m(u,p,z,r,t,v,s){var q=null;if(s){q=s;}else{q=u.context;}if(v){q.fillRect(p,z,r,t);}else{q.strokeRect(p,z,r,t);}},drawArc:function Q(s,z,w,u,v,q,r,AA,p){var t=null;if(p){t=p;}else{t=s.context;}t.beginPath();t.arc(z,w,u,v,q,r);if(AA){t.fill();}else{t.stroke();}},drawRoundRect:function K(s,p,z,q,t,u,v){u=Math.min(q/2,t/2,u);s.beginPath();s.moveTo(p+u,z);s.arcTo(p+q,z,p+q,z+t,u);s.arcTo(p+q,z+t,p,z+t,u);s.arcTo(p,z+t,p,z,u);s.arcTo(p,z,p+q,z,u);s.closePath();if(v){s.fill();}else{s.stroke();}},drawHalfRoundedRectangle:function o(s,z,v,AA,t,p,AB,q){var u=null;if(q){u=q;}else{u=s.context;}u.beginPath();u.moveTo(z+AA,v);u.lineTo(z+p,v);u.arcTo(z,v,z,v+p,p);u.lineTo(z,v+t-p);u.arcTo(z,v+t,z+p,v+t,p);u.lineTo(z+AA,v+t);if(AB){u.fill();}else{u.stroke();}},drawStartEndPoints:function Y(x,AE,q,u){var t=AE.length;var z=null,p=x.startEndPointRadius;if(q){z=q;}else{z=x.context;}z.save();var AB="#f0f43e",AA="#f0f43e",AC="#663300";if(x.startPointColor){AB=x.startPointColor;}if(x.endPointColor){AA=x.endPointColor;}else{var AD=AE[0].y,w=AE[t-1].y;if(AD>w){AA="#008000";}else{if(AD<w){AA="#8d1616";}else{AA=AB;}}}if(x.otherPointColor){AC=x.otherPointColor;}if(u&l&&AE[0]){z.strokeStyle=AB;z.fillStyle=AB;this.drawArc(this,AE[0].x,AE[0].y,p,0,Math.PI*2,true,true,z);}if(u&W&&AE[t-1]){z.strokeStyle=AA;z.fillStyle=AA;this.drawArc(this,AE[t-1].x,AE[t-1].y,p,0,Math.PI*2,true,true,z);}if(u&N){z.strokeStyle=AC;z.fillStyle=AC;for(var v=1;v<t-1;v++){if(AE[v]){this.drawArc(this,AE[v].x,AE[v].y,p,0,Math.PI*2,true,true,z);}}}z.restore();},getColor:function U(p){return(parseInt(p.themeColor.substr(1),16)>8388607)?"#000000":"#ffffff";},drawHighlightLine:function e(q,u){var p=q.context,t=q.margin,s=t.l,r=q.isTimeSeries?q.chartWidth+t.l:q.getWidth()-t.r;p.save();p.globalAlpha=1;p.strokeStyle=this.rgb2rgbStr(q.formatProp.textClr,0.35);p.lineWidth=1;p.lineCap="round";while(s<r){p.beginPath();p.moveTo(s,u);s+=2;p.lineTo(s,u);p.stroke();s+=3;}p.restore();},addLabel:function n(AG,AH,AF,AD,q,z,AA){var AC=document.createElement("div");AC.className="mstrmojo-Chart-lbl";AC.style.color=this.rgb2rgbStr(AG.formatProp.textClr,0.8);AC.innerHTML=AH;if(q){AC.style.width=q+"px";}var t=null;var AB=0;if(AG.isTimeSeries){if(AA.w>=0){t=AG.xdiv;AB=AG.animationCanvas.width;}else{t=AG.domNode.getElementsByClassName("mstrmojo-chart-ylbl-div")[0];if(!t){t=document.createElement("div");t.id="mstrmojo-chart-ylbl-div";t.className="mstrmojo-chart-ylbl-div";AG.domNode.appendChild(t);}t.style.width=AG.margin.l-1+"px";}}else{t=AG.domNode;AB=AG.getWidth();}t.appendChild(AC);var s=AC.offsetWidth||(AG.getTextWidth&&AG.getTextWidthByElem(AH,AC));var AE=AC.offsetHeight||22*(I||1);var r=q||s||100;var v=AG.xLabelPadding/2;var u=AG.yLabelPadding/2;if(AA.w>=0&&AG.isTimeSeries&&AG._scroller.origin){var AI=AF-AG._scroller.origin.x;if(AI<=0&&(AI+s/2>-AG.maxYLblWidth)){AG.needRedrawVerticalLine=true;t.removeChild(AC);return null;}var p=AI-AG.getChartWidthOnScreen();if((p-s/2)<=0&&p>=0){AG.needRedrawVerticalLine=true;t.removeChild(AC);return null;}}if(AA.w>=0){AF=AF-r/2;}if(AA.h>=0&&((AD>=AA.y-u&&AD<=AA.y+AA.h)||(AD+AE>=AA.y-u&&AD+AE<=AA.y+AA.h)||(AD+AE>=AG.canvas.height-AG.margin.b))){t.removeChild(AC);return null;}if(AA.w>=0&&(((AF>=AA.x&&AF<AA.x+AA.w+v))||AF<AA.x||AF<AG.margin.l||AF+r>AB)){t.removeChild(AC);return null;}if(AG.isTimeSeries&&AA.h>=0){t.style.top=(AG.margin.t-AE/2)+"px";t.style.height=(AG.canvas.height-AG.margin.t-AG.margin.b-1+AE/2)+"px";this.translateCSS(AF,(AD-AG.margin.t)+AE/2,z,AC);}else{this.translateCSS(AF,AD,z,AC);AC.style.maxHeight=AE+"px";}AA.x=AF;AA.y=AD;if(AA.h>=0){AA.h=AE;}if(AA.w>=0){AA.w=r;AC.style.textAlign="center";}return AC;},addDataLabel:function n(q,s,u,r){var p=(q.margin.l>q.margin.r)?Z:q.getWidth()-q.margin.r+Z,t=(q.margin.l>q.margin.r)?q.margin.l:q.margin.r;return this.addLabel(q,s,p,u-10,t-Z*2,false,r);},translateCSS:function g(p,t,q,s){var r="translate("+p+"px,"+t+"px)";if(q){r+=" rotate(45deg)";}s.style[J.CSS3_TRANSFORM]=r;},getTouchXYOnWidget:function B(q,p,t){var s=mstrmojo.TouchScroller,r=(s&&t.parent&&s.getScrollPositionTotals(t.parent))||{x:0,y:0};q=q-t.offsetLeft+r.x;p=p-t.offsetTop+r.y;return{touchX:q,touchY:p};},getYValue:function A(t,q){var p=t.canvas.height,s=t.margin,r=t.model.mvalues;return p-s.b-4-((parseFloat(q)-r[0])*t.RTY);},getMasterYValue:function f(s,q,t){var p=s.masterCanvas.height,r=s.model.mvalues;return p-t.b-3-((parseFloat(q)-r[0])*s.MRTY);},getSeriesIndexAndYValue:function C(z,p,AA){var AB=z.model.series,t=AB.length,v=0;y=this.getYValue(z,AB[v].rv[p])||0;var x=AA-y<0?-(AA-y):AA-y,q=x;for(var u=1;u<t;u++){var r=this.getYValue(z,AB[u].rv[p])||0;x=AA-r<0?-(AA-r):AA-r;if(x<q){y=r;q=x;v=u;}}return{y:y,si:v};},getLabelWidthForMargin:function j(p,s){var r=document.createElement("div");r.className="mstrmojo-Chart-lbl";r.innerHTML=s;p.domNode.appendChild(r);var q=r.offsetWidth||60;p.domNode.removeChild(r);return q+Z*2;},animateLineSet:function V(AB,r,z,u){var AC=[],AA=AB.animationContext,s=z.length;AA.clearRect(0,0,AB.getWidth(),AB.canvas.height);if(!u.index){u.index=0;}else{if(u.index>=u.rate){this.drawLineSet(AB,z,false,AA);AB.drawLabels();if(AB.isFillLinesArea){this.fillLinesArea(AB,z.slice(0));}if(AB.isDrawStartEndPoints){this.drawStartEndPoints(AB,z,AA,AB.isDrawStartEndPoints);}return ;}}for(var t=0;t<s;t++){var q=z[t],p=r[t];AC[t]={x:(u.index*(q.x-p.x)/u.rate)+p.x,y:(u.index*(q.y-p.y)/u.rate)+p.y};}this.drawLineSet(AB,AC,false,AA);var v=this;u.index++;window.setTimeout(function(){v.animateLineSet(AB,r,z,u);},40);},fillLinesArea:function G(q,t){var r=q.canvas.height;t.push({x:q.getWidth()-q.margin.r,y:r-q.margin.b});t.push({x:q.margin.l,y:r-q.margin.b});var u=new Array();if(q.fillinColor){mstrmojo.requiresCls("mstrmojo.color");var s=mstrmojo.color.hex2rgb(q.fillinColor).join(",");u[0]="rgba("+s+", 0.8)";u[1]="rgba("+s+", 0.2)";}else{u=["rgba(255,128,0,0.8)","rgba(255,128,0,0.2)"];}var p=q.animationContext;var s=p.createLinearGradient(0,0,0,r);s.addColorStop(0,u[0]);s.addColorStop(0.75,u[1]);p.fillStyle=s;this.drawLineSet(q,t,true,p);},convertRawValueToMilliseconds:function h(r){var s=Number(r),p=s-((new Date("1/1/1970").getTime()-new Date("12/30/1899").getTime())/F)-k,q=new Date(p*F);return new Date(q.getUTCFullYear(),q.getUTCMonth(),q.getUTCDate()).getTime();},getAncestorBgColor:function D(r){var v=null,u=r,AA=u.modelData?u.modelData:u.model,z=null;if(u.hasOwnProperty("xtabModel")&&u.xtabModel.hasOwnProperty("docModel")){z=u.xtabModel.docModel;}if(z&&z.defn&&z.defn.layouts&&z.defn.layouts.length>0){var x=z.defn.layouts,s;var q;for(q in x){if(x[q].loaded){s=x[q];}}if(s&&s.hasOwnProperty("units")){var t=s.units;var w=AA.parent;while(w){var p=w.k||null;if(t[p]&&t[p].fmts&&t[p].fmts["background-color"]){v=t[p].fmts["background-color"];break;}else{w=w.parent||null;}}if(!v){if(s.fmts&&s.fmts["background-color"]){v=s.fmts["background-color"];}}}}return v;},isLightColor:function d(u){var q=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,v,p,w,AA,z,t=false;if(u){var AB,x;if(/^(rgba|RGBA)/.test(u)){x=u.replace(/rgba\(|RGBA\(/,"");x=x.replace(")","");AB=x.split(",");p=AB[0];w=AB[1];AA=AB[2];}else{if(/^(rgb|RGB)/.test(u)){x=u.replace(/rgb\(|RGB\(/,"");x=x.replace(")","");AB=x.split(",");p=AB[0];w=AB[1];AA=AB[2];}else{if(q.test(u)){if(u.length===4){AB="#";for(v=1;v<4;v++){AB+=u.slice(v,v+1).concat(u.slice(v,v+1));}u=AB;}var s=[];for(v=1;v<7;v+=2){s.push(parseInt("0x"+u.slice(v,v+2)));}p=s[0];w=s[1];AA=s[2];}}}z=(p*299+w*587+AA*114)/1000;if(z>150){t=true;}}return t;},getPointDistanceSquare:function E(q,p){return(q.x-p.x)*(q.x-p.x)+(q.y-p.y)*(q.y-p.y);},truncateTextToLine:function(q,AB,AF){AB.className=q.className;AB.style.whiteSpace="nowrap";var v=AB.innerHTML=q.innerHTML;var s=parseInt(q.offsetWidth)-parseInt(q.style.width);var AD=AF*parseInt(q.style.width)+s;var t=v;if(AB.offsetWidth>AD){var w=0,r=v.length-1;while(w<=r){var AA=Math.round((w+r)/2);var AE=v.substr(0,AA+1);var AC=v.substr(0,AA+2);AB.innerHTML=AE;var z=AB.offsetWidth;AB.innerHTML=AC;var u=AB.offsetWidth;if(z<=AD&&u>AD){break;}else{if(z>AD){r=AA-1;}else{if(u<=AD){w=AA+1;}}}}t=v.substr(0,AA+1);if(t.length<v.length){if(t.charAt(t.length-1)===" "){t=t.substr(0,t.length-1);}var x=t.lastIndexOf(" ");var p=t.length-1-x;if(p>=2&&p<=8){t=t.substr(0,t.length-p-1)+"...";}else{t=t.substr(0,t.length-3)+"...";}}}q.innerHTML=t;},getLen:function(s,r,q,p){r.innerHTML=s;var t=r.offsetWidth+q-p;return t;},splitWordIfTooLong:function(t,AE,AB,w,z){var AD=t.split(" ");var x=[];var AA=AD.length;var u=0;var s=0;for(u=0;u<AA;u++){var q=AD[u];while(true){var AF=this.getLen(q,AE,z,w);if(AF>AB){var AC=(AB/AF)*q.length;var p=Math.round(AC);while(p>0){var v=q.substr(0,p);var r=this.getLen(v,AE,z,w);if(r<=AB){x.push(v);break;}else{p--;}}q=q.substr(p,q.length-p);}else{x.push(q);break;}}}return x.join(" ");},truncateTextToLineWithWordWrap:function(AO,AK,AH){AK.className=AO.className;AK.style.whiteSpace="nowrap";var AG=7;var x=-1;if(AO.style&&AO.style.width&&AO.style.width.length>0){x=parseFloat(AO.style.width);}if(x<0){x=parseFloat(mstrmojo.css.getComputedStyle(AO).width);}var AI=AO.innerHTML;var AN=parseFloat(AO.offsetWidth)-x;AI=this.splitWordIfTooLong(AI,AK,x,AN,AG);var AA=AI.split(" ");var t=[];var AD=[];var AM=0;var p=0;var AF=AA.length;AK.innerHTML="&nbsp;";var AP=AK.offsetWidth-AN;AD.push(0);for(AM=0;AM<AF;AM++){var q=this.getLen(AA[AM],AK,AG,AN);if(q>x){var z=AA[AM];var AL=(x/q)*z.length;AA[AM]=z.substr(0,parseInt(AL));q=x;}t.push(q);p+=q;AD.push(p);if(AM!==AF-1){p+=AP;}}var AC=0,AJ=0;var AB=AH;for(;AJ<AD.length;){var w=AD[AJ]-AD[AC];if(AC>0&&AJ!=AC){w-=AP;}var v=AD[AJ+1]-AD[AC];if(AC>0&&AJ+1!=AC){v-=AP;}if(w<=x&&((AJ+1==AD.length)||(v>x))){AB--;if(AB==0||AJ===AF){break;}else{AC=AJ;AJ++;}}else{AJ++;}}if(AJ>AF){AJ=AF;}var AE=AD[AJ]-AD[AC];if(AC>0&&AJ!=AC){AE-=AP;}var AQ;if(AJ>=AF&&AE<x){AQ=AA.join(" ");}else{AQ=AA.slice(0,AJ).join(" ");var s=this.getLen("...",AK,AG,AN);if(AE+s<=x){AQ+="...";}else{if(AQ.charAt(AQ.length-1)===" "){AQ=AQ.substr(0,AQ.length-1);}var u=AQ.lastIndexOf(" ");var r=AQ.length-1-u;if(r===3){AQ=AQ.substr(0,AQ.length-3)+" ...";}else{AQ=AQ.substr(0,AQ.length-3)+"...";}}}AO.innerHTML=AQ;},getLen2:function(v,q,p){var r=p;var s=r.getContext("2d");s.font=q;s.textAlign="center";s.fillStyle="blue";var u=s.measureText(v);var t=u.width;return t;},splitWordIfTooLong2:function(u,AB,t,v){var AD=u.split(" ");var z=[];var AA=AD.length;var w=0;var s=0;for(w=0;w<AA;w++){var q=AD[w];while(true){var AE=this.getLen2(q,t,v);if(AE>AB){var AC=(AB/AE)*q.length;var p=Math.max(Math.round(AC),1);while(p>0){var x=q.substr(0,p);var r=this.getLen2(x,t,v);if(r<=AB||p==1){z.push(x);break;}else{p--;}}q=q.substr(p,q.length-p);}else{z.push(q);break;}}}return z.join(" ");},getComputedFontStyle:function P(p){var q=p.fontStyle+" "+p.fontWeight+" "+p.fontSize+"/"+p.fontVariant+" "+p.fontFamily;return q;},truncateTextToLineWithWordWrap2:function(AR,AK,AB,AJ){var AA=-1;if(AR.style&&AR.style.width&&AR.style.width.length>0){var AO=0;var AQ=mstrmojo.css.getComputedStyle(AR);if(AQ.paddingLeft){AO+=parseFloat(AQ.paddingLeft);}if(AQ.paddingRight){AO+=parseFloat(AQ.paddingRight);}var AP=AR.offsetWidth;AA=AP?AP-AO:parseInt(AR.style.width);}if(AA<0){AR.innerHTML="...";return ;}var w=mstrmojo.css.getComputedStyle(AR);var r=this.getComputedFontStyle(w);AK=this.splitWordIfTooLong2(AK,AA,r,AB);var AD=AK.split(" ");var u=[];var AG=[];var AN=0;var p=0;var AI=AD.length;var AS=this.getLen2(" ",r,AB);AG.push(0);for(AN=0;AN<AI;AN++){var q=this.getLen2(AD[AN],r,AB);if(q>AA){var AC=AD[AN];var AM=(AA/q)*AC.length;AD[AN]=AC.substr(0,parseInt(AM));q=AA;}u.push(q);p+=q;AG.push(p);if(AN!==AI-1){p+=AS;}}var AF=0,AL=0;var AE=AJ;for(;AL<AG.length;){var z=AG[AL]-AG[AF];if(AF>0&&AL!=AF){z-=AS;}var x=AG[AL+1]-AG[AF];if(AF>0&&AL+1!=AF){x-=AS;}if(z<=AA&&((AL+1==AG.length)||(x>AA))){AE--;if(AE==0||AL===AI){break;}else{AF=AL;AL++;}}else{AL++;}}if(AL>AI){AL=AI;}var AH=AG[AL]-AG[AF];if(AF>0&&AL!=AF){AH-=AS;}var AT;if(AL>=AI&&AH<AA){AT=AD.join(" ");}else{AT=AD.slice(0,AL).join(" ");var t=this.getLen2("...",r,AB);if(AH+t<=AA){AT+="...";}else{if(AT.charAt(AT.length-1)===" "){AT=AT.substr(0,AT.length-1);}var v=AT.lastIndexOf(" ");var s=AT.length-1-v;if(s===3){AT=AT.substr(0,AT.length-3)+" ...";}else{AT=AT.substr(0,AT.length-3)+"...";}}}AR.innerHTML=AT;return AT.indexOf("...")>-1;},truncateDivContent:function(u,z,r){z.innerHTML=u;if(z.offsetHeight>r){var v=0,q=u.length-1;while(v<=q){var AA=Math.round((v+q)/2);var AC=u.substr(0,AA+1);var AB=u.substr(0,AA+2);z.innerHTML=AC;var x=z.offsetHeight;z.innerHTML=AB;var t=z.offsetHeight;if(x<=r&&t>r){break;}else{if(x>r){q=AA-1;}else{if(t<=r){v=AA+1;}}}}var s=u.substr(0,AA+1);if(s.length<u.length){if(s.charAt(s.length-1)===" "){s=s.substr(0,s.length-1);}var w=s.lastIndexOf(" ");var p=s.length-1-w;if(p>=2&&p<=8){s=s.substr(0,s.length-p-1)+"...";}else{s=s.substr(0,s.length-3)+"...";}}return s;}else{return u;}},positionTooltip:function(AH,r,AM,w){if(!AH||!r||!AM){return ;}if(isNaN(w)){w=45;}var AJ=AM.offsetWidth,x=AM.offsetHeight,u=AH.offsetWidth,AG=AH.offsetHeight,AC=AH.style,z=0,AK=0;function v(){return u+w<r.x&&AG<x;}function s(){return AG+w<r.y&&u<AJ;}function t(){return r.x+w+u<AJ&&AG<x;}function AB(){return r.y+w+AG<x&&u<AJ;}function q(){return r.x>u/2&&(AJ-r.x)>u/2;}function p(){return r.y>AG/2&&(x-r.y)>AG/2;}function AL(){return s()&&v();}function AI(){return s()&&q();}function AF(){return s()&&t();}function AN(){return v()&&p();}function AE(){return AB()&&v();}function AO(){return t()&&p();}function AD(){return AB()&&q();}function AA(){return AB()&&t();}if(AL()){z=r.x-w-u;AK=r.y-w-AG;}else{if(AI()){z=r.x-u/2;AK=r.y-w-AG;}else{if(AF()){z=r.x+w;AK=r.y-w-AG;}else{if(AN()){z=r.x-w-u;AK=r.y-AG/2;}else{if(AE()){z=r.x-w-u;AK=r.y+w;}else{if(AO()){z=r.x+w;AK=r.y-AG/2;}else{if(AD()){z=r.x-u/2;AK=r.y+w;}else{if(AA()){z=r.x+w;AK=r.y+w;}}}}}}}}AC.left=z+"px";AC.top=AK+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom");var E=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function A(){var I=this.ifDataHelper,H=this,G=this.scrollNode||this.domNode;this.supportsIncFetch=I&&I.hasNext();if(I&&this.supportsIncFetch){this._scroll=function F(){var J=this.scrollNode||this.domNode||G;if(Math.ceil(J.offsetHeight+J.scrollTop)>=J.scrollHeight){H.raiseEvent({name:"incFetch",id:H.id});}};E.attachEvent(G,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(J){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);I.next({complete:function(K){if(H.postNext){H.postNext();}H.set("isFetching",false);},success:function(K){H.addItems(K.items||null);},failure:function(K){H.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+K);}});});}},unrender:function D(F){var G=this.scrollNode||this.domNode;E.detachEvent(G,"scroll",this._scroll);this._super(F);},render:function C(){this._super();if(this.supportsIncFetch){var F=this.scrollNode||this.domNode;E.attachEvent(F,"scroll",this._scroll);}},addItems:function B(F){if(this._super){this._super(F);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var G=this.scrollNode||this.domNode;E.detachEvent(G,"scroll",this._scroll);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var F=mstrmojo.dom;var W="touchstart",J="mousedown",P=F.isIOSTouch,S=P?W:J;function X(Z){var Y=Z[Z.hotSlot||"domNode"];if(Y){if(!Z._closeCallback){var b=Z.id,a=function(c){return function(f){var d=mstrmojo.all[b];if(d&&!d.ignoreHover){d["auto"+c](f,self);}};};Z._uncloseCallback=a("Unclose");Z._closeCallback=a("Close");}F.attachEvent(Y,"mouseover",Z._uncloseCallback);F.attachEvent(Y,"mouseout",Z._closeCallback);}}function C(Z){if(Z._closeCallback){var Y=Z[Z.hotSlot||"domNode"];if(Y){F.detachEvent(Y,"mouseover",Z._uncloseCallback);F.detachEvent(Y,"mouseout",Z._closeCallback);}}}function G(b,Z){var Y=b,a;while(Y){if(Y.open||Y.openPopup){a=Y.ignoreHoverCount||0;a=Z?(a+1):(a>0?a-1:a);Y.ignoreHoverCount=a;if(Y.set){Y.set("ignoreHover",(a>0));}else{Y.ignoreHover=(a>0);}}Y=Y.opener||Y.parent;if(Y&&Y.shouldPropagateLockHover&&!Y.shouldPropagateLockHover()){break;}}}function E(){var a=this._lockHoverCallback,Z=this.curtainNode,c=this._onClickChange;if(a){F.detachEvent(document.body,S,a,true);delete this._lockHoverCallback;}if(!Z||!c){return ;}var Y=mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp()||P,b=Y?W:J;F.detachEvent(Z,b,c);delete this._onClickChange;}mstrmojo._CanAutoClose=mstrmojo.provide("mstrmojo._CanAutoClose",{autoCloses:false,autoCloseDelay:100,locksHover:false,hotSlot:null,closeOnClick:false,curtainNode:null,postBuildRendering:function U(){this._super();if(this.autoCloses){X(this);}this.oncloseOnClickChange();},onautoClosesChange:function N(){var Y=(this.autoCloses)?X:C;Y(this);},oncloseOnClickChange:function I(){if(!this.curtainNode){return ;}var a=this,Y=mstrApp&&mstrApp.isTouchApp&&mstrApp.isTouchApp()||P,Z=Y?W:J;this._onClickChange=function(){a.close();if(Y){mstrmojo.touchManager.notify([]);}};F.attachEvent(a.curtainNode,Z,this._onClickChange);},autoUnclose:function H(){var Y=this._autoCloseTimer;if(Y){self.clearTimeout(Y);delete this._autoCloseTimer;}},autoClose:function L(){if(this.ignoreHover){return ;}if(this._autoCloseTimer){self.clearTimeout(this._autoCloseTimer);}if(this.opener){if(this.autoCloseDelay){var Y=this.opener.id;this._autoCloseTimer=self.setTimeout(function(){mstrmojo.all[Y].closePopup();},this.autoCloseDelay);}else{this.opener.closePopup();}}},destroy:function V(Y){E.call(this);this._super(Y);},lockHover:function R(){G(this,true);if(!this._lockHoverCallback){var Z=this.id,Y=this._lockHoverCallback=function(a){mstrmojo.all[Z]._unlockHoverCheck(a,self);};if((F.isIE7||F.isIE8)&&window.event&&(window.event.type===S)&&this.opener){this.opener._ignoreMousedown=true;}F.attachEvent(document.body,S,Y,true);}},unlockHover:function O(){G(this,false);E.call(this);},hoverLock:function(Y){G(this,Y);},suppressClose:function B(Y){return F.contains(this.domNode,Y,true,document.body);},_unlockHoverCheck:function D(b,Y){var Z=this.opener;if(Z&&Z._ignoreMousedown){delete Z._ignoreMousedown;return ;}var a=F.eventTarget(Y,b);if(!this.suppressClose(a)){if(this.isWithinParentWidget(a)){return ;}if(Z&&Z.onPopupAutoClosed){Z.onPopupAutoClosed(b,Y);}this.close(a);}},isWithinParentWidget:function Q(Z){var Y=F.findWidget(Z);while(Y){if(Y===this){return true;}Y=Y.parent||Y.opener;}return false;},open:function K(Z,Y){if(this.autoCloses){this.autoUnclose();}this._super(Z,Y);if(this.locksHover){this.lockHover();}},close:function M(Y){if(this.locksHover){this.unlockHover();}this._super(Y);},shouldPropagateLockHover:function A(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom;function D(J,I){var G=[];if(J){var F;for(F in J){var H=Number(F);if(H>=I){G.push(H);}}}G.sort(mstrmojo.array.numSorter);return G;}mstrmojo.ListSelector=mstrmojo.provide("mstrmojo.ListSelector",{premousedown:function E(L,F,N){if(C.isPrimaryMouseBtn(N.e)){var I=N.hWin,J=N.e,G=C.eventTarget(I,J),M=L.listMapper.findIndex(L,F,G);if(M>-1){var H=L.multiSelect,K=C.ctrlKey(I,J),O=C.shiftKey(I,J);if(K||O){C.clearBrowserHighlights(I);}if(H&&(K||(L.selectionPolicy==="toggle"))){L.toggleSelect(M);}else{if(H&&O){L.rangeSelect(M);}else{L.singleSelect(M);}}}}},premouseup:function B(H,K,G){var F=G.hWin,J=G.e,L=C.ctrlKey(F,J),I=C.shiftKey(F,J);if(L||I){C.clearBrowserHighlights(F);}},onadd:function A(I,H){var M=H&&H.value&&H.value.length;if(M){var G=H.index,K=I.selectedIndices,L=D(K,G),J;for(J=L.length-1;J>-1;J--){var F=L[J];K[F+M]=true;delete K[F];}if(I.selectedIndex>=G){I.selectedIndex+=M;}}},onremove:function A(Q,S){var O=S&&S.value&&S.value.length;if(O){var R=S.index,I=R+O-1,M=Q.selectedIndices,L=Q.selectedIndex,G=[],U=[],P=false;if(M){var H;for(H in M){var K=Number(H);if(K>I){G.push(K);}else{if(K>=R){U.push(K);P=true;}}}}G.sort(mstrmojo.array.numSorter);var J,N;for(J=0,N=G.length;J<N;J++){var F=G[J];M[F-O]=true;delete M[F];}if(L>I){Q.selectedIndex-=O;}if(P){Q.removeSelect(U);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx={enabled:true};var E=mstrmojo.dom;mstrmojo.fx._Effect=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.fx._Effect",duration:500,interval:50,delay:null,target:null,getTarget:null,widget:null,slot:null,preStart:null,postStart:null,onCancel:null,onEnd:null,revertOnCancel:true,isPlaying:false,started:false,init:function R(X){mstrmojo.hash.copy(X,this);},play:function C(){this.isPlaying=true;this.started=false;if(this.delay){var X=this;this.delayTimer=window.setTimeout(function(){X._start();X=null;},this.delay);}else{this._start();}},pause:function H(){if(this.delayTimer){window.clearTimeout(this.delayTimer);delete this.delayTimer;}if(this.timer){window.clearInterval(this.timer);delete this.timer;}this.isPlaying=false;},cancel:function V(){this.pause();if(this.started){if(this.revertOnCancel){this.counter=0;this.exec();}if(this.onCancel){this.onCancel();}this.started=false;}},_start:function F(){this.started=true;this._doTarget();this.steps=Math.max(Math.ceil(this.duration/this.interval),1);var X=this.ease;if(typeof X==="string"){this.ease=mstrmojo.registry.ref(X);}if(this._doPreStart()===false){this.started=false;this.isPlaying=false;return ;}this.counter=0;this.exec();this.counter++;this._doPostStart();if(this.counter>=this.steps){this._end();}else{var Y=this;if(this.timer){window.clearInterval(this.timer);}this.timer=window.setInterval(function Z(){if(Y){Y.exec();Y.counter++;if(Y.counter>=Y.steps){Y._end();Y=null;}}},this.interval);}},exec:null,_end:function D(){this.pause();this.started=false;if(this.onEnd){this.onEnd();}},_doTarget:function U(){if(this.getTarget){this.target=this.getTarget();}else{if(this.widget){this.target=this.widget[this.slot||"domNode"];}else{if(this.target){var Y=this.target;if(Y&&this.slot&&Y.scriptClass){var Z=Y[this.slot];if(Z){this.widget=Y;this.target=Z;}}}}}if(!this.target){var X=this;while(X=X.parent){if(!X||X.domNode){break;}}if(X){this.widget=X;this.target=X[this.slot||"domNode"];}}},_doPreStart:function N(){if(this.preStart){return this.preStart();}},_doPostStart:function S(){if(this.postStart){this.postStart();}}});function M(a,b){var Y=a.children,X=(Y&&Y.length)||0,Z;for(Z=0;Z<X;Z++){Y[Z][b]();}}mstrmojo.fx.Parallel=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Parallel",init:function R(a){this._super(a);var Z=this.children;mstrmojo.registry.refArray(Z);var X=(Z&&Z.length)||0,Y;for(Y=0;Y<X;Y++){Z[Y].parent=this;}},_start:function F(){this.started=true;if(this.preStart){this.preStart();}M(this,"play");if(this.postStart){this.postStart();}},pause:function H(){M(this,"pause");},cancel:function V(){M(this,"cancel");}});mstrmojo.fx.AnimateProp=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.AnimateProp",props:null,_start:function O(){var Z=this.props,a;for(a in Z){var Y=Z[a],X=Y.ease;if(typeof X==="string"){Y.ease=mstrmojo.registry.ref(X,{dontInst:true});}}this._super();},exec:function P(){var a=this.props,b;for(b in a){var Y=a[b],X=(Y.ease||mstrmojo.ease.sin)(this.counter,Y.start,Y.stop-Y.start,this.steps-1);if(Y.fn){X=Y.fn(X);}if(Y.suffix){X+=Y.suffix;}var Z=Y.isStyle===false?this.target:this.target.style;Z[b]=X;}}});mstrmojo.fx.Typewriter=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Typewriter",charGroupSize:1,srcProp:"text",_doPreStart:function(){this._super();this._dynStop=false;if(this.stop==null){var b=this.srcProp,Z;if(b){var X=this.widget||this.parent;Z=X&&X[b];if((Z!=null)&&(typeof (Z)!=="string")){Z=String(Z);}}this.stop=Z;this._dynStop=true;}if(this.stop==null){this.stop="";}var a=this.target,c=null,Y=1;if(a){a.innerHTML="";c=document.createTextNode("");a.appendChild(c);Y=Math.max(Math.floor(this.stop.length/this.steps),1);}this.targetTextNode=c;this.charGroupSize=Y;},exec:function(){var Y=this.targetTextNode;if(!Y){return ;}var X;if(this.counter>=this.steps-1){X=this.stop;}else{if(this.counter===0){X="";}else{X=this.stop.substring(0,this.charGroupSize*this.counter)+"_";}}Y.nodeValue=X;},_end:function D(){this._super();if(this._dynStop){this.stop=null;delete this._dynStop;}},cancel:function V(){if(this._dynStop){this.stop=null;delete this._dynStop;}}});mstrmojo.requiresCls("mstrmojo.dom");mstrmojo.fx.Fade=mstrmojo.declare(mstrmojo.fx._Effect,null,{scriptClass:"mstrmojo.fx.Fade",start:null,stop:null,ease:null,suffix:null,exec:function P(X){if(X==null){X=(this.ease||mstrmojo.ease.sin)(this.counter,this.start,this.stop-this.start,this.steps-1);}if(E.isIE&&!E.isWinPhone){this.target.style.filter="alpha(opacity="+parseInt(X*100,10)+")";}else{this.target.style.opacity=X;}}});mstrmojo.fx.FadeOut=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeOut",start:1,stop:0,revertOnCancel:true,cssDisplay:"block",_end:function D(){if(this.cssDisplay){this.target.style.display="none";this.exec(this.start);}this._super();},cancel:function V(){if(this.started&&this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();}});mstrmojo.fx.FadeIn=mstrmojo.declare(mstrmojo.fx.Fade,null,{scriptClass:"mstrmojo.fx.FadeIn",start:0,stop:1,revertOnCancel:true,cssDisplay:"block",_doPostStart:function W(){if(this.cssDisplay){this.target.style.display=this.cssDisplay;}this._super();},cancel:function(){if(this.started&&this.revertOnCancel&&this.cssDisplay){this.target.style.display="none";}this._super();}});function I(Z,Y,a){var X=Math.pow(10,a||2);if(Y){return parseInt(X*Z/Y,10)/X;}return parseInt(X*Z,10)/X;}mstrmojo.ease={linear:function L(Y,X,a,Z){if(Y===Z){return X+a;}if(Y===0){return X;}return X+a*I(Y,Z);},sin:function A(Y,X,a,Z){return X+a*Math.sin((Math.PI/2)*Y/Z);},cos:function B(Y,X,a,Z){return X+a*Math.cos((Math.PI/2)*(1-Y/Z));},sincos:function K(Y,X,a,Z){if(Y>Z/2){return X+a*Math.cos((Math.PI/2)*(1-Y/Z));}return X+a*Math.sin((Math.PI/2)*Y/Z);},cossin:function Q(Y,X,a,Z){if(Y>Z/2){return X+a*Math.sin((Math.PI/2)*Y/Z);}return X+a*Math.cos((Math.PI/2)*(1-Y/Z));},bounce:function G(Y,X,a,Z){if((Y/=Z)<(1/2.75)){return a*(7.5625*Y*Y)+X;}if(Y<(2/2.75)){return a*(7.5625*(Y-=(1.5/2.75))*Y+0.75)+X;}if(Y<(2.5/2.75)){return a*(7.5625*(Y-=(2.25/2.75))*Y+0.9375)+X;}return a*(7.5625*(Y-=(2.625/2.75))*Y+0.984375)+X;},shake:function J(Y,X,a,Z){if(Y<Z/2){return X+a*I(Math.sin(2*Math.PI*Y/8),null,2)*2*Y/Z;}return X+a*I(Math.sin(2*Math.PI*Y/8),null,2)*2*(1-Y/Z);}};}());(function(){mstrmojo.requiresCls("mstrmojo.models.template.Header");mstrmojo.models.template.Headers=mstrmojo.declare(null,null,{init:function D(K){var O=this.isRow=K.isRow,J=this.data=K.data,L=J.gts,G=J.ghs,F=this.hs=O?G.rhs:G.chs,M=this.i=K.i,N=0,I;this.titles=O?L.row:L.col;this.headers=F.items&&F.items[M]&&F.items[M].items;this.missingTitles=this.titles&&this.headers?(this.headers.length-this.titles.length):0;if(O&&this.headers){N=this.titles.length-this.headers.length;if(N){for(I=M-1;I>=0;I--){var E=F.items[I].items,H=E.length-this.headers.length;if(H>0){this.headers=E.slice(0,H).concat(this.headers);if(this.titles.length===this.headers.length){break;}}}}}},size:function B(){var E=this.headers;return(!E?0:E.length);},getHeader:function C(H){var F=this.headers,G=F&&F[H],E=H;if(G&&this.missingTitles){E=isNaN(G.tui)?G.ui:G.tui;}return G&&new mstrmojo.models.template.Header({h:G,t:this.titles[this.isRow?E:this.i]});},getCSS:function A(F){var E=this.headers;return E&&this.data.css[E[F].cni].n;},getHeaderCell:function(F){var E=this.headers;return E&&E[F];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.models.template.Titles","mstrmojo.models.template.MetricValue","mstrmojo.models.template.Headers","mstrmojo.models.datasets.DataInterface");var Y=mstrmojo.array,K=mstrmojo.hash,j=mstrmojo.string,V=mstrmojo.models.datasets.DataInterface,L=j.decodeHtmlString;var P=-1,g=1,S=2,E=3;var H=1,f=2,C=3;var I="0";function J(m){var n={};K.forEach(m,function(q,p){var o=[];Y.forEach(q,function(r){o.push({fillColor:r.fillclr,text:r.n});});n[p]=o;});return n;}function U(p){var AA=this.getTotalRows(),r=this.data,u=[],w=r.gts.col[0],o=w?w.es:[],z=o.length,s=0;p=K.copy(p,{minAttribute:1,minMetric:1});if(AA<p.minAttribute||z<p.minMetric){throw"Error";}do{var n=this.getRowHeaders(s),q,m={},v=n.size();for(q=0;q<v;q++){while(q<v&&n.getHeader(q).getFormIndex()!==undefined){q++;}if(q<v){var t=n.getHeader(q);m[t.t.n]=t.getName();}}for(q=0;q<o.length;q++){var x=this.getMetricValue(s,q).value;m[o[q].n]={v:x.v,rv:x.rv};}u.push(m);s++;}while(s<AA);return u;}function B(n){var m=[],o=this.data.gts.row;Y.forEach(o,function(q,p){Y.forEach(n,function(r){if(q.id===r.id){m[p]=true;}});});return m;}function e(AP){var w=this.getTotalRows(),AR=this.data,v=[],z=AR.gts.col[0],r=z?z.es:[],AG=r.length,u,AK=0;AP=K.copy(AP,{minAttribute:1,minMetric:1,colorByInfo:[],hasTitleName:false,hasSelection:false,needDecode:false});if(w<AP.minAttribute||AG<AP.minMetric){throw"Error";}var m=AP.needDecode,AM=AP.hasTitleName,AL=AP.hasSelection,AS=AP.hasThreshold,AE=AP.colorByInfo;var AQ=AS?J(AR.th):undefined;u=B.call(this,AE);do{var o=this.getRowHeaders(AK),q={},AI,AH=[],AO=AE.length,n={headers:[],values:[],colorInfo:[]};for(AI=0;AI<o.size();AI++){var AJ=o.getHeader(AI),AB=AJ.getName(),AU=AJ.t,t={name:m?L(AB):AB};if(AM){var AT=AU&&AU.n;t.tname=m?L(AT):AT;}if(AL){var AD=AU&&AU.id,x=AJ.getElementId();t.attributeSelector={n:AB,tid:AD,eid:x,isSelectAttr:true};q[AD]=[{n:AB,id:x}];}if(AO&&u[AI]===true){var AA=AJ.getElementId();AH.push(AA);}n.headers.push(t);}if(AO){n.colorInfo=AH;}for(AI=0;AI<r.length;AI++){var AF=this.getMetricValue(AK,AI).value,AN={v:AF.v,rv:AF.rv};if(AS){var s=AQ[AI],p=s&&s[AF.ti];if(p){AN.threshold=p;}}if(AM){var AC=this.getColTitles().titles[0].es[AI].n;AN.name=m?L(AC):AC;}n.values.push(AN);}if(AL){n.metricSelector=q;}v.push(n);AK++;}while(AK<w);return v;}function O(AF){var AI=this.data,q=this.getTotalRows(),r=AI.gts.col[0],o=r?r.es:[],u=o.length,v={},w=[],z,AA=0,x;AF=K.copy(AF,{minAttribute:1,minMetric:1,descKey:"name",childrenKey:"children",hasTitleName:false,hasSelection:false,needDecode:false,nestedLevel:undefined,colorByInfo:[]});if(q<AF.minAttribute||u<AF.minMetric){throw"Error";}var p=AF.descKey,s=AF.childrenKey,m=AF.needDecode,AC=AF.hasTitleName,AB=AF.hasSelection,n=AF.nestedLevel||0,AH=AF.hasThreshold,t=AF.colorByInfo,AD=t.length;var AG=AH?J(AI.th):undefined;v[p]="root";z=B.call(this,t);var AE=function(Ae,AL,AV,AY,AO){var AS=(Ae[s]=Ae[s]||[]),Af=AL.getHeader(AV),Aj=Af&&Af.t,Ac=Aj&&Aj.id,Aa=(Af&&Af.getName())||"",AW=AL&&AL.headers&&AL.headers.length||0,Ag,AZ=Af&&Af.getElementId(),AK=Y.filterOne(AS,function(Ak){return(Ak._eid===AZ);});Ag=Y.some(z,function(Al,Ak){return Al&&((AV-Ak)%AW===0);});var Ah=AV+1,AQ=[Aa];while(Ah<AL.size()){var AP=AL.getHeader(Ah),AJ=AP&&AP.t,AR=AJ&&AJ.id;if(AR===Ac){AV++;if(AP&&AP.getName()){AQ.push(AP.getName());}}else{break;}Ah++;}Aa=AQ.join(" ");if(AD&&Ag){w.push(AZ);}if(!AK||(AV===n-1)){AK={_eid:AZ};var AU=(Af!==undefined);if(AU){AK[p]=m?L(Aa):Aa;}if(AC&&AU){var Ai=Aj&&Aj.n;AK.tname=m?L(Ai):Ai;}if(AB&&AU){AK.attributeSelector={n:Aa,tid:Ac,eid:AZ,isSelectAttr:true};}AS.push(AK);}if(AB&&AU){AO[Ac]=[{n:Aa,id:AZ}];}if(AV<AL.size()-1&&(!n||(AV<n-1))){AE.call(this,AK,AL,AV+1,AY,AO);}else{var AX=this.getMetricValue(AY,0).value;if(AX){AK.value=AX.rv;AK.formattedValue=AX.v;}if(AD){AK.colorInfo=w;w=[];}AK.values=[];for(x=0;x<o.length;x++){var Ad=this.getMetricValue(AY,x).value,AM={v:Ad.v,rv:Ad.rv};if(AH){var AT=AG[x],AN=AT&&AT[Ad.ti];if(AN){AM.threshold=AN;}}if(AC){var Ab=this.getColTitles().titles[0].es[x].n;AM[p]=m?L(Ab):Ab;}AK.values.push(AM);}if(AB){AK.metricSelector=AO;}}};do{AE.call(this,v,this.getRowHeaders(AA),0,AA,{});AA++;}while(AA<q);return v;}function X(m,n){var o=[];Y.forEach((m.row||[]).concat(m.col||[]),function(p){if((p.id===n)&&(p.fs)){o=o.concat(p.fs);}});return o;}mstrmojo.models.template.DataInterface=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.models.template.DataInterface",data:null,init:function(m){this.data=m;},getRowTitles:function(){return new mstrmojo.models.template.Titles({data:this.data,isRow:true});},getColTitles:function(){return new mstrmojo.models.template.Titles({data:this.data,isRow:false});},getTotalRows:function b(){if(this.data.eg){return 0;}var o=this.data,n=o&&o.ghs,m=n&&n.rhs,p=m&&m.items;return(p&&p.length)||0;},getTotalColHeaderRows:function c(){var m=this.data.ghs.chs.items;return(m&&m.length)||0;},getTotalCols:function D(){return this.getColHeaders(0).size();},getRowHeaders:function W(m){return new mstrmojo.models.template.Headers({data:this.data,i:m,isRow:true});},getColHeaders:function Z(m){return new mstrmojo.models.template.Headers({data:this.data,i:m,isRow:false});},getMetricValue:function F(o,m){var n=this.data;return new mstrmojo.models.template.MetricValue({data:n,value:n.gvs.items&&n.gvs.items[o].items[m]});},getColumnHeaderCount:function N(){var m=this.data.gvs.items;return m?m[0].items.length:0;},getCSSString:function a(){return this.data.cssString;},isEmpty:function M(){var m=this.data.gsi;return !m||(!m.rows.length&&!m.cols.length&&!m.mx.length);},getAggregatePadding:function G(){var n=this.data.gsi&&this.data.gsi.fmts,o=function(q,p){return q+p;},m=function(q){var p=0;return["ch","rh","va"].map(function(r){var s=false;return q.map(function(t){if(n[r]&&n[r].hasOwnProperty(t)){if(!s){s=true;p++;}return n[r][t];}return 0;}).reduce(o)/q.length;}).reduce(o)/(p||1);};if(!n){return null;}return{v:m(["tp","bp"]),h:m(["rp","lp"])};},getColResizeScenario:function h(){var m=this.data;if(m.afw){return g;}else{if(m.afc===false){return E;}else{return S;}}},getColResizeInfo:function d(r){var s=this.data,p={v:this.getColResizeScenario(),widths:null};var t=s.gsi,n=s.gts||{},w=[],q=s.twm||{},u=q.top||[],v=q.bottom||[],o=0,m=function(z,x){if(t){t[z].every(function(AB){var AC=AB.did,AD=X(n,AC),AA=V.getFormsByAttrId(AC,r);(AD.length?AD:[]).forEach(function(AG,AF){var AH=AA[Y.find(AA,"fid",AG.id)],AE=(v&&v[o])||{};w.push({n:AB.n+(AA.length?(" - "+AH.fnm):""),did:AC,depth:AF+1,t:AB.t||4,width:parseInt(AE.w||0,10),widthModel:{top:(u&&u[o])||{},bottom:AE}});o++;});return !x;});}};m("rows",false);if(w.length===0){m("cols",false);}m("mx",t.tma===1);p.widths=w;return p;},getRowResizeScenario:function Q(){return !!this.data.rh?E:S;},getRowResizeInfo:function A(){var n=this.data,m=n.rh;return{v:this.getRowResizeScenario(),height:(m===undefined||m==="")?n.xrh:m};},getColumnHeaderData:function R(x){var s=this.data,AA=s.gts,z=s.gts.rec,AB=[],n=[],v=AA.row,t=s.gsi.prop.rows.shw===I&&x;Y.forEach(v,function(AD){var AC=AD.fs,AE=AD.otp===P;if(!t){if(AC&&AC.length>1){Y.forEach(AC,function(){AB.push(AD);});}else{AB.push(AD);}}if(AE){n=AD.es;}});var r=AA.col;if(r&&r.length>0){var q=s.ghs,o=q.chs,m=o.items,w=m[m.length-1].items,p=function p(AC){var AD=AC.pi,AE=AD&&AD.ci,AF=AD&&AD.ri;if(AC.mix!==undefined){return AC;}if(AF===undefined||AE===undefined){return ;}return p(m[AF].items[AE]);};Y.forEach(r,function(AC){var AD=AC.otp===P;if(!t&&(AD&&(!z||v.length===0))){AB.push(AC);}if(AD){n=AC.es;}});var u=AB.length;Y.forEach(w,function(AC){delete AC._ridx;});if(n.length>0){Y.forEach(w,function(AF){var AC=p(AF);var AG=AC?AC.idx:(AF.pi?0:AF.idx),AE=n[AG]||n[0];var AD=AE._ridx=AE._ridx||[];if(AD.length===0){Y.forEach(w,function(AI,AJ){var AH=p(AI);if(!AC||AH.mix===AG){AD.push(u+AJ);}});}AB.push(AE);});}}else{if(n.length>0){AB.push(n[0]);}}return AB;},getUnitById:function k(o){var n=this.data.gsi,m=null;[n.rows,n.cols,n.mx].some(function(p,q){if(q===2){q=-2;}p.some(function(r,s){if(r.did===o){m={axis:q+1,depth:s+1,unit:r};}return !!m;});return !!m;});return m;},getRawData:function l(m,n){switch(m){case f:return U.call(this,n);case C:return e.call(this,n);}return O.call(this,n);}});mstrmojo.models.template.DataInterface.inflateGridData=function(o){var p=o.gvs,n=o.ghs;if(o.egt===undefined&&(o.eg===undefined||o.eg===null)&&!!p&&K.isEmpty(p)){var m={v:"",rv:""},q={items:(n.chs.cws||[0]).map(function(){return m;})};p.items=n.rhs.items?n.rhs.items.map(function(){return q;}):[];p.show=true;}};mstrmojo.models.template.DataInterface.ENUM_GRID_RESIZE={FIT_TO_WINDOW:g,FIT_TO_CONTENTS:S,FIXED:E};mstrmojo.models.template.DataInterface.ENUM_RAW_DATA_FORMAT={TREE:H,ROWS:f,ROWS_ADV:C};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ListSelector");var A=mstrmojo.dom;mstrmojo.TreeBrowserSelector=mstrmojo.provide("mstrmojo.TreeBrowserSelector",mstrmojo.hash.copy({premousedown:function B(F,I,E){if(A.isPrimaryMouseBtn(E.e)){var D=E.hWin,H=E.e,G=A.eventTarget(D,H),C=F.listMapper.findIndex(F,I,G);if(C>-1){F.toggleSelect(C);}}}},mstrmojo.hash.copy(mstrmojo.ListSelector)));})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.ListSelector");var C=mstrmojo.dom,B=C.isIE;mstrmojo.TreeNodeSelector=mstrmojo.provide("mstrmojo.TreeNodeSelector",mstrmojo.mixin({premousedown:function A(E,I,D){var G=(E&&E.tree)||E,H=D&&D.e;if(!H){return false;}var F=G.lastMouseDown;if(F){if((F.e===H)||(B&&((new Date())-F.dt<50))){return false;}}this._super(E,I,D);if(G){if(G.onnodemousedown){G.onnodemousedown(D);}G.lastMouseDown={e:H,dt:new Date()};}return true;}},mstrmojo.hash.copy(mstrmojo.ListSelector)));}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dnd");var d=mstrmojo.array,N=mstrmojo.hash,c=d.fnReduceNumber;mstrmojo.vi.ui.BoxLayoutType=null;var Y="c";var e="b";var P="h";var u="v";var O="|";var l=false;function I(v){mstrmojo.all[this.hostId].buildBoxLayout(v);}function R(w){w=w||"";var v=w.split(O);return{target:parseInt(v.pop(),10),parentPathArray:v,parentPath:v.join(O)};}function B(z,w){if(!z){return undefined;}w=w||this.box;var x=R(z),v=w;x.parentPathArray.forEach(function(AB){v=v.children[AB];});var AA=function(AC,AG,AE){var AI=AG.children,AB=AI[AC],AH=function(AM,AK,AL){if(AM.t===Y){return mstrmojo.all[AM.id].getMinBoxSize(AG.o)+(AL?this.padding:0);}var AJ=AM.children.map(function(AN){return AH(AN,AK,AL);});if(AM.o===AK){return AJ.reduce(c);}return Math.max.apply(null,AJ);}.bind(this),AF=function(AK,AM,AJ,AL){return AK.map(function(AO,AN){return AA(AN+AM,AJ||AG,parseInt(AL)===0?0:(AL||AE));});},AD=function(AK){var AJ=[0,AC];if(AK){AJ=[AC+1];}return AF(Array.prototype.slice.apply(AI,AJ),AK?AC+1:0);};return{idx:AC,path:(AE||parseInt(AE)===0)?(AE+O+AC):AC,parent:AG,parentPath:AE,siblings:AI,box:AB,getBoxLength:function(){return AB[AG.o==="v"?"h":"w"];},getSiblings:function(){return AF(AI,0);},getPreviousSiblings:function(){return AD();},getNextSiblings:function(){return AD(true);},getMinimumBoxSize:function(AJ,AK){return AH(AB,AJ,AK);},getChildren:function(){return AF(AB.children||[],0,AB,this.path);}};}.bind(this);if(v&&v.children){return AA(x.target,v,x.parentPath);}else{return undefined;}}function M(x,w){var v=mstrmojo.all[x].getBoxConfiguration().f;return v&&v[w];}function D(v){return v.filter(function(w){return !w.f;});}function W(v){return !v.some(function(w){return !w.f;});}function f(AB,v,AA){if(AB.length){var x=AA?0:v,z=AA?v:0,w=AB[0];AB.forEach(function(AD){var AC=Math.round((AD.l/(100-x))*v);AD.l+=AA?-AC:AC;z+=AD.l;w=AD;});w.l+=100-z;}}function j(x,w){var v=D(x);w=w||Math.round(100/(v.length+1));f(v,w,true);return w;}function E(w,v){f(D(w),v);}function F(v){return !v.children.some(function(w){if(w.t===Y){return !mstrmojo.all[w.id].getBoxConfiguration().f;}return !F(w);});}function n(AB,x){var z=AB.children,w=z.reduce(function(AC,AD){return AD.l+AC;},0);z.forEach(function(AC){delete AC.f;AC.l=Math.round((AC.l/w)*100);});if(AB!==this.box){AB.f=true;AB.l=AB[AB.o==="h"?"h":"w"];if(x){var v=B.call(this,x),AA=v.box;if(W(AA.children)){n.call(this,AA,v.parentPath);}}}}function g(AB,w){var AE=AB.children,v=0;AE.filter(function(AF){return AF.t===Y;}).forEach(function(AF){v+=AF.l;AF.f=true;AF.l=M(AF.id,AB.o);});D(AE).forEach(function(AF){AF.l=Math.round(AF.l*(100/(v||100)));});var AC=this.box;if(AB!==AC){var AA=w&&B.call(this,w),z=(AA&&AA.box)||AC;if(F(z)){g.call(this,z,AA&&AA.parentPath);return ;}var x=z.children,AD=x.indexOf(AB);delete AB.f;x.splice(AD,1);AB.l=j(x);x.splice(AD,0,AB);}}function r(v){if(typeof v!=="string"){return undefined;}return parseInt(v,10);}function h(v,z){var w=false;var x=r(v);if(x!==undefined){v=x;w=true;}return{f:w,l:v===undefined?100:v,r:!!z};}function J(v){return function(w,x){if(!!v){w.push(x);}else{w.splice(0,0,x);}return w;};}function Z(v){if(l){console.log(JSON.stringify({t:v,cfg:this.box}));}}function L(AA,AC,z,AB){var AD=this.getNewRootBox(AA===u),w=this.box,x=w.children,v=x.length>1?w:x[0];AC.l=AB||50;v.l=AB?100:50;AD.children=z([v],AC);this.box=AD;}function G(v,AD,z,AA){var AC=this.identifier,w=this.box,x=w.children,AE={t:Y,f:false,l:100,id:v.id},AB=J(AA);AE[AC]=v[AC];if(F(w)){if(AD){AD=0;}else{g.call(this,w);}}AE.f=!!AD;if(z){if(z===w.o){AE.l=AD||j(x);AB(x,AE);}else{L.call(this,z,AE,AB,AD);}}else{AE.l=AD||j(x);AB(x,AE);}Z.call(this,"addRootChild");}mstrmojo.vi.ui.BoxLayoutConfig=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.ui.BoxLayoutConfig",identifier:"k",padding:4,hostId:"",box:null,boxPaths:null,init:function q(v){N.copy(v,this);},validateBoxLayout:function C(v,w){w=w||this.box;var AA=this.identifier,x=function(AD){var AC=AD.children,AE=AC.filter(function(AF){return AF.t===e;});var AB=AC.length;if(AB===AE.length&&AB===1){return false;}return AE.map(x).reduce(function(AF,AG){return AF&&AG;},true);},z=function(){var AC=v.map(function(AE){return AE[AA];}),AD=function(AF){var AE=[];AF.children.forEach(function(AG){if(AG.t===e){AE=AE.concat(AD(AG));}else{AE.push(AG[AA]);}});return AE;},AB=AD(w);return(AB.length!==0||AC.length===0)&&AB.every(function(AE){return AC.indexOf(AE)>-1;});}.bind(this);return x(w)&&z();},useDefaultBox:function(z,AC){var x=this.identifier,w=Math.round(100/z.length),AA=this.getNewRootBox(this.box&&this.box.o===u),v=0,AB=null;AA.children=z.map(function(AJ,AG){var AE={t:Y},AF=w,AH=false;if(AC){AF=AC[AG];var AI=r(AF);if(AI!==undefined){AF=AI;AH=true;}}if(!AH){v+=AF;AB=AE;}AE.l=AF;AE.f=AH;AE[x]=AJ[x];return AE;});if(AB){var AD=100-v;if(AD){AB.l+=AD;}}this.box=AA;return AA;},getNewRootBox:function S(v){return{t:e,o:v?u:P,children:[]};},addNewChild:function U(x,w,AA,z){var v=h(w,z);v.t=Y;v[this.identifier]=AA;x.children.push(v);},getBoxState:function b(){return JSON.parse(JSON.stringify(this.box));},getResizeBoundaries:function s(AA,x){var w={min:0,max:0},v=function(AC,AB){if(!AB){return ;}AB.getPreviousSiblings().forEach(function(AD){w.min+=AD.getMinimumBoxSize(x,true);});AB.getNextSiblings().forEach(function(AD){w.max+=AD.getMinimumBoxSize(x,true);});AC.pop();AC.pop();v(AC,B.call(this,AC.join(O)));}.bind(this);var z=B.call(this,AA);w.min+=z.getMinimumBoxSize(x,true)-this.padding;v(AA.split(O),z);return w;},resizeBox:function p(AA,AB){var v=0,AC=1,z=2,x=function(AF,AK,AI,AJ){var AG=Math.abs(AI);AI=-AG;AF.forEach(function(AO){var AP=AO.getBoxLength(),AM=0;if(AI){var AN=Math.max(AP+AI,AO.getMinimumBoxSize(AO.parent.o,false));AM=AP-AN;AI+=AM;AP=AN;}AJ.push({idx:AO.idx,l:AP,f:AO.box.f,d:-AM});});var AH={},AL;AK.forEach(function(AO,AM){var AN=AO.getMinimumBoxSize(),AP=AO.getBoxLength();if(AP<AN&&AG>0){AH[AM]=Math.min(AN-AP,AG);AG-=AH[AM];}});AK.forEach(function(AO,AN){var AM=0;AL=AO.getBoxLength();if(!AN){AM=AG;AL+=AG;}if(AH[AN]){AL+=AH[AN];}AJ.push({idx:AO.idx,l:AL,f:AO.box.f,d:AM});});return AI;},w=function(AG,AF,AH){var AJ=B.call(this,AG),AK=AJ.getPreviousSiblings().concat(AJ),AI=AK,AL=AJ.getNextSiblings();AK.reverse();if(AF>=0){AI=AL;AL=AK;}return x(AI,AL,AF,AH);},AD=function(AG,AF){return function(AI,AH,AJ){var AL=B.call(this,AI),AM=AL.getSiblings(),AK=AM,AN=[];if(AG){AM.reverse();}if(AF){AK=[];AN=AM;}return x(AK,AN,AH,AJ);};},AE=function(AI,AL,AK,AF){var AH=B.call(this,AI);if(!AH){return ;}var AQ=AH.idx,AN=AH.getSiblings(),AJ=[],AO=AK.call(this,AI,AL,AJ);var AG=AJ.filter(function(AR){return !AR.f;}),AM=AG.map(function(AR){return AR.l;}).reduce(c,0);AG.forEach(function(AR){AR.l=(AR.l/AM)*100;});AJ.forEach(function(AT){var AV=AT.idx,AS=AN[AV],AR=AT.d;if(AR!==0&&(AF!==z||AV!==AQ)){var AU=AD(AV<AQ,AR>0);AS.getChildren().forEach(function(AW){if(AW.box.t===e){AE(AW.path+O+"0",AR,AU,AC);}});}AS.box.l=AT.l;});if(AF!==AC&&AO){var AP=AI.split(O);AP.pop();AP.pop();if(AP.length){AE(AP.join(O),AL<0?AO:-AO,w,z);}}}.bind(this);AE(AA,AB,w,v);},insertNewRootChild:function t(z,x){var v=z.getBoxConfiguration(),w=v.o,AA=v.addToEnd;if(x){w=x==="Left"||x==="Right"?"h":"v";AA=x==="Right"||x==="Bottom";}G.call(this,z,(v.f&&v.f[w])||0,w,AA);},insertExistingRootChild:function Q(AA,AB){var w=AA.src.widget,z=AA.box.oldPathInfo,v=w.getBoxConfiguration(),x=AB==="Left"||AB==="Right"?"h":"v",AC=(v.f&&v.f[x])||0;if(AC&&z.parent.o===x){AC=z.box.l;}G.call(this,w,AC,x,AB==="Right"||AB==="Bottom");AA.dropSuccessful=true;},getBoxOrientation:function K(w){var v=B.call(this,w);return v&&v.parent&&v.parent.o;},getBoxPath:function k(v){return this.boxPaths[v[this.identifier]];},deleteBox:function X(v,AK){var AJ=B.call(this,this.getBoxPath(v));if(!AJ){return ;}var AG=AJ.box,AL=AJ.idx,x=AJ.parent,AB=AJ.parentPath,AE=B.call(this,AB),AC=AJ.siblings;AC.splice(AL,1);if(AC.length>1){if(W(AC)){n.call(this,x,AB);}else{if(!AG.f){E(AC,AG.l);}}}else{var AM=AC[0],AA=AM&&(AM.t===e),AN=AM&&AM.f;if(AE){var AD=AE.parent,AI=F(AD),AF=[];if(AA){AF=AM.children;if(AI){g.call(this,AD,R(AD.parentPath).parentPath);}if(AN){AF.forEach(function(AO){AO.f=true;AO.l=Math.round((AO.l/100)*AM.ps);});}else{D(AF).forEach(function(AO){AO.l=Math.round((AO.l/100)*x.l);});}}else{AF.push(AM);var w=M(AM.id,AD.o);if(!AI&&w){AN=AM.f=true;}if(AN){AM.l=w;}else{AM.l=x.l;}}var AH=AD.children;AH.splice.apply(AH,[AE.idx,1].concat(AF));}else{var z=this.box;if(AA){z.children=AM.children;z.o=AM.o;if(AN){n.call(this,z);}}else{if(AM){delete AM.f;AM.l=100;}}}}Z.call(this,"delete");if(!AK){I.call(this,true);}else{mstrmojo.all[this.hostId].updateBoxPaths();}},beginBoxMove:function V(w,z,x){var AA=B.call(this,this.getBoxPath(z)),v;if(AA){v=AA.box;}w.box={initState:this.getBoxState(),oldPathInfo:AA,boxId:z.id,parentPath:AA.parentPath,length:v.l,orientation:AA.parent.o};if(!x){this.deleteBox(z);}},addDropBox:function A(AG,AF,AC){var AE=(AF==="Right"||AF==="Bottom"),AI=(AF==="Top"||AF==="Bottom")?u:P,AW=this.identifier,AB=B.call(this,this.getBoxPath(AG)),AJ=AB.idx,AM=AB.parent,AP=AB.siblings,AS=AB.parentPath,AT=F(AM),AL=AM.f,x=AC.box,z=x.boxId,AU=mstrmojo.all[z],AO=AU.getBoxConfiguration(),AV=AO.f&&AO.f[AI],AA=AU.getMinBoxSize(AI),AN=M(AG.id,AI),AQ=AG.getMinBoxSize(AI),v=x.length,w={t:Y,f:!!AV,l:AV,id:z,r:!!AO.r};w[AW]=AU[AW];if(AV&&x.orientation===AI){AV=v;}if(!AV&&AT){g.call(this,AM,R(AS).parentPath);AL=false;}if(AI===AM.o){if(AV){if(AT){delete w.f;AV=undefined;}}if(AS!==x.parentPath){v=undefined;}w.l=AV||j(AP,v);AP.splice(AE?AJ+1:AJ,0,w);}else{if(AM===this.box&&AP.length===1){L.call(this,AI,w,J(AE),AV);}else{var AR=AB.box,AH=AR.f;var AK={l:AR.l,f:AH,o:AI,t:e};var AD=AK.children=[w,AR];AP.splice(AJ,1);if(AE){AD.reverse();}if(AL){if(AV){if(AN){AM.l=Math.max(AM.l,AV+AN);w.l=AR.l=50;delete w.f;delete AR.f;}else{AM.l=Math.max(AM.l,AV+AQ);w.l=AV;AR.l=100;}}else{if(AN){w.l=100;AR.l=AN;AM.l=Math.max(AM.l,AA+AN);}else{AM.l=Math.max(AM.l,AA+AQ);w.l=AR.l=50;}}}else{if(AV&&AH){AK.h=AR.h;AK.w=AR.w;w.l=AV;AR.l=AN;n.call(this,AK,AS);}else{if(AV){w.l=AV;AR.l=100;}else{if(AN){AR.l=AN;w.l=100;if(!AK.f){AK.l=j(AP,null);}}else{AR.f=false;AR.l=100;w.l=j([AR]);}}}}AP.splice(AJ,0,AK);}}AU.postDropBox();Z.call(this,"drop");I.call(this);AC.dropSuccessful=true;},cancelBoxMove:function a(v){this.revertBoxState(v.box.initState);},revertBoxState:function m(v){N.copy(v,this.box);I.call(this);},getBoxChildClass:function H(v){var x=v.id,w=x&&mstrmojo.all[x];if(w){return w.scriptClass;}return"";},replaceLayoutXmlKeys:function o(x){var w=false;var v=function(AF){if(!AF){return ;}var z=AF.children,AC=z&&z.length,AB;for(AB=0;AC&&AB<AC;AB++){var AD=z[AB];switch(AD.t){case e:v(AD);break;case Y:var AH=AD.k,AG=x[AH]||x["default"],AI=mstrApp?mstrApp.primaryScdpMap:null,AA=(AI&&AI[AG])||[];var AE=d.indexOf(AA,AH)!==-1;if(AG&&!AE){AD.k=AG;w=true;}break;}}};v(this.box);return w;}});mstrmojo.vi.ui.BoxLayoutConfig.getMinimumChildSizes=function(x,z,AA){var w=AA.getBoxChildClass(x);if(!w){throw"BoxLayoutConfig::getMinimumChildSizes - unable to obtain script class for box.";}var v=mstrmojo.vi.ui._IsBoxLayoutChild.getBoxMinimums(w);if(x.f){v[z]=x.l;}return v;};mstrmojo.vi.ui.BoxLayoutConfig.BoxInfoType=null;mstrmojo.vi.ui.BoxLayoutConfig.BoxAddContextType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.dnd");var E=mstrmojo.dom;function B(I){return E.contains(this.getMovingHandle(),I.src.node,true,document.body);}mstrmojo._IsMovable=mstrmojo.provide("mstrmojo._IsMovable",{draggable:true,ownAvatar:true,getMovingHandle:function G(){return this.domNode;},getMovingTarget:function H(){return this.domNode;},isDragValid:function A(I){return B.call(this,I)||(this._super&&this._super(I))||false;},ondragstart:function C(J){if(B.call(this,J)){var K=this.getMovingHandle(),I=this.getMovingTarget().style;this._leftPos=parseInt(I.left,10);this._topPos=parseInt(I.top,10);this._hWidth=K.clientWidth;this._hHeight=K.clientHeight;}if(this._super){this._super();}},ondragmove:function F(L){if(B.call(this,L)){var M=L.tgt.pos,J=L.src.pos,K=this.getMovingTarget().style,I=E.windowDim();K.left=this.left=Math.min(Math.max(this._leftPos+M.x-J.x,-this._hWidth+40),I.w-40)+"px";K.top=this.top=Math.min(Math.max(this._topPos+M.y-J.y,-this._hHeight+20),I.h-20)+"px";}if(this._super){this._super();}},ondragend:function D(I){if(B.call(this,I)){delete this._leftPos;delete this._topPos;delete this._hWidth;delete this._hHeight;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.array","mstrmojo.publisher");var D=mstrmojo.registry,K=mstrmojo.array,I=mstrmojo.publisher;function G(Q,R){if(R){R.parent=Q;var P=D.ref(R);if(R!==P){delete R.parent;}return P;}return null;}function L(Q,R){var P=R.alias;if(P!==null&&P!==""){Q[P]=R;}}function N(Q,R){var P=R.alias;if(R.parent===Q){delete R.parent;}if((P!==null&&P!=="")&&(Q[P]===R)){delete Q[P];}}function A(U,Q){var P=Q&&Q.length,S,R;if(P){S=[];for(R=0;R<P;R++){var V=G(U,Q[R]);if(!V){continue;}S.push(V);L(U,V);}}return S;}mstrmojo._HasChildren=mstrmojo.provide("mstrmojo._HasChildren",{_meta_usesSuper:false,children:null,postCreateChildren:mstrmojo.emptyFn,onaddChild:null,onremoveChild:null,initChildren:function F(){var P="children",Q=this[P];if(!Q){return ;}this[P]=null;this._set_children(P,Q,true);this.postCreateChildren();},_set_children:function E(S,Q,P){var R=this.children;if(Q!==R){if(R){this.removeChildren(null,P);}this.addChildren(Q,0,P);}return false;},destroyChildren:function C(S){var R=this.children,P=(R&&R.length)||0,Q;if(P){for(Q=P-1;Q>-1;Q--){var U=R[Q];if(U&&U.destroy){U.destroy(S);if(!S){N(this,U);}}}if(!S){R.length=0;}}},invalidateChildren:function B(){mstrmojo.array.forEach(this.children,function(P){P.invalidate();});},invalidate:function H(){this.invalidateChildren();},addChildren:function O(V,Q,R){if(!V){return V;}var U=V.constructor===Array,P=A(this,U?V:[V]);if(P&&P.length){var S=this.children||[];if(Q===null||Q===undefined){Q=S.length;}this.children=K.insert(S,Q,P);if(!R&&(this.onaddChild||I.hasSubs(this.id,"addChild"))){this.raiseEvent({name:"addChild",value:P,index:Q});}}return U?P:(P&&P[0]);},removeChildren:function J(W,R){var U=this.children,V=W?[W]:(this.children||[]).concat(),Q=V.length,P=-1,S;if(Q){for(S=Q-1;S>-1;S--){N(this,V[S]);}if(W){P=K.removeItem(U,W);}else{if(U){U.length=0;P=0;}}if(!R&&(this.onremoveChild||I.hasSubs(this.id,"removeChild"))){this.raiseEvent({name:"removeChild",value:V,index:P});}}return P;},removeAndDestroyChild:function M(R,P,Q){if(R){if(R.parent!==this){throw"Unable to remove an object that is not in the children collection.";}this.removeChildren(R,P);R.destroy(Q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry");mstrmojo._PagingList=mstrmojo.provide("mstrmojo._PagingList",{usePaging:false,page:0,totalPages:1,_set_page:function(B,A){if(this.page!==A&&this.usePaging){if(A>=0&&A<this.totalPages){this.page=A;}return true;}return false;},_inScroll:false,_inPaging:false,onscroll:function(){if(this.usePaging&&!this._inPaging){this._inScroll=true;this.set("page",this.listMapper.whichPage(this));this._inScroll=false;}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash");var A=false,D="mstrmojo.Binding",I="bindings",H=mstrmojo.registry;function B(K){var L;for(L in K){var J=K[L];if(J&&J.disable){J.destroy();}}}function C(K,M){if(!A){mstrmojo.requiresCls(D);A=true;}var N;for(N in K){var J=K[N];if(J===null||J===undefined){continue;}var L=typeof J;if(L==="string"||L==="function"){J={destination:N,source:J,scriptClass:D};}J.parent=M;J=H.ref(J,{skipLoadChecks:true});K[N]=J;J.enable();}}mstrmojo._HasBindings=mstrmojo.provide("mstrmojo._HasBindings",{_meta_usesSuper:false,initBindings:function E(){this.hasInitBindings=true;var K=mstrmojo.hash.copy(this[I]);if(K){delete this[I];this._set_bindings(I,K);if(this.postCreateBindings){this.postCreateBindings();}}var M=this.children,J=(M&&M.length)||0;if(J){var L;for(L=0;L<J;L++){var N=M[L];if(N&&N.initBindings){N.initBindings();}}}},destroyBindings:function G(){var J=this.bindings;if(J){B(J);delete this.bindings;}},_set_bindings:function F(L,J){var K=this[I];if(J!==K){if(K){B(K);}this[I]=J;if(J){C(J,this);}return true;}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.storage.DOMStorage");var A=4;mstrmojo.storage.DOMLocalStorage=mstrmojo.declare(mstrmojo.storage.DOMStorage,null,{scriptClass:"mstrmojo.storage.DOMLocalStorage",init:function(B){this._super(B);try{this.mIsSupported=("localStorage" in window)&&(window.localStorage!==null);this.mStorageObj=this.mIsSupported?window.localStorage:null;this.checkVersion(A);}catch(C){this.mIsSupported=false;}}});$LS=mstrmojo.global.localStore=new mstrmojo.storage.DOMLocalStorage({itemTimeToLive:(3600*24)});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.locales");var d=mstrmojo.array,P=mstrmojo.meta.TP,G=mstrmojo.meta.STP,O=mstrmojo.hash,F={ANDOR:14,MQ:10,MC:12,AQ:2,AL:6,AC:9,AE:5,F:13,R:21,B:20,XML:1,RLS:15},B={};var X;for(X in F){B[F[X]]=true;}var b={};b[F.AQ]="a";b[F.AL]="a";b[F.AC]="a";b[F.AE]="a";b[F.MQ]="m";b[F.MC]="m";b[F.F]="f";b[F.R]="r";b[F.XML]="p";b[F.ANDOR]="nds";var K={};K[F.MQ]=["not","m","fn","fnt","cs","dmy","idcsi"];K[F.MC]=["not","m","fn","fnt","m2","m3","p","dmy","idcsi"];K[F.AE]=["not","a","fn","es","a2","fm2","p"];K[F.AQ]=["not","a","fm","fn","cs"];K[F.AL]=["not","a","fm","fn","cs"];K[F.AC]=["not","a","fm","a2","fm2","a3","fm3","fn","cs"];K[F.R]=["not","r"];K[F.F]=["not","f"];K[F.XML]=["not","n","p"];K[F.ANDOR]=["not","node","nds","fn"];var M={};M[F.MQ]="METRIC_FNS";M[F.MC]="METRIC_FNS";M[F.AQ]="FORM_FNS";M[F.AL]="FORM_FNS";M[F.AC]="FORM_FNS";M[F.AE]="ELEM_FNS";var N={FILTER:1,REPORT:3,METRIC:4,FOLDER:8,PROMPT:10,FUNCTION:11,ATTR:12,FACT:13,DIM:14,FORM:21,ROLE:43,CONS:47},c={FILTER:256,CUSTOMGROUP:257,PROMPT:2560,PROMPT_BOOLEAN:2561,PROMPT_LONG:2562,PROMPT_STRING:2563,PROMPT_DOUBLE:2564,PROMPT_DATE:2565,PROMPT_OBJECTS:2566,PROMPT_ELEMENTS:2567,PROMPT_EXPRESSION:2568,PROMPT_EXPRESSION_DRAFT:2569,PROMPT_DIMTY:2570,PROMPT_BIGDECIMAL:2571,REPORT_GRID:768,REPORT_GRAPH:769,REPORT_ENGINE:770,REPORT_TEXT:771,REPORT_DATAMART:772,REPORT_BASE:773,REPORT_GRIDGRAPH:774,REPORT_NONINTERACTIVE:775,REPORT_CUBE:776,REPORT_EMMACUBE:779,CONS:12032,NDE:12033},U={a:N.ATTR,a2:N.ATTR,m:N.METRIC,m2:N.METRIC,r:N.REPORT,f:N.FILTER,p:N.PROMPT},V={f:c.FILTER};var W={};W[F.MQ]=N.METRIC;W[F.MC]=N.METRIC;W[F.AQ]=N.ATTR;W[F.AL]=N.ATTR;W[F.AC]=N.ATTR;W[F.AE]=N.ATTR;W[F.F]=N.FILTER;W[F.R]=N.REPORT;var J=function(e){var H=e.length,h={},g;for(g=0;g<H;g++){var j=e[g];h[j.did]=j.n;}return h;},E=function(f){var H=f.length,g;for(g=0;g<H;g++){var e=f[g];if("tp" in e){e.t=e.tp;}}return f;},Y=function(f,h){var H=f.length,g;for(g=0;g<H;g++){var e=f[g];if("tp" in e){if(h){e.t=h;}else{delete e.t;}}}return f;},a=function(e,g){if(!g){g=[];}g.length=0;var f,H;for(f=0,H=e.length;f<H;f++){g[f]=e[f];}return g;},L={0:[{did:"1,76"},{did:"1,79"},{did:"1,77"},{did:"1,80"},{did:"1,78"},{did:"1,81"},{did:"1,18"},{did:"1,43"}],1:[{did:"2,1"},{did:"2,2"},{did:"3,1"},{did:"3,2"}]};var R={0:[{did:"1,22"},{did:"1,57"}]};mstrmojo.expr=mstrmojo.provide("mstrmojo.expr",{ET:F,ETs:B,ET2TGT:b,ET2COND:K,ET2TP:W,FN:{EQUAL:6,NOT_EQUAL:7,GREATER:8,LESS:9,GREATER_EQUAL:10,LESS_EQUAL:11,IN_LIST:22,NOT_IN_LIST:57,BETWEEN:17,NOT_BETWEEN:44,IS_NULL:54,IS_NOT_NULL:55,AND:19,OR:20,NOT:21,SEARCH:158,DESCENDANT:187},FN_MRP:{BETWEEN:3,EXCLUDE_TOP:4,EXCLUDE_BOTTOM:5,BETWEEN_DESCENDING:13},FNT:{DEF:1,RANK:2,PER:3},FN_SEP:",",TP:N,STP:c,DMY_TP:{ATTR:-1,DIM:-2},DTP:{UNKNOWN:-1,INTEGER:1,UNSIGNED:2,NUMERIC:3,DECIMAL:4,REAL:5,DOUBLE:6,FLOAT:7,CHAR:8,VARCHAR:9,LONGVARCHAR:10,BINARY:11,VARBIN:12,LONGVARBIN:13,DATE:14,TIME:15,TIMESTAMP:16,SHORT:21,LONG:22,MBCHAR:23,BOOLEAN:24,PATTERN:25,BIGDECIMAL:30},BFTP:{RESERVED:0,HIDDEN:-1,DATETIME:1,NUMBER:2,TEXT:3,PICTURE:4,URL:5,EMAIL:6,TAG:7,DATE:8,TIME:9,SYMBOL:10,BIGDECIMAL:11,PHONENUMBER:12},METRIC_DTP:3,FN_DTP:{NUM:0,CHAR:1,DATE:2},DTP2PROMPT_STP:{"-1":c.PROMPT,1:c.PROMPT_LONG,2:c.PROMPT_LONG,3:c.PROMPT_LONG,4:c.PROMPT_DOUBLE,5:c.PROMPT_DOUBLE,6:c.PROMPT_DOUBLE,7:c.PROMPT_DOUBLE,8:c.PROMPT_STRING,9:c.PROMPT_STRING,10:c.PROMPT_STRING,14:c.PROMPT_DATE,15:c.PROMPT_DATE,16:c.PROMPT_DATE,21:c.PROMPT_LONG,22:c.PROMPT_LONG,23:c.PROMPT_STRING,24:c.PROMPT_BOOLEAN,30:c.PROMPT_BIGDECIMAL},DTP2FN_DTP:{"-1":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:1,9:1,10:1,11:0,12:0,13:0,14:0,15:0,16:0,21:0,22:0,23:1,24:0,25:1,30:0,34:0},fnCstCount:function A(g,e){var h=this.FN,j=this.FN_MRP,H=this.FNT;if(e===H.DEF||e===undefined){switch(g){case h.BETWEEN:case h.NOT_BETWEEN:return 2;case h.IS_NULL:case h.IS_NOT_NULL:return 0;}}else{if(e===H.PER||e===H.RANK){switch(g){case j.BETWEEN:case j.BETWEEN_DESCENDING:return 2;}}}return 1;},fn_List:function S(e,H){var g=this.FN;return e==g.IN_LIST||e==g.NOT_IN_LIST;},fn_AC_MC:function Z(e,H){var g=this.FN;return(e==g.EQUAL)||(e==g.NOT_EQUAL)||(e==g.GREATER)||(e==g.LESS)||(e==g.GREATER_EQUAL)||(e==g.LESS_EQUAL);},fnName:function Q(j,h,e,g){var H=this[M[j]];if(H&&H.constructor===Object){H=H[this.DTP2FN_DTP[g]]||H["*"];}if(j===F.MQ){H=H.concat(mstrmojo.locales.expression.MetricRP);}var f=d.find(H,"did",(e||1)+this.FN_SEP+h);if(f>-1){return H[f].n;}return"";},findTargets:function I(o,g,q){if(!q){q={};}if(o){var n;for(n in U){var z=o[n];if(z){if(!z[P]){z[P]=U[n];}if(!z[G]&&V[n]){z[G]=V[n];}q[z[g]]=z;}}if(o.dmy){var l=this.TP.ATTR,r=this.DMY_TP.ATTR,f=o.dmy.uts,x,e;for(x=0,e=(f&&f.length)||0;x<e;x++){var m=f[x];if(m&&m.utp===r){var j=m.utgt;if(!j.t){j.t=l;}q[j[g]]=j;}}}var H=o.nds,p,v;for(p=0,v=(H&&H.length)||0;p<v;p++){this.findTargets(H[p],g,q);}var s=o.cs,w=s&&s.length;if(w){for(p=0;p<w;p++){this.findTargets(s[p],g,q);}}}return q;},onLocaleUpdated:function(){var e=mstrmojo.locales.expression,H=mstrmojo.expr;H.BRANCH_FNS=O.copy(J(e.BranchQual),H.BRANCH_FNS);H.ELEM_FNS=a(Y(e.Element,"fn"),H.ELEM_FNS);H.METRIC_FNS={"*":Y(d.filter(e.Metric.concat(e.MetricRP),function(f){return f.did&&(d.find(R["0"],"did",f.did)<0);}))};H.FORM_FNS={0:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["0"],"did",f.did)<0);})),1:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["1"],"did",f.did)<0);})),2:Y(d.filter(e.Attribute,function(f){return f.did&&(d.find(L["0"],"did",f.did)<0)&&(d.find(L["1"],"did",f.did)<0);}))};H.DIMTYLEVELS=a(Y(e.DimtyLevels),H.DIMTYLEVELS);},getSortedObjectsByTypeGroup:function D(h){var f=-1,H=0,e=1,g=2;function j(k){switch(k.t){case N.METRIC:return e;case N.ATTR:case N.DIM:case N.CONS:return H;case N.FILTER:return k.st===c.CUSTOMGROUP?H:g;case -1:return f;default:return g;}}h=d.map(h||[],function(k){return O.copy(k,{});});return h.sort(function(o,n){var p=j(o)-j(n);if(p){return p;}var m=o.n.toUpperCase(),l=n.n.toUpperCase(),k=m.localeCompare(l);if(k){return k;}return o.n.localeCompare(n.n);});},mapBaseFormTypeToDataType:function C(f){f=parseInt(f);if(f===NaN){return -1;}var e=this.BFTP,H=this.DTP;switch(f){case e.DATETIME:return H.TIMESTAMP;case e.DATE:return H.DATE;case e.TIME:return H.TIME;case e.NUMBER:return H.REAL;case e.TEXT:return H.CHAR;case e.BIGDECIMAL:return H.BIGDECIMAL;default:return H.CHAR;}}});mstrmojo.expr.onLocaleUpdated();}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.string","mstrmojo.array");var M=mstrmojo.locales,I=mstrmojo.string,P=window.mstrConfig,F=mstrmojo.array,C=P.units,R={CM:1,IN:2,MM:3,PT:4,PC:5,PX:6},A={1:"cm",2:"in",3:"mm",4:"pt",5:"pc",6:"px"},E={DEFAULT:-2,FIXED:0,CURR:1,PERCENT:4,FRACTION:5,SCIENTIFIC:6,GENERAL:9};var G=96;String.prototype.reverse=function(){var V="",U;for(U=this.length;U>0;--U){V+=this.charAt(U-1);}return V;};function K(U,W){U=U||"";W=W||U.match(/\".+?\"/g)||[];for(var V=0;V<W.length;V++){U=U.replace(W[V],W[V].substring(1,W[V].length-1).replace(/\$/g,"$$$$"));}return U;}function S(Z){var U=86400000,Y=new Date(1900,0,1,0,0,0,0),V=Math.floor(Z)-1,X=Z-V-1;if(Z>=59){V--;}var W=new Date(Y.getTime()+(V*U));W.setTime(W.getTime()+X*U+500);return W;}function H(Y,f,h){var Z={"d+":Y.getDate(),"h+|H":Y.getHours(),"s+":Y.getSeconds()},U=M.datetime,a;if(/(y+)/.test(f)){var X=Y.getFullYear().toString(),e=RegExp.$1,W=e.length===2,V=X.length;f=f.replace(e,X.substr(W?V-2:0,W?2:V));}if(/(^\[h\])/.test(f)&&h){f=f.replace(RegExp.$1,""+(Math.floor(h*24)));}if(/(\"?:\"?mm)/.test(f)){var b=Y.getMinutes();f=f.replace(RegExp.$1,":"+(RegExp.$1.length===1?b:("00"+b).substr(b.toString().length)));}if(/(AM\/PM)/.test(f)){var g=Z["h+"],c=g>11;Z["h+"]=g-(c?12:0);f=f.replace(RegExp.$1,c?"PM":"AM");}for(a in Z){if(new RegExp("("+a+")").test(f)){f=f.replace(RegExp.$1,RegExp.$1.length===1?Z[a]:("00"+Z[a]).substr((Z[a].toString()).length));}}if(/(mmmm)/.test(f)){f=f.replace(RegExp.$1,U.MONTHNAME_FULL[Y.getMonth()]);}else{if(/(mmm)/.test(f)){f=f.replace(RegExp.$1,U.MONTHNAME_SHORT[Y.getMonth()].substr(0,3));}else{if(/((m|M)+)/.test(f)){var d=(Y.getMonth()+1).toString();f=f.replace(RegExp.$1,RegExp.$1.length===1?d:("00"+d).substr(d.length));}}}return K(f);}function N(V,Y){var W=0,U=Y.length,X=0;for(;W<U;W++){if(Y[W]==="0"){X++;}else{if(Y[W]==="#"){if(X<V){X++;}}else{continue;}}}return X;}mstrmojo.num=mstrmojo.provide("mstrmojo.num",{isInt:function D(U){var X=this.getThousand(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+X+"[0-9]{3})*$"),V=new RegExp("^(-)?[0-9]+$");return(String(U).indexOf(X)&&W.test(U))||V.test(U);},isNumeric:function O(Y){var X=this.getDecimal(),Z=this.getThousand(),W=new RegExp("^(-)?[0-9]{1,3}(\\"+Z+"[0-9]{3})*(\\"+X+"[0-9]+)?$"),V=new RegExp("^(-)?[0-9]*(\\"+X+")?[0-9]+$"),U=new RegExp("^(-)?[0-9]{1}(\\"+X+")[1-9]+[eE]{1}[-]{0,1}[0-9]+$");return(String(Y).indexOf(Z)&&W.test(Y))||V.test(Y)||U.test(Y);},isBigDecimal:function(V){if(!V){return false;}var U=String(V).match(/^#([^#]+)#$/);if(!U||U.length<=1){return false;}var W=U[1];return this.isNumeric(W);},parseInteger:function L(U,V){if(!this.isInt(U)){return Number.NaN;}return parseInt(this.toString(U,true),V);},parseNumeric:function B(U){if(!this.isNumeric(U)){return Number.NaN;}return parseFloat(this.toString(U,true));},parseBigDecimal:function(U){return String(U).match(/^#(.+)#$/)[1];},inNumericRange:function Q(V,W,U){V=this.parseNumeric(V);U=(U!=null)?this.parseNumeric(this.toLocaleString(U)):Number.NaN;W=(W!=null)?this.parseNumeric(this.toLocaleString(W)):Number.NaN;if(U!=Number.NaN&&(V>U||isNaN(V))){return 1;}if(W!=Number.NaN&&(V<W||isNaN(V))){return -1;}return 0;},convertToUSUnits:function(X,W,V){var U=X;W=W||C;switch(parseInt(W,10)){case R.CM:U=parseFloat(this.toString(X))/2.54+"";break;case R.MM:U=parseFloat(this.toString(X))/25.4+"";break;case R.PT:U=parseFloat(this.toString(X))/72+"";break;case R.PC:U=parseFloat(this.toString(X))/6+"";break;case R.PX:U=parseFloat(this.toString(X))/G+"";break;}return V?U:this.toLocaleString(U);},convertToLocalUnits:function(X,W,V){var U;W=W||C;switch(parseInt(W,10)){case R.CM:U=(parseFloat(this.toString(X))*2.54).toFixed(4)+"";break;case R.MM:U=(parseFloat(this.toString(X))*25.4).toFixed(4)+"";break;case R.PT:U=(parseFloat(this.toString(X))*72).toFixed(4)+"";break;case R.PC:U=(parseFloat(this.toString(X))*6).toFixed(4)+"";break;case R.PX:U=(parseFloat(this.toString(X))*G)+"";break;default:U=parseFloat(this.toString(X)).toFixed(4)+"";}return V?U:this.toLocaleString(U);},convertUnits:function(V,W,U){return this.convertToLocalUnits(this.convertToUSUnits(U,V,true),W,true);},toLocaleString:function(U){return(U+"").replace(".",this.getDecimal());},toString:function(W,U){if(U===true){var V=this.getThousandSepRegex();if(V){W=String(W).replace(V,"");}}return String(W).replace(this.getDecimal(),".");},getThousandSepRegex:function(){if(this.thousandSeparatorRegex==null){this.thousandSeparatorRegex=new RegExp(this.getThousand().replace(/(\W){1}/g,"\\$1"),"g");}return this.thousandSeparatorRegex;},addSeparators:function(W,V){var U=V;if(V=="."||V=="*"||V=="\\"){U="\\"+V;}return W.reverse().replace(/(\d{3})/g,"$1"+V).reverse().replace(new RegExp("^(-)?"+U),"$1");},addSeparators2:function(X,W){var U=X,V=/(\d+)(\d{3})/;while(V.test(U)){U=U.replace(V,"$1"+W+"$2");}return U;},format:function(Y,X,b,U){var a="",Z=(X>0)?".":"",V=[];b=(b)?b:"";for(var W=0;W<X;W++){V.push("0");}V=V.join("");switch(Y){case E.GENERAL:a="0.00";break;case E.PERCENT:a="0"+Z+V+"%";break;case E.SCIENTIFIC:a="0"+Z+V+"E+00";break;default:a='"'+b+'"#,##0'+Z+V;}return this.formatByMask(a,U);},getDecimalLength:function J(W){var U=W.indexOf("."),X=0;if(U!==-1){var V=W.substr(U+1,W.length).match(/\d+/);if(V&&V.length>0){X=V[0].length;}}return X;},formatByMask:function(AG,AY){var AA,n="",s,Ab=false;if(isNaN(AY)){AA=new Date(AY);if(isNaN(AA)){return AY;}s=true;}if(AG==="General"){var AL=String(parseFloat(AY).toFixed(2));n=AL.split(".");if(n.length===2){return n.join(this.getDecimal());}return AL;}var r=String(AG).split(";"),X=r[0],h="\u00A4",AR=/"[^"]*"/g,l=(AG&&AG.replace(AR,h).replace(/\[.*\]/g,h))||"",AX=["m","y","d","h","s"],AM=false;F.forEach(AX,function(j){AM=AM||l.indexOf(j,0)!==-1;});if(AM){if(window.SSF&&!Ab){n=this.formatBySSF(AG,AY);Ab=true;}if(n!==""){return n;}else{return H(s?AA:S(AY),AG,AY);}}var AK=X.indexOf("E+"),d=X.indexOf("%"),w=X.match(/\".+?\"/g),AD=X.match(/\[([=<>]*)(-?\d+\.?\d*)\]/),x=X.indexOf("?/?")>-1,AE=(AK!=-1)?E.SCIENTIFIC:((d!=-1)?E.PERCENT:((w&&!AD)?E.CURR:x?E.FRACTION:E.FIXED)),q="",AT="",o=false,V=new String(AY),c=parseFloat(AY)||this.parseNumeric(AY);if(w){if(X.match(/\[\$.+?\]/g)){for(var e=0;e<w.length;e++){X=X.replace(w[e],w[e].substring(1,w[e].length-1));if(w[e].match(/\[\$.+?\]/g)){w[e]=w[e].replace(/\[\$.+?\]/g,w[e][w[e].indexOf("[$")+2]);}}X=X.replace(/\[\$.+?\]/g,'"#"'.replace("#",X[X.indexOf("[$")+2]));}q=K(X,w);q=q.replace(X.replace(/\".+?\"/g,""),h);}if(c<0){V=V.substring(1,V.length);c=-c;o=true;if(r.length>1){var a=r[1].replace(/\[.*\]/,"");AT=K(a.replace(r[0],h));}}var k=this,b=function(v,j){var m=j&&j.replace(h,v);if(j&&(m===j)&&window.SSF){if(Ab){return v;}else{Ab=true;return k.formatBySSF(j,v);}}return(j)?m:"-"+v;};if(AE===E.FRACTION){var AP,AO,AW,p=10,z,u=0,AI,AS,Y,W=false,AF;if(AG.indexOf("# ")>-1){W=true;}for(AP=5;AP>0;AP--){AF="/";for(AO=0;AO<AP;AO++){AF+="?";}if(AG.indexOf(AF)>-1){for(AO=1;AO<AP;AO++){p*=10;}break;}}if(W){u=Math.floor(Number(c));c-=u;}AS=p/2;AW=-1;AI=c*p;for(AP=p-1;AP>=2;AP--){Y=(AI*AP)/p;Y=Y-Math.floor(Y);Y=Y*p;if(Math.abs(Y-p)<Y){Y=Math.abs(Y-p);}Y=Y/AP;if(Y<AS){AS=Y;AW=AP;}else{if((Y==AS)&&(Y==0)){AS=Y;AW=AP;}}}z=Math.round(AW*AI/p);for(AP=AW;AP>=2;AP--){if((z%AP==0)&&(AW%AP==0)){z=z/AP;AW=AW/AP;break;}}if(AW==p){AW=1;z=0;}if(z==0){AW=1;}if(z==AW){if(W){n=""+(u+1);}else{n="1";}}else{if(W&&u>0){if(z==0){n=u;}else{n=u+" "+z+"/"+AW;}}else{if(z==0){n="0";}else{n=z+"/"+AW;}}}if(o){n=b(n,AT);}}else{if(AE==E.SCIENTIFIC){if(c!=0){var AZ=Math.floor(Math.log(c)/Math.LN10),AN=c/Math.pow(10,AZ),Aa=X.substring(0,AK),g=Aa.indexOf("."),AH=X.length-X.indexOf("E+")-(""+Math.abs(AZ)).length-2,AP,U=AZ<0;AZ=Math.abs(AZ);for(AP=0;AP<AH;AP++){AZ="0"+AZ;}n+=Number(AN).toFixed((g!=-1)?Aa.length-g-1:0);n=((o)?b(n,AT):n)+"E"+(U?"-":"+")+AZ;}else{n="0";}}else{if(AE==E.PERCENT){X=X.substring(0,X.length-1);V=String(c*100);}var g=X.indexOf("."),Z=0,AV,t=g>=0?X.substring(0,g):X,AB=g>=0?X.substring(g+1,X.length):"",f=false;if(t.match(/[#0\?],$/)){c/=1000;V=String(c);}else{if(AB.match(/^[#0]*,/)){var AC=0;f=true;while(AC<AB.length){if(AB[AC]==="0"||AB[AC]==="#"){AC++;}else{if(AB[AC]===","){c/=1000;V=String(c);AC++;}else{break;}}}}}AV=this.getDecimalLength(V);if(g!=-1){Z=N(AV,X.substr(g+1,X.length));}n=String((+(Math.round(+(V.indexOf("e")>0?String(parseFloat(V).toFixed(Math.min(Z+2,20))):V+"e"+Math.min(Z,20)))+"e"+-Math.min(Z,20))).toFixed(Math.min(Z,20)));if(AE===E.FIXED){if(/[\[\]><=A-Za-z]|,{2}/.test(X)&&window.SSF){var AQ=this.formatBySSF(AG,AY);n=AQ!==""?AQ:n;Ab=true;}}var AU=n.split(".");var AJ=X.replace(/"[^"]*"/g,"").match(/[#\d]+[^\.\d#]+[#\d]+/);if(AJ!==null){if(AE===E.CURR){AU[0]=(this.formatBySSF((f?AJ[0]&&AJ[0].trim():AJ.input&&AJ.input.trim()),parseFloat(AU[0]))||"").split(".")[0];Ab=true;}if(AU[0].indexOf(",")>=0){AU[0]=AU[0].replace(/,/g,this.getThousand());}else{if(!(this.getThousand()===","&&AU[0].search(this.getThousand())>0)){AU[0]=this.addSeparators2(AU[0],this.getThousand());}}}n=AU.join(this.getDecimal());if(AE==E.CURR){n=q.replace(h,n);if(n===q&&window.SSF){n=this.formatBySSF(AG,AY,n);Ab=true;}}if(AE==E.PERCENT){n+="%";}if(o){n=b(n,AT);}}}return n;},formatBySSF:function(W,V,X){var U=(X!==undefined&&X!==null)?X:"";if(typeof V==="string"){V=parseFloat(V);}try{U=window.SSF.format(W,V);}catch(Y){if(window.mstr_profile){window.mstr_profile.log(Y);}U=(X||V).toString();}return U;},validateFormat:function(U){var V=true,W=String(U).split(";");if(W[1]&&W[1].indexOf(W[0])<0){V=false;}return V;},generateUniqueID:function(U){var W="0123456789ABCDEF".split(""),X=[];for(var V=0;V<U;V++){X[V]=W[0|Math.random()*16];}return X.join("");},countOfDecimals:function(V,W){var U=String(V);return U.length-(U.indexOf(W!==undefined?W:this.getDecimal())+1);},getThousand:function(){return mstrmojo.locales.number.THOUSANDSEPARATOR;},getDecimal:function(){return mstrmojo.locales.number.DECIMALSEPARATOR;}});mstrmojo.num.UNIT=R;mstrmojo.num.UNIT_SYMBOL=A;})();(function(){mstrmojo.requiresCls("mstrmojo.locales");var Y=function(){return mstrmojo.locales.datetime;},L=mstrmojo.string;mstrmojo.date=mstrmojo.provide("mstrmojo.date",{monthNumbers:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},REGEXPS:{DATES:{},TIMES:{}},CACHE:{PARSEDATE:{CONTAINS:{},EQUALS:{}},PARSETIME:{CONTAINS:{},EQUALS:{}}},now:Date.now||function D(){return new Date().getTime();},isDate:function Z(c,g,b){var e=this.parseDate(c,b);var f=!!(e&&this.doesDateExist(e.month,e.day,e.year));if(g){if(f){var d=this.formatDateInfo(e,Y().DATEOUTPUTFORMAT);if(b){return{match:e.match,formatted:d};}return d;}return null;}return !!f;},formatDateInfo:function R(e,g){if(!g){return"";}var b=e.day,f=e.month,d=e.year;var c=g.replace(/dd/g,this.formatInteger(b,2)).replace(/d/g,Number(b)).replace(/yyyy/g,Number(d)).replace(/yy/g,this.formatInteger(Number(d)%100,2)).replace(/MMM/g,"~~~~").replace(/MM/g,"@@").replace(/M/g,"^").replace(/MMMM/g,Y().MONTHNAME_FULL[Number(f)-1]).replace(/\~\~\~\~/g,Y().MONTHNAME_SHORT[Number(f)-1]).replace(/\@\@/g,this.formatInteger(f,2)).replace(/\^/g,Number(e.month));return c;},parseDate:function a(m,g,k){if(m==null){return false;}if(typeof m!=="string"){m=String(m);}m=L.trim(m);var b=this.CACHE.PARSEDATE[g?"CONTAINS":"EQUALS"],d=b[m];if(d||(d===null)){return d;}var c=null;var j;if(k){j=[k];}else{j=[].concat(Y().DATEINPUTFORMATS);j.unshift(Y().DATEOUTPUTFORMAT);}var e,f;for(e=0,f=j.length;e<f;e++){var h=this._buildRegExp4DateFormat(j[e]),l=h&&m.match(g?h.reContains:h.reEquals);if(l){c={match:l[0],year:h.yearIndex&&this.fourDigitYear(l[h.yearIndex]),day:h.dayIndex&&parseInt(Number(l[h.dayIndex]),10),month:h.monthIndex&&this.numericMonth(l[h.monthIndex])};break;}}b[m]=c;return c;},isTime:function I(c,f,b){var g=this.parseTime(c,b);var e=!!(g&&this.doesTimeExist(g.hour,g.min,g.sec));if(f){if(e){var d=this.formatTimeInfo(g,Y().TIMEOUTPUTFORMAT);if(b){return{match:g.match,formatted:d};}return d;}return null;}return !!e;},parseTime:function J(n,g,l){if(n==null){return false;}if(typeof n!=="string"){n=String(n);}n=L.trim(n);var b=this.CACHE.PARSETIME[g?"CONTAINS":"EQUALS"],d=b[n];if(d||(d===null)){return d;}var c=null;var k;if(l){k=[l];}else{k=[].concat(Y().TIMEINPUTFORMATS);k.unshift(Y().TIMEOUTPUTFORMAT);}var e,f;for(e=0,f=k.length;e<f;e++){var j=this._buildRegExp4TimeFormat(k[e]),m=j&&n.match(g?j.reContains:j.reEquals);if(m){var h=j.ampmIndex&&m[j.ampmIndex];c={match:m[0],hour:j.hourIndex&&this.capitalHour(m[j.hourIndex],h),min:j.minIndex&&parseInt(Number(m[j.minIndex]),10),sec:j.secIndex&&parseInt(Number(m[j.secIndex]),10)};break;}}b[n]=c;return c;},formatTimeInfo:function S(e,c){if(!c){return"";}var d=!(Number(e.hour)%12)?12:(Number(e.hour)%12),b=c.replace(/HH/g,this.formatInteger(e.hour,2)).replace(/H/g,Number(e.hour)).replace(/hh/g,this.formatInteger(d,2)).replace(/h/g,d).replace(/mm/g,this.formatInteger(Number(e.min)||0,2)).replace(/m/g,Number(e.min)||0).replace(/ss/g,this.formatInteger(Number(e.sec)||0,2)).replace(/s/g,Number(e.sec)||0).replace(/a/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME).replace(/tt/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME).replace(/AM\/PM/g,(Number(e.hour)<12)?Y().AM_NAME:Y().PM_NAME);return b;},doesTimeExist:function G(g,c,f){var e=parseInt(g,10);if(e>=0&&e<=23){var b=parseInt(c,10);if(b>=0&&b<=59){if(!f){return true;}var d=parseInt(f,10);if(d>=0&&d<=59){return true;}}}return false;},capitalHour:function C(b,c){b=parseInt(Number(b),10);if(c&&(c.match(Y().AM_NAME)||c.match(/AM/i))){return b%12;}if(c&&(c.match(Y().PM_NAME)||c.match(/PM/i))){return 12+(b%12);}return b;},getTimeStamp:function O(){var c=new Date();var b=[c.getMonth()+1,c.getDate(),c.getFullYear()];var f=[c.getHours(),c.getMinutes(),c.getSeconds()];var e=(f[0]<12)?"AM":"PM";f[0]=(f[0]<12)?f[0]:f[0]-12;f[0]=f[0]||12;for(var d=1;d<3;d++){if(f[d]<10){f[d]="0"+f[d];}}return b.join("-")+" "+f.join("")+" "+e;},isDateAndOrTime:function W(b,c){return this.isDateTime(b,c)||this.isDate(b,c)||this.isTime(b,c);},isDateTime:function B(l,b){var f=this.parseDateAndOrTime(l),j=f&&f.date,e=f&&f.time,h=!!j&&!!e&&this.doesDateExist(j.month,j.day,j.year)&&this.doesTimeExist(e.hour,e.min,e.sec);if(b){if(h){var c=this.formatDateInfo(j,Y().DATEOUTPUTFORMAT),d=this.formatTimeInfo(e,Y().TIMEOUTPUTFORMAT),k=l.indexOf(j.match),g=l.indexOf(e.match);return(g<k)?d+" "+c:c+" "+d;}return null;}return !!h;},parseDateAndOrTime:function Q(c,b,g){var d=this.parseDate(c,true,b);var e=L.trim((d&&d.match)?c.replace(d.match,""):c),f=this.parseTime(e,false,g);if(!d&&!f){return null;}return{date:d,time:f};},inDateTimeRange:function P(d,f,j){var c=this.parseDateAndOrTime(d),g=c&&c.date,k=c&&c.time;if(!g&&!k){return 0;}if(f!=null){var e=this.parseDateAndOrTime(f);if(g&&e&&e.date){var l=this.compareDate(g,e.date);if(l<0){return -1;}if(l==0){if(k&&e.time&&(this.compareTime(k,e.time)<0)){return -1;}}}}if(j!=null){var b=this.parseDateAndOrTime(j);if(g&&b&&b.date){var h=this.compareDate(g,b.date);if(h>0){return 1;}if(h==0){if(k&&b.time&&(this.compareTime(k,b.time)>0)){return 1;}}}}return 0;},compareDate:function A(d,b){if(d===b){return 0;}var e=typeof d==="string"?this.parseDate(d):d,c=typeof b==="string"?this.parseDate(b):b;if(!e){return -1;}if(!c){return 1;}return(e.year-c.year)||(e.month-c.month)||(e.day-c.day)||0;},compareTime:function K(c,b){if(c===b){return 0;}var e=typeof c==="string"?this.parseTime(c):c,d=typeof b==="string"?this.parseTime(b):b;if(!e){return -1;}if(!d){return 1;}return(e.hour-d.hour)||(e.min-d.min)||(e.sec-d.sec)||0;},compareDateTime:function V(c,b){return this.compareDate(c,b)||this.compareTime(c,b);},compareDateAndOrTime:function E(j,g){if(j===g){return 0;}var c=typeof j==="string"?this.parseDateAndOrTime(j):j,b=typeof g==="string"?this.parseDateAndOrTime(g):g;if(!c){return -1;}if(!b){return 1;}var h=c.date,f=b.date,e=c.time,d=b.time;return this.compareDate(h,f)||this.compareTime(e,d);},_buildRegExp4DateFormat:function N(d){if(!d){return null;}var f=this.REGEXPS.DATES[d];if(!f){if(!this.REGEXPS.MONTHNAME_FULL){this.REGEXPS.MONTHNAME_FULL=Y().MONTHNAME_FULL.join("|");this.REGEXPS.MONTHNAME_SHORT=Y().MONTHNAME_SHORT.join("|");}f=this.REGEXPS.DATES[d]={};f.formatStr=d;var c=f.reStr=d.replace(/([^M|d|y|\s])/g,"\\$1").replace(/dd/g,"~~~~").replace(/d/g,"(\\d{1,2})").replace(/\~\~\~\~/g,"(\\d\\d)").replace(/yyyy/g,"(\\d\\d\\d\\d)").replace(/yy/g,"(\\d\\d)").replace(/MMMM/g,"@@@@").replace(/MMM/g,"@@@").replace(/MM/g,"(\\d\\d)").replace(/M/g,"(\\d{1,2})").replace("@@@@","("+this.REGEXPS.MONTHNAME_FULL+")").replace("@@@","("+this.REGEXPS.MONTHNAME_SHORT+")");f.reEquals=new RegExp("^"+c+"$");f.reContains=new RegExp("^"+c+"\\b");var g=[{key:"monthIndex",index:d.indexOf("M")},{key:"dayIndex",index:d.indexOf("d")},{key:"yearIndex",index:d.indexOf("y")}];g.sort(function(j,h){return j.index-h.index;});var b=1,e;for(e=0;e<3;e++){f[g[e].key]=g[e].index>-1?b++:null;}}return f;},_buildRegExp4TimeFormat:function F(e){if(!e){return null;}var g=this.REGEXPS.TIMES[e];if(!g){if(!this.REGEXPSTR_AMPM){this.REGEXPSTR_AMPM=[Y().AM_NAME,Y().PM_NAME,String(Y().AM_NAME).toLowerCase(),String(Y().PM_NAME).toLowerCase()].join("|");}g=this.REGEXPS.TIMES[e]={};g.formatStr=e;var d=e.replace(/\'\'/g,'"');var h=d.match(/\'(.+?)\'/g);d.replace(/\'(.+?)\'/g,"*");d=d.replace(/([^H|h|m|s|z|Z|a|t|\s|A|P|M|\/])/g,"\\$1").replace(/HH|hh/g,"(\\d\\d)").replace(/H|h/g,"(\\d{1,2})").replace(/mm/g,"(\\d\\d)").replace(/m/g,"(\\d{1,2})").replace(/ss/g,"(\\d\\d)").replace(/s/g,"(\\d{1,2})").replace(/a/g,"("+this.REGEXPSTR_AMPM+")").replace(/AM\/PM/,"("+this.REGEXPSTR_AMPM+")").replace(/tt/g,"("+this.REGEXPSTR_AMPM+")").replace(/z|Z/g,"(.+?)");var f,b;for(f=1,b=(h&&h.length)||0;f<b;f++){d=d.replace(/\*/,h[f]);}d=d.replace(/\"/g,"'");g.reEquals=new RegExp("^"+d+"$");g.reContains=new RegExp(d);var j=[{key:"hourIndex",index:e.search(/h|H/)},{key:"minIndex",index:e.indexOf("m")},{key:"secIndex",index:e.indexOf("s")},{key:"ampmIndex",index:e.search(/tt|a|AM\/PM/)},{key:"zoneIndex",index:e.search(/z|Z/)}];j.sort(function(l,k){return l.index-k.index;});var c=1;for(f=0;f<5;f++){g[j[f].key]=j[f].index>-1?c++:null;}}return g;},doesDateExist:function M(e,b,c){var d=new Date(c,e-1,b);return c==d.getFullYear()&&e==d.getMonth()+1&&b==d.getDate();},fourDigitYear:function U(c){c=parseInt(Number(c),10);if(!isNaN(c)){var b=(Y().TWODIGITYEARSTART%100)||0;if(c>=0&&c<=b){c=2000+c;}else{if(c>b&&c<100){c=1900+c;}}}return c;},numericMonth:function X(f){var e=parseInt(Number(f),10),d=mstrmojo.array;if(!isNaN(e)){return e;}var b=(f&&f.length)||0,c=-1;if(b){if(b<=3){c=d.indexOf(Y().MONTHNAME_SHORT,f);}if(c===-1){c=d.indexOf(Y().MONTHNAME_FULL,f);}}return c+1;},formatInteger:function H(d,c){var g=String(d),f=Math.max(c-g.length,0);if(f>0){var b=[g],e;for(e=1;e<=f;e++){b.push("0");}g=b.reverse().join("");}return g;},getFirstDateOfMonth:function(c,b){return new Date(c,b-1,1);},getDateObject:function(h,b,g,e,f,c){h=h||0;b=b||1;g=g||1;e=e||0;f=f||0;c=c||0;return new Date(h,b-1,g,e,f,c);},getDateFromDateInfo:function(b){return this.getDateObject(b.date&&b.date.year,b.date&&b.date.month,b.date&&b.date.day,b.time&&b.time.hour,b.time&&b.time.min,b.time&&b.time.sec);},getDateJson:function(b){return{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate(),hour:b.getHours(),min:b.getMinutes(),sec:b.getSeconds()};},isLeapYear:function(b){return !(b%400)||(!(b%4)&&!!(b%100));},getDaysOfMonth:function(d,b){var c=[31,28,31,30,31,30,31,31,30,31,30,31];if(b==2&&this.isLeapYear(d)){return 29;}return c[b-1];},getPreMonth:function(c,b){if(b===1){return{y:c-1,m:12};}return{y:c,m:b-1};},getNextMonth:function(c,b){if(b===12){return{y:c+1,m:1};}return{y:c,m:b+1};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base");mstrmojo.chart.common.DSSTimeUtil=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.chart.common.DSSTimeUtil",DaysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],DaysBeforeMonth:[0,31,59,90,120,151,181,212,243,273,304,334],DateAbove1970:[1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1971,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1997,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1973,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1971,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1997,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1973,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1971,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1997,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1973,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1971,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1997,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1973,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1971,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1997,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1973,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981,1971,1972,1973,1974,1997,1976,1977,1978,1973,1980,1981,1971,1977,2012,1974,1997,1981,1988,1978,1973,1974,1992,1971,1977,1978,1996,1997,1981]});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.desc","mstrmojo.dom","mstrmojo.elementHelper","mstrmojo.hash");var C=mstrmojo.hash,K=Math.max,D=Math.min,F=Math.round;mstrmojo.vi.ui.rw.selectors.SliderHelper=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.SliderHelper",_children:[{scriptClass:"mstrmojo.Label",slot:"controlNode",alias:"summary"}],init:function M(N){if(!N.slider){throw new Error(this.scriptClass+"must be initialized with a slider instance.");}if(this._children){N.slider.set("children",this._children.slice(0));}return this._super(N);},getUnit:function I(){var N=this.slider;return N._effectiveLength/K((N.items.length-1),1);},getIdxByPx:function B(N,O){var P=this.slider.unit||this.getUnit();return K(Math[O?"ceil":"floor"](N/P+0.5),0);},updateThumb:function L(){var N=this.slider,O=N.cs1Idx,Q=N.cs2Idx;if(this.notNull(O,Q)){var P=N.unit;C.copy(this.positionSliderElements(N,F(O*P),F(Q*P)),N);}},updateHandleNodeStyle:function A(R,N,Q,O,P){R.handle1Node.style[N]=Q+P;R.handle2Node.style[N]=O+P;},positionSliderElements:function E(c,Y,X){var e=this.slider,Z="px",k=e.multiSelect,S=e._effectiveLength,Q=e.thumbWidth,m=e.cssBkBW,O=e.orCfg,l=O.posCssP,U=O.lenCssP,g="opacity";Y=D(K(Y,-1),S);X=K(D(X,S),0);var f=D(Y,X),h=K(Y,X),d=0,a=f+(k?Q:0),P=h+Q-m,b=K(f,0),j=K(h-a,0),V=K(S-h,0);if(e.hasRendered){this.updateHandleNodeStyle(c,l,Y,X,Z);var N=c.lowerRange.style,W=c.thumbNode.style,R=c.upperRange.style;N[l]=d+Z;W[l]=a+Z;R[l]=P+Z;N[U]=b+Z;W[U]=j+Z;R[U]=V+Z;N[g]=b?1:0;}else{Z+=";";l+=":";U+=":";e.handle1CssText=l+Y+Z;e.handel2CssText=l+X+Z;e.lowerRangeCssText=U+b+Z;e.thumbCssText=l+a+Z+U+j+Z;e.upperRangeCssText=l+P+Z+U+V+Z;e.lowerRangeCssText+=g+":"+(b?1:0)+";";}return{handle1:Y,handle2:X};},updateSummary:function J(){var P=this.slider,V=P.items,N=P.include,W,S,R="";if(P.multiSelect){W=C.keyarray(P.selectedIndices,true);S=W&&W.length||0;var O=mstrmojo.desc(2058,"All");try{var Q=P.parent.node.data.del.elem;if(Q.v===mstrmojo.elementHelper.ELEM_ALL_ID){O=Q.n;}}catch(U){}if(S===0){R=N?mstrmojo.desc(2057,"None"):O;}else{if(S===V.length){R=O;}else{R=(N?"":mstrmojo.desc(1099,"Not")+" ")+V[W[0]].n+(S>1?(" - "+V[W[S-1]].n):"");}}}else{W=P.selectedIndex;if(W>=0){R=(N?"":mstrmojo.desc(1099,"Not")+" ")+V[W].n;}}P.summary.set("text",R);},initialSlider:function H(){var O=this.slider,Q=O.items,U=Q.length,S,P,R;if(U>0){if(O.multiSelect){var N=O.selectedIndices;P=C.min(N,false,true)||0;R=C.max(N,false,true)||0;}else{P=0;R=K(O.selectedIndex,0);}O.cs1Idx=P;S=Q[P];O.cs1Vl=S.v;O.cs1Nm=S.n;O.cs2Idx=O.currentZoomLevel?O.getIndexByValue(O.currentZoomLevel):R;S=Q[O.cs2Idx];O.cs2Vl=S.v;O.cs2Nm=S.n;O.set("lowText",Q[0].n);O.set("highText",Q[U-1].n);}O.include=O.parent.include;O.unit=this.getUnit();},updateSelection:function G(){var O=this.slider,Q=O.items,P=O.cs1Idx,V=O.cs2Idx,S=D(P,V),N=K(P,V),U={},R;if(O.multiSelect){for(R=S;R<=N;R++){if(Q[R]){U[R]=true;}}O.selectedIndices=U;}else{O.selectedIndex=V;}},notNull:function(){var N=function(P){return P===undefined||P===null;},O;for(O=0;O<arguments.length;O++){if(N(arguments[O])){return false;}}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.array");var H=mstrmojo,F=H.array,A="00000000000000000000000000000000",E=-1;function J(K){return K&&K.t===4&&K.id!==A;}function G(L){var K,M=(L&&L.length)||0;if(M===0){return false;}for(K=0;K<M;K++){if(!J(L[K])){return false;}}return true;}mstrmojo.VisProps=null;mstrmojo.vi.viz.DropZoneHelper=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.vi.viz.DropZoneHelper",getXml:function B(){return"";},setData:function I(K){},isMetric:function(K){return J(K);},isMetricZone:function(K){return G(K);},getMetricCountInZone:function D(L){var K=0;F.forEach(L,function(M){if(J(M)){K++;}});return K;}});mstrmojo.vi.viz.DropZoneHelper.METRIC_NAMES_ID=A;mstrmojo.vi.viz.DropZoneHelper.isMetricNames=function C(K){return(parseInt(K.did,10)===E)||(K.id===A)||(K.did===A);};}());(function(){mstrmojo.requiresCls("mstrmojo.form");mstrmojo.vi.util.NavUtility=mstrmojo.provide("mstrmojo.vi.util.NavUtility",{checkSessionAndSendForm:function(C,A,E,B){var D=mstrApp.sessionManager;if(D&&D.sessionTimedout){D.openLoginEditor({success:function(){if(B!=="_blank"&&B!=="mstrExportWindow"){mstrApp.showWait();}mstrmojo.form.send(C,A,E,B);}});}else{if(B!=="_blank"&&B!=="mstrExportWindow"&&C.evt!==3198){mstrApp.showWait();}mstrmojo.form.send(C,A,E,B);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumPanelTypes","mstrmojo.hash","mstrmojo.string");var F=mstrmojo.hash;function B(J,H){var I=false,G=false;F.keyarray(H).every(function(K){(H[K].att||[]).every(function(L){if(L.did===J){I=true;if(L.de){G=true;}}return !I;});return !I;});return G;}mstrmojo.vi.ui.rw.selectors._IsFilterSelector=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsFilterSelector",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsFilterSelector",model:null,cachedFps:null,hasDE:false,init:function E(H){this._super(H);var G=this.node.defn;this.hasDE=(G.srct===12&&B(G.srcid,this.model.datasets));},isInFilterPanel:function A(){return true;},getFilterPanel:function C(){var G=this.cachedFps;if(!G){this.cachedFps=G=mstrmojo.findAncestor(this.parent,"scriptClass","mstrmojo.vi.ui.rw.FilterPanelStack");}return G;},slice:function D(H){var G=this.getFilterPanel();if(G){if(H.eid){H.eid=mstrmojo.string.escapeIllegalXML(H.eid);}if(H.forceBuffer){G.bufferSlice(H);return ;}if(H.forceApply){this.model.slice(H);return ;}if(G.autoApply){this.model.slice(H);}else{G.bufferSlice(H);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.string","mstrmojo.StringBuffer");mstrmojo._XMLNode=mstrmojo.declare(null,null,{nodeName:null,init:function N(O){mstrmojo.hash.copy(O,this);},addChild:function F(P){var O=new mstrmojo._XMLNode({nodeName:P});return this.appendNode(O);},appendNode:function J(O){if(O){if(!this.children){this.children=[];}this.children.push(O);O.parent=this;}return O;},addAttribute:function L(O,P){if(O!=null){if(!this.attributes){this.attributes={};}this.attributes[O]=P;}return this;},addText:function M(O){this._addToStringMember("text",O);return this;},addRawXML:function K(O){this._addToStringMember("rawXML",O);return this;},getXMLString:function I(){var O=new mstrmojo.StringBuffer();this.buildXMLString(O);return O.toString();},buildXMLString:function E(O){O=O||new mstrmojo.StringBuffer();O.append("<").append(this.nodeName).append(" ");this._buildAttributesXMLString(O).append(">").append(((this.text!=null)?this._escapeString(this.text):"")).append(((this.rawXML!=null)?this.rawXML:""));this._buildChildrenXMLString(O).append("</").append(this.nodeName).append(">");return O;},_buildAttributesXMLString:function D(O){var Q=this.attributes;if(Q){var R;for(R in Q){if(Q[R]!=null){var P=String(Q[R]);switch(R){case"et":case"nt":case"dmt":case"ddt":case"fnt":case"tp":case"stp":break;default:P=this._escapeString(P);}O.append(R+'="'+P+'" ');}}}return O;},_escapeString:function C(O){return mstrmojo.string.escape4HTMLText(O);},_buildChildrenXMLString:function H(P){var R=this.children;var O=R&&R.length;if(O){var Q;for(Q=0;Q<O;Q++){if(R[Q]&&R[Q].buildXMLString){R[Q].buildXMLString(P);}}}return P;},_addToStringMember:function A(O,Q){var P=this[O];if(P==null){this[O]=Q;}else{this[O]=P+Q;}}});mstrmojo.XMLBuilder=mstrmojo.declare(null,null,{root:null,curNode:null,addChild:function F(O){if(!this.root){this.currentNode=this.root=new mstrmojo._XMLNode({nodeName:O});}else{this.currentNode=this.currentNode.addChild(O);}return this;},appendNode:function J(O){if(!this.root){this.currentNode=this.root=O;}else{this.currentNode=this.currentNode.appendNode(O);}return this;},addAttribute:function L(O,P){if(this.currentNode){this.currentNode.addAttribute(O,P);}else{alert("no root node");}return this;},addText:function M(O){if(this.currentNode){this.currentNode.addText(O);}else{alert("no root node");}return this;},addRawXML:function K(O){if(this.currentNode){this.currentNode.addRawXML(O);}else{alert("no root node");}return this;},closeElement:function G(){this.currentNode=this.currentNode.parent;return this;},toString:function B(){if(this.root){return this.root.getXMLString();}return"";}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.string");var X=mstrmojo.dom,L=mstrmojo.string,b=mstrmojo.array;mstrmojo.css=mstrmojo.provide("mstrmojo.css",{DISPLAY_TABLE:X.isNSIE?"block":"table",DISPLAY_CELL:X.isNSIE?"block":"table-cell",MINHEIGHT:X.isIE6?"height":"minHeight",addClass:function M(j,h){if(j){if(h.constructor!==Array){h=[h];}var e=j.className||"",l=" "+e+" ",f=false,d=h.length,g;for(g=0;g<d;g++){var k=h[g];if(!l.match(new RegExp("\\s"+k+"\\s"))){e+=" "+k;f=true;}}if(f){j.className=L.trim(e);}}return j;},removeClass:function O(g,f){if(!g){return ;}if(f.constructor!==Array){f=[f];}var d=" "+(g.className||"")+" ",c=f.length,e;for(e=0;e<c;e++){d=d.replace(new RegExp("\\s"+f[e]+"\\s","g")," ");}g.className=L.trim(d);},addWidgetCssClass:function N(h,f){var d=h.cssClass,g=(d&&d.split(" "))||[],e;f=[].concat(f);for(e=0;e<f.length;e++){var c=f[e];if(b.indexOf(g,c)===-1){g.push(c);}}h.cssClass=g.join(" ");},removeWidgetCssClass:function G(j,g){var d=j.cssClass,h=(d&&d.split(" "))||[],f;g=[].concat(g);for(f=0;f<g.length;f++){var c=g[f];var e=b.indexOf(h,c);if(e!==-1){h.splice(e,1);}}j.cssClass=h.join(" ");},toggleClass:function W(e,d,c){if(c){this.addClass(e,d);}else{this.removeClass(e,d);}},hasClass:function A(e,f){if(e){var d=" "+(e.className||"")+" ";return !!d.match(new RegExp("\\s"+f+"\\s"));}return false;},applyShadow:function H(g,h,f,e,c){var d=g.style;if(X.isDXIE){d.filter+="progid:DXImageTransform.Microsoft.dropshadow(OffX="+h+"px, OffY="+f+"px, Color='"+c+"')";}else{if(X.isFF||X.isWK||X.isIE10){d[X.CSS3_BOXSHADOW]=h+"px "+f+"px "+e+"px "+c;}}},removeShadow:function C(d){var c=d.style;if(X.isFF||X.isWK||X.isIE10){c[X.CSS3_BOXSHADOW]="";}},setOpacity:function Y(d,f){if(X.isDXIE&&!X.isIE9){var g=d.currentStyle.filter;var c=null;if(g.length>0){c=d.filters["DXImageTransform.Microsoft.Alpha"];}if(c){c.opacity=f;c.enabled=(f!==100);}else{if(f<100){var e="progid:DXImageTransform.Microsoft.Alpha(Opacity="+f+")";d.style.filter=(g||"")+" "+e;}}}else{d.style.opacity=f/100-(X.isIE9?0.00001:0);}},buildGradient:function P(d,f,c){if(X.supports(X.cssFeatures.GRADIENTS)){var e={};if(X.isDXIE){e.n="filter";e.v="progid:DXImageTransform.Microsoft.Gradient(GradientType="+d+",StartColorStr='"+f+"',EndColorStr='"+c+"')";}else{if(X.isFF){e.n="background-image";e.v="-moz-linear-gradient("+((d===0)?"top":"left")+","+f+","+c+")";}else{if(X.isWK){e.n="background";e.v="-webkit-gradient(linear,"+((d===0)?"left top, left bottom":"left top, right top")+",from("+f+"),to("+c+"))";}else{if(X.isIE10||X.isIEW3C){e.n="background";e.v="linear-gradient("+((d===0)?"to bottom":"to right")+","+f+","+c+")";}}}}return e;}return null;},buildRoundCorners:function R(h,g){if(X.supports(X.cssFeatures.ROUND_CORNERS)){var d=h+"px";var k=d+(g?" "+d+" 0 0":"")+";";if(X.isFF||X.isWinPhone||X.isIE10){return"border-radius:"+k;}if(X.isWK){if(!g){return"-webkit-border-radius:"+d+";";}var j=["left","right"],f=[],c=-1,e;for(e=0;e<2;e++){f[++c]="-webkit-border-top-"+j[e]+"-radius:"+d;f[++c]="-webkit-border-bottom-"+j[e]+"-radius:0";}return f.join(";");}}return"";},getBorderWidthsOrPaddings:function E(d,g){var h={t:0,r:0,b:0,l:0,h:0,w:0};if(!d){return h;}var e=d.split(" "),c=e.length,f;for(f=0;f<c;f++){e[f]=Math.round(g*parseFloat(e[f])/72);}if(c<4){if(c===1){e[1]=e[2]=e[3]=e[0];}else{e[3]=e[1];if(c===2){e[2]=e[0];}}}h.t=e[0];h.r=e[1];h.b=e[2];h.l=e[3];h.h=h.t+h.b;h.w=h.l+h.r;return h;},getBorderWidths:function I(d,c){return this.getBorderWidthsOrPaddings(d,c);},getPaddings:function D(d,c){return this.getBorderWidthsOrPaddings(d,c);},parkAfterFade:function B(c){var d=c.target.style;if(d.opacity===0){d.left="-10000px";window.setTimeout(function(){d.opacity=0.99;},0);return true;}return false;},getStyleValue:function J(c,g){var e=(g==="float"),f;if(c.currentStyle){g=e?"styleFloat":g;f=c.currentStyle[g];}else{if(document.defaultView&&document.defaultView.getComputedStyle){g=e?"cssFloat":g;var d=document.defaultView.getComputedStyle(c,null);f=d?d[g]:null;}}return f;},getComputedStyle:function V(c,e){var d=(window.getComputedStyle)?function(f,g){return window.getComputedStyle(f,g||null);}:function(f){return f.currentStyle||{};};mstrmojo.css.getComputedStyle=d;return d(c,e);},getCssTextFromObj:function F(e){var d="",c;for(c in e){d+=c+":"+e[c]+";";}return d;},onTransitionEnd:function a(e,c){var d="transition",f=window.Modernizr;if(f.testProp(d)){X.attachOneTimeEvent(e,X.transEndEvtNames[f.prefixed(d)],c);}else{window.setTimeout(c,0);}},onAnimationEnd:function U(e,c){var d="animation",f=window.Modernizr;if(f.testProp(d)){X.attachEvent(e,X.animationEndEvtNames[f.prefixed(d)],c);}else{window.setTimeout(c,0);}},flashClass:function Q(d,c,f){this.toggleClass(d,c,true);var e=this;window.setTimeout(function(){e.toggleClass(d,c,false);},f);},convertCssToCamelCase:function K(c){return c.replace(/\-([a-z])/gi,function(d,e){return e.toUpperCase();});},printCSSInfo:function Z(g){var m=document.styleSheets,p=m.length,h,k;for(k=0;k<p;k++){var l=m[k],n=l.cssRules,e=n?n.length:0,o=0;for(h=0;h<e;h++){var c=n[h].selectorText;if(c){try{o+=c.split(",").length;}catch(f){}}}var d=l.href;if(!g||(d&&d.indexOf(g)>-1)){console.log("Stylesheet: "+d||"Inline CSS Block");console.log("Total rules: "+e);console.log("Total selectors: "+o);}}},cssEscape:function S(j){if(arguments.length===0){throw new TypeError("`CSS.escape` requires an argument.");}var f=String(j),h=f.length,e=-1,g,c="",d=f.charCodeAt(0);while(++e<h){g=f.charCodeAt(e);if(g==0){c+="\uFFFD";continue;}if((g>=1&&g<=31)||g==127||(e==0&&g>=48&&g<=57)||(e==1&&g>=48&&g<=57&&d==45)){c+="\\"+g.toString(16)+" ";continue;}if(e==0&&h==1&&g==45){c+="\\"+f.charAt(e);continue;}if(g>=128||g==45||g==95||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122){c+=f.charAt(e);continue;}c+="\\"+f.charAt(e);}return c;}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.hash");var M=mstrmojo.string,L=mstrmojo.hash,E=mstrmojo.dom;var R=mstrmojo.usesFrames?null:document.createElement("span");var J=/mstrAttach:([\w,]+)/g;var Q;function V(b,c){if(Q===undefined){Q=(mstrApp!==undefined&&mstrApp.isTouchApp&&mstrApp.isTouchApp())||false;}return b.replace(J,function a(j,l){var f=l.split(","),g=[],d=f.length,h;for(h=0;h<d;h++){var k=f[h];if(k){if(Q){if(k.indexOf("mouse")>-1){continue;}else{if(k==="click"){k="touchend";}}}g.push("on"+k+"=\"mstrmojo.dom.captureDomEvent('{@id}','"+k+"', self, event)\"");}}return g.join(" ");});}var N="preBuildRendering",C="buildRendering",B="postBuildRendering";function Y(c){var b=c.markupString;if(b.match(/mstrAttach:/)){b=V(b,c);if(c.markupString===c.constructor.prototype.markupString){c.constructor.prototype.markupString=b;}}var a=M.apply(b,c);if(a){if(a.indexOf("oncontextmenu")>-1){c.hasContextMenuEvent=true;}if(mstrmojo.usesFrames){var e=(c.domNode&&c.domNode.ownerDocument)||window.document;if(!R||R.ownerDocument!==e){R=e.createElement("span");}}R.innerHTML=a;var f=R.removeChild(R.firstChild);f.mstrmojoId=c.id;return f;}return null;}function A(c){var b=c.markupSlots,a,d;if(b){a={};for(d in b){a[d]=b[d].call(c);}}return a;}mstrmojo._HasMarkup=mstrmojo.provide("mstrmojo._HasMarkup",{markupString:null,markupMethods:null,markupSlots:null,onRender:mstrmojo.emptyFn,onUnRender:mstrmojo.emptyFn,render:function Z(){if((this[N]&&this[N]()===false)||(this[C]()===false)||(this[B]&&this[B]()===false)){return false;}this.hasRendered=!!this.domNode;this.onRender();var a="renderComplete";if(mstrmojo.publisher.hasSubs(this.id,a)){this.raiseEvent({name:a});}return true;},buildDom:function U(){return Y(this);},postBuildDom:null,preBuildRendering:mstrmojo.emptyFn,buildRendering:function F(){var a=this.domNode,b=this.buildDom();this.domNode=b;if(this.postBuildDom){this.postBuildDom();}if(this.slotNames){this.removeSlots(this.slotNames);}this.addSlots(A(this));this.paint();if(b){var e=a;if(!e){e=this.placeholder;if(e){if(typeof e==="string"){e=document.getElementById(e);}delete this.placeholder;}}if(e){E.replace(e,b);}}var c="onchildRenderingChange",d=this.parent;if(d&&d[c]){d[c](this);}return true;},postBuildRendering:mstrmojo.emptyFn,unrender:function S(c){if(this.hasRendered){if(!c){try{var a=this.domNode;if(a.parentNode){a.parentNode.removeChild(a);}if(mstrmojo.dom.isIE&&a.outerHTML!=="undefined"){a.outerHTML="";}}catch(b){}}this.domNode=null;this.removeSlots(this.slotNames);this.hasRendered=false;this.onUnRender();}},paint:function K(){var b=this.markupMethods;if(!b){return ;}var e=this,f=function(k){var j=b[k];if(j){try{j.apply(e,[true]);}catch(h){throw new Error(["Error in markup method.","Script class: "+e.scriptClass,"Widget id: "+e.id,"Method name: "+k,"Err: "+h.message].join("\n\n"));}}};var d=b.sequence,a,c,g;if(d){a=d.length||0;for(c=0;c<a;c++){f(d[c]);}}else{for(g in b){f(g);}}},redraw:function P(){return false;},refresh:function D(a){if(this.hasRendered){if(this.redraw()!==true){var b=this.domNode;this.unrender(true);this.placeholder=b;if(a){a();}this.render();}}},set:function I(d,a){this._super(d,a);if(this.domNode){var b=this.markupMethods,c=b&&b["on"+d+"Change"];if(c){c.apply(this);}}return this;},slotNames:null,addSlots:function G(b){var a=this.slotNames,c;if(!a){a={};this.slotNames=a;}for(c in b){this[c]=b[c];a[c]=true;}},removeSlots:function H(a){if(a){var b=this.slotNames,c;for(c in a){delete this[c];if(b){delete b[c];}}}},captureDomEvent:function X(c,a,d,b){if(this.enabled!==false){this.raiseEvent(mstrmojo._HasMarkup.newDomEvent(c,a,d||a.event,b));}},playEffect:function W(b){var a=this[b];if(a&&a.constructor===Object){a=mstrmojo.insert(mstrmojo.hash.clone(a));a.widget=this;this[b]=a;}if(a){a.play();}}});mstrmojo._HasMarkup.addMarkupMethods=function O(b,a){b.prototype.markupMethods=L.copy(a,L.copy(b.prototype.markupMethods));};mstrmojo._HasMarkup.MSTRDomEventType=null;mstrmojo._HasMarkup.newDomEvent=function(d,a,c,b){return{name:d,hWin:a,e:c,config:b,ctrlKey:E.ctrlKey(a,c),shiftKey:E.shiftKey(a,c),metaKey:E.isMetaKey(a,c),cancel:function(){E.stopPropogation(a,c);},preventDefault:function(){E.preventDefault(a,c);},getTarget:function(){return E.eventTarget(a,c);}};};}());(function(){mstrmojo.requiresCls("mstrmojo.string");var D=mstrmojo.string,F=1;mstrmojo.ListBuilder=mstrmojo.provide("mstrmojo.ListBuilder",{newContext:function E(G){var I=G.itemMarkupFunction;if(!I){var H=G.itemMarkup||(G.itemField&&'<div class="mstrmojo-text">{@'+G.itemField+"}</div>");I=H?function(K,J,L){return D.apply(H,K);}:null;}return{itemStatus:[],itemFunc:I};},build:function A(I,H,J,G){H.itemStatus[G]=F;return H.itemFunc(J,G,I);},onadd:function B(I,G,H){if(G){mstrmojo.array.insert(G.itemStatus,H.index,new Array(H.value.length));}},onremove:function C(I,G,H){if(G){G.itemStatus.splice(H.index,H.value.length);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.base64","mstrmojo.func","mstrmojo.hash","mstrmojo.string","mstrmojo.dom");mstrmojo.XhrCallbackType=null;function decodeHeader(value){var rEncoded=/\=\?UTF-8\?B\?(.+?)\?\=/g;if(value&&value.indexOf("=?UTF-8?B?")===0){var decMsg="",result;while((result=rEncoded.exec(value))!==null){decMsg+=mstrmojo.base64.decode(result[1]);}return decMsg;}return value;}function encodeParams(params){var x=-1,url=[],p;if(params){for(p in params){url[++x]=p+"="+encodeURIComponent(params[p]);}}return url.join("&");}function appendUrlParams(method,baseUrl,params){if(method!=="GET"||!params){return baseUrl;}return baseUrl+"?"+encodeParams(params);}function sendXhr(xhr,method,baseUrl,params){method=method.toUpperCase();var app=mstrApp,m=window.microstrategy;if(this.isTask){params=mstrmojo.addCSRFTokenToTaskParams(params);params.taskContentType=params.taskContentType||"json";params.taskEnv=params.taskEnv||"xhr";params.xts=new Date().getTime();params[mstrApp.name]=mstrApp.servletState||mstrConfig.servletState||"";baseUrl=baseUrl||mstrConfig.taskURL;}var ptp=app.persistTaskParams||(m&&m.persistParams);if(ptp){mstrmojo.requiresCls("mstrmojo.hash");mstrmojo.hash.copy(ptp,params);}xhr.open(method,appendUrlParams(method,baseUrl,params),this.async);var headers=params.xhrHeaders;if(headers){for(var hdr in headers){xhr.setRequestHeader(hdr,headers[hdr]);}delete params.xhrHeaders;}if(method!=="POST"){xhr.send(null);}else{xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.send(encodeParams(params));}if(this.async===false){xhr.onreadystatechange();}}function createXhr(){var methods=[function(){var res=new XMLHttpRequest();var foo=res.open;res.open=function(){foo.apply(res,arguments);};return res;},function(){return new ActiveXObject("Msxml2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");}],cnt=methods.length,i;for(i=0;i<cnt;i++){var xhr;try{xhr=methods[i]();}catch(e){continue;}createXhr=methods[i];return xhr;}throw new Error("mstrmojo.SimpleXHR: Could not create an XHR object.");}function evalResponse(rt){var rtn=null;try{try{rtn=JSON.parse(rt);}catch(ex){rtn=eval("("+rt+")");}}catch(ex){rtn=rt&&mstrmojo.string.trim(rt);}return rtn;}var MSI_SERVER_NAME_NOT_INITIALIZED=2147760371,MSI_INVALID_SESSION_ID=2147760372,E_MSI_USERMGR_USER_NOTFOUND=2147758245,E_MSI_CONNECT_FAILED=2147759877;function isSessionExpiredError(res){if(res.status===401){return true;}var c=res&&res.getResponseHeader("X-MSTR-TaskErrorCode");c=(c<0)?(4294967296+parseInt(c,10)):c;switch(c){case MSI_SERVER_NAME_NOT_INITIALIZED:case MSI_INVALID_SESSION_ID:case E_MSI_USERMGR_USER_NOTFOUND:case E_MSI_CONNECT_FAILED:return true;}return false;}function xhrSupportsProgress(xhr){return !mstrmojo.dom.isSafari&&!!(xhr&&xhr.upload&&xhr.upload.onprogress);}mstrmojo.SimpleXHR=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.SimpleXHR",isTask:true,async:true,init:function init(props){mstrmojo.hash.copy(props,this);},onreadystatechange:function onreadystatechange(xhr,callback,prevRequest){if(xhr.readyState!==4){return ;}if(typeof callback!=="object"){return ;}try{if((xhr.status===200)||(xhr.status===304)){this.response=callback.textResponse?xhr.responseText:evalResponse(xhr.responseText);if(typeof callback.success==="function"){callback.success(this.response,xhr);}}else{if(xhr.status!==0||(!xhr.isAborted&&prevRequest.params.displayNoResErr)){var app=mstrApp,sessionExp=app&&app.onSessionExpired;if(sessionExp&&isSessionExpiredError(xhr)){sessionExp.call(app,prevRequest);}else{var orig=xhr.getResponseHeader;xhr.getResponseHeader=function(name){return decodeHeader(orig.apply?orig.apply(xhr,[name]):orig(name));};if(typeof callback.failure==="function"){callback.failure(xhr);}}}}}catch(ex){mstrmojo.err(ex);throw ex;}finally{if(typeof callback.complete==="function"){callback.complete();}if(!isSessionExpiredError(xhr)&&!prevRequest.params.notRestartSessionManager){var sm=mstrApp.sessionManager;if(sm&&sm.restart){sm.restart();}}}},cancel:function(){var didCancel=false;var xhr=this.xhr;if(xhr){delete xhr.onreadystatechange;xhr.isAborted=true;if(xhr.readyState<4){xhr.abort();didCancel=true;}this.xhr=null;}return didCancel;},request:function request(method,baseUrl,callback,params,webSvrUrl,useResFeed,webSrvParams){if(webSvrUrl){if(useResFeed===true){if(!params){params={};}params.srcURL=appendUrlParams("POST",webSvrUrl,webSrvParams);this.request(method,baseUrl,callback,params);}else{mstrmojo.jsonp.request(webSvrUrl,params,callback);}}else{var xhr=createXhr();xhr.onreadystatechange=(function(me,x,c,pr){return function(){me.onreadystatechange(x,c,pr);};}(this,xhr,callback,{method:method,baseUrl:baseUrl,callback:callback,params:params}));if(xhrSupportsProgress(xhr)&&callback.progress){xhr.onprogress=(function(me,x,c){return function(evt){c.progress.call(me,evt);};}(this,xhr,callback));}this.xhr=xhr;sendXhr.call(this,xhr,method,baseUrl,params);}}});mstrmojo.QueuedXHR=mstrmojo.declare(mstrmojo.SimpleXHR,null,{scriptClass:"mstrmojo.QueuedXHR",queue:null,requestCount:0,retryDelay:1,lookup:null,cancel:function cancel(){var didCancel=this._super();while(this.queue.length){var x=this.queue.pop();var cb=x.callback;if(cb&&cb.complete){cb.complete();}}this.queue=[];this.requestCount--;return didCancel;},init:function init(){this.queue=[];this.lookup=[];},request:function request(method,baseUrl,callback,params,override,webSvrUrl,useResFeed,webSrvParams,useCache){if(webSvrUrl){if(useResFeed===true){if(!params){params={};}params.srcURL=appendUrlParams("POST",webSvrUrl,webSrvParams);this.request(method,baseUrl,callback,params);}else{mstrmojo.jsonp.request(webSvrUrl,params,callback);}}else{if(this.requestCount>0&&!override){this.queue.push({method:method,baseUrl:baseUrl,callback:callback,params:params});}else{if(this.requestCount>0){this.cancel();}this.requestCount++;var lu=null,oriParams=null;if(useCache){lu=this._searchForCacheRequest(params);oriParams=mstrmojo.hash.copy(params);}if(lu){try{if(callback.success){window.setTimeout(function(){callback.success(lu.res);},10);}}catch(ex){mstrmojo.err(ex);throw ex;}finally{if(callback.complete){callback.complete();}this.advanceQueue();}}else{var xhr=this.xhr=createXhr();callback=mstrmojo.func.wrapMethods(callback,{complete:(function(ths){return function(){ths.advanceQueue();};}(this)),success:(function(ths){return function(){if(useCache){ths.lookup.push({params:oriParams,res:ths.response});}};}(this))});xhr.onreadystatechange=(function(me,x,c,pr){return function(){me.onreadystatechange(x,c,pr);};}(this,xhr,callback,{method:method,baseUrl:baseUrl,callback:callback,params:params}));if(xhrSupportsProgress(xhr)&&callback.progress){xhr.onprogress=(function(me,x,c){return function(evt){c.progress.call(me,evt);};}(this,xhr,callback));}sendXhr.call(this,xhr,method,baseUrl,params);}}}},upload:function upload(method,baseUrl,callback,params,data,config,override,webSrvParams,useCache){if(this.isTask){params=mstrmojo.addCSRFTokenToTaskParams(params);}if(this.requestCount>0&&!override){this.queue.push({method:method,baseUrl:baseUrl,callback:callback,params:params,data:data,config:config});}else{if(this.requestCount>0){this.cancel();}this.requestCount++;var lu=null,oriParams=null;if(useCache){lu=this._searchForCacheRequest(params);oriParams=mstrmojo.hash.copy(params);}if(lu){try{if(callback.success){window.setTimeout(function(){callback.success(lu.res);},10);}}catch(ex){mstrmojo.err(ex);throw ex;}finally{if(callback.complete){callback.complete();}this.advanceQueue();}}else{var xhr=this.xhr=createXhr();var self=this;callback=mstrmojo.func.wrapMethods(callback,{complete:(function(ths){return function(){ths.advanceQueue.call(ths);};}(this)),success:(function(ths){return function(){if(useCache){ths.lookup.push({params:oriParams,res:ths.response});}};}(this))});var handleProgress=function(event){callback.progress(event,config);};var url=baseUrl;var async=!!(config&&config.async);xhr.open("POST",url,async);if(config&&config.authToken){xhr.setRequestHeader("X-MSTR-AuthToken",config.authToken);if("projectId" in params){xhr.setRequestHeader("X-MSTR-ProjectId",params.projectId);}}var formData=new FormData();var a;for(a in params){formData.append(a,params[a]);}if(data){if(params.fileName){formData.append(params.fileFieldName?params.fileFieldName:"myFile",data,params.fileName);}else{formData.append(params.fileFieldName?params.fileFieldName:"myFile",data);}}if(xhrSupportsProgress(xhr)&&callback.progress){xhr.upload.onprogress=handleProgress;}xhr.onreadystatechange=(function(me,x,c,pr){return function(){me.onreadystatechange(x,c,pr);};}(self,xhr,callback,{method:method,baseUrl:baseUrl,callback:callback,params:params}));xhr.send(formData);}}},advanceQueue:function advanceQueue(){this.requestCount--;if(this.queue.length===0){this.requestCount=0;return ;}var req=this.queue.shift();if(req.params.taskId==="importFile"||req.params.taskId==="arch.sparkFileUpload"){this.upload(req.method,req.baseUrl,req.callback,req.params,req.data,req.config);}else{this.request(req.method,req.baseUrl,req.callback,req.params,true);}},_searchForCacheRequest:function _searchForCacheRequest(params){var i;for(i in this.lookup){if(mstrmojo.hash.equals(params,this.lookup[i].params)){return this.lookup[i];}}return null;},hasRequests:function hasRequests(){return this.requestCount>0||mstrmojo.jsonp.hasRequests();}});mstrmojo.xhr=new mstrmojo.QueuedXHR();mstrmojo.jsonp={jsc:new Date().getTime(),timeToWait:20000,requestCount:0,request:function(url,params,callback){var head=document.getElementsByTagName("head")[0]||document.documentElement,jsonp="jsonp"+(this.jsc++),script=document.createElement("script");params.jsonp=jsonp+"(@R@);";params.taskContentType="jsonp";params.taskEnv="jsonp";params.xts=new Date().getTime();window[jsonp]=function(response){mstrmojo.jsonp.requestCount--;if(!response){if(callback.timeout){callback.timeout();}}else{if(response.status===200){callback.success(response.content);}else{var res={status:response.status,getResponseHeader:function(name){switch(name){case"X-MSTR-TaskFailureMsg":return response.errorMsg;case"X-MSTR-TaskErrorCode":return response.errorCode;}}};if(mstrApp.onSessionExpired&&isSessionExpiredError(res)){if(callback.onSessionExpired){callback.onSessionExpired();}else{mstrApp.onSessionExpired();}}else{callback.failure(res);}}}if(window[jsonp]){if(callback.complete){callback.complete();}window[jsonp]=undefined;try{delete window[jsonp];}catch(e){}head.removeChild(script);}};head.insertBefore(script,head.firstChild);this.requestCount++;script.src=appendUrlParams("GET",url,params);setTimeout(function(){var fn=window[jsonp];if(fn){fn();}},this.timeToWait);},hasRequests:function(){return this.requestCount>0;}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.vi.enums.EnumFilterClearActionType","mstrmojo.vi.enums.EnumVisFilterType");var D=mstrmojo.array,M=mstrmojo.string,H=mstrmojo.vi.enums.EnumFilterClearActionType,J=mstrmojo.vi.enums.EnumVisFilterType;mstrmojo.vi.ui.rw._SupportViewFilterInVizBox=mstrmojo.provide("mstrmojo.vi.ui.rw._SupportViewFilterInVizBox",{_mixinName:"mstrmojo.vi.ui.rw._SupportViewFilterInVizBox",getSelectorObjectsFromTemplateLimit:function N(){return this.getSelObjsFromTemlateLimitHandler();},getSelectorObjectsFromViewFilter:function B(){return this.getSelObjsFromVFHandler();},getSelObjsFromVFHandler:function F(){var R=this,P=R.model,Q=R.node.data,S=Q&&Q.vfexpr;return P&&P.getSelectorDataFromViewFilter(S);},getSelObjsFromTemlateLimitHandler:function K(){var R=this,P=R.model,Q=R.node.data,S=Q&&Q.tpl;return P&&P.getSelectorDataFromTemplateLimit(S);},makeBold:function C(P){return"<span style='font-weight:bold;'>"+P+"</span>";},getSelectorExpr:function I(U,S){var V=[],W="",R=true,Q=U.keepOnly?"##":mstrmojo.desc(13232,"Not ##"),P,X=mstrmojo.desc(5283,"OR");if(S){X=this.makeBold(X);}U.data.every(function(Y){[].concat(Y).every(function(Z){if(W===""){W=Z.tn;}return(R=(W===Z.tn));});return R;});U.data.forEach(function(a,Y){if(Y>0){V.push(X);}var Z=[];[].concat(a).forEach(function(d){var c=S?M.encodeHtmlString(d.v):d.v,b=S?M.encodeHtmlString(d.tn):d.tn;Z.push((R?"":(d.tn+" = "))+(c||mstrmojo.desc(14323,"NULL")));});V.push(Z.join(" "));});if(V.length>0){P=Q.replace("##",(R?W+" = ":"")+V.join(" "));}return P;},getLinkingSelectorExpr:function O(S,R){var U=[],V="",Q=true,W=mstrmojo.desc(5283,"OR"),P=S.keepOnly?"##":mstrmojo.desc(13232,"Not ##");if(R){W=this.makeBold(W);}S.data.every(function(X){[].concat(X).every(function(Y){if(V===""){V=Y.tn;}return(Q=(V===Y.tn));});return Q;});S.data.forEach(function(Z,X){var Y=[];if(Q){if(X>0){Y.push(W);}else{Y.push(P.replace("##",V+" = "));}}[].concat(Z).forEach(function(c){var b=R?M.encodeHtmlString(c.v):c.v,a=R?M.encodeHtmlString(c.tn):c.tn;Y.push((Q?"":(a+" = "))+(b||mstrmojo.desc(14323,"NULL")));});U.push(Y.join(" "));});return U.join(" ");},getFilterMenuPairs:function G(P){var R=this,S=[],Q=mstrmojo.desc(2827,"Clear");if(P instanceof Array){P.forEach(function(X,W){var V=R.getSelectorExpr(X),U=R.getSelectorExpr(X,true);S.push({menuString:Q+' "'+V+'"',menuTtpString:Q+' "'+U+'"',ctxt:W});});}return S;},filterMenuHandler:function L(P,S){var R=this,Q=R.controller;switch(P.type){case H.CLEAR_KEEP_ONLY:P=P.idx;Q.applyKeepOnly(R,S,undefined,P,false);break;case H.CLEAR_ALL:Q.clearFiltersForVis(R,[J.KEEP_ONLY,J.LINKING,J.DRILLING],S);break;case H.CLEAR_ADV_QUALIFICATION:Q.clearFiltersForVis(R,[J.ADV_QUALIFICATION],S);break;case H.CLEAR_KEEP_ONLY_AND_LINKING:Q.clearFiltersForVis(R,[J.KEEP_ONLY,J.LINKING],S);break;case H.CLEAR_LINKING:Q.clearLinkingFilter(P,S);break;case H.CLEAR_DRILLING:Q.clearFiltersForVis(R,[J.DRILLING],S);break;default:break;}},hasKeepOnly:function E(P){return P===null||P.length>0;},getSelectorDataForKeepOnly:function A(Q,V){var S=this,R=S.model,U=S.model.data||S.node.data,P=U.tpl,W;if(V===-1){W=[];}else{W=[].concat(R.getSelectorDataFromTemplateLimit(P));if(V===-2){W=D.filter(W,function(X){return !X.keepOnly;});}else{if(V>=0){W.splice(V,1);}}}if(Q){W=W.concat(Q);}return W;}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher");var C=mstrmojo.publisher;mstrmojo._Provider=mstrmojo.provide("mstrmojo._Provider",{_meta_usesSuper:false,audibles:{"*":true},set:function F(N,H){var G=false,K=this["_set_"+N],I=this[N];if(K){G=K.apply(this,arguments);}else{this[N]=H;G=(I!==H);}if(G){var L=N+"Change",M=this.audibles||{},J=(M[N]===true)||((M[N]!==false)&&(M["*"]!==false));if(J&&(this["pre"+L]||this["on"+L]||this["post"+L]||C.hasSubs(this.id,L))){this.raiseEvent({name:L,prop:N,value:H,valueWas:I});}}return this;},raiseEvent:function B(H){var M=H&&H.name;if(!M){return null;}H.src=this;this.preHandleEvent(H);var K=["pre","on","post"],L=false,I,G;for(I=0,G=K.length;I<G;I++){var J=K[I]+M;if(this[J]){if(this[J](H)===false){L=true;break;}}}if(!L){this.postHandleEvent(H);C.publish(this.id,M,H);}return H;},preHandleEvent:mstrmojo.emptyFn,postHandleEvent:mstrmojo.emptyFn,attachEventListener:function A(G,H,I){return C.subscribe(this.id,G,I,H);},detachEventListener:function E(G){C.unsubscribe(G);},destroy:function D(){C.clearSubscriptions(this.id);if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.registry","mstrmojo.publisher","mstrmojo._Provider");var G=mstrmojo.hash,A=mstrmojo.array,B=mstrmojo.registry,D=mstrmojo.publisher;mstrmojo.Arr=mstrmojo.declare(null,[mstrmojo._Provider],{scriptClass:"mstrmojo.Arr",postApplyProperties:null,postCreate:null,length_bindEvents:["add","remove"],init:function H(K){var J;if(K&&K.data){J=K.data;delete K.data;}else{if(K){J=K;K=null;}}if(!J||J.constructor!==Array){J=[];}G.copy(mstrmojo.Arr.prototype,J);if(K){G.copy(K,J);}if(J.postApplyProperties){J.postApplyProperties();}B.add(J);if(J.postCreate){J.postCreate();}return J;},destroy:function E(){D.clearSubscriptions(this.id);B.remove(this);},add:function I(L,J,K){var M=L&&L.length;if(M){if(J==null){J=this.length;}A.insert(this,J,L);if(!K&&(this.onadd||D.hasSubs(this.id,"add"))){this.raiseEvent({name:"add",value:L,index:J});}}},remove:function F(J,L,K){if(L==null){L=1;}if((J!=null)&&L){var M=this.splice(J,L);if(!K&&(this.onremove||D.hasSubs(this.id,"remove"))){this.raiseEvent({name:"remove",value:M,index:J});}}}});mstrmojo.Arr.makeObservable=function C(J,K){if(!J){return ;}if(!K){K={};}K.data=J;return this.prototype.init(K);};})();(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.registry","mstrmojo._Provider","mstrmojo.array");var B=mstrmojo.registry,F=mstrmojo.array;mstrmojo.Obj=mstrmojo.declare(mstrmojo.Base,[mstrmojo._Provider],{scriptClass:"mstrmojo.Obj",id:"",init:function I(J){this.disposables=[];this._super(J);B.add(this);if(this.postCreate){this.postCreate();}},addDisposable:function G(M){var K=this.disposables,L,J;if(M.constructor===Array){for(L=0,J=M.length;L<J;L++){K.push(M[L]);}}else{K.push(M);}return M;},destroyDisposables:function D(J){F.forEach(this.disposables,function(K){if(K.destroy){K.destroy(J);}else{if(K.clear){K.clear();}}});this.disposables=[];},throwAbstractMethodError:function A(J){throw new Error(this.scriptClass+" must implement "+J+".");},destroy:function H(J){if(this.destroyed){return ;}this._super(J);this.destroyDisposables(J);B.remove(this);delete this.parent;this.destroyed=true;}});var C=mstrmojo.Obj;C.free=function E(J){if(J instanceof C){J.destroy();}};}());(function(){var D={};var B="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function A(I,G,F){var E=mstrmojo.all[I],H=D[G]=new mstrmojo.SimpleXHR();$MAPF(true,B,"transportRequest");if(F.params&&!F.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){F.params.sessionState=mstrApp.sessionState;}H.request(F.config.method||"POST",F.taskURL||mstrConfig.taskURL,{success:function(J){if(typeof J==="string"&&J[0]==="{"){try{J=JSON.parse(J);}catch(K){}}if(J.mstrerr){J.code=J.mstrerr.code;J.message=J.mstrerr.message;}E&&E.response(G,true,J);},failure:function(L){var M=L.status,K=L.getResponseHeader("X-MSTR-TaskErrorCode"),J;if(M===0){M=K||M;J=mstrmojo.desc(15666,"The connection to the MicroStrategy Web Server failed. Please wait a few minutes and then attempt to reload the page. If the condition persists, please contact your administrator.");}else{M=K||M||"-999";J=L.getResponseHeader("X-MSTR-TaskFailureMsg")||L.responseText||"Unexpected error, please contact your administrator";}E&&E.response(G,false,{code:M,message:J});},complete:function(){delete D[G];},textResponse:F.callback.textResponse},F.params);},cancelRequest:function C(F){var G=D[F],E=false;if(G){E=G.cancel();delete D[F];}$MAPF(false,B,"transportRequest");return E;}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.QueuedXHR");var F=mstrmojo.hash;function J(K,L){return function(){if(K[L]){K[L]();}};}var B=[];function H(L){var K;switch(L.cacheLevel){case mstrmojo.AjaxCall.CACHELEVEL_LOCAL:if(L._cache==null){L._cache=[];}K=L._cache;break;default:if(B==null){B=[];}K=B;break;}return K;}function E(N){var M=H(N);var P={cache:M,idx:-1},O=N.params;if("xts" in O){delete O.xts;}for(var L=0,K=M.length;L<K;L++){var Q=M[L];if(Q&&F.equals(Q.url,N.url)&&F.equals(Q.params,O)){P.idx=L;break;}}return P;}function C(L){var K=H(L),M=F.copy(L.params);delete M.xts;K.push({url:L.url,params:M,res:F.copy(L.response)});}function D(K){var L=E(K);if(L&&L.idx>=0){K.response=L.cache[L.idx].res;return true;}return false;}mstrmojo.AjaxCall=mstrmojo.declare(mstrmojo.QueuedXHR,null,{scriptClass:"mstrmojo.AjaxCall",method:"POST",url:"",params:null,onsuccess:null,onerr:null,oncomplete:null,oncancel:null,readCache:false,writeCache:false,cacheLevel:"",_cache:null,useQueue:false,init:function I(K){this._super(K);F.copy(K,this);},send:function A(){var K=this;if(this.readCache&&D(this)){this.onsuccess();return ;}this.request(this.method,this.url,{success:function(L){K.response=L;if(K.writeCache){C(K);}if(K&&K.onsuccess){K.onsuccess();}},failure:J(K,"onerr"),complete:J(K,"oncomplete")},this.params,!this.useQueue);},cancel:function G(){this._super();if(this.oncancel){this.oncancel();}}});mstrmojo.AjaxCall.CACHELEVEL_GLOBAL="global";mstrmojo.AjaxCall.CACHELEVEL_LOCAL="local";})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.registry","mstrmojo.ListBuilder");var H=mstrmojo.hash,E=mstrmojo.registry,G=1;mstrmojo.WidgetListBuilder=mstrmojo.provide("mstrmojo.WidgetListBuilder",mstrmojo.mixin({newContext:function F(J){var K=J.itemFunction;if(!K){var I=J.itemConfig;K=I?function(M,L,N){var O=H.clone(I);O.data=M;O.parent=N;return E.ref(O);}:null;}return{itemStatus:[],itemWidgets:[],itemFunc:K};},build:function A(K,J,N,I){var L=J.itemFunc(N,I,K);if(L){J.itemStatus[I]=G;J.itemWidgets[I]=L;if(L.set){var M=K.selectedIndices;if(M&&M[I]){L.set("selected",true);}}}return L;},onadd:function C(K,I,J){if(I){mstrmojo.array.insert(I.itemWidgets,J.index,new Array(J.value.length));}this._super(K,I,J);},onremove:function D(L,J,K){if(J){var O=J.itemWidgets.splice(K.index,K.value.length),N,I;for(N=0,I=O.length;N<I;N++){var M=O[N];if(M&&M.destroy){delete M.parent;M.destroy();}}}this._super(L,J,K);},onchange:function B(S,J,P,U){if(U){var N=P.itemWidgets,L,O,I,R;for(O=0,I=U.removed,R=I&&I.length;O<R;O++){L=N[I[O]];if(L&&L.set){L.set("selected",false);}}var M,Q,K;for(M=0,Q=U.added,K=Q&&Q.length;M<K;M++){L=N[Q[M]];if(L&&L.set){L.set("selected",true);}}}}},H.copy(mstrmojo.ListBuilder)));}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._HasMarkup");var J=mstrmojo.dom,D=mstrmojo._HasMarkup,P,Q=mstrmojo.global.document,K,A="touchstart",C="touchmove",I="touchend",N="contextmenu";function O(S){var R=J.findWidget(S);while(R){if(R.hasContextMenuEvent){return R;}R=R.parent;}return null;}function M(R){var U=R.src,S=O(U&&U.node);if(!S){return null;}return S;}H:function H(R){if(R&&R.touches.length===1){P.startTapHoldCheck(self,R);}}B:function B(){var R=++P.ctxt.moveCount;if(R>P.minMoves){P.stopTapHoldCheck();if(K){window.clearTimeout(K);}}}L:function L(){P.stopTapHoldCheck();if(K){window.clearTimeout(K);}}mstrmojo.taphold=mstrmojo.taphold||mstrmojo.provide("mstrmojo.taphold",{timeThreshold:750,minMoves:3,startTapHoldCheck:function G(R,S){delete this.ctxt;var U=J.captureEventInfo({hWin:R,e:S});this.ctxt={src:U,moveCount:0};J.attachEvent(Q,C,B);J.attachEvent(Q,I,L);S.name=N;K=window.setTimeout(function(){P.stopTapHoldCheck();var V=D.newDomEvent(N,window,S),W;for(W in S){if(!V[W]){V[W]=S[W];}}V.type=N;P.triggerContextMenu(V);},this.timeThreshold);},triggerContextMenu:function F(R){var S=this.ctxt,U=M(S);if(!U){return ;}if(U.raiseEvent){U.raiseEvent(R);}},stopTapHoldCheck:function E(){J.detachEvent(Q,C,B);J.detachEvent(Q,I,L);},enable:function(){if(J.isIOSTouch){J.attachEvent(Q,A,H);}},disable:function(){J.detachEvent(Q,A,H);}});P=mstrmojo.taphold;P.enable();}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css");var F=mstrmojo.array,D=mstrmojo.css;function B(G,J,H){var I=Number(G).toFixed(J);return H?parseFloat(I):I;}mstrmojo.mapbox.ui.selectors._SliderCommon=mstrmojo.provide("mstrmojo.mapbox.ui.selectors._SliderCommon",{_mixinName:"mstrmojo.mapbox.ui.selectors._SliderCommon",generateItems:function E(K,G,L){var H=[],J,I;L=L||0.1;for(J=K,I=0;J<=G;I++){H[I]={n:""+J,v:J};J=B(J+L,1,true);}return H;}});mstrmojo.mapbox.ui.selectors._SliderCommon.getIndexByValue=function A(G){return F.find(this.items,"v",B(G,1,true));};mstrmojo.mapbox.ui.selectors._SliderCommon.enabledMarkupMethod=function C(){var H=this.children,G=this.enabled;D.toggleClass(this.domNode,"disabled",!this.enabled);F.forEach(H,function(I){if(I&&I.set instanceof Function){I.set("enabled",G);}});};}());(function(){mstrmojo.requiresCls("mstrmojo.css");var F=mstrmojo.css,E="px",J="hasOwnAvatar",I={x:0,y:0};function B(L){var K=this.createAvatar(L.src.node,L);if(K){F.addClass(K,[this.avatarCssClass,J]);this.avatar=L.avatar=document.body.appendChild(K);}}function C(){var K=this.avatar;if(K){K.parentNode.removeChild(K);delete this.avatar;F.removeClass(K,[this.avatarCssClass,J]);}}mstrmojo._HasOwnAvatar=mstrmojo.provide("mstrmojo._HasOwnAvatar",{_mixinName:"mstrmojo._HasOwnAvatar",draggable:true,ownAvatar:true,avatarCssClass:"",restrictedToAxis:undefined,isDragValid:function H(K){if(this._super){return this._super(K);}return false;},ondragstart:function D(K){B.call(this,K);this.positionAvatar(K.src.pos,K);if(this._super){this._super(K);}},ondragmove:function A(K){this.positionAvatar(K.tgt.pos,K);if(this._super){this._super(K);}},ondragend:function A(K){C.call(this);if(this._super){this._super(K);}},createAvatar:mstrmojo.emptyFn,positionAvatar:function G(O,L){if(this.avatar){var N=this.avatar.style,M=this.restrictedToAxis,K=(L&&L.dragOffsets)||I;if(M!=="y"){N.left=O.x+K.x+E;}if(M!=="x"){N.top=O.y+K.y+E;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom");var D=mstrmojo.dom,H=D.position,I=Math;function F(V,P,N){var O=this._ellTestNodes||{},K=O[V],M=mstrmojo.css.getComputedStyle(P),J=["width","height"];if(N){J.reverse();}var S=J[0],Q=J[1];if(!K||!D.contains(this.domNode,K.n,true,document.body)){var L=P.cloneNode(true);L.removeAttribute("id");L.removeAttribute("onclick");var U=L.style;U.position="absolute";U.top="-10000px";U.maxHeight=U.maxWidth="none";U[S]="auto";P.parentNode.appendChild(L);var R=parseInt(M["max-"+S],10);if(isNaN(R)){R=parseInt(M[S],10);}K=O[V]={n:L,m:R,d:S.substr(0,1)};if(K.m>0){this._ellTestNodes=O;}}else{K.n.innerHTML=P.innerHTML;}K.n.style[Q]=M[Q];return K;}function B(K,L){var M=this.ellipsisText;switch(this.ellipsisPosition){case"middle":var J=I.floor(L/2);return K.slice(0,J).join("")+M+K.slice(-J).join("");case"end":return K.slice(0,L).join("")+M;default:return K.join("");}}var G=4;mstrmojo._SupportsEllipsisText=mstrmojo.provide("mstrmojo._SupportsEllipsisText",{_mixinName:"mstrmojo._SupportsEllipsisText",ellipsisText:"\u2026",ellipsisPosition:"end",ellipsize:function A(V,P,O){var W=P.innerHTML;if(!W){return false;}var K=F.call(this,V,P,O),M=function(){var X=H(K.n)[K.d];return(X<=K.m);};if(M()){return false;}var L=K.n,J=W.split(""),R=0,N=J.length,Q,S;while(R<N){var U=I.floor((R+N)/2);W=L.innerHTML=B.call(this,J,U);if(M()){R=U+1;}else{N=U-1;}if(N-R<G){for(S=R-1;S<N+1;S++){W=L.innerHTML=B.call(this,J,S);if(!M()){break;}Q=W;}}if(Q){P.innerHTML=Q;break;}}return true;},ellipsizeElements:function C(U,O,N){var L=F.apply(this,arguments),M=function(){var V=H(L.n)[L.d];return(V<=L.m);};if(M()){return false;}var Q=this.ellipsisText;var P=this;var K=document.createElement("span");K.innerHTML=Q;var J=function(Z,Y){var V=Z.slice(0,Y).concat([K]);var X=document.createElement("div");for(var W=0;W<V.length;W++){X.appendChild(V[W]);}return X.innerHTML;};var S=function(W,a,Z,V){var c=0,X=a.length,b,f,d;var Y=function(g){while(g.hasChildNodes()){g.removeChild(g.lastChild);}};while(c<X){var e=I.floor((c+X)/2);if(V){f=Z.call(P,a,e);W.nodeValue=f;}else{Y(W);f=Z.call(P,a,e);W.innerHTML=f;}if(M()){c=e+1;}else{X=e-1;}if(X-c<G){d=c==0?0:c-1;for(;d<X+1;d++){if(V){f=Z.call(P,a,d);W.nodeValue=f;}else{Y(W);f=Z.call(P,a,d+1);W.innerHTML=f;}if(!M()){if(!V){W.removeChild(W.lastChild);b=f=W.innerHTML;}break;}if(!V){W.removeChild(W.lastChild);f=W.innerHTML;}b=f;}}if(b){if(V){W.nodeValue=b;}else{W.innerHTML=b;}break;}}};var R=function(Y){if(Y.nodeType==3){var Z=Y.nodeValue;if(!Z){return false;}S(Y,Z.split(""),B,true);return true;}else{var W=Y.childNodes;if(!W||W.length===0){return false;}var X=[];for(var V=0;V<W.length;V++){X[V]=W[V];}if(X.length!=1||X[0].nodeType!=3){S(Y,X,J,false);}return R(Y.lastChild);}};O.style.visibility="visible";L.n.style.visibility="hidden";R(L.n);O.style.visibility="hidden";L.n.style.visibility="visible";return true;},unrender:function E(J){delete this._ellTestNodes;this._super(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.fx.AnimateProp");var S=mstrmojo.css;var Q=10;function C(X,a,Z){X.pauseScrollRendering(true);var Y=X.scrollboxNode,W=X.animate?X.scrollEffect:null;if(W&&W.play){if(W.isPlaying){W.cancel();}W.props={scrollTop:{start:Y.scrollTop,stop:a,isStyle:false}};W.onEnd=function(){X.pauseScrollRendering(false,null,Z);};W.play();}else{Y.scrollTop=a;X.pauseScrollRendering(false,null,Z);}}function K(d,f,W){var X=4;if(!W){W=0;}var g=Math.round(d.renderBlockSize/2);d.fillAt(Math.max(0,f-g),f+g);var c=d.itemsContainerNode,b=c.childNodes[f],a=d.listMapper.itemOffsetTop(d,c,null,b),e=parseInt(d.scrollboxNode.clientHeight/2,10)-b.offsetHeight/2,Y=Math.max(0,d.spacerMargin+a-e);if(Math.abs(d.scrollboxNode.scrollTop-Y)>2){C(d,Y,d.renderOnScroll?function(){if(W<=X){K(d,f,W++);}}:null);}else{var Z=d.animate?d.scrollEffect:null;if(Z&&Z.isPlaying&&Z.cancel){Z.cancel();d.pauseScrollRendering(false);}}}function J(Y){var Z=Y.itemsContainerNode,W=Z.lastChild,X=W?W.offsetTop+W.offsetHeight-Z.firstChild.offsetTop:0;return X;}function V(X){var W=J(X),Y=Math.max(0,parseInt((X.scrollboxNode.clientHeight-W)/2,10));C(X,Math.max(0,X.spacerMargin-Y));}function H(Y){var W=Y.selectedIndex,X=W>-1;Y.set("hasSelection",X);if(!Y.domNode){return ;}if(X){K(Y,W);}else{V(Y);}}function E(X){var Z=X.scrollboxNode,W=J(X),Y=W>Z.clientHeight/2;S.toggleClass(X.upArrowNode,["enabled"],Y);S.toggleClass(X.downArrowNode,["enabled"],Y);}function N(W,X){var Y=W.scrollboxNode;Y.scrollTop=Math.min(Math.max(Y.scrollTop+X,0),Y.scrollHeight-Y.offsetHeight);}function B(X,W){if(!X._scrollInter){var Y=Q*(W?-1:1);X._scrollInter=window.setInterval(function(){N(X,Y);},50);}}function R(W){if(W._scrollInter){window.clearInterval(W._scrollInter);W._scrollInter=null;}}mstrmojo._IsDial=mstrmojo.provide("mstrmojo._IsDial",{markupString:'<div id="{@id}" class="mstrmojo-Dial {@cssClass}" style="position:relative;"><div class="mstrmojo-Dial-uparrow"  onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], true)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], true)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"></div><div class="mstrmojo-Dial-scrollbox {@cssClass}" style="position:relative;{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-Dial-spacer" style="{@spacerCssText}"><div class="mstrmojo-Dial-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div></div></div><div class="mstrmojo-Dial-dnarrow" onmouseover="mstrmojo.all.{@id}.onmouseoverarrow(self, arguments[0], false)" onmouseout="mstrmojo.all.{@id}.onmouseoutarrow(self, arguments[0], false)" onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.childNodes[1];},spacerNode:function(){return this.domNode.childNodes[1].firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},upArrowNode:function(){return this.domNode.childNodes[0];},downArrowNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){S.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);}},animate:true,itemsEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:500,interval:25,slot:"itemsContainerNode",preStart:function(){var X=this.widget[this.slot],W=(X&&X.offsetWidth)||0;this.props=W?{left:{start:-W,stop:0,suffix:"px",isStyle:true}}:{};},revertOnCancel:false},scrollEffect:{scriptClass:"mstrmojo.fx.AnimateProp",duration:250,interval:25,slot:"scrollboxNode",revertOnCancel:false},multiSelect:false,holdJumpOnly:true,audibles:{"*":true,hasSelection:false},initSpacer:function I(){var W=(this.cssText||"").match(/height:\s*(\d*)px/);if(W){this.spacerMargin=parseInt(Number(W[1])/2,10);var X=this.spacerMargin+"px";this.spacerCssText="padding-top: "+X+"; padding-bottom: "+X+";";}else{this.spacerMargin=0;delete this.spacerCssText;}},center:function U(){H(this);},preBuildRendering:function(){this.initSpacer();return this._super();},postBuildRendering:function D(){this._super();this.center();E(this);},refreshScroll:function G(){this.center();E(this);},prechange:function O(W){this._super(W);if(this.hasRendered){if(!this.multiSelect||(W&&W.added&&W.added.length)){this.center();}}},onclickarrow:function A(Y,X,W){N(this,Q*(W?-1:1));},onmouseoverarrow:function L(Y,X,W){if(!this.holdJumpOnly){B(this,W);}},onmouseoutarrow:function M(Y,X,W){R(this);},onmousedownarrow:function F(Y,X,W){if(this.holdJumpOnly){B(this,W);}},onmouseuparrow:function P(Y,X,W){R(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.hash","mstrmojo.css");var F=mstrmojo.hash,C=mstrmojo.css;var D="open";function E(G){return G?G.popupConfig.hostElement:null;}mstrmojo.ui.menus._HasMenuPopup=mstrmojo.provide("mstrmojo.ui.menus._HasMenuPopup",F.copy(mstrmojo._HasPopup));mstrmojo.ui.menus._HasMenuPopup.openPopup=function A(I,G){var H=this._lastOpened;if(H){this.closePopup();}mstrmojo._HasPopup.openPopup.call(this,I,G);C.addClass(E(I),D);};mstrmojo.ui.menus._HasMenuPopup.closePopup=function B(){C.removeClass(E(this._lastOpened),D);mstrmojo._HasPopup.closePopup.call(this);};}());(function(){mstrmojo.requiresCls("mstrmojo.css");function B(){var D=this.maskNode,E=this.isMasked;D.style.display=E?"block":"none";mstrmojo.css.toggleClass(D,"masked",E);}mstrmojo.vi.ui._HasMask=mstrmojo.provide("mstrmojo.vi.ui._HasMask",{_mixinName:"mstrmojo.vi.ui._HasMask",isMasked:false,postBuildRendering:function C(){if(this._super){this._super();}B.call(this);},onisMaskedChange:function A(){if(!this.hasRendered){return ;}B.call(this);}});}());(function(){mstrmojo.requiresClsP("mstrmojo","css","array");var J=mstrmojo.array,P=mstrmojo.css;var R="dragIn";mstrmojo.vi.ui._IsDraggableList=mstrmojo.provide("mstrmojo.vi.ui._IsDraggableList",{_mixinName:"mstrmojo.vi.ui._IsDraggableList",avatarCssClass:"element-drag-avatar",cachedItems:null,disableDrop:false,isDraggingItem:function G(S){return S.src.node&&S.src.node.className.indexOf("item")>=0;},selectDragNode:function F(S){if(this._super){this._super(S);}var U=S.src.data;U.items=mstrmojo.all[U.srcId].getSelectedItems();},ondragstart:function Q(S){if(this.isDraggingItem(S)){this.selectDragNode(S);}if(this._super){this._super(S);}this.processDragStart(S);},createAvatar:function L(V,U){if(this._super){var S=this._super(V,U);if(S){S.className=[this.avatarCssClass,"hasOwnAvatar"].join(" ");}return S;}},ondragenter:function K(S){if(this.isDraggingItem(S)){P.addClass(this.domNode,R);}if(this._super){this._super(S);}},ondragleave:function A(S){if(this.isDraggingItem(S)){P.removeClass(this.domNode,R);}if(this._super){this._super(S);}},adjustPosition:function O(S){S.y=S.y-this.avatar.offsetHeight-13;},positionAvatar:function H(U,S){if(!this.avatar){return ;}this.adjustPosition(U);if(this._super){this._super(U,S);}},getDragData:function C(U){var S={},V=this;if(this._super){S=this._super(U);}if(S){S.setAvatarClass=function W(X){var Y=V.avatar;if(Y){var Z=[V.avatarCssClass,"hasOwnAvatar",X];Y.className=Z.join(" ");}};}return S;},processDragStart:function M(U){if(this.isDraggingItem(U)){var S=J.map(U.src.data.items,function(W){return W._renderIdx;}).reverse(),V=this;this.cachedItems=this.items.slice(0)||[];J.forEach(S,function(W){V.items.splice(W,1);});this.clearSelect();this.refresh();}},isDragValid:function B(S){return this.isDraggingItem(S)||this._super&&this._super(S)||false;},ondragend:function E(S){var U=S.src.data;if(this._super){this._super(S);}this.processDragEnd(S);},processDragEnd:function I(S){var U=S.src.data;if(!U.isDropSuccess&&U.srcId===this.id){if(this.cachedItems){this.items=this.cachedItems;}this.refresh();}},ondrop:function N(S){P.removeClass(this.domNode,R);this.processDrop(S);this.refresh();S.src.data.isDropSuccess=true;},allowDrop:function D(S){if(this.disableDrop){return false;}else{var U=S.src.data;return U&&U.items&&U.items.length>0;}},processDrop:mstrmojo.fnEmpty});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css");var G=mstrmojo.array,F=mstrmojo.expr,H=mstrmojo.css;mstrmojo._IsExprNode=mstrmojo.provide("mstrmojo._IsExprNode",{ind:function B(){var L=this.parent;if(L&&L.indent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.indent(K);}}},out:function D(){var L=this.parent;if(L&&L.outdent){var K=this.childIndex();K=(K>-1&&(K>0))?[K,K-1]:null;if(K){L.outdent(K);}}},andOrTxt:function A(){var M=this.parent,K=M&&M.data,L="",N=this.data;if(K&&(K.et===F.ET.ANDOR)&&K.fn){L=K.fn+(N&&N.not?"_"+F.FN.NOT:"");L=F.BRANCH_FNS[L];}return'<span class="mstrmojo-text mstrmojo-andor">'+L+"</span>";},getPrefixAndOrToolsMarkup:function(){return('<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()" mstrAttach:mouseover,mouseout>'+mstrmojo.desc(5896,"Ungroup Conditions")+"</span>");},premousedown:function J(K){var L=mstrmojo.dom.eventTarget(K.hWin,K.e);if(this.prefixHoverNode&&mstrmojo.dom.contains(this.prefixHoverNode,L,false)){mstrmojo.dom.stopPropogation(K.hWin,K.e);return ;}if(this._super){this._super(K);}},isSelectableArea:function E(K){return true;},childIndex:function I(){var M=this.parent,K=M&&M.data,L=K&&K.nds,N=this.data;if(L&&N){return G.indexOf(L,N);}return -1;},toggleGroupBorder:function C(K){H.toggleClass(this.parent.itemsContainerNode.childNodes[this.childIndex()-1].firstChild,"upgroup",K);H.toggleClass(this.domNode,"downgroup",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var J={T:["top","left"],D:["height","width"],B:["border","border-color","border-style","border-width"],F:["font","color","text-decoration"],P:["padding"],BG:["background-color","fx"],RW:[]};J.RW=["z-index"].concat(J.T.concat(J.D));var D=mstrmojo.dom,O=mstrmojo.css;function N(U,W,S){var V=U[W]||[];V.push(S);U[W]=V;}function L(X,W){var V=((X&&X.fmts)||null);if(W){var Z=X.thresholds,U=Z&&Z[W];if(U){var Y={},a;for(a in V){Y[a]=U[a]||V[a];}for(a in U){var S=U[a];Y[a]=(typeof S==="string")?(S+" !important"):S;}V=Y;}}return V;}mstrmojo._Formattable=mstrmojo.provide("mstrmojo._Formattable",{_mixinName:"mstrmojo._Formattable",formatHandlers:null,thresholdId:null,getCacheKey:function E(){return"css_cache"+(this.thresholdId||"");},update:function G(U){var S=true;this.invisible=!!(U&&U.data&&U.data.invisible);if(this._super){S=this._super(U);}return S;},buildCSSFormatString:function H(V,e){var j=this.formatHandlers[V],l=j.src?e[j.src]:e;if(!l){return null;}var c=j.props||j;if(!c){return null;}var Y=[],h=-1;var W=c.length-1;for(W;W>=0;W--){var k=c[W];var d=J[k]||[k];var b=d.length-1;for(b;b>=0;b--){k=d[b];var U=l[k];if(U!==undefined){if(k==="fx"){var Z=U,S={};var g=Z.gd;if(g){this.formatGradient(g,S);}var X=parseInt(Z.rt,10);if(X){if(X===1||X===3){this.formatTextRotation(Z.rt,S);}}if(Z.ds){this.formatDropShadow(Z,S);}var a;for(a in S){Y[++h]=a+":"+S[a].join(" ");}}else{Y[++h]=k+":"+U;}}}}if(this.invisible){Y.push("visibility:hidden");}return Y.join(";")+";";},applyCSSFormatToNode:function I(V,S){var W=this[V],U=W&&W.style;if(U){this.buildCSSFormatString(V,S).split(";").forEach(function(X){var Y=X.split(":");U[O.convertCssToCamelCase(Y[0])]=Y[1];});}},clearSlotBackgroundCSS:function F(U){var V=this[U],S=V&&V.style;if(S){S.background="transparent none 0 0 no-repeat";S.filter="none";}},preBuildRendering:function B(){this._super();var W=this.formatHandlers,S=this.getFormats();if(W&&S){var X=this.defn=this.defn||{},Y=this.getCacheKey(),V=X[Y];if(!V){V=X[Y]={};for(var U in W){var a=U+"CssText";this[a]=V[a]=this.buildCSSFormatString(U,S)||"";}}else{var Z;for(Z in V){this[Z]=V[Z];}}}return true;},formatGradient:function P(S,V){var U=O.buildGradient(S.t,S.sc,S.ec);if(U){N(V,U.n,U.v);}},formatDropShadow:function K(X,V){if(D.supports(D.cssFeatures.DROP_SHADOW)){var W=X.ds;if(D.isDXIE){N(V,"filter","progid:DXImageTransform.Microsoft.DropShadow(Color='#66000000',Positive='true',OffX="+W+",OffY="+W+")");}else{var S=[W,W],U=parseInt(X.rt,10);if(U===1||U===3){S[((U===1)?1:0)]=-W;}N(V,(D.isWK?"-webkit-":"")+"box-shadow",S.join("px ")+"px 3px 0px #888");}}},formatTextRotation:function C(U,S){if(D.supports(D.cssFeatures.TEXT_ROTATION)){if(D.isDXIE){N(S,"filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+U+")");}else{var V=(U===1)?90:-90;N(S,D.CSS3_PREFIX+"transform-origin","top left");N(S,D.CSS3_PREFIX+"transform","rotate("+V+"deg)");}}},getFormats:function R(){if(!this.fmts){this.fmts=L.call(this,this.defn,this.thresholdId);}return this.fmts;},clearFormats:function A(){this.fmts=undefined;},createEmptyFormats:function(){return(this.fmts=this.fmts||{});},clearCache:function Q(){delete this.defn[this.getCacheKey()];},unrender:function M(S){if(this.thresholdId){this.fmts=null;}this._super(S);}});mstrmojo._Formattable.getBorderWidths=function(X){var W=X.getFormats(),S=(W.border)?W.border.match(/(\d*|\d*\.\d*)pt/)[0]:W["border-width"],V=X.model,U=V.docModel;return O.getBorderWidths(S,(U&&U.dpi)||V.dpi);};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=mstrmojo.dom,G=100,L=700;var B="mojo-safari-hide-nativeTooltip",H=mstrmojo.css;function M(O,N){return function(Q){var P=mstrmojo.all[O];if(P.customTooltipHandler){P.customTooltipHandler(Q);}P[(N?"move":"show")+"Tooltip"](Q,self);};}function A(){var O=this.tooltipNode||this.domNode,Q=this.id,N,P="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(R){mstrmojo.all[Q].hideTooltip(R,self);};}if(!this[P]){this[P]=M(Q,this.isDynamicTooltip);}O=[].concat(O);for(N=0;N<O.length;N++){O[N].removeAttribute("title");C.attachEvent(O[N],(this.isDynamicTooltip?"mousemove":"mouseover"),this[P]);C.attachEvent(O[N],"mouseout",this._ontooltipout);}}function I(){var Q=this.tooltipNode||this.domNode,P;if(Q&&Q.constructor!==Array){Q=[Q];}if(Q){var R=this._ontooltipover,O=this._ontooltipout,N=this._ontooltipmove;for(P=0;P<Q.length;P++){if(R){C.detachEvent(Q[P],"mouseover",R);}if(O){C.detachEvent(Q[P],"mouseout",O);}if(N){C.detachEvent(Q[P],"mousemove",N);}}}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,isIgnoreTooltipCloseDelay:false,hasWidgetContent:false,tooltipCloseDelay:G,hasOpenTooltip:false,postBuildRendering:function(){var N=this._super();if(this.useRichTooltip){A.call(this);}return N;},onuseRichTooltipChange:function K(){if(this.hasRendered){if(this.useRichTooltip){A.call(this);}else{I.call(this);this.hideTooltip();}}},showTooltip:function J(Q,P){var O=this;if(!O.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(Q);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var S={};for(var N in Q){S[N]=Q[N];}Q=S;}var U=this.richTooltip?this.richTooltip.areaId:undefined;if(C.isSafari&&Q){var R=Q.srcElement;if(window.getComputedStyle(R)["text-overflow"]==="ellipsis"){this.baseElement=R;H.toggleClass(R,B,true);}}this._tooltipTimeOut=window.setTimeout(function(){var V=O.richTooltip;if(O._closeTooltipTimeout){window.clearTimeout(O._closeTooltipTimeout);delete O._closeTooltipTimeout;}mstrmojo.tooltip.open(O,Q,P);O.tooltip.onmouseover=function(){if(O.richTooltip&&O.richTooltip.enableHover){window.clearTimeout(O._closeTooltipTimeout);window.clearTimeout(O._deactivationTimeout);if(O.tooltip){O.tooltip.onmouseout=function(W){var X=W.e;if((!X.toElement&&!X.relatedTarget)||!C.contains(this.domNode,W.e.toElement||W.e.relatedTarget)){O.hideTooltip();}};}}};O.tooltip.allowOtherTooltips=O.allowOtherTooltips;if(V&&V.onClose){O.tooltip.onClose=V.onClose;}O.hasOpenTooltip=true;O._hasActiveArea=true;O._tooltipAreaId=U;window.clearTimeout(O._deactivationTimeout);delete O._deactivationTimeout;},(this._hasActiveArea&&U&&U===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function D(N,P){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var R=this,O=N,Q=P;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(R,O,Q);},this.tooltipOpenDelay);},hideTooltip:function F(){var N=this;window.clearTimeout(this._tooltipTimeOut);if(C.isSafari&&this.baseElement){H.toggleClass(this.baseElement,B,false);}if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete N._deactivationTimeout;delete N._hasActiveArea;delete N._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if((!this.isIgnoreTooltipCloseDelay)&&N.richTooltip&&N.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete N._closeTooltipTimeout;},N.richTooltip.tooltipCloseDelay||this.tooltipCloseDelay);}else{if(N.tooltip){this.isIgnoreTooltipCloseDelay=false;mstrmojo.tooltip.close();}}this.hasOpenTooltip=false;},unrender:function E(N){I.call(this);this._super(N);}});mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY=L;mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY=G;}());(function(){mstrmojo.requiresClsP("mstrmojo","hash","css","array","desc");var R=mstrmojo.hash,m=mstrmojo.func,B=mstrmojo.css,f=mstrmojo.array;var E={lv:-1,hcd:false,epd:false,hid:false,dhid:false,children:[],displayChildren:[],parent:null,displayParent:null},k={rootItems:{},items:[],itemMap:{}};var l="hidden",C="expanded",q="collapsed",J="hierarchy",c="hasChildren",p="u;",X=10,M=7,o=32;mstrmojo.ui._IsHierarchyList=mstrmojo.provide("mstrmojo.ui._IsHierarchyList",{_mixinName:"mstrmojo.ui._IsHierarchyList",itemValueField:"v",init:function n(r){this._super(r);this.clearItems();},getItemProps:function g(t,r){var s=this._super(t,r),u=0;if(t.hcd){s.addCls(c);}if(t.v===p){s.addCls(l);}if(this.isHiearachyDisplay()){s.addCls(J);if(t.hid){s.addCls(l);}u=t.lv>=0?t.lv*X:0;}s.indent=u;return s;},_getItemNode:function S(r){var s=this.itemsContainerNode;return f.filterOne(s&&s.childNodes,function(t){return parseInt(t.getAttribute("idx"),10)===r;});},_buildItemsMarkup:function j(x,s,t,u,v,w){var r;if(this.isHiearachyDisplay()){r=this._buildDescendantsMarkup();}else{r=this._super(x,s,t,u,v,w);}return r;},_buildDescendantsMarkup:function a(x,v){var AB=[],w=this.itemRenderer&&this.itemRenderer.render,z=x?(v?[x]:x.displayChildren):(this.raad?this.getDisplayRoots():this.getRootItems()),s=this.blockCount,u=function(AC){if(!AC.hid&&!AC.dhid){AB.push(w(AC,AC.idx,this));}if(AC.epd||AC.hid){f.forEach(AC.displayChildren,function(AE,AD){return AA.call(this,AE,AD);},this);}},AA=function(AD,AC){if(this.raad&&AC>=s){var AE=this.createRenderer(AD.lv,AD.displayParent,AD.parent,this.items.length,AC);this.items.push(AE);if(AE.displayParent){AE.displayParent.displayChildren.push(AE);}if(AE.parent){AE.parent.children.push(AE);}u.call(this,AE);return false;}else{u.call(this,AD);}};if(w&&typeof w==="function"){if(this.raad&&!x){if(z.length>s){var r=z.slice(0,s),t=this.createRenderer(z[s-1].lv,null,null,this.items.length,s);this.items.push(t);z.push(t);r.push(t);AB=this._buildSiblingsMarkup(r);}else{AB=this._buildSiblingsMarkup(z);}}else{f.forEach(z,function(AD,AC){return AA.call(this,AD,AC);},this);}}return AB;},getItems:function U(){return this.items;},getItemByValue:function D(r){return this.itemMap[r];},isRootItem:function(r){return r.lv>=0&&r.v!==p&&!r.pid&&!r.parent;},getRootItems:function d(){return R.valarray(this.rootItems);},getDisplayRoots:function Y(){if(!this.displayRoots){var t=this.displayRoots=[],r=this.getRootItems(),s=function(u){f.forEach(u,function(v){if(!v.hid){t.push(v);}if(v.epd||v.hid){s(v.displayChildren);}});};s(r);}if(!this.initialDisplayRoots){this.initialDisplayRoots=t.slice();}return this.displayRoots;},getInitialDisplayRoots:function A(){if(!this.initialDisplayRoots){this.initialDisplayRoots=(this.getDisplayRoots()||[]).slice();}return this.initialDisplayRoots;},createRenderer:function I(v,s,u,r,t){return{n:mstrmojo.desc(1005,"More..."),lv:v,displayParent:s,parent:u,idx:r,fetcher:true,fake:true,config:{nextSiblingIdx:t}};},getItemAncestorMap:function F(s){var r=this.itemValueField,t={};while(s&&s[r]){t[s[r]]=true;s=s.parent;}return t;},getItemDescendantMap:function Z(t){var r=this.itemValueField,u={},s=function(v){u[v[r]]=true;f.forEach(v.children,function(w){s(w);});};s(t);return u;},clearItems:function h(){var r=this.itemsContainerNode;R.copy(R.clone(k),this);if(r){r.innerText="";this.updateScrollbars();}},addItems:function e(w,t){var s=this.items,v=this.itemMap,r=this.rootItems,u=this.itemValueField,z=[];f.forEach(w,function(AA){var AD=AA[u],AB=this.getItemByValue(AD),AC=R.copy(AA,(AB?AB:R.clone(E)));if(!AB){AC.idx=s.length;s.push(AC);if(AD){v[AD]=AC;}}if(this.isRootItem(AC)){r[AD]=AC;}z.push(AC);},this);f.forEach(z,function(AC){var AA=this.getItemByValue(AC.pid),AB=this.getItemByValue(AC.dpid)||AA;if(AA){if(!AC.parent){AC.parent=AA;AA.children.push(AC);}if(!AC.hid&&!AC.dhid&&!AC.displayParent){AB.hcd=true;AC.displayParent=AB;AB.displayChildren.push(AC);}}delete AC.pid;delete AC.dpid;},this);if(!t){if(this.postAddItems){this.postAddItems(z);}var x=this.itemsContainerNode;if(x){if(this.isHiearachyDisplay()){this.refresh();}else{x.innerHTML+=this._buildSiblingsMarkup(this.getFlatDisplayItems(z)).join("");this.updateScrollbars();}}}return z;},addSiblingItems:function G(z,v){var u=this.getItemByValue(v),s;if(u){f.forEach(z,function(AB){if(AB.v!==v){AB.pid=AB.pid||v;}});}s=this.addItems(z,true);if(this.postAddSiblingItems){this.postAddSiblingItems(s,u);}var w=this.itemsContainerNode;if(w&&this.isHiearachyDisplay()){var x=this._buildSiblingsMarkup(s).join("");if(!v){w.innerHTML+=x;}else{if(u){var AA={},t=this._getItemNode(u.idx),r;if(t){AA[u.v]=true;while(t.nextSibling){r=this.getItemFromTarget(t.nextSibling);if(r&&r.displayParent&&AA[r.displayParent.v]){AA[r.v]=true;t=t.nextSibling;}else{break;}}t.outerHTML+=x;}}}this.updateScrollbars();}return s;},addBranchItems:function L(s,v){var r=this.getItemByValue(v),u;if(r){f.forEach(s,function(x){x.pid=x.pid||v;});}u=this.addItems(s,true);if(this.postAddBranchItems){this.postAddBranchItems(u,r);}var t=this.itemsContainerNode;if(t&&this.isHiearachyDisplay()){if(!v){f.forEach(u,function(x){if(this.isRootItem(x)){t.innerHTML+=this._buildDescendantsMarkup(x,true).join("");}},this);}else{if(r){var w=this._getItemNode(r.idx);if(w){w.outerHTML+=this._buildDescendantsMarkup(r).join("");}}}this.updateScrollbars();}return u;},updateItems:function H(r,s){if(s){f.forEach(r,function(x,u,v){var w=s[u],t=v[w.p_index];if(t){x.pid=t.v;}});}this.handleOriginalParent(r,s);this.setDisplayParent(r,s);this.clearItems();this.addItems(r,true);},handleOriginalParent:function P(r,s){if(s){f.forEach(r,function(z,u,v){var x=s[u],t=v[x.p_index],w=v[x.original_p_index];if(t&&t.t===M&&z.lv!==t.lv&&w&&w.pid===t.v){z.pid=w.v;}});}},setDisplayParent:function K(r,v,u){if(u){this.idMap=this.idMap||{};f.forEach(r,function(x){this.idMap[x.v]=x;},this);}var t=this,s=function(AA,z){var x;if(!u&&v){var AB=v[z].p_index;x=r[AB];}else{if(u){x=t.idMap[AA.pid];}}return x;};f.forEach(r,function w(AB,z,AA){var x=s(AB,z);if(!x||t.isRootItem(AB)){return AB.v;}if(!AB.dpid){AB.dpid=x.hid?w(x,v&&v[z]&&v[z].p_index,AA):x.v;}return AB.dpid;});},fetchItems:function V(u,x){if(this.raad&&this.isHiearachyDisplay()&&(this.items||[]).length>0){return ;}u=u||{};var s=this,r=u.branch,w=u.browseFlags&o,v=parseInt(u.level,10),t=v>=0;this.fetchItemsThroughTaskCall(u,m.wrapMethods(x,{success:function(z){if(s.raad===undefined&&z&&s.isHiearachyDisplay()){s.raad=z.raad;}if(z&&z.es){var AA=z.es;if(v===(r&&r.lv+1||0)||(w&&!s.raad)){s.addSiblingItems(AA,r&&r.v);}else{if(r&&!t){s.addBranchItems(AA,r.v);}else{s.addItems(AA);}}}}}));},updateItemNodesStatus:function W(){var r=this.itemsContainerNode&&this.itemsContainerNode.childNodes;f.forEach(r,function(t){var s=this.getItemFromTarget(t);if(s){B.toggleClass(t,CSS_SELECTED,s.isSelected);}},this);},_buildSiblingsMarkup:function O(t){var r=[],s=this.itemRenderer&&this.itemRenderer.render;if(s&&typeof s==="function"){f.forEach(t,function(u){r.push(s(u,u.idx,this));},this);}return r;},toggleCollapseExpandCss:function Q(s,r){B.toggleClass(s,q,!r);B.toggleClass(s,C,r);},doExpandCollapse:function b(r,AA){var AB=!AA.epd;AA.epd=AB;this.toggleCollapseExpandCss(r,AB);if(!this.isHiearachyDisplay()){return ;}var x=this.getItemDescendantMap(AA),t,z;if(AB){var s=AA.displayChildren&&AA.displayChildren[0];if(s){var v=this.getItemFromTarget(r.nextSibling);if(v&&v.displayParent===AA){var w={},u;t=r.nextSibling;while(t){z=this.getItemFromTarget(t);u=z&&z.displayParent;if(!u||!x[z.v]){break;}if(w[u.v]){B.addClass(t,l);w[z.v]=true;}else{B.removeClass(t,l);if(!z.epd){w[z.v]=true;}}t=t.nextSibling;}}else{r.outerHTML+=this._buildDescendantsMarkup(AA).join("");}}else{this.fetchItems({branch:AA,level:AA.lv+1});}}else{t=r.nextSibling;while(t){z=this.getItemFromTarget(t);if(!z||!x[z.v]){break;}B.addClass(t,l);t=t.nextSibling;}}this.updateScrollbars();},isHiearachyDisplay:function N(){return true;},fetchItemsThroughTaskCall:mstrmojo.emptyFn,getFlatDisplayItems:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresClsP("mstrmojo","dom","hash","array","css","func","desc");var P=mstrmojo.dom,C=mstrmojo.css,Q=mstrmojo.hash,c=mstrmojo.array,o=mstrmojo.func,L=mstrmojo.desc;var K,F=[],z="moving";mstrmojo.requiresDescs(15934,15935,15936,15937,15938,15939,15940,1006);function R(AD,AC){var AB=AD&&AD.length||0;AC=AC===undefined?30:AC;return AD+Array(Math.max(AC-AB,0)+1).join(" ");}function B(AB){if(K){window.clearTimeout(K);K=null;}G();c.forEach(AB,function(AC){C.toggleClass(AC,z,true);});F=[].concat(AB);K=window.setTimeout(G,1000);}function G(){c.forEach(F,function(AB){C.toggleClass(AB,z,false);});F=[];}function h(AJ,AH,AB,AF){var AK=AJ.rows,AC=AK.length,AE;if(AH<0||AH>=AC||AB<0||AB>AC){AE=false;}else{if(AB===AH||AB===AH+1){AE=true;}else{var AG=AK[AH],AD=AJ.insertRow(AB);P.replace(AD,AG);if(mstrmojo.debugBundles&&console){console.log("move "+R('"'+AG.cells[0].textContent.trim()+'"')+' after "'+AJ.rows[AG.rowIndex-1].textContent.trim()+'"');}if(!AF){B(Array.apply(null,AG.cells));}if(AH===1||AB===1){var AI=this.getViz();AI.offsetCellNode=S.call(this).rows[1].cells[0];}AE=true;}}return AE;}function w(AB){var AC=P.findAncestorByName(AB,"tr");return AC&&AC.rowIndex;}function H(AD,AE){var AB;if(AD){var AF=P.findAncestorByName(AD,"tr"),AC=AF&&AF.rowIndex;AB=AC+(AE?0:1);}else{if(AE){AB=S.call(this).rows.length;}else{AB=1;}}return AB;}function r(AD,AC){var AB;if(AD){AB=AD.ordinal;}else{if(AC){AB=Y.call(this)-1;}else{AB=0;}}return AB;}function Y(){var AB=this.getViz();dataBlocks=AB.dataBlocks,tc=0;c.filterOne(dataBlocks,function(AC){tc=AC&&AC.rw.row.tc;return tc!==undefined;});return tc;}function AA(AI,AC){var AJ=t.call(this),AM=AJ.rowsPerPage,AK=Math.ceil((AI+2)/AM)-1,AE=AJ.pageStatus[AK],AD=[],AF;for(AF=AJ.numPagesRendered;AF<AK;AF++){AD.push({idx:AF,fill:false});}var AH,AB;if(!AE||!AE.filled){if(AE&&AE.isOnDemand()){if(!AE.isDownloading&&!AJ.isDownloading){var AL=AK*AM-1,AG=(AK+1)*AM-2;AE.isDownloading=true;AJ.isDownloading=true;AJ.cp.download(AL,AG);AH=true;AB=AG-AL+1;if(mstrmojo.debugBundles&&console){console.log("load data from orddinal "+AL+" to "+AG+" for page index "+AK+" and ordinal "+AI);}}AD.push({idx:AK,fill:false});}else{AD.push({idx:AK,fill:true});}}if(AH&&AC){AJ.parent.showDownloadStatus(AB);}else{AJ.parent.closeDownloadStatus();}return AD;}function S(){var AB=t.call(this);return AB.tableNode;}function t(){var AB=this.getViz();return AB.zone;}function a(AE){var AC=this.getViz(),AB=AC.scrollboxLeft,AD=AC.scrollboxTop;if(AB!==AE.x||AD!==AE.y){AC.scrollTo(AE);}}mstrmojo.vi.controllers.CustomSortModeActionMgr=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.controllers.CustomSortModeActionMgr",actions:null,pos:-1,historicalUnsilentActions:null,csDisplayPanel:null,init:function p(AB){Q.copy(AB,this);this.actions=[];this.historicalUnsilentActions=[];},appendHistUnsilentActions:function d(AB){this.historicalUnsilentActions=this.historicalUnsilentActions.concat(AB);},getViz:function b(){return this.csDisplayPanel.getVizBox().boxContent;},wrapCustomSortAction:function I(AC,AE,AB){var AF=this,AD=this.getViz();return{silent:true,submitAction:AC,srcEle:this.getOrdinalInfo(AE),tgtEle:this.getOrdinalInfo(AB),srcRefOrdinal:this.getRefOrdinal(AE),perform:function(AL,AO,AM){var AI=this,AK=AI.srcEle,AH=AI.tgtEle,AJ=AI.submitAction.before,AP=function(){var AU=AF.getNodeForOrdinal(AK.ordinal),AT=AF.getViz(),AR=AT.getCellForNode(AU),AQ=AH&&AF.getNodeForOrdinal(AH.ordinal),AS=AQ&&AT.getCellForNode(AQ);if(AF.hasFailedSorts()||AR._e.id!==AK.id||AS&&AS._e.id!==AH.id){AF.addFailedSorts(AK.n,AH&&AH.n,AJ);}else{h.call(AF,S.call(AF),w(AU),H.call(AF,AQ,AJ),AM);if(!AL){a.call(AF,{x:AT.scrollboxLeft||0,y:AF.getScrollYForGoldenSectionPoint(AU)});}}if(AO){AO();}};if(AL){AF.resetFailedSorts();AP();}else{var AG=AI.srcEle.ordinal,AN=r.call(AF,AI.tgtEle,AJ);if(AF.hasFailedSorts()){AF.addFailedSorts(AK.n,AH&&AH.n,AJ);if(AO){AO();}}else{AF.prepareDataAndPages([AG,AN],AP);}}},undo:function(){var AK=AF.getNodeForOrdinal(this.srcEle.ordinal),AI=w(AK),AH=AF.getNodeForOrdinal(this.srcRefOrdinal),AG=H.call(AF,AH,false),AJ=S.call(AF);h.call(AF,AJ,AI,AG);a.call(AF,{x:AF.getViz().scrollboxLeft||0,y:AF.getScrollYForGoldenSectionPoint(AK)});}};},prepareDataAndPages:function M(AG,AI){var AE=0,AB=AG.length,AC=t.call(this),AF=this,AH=0;var AD=function(){self.setTimeout(function(){try{var AJ=AA.call(AF,AG[AE]);if(AJ.length>0){mstrApp.showWait();AC.preRenderPages();AC.renderPages(AJ);AC.postRenderPages();AC._postPagesClearup=true;}else{if(AC._postPagesClearup){AC.postRenderPagesCleanup();AC.configureActions();AC._postPagesClearup=false;}if(AC.isRenderingComplete()){AC.postRenderingCleanup();}AE++;}if(AJ.length>0||AE<AB){AH=AC.renderPause;AD();}else{AF.dpPreparingCleanUp();if(AI){AI();}}}catch(AK){AF.dpPreparingCleanUp();mstrApp.hideWait(true);throw AK;}},AH);};AC.renderingRows=true;AD();},dpPreparingCleanUp:function E(){t.call(this).renderingRows=false;},getRefOrdinal:function Z(AD){var AF=this.getViz(),AB=AF.zone.tableNode.getElementsByTagName("tr"),AC=AD.cellIndex,AG=AD.parentElement.rowIndex,AE=AB[AG-1].cells[AC];return AF.getCellForNode(AE).o;},getOrdinalInfo:function x(AC){var AB=this.getViz().getCellForNode(AC);if(AB&&AB._e){return{id:AB._e.id,n:AB._e.n,ordinal:AB.o};}},getNodeForOrdinal:function q(AB){var AE=S.call(this).rows;if(AB>=0){var AC=AB+1,AD;AD=c.filterOne(AE,function(AF){return parseInt(AF.firstElementChild.getAttribute("r"),10)===AC;});return AD.firstElementChild;}else{return AE[0].firstElementChild;}},getScrollYForGoldenSectionPoint:function U(AF){var AC=0.618,AH=this.getViz(),AB=AH.tableContainerNode.getBoundingClientRect(),AE=AB.top+AB.height*(1-AC),AD=AF.getBoundingClientRect(),AG=AD.top+AD.width/2;return(AH.scrollboxTop||0)+AG-AE;},wrapUnsilentAction:function W(AC,AB,AE,AD){var AF=this;return{silent:false,needDataReady:!!(AD&&AD.needDataReady),submitActions:c.ensureArray(AC),undoCallback:AB,perform:function(AH,AJ){var AG=[],AH=c.ensureArray(AH),AK=AF.getViz(),AL=AK.model.getDataService(),AI;if(AH.length>0){AG=AG.concat(AH);}AG=AG.concat(this.submitActions);AI=AK.controller._getXtabCallback(AK,Q.copy(AB));if(AJ){AI=o.wrapMethods(AI,AJ);}AE=Q.copy(AE||{});AE.hideCancel=true;AE.noUpdate=true;AE.preserveStid=true;AE.noDeltaXML=true;AL.submitUpdates(AL.getUpdateTemplateAction(AK.k,AG),AI,AE);}};},addAction:function u(AB){var AC=this.actions,AD=this.pos;AC.splice(AD+1);AC.push(AB);this.pos=AC.length-1;this.csDisplayPanel.updateStatus();},execute:function f(AC){this.addAction(AC);if(AC.silent){AC.perform(true);}else{var AB=this.getCustomSortActAhead();AC.perform(c.ensureArray(AB));}},undo:function V(){var AC=this.actions[this.pos];if(!AC){return ;}this.pos--;this.csDisplayPanel.updateStatus();if(AC.silent){AC.undo();}else{var AB=this.getActionParts4Undo();this.csDisplayPanel.recreateCSVizForUndo(AB.splitUTActions,AB.silentActions,AC.undoCallback);}},getActionParts4Undo:function m(){var AH=[],AJ=[AH],AG=[],AE=this.actions,AF=this.pos,AC,AI;while(AF>=0){AC=AE[AF];if(AC&&AC.silent){AG=[AC].concat(AG);}else{break;}AF--;}while(AF>=0){AC=AE[AF];if(AC){if(AC.silent){AI=this.getCustomSortActAhead(AF+1);AH.unshift(AI);AF=AF-(AI.actions.length-1);}else{AH.unshift.apply(AH,AC.submitActions);if(AC.needDataReady){AH=[];AJ.unshift(AH);}}}AF--;}var AD=this.historicalUnsilentActions,AB;AF=AD.length-1;while(AF>=0){AB=AD[AF];AH.unshift.apply(AH,AB.submitActions);if(AB.needDataReady){AH=[];AJ.unshift(AH);}AF--;}return{splitUTActions:AJ,silentActions:AG};},redo:function O(){var AC=this.actions[this.pos+1];if(!AC){return ;}this.pos++;this.csDisplayPanel.updateStatus();if(AC.silent){this.resetFailedSorts();var AB=this;AC.perform(false,function(){mstrApp.hideWait(true);if(AB.hasFailedSorts()){AB.actions.splice(AB.pos);AB.pos--;AB.csDisplayPanel.updateStatus();AB.showFailedSortsAndReset();}});}else{AC.perform(this.getCustomSortActAhead());}},getContSlientActionsBehind:function X(){var AB=this.actions.length,AC,AD=[],AE;for(AC=this.pos+1;AC<AB;AC++){AE=this.actions[AC];if(AE&&AE.silent){AD.push(AE);}else{break;}}return AD;},getContSlientActionsBefore:function e(){var AE=this.actions,AB,AC=[],AD;for(AB=this.pos;AB>=0;AB--){AD=AE[AB];if(AD&&AD.silent){AC=[AD].concat(AC);}else{break;}}return AC;},getSlientActionsBefore:function A(){var AB=this.actions.slice(0,this.pos+1);return c.filter(AB,function(AC){return AC&&AC.silent;});},getUnslientActionsBefore:function l(){var AB=this.actions.slice(0,this.pos+1);return c.filter(AB,function(AC){return AC&&!AC.silent;});},getCustomSortActAhead:function k(AF){var AB=[],AC=(AF===undefined?this.pos:AF)-1,AE=this.actions;while(AC>=0){var AD=AE[AC];if(AD.silent){AB=[AD.submitAction].concat(AB);}else{break;}AC--;}if(AB.length>0){return this.csDisplayPanel.wrapCustomSortAction(AB,true);}},isCurrentActionSilent:function N(){return this.actions[this.pos]&&this.actions[this.pos].silent;},reset:function j(){this.actions=[];this.pos=-1;this.csDisplayPanel.updateStatus();},getActionsCount:function s(){return(this.actions||[]).length;},getFailedSortsCount:function g(){return(this.failedSorts||[]).length;},resetFailedSorts:function n(){this.failedSorts=[];},hasFailedSorts:function J(){return(this.failedSorts||[]).length>0;},addFailedSorts:function D(AC,AD,AB){this.failedSorts=this.failedSorts||[];this.failedSorts.push({srcName:AC,tgtName:AD,isPost:AB});},showFailedSortsAndReset:function v(){if(this.hasFailedSorts()){var AC=this.failedSorts.length,AE,AH,AB,AF,AG=L(15934,"Below sorting manipulations fail due to change in source data:")+" ";for(var AD=0;AD<AC;AD++){AE=this.failedSorts[AD];AH=AE.srcName;AB=AE.tgtName;AF=AE.isPost;if(AB){AG+=AF?L(15935,'move "#" before "##"').replace("#",AH).replace("##",AB):L(15936,'move "#" after "##"').replace("#",AH).replace("##",AB);}else{AG+=AF?L(15937,'move "#" to the end').replace("#",AH):L(15938,'move "#" to the top').replace("#",AH);}if(AD===AC-1){AG+=L(1006,".")+" ";}else{AG+=L(15939,",")+" ";}}AG+=L(15940,"Please manually do these sortings if necessary.");mstrmojo.err({message:AG});this.resetFailedSorts();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var X=mstrmojo.dom,V=mstrmojo.hash,Y=mstrmojo.array,K=function K(x,v){var w=this.getCellForNode(x),u=this.getCellForNode(v);return !w||!u||w.hasOwnProperty("mix")===u.hasOwnProperty("mix");},H=function H(z){var x=[],v=this.clonedRowHeader&&this.clonedRowHeader.getTableNode()&&this.clonedRowHeader.getTableNode().tBodies,w=[],u;w.push(this.zone.tableNode.tBodies);if(v){w.push(v);}Y.forEach(w,function(AA){Y.forEach(AA,function(AB){for(u=0;u<AB.childNodes.length;u++){x.push(AB.childNodes[u]);}if(z&&AB.childNodes.length<this.zone.rowsPerPage){x.push.apply(x,new Array(this.zone.rowsPerPage-AB.childNodes.length));}},this);},this);return x;},C=function C(v,z){var w=H.call(this,true)[z],u;for(u=0;u<w.childNodes.length;u++){if(n.call(this,w.childNodes[u])>v){return null;}if(n.call(this,w.childNodes[u])===v){return w.childNodes[u];}}},n=function n(u){var v=this.getCellForNode(u);return v&&v.colIx||0;},A={REPLACE_ALL:1,REMOVE:2,APPEND:3,TOGGLE:4},k={CONTROL:"Ctrl",SHIFT:"Shft",SINGLE:"Single"},d=function d(){return this.rhsCP.startIndexInContainer;},M=function M(v,w){var u=this.rhsCP.getUnmergedCells(v)||[];if(u.length>w){return u[w];}else{return this.rhsCP.getCell(v,w-u.length);}},Q=function Q(AF,AB,u){var AA=AF.o,v=AA,x=AF._gd,AE=AF._e&&AF._e.id,AD,AC=this.zone.searchRow(AA+AB),z,w=AF.colIx;if(AC!==null){z=u===1?AC.max-AB:AC.min;while(Math.abs(AA-z)>0){AD=M.call(this,AA+u,w);if(!AD||AE!==(AD._e&&AD._e.id)||(v!==AD.o&&x===AD._gd)){break;}AA+=u;}return AA+AB;}else{return null;}},b=function(u){var x=this.model.getCellDataUnion(u),v={},w;Y.forEach(x,function(z){w=z.v;if(v[z.tid]&&v[z.tid][0]&&v[z.tid][0].n){w=v[z.tid][0].n+":"+z.v;}v[z.tid]=[{id:z.eid,n:w}];});return v;},h=function h(AK){if(!AK){return null;}if(!this.selectSiblings(AK)){return[AK];}var AG=[],AA=this.getCellForNode(AK),AJ=this.gridData,AI=AJ.gsi,AF,x,AE,AL,u,v,AB,z,AH,AC,AD=function(AN,AM){var AO=true;if(AN.length===AM.length){Y.forEach((AN||[]),function(AP){AO=AO&&Y.find(AM,"id",AP.id)!==-1;return AO;});return AO;}return false;},w=this.model.getCellInfo(AA);if(w.isMetric){if(AI.tma===2){AF=AK.parentNode.childNodes;for(x=0;x<AF.length;x++){z=true;AE=this.getCellForNode(AF[x]);if(AE&&AE.hasOwnProperty("mix")){AH=b.call(this,AE);AC=b.call(this,AA);v=V.keyarray(AH);AB=V.keyarray(AC);if(!!v.length&&v.length===AB.length){Y.forEach((v||[]),function(AM){z=z&&AD(AH[AM],AC[AM]);return z;},this);}else{z=false;}if(z){AG.push(AF[x]);}}}}else{AG.push(AK);}}else{if(this.isSelectAllCell(AK)){AG.push(AK);}else{if(AA&&AA._e&&AA.axis===1){AL=H.call(this,false);Y.forEach((AL||[]),function(AM){for(x=0;x<=AM.childNodes.length;x++){u=AM.childNodes[x];AE=this.getCellForNode(u);if(AE&&AE._e){if(this.model.compareElementsId(AA._e.id,AE._e.id)){AG.push(u);}}}},this);}else{if(AA&&AA._e&&AA.axis===2){AF=AK.parentNode.childNodes;for(x=0;x<AF.length;x++){z=true;AE=this.getCellForNode(AF[x]);if(AE&&AE._e){if(AA._e.id===AE._e.id){AG.push(AF[x]);}}}}}}}return AG;},e=function e(){this.selCells=[];this.clearSelections();},S=function S(w){var v=this,u=v.getCellForNode(w);this.selCells=Y.filter(this.selCells,function(z){var x=v.getCellForNode(z);return x&&u&&(x.tui||x.ui)!==(u.tui||u.ui);});this.clearUnitSelections(this.model.data.gts[u.axis===1?"row":"col"][u.tui||u.ui].id);},r=function r(w){var v=this.isSelectAllCell(w),x=this.getCellForNode(w),z=this.model.getCellInfo(x),u=this.model.getCellTitleInfo(x);if(!x){return ;}if(!v){if(Y.indexOf(this.selCells,w)===-1){this.selCells.push(w);}}else{if(!x.hasOwnProperty("mix")){var AA=z.isMetric?"Metrics":(u.title&&u.title.id),AC=this.model.scm,AB=AA&&AC&&AC[AA];if(AB&&(AB.all||AB.showall)){this.addAttributeSelection(u.title.id,"OA:(All)","all");}}return ;}if(x.hasOwnProperty("mix")){this.addMetricValueSelection(b.call(this,x));}else{this.addAttributeSelection(u.title.id,x._e.id,x._e.n);}},I=function I(u){var w=this.selCells.indexOf(u),v=this.getCellForNode(u);this.selCells.splice(w,1);if(v.hasOwnProperty("mix")){this.removeMetricValueSelection(b.call(this,v));}else{this.removeAttributeSelection(this.model.getCellTitleInfo(v).title.id,v._e.id);}},W=function W(){this.clearContextMenuHighlights();this.cmSelCells=[];this.clearCxtMnuSelection();},q=function q(v,x){var w=this.getCellForNode(v),u=this.model.getCellTitleInfo(w);if(Y.indexOf(this.cmSelCells,v)===-1){this.cmSelCells.push(v);if(w.hasOwnProperty("mix")){this.addContextMenuMetricValueSelection(b.call(this,w));}else{this.addContextMenuAttributeSelection(u.title.id,w._e.id,x.n,undefined,undefined,undefined,x.fm);}}},F=function(AF){var AD=this,z={n:"",fm:""},AC,v=[],w,u,AE,AB,x=[],AA=0;if(AF.length){Y.forEach(AF,function(AG){AC=AD.getCellForNode(AG);u=AC._e;w=u&&u.n;if(w){v.push(w);}});if(u){AE=u.id.split(";");AB=AE[1];x=Y.map(AD.model.getAttributeFormsInTemplate(AB),function(AG){return AG.bfid;});z.fm=x.join(";");AA=x.length;}if(v.length){z.n=v.slice(0,AA).join(" ");}}return z;},c=function c(){var x=this,v,u,w;W.call(this);this.cmSelCells=this.selCells.slice(0);Y.forEach(this.cmSelCells,function(z){w=F.call(x,h.call(x,z));v=x.getCellForNode(z);u=x.model.getCellTitleInfo(v);if(v.hasOwnProperty("mix")){x.addContextMenuMetricValueSelection(b.call(x,v));}else{x.addContextMenuAttributeSelection(u.title.id,v._e.id,w.n,undefined,undefined,undefined,w.fm);}});},B=function B(v){var u=this.getCellForNode(v);if(u){return Y.some(this.model.getCellDataUnion(u),function(w){return w.isSubtotal;});}return false;},U=function U(w,z,v){var x,u,AA=this;if(V.isEmpty(w)&&(!v&&this.clearAllSelections&&this.clearAllSelections())){e.call(this);}w=Y.filter((w||[]),function(AB){return !B.call(AA,AB);});Y.forEach(w,function(AB){u=z;x=~Y.indexOf(this.selCells,AB);if(A.TOGGLE===u){u=x?A.REMOVE:A.APPEND;}if(A.REPLACE_ALL===u){if(v){S.call(this,AB);}else{e.call(this);}z=u=A.APPEND;}switch(u){case A.APPEND:r.call(this,AB);break;case A.REMOVE:I.call(this,AB);break;}},this);},a=function a(u){var w=this,v;u=Y.filter((u||[]),function(x){return !B.call(w,x);});W.call(this);v=F.call(this,u);Y.forEach(u,function(x){q.call(this,x,v);},this);},J=function J(AB,AC,v,z){var w=Math.min(AC,z),AA=Math.min(AB,v),AH=Math.max(AC,z),u=Math.max(AB,v),AE,AD,AG=[],AF=function(x,AI){Y.forEach((AI||[]),function(AJ){if(Y.indexOf(x,AJ)===-1){x.push(AJ);}});};for(AE=AA;AE<=u;AE++){for(AD=w;AD<=AH;AD++){AF(AG,h.call(this,C.call(this,AE,AD)));}}U.call(this,AG,A.APPEND);},Z=function Z(u,AB){var AC,z=this.selectorControl&&this.selectorControl.showall,AD=!!this.defn.msuc,v=this.isSelectAllCell(AB),AE=(this.model.getSelectorControlMapInfo?this.model.getSelectorControlMapInfo():[]),w=!this.selectorControl&&(AE&&AE.length>0),AF,x,AH,AA,AG=this.parent&&this.parent.defn&&this.parent.defn.t===527;if(AG){AD=!!this.parent.defn.msuc;}if(w){if(!AD){u=k.SINGLE;}AH=this.getCellForNode(AB);x=AH&&AH.id;AA=Y.find(AE,"did",x);if(AA>=0){AF=AE[AA].sc;z=AF.showall||AF.all;}}if(AB.attributes.getNamedItem("ei")!==null&&(w||(!B.call(this,AB)&&(z||!v)))){AC=this.getSelectionHash();if(V.isEmpty(AC)){this.selCells=[];}if(AB.className.indexOf(this.CELL_HIGHLIGHT)!==-1&&this.selCells.length>0){if(z===false&&(u===k.SINGLE||u===k.CONTROL)&&l.call(this,AB)){return ;}if(u===k.SINGLE&&l.call(this,AB)){u=k.CONTROL;this.xTabHiddenTextArea.blur();}}this.clearHighlights();this["on"+u+"Select"](AB,w);this.lastSelectedCell=AB;if(u!==k.SHIFT){this.shiftInfo={lastCell:AB,selCells:[].concat(this.selCells)};}this.markSelections();this.endSelections();}else{if(z===true&&AB.attributes.getNamedItem("ei")===null&&!this.cellMenuOnCloseFlag){e.call(this);this.markSelections();this.endSelections();}}},t=function t(w){var v=false,u=this.isSelectAllCell(w);if(w.attributes.getNamedItem("ei")!==null&&!u){v=this.isSelected(w);if(v){c.call(this);}else{a.call(this,h.call(this,w));}this.markContextMenuSelections();}},l=function l(AB){var w=this.selCells,z=true;if(this.selectSiblings(AB)){var v=this.getCellForNode(w[0]),u=this.model.getCellInfo(v).isMetric,x=u?v._ei:v._e&&v._e.id,AA=u?v._tp&&v._tp._e&&v._tp._e.id:undefined;z=!Y.some(w,function(AC){AC=this.getCellForNode(AC);if(u){return AC._tp._e.id===AA&&AC._ei!==x;}else{return AC._e&&AC._e.id!==x;}}.bind(this));}else{if(w.length>1){z=false;}}return z;};mstrmojo.vi.ui.rw._IsMultiselectXtab=mstrmojo.provide("mstrmojo.vi.ui.rw._IsMultiselectXtab",{_mixinName:"mstrmojo.vi.ui.rw._IsMultiselectXtab",selCells:[],cmSelCells:[],cellMenuOnCloseFlag:false,lastSelectedCell:null,isMultiSelect:false,getLastSelectedCell:function G(){return this.lastSelectedCell;},onCtrlSelect:function f(u,v){U.call(this,h.call(this,u),A.TOGGLE,v);},onShftSelect:function s(AK,w){if(w){return this.onSingleSelect(AK,w);}var v=this.shiftInfo.lastCell;if(K.call(this,AK,v)){this.selCells=[].concat(this.shiftInfo.selCells);var AF=d.call(this),AG,z,AD,x,AE,AI,AH=n.call(this,v),AC=n.call(this,AK),u=parseInt(v.getAttribute("r"),10),AJ=parseInt(AK.getAttribute("r"),10),AB=this.model.getCellInfo(this.getCellForNode(AK));if(AB.isMetric){AG=u;z=AJ;}else{if(AH===AC){AE=this.getCellForNode(v);AI=this.getCellForNode(AK);}else{var AA=Math.min(AH,AC);AE=M.call(this,u-AF,AA);AI=M.call(this,AJ-AF,AA);if(this.zone.searchRow(AE.o+AF)===null){AE=this.getCellForNode(v);}if(this.zone.searchRow(AI.o+AF)===null){AI=this.getCellForNode(AK);}}AD=(AE.o<AI.o)?AE:AI;AG=Q.call(this,AD,AF,-1);x=(AE.o>AI.o)?AE:AI;z=Q.call(this,x,AF,1);}J.call(this,AH,AG,AC,z);}},onSingleSelect:function P(u,v){U.call(this,h.call(this,u),A.REPLACE_ALL,v);},handleSelection:function E(z,u,x){var w=x&&X.findAncestorByName(x,"td",true,this.viewport),v=K.call(this,w,this.lastSelectedCell),AA;if(!X.isRMC(z,u)){if(X.isMetaKey(u,z)&&v){AA=k.CONTROL;}else{if(X.shiftKey(u,z)&&v){AA=k.SHIFT;}else{AA=k.SINGLE;}}Z.call(this,AA,w);}else{if(!(X.isMetaKey(u,z)||X.shiftKey(u,z))){t.call(this,w);}}},markSelections:function D(){this.highlightCells(this.selCells);},markContextMenuSelections:function R(){this.highlightCellsWithContextMenuSelection(this.cmSelCells);},handlesMultiSelection:function j(u){return(this._super&&this._super(u))||this.isMultiSelect;},isSelected:function p(u){return Y.indexOf(this.selCells,u)!==-1;},addSelection:function O(u){if(!this.isSelected(u)){Z.call(this,k.CONTROL,u);}},onclick:function g(v){X.clearBrowserHighlights();W.call(this);var x=v.getTarget&&v.getTarget();if(this.handlesMultiSelection(v)){if(mstrApp.isExpress){var w=x&&X.findAncestorByName(x,"td",true,this.viewport),u=X.findAncestorByName(x,"span",true,w);if(u){this.handleSelection(v.e,v.hWin,x);}}else{this.handleSelection(v.e,v.hWin,x);}}else{this._super(v);}this.cellMenuOnCloseFlag=false;},singleUnitSelect:function m(){var v=this.lastSelectedCell,u=this.getCellForNode(v);this.defaultAction(v,u);},getActionCells:function L(u){var w=this,v=Y.map(Y.filter(this.selCells,function(z){var x=w.getCellForNode(z);return x&&u&&(x.tui||x.ui)===(u.tui||u.ui);}),function(x){return w.getCellForNode(x);});if((v.length===0)||!this.model.getCellTitleInfo(u).isSrcTitle){v=this._super(u);}return v;},openXtabCellMenu:function N(z){var v=mstrmojo.findAncestor(this,"openXtabCellMenu"),w=this,u=null;if(this.isInFilterPanel()&&mstrApp&&mstrApp.isInVFInteractMode){v=this.controller&&this.controller.view;}if(v){if(z.evt){if(X.isMetaKey(z.hWin,z.evt)){var x=z.td&&X.findAncestorByName(z.td,"td",true,this.viewport);this.addSelection(x);}}u=v.openXtabCellMenuWithSelectionStyleControl(z);if(u){u.onCloseMenuCallBack=function(){w.clearContextMenuHighlights();w.cellMenuOnCloseFlag=true;};}if(this.parent&&this.parent.selectVIUnit){this.parent.selectVIUnit();}}},highlightCells:function(v,u){if(this._super){this._super(v,u);}if(u){this.selCells=v;}},selectSiblings:function(){return true;},isSelectAllCell:function o(w){var u=this.getCellForNode(w),v=u&&this.model.getCellDataUnion(u);return !!u&&(v.length===0||(v.length===1&&!v[0].eid));}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.array","mstrmojo.css");var X=mstrmojo.hash,U=mstrmojo.array,d=mstrmojo.func,g=mstrmojo.css;var P="selected",V="all",a="u;",L="levelAll",c=-100;var H=0,O=1,E=2;var F=["docSelector","multiSelect","allIdx","noneIdx","include"];function K(k){return parseInt(k,10)>=0;}function h(l){var k=[];l.forEach(function(m){delete m.children;});l.forEach(function(p,m,n){var o=n.p_index;if(o){if(o.children){o.children.push(p);}else{o.children=[p];}}else{k.push(p);}});return k;}function A(k){var l=k.slice(0);l.sort(function(n,m){if(n.n<=m.n||n.v===a){return -1;}return 1;});return l;}function J(l){var m=[],k=h(l);k.forEach(function n(o){m.push(o);(o.children||[]).forEach(function(p){n(p);});});return m;}function f(l){var k=this.sortedItemsCache;if(k){if(k[l]){return k[l];}}else{k=this.sortedItemsCache={};}switch(l){case O:return k[l]=A(this.items);case E:return k[l]=J(this.items);default:return k[l]=this.items;}}function D(){var k=this.items,m=this.sortedItemsCache,l=m&&this.sortedItemsCache[H];return !k||!l||k.length!==l.length||k.some(function(o,n){return o!==l[n];});}function j(){var l=this.docSelector,o=l.node.data.p_relation||[],k=this.items,m=!l.lockSelection,n=[];if(D.call(this)){k.forEach(function(q,p){q.p_index=o[p]&&o[p].p_index;if(q.v!==a){n[q.lv]=true;}});this.set("levels",n);this.sortedItemsCache={};this.sortedItemsCache[H]=k;if(m){this.set("applyEnabled",false);}Z.call(this,m);}}function B(n,m,l){var o={},k={};m.forEach(function(q,p){if(n[p]){o[q.v]=true;}});l.forEach(function(q,p){if(o[q.v]){k[p]=true;}});return k;}function N(l){var k=this.getCheckList();return B(l||k.selectedIndices,k.items,this.items);}function M(l){var k=this.getCheckList();return B(l||this.selectedIndices,this.items,k.items);}function Z(o){var l=this.getCheckList(),n=l.items,k=X.copy(l.selectedIndices)||{},m=f.call(this,K(this.level)?O:E);if(m.length>0){l.set("items",m);l.set("selectedIndices",o?M.call(this):B(k,n,m));}}function S(){var k=this.searchInput;if(k&&k.hasRendered){k.clearSearch(true);}}function W(){var l=this.searchInput,k=this.renderableItems||[];if(l&&l.isClear()){l.set("visible",k.length>15);}}function Q(){var k=this.searchInput,l=!k||k.isClear();return K(this.level)&&this.allIdx>=0&&l;}function e(){if(Q.call(this)){var l=this.selectedIndices,m=this.level,k=l[this.allIdx]||!(this.items||[]).some(function(o,n){return o.lv===m&&!l[n];});this.isLevelSelected=k;g.toggleClass(this._getItemNode(c),"selected",k);}}function R(){this.filterItems();W.call(this);}mstrmojo.vi.ui.rw.selectors._IsLevelList=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsLevelList",{scriptClass:"mstrmojo.vi.ui.rw.selectors._IsLevelList",level:V,levels:[],applyEnabled:false,getCheckList:mstrmojo.emptyFn,postCreateChildren:function(){var r=this,s=this.getCheckList();d.override({getItemMarkup:function u(w,v){return this._super(w,v).replace('<span class="icon"></span>','<span class="iconRA-checkbox"></span>');},filterItems:function p(){this._super();e.call(this);},updateRenderableItems:function l(){this._super();if(Q.call(this)&&this.renderIndex===0){this.renderableItems.unshift({n:"("+mstrmojo.desc(2461,"All")+")",v:L,_renderIdx:c,cls:"noOnly"});}},getFilteredItem:function m(v){var w=this._super(v),x=this.level;if(w){if(x!==V&&w.v===a){return null;}if(x===P&&!this.selectedIndices[v]){return null;}if(K(x)&&x!==w.lv){return null;}return w;}return null;},postBuildRendering:function k(){this._super();W.call(this);},onchange:function n(v){this._super(v);if(this.hasRendered){if(this.level===P){R.call(this);}else{e.call(this);}}},onclick:function t(w){var AC=w.getTarget(),AB=this.getItemNodeFromTarget(AC),v=AB&&parseInt(AB.getAttribute("idx"),10),AA=this.getItemFromTarget(AC);if(AA){this._super(w);r.set("applyEnabled",true);}else{if(v===c){var AD=this.level,z=X.copy(this.selectedIndices),x=this.isLevelSelected=!this.isLevelSelected;this.items.forEach(function(AF,AE){if(AF.lv===AD){if(x){z[AE]=true;}else{delete z[AE];}}});delete z[this.allIdx];this.set("selectedIndices",z);r.set("applyEnabled",true);}}},shouldShowTooltip:function q(v,AA){var z=v.target||$DOM.eventTarget(v.hWin,v.e);if(z.classList.contains("text")){var AB=z.parentNode,x=AB.getElementsByClassName("iconRA-checkbox")[0],w=AB.getElementsByClassName("only")[0];return z.offsetWidth+(w?w.offsetWidth:0)+x.offsetWidth>AB.offsetWidth;}return this._super(v,AA);},updateTooltipConfig:function o(x){var AD=mstrmojo.dom,w=mstrmojo.tooltip;var AC=x.target||AD.eventTarget(x.hWin,x.e),v=AD.position(AC.parentNode),AA=6;arrowType="vi-tooltip-C",posType=w.POS_TOPLEFT;var AB=v.w+AA,z=AD.windowDim().w;if(z<(v.x+AB+300)){arrowType="vi-tooltip-D";AB=-25;posType=w.POS_TOPRIGHT;}this.richTooltip={content:this.getTooltipContent(x),top:-10,cssClass:"vi-regular "+arrowType,left:AB,refNode:AC,posType:posType};}},s);s.markupMethods=X.copy({onlevelChange:function(){var v=this.level===P?"add":"remove";g[v+"Class"](this.domNode,"showSelected");S.call(this);R.call(this);}},X.copy(mstrmojo.ui.CheckList.prototype.markupMethods));},onlevelChange:function b(k){Z.call(this);},preBuildRendering:function C(){X.copyProps(F,this,this.getCheckList());j.call(this);this._super();},select:function Y(l){var k=U.hash(l);this.getCheckList().select(X.keyarray(M.call(this,k),true));this.selectedIndices=N.call(this);this.set("applyEnabled",false);},getLevels:function I(l){var k=this.getlevelNames(),m=[{n:mstrmojo.desc(14672,"Selected Items"),v:P},{n:mstrmojo.desc(2461,"All"),v:V}];U.forEach(l,function(o,p){if(o){var n=k[p]||mstrmojo.desc(493,"Level")+" "+(p+1);m.push({n:n,v:p});}});return m;},handleSelectionSubmit:function G(k){var l=this.getCheckList();if(k){this.selectedIndices=N.call(this);this.onchange();}else{l.set("selectedIndices",M.call(this));}this.set("applyEnabled",false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array");var E=mstrmojo.dom,Q=mstrmojo.css,B=mstrmojo.string,I="selected",L="hidden";function P(W,X,Y,V,a){var Z=a.listHooks[W];if(Z&&Z.call(a,X,Y,V)){return ;}Q.toggleClass(X,I,W==="select");}function G(Y,X,W){var Z=this[Y],V=Z?Z.split(X):[];this[Y]=mstrmojo.array.distinct(V.concat(W.split(X))).join(X);}mstrmojo._IsList=mstrmojo.provide("mstrmojo._IsList",{_mixinName:"mstrmojo._IsList",listHooks:{},useListModKeys:false,init:function N(V){this._super(V);this._shiftStartIndex=-1;},getItemMarkup:function D(W,V){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';},getItemDisplayName:function M(V){return V.n||"";},getItemProps:function R(Z,V){var W=!!this.selectedIndices[V],a={tag:"div",sel:W,cls:"",n:this.getItemDisplayName(Z),style:"",idx:V,addCls:function X(c){G.call(this,"cls"," ",c);},addStyle:function Y(c){G.call(this,"style",";",c);},title:Z.title||""};if(a.n&&B.isEmpty(a.n)){a.n=B.decodeHtmlString("<br/>");}if(W){a.addCls(I);}var b=Z.cls;if(b){a.addCls(b);}if(Z.hid){a.addCls(L);}return a;},itemRenderer:{render:function S(W,V,X){W._renderIdx=V;return mstrmojo.string.apply(X.getItemMarkup(W,V),X.getItemProps(W,V));},select:function K(W,X,V,Y){P("select",W,X,V,Y);},unselect:function H(W,X,V,Y){P("unselect",W,X,V,Y);}},onclick:function U(V){try{var X=this.getItemFromTarget(V.getTarget());if(X){V.cancel();this.doItemSelect(X,V||{});}}catch(W){mstrApp.onerror(W);}},doItemSelect:function C(l,k){var c=k.hWin,d=k.e,h=l._renderIdx,f=l._positionIdx,W=E.isMetaKey(c,d),b=E.shiftKey(c,d),X=this.multiSelect,a=this.useListModKeys,j=this._shiftStartIndex,Y=this.selectedIndices;if(X&&a&&b&&j>-1){var V=[],Z=[];this.processContinuousSelection(V,Z,h);this.addSelect(V);this.removeSelect(Z);}else{if(X&&(!a||W)){var g=(Y[h])?"remove":"add";this[g+"Select"](h,false,f);}else{this.singleSelect(h,false,f);}this._shiftStartIndex=h;}},processContinuousSelection:function J(X,W,V){var c=this._shiftStartIndex,b=this.selectedIndices,a=Math.min(c,V),Z=Math.max(c,V),Y;for(Y=0;Y<this.items.length;Y++){if(a<=Y&&Y<=Z){if(!b[Y]){X.push(Y);}}else{if(b[Y]){W.push(Y);}}}},onclearSelection:function A(){this._shiftStartIndex=-1;},getItemNodeFromTarget:function F(W){var V=E.findAncestorByAttr(W,"idx",true,this.domNode);return(V&&V.node)||null;},getItemFromTarget:function O(X){var W=this.getItemNodeFromTarget(X),V=W&&parseInt(W.getAttribute("idx"),10);if(V!==null&&!isNaN(V)&&this.items){return this.items[V];}return undefined;}});mstrmojo._IsList.SELECTED_CLS=I;mstrmojo._IsList.HIDDEN_CLS=L;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.string","mstrmojo.css");var K=mstrmojo.css,N=mstrmojo.string,H=mstrmojo.dom,L=13,C=27;function I(U){if(this._editComplete){return ;}var Y,R=false,X=this.text,V=false;if(U===C){Y=X;V=true;R=true;}if((!U&&U!==0)||(!this.allowNewLine&&U===L)){var S=this[this.editableSlot],W=S.innerText||S.textContent||"";if(!this.allowNewLine){Y=W.replace(/\n/g,"");}else{Y=W;}R=true;if(!this.allowEmptyText&&Y.length===0){Y=X;V=true;}}if(R){this._editComplete=true;Y=Y.replace(/\u00A0/g,"\u0020");this.text=Y;this.set("isEditing",false);this.onTextEditComplete(Y!==X,X);delete this._editComplete;}if(V){this.refresh();}}function E(R){var S={dblclick:"editOnDoubleClick",click:"editOnClick"};if(this[S[R.name]]||(R.name==="click"&&this.editOnTwoClicks)&&R.getTarget()===this[this.editableSlot]){this.set("isEditing",true);}}function F(U,S,R){if(typeof S["on"+R]!=="function"){H.attachMarkupEvent(U,S,R);}}mstrmojo._HasEditableText=mstrmojo.provide("mstrmojo._HasEditableText",{_mixinName:"mstrmojo._HasEditableText",editableSlot:"domNode",editButtonSlot:null,isEditing:false,editOnClick:true,editOnTwoClicks:false,firstClickTime:undefined,allowEmptyText:false,allowTrimming:true,allowNewLine:false,editOnDoubleClick:false,onTextEditBegin:mstrmojo.emptyFn,onTextEditComplete:mstrmojo.emptyFn,postBuildRendering:function A(){this._super();var U=this.editableSlot,R=this[U],V=this[this.editButtonSlot||U];K.addClass(R,"hasEditableText");this.text=this.text||R.innerText||R.textContent||"";R.innerHTML=this.getEditableTextInnerHTML();var S=this.id;if(this.editOnClick||this.editOnTwoClicks){F(S,V,"click");}F(S,V,"dblclick");F(S,R,"blur");F(S,R,"keyup");F(S,R,"keydown");},getEditableTextInnerHTML:function Q(){return N.encodeHtmlString(this.text,true).replace(/ (?= )/g,"&nbsp;");},onclick:function P(R){if(this.editOnClick){E.call(this,R);}if(this._super){this._super(R);}},onTwoClicks:function(R){if(this.editOnTwoClicks){E.call(this,R);}if(this._super){this._super(R);}},ondblclick:function G(R){E.call(this,R);},onblur:function M(){I.call(this);},onkeyup:function B(S){var R=window.event||S.e;I.call(this,R.keyCode);},onkeydown:function J(S){var R=window.event||S.e;if(R.keyCode===L){I.call(this,R.keyCode);S.cancel();}},_set_text:function D(U,R){var S=this.text;this.text=R;if(this.hasRendered){this[this.editableSlot].innerHTML=N.encodeHtmlString(R||"",true);}return(S!==R);},onisEditingChange:function O(){if(this.hasRendered){var R=this[this.editableSlot],S=!!this.isEditing;R.contentEditable=S;R.spellcheck=false;K.toggleClass(R,"editable",S);if(S){R.focus();H.setElementSelection(R);this.onTextEditBegin();}else{R.blur();R.scrollLeft=0;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.fx");var e=mstrmojo.css,J=mstrmojo.dom,R=mstrmojo.array,N={v:{styleDim:"height",styleDir:"top",dimension:"h",position:"y",scroll:"scrollTop",scrollDimension:"scrollHeight",cls:"vertical",hostCls:"hasVertical",scrollNodeCls:"hasVertical"},h:{styleDim:"width",styleDir:"left",dimension:"w",position:"x",scroll:"scrollLeft",scrollDimension:"scrollWidth",cls:"horizontal",hostCls:"hasHorizontal",scrollNodeCls:"hasHorizontal"}},c="scrollingMode",V="scrolling",h=3;var O=J.getOSInfo().name.toLowerCase().indexOf("mac")>=0;function M(){return(this.scrollbarHostNode||(this.scrollNode&&this.scrollNode.parentNode));}function W(n,k){var m=this.scrollNode,j=M.call(this),l={v:n,h:k};R.forEach(["v","h"],function(p){var o=N[p];e.toggleClass(j,o.hostCls,l[p]);e.toggleClass(m,o.scrollNodeCls,l[p]);});}function S(k,j){var p=J.eventTarget(j,k),n=this.scrollNode,m=J.position(n),o=this.scrollTrackNodes,l=this.scrollBarNodes,q=function q(z){var w=p===o[z];if(w){var AA=N[z],r=l[z],AB=J.position(r),t=J.getMousePosition(k,j)[AA.position],u=t-AB[AA.position],s=u>0?1:-1,x=n[AA.scrollDimension],AC=Math.abs(u-(AB.h/2))*(x/m[AA.dimension]),v={};v[AA.scroll]={isStyle:false,start:n[AA.scroll],stop:n[AA.scroll]+(s*Math.min(x/3,500,AC)),ease:mstrmojo.ease.linear};(new mstrmojo.fx.AnimateProp({props:v,duration:200,interval:10,target:n})).play();}};q.call(this,"h");q.call(this,"v");}function C(k,j){var n=this.scrollNode,m=k.type==="mousewheel",l=m?-1:1;mstrmojo.array.forEach(["h","v"],function(u){var s=N[u],p=m?"wheelDelta":"delta",r=k[p+{h:"X",v:"Y"}[u]]*l,q=Math.abs(r),o=r/q,t=q===3&&J.isFF&&!O;n[s.scroll]+=t?o*40:r;});J.stopPropogation(j,k);J.preventDefault(j,k);}function g(o){var n=N[o],m=this.scrollNode,l=J.position(m),k=l[n.dimension],p=m[n.scrollDimension],j=Math.ceil(k)/p;return A(j,k,p);}function A(k,j,l){return(!isNaN(k)&&k<1)&&(Math.abs(j-l)>h);}function D(AI){var AB="px",t=N[AI],n=this.scrollNode,u=M.call(this),AK=J.position(n),v=AK[t.dimension],AD=n[t.scrollDimension],m=Math.ceil(v)/AD,AH=this.scrollBarNodes,r=AH[AI],z=this.scrollTrackNodes,AA=z[AI],AF=A(m,v,AD),o=t.cls;if(!r){AA=z[AI]=document.createElement("div");var p=this,x=function(AM){S.call(p,AM);},s=function(AM){C.call(p,AM);},AE=function(AO,AM,AN){J.attachEvent(AO,AM,AN);p.installedEventListeners.push({e:AO,evt:AM,fn:AN});};AE(AA,"click",x);AA.className="mstrmojo-scrolltrack "+o;r=AH[AI]=document.createElement("div");r.className="mstrmojo-scrollbar "+o;AA.appendChild(r);u.appendChild(AA);var AG=mstrApp.isSingleTier?"mousewheel":"wheel";AE(AA,AG,s);AE(r,AG,s);}var AL=r.style,q=(n[t.scroll]/n[t.scrollDimension]),k=J.delta(n,M.call(this))[t.position],AC=AA.style;if(AF){AC[t.styleDir]=k+AB;var l=m*v,w=35,AJ=v*q,j=v-35;AL[t.styleDim]=(l<w?w:l)+AB;AL[t.styleDir]=(AJ>j?j:AJ)+AB;}return AF;}function I(){return !(mstrApp.isSingleTier&&O);}mstrmojo.ui._HasScroller=mstrmojo.provide("mstrmojo.ui._HasScroller",{_mixinName:"mstrmojo.ui._HasScroller",hasCustomScrollbar:null,draggable:true,ownAvatar:true,scrollNode:undefined,scrollbarHostNode:undefined,scrollBarNodes:undefined,setupScrollNodes:mstrmojo.emptyFn,installedEventListeners:null,init:function Y(j){this._super(j);if(this.hasCustomScrollbar===null){this.hasCustomScrollbar=I();}this.installedEventListeners=[];},onRender:function L(){if(this._super){this._super();}this.updateScrollbars();this.addScrollNodeProperties();},addScrollNodeProperties:function G(){var k=this.scrollNode,l=J.isFF&&!O;if(k){var j=J.attachMarkupEvent(this.id,k,"scroll");this.installedEventListeners.push({e:k,evt:"scroll",fn:j});}if(l){e.addClass(k,"firefox-on-windows");}else{if(J.isEdge){e.addClass(k,"ms-edge");}}if(!this.hasCustomScrollbar){e.addClass(M.call(this),"mstrmojo-sb-host-show-default");e.addClass(k,"mstrmojo-sb-show-default");return ;}if(k){e.addClass(M.call(this),"mstrmojo-scrollbar-host");e.addClass(k,"mstrmojo-scrollNode");}},updateScrollbars:function f(){if(!this.hasRendered){return ;}this.setupScrollNodes();var j,l=false;if(!this.hasCustomScrollbar){if(this.scrollNode){j=this.scrollNode.style;j.overflowY=g.call(this,"v")?"scroll":"hidden";j.overflowX=g.call(this,"h")?"scroll":"hidden";}return ;}if(this.scrollNode){this.scrollBarNodes=this.scrollBarNodes||{};this.scrollTrackNodes=this.scrollTrackNodes||{};W.call(this,l,l);j=this.scrollNode.style;var m=D.call(this,"v"),k=D.call(this,"h");j.overflowY=m?"scroll":"hidden";j.overflowX=k?"scroll":"hidden";W.call(this,m,k);}},onscroll:function b(){var q=this.scrollNode;if(q&&this.hasCustomScrollbar){var n=function n(r){var s=parseInt(r);return s===null||isNaN(s)?0:s;},o=J.position(q),p=o.h-n(e.getStyleValue(q,"padding-bottom")),k=o.w-n(e.getStyleValue(q,"padding-right")),m=this.scrollBarNodes,l=m.v,j=m.h;if(q.scrollHeight-p>0){l.style.top=((p-J.position(l).h)*(q.scrollTop/(q.scrollHeight-p)))+"px";}if(q.scrollWidth-k>0){j.style.left=((k-J.position(j).w)*(q.scrollLeft/(q.scrollWidth-k)))+"px";}}if(this._super){this._super();}if(this.onScrollEnd){this.onScrollEnd();}},getDragData:function F(k){var n=this.scrollNode,m=J.position(n),l=k.src.node,j=this.scrollBarNodes;if(this.isDraggingScrollBar(k)){return{isScrollBar:true,direction:l===j.v?"v":"h",scrollTop:n.scrollTop,scrollLeft:n.scrollLeft,conversionRatio:{y:n.scrollHeight/m.h,x:n.scrollWidth/m.w}};}return(this._super&&this._super(k));},isDragValid:function E(j){return this.isDraggingScrollBar(j)||(this._super&&this._super(j))||false;},isDraggingScrollBar:function X(k){var l=k.src.node,j=this.scrollBarNodes;return !!j&&(l===j.v||l===j.h);},ondragstart:function d(j){if(this.isDraggingScrollBar(j)){e.addClass(j.src.node,V);e.addClass(M.call(this),c);}if(this._super){this._super(j);}},shouldDragBubble:function U(j){var k=j.src.node,l=this.scrollTrackNodes;return !(!!l&&(k===l.v||k===l.h));},ondragmove:function Q(k){if(this.isDraggingScrollBar(k)){var s=k.tgt,j=k.src,t=s.pos,l=j.pos,p=j.node,o=this.scrollNode,r=this.scrollBarNodes,q=j.data,n={y:(t.y-l.y),x:(t.x-l.x)},m=q.conversionRatio;if(p===r.v){o.scrollTop=q.scrollTop+(n.y*m.y);}else{o.scrollLeft=q.scrollLeft+(n.x*m.x);}}if(this._super){this._super(k);}},ondragend:function K(j){if(this.isDraggingScrollBar&&this.isDraggingScrollBar(j)){e.toggleClass(j.src.node,V,false);e.toggleClass(M.call(this),c,false);}if(this._super){this._super(j);}},widgetResized:function P(){if(this._super){this._super();}this.updateScrollbars();},unrender:function Z(j){R.forEach(this.installedEventListeners,function(k){J.detachEvent(k.e,k.evt,k.fn);});this.installedEventListeners=[];delete this.scrollNode;delete this.scrollbarHostNode;delete this.scrollBarNodes;delete this.scrollTrackNodes;this._super(j);},getDefaultScrollBarProps:function a(j){return N[j];},disableScroll:function B(j,m){var l=this.scrollNode,k=M.call(this);R.forEach(["v","h"],function(o){var n=N[o];e.toggleClass(k,n.hostCls,false);e.toggleClass(l,n.scrollNodeCls,false);});if(l){if(m||m===undefined){l.style.overflowY="hidden";}else{if(l.style.overflowY==="hidden"){l.style.overflowY="auto";}}if(j||j===undefined){l.style.overflowX="hidden";}}},enableScroll:function H(){this.updateScrollbars();if(!this.hasCustomScrollbar&&this.scrollNode){this.scrollNode.style.overflowY=g.call(this,"v")?"scroll":"hidden";}},scrollIntoViewIfNeeded:function(m){var r=this.scrollNode,o=m.clientHeight,n=r.clientHeight,k=J.position(m).y,p=J.position(r).y,l=k-p,j=l<0,q=l+o>n;if(j||q){r.scrollTop+=l+o/2-n/2;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash");var K=1,B=2;function N(Q,P){return D(Q,P)&&Q.o===P.o;}function D(Q,P){return Q&&P&&Q.ui===P.ui&&Q.axis===P.axis&&Q.mix===P.mix;}function A(U,Q,R){var S=R.getCellTitleId(Q),P=R.getCellUnitIndex(Q);R.selections[S]=R.selections[S]||{};R.selections[S][P]=R.selections[S][P]||[];R.selections[S][P].push(U);M(U,Q,R);}function M(U,Q,R){if(Q){var S=R.getCellTitleId(Q),P=R.getCellUnitIndex(Q);if(!R.selectionsForCopy){R.selectionsForCopy={};}R.selectionsForCopy[S]=R.selectionsForCopy[S]||{};R.selectionsForCopy[S][P]=R.selectionsForCopy[S][P]||[];R.selectionsForCopy[S][P].push(U);C(U);}}function O(Q){var V=Q.selectionsForCopy;for(var U in V){for(var S in V[U]){for(var R=0,P=V[U][S].length;R<P;R++){J(V[U][S][R]);}}}Q.selections={};Q.selectionsForCopy={};}function C(P){mstrmojo.css.setOpacity(P,50);if(P.nodeName.toLowerCase()==="td"&&mstrmojo.dom.isIE8){mstrmojo.css.addClass(P,"showGridBorder");}}function J(P){mstrmojo.css.setOpacity(P,100);if(P.nodeName.toLowerCase()==="td"&&mstrmojo.dom.isIE8){mstrmojo.css.addClass(P,"showGridBorder");}}function F(R,S){if(R.mix===undefined){var W=S.gridData.gts[R.axis===K?"row":"col"],Q=W[R.tui||R.ui],V=0;for(var U=0,P=W.length;U<P;U++){if(W[U].id===Q.id){V++;}}return V;}return 0;}function H(){var Q="_xtabSelectionsHiddenField",P;P=document.getElementById(Q);if(!P){P=document.createElement("textarea");P.id=Q;P.style.opacity=0;P.style.position="absolute";P.style.top=0;P.style.height=0;P.style.width=0;document.body.appendChild(P);}return P;}function G(){var X="",Z={},R,c=[],g=[],Q={},S={},P=this.selectionsForCopy,W=mstrmojo.hash,Y=mstrmojo.array,e=function(h,j){if(h.hasOwnProperty("mix")){return j.es[h.mix].n;}else{return j.n;}},U,a,V,f,d,b=0;W.forEach(P,function(h){W.forEach(h,function(j){Y.forEach(j,function(k){b++;a=k.offsetLeft;V=k.offsetTop;if(!Z[a]){Z[a]={};}R=Z[a];R[V]=k.innerText;if(Y.indexOf(c,a)===-1){c.push(a);}if(Y.indexOf(g,V)===-1){g.push(V);}f=this.getCellForNode(k);d=this.model.getCellTitleInfo(f).title;if((!d.id&&d.axis===K)||(d.id&&d.axis===B)){S[V]=e.call(this,f,d);}else{Q[a]=e.call(this,f,d);}},this);},this);},this);c.sort(function(j,h){return j-h;});g.sort(function(j,h){return j-h;});if(b>1&&!W.isEmpty(S)){X="\t";}if(b>1&&!W.isEmpty(Q)){Y.forEach(c,function(h){X+=(Q[h]||"")+"\t";});X+="\n";}Y.forEach(g,function(h){if(b>1&&!W.isEmpty(S)){X+=(S[h]||"")+"\t";}Y.forEach(c,function(j){X+=(Z[j][h]||"")+(b>1?"\t":"");});if(b>1){X+="\n";}});U=H();U.value=X;U.focus();U.select();}mstrmojo._XtabSelections={lastSelectedTD:null,singleSelectForCopy:function I(P){var V=this.getCellForNode(P),c,d,a,b=V&&V.mix!=undefined,S=function(f,e){e=e||{};f=f||{};if(b){return f.mix==e.mix;}else{return f.mix==e.mix&&f.ui==e.ui;}};a=mstrmojo.dom.findAncestorByName(P,"table",false);d=a.rows;for(var W=0,X=d.length;W<X;W++){var Z=d[W].cells;for(var U=0,R=Z.length;U<R;U++){var Q=Z[U],Y=this.getCellForNode(Q);if(Q!=P&&S(Y,V)){M(Q,Y,this);}}}},singleSelect:function E(Q,Z){var X=this.getCellForNode(Q),g=Q.parentNode;if(Z){var W=this.getCellTitleId(X),c=this.getCellUnitIndex(X);selectedTitle=this.selections[W];selectedUnit=selectedTitle&&selectedTitle[c];if(selectedUnit){for(var Y=0,a=selectedUnit.length;Y<a;Y++){J(selectedUnit[Y]);}delete selectedTitle[c];return ;}}var V=F(X,this);if(X.axis===K){for(var Y=0,P=0,a=g.cells.length;Y<a&&P<V;Y++){var S=g.cells[Y],b=this.getCellForNode(S);if(N(b,X)){A(S,b,this);P++;}}}else{if(X.axis===B){var e=mstrmojo.dom.findAncestorByName(Q,"table",false),f=e.rows;for(var Y=0,P=0,a=f.length;Y<a&&P<V;Y++){var d=f[Y].cells;for(var U=0,R=d.length;U<R;U++){var S=d[U],b=this.getCellForNode(S);if(N(b,X)){A(S,b,this);P++;break;}}}}else{A(Q,X,this);}}},rangeSelect:function L(k,l){var f=this.getCellForNode(k),P=this.getCellForNode(l);if(D(f,P)){if(f.o>P.o||f._ei>P._ei){var o=k;k=l;f=this.getCellForNode(k);l=o;P=this.getCellForNode(l);}var b=F(f,this),Q=f.axis,m=mstrmojo.dom.findAncestorByName(k,"table",false),Y=m.rows,g=k.parentNode,p=g.rowIndex,a=g.cells,d=l.parentNode.rowIndex;if(Q===K){for(var e=p;e<=d;e++){var R=Y[e].cells,S=false;for(var c=0,h=R.length,U=0;c<h&&U<b;c++){var W=R[c],Z=this.getCellForNode(W);if(D(Z,f)){A(W,Z,this);U++;}}}}else{if(Q===B){for(var e=0,h=Y.length,n=0;e<h&&n<b;e++){var R=Y[e].cells,X=false;for(var c=0,V=R.length;c<V;c++){var W=R[c],Z=this.getCellForNode(W);if(N(Z,f)){X=true;}if(X){A(W,Z,this);}if(N(Z,P)){break;}}if(X){n++;}}}else{if(p==d){for(var e=k.cellIndex,h=l.cellIndex;e<=h;e++){var W=a[e],Z=this.getCellForNode(W);A(W,Z,this);}}else{for(var e=p,h=d;e<=h;e++){var R=Y[e].cells;for(var c=0,V=R.length;c<V;c++){var W=R[c],Z=this.getCellForNode(W);if(D(Z,f)){A(W,Z,this);break;}}}}}}}},doSelection:function(X,W,U){var Y=mstrmojo.dom,P=Y.isMetaKey(W,X),Q=Y.shiftKey(W,X);if(!P){O(this);}this.clearAllHighlights();var V=this.getCellForNode(U);var R=V&&(V.mix===undefined&&V.o!==undefined),S=V&&(V.mix!==undefined&&(V._lp||V._tp));if(R||S){if(Q){this.rangeSelect(this.lastSelectedTD,U);}else{this.singleSelect(U,P);this.lastSelectedTD=U;}}else{this.singleSelectForCopy(U,P);}G.call(this);},clearAllHighlights:function(){var Q=this.getCellForNode(this.lastSelectedCell),S=Q&&this.gridData.gts[Q.axis===1?"row":"col"],P=S&&S[Q.tui||Q.ui];var R=P&&P.sc&&P.sc.tks&&P.sc.tks.split("\x1E");if(R&&this.model.docModel.getTargetInfoWin(R).length==R.length){this.clearHighlights();}}};})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var U=mstrmojo.css,E=mstrmojo.dom,J=mstrmojo.array,K=[],F=null,L=function(X){return(X&&X.rw&&X.rw.row&&X.rw.row.tc)||0;},B=function(Y,X){if(X){if(Y===1){return mstrmojo.desc(11944,"1 of 1 Row selected");}return mstrmojo.desc(11945,"# of ## Rows selected").replace("##",Y).replace("#",X);}return Y===1?mstrmojo.desc(11946,"1 Row"):mstrmojo.desc(11947,"## Rows").replace("##",Y);},I=function(){var c="",Z,a,d=K[0]&&K[0].parentNode.firstChild,X=this.hiddenField,b=K.length,Y=L(this.gridData);for(Z=0;d&&Z<d.childNodes.length;Z++){a=d.childNodes[Z].innerText||d.childNodes[Z].textContent;c+=a?(a+"\t"):"";}c+="\n";K.forEach(function(e){for(Z=0;Z<e.childNodes.length;Z++){a=e.childNodes[Z].innerText||e.childNodes[Z].textContent;c+=a?(a+"\t"):"";}c+="\n";});X.value=c;X.focus();X.select();c=B(Y,b);this.viewDataDialog.updateToolbarChildren(c);},N=function N(a,X){var Y=this.controller,Z=Y.cmdMgr;Z.getInterimCmd().submitInterim(a,Y._getXtabCallback(this,X||{}),{preserveUndo:true,hideCancel:true});},H=function H(Y,X){N.call(this,this.controller.dataService().getUpdateTemplateAction(this.k,Y),X);},Q=function(Y,a){var X=J.indexOf(K,Y),Z=X>-1;if(Z||a===false){K.splice(X,1);}if(!Z||a===true){K.push(Y);F=Y;}U.toggleClass(Y,"selected",!Z||a===true);},C=function C(){K.forEach(function(X){U.removeClass(X,"selected");});K=[];};mstrmojo.vi.ui.rw._IsViewDataGrid=mstrmojo.provide("mstrmojo.vi.ui.rw._IsViewDataGrid",{_mixinName:"mstrmojo.vi.ui.rw._IsViewDataGrid",submitUndoRedoActionsWithCallback:function A(X,Y){N.call(this,X,Y);},doSelection:function O(r,X,f){if(f.getAttribute("r")==="0"){var s=this.getCellForNode(f);if(s.at&8&&E.getButton(X,r)!==E.MOUSE_BUTTON.RIGHT){this.sort(s);}return ;}if(f&&~f.className.indexOf("xtab-td")){var g=E.isMetaKey(X,r),p=E.shiftKey(X,r),b=E.findAncestorByName(f,"tr",true,this.domNode),Y=E.findAncestorByName(f,"tbody",true,this.domNode);if(g||(p&&!F)){Q(b);}else{if(p&&Y){var a=E.findAncestorByName(F,"tbody",true,this.domNode),q=this.zone.rowsPerPage,o=function(e){return e.tBodyN*q+e.index;},l=function(e){return this.zone.tableNode.childNodes[e+1].childNodes;}.bind(this),c={row:F,tBodyN:parseInt(a.getAttribute("n")||0),index:J.indexOf(a.childNodes,F),body:a},h={row:b,tBodyN:parseInt(Y.getAttribute("n")||0),index:J.indexOf(Y.childNodes,b),body:Y},k,Z,n,m,d;if(o(c)<o(h)){k=c;Z=h;}else{k=h;Z=c;}Q(k.row,true);if(k.tBodyN===Z.tBodyN){d=k.body.childNodes;for(m=k.index+1;m<Z.index;m++){Q(d[m]);}}else{for(n=k.tBodyN;n<=Z.tBodyN;n++){if(n===k.tBodyN){d=k.body.childNodes;for(m=k.index+1;m<d.length;m++){Q(d[m]);}}else{if(n===Z.tBodyN){d=Z.body.childNodes;for(m=0;m<Z.index;m++){Q(d[m]);}}else{d=l(n);for(m=0;m<d.length;m++){Q(d[m]);}}}}}Q(Z.row,true);}else{C();Q(b,true);}}}else{C();}I.call(this);},onclick:function W(b,X){if(!this.interactiveCellsArray.length){return ;}b=b.e||b;var Y=mstrmojo.dom,a=Y.eventTarget(X,b),Z=a&&Y.findAncestorByName(a,"td",true,this.viewport);if(Z){this.doSelection(b,X,Z);Y.clearBrowserHighlights();}},changeColumnWidth:function M(b,Z,a,Y,X){H.call(this,this._super(b,Z,a,Y,X,true));},preBuildRendering:function D(){this._super();U.addWidgetCssClass(this,"viewData");},postBuildRendering:function P(){this._super();var X=L(this.gridData);this.viewDataDialog.updateToolbarChildren(B(X));},lastSortedCell:[],sort:function R(f,d){var Y=f._ei,c=d===undefined,e=c?true:!!d,X=this.lastSortedCell,Z={success:function(){try{var l=this.tableContainerNode.lastElementChild.firstChild.firstChild.firstChild.lastChild.firstChild.childNodes,h=this.tableContainerNode.childNodes[1].firstChild.firstChild.lastChild.firstChild.childNodes,j;for(j=0;j<l.length;j++){if(Y===Number(l[j].getAttribute("ei"))){U.addClass(l[j],e?"asc":"desc");U.addClass(h[j],e?"asc":"desc");}}}catch(k){}}.bind(this)};if(X){if(X[0]===Y){e=c?!X[1]:d;}}X[0]=Y;X[1]=e;var b=this.controller,g=b.getSorts(this.model.getSortAction(f,e)),a={act:"sort",sorts:g.sorts,nodeKey:this.k,subTotalsPos:g.subTotalsPos};H.call(this,a,Z);},pivot:function G(X,Y){var Z=this.model.getPivotAction(X,Y);H.call(this,Z);},selectAll:function S(){var Y=this.zone,Z=Y.tableNode.childNodes,b,a,c,X,d,e=true;C();for(b=0;b<Z.length;b++){c=Z[b];if(c.tagName.toLowerCase()==="tbody"){X=c.getAttribute("n")||0;if(!Y.pageStatus[X].isOnDemand()){d=c.childNodes;for(a=0;a<d.length;a++){if(!e){Q(d[a],true);}e=false;}}}}I.call(this);},isMultiSelect:false,onHandleDblClick:function V(){var X={act:"changeXtabColWidthScenario",value:2};H.call(this,X);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css");var A=mstrmojo.css;mstrmojo.ui._HasUITheme=mstrmojo.provide("mstrmojo.ui._HasUITheme",{_mixinName:"mstrmojo.ui._HasUITheme",themeClassName:"",postBuildRendering:function B(){var D=this.themeClassName;if(D){this.onthemeClassNameChange({value:D});}return this._super();},onthemeClassNameChange:function C(D){var F=this.domNode;if(F){var G=D.value,E=D.valueWas;if(G){A.addClass(F,D.value);}if(E){A.removeClass(F,D.valueWas);}}}});mstrmojo.ui._HasUITheme.EnumThemeNames={LIGHT_THEME:"mojo-theme-light",DARK_THEME:"mojo-theme-dark"};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.css");var A=1,K="mstrmojo-itemwrap",J="&nbsp;",I=mstrmojo.array;function B(W){if(!W.pageSize||W.pageSize<=0){var X=W.scrollboxNode;W.pageSize=X&&X.clientHeight||0;}return W.pageSize;}function U(W,X){if(W.usePaging){W.totalPages=1;var Z=W.itemsContainerNode,Y=B(W);if(W.usePaging&&Z&&Y){W.totalPages=Math.ceil((Z.clientHeight-parseInt(Z.style&&Z.style.paddingBottom||0,10))/Y);}if(Z){W.itemsContainerNode.style.paddingBottom=Y+"px";}}}mstrmojo.ListMapper=mstrmojo.provide("mstrmojo.ListMapper",{markupPrefix:"",markupSuffix:"",itemWrapperPrefix:function(W){return'<div class="'+this.getWrapperCss(W)+'">';},itemWrapperSuffix:"</div>",itemWrapperPrefill:"&nbsp",wrapperNodes:function C(W){return W.childNodes;},wrapperParentNode:function D(W){return W;},createWrapperNode:function G(W){var X=W.ownerDocument,Y=X.createElement("div");return Y;},findScrollRange:function N(l,a,k,o,X,d,q,n){if(!a){return{start:0,end:0};}var f=this.wrapperNodes(l),j=parseInt(a/2,10),Z=parseInt(Math.log(a)/Math.log(2),10),Y=0,W=a-1,g=k+o,e=f[0].offsetTop,c;for(var m=1;m<=Z;m++){c=f[j].offsetTop-e+n;if(c<k){Y=j;}else{if(c>g){W=j;}}var b=Math.round(a/Math.pow(2,m+1));j+=(c>k)?-b:b;j=Math.min(Math.max(0,j),a-1);}return{start:Y,end:W};},findWrapper:function L(Y,W){var X=this.wrapperNodes(Y);return X&&X[W];},findIndex:function F(W,Z,Y){var X=this._nd2iw(W,Z,Y);return X?this._iw2idx(W,Z,X):-1;},itemOffsetTop:function V(X,b,W,Z){if(!Z){var Y=this.wrapperNodes(b);Z=Y&&Y[W];if(!Z){return 0;}}var a=b.firstChild;if(!a||(a===Z)){return 0;}else{return Z.offsetTop-a.offsetTop;}},whereDrop:function S(d,W,Y,c,X){var Z=this._nd2iw(d,W,Y),e,b,f;if(Z){b=this._iw2idx(d,W,Z);e=b;f=this.itemOffsetTop(d,W,null,Z);var a=Z.offsetHeight;if(c.y>X.top+f+a/2){e++;f+=a;}}else{return d.dropCuePos;}return{left:0,top:f,idx:e,idxActual:b};},getWrapperCss:function(W){return K;},postBuildRendering:function(a,Z,Y,X,W){U(X,this);},buildItemWrappers:function P(f,c,l,e,b,m){var n=this.itemWrapperPrefix(l),h=this.itemWrapperSuffix,a=n+this.itemWrapperPrefill+h,Z=[this.markupPrefix],X=1,W=l.selectedIndices||{},p=function o(k,j){for(var q=k;q<j;q++){Z[X++]=n;var r=c.build(l,e,f[q],q);if(W[q]){r=r.replace(/class\=\"([^\"]*)\"/,'class="$1 selected"');}Z[X++]=r;Z[X++]=h;}};var d=(f&&f.length)||0;b=b&&c?Math.min(b,d):0;if(b){p(0,b);}m=m&&c?Math.min(m,d-b):0;var g=d-m;for(var Y=b;Y<g;Y++){Z[X++]=a;}if(m){p(g,d);}Z.push(this.markupSuffix);return Z;},fillItemWrappers:function H(Y,h,e,n,g,X,c,m){var f=(h&&h.length)||0,l=this.wrapperNodes(Y),o=g.itemStatus,W=mstrmojo.css,a=n.selectedIndices||{};for(var d=X,j=Math.min(c+1,f),b=0;d<j;d++){if(o[d]!==A){l[d].innerHTML=e.build(n,g,h[d],d);if(a[d]){var Z=l[d].firstChild;if(Z){W.addClass(Z,["selected"]);}}b++;if(b===m){break;}}}return b;},onadd:function O(f,W,a,g){if(W&&g){var b=g.value.length,d=this.wrapperNodes(W),e=d[g.index],Z=this.getWrapperCss(f);for(var Y=0;Y<b;Y++){var X=this.createWrapperNode(W);X.className=Z;X.innerHTML=J;if(e){this.wrapperParentNode(W).insertBefore(X,e);}else{this.wrapperParentNode(W).appendChild(X);}}U(f,this);}},onremove:function Q(Z,d,W,Y){if(d&&Y){var b=this.wrapperNodes(d);if(b){var e=Y.value.length;for(var a=Y.index+e-1,X=Y.index;a>=X;a--){this.wrapperParentNode(d).removeChild(b[a]);}}U(Z,this);}},onchange:function R(h,Y,d,l){if(Y&&l){var e=this.wrapperNodes(Y);if(e){var X=mstrmojo.css,m=d.itemStatus,k;for(var c=0,W=l.removed,g=W&&W.length;c<g;c++){k=W[c];if(m[k]){X.removeClass(e[k].firstChild,["selected"]);}}for(var b=0,f=l.added,Z=f&&f.length;b<Z;b++){k=f[b];if(m[k]){X.addClass(e[k].firstChild,["selected"]);}}}}},_nd2iw:function E(X,a,Z){a=this.wrapperParentNode(a);if(a&&Z&&a!==Z){var W=X.domNode,Y=Z.parentNode;while(Y){if(Y===a){return Z;}if(Y===W){break;}Z=Y;Y=Z.parentNode;}}return null;},_iw2idx:function M(Y,c,b){var X=Y.items&&Y.items.length,Z=this.wrapperNodes(c),W=I.findBin(Z,b,"offsetTop",X);for(var a=W;a<X;a++){if(Z[a].offsetHeight){return a;}}return -1;},toPage:function(W,Y){var X=W.scrollboxNode;if(W.usePaging&&X){X.scrollTop=Y*B(W);}else{mstrmojo.alert("paging is not setup, can not perform paging.");}},whichPage:function(W){var X=W.scrollboxNode,Y=B(W);return Math.round((X&&Y&&X.scrollTop/Y)||0);},toItem:function(a,b){var Y=a&&a.itemsContainerNode,f=a.scrollboxNode,W=this.itemOffsetTop(a,Y,b),d=this.wrapperNodes(Y)[b].clientHeight,X=f.clientHeight,e=f.scrollTop,Z=e;if(W<e){Z=W;}else{if(e+X-d<W){Z=Math.min(W,W-X+d);}}f.scrollTop=Z;}});})();(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.css","mstrmojo.hash");var A=mstrmojo.color,C=mstrmojo.css,H=mstrmojo.hash;function B(I){I=G(I);if(isNaN(I)){I=0;}I%=16777216;return{b:I%(1<<8),g:(I%(1<<16))>>8,r:(I%(1<<24))>>16};}function F(M,N,L){M=G(M);L=H.copy(L,{retainGradientObject:false});if(D(M)){var K=F(M.c1,N),I=F(M.c2,N);if(L.retainGradientObject){return{c1:K,c2:I,or:M.or};}return C.buildGradient(M.or,K,I).v;}if(typeof N==="number"){var J=B(M);if(isNaN(M)){N=0;}return"rgba("+J.r+" ,"+J.g+" ,"+J.b+" ,"+N+" )";}else{if(isNaN(M)){M=0;}return"#"+(16777216+M%16777216).toString(16).substring(1,7);}}function G(K){var J=K.c1,I=K.c2;if(D(K)){return{c1:G(J),c2:G(I),or:K.or};}if(typeof K==="number"){return K;}if(typeof K!=="string"){return NaN;}if(K[0]!=="#"){return parseInt(K,10);}if(K.length===4){K=K[0]+K[1]+K[1]+K[2]+K[2]+K[3]+K[3];}return parseInt(K.substring(1,7),16);}function E(K,I){var N=K.value,P=K.opacity;if(D(N)){return["c1","c2"].reduce(function(V,W,U){var X=E({value:N[W],opacity:P},I);V.value[W]=X.value;if(U===0){V.opacity=X.opacity;}return V;},{value:{or:N.or}});}if(N==="transparent"){K.value=I.value;}var M=A.hex2rgb(F(K.value)),L=A.hex2rgb(F(I.value)),S=K.opacity,R=I.opacity,Q=1-S,O,J;J=S+R*Q;O=M.map(function(U,V){return(U*S+L[V]*R*Q)/J;});return{value:"#"+A.rgb2hex.apply(undefined,O),opacity:J};}function D(I){return I&&["c1","c2","or"].every(function(J){return I.hasOwnProperty(J);});}mstrmojo.util.color=mstrmojo.provide("mstrmojo.util.color",{getCSSColorString:F,getColorValue:G,mix:E,isGradientColor:D,getRGB:B,createCanvasFillPattern:function(K,Q,J,P,I,O){var L=K.value,N=K.opacity,M;if(D(L)){M=Q.createLinearGradient(J,P,I,O);M.addColorStop(0,F(L.c1,N));M.addColorStop(1,F(L.c2,N));}else{M=F(L,N);}return M;}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.num","mstrmojo.color","mstrmojo.hash","mstrmojo.array");var AK=mstrmojo.color,a=mstrmojo.hash,BW=mstrmojo.array,BR=mstrmojo.css,m=mstrmojo.num;var BU=1,Aw=2,Ay=3,BD=4,Ae=5,Af=6;var Be="FormattingFont",L="FormattingAppearance",c="FormattingAlignment",Al="FormattingSize",V="FormattingPatterns",I="FormattingBorder",BC="FormattingOrder",H="FormattingView",S="FormattingSelector",A0="Template Formatting",P="FormattingPadding",Au="AnalyticalEngineProperties",A4="RWDocumentProperties",BM="FormattingPage",R="Mobile",Y="VLDB Select",AE="FormattingNumber",AZ="RWDExecution";var At=1;var p="n",Q="h",BX="w",AI="wm",BJ="pw",b="ml",BK="mr",AA="upwalw",w="ff",Ao="fsz",BP="fw",AJ="fit",BQ="fun",u="fst",z="fc",Z="alh",x="alv",Ai="atw",AQ="atd",h="textOverflow",As="bc",E="bgs",K="btc",Ar="brc",Ab="bbc",v="blc",r="bts",BZ="brs",BE="bbs",Ah="bls",AW="borderColor",BA="borderStyle",k="zIndex",AY="showTitleBar",q="title",A8="ctrlStyle",AC="ctrlOrientation",A7="ctrlOrientationBehavior",o="ctrlMultiselect",l="ctrlAutoSearchEnabled",C="ciwm",BL="cmcy",A9="sec",t="easow",AP="layoutXml",M="lockAspectRatio",Aq="ism",n="shw",BB="mg",BY="lhv",e="gridVPadding",An="gridHPadding",Am="ln",AO="sar",B="hnv",Ak="iw",Ag="ih",AS="tsp",Ac="visible",W="rf",Bd="jad",Av="jdc",AL="ode",BF="fs",BI="ssc",j="sstyle",AH="hgl",Ax="nct",A6="ncp",f="ncs",BN="ndp",G="nfs",D="nnn",BT="nth",Bc="gi",A2="stfurh",d="stfuch",Ba="stfuva",N="olm",BO="gdc",Bb="gda",AX="layoutstyle";function U(Bf){return Bf;}function AU(Bf){return parseInt(Bf,10);}var AG={name:"encode",_def:U};AG[Ay]=function(Bf){return Bf?1:0;};AG[Aw]=function(Bf){if(Bf==="transparent"){return -1;}if(Bf.length===4){Bf=Bf.replace(/([0-9a-f])/ig,"$1$1");}Bf=AK.rgbStr2hex(Bf);return parseInt(Bf.substring(5)+Bf.substring(3,5)+Bf.substring(1,3),16);};AG[BD]=AU;AG[BU]=function(Bf){if(typeof Bf==="number"){return m.toLocaleString(Bf);}return U(Bf);};AG[Af]=function(Bh){if(Bh==="none"){return 0;}var Bg=Bh.match(/([0-9]+[,\.]?[0-9]*pt)/)[0],Bf=Bh.match(/pt ([\w\W]*)/)[1];if(Bg==="2pt"){return 5;}switch(Bf){case"solid":return 1;case"dashed":return 3;case"dotted":return 4;default:throw new Error("Invalid border style value in FormatModel::encodeValue.");}};var BV={name:"decode",_def:U};BV[Ay]=function(Bf){return parseInt(Bf,10)===1;};BV[Aw]=function(Bf){if(Bf===-1){return"transparent";}if(typeof Bf==="number"){return AK.decodeColor(Bf);}if(Bf.length===4){return Bf.replace(/([0-9a-f])/ig,"$1$1");}return AK.rgbStr2hex(Bf);};BV[BD]=AU;BV[Af]=function(Bh){if(Bh===undefined||Bh===0){return"none";}var Bg="1pt",Bf="solid";if(Bh===5){Bg="2pt";}if(Bh===3){Bf="dashed";}else{if(Bh===4){Bf="dotted";}}return Bg+" "+Bf;};function BG(){return this.pn.toLowerCase();}function AR(Bf,Bh,Bi){var Bg=document.createElement("div");Bg.style[Bi||Bh]=Bf[Bh];return Bg;}function J(Bf){return function(){return AK.rgbStr2hex(Bf.apply(this,arguments));};}function Ap(){var Bf=BG.call(this);return Bf==="underline"?Bf:"line-through";}var A3={name:"extract"},X=A3._def=function(Bf,Bh,Bi){var Bg=AR(Bf,Bh||this.getFormatBlockName(),Bi);return Bg.style[this.getCssName()];};A3[Aw]=J(X);function AB(Bf){return X.call(this,Bf,this.getFormatBlockName())===BG.call(this);}function A(Bf){var Bg=X.call(this,Bf,this.getFormatBlockName(),this.getCssName());return Bg.indexOf(Ap.call(this))>-1;}function A1(Bf){var Bg=this.getFormatBlockName();return AK.rgbStr2hex(X.call(this,Bf,Bg,Bg+this.pn));}var BS={name:"resolve"},g=BS._def=function(Bf,Bi,Bh,Bj){Bh=Bh||this.getFormatBlockName();var Bg=AR(Bf,Bh);Bg.style[Bj||this.getCssName()]=Bi;return Bg.style[BR.convertCssToCamelCase(Bh)];};BS[Aw]=function(Bf,Bh,Bg,Bi){if(Bh.or!==undefined){return Bh;}return AK.rgbStr2hex(g.call(this,Bf,Bh,Bg,Bi));};function Aa(Bf,Bg){return g.call(this,Bf,Bg?BG.call(this):"normal");}function AV(Bg,Bi){var Bh=(Bg[this.getFormatBlockName()]||"").split(" "),Bf=Ap.call(this);if(Bi){if(Bh.indexOf(Bf)===-1){Bh.push(Bf);}}else{Bh=Bh.filter(function(Bj){return Bj!==Bf;});}return g.call(this,Bg,Bh.join(" "));}var Aj={name:"update"},BH=Aj._def=function(Bf,Bg){Bf[this.getFormatBlockName()]=this.resolve(Bf,Bg);return Bf;};var AT={};AT[p]={ps:L,pn:"Name",pt:BU};AT[Q]={ps:Al,pn:"Height",pt:BU};AT[BX]={ps:Al,pn:"Width",pt:BU};AT[AI]={ps:Al,pn:"WidthMode",pt:BD};AT[BJ]={ps:BM,pn:"PageWidth",pt:BU};AT[b]={ps:BM,pn:"MarginLeft",pt:BU,fn:"margin-left"};AT[BK]={ps:BM,pn:"MarginRight",pt:BU,fn:"margin-right"};AT[AA]={ps:BM,pn:"UsePageWidthAsLayoutWidth",pt:Ay};AT[w]={ps:Be,pn:"Name",pt:BU,fn:"font",cn:"fontFamily",extract:function(){return X.apply(this,arguments).replace(/['"]/g,"");},resolve:function(Bf,Bh){var Bg=AR(Bf,"font");Bg.style.fontFamily="'"+Bh+"'";return Bg.style.font;}};AT[Ao]={ps:Be,pn:"Size",pt:BD,fn:"font",cn:"fontSize"};AT[BP]={ps:Be,pn:"Bold",pt:Ay,fn:"font",cn:"fontWeight",extract:AB,resolve:Aa};AT[AJ]={ps:Be,pn:"Italic",pt:Ay,fn:"font",cn:"fontStyle",extract:AB,resolve:Aa};AT[BQ]={ps:Be,pn:"Underline",pt:Ay,fn:"text-decoration",extract:A,resolve:AV};AT[u]={ps:Be,pn:"Strikeout",pt:Ay,fn:"text-decoration",extract:A,resolve:AV};AT[z]={ps:Be,pn:"Color",pt:Aw};AT[Z]={ps:c,pn:"Horizontal",pt:BD,fn:"text-align"};AT[Ai]={ps:c,pn:"TextWrap",pt:Ay,fn:"white-space"};AT[AQ]={ps:c,pn:"TextDirection",pt:BD};AT[x]={ps:c,pn:"Vertical",pt:BD};AT[h]={ps:Al,pn:"TextOverflow",pt:Ay};AT[As]={ps:V,pn:"FillColor",pt:Aw,x:At,fn:"background-color",update:function(Bf,Bh){var Bg=Bf.fx;if(Bh.or!==undefined){if(!Bg){Bg=Bf.fx={};}var Bi=Bg.gd=Bg.gd||{};Bi.ec=Bh.c2;Bi.sc=Bh.c1;Bi.t=Bh.or;delete Bf[this.getFormatBlockName()];Bf.fx=Bg;}else{if(Bg){delete Bg.gd;}BH.call(this,Bf,Bh);}return Bf;}};AT[E]={ps:V,pn:"FillStyle",pt:BD};AT[BI]={ps:V,pn:"SelectorSelectionColor",pt:Aw};AT[j]={ps:V,pn:"SelectorSelectionFillStyle",pt:BD};AT[K]={ps:I,pn:"TopColor",pt:Aw,fn:"border",extract:A1};AT[Ar]={ps:I,pn:"RightColor",pt:Aw,fn:"border",extract:A1};AT[Ab]={ps:I,pn:"BottomColor",pt:Aw,fn:"border",extract:A1};AT[v]={ps:I,pn:"LeftColor",pt:Aw,fn:"border",extract:A1};AT[AW]={ps:I,pn:["TopColor","RightColor","BottomColor","LeftColor"],pt:Aw,fn:"border",extract:A1,resolve:J(function(Bf,Bh){var Bi=this.getFormatBlockName(),Bg=g.call(this,Bf,Bh,Bi,Bi+"Color"),Bj=Bg.indexOf("rgb");if(Bj>-1){Bg=Bg.slice(0,Bj)+AK.rgbStr2hex(Bg.slice(Bj));}return Bg;})};AT[BA]={ps:I,pn:["TopStyle","RightStyle","BottomStyle","LeftStyle"],pt:Af,fn:"border",extract:A1,resolve:function(Bf,Bi){var Bg=Bi.split(" "),Bj=this.getFormatBlockName();if(!Bf[Bj]){Bf[Bj]="transparent";}Bf[Bj]=g.call(this,Bf,Bg[0],Bj,Bj+"Width");var Bh=g.call(this,Bf,Bg[1]||"none",Bj,Bj+"Style"),Bk=Bh.indexOf("rgb");if(Bk>-1){Bh=Bh.slice(0,Bk)+AK.rgbStr2hex(Bh.slice(Bk));}return Bh;}};AT[r]={ps:I,pn:"TopStyle",pt:Af,fn:"border",extract:A1};AT[BZ]={ps:I,pn:"RightStyle",pt:Af,fn:"border"};AT[BE]={ps:I,pn:"BottomStyle",pt:Af,fn:"border",extract:A1};AT[Ah]={ps:I,pn:"LeftStyle",pt:Af,fn:"border",extract:A1};AT[k]={ps:BC,pn:"ZIndex",pt:BD,fn:"z-index"};AT[AY]={ps:H,pn:"ShowTitleBar",pt:Ay};AT[q]={ps:H,pn:"Title",pt:BU};AT[A8]={ps:S,pn:"Style",pt:BD};AT[AC]={ps:S,pn:"Orientation",pt:BD};AT[A7]={ps:S,pn:"OrientationBehavior",pt:BD};AT[o]={ps:S,pn:"Multiselect",pt:Ay};AT[l]={ps:S,pn:"AutoSearchEnabled",pt:Ay};AT[C]={ps:S,pn:"ItemWidthMode",pt:BD};AT[BL]={ps:S,pn:"MetricConditionType",pt:BD};AT[A9]={ps:S,pn:"ShowElementCount",pt:BD};AT[t]={ps:S,pn:"ExportAsShownOnWeb",pt:BD};AT[AP]={ps:Al,pn:"LayoutXML",pt:Ae};AT[M]={ps:Al,pn:"LockAspectRatio",pt:Ay};AT[Aq]={ps:Al,pn:"ImageSizeMode",pt:BD};AT[Ag]={ps:Al,pn:"ImageHeight",pt:BU};AT[Ak]={ps:Al,pn:"ImageWidth",pt:BU};AT[AS]={ps:A4,pn:"layoutBarPosition",pt:BU};AT[BF]={ps:A4,pn:"ExecutionFullScreenMode",pt:Ay};AT[AX]={ps:A4,pn:"LayoutStyle",pt:BD};AT[Ac]={ps:L,pn:"Visible",pt:Ay};AT[Am]={ps:A0,pn:"LongNames",pt:BU};AT[N]={ps:A0,pn:"Indented",pt:BD};AT[AO]={ps:Au,pn:"ShowAllRows",pt:BU};AT[B]={ps:Au,pn:"HideNullZeroValues",pt:BU};AT[An]={ps:P,pn:["LeftPadding","RightPadding"],pt:BU};AT[e]={ps:P,pn:["TopPadding","BottomPadding"],pt:BU};AT.rowsshw={ps:A0,pn:"ShowRowHeaders",pt:BU};AT.rowsmg={ps:A0,pn:"MergeCells",pt:BU};AT.rowslhv={ps:A0,pn:"LockRowHeaders",pt:BU};AT.colsshw={ps:A0,pn:"ShowColumnHeaders",pt:BU};AT.colsmg={ps:A0,pn:"MergeColumnCells",pt:BU};AT.colslhv={ps:A0,pn:"LockColumnHeaders",pt:BU};AT[A2]={ps:A0,pn:"SubtotalFormatUseRowHeaders",pt:BU};AT[d]={ps:A0,pn:"SubtotalFormatUseColumnHeaders",pt:BU};AT[Ba]={ps:A0,pn:"SubtotalFormatUseValues",pt:BU};AT[W]={ps:R,pn:"RefreshFrequency",pt:BD};AT[Bd]={ps:Y,pn:"Join Across Datasets",pt:BD};AT[Av]={ps:Y,pn:"MCE Join To Get Data Combination",pt:BD};AT[AL]={ps:AZ,pn:"OnDemandEvaluation",pt:BD};AT[AH]={ps:L,pn:"Highlight",pt:BD};AT[Ax]={ps:AE,pn:"Category",pt:BD};AT[G]={ps:AE,pn:"Format",pt:BU};AT[f]={ps:AE,pn:"CurrencySymbol",pt:BU};AT[BN]={ps:AE,pn:"DecimalPlaces",pt:BD};AT[A6]={ps:AE,pn:"CurrencyPosition",pt:BD};AT[D]={ps:AE,pn:"NegativeNumbers",pt:BD};AT[BT]={ps:AE,pn:"ThousandSeparator",pt:BD};AT[Bc]={ps:L,pn:"GroupInfo",pt:BU};AT[BO]={ps:V,pn:"GradientColor",pt:Aw};AT[Bb]={ps:V,pn:"GradientAngle",pt:BD};BW.forEach(a.keyarray(AT),function(Bf){var Bg=AT[Bf];Bg.getFormatBlockName=function(){var Bi=this.fn;if(!Bi){var Bh=this.pn;Bi=Bh.charAt(0).toLowerCase()+Bh.substr(1);}return Bi;};Bg.getCssName=function(){var Bh=this.getFormatBlockName.call(this),Bi=this.cn;if(!Bi){Bi=BR.convertCssToCamelCase(Bh);}return Bi;};BW.forEach([AG,BV,A3,BS,Aj],function(Bh){var Bi=Bh.name;Bg[Bi]=Bg[Bi]||Bh[Bg.pt]||Bh._def;});});function A5(Bi,Bh,Bf){var Bg=Bf[Bi.ps]=Bf[Bi.ps]||{};Bh=Bi.encode(Bh);BW.forEach([].concat(Bi.pn),function(Bj){Bg[Bj]=Bh;});return Bf;}function AN(Bl,Bk,Bf){var Bj=Bl.x;if(Bj){if((Bj&At)>0){var Bi=!!Bk.c1,Bh=0;if(Bi){A5(Bl,Bk.c1,Bf);var Bg=Bf[V];Bg.GradientColor=Bl.encode(Bk.c2);Bg.GradientAngle=Bk.or?0:90;Bg.GradientXOffset=0;Bg.GradientYOffset=0;Bh=2;}else{if(Bl.encode(Bk)===-1){Bh=1;}else{A5(Bl,Bk,Bf);}}return A5(AT[E],Bh,Bf);}}return null;}mstrmojo.models.FormatModel={getFormatUpdate:function Ad(Bg,Bj,Bf){var Bi=AT[Bg];if(!Bi){throw new Error("Invalid property "+Bg+" in FormatModel::getFormatUpdate.");}Bf=Bf||{};var Bh=AN.call(this,Bi,Bj,Bf);if(Bh){return Bh;}return A5(Bi,Bj,Bf);},getFormatPropertyInfo:function s(Bf){return AT[Bf];},getValueFromUpdate:function O(Bg,Bh){var Bj=AT[Bg],Bf=null;try{Bf=Bh[Bj.ps][Bj.pn];}catch(Bi){}return Bf;},getGradientValues:function AM(Bg){var Bf=Bg.fx&&Bg.fx.gd;if(Bf){var Bi={c1:Bf.sc,c2:Bf.ec,or:Bf.t};return Bi;}if(Bg[E]===2){if(!!Bg.bc.c1){return Bg.bc;}var Bh={c1:Bg.bc,c2:Bg.gdc,or:Bg.gda===90?0:1};return Bh;}return null;},decodeGradientValue:function F(Bf){if(Bf&&Bf.c1){Bf.c1=this.decodeValue(BO,Bf.c1);Bf.c2=this.decodeValue(BO,Bf.c2);return Bf;}return null;},decodeValue:function AF(Bf,Bg){return AT[Bf].decode(Bg);},updateFormatBlock:function Az(Bf,Bg,Bh){return AT[Bg].update(Bf,Bh);},getFormatBlockValue:function AD(Bf,Bg){return AT[Bg].extract(Bf);},GradientType:null,FormatObjectType:null,PROPERTY_INFO_TYPE:null,ENUM_PROPERTY_NAMES:{NAME:p,HEIGHT:Q,WIDTH:BX,WIDTH_MODE:AI,PAGE_WIDTH:BJ,MARGIN_LEFT:b,MARGIN_RIGHT:BK,USE_PAGE_WIDTH_AS_LAYOUT_WIDTH:AA,FONT_FAMILY:w,FONT_SIZE:Ao,FONT_WEIGHT:BP,FONT_STYLE:AJ,UNDERLINE:BQ,LINE_THROUGH:u,COLOR:z,TEXT_ALIGN:Z,VERTICAL_ALIGN:x,TEXT_WRAP:Ai,TEXT_DIRECTION:AQ,TEXT_OVERFLOW:h,BACKGROUND_COLOR:As,FILL_STYLE:E,GRADIENT_COLOR:BO,GRADIENT_ANGLE:Bb,BORDER_TOP_COLOR:K,BORDER_RIGHT_COLOR:Ar,BORDER_BOTTOM_COLOR:Ab,BORDER_LEFT_COLOR:v,BORDER_TOP_STYLE:r,BORDER_RIGHT_STYLE:BZ,BORDER_BOTTOM_STYLE:BE,BORDER_LEFT_STYLE:Ah,BORDER_COLOR:AW,BORDER_STYLE:BA,Z_INDEX:k,SHOW_TITLE_BAR:AY,TITLE:q,CONTROL_STYLE:A8,CONTROL_ORIENTATION:AC,CONTROL_ORIENTATION_BEHAVIOR:A7,CONTROL_MULTISELECT:o,CONTROL_AUTOSEARCH:l,CONTROL_ITEM_WIDTH_MODE:C,CONTROL_METRIC_CONDITION_TYPE:BL,CONTROL_SHOW_ELEMENT_COUNT:A9,CONTROL_EXPORT_AS_SHOWN_ON_WEB:t,LAYOUT_XML:AP,LOCK_ASPECT_RATIO:M,IMAGE_SIZE_MODE:Aq,SHOW_HEADER:n,MERGE_HEADER:BB,LOCK_HEADER:BY,LONG_NAME:Am,SHOW_ALL_ROWS:AO,HIDE_NULL:B,IMAGE_WIDTH:Ak,IMAGE_HEIGHT:Ag,VISIBLE:Ac,LAYOUT_TAB_POSITION:AS,GRID_VERTICAL_PADDING:e,GRID_HORIZONTAL_PADDING:An,REFRESH:W,JOIN_ACROSS_DATASET:Bd,MCE_JOIN_TO_GET_DATA_COMBINATION:Av,ON_DEMAND_EVALUATION:AL,FULL_SCREEN_MODE:BF,SELECTOR_SELECTION_COLOR:BI,SELECTOR_SELECTION_FILL_STYLE:j,VIZ_HIGHLIGHTING:AH,GROUP_INFO:Bc,SUBTOTAL_FORMAT_USE_ROWHEADERS:A2,SUBTOTAL_FORMAT_USE_COLUMNHEADERS:d,SUBTOTAL_FORMAT_USE_VALUES:Ba,OUTLINE:N,LAYOUT_STYLE:AX},ENUM_PROPERTY_SETS:{FORMATTING_NUMBER:AE},ENUM_NUMBER_FORMAT_KEYS_OBJ:{CATEGORY:Ax,CURRENCY_POSITION:A6,CURRENCY_SYMBOL:f,DECIMAL_PLACES:BN,FORMAT:G,NEGATIVE_NUMBERS:D,THOUSAND_SEPARATOR:BT}};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var F=mstrmojo.dom,I=mstrmojo.css,C="active";var A=false;mstrmojo.util.ui.SplitterParamsType=null;function H(N,Q){var P=Q.info,O=P&&P.min,M=P&&P.max,L=Q.start+(F.getMousePosition(N,window)[Q.mouseProp]-Q.mousePosition)*(P&&!!P.isReverseMove?-1:1);if(O!==undefined){L=Math.max(L,O);}if(M!==undefined){L=Math.min(L,M);}return L;}function G(M,L,N){return function(O){M.call(mstrmojo.all[L],O,N);};}function B(L,M){M.target.style[M.styleProp]=H(L,M)+"px";}function K(L,N){if(!A){return ;}var M=window.document;F.detachEvent(M,"mousemove",N.fnMove);F.detachEvent(M,"mouseup",N.fnUp);delete N.fnMove;delete N.fnUp;A=false;mstrApp.setInteractive(true);this.splitterMoved(H(L,N)-N.start,N.info);I.removeClass(N.target,C);(this.children||[]).forEach(function(O){O.domNode.style.pointerEvents="inherit";});this.splitterMouseUp();}function J(W){if(A){return ;}mstrApp.setInteractive(false);var L=this.id,M,N,Q=F.eventTarget(window,W),S=(Q.className.indexOf("v")===-1),R=S?"y":"x",P={};P.target=Q;P.info=this.getSplitterInfo(Q);N=P.info&&!!P.info.isReverseMove;M=S?"Top":N?"Right":"Left";P.start=N?parseInt(Q.style.right):Q["offset"+M];P.mouseProp=R;P.mousePosition=F.getMousePosition(W,window)[R];P.styleProp=M.toLowerCase();I.addClass(Q,C);(this.children||[]).forEach(function(X){X.domNode.style.pointerEvents="none";});this.splitterMouseDown();var O=G(B,L,P),V=G(K,L,P);var U=window.document;F.attachEvent(U,"mousemove",O);F.attachEvent(U,"mouseup",V);P.fnMove=O;P.fnUp=V;A=true;}mstrmojo.util.ui._HostsSplitter=mstrmojo.provide("mstrmojo.util.ui._HostsSplitter",{_mixinName:"mstrmojo.util.ui._HostsSplitter",registerSplitter:function E(L){this.splitterEvtMouseDownHandler=G(J,this.id);F.attachEvent(L,"mousedown",this.splitterEvtMouseDownHandler);},unRegisterSplitter:function D(L){if(this.splitterEvtMouseDownHandler){F.detachEvent(L,"mousedown",this.splitterEvtMouseDownHandler);}},getSplitterInfo:mstrmojo.emptyFn,splitterMoved:mstrmojo.emptyFn,splitterMouseDown:mstrmojo.emptyFn,splitterMouseUp:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.XMLBuilder","mstrmojo.gm.GMEnums");var L=mstrmojo,F=L.hash,I=L.array,P=L.vi.viz,B=P.EnumDSSDropZones,A=1,H=0,D=P.DropZoneHelper.METRIC_NAMES_ID,O,E=mstrmojo.gm.DualAxisSubAxisBit,G=E.PRIMARY;mstrmojo.vi.viz.GraphMatrixHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.GraphMatrixHelper",handled:false,rowObjects:null,columnObjects:null,xAxisObjects:null,yAxisObjects:null,angleObjects:null,sliceObjects:null,breakByObjects:null,colorByObjects:null,currentXML:"",sizeByObjects:null,tooltipMetrics:null,data:null,metricsDropZone:"",secondaryMetricsDropZone:"",shape:"",subtype:"",metricShapes:null,visType:-1,init:function N(Q){this._super(Q);this.rowObjects=[];this.columnObjects=[];this.xAxisObjects=[];this.yAxisObjects=[];this.angleObjects=[];this.sliceObjects=[];this.breakByObjects=[];this.colorByObjects=[];this.sizeByObjects=[];this.tooltipMetrics=[];this.currentXML="";this.metricsDropZone="";this.secondaryMetricsDropZone="";this.shape="";this.subtype="";this.metricShapes="{}";},clone:function J(R){var Q=this;Q.rowObjects=R.rowObjects.concat();Q.columnObjects=R.columnObjects.concat();Q.xAxisObjects=R.xAxisObjects.concat();Q.yAxisObjects=R.yAxisObjects.concat();Q.angleObjects=R.angleObjects.concat();Q.sliceObjects=R.sliceObjects.concat();Q.breakByObjects=R.breakByObjects.concat();Q.colorByObjects=R.colorByObjects.concat();Q.sizeByObjects=R.sizeByObjects.concat();Q.tooltipMetrics=R.tooltipMetrics.concat();Q.currentXML=R.currentXML;Q.metricsDropZone=R.metricsDropZone;Q.secondaryMetricsDropZone=R.secondaryMetricsDropZone;Q.shape=R.shape;Q.subtype=R.subtype;Q.metricShapes=R.metricShapes;},exists:function(S,Q){var U=this[Q],R=false;I.forEach(U,function(V){R=(V.did===S.did);if(R){return false;}});return R;},removeAngleMetricFromOthers:function(Q){["xAxisObjects","yAxisObjects","tooltipMetrics"].every(function(U){var S=this[U],R=I.find(S,"did",Q.did);if(R>-1){S.splice(R,1);return false;}});},getXml:function C(){var Q=this.data.dz,R=Q?F.copy(Q.visProp&&Q.visProp.fmt,{}):{},S=new mstrmojo.XMLBuilder();if(this.data.visName===mstrmojo.vi.viz.EnumVizStyles.MAPBOX){delete R.cr;}if(this.visStyle){R.visStyle=this.visStyle;}if(this.shape){R.Shape=this.shape;}if(this.subtype){R.Subtype=this.subtype;}if(this.metricShapes){R.metricShapes=this.metricShapes;}R.visType=this.visType;S.addChild("props");S.addChild("widgetProps");S.addChild("fmt");F.forEach(R,function(U,V){S.addChild(V);S.addAttribute("value",U);S.closeElement();});S.closeElement();S.closeElement();S.closeElement();return S.toString();},setData:function K(U){if(!U){return ;}var R=this,S=function(W,X){if(W){var V=(W.TemplateUnit||[]).concat(W.TemplateMetric||[]);if(V){V.forEach(function(Y){var Z=F.copy(Y);if(!Z.did){Z.did=Z.id;}X.push(Z);});}}};S(U[O.PROP_ROWS],this.rowObjects);S(U[O.PROP_COLUMNS],this.columnObjects);S(U[O.PROP_XAXIS],this.xAxisObjects);S(U[O.PROP_YAXIS],this.yAxisObjects);S(U[O.PROP_BREAKBY],this.breakByObjects);S(U[O.PROP_COLORBY],this.colorByObjects);S(U[O.PROP_SIZEBY],this.sizeByObjects);S(U[O.PROP_SLICE],this.sliceObjects);S(U[O.PROP_ANGLE],this.angleObjects);S(U[O.PROP_TOOLTIPMETRICS],this.tooltipMetrics);var Q=U.visProp.fmt;this.shape=Q[O.PROP_SHAPE];this.subtype=Q[O.PROP_SUBTYPE];},setMetricsDropZone:function M(Q){if(!Q){return ;}var R=this;[O.PROP_ROWS,O.PROP_COLUMNS,O.PROP_XAXIS,O.PROP_YAXIS,O.PROP_BREAKBY,O.PROP_SLICE,O.PROP_COLORBY].forEach(function(S){if(Q[S]&&Q[S].hasOwnProperty("MetricNames")){if(R.metricsDropZone){R.secondaryMetricsDropZone=S;}else{R.metricsDropZone=S;}}});},getAddDropZonesAction:function(){var V=this,R=this.metricsDropZone,Q=this.secondaryMetricsDropZone,S={act:"updateTemplate",keyContext:this.data.k,actions:[]},U=function(W){S.actions.push({act:"addDropZoneUnit",zoneId:B[W],unitId:D,unitType:H});};[{p:"rowObjects",v:"Rows"},{p:"columnObjects",v:"Columns"},{p:"xAxisObjects",v:"XAxis"},{p:"yAxisObjects",v:"YAxis"},{p:"breakByObjects",v:"BreakBy"},{p:"colorByObjects",v:"ColorBy"},{p:"sizeByObjects",v:"SizeBy"},{p:"angleObjects",v:"Angle"},{p:"sliceObjects",v:"SliceBy"},{p:"tooltipMetrics",v:"AdditionalMetrics"}].forEach(function(Y){var W=V[Y.p],Z=B[Y.v];W.forEach(function(a){if(a){S.actions.push({act:"addDropZoneUnit",zoneId:Z,unitId:a.did,unitType:a.t,ax:a.ax||G});}});if(R===Y.v){var X=function(a){return(a&&(a.length>A)&&V.isMetricZone(a));};if(X(V.xAxisObjects)||X(V.yAxisObjects)||X(V.angleObjects)){U(R);}}});if(Q==="ColorBy"){U(Q);}return S;}});O=mstrmojo.vi.viz.GraphMatrixHelper;O.PROP_ROWS="Rows";O.PROP_COLUMNS="Columns";O.PROP_HORIZONTAL_AXIS="HorizontalAxis";O.PROP_VERTICAL_AXIS="VerticalAxis";O.PROP_XAXIS="XAxis";O.PROP_YAXIS="YAxis";O.PROP_SLICE="SliceBy";O.PROP_ANGLE="AngleBy";O.PROP_BREAKBY="BreakBy";O.PROP_COLORBY="ColorBy";O.PROP_SIZEBY="SizeBy";O.PROP_TOOLTIPMETRICS="AdditionalMetrics";O.PROP_SHAPE="Shape";O.PROP_SUBTYPE="Subtype";O.PROP_METRICSHAPES="metricShapes";O.PROP_SHAPE_AREA="Area";O.PROP_SHAPE_LINE="Line";O.PROP_SHAPE_BAR="Bar";O.PROP_SHAPE_CIRCLE="Circle";O.PROP_SHAPE_SQUARE="Square";O.PROP_SHAPE_PIE="Pie";O.PROP_SHAPE_RING="Ring";O.PROP_SHAPE_TICK="Tick";O.PROP_SUBTYPE_CLUSTERED="Clustered";O.PROP_SUBTYPE_AUTOMATIC="Automatic";O.PROP_SUBTYPE_STACKED="Stacked";O.PROP_SUBTYPE_ABSOLUTE="Absolute";O.PROP_SUBTYPE_PERCENT="Percent";}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.gmaps.MapEnums","mstrmojo.gm.GMEnums","mstrmojo.VisEnum");var d=mstrmojo,e=d.array,f=d.vi.viz.EnumDSSDropZones,Q=d.hash,N=d.gmaps,l=mstrmojo.VisEnum,r=l.LegendPropertyTag,j=l.MAPS_PROPERTIES,I=N.EnumPropertyType,X=N.EnumZoomBehavior,h=N.EnumGraphicType,W=N.EnumClusterMode,k=N.EnumGeographicRole,E=N.EnumBaseMapType,V=N.EnumLanguageType,K=l.EnumLegendMode,D=mstrmojo.gm.EnumLegendSlot,o=l.EnumSingleLegendMode,Y=new RegExp(".{32}","g"),q;mstrmojo.vi.viz.MapHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.MapHelper",widget:null,data:null,vp:null,geoAttribute:null,latitude:null,longitude:null,slice:[],angle:null,colorBy:null,sizeBy:null,tooltip:null,markerType:null,useAttributeForm:null,supportAreaMap:true,defaultView:null,init:function p(v){this._super(v);this.tooltip=[];this.data=this.data||{};this.vp=this.data.vp||{};},setWidget:function O(v){if(!v){return ;}var AA=v.fnGetWidget(),z=v.k,x=v.node&&v.node.data&&v.node.data.vp;this.widget=v;this.geoAttribute=L(v,f.GeoAttribute);this.latitude=L(v,f.Latitude);this.longitude=L(v,f.Longitude);this.angle=L(v,f.Angle);this.colorBy=L(v,f.ColorBy);this.sizeBy=L(v,f.SizeBy);this.tooltip=AA.getDropZoneItems(f.AdditionalMetrics,z).map(function(w){return w.id;});this.slice=AA.getDropZoneItems(f.SliceBy,z).map(function(w){return w.id;});if(x){this.markerType=x.mtp;this.useAttributeForm=x[I.useAttributeForm];this.defaultView=x.dv;}},getGeoUnit:function G(){return m(this.widget,f.GeoAttribute);},getLatitudeUnit:function H(){return m(this.widget,f.Latitude);},getLongitudeUnit:function c(){return m(this.widget,f.Longitude);},getAngleUnit:function A(){return m(this.widget,f.Angle);},getColorByUnit:function P(){return m(this.widget,f.ColorBy);},getSizeByUnit:function g(){return m(this.widget,f.SizeBy);},getSliceByUnits:function C(){var v=this.widget.fnGetWidget();return v.getDropZoneItems(f.SliceBy,this.widget.k);},getTooltipUnits:function a(){var v=this.widget.fnGetWidget();return v.getDropZoneItems(f.AdditionalMetrics,this.widget.k);},setMapType:function(v){this.vp.gtp=v;},getMapType:function(){return this.vp.gtp;},getLayerName:function(){return this.vp.ln;},setShapeFile:function(v){this.vp.lid=v;},setUseAttributeForm:function Z(v){this.useAttributeForm=v?q.USE_ATTRIBUTE_FORM:q.USE_ATTRIBUTE;},getGeoForm:function s(z,w){var v=z&&z.fs,x=null;if(!w){w=function(){return true;};}if((z.otp===12||z.t===12)&&v){e.forEach(v,function(AA){if(w(AA)){x=AA;return false;}});}return x;},getLatitudeForm:function t(v){return this.getGeoForm(v,function(w){return q.isLatitude(w.fnm,w.fgr)&&w.obf;});},getLongitudeForm:function S(v){return this.getGeoForm(v,function(w){return q.isLongitude(w.fnm,w.fgr)&&w.obf;});},getXml:function M(){var v=this.vp,x=this.tooltip,w=this.useAttributeForm;v[r.LEGEND_MODE]=v[r.LEGEND_MODE]||K.RESTORED.toString();v[r.LEGEND_POSITION]=v[r.LEGEND_POSITION]||D.RIGHT_MIDDLE.toString();v[j.SHOW_LEGEND]=v[j.SHOW_LEGEND]||"false";v[I.collapseLegend]=v[I.collapseLegend]||o.RESTORE.toString();v[I.legendSwitch]=v[I.legendSwitch]||"false";v[I.baseMapType]=v[I.baseMapType]||E.Reserved;v[I.layerIdx]=v[I.layerIdx]||0;v[I.layerName]=v[I.layerName]||mstrmojo.desc(14750,"Layer")+" 1";v[I.isHidden]=v[I.isHidden]||"0";v[I.zoomSetting]=v[I.zoomSetting]||X.Automatic;v[I.clusterRadius]=50;v[I.clusterMaxZoom]=22;v[I.languageType]=V.English;v[I.tooltipSwitch]=v[I.tooltipSwitch]||"true";v.ga=this.geoAttribute||"";v.lat=this.latitude||"";v.lng=this.longitude||"";v.cmt=this.colorBy||"";v.smt=this.sizeBy||"";if(w){v[I.useAttributeForm]=w;}v.tooltip="";if(x){x.forEach(function(z){v.tooltip+=z;});}return q.getXmlFromJson(this.vp);},showColorByZone:function(v){return q.canShowColorByZone(v);},showSizeByZone:function(v){return !!v&&v[I.graphicType]===h.Bubble;},showSliceZone:function(v){return !!v&&v[I.graphicType]===h.Bubble;},showAngleZone:function(v){return !!v&&v[I.graphicType]===h.Bubble||((v[I.graphicType]===h.Marker)&&v[I.clusterMode]===W.PIE);}});q=mstrmojo.vi.viz.MapHelper;q.zonesCfg=[{n:mstrmojo.desc(11661,"Geo Attribute"),id:f.GeoAttribute,prm:true,allowSingle:true,show:function(){return true;},v:function(v){return B(v,I.geoAttribute);},onDel:function(v){if(!!v){v[I.geoAttribute]="";v[I.shapeFile]="";}},onAdd:function(v,w){if(!!v){v[I.geoAttribute]=w.item.did;v[I.useAttributeForm]=q.USE_ATTRIBUTE_FORM;v[I.shapeFile]="";}}},{n:mstrmojo.desc(7696,"Latitude"),id:f.Latitude,prm:true,allowSingle:true,show:function(v){if(!!v){return(v[I.graphicType]!==h.Area);}},v:function(v){return B(v,I.latitude);},onDel:function(v){if(!!v){v[I.latitude]="";}},onAdd:function(v,w){var x=w.item;if(!!v){v[I.latitude]=x.did;v[I.useAttributeForm]=x.t===21?q.USE_ATTRIBUTE_FORM:q.USE_ATTRIBUTE;}}},{n:mstrmojo.desc(7697,"Longitude"),id:f.Longitude,prm:true,allowSingle:true,show:function(v){if(!!v){return(v[I.graphicType]!==h.Area);}},v:function(v){return B(v,I.longitute);},onDel:function(v){if(!!v){v[I.longitute]="";}},onAdd:function(v,w){var x=w.item;if(!!v&&!!x){v[I.longitute]=x.did;v[I.useAttributeForm]=x.t===21?q.USE_ATTRIBUTE_FORM:q.USE_ATTRIBUTE;}}},{n:mstrmojo.desc(6188,"Slice"),id:f.SliceBy,prm:true,allowSingle:false,show:function(v){if(!!v){return q.showSliceZone(v);}},v:function(v){if(!!v){var w=v[I.slice];return w&&w.match(Y);}},onDel:function(v,w){var x=w&&w.item;if(!!v&&x&&x.id&&v[I.slice]){v[I.slice]=v[I.slice].replace(x.did,"");}},onAdd:function(v,w){var AA=I.slice,z=w&&w.item;if(!!v&&z){var x=v[AA]?v[AA].match(Y):[];x.splice(w.idx,0,z.did);v[AA]=x.join("");}}},{n:mstrmojo.desc(14294,"Angle"),id:f.Angle,prm:true,allowSingle:true,show:function(v){if(!!v){return q.showAngleZone(v);}},v:function(v){return B(v,I.angle);},onDel:function(v){if(!!v){v[I.angle]="";}},onAdd:function(v,w){F(v,w,I.angle);}},{n:mstrmojo.desc(11662,"Color By"),id:f.ColorBy,prm:true,allowSingle:true,show:function(v){return q.canShowColorByZone(v);},v:function(v){return B(v,I.colorby);},onDel:function(v){if(!!v){v[I.colorby]="";}},onAdd:function(v,w){F(v,w,I.colorby);}},{n:mstrmojo.desc(11663,"Size By"),id:f.SizeBy,prm:true,allowSingle:true,show:function(v){if(!!v){return q.canShowSizeByZone(v);}},v:function(v){return B(v,I.sizeby);},onDel:function(v){if(!!v){v[I.sizeby]="";}},onAdd:function(v,w){F(v,w,I.sizeby);}},{n:mstrmojo.desc(2962,"Tooltip"),id:f.AdditionalMetrics,prm:false,allowSingle:false,show:function(){return true;},v:function(v){if(!!v){var w=v[I.tooltip];return w&&w.match(Y);}},onDel:function(v,w){if(v&&v[I.tooltip]){v[I.tooltip]=v[I.tooltip].replace(w.item.did,"");}},onAdd:function(v,w){var z=I.tooltip;if(!!v){var x=v[z]?v[z].match(Y):[];x.splice(w.idx,0,w.item.did);v[z]=x.join("");}}}];q.USE_ATTRIBUTE="0";q.USE_ATTRIBUTE_FORM="1";q.canShowColorByZone=function(v){return !!v&&(v[I.graphicType]!==undefined)&&v[I.graphicType]!==h.Density;};q.canShowSizeByZone=function(v){return !!v&&v[I.graphicType]===h.Bubble;};q.showAngleZone=function(v){if(!v){return false;}return v[I.graphicType]===h.Bubble||((v[I.graphicType]===h.Marker)&&v[I.clusterMode]===W.PIE);};q.showSliceZone=function(v){return !!v&&v[I.graphicType]===h.Bubble;};q.supportImageThreshold=function(v){return !!v&&v[I.graphicType]===h.Marker;};q.isLatitude=function U(w,v){return v===5||(w&&w.toLowerCase().indexOf("latitude")>-1);};q.isLongitude=function n(w,v){return v===6||(w&&w.toLowerCase().indexOf("longitude")>-1);};q.isAxisAttribute=function u(w){var v=w&&w.fs,x;if(v&&v.length===1){x=v[0];return !!x&&(x.fgr===5||x.fgr===6);}return false;};q.getXmlFromJson=function R(v){var w=new mstrmojo.XMLBuilder();w.addChild("widgetProps");w.addChild("fmt");Q.forEach(v,function(x,z){w.addChild(z);w.addAttribute("value",x);w.closeElement();});w.closeElement();w.closeElement();return w.toString();};q.isGeoRoleSupportArea=function J(v){v=v&&v.toString();return v===k.EnumGeographicRoleCity||v===k.EnumGeographicRoleState||v===k.EnumGeographicRoleCountry||v===k.EnumGeographicRoleOther||v===k.EnumGeographicRoleZipCode||v===k.EnumGeographicRoleCounty;};q.zonesNeedSyncToTooltipZone=[f.GeoAttribute,f.SliceBy,f.Angle,f.SizeBy,f.ColorBy];q.shouldSyncItemToTooltipZone=function b(x,v,w){w=e.ensureArray(w);return q.zonesNeedSyncToTooltipZone.indexOf(v)>-1&&w.indexOf(x)<0;};function m(x,v){var AB=x.fnGetWidget(),AA=x.k,z=AB.getDropZoneItems(v,AA);return z[0];}function L(x,v,z){var AA=m(x,v,z);return AA?AA.id:"";}function B(w,v){if(!!w){return w[v]?[w[v]]:[];}}function F(w,x,v){var z=x.item;if(!!w||!!z){w[v]=z.did;}return w;}}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.XMLBuilder");var D=mstrmojo.hash,C=mstrmojo.vi.viz.EnumDSSDropZones;mstrmojo.vi.viz.KPICardVisualizationHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.KPICardVisualizationHelper",metric:null,breakByAttribute:null,trendAttribute:null,getAddDropZonesAction:function(){var E=this,F={act:"updateTemplate",keyContext:this.node.k,actions:[]};[{n:"metric",zone:"Metric",t:4},{n:"breakByAttribute",zone:"BreakBy"},{n:"trendAttribute",zone:"Trend"}].forEach(function(G){var H=[].concat(E[G.n]||[]),I=C[G.zone];if(H&&H.length){H.forEach(function(J){F.actions.push({act:"addDropZoneUnit",zoneId:I,unitId:J.did,unitType:J.t});});}});return F;},getXml:function B(){var E=new mstrmojo.XMLBuilder();E.addChild("props");E.addChild("widgetProps");E.addChild("fmt");E.closeElement();E.closeElement();E.closeElement();return E.toString();}});var A=mstrmojo.vi.viz.KPICardVisualizationHelper;A.PROP_METRIC="metric";A.PROP_BREAKBY="BreakBy";A.PROP_TREND="trend";}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.XMLBuilder");var B=mstrmojo.hash,G=mstrmojo.array,H="fromitem",D="toitem",E="edgecolorby",J="edgesizeby",C="nodesizeby";mstrmojo.vi.viz.NetworkVisualizationHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.NetworkVisualizationHelper",fromItemAttribute:null,toItemAttribute:null,edgeColorMetric:null,edgeSizeMetric:null,nodeSizeMetric:null,getNetworkMetrics:function(){return[this.nodeSizeMetric,this.edgeSizeMetric,this.edgeColorMetric].filter(function(K){return K!==null;});},getXml:function A(){var K=new mstrmojo.XMLBuilder(),L=function(R,P,Q){if(Q){K.addChild(R);K.addAttribute(P,Q.did);K.closeElement();}},N="value";K.addChild("props");K.addChild("widgetProps");K.addChild("fmt");var O=this.fromItemAttribute,M=this.toItemAttribute;L(H,N,this.fromItemAttribute);L(D,N,this.toItemAttribute);L(E,N,this.edgeColorMetric);L(J,N,this.edgeSizeMetric);L(C,N,this.nodeSizeMetric);K.closeElement();K.closeElement();K.closeElement();return K.toString();},setData:function I(M){if(!M){return ;}var K=this,L=function(N,O){if(N){var P=K[O];arr=N.TemplateUnit||N.TemplateMetric;if(arr){arr.forEach(function(Q){var R=B.copy(Q);if(!R.did){R.did=R.id;}if(P instanceof Array){P.push(R);}else{K[O]=R;}});}}};L(M[F.PROP_FROMITEM],"fromItemAttribute");L(M[F.PROP_TOITEM],"toItemAttribute");L(M[F.PROP_COLORBY],"edgeColorMetric");L(M[F.PROP_SIZEBY],"edgeSizeMetric");L(M[F.PROP_ITEMSIZE],"nodeSizeMetric");},getAddDropZonesAction:function(){var K=this,L={act:"updateTemplate",keyContext:this.node.k,actions:[]};[{n:"fromItemAttribute",zone:"FromItem"},{n:"toItemAttribute",zone:"ToItem"},{n:"edgeColorMetric",zone:"ColorBy",t:4},{n:"nodeSizeMetric",zone:"ItemSize",t:4},{n:"edgeSizeMetric",zone:"SizeBy",t:4}].forEach(function(M){var N=[].concat(K[M.n]||[]),O=mstrmojo.vi.viz.EnumDSSDropZones[M.zone];if(N&&N.length){N.forEach(function(P){L.actions.push({act:"addDropZoneUnit",zoneId:O,unitId:P.did,unitType:P.t});});}});return L;}});var F=mstrmojo.vi.viz.NetworkVisualizationHelper;F.PROP_FROMITEM="from";F.PROP_TOITEM="to";F.PROP_COLORBY="ColorBy";F.PROP_SIZEBY="SizeBy";F.PROP_ITEMSIZE="itemsz";}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.XMLBuilder");var F=mstrmojo.hash,H=mstrmojo.array;function E(){var K,I,J=this.tooltipMetrics;if(J.length>0){K=J[0].did;for(I=1;I<J.length;I++){K=K+","+J[I].did;}}return K;}mstrmojo.vi.viz.HeatMapVisualizationHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.HeatMapVisualizationHelper",groupingObjects:null,colorBy:null,sizeByMetric:null,tooltipMetrics:null,init:function D(I){this._super(I);this.colorBy=[];this.groupingObjects=[];this.tooltipMetrics=[];},getAddDropZonesAction:function(){var I=this,J={act:"updateTemplate",keyContext:this.node.k,actions:[]};[{n:"groupingObjects",zone:"Grouping"},{n:"colorBy",zone:"ColorBy"},{n:"sizeByMetric",zone:"SizeBy",t:4},{n:"tooltipMetrics",zone:"AdditionalMetrics",t:4}].forEach(function(K){var L=[].concat(I[K.n]||[]),M=mstrmojo.vi.viz.EnumDSSDropZones[K.zone];if(L&&L.length){L.forEach(function(N){J.actions.push({act:"addDropZoneUnit",zoneId:M,unitId:N.did,unitType:N.t});});}});return J;},setData:function A(K){if(!K){return ;}var I=this,J=function(M,N){if(M){var O=I[N],L=M.TemplateUnit||M.TemplateMetric;if(L){L.forEach(function(P){var Q=F.copy(P);if(!Q.did){Q.did=Q.id;}if(O instanceof Array){O.push(Q);}else{I[N]=Q;}});}}};J(K[G.PROP_GROUPING],"groupingObjects");J(K[G.PROP_COLORBY],"colorBy");J(K[G.PROP_SIZEBY],"sizeByMetric");J(K[G.PROP_TOOLTIPMETRICS],"tooltipMetrics");},getXml:function B(){var I=new mstrmojo.XMLBuilder(),M,K,J=function(Q,O,P){if(P){I.addChild(Q);I.addAttribute(O,P);I.closeElement();}};I.addChild("props");I.addChild("widgetProps");I.addChild("fmt");var L=this.sizeByMetric,N=this.colorBy[0];if(L&&N){M=L.did+","+N.did;}else{if(L&&!N){M=L.did+","+L.did;}else{if(!L&&N){M=N.did+","+N.did;}}}J("ml","value",M);K=E.call(this);J("am","value",K);I.closeElement();I.closeElement();I.closeElement();return I.toString();},getFirstColorByUnit:function C(L){var J=this.colorBy,I;if(J.length){var K=J[0];if(L){if(this.isMetric(K)){I=K;}}else{I=K;}}return I;}});var G=mstrmojo.vi.viz.HeatMapVisualizationHelper;G.PROP_GROUPING="Grp";G.PROP_COLORBY="ColorBy";G.PROP_SIZEBY="SizeBy";G.PROP_TOOLTIPMETRICS="AdditionalMetrics";}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz.DropZoneHelper","mstrmojo.XMLBuilder");mstrmojo.requiresClsP("mstrmojo.vi.viz","DropZoneHelper","EnumDSSDropZones");var B=mstrmojo,G=B.hash,H=B.vi.viz;function F(){var K,I,J=this.tooltipMetrics;if(J.length>0){K=J[0].did;for(I=1;I<J.length;I++){K=K+","+J[I].did;}}return K;}mstrmojo.vi.viz.ImageLayoutHelper=mstrmojo.declare(mstrmojo.vi.viz.DropZoneHelper,null,{scriptClass:"mstrmojo.vi.viz.ImageLayoutHelper",geoAttribute:null,colorByMetric:null,sizeByMetric:null,layoutAttribute:null,tooltipMetrics:null,mapFile:null,init:function E(I){this._super(I);this.tooltipMetrics=[];if(I&&I.node.data){this.mapFile=I&&I.node.data.vp&&I.node.data.vp.mf;}},getAddDropZonesAction:function(){var I=this,J={act:"updateTemplate",keyContext:this.node.k,actions:[]};[{n:"geoAttribute",zone:"GeoAttribute"},{n:"colorByMetric",zone:"ColorBy",t:4},{n:"sizeByMetric",zone:"SizeBy",t:4},{n:"layoutAttribute",zone:"Layout"},{n:"tooltipMetrics",zone:"AdditionalMetrics",t:4}].forEach(function(K){var L=[].concat(I[K.n]||[]),M=H.EnumDSSDropZones[K.zone];if(L&&L.length){L.forEach(function(N){J.actions.push({act:"addDropZoneUnit",zoneId:M,unitId:N.did,unitType:N.t});});}});return J;},setData:function A(K){if(!K){return ;}var I=this,J=function(M,N){if(M){var O=I[N],L=M.TemplateUnit||M.TemplateMetric;if(L){L.forEach(function(P){var Q=G.copy(P);if(!Q.did){Q.did=Q.id;}if(O instanceof Array){O.push(Q);}else{I[N]=Q;}});}}};J(K[C.PROP_GEO],"geoAttribute");J(K[C.PROP_COLORBY],"colorByMetric");J(K[C.PROP_SIZEBY],"sizeByMetric");J(K[C.PROP_LAYOUT],"layoutAttribute");J(K[C.PROP_TOOLTIPMETRICS],"tooltipMetrics");},getXml:function D(){var J="ga",L="PathToMap",N="ColorBy",I="mf",Q="SizeBy",O="Tooltip";var K=new mstrmojo.XMLBuilder(),M,P=function(U,R,S){if(S&&S.did!==undefined){K.addChild(U);K.addAttribute(R,S.did);K.closeElement();}};K.addChild("props");K.addChild("widgetProps");K.addChild("fmt");P(J,"value",this.geoAttribute);P(N,"value",this.colorByMetric);P(Q,"value",this.sizeByMetric);P(L,"value",this.layoutAttribute);M=F.call(this);P(O,"value",M);P(I,"value",this.mapFile);K.closeElement();K.closeElement();K.closeElement();return K.toString();}});var C=mstrmojo.vi.viz.ImageLayoutHelper;C.PROP_GEO="Geo";C.PROP_COLORBY="ColorBy";C.PROP_SIZEBY="SizeBy";C.PROP_LAYOUT="layout";C.PROP_TOOLTIPMETRICS="AdditionalMetrics";}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.chart.common.DSSTimeUtil");var H=24*60*60*1000;var A=60*60*1000;var L=60*1000;var C=1000;var K=24;var D=24*60;var J=24*60*60;var B=new mstrmojo.chart.common.DSSTimeUtil();mstrmojo.chart.common.DSSDateTime=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.chart.common.DSSDateTime",mnYear:1899,mnMonth:12,mnDay:30,mnHour:0,mnMinute:0,mnSecond:0,mnMillisecond:0,mnWeek:-1,mnDayOfWeek:-1,init:function P(U){if(!U||!U.ifTime){this.mnYear=1899;this.mnMonth=12;this.mnDay=30;this.mnHour=0;this.mnMinute=0;this.mnSecond=0;this.mnMillisecond=0;this.mnWeek=-1;this.mnDayOfWeek=-1;return ;}var S=0;var W=23242571;var R=-693593;if(U.ifTime>W){this.mnYear=65535;this.mnMonth=12;this.mnDay=30;S=U.ifTime-Math.floor(U.ifTime);}else{if(U.ifTime<R){this.mnYear=1;this.mnMonth=1;this.mnDay=1;S=Math.abs(U.ifTime)+Math.ceil(U.ifTime);}else{if(U.ifTime>0){var X=this.DAYSToYMD(Math.floor(U.ifTime));this.mnYear=X.year;this.mnMonth=X.month;this.mnDay=X.day;S=U.ifTime-Math.floor(U.ifTime);}else{if(U.ifTime<0){var X=this.DAYSToYMD(Math.ceil(U.ifTime));this.mnYear=X.year;this.mnMonth=X.month;this.mnDay=X.day;S=Math.abs(U.ifTime)+Math.ceil(U.ifTime);}}}}S*=H;var V=S+0.5;if(V==H){V--;}if(V>0){this.mnHour=Math.floor(V/A);V-=this.mnHour*A;this.mnMinute=Math.floor(V/L);V-=this.mnMinute*L;this.mnSecond=Math.floor(V/C);V-=this.mnSecond*C;this.mnMillisecond=Math.floor(V);}else{this.mnHour=0;this.mnMinute=0;this.mnSecond=0;this.mnMillisecond=0;}this.mnWeek=-1;this.mnDayOfWeek=-1;this.Sanitize();},Sanitize:function O(){var R=false;if(this.mnHour==24&&this.mnMinute==0&&this.mnSecond==0){R=true;this.mnHour=0;}if(this.mnMonth<1){this.mnMonth=1;}else{if(this.mnMonth>12){this.mnMonth=12;}}if(this.mnDay<1){this.mnDay=1;}else{if(this.mnDay>B.DaysInMonth[this.mnMonth-1]){this.mnDay=B.DaysInMonth[this.mnMonth-1];if(this.mnMonth==2&&this.IsLeapYear(this.mnYear)){this.mnDay++;}}}if(this.mnHour<0){this.mnHour=0;}else{if(this.mnHour>23){this.mnHour=23;}}if(this.mnMinute<0){this.mnMinute=0;}else{if(this.mnMinute>59){this.mnMinute=59;}}if(this.mnSecond<0){this.mnSecond=0;}else{if(this.mnSecond>59){this.mnSecond=59;}}if(this.mnMillisecond<0){this.mnMillisecond=0;}else{if(this.mnMillisecond>999){this.mnMillisecond=999;}}if(R){var S=this.ToMilliseconds();S=S+H;this.init({ifTime:this.MillisecondsToDATE(S)});}},IsLeapYear:function Q(R){return((R&3)==0)&&((R%100)!=0||(R%400)==0);},ToMilliseconds:function I(){var R=this.YMDToDAYS(this.mnYear,this.mnMonth,this.mnDay);var S=R*H;S+=this.mnHour*A+this.mnMinute*L+this.mnSecond*C+this.mnMillisecond;return S;},MillisecondsToDATE:function E(S){var R=Math.floor(S/H);var U=(S-R*H)/H;if(U<0){R--;U+=1;}return R>=0?R+U:R-U;},DAYSToYMD:function N(U){var X=0;var Z=0;var S=0;U+=693959;var W=Math.floor(U/365);var V=U-W*365;var Y=Math.floor(W/4)-Math.floor(W/100)+Math.floor(W/400);V=V-Y;if(V<0){W--;V+=365;while(V<=0){W--;V+=365;}}var R=U-(W*365+Math.floor(W/4)+(W%4?1:0)-Math.floor((W-1)/100)+Math.floor((W-1)/400));if(R==365&&!this.IsLeapYear(W)){X=W+1;Z=1;S=1;return{year:X,month:Z,day:S};}if(R==-1){X=W-1;Z=12;S=31;return{year:X,month:Z,day:S};}X=W;Z=12;while(R<B.DaysBeforeMonth[Z-1]){Z--;}S=R-B.DaysBeforeMonth[Z-1]+1;if(Z>2&&this.IsLeapYear(X)){S--;if(S==0){Z--;S=B.DaysInMonth[Z-1];if(Z==2){S++;}}}return{year:X,month:Z,day:S};},YMDToDAYS:function G(V,U,S){if(U<1||U>12){return 0;}var R=V*365+Math.floor(V/4)+(V%4?1:0)-Math.floor((V-1)/100)+Math.floor((V-1)/400);R+=B.DaysBeforeMonth[U-1];if(U>2&&this.IsLeapYear(V)){R++;}R+=S-1;R-=693959;return R;},ToDATE:function F(){var S=this.YMDToDAYS(this.mnYear,this.mnMonth,this.mnDay);var R=this.mnHour/K+this.mnMinute/D+this.mnSecond/J+this.mnMillisecond/H;if(S>=0){return S+R;}else{return S-R;}},DateTimeOrder:function M(R){if(this.mnYear>R.mnYear){return 1;}else{if(this.mnYear<R.mnYear){return -1;}}if(this.mnMonth>R.mnMonth){return 1;}else{if(this.mnMonth<R.mnMonth){return -1;}}if(this.mnDay>R.mnDay){return 1;}else{if(this.mnDay<R.mnDay){return -1;}}if(this.mnHour>R.mnHour){return 1;}else{if(this.mnHour<R.mnHour){return -1;}}if(this.mnMinute>R.mnMinute){return 1;}else{if(this.mnMinute<R.mnMinute){return -1;}}if(this.mnSecond>R.mnSecond){return 1;}else{if(this.mnSecond<R.mnSecond){return -1;}}if(this.mnMillisecond>R.mnMillisecond){return 1;}else{if(this.mnMillisecond<R.mnMillisecond){return -1;}}return 0;}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.expr","mstrmojo.date","mstrmojo.num","mstrmojo.string");mstrmojo.validation={STATUSCODE:{UNKNOWN:-1,VALID:0,INVALID:1,INVALID_EMPTY:2,INVALID_CHAR:3,INVALID_OUTOFRANGE:4,INVALID_REGEX:5,INVALID_VALIDATOR:6,INVALID_BAD_NUMERICFORMAT:7,INVALID_BAD_DATESTRING:8},TRIGGER:{NONE:0,ONBLUR:1,ONKEYUP:2,VALUESET:4,ALL:7},REGEXP:{US_ZIP:/^\d{5}([\- ]?\d{4})?$/,EMAIL_ADDRESS:/^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9\-])+[\.])+([a-zA-Z0-9]{2,4})+$/,SOCIAL_SECURITY_NUMBER:/^((?!000)(?!666)\d{3})(\s|\-)?((?!00)\d{2})\2((?!0000)\d{4})$/,PHONE_NUMBER:/^(?!-)[ \d\-\(\)\.\+]+$/,FILE_NAME:new RegExp('^[^:*?"<>|/\\\\()]+$'),FOLDER_PATH_WIN:new RegExp('^([a-zA-Z]:|\\\\\\\\[^:*?"<>|/\\\\]+|[^:*?"<>|/\\\\]*)(\\\\[^:*?"<>|/\\\\]+)*(\\\\){0,1}$'),FOLDER_PATH_UNIX:new RegExp('^(/){0,1}([^:*?"<>|/\\\\]+/)*([^:*?"<>|/\\\\]+){0,1}$'),PRINTER_PATH_SINGLE:new RegExp('^[^$%:*?"<>|/\\\\]*$'),PRINTER_PATH_MULTIPLE:new RegExp('^((/|\\\\\\\\)[^$%:*?"<>|/\\\\]+)((/|\\\\)[^$%:*?"<>|/\\\\]+)*(/|\\\\){0,1}$')}};var H=mstrmojo.validation,B=H.TRIGGER,c=H.STATUSCODE,A={"-1":-1,1:1,2:1,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:4,12:4,13:4,14:6,15:6,16:6,17:3,18:3,21:2,22:2,23:3,24:4,25:3,30:5,34:5};H.VALIDATOR={DEMO:function N(f){var e=parseInt(f,10),g=mstrmojo.validation.STATUSCODE;if(e===0||e===1||e>10){return{code:g.VALID};}return{code:g.INVALID,msg:"This field must be either 0, 1 or greater than 10"};},VALIDATE_PHONENO:function I(e){var f=String(e).replace(/[^\d]/g,"");if(f.length<10){return{code:c.INVALID,msg:mstrmojo.desc(9203,"A telephone number must contain at least 10 digits.")};}if(!H.REGEXP.PHONE_NUMBER.test(e)){return{code:c.INVALID,msg:mstrmojo.desc(9204,"The telephone number contains invalid characters.")};}return{code:c.VALID};},VALIDATE_ZIPCODE:function G(e){var g="",f=this.dtp;if(!H.REGEXP.US_ZIP.test(e)){if(H.isNumeric(f)||H.isInt(f)){g=mstrmojo.desc(9208,"A zip code must be 5 digits or 5+4 digits.");}else{if(H.isString(f)){g=mstrmojo.desc(9206,"The zip code is invalid");}}return{code:c.INVALID,msg:g};}return{code:c.VALID};},VALIDATE_EMAIL:function U(e){var f=e.indexOf("@");if(f===-1){return{code:c.INVALID,msg:mstrmojo.desc(9197,"The email address is missing an at sign (@).")};}if(e.substring(f).indexOf(".")===-1){return{code:c.INVALID,msg:mstrmojo.desc(9198,"The email address is missing a period on the domain.")};}return H.REGEXP.EMAIL_ADDRESS.test(e)?{code:c.VALID}:{code:c.INVALID,msg:mstrmojo.desc(9207,"The email address is invalid.")};},VALIDATE_SSN:function Q(e){var g=this.dtp,f;if(H.isNumeric(g)||H.isInt(g)){f=String(e).replace(/[^\d]/g,"");if(f.length!==9){return{code:c.INVALID,msg:mstrmojo.desc(9209,"A Social Security Number must be 9 digits.")};}}if(!H.REGEXP.SOCIAL_SECURITY_NUMBER.test(e)){return{code:c.INVALID,msg:mstrmojo.desc(9210,"The Social Security Number is invalid.")};}return{code:c.VALID};}};H.isInt=function D(e){return A[e]===1;};H.isNumeric=function Z(e){return A[e]===2||A[e]===5;};H.isString=function J(e){return A[e]===3;};var C=window.mstrConfig,L=C.listSep,S=mstrmojo.expr,M=S.DTP,a=mstrmojo.num,V=mstrmojo.string,F=mstrmojo.date;function P(m,n){var j=m.dtp,l=m.constraints,p=l.allowedFormatChars||"",h=(A[j]===1),e=H.isNumeric(j),f=(A[j]===6),o=mstrmojo.locales.number.THOUSANDSEPARATOR,g=mstrmojo.locales.number.DECIMALSEPARATOR,k;if(h){if(!m._intRegExp){p+="0-9-"+(m.isList?L:"")+o;m._intRegExp=new RegExp("[^"+p+"]");}k=m._intRegExp;}if(e){if(!m._numericRegExp){p+="0-9-#"+(m.isList?L:"")+g+o;m._numericRegExp=new RegExp("[^"+p+"]");}k=m._numericRegExp;}return !!k&&k.test(n);}function d(m,o){var j=m.dtp,l=m.constraints,h=(A[j]===1),e=H.isNumeric(j),f=(A[j]===6),g=l.min,n=l.max,k;if(g===undefined&&n===undefined){return false;}if(h||e){if(a.isBigDecimal(o)){return a.inNumericRange(a.parseBigDecimal(o),g,n)!==0;}return a.inNumericRange(o,g,n)!==0;}if(f){return F.inDateTimeRange(o,g,n)!==0;}return false;}function K(f,e){return !a.isNumeric(e)&&!a.isBigDecimal(e);}function R(h,f){var g=(h.dtp===M.DATE),e=(h.dtp===M.TIME);return(g?!F.isDate(f):(e?!F.isTime(f):!F.isDateAndOrTime(f)));}mstrmojo._CanValidate=mstrmojo.provide("mstrmojo._CanValidate",{constraints:null,required:false,dtp:M.INTEGER,isList:false,autoFormat:false,validationStatus:null,init:function X(e){this._super(e);if(!this.constraints){this.constraints={};}var f=this.constraints;if(!f.hasOwnProperty("trigger")){f.trigger=B.NONE;}},_set_value:function(k,g){var h=this.value,f=(h!==g);if(f){this.value=g;var j=this.constraints.trigger,e=(j&B.VALUESET)>0;if(e){this.validate(g);}}return f;},validate:function O(){var g=(this.value!==null&&this.value!==undefined)?this.value:"",k=this.isList?g.split(L):[g],j,f,l,e=k.length,h;for(h=0;h<e;h++){j=this.doValidation(k[h]);f=(j.code>c.VALID);if(f){if(e>1){j.msg=mstrmojo.locales.validation.invalidValueInListError.replace("#",k[h]||" ");}break;}}l=f?"onInvalid":"onValid";if(!f&&this.autoFormat){this.format();}this.set("validationStatus",j);if(this[l]){this[l](j);}},format:function Y(){var k=this.dtp,g=(A[k]===6);if(!g){return ;}var m=mstrConfig.listSep,p=this.value||"",f=this.isList?p.split(m):[p],o=k===14,n=[],e,h=mstrmojo.locales.datetime,l=f.length,j;for(j=0;j<l;j++){p=f[j];e=F.parseDateAndOrTime(p);if(e){if(o&&e.date){n.push(F.formatDateInfo(e.date,h.DATEOUTPUTFORMAT));}else{n.push((e.date?F.formatDateInfo(e.date,h.DATEOUTPUTFORMAT):"")+" "+(e.time?F.formatTimeInfo(e.time,h.TIMEOUTPUTFORMAT):""));}}}this.set("value",n.join(m));},isValid:function W(){var e=this.validationStatus;if(!e){this.validate();}return this.validationStatus.code===c.VALID;},clearValidation:function b(){this.set("validationStatus",{code:c.VALID});if(this.onClearValidation){this.onClearValidation();}},doValidation:function E(s){var o=this.constraints,p=o.regExp,g=o.validator,e={id:this.id,code:c.VALID,msg:""},n=this.dtp,m=(A[n]===1),f=H.isNumeric(n),h=(A[n]===3),j=(A[n]===6),l=V.isEmpty(s),q=String(s).length,k="",u=mstrmojo.locales.validation;if(this.required&&l){e.code=c.INVALID_EMPTY;e.msg=u.requiredFieldError;return e;}s=V.trim(s);if(!l&&P(this,s)){if(m){k=u.integerDataType;}if(f){k=u.numericDataType;}if(j){k=u.dateDataType;}e.code=c.INVALID_CHAR;e.msg=u.invalidCharError.replace("#",k);return e;}if(!l&&j&&R(this,s)){e.code=c.INVALID_BAD_DATESTRING;e.msg=u.invalidDateStringError;return e;}if(!l&&(f||m)&&K(this,s)){e.code=c.INVALID_BAD_NUMERICFORMAT;e.msg=u.invalidNumericFormatError;return e;}if(!l&&(m||f||j)&&d(this,s)){e.code=c.INVALID_OUTOFRANGE;if(o.min!==null&&o.max!==null){k=u.outofRangeError.replace("# ","").replace("##",a.toLocaleString(o.min)).replace("###",a.toLocaleString(o.max));}else{if(o.min!==null){k=u.noLessMinError.replace("##",a.toLocaleString(o.min)).replace("# ","");}else{if(o.max!==null){k=u.noGreaterMaxError.replace("###",a.toLocaleString(o.max)).replace("# ","");}}}e.msg=k;return e;}if(h&&o.minLen!==null&&o.maxLen!==null){if(q<o.minLen||q>o.maxLen){e.code=c.INVALID;e.msg=mstrmojo.desc(9211).replace(/#/,o.minLen).replace(/##/,o.maxLen);return e;}}if(p&&!p.test(s)){e.code=c.INVALID_REGEX;e.msg=mstrmojo.desc(9205);return e;}var t=g&&g.apply(this,[s]);if(t){e.code=t.code;e.msg=t.msg;return e;}return e;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.num","mstrmojo.locales");var D=mstrmojo.array,A=mstrmojo.num,B=mstrmojo.locales;mstrmojo.vi.util.NumberFormatUtility=mstrmojo.provide("mstrmojo.vi.util.NumberFormatUtility",{applyFormatToNumber:function C(P,Q,G){var H="\u00A4",L=/"[^"]*"/g,F=P.match(L),K=P.replace(L,H),O=["m","y","d","h","s"],N=G||false,E=new Date(),M=E.getFullYear(),J=E.getMonth(),I=E.getDay(),S=B.datetime,R;D.forEach(O,function(U){N=N||K.indexOf(U,0)!==-1;});if(N){K=K.replace(/y{3,}/g,M).replace(/y{1,2}/g,M.toString().slice(2,4));K=K.replace(/m{4,}/g,S.MONTHNAME_FULL[J-1]).replace(/m{3}/g,S.MONTHNAME_SHORT[J-1]).replace(/mm/g,"07").replace(/m/g,"7").replace(/7ber/g,"mber");K=K.replace(/d{4,}/g,S.dayNames[I-1]).replace(/d{3}/g,"Mon").replace(/dd/g,"10").replace(/d/g,"1").replace(/1ay/g,"day");K=K.replace(/hh/g,"08").replace(/h/g,"8");K=K.replace(/ss/g,"04").replace(/s/g,"4");K=K.split(H);R=K[0];D.forEach(F,function(V,U){R+=V+K[U+1];});return R;}if(A.isNumeric(Q)){return A.formatByMask(P,A.parseNumeric(Q));}return Q;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.num","mstrmojo.func","mstrmojo.EnumRWUnitType","mstrmojo.storage.DOMLocalStorage");var E=new mstrmojo.storage.DOMLocalStorage({itemTimeToLive:-1});var a=mstrmojo,O=a.all,X=a.num,R=a.hash,J=a.array,Q=a.func,L=a.EnumRWUnitType,A={update:"updateTemplate",add:"addDropZoneUnit",remove:"removeDropZoneUnit",ungroup:"removeQuickDE",ungroup1:"removeNDEFromDS",add2group:"applyDEChanges",muteKey:"__MSTR_MUTE_VFN",gridStyle:"XtabGrid"};function P(){var c=this,d=c.getSelectedViUnit();return d&&d.boxContent;}function K(j){var f=J.ensureArray(j.actions),m,e,h=j.zm,k=j.vn,d,c=j.cmb,g=j.ca||[],l=j.k;var n=function(o){return o===A.add||A.remove;};if(!!h===false){return false;}d=h.getVFNotifierBlackList(k,c);if(g.length){return J.intersection(g,d).length>0;}f=J.filter(f,function(o){o=o||{};return(o.act===A.update&&o.keyContext===l)||n(o.act||"");});return f.some(function(o){o=o||{};m=o.actions||J.ensureArray(f);return m.some(function(p){p=p||{};e=p.zoneId;e=X.isInt(p.zoneId)?e:p.axis;return n(p.act||"")&&X.isInt(e)&&d.indexOf(e)!==-1;});});}function S(g){var d,j=J.ensureArray(g.actions),f=g.k;var e=function(k){return k===A.add2group;};var c=function(k){return k===A.ungroup||k===A.ungroup1;};var h=J.filter(j,function(k){k=k||{};return(k.k===f&&e(k.act||""))||c(k.act||"");});if(h.length>0){return true;}j=J.filter(j,function(k){k=k||{};return(k.act===A.update&&k.keyContext===f);});return j.some(function(k){k=k||{};d=k.actions||J.ensureArray(j);return d.some(function(l){l=l||{};return c(l.act||"");});});}function G(e){e=e||{};var d,f=e.vn,c=e.ca,g=e.zm;if(g&&c){d=g.getVFNotifierBlackList(f,e.cmb);return J.intersection(d,c).length;}return false;}function Y(){var c;if(!!mstrApp.muteVFNotifier){return true;}try{c=JSON.parse(E.getItem(A.muteKey))===true;}catch(d){c=false;}return c;}function Z(e){var f,c,d=e.node&&e.node.data,h=d&&d.sc,g=h&&h.exp;if(g&&g.nds){return g.nds.length>0;}f=e.getSelectionCache&&e.getSelectionCache();c=f&&f._viSelections;return(c?Object.keys(c):[]).length>0;}mstrmojo.vi.models._NotificationVisFilter=mstrmojo.provide("mstrmojo.vi.models._NotificationVisFilter",{_mixinName:"mstrmojo.vi.models._NotificationVisFilter",isVisFilter:function M(c){var d=null;if(c){if(c&&c.iifp){return[L.VISUALIZATION,L.MOJOVISUALIZATION,L.GRID,L.GRAPH,L.GRIDGRAPH].indexOf(c.t)!==-1;}d=O[c.id];}else{d=P.call(this);}return d&&d.isInFilterPanel&&d.isInFilterPanel();},hasSelectionOnVisFilter:function W(){var c=P.call(this);if(c&&c.isInFilterPanel&&c.isInFilterPanel()){return Z(c);}return false;},clearSelectionOnVisFilter:function B(c){var d=P.call(this);if(d&&d.setSelectionCache){d.setSelectionCache({});if(c){this.raiseEvent({name:"clearSelector",id:d.id,k:d.k});}}},needNotifyVFChange:function b(c,e){if(c==="CHANGE_VISTYPE"){return false;}e=e||{};var f=null,d=e.defn,g=false;if(d&&d.id){f=O[d.id];}else{f=P.call(this);}if(f&&f.isInFilterPanel&&f.isInFilterPanel()){g=mstrApp.isInVFConfigMode&&Z.call(this,f);}if(g){e.k=e.k||f.k;e.vn=R.walk("model.data.visName",f)||R.walk("model.data.vis.vn",f);if(e.vn===undefined){e.vn=f.defn&&f.defn.t===521?A.gridStyle:null;}switch(c){case"DROP_ZONE_UPDATE":g=K.call(this,e);break;case"GROUP_UPDATE":g=S.call(this,e);break;case"CLEAR_ALL":g=G.call(this,e);break;case"CHANGE_VISTYPE":case"KEEPONLY_EXCLUDE":break;default:g=false;break;}}return g;},notifyVFChange:function V(e){e=e||{};var d=this,g=P.call(d),j=e.onConfirm,f=mstrmojo.desc(15298,"Do you want to unset filter?"),c=mstrmojo.desc(15299,"The actions which changes the data will unset the filter."),h='<div style="font-weight: bold">'+f+"</div><div>"+c+"</div>";if(j){e.onConfirm=Q.composite([j,function(){d.raiseEvent({name:"clearSelector",id:g.id,k:g.k});}]);}mstrmojo.warn(h,{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:e.onConfirm||mstrmojo.emptyFn},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:e.onCancel||mstrmojo.emptyFn}},{title:mstrmojo.desc(14595,"Unset Filter"),allowHTML:true,children:[{scriptClass:"mstrmojo.Label",cssClass:"alert-content",text:h,slot:"containerNode",allowHTML:true},{scriptClass:"mstrmojo.CheckBox",slot:"buttonNode",cssClass:"mstrmojo-checkbox-inline",label:mstrmojo.desc(15300,"Do not show me again"),onclick:function(){mstrApp.muteVFNotifier=this.checked;if(this.checked){E.setItem(A.muteKey,true);}else{E.removeItem(A.muteKey);}}}]});},wrapUnsetVisualizationFilterAction:function U(h,e){var f=P.call(this),g=f&&f.model.data&&f.model.data.sc,c,d=function(){var j=this.getDataService();return j&&j.getMultiUnitSelectorAction({ck:g.ck,ct:g.ct,ctlKey:g.ckey,selections:[],tks:g.tks,type:521,isNavigation:false,ignoreTargetData:true});};f.clearSelections();f.setSelectionCache({_selectionType:f.getSelectionType(),_viSelections:f.getSelectionHash()});if(g){c=d.call(this,g);if(c&&c.partialUpdate&&e){delete c.partialUpdate;}return[c].concat(J.ensureArray(h));}return h;},checkAndNotify:function N(c,d){if(Y()){var e=P.call(this);this.raiseEvent({name:"clearSelector",id:e.id,k:e.k});return c();}else{return this.notifyVFChange({onConfirm:c,onCancel:d});}},checkAndNotifyVFChangeOnDZUnitsUpdate:function H(g,d,c){if(this.needNotifyVFChange("DROP_ZONE_UPDATE",g)){var e=this.getSelectedViUnit(),f=function(){if(e&&e.selectVIUnit){e.selectVIUnit(true);}};return this.checkAndNotify(d,f);}c=c||d;return c();},checkAndNotifyVFChangeOnVisTypeUpdate:function I(e,d,c){if(this.needNotifyVFChange("CHANGE_VISTYPE",e)){this.clearSelectionOnVisFilter();return this.checkAndNotify(d);}c=c||d;return c();},checkAndNotifyVFChangeOnClearAll:function F(e,d,c){if(this.needNotifyVFChange("CLEAR_ALL",e)){this.clearSelectionOnVisFilter();return this.checkAndNotify(d);}c=c||d;return c();},checkAndNotifyVFChangeOnGroupUpdate:function C(e,d,c){if(this.needNotifyVFChange("GROUP_UPDATE",e)){this.clearSelectionOnVisFilter();return this.checkAndNotify(d);}c=c||d;return c();},checkAndNotifyVFChangeOnKeepOnlyExclude:function D(e,d,c){if(this.needNotifyVFChange("KEEPONLY_EXCLUDE",e)){return this.checkAndNotify(d);}c=c||d;return c();}});}());(function(){mstrmojo.requiresCls("mstrmojo.num","mstrmojo.hash","mstrmojo.string","mstrmojo.array","mstrmojo._FormatDefinition");var B=mstrmojo.num,G=mstrmojo.hash,F=mstrmojo.string,C=mstrmojo.array,E=mstrmojo._FormatDefinition.NumberFormatCategory;mstrmojo.MetricSelectorUtility=mstrmojo.provide("mstrmojo.MetricSelectorUtility",{_GENERIC:1,_RANK:2,_PERCENT:3,OP:{_EQUALS:0,_NOT_EQUALS:1,_GREATER:2,_GREATER_EQUAL:3,_LESS:4,_LESS_EQUAL:5,_BETWEEN:6,_NOT_BETWEEN:7,_IN:8,_NOT_IN:9,_IS_NULL:10,_IS_NOT_NULL:11},OP_NAMES:[{n:mstrmojo.desc(2795,"Equals"),v:0},{n:mstrmojo.desc(2796,"Does not equals"),v:1},{n:mstrmojo.desc(521,"Greater than"),v:2},{n:mstrmojo.desc(522,"Greater than or equal to"),v:3},{n:mstrmojo.desc(523,"Less than"),v:4},{n:mstrmojo.desc(524,"Less than or equal to"),v:5},{n:mstrmojo.desc(696,"Between"),v:6},{n:mstrmojo.desc(746,"Not between"),v:7},{n:mstrmojo.desc(587,"In"),v:8},{n:mstrmojo.desc(2204,"Not In"),v:9},{n:mstrmojo.desc(2202,"Is null"),v:10},{n:mstrmojo.desc(2203,"Is not null"),v:11}],RANK_OP_NAMES:[{n:mstrmojo.desc(529,"Highest"),v:1},{n:mstrmojo.desc(530,"Lowest"),v:2},{n:mstrmojo.desc(4407,"Highest %"),v:3},{n:mstrmojo.desc(4406,"Lowest %"),v:4}],Q:{_G:0,_RT:1,_RB:2,_PT:3,_PB:4},MRPFN:{TOP:1,BOTTOM:2,BETWEEN:3,EXCLUDETOP:4,EXCLUDEBOTTOM:5,NOTBETWEEN:6,EQUALS:7,DIFFERENTFROM:8,EQUALSDESCENDING:15,NOTEQUALSDESCENDING:16,GREATERTHANDESCENDING:4,GREATERTHANEQUALSDESCENDING:18,LESSTHANDESCENDING:20,LESSTHANEQUALSDESCENDING:1,BETWEENDESCENDING:13,NOTBETWEENDESCENDING:14,INDESCENDING:22,NOTINDESCENDING:24,EQUALSASCENDING:7,NOTEQUALSASCENDING:8,GREATERTHANASCENDING:5,GREATERTHANEQUALSASCENDING:17,LESSTHANASCENDING:19,LESSTHANEQUALSASCENDING:2,BETWEENASCENDING:3,NOTBETWEENASCENDING:6,INASCENDING:21,NOTINASCENDING:23},FN:{EQUALS:6,NOTEQUALS:7,GREATERTHAN:8,GREATERTHANEQUALS:10,LESSTHAN:9,LESSTHANEQUALS:11,BETWEEN:17,NOTBETWEEN:44,ISNULL:54,ISNOTNULL:55,IN:22,NOTIN:57,CONTAINS:76,NOTCONTAINS:79,BEGINSWITH:77,NOTBEGINSWITH:80,ENDSWITH:78,NOTENDSWITH:81,LIKE:18,NOTLIKE:43,AND:19,OR:20,NOT:21,RANK:23,RANKPERCENT:59,TUPLE:1000},F:[[6,7,8,10,9,11,17,44,22,57,54,55],[15,16,4,18,20,1,13,14,22,24],[7,8,5,17,19,2,3,6,21,23]],EnumNumberCategory:{Default:-2,Fixed:0,Currency:1,Date:2,Time:3,Percentage:4,Fraction:5,Scientific:6,Custom:7,Special:8,General:9,FromGrid:10},typeHelperCls:{0:"MetricValueSliderHelper",defaultCls:"MetricRankSliderHelper"},ErrorType:{_GENERIC:mstrmojo.desc(11689,"Invalid Number"),_RANK:mstrmojo.desc(11856,"Please enter value between ## and ###.")},ErrorCode:{EmptyValue:"emptyValueVIWarning",InvalidValue:"invalidValueVIWarning",OutOfRange:"outOfRangeVIWarning",NotInteger:"notIntegerVIWarning"},getQuaByFunc:function(L,M){var I=this.F,H=this.Q,K=H._G,J=function(N){return C.indexOf(I[1],N)!==-1;};if(J(L)){K=(M===this._RANK)?H._RT:H._PT;}else{K=(M===this._RANK)?H._RB:H._PB;}return K;},getFuncInfo:function(K,L){var J={},I=this.Q,H=this.F;J[I._G]={ft:this._GENERIC,f:H[0][K]};J[I._RT]={ft:this._RANK,f:H[1][K]};J[I._RB]={ft:this._RANK,f:H[2][K]};J[I._PT]={ft:this._PERCENT,f:H[1][K]};J[I._PB]={ft:this._PERCENT,f:H[2][K]};return J[L]||{};},getOpIdxByfunc:function(J,K){if(!J||!K){return -1;}var H=this.F,I=-1;switch(K){case this._GENERIC:I=C.indexOf(H[0],J);break;case this._RANK:case this._PERCENT:I=C.indexOf(H[1],J);if(I===-1){I=C.indexOf(H[2],J);}break;}return I;},getIncludeByOp:function(I){var H=this.OP;return I===H._EQUALS||I===H._GREATER_EQUAL||I===H._LESS_EQUAL||I===H._BETWEEN||I===H._IN;},formatNumber:function(J,L,I){var M,K=this.Q,N=I.fm,H=I.cat;if(!B.validateFormat(N)){N="#,##0.00;(#,##0.00)";}if(J===K._G){M=(N)?B.formatByMask(N,L):B.format(I.cat,I.dp,I.curr,L);}else{if(J===K._RB||J===K._RT){M=String(parseInt(L,10));}else{if(J===K._PB||J===K._PT){M=parseFloat(L)+"%";}}}if((H===E.Fixed||H===E.Currency||H===E.Percentage)&&L<0&&!F.startsWith(M,"(")&&!F.startsWith(M,"-")){M="-"+M;}return M;},doValidation:function(U,L,P,N){var O=L.qua,R=L.low,K=L.high,M=this.Q,V=O===M._RT||O===M._RB,H=O===M._PT||O===M._PB,S="",J,I=this.ErrorCode;if(F.isEmpty(U)){S=I.EmptyValue;}else{if(!(B.isNumeric(U)||(H&&String(U).match(/^\d+(\.\d+)?%$/))||(N&&!H&&B.isBigDecimal(U)))){S=I.InvalidValue;}else{if((O===M._PT||O===M._PB)&&B.inNumericRange(parseFloat(U),R,K)){S=I.OutOfRange;J=H?["0","100%"]:[R,K];}else{if(V&&(!B.isInt(U)||B.parseInteger(U,10)<0)){S=I.NotInteger;}}}}return G.copy(P,{invalid:!!S,errorCode:S,args:J||[]});},restoreMetricSelectorProps:function D(I,H){if(!I||!H){return ;}G.copyProps(["max","min","cnt","dt","nov"],H,I);},restoreMetricSelectorSelections:function A(I,H){if(!I||!H){return ;}G.copyProps(["f","ft","cs"],H,I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.elementHelper","mstrmojo.mstr.EnumNodeProperties","mstrmojo.EnumSelectionType");var k=mstrmojo.array,U=mstrmojo.hash,Q=mstrmojo.expr,f=mstrmojo.elementHelper,Z=Q.ET,E=Q.FN,m=Q.DTP,C=mstrmojo.mstr.EnumNodeProperties,c=mstrmojo.EnumSelectionType;var AD=0,F=1,M=2,K=3,d=4,t=5;var n=0,AE="u;",Y="LEVEL_NUMBER",X=false,J=7;function AC(AG){return AG.t===47&&AG.st===12033;}function S(AG,AH){if(AG&&AH&&AH.t===J){return AG.parent===AH&&AG.lv===AH.lv;}return false;}function l(AG){if(AG&&AG.t===J){return k.filter(AG.children,function(AH){return AH.lv===AG.lv;});}return[];}function AB(AG){return !!AG.not||AG.fn===E.NOT_IN_LIST||AG.fn===E.NOT_EQUAL;}function x(AG){return U.copyProps(["did","n","t","st"],AG);}function P(AJ,AG){var AI=AC(AG),AK=AI?AJ.v:f.terseLong2OldShort(AJ.v),AH={v:AK.replace(/\\:/g,"*:"),n:AJ.n};if(AI){AH.t=AJ.t;AH.conid=AG.did;}return AH;}function R(AJ,AH){if(parseInt(AJ,10)>=0){var AI=AH.lvfs||[],AG=AI[AJ]&&AI[AJ].lvfn||"";return{v:AG?AJ+";"+AG:AJ,dtp:AG?m.CHAR:m.INTEGER};}return null;}function w(AJ,AL,AI){var AG=f.getIdPresentation(AJ),AH=AC(AI);AJ=AJ.replace(/\*:/g,"\\:");switch(AL){case"old":case"oldLong":switch(AG){case"old":case"oldLong":return AJ;case"terse":case"terseLong":switch(AJ[0]){case"V":return AJ.substring(1).split(";")[0];case"n":return"HF:"+ +f.terseLong2OldShort(AJ)+":47";default:return f.terseLong2OldShort(AJ);}}break;case"terse":case"terseLong":switch(AG){case"old":return AH?("V"+AJ+";"+AI.did):f.oldShort2terseLong(AJ,"h");case"oldLong":switch(AJ.substring(0,2)){case"HF":var AK=AJ.substr(3).split(":");if(AK.length>3){AK.pop();}return f.oldShort2terseLong(AK.join(":"),"n");default:return AJ;}case"terse":case"terseLong":return AJ;}break;default:return AJ;}}function s(AG){if(isNaN(AG)&&typeof AG==="string"){return parseInt(AG.split(";")[0],10);}return parseInt(AG,10);}function o(AG){return !AG||AG.lv>0&&!AG.parent;}function a(AG,AO,AN){var AL=AN.item,AI=AN.ancestorMap,AM=AN.descendantMap,AH=this.getItemByValue(AG.itemValue),AK=this.getItemByValue(AO.itemValue),AJ=function(AP,AQ){if(AL&&AL===AP&&AM){return AM[AQ.v];}if(AL&&AL===AQ&&AI){return AI[AP.v];}while(AQ){if(AP===AQ){return true;}AQ=AQ.parent;}return false;};switch(AG.func){case c.ALL:return AO.func===c.ALL?AD:K;case c.ELEMENT:switch(AO.func){case c.ALL:return M;case c.ELEMENT:return AH===AK?AD:S(AH,AK)?M:S(AK,AH)?K:t;case c.BRANCH:return AJ(AK,AH)?M:S(AK,AH)?d:o(AH)?F:t;case c.LEVEL:return AH.lv===AO.level?M:t;case c.BRANCH_LEVEL:return AH.lv!==AO.level?t:o(AH)?F:AJ(AK,AH)?M:t;}break;case c.BRANCH:switch(AO.func){case c.ALL:return M;case c.ELEMENT:return AJ(AH,AK)?K:S(AH,AK)?d:o(AK)?F:t;case c.BRANCH:return AH===AK?AD:(o(AH)||o(AK))?F:AJ(AK,AH)?M:AJ(AH,AK)?K:t;case c.LEVEL:return AH.lv<=AO.level?d:t;case c.BRANCH_LEVEL:return AH===AK?K:(o(AH)||o(AK))?F:AJ(AH,AK)?K:(AJ(AK,AH)&&AO.level>=AH.lv)?d:t;}break;case c.LEVEL:switch(AO.func){case c.ALL:return M;case c.ELEMENT:return AK.lv===AG.level?K:t;case c.BRANCH:return AK.lv<=AG.level?d:t;case c.LEVEL:return AG.level===AO.level?AD:t;case c.BRANCH_LEVEL:return AG.level===AO.level?K:t;}break;case c.BRANCH_LEVEL:switch(AO.func){case c.ALL:return M;case c.ELEMENT:return AK.lv!==AG.level?t:o(AK)?F:AJ(AH,AK)?K:t;case c.BRANCH:return AH===AK?M:(o(AH)||o(AK))?F:AJ(AK,AH)?M:(AJ(AH,AK)&&AG.level>=AK.lv)?d:t;case c.LEVEL:return AG.level===AO.level?M:t;case c.BRANCH_LEVEL:return AG.level!==AO.level?t:AH===AK?AD:(o(AH)||o(AK))?F:AJ(AK,AH)?M:AJ(AH,AK)?K:t;}break;}return F;}function D(AH,AL,AI,AM,AG){var AK=(AH.fs||[]).filter(function(AN){return(AN.n||AN.fnm)===Y;})[0],AJ=k.ensureArray(AI).map(function(AN){return P(AN,AH);});switch(AL){case c.ELEMENT:if(AJ.length>0){return{et:Z.AE,fn:AG?E.NOT_IN_LIST:E.IN_LIST,a:x(AH),es:AJ};}break;case c.BRANCH:if(AJ.length>0){return{et:Z.AE,fn:E.DESCENDANT,not:AG,a:x(AH),es:AJ};}break;case c.LEVEL:if(AK&&parseInt(AM,10)>=0){return{et:Z.AQ,fn:E.EQUAL,not:AG,a:x(AH),fm:{did:AK.did||AK.fid,n:Y,dtp:Q.mapBaseFormTypeToDataType(AK.bftp)},cs:[R(AM,AH)]};}break;case c.BRANCH_LEVEL:if(AJ.length>0&&parseInt(AM,10)>=0){return{et:Z.AE,fn:E.DESCENDANT,not:AG,a:x(AH),es:AJ,cs:[R(AM,AH),{v:18,dtp:m.INTEGER}]};}break;}return null;}function B(){var AG={};this.selectionList.forEach(function(AI,AH){if(AI.func===c.ELEMENT){AG[AI.itemValue]=AH;var AJ=this.getItemByValue(AI.itemValue);k.forEach(l(AJ),function(AK){AG[AK.v]=AH;});}},this);return AG;}function u(){var AG={};this.selectionList.forEach(function(AI,AH){if(AI.func===c.BRANCH){AG[AI.itemValue]=AH;}});return AG;}function A(){var AG={};this.selectionList.forEach(function(AI,AH){if(AI.func===c.LEVEL){AG[AI.level]=AH;}});return AG;}function j(){var AG={};this.selectionList.forEach(function(AJ,AH){if(AJ.func===c.BRANCH_LEVEL){var AK=AJ.itemValue,AL=AJ.level,AI=AG[AK];if(!AI){AI=AG[AK]={};}AI[AL]=AH;}});return AG;}function W(AI){var AH=u.call(this),AG=n;while(AI&&AI.v){AG=Math.max(AG,AH[AI.v]||n);AI=AI.parent;}return AG;}function q(AI,AK){var AG=j.call(this),AJ=A.call(this),AH=AK?n:W.call(this,AI),AM=AI&&AI.lv||0,AL={};if(!AK){U.forEach(AJ,function(AO,AN){if(AN>=AM&&AO>AH){AL[AN]=AO;}});}while(AI&&AI.v){U.forEach(AG[AI.v],function(AO,AN){if(AN>=AM&&AO>AH){AL[AN]=Math.max(AO,AL[AN]||AH);}});AI=AI.parent;}return AL;}mstrmojo.ui._HierarchyListSelection=mstrmojo.provide("mstrmojo.ui._HierarchyListSelection",{_mixinName:"mstrmojo.ui._HierarchyListSelection",init:function v(AG){this._super(AG);this.clearSelections();},getAllSelection:function I(){return !this.selectionList[n].isNot;},setAllSelection:function g(AG){this.selectionList[n].isNot=!AG;},clearSelections:function h(){this.selectionList=[{func:c.ALL,isNot:!X}];return this.selectionList;},addSelection:function V(AG){var AK=this.selectionList,AI=this.getItemByValue(AG.itemValue),AH={item:AI,ancestorMap:AI&&this.getItemAncestorMap(AI),descendantMap:AI&&this.getItemDescendantMap(AI)},AJ=true;if(!AI&&(AG.func===c.ELEMENT||AG.func===c.BRANCH||AG.func===c.BRANCH_LEVEL)){return ;}AK=this.selectionList=AK.filter(function(AL){var AN=a.call(this,AL,AG,AH),AM=AL.isNot===AG.isNot;if(AN===K||AN===d&&!AM){AJ=!AM;}return !(AN===AD||AN===M);},this);if(AJ){AK.push(AG);}},updateSiblingItemSelection:function p(AH){var AJ=this.selectionList,AG=B.call(this),AI=u.call(this);k.forEach(AH,function(AO){var AL=AO.parent,AK=AL?W.call(this,AL):n,AM=AL?q.call(this,AL):A.call(this),AN=Math.max(AI[AO.v]||n,AK),AP=Math.max(AG[AO.v]||n,AN,AM[AO.lv]||n);AO.isSelected=!AJ[AP].isNot;AO.isBranchSelected=!AJ[AN].isNot;},this);},updateItemSelection:function N(AH){var AP=this.selectionList,AI=B.call(this),AQ=u.call(this),AL=A.call(this),AM=j.call(this),AJ=AH?[AH]:this.getRootItems(),AK=AH?[]:this.getItems().filter(function(AR){return AR&&o(AR);}),AG=AH?W.call(this,AH):n,AO=AH?q.call(this,AH,true):{};(AJ.concat(AK)).forEach(function AN(AV){var AT=AG,AS=U.copy(AO);AG=Math.max(AG,AQ[AV.v]||n);U.forEach(AM[AV.v],function(AY,AX){AO[AX]=Math.max(AY,AO[AX]||n);});var AW=Math.max(AI[AV.v]||n,AL[AV.lv]||n,AG,AO[AV.lv]||n);AV.isSelected=!AP[AW].isNot;AV.isBranchSelected=!AP[AG].isNot;k.forEach(AV.children,function(AX){AN.call(this,AX);},this);var AU=l(AV);if(AU.length>0){var AR=k.find(AU,"isSelected",true)>=0;if(AV.isSelected!==AR){this.addSelection({func:c.ELEMENT,itemValue:AV.v,isNot:!AR});AV.isSelected=AR;}}AG=AT;AO=AS;},this);},updateDescendantsStatus:function AF(){var AL=this.selectionList,AG=this.getMaxLevel(),AJ=u.call(this),AH=j.call(this),AI=n,AM=A.call(this);this.getRootItems().forEach(function AK(AW){var AO=AW.children||[],AS=AW.displayChildren||[],AU=AI,AV=U.copy(AM),AP=false;AI=Math.max(AI,AJ[AW.v]||n);U.forEach(AH[AW.v],function(AY,AX){AM[AX]=Math.max(AY,AM[AX]||n);});AO.forEach(function(AX){if(AK(AX)||!AX.hid&&AX.isSelected){AP=true;}});if(AW.hcd&&AS.length===0){var AQ=!AL[AI].isNot,AT,AN;for(var AR=AW.lv+1;AR<=AG;AR++){AT=AM[AR]||n;AN=AT>AI&&!AL[AT].isNot;if(AN||AQ&&AT<=AI){AP=true;break;}}}AW.hasDsctSelected=AP;AI=AU;AM=AV;return AP;});},getMaxLevel:function b(){var AG=0;this.getItems().forEach(function(AH){var AI=AH.lv;if(AI>AG&&!AH.hid){AG=AI;}});this.selectionList.forEach(function(AH){if(AH.func===c.LEVEL||AH.func===c.BRANCH_LEVEL){AG=Math.max(AG,AH.level);}});return AG;},getLevelSelection:function G(AG){var AK=this.selectionList,AI=AG?q.call(this,AG):A.call(this),AH=AG?AG.isBranchSelected:this.getAllSelection(),AJ={};U.forEach(AI,function(AN,AM){var AL=!AK[AN].isNot;if(AL!==AH){AJ[AM]=AL;}});return U.copy({allLevel:AH,isLevelSelected:function(AL){return this[AL]||this.allLevel&&this[AL]!==false;}},AJ);},buildSelectionExprJSON:function e(AI){var AK=this.getAllSelection(),AH=[],AL=null,AJ={selected:[],unselected:[]},AG=function(AM,AN){if(!U.isEmpty(AN)&&(AM.length>0||AK===AB(AN))){AM.push(AN);}};this.selectionList.forEach(function(AN){var AP=AN.func,AM=AN.isNot,AR=AN.level,AQ=AN.itemValue,AO=AQ?this.getItemByValue(AQ):null;if((AO||{}).fetcher){return ;}if(AN.func===c.ELEMENT&&!o(AO)){AJ[AM?"unselected":"selected"].push(AO);}else{if(AN.func!==c.ALL){AG(AH,D(AI,AP,AO,AR,AM));}}},this);AG(AH,D(AI,c.ELEMENT,AJ.selected));AG(AH,D(AI,c.ELEMENT,AJ.unselected,null,true));if(AH.length>0){AL=AH[0];AH.forEach(function(AP,AM,AO){var AN=AB(AP);if(AM>0){if(AN===AB(AO[AM-1])&&AL.nds){AL.nds.push(AP);}else{AL={et:Z.ANDOR,fn:AN?E.AND:E.OR,nds:[AL,AP]};}}});}if(AL){if(AL.et===Z.ANDOR){AL.node=C.CONDITION;}else{AL={et:Z.ANDOR,fn:E.AND,nds:[AL],node:C.CONDITION};}}return AL;},setSelectionByExprJSON:function r(AI){var AJ=this.clearSelections(),AH=false,AG=this.getItems(),AL=f.getIdPresentation(AG[0]&&AG[0].v),AK=function(AN,AO){if(U.isEmpty(AN)){return ;}if(AN.et===Z.ANDOR){(AN.nds||[]).forEach(function(AP){AK.call(this,AP,AO);},this);}else{var AM=AB(AN);if(!AH){AH=true;this.setAllSelection(AM);}if(AN.et===Z.AQ&&AN.fm&&AN.fm.n===Y){(AN.cs||[]).forEach(function(AQ){var AP=s(AQ.v);if(AP>=0){AO.push({func:c.LEVEL,level:AP,isNot:AM});}});}if(AN.et===Z.AE){(AN.es||[]).forEach(function(AP){var AQ=w(AP.v,AL,AN.a),AR=s(AN.cs&&AN.cs[0].v);if(!this.getItemByValue(AQ)){this.addItems([U.copy({v:AQ,dhid:true},U.clone(AP))],true);}if(AN.fn===E.DESCENDANT){if(AR>=0){AO.push({func:c.BRANCH_LEVEL,itemValue:AQ,level:AR,isNot:AM});}else{AO.push({func:c.BRANCH,itemValue:AQ,isNot:AM});}}else{AO.push({func:c.ELEMENT,itemValue:AQ,isNot:AM});}},this);}}};AK.call(this,AI,AJ);this.updateItemSelection();},setSelectionByList:function L(AH,AG){var AI=[],AJ=false;k.forEach(AH,function(AK){var AL=AK.v;if(AL===AE){AJ=true;return false;}if(!this.getItemByValue(AL)){this.addItems([AK],true);}AI.push({func:c.ELEMENT,itemValue:AL,isNot:!AG});},this);this.clearSelections();if(!AJ){this.setAllSelection(!AG);this.selectionList=this.selectionList.concat(AI);}this.updateItemSelection();},onSelectionChange:function O(AH,AG,AI,AJ){if(AH===c.ALL){this.clearSelections();this.setAllSelection(AG);}else{this.addSelection({func:AH,itemValue:AI&&AI.v,level:AJ,isNot:!AG});}if(this.postSelectionChange){this.postSelectionChange();}},postAddItems:function H(AG){this.updateItemSelection();},postAddSiblingItems:function AA(AH,AG){this.updateSiblingItemSelection(AH);},postAddBranchItems:function z(AH,AG){this.updateItemSelection(AG);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");mstrmojo.requiresDescs(308,5923,7930,5282,5283,2793,2787,2788,12298);var D=mstrmojo.string,S=mstrmojo.expr,M=S.ET,L=mstrmojo.array,R=mstrmojo.hash;var V=S.FN,K=S.BRANCH_FNS[V.NOT],Z=mstrmojo.mstr.EnumDSSXMLObjectTypes,H=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,N=mstrmojo.mstr.EnumDSSConsolidationType;function C(a){return D.htmlAngles(a)||"";}var A={betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),andText:mstrmojo.desc(5282,"AND"),orText:mstrmojo.desc(5283,"OR"),boldandText:"<span style='font-weight:bold;'>"+mstrmojo.desc(5282,"AND")+"</span>",boldorText:"<span style='font-weight:bold;'>"+mstrmojo.desc(5283,"OR")+"</span>",whereText:mstrmojo.desc(2793,"Where (##)"),notText:mstrmojo.desc(12298,"NOT")};var Y={"*":function(b,a){return{html:b?('<span class="mstrmojo-unknown">'+(C(b.n||b.xml)||"...")+"</span>"):null,text:b?(C(b.n||b.xml)||"..."):null};}};function W(a){return !!a.not||a.fn===V.NOT_EQUAL||a.fn===V.NOT_IN_LIST||a.fn===V.NOT_BETWEEN||a.fn===V.NOT;}function I(a){if(a&&a.not){return{html:'<span class="mstrmojo-text mstrmojo-not">'+K+"</span>",text:K+" "};}return{html:"",text:""};}function U(c,b){var a=c&&((b?'<span class="mstrmojo-ListIcon t'+b+'"></span>':"")+'<span class="mstrmojo-text mstrmojo-embedobj">'+C(c)+"</span>");return{html:a,text:c&&((b?b+" ":"")+C(c))};}function Q(a,c){var b=c&&c.trim().split(" ")||[];if(a.t===Z.Attribute&&a.st===H.AttributeRecursive){b.push("recursive");}else{if(a.t===Z.Consolidation&&a.st===H.ConsolidationManaged){b.push("derived");if(a.ndetype===N.DssRecursiveDerivedElement){b.push("recursive");}}}return b.join(" ");}function G(b,a){var c=C(b.n);return{html:'<span class="mstrmojo-text mstrmojo-attr '+Q(b,a)+'">'+c+"</span>",text:c};}Y[M.R]=function(b,a){return U(b.r&&b.r.n,b.r&&b.r.t);};Y[M.F]=function(b,a){return U(b.f&&b.f.n,b.f&&b.f.t);};Y[M.XML]=function(b,a){return U(b.n||b.p&&b.p.n||b.xml,b.p&&b.p.t);};Y[M.AE]=function(q,f){var n=[],m=[],c=(f&&f.elemsEmpty)||"("+mstrmojo.desc(2210,"Empty")+")";if(q&&q.a&&q.a.n){var b=G(q.a);n.push(b.html);m.push("{"+b.text+"}");var a=C(S.fnName(q.et,q.fn,q.fnt));n.push('<span class="mstrmojo-text mstrmojo-fn">'+a+"</span>");m.push(" "+a+" ");var r=q.es,g=r&&r.length||0;if(g){n.push('<span class="mstrmojo-elems">');m.push("[");var j=n.length,p="";for(var o=0;o<g;o++){n[j++]='<span class="mstrmojo-text mstrmojo-elem">';p=C(r[o].n);n[j++]=p;m.push(p);if(o<g-1){n[j++]=", ";m.push(", ");}n[j++]="</span>";}n[j++]="</span>";m.push("]");}else{n.push('<span class="mstrmojo-text mstrmojo-emptyelems">'+c+"</span>");m.push(c);}}return{html:n.join(""),text:m.join("")};};Y[M.AQ]=function(v,x){var s=[],j=[];if(v&&v.a&&v.a.n){var e=G(v.a);s.push(e.html);j.push("{"+e.text+"}");if(v.fm&&v.fm.n){var z=C(v.fm.n);s.push('<span class="mstrmojo-text mstrmojo-form">'+z+"</span>");j.push("("+z+")");if(v.fn!=null){var k=C(S.fnName(v.et,v.fn,v.fnt,v.fm.dtp));s.push('<span class="mstrmojo-text mstrmojo-fn">'+k+"</span>");j.push(" "+k+" ");var l=S.fnCstCount(v.fn,v.fnt);if(v.et===M.AC){if(l>=1){if(v.a2&&v.a2.n){var p=C(v.a2.n);s.push('<span class="mstrmojo-text mstrmojo-attr2">'+p+"</span>");j.push("{"+p+"}");if(v.fm2&&v.fm2.n){var u=C(v.fm2.n);s.push('<span class="mstrmojo-text mstrmojo-form2">'+u+"</span>");j.push("("+u+")");}}if(l>1){s.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");j.push(" "+A.betweenText+" ");if(v.a3&&v.a3.n){var b=C(v.a3.n);s.push('<span class="mstrmojo-text mstrmojo-attr3">'+b+"</span>");j.push("{"+b+"}");if(v.fm3&&v.fm3.n){var c=C(v.fm3.n);s.push('<span class="mstrmojo-text mstrmojo-form3">'+c+"</span>");j.push("("+c+")");}}}}}else{if(v.et===M.AL){var a=v.cs||[],f=[];for(var q=0,r=a.length;q<r;q++){f.push(a[q].v);}var n=f.join(mstrConfig.listSep);s.push('<span class="mstrmojo-text mstrmojo-c1">'+n+"</span>");j.push("["+n+"]");}else{if(l>=1){var a=v.cs,o=a&&a[0];var w=C(o&&o.p&&o.p.n||o&&o.v);s.push('<span class="mstrmojo-text mstrmojo-c1">'+w+"</span>");j.push(w);if(l>1){var m=a&&a[1];s.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");j.push(" "+A.betweenText+" ");var g=C(m&&m.p&&m.p.n||m&&m.v);s.push('<span class="mstrmojo-text mstrmojo-c1">'+g+"</span>");j.push(g);}}}}}}}return{html:s.join(""),text:j.join("")};};Y[M.AC]=Y[M.AQ];Y[M.AL]=Y[M.AQ];Y[M.MQ]=function(x,z){var w=[],n=[],r=x&&x.m,AB=r&&r.n;if(AB){var b=x.fnt,g=S.FNT.PER,v=S.FNT.RANK;AB=b===g?mstrmojo.desc(2787,"Percentage of ##").replace("##",AB):b===v?mstrmojo.desc(2788,"Rank of ##").replace("##",AB):AB;w.push('<span class="mstrmojo-text mstrmojo-metric">'+C(AB)+"</span>");n.push(C(AB));if(x.fn!=null){var o=C(S.fnName(x.et,x.fn,b,S.DTP.REAL));w.push('<span class="mstrmojo-text mstrmojo-fn">'+o+"</span>");n.push(" "+o+" ");var p=S.fnCstCount(x.fn,b);if(x.et==S.ET.MC){if(p>=1){var AA=(x.m2&&x.m2.n)||(x.c2&&x.c2.v)||"?";w.push('<span class="mstrmojo-text mstrmojo-m2">'+C(AA)+"</span>");n.push(C(AA));if(p>1){w.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");n.push(" "+A.betweenText+" ");var e=(x.m3&&x.m3.n)||(x.c3&&x.c3.v)||"?";w.push('<span class="mstrmojo-text mstrmojo-m3">'+C(e)+"</span>");n.push(C(e));}}}else{if(p>=1){var c=x.cs,s=c&&c[0];var a=function(h){var d=h.v;if(x.fnt==g){if(d.replace){h.v=d.replace(/%$/,"");}d=h.v+"%";}return d;};var l=C(s&&s.p&&s.p.n||s&&s.v&&a(s));w.push('<span class="mstrmojo-text mstrmojo-c1">'+l+"</span>");n.push(l);if(p>1){var q=c&&c[1],m=C(q&&q.p&&q.p.n||q&&q.v&&a(q));w.push('<span class="mstrmojo-text mstrmojo-btwn">'+A.betweenText+"</span>");n.push(" "+A.betweenText+" ");w.push('<span class="mstrmojo-text mstrmojo-c2">'+m+"</span>");n.push(m);}}}var t=x.dmy&&x.dmy.uts,k=t&&t.length;if(k){w.push('<span class="mstrmojo-text mstrmojo-at">'+A.atText+"</span>");n.push(" "+A.atText+" ");w.push('<span class="mstrmojo-dmy">');for(var j=0;j<k;j++){var f=t[j];w.push('<span class="mstrmojo-text mstrmojo-dmyunit">');w.push(C(f.utgt?f.utgt.n:f.n));n.push(C(f.utgt?f.utgt.n:f.n));if(j<k-1){w.push(",");n.push(",");}w.push("</span>");}w.push("</span>");}}}return{html:w.join(""),text:n.join("")};};Y[M.MC]=Y[M.MQ];Y[M.ANDOR]=function(l,c){var j=[],g=[],b=(c&&c.elemsEmpty)||"("+mstrmojo.desc(2210,"Empty")+")",e=R.valarray(S.findTargets(l,"did"))[0],f=true;function m(d){if(!f){j.push('<span class="spliter"></span>');g.push(", ");}f=false;if(d){g.push(mstrmojo.desc(12298,"NOT")+" ");}}if(!e){return{html:'<span class="mstrmojo-text mstrmojo-emptyelems">'+b+"</span>",text:b};}var a=G(e,"andor");j.push(a.html);g.push("{"+a.text+"}");j.push("<span>:</span>");g.push(" : ");j.push('<span class="mstrmojo-elems">');g.push("[");L.forEach(l.nds,function k(n){if(!n){return ;}var d=W(n),t=n.fm,q=n.cs,o,r,h,p;switch(n.et){case M.ANDOR:L.forEach(n.nds,k);break;case M.AE:switch(n.fn){case V.IN_LIST:case V.NOT_IN_LIST:L.forEach(n.es,function(u){m(d);o=d?" not":"";r=C(u.n);j.push('<span class="mstrmojo-text mstrmojo-elem single'+o+'">'+r+"</span>");g.push(r);});break;case V.DESCENDANT:var s=(n.es||[]).slice();if(s.length===0){s.push({n:b});}L.forEach(s,function(v){m(d);o=d?" not":"";r=C(v.n);if(q&&q[0]){var u;p=q[0].v;if(isNaN(p)){h=p.substr(p.indexOf(";")+1);}else{h=mstrmojo.desc(493,"Level")+" "+(parseInt(p,10)+1);}u=h+" "+mstrmojo.desc(12853,"of")+" "+r;j.push('<span class="mstrmojo-text mstrmojo-elem level'+o+'">');j.push(u);g.push(u);}else{j.push('<span class="mstrmojo-text mstrmojo-elem descendant'+o+'">');j.push(C(v.n));g.push(r);}j.push("</span>");});break;}break;case M.AQ:L.forEach(n.cs,function(u){m(d);o=d?" not":"";p=u.v;h=(t&&t.n)?C(t.n+" "+p):"";if(t&&t.n==="LEVEL_NUMBER"){o+=" level";if(isNaN(p)){h=p.substr(p.indexOf(";")+1);}else{h=mstrmojo.desc(493,"Level")+" "+(parseInt(p,10)+1);}}j.push('<span class="mstrmojo-text mstrmojo-elem constant'+o+'">'+h+"</span>");g.push(h);});break;}});j.push("</span>");g.push("]");return{html:j.join(""),text:g.join("")};};function O(f,e){var c=Y[f&&f.et]||Y["*"],b=I(f),d=c&&c(f,e),a=e&&e.emptyText||A.emptyText;return{html:b&&b.html+((d&&d.html)||('<span class="mstrmojo-text empty-cond">'+a+"</span>")),text:b&&b.text+((d&&d.text)||a)};}function F(a){return O(a).text;}function J(e,d,b){if(!e){return null;}var o=e.et,l=e.fn,a=e.nds;if(o===M.ANDOR){var p=b?"bold":"";splitter=l===V.AND?A[p+"andText"]:(l===V.OR?A[p+"orText"]:"");a=[].concat(a);if(a.length<1){return null;}var k=[],q;L.forEach(a,function(r){q=J(r,false,b);if(q){k.push(q);}});var n,m=k.length;if(m<1){return null;}else{if(m===1){n=k[0];}else{n=k.join(" "+splitter+" ");}}n=d||e.not?n:"("+n+")";return e.not?A.notText+" "+n:n;}else{if(o===M.RLS){var j=e.dmy&&e.dmy.uts||[],g=[],f;L.forEach(j,function(r){g.push("{"+r.n+"}");});f=g.join(", ");var c=e.nds&&e.nds[0],h=J(c,false,b);if(h){return"("+f+" "+A.whereText.replace(/\(##\)/g,"").replace(/'##'/g,"")+h+")";}return null;}else{return F(e);}}}function B(a){if(mstrmojo.fe.FilterUtils.isExprEmpty(a)){return{et:14,fn:19};}else{((a&&a.nds)||[]).forEach(function(c,b){a.nds[b]=B(c);});return a;}}mstrmojo.fe.FilterUtils=mstrmojo.provide("mstrmojo.fe.FilterUtils",{getExprXml:function(g){var b="<exp>",a="</exp>",e={a:true,a2:true,a3:true,agg:true,cc:true,ce:true,cgp:true,cs:true,conid:true,desc:true,did:true,attId:true,dmt:true,dmy:true,dtp:true,es:true,et:true,expr:true,f:true,flat:true,flt:true,fm:true,fm2:true,fm3:true,fn:true,fnt:true,fres:true,gb:true,isp:true,items:true,m:true,m2:true,m3:true,n:true,nds:true,not:true,pf:true,p:true,r:true,rps:true,st:true,t:true,utgt:true,utp:true,uts:true,v:true,xml:true,relation:true,applySubExpr:true,useSchema:true,guide:true,rsTp:true,joTp:true,paTp:true,erTp:true,exp:true,joAttrs:true,ph:true,idx:true,idc:true,idcsi:true,ucfg:true,node:true},d={getArrItemName:function(h){return h.substr(0,h.length-1);},isSerializable:function(s,q,p){if(s==="xml"){var k=q[p].xml;return{att:'hasXML = "-1"',child:k};}else{if(mstrmojo.array.indexOf(["header_format","grid_format","child_header_format","child_grid_format"],s)>-1){var t=q[p][s];if(!t){return{};}var m="<"+s+">";for(var r in t){m+="<prs n='"+r+"'>";var l=t[r];for(var h in l){var o=l[h];m+="<pr n='"+h+"' v='"+(o==="pru"?"":o)+"'";m+=o==="pru"?' pru="1"':"";m+="/>";}m+="</prs>";}m+="</"+s+">";return{child:m};}else{if(s==="cs"){var j=q[p],n=q[p][s];if(j&&j.fnt&&j.fnt==S.FNT.PER&&n){if(n[0]){n[0].v+="%";}if(n[1]){n[1].v+="%";}}return true;}else{if(s==="c2"||s==="c3"){var j=q[p];if(j&&j.et==S.ET.MC&&(j.fn==S.FN.BETWEEN||j.fn==S.FN.NOT_BETWEEN)){return true;}else{return false;}}}}}return(e[s])?true:false;},skipNull:true},c=B(g);if(!c||c.et!=M.ANDOR||c.fn===V.NOT||c.not){c={et:M.ANDOR,fn:S.FN.AND,nds:c?[c]:[]};}var f=D.json2xml("nd",[{},c],d);return b+f+a;},isExprEmpty:function(a){return(!a||(a.et===M.ANDOR&&(a.nds||[]).length<1));},getExprConditionNodeHtml:function E(a){return O(a).html;},getExprConditionNodeText:function F(a){return O(a).text;},getExprNodeHtmlAndText:function P(b,a){return O(b,a);},getExprText:function X(b,a){return J(b,true,a);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxLayoutConfig");mstrmojo.vi.ui.rw.DocRootBoxLayoutConfig=mstrmojo.declare(mstrmojo.vi.ui.BoxLayoutConfig,null,{scriptClass:"mstrmojo.vi.ui.rw.DocRootBoxLayoutConfig",useDefaultBox:function(A,B){this._super(A,B);this.setVizGalleryOpen(true);},setVizGalleryOpen:function(A){this.box.go=!!A;},isVizGalleryOpen:function(){return !!this.box.go;}});}());(function(){mstrmojo.requiresCls("mstrmojo.StringBuffer","mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo._IsGraphDataService","mstrmojo.func","mstrmojo._ImageHelper","mstrmojo.fe.FilterUtils","mstrmojo.rw.model.RetrievalKeysConfig","mstrmojo.rw.model.UpdateKeysConfig");var e=mstrmojo.hash,B=e.copy,V=mstrmojo.array,AX=mstrmojo.dom,x=mstrmojo.func,AN=[mstrmojo.desc(8445,"Loading")],AE=mstrmojo.fe.FilterUtils.getExprXml,Aq=mstrmojo.array.ensureArray,P=0;function X(BU){BU=BU||{};BU.preserveUndo=true;return BU;}function An(BY,BZ,BU){if(this.blockRequests){throw ("The data service is currently ignoring all requests to the server.");}var BV=P++,BX=this.getTxUpdates(BV);BU=BU||{};BU.src=An.caller.name;if(!mstrmojo.string.isEmpty(BX)){BY.updateChanges=BX;}BY.zoomFactor=this.model.getZoomFactor();var BW=this.cmdMgr;if(!BU.preserveUndo&&BW){BW.onSubmitUpdates();}mstrApp.serverRequest(BY,this.wrapCallback(BZ,BV,BU.preserveStid),BU);}function N(BW,BV,BU){e.copy({unitType:BV.defn&&BV.defn.t,unitKey:BV.k},BW);if(BU.layoutKey){e.copy({toKey:BU.layoutKey,analysisSectionType:BU.analysisSectionType},BW);}else{e.copy({toKey:BU.parentKey},BW);}return BW;}function At(BV){BV=BV||{};if(mstrApp.optimizeFitToPage){var BU=window.mstrMobileApp?this.model.controller.getContentDimensions():mstrApp.getContentDimensions();if(BU){BV.styleName="RWDocumentMobileStyle";BV.availableWidth=BU.w;BV.availableHeight=BU.h;}else{BV.innerWidth=mstrmojo.dom.windowDim().w;BV.innerHeight=mstrmojo.dom.windowDim().h;}}return BV;}function BP(BV){var BU=BV&&BV.style,BW=BU&&BU.params;return BW&&BW.treesToRender;}function C(BU,BV){return{act:"moveUnit",toKey:BU,unitType:BV};}function As(BU){return BU.split("\u001E")[2];}function M(BV,BZ){if(BV!==mstrmojo.DocDataService.UNDO_KEY){return BV;}if(!this.undoSectionKey){var BY=this.undoSectionKey=this.model.getNextKey(),BW=this.undoFGKey=this.model.getNextKey();BZ.addActions({act:"addUndoSection",cbKey:this.cbKey,nodeKey:BY,fgKey:BW});var BX=this;BZ.addCallbacks({failure:function BU(){delete BX.undoSectionKey;}});}return this.undoSectionKey;}function Am(BW,BV){var BU={dsid:BW.dsid,formula:BW.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(BW.tokenStreamXML),name:BW.alias,afb:BW.afb,sfb:BW.sfb};if(BV){BU.Ids=["$GUID_135"];}return this.getAddDerivedMetricToDatasetAction(BU);}function L(BV){var BU="USE_DEFAULT_INDICATOR";BV=BV||{};BV.mptso=BV.mptso||{pru:true};BV.mptsim=BV.mptsim||{pru:true};BV.mptfms=BV.mptfms||"";return{MDXPassThrough:{SolveOrder:BV.mptso.pru?BU:BV.mptso.v,ScopeIsolationMode:BV.mptsim.pru?BU:BV.mptsim.v,FormatString:BV.mptfms}};}function AJ(BU,BV){return{act:"formatDerivedMetric",dsid:BU.dsid||"",mid:(BV||!BU.did)?"$GUID_135":BU.did,format:L(BU.mptf),};}function AM(BX,Ba,BV,Bb,BU,BW){var BY=[this.getNodeKeyFromKeyContext(Ba)];if(!BW){BY=Aq(Bb).concat(BY);}var BZ={act:BX,keyContext:Ba,tgtKey:BV,partialRetrieval:{nodes:BY}};if(!BU){BZ.partialUpdate={selectors:[As(Ba)]};}return BZ;}function n(BW){var BY=false;if(BW===1||BW===2){var BV=this.model,BU=BV.controller,BZ=BU.getRequiredZoomFactor&&BU.getRequiredZoomFactor(BW),BX=BV.getZoomFactor();if(isNaN(BZ)||parseInt(Math.abs((BZ-BX)*100),10)<=2){BY=false;}else{BY=true;}}return BY;}mstrmojo.DocDataService=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsGraphDataService,mstrmojo._ImageHelper],{scriptClass:"mstrmojo.DocDataService",defaultStyle:{params:{treesToRender:2}},cmdMgr:null,stid:-1,blockRequests:false,clientAuto:false,init:function Ak(BU){this._super(BU);this.cmdMgr=this.model.controller&&this.model.controller.cmdMgr;},wrapCallback:function Ad(BZ,BW,BV){var BX=this;return x.wrapMethods({success:function BY(Ba){if(Ba){BX.model.bs=BX.rwb=Ba.bs||BX.rwb;BX.msgId=Ba.mid||BX.msgId;BX.cbKey=Ba.cbKey||BX.cbKey;if(Ba.stid!==undefined&&!BV){BX.stid=Ba.stid;}if(Ba.clientAuto!==undefined){BX.clientAuto=Ba.clientAuto;}if(mstrApp.parseSecondaryDataProviders){mstrApp.parseSecondaryDataProviders(Ba);}}BX.clearTxUpdates(BW);},failure:function BU(){BX.resetTxUpdates(BW);}},BZ);},getNodeKeyFromKeyContext:function Z(BU){return BU.split("\u001E")[1];},refresh:function A0(BW,BX){var BV=!!BW.useRefreshProgress,BU=BV?[mstrmojo.desc(10078,"Refreshing data. Please wait.")]:AN;delete BW.useRefreshProgress;BW=At.call(this,BW);An.call(this,B(BW,{taskId:"docRefresh",rwb:this.rwb,rePrompt:false,fresh:false,regenerate:false,displayNoResErr:true,compress:1}),BX,{showProgress:true,hideProgress:true,progressStateText:BU,useRefreshProgress:BV});},saveRW:function A4(BU,BV){An.call(this,B(BU,{taskId:"saveRW",msgID:this.msgId}),BV);},saveThresholds:function j(BV,BW,BU){An.call(this,B(BV,{taskId:"saveThresholds"}),BW,BU);},getThresholds:function BI(BV,BW,BU){An.call(this,B(BV,{taskId:"getThresholds"}),BW,BU);},browseElements:function AI(BV,BW,BU){An.call(this,B(BV,{taskId:"browseElements",styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30}),BW,BU);},removeUnit:function Y(BV,BW){var BU=B(BV,{act:"removeUnit"});this.submitTemplateUpdates(BU.nodeKey,BU,BW);},removeLayout:function AR(BV,BU,BW){this.submitUpdates({act:"removeLayout",unitKey:BV,isCurrent:BU},BW);},moveLayout:function v(BW,BU,BV){this.submitUpdates(this.getMoveNodeAction(BW,BU,BV),mstrmojo.DocDataService.EMPTY_CALLBACK,mstrmojo.DocDataService.SUPPRESS_DATA);},getMacroCopyNodeAction:function Ao(BV,BU,BX){var BW={act:"macroCopyUnit",newKey:BX,partialRetrieval:this.newRetrievalKeysConfig().addNode(BX)};N(BW,BV,BU);return BW;},getMacroMoveNodeAction:function AD(BV,BU){var BW={act:"macroMoveUnit",partialRetrieval:this.newRetrievalKeysConfig().addNode(BV.k)};N(BW,BV,BU);return BW;},getMoveNodeAction:function r(BY,BU,BV){var BX=BY.defn,BW=BX?BX.t:mstrmojo.EnumRWUnitType.LAYOUT;return this.getMoveNodeActionUsingKey(BY.k,BW,BU,BV);},getMoveNodeActionUsingKey:function A7(BY,BW,BU,BV){var BX=C(BU,BW);BX.unitKey=BY;if(BV!==undefined){BX.index=BV;}return BX;},getMoveControlAction:function d(BX,BV,BU){var BW=C(BV,mstrmojo.EnumRWUnitType.SELECTOR);BW.keyContext=BX;if(BU){BW.partialRetrieval={nodes:Aq(BU)};}return BW;},addMoveControlAction:function I(BX,BW,BV,BU){BX.addActions(this.getMoveControlAction(BW,M.call(this,BV,BX),BU));},getSetCtrlSourceAction:function AK(BV,BX,BU,BW){return{act:"setControlSource",keyContext:BV,unitId:BX,unitType:BU,removeCGB:BW||[],partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BV)),partialUpdate:{selectors:[As(BV)]}};},getRemoveCtrlTargetAction:function G(BW,BV,BX,BU){return AM.call(this,"removeControlTarget",BW,BV,BX,BU);},getClearCtrlTargetAction:function BE(BU){return{act:"clearControlTarget",keyContext:BU};},getAddCtrlTargetAction:function Ay(BY,BV,BZ,Ba,BU,BW){var BX=AM.call(this,"addControlTarget",BY,BV,BZ,BU,BW);BX.isUC=!Ba;return BX;},getAddCtrlTargetDatasetAction:function BB(BV,BU){return{act:"addControlTargetDataset",keyContext:BV,tgtDid:BU};},getRemoveCtrlTargetDatasetAction:function h(BV,BU){return{act:"removeControlTargetDataset",keyContext:BV,tgtDid:BU};},getClearCtrlTargetDatasetAction:function AQ(BU){return{act:"clearControlTargetDataset",keyContext:BU};},getChangeControlElementSource:function BO(BV,BU){return{act:"changeControlElementSource",keyContext:BV,ctlElementSrc:BU};},getSetAttributesJoinTypeAction:function Ah(BU,BV){return{act:"setAttributesJoinType",nodeKey:BU,value:BV,partialRetrieval:this.newRetrievalKeysConfig().addNode(BU)};},getSetMetricJoinTypeAction:function AZ(BW,BY,BU,BV,BX){return{act:"setMetricJoinType",nodeKey:BW,unitId:BY,dataType:BU,unitType:BV,value:BX,partialRetrieval:this.newRetrievalKeysConfig().addNode(BW)};},getTxUpdates:function AW(BV){var BU=this.model;return BU&&BU.getTransactionUpdates&&BU.getTransactionUpdates(BV);},clearTxUpdates:function Al(BV){var BU=this.model;if(BU&&BU.clearTransactionUpdates){BU.clearTransactionUpdates(BV);}},resetTxUpdates:function D(BV){var BU=this.model;if(BU&&BU.resetTransactionUpdates){BU.resetTransactionUpdates(BV);}},loadDocLayout:function K(BY,Ba,BZ){var BX={act:"setCurrentLayout",unitKey:BY.layoutKey,disablePU:true,panelUnitKey:BY.panelKey},BW={style:{params:{treesToRender:3}},params:At.call(this,BY)},BU=this.model,BV=!!BZ;if(!BZ){BZ=BU.getDataService().newUpdateWithoutCmd();}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){BU.applyBufferedSelections(BZ);}BZ.add(BX,Ba,BW);if(!BV){this.submitUpdates(BX,Ba,BW);}},checkMissingCredentials:function z(BU,BV){An.call(this,B(BU,{taskId:"checkMissingCredentials"}),BV);},setCurrentDocLayout:function Av(BW,Ba,BZ){var BY={act:"setCurrentLayout",unitKey:BW},BX={config:{silent:(Ba===null)&&(!!BZ&&Object.keys(BZ.callback||{}).length===0)}},BU=this.model,BV=!!BZ;Ba=Ba||null;if(!BZ){BZ=BU.getDataService().newUpdateWithoutCmd();}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){BU.applyBufferedSelections(BZ);}BZ.add(BY,Ba,BX);if(!BV){BZ.submit();}if(window.mstrMobileApp!==undefined){mstrMobileApp.clearWebViewCache(false);}},fetchDocPage:function BF(BU,BV){An.call(this,{taskId:"fetchDocPage",rwb:this.rwb,pos:BU},BV);},requestPanelChangeDeferred:function BN(Ba,BZ,BU,BV,BX,BY){var BW={act:"setCurrentPanel",unitKey:BZ};if(BU){BW.partialRetrieval={nodes:BU.split(",")};}Ba.add(BW,BY,{config:{showProgress:BX,hideProgress:BX,progressStateText:AN},style:{params:{treesToRender:BV?3:0}}});},getGraphSelectionAction:function E(BY,BU,BW,Bb,Ba,BV){var BZ=this.model.getCurrentLayoutDef(),Bc=(BZ&&BZ.dzf)||1,BX={act:"graphSelector",nodeKey:BY,sliceID:BW,x:Math.round(Bb/Bc),y:Math.round(Ba/Bc)};if(BV){BX.usePartialUpdate="0";}else{BX.partialUpdate={selectors:BU.split("\u001E")};}return BX;},getSelectorElementsAction:function s(BW){var BV={act:"setSelectorElements",keyContext:BW.ck,ctlKey:BW.ctlKey,elemList:mstrmojo.string.decodeHtmlString(BW.eid),isVisualization:!!BW.isDocVis},BU=BW.include;if(BU!==undefined){BV.include=!!BU;}if(BW.tks){BV.tks=BW.tks;}if(BW.disablePU){BV.usePartialUpdate="0";}else{if(BW.ignoreTargetData){BV.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BW.ck));}else{BV.partialUpdate={selectors:BW.ctlKey.split("\u001F")};}}return BV;},getUpdateTransactionAction:function BS(BV){var BU={act:"updateTransaction"};if(BV){if(BV.ctlKey){BU.partialUpdate={selectors:[BV.ctlKey]};}}return BU;},getSelectorFromGMAction:function o(BV){var BU={act:"setSelectorFromGM",keyContext:BV.ck,ctlKey:BV.ctlKey,keepOnly:!!BV.keepOnly,selectorObjects:BV.selectorObjects,isVisualization:!!BV.isDocVis,include:!!BV.include};if(BV.tks){BU.tks=BV.tks;}if(BV.disablePU){BU.usePartialUpdate="0";}else{BU.partialUpdate={selectors:[BV.ctlKey]};}return BU;},getGMViewFilterAction:function AH(BV){var BU={act:"keepOnlyGM",selectorObjects:BV.selectorObjects,isVisualization:!!BV.isDocVis,keepOnly:!!BV.keepOnly};if(BV.tks){BU.tks=BV.tks;}if(BV.disablePU){BU.usePartialUpdate="0";}else{BU.partialUpdate={selectors:[BV.ctlKey]};}return BU;},browseControlElements:function BJ(BY,Bh,BV){var BX=BY.searchPattern,Be=BY.attributeId,Ba=this.model;if(!BX||BX===""){return ;}var Bb={taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:Be,expressionXML:BY.expressionXML||"",dataSourcesXML:BY.dataSourcesXML||"",blockBegin:BY.blockBegin,blockCount:BY.blockCount,searchPattern:BX,rawInput:BX,browseFlags:BY.browseFlags||0,otp:BY.objectType};if(BY.datasetId){B({datasetID:BY.datasetId,messageID:Ba.mid,ctlKey:BY.controlKey},Bb);}var Bg=BY.searchForms;if(Bg){var BW="",BZ="";V.forEach(Bg,function(Bi){BW+=BZ+Bi.did;BZ=";";});Bb.searchForms=BW;if(Ba.isnew||BY.useClientForm){var BU="",Bd="",Bc=V.filterOne(Ba.getDatasetUnits(["att"]),function(Bi){return Bi.did===Be;}),Bf=Bc.fs||[];V.forEach(Bg,function(Bi){var Bj=V.filterOne(Bf,function(Bk){return Bk.fid===Bi.did;});BU+=Bd+Bi.did+":"+(Bj&&Bj.bftp||0);Bd=";";});Bb.clientFormPatterns=BU;}}An.call(this,Bb,Bh,BV);},setMultiDocSelectorElements:function AF(BU,BV,BX){var BW={taskId:"setMultiDocSelectorElements",rwb:this.rwb,multiSelect:BV,selectorObjects:BU};An.call(this,BW,BX,{showWait:true,hideWait:true,delay:true});},setDocSelectorTexts:function U(BZ,Bb,Bd,Ba,Bc,BV,BU,BW,BY){var BX={taskId:"setDocSelectorTexts",rwb:this.rwb,unitKeyContext:BZ,ctlTexts:Bb,ctlKey:Bd,zoomFactor:BV};if(AX.isAndroid||BU){BX.taskId="androidSetDocSelectorElements";}if(Ba!==null&&Ba!==undefined){BX.include=Ba;}if(BW!==null&&BW!==undefined){BX.usePartDisplay=BW;}if(BY!==null&&BY!==undefined){BX.treesToRender=BY;}An.call(this,BX,Bc);},getSelectorExpressionAction:function t(BW){var BV={act:"setSelectorExpression",keyContext:BW.ck,ctlType:BW.type,objId:BW.srcid,objType:BW.srct,expFunction:BW.f,expFunctionType:BW.ft,include:!!BW.include,qt:BW.qt,unset:!!BW.unset};if(BW.disablePU){BV.usePartialUpdate="0";}else{BV.partialUpdate={selectors:[BW.ckey]};if(BW.retrieveCtrlKey){BV.partialRetrieval=this.newRetrievalKeysConfig().addNode(BW.ctlKey);}}if(BW.changeQual){BV.changeQual=BW.changeQual;}var BU=BW.cs;if(BU!==null&&BU!==undefined){BV.expConstants=BU;BV.dataType=BW.dtp;}if(BW.fid){BV.fid=BW.fid;}return BV;},getAttributeSelectorExpressionAction:function Ax(BV){var BU={act:"setAttributeSelectorExpression",keyContext:BV.ck,ctlKey:BV.ctlKey,ctlType:BV.type,expr:BV.expr,partialUpdate:{selectors:[BV.ctlKey]}};if(BV.tks){BU.tks=BV.tks;}return BU;},getMultiUnitSelectorAction:function BL(BU){return{act:"multiUnitSelection",keyContext:BU.ck,include:BU.include!==false,sels:BU.selections,partialUpdate:{selectors:[BU.ctlKey]}};},getRemoveCtrlAction:function Ap(BV,BU){return{act:"removeControl",key:BV,partialUpdate:{selectors:[BV]},partialRetrieval:{nodes:Aq(BU)}};},getAddCtrlAction:function Ag(Bb,BZ,BV,Ba,BW,Bc,BU,BX,Bd){if(isNaN(Bd)){Bd=1;}var BY={act:"addControl",parentKey:Bb,nodeKey:BZ,ctlKey:BV,isUC:!!BW,unitType:Bc||-1,unitId:BU||"",targetKeys:Aq(BX),ctlType:Bd,gpType:Bd,partialRetrieval:{nodes:Aq(Ba)}};if(!BY.isUC){BY.partialUpdate={selectors:[BV]};}return BY;},getReplaceCtrlAction:function S(BW,BZ,BU,BY,BV,BX){return{act:"replaceControl",nodeKey:this.getNodeKeyFromKeyContext(BW),ctlKey:BZ,ctlType:BU,unitId:BY,unitType:BV,partialUpdate:{selectors:[BZ]},partialRetrieval:{nodes:Aq(BX)}};},getSaveGraphPropertiesAction:function m(BU,BV){return{act:"saveGraphProperties",nodeKey:BU,properties:BV};},getSelectorIncludeAction:function A6(BV){var BU=BV.ckey;return{act:"setSelectorInclude",keyContext:BV.ck,ctlKey:BU,ctlType:BV.type,include:BV.include,partialUpdate:{selectors:[BU]}};},getSelectorShowAllAction:function Q(BU){return{act:"setSelectorShowAll",keyContext:BU.ck,ctlKey:BU.ckey,ctlType:BU.type,showAll:BU.showAll,partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BU.ck))};},getUnsetSelectorAction:function g(BX){var BW=BX.ckey,BU=BX.ck,BV={act:"unsetSelector",keyContext:BU,ctlKey:BW,ctlType:BX.type};if(BX.ignoreTargetData){BV.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BU));}else{BV.partialUpdate={selectors:[BW]};}if(BX.retrieveCtrlKey){BV.partialRetrieval=this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BU));BV.partialRetrieval=BV.partialRetrieval.addNode(BW);}return BV;},getRASelectorExpandAction:function q(BV){var BU=BV.ckey;return{act:"raSelectorExpandCollapse",keyContext:BV.ck,ctlKey:BU,ctlType:BV.type,elementId:BV.elementId,isExpand:BV.isExpand,partialRetrieval:this.newRetrievalKeysConfig().addNode(this.getNodeKeyFromKeyContext(BV.ck))};},getChangeFilteringAction:function A2(BU,BX,BW,BV){return{act:"changeFiltering",nodeKey:BU,filterMode:BX,isUC:BW,partialRetrieval:{nodes:(BV?Aq(BV):[])}};},getAddDerivedMetricToDatasetAction:function BA(BU){return{act:"addDerivedMetricToDataset",dsid:BU.dsid,formula:BU.formula,isTokenStream:BU.isTokenStream,name:BU.name,newObjectIds:BU.Ids,afb:BU.afb,sfb:BU.sfb};},getSetMDXPassThroughOptionsForCMAction:function A(BU){var BV={act:"formatDerivedElement",format:L(BU.mptf)};if(BU.cid){BV.cid=BU.cid;}if(BU.ceid){BV.ceid=BU.ceid;}return BV;},getEditDocUnitPropAction:function AC(BU){return{act:"editDocUnitProp",dsid:BU.dsid,formId:BU.formId,unitId:BU.unitId,unitType:BU.unitType,prop:BU.prop,value:BU.value};},getRWGraphImage:function BR(BY,Bc){if(mstrApp.isExpress&&!mstrApp.optimizeFitToPage&&n.call(this,this.model.zt)){return ;}var BX=mstrApp,BU=this.id,BV={taskId:"getRWGraphImage",taskEnv:"xhr",imgType:4,messageID:this.msgId,nodeKey:BY.k,sliceID:parseInt(BY.sid,10),width:parseInt(BY.w,10),height:parseInt(BY.h,10)};if(BY.needCoordinate){BV.needCoordinate=1;}if(BX.onMobileDevice()&&BX.useBinaryFormat){window.setTimeout(function(){An.call(mstrmojo.all[BU],BV,Bc,X());},0);}else{if(BY.encodeImage){BV.taskContentEncoding="base64";delete BV.taskEnv;An.call(this,BV,{success:function Bd(Be){Bc.success(Be);},failure:function BW(Be){(Bc.failure||BX.onerror)(Be);}},X());}else{var Ba=BX.getConfiguration(),BZ=BX.getCurrentProjectId(),Bb=new mstrmojo.StringBuffer();BV.__ts__=new Date().getTime();BV.sessionState=BX.getSessionState(BZ);e.forEach(BV,function(Be,Bf){Bb.append(Bf+"="+encodeURIComponent(Be));});Bc.success(Ba.getTaskUrlByProject(BZ)+"?"+Bb.toString("&"));}}},getImage:function BQ(BV){var BW=mstrApp,BU=BW.getConfiguration();if(BU&&BV&&BV.indexOf("://")===-1){BV=BU.getHostUrlByProject(BW.getCurrentProjectId())+BV;}return(mstrApp.useBinaryFormat)?String(mstrMobileApp.getImage(BV)):BV;},setGridDisplayMode:function u(BW,BV,BX,BU){e.copy(mstrmojo.DocDataService.RAPID_EXEC,BU);this.submitUpdates({act:"setGridDisplayMode",unitKey:BW,displayMode:BV},BX,BU);},setDocZoom:function H(BU,BV){this.submitUpdates(B(BU,{act:"setDocZoom",disablePU:true}),BV,{style:{params:{treesToRender:3}}});},sortGrid:function AO(BU,BV){this.submitTemplateUpdates(BU.nodeKey,B({act:"sort"},BU),BV);},getAdvSortData:function Aj(BU,BV){this.rwExecute(B(BU,{styleName:"RWGridStyle"}),BV);},getFilterExpression:function AT(BW,BV){var BX=BW&&BW.expr,BU=this.model;if(BX&&BU&&BU.getVfexprWithUpdatedVf){BX=BU.getVfexprWithUpdatedVf(BV,BX);}return AE(BX);},saveViewFilter:function Aw(BZ,Ba){var BY=this.msgId,BU=BZ&&BZ.nodeKeys,BX=this,BW=V.map(BU,function(Bb){return{act:"saveViewFilter",messageID:BY,nodeKey:Bb,expr:BX.getFilterExpression(BZ.filterModel,Bb),partialUpdate:{nodes:[Bb]}};}),BV=V.map(BU,function(Bb){return{act:"saveViewFilterLimit",messageID:BY,nodeKey:Bb,limitExp:BZ.limitExp,limitToRemove:BZ.limitMdxToRemove||[]};});this.submitUpdates(BW.concat(BV),Ba);},getViewFilter:function AP(BV,BW){var BU=this.model;if(BU.getViewFilter){BU.getViewFilter(BV,BW);}else{An.call(this,{taskId:BV.taskId,rwb:BV.rwb,msgID:BV.msgID,nodeKey:BV.nodeKey},BW);}},createEmbeddedFilter:function Ar(BW,BZ){var BU=BW.filterId,BX=BW.expJson,BY={act:"createEmbeddedFilter",messageID:this.msgId,expr:BW.expr,filterId:BU,filterName:BW.filterName};var BV=this.model;x.wrapMethods({success:function(){var Ba=BV.defn.efs||[];Ba.push({did:BU,exp:BX});BV.defn.efs=Ba;}},BZ);this.submitUpdates([BY],BZ,{style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.NONE}},params:{suppressData:true}});},rwExecute:function BH(BU,BV){An.call(this,B(BU,{taskId:"RWExecute",rwb:this.rwb,messageID:this.msgId}),BV);},pivot:function p(BU,BV){this.submitTemplateUpdates(BU.nodeKey,{act:"pivot",unitId:BU.unitId,unitType:BU.unitType,attFormId:BU.attFormId,axis:BU.axis,unitPos:BU.unitPos},BV);},resizeXtabColumn:function BD(BU,BV){this.submitUpdates([this.getUpdateTemplateAction(BU.nodeKey,BU),{act:"format",unitType:52,unitKey:BU.nodeKey,formatType:1,format:{FormattingSize:{WidthMode:2}}}],BV);},showTotals:function W(BU,BV){this.submitTemplateUpdates(BU.nodeKey,{act:"showTotals",unitId:BU.unitId,unitType:BU.unitType,subtotalType:BU.subtotalType,clearSubtotalType:BU.clearSubtotalType},BV);},drillGrid:function AL(BU,BV){this.submitUpdates(this.getDrillGridAction(BU),BV,{config:{showProgress:true,hideProgress:true,progressStateText:AN,delay:true}});},getDrillGridAction:function BK(BV){var BU={act:"gridDrillWithin",messageID:this.msgId,nodeKey:BV.nodeKey,sliceId:BV.sliceId,drillPathIndex:BV.drillPathIndex,drillPathKey:BV.drillPathKey,elementList:BV.drillElements,retainParent:BV.retainParent,partialUpdate:{nodes:Aq(BV.updateNodeKey||BV.nodeKey)}};if(BV.x){BU.x=BV.x;BU.y=BV.y;}return BU;},changeDocGroupBy:function O(BW,BX,BU){var BV={act:"changeDocGroupBy",disablePU:true};if(BW.flags){BV.flags=BW.flags;}if(BW.groupbyKey){BV.gbKey=BW.groupbyKey;BV.elemId=BW.elementId;}else{BV.gbUnits=BW.gbUnits;}this.submitUpdates(BV,BX,{config:BU,style:{params:{treesToRender:3}},params:At.call(this,BW)});},setOutlineExpanding:function A3(BW,BX,BU){var BV={act:"updateTemplate",keyContext:BW.unitKey,actions:[{act:"setOutlineExpanding",prs:"Template Formatting",pr:"OutlineLevelExpanding",v:BW.outlineLevel}]};this.submitUpdates(BV,BX,e.copy(mstrmojo.DocDataService.RAPID_EXEC,{config:{silent:true},style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH}}}));},retrieveServerJson:function f(BW,Bg,BX){if(mstrApp.isExpress&&!mstrApp.optimizeFitToPage&&n.call(this,this.model.zt)){return ;}var BZ=this.model,Ba=BZ.controller,Be={},BU,BV,Bc;var Bd=BW.nodes;if(Bd){Be.partialRetrieval=Bd;}var Bf=BW.slices;if(Bf){Be.slices=Bf;}if(BX){BU=BX.style;BV=BX.config;Bc=BX.params;}if(!BV){BV={showProgress:true,hideProgress:true,progressStateText:AN};}var Bh=BW.style=e.clone(this.defaultStyle),Bb=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();B(BU.params,Bh.params);var BY={taskId:"getServerJSONResults",styleName:"ServerJsonRWDStyle",compress:1,rwb:this.rwb,messageID:this.msgId,stateID:-1,excludeData:!!(Bb||mstrConfig.resolveOnly),params:JSON.stringify(Be),treesToRender:Bh.params.treesToRender};B(Bc,BY);BV.preserveUndo=(BX&&BX.preserveUndo)||false;An.call(this,BY,Bg,BV);},downloadGridData:function J(BX,BY){var BW={act:"gridIncrementalFetch",nodeKey:BX.nodeKey,rowPosition:BX.rowPosition,maxRows:BX.maxRows,colPosition:BX.colPosition,sliceId:BX.sliceId,maxColumns:BX.maxColumns,rowMode:BX.rowMode||1,partialRetrieval:this.newRetrievalKeysConfig().addNode(BX.nodeKey)};if(BX.partialUpdate){BW.partialUpdate=BX.partialUpdate;}var BV=mstrmojo.all[BX.xtabId],BU=BV&&BV.isCustomSort;this.submitUpdates(BW,BY,e.copy(X(),{noUpdate:true,preserveStid:BU,config:{silent:true}}));},txMarkRows:function AV(BU,BV){if(mstrApp&&mstrApp.isNativeAndroid){mstrMobileTransport.applyTransactionMarkRow(BU.nodeKey,BU.sliceId,BU.rowOrdinal,BU.actionType);}else{An.call(this,{taskId:"markRow",rwb:this.rwb,nodeKey:BU.nodeKey,sliceId:BU.sliceId,rowOrdinal:BU.rowOrdinal,actionType:BU.actionType},BV);}},txChangeData:function w(BU,BV){if(mstrApp&&mstrApp.isNativeAndroid){mstrMobileTransport.applyTransactionDataChange(BU.nodeKey,BU.sliceId,JSON.stringify(BU.cells),BU.autoRefresh);}else{An.call(this,{taskId:"changeData",rwb:this.rwb,nodeKey:BU.nodeKey,sliceId:BU.sliceId,cells:BU.cells,autoRefresh:BU.autoRefresh},BV);}},sendTransactionActions:function c(BV,BW){var BU={taskId:"DocTransaction",rwb:this.rwb,keyContext:BV.keyContext,actions:BV.actions,messageID:this.msgId};if(BV.txrcd){BU.isPending=BV.txrcd.pending;BU.timestamp=BV.txrcd.timestamp;}An.call(this,BU,BW,{silent:!!BW});},newUpdate:function A9(BW,BV){var BU=new mstrmojo.DocDataService.Update(BV);BU.ds=this;BU.cmd=BW;return BU;},newUpdateWithoutCmd:function l(BV){var BU=new mstrmojo.DocDataService.Update(BV);BU.ds=this;return BU;},newRetrievalKeysConfig:function Af(){return new mstrmojo.rw.model.RetrievalKeysConfig();},newUpdateKeysConfig:function R(){return new mstrmojo.rw.model.UpdateKeysConfig();},submitCmd:function BG(BV,BU){this.newUpdate(BV,BU).submit();},submitUpdates:function Ai(Bd,Bj,Ba){Bd=Aq(Bd);var BZ={actions:Bd},BU,BX,Bg,BW=false;V.forEach(Bd,function Bc(Bl){if(Bl.disablePU){BW=true;delete Bl.disablePU;}V.forEach(Bl.actions,Bc);return !BW;});if(!BW){var BV=mstrmojo.rw.model.RetrievalKeysConfig.getConsolidatedConfig(Bd),Bi=mstrmojo.rw.model.UpdateKeysConfig.getConsolidatedConfig(Bd);if(!e.isEmpty(BV)){BZ.partialRetrieval=BV;}if(!e.isEmpty(Bi)){BZ.partialUpdate=Bi;}}if(Ba){BU=Ba.style;BX=Ba.config;Bg=Ba.params;}if(!BX){BX={showProgress:true,hideProgress:true,progressStateText:AN};}if(!BU){BZ.style=this.defaultStyle;}else{var Bk=BZ.style=e.clone(this.defaultStyle);B(BU.params,Bk.params);}BZ.style.name=(BU&&BU.name)||mstrApp.styleName;var Bb={taskId:"mojoRWManipulation",rwb:this.rwb,messageID:this.msgId,stateID:-1,params:JSON.stringify(BZ)};B(Bg,Bb);BX.preserveUndo=(Ba&&Ba.noUpdate)||false;BX.preserveStid=(Ba&&Ba.preserveStid)||false;var Bf=this,Bh=true,BY=x.override({success:function(Bl,Bm){if(Bl.status===2){Bh=false;Bf.submitUpdates([],Bj,Ba);}else{Bh=true;return this._super(Bl,Bm);}},complete:function(){if(this._super&&Bh){this._super();}}},B(Bj));if(!(Ba&&Ba.hideCancel)){BX.waitBoxCfg=e.copy({showCancel:true},BX.waitBoxCfg);}if(Ba&&Ba.message){BX.waitBoxCfg=e.copy({message:Ba.message},BX.waitBoxCfg);}var Be=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();if(Ba&&Ba.resolveOnly!==undefined){Bb.resolveOnly=Ba.resolveOnly;}else{if(Be){Bb.resolveOnly=true;}}if(Ba&&Ba.excludeData!==undefined){Bb.excludeData=Ba.excludeData;}else{if(Be){Bb.excludeData=true;}}if(Ba&&Ba.noDeltaXML!==undefined){Bb.noDeltaXML=Ba.noDeltaXML;}if(Bb.resolveOnly&&Bb.excludeData){mstrApp.enableUpdate=true;}An.call(this,Bb,BY,BX);},submitTemplateUpdates:function AA(BU,BW,BX,BV){this.submitUpdates(this.getUpdateTemplateAction(BU,BW),BX,BV);},getUpdateTemplateAction:function Ac(BU,BW,BV){return{act:"updateTemplate",keyContext:BU,partialRetrieval:this.newRetrievalKeysConfig().addNode(BU,BV),partialUpdate:{selectors:BW.selectors},actions:Aq(BW)};},addUpdateTemplateAction:function BM(BW,BU,BV){BW.addActions(this.getUpdateTemplateAction(BU,BV));},applySegment:function AS(BV,BU,BW){An.call(this,{taskId:"applySegment",rwb:this.rwb,segmentID:BV,nodeKey:BU},BW);},getPageByTree:function AU(BU){mstrApp.serverRequest({taskId:"getPageByTree",msgID:this.msgId},BU);},getUserDICubeInfo:function a(BU,BV){An.call(this,{taskId:"getUserDICubeInfo",cubeIds:BU.join(",")},BV);},applySorts:function A8(BV,BW,BU,BX){An.call(this,{taskId:"applySorts",key:BV,sortType:BW,sortList:BU},BX,mstrmojo.DocDataService.PROGRESS_CONFIG);},getAddNewDerivedMetricToDatasetSubmitFunc:function A5(BV){var BU=this;return function(BY){var BZ=BU.model,BX=BZ.controller,BW=e.copy(BY,BV),Ba=[Am.call(BU,BW,true)],Bb=BZ.getDatasetsUpdateCallback();if((BW.mptf||{}).dirty||this.enablePTO){Ba.push(AJ(BW));}BX.submitUndoRedoUpdates(Ba,null,Bb,{style:{params:{treesToRender:1}}});};},getAddNewDerivedMetricToXtabSubmitFunc:function Au(BV){var BU=this;return function(BZ){var Ba=BU.model,BY=Ba.controller,BX=e.copy(BZ,BV),BW=BX.idx,Bc=[],Bd=x.wrapMethods(Ba.getDatasetsUpdateCallback(),BY._getXtabCallback(BX.host));Bc.push(Am.call(BU,BX,true));if((BX.mptf||{}).dirty||this.enablePTO){Bc.push(AJ(BX,true));}if(BX.replace){Bc.push(BU.getUpdateTemplateAction(BX.nodeKey,[BX.host.model.getRemoveTemplateUnitAction({did:BX.replace.did,t:BX.replace.t})]));}else{BW++;}var Bb=BU.getUpdateTemplateAction(BX.nodeKey,[BX.host.model.getAddTemplateUnitAction({did:"$GUID_135",t:4},BX.dsid,BX.zoneid,BW),{act:"renameUnit",id:"$GUID_135",type:4,name:BX.alias,isDynamicAlias:false}]);Bc.push(Bb);BY.submitUndoRedoUpdates(Bc,null,Bd);};},getAddNewDerivedMetricToDropzoneSubmitFunc:function AG(BV){var BU=this;return function(Bb){var Bc=BU.model,Bd=Bc.controller,Bf=e.copy(Bb,BV),Bh=Bf.host.zonesModel,Bi=Bf.idx,Ba=[],BW=[],Bg={id:Bf.zoneid},Be={did:"$GUID_135",t:4},Bj=x.wrapMethods(Bc.getDatasetsUpdateCallback(),Bd._getXtabCallback(Bf.host));Ba.push(Am.call(BU,Bf,true));if((Bf.mptf||{}).dirty||this.enablePTO){Ba.push(AJ(Bf));}if(Bf.replace){var BY={did:Bf.replace.did,t:Bf.replace.t};Array.prototype.push.apply(BW,Bh.getRemoveDropZoneUnitActions(Bg,BY));}else{Bi++;}BW.push(Bh.getAddDropZoneUnitAction(Bg,Be,Bi,{datasetId:Bf.dsid}));if(Bf.extraZone){BW.push(Bh.getAddDropZoneUnitAction({id:Bf.extraZone.id},Be,Bf.extraZone.idx,{datasetId:Bf.dsid}));}if(!Bf.replace){var BX=(BV.zoneid===4)?1:2,BZ=Bh.getAddMetricNameAction(BV.host,BX);if(BZ){Ba.push(BZ);}}if(!Bf.replace&&Bh.gmZones){BZ=Bh.gmZones.getUpdateGroupInfoActionForNewMetric(BV.zoneid,Bi,true);if(BZ){Ba.push(BZ);}}Bh.checkAndAddThresholdAction(Bf.zoneid,Be,BW);Ba.push(BU.getUpdateTemplateAction(Bf.nodeKey,BW));Bd.submitUndoRedoUpdates(Ba,null,Bj);};},getEditDerivedMetricSubmitFunc:function k(BV){var BU=this;return function(BY){var Ba=BU.model,BX=Ba.controller,BW=e.copy(BY,BV),BZ=BV.nodeKey,Bb={act:"editDM",formula:BW.tokenStreamXML,isTokenStream:!mstrmojo.string.isEmpty(BW.tokenStreamXML),afb:BV.afb,sfb:BV.sfb,dsid:BW.dsid||"",did:BW.did},Bc=[Ba.addUpdateObjects(Bb,{id:BW.did,type:4,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE})],Bd=x.wrapMethods(Ba.getDatasetsUpdateCallback(),BX.getPartialUpdateCallback());if(mstrApp.isSingleTier&&BV.originTokenStream){Bb.originFormula=BV.originTokenStream;Bb.originAfb=BV.originAfb;Bb.originSfb=BV.originSfb;}if((BW.mptf||{}).dirty){Bc.push(AJ(BW));}if(BZ){Bc.push(BU.getUpdateTemplateAction(BZ,[{act:"renameUnit",id:BW.did,type:4,name:BW.alias,isDynamicAlias:false}]));}else{Bb.name=BW.alias;}BX.submitUndoRedoUpdates(Bc,null,Bd,{style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH}}});};},resetSelections:function BC(BV,BU,BW){An.call(this,{taskId:"resetSelections",rwb:this.rwb,unitKeyContext:BV||"",usePartDisplay:BU?"0":"1",treesToRender:BU?3:2},BW);},setPreference:function F(BU,BV){An.call(this,{taskId:"setPreference",prefs:BU},BV);},getObjectInfo:function Aa(BU,BV){An.call(this,B(BU,{taskId:"getObjectInfo"}),BV,X());},addSuppressData:function Az(BU){if(BP(BU)===mstrmojo.DocDataService.EnumTreesToRender.NONE){e.copy({params:{suppressData:true}},BU);}},uploadImageToServer:function(BW,BX){var BV={taskId:"importImage",imageFieldName:"imageData",isEdit:1,fieldKey:BW.fieldKey,fieldName:BW.fieldName,imageName:encodeURIComponent(BW.imageName),imageSize:BW.imageSize,nodeKey:BW.nodeKey,sectionKey:BW.sectionKey,msgID:this.msgId||""};if(mstrApp.isSingleTier){var BU=";base64,";BV.rwNodeKey=BW.fieldGroupKey;BV.imageData=BW.base64Str.split(BU)[1]||BW.base64Str;mstrApp.serverRequest(BV,BX);}else{BV.imageData=BW.imageData;mstrmojo.xhr.upload("POST",mstrConfig.taskURL,BX,BV);}}});mstrmojo.DocDataService.Update=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.DocDataService.Update",actions:null,callback:null,extras:null,init:function Ak(BU){B(BU,this);this.actions=this.actions||[];this.callback=this.callback||{};this.extras=this.extras||{};},addActions:function Ae(BU){this.actions=this.actions.concat(Aq(BU));},addCallbacks:function A1(BU){this.callback=x.wrapMethods(this.callback,BU);},addExtras:function AY(BV){var BU=BP(BV),BW=BP(this.extras);this.extras=B(BV,this.extras);if(BU!==undefined&&BW!==undefined){this.extras.style.params.treesToRender|=BW;}},addUpdate:function Ab(BU){this.add(BU.actions,BU.callback,BU.extras);},setTreesToRender:function BT(BU){if(BU){this.addExtras({style:{params:{treesToRender:BU}}});}return this.extras.style.params.treesToRender;},add:function b(BV,BW,BU){if(BV){this.addActions(BV);}if(BW){this.addCallbacks(BW);}if(BU){this.addExtras(BU);}},submit:function AB(){var BV=this.actions,BW=this.callback,BU=this.extras;if(this.cmd){this.cmd.submit(BV,BW,BU);}else{this.ds.submitUpdates(BV,BW,BU);}}});mstrmojo.DocDataService.PUInfoType=null;mstrmojo.DocDataService.ExtrasType=null;mstrmojo.DocDataService.PROGRESS_CONFIG={showProgress:true,hideProgress:true,progressStateText:AN,delay:true};mstrmojo.DocDataService.UNDO_KEY="undo";mstrmojo.DocDataService.REQUEST_DEFN_DATA={style:{params:{treesToRender:3}}};mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION={style:{params:{treesToRender:1}}};mstrmojo.DocDataService.REQUEST_ONLY_DATASETS={style:{params:{treesToRender:0}}};mstrmojo.DocDataService.SUPPRESS_DATA={params:{suppressData:true}};mstrmojo.DocDataService.RAPID_EXEC={params:{suppressData:true,rapidExec:true}};mstrmojo.DocDataService.EMPTY_CALLBACK={success:mstrmojo.emptyFn};mstrmojo.DocDataService.CopyMoveDestinationType=null;mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS={FORMAT_CHANGE:1,DATA_CHANGE:2};mstrmojo.DocDataService.EnumTreesToRender={NONE:0,DEFN:1,DATA:2,BOTH:3};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.func","mstrmojo.css","mstrmojo.UUID","mstrmojo.fe.FilterUtils","mstrmojo.desc");var Q=mstrmojo.func,L=mstrmojo.hash,J=mstrmojo.array,N=mstrmojo.expr,U=mstrmojo.css,R=N.DTP,F=mstrmojo.UUID,V=mstrmojo.fe.FilterUtils,U=mstrmojo.css;var H=16,E=32;function O(a,Z,c){var X=L.copyProps(["did","t","st","n"],a),Y=(a.fs||[]).filter(function(d){return d.fnm==="LEVEL_NUMBER"||d.n==="LEVEL_NUMBER";})[0],b;if(Z){b={et:N.ET.AE,fn:N.FN.DESCENDANT,a:X,es:[{v:Z.v,n:Z.n}]};if(parseInt(c,10)>=Z.lv){b.cs=[{v:c-Z.lv,dtp:R.INTEGER},{v:2,dtp:R.INTEGER}];}}else{if(parseInt(c,10)>=0&&Y){b={et:N.ET.AQ,fn:N.FN.EQUAL,a:X,fm:{did:Y.did||Y.fid,n:Y.n||Y.fnm,dtp:R.INTEGER},cs:[{v:c,dtp:R.INTEGER}]};}}return b?V.getExprXml(b):"";}mstrmojo.ui._IsIncFetchHierarchyList=mstrmojo.provide("mstrmojo.ui._IsIncFetchHierarchyList",{_mixinName:"mstrmojo.ui._IsIncFetchHierarchyList",blockCount:500,getDataHelper:mstrmojo.emptyFn,getAttribute:mstrmojo.emptyFn,isHiearachyDisplay:mstrmojo.emptyFn,getItemMarkup:function C(Z,X){var Y;if(Z.fetcher){Y='<{@tag} class="item fetcher {@cls}" idx="{@idx}" style="{@style}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="text">{@en@n}</span></{@tag}>';}else{Y=this._super(Z,X);}return Y;},isFetcher:function K(X){if(X instanceof HTMLElement){X=this.getItemFromTarget(X);}return X&&X.fetcher;},fetchItems:function I(X,Y){this._super(X,Q.wrapMethods(this.getFetchItemsCallback(X),Y));},fetchItemsThroughTaskCall:function P(b,g){var a=this.getDataHelper(),Z=this.getAttribute();if(a&&Z&&!this.isFetching){this.set("isFetching",true);var d=this,e=b.branch,X=parseInt(b.level,10),c=b.blockBegin||1,f=b.blockCount||this.blockCount,Y=b.browseFlags||0;a.set("browseConfig",L.copy({blockBegin:c,blockCount:f,browseFlags:Y,expressionXML:(e||X>=0)?O(Z,e,X):"",otp:Z.t,compress:1},L.copy(a.browseConfig)));a.getItems(c,Q.wrapMethods({success:function(h){if(h){L.copy({bb:c,bc:f},h);J.forEach(h.es,function(j){if(!j.pid&&j.pi>-1){j.pid=h.es[j.pi].v;delete j.pi;}L.copy({lv:j.lv||0,hcd:!!j.hcd,hid:!!j.hid,dhid:!!j.hid,pid:j.pid||""},j);});}}},g,{complete:function(h){d.set("isFetching",false);}}),{hideFailureErr:g.failure});}},getFlatDisplayItems:function B(X){return X.filter(function(Y){var Z=Y.fhid;delete Y.fhid;return !Z;});},getFetchItemsCallback:function M(a){var Z=this,Y=a.branch,b=parseInt(a.level,10),X=this.isHiearachyDisplay();return{success:function(c){if(c&&c.es){var e=c.es,d=c.bb+c.bc-1;if(c.sz>d&&!c.raad){e.push({v:"fetcher"+F.create(),n:mstrmojo.desc(1005,"More..."),fetcher:true,lv:X?(b>=0?b:(Y?Y.lv+1:0)):-1,config:L.copy({blockBegin:d+1},L.copy(a))});}if(!X){e.forEach(function(g){var h=g.hid,f=Z.getItemByValue(g.v);delete g.epd;delete g.hid;if(f){delete g.hcd;}L.copy({fhid:h,dhid:!f||f.dhid},g);});}if(Z.setDisplayParent){Z.setDisplayParent(e,null,true);}}}};},getMaxLevel:function A(){var X=this.getAttribute(),Y=(X&&X.lvfs||[]).length;if(Y>0){return Y-1;}return this._super?this._super():0;},getLevels:function D(){var X=this.getAttribute(),Y=X&&X.lvfs||[];return Y.map(function(a,Z){return{v:Z,n:a.lvfn};});},initElements:function S(c){if(this.isHiearachyDisplay()){delete this.displayRoots;var Z=this.getItems(),Y=Z.length,b,X;if(Y>0){if(this.raad){for(var a=Y-1;a>-1;a--){b=Z[a];if(b.fetcher&&b.fake){b.hid=true;X=J.find(b.parent&&b.parent.children,"idx",b.idx);if(X>-1){b.parent.children.splice(X,1);}X=J.find(b.displayParent&&b.displayParent.displayChildren,"idx",b.idx);if(X>-1){b.displayParent.displayChildren.splice(X,1);}}}}this.refresh();}else{this.fetchItems({browseFlags:E},c);}}else{this.clearItemsNode();this.fetchItems({blockCount:500,browseFlags:H},c);}},clearItemsNode:function G(){var X=this.itemsContainerNode;if(X){X.innerText="";this.updateScrollbars();}},onclick:function W(h){var e=h.getTarget(),Y=this.getItemNodeFromTarget(e),j=this.getItemFromTarget(e);if(j&&j.fetcher){if(U.hasClass(e,"text")){if(j.fake){var d=function(k){if(k.displayParent){if(!k.displayParent.hid){return k.displayParent;}else{return d(k.displayParent);}}},b=d(j),a=b?b.displayChildren:this.getDisplayRoots(),f=this.items,X=j.config.nextSiblingIdx,c=this.blockCount,Z=X+c,g;if(a.length-1>Z){g=a.slice(X,Z);j.config.nextSiblingIdx+=c;j.lv=g[g.length-1].lv;g.push(j);}else{a.pop();if(j.parent){j.parent.children.pop();}f.splice(J.find(f,"idx",j.idx),1);g=a.slice(X,a.length);}Y.outerHTML=this._buildSiblingsMarkup(g).join("");this.updateScrollbars();}else{this.fetchItems(j.config,{success:function(k){j.hid=true;Y.outerHTML="";}});}}h.cancel();}else{this._super(h);}},});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.desc","mstrmojo.dom","mstrmojo.hash","mstrmojo.MetricSelectorUtility","mstrmojo.mstr.EnumDataType","mstrmojo._FormatDefinition","mstrmojo.num","mstrmojo.array");var M=mstrmojo.MetricSelectorUtility,I=mstrmojo.mstr.EnumDataType,V=mstrmojo._FormatDefinition.NumberFormatCategory,B=M.FN,Q=M.Q,C=M.OP,X=mstrmojo.num,H=Math.max,D=Math.min,A=Math.round;mstrmojo.vi.ui.rw.selectors.ISliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.ISliderHelper",initAsStaticStatus:function K(){var Y=this.slider;Y.staticStatus=Y.disableDrag=this.isStatic();if(Y.staticStatus){Y.da.low=1;Y.da.high=7;Y.ft=M._GENERIC;Y.f=B.BETWEEN;Y.cs=[{n:"",v:1},{n:"",v:7}];Y.numFmts={cat:9,dp:0,fm:""};}if(this.displayInvalid()){Y.f=B.BETWEEN;Y.cs=[];}},initialSlider:function W(){this.initAsStaticStatus();this.createDataRangeItems();this.updateCurrentSelectionFromModel();},createDataRangeItems:function L(){var a=this.slider,j=this.fixDigitByNumFormat,b=this.notNull,c=a.numFmts,k=a.qua,Z=a.da.cnt,Y,f;switch(k){case Q._G:Y=j(a.da.low,c);f=j(a.da.high,c);a.step=this.getValueStep(Y,f);break;case Q._RB:case Q._RT:Y=Z?1:0;f=Z;a.step=this.getValueStep(Y,f);break;case Q._PB:case Q._PT:Y=0;f=100;a.step=this.getValueStep(Y,f);break;}var e=this.isEmpty();a.set("lowText",e?"":this.formatNumber(Y));a.set("highText",e?"":this.formatNumber(f));a.low=Y;a.high=f;var h=[],g,d;if(b(Y,f)){if(Y+a.step<=Y){a.set("validation",{refNode:a.docSelector.parent.domNode,position:1,invalid:true,errorCode:"bigDecimalMetricSliderVIWaring"});}else{for(d=Y;d<=f;d+=a.step){h.push(this.getItem(k,d,c));}g=h.length;if(g>0){h[g-1]=this.getItem(k,f,c);}}}a.items=h;a.unit=this.getUnit();},getItem:function O(Z,b,Y){var a=this.fixDigitByNumFormat(b,Y),c=(Z===Q._RB||Z===Q._RT)?String(parseInt(a,10)):M.formatNumber(Z,b,Y);return{n:c,v:a};},getValueStep:function G(a,b){var Z=this.slider,Y=Z._effectiveLength;return this.fixDigitByNumFormat(b-a,Z.numFmts)/(Y-2)||1;},getIdxByValue:function J(Z){var Y=this.slider;return D(H(A((Z-Y.low)/Y.step),0),Y.items.length-1);},isStatic:function P(){var Y=this.slider;return !this.notNull(Y.da,Y.da.low,Y.da.high,Y.da.cnt,Y.qua);},isEmpty:function R(){var Y=this.slider;return this.isStatic()||!!Y.da.nov;},displayInvalid:function F(){var Y=this.slider;var c=parseInt(Y.ft,10),a=parseInt(Y.f,10),b,Z;if(c===M._GENERIC){b=a===B.ISNULL||a===B.ISNOTNULL||a===B.NOTIN||a===B.IN;}else{if(c===M._PERCENT||c===M._RANK){Z=a===M.MRPFN.INASCENDING||a===M.MRPFN.INDESCENDING||a===M.MRPFN.NOTINDESCENDING||a===M.MRPFN.NOTINASCENDING;}}return !!b||!!Z;},fixDigitByNumFormat:function E(Z,d){var b=parseInt(d.cat,10),Y=(b===V.Custom&&d.fm&&d.fm.indexOf("%")>=0),a=Y?2:d.dp,c=(b===V.Percentage||b===V.General||Y)?2:(b===V.Fraction)?4:0;return Number(Number(Z).toFixed(Math.min(a+c,20)));},formatNumber:function N(d){var a=this.slider,j=Math.abs(d),g=a.numFmts.cat,Z=1000,k=["K","M","B","T","P","E","Z","Y"],e=k.length,c;if(j>=Z&&(g===V.Default||g===V.Fixed||g===V.General||g===V.Currency)){for(c=0;c<e;c++,Z*=1000){if(j<Z*1000){var Y=j/Z,b=(Y*10).toFixed(0)%10>0?1:0,f=X.toLocaleString(Y.toFixed(b))+k[c];var h=M.formatNumber(a.qua,d<0?-1:1,a.numFmts);return h.replace(new RegExp("["+X.getDecimal()+"]0+","g"),"").replace("1",f);}}}return M.formatNumber(a.qua,d,a.numFmts);},updateCurrentSelectionFromModel:function S(){var a=this.slider,b=this.notNull,k=a.cs,j=a.f,g=a.ft,Y=a.low,h=a.high,m=a.qua,d=a.numFmts,e=(k&&k.length>0)?X.parseNumeric(X.toLocaleString(k[0].v).replace("%","")):m?h:Y,c=(k&&k.length>1)?X.parseNumeric(X.toLocaleString(k[1].v).replace("%","")):h,Z=a.include=a.parent.include,l;if(a.dt===I.DataTypeTimeStamp){d.fm=d.fm.replace(/\\/g,"");}if(m===Q._PT||m===Q._PB){e=(k&&k.length>0&&!String(k[0].v).match("%"))?e*100:e;}a.frtUst=e<Y;a.ndUst=c>h;a.unSet=!k||k.length===0;if(b(j,g)){l=M.getOpIdxByfunc(j,g);}else{if(Z){l=m?C._LESS_EQUAL:C._BETWEEN;}else{l=m?C._GREATER:C._NOT_BETWEEN;}}a.opId=l;switch(l){case C._EQUALS:case C._NOT_EQUALS:a.cs1Vl=a.cs2Vl=e;break;case C._LESS_EQUAL:case C._GREATER:a.cs1Vl=Y;a.cs2Vl=e;break;case C._GREATER_EQUAL:case C._LESS:a.cs1Vl=e;a.cs2Vl=h;break;case C._IN:case C._NOT_IN:case C._IS_NULL:case C._IS_NOT_NULL:break;default:a.cs1Vl=e;a.cs2Vl=c;break;}a.cs1Idx=this.getIdxByValue(a.cs1Vl);a.cs2Idx=this.getIdxByValue(a.cs2Vl);a.cs1Nm=b(a.cs1Vl)?M.formatNumber(m,a.cs1Vl,d):a.items[a.cs1Idx].n;a.cs2Nm=b(a.cs2Vl)?M.formatNumber(m,a.cs2Vl,d):a.items[a.cs2Idx].n;if(m){a.rankon.selectItemByField("v",m);}},updateSelection:function U(){var Z=this.slider,b=Z.cs1Vl,a=Z.cs2Vl,Y=parseInt(Z.qua,10),c=Z.numFmts;Z.cs1Idx=this.getIdxByValue(b);Z.cs2Idx=this.getIdxByValue(a);Z.cs1Nm=M.formatNumber(Y,b,c);Z.cs2Nm=M.formatNumber(Y,a,c);Z.unSet=false;this.updateOpCs();Z.parent.node.data.cs=Z.cs;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var D=1,B="mstrmojo-itemwrap";mstrmojo.ListMapperHoriz=mstrmojo.provide("mstrmojo.ListMapperHoriz",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table" cellspacing="0" cellpadding="0"><tbody><tr>',markupSuffix:"</tr></tbody></table>",itemWrapperPrefix:function(H){return'<td class="'+this.getWrapperCss(H)+'">';},getWrapperCss:function(H){return"mstrmojo-itemwrap-td";},itemWrapperPrefill:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",itemWrapperSuffix:"</td>",wrapperNodes:function G(H){return this.wrapperParentNode(H).cells;},wrapperParentNode:function F(H){return H.firstChild.rows[0];},createWrapperNode:function E(H){var I=H.ownerDocument,J=I.createElement("td");return J;},findScrollRange:function C(V,L,S,Y,I,P,Z,X){var Q=this.wrapperNodes(V),R=parseInt(L/2,10),K=parseInt(Math.log(L)/Math.log(2),10),J=0,H=L-1,U=I+P,M=Q[0].offsetLeft,O;for(var W=1;W<=K;W++){O=Q[R].offsetLeft-M+Z;if(O<=I){J=R;}else{if(O>=U){H=R;}}var N=Math.round(L/Math.pow(2,W+1));R+=(O>I)?-N:N;R=Math.min(Math.max(0,R),L-1);}return{start:J,end:H};},findIndex:function A(I,M,K){if(M&&K){var H=I.domNode,L=this.wrapperParentNode(M),J=K.parentNode;while(J){if(J===L){return mstrmojo.array.findBin(this.wrapperNodes(M),K,"offsetLeft",I.items&&I.items.length);}else{if(J===H){break;}}K=J;J=K.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.css","mstrmojo.vi.ui.rw._IsMultiselectXtab");var Z=mstrmojo.dom,c=mstrmojo.css;function N(){var e=this._outlineRenderTimer;if(e){self.clearInterval(e);delete this._outlineRenderTimer;this.renderingRows=false;}}function P(e,k,n,g,j,h,m){var l=this,f=this.id;this.renderingRows=true;this._outlineRenderTimer=self.setInterval(function(){try{if(!e){return ;}var o=[],q=e.pageStatus[k],s=0,r=e.rowsPerPage;if(!q||!q.filled){o.push({idx:k,fill:true});}if(o.length>0){e.preRenderPages();e.renderPages(o);e.postRenderPages();e._postPagesClearup=true;}else{if(e._postPagesClearup){e.postRenderPagesCleanup();e.configureActions();e._postPagesClearup=false;}N.call(l);if(e.isRenderingComplete()){e.postRenderingCleanup();}if(h){k++;if(e.pageStatus[k]){P.call(l,e,k,n,g,j,h);}else{V.call(l);l.domNode.style.visibility="visible";}}else{if(m){X.call(l,n,g,j,m);}else{C.call(l,n,g,j,m);}}}}catch(p){N.call(l);throw p;}},e.renderPause);}function b(){var g=this.scrollboxNode;if(!this.heightLimit){g.style.height=g.firstChild.offsetHeight+(g.offsetHeight-g.clientHeight)+"px";}var f=this.xtabClonedNodes,e;for(e in f){f[e].refreshNode();}this._adjustClipSize();this.alignLockNodes(this.scrollboxLeft,this.scrollboxTop);}function G(){var e=this.getTargetZone();if(e&&e.onscroll){e.onscroll();}}function V(){c.removeClass(this.domNode,"outlineBusyCursor");var e=this.scrollboxNode;if(!this.heightLimit){e.style.height=e.firstChild.offsetHeight+(e.offsetHeight-e.clientHeight)+"px";this.refreshResizeHandlers();}if(!this.widthLimit){this.scrollboxNode.firstChild.style.position="relative";this.onGridWidthChanged();}if(this.scrollboxHeightFixed){b.call(this);this._refreshClonedNodes();}this.refreshResizeHandlers();G.call(this);this.updateScrollbars&&this.updateScrollbars();}function D(f,e){if(!f){return ;}if(e){f.className="icon-outline-span outline-expand";f.setAttribute("collapsed",true);}else{f.className="icon-outline-span outline-collapse";f.setAttribute("collapsed",false);}}function Y(){if(this.allPagesLoaded){return true;}var g=0,k=this.children[0].pageStatus,e=k.length;for(g=0;g<e;g++){if(!k[g].filled){return false;}}this.allPagesLoaded=true;var n=this.getTargetZone().tableNode,m=n.rows,l=this.gridData.maxLevel,h,j,f;e=m.length;Q.call(this,l,true);for(g=0;g<e;g++){f=m[g].getElementsByClassName("icon-outline-span")[0];j=(f&&parseInt(f.getAttribute("dpt"),10))||0;if(j>0){j=parseInt(f.getAttribute("dpt"),10);h="depth"+(j-1);this.maxIndividualCollapseCount[h]+=1;if(f.getAttribute("collapsed")==="true"){this.individualCollapseCount[h]+=1;}}}return true;}function L(e){e.setAttribute("collapsed","true");e.className="icon-outline-span outline-expand";}function C(o,h,m,n){var q=o.rows,k=q.length,e=this.getTargetZone(),p,l,g,f=0,j=true;for(g=m+1;g<k;g++){p=q[g];l=parseInt(p.getAttribute("level"),10);if(isNaN(l)){f=parseInt(p.parentElement.getAttribute("n")||1,10);if((m===g-1)&&e.pageStatus[f].filled===true){g++;}break;}if(l<=h){f=parseInt(p.parentElement.getAttribute("n")||0,10)+1;if(f<e.totalPages&&e.pageStatus[f].filled){j=false;}delete this.outlineState.collapseToLevel;break;}}if(g===k){f=parseInt(q[k-1].parentElement.getAttribute("n")||0,10)+1;if(f<e.totalPages&&e.pageStatus[f].filled===true){f++;}}if(j&&f<e.totalPages){P.call(this,e,f,o,h,g-1,false,n);}else{M.call(this,o,h,this.startCollapseRowIndex||m,n);if(this.isAutoTableLayout()){b.call(this);}delete this.startCollapseRowIndex;delete this.outlineState.collapseToLevel;}}function X(o,h,m,n){var q=o.rows,k=q.length,e=this.getTargetZone(),p,l,g,f=e.pageStatus.length,j=true;for(g=m+1;g<k;g++){p=q[g];l=parseInt(p.getAttribute("level"),10);if(isNaN(l)){f=parseInt(p.parentElement.getAttribute("n")||1,10);if(e.pageStatus[f].filled===true){e.pageStatus[f].filled=false;g++;}break;}if(l<=h){f=parseInt(p.parentElement.getAttribute("n")||0,10)+1;if(f<e.totalPages&&e.pageStatus[f].filled){j=false;}delete this.outlineState.collapseToLevel;break;}}if(j&&f<e.totalPages){P.call(this,e,f,o,h,g-1,false,n);}else{M.call(this,o,h,this.startCollapseRowIndex||m,n);if(this.isAutoTableLayout()){b.call(this);}delete this.startCollapseRowIndex;delete this.outlineState.collapseToLevel;}}function M(AB,h,n,f){var AC=this,r=AB.rows,z=r.length,o,g,k,v,u,q="outlineMode "+(f?"":" hiddenRow"),AA=AC.getStickedTableNodes(),e=AC.children[0],t=this.outlineState,x,l,p=e.rowsPerPage;for(v=n+1;v<z;v++){o=r[v];k=parseInt(o.getAttribute("level"),10);if(k<=h){break;}if(f&&k>h+1){continue;}o.className=q;l=o.getAttribute("ei");x=o.getElementsByClassName("icon-outline-span")[0];if(!f){t[l]={expanded:false,hidden:true};if(x&&x.getAttribute("collapsed")!=="true"){AC.individualCollapseCount["depth"+(k-1)]+=1;L(x);}}else{t[l]={expanded:false,hidden:false};}for(u=0;u<AA.length;u++){g=AA[u].rows[v];if(g){g.className=q;if(!f){x=g.getElementsByClassName("icon-outline-span")[0];if(x){L(x);}}}}}V.call(AC);var m="depth"+(h-1);if(Y.call(AC)){if(AC.individualCollapseCount[m]===0){S.call(AC,h+1,true);}else{if(!f&&this.maxIndividualCollapseCount[m]===this.individualCollapseCount[m]){R.call(AC,h);}}}var s=mstrmojo.findAncestor(this,"adjustAutoWidth",null,mstrmojo.grid);if(s){s.adjustAutoWidth(this);}}function S(j,f){if(!this.gridData.gts.show){return ;}var h=this.getTargetZone().tableNode,k=this.getStickedTableNodes(),e=j-1,l,g;k.push(h);mstrmojo.array.forEach(k,function(m){var n=m.rows[0].getElementsByClassName("icon-outline-span");for(g=0;g<n.length;g++){l=n[g];if(g<e){l.setAttribute("collapsed",0);c.removeClass(l,"outline-expand");c.addClass(l,"outline-collapse");}else{if(!f){l.setAttribute("collapsed",1);c.removeClass(l,"outline-collapse");c.addClass(l,"outline-expand");}}}});}function R(f){if(f===this.gridData.maxLevel){return ;}var e="depth"+(f-1);if(this.individualCollapseCount[e]===this.maxIndividualCollapseCount[e]){S.call(this,f);}else{R.call(this,f+1);}}function Q(k,f){var h=this.gridData,e=h.maxLevel||(h.gts&&h.gts.row&&h.gts.row.length)||0,j,g;for(g=0;g<e;g++){j="depth"+g;if(f){this.maxIndividualCollapseCount[j]=0;}if(g>=k){this.individualCollapseCount[j]=this.maxIndividualCollapseCount[j];}else{this.individualCollapseCount[j]=0;}}}function J(){var f=this.gridData,e=f.gts.show?1:0;if(f.gts.col&&f.gts.col.length>1){e=f.gts.col.length;}return e;}function U(){this.outlineState={};if(mstrApp.outlineStates[this.id]){delete mstrApp.outlineStates[this.id];}}function O(){this.retainOutlineState=true;if(!mstrApp.outlineStates[this.id]){mstrApp.outlineStates[this.id]=this.outlineState;}}mstrmojo.vi.ui.rw._IsOutlineXtab=mstrmojo.provide("mstrmojo.vi.ui.rw._IsOutlineXtab",{_mixinName:"mstrmojo.vi.ui.rw._IsOutlineXtab",onclick:function d(q){var n=this,m=q.getTarget&&q.getTarget(),k=m&&Z.findAncestorByName(m,"td",true,this.viewport),g=k&&Z.findAncestorByName(m,"span",true,k),l=g&&parseInt(g.getAttribute("expandTo"),10);if(g&&(g.getAttribute("sty")==="outimg"||l>=1)){var r=k.parentElement;if(g&&!q.shiftKey&&!q.ctrlKey){var s=this.getTargetZone().tableNode;if(this.renderingRows){return ;}if(l>=1){U.call(this);this.scrollboxNode.scrollTop=0;var o=this.gridData,e=n.model.getDataService(),j=parseInt(g.getAttribute("collapsed"),10)||0;l+=j?1:0;S.call(this,l);o.lvlepd=l=l<o.maxLevel?l:-1;e.setOutlineExpanding({unitKey:n.node.k||n.node.data.k,outlineLevel:l});window.setTimeout(function(){n.refresh();},10);}else{if(g.getAttribute("sty")==="outimg"){c.addClass(this.domNode,"outlineBusyCursor");var h=parseInt(g.getAttribute("dpt"),10),p=m.getAttribute("collapsed")==="true",f=r.getAttribute("ei");this.outlineState[f]={expanded:p,hidden:false};if(p){m.className="icon-outline-span outline-collapse";m.setAttribute("collapsed","false");this.individualCollapseCount["depth"+(h-1)]-=1;window.setTimeout(function(){n.outlineState.isExpanding=true;n.outlineState.collapseToLevel=h+1;n.startCollapseRowIndex=r.rowIndex;X.call(n,s,h,r.rowIndex,true);},10);}else{m.className="icon-outline-span outline-expand";m.setAttribute("collapsed","true");this.individualCollapseCount["depth"+(h-1)]+=1;window.setTimeout(function(){n.outlineState.isExpanding=false;n.outlineState.collapseToLevel=h;n.startCollapseRowIndex=r.rowIndex;C.call(n,s,h,r.rowIndex,false);},10);}}}}}else{this._super(q);}},refresh:function I(e,n){var l=this;if(n){var k=this.getTargetZone(),q=k&&k.tableNode,o=this.gridData;if(!o||!k||!q){return this._super(e);}var m=this.getFormats(),h=k.gridContainerNode,g=this.xtabClonedNodes||[],f=(m&&m.width)||h.style.width,p=(m&&m.height)||this.scrollboxNode.style.height,j=parseInt(f,10);if(o.afc){j=Math.max(q.offsetWidth,j);}h.style.width=j+"px";mstrmojo.array.forEach(g,function(r){if(r.domNode){r.domNode.firstChild.style.width=j+"px";}});this.widthLimit=j;this.heightLimit=parseInt(p,10);this.scrollboxNode.style.height=p;this.resize();this.updateScrollbars();return ;}if(!this.retainOutlineState){U.call(this);}else{this.retainOutlineState=false;}this._super(e);},postBuildRendering:function a(){var j=this.gridData;this.isOutlineMode=(j&&j.olm&&!(j.rw&&j.rw.row.bc>0)&&!this.defn.txi);if(!mstrApp.outlineStates){mstrApp.outlineStates=[];}if(mstrApp.outlineStates[this.id]){this.outlineState=mstrApp.outlineStates[this.id];}else{if(!this.outlineState){this.outlineState={};}}this._super();var g=this.getTargetZone(),h=g&&g.tableNode;if(!j||!g||!h){return ;}var k=j.lvlepd||0,f=j.maxLevel||(j.gts&&j.gts.row&&j.gts.row.length)||0,e=j.olm&&!(j.rw&&j.rw.row.bc>0)&&(k>=1&&k<f);this.allPagesLoaded=false;this.individualCollapseCount={};this.maxIndividualCollapseCount={};Q.call(this,f,true);if(e){g._defaultPageHeight=Math.min(h.tBodies[0].offsetHeight,g._defaultPageHeight);g.gridContainerNode.style.minHeight=g._defaultPageHeight*g.totalPages+"px";S.call(this,k);this.scrollboxNode.scrollTop=0;G.call(this);}},gridPagesRendered:function B(){this._super();if(Y.call(this)&&!this.outlineState.isExpanding){R.call(this,1);}},isOutlineMode:true,showBanding:function A(e){O.call(this);this._super(e);},formatGridZone:function W(g,f,e){O.call(this);this._super(g,f,e);},batchFormatGridZones:function E(g,f,e){O.call(this);this._super(g,f,e);},formatPadding:function K(f,g,e){O.call(this);this._super(f,g,e);},updateRelatedColWidths:function F(e){O.call(this);this._super(e);},updateScenario:function H(e){O.call(this);this._super(e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo.Binding","mstrmojo._HasBindings","mstrmojo._HasMarkup","mstrmojo._HasTooltip","mstrmojo.css");mstrmojo.Widget=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasBindings,mstrmojo._HasMarkup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.Widget",domNode:null,hasRendered:false,visible:true,enabled:true,tooltip:"",cssClass:"",cssText:"",cssDisplay:"block",slot:"",alias:"",parent:null,init:function A(C){this._super(C);var D=this.parent;if(!D||D.hasInitBindings){this.initBindings();}},destroy:function B(C){if(this.hasRendered){this.unrender(C);}if(this.bindings){this.destroyBindings();}this._super();},invalidate:mstrmojo.emptyFn,widgetResized:mstrmojo.emptyFn});mstrmojo.Widget.cssTextMarkupMethod=function(){this.domNode.style.cssText=this.cssText||"";};mstrmojo.Widget.visibleMarkupMethod=function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";};mstrmojo.Widget.topMarkupMethod=function(){var C=this.top;if(C){this.domNode.style.top=C;}};mstrmojo.Widget.leftMarkupMethod=function(){var C=this.left;if(C){this.domNode.style.left=C;}};mstrmojo.Widget.heightMarkupMethod=function(){var C=this.height;if(C){this.domNode.style.height=C;}this.widgetResized();};mstrmojo.Widget.widthMarkupMethod=function(){var C=this.width;if(C){this.domNode.style.width=C;}this.widgetResized();};mstrmojo.Widget.enabledMarkupMethod=function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.taphold");var A=false,Q=mstrmojo.dom,V=16;mstrmojo._HasContextMenu=mstrmojo.provide("mstrmojo._HasContextMenu",{cm:null,cmPos:null,itemField:"n",itemIdField:"did",itemChildrenField:"items",dynamicUpdate:false,queryChecked:function(W){return false;},queryEnabled:function(W){return true;},queryVisible:function(W){return true;},executeCommand:function P(W){},item2textCss:function E(W){return W.cssClass||W.cmdId||("cmd"+W[this.itemIdField]);},showContextMenu:function J(){if(!A){mstrmojo.requiresCls("mstrmojo.ContextMenu");A=true;}var c=this._subMenu,a=this.getMenuPosition();if(!c){var e=(this.menuZIndex||this.zIndex||10)+1,Y={left:a.x+"px",top:a.y+"px",zIndex:e,visible:false,dynamicUpdate:this.dynamicUpdate,itemField:this.itemField,itemIdField:this.itemIdField,itemChildrenField:this.itemChildrenField,_cmSource:this.getContextMenuSource(),items:this.getContextMenuItems(),cssClass:this.getContextMenuCssClass(),placeholder:document.body.appendChild(document.createElement("div")),parent:this};c=new mstrmojo.ContextMenu(Y);c.render();this._subMenu=c;}else{c.set("left",a.x+"px");c.set("top",a.y+"px");}if(this.dynamicUpdate){var X=c.ctxtBuilder.itemWidgets,Z=X&&X.length,W,b,d=this.getContextMenuSource();for(W=0;W<Z;W++){b=X[W];if(d.queryVisible){b.set("visible",d.queryVisible(b.data));}if(d.queryChecked){b.set("checked",d.queryChecked(b.data));}if(d.queryEnabled){b.set("enabled",d.queryEnabled(b.data));}}}c.set("visible",true);this.callOnContextMenuOpen();this.adjustMenuPosition();this.attachMousedownEvent();},hideContextMenu:function I(){var W=this._subMenu;if(W&&W.visible){this._subMenu.set("visible",false);this.callOnContextMenuClose();}},adjustMenuPosition:function O(){var W=this._subMenu,Z=this._subMenu.domNode,Y=Z.offsetHeight,X=Z.offsetWidth,c=Q.windowDim(),b=Q.position(Z,false),a=Q.position(Z,true);if((b.x+X+V)>c.w){W.set("left",(c.w-X-V+(a.x-b.x))+"px");}if((b.y+Y+V)>c.h){W.set("top",(c.h-Y-V+(a.y-b.y))+"px");}},attachMousedownEvent:function M(){var W=this;if(!this._close_handler){this._close_handler=function(X){W.closeMenuHandler(X);};}Q.attachEvent(document.body,"mousedown",this._close_handler);},closeMenuHandler:function R(W){if(!this.isOnMySubmenu(Q.eventTarget(self,W))){this.closeMenuTree();}},isOnMySubmenu:function N(a){var X=this._subMenu;if(!X){return false;}if(Q.contains(X.domNode,a,true,document.body)){return true;}var b=X.ctxtBuilder.itemWidgets,W=b&&b.length,Z,Y;for(Z=0;Z<W;Z++){Y=b[Z];if(Y.isOnMySubmenu(a)){return true;}}return false;},oncmChange:function K(){delete this._subMenu;},callOnContextMenuOpen:function D(){if(this.onContextMenuOpen){this.onContextMenuOpen();}},callOnContextMenuClose:function C(){if(this.onContextMenuClose){this.onContextMenuClose();}},getContextMenuItems:function U(){return this.cm;},getContextMenuCssClass:function B(){return this.cmCssClass||"";},getContextMenuSource:function H(){return this;},getMenuPosition:function F(){if(this.cmPos){return this.cmPos;}var W=Q.position(this.domNode,true);return{x:Math.round(W.x),y:Math.round(W.y+W.h)};},isSeparatorItem:function G(W){return W[this.itemIdField]===-1||W[this.itemField]==="-";},hasSubmenu:function L(W){return !!W[this.itemChildrenField];},closeMenuTree:function S(Y){var X=this.activeMenuItem,W=this._cmSource||this;if(!X){if(Y){this.activeMenuItem=Y;}else{W.hideContextMenu();}return ;}if(X===Y){return ;}if(Y){this.activeMenuItem=Y;if(Y.parent.parent===X){return ;}if(Y.parent===X.parent){X.hideContextMenu();return ;}}else{Y=W;this.activeMenuItem=null;}X.hideContextMenu();while(X!==W){X=X.parent.parent;if(X!==Y||W===Y){X.hideContextMenu();if(W===Y){Q.detachEvent(document.body,"mousedown",this._close_handler);}}if(X.parent===Y.parent){break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.WidgetListBuilder");mstrmojo.WidgetTreeBuilder=mstrmojo.provide("mstrmojo.WidgetTreeBuilder",mstrmojo.mixin({newContext:function A(B){var D=this._super(B);if(!B.itemFunction&&D.itemFunc){var C=D.itemFunc;D.itemFunc=function(G,F,H){var E=C(G,F,H);if(E){E.tree=H.tree||H;}return E;};}return D;}},mstrmojo.hash.copy(mstrmojo.WidgetListBuilder)));})();(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.color","mstrmojo.hash","mstrmojo.num","mstrmojo.array","mstrmojo.date");mstrmojo.requiresClsP("mstrmojo.mstr");var k=1,h=2,q=3,I=4,a=5,l=6,j=7,A=-1,J=-2,G=mstrmojo.color,M=mstrmojo.hash,d=mstrmojo.array,F=mstrmojo.num,O=mstrmojo.date,K,Z,s=mstrmojo.mstr.EnumDSSXMLObjectTypes;function p(AA,z){return AA.every(function(AB){return z(AB);});}function f(AB,AA,z){return p(AB,function(AC){return AC.ttp===AA||AC.ttp===z;});}function c(AA){var z=AA.toFixed(2);return parseFloat(z);}function o(z){this.raiseEvent(M.copy(z,{name:"modelEdit"}));}function t(z){this.raiseEvent(M.copy(z,{name:"selectedThresholdsChange"}));}function S(){var z=this.basedOnId||this.metricId;return d.filterOne(this.data.gsi.mx,function(AA){return AA.did===z;});}function m(AC){var z=AC.expr.nds,AA=z.length;if(AA!==1){return false;}var AB=z[0],AL=AB.cs;if(!AB.m||!AL){return false;}var AK=AB.fnt,AF=AB.fn,AJ=AL[0],AH=AL[1],AE=AJ&&AJ.v,AD=AH&&AH.v,AI=F.parseNumeric(AE)||parseFloat(AE),AG=F.parseNumeric(AD)||parseFloat(AD);switch(AK){case 2:case 3:switch(AF){case 1:case 2:AC.flr=AK===2?-Infinity:0;AC.ceil=AI;AC.ttp=AK===2?(AF===1?a:I):(AF===1?h:k);break;case 3:case 4:case 5:case 13:AC.flr=AI;AC.ceil=isNaN(AG)?(AK===2?Infinity:100):AG;AC.ttp=AK===2?(AF===4?a:(AF===5?I:l)):(AF===4?h:(AF===5?k:q));break;default:return false;}break;default:switch(AF){case 11:AC.flr=-Infinity;AC.ceil=AI;AC.ttp=j;break;case 17:case 10:AC.flr=AI;AC.ceil=isNaN(AG)?Infinity:AG;AC.ttp=j;break;default:return false;}}return true;}mstrmojo.threshold.MetricThresholdData=null;mstrmojo.threshold.ThresholdModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.threshold.ThresholdModel",data:undefined,thresholds:undefined,orgThresholds:undefined,selectedThresholds:[],metricId:undefined,basedOnId:undefined,editorMode:0,init:function r(AA){this._super(AA);var z=mstrApp.customization.getCustomThresholds();K=K||z.color;Z=Z||z.image;},ondataChange:function n(){this.thresholds=this.data.gsi.thresholds;this.saveOriginalData();},isAdvanced:function E(AD){var AA=this.thresholds;if(AA){var AG=AA[AD]||[],AU=false,AT,AN,AR="The expression is not supported by the Simple Threshold Exception Parser.";if(AG.length===0){return false;}if(AG.some(function(Aa){if(Aa.ttp===A){return true;}try{if(!m(Aa)){throw AR;}AN=Aa.expr.nds[0].m.did;}catch(AZ){return true;}if(AT&&AT!==AN){return true;}AT=AN;var AY=Aa.rtp;if(AY===3||AY===10){return true;}var AV=Aa.scope;if(AV&&AV!==1){return true;}var AX=Aa.fmt||{};for(var AW in AX){if(AW!=="bc"&&AW!=="bgs"){return true;}else{AU=true;}}return false;})){return true;}if(AU&&!p(AG,function(AV){return AV.fmt&&(AV.fmt.bc||AV.fmt.bgs);})){return true;}this.basedOnId=AT;var AO=false,AM=this.getSimpleThresholdType(AD),AF=AG.length;if(AF>0&&AM!==J){var AQ,AI,AK;for(AQ=0;AQ<AF-1;AQ++){AI=AG[AQ];AK=AG[AQ+1];if(AI.ceil!==AK.flr&&AI.flr!==AK.ceil){AO=true;break;}}if(!AO){var z=AG[0],AB=AG[AF-1],AJ=z.flr,AP=AB.ceil,AC=z.ceil,AE=AB.flr,AH=this.getMetricsCount(),AL=this.getMetricsMinValue(),AS=this.getMetricsMaxValue();switch(AM){case a:case I:AO=!(((AJ===0||AJ===-Infinity)&&(AP===AH||AP===Infinity))||((AC===AH||AC===Infinity)&&(AE===0||AE===-Infinity)));break;case h:case k:AO=!((parseInt(AJ,10)===0&&parseInt(AP,10)===100)||(parseInt(AC,10)===100&&parseInt(AE,10)===0));break;case j:AO=!(((AJ===AL||AJ===-Infinity)&&(AP===AS||AP===Infinity))||((AC===AS||AC===Infinity)&&(AE===AL||AE===-Infinity)));break;}}return AO;}else{return true;}}return false;},getSimpleThresholdType:function(AA){var AB=this.thresholds&&this.thresholds[AA],z=J;if(AB){if(f(AB,q,h)){z=h;}else{if(f(AB,q,k)){z=k;}else{if(f(AB,l,I)){z=I;}else{if(f(AB,l,a)){z=a;}else{if(f(AB,j)){z=j;}}}}}}return z;},isImageBasedType:function N(z){var AA=this.thresholds&&this.thresholds[z];return AA&&!AA.some(function(AB){return AB.rtp!==4;});},getMetricsMaxValue:function(){var z=S.call(this).max;return(z===undefined)?3000000:z;},getMetricsMinValue:function(){var z=S.call(this).min;return(z===undefined)?-3000000:z;},getMetricsCount:function(){var z=S.call(this).cnt;return z===undefined?100:z;},getServerThresholdValues:function B(){var z=this.basedOnId||this.metricId,AA=this.thresholds&&z in this.thresholds&&this.thresholds[z];if(d.isArray(AA)&&AA.length>0&&AA[0].ttp===j){AA.sort(function(AC,AB){return AC.flr-AB.flr;});return{min:AA[0].ceil,max:AA[AA.length-1].flr};}return{min:undefined,max:undefined};},getFormatString:function(){var AB=this.data.nf,AA=this,z=d.filterOne(AB,function(AC){return AC.id===AA.basedOnId;})||{};return z.nfs||"";},getDefaultColors:function w(){return K;},getDefaultImages:function L(){return Z;},getNormalizedValue:function(AE,AC,AB,AG){var AA=null;if(AC===q||AC===h||AC===k){AA=AE/100;}else{if(AC===l||AC===a||AC===I){AA=AE/(this.getMetricsCount());}else{if(AC===j){var AD=this.globalMinMax(AB,AG),z=AD.min,AF=AD.max;if(AG!==undefined&&AG<AF){AF=Math.max(AG,this.getMetricsMaxValue());}if(AB!==undefined&&AB>z){z=Math.min(AB,this.getMetricsMinValue());}if(AF===z){return 1;}AA=(AE-z)/(AF-z);}}}if(AA<0){AA=0;}if(AA>1){AA=1;}return AA;},getRealValue:function(AD,AB,AA,AF){if(AB===q||AB===h||AB===k){return c(AD*100);}if(AB===l||AB===a||AB===I){return c(AD*this.getMetricsCount());}if(AB===j){var AC=this.globalMinMax(AA,AF),z=AC.min,AE=AC.max;if(AF!==undefined&&AF<AE){AE=Math.max(AF,this.getMetricsMaxValue());}if(AA!==undefined&&AA>z){z=Math.min(AA,this.getMetricsMinValue());}return z+AD*(AE-z);}return null;},globalMinMax:function e(AA,AE){var z=(AA!==undefined&&AA!==-Infinity)?AA:Infinity,AD=(AE!==undefined&&AE!==Infinity)?AE:-Infinity,AB=this.getServerThresholdValues(),AC=AB.min,AF=AB.max;AC=(AC===undefined)?Infinity:AC;AF=(AF===undefined)?-Infinity:AF;return{min:Math.min(z,this.getMetricsMinValue(),AC),max:Math.max(AD,this.getMetricsMaxValue(),AF)};},getColorScheme:function(AA){var z="custom",AB,AC,AD;K.forEach(function(AE){AD=AE.bands;AC=AA.length;if(AC!==AD.length){return ;}for(var AF=0;AF<AC;AF++){AB=mstrmojo.color.fixFullHexValue(AA[AF]);if(AD[AF].bc!==AB&&AD[AC-AF-1].bc!==AB){return ;}}z=AE.id;});return z;},getImageSetName:function Y(AD){var AC=Z[0].id,z,AB=function(AE){return AE===z.bands[0].url;};for(var AA=0;AA<Z.length;AA++){z=Z[AA];if(AD.some(AB)){AC=z.id;break;}}return AC;},getGridValueFormat:function P(){return this.data.gsi.fmts.va;},isMapReversed:function Q(AB,z,AD){var AC=(AD?Z:K).filter(function(AE){return AE.id===AB;})[0],AA=z[0];if(!AD){AA=G.fixFullHexValue(AA);}return AC&&AC.bands[0][AD?"url":"bc"]!==AA;},setConditionData:function U(AC,AA){var AB=AC.data,z=AB.isNew;M.copy(AA,M.clear(AB));delete AB.isNew;AC.paint();AC.tree.onConditionEdit(AC,z);},hasSelectedThresholds:function v(){return this.selectedThresholds.length>0;},isThresholdSelected:function g(z){return this.selectedThresholds.indexOf(z)!==-1;},toggleThresholdSelected:function b(z,AB){var AF=this.selectedThresholds,AE=AF.indexOf(z),AA=AE!==-1,AD=this.thresholds[this.metricId],AC=AD.indexOf(z)!==-1;if(AC){if(AB&&!AA){AF.push(z);}else{if(!AB&&AA){AF.splice(AE,1);}}t.call(this);}},addThresholds:function X(z){var AA=this.thresholds[this.metricId];this.thresholds[this.metricId]=(AA||[]).concat(z);o.call(this);},duplicateThreshold:function u(AA){var AC=this.thresholds[this.metricId],z=AC[AA],AB=M.clone(z);AC.push(AB);if(this.isThresholdSelected(z)){this.toggleThresholdSelected(AB,true);}o.call(this);},deleteThreshold:function x(z){var AB=this.thresholds[this.metricId];var AA=AB.indexOf(z);if(AA!==-1){this.toggleThresholdSelected(z,false);AB.splice(AA,1);}o.call(this);},moveThreshold:function D(AA,AC){var AB=this.thresholds[this.metricId],z=AB.splice(AA,1);this.thresholds[this.metricId]=AB.slice(0,AC).concat(z,AB.slice(AC,AB.length));o.call(this);},cleanUp:function R(){this.selectedThresholds=[];this.editorMode=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES.AUTO;},clearData:function W(){var z=this.thresholds;if(z){z[this.metricId]=undefined;}},saveOriginalData:function V(){this.orgThresholds=M.clone(this.thresholds);},setAttIdToNDE:function C(AB){if(!(AB instanceof Array)){AB=[AB];}var AA,AG,AC,z,AF,AD=function(AH){AH.att.forEach(function(AI){if(AI.did===AF.did){AF.attId=AI.attId;}});},AE=function(AH){AH.conid=AF.did;};for(AA=0;AA<AB.length;AA++){z=AB[AA];for(AG in z){AF=z[AG];if(typeof AF==="function"||!(AF instanceof Object)){continue;}else{if(AG==="a"){if(AF.t===47&&AF.st===12033){M.forEach(this.controller.datasets,AD);AC=z.fn;if(AC===22||AC===57){(z.es||[]).forEach(AE);}}}else{this.setAttIdToNDE(z[AG]);}}}}},showNumberFormat:function H(){var AA=S.call(this),AB=AA&&AA.min,z=AA&&AA.max;return(typeof (AB)==="number"||typeof (z)==="number")||(O.isDate(AB)||O.isDate(z));}});mstrmojo.threshold.ThresholdModel.SLIDER_MODE={COLOR_BASED:0,IMAGE_BASED:1};mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL=[{n:"&#9679;",v:"1"},{n:"&#9632;",v:"2"},{n:"&#9830;",v:"3"},{n:"&#9670;",v:"4"},{n:"&#10070;",v:"5"},{n:"&#9784;",v:"6"},{n:"&#10047;",v:"7"},{n:"&#8984;",v:"8"},{n:"&#8680;",v:"29"},{n:"&#8679;",v:"30"},{n:"&#8681;",v:"31"}];mstrmojo.threshold.ThresholdModel.FEATURES={SHOW_ADVANCED_EDITOR:1,SHOW_BASED_ON:2,SHOW_IMAGE:3,SHOW_VALUE_ITEM:4};mstrmojo.threshold.ThresholdModel.EDITOR_TYPES={AUTO:0,ADVANCED_EDITOR:1,SIMPLE_EDITOR:2};mstrmojo.threshold.ThresholdModel.BASED_ON_TYPES={LOWEST_PERCENT:k,HIGHEST_PERCENT:h,BETWEEN_PERCENT:q,LOWEST:I,HIGHEST:a,BETWEEN:l,VALUE:j,COMPLEX:A,NONE:J};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.StepperContentProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.StepperContentProvider",item:null,renderer:null,min:null,max:null,interval:1,minField:"min",maxField:"max",maxLengthField:"maxLength",valField:"value",intField:"interval",canLoop:false,next:mstrmojo.emptyFn,prev:mstrmojo.emptyFn,hasPrev:mstrmojo.emptyFn,hasNext:mstrmojo.emptyFn,renderItemAt:mstrmojo.emptyFn,setVal:mstrmojo.emptyFn,getVal:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array");var C=mstrmojo.array;mstrmojo.ObjectBrowserDataProvider=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ObjectBrowserDataProvider",path:mstrConfig.taskURL,serverRequest:function(D,E){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(D,E,{silent:true});}else{mstrmojo.xhr.request("POST",this.path,E,D,undefined,this.XServer,this.baseParams);}},fetchFolderContents:function(D,E,H){var F=D.blockCount,G={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockCount:F,includeAncestorInfo:"true",includeObjectDesc:D.includeObjectDesc,encodeObjectInfo:false};if(D.folderLinksContextId){G.folderLinksContextId=D.folderLinksContextId;}if(D.sId){G.sessionState=D.sId;}if(E.fid){G.rootFolderID=E.fid;}else{if(E.fty){G.rootFolderType=E.fty;}}if(D.browsableTypes){G.objectType=D.browsableTypes;}if(E.blockBegin){G.blockBegin=E.blockBegin;}if(E.searchPattern){if(D.enableQuickSearch){G.quickSearch=D.enableQuickSearch;}G.searchPattern=E.searchPattern;if(E.recursive){G.recursive=E.recursive;}}this.serverRequest(G,H);},newFolder:function(G,H,F,D){var E={taskId:"createFolder",taskContentType:"json",folderID:G,name:H,description:F};this.serverRequest(E,D);},loadObjects:function B(H,I,D,G){var E=[],F=[];C.forEach(H,function(J){E.push(J.did);F.push(J.t);});if(H.length>0&&G){this.serverRequest({taskId:"getObjectInfo",objectIDs:E.join(","),objectTypes:F.join(","),includeDetails:true},I,D);}else{I.success();}},loadRecentSaveAsFolders:function A(E){var D={taskId:"getRecentSaveAsFolders"};this.serverRequest(D,E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");var M=mstrmojo.DI.DIConstants,H=mstrmojo.array,D=M.dbType,F=M.xdaType,I=M.sourceType,K=M.backendSourceSubtype;mstrmojo.DI.DIDatabaseHelper=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIDatabaseHelper.getImportOptionByDBType=function A(N){switch(N){case D.SAP:case D.MSFT_AS:case D.ESSBASE:case D.TM1:case D.PIG:return false;default:return true;}};mstrmojo.DI.DIDatabaseHelper.getSourceTypeByDBType=function E(N){switch(N){case D.SAP:case D.MSFT_AS:case D.ESSBASE:case D.TM1:return F.mdx;case D.PIG:return F.ffsql;default:return -1;}};mstrmojo.DI.DIDatabaseHelper.getDescriptionIdByDBType=function(N){switch(N){case D.MS_ACCESS:return 9149;case D.ORACLE:return 8545;case D.SQL_SERVER:return 8552;case D.INFORMIX:return 12995;case D.SYBASE:return 12998;case D.REDBRICK:return 10059;case D.DB2:return 8516;case D.TERADATA:return 8553;case D.SAP:return 13107;case D.NETEZZA:return 8558;case D.EXCEL:return 3958;case D.MSFT_AS:return 13225;case D.ESSBASE:return 13224;case D.MYSQL:return 8556;case D.POSTGRESQL:return 8541;case D.COMPOSITE:return 12991;case D.ASTER:return 10058;case D.VERTICA:return 10062;case D.PARACCEL:return 10056;case D.TM1:return 13223;case D.XQUERY:return 8560;case D.HIVE:return 8561;case D.SALESFORCE:return 9213;case D.SAPHANA:return 12997;case D.GOOGLE_BIGQUERY:return 12450;default:return 4444;}};mstrmojo.DI.DIDatabaseHelper.getOASTFromBEST=function L(N){switch(N){case K.googleBigQuery:case K.googleBigQueryFFSQLModel:case K.googleBigQuerySingleTable:return I.googleBigQuery;case K.dropbox:return I.dropbox;case K.googleAnalytics:return I.googleAnalytics;case K.googleDrive:return I.googleDrive;case K.facebook:return I.facebook;case K.twitter:return I.twitter;case K.salesforce:return I.salesforce;default:return -1;}};mstrmojo.DI.DIDatabaseHelper.isOAuthSourceType=function C(N){var O=[I.googleBigQuery,I.dropbox,I.googleAnalytics,I.googleDrive,I.facebook,I.twitter,I.salesforce];return H.indexOf(O,N)!==-1;};mstrmojo.DI.DIDatabaseHelper.filterDBById=function B(P,N,O){return H.filter(P,function(S){var R=H.indexOf(N,S.id),Q;if(R>-1){Q=O;}else{Q=!O;}return Q;});};mstrmojo.DI.DIDatabaseHelper.filterDBByDispOption=function B(P,N,O){return H.filter(P,function(R){var Q=false;if((R.disp&N)===N){H.forEach(O,function(S){if(R.id===S){Q=true;return false;}});return !Q;}});};mstrmojo.DI.DIDatabaseHelper.getDBIds=function J(O){var N=[];H.forEach(O,function(P){N=N.concat(P.id);});return N;};mstrmojo.DI.DIDatabaseHelper.getUniqueDBTypes=function G(P){var O=[],N;H.forEach(P,function(Q){N=H.indexOf(O,Q.dbType);if(N<0){O.push(Q.dbType);}});return O;};mstrmojo.DI.DIDatabaseHelper.filterDBByAdminConfig=function(O,N){return H.filter(O,function(R){var P=H.indexOf(N,R.id),Q=true;if(P>=0){Q=false;}return Q;});};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._Fetchable");mstrmojo.mstr.ElementsDataHelper=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._Fetchable],{scriptClass:"mstrmojo.mstr.ElementsDataHelper",items:null,browseConfig:null,concat:true,init:function(A){var B=A&&A.browseConfig;if(B){this.blockBegin=B.blockBegin||1;this.blockCount=B.blockCount||mstrApp.elementsBlockCount||30;}if(this._super){this._super(A);}},getBrowseConfig:function(B){var A=this.browseConfig;A.blockBegin=B||1;A.silent=true;if(!A.datasetID){delete A.datasetID;delete A.messageID;}return A;},_retrieveItems:function(B,A){mstrApp.modelFactory.newElementDataService().getElements(this.getBrowseConfig(B),{success:function(C){if(A&&A.success){A.success({items:C.es,totalSize:C.sz});}},failure:function(C){if(A&&A.failure){A.failure(C);}},complete:function(C){if(A&&A.complete){A.complete(C);}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var F=mstrmojo.hash;var D={SOLID_COLOR:0,NO_FILL:1,GRADIENT:2};mstrmojo.threshold.PropertyModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.threshold.PropertyModel",threshold:undefined,gridValueFormat:undefined,submitChange:function G(){this.raiseEvent({name:"propertyModelChange",threshold:this.threshold});},updateControl:function E(I){var H=this.threshold,J=F.copy(H.fmt,this.gridValueFormat);I.textGroup.setFormatSource(H);I.charGroup.setFormatSource(J);I.containerGroup.setFormatSource(J);},changeFormatProperty:function B(I,J,L){var H=this.threshold,K=I==="threshold"?H:H.fmt;if(!K&&I==="fmt"){K=H.fmt={};}K[J]=L;if(J==="bc"){if(typeof (L)==="string"){K.bgs=D.SOLID_COLOR;delete K.gdc;delete K.gda;}else{if(L===-1){K.bgs=D.NO_FILL;}else{K.bgs=D.GRADIENT;}}}},getReplaceTypeName:function A(){return"rtp";},getReplaceTextName:function C(){return"rtxt";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo._Fetchable");var A=mstrmojo.hash;mstrmojo.mstr.DocElementDataHelper=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._Fetchable],{scriptClass:"mstrmojo.mstr.DocElementDataHelper",source:null,items:null,browseConfig:null,concat:true,init:function(B){var C=B&&B.browseConfig;this.blockBegin=(C&&C.blockBegin)||1;this.blockCount=(C&&C.blockCount)||mstrApp.elementsBlockCount||30;if(this._super){this._super(B);}},getBrowseConfig:function(){if(!this.browseConfig){this.browseConfig={blockBegin:this.blockBegin,blockCount:this.blockCount};}return this.browseConfig;},_retrieveItems:function(E,C,B){var D=this.getBrowseConfig();D.blockBegin=E;mstrmojo.func.override({success:function(F){if(this._super){this._super(mstrmojo.hash.copy(F,{items:F.es,totalSize:F.sz}));}}},C);this.source.browseElements(D,C,B);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");function B(J,I){this.raiseEvent({name:"viCompBuilt",type:J,widget:I});}mstrmojo.vi.models.VIComponentMap=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.VIComponentMap",init:function G(I){this._super(I);this.relativePanels={};this.comps={};},addRelativePanel:function H(I){this.relativePanels[I]=true;},isRelativePanel:function F(I){return !!this.relativePanels[I];},isComponent:function C(J,I){return this.getComponentKey(J)===I;},getComponent:function A(I){return this.comps[I];},getComponentKey:function D(J){var I=this.getComponent(J);return(I&&I.k)||"";},createComponent:function E(L,K,J){B.call(this,L);var I=new K(J);this.comps[L]=I;B.call(this,L,I);return I;}});mstrmojo.vi.models.VIComponentMap.TYPES={FILTER_STACK:1,FILTER_PANEL:2,PAGEBY_STACK:3,PAGEBY_PANEL:4,VIZ_CONTENT:5,MAIN_CONTENT:6};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo._LoadsScript","mstrmojo._HasChildren","mstrmojo.Binding","mstrmojo._HasBindings");mstrmojo.Model=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._LoadsScript,mstrmojo._HasChildren,mstrmojo._HasBindings],{scriptClass:"mstrmojo.Model",init:function A(C){this._super(C);if(this.children){this.initChildren();}if(!this.parent){this.initBindings();}},destroy:function B(C){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(C);}});})();(function(){mstrmojo.requiresCls("mstrmojo.func");var A=mstrmojo.string;mstrmojo.ResSetLink=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ResSetLink",SAME_PROMPT:1,DO_NOT_ANSWER:2,CLOSE:3,DYNAMIC:4,STATIC:5,CURRENT_UNIT:6,ALL_VALID_UNITS:7,USE_DEFAULT_ANSWER:8,DYNAMIC_OR_SAME_PROMPT:9,toXml:function B(){var M=this,E=function(S,U){return" "+S+'="'+U+'"';},D=function(S,U){return E(S,mstrmojo.string.encodeXMLAttribute(U));},H=new mstrmojo.StringBuffer(),F=function(U,V){var S=mstrmojo.string.multiReplace(V.disp_n,{"&nbsp;":" "});U.append("<e"+D("ei",A.decodeXMLAttribute(V.ei))+D("disp_n",A.decodeXMLAttribute(S))+E("emt",V.emt)+"/>");};var K=this.prms,C=K&&K.length;if(C||M.aopam!=M.DO_NOT_ANSWER){H.append("<hl"+E("mid",M.mid)+E("srct",M.srct)+E("aopam",M.aopam)+">");if(C){H.append("<prms>");for(var G=0;G<C;G++){var R=K[G];H.append("<prm"+E("id",R.id)+E("am",R.am)+E("pt",R.pt));if(R.orid){H.append(E("orid",R.orid)+E("ortp",R.ortp));}H.append(">");switch(R.am){case M.DO_NOT_ANSWER:case M.CLOSE:case M.USE_DEFAULT_ANSWER:case M.SAME_PROMPT:break;case M.STATIC:H.append('<pa ia="1"><es>');var Q=R.pa.es,P=Q&&Q.length||0;for(var L=P-1;L>=0;--L){var J=Q[L];F(H,J);}H.append("</es></pa>");break;case M.DYNAMIC:case M.CURRENT_UNIT:case M.DYNAMIC_OR_SAME_PROMPT:var O=R.pa;if(O){H.append('<pa ia="1">');var N=O.a;if(N){H.append("<a"+E("id",N.id)+D("n",N.n)+">");}if(R.pt===1){H.append(mstrmojo.string.encodeXMLAttribute(O.v));}else{H.append("<es"+E("dispForms",N&&N.dispForms>=0?N.dispForms:"")+">");var Q=O.es;P=Q&&Q.length||0;for(var L=P-1;L>=0;--L){var J=Q[L];F(H,J);}H.append("</es>");if(N){H.append("</a>");}}H.append("</pa>");}break;case M.ALL_VALID_UNITS:var O=R.pa;if(O){H.append('<pa ia="1">');var N=O.a,I=(N&&N.length)||0,G;if(I===0&&R.pt===1){H.append(mstrmojo.string.encodeXMLAttribute(O.v));}else{H.append("<attGroups><attGroup>");for(G=0;G<I;G++){H.append("<a"+E("id",N[G].id)+D("n",N[G].n)+">");if(R.pt===1){H.append(mstrmojo.string.encodeXMLAttribute(O.v));}else{H.append("<es"+E("dispForms",N[G].dispForms>=0?N[G].dispForms:"")+">");F(H,O.es[G]);H.append("</es>");}H.append("</a>");}H.append("</attGroup></attGroups>");}H.append("</pa>");}}H.append("</prm>");}H.append("</prms>");}else{H.append("<prms/>");}H.append("</hl>");}return H.toString();}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.Obj");var K=mstrmojo.hash;var P=0;var F=[];var J={};var L=false;function I(U){var V=U.callback;if(V.submission){V.submission(U.id,this.userInteractionRequired(U),U);}this.submitRequest(U);}function G(){if(F.length&&!L){I.call(this,F.shift());}}mstrmojo.ServerProxy=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ServerProxy",transport:null,cnt:0,request:function E(e,b,V,W){if(V){this.cancelRequests();}var Y=this.id,Z=this.transport,U=mstrmojo.now()+b.taskId+P++,X=e.canceled||mstrmojo.emptyFn;e.canceled=function(f){X();e.complete(true);return Z.cancelRequest(f);};e=mstrmojo.func.wrapMethods(e,{complete:function(f){mstrmojo.all[Y]&&mstrmojo.all[Y].deleteRequest(f);}});var a=!K.isEmpty(this._requests),c=this.createRequest(U,e,b,W),d=(L||a)&&!W.doNotHold;if(d){F.push(c);}else{I.call(this,c);}return U;},hasRequests:function O(){return !K.isEmpty(this._requests)||L;},createRequest:function Q(W,Y,X,U){var V=this._requests;if(!V){V=this._requests={};}V[W]={id:W,callback:Y,params:X,config:U};return V[W];},submitRequest:function M(U){this.transport.serverRequest(this.id,U.id,U);},cancelRequests:function S(){var U=false;K.forEach(this._requests,function(V){if(V.gotResponse===undefined){U|=V.callback.canceled(V.id);}});this._requests={};F=[];return U;},cancelRequest:function B(Y){var V=false,X=this._requests[Y],W,U=F.length;for(W=0;W<U;W++){if(F[W]===X){break;}}if(W<U){F.splice(W,1);delete this._requests[Y];V|=X.callback.canceled(X.id);}return V;},response:function A(Y,U,W){$MAPF(false,"AndroidServerTransport","transportRequest");var X=this.getRequest(Y);if(X){X.gotResponse=true;var Z=X.callback,V=(U&&!W.mstrerr)?"success":"failure";try{if(Z[V]){Z[V](W,X);}}finally{Z.complete(Y);}}G.call(this);},deleteRequest:function N(V){var U=this._requests;delete U[V];},getRequest:function H(V){var U=this._requests;return U&&U[V];},userInteractionRequired:function C(U){return false;},addLoadingGraph:function D(U){J[U]=true;L=true;},removeLoadingGraph:function R(U){delete J[U];if(K.isEmpty(J)){L=false;G.call(this);}},_serverRequestParallel:function(V,X,Y,U){var W=U||new mstrmojo.SimpleXHR();W.request("POST",V,{success:function(Z){if(Y.success){Y.success(Z);}},failure:function(Z){if(Y.failure){Y.failure({code:Z.getResponseHeader("X-MSTR-TaskErrorCode"),message:Z.getResponseHeader("X-MSTR-TaskFailureMsg")});}},complete:function(){if(Y.complete){Y.complete();}}},X);},serverRequestParallel:function(V,W,U){this._serverRequestParallel(mstrConfig.taskURL,V,W,U);},upload:function(a,Z,Y,V,X,W,U){mstrmojo.xhr.upload("POST",mstrConfig.taskURL,a,Z,Y,V,X,W,U);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Obj","mstrmojo.string","mstrmojo.hash","mstrmojo.expr","mstrmojo.num","mstrmojo.mstr.EnumNodeDimty");var G=mstrmojo.array,S=mstrmojo.expr,L=S.ET,K=S.TP,D=S.DTP,M=mstrmojo.mstr.EnumNodeDimty,P=S.ET2TGT,O=S.ET2COND,C=mstrmojo.meta.TP,B=mstrmojo.num;function Q(W,A){var V=(A&&A.did)?A.did.split(S.FN_SEP):null,E=V&&parseInt(V[0],10),U=V&&parseInt(V[1],10),X=W.et;W.fnt=E;W.fn=U;if(X!=L.AE&&S.fn_List(U,E)){W.et=L.AL;W.a2=null;W.cs=null;}else{if(X==L.AL&&!S.fn_List(U,E)){W.et=L.AQ;W.cs=null;}else{if(X==L.MC&&!S.fn_AC_MC(U,E)){W.et=L.MQ;W.m2=null;}else{if(X==L.AC&&!S.fn_AC_MC(U,E)){W.et=L.AQ;W.a2=null;}}}}switch(U){case S.FN.IS_NULL:case S.FN.IS_NOT_NULL:W.a2=null;W.a3=null;W.fm2=null;W.fm3=null;W.m2=null;W.m3=null;W.cs=null;break;case S.FN.BETWEEN:case S.FN.NOT_BETWEEN:break;default:W.a3=null;W.fm3=null;W.m3=null;while(W.cs&&W.cs.length>1){W.cs.pop();}}}function H(Z,a,b){var E=2+a,X;if(B.isBigDecimal(b.v)){b.dtp=D.BIGDECIMAL;}switch(b.t){case K.PROMPT:X=Z.cs;var Y;if(!X){X=[];Z.cs=X;}X[a]={};Y=X[a];Y.p=b;Z["a"+E]=null;Z["m"+E]=null;switch(Z.et){case L.AC:Z.et=L.AQ;break;case L.MC:Z.et=L.MQ;break;}break;case K.METRIC:Z["a"+E]=null;Z.cs=null;Z.et=L.MC;Z["m"+E]=b;break;case K.ATTR:Z["m"+E]=null;Z.cs=null;Z.et=L.AC;Z["a"+E]=b;Z["fm"+E]=null;break;default:Z["a"+E]=null;Z["m"+E]=null;X=Z.cs;if(!X){X=[];Z.cs=X;}if("did" in b){Z["a"+E]=null;Z["fm"+E]=null;Z["m"+E]=null;if(X[a]&&X[a].p){X[a].p=null;}}else{if(b&&b.v!=null){X[a]=b;}else{if(X[a]&&Z.et!==L.AL){X=X.splice(a,1);}}}if(!b.skipET){switch(Z.et){case L.MC:if((!Z.c2||!Z.m3)&&(!Z.m2||!Z.c3)){Z.et=L.MQ;}break;case L.AC:Z.et=L.AQ;break;case L.AL:if(!("did" in b)&&b.v){var A,V=b.dtp;X=[];A=b.v.split(mstrConfig.listSep);for(var U=0,W=A.length;U<W;U++){X.push({v:mstrmojo.string.trim(A[U]),dtp:V});}Z.cs=X;}break;}}}}var J={};J[L.AQ]={target:1,fm:1,fn:1,cs:1};J[L.AL]={target:1,fm:1,fn:1,cs:1};J[L.AE]={target:1,fn:1,es:1};J[L.AC]={target:1,a2:1,a3:1,fm:1,fm2:1,fm3:1,fn:1};J[L.MQ]={target:1,fn:1,cs:1,dmy:1};J[L.MC]={target:1,fn:1,m2:1,m3:1,dmy:1};J[L.F]={target:1};J[L.R]=J[L.F];J[L.XML]={target:1};J[L.ANDOR]={target:1};var I=function(A){return A!==null&&A!==undefined;};var N=function(a){if(a.data){return true;}if(!a||!I(a.et)){return false;}var Z=true,A=J[a.et],X=a.cs,W;Z=Z&&(!A.target||a[P[a.et]]);Z=Z&&(!A.fm||a.fm);Z=Z&&(!A.fn||I(a.fn));var V=S.fnCstCount(a.fn,a.fnt);if(Z&&A.cs){for(W=0;W<V;W++){Z=Z&&X&&I(X[W]);}}if(Z){var Y=[P[a.et],"fm"];for(var E=0;E<2;E++){for(W=0;W<V;W++){var b=Y[E]+(2+W);Z=Z&&(!A[b]||a[b]);}}}Z=Z&&(!A.es||a.es&&(a.es.length>0));var U=a.dimtyTypes;Z=Z&&(!A.dmy||U[M.NodeDimtyUnspecified]||U[M.NodeDimtyNone]||(U[M.NodeDimtyOutputLevel]&&a.dmy&&a.dmy.uts&&(a.dmy.uts.length>0)));return Z;};mstrmojo.ConditionModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ConditionModel",data:null,completed:false,defaultETAttr:L.AQ,init:function(A){if(this._super){this._super(A);}this._updateCompleted();},edit:function R(p,f,AB){var W=this[p];if(W===f){return ;}this.etWas=this.et;switch(p){case"not":f=!!(f&&f.did===S.FN.NOT);W=!!this.not;if(f===W){return ;}this.not=!!f||null;break;case"target":var AF=this.et;if(f){switch(f[C]){case K.ATTR:case K.CONS:W=this.a;if(AF!==L.AQ&&AF!==L.AE&&AF!==L.ANDOR){this.et=this.defaultETAttr;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}if(AF!==L.AE){this.fn=null;this.fnt=null;}this.fm=null;this.fm2=null;this.fm3=null;this.cs=null;break;case K.METRIC:W=this.m;if((AF!==L.MQ)&&(AF!==L.MC)){this.et=L.MQ;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.r=null;this.f=null;this.cs=null;this.dmt=M.NodeDimtyUnspecified;}this.m2=null;break;case K.REPORT:W=this.r;if(AF!==L.R){this.et=L.R;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.f=null;}break;case K.FILTER:W=this.f;if(AF!==L.F){this.et=L.F;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;}break;case K.PROMPT:W=this.prms&&this.prms[0];if(AF!==L.XML){this.et=L.XML;this.fm=null;this.fm2=null;this.fm3=null;this.fn=null;this.fnt=null;this.a=null;this.a2=null;this.a3=null;this.m=null;this.m2=null;this.m3=null;this.r=null;this.f=null;}break;}}this.es=null;this.data=null;this[P[this.et]]=f;break;case"fm":if(f&&f[C]==="fn"){this.et=L.AE;this.fm=null;Q(this,f);}else{this.fm=f;if(f&&(this.et==L.AE)){this.et=L.AQ;}this.fnt=null;this.fn=null;this.cs=null;this.a2=null;this.fm2=null;}break;case"fm2":case"fm3":this[p]=f;break;case"fn":Q(this,f);break;case"es":var AI=this.es;if(f&&f.removed&&AI){G.removeItems(AI,f.itemIdField,f.removed);}if(f&&f.added){if(!AI){AI=f.added.concat();this.es=AI;}else{G.insert(AI,AI.length,f.added);}}break;case"c0":H(this,0,f);break;case"c1":H(this,1,f);break;case"dmy":var AC=this.dmy;if(!AC){AC={cc:true,fres:true,uts:[]};this.dmy=AC;}var x=AC&&AC.uts;if(!x){x=[];AC.uts=x;this.dmt=M.NodeDimtyOutputLevel;}var U={};U[S.TP.ATTR]=true;U[S.TP.DIM]=true;if(f&&f.removed){var k=[],A=false,d=[],V=false;for(var o=0,X=f.removed,E=X.length;o<E;o++){var Z=X[o],AE=Z[C] in U;if(AE){V=true;}else{A=true;}var m=AE?d:k;m.push(Z);}if(A){G.removeItems(x,"did",k);}if(V){var AH={};for(var h=0,g=x&&x.length;h<g;h++){var e=x[h];if(e&&e.utgt){AH[e.utgt.did]=h;}}var Y=[];for(var AD=0,AA=d.length;AD<AA;AD++){var l=AH[d[AD].did];if(l>-1){Y.push(l);}}Y.sort(G.numSorter);for(var w=Y.length-1;w>-1;w--){x.splice(Y[w],1);}}}if(f&&f.added){var AJ=[],q=S.DMY_TP.DIM,t=S.DMY_TP.ATTR;for(var AG=0,z=f.added,j=z.length;AG<j;AG++){var s=z[AG];AJ.push((s[C] in U)?{utgt:s,utp:s[C]===K.DIM?q:t,agg:1,flt:2,gb:true,rps:0,n:s.n}:s);}G.insert(x,x.length,AJ);}break;case"data":this.data=f;break;}this._updateCompleted();if(!AB){this.raiseEvent({name:"edit",prop:p,value:f,valueWas:W});}},get:function F(){var A=this.data?this.data:this;var E=O[A.et]||[];E.push("et");return mstrmojo.hash.copyProps(E,A);},_updateCompleted:function(){this.set("completed",N(this));}});})();(function(){mstrmojo.requiresCls("mstrmojo.Obj");var D={TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};var C={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};mstrmojo.ui.PopupConfig=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.ui.PopupConfig",ENUM_CORNERS:D,isHostedWithin:true,position:null,hostProxyCssClass:"",hostId:"",hostElement:null,anchorElement:null,popupHandlers:null,alignment:null,alignWithAnchor:false,useTooltip:false,useDarkTheme:false,init:function H(I){this.clear();this._super(I);},setAlignment:function E(I,J){this.alignment={host:I,popup:J};},addPopupHandlers:function F(I,K,J){this.popupHandlers[I]={open:K,close:J};},clear:function B(){this.popupHandlers={};var I=this.ENUM_CORNERS;this.alignment={host:I.BOTTOM_LEFT,popup:I.TOP_LEFT};},destroy:function(I){this.anchorElement=null;this.hostElement=null;if(this._super){this._super(I);}}});mstrmojo.ui.PopupConfig.ENUM_CORNERS=D;mstrmojo.ui.PopupConfig.directionCfg={menuDirection:C.LEFT_TO_RIGHT,isRightToLeft:function G(){return this.menuDirection===C.RIGHT_TO_LEFT;},setDirection:function A(I){this.menuDirection=I?C.RIGHT_TO_LEFT:C.LEFT_TO_RIGHT;}};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.ui._HasUITheme","mstrmojo.vi.ui.theme","mstrmojo.dom");function g(h,k){if(!mstrmojo.DocInfoWindow){return ;}var j=h;while(j){if(j instanceof mstrmojo.DocInfoWindow){j[k?"registerScrollLock":"releaseScrollLock"](this);break;}j=j.parent;}}var N=mstrmojo.array,D=mstrmojo.dom,S=mstrmojo.hash,e=mstrmojo.css,G="px",K=mstrmojo.ui._HasUITheme.EnumThemeNames;var C=false;function M(h,k){if(!mstrmojo.DocInfoWindow){return ;}var j=h;while(j){if(j instanceof mstrmojo.DocInfoWindow){j[k?"registerLock":"releaseLock"](this);this.lockIW=k?j:null;break;}j=j.parent;}}var W=mstrmojo.ui.PopupConfig,O=W.directionCfg,B=W.ENUM_CORNERS,Z=B.TOP_LEFT,V=B.TOP_RIGHT,I=B.BOTTOM_RIGHT,H=B.BOTTOM_LEFT;function J(h){return(h===H||h===Z);}function d(h){return(h===V||h===I);}function Q(h){return(h===I||h===H);}function U(h){return(h===V||h===Z);}function a(q,k,z,AF){var AI=z.x,AH=z.y,AE=z.w||0,t=z.h||0,j=AF.w,AA=AF.h,AD=q.alignment,o=AD.popup,m=AD.host,AG=d(m),AJ=Q(m),AC=false,w=false,l=false,x=false,n=false,u=false,AB=D.isMobile,r=mstrmojo.ui.PopupConfig.directionCfg;if(J(o)){var p=AI+j+(AG?AE:0);AC=k.w<p;n=AB&&(AC||r.isRightToLeft());}if(U(o)){var v=AH+AA+(AJ?t:0);w=k.h<v;u=AB&&w;}if(d(o)||n){var s=AI-j+((AG&&!n)?AE:0);l=s<0;}if(Q(o)||u){var h=AH-AA+((AJ&&!u)?t:0);x=h<0;}return{top:x,bottom:w,left:l,right:AC};}function F(j){var h=this.popupConfig;if(h){S.forEach(h.popupHandlers,function(l,m){var k=l[j?"open":"close"];if(k){k.call(mstrmojo.all[m]||k,!!j);}});}}function L(j){var h=this.popupConfig;if(h&&!h.isHostedWithin){var k=this.hostProxy;if(k){k.style.display=j?"":"none";}}}function f(h){return h!==undefined&&h!==null&&!isNaN(h);}mstrmojo._IsPopup={visible:false,lockIWForScroll:false,disposable:true,opener:null,onOpen:mstrmojo.emptyFn,onClose:mstrmojo.emptyFn,popupConfig:null,hostProxy:undefined,open:function P(k,h){F.call(this,true);if(this.updatePopupConfig){this.updatePopupConfig(h,k);}else{S.forEach(h,function(n,m){this.set(m,n);},this);}var j="popup-mid-render";this.set("opener",k);if(!this.hasRendered){var l=this.visible;this.visible=false;this.render();e.addClass(this.domNode,j);this.set("visible",l);}if(this.nudge){this.domNode.style.top="-10000px";}L.call(this,true);this.set("visible",true);if(this.lockIWForScroll){g.call(this,this.opener,true);}if(h&&h.lockIW){M.call(this,h.lockIW,true);}if(this.nudge){this.nudge();}if(this.adjustSize){this.adjustSize();}this.adjustCornersForPopupOverflow();this.onOpen();e.removeClass(this.domNode,j);},adjustCornersForPopupOverflow:function b(){var s=this.popupConfig;if(!s){return false;}var AX=(s.includeScroll!==undefined)?s.includeScroll:true;var n=s.anchorElement||s.hostElement,l=s.position||D.position(n,AX),AD=n&&n.style&&n.style.zIndex;if(!s.isHostedWithin){var Af=this.hostProxy,AW=this.hostProxy=document.createElement("div");document.body.appendChild(AW);AW.appendChild(this.domNode);if(Af){Af.parentNode.removeChild(Af);}var AN=AW.style,AO={x:"left",y:"top",w:"width"};AW.className=s.hostProxyCssClass;AN.position="absolute";AN.background="none";e.addClass(AW,"mstrmojo-popup-widget-hosted");AN.height="0";N.forEach(["x","y","w"],function(Ao){var An=l[Ao];if(f(An)){AN[AO[Ao]]=An+G;}});}var AC=s.ENUM_CORNERS,Al=AC.BOTTOM_LEFT,AP=AC.BOTTOM_RIGHT,j=AC.TOP_RIGHT,AI=AC.TOP_LEFT;var q=D.position(document.body),AR=D.position(this.domNode),Aa=a(s,q,l,AR),p=Aa.right,AB=Aa.bottom,Am=Aa.left,AV=Aa.top,AE=s.alignment,AM=AE.popup,k=AE.host,v=AM,AA=k,AQ=D.isMobile,z=n&&n.classList&&n.classList.contains("mstrmojo-ui-Menu-item"),AS=this.id,w=n&&n.parentNode,AT=w&&w.parentElement,AL=n||this.domNode,AJ,Ag=this.domNode.style;if(AT&&AT.classList.contains("mstrmojo-ui-Menu")){AL=AT;}AJ=D.position(AL);if(z&&((Am&&p)||(AV&&AB))){if(AT){Ag.top=AJ.y+"px";Ag.left=AJ.x+"px";var Ae=document.getElementsByClassName("mstrmojo-ui-Menu");N.forEach(Ae,function(An){if(AS!==An.id){An.style.visibility="hidden";}});}s.anchorElement=AL;s.position={h:0,w:0,x:(AJ.x+AR.w)>q.w?Math.min(AJ.x,5):AJ.x,y:(AJ.y+AR.h)>q.h?Math.min(AJ.y,90):AJ.y};this.adjustCornersForPopupOverflow();return ;}if(O.isRightToLeft()&&(!AQ||AR.w>0)){if(!AQ||!Am){p=true;}else{if(!AQ||!p){O.setDirection(false);this.resetDirection=true;if(AQ){AA=(AA===j)?AI:Al;}}}}else{if(p){O.setDirection(true);this.resetDirection=true;}}if(p||Am){if(J(AA)){AA=U(AA)?j:AP;}else{if(d(AA)){AA=U(AA)?AI:Al;}}if(p&&J(v)){v=U(v)?j:AP;}else{if(Am&&d(v)){v=U(v)?AI:Al;}}}if(AB||AV){if(J(AA)){AA=U(AA)?Al:AI;}else{if(d(AA)){AA=U(AA)?AP:j;}}if(AB&&U(v)){v=J(v)?Al:AP;}else{if(AV&&Q(v)){v=J(v)?AI:j;}}}if(AV||p||AB||Am){if(C){console.log("Overflow directions: "+JSON.stringify(Aa));}this._orgalgn={host:k,popup:AM};s.setAlignment(AA,v);}if(!s.isHostedWithin){if(f(l.y)&&f(l.h)){this.hostProxy.style.top=(l.y+(Q(v)?(s.alignWithAnchor===true?l.h:0):(s.alignWithAnchor===true?0:l.h)))+G;this.hostProxy.style.zIndex=(f(AD)&&(AD>100))?AD+1:101;}}var AU,Ai={};if(s.isHostedWithin&&!!this.opener){AU=e.getComputedStyle(this.opener.domNode);}N.forEach(["left","right","top","bottom"],function(An){Ai[An]=AU?parseInt(AU["border-"+An+"-width"]||0,10):0;});var Ac=Q(AA),Ad=d(AA),u=Q(v),o=d(v),AY=function(Ao,An){return"calc(100% + "+(An?Ai[Ao]:0)+"px)";},x=function(Ao,An){return(An?-Ai[Ao]:0)+"px";};var r,AZ,h,m;r=AZ=h=m="auto";if(u){h=Ac?x("top"):AY("top");}else{r=Ac?AY("bottom"):x("bottom");}if(o){AZ=Ad?x("left"):AY("left");}else{m=Ad?AY("right"):x("right");}Ag.top=r;Ag.right=AZ;Ag.bottom=h;Ag.left=m;var t=D.position(this.domNode),AK=5;if(AB||AV){var Aj=t.y,AF=D.getMaxScrollHeight()+"px",Ah=this.scrollNode,AG=Ah&&Ah.style.maxHeight;if(Aj<0||(Aj+t.h>q.h)){if(Ah&&AF!==AG){Ah.style.maxHeight=AF;this.updateScrollbars();}var Ab=(-l.y+AK)+G;if(!s.isHostedWithin){if(this.hostProxy){this.hostProxy.style.top=0;}Ab=AK+G;}Ag.top=Ab;Ag.bottom="auto";}}if(Am||p){var Ak=t.x;if(Ak<0||(Ak+t.w>q.w)){var AH=(-l.x+AK)+G;if(!s.isHostedWithin){if(this.hostProxy){this.hostProxy.style.left=0;}AH=AK+G;}Ag.left=AH;Ag.right="auto";}}return true;},close:function R(j){if(this.keepOpen){return ;}if(this.onClose){this.onClose(j);}L.call(this,false);if(this.lockIWForScroll){g.call(this,this.opener,false);}this.set("visible",false);this.set("opener",null);if(this.lockIW){M.call(this,this.lockIW,false);}F.call(this,false);var h=this._orgalgn;if(h){this.popupConfig.setAlignment(h.host,h.popup);}if(this.resetDirection){this.resetDirection=false;O.setDirection(false);}},preBuildRendering:function A(j){this._super(j);var m=this.popupConfig;if(m&&!m.isHostedWithin){var h=m.hostProxyCssClass.split(" "),l=false;N.forEach(S.keyarray(K),function(n){if(h.indexOf(K[n])>=0){l=true;return false;}});if(!(l||m.noInheritTheme)){var k=mstrmojo.vi.ui.theme.getThemeClass.call(this);if(k){h.push(k);}}m.hostProxyCssClass=h.join(" ");}},buildRendering:function E(){var h=this._super();if(h){if(!this.parent&&!this.domNode.parentElement){document.body.appendChild(this.domNode);}}return h;},postBuildRendering:function Y(){var h=this,j=this.popupConfig;if(j&&!this._ListenerProc){this._ListenerProc=function(){h.monitorWindow();};D.attachEvent(window,"resize",this._ListenerProc);}this._super();},monitorWindow:function(){var j=D.getMaxScrollHeight();if(this.updateScrollbars&&this.scrollNode){this.scrollNode.style.maxHeight=(this.scrollNodeMaxHeight||j)+"px";this.updateScrollbars();}if(this.visible){var h=this,k=null;window.clearTimeout(k);k=window.setTimeout(function(){h.scrollNode.style.maxHeight=(h.scrollNodeMaxHeight||j)+G;h.adjustCornersForPopupOverflow();},175);}},destroy:function c(h){if(this._ListenerProc){D.detachEvent(window,"resize",this._ListenerProc);delete this._ListenerProc;}this._super(h);},unrender:function X(h){if(this.popupConfig&&!this.popupConfig.isHostedWithin&&this.hostProxy){document.body.removeChild(this.hostProxy);delete this.hostProxy;}this._super(h);}};}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.array","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.mstr.EnumFunction");var m=mstrmojo.array,g=mstrmojo.mstr.EnumFunction;var N={"8107C31BDD9911D3B98100C04F2233EA":"Sum","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C32CDD9911D3B98100C04F2233EA":"Product",B2C0FA4020C711D6AD1400C04F0423DE:"Greatest","8107C330DD9911D3B98100C04F2233EA":"Var","8107C32FDD9911D3B98100C04F2233EA":"Stdev","8107C32DDD9911D3B98100C04F2233EA":"Median",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31CDD9911D3B98100C04F2233EA":"Count","8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",B2C0FA4120C711D6AD1400C04F0423DE:"Least"},Q={"8107C326DD9911D3B98100C04F2233EA":"Rank"},w={D221F90EB35540E3A1204ED6CC9A8267:"Avg",D221F90FB35540E3A1204ED6CC9A8267:"Count",D221F910B35540E3A1204ED6CC9A8267:"Max",D221F911B35540E3A1204ED6CC9A8267:"Min",D221F90DB35540E3A1204ED6CC9A8267:"Sum"},x={"8107C32ADD9911D3B98100C04F2233EA":"Avg","8107C350DD9911D3B98100C04F2233EA":"Count","8107C34BDD9911D3B98100C04F2233EA":"Max","8107C34CDD9911D3B98100C04F2233EA":"Min","8107C32BDD9911D3B98100C04F2233EA":"Sum"},q={"8107C329DD9911D3B98100C04F2233EA":"Avg","8107C354DD9911D3B98100C04F2233EA":"Count","8107C351DD9911D3B98100C04F2233EA":"Max","8107C352DD9911D3B98100C04F2233EA":"Min","8107C328DD9911D3B98100C04F2233EA":"Sum"},X={"8107C337DD9911D3B98100C04F2233EA":"Banding","8107C338DD9911D3B98100C04F2233EA":"BandingC","8107C339DD9911D3B98100C04F2233EA":"BandingP"},H={"8107C31DDD9911D3B98100C04F2233EA":"Avg","8107C31CDD9911D3B98100C04F2233EA":"Count",B2C0FA4220C711D6AD1400C04F0423DE:"First","8107C331DD9911D3B98100C04F2233EA":"GeoMean",B2C0FA4320C711D6AD1400C04F0423DE:"Last","8107C31FDD9911D3B98100C04F2233EA":"Max","8107C32DDD9911D3B98100C04F2233EA":"Median","8107C31EDD9911D3B98100C04F2233EA":"Min","8107C32EDD9911D3B98100C04F2233EA":"Mode","8107C32CDD9911D3B98100C04F2233EA":"Product","8107C32FDD9911D3B98100C04F2233EA":"Stdev","548C68A0F60811D3ACC300C04F0423DE":"StdevP","8107C31BDD9911D3B98100C04F2233EA":"Sum","8107C330DD9911D3B98100C04F2233EA":"Var",D64F1B10F6C011D3ACC300C04F0423DE:"VarP",A202C23DDD9D11D3B98100C04F2233EA:"Fvschedule",A202C23CDD9D11D3B98100C04F2233EA:"IRR",A202C240DD9D11D3B98100C04F2233EA:"MIRR",A202C23EDD9D11D3B98100C04F2233EA:"NPV","8107C34ADD9911D3B98100C04F2233EA":"Percentile","9C374203DD9F11D3B98100C04F2233EA":"AvgDev","9C374228DD9F11D3B98100C04F2233EA":"ChiSquareTest","9C374225DD9F11D3B98100C04F2233EA":"Correlation","9C374224DD9F11D3B98100C04F2233EA":"Covariance","9C374237DD9F11D3B98100C04F2233EA":"ForecastV","9C37422FDD9F11D3B98100C04F2233EA":"FTest","9C374234DD9F11D3B98100C04F2233EA":"GrowthV","9C37422EDD9F11D3B98100C04F2233EA":"HeteroscedasticTTest","9C37422DDD9F11D3B98100C04F2233EA":"HomoscedasticTTest","9C37422ADD9F11D3B98100C04F2233EA":"Intercept","9C374204DD9F11D3B98100C04F2233EA":"Kurtosis","9C374222DD9F11D3B98100C04F2233EA":"MeanTTest","9C37422CDD9F11D3B98100C04F2233EA":"PairedTTest","9C374226DD9F11D3B98100C04F2233EA":"Pearson","9C374227DD9F11D3B98100C04F2233EA":"RSquare","9C374205DD9F11D3B98100C04F2233EA":"Skew","9C374229DD9F11D3B98100C04F2233EA":"Slope","9C37422BDD9F11D3B98100C04F2233EA":"SteYX","9C374231DD9F11D3B98100C04F2233EA":"TrendV","9C374223DD9F11D3B98100C04F2233EA":"VarTest","4A99DC7BC5254A319F6B8098E7D652C1":"ConcatAgg"},Z={AND283:"And",OR284:"Or",NOT285:"Not",IF305:"If"},o={BEGINSWITH279:"Begins with",ENDSWITH279:"Ends with",IN289:"In",BETWEEN290:"Between",CONTAINS291:"Contains",LIKE291:"Like"};function P(AD){var AB=function(AF,AE){return mstrmojo.array.stringSorter(AF.n,AE.n);},AC,AA;AD=AD.sort(AB);for(AC=0,AA=AD.length;AC<AA;AC++){AD[AC].fns=AD[AC].fns.sort(AB);}return AD;}function Y(AD,AE){var AA=AD.length,AC;for(AC=0;AC<AA;AC++){var AB=AD[AC].fns;if(mstrmojo.array.find(AB,"did",AE)>-1){return AC;}}return -1;}function M(AB){var AA=mstrApp&&mstrApp.useQuickSearch&&mstrApp.useQuickSearch();AB=mstrmojo.hash.copy(AB,{taskId:"searchMetadata",recursive:true,styleName:"MojoFolderStyle",includeObjectDesc:true,includeAncestorInfo:false});if(AA){AB.quickSearch=AA;AB.nameWildcards=16;AB.sortKey=-1;}return AB;}function I(AB,AA){if(mstrApp.serverRequest){mstrApp.serverRequest(AA,AB);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(AB,AA,false,{});}}mstrmojo.ME.MetricDataService=mstrmojo.provide("mstrmojo.ME.MetricDataService",{rootFolderTypes:{ALL:39,FILTERS:4,METRICS:5,FACTS:29,SCHEMA:24,ATTRIBUTES:26,TRANSFORMATIONS:38},blockCount:10,suggestCount:10,suggestDelay:200,noCache:true,functions:null,metricComponents:null,functionsDetails:null,getServerProxy:function F(){if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}return this.serverProxy;},getMetricDefintion:function S(AC,AA){var AB={taskId:"getMetricDefinition",metricId:AC.id,outputFlags:65599};if(AC.msgID){AB.msgID=AC.msgID;}I.call(this,AA,AB);},validateMetric:function e(AC,AA){var AB={taskId:"validateMetric",metricId:AC.metricId,tokenStreamXML:AC.tokenStreamXML,metricXML:AC.metricXML,outputFlags:327695};if(mstrmojo.string.isEmpty(AC.metricId)){AB.isNew=true;}if(AC.msgID){AB.msgID=AC.msgID;}if(AC.formID){AB.frmid=AC.formID;}if(AC.isIDForm){AB.isIDForm=AC.isIDForm;}if(AC.objectType){AB.objectType=AC.objectType;}I.call(this,AA,AB);},getMetricComponents:function B(AE,AB){var AA=this,AC=this.metricComponents;if(!this.noCache&&AC&&AC.items.length==AC.sz){AB.success(AC);return ;}AB.success=mstrmojo.func.composite([AB.success,function(AF){if(AA.metricComponents&&AA.metricComponents.items){AA.metricComponents.items.push(AF.items);}else{AA.metricComponents=AF;}}]);var AD=M({blockBegin:AE.blockBegin,blockCount:AE.blockCount,searchPattern:AE.pattern,rootFolderType:AE.rootFolderType||24,objectType:AE.objectType||"12,13,43"});I.call(this,AB,AD);},getAttributes:function R(AC,AA){var AB=M({blockBegin:AC.blockBegin,blockCount:AC.blockCount,searchPattern:AC.pattern,rootFolderType:AC.rootFolderType||26,objectType:12});I.call(this,AA,AB);},getFacts:function L(AC,AA){var AB=M({blockBegin:AC.blockBegin,blockCount:AC.blockCount,searchPattern:AC.pattern,rootFolderType:AC.rootFolderType||29,objectType:13});I.call(this,AA,AB);},getMetrics:function G(AC,AA){var AB=M({blockBegin:AC.blockBegin,blockCount:AC.blockCount,searchPattern:AC.pattern,rootFolderType:AC.rootFolderType||5,objectType:4});if(AC.isVerify){AB.nameWildcards=2;}I.call(this,AA,AB);},getFunctions:function U(AF){var AH=this,AI=window.sessionStorage,AE=this.functions||(AI&&AI.getItem("functions")),AG=AI&&AI.getItem("mstrLocaleId"),AC=mstrApp&&mstrApp.localeId;if(AE&&AG==AC){AE=P(JSON.parse(AE).fncs);AF.success(AE);}else{var AB={failure:AF.failure,textResponse:true},AD={taskId:"getSystemFunctions",includeFunctionDetails:true,functionFlags:2|2147483648,includeFunctionHelpTopic:true};var AA=function(AJ){m.forEach(AJ,function(AL){var AK=AL&&AL.fns;m.forEach(AK,function(AN){var AM=AN.pros;var AO=m.filterOne(AM,function(AP){return AP.n==="UseLookupForAttributes";});if(AO){AO.dfv="0";}});});};AB.success=function(AJ){if(typeof AJ==="string"||!mstrApp.isSingleTier){AJ=AJ.replace(/\\'/g,"'");var AL=JSON.parse(AJ),AK=AL.fncs;AA(AK);AJ=JSON.stringify(AL);if(AI){AI.setItem("functions",AJ);AI.setItem("mstrLocaleId",AC);}AH.functions=AJ;AE=P(JSON.parse(AJ).fncs);}else{AA(AJ.fncs);AE=P(AJ.fncs);AH.functions=JSON.stringify(AJ);}AF.success(AE);};I.call(this,AB,AD);}},getAggFunctions:function C(){if(this._aggFunctions){return this._aggFunctions;}var AA=this.parseFuncStr();AA=mstrmojo.array.filter(AA[this.getBasicCategoryIndex(AA)].fns,function(AC){var AB=AC.did,AD;if(AB!=="B2C0FA4020C711D6AD1400C04F0423DE"&&AB!=="B2C0FA4120C711D6AD1400C04F0423DE"){AD=N[AB];}return AD;});return AA;},getOLAPAggFunctions:function E(AA){var AB=this.parseFuncStr();AB=mstrmojo.array.filter(AB[this.getOLAPCategoryIndex(AB)].fns,function(AC){switch(AA){case"moving":return x[AC.did];case"running":return q[AC.did];case"olap":default:return w[AC.did];}return false;});return AB;},getFunctionCatList:function s(){if(this._functionCatList){return this._functionCatList;}var AA=this.parseFuncStr();AA=mstrmojo.hash.make(AA,mstrmojo.Arr);this._functionCatList=AA;return AA;},getCategoryIndex:function r(AB,AA){return Y(AA||this.getFunctionCatList(),AB);},getBasicCategoryIndex:function J(AB){var AA="B2C0FA4020C711D6AD1400C04F0423DE";return Y(AB||this.getFunctionCatList(),AA);},getDataMiningCatIndex:function k(AA){var AB="F17CD4F3FF134D91B80DDAB9CA73C919";return Y(AA||this.getFunctionCatList(),AB);},getDateTimeCategoryIndex:function v(AB){var AA="C50F2A4F75AE49D6B20E00224967B500";return Y(AB||this.getFunctionCatList(),AA);},getStringCategoryIndex:function h(AB){var AA="6F7DF5FF449111D5BEA300B0D01A55EF";return Y(AB||this.getFunctionCatList(),AA);},getOLAPCategoryIndex:function J(AB){var AA="D221F90EB35540E3A1204ED6CC9A8267";return Y(AB||this.getFunctionCatList(),AA);},getInternalCategoryIndex:function V(AB){var AA="8107C337DD9911D3B98100C04F2233EA";return Y(AB||this.getFunctionCatList(),AA);},getFunctionDetails:function t(AC,AA){var AB={taskId:"getSystemFunctions",functionId:AC.did,includeFunctionDetails:true,includeFunctionHelpTopic:true};I.call(this,AA,AB);},getTransformations:function O(AC,AA){var AB=M({blockBegin:AC.blockBegin,blockCount:AC.blockCount,searchPattern:AC.pattern,rootFolderType:AC.rootFolderType||38,objectType:43});I.call(this,AA,AB);},getFilters:function l(AC,AA){var AB=M({blockBegin:AC.blockBegin,blockCount:AC.blockCount,searchPattern:AC.pattern,rootFolderType:AC.rootFolderType||4,objectType:1});I.call(this,AA,AB);},getAttributeForms:function f(AC,AA){var AB={taskId:"getAttributeForms",attributeID:AC.attributeID,displayedForms:AC.displayedForms,styleName:"WidgetElementListStyle"};I.call(this,AA,AB);},getSubtotalFunctions:function W(AC,AA){var AB=M({objectType:"1025,1026",searchPattern:""});I.call(this,AA,AB);},isBasicAggMap:function n(AA){var AB=!!N[AA];if(AA==="B2C0FA4020C711D6AD1400C04F0423DE"||AA==="B2C0FA4120C711D6AD1400C04F0423DE"){AB=false;}return AB;},isOLAPAgg:function z(AA){return !!w[AA];},isMovingAgg:function a(AA){return !!x[AA];},isRunningAgg:function d(AA){return !!q[AA];},isBanding:function j(AA){return !!X[AA];},isOLAP:function K(AB){var AC=this.getFunctionCatList(),AA=AC[this.getOLAPCategoryIndex(AC)].fns;return mstrmojo.array.find(AA,"did",AB)>-1;},isRank:function D(AA){return !!Q[AA];},isScalar:function c(AA){return(AA||{}).sqt===3;},hasLookupForAttributesProps:function(AA){return !!H[AA];},getFunctionHelpTopic:function p(AA){var AB="<div class='func-details' onclick='mstrmojo.ME.MetricDataService.showFunctionHelpTopic(\"##HELPTOPIC##\")'>"+mstrmojo.desc(5811,"Details...")+"</div>";AB=AB.replace("##HELPTOPIC##",AA);return AB;},showFunctionHelpTopic:function u(AB){var AC=mstrApp.isSingleTier,AA=((mstrApp.helpUrl||"../help/")+"FunctionsRef/");if(AC){AA=AA+"index.htm#cshid="+(AB||"");window.FormWrapper.openPage(AA);}else{if(AB){AA=AA+"Content/"+AB+".htm";}else{AA=AA+"index.htm";}window.open(AA);}return false;},sortFunctions:function A(AB){var AC={},AA=function(AE,AD){return mstrmojo.array.stringSorter(AE.n,AD.n);};mstrmojo.array.forEach(AB,function(AD){mstrmojo.array.forEach(AD&&AD.fns,function(AE){if(AE&&AE.did){AC[AE.did]=AE;}});});return mstrmojo.hash.valarray(AC).sort(AA);},parseFuncStr:function b(){var AA=window.sessionStorage,AB=this.functions||AA&&AA.getItem("functions");if(AB){return P(JSON.parse(AB).fncs);}},isValEqual:function(AD,AC){if(AD===AC){return true;}var AA=[-1,"-1","True",true],AB=[0,"0","False",false];if(AA.indexOf(AD)>-1&&AA.indexOf(AC)>-1){return true;}else{if(AB.indexOf(AD)>-1&&AB.indexOf(AC)>-1){return true;}}return false;},isFuncHasUseLookupForAttributeProp:function(AB){var AA=[g.FunctionSum,g.FunctionCount,g.FunctionAvg,g.FunctionMin,g.FunctionMax,g.FunctionProduct,g.FunctionMedian,g.FunctionMode,g.FunctionStdev,g.FunctionVar,g.FunctionGeomean,g.FunctionPercentile,g.FunctionStdevP,g.FunctionVarP,g.FunctionFirst,g.FunctionLast,g.ConcatAgg];return AA.indexOf(AB)>-1;},isLogicOrCompFunc:function(AB){var AA=AB.v.toUpperCase()+AB.tp;return !!Z[AA]||!!o[AA];}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.StringBuffer","mstrmojo.ResSetLink");var k=1,U=2;var E=2,L=4,D=5;var X=1,O=4;var h=mstrmojo.array;function H(l,m){return l[((m===k)?"row":"col")];}function B(l,n){var m=n.lm;return m&&m[l.mix||0];}function d(m,r,x){var v=new mstrmojo.ResSetLink({mid:this.getMessageId(),srct:r.target.t||2,aopam:r.daMode});var s=r.ans,w=s&&s.length;if(w){var t=v.prms=[],n=0;for(n=0;n<w;n++){var AC=s[n];var o=AC.pid,q=parseInt(AC.m,10),AB={id:o,am:q,pt:AC.pt};t.push(AB);if(AC.po){AB.orid=AC.po.did;AB.ortp=AC.po.t;}switch(q){case v.DO_NOT_ANSWER:case v.CLOSE:case v.USE_DEFAULT_ANSWER:case v.SAME_PROMPT:break;case v.STATIC:var l=AC.es,AA=(l&&l.length)||0,u;AB.pa={es:[]};for(u=AA-1;u>=0;--u){var p=l[u];AB.pa.es.push({ei:p.id,disp_n:p.n,emt:1});}break;case v.DYNAMIC:case v.ALL_VALID_UNITS:case v.CURRENT_UNIT:case v.DYNAMIC_OR_SAME_PROMPT:if(x.els){A.call(this,AC,x,AB,q,v);}else{K.call(this,AC,x,AB,q,v);}break;}}}return v;}function A(s,m,l,r,q){var p=s.dunits,n=m.els,o=l.pa={};h.forEach(n,function(t){if(h.find(p,"id",t.id)>=0){if(r!==q.DYNAMIC&&r!==q.DYNAMIC_OR_SAME_PROMPT){o.a={id:t.id,n:t.disp_n,dispForms:t.dfi};}if(s.pt===1){o.v=t.v;}else{o.es=[];o.es.push({ei:t.ei,emt:t.emt,disp_n:t.disp_n});}}});}function K(AA,w,z,p,r){var s=AA.dunits,u=AA.dsUnits;if(s&&s.length&&w){var t=z.pa={};var o=w,n=(w.mix!==undefined)&&(w._lp||w._tp);if(n){o=w._lp||w._tp;}var m=parseInt(o.axis,10);while(o){var x=this.getPTitle(o,m);if(x&&h.find(s,"id",x.id)>=0){var q={id:x.id,n:x.n,dispForms:x.dfi};if(p===r.ALL_VALID_UNITS){t.a=(t.a||[]).concat(q);}else{if(p!==r.DYNAMIC&&p!==r.DYNAMIC_OR_SAME_PROMPT){t.a=q;}}if(AA.pt===1){var l=AA.formMap;t.v=l&&l[o.fmi]?l[o.fmi]:o.v;break;}else{var v={ei:o._e.id,emt:1,disp_n:o._e.n};if(p===r.ALL_VALID_UNITS){t.es=(t.es||[]).concat(v);}else{t.es=[].concat(v);}}if(p===r.CURRENT_UNIT){break;}}o=this.getPCellParentNode(o,m);if(n&&!o&&m===k){m=U;o=w._tp;}}}else{if(u&&u.length&&w){z.pa={es:u};}}}function R(n){var m=this.getCellTitleInfo(n[0]),p=[],r=function(s){if(s){if(mstrApp.useBinaryFormat){if(s._e){p.push(s.axis+"A"+(s.ui+1)+"A"+s._e.id);}r(s._p);}else{p.push(s.axis+"A"+(s.ui+1)+"A"+s.o);}}},o,l;if(!m.isSrcTitle){for(o=0,l=n.length;o<l;o++){var q=n[o];if(q.mix!==undefined&&(q._lp||q._tp)){r(q._lp);r(q._tp);}else{r(q);}}}return(mstrApp.useBinaryFormat)?p:p.join(",");}function J(p,o,m){var n=true,l=m.length;while(p<l){if(m[p].id!==o.id){n=false;break;}p++;}return n;}mstrmojo.XtabModel=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.XtabModel",getMessageId:function S(){return this.data.mid;},getCellTitleInfo:function e(m,p){var n=p?p.gts:this.data.gts;var o=null;if(n){if(m&&m.mix===undefined){o=H(n,m.axis)[m.tui||m.ui];}else{var l=function(s){var q=(s&&s.length)||0,r;for(r=q-1;r>=0;--r){if(parseInt(s[r].otp,10)===-1){return s[r];}}return null;};o=l(n.col)||l(n.row);}}return{isSrcTitle:!!m&&(m.o===undefined)&&!((m.mix!==undefined)&&(m._lp||m._tp)),title:o};},getCellInfo:function I(m){var l=this.getCellTitleInfo(m),n={isTitle:false,isHeader:false,isMetric:false};if(m&&(m.hasOwnProperty("mix")||m.otp===-1)){n.isMetric=true;if(m._e){n.isHeader=true;}}if(l.isSrcTitle){n.isTitle=true;}return n;},getCellLinksInfo:function g(m,n){if(!n){var l=this.getCellTitleInfo(m);n=l&&l.title;}return B(m,n);},getAllDrillPathsForCell:function b(m,o){if(!o){var l=this.getCellTitleInfo(m);o=l&&l.title;}var n=h.filter(o.dp,function(q){var p=q&&q.oid;if(p&&m._e&&m._e.oid){return p===m._e.oid;}return true;});return n;},getCellDrillsInfo:function G(l,n){var m=this.getAllDrillPathsForCell(l,n);return m&&m[l.mix||0];},getLinkDrillAction:function P(l){return this.getActionObject(l);},getAction:function W(l){return this.getActionObject(l);},getActionObject:function M(m){var l=m[0]&&m[0].at,n=null;if(l){if((l&O)>0){n={h:"onLink",a:this.getLinkAction(m[0])};}else{if((l&X)>0){n={h:"onDrill",a:this.getDrillAction(m)};}}}return n;},getSortAction:function F(AA,t){var p=this.getCellTitleInfo(AA),w=p.title,m=[],o=p.isSrcTitle?w.axis:(h.find(this.data.gts.col,"otp",-1)>-1?k:U),z=this.data.gts[((o===k)?"row":"col")+"SubPos"],r,v,u,x,AB;t=(t===null||t===undefined)?!(AA&&AA.so):t;if(p.isSrcTitle){r=E;v=w.id;u=w.otp;x=w.fid;}else{r=L;u=4;AB=w.stt;var s,l;do{s=AA._e;if(s){if(s.oid){v=s.oid;}else{l=s.id.replace(/;/g,"\\;");m.push(l);}}AA=AA._p;}while(AA);}var q={sortType:r,axis:o,isAsc:t,unitID:v,unitType:u,elementList:m.join(";"),subTotalsPos:z};if(v){q.unitID=v;}if(x){q.formId=x;}if(AB){q.sortType=D;q.stt=AB;}var n;if((r===L)||(r===D)){n=["","",q.elementList||"",q.axis];}else{n=[q.formId,"21","",q.axis];}n=[q.unitType,q.unitID].concat(n);q.sortKey=n.join("!");return q;},getSubTotalsPos:function Z(){var l=this.data.gts;if(l){return[l.rowSubPos,l.colSubPos];}return[0,0];},getPivotAction:function N(m,t){var o=false,n=m.hasOwnProperty("mix"),u=n?null:m.axis,r=(n?m.idx:m.ui)+1,AA=(m.otp===-1);if(!isNaN(t)){u=parseInt(t,10);r=1;if(n){n=false;AA=true;}}else{var x=(t==="u"||t==="l"||t==="b");if(!n){var p=H(this.data.gts,u),AC=0,AF={},l=false;mstrmojo.array.forEach(p,function(AG){if(AF[AG.id]){AF[AG.id].frm++;}else{AC++;AF[AG.id]={pos:AC,frm:1};if(AG.id===m.id){l=true;}else{if(l){return false;}}}});r=AF[m.id].pos;var z=m.fix;if(z){if((!x||z>1)&&!this.xtab.isOutlineMode){if(x||z!==AF[m.id].frm){r=z;o=true;}}}}else{var AD=H(this.data.gts,m.axis),w=AD[m.ui].es,s=this.data.gsi.mx;if(w.length!==s.length){var v=w[r+(x?-1:1)-1];if(v){var q=h.find(s,"did",v.oid);if(q!==-1){r=q+(x?1:-1)+1;}}}}if(t==="b"){r=1;}else{r=r+(x?-1:1);}}var AB={act:"pivot",unitPos:r};if(o){AB.attFormId=m.fid;}else{if(!n){AB.axis=u;}}if(!AA){var AE=n?m._e:m;if(!o){AB.unitType=AE.otp;}AB.unitId=n?AE.oid:m.id;}return AB;},isPvtButtonVisible:function f(s,n){var p=s.axis,o=H(this.data.gts,p),r=s.ui,m=s.hasOwnProperty("mix");if(n==="b"&&r===0){return false;}if(!isNaN(n)){if(parseInt(n,10)===p){return false;}if(m){return !!o[s.ui]._hid;}return true;}var q=o[s.ui].es,l=m?q.length:o.length;if(l===1){return false;}if(p===(m?U:k)){if(n==="u"||n==="d"){return false;}}else{if(n==="l"||n==="r"){return false;}}if(m?s._e===q[0]:r===0){if(n==="l"||n==="u"){return false;}}if(m?s._e===q[l-1]:(this.xtab.isOutlineMode&&s.fix)?J(r+1,s,o):r===l-1){if(n==="r"||n==="d"){return false;}}return true;},getDrillAction:function C(l,n){var m=n||this.getCellDrillsInfo(l[0]);return{srcMsgId:this.data.mid,sliceId:this.xtab.sid,isWithin:m.within,drillPathKey:m.k,drillPathIndex:m.dpi,drillElements:R.call(this,l)};},isVis:function c(){if(this.xtab){return this.xtab.isVis&&this.xtab.isVis();}else{var l=this.controller&&this.controller.view;if(l&&l.isVis){return l.isVis();}}return false;},getPTitle:function j(n,m){var l;if(this.isVis()){l=n.titleInfo;}else{l=H(this.data.gts,m)[n.tui];}return l;},getPCellParentNode:function Q(n,m){var l;if(this.isVis()){l=(m===k)?n._lp:n._tp;}else{l=n._p;}return l;},getLinkAction:function V(n,m){var l,o;if(this.isVis()){n=n.node;o=n.titleInfo;}else{l=this.getCellTitleInfo(n);o=l.title;}return this.getLinkActionImpl(n,o,m);},getLinkActionImpl:function a(x,t,v){var n=B(x,t),u=n&&n.links,z=(n&&n.onw)?"_blank":"";if(v===null||v===undefined){v=(n&&n.di)||0;}var q=u&&u[v];if(!q){return null;}var o={linkInfo:q,linkTarget:z};var l=q.url;if(l){var p="&CurrentElement";if(x&&t&&l.indexOf(p)>-1){l=l.replace(p,x._e.id);}o.url=l;}else{var r=q.target,w,m;switch(parseInt(r&&r.t,10)){case 55:if(parseInt(r.st,10)===14081){if(r.dvm&(8192|2048)&&!((r.dvm&2048&&mstrApp.features["run-vi-flash"]))){w=3140;if(mstrmojo.dom.isIE6||mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){mstrmojo.alert(mstrmojo.desc(15474,"To work with HTML5 dossiers, please turn off your browser Compatibility View or update your browser to one of the following browser versions: Chrome, Firefox, Safari, Internet Explorer 9 or above."));return null;}m="objectID";}else{w=2048001;m="documentID";}}else{w=32001;m="documentID";}break;case 3:w=4001;m="reportID";o.reportViewMode=((parseInt(r.st,10)===769)?2:1);break;default:return null;}o.evt=w;o[m]=r.did;o.srcMsgId=this.getMessageId();var s=d.call(this,n,q,x);if(s){o.link=s;}return o;}},getDownloadAction:function Y(o,m,q,n,p,l,r){return{xtabId:p,rowPosition:o,maxRows:m,colPosition:q,maxColumns:n,rowMode:r,memo:l};}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.DocDataService","mstrmojo.array","mstrmojo.hash");var A=mstrmojo,G=A.hash,E=A.array,C=A.EnumRWUnitType,F=A.DocDataService.REQUEST_DEFN_DATA;mstrmojo.vi.models._DataGridActions=mstrmojo.provide("mstrmojo.vi.models._DataGridActions",{_mixinName:"mstrmojo.vi.models._DataGridActions",createViewDataGrid:function D(a,g,I,L,K,j,R){var Y=false,d=this.dataService,X=function(){if(j){return j.k;}var n="K51";try{var m=this.getCurrentLayoutDef(),p=m.btsd||m.btn;if(p){n=p;Y=true;}else{if(this.getTargetDefn("K48").K48){n="K48";Y=true;}}}catch(o){}return n;}.call(this),Z=this.createNewUnitNode(function(m){m.gsi={cols:[],rows:[],mx:[]};return m;},function(n){n.t=C.GRID;var m=n.fmts;m.height="350px";m.width="600px";return new mstrmojo.Model(n);},null,Y?X:this.getNextKey()),h=Z.k,V=this.id,Q=this.getDocBuilder().build([Z],this,{pk:g,isViewDataGrid:true})[0],b=[{act:"changeXtabColWidthScenario",value:2}],P=this.getDataService().newUpdate(),f=0,U=0,W=[],l=[],k=j&&j.node.data,e=j&&G.copy(k),H;if(e){e.gsi=G.clone(k.gsi);mstrmojo.vi.util.ThresholdUtils.addClearAllThresholdsActions(j.model,{data:e},b);}(a||[]).forEach(function(m){b.push(Q.model.getAddTemplateUnitAction(m,m.dsId||K,m.t===4?2:1,m.t===4?U++:f++));});if(j&&R){l.push({act:"pivot",unitId:"",unitType:"",axis:2,unitPos:1});E.forEach(R.zones,function(m){if(m.id!==1){E.forEach(m.items,function(n){if(n.t===12){l.push({act:"pivot",unitId:n.did,unitType:12,axis:1,unitPos:1});}});}E.forEach(m.items,function(n){if(n.t===4&&n.did!=="-1"){W.push({unitId:n.did,unitType:4,regions:["g"]});}});});if(!Y){if(W.length>0){b.push({act:"formatGridZone",nodeKey:h,props:{FormattingPatterns:{FillColor:16777215,FillStyle:0},FormattingFont:{Color:6974058},FormattingAlignment:{Horizontal:4}},units:W,axis:[{axis:1,regions:["sg"]},{axis:2,regions:["sg"]}]});}b.push({act:"formatGridZone",nodeKey:h,props:{FormattingPatterns:{FillColor:16777215,FillStyle:0},FormattingFont:{Color:6974058},FormattingAlignment:{Horizontal:2}},units:[],axis:[{axis:1,regions:["g","sh"]}]},{act:"formatGridZone",nodeKey:h,props:{FormattingPatterns:{FillColor:15461355,FillStyle:0},FormattingFont:{Color:6974058},FormattingAlignment:{Horizontal:2}},units:[],axis:[{axis:1,regions:["h"]},{axis:2,regions:["h","g","sh"]}]},{act:"formatGridZone",nodeKey:h,props:{FormattingAlignment:{Horizontal:4}},units:[],axis:[{axis:2,regions:["h","g","sh"]}]});}b=b.concat(l);b.push({act:"advancedProperties",props:{"Template Formatting":{MergeCells:"0",MergeColumnCells:"0",LockColumnHeaders:"-1",LockRowHeaders:"0",Indented:0}}});}P.addActions(Y?d.getMoveNodeAction(Z,g):{act:"copyUnit",unitKey:X,unitType:521,newKey:h,toKey:g});P.addActions({act:"updateTemplate",keyContext:h,partialRetrieval:d.newRetrievalKeysConfig().addNode(h,{data:{exclude:{vfexpr:true}}}),actions:b});P.addActions(this.getUnitFormatAction(Z,1,{FormattingSize:{Height:0,Width:0}}));if(j&&R){H={act:"format",unitKey:h,unitType:521,formatType:1,format:{Visualization:{VisualizationsEnabled:0,ViewMode:0,SelectedVisualization:"",IPhoneVisualization:"",IPadVisualization:"",APhoneVisualization:"",ATabletVisualization:""},FormattingIncrementalFetch:{EnableIFOnGrid:-1},FormattingWidget:{ClassName:"",Enable:0,WidgetProps:""},FormattingPatterns:{FillColor:16777215,FillStyle:0},FormattingView:{Title:R.n||"Visualization"},FormattingBorder:{TopStyle:0,LeftStyle:0,BottomStyle:0,RightStyle:0}}};if(j.isSdp){H.format["FormattingAppearance"]={Visible:1};}P.addActions(H);}if(!G.isEmpty(I)){P.addActions(this.getKeepOnlyOrExcludeAction(h,I));}if(K){P.addActions({act:"editNode",nodeKey:h,datasetId:K});}if(j&&R){var c=j.parent.parent;E.forEach(c.getTargetKeysByType([C.SELECTOR]),function(q){var m=c.getUnitByKey(q).defn,n=m.srct,p=m.srcst,r=((n===47&&p!==12033)||n===1),o;if((m.tks||"").indexOf(j.k)>-1){o=this.dataService.getAddCtrlTargetAction(m.ck,h,null,r,true,true);delete o.partialRetrieval;P.addActions(o);}},this);var O=true,S,J=j.getFilterType()===1;E.forEach(c.getTargetKeysByType([C.GRID,C.GRAPH,C.MOJOVISUALIZATION]),function(n){var p=c.getUnitByKey(n).boxContent,o=p.defn.an,m=E.find(o,"k",j.k)!==-1,q;if(m){if(O){S=this.getNextKey();}q=p.findSelectorControl();if(q){P.addActions({act:"addVisToFilter",parentKey:n,targetKey:h,ctrlKey:q.ckey,newCGB:O,cgbKey:S});if(!J){O=false;}}}},this);}P.addActions({act:"changeGridDisplayMode",nodeKey:h,displayMode:1});P.addCallbacks({success:function M(n){var m=mstrmojo.all[V];m.partialUpdate(n.data,m.getTargetDefn(h),n.defn,n.pukeys&&n.pukeys.split("\u001E"),n.puFilters);L.success(Q);},failure:L.failure});P.addExtras(F);this.execute({execute:function N(){this.submitUpdate(P,mstrmojo.all[V].cmdMgr().CMD_PHASE.FIRST);}});return Y;},removeViewDataGrid:function B(H,X,J,Z){var P=this.cmdMgr(),Y=P.getInterimCmd(),S=this.getDataService(),M=S.newUpdateWithoutCmd(),U=H.zonesModel.getDropZones().zones,V=[],O=[];if(J){U.forEach(function(a){a.items.forEach(function(b){if(parseInt(b.did,10)!==-1){V.push(H.model.getRemoveTemplateUnitAction(b));}});});if(V.length>0){O.push({act:"updateTemplate",keyContext:H.k,actions:V});}O.push(S.getMoveNodeAction(H,"K12"));}else{O.push({act:"removeUnit",unitKey:H.k,unitType:H.defn.t});}if(!X){M.addCallbacks(Z);M.extras={params:{suppressData:true},config:{silent:false},style:{params:{treesToRender:0}}};M.addActions(O);Y.isUntracked=true;Y.submit(M.actions,M.callback,M.extras,P.CMD_PHASE.LAST);}else{var R=this.id,L,W,N,Q,I;M.addCallbacks(Z);if(X){W=this.createNewVizNode({title:mstrmojo.desc(11693,"Visualization")});N=this.getCurrentLayoutKey();Q=this.getPanel(null,N);L=Q.k;I=this.getDocBuilder().build([W],this,{pk:L})[0];M.addActions([{act:"macroCopyUnit",unitKey:H.k,unitType:521,newKey:I.k,toKey:L},mstrmojo.all[R].getUnitFormatAction(W,1,{FormattingView:{Title:mstrmojo.desc(11693,"Visualization")}})]);Q.insertNewBoxAndSaveDeferred(M,I);M.actions.forEach(function(a){delete a.partialRetrieval;});M.actions[0].partialRetrieval=S.newRetrievalKeysConfig().addNode(I.k);}M.addActions(O);M.addCallbacks({success:function K(d){var b=mstrmojo.all[R];b.partialUpdate(d.data,b.getTargetDefn(I.k),d.defn);var c=b.getCurrentLayoutKey(),a=E.filterOne(b.data.layouts,function(e){return(e.k===c);});b.updateDataCache({layouts:[a]},b.getTargetDefn(L));b.selectVIUnit(Q.rebuildChild(I).id);}});M.addExtras(F);Y.urInfo.extraPuKeys=[Q.k];Y.submit(M.actions,M.callback,M.extras,P.CMD_PHASE.LAST);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.EnumRWUnitType","mstrmojo.DocDataService","mstrmojo.func","mstrmojo.array","mstrmojo.vi.viz.KnownVisualizations","mstrmojo.VisEnum","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.controllers.ControlUtils","mstrmojo.vi.controllers.EnumEvents","mstrmojo.gmaps.EnumGraphicType");mstrmojo.requiresClsP("mstrmojo.vi.models","EnumPanelTypes");var h=mstrmojo.array,P=mstrmojo.hash,m=mstrmojo.func,j=mstrmojo.EnumRWUnitType,O=mstrmojo.vi.models.VIComponentMap.TYPES,Y=mstrmojo.vi.viz.KnownVisualizations,a=mstrmojo.vi.models.EnumPanelTypes,E=mstrmojo.vi.viz.EnumVizStyles,B="\u001E",D=mstrmojo.DocDataService.REQUEST_DEFN_DATA,I=mstrmojo.DocDataService.SUPPRESS_DATA,F=mstrmojo.vi.controllers.ControlUtils,V=mstrmojo.VisEnum.VIS_CARDLIMIT.NON_GRID,C=mstrmojo.vi.controllers.EnumEvents;var J=4,Q=[Y.HEATMAP];function H(r){r=r||{};return this.createNewUnitNode(function(s){s.eg="";if(r.fnData){s=r.fnData(s);}return s;},function(s){s.t=j.GRID;s.n=r.n||"";s.ttl=r.title||s.n;s.ds=0;s.tt=1;s.eo=0;if(r.fnDefn){s=r.fnDefn(s);}return new mstrmojo.Model(s);},r.fnNode,r.nodeKey,r.layoutKey);}function c(w,x,v,t,z,AB){var AA=w.getDataService(),u=x.boxContent,r=w.getMapLayerKeys(u),s=[];h.forEach(r,function(AD){var AF,AC=w.getLayoutUnitDefn(AD),AE={k:AD,defn:{t:AC.t||522}};if(v){t.addActions(AA.getMacroMoveNodeAction(AE,z));}else{AF=w.getNextKey();s.push(AF);t.addActions(AA.getMacroCopyNodeAction(AE,z,AF));}});if(s&&AB){t.addActions(w.getFormatSDPAction(AB,s));}return s;}function R(AM,AF,v,AD,AN){var s=AF.k,AJ=v.k,AH=AF.parent.children,AL=[],AB=AF.boxContent,x=AB.getFilterType()===1,AC=true,AG,u,AK=AM.getDataService(),t=[AJ].concat(AN||[]);h.forEach(AH,function(AQ){var AP=AQ.defn.an,AO=h.find(AP,"k",s)!==-1,AR;h.forEach(t,function(AS){if(AC){AG=AM.getNextKey();}if(AO){AR=AQ.boxContent.selectorControl;AL.push(AQ.k);AP.push({k:AS,muc:24});AD.addActions({act:"associateNodes",nodeKey:AQ.k,targetKeys:[AS],partialRetrieval:AK.newRetrievalKeysConfig().addNode(AQ.k)});if(AR){AR.cgb[P.keyarray(AR.cgb).length+1]=AG;AD.addActions({act:"addVisToFilter",parentKey:s,targetKey:AS,ctrlKey:AR.ckey,newCGB:AC,cgbKey:AG});}}});if(!x){AC=false;}});if(AB&&AB.selectorControl){var AE=AM.getCurrentLayoutDef().cgbMap,AI=[],z=[],r=AB.selectorControl,w=function(AO){var AP;P.forEach(AE,function(AQ,AR){if(P.valarray(r.cgb).indexOf(AR)!==-1&&AO===AQ){AP=AR;}});return AP;},AA;t=[];u=(r.tks||"").split("\u001E");u.forEach(function(AO){var AS,AQ,AP,AR=(AH.filter(function(AT){return AT.k===AO;}))[0];if(AR){AA=AR.boxContent.getFilterType();}if(AA===1){t.push(AO);AS=AM.getNextKey();AE[AS]=AO;AI.push([AS,true]);AQ=w(AO);P.forEach(r.cgb,function(AU,AT){if(AU===AQ){AP=AT;}});if(AP){r.cgb[AP]=AS;}z.push([AQ,false]);}});if(t.length){AD.addActions({act:"replaceControlCGB",oldCGBNodeKey:z,targetKeys:t,newCGBNodeKeys:AI,controlKey:AB.selectorControl.ckey,sourceKey:s});}}if(AL.length>0){AD.addCallbacks({success:function(AO){AM.partialUpdate(AO.data,AM.getTargetDefn(AL),AO.defn,AL);}});}}function n(u,v,s,t,r,w){u.execute({execute:function(){var AS=u.getDataService(),AM=u.cmdMgr(),AU=this,AN=u.controller.view,AJ=AS.newUpdate(),AL=v.parent,AP=AL.k,AC=u.getCurrentLayoutKey(),AZ,AK=r===AC,AA=v.k,AR,AQ,AT,AO,AD;if(w&&v.boxContent&&v.boxContent.updateAssociatedNodesOnMove){v.boxContent.updateAssociatedNodesOnMove();}if(AK){AO=!!t;if(!AO){AZ=u.addPanel(AJ,s.k);t=AZ.k;AT=true;var AG=s.id,AW=s.parent.id,AI=s.k,z=function(){this.urInfo.puKeys=[AI];}.bind(this);this.urInfo=P.copy({undo:function(){z();var Aa=u.getLayoutUnitDefn(t,r);if(Aa){Aa._isDeleted=true;}this.urInfo.extras.style.params.treesToRender=3;},redo:function(){z();var Aa=u.getLayoutUnitDefn(t,r);if(Aa&&Aa._isDeleted){delete Aa._isDeleted;}},callback:m.wrapMethods({success:function(Aa){u.controller.view.updateXtabStyles(r,Aa.data.layouts[h.find(Aa.data.layouts,"k",r)].xtabStyles);u.updateDefnCache(Aa.defn,[AI,AP,t]);u.updateDataCache(Aa.data,u.getTargetDefn(AI));var Ab=mstrmojo.all[AW];Ab.rebuildChild(mstrmojo.all[AG]);Ab.doLayout();u.raiseEvent({name:C.UPDATE_TOC});}},u.getRebuildCallback())},this.urInfo);}else{AZ=u.getPanel(t);AT=t===AP||AZ.defn.l;if(t!==AP){this.urInfo=P.copy({undo:function(){this.urInfo.puKeys=[AP];},redo:function(){this.urInfo.puKeys=[t];},callback:m.wrapMethods({success:function(){u.getPanel(AP).unload();u.getPanel(t).unload();}},u.getRebuildCallback()),treesToRender:3},this.urInfo);}}AQ={parentKey:t};}else{if(r){AT=false;AO=true;u.markDirtyLayout(r);AN.showLayout(AN.getLayout(r),null,AJ);AQ={layoutKey:r,analysisSectionType:a.VISUALIZATION};AU.urInfo=P.copy({callback:m.wrapMethods({success:function(){if(w){u.markDirtyLayout(AC);}u.markDirtyLayout(r);}},u.getRebuildCallback())},this.urInfo);}else{AT=false;AO=false;r=u.getNextKey();t=u.getNextKey();AD=AM.CMD_PHASE.FIRST;AN.addNewLayout(AJ,-1,{nodeKey:r,newPanelKey:t,analysisSectionType:a.VISUALIZATION});AQ={parentKey:t};AU.urInfo=P.copy({callback:F.rebuildAndUpdateTOCcallback.call(u)},AU.urInfo);}}if(w){AR=AA;var x=u.getTargetDefn(AA)[AA];if(x&&x.gi){var AF=x.gi,AH=u.id,AY=function(Aa){var Ab=mstrmojo.all[AH];if(Ab){var Ac=Ab.getTargetDefn(AA)[AA];if(Ac){if(Aa){Ac.gi=AF;}else{delete Ac.gi;}}}};m.wrapMethods({undo:function(){AY(true);},redo:function(){AY(false);}},AU.urInfo);delete x.gi;}if(!AL.hasMultipleChildren()){var AV=u.addVisualizationDeferred(AJ,AP).k;AJ.addCallbacks({success:function(Aa){var Ab=null;h.forEach(Aa.defn.layouts,function(Ac){if(Ac.k===AC){Ab=Ac.units[AV];return false;}});u.getLayoutDefn(AC).units[AV]=Ab;}});}AL.deleteBoxAndSubmitDeferred(AJ,v,undefined,true,true);AJ.addActions(AS.getMacroMoveNodeAction(v,AQ));c(u,v,w,AJ,AQ);if(AT){v.unrender();AZ.insertNewBoxAndSaveDeferred(AJ,v);AJ.addCallbacks({success:function(Ab){var Aa=[t,v.k];u.updateDefnCache(Ab.defn,Aa);u.updateDataCache(Ab.data,u.getTargetDefn(Aa.join(B)));AZ.rebuildChild(v);}});}else{if(!AK){u.markDirtyLayout(AC);}v.destroy();}}else{var AB=H.call(u,{n:v.title,layoutKey:r}),AX;AR=AB.k;AJ.addActions(AS.getMacroCopyNodeAction(v,AQ,AR));AX=c(u,v,w,AJ,AQ,AB);if(AT){var AE=u.createUnit(AB,t);u.deferredInsertUnit(AJ,AE,t);if(AP===t){R(u,v,AE,AJ,AX);this.urInfo.puKeys=[AP];}}}if(AK){if(!AO){u.selectNewPanel(AJ,t);}else{if(AP!==t){s.selectPanelDeferred(AJ,t);}}}if(AO){if(!AT){AD=AM.CMD_PHASE.FIRST;AJ.addCallbacks({success:function(){AZ=u.getPanel();var Ab=AZ.getUnitByKey(AR),Aa=AM.getInterimCmd();if(!AZ.hasBoxLayoutChild(Ab)){AZ.insertNewBox(Ab);}if(AZ.defn.layoutXML){AZ.saveBoxLayout(Aa,AM.CMD_PHASE.LAST,null,null,true);}else{AZ.saveBoxLayout(Aa,AM.CMD_PHASE.LAST,null,null,true);}}});}AJ.addCallbacks({success:function(){var Aa=AZ.getUnitByKey(AR);Aa.selectVIUnit();},complete:function(){AZ.restoreAnyMaxedVizBox();}});}AJ.addExtras(D);this.submitUpdate(AJ,AD);},urInfo:{treesToRender:3}});}function K(AC,AB,w,t,u,AE){var x=this,AD=[],AA=[],AF,s,r=[],AG=this.getCGBMap(),z=function(){return h.filter(P.keyarray(AG),function(AH){return u.indexOf(AG[AH])>-1;});},v;if(w){w.forEach(function(AH){AD.push(AH.k);});AF={act:"clearVisAsFilter",nodeKey:t,associatedNodes:AD,partialRetrieval:{nodes:AD}};if(AB){h.forEach(P.valarray(AB.cgb),function(AH){r.push([AH,x.getSourceControls(AC,AH).length<=1]);});AF.cgbNodeKeys=r;AF.controlKey=AB.ckey;}s=AE?{success:function(AH){x.partialUpdate(AH.data,x.getTargetDefn(AD));}}:m.wrapMethods(this.associatedNodesUpdate([AC]).callback,this.controller._getXtabCallback(AC.boxContent));AA.push(AF);}if(AE){v=z();h.forEach(v,function(AQ){var AP=AG[AQ],AH=x.getSourceControls(AC,AQ),AJ=false,AM,AN,AK,AR,AO,AL,AI;delete AG[AQ];h.forEach(AH,function(AS){AK=AS.bc;AI=AS.control;AR=AK&&AK.isVisMap;AO=AR?AK.getKeyForTemplateSelection():AS.sourceKey;AL=AR?AK.getWidgetForTemplateSelection().node:AK.node;AM=AI.tks.split("\u001E");AF={act:"clearVisAsFilter",nodeKey:AO,associatedNodes:[AP],cgbNodeKeys:[[AQ,!AJ]],controlKey:AI.ckey,removeControl:AM.length===1,partialRetrieval:{nodes:[AO]}};AJ=true;if(AM.length>1){AN=P.valarray(AI.cgb);AN.splice(AN.indexOf(AQ),1);AI.cgb={};h.forEach(AN,function(AU,AT){AI.cgb[AT]=AU;});AM.splice(AM.indexOf(AP),1);AI.tks=AM.join("\u001E");if(AL.defn&&AL.defn.an){AL.defn.an.splice(h.find(AL.defn.an,"k",AP),1);}}else{delete AL.data.sc;delete AL.defn.an;delete AK.selectorControl;}AA.push(AF);});});}if(AA.length>0){return{actions:AA,callback:s,extras:{style:{params:{treesToRender:AE?2:3}}}};}}mstrmojo.vi.models._VisActions=mstrmojo.provide("mstrmojo.vi.models._VisActions",{_mixinName:"mstrmojo.vi.models._VisActions",createNewVizNode:H,addVisualizationDeferred:function(x,w,s){var r=this,v=mstrmojo.desc(11659,"New Visualization"),u=r.createNewUnitNode(null,null,null,null,s);s=s||this.getLayoutKeyByUnitKey(w);P.copy({t:j.GRID,ttl:v,n:v,ds:0,tt:1,eo:0},u.defn);u.data.eg="";var t=r.createUnit(u,w,s);x.addActions([r.getCopyEmptyTemplateAction(t.k,w,s)]);r.deferredInsertUnit(x,t,w);x.actions.some(function(z){if(z.unitKey===t.k){z.partialRetrieval={nodes:[t.k]};return true;}});x.addExtras(D);return t;},addVisualization:function N(){var r=this,s,t,u=this.getPanel().k;r.execute({execute:function(){var w=r.getDataService(),x=w.newUpdate(this);var v=r.addVisualizationDeferred(x,u);s=v.k;t=v.boxContent.node;this.submitUpdate(x);},urInfo:{treesToRender:3,undo:function(){this.urInfo.puKeys=[];this.urInfo.callback={};var w=r.getUnitInstance(u,1),v=w.getUnitByKey(s),z=r.getLayoutUnitDefn(s),AA=r.getLayoutUnitDefn(z.pnk),x=AA.layoutXML;z._isDeleted=true;x.children=x.children.filter(function(AB){return AB.k!==s;});w.removeChildren(v);v.destroy();r.restoreUIState(this.undoUIState);return true;},redo:function(){this.urInfo.puKeys=[s];this.urInfo.callback={success:function(w){var z=r.createUnit(t,u),v=r.getUnitInstance(u,1),x=r.getLayoutUnitDefn(s);if(x){delete x._isDeleted;}v.addChildren(z);v.boxLayoutConfig.dirty=true;r.partialUpdate(w.data,r.getTargetDefn([s]),w.defn,[s]);v.rebuildChild(z);}};return false;}}});},duplicateVisualization:function W(t){var r=this.getCurrentLayoutKey(),s=t.boxContent.builder.getLayoutVIMap(r).getComponent(O.VIZ_CONTENT);n(this,t,s,s.selectedKey,r,false);},copyVisualization:function(u,s,t,r){n(this,u,s,t,r,false);},moveVisualization:function(u,s,t,r){n(this,u,s,t,r,true);},renameRWUnitTitle:function p(t,s,r,u){this.updateTitle(t,s,r,this.currlaykey,"ttl",u);},changeSelectedVisType:function k(AU,AO,AB,AG){var AQ=this.getSelectedViUnit();if(!AQ){return ;}var AJ,u=this,AP=[],AH=AQ.boxContent,AR=AH.k,AZ=AH.node.data,AW=AZ.visName,AX=(typeof AH.getVisType==="function"?AH.getVisType():{}).vt,v=typeof AO==="object"?[AO.v,AO.h]:[AO],AY=AW||"",s=AW===E.ESRI_MAP||AW===E.GOOGLE_MAP||AW===E.MAPBOX,AM=Y.getDefinition(AU),z=this.controller.visTransitionFactory.newVisualizationTransition(AU||"Grid",{vis:AH,newVizInfo:{s:AU,dz:AG}});if(AY===AU){var r=z.isGraphMatrix(AX)||z.isGraphMatrix(v[0]);if(r&&(v[0]!==undefined&&AX===v[0]||v[1]!==undefined&&AX===v[1])){return ;}else{if(!r){return ;}}}if(s){AJ=this.getMapLayerKeys(AH);AP=this.getExtraActionsForChangeMapViz(AH,AJ,AP);}if(Y.getDefinition(AW||"Grid").id===Y.GRID&&Q.indexOf(AM.id)===-1){var x=[];z.addClearAllThresholdsActions(x);AP.push({act:"updateTemplate",keyContext:AH.k,actions:x});}if(AU!==""&&AM.id!==Y.UNKNOWN){AP.push({act:"updateTemplate",keyContext:AH.k,actions:[{act:"createDefaultDropZones",nodeKey:AH.k,treeType:AH.defn.tt,datasetId:AZ.datasetId,datasetType:3,widgetType:AB,partialUpdate:{nodes:[AH.k]}}]});}var AL=z?z.transitionDropZones(AP,AO):{wp:""},AE=AL.wp,t=AL.wgtName,AD=AL.handled,AI=[],AF=z&&z.vis,AT=(AF&&AF.node&&AF.node.data&&AF.node.data.gts)||{},AK=(AT.col||[]).concat(AT.row||[]);if(AB){h.forEach(AK,function(w){AI.push(w);});}var AA=[],AV={},AS,AC=function(Aa){if(!Aa.id){Aa.id=Aa.did;}var w=Aa.id;AV[w]=Aa.card;};P.keyarray(this.datasets).forEach(function(w){AA.push(w);});for(AS=0;AS<AA.length;AS++){h.forEach(this.datasets[AA[AS]].att,AC);}h.forEach(AI,function(w){if(!w.id){w.id=w.did;}if(!w.cardg&&!w.card){w.card=AV[w.id];}});var AN=AL&&AL.gtp;z.vis.zonesModel.addAttributeNameAndTargetVisForAddUnits(AF.node.data,AI,AU,AN,AL&&AL.ln);z.vis.zonesModel.checkAndWarnLargeItemsForAddUnits(AI,function(Aj,Aa){if(AE.length>0&&!AD){var Al=this.getWidgetClassNameByStyle(AU,AB),Ac=t?({FormattingAppearance:{Name:t}}):undefined,Ab=D,Ae=function(w){if(s&&AJ&&AJ.length>0){u.syncLayerDefn(AR,AJ,w);}},Ad={undo:function Ah(){Ae(false);},redo:function Af(){Ae(true);}},Ak=Aa.k;AP.push(this.getUnitChangeVizAction(AU,Al,Aa,AE,Ac));AP.push({act:"changeGridDisplayMode",nodeKey:Ak,displayMode:AU===E.GRAPH_MATRIX?2:1});if(AU==="KPICardVisualizationStyle"){AP.push(this.getDataService().getUpdateTemplateAction(AR,{act:"clearSort"}));}if(Aj.model.data.eg!==undefined){Ab=P.copy(Ab,{preserveUndo:true});}var Ag=this;var Ai=function(w){var Am=[].concat(AP);if(w){Am=Ag.wrapUnsetVisualizationFilterAction(AP);}Ag.controller.submitUndoRedoUpdates(Am,null,{success:function An(Aw){var Ao=Ag.getCurrentLayoutKey(),At,Ap=Ag.getPanel();Ag.refreshDefinition(Ak,Ag.getRawLayoutUnitDefn(Ak,Aw.defn));Ag.updateDataCache(Aw.data,Ag.getTargetDefn(Ak));if(w){var Ax=Ag.getSelectedViUnit(),Ar=Ax&&Ax.boxContent,Aq=Ar&&Ar.k,Au=Aw.pukeys,As=Au&&Au.split("\u001E"),Av=(As&&As.indexOf(Aq))||-1;if(Aq&&Av!==-1){As.splice(Av,1);Au=As.join("\u001E");}if(Au){At=u.getUnitDefinitions(Au);}Ag.partialUpdate(Aw.data,At,Aw.defn,As,Aw.puFilters);}if(Aw.data){Aw.data.layouts.some(function(Az){var Ay=Az.k===Ao;if(Ay){Ag.controller.view.updateXtabStyles(Ao,Az.xtabStyles);}return Ay;},Ag);}if(mstrApp.isInVFConfigMode){Ag.selectVIUnit(Ag.rebuildVizBox(Ak).id,true);}else{Ag.selectVIUnit(Ap.rebuildChild(Ap.getUnitByKey(Ak)).id,true);}}.bind(Ag)},Ab,Ad);};Ag.checkAndNotifyVFChangeOnVisTypeUpdate({},function(){Ai(true);},function(){Ai(false);});}}.bind(this,AH,AQ),null,!AB,null,false,V);},getUnitChangeVizAction:function Z(z,r,x,w,t){var s=Y.getDefinition(z);var v={IPhoneVisualization:"",IPadVisualization:"",APhoneVisualization:"",ATabletVisualization:""};if(s&&s.mobileVIStyles){v=P.copy(s.mobileVIStyles,v);}var u={Visualization:P.copy(v,{VisualizationsEnabled:z?-1:0,ViewMode:z?51:0,SelectedVisualization:z||"",VisualizationList:z||""}),FormattingIncrementalFetch:{EnableIFOnGrid:z?0:-1},FormattingWidget:{ClassName:z?r:"",Enable:(r!=="")?1:0}};if(w){u.FormattingWidget.WidgetProps=w;}P.forEach(t,function(AB,AA){if(!u[AA]){u[AA]={};}P.forEach(AB,function(AC,AD){u[AA][AD]=AC;});});return this.getUnitFormatAction(x,1,u);},setVisAsFilter:function A(Ai,Aa,AU){var Ae=[],Ab=Aa.sc,AY=Aa.targetKeys,Af=Aa.isFilter,AP=Aa.clearAll,AR=Aa.isNav,Am=Aa.navPage,s=this,AS=Aa.srcKey,Aj=this.getLayoutKeyByUnitKey(Ai.k),AD=[],AM=[],Ag=[],AC=[],AK=false,AF,AL,AV,x=[],AI=[],AQ=Aa.forAllData!==undefined&&Aa.forAllData,r=false,AO=false,AB=Aa.singleUnit,AJ=s.getCurrentLayoutDef().cgbMap,t={},AG,v=[],An,Al=Ai&&Ai.boxContent,AT=Al.isVisMap,u=Aa.isLayerChanged,AZ=AT?(u?Aa.layerKey:Al.getKeyForTemplateSelection()):Ai.k,AH=AT?(Al.getKeyForTemplateSelection()):Ai.k,AE,w=(AT?Al.getWidgetForTemplateSelection(AH):Al).node,Ah=function Ah(){delete Ai.defn.an;},z=function(){if(AP===undefined&&Ab){return Ab.all||Ab.showall;}return AP===undefined?true:!!AP;},Ak=function(){if(AK&&Af===undefined){if(Ag.length===AC.length){return true;}return !!Ab;}if(Af!==undefined){return Af;}return true;},AX=I,Ad=function(Ap){var Ao=false;P.forEach(AY,function(Aq){if(Aq.cgbs&&Aq.cgbs.length){Aq.cgbs.forEach(function(Ar){Ao=Ao||P.valarray(Ar.sc.cgb).indexOf(Ap)!==-1;});}});return Ao;},AN=function(At){var Ar=false,Aq=s.getPanel().defn.ck,As=s.defn.layoutMap[s.getCurrentLayoutKey()],Ap=As&&As.units,Ao,Au;if(Ap){P.forEach(Aq,function(Aw,Av){Ao=Ap[Av];Au=Ao&&(Ao.t===j.SELECTOR)&&Ao.cgb&&P.valarray(Ao.cgb);if(Au&&Au.length){if(Au.indexOf(At)!==-1){Ar=true;return false;}}});}return Ar;};if(u){AK=true;}mstrmojo.hash.forEach(AY,function(Ap,Ao){if(Ap.c){AK=true;AC.push(Ao);}if((Ap.v&&!Ap.c)||(!Ap.v&&Ap.c)||(u&&w.defn.an)){AM.push(Ao);}if(Ap.v){Ag.push(Ao);}return true;},this);if(AB){AD=[Ai.k];AX=D;}var AA=Ag.length;if(AA===0&&!AB&&(!!w.defn.an&&w.defn.an.length>0)){if(Ab){Af=undefined;}else{Af=false;}}if(AB&&!AQ&&AK){h.forEach(P.valarray(Ab.cgb),function(Ao){v.push([Ao,true]);delete AJ[Ao];});if(!AA){AF={act:"clearVisAsFilter",nodeKey:Ai.k,associatedNodes:AM,cgbNodeKeys:v,controlKey:Ab.ckey};AD=AD.concat(AM);r=true;}else{Ag.forEach(function(Ao){x.push(s.getNextKey());if(AD.indexOf(Ao)===-1){AD.push(Ao);}},this);AF={act:"updateSingleUnitControl",controlKey:Ab.ckey,nodeKey:Ai.k,removeTargetKeys:v,newTargetKeys:Ag,CGBKeys:x,unitId:Aa.unitId};}Ae.push(AF);}else{if(AQ||AK||Af!==undefined){AF={act:"clearVisAsFilter",nodeKey:AH};if(AM){AF.associatedNodes=AM;AD=AD.concat(AM);}if(Ab){h.forEach(P.valarray(Ab.cgb),function(Ap){var Ao=s.getAllSources(Al,Ap).length<=1;if(Ao){delete AJ[Ap];}v.push([Ap,Ao]);});AF.cgbNodeKeys=v;AF.controlKey=Ab.ckey;}if(Ab||!P.isEmpty(AM)){r=true;Ae.push(AF);AX=D;}}if(AQ||(AK&&AA>0)||Af!==undefined){if(Ak()){AV=s.getNextKey();}Ag.forEach(function(Ao){if(Ak()){AL=AY[Ao].ft;if(!AL){AG=true;P.forEach(AJ,function(Ap,Aq){if(Ao===Ap&&!Ad(Aq)&&!AN(Aq)){x.push([Aq,false]);AG=false;}});if(AG){An=s.getNextKey();t[An]=Ao;x.push([An,true]);}}else{An=s.getNextKey();t[An]=Ao;x.push([An,true]);}}if(AD.indexOf(Ao)===-1){AD.push(Ao);}AI.push(Ao);},this);Ae.push({act:"setVisAsFilter",sourceKey:AZ,targetKeys:AI,controlKey:AV,CGBKeys:x,showAll:z(),fos:Ak(),isNav:AR});AX=Ak()&&s.hasUnitSelector?D:AX;AO=true;}}if(!AO&&AA>0&&AP!==undefined){Ae.push({act:"setControlShowAll",nodeKey:AZ,controlKey:Ab.ckey,showAll:AP});}if(Ae.length){P.copy(t,AJ);Ae[0].partialUpdate={nodes:AD};if(!AU){var Ac=function(){if(Al){Al.raiseEvent({name:"regenerateToolbar"});}},AW=function(){this.execute({execute:function(){var Ao=s.getDataService();AU=Ao.newUpdate(this);AU.addActions(Ae);AU.addExtras(AX);if(AX!==I){AU.addCallbacks(s.getRebuildCallback());}AU.addCallbacks({success:function(){var Av=[],At,Au=mstrmojo.all[Al.id],Ar=s.getLayoutKeyByUnitKey(Au.k),Ap=Ar&&s.getLayoutDefn(Ar),Aw,Aq,As;if(r){Aw=w.data.sc||{};h.forEach(Aw.cgb,function(Ax){if(Aw.isNavigation&&Ap){As=Ap.units[Ax];if(As){As.scs=As.scs||[];Aq=h.find(As.scs,"ckey",Aw.ckey);if(Aq>-1){As.scs.splice(Aq,1);if(!As.scs.length){delete Ap.units[Ax];}}}}});delete w.data.sc;delete w.defn.an;if(Au&&Au.deleteSelectorControl){Au.deleteSelectorControl();}As=Ap.units[Au.k];if(As){delete As.an;}}AE=(AT?Au.getWidgetForTemplateSelection(AZ):Au).node;if(AO){if(Ak()){h.forEach(x,function(Ax){Aq=Ax[0];Av.push(Aq);if(AR&&Ap){As=Ap.units[Aq];if(As){As.scs=As.scs||[];if(h.find(As.scs,"pnk",Au.k)===-1){As.scs.push({ckey:AV,isNavigation:true,pnk:Au.k});}}else{Ap.units[Aq]={pnk:AS,t:j.UNITCONTAINER,isNavigation:false,scs:[{ckey:AV,isNavigation:true,pnk:Au.k}]};}}});AE.data.sc={ck:[1].concat([AZ,AV]).join(B),ckey:AV,ct:6,showall:z(),cgb:Av,tks:AI.join(B),isNavigation:AR,navPage:Am};}At=AE.defn.an=[];AI.forEach(function(Ax){At.push({k:Ax,muc:24});},this);}if(!AO&&AA&&AP!==undefined){AE.data.sc.showall=AP;}if(Au&&Au.findSelectorControl){Au.findSelectorControl();}},complete:Ac});this.submitUpdate(AU);},urInfo:{treesToRender:3,undo:Ah,redo:Ah,extraPuKeys:AB?null:h.distinct([AH,AZ]),puKeys:AX===I&&h.distinct([AH,AZ]).concat(AD),callback:m.wrapMethods(s.getRebuildCallback(),{success:Ac})}});};if(AR){s.raiseEvent({name:"layoutSelected",panelKey:AS,layoutKey:Aj,callback:{complete:AW.bind(this)}});}else{AW.call(this);}}else{AU.addActions(Ae);}}return r;},updateVisSelector:function S(u,x,w,r){if(!u){return ;}var v=[],t=u.node,s;h.forEach(r,function(z){v.push(z[0]);});t.data.sc={ck:[1].concat([u.k,x]).join(B),ckey:x,ct:6,showall:true,cgb:v,tks:w.join(B)};s=t.defn.an=[];w.forEach(function(z){s.push({k:z,muc:24});},this);t.data.sc.showall=true;if(u.findSelectorControl){u.findSelectorControl();}},getAllSources:function l(r,AC){var u=function(AF){return AF.selectorControl||(AF.findSelectorControl&&AF.findSelectorControl());},t=u(r),v=((t&&t.tks)||"").split(B),w=this.getLayoutKeyByUnitKey((v.length&&v[0])||AC),AE=this.getVizContentPanel(w).children,AD=w&&this.getLayoutDefn(w).units[AC],AB,s,x=(AD&&AD.scs)||[],AA=P.copy(x,[]),z;h.forEach(AE,function(AF){AB=u(AF.boxContent);if(AB&&P.valarray(AB.cgb).indexOf(AC)>=0){if(parseInt(AB.ct,10)===6){s=AF.k;if(h.find(x,"pnk",s)<0){AA.push({bc:z,sourceKey:s,control:AB});}}}});return AA;},getSourceControls:function q(u,t){var s=u.parent.children,w,r=[],v;h.forEach(s,function(x){v=x.boxContent;w=v.selectorControl||(v.findSelectorControl&&v.findSelectorControl());if(w&&P.valarray(w.cgb).indexOf(t)>=0){r.push({bc:v,sourceKey:x.k,control:w});}});return h.filter(r,function(x){return Number(x.control.ct)===6;});},clearVisAsFilterAction:function e(x,z){var w=x.boxContent,t=w.isVisMap,r=w.selectorControl,u=t?w.getDefnAnForTemplateSelection():x.defn.an,s=t?w.getKeyForTemplateSelection():x.k,v=t?w.getAllLayerKeys(true):[x.k];return K.call(this,x,r,u,s,v,z);},clearVisAsFilterActionForMapLayer:function b(w,x,s){var r=x.findSelectorControl(),u=x.node.defn.an,t=x.k,v=[x.k];return K.call(this,w,r,u,t,v,s);},getVisualizationByKey:function f(s){var t=this.getVIComponent(O.VIZ_CONTENT),r;h.forEach(t.children,function(u){h.forEach(u.children,function(v){if(s===v.k){r=v;return false;}});if(r){return false;}});return r;},associatedNodesUpdate:function G(s){var r=this,t=r.getCurrentLayoutKey(),u;return{callback:{success:function(v){v.defn.layouts.some(function(w){u=w;return w.k===t&&w.loaded;});h.forEach(s,function(w){var x=u.units[w.k];if(x){if(P.isEmpty(x.an)){delete w.defn.an;}else{w.defn.an=x.an;}}});}},extras:{style:{params:{treesToRender:1}}}};},redoFilterAssociations:function X(s,v,u,r,w,t){return{act:"redoFilterAssociations",isNewCGB:s,controlKey:v,sourceKey:u,targetKey:r,removeCGB:w,addCGB:t,partialUpdate:{nodes:[u,r]}};},setFilterType:function U(t,s,r){t.addActions({act:"setVisFilterType",nodeKey:s.k,type:r});},getTargetFilterKeys:function o(s){var t=[],w=this.getCurrentLayoutDef(),u=this.getVizContentPanel(w.k),AC=w.cgbMap,z=w.units,x=s.boxContent,AB=x&&x.selectorControl,AA=z[s.k],v=AA&&AA.an,r=v&&v.length&&v[0].k;if(AB){P.forEach(AB.cgb,function(AD){if(z[AD]){t.push(AD);t.push(AC[AD]);}});}if(r&&u&&h.some(u.children,function(AD){return AD.k===r;})){t=t.concat(h.map(v,function(AD){return AD.k;}));}return t;},getSourceFilterKeys:function g(s,u){var v=[],AA=this.getVIComponent(O.FILTER_STACK),z=this.getCurrentLayoutDef(),w=this.getVizContentPanel(z&&z.k),AB=z&&z.units,r,x,t=P.forEach(z&&z.cgbMap,function(AD,AC){if(AD===s){r=AB[AC];if(r&&r.scs){h.forEach(r.scs,function(AE){x=AE.pnk;if(AB[x]){v.push(x);}});}}});if(AA){if(u){h.forEach(AA.getFilters(),function(AC){if(AC.node.defn.srct===J){v.push(AC.k);}});}else{v.push(AA.k);}}if(w){w.children.forEach(function(AC){var AD=(AC.getTargetKeys&&AC.getTargetKeys())||[];if(h.indexOf(AD,s)>-1&&h.indexOf(v,AC.k)===-1){v.push(AC.k);}});}return v;},getAddVisActions:function d(s,r,w,u){var x=[],t,v;x.push(this.getCopyEmptyTemplateAction(r,s));u='<props ><widgetProps ><fmt ><visStyle value="GraphMatrixVisualizationStyle" ></visStyle><Shape value="Bar" ></Shape><Subtype value="Automatic" ></Subtype></fmt></widgetProps></props>';if(w){x.push({act:"updateTemplate",keyContext:r,actions:[{act:"createDefaultDropZones",nodeKey:r,treeType:1,datasetType:3,widgetType:w.type}]});t=w.style;v={k:r,defn:{t:j.GRID}};x.push(this.getUnitChangeVizAction(t,this.getWidgetClassNameByStyle(t,w.type),v,u,w.extraFormatting));}return x;},getClearVisFilterAction:function M(s,r,v,u){var t={act:"clearVisAsFilter",nodeKey:s,controlKey:v,cgbNodeKeys:u};if(r){t.associatedNodes=r;}return{act:"clearVisAsFilter",nodeKey:s};},getSetVisAsFilterAction:function L(s,v,u,t,r){return{act:"setVisAsFilter",sourceKey:s,targetKeys:t,controlKey:v||this.getNextKey(),CGBKeys:r,showAll:true,fos:true,partialRetrieval:{nodes:h.ensureArray(u)}};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Model","mstrmojo._HasPopup","mstrmojo.string","mstrmojo.taphold");var D=mstrmojo.dom,B=mstrmojo.string,O=D.isIOSTouch;var L=1,C=2,J=4,V=8,U=16,K=512;function N(b,X){var a=b.getCellForNode(X),W=a&&a.at,Z=0;if(W){Z=(W&C)||(W&J)||(W&L);}if(Z===J){var f=b.model.getCellLinksInfo(a);if(!f||isNaN(f.di)){return"";}var d=f.links[f.di];return d.n;}if(Z===L){var c=b.model.getCellDrillsInfo(a);return c&&(mstrmojo.desc(183,"Drill to")+" "+c.n)||"";}if(a){var Y=("mix" in a)?a._e:a;if(Y&&Y.desc){return B.decodeHtmlString(Y.desc);}}return b.tooltip||"";}function I(c,X){var b=c.getCellForNode(X),W=b&&b.at;if((W&V)>0||(W&U)>0||(W&K)>0){return true;}var Y=0;if((W&L)>0&&b.sdm===undefined){return true;}if((W&J)>0){Y++;}if((W&C)>0){Y++;}if(Y>1){return true;}if((W&J)>0){var e=c.model.getCellLinksInfo(b),d=e&&e.links,a=b.v?B.decodeHtmlString(b.v):b.v;var Z=(d&&d.length)||0;if(e&&!isNaN(e.di)&&!B.isEmpty(a)){Z--;}if(Z>0){return true;}}return false;}function H(W){return W.viewport.clientWidth-(W.scrollboxNode.offsetWidth-W.scrollboxNode.clientWidth);}mstrmojo._XtabCellHoverMgr=mstrmojo.declare(mstrmojo.Model,null,{scriptClass:"mstrmojo._XtabCellHoverMgr",parent:null,td:null,audibles:{"*":false},startup:function E(){var X=this.parent;if(X&&X.getCellForNode){var W=X.zones,Y;for(Y in W){this.addMgrElement(Y);}if(!this._sub_ihc){this._sub_ihc=X.attachEventListener("ignoreHoverChange",this.id,"onChangeIgnoreHover");}window.setTimeout(function(){X._pl=H(X);},0);}},addMgrElement:function Q(Y){var b=this.parent,a=this,c=b&&b.zones[Y].tableNode;if(c&&b&&b.getCellForNode){if(!this.fCtxMenu){this.fCtxMenu=function(d){a.oncontextmenu(d,self);};}if(!this.fOver){this.fOver=function(d){a.onhover(d,self);};}if(!this.fOut){this.fOut=function(d){a.onunhover(d,self);};}var Z=this.fCtxMenu,X=this.fOver,W=this.fOut;D.attachEvent(c,"mouseover",X);D.attachEvent(c,"mouseout",W);D.attachEvent(c,"contextmenu",Z);if(O){this.xtabContextMenuListener=b.attachEventListener("contextmenu",c.id,Z);b.hasContextMenuEvent=true;}}},shutdown:function A(){var Y=this.parent,X=Y&&Y.zones,Z;for(Z in X){var W=X[Z].tableNode;if(W){D.detachEvent(W,"mouseover",this.fOver);D.detachEvent(W,"mouseout",this.fOut);D.detachEvent(W,"contextmenu",this.fCtxMenu);}}if(O&&Y&&this.xtabContextMenuListener){Y.detachEventListener(this.xtabContextMenuListener);Y.hasContextMenuEvent=false;}},onXtabWidthChanged:function(){var W=this.parent;W._pl=H(W);},onChangeIgnoreHover:function(){var W=this.parent;if(!W.ignoreHover&&this._ignored){this.onhover(null,null,this._ignored);}},onhover:function F(Z,W,Y){if(this.parent.ignoreHover){this._ignored=D.eventTarget(W,Z);return ;}var X=this.parent,a=this.getEvtTargetCell(Z,W,X,Y);if(a&&X){a.title=N(X,a);}if(this.showHvrBtn(X,a)){this.td=a;if(!X._pl){X._pl=H(X);}X.openPopup("cellHoverPopupRef",{xtab:X,td:a});}else{this.onunhover(Z,W,Y);}},onunhover:function M(){if(this.parent.ignoreHover){return ;}var X=this.parent,W=X._lastOpened;if(!W){return ;}if(W.autoCloses){W.autoClose();}else{X.closePopup();}},getEvtTargetCell:function G(a,W,Z,Y){var X=Y||D.eventTarget(W,a);return X&&D.findAncestorByName(X,"td",true,Z.viewport);},oncontextmenu:function P(Z,W,Y){var X=this.parent,a=this.getEvtTargetCell(Z,W,X,Y);this.processRightClick(Z,W,a);if(a&&this.shouldShowPopup(X,a,true)){if(!(D.isMetaKey(W,Z)||D.shiftKey(W,Z))){X.openPopup("cellHoverPopupRef",{xtab:X,td:a,cmPos:D.getMousePosition(Z,W)});X.cellHoverPopupRef.btn.openPopup();}X.closePopup();D.preventDefault(W,Z);D.stopPropogation(W,Z);}},processRightClick:mstrmojo.emptyFn,shouldShowPopup:function S(Y,Z,X){var W=Z.mstrShowPopup;if(W!==undefined){return W;}W=I(Y,Z);Z.mstrShowPopup=W;return W;},showHvrBtn:function R(W,X){if(mstrApp.isDossier||mstrApp.isVI){return false;}return this.shouldShowPopup(W,X,false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.controllers.ControlUtils");var D=mstrmojo.array,G=mstrmojo.vi.controllers.EnumLayoutManipulationType,I=mstrmojo.vi.models.VIComponentMap.TYPES,K=mstrmojo.vi.controllers.EnumEvents,C=mstrmojo.func,H=mstrmojo.vi.controllers.ControlUtils;function L(Q){var M=this.model,P=this.view,N=Q.layoutKey;if(!!N){M.execute({execute:function O(){var R=M.getDataService().newUpdate(this);P.deleteLayout(N,R);this.submitUpdate(R);},urInfo:{treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(M)}});}}function A(Q){var M=this.model,P=this.view,N=Q.layoutKey;if(!!N){M.execute({execute:function O(){var R=M.getDataService().newUpdate(this);P.duplicateLayout(R,N);this.submitUpdate(R,M.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(M)}});}}function J(){var M=this.model,O=this.view;M.execute({execute:function N(){var P=M.getDataService().newUpdate(this);O.addNewLayout(P,-1,null);this.submitUpdate(P,M.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(M)}});}function E(N){var P=this.model,S=this.view,Q=N.layoutKey,V=N.oldText,O=N.newText,R=function(){return D.filterOne(S.layoutViewer.getSelector().getTabs(),function(W){return W.k===Q;});};P.renameLayout(Q,O,V,{failure:function M(W){mstrApp.onerror(W);R().set("title",V);},success:function U(Y){var X=S.getLayoutByKey(Q);X.set("n",Y);var W=X.builder.getLayoutVIMap(Q).getComponent(I.FILTER_STACK);if(W){W.set("title",Y);}R().set("title",Y);}});}function B(P){var O=this.view,M=P&&P.fromIdx,N=P&&P.toIdx;O.layoutViewer.getSelector().moveTab(M,N,M);}mstrmojo.vi.controllers._LayoutControl=mstrmojo.provide("mstrmojo.vi.controllers._LayoutControl",{_mixinName:"mstrmojo.vi.controllers._LayoutControl",manipulateLayout:function F(M){switch(M&&M.type){case G.DELETE:L.call(this,M);break;case G.DUPLICATE:A.call(this,M);break;case G.MOVE:B.call(this,M);break;case G.NEW:J.call(this);break;case G.RENAME:E.call(this,M);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.DocDataService","mstrmojo.func","mstrmojo.array","mstrmojo.hash","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.enums.EnumFeatures");var U=mstrmojo,P=mstrmojo.func,K=mstrmojo.array,M=mstrmojo.hash,H=mstrmojo.DocDataService,L=U.EnumRWUnitType,N=mstrmojo.vi.models.VIComponentMap.TYPES,J=U.DocDataService.REQUEST_DEFN_DATA,C=mstrmojo.vi.controllers.EnumEvents,F=mstrmojo.vi.enums.EnumFeatures;function I(Z,Y,X){(X.children||[]).forEach(function(a){I(Z,Y,a);});var W=Z.indexOf(X.k);if(W!==-1){X.k=Y[W];}}function D(W,a,Z){var Y=W&&W.parent,X=Y&&Y.panels;a=a+1;Z=Z+1;K.forEach(X,function(c){var b=c.defn.chdidx;if(b===Z){c.defn.chdidx=a;}if(Z<b&&b<=a){c.defn.chdidx=b-1;}if(a<=b&&b<Z){c.defn.chdidx=b+1;}});}function G(f,Z,W,c,a){var d=this.getLayoutDefn(Z),b=[];M.forEach(d.units,function(g){if(g.t===L.PANEL&&g.pnk===f&&!g._isDeleted){b.push(g);}});for(var Y=0;Y<W.length;Y++){var X=c[Y]+1,e=W[Y]+1;K.forEach(b,function(j,h){var g=j.chdidx;if(g===X){j.chdidx=e;}if(X<g&&g<=e){j.chdidx=g-1;}if(e<=g&&g<X){j.chdidx=a&&h===X-1?g:g+1;}});}}function R(W,a){if(!W||W.length===0){return -1;}var Z=0,Y=W.length-1;while(Z<Y-1){var X=Math.floor((Z+Y)/2);if(W[X]>a){Y=X;}else{Z=X;}}if(W[Z]>a){return Z;}if(W[Y]>a){return Y;}return -1;}function V(b,Z,e){var Y=this,a=Y.getLayoutDefn(Z).units||{},c=[].concat(e),d=c.slice();K.forEach(c,function(g){var f=Y.getPanel(g,Z);if(f){K.forEach(f&&f.children,function(j){var h=j.k;if(h){d.push(h);}if(!a[h]&&j.node&&j.node.defn){a[h]=j.node.defn;}});if(!a[g]&&f.node&&f.node.defn){a[g]=f.node.defn;}}else{M.forEach(a,function(j,h){if(j.pnk===g){d.push(h);}});}});d.forEach(function(f){if(a[f]){if(b){a[f]._isDeleted=true;}else{delete a[f]._isDeleted;}}});var W=Y.getVisPanelKeys(Z),X=[];K.forEach(c,function(f){if(a[f]){X.push(a[f].chdidx);}});X.sort(function(g,f){return g-f;});if(b){K.forEach(W,function(g){var h=a[g];if(!h._isDeleted){var f=R(X,h.chdidx);if(f===-1){h.chdidx-=X.length;}else{h.chdidx-=f;}}});}if(!b){K.forEach(X,function(g){var f=g,h=null;K.forEach(W,function(j){var k=a[j];if(!k._isDeleted){if(c.indexOf(j)===-1&&k.chdidx>=f){k.chdidx+=1;}else{if(c.indexOf(j)!==-1&&k.chdidx===f){h=j;}}}});c.splice(c.indexOf(h),1);});}Y.raiseEvent({name:C.UPDATE_TOC});}mstrmojo.vi.models._PanelActions=mstrmojo.provide("mstrmojo.vi.models._PanelActions",{_mixinName:"mstrmojo.vi.models._PanelActions",addPanel:function(Z,f,c,a,e){var d=this.getVIComponent(N.VIZ_CONTENT,c),g=this.createNewUnitNode(null,function(h){h.t=L.PANEL;return h;},null,null,c),Y=g.k,X=this.id,W=null;if(a){a.k=Y;}if(d){var b=d.builder;W=b.build([g],this,{pk:f})[0];d.addChildren([W],null,false,true);d.doLayout();W.boxLayoutConfig.useDefaultBox([]);}Z.add([{act:"addPanel",nodeKey:Y,titlePattern:mstrApp.supportFeature(F.USE_WORKSTATION_NAMING_STYLE)?1:0,parentKey:f,index:0}],{success:function(j){var h=mstrmojo.all[X];h.partialUpdate(j.data,h.getUnitDefinitions(Y),j.defn);if(W){g.defn=h.getUnitDefinitions(Y)[Y];W.defn=g.defn;W.node.defn=g.defn;}if(!e){h.raiseEvent({name:C.UPDATE_TOC});}}},J);return W;},selectNewPanel:function(X,W){X.add([{act:"setCurrentPanel",unitKey:W}],{success:function(){var Y=this.getPanel(W);Y.parent.selectPanel(W,null,true);}.bind(this)});},duplicatePanel:function B(W,h,a,e,f,X,l){var m=l||this.createNewUnitNode(null,function(n){n.t=L.PANEL;return n;}),Y=m.k,b=W.k,k=h.k,Z=this.id,g=mstrmojo.desc(11450,"## copy ###"),d=[{act:"duplicatePanel",nodeKey:b,parentKey:k,duplicateKey:g.replace("###",W.numDupl===0?"":W.numDupl).replace("##",W.titleText),newKey:Y,index:a+1},{act:"setCurrentPanel",unitKey:Y}],c;var j=this.getDataService();this.execute({execute:function(){var n=this,o=j.newUpdate(n,{actions:d,extras:J,callback:{success:function(r){var q=mstrmojo.all[Z];q.partialUpdate(r.data,q.getUnitDefinitions(r.pukeys||Y),r.defn);m.defn=q.getUnitDefinitions(Y)[Y];var t=f.build([m],q,{pk:k});c=t[0];h.addChildren(t);var s=h.children.length,p=h.panels.length;h.changePanelPosition(c,p-1,a,s-1,a);G.call(q,k,e,[a],[p-1],true);if(c.defn.layoutXML){I.call(this,W.getTargetKeysExcludingTypes(),c.getTargetKeysExcludingTypes(),m.defn.layoutXML);}W.numDupl=W.numDupl+1;h.selectPanel(Y,null,true);h.doLayout();q.getPanel().saveBoxLayout(null,q.cmdMgr().CMD_PHASE.LAST);q.raiseEvent({name:C.UPDATE_TOC});}}});o.submit();},urInfo:{disablePU:true,treesToRender:3,undo:X.undo,redo:X.redo},discard:X.discard});},movePanel:function S(W,Z,Y,b){var a=this.getDataService(),X=this;b=P.composite([b,function(){D(W,Z,Y);X.raiseEvent({name:C.UPDATE_TOC});}]);this.execute({execute:function(){this.submit([a.getMoveNodeAction(W,W.parent.k,Z),{act:"setCurrentPanel",unitKey:W.k}],{success:function(){b(Y,Z);}},H.RAPID_EXEC);},urInfo:{silent:true,undo:function(){b(Z,Y);},redo:function(){b(Y,Z);}}});},movePanelsInLayout:function E(g,m,d,W,f,l){var j=this.getDataService(),c=this,X=g&&g[0],e=this.getPanel(X,d).parent,k=e.k,Y=e.selector,h=Y.selectMovedTab,Z=h&&m!==X,b=e.selectedKey,a=c.getDataService().newUpdate();l=P.composite([l,function(o,n){G.call(c,k,d,n,o);c.raiseEvent({name:C.UPDATE_TOC});}]);K.forEach(g,function(p,n){var o=j.getMoveNodeActionUsingKey(p,L.PANEL,k,W[n]);a.actions.push(o);});if(Z){e.selectPanelDeferred(a,X,false,false);}a.callback=P.wrapMethods({success:function(){l(f,W);}},a.callback);a.extras=M.copy({params:{suppressData:Z?false:true}},a.extras);this.execute({execute:function(){this.submitUpdate(a);},urInfo:{silent:h?false:true,treesToRender:h?H.EnumTreesToRender.BOTH:H.EnumTreesToRender.NONE,undo:function(){this.urInfo.puKeys=[b];var o=W.slice(),n=f.slice();o.reverse();n.reverse();l(o,n);},redo:function(){this.urInfo.puKeys=[X];l(f,W);}}});},getRemoveUnitAction:function O(W){return{act:"removeUnit",unitKey:W.k,unitType:W.defn.t};},getRemoveVisPanelAction:function A(W){return{act:"removeUnit",unitKey:W,unitType:L.PANEL};},getSetCurrentPanelAction:function Q(W){return{act:"setCurrentPanel",unitKey:W};}});mstrmojo.vi.models._PanelActions.defnUpdatePanelRemoval=V;}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.locales","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIDatabaseHelper");mstrmojo.requiresDescs(2052,2170,2265,3434,3544,4530,4699,8002,8984,9614,9919,9920,9921,9922,12491,12492,12493,12494,12495,12509,12771,13031,13131,13132,13980,13981,8536);var U=mstrmojo.DI.DIConstants,O=U.dataTypeMenuItems,L=U.rdcsFlag,D=mstrmojo.dom,J=mstrmojo.array;mstrmojo.DI.DIHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIHelpers.isIE7=function N(){return mstrmojo.dom.isIE7;};mstrmojo.DI.DIHelpers.isIE=function(){return D.isIE||!!D.userAgent.match(/Trident\/7\.0/);};mstrmojo.DI.DIHelpers.isIEOrEdge=function(){return mstrmojo.dom.isEdge||this.isIE();};mstrmojo.DI.DIHelpers.getURLCaption=function(){var V="";if(mstrApp.diParams&&mstrApp.diParams.EnableURLImport){if(mstrApp.diParams.EnableFileImport){if(mstrApp.isSingleTier){if(window.FormWrapper!==window.client){V+="File://";}}else{V+="File://";}}if(mstrApp.diParams.EnableHttpImport){if(V!==""){V+=", ";}V+="Http://, Https://";}if(mstrApp.diParams.EnableFTPImport){if(V!==""){V+=", ";}V+="Ftp://";}}return V;};mstrmojo.DI.DIHelpers.getUrlTooltip=function C(){var V="";if(!mstrApp.diParams){return V;}if(!mstrApp.diParams.EnableURLImport){V=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{V=mstrmojo.desc(12492,"Use one of the following URL formats to upload your file:")+" ";V+=mstrmojo.DI.DIHelpers.getURLCaption();if(mstrApp.enableFileImport){V+="\r\r";V+=mstrmojo.desc(12493,"'File://' format allows you to upload files in your local machine. For example: File://ComputerName/path/FileName.");}if(mstrApp.enableHttpImport||mstrApp.enableHttpsImport){V+="\r\r";if(mstrApp.enableFileImport){V+=mstrmojo.desc(12494,"Some other examples are:");}else{V+=mstrmojo.desc(12495,"Some examples are:");}}if(mstrApp.enableHttpImport){V+="\r";V+="http://host/path/FileName";V+="\r";V+="https://user:password@host/path/FileName";}if(mstrApp.enableFtpImport){V+="\r";V+="ftp://user:password@host/path/FileName";V+="\r";V+="ftp://user:password@host:port/path/FileName";}}return V;};mstrmojo.DI.DIHelpers.createMSTRObjects=function(X,Z){var V,Y,W;if(X.constructor===Array){V=X;for(W=0;W<V.length;W++){V[W]=mstrmojo.DI.DIHelpers.createMSTRObjects(X[W],Z);}}else{if(typeof X==="object"){V=new mstrmojo.Obj(X);for(Y in X){if(!Z||Z.indexOf(Y)===-1){if(X.hasOwnProperty(Y)){V.set(Y,mstrmojo.DI.DIHelpers.createMSTRObjects(X[Y],Z));}}}}else{V=X;}}return V;};mstrmojo.DI.DIHelpers.getURLParameters=function(V){var W;var Z;var Y=[];if(V){if(V.indexOf("?")>0){V=V.substr(V.indexOf("?")+1);}Z=V.split("&");for(W=0;W<Z.length;W++){var X=Z[W].split("=");if(X.length===2){Y[X[0]]=X[1];}}}return Y;};mstrmojo.DI.DIHelpers.getBackendSourceType=function(V){var W=U.backendSourceSubtype.localFile;switch(V){case U.sourceSubtype.dropbox:W=U.backendSourceSubtype.dropbox;break;case U.sourceSubtype.bisource:W=U.backendSourceSubtype.bISources;break;case U.sourceSubtype.clipboard:W=U.backendSourceSubtype.clipboard;break;case U.sourceSubtype.facebook:W=U.backendSourceSubtype.facebook;break;case U.sourceSubtype.googleAnalytics:W=U.backendSourceSubtype.googleAnalytics;break;case U.sourceSubtype.googleBigQuery:W=U.backendSourceSubtype.googleBigQuery;break;case U.sourceSubtype.googleBigQueryFFSQL:W=U.backendSourceSubtype.googleBigQueryFFSQLModel;break;case U.sourceSubtype.googleBigQuerySingleTable:W=U.backendSourceSubtype.googleBigQuerySingleTable;break;case U.sourceSubtype.googleDrive:W=U.backendSourceSubtype.googleDrive;break;case U.sourceSubtype.hadoop:W=U.backendSourceSubtype.hadoopFileBrowser;break;case U.sourceSubtype.localFile:W=U.backendSourceSubtype.localFile;break;case U.sourceSubtype.mdx:W=U.backendSourceSubtype.OLAPSources;break;case U.sourceSubtype.salesforce:W=U.backendSourceSubtype.salesforce;break;case U.sourceSubtype.samplefile:W=U.backendSourceSubtype.samplefile;break;case U.sourceSubtype.searchOnSource:W=U.backendSourceSubtype.searchAsASource;break;case U.sourceSubtype.twitter:W=U.backendSourceSubtype.twitter;break;case U.sourceSubtype.url:W=U.backendSourceSubtype.url;break;case U.sourceSubtype.publicData:W=U.backendSourceSubtype.publicData;break;case U.sourceSubtype.cloudElement:W=U.backendSourceSubtype.cloudElement;break;}return W;};mstrmojo.DI.DIHelpers.getStateParameters=function(W){var V;var Z;var X=[];if(W.indexOf(":")>=0){Z=W.split(":");}else{Z=W.split("%3A");}for(V=0;V<Z.length;V++){var Y=Z[V];if(Y.substr(2,1)==="_"){X[Y.substr(0,2)]=Y.substr(3);}}return X;};mstrmojo.DI.DIHelpers.getExtensionType=function(X){var W=X.toLowerCase(),V;if(W===".xls"||W===".xlsx"||W===".xlsm"){V=U.xdaType.excel;}else{if(W===".txt"||W===".csv"||W===".tsv"||W===".prn"){V=U.xdaType.text;}else{V=0;}}return V;};mstrmojo.DI.DIHelpers.setTablesrc=function(V,X,W){if(X){if(!V.tablesSrc[X]){V.tablesSrc[X]=[];}V.tablesSrc[X].push(W);}};function S(V){var X={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2},a={1:U.columnDataTypes.integer,2:U.columnDataTypes.integer,6:U.columnDataTypes.dtdouble,7:U.columnDataTypes.dtfloat,21:U.columnDataTypes.integer,22:U.columnDataTypes.nlong,30:U.columnDataTypes.bigDecimal,34:U.columnDataTypes.int64},W=X[V],Z=a[V],Y="";switch(W.toString()){case U.dataTypeMenuItems.NUMBER:switch(Z){case U.columnDataTypes.integer:Y=mstrmojo.desc(9614,"Integer");break;case U.columnDataTypes.nlong:Y=mstrmojo.desc(13131,"Long");break;case U.columnDataTypes.int64:Y=mstrmojo.desc(13132,"Big Integer");break;case U.columnDataTypes.dtfloat:Y=mstrmojo.desc(8002,"Float");break;case U.columnDataTypes.dtdouble:Y=mstrmojo.desc(2265,"Double");break;case U.columnDataTypes.bigDecimal:Y=mstrmojo.desc(9920,"Big Decimal");break;default:Y=mstrmojo.desc(3434,"Number");break;}break;case U.dataTypeMenuItems.DATE:Y=mstrmojo.desc(2052,"Date");break;case U.dataTypeMenuItems.DATE_TIME:Y=mstrmojo.desc(9919,"DateTime");break;case U.dataTypeMenuItems.TIME:Y=mstrmojo.desc(2170,"Time");break;case U.dataTypeMenuItems.TEXT:Y=mstrmojo.desc(3544,"Text");break;case U.dataTypeMenuItems.HTML_TAG:Y=mstrmojo.desc(9921,"HTML Tag");break;case U.dataTypeMenuItems.PHONE_NUMBER:Y=mstrmojo.desc(8984,"Phone Number");break;case U.dataTypeMenuItems.SYMBOL:Y=mstrmojo.desc(4530,"Symbol");break;case U.dataTypeMenuItems.URL:Y=mstrmojo.desc(9922,"URL");break;case U.dataTypeMenuItems.EMAIL:Y=mstrmojo.desc(4699,"Email");break;}return Y;}mstrmojo.DI.DIHelpers.getDataTypeString=S;mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults=function M(d){var b=[],Z,a,c,e,V,X,Y,W;J.forEach(d,function(f){Z=a=c=e="";X=(f.vt===3)?1:0;switch(f.vt){case 0:case 1:case 2:case 3:Z=f.n;a=S(f.ddt);V=f.src;c=V.n;e=S(V.ddt);break;case 4:Z=f.n;a=S(f.ddt);break;case 8:V=f.src;c=V.n;e=S(V.ddt);break;}Y=a?Z+"("+a+")":Z;W=e?c+"("+e+")":c;b.push([Y,X,W]);});return b;};mstrmojo.DI.DIHelpers.getURLFileName=function(W){var V=W.lastIndexOf("/");return V>=0&&V+1!==W.length?W.substr(V+1):W;};mstrmojo.DI.DIHelpers.isOperationMode=function(V){return V!==undefined&&V!==null;};mstrmojo.DI.DIHelpers.isCtrlKey=function(V,X){var W=X||(V||window).event;return W.ctrlKey||W.metaKey;};mstrmojo.DI.DIHelpers.isRefreshable=function(W){var V,X=0;for(V in W.importSources){var Y=W.importSources[V];if(Y.type===U.sourceType.file&&(Y.subtype===U.sourceSubtype.url||Y.subtype===U.sourceSubtype.publicData)){if(!Y.sourceInfo||Y.sourceInfo.url.indexOf("http://mirror.microstrategy.com/datahub/samples")!==0){X++;}}}if(W.getAllTableID().length===X&&!mstrApp.diParams.EnableHttpImport&&!mstrApp.diParams.EnableFTPImport&&!mstrApp.diParams.EnableFileImport&&!mstrApp.diParams.EnableURLImport){return false;}return true;};mstrmojo.DI.DIHelpers.strStartsWith=function(W,V){return W.indexOf(V)===0;};mstrmojo.DI.DIHelpers.adjustDataIdx=function(Y,X){var V=[],W;if(!Y||Y.length===0){return ;}J.forEach(Y,function(Z){W=Z.subColumns;if(W&&W.length>1){V=V.concat(W);}else{V.push(Z);}});V.sort(function(c,Z){return c[X]-Z[X];});};mstrmojo.DI.DIHelpers.setDataIdx=function(X,W,V){if(!W||W.length===0){return ;}if(W[0].hasOwnProperty("clix")){J.forEach(X,function(Z){var Y=Z.ix;Z[V]=J.find(W,"clix",Y);if(Z.isMultiForm){J.forEach(Z.subColumns,function(a){a[V]=J.find(W,"clix",a.ix);});}});}if(W[0].hasOwnProperty("did")){J.forEach(X,function(a){var Z=a.did;var Y=J.find(W,"did",Z);if(Y!==-1){a[V]=Y;}if(a.isMultiForm){J.forEach(a.subColumns,function(b){Y=J.find(W,"did",b.did);if(Y!==-1){b[V]=Y;}});}});}};mstrmojo.DI.DIHelpers.encodeData=function(V){var W="";if(V!==undefined){if(typeof V==="number"){W=V;}else{W=mstrmojo.string.encodeHtmlString(V,false,true);}}return W;};var E={0:"Bytes",1:"KB",2:"MB",3:"GB",4:"TB",5:"PB"};function P(V){return E[V]||"unknown";}mstrmojo.DI.DIHelpers.getRoundSize=function I(W){var V;for(V=0;(W/1024)>1;V++){W=W/1024;}W=W.toPrecision(3);return W+P(V);};mstrmojo.DI.DIHelpers.findNewElements=function(X,Y){var W=[],V;if(X&&X.length){J.forEach(Y,function(Z){V=J.indexOf(X,Z);if(V===-1){W.push(Z);}});}else{if(Y&&Y.length){W=[].concat(Y);}}return W;};mstrmojo.DI.DIHelpers.generateCubeName=function(W){var V,X,Y=50;V=W.join(" ");if(V.length>Y){V=V.slice(0,Y)+"...";}X=W.length;if(X>1){V+=" ("+X+" tables)";}return V;};mstrmojo.DI.DIHelpers.parseValidateSourceResults=function(W){var V={isValidate:true,hasError:false,tbids:[],tableValidate:[],missingColumnTbids:[],mismatchedDatatypeTbids:[],missingTableTbids:[],errorTableTbids:[],missingColumns:{},mismatchedDatatypeColumns:{},missingTablesColumns:{},errorTableErrCode:{},errorTableErrMsg:{}},X=W&&W.vts;J.forEach(X,function(f){var Y=f.tbid,g=f.vt,a=f.emsg,d=f.cols||[],Z=true,e=false,c,h=[],b=[];if(g===1){Z=true;}else{switch(g){case U.backendError.switchingFileType:case U.backendError.noExternalSession:case U.backendError.databaseCredentialsNotAvailable:case U.backendError.CECredentialNotAvailable:case U.backendError.AuthenticationError:case U.backendError.shouldBeIgnored:e=true;break;}J.forEach(d,function(j){var k=j.vt;switch(k){case 1:b.push(j);break;case 4:h.push(j);break;}});}if(e){V.errorTableTbids.push(Y);V.errorTableErrCode[Y]=g;V.errorTableErrMsg[Y]=a;V.isValidate=false;V.hasError=true;}c=h.length>0&&h.length===d.length;if(h.length>0||b.length>0){Z=false;}else{Z=true;}if(Z===false){V.isValidate=false;}V.tbids.push(Y);V.tableValidate.push(Z);if(h.length>0){if(c){V.missingTableTbids.push(Y);V.missingTablesColumns[Y]=h;}else{V.missingColumnTbids.push(Y);V.missingColumns[Y]=h;}}if(b.length>0){V.mismatchedDatatypeTbids.push(Y);V.mismatchedDatatypeColumns[Y]=b;}});return V;};mstrmojo.DI.DIHelpers.truncate=function(X,Z,V){if(X&&X.length>Z){var b=3,W=Z-b,a=Math.ceil(W/2),Y=Math.floor(W/2);if(V){return X.substr(0,W)+"...";}else{return X.substr(0,a)+"..."+X.substr(X.length-Y);}}else{return X;}};mstrmojo.DI.DIHelpers.getAbsoluteFileName=function(V){var W,X=V.lastIndexOf("\\");if(X===-1){X=V.lastIndexOf("/");}W=V.substring(X+1,V.length);return W;};mstrmojo.DI.DIHelpers.reevaluatePopupPosition=function(V){if(V){var W=V.style,Z=W.display,Y=W.left,X=W.top;W.display="block";if(parseInt(Y.substring(0,Y.length-2))<0){W.left="0px";}if(parseInt(X.substring(0,X.length-2))<0){W.top="0px";}W.display=Z;}};mstrmojo.DI.DIHelpers.expandNode=function(W){var V=W.visible;W.set("visible",!V);return !V;};mstrmojo.DI.DIHelpers.normalizeTimestamp=function(X){var W=X.replace(/-/g,"/");var V=W.indexOf(".");if(V>0){W=W.substring(0,V);}return W;};mstrmojo.DI.DIHelpers.getBackendErrorStr=function(W,V){var X="";switch(W){case U.backendError.switchingFileType:X=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");break;case U.backendError.noExternalSession:case U.backendError.databaseCredentialsNotAvailable:case U.backendError.CECredentialNotAvailable:case U.backendError.AuthenticationError:X=mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table.");break;}return X;};mstrmojo.DI.DIHelpers.getCommonElements=function(Y,a,Z){var W=[],X,V;for(X=0;Y&&X<Y.length;X++){for(V=0;a&&V<a.length;V++){if(Z(Y[X],a[V])){W.push(Y[X]);break;}}}return W;};mstrmojo.DI.DIHelpers.formatDateAndTime=function(d,Y){var c=mstrmojo.date;var W=mstrmojo.locales;var X,e,b,a,V,Z;X=c.parseDateAndOrTime(d);e=X.date;b=X.time;if(Y){Z=new Date(Date.UTC(e.year,e.month-1,e.day,b.hour,b.min,b.sec));X=c.getDateJson(Z);e=X;b=X;}a=c.formatDateInfo(e,W.datetime.DATEDISPLAYFORMAT);V=c.formatTimeInfo(b,W.datetime.TIMEDISPLAYFORMAT);return a+" "+V;};mstrmojo.DI.DIHelpers.isServerBasedWS=function(){return !!mstrApp.isWorkstation&&!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isLocalWS=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isDIinVI=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier&&!!mstrApp.isPopup;};mstrmojo.DI.DIHelpers.extractFileNameFromHadoopURL=function(W){if(!W){return"";}var V,X;V=W.lastIndexOf("/")+1;X=W.substring(V);return X;};mstrmojo.DI.DIHelpers.extractFileExtensionFromHadoopURL=function(W){if(!W){return"";}var V,X;V=W.lastIndexOf("/")+1;X=W.substring(V);return X.substring(X.lastIndexOf(".")+1);};mstrmojo.DI.DIHelpers.isWS=function(){return !!mstrApp.isWorkstation;};mstrmojo.DI.DIHelpers.getEnvObj=function(){var Y=(navigator.platform.indexOf("Win")!==-1?"Win":"Mac"),V=!!mstrApp.isWorkstation?"WS":"Web",W=[];W.push(V,Y);return{ENV:W.join("-"),isWSClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return !window.FormWrapper.isDesktop();},isDesktopClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return window.FormWrapper.isDesktop();},isWeb:function(){return V==="Web";},isWS:function(){return V==="WS";},isWin:function(){return Y==="Win";},isMac:function(){return Y==="Mac";},isDataSet:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp"||mstrApp.placeholder==="QBApp";},isDIinVI:function(){return !!mstrApp.isFromVI;},isInDI:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp";},isInQB:function(){return mstrApp.placeholder==="QBApp";},isAppSchema:function(){return !!window.mstrAppSchema;},isWebWin:function(){return this.isWeb()&&this.isWin();},isWebMac:function(){return this.isWeb()&&this.isMac();},isWebDataSet:function(){return this.isWeb()&&this.isDataSet();},isWebDossier:function(){return this.isWeb()&&this.isDIinVI();},isWSWin:function(){return this.isWS()&&this.isWin();},isWSMac:function(){return this.isWS()&&this.isMac();},isWSDataSet:function(){return this.isWS()&&this.isDataSet();},isServerBasedWS:mstrmojo.DI.DIHelpers.isServerBasedWS,isWSDossier:function(){return this.isWS()&&this.isDIinVI();},isWSLiveMode:function X(){return this.isWS()&&parseInt(window.FormWrapper.isWSLiveMode(),10)===1;},isWSDossierLocalMode:function(){return this.isWSDossier()&&!this.isWSLiveMode();},isWebWinDataSet:function(){return this.isWeb()&&this.isWin()&&this.isDataSet();},isWebMacDataSet:function(){return this.isWeb()&&this.isMac()&&this.isDataSet();},isWebWinDossier:function(){return this.isWeb()&&this.isWin()&&this.isDIinVI();},isWebMacDossier:function(){return this.isWeb()&&this.isMac()&&this.isDIinVI();},isWSWinDataSet:function(){return this.isWS()&&this.isWin()&&this.isDataSet();},isWSMacDataSet:function(){return this.isWS()&&this.isMac()&&this.isDataSet();},isWSWinDossier:function(){return this.isWS()&&this.isWin()&&this.isDIinVI();},isWSMacDossier:function(){return this.isWS()&&this.isMac()&&this.isDIinVI();},isStandaloneDataSet:function(){return !this.isDIinVI()&&this.isDataSet();}};};mstrmojo.DI.DIHelpers.isOnetier=function(){return !!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.getHierarchyMappingXML=function(a,b){var X="";var W=0,Y=1,Z=12;if(b&&b[L.ID]){X+="<mpcs>";X+="<mpc ";X+='did="'+b[L.ID].did+'" drvflg="'+W+(b[L.ID].n?('" n="'+b[L.ID].n+'" ot="'):"")+Z+'" recurisve="'+Y+'" ';if(!!a&&a!==""){X+='oid="'+a+'" ';}X+=">";if(b[L.JOIN_ID]){X+="<rdcs>";}for(var V=L.JOIN_ID;V<=L.DISTANCE;V++){if(b[V]!==undefined){X+='<rdc did="'+b[V].did+'" fg="'+V+'"/>';}}if(b[L.JOIN_ID]){X+="</rdcs>";}X+="</mpc>";X+="</mpcs>";}return X;};mstrmojo.DI.DIHelpers.getOperationMode=function(){return mstrApp.getRootController().getModel().operationMode;};mstrmojo.DI.DIHelpers.standardizeDBRolesFormat=function Q(d){var X=["att","dbRole","tableMap"],e,g,a,V,Y,W,b,Z,f,h,c=(function(){var j="list",l="number",k="text";function m(n,s,r,q,p,o){if(n&&r){if(o){n.push({field:s,fieldV:r,IDS:q,options:o,tp:p});}else{n.push({field:s,fieldV:r,IDS:q,tp:p});}}}return{authenticationmethod:function(n,o){m(n,"auth",o,7776,j,[{IDS:13980,n:mstrmojo.desc(13980),v:"1"},{IDS:13981,n:mstrmojo.desc(13981),v:"4"}]);},databasename:function(n,o){m(n,"db",o,8519,k);},hostname:function(n,o){m(n,"host",o,8533,k);},port:function(n,o){m(n,"port",o,8534,l);},server:function(n,o){m(n,"svr",o,8536,k);}};}());d=Object.keys(d).map(function(j){return mstrmojo.DI.DIHelpers.createMSTRObjects(d[j],X);});J.forEach(d,function(j){J.forEach(j.tables,function(k){k.dbRole=(k.dbRole&&k.dbRole.oi)||k.dbRole;k.dbmsObj=k.dbmsObj&&k.dbmsObj.oi;g=k.dbRole;if(g){g.dbmsObj=k.dbmsObj;a=g.dbmsObj;if(!g.dbms){g.dbms=g.def&&g.def.dbms&&g.def.dbms.did;}}if(!a||a.DBInfo){return ;}a.DBInfo={};e=a.DBInfo;V=g.efd;if(!V){return ;}V.forEach(function(l){Y=l.oi&&l.oi.def;if(!Y){return ;}h=Y.dbtp;if(h){g.db_type=h;e.dbTypes={dbt:{v:h,n:mstrmojo.desc(mstrmojo.DI.DIDatabaseHelper.getDescriptionIdByDBType(h))}};}W=Y.cnsr;if(!W){return ;}f=[];Z=null;g.connstr=W;W.split(";").forEach(function(m){b=m.split("=");b[0]=b[0].toLowerCase().trim();if(b[0]==="driver"){e.driverInstalled=true;}else{if(b[0]==="authenticationmethod"){Z=b;}else{if(c[b[0]]){c[b[0]](f,b[1]);}}}});if(Z){c[Z[0]](f,Z[1]);}});});});return d;};mstrmojo.DI.DIHelpers.filterDisableSources=function A(V){return J.indexOf(mstrApp.diParams.disabledSources,V)<0;};mstrmojo.DI.DIHelpers.getPopupWindowOptions=function R(){var Z={};var X=window.screenX||window.screenLeft||0,W=window.screenY||window.screenTop||0,Y=800,V=600,a;if(document.body&&document.body.offsetWidth){Y=document.body.offsetWidth;V=document.body.offsetHeight;}if(document.compatMode==="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){Y=document.documentElement.offsetWidth;V=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){Y=window.innerWidth;V=window.innerHeight;}if(window.outerWidth){Y=window.outerWidth;}if(window.outerHeight){V=window.outerHeight;}Z.height=V*0.5;Z.width=Y*0.8;if(Z.height<600||isNaN(Z.height)){Z.height=600;}if(Z.width<800||isNaN(Z.width)){Z.width=800;}Z.left=X+(Y-Z.width)/2;Z.top=W+(V-Z.height)/8;if(this.getEnvObj().isWSWin()&&this.getEnvObj().isDIinVI()){Z.left=(window.screen.width-Z.width)/2;Z.top=(window.screen.height-Z.height)/2;}a="width="+Z.width+",height="+Z.height;a+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";a+=",left="+Z.left+",top="+Z.top;return a;};mstrmojo.DI.DIHelpers.createPopupWindow=function G(W,V){var X,Y;Y=this.getPopupWindowOptions();if(!W){W="";}X=window.open(W,V,Y);return{wnd:X};};mstrmojo.DI.DIHelpers.openPopupWindow=function H(Y,W,V){var X;if(Y&&!Y.closed){Y.location=V;Y.focus();}else{X=this.createPopupWindow(V);Y=X.wnd;if(Y){Y.focus();}}return Y;};mstrmojo.DI.DIHelpers.sendResponse2Window=function B(W,V,Z){var Y;if(Z){Y=Z;}else{Y=window.opener;}if(Y){if(V===undefined){V=window.location.origin;if(!V){V=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}}try{if(this.isIE()&&Y.postMessagePassthrough){Y.postMessagePassthrough(W,V);try{window.open("","_self","");window.close();}catch(a){window.close();}}else{Y.postMessage(W,V);}}catch(X){console.log("postMessage error: "+X);}}};mstrmojo.DI.DIHelpers.convertDataSourceType2SourceType=function F(V){switch(V){case U.dataSourceType.DROPBOX:return U.sourceType.dropbox;case U.dataSourceType.GOOGLE_DRIVE:return U.sourceType.googleDrive;case U.dataSourceType.GOOGLE_ANALYTICS:return U.sourceType.googleAnalytics;case U.dataSourceType.SALESFORCE:return U.sourceType.salesforce;case U.dataSourceType.GOOGLE_BIGQUERY:return U.sourceType.googleBigQuery;default:return -1;}};mstrmojo.DI.DIHelpers.highlightKeyWords=function K(d,e,V){var X="\\*.?+$^[](){}|/",f=d,b,Y;if(d===""){return e;}for(Y in X){if(X.hasOwnProperty(Y)){b=X[Y];f=f.replace(new RegExp("\\"+b,"g"),"\\"+b);}}var c=new RegExp("("+f+")","ig");var W="\u001E",a=mstrmojo.string.encodeHtmlString,Z;if(c.test(e)){e=e.replace(c,function(g){return W+g+W;});Z=J.map((e||"").split(W),function(h,g){return(g%2===0)?a(h):('<span class="'+V+'">'+a(h)+"</span>");});return Z.join("");}};mstrmojo.DI.DIHelpers.detectCustomImg=function(Y,X){if(!Y||!(X.nodeType&&X.nodeType===window.Node.ELEMENT_NODE)){return ;}var V=Y.replace?Y.replace(/\s+/g,""):"";var Z=document.getElementsByTagName("head")[0];var W=document.createElement("img");W.src="../javascript/mojo/css/images/DI/connectors/"+V+".png";W.onload=function(){X.style.background="url(../javascript/mojo/css/images/DI/connectors/"+V+".png) no-repeat";Z.removeChild(W);};W.onerror=function(){X.style.background="url(../javascript/mojo/css/images/DI/connectors/default.png) no-repeat";Z.removeChild(W);};Z.appendChild(W);};mstrmojo.DI.DIHelpers.spliceUrlBySeparator=function(W){var V=W.split("#");return V.slice(V.length/2+1).join("#");};mstrmojo.DI.DIHelpers.isOriginalConnector=function(W){var V=U.originalConnector;if(V.elastic===W||V.tapClicks===W){return true;}return false;};mstrmojo.DI.DIHelpers.acceptEventFromAncestor=function(V){if(!V){return true;}if(!this.domNode||typeof V.contains!=="function"||!this.hasRendered){return false;}return V.contains(this.domNode);};mstrmojo.DI.DIHelpers.isdbRoleWritable=function(V){if(mstrmojo.DI.DIHelpers.isOnetier()){return true;}else{return V.writable==="1"&&mstrApp.rootController.hasPrivilege(U.DssXmlPrivileges.DssXmlPrivilegesUseDatabaseInstanceManager);}};mstrmojo.DI.DIHelpers.isdbRoleUsable=function(V){return mstrmojo.DI.DIHelpers.isOnetier()?true:V.usable==="1";};mstrmojo.DI.DIHelpers.applyDriverSuffix=function(X){if(!X||!X.Preferences){return ;}var V=JSON.stringify(X),W=X.Preferences.driverNameSuffix,Z=this.getEnvObj();var Y="Platform";if(Z.isDesktopClient()){Y=Z.isMac()?"DesktopMac":"DesktopWin";}else{if(Z.isWSClient()){Y=Z.isMac()?"WorkstationMac":"WorkstationWin";}}var a=W[J.find(W,"n",Y)];return JSON.parse(V.replace(/!#DRIVERSUFFIX#!/g,a?a.value:""));};mstrmojo.DI.DIHelpers.isGeo=function(V){return V.georole&&V.georole>0;};mstrmojo.DI.DIHelpers.isTime=function(V){return V.dtp===parseInt(O.DATE,10)||V.dtp===parseInt(O.DATE_TIME,10)||V.dtp===parseInt(O.TIME,10);};}());(function(){mstrmojo.requiresCls("mstrmojo.StepperContentProvider","mstrmojo.num");var A=mstrmojo.num;function B(G,F){var H=F?G.max:G.min,D=F?G.min:G.max,E=G.getVal(F?1:-1);return(H===null||(F?(E<=H):(E>=H))||(D!==null&&G.canLoop));}function C(H,G){var F=H.min,D=H.max,E=H.getVal(G?1:-1);if((G&&D!==null&&E>D)||(!G&&F!==null&&(E<F))){if(H.canLoop){E=((E-F)%(D-F+1))+F;E=(E>=F)?E:E+(D-F+1);}else{return ;}}H.item[H.valField]=H.curVal=E;H.onTraverse();}mstrmojo.NumStepperContentProvider=mstrmojo.declare(mstrmojo.StepperContentProvider,null,{scriptClass:"mstrmojo.NumStepperContentProvider",curVal:null,init:function(E){this._super(E);var F=this.item,D=function(I){var H=I&&F[I];return(H===null||H===undefined);},G=function(I,K,H){var J=H&&D.call(this,K)?null:F[K];if(J!==null&&J!==undefined){this[I]=J;}};G.call(this,"min",this.minField,true);G.call(this,"max",this.maxField,true);G.call(this,"maxLength",this.maxLengthField,true);G.call(this,"interval",this.intField);this._initCurrent();},_initCurrent:function(){var E=this.item,F=this.curVal=E[this.valField];if(F===null||F===undefined){var D=this.min;this.curVal=D!==null?D:0;}},next:function(){C(this,true);},prev:function(){C(this,false);},hasPrev:function(){return B(this,false);},hasNext:function(){return B(this,true);},renderItemAt:function(F){var E=this.getVal(F),D=this.renderer;return D?D.render(E,this):E;},getVal:function(D){return this.curVal+(this.interval*(D||0));},setVal:function(F){var G=this.min,D=this.max,E=this.getVal();if(typeof F!=="number"||isNaN(F)||F===E||A.inNumericRange(F,G,D)!==0){return ;}this.item[this.valField]=this.curVal=F;this.onTraverse();},onTraverse:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.threshold.ThresholdModel","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.models.FormatModel");var K=mstrmojo,F=mstrmojo.chart.model.enums.EnumDSSObjectType,E=mstrmojo.vi.viz.EnumVisualizationTemplates,H=1,D=["#ec7b75","#f6db7f","#84c87b"],I=[0.35,0.65],B=K.models.FormatModel,J=B.ENUM_PROPERTY_NAMES;function C(N,M,O,P){M.reverse().forEach(function(Q){P.push(N.getClearThresholdAction(O.did,O.t||F.DssTypeMetric,Q.tid));});}mstrmojo.vi.util.ThresholdUtils=mstrmojo.provide("mstrmojo.vi.util.ThresholdUtils",{addClearAllThresholdsActions:function L(M,O,S){var R=O.data.gsi,N=R.mx,P=R.thresholds,Q;if(P){N.forEach(function(U){Q=P[U.did];if(Q){C(M,Q,U,S);}});R.thresholds={};}},addThresholds:function A(V,a,P,U,R,M,N,Q){var S,X=[],W=new mstrmojo.threshold.ThresholdModel({data:P.data}),Y=W.data.gsi.thresholds,O=Y&&Y[U.did];R=R||[];if(!O||Q){M=M||D;N=N||I;for(S=0;S<M.length;S++){var Z={};Z.fmt=B.getFormatUpdate(J.BACKGROUND_COLOR,M[S]);B.getFormatUpdate(J.FILL_STYLE,0,Z.fmt);if(S>0){Z.flr=W.getRealValue(N[S-1],H);}if(S<N.length){Z.ceil=W.getRealValue(N[S],H);}X.push(Z);}if(O){C(V,O,U,R);}R.push(V.getCreateSimpleThresholdAction(X,a.k,U.did,H,null,4));}W.destroy();return R;},getDefaultGMThreshold:function G(O){var N,M;switch(O){case E.GRAPHMATRIXHORIZONTALBARCLUSTERED:case E.GRAPHMATRIXHORIZONTALBARSTACKED:case E.GRAPHMATRIXHORIZONTALBARPERCENT:case E.GRAPHMATRIXVERTICALBARCLUSTERED:case E.GRAPHMATRIXVERTICALBARSTACKED:case E.GRAPHMATRIXVERTICALBARPERCENT:case E.GRAPHMATRIXVERTICALBARAUTOMATIC:case E.GRAPHMATRIXPIE:N=["#d2e0e8","#a4cbe6","#80add9","#558dcc","#2e78bb"];M=[0.2,0.4,0.6,0.8];break;case E.GRAPHMATRIXVERTICALLINECLUSTERED:case E.GRAPHMATRIXVERTICALLINESTACKED:case E.GRAPHMATRIXVERTICALLINEPERCENT:case E.GRAPHMATRIXVERTICALLINEAUTOMATIC:case E.GRAPHMATRIXHORIZONTALLINECLUSTERED:case E.GRAPHMATRIXHORIZONTALLINESTACKED:case E.GRAPHMATRIXHORIZONTALLINEPERCENT:case E.GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case E.GRAPHMATRIXVERTICALAREACLUSTERED:case E.GRAPHMATRIXVERTICALAREASTACKED:case E.GRAPHMATRIXVERTICALAREAPERCENT:case E.GRAPHMATRIXVERTICALAREAAUTOMATIC:case E.GRAPHMATRIXHORIZONTALAREACLUSTERED:case E.GRAPHMATRIXHORIZONTALAREASTACKED:case E.GRAPHMATRIXHORIZONTALAREAPERCENT:case E.GRAPHMATRIXHORIZONTALAREAAUTOMATIC:N=["#ec7b75","#f6db7f","#84c87b"];M=[0.35,0.65];break;case E.GRAPHMATRIXBUBBLECIRCLEMM:case E.GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case E.GRAPHMATRIXBUBBLEGRIDSQUAREAA:case E.GRAPHMATRIXBUBBLESQUAREAM:case E.GRAPHMATRIXBUBBLESQUAREMM:N=["#abcffa","#7ca8de","#4570af","#224b8f","#0e3270"];M=[0.2,0.4,0.6,0.8];break;default:break;}return{colors:N,ranges:M};}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.registry","mstrmojo._HasContextMenu","mstrmojo.Widget");var F=mstrmojo.dom,K=mstrmojo.css,N=16;mstrmojo.ContextMenuItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.ContextMenuItem",SUBMENU_SHIFT:3,visible:true,checked:false,enabled:true,buildDom:function(){var V=document.createElement("tr"),W=this.data,Z=this._cmSource,R,S;V.id=this.id;V.className="mstrmojo-ContextMenuItem "+(Z.isSeparatorItem(W)?"separator":Z.item2textCss(W));var X=this,Y=function(){X.handleMouseOver();},U=function(){X.handleMouseOut();},Q=function(){X.handleClick();};F.attachEvent(V,"mouseover",Y);F.attachEvent(V,"mouseout",U);F.attachEvent(V,"click",Q);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-left";S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-text";if(Z.isSeparatorItem(W)){S=document.createElement("img");S.src="../images/1ptrans.gif";}else{S=document.createElement("div");S.className="mstrmojo-CMI-content";R.innerHTML=W.itemWidget?"&nbsp":W[this.itemField];}R.appendChild(S);R=document.createElement("td");V.appendChild(R);R.className="mstrmojo-CMI-right "+(this.hasSubmenu?"sm":"");S=document.createElement("img");S.src="../images/1ptrans.gif";R.appendChild(S);return V;},buildRendering:function L(){this._super();var Q=this.data.itemWidget;if(Q){Q.placeholder=this.domNode.cells[1].children[0];Q.data=this.data;Q=mstrmojo.insert(Q);Q.render();Q.parent=this;this.itemWidget=Q;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"":"none";},oncheckedChange:function(){K.toggleClass(this.domNode,["checked"],this.checked);},onenabledChange:function(){K.toggleClass(this.domNode,["disabled"],!this.enabled);}},getMenuPosition:function I(){var Q=F.position(this.domNode,true);return{x:Math.round(Q.x+Q.w-this.SUBMENU_SHIFT),y:Math.round(Q.y)};},getContextMenuItems:function B(){return this.data[this.itemChildrenField];},getContextMenuCssClass:function D(){return this.data.cmCssClass||"";},callOnContextMenuOpen:function M(){var Q=this.data;if(Q.onContextMenuOpen){Q.onContextMenuOpen.apply(this,[]);}},callOnContextMenuClose:function A(){var Q=this.data;if(Q.onContextMenuClose){Q.onContextMenuClose.apply(this,[]);}},attachMousedownEvent:function J(){},getContextMenuSource:function P(){return this._cmSource;},adjustMenuPosition:function G(){var Q=this._subMenu,U=this._subMenu.domNode,S=U.offsetHeight,R=U.offsetWidth,X=F.windowDim(),W=F.position(U,false),V=F.position(U,true);if((W.x+R+N)>X.w){Q.set("left",(F.position(this.domNode,true).x-R)+"px");}else{Q.set("left",(F.position(this.domNode,true).x+this.domNode.offsetWidth)+"px");}if((W.y+S+N)>X.h){Q.set("top",(X.h-S-N+(V.y-W.y))+"px");}},handleMouseOver:function O(){var Q=this,R=function(){if(Q.hasSubmenu){Q.showContextMenu();}Q._cmSource.closeMenuTree(Q);Q._mouseOverTimer=null;};if(this._cmSource.activeMenuItem!==this){this._mouseOverTimer=window.setTimeout(R,80);}},handleMouseOut:function H(){if(this._mouseOverTimer){window.clearTimeout(this._mouseOverTimer);this._mouseOverTimer=null;}},closeMenuTree:function C(){this._cmSource.closeMenuTree();},handleClick:function E(){if(this.hasSubmenu){return ;}var Q=this._cmSource,R=this.data;if(!this.itemWidget){if(!Q.isSeparatorItem(R)&&Q.queryEnabled(R)){if(Q.executeCommand){Q.executeCommand(this.data);}Q.closeMenuTree();}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._RowRendTracker","mstrmojo.array","mstrmojo.dom","mstrmojo.url","mstrmojo.chart.model.enums.EnumDSSBaseFormType");var L="<tr>";var Y=mstrmojo.dom;var h=['<table cellspacing="0" cellpadding="0" style="table-layout:',null,";width:",null,';mstr-tablestyle-slot" ',null,">",null,"<tbody>"];var U="&nbsp;";var g="fsbp_1 ";var X="fsbp_2 ";var Q="fsbp_3 ";var e=1,f=2,G=3,d=4,m=5,S={1:" stack-top",2:" stack-middle",3:" stack-bottom",4:" stack-bottom-last",5:" no-stack",6:" stack-full"},K=1,k=3;var B=mstrmojo.css,a=mstrmojo.array,P=mstrmojo.chart.model.enums.EnumDSSBaseFormType;var N=4;function Z(q,r,n){var p=true,o=0;if(n.cs>1){for(o=0;o<n.cs;o++){p=p&&q[r+n.cs-o-1];}}else{p=q[r];}return p;}function V(p,o){for(var q=0,n=p.length;q<n;q++){var s=p[q];var r=o.rows[s.rows].cells[s.cells];if(r){mstrmojo.css.addClass(r,g);}}}function c(p){var r=p.indexOf('src="');if(r<0){return p;}var q=p.substring(r+5),o=q.indexOf('"'),s;q=q.substring(0,o);s=q;if(mstrApp.isDossier){s=mstrmojo.url.getFullPath(q);}else{var n=this.parent&&this.parent.controller&&this.parent.controller.model&&this.parent.controller.model.dataService;if(n&&n.getImage){s=n.getImage(q);}}return p.replace(q,s);}function l(r,q){var n="",s="#srcend",o=-1,p,t=r.split("#srcstart");t.forEach(function(u){o=u.indexOf(s);p=u.split(s);p.forEach(function(w,v){if(v===0&&o!==-1){w=w.substring(0,o);n+='<img src="'+w+'" '+q+">";}else{n+=w;}});});return n;}function D(p,o,n){var u=p.outLvl,q="outlineMode",t=this.parent.outlineState,s=p._ei,r=s?(' ei="'+s+'"'):"";if(t&&t[s]){q+=p.hidden?" hiddenRow":"";}else{if((n>0&&u>n)){q+=" hiddenRow";}}if(this.parent.hasEmptyTBody&&q.indexOf("hiddenRow")===-1){this.parent.hasEmptyTBody=false;}return' level="'+u+'" class="'+q+'"'+r+">";}var J=(function(){var q=/\n/g,u="<br/>",AA=/<a\s[^>]+>/gi,z="<a ",AI='<a target="_blank" ',o="target=";var x='<a href="',v="",s="</a>",p="<span>",n="</span>",AF="<div>",AE="</div>",AC='<span class="text">',AB="</span>",w='<span rabtn class="raBtn ',t='"></span>',AD="iconRA-expand",r="iconRA-collapse",AH="<span>",AG="</span>";return function(AK,AU,AS){var AX=AK.v||AK.n||U,AO=AK.ts===P.DssBaseFormUrl,AR=AK.ts===P.DssBaseFormHTMLTag,AW=AK.lv!==undefined;AX=(AK.ts===P.DssBaseFormText||AK.mdf===1)?AX.replace(q,u):AX;if(AO){if(!v){v=AU?'" target="_blank">':'">';}AX=x+AX+v+AX+s;}else{if(AR&&AU){(AX.match(AA)||[]).forEach(function(Ab){if(Ab.indexOf(o)===-1){AX=AX.replace(Ab,Ab.replace(z,AI));}});}}if(AR){var AL=document.createElement("div");AL.innerHTML=AX;var AP=AL.querySelectorAll("img");a.forEach(AP,function(Ac){Ac.onload=function Ab(){var Ad=mstrmojo.all[AS];if(Ad){if(Ad._updateScrollbarTimer){clearTimeout(Ad._updateScrollbarTimer);}Ad._updateScrollbarTimer=setTimeout(function(){Ad.updateScrollbars();},100);}};});AX=AL.innerHTML;}if((AK.css&&AK.css.indexOf("hl")>-1)||AO){AX=p+AX+n;}if(AW){var AZ=AK.lv,Aa="&nbsp;&nbsp;&nbsp;&nbsp;",AN="",AJ="",AT="",AV;for(AV=0;AV<AZ;AV++){AN+=Aa;}if(AK.hcd&&AK.fi===undefined){AT=w+(AK.epd?r:AD)+t;}else{AN+=Aa;}if(AK.axis===1){AJ=AH+AN+AG;}AX=AF+AJ+AT+AC+AX+AB+AE;}else{if(AK.outLvl&&AK.cs>1&&!AK.isLeaf){var AY=(AK.stt&&!AK.dpt),AM=AY?"":"icon-outline-span"+(AK.epd?" outline-expand":" outline-collapse"),AQ=!AY&&AK.epd?' collapsed="true"':"";AX='<span class="'+AM+'"  sty="outimg" dpt="'+AK.outLvl+'"'+AQ+"></span>"+AX;}else{if(AK.expandLevel){AX='<span class="icon-outline-span outline-collapse" expandTo="'+AK.expandLevel+'" title=""></span>'+AX;}else{if(AK.fillerCell&&AX==U){AX="";}}}}return AX;};}());mstrmojo.GridBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._RowRendTracker],{scriptClass:"mstrmojo.GridBase",markupString:'<span id="{@id}" class="mstrmojo-Grid {@cssClass}" style="{@cssText}"></span>',markupSlots:{gridContainerNode:function(){return this.domNode;}},autoFitWindow:false,tableLayout:null,numAutoHeightRows:0,cp:null,rc:0,cc:0,cws:null,rh:null,totalColWidth:0,start:0,end:0,forceFixedSizes:true,hiliteCellsMap:null,eiMap:null,init:function C(n){this._super(n);},numColumnCanMerge:0,preBuildRendering:function A(){var n=this.cp;if(!n){return ;}n.initContent();this.rc=n.rc||0;this.cws=n.colWidths||[];this.cc=this.cws.length;this.tdWidths=n.tdWidths||[];this.tdCnt=this.tdWidths?this.tdWidths.length:0;this.start=0;this.end=this.rc-1;this.numAutoHeightRows=n.getNumAutoHeightRows&&n.getNumAutoHeightRows()||0;this.hiliteCellsMap={};this.eiMap={};this.posMap=[];this.thPosMap=[];this.totalColWidth=0;},buildRendering:function b(o){var n=this._super(o);this.renderGrid();return n;},renderGrid:function F(o){var n=this.getGridContainer();this.preBuildGridTable();this.buildGridTable(n,o);this.postBuildGridTable();},getGridContainer:function H(){return this.gridContainerNode;},buildGridTable:function M(p,n){var o=this.getTableStartMarkup();var v=this.getTableEndMarkup();if(n){this.mergeHdrsAcrossBlks=true;}var t=this.buildTableRowsMarkup(this.start,this.end,o,v).join("");if(n){var r=document.createElement("div");r.innerHTML=t;var u=p.firstChild,w=u&&u.tBodies,q=r.firstChild.tBodies[0],s=this.matchedHdrsAcrossBlks;u.appendChild(q);if(s&&s.length>0){V(s,w[w.length-2]);}}else{p.innerHTML=t;}this.markPages(this.start,this.end);},getTableStartMarkup:function E(){var o=this._getGridWidths(),n=h;n[1]=o.tableLayout;n[3]=o.totalColWidths;n[5]=this.tableCssClass?"class="+this.tableCssClass:"";n[7]="<colgroup>"+o.colgroup+"</colgroup>";if(this.tbodyStyle){n[8]='<tbody style="'+this.tbodyStyle+'">';}return n.join("");},getTableEndMarkup:function O(){return"</tbody></table>";},_getGridWidths:function R(){var v={};var r="",p=[],u="fixed",o=this.cws,s=o.length;if(s){r=0;p=[];for(var q=0;q<s;q++){if(o[q].w!==""){r+=parseInt(o[q].w,10);}}for(q=0;q<s;q++){var n=o[q];if(n.w!==""&&!this.autoFitWindow&&!this.autoFitContent){var t=parseInt(n.w,10);if(mstrmojo.dom.isIE7){if(t===0){p.push('<col style="width:0%;display:none"></col>');}else{p.push('<col style="width:'+(t/r*100)+'%"></col>');}}else{if(mstrmojo.dom.isWK&&t===0){p.push('<col style="width:-1px"></col>');}else{p.push('<col style="width:'+n.w+'"></col>');}}}else{p.push("<col />");u="auto";}}this.totalColWidth=r;}v.colgroup=p.join("");u=this.tableLayout||u;if(this.autoFitWindow){u=this.tableLayout||u||"fixed";r="100%";}else{if(u==="fixed"){r+="px";}else{r="auto";}}v.totalColWidths=r;v.tableLayout=u;return v;},_CELL_MARKUP:['<td rowSpan="',null,'" colSpan="',null,'" class="',null,'" ei="',null,'" style="',null,'" r="',null,'">',null,"</td>"],buildTableRowsMarkup:function I(AH,Ac,AA,u,o){var Au=[],Ab=0;Au[Ab++]=AA||"<table><tbody>";var AT=this.cp,At=this.acws,Aw=this.rowMerge,A7=this.headerOffset,A8=this.mxPos,A0=!!AT.gemh,BB=AT.getRowHeight(),n=this._CELL_MARKUP,A9=BB?'<tr style="height:'+(BB?BB+"px":"")+'">':L;var Az=true,A4=true,AX=[],BE;var Aj=function Aj(v){var r=-1;mstrmojo.array.forEach(At,function(BG,BF){v=v-BG;if(v<0){r=BF;return false;}});return r;};var AM=function AM(BF,v){var r=-1;mstrmojo.hash.forEach(AT.gemh,function(BG,BH){if(BF<=BH&&BF+v>BH){r=BH;return false;}});return r;};var AG=function AG(BH,BI,BG){var BF="",v,r;r=BH.gemh&&BH.gemh[BI];if(r){v=Aj(BG);if(r[v]&&r[v].v===0||A8===BG){BF+=g;}}r=BH.gsmh&&BH.gsmh[BI];if(r){v=Aj(BG);if(r[v]&&r[v].v===0||A8===BG){BF+=Q;}}return BF;};var Ax,AQ,An,AR=[],Aa,AV,t=0,Ah=0,AY,AC,s=AT.colWidths&&AT.colWidths.length,BC=0,Aq=0,Al=o||((AA&&AA.indexOf("table-layout:fixed;")!==-1)?"fixed":"auto"),AK=mstrApp.isSingleTier;if(At&&A0){for(Aa=0;Aa<At.length-1;Aa++){Aq+=At[Aa];}}Aq=Aq||this.numColumnCanMerge;if(Al==="fixed"){Ax=[];for(AQ=0,An=this.cws.length;AQ<An;AQ++){if(window.parseFloat(this.cws[AQ].w)<=0){Ax[AQ]=true;}else{Ax[AQ]=false;}}}this.matchedHdrsAcrossBlks=[];var x=Ac,BA=this.parent.isOutlineMode,Am=this.parent.gridData,A6=Am.maxLevel,Ad=Am.lvlepd,z=this.parent.id,AU=0;AT.renderingNewPage=true;for(var AW=AH;AW<=Ac;AW++){t=0;BE=Ab++;Au[BE]=AW<this.numAutoHeightRows?L:A9;var p=AT.updateCounter,Ae=AT.getRowCells(AW);if(BA&&window.mstrApp&&mstrApp.isExporting){var AJ=AT.updateCounter-p;if(AJ>0){AU=AJ;}if(AU>0){AU--;Au[BE]=Au[BE].substr(0,Au[BE].length-1)+' extra="1">';}}var Ag=Ac+1-AW;var AO=0;AC=Aw;AY="";if(!this.mergeHdrsAcrossBlks){if(Az&&AH>0&&Ae.length<AT.colWidths.length){var Ao=AT.getUnmergedCells(AH),Ak;if(Ao){AO=Ao.length;}for(Aa=0,An=AO;Aa<An;Aa++){var As=Ao[Aa],A5=As.rs;if(A5>Ag){n[1]=Ag;n[5]=X+As.css;}else{n[1]=A5||1;n[5]=Q+As.css;}if(Ax&&Ax[Ah+t]){n[5]+=" nwFixedWidth0 ";}if(A5&&A5>1){AR.push(A5);}t+=As.cs||1;if(As.cet){n[5]+=" mstrmojo-selected-cell";this.addHilitePosition(As.cet,AW,Aa);}if(As._ei){this.addExtraInfoMap(As._ei,AW,Aa);n[5]+=" pt";}n[9]="";n[13]=U;n[3]=As.cs;if(As._ei===undefined){Ak=AT.getRowCells(As.o+(AT.cps[0]&&AT.cps[0].rc||0),true);As=a.filterOne(Ak,function(r){return r.dpt===As.dpt&&r.idx===As.idx;});}n[7]=As._ei;n[11]=AW;if(A0){if(AC){AY=AG(AT,AW-A7,Aa);}if(!!AY){n[5]=AY+n[5];}else{AC=false;}AY=AG(AT,AM(AW-A7,n[1]),Aa);if(!!AY){n[5]=g+n[5];AC=true;}}Au[Ab++]=n.join("");}Az=false;}}BC=s;An=Ae.length;var Af;for(Af=0;Af<An;Af++){BC-=Ae[Af].cs||1;}for(Af=0;Af<An;Af++){var AP=Ae[Af],A3;if(AP.outLvl){var A1=D.call(this,AP,A6,Ad);Au[BE]=Au[BE].replace(">",A1);if(AT.updateCounter>0){Ac=x+AT.updateCounter;}}AP.colIx=BC;if(AP.rs&&AP.rs>Ag){n[1]=Ag;n[5]=g+AP.css;if(AP._ei){this.addExtraInfoMap(AP._ei,AW,Af);}}else{n[1]=AP.rs||1;n[5]=AP.css;}if(Ax&&Ax[BC]){if(AP.cs==undefined||Z(Ax,BC,AP)){n[5]+=" nwFixedWidth0 ";}}if(AP.rs&&AP.rs>1){AR.push(AP.rs);}t+=AP.cs||1;if(AP.rowType!==e){n[5]+=" xtab-td ";}if(AP.cet){n[5]+="sc_"+this.parent.k;this.addHilitePosition(AP.cet,AW,Af);}if(AP.lv!==undefined){n[5]+=" ra ";}A3=AP.rowType;if(A3){n[5]+=S[A3]||"";var AS=AT.getRowHeight(A3);if(AS){Au[BE]='<tr style="height:'+(AS?AS+"px":"")+'">';}}n[3]=AP.cs||1;n[7]=AP._ei!==undefined?AP._ei:"";if(AP.fs||AP._e){this.addTitleHeaderPositionMap(AW,Af+AO,AP);}if(AP._ei!=null){this.addPositionMap(AP._ei,AW,Af+AO);}n[11]=AW;if(AP.ts===N){if(mstrApp.isDossier){AP.v=mstrmojo.url.getFullPath(AP.v);}var Av=AP.v;if(this.imgCacheMap){var AZ=this.imgCacheMap,AV=Av&&Av.replace(/\\/g,"/");if(AZ.cachedImg[AV]){AP.v=Av=AZ.baseURL+AZ.cachedImg[AV];}else{if(AV&&!AZ.unCachedImg[AV]){AZ.unCachedImg[AV]=AV;}}}else{var AB=this.parent&&this.parent.controller&&this.parent.controller.model&&this.parent.controller.model.dataService;if(AB&&AB.getImage){Av=AB.getImage(Av);}}if(AP.rowType){var AI=(AT.getRowHeight(AP.rowType)||AT.rh||BB),AL=AI,BD=this.tdWidths,AE=AP.colIdx,w=0,AD=0;var Ai=AT.getPadding(K),Ay=AT.getPadding(k);if(AP.rowType===e||AP.rowType===d){AD=AI>(Ai+Ay)?(AI-Ai-Ay):0;}else{if(AP.rowType===f||AP.rowType===G){AD=AI>2*Ay?(AI-2*Ay):0;}else{if(AP.rowType===m){AD=AI>(Ay*2)?(AI-Ay*2):0;}}}if(AE!=="undefined"&&AE>-1&&BD&&BD.length>AE){var AN=BD[AE]&&BD[AE].w;if(AN!=="undefined"){w=parseInt(AN,10);}}var q=w>30?(w-30):0;n[13]='<div><div style="top:'+(-parseInt(AL/2,10))+"px;height:"+(AI-1)+"px;line-height:"+(AI-1)+'px !important;">&nbsp;<img style="max-height:'+AD+"px; max-width: "+q+'px;" src="'+Av+'"></img></div></div>';}else{n[9]="";var Ap="",AF=this.parent&&this.parent.controller&&this.parent.controller.model&&this.parent.controller.model,Ar=AF.getZoomFactor();if(Ar!=1){Ap='onload="this.style.height='+Ar+"*this.offsetHeight+'px';\"";}if(BA){if(Av.indexOf("#srcstart")!==-1){AP.v=l(Av,Ap);}else{AP.v='<img src="'+Av+'" '+Ap+"></img>";}n[13]=J(AP,AK,z);}else{n[13]='<img src="'+Av+'" '+Ap+"></img>";}if(AP.css&&AP.css.indexOf("hl")>-1){n[13]="<span>"+n[13]+"</span>";}}}else{n[9]="";if(BA&&AP.v&&AP.v.indexOf("#srcstart")>=0){AP.v=l(AP.v,"");n[13]=J(AP,AK,z);}else{if((mstrApp.isDossier||mstrApp.useBinaryFormat)&&AP.v&&AP.v.indexOf("img")>=0){AP.v=c.call(this,AP.v);}n[13]=J(AP,AK,z);}}if(Af<Aq){if(AW===AH&&this.mergeHdrsAcrossBlks){var A2=this.rowHdsAcrossBlks;if(A4&&AP.v&&A2&&A2[Af]){if(AP.v===A2[Af].v){n[1]=AP.rs||1;n[5]=Q+AP.css;n[13]="";this.matchedHdrsAcrossBlks.push(A2[Af]);}else{A4=false;}}}if(A0){if(AC){AY=AG(AT,AW-A7,BC);if(!!AY){n[5]=AY+n[5];if(AY.indexOf(Q)>=0&&AW-A7>1){n[13]=U;}}else{AC=false;}AY=AG(AT,AM(AW-A7,n[1]),BC);if(!!AY){n[5]=g+n[5];AC=true;}}}if(n[1]>=Ag&&AP.v){AX.push({rows:AW-AH,cells:Af,v:AP.v});}}BC+=AP.cs||1;Au[Ab++]=n.join("");}Au[Ab++]="</tr>";for(Af=AR.length-1;Af>=0;Af--){AV=AR[Af];if(AV<=1){AR.pop();}else{AR[Af]=--AV;}}Ah=AR.length;}Au[Ab++]=u||"</tbody></table>";this.rowHdsAcrossBlks=AX;return Au;},addHilitePosition:function(o,p,n){var q=this.hiliteCellsMap[o];if(!q){this.hiliteCellsMap[o]={pos:[],nodes:[]};}this.hiliteCellsMap[o].pos.push({row:p,cell:n,page:0});},addExtraInfoMap:function(o,n,p){if(!this.eiMap[o]){this.eiMap[o]=[];}this.eiMap[o].push({row:n,cell:p,page:0});},addPositionMap:function(o,n,p){if(!this.posMap[o]){this.posMap[o]={row:n,cell:p,page:0};}},addTitleHeaderPositionMap:function(n,q,p){this.thPosMap.push({row:n,cell:q,page:0,obj:p});},clearHilites:function(q){var u=this.hiliteCellsMap[q],s=u&&u.nodes,r=this.parent;if(s){if(s.length==0&&u.pos){s=this.getNodesByPositions(u.pos);}for(var p=0,o=s.length;p<o;p++){var t=s[p],n=r.getCellForNode(t);if(n){delete n.cet;}B.removeClass(t,"sc_"+r.k);}this.hiliteCellsMap[q].nodes=[];}},setHilites:function(o,p){B.addClass(p,"sc_"+this.parent.k);if(!this.hiliteCellsMap[o]){this.hiliteCellsMap[o]={pos:[],nodes:[]};}this.hiliteCellsMap[o].nodes.push(p);var n=this.parent.getCellForNode(p);if(n){n.cet=o;}},getNodesByPositions:function(r){var q=this.tableNode,n=[];for(var p in r){var o=r[p];n.push(q.tBodies[0].rows[o.row].cells[o.cell]);}return n;},preBuildGridTable:function W(){},postBuildGridTable:function j(){this.addSlots({tableNode:this.gridContainerNode&&this.gridContainerNode.firstChild});if(this.tableNode&&mstrApp&&mstrApp.isSingleTier){Y.redirectUrlToFormWrapper(this.tableNode);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Widget");var A=mstrmojo.css;mstrmojo.TabButton=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.TabButton",markupString:'<span id="{@id}" class="mstrmojo-TabButton {@cssClass}" style="{@cssText}" mstrAttach:click></span>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},ontitleChange:function(){this.domNode.innerHTML=this.title||"";},onbackgroundColorChange:function(){this.domNode.style.backgroundColor=this.backgroundColor||"";},onselectedChange:function(){A.toggleClass(this.domNode,["selected"],!!this.selected);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");var E=mstrmojo.Widget;mstrmojo.ui._IsPulldown=mstrmojo.provide("mstrmojo.ui._IsPulldown",{scriptClass:"mstrmojo.ui._IsPulldown",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text {@cssTextClass}" title="{@title}" style="{@labelCssText}">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function D(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:E.visibleMarkupMethod,onheightChange:E.heightMarkupMethod,onwidthChange:E.widthMarkupMethod,onvalueChange:function F(){this.selectedNode.innerHTML=this.value||"";},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},getPopupList:mstrmojo.emptyFn,anchorSlot:"selectedNode",postBuildRendering:function B(){this._super();this.getPopupList().set("items",this.items);var G=this.selectedIndex,H=this.selectedIndices;if(G!==undefined){this.set("selectedIndex",G);}if(H!==undefined){this.set("selectedIndices",mstrmojo.hash.copy(H||{}));}},onitemsChange:function C(){var G=this.getPopupList();if(G){G.set("items",this.items);}},onPopupWidgetOpened:function(){var G=this.getPopupList();if(G&&(!G.items||G.items.length===0)){G.close();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var C=mstrmojo.dom,B=mstrmojo.hash,E=mstrmojo.css;mstrmojo.Button=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Button",iconClass:"",innerIconClass:"",title:"",text:"&nbsp;",enabled:true,selected:false,markupString:'<div id="{@id}" class="mstrmojo-Button {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:touchstart,click,mousedown,mouseup><div class="mstrmojo-Button-text {@innerIconClass}"></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:function(){E.toggleClass(this.domNode,"disabled",!this.enabled);},onselectedChange:function(){E.toggleClass(this.domNode,"selected",this.selected);},ontextChange:function(){this.textNode.innerHTML=this.text;},ontitleChange:function(){this.domNode.title=this.title;},onwidthChange:mstrmojo.Widget.widthMarkupMethod},oniconClassChange:function D(J){var K=this.domNode;if(this.hasRendered&&K){K.className=K.className.replace(J.valueWas,"")+" "+J.value;}},onclick:mstrmojo.emptyFn,ontouchend:function I(J){this.onclick(J);}});mstrmojo.Button.newIconButton=function H(L,O,M,J,N){var K={scriptClass:"mstrmojo.Button",title:L,cssClass:O,text:"",onclick:M};if(J){K.bindings=J;}B.copy(N,K);return K;};function F(M,N,J,P){var L=[];if(J){L.push(J);}var O=P&&P.cssClass;if(O){L.push(O);delete P.cssClass;}var K={scriptClass:"mstrmojo.Button",cssClass:L.join(" "),text:M};if(N){K.onclick=N;}return B.copy(P,K);}mstrmojo.Button.newInteractiveButton=function G(M,N,P,O){var L={glowClass:"glow"};if(P&&(C.isFF||C.isWK)){B.copy({onmousedown:function J(){E.applyShadow(this.domNode,0,0,10,P);},onmouseup:function K(){E.removeShadow(this.domNode);}},L);}return F(M,N,"mstrmojo-InteractiveButton",B.copy(O,L));};mstrmojo.Button.newWebButton=function A(K,J,M,L){return F(K,J,"mstrmojo-WebButton"+(M?" hot":""),L);};mstrmojo.Button.newActionButton=function(K,L,M){var J=mstrmojo.Button.newWebButton(K,L,false,M);J.cssClass=J.cssClass+" action-button";return J;};}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.desc","mstrmojo.Widget");var A=mstrmojo.css,B=mstrmojo.dom;mstrmojo.vi.ui.TargetMask=mstrmojo.declare(mstrmojo.Widget,[],{scriptClass:"mstrmojo.vi.ui.TargetMask",markupString:'<div class="mstrmojo-hasTgt" mstrAttach:contextmenu><div class="tgt"><div></div>'+mstrmojo.desc(4787,"Target")+'</div><div class="src"><div></div>'+mstrmojo.desc(4283,"Source")+"</div></div>",useRichTooltip:true,isDynamicTooltip:true,tooltipContent:mstrmojo.desc(15275,"This container cannot be selected as target"),allowFilters:false,init:function D(E){if(this._super){this._super(E);}},setMaskClass:function(H){var F=this.parent,G=F instanceof mstrmojo.vi.ui.rw.VizBox,E=F instanceof mstrmojo.vi.ui.rw.FilterBox;if(this.domNode){if(F.id===H){A.addClass(this.domNode,"sourced");}else{if(!G&&!(E&&this.allowFilters)){A.addClass(this.domNode,"disabled");}else{A.addClass(F.domNode,"targeted");}}this.domNode.style.display="block";return true;}return false;},clearMaskClass:function(){var E=this.parent;A.removeClass(this.domNode,"sourced");A.removeClass(this.domNode,"disabled");A.removeClass(E.domNode,"targeted");this.domNode.style.display="none";},moveTooltip:function C(E,F){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A tgt-tt",content:this.tooltipContent,top:E.clientY+15,left:E.clientX-15};this._super(E,F);},oncontextmenu:function(F,E){B.preventDefault(E,F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.css","mstrmojo._IsExprNode","mstrmojo._HasPopup","mstrmojo.Widget","mstrmojo.fe.FilterUtils");var I=mstrmojo.dom,A=mstrmojo.css,E=mstrmojo.fe.FilterUtils,D=E.getExprConditionNodeHtml,B=E.getExprNodeHtmlAndText;function C(J){var K=J.data;return D(K);}mstrmojo.ConditionNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.ConditionNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},oneditableChange:function(){A.toggleClass(this.textNode,["editable"],this.editable);},onselectedChange:function(){A.toggleClass(this.condNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();var J=B(this.data);this.textNode.innerHTML=J.html;this.textNode.title=J.text;this.textPostfixNode.innerHTML=this.getConditionTextPostfix();}},betweenText:mstrmojo.desc(308,"and"),atText:mstrmojo.desc(5923,"at"),emptyText:mstrmojo.desc(7930,"Empty condition"),init:function H(J){this._super(J);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());},getConditionTextPostfix:function(){return"";},del:function G(){var J=this.parent;if(J&&J.remove&&this.data){J.remove(this.data);}},isEmpty:function(){var K=this.data,J=K&&K.et,L=J&&mstrmojo.expr.ET2TGT[J];return !(L&&K[L]);},isSelectableArea:function(J){return I.contains(this.condNode,J,true);},preclick:function F(J){var L=null,K=I.eventTarget(J.hWin,J.e);if(I.contains(this.prefixNode,K,true)){L="andor";}else{if(I.contains(this.textNode,K,true)){L="condition";}else{if(I.contains(this.textPostfixNode,K,true)){I.stopPropogation(J.hWin,J.e);return false;}}}J.part=L;}});mstrmojo.ConditionNode.getFunctionNode=C;})();(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Widget","mstrmojo.Arr","mstrmojo._HasLayout","mstrmojo._ListBase2Selections","mstrmojo.ListSelector","mstrmojo._TouchScrolling","mstrmojo._PagingList");var b=mstrmojo.hash,g=mstrmojo.array,f=mstrmojo.boxmodel,d=mstrmojo.dom;function A(k,m,j){var l=k.listSelector;if(l){l[m](k,k.itemsContainerNode,j);}}function L(k,j){var l=k.lastPagePos;if(!l||l.dragId!==j){l=f.offset(k.itemsContainerNode);l.dragId=j;k.lastPagePos=l;var m=k.scrollboxNode;k.lastScrollPos={left:m.scrollLeft,top:m.scrollTop,width:m.clientWidth,height:m.clientHeight};}}function O(m,p,k){var l=p&&p.node;if(l===m.dropCueNode||l===m.dropCueNode.firstChild){return m.dropCuePos;}var n=m.listMapper;var j=n&&n.whereDrop(m,m.itemsContainerNode,l,p.pos,{left:m.lastPagePos.left-m.lastScrollPos.left,top:m.lastPagePos.top-m.lastScrollPos.top,width:m.lastScrollPos.width,height:m.lastScrollPos.height});var o=m.dropCuePos;return((k!==false)&&o&&j&&(o.idx===j.idx)&&(o.left===j.left)&&(o.top===j.top))?o:j;}var h="attachEventListener";function D(k,j){if(k.makeObservable){j=j||[];if(!j[h]){mstrmojo.hash.make(j,k.itemsScriptClass||mstrmojo.Arr);}}return j;}function H(k,j){if(j&&j[h]){k._sub_its=j;k._sub_add=j[h]("add",k.id,"preadd");k._sub_rmv=j[h]("remove",k.id,"preremove");}}function G(j){if(j._sub_its){var k=mstrmojo.publisher;k.unsubscribe(j._sub_add);k.unsubscribe(j._sub_rmv);delete j._sub_add;delete j._sub_rmv;delete j._sub_its;}}mstrmojo.ListBase2=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListBase2Selections,mstrmojo._TouchScrolling,mstrmojo._PagingList,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ListBase2",items:null,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode;},itemsContainerNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},ondropCuePosChange:function(){var k=this.dropCueNode,j=k&&k.style;if(!j){return ;}var m=this.dropCuePos,l=!!m;if(l){j.left=m.left+"px";j.top=m.top+"px";}j.display=l?"block":"none";},onpageChange:function(){if(this.usePaging&&!this._inScroll){this._inPaging=true;this.listMapper.toPage(this,this.page);this._inPaging=false;}},onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}}},autoHide:false,renderOnScroll:false,firstRenderBlockSize:50,renderBlockSize:50,listMapper:null,listBuilder:null,listSelector:mstrmojo.ListSelector,animate:false,itemsEffect:null,containerResizable:true,init:function a(m){this._super(m);this.items=this.initItems(this.items);var l=this.selectedIndices,j=this.selectedIndicesList,k=this.selectedIndex,n=this.selectedItem;this.selectedIndices={};this.selectedIndex=-1;delete this.selectedIndicesList;delete this.selectedItem;if(l||j||(k>-1)||n){this.initSelections(l,j,k,n);}if(this.postInitItems){this.postInitItems();}},initItems:function I(j){return D(this,j);},preBuildRendering:function X(){var n=this.listBuilder,q=n.newContext(this);this.ctxtBuilder=q;var k=this.markupSlots,m=!!(this.renderOnScroll&&this.renderBlockSize&&k&&k.scrollboxNode),l=this.items,j=(l&&l.length)||0,o=m?this.firstRenderBlockSize:j,p=m?this.firstRenderBlockSize:0;this._eros=m;this.paused=false;this.itemsHtml=this.listMapper.buildItemWrappers(l,n,this,q,o,p).join("");this.itemsContainerCssText="visibility: hidden";if(this._super){this._super();}},postBuildRendering:function E(){delete this.itemsHtml;var o=this.listMapper;if(o&&o.postBuildRendering){o.postBuildRendering(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder);}H(this,this.items);if(this._eros||this.usePaging){if(!this._cb_scroll){var q=this.id;this._cb_scroll=function(){var n=mstrmojo.all[q];n.onscroll();};}mstrmojo.dom.attachEvent(this.scrollboxNode,"scroll",this._cb_scroll);this.onscroll();}if(this.animate){for(var l=0,k=["itemsEffect","scrollEffect"],j=k.length;l<j;l++){var p=k[l],m=this[p];if(m&&m.constructor===Object){m=mstrmojo.insert(mstrmojo.hash.clone(m));m.widget=this;this[p]=m;}}if(this.itemsEffect){this.itemsEffect.play();}}this.itemsContainerNode.style.visibility="inherit";if(this.containerResizable&&this.itemsContainerNode.scrollWidth<this.domNode.scrollWidth){this.itemsContainerNode.style.width=this.domNode.scrollWidth+"px";}if(this._super){this._super();}},unrender:function Y(m){G(this);if(this._eros){mstrmojo.dom.detachEvent(this.scrollboxNode,"scroll",this._cb_scroll);delete this._cb_scroll;}for(var k=0,l=["itemsEffect","scrollEffect"],j=l.length;k<j;k++){var n=this[l[k]];if(n&&n.isPlaying){n.cancel();}}this._super(m);},pauseScrollRendering:function P(l,j,k){if(l!==false){l=true;}if(this.paused===!!l){return ;}this.paused=!!l;if(l){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}}else{this.fill(j,k);}},onscroll:function K(){if(this.paused){return ;}if(this._eros){if(!this._fillTmr){var j=this;this._fillTmr=self.setTimeout(function(){j.fill();j=null;},50);}}if(this._super){this._super();}},fill:function c(j,n){if(this._fillTmr){window.clearTimeout(this._fillTmr);delete this._fillTmr;}var o=(this.items&&this.items.length)||0;if(!o){if(n){n();}}else{var l=this.scrollboxNode,p=this.itemsContainerNode,m=mstrmojo.boxmodel.offset(p,l),r=this.listMapper,q=r.findScrollRange(p,o,(this.usesTouches&&this.pos&&parseInt(this.pos.y,10))||l.scrollTop,l.clientHeight,(this.usesTouches&&this.pos&&parseInt(this.pos.x,10))||l.scrollLeft,l.clientWidth,m.left,m.top);if(this.fillAt(q.start,q.end)){if(j){j();}var k=this.id;this._fillTmr=window.setTimeout(function(){mstrmojo.all[k].fill(j,n);},100);}else{if(n){n();}}}},fillAt:function M(l,k){var j=this.listMapper;if(j){return j.fillItemWrappers(this.itemsContainerNode,this.items,this.listBuilder,this,this.ctxtBuilder,l,k,this.renderBlockSize);}else{return false;}},add:function R(k,j){if(!k||!k.length){return -1;}var l=this.items;if(j==null){j=b.min(this.selectedIndices,false,true);if(j!==null&&j!==undefined){j++;}}if(j==null||j===-1){j=(l&&l.length)||0;}if(l&&l.add){l.add(k,j);}else{this.set("items",l?g.insert(l.concat(),j,k):k);}return j;},preadd:function B(l){if(this.hasRendered){var o=this.listMapper;if(o){o.onadd(this,this.itemsContainerNode,this.ctxtBuilder,l);}var n=this.listBuilder;if(n){n.onadd(this,this.ctxtBuilder,l);}var k=this.listSelector;if(k){k.onadd(this,l);}if(this._eros){this.onscroll();}else{var m=l.index,j=l.value.length;this.fillAt(m,m+j-1);}}if(this.onadd){this.onadd(l);}if(this._super){this._super(l);}},remove:function V(j){if(j==null){return -1;}if(j.constructor!==Array){return this._remove(j);}var l=this.items;if(l){var k;if(l.remove){for(k=j.length-1;k>-1;k--){l.remove(j[k],1);}}else{l=l.concat();for(k=j.length-1;k>-1;k--){l.splice(j[k],1);}this.set("items",l);}return j[0];}return -1;},_remove:function V(l){var k=this.items;if(!k||(l==null)){return -1;}var j;if(!isNaN(l)){j=l;}else{j=this.itemIndex(l);}if(j>-1){if(k.remove){k.remove(j,1);}else{k=k.concat();k.splice(j,1);this.set("items",k);}}return j;},duplicate:function Z(o,k,l){var m=this.items,j=-1;if(!m||(o==null)){return -1;}if(!isNaN(o)){if(k===null||k===undefined){k=o+1;}o=m[o];}else{if(k===null||k===undefined){k=this.itemIndex(o)+1;}}if(o){var n;n=b.copy(l,b.clone(o));j=this.add([n],k);}return j;},preremove:function N(k){if(this.hasRendered){var m=this.listMapper;if(m){m.onremove(this,this.itemsContainerNode,this.ctxtBuilder,k);}var l=this.listBuilder;if(l){l.onremove(this,this.ctxtBuilder,k);}var j=this.listSelector;if(j){j.onremove(this,k);}if(this._eros){this.onscroll();}}if(this.onremove){this.onremove(k);}if(this._super){this._super(k);}},move:function S(m,r){function p(t,s){return r>=t&&r<=t+s;}var q=(this.items&&this.items.length)||0;if(r===-1||r==null||isNaN(r)){r=q;}else{r=Math.min(r,q);}var l,j,o,n;if(m.constructor===Array){j=m;o=m;n=(j&&j.length)||0;if(p(m[0],m.length)){return false;}l=g.get(this.items,m);}else{if(typeof (m)==="object"){l=[m];n=1;j=this.itemIndex(l[0]);o=[j];if(p(j,1)){return false;}}else{j=m;o=[m];n=1;if(p(j,1)){return false;}l=[this.items[j]];}}for(var k=0;k<n;k++){if(o[k]<=r){r--;}}if(l[0]!=null){this.remove(j);this.add(l,r);}return true;},itemIndex:function F(j){if(j==null){return -1;}var k=this.itemIdField;return k?g.find(this.items,k,j[k]):g.indexOf(this.items,j);},prechange:function U(l){if(this.hasRendered){var k=[this.listBuilder,this.listMapper];for(var m=0,j=k.length;m<j;m++){var n=k[m];if(n&&n.onchange){n.onchange(this,this.itemsContainerNode,this.ctxtBuilder,l);}}}},makeObservable:false,_set_items:function J(p,j){var o=this.items;j=this.initItems(j);this.items=j;if(o!==j){var m=this,l=function(){if(m.autoHide){m.set("visible",!!(j&&j.length));}m=null;},k=this.hasRendered;if(k){this.refresh(l);}else{l();}}return o!==j;},premousedown:function e(j){A(this,"premousedown",j);},premouseup:function Q(j){A(this,"premouseup",j);},scrollTo:function W(k){var j,l=this.listMapper;if(l&&l.toItem){if(!isNaN(k)){j=k;}else{j=this.itemIndex(k);}if(j>=0){l.toItem(this,j);}}},draggable:false,getDragData:function(n){L(this,n.id);var l=O(this,n.src),k=l&&l.idxActual;if((k>-1)&&this.selectedIndices[k]){var m=this.sortSelectedIndices(),j=g.get(this.items,m)||[];switch(j.length){case 1:return b.copy({html:j[0][this.itemDisplayField],index:m[0]},b.copy(j[0]));case 0:return null;default:return b.copy({html:j.length+" selections",indices:m},j);}}},dropZone:false,ondragenter:function(j){L(this,j.id);this.set("dropCuePos",O(this,j.tgt));},ondragover:function(j){this.set("dropCuePos",O(this,j.tgt));},ondragleave:function(j){this.set("dropCuePos",null);},isDragValid:function C(j){return j&&j.src&&j.src.data;},ondragstart:function(j){if(!(j&&j.src&&j.src.data)){return false;}},allowCopy:false,ondragend:function(m){var k=m&&m.tgt,j=k&&k.widget;if(j===this){}else{if(this.tree&&j&&j.tree===this.tree){if(!this.allowCopy||!d.ctrlKey(k.hWin,k.e)){var l=m.src&&m.src.data;if(l&&(l.indices||(l.index!==null))){this.remove(l.indices||l.index);}}}}},ondrop:function(r){var v=r&&r.src,q=v&&v.data;if(q){var l=O(this,r.tgt,false),t=l&&l.idx,m=(q&&q.constructor===Array),k=this.sortSelectedIndices();var o=this.items;t=Math.min(t,o&&o.length)||0;var u=true;if(v.widget===this){u=this.move(k,t);g.forEach(k,function(s){if(s<=t){t--;}});}else{this.add(m?q:[q],t);}if(u){var p=m?q.length:1,j={};for(var n=0;n<p;n++){j[t+n]=true;}this.set("selectedIndices",j);}}this.set("dropCuePos",null);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.css","mstrmojo.string");function A(C,B){return mstrmojo.hash.copy(B,{label:"",tabIndex:"",cssDisplay:"inline",name:null,markupString:'<span id="{@id}" class="'+C+' {@cssClass}" style="{@cssText}" title="{@tooltip}"><input id="{@id}_input"  type="{@type}" name="{@name}" value="{@value}" tabIndex="{@tabIndex}" mstrAttach:click tstid="{@tstid}"/><label for="{@id}_input">{@label}</label></span>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";},onenabledChange:function(){this.inputNode.disabled=!this.enabled;mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,"disabled");},onlabelChange:function(){this.labelNode.innerHTML=mstrmojo.string.encodeHtmlString(this.label);},oncheckedChange:function(){this.inputNode.checked=this.checked;}},checked:false,preclick:function(){this.set("checked",this.inputNode.checked);},isChecked:function(){return this.inputNode.checked;}});}mstrmojo.CheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox",{scriptClass:"mstrmojo.CheckBox",type:"checkbox"}));mstrmojo.ImageCheckBox=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-CheckBox mstrmojo-ImageCheckBox",{scriptClass:"mstrmojo.CheckBox",type:"image",cssDisplay:"block",preclick:function(){this.set("checked",!this.checked);},postCreate:function(){this.markupMethods=mstrmojo.hash.copy(this.markupMethods);this.markupMethods.oncheckedChange=function(){mstrmojo.css.toggleClass(this.inputNode,["checked"],this.checked);};},postBuildRendering:function(){this.inputNode.src=this.src||"../images/1ptrans.gif";if(this._super){return this._super();}return true;}}));mstrmojo.RadioButton=mstrmojo.declare(mstrmojo.Widget,null,A("mstrmojo-RadioButton",{scriptClass:"mstrmojo.RadioButton",type:"radio",postBuildRendering:function(){if(mstrmojo.dom.isIE){this.inputNode.checked=this.checked;}}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var B="mstrmojo-Image";mstrmojo.Image=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Image",markupString:'<div id="{@id}" class="'+B+' {@cssClass}" style="{@cssText}" mstrAttach:click><image class="{@imgCssClass}" src="{@src}" mstrAttach:load /></div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onsrcChange:function(){var C=this.imgNode;if(C){C.src=this.src||"../javascript/mojo/css/images/1ptrans.gif";}},oncssClassChange:function(){var C=this.domNode;if(C){C.className=this.cssClass||B;}},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},src:"",getImageSize:function A(){var C=this.imgNode;return{w:C.clientWidth,h:C.clientHeight};}});mstrmojo.Image.baseCssClass=B;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.Widget","mstrmojo._ListSelections");var E=mstrmojo.dom;mstrmojo.ListBase=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBase",selectionPolicy:null,itemRenderer:null,icnCssText:"",icnCss:"",markupString:'<div id="{@id}" tstid="{@tstid}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div>',markupSlots:{itemsContainerNode:function G(){return this.domNode.firstChild;},scrollboxNode:function A(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},autoHide:false,itemsContainerNode:null,_markupPrefix:null,_markupSuffix:null,_itemPrefix:null,_itemSuffix:null,init:function J(K){this._super(K);if(this.autoHide){this.visible=!!(this.items&&this.items.length);}},buildRendering:function D(){this.itemsHtml="";var K=(this.renderOnScroll?this.items&&((this.renderIndex+1)*this.renderBlockSize):this.items&&this.items.length);if(K){this.itemsHtml=this._buildItemsMarkup(0,K-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}this._super();delete this.itemsHtml;this.addSlots({itemsNode:this.itemsContainerNode.firstChild});},_buildItemsMarkup:function B(K,N,V,L,W,M){var X=[],Q=0;X[Q++]=V||"";var P=this.itemRenderer,U=P&&P.render;if(U&&typeof U==="function"){var R=this.items,S=Math.min(N+1,((R&&R.length)||0)),O;for(O=K;O<S;O++){X[Q++]=W||"";X[Q++]=U(R[O],O,this);X[Q++]=M||"";}}X[Q+1]=L||"";return X;},onselectionChange:function H(X){if(!X){return ;}var S=this.itemRenderer;if(!S){return ;}var V=this.items;if(X.added&&X.added.length>0&&V.length>0&&!mstrmojo.array.some(X.added,function(a){return !V[a]||!V[a].dsbld;})){return ;}var O=S.unselect,R=this.items||[],Y=X.removed,N,M,L,P,Z;if(O&&Y){for(P=0,Z=Y.length;P<Z;P++){N=Y[P];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){O(L,R[N],M,this);}}}var K=S.select,W=X.added,Q,U;if(K&&W){for(Q=0,U=W.length;Q<U;Q++){N=W[Q];if(typeof (N)==="object"){M=(N.idx==0)?0:N.positions;N=N.idx;}else{M=N;}L=this._getItemNode(M);if(L){K(L,R[N],M,this);}}}if(this.onchange){this.onchange({added:X.added,removed:X.removed});}},_set_items:function C(N,K){this.renderIndex=0;if(this.autoHide){this.set("visible",!!(K&&K.length));}var M=this.items;this.items=K;if(M!==K){var L=this.hasRendered;if(L){this.unrender(false);}this.clearSelect();if(L){this.render();}return true;}return false;},onItemContextMenu:mstrmojo.emptyFn,oncontextmenu:function F(K){E.preventDefault(window,K.e);var M=K.getTarget(),L=this.getItemFromTarget&&this.getItemFromTarget(M);if(L){if(this.onItemContextMenu(L,K)){K.cancel();}}},_getItemNode:function I(K){var L=this.itemsContainerNode;return(L&&L.childNodes[K])||null;},renderOnScroll:false});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,G=mstrmojo.array;function F(H,J){var I={searchMetadata:{taskId:"searchMetadata",styleName:this.searchStyleName,rootFolderID:this.rootID,searchPattern:this.searchPattern+"*",nameWildcards:(this.qse?16:1),quickSearch:this.qse,sortKey:(this.qse?-1:6),blockBegin:this.blockBegin||1,blockCount:this.blockCount,recursive:1,folderBrowserStyle:0,includeAncestorInfo:"true",includeObjectDesc:this.includeObjectDesc,searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseFolder:{taskId:"searchMetadata",rootFolderID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,recursive:this.hierarchical?0:(this.searchXML?"":1),folderBrowserStyle:this.hierarchical?1:0,includeAncestorInfo:String(!!this.hierarchical),searchXML:this.searchXML||"",dataSourcesXML:this.dataSources||"",objectType:this.objectTypes},browseElements:{taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:this.rootID,blockBegin:this.blockBegin,blockCount:this.blockCount,filterXML:this.filterXML||"",searchPattern:this.searchPattern||"",matchCase:!!this.matchCase,dataSourcesXML:this.dataSourcesXML||"",includeFormNames:!!this.collectForms,includeFormValues:!!this.bIncludeFormValues,displayedForms:this.displayedForms||1,dimensionID:this.dimensionId||""}}[H]||{};if(typeof J==="object"){mstrmojo.hash.copy(J,I);}return I;}var B="##searchPattern";mstrmojo.SearchBox2=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.SearchBox2",taskId:"searchMetadata",rootID:null,searchStyleName:"MojoFolderStyle",objectTypes:"3,14,256,257,1024,1027,2048,3072,10",token:{searchMetadata:/\//,browseElements:/(^-)|(,)|( OR )|( AND)|([<>]=?)|(&)|( )|(["\[\]\/])/},blockCount:50,blockBegin:1,minSearchLength:2,matchCase:false,enableMatchCase:true,supportIncFetch:true,quickSearch:false,searchAfterSearchPatternRestored:false,includeObjectDesc:true,forceResetCache:false,onUpdateSearchParams:mstrmojo.emptyFn,markupString:'<table id={@id} cellspacing=0 cellpadding=0 class="mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" mstrAttach:keyup,blur /></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}sbSearch" mstrAttach:click ></div></div></td><td><div class="mstrmojo-SearchBox-options" style="{@cssTextShowMC}"><input id="{@id}sbMatchCase" type="checkbox" mstrAttach:click /><label for="{@id}sbMatchCase">'+mstrmojo.desc(4326,"Case Sensitive")+"</label></div></td></tr></table>",markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},searchNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},optionNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},preBuildRendering:function(){this.cssTextShowMC=this.enableMatchCase?"":"display: none";},postBuildRendering:function(){if(this._super){this._super();}this.matchCase=this.optionNode.checked;},onkeyup:function E(H){var J=this;var I=J.searchTimer;if(I){window.clearTimeout(I);}J.searchTimer=window.setTimeout(function(){J.onkeyupDelayed(H);delete J._searchTimer;},parseInt(H.e.keyCode||H.e.charCode,10)===13?0:J.searchDelay);},onkeyupDelayed:function A(I){var H=I.hWin,K=I.e||H.event;var J=mstrmojo.string.trim(this.inputNode.value);if(this.searchNode){C.toggleClass(this.searchNode,["clear"],J.length>0);}this.showTaskError=false;this.click2Search=false;if(J.length==0||this.autoSubmit||this.onEnter&&K.keyCode===13){this._onsearch();}},onEnter:function(){this._onsearch();},onclick:function(I){var H=I.hWin,K=I.e||H.event,M=K.target||K.srcElement,L=M&&M.id;switch(L.replace(this.id,"")){case"sbDown":if(this.enableMatchCase){var J=this.optionNode.parentNode.style;J.display=J.display=="block"?"none":"block";}break;case"sbSearch":if(this.inputNode.value.length>0){this.clearSearch();}break;case"sbMatchCase":this.set("matchCase",this.optionNode.checked);break;case"sbSpinner":break;}},clearSearch:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);var I=this.searchCache,H=this.rootID;if(I&&I[H]){I[H][B]="";}this._onsearch(true);},onmatchCaseChange:function(){this.matchCaseChanged=true;this._onsearch();},onrootIDChange:function(){this.rootChanged=true;this._setupCache(this.forceResetCache);var I=this.searchCache[this.rootID];if(I){var H=I[B]||"";this.inputNode.value=H;if(H.length>0){if(H.length>=this.minSearchLength&&this.searchAfterSearchPatternRestored){this._onsearch();}}}},getRootID:function(){},contentWidget:null,_notifyContentWidget:function(I){var H=this.contentWidget||this;H.set("items",I[0]);if(this.supportIncFetch){var J=I[1],L=I[2],K=this.blockCount;H.set("ifs",{np:Math.floor(J/K)+((J%K>0)?1:0),cp:Math.floor(L/K)+((L%K>0)?1:0)});}},_onsearch:function(H){this.getRootID();this._setupCache();var K=mstrmojo.string.trim(this.inputNode.value);if(K.length===0){H=true;}var L=this.token[this.taskId];if(L.test(K)){}if(this.searchPattern==K&&!this.rootChanged&&!this.matchCaseChanged&&!this.click2Search){return ;}var M=this.rootID,J=this.searchCache[M];if((K.length<this.minSearchLength&&!this.click2Search)&&!H){if(this.searchPattern&&this.searchPattern.length>=this.minSearchLength){this._notifyContentWidget(J[M]);this.searchPattern=K;}}else{this.searchPattern=K;J[B]=this.searchPattern;var I=this.filterCache(K,J,H);if((this.click2Search||I===null)&&!H){this.blockBegin=1;this.fetch();return ;}else{this._notifyContentWidget(I);}}J[B]=K;},_setupCache:function(J){var K=this.searchCache,I=this.rootID;if(K&&(J||!K[I])){K[I]=K[I]||{};var H=this.contentWidget&&this.contentWidget.items||this.rootCacheItems||[];K[I][I]=[H,this.totalSize||0,this.blockBegin||1].concat();}},taskCallId:0,path:mstrConfig.taskURL,method:"POST",serverRequest:function D(H,I){if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(H,I);}else{mstrmojo.xhr.request("POST",this.path,I,H,undefined,this.XServer,this.baseParams);}},fetch:function(){this.rootChanged=false;this.matchCaseChanged=false;if(this.spinnerNode){this.spinnerNode.style.display="block";}if(this.preFetch){this.preFetch();}var H=this,I=F.apply(this,[this.taskId]);I.searchPattern=this.searchPattern;this.onUpdateSearchParams(I);var J={success:function(K){var L=K.items||K.es||[];L=[L,K.totalSize||K.sz||0,K.blockBegin||K.bb];mstrmojo.all[H.id].searchCache[H.rootID][(I.searchPattern.length==0?H.rootID:H.buildIndex(I.searchPattern))]=L;H._notifyContentWidget(L);},failure:function(K){if(H.showTaskError){mstrmojo.alert(mstrmojo.desc(8117,"Data request failed:")+" \n"+K.getResponseHeader("X-MSTR-TaskFailureMsg"));}},complete:function(){if(H.spinnerNode){H.spinnerNode.style.display="none";}if(H.postFetch){H.postFetch();}}};this.serverRequest(I,J);},fetchPage:function(H){this.blockBegin=H*this.blockCount+1;this.fetch();},filterCache:function(J,M,I){var H=M&&M[I?this.rootID:this.buildIndex(J)];if(H){return H;}var K=this.token[this.taskId];if(K.test(J)||this.totalSize>this.blockCount){return null;}var O=J.replace(/.$/,"");H=M&&M[this.buildIndex(O)];while(H===undefined&&(O=O.replace(/.$/,"")).length>0){H=M&&M[this.buildIndex(O)];}if(H!==undefined){if(H[1]>this.blockCount){return null;}var L=H[0],N=[];G.forEach(L,function(P){if(P.n.search(new RegExp(J,this.matchCase?"":"i"))>-1){N.push(P);}});this.totalSize=N.length;return(M[this.buildIndex(J)]=[N,N.length,this.blockBegin].concat());}return null;},buildIndex:function(H){if(H.replace(/^\s|\s$/g,"").length===0){return"";}return !this.matchCase?H.toUpperCase():H+"::0";},init:function(H){if(this._super){this._super(H);}this.qse=mstrApp.useQuickSearch&&mstrApp.useQuickSearch()||0;this.autoSubmit=this.quickSearch&&(mstrApp.searchAutoComplete&&mstrApp.searchAutoComplete()||false);this.searchDelay=mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay()||0;this.xhr=new mstrmojo.SimpleXHR();this.searchCache=this.searchCache||{};},clear:function(){this.inputNode.value="";C.removeClass(this.searchNode,["clear"]);}});})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Widget");var B=mstrmojo.dom;mstrmojo.InlineEditBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.InlineEditBox",text:null,editMode:false,allowEdit:true,okSave:false,allowHighlight:false,emptyHint:"Enter your text here.",markupString:'<div id="{@id}" class="mstrmojo-InlineEditBox {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-InlineEditBox-text"></div><div class="mstrmojo-InlineEditBox-edit"><input type="text" class="mstrmojo-InlineEditBox-input" mstrAttach:keyup/><img class="mstrmojo-InlineEditBox-ok" src="../images/1ptrans.gif" title="Save"/><img class="mstrmojo-InlineEditBox-cancel" src="../images/1ptrans.gif" title="Cancel"/></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.lastChild;},inputNode:function(){return this.domNode.lastChild.firstChild;},okNode:function(){return this.domNode.lastChild.childNodes[1];},cancelNode:function(){return this.domNode.lastChild.lastChild;}},markupMethods:{ontextChange:function(){var C=this.text||this.emptyHint||"";this.textNode.innerHTML=this.allowHighlight?C:mstrmojo.string.encodeHtmlString(C);},oneditModeChange:function(){var H=this.editMode,E=this.domNode,D=this.textNode,G=this.editNode;mstrmojo.css.toggleClass(E,["edit"],H);if(H){D.style.display="none";G.style.display="block";D=this.inputNode;var F=D.style;D.value=this.text||"";F.width=(E.clientWidth-(this.okSave?(this.okNode.offsetWidth+this.cancelNode.offsetWidth):0))+"px";F.height=E.clientHeight+"px";D.focus();if(D.createTextRange){var I=D.createTextRange(),C=D.value.length;I.move("character",C);I.select();}}else{D.style.display="block";G.style.display="none";}},onokSaveChange:function(){var C=this.okSave?"inline":"none";this.okNode.style.display=C;this.cancelNode.style.display=C;},onallowEditChange:function(){mstrmojo.css.toggleClass(this.domNode,["disable"],!this.allowEdit);}},onvisibleChange:function A(){if(this.domNode){this.domNode.style.display=(this.visible?"block":"none");}},preclick:function(C){var E=C.e,D=B.eventTarget(C.hWin,E);if(D===this.okNode){this.save();}else{if(D===this.cancelNode){this.cancel();}else{if(this.editMode!==this.allowEdit){this.set("editMode",this.allowEdit);}}}},prekeyup:function(C){var E=C.e,D=E.keyCode||E.charCode;if(D===mstrmojo.Enum_Keys.ENTER){this.save();}else{if(D===mstrmojo.Enum_Keys.ESCAPE){this.cancel();}}},_attachEvents:function(){var C=this;if(this.editMode){if(!this._save_handler){this._save_handler=function(){var D=B.eventTarget(self,arguments[0]);if(!B.contains(C.domNode,D,true,document.body)){C.save();}};}B.attachEvent(document.body,"mousedown",this._save_handler);}else{if(this._save_handler){B.detachEvent(document.body,"mousedown",this._save_handler);}}},postBuildRendering:function(){if(this._super){this._super();}this._em_sub=this.attachEventListener("editModeChange",this.id,"_attachEvents");},destroy:function(){this.detachEventListener(this._em_sub);if(this._super){this._super();}},save:function(){this.set("text",this.inputNode.value);this.set("editMode",false);if(this.onSave){this.onSave();}},cancel:function(){this.set("editMode",false);if(this.onCancel){this.onCancel();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo.string","mstrmojo.dom");var C=mstrmojo.css,A=mstrmojo.dom,F=mstrmojo.string,E=function(H){this._super&&this._super(H);A.stopPropogation(H.hWin,H.e);},G=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.DynamicNode=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.fe.DynamicNode",markupString:'<div id="{@id}" class="mstrmojo-dynamic {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-dynamic-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-dynamic-prefix-text"  mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">'+G+'<span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-onhoverparent mstrmojo-dynamicNode" title="'+mstrmojo.desc(13229,"Add this condition to the target list of a selector.")+'"><span class="mstrmojo-dynamicNode-info"><span class="mstrmojo-textset"></span></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" ></img></span><span class="mstrmojo-textset mstrmojo-rename-text" mstrAttach:click >'+mstrmojo.desc(1388,"Rename")+"</span>"+G+"</div></div>",markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},dynamicNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.lastChild.firstChild.lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},createSetNode:function(){return this.domNode.lastChild.lastChild;},renameNode:function(){return this.domNode.lastChild.childNodes[2];}},markupMethods:{onprefixedAndOrEditableChange:function(){C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){C.toggleClass(this.dynamicNode,["selected"],this.selected);},onisEditingChange:function(){C.toggleClass(this.domNode,["renaming"],this.isEditing);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=this.data.ph.n;},onglowChange:function(){var H=this;C.toggleClass(H.dynamicNode,["glow"],this.glow);if(this.glow){setTimeout(function(){C.toggleClass(H.dynamicNode,["glow"],false);H.glow=false;},1000);}},onnoRelationOperatorChange:function(){C.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){C.toggleClass(this.dynamicNode,["noRelation"],this.noRelation);}},editableSlot:"textNode",editButtonSlot:"renameNode",init:function(H){var J=H.data;if(J){var I=H.tree.nameFactory;if(J.ph.n){I.setName(J.ph.n,this);}else{J.ph.n=I.getNewName(this,mstrmojo.desc(12033,"Dynamic Condition")+" ");}}this._super(H);},_set_data:function(K,H){var I=this.data,J=(I!==H);if(J){this.data=H;this.text=H.ph.n;}return J;},preclick:function D(H){var J=null,I=A.eventTarget(H.hWin,H.e);if(A.contains(this.prefixNode,I,true)){J="andor";}else{if(A.contains(this.createSetOptNode,I,true)&&!this.noRelationOperator&&!this.noRelation){J="createSetOpt";}else{if(A.contains(this.createSetNode,I,true)&&!this.noRelation){J="createSet";}else{if(A.contains(this.renameNode,I,true)){this.set("isEditing",true);}}}}H.part=J;},isEmpty:function(){var I=this.data,H=I&&I.ph;return !(H&&H.n);},del:function B(){var I=this.parent,H=this.tree.nameFactory;if(I&&I.remove&&this.data){I.remove(this.data);H.removeName(this.data.ph.n);}},onkeyup:E,onkeydown:E,onTextEditComplete:function(){var J=this.tree,K=J.nameFactory,H=F.trim(this.text||""),I=this.data.ph.n;if(H&&H!==I){if(K.isNameExist(H)){K.names[H].set("glow",true);this.set("isEditing",true);}else{K.changeName(I,H,this);this.data.ph.n=H;}}},isSelectableArea:function(H){return mstrmojo.dom.contains(this.dynamicNode,H,true);},avatarCssCls:"mstrmojo-FE mstrmojo-dynamicNode",getAvatarNode:function(){return this.dynamicNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string");var B=mstrmojo.string;mstrmojo.Label=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Label",allowHTML:false,text:"",title:"",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click></div>',markupMethods:{ontitleChange:function(){this.domNode.title=this.title;},ontextChange:function(){var C=this.text;C=B.isEmpty(C)?"":C.toString();this.domNode.innerHTML=this.allowHTML?C:B.encodeHtmlString(B.decodeHtmlString(C),true);},oncssTextChange:mstrmojo.Widget.cssTextMarkupMethod,onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod},autoHide:false,_set_text:function A(E,C){if(this.autoHide){this.set("visible",(C!==null)&&(C!=="")&&(C!==undefined));}var D=this.text;this.text=C;return(D!==C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash");function A(H,E,G,F){var D=mstrmojo.hash.copy(F,{props:{left:{isStyle:true,start:H,stop:E,suffix:"px",ease:mstrmojo.ease.linear}},duration:G});(new mstrmojo.fx.AnimateProp(D)).play();}function B(K,N,G,L){var I=K.domNode,M=I.offsetWidth,D=K.scrollableIncFetch;var E=K.hasAnimation&&(!(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent))||Number(RegExp.$1)>3.5),J=L?1:-1,F=parseInt(M,10)*J,H=E?500:0;A(0,-F,H,{target:G,duration:H,preStart:function(){this.target.style.overflowY="hidden";},onEnd:function(){this.target.style.display="none";}});A(F,0,H,{target:N,preStart:function(){this.target.style.display="block";this.target.style.overflowY=(D?"visible":"auto");}});if(K.waiting){A(0,-F,H,{widget:K,slot:"loaderNode",onEnd:function(){this.widget.waiting=false;}});}}var C=function(D){var E=D.currentPage;if(E===D.p1Node){E=D.p2Node;}else{E=D.p1Node;}D.currentPage=E;};mstrmojo.Booklet=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.Booklet",pageClass:"mstrmojo-BookletPage",markupString:'<div id="{@id}" class="mstrmojo-Booklet {@cssClass}" style="{@cssText}"><div id="{@id}_p1" class="mstrmojo-BookletPage" ></div><div id="{@id}_p2" class="mstrmojo-BookletPage" style="left:-100%;"></div><div id="{@id}_ldr" class="mstrmojo-BookletLoader" ></div></div>',markupSlots:{containerNode:function(){return this.domNode;},p1Node:function(){return this.domNode.firstChild;},p2Node:function(){return this.domNode.childNodes[1];},loaderNode:function(){return this.domNode.childNodes[2];}},markupMethods:{onnextChange:function(){var G=this.next;if(!G){return ;}var D=this.currentPage,F=this.p1Node,E=this.currentPage=(D==F)?this.p2Node:F;if(!(G instanceof mstrmojo.Obj)){G=this.next=mstrmojo.insert(G);}if(!G.hasRendered){G.placeholder=E.appendChild(document.createElement("span"));G.render();}else{if(E.firstChild){E.replaceChild(G.domNode,E.firstChild);}else{E.appendChild(G.domNode);}}this.set("waiting",false);if(E&&D){B(this,E,D,this.turnDirFwd);}else{if(this.scrollableIncFetch){E.style.overflowY="visible";}}},onwaitingChange:function(D){this.loaderNode.style.left=(this.waiting)?0:"-100%";},onheightChange:function(D){if(this.height){this.domNode.style.height=this.height;}},onwidthChange:function(D){if(this.width){this.domNode.style.width=this.width;}}},enabled:true,waiting:false,next:null,currentPage:null,turnDirFwd:true,hasAnimation:true,scrollableIncFetch:false,FORWARD:true,REVERSE:false,turnFwd:function(D){this.turn(D,this.FORWARD);},turnBack:function(D){this.turn(D,this.REVERSE);},turn:function(D,E){this.set("turnDirFwd",E);this.set("next",D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget");mstrmojo.WaitIcon=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.WaitIcon",cssFloat:"left",visible:false,markupString:'<div id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="float:{@cssFloat};{@cssText};"></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},markupSlots:{}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.array","mstrmojo._HasChildren");var G=mstrmojo.array;function E(P){if(!this.shouldPropagateEnabled){return ;}var O=this._disabledChildren;G.forEach(P,function(Q){if(Q.enabled){O.push(Q.id);Q.set("enabled",false);}});}function J(){G.forEach(this._disabledChildren,function(O){var P=mstrmojo.all[O];if(P&&P.parent===this){P.set("enabled",true);}},this);this._disabledChildren=[];}mstrmojo.Container=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.Container",defaultChildSlot:"containerNode",containerNode:null,preserveChildDomOrder:true,shouldPropagateEnabled:false,init:function M(P){this._super(P);this._disabledChildren=[];this.attachEventListener("addChild",this.id,function(Q){if(this.shouldPropagateEnabled&&!this.enabled){E.call(this,Q.value);}});if(this.children){this.initChildren();}var O=this.parent;if(!O||O.hasInitBindings){this.initBindings();}},destroy:function H(O){if(this.children){this.destroyChildren(true);}if(this.bindings){this.destroyBindings();}this._super(O);},unrender:function I(Q){var R=this.children,O=(R&&R.length)||0,P;for(P=O-1;P>-1;P--){R[P].unrender(true);}this._super(Q);},postBuildRendering:function A(){if(this._super()!==false){this.renderChildren();return true;}return false;},renderChildren:function L(){var Q=this.children,O=(Q&&Q.length)||0,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}}},childRenderCheck:function D(P){if(P&&!P.hasRendered){var O=P.slot||this.defaultChildSlot;return !!this[O];}return false;},addChildren:function N(R,P,Q){var O=this._super(R,P,Q);if(O){this.childRenderOnAddCheck(O);}return O;},removeChildren:function F(W,R){var V=W?[W]:(this.children||[]),O=V.length,S;for(S=O-1;S>-1;S--){var Q=V[S],P=Q&&Q.domNode;if(P){var U=this[(Q.slot||this.defaultChildSlot)];if(P.parentNode===U){U.removeChild(P);}}}return this._super(W,R);},childRenderOnAddCheck:function B(Q){if(this.hasRendered&&Q){var O=Q.length,P;for(P=0;P<O;P++){var R=Q[P];if(this.childRenderCheck(R)){R.render();}else{if(R&&R.hasRendered){this.onchildRenderingChange(R);}}}}},onchildRenderingChange:function K(O){var X=O&&O.domNode;if(!X){return ;}var P=this.defaultChildSlot,W=O.slot||P,Z=this[W],Q=this.children;if(!Z){if(X.parentNode){X.parentNode.removeChild(X);}}else{if(X.parentNode===Z){return ;}if(!this.preserveChildDomOrder){Z.appendChild(X);}else{var R,V;for(V=Q.length-1;V>=0;V--){var Y=Q[V];if(Y===O){break;}if(W===(Y.slot||P)){var a=Y.domNode;if(a&&a.parentNode===Z){R=a;}}}if(R){Z.insertBefore(X,R);}else{Z.appendChild(X);}}}if(mstrmojo.publisher.hasSubs(this.id,"childrenRendered")){var S=Q.length,U;for(U=0;U<S;U++){if(!Q[U].domNode){return ;}}this.raiseEvent({name:"childrenRendered"});}},propagateChildProps:function C(S){var R=this[S],Q=this.children||[],O=Q.length,P;for(P=0;P<O;P++){Q[P].set(S,R);}}});mstrmojo.Container.enabledMarkupMethod=function(){mstrmojo.Widget.enabledMarkupMethod.apply(this,arguments);if(this.shouldPropagateEnabled){if(this.enabled){J.call(this);}else{E.call(this,this.children);}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._Formattable");mstrmojo.DocHTMLContainer=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocHTMLContainer",scrolling:"auto",markupString:'<iframe id="{@id}" k="{@k}" class="mstrmojo-DocHTMLContainer" title="{@tooltip}" style="{@domNodeCssText}" src="{@v}" scrolling="{@scrolling}"></iframe>',formatHandlers:{domNode:["RW","B","F","background-color","text-align","white-space","fx"]},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},update:function A(B){this.v=B.data.v;if(mstrApp&&mstrApp.isTouchApp()){this.scrolling="no";}if(this.thresholdId||B.data.tid){delete this.fmts;}this.thresholdId=B.data.tid;this.set("visible",!B.data.hidden);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css");var C=mstrmojo.Widget;mstrmojo.ui.Checkbox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ui.Checkbox",markupString:'<div id="{@id}" class="mstrmojo-ui-Checkbox {@cssClass}" mstrAttach:click></div>',markupMethods:{onvisibleChange:C.visibleMarkupMethod,oncheckedChange:function B(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},onenabledChange:C.enabledMarkupMethod},checked:false,onclick:function A(){this.set("checked",!this.checked);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.css","mstrmojo.string");function C(H,D,E){var K=[];var G=H.optionRenderer,I=G&&G.render;if(I&&typeof I==="function"){var L=H.options,J=Math.min(E,((L&&L.length)||0)),F;for(F=D;F<J;F++){K.push(I(L[F],F,H));}}return K.join("");}mstrmojo.DropDownList=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.DropDownList",title:"",selectCssClass:"",tooltip:"",cssDisplay:"inline",value:"",unset:false,options:null,optionValueField:"v",optionNameField:"n",idx:-1,renderedOptions:"",markupString:'<span id="{@id}"  class="mstrmojo-DropDownList {@cssClass}">{@en@title}<select id="{@id}_select" class="mstrmojo-DropDownList-select {@selectCssClass}"  style="{@cssText}" title="{@tooltip}"onchange="mstrmojo.all[\'{@id}\'].set(\'selected\', this.options[this.selectedIndex].value);">{@renderedOptions}</select><div class = "strikeoutContainer"></div></span>',markupSlots:{selectNode:function(){return this.domNode.getElementsByTagName("select")[0];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onidxChange:function(){var D=this.domNode.getElementsByTagName("select");if(D&&D.length){D[0].selectedIndex=this.idx;}},onvalueChange:function(){var I=this.selectNode,G=I.options,F=this.value,E,H;for(H=0;H<G.length;H++){var D=G[H].value.toString()===F;if(D){E=H;if(F!==""){mstrmojo.css.toggleClass(G[H],"selected",D);}break;}}if(I.length>0&&E>0&&this.unset){if(this.options[0].v==="-1"){I.remove(0);E--;}this.unset=false;}this.set("idx",E);},onwidthChange:function(){var D=this.width;if(D>=0){this.selectNode.style.width=D+"px";}}},_set_selected:function(G,D){var E=this.selectNode,F=this[G]!==D;this[G]=D;if(E){this.set("value",D);}return F;},preBuildRendering:function A(){var F=this;if(F.unset){F.idx=0;}var E=F.options,D=(E&&E.length)||0;if(D){F.renderedOptions=C(F,0,D);}return this._super();},optionRenderer:{render:function(E,D,F){return mstrmojo.string.apply(F.getOptionMarkup(E),F.getOptionProps(E,D));}},getOptionMarkup:function(D){return'<option value="{@en@v}" class="{@cls}" style="{@style}" {@sel}>{@en@n}</option>';},getOptionProps:function B(F,D){var G=this,H=F[G.optionValueField],E=D===parseInt(G.idx,10);G.selected=G.value=E?H.toString():G.value;return{cls:E?"selected":"",v:H===undefined?"":H,n:F[G.optionNameField]||"",style:"",sel:E?"selected":""};}});}());mstrmojo.ToolSeparator=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ToolSeparator",markupString:'<div class="mstrmojo-ToolSeparator {@cssClass}" style="{@cssText}"></div>',markupSlots:{},markupMethods:{}});(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.color","mstrmojo.dom");var L=mstrmojo.color,H=mstrmojo.dom;var I=68.5,M=77.5,D=83;function B(O,N){return{x:O.clientX-N.x-M,y:O.clientY-N.y-M};}function K(){var N=this._hsl[1],P=this._hsl[2];var O=this.slHandleNode.style;O.left=Math.round(D*(0.5-N)+M)+"px";O.top=Math.round(D*(0.5-P)+M)+"px";}function F(){var N=this._hsl[0],P=N*2*Math.PI;var O=this.hueHandleNode.style;O.left=Math.round(Math.sin(P)*I+M)+"px";O.top=Math.round(-Math.cos(P)*I+M)+"px";this.slNode.style.backgroundColor=L.hsl2hex(N,1,0.5);}function C(){this._hsl=L.hex2hsl(this.color);if(this.slHandleNode&&this.hueHandleNode){K.call(this);F.call(this);}}mstrmojo.ui.editors.controls.ColorWheel=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ui.editors.controls.ColorWheel",markupString:'<div id="{@id}" class="mstrmojo-ui-ColorWheel {@cssClass}" style="{@cssText}" mstrAttach:mousedown><div class="cwHue"></div><div class="cwColorField"></div><div class="cwHandle"><div></div></div><div class="cwHandle"><div></div></div></div>',markupSlots:{slNode:function(){return this.domNode.childNodes[1];},hueHandleNode:function(){return this.domNode.childNodes[2];},slHandleNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},slNode:null,hueHandleNode:null,slHandleNode:null,color:"#ffffff",onColorPicked:function G(N){},postBuildRendering:function A(){C.call(this);},oncolorChange:function J(){C.call(this);},onmousedown:function E(Q){var S=this,N=H.position(this.domNode),U=this._hsl,P=Q.e,R=B(P,N),V=Math.max(Math.abs(R.x),Math.abs(R.y))*2>D,O=function(Y){var b=B(Y,N),X=U[0],Z=U[1],a=U[2];if(V){X=Math.atan2(b.x,-b.y)/(2*Math.PI);if(X<0){X+=1;}S._hsl=[X,Z,a];F.call(S);}else{Z=Math.max(0,Math.min(1,-(b.x/D)+0.5));a=Math.max(0,Math.min(1,-(b.y/D)+0.5));S._hsl=[X,Z,a];K.call(S);}var W=L.hsl2hex(X,Z,a);S.color=W;S.onColorPicked(W);H.stopPropogation(window,Y);return false;};H.attachMouseMoveEvents(O);O(P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget");var C=mstrmojo.css,A="selected";mstrmojo.ButtonSwitch=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ButtonSwitch",markupString:'<div id="{@id}" class="mstrmojo-ButtonSwitch {@cssClass}" style="{@cssText}" mstrAttach:click><div class="left selected" > {@label1} </div><div class="right"> {@label2} </div></div>',markupSlots:{left:function(){return this.domNode.children[0];},right:function(){return this.domNode.children[1];}},switchFn:mstrmojo.emptyFn,onselectedChange:function(){var D;for(D=0;D<2;D++){C.toggleClass(this.domNode.children[D],A,this.selected===D);}this.switchFn();},onclick:function B(D){this.set("selected",(D.getTarget()===this.left)?0:1);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.boxmodel","mstrmojo.Widget");var Y=mstrmojo.hash,g=mstrmojo.css,L=mstrmojo.dom,d="animate",P="px";function b(h){return Y.copy(((!!mstrApp.isWSStyling)?Y.walk(h,window).boxConfigurationWS:undefined)||Y.walk(h,window).boxConfiguration||mstrmojo.vi.ui._IsBoxLayoutChild.boxConfiguration);}function H(k){var j=k.boxCache,l=j&&j[this.id],h=false;if(!l){h=this.domNode.className.indexOf(d)>-1;this.cacheCtxtBoxPosition(k);}k.boxAnimating=h;}mstrmojo.vi.ui._IsBoxLayoutChild=mstrmojo.provide("mstrmojo.vi.ui._IsBoxLayoutChild",{_mixinName:"mstrmojo.vi.ui._IsBoxLayoutChild",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,ontopChange:mstrmojo.Widget.topMarkupMethod,onleftChange:mstrmojo.Widget.leftMarkupMethod,onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex||1;}},id:null,left:"0px",top:"0px",zIndex:1,draggable:false,dropZone:false,getBoxConfiguration:function C(){return b(this.scriptClass);},getBoxBorderWidth:function I(){return 0;},getMinBoxSize:function A(h){return mstrmojo.vi.ui._IsBoxLayoutChild.getBoxMinimums(this.scriptClass)[h];},getIdentifier:function Q(){return this.id;},updateLayout:function O(k,h){if(Y.equals(k,this._currentLayout)){return ;}var j=this.domNode,m=window.Modernizr,l=this.getBoxBorderWidth();if(j&&h&&m.testProp("transition")){g.addClass(j,d);g.onTransitionEnd(j,function(){g.removeClass(j,d);});}this._currentLayout=k;this.applyBoxSize(Math.max((parseInt(k.height,10)-l),0)+P,Math.max((parseInt(k.width,10)-l),0)+P,k.top,k.left);if(this.hasRendered&&this.doLayout){this.doLayout();}this.postUpdateLayout();},postUpdateLayout:function D(){},applyBoxSize:function Z(h,l,n,m){this.height=h;this.width=l;this.top=n;this.left=m;var k=this.domNode;if(k){var j=this.domNode.style;j.top=n;j.left=m;j.height=h;j.width=l;if(parseInt(h,10)<=0||parseInt(l,10)<=0){j.borderWidth="0";}}},createAvatar:function W(){return this.offsetAvatar(this.domNode);},offsetAvatar:function S(h){h.style.margin="20px 0 0 20px";return h;},setMaskVisibility:function U(h){var j=this.maskNode.style;j.display=h?"block":"none";if(!h){this.resetMask();}},isDragValid:function F(h){return true;},initializeDrag:function G(h){},ondragstart:function f(h){this.initializeDrag(h);delete this._currentLayout;this.parent.beginBoxMove(h,this);this._super(h);},ondragend:function N(h){this._super(h);this.parent.endBoxMove(h,this);if(!h.dropSuccessful){this.parent.cancelBoxMove(h);}var j=this.domNode;j.style.margin="0";},allowDrop:function K(h){var k=h.src,j=k&&k.widget;return(j&&j.parent===this.parent);},wasDropped:function M(h){},cancelBoxMove:function J(h){return false;},ondragenter:function V(h){this.setMaskVisibility(true);},ondragover:function X(h){H.call(this,h);this.highlightMask(this.parent.getPanelTargetEdge(h)||this.getTargetDropZone(h),h);if(h.boxAnimating){delete h.boxCache[this.id];}},cacheCtxtBoxPosition:function E(j){var h=j.boxCache=j.boxCache||{};h[this.id]=L.position(this.domNode);},ondrop:function c(h){H.call(this,h);var k=h.src.widget;if(k.wasDropped){k.wasDropped(h);}var j=this.parent;if(k.parent===j){j.dropBox(h,this,this.maskNode.zone,true);}this.setMaskVisibility(false);},ondragleave:function B(){this.setMaskVisibility(false);},highlightMask:function e(l,k){var h=this.maskNode,j=k.boxAnimating;if(l!==h.zone||j||h.isAnimating!==j){h.zone=l;h.isAnimating=j;this.parent.updateDropCue(l,k,k.boxCache[this.id]);}},getTargetDropZone:function R(h){return mstrmojo.boxmodel.getEdgeQuadrantByPoint(h.boxCache[this.id],h.tgt.pos);},resetMask:function a(){this.parent.updateDropCue("");var h=this.maskNode;delete h.zone;delete h.isAnimating;},getBoxDimension:mstrmojo.emptyFn,postDropBox:mstrmojo.emptyFn});mstrmojo.vi.ui._IsBoxLayoutChild.boxConfiguration={addToEnd:true};mstrmojo.vi.ui._IsBoxLayoutChild.getBoxMinimums=function(h){var j=b(h);return Y.copy(j.minSize||j.f||{h:75,v:75});};mstrmojo.vi.ui._IsBoxLayoutChild.BoxConfigurationType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");var C=1;mstrmojo._hasWidgetListMapper={buildItemWrappers:function A(H,G,F,E,J,I){E.first=J;E.last=I;return this._super(H,G,F,E,0,0);},postBuildRendering:function B(K,I,H,G,F){var J=F.first;if(J){this.fillItemWrappers(K,I,H,G,F,0,J);}if(F.last){var E=I&&I.length||0,L=Math.max(Math.max(0,E-F.last),J);this.fillItemWrappers(K,I,H,G,F,L,E);}if(this._super){this._super(K,I,H,G,F);}},fillItemWrappers:function D(F,N,K,R,M,E,I,Q){var L=(N&&N.length)||0,P=this.wrapperNodes(F),S=M.itemStatus;for(var J=E,O=Math.min(I+1,L),H=0;J<O;J++){if(S[J]!==C){var G=K.build(R,M,N[J],J);if(G){G.placeholder=P[J].firstChild;G.render();}H++;if(H===Q){break;}}}return H;},onchange:null};mstrmojo.WidgetListMapper=mstrmojo.provide("mstrmojo.WidgetListMapper",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.WidgetListMapper.RENDERED=C;mstrmojo.requiresCls("mstrmojo.ListMapperHoriz");mstrmojo.WidgetListMapperHoriz=mstrmojo.provide("mstrmojo.WidgetListMapperHoriz",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperHoriz)));})();(function(){mstrmojo.requiresCls("mstrmojo.desc","mstrmojo.dom","mstrmojo.MetricSelectorUtility","mstrmojo.num","mstrmojo.css","mstrmojo.vi.ui.rw.selectors.ISliderHelper");var C=mstrmojo.MetricSelectorUtility,H=C.OP,A=C.FN,J=C.Q,D=mstrmojo.num,E=mstrmojo.css,F=Math.min,I=Math.max;mstrmojo.vi.ui.rw.selectors.MetricRankSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.ISliderHelper,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.MetricRankSliderHelper",_children:[{scriptClass:"mstrmojo.ui.Pulldown",slot:"controlNode",alias:"rankon",isHostedWithin:false,items:C.RANK_OP_NAMES,onitemSelected:function(){this.parent.set("qua",this.getSelectedItem().v);}},{scriptClass:"mstrmojo.Label",slot:"controlNode",alias:"summary"}],init:function(K){this._super(K);this.slider.set("multiSelect",false);this.slider.rankon.set("useDarkTheme",!this.slider.docSelector.isInFilterPanel()&&mstrApp.getRootController().isDarkThemeSelected());},updateOpCs:function B(){var M=this.slider,L=parseInt(M.qua,10),K=M.include,N=I(M.cs1Vl,M.cs2Vl),O=(L===J._PT||L===J._PB);if(N===M.high){M.unSet=true;M.cs=[];return ;}M.opId=K?H._LESS_EQUAL:H._GREATER;M.cs=[{dtp:5,v:D.toLocaleString(N)+(O?"%":"")}];},updateSummary:function G(){var L=this.slider,O=C.getFuncInfo(L.opId,L.qua).f,N=C.MRPFN,K="",M=L.cs1Vl<L.cs2Vl?L.cs2Nm:L.cs1Nm;if(L.unSet){K=mstrmojo.desc(2058,"All");}else{switch(O){case N.TOP:case N.BOTTOM:case N.BETWEENDESCENDING:K=String.fromCharCode(8804)+" "+M;break;case N.EXCLUDETOP:case N.EXCLUDEBOTTOM:case N.NOTBETWEENDESCENDING:K="> "+M;break;default:K=String.fromCharCode(8804)+" "+M;break;}}L.summary.set("text",K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.vi.enums.EnumDerivedElementType","mstrmojo.mstr.EnumFunction","mstrmojo.func","mstrmojo.DocDataService","mstrmojo.warehouse.EnumDatabaseType");var M=mstrmojo.array.forEach,D=mstrmojo.hash.forEach,G=mstrmojo.hash.copy,O=mstrmojo.vi.enums.EnumDerivedElementType,W=mstrmojo.mstr.EnumFunction,B=mstrmojo.string,Z=mstrmojo.func.wrapMethods,J=mstrmojo.DocDataService,I={};function C(c){var a=function(e){var d=[];M(e,function(f){d.push(B.encodeHtmlString(f.n)||mstrmojo.desc(14561,"(null)"));});return d.join(", ");};switch(c.t){case O.RESIDUE:return"";case O.LIST:return a(c.es);case O.CALCULATION:var b;if(c.func===W.FunctionApplySimple){b=c.es[0].v;}else{b=a(c.es);}return I[c.func]+'("'+b+'")';default:return"";}}function P(a,b){return{act:"remove",eId:b.id};}function U(b,c,a){return{act:"update",position:a+1,item:c};}function Y(b,c,a){return{act:"add",position:a+1,item:c};}I[W.FunctionAbs]="ABS";I[W.FunctionAdd]="ADD";I[W.FunctionAverage]="AVG";I[W.FunctionLeast]="MIN";I[W.FunctionGreatest]="MAX";I[W.FunctionMinus]="SUB";I[W.FunctionDivide]="DIV";I[W.FunctionApplySimple]="ApplySimple";mstrmojo.vi.models.DEConsolidation=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.DEConsolidation",items:null,isNameChanged:false,deleted:null,xtab:null,controller:null,othersDE:null,init:function V(a){this._super(a);this.items=[];this.deleted=[];this.isNameChanged=this.isNew=!(a.deObj);this.otherDE=null;this.populate();},populate:function H(){var a=this.deObj,c=this,b;if(!a){return ;}c.n=a.n;c.t=a.t;c.dsId=a.dsId;c.attId=a.attId;c.deId=a.did;M(a.des,function(e,d){if(e.ido){return false;}b=new mstrmojo.vi.models.DEConsolidationElem();b.populate(e,d);c.items.push(b);if(b.t===O.RESIDUE){c.othersDE=b;}});},addDE:function R(a,c){var b=new mstrmojo.vi.models.DEConsolidationElem();b.isNew=true;b.es=c;b.n=a;b.t=O.LIST;b.prev=C(b);this.items.splice(0,0,b);if(this.items.length===1){b=new mstrmojo.vi.models.DEConsolidationElem();b.isNew=true;b.t=O.RESIDUE;b.n=mstrmojo.desc(13655,"All Other Elements");if(this.othersConfig){D(this.othersConfig,function(d,e){b[e]=d;});delete this.othersConfig;}else{b.showChildren=true;}this.othersDE=b;this.items.splice(1,0,b);}return b;},updateDE:function A(a,d,f,b,c){var e=this.items[a];e.isDirty=true;e.n=d;e.es=f;e.prev=C(e);if(this.isRaCalculation(e)){if(b){e.pe=b;}if(c){c.isDirty=true;e.mptf=c;}}return e;},editOthers:function F(a){var b=this.othersDE;if(b){D(a,function(c,d){if(b[d]!==c){b[d]=c;b.isDirty=true;}});}else{this.othersConfig=a;}},isDirty:function L(){var b=this.items,a=this.deleted||[],c=this.deObj&&this.deObj.des||[];return(this.isNameChanged||a.length>0||b.length!==c.length||mstrmojo.array.filter(b,function(d){return d.isNew||d.isDirty;}).length>0||mstrmojo.array.filter(b,function(d){return d.n===(c[d._renderIdx]&&c[d._renderIdx].n);}).length!==b.length);},isRaCalculation:function S(a){return a.t===O.CALCULATION&&this.isRA;},isEssbaseSource:function N(){var a=this.dsId,b=this.attId,d=this.docModel&&this.docModel.datasets,e,c;if(!a&&b){mstrmojo.hash.forEach(d,function(g,f){mstrmojo.array.some(g.att,function(j,h){if(j.did===b){a=j.datasetId;return true;}});if(a){return false;}});}e=d&&d[a];c=e&&e.tables;return c&&c.length>=0&&c[0].dbt===mstrmojo.warehouse.EnumDatabaseType.EssBase;},save:function X(){if(!this.isDirty()){return ;}var f=this,b=[],d=function(m){m.prev=B.decodeHtmlString(m.prev);if(!m.isNew){b.push(P(f,m));M(f.items,function(n){if(!n.isNew&&n.origPos>m.origPos){n.origPos--;}});}},g=function(p,m,o){var n=m.getSourceFilterKeys(p.zonesModel.getHost().k);mstrmojo.array.forEach(p.parent.parent.children,function(s){var q=s.boxContent.gridInfo;if(q){var t=(q.rows.concat(q.cols)).some(function(u){return u.did===o.did;}),r=n.some(function(u){return u===s.k;});if(t&&!r){n.push(s.k);}}});return n;},a=function(n,m){n.prev=B.decodeHtmlString(n.prev);if(n.isNew){b.push(Y(f,n,m));M(f.items,function(o){if(!o.isNew&&o.origPos>=m){o.origPos++;}});}else{if(n.isDirty||n.origPos>m){b.push(U(f,n,m));}if(n.origPos>m){M(f.items,function(o){if(!o.isNew&&o.origPos>=m&&o.origPos<n.origPos){o.origPos++;}});}}};M(this.deleted,d);M(this.items,a);var c=this.controller,k=this.xtab,l=this.docModel,j=k?c._getXtabCallback(k):(this.fromDS?c.getPartialUpdateCallback():mstrmojo.emptyFn),e={act:"applyDEChanges",deId:this.deId,attId:this.attId,attName:this.attName,dsId:this.dsId,k:k&&k.k,actions:b};if(this.isNew){e.n=this.n;}if(this.fromDS){e.actions.push({act:"updateDeObject",name:this.n});}l.addUpdateObjects(e,{id:(e.deId&&e.deId.substr(0,5)!=="$GUID")?e.deId:e.attId,type:47,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE});j=Z(l.getDatasetsUpdateCallback(),j,l.getHighLightNDECallback(),l.getUpdateHiddenLayoutsCallback());var h=(e.actions&&e.actions.length>0)?[e]:[];if(this.getExtraSaveActions){h=h.concat(this.getExtraSaveActions());}if(l.hasSelectionOnVisFilter()){h=l.wrapUnsetVisualizationFilterAction(h);l.clearSelectionOnVisFilter(true);if(h&&h.length){h[0].partialRetrieval={nodes:g(f.xtab,l,f)};}}M(this.items,function(m){if((m.mptf||{}).isDirty){h.push(f.docModel.dataService.getSetMDXPassThroughOptionsForCMAction({mptf:m.mptf,cid:f.deId,ceid:m.id}));}});if(!this.isNew&&!this.fromDS&&this.isNameChanged){h=h.concat({act:"updateTemplate",keyContext:k&&k.k,actions:[{act:"renameUnit",id:this.deId,type:47,name:this.dispName}],partialRetrieval:{nodes:[k&&k.k]}});}c.submitUndoRedoUpdates(h,{},j,J.REQUEST_DEFN_DATA);}});mstrmojo.vi.models.DEConsolidationElem=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.models.DEConsolidationElem",origPos:null,isDirty:false,isNew:false,prev:null,populate:function H(b,a){G(b,this);this.origPos=a;this.prev=C(this);this.isDirty=false;this.isNew=false;},isPassThroughCalculation:function E(){return this.t===O.CALCULATION&&this.func===W.FunctionApplySimple;},getPassThroughExpression:function K(){if(this.isPassThroughCalculation()){return this.es&&this.es[0]&&this.es[0].v;}},getParentElement:function Q(){return this.pe;}});}());(function(){mstrmojo.requiresCls("mstrmojo.util.ui._HostsSplitter","mstrmojo.models.FormatModel","mstrmojo.DocDataService","mstrmojo.dom","mstrmojo.array","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.hash","mstrmojo.css");var g=mstrmojo.array,V=mstrmojo.hash,C=mstrmojo.css,R=mstrmojo.dom,n=mstrmojo.models.FormatModel,q=n.getFormatUpdate,h=n.ENUM_PROPERTY_NAMES,J={h:{dimension:{shared:"width",full:"height"},position:{shared:"left",full:"top"}},v:{dimension:{shared:"height",full:"width"},position:{shared:"top",full:"left"}}},N=mstrmojo.DocDataService.SUPPRESS_DATA,K=mstrmojo.DocDataService.RAPID_EXEC;mstrmojo.vi.ui.BoxLayoutDimensionsType=null;function I(z){var x=V.copy(z);var w="px";x.left=Math.max(x.left,0)+w;x.top=Math.max(x.top,0)+w;x.height=Math.max(x.height,0)+w;x.width=Math.max(x.width,0)+w;return x;}function t(z,AC,AB,x){var AD=J[z].dimension,w=J[z].position,AA={};AA[AD.shared]=AC;AA[AD.full]=AB[AD.full];AA[w.shared]=x;AA[w.full]=AB[w.full];return AA;}function O(w,AD,AB,AC){var AA=w==="v"?"h":"v",z=[],x=function(AE){if(AE===w){return z.reduce(function(AF,AG){return AF+AG[w];},0);}return Math.max.apply(null,z.map(function(AF){return AF[AA];}));};AD.forEach(function(AE,AF){var AG={};if(AE.t===this.componentType){AG=mstrmojo.vi.ui.BoxLayoutConfig.getMinimumChildSizes(AE,w,AC);}else{AG=O.call(this,AE.o,AE.children,AB,AC);}if(AF!==AD.length-1){AG[w]+=AB;}z.push(AG);},this);return{sizes:z.map(function(AE){return AE[w];}),v:x("v"),h:x("h")};}function k(x,AN,AC,AG,AP){var w=O.call(this,x,AN,AG,AP),AR=J[x].dimension.shared,AL=AC[AR],AK=AL,AE=AN.length-1,AB=0,AS=false,AD=function(AU,AT){return AT===AE?AU:AU+AG;},z=0,AA={},AQ={},AI=false,AF=function(AU){var AT=this.getUnitByKey&&this.getUnitByKey(AU);return AT&&AT.height&&parseInt(AT.height,10)||0;};AN.forEach(function(AV,AT){var AU=parseFloat(AV.l);if(AV.f){AL-=AD(AU,AT);AS=true;}else{AB+=AU;}});var AJ=!AS&&AB===0;if(AJ){AB=100*AN.length;}if(AB>100){AI=true;}AN.forEach(function(AU,AT){var AW=AJ?100:AU.l;if(AU.f){AA[AT]=AD(AW,AT);return ;}var AV=AI&&AU.type===this.componentType?AF.call(this,AU.k):Math.round(AL*(AW/AB)),AX=w.sizes[AT];if(AX>AV){AA[AT]=AX;z+=AX-AV;return ;}AQ[AT]={c:AV,m:AX};}.bind(this));if(z){var AH=function(){var AV=Object.keys(AQ),AU=Math.floor(z/AV.length),AT=true;AV.forEach(function(AW){var AX=AQ[AW];if(AX.m>AX.c-AU){AA[AW]=AX.m;z-=AX.c-AX.m;AT=false;delete AQ[AW];}});if(AT){AV.forEach(function(AW){AA[AW]=AQ[AW].c-AU;});AQ={};return ;}AH();};AH();}Object.keys(AQ).forEach(function(AT){AA[AT]=AQ[AT].c;});var AM=Object.keys(AA).map(function(AU,AT){return AA[AU]-(AT<AE?AG:0);}),AO=AK-AM.reduce(g.fnReduceNumber,0)-(AE*AG);if(AO!==0){if(AM[AE]+AO<=0){AC[AR]-=AO;}else{AM[AE]+=AO;}}return AM;}var L=document.createElement("div");L.setAttribute("unselectable","on");L.className="splitter";mstrmojo.vi.ui._HasBoxLayout=mstrmojo.provide("mstrmojo.vi.ui._HasBoxLayout",{_mixinName:"mstrmojo.vi.ui._HasBoxLayout",boxType:"b",componentType:"c",boxLayoutConfig:null,firstBoxId:null,firstVizBoxId:null,splitterCache:null,splittersInfo:null,isInteractive:true,allowPanelEdgeTargeting:false,postBuildBoxLayout:mstrmojo.emptyFn,postCalculateBoxLayout:null,getBoxLayoutSaveAction:function W(w,x){return this.model.getUnitFormatAction(this,1,q(h.LAYOUT_XML,w),x);},getBoxLayoutSaveCallback:function l(){return null;},getChildPositionActions:function F(w){return[];},saveBoxLayout:function e(w,AF,AH,AB,AC,x){var AE=this.boxLayoutConfig,AD=this.model,AG=AD.getDataService(),AA=[].concat(this.getBoxLayoutSaveAction(AE.getBoxState(),AC)).concat(this.getChildPositionActions(AC)),z=V.copy(x,V.copy(K,{preserveUndo:true}));AH=AH||{success:mstrmojo.emptyFn};if(!AB){if(w){w.submit(AA,AH,z,AF);}else{AG.submitUpdates(AA,AH,z);}}else{AB.add(AA,AH);}},buildBoxLayout:function M(AA,AD){var AB=this.boxLayoutConfig;if(!AB||(this.height===undefined&&this.width===undefined)){return ;}if(AD){AB.box=AD;}var z={height:parseInt(this.height,10),width:parseInt(this.width,10),top:0,left:0},AG=this.calculateBoxLayout(AB,z),AM=AG.box,AH=AB.identifier,AC=this.children,AF=AB.boxPaths={};this.firstVizBoxId=null;var AL=Infinity,x=Infinity,AK=-1,AE=-1;Object.keys(AM).forEach(function(AN){var AO=AC[g.find(AC,AH,AN)];if(AO&&AO.scriptClass==="mstrmojo.vi.ui.rw.VizBox"){AK=parseInt(AO.top,10);AE=parseInt(AO.left,10);if(x>AK){x=AK;AL=AE;this.firstVizBoxId=AO.id;}else{if(x===AK){if(AL>AE){AL=AE;this.firstVizBoxId=AO.id;}}}}},this);this.firstBoxId=null;Object.keys(AM).forEach(function(AO){var AP=AC[g.find(AC,AH,AO)];if(AP){var AN=AM[AO],AQ=AP.id;if(AN.first){this.firstBoxId=AQ;}AN.boxChild.id=AQ;AF[AO]=AN.boxLevel;AP.updateLayout(AN.dim,AA);}},this);var AI=this.getSplitterHost();this.splittersInfo=AG.splitter;this.updateSplitters();if(AI){var AJ=AI.style,w=AG.size;AJ.height=w.height+"px";AJ.width=w.width+"px";}if(this.updateScrollbars){this.updateScrollbars();}this.postBuildBoxLayout();delete AB.dirty;},postBuildRendering:function X(){var w=this._super();this.updateSplitters();return w;},updateSplitters:function f(){if(!this.splittersInfo){return ;}var x=this.splitterCache=this.splitterCache||[],w=this.splittersInfo,z=this.getSplitterHost();if(z){w.forEach(function(AE,AC){var AA=AE.dim;var AD=x[AC];if(!AD){AD=x[AC]=L.cloneNode(false);this.registerSplitter(AD);}AD.path=AE.boxLevel;AD.orientation=AE.orientation;var AB=AD.style;V.copy(I(AA),AB);AB.display="block";C.toggleClass(AD,"v",AE.orientation==="h");if(!AD.parentNode){z.appendChild(AD);}},this);x.slice(w.length).forEach(function(AA){AA.style.display="none";});this.splittersInfo=null;}},calculateBoxLayout:function Q(x,AD){var AC=x.padding||0,AB=[],AF={},w=[];var AA=function(AP,AG,AH){var AI=AP.o,AM=J[AI].dimension,AO=J[AI].position,AJ=AM.shared,AK=AO.shared,AR=AG[AK],AQ=AP.children,AN=AQ.length-1,AL=k.call(this,AI,AQ,AG,AC,x);if(AB.length===AH){AB[AH]=-1;}AQ.forEach(function(AT,AV){var AX=AT.t,AY=AL[AV],AW=t.call(this,AI,AY,AG,AR);AT.h=AW.height;AT.w=AW.width;AB[AH]=AB[AH]+1;var AU=AB.join("|");if(AX===this.componentType){AF[AT[x.identifier]]={boxLevel:AU,boxChild:AT,dim:I(AW),first:(AW.top===0&&AW.left===0)};}else{if(AX===this.boxType){AA.call(this,AT,AW,AH+1);AB.splice(AH+1);}}if(this.isInteractive&&!AT.r&&AV<AN){var AS=(JSON.parse(JSON.stringify(AW)));AS[AK]+=AY;AS[AJ]=AC;w.push({boxLevel:AU,dim:AS,orientation:AI});}AR+=AY+AC;},this);};var z=x.box||x.useDefaultBox(this.children),AE=O.call(this,z.o,z.children,AC,x);AD.height=Math.max(AD.height,AE.v);AD.width=Math.max(AD.width,AE.h);if(this.postCalculateBoxLayout){z=this.postCalculateBoxLayout(z,AD,AA);if(z&&x.box){x.box=z;}}if(z){AA.call(this,z,AD,0);}return{box:AF,splitter:w,size:{height:AD.height,width:AD.width}};},updateBoxPaths:function u(){var z=[],x=this.boxLayoutConfig,AA=this.boxLayoutConfig.boxPaths={};var w=function(AB,AC){if(z.length===AC){z[AC]=-1;}AB.children.forEach(function(AD){var AF=AD.t;z[AC]=z[AC]+1;var AE=z.join("|");if(AF===this.componentType){AA[AD[x.identifier]]=AE;}else{if(AF===this.boxType){w.call(this,AD,AC+1);z.splice(AC+1);}}},this);};w.call(this,x.box,0);},getBoxLayoutChild:function Z(w){var x=w.id;if(x){return mstrmojo.all[x];}return null;},setDimensions:function o(AA,x){if(this.height!==AA||this.width!==x||(this.parent&&this.parent.forceLayout)){this.height=AA;this.width=x;if(this.hasRendered){var z=this.domNode.style;z.height=AA;z.width=x;}this.buildBoxLayout();}},onAppStateChange:function j(w){this.isInteractive=!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()||mstrApp.isLayoutModePreview());},onLayoutModeChange:function U(w){this.isInteractive=!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()||mstrApp.isLayoutPreview(w.value));},getSplitterInfo:function s(z){var AB=z.path,x=z.orientation,w=this.boxLayoutConfig.getResizeBoundaries(AB,x),AA=parseInt(x==="v"?this.height:this.width,10);return{path:AB,min:w.min,max:AA-w.max};},shouldSaveSplitterMoves:function D(){return !mstrApp.hasRequests();},splitterMoved:function S(w,AD){var AB=this,x=AB.boxLayoutConfig,AA=AB.model,AC=mstrmojo.DocDataService,z=function(AE){x.resizeBox(AD.path,w);AB.buildBoxLayout();AB.saveBoxLayout(AE);};if(this.shouldSaveSplitterMoves()){AA.execute({execute:function(){z(this);},urInfo:{callback:AC.EMPTY_CALLBACK,extras:AC.SUPPRESS_DATA}});}else{z();}},insertNewBox:function E(AA,x,z,AB){var w=this.boxLayoutConfig;if(AB){AB.oldBoxState=w.getBoxState();}if(x){w.addDropBox(x,z,{box:{boxId:AA.id}});}else{w.insertNewRootChild(AA,z);this.buildBoxLayout(true);}},insertNewBoxAndSaveDeferred:function(AC,z,AA,AB,w,x){this.insertNewBox(z,w,x);this.saveBoxLayout(undefined,-1,AB,AC);},deleteBoxAndSubmitDeferred:function(AB,x,AA,z,w){this.deleteBox(x,w);this.saveBoxLayout(undefined,-1,AA,AB,z);},deleteBox:function a(w,x){this.boxLayoutConfig.deleteBox(w,x);this.removeChildren(w);},deleteBoxAndSubmit:function r(x,AB,w){var AA=this.model.getDataService(),z=this;this.model.execute({execute:function(){var AC=this,AD=AA.newUpdate(AC,AB);z.deleteBoxAndSubmitDeferred(AD,x);AD.addExtras(V.copy(N,w));AD.submit();}});},getBoxOrientation:function P(w){var x=this.boxLayoutConfig;return x.getBoxOrientation(x.getBoxPath(w));},hasBoxLayoutChild:function m(z){var w=this.boxLayoutConfig,AB=w.identifier,AA=z[AB],x=function(AC){if(!AC){return false;}if(AC.t===this.componentType){return AC[AB]===AA;}return(AC.children||[]).some(x);}.bind(this);return z.parent===this&&x(w.box);},beginBoxMove:function Y(x,w,z){this.boxLayoutConfig.beginBoxMove(x,w,z);},dropBox:function d(AA,x,AC,AD){var z=this.getPanelTargetEdge(AA),w=this,AB=this.boxLayoutConfig;if(z){AB.insertExistingRootChild(AA,z.substr(1));}else{AB.addDropBox(x,AC,AA);}w.buildBoxLayout();if(AD){this.saveBoxLayout();}},cancelBoxMove:function c(w){var x=w.src.widget;if(!x.cancelBoxMove(w)){this.boxLayoutConfig.cancelBoxMove(w);}},endBoxMove:mstrmojo.emptyFn,getPanelTargetEdge:function v(z){if(!this.allowPanelEdgeTargeting){return"";}var AC=z.panelPos;if(!AC){var w=R.position(this.domNode);AC=z.panelPos={p:w,q:{Top:w.y,Right:w.x+w.w,Bottom:w.y+w.h,Left:w.x}};}var AB=z.tgt.pos,AA=mstrmojo.boxmodel.getEdgeQuadrantByPoint(AC.p,AB),x=AA==="Left"||AA==="Right"?AB.x:AB.y;return Math.abs(AC.q[AA]-x)<=12?"p"+AA:"";},updateDropCue:function H(AC,AA,AB){var z=this._dropCue;if(!z){z=this._dropCue=document.body.appendChild(document.createElement("div"));z.className="mstrmojo-vi-hbl-cue";}var AD=z.style;if(AC===""){AD.display="none";AD.top="-10000px";return ;}if(AC.charAt(0)==="p"){AC=AC.substr(1);AB=AA.panelPos.p;}var x=AC==="All",w={top:AB.y-3,left:AB.x-3,height:AB.h+6,width:AB.w+6};if(!x){var AE=true;if(AC==="Bottom"){w.top=AB.y+AB.h+mstrApp.getThemeProps(mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.LAYOUT).cueBottomOffset;}else{if(AC==="Right"){w.left=AB.x+AB.w+1;AE=false;}else{AE=AC==="Top";}}w[AE?"height":"width"]=2;}C.toggleClass(z,"all",x);AD.cssText=Object.keys(w).map(function(AF){return AF+":"+w[AF]+"px";}).join(";");AD.display="block";},unrender:function B(x){var w=this._dropCue;if(w){w.parentNode.removeChild(w);delete this._dropCue;}this.splitterCache=null;return this._super(x);},getSplitterHost:function A(){throw new Error(this.scriptClass+" must implement getSplitterHost.");},getBoxState:function b(){return this.boxLayoutConfig.getBoxState();},restoreBoxState:function p(w){this.boxLayoutConfig.revertBoxState(w);}});var G=mstrmojo.vi.ui._HasBoxLayout;V.forEach(mstrmojo.util.ui._HostsSplitter,function(x,w){if(!G.hasOwnProperty(w)){G[w]=x;}});}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.DocDataService");mstrmojo.vi.models.PanelFormatSaver=mstrmojo.provide("mstrmojo.vi.models.PanelFormatSaver",{getPanelSaver:function A(C,B,D){return{saveProperty:function E(G,H){var J=B[G];if(J){if(J.convert){H=mstrmojo.boxmodel.px2Inches(C.getZoomProps(),H);}var I={},F=I[J.set]={};F[J.name]=H;C.updateUnitFormat(D||C.getRootNode(),1,I,undefined,mstrmojo.DocDataService.RAPID_EXEC);}}};}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocDataService");mstrmojo.OIVMViewFactory=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.OIVMViewFactory",newDocDataService:function A(B){return new mstrmojo.DocDataService(B);}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.func","mstrmojo.DocDataService","mstrmojo.vi.models.EnumFieldTypes");mstrmojo.requiresDescs(1013,2922,4538);var N=mstrmojo.func,H=mstrmojo.EnumRWUnitType,S=mstrmojo.models.FormatModel,D=S.getFormatUpdate,J=S.ENUM_PROPERTY_NAMES,Q="\u001E",I={106:{id:"1013",desc:"Text"},102:{id:"2922",desc:"Image"},107:{id:"4538",desc:"HTML Container"}},C=mstrmojo.vi.models.EnumFieldTypes;function G(V,U,W,X){if(U!==W){return{act:"editField",fieldKey:V.k,fieldType:X,fieldValue:U,nodeKey:V.nk,treeType:1,fieldName:(V.defn&&V.defn.n)||V.k,partialRetrieval:{nodes:[V.k,V.nk]}};}return undefined;}function P(U){switch(U){case H.TEXTFIELD:case H.IMAGE:case H.HTMLCONTAINER:return mstrmojo.desc(I[U].id,I[U].desc)+this.updateTypeCounter(U);default:return null;}}function A(Y,X,a){var W=H.HTMLCONTAINER,V=Y.nk,U=Y.k,Z={act:"format",unitType:W,formatType:1,nodeKey:V,fieldKey:U,keyContext:W+Q+V+Q+U,format:{FormattingHTML:{HTMLType:X}},partialRetrieval:{nodes:[U,V]}};Z.format.FormattingHTML[X===1?"HTMLText":"URL"]=a;return Z;}mstrmojo.vi.models._FieldActions=mstrmojo.provide("mstrmojo.vi.models._FieldActions",{_mixinName:"mstrmojo.vi.models._FieldActions",insertNewField:function B(U){var c=this,a=c.getVizContentPanel(),e=U.t,V,Y=this.id,f=P.call(this,e),Z=c.getVizContentPanel().k,b=c.getNextKey(),d=a.nk,X=a.defn.fgk,W;a.restoreAnyMaxedVizBox();this.execute({execute:function(){var k=c.getDataService(),l=k.newUpdate(this,{extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA});var j=c.createNewUnitNode(function(m){m.v=U.v;return m;},function(m){m.t=e;m.n=f||b;return m;},function(m){V=a.defn.fgk||a.nk;m.nk=b=V||mstrmojo.all[Y].getNextKey();return m;});var h=c.createUnit(j,Z);W=h.k;h.nk=a.nk=b;var g=function(m){m.fieldKey=W;m.fieldType=U.ft;m.nodeKey=b;m.treeType=1;m.fieldName=f||b;m.partialRetrieval={nodes:[b]};return m;};l.addActions([g({act:"addField",createNode:!V,nodeKeyParent:a.k}),g({act:"editField",fieldValue:U.v})]);if(U.getAdditionalActions){l.addActions(U.getAdditionalActions(h)||[]);}c.deferredInsertUnit(l,h,Z);this.submitUpdate(l);},urInfo:{treesToRender:3,undo:function(){a=c.getVizContentPanel();a.nk=d;a.defn.fgk=X;var g=a.getUnitByKey(W);g.defn._isDeleted=true;g.undoInsert();delete this.callback;return true;},redo:function(){var h=c.createNewUnitNode(function(l){l.v=U.v;return l;},function(l){l.t=e;l.n=f||b;return l;},function(l){l.nk=b;return l;},W);var g=c.createUnit(h,Z);g.nk=c.getVizContentPanel().nk=b;var j=c.getDataService(),k=j.newUpdate(this,{extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA});c.deferredInsertUnit(k,g,Z);if(this.urInfo){this.urInfo.callback=k.callback;}this.callback=k.callback;return false;}}});},insertNewText:function K(){var U=H.TEXTFIELD;this.insertNewField({v:"",t:U,ft:C.TEXT,getAdditionalActions:function V(X){var Y=X.k,W=X.nk;return[{act:"format",unitKey:Y,unitType:U,formatType:1,fieldKey:Y,nodeKey:W,keyContext:U+Q+W+Q+Y,format:{FormattingSize:{TextOverflow:1}}}];}});},editField:function O(e,Z,f,b,V,U){var d=this,Y=(U&&U.actions)||[],a=U&&U.callback,X,W=U&&U.extras,c=e.k;X=G.call(d,e,b,V,Z);if(X){Y.push(X);}this.execute({execute:function(){this.submit(Y,N.wrapMethods(a,{success:function(g){if(Z===C.IMAGE&&e.defn.oid){delete e.defn.oid;}d.partialUpdate(g.data,d.getTargetDefn(e.k),g.defn,[c]);d.selectVIUnit(e.id);if(f&&f.success){f.success(g);}},failure:function(){if(f&&f.fail){f.fail();}}}),W);}});},getRemoveFieldUpdate:function F(U){return this.getDataService().newUpdate(null,{actions:[{act:"removeField",treeType:"1",nodeKey:U.nk,fieldKey:U.k}]});},editLink:function E(U,Z,V,Y){var W=this.getUnitFormatAction(U,1,{FormattingNavigation:{Hyperlinks:V}});var X=this.getDataService();this.execute({execute:function(){var a=this,b=X.newUpdate(a,{actions:[W],callback:Y});b.submit();},urInfo:{silent:true,undo:Y.undo,redo:Y.redo}});},editHtmlContainer:function R(W,V,Y,a){var Z=this.id,X=mstrmojo.DocDataService,U={callback:mstrmojo.DocDataService.EMPTY_CALLBACK,undo:a.undo,redo:a.redo};if(V!==1){U.extras=X.SUPPRESS_DATA;}this.execute({execute:function(){var c=mstrmojo.all[Z],e=c.getDataService(),d=(V!==1?{extras:X.SUPPRESS_DATA}:null),f=e.newUpdate(this,d),b=W.k;f.addActions([A(W,V,Y)]);f.addCallbacks(N.wrapMethods(a,{success:function(g){c.partialUpdate(g.data,c.getTargetDefn(b),g.defn);}}));this.submitUpdate(f);},urInfo:U});},insertNewImage:function M(){this.insertNewField({v:"",t:H.IMAGE,ft:C.IMAGE,getAdditionalActions:function U(V){var W=V.model.getUnitFormatAction;return[W(V,1,D(J.IMAGE_HEIGHT,0),true),W(V,1,D(J.IMAGE_WIDTH,0),true)];}});},insertNewHtmlContainer:function L(){this.insertNewField({v:"",t:H.HTMLCONTAINER,ft:C.HTML_CONTAINER});}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.DocDataService","mstrmojo.mstr.EnumWebAPIErrorCodes");var G=mstrmojo.hash.copy,S=mstrmojo.func,X=S.wrapMethods,Y=mstrmojo.mstr.EnumWebAPIErrorCodes;var K=1,E=2,A=3;var P={FIRST:1,MIDDLE:2,LAST:3};var O={BUSY:1,INTERIM:2,DONE:3,SILENT:4,CANCELED:5};var F=G(mstrmojo.DocDataService.SUPPRESS_DATA,{preserveUndo:true,config:{silent:true}});function B(Z,b,a){if(b.stid==="undefined"){a.submission=function(f,c,d){var g=d.params,e=JSON.parse(g.params);e.actions[0].stid=Z.action===K?Z.undoStateId:Z.redoStateId;g.params=JSON.stringify(e);};}return a;}function H(a,e){var b=a.mgr;e.disablePU=true;var d=B(a,e,{success:function c(){a.state=O.DONE;},failure:function Z(){b.onFailure();}});a.state=O.SILENT;b.dataService.submitUpdates(e,d,F);b.onSuccess(a);}function W(k,e){var j=k.urInfo,h=j.puKeys,p=j.puObjs,f=j.puFilters,l=k.mgr,g=l.model,m=l.dataService;if(h||p){if(h){e.partialRetrieval={nodes:h,filters:f};}if(p){g.addUpdateObjects(e,p);}}else{e.disablePU=true;}var c=B(k,e,{success:function o(){k.state=O.DONE;l.onSuccess(k);g.restoreUIState(k.action===K?k.undoUIState:k.redoUIState);},failure:function b(){l.onFailure();},complete:function a(){l.resetState();}}),Z=j.callback||g.getRebuildCallback(),n=X(Z,c),d=G(j.extras);if(e.act==="undo"&&d!==undefined){d.hideCancel=true;if(e.killJob){d.message=mstrmojo.desc(14586,"Canceling...");}}k.state=O.BUSY;m.submitUpdates(e,n,d);}function M(c){var Z=c.urInfo,a=c.mgr.model;if(!Z.extras){var b=(Z.treesToRender!==undefined)?Z.treesToRender:c._treesFromRes;if(!Z.disablePU&&!c._hasFullUpdate&&(!Z.puKeys||!Z.puKeys.length)){b=0;Z.callback=X(a.getDatasetsUpdateCallback(),Z.callback);}Z.extras={style:{params:{treesToRender:b}}};}}mstrmojo.vi.controllers.UICmd=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.controllers.UICmd",mgr:null,redoStateId:null,undoStateId:null,execute:mstrmojo.getMissingFn(),discard:mstrmojo.emptyFn,isUntracked:false,action:null,state:O.INTERIM,urInfo:null,getStateValue:function V(a,Z){return this.action===K?Z:a;},init:function Q(Z){G(Z,this);this._treesFromRes=0;this.urInfo=this.urInfo||{};this.submitCount=0;},undoRedo:function I(f){var b=this,d,a=this.urInfo,Z=a.silent,g,c=this.mgr,e=c.dataService;if(b.action===A){d={act:"redo",stid:b.redoStateId};g=a.redo;}else{if(b.action===K){d={act:"undo",stid:b.undoStateId,killJob:f};g=a.undo;}else{c.handleError();}}if(g){e.blockRequests=true;try{Z=!!g.call(b)||Z;}finally{e.blockRequests=false;}}if(Z){H(b,d);}else{W(b,d);}},submitUpdate:function J(a,Z){this.submit(a.actions,a.callback,a.extras,Z);},submit:function L(d,o,c,m){var j=this,k=j.mgr,f=k.model,l=k.dataService,h=mstrmojo.array.ensureArray(d);o=o?G(o):f.getRebuildCallback();j.state=O.BUSY;function e(p,q){return !(p&&p[q]&&p[q].length);}if(j._hasFullUpdate||h.some(function(p){return p.disablePU;})||h.every(function(q){var r=q.partialRetrieval,p=q.partialUpdate;return e(r,"nodes")&&e(p,"nodes")&&e(p,"selectors")&&e(p,"objects");})){j._hasFullUpdate=true;}S.override({submission:function b(){if(j.submitCount===0){j.undoStateId=l.stid;}j.submitCount++;},success:function n(t,u){if(j.action!==E){k.handleError();}j.redoStateId=t.stid;var s=!m||m===P.LAST;if(s){j.state=O.DONE;}else{j.state=O.INTERIM;}var r=j.urInfo;if(!r.disablePU){var p=r.puKeys||[],v=t.pukeys&&t.pukeys.split("\u001E");if(v&&v.length){p=p.concat(v);var q=r.extraPuKeys;if(q){p=p.concat(q);delete r.extraPuKeys;}}if(p.length){r.puKeys=p;}}j._treesFromRes|=(t.defn?1:0)|(t.data?2:0);if(this._super){this._super(t,u);}if(s){j.completeSubmit();}},failure:function a(p,s){var r=(c&&c.skipUICmdMgrOnFailure)||[],q=parseInt(p.code||(p.getResponseHeader&&p.getResponseHeader("X-MSTR-TaskErrorCode")||Y.UICMD_DEFAULT_ERROR),10);if(r.indexOf(q)===-1&&r.indexOf(mstrmojo.mstr.EnumWebAPIErrorCodes.E_UNUSED)===-1){k.onFailure();}if(this._super){this._super(p,s);}},canceled:function g(p){if(this._super){this._super(p);}window.setTimeout(function(){j.cancel(true);},0);},complete:function Z(){if(!m||m===P.LAST){k.resetState();}if(this._super){this._super();}}},o);l.submitUpdates(d,o,c);},submitInterim:function R(a,b,Z){this.submit(a,b,Z,P.MIDDLE);},resetCmdMgrOnComplete:function C(){this._resetMgr=true;},completeSubmit:function N(){var a=this,b=a.mgr,Z=b.model;if(!a.completed){a.completed=true;a.state=O.DONE;b.onSuccess(a);M(a);a.redoUIState=Z.getUIState();if(a.isUntracked){b.untrackLastCmd();}else{if(a._resetMgr){b.reset();}}}},cancel:function D(Z){this.state=O.CANCELED;if(this._hasFullUpdate){this._treesFromRes=3;}M(this);this.mgr.onCancel(this,Z);},submitSilent:function U(b){var d=this,e=d.mgr,c=e.model,f=e.dataService;d.state=O.SILENT;e.onSuccess(d);d.redoUIState=c.getUIState();var g={submission:function a(){d.undoStateId=f.stid;d.submitCount++;},success:function h(j){d.state=O.DONE;d.redoStateId=j.stid;},failure:function Z(){e.onFailure();}};f.submitUpdates(b,g,F);}});mstrmojo.vi.controllers.UICmd.CMD_PHASE=P;mstrmojo.vi.controllers.UICmd.CMD_STATE=O;mstrmojo.vi.controllers.UICmd.CMD_ACT_TYPE={UNDO:K,EXEC:E,REDO:A};}());(function(){mstrmojo.requiresCls("mstrmojo.DocDataService","mstrmojo.vi.enums.EnumFeatures");var L=mstrmojo,A=L.func,K=L.array,M=L.DocDataService.REQUEST_DEFN_DATA,F=L.mstr.EnumWebAPIErrorCodes,H=mstrmojo.vi.enums.EnumFeatures;mstrmojo.vi.models._LayoutActions=mstrmojo.provide("mstrmojo.vi.models._LayoutActions",{_mixinName:"mstrmojo.vi.models._LayoutActions",addNewLayout:function J(R,P,Q){var N=this,O={act:"addLayout",nodeKey:P.nodeKey,titlePattern:mstrApp.supportFeature(H.USE_WORKSTATION_NAMING_STYLE)?1:0,newPanelKey:P.newPanelKey,analysisSectionType:P.analysisSectionType,index:P.index,disablePU:true};R.add(O,A.wrapMethods({success:function(S){N.replaceLayout(O.nodeKey,S,true);N.mapLayKeys={newKey:O.nodeKey};}},Q),M);},addExistingLayouts:function I(S,Q,R){var N=this,P=[F.E_UNUSED],O={act:"importDashboard",newPanelKey:Q.newPanelKey,analysisSectionType:Q.analysisSectionType,index:Q.index,disablePU:true};S.extras.skipUICmdMgrOnFailure=P;S.extras.config={hideFailureErr:true};S.add(O,A.wrapMethods({success:function(U){if(N.resetKeySeed){N.resetKeySeed(U.keySeed);}N.updateLayouts(U);},failure:function(U,W){var V=function(){N.controller.undo();};mstrmojo.error({longDesc:U.message},V,{onClose:V,title:"Error"});}},N.controller.getUpdateLayoutsCallback(),R),M);},duplicateLayout:function(R,P,Q){var N=this,O={act:"duplLayout",srcKey:P.srcKey,destKey:P.destKey,name:P.name,index:P.index,disablePU:true};R.add(O,A.wrapMethods({success:function(W){N.replaceLayout(O.destKey,W,true);N.mapLayKeys={oldKey:O.srcKey,newKey:O.destKey};var S=N.getLayoutDefn(O.srcKey),X=(W.defn&&W.defn.layouts||[]).filter(function(Z){return Z.k===O.srcKey;})[0],V;for(V in S.units){var Y=S.units[V],U=X&&X.units[V];Y.pnk=U?U.pnk:Y.pnk;Y.chdidx=U?U.chdidx:-1;}}},Q),M);},moveLayout:function C(O,Q){var N=this.defn.layouts,P=this.data.layouts,R=[N,P];R.forEach(function(S){S.splice(Q,0,S.splice(O,1)[0]);});},getMoveLayoutAction:function B(N,O){return this.getDataService().getMoveNodeAction(this.data.layouts[N],this.defn.root.k,O);},removeLayout:function G(Q,U,S){var P=this,O=this.defn.layouts,R=this.data.layouts,N=K.find(O,"k",Q);if(N===-1){throw new Error("Layout with key "+Q+" not found.");}S.add({act:"removeLayout",unitKey:Q,isCurrent:Q===P.currlaykey},A.wrapMethods({success:function(V){O.splice(N,1);R.splice(N,1);var W=R[K.find(R,"k",V.currlaykey)];if(!W||!W.loaded){P.replaceLayout(V.currlaykey,V,true);}}},U));},renameLayout:function E(N,P,O,Q){this.updateTitle(P,O,N,N,"title",Q);},updateLayouts:function D(P){var U=this,O=false,S=(U.defn&&U.defn.layouts)||[],V=(U.data&&U.data.layouts)||[],R=(P.defn&&P.defn.layouts)||[],N=(P.data&&P.data.layouts)||[],Q=[],W=[];R.forEach(function(Y){var X=mstrmojo.array.find(S,"k",Y.k);if(X>=0&&!Y.loaded){Q.push(S[X]);}else{Q.push(Y);}});N.forEach(function(Y){var X=mstrmojo.array.find(V,"k",Y.k);if(X>=0&&!Y.loaded){W.push(V[X]);}else{W.push(Y);}});if(U.defn){U.defn.layouts=Q.length?Q:S;}if(U.data){U.data.layouts=W.length?W:V;}(N||R||[]).forEach(function(X){if(X.loaded){U.replaceLayout(X.k,P,true);O=true;}});if(!O){U.ondefnChange();}return R.length!==0||N.length!==0;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.DocDataService","mstrmojo.mstr.EnumFunction","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(5421,5422,13355);var P=mstrmojo.hash,L=mstrmojo.array,F=mstrmojo.desc,G=mstrmojo.DocDataService,C=mstrmojo.string,a=mstrmojo.mstr.EnumFunction,b=mstrmojo.mstr.EnumDSSXMLObjectTypes;var c=1;function K(n,d,s,u){var g=n.model,p=n.cmSelCells,t=[],AD=g.getCellTitleInfo(d).title,AF,v,j=function(e){var w=n.getCellForNode(e);t.push(n.getCellUnitIndex(w));AF=w.dpt;},o,AA=d.lv>=0,AG;if(typeof u==="string"&&u.indexOf(";")>0){v=parseInt(u.substring(u.indexOf(";")+1),10);u=parseInt(u.substring(0,u.indexOf(";")),10);}if(v===1&&!s){p.reverse().forEach(j);}else{if(v===1){o=1;p.forEach(j);}else{p.forEach(j);}}AG={oId:AD.id,oTp:AD.otp,depth:AF,ordinals:t.join(","),sliceId:n.sid,viewKey:n.k,funcVal:u,switchOrder:o,art:g.getObjectInfoFromDataset(AD.id).art,isRA:AA};if(AA&&u===a.FunctionApplySimple){var r=g.docModel.datasets[g.data.datasetId];if(r&&r.tables&&r.tables.length>=0&&r.tables[0].dbt===mstrmojo.warehouse.EnumDatabaseType.EssBase){AG.peName=AD.v||AD.n;}else{var k=n.getCellForNode(p[0]),AE=k._e.id;AG.peId=AE;AG.peName=k._e.ori_n||k._e.n;try{if(AD.fix>=0){var h=g.docModel.findUnitInDataSet(AD.id).fs,m=L.filterOne(h,function(e){return e.fnm==="DESC";}).fid;if(m){var AB=n.dataBlocks&&n.dataBlocks[k._gd]||g.data,z=AB.gts[(AD.axis===c)?"row":"col"],l=L.filterOne(z,function(e){return e.id===AD.id&&e.fid===m;}),AC=l.es[k.idx];AG.peName=AC&&(AC.ori_n||AC.n)||AG.peName;}}else{var q;L.forEach(AD.fs,function(w,e){if(w.n==="DESC"){q=e;return false;}});if(q!==undefined){var f=[];if(AD.axis===c){var x;for(x=k.idx;x>-1;x--){if(AD.es[x].id===AE){f=[AD.es[x].ori_n||AD.es[x].n].concat(f);}else{break;}}for(x=k.idx+1;x<AD.es.length;x++){if(AD.es[x].id===AE){f.push(AD.es[x].ori_n||AD.es[x].n);}else{break;}}}else{f=L.map(L.filter(AD.es,function(w){return w.id===AE;}),function(w){return w.ori_n||w.n;});}AG.peName=f[q]||AG.peName;}}}catch(AC){}}}return AG;}function D(f,e,h){var l=f.getDEInfo(e),k=l&&l.deObject&&l.deObject.des,j=1,g=h===-1?F(5187,"Group"):(h===a.FunctionApplySimple?F(13355,"Calculated Member"):F(5188,"Calculation")),d=function(m){return m.n===g+" "+j;};while(true&&k){if(k.some(d)){j++;}else{break;}}f.controller.onAddQuickDE(f,P.copy(K(f,e,false,h),{act:"addQuickDE",deName:g+" "+j}));}function Z(d,f){var e;for(e in d){if(L.find(d[e].att,"did",f)>-1){return e;}}return undefined;}function X(d){var f=d.split(";"),e;if(f.length>1&&f[f.length-2].slice(-1)!=="//"){f.splice(-1,1);}e=f.join(";");return e.replace(/\\:/g,"*:").replace(/\\;/g,";").replace(/\\\\/g,"\\").substring(1);}function A(q,e,m,h,d){var l=m.es,f=m.id,k;d.forEach(function(r){k=r[0];if(k.eid.indexOf(f)<0){l.push({n:C.decodeHtmlString(k.v,true),t:mstrmojo.vi.enums.EnumDerivedElementType.LIST,v:X(k.eid)});}});var g=q.controller,p=q.model&&q.model.docModel,o=g._getXtabCallback(q),j={act:"applyDEChanges",deId:e.did,attId:e.attId,attName:e.attName,dsId:e.dsId,k:q&&q.k,actions:[V(m,h)]};p.addUpdateObjects(j,{id:j.deId||j.attId,type:47,flag:G.PARTIAL_UPDATE_FLAGS.DATA_CHANGE});o=mstrmojo.func.wrapMethods(o,p.getDatasetsUpdateCallback(),p.getUpdateHiddenLayoutsCallback(),{success:function(){p.callOnNDECreated([m]);}});var n=function(r){return function(){if(j&&r){j.partialRetrieval={nodes:Y(q,p,e)};}var s=r?p.wrapUnsetVisualizationFilterAction(j):j;g.submitUndoRedoUpdates(s,{},o,G.REQUEST_DEFN_DATA);};};p.checkAndNotifyVFChangeOnGroupUpdate({actions:j},n(true),n(false));}function V(e,d){return{act:"update",position:d+1,item:e};}function E(f,e,j,h,g){var d=f.model.getCellTitleInfo(e).title;f.controller.onSetDEHierachyOptions(f,{act:"setDEHierarchyOptions",oId:d.id,eId:j.id,splice:h,expand:g});}function O(h,e){var d=[],g=e.t,f=e.did;h.getDropZones().zones.forEach(function(j){((j&&j.items)||[]).forEach(function(l){var m=l.t,k=l.did;if(m!==21&&k!=="-1"&&k!=="00000000000000000000000000000000"&&((m===4&&g===4)||(m!==4&&g!==4))&&k!==f&&L.find(d,"did",k)===-1){d.push(l);}});});h.docModel.getDatasetUnits(g===4?["mx"]:["att"]).forEach(function(j){if(L.find(d,"did",j.did)===-1&&j.did!==f&&!j.hide){d.push(j);}});return mstrmojo.vi.ui.DatasetUnitMenuUtils.getSortedDatasetUnits(d);}function Y(g,d,f){var e=d.getSourceFilterKeys(g.zonesModel.getHost().k);L.forEach(g.parent.parent.children,function(k){var h=k.boxContent.gridInfo;if(h){var l=(h.rows.concat(h.cols)).some(function(m){return m.did===f.did;}),j=e.some(function(m){return m===k.k;});if(l&&!j){e.push(k.k);}}});return e;}mstrmojo.vi.ui.rw._XtabDE=mstrmojo.provide("mstrmojo.vi.ui.rw._XtabDE",{scriptClass:"mstrmojo.vi.ui.rw._XtabDE",derivedElementGroup:function M(d){D(this,d,-1);},addElementsToGroup:function N(f,g,e,d){A(this,f,g,e,d);},derivedElementCalculation:function B(e,d){D(this,e,d);},separateOthers:function Q(d,e){E(this,d,e,1,1);},renameDEList:function I(d){this.controller.onEditQuickDEList(this,P.copy(K(this,d,true,-1),{act:"editQuickDEList",deName:d.v}));},editQuickDECalculationNumberFormat:function J(e,f){var d=K(this,e);d.deId=f.de.id;d.act="editQuickDECalculationNumberFormat";this.controller.editQuickDECalculationNumberFormat(this,P.copy(d,this.model.docModel.createNumberFormatParams(f)));},editDECalculation:function H(e,d){if(d!==undefined&&d!==null){this.controller.editQuickDECalculation(this,P.copy(K(this,e,true,d),{act:"editQuickDECalculation"}));}else{this.controller.onEditQuickDECalculation(this,P.copy(K(this,e,true),{act:"editQuickDECalculation",deName:e.v}));}},createDEParam:function K(d,f,e){return K(this,d,f,e);},removeQuickDE:function S(l,p){var h=p&&p.deObject,j=(h&&h.des)||[],q=this,r=2,o=L.filter(j,function(t){return !t.ido;},{max:r+1});if(h&&(j.length<=r||o.length<=r)){var k=[],n=this.zonesModel.getZoneForObject(h.did),f=O(this.zonesModel,h),e=L.find(f,"did",h.attId),d=e>=0?f[e]:null,m={};if(d&&n){k.push(P.copy({isUngroup:1,deId:h.did},this.model.getAddTemplateUnitAction(d,h.dsId,n.id,L.find(n.items,"did",h.did))));k=[this.zonesModel.getUpdateTemplateAction(k)];m=this.controller._getXtabCallback(this);}k.push({act:"removeNDEFromDS",dsid:h.dsId,oid:h.did,disablePU:true});m=mstrmojo.func.wrapMethods(this.controller.model.getDatasetsUpdateCallback(),this.controller.model.getReloadLayoutModelCallback(),m,this.controller.getReloadLayoutViewCallback());var s=q.model&&q.model.docModel;var g=function(t){return function(){var u=(t&&s)?s.wrapUnsetVisualizationFilterAction(k):k;q.controller.submitUndoRedoUpdates(u,null,m,G.REQUEST_DEFN_DATA);};};s&&s.checkAndNotifyVFChangeOnGroupUpdate({actions:k,zm:s},g(true),g(false));}else{this.controller.removeQuickDE(this,P.copy(K(this,l),{act:"removeQuickDE"}));}},derivedElementsEdit:function U(m,g){if(!g){g=this.getDEInfo(m);}var h=this.model,e=h.getCellTitleInfo(m).title,f=g&&g.deObject,l=g&&g.de,d,k,j;if(!f){d=this.gridData.datasetId||Z(h.docModel.datasets,e.id);k=e.id;j=e.n?C.decodeHtmlString(e.n):undefined;}this.controller.openDEEditor(this,{dsId:d,attId:k,attName:j,deObj:f,elemId:l&&l.id,dispName:m.n?C.decodeHtmlString(m.n):j});},getDEInfo:function W(m){var g=this.model,j=g.getCellTitleInfo(m),k=j.isSrcTitle,e=j.title,d=m.dei,f,l;if((e&&e.ost!==12033)||(k&&m.otp!==b.Consolidation)){return null;}var h=(e&&e.id)||(k&&m.otp===b.Consolidation&&m.id);f=g.docModel.getDEObject(h);if(f&&d!==undefined){l=f.des[d];}return{deObject:f,de:l,ttl:e};},getOthersDEInfo:function R(e){var d;L.forEach(e.des,function(f){if(f.t===4){d=f;return false;}});return d;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.DocDataService","mstrmojo.vi.controllers.UICmd");var H=mstrmojo.hash.copy,U=mstrmojo.array.forEach,F=mstrmojo.vi.controllers.UICmd;var O=2,E=1,N=F.CMD_ACT_TYPE.UNDO,G=F.CMD_ACT_TYPE.EXEC,A=F.CMD_ACT_TYPE.REDO;var V=F.CMD_PHASE;var S=F.CMD_STATE;function B(){U(this._delayRemovedCmds,function(d){d.discard();});this._delayRemovedCmds=null;}function D(){this.cmds=this.cmds.concat(this._delayRemovedCmds);this._delayRemovedCmds=null;}function M(e){var d=this.cmds,f=this.pos;this._delayRemovedCmds=d.splice(f+1);if(f>=this.size-1){d.shift().discard();}d.push(e);this.pos=d.length-1;}mstrmojo.vi.controllers.UICmdMgr=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.controllers.UICmdMgr",cmds:null,pos:-1,size:20,_delayRemovedCmds:null,controller:null,dataService:null,model:null,state:E,CMD_PHASE:V,init:function W(d){H(d,this);this.cmds=[];},execute:function J(g){if(this.state===O){this.handleError();}try{g=H(g,{mgr:this,undoUIState:this.model.getUIState(),action:G});var d=this.curCmd=new F(g);M.call(this,d);this.state=O;d.execute();}catch(f){this.reset();throw f;}},getInterimCmd:function R(){if(this.state===O){var d=this.cmds[this.pos];if(d&&d.state===S.INTERIM){return d;}}return null;},undo:function b(g){if(this.canUndo()){this.state=O;try{var d=this.curCmd=this.cmds[this.pos--];d.action=N;d.redoUIState=this.model.getUIState();d.undoRedo(g);}catch(f){this.reset();throw f;}}},redo:function P(){if(this.canRedo()){this.state=O;try{var d=this.curCmd=this.cmds[++this.pos];d.action=A;d.undoUIState=this.model.getUIState();d.undoRedo();}catch(f){this.reset();throw f;}}},onSuccess:function I(d){if(this.state===E){this.handleError();}if(d!==this.curCmd){this.handleError("Wrong command");}this.state=E;B.call(this);this.controller.onCmdMgrChanged();},onFailure:function Y(){B.call(this);this.reset();},onCancel:function L(e,f){this.state=E;var d=!!e.submitCount;if(d){this.undo(f);}else{this.pos--;}this.cmds.pop();e.discard();if(d){B.call(this);}else{D.call(this);}this.controller.onCmdMgrChanged();},untrackLastCmd:function a(){var d=this.cmds.pop();d.discard();this.pos--;this.controller.onCmdMgrChanged();},reset:function a(){U(this.cmds,function(d){d.discard();});this.cmds.length=0;this.pos=-1;this.state=E;this.controller.onCmdMgrChanged();},resetState:function X(){this.state=E;},canUndo:function c(){return this.state===E&&this.pos>=0;},canRedo:function Q(){return this.state===E&&this.pos<this.cmds.length-1;},onSubmitUpdates:function Z(){if(this.state===E){this.cmds.splice(this.pos+1);this.controller.onCmdMgrChanged();}},isUndoRedo:function C(){var d=this.curCmd||{};return(this.state===O&&(d.action===N||d.action===A));},handleError:function K(d){this.reset();throw new Error(d||"Invalid state.");}});mstrmojo.vi.controllers.UICmdMgr.STATES={BUSY:O,IDLE:E};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.PanelFormatSaver");mstrmojo.vi.ui._IsViPanel=mstrmojo.provide("mstrmojo.vi.ui._IsViPanel",{_mixinName:"mstrmojo.vi.ui._IsViPanel",getPanelSaver:function A(){return null;},setOpenStatus:function D(F,E,I,H){if(this.visible!==F){this.set("visible",F);if(!H){this.resetLayout(H);}if(!E){var G=this.getPanelSaver();if(G){G.saveProperty("visible",F);}}mstrApp.rootCtrl.generateToolbar();}},getOpenStatus:function C(){return !!this.visible;},resetLayout:function B(){this.height=this.width="1px";this.parent.doLayout();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListMapper");mstrmojo.ListMapperTable=mstrmojo.provide("mstrmojo.ListMapperTable",mstrmojo.hash.copy({markupPrefix:'<table class="mstrmojo-itemwrap-table">',markupSuffix:"</table>",itemWrapperPrefix:function(E){return'<tbody class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"<tr><td>&nbsp;</td></tr>",itemWrapperSuffix:"</tbody>",wrapperNodes:function D(E){return this.wrapperParentNode(E).tBodies;},wrapperParentNode:function C(E){return E.getElementsByTagName("table")[0];},createWrapperNode:function B(E){var F=E.ownerDocument,G=F.createElement("tbody");return G;},findIndex:function A(G,J,I){if(J&&I){var F=G.domNode,E=this.wrapperParentNode(J),H=I.parentNode;while(H){if(H===E){return mstrmojo.array.findBin(this.wrapperNodes(J),I,"offsetTop",G.items&&G.items.length);}else{if(H===F){break;}}I=H;H=I.parentNode;}}return -1;}},mstrmojo.hash.copy(mstrmojo.ListMapper)));mstrmojo.requiresCls("mstrmojo.WidgetListMapper");mstrmojo.WidgetListMapperTable=mstrmojo.provide("mstrmojo.WidgetListMapperTable",mstrmojo.mixin(mstrmojo._hasWidgetListMapper,mstrmojo.hash.copy(mstrmojo.ListMapperTable)));})();(function(){mstrmojo.requiresCls("mstrmojo.ui.Checkbox");var A={ROUND:"round",RECT:""};mstrmojo.ui.ToggleButton=mstrmojo.declare(mstrmojo.ui.Checkbox,null,{scriptClass:"mstrmojo.ui.ToggleButton",markupString:'<div id="{@id}" class="mstrmojo-ui-ToggleButton {@cssClass}" mstrAttach:click><div class="container"><div class="slider {@sliderStyle}"></div></div></div>',sliderStyle:A.ROUND});mstrmojo.ui.ToggleButton.EnumStyle=A;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo._ContainsDocObjects","mstrmojo._HasBuilder");mstrmojo.rw.DocSubsection=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._ContainsDocObjects,mstrmojo._HasBuilder],{scriptClass:"mstrmojo.rw.DocSubsection",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocSubsection" style="{@domNodeCssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},formatHandlers:{domNode:["D","B","background-color","fx"]},update:function C(E){var D=E.data.tid;if(this.thresholdId||D){delete this.fmts;}this.thresholdId=D;if(this._super){this._super(E);}},postBuildRendering:function B(){return(this.renderMode!=="scroll")?this._super():true;},childRenderOnAddCheck:function A(D){return(this.renderMode!=="scroll")?this._super(D):false;},preserveChildDomOrder:false,performCanGrowCanShrink:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Container","mstrmojo._FormatDefinition","mstrmojo.CheckBox","mstrmojo.array");var E=mstrmojo.hash,A=mstrmojo._FormatDefinition,F=mstrmojo.array;var D=function(G){return mstrmojo.hash.copy(G,{scriptClass:"mstrmojo.TextBox",alias:"decimalPlaces",bindings:{m:G.modelBinding,value:function(){return this.m.DecimalPlaces||"2";},category:function(){var H=this.m.Category;this.onkeyup();}},onkeyup:function(H){if(/^\d{1,2}$/.test(this.value)){var O=this.m.DecimalPlaces,J=this.value;this.m.DecimalPlaces=J;if(O!=J&&this.negative){var K=this.parent[this.negative],M;if(K&&K.refreshFormatList){K.refreshFormatList();}else{M=mstrmojo.hash.clone(A[this.negative]);if(M){var N=J>0?".":"",I=N,L;for(L=0;L<Math.min(J,A.MaxNegativeDidigts);L++){N+=L%9;I+="0";}for(L=0;L<M.length;L++){M[L].n=M[L].n.replace(/\.\d{2}/g,N);M[L].f=M[L].f.replace(/\.\d{2}/g,I);}K.set("items",M);}}}}}});},B=function(G){return mstrmojo.hash.copy(G,{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList",itemMarkupFunction:function(J,H,K){var I=J.r?"color: red":"";return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text" style="'+I+'">'+J.n+"</div></div>";},selectionPolicy:"reselect",bindings:{m:G.modelBinding,selectedIndex:function(){var H=F.find(this.items,"v",this.m.NegativeNumbers);if(H===-1){H=F.find(this.items,"f",this.m.Format);}this.singleSelect(H);return H==-1?3:H;},category:function(){var H=this.m.Category;this.onchange();}},onchange:function(H){if(this.parent.idx===F.find(A.Category,"v",this.m.Category)&&this.selectedItem){this.m.NegativeNumbers=this.selectedItem.v;this.m.set("Format",this.selectedItem.f||this.selectedItem.v);}},onmChange:function(H){if(this.m){var M=this.m.DecimalPlaces;if(M!=2){var K=mstrmojo.hash.clone(A[this.alias]);if(K){var L=M>0?".":"",I=L,J;for(J=0;J<Math.min(M,A.MaxNegativeDidigts);J++){L+=J%9;I+="0";}for(J=0;J<K.length;J++){K[J].n=K[J].n.replace(/\.\d{2}/g,L);K[J].f=K[J].f.replace(/\.\d{2}/g,I);}this.set("items",K);}}}},postCreate:function(){this.onmChange();}});},C=function(G){return mstrmojo.hash.copy(G,{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList "+G.alias,itemMarkupFunction:function(I,H,J){return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">'+I.n+"</div></div>";},selectedIndex:0,bindings:{m:G.modelBinding,selectedIndex:function(I){var H=F.find(this.items,"v",this.m.Format);return H===-1?0:H;},category:function(){var H=this.m.Category;this.onchange();}},onchange:function(H){if(this.parent.idx===F.find(A.Category,"v",this.m.Category)){this.m.set("Format",this.selectedItem.f||this.selectedItem.v);}}});};mstrmojo.NumberFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.NumberFormatter",cssClass:"mstrmojo-NumberFormatter",markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){E.make(this.model,mstrmojo.Obj);}},children:[{scriptClass:"mstrmojo.Table",layout:[{cells:[{colSpan:2}]},{cells:[{},{}]}],children:[{slot:"0,0",scriptClass:"mstrmojo.Label",text:mstrmojo.desc(7940),cssClass:"category",cssText:"font-weight: bold"},{slot:"1,0",scriptClass:"mstrmojo.List",alias:"numberCategory",cssClass:"mstrmojo-FormatEditor-numberCategory",items:A.Category,selectionPolicy:"reselect",bindings:{m:"this.parent.parent.model",selectedIndex:function(){var H=this.m.Category,G=F.find(this.items,"v",(H==="pru"?-2:H));return(G===-1)?0:G;}},onchange:function(G){if(this.m){this.m.set("Category",this.selectedIndex===0?"pru":this.selectedItem.v);}}},{slot:"1,1",scriptClass:"mstrmojo.Container",alias:"numberSubpanelContainer",width:"300px",markupString:'<div id={@id} class="mstrmojo-FormatEditor-numberPanel-subpanel {@cssClass}"><div class="mstrmojo-FormatEditor-numberPanel-subpanel-container"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},postBuildRendering:function(){var G=mstrmojo.Container.prototype.postBuildRendering.apply(this);this.parent.numberCategory.singleSelect(this.parent.numberCategory.selectedIndex);return G;},children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item",idx:0,rows:1,cols:1,children:[{scriptClass:"mstrmojo.Label",text:" ",slot:"0,0"}],bindings:{visible:'this.parent.parent.parent.model.Category=="pru"',category:function(){var H=this.parent.parent.parent.model,G=this.parent.parent.parent.model.Category;if(H&&this.idx===F.find(A.Category,"v",G)){H.set("Format","");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item",idx:1,rows:1,cols:1,children:[{scriptClass:"mstrmojo.Label",text:" ",slot:"0,0"}],bindings:{visible:"this.parent.parent.parent.model.Category==9",category:function(){var H=this.parent.parent.parent.model,G=this.parent.parent.parent.model.Category;if(H&&this.idx===F.find(A.Category,"v",G)){H.set("Format","");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item fixed",idx:2,rows:3,cols:2,layout:[{cells:[{},{}]},{cells:[{},{}]},{cells:[{colSpan:2}]}],bindings:{visible:"this.parent.parent.parent.model.Category==0"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},D({modelBinding:"this.parent.parent.parent.parent.model",negative:"FixedNegative",alias:"FixedDecimalPlaces",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044),slot:"1,0"},B({modelBinding:"this.parent.parent.parent.parent.model",items:A.FixedNegative,refreshFormatList:function(){var H=this.parent,K=H&&H.FixedDecimalPlaces,N=H&&H.ThousandSeparator;if(!K||!N){return ;}var I=K.value||0,R=mstrmojo.hash.clone(A.FixedNegative),G=N.checked,Q=I>0?".":"",P=Q,O,M,L;for(M=0,L=Math.min(I,A.MaxNegativeDidigts);M<L;M++){Q+=M%9;P+="0";}var J;for(J=0;J<R.length;J++){O=R[J].n.replace(/\.\d{2}/g,Q);if(!G){O=O.replace("1,234","1234");}R[J].n=O;O=R[J].f.replace(/\.\d{2}/g,P);if(!G){O=O.replace(/#,##/g,"###");}R[J].f=O;}this.set("items",R);},alias:"FixedNegative",slot:"1,1"}),{scriptClass:"mstrmojo.ImageCheckBox",alias:"ThousandSeparator",label:mstrmojo.desc(2049),cssText:"width:auto;",bindings:{m:"this.parent.parent.parent.parent.model",checked:function(){var G=this.m.ThousandSeparator;if(G==null){G=-1;}return parseInt(G,10)!==0;}},oncheckedChange:function(){if(this.m&&this.parent.idx===F.find(A.Category,"v",this.m.Category)){this.m.ThousandSeparator=this.checked?-1:0;this.parent.FixedNegative.refreshFormatList();}},slot:"2,0"}]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item currency",idx:3,rows:4,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==1"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},D({modelBinding:"this.parent.parent.parent.parent.model",negative:"CurrencyNegative",alias:"currencyDecimal",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2047),slot:"1,0"},{scriptClass:"mstrmojo.TextBox",alias:"currencySymbol",maxLength:5,bindings:{m:"this.parent.parent.parent.parent.model",value:function(){return this.m.CurrencySymbol||mstrmojo.desc("2369");},category:function(){var G=this.m.Category;this.onkeyup();}},onkeyup:function(G){this._update();},onvalueChange:function(){this._update();},_update:function(){if(this.m){var H=this.m.CurrencySymbol;this.m.CurrencySymbol=this.value;var G=this.parent.CurrencyNegative;if(G&&(H!=this.value)){G.refreshFormatList();}}},slot:"1,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2048),slot:"2,0"},{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-numberFormatList",alias:"CurrencyPosition",items:A.CurrencyPosition,itemMarkupFunction:function(H,G,I){return'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">'+H.n+"</div></div>";},bindings:{m:"this.parent.parent.parent.parent.model",selectedIndex:function(){var G=F.find(A.CurrencyPosition,"v",this.m.CurrencyPosition);return(G===-1?0:G);},category:function(){var G=this.m.Category;this.onchange();}},onchange:function(G){if(this.m){this.m.CurrencyPosition=this.selectedItem.v;var H=this.parent.CurrencyNegative;if(H){H.refreshFormatList();}}},slot:"2,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044),slot:"3,0"},B({modelBinding:"this.parent.parent.parent.parent.model",items:A.CurrencyNegative,refreshFormatList:function(){var O=this.parent,J=O&&O.currencyDecimal,N=O&&O.CurrencyPosition,K=O&&O.currencySymbol;if(!J||!N||!K){return ;}var M=J.value||0,I=parseInt(N.selectedIndex,10)||0,H=K.value||"",L=mstrmojo.hash.clone(A.CurrencyNegative),Z=M>0?".":"",X=Z,Q,Y,V;H=(I===2?H+" ":(I===3?" "+H:H));for(Y=0,V=Math.min(M,A.MaxNegativeDidigts);Y<V;Y++){Z+=Y%9;X+="0";}var P=mstrConfig.decimalSep,G=mstrConfig.thousandsSep,U;for(U=0;U<L.length;U++){var R=L[U].n,W=L[U].f,S;if(I===1||I===3){Q=W.split(";");for(S=0,V=Q.length;S<V;S++){Q[S]=Q[S].replace(/(\"\$\")(.*)/g,"$2$1");}R=R.replace(/(\$)(.*)/g,"$2$1");W=Q.join(";");}R=R.replace(/\$/g,H).replace(/\.\d{2}/g,Z);W=W.replace(/\$/g,H).replace(/\.\d{2}/g,X);L[U].n=R.replace(/,/,G).replace(/(\d{2,3})\./,"$1"+P);L[U].f=W.replace(/,/,G).replace(/(\d{2,3})\./,"$1"+P);}this.set("items",L);},alias:"CurrencyNegative",slot:"3,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Date",idx:4,rows:1,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==2"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},C({modelBinding:"this.parent.parent.parent.parent.model",items:A.Date,alias:"Date",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Time",idx:5,rows:1,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==3"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},C({modelBinding:"this.parent.parent.parent.parent.model",items:A.Time,alias:"Time",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item percentage",idx:6,rows:2,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==4"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},D({modelBinding:"this.parent.parent.parent.parent.model",negative:"PercentNegative",slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2044,"Negative numbers"),slot:"1,0"},B({modelBinding:"this.parent.parent.parent.parent.model",items:A.PercentNegative,alias:"PercentNegative",slot:"1,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item Fraction",idx:7,rows:1,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==5"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2869),slot:"0,0"},C({modelBinding:"this.parent.parent.parent.parent.model",items:A.Fraction,alias:"Fraction",slot:"0,1"})]},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item scientific",idx:8,rows:1,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2046),slot:"0,0"},D({slot:"0,1",modelBinding:"this.parent.parent.parent.parent.model"})],bindings:{m:"this.parent.parent.parent.model",visible:"this.m.Category==6",category:function(){if(this.m&&this.idx===F.find(A.Category,"v",this.m.Category)){this.m.set("Format","0.00E+00");}}}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-FormatEditor-numberPanel-subpanel-item custom",idx:9,rows:1,cols:2,bindings:{visible:"this.parent.parent.parent.model.Category==7"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2133),slot:"0,0"},{scriptClass:"mstrmojo.TextBox",alias:"custom",value:"",bindings:{m:"this.parent.parent.parent.parent.model",value:function(){return this.m.Format;}},onvalueChange:function(){if(this.m&&this.parent.idx===F.find(A.Category,"v",this.m.Category)){this.m.Format=this.value;}},slot:"0,1"}]}]}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");var A=mstrmojo.Widget;mstrmojo.Box=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:A.visibleMarkupMethod,onheightChange:A.heightMarkupMethod,onwidthChange:A.widthMarkupMethod}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.requiresDescs(11668,15187,15188,15189,15190);function B(L,K,I){var J=K,H;for(;J>0;J--){H=Array(J+1).join("#");L=L.replace(H,I[J-1]);}return L;}var C='<div class="ghost-vis-txt-metric">',A='<div class="ghost-vis-txt-attr">',E='<div class="ghost-vis-txt-attr-time">',G="</div>";var D={grid:B(mstrmojo.desc(15187,"Add # or more ##attributes### and/or #### or more #####metrics######"),6,[1,A,G,1,C,G]),heatmap:B(mstrmojo.desc(15187,"Add # or more ##attributes### and/or #### or more #####metrics######"),6,[1,A,G,1,C,G]),barchart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),linechart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),areachart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),bubblechart:B(mstrmojo.desc(15190,"Add # or more ##metrics### and #### or more #####attributes######"),6,[2,C,G,1,A,G]),piechart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),combochart:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,2,C,G]),network:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[2,A,G,1,C,G]),histogram:B(mstrmojo.desc(15667,"Add # or more ##attributes### and ####  #####metric######"),6,[1,A,G,1,C,G]),boxplot:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),waterfall:B(mstrmojo.desc(15188,"Add # or more ##attributes### and #### or more #####metrics######"),6,[1,A,G,1,C,G]),kpicard:B(mstrmojo.desc(15878,"Add # or more ##attributes### and #### #####metric######"),6,[1,A,G,1,C,G])};function F(H){return D[H]?D[H]:mstrmojo.desc(11668,"Drag objects here.");}mstrmojo.vi.ui.rw.GhostImageContainer=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.vi.ui.rw.GhostImageContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-rw-GhostImageContainer {@cssClass}"><div class="mstmojo-ghostImgTableCell"><div class="mstrmojo-ghostImgDiv"><div class="ghost-vis-img"></div><div class="ghost-vis-name">{@visName}</div><div class="ghost-vis-desc">{@visDesc}</div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;}},visName:"",visDesc:""});mstrmojo.vi.ui.rw.GhostImageContainer.getVisDesc=F;}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var B=mstrmojo.func,D=mstrmojo.dom,C=mstrmojo.ui._HasUITheme.EnumThemeNames,G="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function J(N){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);}this._super(N);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function E(){var N=this.getPopupWidget();if(!N||N._pbCfg){return ;}var O=function O(Q,P){return function(){Q.apply(P,arguments);};};N.onOpen=B.composite([O(this.onPopupWidgetOpened,this),N.onOpen||mstrmojo.emptyFn]);N.onClose=B.composite([O(this.onPopupWidgetClosed,this),N.onClose||mstrmojo.emptyFn]);N._pbCfg=true;},onclick:function L(N){if(this.isClickingAnchorSlot(N)){var O=this.getPopupWidget();if(!O.visible){this.openPopup(O);}else{this.closePopup();}}},isClickingAnchorSlot:function M(N){var O=N.getTarget();return O===this[this.anchorSlot]||O.parentNode===this[this.anchorSlot];},onPopupAutoClosed:function I(O,N){if(D.contains(this[this.anchorSlot],D.eventTarget(N,O),true)){return false;}},getPopupHostNode:function K(){return this.containerNode;},getPopupConfig:function H(){var O=[G],N=this.hostedCSSClass;if(N){O.push(N);}var P=new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:O.join(" ")});return this.disposables?this.addDisposable(P):P;},unrender:function F(N){if(this._listenerProc){D.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(N);},postBuildRendering:function A(){var R=this.getPopupWidget();if(R){var U=this.getPopupConfig();if(!U.isHostedWithin){var P=this.parent||this.opener,O=U.hostProxyCssClass.split(" ");O.push(this.domNode.className);while(P){var S=P.themeClassName;if(S){O.push(S);break;}P=P.parent||P.opener;}if(U.useDarkTheme){O.splice(O.indexOf(C.LIGHT_THEME),1);O.push(C.DARK_THEME);}U.hostProxyCssClass=O.join(" ");}mstrmojo.Obj.free(R.popupConfig);R.popupConfig=R.addDisposable(U);}if(!(this.editableSlot&&D.isMobile)){var N=R.id,Q=this._listenerProc=function(){var V=mstrmojo.all[N];if(V&&V.visible&&V.adjustCornersForPopupOverflow){V.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){D.attachEvent(window,"resize",Q);}}return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout");var D=' style="display:inline-block;vertical-align:middle;"';mstrmojo.ui.editors.controls.ThreeColumnContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.ThreeColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-ThreeColumnProp {@cssClass}" style="{@cssText}"><div class="vi-col1"'+D+'></div><div class="divider1"'+D+'></div><div class="vi-col2"'+D+'></div><div class="divider2"'+D+'></div><div class="vi-col3"'+D+"></div></div>",markupSlots:{col1Node:function C(){return this.domNode.firstChild;},divider1Node:function H(){return this.domNode.childNodes[1];},col2Node:function A(){return this.domNode.childNodes[2];},divider2Node:function B(){return this.domNode.childNodes[3];},col3Node:function E(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod},layoutConfig:{w:{col1Node:"30%",divider1Node:"5px",col2Node:"30%",divider2Node:"5px",col3Node:"40%"},xt:true},shouldPropagateEnabled:true,col1Width:"30%",divider1Width:"5px",col2Width:"30%",divider2Width:"5px",col3Width:"40%",init:function G(I){this._super(I);var J=this.layoutConfig=JSON.parse(JSON.stringify(this.layoutConfig)),K=J.w;K.col1Node=this.col1Width;K.divider1Node=this.divider1Width;K.col2Node=this.col2Width;K.divider2Node=this.divider2Width;K.col3Node=this.col3Width;},getControl:function F(I){return(this.children||[]).filter(function(J){return J.slot==="col"+I+"Node";})[0];}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var E=function(){var G=this.opener;if(G.direction.toLowerCase()==="up"){this.domNode.style.top=-G.domNode.offsetHeight+"px";}};mstrmojo.DropDownButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DropDownButton",height:"",text:"",direction:"down",enabled:true,title:"",allowHTML:true,markupString:'<div id="{@id}" class="mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode">{@text}</div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.firstChild.firstChild;},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onheightChange:function(){this.boxNode.style.height=this.height||"";},ontextChange:function(){this.iconNode.innerHTML=this.getTextInnerHTML();},ontitleChange:function(){this.boxNode.title=this.title;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},preBuildRendering:function C(){if(this._super){this._super();}var G=this.popupRef;if(G){if(G.nudge){G.nudge=mstrmojo.func.composite([G.nudge,E]);}else{if(this.direction.toLowerCase()!=="down"){G.nudge=E;}}}},popupRef:null,popupOpenConfig:null,destroy:function D(G){var H=this.popupRef;if(H&&H.hasRendered){H.destroy(false);}if(this._super){this._super(G);}},togglePopup:function F(){var G=this._lastOpened;if(G&&G.visible){this.closePopup();}else{this.openPopup("popupRef",this.popupOpenConfig);}},premousedown:function A(G){this.togglePopup();},getTextInnerHTML:function B(){return this.allowHTML?this.text:mstrmojo.string.encodeHtmlString(this.text);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo._CanRenderChildrenOnShow");var A=mstrmojo.array;mstrmojo.StackContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._CanRenderChildrenOnShow],{scriptClass:"mstrmojo.StackContainer",isStack:true,markupString:'<div id="{@id}" class="mstrmojo-StackContainer {@cssClass}" style="{@cssText}"></div>',markupMethods:{onwidthChange:function(){if(!isNaN(parseInt(this.width))){this.domNode.style.width=this.width;}},onheightChange:function(){if(!isNaN(parseInt(this.height))){this.domNode.style.height=this.height;}},onborderChange:function(){this.domNode.style.border=this.border||"";},onbackgroundChange:function(){this.domNode.style.background=this.background||"";}},markupSlots:{containerNode:function(){return this.domNode;}},_set_selected:function D(H,F){var G=this.selected;if(G===F){return false;}if(G){G.set("visible",false);}this.selected=F;if(F){F.set("visible",true);}return true;},addChildren:function B(J,G,H){var K=this.selected,L;for(var I=0,F=(J&&J.length)||0;I<F;I++){L=J[I];if(L&&L.set){L.set("visible",L===K);}}return this._super(J,G,H);},removeChildren:function C(H,F){var G=this._super(H,F);if(!H||(H===this.selected)){this.set("selected",null);}return G;},destroy:function E(F){this._super(F);this.selected=null;},renderMode:"onshow"});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui._HasScroller");var D=mstrmojo.Widget;mstrmojo.ui.ScrollableContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableContainer",markupString:'<div id="{@id}" class="mstrmojo-ui-ScrollableContainer {@cssClass}" style="{@cssText}"><div class="ScrollableContainer-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onheightChange:D.heightMarkupMethod,onwidthChange:D.widthMarkupMethod},setupScrollNodes:function C(){this.scrollNode=this.containerNode;},onOpen:function B(){this.updateScrollbars();}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");var D="slot";mstrmojo.HBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.HBox",cellCssClass:"",cellSpacing:0,cellPadding:0,markupString:'<table id="{@id}" class="mstrmojo-HBox {@cssClass}" style="{@cssText}" cellspacing="{@cellSpacing}" cellpadding="{@cellPadding}">{@colHTML}<tr>{@tableHtml}</tr></table>',colHTML:"",markupSlots:{containerNode:function(){return this.domNode.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildRendering:function B(){this.tableHtml="";var N=[],F=this.children,K=(F&&F.length)||0,I;if(K){var G=0,J=this.cellCssClass?' class="mstrmojo-HBox-cell '+this.cellCssClass+'" ':"",M="<td "+J+"></td>";for(I=0;I<K;I++){N[G++]=M;F[I].slot=D+I;}this.tableHtml=N.join("");}this._super();if(K){var L={},H=this.containerNode.cells;for(I=0;I<K;I++){L["slot"+I]=H[I];}this.addSlots(L);}},addChildren:function E(K,F,G){if(!K){return K;}if(F===undefined||isNaN(F)||F<0){var J=this.children;F=(J&&J.length)||0;}var I=0,H;if(K.constructor===Array){for(I=0,H=K.length;I<H;I++){K[I].slot=D+(F+I);}}else{K.slot=D+F;}return this._super(K,F,G);},childRenderCheck:function C(G){if(G&&!G.hasRendered){var F=G.slot||this.defaultChildSlot;return !!this[F]||F.match(/^slot[\d]+$/);}return false;},onchildRenderingChange:function A(I){var F=(I&&I.src)||I,L=F&&F.domNode;if(L){var Q=F.slot;if(!this[Q]){var J=Q&&Q.match(/^slot([\d]+)$/);if(J){var O=parseInt(J[1],10),N=this.containerNode,P=N.cells,M=(P&&P.length)||0,K={};for(var H=M;H<=O;H++){var G=N.insertCell(H);K["slot"+H]=G;if(this.cellCssClass){G.className=this.cellCssClass;}}this.addSlots(K);}}}this._super(I);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css");var F="",B="row-",E=mstrmojo.css.DISPLAY_TABLE;mstrmojo.Table=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Table",cellCssClass:"",rows:-1,cols:-1,_trows:-1,cellPadding:0,cellSpacing:0,layout:null,markupString:'<table id="{@id}" class="mstrmojo-Table {@cssClass}" style="{@cssText}" cellpadding="{@cellPadding}" cellspacing="{@cellSpacing}">{@tableHtml}</table>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?E:"none";}},preBuildRendering:function G(){var I=[],P=this.cellCssClass;if(this.layout){var Q=this._trows=this.layout.length;for(var K=0;K<Q;K++){var H=this.layout[K],R=H.cells,O=R.length,L=[];for(var J=0;J<O;J++){var N=R[J],M="";M+=((N.cssClass||P)?' class="'+(N.cssClass||P)+'"':"");M+=(N.cssText?' style="'+N.cssText+'"':"");M+=(N.rowSpan?' rowspan="'+N.rowSpan+'"':"");M+=(N.colSpan?' colspan="'+N.colSpan+'"':"");L[J]="<td"+M+"></td>";}var S="";S+=(H.cssClass?' class="'+H.cssClass+'"':"");S+=(H.cssText?' style="'+H.cssText+'"':"");I[K]="<tr"+S+">"+L.join("")+"</tr>";}}else{this._trows=this.rows;var M=(P?' class="'+P+'"':""),L=[];for(var K=0;K<this.rows;K++){for(var J=0;J<this.cols;J++){L[J]="<td"+M+"></td>";}I[K]="<tr>"+L.join("")+"</tr>";}}this.tableHtml=I.join("");if(this._super){this._super();}},postBuildRendering:function C(){if(this._trows){var M={},I=this.containerNode.rows,N=I.length;for(var L=0;L<N;L++){var K=I[L].cells,H=K.length;M[B+L]=I[L];for(var J=0;J<H;J++){M[F+L+","+J]=K[J];}}this.addSlots(M);}this._super();},childRenderCheck:function D(I){if(I&&!I.hasRendered){var H=I.slot||this.defaultChildSlot;return !!this[H]||H.match(/^([\d]+),([\d]+)$/);}return false;},on_child_change_rendering:function A(L){var H=(L&&L.src)||L,O=H&&H.domNode;if(O){var V=H.slot;if(!this[V]){var M=V&&V.match(/^([\d]+),([\d]+)$/);if(M){var R=parseInt(M[1],10),W=parseInt(M[2],10),Q=this.containerNode,U=this[(B+R)],N=[];if(!U){var J=Q.rows,S=J&&J.length||0;for(var K=S;K<=R;K++){N[B+K]=Q.insertRow();}U=N[B+R];}var P=U.cells&&U.cells.length||0;for(var K=P;K<=W;K++){var I=U.insertCell(K);N[F+R+","+K]=I;if(this.cellCssClass){I.className=this.cellCssClass;}}this.addSlots(N);}}}this._super(L);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout");var D=' style="display:inline-block;vertical-align:middle;"';mstrmojo.ui.editors.controls.TwoColumnContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-TwoColumnProp {@cssClass}" style="{@cssText}"><div class="vi-col1"'+D+'></div><div class="divider"'+D+'></div><div class="vi-col2"'+D+"></div></div>",markupSlots:{col1Node:function C(){return this.domNode.firstChild;},dividerNode:function B(){return this.domNode.childNodes[1];},col2Node:function A(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod},layoutConfig:{w:{col1Node:"40%",dividerNode:"5px",col2Node:"60%"},xt:true},shouldPropagateEnabled:true,col1Width:"40%",dividerWidth:"5px",col2Width:"60%",init:function F(G){this._super(G);var H=this.layoutConfig=JSON.parse(JSON.stringify(this.layoutConfig)),I=H.w;I.col1Node=this.col1Width;I.dividerNode=this.dividerWidth;I.col2Node=this.col2Width;},getControl:function E(G){return(this.children||[]).filter(function(H){return H.slot==="col"+G+"Node";})[0];}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo.string","mstrmojo.url");var D=mstrmojo.string,E=function E(G){return G.data.dl||G.defn.dl;};mstrmojo.DocImage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.DocImage",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocImage" title="{@tooltip}" style="{@domNodeCssText}"><div style="{@shadowNodeCssText}"><img src="{@en@v}" style="{@imgNodeCssText}" mstrAttach:click></div>{@buttonNodeMarkup}</div>',markupSlots:{imgNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},update:function F(I){var J=this.model.getDataService(),G=I.data.v,H=E(I);if(I.data.v&&!((I.data.ut===4)||I.defn.oid)){G=mstrmojo.url.getFullPath(I.data.v);}this.origV=G;this.v=D.decodeXMLAttribute((J&&J.getImage&&J.getImage(G))||G);this.oid=I.defn.oid;if(H){this.tooltip=H.items[0].n;}if(this.thresholdId||I.data.tid){delete this.fmts;}this.thresholdId=I.data.tid;this.set("visible",!I.data.hidden);if(this._super){this._super(I);}},formatHandlers:{domNode:["left","top","z-index"],shadowNode:["width","height","B","fx"],imgNode:["height","width"]},preBuildRendering:function B(){this._super();if(mstrApp.isMobile&&mstrApp.useBinaryFormat){var G=this.v,I=mstrMobileApp.isOnline(),H=this.model.getDataService();if((!I&&G.indexOf("http")===0)||(I&&G.indexOf("http")!==0)){this.v=(H&&H.getDocImage&&H.getDocImage(this.origV))||G;}}if(this.node.data.ut===4&&this.v.indexOf(mstrConfig.taskURL)===-1){this.v=mstrConfig.taskURL+"?taskId=getRWEmbeddedImage&msgID="+this.model.mid+"&oid="+this.v;}this.updateDimensionsFromFormats();},updateDimensionsFromFormats:function C(){if(!mstrmojo.dom.isIE7){var G=this.getFormats(),J=(G.fx&&G.fx.ds)||0,H=mstrmojo._Formattable.getBorderWidths(this),I=1;if((mstrmojo.dom.isIE||mstrmojo.dom.isIEW3C)&&this.model.getZoomFactor){I=this.model.getZoomFactor()>1?this.model.getZoomFactor():1;H.w=Math.ceil(H.w*I);H.h=Math.ceil(H.h*I);}this.domNodeCssText+="width:"+((parseInt(G.width,10)||0)+J+H.w)+"px; height: "+((parseInt(G.height,10)||0)+J+H.h)+"px;";}},getAnchor:function A(){return this.imgNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo.Button","mstrmojo.vi._MonitorsAppState");var J=mstrmojo.array;var E=1,B=2,O=4,L=8,H=16,R=32;function K(X,W,U,V,Y,S){return mstrmojo.Button.newWebButton(X,function(Z){this.parent.set("_targetMode",W);Z.cancel();},U,{alias:V,flgVis:Y,flgEnabled:S||undefined});}mstrmojo.vi.ui.TargetSelector=mstrmojo.declare(mstrmojo.Container,[mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.TargetSelector",markupString:'<div id="{@id}" class="mstrmojo-TargetSelector {@cssClass}" style="{@cssText}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},init:function N(S){this._super(S);if(!this.hostId){throw new Error("You must pass the hostId when instantiating mstrmojo.vi.ui.TargetSelector.");}if(!this.srcId){this.srcId=this.hostId;}this.hostBox=mstrmojo.all[this.hostId];this.srcBox=mstrmojo.all[this.srcId];this._targetMode=E;},onAppStateChange:function M(S){var V=mstrmojo.vi.VisualInsightApp.APP_STATES,W=V.SELECTOR_TARGETING,U=this.btnSelect;if(S.valueWas&W||S.value&W){U.set("enabled",!mstrApp.isAppStateSelection());}},hostId:null,srcId:null,markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onhostIdChange:function(){this.hostBox=mstrmojo.all[this.hostId];},onsrcIdChange:function(){this.srcBox=mstrmojo.all[this.srcId];},on_targetModeChange:function(){var Y=this._targetMode,Z=this.hostBox,S=this.srcBox,U=this.id,c=S.model,V=c.getVizContentPanel(),b=Y===R,W=function(){this.preChangeTargetSelectionMode(false,c);V.exitTargetSelectionMode(b,this.restoreChildren.bind(this));}.bind(this);this.children.forEach(function(d){d.set("visible",(d.flgVis&Y)>0);d.set("enabled",(!d.flgEnabled||(d.flgEnabled&Y)>0));d.refresh();});this.set("visible",Y!==E);if(b||Y===B){W();if(!b){this.set("_targetMode",this._cancelMode);this.cancel(Z);}this.exitTargetSelectionMode(Z);}else{if(Y===L){this.preChangeTargetSelectionMode(true,c);V.enterTargetSelectionMode(function(e,f){var d=f?E:L;if(!f&&Z.isSelectionDirty(e,f)){d=H;}mstrmojo.all[U].set("_targetMode",d);if(f){Z.setTargets(e);}},this.srcId,Z.getTargetKeys(),this.enterTargetSelectionMode.bind(this),W);}}var X=mstrmojo.vi.VisualInsightApp.APP_STATES,a=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();mstrApp.set("appState",Y===L||Y===H?(a?X.SELECTOR_TARGETING|X.PAUSE:X.SELECTOR_TARGETING):(a?X.PAUSE:X.DEFAULT));}},ignoreLayout:true,setSourceByKey:function(V){var X=this.srcBox.model.getVizContentPanel(),U=(X&&X.children)||[],S=J.find(U,"k",V),W=(S>-1)?U[S]:null;if(W){this.set("srcId",W.id);}},preChangeTargetSelectionMode:function Q(W,U){var X=U.getVizContentPanel().parent.selector,V=U.controller.view,S=V.layoutViewer.docLayout.selector;S.set("isMasked",W);X.set("isMasked",W);},enterTargetSelectionMode:function G(V){var U=this.srcId,S=mstrmojo.all[U].defn;V.setMaskClass(U);V.set("enabled",V.validateTarget&&V.validateTarget(S));},exitTargetSelectionMode:function D(S){S.close();},restoreChildren:function I(S){S.set("enabled",true);S.clearMaskClass();},cancel:function C(S){if(S){S.cancel();}},enterPreSelectMode:function F(){this._cancelMode=O;this.set("_targetMode",O);},enterSelectMode:function P(){this._cancelMode=E;this.set("_targetMode",L);},enterOffMode:function A(){this._cancelMode=E;this.set("_targetMode",E);},children:[K(mstrmojo.desc(4799,"Select Target"),L,true,"btnSelect",O),K(mstrmojo.desc(221,"Cancel"),B,false,"btnCancel",L+H),K(mstrmojo.desc(134,"Apply"),R,true,"btnApply",L+H,H)]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo._IsPopup","mstrmojo._CanAutoClose");var C=mstrmojo.dom;mstrmojo.ui.PopupWidget=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.PopupWidget",markupString:'<div id="{@id}" class="mstrmojo-ui-PopupWidget {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="pw-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},autoCloses:true,locksHover:true,closeOnClick:true,visible:true,onclick:function B(D){C.stopPropogation(null,D.e);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo._ContainsDocObjects","mstrmojo._HasBuilder","mstrmojo._SupportsEllipsisText","mstrmojo._HasEllipsis","mstrmojo.css","mstrmojo.array");var W=mstrmojo.css,V=mstrmojo.array;var R=2;function D(a,Y,Z){var b=a.parent.parent;if(b&&b instanceof mstrmojo.DocPanel){b[Y+"DirtyKey"](Z);}}function O(Z,Y,a){if(Z===Y.k){mstrmojo.array.forEach(Y.children,function(b){if(b.setDirtyChildren){b.setDirtyChildren(a);}});}}function I(Y){return Y._isFP()&&!Y.parent.defn.od;}mstrmojo.DocPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._ContainsDocObjects,mstrmojo._HasBuilder,mstrmojo._SupportsEllipsisText,mstrmojo._HasEllipsis,mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.DocPanel",visible:false,selected:false,k:"",cssDisplay:"block",subPanelCssText:"height:100%;width:100%;position:absolute;",topStart:R,contentWidth:0,markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocPanel {@cssClass}" style="{@cssText}{@domNodeCssText}"><div class="mstrmojo-DocSubPanel-content" style="{@containerNodeCssText}{@subPanelCssText}"></div></div>',markupMethods:{onvisibleChange:function(){var Z=this.domNode.style,Y=this.visible;if(I(this)){Z.visibility=(Y?"":"hidden");Z.zIndex=(Y?10:1);}else{Z.display=(Y?this.cssDisplay:"none");}}},markupSlots:{containerNode:function(){return this.domNode.firstChild;}},formatHandlers:{containerNode:["background-color","fx","overflow"]},title:"",init:function Q(Y){this._super(Y);if(!this.title){this.title=this.node.defn.ttl||"";}if(this._isSearchBoxPanel()){this.isSbp=true;this.set("canApplySbp",false);}},childRenderCheck:function L(Y){return(this._super(Y)&&(this.selected||I(this)));},postBuildRendering:function U(){if(!this.defn.l&&!this._forceRender){W.addClass(this.domNode,"placeholder");}var Z=this._super();if(this.isSbp){var Y=this.addChildren({scriptClass:"mstrmojo.Button",cssClass:"sbp-apply",title:mstrmojo.desc(134,"Apply"),cssText:"top:"+((parseInt(this.parent.fmts.height,10)||0)-28)/2+"px",bindings:{enabled:"this.parent.canApplySbp&&this.parent.parent.applyEnabled"},onclick:function(){this.parent.parent.applyBufferedSlices();}});Y.render();}if(this._isFSP()){this.set("shouldEllipsize",true);}if(mstrApp.isOIVM&&mstrApp.isOIVM()&&mstrmojo.dom.isChrome){var b=this.containerNode.style.overflow;this.containerNode.style.overflow="hidden";var a=this;window.setTimeout(function(){if(a.containerNode&&a.containerNode.style&&a.containerNode.style.overflow){a.containerNode.style.overflow=b;}},2000);}return Z;},onselectedChange:function M(Y){if(Y.value){this.renderChildren();}this.model&&this.model.raiseEvent({name:"panelSelected",panelId:this.id,panelVisible:!!Y.value});},updateForPU:function S(Y){this.node=Y;this.update(Y);},refreshForPU:function A(){this._isPartial=true;this.refresh();this._isPartial=false;},_isPartial:false,refresh:function E(){if(!this.hasRendered){return ;}this._inRendering=true;var a=[].concat(this.getPanelChildren()||[]),Z=[].concat(this.getChildren(this._isPartial)),Y;V.removeItems(a,"k",Z);V.removeItems(Z,"k",this.getPanelChildren());if(a.length!==0){V.forEach(a,function(b){this.removeChildren(b);b.destroy();},this);}if(Z.length!==0){V.forEach(Z,function(d){var c=d.id&&mstrmojo.all[d.id];var b=c&&c.defn;if(b){b._isDeleted=true;}if(c&&c.destroy){c.destroy();}},this);this.addChildren(this.builder.build(Z,this.model,this.buildConfig));this.builtChildren=true;}if(!this.selected){if(!this.children){this.builtChildren=false;}this._forceRender=true;this._super();delete this._forceRender;}else{a=[].concat(this.getPanelChildren()||[]);for(Y=a.length-1;Y>=0;Y--){a[Y].refresh();}}if(this._isFP()&&this.selected){this.refreshFP();}if(this._isFSP()){this.set("richTooltip",{content:this.containerNode.innerHTML,contentNodeCssClass:"sp-tooltip",left:-20,top:20,refNode:this.domNode});this.ellipsizeElements("div",this.containerNode,true);}this._inRendering=false;},setDirty:function N(Y){this[(Y?"add":"remove")+"DirtyKey"](this.k);},addDirtyKey:function H(Y){var a=this.defn,Z=a.dirtyKeys||{};Z[Y]=true;a.dirtyKeys=Z;if(Y===this.k){mstrmojo.array.forEach(this.children,function(b){if(b.setDirtyChildren){b.setDirtyChildren(true);}});}O(Y,this,true);D(this,"add",Y);},removeDirtyKey:function K(Z){D(this,"remove",Z);O(Z,this,false);if(Z===this.k){mstrmojo.array.forEach(this.children,function(b){if(b.setDirtyChildren){b.setDirtyChildren(false);}});}var a=this.defn,Y=a.dirtyKeys;if(!Y){return ;}delete Y[Z];if(!mstrmojo.hash.isEmpty(Y)){return ;}delete a.dirtyKeys;},getPanelChildren:function G(){return V.filter(this.children||[],function(Y){return Y.scriptClass!=="mstrmojo.Button";});},preBuildRendering:function(){if(this._isFSP()){this.useRichTooltip=true;}if(this._super){this._super();}},renderChildren:function J(){this._inRendering=true;var e=this.children;if(e&&(this._isFP()||this._isFSP())){V.forEach(e,function(h){h.getFormats();});}if(this.isSbp){W.addClass(this.domNode,"mstrmojo-sbp");}if(this._isFP()&&!mstrApp.isVI){W.addClass(this.parent.domNode,"fpgb");if(e){var f=this.domNode.clientWidth-2*R,d,Y;this.topStart=R+1;for(d=0,Y=(e&&e.length)||0;d<Y;d++){var a=this.domNode.clientWidth-2*R;this.contentWidth=(a>0)?a:0;if(a!==f){this.topStart=R+1;var b;for(b=0;b<d;b++){var Z=e[b];Z.refresh();if(Z.getContainerHeight){this.topStart+=Z.getContainerHeight()+R+1;}}}var g=e[d];if(this.childRenderCheck(g)){g.render(null);if(g.getContainerHeight){this.topStart+=g.getContainerHeight()+R+1;}}}}}else{this._super();}if(this._isFSP()){this.set("richTooltip",{content:this.containerNode.innerHTML,contentNodeCssClass:"sp-tooltip",left:-20,top:20,refNode:this.domNode});this.ellipsizeElements("div",this.containerNode,true);}this._inRendering=false;},refreshFP:function F(){if(!this.hasRendered){return ;}var b=this.children,Y=(b&&b.length)||0,a;this.topStart=R+1;var Z=this.domNode.clientWidth-2*R;this.contentWidth=(Z>0)?Z:0;for(a=0;a<Y;a++){var d=b[a];if(!d.hasRendered){continue;}if(d.relocate){d.relocate(this.topStart,this.contentWidth);}if(d.updateContentHeight){d.updateContentHeight();}if(d.getContainerHeight){this.topStart+=d.getContainerHeight()+R+1;}}},getChildren:function C(b){var a=this.model.getChildren(this.node,b);if(this._isFP()||this._isFSP()){var Y=(a&&a.length)||0,Z;for(Z=0;Z<Y;Z++){var d=a[Z];if(this._isFP()&&!d.defn.iifp){d.defn.iifp=true;}if(this._isFSP()&&!d.defn.iifs){d.defn.iifs=true;}}}a=V.filter(a||[],function(c){if(typeof c.defn.ifw==="boolean"){return !c.defn.ifw;}return true;});return a;},onchildRenderingChange:function B(Y){this._super(Y);if(this._isFSP()&&!this._inRendering){this.ellipsizeElements("div",this.containerNode,true);}if(this.parent.selectedKey!==this.k&&Y.gridInfo&&Y.tca===2){this.defn.l=false;}},_isFP:function X(){return !!this.parent.defn.ifp;},_isFSP:function P(){return !!this.parent.defn.ifsp;},_isSearchBoxPanel:function(){return false;},canApplySearchBoxPanel:function(){var Z=this.model.getChildren(this.node,false),Y;for(Y=0;Y<Z.length;Y++){var b=Z[Y],a=mstrmojo.all[b.id];if(a&&a.canApply&&!a.canApply()){return false;}}return true;},doEllipsize:function(){if(this.shouldEllipsize){this.ellipsizeElements("div",this.containerNode,true);}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Container");mstrmojo.VBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.VBox",markupString:'<table id="{@id}" class="mstrmojo-VBox {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Container");function B(K,J,H){var I=J,G;for(;I>0;I--){G=Array(I+1).join("#");K=K.replace(G,H[I-1]);}return K;}var C='<div class="freezing-vis-txt-metric">',A='<div class="freezing-vis-txt-attr">',E="</div>",F="("+mstrmojo.desc(16294,"data retrieval paused")+")";var D=function(J,I){if(J<1&&I<1){return null;}var H=[],G="# ## ### ####";if(J>0){H.push(B(G,4,[A,J,J>1?mstrmojo.desc(3581,"Attributes"):mstrmojo.desc(518,"Attribute"),E]));}if(I>0){H.push(B(G,4,[C,I,I>1?mstrmojo.desc(3582,"Metrics"):mstrmojo.desc(517,"Metric"),E]));}return H.join(",");};mstrmojo.vi.ui.rw.FreezingImageContainer=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.vi.ui.rw.FreezingImageContainer",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-rw-freezingImageContainer mstrmojo-vi-ui-rw-GhostImageContainer {@cssClass}"><div class="mstmojo-freezingImgTableCell"><div class="mstrmojo-freezingImgDiv"><div class="freezing-vis-img ghost-vis-img"></div><div class="freezing-vis-desc"><label class="visName">{@visName}</label><div class="freezing-details">{@freezingDetails}</div></div><div class="vis-dropzone">{@visDropzoneMsg} </div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;}},visName:"",freezingDetails:F,visDropzoneMsg:""});mstrmojo.vi.ui.rw.FreezingImageContainer.getVisDropzoneMsg=D;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Widget","mstrmojo.css","mstrmojo.dom");var Z=mstrmojo.css,F=mstrmojo.dom;var a={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};function A(){var d=this.value,c=this.inputNode,e=c.value,b=(d!==null&&d!==undefined)?String(d):"";if(b!==e&&(!this.keepEmpty||e!==this.emptyText)){c.value=b;}if(c.mstrmojoEmpty){Z.removeClass(c,[this.emptyClass]);c.mstrmojoEmpty=null;}}function Y(){var b=this.inputNode;b.value=this.emptyText||"";Z.addClass(b,[this.emptyClass]);b.mstrmojoEmpty=true;}function N(){var b=this.inputNode;if(b){this.readingDom=true;this.set("value",b.value);this.readingDom=false;}}function V(b){var c=this;if(b===-1){N.call(this);}else{if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete c._lastTimeoutId;N.call(c);},b||100);}}mstrmojo.TextBox=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TextBox",value:"",type:"text",hint:"",readOnly:false,size:"",maxLength:"",cssDisplay:"inline",tabIndex:"",emptyText:"",keepEmpty:false,emptyClass:"mstrmojo-empty",valueChangeDelay:-1,textValid:true,autoComplete:true,autoCorrect:true,autoCapitalize:true,spellCheck:true,markupString:'<input id="{@id}" class="mstrmojo-TextBox {@cssClass}"  style="{@cssText}" title="{@tooltip}" type="{@type}" value="" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}"min="{@min}" max="{@max}" placeholder="{@hint}" mstrAttach:focus,keyup,blur,paste,cut,input,click,keydown,mousedown  tstid="{@tstid}"/>',markupSlots:{inputNode:function D(){return this.domNode;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,oncssClassChange:function S(){this.inputNode.className="mstrmojo-TextBox "+(this.cssClass||"");},onhintChange:function O(){this.inputNode.setAttribute("placeholder",this.hint);},onenabledChange:function E(){var b=this.inputNode;b.disabled=!this.enabled;Z.toggleClass(b,"disabled",!this.enabled);},onvalueChange:function P(){var b=this.value,c=(b===undefined)||(b===null)||(b==="");if(c){if(!this.hasFocus){Y.call(this);}else{this.inputNode.value="";}}else{A.call(this);}if(F.isIE9){this.inputNode.type=c?"text":this.type;}},ontooltipChange:function R(){this.domNode.title=this.tooltip;},onreadOnlyChange:function H(){this.inputNode.readOnly=this.readOnly;},ontextValidChange:function B(){Z.toggleClass(this.inputNode,["err"],!this.textValid);}},postBuildRendering:function W(){this._super();var b=this.inputNode;b.setAttribute("autocomplete",this.autoComplete?"on":"off");b.setAttribute("autocorrect",this.autoCorrect?"on":"off");b.setAttribute("autocapitalize",this.autoCapitalize?"on":"off");b.setAttribute("spellcheck",this.spellCheck?"true":"false");},focus:function Q(){if(this.inputNode&&this.inputNode.offsetParent){try{this.inputNode.focus();}catch(b){}}},prefocus:function M(){this.hasFocus=true;A.call(this);},blur:function U(){this.inputNode.blur();},preblur:function X(){window.setTimeout(function(){},200);this.hasFocus=false;N.call(this);var b=this.value;if(((b===null||b==="")&&this.emptyText)||(this.keepEmpty&&b===this.emptyText)){Y.call(this);}},prekeyup:function I(c){var b=c.hWin,d=c.e||b.event;V.call(this,this.valueChangeDelay);var f=a[d.keyCode];if(this["on"+f]){this["on"+f](c);}},preinput:function J(){V.call(this,this.valueChangeDelay);},prepaste:function K(){V.call(this);},precut:function G(){V.call(this);},setInvalidState:function C(b){this.set("textValid",false);if(b){this.domNode.setAttribute("title",b);}},cleanUp:function L(){this.inputNode.value="";this.set("textValid",true);this.domNode.setAttribute("title",this.tooltip);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Container","mstrmojo._IsPopup","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.ui._HasScroller");var L=mstrmojo.boxmodel,I=mstrmojo.dom,M=mstrmojo.css,O="mstrmojo-Tooltip",A="mstrmojo-scrollNode",E=20;function C(S,U,R){var V="connectScrollbox";if(R){V="dis"+V;}var Q=S&&S.parent;while(Q){if(Q[V]){Q[V](U);}Q=Q.parent;}}function G(){if(!this._paintHandle){var R=this.id,Q=function(W){var a=mstrmojo.all[R];if(!a){return ;}delete a._paintHandle;var U=[O],b=a.cssClass;if(b){U.push(b);}var S=mstrApp.getThemeClassName&&mstrApp.getThemeClassName(),Y=a.opener;if(Y&&Y.getTooltipThemeClass){S=Y.getTooltipThemeClass();}U.push(S);a.domNode.className=U.join(" ");var Z=a.content,V=a.contentNode,X=a.arrowNode;V.className=(O+"-content "+A+" "+a.contentNodeCssClass);V.style.cssText=a.contentNodeCssText;if(!a.hasWidgetContent){V.innerHTML=Z;}X.style.cssText="";a.domNode.style.visibility=!!Z?"visible":"hidden";a.updatePosition();if(!W&&a.optimizePos){a.optimizePos();}a.updateScrollbars();};if(!this._hasPaint){Q(true);this._hasPaint=true;}else{this._paintHandle=window.setTimeout(Q,0);}}}function B(V,d,k,W){var Z=d&&(d.richTooltip||d.tooltip),n=k?I.getMousePosition(k,W||self):null,c=Z&&(typeof Z==="string");var l="",b="",Y="",h=Z,a=null,Q=mstrmojo.tooltip.POS_TOPLEFT,S=null,f=null,R=null,m=false,U=null,X=mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY;var g=false,j=false;if(Z&&!c){b=Z.cssClass||b;l=Z.contentNodeCssClass||l;Y=Z.contentNodeCssText||Y;h=Z.content||"";a=Z.refNode||a;Q=Z.posType||Q;S=Z.left||0;f=Z.top||0;g=Z.keepArrowXPos||g;j=Z.keepArrowYPos||j;R=Z.updatePosition||null;m=Z.hasWidgetContent;U=Z.children;X=Z.tooltipCloseDelay||mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY;}V.set("contentNodeCssClass",l);V.set("cssClass",b);V.set("contentNodeCssText",Y);V.set("content",h);V.set("refNode",a);V.set("posType",Q);V.set("left",c?((n&&n.x)||V.left):S);V.set("top",(c||!Z)?((n&&(n.y+E))||V.top):f);V.set("keepArrowXPos",g);V.set("keepArrowYPos",j);if(R){V.set("updatePosition",R);}else{V.set("updatePosition",mstrmojo.Tooltip.prototype.updatePosition);}V.set("hasWidgetContent",m);V.set("children",U);V.set("tooltipCloseDelay",X);}mstrmojo.Tooltip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.Tooltip",content:null,top:null,left:null,refNode:null,keepArrowXPos:false,keepArrowYPos:false,posType:"TL",allowOtherTooltips:false,markupString:'<div id="{@id}" class="'+O+' {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout><div class="'+O+'-shadow {@shadowNodeCssClass}"></div><div class="'+O+'-contentWrapper"><div class="'+O+"-content "+A+' {@contentNodeCssClass}" style="{@contentNodeCssText}"></div></div><div class="'+O+'-arrow"></div></div>',markupSlots:{containerNode:function(){return this.domNode.children[1];},contentNode:function(){return this.domNode.children[1].firstChild;},shadowNode:function(){return this.domNode.firstChild;},arrowNode:function(){return this.domNode.children[2];}},setupScrollNodes:function D(){this.scrollNode=this.contentNode;this.scrollbarHostNode=this.containerNode;},_previousVisible:false,markupMethods:{onvisibleChange:function(){var R=this.domNode.style,Q=!!this.visible;if(this._previousVisible!==Q){R.visibility="hidden";}R.display=Q?"block":"none";this._previousVisible=Q;if(Q){this.updatePosition();if(this.content){G.call(this);}}},onleftChange:G,ontopChange:G,onrefNodeChange:G,onposTypeChange:G,oncontentNodeCssClassChange:G,oncontentNodeCssTextChange:G,oncontentChange:G,oncssClassChange:G},preBuildRendering:function N(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},updatePosition:function H(W){if(!this.visible&&!W){return ;}var V=this.refNode,U=V?L.offset(V,document.body):{left:I.getHorizontalScroll(),top:I.getVerticalScroll()},n=this.domNode.style,g=this.containerNode,j=g.offsetWidth,a=g.offsetHeight,R=this.posType,d=R.indexOf("R")>-1,X=R.indexOf("B")>-1,c=this.top!==null?parseInt(this.top,10)+U.top-(X?a:0):null,S=this.left!==null?parseInt(this.left,10)+U.left-(d?j:((R.indexOf("C")>-1)?Math.floor(j/2):0)):null,l=false,b=false,e,Y,k=I.windowDim(),h=I.getHorizontalScroll()+k.w,Q=I.getVerticalScroll()+k.h,f=this.arrowNode,m=null;if(S!==null){e=Math.min(Math.max(S,0),h-j);n.left=e+"px";l=S!==e;}if(c!==null){Y=Math.min(Math.max(c,0),Q-a);n.top=Y+"px";b=c!==Y;}if(l||b){var Z,p=this.keepArrowXPos&&l,o=this.keepArrowYPos&&b;if(p||o){m=M.getComputedStyle(f);Z=m.left;}if(Z&&Z.endsWith("%")){Z=parseFloat(Z)/100*j;}if(p){f.style.left=(parseInt(Z,10)+S-e)+"px";}if(o){f.style.top=(parseInt(m.top,10)+c-Y)+"px";}}M.toggleClass(this.domNode,"offset",l||b);},_on_tooltip_change:function(Q){B(this,Q&&Q.src);},_set_opener:function(U,S){var R=this.opener,Q=S!==R;if(Q){if(S){C(S,this);}if(R){C(S,this,true);}if(R&&R.detachEventListener){R.detachEventListener(this._richSubs);R.detachEventListener(this._ttpSubs);}if(S&&S.attachEventListener){this._richSubs=S.attachEventListener("richTooltipChange",this.id,"_on_tooltip_change");this._ttpSubs=S.attachEventListener("tooltipChange",this.id,"_on_tooltip_change");}this.opener=S;}return Q;},updatePopupConfig:function(Q,R){B(this,R,Q&&Q.e,Q&&Q.win);},onscroll:function K(){if(this.visible&&this.nudge){this.nudge();}this._super();},onmouseover:mstrmojo.emptyFn,onmouseout:mstrmojo.emptyFn});var J=null;mstrmojo.tooltip={POS_TOPLEFT:"TL",POS_BOTTOMLEFT:"BL",POS_TOPRIGHT:"TR",POS_BOTTOMRIGHT:"BR",POS_BOTTOMCENTER:"BC",POS_TOPCENTER:"TC",open:function F(R,U,S,Q){if(R&&R.hasWidgetContent&&J){J.destroy();}if(!J||!mstrmojo.all[J.id]){J=new mstrmojo.Tooltip();}Q=Q||{};Q.e=U;Q.win=S;J.open(R,Q);R.tooltip=J;},close:function P(){if(J&&!J.allowOtherTooltips){var Q=J.opener;if(Q){Q.tooltip=null;}J.close();if(Q&&Q.hasWidgetContent){J.destroy();}}}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.TabStripBase=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.TabStripBase",target:null,targetProps:null,isStrip:true,ontargetChange:function A(I){var J=I&&I.valueWas;if(J){var G=this._targetSubs;if(G){J.detachEventListener(G.add);J.detachEventListener(G.rem);J.detachEventListener(G.sel);}this.removeChildren();}var K=this.target;if(K){var E=this.targetProps,D=(E&&E.children)||"children",B=K[D];this.addTabButtons(B,0);var H="attachEventListener",C=this.id,F;if(K[H]){this._targetSubs={add:K[H]("addChild",C,function(L){var M=L&&L.value;if(M&&M.length){this.addTabButtons(M,L.index);}}),rem:K[H]("removeChild",C,function(M){var L=M&&M.value;for(F=((L&&L.length)||0)-1;F>-1;F--){this.removeTabButton(L[F]);}}),sel:K[H]("selectedChange",C,function(L){this.selectionChange(L);})};}}},addTabButtons:mstrmojo.emptyFn,removeTabButton:mstrmojo.emptyFn,selectionChange:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.array","mstrmojo.css","mstrmojo._HasChildren");var E=mstrmojo.array,F=mstrmojo.css,K=1,J=2,I=3,D=4,G=5;function C(){var R=this,M=R.metric,X=R.thresholds||[],P=X.length,U,V,Q,N,S,O,W=true;R.destroyChildren();if(!!X&&P>0){var Y=this.isImageBasedType();if(Y){var L=X.length;E.forEach(X,function(Z){var b=Z.rtxt,a=1/L*100;bar={scriptClass:"mstrmojo.Widget",markupString:'<div class="item" style="{@cssText}{@bg}"></div>',cssText:"width: "+a+"%; ",bg:"background:url("+b+");background-size: contain; background-repeat: no-repeat; background-position: center;"};R.addChildren(bar);});}else{U=X[0];V=X[X.length-1];Q=U.ttp===K||U.ttp===J||U.ttp===I;if(!Q){if(U.ttp===D||U.ttp===G){N=0;S=M.cnt;O=S;if(M.min===M.max){W=false;}}else{N=M.min;S=M.max;if(isFinite(U.ceil)&&U.ceil<N){N=U.ceil;}if(isFinite(V.flr)&&V.flr>S){S=V.flr;}O=S-N;if(O<=0){W=false;}}}E.forEach(X,function(g){var d=Math.min(g.ceil,S),j=Math.max(g.flr,N),Z=d-j,e=g.fmt.bc,c=isFinite(Z),f=isFinite(g.ceil),a=isFinite(g.flr),h={scriptClass:"mstrmojo.Widget",markupString:'<div class="item" style="{@cssText}"></div>',cssText:"width: "+Z+"%; "};if(!Q&&W){if(!c){if(f){Z=g.ceil-N;}else{if(a){Z=S-g.flr;}else{Z=S-N;}}}h.cssText="width: "+(Z/O*100)+"%; ";}else{if(!c||!W){h.cssText="width: "+(1/P*100)+"%; ";}}if(e.c1){var k=F.buildGradient(e.or,e.c1,e.c2),b=F.convertCssToCamelCase(k.n);h.cssText+=b+": "+k.v;}else{h.cssText+="background-color: "+e;}R.addChildren(h);});}}}mstrmojo.vi.ui.ColorRangeSelector=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasChildren],{scriptClass:"mstrmojo.vi.ui.ColorRangeSelector",markupString:'<div id="{@id}" class="mstrmojo-ColorRangeSelector" mstrAttach:click><div class="children"></div><div class="icon"></div></div>',markupSlots:{containerNode:function B(){return this.domNode.firstChild;}},thresholds:[],metric:null,preBuildRendering:function H(){this._super();C.call(this);},isImageBasedType:function A(){var L=this.thresholds;return L&&!L.some(function(M){return M.rtp!==4;});},});}());(function(){mstrmojo.vi.ui.rw.selectors.VisSelectorCurtain=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.vi.ui.rw.selectors.VisSelectorCurtain",markupString:'<svg class="vis-filter-curtain"><defs><mask id="visFilterMask" x="0" y="0"><rect style="width: 100%; height: 100%; fill: #FCFCFC; opacity: 0.5 " /></mask></defs><rect id="VisFilterCurtain" style="width: 100%; height: 100%; fill: #FCFCFC; mask: url(#visFilterMask)" /></svg>',markupSlots:{curtainNode:function B(){return this.domNode.firstChild;}},init:function C(D){this._super(D);},postBuildRendering:function A(){this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsPopup","mstrmojo._CanAutoClose");function A(B){return function(){this.domNode.style[B]=this[B]||"";};}mstrmojo.Popup=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.Popup",shadowNodeCssClass:"mstrmojo-popup-shadow",titleNodeCssClass:"mstrmojo-popup-title",contentNodeCssClass:"mstrmojo-popup-content",cssDisplay:"block",keepOpen:false,markupString:'<div id="{@id}" class="mstrmojo-Popup {@cssClass}" style="{@cssText}"><div class="mstrmojo-Popup-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Popup-title {@titleNodeCssClass}">{@title}</div><div class="mstrmojo-Popup-content {@contentNodeCssClass}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.lastChild;},shadowNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onleftChange:A("left"),ontopChange:A("top"),onzIndexChange:A("zIndex")}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var I=mstrmojo.css,G={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},E="sbClear",N="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,quickSearchForClear:false,showClearNode:true,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,focus,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+E+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+N+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){I.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}},ondisabledChange:function O(){var Q=this.disabled;I.toggleClass(this.domNode,"disabled",Q);if(this.inputNode){this.inputNode.disabled=Q;}}},clearNode:null,searchNode:null,isFocus:false,disabled:false,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function M(R){var Q=R.hWin,S=R.e||Q.event;this.updateSearch();var U=G[S.keyCode];if(this["on"+U]){this["on"+U](R);}},setClearIcon:function C(){var R=this.parent;if(!R){return ;}var Q=R.search&&R.search.searchNode,S=this.getSearchPattern(),U=(S.length===0);if(Q){I.toggleClass(this.searchNode,"clear",!U&&this.quickSearch);}},onEnter:function D(Q){this.onsearch(this.getSearchPattern());},onEsc:function A(Q){this.clearSearch();},getSearchPattern:function K(){return mstrmojo.string.trim(this.inputNode.value);},setSearchPattern:function K(Q){if(this.inputNode){this.inputNode.value=Q||"";this.updateSearch();}},preclick:function H(Q){var S=Q.getTarget(),R=S&&S.id;switch(R.replace(this.id,"")){case N:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case E:this.clearSearch();break;}},updateSearch:function B(){var R=this.getSearchPattern(),Q=(R.length===0),S=this.quickSearch;I.toggleClass(this.clearNode,"show",this.showClearNode&&!Q&&!S);I.toggleClass(this.searchNode,"clear",!Q&&S);I.toggleClass(this.domNode,"hasPattern",!Q);if(S||this.quickSearchForClear&&Q){this[Q?"clearSearch":"onsearch"](R);}},clearSearch:function L(){var Q=this.getSearchPattern();this.reset();this.onclear(Q);},onfocus:function P(){this.isFocus=true;I.addClass(this.domNode,"focus");},onblur:function J(){this.isFocus=false;I.removeClass(this.domNode,"focus");},reset:function F(){this.inputNode.value="";I.removeClass(this.clearNode,"show");I.removeClass(this.domNode,"hasPattern");I.removeClass(this.searchNode,"clear");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.Container","mstrmojo._Formattable","mstrmojo._IsThresholdConditionTarget","mstrmojo.EnumRWUnitType");var TP_HTML_CONTAINER=mstrmojo.EnumRWUnitType.HTMLCONTAINER;var $DOM=mstrmojo.dom,$HASH=mstrmojo.hash;function buildScriptNode(scriptNode){var node=document.createElement("script"),attributes=scriptNode.attributes,length=attributes.length;for(var i=0;i<length;i++){node.setAttribute(attributes[i].name,attributes[i].value);}return node;}mstrmojo.DocTextfield=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._IsThresholdConditionTarget],{scriptClass:"mstrmojo.DocTextfield",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocTextfield {@cssClass}" title="{@tooltip}" style="{@domNodeCssText}"><div class="mstrmojo-DocTextfield-valueNode" style="{@valueNodeCssText}" mstrAttach:click >{@v}</div>{@buttonNodeMarkup}</div>',markupSlots:{valueNode:function(){return this.domNode.firstChild;}},formatHandlers:{domNode:["T","z-index"],valueNode:["D","B","F","P","background-color","fx","text-align","white-space","overflow"]},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},update:function update(node){var d=node.data,v=d.v||"";if(node.defn.t===TP_HTML_CONTAINER){var div=document.createElement("div");div.innerHTML="<textarea>"+v+"</textarea>";v='<div style="display:none">&nbsp;</div>'+div.firstChild.value;div=null;}this.v=v;this.tooltip=d.tooltip||this.tooltip;if(this.thresholdId||d.tid){delete this.fmts;}this.thresholdId=d.tid;this.set("visible",!node.data.hidden);if(this._super){this._super(node);}},init:function(props){this._super(props);},postBuildRendering:function postBuildRendering(){var i,len;this.handleRotatedText();if(this.defn.t===TP_HTML_CONTAINER){var scripts=this.domNode.getElementsByTagName("script");for(i=0,len=scripts.length;i<len;i++){if(scripts[i].src){var parentNode=scripts[i].parentNode,node=buildScriptNode(scripts[i]);parentNode.removeChild(scripts[i]);parentNode.appendChild(node);}else{try{eval(scripts[i].innerHTML);}catch(err){console.log(err);}}}}return this._super();},isTextFieldRotated:function isTextFieldRotated(){var formats=this.getFormats();return(formats.fx&&formats.fx.rt&&!$DOM.isDXIE&&$DOM.supports($DOM.cssFeatures.TEXT_ROTATION));},handleRotatedText:function handleRotatedText(){var formats=this.getFormats(),rotateValue=formats.fx&&formats.fx.rt;if(this.isTextFieldRotated()){var domNode=this.domNode,domNodeStyle=domNode.style;switch(rotateValue){case 1:domNodeStyle.left=(parseInt(formats.left,10)+domNode.offsetHeight)+"px";break;case 3:domNodeStyle.top=(parseInt(formats.top,10)+domNode.offsetWidth)+"px";break;}}},getAnchor:function getAnchor(){return this.valueNode;}});mstrmojo.DocSummaryTextfield=mstrmojo.declare(mstrmojo.DocTextfield,null,{scriptClass:"mstrmojo.DocSummaryTextfield",markupString:'<span id="{@id}" class="mstrmojo-DocSumTextfield {@cssClass}" title="{@tooltip}" style="{@domNodeCssText}"><span class="mstrmojo-DocTextfield-valueNode" style="{@valueNodeCssText}" mstrAttach:click >{@openLink}{@v}{@closeLink}</span>{@buttonNodeMarkup}</span>',formatHandlers:{domNode:["T","z-index"],valueNode:["D","B","F","background-color","fx","text-align","white-space","overflow"]},update:function update(node){this._super(node);if(this.v){var v=this.v,p1=new RegExp("&lt;bold&gt;","g"),p2=new RegExp("&lt;/bold&gt;","g");if(v.indexOf("&lt;empty/&gt;")>-1){this.v="";return ;}v=v.replace(p1,"<b>");v=v.replace(p2,"</b>");this.v=v;}},preBuildRendering:function preBuildRendering(){if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container");mstrmojo.FieldSet=mstrmojo.declare(mstrmojo.Container,null,{legend:null,scriptClass:"mstrmojo.FieldSet",markupString:'<fieldset id="{@id}" class="mstrmojo-FieldSet {@cssClass}" style="{@cssText}"><legend class="{@cssClass}-legend">{@legend}</legend></fieldset>',markupSlots:{legendNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode;}},markupMethods:{onlegendChange:function(){this.legendNode.innerHTML=mstrmojo.string.encodeHtmlString((this.legend!=null)?this.legend:"");},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom");var M=mstrmojo.Widget,G=mstrmojo.dom,N=mstrmojo.global.document,C=50,B=500;mstrmojo.Stepper=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Stepper",orientation:"vertical",provider:null,title:"",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text">{@itemHtml}</div><div class="prev">-</div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},nextNode:function(){return this.domNode.children[1];},textNode:function(){return this.domNode.children[2];},prevNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:M.visibleMarkupMethod,onheightChange:M.heightMarkupMethod,onwidthChange:M.widthMarkupMethod,onenabledChange:function I(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},preBuildRendering:function J(){this.itemHtml=this.provider.renderItemAt();this._super();},processEvent:function A(O){if(G.contains(this.textNode,O)||O===this.titleNode){return ;}var Q=this.provider,P=((O===this.nextNode)?"Next":"Prev");if(Q["has"+P]()){Q[P.toLowerCase()]();this.updateDisplayText();}},updateDisplayText:function E(){this.textNode.innerHTML=this.provider.renderItemAt();},startStepperInterval:function F(O,P){var Q=this;this._holdTimer=setInterval(function(){Q[P](O);},C);},stopStepperInterval:function H(){if(this._holdTimer){clearInterval(this._holdTimer);delete this._holdTimer;}},onclick:function L(O){this.processEvent(O.e.target);},onmousedown:function D(O){if(!this._holdTimer&&!this._startHoldTimer){var P=this;this._startHoldTimer=setTimeout(function(){delete P._startHoldTimer;P.startStepperInterval(O,"onclick");},B);G.attachOneTimeEvent(N,"mouseup",function(){if(P._startHoldTimer){clearTimeout(P._startHoldTimer);delete P._startHoldTimer;}P.stopStepperInterval();},true);}},onselectstart:function K(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.css","mstrmojo.hash");mstrmojo.TristateCheckBox=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.TristateCheckBox",grayed:true,checked:true,cssClass:"tristate",onclick:function(){if(this.grayed){this.set("grayed",!this.grayed);}else{this.set("checked",!this.checked);}},markupMethods:mstrmojo.hash.copy({oncheckedChange:function(){mstrmojo.css.toggleClass(this.domNode,"checked",this.checked);},ongrayedChange:function(){mstrmojo.css.toggleClass(this.domNode,"grayed",this.grayed);},onenabledChange:function(){mstrmojo.css.toggleClass(this.domNode,"disabled",!this.enabled);}},mstrmojo.hash.copy(mstrmojo.Label.prototype.markupMethods))});})();(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo._HasEditableText","mstrmojo.css","mstrmojo._CanHandleTwoClicks","mstrmojo.Label","mstrmojo.Widget");var C=mstrmojo.css,A=mstrmojo.Label.prototype.markupMethods;mstrmojo.EditableLabel=mstrmojo.declare(mstrmojo.Label,[mstrmojo._CanHandleTwoClicks,mstrmojo._HasEditableText],{scriptClass:"mstrmojo.EditableLabel",autoApplyDelay:-1,markupString:'<div id="{@id}" class="mstrmojo-EditableLabel {@cssClass}" title="{@title}" contenteditable="{@isEditing}" style="{@cssText}" mstrAttach:click,mousedown,blur,keydown,keyup></div>',markupMethods:mstrmojo.hash.copy({onwidthChange:function(){mstrmojo.Widget.widthMarkupMethod.call(this);},ontextChange:function(){if(A.ontextChange){A.ontextChange.call(this);}this.widgetResized();},onvisibleChange:function(){if(A.onvisibleChange){A.onvisibleChange.call(this);}if(this.visible){this.widgetResized();}}},mstrmojo.hash.copy(A)),onkeyup:function E(F){this._super(F);if(this._autoApplyTimer){window.clearTimeout(this._autoApplyTimer);}if(this.autoApplyDelay!==-1){var G=this;this._autoApplyTimer=window.setTimeout(function(){G.set("isEditing",false);},this.autoApplyDelay);}},postBuildRendering:function D(){if(this._super){this._super();}this.widgetResized();},selectable:true});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.EditableLabel,{onselectableChange:function B(){var G=this[this.editableSlot],F=!!this.selectable;G.selectable=F;G.setAttribute("unselectable",!F?"on":"off");C.toggleClass(G,"unselectable",!F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.desc","mstrmojo.Label","mstrmojo.dom","mstrmojo.hash","mstrmojo.MetricSelectorUtility","mstrmojo.num","mstrmojo.vi.ui.rw.selectors.ISliderHelper");var C=mstrmojo.MetricSelectorUtility,A=C.FN,G=C.OP,I=C.Q,D=mstrmojo.num,H=Math.max,E=Math.min;mstrmojo.vi.ui.rw.selectors.MetricValueSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.ISliderHelper,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.MetricValueSliderHelper",init:function(J){this._super(J);this.slider.set("multiSelect",true);},updateOpCs:function B(){var L=this.slider,Q=L.cs1Vl,P=L.cs2Vl,O=E(Q,P),M=H(Q,P),S=L.low,N=L.high,K=L.include,U=parseInt(L.qua,10),J=(U===I._PT||U===I._PB),R=[];if((O>S&&M<N)||O<S||M>N){L.opId=K?G._BETWEEN:G._NOT_BETWEEN;}if(O===S&&M<N){L.opId=K?G._LESS_EQUAL:G._GREATER;}if(O>S&&M===N){L.opId=K?G._GREATER_EQUAL:G._LESS;}if(O===M){L.opId=K?G._EQUALS:G._NOT_EQUALS;}if(O===S&&M===N){L.unSet=true;L.cs=[];return ;}switch(L.opId){case G._BETWEEN:case G._NOT_BETWEEN:R.push({dtp:5,v:D.toLocaleString(O)+(J?"%":"")});case G._EQUALS:case G._NOT_EQUALS:R.push({dtp:5,v:D.toLocaleString(M)+(J?"%":"")});break;default:if(O>S){R.push({dtp:5,v:D.toLocaleString(O)+(J?"%":"")});}if(M<N){R.push({dtp:5,v:D.toLocaleString(M)+(J?"%":"")});}}L.cs=R;},updateSummary:function F(){var K=this.slider,N=K.opId,J="",M=K.cs1Vl>K.cs2Vl?K.cs2Vl:K.cs1Vl,O=K.cs1Vl<K.cs2Vl?K.cs2Vl:K.cs1Vl,P=this.formatNumber(M),L=this.formatNumber(O);if(K.unSet||M<=K.low&&O>=K.high&&K.include){J=mstrmojo.desc(2058,"All");}else{switch(N){case G._EQUALS:J="= "+P;break;case G._NOT_EQUALS:J=String.fromCharCode(8800)+" "+P;break;case G._GREATER:J="> "+L;break;case G._GREATER_EQUAL:J=String.fromCharCode(8805)+" "+P;break;case G._LESS:J="< "+P;break;case G._LESS_EQUAL:J=String.fromCharCode(8804)+" "+L;break;case G._BETWEEN:J=P+" - "+L;break;case G._NOT_BETWEEN:J="Not "+P+" - "+L;break;default:J=P+" - "+L;break;}}K.summary.set("text",J);}});}());(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList");mstrmojo.VisMenuList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.VisMenuList",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:false,init:function C(D){this._super(D);},getItemProps:function A(F,D){var E=this._super(F,D);E.tag="a";E.addCls("mstrmojo-ui-Menu-item");return E;},onselectionChange:function B(D){this._super(D);this.parent.data.set("valid",true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.string");mstrmojo.DivItemRenderer={render:function(E,C,F){var D=mstrmojo.string.encodeHtmlString((F.getItemName?F.getItemName(E,C):(F.itemDisplayField&&E[F.itemDisplayField])));return'<div mstridx="'+C+'" class="'+F.itemCssClass+(F.selectedIndices[C]?" "+F.itemSelectedCssClass:"")+(E.cssClass?" "+E.cssClass:"")+'" style="'+F.itemCssText+'">'+D+"</div>";},select:function(C){if(C&&C.className){C.className+=" selected";}},unselect:function(C){if(C&&C.className){C.className=C.className.replace(/selected/g,"");}},rowHeight:21};mstrmojo._RendersItemDivs={tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"mstrmojo-ListBox-cell",cellCssText:"",itemCssClass:"mstrmojo-ListBox-item",itemSelectedCssClass:"selected",itemDisplayField:"n",itemRenderer:mstrmojo.DivItemRenderer,rangeSelected:false,_findMatch:function(C,D){return mstrmojo.dom.findAncestorByAttr(mstrmojo.dom.eventTarget(C,D),"mstridx",true,this.itemsNode);},premousedown:function A(C){if(mstrmojo.dom.shiftKey(C.hWin,C.e)){mstrmojo.dom.preventDefault(C.hWin,C.e);}},preclick:function B(K){var G=K.hWin,H=K.e,F=this._findMatch(G,H);if(F){var J=parseInt(F.value,10),I=mstrmojo.dom,C=I.ctrlKey(G,H),D=I.shiftKey(G,H);if(C||D){I.clearBrowserHighlights(G);}if(this.multiSelect&&(this.selectionPolicy==="toggle"||C)){var E=this.rangeSelected||this.selectedIndex===-1;this.toggleSelect(J);if(E&&J<this.items.length&&this.selectedIndices[J+1]){J++;}this.selectedIndex=J;this.rangeSelected=false;}else{if(this.multiSelect&&D){this.rangeSelected=true;this.rangeSelect(J);}else{this.singleSelect(J);this.rangeSelected=false;}}}}};mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._RendersItemDivs");mstrmojo.ListBoxBase=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._RendersItemDivs],{scriptClass:"mstrmojo.ListBoxBase",cssClass:"mstrmojo-ListBox",itemCssClass:"mstrmojo-ListBox-item",_markupPrefix:function(){var C=this.itemRenderer;return(C&&C.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="0" cellpadding="0"><tbody>');},_markupSuffix:function(){var C=this.itemRenderer;return(C&&C.markupSuffix)||"</tbody></table>";},_itemPrefix:function(){var C=this.itemRenderer;return(C&&C.itemPrefix)||('<tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'"><td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var C=this.itemRenderer;return(C&&C.itemSuffix)||"</td></tr>";},_getItemNode:function(C){var H=this.itemsNode,G=this.renderAllItems,F=H&&H.tBodies,E=G?0:Math.floor(C/100),D=G?C:C%100,I=F&&F[E]&&F[E].rows&&F[E].rows[D];return I&&I.cells[0].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var D=mstrmojo.dom,E=mstrmojo.hash;var A;mstrmojo.SuggestionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.SuggestionList",itemField:"n",getItemMarkup:function(G,F){if(!A){var H=this.itemField;A=this._super(G).replace('@title}">{@en@n}<',"@en@"+H+'}">{@en@'+H+"}<");}return A;},getItemProps:function C(H,F){var G=this._super(H,F),I=this.itemField;if(!mstrmojo.string.isEmpty(H[I])){G[I]=H[I];}return G;},onclick:function B(F){if(this.disableClick){return false;}var K=this,H=this.parent,J=H.opener,G=D.isMetaKey(F.hWin,F.e);if(G&&!this.multiSelect){this.multiSelect=J.parent.defn.multi;if(this.multiSelect){D.attachOneTimeEvent(document.documentElement,"keyup",function(){var M=K.selectedIndices;if(J){J.suggestionShown=false;if(M&&!E.isEmpty(M)){var L=[];E.forEach(K.selectedIndices,function(O,N){L.push(K.items[N]);});J.handleSuggestionItemSelect(L);}H.close();}K.multiSelect=false;});}}this._super(F);if(!this.multiSelect){J.suggestionShown=false;var I=this.selectedItem;if(I){J.handleSuggestionItemSelect(I);}H.close();}},bindings:{itemField:"this.parent.opener.itemField",items:"this.parent.opener.suggestionItems",disableClick:"this.parent.opener.disableClick"}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase");mstrmojo.SelectBox=mstrmojo.declare(mstrmojo.ListBase,null,{scriptClass:"mstrmojo.SelectBox",size:10,cssDisplay:"inline",markupString:'<select id="{@id}" class="mstrmojo-SelectBox {@cssClass}" style="{@cssText}" size="{@size}" {@multipleHtml} mstrAttach:keyup,change tstid="{@tstid}">{@itemsHtml}</select>',markupSlots:{itemsContainerNode:function(){return this.domNode;},scrollboxNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},onenabledChange:function(){this.domNode.disabled=!this.enabled;}},itemCssClass:"mstrmojo-selectbox-item",itemDisplayField:"n",itemIdField:"v",showItemTooltip:false,itemRenderer:{render:function(E,D,F){var G=mstrmojo.string.htmlAngles((F.getItemName)?F.getItemName(E,D):(F.itemDisplayField&&E[F.itemDisplayField]));return'<option class="'+F.itemCssClass+'" value="'+((F.getItemValue)?F.getItemValue(E,D):(F.itemIdField&&E[F.itemIdField]))+'" '+((F.selectedIndices[D])?'selected="true" ':"")+((F.showItemTooltip)?'title="'+mstrmojo.string.encodeXMLAttribute(G)+'"':"")+">"+G+"</option>";},select:function(E,F,D,G){E.selected=true;},unselect:function(E,F,D,G){E.selected=false;}},buildRendering:function C(){this.multipleHtml=this.multiSelect?' multiple="true" ':"";this._super();delete this.multipleHtml;},_getItemNode:function(D){var E=this.scrollboxNode;return E&&E.options[D];},prechange:function A(E){if(this._syncDom){return ;}this._syncDom=true;var H=this.scrollboxNode;if(this.multiSelect){var I=H.options,F=[];for(var G=0,D=I.length;G<D;G++){if(I[G].selected){F.push(G);}}this.select(F);}else{this.singleSelect(H.selectedIndex);}delete this._syncDom;},prekeyup:function(E){var H=this.scrollboxNode,F=false;if(this.multiSelect){var I=H.options;for(var G=0,D=I.length;G<D;G++){if(I[G].selected!==!!this.selectedIndices[G]){F=true;break;}}}else{if(H.selectedIndex!==this.selectedIndex){F=true;}}if(F){var J=E;J.name="change";this.raiseEvent(E);}},onselectionChange:function B(D){if(!this._syncDom){this._super(D);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");mstrmojo.ui.List=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.List",postselectionChange:function C(D){var G=D.added||[],F=G.length,I=D.removed||[],E=I.length;if(E){this.selectionRemoved({added:G,removed:I,isReselect:false});}if(F){var H=function(J){return[].concat(J).sort().join(",");};this.selectionAdded({added:G,removed:I,isReselect:H(G)===H(I)});}},selectionAdded:function A(D){},selectionRemoved:function B(D){}});mstrmojo.ui.List.SelectionChangeEvtType=null;}());(function(){mstrmojo.requiresCls("mstrmojo._HasContextMenu","mstrmojo._IsList","mstrmojo.css","mstrmojo.dom","mstrmojo.ListBase");var B=mstrmojo.css,F=mstrmojo.dom;function E(){var I,N,H=this.itemsContainerNode,J,O=this.items,R=[],Q,L,P=this.padding,M,K=0;this.items.pop();if(!this.width){return ;}I=parseInt(this.width,10);N=H.scrollWidth||F.position(H).w;if(N<=I){return ;}Q=H.lastChild;B.removeClass(Q,"hide");L=F.position(Q).w;J=H.children;M=J.length-1;while(K<M){I-=(F.position(H.children[K]).w+P);if(I<L){break;}K++;}while(K<M){H.removeChild(J[J.length-2]);R.push(O[K++]);}this.set("cm",R);Q.textContent=mstrmojo.desc(15124,"## more").replace("##",R.length);}mstrmojo.vi.ui.TruncatedList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasContextMenu],{scriptClass:"mstrmojo.vi.ui.TruncatedList",cssClass:"mstr-truncList",padding:0,overflowCls:"",getAdditionalProperties:mstrmojo.emptyFn,getItemProps:function D(K,H){var J=this._super(K,H),I=K.style;if(I){J.addStyle(I);}this.getAdditionalProperties(J,H);return J;},buildRendering:function G(){this.items.push({alias:"overflowItem",cls:this.overflowCls+" hide",n:mstrmojo.desc(15124,"## more").replace("##",this.items.length)});if(this._super){this._super();}},setWidth:mstrmojo.emptyFn,postBuildRendering:function C(){this.setWidth();E.call(this);if(this._super){this._super();}},onclick:function A(I){var K=this.itemsContainerNode.children,H=K.length,J=H&&K[H-1];if(J&&J===I.getTarget()){this.cmPos=F.getMousePosition(I.e,I.hWin);this.showContextMenu();}}});}());(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList");mstrmojo.vi.ui.CalculationWidget=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.vi.ui.CalculationWidget",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:false,init:function C(D){this._super(D);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-vi-calculation");},_set_selectedItems:function(G,E){var D=(E||[]).map(function(H){return H.t;}),F=this.prevSelection={};D.forEach(function(H){F[H]=true;});this.setSelectedItems(this.items.filter(function(H){return D.indexOf(H.v)>-1;}));},getCalculationTypes:function A(){var F=this.items,G=this.selectedIndices,I=this.prevSelection,E=F.filter(function(K,J){return G[J]&&!I[K.v];}),H=F.filter(function(K,J){return !G[J]&&I[K.v];}),D=function(J){return J.v;};return[E.map(D),H.map(D)];},onselectionChange:function B(D){this._super(D);this.parent.applyCalculation(this.selectedItem.v);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ui._HasScroller");var F=mstrmojo.dom,J=mstrmojo.string;var D;function G(){var O=this._getItemNode(0);if(O){var N=(Math.min(this.maxVisibleButtons,this.items.length)*O.offsetWidth)+"px",M=this.domNode.style;if(N!==M.width){M.width=N;if(!this._sbto){this._sbto=window.setTimeout(function(){delete this._sbto;this.updateScrollbars();}.bind(this),0);}}}}mstrmojo.vi.ui.rw.PanelSelectorList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.rw.PanelSelectorList",init:function L(M){this._super(M);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-PanelSelectorList");},multiSelect:false,maxVisibleButtons:10,getItemMarkup:function K(M){if(!D){D=this._super(M).replace(">{@en@n}<",' title="{@en@n}"><div></div><');}return D;},getItemProps:function H(O,M){var N=this._super(O,M);N.n=O.n+" ("+(M+1)+"/"+this.items.length+")";return N;},setupScrollNodes:function E(){this.scrollNode=this.itemsContainerNode;},_set_items:function C(M,N){this._super(M,N);G.call(this);},selectPanel:function B(O){var N=this.items,M=mstrmojo.array.find(N,"id",O);this.singleSelect(M);return N[M];},postBuildRendering:function A(){var M=this._super();G.call(this);return M;},useRichTooltip:true,getItemTooltip:function(P,Q){var N=F.position(Q),O="<div>"+J.encodeHtmlString(P.n,true)+" "+((P.idx+1)+"/"+this.items.length)+"</div>";var M={areaId:P._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V V-center",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:O,top:N.y-4,left:N.x+10,enableHover:true};return M;},showTooltip:function I(M,P){var O=M.target||F.eventTarget(M.hWin,M.e),N=this.getItemFromTarget(O);if(N&&N.n){this.richTooltip=this.getItemTooltip(N,this.getItemNodeFromTarget(O));this._super(M,P);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.css");var B=mstrmojo.css;var A;var D;mstrmojo.ui.ButtonBar=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.ButtonBar",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onenabledChange:function G(){B.toggleClass(this.domNode,"disabled",!this.enabled);}},cssDisplay:"table",icnCssText:"display:table-row;",items:null,showIcon:true,hasSpacing:false,init:function F(I){this._super(I);var H=["mstrmojo-ui-ButtonBar"];if(this.hasSpacing){H.push("spacing");}if(!this.showIcon){H.push("btn-text");}B.addWidgetCssClass(this,H);},getItemMarkup:function E(H){if(!D){D=this._super(H);}if(!A){A=D.replace(">{@en@n}<",'title="{@en@n}"><div>&nbsp;</div><');}return this.showIcon&&!H.tx?A:D;},getItemProps:function C(J,H){var I=this._super(J,H);var K=J.css;if(K){I.addCls(K);}I.n=J.n||"";return I;}});mstrmojo.ui.ButtonBar.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList");var A;mstrmojo.ui.editors.controls.ColorList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.ui.editors.controls.ColorList",init:function D(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-ColorList");},getItemMarkup:function C(F,E){if(!A){A=this._super(F,E).replace(">{@en@n}<",">{@en@msg}<");}return A;},getItemProps:function B(G,E){var F=this._super(G,E);if(G.id==="transparent"){F.msg=mstrmojo.desc(5774,"No Fill");F.addCls("noFill");}else{F.msg="";G.title=G.n;F.addStyle("background-color:"+G.id);}return F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasMarkup","mstrmojo.Image");mstrmojo.threshold.ImageBand=mstrmojo.declare(mstrmojo.Image,null,{scriptClass:"mstrmojo.threshold.ImageBand",cssClass:"mstrmojo-Image color-band"});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.threshold.ImageBand,{onwidthChange:mstrmojo.Widget.widthMarkupMethod,onleftChange:mstrmojo.Widget.leftMarkupMethod});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapper","mstrmojo.ListBuilder","mstrmojo.ListSelector");mstrmojo.List=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.List",renderOnScroll:true,listMapper:mstrmojo.ListMapper,listBuilder:mstrmojo.ListBuilder,listSelector:mstrmojo.ListSelector,itemIdField:"dssid",itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2");function B(E){var I=E.ctxtBuilder;if(I){var H=I.itemWidgets,G;for(G=H.length-1;G>-1;G--){var F=H[G];if(F){F.destroy(true);}}}}mstrmojo.WidgetListBase=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.WidgetListBase",unrender:function C(G){var I=this.ctxtBuilder;if(I){var H=I.itemWidgets,F;for(F=H.length-1;F>-1;F--){var E=H[F];if(E&&E.hasRendered){E.unrender(true);}}}this._super(G);},refresh:function A(E){B(this);if(this._super){this._super(E);}},destroy:function D(E){B(this);this._super(E);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase2","mstrmojo.ListMapperHoriz","mstrmojo.ListBuilder");mstrmojo.ListHoriz=mstrmojo.declare(mstrmojo.ListBase2,null,{scriptClass:"mstrmojo.ListHoriz",renderOnScroll:true,listMapper:mstrmojo.ListMapperHoriz,listBuilder:mstrmojo.ListBuilder,itemField:"n",itemMarkup:null,itemMarkupFunction:null});})();(function(){mstrmojo.requiresCls("mstrmojo.ConditionNode","mstrmojo.dom");var B=mstrmojo.dom;mstrmojo.threshold.ConditionNode=mstrmojo.declare(mstrmojo.ConditionNode,null,{scriptClass:"mstrmojo.threshold.ConditionNode",emptyText:mstrmojo.desc(5893,"New Condition"),cssClass:"adv-threshold",avatarCssCls:"mstrmojo-thresholdRow",markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass} mstrAttach:mousedown"><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /></span><span class="mstrmojo-add-cond" mstrAttach:click>'+mstrmojo.desc(1994,"Add Condition")+"</span></div></div>",markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];},addConditionNode:function(){return this.domNode.childNodes[1].childNodes[4];}},preclick:function A(C){var F=null,E=B.eventTarget(C.hWin,C.e),D=this._super(C);if(B.contains(this.addConditionNode,E,true)){F="addCondition";}C.part=F||C.part;return D;},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.ConditionNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.dom","mstrmojo.css","mstrmojo.expr");mstrmojo.requiresDescs(1994,5893,7931,15671);var A=mstrmojo.dom,B=mstrmojo.css,D=mstrmojo.expr.ET,E=mstrmojo.fe._IsRelationTreeNode.createSetHtml;mstrmojo.fe.ConditionNode=mstrmojo.declare(mstrmojo.ConditionNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.ConditionNode",emptyText:mstrmojo.desc(5893,"New Condition"),markupString:'<div id="{@id}" class="mstrmojo-cond mstrmojo-ConditionNode {@cssClass}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-cond-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-onhoverparent mstrmojo-cond-contents {@cssClass}"><span class="mstrmojo-textset mstrmojo-cond-text {@cssClass}" mstrAttach:click></span><span class="mstrmojo-cond-text-postfix {@cssClass}"></span><span class="mstrmojo-rel mstrmojo-cond-popupNode {@cssClass}"></span><span class="mstrmojo-onhover-bl mstrmojo-abs mstrmojo-topright mstrmojo-cond-tools {@cssClass}"><img class="mstrmojo-del" src="../images/1ptrans.gif" tooltip="'+mstrmojo.desc(7931,"Delete condition")+'" onclick="mstrmojo.all[\'{@id}\'].del()" /><img class="mstrmojo-lock" src="../images/lock_view.svg"/></span><span class="mstrmojo-add-cond" mstrAttach:click>'+mstrmojo.desc(1994,"Add Condition")+"</span>"+E+"</div></div>",getPrefixAndOrToolsMarkup:function(){return(E+this._super());},markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},condNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.childNodes[1].firstChild;},textPostfixNode:function(){return this.domNode.childNodes[1].childNodes[1];},popupNode:function(){return this.domNode.childNodes[1].childNodes[2];},createSetNode:function(){return this.domNode.childNodes[1].lastChild;},createSetOptNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;},addConditionNode:function(){return this.domNode.childNodes[1].childNodes[4];}},markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){B.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);},onnoRelationChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noRelation);},onnoCreateSetChange:function(){B.toggleClass(this.condNode,["noRelation"],this.noCreateSet);},onlockedChange:function(){B.toggleClass(this.condNode,["locked"],this.locked);}},mstrmojo.hash.copy(mstrmojo.ConditionNode.prototype.markupMethods)),init:function(I){if(this._super){this._super(I);}var K=this.data&&this.data.et;if(K){this.set("noCreateSet",mstrApp.supportAdvFilter?false:(K===D.MQ||K===D.MC));}var G=this.tree.editor;if(G){var F=G.scriptClass==="mstrmojo.fe.FilterEditor";var H=typeof (G.disableElementsBrowsing)==="function"&&G.disableElementsBrowsing();if(F&&H&&K===D.AE){this.set("locked",true);this.set("editable",false);this.set("useRichTooltip",true);var J=this;this.set("updateTooltipConfig",function(){var L=mstrmojo.dom.position(J.domNode);this.richTooltip={content:mstrmojo.desc(15671,"Edit or remove is only available in workstation"),refNode:J.domNode,enableHover:true,cssClass:"vi-regular vi-tooltip-V V-center",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,left:L.w/2,top:-10};});}}},preclick:function C(F){var I=null,H=A.eventTarget(F.hWin,F.e),G=this._super(F);if(A.contains(this.createSetOptNode,H,true)&&!this.noRelationOperator&&!this.noRelation){I="createSetOpt";}else{if(A.contains(this.createSetNode,H,true)&&!this.noRelation){I="createSet";}else{if(A.contains(this.addConditionNode,H,true)){I="addCondition";}}}F.part=I||F.part;return G;},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TargetMask","mstrmojo.css","mstrmojo.desc");var A="targetMask";mstrmojo.vi.ui._HasTargets=mstrmojo.provide("mstrmojo.vi.ui._HasTargets",{_mixinName:"mstrmojo.vi.ui._HasTargets",init:function B(C){if(this._super){this._super(C);}this.addChildren([{scriptClass:"mstrmojo.vi.ui.TargetMask",alias:A,slot:"domNode",tooltipContent:this.maskTooltip,allowFilters:this.allowFilters}]);},setMaskClass:function(C){if(this[A].setMaskClass(C)){this._originalContextMenu=this.shouldShowCustomizeContextMenu;this.shouldShowCustomizeContextMenu=function(){return false;};this._originalIsDraggable=this.draggable;this.draggable=false;}},clearMaskClass:function(){this.shouldShowCustomizeContextMenu=this._originalContextMenu;delete this._originalContextMenu;this.draggable=this._originalIsDraggable;delete this._originalIsDraggable;this[A].clearMaskClass();}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Button","mstrmojo.EnumRWUnitType","mstrmojo.vi.models.VIComponentMap","mstrmojo.VisEnum","mstrmojo.gmaps.EnumGraphicType","mstrmojo.models.template.DataInterface");mstrmojo.requiresDescs(15518,15519,15526);var F=mstrmojo.array,C=12,B=4,D="-1",H=1,G=2,I=-1,E=mstrmojo.Button.newWebButton,J=mstrmojo.vi.models.VIComponentMap.TYPES,A=mstrmojo.models.template.DataInterface;mstrmojo.vi.models._CheckDataCards=mstrmojo.provide("mstrmojo.vi.models._CheckDataCards",{_mixinName:"mstrmojo.vi.models._CheckDataCards",CARDLIMIT:mstrmojo.VisEnum.VIS_CARDLIMIT.NON_GRID,isUnitRestrictedInViz:function(){var P=this.getHost&&this.getHost(),O=P&&P.defn,L=!!(O&&O.iifp);if(L){return false;}var K=this.docModel,M=[],N=K.getVIComponent(J.FILTER_PANEL),Q=N&&N.parent;M=M.concat((Q&&Q.getFilterDefinitions())||[]);return M.length;},_addInLargeItems:[],_columnCardinalityCount:1,_totalRow:0,clearCardinalityFlags:function(){this._addInLargeItems=[];this._columnCardinalityCount=1;this._totalRow=0;},existLargeOrManyItems:function(){return(!!this._addInLargeItems.length||this._columnCardinalityCount>this.CARDLIMIT);},existLargeRowCount:function(){return(this._totalRow>mstrmojo.vi.models.editors.XtabEditorModel.ENUM_MAX_ROWS_OUTLINE);},findTotalColumnCount:function(P,Q){var R=this,U,M=1,O=0,S=this.getHost().gridData;R._columnCardinalityCount=1;if(S){if(Q&&Q.id===H){var K=S.rw,V=K&&K.row;R._columnCardinalityCount=(V&&V.tc)||1;return ;}var L=S.ghs,N=L&&L.chs;F.forEach(N&&N.items,function(W){if(W.items){M=Math.max(M,W.items.length);}});}F.forEach(P,function(W){if(Q&&Q.id===G){Q.items.every(function(X){if(X.t===C&&X.did===W.did&&X.card){O++;M=M/X.card;return false;}return true;});}U=W.cardg>0?W.cardg:W.card;if(!U&&W.otp===C&&W.es){U=W.es.length+1;}if(U){M=M*U;}});R._columnCardinalityCount=(O===P.length)?1:M;},findEstimatedTotalRow:function(P,L,K){var R=this,X,U=1,M=0,S=this.getHost().gridData,W=this.docModel,K=K||[],Q=W&&W.datasets;R._totalRow=1;function O(a){var Z=0;Object.keys(Q).every(function(b){return Q[b].att&&Q[b].att.every(function(c){if(c.did===a){Z=c.card;return false;}return true;});});return Z;}function N(Z){return P.some(function(a){return Z.did===a.did;})||K.some(function(a){return Z.did===a.did;});}if(S){var Y=S.gsi.rows,V=S.gsi.mx;F.forEach(Y,function(Z){if(N(Z)){return ;}if(Z.t===C){U*=O(Z.did)||1;}else{if(Z.t===B){if(Z.did===D&&V){M=V.length;F.forEach(V,function(a){N(a)&&M--;});}}}});}F.forEach(P,function(Z){if(Z.t===B){if(L===H||L===I){if(Z.did===D&&S&&S.gsi.mx){M=S.gsi.mx.length;}else{M++;}}}X=Z.cardg>0?Z.cardg:Z.card;if(!X&&Z.otp===C&&Z.es){X=Z.es.length+1;}if(X){if(L===H){U=U*X;}}});U=U+U*M;R._totalRow=U;return R._totalRow;},addAttributeNameAndTargetVisForAddUnits:function(R,P,Q,O,M){if(!R){return ;}var N={data:R},K=R&&R.vp,L;Q=Q||R&&R.vis&&R.vis.vn;O=O||K&&K.gtp;M=M||K&&K.ln;L=Q===mstrmojo.vi.viz.EnumVizStyles.GOOGLE_MAP||Q===mstrmojo.vi.viz.EnumVizStyles.ESRI_MAP||Q===mstrmojo.vi.viz.EnumVizStyles.MAPBOX;F.forEach(P,function(S){var V=S.id,U;if(V&&!S.attributeName){U=A.prototype.getUnitById.call(N,V);S.attributeName=U&&U.unit&&U.unit.n;}if(O===mstrmojo.gmaps.EnumGraphicType.Area&&L){if(!S.targetVis){S.targetVis={};}S.targetVis.vis=Q;S.targetVis.gtp=O;S.targetVis.ln=M;}else{if(S.targetVis){S.targetVis=undefined;}}});},findLargeItemsForAddUnits:function(K,L,O){var N=this,P,M={};if((!L&&!N.isUnitRestrictedInViz())||L){K.forEach(function(S){var Q=S.cardg>0?S.cardg:S.card;P=!!O?O:N.CARDLIMIT;if(S.targetVis&&S.targetVis.gtp===mstrmojo.gmaps.EnumGraphicType.Area){P=mstrmojo.VisEnum.VIS_CARDLIMIT.AREA_MAP;}if(Q&&Q>P){var U=S.attributeName||S.n;if(!M[U]){M[U]=true;var R=S.targetVis&&S.targetVis.ln?(U+"("+S.targetVis.ln+") ("+Q+")"):U+" ("+Q+")";N._addInLargeItems.push(R);}}});}},warnAndExecCallBackForOutlineAddUnits:function(M,L){var K=this,L=L||mstrmojo.emptyFn;if(this.existLargeRowCount()){mstrmojo.confirm(mstrmojo.desc(15792,"The dossier will attempt to display more than 5000 rows in outline mode. This may affect performance and stability. Do you want to continue?"),null,{id:"OutlineModeWarningDialog",title:mstrmojo.desc(11812,"Notification"),allowHTML:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(212,"Continue"),M),mstrmojo.Button.newWebButton(mstrmojo.desc(3416,"Cancel"),L)],onPreClose:function(){L();return true;}});}else{M();}},checkAndWarnForOutlineAddUnits:function(K,M,O,N,L){if(this.getHost().isOutlineMode){this.findEstimatedTotalRow(K,M,L);this.warnAndExecCallBackForOutlineAddUnits(O,N);}else{O();}},warnAndExecCallBackForAddUnits:function(R,P,M,Q){if(this.existLargeOrManyItems()&&!mstrApp.isAppStatePresentation()){var N=this._addInLargeItems,O=N.length,L;if(O>1){L=mstrmojo.desc(15518,"The following attributes contain a large number of elements: ##. This action may impact dossier performance.").replace("##",N);}else{if(O===1){L=mstrmojo.desc(15519,"The attribute ## has too many elements. This action may impact dossier performance.").replace("##",N);}else{L=mstrmojo.desc(15526,"The dossier will attempt to display more than ### columns. This can affect performance and stability.").replace("###",this.CARDLIMIT);}}var K=[];if(O&&P){K.push(E(mstrmojo.desc(7977,"Move to Rows"),function(){P();},true));}K.push(E(mstrmojo.desc(212,"Continue"),function(){R();}));K.push(E(mstrmojo.desc(2140,"Cancel"),function(){if(M){if(Q){Q();}else{if(mstrApp.isWorkstation&&mstrApp.isSingleTier){window.FormWrapper.closeWindow("{}");}else{mstrmojo._DocToolbarActions.close.call({model:{isnew:false}});}}}}));mstrmojo.warn(L,{},{buttons:K});N.splice(0,N.length);return ;}R();},checkAndWarnLargeItemsForAddUnits:function(N,R,P,K,M,L,O,Q){this.clearCardinalityFlags();if(!M||M.id===G){this.findLargeItemsForAddUnits(N,L,O);}if(K){this.findTotalColumnCount(N,M);}this.warnAndExecCallBackForAddUnits(R,P,L,Q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button");mstrmojo.HTMLButton=mstrmojo.declare(mstrmojo.Button,null,{scriptClass:"mstrmojo.HTMLButton",markupString:'<input id="{@id}" type="button" class="mstrmojo-text mstrmojo-HTMLButton mstrButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}" mstrAttach:click />',markupSlots:{inputNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"inline":"none";},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);},onselectedChange:function(){mstrmojo.css[this.selected?"addClass":"removeClass"](this.domNode,["selected"]);},ontextChange:function(){this.inputNode.value=this.text!=null?this.text:"";},oniconClassChange:function(){this.domNode.className="mstrmojo-text mstrmojo-HTMLButton mstrButton "+this.cssClass+" "+this.iconClass+(this.enabled?"":" disabled");}}});})();(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.hash","mstrmojo.Button","mstrmojo.vi.ui.rw._IsOutlineXtab","mstrmojo.css");mstrmojo.requiresDescs(619,1442,15963,16112,16113);var B=mstrmojo.EnumRWUnitType,A=mstrmojo.vi.viz.EnumVizStyles,Q=mstrmojo.hash,C={},N=mstrmojo.array,V=mstrmojo.DynamicClassFactory.newComponent;C[B.HEADER]=C[B.FOOTER]=C[B.PAGEHEADER]=C[B.PAGEFOOTER]=C[B.DETAILS]={n:"Section"};C[B.HTMLCONTAINER]={n:"HTMLContainer"};C[B.SELECTOR]={n:"Selector"};C[B.GRID]={n:"Xtab"};C[B.MOJOVISUALIZATION]={n:"MojoVisualization"};function D(a){return(a&&a.t)||mstrmojo.EnumRWUnitType.LAYOUT;}mstrmojo.DocBuilder=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DocBuilder",visList:null,selectorFactory:null,classMap:null,init:function U(a){this._super(a);var b=this.selectorFactory=this.createSelectorFactory();this.addDisposable(b);this.classMap=this.createClassMap();},createSelectorFactory:function Z(){this.throwAbstractMethodError("getSelectorFactory");},createClassMap:function F(){return Q.copy(C);},getMojoVisName:function W(d){var c=d.data,e=c&&c.visName||"",a=D(d.defn),b=c&&c.vis;if(!e){if(b&&(a===B.GRID||a===B.GRAPH||a===B.GRIDGRAPH)){if(b.vn&&b.ve&&b.vm===51){e=Q.walk("dz.visProp.fmt.visStyle",c)||b.vn;}else{if(b.we&&b.wcn){e=this.visList.findVisName(b.wcn);}}}}if(e===A.NEW_GRAPH_MATRIX){if(mstrApp.supportFeature&&mstrApp.supportFeature("ngm")){if(mstrApp.supportFeature("ngmPartial")){if(N.indexOf([76,79,80,81,82],Q.walk("data.dz.visProp.fmt.visType",d))<0){e=A.GRAPH_MATRIX;}}}else{e=A.GRAPH_MATRIX;}}return e;},build:function P(a,h,q){var o=this.classMap,j=[],l=((a&&a.length)||0),g,d,e,b,f,c,n,m,p;for(g=0;g<l;g++){d=a[g];e=d&&d.defn;b=d&&d.data;f=D(e);c=o[f];if(h.isMapLayerNode(d.k)){continue;}if(f===B.TEXTFIELD&&((e&&e.dpst))){c=o[f+"B"];}n=this.getMojoVisName(d);if(n){b.visName=n;c=C[B.MOJOVISUALIZATION];}if((n||f===B.GRID)&&e.iifp){c=C[B.SELECTOR];e.style=mstrmojo.DocSelector.STYLES.VISUALIZATION;}m=(c&&c.n)?"new"+c.n:"";p=undefined;if(this[m]){p=this[m](h,d,c,q);}else{if(c&&c.scriptClass){var k=c.cls;if(!k){k=Q.walk(c.scriptClass,window);}if(k){p=this.newRWUnitInstance(h,d,k);}}}if(p){p.k=d.k;p.builder=this;p.tooltip=b.tooltip||e.tooltip||"";if(e.iifp){p.style=mstrmojo.DocSelector.STYLES.VISUALIZATION;}if(!p.defn){p.defn=e;delete p.defn.destroyed;p.disposables.push(p.defn);}if(p.update){p.update(d);}if(this.isPortlet(e)){p=this.createPortlet(f,d,p,q);}if(!this.extractWidget(p,d)){j.push(p);}}}return j;},createPortlet:function H(b,c,a,d){return a;},newRWUnitInstance:function S(a,c,d,b){return new d(Q.copy(b||{},{id:c.id,node:c,controller:this.parent.controller,model:a}));},newSection:function X(a,b){this.throwAbstractMethodError("newSection");},newSelector:function M(c,d,b,e){var a=this.selectorFactory.newDocSelector(c,d,b,e);a.controller=this.parent.controller;return a;},isPortlet:function R(a){return !!((a.t!==B.PANEL&&a.ttl!==undefined)||a.qsm);},extractWidget:function O(b,a){return !b;},getDefaultMojoVisModel:function J(){this.throwAbstractMethodError("getDefaultMojoVisModel");},newMojoVisualization:function(f,o){var q=this.visList,b=o.data,w=b.visName===A.ESRI_MAP?A.GOOGLE_MAP:b.visName,p=q.getVis(w),t=p&&((p.dc!==undefined)?p.dc:p.c),x=this;if(!p){var d=b.className,z=false;if(!d){if(!this._widgetNotFound){this._widgetNotFound=[];}N.forEach(this._widgetNotFound,function(AB){if(AB.name===w){z=true;}});if(!z){this._widgetNotFound.push({key:b.k,name:w});}var h=mstrApp.isWorkstation,u=h&&FormWrapper.isDesktop(),k=h&&!(parseInt(FormWrapper.isWSLiveMode(),10)===1),e=k?16113:16112,r=k?'The following custom visualization(s) plug-in(s) used in this dossier are not deployed in $$$$, so the data will be displayed in tabular form:<br>####<br><br>Click on the "plus" button in the Visualizations Gallery to import custom visualization plug-in(s).':"The following custom visualization(s) plug-in(s) used in this dossier are not deployed in your environment, so the data will be displayed in tabular form:<br>####<br><br>Please contact your administrator to deploy these custom visualization plug-in(s).";if(!this._showWarning){this._showWarning=window.setTimeout(function(){var AB=[];N.forEach(this._widgetNotFound,function(AC){AB.push(AC.name);});mstrmojo.warn(mstrmojo.desc(e,r).replace("$$$$",u?mstrmojo.desc(619,"Desktop"):mstrmojo.desc(15963,"Workstation")).replace("####",AB.join("<br>")),{},{buttons:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),onclick:function(){delete x._widgetNotFound;delete x._showWarning;}}],allowHTML:true});}.bind(this),0);}var AA=this.newXtab(f,o);AA.cssDefault=!!AA.cssDefault?AA.cssDefault+" noVis":"noVis";return AA;}p={dc:d};}var c="mstrmojo."+t,m=p.b;if(mstrApp.isVI&&p.vib){m=p.vib;}else{if(mstrApp.isExpress&&p.oivmb){m=p.oivmb;}}if(m&&!mstrmojo.loader.isLoaded(c)){mstrmojo.requiresBundle(m);}mstrmojo.requiresCls(c);if(p.lib){var v=mstrmojo.getJsRoot();var j=JSON.parse(p.lib);N.forEach(j,function(AB){mstrmojo.requiresDepLib(v+AB[0],AB[1]);});}var a=this.visList.getVis(w).m,n=Q.walk(t,mstrmojo),s=a?Q.walk(a,mstrmojo):this.getDefaultMojoVisModel();if(!n||!s){throw new Error("Missing visualization class.");}n=q.getVisClass(n,o.defn);var l=new n(Q.copy(b.extProps,{id:o.id,node:o,n:o.defn.title,controller:this.parent.controller,gb:b.gbys}));var g=new s({xtab:l,controller:this.parent.controller,docModel:f});l.setModel(g);g.set("data",b);return l;},getModelClassByVisName:function L(c){var a,d,b=this.visList.getVis(c);if(!b){return null;}a=b.m;d=a?Q.walk(a,mstrmojo):this.getDefaultMojoVisModel();return d;},getEditableXtab:function G(a){this.throwAbstractMethodError("getEditableXtab");},getDefaultXtab:function E(a){this.throwAbstractMethodError("getDefaultXtab");},getCustomSortXtab:function I(){this.throwAbstractMethodError("getCustomSortXtab");},newXtab:function K(c,d,b,f){var e=mstrmojo.all[d.id];if(!e){var a=d.defn.iics?this.getCustomSortXtab():(d.defn.txi?this.getEditableXtab(d):this.getDefaultXtab(f));if(d.data&&d.data.olm&&!(d.data.rw&&d.data.rw.row.bc>0)&&!d.defn.txi){a=V(a,[mstrmojo.vi.ui.rw._IsOutlineXtab]);}e=this.newRWUnitInstance(c,d,a);e.model=this.newXtabModel({xtab:e,docModel:c});}else{e.set("node",d);e.model.set("docModel",c);}return e;},newXtabModel:function Y(a){this.throwAbstractMethodError("newXtabModel");}});mstrmojo.DocBuilder.ClassMapItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.color","mstrmojo.css","mstrmojo.dom","mstrmojo.GridBase","mstrmojo.array");var Y=mstrmojo.css,O=mstrmojo.color,d=mstrmojo.css,E=mstrmojo.dom,I=E.isEdge;function C(f,g){var h=f&&f.parent;while(h&&h.scriptClass.indexOf("DocPanelStack")===-1){if(g in h){return h;}h=h.parent;}return null;}function B(g){var f=document.createElement("img");g.appendChild(f);g.removeChild(f);}function F(f,g){var j=Math.floor(f/g.rowsPerPage),l=f%g.rowsPerPage,k=g.tableNode.tBodies[j],h=k.rows[l].cells;return h;}function J(){var f=this._renderTimer;if(f){self.clearInterval(f);delete this._renderTimer;this.renderingRows=false;}}mstrmojo.Grid=mstrmojo.declare(mstrmojo.GridBase,null,{scriptClass:"mstrmojo.Grid",rowsPerPage:0,effectiveRh:0,numPagesRendered:0,totalPages:0,pageStatus:null,_defaultPageHeight:0,renderPause:10,rhMin:14,defaultRowsPerPage:100,minRowsPerPage:50,init:function H(f){this._super(f);this.forceFixedSizes=true;},initPageSettings:function P(){var j=this.parent,g=j.gridData,h=this.defaultRowsPerPage,f=this.cp.getAvailableRowsCount();this.effectiveRh=this.rh||this.rhMin||1;this.effectiveRh=this.effectiveRh*j.model.docModel.getZoomFactor();if(j&&j.numRowFixed){h=f;}else{if(j&&j.scrollboxHeightFixed){h=Math.ceil(j.scrollboxHeight/this.effectiveRh);h=Math.max(h,this.minRowsPerPage);if(f<h){h=this.minRowsPerPage;this._shouldRenderNextPage=true;}}}if(j.isOutlineMode){h=Math.min(200,f);}this.pageStatus=[];this.rowsPerPage=h;this.initPageStatus(this.pageStatus);this._defaultPageHeight=this.rowsPerPage*this.effectiveRh;},initPageStatus:function b(j){var h=this.rowsPerPage,f,l,g,k=function(o,p,m){var n=this;return function(){if(n._onDemand===undefined){n._onDemand=!o.isDataAvailable(p,m);}return n._onDemand;};};this.totalPages=(h&&Math.ceil(this.cp.rc/h))||0;j=j||this.pageStatus;for(f=0;f<this.totalPages;++f){l=f*h;g=l+h-1;if(!j[f]){j[f]={};}delete j[f]._onDemand;j[f].isOnDemand=k.call(j[f],this.cp,l,g);}},buildRendering:function G(){var f=false;if(this.renderMode==="vscroll"){this.initPageSettings();var j=this.pageStatus[0];f=j&&j.isOnDemand();this.start=0;this.end=-1;if(!f){this.end=Math.min(this.cp.rc,this.rowsPerPage)-1;}this.preRenderPages();this.preRenderPage(0,!f);}this._super();if(this.renderMode==="vscroll"){var h=this.parent;this.gridContainerNode.style[d.MINHEIGHT]=(this.cp.rc*this.effectiveRh)+"px";if(!this.connectedScrollbox){if(h&&h.connectScrollbox){h.connectScrollbox(this);this.connectedScrollbox=true;}}this.postRenderPage(0,!f);this.postRenderPages();var g=h&&!h.scrollboxHeightFixed&&!h.numRowFixed;if(g&&this.numPagesRendered>=this.totalPages&&!f){this.postRenderingCleanup();}else{if(f||g||this._shouldRenderNextPage||(h.isOutlineMode&&this.getPageHeight(this.pageNum)<this._defaultPageHeight)){this.onscroll();delete this._shouldRenderNextPage;}}}},preRenderPages:function S(){},postRenderPages:function c(){if(mstrApp&&mstrApp.isExpress){var g=this.parent.scrollboxNode,h=g.scrollTop,j=g.scrollLeft,f=(h>5)?h-5:0;this.parent.scrollTo({x:j,y:f});this.parent.scrollTo({x:j,y:h});}},configureActions:function N(){var f=this.parent;if(f&&f.configureActions){f.configureActions();}},preRenderPage:function Q(f,g){this.pageNum=f;},postRenderPage:function L(g,j,k){if(g+1>this.numPagesRendered){this.numPagesRendered=g+1;}var f=this.pageStatus,h=f[g];if(!h){h=f[g]={};}if(j){h.filled=true;h.dirty=false;}var l=this.gridContainerNode.style;if(g===this.totalPages-1&&l){l[d.MINHEIGHT]="";}},invalidAllPages:function(){for(var f=0;f<this.totalPages;++f){var g=this.pageStatus[f];if(g.filled){g.dirty=true;}delete g._onDemand;g.filled=false;g.isDownloading=false;}this.thPosMap=[];this.posMap=[];},_startPageRenderThread:function e(f){var g=this.id;this.renderingRows=true;this._renderTimer=self.setInterval(function(){try{var k=mstrmojo.all[g];if(!k){return ;}var h=k.getPagesToRender(f);if(h.length>0){k.preRenderPages();k.renderPages(h);k.postRenderPages();k._postPagesClearup=true;}else{if(k._postPagesClearup){k.postRenderPagesCleanup();k.configureActions();k._postPagesClearup=false;}J.call(k);if(k.isRenderingComplete()){k.postRenderingCleanup();}}}catch(j){J.call(mstrmojo.all[g]);throw j;}},this.renderPause);},onscroll:function a(g,f){if(!this.renderingRows){if(g===true){var h=this.parent;if(h&&h.maskNode){Y.addClass(h.maskNode,"wait");}}window.clearTimeout(this.scrollingTimeOut);this.scrollingTimeOut=window.setTimeout(function(){this._startPageRenderThread(f);}.bind(this),150);}},isRenderingComplete:function R(){if(this.end>=this.cp.rc-1){for(var f=this.pageStatus,g=this.totalPages-1;g>-1;g--){if(!f[g]||!f[g].filled){return false;}}return true;}return false;},renderPages:function D(g){for(var h=0,f=g.length;h<f;++h){this.renderPage(g[h].idx,g[h].fill,h!==f-1);}},renderPage:function Z(q,h,t){var v=this.pageStatus,l=(this.numPagesRendered>=q+1);if(l){if(!h||(v[q]&&v[q].filled)){return ;}}var u=this.rowsPerPage,m=this.domNode,o=this.parent;this.start=q*u;this.end=Math.min(this.start+u,this.cp.rc)-1;this.preRenderPage(q,h);if(h&&o.isOutlineMode){o.hasEmptyTBody=true;}var g=this.tempTable;if(!g){g=this.tempTable=m.ownerDocument.createElement("div");}var s=this.tableNode,r=this.start,j=this.end,n=h?this.buildTableRowsMarkup(r,j,'<table><tbody n="'+this.pageNum+'">',"</tbody></table>",s.style.tableLayout).join(""):'<table><tbody n="'+this.pageNum+'"><tr><td style="height:'+(o.isOutlineMode?this._defaultPageHeight:(this.effectiveRh*(this.end-this.start+1)))+'px">&nbsp;</td></tr></tbody></table>';if(h&&o.hasEmptyTBody){if(!o.outlineState.hasTBodyElementsToExpand){n='<table><tbody n="'+this.pageNum+'"><tr style="height:'+0+'px"></tr></tbody></table>';}else{o.outlineState.hasTBodyElementsToExpand=false;}}g.innerHTML=n;var k=g.firstChild.tBodies[0];if(!l){s.appendChild(k);if(o.isOutlineMode&&o.isAutoTableLayout()){if(o.clonedColHeader){o.clonedColHeader.getTableNode().appendChild(k.cloneNode(true));}if(o.clonedTitle&&o.clonedTitle.getTableNode()){o.clonedTitle.getTableNode().appendChild(k.cloneNode(true));}}}else{s.replaceChild(k,s.tBodies[q]);}if(k&&mstrApp&&mstrApp.isSingleTier){E.redirectUrlToFormWrapper(k);}if(h){this.markPages(r,j);}this.postRenderPage(q,h,k);var f=this.parent;if(f.onPageRendered){f.onPageRendered(k,q,l,h,t);}},getPagesToRender:function V(w){var u=[],z=this.parent,AJ=this._defaultPageHeight,o=null,AK=this.pageStatus,AL=this;function s(j){var m=AK[j];if(m&&(m.filled||m.dirty)){if(!o){o=AL.tableNode.tBodies;}m.height=o[j].getBoundingClientRect().height;if(I){m.height-=11;}return m.height;}else{return AJ;}}var r=0,q=null,v=null,h=z.scrollboxTop;for(var AF=0,AG=this.totalPages,f=this.pageStatus;AF<AG;AF++){r+=s(AF);if(r>=h){q=AF>0?AF-1:AF;break;}}if(q===null){q=v=Math.max(AG-1,0);}else{var x=z.scrollboxBottom;if(isNaN(x)&&z.numRowFixed){x=h;}for(var AE=q+1;AE<AG;AE++){if(parseInt(r,10)>x){v=AE;break;}r+=s(AE);}}if(v===null){v=AG-1;}else{if(v<AG-1&&v<=q){v=v+1;}}for(var AA=this.numPagesRendered;AA<q;++AA){u.push({idx:AA,fill:false});}var AD=0,AH=this.rowsPerPage,t=false;for(var AB=q;AB<=v;++AB){var AI=AK[AB];if(!AI||!AI.filled){if(AI&&AI.isOnDemand()){t=true;if(!AI.isDownloading&&!this.isDownloading){AD+=AH;AI.isDownloading=true;this.isDownloading=true;var l=AB*AH,k=l+AH-1;this.cp.download(l,k,w);}u.push({idx:AB,fill:false});}else{u.push({idx:AB,fill:true});}}}if(z.isOutlineMode&&u.length===0){var AC=z.scrollboxNode.getBoundingClientRect().bottom;while(u.length===0&&v<this.totalPages-1){var g=o[v].getBoundingClientRect().bottom;if(g<AC){v++;if(!AK[v].filled){u.push({idx:v,fill:true});}}else{break;}}}if(t){this.parent.showDownloadStatus(AD);}else{if(this.parent.closeDownloadStatus){this.parent.closeDownloadStatus();}}return u;},addHilitePosition:function(g,j,f){var k=this.hiliteCellsMap[g];if(!k){this.hiliteCellsMap[g]={pos:[],nodes:[]};}var h=j-(this.pageNum||0)*this.rowsPerPage;this.hiliteCellsMap[g].pos.push({row:h,cell:f,page:this.pageNum});},setHilites:function(j,k){var l=k.getAttribute("ei"),m=this.eiMap[l],f=this.getNodesByPositions(m);if(!f.length){this._super(j,k);return ;}for(var h=0,g=f.length;h<g;h++){this._super(j,f[h]);}},addExtraInfoMap:function(g,h,f){if(!this.eiMap[g]){this.eiMap[g]=[];}this.eiMap[g].push(this.getPosObj(h,f));},addPositionMap:function(g,h,f){if(!this.posMap[g]){this.posMap[g]=this.getPosObj(h,f);}},addTitleHeaderPositionMap:function(h,f,g){var j=this.getPosObj(h,f);j.obj=g;this.thPosMap.push(j);},getPosObj:function(g,j){var h=this.pageNum||0,f=this.rowsPerPage||0;return{row:g-h*f,cell:j,page:h};},getNodeByPosition:function(f){return this.tableNode.tBodies[f.page].rows[f.row].cells[f.cell];},getRowIdxByCell:function(f){var g=this.posMap[f._ei];return g.page*this.rowsPerPage+g.row;},getNodesByPositions:function(n){var k=[];for(var h in n){var q=n[h],g=(q&&q.page)||0,f=q&&q.row,l=q&&q.cell,j=this.tableNode.tBodies[g],m=j&&j.rows[f],o=m&&m.cells[l];if(o){k.push(o);}}return k;},getPageHeight:function U(f){var g=this.tableNode.tBodies;return(g&&g[f]&&g[f].offsetHeight)||0;},getTargetCell:function(o,n){var l=0,g=0,m;for(m=this.totalPages;g<m;g++){l+=this.getPageHeight(g);if(n<=l){break;}}var k=this.tableNode.tBodies[g];if(k){for(g=0,m=k.rows.length;g<m;g++){var r=k.rows[g];for(var f=0,q=r.cells.length;f<q;f++){var p=r.cells[f];if(p.offsetTop+p.offsetHeight>=n){if(o>=p.offsetLeft&&o<=p.offsetLeft+p.offsetWidth){return p;}}else{break;}}}}},postRenderPagesCleanup:function K(){var h=this.parent;if(h&&h.gridData&&h.gridData.afc){var g=this.tableNode;if(g&&(this.lastWidth!==g.offsetWidth)){if(h.onGridWidthChanged){h.onGridWidthChanged();}mstrmojo.array.forEach(this.pageStatus,function(j){delete j.height;});this.lastWidth=g.offsetWidth;}var f=C(h,"adjustAutoWidth");if(f){f.adjustAutoWidth(h);}}if(h.gridPagesRendered){h.gridPagesRendered();}if(mstrmojo.dom.isIE&&!mstrmojo.dom.isIE8){B(this.domNode);}if(h&&h.maskNode){Y.removeClass(h.maskNode,"wait");}this.hightLightChangedCells();},hightLightChangedCells:function M(){var o=this.cp.getUpdatedRows(),k=this,n,f,m,p,h,j,l,g=[];if(o){mstrmojo.hash.forEach(o,function(r,q){l=parseInt(q,10);n=k.cp.getRowCells(l);f=F(l,k);m=f.length;p=n.length-1;if(p>=0){for(h=m-1;h>=0;h--){j=f[h];if(p<0){break;}if(n[h]._d){var t=j.style.backgroundColor,s=j.style.color;g.push({dom:j,bgcolor:t,ftcolor:s});j.style.backgroundColor=O.getHighlightColor(O.rgbStr2rgb(d.getStyleValue(j,"backgroundColor"),true));j.style.color=O.getContrastingColor(O.rgbStr2hex(d.getStyleValue(j,"backgroundColor")),"#ffffff","#000000");delete n[h]._d;}p--;}}});if(g.length>0){window.setTimeout(function(){mstrmojo.array.forEach(g,function(q){q.dom.style.backgroundColor=q.bgcolor;q.dom.style.color=q.ftcolor;});},300);}}},postRenderingCleanup:function A(){var f=this.parent;if(f&&this.connectedScrollbox){f.disconnectScrollbox(this);}this.connectedScrollbox=false;if(f&&!f.scrollboxHeightFixed){var g=C(f,"performCanGrowCanShrink");if(g){g.performCanGrowCanShrink([f],true);}}},getRowInfoByPosition:function(f){return this.cp.getRowCellInfo(f);},unrender:function X(f){J.call(this);if(this.connectedScrollbox){this.parent.disconnectScrollbox(this);this.connectedScrollbox=false;}this.numPagesRendered=0;this.lastWidth=0;this.isDownloading=false;this.unMarkAllPages();this._super(f);},dataDownloaded:function W(){this.isDownloading=false;this.initPageStatus();this.onscroll();}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.viz.GraphMatrixHelper","mstrmojo.vi.viz.MapHelper","mstrmojo.vi.viz.KnownVisualizations","mstrmojo.vi.util.ThresholdUtils","mstrmojo.gm.GMEnums","mstrmojo.gmaps.MapEnums","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.gmaps._AreaMapHelper");var X=mstrmojo,S=X.array,W=X.vi.viz,L=X.gmaps,M=W.GraphMatrixHelper,V=W.EnumDSSDropZones,A=W.KnownVisualizations,D=X.vi.util.ThresholdUtils,Q=X.chart.model.enums.EnumDSSObjectType,H=L.EnumGraphicType,N=L.EnumPropertyType,Z=X.gm.EnumABLDirection,J=L._AreaMapHelper;function P(a){return a&&a.getHostModel&&a.getHostModel();}function F(b){var a=false;if(b.t!==4){S.forEach(b.fs||[],function(c){if(c.ftr||c.bftp===1||c.bftp===8||c.bftp===9){a=true;return false;}});}return a;}function G(b,d){var a=b.getHost(),c=a.GMController;if(c){switch(d){case"bp":return c.isBoxPlot;case"wf":return c.isWaterfall;case"hg":return c.isHistogram;default:break;}}return false;}function I(AF,g,AI,o,r){var f=AI.dz,AG=AI.gsi||{},c=[],h=false,b=false,d=false,w=o.getHost().getChartStyle()==="NewGraphMatrixVisualizationStyle",j=G(o,"bp"),a=G(o,"wf"),AC=G(o,"hg"),p=function(AJ){return AJ.shape==="Pie"||AJ.shape==="Ring";},AD=function(){var AJ=o.getHost();return AJ&&AJ.GMController&&AJ.GMController.isBubbleOrScatter();},x=function(AJ,AN){c.push({act:"addDropZoneUnit",zoneId:AJ,datasetId:g,unitId:AF.did,unitType:AF.t,unitPos:AN||0});h=true;d=(AJ===V.ColorBy);b=(AJ===V.AdditionalMetrics);var AM=["Reserved","Rows","Columns","XAxis","YAxis","BreakBy","SliceBy","ColorBy","SizeBy"],AL=AM[AJ],AK=AF.t===4?"TemplateMetric":"TemplateUnit";if(f[AL]){if(!f[AL][AK]){f[AL][AK]=[];}f[AL][AK].push(AF);}},v=function(AJ,AK){c.push({act:"removeDropZoneUnit",zoneId:AJ,unitId:AK.did,unitType:AK.t});},AB=function(AJ){c.push({act:"addDropZoneUnit",zoneId:AJ,unitId:"00000000000000000000000000000000",unitType:0});},AE=new W.GraphMatrixHelper({data:AI}),AH=function(AJ){if(!AE.shape){AE.shape=AJ;r=true;}},m=function(AJ,AP){x(AJ,AP);if(!AE.metricsDropZone){if(AJ===V.XAxis&&AE.xAxisObjects.length){AB(V.Columns);}else{if(AJ===V.YAxis&&AE.yAxisObjects.length){AB(V.Rows);}}}var AM=o.getHost(),AN=AM.GMController,AL,AO=AN.getChartInfo(),AK={dndGM:false};if(AN.shallWeUseGroupInfo){AL=AN.getGroupInfo();if((AO.dirc===Z.VERTICAL&&AJ===V.YAxis)||(AO.dirc===Z.HORIZONTAL&&AJ===V.XAxis)){AL=o.fillGroupInfo(AK,AL,AF.did,true);}AN.setGroupInfo(AL);r=true;}};AE.setData(AI.dz);AE.setMetricsDropZone(AI.dz);if(AF.t===Q.DssTypeMetric){if(AC){if(!AE.yAxisObjects.length){x(V.YAxis);}else{v(V.YAxis,AE.yAxisObjects[0]);x(V.YAxis);}}else{if(AE.exists(AF,"yAxisObjects")||AE.exists(AF,"xAxisObjects")||AE.exists(AF,"sizeByObjects")||AE.exists(AF,"colorByObjects")||AE.exists(AF,"angleObjects")){var AA=!AE.exists(AF,"yAxisObjects")&&!AE.exists(AF,"xAxisObjects");if(AA&&(!AE.yAxisObjects.length||AE.yAxisObjects[0].t===4)){m(V.YAxis);}else{if(AA&&(!AE.xAxisObjects.length||AE.xAxisObjects[0].t===4)){m(V.XAxis);}else{if(!AE.angleObjects.length&&p(AE)){x(V.Angle);}else{if(!j&&!AE.colorByObjects.length){x(V.ColorBy);}else{if(!AE.sizeByObjects.length||(!AE.exists(AF,"sizeByObjects")&&AD())){x(V.SizeBy);}}}}}}else{if(!j&&!AE.angleObjects.length&&p(AE)){x(V.Angle);}else{if((!AE.yAxisObjects.length)&&(!AE.xAxisObjects.length)){m(V.YAxis);if(!j&&!a){AH(M.PROP_SHAPE_BAR);}}else{if(AE.yAxisObjects.length&&!AE.xAxisObjects.length){if((j||a)&&AE.yAxisObjects[0].t===4){m(V.YAxis);}else{if(!AE.exists(AF,"yAxisObjects")){m(V.XAxis);if(!j&&!a){AH(o.isMetricZone(V.YAxis)?M.PROP_SHAPE_CIRCLE:M.PROP_SHAPE_BAR);}}}}else{if((!AE.yAxisObjects.length)&&AE.xAxisObjects.length){if((j||a)&&AE.xAxisObjects[0].t===4){m(V.XAxis);}else{if(!AE.exists(AF,"xAxisObjects")){m(V.YAxis);if(!j&&!a){AH(o.isMetricZone(V.XAxis)?M.PROP_SHAPE_CIRCLE:M.PROP_SHAPE_BAR);}}}}else{if((AE.xAxisObjects[0].t!==4)&&(AE.yAxisObjects[0].t===4)&&!AE.exists(AF,"yAxisObjects")&&!AE.exists(AF,"sizeByObjects")&&!AE.exists(AF,"colorByObjects")){m(V.YAxis);if(AE.metricsDropZone!==M.PROP_COLUMNS&&AE.metricsDropZone!==M.PROP_ROWS&&(!AE.colorByObjects.length||AE.colorByObjects[0].t!==4)){AB(V.ColorBy);}}else{if((AE.xAxisObjects[0].t===4)&&(AE.yAxisObjects[0].t!==4)&&!AE.exists(AF,"xAxisObjects")&&!AE.exists(AF,"sizeByObjects")&&!AE.exists(AF,"colorByObjects")){m(V.XAxis);if(AE.metricsDropZone!==M.PROP_COLUMNS&&AE.metricsDropZone!==M.PROP_ROWS&&(!AE.colorByObjects.length||AE.colorByObjects[0].t!==4)){AB(V.ColorBy);}}else{if((AE.xAxisObjects[0].t===4)&&(AE.yAxisObjects[0].t===4)&&!AE.exists(AF,"xAxisObjects")&&!AE.exists(AF,"yAxisObjects")&&!AE.exists(AF,"sizeByObjects")&&!AE.exists(AF,"colorByObjects")){if(!j&&!AE.colorByObjects.length&&AE.metricsDropZone!==M.PROP_COLORBY){x(V.ColorBy);}else{if(!AE.sizeByObjects.length&&AE.shape!=="Area"){x(V.SizeBy);}else{if(AE.xAxisObjects.length===1){m(V.XAxis);}else{if(AE.yAxisObjects.length===1){m(V.YAxis);}else{if(AE.sizeByObjects.length===1&&AE.shape!=="Area"){x(V.SizeBy);}else{if(!AE.exists(AF,"tooltipMetrics")){x(V.AdditionalMetrics);}}}}}}}else{if(!j&&!AE.colorByObjects.length&&AE.metricsDropZone!==M.PROP_COLORBY){x(V.ColorBy);}else{if(!AE.sizeByObjects.length){x(V.SizeBy);}else{if(!AE.exists(AF,"tooltipMetrics")){x(V.AdditionalMetrics);}}}}}}}}}}if((!b)&&h){if(AE.exists(AF,"tooltipMetrics")){var u=S.find(AE.tooltipMetrics,"did",AF.did);if(u>-1){AE.tooltipMetrics.splice(u,1);v(V.AdditionalMetrics,AF);}}}}if(h&&d){var t=o.getHost(),l=t.getVisType().vt,k=D.getDefaultGMThreshold(l);D.addThresholds(t.model,t,t.node,AF,c,k.colors,k.ranges,false);}}}else{if(AC){x(V.XAxis);}else{if((AG.rows||[]).concat(AG.cols||[]).some(function(AJ){return AJ.did===AF.did;})){if(j&&AE.exists(AF,"breakByObjects")){}else{if(!AE.colorByObjects.length||(AE.colorByObjects[0].t!==4&&!AE.exists(AF,"colorByObjects"))){x(V.ColorBy);}}}else{if(!j&&!AE.sliceObjects.length&&p(AE)){x(V.SliceBy);if(!AE.colorByObjects.length){x(V.ColorBy);}}else{if((!AE.yAxisObjects.length)&&(!AE.xAxisObjects.length)){x(V.XAxis);if(!j&&!a){AH(F(AF)?M.PROP_SHAPE_LINE:M.PROP_SHAPE_BAR);}}else{if((AE.yAxisObjects.length)&&(!AE.xAxisObjects.length)){if((j||a)&&AE.yAxisObjects[0].t!==4){x(V.Rows);}else{x(V.XAxis);if(!j&&!a){AH(F(AF)&&AE.yAxisObjects[0]===4?M.PROP_SHAPE_LINE:M.PROP_SHAPE_BAR);}}}else{if((!AE.yAxisObjects.length)&&(AE.xAxisObjects.length)){if((j||a)&&AE.xAxisObjects[0].t!==4){x(V.Columns);}else{x(V.YAxis);if(!j&&!a){AH(F(AF)&&AE.xAxisObjects[0]===4?M.PROP_SHAPE_LINE:M.PROP_SHAPE_BAR);}}}else{if((AE.xAxisObjects[0].t!==4)&&(AE.yAxisObjects[0].t===4)){if(j&&!AE.breakByObjects.length){x(V.BreakBy);}else{if(!AE.colorByObjects.length&&!j){x(V.ColorBy);if(!AE.exists(AF,"breakByObjects")){x(V.BreakBy);}}else{x(V.Columns);}}}else{if((AE.xAxisObjects[0].t===4)&&(AE.yAxisObjects[0].t!==4)){if((j||a)&&!AE.breakByObjects.length){x(V.BreakBy);}else{if(!AE.colorByObjects.length&&!j){x(V.ColorBy);if(!AE.exists(AF,"breakByObjects")){x(V.BreakBy);}}else{x(V.Rows);}}}else{if((AE.xAxisObjects[0].t!==4)&&(AE.yAxisObjects[0].t!==4)){x(V.Columns);}else{if((AE.xAxisObjects[0].t===4)&&(AE.yAxisObjects[0].t===4)){if((j||a)&&!AE.breakByObjects.length){x(V.BreakBy);}else{if(!AE.colorByObjects.length&&!j){x(V.ColorBy);if(!AE.exists(AF,"breakByObjects")){x(V.BreakBy);}}else{if(!AE.columnObjects.length&&AE.rowObjects.length&&AE.rowObjects[0].t!==4){x(V.Rows);}else{x(V.Columns);}}}}}}}}}}}}}}var n=[];if(c.length){if(w){x(V.AdditionalMetrics,o.getTooltipDropzoneIdx(AF));}var s=o.getUpdateTemplateAction(c);var e=o.docModel,z=e.controller.view.builder,q=z.getLayoutVIMap(e.getCurrentLayoutKey()).getComponent(mstrmojo.vi.models.VIComponentMap.TYPES.FILTER_STACK);if(q&&!mstrApp.isInVFConfigMode){s.partialRetrieval.nodes.push(q.k);}n.push(s);}if(r){n.push({act:"setProperty",nodeKey:AI.k,prs:"FormattingWidget",pri:4,v:mstrmojo.string.encodeXMLAttribute(AE.getXml())});}if(n.length){o.clearCardinalityFlags();o.findLargeItemsForAddUnits([AF]);}return n;}function R(d,f,e,a){var b,c=true;function g(l,n,k){var m=a.getZoneModelByZoneId(l);if(a.getUnitIndexInZone(m,d)===-1&&(!k||k(m))){var j=n?0:m.items.length;b=a.getAddItemActions(m,[d],j,false,n?m.items[j]:null,f);m.items.push(d);return false;}return true;}function h(j){return j.items.length===0;}if(!a.isMetric(d)){c=g(V.ColorBy,false,h);c=c&&g(V.Grouping);if(b){a.clearCardinalityFlags();a.findLargeItemsForAddUnits([d]);}}else{c=g(V.SizeBy,false,h);c=c&&g(V.ColorBy,false,h);c=c&&g(V.SizeBy,true,function(j){return j.items[0].did===a.getZoneModelByZoneId(V.ColorBy).items[0].did;});c=c&&g(V.AdditionalMetrics,false,function(){return a.getUnitIndexInZone(a.getZoneModelByZoneId(V.SizeBy),d)===-1&&a.getUnitIndexInZone(a.getZoneModelByZoneId(V.ColorBy),d)===-1;});}return b?[a.docModel.getDataService().getUpdateTemplateAction(a.getHost().k,b)]:[];}function U(c,e,d,a){var b=null,f=!a.isMetric(c)?[V.FromItem,V.ToItem]:[V.ColorBy,V.ItemSize,V.SizeBy];S.forEach(f,function(g){var h=a.getZoneModelByZoneId(g);if(h.items.length===0){b=a.getAddItemActions(h,[c],0,e);h.items.push(c);return false;}});if(b){a.clearCardinalityFlags();a.findLargeItemsForAddUnits([c]);return[a.docModel.getDataService().getUpdateTemplateAction(a.getHost().k,b)];}return[];}function E(b){var d=8,e=1,a=S.find(b.fs,"idf",true);if(a==-1){return null;}var c=b.fs[a];return((b.da||c.obf)&&(c.bftp===d||c.bftp===e))?c:null;}function C(a){return !!(a.fs&&E(a));}function O(e,g,f,a){var c=null,h=!a.isMetric(e)?[V.BreakBy,V.Trend]:[V.Metric];trendZone=a.getZoneModelByZoneId(V.Trend);if(C(e)&&trendZone.items.length===0){c=a.getAddItemActions(trendZone,[e],0,g);trendZone.items.push(e);}else{for(var d=0;d<h.length;d++){var b=a.getZoneModelByZoneId(h[d]);if(b.items.length===0){c=a.getAddItemActions(b,[e],0,g);b.items.push(e);break;}}}if(c){a.clearCardinalityFlags();a.findLargeItemsForAddUnits([e]);return[a.docModel.getDataService().getUpdateTemplateAction(a.getHost().k,c)];}return[];}function Y(c,e,d,a){var b=null,f=!a.isMetric(c)?[V.GeoAttribute,V.Layout]:[V.ColorBy,V.SizeBy,V.AdditionalMetrics];S.forEach(f,function(g){var h=a.getZoneModelByZoneId(g);if((g===V.AdditionalMetrics||h.items.length===0)&&a.isZoneAvalaible(g)){b=a.getAddDropZoneUnitsActions(h,[c],0,{datasetId:e});return false;}});return b?[a.docModel.getDataService().getUpdateTemplateAction(a.getHost().k,b)]:[];}function K(AB,g,AH,l,c,u){var AC=AH.gsi||{},k=l.getHost(),p=k.fnGetWidget(),v=p&&p.scriptClass==="mstrmojo.mapbox.VisMapbox",m=[],o=false,x=l.getZoneModelByZoneId(V.ColorBy),z=l.getZoneModelByZoneId(V.SizeBy),w=l.getZoneModelByZoneId(V.Angle),r=l.getZoneModelByZoneId(V.SliceBy),e=l.getZoneModelByZoneId(V.AdditionalMetrics),AA=mstrmojo.vi.viz,n=AA.MapHelper,h=false,d=function(AN,AM,AK,AO){if(AN){var AL=l.getCreateDropZonesAction(AK);m=m.concat(AL.length?l.getUpdateTemplateAction(AL):[]);m.push(l.getUpdateTemplateAction([{act:"addDropZoneUnit",zoneId:AK,unitId:AN,unitType:AM,datasetId:AO}]));if(AK===V.ColorBy){m.push(l.getUpdateTemplateAction(D.addThresholds(k.model,k,k.node,AB)));}}switch(AK){case V.GeoAttribute:c.geoAttribute=AN;break;case V.Latitude:c.latitude=AN;break;case V.Longitude:c.longitude=AN;break;case V.SliceBy:if(!c.slice){c.slice=[];}c.slice.push(AN);break;case V.ColorBy:c.colorBy=AN;break;case V.SizeBy:c.sizeBy=AN;break;case V.Angle:c.angle=AN;break;case V.AdditionalMetrics:c.tooltip.push(AN);break;}h=true;},j=function(AM,AL,AK,AN){d(AM,AL,AK,AN);if(v&&n.shouldSyncItemToTooltipZone(AM,AK,c&&c.tooltip)){d(AM,AL,V.AdditionalMetrics,AN);}},AJ=function(AN,AM,AK){if(AN){m.push(l.getUpdateTemplateAction([{act:"removeDropZoneUnit",zoneId:AK,unitId:AN,unitType:AM}]));}switch(AK){case V.geoAttribute:c.geoAttribute="";break;case V.Latitude:c.latitude="";break;case V.Longitude:c.longitude="";break;case V.SliceBy:var AL=c.slice.indexOf(AN);if(AL!==-1){c.slice(AL,1);}break;case V.Angle:c.angle="";break;case V.ColorBy:c.colorBy="";break;case V.SizeBy:c.sizeBy="";break;case V.AdditionalMetrics:c.tooltip=S.filter(c.tooltip,function(AO){return AO!==AN;},{max:c.tooltip.length});break;}},AG=function(AK,AL){m.push(l.getUpdateTemplateAction({act:"addForm",unitId:AK,attFormId:AL,unitPos:1}));};c.setWidget(k);S.forEach((AC.rows||[]).concat(AC.cols||[]),function(AK){if(AK.did===AB.did){o=true;return false;}});if(o){return[];}switch(AB.t){case 4:if(x&&!x.items.length){j(AB.did,AB.t,V.ColorBy,g);}else{if(z&&!z.items.length){j(AB.did,AB.t,V.SizeBy,g);}else{if(w&&!w.items.length){j(AB.did,AB.t,V.Angle,g);}else{if(e){var t=AB.did;if(c.colorBy.indexOf(t)<0&&c.sizeBy.indexOf(t)&&c.angle.indexOf(t)&&c.tooltip.indexOf(t)<0){j(t,AB.t,V.AdditionalMetrics,g);}}}}}break;default:var q=p.edtModel.getEditingPropertyVal(N.graphicType),a=!c.geoAttribute&&(!c.latitude&&!c.longitude||q===H.Area),b=c.getGeoForm(AB,function(AK){return n.isGeoRoleSupportArea(AK.fgr);}),f=c.getLatitudeForm(AB),AI=c.getLongitudeForm(AB),s=function(){var AK=c.vp,AM=c.tooltip;if(!n.canShowSizeByZone(AK)&&c.sizeBy&&AM.indexOf(c.sizeBy)<0){j(c.sizeBy,4,V.AdditionalMetrics);AJ(c.sizeBy,4,V.SizeBy);}if(!n.canShowColorByZone(AK)&&c.colorBy&&AM.indexOf(c.colorBy)<0){j(c.colorBy,4,V.AdditionalMetrics);AJ(c.colorBy,4,V.ColorBy);}if(!n.showAngleZone(AK)&&c.angle&&AM.indexOf(c.angle)<0){j(c.angle,4,V.AdditionalMetrics);AJ(c.angle,4,V.Angle);}if(!n.showSliceZone(AK)&&c.slice&&c.slice.length>0){var AL=c.slice;S.forEach(AL,function(AN){j(AN,12,V.AdditionalMetrics);AJ(AN,12,V.SizeBy);});}};if(a&&c.supportAreaMap&&b&&!((q!==H.Area)&&(f||AI))){c.setMapType(H.Area);c.setUseAttributeForm(false);j(AB.did,AB.t,V.GeoAttribute,g);AG(AB.did,b.fid);}else{var AE=(u&&AB.card>500)?H.Density:((q!==H.Area)?q:H.Marker);if(f&&AI&&a){j(AB.did,AB.t,V.GeoAttribute,g);c.setMapType(AE);c.setUseAttributeForm(true);AG(AB.did,f.fid);AG(AB.did,AI.fid);j(f.fid,21,V.Latitude,g);j(AI.fid,21,V.Longitude,g);}else{if((f||n.isLatitude(AB.n))&&(!AI&&!n.isLongitude(AB.n))&&!c.geoAttribute&&!c.latitude){j(AB.did,AB.t,V.Latitude,g);c.setMapType(AE);c.setUseAttributeForm(false);}else{if((!f&&!n.isLatitude(AB.n))&&(AI||n.isLongitude(AB.n))&&!c.geoAttribute&&!c.longitude){j(AB.did,AB.t,V.Longitude,g);c.setMapType(AE);c.setUseAttributeForm(false);}else{if(!f&&!AI&&!b&&r){j(AB.did,AB.t,V.SliceBy,g);}else{if(c.tooltip.indexOf(AB.did)<0){j(AB.did,AB.t,V.AdditionalMetrics,g);}}}}}}if(h){s();}break;}if(h){m.push({act:"setProperty",nodeKey:AH.k,prs:"FormattingWidget",pri:4,v:mstrmojo.string.encodeXMLAttribute(c.getXml())});}if(m.length){var AD=AH.visName,q=c.getMapType(),AF=c.getLayerName();l.addAttributeNameAndTargetVisForAddUnits(AH,[AB],AD,q,AF);l.clearCardinalityFlags();l.findLargeItemsForAddUnits([AB]);}return m;}function B(n,e,d,l){var p=l.getHost().model,k=d.gsi||{},o=k.rows||[],h=k.cols||[],g=k.mx||[],c=[],b,j,a,m;l.clearCardinalityFlags();if(S.find(o.concat(h).concat(g),"did",n.did)===-1&&!p.hasSameRecursiveAttributeGroup(n)){m=!!S.filterOne(h,function(q){return q.t!==4;});a=!!S.filterOne(o,function(q){return q.t!==4;});if(n.t===4){b=-1;if(g.length===0){if(!a&&!!m){b=1;j=o.length;l.findEstimatedTotalRow([n],b);}else{b=2;j=h.length;}}else{if(o.some(function(q){return q.did==="-1";})){var f=1;l.findEstimatedTotalRow([n],f);}}j=g.length;}else{if(m&&!a){b=2;j=h.length;l.findLargeItemsForAddUnits([n]);l.findTotalColumnCount([n],null);}else{b=1;j=o.length;l.findEstimatedTotalRow([n],b);}}c.push({act:"updateTemplate",keyContext:d.k,actions:[p.getAddTemplateUnitAction(n,e,b,j)]});}return c;}mstrmojo.vi.models.DatasetDoubleClick=mstrmojo.provide("mstrmojo.vi.models.DatasetDoubleClick",{addObject:function(h,c,g){var b=P(g),a=[],f=g.getHost();if(!h||!b){return a;}var j=b.visName||"Grid";switch(A.getDefinition(j).id){case A.GRAPHMATRIX:case A.NEWGRAPHMATRIX:a=I(h,c,b,g);break;case A.ESRIMAP:case A.GOOGLEMAP:a=K(h,c,b,g,new W.MapHelper({data:b}),true);break;case A.MAPBOX:a=K(h,c,b,g,new W.MapHelper({data:b}),false);break;case A.HEATMAP:a=R(h,c,b,g);break;case A.NETWORK:a=U(h,c,b,g);break;case A.KPICARD:a=O(h,c,b,g);break;case A.IMAGELAYOUT:a=Y(h,c,b,g);break;case A.CUSTOM:a=(g.getCustomDropZones&&g.getCustomDropZones())?[]:B(h,c,b,g);break;default:a=B(h,c,b,g);break;}if(c!==b.datasetId){var e=g.getHost().model.data.gsi;var d=e?(e.rows||[]).concat(e.cols||[]).concat(e.mx||[]):[];if(c&&(a.length||mstrmojo.array.find(d,"did",h.did)!==-1)){a.push({act:"editNode",nodeKey:f.k,datasetId:c});}}return a;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.vi.util.ThresholdUtils","mstrmojo.array");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates");var G=mstrmojo,F=G.array,J=G.vi.viz,D=J.EnumVisualizationTemplates,E=mstrmojo.vi.util.ThresholdUtils;mstrmojo.vi.viz.VisualizationTransition=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.vi.viz.VisualizationTransition",vis:null,transitionDropZones:mstrmojo.getMissingFn(),addClearAllThresholdsActions:function I(L){var K=this.vis;E.addClearAllThresholdsActions(K.model,K.node,L);},addThresholds:function B(O,P,Q,L,K,M){var N=this.vis;return E.addThresholds(N.model,N,N.node,P,Q,L,K,M);},clearImageThreshold:function C(N,M){var L,K;for(key in N){if(N.hasOwnProperty(key)){L=N[key];if(L&&L.length){for(K=0;K<L.length;K++){if(!(L[K].fmt&&L[K].fmt.bc)){this.addClearAllThresholdsActions(M);break;}}}}}},isGraphMatrix:function H(L){var K=false;switch(L){case D.UNKNOWN_GRAPHMATRIX_TYPE:case D.GRAPHMATRIXBUBBLECIRCLEMM:case D.GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case D.GRAPHMATRIXBUBBLEGRIDSQUAREAA:case D.GRAPHMATRIXBUBBLESQUAREAM:case D.GRAPHMATRIXBUBBLESQUAREMM:case D.GRAPHMATRIXHORIZONTALBARCLUSTERED:case D.GRAPHMATRIXHORIZONTALBARSTACKED:case D.GRAPHMATRIXHORIZONTALBARPERCENT:case D.GRAPHMATRIXHORIZONTALLINECLUSTERED:case D.GRAPHMATRIXHORIZONTALLINESTACKED:case D.GRAPHMATRIXHORIZONTALLINEPERCENT:case D.GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case D.GRAPHMATRIXHORIZONTALAREACLUSTERED:case D.GRAPHMATRIXHORIZONTALAREASTACKED:case D.GRAPHMATRIXHORIZONTALAREAPERCENT:case D.GRAPHMATRIXHORIZONTALAREAAUTOMATIC:case D.GRAPHMATRIXSCATTERCIRCLEMM:case D.GRAPHMATRIXSCATTERGRIDCIRCLEAA:case D.GRAPHMATRIXSCATTERGRIDSQUAREAA:case D.GRAPHMATRIXSCATTERSQUAREAM:case D.GRAPHMATRIXSCATTERSQUAREMM:case D.GRAPHMATRIXVERTICALBARCLUSTERED:case D.GRAPHMATRIXVERTICALBARSTACKED:case D.GRAPHMATRIXVERTICALBARPERCENT:case D.GRAPHMATRIXVERTICALBARAUTOMATIC:case D.GRAPHMATRIXVERTICALLINECLUSTERED:case D.GRAPHMATRIXVERTICALLINESTACKED:case D.GRAPHMATRIXVERTICALLINEPERCENT:case D.GRAPHMATRIXVERTICALLINEAUTOMATIC:case D.GRAPHMATRIXVERTICALAREACLUSTERED:case D.GRAPHMATRIXVERTICALAREASTACKED:case D.GRAPHMATRIXVERTICALAREAPERCENT:case D.GRAPHMATRIXVERTICALAREAAUTOMATIC:case D.GRAPHMATRIXPIE:case D.GRAPHMATRIXRING:case D.GRAPHMATRIXVERTICALHISTOGRAM:case D.GRAPHMATRIXGRIDCHART:case D.GRAPHMATRIXVERTICALBOXPLOT:case D.GRAPHMATRIXHORIZONTALBOXPLOT:case D.GRAPHMATRIXVERTICALWATERFALL:case D.GRAPHMATRIXHORIZONTALWATERFALL:K=true;break;default:break;}return K;},filterGMTrainingMetric:function A(K,P){var L,M,O=[];if(!K||!K.ColorBy||!P){return P;}var N=function(Q){return(Q&&Q.TemplateMetric)||[];};L=N(K.AngleBy).concat(N(K.Rows)).concat(N(K.YAxis)).concat(N(K.Columns)).concat(N(K.XAxis)).concat(N(K.ColorBy)).concat(N(K.SizeBy)).concat(N(K.AdditionalMetrics));F.forEach(P,function(Q){M=false;F.forEach(L,function(R){if(Q.did===R.id){M=true;return false;}});if(M){O.push(Q);}});return O;}});}());(function(){mstrmojo.requiresCls("mstrmojo.NumStepperContentProvider","mstrmojo.num","mstrmojo.array");var A=mstrmojo.num,E=mstrmojo.array;var C="?";function B(H,G){var J=G?H.max:H.min,F=G?H.min:H.max,I=H.getValGroup(G?1:-1);return(J===null||(G?(I.every(function(K){return K<=J;})):(I.every(function(K){return K>=J;})))||(F!==null&&H.canLoop));}function D(I,H){var G=I.min,F=I.max,J=I.getValGroup(H?1:-1)||[];if((H&&F!==null&&J.some(function(K){return K>F;})||(!H&&G!==null&&J.some(function(K){return K<G;})))){if(I.canLoop){J.forEach(function(L,K){L=((L-G)%(F-G+1))+G;L=(L>=G)?L:L+(F-G+1);J[K]=L;});}else{return ;}}I.item[I.valField]=I.curValGroup=J;I.onTraverse();}mstrmojo.NumGroupStepperContentProvider=mstrmojo.declare(mstrmojo.NumStepperContentProvider,null,{scriptClass:"mstrmojo.NumGroupStepperContentProvider",curValGroup:null,init:function(F){this._super(F);},_initCurrent:function(){var H=this.item,F=this.curValGroup=H[this.valField];if(F===null||F===undefined){var G=this.min;this.curValGroup=G!==null?[G]:0;}this.curValGroup=E.ensureArray(this.curValGroup);},next:function(){D(this,true);},prev:function(){D(this,false);},hasPrev:function(){return B(this,false);},hasNext:function(){return B(this,true);},getValGroup:function(I){var F=this.curValGroup,G=this.interval,H=[];(F||[]).forEach(function(K,J){H[J]=F[J]+(G*(I||0));});return H;},getVal:function(){var F=null;(this.curValGroup||[]).forEach(function(G){if(F===null){F=G;}else{if(F!==C&&G!==F){F=C;}}});return F;},setVal:function(H){var I=this.min,G=this.max,F=this.curValGroup;if(typeof H!=="number"||isNaN(H)||A.inNumericRange(H,I,G)!==0){return ;}(F||[]).forEach(function(K,J){F[J]=H;});this.onTraverse();},_set_curValGroup:function(J,I){var H=this.min,G=this.max,F=this.getValGroup();if(I.some(function(K){return typeof K!=="number";})||I.some(function(K){return isNaN(K);})||I.every(function(L,K){return L===F[K];})||I.every(function(K){return A.inNumericRange(K,H,G)!==0;})){return false;}this.item[this.valField]=this.curValGroup=I;return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui._HasScroller","mstrmojo.css","mstrmojo.DI.DIHelpers");var F=mstrmojo.css,H=mstrmojo.string,A=mstrmojo.desc(14058,"Show Details"),E=mstrmojo.desc(14059,"Hide Details"),B=mstrmojo.DI.DIHelpers,D=mstrmojo.desc(14060,"We are sorry for the inconvenience. Please {contact} your administrator for help.").replace("{",'<span class="dyn-link">').replace("}","</span>");mstrmojo.ui.editors.ErrorDialogContent=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",markupString:'<div class="mstrmojo-error-content {@cssClass}" mstrAttach:click><div class="scroll-container"><div>{@shortDesc}</div><div class="contact">'+D+'</div><div class="toggle-details-link" >'+A+'</div><div class="error-details">{@longDesc}</div></div></div>',markupSlots:{scrollNode:function(){return this.domNode.firstChild;},contactNode:function(){return this.domNode.firstChild.children[1].getElementsByClassName("dyn-link")[0];},toggleDetailsNode:function(){return this.domNode.firstChild.children[2];},errorDetailsNode:function(){return this.domNode.firstChild.children[3];}},markupMethods:{onshowDetailsChange:function(){var K=this.showDetails;this.toggleDetailsNode.innerHTML=K?E:A;F.toggleClass(this.domNode,"show-details",K);this.updateScrollbars();}},cssClass:undefined,shortDesc:undefined,longDesc:undefined,showDetails:false,showToggle:true,enableContactStr:true,allowHTML:false,init:function I(K){this._super(K);this.shortDesc=this.shortDesc||mstrmojo.desc(14061,"An error has occurred");},onclick:function J(K){var M=K.getTarget(),L,N=this.longDesc;if(M===this.contactNode){L="mailto:?subject="+encodeURI("Issue: "+this.shortDesc)+(N?("&body="+encodeURI("Detail:\r\n"+N)):"");mstrApp.openPage(L,"_self");}else{if(M===this.toggleDetailsNode){this.set("showDetails",!this.showDetails);this.parent.raiseEvent({name:"EditorResized"});this.parent.positionDialog();}}},setupScrollNodes:function C(){this.scrollNode=this.scrollNode;},preBuildRendering:function G(){this._super&&this._super();if(!this.allowHTML){this.longDesc=H.encodeHtmlString(H.decodeHtmlString(this.longDesc,true),true);}},postBuildRendering:function(){var K=this.domNode.firstChild.children[1];this._super&&this._super();!this.showToggle&&F.addClass(this.toggleDetailsNode,"hide");!this.enableContactStr&&F.addClass(K,"invisible");}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.func","mstrmojo.EnumRWUnitType ","mstrmojo.DocDataService","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.controllers.ControlUtils","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.models._PanelActions");var Q=mstrmojo.array,F=mstrmojo.hash,M=mstrmojo.string,K=mstrmojo.func,R=mstrmojo.vi.controllers.EnumPanelManipulationType,P=mstrmojo.vi.models.VIComponentMap.TYPES,N=mstrmojo.EnumRWUnitType,C=mstrmojo.vi.controllers.EnumEvents,H=mstrmojo.vi.controllers.ControlUtils,I=mstrmojo.DocDataService.REQUEST_DEFN_DATA,S=mstrmojo.vi.models._PanelActions.defnUpdatePanelRemoval;function D(w){var c=this.model,e=c.id,l=w.layoutKey,p=[].concat(w.panelKeys),X=c.getCurrentLayoutKey(),j,b=[];var f=c.getVIComponent(P.VIZ_CONTENT,l),g=f.id;var o=c.cmdMgr(),m=[];Q.forEach(p,function(AA){m.push(c.getRemoveVisPanelAction(AA));});if(f){var a=f.panels,x=[],Z=f.selectedIdx,z=a[Z],W=z&&z.k,q,U=false;Q.forEach(p,function(AB){var AA=Q.find(a,"k",AB);x.push(AA);if(AA===Z){U=true;}});var k=null;if(U){k=a[H.findNewSelectedIndex(x,Z,a.length)];}if(X===l){var v=f.model.getCurrentLayoutDef(),n=v.cgbMap,t=v.units,u,d,V,Y,h,s;j={};b=[];Q.forEach(p,function(AA){Q.forEach(a,function(AC,AB){if(Q.indexOf(x,AB)===-1){Q.forEach(AC.children,function(AD){Y=F.walk("boxContent.node.data.navpage",AD);if(Y&&Y===AA){b.push(AD.k);}});}});q=c.getPanel(AA,l);Q.forEach(q.children,function(AB){u=AB.k;F.forEach(n,function(AD,AC){h=t[AC];if(AD===u&&h){Q.forEach(h.scs,function(AE){s=AE.pnk;if(t[s]){b.push(s);}});}});d=AB.boxContent;V=d&&d.selectorControl;if(V){F.forEach(V.cgb,function(AC){if(t[AC]){b.push(AC);}});}});});if(k){m.push(c.getSetCurrentPanelAction(k.k));}}var r=function(AF){var AG,AD,AA,AH;var AE=mstrmojo.all[g],AC=AE.panels;AE.removePanelsByIndex(x);AE.selectedIdx=AC.indexOf(k||z);if(X===l){if(k){var AI=k.k;if(!k.defn.l&&AF){var AB=AE.model.getDataService().newUpdateWithoutCmd();AE.selectPanelDeferred(AB,AI,false,true);AB.cmd=AF.getInterimCmd();if(b.length){AD=AB.actions[0];AD.partialRetrieval=AD.partialRetrieval||{};AA=AD.partialRetrieval;AA.nodes=(AA.nodes||[]).concat(b);}AB.submit();}else{F.forEach(b,function(AJ){Q.forEach(AC,function(AK){AG=AK.getUnitByKey(AJ);if(AG){AG=AG.boxContent.node;AH=AG.data.navpage;j[AJ]={sc:AG.data.sc,an:AG.defn.an,data:AH&&AG.data};delete AG.data.sc;delete AG.defn.an;if(AH){AG.data={};}return false;}});});AE.selectPanel(AI,false,true);if(AF){AF.getInterimCmd().completeSubmit();}}}else{AF.getInterimCmd().completeSubmit();AE.notifyPanelSelector();}}else{AF.getInterimCmd().completeSubmit();}q=null;S.call(mstrmojo.all[e],true,l,p);};c.execute({execute:function(){this.submitInterim(m,{success:function(){r(o);}},{params:{suppressData:true}});},urInfo:{silent:false,undo:function(){var AD,AA=mstrmojo.all[g],AC=AA.panels,AB=[];Q.forEach(p,function(AE){AB.push(c.getPanel(AE,l));});AA.addChildren(AB);S.call(mstrmojo.all[e],false,l,p);AA.selectPanel(W,null,true);AA.sortPanels(Z);F.forEach(j,function(AF,AE){Q.forEach(AC,function(AG){AD=AG.getUnitByKey(AE);if(AD){AD=AD.boxContent.node;if(AF.data){AD.data=AF.data;}AD.data.sc=AF.sc;AD.defn.an=AF.an;return false;}});});},redo:r,callback:{success:function(AA){mstrmojo.all[e].raiseEvent({name:C.UPDATE_TOC});if(AA){mstrmojo.all[e].partialUpdate(AA.data,Q.hash(b),AA.defn,b);}}},extras:{style:{params:{treesToRender:b.length?3:1}}}}});}else{c.execute({execute:function(){this.submit(m,{success:function(){S.call(mstrmojo.all[e],true,l,p);}},{params:{suppressData:true}});},urInfo:{silent:true,undo:function(){S.call(mstrmojo.all[e],false,l,p);},redo:function(){S.call(mstrmojo.all[e],true,l,p);}}});}}function A(a){var c=this.model,g=c.id,d=a.layoutKey,W=a.panelKey,f=c.getVIComponent(P.VIZ_CONTENT,d),b=f.id,e,Z,Y,U=c.getPanel(W,d),V=Q.find(f.panels,"k",W)+1,h=c.createNewUnitNode(null,function(j){j.t=N.PANEL;return j;}),X=h.k;c.duplicatePanel(U,f,V,d,f.builder,{undo:function(){var j=mstrmojo.all[b];e=j.panels;Z=c.getPanel(X,d);if(Z){j.removePanel(Z);S.call(mstrmojo.all[g],true,d,X);Y=Z;j.selectPanel(U.k,false,true);}},redo:function(){var j=mstrmojo.all[b];j.addChildren([Z],V);S.call(mstrmojo.all[g],false,d,X);j.selectPanel(X,null,true);Y=null;},discard:function(){if(Y){Y.destroy();}}},h);}function O(W){var Y=this.model,d=Y.id,Z=W.layoutKey,b=[].concat(W.panelKeys),c=[].concat(W.toIdx),U=[].concat(W.fromIdx),a=Y.getVIComponent(P.VIZ_CONTENT,Z),V=a&&a.id,X=a&&a.selectedIdx;var e=!!(a)?function(h,g){var f=null;Q.forEach(b,function(l,k){f=mstrmojo.all[d].getPanel(l,Z);if(X===h[k]){X=g[k];}else{if(h[k]>X&&g[k]<=X){X++;}else{if(h[k]<X&&g[k]>=X){X--;}}}var j=mstrmojo.all[V];f=j.children[Q.find(j.children,"id",f.id)];j.changePanelPosition(f,h[k],g[k],Q.find(j.children,"k",f.k),X);});}:mstrmojo.emptyFn;Y.movePanelsInLayout(b,undefined,Z,c,U,e);}function B(X){var Z=this.model,a=X.layoutKey,W=X.panelKey,b=Z.getVIComponent(P.VIZ_CONTENT,a),Y=b&&b.id,U=Z.getPanel(W,a),V=X&&X.newTitle,c=X&&X.oldTitle;Z.updateTitle(V,c,W,a,"ttl",{success:function(d){if(U){if(U.destroyed===true){mstrmojo.all[Y].panels.forEach(function(e){if(e.k===W){U=e;}});}U.titleText=d;U.title=M.encodeHtmlString(d);Z.raiseEvent({name:"ontitleChange",newTitle:d,panelKey:U.k});}if(mstrmojo.all[Y]){mstrmojo.all[Y].notifyPanelSelector();}}});}function J(V){var W=this.model,b=this.view,a=W.getDataService(),X=V.layoutKey,c=V.panelStackKey,Z=W.getVIComponent(P.VIZ_CONTENT,X),Y,U;if(Z){W.execute({execute:function(){var d=a.newUpdate(this,null);b.showLayout((b._layouts||[]).filter(function(e){return e.k===X;})[0],undefined,d);Y=W.addPanel(d,c,X);W.addVisualizationDeferred(d,Y.k,X);W.selectNewPanel(d,Y.k);d.submit();},urInfo:{disablePU:true,treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(W)},discard:function(){if(U){U.destroy();}}});}else{W.execute({execute:function(){var f=a.newUpdate(this,null);b.showLayout((b._layouts||[]).filter(function(g){return g.k===X;})[0],undefined,f);var e={k:null};W.addPanel(f,c,X,e);e=e.k;var d=W.createNewUnitNode(null,null,null,null,X);f.addActions([W.getCopyEmptyTemplateAction(d.k,e,X),W.getSetCurrentPanelAction(e)]);f.submit();},urInfo:{disablePU:true,treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(W)},discard:function(){if(U){U.destroy();}}});}}function E(Y){var Z=this.model,f=Z.id,c=[].concat(Y.panelKeys),b=c[0],d=Y.srcPanelStackKey,X=Y.srcLayoutKey,W=Y.tgtPanelStackKey,U=Y.tgtLayoutKey,e=Y.toIdx,V=Y.isAllPageSelected,a;var g=function(m){var n=Z.getDataService(),l=Z.controller.view,o=n.newUpdate(),j=Z.getPanel(b,X),k,h;if(U){Z.markDirtyLayout(U);l.showLayout(l.getLayout(U),null,o);h={parentKey:W};m.urInfo=F.copy({undo:function(){S.call(mstrmojo.all[f],false,X,[b]);S.call(mstrmojo.all[f],true,U,[k]);},redo:function(){S.call(mstrmojo.all[f],true,X,[b]);S.call(mstrmojo.all[f],false,U,[k]);},callback:K.wrapMethods({success:function(){Z.markDirtyLayout(X);Z.markDirtyLayout(U);}},H.rebuildAndUpdateTOCcallback.call(Z))},this.urInfo);}k=b;o.addActions(n.getMacroMoveNodeAction(j,h));o.addActions(n.getMoveNodeActionUsingKey(k,N.PANEL,W,e));o.addCallbacks({success:function(){S.call(mstrmojo.all[f],true,X,[b]);}});Z.markDirtyLayout(X);j.destroy();o.addActions([{act:"setCurrentPanel",unitKey:k}]);o.addExtras(I);return o;};if(V){Z.execute({execute:function(){var j=Z.getDataService();var k=j.newUpdate();a=Z.addPanel(k,d,X,undefined,true);var h=a.k;Z.addVisualizationDeferred(k,h,X);Z.selectNewPanel(k,h);k.addCallbacks({success:function(){var l=Z.cmdMgr().getInterimCmd(),m=g(l);l.urInfo.undo=K.composite([l.urInfo.undo,function(){S.call(mstrmojo.all[f],true,X,[h]);}]);l.urInfo.redo=K.composite([l.urInfo.redo,function(){S.call(mstrmojo.all[f],false,X,[h]);}]);l.submitUpdate(m,Z.cmdMgr().CMD_PHASE.LAST);}});this.submitUpdate(k,Z.cmdMgr().CMD_PHASE.FIRST);},urInfo:{treesToRender:3,disablePU:true}});}else{Z.execute({execute:function(){var h=g(this);this.submitUpdate(h);},urInfo:{treesToRender:3}});}}function L(U){var V=this.model,a=V.getDataService(),b=this.view,Y=V.cmdMgr(),Z=U.newChapterIdx,c=U.srcChapterKey,W=U.panelKeys[0];V.execute({execute:function X(){var e=V.getDataService().newUpdate(this),d=V.getNextKey();V.addNewLayout(e,{nodeKey:d,index:Z+1},mstrmojo.func.wrapMethods(b.getRedisplayLayoutCallback(Z,d,b.getSelectedLayoutWidget()),{success:function(){var g=V.replaceKeyBoxes,f=V.cmdMgr().getInterimCmd(),h=V.getDataService().newUpdate(f,{extras:mstrmojo.DocDataService.SUPPRESS_DATA});if(g&&g.length>0){Q.forEach(g,function(k){k.addSaveBoxLayoutActions(h,true);});}V.clearMapLayout();h.addCallbacks({success:function j(){var n=Y.getInterimCmd(),r=a.newUpdate(n),p=V.getVisPanelStackKey(d);var l=V.getPanel(W,c);var k={parentKey:p};var o=W;var q=function(){var s=V.getPanel(W,c);V.markDirtyLayout(c);s.destroy();};r.addActions(a.getMacroMoveNodeAction(l,k));r.addCallbacks({success:function(){S.call(V,true,c,[W]);}});n.urInfo.redo=function(){q();S.call(V,true,c,[W]);};q();var m=V.getVisPanelKeys(d)[0];r.addActions([V.getRemoveVisPanelAction(m)]);r.addActions([{act:"setCurrentPanel",unitKey:o,disablePU:true}]);r.addExtras(I);r.addCallbacks(H.rebuildAndUpdateTOCcallback.call(V));n.submitUpdate(r,Y.CMD_PHASE.LAST);}});f.submitUpdate(h,Y.CMD_PHASE.MIDDLE);}}));this.submitUpdate(e,Y.CMD_PHASE.FIRST);},urInfo:{treesToRender:3,callback:H.rebuildAndUpdateTOCcallback.call(V)}});}mstrmojo.vi.controllers._PanelControl=mstrmojo.provide("mstrmojo.vi.controllers._PanelControl",{_mixinName:"mstrmojo.vi.controllers._PanelControl",manipulatePanel:function G(U){switch(U&&U.type){case R.DELETE:D.call(this,U);break;case R.DUPLICATE:A.call(this,U);break;case R.MOVE:O.call(this,U);break;case R.NEW:J.call(this,U);break;case R.RENAME:B.call(this,U);break;case R.CROSS_CHAPTER_MOVE:E.call(this,U);break;case R.MOVE_TO_NEW_CHAPTER:L.call(this,U);break;}}});}());(function(){mstrmojo.requiresCls("mstrmojo._XtabCellHoverMgr","mstrmojo.dom");var D=mstrmojo.dom;mstrmojo.vi.ui._XtabCellHoverMgr=mstrmojo.declare(mstrmojo._XtabCellHoverMgr,null,{scriptClass:"mstrmojo.vi.ui._XtabCellHoverMgr",oncontextmenu:function E(I,F,H){this._super(I,F,H);var G=this.parent,J=this.getEvtTargetCell(I,F,G,H);if(!J||!this.shouldShowPopup(G,J,true)){D.preventDefault(F,I);D.stopPropogation(F,I);}},processRightClick:function B(G,F,H){this.parent.doSelection(G,F,H);},shouldShowPopup:function A(J,K,I){var G=J.getCellForNode(K),F=false,H=G&&G.at;if(G){if(!J.model.canShowCellMenu(G)){return false;}F=this._super(J,K,I);if(!F&&H!==undefined){K.mstrShowPopup=F=true;}}return F;},showHvrBtn:function C(H,I){var G,F=false;if(this._super(H,I)){G=H.model.getCellInfo(H.getCellForNode(I));F=(G.isMetric&&G.isHeader)||(!G.isMetric&&G.isTitle);}return F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.XtabModel","mstrmojo.array","mstrmojo.func","mstrmojo.hash","mstrmojo.elementHelper");var AA="Metrics",H=2,g=mstrmojo.array,L=mstrmojo.hash,a=mstrmojo.elementHelper,A="\u001E";var J=1,o=2,N=0,X=2,B=3;function V(AG){if(!AG){return false;}var AH=this.scm,AI,AL,AK,AJ,AF,AE=false;for(AL in AH){AK=AH[AL];AJ=AK.cgb;for(AI in AJ){AF=AG[AJ[AI]];if(AF){if(!AK.tks){AK.tks=AF;AE=true;}else{if(AK.tks&&(AK.tks.indexOf(AF)<0)){AK.tks+=A+AF;AE=true;}}}}}return AE;}function m(){var AF=this.data,AE=AF.gts;if(!AE){return ;}var AG;g.forEach([AE.row,AE.col],function(AH){g.forEach(AH,function(AI){if(AI.sc){AG=AG||{};AG[AI.id||AA]=AI.sc;if(AI.fid){AG[AI.id+"_"+AI.fid]=AI.sc;}}});});this.scm=AG;V.call(this,this.docModel.getCGBMap());}function AD(AE,AF){var AG=this.getDataService();AG[AE].apply(AG,AF);}function Y(AM,AS,AL){var AO=AS||a.getIdPresentation(AM),AT,AE;switch(AO){case"terse":case"terseLong":AM=AM.replace(/\\;/g,"*ESCAPESEMICOLON*");AT=AM.split(";");return(AT[0]+";"+AT[1]+(AL?";"+AL:"")).replace(/\*ESCAPESEMICOLON\*/g,"\\;");case"old":var AG="",AJ=2;AM=AM.replace(/\*:/g,"*COLON*").replace(/\\/g,"\\\\").replace(/;/g,"\\;");AT=AM.split(":");while(AT[AJ]){AG+=":"+AT[AJ];AJ++;}return("h"+AT[1]+AG+";"+AT[0]+(AL?";"+AL:"")).replace(/\*COLON\*/g,"\\:");case"oldLong":var AF=0,AR,AK,AN=[],AU=[],AQ,AP,AI,AH=function AH(){if(AF<0){return null;}var AY=false,AW=-1,AZ,AX=null;for(AQ=AF;AQ<AM.length;AQ++){AZ=AM.charAt(AQ);if(AZ==="*"&&!AY){AY=true;}else{if(AZ===":"&&!AY){AW=AQ;break;}else{AY=false;}}}if(AW===-1){AX=AM.substring(AF);AF=-1;}else{AX=AM.substring(AF,AW);AF=AW+1;}return AX;};AI=AH();if(AI!=="BB"&&AI!=="BF"){return AM;}AE=AH();if(AI==="BF"){AE=AH();}AR=parseInt(AH(),10);AK=parseInt(AH(),10);for(AP=0;AP<AK;AP++){AU[AP]=parseInt(AH(),10);AH();}for(AP=0;AP<AK;AP++){var AV=AH();if(AU[AP]<AR&&AU[AP]>=0){AN[AU[AP]]=AV.replace(/\\/g,"\\\\").replace(/\*:/g,"\\:").replace(/;/g,"\\;");}}return"h"+AN.join(":")+";"+AE+(AL?";"+AL:"");}return AM;}mstrmojo.DocXtabModel=mstrmojo.declare(mstrmojo.XtabModel,null,{scriptClass:"mstrmojo.DocXtabModel",docModel:null,init:function v(AE){this._super(AE);var AF=this;this.docModel.attachEventListener("CGBMapChange",this.id,function(AG){if(AF.xtab.onCBGMapChange){AF.xtab.onCGBMapChange(AG);}});},ondataChange:function q(){m.call(this);},getMessageId:function I(){return this.docModel.mid;},getDataService:function K(){return this.docModel.getDataService();},getAction:function e(AS,AI,AN){var AQ=AS[0],AF=AQ&&AQ.at;var AH;if(AF){if((AF&H)>0){var AG=this.getCellTitleInfo(AQ),AO=AG&&AG.title,AE=AO&&AO.id,AP=this.scm;this.sti={titleId:AE||AA};var AM=(AE&&AP[AE])||AP[AA],AL=function(){var AT=[];g.forEach(AS,function(AU){if(AU._e&&AU._e.id){AT.push(AU._e.id);}});return AT.join(A);};if(AM){var AR=this.xtab,AJ=(AR.allowToggleSelections&&AM.all&&AN),AK=(AG.isSrcTitle||AJ);this.sti.deselectCurrent=AJ;AH={h:"onGridSelector",a:{type:mstrmojo.EnumRWUnitType.GRID,anchor:AI,ck:AM.ck,tks:AM.tks,eid:AK?"OA:(All)":AL(),ctlKey:AM.ckey,sliceId:AR.sid,isUConDS:AM.isUConDS,ifw:AM.ifw}};}}}if(!AH){AH=this._super(AS);}if(AH&&AH.a){AH.a.sliceId=this.xtab.sid;}return AH;},getDownloadAction:function u(AG,AK,AI,AH,AL,AF,AJ,AM){var AE=this._super(AG,AK,AI,AH,AL,AJ,AF);AE.sliceId=this.xtab.sid;if(AM&&AM.name==="TransactionUpdates"){if(AE.partialUpdate){if(AE.partialUpdate.selectors){AE.partialUpdate.selectors.push(AM.ctlKey);}else{AE.partialUpdate.selectors=[AM.ctlKey];}}else{AE.partialUpdate={selectors:[AM.ctlKey]};}}return AE;},getDrillAction:function p(AF,AH){var AG=this._super(AF,AH),AE=this.getCellTitleInfo(AF[0]);if(AG&&AG.isWithin){AG.attrObj=AE.title;}AG.srcMsgId=this.docModel.mid;return AG;},sort:function z(AF,AG){var AE=this.xtab;AF.stp=AF.stp||this.getSubTotalsPos();AF.subTotalsPos=AF.stp;AF.nodeKey=AE.k;AF.treeType=AE.treeType||1;if(AE.gridData.ctlTPKeys){AF.selectors=AE.gridData.ctlTPKeys.split(A);}AD.call(this,"sortGrid",[AF,AG]);},getAdvSortData:function W(AE,AF){AD.call(this,"getAdvSortData",[AE,AF]);},pivot:function M(AE,AF){AD.call(this,"pivot",[AE,AF]);},removeUnit:function U(AE,AF){AD.call(this,"removeUnit",[AE,AF]);},getTotalsAction:function O(AE,AH,AF){var AG=this.getPivotAction(AE);AG.act="showTotals";AG.subtotalType=AH;AG.clearSubtotalType=AF;return AG;},getRemoveAxisTotalsAction:function k(AF,AE){return{act:"removeAxisTotals",axis:AE,subtotalType:AF};},showTotals:function E(AE,AF){AD.call(this,"showTotals",[AE,AF]);},drillGrid:function d(AE,AF){AD.call(this,"drillGrid",[AE,AF]);},downloadGridData:function l(AE,AF){AD.call(this,"downloadGridData",[AE,AF]);},loadLayout:function h(AE){this.docModel.loadLayout(AE);},resizeXtabColumn:function Q(AE,AF){AD.call(this,"resizeXtabColumn",[AE,AF]);},submitTemplateActions:function w(AE,AF,AG){AD.call(this,"submitTemplateUpdates",[AE,AF,AG]);},getDerivedMetricAction:function r(AE,AF){return{did:AE._e.oid,um:AE.um,alias:AE._e.n,n:AE._e.n,v:AE.um?AE.formula:AE._e.v,mix:AE.mix,cmd:AF,model:this};},getAddTemplateUnitAction:function D(AI,AK,AG,AE){var AF=AI.t,AJ=this.data.gsi,AH={act:"addUnit",unitId:AI.did,unitType:AF,unitPos:++AE,dsId:AK,isFirst:!AJ||(AJ.cols.length===0&&AJ.rows.length===0)};if(AF!==4||!AJ||!AJ.mx.length){AH.axis=AG;}return AH;},getRemoveTemplateUnitAction:function t(AE){return{act:"removeUnit",unitId:AE.did||AE.id,unitType:AE.t||4,is_disableonly:1};},getRenameTemplateUnitAction:function G(AI,AG,AE,AF){var AH={act:"renameUnit",id:AI,type:AG,name:AE};if(AF){AH.isDynamicAlias=true;}return AH;},doesNameExistOnTemplate:function C(AG,AK,AI,AF){var AJ=AG.node.data.gsi,AE=AI===4,AH=AE?AJ.mx:AJ.rows.concat(AJ.cols);return AH.some(function(AL){return AL.did!==AK&&(AE||AL.t===AI)&&AL.n===AF;});},getPivotUnitAction:function R(AH,AE,AL,AG,AK,AJ){AE++;var AI=parseInt(AK,10),AF=parseInt(AJ,10);return L.copy(isNaN(AI)||isNaN(AF)?{}:{originAxis:AI,originUnitPos:++AF},{act:"pivot",unitId:String(AL||""),unitType:AG||"",axis:AH,unitPos:AE});},getShowTotalsUnitAction:function b(AH,AF,AG,AE){return{act:"showTotals",unitId:String(AH||""),unitType:AF||"",subtotalType:AG,clearSubtotalType:AE};},getMoveSubTotalAction:function j(AG,AH,AI,AL){var AN=(this.xtab.gridInfo&&this.xtab.gridInfo.sorts)||[],AF=AG&&AG.axis,AJ;function AE(AT,AU){var AV=[];if(AU.length>=AT){if(AL){AV=AT===J?AU[o-1]:AU[J-1];}else{AV=AU[AT-1];}}function AP(AW,AX){return AW.indexOf("0!00000000000000000000000000000000!!!!"+AX)>-1;}function AS(AW,AX){return !!(AW&&AW.length&&AW[0].key&&!AP(AW[0].key,AX));}var AR=AS(AV,AT),AQ;if(AR){AQ=L.clone(AU);AQ.forEach(function(AX,AW){if(!AS(AX,AW+1)){AQ[AW]=null;return ;}AQ[AW]=AX=g.filter(AX,function(AY){return !AP(AY.key,AT);});(AX||[]).forEach(function(AZ){var AY=AZ.key;if(AY){AZ.key=AY.replace(/;/g,"\\;").replace(/\u001e/g,";");if(AL){AY=AZ.key;if(AY.indexOf("!!1")>=0){AZ.key=AY.replace(/!!1/g,"!!2");}else{AZ.key=AY.replace(/!!2/g,"!!1");}}}});});if(AL){AQ=AQ.reverse();}}return AR?AQ:[];}function AK(AR,AS){if(!AS||AS.length<AR){return false;}var AP=AS[AR-1];if(!AP||AP.length!==1){return false;}var AT="!5",AQ=AP[0].key;return AQ&&AQ.slice(-2)===AT;}function AM(AS,AP,AR,AQ,AT){return{act:"moveSubTotal",nodeKey:AS,sorts:AP,subTotalsPos:AR,stt:AT||-1,axis:AQ};}function AO(){var AR=this.data,AQ=AR&&AR.gts,AV=AQ&&AQ.rowSubPos||N,AP=AQ&&AQ.colSubPos||N,AU=[AV,AP];if((!AF||AF===J)&&AV===N){var AT=AQ&&AQ.row||[],AS=false;g.forEach(AT,function(AW){if(AW.ast&&AW.ast.length>0){AS=true;return false;}});if(!AS||AR&&AR.gsi&&AR.gsi.hidesb){AU[J-1]=X;AJ=AE(J,AN);return AM(AI,AJ,AU,J);}}return null;}if(!AH){return AO.call(this);}else{AJ=AE(AF,AN);return AM(AI,AJ,AH,AF,AK(AF,AJ)&&AG.hst?AG.hst:-1);}return null;},getSortGridAction:function x(AH,AF,AG,AE){return{sortKey:AF,subTotalsPos:AH,axis:AG,isAsc:AE};},getColumnResizeAction:function S(AH,AE,AF,AG,AI){return{act:"changeXtabColumnWidth",unitId:AH,unitType:AE,width:AF||0,depth:AG||1,ec:AI};},getNormalizedFormElementId:function AC(AF,AE){return Y(AF,null,AE);},compareNormalizedElementsId:function s(AF,AE){if(AF===AE){return true;}else{if(this.docModel.populateAttributeIdLinkInfo){this.docModel.populateAttributeIdLinkInfo();}if(a.isAttributeIdsLinked(a.getAttributeId(AF),a.getAttributeId(AE),this.docModel.als&&this.docModel.als.idLinks||{})){return a.getElementValue(AF)===a.getElementValue(AE);}}return false;},compareElementsId:function Z(AI,AH){if(!this.docModel.als){return this.compareElementsIdInSingleGrid(AI,AH);}var AG=a.getIdPresentation(AI),AF=a.getIdPresentation(AH),AE=Y(AI,AG),AJ=Y(AH,AF);return this.compareNormalizedElementsId(AE,AJ);},compareElementsIdInSingleGrid:function f(AH,AG){var AF=a.getIdPresentation(AH),AE=a.getIdPresentation(AG);if(AF!==AE||AF==="oldLong"||AF==="terseLong"){return Y(AH,AF)===Y(AG,AE);}return AH===AG;},getLinkedAttributes:function n(AE){var AF;if(this.docModel.populateAttributeIdLinkInfo){this.docModel.populateAttributeIdLinkInfo();}AF=this.docModel.als&&this.docModel.als.idLinks||{};return AF[AE];},getCellDataUnion:function c(AG){var AH=this,AF=AG.hasOwnProperty("mix"),AI=[],AJ,AE=function AE(AL){var AK=AH.getCellTitleInfo(AL),AN=AK.title,AM=AN&&AN.id;if(AM){AJ={};if(AL.stt){AJ.isSubtotal=true;}AI.push(L.copy(AJ,{tid:AM,eid:AL._e&&AL._e.id,v:AL.v||AL._e&&AL._e.n}));}};if(AG){if(!AF){AE(AG);}else{g.forEach([AG._lp,AG._tp],function(AK){var AL=AK;while(AL&&AL!==AL._p){AE(AL);AL=AL._p;}});}}return AI;},getObjectInfo:function F(AE){var AF;g.forEach((this.data.gsi.cols||[]).concat(this.data.gsi.rows||[]),function(AG){if(AG.did===AE){AF=AG;}});return AF;},supportsViewFilterActions:function P(AE){if(this.data&&this.data.gsi){var AF=this.getObjectInfo(AE);return AF&&!AF.de&&(AF.t!==1)&&(AF.t!==47||AF.st===12033);}return false;},getSelectorControlMapInfo:function AB(){var AF=[],AH=this.data.gsi,AG=[],AE;if(this.scm){L.forEach(AH,function(AI){if(AI instanceof Array){AG=AG.concat(AI);}});L.forEach(this.scm,function(AJ,AI){AE=g.find(AG,"did",AI);if(AE!==-1){AF.push({did:AI,n:AG[AE].n,sc:AJ});}});}return AF;},getShowDefinedSubtotalsAction:function(){return{act:"showDefinedSubtotals"};}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.vi.ui._XtabCellHoverMgr");var F=mstrmojo.dom;mstrmojo.vi.ui._CustomSortXtabCellHoverMgr=mstrmojo.declare(mstrmojo.vi.ui._XtabCellHoverMgr,null,{scriptClass:"mstrmojo.vi.ui._CustomSortXtabCellHoverMgr",cue:null,audibles:{"*":false,cueDisplay:true},oncontextmenu:function G(K,I,J){if(!this.parent.isSorting()){this._super(K,I,J);}else{F.preventDefault(I,K);F.stopPropogation(I,K);}},onhover:function C(N,I,M){var M=M||N.target,J=F.findAncestorByName(M,"tr"),L=this.parent;if(!J){return ;}if(L.isSorting()){var P=F.checkTagName(M,"td")?M:F.findAncestorByName(M,"td");if(P&&L.validCustomSortTgtRow(J)){var O=F.position(J),K=this.getCue().style;K.width=Math.min(O.w,F.position(L.domNode).w)+"px";K.top=(O.y+O.h)+"px";K.left=O.x+"px";this.toggleCueDisplay(true);}}else{if(J.rowIndex===0){this._super(N,I,M);}}},onunhover:function B(){this.toggleCueDisplay(false);this._super();},getCue:function H(){if(!this.cue){var I=document.createElement("div");I.className="mstrmojo-vi-cs-cue";this.cue=document.body.appendChild(I);}return this.cue;},removeCue:function A(){if(this.cue){document.body.removeChild(this.cue);delete this.cue;}},toggleCueDisplay:function E(I){this.set("cueDisplay",I);},oncueDisplayChange:function D(){if(this.cue){this.cue.style.display=this.cueDisplay?"":"none";}}});}());(function(){mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSObjectType","EnumDSSAxisName");mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","EnumVisualizationTemplates","VisualizationTransition","HeatMapVisualizationHelper","NetworkVisualizationHelper","ImageLayoutHelper","MapHelper","GraphMatrixHelper");var Z=mstrmojo,K=Z.hash,G=Z.array,Y=Z.vi.viz,B=Y.KnownVisualizations,D=Y.EnumVisualizationTemplates,Q=Z.chart.model.enums,N=Q.EnumDSSObjectType,E=Q.EnumDSSAxisName,J="Grid",W=[0.1,0.3,0.5,0.7,0.9],F=["#CC2525","#E34B4B","#E97D7D","#79D479","#57BA57","#2CA02C"];function C(d){var g=K.copy(d.data.gsi),e=g.tma===1?"rows":"cols",c=g[e],f=g.mx;g[e]=c.filter(function(h){return h.t!==-1&&h.did!=="-1";});if(f){f.forEach(function(h){h.t=4;});}return g;}function A(c){return c.did==="-1"||c.t===4;}function U(f,e,h,c,g){var d=e.getAddDropZonesAction();if(e.colorByMetric){var j=e.colorByMetric;if(A(j)){this.addThresholds(f,j,g,F,W);}}d.actions=c.concat(d.actions).concat(g);if(d.actions.length){h.push(d);}return e.getXml();}function S(h,g){var e,d,f=h.mx;if(f.length>0){for(e=0,d=f.length;e<d;e++){var c=f[e];if(c.t!==4){continue;}if(!g.colorByMetric){g.colorByMetric=c;}else{if((!g.sizeByMetric||(c.did!==g.sizeByMetric.did))&&(c.did!==g.colorByMetric.did)&&c.t===N.DssTypeMetric){g.tooltipMetrics.push(c);}}}}}function a(f,g,j,d){var c=g.data.gts,l=null,h=(f.toLowerCase()==="row")?c&&c.row:c&&c.col,e,m,k;G.forEach(h,function(n){if(n.otp===12){if(!!j){m=false;G.forEach(n.fs,function(o){e=o.n;e=e!==undefined?e:"";if(e.toLowerCase()===j){m=true;return false;}});if(m&&!d){l=n;return false;}if(!m&&d){l=n;return false;}}else{l=n;return false;}}});if(l){k={did:l.id,t:l.otp};}return k;}function X(d,c){return a(d,c,"shapefile",true);}function I(d,c){return a(d,c,"shapefile",false);}function P(d){var c=new Y.ImageLayoutHelper({node:d});return c.getXml();}function O(j,e,g,k,h){var d=new Y.ImageLayoutHelper({node:e}),c=[],f=[];d.geoAttribute=X("row",e)||X("col",e);h.forEach(function(l){l.t=4;});if(g){d.colorByMetric=g;}if(k){d.sizeByMetric=k;}S.call(this,{mx:h},d);return U.call(this,e,d,j,c,f);}function M(m,f){var g,l,j=Y.MapHelper,o=new Y.ImageLayoutHelper({node:f.node}),h=[],e=[],d=f.getTopLayerHost();g=new j({data:f.node.data});g.setWidget(d);l=g.getGeoUnit();if(l){o.geoAttribute=l;}else{var k=g.getTooltipUnits();G.forEach(k,function(q){if(q.t===12){o.geoAttribute=q;return false;}});if(!o.geoAttribute){o.geoAttribute=a("row",d.node)||a("col",d.node);}if(!o.geoAttribute){return P(f.node);}}var p=g.getColorByUnit(),c=g.getSizeByUnit(),n=g.getTooltipUnits();l=p;if(l){o.colorByMetric=l;}l=c;if(l){o.sizeByMetric=l;}S.call(this,{mx:n},o);return U.call(this,f.node,o,m,h,e);}function b(f,c){var e=c.data.gsi.mx||[],h=new Y.GraphMatrixHelper({node:c}),d,g;e=this.filterGMTrainingMetric(c.data.dz,e);h.setData(c.data.dz);G.forEach(h.colorByObjects,function(j){if(h.isMetric(j)){d=j;return false;}});G.forEach(h.sizeByObjects,function(j){if(h.isMetric(j)){g=j;return false;}});return O.call(this,f,c,d,g,e);}function H(g,d){var f=d.data.gsi.mx||[],c=new Y.HeatMapVisualizationHelper({node:d}),e,h;c.setData(d.data.dz);G.forEach(G.ensureArray(c.colorBy),function(j){if(c.isMetric(j)){e=j;return false;}});G.forEach(G.ensureArray(c.sizeByMetric),function(j){if(c.isMetric(j)){h=j;return false;}});return O.call(this,g,d,e,h,f);}function V(g,d){var f=d.data.gsi.mx||[],c=new Y.NetworkVisualizationHelper({node:d}),e,h;c.setData(d.data.dz);G.forEach(G.ensureArray(c.edgeColorMetric),function(j){if(c.isMetric(j)){e=j;return false;}});G.forEach(G.ensureArray(c.nodeSizeMetric).concat(G.ensureArray(c.edgeSizeMetric)),function(j){if(c.isMetric(j)){h=j;return false;}});return O.call(this,g,d,e,h,f);}function L(e,c){var d=c.data.gsi.mx||[];return O.call(this,e,c,null,null,d);}mstrmojo.vi.viz.ImageLayoutVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.ImageLayoutVisualizationTransition",transitionDropZones:function R(j,h){var c="";var g=this.vis,f=g.node.data,e=f.visName?f.visName:J,d=B.getDefinition(e).id;switch(d){case B.GRAPHMATRIX:case B.NEWGRAPHMATRIX:c=b.call(this,j,g.node);break;case B.GOOGLEMAP:case B.ESRIMAP:case B.MAPBOX:c=M.call(this,j,g);break;case B.HEATMAP:c=H.call(this,j,g.node);break;case B.NETWORK:c=V.call(this,j,g.node);break;case B.IMAGELAYOUT:break;default:c=L.call(this,j,g.node);break;}return{wp:c,handled:false};}});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.viz");mstrmojo.requiresClsP("mstrmojo.vi.viz","KPICardVisualizationHelper","KnownVisualizations");var G=mstrmojo,B=G.hash,I=G.vi.viz,H="Grid",D=I.KnownVisualizations;function F(K){var N=B.copy(K.data.gsi),L=N.tma===1?"rows":"cols",J=N[L],M=N.mx;N[L]=J.filter(function(O){return O.t!==-1&&O.did!=="-1";});if(M){M.forEach(function(O){O.t=4;});}return N;}function C(L,M,N,J){var K=M.getAddDropZonesAction();if(K.actions.length){N.push(K);}return M.getXml();}function A(L,J,N){var K=[];var R=new I.KPICardVisualizationHelper({node:J.node});var Q=F(N===D.MAPBOX?J.getTopLayerHost().node:J.node);var U=Q.rows;var P=Q.cols;var O=Q.mx;var S=U.concat(P);if(S.length>0){R.breakByAttribute=S[0];if(S.length>1){for(var M=1;M<S.length;M++){if(S[M].did!==S[0].did){R.trendAttribute=S[M];break;}}}}if(O.length>0){R.metric=O[0];}return C.call(this,J.node,R,L,K);}mstrmojo.vi.viz.KPICardVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.KPICardVisualizationTransition",transitionDropZones:function E(P,O){var J="";var N=this.vis,M=N.node.data,L=M.visName?M.visName:H,K=D.getDefinition(L).id;if(K!==D.KPICARD){J=A.call(this,P,this.vis,K);}return{wp:J,handled:false};}});}());(function(){mstrmojo.requiresClsP("mstrmojo.vi.viz","VisualizationTransition","EnumAxisNames");mstrmojo.requiresCls("mstrmojo.chart.model.enums.EnumDSSObjectType");var A=mstrmojo,E=A.vi.viz,C=E.EnumAxisNames,D=A.chart.model.enums.EnumDSSObjectType;mstrmojo.vi.viz.BaseVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.BaseVisualizationTransition",transitionDropZones:function B(H,O){var F=this.vis,G=F.node,N=G.k,M=G.data.gsi,Q=M.rows,K=M.cols,I,L,J=[],P=function(V,U,R,S){V.push({act:"pivot",unitId:U.did!=="-1"?U.did:"",unitType:U.did!=="-1"?U.t:"",axis:S,unitPos:R+1});};for(I=0;I<K.length;I++){L=K[I];if(L.t!==D.DssTypeMetric){P(J,L,I,C.ROWS);}}for(I=0;I<Q.length;I++){L=Q[I];if(L.did==="-1"){P(J,L,I,C.COLUMNS);break;}}if(J.length){H.push({act:"updateTemplate",keyContext:N,partialRetrieval:{nodes:[N]},actions:J});}return{wp:"<props><widgetProps /></props>",handled:false};}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.gm.GMEnums","mstrmojo.gm.EnumShape");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","EnumVizStyles","EnumVisualizationTemplates","VisualizationTransition","GraphMatrixHelper","HeatMapVisualizationHelper","NetworkVisualizationHelper","ImageLayoutHelper","MapHelper");var X=mstrmojo,Bm=mstrmojo.gm,CD=X.array,As=X.hash,CG=X.vi.viz,B0=CG.KnownVisualizations,Br=CG.EnumVisualizationTemplates,A3=CG.EnumVizStyles,B2=A3.NEW_GRAPH_MATRIX,z=CG.GraphMatrixHelper,L=mstrmojo.chart.model.enums.EnumDSSObjectType,BS=Bm.FormatingPropertyTag,AY=Bm.WidgetPropertyTag,Bz=Bm.EnumContainerFitModes,Af="Grid",P=Bm.EnumShape,U=Bm.DualAxisSubAxisBit,CN=U.PRIMARY,F=U.SECONDARY,CP=CG.EnumDSSDropZones,AV=CP.XAxis,M=CP.YAxis,Am=CP.Angle,AD=CP.ColorBy,CT=1;var AS=Br.GRAPHMATRIXVERTICALBARAUTOMATIC,A=Br.GRAPHMATRIXVERTICALLINEAUTOMATIC,b=Br.GRAPHMATRIXVERTICALAREAAUTOMATIC,BR=Br.GRAPHMATRIXVERTICALBARSTACKED,Be=Br.GRAPHMATRIXVERTICALLINESTACKED,BG=Br.GRAPHMATRIXVERTICALAREASTACKED,AC=Br.GRAPHMATRIXBUBBLECIRCLEMM,Ar=Br.GRAPHMATRIXBUBBLESQUAREMM,CR=Br.GRAPHMATRIXSCATTERCIRCLEMM,AE=Br.GRAPHMATRIXSCATTERSQUAREMM,a=Br.GRAPHMATRIXBUBBLEGRIDCIRCLEAA,An=Br.GRAPHMATRIXBUBBLEGRIDSQUAREAA,BT=Br.GRAPHMATRIXSCATTERGRIDCIRCLEAA,CA=Br.GRAPHMATRIXSCATTERGRIDSQUAREAA,Az=Br.GRAPHMATRIXVERTICALBARCLUSTERED,AB=Br.GRAPHMATRIXVERTICALLINECLUSTERED,AZ=Br.GRAPHMATRIXVERTICALAREACLUSTERED,Ac=Br.GRAPHMATRIXVERTICALBARPERCENT,Ap=Br.GRAPHMATRIXVERTICALLINEPERCENT,AR=Br.GRAPHMATRIXVERTICALAREAPERCENT,x=Br.GRAPHMATRIXHORIZONTALBARAUTOMATIC,Al=Br.GRAPHMATRIXHORIZONTALLINEAUTOMATIC,BC=Br.GRAPHMATRIXHORIZONTALAREAAUTOMATIC,Ab=Br.GRAPHMATRIXHORIZONTALBARCLUSTERED,BD=Br.GRAPHMATRIXHORIZONTALLINECLUSTERED,Bb=Br.GRAPHMATRIXHORIZONTALAREACLUSTERED,AN=Br.GRAPHMATRIXHORIZONTALBARSTACKED,BE=Br.GRAPHMATRIXHORIZONTALLINESTACKED,A8=Br.GRAPHMATRIXHORIZONTALAREASTACKED,N=Br.GRAPHMATRIXHORIZONTALBARPERCENT,AO=Br.GRAPHMATRIXHORIZONTALLINEPERCENT,t=Br.GRAPHMATRIXHORIZONTALAREAPERCENT,h=Br.GRAPHMATRIXPIE,BL=Br.GRAPHMATRIXRING,c=Br.GRAPHCOMBINATIONBARAREA,R=Br.GRAPHCOMBINATIONBARAREADUALAXIS,Ai=Br.GRAPHMATRIXBUBBLESQUAREAM,w=Br.GRAPHMATRIXSCATTERSQUAREAM,B8=Br.GRAPHMATRIXVERTICALHISTOGRAM,n=Br.GRAPHMATRIXGRIDCHART,BB=Br.GRID,BU=Br.GRAPHMATRIXVERTICALBOXPLOT,f=Br.GRAPHMATRIXHORIZONTALBOXPLOT,Bv=Br.GRAPHMATRIXVERTICALWATERFALL,CE=Br.GRAPHMATRIXHORIZONTALWATERFALL;var BY="nm",C="m",Bi="none",Y="any",A7="toggle",Ay="MetricsInAny",Ax="MetricsInNone";function B4(Ca){var Cd=As.copy(Ca.data.gsi),Cb=Cd.tma===1?"rows":"cols",CZ=Cd[Cb],Cc=Cd.mx;Cd[Cb]=CZ.filter(function(Ce){return Ce.t!==-1&&Ce.did!=="-1";});if(Cc){Cc.forEach(function(Ce){Ce.t=4;});}return Cd;}function CV(Cb){var Ca=this.templateInfo,CZ;for(CZ=0;CZ<Ca.rows.length;CZ++){if(Ca.rows[CZ].did===Cb.id){Ca.rows.splice(CZ,1);return ;}}for(CZ=0;CZ<Ca.cols.length;CZ++){if(Ca.cols[CZ].did===Cb.id){Ca.cols.splice(CZ,1);return ;}}for(CZ=0;CZ<Ca.mx.length;CZ++){if(Ca.mx[CZ].did===Cb.id){Ca.mx.splice(CZ,1);return ;}}}function BQ(CZ,Ca){CZ.MetricsDropZone=Ca;}function CC(Cc,CZ,Ca,Cb){Cc.Zones[CZ]={type:Ca,min:Cb};}function CS(Cb,Ca,CZ){Cb.Properties[Ca]=CZ;}function B5(Ca,CZ){return Ca.Zones[CZ];}function A4(CZ){var Ca={Zones:[],Properties:[]};switch(CZ){case AC:case Ar:BQ(Ca,Ay);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,C,1);CC(Ca,z.PROP_SIZEBY,C,1);CC(Ca,z.PROP_BREAKBY,Y,1);CC(Ca,z.PROP_COLORBY,Y,0);break;case CR:case AE:BQ(Ca,Ay);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,C,1);CC(Ca,z.PROP_SIZEBY,Bi,1);CC(Ca,z.PROP_BREAKBY,BY,1);CC(Ca,z.PROP_COLORBY,BY,0);break;case a:case An:BQ(Ca,Ax);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,BY,1);CC(Ca,z.PROP_BREAKBY,Bi,0);CC(Ca,z.PROP_SIZEBY,C,1);break;case BT:case CA:BQ(Ca,Ax);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,BY,1);CC(Ca,z.PROP_BREAKBY,Bi,0);CC(Ca,z.PROP_SIZEBY,Bi,0);CC(Ca,z.PROP_COLORBY,C,1);break;case AS:case A:case b:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,C,1);break;case Az:case AB:case AZ:case BB:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,C,1);break;case BR:case Be:case BG:case Bv:case BU:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,C,1);break;case Ac:case Ap:case AR:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,C,1);break;case x:case Al:case BC:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,BY,1);break;case Ab:case BD:case Bb:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,BY,1);break;case AN:case BE:case A8:case Bv:case f:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,BY,1);break;case N:case AO:case t:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,C,1);CC(Ca,z.PROP_YAXIS,BY,1);break;case h:case BL:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_SLICE,BY,1);CC(Ca,z.PROP_ANGLE,C,1);CC(Ca,z.PROP_COLORBY,BY,0);break;case c:case R:BQ(Ca,z.PROP_ROWS);CC(Ca,z.PROP_XAXIS,BY,1);CC(Ca,z.PROP_YAXIS,C,1);break;case B8:CC(Ca,z.PROP_YAXIS,C,1);CC(Ca,z.PROP_XAXIS,BY,1);}switch(CZ){case AC:case a:case CR:case BT:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_CIRCLE);break;case Ai:case Ar:case An:case w:case AE:case CA:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_SQUARE);break;case Az:case BR:case Ac:case Ab:case AN:case N:case AS:case x:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_BAR);break;case AB:case Be:case Ap:case BD:case BE:case AO:case A:case Al:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_LINE);break;case AZ:case BG:case AR:case Bb:case A8:case t:case b:case BC:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_AREA);break;case h:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_PIE);break;case BL:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_RING);break;case R:case n:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_BAR);break;case B8:case Bv:case CE:case BU:case f:CS(Ca,z.PROP_SHAPE,z.PROP_SHAPE_BAR);break;}CS(Ca,z.PROP_SUBTYPE,Bj(CZ));return Ca;}function Bj(Ca){var CZ=z.PROP_SUBTYPE_AUTOMATIC;switch(Ca){case Az:case AB:case AZ:case Ab:case BD:case Bb:CZ=z.PROP_SUBTYPE_CLUSTERED;break;case BR:case Be:case BG:case AN:case BE:case A8:case AS:case x:case Bv:case CE:CZ=z.PROP_SUBTYPE_STACKED;break;case Ac:case Ap:case AR:case N:case AO:case t:CZ=z.PROP_SUBTYPE_PERCENT;break;case h:case BL:case A:case Al:case b:case BC:case R:CZ=z.PROP_SUBTYPE_AUTOMATIC;break;}return CZ;}function Bo(CZ,Cb,Ca){if(Cb===Bi){return false;}if(Cb===Y){return true;}if((CZ.t===L.DssTypeMetric)&&(Cb===C)){return true;}if((CZ.t!==L.DssTypeMetric)&&(Cb===BY)){return true;}if(Cb===A7){var Cc=B5(Ca,z.PROP_XAXIS);if((Cc&&Cc.t===C)&&(CZ.t!==L.DssTypeMetric)){return true;}if((Cc&&Cc.t===BY)&&(CZ.t===L.DssTypeMetric)){return true;}return false;}return false;}function Q(Ca){var CZ=false;switch(Ca){case Ab:case AN:case N:case BD:case BE:case AO:case Bb:case A8:case t:case x:case Al:case BC:CZ=true;break;default:break;}return CZ;}function BV(Ca){var CZ=false;switch(Ca){case AC:case a:case Ai:case Ar:case An:case CR:case BT:case w:case AE:case CA:CZ=true;break;default:break;}return CZ;}function E(CZ){return(CZ===c||CZ===R);}function Bh(Ca,Cb,Cc,CZ,Cd){if(Cb.length+Cc.length>=Cd.min){if(Cc.length){Ca[CZ].push(Cc.pop());}else{if(Cb.length){Ca[CZ].push(Cb.pop());}}}}function Bl(Cc,Cb,Ca){var Cg=this.templateInfo,Cd=Cg.rows,Ce=Cg.cols,Cf=B5(Cc,z.PROP_SLICE);if(Cf&&Cf.type===BY&&!Cb.sliceObjects.length){Bh(Cb,Cd,Ce,"sliceObjects",Cf);}Cf=B5(Cc,z.PROP_XAXIS);if(Cf&&(Cf.type===BY||Cf.type===Y)&&!Cb.xAxisObjects.length){Bh(Cb,Ce,Cd,"xAxisObjects",Cf);}Cf=B5(Cc,z.PROP_YAXIS);var CZ=Cf&&((Cf.type===BY)||(Cf.type===Y));if(!CZ&&Cf&&Cf.type===A7&&Cb.xAxisObjects.length){if(Cb.xAxisObjects[0].t===4){CZ=true;}}if(CZ){Bh(Cb,Cd,Ce,"yAxisObjects",Cf);}Cf=B5(Cc,z.PROP_BREAKBY);if(Cf&&Cf.type===BY&&!Cb.breakByObjects.length){if(Q(Ca)){Bh(Cb,Cd,Ce,"breakByObjects",Cf);}else{Bh(Cb,Ce,Cd,"breakByObjects",Cf);}}Cf=B5(Cc,z.PROP_COLORBY);if(Cf&&Cf.type===BY&&!Cb.colorByObjects.length){if(Cb.sliceObjects.length){Cb.colorByObjects.push(Cb.sliceObjects[0]);}else{if(Cd.length+Ce.length>=Cf.min){if(Q(Ca)){Bh(Cb,Cd,Ce,"colorByObjects",Cf);}else{Bh(Cb,Ce,Cd,"colorByObjects",Cf);}}}}}function g(CZ){if(CZ.getMetricCountInZone(CZ.xAxisObjects)>CT){return true;}if(CZ.getMetricCountInZone(CZ.yAxisObjects)>CT){return true;}if(CZ.angleObjects&&CZ.getMetricCountInZone(CZ.angleObjects)>CT){return true;}return false;}function Bp(Cc,Ca,Cb){if(g(Cb)){if(!BZ(Cb.colorByObjects)){Cb.secondaryMetricsDropZone=z.PROP_COLORBY;}var CZ=Cc.MetricsDropZone;if(!CZ||CZ!=="null"){switch(CZ){case Ax:Cb.metricsDropZone="";break;case Ay:Cb.metricsDropZone=z.PROP_COLUMNS;break;default:Cb.metricsDropZone=CZ;break;}}}}function By(Cb,Ca,CZ){var Cd=this.templateInfo.mx,Cc;if(!Cd.length){return ;}Cc=B5(Cb,z.PROP_ANGLE);if(Cc&&Cc.type===C&&!Ca.angleObjects.length&&Cd.length>=Cc.min){Ca.angleObjects.push(Cd[0]);Cd.splice(0,1);}Cc=B5(Cb,z.PROP_XAXIS);if(Cc&&Cc.type===C&&!Ca.xAxisObjects.length&&Cd.length>=Cc.min){Ca.xAxisObjects.push(Cd[0]);Cd.splice(0,1);}Cc=B5(Cb,z.PROP_YAXIS);if(Cc){var Ce=(Cc.type===C);if(!Ce&&Cc.type===A7){if(!Ca.xAxisObjects.length||Ca.xAxisObjects[0].t!==4){Ce=true;}}if(Ce&&!Ca.yAxisObjects.length){if(Cd.length>=Cc.min){Ca.yAxisObjects.push(Cd[0]);Cd.splice(0,1);if(Cd.length>0&&(CZ===c||CZ===R)){Ca.yAxisObjects.push(As.copy({ax:F},Cd[0]));Cd.splice(0,1);}}}}Cc=B5(Cb,z.PROP_COLORBY);if(Cc&&Cc.type===C&&!Ca.colorByObjects.length){if(Cd.length>0){Ca.colorByObjects.push(Cd[0]);this.markedObjects.push(Cd[0]);}else{[{n:"sizeByObjects",fn:function(Cf){return Ca[Cf].length;}},{n:"xAxisObjects",fn:function(Cf){return Ca[Cf].length&&Ca[Cf][0].t===4;}},{n:"yAxisObjects",fn:function(Cf){return Ca[Cf].length&&Ca[Cf][0].t===4;}}].forEach(function(Cg){if(Cg.fn(Cg.n)){var Ch=Ca[Cg.n],Cf=As.copy(Ch[Ch.length-1]);Cf.ax=1;Ca.colorByObjects.push(Cf);}});}}Cc=B5(Cb,z.PROP_SIZEBY);if(Cc&&Cc.type===C&&!Ca.sizeByObjects.length){if(Cd.length){Ca.sizeByObjects.push(Cd[0]);this.markedObjects.push(Cd[0]);}else{["colorByObjects","xAxisObjects","yAxisObjects"].forEach(function(Ch){var Cg=Ca[Ch],Cf=Cg.length;if(Cf&&Cg[0].t===4){Ca.sizeByObjects.push(Cg[Cf-1]);}});}}}function CJ(Cc,Cb){var Ca=["rowObjects","columnObjects","xAxisObjects","yAxisObjects","colorByObjects","breakByObjects","sizeByObjects","sliceObjects","angleObjects"];for(var Cf=0;Cf<Cb.length;Cf++){var Ce=0;for(var Cd=0;Cd<Ca.length;Cd++){var CZ=Ca[Cd];CZ=Cc[CZ];CZ.forEach(function(Cg){if(Cg&&Cg.did==Cb[Cf].did){Ce++;}});}if(Ce===0&&Cb.length){Cc.tooltipMetrics.push(Cb[Cf]);}}}function K(Ca){var CZ=false;CD.forEach(this.markedObjects,function(Cb){if(Cb.did===Ca){CZ=true;return false;}});return CZ;}function CX(Ca){var CZ=this,Cb=this.templateInfo;Cb.rows.forEach(function(Cc){Ca.rowObjects.push(Cc);});Cb.cols.forEach(function(Cc){Ca.columnObjects.push(Cc);});Cb.mx.forEach(function(Cc){if(!K.call(CZ,Cc.did)){Ca.tooltipMetrics.push(Cc);}});}function CU(Ca,Cc){var Cb=Ca.Properties,CZ=this.newVizInfo.s==="NewGraphMatrixVisualizationStyle";if(Cb[z.PROP_SHAPE]){Cc.shape=Cb[z.PROP_SHAPE];}if(Cb[z.PROP_SUBTYPE]&&(CZ||(Cc.subtype===""||Cc.subtype===z.PROP_SUBTYPE_AUTOMATIC))){Cc.subtype=Cb[z.PROP_SUBTYPE];}}function k(Ca,CZ,Cc){if(CZ.colorByObjects.length<=0){return ;}var Cb=CZ.colorByObjects[0];if(Cb.t===L.DssTypeMetric){this.addThresholds(Ca,Cb,Cc,undefined,undefined);}}function Aw(CZ,Cb){var Ca=(CZ.data.gts&&CZ.data.gts.row)||[];Ca.forEach(function(Cc){if(Cc.otp===12&&Cc.ast&&Cc.ast.length){Cb.push({act:"showDefinedSubtotals"});Cb.push({act:"showTotals",unitId:Cc.id,unitType:Cc.otp,subtotalType:[],clearSubtotalType:Cc.ast.map(function(Cd){return Cd.t;})});}});}function BZ(CZ){var Ca,Cb;for(Ca=0;Ca<CZ.length;Ca++){Cb=CZ[Ca];if(Cb.t===L.DssTypeMetric){return true;}}return false;}function AA(Cb){var Ce,Cd,Cc,CZ=false,Ca;for(Cd=0;Cd<Cb.sliceObjects.length;Cd++){Ce=Cb.sliceObjects[Cd];if(Ce.t===L.DssTypeAttribute){Cc=Ce;CZ=true;break;}}if(!CZ){return ;}Ca=BZ(Cb.xAxisObjects);if(!Ca){Ca=BZ(Cb.yAxisObjects);}if(!Ca){Ca=BZ(Cb.sizeByObjects);}if(!Ca){return ;}}function B1(CZ){switch(CZ){case Az:case BR:case Ac:case AB:case Be:case Ap:case AZ:case BG:case AR:case AS:case A:case b:return true;default:return false;}}function BP(Cc){if(!Cc.data.dz){return false;}var CZ=Cc.data.dz,Cb=mstrmojo.vi.viz.GraphMatrixHelper,Cd=CZ[Cb.PROP_XAXIS],Cf=Cd.TemplateUnit||Cd.TemplateMetric||[],Ca=CZ[Cb.PROP_YAXIS],Ce=Ca.TemplateUnit||Ca.TemplateMetric||[];if(Ce.length>0&&Ce[0].t===L.DssTypeMetric){if(Cf.length===0||Cf[0].t!==L.DssTypeMetric){return true;}}return false;}function Au(Cc){if(!Cc.data.dz){return false;}var CZ=Cc.data.dz,Cb=mstrmojo.vi.viz.GraphMatrixHelper,Cd=CZ[Cb.PROP_XAXIS],Cf=[],Ca=CZ[Cb.PROP_YAXIS],Ce=[];if(Cd){Cf=Cd.TemplateUnit||Cd.TemplateMetric||[];}if(Ca){Ce=Ca.TemplateUnit||Ca.TemplateMetric||[];}if(Cf.length>0&&(Cf[0].t===L.DssTypeMetric)){if(Ce.length===0||(Ce[0].t!==L.DssTypeMetric)){return true;}}return false;}function AW(CZ){return B1(CZ)||Q(CZ);}function o(CZ){switch(CZ){case AB:case Be:case Ap:case BD:case BE:case AO:case A:case Al:return true;default:return false;}}function At(CZ){switch(CZ){case AZ:case BG:case AR:case Bb:case A8:case t:case b:case BC:return true;default:return false;}}function Ae(Cb,Cc,Ca){var Ce,Cd=0,CZ=0;if(Ca){Ce=Ca;}else{if(Au(Cc)){Ce="xAxisObjects";}else{Ce="yAxisObjects";}}Cb[Ce].forEach(function(Cf){if(Cf.ax===CN){CZ++;}else{if(Cf.ax===F){Cd++;}}});if(Cd&&CZ){return -1;}else{if(Cd){return F;}else{return CN;}}}function Ak(Ce,Ca,CZ,Cb,Cd){if(this.isGraphMatrix(Ce)){if((Au(Cd)&&B1(Ca))||(Q(Ca)&&BP(Cd))){var Cc;for(Cc=0;Cc<CZ.xAxisObjects.length;Cc++){Cb.yAxisObjects.push(CZ.xAxisObjects[Cc]);CV.call(this,CZ.xAxisObjects[Cc]);}for(Cc=0;Cc<CZ.yAxisObjects.length;Cc++){Cb.xAxisObjects.push(CZ.yAxisObjects[Cc]);CV.call(this,CZ.yAxisObjects[Cc]);}}}}function A9(CZ,Ca,Cb){if(g(Ca)){if(CZ.secondaryMetricsDropZone){Ca.secondaryMetricsDropZone=CZ.secondaryMetricsDropZone;}if(!Cb&&CZ.metricsDropZone==="BreakBy"){Ca.metricsDropZone="BreakBy";}else{if(Ca.angleObjects.length>1){Ca.metricsDropZone="Rows";}else{if(CZ.metricsDropZone){Ca.metricsDropZone=CZ.metricsDropZone;}else{if(Ca.xAxisObjects.length>1&&Ca.xAxisObjects[0].t===4){Ca.metricsDropZone="Columns";}else{Ca.metricsDropZone="Rows";}}}}}else{Ca.metricsDropZone="";Ca.secondaryMetricsDropZone="";}}function AJ(CZ,Ca){if(g(Ca)){if(CZ.secondaryMetricsDropZone){Ca.secondaryMetricsDropZone=CZ.secondaryMetricsDropZone;}if(CZ.metricsDropZone==="BreakBy"){Ca.metricsDropZone="BreakBy";}else{Ca.metricsDropZone="Rows";}}else{Ca.metricsDropZone="";Ca.secondaryMetricsDropZone="";}}function I(CZ,Ca){if(g(Ca)){if(CZ.secondaryMetricsDropZone){Ca.secondaryMetricsDropZone=CZ.secondaryMetricsDropZone;}if(CZ.metricsDropZone){if(CZ.metricsDropZone==="SliceBy"){Ca.metricsDropZone="BreakBy";}else{Ca.metricsDropZone=CZ.metricsDropZone;}}else{if(Ca.xAxisObjects.length>1&&Ca.xAxisObjects[0].t===4){Ca.metricsDropZone="Columns";}else{Ca.metricsDropZone="Rows";}}}else{Ca.metricsDropZone="";Ca.secondaryMetricsDropZone="";}}function CI(Cf,CZ,Cc,Co,Ck,Cm){var Ci,Cn,Cl,Cp,Ca=(Co===Br.GOOGLEMAP||Co===Br.ESRIMAP);if(Co===Br.HEATMAP){Cp=new CG.HeatMapVisualizationHelper();Cp.setData(Cm.data.dz);}else{if(Ca){var Cr=CG.MapHelper;Cp=new Cr({data:Cm.data});Cp.setWidget(this.vis);}}if(this.isGraphMatrix(Co)){if(CZ.xAxisObjects.length>0){Ci=B5(Cf,z.PROP_XAXIS);if(!Ci||Bo(CZ.xAxisObjects[0],Ci.type,Cf)){for(Cn=0;Cn<CZ.xAxisObjects.length;Cn++){Cl=CZ.xAxisObjects[Cn];Cc.xAxisObjects.push(Cl);CV.call(this,Cl);}}}if(CZ.yAxisObjects.length>0){Ci=B5(Cf,z.PROP_YAXIS);if(!Ci||Bo(CZ.yAxisObjects[0],Ci.type,Cf)){for(Cn=0;Cn<CZ.yAxisObjects.length;Cn++){Cl=CZ.yAxisObjects[Cn];Cc.yAxisObjects.push(Cl);CV.call(this,Cl);}}}if(CZ.breakByObjects.length>0){Ci=B5(Cf,z.PROP_BREAKBY);if(!Ci||Bo(CZ.breakByObjects[0],Ci.type,Cf)){for(Cn=0;Cn<CZ.breakByObjects.length;Cn++){Cl=CZ.breakByObjects[Cn];Cc.breakByObjects.push(Cl);CV.call(this,Cl);}}}}var Cq=[];if(this.isGraphMatrix(Co)){for(Cn=0;Cn<CZ.colorByObjects.length;Cn++){Cq.push(CZ.colorByObjects[Cn]);}}else{if(Co===Br.HEATMAP){Cp.colorBy.forEach(function(Cs){Cq.push(Cs);});}else{if(Ca&&Cp.showColorByZone()){var Cg=Cp.getColorByUnit();if(Cg){Cq.push(Cg);}}}}if(Cq.length){Ci=B5(Cf,z.PROP_COLORBY);var Cd=(!Ci||Bo(Cq[0],Ci.type,Cf));if(Cd){for(Cn=0;Cn<Cq.length;Cn++){Cl=Cq[Cn];Cc.colorByObjects.push(Cl);this.markedObjects.push(Cl);}}}var Ce=[];if(this.isGraphMatrix(Co)){for(Cn=0;Cn<CZ.sizeByObjects.length;Cn++){Ce.push(CZ.sizeByObjects[Cn]);}}else{if(Co===Br.HEATMAP){if(Cp.sizeByMetric){Ce.push(Cp.sizeByMetric);}}else{if(Ca&&Cp.showSizeByZone()){var Ch=Cp.getSizeByUnit();if(Ch){Ce.push(Ch);}}}}if(Ce.length>0){Ci=B5(Cf,z.PROP_SIZEBY);var Cb=Cf.Properties[z.PROP_SHAPE],Cj;Cj=(Cb!=="Area")&&(!Ci||Bo(Ce,Ci.type,Cf));if(Cj){for(Cn=0;Cn<Ce.length;Cn++){Cl=Ce[Cn];Cc.sizeByObjects.push(Cl);this.markedObjects.push(Cl);}}}}function CO(Cg,CZ){if(CZ){var Ce,Ca,Ch,Cf=[],Cb=[];["columnObjects","rowObjects","xAxisObjects","yAxisObjects","breakByObjects","colorByObjects","sizeByObjects"].forEach(function(Ci){Ce=Cg[Ci];for(Ca=0;Ca<Ce.length;Ca++){Ch=Ce[Ca];if(B6(Cg.tooltipMetrics,Ch)===-1){if(Ch.t===12){Cb.push(Ch);}else{Cf.push(Ch);}}}});Cg.tooltipMetrics=Cb.concat(Cg.tooltipMetrics).concat(Cf);}else{var Cd=[];for(var Cc=0;Cc<Cg.tooltipMetrics.length;Cc++){if(Cg.tooltipMetrics[Cc].t===L.DssTypeMetric){Cd.push(Cg.tooltipMetrics[Cc]);}}Cg.tooltipMetrics=[];CJ(Cg,Cd);}}function m(Ca){var Cc=this.templateInfo,Ce=Cc.mx,CZ=this.vis.model.data.gsi,Cb=this.definition;if(Cc.cols.length&&Cc.rows.length){Ca.xAxisObjects.push(Cc.cols.pop());Ca.yAxisObjects.push(Cc.rows.pop());B9(Cc.cols,Ca.columnObjects);B9(Cc.rows,Ca.rowObjects);}else{var Cd=Cc.rows.concat(Cc.cols);if(Cd.length){Ca.xAxisObjects.push(Cd.pop());}if(Cd.length){Ca.yAxisObjects.push(Cd.pop());}B9(Cd,Ca.rowObjects);}if(Ce.length>1){Ca.sizeByObjects.push(Ce.splice(0,1)[0]);}else{if(Ce.length===1&&Ca.xAxisObjects.length){Ca.sizeByObjects.push(Ce.splice(0,1)[0]);Ca.colorByObjects.push(Ca.xAxisObjects[0]);}}if(Ce.length){Ca.colorByObjects.push(Ce.splice(0,1)[0]);B9(Ce,Ca.tooltipMetrics);}}function AF(Ca){var Cc=this.templateInfo,Cf=Cc.mx,CZ=this.vis.model.data.gsi,Cb=this.definition;if(Cc.cols.length&&Cc.rows.length){var Ce;CZ.rows.forEach(function(Cg){if(Cg.n==="Metrics"){Ce="Rows";}});CZ.cols.forEach(function(Cg){if(Cg.n==="Metrics"){Ce="Columns";}});Ca.metricsDropZone=Ce;if(Ce==="Rows"){if(CZ.rows[CZ.rows.length-1].n==="Metrics"){Cf.forEach(function(Cg){Ca.yAxisObjects.push(Cg);});Ca.xAxisObjects.push(Cc.cols.pop());Cc.cols.forEach(function(Cg){Ca.columnObjects.push(Cg);});Cc.rows.forEach(function(Cg){Ca.rowObjects.push(Cg);});}else{Ca.yAxisObjects.push(CZ.rows.pop());Cc.rows.forEach(function(Cg){Ca.rowObjects.push(Cg);});Cf.forEach(function(Cg){Ca.xAxisObjects.push(Cg);});Cc.cols.forEach(function(Cg){Ca.columnObjects.push(Cg);});}}else{if(Ce==="Columns"){if(CZ.cols[CZ.cols.length-1].n==="Metrics"){Cf.forEach(function(Cg){Ca.xAxisObjects.push(Cg);});Ca.yAxisObjects.push(Cc.rows.pop());Cc.cols.forEach(function(Cg){Ca.columnObjects.push(Cg);});Cc.rows.forEach(function(Cg){Ca.rowObjects.push(Cg);});}else{if(CZ.cols.length){Ca.xAxisObjects.push(CZ.cols.pop());}Cc.cols.forEach(function(Cg){Ca.columnObjects.push(Cg);});Cc.rows.forEach(function(Cg){Ca.rowObjects.push(Cg);});Cf.forEach(function(Cg){Ca.yAxisObjects.push(Cg);});}}}}else{Cf.forEach(function(Cg){Ca.yAxisObjects.push(Cg);});if(Cc.cols.length+Cc.rows.length===1){Bh(Ca,Cc.cols,Cc.rows,"xAxisObjects",B5(Cb,z.PROP_XAXIS));}else{var Cd=Cc.rows.concat(Cc.cols);if(Cd.length){Ca.breakByObjects.push(Cd.pop());}if(Cd.length){Ca.xAxisObjects.push(Cd.pop());}Cd.forEach(function(Cg){Ca.columnObjects.push(Cg);});}if(Ca.xAxisObjects.length>1&&Ca.xAxisObjects[0].t===4){Ca.metricsDropZone="Columns";}else{if(Ca.yAxisObjects.length>1&&Ca.yAxisObjects[0].t===4){Ca.metricsDropZone="Rows";}else{Ca.metricsDropZone="";}}Ca.secondaryMetricsDropZone="";}}function Ba(Cf){var CZ=this.templateInfo,Cg=CZ.mx,Ch=this.vis.model.data.gsi,Ca=this.definition;for(var Cc=0;Cc<(Cg.length/2);Cc++){Cf.yAxisObjects.push(Cg[Cc]);}for(Cc=Math.ceil(Cg.length/2);Cc<Cg.length;Cc++){Cf.xAxisObjects.push(Cg[Cc]);}if(CZ.cols.length&&CZ.rows.length){var Ce;Ch.rows.forEach(function(Ci){if(Ci.n==="Metrics"){Ce="Rows";}});Ch.cols.forEach(function(Ci){if(Ci.n==="Metrics"){Ce="Columns";}});Cf.metricsDropZone=Ce;if(Ce==="Rows"){if(Ch.rows[Ch.rows.length-1].n==="Metrics"){Cf.breakByObjects.push(CZ.cols.pop());CZ.rows.forEach(function(Ci){Cf.rowObjects.push(Ci);});}else{var Cc=0,Cb=false;while(Cb===false){if(Ch.rows[Cc].n!=="Metrics"){Cf.rowObjects.push(CZ.rows[Cc]);Cc++;}else{Cb=true;}}while(Cc<CZ.rows.length){Cf.breakByObjects.push(CZ.rows[Cc]);Cc++;}}CZ.cols.forEach(function(Ci){Cf.columnObjects.push(Ci);});}else{if(Ce==="Columns"){if(Ch.cols[Ch.cols.length-1].n==="Metrics"){Cg.forEach(function(Ci){Cf.xAxisObjects.push(Ci);});Cf.breakByObjects.push(CZ.rows.pop());CZ.cols.forEach(function(Ci){Cf.columnObjects.push(Ci);});}else{var Cc=0,Cb=false;while(Cb===false){if(Ch.cols[Cc].n!=="Metrics"){Cf.columnObjects.push(CZ.cols[Cc]);Cc++;}else{Cb=true;}}while(Cc<CZ.cols.length){Cf.breakByObjects.push(CZ.cols[Cc]);Cc++;}}CZ.rows.forEach(function(Ci){Cf.rowObjects.push(Ci);});}}}else{if(CZ.cols.length+CZ.rows.length===1){Bh(Cf,CZ.cols,CZ.rows,"breakByObjects",B5(Ca,z.PROP_BREAKBY));}else{if(CZ.cols.length+CZ.rows.length>1){var Cd=CZ.rows.concat(CZ.cols);if(Cd.length){Cf.breakByObjects=Cd.splice(-2,2);Cd.forEach(function(Ci){Cf.columnObjects.push(Ci);});}}}if(Cf.xAxisObjects.length>1&&Cf.xAxisObjects[0].t===4){Cf.metricsDropZone="Columns";}else{if(Cf.yAxisObjects.length>1&&Cf.yAxisObjects[0].t===4){Cf.metricsDropZone="Rows";}else{Cf.metricsDropZone="";}}Cf.secondaryMetricsDropZone="";}}function BX(Cf){var CZ=this.templateInfo,Cg=CZ.mx,Ch=this.vis.model.data.gsi,Ca=this.definition;Cg.forEach(function(Ci){Cf.angleObjects.push(Ci);});if(CZ.cols.length&&CZ.rows.length){var Ce;Ch.rows.forEach(function(Ci){if(Ci.n==="Metrics"){Ce="Rows";}});Ch.cols.forEach(function(Ci){if(Ci.n==="Metrics"){Ce="Columns";}});Cf.metricsDropZone=Ce;if(Ce==="Rows"){if(Ch.rows[Ch.rows.length-1].n==="Metrics"){Cf.sliceObjects.push(CZ.cols.pop());CZ.rows.forEach(function(Ci){Cf.rowObjects.push(Ci);});}else{Cf.sliceObjects.push(CZ.rows.pop());var Cc=0,Cb=false;while(Cb===false){if(Ch.rows[Cc].n!=="Metrics"){Cf.rowObjects.push(CZ.rows[Cc]);Cc++;}else{Cb=true;}}while(Cc<CZ.rows.length){Cf.xAxisObjects.push(CZ.rows[Cc]);Cc++;}}CZ.cols.forEach(function(Ci){Cf.columnObjects.push(Ci);});}else{if(Ce==="Columns"){if(Ch.cols[Ch.cols.length-1].n==="Metrics"){Cf.sliceObjects.push(CZ.rows.pop());CZ.cols.forEach(function(Ci){Cf.columnObjects.push(Ci);});}else{Cf.sliceObjects.push(CZ.cols.pop());var Cc=0,Cb=false;while(Cb===false){if(Ch.cols[Cc].n!=="Metrics"){Cf.columnObjects.push(CZ.cols[Cc]);Cc++;}else{Cb=true;}}while(Cc<CZ.cols.length){Cf.xAxisObjects.push(CZ.cols[Cc]);Cc++;}}CZ.rows.forEach(function(Ci){Cf.rowObjects.push(Ci);});}}}else{var Cd=CZ.rows.concat(CZ.cols);if(Cd.length){Cf.sliceObjects.push(Cd.pop());}if(Cd.length){Cf.xAxisObjects.push(Cd.pop());Cd.forEach(function(Ci){Cf.columnObjects.push(Ci);});}}if(Cf.xAxisObjects.length>1&&Cf.xAxisObjects[0].t===4){Cf.metricsDropZone="Columns";}else{if(Cf.yAxisObjects.length>1&&Cf.yAxisObjects[0].t===4){Cf.metricsDropZone="Rows";}else{if(Cf.angleObjects.length>1){Cf.metricsDropZone="Rows";}else{Cf.metricsDropZone="";}}}Cf.secondaryMetricsDropZone="";}function B6(CZ,Ca){return CD.find(CZ,"did",Ca.did);}function Bq(CZ){return CZ.t===L.DssTypeMetric;}function Bw(CZ){return CZ&&CZ.t!==L.DssTypeMetric;}function B9(Ca,Cc,Cd){var CZ=false,Cb=function(){return true;};if(Cd){Cb=Cd===L.DssTypeMetric?Bq:Bw;}if(Ca.length&&(Cb(Ca[0])||Cd===undefined)){Ca.forEach(function(Ce){if(B6(Cc,Ce)===-1){Cc.push(Ce);CZ=true;}});}return CZ;}function Aq(Cc,Ca,Cd){var CZ=[],Cb=Cc===L.DssTypeMetric?Bq:Bw;if(Cd!==undefined&&Cd.length){Cd.forEach(function(Ce){if(Cb(Ce)){CZ.push(Ce);}});}if(Ca.length){Ca.forEach(function(Ce){if(Cb(Ce)){CZ.push(Ce);}});}return CZ;}function A6(Ca,CZ,Cb){Ca.forEach(function(Cc){B9(CZ[Cc],Cb[Cc]);});}function s(CZ,Ca){if(CZ.length){Ca.push(CZ.pop());}}function G(CZ,Ca){if(CZ.length&&CZ[0].t===4){Ca.push(CZ[0]);return true;}return false;}function B7(CZ,Ca){if(CZ.xAxisObjects.length>1){Ca.breakByObjects.push(CZ.xAxisObjects.pop());}B9(CZ.xAxisObjects,Ca.xAxisObjects);B9(CZ.yAxisObjects,Ca.yAxisObjects);}function Ao(Cb,Cd){var Ca,CZ,Cc;Cb.xAxisObjects=[];Cb.yAxisObjects=[];Cb.tooltipMetrics=[];Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cd.data.dz);CZ=Ca.groupingObjects;if(CZ.length&&CZ[0].t!==4){B9(CZ,Cb.xAxisObjects);}CZ=Ca.tooltipMetrics;Cc=Ca.sizeByMetric||Ca.getFirstColorByUnit(true)||CZ.pop();if(Cc){Cb.yAxisObjects.push(Cc);}}function AU(Cd,Ce,Ca){var Cb,CZ,Cc=[];Cb=new CG.HeatMapVisualizationHelper();Cb.setData(Ce.data.dz);CZ=Cb.groupingObjects;if(CZ.length===1){Cd.xAxisObjects.push(CZ.pop());}else{if(CZ.length>1){Cd.breakByObjects.push(CZ.pop());Cd.xAxisObjects.push(CZ.pop());Cd.columnObjects=CZ;}}if(Ca){if(Cd.xAxisObjects[0]){Cc.push(Cd.xAxisObjects[0].did);}CD.forEach(Cd.columnObjects,function(Cf){Cc.push(Cf.did);});}if(Cb.sizeByMetric){Cd.yAxisObjects.push(Cb.sizeByMetric);}if(Cb.colorBy){if(Cd.isMetric(Cb.colorBy[0])){if(!Cb.sizeByMetric||Cb.sizeByMetric.did!==Cb.colorBy[0].did){Cd.yAxisObjects.push(Cb.colorBy[0]);}}else{if(Ca){CD.forEach(Cb.colorBy,function(Cf){if(Cc.indexOf(Cf.did)>-1){Cd.colorByObjects.push(Cf);}});}}}if(!Cd.yAxisObjects.length&&Cb.tooltipMetrics.length){Cd.yAxisObjects.push(Cb.tooltipMetrics.shift());}Cd.metricsDropZone="Rows";}function Av(Cb,Cc){var Ca,CZ;Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cc.data.dz);CZ=Ca.groupingObjects;if(CZ.length===1){Cb.xAxisObjects.push(CZ[0]);}else{if(CZ.length===2){Cb.xAxisObjects.push(CZ[0]);Cb.breakByObjects.push(CZ[1]);}else{if(CZ.length>2){Cb.breakByObjects.push(CZ.pop());Cb.xAxisObjects.push(CZ.pop());Cb.columnObjects=CZ;}}}if(Ca.sizeByMetric){Cb.yAxisObjects.push(Ca.sizeByMetric);}Cb.colorByObjects=Ca.colorBy;Cb.tooltipMetrics=Ca.tooltipMetrics;}function u(Cb,Cd){var Ca,CZ,Cc;Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cd.data.dz);CZ=Ca.tooltipMetrics;Cc=Ca.sizeByMetric||Ca.getFirstColorByUnit(true)||CZ.shift();if(Cc){Cb.yAxisObjects.push(Cc);}Cc=Ca.getFirstColorByUnit(true);if(!Cc||Cb.yAxisObjects.length&&Cb.yAxisObjects[0].did===Cc.did){Cc=CZ.shift();}if(Cc){Cb.xAxisObjects.push(Cc);}B9(Ca.groupingObjects,Cb.breakByObjects);B9(Ca.colorBy,Cb.colorByObjects);B9(Ca.tooltipMetrics,Cb.tooltipMetrics,L.DssTypeMetric);}function Ad(CZ,Cc){var Cb,Ca;Cb=new CG.NetworkVisualizationHelper();Cb.setData(Cc.data.dz);var Cd=Cb.getNetworkMetrics();Ca=A1(Cd);if(Ca){CZ.xAxisObjects.push(Ca);}Ca=Cd[0];if(Ca){CZ.yAxisObjects.push(Ca);}Ca=A1(Cd);if(Ca){CZ.sizeByObjects.push(Ca);}Ca=Cb.fromItemAttribute;if(Ca){CZ.breakByObjects.push(Ca);}Ca=Cb.toItemAttribute;if(Ca){CZ.rowObjects.push(Ca);}B9(Cd,CZ.tooltipMetrics,L.DssTypeMetric);}function AX(Ca,Cb){var CZ=Ca.breakByObjects;if(CZ.length){Cb.xAxisObjects.push(CZ[0]);for(var Cc=1;Cc<CZ.length;Cc++){Cb.breakByObjects.push(CZ[Cc]);}B9(Ca.columnObjects,Cb.columnObjects,L.DssTypeAttribute);B9(Ca.rowObjects,Cb.rowObjects,L.DssTypeAttribute);}else{if(Ca.columnObjects.length){Cb.xAxisObjects.push(Ca.columnObjects.pop());}else{Cb.xAxisObjects.push(Ca.rowObjects.pop());}}B9(Ca.xAxisObjects,Cb.yAxisObjects,L.DssTypeMetric);B9(Ca.yAxisObjects,Cb.yAxisObjects,L.DssTypeMetric);var Cc=0;while(Cc<Cb.yAxisObjects.length){Cb.yAxisObjects[Cc].ax=CN;Cc++;}Cb.metricShapes="{}";if(Ca.sizeByObjects.length){Cb.sizeByObjects.push(Ca.sizeByObjects.splice(0,1)[0]);B9(Ca.sizeByObjects,Cb.tooltipMetrics);}A6(["tooltipMetrics","colorByObjects","columnObjects","rowObjects"],Ca,Cb);AJ(Ca,Cb);}function p(Ci,Cc,Cb,Cg,Cf,Co){var Cj,Ch,Ca,Cl=-1,Ck=Cf?Cf.length:0,Cn,CZ,Cm=Cf.concat([]),Ce=false;Cn=(Cg&&Ci.isMetric(Cg))?Cg:undefined;for(var Cd=0;Cd<Ck;Cd++){if(Ci.isMetric(Cf[Cd])){Ca=Cf[Cd];Cl=Cd;break;}}Cj=Cb||Cn;if(!Cj&&Ca){Cj=Ca;Ce=true;}if(Cj){Ci.xAxisObjects.push(Cj);}Ch=Cn||Ca;if(Ch&&Ch.did!==Cj.did){Ci.yAxisObjects.push(Ch);if(!Cn){Ce=true;}}if(Co){CZ=Cj;}else{CZ=Ca||Cn||Cb;if(Ca){Ce=true;}}if(CZ){Ci.sizeByObjects.push(CZ);}if(Cc){Ci.breakByObjects.push(Cc);}if(Cg){Ci.colorByObjects.push(Cg);}if(Ce){Cm.splice(Cl,1);}B9(Cm,Ci.tooltipMetrics,L.DssTypeMetric);}function Z(Cc,CZ){var Cb=new CG.MapHelper(),Ca=this.vis.getTopLayerHost();Cb.setWidget(Ca);p(CZ,Cb.getGeoUnit(),Cb.getSizeByUnit(),Cb.getColorByUnit(),Cb.getTooltipUnits(),true);}function AT(CZ,Cb){var Ca=new CG.ImageLayoutHelper({node:Cb});Ca.setData(Cb.data.dz);p(CZ,Ca.geoAttribute,Ca.sizeByMetric,Ca.colorByMetric,Ca.tooltipMetrics);}function AQ(Cj,Cg,Cb){var Ck=Aq(L.DssTypeAttribute,Cj.xAxisObjects,Cj.yAxisObjects);if(Ck.length){B9(Cj.xAxisObjects,Cg.breakByObjects,L.DssTypeAttribute);B9(Cj.yAxisObjects,Cg.breakByObjects,L.DssTypeAttribute);}else{if(Cj.breakByObjects.length===0){var Cc=Aq(L.DssTypeAttribute,Cj.columnObjects,Cj.rowObjects);if(Cc.length){if(Cj.columnObjects.length){Cg.breakByObjects.push(Cj.columnObjects.pop());}else{if(Cj.rowObjects.length){Cg.breakByObjects.push(Cj.rowObjects.pop());}}}}}var Ce=Aq(L.DssTypeMetric,Cj.yAxisObjects),Ch=Aq(L.DssTypeMetric,Cj.xAxisObjects);var Cf=Ce.length?"yAxisObjects":"xAxisObjects";var Ca=Ch.length?"yAxisObjects":"xAxisObjects";if(Ce.length+Ch.length===1){Cg[Cf].push(Cj[Cf].pop());if(Cj.sizeByObjects.length==0){if(Cj.colorByObjects.length&&Cj.colorByObjects[0].t===L.DssTypeMetric){B9(Cj.colorByObjects,Cg[Ca],L.DssTypeMetric);}else{Cg[Ca].push(Cj.tooltipMetrics.pop());}}else{B9(Cj.sizeByObjects,Cg[Ca],L.DssTypeMetric);}}else{if(Ce.length+Ch.length!==0){var Cd=Math.ceil(Cj[Cf].length/2);for(var Ci=0;Ci<Cd;Ci++){Cg[Ca].push(Cj[Cf][Ci]);}for(Cd;Cd<Cj[Cf].length;Cd++){Cg[Cf].push(Cj[Cf][Cd]);}}else{var CZ=Aq(L.DssTypeMetric,Cj.colorByObjects);if(Cj.sizeByObjects.length&&CZ.length){B9(Cj.sizeByObjects,Cg.yAxisObjects,L.DssTypeMetric);B9(Cj.colorByObjects,Cg.xAxisObjects,L.DssTypeMetric);}else{B9(Cj.sizeByObjects,Cg.yAxisObjects,L.DssTypeMetric);B9(Cj.colorByObjects,Cg.yAxisObjects,L.DssTypeMetric);}}}A6(["tooltipMetrics","sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],Cj,Cg);I(Cj,Cg);}function v(Ca,Cb,CZ){if(Ca.sizeByObjects.length){B9(Ca.sizeByObjects,Cb.angleObjects);}else{if(Ca.colorByObjects.length&&Ca.colorByObjects[0].t===L.DssTypeMetric){Cb.angleObjects.push(Ca.colorByObjects[0]);}else{if(Ca.xAxisObjects.length&&Ca.xAxisObjects[0].t===L.DssTypeMetric){B9(Ca.xAxisObjects,Cb.angleObjects);Ca.xAxisObjects=[];B9(Cb.breakByObjects,Cb.sliceObjects);}if(Ca.yAxisObjects.length&&Ca.yAxisObjects[0].t===L.DssTypeMetric){B9(Ca.yAxisObjects,Cb.angleObjects);Ca.yAxisObjects=[];B9(Cb.breakByObjects,Cb.sliceObjects);}else{if(CZ){if(Ca.tooltipMetrics.length){Cb.angleObjects.push(Ca.tooltipMetrics.splice(0,1)[0]);}}}}}}function AL(Ca){var CZ=Aq(L.DssTypeMetric,Ca.xAxisObjects,Ca.yAxisObjects);if(!CZ.length){B9(Ca.breakByObjects,Ca.sliceObjects);return true;}return false;}function l(Ca,Cc){var CZ=function(){if(Ca.sizeByObjects.length){return Ca.sizeByObjects[0];}else{if(Ca.colorByObjects.length&&Ca.colorByObjects[0].t===L.DssTypeMetric){return Ca.colorByObjects[0];}else{if(Ca.tooltipMetrics.length){return Ca.tooltipMetrics.splice(0,1)[0];}}}};var Cb=Aq(L.DssTypeAttribute,Ca.xAxisObjects),Ce=Aq(L.DssTypeAttribute,Ca.yAxisObjects),Cd;if(Cb.length>0){if(Cb.length>1&&!Ce.length){Cc.breakByObjects.push(Ca.xAxisObjects.pop());}B9(Ca.yAxisObjects,Cc.breakByObjects,L.DssTypeAttribute);B9(Ca.xAxisObjects,Cc.xAxisObjects,L.DssTypeAttribute);Cd=CZ();if(Cd){Cc.yAxisObjects.push(Cd);}}else{if(Ce.length>0){if(Ce.length>1){Cc.breakByObjects.push(Ca.yAxisObjects.pop());}B9(Ca.yAxisObjects,Cc.yAxisObjects,L.DssTypeAttribute);Cd=CZ();if(Cd){Cc.xAxisObjects.push(Cd);}}else{if(Ca.breakByObjects.length){Cc.xAxisObjects.push(Ca.breakByObjects.splice(0,1)[0]);Cd=CZ();if(Cd){Cc.yAxisObjects.push(Cd);}}else{if(Ca.columnObjects.length){Cc.xAxisObjects.push(Ca.columnObjects.pop());Cd=CZ();if(Cd){Cc.yAxisObjects.push(Cd);}}else{if(Ca.rowObjects.length){Cc.yAxisObjects.push(Ca.rowObjects.pop());Cd=CZ();if(Cd){Cc.xAxisObjects.push(Cd);}}else{Cd=CZ();if(Cd){Cc.yAxisObjects.push(Cd);}}}}}}A6(["colorByObjects","columnObjects","rowObjects","sizeByObjects","tooltipMetrics","breakByObjects"],Ca,Cc);}function Bk(Ca,Cb){var CZ=function(){if(Ca.sizeByObjects.length){return Ca.sizeByObjects.pop();}else{if(Ca.colorByObjects.length&&Ca.colorByObjects[0].t===L.DssTypeMetric){return Ca.colorByObjects.pop();}else{if(Ca.tooltipMetrics.length){return Ca.tooltipMetrics.splice(0,1)[0];}}}};B9(Ca.yAxisObjects,Cb.breakByObjects,L.DssTypeAttribute);B9(Ca.xAxisObjects,Cb.breakByObjects,L.DssTypeAttribute);if(!Cb.breakByObjects.length){if(Ca.breakByObjects.length){B9(Ca.breakByObjects,Cb.breakByObjects);}else{if(Ca.columnObjects.length){Cb.breakByObjects.push(Ca.columnObjects.pop());}else{if(Ca.rowObjects.length){Cb.breakByObjects.push(Ca.rowObjects.pop());}}}}A6(["sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],Ca,Cb);var Cc=CZ();if(Cc){Cb.yAxisObjects.push(Cc);Cc=CZ();if(Cc){Cb.xAxisObjects.push(Cc);}}B9(Ca.tooltipMetrics,Cb.tooltipMetrics);}function AM(CZ,Cb){var Ca=Aq(L.DssTypeAttribute,CZ.xAxisObjects),Cc=Aq(L.DssTypeAttribute,CZ.yAxisObjects);if(Ca.length){Cb.sliceObjects.push(CZ.xAxisObjects.pop());}else{if(Cc.length){Cb.sliceObjects.push(CZ.yAxisObjects.pop());}else{if(CZ.breakByObjects.length){Cb.sliceObjects.push(CZ.breakByObjects.splice(0,1)[0]);}else{if(CZ.columnObjects.length){Cb.sliceObjects.push(CZ.columnObjects.pop());}else{if(CZ.rowObjects.length){Cb.sliceObjects.push(CZ.rowObjects.pop());}}}}}B9(CZ.yAxisObjects,Cb.yAxisObjects,L.DssTypeAttribute);B9(CZ.xAxisObjects,Cb.xAxisObjects,L.DssTypeAttribute);A6(["sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],CZ,Cb);v(CZ,Cb,true);B9(CZ.tooltipMetrics,Cb.tooltipMetrics);}function CH(Cb,Cd){var Ca,CZ,Cc;Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cd.data.dz);CZ=Ca.groupingObjects;if(CZ.length&&!Cb.isMetric(CZ[0])){Cb.xAxisObjects.push(CZ.pop());if(CZ.length){Cb.yAxisObjects.push(CZ.pop());}}B9(Ca.groupingObjects,Cb.columnObjects,L.DssTypeAttribute);B9(Ca.colorBy,Cb.colorByObjects);Cc=Ca.sizeByMetric;if(Cc){Cb.sizeByObjects.push(Cc);}B9(Ca.tooltipMetrics,Cb.tooltipMetrics,L.DssTypeMetric);}function BI(Cb,Ca,CZ,Cd,Ce){var Cf=Ce?Ce.length:0;if(Ca){Cb.xAxisObjects.push(Ca);}for(var Cc=0;Cc<Cf;Cc++){if(!Cb.isMetric(Ce[Cc])){Cb.yAxisObjects.push(Ce[Cc]);}else{if(Cb.isMetric(Ce[Cc])){Cb.tooltipMetrics.push(Ce[Cc]);}}}if(Cd){Cb.colorByObjects.push(Cd);}}function CB(Cc,CZ){var Cb=new CG.MapHelper(),Ca=this.vis.getTopLayerHost();Cb.setWidget(Ca);BI(CZ,Cb.getGeoUnit(),Cb.getSizeByUnit(),Cb.getColorByUnit(),Cb.getTooltipUnits());}function A5(Cc,CZ,Ca){if(CZ.breakByObjects.length){Ca.sliceObjects.push(CZ.breakByObjects.pop());}else{if(CZ.columnObjects.length){Ca.sliceObjects.push(CZ.columnObjects.pop());}else{if(CZ.rowObjects.length){Ca.sliceObjects.push(CZ.rowObjects.pop());}}}v(CZ,Ca);A6(["columnObjects","rowObjects","colorByObjects","xAxisObjects","yAxisObjects","colorByObjects","tooltipMetrics","breakByObjects","sizeByObjects"],CZ,Ca);var Cb=AL(Ca);A9(CZ,Ca,Cb);}function S(CZ,Cb){if(CZ.breakByObjects.length){Cb.sliceObjects.push(CZ.breakByObjects.pop());}else{var Ca=Aq(L.DssTypeAttribute,CZ.xAxisObjects),Cd=Aq(L.DssTypeAttribute,CZ.yAxisObjects);if(Cd.length){Cb.sliceObjects.push(CZ.yAxisObjects.pop());}else{if(Ca.length){Cb.sliceObjects.push(CZ.xAxisObjects.pop());}else{if(CZ.rowObjects.length&&CZ.columnObjects.length===0){Cb.sliceObjects.push(CZ.rowObjects.pop());}else{if(CZ.columnObjects.length){Cb.sliceObjects.push(CZ.columnObjects.pop());}}}}}v(CZ,Cb);A6(["sizeByObjects","breakByObjects","rowObjects","columnObjects","xAxisObjects","yAxisObjects","colorByObjects","tooltipMetrics"],CZ,Cb);var Cc=AL(Cb);A9(CZ,Cb,Cc);}function BH(Cb,Cc){var Ca,CZ;Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cc.data.dz);CZ=Ca.groupingObjects;if(CZ.length>0){Cb.sliceObjects.push(CZ.pop());if(CZ.length>0){Cb.xAxisObjects.push(CZ.pop());}if(CZ.length>0){Cb.columnObjects=CZ;}}if(Ca.sizeByMetric){Cb.angleObjects.push(Ca.sizeByMetric);}Cb.colorByObjects=Ca.colorBy;Cb.tooltipMetrics=Ca.tooltipMetrics;}function Bs(Ca,Cd){var Cc,CZ,Cb;Cc=new CG.NetworkVisualizationHelper();Cc.setData(Cd.data.dz);Cb=Cc.fromItemAttribute||Cc.toItemAttribute;if(Cb){Ca.sliceObjects.push(Cb);}Cb=Cc.nodeSizeMetric||Cc.edgeSizeMetric||Cc.edgeColorMetric;if(Cb){Ca.angleObjects.push(Cb);}CZ=Ca.sliceObjects;Cb=CZ.length&&CZ[0];if(Cb){Ca.colorByObjects.push(Cb);}}function AP(Ca,Cc,Ce,Cd,Cf){var CZ,Cb;if(Cc){Ca.sliceObjects.push(Cc);}if(Ce){Ca.angleObjects.push(Ce);}CZ=Ca.sliceObjects;Cb=Cd||(CZ.length&&CZ[0]);if(Cb){Ca.colorByObjects.push(Cb);}B9(Cf,Ca.tooltipMetrics,L.DssTypeMetric);}function CM(CZ,Cb){var Ca=new CG.ImageLayoutHelper({node:Cb});Ca.setData(Cb.data.dz);AP(CZ,Ca.geoAttribute,(Ca.sizeByMetric||Ca.colorByMetric),Ca.colorByMetric,Ca.tooltipMetrics);}function BK(CZ,Ca){var Cb=this.templateInfo,Cc=Cb.rows,Cd=Cb.cols,Ce=Cb.mx[0];B9(Cc,Ca.xAxisObjects);B9(Cd,Ca.xAxisObjects);if(Ce){Ca.yAxisObjects.push(Ce);}}function AG(Cc,CZ){var Cb=new CG.MapHelper(),Ca=this.vis.getTopLayerHost();Cb.setWidget(Ca);var Cd=Cb.getColorByUnit();AP(CZ,Cb.getGeoUnit(),(Cb.getSizeByUnit()||Cd),Cd,Cb.getTooltipUnits());}function AI(Cc,CZ,Ca,Cb){if(CZ){S.call(this,CZ,Ca);}else{switch(Cc){case Br.ESRIMAP:case Br.GOOGLEMAP:AG.call(this,Cc,Ca,Cb);break;case Br.HEATMAP:BH.call(this,Ca,Cb);break;case Br.NETWORK:Bs.call(this,Ca,Cb);break;case Br.IMAGELAYOUT:CM.call(this,Ca,Cb);break;case Br.GRID:BX.call(this,Ca,Cb);break;}}}function D(Ca,Cd){var CZ=Ca[Cd],Cc=[],Cb=[];if(CZ&&CZ.length&&Ca.isMetric(CZ[0])){CZ.forEach(function(Ce){if(Ce.ax===CN){Cc.push(Ce);}else{if(Ce.ax===F){Cb.push(Ce);}}});}return[Cc,Cb];}function CF(Ca,Cb){var CZ=Ca[Cb];if(CZ&&CZ.length){CZ.forEach(function(Cc){if(Cc.ax===F){Cc.ax=CN;}});}}function AK(Ca,Cf,Ce){var Cc=[],Cd=(Cf.length/2),CZ=function(Cg,Ch){Cc.push("'"+Cg.did+"':"+Ch);};var Cb=0;while(Cd>0){Cf[0].ax=CN;Ca[Ce].push(Cf[0]);CZ(Cf[0],P.BAR);Cf.splice(0,1);Cd-=1;Cb++;}while(Cf.length){Cf[0].ax=F;Ca[Ce].push(As.copy({ax:F},Cf[0]));CZ(Cf[0],P.LINE);Cf.splice(0,1);Cb++;}if(Cc.length){Ca.metricShapes="{"+Cc.join(",")+"}";}}function BW(Cj,Cf,Ce){var Cg=D(Cj,Ce),Ci=Cg[0],Cc=Cg[1],CZ=[],Cb=[];var Ch=Ci.length-Cc.length,Ca;if(Ch>0){Cb=Cc;Ca=Ci.length-Math.floor(Ch/2);for(var Cd=Ca;Cd<Ci.length;Cd++){Cb.push(Ci[Cd]);}Ci.splice(Ci.length-Math.floor(Ch/2),Ci.length-Math.floor(Ch/2));CZ=Ci;}else{if(Ch<0){CZ=Ci;Ch=Ch*-1;Ca=Cc.length-Math.floor(Ch/2);for(var Cd=Ca;Cd<Cc.length;Cd++){CZ.push(Cc[Cd]);}Cc.splice(Cc.length-Math.floor(Ch/2),Cc.length-Math.floor(Ch/2));Cb=Cc;}else{Cb=Cc;CZ=Ci;}}CZ=CZ.concat(Cb);AK(Cf,CZ,Ce);}function BN(Ca,Cc){Cc.breakByObjects=[];Cc.xAxisObjects=[];var Co=Aq(L.DssTypeAttribute,Ca.xAxisObjects),Cp=Aq(L.DssTypeAttribute,Ca.yAxisObjects),Ce=Aq(L.DssTypeMetric,Ca.xAxisObjects),Ch=Aq(L.DssTypeMetric,Ca.yAxisObjects),Cm=function(Cr,Cs){if(Ca.sizeByObjects.length){return Ca.sizeByObjects.splice(0,1)[0];}else{if(Ca.angleObjects.length){return Ca.angleObjects.pop();}else{if(Ca.colorByObjects.length&&Ca.colorByObjects[0].t===L.DssTypeMetric){return Ca.colorByObjects[0];}else{if(Ca.tooltipMetrics.length){return Ca.tooltipMetrics.splice(0,1)[0];}}}}},CZ=function(Cr){if(Ca.breakByObjects.length){return Ca.breakByObjects.splice(0,1)[0];}else{if(Ca.sliceObjects.length){return Ca.sliceObjects.splice(0,1)[0];}else{if(Ca.columnObjects.length||Ca.rowObjects.length){if(Cr==="xAxisObjects"){if(Ca.columnObjects.length){return Ca.columnObjects.pop();}else{return Ca.rowObjects.pop();}}else{if(Ca.rowObjects.length){return Ca.rowObjects.pop();}else{return Ca.columnObjects.pop();}}}}}};if(Co.length===0&&Cp.length===0){if(Ce.length&&Ch.length){var Cn=CZ("xAxisObjects");if(Cn!=undefined){Cc.xAxisObjects.push(Cn);}var Ck,Cf,Cd=[],Cq=[];if(Ca.yAxisObjects[0].ax===CN){Cd=Ca.yAxisObjects.concat(Ca.xAxisObjects);}else{Cd=Ca.xAxisObjects.concat(Ca.yAxisObjects);}AK(Cc,Cd,"yAxisObjects");}else{if(Ce.length||Ch.length){var Cj=Ce.length?"xAxisObjects":"yAxisObjects",Ci=Ch.length?"xAxisObjects":"yAxisObjects";Cc[Ci].push(CZ(Ci));var Cb=[],Cl=[];if(Ca[Cj].length===1){if(Ca[Cj][0].ax===CN){Cb[0]=Cm(Cj);if(Cb[0]!==undefined){Cl=Ca[Cj].concat(Cb);}}else{Cb[0]=Cm(Cj);if(Cb[0]!==undefined){Cl=Cb.concat(Ca[Cj]);}}AK(Cc,Cl,Cj);}else{BW(Ca,Cc,Cj);}}else{var Cg=Cm("yAxisObjects");if(Cg!==undefined){Ca.yAxisObjects.push(Cg);}Cg=Cm("yAxisObjects");if(Cg!==undefined){Ca.yAxisObjects.push(Cg);}BW(Ca,Cc,"yAxisObjects");Cc.xAxisObjects.push(CZ("xAxisObjects"));}}}else{if(Co.length&&Cp.length){var Cd=[];B9(Ca.xAxisObjects,Cc.xAxisObjects,L.DssTypeAttribute);B9(Ca.yAxisObjects,Cc.xAxisObjects,L.DssTypeAttribute);var Cg=Cm("yAxisObjects");if(Cg!==undefined){Cd.push(Cg);}Cg=Cm("yAxisObjects");if(Cg!==undefined){Cd.push(Cg);}AK(Cc,Cd,"yAxisObjects");}else{if(Co.length||Cp.length){var Cj,Ci,Cd=[];if(Co.length){Cj="xAxisObjects";Ci="yAxisObjects";}else{if(Cp.length){Cj="yAxisObjects";Ci="xAxisObjects";}}Cd=Ca[Ci];B9(Ca[Cj],Cc[Cj],L.DssTypeAttribute);var Cg=Cm(Ci);if(Cg!==undefined){Cd.push(Cg);}if(Ce.length===0&&Ch.length===0){Cg=Cm(Ci);if(Cg!==undefined){Cd.push(Cg);}}AK(Cc,Cd,Ci);}}}B9(Ca.breakByObjects,Cc.breakByObjects);B9(Ca.sliceObjects,Cc.breakByObjects);if(Ca.angleObjects.length){if(!Ca.sizeByObjects.length){Cc.sizeByObjects.push(Ca.angleObjects.pop());}CJ(Cc,Ca.angleObjects);}A6(["colorByObjects","rowObjects","columnObjects","sizeByObjects","tooltipMetrics"],Ca,Cc);I(Ca,Cc);}function CK(Ci,Ce){Ce.xAxisObjects=[];Ce.yAxisObjects=[];var Cj=Aq(L.DssTypeAttribute,Ci.xAxisObjects,Ci.yAxisObjects),Cg=Aq(L.DssTypeMetric,Ci.xAxisObjects),Cc=Aq(L.DssTypeMetric,Ci.yAxisObjects),Cb=function(){if(Ci.sizeByObjects.length){return Ci.sizeByObjects[0];}else{if(Ci.colorByObjects.length&&Ci.colorByObjects[0].t===L.DssTypeMetric){return Ci.colorByObjects.pop();}else{if(Ci.tooltipMetrics.length){return Ci.tooltipMetrics.splice(0,1)[0];}}}};if(Cj.length){B9(Ci.xAxisObjects,Ce.xAxisObjects,L.DssTypeAttribute);B9(Ci.yAxisObjects,Ce.yAxisObjects,L.DssTypeAttribute);}else{if(Ci.breakByObjects.length){if(Cg.length==0){if(Ci.breakByObjects.length){Ce.xAxisObjects.push(Ci.breakByObjects[0]);Ci.breakByObjects.splice(0,1);}}else{if(Ci.breakByObjects.length){Ce.yAxisObjects.push(Ci.breakByObjects[0]);Ci.breakByObjects.splice(0,1);}}}else{if(Cc.length){Ce.xAxisObjects.push(Ci.columnObjects.pop());}else{if(Cg.length){Ce.yAxisObjects.push(Ci.rowObjects.pop());}}}}var Cd;if(Cg.length){Cd="xAxisObjects";}else{if(Cc.length){Cd="yAxisObjects";}}var Cf=D(Ci,Cd),Ch=Cf[0],CZ=Cf[1];if(Ch.length+CZ.length===1){var Ca=Cb();if(Ca){if(Ch.length){Ca.ax=F;}else{Ca.ax=CN;}Ci[Cd].push(Ca);}}BW(Ci,Ce,Cd);I(Ci,Ce);A6(["columnObjects","rowObjects","colorByObjects","breakByObjects"],Ci,Ce);}function B3(CZ,Ca){if(CZ.breakByObjects.length){Ca.xAxisObjects.push(CZ.breakByObjects[0]);CZ.breakByObjects.splice(0,1);}else{if(CZ.columnObjects.length){Ca.xAxisObjects.push(CZ.columnObjects.pop());}else{Ca.xAxisObjects.push(CZ.rowObjects.pop());}}var Cd=Ae(CZ,null,"yAxisObjects"),Cc=Aq(L.DssTypeMetric,CZ.xAxisObjects),Cb=[];if(Cd===CN){Cb=CZ.yAxisObjects.concat(Cc);}else{Cb=Cc.concat(CZ.yAxisObjects);}AK(Ca,Cb,"yAxisObjects");if(CZ.sizeByObjects.length){Ca.sizeByObjects.push(CZ.sizeByObjects.splice(0,1)[0]);B9(CZ.sizeByObjects,Ca.tooltipMetrics);}A6(["breakByObjects","colorByObjects","columnObjects","rowObjects","tooltipMetrics"],CZ,Ca);AJ(CZ,Ca);}function CL(Ch,Cf){var Cc,Cb,CZ=[],Cd=function(){if(Ch.sizeByObjects.length){return Ch.sizeByObjects.pop();}else{if(Ch.colorByObjects.length&&Ch.colorByObjects[0].t===L.DssTypeMetric){return Ch.colorByObjects.pop();}else{if(Ch.tooltipMetrics.length){return Ch.tooltipMetrics.splice(0,1)[0];}}}};A6(["colorByObjects","columnObjects","rowObjects","sizeByObjects"],Ch,Cf);var Cg=Aq(L.DssTypeAttribute,Ch.xAxisObjects),Ca=Aq(L.DssTypeAttribute,Ch.yAxisObjects),Ce="yAxisObjects";if(Cg.length){Ce="yAxisObjects";B9(Ch.yAxisObjects,Cf.xAxisObjects,L.DssTypeAttribute);B9(Ch.xAxisObjects,Cf.xAxisObjects,L.DssTypeAttribute);}else{if(Ca.length){Ce="xAxisObjects";B9(Ch.yAxisObjects,Cf.yAxisObjects,L.DssTypeAttribute);}else{if(Ch.breakByObjects.length){Cf.xAxisObjects.push(Ch.breakByObjects.splice(0,1)[0]);Ce="yAxisObjects";}else{if(Ch.columnObjects.length){Ce="yAxisObjects";Cf.xAxisObjects.push(Ch.columnObjects.pop());}else{if(Ch.rowObjects.length){Ce="xAxisObjects";Cf.yAxisObjects.push(Ch.rowObjects.pop());}}}}}Cb=Cd();if(Cb){Cf[Ce].push(Cb);CZ.push("'"+Cb.did+"':"+P.BAR);}Cc=Cd();if(Cc){Cf[Ce].push(As.copy({ax:F},Cc));CZ.push("'"+Cc.did+"':"+P.LINE);}B9(Ch.tooltipMetrics,Cf.tooltipMetrics,L.DssTypeMetric);B9(Ch.breakByObjects,Cf.breakByObjects);if(CZ.length){Cf.metricShapes="{"+CZ.join(",")+"}";}I(Ch,Cf);}function j(CZ,Ch,Ce){var Ca=this.templateInfo,Cf=Ca.mx,Cg=this.vis.model.data.gsi,Cb=this.definition;if(Ca.cols.length&&Ca.rows.length){var Cd;Cg.rows.forEach(function(Ci){if(Ci.n==="Metrics"){Cd="Rows";}});Cg.cols.forEach(function(Ci){if(Ci.n==="Metrics"){Cd="Columns";}});if(Cd==="Rows"){if(Cg.rows[Cg.rows.length-1].n==="Metrics"){AK(Ce,Cf,"yAxisObjects");Ce.xAxisObjects.push(Ca.cols.pop());}else{Ce.yAxisObjects.push(Ca.rows.pop());AK(Ce,Cf,"xAxisObjects");}Ca.rows.forEach(function(Ci){Ce.rowObjects.push(Ci);});Ca.cols.forEach(function(Ci){Ce.columnObjects.push(Ci);});}else{if(Cd==="Columns"){if(Cg.cols[Cg.cols.length-1].n==="Metrics"){AK(Ce,Cf,"xAxisObjects");Ce.yAxisObjects.push(Ca.rows.pop());}else{Ce.xAxisObjects.push(Ca.cols.pop());AK(Ce,Cf,"yAxisObjects");}Ca.rows.forEach(function(Ci){Ce.rowObjects.push(Ci);});Ca.cols.forEach(function(Ci){Ce.columnObjects.push(Ci);});}}}else{AK(Ce,Cf,"yAxisObjects");if(Ca.cols.length+Ca.rows.length===1){Bh(Ce,Ca.cols,Ca.rows,"xAxisObjects",B5(Cb,z.PROP_XAXIS));}else{var Cc=Ca.rows.concat(Ca.cols);if(Cc.length){Ce.breakByObjects.push(Cc.pop());}if(Cc.length){Ce.xAxisObjects.push(Cc.pop());}Cc.forEach(function(Ci){Ce.columnObjects.push(Ci);});}}if(Ce.xAxisObjects.length>1&&Ce.xAxisObjects[0].t===4){Ce.metricsDropZone="Columns";}else{if(Ce.yAxisObjects.length>1&&Ce.yAxisObjects[0].t===4){Ce.metricsDropZone="Rows";}else{Ce.metricsDropZone="";}}Ce.secondaryMetricsDropZone="";}function e(Cb,Cd){var Ca,CZ,Cc,Cf,Ce=[],Cg;Ca=new CG.HeatMapVisualizationHelper();Ca.setData(Cd.data.dz);CZ=Ca.groupingObjects;if(CZ.length===1){Cb.xAxisObjects.push(CZ[0]);}else{if(CZ.length===2){Cb.xAxisObjects.push(CZ[0]);Cb.breakByObjects.push(CZ[1]);}else{if(CZ.length>2){Cb.breakByObjects.push(CZ.pop());Cb.xAxisObjects.push(CZ.pop());Cb.columnObjects=CZ;}}}Cg=Ca.getFirstColorByUnit(true);CZ=Ca.tooltipMetrics;Cf=Cc=Ca.sizeByMetric||Cg||CZ.shift();if(Cc){Cb.yAxisObjects.push(Cc);Ce.push("'"+Cc.did+"':"+P.BAR);}Cc=(Cg&&(Cg.did!==Cf.did))?Cg:CZ.shift();if(Cc){Cb.yAxisObjects.push(As.copy({ax:F},Cc));Ce.push("'"+Cc.did+"':"+P.LINE);}B9(Ca.colorBy,Cb.colorByObjects);B9(Ca.tooltipMetrics,Cb.tooltipMetrics,L.DssTypeMetric);if(Ce.length){Cb.metricShapes="{"+Ce.join(",")+"}";}}function A1(Cb,Ca){var CZ;CD.forEach(Cb,function(Ce,Cd,Cc){if(Ce&&Ce!==Ca){CZ=Ce;Cc.splice(Cd,1);return false;}});return CZ;}function Bf(Ca,Cd){var Cc,Cb,Cf,CZ,Ce=[];Cc=new CG.NetworkVisualizationHelper();Cc.setData(Cd.data.dz);Cb=Cc.fromItemAttribute||Cc.toItemAttribute;if(Cb){Ca.xAxisObjects.push(Cb);CZ=Cb;}var Cg=Cc.getNetworkMetrics();Cf=Cb=A1(Cg);if(Cb){Ca.yAxisObjects.push(Cb);Ce.push("'"+Cg.did+"':"+P.BAR);}Cb=A1(Cg,Cf);if(Cb){Ca.yAxisObjects.push(As.copy({ax:F},Cb));Ce.push("'"+Cb.did+"':"+P.LINE);}if(Ce.length){Ca.metricShapes="{"+Ce.join(",")+"}";}Cb=Cc.toItemAttribute;if(Cb&&(CZ!==Cb)){Ca.rowObjects.push(Cb);}}function BA(Ca,CZ,Cf,Cc,Cg){var Cb,Ce,Cd=[];if(CZ){Ca.xAxisObjects.push(CZ);}Ce=Cb=A1(Cf);if(!Cb){Ce=Cb=Cc&&(Cc.length>0)&&(Cc[Cc.length-1].t===L.DssTypeMetric)&&Cc.pop();}if(Cb){Ca.yAxisObjects.push(Cb);Cd.push("'"+Cb.did+"':"+P.BAR);}Cb=A1(Cf,Ce);if(!Cb){Cb=Cc&&(Cc.length>0)&&(Cc[Cc.length-1].t===L.DssTypeMetric)&&Cc.pop();}if(Cb){Ca.yAxisObjects.push(As.copy({ax:F},Cb));Cd.push("'"+Cb.did+"':"+P.LINE);}if(Cg){Ca.colorByObjects.push(Cg);}if(Cc){B9(Cc,Ca.tooltipMetrics,L.DssTypeMetric);}if(Cd.length){Ca.metricShapes="{"+Cd.join(",")+"}";}}function Aa(CZ,Cb){var Ca=new CG.ImageLayoutHelper({node:Cb});Ca.setData(Cb.data.dz);BA(CZ,Ca.geoAttribute,[Ca.sizeByMetric,Ca.colorByMetric],Ca.tooltipMetrics,Ca.colorByMetric);}function r(Cd,CZ){var Cc=new CG.MapHelper(),Cb=this.vis.getTopLayerHost();Cc.setWidget(Cb);var Ce=Cc.getColorByUnit(),Ca=[Cc.getSizeByUnit()];if(Ce&&Ce.t===L.DssTypeMetric){Ca.push(Ce);}BA(CZ,Cc.getGeoUnit(),Ca,Cc.getTooltipUnits(),Ce);}function Bx(Cc,CZ,Ca,Cb){switch(Cc){case Br.ESRIMAP:case Br.GOOGLEMAP:r.call(this,Cc,Ca,Cb);break;case Br.HEATMAP:e.call(this,Ca,Cb);break;case Br.NETWORK:Bf.call(this,Ca,Cb);break;case Br.IMAGELAYOUT:Aa.call(this,Ca,Cb);break;case Br.KPICARD:j.call(this,Cc,CZ,Ca);break;case Br.GRID:j.call(this,Cc,CZ,Ca);break;}}function Bg(Cb,Cd){var CZ=Cb[Cd],Ca=[],Cc=[];if(CZ&&CZ.length&&Cb.isMetric(CZ[0])){CZ.forEach(function(Ce){if(Ce.ax===CN){Ca.push(Ce);}else{if(Ce.ax===F){Cc.push(Ce);Ce.ax=CN;}}});Cb[Cd]=Cc.concat(Ca);}}function A0(Ca,Cb){var CZ=Ca[Cb];if(CZ&&CZ.length&&Ca.isMetric(CZ[0])){CZ.forEach(function(Cc){Ca[Cb].push(Cc);if(Cc.ax===CN){Cc.ax=F;}});}}function BM(CZ,Ca){if(Au(Ca)){A0(CZ,"xAxisObjects");}else{A0(CZ,"yAxisObjects");}}function d(CZ,Ca){if(Au(Ca)){Bg(CZ,"xAxisObjects");}else{Bg(CZ,"yAxisObjects");}}function B(CZ,Cb,Cd){if(CZ.breakByObjects.length){Cb.sliceObjects.push(CZ.breakByObjects.pop());}else{var Ca=Aq(L.DssTypeAttribute,CZ.xAxisObjects),Ce=Aq(L.DssTypeAttribute,CZ.yAxisObjects);if(Ca.length){Cb.sliceObjects.push(CZ.xAxisObjects.pop());}else{if(Ce.length){Cb.sliceObjects.push(CZ.yAxisObjects.pop());}else{if(CZ.columnObjects.length){Cb.sliceObjects.push(CZ.columnObjects.pop());}else{if(CZ.rowObjects.length){Cb.sliceObjects.push(CZ.rowObjects.pop());}}}}}v(CZ,Cb);d(CZ,Cd);if(CZ.sizeByObjects.length){Cb.sizeByObjects.push(CZ.sizeByObjects.splice(0,1)[0]);B9(CZ.sizeByObjects,Cb.tooltipMetrics);}A6(["columnObjects","rowObjects","yAxisObjects","xAxisObjects","colorByObjects","tooltipMetrics","breakByObjects"],CZ,Cb);var Cc=AL(Cb);A9(CZ,Cb,Cc);}function Bd(CZ,Ca,Cb){if(Ae(CZ,Cb)===F){BM(CZ,Cb);}else{d(CZ,Cb);}Ca.clone(CZ);if(At()){I(CZ,Ca);}}function BJ(Ca,Cd){var Cc,Cb,CZ;Cc=new CG.NetworkVisualizationHelper();Cc.setData(Cd.data.dz);Cb=Cc.fromItemAttribute||Cc.toItemAttribute;if(Cb){Ca.xAxisObjects.push(Cb);CZ=Cb;}var Ce=Cc.getNetworkMetrics();Cb=A1(Ce);if(Cb){Ca.yAxisObjects.push(Cb);}B9(Ce,Ca.tooltipMetrics,L.DssTypeMetric);Cb=Cc.toItemAttribute;if(Cb&&(CZ!==Cb)){Ca.rowObjects.push(Cb);}}function q(Cf,Cg,Ca,Ce,Cd){var CZ,Ci=-1,Ch=Cd?Cd.length:0,Cc,Cj=Cd.concat([]);if(Cg){Cf.xAxisObjects.push(Cg);}for(var Cb=0;Cb<Ch;Cb++){if(Cf.isMetric(Cd[Cb])){CZ=Cd[Cb];Ci=Cb;break;}}Cc=Ca||Ce;if(!Cc&&CZ){Cc=CZ;Cj.splice(Ci,1);}if(Cc){Cf.yAxisObjects.push(Cc);}if(Ce){Cf.colorByObjects.push(Ce);}B9(Cj,Cf.tooltipMetrics,L.DssTypeMetric);}function W(Cc,CZ){var Cb=new CG.MapHelper(),Ca=this.vis.getTopLayerHost();Cb.setWidget(Ca);q(CZ,Cb.getGeoUnit(),Cb.getSizeByUnit(),Cb.getColorByUnit(),Cb.getTooltipUnits());}function Bt(CZ,Cb){var Ca=new CG.ImageLayoutHelper({node:Cb});Ca.setData(Cb.data.dz);q(CZ,Ca.geoAttribute,Ca.sizeByMetric,Ca.colorByMetric,Ca.tooltipMetrics);}function V(Ch,Ce,Cb){var Ci=Aq(L.DssTypeAttribute,Ch.xAxisObjects,Ch.yAxisObjects);if(Ch.breakByObjects.length||Ci.length){Ce.breakByObjects=Ci.concat(Ch.breakByObjects);}else{var Cf=Aq(L.DssTypeMetric,Ch.xAxisObjects),Cc=Aq(L.DssTypeMetric,Ch.yAxisObjects);if(Cc.length){Ce.breakByObjects.push(Ch.columnObjects.pop());}else{if(Cf.length){Ce.breakByObjects.push(Ch.rowObjects.pop());}}}var Cd,Ca,CZ=Ae(Ch,Cb);if(Au(Cb)){Cd="xAxisObjects";Ca="yAxisObjects";}else{Cd="yAxisObjects";Ca="xAxisObjects";}if(CZ===F||CZ===CN){var Cg=Math.floor(Ch[Cd].length/2);Ce[Ca]=Ch[Cd].splice(0,Cg);Ce[Cd]=Ch[Cd];Ce[Ca].forEach(function(Cj){Cj.ax=CN;});}else{Ch[Cd].forEach(function(Cj){if(Cj.ax===CN){Ce[Cd].push(Cj);}else{if(Cj.ax===F){Ce[Ca].push(Cj);Cj.ax=CN;}}});}A6(["colorByObjects","columnObjects","rowObjects","sizeByObjects","tooltipMetrics"],Ch,Ce);I(Ch,Ce);}function BF(Ca,Cb){var Cc=function(){if(Ca.sizeByObjects.length){return Ca.sizeByObjects[0];}else{if(Ca.angleObjects.length){return Ca.angleObjects.pop();}else{if(Ca.colorByObjects.length&&Ca.colorByObjects[0].t===L.DssTypeMetric){return Ca.colorByObjects[0];}else{if(Ca.tooltipMetrics.length){return Ca.tooltipMetrics.splice(0,1)[0];}}}}};A6(["breakByObjects"],Ca,Cb);B9(Ca.xAxisObjects,Cb.breakByObjects,L.DssTypeAttribute);B9(Ca.yAxisObjects,Cb.breakByObjects,L.DssTypeAttribute);B9(Ca.sliceObjects,Cb.breakByObjects);if(Cb.breakByObjects.length===0){if(Ca.columnObjects.length){Cb.breakByObjects.push(Ca.columnObjects.pop());}else{Cb.breakByObjects.push(Ca.rowObjects.pop());}}var Ce=Aq(L.DssTypeMetric,Ca.xAxisObjects),Cf=Aq(L.DssTypeMetric,Ca.yAxisObjects);if(Ce.length&&Cf.length){if(!Ca.sizeByObjects.length){Cb.sizeByObjects.push(Ca.angleObjects.pop());}B9(Ca.xAxisObjects,Cb.xAxisObjects,L.DssTypeMetric);B9(Ca.yAxisObjects,Cb.yAxisObjects,L.DssTypeMetric);}else{if((Ce.length>1&&Cf.length===0)){CJ(Cb,Ca.angleObjects);var Cd=Math.ceil(Ce.length/2);for(var CZ=0;CZ<Cd;CZ++){Cb.yAxisObjects.push(Ce[CZ]);}for(Cd;Cd<Ce.length;Cd++){Cb.xAxisObjects.push(Ce[Cd]);}}else{if(Cf.length>1&&Ce.length===0){CJ(Cb,Ca.angleObjects);var Cd=Math.ceil(Cf.length/2);for(var CZ=0;CZ<Cd;CZ++){Cb.yAxisObjects.push(Cf[CZ]);}for(Cd;Cd<Cf.length;Cd++){Cb.xAxisObjects.push(Cf[Cd]);}}else{if(Ce.length===1&&Cf.length===0){Cb.xAxisObjects.push(Ce.pop());Cb.yAxisObjects.push(Cc());}else{if(Cf.length===1&&Ce.length===0){Cb.yAxisObjects.push(Cf.pop());Cb.xAxisObjects.push(Cc());}else{if(Ce.length===0&&Cf.length===0){Cb.yAxisObjects.push(Cc());Cb.xAxisObjects.push(Cc());}}}}}}A6(["columnObjects","rowObjects","colorByObjects","sizeByObjects"],Ca,Cb);CJ(Cb,Ca.angleObjects);CJ(Cb,Ca.tooltipMetrics);I(Ca,Cb);}function O(Cj,Cg){Cg.breakByObjects=[];Cg.tooltipMetrics=[];var Ca=function(Ck){if(Cj.breakByObjects.length){return Cj.breakByObjects.pop();}else{if(Cj.sliceObjects.length){return Cj.sliceObjects.pop();}else{if(Cj.columnObjects.length&&(Ck==="xAxisObjects"||!Cj.rowObjects.length)){return Cj.columnObjects.pop();}else{return Cj.rowObjects.pop();}}}},Cc=function(Cl){if(Cj.sizeByObjects.length){return Cj.sizeByObjects[0];}else{if(Cj.angleObjects.length){var Ck=Cj.angleObjects;Cj.angleObjects=[];return Ck;}else{if(Cj.colorByObjects.length){return Cj.colorByObjects[0];}else{return Cj.tooltipMetrics.splice(0,1)[0];}}}};var Ci=Aq(L.DssTypeAttribute,Cj.xAxisObjects),CZ=Aq(L.DssTypeAttribute,Cj.yAxisObjects),Ch=Aq(L.DssTypeMetric,Cj.xAxisObjects),Ce=Aq(L.DssTypeMetric,Cj.yAxisObjects),Cd,Cb;if((Ci.length&&Ce.length)||(CZ.length&&Ch.length)){A6(["xAxisObjects","yAxisObjects"],Cj,Cg);}else{if(Ce.length===0&&Ch.length===0){var Cf="yAxisObjects";Cb=Cc();if(!Ci.length&&!CZ.length){Cd=Ca("xAxisObjects");if(Cd){Cg.xAxisObjects.push(Cd);}}else{if(Ci.length&&CZ.length){A6(["xAxisObjects"],Cj,Cg);B9(Cj.yAxisObjects,Cg.xAxisObjects);}else{if(Ci.length){A6(["xAxisObjects"],Cj,Cg);}else{if(CZ.length){A6(["yAxisObjects"],Cj,Cg);Cf="xAxisObjects";}}}}if(Cb&&Cb.length){B9(Cb,Cg[Cf]);}else{if(Cb){Cg[Cf].push(Cb);}}}else{if(Ci.length===0&&CZ.length===0){if(Ce.length&&Ch.length){B9(Cj.yAxisObjects,Cg.yAxisObjects);B9(Cj.xAxisObjects,Cg.yAxisObjects);Cd=Ca("xAxisObjects");if(Cd){Cg.xAxisObjects.push(Cd);}}else{if(Ce.length){B9(Cj.yAxisObjects,Cg.yAxisObjects);Cd=Ca("xAxisObjects");if(Cd){Cg.xAxisObjects.push(Cd);}}else{if(Ch.length){B9(Cj.xAxisObjects,Cg.xAxisObjects);Cd=Ca("yAxisObjects");if(Cd){Cg.yAxisObjects.push();}}}}}}}if(Cj.angleObjects.length){if(Cj.sizeByObjects.length){CJ(Cg,Cj.angleObjects);}else{Cg.sizeByObjects.push(Cj.angleObjects.pop());if(Cj.angleObjects.length){CJ(Cg,Cj.angleObjects);}}}A6(["colorByObjects","sizeByObjects","tooltipMetrics","columnObjects","rowObjects","breakByObjects"],Cj,Cg);B9(Cj.sliceObjects,Cg.breakByObjects);Cg.angleObjects=[];I(Cj,Cg);}function BO(CZ,Cc){var Cb=(Cc.length/2);var Ca=0;while(Cb>0){CZ.xAxisObjects.push(Cc[0]);Cc.splice(0,1);Cb-=1;Ca++;}while(Cc.length){CZ.yAxisObjects.push(Cc[0]);Cc.splice(0,1);Ca++;}}function Ag(CZ,Ca){if(!CZ){return ;}if(!Ca.sizeByObjects.length){Ca.sizeByObjects.push(CZ);}else{if(!Ca.colorByObjects.length){Ca.colorByObjects.push(CZ);}else{CJ(Ca,[CZ]);}}}function Ah(CZ,Cb){var Ca=Aq(L.DssTypeAttribute,CZ.xAxisObjects),Cd=Aq(L.DssTypeAttribute,CZ.yAxisObjects);if(Ca.length||Cd.length){var Cc;if(Ca.length){Cc={attrZone:"xAxisObjects",blankZone:"yAxisObjects",h1:"rowObjects",h2:"columnObjects"};}else{Cc={attrZone:"yAxisObjects",blankZone:"xAxisObjects",h1:"columnObjects",h2:"rowObjects"};}if(CZ.breakByObjects.length){B9(CZ[Cc.attrZone],Cb[Cc.attrZone]);Cb[Cc.blankZone].push(CZ.breakByObjects.pop());}else{if(CZ[Cc.attrZone].length>1){BO(Cb,CZ[Cc.attrZone]);}else{B9(CZ[Cc.attrZone],Cb[Cc.attrZone]);if(CZ[Cc.h1].length){Cb[Cc.blankZone].push(CZ[Cc.h1].pop());}else{Cb[Cc.blankZone].push(CZ[Cc.h2].pop());}}}}else{if(CZ.breakByObjects.length>1){BO(Cb,CZ.breakByObjects);CZ.breakByObjects=[];}else{if(CZ.breakByObjects.length){Cb.xAxisObjects.push(CZ.breakByObjects.pop());if(CZ.rowObjects.length){Cb.yAxisObjects.push(CZ.rowObjects.pop());}else{Cb.yAxisObjects.push(CZ.columnObjects.pop());}}else{if(CZ.columnObjects.length&&CZ.rowObjects.length){Cb.xAxisObjects.push(CZ.columnObjects.pop());Cb.yAxisObjects.push(CZ.rowObjects.pop());}else{if(CZ.columnObjects.length){Cb.xAxisObjects.push(CZ.columnObjects.pop());Cb.yAxisObjects.push(CZ.columnObjects.pop());}else{Cb.xAxisObjects.push(CZ.rowObjects.pop());Cb.yAxisObjects.push(CZ.rowObjects.pop());}}}}}A6(["breakByObjects","columnObjects","rowObjects"],CZ,Cb);}function CW(CZ,Ca,Cc){A6(["colorByObjects","sizeByObjects","tooltipMetrics"],CZ,Ca);var Ce,Cb,Cd;if(Au(Cc)){Ce="xAxisObjects";Cb="yAxisObjects";Cd={0:"columnObjects",1:"rowObjects"};}else{Ce="yAxisObjects";Cb="xAxisObjects";Cd={0:"rowObjects",1:"columnObjects"};}if(CZ[Ce].length){Ag(CZ[Ce].splice(0,1)[0],Ca);Ag(CZ[Ce].splice(0,1)[0],Ca);CJ(Ca,CZ[Ce]);}Ah(CZ,Ca);A6(["colorByObjects","sizeByObjects","tooltipMetrics"],CZ,Ca);}function AH(Ch,Ce){A6(["colorByObjects","sizeByObjects","tooltipMetrics"],Ch,Ce);if(Ch.angleObjects.length){Ag(Ch.angleObjects.splice(0,1)[0],Ce);Ag(Ch.angleObjects.splice(0,1)[0],Ce);B9(Ch.angleObjects,Ce.tooltipMetrics);}var Cf=Aq(L.DssTypeMetric,Ch.xAxisObjects),Cc=Aq(L.DssTypeMetric,Ch.yAxisObjects),Cg=Aq(L.DssTypeAttribute,Ch.xAxisObjects),Cb=Aq(L.DssTypeAttribute,Ch.yAxisObjects);if(Cf.length||Cc.length){var CZ=Cf.concat(Cc);Ag(CZ.splice(0,1)[0],Ce);Ag(CZ.splice(0,1)[0],Ce);B9(CZ,Ce.tooltipMetrics);Cf=[];Cc=[];if(Cg.length||Cb.length){var Cd=Cg.length?"yAxisObjects":"xAxisObjects",Ca=Cg.length?"xAxisObjects":"yAxisObjects";B9(Ch[Ca],Ce[Ca]);B9(Ch.breakByObjects,Ce[Cd]);B9(Ch.sliceObjects,Ce[Cd]);if(!Ce.xAxisObjects.length){Ch.columnObjects.length?Ce.xAxisObjects.push(Ch.columnObjects.pop()):Ce.xAxisObjects.push(Ch.rowObjects.pop());}if(!Ce.yAxisObjects.length){Ch.rowObjects.length?Ce.yAxisObjects.push(Ch.rowObjects.pop()):Ce.yAxisObjects.push(Ch.columnObjects.pop());}}else{if(Ch.sliceObjects.length&&Ch.breakByObjects.length){B9(Ch.breakByObjects,Ce.yAxisObjects);B9(Ch.sliceObjects,Ce.xAxisObjects);}else{if(Ch.sliceObjects.length||Ch.breakByObjects){var Ci=Ch.sliceObjects.length?Ch.sliceObjects:Ch.breakByObjects;BO(Ce,Ci);}else{if(Ch.columnObjects.length&&Ch.rowObjects.length){Ce.yAxisObjects.push(Ch.rowObjects.pop());Ce.xAxisObjects.push(Ch.columnObjects.pop());}else{if(Ch.columnObjects.length){Ce.yAxisObjects.push(Ch.columnObjects.pop());Ce.xAxisObjects.push(Ch.columnObjects.pop());}else{if(Ch.rowObjects.length){Ce.yAxisObjects.push(Ch.rowObjects.pop());Ce.xAxisObjects.push(Ch.rowObjects.pop());}}}}}}Ch.xAxisObjects=[];Ch.yAxisObjects=[];}else{if(Cg.length||Cb.length){if(Cb.length&&Cg.length){B9(Ch.yAxisObjects,Ce.yAxisObjects);B9(Ch.xAxisObjects,Ce.xAxisObjects);B9(Ch.sliceObjects,Ce.xAxisObjects);}else{if(Cb.length){B9(Ch.sliceObjects,Ce.xAxisObjects);B9(Ch.yAxisObjects,Ce.yAxisObjects);}else{B9(Ch.sliceObjects,Ce.yAxisObjects);B9(Ch.xAxisObjects,Ce.xAxisObjects);}}}else{BO(Ce,Ch.sliceObjects);}}A6(["columnObjects","rowObjects"],Ch,Ce);}function CY(CZ,Ca,Cb){A6(["colorByObjects","sizeByObjects","tooltipMetrics"],CZ,Ca);var Cd;if(Au(Cb)){Cd="xAxisObjects";}else{Cd="yAxisObjects";}var Cc=D(CZ,Cd);Cc=Cc[0].concat(Cc[1]);Ag(Cc.splice(0,1)[0],Ca);Ag(Cc.splice(0,1)[0],Ca);CJ(Ca,Cc);CZ[Cd]=[];Ah(CZ,Ca);}function H(Ca,Cb){if(Ca.sizeByObjects.length){Cb.sizeByObjects.push(Ca.sizeByObjects.splice(0,1)[0]);CJ(Cb,Ca.sizeByObjects);}A6(["colorByObjects","tooltipMetrics"],Ca,Cb);var CZ=Aq(L.DssTypeMetric,Ca.xAxisObjects).concat(Aq(L.DssTypeMetric,Ca.yAxisObjects));CZ.forEach(function(Cc){Ag(Cc,Cb);});Ah(Ca,Cb);}function Bc(Ca,Cd){var Cc,Cb,CZ;Cc=new CG.NetworkVisualizationHelper();Cc.setData(Cd.data.dz);Cb=Cc.fromItemAttribute;if(Cb){Ca.yAxisObjects.push(Cb);}Cb=Cc.toItemAttribute;if(Cb){Ca.xAxisObjects.push(Cb);}if(Cc.edgeColorMetric){Ca.colorByObjects.push(Cc.edgeColorMetric);}if(Cc.edgeSizeMetric){Ca.sizeByObjects.push(Cc.edgeSizeMetric);}if(!Ca.colorByObjects.length&&!Ca.sizeByObjects.length&&Cc.nodeSizeMetric){Ca.sizeByObjects.push(Cc.nodeSizeMetric);}else{if(Cc.nodeSizeMetric){B9([Cc.nodeSizeMetric],Ca.tooltipMetrics,L.DssTypeMetric);}}}function A2(Ce){var CZ=Ce.breakByObjects;if(CZ.length===0){var Cc,Cj=false,Ci=Ce.rowObjects,Ca=Ce.columnObjects,Cg=Ce.xAxisObjects,Cf=Ce.yAxisObjects;if((Ci.length>0&&Cf.length>0)||Cf.length>1){Cc=Aq(L.DssTypeAttribute,Cf,Ci);if(Cc.length>0){CZ.push(Cc.pop());Cj=true;}}if(!Cj&&((Ca.length>0&&Cg.length>0)||Cg.length>1)){Cc=Aq(L.DssTypeAttribute,Cg,Ca);if(Cc.length>0){CZ.push(Cc.pop());}}}var Ch=Ce.colorByObjects,Cb={};if(CZ.length>0){for(var Cd=0;Cd<CZ.length;Cd++){if(CZ[Cd]!==undefined){Cb[CZ[Cd].did]=Cd;}}}Ch.forEach(function(Cl){var Ck;if(Cl.t===4){Ck=Ch.indexOf(Cl);Ch.splice(Ck,1);}else{if(Cb[Cl.did]!==undefined){Ck=Ch.indexOf(Cl);Ch.splice(Ck,1);}}});}function Aj(Cd,Ca,Ce,Cc,Cb,CZ){CI.call(this,this.definition,CZ,Cb,Cd,Ce,Cc);Ak.call(this,Cd,Ca,CZ,Cb,Cc);Bl.call(this,this.definition,Cb,Ca);Bp.call(this,this.definition,CZ,Cb);By.call(this,this.definition,Cb,Ca);CX.call(this,Cb);}function Bu(Cq,Cj,C4,Cv){var Cd=new CG.GraphMatrixHelper({data:Cv.data,visType:Cj,visStyle:this.newVizInfo.s}),DL,Cw=[],DJ=[],Cn;if(this.isGraphMatrix(Cq)){DL=new CG.GraphMatrixHelper({data:Cv.data});DL.setData(Cv.data.dz);DL.setMetricsDropZone(Cv.data.dz);Cn=this.chartInfo=this.vis.getChartInfo();Cd.metricsDropZone=DL.metricsDropZone;Cd.secondaryMetricsDropZone=DL.secondaryMetricsDropZone;}var Co=Cn&&Cn.isGrid,DM=Cn&&Cn.isBubbleOrScatter,Cu=Cn&&Cn.isABL,Ca=Cn&&Cn.isCombo,C1=Cn&&Cn.isHistogram,Ce=Cn&&Cn.isBoxPlot,DD=Cn&&Cn.isWaterfall,DE=Cn&&(Cn.isPie||Cn.isRing),Cl=(Cq===Br.HEATMAP),DK=(Cq===Br.NETWORK),C3=(Cq===Br.GOOGLEMAP||Cq===Br.ESRIMAP),C7=(Cq===Br.IMAGELAYOUT),Ch=(Cq===Br.KPICARD),DB=(Cj===B8),DG=BV(Cj),Cx=AW(Cj),Ci=o(Cj),Cc=E(Cj),DF=(Cj===h||Cj===BL),C5=At(Cj),Cy=Cj===Br.GRAPHMATRIXGRIDCHART,CZ=(Cj===Br.GRAPHMATRIXVERTICALWATERFALL||Cj===Br.GRAPHMATRIXHORIZONTALWATERFALL),Cz=(Cj===BU||Cj===f),Cp=this.newVizInfo.s==="NewGraphMatrixVisualizationStyle",Ck=this.newVizInfo.s==="GraphMatrixVisualizationStyle",C6=Cv.data&&Cv.data.visName==="NewGraphMatrixVisualizationStyle",C0=Cv.data&&Cv.data.visName==="GraphMatrixVisualizationStyle";if(DB){if(Cl){Ao.call(this,Cd,Cv);}else{BK.call(this,DL,Cd,Cv);}}else{if(Cy){if(DE){AH.call(this,DL,Cd,Cv);}else{if(Ca){CY.call(this,DL,Cd,Cv);}else{if(Cu){CW.call(this,DL,Cd,Cv);}else{if(DM){H.call(this,DL,Cd,Cv);}else{if(Cl){CH.call(this,Cd,Cv);}else{if(DK){Bc.call(this,Cd,Cv);}else{if(C3){CB.call(this,Cq,Cd,Cv);}else{if(Co){Cd.clone(DL);var DC=this.vis,DI=DC.node.data,Cm=DI.visName;if(this.newVizInfo.s===Cm){Cd.handled=true;var Cg=this.vis;Cg.setWidgetPropertyValue("visType",Cd.visType);}}else{m.call(this,Cd,Cv);}}}}}}}}Cd.metricsDropZone="";Cd.secondaryMetricsDropZone="";}else{if(Cx||Cz||CZ){if((Cz||CZ)&&this.vis.GMController){var DC=this.vis,Cf=DC.GMController.getSortActions([]);DC.removeWidgetProperty("so");DC.removeWidgetProperty("si");C4.push({act:"sortGM",nodeKey:DC.k,subActions:Cf,partialUpdate:{nodes:[DC.k]}});}if(DE){O.call(this,DL,Cd,Cv);}else{if(Co){l.call(this,DL,Cd,Cv);}else{if(Ca){Bd.call(this,DL,Cd,Cv);}else{if(DM){AX.call(this,DL,Cd,Cv);}else{if(DD||Ce){Cd.clone(DL);var Cg=this.vis;Cg.setWidgetPropertyValue("visType",Cd.visType);}else{if(Cu){if(C1&&CZ){B7(DL,Cd,Cv);}else{Cd.clone(DL);var DC=this.vis,DI=DC.node.data,Cm=DI.visName;if(this.newVizInfo.s===Cm&&Cx){Cd.handled=true;var Cg=this.vis;Cg.setWidgetPropertyValue(Bm.WidgetPropertyTag.METRIC_SHAPES,{});Cg.writeGlobalProperty("visType",Cd.visType);Cg.writeGlobalProperty("Shape",P[this.definition.Properties[z.PROP_SHAPE].toUpperCase()]);}}}else{if(Cl){if(Cz||CZ){AU.call(this,Cd,Cv,Cz);}else{Av.call(this,Cd,Cv);}}else{if(DK){BJ.call(this,Cd,Cv);}else{if(C3){W.call(this,Cq,Cd,Cv);}else{if(C7){Bt.call(this,Cd,Cv);}else{AF.call(this,Cd,Cv);}}}}}}}}}}if(C5&&Cd.sizeByObjects.length){var Cb=this.vis.zonesModel.gmZones.hGetItemOccurrence(Cd.sizeByObjects[0],[AV,M,AD]);if(Cb.length===0){B9(Cd.sizeByObjects,Cd.tooltipMetrics,L.DssTypeMetric);}Cd.sizeByObjects=[];}if(Cz||CZ){if(Cz&&!Cl){A2(Cd);if(Cd.secondaryMetricsDropZone==="ColorBy"&&Cd.metricsDropZone==="BreakBy"){Cd.secondaryMetricsDropZone="";}}if(Cd.sizeByObjects.length){if(Cd.xAxisObjects[0]&&Cd.xAxisObjects[0].t===L.DssTypeMetric){B9(Cd.sizeByObjects,Cd.xAxisObjects);Cd.metricsDropZone="Columns";}else{B9(Cd.sizeByObjects,Cd.yAxisObjects);if(Cd.yAxisObjects.length>1){Cd.metricsDropZone="Rows";}}}if(Cd.metricsDropZone==="YAxis"||Cd.metricsDropZone==="XAxis"){Cd.metricsDropZone="BreakBy";}var DC=this.vis,DI=DC.node.data,Cm=DI.visName;if(this.newVizInfo.s===Cm){DC.setWidgetPropertyValue("visType",Cd.visType);}Cd.angleObjects=[];Cd.sliceObjects=[];Cd.sizeByObjects=[];}else{if(Ci&&Cd&&Cd.visStyle===B2){var DH=Cd.sizeByObjects;Cd.sizeByObjects=[];CJ(Cd,DH);}}}else{if(Cc){if(Ce||C1||DD){DL.tooltipMetrics=[];}if(DE){BN.call(this,DL,Cd);}else{if(Co){CL.call(this,DL,Cd);}else{if(Ca){Cd.clone(DL);}else{if(Cu){CK.call(this,DL,Cd);}else{if(DM){B3.call(this,DL,Cd);}else{Bx.call(this,Cq,DL,Cd,Cv);}}}}}}else{if(DG){if(DE){BF.call(this,DL,Cd,Cv);}else{if(Co){Bk(DL,Cd,Cv);}else{if(Ca){V.call(this,DL,Cd,Cv);}else{if(Cq===Br.GRID){Ba.call(this,Cd,Cv);}else{if(Cu){AQ.call(this,DL,Cd,Cv);}else{if(Cl){u.call(this,Cd,Cv);}else{if(DK){Ad.call(this,Cd,Cv);}else{if(DM){Cd.clone(DL);}else{if(C3){Z.call(this,Cq,Cd,Cv);}else{if(C7){AT.call(this,Cd,Cv);}else{if(Ch){Ba.call(this,Cd,Cv);}else{Aj.call(this,Cq,Cj,C4,Cv,Cd,DL);}}}}}}}}}}}}else{if(DF){if(DE){Cd.clone(DL);}else{if(Co){AM(DL,Cd,Cv);}else{if(DM){A5.call(this,Cq,DL,Cd);}else{if(Ca){B.call(this,DL,Cd,Cv);}else{if(Cu){AI.call(this,Cq,DL,Cd,Cv);}else{if(DK){Bs.call(this,Cd,Cv);}else{if(C3){AG.call(this,Cq,Cd,Cv);}else{if(Cl){BH.call(this,Cd,Cv);}else{if(C7){CM.call(this,Cd,Cv);}else{BX.call(this,Cd,Cv);}}}}}}}}}}else{Aj.call(this,Cq,Cj,C4,Cv,Cd,DL);}}}}}}if(Cp){CF(Cd,"xAxisObjects");CF(Cd,"yAxisObjects");}CO.call(this,Cd,Cp);CU.call(this,this.definition,Cd);k.call(this,Cv,Cd,DJ);if(DF){AA.call(this,Cd,C4,Cv);}Aw.call(this,Cv,DJ);var C8=Cd.getAddDropZonesAction();C8.actions=Cw.concat(C8.actions).concat(DJ);if(C8.actions.length){C4.push(C8);}if(C0||C6){var DC=this.vis,DA,Ct=DC.property,C2=C6?parseInt(Ct.hGetPropValue(BS.CONTAINER_FIT_MODE)):Ct.hGetPropValue(AY.FIT_TO),Cs={},C9=[Bz.FIT_TO_CONTENT,Bz.AUTOMATIC,Bz.FIT_TO_CONTAINER],Cr=["Content","Window","Compact"];C9.forEach(function(DO,DN){Cs[DO]=Cr[DN];});Cr.forEach(function(DO,DN){Cs[DO]=C9[DN];});if((!C2||C2==="Content"||C2===Bz.FIT_TO_CONTENT)&&DB){C2=undefined;}DA=Cs[C2];if(C6&&Ck){Ct.hSetPropValue(AY.FIT_TO,DA);}else{if(C0&&Cp){DC.setWidgetPropertyValue(BS.CONTAINER_FIT_MODE,DA);}else{if(DB&&!C2){DC.setWidgetPropertyValue(BS.CONTAINER_FIT_MODE,C2);}}}}return Cd;}function J(Cb,CZ,Cd,Ca){this.templateInfo=B4.call(this,Ca);this.definition=A4.call(this,CZ);var Cc=Bu.call(this,Cb,CZ,Cd,Ca);return{wp:Cc.getXml(),handled:Cc.handled};}mstrmojo.vi.viz.GMVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.GMVisualizationTransition",templateInfo:null,definition:null,markedObjects:null,chartInfo:null,init:function CQ(CZ){this._super(CZ);this.markedObjects=[];},transitionDropZones:function Bn(Ce,Cd){var Cf,Cc=this.vis,Cb=Cc.node.data,CZ=Cb.visName||Af,Ca=function(Ch,Cj){var Ci=(typeof Cj==="object"),Cg=Ci?Cj.v:Cj;if(Au(Ch.node)&&Ci){Cg=Cj.h;}return Cg;};Cd=Ca.call(this,Cc,Cd);switch(B0.getDefinition(CZ).id){case B0.GRAPHMATRIX:case B0.NEWGRAPHMATRIX:Cf=J.call(this,Br.UNKNOWN_GRAPHMATRIX_TYPE,Cd,Ce,Cc.node);break;case B0.ESRIMAP:Cf=J.call(this,Br.ESRIMAP,Cd,Ce,Cc.node);break;case B0.GOOGLEMAP:case B0.MAPBOX:Cf=J.call(this,Br.GOOGLEMAP,Cd,Ce,Cc.node);break;case B0.HEATMAP:Cf=J.call(this,Br.HEATMAP,Cd,Ce,Cc.node);break;case B0.IMAGELAYOUT:Cf=J.call(this,Br.IMAGELAYOUT,Cd,Ce,Cc.node);break;case B0.NETWORK:Cf=J.call(this,Br.NETWORK,Cd,Ce,Cc.node);break;case B0.KPICARD:Cf=J.call(this,Br.KPICARD,Cd,Ce,Cc.node);break;default:Cf=J.call(this,Br.GRID,Cd,Ce,Cc.node);break;}return Cf;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapEnums","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.viz.EnumVizStyles");mstrmojo.requiresClsP("mstrmojo.vi.viz","MapHelper","EnumDSSDropZones","VisualizationTransition","GraphMatrixHelper","HeatMapVisualizationHelper","ImageLayoutHelper","NetworkVisualizationHelper");var Z=mstrmojo,N=Z.array,F=mstrmojo.gmaps,E=F.EnumGraphicType,I=F.EnumPropertyType,Y=Z.vi.viz,X=Y.EnumDSSDropZones,P=Y.MapHelper,O="Grid",C=mstrmojo.mstr.EnumDSSXMLObjectTypes,B=mstrmojo.vi.viz.EnumVizStyles,M="-1";function V(b){return new Y.MapHelper(b);}function D(e,d,b,f,c,g){if(e){g.push({act:"addDropZoneUnit",zoneId:b,unitId:e,unitType:d});}switch(b){case X.GeoAttribute:c.geoAttribute=e;break;case X.Latitude:c.latitude=e;break;case X.Longitude:c.longitude=e;break;case X.ColorBy:c.colorBy=e;break;case X.SizeBy:c.sizeBy=e;break;case X.AdditionalMetrics:c.tooltip.push(e);break;case X.Angle:c.angle=e;break;case X.SliceBy:c.slice.push(e);break;}}function K(e,d,b,f,c,g){D(e,d,b,f,c,g);if(c.isMapbox&&P.shouldSyncItemToTooltipZone(e,b,c&&c.tooltip)){D(e,d,X.AdditionalMetrics,f,c,g);}}function R(b,c){return{act:"updateTemplate",actions:b,keyContext:c};}function S(b,c){return b.geoAttribute===c||b.latitude===c||b.longitude===c||b.colorBy===c||b.sizeBy===c||b.slice===c||b.angle===c;}function G(b,d){var c=false;N.forEach(b.slice,function(e){if(e===d){c=true;return false;}});return c;}function L(e,d,c){var f;switch(e){case B.GRAPH_MATRIX:f=new Y.GraphMatrixHelper({data:d});f.setData(d.dz);N.forEach(f.colorByObjects,function(h){if(f.isMetric(h)){f.colorByItem=h;return false;}});f.sizeByItem=f.sizeByObjects&&f.sizeByObjects[0];f.angleItem=f.angleObjects&&f.angleObjects[0];f.sliceItem=f.sliceObjects;break;case B.HEAT_MAP:f=new Y.HeatMapVisualizationHelper({data:d});f.setData(d.dz);f.colorByItem=f.getFirstColorByUnit(true);f.sizeByItem=f.sizeByMetric;break;case B.IMAGE_LAYOUT:f=new Y.ImageLayoutHelper();f.setData(d.dz);f.colorByItem=f.colorByMetric;f.sizeByItem=f.sizeByMetric;break;case B.NETWORK:f=new Y.NetworkVisualizationHelper();f.setData(d.dz);f.colorByItem=f.edgeColorMetric;f.sizeByItem=f.nodeSizeMetric;break;case B.GOOGLE_MAP:case B.ESRI_MAP:case B.MAPBOX:var g=e===B.MAPBOX,b;f=V({isMapbox:g,data:d});f.setWidget(c.getTopLayerHost());b=f.getColorByUnit();f.colorByItem=(b&&b.t)===C.Metric?b:undefined;f.sizeByItem=f.getSizeByUnit();break;default:f=null;break;}return f;}function Q(p,h,o,f,b){var g=function(q){o.setMapType(E.Bubble);K(q,C.Metric,X.SizeBy,h,o,f);},l=function(q){K(q,C.Metric,X.ColorBy,h,o,f);},c=function(q){K(q,C.Attribute,X.SliceBy,h,o,f);},k=function(q){K(q,C.Metric,X.Angle,h,o,f);},n=L(p,h,b),e,j,d,m;if(n){e=n.colorByItem&&n.colorByItem.did;j=n.sizeByItem&&n.sizeByItem.did;d=n.sliceItem;m=n.angleItem&&n.angleItem.did;if(j&&(o.vp.gtp===undefined||o.showSizeByZone(o.vp))){g(j);}else{if(o.vp.gtp===undefined){o.setMapType(E.Marker);}}if(o.showColorByZone(o.vp)&&e){l(e);}if(!o.isMapbox){if(o.showSliceZone(o.vp)&&d){N.forEach(d,function(q){c(q.did);});}if(o.showAngleZone(o.vp)&&m){k(m);}}}}function a(f,c,d,b,e){if(f&&f.length){if(b.showColorByZone(b.vp)&&!b.colorBy){N.forEach(f,function(h){if(!S(b,h)){K(h.did,C.Metric,X.ColorBy,d,b,e);return false;}});}if(b.showSizeByZone(b.vp)&&!b.sizeBy){N.forEach(f,function(h){if(!S(b,h)){K(h.did,C.Metric,X.SizeBy,d,b,e);return false;}});}if(b.showAngleZone(b.vp)&&!b.angle){N.forEach(f,function(h){if(!S(b,h)){K(h.did,C.Metric,X.Angle,d,b,e);return false;}});}if(b.showSliceZone(b.vp)&&!b.slice){var g=0;N.forEach(c,function(h){if(g===2){return false;}if(!G(b,h)){K(h.did,C.Attribute,X.Angle,d,b,e);g++;}});}}}function U(v,o,e,l){var b=v.gts,s=v.gsi,j=b&&b.row,g=b&&b.col,f=(j||[]).concat(g||[]),x=null,h=null,w=null,d=0,c=false,p=(s&&s.rows||[]).concat(s&&s.cols||[]),k=[],q=function(z){N.forEach(f,function(AB){var AA;N.forEach(AB.fs,function(AC){return AA=z(AB,AC);});return AA;});},r=function(z){return P.isLatitude(z.n,z.fgr);},m=function(z){return P.isLongitude(z.n,z.fgr);},u=function(AA,z){k.push({act:"addForm",unitId:AA,attFormId:z,unitPos:1});},t=function(AC,AA,z){var AB=[];N.forEach(AA,function(AD){AB.push(AD.id);});N.forEach(z,function(AD){if(AB.indexOf(AD.fid)===-1){u(AC,AD.fid);}});},n=function(z){if(z){var AA={};N.forEach(Object.keys(l),function(AB){N.forEach(l[AB].att,function(AC){AA[AC.did]=AC;});});N.forEach(f,function(AB){if(AB.id){t(AB.id,AB.fs,AA[AB.id].fs);AB.fs=AA[AB.id].fs;}});}q(function(AC,AB){if(P.isGeoRoleSupportArea(AB.fgr)){x=AC;return false;}});if(x){K(x.id,C.Attribute,X.GeoAttribute,v,e,o);N.forEach(k,function(AB){o.push(AB);});if(z){e.setUseAttributeForm(true);}e.setMapType(E.Area);return ;}if(!x){N.forEach(f,function(AB){var AC=AB.id;q(function(AE,AD){if(AE.id===AC&&r(AD)){h=AD.id||AD.fid;d=AE.card;}if(AE.id===AC&&m(AD)&&AD.id!==h){w=AD.id||AD.fid;d=AE.card;}});if(h&&w){x={id:AB.id};return false;}h=null;w=null;});if(x){K(x.id,C.Attribute,X.GeoAttribute,v,e,o);K(h,C.AttributeForm,X.Latitude,v,e,o);K(w,C.AttributeForm,X.Longitude,v,e,o);N.forEach(k,function(AB){o.push(AB);});e.setUseAttributeForm(true);return ;}}if(!x&&!z){q(function(AC,AB){if(r(AB)||P.isLatitude(AC.n)){h=AC.id;d=AC.card;}if((m(AB)||P.isLongitude(AC.n))&&(h!==AC.id)){w=AC.id;d=AC.card;}});if(h&&w){K(h,C.Attribute,X.Latitude,v,e,o);K(w,C.Attribute,X.Longitude,v,e,o);e.setUseAttributeForm(false);return ;}}};if(v.egt!==undefined&&v.eg!==undefined&&v.eg!==""&&f.length===0&&p.length>0){N.forEach(p,function(z){Object.keys(l).every(function(AA){(l[AA].att||[]).every(function(AB){if(AB.did===z.did){c=true;f.push(AB);}return !c;});return !c;});});}n(false);if(!(x||(h&&w))){n(true);}if(o.length===0){e.setMapType(this.getDefaultGraphicType());}}function A(d,h,g,b){var f=d.gsi,c=f.rows||[],e=f.cols||[];N.forEach(c.concat(e),function(j){if(j.did!==M&&!S(b,j.did)&&!G(b,j.did)){K(j.did,j.t||C.Metric,X.AdditionalMetrics,d,b,g);}});N.forEach(h,function(j){if(j.did!==M&&!S(b,j.did)){K(j.did,j.t||C.Metric,X.AdditionalMetrics,d,b,g);}});}mstrmojo.vi.viz.MapVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.MapVisualizationTransition",shouldSkipTransition:function J(b){return b===B.ESRI_MAP||b===B.GOOGLE_MAP;},transitionDropZones:function W(d){var c=this.vis,e=c.node,h=e.data,p=h.visName||O,n=this.scriptClass==="mstrmojo.vi.viz.MapboxVisualizationTransition",o=V({isMapbox:n}),k=h.gsi,m=k.mx,b=h&&h.gts,l=(b&&b.row||[]).concat(b&&b.col||[]),f=this.vis.model.docModel.datasets,j={act:"updateTemplate",keyContext:h.k,actions:[]},g=j.actions;if(this.shouldSkipTransition(p)){return{wp:"",handled:false};}U.call(this,h,g,o,f);Q(p,h,o,g,c);if(h.visName===B.GRAPH_MATRIX||h.visName===B.NEW_GRAPH_MATRIX){m=this.filterGMTrainingMetric(h.dz,m);}a(m,l,h,o,g);A(h,m,g,o);if(g.length){d.push(j);}if(o.colorBy){d.push(R(this.addThresholds({data:h},{did:o.colorBy,t:C.Metric},[]),h.k));}return{wp:o.getXml(),wgtName:o.vp[I.layerName],handled:false,gtp:o.getMapType(),ln:o.getLayerName()};},getDefaultGraphicType:function H(){return E.Marker;}});}());(function(){mstrmojo.requiresCls("mstrmojo.GridBase","mstrmojo.Grid","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.XtabZone=mstrmojo.declare(mstrmojo.Grid,null,{scriptClass:"mstrmojo.XtabZone",markupString:'<div id="{@id}" class="mstrmojo-XtabZone" style="position:relative;{@cssText}"></div>',markupSlots:{gridContainerNode:function(){return this.domNode;}}});}());(function(){var G=1,B=2;mstrmojo.XtabCP=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.XtabCP",base:null,lookupBase:null,colWidths:null,forceAutoRowHeight:false,startIndexInContainer:0,updatedRows:null,preServeUpdatedRows:true,init:function M(N){mstrmojo.hash.copy(N,this);},initContent:function E(Q){this.startIndexInContainer=Q||this.startIndexInContainer||0;var P=this.base||[],O=P.show,N=P.items;this.rc=O&&N?N.length:0;this.colWidths=(O&&P.cws)||[];this.isDownloading=false;this.isDownloaded=true;this.invalidData=false;},isDataAvailable:function C(O,N){return !this.invalidData;},download:function A(P,O,N){if(!this.isDownloaded&&!this.isDownloading&&this.dataSource){this.isDownloading=true;this.dataSource.download(0,N);}},invalid:function F(){this.invalidData=true;this.isDownloading=false;this.isDownloaded=false;this.preServeUpdatedRows=true;if(this.gridData){this.oldGridData=this.gridData;this.oldBase=this.base;this.updatedRows={};}},getRowHeight:function D(){return this.gridData.rh;},getNumAutoHeightRows:function(){return this.forceAutoRowHeight?this.rc:0;},getAvailableRowsCount:function L(){return this.rc;},getUpdatedRows:function J(){return this.updatedRows;},getRowCells:function(k,O){var a=this.base||[],W=a.items||[],l=W[k]||[],Y=l.items,n=this.lookupBase,d=this.interactiveCellsArray,m=this.gridData.css,s=this.gridData.gsi,f=s&&s.prop&&s.prop.cols&&s.prop.cols.mg,p=null,Z,h,V,o,u,U,j,S,X,R,g="-1";if(this.oldGridData){Z=this.oldBase;h=Z&&Z.items;V=h[k]&&h[k].items;}for(u=0,o=(Y&&Y.length)||0;u<o;u++){U=Y[u];if(U){U.v=U.v||U.n;if(n&&!U._e){j=n[U.tui];S=U.fi;X=(j&&j.fs)||[];R=X[S]||X[0];U.ts=U.ts||R&&R.bftp;p=j&&j.es[U.idx];if(p){U.v=U.v||p.n;if(p.rv){U.rv=p.rv;}U._e=p;}}if(!U.css){var x=U.cni;if(x!==undefined){U.css=m[x].n;}else{U.css="";}}if(!U._d&&V&&this.preServeUpdatedRows){var Q=V[u];if(!Q||(Q.rs!==U.rs)){this.preServeUpdatedRows=false;this.updatedRows={};}else{if((Q.v&&U.v!==Q.v)){var w={};if(U.v!==Q.v){w.v=Q.v;}if(U.css!==Q.css){w.css=Q.css;}U._d=w;this.updatedRows[this.startIndexInContainer+k]=true;}}}U._gd=this.gridData._bidx||0;if(d){if(!O&&(U._ei===undefined||d[U._ei]!==U)){U._ei=d.push(U)-1;}}if(this.axis){U.axis=this.axis;}var q=U.pi,c=function c(AA,r,e){var z=AA&&AA[r];return z&&z.es[e];},b=function b(AB,z,AC,r,AA){var e=AB.items[z].items[AC];if(e){e.axis=e.axis||r;if(e._e===undefined){e._e=c(AB.show?n:AA,e.tui,e.idx);}}return e;};if(q){if(q.ri!==undefined&&q.ci!==undefined){if(U.axis===2&&f!==g){U._p=W[q.ri].items[u];}else{U._p=W[q.ri].items[q.ci];}}else{var v=this.gridData.ghs,N=this.gridData.gts,t=q.left,P=q.top;if(t){U._lp=b(v.rhs,t.ri,t.ci,G,N.row);}if(P){U._tp=b(v.chs,P.ri,P.ci,B,N.col);}}}}}return Y;},getUnmergedCells:function H(S){var V=[],W=(this.base&&this.base.items)||[];if(S>W.length-1||S<0){return V;}var P=this.gridData.css,U=W[S].items[0],O=U&&U.pi,N=O&&O.ri,R=O&&O.ci;while(O&&N>-1&&R>-1){U=U._p||W[N].items[R];var Q={};mstrmojo.hash.copy(U,Q);if(!Q.css){Q.css=P[Q.cni].n;}Q.rs=U.rs-S+N;V.splice(0,0,Q);O=U&&U.pi;N=O&&O.ri;R=O&&O.ci;}return V;},getIndentPadding:function K(N){return N*14;},getCell:function I(N,O){var P=this.base.items;return P[N].items[O];}});}());(function(){mstrmojo.XtabVACP=mstrmojo.declare(mstrmojo.XtabCP,null,{scriptClass:"mstrmojo.XtabVACP",cps:[],initContent:function G(L){this.startIndexInContainer=L||0;this.rc=0;this.type=0;this.colWidths=[];var J;for(J=0;J<this.cps.length;++J){var K=this.cps[J];K.initContent(this.startIndexInContainer+this.rc);this.rc+=K.rc;this.type|=K.type;var I=K.colWidths;if(I&&(I.length>this.colWidths.length)){this.colWidths=I;}}},getNumAutoHeightRows:function(){return this.cps[0].getNumAutoHeightRows();},getRowHeight:function C(){return this.cps[0].getRowHeight();},getRowCells:function(J,I){var K=0,L=this.cps[K],M;while(J>=L.rc){J-=L.rc;L=this.cps[++K];}if(this.renderingNewPage){L.updateCounter=0;this.renderingNewPage=false;}M=L.getRowCells(J,I);this.updateCounter=L.updateCounter;return M;},getUnmergedCells:function(I){var J=0,K=this.cps[J];while(I>=K.rc){I-=K.rc;K=this.cps[++J];}return K.getUnmergedCells(I);},getCell:function(I,K){var J=0,L=this.cps[J];while(I>=L.rc){I-=L.rc;L=this.cps[++J];}return L.getCell(I,K);},isDataAvailable:function D(L,K){var J=this._getCPs(L,K),I;for(I=0;I<J.length;++I){if(!J[I].isDataAvailable(L,K)){return false;}}return true;},getAvailableRowsCount:function F(){var K=0,I;for(I=0;I<this.cps.length;++I){var J=this.cps[I];if(J.isDataAvailable()){K+=J.getAvailableRowsCount();}}return K;},_getCPs:function H(N,L){var J=0,M=this.cps[J],I=M&&M.startIndexInContainer,K=[];if(M){N-=I;L-=I;}while(M&&N>=M.rc){N-=M.rc;L-=M.rc;M=this.cps[++J];}while(M&&L>=M.rc){L-=M.rc;K.push(M);M=this.cps[++J];}if(M){K.push(M);}return K;},invalid:function E(){var I;for(I=0;I<this.cps.length;++I){var J=this.cps[I];J.invalid();}this.updatedRows={};},getUpdatedRows:function A(){var I={},J;for(J=0;J<this.cps.length;++J){var K=this.cps[J];if(!K.preServeUpdatedRows){return{};}mstrmojo.hash.copy(K.getUpdatedRows(),I);}this.updatedRows=I;return I;},download:function B(N,M,I){var L=this._getCPs(N,M),J;for(J=0;J<L.length;++J){var K=L[J];K.download(N,M,I);}}});}());(function(){mstrmojo.XtabHACP=mstrmojo.declare(mstrmojo.XtabCP,null,{scriptClass:"mstrmojo.XtabHACP",cps:[],initContent:function G(J){this.startIndexInContainer=J||0;this.type=0;this.colWidths=[];var I;for(I=0;I<this.cps.length;++I){this.cps[I].initContent(this.startIndexInContainer);this.type|=this.cps[I].type;var H=this.cps[I].colWidths;if(H){this.colWidths=this.colWidths.concat(H);}}this.rc=Math.max(this.cps[0].rc,this.cps[1].rc);},getNumAutoHeightRows:function(){return Math.max(this.cps[0].getNumAutoHeightRows(),this.cps[1].getNumAutoHeightRows());},getRowHeight:function C(){return this.cps[0].getRowHeight();},getRowCells:function(J,I){var N=this.cps,K=[],H=N.length,M;for(M=0;M<H;M++){if(N[M].getAvailableRowsCount()>0&&N[M].rc>J){var L=N[M].getRowCells(J,I);if(L){K=K.concat(L);}}}return K;},getUnmergedCells:function(H){return this.cps[0].getUnmergedCells(H);},isDataAvailable:function D(I,H){return this.cps[1].isDataAvailable(I,H);},getAvailableRowsCount:function F(){return Math.max(this.cps[0].getAvailableRowsCount(),this.cps[1].getAvailableRowsCount());},invalid:function E(){var I,H,J;for(I=0,H=this.cps.length;I<H;++I){J=this.cps[I];J.invalid();}this.updatedRows={};},getUpdatedRows:function A(){var H={},I;for(I=0;I<this.cps.length;++I){var J=this.cps[I];if(!J.preServeUpdatedRows){return{};}mstrmojo.hash.copy(J.getUpdatedRows(),H);}this.updatedRows=H;return H;},download:function B(K,I,H){var J=this.cps[1];J.download(K,I,H);}});}());(function(){var C=4;mstrmojo.XtabLevelHACP=mstrmojo.declare(mstrmojo.XtabHACP,null,{scriptClass:"mstrmojo.XtabLevelHACP",allCells:[],updateCounter:0,pageNum:0,getEmptyCell:function B(D,E,G){var F={css:D.css.replace(" hl",""),v:"",fillerCell:true};if(E){F.cs=this.headerCells[G].cs||1;}return F;},getCellDepth:function A(D){var E=D.dpt||1;if(!D.dpt){D=D._p;while(D){if(D.dpt){E+=D.dpt;break;}E++;D=D._p;}}return E;},getUnmergedCells:function(D){return ;},getRowCells:function(S){var N=this.cps,I=[],b=N.length,K=false,d=this.gridData,O=(d&&d.lvlepd)||-1,Q=this.outlineState,H=this.allCells,a,Z,Y,F,E,e,X=0,J=-10;e=this.updateCounter;S-=e;if(H.length>0){return H.splice(0,1)[0];}var V=function(l){var k=l.gridData||(l.cps[0]&&l.cps[0].gridData),m=(k&&k.gts.row),g=(m&&m.length)||0,f,h,j;this.headerCells=f=mstrmojo.hash.clone(m);for(j=0;j<f.length;j++){if(f[j].cs>1&&f[j].otp===mstrmojo.mstr.EnumDSSXMLObjectTypes.Filter){for(Z=1;Z<f[j].cs;Z++){h=this.getEmptyCell(f[j],false);f.splice(j+1,0,h);}f[j].cs=1;}}for(j=g-1;j>0;j--){if(f[j].id===f[j-1].id){f.splice(j,1);}}g=f.length;this.maxLevel=k.maxLevel=g;this.gridData=k;for(j=0;j<g;j++){if(f[j].cs>1){return true;}}return false;};var G=function(k){var f,j,g,h;for(h=k.length-1;h>0;h--){j=k[h-1];f=k[h];if(f.dpt&&f.dpt===j.dpt){if(f.v&&f.v!==""){if(f.ts===C){if(f.v.indexOf("#srcstart")===0){g=f.v;}else{g="#srcstart"+f.v+"#srcend";}if(j.ts!==C){g=j.v+" "+g;}else{g="#srcstart"+j.v+"#srcend "+g;}j.v=g;}else{if(j.ts===C){j.v="#srcstart"+j.v+"#srcend "+f.v;}else{j.v+=" "+f.v;}}f.v="";}k.splice(h,1);}}return k;};var c=function(h){var g=this.headerCells,k=g.length,f=g[h].cs?(g[h].cs-1):0;var j=0;for(j=h+1;j<g.length;j++){f+=g[j].cs?(g[j].cs-1):0;}return f;};var D=function(j){var h=j.gridData||(j.cps[0]&&j.cps[0].gridData),f=h.gts,g=false;if(f.col.length===0){g=true;}else{g=f.rec;}return g?0:1;};for(a=0;a<b;a++){if(N[a].getAvailableRowsCount()>0&&N[a].rc>S){var L=mstrmojo.hash.clone(N[a].getRowCells(S).slice(0));if(N[a].type===4){if(S===0){this.hasMultiFormAttributes=V.call(this,N[a]);this.metricAdjuster=D(N[a]);if(O===-1){O=this.gridData&&this.gridData.lvlepd;}}if(this.hasMultiFormAttributes){L=G(L);}var P=L.length;for(Y=P-1;Y>=0;Y--){F=L[Y];var W=this.getCellDepth(F);if(Y===0){for(Z=1;Z<W;Z++){L.splice(Z-1,0,this.getEmptyCell(F,this.hasMultiFormAttributes,Z-1));}}else{if(F.stt&&F.idx<0){L.splice(Y,1);}else{if(F.stt===1&&(!F._e||F._e.n)){L.splice(Y,1);E=L[Y-1];if(F._e&&F.hst&&F.hst!==J&&E&&E.v===E._e.n){E.v+=" ("+F._e.n+")";}continue;}else{var R=[];L.splice(Y,1);for(Z=1;Z<W;Z++){R.push(this.getEmptyCell(F,this.hasMultiFormAttributes,Z-1));}R.push(F);H.splice(0,0,R);K=true;e++;this.rc++;}}}F.rs=1;F.outLvl=W;if(Q&&Q.collapseToLevel){if(W<=Q.collapseToLevel){if(W<Q.collapseToLevel||!Q.isExpanding){delete Q.collapseToLevel;H.forEach(function(f){f.forEach(function(g){if(!g.fillerCell&&g._ei){delete Q[g._ei];g.epd=false;g.hidden=false;}});});}else{if(Q.isExpanding){Q.hasTBodyElementsToExpand=true;}Q[F._ei]={expanded:false,hidden:true};}}else{Q[F._ei]={expanded:false,hidden:true};}}if(Q&&Q[F._ei]!==undefined){F.epd=!(Q[F._ei].expanded);F.hidden=Q[F._ei].hidden;}else{F.epd=O>0&&O<=W;F.hidden=false;}if(this.hasMultiFormAttributes){X=c.call(this,W-1);}if((X||this.metricAdjuster)&&W===this.maxLevel){F.isLeaf=true;}F.cs=P>1?(P-Y+X+this.metricAdjuster):(P+X+this.metricAdjuster);}this.updateCounter=e;}else{if(K){var U=H.length-1,M=H[U];H[U]=M.concat(L);for(Z=0;Z<U;Z++){M=H[Z];for(Y=0;Y<L.length;Y++){M.push(this.getEmptyCell(L[Y]));}}for(Y=0;Y<L.length;Y++){I.push(this.getEmptyCell(L[Y]));}continue;}}if(L){I=I.concat(L);}}}return I;}});}());(function(){function F(N){var M=0;for(M=0;M<N.length;M++){if(N[M].otp===-1){return true;}}return false;}function G(M){var N=[],Q,P,O;for(O=M.length-1;O>0;O--){Q=M[O];P=M[O-1];if(Q.id===P.id){M.splice(O,1);if(P.v===P.n){P.v+=" | "+Q.v;P.cs=(P.cs||1)+(Q.cs||1);}}}return M;}function C(M){return M.gts.col.length>0&&M.gts.rec===false;}mstrmojo.XtabTitlesCP=mstrmojo.declare(mstrmojo.XtabCP,null,{scriptClass:"mstrmojo.XtabTitlesCP",init:function L(M){this._super(M);},download:function A(O,N,M){},shouldClonedLastTitleCell:function K(){return(this.gridData.lhv!==0);},initContent:function H(V){this.startIndexInContainer=0;if(!this.cts){this.cts=mstrmojo.hash.clone(this.gridData.gts.col);}var N=this.gridData.gts,P=N.row||[],M=N.col||[],X=N.show,U=N.rec,d=this.cts||[],c=P.length,W=d.length,a=this.gridData.css;this.base={items:[]};this.rc=(X&&d.length)||0;if(this.rc===0&&X){this.rc=c>0?1:0;}this.colWidths=(X&&N.cws)||[];if(!this.rc){this.nRowSpan=this.nColSpan=0;return ;}var R={items:[]},Y=0,O=1,Z,b,f=this,Q=f.base.items,e=function(g,h){if(f.shouldClonedLastTitleCell()&&h>1){g.rs=1;Z=mstrmojo.hash.clone(g,{});Z.n="&nbsp;";g.cni=a.push({n:(a[g.cni].n||"")+" fsbp_1"})-1;}},S=function(j){var g=j;while(g-->1){if(f.shouldClonedLastTitleCell()){var h=mstrmojo.hash.clone(Z,{});h.cni=a.push({n:(a[h.cni].n||"")+" fsbp_"+((g==1)?"3":"2")})-1;Q.push({items:[h]});}else{Q.push({items:[]});}}};for(b=0;b<c;++b){P[b].axis=1;P[b].ui=b;Y+=P[b].cs||1;R.items.push(P[b]);}if(W>0){d[0].axis=2;d[0].ui=0;M[0].axis=2;M[0].ui=0;O=d[0].rs||1;e(d[0],O);Y+=d[0].cs||1;R.items.push(d[0]);}Q.push(R);for(b=1;b<W;++b){if(O>1){S(O);}d[b].axis=2;d[b].ui=b;M[b].axis=2;M[b].ui=b;O=d[b].rs||1;e(d[b],O);Q.push({items:[d[b]]});}this.rc=Q.length;this.nRowSpan=this.rc+O-1;this.nColSpan=Y;if(U){this._removeExtraColumn(P,d);}},getAvailableRowsCount:function I(){return this.rc;},getSpanDimension:function J(){return{nRow:this.nRowSpan||0,nCol:this.nColSpan||0};},isDataAvailable:function B(N,M){return true;},getRowCells:function E(N){var Q=this._super(N),U=this.gridData;if(U.olm&&!(U.rw&&U.rw.row.bc>0)&&!(this.dataSource&&this.dataSource.defn.txi)){Q=G(Q);var S=0,P=0,O;Q=mstrmojo.hash.clone(Q);for(S=0;S<Q.length;S++){if(Q[S].cs>1&&Q[S].otp===mstrmojo.mstr.EnumDSSXMLObjectTypes.Filter){for(P=1;P<Q[S].cs;P++){O={};O.css=Q[S].css.replace(" hl","");O.v="&nbsp;";Q.splice(S+1,0,O);}Q[S].cs=1;}}var R=C(U),M=R?Q.length-1:Q.length,S;for(S=0;S<M-1;S++){Q[S].expandLevel=S+1;}}return Q;},_removeExtraColumn:function D(P,g){var e=P&&P.length,V=g&&g.length,M=this.gridData.gts,Y=M.row||[],S=M.col||[],N=Y.length,c=S.length;if(!e||!V){if(V===1){var h=g[V-1];if(h.otp==-1){if(c>0){S[c-1]._hid=true;}this.base.items=[];this.nRowSpan=this.nColSpan=this.rc=0;}}return ;}var O=P[e-1],Z=this.rc,Q=this.base.items;if(O){if(O.otp==-1){if(N>0){Y[N-1]._hid=true;}if(this.nColSpan){this.nColSpan-=O.cs||1;}Q[0].items.splice(e-1,1);}else{var W=Z>1?Z-1:0,X=Q[W],f=X.items.length;if(f>0&&c>0){S[c-1]._hid=true;}var R=O.fix;if(R){var d;for(d=0;d<R;d++){X.items[f-1+d]=P[e-R+d];}}else{X.items[f-1]=O;}for(var b=0,a=V-1;b<a;b++){g[b].cs=R?R:O.cs;}var U=R?R:1;Q[0].items.splice(e-U,U);if(this.nColSpan){this.nColSpan-=1;}}}return ;}});})();(function(){mstrmojo.XtabOnDemandCP=mstrmojo.declare(mstrmojo.XtabCP,null,{scriptClass:"mstrmojo.XtabOnDemandCP",blockNum:0,listeners:null,initContent:function E(F){if(F!==undefined){this.startIndexInContainer=F;}this.isDownloaded=(this.base!==null);this.isDownloading=false;if(this.base){this._super(this.startIndexInContainer);this.notifyListeners();}},addCPListener:function D(F){if(!this.listeners){this.listeners=[];}this.listeners.push(F);},notifyListeners:function C(){var F,H=this.listeners,G=(H&&H.length)||0;for(F=0;F<G;F++){if(H[F]&&H[F].onDemandDataReady){H[F].onDemandDataReady(this);}}},getAvailableRowsCount:function B(){return this.isDownloaded?this.rc:0;},download:function(F){if(!this.isDownloaded&&!this.isDownloading){this.isDownloading=true;this.dataSource.download(this.blockNum,F);}},invalid:function(){if(this._super){this._super();}this.isDownloaded=false;this.isDownloading=false;},isDataAvailable:function A(G,F){return this.isDownloaded;}});})();(function(){var b=1,f=2,o=4,X=8,h=1,j=2,G=3,d=4,n=5,V=6,M=7,l=8,Y=4,F={},B={},I=4,R=1,J={TITLE:"ig-title",GROUPING:"iggroup",BANDING:"igbanding",RIGHT_ALIGN:"rtAlign",LEFT_ALIGN:"leftAlign",TOTAL_ROW:"total"},U=mstrmojo.hash,W=mstrmojo.array;function a(t,r){var s=t[0],p=r.gts,q=p.cws.length;return(r.vp.gr==="1"&&(q>1));}function k(q,v){var t=function(w,x){if(x&&w&&w.css&&w.css.indexOf(x)<0){w.css+=" "+x;}};var s=v.type,r=v.col,u=(r&&r.cl)||0,p=(s===f||s===b);if(s===f||s===X){t(q,J.RIGHT_ALIGN);}else{if(s===b||s===o){t(q,J.LEFT_ALIGN);}}if(p){if(r&&r.tg&&u>1){if(!q._v){q._v=q.v;q.v="<span class='toggleHeader'>"+q.v+"</span>";}}t(q,J.TITLE);}W.forEach(v.extraCss,function(w){t(q,w);});}function A(p){return 0;}function m(t){var r,s=t.cg,p=s&&s.cgc,q=1;for(r=0;r<p;r++){if(s&&s[r]&&!s[r].tg&&s[r].cl>q){q=s[r].cl;}}return q;}function N(q,p){var r=n;if(p===2){if(q===0){r=h;}else{if(q===1){r=d;}}}else{if(p>2){if(q===0){r=h;}else{if(q===1){r=j;}else{if(q===p-1){r=d;}else{if(q<p-1&&q>1){r=G;}}}}}}return r;}function L(p,t,r,q){var v=q&&q.cols&&q.cols.cg,s,w=0,u=0;if(v){for(s=0;s<t;s++){if(p[s]){w+=p[s].length;}}w+=(r+1);for(s=0;s<v.cgc;s++){u+=v[s].cl;if(u>=w){return s;}}}return -1;}function P(w,s,q,p){var v=[],u,r,t,x;for(r=0,t=w.length;r<t;r++){if(w[r].length===1){u=w[r][0];u.rowType=(u.rowType!==l)?N(s,q):l;u.singleStack=(q>1);u=U.copy(u);if(u.ts===I){if(q===1){u.rowType=n;u.colIdx=L(w,r,s,p);}else{if(!s){u.colIdx=L(w,r,s,p);}else{delete u.ts;u.v="";}}}else{if(s){u.v="";}}}else{u=w[r][s];if(!u){x=w[r].length;u=U.copy(w[r][x-1],{});u.v="";if(u.hasOwnProperty("ts")){delete u.ts;}}else{if(u.ts===I){u.colIdx=L(w,r,s,p);}}u.rowType=(u.rowType!==l)?N(s,q):l;}v.push(u);}return v;}function Q(p){if(p===0){return 0;}var q=this.sectionMap[p-1]||0;return Math.floor((p-q)/this.stackLevels);}function D(w){var u,v,t=this.sectionInfo,p=t.length,r=this.srh,q=this.lastSectionIndex;v=t[q];if(w>=v.rs&&w<(v.rs+r)){return v;}if(w<v.rs){u=q-1;if(u<=0){this.lastSectionIndex=0;return null;}do{v=t[u];if(w>v.rs&&w<=(v.rs+r)){this.lastSectionIndex=u;return v;}}while(w<v.rs&&--u>0);this.lastSectionIndex=u;return v;}else{u=q+1;if(u>=p){this.lastSectionIndex=p-1;return null;}do{v=t[u];if(w>v.rs&&w<=(v.rs+r)){this.lastSectionIndex=u;return v;}}while(w>(v.rs+r)&&++u<p);this.lastSectionIndex=u-1;return null;}}function e(x,r,p,w){var v=x[0],t,u=x.length,q=v&&v.rowType,s={v:"",css:"empty-igcell",rowType:q};if(p!==undefined&&v&&(q===h||q===n||q===V)){s={v:'<div><div class="IG-ActionArrow-IMG" style="height:'+w+"px;top:-"+(0.5*F[q])+'px;"></div></div>',css:"IG-ActionArrow",_ei:p};}for(t=u-1;t>=u-r;t--){v=x&&x[t];if(v){v.css+=" IG-lastdatacolumn";}}x.push(s);}function S(AL,AG,r){var AC=AL.cols,AD=AC.cg,p=[{w:"0px"}];if(AC&&AG){var AM=AC.cws,q=[],AK=AM.length,AO=0,x=(parseInt(AL.ar,10)===1)?(AG/AK):-1,AB,s,AA=false,t=0,AE=AG,AF=0,AJ;for(AJ=0;AJ<AK;AJ++){s=q[AJ]=AM[AJ];AB=s.w;if(AB===""){AA=true;}else{if(s.xc){AO+=parseInt(AB);AE-=AO;t++;}else{AF+=parseFloat(AB,10);}}}if(AA||AF<100){x=AE/(AK-t);}for(AJ=0;AJ<AK;AJ++){s=AM[AJ];if(s.xc){continue;}else{if(x===-1){AB=parseInt(s.w,10)*AE/100;if(!AB&&AB!==0){AB=parseInt(AE/AD.cgc,10);}}else{AB=(parseInt(s.w,10)<0)?0:x;}}q[AJ]={w:AB+"px"};}if(r){return q;}var z=[],AI=0;for(AJ=0;AJ<AK;AJ++){var AN=AD[AJ],v=AN.tg?AN.cl:1,AH=0;for(AH=0;AH<v;AH++){var u="0px";if(AH===AN.cc){u=q[AJ].w;}z[AI+AH]={w:u};}AI+=v;}return z.concat(p);}else{if(r){return null;}else{return cp.cws.concat(p);}}}function C(){delete this.lastStackCols;delete this.lastAttRow;delete this.lastMtxRow;}mstrmojo.InteractiveGridHACP=mstrmojo.declare(mstrmojo.XtabHACP,null,{scriptClass:"mstrmojo.InteractiveGridHACP",sectionMap:[],stackLevels:1,gridWidth:480,tdWidths:null,lastSectionIndex:0,adjustCPMaps:function O(){var z=this.cps,x=this.cps[0],AE=Math.max(z[0].rc,z[1].rc);if(x.type!==b){var AJ=this.gridData,AD=function(AM,AP){var AL=AM.base.items,AN=AM.lookupBase[0].es,AO=AL[AP].items[0],AK=AN&&AN[AO.idx];return(AK&&AK.n)||((AO.pi&&AN[AO.pi.ri||0])||"");},AH,AG,p=1,v,q,AB,s=0,r=-1,AC,AI,AF=0,AA=this.groupEnabled;for(AC=0,AH=0,AI=x.cps?x.cps.length:1;AC<AI;AC++){var u=x.cps?x.cps[AC]:x,w=u.rc;s=r+1;r=s+w-1;if(u.isDataAvailable(s,r)){if(u.lastRow){AF=u.lastRow;q=u.lastSection;}else{AH=AF||0;for(AG=0,p=this.sectionMap[AH-1]||0;AG<w;AG++){var t=this.stackLevels;AB=AD(u,AG);if(AA&&AB!==q){q=AB;this.sectionInfo.push({sn:AB,rs:this.srh*p+this.stackedRh*Math.floor((AH-p)/this.stackLevels)});this.sectionMap[AH]=++p;AH++;}while(t){this.sectionMap[AH]=p;t--;AH++;}}AF=u.lastRow=AH;u.lastSection=AB;}}else{break;}}this.rc=(this.stackLevels>1?AE*this.stackLevels:AE)+(AA?p:0);}},onDemandDataReady:function c(){this.adjustCPMaps();},initContent:function Z(z){var x=this.cps,AK=this.gridData=x[0].gridData||x[0].cps[0].gridData,AG=AK.vp=this.gridVp=this.gridVp||AK.vp,r=AG.daf&&AG.daf.split(":"),AA=AG.cols,AB=AA.cg,AH=AA.cws,w=x[A(AB)],AE=AK.gts.row,q=AK.gts,AI=a(x,AK),v=w.type!==b,AD,AF,t,p,AC,u,AJ,s=(typeof (mstrMobileApp)!=="undefined"&&mstrMobileApp.getDeviceDPI)?mstrMobileApp.getDeviceDPI():160;if(s===160){F={1:33,2:22,3:20,4:30,5:53,6:40,7:27,8:53};B={1:11,2:11,3:1,4:16,5:16};}else{if(s===213){F={1:45,2:31,3:26,4:39,5:71,6:40,7:35,8:71};B={1:15,2:15,3:2,4:21,5:21};}else{if(s===240){F={1:50,2:34,3:30,4:44,5:80,6:40,7:40,8:80};B={1:16,2:16,3:2,4:24,5:24};}else{if(s===320){F={1:67,2:44,3:38,4:58,5:107,6:40,7:53,8:107};B={1:22,2:22,3:2,4:32,5:32};}else{F={1:33,2:22,3:20,4:30,5:53,6:40,7:27,8:53};B={1:11,2:11,3:1,4:16,5:16};}}}}if(v){if(AG.dafIdx===undefined&&r){for(AD=0;AD<AE.length;AD++){if(AE[AD].id===r[0]&&AE[AD].fid===r[1]){AG.dafIdx=AD;break;}}}}for(AD=0;AD<AB.cgc;AD++){if(AB[AD]&&AB[AD].tg){break;}}if(AD===AB.cgc){AK.gts.show=false;AK.ghs.chs.show=false;}this._super(z);this.colWidths=S(AG,this.gridWidth);this.tdWidths=S(AG,this.gridWidth,true);if(v){this.stackLevels=m(AA);if(this.stackLevels>1){this.srh=F[M];this.rh=F[n];this.mrh=F[G];this.stackedRh=F[h]+(this.stackLevels-2)*F[j]+F[G];}else{this.srh=F[M];this.rh=this.stackedRh=this.mrh=F[n];}if(AI||this.stackLevels>1){this.sectionMap=[];this.sectionInfo=[];this.groupEnabled=AI;this.adjustCPMaps();p=this.cps[0].cps;if(p){AJ=this;for(AD=0,AF=p.length;AD<AF;AD++){u=p[AD];if(u&&u.addCPListener){u.addCPListener(AJ);}}}}}},getUnmergedCells:function(p){return ;},getResolvedGroupHeader:function(s,u){var q=this.gridData,t=q.gts.row[u].es,p=q.ghs.rhs.items[s].items[u];if(p){if(!p.css){p.css=q.css[p.cni].n+" iggroup";p.n=t[p.idx].n;}}else{return{css:" iggroup",n:""};}return p;},getRowCells:function(AI){var AD=this.cps,v=[],AW=this.gridData,AS=AW.vp,AG=AS.cols.cg,AB=AD[A(AG)],AF=this.groupEnabled,r=AS.bn==="1",AT=[],AH=Q.call(this,AI),w,s,AJ=1,AC,q,z,AP,AO,AR,AV,AA;if(AF&&(this.sectionMap[AI]!==this.sectionMap[AI-1])){var t=U.copy(AB.getRowCells(AH)[0],{});t.cs=this.colWidths.length;t.rowType=M;k(t,{col:null,type:AB.type,extraCss:[J.GROUPING]});return[t];}if(!AI){C.call(this);}this.lastAttRow=this.lastAttRow||(AD[0].rc?AD[0].getRowCells(AH):[]);this.lastMtxRow=this.lastMtxRow||(AD[1].rc?AD[1].getRowCells(AH):[]);z=this.lastAttRow;AR=z.length;if(AR>0&&z[0].stt){AC=true;for(AP=0;AP<AR;AP++){AV=z[AP];if(AV.stt===R){q=AV;break;}}}if(!this.lastStackCols){W.forEach([this.lastAttRow,this.lastMtxRow],function(p){for(AP=0;AP<p.length;AP++){if(p[AP]._ei!==undefined){if(AS.dafIdx>=0){AA=AB.getRowCells(AH)[AS.dafIdx];}w=(AS.dafIdx>=0)?(AA&&AA._ei):"";return false;}}},this);var AN=function(p,AX){if(p&&(AX.type===b||AX.type===f)){if(AL.tg===false){p.n=p.v="";}p.rowType=l;}k(p,{col:AL,type:AX.type,extraCss:[((AX.type===X||AX.type===o)&&r&&(AH%2===1))?J.BANDING:null,AC?J.TOTAL_ROW:null]});if(p){p.cs=1;if(p._ei===undefined&&AS.dafIdx!==undefined){p._ei=w;}}};this.lastRowIndex=0;for(AO=0;AO<AG.cgc;AO++){var AL=AG[AO],AQ=AL["mix"+AL.cc],u=AQ!==undefined,x=AD[u?1:0],AM,AK,AE,AU={n:"",stt:R,css:"xtab-td"};arr=[];if(AL.tg){for(var AP=0;AP<AL.cl;AP++){arr=[];AE=u?AL["mix"+AP]:AL.attForms[AP].idx;var z=u?this.lastMtxRow:this.lastAttRow;AV=z[AE];if(AC){if(!AV){AV=AU;}else{if(AV&&AV.stt===R){AV=U.copy(q,AU);}else{AV=U.copy(AV,{});}}}else{AV=U.copy(AV,{});}AN(AV,x);arr.push(AV);AT.push(arr);}if(AO+1===AG.cgc){AJ=AL.cl;}}else{for(AM=0,AR=AL.cl;AM<AR;AM++){if(u){AK=AL["mix"+AM];if(AK!==undefined){AV=this.lastMtxRow[AK];}}else{AK=AL.attForms[AM];if(AK){AV=this.lastAttRow[AK.idx];}if(AC&&!AV){AV=AU;}}AN(AV,x);arr.push(AV);}AT.push(arr);}}this.lastStackCols=AT;}v=P(this.lastStackCols,this.lastRowIndex++,this.stackLevels,AS);if(this.lastRowIndex>=this.stackLevels){C.call(this);}return v;},getRowHeight:function E(q){var p=F[n];return F[q]||p;},getPadding:function K(p){return B[p]||B[Y];},isDataAvailable:function g(q,p){if(!this.onDemandIF||!this.cps[1].cps){return true;}else{var t=this.sectionMap.length,r;if(!t){return this.cps[1].isDataAvailable(q,p);}if(p>t){if(q<t){r=Q.call(this,q);return this.cps[1].isDataAvailable(r,r+(p-q));}else{return false;}}else{return this.cps[1].isDataAvailable(Q.call(this,q),Q.call(this,p));}}},download:function H(v,s,w){var r=Q.call(this,v),p=r+Math.ceil((s-v)/this.stackLevels),t=this.cps[0],q,x,u=!t.cps?[t]:this.cps[0]._getCPs(r,p);for(q=0;q<u.length;++q){x=u[q];x.download(r,p,w);}},getRowCellInfo:function(s){var r=D.call(this,s+this.srh),p,q=this.lastSectionIndex;if(r){p=this.sectionInfo[q-1];return{rowStart:r.rs,isNextRowNewSection:true,sectionName:p&&p.sn};}else{return{isNextRowNewSection:false,sectionName:this.sectionInfo[q].sn};}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListHoriz","mstrmojo.fx");mstrmojo.FishEye=mstrmojo.declare(mstrmojo.ListHoriz,null,{scriptClass:"mstrmojo.FishEye",width:16,size:10,step:16,speed:2,cssClass:"mstrmojo-FishEye",cssClassItem:"mstrmojo-dot",itemMarkupFunction:function(B,A,C){return'<div class="mstrmojo-fisheye-item '+C.cssClassItem+'" title="'+B.n+'" idx="'+A+'" did="'+B.did+'">&nbsp;</div>';},onchange:function(){this.scroll2();this.parent.set("selectedIndex",this.selectedIndex);},as:new mstrmojo.fx.AnimateProp(),onitemsChange:function(){if(this._super){this._super();}this.last=this.items.length-1;this.first=Math.max(0,this.last-this.size);if(this.items.length>this.size){this.scroll("left",this.width);}},scroll2:function(){var A=this.selectedIndex-this.last;if(this.selectedIndex==this.first&&this.first>0){this.scroll("right",this.width);}else{if(this.selectedIndex==this.last&&this.last<this.items.length-1){this.scroll("left",this.width);}else{if(this.selectedIndex>this.last){A=this.selectedIndex-this.last;this.scroll("left",this.width*A,A);this.last=Math.min(this.items.length-1,this.last+A);}else{if(this.selectedIndex<this.first){A=this.first-this.selectedIndex;this.scroll("right",this.width*A,A);this.first=Math.max(0,this.first-A);}}}}},scroll:function(C,F,E){var B=this.itemsContainerNode,I=B&&B.style;var D=this.as,H=parseInt(mstrmojo.css.getStyleValue(B,{left:"right",right:"left"}[C]),10),H=isNaN(H)?0:H,A=parseInt(I.left,10)||0,G=A+(C=="left"?-1:1)*(F||(Math.min(this.step,(-1)*H)));D.target=B;D.props={left:{start:A,stop:G,duration:100,interval:10,suffix:"px"}};D.play();E=E===undefined?1:E;this.first+=(C=="left"?1:-1)*E;this.last=this.first+this.size-1;this.parent.set("scrollable",this.last<this.items.length-1);this.parent.set("rightScrollable",this.first>0);return G;},srcId:null,postBuildRendering:function(){if(this._super){this._super();}this.hasRendered=!!this.domNode;var E=this.itemsContainerNode,A=E&&E.firstChild,B=A&&A.rows&&A.rows[0],D=B&&B.cells&&B.cells[0];this.first=0;this.last=this.size-1;var C=this.srcId;if(C&&mstrmojo.all[C]&&mstrmojo.all[C].attachEventListener){mstrmojo.all[C].attachEventListener("change",this.id,function(F){if(this.items[this.items.length-1]!=F.src.selectedItem){this.items.add([mstrmojo.hash.copy(F.src.selectedItem)]);this.set("selectedIndex",this.items.length-1);}if(this.items.length>this.size){this.set("rightScrollable",this.items.length>this.size);this.scroll("left",this.width*(this.selectedIndex-this.last),(this.selectedIndex-this.last));}});}this.itemsContainerNode.style.left=Math.min(0,(this.size-this.items.length+1))*this.width+"px";}});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetListBase","mstrmojo.WidgetListMapper","mstrmojo.WidgetListBuilder");mstrmojo.WidgetList=mstrmojo.declare(mstrmojo.WidgetListBase,null,{scriptClass:"mstrmojo.WidgetList",renderOnScroll:true,listMapper:mstrmojo.WidgetListMapper,listBuilder:mstrmojo.WidgetListBuilder,itemConfig:null,itemFunction:null,initBindings:function(){this._super();var E=this.ctxtBuilder,D=E&&E.itemWidgets;if(D){for(var C=0,A=D.length;C<A;C++){var B=D[C];if(B&&B.initBindings){B.initBindings();}}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo._IsDial");mstrmojo.Dial=mstrmojo.declare(mstrmojo.List,[mstrmojo._IsDial],{scriptClass:"mstrmojo.Dial",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onhasSelectionChange:function(){mstrmojo.css.toggleClass(this.domNode,["hasSelection"],!!this.hasSelection);},hideIfEmpty:function(){this.onadd();}},hideIfEmpty:false,onadd:function(A){if(this._super){this._super(A);}if(this.hideIfEmpty){if(this.domNode){this.domNode.style.display=(!this.items||this.items.length==0)?"none":"block";}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.Popup","mstrmojo.List","mstrmojo.DropDownButton");var B=mstrmojo.dom;mstrmojo.Pulldown=mstrmojo.declare(mstrmojo.DropDownButton,null,{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-Pulldown",items:null,itemIdField:"dssid",itemField:"n",itemCSS:"css",itemTitleField:null,defaultSelection:0,defaultText:null,title:"",value:null,popupToBody:false,popupCssClass:"",popupZIndex:null,fixWidth:false,fixHeight:false,allowHTML:false,_set_items:function(H,F){var G=this.items;this.items=F||[];return G!==this.items;},markupMethods:mstrmojo.hash.copy({onvalueChange:function(){var G=this.value,F=this.selectedIndex,I=this.items||[],J,H;if(F===undefined||(G!==null&&(F===-1||(F!==-1&&I[F]&&I[F][this.itemIdField]!==G)))){F=mstrmojo.array.find(I,this.itemIdField,G);F=(F>-1)?F:this.defaultSelection;this.selectedIndex=F;}else{if(G===null){this.selectedIndex=this.defaultSelection;}}this.selectedItem=J=I[this.selectedIndex];if(J){H=J[this.itemField];}else{H=this.defaultText||"";}this.set("text",H);}},mstrmojo.hash.copy(mstrmojo.DropDownButton.prototype.markupMethods)),prevalueChange:function D(){var G=this.value,F=-1;if(G!==null){F=mstrmojo.array.find(this.items,this.itemIdField,G);}if(F>-1){this.selectedItem=this.items[F];this.selectedIndex=F;}},togglePopup:function E(){if(this.popupToBody){var I=B.position(this.popupNode,true),H=this.popupRef,F={left:Math.round(I.x)+"px",top:Math.round(I.y)+"px"};if(!H.hasRendered){delete H.slot;F.placeholder=document.body.appendChild(document.createElement("div"));}this.popupOpenConfig=this.popupOpenConfig||{};mstrmojo.hash.copy(F,this.popupOpenConfig);}else{this.popupRef.slot="popupNode";}if(this._super){this._super();}var G=this.popupRef.domNode;if(G){if(this.fixWidth){G.style.width=(this.domNode.offsetWidth-2)+"px";}else{G.style.minWidth=(this.domNode.offsetWidth-2)+"px";}}},premousedown:function A(F){if(B.getButton(F.hWin,F.e)===B.MOUSE_BUTTON.LEFT){this.togglePopup();}},unrender:function C(F){var G=this.popupRef;if(this.popupToBody&&G.hasRendered){G.unrender(false);}if(this._super){this._super(F);}},itemName:function(H,F,G){return this.allowHTML?H[G.itemField]:mstrmojo.string.encodeHtmlString(H[G.itemField]);},popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",cssClass:"mstrmojo-Pulldown-Popup",autoCloses:false,modal:false,autoClose:true,locksHover:true,adjustSize:function(){var G=this.opener,F=this.domNode;if(G&&G.fixWidth){mstrmojo.css.addClass(F,["fix-width"]);}if(G&&G.fixHeight){mstrmojo.css.addClass(F,["fix-height"]);}},onOpen:function(){var H=this.opener,G=H&&H.popupZIndex,I=(H&&H.popupCssClass)||"",F=this.domNode;if(G){F.style.zIndex=G;}if(I){mstrmojo.css.addClass(F,[I]);}this.adjustSize();},children:[{scriptClass:"mstrmojo.List",alias:"list",itemMarkupFunction:function(I,F,G){var H=I[G.itemCSS]||G.parent.opener.item2textCss&&G.parent.opener.item2textCss(I)||"",J=G.parent.opener.itemName;return'<div class="mstrmojo-Pulldown-listItem"><div class="mstrmojo-text '+H+'" title="'+I[G.itemTitleField||G.itemField]+'">'+(J(I,F,G)||"&nbsp;")+"</div></div>";},renderOnScroll:false,bindings:{itemIdField:"this.parent.opener.itemIdField",itemField:"this.parent.opener.itemField",itemCSS:"this.parent.opener.itemCSS",itemTitleField:"this.parent.opener.itemTitleField",items:"this.parent.opener.items",selectionPolicy:"this.parent.opener.selectionPolicy",selectedIndex:"this.parent.opener.selectedIndex"},onmousedown:function(){this.parent.close();},onchange:function(){var H=this.parent,I=H.visible,F=H.opener,G=this.selectedItem;if(!F||!G||!I){return ;}F.set("value",G[this.itemIdField]);}}]}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListSelector","mstrmojo.List","mstrmojo.string");mstrmojo.OBList=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.OBList",cssClass:"mstrmojo-OBList",itemClass:"mstrmojo-OBListItem",iconClass:"mstrmojo-OBListItemIcon",textClass:"mstrmojo-OBListItemText",iconCssPrefx:"mstrmojo-OBIcon_",itemMarkupFunction:function(C,A,B){return'<div class="'+B.itemClass+(C[B.itemType]?" t_"+C[B.itemType]:"")+(C[B.itemSubType]?" st_"+C[B.itemSubType]:"")+(C[this.itemISC]?" isc":"")+(C[B.itemViewMedia]?" vm_"+C[B.itemViewMedia]:"")+'"><table cellspacing="0" cellpadding="0"><tbody><tr><td>'+B.getIcon(C)+'</td><td><div class="'+B.textClass+'" title="'+B.getTooltip(C)+'">'+mstrmojo.string.htmlAngles(C.n)+"</div></td></tr></tbody></table></div>";},getIcon:function(F){var E=F[this.itemType],D=F[this.itemSubType],B=" t"+E,C=(parseInt(E,10)===1||parseInt(E,10)===3||parseInt(D,10)===14082)?" st"+D:"",G=F[this.itemISC]?'class="mstrmojo-ListIcon isc"':"",A=(F[this.itemViewMedia]===2048||F[this.itemViewMedia]===8192)?" hvi":"";return'<span class="mstrmojo-ListIcon '+B+C+A+'"><span '+G+"></span></span>";},getTooltip:function(C){var D="",F=C.anc&&C.anc.items,A=F&&F.length,B;if(A>0){for(B=0;B<A-1;B++){D+=F[B].n+" > ";}D+=F[A-1].n;}var E=C.desc,G=128;if(E){D+="\r\n\r\n"+mstrmojo.string.encodeHtmlString(E.substring(0,G))+(E.length>G?"...":"");}return D;},listSelector:mstrmojo.ListSelector,selectionPolicy:"reselect",itemType:"t",itemSubType:"st",itemISC:"isc",itemViewMedia:"dvm",useDblSelect:false});}());(function(){mstrmojo.requiresClsP("mstrmojo","List","desc");mstrmojo.requiresDescs(2827,11897);var B=mstrmojo.desc,A={OPERATOR:1,VALIDATE:2,CLEAR:3};mstrmojo.ExpressionToolbar=mstrmojo.declare(mstrmojo.List,null,{scriptClass:"mstrmojo.ExpressionToolbar",cssClass:"mstrmojo-ExpressionToolbar",items:[{t:A.OPERATOR,v:"+",cls:"plus"},{t:A.OPERATOR,v:"-",cls:"minus"},{t:A.OPERATOR,v:"*",cls:"multi"},{t:A.OPERATOR,v:"/",cls:"divide"},{t:A.OPERATOR,v:"()",cls:"par"},{t:A.OPERATOR,v:"<>",cls:"bra"},{t:A.CLEAR,v:"V",cls:"clear right",n:B(2827,"Clear")},{t:A.VALIDATE,v:"",cls:"validate right",n:B(11897,"Validate")}],itemMarkupFunction:function(F,D){var C=F.cls,G=F.n||"",E=F.t;if(E===A.OPERATOR){return'<div class="mstrmojo-item '+C+'" idx='+D+' title="'+G+'">'+G+"</div>";}if(E===A.VALIDATE){return"";}return'<div class="mstrmojo-Button mstrmojo-WebHoverButton '+C+' hoverLink"><div class="mstrmojo-Button-text" idx='+D+">"+G+"</div></div>";}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo._BindTargetChildren","mstrmojo.List");mstrmojo.TabNameList=mstrmojo.declare(mstrmojo.List,[mstrmojo._BindTargetChildren],{scriptClass:"mstrmojo.TabNameList",isStrip:true,targetProps:{names:"items"},makeObservable:true,postchange:function A(){var E=this.selectedIndex,F=this.target;if(F&&E!=null&&parseInt(E,10)!==-1){F.set("selected",F.children[E]);}},addTabButtons:function B(E,M){var J=this.targetProps||{},Q=J.childTitle||"n",G=this.itemIdField||"v",F=this.itemField||"n",P=[],I=(this.items)?this.items.length:0,L=(E&&E.length)||0,K;for(K=0;K<L;K++,I++){var O=E[K],H=O[Q];if(H){var N={target:O};N[F]=H;N[G]=I;P.push(N);}}if(P.length){this.add(P,M);}},removeTabButton:function D(F){var E=mstrmojo.array.filter(this.items,function(G){return(G.target===F);},{max:1});if(E&&E[0]){this.remove(E[0]);}},clearButtons:function C(){this.remove(this.items);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.ui.ButtonBar");mstrmojo.vi.ui.TextAlignButtonBar=mstrmojo.declare(mstrmojo.ui.ButtonBar,null,{scriptClass:"mstrmojo.vi.ui.TextAlignButtonBar",includeJustify:true,init:function B(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"txtAlign");var D=this.itemsValueMap,C=this.items;if(!this.includeJustify){C=C.filter(function(F){return F.id!=="justify";});}this.items=C.map(function(G){var F=mstrmojo.hash.copy(G);F.v=D[F.id];return F;});},onValueChange:mstrmojo.emptyFn,itemsValueMap:{left:0,center:2,right:1,justify:6},items:[{n:mstrmojo.desc(3049,"Left"),id:"left"},{n:mstrmojo.desc(2193,"Center"),id:"center"},{n:mstrmojo.desc(2166,"Right"),id:"right"},{n:mstrmojo.desc(2068,"Justify"),id:"justify"}],getItemProps:function A(E,C){var D=this._super(E,C);D.addCls(E.id);return D;},postselectionChange:function(C){var D=this.items,E=D[C.added[0]],F=D[C.removed&&C.removed[0]];this.onValueChange(E.v,F&&F.v);}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Button","Box","vi.ui.CalculationWidget","mstr.EnumFunction");mstrmojo.requiresDescs(221,358,1422,2122,6017,5868,5869);var C=mstrmojo.desc,B=mstrmojo.mstr.EnumFunction,I=4,E=5,H=6,F=7;var D={SINGLE:[{n:C(358,"Absolute"),v:B.FunctionAbs}],PAIR:[{n:C(6017,"Add"),v:B.FunctionAdd},{n:C(2122,"Average"),v:B.FunctionAverage},{n:C(5868,"Least"),v:B.FunctionLeast},{n:C(5869,"Greatest"),v:B.FunctionGreatest},{n:"A-B",v:B.FunctionMinus+";0"},{n:"B-A",v:B.FunctionMinus+";1"},{n:"A/B",v:B.FunctionDivide+";0"},{n:"B/A",v:B.FunctionDivide+";1"}],MORE:[{n:C(6017,"Add"),v:B.FunctionAdd},{n:C(2122,"Average"),v:B.FunctionAverage},{n:C(5868,"Least"),v:B.FunctionLeast},{n:C(5869,"Greatest"),v:B.FunctionGreatest}]};mstrmojo.vi.ui.CalculationMenuEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.CalculationMenuEditor",onSubmenuOpen:function G(){var P=this.parent,O=P.de,Q=O&&O.es,J=(Q&&Q.length)||P.cellsNum,L=(J===1)?"SINGLE":((J===2)?"PAIR":"MORE"),N=D[L],K=(O&&O.func)||P.func,M,R;if(L==="PAIR"){if(O){N[I].n=Q[0].n+" - "+Q[1].n;N[E].n=Q[1].n+" - "+Q[0].n;N[H].n=Q[0].n+" / "+Q[1].n;N[F].n=Q[1].n+" / "+Q[0].n;}else{R=this.xtab.selCells;N[I].n=R[0].innerText+" - "+R[1].innerText;N[E].n=R[1].innerText+" - "+R[0].innerText;N[H].n=R[0].innerText+" / "+R[1].innerText;N[F].n=R[1].innerText+" / "+R[0].innerText;}}this.checkList.set("items",N);for(M in N){if(typeof N[M].v==="string"&&N[M].v.indexOf(K)===0&&N[M].v.indexOf(";0")>0){this.checkList.set("selectedItem",N[M]);break;}if(N[M].v===K){this.checkList.set("selectedItem",N[M]);break;}}},applyCalculation:function A(L){var K=this.xtab,J=this.parent;if((J.de&&J.de.func===L)||(typeof L==="string"&&L.indexOf(J.de.func)===0&&L.indexOf(";0")>0)){return ;}if(this.parent.isEdit===true){K.editDECalculation(J.node,L);}else{K.derivedElementCalculation(J.node,L);}this.onSubmenuClosed();},children:[{scriptClass:"mstrmojo.vi.ui.CalculationWidget",alias:"checkList"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller");mstrmojo.ui.ScrollableList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousedown,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function C(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function E(){return this.domNode.firstChild;}},postBuildRendering:function B(){if(this.renderOnScroll){if(!this.onScrollEnd){var G=this.id;this.onScrollEnd=function F(){var H=mstrmojo.all[G];H.doScroll();H.updateScrollbars();};}}if(this._super){this._super();}},renderBlockSize:150,renderIndex:0,onScrollEnd:undefined,doScroll:function A(){if(this.renderOnScroll){var G,H=this.scrollNode,F=(this.renderIndex+1)*this.renderBlockSize;if(F>=this.items.length){return ;}if(mstrmojo.dom.position(H).h===H.scrollHeight){G=this.domNode;}else{G=H;}if((mstrmojo.dom.position(G).h+G.scrollTop)>=G.scrollHeight){this.renderIndex++;var I=this._buildItemsMarkup(this.renderIndex*this.renderBlockSize,((this.renderIndex+1)*this.renderBlockSize)-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");G.innerHTML+=I;this.itemsContainerNode.innerHTML+=I;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.css");var G=mstrmojo.css;var D;mstrmojo.ui.CheckList=mstrmojo.declare(mstrmojo.ui.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.CheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function J(){return this.domNode.firstChild.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onorientationChange:function M(){G.toggleClass(this.domNode,"horizontal",this.orientation!=="v");},onmultiSelectChange:function K(){G.toggleClass(this.domNode,"radio",!this.multiSelect);},onenabledChange:function I(){G.toggleClass(this.domNode,"disabled",!this.enabled);},onhideCheckMarkChange:function B(){G.toggleClass(this.domNode,"hideCheckMark",this.hideCheckMark);}},multiSelect:true,hideCheckMark:false,orientation:"v",minimumSelectCnt:0,icnCss:"icn",items:null,getItemMarkup:function L(N){if(!D){D=this._super(N).replace(">{@en@n}<",'title="{@tt}"><span class="text">{@en@n}</span><');}return D;},getItemProps:function H(Q,O){var P=this._super(Q,O),N={"\r\n":" ","\n":" ","\r":" "};var R=Q.css;if(R){P.addCls(R);}P.tt=Q.tt||"";Q.n=mstrmojo.string.multiReplace(Q.n,N);P.n=Q.n||"";return P;},setupScrollNodes:function E(){this.scrollNode=this.scrollboxNode;},preselectionChange:function C(O){var P=this.minimumSelectCnt,N=this.getSelectedItems().length,Q=O.removed;if(Q&&P){if(N<P){this.select(Q,true);return false;}}G.toggleClass(this.itemsContainerNode,"disableSelected",N<=P);return true;},buildRendering:function F(){this._super();G.toggleClass(this.itemsContainerNode,"disableSelected",this.getSelectedItems().length<=this.minimumSelectCnt);}});mstrmojo.ui.CheckList.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.dom","mstrmojo.array","mstrmojo.hash");var F=mstrmojo.dom,H=mstrmojo.array,J=mstrmojo.hash,M=2;var W;function S(Z){var Y=[];H.forEach(this.itemsContainerNode.childNodes,function(c,a){if(c!==Z){var b=F.position(c);Y.push({i:a,m:b.x+(b.w/2)});}});return Y;}mstrmojo.vi.ui.IconTabList=mstrmojo.declare(mstrmojo.ui.List,null,{scriptClass:"mstrmojo.vi.ui.IconTabList",init:function N(Y){this._super(Y);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIIconTabList");},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},items:null,useRichTooltip:true,listHooks:{select:function(Z){var a=this.getItemNodeFromTarget(Z);if(a){var Y=F.position(a.firstChild);this.set("richTooltip",J.copy({top:Y.y+Y.h,left:Y.x-M},J.clone(this.richTooltip)));}}},showTooltip:function D(Z,c){var b=Z.target||F.eventTarget(Z.hWin,Z.e),a=this.getItemFromTarget(b);if(!a||a===this.getSelectedItems()[0]){return ;}if(a&&a.n){var Y=F.position(this.getItemNodeFromTarget(b).firstChild);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:a.n,top:Y.y+Y.h+3,left:Y.x-M};this._super(Z,c);}},getItemMarkup:function E(Y){if(!W){W=this._super(Y).replace(">{@en@n}<","><div>{@en@n}</div><");}return W;},getItemProps:function X(a,Y){var Z=this._super(a,Y);if(a.disabled){Z.addCls("disabled");}Z.addCls(a.cls);return Z;},disableItem:function Q(Y){this.items[Y].disabled=true;this.refresh();},enableItem:function A(Y){this.items[Y].disabled=false;this.refresh();},singleSelect:function V(Z,a,Y){if(this.items[Z]&&!this.items[Z].disabled){this._super(Z,a,Y);}},selectionAdded:function G(Y){this.hideTooltip();this.tabSelected(this.items[Y.added[0]]);},tabSelected:function L(Y){},getTabIds:function I(){var Y=this.getSelectedItems()[0];return this.items.map(function(Z){return Z.id+((Z===Y)?"*":"");}).join("|");},getDragTabInfo:function C(b){var a=F.findAncestorByAttr(b,"idx",true,this.domNode),Z=this.items,c=Z.length===1;if(a){if(Z[a.value].disabled){return null;}var Y=parseInt(a.value,10);return{id:this.parent.id,node:a.node,homeIdx:Y,idx:Y,item:Z[a.value],isSingleTab:c,active:!c,pos:null,panel:null};}return null;},enterDragMode:function U(Y,a){this.selectItems(Y.item,true);var f=Y.node,c=F.position(this.domNode),d=f.nextSibling,b=f.offsetWidth,Z=S.call(this,f);var e=a.src.pos.x-F.position(f).x;if(e<0||e>b){e=Math.round(b/2);}Y.pos={offset:e,map:Z,width:b,left:c.x,max:c.x+c.w-b};f.style.left=(f.offsetLeft-1)+"px";if(d){d.style.marginLeft=b+"px";Y.pos.idx=Y.idx+1;}mstrmojo.css.addClass(this.domNode,"dnd");Y.active=true;},dragTab:function K(f,Z){var k=f.pos,h=Math.max(Math.min(Z.tgt.pos.x-k.offset,k.max),k.left),Y=k.width;var j=Z.getDirection("x"),d=k.map,g,b;f.node.style.left=h-k.left+"px";d.sort(function(m,l){return j?m-l:l-m;});H.forEach(d,function(l){if(!b&&(j?h+Y<l.m:h<l.m)){b=l;}if(l.i===k.idx){g=l;}});if(b!==g){var c=this.itemsContainerNode.childNodes,e=b&&b.i,a=g&&g.i;k.idx=undefined;if(g){c[a].style.marginLeft=0;}if(b){c[e].style.marginLeft=Y+"px";k.idx=e;}if(g&&b){if(a<e){g.m-=Y;}else{b.m+=Y;}}else{if(g){g.m-=Y;}else{b.m+=Y;}}}},exitDragMode:function O(Y){mstrmojo.css.removeClass(this.domNode,"dnd");H.forEach(this.itemsContainerNode.childNodes,function(Z){Z.style.marginLeft=0;});Y.active=false;delete Y.pos;},removeTab:function B(b){var Y=[].concat(this.items),Z=H.find(Y,"id",b),a=this.getSelectedItems()[0];if(a===Y[Z]){a=Y[Z+1]||Y[0];}Y.splice(Z,1);this.set("items",Y);this.selectItems(a,true);},pivotTab:function R(Y){var Z=[].concat(this.items),b=Y.item,a=Y.idx,c=Y.pos.idx;if(c===undefined){c=Z.length;}if(a<c){c--;}Z.splice(a,1);Z.splice(c,0,b);this.set("items",Z);this.selectItems(b,true);},addTab:function P(b,a,Z){var Y=[].concat(this.items),c=this.getSelectedItems()[0];if(Z||!c){c=b;}if(H.indexOf(Y,b)===-1){a=isNaN(a)?Y.length:a;Y.splice(a,0,b);this.set("items",Y);}this.selectItems(c,true);return{idx:a,node:this._getItemNode(a)};}});mstrmojo.vi.ui.IconTabList.TabInfoType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Table","mstrmojo.SelectBox","mstrmojo._CanValidate","mstrmojo.MetricSelectorUtility");var D=mstrmojo.MetricSelectorUtility,K=mstrmojo.validation,G=mstrmojo.expr,E=mstrmojo.num,N=D.OP,F=[{n:mstrmojo.desc(2795,"Equals"),v:N._EQUALS},{n:mstrmojo.desc(2796,"Does not equals"),v:N._NOT_EQUALS},{n:mstrmojo.desc(521,"Greater than"),v:N._GREATER},{n:mstrmojo.desc(522,"Greater than or equal to"),v:N._GREATER_EQUAL},{n:mstrmojo.desc(523,"Less than"),v:N._LESS},{n:mstrmojo.desc(524,"Less than or equal to"),v:N._LESS_EQUAL},{n:mstrmojo.desc(519,"Between (enter value1;value2)"),v:N._BETWEEN},{n:mstrmojo.desc(614,"Not between (enter value1;value2)"),v:N._NOT_BETWEEN},{n:mstrmojo.desc(898,"In (enter value1;value2; ...;valueN)"),v:N._IN},{n:mstrmojo.desc(2394,"Not In (enter value1;value2; ...;valueN)"),v:N._NOT_IN},{n:mstrmojo.desc(2202,"Is null"),v:N._IS_NULL},{n:mstrmojo.desc(2203,"Is not null"),v:N._IS_NOT_NULL}],L=F.slice(0,10),J="padding:2px 2px 2px 2px",H=F.slice(10,12);var C=function(a,S,U,W,V){var X;if(V===2){return S;}var b=String(a).split(";"),Y=K.STATUSCODE.INVALID_VALIDATOR,R=K.STATUSCODE.VALID;if(W&&b&&b.length>1){S.code=Y;}else{for(X=0;X<b.length;X++){var Z=parseFloat(b[X],10);if(isNaN(Z)||(U&&((b[X].match(/^\d+(\.\d+)?%$/)===null&&b[X].match(/^\d+(\.\d+)?$/)==null)||Z<0||Z>100))||(!U&&b[X].match(/\d+$/)===null)){S.code=Y;}if(S.code!==R){break;}}}if(S.code!==R){S.msg=mstrmojo.desc(6103,"Please fix any invalid data");}return S;};var M=function(R){R=parseFloat(R);return isNaN(R)?"54px":((R*72/16)+"pt;");},Q=function(U){if(U.hasRendered){var S=U.domNode.style;S.font=U.font;S.width=M(S.fontSize);}else{var R=U.font.match(/[^\s]*?pt/)||[];U.cssText=U.cssText+" font:"+U.font+"; width:"+M(R[0]);}},I=function(R){if((R>=8&&R<=16)||(R>=23&&R<=25)){return false;}return true;};mstrmojo.MetricQualification=mstrmojo.declare(mstrmojo.Table,null,{scriptClass:"mstrmojo.MetricQualification",cssClass:"qs",cssText:"width:100%",markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},getClientHeight:function P(){return this.domNode.clientHeight+2;},rows:1,cols:4,layout:[{cells:[{cssText:"width:100%"},{cssText:"width:56px"},{cssText:"width:56px"},{cssText:"width:18px"}]}],init:function(R){if(this._super){this._super(R);}this._init();},_init:function(U){var S;switch(this.qua){case 0:this.low=(this.da&&this.da.low)||0;this.high=(this.da&&this.da.high)||0;break;case 1:case 2:this.low=1;this.high=(this.da&&this.da.cnt)||0;break;case 3:case 4:this.low=0;this.high=100;break;}if(U){this.cs=[];this.f=this.ft=null;}var W=D.getOpIdxByfunc(this.f,this.ft),V=I(this.dt)?N._GREATER_EQUAL:N._IS_NULL;this.set("opId",(W==-1)?V:W);var R=(this.cs&&this.cs.length>0)?E.toLocaleString(this.cs[0].v):"";if(this.opId===N._IN||this.opId===N._NOT_IN){for(S=1;S<this.cs.length;S++){R+=";"+E.toLocaleString(String(this.cs[S].v));}}else{this.set("cs2",(this.cs&&this.cs.length>1)?E.toLocaleString(this.cs[1].v):"");}this.set("cs1",R);this.vldTbL.validate();this.vldTbH.validate();this.changeQual=false;},updateData:function B(R,S){this.da=R;this.updateExpr(S);},updateExpr:function A(R){if(R){this.cs=R.cs;this.f=R.f;this.ft=R.ft;this.qua=R.qua;}this._init();},onquaChange:function O(R){this._init(true);this.func.items=(this.qua!==0)?L:I(this.parent.dt)?F:H;this.func.refresh();this.changeQual=true;this.onchange();},children:[{slot:"0,0",alias:"func",scriptClass:"mstrmojo.SelectBox",cssText:"width:100%",size:1,bindings:{sv:"this.parent.opId",font:"this.parent.font"},onfontChange:function(){if(this.hasRendered){this.domNode.style.font=this.font;}else{this.cssText="width:100%;font:"+this.font;}},onsvChange:function(){if(this.sv!==null&&this.sv!==undefined){this.set("selectedItem",{v:this.sv});}},postCreate:function(){if(mstrmojo.dom.isIE){this.itemDisplayField="n";this.showItemTooltip=true;}this.items=(this.parent.qua!==0)?L:I(this.parent.dt)?F:H;},onchange:function(){var S=this.parent,U=this.selectedItem;if(U&&U.v!==null&&U.v!==undefined){var R=D.getIncludeByOp(U.v);S.include=R;if(S.parent&&R!==S.parent.include){S.changeInclude=true;}else{S.changeInclude=false;}S.set("opId",U.v);}if(mstrApp.isMobile&&(U.v===N._IS_NULL||U.v===N._IS_NOT_NULL)){if(S.onchange){S.onchange();}}}},{slot:"0,1",alias:"vldTbL",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:G.DTP.VARCHAR,constraints:{trigger:K.TRIGGER.ALL,validator:function(R){var S={id:this.id,code:K.STATUSCODE.VALID,msg:""},U=this.parent;C(R,S,(U.qua===3||U.qua===4),(U.opId!==8&&U.opId!==9),(U.numFmts&&U.numFmts.cat));return S;}},bindings:{visible:"this.parent.opId!=10&&this.parent.opId!=11",value:"this.parent.cs1",font:"this.parent.font"},onfontChange:function(){Q(this);},onValid:function(){var S=this.parent,R=this.domNode;S.set("cs1",this.value);if(R&&R.value.length>6){R.title=R.value;}else{if(R){R.title="";}}},onvisibleChange:function(){if(!this.visible){this.parent.set("cs1","");}},onkeyup:function(S){var R=S.hWin,W=S.e||R.event,V=this.parent,U=S.src.domNode;if(W.keyCode===13&&V.apply&&V.apply.enabled){V.apply.onclick();}}},{slot:"0,2",alias:"vldTbH",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:G.DTP.VARCHAR,constraints:{trigger:K.TRIGGER.ALL,validator:function(R){var S={id:this.id,code:K.STATUSCODE.VALID,msg:""},U=this.parent;C(R,S,(U.qua===3||U.qua===4),(U.opId!==8&&U.opId!==9),(U.numFmts&&U.numFmts.cat));return S;}},bindings:{visible:"this.parent.opId ==7 ||this.parent.opId ==6",value:"this.parent.cs2",font:"this.parent.font"},onfontChange:function(){Q(this);},onValid:function(){this.parent.set("cs2",this.value);var R=this.domNode;if(R&&R.value.length>6){R.title=R.value;}else{if(R){R.title="";}}},onvisibleChange:function(){if(!this.visible){this.parent.set("cs2","");}},onkeyup:function(S){var R=S.hWin,V=S.e||R.event,U=this.parent;if(V.keyCode===13&&U.apply&&U.apply.enabled){U.apply.onclick();}}},{slot:"0,3",alias:"apply",title:mstrmojo.desc(2164,"Apply"),scriptClass:"mstrmojo.Button",cssClass:"icn apply",bindings:{enabled:"(!this.parent.vldTbL.visible ||!this.parent.vldTbL.validationStatus.code)&& (!this.parent.vldTbH.visible||!this.parent.vldTbH.validationStatus.code)"},onclick:function(){var U=this.parent,X=(U.qua===D.Q._PT||U.qua===D.Q._PB),R;U.cs=[];var V=function(Y){return Y+((X&&!String(Y).match(/^\d+%$/))?"%":"");};var S=function(Y,Z){return((Y===2||Y===3)&&Z===0)?14:5;};if(U.opId===N._IN||U.opId===N._NOT_IN){var W=String(U.cs1).split(";");for(R=0;R<W.length;R++){if(!mstrmojo.string.isEmpty(W[R])){U.cs.push({dtp:5,v:V(W[R])});}}}else{if(U.vldTbL.visible){U.cs.push({dtp:S((U.numFmts&&U.numFmts.cat),U.qua),v:V(U.cs1)});}if(U.vldTbH.visible){U.cs.push({dtp:S((U.numFmts&&U.numFmts.cat),U.qua),v:V(U.cs2)});}}if(U.onchange){U.onchange();}if(U.makeSelection){U.makeSelection();}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var C=function(S,V,U){var R=S.parent.opener,J=R&&R.showDesc,Q=R&&R.showPath,I=V[S.itemField];var P=mstrmojo.string.escape4HTMLText,W="";if(Q){var M=V.anc&&V.anc.items,O=M&&M.length;if(O>0){for(var L=0;L<O-1;L++){W+=M[L].n+" > ";}W+=P(M[O-1].n);}else{if(V.path){W+=P(V.path);}}}if(!U){W+=(W.length===0?"":" > ")+P(I);}if(J){var N=V[S.itemDescField],K=120;if(N){W+="\r\n\r\n<br>"+P(N.substring(0,K)+(N.length>K?"...":""));}}return W;};var A=function(I,J,K){I.path=null;if(!J||!K||K.path){if(K&&K.path){I.set("path",K.path);}return ;}window.clearTimeout(this.pathTmr);this.pathTmr=window.setTimeout(function(){var L=J.path||J.getAttribute("path");if(L){I.set("path",K.path);return ;}mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(M){var N=H(M.toString())||"";K.path=N;I.set("path",N);}},{taskId:"getObjectDetails",objectID:K.did,objectType:K.t},undefined);},200);};var H=function(K){var N;if(window.DOMParser){N=(new DOMParser()).parseFromString(K,"text/xml");}else{N=new ActiveXObject("Microsoft.XMLDOM");N.async="false";N.loadXML(K);}var P=N.getElementsByTagName("path")[0],L=P.childNodes,O="";if(L){for(var J=0,I=L.length;J<I;J++){var M=L[J].childNodes&&L[J].childNodes[0];if(M){O+=mstrmojo.string.escape4HTMLText(M.nodeValue)+(J<I-1?"> ":"");}}}return O;};mstrmojo.LegacySuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,null,{scriptClass:"mstrmojo.LegacySuggestionList",useRichTooltip:false,itemDescField:"desc",getItemMarkup:function(K,I){var J=this.parent.opener,L=this.useRichTooltip?"":this.buildTooltip(K);return'<div class="mstrmojo-suggest-text '+((J&&J.item2textCss(K))||"")+'" idx="'+I+'" title="'+L+'">'+J.getHighlightedText(J.getSearchPattern(),mstrmojo.string.escape4HTMLText(K[this.itemField]))+"</div>";},getItemProps:function E(){return{};},onmouseover:function(J){var M=this.parent.opener;if(M&&M.showPath){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),I=K.getAttribute("idx"),L=I!=null?this.items[I]:null;if(L&&L.t>-1){this.targetEl=K;this.targetItem=L;this.requestPath(K,L);}}},requestPath:function D(I,K){var J=this.parent.opener;if(K.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function&&J.showFunctionSyntaxAsPath){this.buildFunctionSyntax(K);}else{A(this,I,K);}},buildFunctionSyntax:function G(J){var K=J.path;if(!K&&J.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){var I=function I(P){if(P.did<0){return P.n;}var O=P.pars,M=[],N,L;M.push(P.n);if(O){M.push("(");for(N=0,L=O.length;N<L;N++){M.push(O[N].n);if(N!==(L-1)){M.push(", ");}}M.push(")");}return M.join("");};J.path=I(J);}this.set("path",{path:J.path,excludeSelf:true});},buildTooltip:function B(I,J){return C(this,I,J);},onpathChange:function F(){var I=this.targetEl;I.path=1;var J=this.buildTooltip(this.targetItem,this.path.excludeSelf);if(this.useRichTooltip){this.useRichTooltip=true;this.hasOpenTooltip=false;if(!I.ttp){I.ttp=J;this.showTooltip();}}else{I.title=J;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBoxBase","mstrmojo._HasScrollbox");mstrmojo.ListBox=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.ListBox",renderAllItems:false,renderPause:10,numPagesRendered:0,pageStatus:null,_rc:null,_totalPages:null,_rh:null,_rhMin:8,_rowsPerPage:null,_defaultRowsPerPage:100,_minRowsPerPage:100,_pageHeight:null,buildRendering:function K(){if(this.renderAllItems===true){this._super();return true;}this._initPageSettings();var L=this.items;this.items=this._rc?this.items.slice(0,Math.min(this._rowsPerPage,this._rc)):[];this._super();this.items=L;this.postRenderPage(0,true);if(this._rc>this._rowsPerPage){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]=(this._rh*this._rc)+"px";if(!this.connectedScrollbox){this.connectScrollbox(this);this.connectedScrollbox=true;}}else{this.postRenderingCleanup();}},_initPageSettings:function E(){var L=this.items;this._rc=(L&&L.length)||0;var N=this.itemRenderer;this._rh=(N&&N.rowHeight)||this._rhMin||3;var M=this._defaultRowsPerPage;if(!isNaN(this.scrollboxHeight)){M=Math.ceil(this.scrollboxHeight/this._rh);M=Math.max(M,this._minRowsPerPage);}this._rowsPerPage=M;this._totalPages=Math.ceil(this._rc/this._rowsPerPage);this._pageHeight=this._rh*this._rowsPerPage;this._pageStatus=new Array(this._totalPages);this._numPagesRendered=0;},onscroll:function J(){if(!this._renderingRows){this._startPageRenderThread();}},_startPageRenderThread:function F(){this.renderingRows=true;var M=this,L=this._renderTimer=self.setInterval(function(){if(!M){self.clearInterval(L);return ;}var N=M.getPagesToRender();if(N.length>0){M.renderPages(N);}else{M.renderingRows=false;self.clearInterval(M._renderTimer);delete M._renderTimer;if(M.isRenderingComplete()){M.postRenderingCleanup();}M=null;}},this.renderPause);},getPagesToRender:function I(){var P=[],a=this._pageHeight,c=null,X=this._pageStatus,Z=this;function R(d){var e=X[d];if(e&&e.filled){if(!e.height){if(!c){c=Z.itemsNode.tBodies;}e.height=c[d].offsetHeight;}return e.height;}else{return a;}}var b=0,S=null,O=null,M=this.scrollboxTop;for(var W=0,Y=this._totalPages;W<Y;W++){b+=R(W);if(b>=M){S=W;break;}}if(S==null){S=O=Y-1;}else{var L=this.scrollboxBottom;for(var U=S+1;U<Y;U++){if(b>=L){O=U-1;break;}b+=R(U);}}if(O==null){O=Y-1;}for(var N=this._numPagesRendered;N<S;++N){P.push({idx:N,fill:false});}for(var Q=S;Q<=O;++Q){var V=X[Q];if(!V||!V.filled){P.push({idx:Q,fill:true});}}return P;},renderPages:function D(M){for(var N=0,L=M.length;N<L;++N){this.renderPage(M[N].idx,M[N].fill);}},renderPage:function B(R,M){var W=this._pageStatus,P=(this._numPagesRendered>=R+1);if(P){if(!M||(W[R]&&W[R].filled)){return ;}}var V=this._rowsPerPage,L=R*V,N=Math.min(L+V,this._rc)-1;var U=this.tempTableCont;if(!U){U=this.tempTableCont=this.domNode.ownerDocument.createElement("div");}var Q=M?this._buildItemsMarkup(L,N,'<table><tbody idx="'+R+'">',"</tbody></table>",this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join(""):'<table><tbody idx="'+R+'"><tr><td style="height:'+this._pageHeight+'px">&nbsp;</td></tr></tbody></table>';U.innerHTML=Q;var O=U.firstChild.tBodies[0],S=this.itemsNode;if(!P){S.appendChild(O);}else{S.replaceChild(O,S.tBodies[R]);}this.postRenderPage(R,M);},postRenderPage:function G(M,O){if(M+1>this._numPagesRendered){this._numPagesRendered=M+1;}var L=this._pageStatus,N=L[M];if(!N){N=L[M]={};}if(O){N.filled=true;}if(M>0&&M==this._totalPages-1){this.itemsContainerNode.style[mstrmojo.css.MINHEIGHT]="";}},isRenderingComplete:function C(){if(this._numPagesRendered==this._totalPages){for(var L=this._pageStatus,M=this._totalPages-1;M>-1;M--){if(!L[M]||!L[M].filled){return false;}}return true;}return false;},postRenderingCleanup:function A(){if(this.connectedScrollbox){this.disconnectScrollbox(this);this.connectedScrollbox=false;}},unrender:function(L){this.postRenderingCleanup();this._super(L);},refresh:function H(){if(!this.hasRendered){return ;}var N=this.domNode,L=N&&N.parentNode;if(!this.parent&&L){var M=N.ownerDocument.createElement("span");L.insertBefore(M,N);}this.unrender();if(!this.parent&&L){this.domNode=M;}this.render();if(this.defn&&this.defn.set){this.defn.set("readyState",mstrmojo.EnumReadystate.IDLE);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._ListSelections");mstrmojo.ListBoxHoriz=mstrmojo.declare(mstrmojo.ListBoxBase,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.ListBoxHoriz",cssClass:"mstrmojo-ListBoxHoriz",tableCssClass:"mstrmojo-ListBox-table",tableCssText:"",rowCssClass:"",rowCssText:"",cellCssClass:"",cellCssText:"",cellSpacing:0,cellPadding:0,_markupPrefix:function(){var A=this.itemRenderer;return(A&&A.markupPrefix)||('<table class="'+this.tableCssClass+'" style="'+this.tableCssText+'" cellspacing="'+this.cellSpacing+'" cellpadding="'+this.cellPadding+'"><tbody><tr class="'+this.rowCssClass+'" style="'+this.rowCssText+'">');},_markupSuffix:function(){var A=this.itemRenderer;return(A&&A.markupSuffix)||"</tr></tbody></table>";},_itemPrefix:function(){var A=this.itemRenderer;return(A&&A.itemPrefix)||('<td class="'+this.cellCssClass+'" style="'+this.cellCssText+'">');},_itemSuffix:function(){var A=this.itemRenderer;return(A&&A.itemSuffix)||"</td>";},_getItemNode:function(A){if(A<0){return null;}var B=this.itemsNode,C=B&&B.rows[0];return C&&C.cells[A].firstChild;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Container","mstrmojo._FormatDefinition","mstrmojo.TristateCheckBox","mstrmojo.FieldSet","mstrmojo.Table");var A=mstrmojo.hash,B=mstrmojo._FormatDefinition;mstrmojo.AlignmentFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.AlignmentFormatter",cssClass:"mstrmojo-AlignmentFormatter",markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){A.make(this.model,mstrmojo.Obj);}},children:[{scriptClass:"mstrmojo.FieldSet",alias:"textAlignment",cssClass:"mstrmojo-FormatEditor-textAlignment",legend:mstrmojo.desc(2065),children:[{scriptClass:"mstrmojo.Table",rows:2,cols:2,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3691),slot:"0,0"},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:B.Horizontal,bindings:{m:"this.parent.parent.parent.model",value:"this.m.Horizontal"},onvalueChange:function(){if(this.m&&this.value!=null){this.m.Horizontal=this.value;}},slot:"0,1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3692),slot:"1,0"},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:B.Vertical,bindings:{m:"this.parent.parent.parent.model",value:"this.m.Vertical"},onvalueChange:function(){if(this.m&&this.value!=null){this.m.Vertical=this.value;}},slot:"1,1"}]}]},{scriptClass:"mstrmojo.FieldSet",alias:"textControl",cssClass:"mstrmojo-FormatEditor-textControl",legend:mstrmojo.desc(2884),children:[{alias:"TextWrap",scriptClass:"mstrmojo.TristateCheckBox",text:mstrmojo.desc(2070),checked:false,grayed:false,pr:"TextWrap",bindings:{m:"this.parent.parent.model",checked:function(){return this.m[this.pr]==-1;},grayed:function(){return(typeof this.m[this.pr]=="undefined")||this.m[this.pr]=="pru";}},oncheckedChange:function(C){if(this.m){this.m.set(this.pr,this.checked?-1:0);}}},{scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5159)},{scriptClass:"mstrmojo.Pulldown",itemIdField:"v",items:B.TextDirection,bindings:{m:"this.parent.parent.parent.model",value:"this.m.TextDirection"},onvalueChange:function(){if(this.m&&this.value!=null){this.m.TextDirection=this.value;}},slot:"1,1"}]}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Container","mstrmojo._FormatDefinition","mstrmojo.FieldSet","mstrmojo.Table");var D=mstrmojo.hash,B=mstrmojo.num;var C=function(F){return D.copy(F,{scriptClass:"mstrmojo.ValidationTextBox",maxLength:6,dtp:4,min:0,max:100,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP},bindings:{m:F.modelBinding,value:function(){var G=this.m[this.pr];return G==null?"":this._PT2UserUnits(G).replace(/([\.,][1-9]{1,})0{1,}$/,"$1").replace(/\.$/,".0").replace(/,$/,",0");}},postCreate:function(){this.markupMethods=D.copy({onvalueChange:function(){this.inputNode.value=this.value;}},D.copy(this.markupMethods));},onValid:function(){this.m[this.pr]=this._UserUnits2PT(this.value);},_PT2UserUnits:function(G){return B.toLocaleString(B.convertToLocalUnits(B.toString(G),mstrApp.units));},_UserUnits2PT:function(G){return B.toLocaleString(B.toString(B.convertToUSUnits(G,mstrApp.units)));}});};var A=function(F,G){return{scriptClass:"mstrmojo.Label",text:F,slot:G};};mstrmojo.PaddingFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.PaddingFormatter",cssClass:"mstrmojo-PaddingFormatter",markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){D.make(this.model,mstrmojo.Obj);}},init:function E(F){var G=mstrConfig.unitsLabel||mstrApp.unitsLabel;this.children=[{scriptClass:"mstrmojo.FieldSet",alias:"padding",cssClass:"mstrmojo-FormatEditor-padding",legend:mstrmojo.desc(2883),children:[{scriptClass:"mstrmojo.HBox",cssClass:"paddingBox",children:[{scriptClass:"mstrmojo.Table",rows:2,cols:3,children:[A(mstrmojo.desc(3528),"0,0"),C({pr:"LeftPadding",slot:"0,1",modelBinding:"this.parent.parent.parent.parent.model"}),A(G,"0,2"),A(mstrmojo.desc(3526),"1,0"),C({pr:"TopPadding",slot:"1,1",modelBinding:"this.parent.parent.parent.parent.model"}),A(G,"1,2")]},{scriptClass:"mstrmojo.Table",rows:2,cols:3,children:[A(mstrmojo.desc(3529),"0,0"),C({pr:"RightPadding",slot:"0,1",modelBinding:"this.parent.parent.parent.parent.model"}),A(G,"0,2"),A(mstrmojo.desc(3527),"1,0"),C({pr:"BottomPadding",slot:"1,1",modelBinding:"this.parent.parent.parent.parent.model"}),A(G,"1,2")]}]}]}];this._super(F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocTextfield","mstrmojo.ui._HasScroller");mstrmojo.vi.ui.ScrollableDocTextfield=mstrmojo.declare(mstrmojo.DocTextfield,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.ScrollableDocTextfield",setupScrollNodes:function A(){this.scrollNode=this.valueNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.SearchWidget","mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.elementHelper","mstrmojo.mstr.EnumDSSXMLObjectTypes");var L=mstrmojo.hash,I=mstrmojo.array,a=mstrmojo.css,Y=mstrmojo.elementHelper,b=mstrmojo.mstr.EnumDSSXMLObjectTypes;var W=1,G=2147762227,X=2147762262,F=2147762269;mstrmojo.vi.ui.rw.selectors._CanSearchOnServer=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._CanSearchOnServer",{_mixinName:"mstrmojo.vi.ui.rw.selectors._CanSearchOnServer",searchBlockSize:500,expressionXML:"",browseFlags:1,getSourceDefn:mstrmojo.emptyFn,getDataService:mstrmojo.emptyFn,init:function Q(c){this._super(c);this.clearSearchItems();},execSearchOnServer:function J(h,f,g){var j=this.id,e=this.getDataService(),d=this.getSourceDefn();if(e&&d&&!this.isSearching){var c=d.srct===b.Consolidation;this.set("isSearching",true);e.browseControlElements({searchPattern:h,blockBegin:f,blockCount:g,attributeId:d.srcid,expressionXML:this.expressionXML,dataSourcesXML:d.dsrc,datasetId:d.dsid,controlKey:d.ckey,searchForms:d.fs||d.sfs,browseFlags:this.browseFlags,objectType:d.srct,useClientForm:c},{success:function(m){var n=mstrmojo.all[j],l=m.did||d.srcid;if(m){var k=Y.buildElemsTerseID(m.es,l,true)||[];n.onSearchSuccess(k,{attributeId:l,blockBegin:f,blockCount:g,size:m.sz});}},failure:function(l){var m=mstrmojo.all[j],k=parseInt(l.code,10)+4294967296;if(k!==G&&k!==X&&k!==F){mstrmojo.alert(l.message);}m.onSearchFailure();},complete:function(){var k=mstrmojo.all[j];k.set("isSearching",false);}},{hideFailureErr:true});}},onSearchSuccess:function K(d,e){var c=this.loadItems,f=c.length;this.loadItems=c.concat(d);this.loadCompleted=f+d.length>=e.size;this.renderFilteredItems(f);},onSearchFailure:function R(){this.loadCompleted=true;this.renderFilteredItems();},renderFilteredItems:function M(g){var e=this.loadItems,c=this.itemsContainerNode;if(e&&c){var d=this.items,f;this.items=e;f=this._buildItemsMarkup(g||0,e.length-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");this.items=d;c.innerHTML=(g>0?c.innerHTML:"")+f;}if(this.updateScrollbars){this.updateScrollbars();}},renderOriginalItems:function A(){var d=this.itemsContainerNode,c=this.renderOnScroll?(this.renderIndex+1)*this.renderBlockSize:this.items.length;if(c){d.innerHTML=this._buildItemsMarkup(0,c-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}if(this.updateScrollbars){this.updateScrollbars();}},onScrollEnd:function B(){var e=this.pattern,d=this.scrollNode,c=this.loadItems.length;if(d&&this.isOnSearch()){if(d.offsetHeight+Math.ceil(d.scrollTop)>=d.scrollHeight&&!this.loadCompleted){this.execSearchOnServer(e,c+W,this.searchBlockSize);}}if(this._super){this._super();}},_set_pattern:function C(e,c){var d=this.pattern=c;this.clearSearchItems();if(d.length>0){this.execSearchOnServer(d,W,this.searchBlockSize);}else{this.renderOriginalItems();}return true;},onisSearchingChange:function O(c){var e=c.value,d=this.searchbox;if(d){var f=d.inputNode,g=d.clearNode;if(f){f.disabled=e;}if(g){a.toggleClass(g,"show",!e);}}},getSearchbarCfg:function N(){return{scriptClass:"SearchWidget",placeholder:this.searchboxNode,onsearch:function d(e){this.parent.set("pattern",e);},onclear:function c(){this.parent.set("pattern","");}};},postBuildRendering:function V(){var c=this.getSearchbarCfg(),f=c.placeholder,d=this.searchbox,e=L.walk(c.scriptClass,mstrmojo);if(f){if(!d){delete c.scriptClass;c.parent=this;d=new e(c);this.searchbox=d;}d.placeholder=f;d.render();}if(this.isOnSearch()){d.setSearchPattern(this.pattern);this.renderFilteredItems();}return this._super();},unrender:function U(d){var c=this.searchbox;if(c){c.unrender(d);}return this._super(d);},getItemFromTarget:function Z(e){if(this._super){if(this.isOnSearch()){var d=this.items,c;this.items=this.loadItems;c=this._super(e);this.items=d;return c;}return this._super(e);}return undefined;},isOnSearch:function H(){return this.pattern&&this.pattern.length>0;},getSearchItems:function E(){return this.loadItems;},updateSearchItems:function D(c){if(I.isArray(c)){this.loadItems=c;}},clearSearch:function S(){this.pattern="";this.clearSearchItems();},clearSearchItems:function P(){this.loadItems=[];this.loadCompleted=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Popup","mstrmojo.css");var B=mstrmojo.Widget,A="14px";mstrmojo.vi.ui.rw.VizDropCue=mstrmojo.declare(mstrmojo.Popup,null,{scriptClass:"mstrmojo.vi.ui.rw.VizDropCue",markupString:'<div id="{@id}" class="mstrmojo-VizDropCue {@cssClass}"><div class="mstrmojo-VizDropCue-line"><div></div></div><div class="mstrmojo-VizDropCue-tooltip"><div class="mstrmojo-Tooltip vi-regular vi-tooltip-V V-center"><div class="mstrmojo-Tooltip-contentWrapper"><div class="mstrmojo-Tooltip-content"></div></div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},tooltipNode:function(){return this.domNode.lastChild;}},markupMethods:{ontopChange:B.topMarkupMethod,onleftChange:B.leftMarkupMethod,onheightChange:B.heightMarkupMethod,onwidthChange:B.widthMarkupMethod,onvisibleChange:B.visibleMarkupMethod,oncueConfigChange:function(){var C=this.cueConfig;this.set("visible",!!C);if(!C){return ;}var G=C.or==="v";mstrmojo.css.toggleClass(this.domNode,"v",G);this.set("top",C.top);this.set("left",C.left);var D=C.size;this.set("height",G?D:A);this.set("width",G?A:D);var F=C.tip,E=this.tooltipNode;E.firstChild.firstChild.firstChild.innerHTML=F||"";E.style.display=F?"block":"none";}},cueConfig:null});mstrmojo.vi.ui.rw.VizDropCue.CueConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Popup","mstrmojo.dom");var B=mstrmojo.dom;var A="openXtabCellMenu";mstrmojo.XtabCellHoverPopup={cssClass:"mstrXtabCellHoverPopup",scriptClass:"mstrmojo.Popup",slot:"overlayNode",autoCloses:true,children:[{scriptClass:"mstrmojo.Button",alias:"btn",onmousedown:function(D){this.openPopup(true,D);B.stopPropogation(D.hWin,D.e);B.preventDefault(D.hWin,D.e);return false;},openPopup:function(F,D){var E=this.xtab[A]?this.xtab:mstrmojo.findAncestor(this.xtab,A);if(E){E.openXtabCellMenu({xtab:this.xtab,td:this.td,btn:this,cmPos:this.cmPos,lockIW:this.xtab,singleCellClick:F===true,evt:D});}this.domNode.oncontextmenu=function(G){B.stopPropogation(window,G);B.preventDefault(window,G);return false;};},closePopup:function(){var D=mstrmojo.findAncestor(this.xtab,A);if(D){D.closePopup();}}}],updatePopupConfig:function C(F){var G=F&&F.td,O=F&&F.xtab,D=this.btn;var H=this._lastTd;if(H!==G){D.closePopup();this._lastTd=G;}D.xtab=O;D.td=G;D.cmPos=F&&F.cmPos;if(!G||!O){return ;}var I=B.findAncestorByName(G.parentNode,"table",false,O.viewport),K=O.zones,N="",E;if(I){for(E in K){var L=K[E];if(L&&L.tableNode===I){N=L.slot;break;}}}var M=mstrmojo.boxmodel.offset(G,O.overlayNode),J=23;this.set("location",{left:0,top:M.top,width:Math.min(G.offsetWidth+M.left,O._pl),height:J});},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onlocationChange:function(){var D=this.location;if(!D){return ;}var E=this.domNode.style;E.left=(D.left+Math.max(D.width-20,0))+"px";E.top=D.top+(D.height?Math.round(D.height/2)-7:0)+"px";}}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.EnumRWUnitType","mstrmojo.models.FormatModel","mstrmojo.DocDataService","mstrmojo.hash","mstrmojo.vi.viz.EnumWidgetTypes","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.ui.rw.selectors.EnumVizSelectorMode","mstrmojo.css","mstrmojo.vi.ui.rw.selectors.VisSelectorCurtain");mstrmojo.requiresClsP("mstrmojo.vi.models","PanelFormatSaver","EnumPanelTypes","VIComponentMap");var x=mstrmojo,d=x.hash,z=x.array,k=x.vi.models,J=x.vi.ui.rw,K=k.VIComponentMap.TYPES,t=k.EnumPanelTypes,AJ=K.FILTER_STACK,AH=x.models.FormatModel,AK=AH.getFormatUpdate,AE=AH.ENUM_PROPERTY_NAMES,AI=x.EnumRWUnitType,N=x.mstr.EnumWebAPIErrorCodes,AL=t.FILTERS,S=x.DocDataService.UNDO_KEY,B="\u001E",D=x.DocDataService.REQUEST_DEFN_DATA,P=x.DocDataService.SUPPRESS_DATA,w="sections.0.subsections.0",AQ=mstrmojo.vi.viz.EnumVizStyles,AR=mstrmojo.vi.viz.EnumWidgetTypes,F=J.selectors.EnumVizSelectorMode,C=mstrmojo.css;var AM=8,j=80,AO=10;function f(AU){return AU.t!==1&&(AU.t!==47||AU.st===12033);}function AA(AU,AW,AV,AZ,AX){var AY=[];if(!AU){return AY;}AX=AX||{};AU.getFilters().forEach(function(Ac){var Aa=parseInt(Ac.defn.fmts["z-index"],10),Ab=Ac.defn.t===AI.SELECTOR?Ac.ckey:Ac.k;if(Aa>=AW&&(!AV||Aa<=AV)){AY.push(this.getUnitFormatAction(Ac,1,AK(AE.Z_INDEX,Aa+AZ)));AX[Ab]=Ac.id;}},this);return AY;}function Y(){var AU=this.getCurrentLayoutKey();return this.getVIComponent(K.VIZ_CONTENT,AU);}function O(Ag,AY,Ac,AW,Af){var Ab=[],Ah=this.getCtrlStyleFromDatasetUnit(Ag,true),AZ=this.getCurrentLayoutDef().units,Aa=this.getVIPanelKeyFromUnits(AL),AX=d.keyarray(AZ).filter(function(Ai){return AZ[Ai].t===AI.PANEL&&AZ[Ai].isFilterPanel;})[0],Ad=this.getTargetDefn(AX)[AX].fmts,Ae=Ad&&Ad.width,AV=(Ae&&Ae.charAt(Ae.length-1)!=="%")?parseInt(Ae,10):undefined,AU;if(Af===undefined||Af===null){Af=999;}Ab.push(this.getDataService().getAddCtrlAction(AX,Ac,AW,[Aa],f(Ag),Ag.t,Ag.did,AY));if(Ah===1){AU=1;}Ab=Ab.concat(this.getCtrlActionsByStyle(Ag,this.buildKeyContext(Ac,AW),Ah,AU,this.getCtrlHeightByStyle(Ah,Ag.card&&(Ag.card+1)||AM+1),AV,Af,1));return Ab;}function AF(AZ,AX,AW,Af){if(!AX){return ;}var Ab=[],Ad=AX.k,Aa=this.getCurrentLayoutDef().units,Ac=this.getVIPanelKeyFromUnits(AL),AY=d.keyarray(Aa).filter(function(Al){return Aa[Al].t===AI.PANEL&&Aa[Al].isFilterPanel;})[0],Ah=this.getTargetDefn(AY)[AY].fmts,Ak=Ah&&Ah.width,AV=(Ak&&Ak.charAt(Ak.length-1)!=="%")?parseInt(Ak,10):undefined,AU,Ai=this,Ag=Ai.buildKeyContext(AX.k,AW),Ae=Ai.getVIComponent(K.FILTER_PANEL).children,Aj=Ae?Ae.length:0;Ab.push(this.getSetVisAsFilterAction(Ad,AW,[Ac],AZ,Af));Ab=Ab.concat(this.getCtrlActionsByStyleForVisFilter(Ad,Aj));return Ab;}function G(AY,AW,Aa,Ac,Ab,AV){var AZ=this.getVIMap(),Ad=AZ.getComponent(AJ);if(AV&&AV.preInfo){AY.addActions(AV.preInfo.actions);}if(!AW.length){var AX=Ac;Aa.forEach(function(Ah){var Ag=this.getNextKey(),Ai=this.getNextKey(),Af=this.buildKeyContext(Ag,Ai);AW.push(Af);AY.addActions(O.call(this,Ah,[AZ.getComponentKey(K.MAIN_CONTENT)],Ag,Ai,(AX!==null?AX++:null)));},this);var AU=AW.length&&(Ad.getFilters().length-1);AY.addActions(AA.call(this,Ad,Ac,AU,AW.length,Ab));}else{var Ae=this.getDataService();AW.forEach(function(Af){Ae.addMoveControlAction(AY,Af,Ad.contents.k);});AY.addActions(AA.call(this,Ad,Ac,null,AW.length,Ab));}if(AV&&AV.postInfo){AY.addActions(AV.postInfo.actions);}}function u(Aa,AX,AZ,AW){var AV=this.getVIMap(),AU=AV.getComponent(AJ),AY=this.getDataService();AX.forEach(function(Ab){AY.addMoveControlAction(Aa,Ab,S);});Aa.addActions(AA.call(this,AU,AZ+1,undefined,-AX.length,AW));}function H(AX,AZ,Ab,Aa,AY){var Ac=AZ.getDocBuilder().getLayoutVIMap(AZ.getCurrentLayoutKey()).getComponent(AJ),AW=Ac.contents.k,Ae=AZ.getDataService();var AV=Ac.getFilters(),AU={},Ad=0;Ab.forEach(function(Af){AU[Af.ckey]=Af;});AV.forEach(function(Ag){var Ak=parseInt(Ag.defn.fmts["z-index"],10);if(!Ag.ckey){Ag.ckey=Ag.k;}if(!AU[Ag.ckey]){if(Ad!==0){AX.addActions(AZ.getUnitFormatAction(Ag,1,AK(AE.Z_INDEX,Ak-Ad)));Aa[Ag.ckey]=Ag.id;}else{var Aj=Ag.tks?Ag.tks.split(B):[];for(var Af in AU){if(Aj.indexOf(AU[Af].ckey)>=0){Aa[Ag.ckey]=Ag.id;break;}}}}else{var Ah=AU[Ag.ckey],Aj=Ah.tks?Ah.tks.split(B):[],Am=Ah.dsTks?Ah.dsTks.split(B):[],An=Ah.ck,Al=Ae.getRemoveCtrlTargetAction,Ai=Ae.getRemoveCtrlTargetDatasetAction;if(!(Ag instanceof mstrmojo.VisDocSelector)){Aj.forEach(function(Ap){if(AY){AX.addActions(Al.call(Ae,An,Ap,[],true));}else{AX.addActions(Al.call(Ae,An,Ap,Ap));}});}Am.forEach(function(Ap){AX.addActions(Ai.call(Ae,An,Ap));});if(AZ.datasetsSettings.unitOpr(Ah.ttl,"isDeleteWithFilter")){AX.addActions({act:"removeDerivedMetricFromDataset",dsid:AZ.findDatasetIdFromUnit(Ah.srcid),metricId:Ah.srcid});AZ.datasetsSettings.unitOpr(Ah.ttl,"isDeleteWithFilter",false);AZ.datasetsSettings.unitOpr(Ah.ttl,"completeHide",false);AX.addActions(AZ.datasetsSettings.getSaveActions());}var Ao=[AW];if(!AY){Ao=Ao.concat(Aj);}AX.addActions(Ae.getRemoveCtrlAction(Ah.ckey,Ao));Ad=Ad+1;}},this);}function o(AX,AY,AV,Ab,Aa){var AU=Ab.contents.k,Ac=this.getDataService(),AZ=AY.ck,Ad=AY.ckey,AW=AY.tks?AY.tks.split(B):[];Aa[AU]=true;Aa[Ad]=true;AX.addActions(Ac.getReplaceCtrlAction(AZ,Ad,AY.ct,AV.did,AV.t,AW.concat(AU)));}function n(AU,AZ,Ab,Aa,Ai,Ad,Ae){var AY=this,Af=Aa.contents,Ag=Aa.k,AV=AZ.params.params,Am=AV&&JSON.parse(AV).partialRetrieval,AX=Am&&Am.nodes;if(Ad){Ag=AU.pukeys;}else{if(AX){Ag=d.keyarray(Ai||{}).concat(AX).join(B);}}AY.partialUpdate(AU.data,AY.getTargetDefn(Ag),AU.defn,d.keyarray(Ai||{}));if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()&&Af.refreshFP){Af.refreshFP();}else{if(Af&&Af.children){Af.rebuildChildren();}}if(!!Ae&&Ae.hasOwnProperty("isVisFilterAdded")&&Ae.isVisFilterAdded){var Ah=this.getVIComponent(K.FILTER_PANEL),Ac=Ah.children,Aj=Ac.length,Ak=Ac[Aj-1].domNode,AW=Aa.scrollNode;AW.scrollTop=AW.scrollHeight-AW.clientHeight;C.addClass(Ak,["visSelector-Animation"]);C.onAnimationEnd(Ak,function(){C.removeClass(Ak,["visSelector-Animation"]);});}Aa.getFilterDefinitions().forEach(function(Ao){if(!Ao.sfs){var An=[],Ap=AY.getDatasetUnits(["att","mx"],function(Aq){return Aq.did===Ao.srcid;})[0]||{};(Ap.fs||[]).forEach(function(Aq){An.push({did:Aq.fid});});if(An.length){Ao.sfs=An;}}});var Al=Aa.parent&&Aa.parent.tabList;if(Al){Al.singleSelect(z.find(Al.items,"id","vi_flt"));}}function s(AZ,AU,AX,AW,AY){var AV=this;if(mstrmojo.array.find(AZ.actions,"act","removeDerivedMetricFromDataset")>=0){AZ.addCallbacks(AV.getDatasetsUpdateCallback());}if(AY&&AY.preInfo){AZ.addCallbacks(AY.preInfo.callback);}AZ.addCallbacks({success:function(Aa,Ab){n.call(AV,Aa,Ab,AZ,AU,AX,AW,AY);},failure:function(Aa,Ac){var Ab=null;if(Aa.code==N.DFC_QRYENG_RES_TRUNC){Ab=function(){AV.controller.undo();};}mstrmojo.error({longDesc:Aa.message},Ab,{title:"Error"});}});if(AY&&AY.postInfo){AZ.addCallbacks(AY.postInfo.callback);}}function I(AZ){var Aa=this,Ac,Ab=Aa.getCurrentLayoutKey(),AU=Aa.getNodeDataByKey(AZ),AY=Aa.createNewUnitNode(function(){return AU.data;},function(){return AU.defn;},function(){return AU;},AZ,Ab),AV=Aa.getWidgetId({k:AZ,wid:1},Ab),AW;AY.defn.iifp=false;if(mstrmojo.all[AY.id]){var AX=Aa.dataCache[Ab];AY.id=Aa.adjustNodeId(AV);AX[AY.id]=AX[AV];AW=mstrmojo.all[AV].parent;}Ac=Aa.createUnit(AY,"",Ab);Ac.showTitleBar=false;AY.defn.iifp=true;Ac.boxContent.srcFilterPortlet=AW;return Ac;}function h(AW){var AV=this.getCurrentLayoutKey(),AU=this.getVIComponent(AW,AV);return AU.domNode.getBoundingClientRect();}function A(AU,AX,AW){var AV=this;AX.addCallbacks({success:function(AY,Aa){var AZ=AY,Ab;AV.cachePrevSelectedUnitId();AV.updateDefnCache(AZ.defn,[AW]);AV.updateDataCache(AZ.data,AV.getTargetDefn(AW));Ab=AV.insertVizBox(AW,AU,{});AV.controller.rootCtrl.initPanelStautsInConfigMode();AV.selectVIUnit(Ab.id,true,{isAddAction:true});mstrApp.restoreVFKey=AW;mstrApp.isEnableSaveBtn=false;},failure:function(AY){var AZ=null;if(AY.code===N.DFC_QRYENG_RES_TRUNC){AZ=function(){AV.controller.undo();};}mstrmojo.error({longDesc:AY.message},AZ,{title:"Error"});}});}function M(AY,Ad,AW,AV,AX,Ab,Ac,AU){if(!AW){return ;}var Aa=this,AZ=AW.k;AY.addCallbacks({success:function(Ae,Af){Aa.updateVisSelector(AW,AV,AX,Ab);Aa.updateDefnCache(Ae.defn,[AZ]);Aa.updateDataCache(Ae.data,Aa.getTargetDefn(AZ));Aa.destroyVisualiztionselector();Aa.controller.rootCtrl.restorePanelStatus(Ad);n.call(Aa,Ae,Af,AY,Ad,Ac,AU,{isVisFilterAdded:true});}});}function X(Aa,AU,AZ,AY,AX){if(!AZ){return ;}var AW=this,AV=AZ.k;Aa.addCallbacks({success:function(Ab,Ac){AW.updateDefnCache(Ab.defn,[AV]);AW.updateDataCache(Ab.data,AW.getTargetDefn(AV));n.call(AW,Ab,Ac,Aa,AU,AY,AX);}});}mstrmojo.vi.models._FilterStackActions=mstrmojo.provide("mstrmojo.vi.models._FilterStackActions",{_mixinName:"mstrmojo.vi.models._FilterStackActions",addFilterStackSelectors:function E(Ab,Af,AV,AU){var Ae=this.getDataService(),AZ=this,Aa=this.getVIMap(),Ad=Aa.getComponent(AJ),AX=[],Ac=Af!==undefined?Af:(Ad?Ad.getFilters().length:null),AY=AZ.getDataService();var AW=function(){var Ag=(!Ad||z.find(Ad.getFilterDefinitions(),"srcid",Ab[0]&&Ab[0].did)===-1);if(Ag){AU=AU||!!Ab.filter(function(Ah){return !f(Ah);}).length;AZ.execute({execute:function(){var Ak=Ae.newUpdate(this,{extras:D}),Aj={},Ai=Ad.contents;Ak.extras.skipUICmdMgrOnFailure=[N.DFC_QRYENG_RES_TRUNC];Ak.extras.config={hideFailureErr:true};Aj[Ai.k]=true;G.call(AZ,Ak,AX,Ab,Ac,Aj,AV);s.call(AZ,Ak,Ad,Aj,AU,AV);var Ah=Ac===null?this.mgr.CMD_PHASE.FIRST:this.mgr.CMD_PHASE.LAST;this.submitUpdate(Ak,Ah);}});}};if(!Ad){AY.submitUpdates(AZ.getShowVIStackAction(AL),{success:function(Ag,Ah){AZ.buildLoadedVIStack(AL,w,Ag,AZ.getDocBuilder());AZ.controller.view.openViPanel("filterPanel",{success:AW});Ad=AZ.getVIMap().getComponent(AJ);}},{preserveUndo:true});}else{if(Ad.getOpenStatus()){AW();}else{AZ.controller.view.openViPanel("filterPanel",{success:AW});}}},pivotFilterStackSelector:function g(AW,AU,Ac){var Ab=this.getDataService(),Aa=AW.id,AZ=this.getVIMap().getComponent(AJ),AX=this,AV=AU<Ac;function AY(){var Ai=Ab.newUpdate(this,{extras:D}),Ae={},Ad=this.getStateValue(AU,Ac),Ah=this.getStateValue(Ac,AU),Ag=this.getStateValue(AV,!AV),Af;AW=mstrmojo.all[Aa];Af=AW.defn.t===AI.SELECTOR?AW.ckey:AW.k;Ai.addActions(AA.call(AX,AZ,Ah,Ad+(Ag?1:-1),Ag?-1:1,Ae));Ai.addActions(AX.getUnitFormatAction(AW,1,AK(AE.Z_INDEX,Ah)));Ae[Af]=Aa;s.call(AX,Ai,AZ,Ae);this.urInfo=this.urInfo||{};this.urInfo.callback=Ai.callback;Ai.submit();}this.execute({execute:AY});},deleteVisFilterStackSelectors:function R(AU,AV){var Ad=this.getDataService(),Ac=this.getVIMap().getComponent(AJ),AW=this,AX=Ac.model.getDataService().newUpdate(Ac),Aa=[AU.defn],Ab=AW.getRemoveUnitAction(AU),AZ=AU.node.data.sc;if(AZ){AU.ckey=AU.defn.ckey=AZ.ckey;AU.defn.tks=AZ.tks;AU.defn.ck=AZ.ck;}if(Ac.applyBufferedSlices){Ac.applyBufferedSlices(true,AX);}function AY(){var Ag=Ad.newUpdate(this,{extras:D}),Ae={};Ae[Ac.contents.k]=true;H.call(this,Ag,AW,Aa,Ae,AV);s.call(AW,Ag,Ac,Ae);this.urInfo=this.urInfo||{};this.urInfo.callback=Ag.callback;var Af=(AX.actions||[]).concat(Ag.actions);Af.push(Ab);this.submit(Af,Ag.callback,Ag.extras);}this.execute({execute:AY});},deleteFilterStackSelectors:function c(Aa,AV){var AZ=this.getDataService(),AU=this.getVIMap().getComponent(AJ),AX=this,AW=AU.model.getDataService().newUpdate(AU);if(AU.applyBufferedSlices){AU.applyBufferedSlices(true,AW);}function AY(){var Ad=AZ.newUpdate(this,{extras:D}),Ab={};Ab[AU.contents.k]=true;H.call(this,Ad,AX,Aa,Ab,AV);s.call(AX,Ad,AU,Ab);this.urInfo=this.urInfo||{};this.urInfo.callback=Ad.callback;var Ac=(AW.actions||[]).concat(Ad.actions);this.submit(Ac,Ad.callback,Ad.extras);}this.execute({execute:AY});},changeFilterStackSelectors:function v(Aa,AX){var Ab=this.getDataService(),AW=this,AV=this.getVIMap(),AU=AV.getComponent(AJ),AZ=!!Aa.filter(function(Ac){return !f(Ac);}).length,AY=[];this.execute({execute:function(){var Ad=Ab.newUpdate(this,{extras:D}),Ac={};Ac[AU.contents.k]=true;H.call(this,Ad,AW,AX,Ac);G.call(AW,Ad,AY,Aa,AU.getFilters().length+1,Ac);s.call(AW,Ad,AU,Ac,AZ);if(AX.length&&Aa.length){this.submitUpdate(Ad,this.mgr.CMD_PHASE.FIRST);}else{this.submitUpdate(Ad);}}});},replaceFilterStackSelectors:function e(AY,AX){var AZ=this.getDataService(),AU=this.getVIMap().getComponent(AJ),AW=this,AV=AZ.newUpdate(AU);if(AU.applyBufferedSlices){AU.applyBufferedSlices(true,AV);}this.execute({execute:function(){var Ac=AZ.newUpdate(this,{extras:D}),Aa={};o.call(AW,Ac,AY,AX,AU,Aa);s.call(AW,Ac,AU,Aa);this.urInfo=this.urInfo||{};this.urInfo.callback=Ac.callback;var Ab=(AV.actions||[]).concat(Ac.actions);this.submit(Ab,Ac.callback,Ac.extras);}});},buildVisFilterContainer:function Q(AZ,AY){var AX=this,AW=AX.createNewUnitNode(null,function(Aa){Aa.t=AI.PANEL;return Aa;},null,null,AY),AV=AZ.builder,AU;AU=AV.build([AW],AX,{pk:AZ.k})[0];return AU;},getPanelStackForVFContainer:function W(){return Y.call(this);},addVisFilterContainer:function b(){var AV=this,AX=AV.getCurrentLayoutKey(),AW=AV.getPanelStackForVFContainer(),AU=this.buildVisFilterContainer(AW,AX);AW.selectedVisFilterContainerKey=AU.k;AW.addChildren(AU);AU.render();C.addClass(AU.domNode,["vis-filter-container"]);AW.prevSelectedKey=AW.selectedKey;AW.set("selectedKey",AU.k);return AU;},removeVizFilterUnit:function U(AZ){var AW=this,Ab=AW.getDataService(),AY=AW.getSelectedViUnit(),AV=AY.k,AX=AW.getRemoveUnitAction(AY),Aa=AW.getCurrentLayoutDef().units,AU=this.getVIMap().getComponent(AJ);this.execute({execute:function(){var Ag=Ab.newUpdate(AW,{extras:D}),Ac=AW.getSelectedViUnit().boxContent.id,Ae={},Ad=AU.contents,Af=mstrmojo.all[Ac];Ae[Ad.k]=true;Ag.addActions(mstrmojo.array.ensureArray(AX));Aa[AV]._isDeleted=true;if(AZ===true){X.call(AW,Ag,AU,Af,Ae);}this.submitUpdate(Ag);}});},destroyVisualiztionselector:function Z(AY,AZ,AW){AY=AY||this.getSelectedViUnit();var AU=AY.boxContent,AX=AU.node,AV=this.getVisFilterContainer();AY.boxContent.srcFilterPortlet=null;if(AV&&AY.parent===AV){AV.removeAndDestroyChild(AY);}else{AY.destroy();}if(!AW){mstrApp.isInVFConfigMode=false;this.removeVisFilterContainer();}if(!AZ){this.selectVIUnit(this.oldSelectedVizBoxId,true);}AX.id=this.restoreNodeId(AX.id);AU.clearHighlightsCache();},getVisFilterContainer:function AG(){var AW=this,AV=AW.getCurrentLayoutKey(),AU=AW.getPanelStackForVFContainer().selectedVisFilterContainerKey,AX=AW.getWidgetId({k:AU,wid:1},AV);return mstrmojo.all[AX];},removeVisFilterContainer:function AS(){var AV=this,AU=this.getVisFilterContainer(),AW;if(AU){AW=AV.getPanelStackForVFContainer();AW.set("selectedKey",AW.prevSelectedKey);AW.removeAndDestroyChild(AU);AW.selectedVisFilterContainerKey=null;AW.prevSelectedKey=null;}},rebuildVizBox:function l(AU){this.destroyVisualiztionselector("",true,true);return this.insertVizBox(AU,this.getVisFilterContainer(),{});},doVisFilterLayout:function AT(AY,AV){var AW=this.getPanelStackForVFContainer(),AU=AV.hasOwnProperty("width")?AV.width:parseInt(AW.width)-AO,AX=AV.hasOwnProperty("height")?AV.height:parseInt(AW.height)-AO;AY.updateLayout({height:AX+"px",left:"0px",top:"0px",width:AU+"px"});},insertVizBox:function a(AW,AU,AV){var AX=I.call(this,AW);AU.addChildren([AX]);AU.domNode.style.width=AX.domNode.style.width;return AX;},addVisualizationSelector:function V(AU,AY,AX){var AV=this,AW=AV.getDataService(),Aa=AV.getCurrentLayoutDef().units,AZ=d.keyarray(Aa).filter(function(Ab){return Aa[Ab].t===AI.PANEL&&Aa[Ab].isFilterPanel;})[0];mstrApp.isInVFConfigMode=AY===F.CONFIGURATION;mstrApp.isInVFInteractMode=AY===F.INTERACTIVE;this.execute({execute:function(){var Ac=AW.newUpdate(this,{extras:D}),Ab=AV.getNextKey();Ac.addActions(AV.getAddVisActions(AZ,Ab,{style:AQ.GRAPH_MATRIX,type:AR.GRAPH_MATRIX,extraFormatting:{FormattingAppearance:{Visible:1,Name:AX},FormattingView:{Title:AX}}}));A.call(AV,AU,Ac,Ab);this.submitUpdate(Ac);}});},saveVisSelectorAndExit:function r(){var AU=this.getVIMap();this.destroyVisualiztionselector();this.controller.rootCtrl.restorePanelStatus(AU.getComponent(AJ));},saveVisAsSelector:function AN(){var AW=this,AX=AW.getDataService(),AV=AW.getVIMap(),AU=AV.getComponent(AJ);this.execute({execute:function(){var Af=AX.newUpdate(AW,{extras:D}),Ae=AW.getNextKey(),Ad=[AV.getComponentKey(K.MAIN_CONTENT)],Aa=[],AY=AW.getSelectedViUnit().boxContent.id,Ab={},AZ=AU.contents,Ac=mstrmojo.all[AY];Ab[AZ.k]=true;z.forEach(Ad,function(){Aa.push([AW.getNextKey(),true]);});Af.addActions(AF.call(AW,Ad,Ac,Ae,Aa));M.call(AW,Af,AU,Ac,Ae,Ad,Aa,Ab);this.submitUpdate(Af);}});},getMainPanelFormatting:function AP(){return h.call(this,K.MAIN_CONTENT);},getFilterPanelFormatting:function m(){return h.call(this,K.FILTER_STACK);},getVizBox:function AC(AV,AU){var AW=I.call(this,AV);this.doVisFilterLayout(AW,AU);return AW;},cachePrevSelectedUnitId:function AD(){var AU=this.getSelectedViUnit();if(AU){this.oldSelectedVizBoxId=AU.id;}},insertVisCtrlToolbar:function L(AU,AV){var AW=new mstrmojo.vi.ui.rw.VisFilterControlToolbar(AV);AW.render();AU.domNode.appendChild(AW.domNode);return AW;},loadHiddenFilterStack:function p(AU,AV){this.loadHiddenVIStack(AL,w,AU,AV);},getNextVisFilterTitle:function AB(){var AW=this.getCurrentLayoutDef(),AU=(AW&&AW.units)||{},AV=0;d.forEach(AU,function(AY){var AX=AY&&AY.t;if(AY&&AY.iifp&&(AX===AI.GRID||AX===AI.GRAPH||AX===AI.GRIDGRAPH||AX===AI.VISUALIZATION||AX===AI.MOJOVISUALIZATION)){AV++;}});return mstrmojo.desc(15290,"Visualization Filter ##").replace("##",(AV+1));},checkLargeItemsForVisFilter:function q(AV,AU){var AY=this.getNodeDataByKey(AV),AZ=AY&&AY.data,AX=mstrmojo.vi.models._CheckDataCards,AW=[];if(AZ&&AZ.gts){AW=(AZ.gts.row||[]).concat(AZ.gts.col||[]);}AX.addAttributeNameAndTargetVisForAddUnits(AZ,AW);AX.checkAndWarnLargeItemsForAddUnits(AW,AU,null,false,null,true,null,function(){mstr_profile.log("Cancel Visualization Filter Rendering!");});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo._BindTargetChildren","mstrmojo.TabButton","mstrmojo.TabStripBase");var E=mstrmojo.array;function D(G,F){if(G.autoHide){G.set("visible",F);}}mstrmojo.TabStrip=mstrmojo.declare(mstrmojo.TabStripBase,[mstrmojo._BindTargetChildren],{scriptClass:"mstrmojo.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-TabStrip {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},autoHide:true,tabButtonClass:"TabButton",init:function C(F){if(F&&F.autoHide){F.visible=false;}this._super(F);},addTabButtons:function B(G,N){var J=this.targetProps||{},S=J.childTitle||"n",O=J.childColor||"tbc",R=this.tabButtonClass,K=[],Q=this.target,F=function(){Q.set("selected",this.target);};mstrmojo.requiresCls("mstrmojo."+R);for(var L=0,M=(G&&G.length)||0;L<M;L++){var P=G[L],I=P[S];if(I){var H=mstrmojo.insert({scriptClass:"mstrmojo."+R,title:I,backgroundColor:P[O],target:P,onclick:F});K.push(H);}}if(K.length){D(this,K.length);this.addChildren(K,N);}this.selectionChange();},removeTabButton:function A(G){var F=E.filter(this.children,function(H){return(H.target===G);},{max:1});if(F&&F[0]){D(this,F.length-1);this.removeChildren(F[0]);F[0].destroy();}},clearButtons:function(){var F=E.map(this.children,function(G){return G.id;});this.removeChildren();E.forEach(F,function(G){if(mstrmojo.all[G]){mstrmojo.all[G].destroy();}});}});})();(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.tooltip");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.hash,H=mstrmojo.array,C=mstrmojo.tooltip;mstrmojo.ui._HasListTooltip=mstrmojo.provide("mstrmojo.ui._HasListTooltip",{_mixinName:"mstrmojo.ui._HasListTooltip",tooltipOrientation:"horizontal",tooltipOffset:8,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipCss:{},tooltipContrast:false,getTooltipText:function A(I){return I&&(D.encodeHtmlString(I.ttp,true)||D.encodeHtmlString(I.n,true));},showTooltip:function G(a,N){var Q=this;if(!Q.hasOpenTooltip&&!(Q._lastOpened&&Q._lastOpened.visible)){var g=E.eventTarget(N,a),b=Q.getItemFromTarget(g),V=Q.getItemNodeFromTarget(g),j=Q.getTooltipText(b),P=Q.tooltipCss;if(!j||b.ttpDisabled){return ;}if(Q.showTooltipForLargeText){if(V.offsetWidth>=V.scrollWidth){return ;}}var h=E.position(V),Z,R,L,X="",Y=Q.tooltipOffset,O=(b&&b.ctxt)||{};if(this.tooltipOrientation==="vertical"){Z=h.x+h.w/2;L=O.posType||C.POS_TOPCENTER;R=h.y+h.h+Y;var M="mojo-theme-light vi-regular vi-tooltip-A";if(!O.posType){M+=" A-center";}Q.tooltipCss=F.copy({cssClass:M},P);}else{var K=E.windowDim(),W=40,c=h.x+h.w+Y,J=h.x-Y,f=J-W,I=K.w-(c+W),d="vi-regular vi-tooltip-",U;R=h.y;if(I>=f){Z=c;U=I;L=O.posType||C.POS_TOPLEFT;P.cssClass=d+"C "+P.rightCssClass;}else{Z=J;U=f;L=O.posType||C.POS_TOPRIGHT;P.cssClass=d+"D "+P.leftCssClass;}X="max-width: "+U+"px;";}if(Q.tooltipContrast){P.cssClass=P.cssClass+" contrast";}if(P&&P.getItemCssClass){P.cssClass=H.filter([P.cssClass,P.getItemCssClass(b)],function(e){return !!e;}).join(" ");}var S=Q.richTooltip=F.copy(Q.tooltipCss,{content:D.apply(Q.tooltipMarkup,{c:j,style:X}),top:R,left:Z,posType:L});if(Q.itemDisabled){S.cssClass+=" vi-warning";}if(O.hoverable){S.enableHover=true;}if(O.posType==="TL"){S.left=h.x;}S.keepArrowXPos=!!Q.keepArrowXPos;S.keepArrowYPos=!!Q.keepArrowYPos;this._super(a,N);}},onclick:function B(I){var J=this;window.setTimeout(function(){if(J.hasOpenTooltip){J.hideTooltip();}window.clearTimeout(J._tooltipTimeOut);},0);this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.locales","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(11038,11935,11936,11937,11856,11938,13138,13230,13260,14633,14636);var C=mstrmojo.hash.copy,P=mstrmojo.css,J=mstrmojo.dom,N=mstrmojo.array,E=mstrmojo.string,Q=function Q(W,U){if(!W){return ;}var S=U&&U.length||0,V;for(V=S;V>0;V--){W=W.replace(new Array(V+2).join("#"),U[V-1]);}return W;},L=function L(U){if(!U){return ;}var a=this,W=J.position(U.refNode||a.refNode),Z=J.position(a.domNode),Y=U.position||R.RIGHT,V=0,b=0,S=9+(U.margin!==undefined?U.margin:0),X=" ";switch(Y){case R.TOP:b=-Z.h-S;X+="t";break;case R.BOTTOM:b=W.h+S;X+="b";break;case R.LEFT:V=-Z.w-S;X+="l";break;case R.RIGHT:V=W.w+S;X+="r";break;}mstrmojo.hash.forEach(C(U,{left:V,top:b,contentNodeCssClass:X,visible:false}),function(c,d){this[d]=c;},this);this.set("visible",U.invalid);},A=function A(S){var X=this,V,W=S.errorCode,Y=S.errorMsg,U=S.args,Z=mstrmojo.vi.ui.rw.selectors.EnumWarningMessages;if(S.invalid){V={content:W!==null?(X.generateContentHTML(Q(Z[W],U))||Z["*"]):Y};}return V;};mstrmojo.vi.ui.rw.selectors.EnumWarningMessages=C(mstrmojo.locales.validation,{"*":mstrmojo.desc(11038,"Invalid"),invalidValueVIWarning:mstrmojo.desc(11935,"Invalid characters"),emptyValueVIWarning:mstrmojo.desc(11936,"Please enter a number"),notIntegerVIWarning:mstrmojo.desc(11937,"Please enter an integer"),outOfRangeVIWarning:mstrmojo.desc(11856,"Please enter value between ## and ###."),noMultiSelectionVIWaring:mstrmojo.desc(11938,"This selector does not support multiple selections."),continuousSelectionVIWaring:mstrmojo.desc(13138,"This selector does not support non-continuous selections."),bigDecimalMetricSliderVIWaring:mstrmojo.desc(13230,"Cannot qualify on big decimal value. Please change qualification type to Rank"),unableDisplaySelectionVIWarning:mstrmojo.desc(13260,"Filter cannot display actual selections."),imageSizeExceedLimitVIWarning:mstrmojo.desc(14633,"Cannot embed an image larger than ##MB. Your image is still ###MB after compression. Enter a URL to the image instead."),imageFileTypeNotSupportedVIWarning:mstrmojo.desc(14636,"Invalid image format. Please use .png, .jpg, .jpeg, .gif or .bmp."),imageOverSizeNoCompessionVIWarning:mstrmojo.desc(14665,"Cannot embed an image larger than ##MB. Enter a URL to the image instead.")});mstrmojo.vi.ui.rw.selectors.EnumWarningPosition={TOP:1,BOTTOM:2,LEFT:3,RIGHT:4};var R=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition;mstrmojo.vi.ui.rw.selectors._HasWarningMessage=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasWarningMessage",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasWarningMessage",warningSlotName:"warning",showWarning:function G(V){var Z=this,b=Z.warningSlotName,d=Z[b],S=V&&V.lasting||6000,Y=V.refNode||this.domNode,U=V.highlight!==false,c=V.closeOnClick===false?false:true,a;if(!d){d=new mstrmojo.Tooltip({refNode:Y,highlight:U,closeOnClick:c,updatePopupConfig:null,cssClass:"vi-warning vi-tooltip-V"});Z.addDisposable(d);Z[b]=d;a=Z.closeOnClick=Z.getCloseOnClickListener();J.attachEvent(document.body,"click",a);}var X=V.position||R.TOP,W="vi-warning vi-tooltip-";switch(X){case R.TOP:d.cssClass=W+"V";break;case R.BOTTOM:d.cssClass=W+"A";break;case R.LEFT:d.cssClass=W+"D";break;case R.RIGHT:d.cssClass=W+"C";break;}d.open(Z,A.call(Z,V));this.adjustPosition(V);if(U){P.toggleClass(d.refNode,"mstrmojo-Warning",true);}window.clearTimeout(Z._warningTimeOut);Z._warningTimeOut=window.setTimeout(function(){Z.hideWarning();},S);},hideWarning:function H(){var U=this,S=U[U.warningSlotName];if(S&&S.visible&&S.close){if(S.highlight){P.toggleClass(S.refNode,"mstrmojo-Warning",false);}S.close();window.clearTimeout(U._warningTimeOut);delete U._warningTimeOut;}},getCloseOnClickListener:function I(){var S=this;return function(){var U=S[S.warningSlotName];if(U.closeOnClick){S.hideWarning();}};},adjustPosition:function M(S){var U=this;L.call(U[U.warningSlotName],S);},generateContentHTML:function D(S){return E.encodeHtmlString(S,true);},bindWarningHandler:function F(){N.forEach(arguments,function S(V){if(!V||!V.attachEventListener){return ;}var W=V._validationEventListener,U;if(W){V.detachEventListener(W);delete V._validationEventListener;}U=this.getValidationEvtListener();if(U){V._validationEventListener=V.attachEventListener("validationChange",this.id,U);}},this);},getValidationEvtListener:function B(){var U=this;return function S(V){var W=V.value;U[(W&&W.invalid?"show":"hide")+"Warning"](W);};},unrender:function K(S){var U=this[this.warningSlotName];if(U){U.unrender();}this._super(S);},destroy:function O(S){J.detachEvent(document.body,"click",this.closeOnClick);return this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._ListSelections","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var Q=mstrmojo.dom,C=mstrmojo.css,R=mstrmojo.hash,K=mstrmojo.all,d=mstrmojo._HasMarkup,e="px";var D={},J=false,a;function c(){var o={mousedown:["touchstart","mousedown"],mouseup:["touchend","mouseup"],mousemove:["touchmove","mousemove"]},n;for(n in o){D[n]=J?o[n][0]:o[n][1];}}function l(o){if(this.dragging){return ;}this._moveCnt++;if(this._moveCnt>this.mousemoveBuffer){var n=document.body;Q.detachEvent(n,"mousemove",this._mousemoveCallback);Q.detachEvent(n,"mouseup",this._cancelCallback);this.initDrag(o);}}function g(o){if(this.dragging){return ;}this._moveCnt++;if(this._moveCnt>this.mousemoveBuffer){var n=document.body;Q.detachEvent(n,"touchmove",this._touchmoveCallback);Q.detachEvent(n,"touchend",this._cancelCallback);if(a){window.clearTimeout(a);}this.initDrag(o);}}function H(q){var n=document.body,p=J?"_touchmoveCallback":"_mousemoveCallback";Q.detachEvent(n,D.mousemove,this[p]);Q.detachEvent(n,D.mouseup,this._cancelCallback);if(a){window.clearTimeout(a);}var o=this.afterDragCancel;if(o){o.call(this.target,q);}}function G(s){J=true;c();Q.preventDefault(window,s);if(this.dragging){return true;}var p=this.target.id,q=document.body,o=s&&s.touches&&s.touches[0]||s;if(!this._touchmoveCallback){this._touchmoveCallback=function(t){g.call(K[p].dnd,t&&t.touches&&t.touches[0]||t);return true;};}this._moveCnt=0;this.startE=R.copy(o);Q.attachEvent(q,"touchmove",this._touchmoveCallback);if(!this._cancelCallback){this._cancelCallback=function(t){H.call(K[p].dnd,o);return true;};}Q.attachEvent(q,"touchend",this._cancelCallback);var r=this,n=o;n.type=n.name="contextmenu";a=window.setTimeout(function(){var v=r.target,w=v&&v.docSelector,u=w&&w.parent;Q.detachEvent(q,"touchmove",this._touchmoveCallback);Q.detachEvent(q,"touchend",this._cancelCallback);if(u){u.raiseEvent(d.newDomEvent("contextmenu",window,n));}},1000);return false;}function f(p){J=false;c();Q.preventDefault(window,p);if(this.dragging){return true;}var n=this.target.id,o=document.body;if(!this._mousemoveCallback){this._mousemoveCallback=function(q){l.call(K[n].dnd,q);return true;};}this._moveCnt=0;this.startE=R.copy(p);Q.attachEvent(o,"mousemove",this._mousemoveCallback);if(!this._cancelCallback){this._cancelCallback=function(q){H.call(K[n].dnd,q);return true;};}Q.attachEvent(o,"mouseup",this._cancelCallback);return false;}function E(o){var n=this.duringDrag;if(n){n.call(this.target,o);}return true;}function N(p){this.dragging=false;var n=document.body;Q.detachEvent(n,D.mousemove,this._dragCallback);Q.detachEvent(n,D.mouseup,this._dragEndCallback);var o=this.afterDragEnd;if(o){o.call(this.target,p);}return true;}function W(){if(this._mousemoveCallback){Q.detachEvent(document.body,"mousemove",this._mousemoveCallback);delete this._mousemoveCallback;}if(this._touchmoveCallback){Q.detachEvent(document.body,"touchmove",this._touchmoveCallback);delete this._touchmoveCallback;}if(this._cancelCallback){Q.detachEvent(document.body,"mouseup",this._cancelCallback);Q.detachEvent(document.body,"touchup",this._cancelCallback);delete this._cancelCallback;}if(this._dragCallback){Q.detachEvent(document.body,"mousemove",this._dragCallback);Q.detachEvent(document.body,"touchmove",this._dragCallback);delete this._dragCallback;}if(this._dragEndCallback){Q.detachEvent(document.body,"mouseup",this._dragEndCallback);Q.detachEvent(document.body,"touchmove",this._dragEndCallback);delete this._dragEndCallback;}}mstrmojo.DnDComponent=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.DnDComponent",isDragging:false,initD:null,startE:null,afterDragStart:null,duringDrag:null,afterDragEnd:null,target:null,mousemoveBuffer:1,init:function V(n){R.copy(n,this);},initDrag:function k(r){this.dragging=true;var o=this.target.id,q=document.body;var s=this._dragCallback;if(!s){s=this._dragCallback=function(t){if(J){t=t&&t.touches&&t.touches[0]||t;}return E.call(K[o].dnd,t);};}Q.attachEvent(q,D.mousemove,s);var n=this._dragEndCallback;if(!n){n=this._dragEndCallback=function(t){if(J){t=t&&t.touches&&t.touches[0]||t;}return N.call(K[o].dnd,t);};}Q.attachEvent(q,D.mouseup,n);var p=this.afterDragStart;if(p){p.call(this.target,r);}this._dragCallback(r);}});function Z(n){this.getUnit=function o(){var p=n.items.length;return p>1?n._effLen/(p-1):1;};this.calcMinMax=function(r,q){var s=Math.round((r/n.unit+q/n.unit)/2);return{min:s,max:s};};this.preUpdateThumb=function(){n.start=Math.min(n.min*n.unit,n._effLen)+e;n.sdCssText=n.orCfg.posCssP+":"+n.start+";";};this.updateThumb=function(){n.containerNode.style[n.orCfg.posCssP]=n.start=Math.min(Math.round(n.min*n.unit),n._effLen)+e;};return this;}function j(n){this.getUnit=function(){return n._effLen/n.items.length;};this.calcMinMax=function(q,p){return{min:Math.floor(q/n.unit+0.5),max:Math.floor(p/n.unit-0.5)};};function o(){var p=n.min,r=n.unit;var s=n.start=(p*r)+e;var q=n.length=Math.max(Math.round((n.max-p+1)*r-n.gap),0)+e;return{st:s,len:q};}this.preUpdateThumb=function(){var q=n.orCfg,p=o();n.sdCssText=q.posCssP+":"+p.st+";"+q.lenCssP+":"+p.len+";";};this.updateThumb=function(){var q=n.orCfg,p=o(),r=n.containerNode.style;r[q.posCssP]=p.st;r[q.lenCssP]=p.len;};return this;}var F="<span>{@content}</span>";mstrmojo.Slider=mstrmojo.declare(mstrmojo.Container,[mstrmojo._ListSelections],{scriptClass:"mstrmojo.Slider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',sdCssText:"",cssClass:"sc",clsType:"sc2",clsOrientation:"sc-v",orCfg:null,typeHelper:null,_tooltip_pos:"TL",useRichTooltip:true,init:function h(n){this._super(n);if(n.isHoriz){this.orCfg={posCssP:"left",marginCssP:"marginLeft",lenCssP:"width",lenP:"clientWidth",opPosCssP:"top",thickP:"clientHeight",offsetP:"x"};this.clsOrientation=" sc-h";this._tooltip_pos=mstrmojo.tooltip.POS_BOTTOMLEFT;}else{this.orCfg={posCssP:"top",marginCssP:"marginTop",lenCssP:"height",lenP:"clientHeight",opPosCssP:"left",thickP:"clientWidth",offsetP:"y"};this._tooltip_pos=mstrmojo.tooltip.POS_TOPRIGHT;this.titleHeight=(n.docSelector.fmts.ttl&&n.docSelector.fmts.ttl.height)?parseInt(n.docSelector.fmts.ttl.height,10):0;}this._exRoom=this.thumbWidth;if(this.multiSelect){this._exRoom*=2;}if(n.multiSelect){this.typeHelper=new j(this);}else{this.clsType="sc1";this.typeHelper=new Z(this);}},markupSlots:{dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:function(){this.synchronizeSlider();}},start:"50px",length:"30px",min:0,max:0,gap:1,ghost:null,thumbWidth:11,cssBkBW:1,dndNode:null,synchronizeSlider:function I(){var u=this.orCfg,t=u.lenCssP,p=this[t],n=parseInt(p,10),AA=this.hasRendered,x=this.titleHeight||0;var q=this._effLen=isNaN(n)?0:(n-this._exRoom-x);if(p){var z={};z[t]=Math.max(parseInt(p,10)-(2*this.cssBkBW),0)-x+e;var r={};r[t]=q+e;r[u.posCssP]=Math.round(this._exRoom/2)+e;r[u.opPosCssP]="0"+e;if(AA){R.copy(z,this.bgNode.style);R.copy(r,this.sdcNode.style);}else{this.bkCssText=C.getCssTextFromObj(z);this.sdcCssText=C.getCssTextFromObj(r);}}var AC=this.selectedIndices;if(!R.isEmpty(AC)){var w=this.items.length,s=-1,AB=-1,v;for(v=0;v<w;v++){if(AC[v]){if(s<0){s=v;}AB=v;}else{if(s>-1){break;}}}this.min=s;this.max=AB;}var o=this.typeHelper;this.unit=o.getUnit();if(AA){o.updateThumb();}else{o.preUpdateThumb();}},preBuildRendering:function A(){this.synchronizeSlider();},postBuildRendering:function U(){this._super();if(this.items.length>1){var n=this.dnd=new mstrmojo.DnDComponent({target:this});var o=this.id;this.__mouseDownEvt=function(p){Q.stopPropogation(window,p);f.call(K[o].dnd,p);return true;};Q.attachEvent(this.dndNode,"mousedown",this.__mouseDownEvt);if(Q.supportsTouches){this.__touchstartEvt=function(p){Q.stopPropogation(window,p);G.call(K[o].dnd,p);return true;};Q.attachEvent(this.dndNode,"touchstart",this.__touchstartEvt);}n.afterDragStart=this.initDrag;n.duringDrag=this.ondrag;n.afterDragEnd=this.ondrop;n.afterDragCancel=this.cancelDrag;}},initDrag:function k(s,n){n=n||window;var r=this.configureGhost(true),o=this.orCfg,q=this.dnd,p=q.startE;q.initD={tP:parseInt(this.start,10),sL:this._effLen,contL:r.containerNode[o.lenP],offset:Q.getMousePosition(p,n)[o.offsetP],td:Q.eventTarget(n,p)};},configureGhost:function b(o){var q=this.ghost;if(!q){var s=this.containerNode.cloneNode(true),r=s.childNodes;C.addClass(s,"gh");s.style.display="none";q=this.ghost={containerNode:s,frontNode:r[0],thumbNode:r[1],endNode:r[2]};this.sdcNode.appendChild(s);}var p=this.ghost.containerNode.style,n=this.orCfg;R.copyProps([n.posCssP,n.lenCssP],this.containerNode.style,p);if(o){p.display="block";}return q;},ondrag:function O(v,u){u=u||window;var w=this.dnd.initD,r=this.ghost.containerNode,AB,p,n,t=this.min,x=this.max,s=this.orCfg,o=s.lenCssP,AA=s.posCssP;var z=Q.getMousePosition(v,u)[s.offsetP]-w.offset;switch(w.td){case this.thumbNode:AB=Math.max(Math.min(w.tP+z,w.sL-w.contL),0);p=AB+w.contL;r.style[AA]=AB+e;var q=this.typeHelper.calcMinMax(AB,p);t=q.min;x=q.max;break;case this.frontNode:AB=Math.max(Math.min(w.tP+z,w.tP+w.contL),0);n=Math.max(Math.min(w.contL-z,w.tP+w.contL),0);r.style[AA]=AB+e;r.style[o]=n+e;t=Math.min(Math.floor(AB/this.unit+0.5),this.max);break;case this.endNode:n=Math.max(Math.min(w.contL+z,w.sL-w.tP),0);p=w.tP+n;r.style[o]=n+e;x=Math.max(Math.floor(p/this.unit-0.5),this.min);break;default:return ;}if(t!==this.min||x!==this.max){this.min=t;this.max=x;this.typeHelper.updateThumb();}this._updateTooltip();},ondrop:function Y(){this.typeHelper.updateThumb();var r=this.ghost;if(r){r.containerNode.style.display="none";}this.hideTooltip();var s=this.dnd&&this.dnd.initD;if(this.makeSelection&&s){this.makeSelection({selItem:s.td});}var n=this.items;if(n&&n.length){var p=[],o;for(o=this.min;o<=this.max;o++){var q=n[o];if(q){p.push(o);}}this.select(p);}this.dnd.initD=null;},cancelDrag:function M(o,n){if(this.makeSelection){this.makeSelection({selItem:Q.eventTarget(n||window,this.dnd.startE)});}},showTooltip:function m(o,n){this.configureGhost(false);this._updateTooltip(o,n);this._super(o,n);},hideTooltip:function P(o,n){if(this.dnd&&this.dnd.dragging){return ;}this._super(o,n);},_updateTooltip:function S(){var u=this.orCfg,v={contentNodeCssClass:"sc-tooltip",refNode:this.domNode,posType:this._tooltip_pos},o=(this.ghost)?this.ghost.containerNode:this.containerNode;v[u.opPosCssP]=0;v[u.posCssP]=o.style[u.posCssP];v.content="";var s=this.items,q=s.length;if(s&&q){var n=(s[this.min]||s[0]),p=this.getItemTooltip(n),r=p;if(this.min!==this.max){var t=(s[this.max]||s[q-1]);r=mstrmojo.desc(146,"From:")+" '"+p+"' "+mstrmojo.desc(2665,"To:")+" '"+this.getItemTooltip(t)+"'";}v.content=F.replace(/\{@content\}/g,r);}this.set("richTooltip",v);},getItemTooltip:function X(n){var o=n?n.n:"";return"'"+(o.length>20?o.slice(0,20)+"...":o)+"'";},unrender:function B(o){this.ghost=null;this.hideTooltip();this.min=0;this.max=(this.items&&this.items.length-1)||0;var p=this.dndNode,q=this.__mouseDownEvt,n=this.__touchstartEvt;if(q&&p){Q.detachEvent(p,"mousedown",q);}if(n&&p){Q.detachEvent(p,"touchstart",n);}W.call(this);this._super(o);},onselectionChange:function L(){var n=this.selectedIndices,o=R.isEmpty(n);if(n){this.set("max",o?this.items.length-1:R.max(n,false,true));this.set("min",o?0:R.min(n,false,true));if(this.typeHelper){this.typeHelper.updateThumb();}}if(this.onchange){this.onchange();}}});mstrmojo.Slider.SINGLE_HANDLE_WIDTH=11;mstrmojo.Slider.SCROLLHANDLEWIDTH=11;}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.ui._HasScroller","mstrmojo.Box","mstrmojo._HasLayout","mstrmojo._Formattable","mstrmojo.Label","mstrmojo.Button","mstrmojo.dom","mstrmojo.TextBox");mstrmojo.requiresDescs(1442,10493,14552);var F=mstrmojo.string,E=mstrmojo.dom;function D(){var I=this.parent.parent;this.imgURL.onfocus=function(){I.hideLinkButton();};this.imgURL.onblur=function(){I.unhideLinkButton();};}mstrmojo.vi.ui.rw.ImageBoxOverlay=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.rw.ImageBoxOverlay",cssClass:"mstrmojo-ImageBoxOverlay",init:function H(I){if(this._super){this._super(I);}D.call(this);},setupScrollNodes:function B(){this.scrollNode=this.containerNode;},layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"}},formatHandlers:{domNode:["BG"]},hasChanged:function A(){var J=this.imgURL,K=J&&J.domNode,I=K&&K.value;if(K&&(K.scrollWidth>K.clientWidth||!I)){J.set("tooltip",I||(this.parent.parent.isEmbeddedImageFeatureEnabled?mstrmojo.desc(14552,"Enter an image URL or choose a file."):mstrmojo.desc(10493,"Image URL")));}else{J.set("tooltip","");}},imageBox:undefined,imgURL:undefined,origURLStr:undefined,onimgURLChange:function C(){D.call(this);},children:[{scriptClass:"mstrmojo.Label",slot:"labelNode",cssClass:"init-label"},mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){var I=this.parent;if(I.imgURL.value!==I.origURLStr){I.imageBox.urlEdited(I.imgURL.value);}else{I.imageBox.hideControlOverlay();}},true,{alias:"okBtn",slot:"buttonNode",enabled:false}),{scriptClass:"mstrmojo.TextBox",cssClass:"init-input",alias:"imgURL",slot:"textNode",bindings:{hint:function(){if(this.parent.parent.parent.isEmbeddedImageFeatureEnabled){return mstrmojo.desc(14552,"Enter an image URL or choose a file.");}else{return mstrmojo.desc(10493,"Image URL");}}},onkeydown:function(I){if(I.e.keyCode===13){var J=this.parent;if(J.imgURL.value!==J.origURLStr){J.imageBox.urlEdited(this.value);}else{J.imageBox.hideControlOverlay();}}},onmousedown:function(I){E.stopPropogation(I.hWin,I.e);},onblur:function(I){this.parent.hasChanged();},getLayoutOffsets:function G(){return{h:0,w:2};},_set_value:function(L,I){var J=this.value;if(J!==I){this.value=I;var K=this.parent.okBtn;K.set("enabled",!F.isEmpty(I));}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.TextBox");var A=mstrmojo.css,C=mstrmojo.dom;mstrmojo.TextArea=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextArea",markupString:'<textarea id="{@id}" class="mstrmojo-TextArea {@cssClass}"  style="{@cssText}" title="{@tooltip}" placeholder="{@placeholderText}" rows="{@rows}" cols="{@cols}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keydown,keyup,blur></textarea>',maxLength:256,onkeydown:function B(K){var I=this.inputNode,J=this.value,E=this.maxLength,F=(J&&J.length)||0,M=K.e,L=M.keyCode;this.isDeleteKeys=L===8||L===46;this.isArrowKeys=L===37||L===38||L===39||L===40;if(E!==undefined&&E<=F){var G=I.selectionEnd,H=(G!==undefined)?(G-I.selectionStart)>0:document.selection.createRange().text.length>0;if(!this.isDeleteKeys&&!this.isArrowKeys&&!H){if(C.isIE7||C.isIE8||C.isIE9){I.blur();window.setTimeout(function(){I.focus();},1);}C.preventDefault(window,M);return false;}}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.TextArea,{oncssClassChange:function D(){A.addClass(this.domNode,this.cssClass||"");}});})();(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo.hash");var A="mstrmojo-TextBoxWithLabel";mstrmojo.TextBoxWithLabel=mstrmojo.declare(mstrmojo.TextBox,null,{scriptClass:"mstrmojo.TextBoxWithLabel",label:"",rightLabel:"",cssDisplay:"inline",type:"text",markupString:'<div class="'+A+' {@cssClass}" style="{@cssText}"><span class="mstrmojo-TextBox-label">{@label}</span><input id="{@id}" class="mstrmojo-TextBox {@inputNodeCssClass}"  style="{@inputNodeCssText}" title="{@tooltip}" type="{@type}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur/><span class="mstrmojo-TextBox-label-right">{@rightLabel}</span></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild.nextSibling;},lblNode:function(){return this.domNode.firstChild;}}});mstrmojo.TextBoxWithLabel.prototype.markupMethods=mstrmojo.hash.copy({oncssClassChange:function(){var B=this.cssClass;this.domNode.className=A+(B?" "+B:"");},onlabelChange:function(){this.lblNode.innerText=this.label||"";}},mstrmojo.hash.copy(mstrmojo.TextBoxWithLabel.prototype.markupMethods));}());(function(){mstrmojo.requiresCls("mstrmojo.DocPanel","mstrmojo._HasLayout","mstrmojo.vi.ui.rw._SavesChildPositions");var A="100%";mstrmojo.vi.ui.rw.DocVIMainPanel=mstrmojo.declare(mstrmojo.DocPanel,[mstrmojo._HasLayout,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocVIMainPanel",layoutConfig:{h:{containerNode:A},w:{containerNode:A},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupWidget","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.css");mstrmojo.ui.menus.MenuPopup=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui.menus._IsMenuPopup],{scriptClass:"mstrmojo.ui.menus.MenuPopup",popupConfig:null,init:function B(E){this._super(E);var C=this.popupConfig;if(!C.contents){throw new Error("Cannot open popup without contents.");}var D=["mstrmojo-ui-MenuPopup"],F=C.cssClass;if(F){D.push(F);}if(C.hasToggleItem){D.push("hasToggleItem");}mstrmojo.css.addWidgetCssClass(this,D);this.addChildren(C.contents);},shouldPropagateLockHover:function A(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TargetSelector");mstrmojo.vi.ui.LinkTargetSelector=mstrmojo.declare(mstrmojo.vi.ui.TargetSelector,null,{scriptClass:"mstrmojo.vi.ui.LinkTargetSelector",preChangeTargetSelectionMode:function A(D,C){},enterTargetSelectionMode:function B(C){C.setMaskClass(this.srcId);C.set("enabled",C instanceof mstrmojo.vi.ui.rw.VizBox);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo._HasBuilder");mstrmojo.ToolBar=mstrmojo.declare(mstrmojo.HBox,[mstrmojo._HasBuilder],{scriptClass:"mstrmojo.ToolBar",cellCssClass:"mstrmojo-ToolBar-cell",markupString:'<table id="{@id}" class="mstrmojo-ToolBar {@cssClass}" style="{@cssText}" cellspacing="0" cellpadding="0"><tr><td class="mstrmojo-ToolBar-outercell"><table class="mstrmojo-ToolBar-innertable" cellspacing="0" cellpadding="0"><tr>{@tableHtml}</tr></table></td></tr></table>',markupSlots:{containerNode:function(){return this.domNode.rows[0].cells[0].firstChild.rows[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?mstrmojo.css.DISPLAY_TABLE:"none";}},buildChildren:function A(){var B=this.buildConfig;if(!B){this.buildConfig={};B=this.buildConfig;}B.target=this.target;return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.HBox","mstrmojo._HasBuilder","mstrmojo._CanMeasureChildren");function D(){return(this.renderMode!=="scroll")?this._super():true;}function C(){if(!this.hasRendered){return ;}var F=this.children||[],E=F.length-1;for(E;E>=0;E--){if(F[E].refresh){F[E].refresh();}}}mstrmojo.DocSection=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasBuilder,mstrmojo._CanMeasureChildren],{scriptClass:"mstrmojo.DocSection",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocSection" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},postBuildRendering:D,childRenderOnAddCheck:D,refresh:C,getWidth:function A(){return this._super(1);}});mstrmojo.DocSectionHoriz=mstrmojo.declare(mstrmojo.HBox,[mstrmojo._HasBuilder,mstrmojo._CanMeasureChildren],{scriptClass:"mstrmojo.DocSectionHoriz",postBuildRendering:D,childRenderOnAddCheck:D,refresh:C,getHeight:function B(){return this._super(1);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.func","mstrmojo.array","mstrmojo.Button","mstrmojo.HBox","mstrmojo.dom","mstrmojo.Box");var D=mstrmojo.dom;mstrmojo.Dialog=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Dialog",title:"",buttons:null,alignment:"center",btnAlignment:"right",zIndex:10,modal:true,markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 1100;" tabindex="0" mstrAttach:click><div class="win mstrmojo-Editor" style="{@cssText}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div><div class="mstrmojo-Editor-tip"></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},curtainNode:function(){return this.domNode.childNodes[1];},titleNode:function(){return this.domNode.firstChild.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[1];},buttonNode:function(){return this.domNode.firstChild.lastChild;},tipNode:function(){return this.domNode.lastChild;}},editorNode:null,btnHbox:null,markupMethods:{onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;this.curtainNode.style.zIndex=this.zIndex-1;},onwidthChange:function(){this.editorNode.style.width=this.width||"auto";},onvisibleChange:function(L){if(L){return ;}var J=this.visible,K=J?"block":"none";this.editorNode.style.display=K;if(this.modal){this.curtainNode.style.display=K;}},onleftChange:function(){this.editorNode.style.left=this.left||"";},ontopChange:function(){this.editorNode.style.top=this.top||"";},ontitleChange:function(){this.titleNode.firstChild.innerHTML=this.title||"";}},preBuildRendering:function F(){var J;var K=this.buttons;if(K&&!this.btnHbox){for(J in K){K[J].cssClass=(K[J].cssClass||"")+(this.noButtonCls?"":" mstrmojo-Editor-button");}this.addChildren([{scriptClass:"mstrmojo.HBox",cssText:"float:"+this.btnAlignment,slot:"buttonNode",alias:"btnHbox",children:K},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-clearMe",slot:"buttonNode"}]);}if(this.modal){this.cssClass+=" modal";}return this._super();},buildRendering:function B(){var J=this.placeholder;if(this._super()){if(!this.parent&&!J){document.body.appendChild(this.domNode);}return true;}return false;},getResizeHandler:function E(){var J=this.id;return function(){var K=mstrmojo.all[J];K.resizeDialog();K.positionDialog();};},postBuildRendering:function A(){this._super();if(this.modal&&this.visible){this.curtainNode.style.display="block";}if(!this._resizeHandler){var K=this._resizeHandler=this.getResizeHandler();D.attachEvent(window,"resize",K);}this.resizeDialog();this.positionDialog();try{this.domNode.focus();}catch(J){}return true;},resizeDialog:function G(){if(this.modal){this.resizeCurtain();}},resizeCurtain:function C(){var K=this,O=K.curtainNode,J=document.body,M=document.documentElement,N=O.style,L=K.curtainPosition;N.width=Math.max(J.clientWidth,M.scrollWidth)+"px";if(L&&L.h){N.height=L.h+"px";}else{N.height=Math.max(J.clientHeight,M.scrollHeight)+"px";}if(L&&L.y){N.top=L.y+"px";}K.raiseEvent({name:"resizeCurtain"});},positionDialog:function H(){var K=this.editorNode,M=this.left,L=this.top;if(!M||!L){D.center(K);var J=K.style;if(this.alignment==="top"){J.top="10px";}if(M){J.left=M;}if(L){J.top=L;}}},destroy:function(K){var J=this._resizeHandler;if(J){D.detachEvent(window,"resize",J);}this._super(K);}});mstrmojo.toast=function I(O,M,Q,J){var P="mojoToast9",N,L=M||3000;if(J&&J.id){P=J.id+"-"+P;}try{mstrmojo.all[P].destroy();}catch(K){}mstrmojo.insert({id:P,scriptClass:"mstrmojo.Label",cssClass:(J&&J.cssClass)?J.cssClass:"toastCss",text:O}).render();N=mstrmojo.all[P].domNode;if(J&&J.dom){J.dom.appendChild(N);}else{document.body.appendChild(N);D.bottomCenter(N);}window.setTimeout(function(){if(Q){Q();}try{mstrmojo.all[P].destroy();}catch(R){}},L);};mstrmojo.mask={show:function(){var J=mstrmojo.mask.win=mstrmojo.insert({scriptClass:"mstrmojo.Box",cssClass:"fullscreen-mask"});J.render();document.body.appendChild(J.domNode);},hide:function(){mstrmojo.mask.win.destroy();}};}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.StackContainer");mstrmojo.MouseOverContainer=mstrmojo.declare(mstrmojo.StackContainer,null,{scriptClass:"mstrmojo.MouseOverContainer",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout></div>',doSwitch:true,mouseoverItem:null,mouseoutItem:null,init:function(A){this._super(A);if(this.setupSelectedItem){this.setupSelectedItem();}},markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},onmouseover:function(){if(this.doSwitch&&this.enabled){this.set("selected",this.mouseoverItem);}},onmouseout:function(){if(this.doSwitch){this.set("selected",this.mouseoutItem);}},preBuildRendering:function(){this.set("selected",this.mouseoutItem);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.StackContainer");mstrmojo.TabContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.TabContainer",markupString:'<div id="{@id}" class="mstrmojo-tabcontainer {@cssClass}"><div class="mstrmojo-tabcontainer-tabs"></div><div class="mstrmojo-tabcontainer-stack"></div><div></div></div>',markupMethods:{onborderChange:function(){if(this.border){this.domNode.style.border=this.border;}},onbackgroundChange:function(){this.domNode.style.background=this.background||"";}},markupSlots:{top:function(){return this.domNode.childNodes[0];},stack:function(){return this.domNode.childNodes[1];},containerNode:function(){return this.domNode.childNodes[1];},bottom:function(){return this.domNode.childNodes[2];}},addChildren:function A(D,K,H){var G=this._super(D,K,H);var B=this.children,F=B.length;if(F>=2){var L,I,E;for(E=0;E<F;E++){var C=B[E],J=C&&C.slot;if(!L&&C.isStrip){L=C;}else{if(!I&&(!J||J==="stack")){I=C;}}if(L&&I){L.set("target",I);break;}}}return G;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Button","mstrmojo.DropDownButton","mstrmojo.Label","mstrmojo.WaitIcon");mstrmojo.IncFetch=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.IncFetch",markupString:'<div id="{@id}" class="mstrmojo-IncFetch {@cssClass}" style="{@cssText}"><div class="mstrmojo-IncFetch-content"></div><div class="mstrmojo-clearMe"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},preBuildRendering:function A(){var J=[],F=this.ds,M=this.cp,P=this.np,C=this.ps,E=this.id,G=2;var L=function(){mstrmojo.all[E].set("cp",this.text);};var H={f:1,p:Math.max(M-1,1),n:Math.min(M+1,P),l:P};for(var O in H){J.push(new mstrmojo.Button({iconClass:"arrow "+O,title:F[O],enabled:(H[O]!==M),text:H[O],onclick:L}));}var D=Math.max(Math.min(M-2,P-4),1),I=Math.min(D+4,P);for(var K=D;K<=I;K++){var N;if(K===M){if(I-D===4&&P!==5){N=new mstrmojo.DropDownButton({height:"13px",title:F.a?F.a:"",text:K,direction:"up",popupRef:{scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"goto",autoCloses:false,locksHover:true,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.Label",cssText:"float:left;",text:F.gt},{scriptClass:"mstrmojo.TextBox",cssText:"float:left;",size:3,maxLength:String(P).length,onEnter:function(){var R=this.inputNode.value,U=this.parent.parent;if(R===""){U.close();return ;}var Q=parseInt(R,10),S=!(isNaN(Q)||Q<1||Q>P);if(S){mstrmojo.all[E].set("cp",Q);U.close();}else{this.setInvalidState(F.v.replace("###",P).replace("##",1).replace(" #",""));}}},{scriptClass:"mstrmojo.Button",cssText:"float:left",iconClass:"apply",title:F.ap?F.ap:"",onclick:function(){this.parent.children[1].onEnter();}}]}],onOpen:function(){mstrmojo.css.addClass(this.parent.domNode,["open"]);var Q=this.children[0].children[1].inputNode;window.setTimeout(function(){Q.focus();},0);},onClose:function(){mstrmojo.css.removeClass(this.parent.domNode,["open"]);this.children[0].children[1].cleanUp();}}});}else{N=new mstrmojo.Button({iconClass:"pg on",text:K});}}else{N=new mstrmojo.Button({iconClass:"pg",text:K,onclick:L});}J.splice(G++,0,N);}J.splice(G++,0,new mstrmojo.Label({text:F.pgs.replace("###",P).replace("##",""),cssText:"float:left;margin:1px 1px 1px 3px;"}));this._iWait=new mstrmojo.WaitIcon({cssText:"margin-top:-2px;"});J.push(this._iWait);this.addChildren(J);return this._super?this._super():true;},_set_cp:function B(D,C){if(parseInt(C,10)!==this.cp){this.raiseEvent({name:"fetch",v:C,iWait:this._iWait});}}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ThreeColumnContainer");mstrmojo.kpicard.editors.KPICardThresholdHeaderControl=mstrmojo.declare(mstrmojo.ui.editors.controls.ThreeColumnContainer,null,{scriptClass:"mstrmojo.kpicard.editors.KPICardThresholdHeaderControl",postBuildRendering:function A(){if(this._super){this._super();}var D=this.col3Node,C=D&&D.style,B=this.col2Node,E=B&&B.firstChild,F=E&&E.style;if(C){C["float"]="right";}if(F){F.marginTop="0px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo._HasLayout");mstrmojo.ui.editors.controls.PreviewButton=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.PreviewButton",markupString:'<div id="{@id}" class="mstrmojo-ui-PreviewButton {@cssClass}" style="{@cssText}"><div class="cf" mstrAttach:click><div class="preview"></div><div class="btn">&nbsp;</div></div><div class="host"></div></div>',markupSlots:{previewNode:function(){return this.domNode.firstChild.firstChild;},btnNode:function(){return this.domNode.firstChild.lastChild;},widgetHostNode:function(){return this.domNode.lastChild;},clickableNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{previewNode:"100%",btnNode:"100%",widgetHostNode:"0px"},w:{previewNode:"100%",btnNode:"20px",widgetHostNode:"all"},xt:true},isHostedWithin:false,getLayoutOffsets:function B(){return{h:2,w:2};},anchorSlot:"clickableNode",updatePreview:function C(){throw new Error(this.scriptClass+" must implement updatePreview.");},getPopupHostNode:function A(){return this.widgetHostNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui.editors._HostsControls","mstrmojo._HasLayout","mstrmojo.css");mstrmojo.ui.editors.controls.ControlGroup=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui.editors._HostsControls,mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.ControlGroup",layoutConfig:{w:{containerNode:"100%"},xt:true},shouldPropagateEnabled:true,init:function A(B){this._super(B);mstrmojo.css.addWidgetCssClass(this,"ctrl-group");}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ui.editors.controls.ControlGroup,{onenabledChange:mstrmojo.Container.enabledMarkupMethod});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui.PopupConfig","mstrmojo.css");mstrmojo.ui.editors.ToolbarPopup=mstrmojo.declare(mstrmojo.Box,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.editors.ToolbarPopup",popupConfig:null,anchorElement:null,autoCloses:false,locksHover:true,init:function B(C){this._super(C);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-ToolbarPopup");this.popupConfig=new mstrmojo.ui.PopupConfig({isHostedWithin:false,hostProxyCssClass:(mstrApp&&mstrApp.getThemeClassName())||"",anchorElement:this.anchorElement});},open:function A(D,C){D.closePopup();this._super(D,C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.Box","mstrmojo.css");var A=mstrmojo.css;mstrmojo.vi.ui.rw.VisFilterIndicator=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.rw.VisFilterIndicator",cssClass:"VisFilterIndicator",init:function D(F){var G=F.unitContainer.domNode,E=G.style;if(G){if(F.hasOwnProperty("width")===false){F.width=(E&&E.width)||(G.clientWidth+"px");}if(F.hasOwnProperty("left")===false){F.left=G.offsetLeft+"px";}if(F.hasOwnProperty("top")===false){F.top=(G.offsetTop)+"px";}}this._super(F);this.placeholder=G.appendChild(document.createElement("div"));},children:[{scriptClass:"mstrmojo.Label",slot:"containerNode",alias:"lblTitle",text:mstrmojo.desc(15297,"Items selected in configuration mode will not be applied to visualization filter.")}],postBuildRendering:function(){this._super();var F=this.domNode,E=this;F.style.left=this.left;F.style.top=this.top;if(!this.animationListener){var G=this.animationListener=function(H){if(H.animationName==="indicatorout"){A.addClass(F,"hidden");E.destroy();}};A.onAnimationEnd(F,G);}},updateDimension:function C(){if(this.hasRendered&&!this.destroyed&&this.unitContainer){var E=this.unitContainer.domNode;if(E){this.set("width",(E.style.width||(E.clientWidth+"px")));}}},destroy:function B(){if(this.animationListener){this.animationListener=null;}this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.ME.Enum");mstrmojo.requiresDescs();var M=mstrmojo.dom,B=mstrmojo.string,D=mstrmojo.Widget;var H=/\r?\n?----\r?\n?/;function F(N){var O=B.decodeHtmlString((N||{}).desc||"",true).split(H);return{desc:O[0],example:O.length===2?O[1]:""};}mstrmojo.ME.FunctionInfo=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionInfo",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="mstrmojo-FunctionInfo-container"><div class="mstrmojo-FunctionInfo-syntax"></div><div class="mstrmojo-FunctionInfo-desc"></div><div class="mstrmojo-FunctionInfo-eg"><span class="icon" t="icon"></span><span class="text"></span></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},syntaxNode:function(){return this.domNode.firstChild.firstChild;},descNode:function(){return this.domNode.firstChild.childNodes[1];},egNode:function(){return this.domNode.firstChild.lastChild;},egTextNode:function(){return this.domNode.firstChild.lastChild.lastChild;}},markupMethods:{onvisibleChange:D.visibleMarkupMethod,onfoiChange:function(){this.syntaxNode.innerHTML=B.htmlAngles(this.syntax)||"";this.descNode.innerHTML=this.desc;this.egTextNode.innerHTML=this.example;this.egNode.style.display=this.example?"block":"none";this.updateScrollbars();}},foi:{},syntax:"",desc:"",example:"",init:function L(N){this._super(N);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-FunctionInfo");},setupScrollNodes:function C(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},onfoiChange:function A(){this.set("syntax",this.getFunctionSyntax());this.set("desc",this.getDesc()+" "+this.getHelpTopic());this.set("example",this.getExample());},getFunctionSyntax:function K(R){var U=R||this.foi;if(!U){return"";}if(U.did<0){return U.n;}var Q=U.pars,S=U.pros,O=[],P,N;O.push(U.n);S=mstrmojo.hash.clone(S)||[];if(U.ios){S.push({n:"SortBy"});}if(U.sqt===5){S.push({n:"BreakBy"});}if(this.showFullSyntax){if(S.length>0){O.push("<");for(P=0,N=S.length;P<N;P++){if(mstrmojo.array.indexOf(mstrmojo.ME.Enum.NonExposableParams,S[P].n)===-1){O.push(S[P].n);O.push(", ");}}O.pop();O.push(">");}}O.push("(");for(P=0,N=Q.length;P<N;P++){O.push(Q[P].n);if(P!==(N-1)){O.push(", ");}}O.push(")");return O.join("");},getDesc:function E(){return F(this.foi).desc;},getExample:function J(){return F(this.foi).example;},getHelpTopic:function G(N){var O=N||this.foi;if(!O||O.did===mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(O.h);},useRichTooltip:true,showTooltip:function I(N,Q){var P=M.eventTarget(Q,N),O=this.foi;if(P&&P.getAttribute("t")==="icon"){this.richTooltip=this.getTooltip(O,P);if(this.richTooltip){this._super(N,Q);}}},getTooltip:function(Q,R){var O=M.position(R),P=R.egTip||"";var N={areaId:Q._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:P,top:O.y-75,left:O.x+O.w-30,enableHover:false};return N;}});mstrmojo.ME.FunctionInfo.getDescAndExample=F;}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasLayout");mstrmojo.ui.LayoutBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.LayoutBox",layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.ui._HasScroller","mstrmojo.css");var B=mstrmojo.css;mstrmojo.ui.ColumnContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ColumnContainer",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnContainer {@cssClass}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},scrollNode:function(){return this.domNode.firstChild;}},markupMethods:{onnextChange:function A(){B.toggleClass(this.domNode,"hasNext",!!this.next);}},active:false,next:null,idx:undefined,updateColumnContainer:function D(){var E=this.next;if(E){E.updateColumnContainer();}},onactiveChange:function C(){B.toggleClass(this.domNode,"active",this.active);var E=this.next;if(E){E.updateColumnContainer();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Box","mstrmojo._HasTooltip");var D=mstrmojo.dom;mstrmojo.ui.LabelWithIconTooltip=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasTooltip],{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",markupString:'<div id="{@id}" class="mstrmojo-IconLabel {@cssClass}" style="{@cssText}" ttp="{@tooltip}"><span class="mstrmojo-Label" style="">{@text}</span><span class="{@iconCss}" style=""></span></div>',markupSlots:{labelNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.lastChild;}},text:"",iconCss:"",tooltip:"",useRichTooltip:true,shouldShowTooltip:function B(F,H){var G=F.target||D.eventTarget(F.hWin,F.e);return G===this.iconNode;},getTooltipContent:function A(F){var G=F.target||D.eventTarget(F.hWin,F.e);return this.tooltip||G.getAttribute("ttp");},updateTooltipConfig:function C(G){var H=G.target||D.eventTarget(G.hWin,G.e),F=D.position(H);if(!this.richTooltip){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPRIGHT,content:this.getTooltipContent(G),top:F.y+F.h,left:F.x+10,cssClass:"vi-regular vi-tooltip-D no-arrow",};}},showTooltip:function E(F,G){if(this.shouldShowTooltip(F,G)){this._super(F,G);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasLayout","mstrmojo.css","mstrmojo.array");mstrmojo.vi.ui.PanelContents=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.PanelContents",layoutConfig:{w:{containerNode:"100%"},xt:true},slot:"containerNode",init:function B(C){this._super(C);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIPanelContents");},setDimensions:function A(D,C){this.set("width",C);(this.children||[]).forEach(function(H){var F=H.getLayoutOffsets&&H.getLayoutOffsets(),G=(F&&F.w)||0,E=parseInt(C,10)-G+"px";if(H.setDimensions){H.setDimensions("auto",E);}else{H.set("width",E);}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasLayout","mstrmojo.css");var B=mstrmojo.css;mstrmojo.vi.ui.editors.EditorGroup=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",layoutConfig:{w:{containerNode:"100%"},xt:true},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod},showDivider:true,isNested:false,isContainer:false,init:function D(E){this._super(E);B.addWidgetCssClass(this,["mstrmojo-vi-EditorGroup","ctrl-group"]);},preBuildRendering:function A(){var E=[];if(this.showDivider){E.push("divide");}if(this.isContainer){E.push("container");}if(E.length){B.addWidgetCssClass(this,E);}return this._super();},getLayoutOffsets:function C(){return{h:0,w:this.isNested?0:18};}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.css","mstrmojo.Image","mstrmojo.ui._HasScroller");var E=mstrmojo.array,A=mstrmojo.css;mstrmojo.vi.ui.CoverPageGallery=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.CoverPageGallery",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-vi-ui-CoverPageGallery {@cssClass}" style="{@cssText}"><div style="height: 100%"></div></div>',cssText:"overflow: hidden",markupSlots:{containerNode:function(){return this.domNode.firstChild;}},imageList:[],selectedImgNode:null,selectedImgURL:"",onselectedImgURLChange:function D(){var I=this.children,G=E.find(I,"src",this.selectedImgURL),H=G>-1?I[G]:null;this.changeSelectedImg(H);},changeSelectedImg:function F(G){if(this.selectedImgNode){A.toggleClass(this.selectedImgNode,"selected",false);}A.toggleClass(G&&G.imgNode||null,"selected",true);this.selectedImgNode=G&&G.imgNode||null;},onimageSelected:mstrmojo.emptyFn,onimageListChange:function C(){this.removeChildren();var H=this;var I=this.imageList=this.imageList||[],G=[];E.forEach(I,function(J){G.push({scriptClass:"mstrmojo.Image",src:J.src,cssDisplay:"inline-block",imgCssClass:"coverPageItem",onclick:function(){if(H.selectedImgURL!==this.src){H.set("selectedImgURL",this.src);H.onimageSelected(this.src);}}});});this.addChildren(G);this.onselectedImgURLChange();this.updateScrollbars();},setupScrollNodes:function B(){this.scrollNode=this.containerNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo._HasOwnAvatar","mstrmojo.css","mstrmojo.dom");var E=mstrmojo.css,D=mstrmojo.dom;function F(K){var L=K.src.node,M=this.children.filter(function(N){return D.contains(N.domNode,L,true,this.domNode);});return M[0];}function J(K){var N=K.tgt,W=this.children,R=D.getMousePosition(N.e,N.hWin),Q,S,V,M,U,P,L=R.y;for(var O=W.length-1;O>=0;O--){V=W[O];Q=D.position(V.domNode);U=Q.h;M=Q.y;P=M+U/2;if(P<L&&(O===W.length-1||L<=M+U)){S=O;break;}else{if((O===0||M<L)&&L<=P){S=O-1;break;}}}return S;}function I(K){return K===-1?"top":"bottom";}mstrmojo.threshold.ThresholdRowPanel=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.threshold.ThresholdRowPanel",dropZone:true,draggable:true,restrictedToAxis:"y",avatarCssClass:"threshold-drag-avatar",getDragData:function H(K){return{row:F.call(this,K)};},createAvatar:function B(M,L){var K=L.src.data.row.domNode.cloneNode(true);K.style.left=D.position(this.domNode).x+"px";return K;},isDragValid:function G(K){var L=K.getCtxtDragData().row;return !(this.children.length===1||!L||L.draggableNode!==K.src.node)||this._super(K);},ondragstart:function(K){this._super(K);this.removeChildren(K.getCtxtDragData().row);},ondragmove:function A(M){var O=M.getCtxtDragData(),N=this.children,L=J.call(this,M);var K=O.lastRowIdx;if(K!==L){if(K!==undefined){E.removeClass(N[Math.max(K,0)].domNode,I(K));}E.addClass(N[Math.max(L,0)].domNode,I(L));O.lastRowIdx=L;}this._super(M);},ondragend:function C(L){var M=L.src.data,K=M.lastRowIdx;if(K!==undefined){E.removeClass(this.children[Math.max(K,0)].domNode,I(K));}this._super(L);this.parent.parent.model.moveThreshold(L.getCtxtDragData().row.idx,K+1);}});}());(function(){mstrmojo.requiresCls("mstrmojo.rw.DocSubsection","mstrmojo.vi.ui.rw._SavesChildPositions","mstrmojo._HasLayout");mstrmojo.vi.ui.rw.DocSubsection=mstrmojo.declare(mstrmojo.rw.DocSubsection,[mstrmojo._HasLayout,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocSubsection",alias:"docSubSection",formatHandlers:null,layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.func","mstrmojo.vi.controllers.UICmdMgr");var X=mstrmojo.func,S=mstrmojo.hash,P=mstrmojo.array,M=mstrmojo.vi.controllers.UICmdMgr.STATES,J={SHARED:0,SEPARATE:1},N={AND:19,OR:20},d=function d(h,g){var e={},f=function(l,k){var j=[];if(!k){return l;}P.forEach((k||[]),function(m){j.push(m);});P.forEach((l||[]),function(n){var m=P.find(k,"id",n.id);if(!~m){j.push(n);}});return j;};S.forEach(g,function(j,k){e[k]=j;});S.forEach(h,function(j,k){e[k]=f(j,g[k]);});return e;},D=function D(e){var f=[];S.forEach(e,function(g){f.push({ft:N.AND,d:g});});return f;},K=function(f){var e={},g=function(h){var j=S.keyarray(h)[0];return{id:j,d:h[j][0]};};S.forEach(f,function(l){var k={},h=g(l),j=k[h.id];if(h.id){if(!j){k[h.id]=j=[];}j.push(h.d);}e=d(e,k);},this);return[{ft:N.OR,d:e}];},C=function C(j,n){var k=this.model,m,f=[],g=mstrmojo.vi.ui.rw.SelectionType,l=true,h=false,e=this;if(!n){n=this.getSelectionType();}if(!S.isEmpty(j)){if(n===g.METRICS){m=D.call(this,j);}else{m=K.call(this,j);}}S.forEach(m,function(o){l=false;var p=[];S.forEach(o.d,function(q,u){if(e.isSupportViewFilterForSelection(u)){h=true;var r=[],t={id:u,elems:r,fm:q[0].fm,v:P.map(q,function(v){return v.n;}).reverse()},s=k.getObjectInfo(u);if(s){t.t=s.t;t.st=s.st;if(s.st===12033){t.attId=s.attId;}}P.forEach((q||[]),function(v){r.push(v.id);});p.push(t);}});if(p.length){f.push({ft:o.ft,d:p});}});f.hasElements=h;f.clearSelections=l;return f;},F=function F(g){var e=this.getContextMenuSelectionType(),f=[];f=C.call(this,g,e);return f;},a=function a(l,n){var k=this.selectorControl,g,f,m,j=this,h,e;if(k){if(l.clearSelections||l.hasElements){g=this.controller;if(n){f=g.model;e=k.navPage;h=f.getLayoutKeyByUnitKey(e);this.clearSelections();this.setSelectionCache();}k.exp=null;if(g.onGridSelector){m=function(){g.onGridSelector(j,{type:mstrmojo.EnumRWUnitType.GRID,ck:k.ck,tks:k.tks,cgb:S.valarray(k.cgb),ctlKey:k.ckey,sliceId:this.sid,isUConDS:k.isUConDS,isNavigation:n,layoutKey:h,panelKey:e,ct:k.ct,selections:l});};if(this.multiUnitCtrlInterval){window.clearInterval(this.multiUnitCtrlInterval);this.multiUnitCtrlInterval=null;}if(g.cmdMgr.state===M.BUSY){this.multiUnitCtrlInterval=window.setInterval(function(){if(g.cmdMgr.state!==M.BUSY){window.clearInterval(j.multiUnitCtrlInterval);if(!j.destroyed){j.multiUnitCtrlInterval=null;m();}}},1000);}else{m();}}}}},B=function B(g){var e={type:mstrmojo.vi.ui.rw.SelectionType.ATTS,data:g},f=function(h,j){if(parseInt(h.fn,10)===22&&parseInt(j,10)===19){e.type=mstrmojo.vi.ui.rw.SelectionType.METRICS;}P.forEach((h.nds||[]),function(k){f(k,h.fn);});};f(g,null);return e;},b=function b(){return this.parent.model.getCurrentLayoutDef().cgbMap;},O=function O(){var e=b.call(this),f=[];S.forEach(e,function(h,g){if(this.k===h){f.push(g);}},this);return f;},c=function c(){var e=this.controller&&this.controller.cmdMgr;if(e&&e.isUndoRedo()){return true;}return false;};mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl",selectorControl:null,multiUnitCtrlInterval:null,postBuildRendering:function Y(){if(this._super){this._super();}var e=mstrApp.isInVFConfigMode||this.isCustomSort?null:this.findSelectorControl();if(c.call(this)){this.clearSelections();}if(e&&!e.isNavigation&&!S.isEmpty(e.exp)&&this.addSelectionsFromExpression){this.addSelectionsFromExpression(B(e.exp));if(this.highlight){this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}}},getSelectorDataFromExpression:B,getSelectionDataTree:C,getContextMenuSelectionDataTree:F,deleteSelectorControl:function E(){if(this._super){return this._super();}this.throwAbstractMethodError("deleteSelectorControl");},findSelectorControl:function W(){if(this._super){return this._super();}this.throwAbstractMethodError("findSelectorControl");},handlesMultiSelection:function H(e){return(this._super&&this._super(e))||!!this.selectorControl;},isSupportViewFilterForSelection:function I(f){var e=this.model;return e.supportsViewFilterActions(f);},isLinkedFilter:function(){var e=this.findSelectorControl&&this.findSelectorControl();return e&&e.isNavigation;},isLinkedFilterEnabled:function(){return this.isLinkedFilter()&&this.getContextMenuSelectionHash&&!S.isEmpty(this.getContextMenuSelectionHash());},handleContextMenuSelectionData:function G(e){this.isNavigation=e;this.onContextMenuSelectionChange(this.getContextMenuSelectionHash&&this.getContextMenuSelectionHash());},onSelectionChange:function Q(f){var j=(this.model.getSelectorControlMapInfo?this.model.getSelectorControlMapInfo():[]),h=false,g=this.isNavigation;if(g){delete this.isNavigation;}if(this._super){h=this._super(f);}if(!g&&this.isLinkedFilter()){return true;}if(j.length>0){this.singleUnitSelect();h=true;}else{if(!!this.selectorControl&&!this.isCustomSort){var e=C.call(this,f);a.call(this,e,g);return true;}}return h;},onContextMenuSelectionChange:function L(f){var j=(this.model.getSelectorControlMapInfo?this.model.getSelectorControlMapInfo():[]),h=false,g=this.isNavigation;if(g){delete this.isNavigation;}if(this._super){h=this._super(f);}if(!g&&this.isLinkedFilter()){return true;}if(j.length>0){this.singleUnitSelect();h=true;}else{if(!!this.selectorControl){var e=F.call(this,f);a.call(this,e,g);return true;}}return h;},singleUnitSelect:function A(){if(this._super){this._super();}},clearAllSelections:function V(){return this.selectorControl&&this.selectorControl.showall;},onClearBrushing:function Z(e){if(this.selectorControl){return true;}if(this._super){return this._super(e);}return false;},getFilterType:function R(){return this.defn.ins||J.SHARED;},switchFilterType:function U(r){var m=this,q,n=m.getFilterType(),k=m.parent.model,j,h={actions:[]},s,g=b.call(m),e,l=false,o,v,p,u,f;if(n!==r){q=O.call(m);o=k.getCurrentLayoutDef().units;if(q.length&&n===J.SHARED){s=P.filterOne(q,function(w){v=o[w];if(v){p=v.scs||[];return true;}j=k.getSourceControls(m.parent,w);p=j;return j.length;});if(!j||!j.length){j=k.getSourceControls(m.parent,s);j=P.filter(j,function(w){u=w.control.key;return !P.find(p,"ckey",u);});p=p.concat(j);}P.forEach(p,function(w,x){if(x!==0){e=k.getNextKey();g[e]=m.k;h.actions.push(k.redoFilterAssociations(true,w.ckey||w.control.ckey,w.pnk||w.sourceKey,m.k,s,e));l=true;}}.bind(m));}else{f="";P.forEach(q,function(w){v=o[w];if(!v){j=k.getSourceControls(m.parent,w);v=j.length&&j[0];if(!v){return true;}v.pnk=v.sourceKey;v.ckey=v.control.ckey;}if(!f){f=w;}else{delete g[w];p=(v.scs&&v.scs[0])||v;h.actions.push(k.redoFilterAssociations(false,p.ckey,p.pnk,m.k,w,f));l=true;}}.bind(m));}h.actions.push(k.getUnitFormatAction(m,1,{FormattingSelector:{IndependentNodeSelector:r}},true));var t=false;h.callback=({success:function(){m.defn.ins=t?n:r;t=!t;}});if(l){h.callback=X.wrapMethods(h.callback,k.getRebuildCallback());}}h.extras={style:{params:{treesToRender:3}}};return h;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.PanelContents");mstrmojo.vi.ui.BoxPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.BoxPanel",markupString:'<div id="{@id}" class="mstrmojo-VIBoxPanel {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIBoxPanel-control"></div><div class="mstrmojo-VIBoxPanel-content"></div><div class="mstrmojo-VIBoxPanel-mask"></div></div>',markupSlots:{controlNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{controlNode:"auto",containerNode:"100%"},w:{controlNode:"100%",containerNode:"100%"},xt:true},controlNode:null,containerNode:null,maskNode:null,parent:null,slot:"containerNode",children:[{scriptClass:"mstrmojo.vi.ui.PanelContents",slot:"containerNode",alias:"contents"}],_set_children:function E(N,L,K){var M=this.children;if(L!==M&&M){L=L.concat(M.filter(function(O){return O.slot==="controlNode";}));}return this._super(N,L,K);},doLayout:function A(){if(!this.visible){return ;}this._super();},addPopupHandlers:function B(K,M,L){K.addPopupHandlers(this.id,M,L);},setOpenStatus:function I(L,K,N,M){if(!L){this.parent.removePanel(this,N,K,M);mstrApp.rootCtrl.generateToolbar();}},updateToolbar:function J(K){K.hostId=this.id;K.isHostedWithin=false;return K;},addRenameTargetMenuItem:function C(K){K.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.toolbar.lblTitle.set("isEditing",true);}.bind(this));},addHelpTopicMenuItem:function G(K,M,L){if(L){K.addMenuItem(M,"help",function(){mstrApp.showHelpTopic(L);});}},addCloseMenuItem:function F(K,L){K.addMenuItem(mstrmojo.desc(2177,"Close"),"",function(){var M=L.getDataService().newUpdateWithoutCmd();this.setOpenStatus(false,false,M);M.submit();}.bind(this));},getOpenStatus:function H(){return true;},setupScrollNodes:function D(){this.scrollNode=this.containerNode;}});mstrmojo.vi.ui.BoxPanel.PANEL_TYPES={DROP_ZONES:"vi_drz",PROPS:"vi_prp",FILTERS:"vi_flt"};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.Box","mstrmojo.array","mstrmojo._HasLayout","mstrmojo.ui.ColumnContainer");var E=mstrmojo.dom,G=mstrmojo.hash,C=mstrmojo.array;mstrmojo.ui.ColumnWalk=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.ColumnWalk",markupString:'<div id="{@id}" class="mstrmojo-ui-ColumnWalk cf {@cssClass}" mstrAttach:click></div>',layoutConfig:{h:{containerNode:"100%"},xt:true},currentColumn:-1,addNextColumn:function B(K){var J=this.children||[],L=J.length,I=J[L-1];var M=this.addChildren([G.copy(K,{scriptClass:"mstrmojo.ui.ColumnContainer",idx:L})])[0];if(I){I.set("next",M);}},onclick:function A(I){var K=I.getTarget();if(K){var J=this.children;C.forEach(J,function(M,L){if(E.contains(M.domNode,K,true,M.domNode)){this.set("currentColumn",L);}},this);}},oncurrentColumnChange:function D(I){var K=this.children,M=K[I.valueWas],J=K[this.currentColumn],L="active";if(M){M.set(L,false);}J.set(L,true);},removeTrailingContainer:function H(K){var J=this,I=this.children;if(!I||K>=I.length-1){return ;}C.forEach(I.slice(K+1),function(L){J.removeAndDestroyChild(L);});if(K>=0){I[K].set("next",null);}},insertAndRemoveTrailing:function F(J,I){this.removeTrailingContainer(J);this.addNextColumn(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.LayoutBox","mstrmojo._HasBuilder");mstrmojo.ui.BuilderBox=mstrmojo.declare(mstrmojo.ui.LayoutBox,[mstrmojo._HasBuilder],{scriptClass:"mstrmojo.ui.BuilderBox"});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.VisFilterIndicator");mstrmojo.vi.ui.rw._HasVisFilterIndicator=mstrmojo.provide("mstrmojo.vi.ui.rw._HasVisFilterIndicator",{displayVisFilterIndicator:function B(){if(mstrApp.isInVFConfigMode){var D=this.parent,E=D&&D.isIndicatorDisplayed,C;if(E){return ;}C=new mstrmojo.vi.ui.rw.VisFilterIndicator({unitContainer:this});C.render();this.indicator=C;D.isIndicatorDisplayed=true;}},updateVisFilterIndicator:function A(){var C=this.indicator;if(mstrApp.isInVFConfigMode&&C){C.updateDimension();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.alert","mstrmojo.css","mstrmojo.desc","mstrmojo.dom","mstrmojo.Label","mstrmojo.ui.editors.ToolbarPopup","mstrmojo.vi.models.EnumFieldTypes");var E=mstrmojo.dom,F=null;function D(I){var H=1;if(I.tstp===769){H=2;}else{if(I.tstp===774){H=3;}}return H;}function B(L){var H=mstrApp.name,K=H+"?",I=-1,J=function(N,M){K+=N+"="+M+"&";};if(!!L){switch(L.ttp){case 3:J("evt","4001");J("reportID",L.tid);I=D(L);if(I!==-1){J("reportViewMode",I);}break;case 55:if(L.tstp===14080){J("evt","32001");J("documentID",L.tid);}else{if(L.tvmd&(8192|2048)&&!((L.tvmd&2048&&mstrApp.features["run-vi-flash"]))){J("evt","3140");J("documentID",L.tid);if(E.isIE6||E.isIE7||E.isIE8){mstrmojo.alert(mstrmojo.desc(15474,"To work with HTML5 dossiers, please turn off your browser Compatibility View or update your browser to one of the following browser versions: Chrome, Firefox, Safari, Internet Explorer 9 or above."));return null;}}else{J("evt","2048001");J("objectID",L.tid);J("visMode","0");}}break;}}return K;}mstrmojo._HasDocLink=mstrmojo.provide("mstrmojo._HasDocLink",{_mixinName:"mstrmojo._HasDocLink",url:"",target:"",linkEnabled:true,ifw:"",update:function G(H){var I=H.defn;this.url=H.data.url||I.url;if(I.target){this.target=I.target;}if(I.ifw){this.ifw=I.ifw;}this._super(H);},postBuildRendering:function A(){if(this.url||this.ifw){mstrmojo.css.addClass(this.domNode,"hasLink");}var I=this.controller&&this.controller.view,H=I&&I.getCurrentLayout&&I.getCurrentLayout();if(H&&H.addLinkInfo){H.addLinkInfo(this.id,{url:this.url,target:this.target,src:this});}return this._super();},setLinkEnabled:function C(L){this.linkEnabled=L;var K=this.domNode;if(!K){return ;}var M=K.childNodes,J=M[M.length-1],H=this.id+"_mask",I=(J.id===H)?J:null;if(L){if(I){K.removeChild(I);delete this._mask;}}else{if(!I){I=document.createElement("div");I.className="mstrmojo-DocLinkMask";I.id=H;I.innerHTML="&nbsp;";K.appendChild(I);}}},cancelDocLink:false,onclick:function(I){if(F===null){var J=this,H=function(){if(J.linkEnabled&&!J.isEditing){var S=J.drillLinkItems,R=S&&S[0],K=J.url||(R&&R.url),M=J.node&&J.node.data,L=M&&M.navpage,Q=J.model,O=mstrmojo.desc(15704,'Go to "#"'),P;if(J.ifw){Q.showInfoWin(J.ifw,(J.getAnchor&&J.getAnchor())||J.domNode,"v",true);}else{if(K){O=O.replace("#",K);P=function(){Q.executeLink(K,J.target,J);};}else{if(M&&M.tid&&!mstrApp.isSingleTier){K=B(M);if(!!K){O=O.replace("#",M.tnm);P=function(){Q.executeLink(K,J.target,J);};}}else{if(L){O=O.replace("#",M.navpagenm);P=function(){Q.raiseEvent({name:"layoutSelected",panelKey:L,layoutKey:Q.getLayoutKeyByUnitKey(L)});};}}}}if(P){if(!mstrApp.isVI||mstrApp.isAppStatePresentation()){P();return ;}var U=J.parent,N=J._menu,V=function(W){if(W===mstrmojo.vi.models.EnumFieldTypes.IMAGE){return mstrmojo.desc(10502,"Edit image");}return mstrmojo.desc(16163,"Edit text");};if(!N){N=J._menu=new mstrmojo.ui.editors.ToolbarPopup({anchorElement:U,autoCloses:true,cssClass:"link-action-cfg",children:[{scriptClass:"mstrmojo.Label",alias:"nav",cssClass:"link nav",cssDisplay:"inline",text:O,onclick:function(){P();this.parent.close();}},{scriptClass:"mstrmojo.Label",cssClass:"separator",cssDisplay:"inline-block",text:"|"},{scriptClass:"mstrmojo.Label",alias:"edit",cssClass:"link",cssDisplay:"inline-block",popupHost:U,text:V(U.hostType),onpopupHostChange:function(){this.set("text",V(this.popupHost.hostType));},onclick:function(){this.parent.close();this.popupHost.switchToEditMode();}}]});}else{N.nav.set("text",O);N.nav.set("onclick",function(){P();this.parent.close();});N.edit.set("popupHost",U);}N.popupConfig.position=E.getMousePosition(I.e,I.hWin);U.openPopup(N);}}};F=window.setTimeout(function(){if(!J.cancelDocLink){H();}J.cancelDocLink=false;F=null;},200);}},hasActiveLink:function(){if(this.linkEnabled){var K=this.drillLinkItems,H=K&&K[0],J=this.url||(H&&H.url),I=this.node&&this.node.data;if(I){if(I.tid&&!mstrApp.isSingleTier){return true;}if(I.navpage){return true;}}if(J){return true;}}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.TabContainer");mstrmojo.TabListContainer=mstrmojo.declare(mstrmojo.TabContainer,null,{scriptClass:"mstrmojo.TabListContainer",markupString:'<table id="{@id}" class="mstrmojo-tabcontainer {@cssClass}"><tr><td class="mstrmojo-tabcontainer-tabs {@listCssClass}"></td><td class="mstrmojo-tabcontainer-stack {@containerCssClass}"></td><td class="{@bottomCssClass}"></td></tr></table>',markupSlots:{top:function(){return this.domNode.firstChild.childNodes[0].childNodes[0];},stack:function(){return this.domNode.firstChild.childNodes[0].childNodes[1];},containerNode:function(){return this.domNode.firstChild.childNodes[0].childNodes[1];},bottom:function(){return this.domNode.firstChild.childNodes[0].childNodes[2];}}});})();(function(){mstrmojo.requiresClsP("mstrmojo","dom","css","desc","string");mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo._IsPopup","mstrmojo._IsMovable");var F=mstrmojo.dom,H=mstrmojo.css;mstrmojo.vi.ui.rw.CustomSortAvatar=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._IsMovable],{scriptClass:"mstrmojo.vi.ui.rw.CustomSortAvatar",modal:false,title:mstrmojo.desc(15760,"Selected Element"),markupString:'<div id="{@id}" class="mstrmojo-CustomSortAvatar-wrapper"><div class="mstrmojo-CustomSortAvatar {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseover,mouseout,click><div class="mstrmojo-CustomSortAvatar-titlebar"></div><div class="mstrmojo-CustomSortAvatar-content"></div></div></div>',markupSlots:{editorNode:function G(){return this.domNode.firstChild;},titlebarNode:function B(){return this.domNode.firstChild.firstChild;},containerNode:function D(){return this.domNode.firstChild.childNodes[1];}},markupMethods:{ontitleChange:function(){this.titlebarNode.innerText=this.title;},onzIndexChange:function(){this.editorNode.style.zIndex=this.zIndex;},onvisibleChange:function(M){this.domNode.style.display=this.visible?"block":"none";},onleftChange:function A(){this.editorNode.style.left=this.left||"";},ontopChange:function L(){this.editorNode.style.top=this.top||"";}},children:[{scriptClass:"mstrmojo.HBox",slot:"containerNode",alias:"containerBox",children:[{scriptClass:"mstrmojo.Label",alias:"label",useRichTooltip:true,updateTooltipConfig:function(){var N=this.domNode,M;if(N.scrollWidth>N.clientWidth){M=F.position(this.parent.domNode);this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:N.textContent,top:M.y,left:M.x};}else{delete this.richTooltip;}}},{scriptClass:"mstrmojo.Widget",markupString:'<div class="icon close"></div>'}]}],updatePopupConfig:function E(M,O){var N=this;mstrmojo.hash.forEach(M,function(Q,P){if(Q!==undefined){N[P]=Q;}});},onOpen:function C(){this.containerBox.label.set("text",this.text);this.editorNode.style.top=this.top;this.editorNode.style.left=this.left;},preBuildRendering:function I(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));}return this._super();},getMovingHandle:function J(){return this.titlebarNode;},getMovingTarget:function K(){return this.editorNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.fx","mstrmojo.Dialog","mstrmojo.Label","mstrmojo._IsPopup","mstrmojo._HasPopup","mstrmojo._IsMovable","mstrmojo.ui._HasUITheme","mstrmojo.Button","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.tooltip","mstrmojo.ui.editors.ErrorDialogContent");var k=mstrmojo.func.composite,M=mstrmojo.dom,a=mstrmojo.Button.newWebButton,C=mstrmojo.css,Z=mstrmojo.all,N=mstrmojo.hash,c=mstrmojo.DI.DIHelpers,X=mstrmojo.array;function W(r){if(!this.modal){return ;}var s=window.mstrApp;if(s&&s.modalEditorChange){s.modalEditorChange(this.id,r);}}mstrmojo.Editor=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._HasPopup,mstrmojo._IsMovable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.Editor",title:"",allowHTMLTitle:false,help:"",autoClose:false,showTitle:true,openEffect:null,themeClassName:"mojo-theme-light",useRichTooltip:true,closeEffect:null,onEditorResized:null,markupString:'<div id="{@id}" class="mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor {@cssClass}" style="z-index:{@zIndex};{@cssText}" mstrAttach:mouseup,mousedown,click,contextmenu>{@titlebarHTML}<div class="mstrmojo-Editor-content"></div><div class="mstrmojo-Editor-buttons"></div></div><div class="mstrmojo-Editor-curtain"></div></div>',titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:{editorNode:function Y(){return this.domNode.firstChild;},titleContainerNode:function l(){return this.domNode.firstChild.firstChild;},titlebarNode:function n(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},titleNode:function R(){return this.showTitle?this.domNode.firstChild.firstChild.firstChild:null;},helpNode:function o(){return this.showTitle?this.domNode.firstChild.firstChild.children[1]:null;},closeNode:function E(){return this.showTitle?this.domNode.firstChild.firstChild.lastChild:null;},containerNode:function S(){return this.domNode.firstChild.childNodes[2];},buttonNode:function I(){return this.domNode.firstChild.childNodes[3];},curtainNode:function p(){return this.domNode.lastChild;}},markupMethods:{ontitleChange:function(){if(this.showTitle){this.titleNode.innerHTML=this.allowHTMLTitle?this.title:mstrmojo.string.encodeHtmlString(this.title);}},onzIndexChange:function(){var r=this.zIndex;this.editorNode.style.zIndex=r;this.curtainNode.style.zIndex=r-1;},onvisibleChange:function(u){if(u){return ;}var t=this.visible,s="closeEffect",r="none";if(t){s="openEffect";r="block";}if(this[s]){this.playEffect(s);}else{this.editorNode.style.display=r;if(this.modal){this.curtainNode.style.display=r;}}},onhelpChange:function f(){if(this.showTitle){var s=this.help,r=this.helpNode;if(!s){r.style.display="none";}else{r.style.display="block";}}},onleftChange:function F(){this.editorNode.style.left=this.left||"";},ontopChange:function H(){this.editorNode.style.top=this.top||"";}},open:function Q(s,r){this._super(s,r);W.call(this,true);},close:function h(r){this._super(r);W.call(this,false);},unrender:function B(r){this._super(r);W.call(this,false);},destroy:function j(r){this._super(r);W.call(this,false);},preBuildRendering:function A(){if(!this.slot&&!this.placeholder){this.placeholder=document.body.appendChild(document.createElement("div"));this._curtain_to_body=true;W.call(this,true);}this.titlebarHTML=(this.showTitle)?this.titleMarkupString:"<div></div><div></div>";return this._super();},getMovingHandle:function m(){return this.titlebarNode;},getMovingTarget:function V(){return this.editorNode;},onPreClose:function G(){this.hideTooltip();return true;},premousedown:function P(r){var s=r.getTarget();if(s===this.closeNode||s===this.helpNode){C.toggleClass(s,"active",true);}},premouseup:function O(r){var s=r.getTarget();if(s===this.closeNode||s===this.helpNode){C.toggleClass(s,"active",false);}if(r.getTarget()===this.closeNode&&this.onPreClose()){this.close();}},onclick:function e(r){if(r.getTarget()===this.helpNode){if(mstrApp.showHelpTopic){mstrApp.showHelpTopic(this.help);}else{window.open(mstrmojo.helpPath()+(this.help||""),"_blank");return false;}}},_set_visible:function d(x,t){var s=(this[x]!==t);if(s){this[x]=t;var w=this._close_handler;if(t){if(this._curtain_to_body){this.resizeDialog();this.positionDialog();}if(this.autoClose){var u=this;w=this._close_handler=w||function(v){var z=M.eventTarget(self,v);if(z&&z.parentNode&&!M.contains(u.editorNode,z,true,document.body)){u.close();}};M.attachEvent(document.body,"mousedown",w);}}else{var r=this._curtain_handler;if(r){M.detachEvent(window,"resize",r);}if(w){M.detachEvent(document.body,"mousedown",w);}}}return s;},showTooltip:function q(x,w){var v=this,s=M.findAncestorByAttr(M.eventTarget(w,x),"tooltip",true,this.domNode),u=s&&s.value;if(!v.hasOpenTooltip&&u){var r=M.position(s.node);v.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",content:u,top:Math.max(r.y+40,0),left:Math.max(r.x+4,0),posType:mstrmojo.tooltip.POS_TOPCENTER};this._super(x,w);}}});mstrmojo.Editor.openEffect_fadeIn={scriptClass:"mstrmojo.fx.AnimateProp",slot:"curtainNode",props:{backgroundColor:{start:255,stop:0,fn:function(r){r=Math.round(r);return["rgb(",r,",",r,",",r,")"].join("");}}},preStart:function(){var s=this.target,r=this.widget;r.editorNode.style.display="block";if(!r.modal){return false;}s.style.display="block";C.setOpacity(s,60);return true;}};mstrmojo.Editor.closeEffect_fadeOut={scriptClass:"mstrmojo.fx.FadeOut",slot:"curtainNode",start:0.6,stop:0,preStart:function(){var r=this.widget;r.editorNode.style.display="none";return !!r.modal;}};function D(r){return function(){Z[r].destroy();};}function J(s,AA,AB,AC){var r=AA.id||"mojoAlertx9",w,z=AA.buttons;X.forEach(z,function(AE){var AD=AE.onclick;AE.onclick=function(AF){var AG=Z[r];if(AD&&AD.call(AE,AF)===false){return ;}AG.destroy();AG=null;};});try{!!Z[r]&&Z[r].destroy();}catch(x){}var t=AA.cssClass,u=[];if(t){u.push(t);delete AA.cssClass;}if(AC){u.push(AC);}u.push("mstrmojo-alert");w={scriptClass:"mstrmojo.Editor",id:r,width:"475px",zIndex:1000,title:AB||mstrmojo.desc(11812,"Notification"),cssClass:u.join(" "),children:[{scriptClass:"mstrmojo.Box",cssClass:"alert-content",children:[{scriptClass:"mstrmojo.Label",text:s,allowHTML:AA.allowHTML}]}],visible:true};var v=new mstrmojo.Editor(N.copy(AA,w));v.render();return v;}if(window.mstrConfig&&!window.mstrConfig.simpleDialog){mstrmojo.notify=function L(s,z,t){t=t||{};var AA=t.forceClose,x=t.callback||mstrmojo.emptyFn,w=N.copy(z||{},{buttons:AA?[mstrmojo.Button.newActionButton((t.buttonText||mstrmojo.desc(8607,"Dismiss")),x)]:null,showTitle:false,modal:false,top:"42px"}),u=t.duration||6000;var v=J(s,w,"",AA?"ed-notify":"ed-toast"),r=v.id;if(!AA){window.setTimeout(k([x,D(r)]),u);}else{window.setTimeout(function(){if(Z[r]){Z[r].editorNode.style.opacity=0.75;}},6000);}return v;};mstrmojo.confirm=function g(r,x,AA){x=x||{};var t=x.confirmBtn||{},w=x.cancelBtn||{},z=t.hot!==false,s=!!w.hot,v=AA&&AA.title,u=[a(t.t||mstrmojo.desc(219,"Yes"),t.fn,z,t.cfg),a(w.t||mstrmojo.desc(218,"No"),w.fn,s,w.cfg)];return J(r,N.copy(AA||{},{buttons:u,onPreClose:function(){if(w&&w.fn){w.fn();}return true;}}),v,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};mstrmojo.warn=function K(t,r,s){s=s||{};s.cssClass=(s.cssClass||"")+" mstrmojo-warning";return mstrmojo.confirm(t,r,s);};mstrmojo.alert=function b(w,t,v,x,r,u){var s={title:v||mstrmojo.desc(12405,"Alert"),zIndex:x,cssClass:r,buttons:[a(mstrmojo.desc(1442,"OK"),t,true)],onPreClose:function(){if(t){t();}return true;}};N.forEach(s,function(AA,z){if(!AA){delete s[z];}});return J(w,N.copy(u,s),v,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};mstrmojo.error=function U(w,s,v){var t=w||{};var u=mstrmojo.desc(96,"Error");var r=!(c.getEnvObj().isInDI()||c.getEnvObj().isInQB());if(v){u=(v.title)?v.title:mstrmojo.desc(96,"Error");v.title=u;if(v.enableContactStr===false){r=false;}}J("",N.copy(v||{},{buttons:[a(mstrmojo.desc(1442,"OK"),s,true)],children:[{scriptClass:"mstrmojo.ui.editors.ErrorDialogContent",shortDesc:t.shortDesc,longDesc:t.longDesc,showToggle:!!(t.longDesc),enableContactStr:r,allowHTML:!!(v&&v.allowHTML===true)}]}),u,c.getEnvObj().isStandaloneDataSet()?["error-dialogue-in-dataset"]:[]);};}mstrmojo.Editor.ButtonConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.DocSection","mstrmojo._HasLayout","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui.rw._SavesChildPositions");mstrmojo.vi.ui.rw.DocSection=mstrmojo.declare(mstrmojo.DocSection,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocSection",layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true},alias:"docSection"});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.MenuPopup");mstrmojo.ui.menus.PopupConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.PopupConfig",cssClass:"",hasToggleItem:false,contents:null,clear:function A(){this._super();this.contents=null;},close:function C(){([].concat(this.contents)[0]).parent.closeAllMenus();},newInstance:function B(){return new mstrmojo.ui.menus.MenuPopup({popupConfig:this});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(1442,2140);var D=mstrmojo.dom,E=mstrmojo.array;function G(L,N){var K=2140,P="Cancel",O="this.parent.popupConfig."+(L?"ok":"cancel"),M=N&&N[(L?"ok":"cancel")+"BtnText"];if(L){K=1442;P="Ok";}return mstrmojo.Button.newWebButton(M||mstrmojo.desc(K,P),function(R){var S=this.parent,Q=S.popupConfig;S.closeAllMenus();Q["fn"+P](Q.data,S);D.stopPropogation(R.hWin,R.e);},L,{slot:"btnNode",bindings:{enabled:O+"Enabled",visible:O+"Visible"},cssDisplay:"inline-block"});}mstrmojo.ui.menus.MenuEditor=mstrmojo.declare(mstrmojo.ui.menus.MenuPopup,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.menus.MenuEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-MenuEditor {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="scroll-container" style="{@scCssText}"><div class="me-content"></div><div class="me-buttons"></div><div class="me-bottom"></div></div></div>',markupSlots:{containerNode:function C(){return this.domNode.firstChild.firstChild;},btnNode:function H(){return this.domNode.firstChild.children[1];},bottomNode:function H(){return this.domNode.firstChild.children[2];},scrollNode:function(){return this.domNode.firstChild;},scrollbarHostNode:function(){return this.domNode;}},popupConfig:null,postBuildRendering:function A(K){this._super(K);if(this.popupConfig&&this.popupConfig.supportsScroll){var L=this;window.setTimeout(function(){L.updateScrollbars();},10);}},onmouseover:function J(L){var K=this.popupConfig;if(K&&!K.isHostedWithin&&this.opener){this.opener.raiseEvent(mstrmojo._HasMarkup.newDomEvent(L.name,L.hWin,L.e,{targetHostElement:K.hostElement}));}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll){var L=this.scrollNode;if(!L){return ;}var K=D.getComputedScrollbarWidth(L);L.style.marginRight=-K+"px";L.style.paddingRight=0;}},monitorWindow:function F(){var L=document.activeElement,K=null;if(L!==null&&L.id!==""){K=this.domNode.querySelector("#"+L.id)?L:null;}this._super();if(K){K.focus();}},init:function I(M){this._super(M);var L=this.popupConfig,K=L.bottomNode;if(L&&L.supportsScroll&&L.maxHeight>0){if(L.cssClass.indexOf("RoleMenu")>-1){L.maxHeight=360;}this.cssText=(this.cssText||"")+";max-height:"+L.maxHeight+"px";this.scCssText=(this.scCssText||"")+";max-height:"+L.maxHeight+"px";}if(!!mstrApp.isWSStyling){this.themeClassName="mojo-theme-light";}this.data=L.data||{};if(L.onOpen){this.onOpen=L.onOpen;}this.addChildren([G(true,L),G(false)]);if(K){K.slot="bottomNode";this.addChildren(K);}},onOpen:function B(){E.forEach(this.children,function(K){if(K.scriptClass==="mstrmojo.ui.ScrollableContainer"&&K.onOpen){K.onOpen();}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextArea","mstrmojo.ui._HasScroller");function E(){var L=this.inputNode,F=L.style,J=this.scrollNode,G=J.scrollTop,M=parseInt(F.height),N=L.scrollHeight,I=M<N,H=M>J.clientHeight;if(I){F.height=N+"px";}else{if(H){var K=M;while(K>0&&L.offsetHeight===L.scrollHeight){F.height=--K+"px";}F.height=K+1+"px";}}if(I||H){this.updateScrollbars();}if(I){J.scrollTop=G+(N-M);}}mstrmojo.ui.ScrollableTextArea=mstrmojo.declare(mstrmojo.TextArea,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableTextArea",markupSlots:{scrollNode:function(){return this.domNode.firstChild;},inputNode:function(){return this.domNode.firstChild.firstChild;}},cssDisplay:"block",init:function D(F){this.markupString='<div class="mstrmojo-ui-TextArea {@cssClass}"><div class="ta-sc">'+this.markupString+"</div></div>";this._super(F);},postBuildRendering:function A(){this._super();var G=this.inputNode,F=G.style;F.height=G.scrollHeight+"px";},onRender:function C(){this._super();E.call(this);},prevalueChange:function B(){if(!this.hasRendered){return ;}E.call(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.ImageBoxOverlay");mstrmojo.vi.ui.rw.ImageBoxOverlayURL=mstrmojo.declare(mstrmojo.vi.ui.rw.ImageBoxOverlay,[],{scriptClass:"mstrmojo.vi.ui.rw.ImageBoxOverlayURL",markupString:'<div id="{@id}" class="mstrmojo-ImageBoxOverlayURL cf {@cssClass}" style="{@domNodeCssText}"><div class="container-scroll-host"><div class="container"><div class="lbl"></div><div class="txt"></div><div class="btn"></div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.firstChild.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.firstChild.children[1];},buttonNode:function(){return this.domNode.firstChild.firstChild.lastChild;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.css","mstrmojo.hash");var D=mstrmojo.dom,C=mstrmojo.css,G=mstrmojo.hash,B=9,F="px";mstrmojo.AttributeSlider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.AttributeSlider",thumbWidth:7,synchronizeSlider:function A(){if(this.isHoriz){var O=this.orCfg,N=O.lenCssP,J=this[N],H=parseInt(J,10),S=this.hasRendered;var K=this._effLen=isNaN(H)?0:(H-this._exRoom-(2*B));if(J){var R={};R[N]=Math.max(parseInt(J,10)-(2*this.cssBkBW),0)-(2*B)+F;var L={};L[N]=K+F;L[O.posCssP]=Math.round(this._exRoom/2)+B+F;L[O.opPosCssP]="0"+F;if(S){G.copy(R,this.bgNode.style);G.copy(L,this.sdcNode.style);}else{this.bkCssText=C.getCssTextFromObj(R);this.sdcCssText=C.getCssTextFromObj(L);}}var V=this.selectedIndices;if(!G.isEmpty(V)){var Q=this.items.length,M=-1,U=-1,P;for(P=0;P<Q;P++){if(V[P]){if(M<0){M=P;}U=P;}else{if(M>-1){break;}}}this.min=M;this.max=U;}var I=this.typeHelper;this.unit=I.getUnit();if(S){I.updateThumb();}else{I.preUpdateThumb();}}else{this._super();}},postBuildRendering:function E(){this._super();C.addClass(this.containerNode,["attslider"]);C.addClass(this.frontNode,["attslider"]);C.addClass(this.thumbNode,["attslider"]);C.addClass(this.endNode,["attslider"]);C.addClass(this.bgNode,["attslider"]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.num");var F=mstrmojo.dom,G=mstrmojo.css,C=mstrmojo.hash,M=Math.max,H=Math.min;mstrmojo.vi.ui.rw.selectors.Slider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.Slider",markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation}" style="{@cssText}" ><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div class="t3" style="{@handel2CssText}" mstrAttach:mouseout></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3]];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onlowTextChange:function(){this.lowNode.innerHTML=this.lowText||"";},onhighTextChange:function(){this.highNode.innerHTML=this.highText||"";},onwidthChange:function(){this.synchronizeSlider();},onmultiSelectChange:function(){G.toggleClass(this.domNode,"scm",this.multiSelect);G.toggleClass(this.domNode,"sc1",!this.multiSelect);}},thumbWidth:16,sliderDefaultWidth:95,multiSelect:true,init:function P(Q){this._super(Q);this.updateTypeHelper();},updateTypeHelper:function B(){var Q=C.walk("vi.ui.rw.selectors.SliderHelper",mstrmojo);this.typeHelper=new Q({slider:this});},synchronizeSlider:function E(){var S=this.orCfg,U=this.typeHelper,W=S.lenCssP,R=this.thumbWidth,V=parseInt(this[W],10),Q;V=(isNaN(V)||V<=0)?this.sliderDefaultWidth:V;Q=M(V-R,0);if(Q>0){var Y=M(V-(2*this.cssBkBW),0),X=Q;this.bkCssText=W+":"+Y+"px;";this.sdcCssText=S.posCssP+":0px;"+W+":"+X+"px;"+S.opPosCssP+":-1px;";if(this.hasRendered){this.bgNode.style[W]=Y+"px";this.sdcNode.style[W]=X+"px";}}this._effectiveLength=Q;U.initialSlider();U.updateThumb();U.updateSummary();},refresh:function(){this.updateTypeHelper();this._super();},createGhost:function K(){var S=this.containerNode.cloneNode(true),R=S.childNodes,Q;G.addClass(S,["gh"]);S.style.display="none";Q=this.ghost={containerNode:S,lowerRange:R[0],handle1Node:R[1],thumbNode:R[2],handle2Node:R[3],upperRange:R[4]};this.sdcNode.appendChild(S);return Q;},configureGhost:function D(U){var V=this.ghost;if(!V){V=this.createGhost();}var R=this.orCfg,Q=R.posCssP,S=R.lenCssP,W=this.id;mstrmojo.array.forEach(["lowerRange","containerNode","thumbNode","upperRange"],function(b,X){var a=mstrmojo.all[W],Z=a[b].style,Y=V[b].style;if(X){Y[Q]=Z[Q];}Y[S]=Z[S];});if(U){V.containerNode.style.display="block";}return V;},initDrag:function L(V,Q){Q=Q||window;var W=F.eventTarget(Q,this.dnd.startE);if(W===this.handle1Node||W===this.handle2Node){var U=this.configureGhost(true),R=this.orCfg,S=this.dnd;S.initD={handle1:parseFloat(this.handle1,10),handle2:parseFloat(this.handle2,10),length:this._effectiveLength,contL:U.containerNode[R.lenP],offset:F.getMousePosition(this.dnd.startE,Q)[R.offsetP]};S.initD.td=W;G.removeClass(this.domNode,["invalid"]);}},ondrag:function O(Y,X){if(this.enabled===false){return ;}var V=this.typeHelper;X=X||window;var a=this.dnd.initD;if(a){var f=this.ghost,g=a.handle1,U=a.handle2,W=this.cs1Idx,S=this.cs2Idx,R=a.length;var c=F.getMousePosition(Y,X)[this.orCfg.offsetP]-a.offset;switch(a.td){case this.handle1Node:g=M(H(M(a.handle1+c,0),R),-1);W=V.getIdxByPx(g);break;case this.handle2Node:U=M(H(M(a.handle2+c,0),R),-1);S=V.getIdxByPx(U);break;default:return ;}V.positionSliderElements(f,g,U);var Z=this.items,Q=(Z&&Z.length)||0;if(Q&&W>=0&&W<Q&&S>=0&&S<Q){var d=false,b;if(W!==this.cs1Idx){this.cs1Idx=W;b=this.items[W];this.cs1Vl=b.v;this.cs1Nm=b.n;d=true;}if(S!==this.cs2Idx){this.cs2Idx=S;b=this.items[S];this.cs2Vl=b.v;this.cs2Nm=b.n;d=true;}if(d){V.updateThumb();this._updateTooltip({target:a.td});}}}},ondrop:function I(R){this.typeHelper.updateThumb();var Q=this.ghost;if(Q){Q.containerNode.style.display="none";}this.hideTooltip(R,self);if(this.items&&this.items.length){this.onselectionChange();}this.dnd.initD=null;},onclick:function N(b){var U=b.getTarget();if(U===this.lowerRange||U===this.upperRange||U===this.thumbNode){var V=this.typeHelper,R=this.orCfg.offsetP,c=F.getMousePosition(b.e)[R],Z=c-F.position(this.handle1Node)[R],X=c-F.position(this.handle2Node)[R],Y=this.items,W,S,Q,a,d=false;if(Y.length<2){return ;}if(Math.abs(Z)<Math.abs(X)){Q=M(H(M(parseFloat(this.handle1,10)+Z,0),this._effectiveLength),-1);W=V.getIdxByPx(Q);if(this.cs1Idx!==W){this.cs1Idx=W;a=Y[W];this.cs1Vl=a.v;this.cs1Nm=a.n;d=true;}}else{Q=M(H(M(parseFloat(this.handle2,10)+X,0),this._effectiveLength),-1);S=V.getIdxByPx(Q);if(this.cs2Idx!==S){this.cs2Idx=S;a=Y[S];this.cs2Vl=a.v;this.cs2Nm=a.n;d=true;}}if(d){this.onselectionChange();V.updateThumb();}}},onselectionChange:function A(Q){var R=this.typeHelper;R.updateSelection();R.updateSummary();this._super(Q);if(this.dnd&&this.dnd.initD){this.dnd.initD=null;}},_updateTooltip:function J(V,U){var W=F.eventTarget(U,V);if(W){var R="<span {@ttpCssText}>{@content}</span>",Q=String((W===this.handle1Node)?this.cs1Nm:this.cs2Nm).replace("$","$$$$"),S={cssClass:"mstrmojo-VISlider vi-regular vi-tooltip-V "+mstrApp.getThemeClassName(),content:R.replace(/\{@content\}/g,Q),contentNodeCssClass:"scm-tooltip",refNode:W,posType:this._tooltip_pos};this.set("richTooltip",S);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors._HasWarningMessage","mstrmojo.dom","mstrmojo.hash","mstrmojo.imageUtils");mstrmojo.requiresDescs(1212);var C=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition,F=mstrmojo.dom,H=mstrmojo.imageUtils,G=mstrmojo.hash,E=1<<20,A=3,D=10*E;var B={SUCCESS:0,OVER_SIZE:1,INVALID_FILE_TYPE:2,OVER_SIZE_NO_COMPRESSION:3};mstrmojo.vi.ui.rw._ValidInputLocalImage=mstrmojo.provide("mstrmojo.vi.ui.rw._ValidInputLocalImage",{_mixinName:"mstrmojo.vi.ui.rw._ValidInputLocalImage",imageBox:undefined,validationStatus:undefined,fileSizeAfterCompressedInMB:undefined,VALID_MIME_TYPES:["image/png","image/jpeg","image/bmp","image/gif"],validationFailed:function(){mstrApp.hideWait();},validationSuccess:function(I){mstrApp.hideWait();if(this.imageBox){this.imageBox.localImageAdded(I);}},getValidationObj:function(){var J=this.validationStatus,I={},K={refNode:this.domNode,invalid:true,position:C.BOTTOM,closeOnClick:true,lasting:12000,highlight:false};I[B.OVER_SIZE]={errorCode:"imageSizeExceedLimitVIWarning",args:[A,this.fileSizeAfterCompressedInMB||A]};I[B.OVER_SIZE_NO_COMPRESSION]={errorCode:"imageOverSizeNoCompessionVIWarning",args:[A]};I[B.INVALID_FILE_TYPE]={errorCode:"imageFileTypeNotSupportedVIWarning",args:[]};return I[J]?G.copy(K,I[J]):undefined;},fileSelected:function(K){var M=this;var N=new Image(),I=new FileReader();var L=(mstrApp.isSingleTier&&K.fileBlob)?K.fileBlob:K;N.mime_type=L.type;var J={file:L,imageName:K.name};if(this.VALID_MIME_TYPES.indexOf(N.mime_type)===-1){M.validationStatus=B.INVALID_FILE_TYPE;M.validationFailed();return ;}mstrApp.showWait({message:mstrmojo.desc(1212,"Processing...")});if(L.size>=D){M.validationStatus=B.OVER_SIZE_NO_COMPRESSION;M.validationFailed();return ;}I.onload=function(O){N.src=O.target.result;N.onload=function(){var P=A*E,R=J.file.size;if(R<P){J.base64Str=N.src;J.imageData=H.dataURLToBlob(N.src);J.imageSize=J.imageData.size;}else{if(N.mime_type==="image/gif"){M.validationStatus=B.OVER_SIZE_NO_COMPRESSION;M.validationFailed();return ;}else{var S=75;if(N.naturalWidth>=1920&&N.naturalHeight>=1080){S=45;}var V="jpg";if(N.mime_type==="image/png"){V="png";}var U=H.compress(N,S,V);J.base64Str=U.src;J.imageData=H.dataURLToBlob(U.src);J.imageSize=J.imageData.size;}}var Q=J.imageSize;M.fileSizeAfterCompressedInMB=Math.min(Q,J.file.size)/E;M.fileSizeAfterCompressedInMB=M.fileSizeAfterCompressedInMB.toFixed(1);if(Q>P){M.validationStatus=Q>=R?B.OVER_SIZE_NO_COMPRESSION:B.OVER_SIZE;M.validationFailed();return ;}M.validationSuccess(J);};N.onerror=function(){M.validationStatus=B.INVALID_FILE_TYPE;M.validationFailed();};};I.onerror=function(){M.validationStatus=B.INVALID_FILE_TYPE;M.validationFailed();};I.readAsDataURL(L);}});}());(function(){mstrmojo.requiresCls("mstrmojo.TextBox","mstrmojo._CanValidate","mstrmojo.css","mstrmojo.validation","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");var H=mstrmojo.css,E=mstrmojo.validation,G=E.TRIGGER,J=E.STATUSCODE;function F(L){if((this.constraints.trigger&L)>0){this.validate();}}mstrmojo.ValidationTextBox=mstrmojo.declare(mstrmojo.TextBox,[mstrmojo._CanValidate,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.ValidationTextBox",validationDelay:500,getInvalidMsg:function K(L){return(L&&L.msg?L.msg:"");},postBuildRendering:function A(){this._super();this._original_tooltip=this.inputNode.title;},prekeyup:function I(L){this._super(L);var P=(this.constraints.trigger&G.ONKEYUP)>0;if(P){var M=this.validationDelay;if(M){this.clearValDelayTimer();var O=this._validateHandler;if(!O){var N=this;this._validateHandler=O=function(){N.validate();if(N._valDelayTimer){window.clearTimeout(N._valDelayTimer);delete N._valDelayTimer;}};}this._valDelayTimer=window.setTimeout(O,M);}else{this.validate();}}},preinput:function D(L){this._super(L);F.call(this,G.ONKEYUP);},preblur:function B(L){this._super(L);F.call(this,G.ONBLUR);},clearValidation:function C(){this._super();var L=this.inputNode;H.removeClass(L,this.constraints.invalidCssClass||"mstrmojo-TextBox-ErrValidation");L.title=this._original_tooltip;},clearValDelayTimer:function(){var L=this._valDelayTimer;if(L){window.clearTimeout(L);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ValidationTextBox,{onvalidationStatusChange:function(){var P=this.validationStatus;if(!P){return ;}var N=this.inputNode,L=(P.code>J.VALID),M=this.constraints.invalidCssClass;H.toggleClass(N,M||"mstrmojo-TextBox-ErrValidation",L);var O=L?this.getInvalidMsg(P):this._original_tooltip;if(!this.useRichTooltip&&O!==undefined&&O!==null){N.setAttribute("title",O);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.SuggestionList","mstrmojo.ui._HasListTooltip");mstrmojo.vi.ui.editors.nlp.RichSuggestionList=mstrmojo.declare(mstrmojo.SuggestionList,[mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.vi.ui.editors.nlp.RichSuggestionList",useRichTooltip:true,tooltipOrientation:"vertical",getItemMarkup:function(C,B){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}">{@html}</{@tag}>';},getItemProps:function A(D,B){var C=this._super(D,B);C.html=D.html;return C;},onclick:function(B){var C=this.getItemFromTarget(B.getTarget());if(C&&C.type==="dummy"){return ;}this._super(B);},singleSelect:function(C,D,B){if(C>-1){var E=this.items[C];if(E&&E.type==="dummy"){return ;}this._super(C,D,B);}},doItemSelect:function(C,B){if(C&&C.type==="dummy"){return ;}this._super(C,B);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.css","mstrmojo.ui._HasListTooltip");var E=mstrmojo.css;var C;mstrmojo.ui.IconTooltipCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.IconTooltipCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu,mouseover><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function F(){return this.domNode.firstChild.firstChild;}},getItemMarkup:function I(L){if(!C){var K='><span class="text">{@en@n}</span> <span class="{@iconCss}" ttp="{@ttp}"></span><';C=this._super(L).replace(">{@en@n}<",K);}return C;},markupslots:{scrollboxNode:function A(){return this.domNode.firstChild;},itemsContainerNode:function F(){return this.domNode.firstChild.firstChild;}},getItemProps:function G(N,L){var M=this._super(N,L),K={"\r\n":" ","\n":" ","\r":" "};if(N.css){M.addCls(N.css);}M.ttp=N.ttp||"";M.iconCss=N.iconCss||"";N.n=mstrmojo.string.multiReplace(N.n,K);M.n=N.n||"";return M;},postBuildRendering:function B(){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-D",refNode:this.itemsContainerNode,posType:mstrmojo.tooltip.POS_TOPRIGHT,keepArrowXPos:false});},useRichTooltip:true,tooltipOffset:0,tooltipMarkup:'<div class="content" style="{@style}">{@c}</div>',tooltipOrientation:"horizontal",tooltipCss:{leftCssClass:"no-arrow",rightCssClass:"no-arrow"},showTooltip:function H(L,N){var M=this,K=mstrmojo.dom.position(L.target);M.richTooltip.top=Math.max(K.y+K.h);M.richTooltip.left=Math.max(K.x+4,0);this._super(L,N);},getTooltipText:function D(K){return K.ttp;},onmouseover:function J(K){var O=this.id,L=mstrmojo.all[O],N=K.getTarget(),M=N.getAttribute("ttp");if(!M){return ;}L.richTooltip.content=M;L.showTooltip(K.e,self);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._CanAutoClose","mstrmojo._IsPopup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus._IsMenuPopup","mstrmojo.ui.PopupConfig","mstrmojo.ui._HasScroller","mstrmojo.ui._HasUITheme","mstrmojo.dom","mstrmojo.css","mstrmojo.ui._HasListTooltip");var E=mstrmojo.dom,H=mstrmojo.css,F=mstrmojo.ui.PopupConfig.directionCfg;var C={};var B=false;function O(W,X){if(W.pop){if(X&&W.ax){window.clearTimeout(this._popupAxTimeout);W.actionFn();this.closeAllMenus();}else{var U=W.fn.call(mstrmojo.all[W.scope],W.ctxt);var V=U.ENUM_CORNERS,S=U.maxHeight,R=E.getMaxScrollHeight();U.setAlignment(V.TOP_RIGHT,V.TOP_LEFT);U.hostId=this.id;U.hostElement=this._getItemNode(W._renderIdx);U.includeScroll=this.includeScroll;U.supportsScroll=true;U.alignWithAnchor=true;U.isHostedWithin=false;U.maxHeight=S?Math.min(R,S):R;this.openPopup(U.newInstance());}}else{if(W.dsbld!==true){if(W.fn(W,this)!==false){this.closeAllMenus();}}}}mstrmojo.ui.menus.Menu=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._IsPopup,mstrmojo.ui.menus._IsMenuPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip,mstrmojo.ui._HasScroller,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.ui.menus.Menu",selectionPolicy:"reselect",locksHover:true,closeOnClick:true,themeClassName:"mojo-theme-dark",icnCss:"mstrmojo-ui-Menu-item-container",popupConfig:null,tooltipCss:{leftCssClass:"menuTooltip",rightCssClass:"menuTooltip"},setupScrollNodes:function(){if(this.popupConfig&&this.popupConfig.supportsScroll){this.scrollNode=this.itemsContainerNode;this.scrollbarHostNode=this.domNode;}},updateScrollbars:function(){this._super();if(this.popupConfig&&this.popupConfig.supportsScroll&&this.hasCustomScrollbar){var S=this.scrollNode;if(!S){return ;}var R=E.getComputedScrollbarWidth(S);S.style.marginRight=-R+"px";S.style.paddingRight=0;}},onscroll:function(){this.closePopup();this._super();},init:function P(U){this._super(U);if(!!mstrApp.isWSStyling){this.themeClassName="mojo-theme-light";}if(U.themeClassName){this.themeClassName=U.themeClassName;}var R=this.popupConfig;this.items=R.getMenuItems();var S=["mstrmojo-ui-Menu","unselectable"],V=R.menuCssClass;if(V){S.push(V);}if(R.hasToggleItem){S.push("hasToggleItem");}H.addWidgetCssClass(this,S);if(R&&R.supportsScroll&&R.maxHeight>0){this.icnCssText=(this.icnCssText||"")+";max-height:"+R.maxHeight+"px";}this.useRichTooltip=!!R.useTooltip;this.tstid=R.tstid;},markupMethods:{onvisibleChange:function M(){var R=this.visible;if(!B||R){H.toggleClass(this.domNode,"visible",R);}}},getItemMarkup:function L(X,S){if(X.getItemMarkup){return X.getItemMarkup.apply(this,[X,S]);}var V=!!X.pop,W=V?"submenu":"item",U=C[W],R='<div class="micn"></div>';if(!U){R+=!!mstrApp.isWSStyling?'<div class="mtxt">{@en@n}</div>':"{@en@n}";if(V){R+='<div class="arw"></div>';}U=this._super(X,S).replace("{@en@n}",R);C[W]=U;}if(X.tstid){U=U.replace("{@tag}","{@tag} "+mstrmojo.tstid(X)+" ");}return U;},getItemProps:function J(U,R){var S=this._super(U,R);S.tag="a";S.addCls("mstrmojo-ui-Menu-item");S.addCls(U.cls);return S;},onmouseover:function Q(Y){var W=Y.config&&Y.config.targetHostElement?Y.config.targetHostElement:Y.getTarget(),a=this.getItemFromTarget(W),X=this,S=X._lastOpened,R=S&&this.getItemFromTarget(S.popupConfig.hostElement)._renderIdx,U=this.getItemNodeFromTarget(W),V=(R!==undefined&&E.contains(this._getItemNode(R),W,true,this.domNode));if(a){this._lastHoverIx=a._renderIdx;window.clearTimeout(this._popupTimeOut);window.clearTimeout(this._popupAxTimeout);if(this._lastHoverIx!==R&&!V){this._popupTimeOut=window.setTimeout(function(){if(X._lastOpened&&X._lastOpened.visible){X.closePopup();}if(X.visible&&a.pop){if(a.ax){X._popupAxTimeout=window.setTimeout(function(){H.removeClass(U,"hlt-ax");O.call(X,a);},0);}else{O.call(X,a);}}},400);if(a.pop&&a.ax){H.addClass(U,"hlt-ax");}}}var Z=this.popupConfig;if(Z&&!Z.isHostedWithin&&this.opener){this.opener.raiseEvent(mstrmojo._HasMarkup.newDomEvent(Y.name,Y.hWin,Y.e,{targetHostElement:Z.hostElement}));}},onclick:function N(R){this._evtTarget=R.getTarget();this._super(R);R.cancel();},postselectionChange:function D(R){var S=R.added;if(S){var U=this.items[S[0]];O.call(this,U,!(U.ax&&this._evtTarget.className==="arw"));delete this._evtTarget;}},oncontextmenu:function G(R){E.preventDefault(window,R.e);return false;},postBuildRendering:function A(R){this._super(R);if(this.popupConfig.supportsScroll){var S=this;window.setTimeout(function(){S.updateScrollbars();},10);}},showTooltip:function K(W,V){var U=E.eventTarget(V,W),S=this.getItemNodeFromTarget(U),R=this.getItemFromTarget(U);this.itemDisabled=R&&R.dsbld;if(S&&((R&&R.ttp)||(S.scrollWidth>S.clientWidth)||(U.scrollWidth>U.clientWidth))){this._super(W,V);}},onCloseMenuCallBack:null,onClose:function I(R){if(this._super){this._super(R);}this.closePopup();if(this.onCloseMenuCallBack){this.onCloseMenuCallBack();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.ui._HasListTooltip");mstrmojo.ui.PopupList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PopupList",autoCloses:true,locksHover:true,closeOnClick:true,scrollNodeMaxHeight:undefined,parentDomNode:undefined,keydownString:null,lastKeydownTime:null,keydownInterval:500,closeAfterSelection:true,markupString:'<div id="{@id}" class="mstrmojo-PopupList {@cssClass}" style="{@cssText}" tabIndex="-1" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu,keydown><div class="mstrmojo-popupList-scrollBar"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function I(){return this.domNode.firstChild.firstChild;},scrollboxNode:function A(){return this.domNode.firstChild;}},setupScrollNodes:function F(){this.scrollNode=this.scrollboxNode;},onOpen:function E(){this._super();this.updateScrollbars();var M=this;setTimeout(function(){M.scrollToSelectedItem();},10);},onclick:function K(M){this.closeAfterSelection=true;this._super(M);},postBuildRendering:function B(){var N=this._super();if(!this.parent){var M=this.parentDomNode=this.parentDomNode||document.body;M.appendChild(this.domNode);}return N;},closePopup:function J(){this.set("visible",false);},onkeydown:function H(O){if(!this.opener||!this.opener.focusOnPopup){return ;}var M=O.hWin,R=O.e||M.event,U=this.keydownString;this.locksHover=false;this.closeAfterSelection=false;if(R.keyCode===mstrmojo.Enum_Keys.DOWN_ARROW){if(this.selectedIndex<this.items.length-1){this.set("selectedIndex",this.selectedIndex+1);this.scrollToSelectedItem();}}else{if(R.keyCode===mstrmojo.Enum_Keys.UP_ARROW){if(this.selectedIndex>0){this.set("selectedIndex",this.selectedIndex-1);this.scrollToSelectedItem();}}else{if(R.keyCode===mstrmojo.Enum_Keys.ENTER||R.keyCode===mstrmojo.Enum_Keys.ESCAPE){this.closeAfterSelection=true;this.singleSelect(this.selectedIndex);}else{var S=new Date(),P=S.getTime(),N=String.fromCharCode(R.keyCode).toLowerCase(),Q=this;if(this.lastKeydownTime===null){this.keydownString=N;}else{if(P-this.lastKeydownTime<this.keydownInterval){this.keydownString=this.keydownString+N;}else{this.keydownString=N;}}U=this.keydownString;if(this._holdTimer){clearTimeout(this._holdTimer);}this._holdTimer=setTimeout(function(){Q.changeSelectedItem(O);Q.adjustPosition();},Q.keydownInterval);this.lastKeydownTime=P;}}}},changeSelectedItem:function D(M){var P=this.selectedIndex,O=this.items&&this.items.length;if(O>0){var N;for(N=this.selectedIndex+1;N<this.items.length;N++){if(this.items[N].n.toLowerCase().indexOf(this.keydownString)==0){P=N;break;}}if(P===this.selectedIndex){for(N=0;N<this.selectedIndex;N++){if(this.items[N].n.toLowerCase().indexOf(this.keydownString)==0){P=N;break;}}}if(P!==this.selectedIndex){this.set("selectedIndex",P);}}},focus:function L(){this.domNode.focus();},scrollToSelectedItem:function G(){var P=this.itemsContainerNode.childNodes[this.selectedIndex];if(P){var M=this.scrollNode,O=M.clientHeight,N=P.offsetTop;if(N-M.scrollTop+P.offsetHeight>O){M.scrollTop=P.offsetTop+P.offsetHeight-O;}else{if(N<M.scrollTop){M.scrollTop-=P.offsetHeight;}}}},adjustPosition:function C(){this.adjustCornersForPopupOverflow();this.scrollToSelectedItem();this.focus();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.ListBoxBase");mstrmojo.ButtonItemRenderer=mstrmojo.hash.copy(mstrmojo.DivItemRenderer);mstrmojo.ButtonItemRenderer.render=function(D,A,E){var B=D.v!=="u;"?" nAll":"",C=(E.enabled===false);return'<input mstridx="'+A+'" class="'+E.itemCssClass+(E.selectedIndices[A]?" "+E.itemSelectedCssClass:"")+" "+(D.css||"")+B+'" style="'+E.itemCssText+'" type="button"  value="'+D[E.itemDisplayField]+'" '+(C?"disabled ":"")+"/>";};mstrmojo._RendersItemButtons=mstrmojo.hash.copy(mstrmojo._RendersItemDivs);mstrmojo._RendersItemButtons.itemRenderer=mstrmojo.ButtonItemRenderer;mstrmojo.ButtonList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersItemButtons],{scriptClass:"mstrmojo.ButtonList",cssClass:"mstrmojo-ButtonList",itemCssClass:"mstrmojo-ButtonItem",selectionPolicy:"toggle"});mstrmojo.requiresCls("mstrmojo.ListBoxHoriz");mstrmojo.ButtonListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersItemButtons],{scriptClass:"mstrmojo.ButtonListHoriz",cssClass:"mstrmojo-ButtonListHoriz",itemCssClass:"mstrmojo-ButtonItem",selectionPolicy:"toggle"});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.color");var C=[127,206,255];var D=[216,230,239];var B=function(H,K){if(!H||H==="transparent"){H="#FFFFFF";}var G=mstrmojo.color.hex2rgb(H),J,I,E;if(!K){J=Math.round((3/5)*parseInt(G[0])+110);I=Math.round((3/5)*parseInt(G[1])+110);E=Math.round((3/5)*parseInt(G[2])+110);}else{J=G[0]*K[0]/255;I=G[1]*K[1]/255;E=G[2]*K[2]/255;var F=G[0]*0.3+G[1]*0.59+G[2]*0.11;if(F<85){J=J+(63*((85-F)/85));if(J>255){J=255;}I=I+(63*((85-F)/85));if(I>255){I=255;}E=E+(96*((85-F)/85));if(E>255){E=255;}}}return"#"+mstrmojo.color.rgb2hex(J,I,E);};var A=function(F,G,E){if(F&&F.style){F.style.backgroundColor=G["bg"+E+"Color"]||"";F.style.color=G["text"+E+"Color"]||"";}};mstrmojo.LinkItemRenderer=mstrmojo.hash.copy({render:function(G,E,H){var F=G.v!=="u;"?" nAll":"";return'<input mstridx="'+E+'" class="'+H.itemCssClass+(H.selectedIndices[E]?" "+H.itemSelectedCssClass:"")+F+'" style="'+H.itemCssText+" color:"+(H.selectedIndices[E]?H.textSelectedColor:H.textNormalColor)+"; background-color:"+(H.selectedIndices[E]?H.bgSelectedColor:H.bgNormalColor)+';" type="button"  value="'+G[H.itemDisplayField]+'"  onmouseover="mstrmojo.all.'+H.id+".onmouseover(self, "+E+')" onmouseout="mstrmojo.all.'+H.id+".onmouseout(self, "+E+')"/>';},select:function(F,G,E,H){F.className+=" selected";A(F,H,"Selected");},unselect:function(F,G,E,H){F.className=F.className.replace(/selected/g,"");A(F,H,"Normal");},highlight:function(G,H,E,I){var F=I.selectedIndices[E]?"Selected":"Highlighted";A(G,I,F);},unhighlight:function(G,H,E,I){var F=I.selectedIndices[E]?"Selected":"Normal";A(G,I,F);}},mstrmojo.hash.copy(mstrmojo.DivItemRenderer));mstrmojo._RendersItemLinks=mstrmojo.hash.copy({onmouseover:function(G,E){if(isNaN(E)||E<0){return ;}var F=this._getItemNode(E);this.itemRenderer.highlight(F,this.items[E],E,this);},onmouseout:function(G,E){if(isNaN(E)||E<0){return ;}var F=this._getItemNode(E);this.itemRenderer.unhighlight(F,this.items[E],E,this);},preBuildRendering:function(){this.bgNormalColor=this["background-color"]||this.parent&&this.parent["background-color"];this.bgSelectedColor=this.parent&&this.parent.defn&&this.parent.defn.ssc;if(this.bgSelectedColor!=null){if(this.bgSelectedColor==="transparent"){this.bgHighlightedColor=mstrmojo.LinkList.dftTrptBgHltColor;}else{this.bgHighlightedColor=B(this.bgSelectedColor);}}else{this.bgSelectedColor=B(this.bgNormalColor,C);this.bgHighlightedColor=B(this.bgNormalColor,D);}this.textSelectedColor=(this.bgSelectedColor==="transparent")?mstrmojo.LinkList.dftTrptTxSelColor:mstrmojo.color.getContrastingColor(this.bgSelectedColor,"#ffffff","#000000");this.textHighlightedColor=(this.bgSelectedColor==="transparent")?mstrmojo.LinkList.dftTrptTxHltColor:mstrmojo.color.getContrastingColor(this.bgHighlightedColor,"#ffffff","#000000");this.textNormalColor=this.color;if(this._super){this._super();}}},mstrmojo.hash.copy(mstrmojo._RendersItemDivs));mstrmojo._RendersItemLinks.itemRenderer=mstrmojo.LinkItemRenderer;mstrmojo.requiresCls("mstrmojo.ListBox");mstrmojo.LinkList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersItemLinks],{scriptClass:"mstrmojo.LinkList",cssClass:"mstrmojo-LinkList",itemCssClass:"mstrmojo-LinkList-item",selectionPolicy:"toggle"});mstrmojo.LinkList.dftTrptBgHltColor="#FFFFFF";mstrmojo.LinkList.dftTrptTxSelColor="#FFFFFF";mstrmojo.LinkList.dftTrptTxHltColor="#000000";mstrmojo.requiresCls("mstrmojo.ListBoxHoriz");mstrmojo.LinkListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersItemLinks],{scriptClass:"mstrmojo.LinkListHoriz",cssClass:"mstrmojo-LinkListHoriz",itemCssClass:"mstrmojo-LinkListHoriz-item",selectionPolicy:"toggle"});})();(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.ListBoxHoriz","mstrmojo.string");var B=mstrmojo.string;var A={render:function(G,C,H){var I=(H.htmlName+C),E=H.selectedIndices[C]?"checked ":"",F=E?" selected":"",D=G.v!=="u;"?" nAll":"";return'<div class="'+H.itemCssClass+F+D+'"><input type="'+H.inputType+'" name="'+H.htmlName+'" id="'+I+'" value="'+C+'" '+E+'/><label for="'+I+'" title="'+B.encodeHtmlString(G[H.itemTitleField]||"")+'" style="'+H.labelCssText+'">'+B.encodeHtmlString(G[H.itemDisplayField||"n"])+"</label></div>";},select:function(D){var C=D&&D.firstChild;if(C){if(!C.checked){C.checked=true;}mstrmojo.css.toggleClass(D,"selected",C.checked);}},unselect:function(D){var C=D&&D.firstChild;if(C){if(C.checked){C.checked=false;}mstrmojo.css.toggleClass(D,"selected",C.checked);}},rowHeight:23};mstrmojo._RendersInputItems=mstrmojo.provide("mstrmojo._RendersInputItems",{inputType:null,htmlName:null,itemRenderer:A,init:function(C){this._super(C);if(!this.htmlName){this.htmlName=this.id;}},preclick:function(F){var E=F.hWin,H=F.e,G=mstrmojo.dom.eventTarget(E,H);if(G&&G.nodeName.match(/input/i)){var D=parseInt(G.value,10);if(this.inputType&&this.inputType.match(/radio/i)){this.singleSelect(D);}else{var C=(G.checked)?"add":"remove";this[C+"Select"](D);}}}});mstrmojo._InputList=mstrmojo.declare(mstrmojo.ListBox,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputList"});mstrmojo._InputListHoriz=mstrmojo.declare(mstrmojo.ListBoxHoriz,[mstrmojo._RendersInputItems],{scriptClass:"mstrmojo._InputListHoriz"});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBox","mstrmojo.hash","mstrmojo.string");var B=mstrmojo.hash,A=mstrmojo.string;mstrmojo.ListSelectorItemRenderer=B.clone(mstrmojo.DivItemRenderer);mstrmojo.ListSelectorItemRenderer.render=function(F,C,G){var D=F.v!="u;"?" nAll":"",E=G.getItemName?G.getItemName(F,C):(G.itemDisplayField&&F[G.itemDisplayField]);if(mstrmojo.string.isEmpty(E)){E="<br/>";}return'<div mstridx="'+C+'" class="'+G.itemCssClass+(G.selectedIndices[C]?" "+G.itemSelectedCssClass:"")+D+'" style="'+G.itemCssText+'">'+A.encodeHtmlString(E)+"</div>";};mstrmojo.ListBoxSelector=mstrmojo.declare(mstrmojo.ListBox,null,{itemRenderer:mstrmojo.ListSelectorItemRenderer});})();(function(){mstrmojo.requiresCls("mstrmojo.LegacySuggestionList","mstrmojo.ui._HasScroller");var E=mstrmojo.dom;mstrmojo.ui.ScrollableSuggestionList=mstrmojo.declare(mstrmojo.LegacySuggestionList,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-scrollable-suggestlist {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',markupSlots:{itemsContainerNode:function B(){return this.domNode.firstChild.firstChild;},scrollboxNode:function D(){return this.domNode.firstChild;},scrollNode:function H(){return this.domNode.firstChild;}},onclick:function A(I){var J=this.getItemFromTarget(I.getTarget());if(J){this._super(I);}},onitemsChange:function C(){var I=this;window.setTimeout(function(){I.hideTooltip();I.updateScrollbars();},0);},updateScrollbars:function F(){this._super();var K=this,M=K.scrollNode,I=M.clientWidth,L=K.itemsContainerNode,J=L.clientWidth;L.style.width="auto";window.setTimeout(function(){if(I>J){L.style.width=J+(I-J)+"px";}},10);},useRichTooltip:true,getItemTooltip:function(L,M){var J=E.position(M),K=M.ttp;var I={areaId:L._renderIdx+"text",cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:"",content:K,top:J.y,left:J.x+J.w+6,enableHover:false};return I;},showTooltip:function G(I,L){var K=this.targetEl,J=this.targetItem;if(K&&K.ttp){this.richTooltip=this.getItemTooltip(J,K);if(this.richTooltip){this._super(I,L);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.css","mstrmojo.dom","mstrmojo._HasTooltip");var E=mstrmojo.dom,A=mstrmojo.tooltip,H=mstrmojo.css;var B="only";var C;var L;mstrmojo.vi.ui.rw.selectors.CheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo._HasTooltip],{scriptClass:"mstrmojo.vi.ui.rw.selectors.CheckList",isShowOnly:true,tooltip:"",useRichTooltip:true,init:function N(O){this._super(O);H.addWidgetCssClass(this,"mstrmojo-vi-sel-CheckList");if(E.isSafari){H.addWidgetCssClass(this,"safari-checklist");}},shouldShowTooltip:function F(O,Q){var P=O.target||E.eventTarget(O.hWin,O.e);return P.classList.contains("text");},getTooltipContent:function G(O){var P=O.target||E.eventTarget(O.hWin,O.e);return P&&P.innerText;},updateTooltipConfig:function D(P){var W=P.target||E.eventTarget(P.hWin,P.e),O=E.position(W),R=35,S="vi-tooltip-C",V=A.POS_TOPLEFT;if(!this.multiSelect){R=6;}var U=O.w+R,Q=E.windowDim().w;if(Q<(O.x+U+300)){S="vi-tooltip-D";U=-25;V=A.POS_TOPRIGHT;}this.richTooltip={content:this.getTooltipContent(P),top:-4,cssClass:"vi-regular "+S,left:U,refNode:W,posType:V};},showTooltip:function K(O,P){if(this.shouldShowTooltip(O,P)){this._super(O,P);}},getItemMarkup:function J(P,O){if(!C){C=this._super(P).replace('<span class="text">{@en@n}</span>','<span class="icon"></span><span class="text">{@en@n}</span>');L=this._super(P).replace('<span class="text">{@en@n}</span>','<span class="'+B+'">'+mstrmojo.desc(11573,"only")+'</span><span class="icon"></span><span class="text">{@en@n}</span>');}if(this.isShowOnly&&(!this.multiSelect||(O!==this.allIdx&&O!==this.noneIdx))){return L;}return C;},getItemProps:function I(R,O){var Q=this._super(R,O);if(((this.isHoriz&&(this.orientation!=="v"))||(!this.isHoriz&&this.orientation==="h"))&&this.itemWidthMode===0){var S=this.items.length,P=100/S;if(O===S-1){P=100-((S-1)*P);}Q.addStyle("width:"+P+"%");}return Q;},onclick:function M(O){var Q=O.getTarget(),P=this.getItemFromTarget(Q);if(Q.className===B){if(P){this.docSelector.handleActionInSyncPhase(function(){this.clearSelect();},this);this.select([P._renderIdx]);}}else{if(P){this.doItemSelect(P,O||{});}}}});}());(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList");mstrmojo.requiresCls("mstrmojo.ui.CheckList");mstrmojo.requiresDescs(2121,2122,2125,2127,2123,2124,2126,2128,2129,2130);var D=mstrmojo.desc,C=mstrmojo.array;mstrmojo.express.ui.SubtotalsWidget=mstrmojo.declare(mstrmojo.ui.CheckList,null,{scriptClass:"mstrmojo.express.ui.SubtotalsWidget",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:true,init:function B(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-vi-subtotals");},_set_selectedItems:function(H,F){var E=[],G=this.prevSelection={};C.forEach((F||[]),function(I){E.push(I.t);});C.forEach(E,function(I){G[I]=true;});this.setSelectedItems(C.filter(this.items,function(I){return C.indexOf(E,I.v)>-1;}));},getSubtotalTypes:function A(){var G=this.items,H=this.selectedIndices,J=this.prevSelection,F=G.filter(function(L,K){return H[K]&&!J[L.v];}),I=G.filter(function(L,K){return !H[K]&&J[L.v];}),E=function(K){return K.v;};return[F.map(E),I.map(E)];},items:[{n:D(2121,"Total"),v:-10},{n:D(2122,"Average"),v:-12},{n:D(2125,"Maximum"),v:-14},{n:D(2127,"Minimum"),v:-13},{n:D(2123,"Count"),v:-11},{n:D(2124,"Geometric Mean"),v:-20},{n:D(2126,"Median"),v:-16},{n:D(2128,"Mode"),v:-17},{n:D(2129,"Product"),v:-15},{n:D(2130,"Standard Deviation"),v:-18},{n:D(2132,"Variance"),v:-19}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.ui._IsHierarchyList","mstrmojo.css","mstrmojo.array","mstrmojo.EnumSelectionType");var S=mstrmojo.css,K=mstrmojo.array,A=mstrmojo.EnumSelectionType;var V="hidden",Q="selected",R="expanded",F="collapsed",I="hierarchy",M="hasChildren";var P="u;",Z=10;mstrmojo.ui.HierarchyCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._IsHierarchyList],{scriptClass:"mstrmojo.ui.HierarchyCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="header"></div><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div><div class="footer"></div></div>',markupSlots:{headerNode:function E(){return this.domNode.firstChild;},footerNode:function C(){return this.domNode.lastChild;},scrollboxNode:function H(){return this.domNode.children[1];},itemsContainerNode:function U(){return this.domNode.children[1].firstChild;}},getItemMarkup:function D(b,a){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="triangle"></span><span class="checkbox"></span><span class="text">{@en@n}</span></{@tag}>';},getItemProps:function X(c,a){var b=this._super(c,a);if(c.isSelected){b.addCls(Q);}if(this.isHiearachyDisplay()){if(c.hcd){b.addCls(c.epd?R:F);}}return b;},setupScrollNodes:function J(){this.scrollNode=this.scrollboxNode;var a=this.domNode.clientHeight-this.headerNode.clientHeight-this.footerNode.clientHeight;if(a>0){this.scrollNode.style.height=a+"px";}},onclick:function Y(a){var c=a.getTarget(),d=this.getItemNodeFromTarget(c),b=this.getItemFromTarget(c);if(b){if(S.hasClass(c,"triangle")){if(b.hcd){this.doExpandCollapse(d,b);}}else{if(!S.hasClass(c,"indent")){this.doBranchSelect(d,b,!b.isSelected);}}a.cancel();}},doElementSelect:function W(c,b,a){b.isSelected=a;this.onSelectionChange(A.ELEMENT,a,b);this.updateItemNodesStatus();},doBranchSelect:function O(d,b,a){var c=function(e){e.isSelected=a;e.isBranchSelected=a;(e.children||[]).forEach(function(f){c(f);});};c(b);this.onSelectionChange(A.BRANCH,a,b);this.updateItemNodesStatus();},doLevelSelect:function G(b,a){this.getItems().forEach(function(c){if(c.lv===b){c.isSelected=a;}});this.onSelectionChange(A.LEVEL,a,null,b);this.updateItemNodesStatus();},doBranchLevelSelect:function B(e,b,d,a){var c=function(f){if(f.lv===d){f.isSelected=a;}else{if(f.lv<d){(f.children||[]).forEach(function(g){c(g);});}}};c(b);this.onSelectionChange(A.BRANCH_LEVEL,a,b,d);this.updateItemNodesStatus();},doAllSelect:function L(a){this.getItems().forEach(function(b){b.isSelected=b.isBranchSelected=a;});this.onSelectionChange(A.ALL,a);this.updateItemNodesStatus();},updateItemNodesStatus:function N(){var a=this.itemsContainerNode&&this.itemsContainerNode.childNodes;K.forEach(a,function(c){var b=this.getItemFromTarget(c);if(b){S.toggleClass(c,Q,b.isSelected);}},this);},onSelectionChange:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo.css");var P=mstrmojo.color,C=mstrmojo.models.FormatModel,E=C.ENUM_PROPERTY_NAMES,H="transparent",A="#000000",D="#2f9ad3",J="#ffffff";function B(){return this.docSelector.style===mstrmojo.DocSelector.STYLES.LIST&&!this.docSelector.isInFilterPanel();}function G(R,U){if(B.call(this)){var Q=R.style,S=this.stateCssText[U];Q.background=S.bg;Q.color=S.text;}}mstrmojo.vi.ui.rw.selectors.ListBoxSelector=mstrmojo.declare(mstrmojo.ui.ScrollableList,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.ListBoxSelector",init:function O(Q){this._super(Q);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-vi-sel-ListBox");},getItemMarkup:function L(R,Q){if(mstrmojo.string.isEmpty(R.n)){return this._super(R,Q).replace("{@en@n}","&nbsp;");}return this._super(R,Q);},listHooks:{select:function(Q){G.call(this,Q,"selected");},unselect:function(Q){G.call(this,Q,"base");}},getItemProps:function I(U,Q){var R=this._super(U,Q);if(B.call(this)){var V=this.stateCssText,S=R.sel?V.selected:V.base;R.addStyle("background:"+S.bg+";color:"+S.text);}return R;},preBuildRendering:function K(){if(B.call(this)){var R=this.docSelector,Q=R.getFormats(),V=this.getPropertyDefaultValue(E.SELECTOR_SELECTION_COLOR)||D,U=this.getPropertyDefaultValue(E.COLOR)||J,S=R.defn.ssc!==undefined?C.decodeValue(E.SELECTOR_SELECTION_COLOR,R.defn.ssc):V;this.stateCssText={base:{bg:Q["background-color"]||H,text:Q.color||A},selected:{bg:S,text:P.encodeColor(S)===P.encodeColor(V)?U:P.getContrastingColor(S,"#ffffff","#000000")}};}return this._super();},getPropertyDefaultValue:function(R){var S=mstrApp.getThemeClassName(),Q=null;switch(R){case E.SELECTOR_SELECTION_COLOR:Q=S==="mojo-theme-light"?"#34ABEB":"#34ABEB";break;case E.COLOR:Q=S==="mojo-theme-light"?"#444649":"#ffffff";break;}return Q;},premousedown:function M(Q){if(mstrmojo.dom.shiftKey(Q.hWin,Q.e)){mstrmojo.dom.preventDefault(Q.hWin,Q.e);}},onclick:function N(R){var U=R.getTarget();var S=this.getItemFromTarget(U);if(S){var Q=S._renderIdx;if(this.multiSelect&&R.metaKey){var V=this.rangeSelected||this.selectedIndex===-1;this.toggleSelect(Q);if(V&&Q<this.items.length&&this.selectedIndices[Q+1]){Q++;}this.selectedIndex=Q;this.rangeSelected=false;}else{if(this.multiSelect&&R.shiftKey){this.rangeSelected=true;this.rangeSelect(Q);}else{this.singleSelect(Q);this.rangeSelected=false;}}}},updateScrollbars:function F(){if(this.hasRendered&&this.orientation==="v"){this.scrollboxNode.style.height=this.height;}this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList");var A;mstrmojo.vi.ui.rw.selectors.PageByButtonBar=mstrmojo.declare(mstrmojo.ui.ScrollableList,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.PageByButtonBar",init:function C(D){this._super(D);mstrmojo.css.addWidgetCssClass(this,["mstrmojo-vi-sel-LinkList","buttons"]);},multiSelect:false,getItemMarkup:function B(D){if(!A){A=this._super(D).replace(">{@en@n}<","><div>{@en@n}</div><");}return A;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._HasOwnAvatar","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.vi.enums.EnumDerivedElementType");var H=mstrmojo.dom,W=mstrmojo.css,Q=mstrmojo.vi.enums.EnumDerivedElementType,D=mstrmojo.string,Z="top",N="bottom",X;function P(b,a){return Math.min(Math.max(Math.floor((b-a.y0)/a.h),0),this.items.length-1);}function B(e,c){var b=Z,d=(Math.floor(e-c.y0)%c.h)/c.h,a=P.call(this,e,c);if(a===this.items.length-1){if(d>0.5||Math.floor((e-c.y0)/c.h)>a){b=N;}}else{if(d>0.5){if(a<this.items.length-1){a+=1;}}}return{edge:b,idx:a};}function S(){if(this.tmr){window.clearInterval(this.tmr);delete this.tmr;}}function A(a){return !a.src.data.isScrollBar&&!isNaN(a.src.data.index);}mstrmojo.vi.ui.GroupDEList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.vi.ui.GroupDEList",draggable:true,avatarCssClass:"group-DE-drag-avatar",editOnDoubleClick:true,clickCount:0,timer:null,useRichTooltip:true,init:function R(a){this._super(a);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIGroupDEList");},getItemMarkup:function G(a){if(!X){X=this._super(a).replace(">{@en@n}",'><div><div class="group-column"><div class="draggable-icon"></div><div class="name" mstrAttach:click>{@en@n}</div></div><div class="mstrmojo-group-list">{@prev}</div><div class="mstrmojo-group-delete" mstrAttach:click></div><div style="clear:both;float:none;"></div></div>');}return X;},onscroll:function U(a){this.parent.renameDE.set("visible",false);this._super(a);},onclick:function J(c){var e=c.getTarget(),f=H.findAncestorByAttr(e,"idx",true,this.domNode),a,d=this,b=d.parent;b.renameDE.set("visible",false);if(f&&e.className&&e.className.indexOf("group-delete")>0){a=parseInt(f.node.getAttribute("idx"),10);this.parent.model.deleted.push(this.items[a]);this.items.splice(a,1);this.parent.initExcludeList();this.parent.enableOkBtn();this.refresh();}if(f&&e.className&&e.className.indexOf("name")>=0){a=parseInt(f.node.getAttribute("idx"),10);this.clickCount++;if(this.clickCount===1){this.singleSelect(a);this.timer=window.setTimeout(function(){d.clickCount=0;if(f.node.className.indexOf("list")>0||(f.node.className.indexOf("calculation")>0&&b.model&&b.model.isRA)){d.parent.toggleEdit(true,false,d.items[a]);}},400);}else{if(this.clickCount===2){window.clearTimeout(this.timer);this.clickCount=0;if(a===this.selectedIndex){b=d.parent;b.renameDE.set("visible",true);b.renameDE.set("text",this.selectedItem.n);b.renameDE.domNode.style.left=(H.position(e).x-H.position(this.domNode.parentNode).x)+"px";b.renameDE.domNode.style.top=(H.position(e).y-H.position(this.domNode.parentNode).y)+"px";}}}}},getItemProps:function Y(c,a){var b=this._super(c,a);b.cls="mstrmojo-VIGroupDERow "+((c.t===Q.RESIDUE)?"others":(c.t===Q.CALCULATION)?("calculation"+(this.parent.model&&this.parent.model.isRA?" ra":"")):"list");b.prev=c.prev;return b;},deleteItem:mstrmojo.emptyFn,setupScrollNodes:function L(){this.scrollNode=this.scrollboxNode;},getDragData:function E(c){if(this._super){var b=this._super(c);if(b&&b.isScrollBar===true){return b;}}var d=c.src.node,h=this.id,g=H.findAncestorByAttr(d,"idx",true,this.domNode),e,a;e=c.src.node=g?g.node:d;a=parseInt(e.getAttribute("idx"),10);return{item:this.items[a],index:a,node:e,setAvatarClass:function f(j){var m=mstrmojo.all[h],k=m.avatar;if(k){var l=[m.avatarCssClass,"hasOwnAvatar",j];k.className=l.join(" ");}}};},createAvatar:function O(c,b){var a=null;if(A(b)){a=c.cloneNode(true);}return a;},positionAvatar:function K(b,a){if(!this.avatar){return ;}b.x=a.src.data.left+10;this._super(b,a);},isDragValid:function C(a){return A(a)||this._super(a)||false;},ondragstart:function V(a){if(A(a)){var c=a.src.data,b=c.node;c.y0=H.position(this.domNode).y;c.h=H.position(b).h;c.left=H.position(b).x;c.th=this.scrollNode.offsetHeight;c.sh=this.scrollNode.scrollHeight;this.items.splice(c.index,1);this.itemsContainerNode.removeChild(b);}this._super(a);},ondragmove:function M(a){if(A(a)){var d=a.src.data,j=a.last.y,l=d.tgtIdx,m=d.tgtEdge,g=d.th,n=d.sh,k=(j-d.y0)<0,f=(j-d.y0)>g,e,c,b,h=this;if(k||f){if(l||m){if(l!==undefined){W.removeClass(this.itemsContainerNode.children[l],m);}delete d.tgtIdx;delete d.tgtEdge;}if(f){if(this.scrollNode.scrollTop<n&&!this.tmr){this.tmr=window.setInterval(function(){if(h.scrollNode.scrollTop+5>n){h.scrollNode.scrollTop=n;S.apply(this);}else{h.scrollNode.scrollTop+=5;}},200);}else{if(this.scrollNode.scrollTop>=n){S.apply(this);}}}if(k){if(this.scrollNode.scrollTop>0&&!this.tmr){this.tmr=window.setInterval(function(){if(h.scrollNode.scrollTop-5<0){h.scrollNode.scrollTop=0;S.apply(this);}else{h.scrollNode.scrollTop-=5;}},200);}else{if(this.scrollNode.scrollTop<=0){S.apply(this);}}}}else{S.apply(this);e=B.call(this,j+this.scrollNode.scrollTop,d);c=e.idx;b=e.edge;if(l!==c||m!==b){if(l!==undefined){W.removeClass(this.itemsContainerNode.children[l],m);}W.addClass(this.itemsContainerNode.children[c],b);d.tgtIdx=c;d.tgtEdge=b;}}}return this._super(a);},ondragend:function I(b){if(A(b)){var d=b.src.data,c=d.node,a=d.tgtIdx;S.apply(this);if(a!==undefined){W.removeClass(this.itemsContainerNode.children[a],d.tgtEdge);}if(d.tgtEdge===N){a++;}if(a===undefined){a=d.index;}this.items.splice(a,0,d.item);if(a===d.index){c.setAttribute("idx",a);this.itemsContainerNode.insertBefore(c,(a<(this.items.length-2))?this.itemsContainerNode.children[a]:null);}else{this.refresh();this.parent.enableOkBtn();}}return this._super(b);},showTooltip:function F(b,g){var f=b.target||H.eventTarget(b.hWin,b.e),d=this.getItemFromTarget(f),h=null,a=null,e=null,c=null;if(d&&d.n){h=this.getItemNodeFromTarget(f);a=H.position(f);e=h.getElementsByClassName("name")[0];c=h.getElementsByClassName("mstrmojo-group-list")[0];if((e===f&&e.scrollWidth>e.clientWidth)||(c===f&&c.scrollWidth>c.clientWidth)){this.richTooltip={areaId:d._renderIdx,cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:D.encodeHtmlString(f.textContent),top:a.y,left:e===f?a.x+130:a.x+70};}else{this.richTooltip=null;}if(this.richTooltip){this._super(b,g);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo.css");var B=mstrmojo.css,A=mstrmojo.desc(15615,"Click here to start selection");mstrmojo.vi.ui.rw.selectors.VisSelectorBox=mstrmojo.declare(mstrmojo.Label,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.VisSelectorBox",renderOnScroll:true,init:function D(F){this._super(F);B.addWidgetCssClass(this,"mstrmojo-vi-sel-VisSelectorBox");},updateSummaryText:function E(F){if(F){this.selections=F;}var H=this.selections?Object.keys(this.selections).length:0,G=A;if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){G=mstrmojo.desc(15763,"Click here to edit visualization");}this.text=H<=0?G:this.docSelector.generateSummaryText(H);},getSummaryText:function C(){return this.text;}});}());(function(){mstrmojo.requiresCls("mstrmojo.OBList","mstrmojo.ui._IsIncFetchList","mstrmojo.ui._HasScroller");var F=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType;function D(G){return{browseConfig:null,parent:G,next:function(J){var I=this.browseConfig;if(!I){return ;}I.blockBegin+=I.blockCount;var H={taskId:"searchMetadata",styleName:"MojoFolderStyle",blockBegin:I.blockBegin,blockCount:I.blockCount,includeAncestorInfo:true};if(I.folderLinksContextId){H.folderLinksContextId=I.folderLinksContextId;}if(I.includeObjectDesc){H.includeObjectDesc=I.includeObjectDesc;}if(I.rootFolderID){H.rootFolderID=I.rootFolderID;}else{if(I.rootFolderType){H.rootFolderType=I.rootFolderType;}}if(I.browsableTypes){H.objectType=I.browsableTypes;}if(I.searchPattern){H.searchPattern=I.searchPattern;if(I.recursive){H.recursive=I.recursive;}}this.parent.set("waiting",true);if(I.dataProvider){I.dataProvider.serverRequest(H,J);}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,J,H);}},hasNext:function(){var H=this.browseConfig;return(H.blockBegin+H.blockCount-1)<H.totalSize;}};}mstrmojo.mstr.ui.IncFetchOBList=mstrmojo.declare(mstrmojo.OBList,[mstrmojo.ui._IsIncFetchList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.mstr.ui.IncFetchOBList",cssClass:"mstrmojo-OBList mstrmojo-IF-OBList",makeObservable:true,renderOnScroll:false,waiting:false,markupString:'<div id="{@id}" class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keypress,mousedown,mouseup,dblclick><div class="scroll-box" style="{@scrollBoxCssText}"><div class="mstrmojo-ListBase2-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},markupMethods:{onwaitingChange:function(){this.onwaitingChange();}},init:function E(G){if(this._super){this._super(G);}this.ifDataHelper=D(this);if(G.browseConfig){this.ifDataHelper.browseConfig=G.browseConfig;}},onwaitingChange:mstrmojo.emptyFn,addItems:function B(G){var H=this.browseConfig.browsableViewMedias;if(G&&H){var I={};F.forEach(H.split(","),function(J){I[parseInt(J,10)]=true;});G=F.filter(G,function(J){return(J.t!==A.DssTypeDocumentDefinition)||I[J.dvm];});}this.add(G,-1);this.set("waiting",false);if(this._super){this._super(G);}if(this.scrollNode){this.updateScrollbars();}},setupScrollNodes:function C(){this.scrollNode=this.scrollboxNode;}});}());(function(){var F=mstrmojo.string;function H(Q,R,K){var L,O,J,M=[],N,S;try{N=new RegExp(mstrmojo.string.regEscape(Q),"i");}catch(P){return M;}for(L=0,O=R.length;L<O;L++){J=R[L][K];N.lastIndex=0;if(N.test(J)){M.push(R[L]);}}return M;}function C(){if(this.searchEnabled){this.iconNode.style.display="none";this.inputBar.style.display="";if(this.autofocus){this.inputNode.focus();this.inputNode.select();}}else{this.hideInputNode();if(this.autofocus){if(mstrmojo.dom.isIE7||mstrmojo.dom.isIE8){var J=this;window.setTimeout(function(){try{J.iconNode.focus();}catch(K){}},100);}else{this.iconNode.focus();}}}}var G={8:"BackSpace",9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"};mstrmojo.SearchableDropDownList=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchableDropDownList",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupSlots,{inputBar:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.firstChild.lastChild.rows[0].cells[0].firstChild;}}),markupMethods:mstrmojo.hash.copy({ontextChange:function(){this.iconNode.innerHTML=F.decodeHtmlString(this.text);this.inputNode.value=this.text;},onheightChange:function(){var J=parseInt(this.height,10);if(J>=0){this.domNode.offsetHeight=J+"px";this.inputBar.offsetHeight=J+"px";}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),popupToBody:true,searchEnabled:false,selectedIndex:-1,placeholderText:"",allItems:null,autofocus:true,focus:function(){C.call(this);},hideInputNode:function B(){this.inputBar.style.display="none";this.iconNode.style.display="block";},postBuildRendering:function A(){if(!this.allItems){this.allItems=this.items;}this._super();C.call(this);},clickInput2pop:false,onclick:function I(J){if(this.clickInput2pop){this.togglePopup();}},prekeyup:function E(R){var K=this.getSearchPattern(),P=[],M,Q=this.inputNode,O=R.e,J,L,N=this.items.length;if(G[O.keyCode]==="Enter"){if(this.items.length>0){this.set("selectedIndex",this.selectedIndex===-1?0:this.selectedIndex);}this.onEnter&&this.onEnter();this.closePopup();return ;}else{if(G[O.keyCode]==="Esc"){this.onEsc&&this.onEsc();if(this.popupRef.visible){this.popupRef.close();}return ;}else{if(G[O.keyCode]==="ArrowDown"){if(!this.popupRef.visible){this.togglePopup();}this.set("selectedIndex",(this.selectedIndex+1)%N);}else{if(G[O.keyCode]==="ArrowUp"){if(this.popupRef.visible&&N>0){this.set("selectedIndex",(this.selectedIndex+N-1)%N);}}else{if(this.searchEnabled){if(K&&K.length>0&&K.indexOf(this.lastSearchPattern)>-1){P=H(K,this.items,this.itemField);}else{P=H(K,this.allItems,this.itemField);}this.set("selectedIndex",-1);this.set("items",P);N=P.length;if(N===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}if(K&&K.length>0){this.set("selectedIndex",mstrmojo.array.find(P,this.itemField,Q.value));}}}}}}this.lastSearchPattern=K;},getSearchPattern:function D(){return F.trim(this.inputNode.value);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Pulldown");var C={ENTER:13,LEFT:37,UP:38,TAB:9,RIGHT:39,DOWN:40,ESC:27};function D(L,M){var G,J,F,H=[],I,N;try{I=new RegExp(L,"i");}catch(K){I=new RegExp(mstrmojo.string.regEscape(L));}for(G=0,J=M.length;G<J;G++){if(I.test(M[G][this.itemField])){H.push(M[G]);}}return H;}function B(F){return !(F<0||F===undefined||F===null);}mstrmojo.SearchablePulldown=mstrmojo.declare(mstrmojo.Pulldown,null,{scriptClass:"mstrmojo.SearchablePulldown",popupCssClass:"mstrmojo-SearchablePulldown-Popup",searchEnabled:false,allowCustomInput:false,useItemCssOnInput:false,lastSearchPattern:"",isEditing:false,allItems:null,markupString:'<div id="{@id}" class="mstrmojo-SearchablePulldown mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-SearchablePulldown-boxNode mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}" mstrAttach:mousedown><input class="mstrmojo-SearchablePulldown-inputNode" value="{@text}" mstrAttach:keyup,blur/><div class="mstrmojo-SearchablePulldown-iconNode mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mouseover,mouseout></div></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div></div>',markupSlots:{boxNode:function(){return this.domNode.firstChild;},inputNode:function(){return this.domNode.firstChild.firstChild;},iconNode:function(){return this.domNode.firstChild.children[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:mstrmojo.hash.copy({ontextChange:function(){if(this.inputNode.value!==this.text){this.inputNode.value=this.text;}},onheightChange:function(){this.domNode.style.height=this.height||"";this.boxNode.style.height=this.height||"";},onsearchEnabledChange:function(){this.inputNode.readOnly=this.searchEnabled?false:true;this.items=this.allItems||this.items;},onallowCustomInputChange:function(){if(this.allowCustomInput){this.set("searchEnabled",true);}},onvalueChange:function E(){if(this.useItemCssOnInput&&this.selectedItem){this.inputNode.className="mstrmojo-SearchablePulldown-inputNode "+(this.selectedItem[this.itemCSS]||"");}}},mstrmojo.hash.copy(mstrmojo.Pulldown.prototype.markupMethods)),prevalueChange:function(){this.synchronize();},synchronize:function(){var G=this.value,H=this.items||[],I=H[this.selectedIndex],F=-1;if(I&&G===I[this.itemIdField]){this.selectedItem=I;this.set("text",I[this.itemField]);return ;}F=mstrmojo.array.find(this.items,this.itemIdField,G);if(!B(F)&&this.allowCustomInput){this.selectedItem=undefined;this.selectedIndex=undefined;return ;}this.selectedIndex=B(F)?F:this.defaultSelection;this.selectedItem=I=this.items[this.selectedIndex];this.value=I?I[this.itemIdField]:undefined;this.set("text",I?I[this.itemField]:(this.defaultText||""));},preBuildRendering:function A(){if(this._super){this._super();}this.allItems=this.allItems||this.items;this.synchronize();},premousedown:function(F){if(this.searchEnabled&&F.getTarget()===this.iconNode){this.set("items",this.allItems);}this._super(F);},onkeyup:function(M){var J=mstrmojo.string.trim(this.inputNode.value),I=M.e,N=I.keyCode||I.which,L=B(this.selectedIndex)?this.selectedIndex:-1,F=this.allowCustomInput,H=this.items.length;this.isEditing=true;switch(N){case C.ENTER:if(H>0&&!F){this.set("selectedIndex",L===-1?0:L);this.synchronize();}this.closePopup();break;case C.ESC:this.closePopup();this.synchronize();break;case C.UP:if(this.popupRef.visible&&H>0){this.set("selectedIndex",(L+H-1)%H);this.synchronize();}break;case C.DOWN:if(!this.popupRef.visible&&H>0){this.togglePopup();}this.set("selectedIndex",(L+1)%H);this.synchronize();break;default:if(J===this.lastSearchPattern){return ;}var K=[];if(J&&J.length>0&&J.indexOf(this.lastSearchPattern)>-1){K=D.apply(this,[J,this.items]);}else{K=D.apply(this,[J,this.allItems]);}this.set("items",K);if(K.length===0){this.closePopup();}else{if(!this.popupRef.visible){this.togglePopup();}}this.set("selectedIndex",undefined);if(J&&J.length){var G=mstrmojo.array.find(K,this.itemField,J);if(G!==-1){this.set("selectedIndex",G);}}}if(F&&!B(this.selectedIndex)){this.set("value",this.inputNode.value);}this.lastSearchPattern=J;},onblur:function(F){this.isEditing=false;if(!this.searchEnabled){return ;}if(!this.allowCustomInput){this.items=this.allItems;this.synchronize();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dnd","mstrmojo.ui._HasScroller","mstrmojo.DI.DIConstants");var f=mstrmojo.DI.DIConstants;function a(h){var k=document.createElement("div"),j=k.style,g=h.domNode;k.className="mstrmojo-DataGrid-avatar";j.height=g.clientHeight+"px";g.appendChild(k);h.avatar=k;return k;}function Q(g){var h=mstrmojo.dom.position(g.domNode,true);return h.x;}function O(g){return'<div class="mstrmojo-DataGrid-resizeHandle" unselectable="on" onselectstart="return false" rh="'+g+'"></div>';}function c(j){var h=j.getAttribute("rh"),g=h&&parseInt(h,10);return g;}function Z(h,l,g){var k=g.src,m=k&&k.data,j=m&&m.resizingIdx;if(!(j&&j>0)){return l&&l.apply(h,[g]);}}mstrmojo.RESIZE_NEXT_COLUMN_MODE={getRange:function G(k,j){var g=k.colSizeArray;var h=[-g[j-1]+k.minColWidth,(j==g.length-1)?g[j]-k.resizeHandleWidth-k.minColWidth:g[j]-k.minColWidth];return h;},updateSize:function F(k,j,h){var g=k.colSizeArray;g[j-1]=g[j-1]+h;g[j]=g[j]-h;},updateColumnWidth:function U(k,h,l,j){var g=k.colSizeArray;h[j-1].style.width=g[j-1]+"px";l[j-1].style.width=g[j-1]+"px";h[j].style.width=g[j]+"px";l[j].style.width=g[j]+"px";}};mstrmojo.RESIZE_ALL_COLUMN_MODE={getRange:function G(m,l){var n=m.minColWidth+m.resizeHandleWidth,g=m.colSizeArray,j=0;for(var k=l;k<g.length;++k){j+=g[k]-n;}var h=[-g[l-1]+n,j];return h;},updateSize:function F(k,o,h){var n=k.minColWidth+k.resizeHandleWidth,l=k.colSizeArray;l[o-1]=l[o-1]+h;var g=[];for(var j=0;j<l.length-o;++j){g[j]=o+j;}g.sort(function(q,r){return l[q]-l[r];});for(var j=0;j<g.length;++j){var p=h/(g.length-j);var m=l[g[j]];h-=(m>=p+n)?p:m-n;l[g[j]]=(m>=p+n)?m-p:n;}},updateColumnWidth:function U(l,h,m,k){var g=l.colSizeArray;for(var j=k-1;j<g.length;++j){h[j].style.width=g[j]+"px";m[j].style.width=g[j]+"px";}}};mstrmojo.RESIZE_CURRENT_COLUMN_MODE={getRange:function G(m,l){var n=m.minColWidth+m.resizeHandleWidth,g=m.colSizeArray,j=0;for(var k=l;k<g.length;++k){j+=g[k]-n;}var h=[-g[l-1]+n,j];return h;},updateSize:function F(k,j,h){var g=k.colSizeArray;g[j-1]=g[j-1]+h;},updateColumnWidth:function U(k,h,l,j){var g=k.colSizeArray;h[j-1].style.width=g[j-1]+"px";l[j-1].style.width=g[j-1]+"px";k.widgetResized();}};mstrmojo._CanResizeColumn=mstrmojo.provide("mstrmojo._CanResizeColumn",{draggable:true,dropZone:false,avatar:null,colSizeArray:null,resizableColumns:true,resizeHandleWidth:10,minColWidth:5,resizeColumnBehavior:mstrmojo.RESIZE_NEXT_COLUMN_MODE,createColSizeArray:function d(){var h,m,k,j,l,g;m=this.headerContainerNode;k=m&&m.getElementsByTagName("table")[0];j=k.rows[0].cells;h=[];for(l=0,g=j.length;l<g;l++){h.push(j[l].offsetWidth);}return h;},postBuildRendering:function W(){if(this._super){this._super();}if(this.avatar){this.domNode.appendChild(this.avatar);}this.colSizeArray=null;},getDragData:function E(g){var j=g.src,k=j.node,h=c(k);if(h&&h>0){return{resizingIdx:h,startingX:j.pos.x,baseX:Q(this)};}if(this._super){return this.dropZone&&this._super(g);}return null;},allowDrop:function K(g){var j=g.src,k=j&&j.data,h=k&&k.resizingIdx;if(h&&h>0){return true;}return this.dropZone;},ondragenter:function R(g){Z(this,this._super,g);},ondragover:function S(g){Z(this,this._super,g);},ondragleave:function B(g){Z(this,this._super,g);},ondrop:function X(g){Z(this,this._super,g);},isDragValid:function C(g){var j=g.src,k=j&&j.data,h=k&&k.resizingIdx;if(h&&h>0){return true;}if(this._super){return this._super(g);}return false;},ondragstart:function Y(g){var k=g.src,l=k&&k.data,j=l&&l.resizingIdx;if(j&&j>0){var h=this.avatar||a(this);this.ownAvatar=true;h.style.left=(l.startingX-l.baseX)+"px";h.style.display="block";document.body.style.cursor="col-resize";if(!this.colSizeArray){this.colSizeArray=this.createColSizeArray();this._firstTimeResize=true;}l.resizingRange=this.resizeColumnBehavior.getRange(this,j);return ;}if(this._super){this._super(g);}},ondragmove:function P(h){var p=h.src,j=p&&p.data,n=j&&j.resizingIdx;if(n&&n>0){var o=h.tgt,k=this.avatar,m=j.resizingRange,l=o.pos.x-j.startingX,g=Math.min(m[1],Math.max(l,m[0]));j.deltaX=g;if(k){k.style.left=(j.startingX-j.baseX+g)+"px";}}else{if(this._super){this._super(h);}}},ondragend:function L(l){var t=l.src,m=t&&t.data,q=m&&m.resizingIdx;if(q&&q>0){var g=this.titleColGroup,r=g&&g.childNodes,o=this.dataColGroup,p=o&&o.childNodes,k=r.length,n=this.colSizeArray,h=m.deltaX;this.resizeColumnBehavior.updateSize(this,q,h);if(this._firstTimeResize){var j;for(j=0;j<k;j++){r[j].style.width=n[j]+"px";p[j].style.width=n[j]+"px";}this._firstTimeResize=false;}else{this.resizeColumnBehavior.updateColumnWidth(this,r,p,q);}this.avatar.style.display="none";document.body.style.cursor="";this.ownAvatar=false;}else{if(this._super){this._super(l);}}}});mstrmojo.requiresCls("mstrmojo._CanResizeColumn","mstrmojo.ListMapperTable","mstrmojo.WidgetList");function J(j){var m=document.createElement("colgroup"),g=j.length,h,l;for(l=0;l<g;l++){var k=document.createElement("col");h=j[l];if(h.colWidth){k.style.width=h.colWidth+"px";}k.className=h.colCss||("col"+l);m.appendChild(k);}return m;}function I(h){var j=h._headerWidgets_,g=j&&j.length;if(g>0){var k;for(k=0;k<g;k++){j[k].destroy(true);}}}function A(l,g,k,n,h){var j=[],m=l.headerWidget;k=k?(" "+k):"";n=n||this._headerWidgets;h=h?(" "+h):' w="1"';j.push("<td"+k+">");if(g>0&&this.resizableColumns){j.push(O(g));}j.push('<div class="mstrmojo-DataGrid-headerText');j.push(l.headerCss?" "+l.headerCss:"");if(m){n.push(mstrmojo.hash.copy(m));j.push('"'+h+">");}else{j.push('">');}j.push(l.headerText||"&nbsp");j.push("</div>");j.push("</td>");return j.join("");}function b(g,o){var j,m,n,h,p,l,k=[];g=g||"_headerWidgets";o=o||"1";j=this[g];m=j.length;if(m>0){n=this.headerContainerNode.getElementsByTagName("div");h=mstrmojo.array.filter(n,function(q){return q.getAttribute("w")==o;});for(l=0;l<m;l++){j[l].placeholder=h[l].firstChild;j[l].dataGrid=this;p=mstrmojo.registry.ref(j[l]);p.render();k.push(p);}}this[g+"_"]=k;}mstrmojo.DataGrid=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._CanResizeColumn,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DataGrid",banding:true,resizableColumns:true,columns:null,items:null,listMapper:mstrmojo.WidgetListMapperTable,lockHeader:false,contentWidth:"",renderHook:{},shouldDisableItem:function(){return false;},markupString:'<div id="{@id}" class="mstrmojo-DataGrid {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup><div class="mstrmojo-DataGrid-headerContainer">{@headerHtml}</div><div class="mstrmojo-DataGrid-itemsScrollBox" style="position:relative;"><div class="mstrmojo-DataGrid-itemsContainer" style="{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild.firstChild;},dropCueNode:function(){return this.domNode.lastChild.lastChild;},headerContainerNode:function(){return this.domNode.firstChild;},headerRows:function(){return this.domNode.firstChild.firstChild.rows;},bodyRows:function(){return this.domNode.lastChild.firstChild.firstChild.rows;}},markupMethods:{oncontentWidthChange:function(){var h=this.contentWidth,j=this.headerContainerNode,g=this.itemsContainerNode;if(h&&j&&g){j.style.width=h;g.style.width=h;}},onlockHeaderChange:function(){mstrmojo.css.toggleClass(this.domNode,"lockHeader",this.lockHeader);},onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";}},setupScrollNodes:function M(){this.scrollNode=this.scrollboxNode;},itemFunction:function(j,g,h){var k=new mstrmojo.DataRow({columns:h.columns,data:j,disable:h.shouldDisableItem(j),idx:g,dataGrid:h,parent:h});return k;},preBuildRendering:function D(){var m=this.renderHook;if(m&&m.pre){m.pre.apply(this,[A]);}else{var h=this.columns,g=h.length,j=['<table class="mstrmojo-DataGrid-headerTable" cellspacing="0" cellpadding="0"><tr>'],l;this._headerWidgets=[];var k;for(k=0;k<g;k++){l=A.apply(this,[h[k],k]);j.push(l);}j.push("</tr></table>");this.headerHtml=j.join("");}if(this._super){this._super();}},postBuildRendering:function W(){if(this._super){this._super();}var j=this.renderHook;if(j&&j.post){j.post.apply(this,[J,b]);}else{b.apply(this);this.titleColGroup=J(this.columns);}var g=this.titleColGroup,o=g.cloneNode(true),l=this.headerContainerNode,n=l&&l.getElementsByTagName("table")[0],p=this.itemsContainerNode,m=this.scrollboxNode,k=this.domNode,h=p&&p.getElementsByTagName("table")[0];this.dataColGroup=o;if(n&&h){n.insertBefore(g,n.firstChild);h.insertBefore(o,h.firstChild);}if(this.lockHeader){m.style.height=k.offsetHeight-l.offsetHeight+"px";mstrmojo.dom.attachEvent(m,"scroll",function(q){l.style.left=-m.scrollLeft+"px";});}},refresh:function H(g){I(this);if(this._super){this._super(g);}},destroy:function e(g){I(this);this._super(g);},unrender:function V(l){var j=this._headerWidgets_,h=j&&j.length,g;if(h>0){var k;for(k=0;k<h;k++){g=j[k];if(g&&g.hasRendered){g.unrender(true);}}}this._super(l);}});mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.Container");mstrmojo.DataRow=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DataRow",cssClass:"mstrmojo-DataRow",dataTextCSSClass:"mstrmojo-DataRow-text",columns:null,disable:false,markupMethods:{onselectedChange:function(){mstrmojo.css.toggleClass(this.domNode,"selected",this.selected);}},buildDom:function(){this.children=[];var n=document.createElement("tr"),r=this.data,u=this.idx,h=this.dataGrid,o=this.cssClass,x=this.columns,g=this.children,k=this.disable,j,s=-1,v,t;n.setAttribute("id",this.id);if(h.banding){o+=(u%2==1)?" odd":" even";}n.className=o+(mstrmojo.string.isEmpty(r[h.itemDisplayField||"n"])?" empty-row":"")+(" "+r[h.itemCSSField||"itemCss"]||"")+(k?" disabled":"");var m,q;for(m=0,q=x.length;m<q;m++){v=x[m];t=(v.dataWidgetBuilder&&v.dataWidgetBuilder(r))||v.dataWidget;j=document.createElement("td");if(v.applyStyle2Cell&&v.colCss){j.setAttribute("class",v.colCss);}n.appendChild(j);if(t){j.setAttribute("w","1");s++;g.push(mstrmojo.hash.copy(t,{slot:"slot"+s,data:r,idx:u,dataGrid:h}));}else{if(v.dataFunction){j.innerHTML=v.dataFunction(r,u,h);}else{var l=mstrmojo.string.htmlAngles(r[v.dataField||"n"])||"&nbsp",p=v.tooltip?' title="'+l+'"':"";j.innerHTML='<div class="'+this.dataTextCSSClass+'" '+p+">"+l+"</div>";}}}this.initChildren();n.mstrmojoId=this.id;return n;},buildRendering:function N(){this._super();var l=this.domNode.childNodes,g=l.length,k={},j=0,m,h;for(h=0;h<g;h++){m=l[h];if(m.getAttribute("w")=="1"){k["slot"+j]=m;j++;}}this.addSlots(k);}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo._IsDial");mstrmojo.WidgetDial=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._IsDial],{scriptClass:"mstrmojo.WidgetDial"});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetList");mstrmojo.requiresDescs(7091);var C=mstrmojo.desc;mstrmojo.ME.RepeatPulldownList=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ME.RepeatPulldownList",cssClass:"mstrmojo-RepeatPulldownList",makeObservable:true,cValid:true,showDelete:true,pulldownItems:null,pulldowItemsFilter:function B(G){return true;},onpulldownItemsChange:function D(G){var H=G.value,J=[];mstrmojo.array.forEach(H,function I(L,K){if(this.pulldowItemsFilter(L)){J.push(L);}},this);this.pulldownItems=J;},popupCssClass:"",item2textCss:mstrmojo.emptyFn,validate:function F(G){return mstrmojo.string.isEmpty(G)||mstrmojo.num.isNumeric(G);},getNewItem:function E(){return{n:"",did:-1};},itemFunction:function A(M,G,H){return new mstrmojo.Box({cssClass:"mstrmjo-RepeatPulldownList-item",children:[{scriptClass:"mstrmojo.SearchableDropDownList",alias:"pulldown",cssClass:"combo mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",placeholderText:C(12179,"Search for an #").replace("#",C(518,"Attribute").toLowerCase()),itemIdField:"did",searchEnabled:true,autofocus:false,selectedIndex:-1,defaultSelection:-1,clickInput2pop:true,popupCssClass:H.popupCssClass,item2textCss:H.item2textCss,valid:true,useRichTooltip:true,items:H.pulldownItems,onvalidChange:function L(P){this.hideTooltip();H.set("cValid",this.valid);if(!this.valid){var Q=this.domNode,O=mstrmojo.dom.position(Q);this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+C(11569,"Input contains invalid character")+"</span></div>",top:O.y-5,left:O.x+O.w+10};this.showTooltip();}else{this.richTooltip="";}mstrmojo.css.toggleClass(this.domNode,"err",!this.valid);},onkeyup:function L(O){if(this.selectedIndex<0){this.selectedItem=null;}var P=this.getSearchPattern(),Q=H.validate(P,this)||(this.selectedIndex>-1);this.set("valid",Q);this.createNextInputParamWidget();},prevalueChange:function N(){this.set("valid",true);var P=this.value,O=-1;if(P!==null){O=mstrmojo.array.find(this.items,this.itemIdField,P);}if(O>-1){this.selectedItem=this.items[O];this.selectedIndex=O;this.createNextInputParamWidget();}},postCreate:function I(){var O=M;if(O){if(O.did){this.value=O.did;}else{if(O.v!==undefined){this.defaultText=O.v;this.value=O.v;}}}},createNextInputParamWidget:function K(){if(H.itemIndex(M)!==H.items.length-1){return ;}H.items.add([H.getNewItem()]);this.parent.del.set("visible",true);},getTokens:function J(){var O=mstrmojo.ME.MetricToken.brackets,S=this.selectedItem,R=[],Q;if(S){if(S.did===this.value){Q={v:O(S.n)};if(S.t===21){Q.oi={did:S.attid,n:S.attn,t:12};Q.exv=S.fmdid;Q.extp=8;Q.v=O(S.attn)+"@"+O(S.fnm);}else{Q.oi=S;}R.push(Q);}}else{var P=this.getSearchPattern();if(P.length>0){Q={v:P};R.push(Q);}}return R;}},{scriptClass:"mstrmojo.Label",alias:"del",title:mstrmojo.desc(629,"Delete"),cssClass:"mstrmojo-RepeatPulldownList-del",cssDisplay:"inline-block",visible:(G<H.items.length-1),onclick:function(){H.items.remove(G,1);}}]});}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.ContextMenuItem","mstrmojo.WidgetList","mstrmojo.ListMapperTable");var H=false,B=20;function G(J,K){var L=J.itemsContainerNode;L.scrollTop=Math.min(Math.max(L.scrollTop+K,0),L.scrollHeight-L.offsetHeight);}function I(K,J){if(!K._scrollInter){var L=B*(J?-1:1);K._scrollInter=window.setInterval(function(){G(K,L);},50);}}function E(J){if(J._scrollInter){window.clearInterval(J._scrollInter);J._scrollInter=null;}}mstrmojo.ContextMenu=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.ContextMenu",zIndex:100,visible:true,makeObservable:true,markupString:'<div id={@id} class="mstrmojo-ContextMenu {@cssClass}" style="z-index: {@zIndex};{@cssText}"><div class="mstrmojo-CM-scrollup" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], true)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], true)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], true)" ></div><div class="mstrmojo-CM-itemsContainer">{@itemsHtml}</div><div class="mstrmojo-CM-scrolldown" onmousedown="mstrmojo.all.{@id}.onmousedownarrow(self, arguments[0], false)" onmouseup="mstrmojo.all.{@id}.onmouseuparrow(self, arguments[0], false)"onclick="mstrmojo.all.{@id}.onclickarrow(self, arguments[0], false)" ></div></div>',markupSlots:{scrollupNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.childNodes[1];},scrolldownNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){var K=this.domNode,P=this.itemsContainerNode,N=this.scrollupNode,M=this.scrolldownNode;K.style.display=this.visible?"block":"none";if(this.visible){N.style.display="none";M.style.display="none";P.style.overflow="auto";P.style.height="auto";var J=mstrmojo.dom.windowDim().h,O=K.offsetHeight,L=K.offsetWidth;if(J<O){N.style.display="block";N.style.minWidth=L+"px";M.style.display="block";M.style.minWidth=L+"px";P.style.overflow="hidden";P.style.height=(J-42)+"px";}}},onleftChange:function(){this.domNode.style.left=(this.left!=null)?this.left:"";},ontopChange:function(){this.domNode.style.top=(this.top!=null)?this.top:"";}},listMapper:mstrmojo.WidgetListMapperTable,itemFunction:function C(N,J,L){if(!H){mstrmojo.requiresCls("mstrmojo.ContextMenuItem");H=true;}var K={data:N,parent:L,hasSubmenu:L._cmSource.hasSubmenu(N),dynamicUpdate:L.dynamicUpdate,_cmSource:L._cmSource,zIndex:L.zIndex,itemIdField:L.itemIdField,itemField:L.itemField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction},M=new mstrmojo.ContextMenuItem(K);return M;},onmousedownarrow:function A(L,K,J){I(this,J);},onclickarrow:function F(L,K,J){G(this,B*(J?-1:1));},onmouseuparrow:function D(L,K,J){E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.dom","mstrmojo.TreeNodeSelector");var B=mstrmojo.dom,A={0:"closed",1:"opened",2:"leaf"};mstrmojo.TreeNode=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.TreeNode",markupString:'<li id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseover><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><ul class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</ul></li>',markupSlots:{stateNode:function(){return this.domNode.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.lastChild;},itemsContainerNode:function(){return this.domNode.lastChild;}},markupMethods:{ontextChange:function(){this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);},onstateChange:function(){this.stateNode.className="mstrmojo-TreeNode-state "+(A[this.state]||"closed");this.itemsContainerNode.style.display=(this.state===1)?"block":"none";},onselectedChange:function(){var D=this.selected?"addClass":"removeClass";mstrmojo.css[D](this.domNode.firstChild,["selected"]);},ondropCuePosChange:mstrmojo.WidgetList.prototype.markupMethods.ondropCuePosChange},renderOnScroll:false,listSelector:mstrmojo.TreeNodeSelector,premousedown:function C(D){var E=this._super(D),F=B.eventTarget(D.hWin,D.e);if(F===this.stateNode){if(this.state!==2){this.set("state",this.state===1?0:1);}}return E;},preclick:function(D){mstrmojo.dom.stopPropogation(D.hWin,D.e);},prechange:function(D){var E=this._super(D);if(E!==false){var F=this.tree;if(F&&F.onnodechange){F.onnodechange(D);}}return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Arr","mstrmojo.Button","mstrmojo.HBox","mstrmojo.FishEye");var A=function(B){return mstrmojo.hash.copy(B,{scriptClass:"mstrmojo.Button",text:"",enabled:false,dir:"left",cssClass:"mstrmojo-icon left",onclick:function(){var D=this.parent.fishEyeList,C=D&&D.scroll(this.dir,D.step);}});};mstrmojo.FishEyeContainer=mstrmojo.declare(mstrmojo.HBox,null,{scriptClass:"mstrmojo.FishEyeContainer",cssClass:"mstrmojo-FishEyeContainer",selectedIndex:-1,setItems:function(B){this.fishEyeList.set("items",B);},setSelectedIndex:function(B){this.fishEyeList.set("selectedIndex",B);},scrollable:false,rightScrollbale:false,children:[A({bindings:{enabled:"!!this.parent.scrollable"}}),({scriptClass:"mstrmojo.FishEye",alias:"fishEyeList",items:mstrmojo.Arr.makeObservable([]),srcId:"obList"}),A({alias:"feScrollRight",cssClass:"mstrmojo-icon right",dir:"right",bindings:{enabled:"!!this.parent.rightScrollable"}})]});mstrmojo.css=mstrmojo.hash.copy({getStyleValue:function(D,E){var B=null;if(D.currentStyle){E=(E==="float"?"styleFloat":E);B=D.currentStyle[E];}if(document.defaultView&&document.defaultView.getComputedStyle){E=(E==="float"?"cssFloat":E);var C=document.defaultView.getComputedStyle(D,null);B=C?C[E]:null;}return B;},setStyleValue:function(D,F,E){var B=function(G){return !!(G&&(typeof G==="object")&&(typeof G.length==="number"));};if(B(F)&&B(E)){var C;for(C in F){D.style[F[C]]=E[C];}}else{D.style[F]=E;}}},mstrmojo.css);}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.XtabZone","mstrmojo.css","mstrmojo.hash","mstrmojo.dom");var c=0,A=1,z=2,J=3,l={1:"_BL",2:"_TR",3:"_TL"},AH=1,u=2,o={position:"absolute",overflow:"hidden",width:"auto"},r={position:"absolute",top:0,left:0},E=mstrmojo.css,e=mstrmojo.hash,j=mstrmojo.dom;function L(AL,AK,AI,AJ){if(AJ){AL.replaceChild(AK,AL.tBodies[AI]);}else{AL.appendChild(AK);}}function I(AI){AI.offsetCellNode=null;AI.fstValueCellValidation=null;}function S(){var AO={x:0,y:0};if(this.lockHeadersCase&&!this.offsetCellNode&&!this.fstValueCellValidation){var AP=this.titlesCP.getSpanDimension(),AI=AP.nRow,AM=AP.nCol,AX=this.scrollboxNode.firstChild.firstChild,AT=AX&&AX.rows[AI];if(AI===0||AM===0){this.lockHeadersCase=c;return null;}if(!AX.rows.length){return null;}if(!AT){this.fstValueCellValidation|=AH;this.lockHeadersCase&=AH;AT=AX.rows[0];}var AW=AT&&AT.cells,AS=(AW&&AW.length)||0,AK,AQ,AR;for(AQ=AR=0;AQ<AS&&AR<AM;AQ++){AR+=AW[AQ].colSpan||1;}AK=AW&&AW[AQ];if(!AK){this.fstValueCellValidation|=u;this.lockHeadersCase&=u;this.offsetCellNode=AW&&AW[0];}else{this.offsetCellNode=AK;}var AV=this;var AL=function(){AV._adjustClipSize();};var AN=function(Ab,Ad){var Aa,AZ,AY,Ac;for(Aa=0;Aa<Ad;Aa++){AY=Ab.rows[Aa].getElementsByTagName("img");for(AZ=0;AZ<AY.length;AZ++){Ac=AY[AZ];Ac.onload=AL;Ac.onerror=AL;}}};AN(AX,AI||0);}if(this.lockHeadersCase){var AU=j.position(this.offsetCellNode),AJ=j.position(this.scrollboxNode.firstChild);AO.x=AU.x-AJ.x;AO.y=AU.y-AJ.y;}return AO;}function O(AK,AI,AJ,AO){if(this.parent.isAutoTableLayout()&&this.isRendered()){if(!this.fragment){this.fragment=document.createDocumentFragment();}if(AO){var AL=AK.cloneNode(true);if(!this.renderedPages){q.call(this);}if(AJ&&this.renderedPages[AI]){var AN=this.renderedPages[AI],AM=this.getTableNode();if(AN.parentNode===AM){AM.replaceChild(AL,AN);}else{this.fragment.replaceChild(AL,AN);}}else{this.fragment.appendChild(AL);}this.renderedPages[AI]=AL;}}}function AC(AJ,AI){for(var AK in AJ){if(AJ[AK]!=AI[AK]){return false;}}return true;}function s(){var AJ=this.fragment,AI,AM,AK;if(AJ&&AJ.childNodes.length>0&&this.isRendered()){var AL=this.getTableNode();if(this.parent.isOutlineMode){while(AJ.childNodes.length>0){AI=AJ.childNodes[0];AM=parseInt(AI.getAttribute("n"),10);if(AL.tBodies[AM]){AL.replaceChild(AI,AL.tBodies[AM]);}else{AL.appendChild(AI);}}}else{AL.appendChild(AJ);}}}function p(){var AJ=this.xtabClonedNodes,AN=this.cellHoverMgr,AL,AM,AI,AK;if(!AN){return ;}for(AI in AJ){AL=AJ[AI];AK=AL.getID();AM=AL.isRendered();if(!this.zones[AK]&&AM){this.zones[AK]={tableNode:AL.getTableNode()};if(typeof (AN)!="string"){AN.addMgrElement(AK);}}}}function N(AJ,AI){var AK=this.parent,AL=AK&&AK.zone;if(AI&&AL&&AL.addCoverTable){AL.addCoverTable(AJ,AI);}}function m(AJ,AI,AK){AJ.width=((AK&&AK.width<AI.right)?AK.width:AI.right)+"px";AJ.height=((AK&&AK.height<AI.bottom)?AK.height:AI.bottom)+"px";}function q(){this.renderedPages={};var AN=this.getTableNode(),AJ=AN.tBodies,AK=this.fragment,AP=AK&&AK.children,AM=this.renderedPages,AI,AL,AO=function(AQ){var AR=AQ.getAttribute("n")||0;AM[AR]=AQ;};for(AL=0,AI=AJ.length;AL<AI;++AL){AO(AJ[AL]);}for(AL=0,AI=(AP&&AP.length)||0;AL<AI;++AL){AO(AP[AL]);}}function K(AM,AI,AJ){var AK=AI&&AI.rows[AM.row],AL=AK&&AK.cells[AM.cell];if(AL&&AJ!==AL){AK.replaceChild(AJ.cloneNode(true),AL);}}function R(AJ,AI){if(this.isRendered()){if(!this.renderedPages){q.call(this);}K(AJ,this.renderedPages[AJ.page||0],AI);}}mstrmojo.XtabZoneWithClonedCover=mstrmojo.declare(mstrmojo.XtabZone,null,{scriptClass:"mstrmojo.XtabZoneWithClonedCover",isAutoTBLayout:null,addCoverTable:function M(AI,AJ){if(!this.coverTableNodes){this.coverTableNodes={};}this.coverTableNodes[l[AI]]=AJ;},getClonedNodesByPositions:function Q(AQ){var AP=this.coverTableNodes,AJ=AP&&AP[l[J]],AS=AP&&AP[l[z]],AM=AP&&AP[l[A]],AL=[AJ,AS,AM],AI,AT,AO=[],AK=function(AV,AX){var AU=AV&&AV.tBodies[AX.page||0],AW=AU&&AU.rows[AX.row];return AW&&AW.cells[AX.cell];};for(var AN in AQ){AI=AQ[AN];if(AI.page&&AM){AT=AK(AM,AI);AT&&AO.push(AT);}else{for(var AR in AL){if(AL[AR]){AT=AK(AL[AR],AI);AT&&AO.push(AT);}}}}return AO;},setHilites:function U(AS,AM){var AN=AM.getAttribute("ei"),AR=this.eiMap[AN]||(this.posMap[AN]&&[this.posMap[AN]])||[],AP=this.hiliteCellsMap,AL=this.parent,AJ=this.getNodesByPositions(AR),AI=function(AT){E.addClass(AT,"sc_"+AL.k);};if(!AP[AS]){AP[AS]={pos:[],nodes:[]};}if(!AJ.length){AI(AM);AP[AS].nodes.push(AM);}else{if(AR.length!==0){var AK=this.getClonedNodesByPositions(AR),AQ=AP[AS].pos;AJ=AK.concat(AJ);for(var AO in AJ){AI(AJ[AO]);}AP[AS].pos=AQ.concat(AR);}}},clearHilites:function C(AJ){var AM=this.hiliteCellsMap[AJ],AK=AM&&AM.nodes,AN=(AK&&AK.length===0&&AM.pos)||[],AL=this.parent;if(AN.length!==0){AK=this.getNodesByPositions(AN);AK=AK.concat(this.getClonedNodesByPositions(AN));}for(var AI in AK){E.removeClass(AK[AI],"sc_"+AL.k);}this.hiliteCellsMap[AJ]={nodes:[],pos:[]};},isAutoTableLayout:function AA(){if(this.isAutoTBLayout===null&&this.tableNode){this.isAutoTBLayout=(this.tableNode.style.tableLayout!=="fixed");}return this.isAutoTBLayout;},unrender:function B(AI){this.coverTableNodes={};this.isAutoTBLayout=null;this._super(AI);}});mstrmojo.XtabClonedNode=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.XtabClonedNode",domNode:null,left:0,top:0,lockType:c,scrollDM:mstrmojo.emptyFn,refreshNode:mstrmojo.emptyFn,createDomNode:function b(){var AI=this._getClonedFragment();this.containerNode.appendChild(AI);N.call(this,this.lockType,this.getTableNode());},getID:function V(){return this.id;},getTableSize:function Z(){var AJ=this.parent.zone.tableNode,AI=this.parent.hasCustomScrollbar?"offset":"client";return{width:AJ[AI+"Width"],height:AJ[AI+"Height"]};},isRendered:function H(){return !!this.domNode;},getTableNode:function AF(){return this.isRendered()?this.domNode.firstChild.firstChild:null;},destroy:function v(AI){if(this.isRendered()){this.unrender(true);}this._super(AI);},unrender:function B(AI){this.domNode=null;this.lastClipRect=null;this._super&&this._super(AI);},insertPage:function AG(AK,AI,AJ,AL){if(this.isRendered()){L(this.getTableNode(),AK.cloneNode(true),AI,AJ);}},_getClipStr:function a(AI){this.lastClipRect=AI;return"rect("+AI.top+"px, "+AI.right+"px, "+AI.bottom+"px, "+AI.left+"px)";},adjustClip:function d(AK){var AI=this._getClipRect&&this._getClipRect(AK);if(this.isRendered()){if(this.getTableNode().offsetHeight>this.domNode.offsetHeight){this.domNode.style.height=this.getTableNode().offsetHeight+"px";}if(AI&&!(this.lastClipRect&&AC(AI,this.lastClipRect))){this.domNode.style.clip=this._getClipStr(AI);var AJ={};m(AJ,AI,this.getTableSize());e.copy(AJ,this.curtainNode.style);}}this.offset=AK;}});mstrmojo.XtabClonedRowHeader=mstrmojo.declare(mstrmojo.XtabClonedNode,null,{scriptClass:"mstrmojo.XtabClonedRowHeader",lockType:A,interactiveCellsArray:[],interactivePosArray:[],dicGroupKey:[],init:function AD(AI){this._super(AI);if((this.lockHeadersCase&A)&&this.left){this.createDomNode();}},_getClipRect:function D(AJ){var AI=this.parent.hasCustomScrollbar?"offset":"client";AJ=AJ||this.offset;return{top:0,right:AJ.x||0,bottom:this.toCloneNode[AI+"Height"],left:0};},_clearLocalData:function G(){this.interactiveCellsArray=[];this.interactivePosArray=[];this.dicGroupKey=[];},_getClonedFragment:function Y(){var AI=document.createDocumentFragment(),AM=this.toCloneNode.cloneNode(true),AL=document.createElement("div"),AK=e.clone(o),AN=e.clone(r),AJ=this._getClipRect();AK.clip=this._getClipStr(AJ);AK.zIndex=2;if(this.parent.zone&&this.parent.zone.autoFitWindow){AK.width="100%";}AK.overflowY="hidden";AM.id=this.getID();e.copy(AK,AM.style);e.copy({top:-this.top+"px"},AM.firstChild.style);this.domNode=AM;m(AN,AJ,this.getTableSize());AN.zIndex=1;e.copy(AN,AL.style);this.curtainNode=AL;AI.appendChild(AM);AI.appendChild(AL);return AI;},scrollDM:function g(AJ,AO,AQ){var AK=this.parent.shouldClipLockableXtab,AL;if(this.lockHeadersCase&A){if(!this.isRendered()){this.top=AO;this.createDomNode();this.domNode.style.width="100%";this.domNode.style.height="100%";var AN=this;setTimeout(function(){AN._updateDICGroup();},10);}else{var AP=this.domNode.firstChild,AI=AP.style;AI.top=-AO+"px";this.top=AO;if(AK){if(AI.position!=="absolute"){AI.position="absolute";AI.width="100%";}if(this.lockHeadersCase&z){AL={top:this.offset.y+AO,right:this.offset.x,bottom:AP.offsetHeight,left:0};AI.clip=this._getClipStr(AL);}}}if(AK&&this.isRendered()){var AS=this.getTableNode();AL={top:0,right:Math.max(AS.offsetWidth,AQ.offsetWidth),bottom:Math.max(AS.offsetHeight,AQ.offsetHeight),left:this.offset.x+AJ};var AM=AQ.style,AR=AQ.parentNode.style;if(AM.position!=="absolute"){if(isNaN(parseInt(AR.width,10))){AR.width=AQ.parentNode.offsetWidth+"px";}if(isNaN(parseInt(AR.height,10))){AR.height=AQ.parentNode.offsetHeight+"px";}AM.position="absolute";AM.width="100%";if(isNaN(parseInt(AR.width,10))){AR.width=AL.right+"px";}}AM.clip=this._getClipStr(AL);}}},_updateDICGroup:function k(){var AI=this.parent;if(this.interactivePosArray.length&&this.interactiveCellsArray.length){AI.destroyDICGroup(this.dicGroupKey);AI.configureCellsAction(this.interactiveCellsArray,0,this.interactivePosArray,true);}this._clearLocalData();},addTempDICInfo:function AB(AI,AJ){if(!this.isRendered()){this.interactiveCellsArray.push(AI);this.interactivePosArray.push(AJ);}},addGroupKey:function AE(AI){if(!this.isRendered()){this.dicGroupKey.push(AI);}},onCellUpdated:function t(AN,AK){if(this.isRendered()){var AI=this.getTableNode(),AJ=AI&&AI.tBodies[AN.page||0],AL=AJ&&AJ.rows[AN.row],AM=AL&&AL.cells[AN.cell];if(AM&&AK!==AM){AL.replaceChild(AK.cloneNode(true),AM);}}},unrender:function B(AI){this._clearLocalData();this._super&&this._super(AI);}});mstrmojo.XtabClonedColHeader=mstrmojo.declare(mstrmojo.XtabClonedNode,null,{scriptClass:"mstrmojo.XtabClonedColHeader",lockType:z,init:function AD(AI){this._super(AI);if(this.lockHeadersCase&z){this.createDomNode();}},_getClipRect:function D(AJ){var AI=this.parent.hasCustomScrollbar?"offset":"client";AJ=AJ||this.offset;return{top:0,right:this.toCloneNode[AI+"Width"],bottom:AJ.y||0,left:0};},_getClonedFragment:function Y(){var AI=document.createDocumentFragment(),AM=this.toCloneNode.cloneNode(true),AL=document.createElement("div"),AK=e.clone(o),AN=e.clone(r),AJ=this._getClipRect();AK.clip=this._getClipStr(AJ);AK.zIndex=4;if(this.parent.zone&&this.parent.zone.autoFitWindow){AK.width="100%";}AM.id=this.getID();e.copy(AK,AM.style);e.copy({left:-this.left+"px"},AM.firstChild.style);this.domNode=AM;m(AN,AJ,this.getTableSize());AN.zIndex=3;e.copy(AN,AL.style);this.curtainNode=AL;AI.appendChild(AM);AI.appendChild(AL);return AI;},scrollDM:function g(AJ,AN,AP){var AK=this.parent.shouldClipLockableXtab,AL;if(this.lockHeadersCase&z){var AR=this.getTableNode();var AO=this.domNode.firstChild,AI=AO.style;this.domNode.style.width="100%";this.domNode.style.height="100%";AI.left=-AJ+"px";this.left=AJ;if(AK){if(AI.position!=="absolute"){AI.position="absolute";AI.width="100%";}if(this.lockHeadersCase&A){AL=this._getClipRect();AL.left=AJ+this.offset.x;AL.right=Math.max(AO.offsetWidth,AR.offsetWidth);AI.clip=this._getClipStr(AL);}}if(AK){AL={top:this.offset.y+AP.parentElement.scrollTop,right:Math.max(AR.offsetWidth,AP.offsetWidth),bottom:Math.max(AR.offsetHeight,AP.offsetHeight),left:0};if(this.lockHeadersCase&A){AL.left=this.offset.x+AJ;}var AM=AP.style,AQ=AP.parentNode.style;if(AM.position!=="absolute"){if(isNaN(parseInt(AQ.width,10))){AQ.width=AP.parentNode.offsetWidth+"px";}if(isNaN(parseInt(AQ.height,10))){AQ.height=AP.parentNode.offsetHeight+"px";}AM.position="absolute";AM.width="100%";if(isNaN(parseInt(AQ.width,10))){AQ.width=AR.offsetWidth+"px";}}AM.clip=this._getClipStr(AL);}}},insertPage:O,refreshNode:s,onCellUpdated:R,unrender:function B(AI){this._super(AI);this.fragment=null;this.renderedPages=null;}});mstrmojo.XtabClonedTitle=mstrmojo.declare(mstrmojo.XtabClonedNode,null,{scriptClass:"mstrmojo.XtabClonedTitle",_getClipRect:function D(AI){AI=AI||this.offset;return{top:0,right:AI.x||0,bottom:AI.y||0,left:0};},init:function AD(AI){this._super(AI);if(this.lockHeadersCase===J&&this.left){this.createDomNode();}},_getClonedFragment:function Y(){var AI=document.createDocumentFragment(),AM=this.toCloneNode.cloneNode(true),AL=document.createElement("div"),AK=e.clone(o),AN=e.copy(r),AJ=this._getClipRect();AK.clip=this._getClipStr(AJ);AK.zIndex=6;if(this.parent.zone&&this.parent.zone.autoFitWindow){AK.width="100%";}e.copy(AK,AM.style);AM.firstChild.style.left=0;AM.id=this.getID();this.domNode=AM;m(AN,AJ,this.getTableSize());AN.zIndex=5;e.copy(AN,AL.style);this.curtainNode=AL;AI.appendChild(AM);AI.appendChild(AL);return AI;},scrollDM:function g(AL,AK,AJ){if(this.lockHeadersCase===J&&!this.isRendered()){this.createDomNode();this.domNode.style.width="100%";this.domNode.style.height="100%";}if(this.parent.shouldClipLockableXtab&&this.isRendered()){var AI=this.domNode.firstChild.style;if(AI.position!=="absolute"){AI.position="absolute";AI.width="100%";}AI.clip=this._getClipStr(this._getClipRect());}},insertPage:O,refreshNode:s,onCellUpdated:R,unrender:function B(AI){this._super(AI);this.fragment=null;this.renderedPages=null;}});mstrmojo._IsLockableXtab={_mixinName:"mstrmojo._IsLockableXtab",initLock:function x(AQ){var AM=S.call(this),AP=this.scrollboxNode;if(this.lockHeadersCase&&AP&&AM){var AO=document.createElement("div"),AI=e.copy(AQ,{containerNode:AO,toCloneNode:AP,offset:AM,lockHeadersCase:this.lockHeadersCase,parent:this});if(!this.xtabClonedNodes){this.xtabClonedNodes=[];}if(this.lockHeadersCase&A){if(!this.clonedRowHeader){this.clonedRowHeader=this.addDisposable(new mstrmojo.XtabClonedRowHeader(AI));this.xtabClonedNodes.push(this.clonedRowHeader);}}if(this.lockHeadersCase&z){if(!this.clonedColHeader){this.clonedColHeader=this.addDisposable(new mstrmojo.XtabClonedColHeader(AI));this.xtabClonedNodes.push(this.clonedColHeader);}}if(this.lockHeadersCase===J){if(!this.clonedTitle){var AK=this.clonedColHeader,AN=AK.domNode,AJ=AK.fragment;AI.toCloneNode=AN||AI.toCloneNode;AI.fragment=AJ&&AJ.cloneNode();this.clonedTitle=this.addDisposable(new mstrmojo.XtabClonedTitle(AI));this.xtabClonedNodes.push(this.clonedTitle);}}var AL=this.hasCustomScrollbar?"offset":"client",AR={top:0,left:0,position:"absolute",overflow:"hidden",width:AP[AL+"Width"]+"px",height:AP[AL+"Height"]+"px"};e.copy(AR,AO.style);this.tableContainerNode.appendChild(AO);this.lockFragment=AO;p.call(this);}},getColClonedZone:function F(){return this.clonedColHeader&&this.clonedColHeader.domNode.firstChild;},createZone:function n(AI){return new mstrmojo.XtabZoneWithClonedCover(AI||{});},getStickedTableNodes:function X(){var AJ=this.xtabClonedNodes,AK=[];if(AJ instanceof Array){for(var AI in AJ){var AL=AJ[AI];if(AL.isRendered()){AK.push(AL.getTableNode());}}}return AK;},_adjustClipSize:function h(){if(this.lockHeadersCase){var AJ=this.xtabClonedNodes;if(AJ&&AJ.length){var AK=S.call(this);this.lockFragment.style.width=(this.hasCustomScrollbar?parseInt(this.scrollboxNode.style.width,10):this.scrollboxNode.clientWidth)+"px";this.lockFragment.style.height=this.scrollboxNode.clientHeight+"px";for(var AI in AJ){AJ[AI].adjustClip(AK);}}}},_refreshClonedNodes:function W(){var AL=this.xtabClonedNodes,AR=this.scrollboxNode.firstChild.firstChild,AI=this.titlesCP.getSpanDimension().nRow,AQ=AR&&(AR.rows[AI]||AR.rows[0]),AP=AQ&&AQ.cells,AJ=AP&&AP.length,AM=[],AO=!this.lastCellsRBOffsetLeft,AN;for(AN=0;AN<AJ;++AN){var AK=AP[AN].offsetWidth;AM.push(AK);if(!AO){AO=(this.lastCellsRBOffsetLeft[AN]!=AK);}}this.lastCellsRBOffsetLeft=AM;if(AO){for(AN in AL){AL[AN].refreshNode();}this._adjustClipSize();this.alignLockNodes(this.scrollboxLeft,this.scrollboxTop);}else{this._adjustClipSize();}},alignLockNodes:function w(AL,AK){var AJ=this.xtabClonedNodes;if(AJ&&AJ.length){for(var AI in AJ){AJ[AI].scrollDM(AL,AK,this.scrollboxNode.firstChild);}p.call(this);}},isAutoTableLayout:function AA(){return this.zone.isAutoTableLayout();},onPageRendered:function P(AL,AI,AJ,AN){this._super&&this._super(AL,AI,AJ,AN);if(AJ&&AI===0){I(this);}var AK=this.xtabClonedNodes;if(AK&&AK.length){for(var AM in AK){AK[AM].insertPage(AL,AI,AJ,AN);}}},gridPagesRendered:function f(){this._super&&this._super();if(!this.lockHeadersCase){return ;}if(!this.xtabClonedNodes){this.initLock();}else{if(this.isAutoTableLayout()){this._refreshClonedNodes();}}},onCellUpdated:function t(AI,AL){var AM=this.zone,AN=AM.posMap[AI._ei],AJ=AM.tableNode.tBodies[AN.page||0],AK=this.xtabClonedNodes;K(AN,AJ,AL);for(idx in AK){AK[idx].onCellUpdated(AN,AL);}if(this.isAutoTableLayout()){this._refreshClonedNodes();}},unrender:function B(AK){var AJ=this.xtabClonedNodes,AI;if(AJ&&AJ.length){for(AI in AJ){AJ[AI].unrender(true);}}this.zones=null;I(this);this.lockFragment=null;this.xtabClonedNodes=null;this.clonedColHeader=null;this.clonedRowHeader=null;this.clonedTitle=null;this.lastCellsRBOffsetLeft=null;this._super(AK);}};})();(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.vi.viz.MapVisualizationTransition");var A=mstrmojo.gmaps.EnumGraphicType;mstrmojo.vi.viz.MapboxVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.MapVisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.MapboxVisualizationTransition",shouldSkipTransition:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresClsP("mstrmojo.vi.viz","BaseVisualizationTransition","KnownVisualizations");mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.chart.model.enums.EnumDSSGraphMarkerShape");var F=mstrmojo.array,B=mstrmojo.hash,I=mstrmojo.vi.viz.KnownVisualizations,E=mstrmojo.chart.model.enums.EnumDSSObjectType,J=201,D=E.DssTypeMetric;function G(L,M,K){switch(L){case I.GRID:return[];case I.HEATMAP:if(K){return["ColorBy","SizeBy","AdditionalMetrics"];}else{return["Grp"];}case I.GRAPHMATRIX:switch(M){case J:if(K){return["AngleBy","XAxis","YAxis","ColorBy","SizeBy","AdditionalMetrics"];}else{return["SliceBy","Rows","YAxis","BreakBy","Columns","XAxis"];}default:if(K){return["XAxis","YAxis","ColorBy","SizeBy","AdditionalMetrics"];}else{return["Rows","YAxis","BreakBy","Columns","XAxis"];}}case I.ESRIMAP:case I.GOOGLEMAP:case I.MAPBOX:if(K){return["ColorBy","SizeBy","AdditionalMetrics"];}else{return["Geo","AdditionalMetrics","Lat","Long"];}case I.NETWORK:if(K){return["ColorBy","SizeBy","itemsz"];}else{return["from","to"];}case I.KPICARD:if(K){return["metric"];}else{return["BreakBy","trend"];}default:return["XAxis","YAxis","BreakBy","SliceBy","ColorBy","SizeBy","AdditionalMetrics","AngleBy","Grp","Geo","layout","from","to","itemsz","Lat","Long"];}}function C(L,O,K){var N=[],M=O.concat();F.forEach(L,function(P){F.forEach(M,function(Q,R){if(P.id===Q.did||P.did===Q.did){Q.fromZone=P.fromZone;if(K){Q.t=D;}N.push(Q);M.splice(R,1);return false;}});});return N;}function A(K,a){var L=K.node,O=L.data,b=O.dz,Z=O.gsi,S=(Z.rows||[]).concat(Z.cols||[]),N=O.gsi.mx||[],W=[],P=[];var R=I.getDefinition(O.visName||"Grid").id,Y=(R===I.GRAPHMATRIX&&K.GMController.isPie)?J:null;var V=K.zonesModel.getCustomDropZones,Q=V&&V instanceof Function,M=Q?K.zonesModel.getCustomDropZones():null;var U=function U(c){F.forEach(G(R,Y,c),function(e,f){var d=b[e]||{};F.forEach((c?d.TemplateMetric:d.TemplateUnit),function(g){g.fromZone=Q?M[f].name:e;if(c){P.push(g);}else{W.push(g);}});});};U(false);if(W.length>0){W=C(W,S,false);}else{W=F.filter(Z.rows,function(c){c.fromZone="Rows";return c.did!=="-1";}).concat(F.filter(Z.cols,function(c){c.fromZone="Columns";return c.did!=="-1";}));}U(true);if(P.length>0){P=C(P,N,true);}else{P=N.concat();F.forEach(P,function(c){c.t=D;c.fromZone="Metrics";});}var X=a.transitionDropZones(W,P);return X.map(function(d){var c=d.obj;return{act:"addDropZoneUnit",zoneId:d.toZoneId,unitId:c.did,unitType:c.t};});}mstrmojo.vi.viz.CustomVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.BaseVisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.CustomVisualizationTransition",transitionDropZones:function H(Q,V){var K=this.newVizInfo,W=K.s,P=K.dz,S=this.vis,U=S.node,c=U.k,b=U.data;if(W===b.visName){return{wp:"",handled:true};}else{if(!P){return this._super(Q,V);}}mstrmojo.requiresCls("mstrmojo."+P);var Z=B.walk(P,mstrmojo),Y=new Z({getDZFlatStruct:function M(){return{};}}),L=Y.getCustomDropZones&&Y.getCustomDropZones();if(!L||L.length===0){var a=Q[Q.length-1],R=a&&a.actions,X=R&&R[0];if(X&&X.act==="createDefaultDropZones"){X.widgetType=0;}return this._super(Q,V);}var O=Y.customDropZonesTransition;if(O&&O instanceof Function){var N=A(this.vis,Y);if(N){Q.push({act:"updateTemplate",keyContext:c,partialRetrieval:{nodes:[c]},actions:N});}}return{wp:"<props><widgetProps /></props>",handled:false};}});}());(function(){mstrmojo.requiresClsP("mstrmojo.vi.viz","BaseVisualizationTransition");var A=mstrmojo,E=A.vi.viz,C=E.KnownVisualizations,D="Grid";mstrmojo.vi.viz.GridVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.BaseVisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.GridVisualizationTransition",transitionDropZones:function B(J,I){var H=this.vis,G=H.node.data,F=G.visName||D;if(C.getDefinition(F).id!==C.GRID){return this._super(J,I);}return{wp:"",handled:false};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasScrollbox","mstrmojo.XtabZone","mstrmojo._ShowsStatus","mstrmojo.boxmodel","mstrmojo._IsLockableXtab","mstrmojo._IsDocumentTemplate","mstrmojo.hash","mstrmojo.dom","mstrmojo.chart.model.enums.EnumDSSBaseFormType");var Q=1,Y=2,Z=0,C=1,z=2,N=3;var M=1;var AB=2;var I=4;var h=8;var e=mstrmojo.dom,q;function AF(AH){var AI=null;if(AH&&AH.length>1){AI=new mstrmojo.XtabVACP();AI.cps=AH;}return AI;}function J(AJ){if(!AJ||this._onDemandCP){return null;}var AS=AJ.bc,AQ=AJ.tc,AK=AJ.tbc,AT=AJ.rm===2,AI=AT?this.gridData.ghs.rhs.items.length:AS,AL=AQ-AI,AM=AT?AK-AS:AQ-AI,AR=Math.ceil(AM/AS),AO=[],AP=[],AN;if(AT){AS=Math.floor(AL/AR);}for(AN=0;AN<AR;++AN){if(AT&&AR===(AN+1)&&AL>AS){AS=AL;}var AH=Math.min(AL,AS);AO.push(this.createOnDemandCP(AN+1,AH,I));AP.push(this.createOnDemandCP(AN+1,AH,h));AL-=AS;}this._onDemandCP={rhs:AO,vls:AP};return this._onDemandCP;}mstrmojo.XtabTitlesCP.prototype.shouldClonedLastTitleCell=function(){return false;};mstrmojo.XtabBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsLockableXtab,mstrmojo._HasScrollbox,mstrmojo._ShowsStatus,mstrmojo._IsDocumentTemplate],{scriptClass:"mstrmojo.XtabBase",dataRenderMode:"vscroll",shouldClipLockableXtab:true,handleClicks:function H(){return true;},markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-Xtab {@cssClass}" title="{@tooltip}" style="{@domNodeCssText}"><div style="display: none;{@msgNodeCssText}"><div class="text"><div class="warning-icon"></div><div>&nbsp;</div></div></div><div class="mstrmojo-Xtab-overlay"></div><div class="mstrmojo-Xtab-content {@cssDefault}" title="{@tooltip}" style="{@viewportCssText}" mstrAttach:click,selectstart,touchstart><table cellspacing="0" cellpadding="0"><tr><td style="vertical-align:top;padding:0;"><div style="position: relative;"><div class="mstrmojo-progress" style="display:none"><div class="mstrmojo-progress-barbg"><div class="mstrmojo-progress-bar"></div></div><div class="mstrmojo-progress-text"></div></div><div id="{@id}_scrollbox" style="position:relative;{@scrollboxNodeCssText};{@scrollboxNodeOverflow}"></div></div></td></tr></table></div></div>',markupSlots:{overlayNode:function(){return this.domNode;},msgNode:function(){return this.domNode.firstChild;},maskNode:function(){return this.domNode.childNodes[1];},viewport:function(){return this.domNode.lastChild;},contentNode:function(){return this.domNode.lastChild.firstChild;},scrollboxNode:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0].firstChild.lastChild;},tableContainerNode:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0].firstChild;},_STATUS:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0].firstChild.firstChild;},_STATUS_TXT:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0].firstChild.firstChild.lastChild;},_STATUS_BAR:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0].firstChild.firstChild.firstChild;},_TB_CELL:function(){return this.domNode.lastChild.firstChild.rows[0].cells[0];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=(this.visible)?"block":"none";}},zone:null,lockHeadersCase:N,interactiveCellsArray:null,titlesCP:null,chsCP:null,rhsCP:null,valuesCP:null,onDemandIF:true,numRowFixed:false,heightLimit:0,height:0,widthLimit:0,width:0,useTouchScrolling:false,scrollInterval:0,selections:null,dataBlocks:null,getCellUnitIndex:function n(AH){return(AH.o!==undefined)?AH.o:AH._ei;},getCellTitleId:function f(AH){var AI="";if(AH.axis&&AH.ui!==undefined){AI=AH.axis+"A"+(AH.ui+1);}else{if(AH.mix!==undefined){AI="0A"+AH.mix;}}return AI;},update:function l(AI){this.set("gridData",AI.data[0]||AI.data);var AH=this.defn||AI.defn;this.sid=this.gridData.sid;this.treeType=(AH&&AH.tt)||1;this.interactiveCellsArray=[];if(this._super){return this._super(AI);}return true;},initCP:function F(AJ,AI,AO,AL,AN,AK,AM){var AH={gridData:AJ,type:AO,interactiveCellsArray:AI,defn:this.defn};AH.base=AL||AH.base;AH.lookupBase=AN||AH.lookupBase;AH.axis=AK||AH.axis;if(!AM){if(AO===M){AM=new mstrmojo.XtabTitlesCP(AH);}else{AM=new mstrmojo.XtabCP(AH);}}else{mstrmojo.hash.copy(AH,AM);}return AM;},preBuildRendering:function D(){var AJ=this.gridData,AH=this.height,AI=this.width;this.lockHeadersCase=AJ.lhv||Z;this.selections={};this.numRowFixed=!!(!AH&&AJ.rw&&AJ.rw.row&&(AJ.rw.row.bc<AJ.rw.row.tc));this.rw=AJ.rw;this._onDemandCP=null;if(AI){this.widthLimit=parseInt(AI,10);}if(AH){this.heightLimit=parseInt(AH,10);}return this._super();},renderEmptyGrid:function r(){var AK=this.gridData,AI=this.msgNode,AJ=AI.style,AH=this.viewport;AI.firstChild.childNodes[1].innerHTML=AK.eg;if(AK.eg!==""&&!this.excludeData){AJ.display="block";AJ.overflow="hidden";AI.className="mstrmojo-message";AH.style.display="none";}return true;},postBuildRendering:function V(){var AM=this.gridData,AJ=!!this.viewport&&AM,AI=this.msgNode,AH=this.viewport,AL;if(AM.eg===undefined){if(AI.style.display==="block"){AI.style.display="none";AH.style.display="block";}}else{return this.renderEmptyGrid();}if(!this.interactiveCellsArray){this.interactiveCellsArray=[];}if(AJ){AM.ghs=AM.ghs||[];AM.gts=AM.gts||[];this._setupZone(AM);this._setupCP(AM);var AO=this.zone;if(AO.parent!==this){this.addChildren(AO);}if(this.scrollboxNode){var AK=this.heightLimit;this.scrollboxHeightFixed=!isNaN(AK)&&(AK>0);if(this.scrollboxHeightFixed){this.scrollboxHeight=AK;}this.scrollboxLeft=this.scrollboxTop=0;this.connectScrollbox(this);}}this.renderChildren();if(this.controller&&this.controller.getScrollPosition){var AN=this.controller.getScrollPosition(this.controller.model.oid+"."+this.gridData.k);if(AN){this.scrollTo(AN);}}AL=this._super();if(this.numRowFixed){if(!this.height){this.heightLimit=this.zone.getPageHeight(0);this.height=this.heightLimit+"px";}else{this.heightLimit=parseInt(this.height,10);}}if((AJ&&this.scrollboxNode&&AM.afc)||this.numRowFixed){this.resizeScrollBox();}this.onGridWidthChanged(AM.afc||AM.afw);this._onContainerGrowShrink(this.widthLimit,this.heightLimit);if(this.scrollboxNode&&this.scrollboxNode.childNodes&&this.scrollboxNode.childNodes[0]){this.scrollboxNode.style.zIndex=this.scrollboxNode.childNodes[0].style.zIndex;}if(this.lockHeadersCase&&this.initLock){this.initLock({top:this.scrollboxTop,left:this.scrollboxLeft});}if(this.configureActions){this.configureActions();}return AL;},onclick:function o(AI){var AK=mstrmojo.dom,AM=AI.getTarget(),AL=AM&&AK.findAncestorByName(AM,"td",true,this.viewport);if(AM.nodeName.toLowerCase()==="a"&&AL.getAttribute("ei")){try{var AJ=this.interactiveCellsArray[parseInt(AL.getAttribute("ei"),10)];if(AJ&&AJ.ts===mstrmojo.chart.model.enums.EnumDSSBaseFormType.DssBaseFormHTMLTag){AM.href=mstrmojo.addCSRFTokenToURL(AM.href);}}catch(AN){}}if(AL){var AH=AK.findAncestorByName(AM,"span",true,AL);if(AH&&!AI.shiftKey&&!AI.ctrlKey){this.defaultAction(AL);}else{this.doSelection(AI.e,AI.hWin,AL);}}if(this.isSelectingText){this.isSelectingText=false;}},ontouchend:function j(AI,AH){this.onclick(mstrmojo._HasMarkup.newDomEvent("click",AH,AI));},onselectstart:function s(AI,AH){if(this.isHandleNode&&this.isHandleNode(AI.getTarget())){e.preventDefault(AH,AI);}return false;},onscroll:function t(){this._alignHeaders();if(this.controller&&this.controller.addScrollPosition){this.controller.addScrollPosition(this.controller.model.oid+"."+this.gridData.k,this.scrollboxLeft,this.scrollboxTop);}},resizeScrollBox:function K(){var AK=this.scrollboxNode,AJ=AK&&AK.style,AI=this._TB_CELL;if(!AJ||!AI){return ;}var AH=this.heightLimit;if(!AH){AJ.height="auto";this.scrollboxHeightFixed=false;}else{if(AH>0){AJ.height=AH+"px";this.scrollboxHeight=AH;this.scrollboxHeightFixed=true;}}this._resizeScrollBoxWidth();},_onContainerGrowShrink:function AG(AI,AL){var AH=mstrmojo.findAncestor(this,"fixedSizeCanGrowShrink",null,mstrmojo.DocSection),AK=AI||null,AJ=AL||null;if(AK||AJ){if(AH){AH.fixedSizeCanGrowShrink(this,AJ,AK);}}else{if(AH){AH.performCanGrowCanShrink([this],true);}}},_resizeScrollBoxWidth:function W(){var AN=this.scrollboxNode,AL=AN.scrollWidth+(AN.offsetWidth-AN.clientWidth),AJ=AN&&AN.style,AI=this._TB_CELL;if(this.useTouchScrolling||!AJ||!AI){return ;}var AK=this.widthLimit;if(!AK){var AM=AN.firstChild.style,AH=AM.position;AM.position="relative";AJ.width="auto";AL=AN.firstChild.firstChild.offsetWidth+(AN.offsetWidth-AN.clientWidth);AN.firstChild.style.position=AH;}if((AL&&(AL>0))&&(!AK||(AK&&(AL<AK)))&&(AN.firstChild.firstChild.offsetWidth>=AN.clientWidth)){AJ.width=AL+"px";}},onGridWidthChanged:function d(AI){if(!AI){this._resizeScrollBoxWidth();}var AH=this.widthLimit;if(!AH){this.width=q;}this._onContainerGrowShrink(AH,null);},getGridDimension:function R(AK){var AI=1,AJ=AK===AI?"Height":"Width",AL=AJ.toLowerCase(),AH=this[AL+"Limit"];if(!AH&&(this[AL]===q||this[AL]===0)){AH=this.viewport["offset"+AJ];this[AL]=AH+"px";return AH;}return AH||parseInt(this[AL],10);},_alignHeaders:function B(AH){var AJ=this.scrollboxLeft,AI=this.scrollboxTop;if(this.lockHeadersCase&&this.alignLockNodes){this.alignLockNodes(AJ,AI);}},defaultAction:function S(AM,AI){var AH=AI||this.getCellForNode(AM),AL=AM&&AM.className.indexOf("sc_")>0;if(this.model&&this.model.data&&this.model.data.visName&&this.model.data.visName==="InteractiveGridAjaxVisualizationStyle"){AL=this.isReselectedTD(AH);if(AL&&this.hasSelectAll&&this.hasSelectAll(AH)){this.IGCurrentSelectedCell=null;}else{this.IGCurrentSelectedCell=AH;}}var AK=this.model.getAction(this.getActionCells(AH),AM,AL),AJ=AK&&AK.h;this._currentSelectedTD=AM;if(AJ&&this.controller[AJ]){this.controller[AJ](this,AK.a);return true;}return false;},createZone:function m(AI){var AJ=AI||{},AH=this._super&&this._super(AJ);if(!AH){AH=new mstrmojo.XtabZone(AJ);}return AH;},_setupZone:function u(AL){this.zones={};if(!this.zone){this.zone=this.createZone({renderMode:this.dataRenderMode,cssText:"z-index: 1",slot:"scrollboxNode"});}var AH=this.zone;this.zones.origin=AH;AH.rh=AL.rh;AH.autoFitWindow=!!AL.afw;AH.autoFitContent=!!AL.afc;if(!this.isVIXtab){AH.tableCssClass="r-cssDefault"+(this.k?"_"+this.k:"");}AH.numColumnCanMerge=AL.gts&&AL.gts.cws?(AL.gts.cws.length-1):0;var AM=[],AJ=undefined,AN=null,AK,AI;mstrmojo.array.forEach(AL.gts&&AL.gts.row,function(AO){AK=AN&&AN.id===AO.id;if(AK){AM[AM.length-1]+=AO.fs&&AO.fs.length||1;}else{if(AO.otp===-1){AJ=0;mstrmojo.array.forEach(AM,function(AP){AJ+=AP;});}AM.push(AO.fs&&AO.fs.length||1);}AN=AO;});AH.acws=AM;AH.rowMerge=AL.gsi&&AL.gsi.prop&&AL.gsi.prop.rows&&AL.gsi.prop.rows.mg!=="0";AI=AL.ghs&&AL.ghs.chs;AH.headerOffset=AI&&(AI.show?(AI.items&&AI.items.length||1):0)-1;AH.mxPos=AJ;},getHACP:function AE(AI){var AH;if(AI){AH=new mstrmojo.XtabLevelHACP();if(this.outlineState){AH.outlineState=this.outlineState;}}else{AH=(this._super&&this._super())||new mstrmojo.XtabHACP();}return AH;},_setupCP:function X(AN){var AK=this.titlesCP=this.getTitleCP(AN),AM=this.chsCP=this.getColumnHeadersCP(AN),AI=this.rhsCP=this.getRowHeadersCP(AN),AJ=this.valuesCP=this.getValuesCP(AN);AK.forceAutoRowHeight=AM.forceAutoRowHeight=AN.rh;var AQ=new mstrmojo.XtabVACP();var AH=this.getHACP();AH.cps=[AK,AM];AQ.cps=[AH];var AO=this.getHACP(this.isOutlineMode);AO.cps=[AI,AJ];AQ.cps.push(AO);var AP=AN.gmh&&AN.gmh.gmrh,AL=AN.rw&&AN.rw.row;if(AP&&AL){AQ.gsmh={};AQ.gemh={};AQ.gsmh[AL.bb]=AP.gsmh;AQ.gemh[AL.bb+AL.bc-1]=AP.gemh;}this.zone.cp=AQ;},ongridDataChange:function a(){var AH=this.model;if(AH){AH.set("data",this.gridData);if(!this.dataBlocks){this.dataBlocks=[];}this.dataBlocks[0]=this.gridData;}},gridPagesRendered:function c(){if(this._super){this._super();}},getTitleCP:function G(AH){return this.initCP(AH,this.interactiveCellsArray,M);},getColumnHeadersCP:function AA(AH){return this.initCP(AH,this.interactiveCellsArray,AB,AH.ghs&&AH.ghs.chs,AH.gts&&AH.gts.col,Y);},getRowHeadersCP:function AC(AH){var AI=this.initCP(AH,this.interactiveCellsArray,I,AH.ghs&&AH.ghs.rhs,AH.gts&&AH.gts.row,Q);if(this.onDemandIF&&this.rw){if(!this._onDemandCP){J.call(this,this.rw&&this.rw.row);}this.rhsCPList=[AI].concat(this._onDemandCP.rhs);return AF(this.rhsCPList)||AI;}return AI;},getValuesCP:function b(AI){var AH=this.initCP(AI,this.interactiveCellsArray,h,AI.gvs,AI.gts&&AI.gts.col);if(this.onDemandIF&&this.rw){if(!this._onDemandCP){J.call(this,this.rw&&this.rw.row);}this.valuesCPList=[AH].concat(this._onDemandCP.vls);return AF(this.valuesCPList)||AH;}return AH;},createOnDemandCP:function g(AI,AJ,AH){var AK=new mstrmojo.XtabOnDemandCP();AK.dataSource=this;AK.blockNum=AI;AK.rc=AJ;return AK;},dataDownloaded:function U(AI,AO){var AQ=AO.blockNum,AH=this.rhsCPList[AQ],AJ=this.valuesCPList[AQ],AP=AI.data,AM=this.gridData;AP._bidx=AQ;this.dataBlocks[AQ]=AP;if(!AH||!AJ){return ;}this.initCP(AP,this.interactiveCellsArray,I,AP.ghs&&AP.ghs.rhs,AP.gts&&AP.gts.row,Q,AH);this.initCP(AP,this.interactiveCellsArray,h,AP.gvs,AM.gts&&AM.gts.col,null,AJ);AH.initContent();AJ.initContent();this.numRowsDownloaded+=parseInt(AH.rc,10);this.updateStatus(mstrmojo.desc(8301,"Retrieving Data ..."),this.numRowsDownloaded*100/this.numRowsToDownload);var AL=this.zone;if(AL){var AN=AL.cp;if(AN){var AR=AP.gmh&&AP.gmh.gmrh,AK=AP.rw&&AP.rw.row;if(AR&&AK){AN.gsmh[AK.bb]=AR.gsmh;AN.gemh[AK.bb+AK.bc-1]=AR.gemh;}}AL.dataDownloaded();}},showDownloadStatus:function P(AH){if(!AH){return ;}if(this.showingStatus){this.numRowsToDownload+=AH;}else{this.numRowsToDownload=AH;this.numRowsDownloaded=0;}if(this.showStatus){this.showStatus(true,mstrmojo.desc(8301,"Retrieving Data ..."),this.numRowsDownloaded*100/this.numRowsToDownload);}},closeDownloadStatus:function k(){this.numRowsToDownload=0;if(this.showStatus){this.showStatus(false);}},download:function L(AK,AH,AO){var AN=this.gridData.rw,AJ=AN.row,AL=AN.col,AM=AJ.rm,AI=AJ.bc;this.rhsCPList[AK].isDownloading=this.valuesCPList[AK].isDownloading=true;if(AI){this.controller.onDownloadGridData(this,this.model.getDownloadAction(AK*AI+1,AI,AL.bb,AL.bc,this.id,AM,{blockNum:AK},AH),AO);}},unrender:function E(AH){this.width=this.widthLimit=this.height=this.heightLimit=0;this.disconnectScrollbox(this);this._super(AH);},getCellForNode:function x(AI){var AH=AI&&parseInt(AI.getAttribute("ei"),10);if(isNaN(AH)){return null;}return this.interactiveCellsArray[parseInt(AH,10)];},getActionCells:function O(AH){var AI=[],AK=this.selections;var AL=AH.axis+"A"+(AH.ui+1),AM=AK[AL],AJ;if(AM&&AM[AH.o]){for(AJ in AM){var AN=this.getCellForNode(AM[AJ][0]);AI.push(AN);}}else{AI.push(AH);}return AI;},setModel:function AD(AH){this.model=AH;if(AH.data){this.set("gridData",AH.data);}},delegateGridAction:function A(AH,AI){if(this._shouldResponseToAction(AI)){AH(this.zone);}},_shouldResponseToAction:function v(AH){return AH!=="refreshOnDataDownloaded";},getTargetZone:function p(){return this.zone;},destroy:function w(){var AH=this.model;if(this.controller&&this.controller.addScrollPosition){this.controller.addScrollPosition(this.gridData.datasetId+"."+this.gridData.k,this.scrollboxLeft,this.scrollboxTop);}if(AH&&AH.destroy){AH.destroy();}this._super();}});mstrmojo.XtabBase.EnumLockedHeaders={OFF:Z,ROW:C,COL:z,BOTH:N};}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.fx","mstrmojo.TreeNode");var K=mstrmojo.dom,E={0:"closed",1:"opened",2:"leaf"},I=function(R,Q){var N=R.style,M,P,L,S,O;N.display="block";N.height="auto";M=R.offsetHeight;P=Q?M:0;L=Q?0:M;S=Q?"block":"none";N.overflow="hidden";O=new mstrmojo.fx.AnimateProp({target:R,props:{height:{start:L,stop:P,suffix:"px",fn:Math.round,ease:mstrmojo.ease.linear}},onEnd:function(){N.height="auto";N.display=S;},interval:30,duration:300});O.play();};mstrmojo.TreeBrowserNode=mstrmojo.declare(mstrmojo.TreeNode,null,{scriptClass:"mstrmojo.TreeBrowserNode",markupString:'<div id="{@id}" class="mstrmojo-TreeNode {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,click,dblclick><div class="mstrmojo-TreeNode-div"><img class="mstrmojo-TreeNode-state" src="../images/1ptrans.gif" /><img class="mstrmojo-TreeNode-checkBox" src="../images/1ptrans.gif" /><span class="mstrmojo-TreeNode-text {@textCssClass}"></span></div><div class="mstrmojo-TreeNode-itemsContainer">{@itemsHtml}</div></div>',markupSlots:mstrmojo.hash.copy({displayNode:function(){return this.domNode.firstChild;},checkBoxNode:function(){return this.domNode.firstChild.childNodes[1];}},mstrmojo.TreeNode.prototype.markupSlots),markupMethods:mstrmojo.hash.copy({onstateChange:function(L){this.stateNode.className="mstrmojo-TreeNode-state "+(E[this.state]||"closed");if(this.tree.anim&&this.contentRetrieved&&!L){I(this.itemsContainerNode,this.state===1);}else{this.itemsContainerNode.style.display=(this.state===1)?"block":"none";}}},mstrmojo.TreeNode.prototype.markupMethods),blockBegin:1,allowUnlistedValues:false,contentRetrieved:false,_set_items:function(N,M){var L=this._super(N,M);if(L&&this.tree.anim){I(this.itemsContainerNode,true);}return L;},onstateChange:function J(){var L=this.tree;if(!this.contentRetrieved&&(this.state==1)){this.set("items",[L.loadingItemCreaterFunc()]);L.getContent(this,this.blockBegin);}else{if((this.state==1)&&L.onNodeExpand){L.onNodeExpand(this);}if((this.state==0)&&L.onNodeCollapse){L.onNodeCollapse(this);}}},toggleState:function G(){if(this.state!==2){this.set("state",this.state===1?0:1);}},preclick:function H(L){K.clearBrowserHighlights(L.hWin);return false;},predblclick:function D(L){K.clearBrowserHighlights(L.hWin);return false;},premousedown:function B(M){var R=mstrmojo.dom,O=mstrmojo.dom.eventTarget(M.hWin,M.e),L=this.tree,N=(this.state==2),Q=R.contains(this.itemsContainerNode,R.eventTarget(M.hWin,M.e),true,this.domNode),P=(L.branchClickPolicy==mstrmojo.TreeBrowserEnum.BRANCH_POLICY_TOGGLE);if((this.isSpecialNode()||!(O==this.checkBoxNode||((O==this.textNode||O==this.displayNode)&&(N||!P))))&&!this.draggable){R.stopPropogation(M.hWin,M.e);}if((O==this.stateNode)||((O==this.textNode||O==this.displayNode)&&!N&&P)){if(!N){this.toggleState();}}else{if(O==this.checkBoxNode||Q){if(this._super){this._super(M);}}else{this.handleNodeClicked();}}},isSpecialNode:function C(){var L=this.data&&this.data.st;return(L<0);},handleNodeClicked:function F(){var L=this.tree,M=this.parent,N=this.data;switch(N&&N.st){case"-4":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin-L.blockCount);break;case"-3":mstrmojo.css.addClass(this.textNode,["loading"]);L.getContent(M,M.blockBegin+L.blockCount);break;case"-1":case"-2":break;default:if(L.handleNodeClicked){L.handleNodeClicked(N);}}},init:function(L){this._super(L);this.set("state",this.tree.isBranch(this.data)?0:2);},postBuildRendering:function A(){if(this._super){this._super();}var L=function(M){K.preventDefault(window,M||window.event);return false;};K.attachEvent(this.domNode,"mousedown",L);if(this.isSpecialNode()||this.tree.noCheckBox){this.checkBoxNode.style.display="none";}}});})();(function(){mstrmojo.requiresCls("mstrmojo.TreeNode","mstrmojo._IsExprNode","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo.expr","mstrmojo._HasOwnAvatar");var F=mstrmojo.array,M=mstrmojo.expr,P=mstrmojo.dom,A=mstrmojo.css;function J(R,Q){var U=R.data,S=U&&U.nds;if(!S){return null;}if(Q){Q.sort(F.numSorter);}else{Q=R.sortSelectedIndices();}if(!Q.length){return null;}return{idxs:Q,nds:F.get(S,Q)};}function N(S){var R=S.ctxtBuilder,V=R&&R.itemWidgets,Q=V&&V[0],U=Q&&Q.data;if(U&&U.not&&(V.length>0)){delete U.not;Q.paint();}}mstrmojo.AndOrNode=mstrmojo.declare(mstrmojo.TreeNode,[mstrmojo._IsExprNode,mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.AndOrNode",data:null,editable:false,prefixedAndOrEditable:false,markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},prefixAndOrToolsNode:function(){return this.domNode.firstChild.childNodes[1];},itemsContainerPrefix:function(){return this.domNode.childNodes[1];},itemsContainerNode:function(){return this.domNode.childNodes[2].firstChild;},dropCueNode:function(){return this.domNode.childNodes[2].lastChild;},itemsContainerSuffix:function(){return this.domNode.lastChild;},scrollboxNode:function(){return this.domNode;}},markupMethods:{onitemCntChange:function(){A.toggleClass(this.itemsContainerNode,["multi"],this.itemCnt>2);},onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();},ondropCuePosChange:mstrmojo.TreeNode.prototype.markupMethods.ondropCuePosChange},multiSelect:true,itemIdField:null,init:function(Q){this._super(Q);this.markupString=this.markupString.replace("{@_prefixAndOrToolsMarkup}",this.getPrefixAndOrToolsMarkup());var R=this.data;if(R){delete this.data;this._set_data(null,R);}},itemCnt:0,postBuildRendering:function(){var Q;this.set("itemCnt",this.items.length);if(this._super){Q=this._super();}N(this);return Q;},preadd:function L(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},preremove:function O(Q){if(this._super){this._super(Q);}this.set("itemCnt",this.items.length);N(this);},_set_data:function(U,Q){var R=this.data,S=(R!==Q);if(S){this.data=Q;if(Q&&!Q.nds){Q.nds=[];}this.set("items",Q&&Q.nds);}return S;},isDragValid:function K(){return true;},isSelectableArea:function(Q){return false;},getDragData:function(Q){var S=this._super(Q);if(S&&!S.html){var R=S.et&&M.ET2TGT[S.et];S.html=R?S[R]&&S[R].n||"":S.n||"";}return S;},remove:function I(R,S){var Q=this._super(R);if(Q>-1){var U=S||this.suppressConsolidation;if(!U){this.consolidate(false);}}return Q;},move:function(R,Q){this.suppressConsolidation=true;var S;if(this._super){S=this._super(R,Q);}this.suppressConsolidation=false;return S;},consolidate:function E(){var V=this.parent;if(!V||!V.remove){return ;}var S=this.items,R=S&&S.length;if(R<2){var U=R?S[0]:null,Q=this.childIndex();if(U){V.add([U],Q);}V.remove(this.data);}},indent:function G(S,Q){var R=J(this,S);if(!R){return ;}this.remove(R.idxs,true);var X=R.nds,W=Q&&Q.fn||this.data&&this.data.fn,V={et:M.ET.ANDOR,nds:X,fn:W};if(X.length===2&&X[0].not){if(X[1].not){delete X[0].not;delete X[1].not;V.not=true;V.fn=(W===M.FN.AND?M.FN.OR:M.FN.AND);}else{var U=X[0];X[0]=X[1];X[1]=U;}}this.add([V],R.idxs[0]);this.consolidate(false);},outdent:function C(R){var S=this.parent,Q=S&&S.data;if(!Q||Q.et!==M.ET.ANDOR){return ;}var U=J(this,R);if(!U){return ;}this.remove(U.idxs,true);if(this.data.not){U.nds[0].not=true;}S.add(U.nds,this.childIndex());this.consolidate(false);},edit:function D(a,b,S){if(!a){return ;}var Z=this.data,Y=Z&&Z.fn,R=a.data,g=R&&R.not;if(!R){R={};a.data=R;}R.not=!!S;if(Y!==b){var Q=Z.nds;if(Q&&Q.length>2){var f=a.childIndex();if(f>0){this.indent([f-1,f],{fn:b});}}else{Z.fn=b;var W=this.ctxtBuilder,V=W&&W.itemWidgets;for(var U=0,X=(V&&V.length)||0;U<X;U++){var e=V[U];if(e){e.paint();}}}}else{a.paint();}},preclick:function H(Q){var S=null,R=P.eventTarget(Q.hWin,Q.e);if(R===this.prefixNode){}else{if(P.contains(this.prefixNode,R,true)){S="andor";}}Q.part=S;},createAvatar:function B(S){var R=document.createElement("div"),U=P.findWidget(S),Q=U.getAvatarNode&&U.getAvatarNode();if(!Q){Q=U.condNode.cloneNode(true);Q.style.boxSizing="border-box";Q.style.width=U.condNode.offsetWidth+"px";}R.appendChild(Q);A.addClass(R,U.avatarCssCls||"mstrmojo-FE mstrmojo-ConditionNode");R.style.zIndex=20;return R;},_ndsToMove:J});})();(function(){mstrmojo.requiresCls("mstrmojo.WidgetList","mstrmojo.WidgetTreeBuilder","mstrmojo.TreeNodeSelector");var E=false;mstrmojo.WidgetTree=mstrmojo.declare(mstrmojo.WidgetList,null,{scriptClass:"mstrmojo.WidgetTree",listBuilder:mstrmojo.WidgetTreeBuilder,listSelector:mstrmojo.TreeNodeSelector,renderOnScroll:true,itemIdField:"dssid",itemDisplayField:"n",itemIconField:"tp",itemChildrenField:"items",itemFunction:function D(L,I,J){if(!E){mstrmojo.requiresCls("mstrmojo.TreeNode");E=true;}var H=J.tree||J,K=new mstrmojo.TreeNode({data:L,state:0,parent:J,tree:H,multiSelect:J.multiSelect,text:L[J.itemDisplayField],textCssClass:H.item2textCss(L),items:L[J.itemChildrenField],itemIdField:J.itemIdField,itemDisplayField:J.itemDisplayField,itemIconField:J.itemIconField,itemChildrenField:J.itemChildrenField,itemFunction:J.itemFunction,listSelector:J.listSelector});return K;},item2textCss:function B(H){return H[this.itemIconField];},selectionParentNode:null,init:function F(H){this._super(H);this.selectionParentNode=this;this.tree=this;},clearTreeSelect:function A(){(this.selectionParentNode||this).clearSelect();},prechange:function G(H){var I=this._super(H);this.onnodechange(H);return I;},onnodechange:function C(I){if(!I){return ;}var J=mstrmojo.hash,M=this.selectionParentNode,L=I.src;if(L===M){if(J.isEmpty(L.selectedIndices)){L=this;this.selectionParentNode=this;}this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:I.removed});}else{if(I.added&&I.added.length){var K=[];if(!J.isEmpty(M.selectedIndices)){K=mstrmojo.hash.keyarray(M.selectedIndices,true);M.clearSelect();}this.selectionParentNode=L;this.raiseEvent({name:"selectionChange",parentNode:L,parentNodeWas:M,added:I.added,removed:K});}else{}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.HTMLButton","mstrmojo._HasContextMenu","mstrmojo.ContextMenu");mstrmojo.MenuButton=mstrmojo.declare(mstrmojo.Button,[mstrmojo._HasContextMenu],{preclick:function A(B){this.showContextMenu();},openPopupMenu:function(){this.showContextMenu();}});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.HierarchyCheckList","mstrmojo.ui._HierarchyListSelection","mstrmojo.EnumSelectionType","mstrmojo.hash","mstrmojo.array","mstrmojo.css");var L=mstrmojo.hash,S=mstrmojo.css,H=mstrmojo.array,A=mstrmojo.EnumSelectionType;var R="dynamic",K="hasSelectedDsct";var W=7;function G(a,X,Z){var b=[],Y={};H.forEach(a,function(d){var c=d.v;if(c>=Z){b.push(d);if(X.isLevelSelected(c)){Y[b.length-1]=true;}}});return{items:b,selectedIndices:Y};}mstrmojo.vi.ui.HierarchyCheckList=mstrmojo.declare(mstrmojo.ui.HierarchyCheckList,[mstrmojo.ui._HierarchyListSelection],{scriptClass:"mstrmojo.vi.ui.HierarchyCheckList",getItemMarkup:function D(Y,X){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><div class="right"><span class="refresh" title="{@refreshTitle}"></span><span class="branch" title="{@branchTitle}"></span><span class="level" title="{@levelTitle}"></span></div><div class="content"><span class="indent" style="padding-left: {@indent}px;"></span><span class="triangle"></span><span class="checkbox"></span><span class="text">{@en@n}</span></div></{@tag}>';},getItemProps:function U(Z,X){var Y=this._super(Z,X);if(Z.isBranchSelected){Y.addCls(R);}if(Z.hasDsctSelected){Y.addCls(K);}L.copy({refreshTitle:mstrmojo.desc(15251,"Dynamic"),branchTitle:Z.isSelected?mstrmojo.desc(15921,"Single Deselect"):mstrmojo.desc(15920,"Single Select"),levelTitle:mstrmojo.desc(15919,"Level Select"),},Y);return Y;},onclick:function V(X){var Z=X.getTarget(),a=this.getItemNodeFromTarget(Z),Y=this.getItemFromTarget(Z);if(Y){if(S.hasClass(Z,"triangle")){if(Y.hcd){this.doExpandCollapse(a,Y);}}else{if(S.hasClass(Z,"branch")){this.doElementSelect(a,Y,!Y.isSelected);}else{if(S.hasClass(Z,"level")){this.openLevelPopup(a,Y,Z);}else{if(!S.hasClass(Z,"indent")&&!S.hasClass(Z,"refresh")){this.doBranchSelect(a,Y,!Y.isSelected);}}}}X.cancel();}},onSelectionChange:function I(Y,X,Z,a){if(Y===A.ALL&&X){this.clearSelections();(this.raad?this.getInitialDisplayRoots():this.getRootItems()).forEach(function(b){if(b.v){this.selectionList.push({func:A.BRANCH,itemValue:b.v,isNot:false});}},this);if(this.postSelectionChange){this.postSelectionChange();}}else{this._super(Y,X,Z,a);}},updateItemNodesStatus:function M(){var X=this.itemsContainerNode&&this.itemsContainerNode.childNodes;this._super();H.forEach(X,function(a){var Z=this.getItemFromTarget(a),Y=a.getElementsByClassName("branch")[0];if(Z){S.toggleClass(a,R,Z.isBranchSelected);S.toggleClass(a,K,Z.hasDsctSelected);if(Y){Y.title=Z.isSelected?mstrmojo.desc(15921,"Single Deselect"):mstrmojo.desc(15920,"Single Select");}}},this);},getSummaryText:function J(){return"";},getLevels:function E(){return[];},getLevelItems:function B(Y){var a=this.getLevels(),b=Y?[{v:-1,n:mstrmojo.desc(15824,"All Levels")}]:[];if(a.length>0){return b.concat(a);}var X=this.getMaxLevel();for(var Z=0;Z<=X;Z++){b.push({v:Z,n:mstrmojo.desc(493,"Level")+" "+(Z+1)});}return b;},postBuildRendering:function Q(){var Z=this.levelPopup,Y=this.domNode;if(!Z){var X=this.getLevelPopupConfig(),a=L.walk(X.scriptClass,window);delete X.scriptClass;Z=this.levelPopup=new a(X);this.addDisposable(Z);}Z.placeholder=Y.insertBefore(document.createElement("div"),Y.firstChild);Z.render();return this._super();},unrender:function P(X){var Y=this.levelPopup;if(Y){Y.unrender(X);}return this._super(X);},onScrollEnd:function C(){var Y=this.levelPopup,X=Y&&Y.getPopupWidget();if(X&&X.visible){Y.closePopup();}this.hideTooltip();},openLevelPopup:function O(b,Z,Y){var a=this.levelPopup,X=a.getPopupWidget();if(a&&Z.hcd&&this.isHiearachyDisplay()){a.openPopup(X,{branch:Z,branchNode:b});if(Y){X.domNode.style.left=Y.offsetLeft+"px";X.domNode.style.top=Y.offsetTop+Y.offsetHeight-this.scrollNode.scrollTop+"px";}}},getLevelPopupConfig:function N(Z){return L.copy(Z,{scriptClass:"mstrmojo.ui.PopupButton",markupString:'<div id="{@id}" class="level-popup-btn" title="{@title}" mstrAttach:click></div>',title:mstrmojo.desc(15919,"Level Select"),isHostedWithin:false,parent:this,widget:this,children:{scriptClass:"mstrmojo.ui.PopupWidget",alias:"levelPopup",visible:false,children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"checklist",doItemSelect:function b(j,g){var f=this.parent,k=f.opener.widget,h=!this.selectedIndices[j._renderIdx];if(f.branch&&f.branchNode){k.doBranchLevelSelect(f.branchNode,f.branch,j.v,h);}else{k.doLevelSelect(j.v,h);}mstrmojo._IsList.doItemSelect.call(this,j,g);},onclick:function Y(f){if(!S.hasClass(f.getTarget(),"refresh")){mstrmojo._IsList.onclick.call(this,f);}},getItemMarkup:function d(f){return mstrmojo.ui.CheckList.prototype.getItemMarkup.call(this,f).replace('<span class="text">{@en@n}</span>','<span class="refresh"></span><span class="text">{@en@n}</span>');}}],onOpen:function X(){var h=this.opener.widget,f=this.branch,g=G(h.getLevelItems(),h.getLevelSelection(f),f&&f.lv+1||0);this.checklist.set("items",g.items);this.checklist.set("selectedIndices",g.selectedIndices);}},getPopupWidget:function c(){return this.levelPopup;},onPopupWidgetOpened:function a(){S.addClass(this.levelPopup.branchNode,"level-popup-open");},onPopupWidgetClosed:function e(){S.removeClass(this.levelPopup.branchNode,"level-popup-open");}});},getAllButtonConfig:function F(Y,X){return L.copy(X,Y?{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(3474,"Select All"),alias:"selectAllBtn",cssClass:"selectAll",widget:this,onclick:function(){this.widget.doAllSelect(true);}}:{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1763,"Clear All"),alias:"clearAllBtn",cssClass:"clearAll",widget:this,onclick:function(){this.widget.doAllSelect(false);}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.express.ui.SubtotalsWidget");mstrmojo.vi.ui.SubtotalsWidget=mstrmojo.declare(mstrmojo.express.ui.SubtotalsWidget,null,{scriptClass:"mstrmojo.vi.ui.SubtotalsWidget"});}());(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz");mstrmojo.RadioList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.RadioList",inputType:"radio",cssClass:"mstrmojo-RadioList",itemCssClass:"mstrmojo-RadioList-item",onenabledChange:function A(B){for(var C=0;C<this.items.length;C++){this._getItemNode(C).firstChild.disabled=!B.value;}}});mstrmojo.RadioListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.RadioListHoriz",inputType:"radio",cssClass:"mstrmojo-RadioListHoriz",itemCssClass:"mstrmojo-RadioListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo._InputList","mstrmojo._InputListHoriz","mstrmojo.hash");mstrmojo.CheckList=mstrmojo.declare(mstrmojo._InputList,null,{scriptClass:"mstrmojo.CheckList",inputType:"checkbox",cssClass:"mstrmojo-CheckList",itemCssClass:"mstrmojo-CheckList-item"});mstrmojo.requiresCls("mstrmojo._InputListHoriz");mstrmojo.CheckListHoriz=mstrmojo.declare(mstrmojo._InputListHoriz,null,{scriptClass:"mstrmojo.CheckListHoriz",inputType:"checkbox",cssClass:"mstrmojo-CheckListHoriz",itemCssClass:"mstrmojo-CheckListHoriz-item"});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.PreviewButton","mstrmojo.ui.PopupList","mstrmojo.array","mstrmojo.css");var F=mstrmojo.css,E=mstrmojo.array;mstrmojo.ui.editors.controls.ListPreviewButton=mstrmojo.declare(mstrmojo.ui.editors.controls.PreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ListPreviewButton",init:function G(L){this._super(L);var M=this.getListCfg(),K=this.itemValueField;M.alias="list";M.locksHover=true;M.slot="widgetHostNode";M.listHooks={select:function J(N,O){this.parent.set("selectedValue",O[K]);this.close();}};M.setDimensions=mstrmojo.emptyFn;this.addChildren([M]);F.addWidgetCssClass(this.list,"ctrl-popup-list");},getPopupWidget:function D(){return this.list;},items:null,onitemsChange:function H(){var J=this.items;if(J){this.list.set("items",J);}},selectedValue:"",itemValueField:"n",onselectedValueChange:function C(){var K=this.selectedValue,J=this.itemValueField,L=this.list;L.selectItems(E.filter(L.items||[],function(M){return M[J]===K;}),true);this.updatePreview();},updatePreview:function B(){throw new Error(this.scriptClass+" must implement updatePreview.");},getListCfg:function I(){return{scriptClass:"mstrmojo.ui.PopupList",selectionPolicy:"reselect"};},postBuildRendering:function A(){this.onitemsChange();this.onselectedValueChange();return this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo._HasTooltip","mstrmojo.ui._IsPulldown","mstrmojo.ui.PopupList","mstrmojo.hash","mstrmojo.dom","mstrmojo.string","mstrmojo.css","mstrmojo.array","mstrmojo._CanAutoClose");var U=mstrmojo.css,L=mstrmojo.array,F=mstrmojo.dom,B=mstrmojo.string;function H(W){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",content:B.encodeHtmlString(W)});}mstrmojo.ui.Pulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.ui.Pulldown",onitemSelected:mstrmojo.emptyFn,onSelectedItemChange:mstrmojo.emptyFn,useRichTooltip:true,allowHTML:false,useDarkTheme:false,init:function P(W){this._super(W);U.addWidgetCssClass(this.getPopupList(),"ctrl-popup-list");},initChildren:function C(){this.children=this.getPopupListConfig();this._super();},postBuildRendering:function Q(){if(this._super){this._super();}var W=this.getSelectedItem();if(W){H.call(this,W.n);}},showTooltip:function D(a,Z){var X=this.selectedNode,Y=this.richTooltip;if(X.offsetWidth>=X.scrollWidth){return ;}if(!Y.top){var W=F.position(this.selectedNode);Y.top=W.y-3;Y.left=W.x+W.w+6;}if(this._super){this._super(a,Z);}},getSelectedItem:function M(){var W=this.items;return W&&W[this.selectedIndex];},selectItemByField:function A(X,W){this.set("selectedIndex",L.find(this.items||[],X,W));},getPopupWidget:function E(){return this.list;},getPopupList:function J(){return this.list;},_set_items:function I(Z,W){var Y=this.items;this.items=W;delete this.selectedIndex;if(Y!==W){var X=this.hasRendered;if(X){this.refresh();}return true;}return false;},onclick:function V(W){this._super(W);var Y=this,X=Y.getPopupWidget();Y.mw=Y.mw||function(Z){if(!F.contains(X.domNode,F.eventTarget(self,Z),true,document.body)){X.close();F.detachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Y.mw);}};F.attachEvent(document,F.isFF?"DOMMouseScroll":"mousewheel",Y.mw);if(Y.focusOnPopup){X.domNode.focus();}},_set_selectedIndex:function N(d,a,Y){if((a!==0&&!a)||a<0){return false;}var X=this.selectedIndex=a,W=this.getPopupList(),Z=W&&W.items,c=Z&&Z[X],b=this.selectedNode;if(c&&c.dsbld){return false;}if(W){mstrmojo._ListSelections._set_selectedIndex.call(W,"selectedIndex",X,Y);}if(b&&Z&&Z[X]){b.innerHTML=this.getPulldownTextInnerHTML(Z[X]);b.title=Z[X].title||"";}if(Z&&Z[X]){if(this.focusOnPopup&&W&&!W.closeAfterSelection){W.itemsContainerNode.children[X].style.color="";}else{this.onitemSelected(Z[X],X);}}return true;},getPulldownTextInnerHTML:function G(W){return this.allowHTML?W.n:B.encodeHtmlString(W.n,true);},postselectedIndexChange:function O(W){var a=W.value,Y=W.valueWas;if(a!==Y){var X=this.items,Z=X[a];if(Z){H.call(this,Z.n);}this.onSelectedItemChange(Z,X[Y]);}},getPopupConfig:function K(){var W=this._super();W.useDarkTheme=this.useDarkTheme;return W;},getPopupListConfig:function S(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,useRichTooltip:true,showTooltipForLargeText:true,scrollNodeMaxHeight:this.scrollNodeMaxHeight,listHooks:{select:function W(a,b,Z){this.parent.set("selectedIndex",Z);if(this.visible&&this.closeAfterSelection&&!this.selectedItem.dsbld){this.close();}}},getItemProps:function X(b,Z){var a=mstrmojo._IsList.getItemProps.call(this,b,Z);a.style=this.parent.itemCssText||"";return a;},suppressClose:function Y(Z){return mstrmojo._CanAutoClose.suppressClose.call(this,Z)||F.contains(this.parent.domNode,Z,true,document.body);}};},children:[]});mstrmojo.ui.Pulldown.newPulldown=function R(X,b,W,a,Z){a=a||{};a.items=X;var Y;if(Z===true){Y=mstrmojo.hash.copy({scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:W||0},a);}else{Y=new mstrmojo.ui.Pulldown(a);if(W!==undefined){Y.set("selectedIndex",W);}}Y.onSelectedItemChange=b||mstrmojo.emptyFn;return Y;};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.Menu","mstrmojo.hash","mstrmojo.array");mstrmojo.ui.menus.MenuItemType=null;var B=mstrmojo.array,X="separator";mstrmojo.ui.menus.MenuConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,null,{scriptClass:"mstrmojo.ui.menus.MenuConfig",menus:null,menuCssClass:"",supportsScroll:false,maxHeight:0,hasToggleItem:false,hasMenuItems:function S(){var Y=B.filter(this.menus||[],function(Z){return Z.cls!==X;});return !!Y.length;},getMenuItems:function F(Y){var a=B.filter(this.menus.slice().reverse(),function(e,d,c){var b=c[d+1];return Y||e.cls!==X||(d&&b&&b.cls!==X);}).reverse();var Z=(a&&a.length)||0;if(!Y&&Z>0&&a[Z-1].cls===X){a.pop();}return a;},getMenuItem:function D(b){var a=this.menus,Y;if(a!==null){for(Y=0;Y<a.length;Y++){var Z=a[Y];if(Z.cls===b){return Z;}}}return null;},absorbMenuItems:function V(Y){this.menus=this.menus.concat(Y.menus);if(!this.hasToggleItem&&Y.hasToggleItem){this.hasToggleItem=true;}},addMenuItem:function K(f,b,d,Z,c){var e,a,Y;if(!f||typeof f==="string"){e=f;}else{e=f.n;a=f.ttp;}Y={n:e,ttp:a,cls:b,fn:d,ctxt:Z};if(isNaN(c)||c>=this.menus.length){this.menus.push(Y);}else{this.menus.splice(c,0,Y);}if(b.indexOf(/\bon\b/)>-1){this.hasToggleItem=true;}return Y;},addCustomMenuItem:function W(d,a,c,Z,Y){var b=this.addMenuItem(d,a,c,Y);b.getItemMarkup=Z;return b;},addDisabledMenuItem:function Q(Z,Y){this.addNonInteractiveMenuItem(Z,Y,true);},addNonInteractiveMenuItem:function O(c,Z,Y){var a=["non-int"];if(Z){a.push(Z);}if(Y){a.push("disabled");}if(c&&typeof c!=="string"&&c.ttp){this.useTooltip=true;}var b=this.addMenuItem(c,a.join(" "),mstrmojo.emptyFn);b.dsbld=true;},addSeparator:function E(){this.addMenuItem("",X,function(){return false;});},addPopupMenuItem:function U(f,a,e,b,Z,c){var d=["pop "];if(b){d.push(b);}var Y=this.addMenuItem(f,d.join(" "),e,Z,c);Y.pop=true;Y.scope=a;return Y;},addActionPopupMenuItem:function N(f,Z,d,e,a,Y,c){var b=this.addPopupMenuItem(f,Z,e,(a||"")+" ax",Y,c);b.actionFn=d;b.ax=true;},addSubMenuItem:function M(c,a,Z,b,Y){this.addPopupMenuItem(c,Z,b,a,Y);},addEditorMenuItem:function R(c,Z,b,Y,a){this.addPopupMenuItem(c,Z,b,"",Y,a);},getToggleItemStates:function G(g,j,Y,e,a,d){var b,c,Z,f;if(typeof g==="string"){b=c=g;Z=f="";}else{b=g.on||"";c=g.off||"";Z=g.ttpOn||"";f=g.ttpOff||"";}var h=[{n:b,ttp:Z,cls:j+" on",fn:e,ctxt:d},{n:c,ttp:f,cls:j,fn:Y,ctxt:d}];if(!a){h.reverse();}return h;},addToggleMenuItem:function L(f,b,d,a,Z,e,Y){var c=this.getToggleItemStates(f,b,d,a,e,Y);this.hasToggleItem=true;return this.addDualStateItem(Z,c[0],c[1]);},addDualStateItem:function I(Z,Y,a){return this.addMenuItem({n:Y.n,ttp:Y.ttp},Y.cls,this.getDualStateHandler(Z,Y,a),Y.ctxt);},getDualStateHandler:function J(Z,Y,a){return function(c,d){var b=[Y,a];if(c.cls===Y.cls){b.reverse();}b[1].fn.call(mstrmojo.all[Z],c,d);c.n=b[0].n;c.ttp=b[0].ttp;c.cls=b[0].cls;};},addRadioMenuGroup:function C(a,f,b,Z,Y,e,d){var c=[];this.hasToggleItem=true;b.forEach(function(k,g){if(k.separator){this.addSeparator();return ;}var m=k.text,l=(Z||"")+" "+(k.cls||"")+(e?"":" radio")+(k.value===a?" on":""),j=function(){if(f.call(this.ctxt,k.value,a,k)===false){return false;}a=k.value;c.forEach(function(n){n.cls=n.cls.replace(/ on$/,"")+(n.radioValue===a?" on":"");});return true;},h=d?this.addCustomMenuItem(m,l,j,d(k,g),Y):this.addMenuItem(m,l,j,Y);h.radioValue=k.value;c.push(h);},this);},clear:function P(){this._super();this.menus=[];},newInstance:function A(Y){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this},Y));},addMenuTitle:function H(Y){this.addMenuItem(Y||"","menu-item-title",mstrmojo.emptyFn);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo.ui.menus.Menu","mstrmojo._IsList","mstrmojo.vi.ui._HasMask","mstrmojo.dom","mstrmojo.hash","mstrmojo.string","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui._HasListTooltip");var F=mstrmojo.dom;mstrmojo.vi.ui.toolbars.Toolbar=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._HasMask,mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",tooltipOrientation:"vertical",init:function G(I){this._super(I);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIToolbar");},selectionPolicy:"reselect",toolbarCfg:null,toolbarClicked:mstrmojo.emptyFn,tooltipCss:null,_set_toolbarCfg:function(L,I){var J=this.toolbarCfg,K=(J!==I);if(K){if(J){J.destroy();}this.toolbarCfg=I;}return K;},getItemProps:function D(K,I){var J=this._super(K,I);J.addCls(K.cls);J.addStyle("display:inline-block");return J;},postBuildRendering:function C(){var I=document.createElement("div");I.className="mstrmojo-VIDND-mask";this.maskNode=this.domNode.appendChild(I);return this._super();},postselectionChange:function(I){var J=I.added;if(J){var K=this.items[J[0]];if(K.tp==="pb"&&K.isMenuClicked){K.menufn(K,this);}else{K.fn(K,this);}}},ontoolbarCfgChange:function H(I){var K=I.valueWas;if(K){K.destroy();}var J=I.value;if(!J){return ;}this.set("items",J.btns);if(this.hasRendered){this.raiseEvent({name:"renderComplete"});}},openMenu:function E(J,I){J.hostId=this.id;J.hostElement=this._getItemNode(I._renderIdx);this.openPopup(J.newInstance());},onclick:function A(I){var K=I.target||F.eventTarget(I.hWin,I.e),J=this.getItemFromTarget(K);if(J&&J.tp==="pb"){if(K&&K.className){J.isMenuClicked=K.className.indexOf("icn")===-1;}}this.toolbarClicked(I);this._super(I);},destroy:function B(J){var I=this.toolbarCfg;if(I){I.destroy();}delete this.items;this._super(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.Box","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.ui.IconTooltipCheckList","mstrmojo.ui.LabelWithIconTooltip","mstrmojo.ValidationTextBox","mstrmojo.hash","mstrmojo.func","mstrmojo.desc","mstrmojo.css","mstrmojo.form","mstrmojo.date","mstrmojo.dom","mstrmojo.alert","mstrmojo.NumberFormat");mstrmojo.requiresDescs(6,7,295,3437,15153,15156,2879,2140,5212,5592,5374,1345,34,5875,29,32,6213,15581,15582,5876,35,15583,2696,18,15631,15632,15633,15634,2033,4604,2058,8378,15836,15837,15838,15839,15840,15841,15842,15843,15846,15847,15849,15948,15956);var H=mstrmojo.desc,P=mstrmojo.hash,R=mstrmojo.Button.newWebButton,X=mstrmojo.css,J={GENERAL:0,SECURITY:1,LAYOUT:2},A={ALL_CHAPTERS:0,CURRENT_CHAPTER:1,CURRENT_PAGE:2},O={FULL_PAGE:1,VISUALIZATIONS:2,BOTH:3},Q={DISABLE:0,ENABLE:1};var Y={range:A.CURRENT_CHAPTER,overviewViz:O.FULL_PAGE,paperHeight:"8.5",paperWidth:"11",pageOrientation:-1,mode:0,enableFooter:Q.ENABLE,enableHeader:Q.ENABLE,pdfPwd:"",selectedTabIndex:J.GENERAL,hideTabIndex:undefined};function F(){return true;}function U(){var c={},a=this.general,b=this.layout;c.range=a.exportChapters.chapterContent.getSelectedItem().v;c.overviewViz=this.singleVis?O.VISUALIZATIONS:a.exportIndiVis.checkbox.checked?O.BOTH:O.FULL_PAGE;c.pageOrientation=a.pageOrientation.oriCheckList.selectedItem.v;c.paperHeight=b.exportPages.paperSize.sizeOptions.getSelectedItem().eph;c.paperWidth=b.exportPages.paperSize.sizeOptions.getSelectedItem().epw;c.pageOrientation=b.pageOrientation.oriCheckList.selectedItem.v;c.mode=0;c.enableHeader=b.pdfHeader.checkbox.checked?Q.ENABLE:Q.DISABLE;c.enableFooter=b.pdfFooter.checkbox.checked?Q.ENABLE:Q.DISABLE;c.pdfPwd="";return c;}function B(c){var a=this.general,b=this.layout;this.exOpts=c;a.exportChapters.chapterContent.set("selectedIndex",W(M,c.range));a.exportIndiVis.checkbox.set("checked",c.overviewViz===O.BOTH);a.pageOrientation.oriCheckList.set("selectedIndex",W(N,c.pageOrientation));b.exportPages.paperSize.sizeOptions.set("selectedIndex",W(I,L(c.paperWidth,c.paperHeight)));b.pageOrientation.oriCheckList.set("selectedIndex",W(N,c.pageOrientation));b.pdfHeader.set("checked",c.enableHeader===Q.ENABLE);b.pdfFooter.set("checked",c.enableFooter===Q.ENABLE);}var M=[{n:H(2058,"All"),v:A.ALL_CHAPTERS},{n:H(15846,"Current Chapter"),v:A.CURRENT_CHAPTER}];var I=[{n:H(1345,'A3 11.69" x 16.54"'),eph:"11.69",epw:"16.54"},{n:H(34,'A4 8.27" x 11.69"'),eph:"8.27",epw:"11.69"},{n:H(5875,'A5 5.83" x 8.27"'),eph:"5.83",epw:"8.27"},{n:H(29,'Letter 8.5" x 11"'),eph:"8.5",epw:"11"},{n:H(32,'Legal 8.5" x 14"'),eph:"8.5",epw:"14"},{n:H(6213,'Ledger 11" x 17"'),eph:"11",epw:"17"},{n:H(15581,'B4 13.9" x 9.8"'),eph:"13.9",epw:"9.8"},{n:H(15582,'B5 9.8" x 6.9"'),eph:"9.8",epw:"6.9"},{n:H(5876,'Executive 7.25" x 10.5"'),eph:"7.25",epw:"10.5"},{n:H(35,'Folio 8.5" x 13"'),eph:"8.5",epw:"13"},{n:H(15583,'Statement 5.5" x 8.5"'),eph:"5.5",epw:"8.5"}];var N=[{n:H(4604,"Auto"),tx:true,css:"pdfAuto",v:-1},{n:H(6,"Portrait"),css:"pdfPortrait",v:0},{n:H(7,"Landscape"),css:"pdfLandscape",v:1}];function L(b,a){if(parseFloat(b)<parseFloat(a)){return{eph:b,epw:a};}return{eph:a,epw:b};}function W(b,c){var a=0;if(typeof c==="object"){var d=P.keyarray(c);P.forEach(b,function(f,e){if(P.equals(P.copyProps(d,f),c)){a=e;return false;}});}else{P.forEach(b,function(f,e){if(f.v===c){a=e;return false;}});}return parseInt(a);}function E(a){return{scriptClass:"mstrmojo.Box",alias:"pageOrientation",cssClass:"page-orientation",bindings:{visible:"this.parent.parent.basic||this.parent.parent.tabBar.tabs.selectedIndex===2"},children:[{scriptClass:"mstrmojo.Label",text:H(2879,"Orientation")},{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:true,alias:"oriCheckList",selectedIndex:W(N,a.exOpts.pageOrientation),items:N,postselectionChange:function(b){a.exOpts.pageOrientation=this.selectedItem.v;a.raiseEvent({name:"updateOrientation"});}}]};}function D(c,a){var b=this;return[{scriptClass:"mstrmojo.Box",alias:"tabBar",cssClass:"tabBar",children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,alias:"tabs",selectedIndex:J.GENERAL,postselectionChange:function(d){var h=this.parent.parent,e=h.tabBar.tabs.selectedItem.v,g=[h.general,h.security,h.layout];for(var f=0;f<g.length;f++){g[f].set("visible",f+1==e);}},items:[{n:H(295,"General"),v:J.GENERAL+1},{n:H(2696,"Security"),v:J.SECURITY+1},{n:H(3437,"Layout"),v:J.LAYOUT+1}]}]},{scriptClass:"mstrmojo.Box",alias:"general",cssClass:"general",children:[{scriptClass:"mstrmojo.Box",alias:"exportChapters",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Label",text:H(5374,"Content")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chapterContent",selectedIndex:W(M,c.range),items:M}]},{scriptClass:"mstrmojo.Box",alias:"exportIndiVis",cssClass:"mstrmojo-CheckBoxes-Box",bindings:{visible:"!this.parent.parent.basic"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.overviewViz===O.BOTH?true:false,label:"",oncheckedChange:function(){c.overviewViz=this.checked?O.BOTH:O.FULL_PAGE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:H(15849,"Export Individual Visualizations"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:H(15836,"Visualizations will be exported individually on separate pages.")}]},this.orientationSettings,]},{scriptClass:"mstrmojo.Box",alias:"security",cssClass:"security",visible:false},{scriptClass:"mstrmojo.Box",alias:"layout",cssClass:"layout",visible:false,children:[{scriptClass:"mstrmojo.Box",alias:"exportPages",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Box",alias:"paperSize",children:[{scriptClass:"mstrmojo.Label",text:H(15156,"Paper Size")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"sizeOptions",selectedIndex:W(I,L(c.paperWidth,c.paperHeight)),items:I}]}]},this.orientationSettings,{scriptClass:"mstrmojo.Label",cssClass:"wrap",text:H(15839,"Header and Footer")},{scriptClass:"mstrmojo.Box",alias:"pdfHeader",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.enableHeader===Q.ENABLE?true:false,label:"",oncheckedChange:function(){c.enableHeader=this.checked?Q.ENABLE:Q.DISABLE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:H(2033,"Header"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:H(15956,"Display the dossier, chapter, and page name on every page.")}]},{scriptClass:"mstrmojo.Label",text:""},{scriptClass:"mstrmojo.Box",alias:"pdfFooter",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:c.enableFooter===Q.ENABLE?true:false,label:H(15948,"Page Numbers"),oncheckedChange:function(){c.enableFooter=this.checked?Q.ENABLE:Q.DISABLE;}}]}]},{scriptClass:"mstrmojo.Box",alias:"buttonNode",slot:"buttonNode",children:[R(H(2140,"Cancel"),function(){this.parent.parent.close();}),R(b.exportDisplayText,function(){var d=this.parent.parent;if(!F.call(d)){return ;}var e=U.call(d);d.exOpts=e;d.exportHandler(e);d.close();},true),R(H(8378,"Advanced Settings"),function(){a=!a;this.parent.parent.set("basic",a);this.parent.parent.toggleMode();this.set("text",a?H(8378,"Advanced Settings"):H(15840,"Basic Settings"));},false,{cssClass:"togglerBtn"+(this.singleVis?" hidden":"")})]}];}function V(b){var a=P.copy(Y);if(typeof b==="object"){if(b.hasOwnProperty("range")){a.range=parseInt(b.range);}if(b.hasOwnProperty("overviewViz")){a.overviewViz=parseInt(b.overviewViz);}if(b.hasOwnProperty("paperHeight")){a.paperHeight=b.paperHeight.toString();}if(b.hasOwnProperty("paperWidth")){a.paperWidth=b.paperWidth.toString();}if(b.hasOwnProperty("pageOrientation")){a.pageOrientation=parseInt(b.pageOrientation);}if(b.hasOwnProperty("mode")){a.mode=parseInt(b.mode);}if(b.hasOwnProperty("enableFooter")){a.enableFooter=parseInt(b.enableFooter);}if(b.hasOwnProperty("enableHeader")){a.enableHeader=parseInt(b.enableHeader);}if(b.hasOwnProperty("pdfPwd")){a.pdfPwd=b.pdfPwd.toString();}if(b.hasOwnProperty("selectedTabIndex")){a.selectedTabIndex=parseInt(b.selectedTabIndex);}a.hideTabIndex=b.hideTabIndex;}return a;}mstrmojo.vi.ui.editors.ExportPDFEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ExportPDFEditor",cssClass:"mstrmojo-ExportPDFEditor",title:H(5212,"Export to PDF"),help:"intro_export_dossier.htm",exportHandler:mstrmojo.emptyFn,exportDisplayText:H(5592,"Export"),basic:true,singleVis:false,exOpts:Y,orientationSettings:undefined,useCache:false,zIndex:12,init:function S(a){this._super(a);this.basic=!this.singleVis;this.exOpts=V.call(this,a.exOpts);this.orientationSettings=E(this,this);this.set("children",D.call(this,this.exOpts,this.basic));this.attachEventListener("updateOrientation",this.id,function(){var b=W(N,this.exOpts.pageOrientation);this.general.pageOrientation.oriCheckList.set("selectedIndex",b);this.layout.pageOrientation.oriCheckList.set("selectedIndex",b);});},updatePopupConfig:function K(a,b){B.call(this,this.exOpts);},onOpen:function G(){var b=this.exOpts,a=this.tabBar.tabs.itemsContainerNode.childNodes;if(b.hideTabIndex!==undefined&&0<=b.hideTabIndex&&b.hideTabIndex<a.length){X.addClass(a[b.hideTabIndex],"hidden");}this.toggleMode();this.positionDialog();},onClose:function C(){if(!this.useCache){this.destroy();}},toggleMode:function Z(){var e=this.tabBar.tabs.itemsContainerNode.childNodes,d=this.basic;X.toggleClass(this.editorNode,"advanced",!d);X.toggleClass(e[J.LAYOUT],"hidden",d);var a=mstrApp&&mstrApp.featureFlagsCache&&mstrApp.featureFlagsCache["EE/PDFEncrypt"];X.toggleClass(e[J.SECURITY],"hidden",d||!a);var b=e.length;for(var c=0;c<e.length;c++){if(e[c].className.match(/\bhidden\b/)){b--;}}this.tabBar.set("visible",b>1);this.tabBar.tabs.set("selectedIndex",this.exOpts.selectedTabIndex);if(!this.singleVis){this.set("title",d?H(15841,"Export to PDF - Basic"):H(15842,"Export to PDF - Advanced"));}}});mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings={hideTabIndex:J.GENERAL,selectedTabIndex:J.LAYOUT,overviewViz:O.VISUALIZATIONS,enableFooter:Q.DISABLE};}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.hash");var A=mstrmojo.hash;mstrmojo.ui.editors.controls.ValidationTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,null,{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",errRevert:true,dtp:null,validationDelay:3000,orignText:null,trigger:mstrmojo.validation.TRIGGER.ONKEYUP,init:function(B){B=B||{};B.constraints=B.constraints||{};B.constraints.trigger=this.trigger;this._super(B);},prekeyup:function(B){if(B.e.keyCode===13){this.blur();return ;}this._super(B);},onfocus:function(){this.orignText=this.value;},onblur:function(){if(this.value!=this.orignText){this.validate();}},validate:function(){this._super();this.orignText=this.value;this.clearValDelayTimer();},preinput:mstrmojo.emptyFn,postinput:function(){var B=this.doValidation(this.value);if(B.code<=mstrmojo.validation.STATUSCODE.VALID){this.clearValidation();if(!this.errRevert){this.hideTooltip();}}},updateTooltipConfig:function(){this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:mstrmojo.desc(13819,"Invalid input")};},onInvalid:function(){if(!this.errRevert){this.hideTooltip();this.showTooltip();}else{this.clearValidation();this.set("value",this.orignText);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ValidationTextBox","mstrmojo.hash","mstrmojo.css","mstrmojo.num","mstrmojo.validation");var M=mstrmojo.hash,Q=mstrmojo.num,U=mstrmojo.css;var H=10,G=205,V=30,F=75;function E(a){var Z=a<0;a=Math.abs(a);["B","M","K"].every(function(d){var b={B:1000000000,M:1000000,K:1000}[d],c=a>=b;if(c){a=Math.round(a/b)+d;}return !c;});if(a<1){a=a.toPrecision(3);}if(Z){a="-"+a;}return String(a);}function L(){var c=this.minLabel,b=this.maxAutoLabel,d=this.min,Z=this.minCheck,a=5;if(d.domNode&&b){d.domNode.style.marginLeft=c.domNode.offsetWidth+a+"px";b.domNode.style.width=d.domNode.offsetWidth-Z.domNode.offsetWidth+"px";}if(this.auto===undefined){this.autoNode.style.height="0px";}}function C(g,j){var k=this[g+"Node"],d=this[j+"Node"],c=parseInt(k.style.left.replace("px",""),10)-F,q=parseInt(d.style.right.replace("px",""),10),n=this[g+"NodeLabel"],h=this[j+"NodeLabel"];if(c===0&&q===0){n.style.left=0;h.style.right=0;return ;}var p=mstrmojo.dom.position(n).w,Z=mstrmojo.dom.position(h).w,b=G-c-q,l=0,e=0;if(c>0){l=c<p/2?c:p/2;}if(q>0){e=q<Z/2?q:Z/2;}var a=b+l+e-p-Z,o=H-a;if(o>0){if(l===c){e=e+o;}else{if(e===q){l=l+o;}else{var m=o*p/(p+Z),f=o-m;if(l+m>c){e=e+o-(c-l);l=c;}else{if(e+f>q){l=l+o-(q-e);e=q;}else{l=l+m;e=e+f;}}}}}n.style.left=-Math.round(l)+"px";h.style.right=-Math.round(e)+"px";}function W(){var d=this.getRange(),k=this.getAuto();if(!d){return ;}if(!this.enabled){d=M.copyProps(["min","max"],d);}if(k){["Min","Max"].forEach(function(p){var n="auto"+p,o=p.toLowerCase()+"Check",m=k[n];this[o].set("checked",m);},this);}["Min","Max"].forEach(function(p){var n="custom"+p,o=p.toLowerCase(),m=d[n];if(!d.hasOwnProperty(n)){d[n]=d[o];}this[o].setValue(isNaN(m)||!this.enabled?"":Q.toLocaleString(m));},this);var l=M.keyarray(d).map(function(m){var n=m.indexOf("x")>-1;return{key:m,val:Number(d[m]),positionProp:n?"right":"left",positionValue:0};}).sort(function(n,m){return n.val-m.val;}),b=false,f=false,a=l[0].val,c=l[3].val,g=c-a,e=G,j,h;if(l[1].val===a){if(l[2].val!==c){j=h=l[2];}}else{j=l[1];h=(l[2].val!==c)?l[2]:l[1];}function Z(m,o){var r=(m==="left")?a:c,q=Math.abs(o.val-r),p=Math.round(q/g*e),n=p<V;p=n?V:p;o.unscaled=n;o.positionValue=(m===o.positionProp)?p:G-p;if(n){e-=V;g-=q;}return n;}if(j){b=Z("left",j);}if(h&&!h.unscaled){f=Z("right",h);if(h.unscaled&&!j.unscaled){b=Z("left",j);}}U.toggleClass(this.bgNode,"unscaleleft",b);U.toggleClass(this.bgNode,"unscaleright",f);l.forEach(function(n){var o=this[n.key+"Node"],q=this[n.key+"NodeLabel"],m=n.positionProp,p=(m==="left")?F:0;o.style[m]=n.positionValue+p+"px";q.innerHTML=this.getConvertValue(n.val);},this);C.call(this,"customMin","customMax");C.call(this,"min","max");L.call(this);}function N(){var c=this,b=this.getRange(),a=M.copy(b),Z=this;a.customMin=Q.parseNumeric(Z.min.value);a.customMax=Q.parseNumeric(Z.max.value);this.set("range",a);window.setTimeout(function(){c.rangeChanged(a,b);},75);}function P(){var a=this,c=this.getAuto(),b=M.copy(c),Z=this;b.autoMin=Z.minCheck.checked;b.autoMax=Z.maxCheck.checked;this.set("auto",b);window.setTimeout(function(){a.autoChanged();},75);}function A(a,c){var f="ctrlNodeLeft",d=mstrmojo.desc(5416,"Min"),b="min",e="max";if(a){f="ctrlNodeRight";d=mstrmojo.desc(5417,"Max");b="max";e="min";}var Z={scriptClass:"mstrmojo.ValidationTextBox",slot:f,hint:d,alias:b,valueChangeDelay:1000,dtp:5,required:true,useRichTooltip:true,constraints:{trigger:mstrmojo.validation.TRIGGER.NONE,min:null,max:null},setValue:function(h){var g=this._sync;this._sync=true;if(h===""&&this.hasRendered){this.clearValidation();}this.set("value",h);this._sync=g;},onvalueChange:function(){if(!this._sync){var h=this.parent,g=this.parent[e];g.resetConstraints(true);if(g.isValid()){this.updateConstraints();}else{this.resetConstraints(false);}this.validate();h.set("inputValid",g.isValid()&&this.isValid());if(h.inputValid){N.call(h);}}},resetConstraints:function(g){M.copyProps(["min","max"],this.parent.rangeConstraints[this.alias],this.constraints);if(g){this.validate();}},updateConstraints:function(){this.resetConstraints(false);var h=this.parent.rangeConstraints[this.alias][e],g=Q.parseNumeric(this.parent[e].value);if(!h){this.constraints[e]=g;}else{if(e==="min"){this.constraints[e]=h>g?h:g;}else{this.constraints[e]=h<g?h:g;}}},updateTooltipConfig:function(){if(!this.enabled){this.richTooltip=null;return ;}var k=this.validationStatus,h=(b==="min"?mstrmojo.desc(12119,"Custom minimum value"):mstrmojo.desc(12120,"Custom maximum value")),j=this.isValid()?h:this.getInvalidMsg(k),g=(this.isValid()?"vi-regular":"vi-warning")+" vi-tooltip-V";this.richTooltip={content:j,posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:g,left:0,top:this.domNode.offsetHeight-30,refNode:this.domNode};}};M.copy(c,Z);return Z;}function S(Z,a){return{scriptClass:"mstrmojo.Label",text:Z?mstrmojo.desc(13731,"Max:"):mstrmojo.desc(13732,"Min:"),cssDisplay:"inline-block",alias:Z?"maxLabel":"minLabel",slot:a+(Z?"NodeRight":"NodeLeft")};}function B(Z){return{scriptClass:"mstrmojo.ui.Checkbox",cssDisplay:"inline-block",alias:Z?"maxCheck":"minCheck",slot:Z?"autoNodeRight":"autoNodeLeft",oncheckedChange:function a(){var c=this.alias==="maxCheck",d=this.parent,f=d,b=c?d.max:d.min,e=this.checked;b.set("enabled",!e);if(f.auto){P.call(f);}}};}function Y(Z){return{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12143,"Automatic"),cssClass:"autoLabel",cssDisplay:"inline-block",alias:Z?"maxAutoLabel":"minAutoLabel",slot:Z?"autoNodeRight":"autoNodeLeft"};}mstrmojo.ui.editors.controls.CustomRange=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.CustomRange",range:null,rangeConstraints:{min:{min:null,max:null},max:{min:null,max:null}},inputValid:true,labelOfDataRange:mstrmojo.desc(13733,"Data Range"),labelOfCustomRange:"",markupString:'<div id="{@id}" class="mstrmojo-ui-CustomRange {@cssClass}"><div class="autoNode"><div class="autoNodeLeft"></div><div class="autoNodeRight"></div></div><div class="ctrlNode"><div class="ctrlNodeLeft"></div><div class="ctrlNodeRight"></div></div><div class="displayNode"><div class="bg"><div class="tip left"></div><div class="dot left"></div><div class="tip right"></div><div class="dot right"></div><div class="girder"></div></div><div class="custom min"><div class="tick-label"></div></div><div class="custom max"><div class="tick-label"></div></div><div class="actual min"><div class="tick-label"></div></div><div class="actual max"><div class="tick-label"></div></div><div class="lbl-cust-range" title="{@labelOfCustomRange}">{@labelOfCustomRange}</div><div class="lbl-data-range" title="{@labelOfDataRange}">{@labelOfDataRange}</div></div></div>',markupSlots:{autoNode:function(){return this.domNode.firstChild;},autoNodeLeft:function(){return this.domNode.firstChild.firstChild;},autoNodeRight:function(){return this.domNode.firstChild.lastChild;},ctrlNode:function(){return this.domNode.children[1];},ctrlNodeLeft:function(){return this.domNode.children[1].firstChild;},ctrlNodeRight:function(){return this.domNode.children[1].lastChild;},displayNode:function(){return this.domNode.lastChild;},bgNode:function(){return this.domNode.lastChild.firstChild;},customMinNode:function(){return this.domNode.lastChild.childNodes[1];},customMaxNode:function(){return this.domNode.lastChild.childNodes[2];},minNode:function(){return this.domNode.lastChild.childNodes[3];},maxNode:function(){return this.domNode.lastChild.childNodes[4];},customMinNodeLabel:function(){return this.domNode.lastChild.childNodes[1].firstChild;},customMaxNodeLabel:function(){return this.domNode.lastChild.childNodes[2].firstChild;},minNodeLabel:function(){return this.domNode.lastChild.childNodes[3].firstChild;},maxNodeLabel:function(){return this.domNode.lastChild.childNodes[4].firstChild;}},layoutConfig:{w:{ctrlNode:"100%",displayNode:"100%"},xt:true},init:function O(c){this._super(c);this.range={min:0,max:100000};M.copy(c,this);var Z=c.auto,a=Z?"auto":"ctrl",b=Z?[S(false,a),B(false),Y(false),this.getTextBoxCfg(false),S(true,a),B(true),Y(true),this.getTextBoxCfg(true)]:[S(false,a),this.getTextBoxCfg(false),S(true,a),this.getTextBoxCfg(true)];this.addChildren(b);},getTextBoxCfg:function J(Z,a){return A(Z,a);},getConvertValue:function D(Z){return E(Z);},afterLayout:function K(){this.min.resetConstraints();this.max.resetConstraints();W.call(this);},getRange:function X(){return M.copy(this.range);},getAuto:function R(){return M.copy(this.auto);},rangeChanged:function I(Z,a){},onrangeChange:function(){W.call(this);},updateDisplay:W});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ui.editors.controls.CustomRange,{onenabledChange:function(){this.propagateChildProps("enabled");U.toggleClass(this.displayNode,"disabled",!this.enabled);W.call(this);this.set("inputValid",true);}});mstrmojo.ui.editors.controls.CustomRange.RangeType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.MetricSelectorUtility","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.array","mstrmojo._FormatDefinition.NumberFormatCategory","mstrmojo.hash");mstrmojo.requiresDescs(8153,8154,8155,8156,8157,8158,8159,8160,8161,8162,8163,8164,8165,8166,8167,8168,8169,8170,7839,587,2204,2202,2203,7576,7575,7622);var V=mstrmojo.dom,N=mstrmojo.hash,S=mstrmojo.MetricSelectorUtility,k=mstrmojo._FormatDefinition.NumberFormatCategory,J=mstrmojo.desc,W=mstrmojo.css,Y=mstrmojo.num,B=Math,c=B.max,H=B.min,e=B.floor,X=B.round,a=9;function M(AB,AA,x,w){var z="px",r=AB._length,p=AB.handleSize,o=AB.orCfg,AF=o.posCssP,s=o.lenCssP,t=false;x=c(x,-1);w=H(w+a,r);if(x>w){t=true;}var AC=H(x,w),AD=c(x,w),AE=AD-AC-(t?0:p+a),u=c(r-AD,0);if(AB.hasRendered){AA.handle1Node.style[AF]=x+z;AA.handle2Node.style[AF]=(w-a)+z;var n=AA.lowerRange.style,v=AA.thumbNode.style,q=AA.upperRange.style;n[AF]=0;v[AF]=(AC+(t?0:p))+z;q[AF]=(AD+p-a)+z;n[s]=c(AC,0)+z;v[s]=AE+z;q[s]=u+z;}else{z+=";";AF+=":";s+=":";AB.handle1CssText=AF+x+z;AB.handel2CssText=AF+(w-a)+z;AB.lowerRangeCssText=s+c(AC,0)+z;AB.thumbCssText=AF+(AC+p)+z+s+AE+z;AB.upperRangeCssText=AF+(AD+p-a)+z+s+u+z;}return{handle1:x,handle2:w};}function O(n){this.getUnit=function(){return n._length/c((n.items.length-1),1);};this.calcMinMax=function(q,p){var r=n.unit;return{min:e(q/r+0.5),max:e(p/r+0.5)};};this.calcPxIdx=function(p){return e(p/n.unit+0.5);};this.getStep=function(){var q=n.high-n.low,p=parseInt(n.numFmts.cat,10),r=(p===4)?2:(p===5)?4:0;q=(q===0)?1:q;if(q>1){return(q>(n._length-2))?Number(Number(q/(n._length-2)).toFixed(n.numFmts.dp+r)):1;}return q/(n._length-2);};this.getIdx=function(p){return H(c(X((p-n.low)/n.step),0),n.items.length-1);};this.initialMetricSlider=function o(){var t=function(AG){return AG!==undefined&&AG!==null;},r=function(AG){return(t(AG.da)&&t(AG.da.low)&&t(AG.da.high)&&t(AG.da.cnt)&&t(AG.f)&&t(AG.ft)&&t(AG.qua));},q=function(AG){var AK=true,AJ=true,AH=parseInt(AG.ft,10),AI=parseInt(AG.f,10);if(AH===S._GENERIC){AK=AI!==S.FN.ISNULL&&AI!==S.FN.ISNOTNULL&&AI!==S.FN.NOTIN&&AI!==S.FN.IN;}else{if(AH===S._PERCENT||AH===S._RANK){AJ=AI!==S.MRPFN.INASCENDING&&AI!==S.MRPFN.INDESCENDING&&AI!==S.MRPFN.NOTINDESCENDING&&AI!==S.MRPFN.NOTINASCENDING;}}return !AK||!AJ;},AD=0;n.include=n.parent.include;n.clsType="scm ";n.staticStatus=!(t(n.da)&&t(n.da.low)&&t(n.da.high)&&t(n.da.cnt)&&t(n.qua));if(n.staticStatus){n.da.low=1;n.da.high=7;n.ft=S._GENERIC;n.f=S.FN.BETWEEN;n.qua=S.Q._G;n.cs=[{n:"",v:1},{n:"",v:7}];n.numFmts={cat:9,dp:0,fm:""};}switch(n.qua){case 0:var AC=parseInt(n.numFmts.cat,10);AD=AC===4?2:AC===5?4:0;n.low=Number(Number(n.da.low).toFixed(n.numFmts.dp+AD));n.high=Number(Number(n.da.high).toFixed(n.numFmts.dp+AD));break;case 1:case 2:n.low=1;n.high=n.da.cnt;break;case 3:case 4:n.low=0;n.high=100;break;}var AF=!n.staticStatus&&!n.da.nov;n.set("lowText",AF?n.formatNumber(n.low):"");n.set("highText",AF?n.formatNumber(n.high):"");n.step=(n.qua===1||n.qua===2)?1:this.getStep();n.cs1Vl=n.low;n.cs2Vl=n.high;var s=n.low,z=n.high,AE=[],AB=0;if(t(s)&&t(z)){var v=s,x;for(x=0;v<=z;x++,v+=n.step){AE[x]={n:S.formatNumber(n.qua,v,n.numFmts),v:Number(Number(v).toFixed(n.numFmts.dp+AD))};}AB=AE.length;if(AB>0&&AE[AB-1].v!==z){AE[AB-1]={n:S.formatNumber(n.qua,z,n.numFmts),v:z};}}n.items=AE;var p=S.OP,AA=n.cs,w=(AA&&AA.length>0)?Y.parseNumeric(String(AA[0].v).replace("%","")):s,u=(AA&&AA.length>1)?Y.parseNumeric(String(AA[1].v).replace("%","")):z;if(w<n.low){n.frtUst=true;}if(u>n.high){n.ndUst=true;}n.opId=(n.f!==null&&n.ft!==null)?S.getOpIdxByfunc(n.f,n.ft):p._BETWEEN;switch(n.opId){case p._EQUALS:case p._NOT_EQUALS:n.cs1Vl=n.cs2Vl=w;break;case p._LESS_EQUAL:case p._GREATER:n.cs1Vl=s;n.cs2Vl=w;break;case p._GREATER_EQUAL:case p._LESS:n.cs1Vl=w;n.cs2Vl=z;break;case p._IN:case p._NOT_IN:case p._IS_NULL:case p._IS_NOT_NULL:break;default:n.cs1Vl=w;n.cs2Vl=u;break;}n.cs1Idx=this.getIdx(n.cs1Vl);n.cs2Idx=this.getIdx(n.cs2Vl);n.cs1Nm=t(n.cs1Vl)?S.formatNumber(n.qua,n.cs1Vl,n.numFmts):n.items[n.cs1Idx].n;n.cs2Nm=t(n.cs2Vl)?S.formatNumber(n.qua,n.cs2Vl,n.numFmts):n.items[n.cs2Idx].n;n.unit=this.getUnit();n.set("unSet",(!r(n)||q(n)||(!n.cs||n.cs.length===0))&&!n.staticStatus);};this.updateOpCs=function(){var s=(n.cs1Vl>n.cs2Vl)?n.cs2Vl:n.cs1Vl,x=(n.cs1Vl>n.cs2Vl)?n.cs1Vl:n.cs2Vl,r=n.low,u=n.high,w=n.include,p=S.OP,t=parseInt(n.qua,10),q=(t===S.Q._PT||t===S.Q._PB),z,v=[];if((s>=r&&x<=u)||s<r||x>u){n.opId=w?p._BETWEEN:p._NOT_BETWEEN;}if(s===x){n.opId=w?p._EQUALS:p._NOT_EQUALS;}if(s===r&&x<u){n.opId=w?p._LESS_EQUAL:p._GREATER;}if(s>r&&x===u){n.opId=w?p._GREATER_EQUAL:p._LESS;}z=r==s&&x==u;if(!z){switch(n.opId){case p._BETWEEN:case p._NOT_BETWEEN:v.push({dtp:5,v:Y.toLocaleString(s)+(q?"%":"")});case p._EQUALS:case p._NOT_EQUALS:v.push({dtp:5,v:Y.toLocaleString(x)+(q?"%":"")});break;default:if(s>r){v.push({dtp:5,v:Y.toLocaleString(s)+(q?"%":"")});}if(x<u){v.push({dtp:5,v:Y.toLocaleString(x)+(q?"%":"")});}}}n.cs=v;n.parent.node.data.cs=v;n.set("unSet",z);};this.updateThumb=function(){var p=n.cs1Idx,s=n.cs2Idx;if(p!==undefined&&s!==undefined){var q=n.unit,r=n.gap;N.copy(M(n,n,X(p*q-r),X(s*q-r)),n);}};this.joinConst=function(){var r=n.cs;if(r){var p=[],q;for(q in r){p.push(r[q].v);}return p.join(",");}};}var E="<span {@ttpCssText}>{@content}</span>";function D(){if(this.staticStatus){return null;}var q=this.ghost;if(!q){var t=this.containerNode.cloneNode(true),s=t.childNodes;W.addClass(t,["gh"]);q=this.ghost={containerNode:t,lowerRange:s[0],handle1Node:s[1],thumbNode:s[2],handle2Node:s[3],upperRange:s[4]};this.sdcNode.appendChild(t);}var o=this.orCfg,n=o.posCssP,p=o.lenCssP,r=this.id;mstrmojo.array.forEach(["lowerRange","containerNode","thumbNode","upperRange"],function(z,u){var x=mstrmojo.all[r],w=x[z].style,v=q[z].style;if(u){v[n]=w[n];}v[p]=w[p];});q.containerNode.style.display="block";return q;}mstrmojo.MetricSlider=mstrmojo.declare(mstrmojo.Slider,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.MetricSlider",markupString:'<div><div class="mstrmojo-Slider-summary"></div><div class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont" style=""><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}"><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1" style="{@handle1CssText}" mstrAttach:mouseover,mouseout,click></div><div class="t2 bk" style="{@thumbCssText}"></div><div class="t3" style="{@handel2CssText}" mstrAttach:mouseover,mouseout,click></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label" style="margin-top:9px;float:left;"></div><div class="mstrmojo-Label" style="margin-top:9px;float:right;"></div></div></div></div>',markupSlots:{summaryNode:function(){return this.domNode.childNodes[0];},sliderNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[1].childNodes[0];},sdcNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0];},containerNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0];},lowerRange:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[0];},handle1Node:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[1];},thumbNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[2];},handle2Node:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[3];},upperRange:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[4];},tooltipNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0];},lowNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[1];},highNode:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[2];},editValueNode:function(){return this.domNode;}},markupMethods:{onlowTextChange:function(){this.lowNode.innerHTML=this.lowText||"";},onhighTextChange:function(){this.highNode.innerHTML=this.highText||"";},onfontChange:function(){this.lowNode.style.font=this.highNode.style.font=String(this.font);}},init:function g(n){this._super(n);this.handleSize=mstrmojo.MetricSlider.METRICSLIDERTHUMBWIDTH;this.clsType="scm";this.typeHelper=new O(this);this.useRichTooltip=false;},typeHelper:null,unSet:false,preBuildRendering:function A(){var q=this.orCfg,p=this.isHoriz;q.cPosCssP=p?"right":"bottom";q.cLenCssP=p?"height":"width";var t=q.lenCssP,s=this[t],r=parseInt(s,10),o=this.handleSize;var n=this._length=(isNaN(r))?0:(r-o-a);if(n<=0){n=this._length=mstrmojo.MetricSlider.METRICSLIDERDEFAULTWIDTH-o;}if(s){this.bkCssText=t+":"+c(r-(2*this.cssBkBW),0)+"px;";this.sdcCssText=q.posCssP+":"+a+"px;"+t+":"+n+"px;"+q.opPosCssP+":0px;";}this.typeHelper.initialMetricSlider();this.typeHelper.updateThumb();},postBuildRendering:function R(){this._super();if(!this.staticStatus&&!this.da.nov){var o=this.lowNode,n=parseInt(o.style.fontSize,10);if(isNaN(n)){o.style.fontSize=8*this.parent.model.getZoomFactor()+"pt";}this.updateSummary();}this.lowNode.style.marginLeft=a+"px";this.highNode.style.marginRight=a+"px";this.sliderNode.style.height="0px";},onmouseover:function G(n){this.showTooltip(n.e,self);},onmouseout:function f(n){this.hideTooltip(n.e,self);},summaryLabels:{db:J(8153,"Between ## and ###"),dnb:J(8154,"Not between ## and ###"),din:J(587,"In"),dnin:J(2204,"Not in"),dnull:J(2202,"Is Null"),dnnull:J(2203,"Is not Null"),req:J(8155,"Rank ="),rneq:J(8156,"Rank <>").replace("<>",String.fromCharCode(8800)),rexb:J(8157,"Rank exclude bottom"),rext:J(8158,"Rank exclude top"),rb:J(8159,"Rank bottom"),rt:J(8160,"Rank top"),rbt:J(8161,"Rank between ## and ###"),rnbt:J(8162,"Rank not between ## and ###"),rin:J(8163,"Rank in"),rnin:J(8164,"Rank not in"),peq:J(8165,"Percent ="),pneq:J(8166,"Percent <>").replace("<>",String.fromCharCode(8800)),pexb:J(8167,"Exclude bottom"),pext:J(8168,"Exclude top"),pb:J(7576,"Bottom"),pt:J(7575,"Top"),pbt:J(8153,"Between ## and ###"),pnbt:J(8154,"Not between ## and ###"),pin:J(8169,"Percent in"),pnin:J(8170,"Percent not in")},formatNumber:function h(t){var p=this,z=Math.abs(t),x=p.numFmts.cat,o=1000,AA=["K","M","B","T","P","E","Z","Y"],u=AA.length,s;if(z>=o&&(x===k.Default||x===k.Fixed||x===k.General||x===k.Currency)){for(s=0;s<u;s++,o*=1000){if(z<o*1000){var n=z/o,r=(n*10).toFixed(0)%10>0?1:0,w=n.toFixed(r)+AA[s];return t<0?"("+w+")":w;}}}return S.formatNumber(p.qua,t,p.numFmts);},updateSummary:function L(){if(this.summaryNode&&!this.staticStatus){var AH=this.f,p=this.ft,AG=S,AB=S.FN,o=S.MRPFN,x="",AE=(this.cs1Vl<this.cs2Vl)?this.cs1Vl:this.cs2Vl,AC=(this.cs1Vl>this.cs2Vl)?this.cs1Vl:this.cs2Vl,v=this.formatNumber(AE),u=this.formatNumber(AC),t=this.typeHelper,w=this.summaryLabels,n=parseInt(p,10),q=parseInt(AH,10),AD=(n===AG._GENERIC&&(q===AB.ISNULL||q===AB.ISNOTNULL||q===AB.NOTIN||q===AB.IN))||((n===AG._PERCENT||n===AG._RANK)&&(q===o.INASCENDING||q===o.INDESCENDING||q===o.NOTINDESCENDING||q===o.NOTINASCENDING));if(this.unSet||AE<=this.low&&AC>=this.high&&this.include){x=mstrmojo.desc(2058,"All");}if(!this.unSet||AD){switch(p){case AG._GENERIC:switch(AH){case AB.EQUALS:x="= "+v;break;case AB.NOTEQUALS:x=String.fromCharCode(8800)+" "+v;break;case AB.GREATERTHAN:x="> "+u;break;case AB.GREATERTHANEQUALS:x=String.fromCharCode(8805)+" "+v;break;case AB.LESSTHAN:x="< "+v;break;case AB.LESSTHANEQUALS:x=String.fromCharCode(8804)+" "+u;break;case AB.BETWEEN:x=v+" - "+u;break;case AB.NOTBETWEEN:x=mstrmojo.desc(1099)+" "+v+" - "+u;break;case AB.ISNULL:x=w.dnull;break;case AB.ISNOTNULL:x=w.dnnull;break;case AB.IN:x=w.din+" "+t.joinConst();break;case AB.NOTIN:x=w.dnin+" "+t.joinConst();break;}break;case AG._PERCENT:case AG._RANK:var AF="r";if(parseInt(p,10)===AG._PERCENT){AF="p";}switch(AH){case o.EQUALSDESCENDING:case o.EQUALSASCENDING:x=w[AF+"eq"]+" "+v;break;case o.NOTEQUALSDESCENDING:case o.NOTEQUALSASCENDING:x=w[AF+"neq"]+" "+v;break;case o.GREATERTHANEQUALSASCENDING:x=w[AF+"exb"]+" "+v;break;case o.GREATERTHANASCENDING:x=w[AF+"exb"]+" "+u;break;case o.GREATERTHANEQUALSDESCENDING:x=w[AF+"ext"]+" "+v;break;case o.GREATERTHANDESCENDING:x=w[AF+"ext"]+" "+u;break;case o.LESSTHANASCENDING:x=w[AF+"b"]+" "+v;break;case o.LESSTHANEQUALSASCENDING:x=w[AF+"b"]+" "+u;break;case o.LESSTHANDESCENDING:x=w[AF+"t"]+" "+v;break;case o.LESSTHANEQUALSDESCENDING:x=w[AF+"t"]+" "+u;break;case o.BETWEENDESCENDING:case o.BETWEENASCENDING:x=w[AF+"bt"].replace("##",v).replace("###",u);break;case o.NOTBETWEENASCENDING:case o.NOTBETWEENDESCENDING:x=w[AF+"nbt"].replace("##",v).replace("###",u);break;case o.INASCENDING:case o.INDESCENDING:x=w[AF+"in"]+" "+t.joinConst();break;case o.NOTINDESCENDING:case o.NOTINASCENDING:x="";x=w[AF+"nin"]+" "+t.joinConst();break;}break;}}var z=this.summaryNode,AA=(x!=="")?"":0;z.innerHTML=x;z.style.margin=AA;}},getClientHeight:function U(){return this.dndNode.clientHeight+this.summaryNode.clientHeight+15;},initDrag:function l(r,n){if(!this.staticStatus&&!this.da.nov){n=n||window;var s=V.eventTarget(n,this.dnd.startE);if(s===this.handle1Node||s===this.handle2Node){var q=D.call(this),o=this.orCfg,p=this.dnd;p.initD={handle1:parseFloat(this.handle1,10),handle2:parseFloat(this.handle2,10)-a,length:this._length,contL:q.containerNode[o.lenP],offset:V.getMousePosition(this.dnd.startE,n)[o.offsetP]};p.initD.td=s;W.removeClass(this.domNode.childNodes[1],["invalid"]);}}},ondrag:function K(t,s){if(!this.staticStatus){s=s||window;var v=this.dnd.initD;if(v){var AC=this.ghost,AD=v.handle1,q=v.handle2,r=this.cs1Idx,p=this.cs2Idx,AA=this.unit,x=this.gap,o=v.length;var z=V.getMousePosition(t,s)[this.orCfg.offsetP]-v.offset;switch(v.td){case this.handle1Node:AD=c(H(c(v.handle1+z,0),o)-x,-1);r=c(e(AD/AA+0.5),0);break;case this.handle2Node:q=c(H(c(v.handle2+z,0),o)-x,-1);p=c(B.ceil(q/AA+0.5),0);break;default:return ;}M(this,AC,AD,q);var u=this.items,n=(u&&u.length)||0;if(n&&r>=0&&r<n&&p>=0&&p<n){var AB=false,w;if(r!==this.cs1Idx){this.cs1Idx=r;w=this.items[r];this.cs1Vl=w.v;this.cs1Nm=w.n;AB=true;}if(p!==this.cs2Idx){this.cs2Idx=p;w=this.items[p];this.cs2Vl=w.v;this.cs2Nm=w.n;AB=true;}if(AB){this.typeHelper.updateThumb();this._updateTooltip(v.td);}}}}},ondrop:function Z(o){if(!this.staticStatus&&!this.da.nov){this.typeHelper.updateThumb();var n=this.ghost;if(n){n.containerNode.style.display="none";}this.hideTooltip(o,self);var p=this.dnd&&this.dnd.initD;if(this.makeSelection&&p){this.makeSelection({selItem:p.td});}if(this.items&&this.items.length&&this.ghost){this[(V.eventTarget(self,o)===this.ghost.handle1Node)?"frtUst":"ndUst"]=false;this.selectRange();}this.dnd.initD=null;}},selectRange:function Q(){var n=this.typeHelper,p=this.cs1Vl,o=this.cs2Vl,s=this.qua,r=this.numFmts;this.cs1Idx=n.getIdx(p);this.cs2Idx=n.getIdx(o);this.cs1Nm=S.formatNumber(s,p,r);this.cs2Nm=S.formatNumber(s,o,r);n.updateOpCs();this.onselectionChange();this.updateSummary();},onincludeChange:function C(){if(!this.staticStatus){this.changeInclude=true;this.selectRange();}},showTooltip:function m(o,n){var p=V.eventTarget(n,o);this._updateTooltip(p);mstrmojo.tooltip.open(this,o,n);},_updateTooltip:function P(r){if(N.walk("handle1Node",this.ghost)===r||N.walk("handle2Node",this.ghost)===r){return ;}var o=this.orCfg,q=o.posCssP,n,p={contentNodeCssClass:"scm-tooltip",refNode:this.domNode.childNodes[1],posType:this._tooltip_pos};p[o.opPosCssP]=-parseInt(this.font,10)/2;p[q]=r.style[q];n=String((r===this.handle1Node)?this.cs1Nm:this.cs2Nm);p.content=E.replace(/\{@content\}/g,n);this.set("richTooltip",p);},onclick:function b(n){if(!this.staticStatus&&!this.da.nov){var o=V.eventTarget(n.hWin||window,n.e);this.hideTooltip(n.e,self);this.dnd.initD={makeMetricSilderSelectionByClick:true,td:((o===this.handle1Node)?this.handle1Node:((o===this.handle2Node)?this.handle2Node:null))};this.openEditValue({isfrt:(o===this.handle1Node),tgt:o});if(this._onThumb){this._onThumb(n);}}},onselectionChange:function I(n){this._super(n);if(this.dnd.initD&&this.dnd.initD.makeMetricSilderSelectionByClick){this.dnd.initD=null;}},onquaChange:function d(n){var p=S.getFuncInfo(this.opId,n.valueWas),q=S.getFuncInfo(this.opId,n.value),o;if(p.ft!==q.ft){if(!this.staticStatus){this.items=[];this.cs=[];this.f=this.ft=null;this.refresh();o=true;}}else{this.f=S.getFuncInfo(this.opId,n.value).f;o=false;}this.unSet=o||this.unSet;this.changeQual=true;this.selectRange();},updateData:function F(n,o){this.da=n;this.updateExpr(o);},updateExpr:function j(n){if(n){this.cs=n.cs;this.f=n.f;this.ft=n.ft;this.qua=n.qua;}this.refresh();},editValueRef:{cssClass:"edvl",slot:"editValueNode",scriptClass:"mstrmojo.Popup",locksHover:true,onOpen:function(){if(this.tgt){this.set("left",H(c(parseInt(this.tgt.style.left,10),0),parseInt(this.opener.width,10)-90)+"px");this.set("top",this.tgt.style.top);}var p=this.opener,o=this.children[0];if(p){var n=this.isfrt?p.cs1Vl:p.cs2Vl;o.edt.set("value",Y.toLocaleString(n));}},children:[{scriptClass:"mstrmojo.Table",rows:1,cols:2,layout:[{cells:[{cssText:"width: 40px; padding: 3px;"},{cssText:"width: 16px;padding: 3px;"}]}],children:[{slot:"0,0",scriptClass:"mstrmojo.ValidationTextBox",alias:"edt",cssText:"color:black",dtp:mstrmojo.expr.DTP.NUMERIC,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:function(){if(this.parent.apply){this.parent.apply.set("enabled",String(this.value).length!==0);}},onInvalid:function(){if(this.parent.apply){this.parent.apply.set("enabled",false);}},onkeyup:function(o){if(this.parent.apply.enabled){var n=o.hWin,p=o.e||n.event;if(p.keyCode===13){this.parent.apply.onclick();}}}},{slot:"0,1",scriptClass:"mstrmojo.Button",cssClass:"icn apply",alias:"apply",onclick:function(){var o=this.parent.parent,q=o.opener,n=this.parent.edt.value;if(o&&q&&String(n).length>0){q[o.isfrt?"cs1Nm":"cs2Nm"]=n;n=Y.parseNumeric(n);q[o.isfrt?"cs1Vl":"cs2Vl"]=n;}q[o.isfrt?"frtUst":"ndUst"]=true;q.selectRange();q.typeHelper.updateThumb();o.close();}}]}]},openEditValue:function(n){this.openPopup("editValueRef",n);}});mstrmojo.MetricSlider.METRICSLIDERTHUMBWIDTH=14;mstrmojo.MetricSlider.METRICSLIDERDEFAULTWIDTH=95;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.List","mstrmojo.Button","mstrmojo.color","mstrmojo.Model","mstrmojo.Table","mstrmojo._CanValidate","mstrmojo.ValidationTextBox");var L=mstrmojo.color,C=mstrmojo.hash;function H(W,R,N,O,V,M,Q,U){var S={target:R,onEnd:function(){if(M){M();}},props:{}};S.props[N]={ease:Q,start:parseInt(O,10),stop:parseInt(V,10),suffix:"px"};S=C.copy(U,S);var P=new mstrmojo.fx.AnimateProp(S);P.play();}var D=function(Q){if(Q===null){return ;}var P=mstrmojo.locales.color.userPalette,M=P.length;if(M===8){P.remove(M-1,1);}P.add([{n:Q,v:Q}],0);var N="",O;for(O=0;O<8;O++){if(P[O]&&P[O].v){N+=P[O].v+",";}}N=N.replace(/,$/,"");mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(R){},failure:function(R){mstrmojo.alert(R.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{taskId:"setPreference",prefs:"userPalette\u001E"+N});};var I=function(M,N,O){return{scriptClass:"mstrmojo.Label",text:M+":",cssClass:N,slot:O};};var K=function(M,P,O,N){return C.copy(N||{},{scriptClass:"mstrmojo.ValidationTextBox",cssDisplay:"block",cssText:"padding: "+(mstrmojo.dom.isIE7?"0":"1px"),bindings:{value:function(){return this.parent.parent.colorModel[O]||"0";}},onValid:function(){this.parent.parent.colorModel.set(O,this.value);},min:0,max:255,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,validator:function(R){var S=this.min,Q=this.max;R=parseInt(R,10);if(R>=S&&R<=Q){return{code:mstrmojo.validation.STATUSCODE.VALID};}return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:mstrmojo.desc(7883,"Please enter an integer between ## and ###").replace("##",S).replace("###",Q)};}},slot:P});};var G=function(M){return C.copy({scriptClass:"mstrmojo.Slider",alias:M+"Slider",cssClass:"sc "+M,isHoriz:true,width:130,cssBkBW:0,items:[],getItemTooltip:function(){return this.items[this.min].n;},postCreate:function(){var N;for(N=0;N<{r:256,g:256,b:256,s:101,v:101,h:360}[M];N++){this.items.push({n:N,v:N});}},bindings:{selectedIndex:function(){return this.parent.parent.colorModel[M]||"0";}},onselectedIndexChange:function(){this.parent.parent.colorModel.set(M,this.selectedIndex);if(this.domNode){this.min=this.max=this.selectedIndex;this.typeHelper.updateThumb();}},select:function(N){this.set("selectedIndex",N);},slot:"1,3"});};var A=function(N,M,O){return'<div mstridx="'+M+'" class="mstrmojo-ColorPicker-item '+O.itemCssClas+'" style="background-color:'+N.v+';" type="button" title="'+N.n+'"></div>';};var F=C.copy({findIndex:function(M,O,N){return N.getAttribute("mstridx")||-1;}},C.copy(mstrmojo.ListMapper));var B=function(M,N){return C.copy(N,{scriptClass:"mstrmojo.List",cssClass:"mstrmojo-ColorPicker-list",itemMarkupFunction:A,listMapper:F,onchange:null,_onchange:function(){this.set("selectedColor",this.selectedItem.v);M.set("selectedColor",this.selectedItem.v);if((M.isSimple||!M.expanded)&&M.onChange){M.onChange();}},onselectedColorChange:function(){M.colorModel.set("hex",this.selectedColor);}});};mstrmojo.ColorPicker=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ColorPicker",markupString:'<div id={@id} class="mstrmojo-ColorPicker {@cssClass} {@shadowCssClass}" style="height:{@height}; width:{@width};{@cssText}"><div class="mstrmojo-ColorPicker-box"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onexpandedChange:function(){this.domNode.className=this.domNode.className.replace(/ expanded/,"")+(this.expanded?" expanded":"");}},useAnimate:true,useShadow:true,isSimple:false,showNoColor:true,showMoreColors:true,showGradients:false,showUserPalette:true,height:"168px",fullHeight:"326px",width:"158px",fullWidth:"366x",expanded:false,onexpandedChange:function(N){var Q=this.domNode,M=parseInt(this.height,10),P=parseInt(this.width,10),O=parseInt(this.fullHeight,10),R=Math.max(parseInt(this.fullWidth,10),Q.scrollWidth);if(this.useAnimate!==false){if(N.value){H(true,Q,"width",P,R);H(true,Q,"height",M,O);}else{H(true,Q,"width",R,P);H(true,Q,"height",O,M);}}else{if(N.value){Q.style.width=R+"px";Q.style.height=O+"px";}else{Q.style.width=P+"px";Q.style.height=M+"px";}}},selectedColor:null,onChange:null,_updateSelection:function(N){var O=(this.isSimple)?this:this.layout.cp;if(N){var M=mstrmojo.array.find(O.basicColors.items,"v",N);if(M>-1){O.basicColors.set("selectedIndex",M);}else{M=mstrmojo.array.find(O.userPalette.items,"v",N);if(M>-1){O.userPalette.set("selectedIndex",M);}}}},visible:false,onvisibleChange:function(){if(this.visible){this.selectedColor=(this.selectedColor&&this.selectedColor.replace(/transparent/,"#FFFFFF"))||"#FFFFFF";this.colorModel.set("hex",this.selectedColor);this._updateSelection(this.selectedColor);}},onselectedColorChange:function(){this._updateSelection(this.selectedColor);},init:function(M){var N=this;this.colorModel=new mstrmojo.Model({h:0,s:0,v:100,_hsvChange:function(){this.hex="#"+L.hsv2hex(this.h,this.s,this.v);var O=L.hsv2rgb(this.h,this.s,this.v);this.r=O[0];this.g=O[1];this.b=O[2];N.set("colorModel",C.copy(this,{}));},_rgbChange:function(){this.hex="#"+L.rgb2hex(this.r,this.g,this.b);var O=L.rgb2hsv(this.r,this.g,this.b);this.h=O[0];this.s=O[1];this.v=O[2];N.set("colorModel",C.copy(this,{}));},onhChange:function(){this._hsvChange();},onsChange:function(){this._hsvChange();},onvChange:function(){this._hsvChange();},onrChange:function(){this._rgbChange();},ongChange:function(){this._rgbChange();},onbChange:function(){this._rgbChange();},onhexChange:function(){var P=L.hex2rgb(this.hex);this.r=P[0];this.g=P[1];this.b=P[2];var O=L.hex2hsv(this.hex);this.h=O[0];this.s=O[1];this.v=O[2];N.set("colorModel",C.copy(this,{}));}});this._super(M);},postBuildRendering:function(){if(this._super){this._super();}this.colorModel.set("hex",this.selectedColor||"#FFFFFF");this.colorModel.set("s",50);},preBuildRendering:function(){if(this._super){this._super();}var P=this.isSimple?100:124;if(this.showNoColor){P+=20;}if(this.showUserPalette){P+=25;}this.height=P+"px";if(this.isSimple){this.width="155px";}this.shadowCssClass=this.useShadow?"shadow":"";var Q=this,M={scriptClass:"mstrmojo.Button",cssClass:"nocolor",text:mstrmojo.desc(959,"Default"),visible:this.showNoColor,onclick:function(){Q.set("selectedColor","transparent");if(Q.onChange){Q.onChange();}}},O=B(this,{alias:"basicColors",items:mstrmojo.locales.color.colors,onchange:function(){if(this.selectedIndex>-1){this.parent.userPalette.set("selectedIndex",-1);this._onchange();}}}),R=B(this,{alias:"userPalette",cssClass:"mstrmojo-ColorPicker-list userPalette",makeObservable:true,visible:this.showUserPalette,bindings:{items:function(){return Q.showUserPalette!==false?mstrmojo.locales.color.userPalette:[];}},onchange:function(){if(Q.visible){if(this.selectedIndex>-1){this.parent.basicColors.set("selectedIndex",-1);this._onchange();}}},onadd:function(){this.refresh();if(Q.visible){this.parent.basicColors.set("selectedIndex",-1);this.set("selectedIndex",0);}}});if(this.isSimple){if(this.showNoColor){this.addChildren(M,0);}this.addChildren(O);this.addChildren(R);return ;}var N={scriptClass:"mstrmojo.Table",alias:"layout",rows:2,cols:5,layout:[{cells:[{colSpan:2},{colSpan:2},{}]},{cells:[{},{},{},{},{}]}],children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-ColorPicker-palette shadow",alias:"cp",children:[M,O,R],slot:"0,0"},{scriptClass:"mstrmojo.Container",cssClass:"sbSlider",markupString:'<div class="{@cssClass}" style="position:relative; {@cssText}" mstrAttach:click,mouseover,mousemove,mousedown,mouseup,mouseout><div class="sbThumb"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},thumbNode:function(){return this.domNode.firstChild;}},markupMethods:{onbgColorChange:function(){this.domNode.style.backgroundColor=this.bgColor;}},hex:null,bindings:{hex:"this.parent.parent.colorModel.hex",bgColor:function(){return"#"+L.hsv2hex(this.parent.parent.colorModel.h,100,100);}},onhexChange:function(){if(this.domNode){this.thumbNode.style.left=this.parent.parent.colorModel.s/100*160-3+"px";this.thumbNode.style.top=(1-this.parent.parent.colorModel.v/100)*160-3+"px";}},onmousedown:function(){var U=this.domNode.getBoundingClientRect();this.mouseX0=U.left;this.mouseY0=U.top;this.onmousemove=this._update;var S=this;this.onmouseup=function(){S.onmousemove=null;mstrmojo.dom.detachEvent(document.body,"mouseup",S.onmouseup);};mstrmojo.dom.attachEvent(document.body,"mouseup",this.onmouseup);},onclick:function(S){this._update(S);},_update:function(S){var W={x:S.e.clientX,y:S.e.clientY},V=Math.min(Math.max(0,W.x-this.mouseX0),160),U=Math.min(Math.max(0,W.y-this.mouseY0),160);this.thumbNode.style.left=(V-3)+"px";this.thumbNode.style.top=(U-3)+"px";this.parent.parent.colorModel.s=Math.floor(100*V/160);this.parent.parent.colorModel.set("v",Math.floor(100*(1-U/160)));},slot:"0,1"},{scriptClass:"mstrmojo.Container",cssClass:"hueSlider",markupString:'<div class="{@cssClass}" style="position:relative; {@cssText}" mstrAttach:click,mouseover,mousedown,mouseup,mousemove,mouseout><div class="hThumb"></div></div>',markupSlots:{containerNode:function(){return this.domNode;},thumbNode:function(){return this.domNode.firstChild;}},bindings:{hex:"this.parent.parent.colorModel.hex",h:"this.parent.parent.colorModel.h"},onhexChange:function(){this._moveThumb();},onhChange:function(){this._moveThumb();},_moveThumb:function(){if(this.thumbNode){this.thumbNode.style.top=(1-this.parent.parent.colorModel.h/360)*160-1+"px";}},onmousedown:function(){this.mouseY0=this.domNode.getBoundingClientRect().top;this.onmousemove=this._update;var S=this;this.onmouseup=function(){S.onmousemove=null;mstrmojo.dom.detachEvent(document.body,"mouseup",S.onmouseup);};mstrmojo.dom.attachEvent(document.body,"mouseup",S.onmouseup);},onclick:function(S){this._update(S);},_update:function(S){var V={x:S.e.clientX,y:S.e.clientY},U=Math.min(Math.max(0,V.y-this.mouseY0),160);this.thumbNode.style.top=(U-1)+"px";this.parent.parent.colorModel.set("h",Math.max(0,Math.floor(360*(1-U/160))));},slot:"0,2"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-ColorPicker-preview",markupMethods:{onbgColorChange:function(){this.domNode.style.backgroundColor=this.bgColor;}},bindings:{bgColor:"this.parent.parent.colorModel.hex"},onclick:function(){if(Q.showUserPalette){D(this.bgColor);}},slot:"1,0"},I(mstrmojo.desc(7848,"Hex"),"Hex","1,0"),K(mstrmojo.desc(7848,"Hex"),"1,0","hex",{cssClass:"hex",cssDisplay:"block",inputNodeCssClass:"hex",dtp:25,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,validator:function(S){if(/^#[0-9a-fA-F]{6}$/.test(S)){return{code:mstrmojo.validation.STATUSCODE.VALID};}return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:mstrmojo.desc(7882,"Please enter a 6-digit HEX color value in format: #xxxxxx")};}}}),I(mstrmojo.desc(3604,"Red"),"Red","1,1"),I(mstrmojo.desc(3606,"Green"),"Green","1,1"),I(mstrmojo.desc(3608,"Blue"),"Blue","1,1"),I(mstrmojo.desc(3605,"Hue"),"Hue","1,1"),I(mstrmojo.desc(3607,"Saturation"),"Saturation","1,1"),I(mstrmojo.desc(3609,"Brightness"),"Brightness","1,1"),K(mstrmojo.desc(3604,"Red"),"1,2","r"),G("r"),K(mstrmojo.desc(3606,"Green"),"1,2","g"),G("g"),K(mstrmojo.desc(3608,"Blue"),"1,2","b"),G("b"),K(mstrmojo.desc(3695,"Hue"),"1,2","h",{cssClass:"h",max:360}),G("h"),K(mstrmojo.desc(3607,"Saturation"),"1,2","s",{max:100}),G("s"),K(mstrmojo.desc(3609,"Brightness"),"1,2","v",{max:100}),G("v")]};if(this.showMoreColors){N.children.push({scriptClass:"mstrmojo.Button",cssClass:"more",alias:"more",title:mstrmojo.desc(7833,"More >>>"),onclick:function(){var S=this.parent.parent;S.set("expanded",!S.expanded);this.domNode.setAttribute("title",S.expanded?mstrmojo.desc(7834,"Less Colors"):mstrmojo.desc(7833,"More Colors"));this.domNode.className=S.expanded?"less":"more";},slot:"0,0"});}if(this.showGradients){N.children.push({scriptClass:"mstrmojo.Button",alias:"showGradients",cssClass:"ge",text:mstrmojo.desc(4786,"Gradients..."),title:mstrmojo.desc(7970,"Open Graident Editor"),onclick:function(){var S=this.parent.parent;S.set("show",false);S.parent.ge.set("show",true);},slot:"0,0"});}this.addChildren(N);this.addChildren({scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-ColorPicker-buttonBar",children:[mstrmojo.Button.newInteractiveButton(mstrmojo.desc(1442,"Ok"),function(){var S=this.parent.parent;if(!S.useAnimate){S.set("visible",false);}var U=S.colorModel.hex;if(S.showUserPalette){D(U);}S.set("selectedColor",U);if(S.onOK){S.onOK();}},"#999",{alias:"ok",cssClass:"mstrmojo-Editor-button"}),mstrmojo.Button.newInteractiveButton(mstrmojo.desc(221,"Cancel"),function(){var S=this.parent.parent;if(!S.useAnimate){S.set("visible",false);}if(S.onCancel){S.onCancel();}},"#999",{alias:"cancel",cssClass:"mstrmojo-Editor-button"})]});}});var J={scriptClass:"mstrmojo.Popup",slot:"popupNode",contentNodeCssClass:"mstrmojo-ColorPicker-popup-content",autoCloses:false,locksHover:true,colorPicker:null,onOpen:function(){this.colorPicker.set("selectedColor",this.opener.fillColor);var N=this;var M=function(){N.lastOpener=N.lastOpener||N.opener;if(N.opener!==N.lastOpener){N.opener.popupNode.appendChild(N.lastOpener.popupRef.domNode);N.lastOpener=N.opener;}N.colorPicker.set("show",true);};window.setTimeout(function(){M();},100);},onClose:function(){this.colorPicker.set("show",false);if(this.ge){this.ge.set("show",false);}},postCreate:function(){this.markupMethods=C.copy(this.markupMethods);this.markupMethods.onvisibleChange=null;},preBuildRendering:function(){if(this.showGradients||this.colorPicker.showGradients){this.addChildren(this.gradientRef);}},gradientRef:{scriptClass:"mstrmojo.GradientEditor",alias:"ge",cssText:"height:0; display:none; position:absolute; z-index: 4;",left:"0px",top:"0px",visible:false,showTitle:false,height:245,_resizeHandler:function(){},onOK:function(){this.parent.opener.set("gradient",this.gradient);this.parent.opener.set("gradientCss",this.gradient.css);this.set("show",false);},onCancel:function(){this.set("show",false);},onshowChange:function(O){var N=O.value,M=parseInt(this.height,10);var R=this.domNode.firstChild;if(N){this.set("model",this.parent.opener.gradient);R.style.display="block";}if(this.useAnimate!==false){var S=N?0:M,P=M-S,Q=this;R.style.overflow="hidden";if(N){R.style.display="block";}H(N,R,"height",S,P,function(){if(!N){R.style.display="none";var U=Q.parent.opener;if(U){U.closePopup();}}else{R.style.overflow="visible";}});}else{R.style.height=N?M+"px":0;R.style.display=N?"block":"none";}},postCreate:function(){this.bindings={useAnimate:"this.parent.opener.useAnimate"};}},children:[{scriptClass:"mstrmojo.ColorPicker",alias:"colorPicker",onChange:function(){if(!this.parent.opener){return ;}this.parent.opener.set("fillColor",this.selectedColor);this.set("show",false);this.parent.opener.closePopup();},onOK:function(){this.onApply();this._closePopup();},onApply:function(){this.parent.opener.set("fillColor",this.selectedColor);},onCancel:function(){this._closePopup();},_closePopup:function(){this.set("show",false);if(!this.showGradients||!this.parent.ge||(this.parent.ge&&!this.parent.ge.show)){this.parent.opener.closePopup();}},show:false,onEnd:function(){this.set("visible",this.show);},onshowChange:function(){var M=parseInt(this.expanded?this.fullHeight:this.height,10);if(this.useAnimate!==false){var Q=this.show?0:M,O=M-Q,P=this,N=(!this.show?function(){P.onEnd();}:null);if(this.show){this.set("visible",true);}H(this.show,this.domNode,"height",Q,O,N);}else{this.set("visible",this.show);this.domNode.style.height=M+"px";}},postCreate:function(){this.showGradients=this.parent.showGradients;this.bindings={showUserPalette:function(){return this.parent.opener?this.parent.opener.showUserPalette:this.showUserPalette;},useAnimate:function(){return this.parent.opener?this.parent.opener.useAnimate:this.useAnimate;},isSimple:function(){return this.parent.opener?this.parent.opener.isSimple:this.isSimple;},showNoColor:function(){return this.parent.opener?this.parent.opener.showNoColor:this.showNoColor;}};}}]};mstrmojo.colorPickerPopupRef=mstrmojo.insert(J);mstrmojo.simpleColorPickerPopupRef=mstrmojo.insert(C.copy({isSimple:true},C.copy(J)));mstrmojo.gradientColorPickerPopupRef=mstrmojo.insert(C.copy({showGradients:false},C.copy(J)));mstrmojo.ColorPicker.createDropDown=function E(O,N){O=O||{};var M=mstrmojo.colorPickerPopupRef;if(N){if(N.isSimple){M=mstrmojo.simpleColorPickerPopupRef;O.isSimple=N.isSimple;}else{if(N.showGradients){M=mstrmojo.gradientColorPickerPopupRef;O.showGradients=N.showGradients;}}}else{if(O){if(O.isSimple){M=mstrmojo.simpleColorPickerPopupRef;}else{if(O.showGradients){M=mstrmojo.gradientColorPickerPopupRef;}}}}return C.copy(O,{scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-ColorPicker-DropDownButton",markupMethods:{onfillColorChange:function(){if(this.boxNode&&this.fillColor){this.boxNode.style.cssText="background-color: "+this.fillColor;this.gradient=null;this.gradientCss=null;}},ongradientCssChange:function(){if(this.boxNode&&this.gradientCss){this.boxNode.style.cssText=this.gradientCss;this.fillColor=null;}}},popupRef:M,showUserPalette:true,useAnimate:true,showGradients:false,isSimple:false,fillColor:undefined});};}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.vi.ui.rw.selectors._HasWarningMessage","mstrmojo.vi.ui.rw._ValidInputLocalImage","mstrmojo.imageUtils");var A;$IMGUTIL=mstrmojo.imageUtils;mstrmojo.vi.ui.ImageEditorPanelImagePicker=mstrmojo.declare(mstrmojo.Container,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage,mstrmojo.vi.ui.rw._ValidInputLocalImage],{scriptClass:"mstrmojo.vi.ui.ImageEditorPanelImagePicker",cssClass:"",markupString:'<div class=\'mstrmojo-ImageEditorModel-ImagePicker {@cssClass}\'><label><input style="position: absolute; left: -10000px" type="file" accept=".png, .jpg, .jpeg, .gif, .bmp" onchange="mstrmojo.all.{@id}.syncFile();"/><div class="browseBtnLabel"></div></label></div>',markupSlots:{containerNode:function(){return this.domNode;},fileNode:function(){return this.domNode.children[0].firstChild;},browseBtnNode:function(){return this.domNode.children[0].lastChild;}},children:[mstrmojo.Button.newWebButton(mstrmojo.desc(1825,"Browse"),function(){if(mstrApp.isSingleTier){A=this.parent;var C=window.FormWrapper;C.openImageFileDialog("mstrmojo.vi.ui.ImageEditorPanelImagePicker.onOneTierFileSelected");}},false,{alias:"browseBtn",slot:"browseBtnNode",enabled:true})],init:function B(C){this._super(C);this.bindWarningHandler(this);},validationFailed:function(){this._super();this.set("validation",this.getValidationObj());},syncFile:function(){if(this.fileNode.files.length===1){var C=this.fileNode.files[0];this.fileSelected.call(this,C);}}});mstrmojo.vi.ui.ImageEditorPanelImagePicker.onOneTierFileSelected=function(E){if(E&&E.data&&E.filename){var D=";base64,";if(E.data.indexOf(D)===-1){E.data="data:image/jpeg;base64,"+E.data;}var C=$IMGUTIL.dataURLToBlob(E.data);var F={fileBlob:C,name:E.filename};A.fileSelected.call(A,F);}};}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.vi.ui.rw.selectors._HasWarningMessage","mstrmojo.vi.ui.rw._ValidInputLocalImage","mstrmojo.Button","mstrmojo.dom","mstrmojo.imageUtils","mstrmojo.string","mstrmojo.vi.ui.rw.ImageBoxOverlay");mstrmojo.requiresDescs(1825);var I=mstrmojo.string,J=mstrmojo.imageUtils,D=mstrmojo.dom,C;mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded=mstrmojo.declare(mstrmojo.vi.ui.rw.ImageBoxOverlay,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage,mstrmojo.vi.ui.rw._ValidInputLocalImage],{scriptClass:"mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded",markupString:'<div id="{@id}" class="mstrmojo-ImageBoxOverlayEmbeded {@cssClass}" style="{@domNodeCssText}" mstrAttach:dragover,dragleave,drop><div class="container-scroll-host"><div class="container"><div class="lbl"></div><div class="txt"></div><div class="buttons"><label><input class="mstrmojo-imageBoxOverlayEmbeded-file" type="file" accept=".png, .jpg, .jpeg, .gif, .bmp" onchange="mstrmojo.all.{@id}.syncFile();"/><div class="browseBtnLabel"></div></label><div class="okBtn"></div></div></div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},labelNode:function(){return this.domNode.firstChild.firstChild.firstChild;},textNode:function(){return this.domNode.firstChild.firstChild.children[1];},fileNode:function(){return this.domNode.firstChild.firstChild.children[2].firstChild.firstChild;},browseBtnNode:function(){return this.domNode.firstChild.firstChild.children[2].firstChild.lastChild;},buttonNode:function(){return this.domNode.firstChild.firstChild.children[2].lastChild;}},postBuildRendering:function A(){this._super();this.bindWarningHandler(this);},children:[{scriptClass:"mstrmojo.Label",slot:"labelNode",cssClass:"init-label"},mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){var L=this.parent;if(L.imgURL.value!==L.origURLStr){L.imageBox.urlEdited(L.imgURL.value);}else{L.imageBox.hideControlOverlay();}},true,{alias:"okBtn",slot:"buttonNode",enabled:false}),{scriptClass:"mstrmojo.TextBox",cssClass:"init-input",alias:"imgURL",slot:"textNode",bindings:{hint:function(){if(this.parent.parent.parent.isEmbeddedImageFeatureEnabled){return mstrmojo.desc(14552,"Enter an image URL or choose a file.");}else{return mstrmojo.desc(10493,"Image URL");}}},onkeydown:function(L){if(L.e.keyCode===13){var M=this.parent;if(M.imgURL.value!==M.origURLStr){M.imageBox.urlEdited(this.value);}else{M.imageBox.hideControlOverlay();}}},onmousedown:function(L){D.stopPropogation(L.hWin,L.e);},onblur:function(L){this.parent.hasChanged();},getLayoutOffsets:function H(){return{h:0,w:2};},_set_value:function(O,L){var M=this.value;if(M!==L){this.value=L;var N=this.parent.okBtn;N.set("enabled",!I.isEmpty(L));}}},mstrmojo.Button.newWebButton(mstrmojo.desc(1825,"Browse"),function(){if(mstrApp.isSingleTier){C=this.parent;var L=window.FormWrapper;L.openImageFileDialog("mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded.onOneTierFileSelected");}},false,{alias:"browseBtn",slot:"browseBtnNode",enabled:true})],droppable:true,ondragover:function B(L){if(!this.droppable){return ;}var N=L.e;N.stopPropagation();N.preventDefault();var M=N.dataTransfer.items;if(M){N.dataTransfer.dropEffect=this.VALID_MIME_TYPES.indexOf(M[0]&&M[0].type)!==-1?"copy":"none";}mstrmojo.css.addClass(this.dnDNode,"dragging");},ondragleave:function K(){if(!this.droppable){return ;}this.className="";mstrmojo.css.removeClass(this.dnDNode,"dragging");},ondrop:function F(L){if(!this.droppable){return ;}var O=L.e;O.preventDefault();var N=O.dataTransfer.files;mstrmojo.css.removeClass(this.dnDNode,"dragging");if(N&&N.length>0){var M=N[0];this.fileSelected.call(this,M);}},validationFailed:function E(){this._super();var L=this.getValidationObj();if(L){L.refNode=this.textNode;}this.set("validation",L);this.okBtn.set("enabled",false);},validationSuccess:function G(L){this._super(L);this.okBtn.set("enabled",true);},syncFile:function(){if(this.fileNode.files.length===1){var M=this.fileNode.files[0];var L=M.size/1024;this.imgURL.set("value",M.name+" - "+L.toFixed(2)+"KB");this.fileSelected.call(this,M);}}});mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded.onOneTierFileSelected=function(N){if(N&&N.data&&N.filename){var M=";base64,";if(N.data.indexOf(M)===-1){N.data="data:image/jpeg;base64,"+N.data;}var L=J.dataURLToBlob(N.data);C.imgURL.set("value",N.filename);var O={fileBlob:L,name:N.filename};C.fileSelected.call(C,O);}};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider");mstrmojo.vi.ui.rw.selectors.PageBySlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.PageBySlider",slot:"containerNode",preBuildRendering:function A(){var C=this.parent;this.setDimensions(C.height,C.width);return this._super();},setDimensions:function B(D,C){this.height=D;this.width=C;this.synchronizeSlider();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Slider","mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.vi.ui.rw.selectors.MetricValueSliderHelper","mstrmojo.vi.ui.rw.selectors.MetricRankSliderHelper","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.MetricSelectorUtility","mstrmojo.num","mstrmojo.boxmodel");var J=mstrmojo.css,I=mstrmojo.dom,D=mstrmojo.hash,G=mstrmojo.num,F=mstrmojo.MetricSelectorUtility,K=mstrmojo.boxmodel;mstrmojo.vi.ui.rw.selectors.MetricSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.rw.selectors.MetricSlider",cachedClickHandler:null,updateTypeHelper:function C(){var S=this.qua,R=F.typeHelperCls[S]||F.typeHelperCls.defaultCls,U=D.walk("vi.ui.rw.selectors."+R,mstrmojo);this.typeHelper=new U({slider:this});J[(S!==F.Q._G?"add":"remove")+"WidgetCssClass"](this,"rank");},configureGhost:function H(R){if(!this.staticStatus){return this._super(R);}},initDrag:function N(S,R){if(!this.staticStatus&&!this.da.nov){this._super(S,R);}},ondrag:function Q(S,R){if(this.dnd.initD&&!this.staticStatus){this._super(S,R);}},ondrop:function L(W){if(this.dnd.initD&&!this.staticStatus&&!this.da.nov){this._super(W);}else{var S=this.dnd,R=this,V=S.afterDragEnd;S.afterDragEnd=null;S._dragEndCallback();S.afterDragEnd=V;this.cachedClickHandler=this.onclick;this.onclick=null;var U=function(){R.onclick=R.cachedClickHandler;};window.setTimeout(U,0);}},onclick:function P(R){var S=R.getTarget();if(S===this.handle1Node||S===this.handle2Node){window.clearTimeout(this._tooltipTimeOut);this.hideTooltip();this.openPopup("editValueRef",{tgt:S});}else{this._super(R);}},onincludeChange:function B(){if(!this.staticStatus){this.changeInclude=true;this.onselectionChange();}},onquaChange:function O(R){var V=R.valueWas,W=R.value,S=F.getFuncInfo(this.opId,V),U=F.getFuncInfo(this.opId,W);if(S.ft!==U.ft){if(!this.staticStatus){this.items=[];this.cs=[];this.f=this.ft=null;this.refresh();}}else{this.f=F.getFuncInfo(this.opId,R.value).f;}this.changeQual=true;this.onselectionChange();},updateData:function E(R,S){this.da=R;this.updateExpr(S);},updateExpr:function A(R){if(R){this.cs=R.cs;this.f=R.f;this.ft=R.ft;this.qua=R.qua;}this.refresh();},editValueRef:{cssClass:"edvl mstrmojo-Tooltip",contentNodeCssClass:"mstrmojo-Tooltip-content",scriptClass:"mstrmojo.Popup",locksHover:true,onOpen:function(){var V=this.opener,S=this.edt,U=(this.tgt===V.handle1Node),R=K.offset(V.tooltipNode[U?0:1]);J.addClass(this.domNode,V.richTooltip.cssClass);this.set("left",R.left+"px");this.set("top",R.top-this.containerNode.offsetHeight+"px");S.set("value",G.toLocaleString(U?V.cs1Vl:V.cs2Vl));I.setInputSelection(S.inputNode);},onClose:function(){this.opener.set("validation",{invalid:false,position:1});},children:[{scriptClass:"mstrmojo.TextBox",alias:"edt",apply:function(){var U=this.parent,W=U.opener,S=W.typeHelper,V=(U.tgt===W.handle1Node),R=G.parseNumeric(this.value);if(String(R).length>0){R=R<W.low?W.low:(R>W.high?W.high:R);W[V?"cs1Vl":"cs2Vl"]=S.fixDigitByNumFormat(R,W.numFmts);W.onselectionChange();S.updateThumb();U.close();}},onEnter:function(){var S=this.parent.opener,R=F.doValidation(this.value,S,{refNode:this.parent.domNode,position:1},false);if(R.invalid){S.set("validation",R);}else{this.apply();}}}]},showTooltip:function M(S,R){if(!this.editValueRef.visible){this._super(S,R);}}});mstrmojo.vi.ui.rw.selectors.MetricSlider.METRICSLIDERDEFAULTWIDTH=95;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.hash","mstrmojo.dom","mstrmojo.tooltip","mstrmojo.gmaps.MapEnums");var G=mstrmojo.hash,B=mstrmojo.dom,D=mstrmojo.gmaps,A=D.EnumPropertyType;mstrmojo.mapbox.ui.selectors.ClusterMaxZoomSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,null,{scriptClass:" mstrmojo.mapbox.ui.selectors.ClusterMaxZoomSlider",sliderDefaultWidth:140,multiSelect:false,init:function F(L){L=G.copy(L,{isHoriz:true,multiSelect:false,min:0,max:22});if(!L.host){throw new Error(this.scriptClass+"must be initialized with a host which is a mapbox");}var K=L.host,J=K.getEditingGridProps(),I=parseInt(J[A.clusterMaxZoom],10);L.selectedIndex=isNaN(I)?22:I;this._super(L);},onselectionChange:function(){var I=this.host;I.writeProperties(A.clusterMaxZoom,this.cs2Idx);},initDrag:function E(J,I){if(this.enabled){this._super(J,I);}},_updateTooltip:function C(O,M){var K=B.eventTarget(M,O),L,S,R,P,J=null,Q=null,N='<div class="name">{@content}</div>',I='<div class="dsc">{@description}</div>',V,U=false;switch(K){case this.handle2Node:L=String(this.cs2Nm).replace("$","$$$$");R=mstrmojo.tooltip.POS_TOPLEFT;P="vi-tooltip-A ";Q=this.handle2Node.offsetHeight+18;J=-4;U=true;break;case this.lowNode:L=mstrmojo.desc(15726,"This is the zoom level where you can see the whole world.");R=mstrmojo.tooltip.POS_TOPLEFT;P="vi-tooltip-C ";Q=-8;J=this.lowNode.offsetWidth+16;U=true;break;case this.highNode:L=mstrmojo.desc(15727,"This is the zoom level where you can see streets and buildings.");R=mstrmojo.tooltip.POS_TOPLEFT;P="vi-tooltip-C ";Q=-8;J=this.highNode.offsetWidth+16;U=true;break;default:break;}if(U&&this.enabled){V={cssClass:"mstrmojo-VISlider vi-regular "+P+mstrApp.getThemeClassName(),content:N.replace(/\{@content\}/g,L)+(S&&S.length>0?I.replace(/\{@description\}/g,S):""),contentNodeCssClass:"scm-tooltip",refNode:K,posType:R,left:J,top:Q};this.set("richTooltip",V);}},destroy:function H(I){if(this.baseLayer){delete this.baseLayer;}this._super(I);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.PopupConfig","mstrmojo.ui.menus.MenuEditor");mstrmojo.ui.menus.EditorConfig=mstrmojo.declare(mstrmojo.ui.menus.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.EditorConfig",data:null,fnOk:null,fnCancel:null,okEnabled:true,cancelEnabled:true,okVisible:true,cancelVisible:true,init:function D(E){this._super(E);if(this.data&&!mstrmojo.all[this.data.id]){mstrmojo.hash.make(this.data,mstrmojo.Obj);}this.initBindings();},clear:function A(){this._super();this.data=null;this.fnOk=this.fnCancel=mstrmojo.emptyFn;},newInstance:function C(){return new mstrmojo.ui.menus.MenuEditor({popupConfig:this});},destroy:function B(){if(this.data){this.data.destroy();}this.destroyBindings();this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor");function C(E,F){var D=this;if(mstrApp&&mstrApp.serverRequest){mstrApp.serverRequest(E,F,{silent:true});}else{mstrmojo.xhr.request("POST",D.path,F,E,undefined,D.XServer,D.baseParams);}}function A(H,I,G,D){var E=this,F={taskId:"createFolder",taskContentType:"json",folderID:H,name:I,description:G};C.call(E,F,D);}function B(E,I,F){if(!E){mstrmojo.alert(mstrmojo.desc(3380));return false;}var G=this,H=G.fId,D={success:function(J){G.contPanel.name.set("value","");G.contPanel.desc.set("value","");if(G.okFn){G.okFn(J,F);}},failure:function(J){var K="";if(J.getResponseHeader){K=J.getResponseHeader("X-MSTR-TaskFailureMsg");}else{if(J.message){K=J.message;}}K&&mstrmojo.alert(K);}};if(mstrApp.isSingleTier&&this.dp){this.dp.newFolder(H,E,I,D);}else{A.call(G,H,E,I,D);}}mstrmojo.NewFolderEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.NewFolderEditor",cssClass:"mstrmojo-NewFolderEditor",title:mstrmojo.desc(663,"Create Folder"),help:"Create_a_new_folder.htm",navigateAfter:false,okFn:mstrmojo.emptyFn,path:mstrConfig.taskURL,fId:null,children:[{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"btns",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",alias:"ok",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,G=E&&E.opener,D=E.contPanel.name.value,F=E.contPanel.desc.value;if(!B.call(E,D,F,E.navigateAfter)){E.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.func","mstrmojo.string","mstrmojo.Box","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.Label","mstrmojo._HasLayout","mstrmojo.Editor","mstrmojo.ui.CheckList","mstrmojo.ui.ToggleButton","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(10,1763,15120,15801);var L=mstrmojo.array,Z=mstrmojo.css,D=mstrmojo.dom,Q=mstrmojo.expr,U=mstrmojo.func,B=mstrmojo.string,R=mstrmojo.Button.newWebButton,b=mstrmojo.mstr.EnumDSSXMLObjectTypes;var W=mstrmojo.desc(1763,"Clear All");mstrmojo.vi.ui.IncCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._IsIncFetchList],{scriptClass:"mstrmojo.vi.ui.IncCheckList",allowUnlistedValues:false,cssClass:"elementsList",initElements:function Y(e){var d=this.ifDataHelper,c=this;if(!d){return ;}e=U.wrapMethods({success:function(f){c.clearSelect(true);c.set("items",[]);c.initScroll();c.addItems(f&&f.es);}},e);d.getItems(1,e,{hideFailureErr:true});},addItems:function N(c){this._super(c||[]);this.postAddItems();this.updateScrollbars();},postAddItems:mstrmojo.emptyFn});function F(c){return !L.filterOne(c.fs,function(d){return d.isbf&&(!!d.dtp?d.dtp:Q.mapBaseFormTypeToDataType(d.bftp))!==Q.DTP.CHAR;});}mstrmojo.vi.ui.ElementsBrowser=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.ElementsBrowser",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-ui-vi-ElementsBrowser {@cssClass}" style="{@cssText}"><div></div><div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},searchBoxNode:function(){return this.domNode.firstChild;},buttonPanelNode:function(){return this.domNode.childNodes[1];},elementListNode:function(){return this.domNode.childNodes[2];}},layoutConfig:{h:{searchBoxNode:"26px",buttonPanelNode:"36px",elementListNode:"100%"},w:{searchBoxNode:"100%",buttonPanelNode:"100%",elementListNode:"100%"},xt:true},onBrowseElementsFailure:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.HBox",slot:"searchBoxNode",alias:"util",cssClass:"elemsBrowser-utils-bar",children:[{scriptClass:"mstrmojo.Box",cssClass:"eb-box-search",alias:"box",children:[{scriptClass:"mstrmojo.TextBox",alias:"searchBox",hint:mstrmojo.desc(10,"Search"),cssClass:"eb-searchBox",valueChangeDelay:300,onEnter:function I(){var d=this.value,c=this.parent.parent.parent;c.set("searchPattern",d);},onvalueChange:function P(){var d=this.value,c=this.parent.parent.parent;c.set("searchPattern",d);}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-clear",text:"",onclick:function(){var c=this.parent.searchBox;c.set("value","");c.cleanUp();c.focus();},bindings:{visible:"(this.parent.searchBox.value || '').length > 0"}}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15120,"View Selected"),cssClass:"eb-viewSelected",title:mstrmojo.desc(15120,"View Selected")},{scriptClass:"mstrmojo.ui.ToggleButton",alias:"toggleSelected",oncheckedChange:function J(){var c=this.parent.parent;c.onsearchPatternChange();}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonPanelNode",alias:"buttonPanel",cssClass:"elemsBrowser-button-panel",children:[{scriptClass:"mstrmojo.Button",text:W,title:W,alias:"clearAllBtn",cssClass:"eb-clearAll",useRichTooltip:true,updateTooltipConfig:function V(){var c=D.position(this.domNode);this.richTooltip={content:mstrmojo.desc(16192,"This function is currently not supported for non-text elements in the searching result."),cssClass:"vi-info vi-tooltip-C",left:c.x+60,top:c.y+5};},onclick:function(){var d=this.parent.parent,f=d.elementList;f.clearSelect(false);var c=d.getLocalSearchItems(),e=d.itemIdField;d.onItemsSelectionChange({added:[],removed:c,itemIdField:e});L.removeItems(d.selectedItems,e,c);},showTooltip:function C(f,d){var c=this.parent.parent;if(!this.enabled&&!B.isEmpty(c.getSearchBox().value)&&!F(c.attribute)){mstrmojo._HasTooltip.showTooltip.call(this,f,d);}}},]},{scriptClass:"mstrmojo.vi.ui.IncCheckList",alias:"elementList",slot:"elementListNode",itemIdField:null,bindings:{ifDataHelper:"this.parent.ifDataHelper",itemIdField:"this.parent.itemIdField"},postAddItems:function(){var c=this.parent.selectedItems||[];this.setSelectedItems(c);}}],itemIdField:"v",ifDataSource:null,searchPattern:null,ifDataHelper:null,attribute:null,attributeId:null,selectedItems:[],init:function(c){this._super(c);this.set("ifDataHelper",new mstrmojo.mstr.DocElementDataHelper({source:this.ifDataSource}));if(this.ifDataSource&&this.attribute){this.onattributeChange();}this.elementList.attachEventListener("selectionChange",this.id,"onElementsListchange");},updateClearAllBtnState:function O(){this.buttonPanel&&this.buttonPanel.clearAllBtn.set("enabled",(B.isEmpty(this.getSearchBox().value)||F(this.attribute))&&(this.getLocalSearchItems().length>0));},onElementsListchange:function H(j){var h=j&&j.added||[],f=j&&j.removed||[],g=this.elementList.items,c=this.itemIdField;if(!this.selectedItems){this.selectedItems=[];}var e=this.selectedItems,d=[],k=L.get(g,f);L.removeItems(e,c,k);var l;L.forEach(h,function(m){l=g[m];if(l&&L.find(e,c,l[c])<0){e.push(l);d.push(l);}});this.updateClearAllBtnState();if(k.length>0||d.length>0){this.onItemsSelectionChange({added:d,removed:k,itemIdField:c});}},onItemsSelectionChange:mstrmojo.emptyFn,updateBrowseConfig:function K(){var e=this,j=this.attributeId,c=this.attribute,h=this.searchPattern,g=function(l,m){l.set("textValid",!m);l.domNode.title=B.encodeHtmlString(m,true);};if(!j){return ;}this.ifDataHelper.set("items",null);var d={attributeID:j};if(h&&h!==""){d.searchPattern=h;d.matchCase=false;d.otp=c.t||b.Attribute;}this.onUpdateBrowseElementsParams(d);this.ifDataHelper.set("browseConfig",d);var k=e.getSearchBox();this.elementList.initElements({success:function(l){g(k,"");},failure:function(q){var n=parseInt(q.code,10)+4294967296,p=2147762269,l=2147762227,m=2147762262,o=2147894808;if(n===l||n===m){g(k,"");}else{if(n!==p){var r=(n!==o)?e.onBrowseElementsFailure.bind(e):null;var s={shortDesc:mstrmojo.desc(15402,"This object is not available at this time."),longDesc:q.message},t={title:mstrmojo.desc(15403,"Invalid Object"),buttons:[R(mstrmojo.desc(13197,"Got it"),r,false)]};mstrmojo.error(s,undefined,t);g(k,"");}else{g(k,q.message);}}}});var f=this.util&&this.util.toggleSelected;if(f){f.checked=false;Z.toggleClass(f.domNode,"checked",false);}this.updateClearAllBtnState();},isObjSearchable:function E(c){return !(c&&c.t===b.Consolidation);},onattributeChange:function A(){var c=this.attribute;this.attributeId=c&&c.did;this.searchPattern=null;this.selectedItems=[];this.updateBrowseConfig();var e=this.getSearchBox(),d=this.isObjSearchable(c);if(e){e.set("enabled",d);e.set("hint",d?mstrmojo.desc(10,"Search"):mstrmojo.desc(15801,"Not searchable"));}},getSearchBox:function M(){var c=this.util,d=this.util&&this.util.box;return d&&d.searchBox;},onifDataSourceChange:function G(){this.ifDataHelper.set("source",this.ifDataSource);this.ifDataHelper.set("items",null);},onsearchPatternChange:function X(){var d=this.util&&this.util.toggleSelected;if(!d||!d.checked){this.updateBrowseConfig();}else{var c=this.getLocalSearchItems();this.elementList.clearSelect(true);this.elementList.set("items",[]);this.elementList.addItems(c);this.updateClearAllBtnState();}},getLocalSearchItems:function S(){var d=[],c;if(this.searchPattern&&this.searchPattern!==""){var e=this.searchPattern.toLowerCase();L.forEach(this.selectedItems,function(f){c=(f.n||"").toLowerCase();if(c.indexOf(e)>-1){d.push(f);}});}else{d=(this.selectedItems||[]).slice(0);}return d;},_set_selectedItems:function a(g,c){var f=this.selectedItems,e=this.itemIdField;c=c||[];this.selectedItems=c;this.updateClearAllBtnState();if(f.length!==c.length){return true;}var d=L.intersection(f,c,e);return d.length!==f.length;},onselectedItemsChange:function(){this.elementList.setSelectedItems(this.selectedItems);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Button");mstrmojo.requiresDescs(4531,8262,12437,12438,12439,15645);var D=mstrmojo.hash;var E={Automatic:0,Manual:3};var J={Automatic:-1,False:0,True:1};var H={Automatic:-1,False:1,True:2};var F={mps:{afb:J.False,sfb:H.False,fbf:E.Automatic}};var B=["mps"],L=function(Q,O){var P=this.parent.parent,M=P.cloneModel,N=M.mps||{};if(N[Q]!==O){N[Q]=O;if(Q==="fbf"&&O===E.Manual){N.afb=(N.afb===J.Automatic)?J.False:N.afb;N.sfb=(N.sfb===H.Automatic)?H.False:N.sfb;}P.set("dirty",true);}};var I=function(M){return M&&M.afb===J.False&&M.sfb===H.False&&M.fbf===E.Manual;};mstrmojo.ME.DerivedMetricOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedMetricOptions",cssClass:"mstrmojo-DerivedMetricOptions",dirty:false,init:function K(M){this._super(M);mstrmojo.css.addWidgetCssClass(this,"dme");},updateModel:function C(){var N=this.model,M=this.cloneModel,O=M.mps;if(O.fbf===E.Automatic){O.afb=J.Automatic;O.sfb=H.Automatic;}else{if(O.fbf===E.Manual){O.afb=O.afb===J.Automatic?J.False:O.afb;O.sfb=O.sfb===H.Automatic?H.False:O.sfb;}}O.dirty=true;N.mps=M.mps;},onOpen:function A(){var O=this.cloneModel||{};D.make(O,mstrmojo.Obj);var N=mstrmojo.hash.copy(this.model,mstrmojo.hash.copy(F)),P,M;for(P=0,M=B.length;P<M;P++){O.set(B[P],D.clone(N[B[P]]));}this.cloneModel=null;this.set("cloneModel",O);},onClose:function G(){this.set("dirty",false);delete this.cloneModel;},children:[{scriptClass:"mstrmojo.HBox",alias:"fbFlagBox",cssClass:"mstrmojo-DerivedMetricOptions-aggBox",children:[{scriptClass:"mstrmojo.Label",cssText:"white-space: nowrap; margin-right: 8px; vertical-align: top;",text:mstrmojo.desc(12437,"Aggregation And Subtotal Behavior:")},{scriptClass:"mstrmojo.Pulldown",alias:"fbFlag",cssText:"min-width: 100px;",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"v",items:[{n:mstrmojo.desc(4531,"Automatic"),v:E.Automatic},{n:mstrmojo.desc(8262,"Manual"),v:E.Manual}],bindings:{value:function(){return this.parent.parent.cloneModel.mps.fbf||E.Automatic;}},onvalueChange:function(M){if(M.value!==undefined&&M.valueWas!==undefined){L.call(this,"fbf",M.value);}}}]},{scriptClass:"mstrmojo.Box",cssText:"height: 30px",cssClass:"mstrmojo-DerivedMetricOptions-afbBox",children:[{scriptClass:"mstrmojo.CheckBox",alias:"afb",cssDisplay:"inline-block",label:mstrmojo.desc(12438,"Aggregate From Base"),bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.afb===J.True;}},onclick:function(M){var N=this.parent.parent.fbFlagBox.fbFlag.value;L.call(this,"afb",N===E.Automatic?J.Automatic:(this.checked?J.True:J.False));}},{scriptClass:"mstrmojo.CheckBox",alias:"sfb",cssDisplay:"inline-block",label:mstrmojo.desc(12439,"Subtotals From Base"),oncheckedChange:function(M){var N=this.parent.afb;if(M.value){if(!N.checked){N.checked=J.True;N.onclick();}if(N.inputNode){N.inputNode.checked=true;N.inputNode.disabled=true;}}else{if(N.inputNode){N.inputNode.disabled=false;}}},bindings:{visible:function(){return this.parent.parent.fbFlagBox.fbFlag.value===E.Manual;},checked:function(){return this.parent.parent.cloneModel.mps.sfb===H.True;}},onclick:function(){var M=this.parent.parent.fbFlagBox.fbFlag.value;L.call(this,"sfb",M===E.Automatic?H.Automatic:(this.checked?H.True:H.False));}}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:function(){return this.parent.parent.dirty;}},onclick:function(){var P=this.parent.parent,R=P&&P.opener;var Q=function(){P.updateModel();if(P.onOK){P.onOK();}P.close();};var M=P.cloneModel,N=M&&M.mps;if(I(N)&&R&&R.hasConditionFilter&&R.hasConditionFilter()){mstrmojo.warn(mstrmojo.desc(15645,"There is a filter defined for this metric, if you proceed this filter will be removed."),{confirmBtn:{t:mstrmojo.desc(212,"Continue"),fn:function O(){Q();R.clearConditionFilter();},hot:false},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:mstrmojo.emptyFn,hot:true}});}else{Q();if(R&&R.onMpsChange){R.onMpsChange();}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var M=this.parent.parent;M.close();}}]}]});mstrmojo.ME.DerivedMetricOptions.isNonAFB=I;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo._HasPopup","mstrmojo.ListBase","mstrmojo.Popup","mstrmojo.Editor","mstrmojo.SuggestionList");function D(b,Y){var a=this.list,W=a.selectedIndex,V=a.items.length,X=b?V-1:0;if(W===X){a.clearSelect();return ;}if(W===null||W<0){W=b?0:V-1;}else{W+=b?1:-1;}if(Y){var Z=a.items[W];while(Z&&Z.type==="dummy"){if(W===X){a.clearSelect();return ;}W+=b?1:-1;Z=a.items[W];}}a.singleSelect(W);}mstrmojo._HasSuggestion=mstrmojo.provide("mstrmojo._HasSuggestion",mstrmojo.hash.copy(mstrmojo._HasPopup,{blockBegin:1,blockCount:-1,suggestCount:15,autoSelect:true,itemField:"n",candidates:null,suggestionShown:false,suggestionItems:null,_last_hit:null,_request_pattern:null,browseItemVisible:false,folderLinksContextId:25,browsableTypes:"1,8",REQUEST_THRESHOLD:20,noCache:false,disableClick:false,getCandidatesThroughTaskCall:mstrmojo.emptyFn,onSuggestionItemSelect:function J(V){this.hideSuggestion();},getSearchPattern:function U(){return"";},getSuggestionPos:function N(){return{left:"100px",top:"100px"};},getSuggestionTarget:function G(){return this;},showSuggestion:function B(W){var V=this.getSuggestion(W);if(!this.noCache&&V!==-1){this.updateSuggestion(V);}},hideSuggestion:function C(){this.suggestionShown=false;if(this.suggestionPopup.visible){this.suggestionPopup.close();}},getSelected:function M(){return(this.suggestionShown)?this._lastOpened.getSelected():null;},nextHighlight:function E(V){if(this.suggestionShown){this._lastOpened.nextHighlight(V);}},preHighlight:function H(V){if(this.suggestionShown){this._lastOpened.preHighlight(V);}},getSuggestion:function S(j){var e=this.candidates,b=e&&e.items,Y=e&&e.isComplete,h=this._last_hit;if(!this.noCache&&(e||h)){var g=this.filterCandidates(b,j,this.REQUEST_THRESHOLD),d=g.length,f=this.suggestCount,V=false;if(!Y&&d<f){var W=h&&h.pattern;if(h&&W&&(j.indexOf(W)>-1)){V=true;var l=this.filterCandidates(h.items,j,this.REQUEST_THRESHOLD),Z=l&&l.length,X=mstrmojo.array,k=this.itemField,a;for(a=0;a<Z;a++){if(X.find(g,k,l[a][k])===-1){g.push(l[a]);}}d=g.length;}}if(!Y&&((j.length>2&&d<this.REQUEST_THRESHOLD)||(d<f))){this.requestCandidates(j);return -1;}return(d<f)?g:g.slice(0,f);}this.requestCandidates(j);return -1;},requestCandidates:function A(V){this._request_pattern=V;var Y=this,W=this.getSuggestionTarget(),X={success:function(f){if(!f){return ;}var e=Y.getSuggestionTarget();if(!e||(W!==e)){return ;}var k=e.getSearchPattern(),b=f.items;Y._last_hit={items:b,pattern:V};Y.sz=f.sz;if(!Y.noCache&&b){var g=(Y.candidates&&Y.candidates.items)||[],h=[].concat(b),d=b.length,a;for(a=0;a<d;a++){var Z=h[a];if(mstrmojo.array.indexOf(g,Z)>-1){mstrmojo.array.removeItem(b,Z);}}if(Y.candidates){Y.candidates.items=g.concat(b);}}if((k||k==="")&&k.indexOf(V)>-1){var j=Y.filterCandidates(b,k);Y.updateSuggestion(j);}},failure:function(Z){if(Z.getResponseHeader){mstrmojo.alert(Z.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};this.getCandidatesThroughTaskCall({pattern:V,blockBegin:this.blockBegin,blockCount:this.blockCount,isSuggest:true},X);},filterCandidates:function Q(Y,X,V){V=V||this.suggestCount;X=mstrmojo.string.regEscape(X);var Z=this.itemField,W=mstrmojo.array.filter(Y,function(a){return(new RegExp("\\s"+X+"|^"+X,"i")).test(a[Z]);},{max:V});return W;},getHighlightedText:function P(X,a){if(!this.highlightPattern||mstrmojo.string.isEmpty(X)){return a;}try{if(!this.nameWildcards||mstr.$A.find([2,32],parseInt(this.nameWildcards,10))>-1){a=a.replace(new RegExp("(^|\\s)("+X+")","gi"),"$1<b>$2</b>");}else{var Z=X.split(" "),W,V;for(W=0,V=Z.length;W<V;W++){if(Z[W]!==""){a=a.replace(new RegExp("("+Z[W]+")","gi"),"<b>$1</b>");}}}}catch(Y){}return a;},updateSuggestion:function O(Y){var W=Y&&Y.length,V=this.browseItemVisible;if(W||V){if(V){Y=Y||[];Y.push({n:"Browse...",t:-99,cssClass:(W?"br":"bro")});}this.set("suggestionItems",Y);if(this.suggestionShown){var X=this._lastOpened;if(X&&X.nudge){X.nudge();}if(this.autoSelect&&X){X.list.singleSelect(0);}}else{this.openPopup("suggestionPopup",this.getSuggestionPos());this.suggestionShown=true;}}else{this.hideSuggestion();}},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",onClose:function(){var V=this.opener;if(V&&V.onBrowserClose){V.onBrowserClose();}},onOpen:function(){var V=this.opener;if(V&&V.onBrowserOpen){V.onBrowserOpen();}},children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},onBrowserClose:function L(){this.browserShown=false;},handleSuggestionItemSelect:function K(V,W){if(this.browseItemVisible&&V.t===-99){this.hideSuggestion();mstrmojo.requiresCls("mstrmojo.ObjectBrowser");var X=this.zIndex;this.openPopup("ob",{zIndex:(X&&(X+10))||110});this.ob.browser.browse(mstrmojo.hash.copy(W,{folderLinksContextId:this.folderLinksContextId,onSelectCB:[this,"onSuggestionItemSelect"],browsableTypes:this.browsableTypes}));this.browserShown=true;}else{this.onSuggestionItemSelect(V);}},highlightPattern:true,suggestionPopupCssClss:"",suggestionPopup:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-ObjectInputBox-suggest",autoClose:true,locksHover:true,nextHighlight:function(V){D.call(this,true,V);},preHighlight:function(V){D.call(this,false,V);},getSelected:function M(){var V=this.list;return V.items[V.selectedIndex];},onOpen:function I(){var V=this.opener;if(V){mstrmojo.css.addClass(this.domNode,V.suggestionPopupCssClss||"");if(V.autoSelect){this.list.singleSelect(0);}if(V.nudge){V.nudge(this);}}},onClose:function F(){this.list.clearSelect();var V=this.opener;if(V){V.suggestionShown=false;mstrmojo.css.removeClass(this.domNode,V.suggestionPopupCssClss||"");}}},suggestionListClass:"mstrmojo.SuggestionList",postApplyProperties:function R(){this.suggestionPopup.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list"}];}}));}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.ui.editors.controls.TwoColumnContainer");var C=mstrmojo.Button.newWebButton;function B(){if(this.onRename(this.renameBox.name.value)!==false){this.close();}}mstrmojo.ui.editors.RenameEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ui.editors.RenameEditor",cssClass:"mstrmojo-rename-editor",btnAlignment:"right",renameBox:undefined,renameText:"",helpText:undefined,title:mstrmojo.desc(5740,"Rename"),onRename:mstrmojo.emptyFn,init:function E(F){this._super(F);this.renameBox.name.value=this.renameText;this.helpStrNode.set("text",this.helpText);},postBuildRendering:function(){if(this._super){this._super();}this.renameBox.name.focus();},children:[{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",width:"264px",col1Width:"35px",col2Width:"100%",alias:"renameBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2211,"Name:"),slot:"col1Node"},{scriptClass:"mstrmojo.TextBox",slot:"col2Node",alias:"name",onEnter:function A(){B.call(this.parent.parent);},getLayoutOffsets:function D(){return{h:0,w:2};}}]},{scriptClass:"mstrmojo.Label",autoHide:true,alias:"helpStrNode",cssClass:"helpString"}],buttons:[C(mstrmojo.desc(118,"Save"),function(){B.call(this.parent.parent);},true,{alias:"okBtn",bindings:{enabled:function(){return this.parent.parent.renameBox.name.value!=="";}}}),C(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.close();})]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.Label","mstrmojo.Button");var E=mstrmojo.Button.newWebButton;function D(){this.close();this.destroy();}mstrmojo.onetier.vi.prefs.LoginEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.onetier.vi.prefs.LoginEditor",title:mstrmojo.desc(13696,"Login Required"),cssClass:"mstrmojo-ot-prefs-LoginEditor",userName:undefined,password:undefined,loginTitleLabel:undefined,loginTitle:undefined,zIndex:99999,authenticateCredentials:function C(I,H){this.throwAbstractMethodError("authenticateCredentials");},onLoginCancelled:mstrmojo.emptyFn,init:function F(H){this._super(H);if(this.loginTitle){var I=this.loginTitleLabel;I.text=this.loginTitle;I.visible=true;}},onPreClose:function A(){this.onLoginCancelled();return this._super();},onLogin:function B(){var H=this;H.authenticateCredentials(H.userName.value,H.password.value);D.call(H);},children:[{scriptClass:"mstrmojo.Label",text:"",visible:false,cssClass:"login-title",alias:"loginTitleLabel",useRichTooltip:true,getItemTooltip:function(){var H=mstrmojo.dom.position(this.domNode),I="<div>"+mstrmojo.string.encodeHtmlString(this.text,true)+"</div>";return{cssClass:"vi-regular vi-tooltip-C loginEditorTooltip",content:I,top:H.y-10,left:H.x+H.w+9,enableHover:false};},showTooltip:function G(H,I){this.richTooltip=this.getItemTooltip();if(this.richTooltip&&this.text.length>50){this.constructor.prototype.showTooltip.call(this,H,I);}}},{scriptClass:"mstrmojo.TextBox",emptyText:mstrmojo.desc(5135,"User Name"),alias:"userName",cssDisplay:"block",onEnter:function(){var H=this.parent;H.onLogin.call(H);}},{scriptClass:"mstrmojo.TextBox",emptyText:mstrmojo.desc(18,"Password"),alias:"password",cssDisplay:"block",type:"password",onEnter:function(){var H=this.parent;H.onLogin.call(H);}}],buttons:[E(mstrmojo.desc(26,"Login"),function(){var H=this.parent.parent;H.onLogin.call(H);},true),E(mstrmojo.desc(221,"Cancel"),function(){var H=this.parent.parent;H.onLoginCancelled();D.call(H);})]});}());(function(){mstrmojo.requiresClsP("mstrmojo","Editor","desc","css","func","dom","string","hash");mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(221,118,13355);var F=mstrmojo.desc,I=mstrmojo.css,A=mstrmojo.func,H=mstrmojo.dom,L=mstrmojo.string,C=mstrmojo.hash,K=mstrmojo.warehouse.EnumDatabaseType,B=mstrmojo.mstr.EnumDSSXMLObjectTypes,D;mstrmojo.vi.ui.editors.CalculatedMemberEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.CalculatedMemberEditor",cssClass:"mstrmojo-CalculatedMemberEditor",title:F(13355,"Calculated Member"),help:"create_derived_element_mdx_hierarchy_reports.htm",init:function M(N){this._super(N);D=this.id;},onOpen:function E(){this.cmPanel.resetDisplay();},onClose:function J(){delete this.mptf;},addDE:function G(N,V){var W=this.view,P=this.action,S=this.controller,Y=W.model.docModel,R=[],U={},O={},Q=P.oTp===B.Attribute,Z=this.cmPanel,X=Z.parentElement;P.exp=Z.inputBox().getExpression();if(X){P.peId=X.v;P.peName=X.n;}P.deName=Z.deNameTB().value;P.ceid=N;if(Q){P.cid=V;}Y.addUpdateObjects(P,{id:P.oId,type:P.oTp,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE});R.push(S.dataService().getUpdateTemplateAction(W.k,P));if(this.mptf){R.push(S.dataService().getSetMDXPassThroughOptionsForCMAction({mptf:this.mptf,cid:Q?P.cid:P.oId,ceid:P.ceid}));}if(Y.hasSelectionOnVisFilter()&&P.act!=="editQuickDECalculation"){R=Y.wrapUnsetVisualizationFilterAction(R);Y.clearSelectionOnVisFilter(true);}U=A.wrapMethods(U,Y.getDatasetsUpdateCallback(),S._getXtabCallback(W),Y.getUpdateHiddenPanelsCallback(),Y.getUpdateHiddenLayoutsCallback(),Y.getHighLightNDECallback());if(P.isRA){O=mstrmojo.DocDataService.REQUEST_DEFN_DATA;}S.submitUndoRedoUpdates(R,{},U,O);},children:[{scriptClass:"mstrmojo.vi.ui.editors.CalculatedMemberPanel",alias:"cmPanel",isNew:true,slot:"containerNode",getPeInModel:function(){var N=this.parent.action;return N&&{n:N.peName,v:N.peId};},getCmNameInModel:function(){return this.parent.action&&this.parent.action.deName;},getDocModel:function(){return this.parent.controller&&this.parent.controller.model;},getAttributeId:function(){var N=this.getDocModel(),P=this.parent.action&&this.parent.action.oId,O=N.findUnitInDataSet(P);return O&&(O.attId||O.did);}},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-WebButton",text:F(221,"Cancel"),onclick:function(){mstrmojo.all[D].close();}},{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"okBtn",cssClass:"mstrmojo-WebButton",iconClass:"hot",bindings:{enabled:function(){return this.parent.cmPanel.rootVBox.definitionBox.defnPanel.inputBox.expValid&&this.parent.cmPanel.rootVBox.definitionBox.defnPanel.deNameBox.deNameTB.value;}},text:F(118,"Save"),onclick:function(){if(this.enabled){var P=mstrmojo.all[D],O=P.cmPanel.deNameTB().value,Q=P.cmPanel.inputBox().getExpression();if(mstrmojo.vi.ui.editors.DerivedElementsEditor.validateElementName(O)){var N=P.action.oTp===B.Attribute;mstrApp.serverRequest({taskId:"getGUIDs",count:N?2:1},{success:function(R){P.addDE.apply(P,R);P.close();}});}}}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.css","mstrmojo.Button","mstrmojo.TextBox","mstrmojo.imageUtils","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.vi.ui.CoverPageGallery","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");mstrmojo.requiresDescs(15020,15021,15025,15131,15132);var E=mstrmojo.Button.newWebButton,A=mstrmojo.css,L=mstrmojo.imageUtils,C="380px",G="https://demo.microstrategy.com/MicroStrategy/images/Coverpages/16-9/",O=["22.jpg","23.jpg","24.jpg","25.jpg","26.jpg","27.jpg","28.jpg","29.jpg","30.jpg","31.jpg","32.jpg","33.jpg","34.jpg","35.jpg","36.jpg","37.jpg","38.jpg","39.jpg","40.jpg","41.jpg","42.jpg","43.jpg","44.jpg","45.jpg","46.jpg","47.jpg","48.jpg","49.jpg","50.jpg","51.jpg","52.jpg","53.jpg"],F=[];O.forEach(function(P){F.push({src:G+P});});function I(){var P=this,Q=P.urlBox.value;P.hideWarning();P.onSave(Q,Q!==P.originURL,P.urlAccesible);P.afterSave();}mstrmojo.vi.ui.editors.CoverPageEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.vi.ui.editors.CoverPageEditor",cssClass:"mstrmojo-vi-ui-editors-CoverPageEditor",btnAlignment:"right",urlBox:undefined,originURL:"",title:mstrmojo.desc(15020,"Change Cover"),urlAccesible:true,isTooltipAllowed:true,init:function N(P){this._super(P);this.bindWarningHandler(this);},postBuildRendering:function(){if(this._super){this._super();}this.urlBox.focus();},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15131,"Paste an image URL:")},{scriptClass:"mstrmojo.TextBox",alias:"urlBox",cssClass:"urlBox",width:C,onEnter:function D(){if(this._super){this._super();}var Q=this,P=Q.parent;P.hideWarning();L.isImageAccessible(this.value,{success:function(){P.urlAccesible=true;},failure:function(){P.urlAccesible=false;P.set("validation",{refNode:Q.domNode,position:2,invalid:true,errorMsg:mstrmojo.desc(15021,"Sorry, this image cannot be loaded, either because the URL is not valid, or there is no internet connection. Please enter a valid URL, and make sure the internet is connected."),errorCode:null,closeOnClick:false});}});P.gallery.set("selectedImgURL",this.value);},onvalueChange:function K(){if(this._super){this._super();}var Q=this,P=Q.parent;P.hideWarning();P.btnHbox.saveButton.set("enabled",true);},onblur:function H(){var P=this;window.setTimeout(function(){if(P.parent.isTooltipAllowed){P.onEnter();}},200);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15132,"or select a sample image:")},{scriptClass:"mstrmojo.vi.ui.CoverPageGallery",height:"320px",width:C,alias:"gallery",onimageSelected:function J(Q){var P=this.parent;P.urlBox.set("value",Q);A.toggleClass(P.urlBox.domNode,"changing",false);if(window.requestAnimationFrame){window.requestAnimationFrame(function(){A.toggleClass(P.urlBox.domNode,"changing",true);});}}}],buttons:[E(mstrmojo.desc(118,"Save"),function(){var P=this.parent.parent;P.isTooltipAllowed=false;L.isImageAccessible(P.urlBox.value,{success:function(){P.urlAccesible=true;},failure:function(){P.urlAccesible=false;}});window.setTimeout(function(){I.call(P);},50);},true,{alias:"saveButton"}),E(mstrmojo.desc(221,"Cancel"),function(){var P=this.parent.parent;P.isTooltipAllowed=false;P.onCancel();P.afterCancel();})],onOpen:function B(){this.gallery.set("imageList",F);this.urlBox.set("value",this.originURL);this.btnHbox.saveButton.set("enabled",false);this.isTooltipAllowed=true;},onSave:mstrmojo.emptyFn,afterSave:mstrmojo.emptyFn,onCancel:mstrmojo.emptyFn,afterCancel:mstrmojo.emptyFn,close:function M(){this._super();this.hideWarning();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor");mstrmojo.vi.ui.editors.ConfirmSaveEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ConfirmSaveEditor",cssClass:"mstrmojo-ConfirmSave-Editor",title:mstrmojo.desc(11812,"Notification"),help:null,children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15477,"Do you want to save your dossier before continuing?"),cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton nosave",text:mstrmojo.desc(11814,"Don't Save"),onclick:function(){this.editor.onDonotSave();},bindings:{editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),onclick:function(){this.editor.onSave();},bindings:{editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.onCancel();},bindings:{editor:"this.parent.parent"}}]}],onSave:mstrmojo.emptyFn,onDonotSave:mstrmojo.emptyFn,onCancel:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo.Box","mstrmojo.HBox","mstrmojo.Button","mstrmojo.Label","mstrmojo.TextArea","mstrmojo.Editor","mstrmojo.ui._HasScroller","mstrmojo.ui.ScrollableContainer");var D=mstrmojo.dom,C=mstrmojo.Button.newWebButton,E=mstrmojo.array,G=mstrmojo.css,H=mstrmojo.string;mstrmojo.vi.ui.editors.SQLCSIViewer=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.editors.SQLCSIViewer",title:mstrmojo.desc(15619,"Query Details"),cssClass:"mstrmojo-charcoalboxe mstrmojo-SQLV mstrmojo-vi-ui-SQLV",csiText:"",copied:false,onOpen:function A(){this.set("copied",false);this.updateScrollbars();},oncsiTextChange:function F(J){this.content.csiTextLabel.set("text",H.encodeHtmlString(J.value));this.updateScrollbars();},setupScrollNodes:function B(){this.scrollNode=this.content.containerNode;},children:[{scriptClass:"mstrmojo.Box",alias:"content",cssClass:"mstrmojo-SQLV-content-container",cssText:"",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="scroll-container" style="overflow:hidden;"></div><textarea name="csi_text" style="position:absolute;top:0;right:10000px"></textarea></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},csiInputNode:function(){return this.domNode.lastChild;}},slot:"containerNode",csiTextLabel:undefined,children:[{scriptClass:"mstrmojo.Label",alias:"csiTextLabel",allowHTML:false,text:""}]},{alias:"buttonBar",scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",children:[{alias:"successIcon",cssClass:"success-icon",scriptClass:"mstrmojo.Label",bindings:{visible:"this.parent.parent.copied"}},{alias:"successTooltip",cssClass:"notice-toaster-label",scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15620,"Statement Copied to Clipboard"),bindings:{visible:"this.parent.parent.copied"}},C(mstrmojo.desc(14502,"Copy to Clipboard"),function I(){var M=this.parent.parent,L=M.content.csiInputNode;L.innerText=M.csiText;L.select();try{var K=document.execCommand("copy");M.set("copied",K);}catch(J){}},false,{cssClass:"copy-button",alias:"btnCopy"}),C(mstrmojo.desc(2102,"Close"),function I(){this.parent.parent.close();},false,{alias:"btnClose"})]}]});})();(function(){mstrmojo.requiresClsP("mstrmojo","Editor","HBox","Box","Button","dom","css","desc","hash","array");mstrmojo.requiresCls("mstrmojo.vi.controllers.CustomSortModeActionMgr");var R=mstrmojo.Button.newWebButton,G=mstrmojo.dom,Z=mstrmojo.css,J=mstrmojo.desc,M=mstrmojo.array,P=mstrmojo.hash,L=36,A=600;mstrmojo.requiresDescs(1442,221,5705,134);function I(){var e=this.vizBox=this.model.createVizBoxForCustomSort(this.nodeKey,{width:this.width,height:(parseInt(this.height)-L-this.spacer)+"px",left:"0px",top:this.spacer+"px"});this.visContainer.addChildren(e);var c=e.boxContent.controller,d=c.model.oid,f=d+"."+(this.oldNodeKey||this.srcViz.k),h=(c.getScrollPosition(f))||{x:0,y:0},g=d+"."+this.nodeKey;c.addScrollPosition(g,h.x,h.y);return e;}function O(){var d=this.titleContainerNode,c=d.style,e=G.position(d);if(e.w<A){c.width=A+"px";c.position="relative";c.left=(e.w-A)/2+"px";c.border="solid 1px rgba(68,70,73,0.2)";}}function V(){var e=G.position(mstrApp.rootCtrl.view.domNode),d=G.position(this.titleContainerNode),c=G.position(this.editorNode),f;if(e.w>=d.w){if(d.x<e.x){f=c.x-d.x;this.set("left",(e.x+f)+"px");}else{if(d.x+d.w>e.x+e.w){f=d.x+d.w-(c.x+c.w)+8;this.set("left",(e.x+e.w-c.w-f)+"px");}}}}function Q(){var c=this.editorNode.style;c.width=this.width;c.height=this.height;}function N(){this.vizBox.toggleBoxSelection(true);}function b(h){var e=this.actionMgr.getSlientActionsBefore();if(e.length>0){var f=M.map(e,function(j){return j&&j.submitAction;}),g=this.wrapCustomSortAction(f,false),d=this.srcViz,c={hideCancel:true};d.model.customSort(g,d.controller._getXtabCallback(d,P.copy(h)),c);}}function a(){var d=this.actionMgr.getContSlientActionsBefore(),c=this,e={success:function(f,h){if(d.length>0){var k=M.map(d,function(n){return n&&n.submitAction;}),m=c.wrapCustomSortAction(k,true),j=c.vizBox.boxContent,g={hideCancel:true,noUpdate:true,preserveStid:true,noDeltaXML:true},l=j.model.getDataService();l.submitUpdates(l.getUpdateTemplateAction(j.k,m),j.controller._getXtabCallback(j),g);}}};b.call(this,e);}mstrmojo.vi.ui.rw.CustomSortDisplayPanel=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.rw.CustomSortDisplayPanel",cssClass:"mstrmojo-CustomSortDisplayPanel",actionMgr:null,init:function S(c){this.actionMgr=new mstrmojo.vi.controllers.CustomSortModeActionMgr({csDisplayPanel:this});this._super(c);},postBuildRendering:function U(){this.getVizBox();var e=this._super();if(!this._listenerProc){var d=this,f=null,c=this._listenerProc=function(g){window.clearTimeout(f);f=window.setTimeout(function(){V.call(d);},150);};G.attachEvent(window,"resize",c);}return e;},destroy:function Y(c){if(this._listenerProc){G.detachEvent(window,"resize",this._listenerProc);}this._super(c);},children:[{scriptClass:"mstrmojo.HBox",slot:"titlebarNode",alias:"leftBox",cssClass:"left title",children:[{scriptClass:"mstrmojo.Label",text:J(5705,"Custom Sort")}]},{scriptClass:"mstrmojo.HBox",slot:"titlebarNode",alias:"urBox",cssClass:"left icons",children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id="{@id}" class="icn {@cssClass}" mstrAttach:click></div>',alias:"undo",cssClass:"undo disabled",enabled:false,onclick:function(){if(this.enabled){var c=this.parent.parent;c.actionMgr.undo();}},bindings:{enabled:function(){return !!this.parent.parent.canUndo;}},onenabledChange:function(){Z.toggleClass(this.domNode,"disabled",!this.enabled);}},{scriptClass:"mstrmojo.Widget",alias:"redo",cssClass:"redo disabled",enabled:false,markupString:'<div id="{@id}" class="icn {@cssClass}" mstrAttach:click></div>',onclick:function(){if(this.enabled){var c=this.parent.parent;c.actionMgr.redo();}},bindings:{enabled:function(){return !!this.parent.parent.canRedo;}},onenabledChange:function(){Z.toggleClass(this.domNode,"disabled",!this.enabled);}}]},{scriptClass:"mstrmojo.HBox",slot:"titlebarNode",alias:"btnBox",cssClass:"btnBox",children:[R(J(1442,"OK"),function(){if(this.enabled){var c=this.parent.parent;c.removeCSViz(function(){b.call(c);c.close();},false);}},true,{alias:"savebtn",enabled:false,bindings:{enabled:function(){return this.parent.parent.canApply;}}}),R(J(134,"Apply"),function(){if(this.enabled){var c=this.parent.parent,d=c.actionMgr;a.call(c);d.appendHistUnsilentActions(d.getUnslientActionsBefore());d.reset();}},true,{enabled:false,bindings:{enabled:function(){return this.parent.parent.canApply;}}}),R(J(221,"Cancel"),function(){var c=this.parent.parent;c.removeCSViz(null,true);c.close();})]},{scriptClass:"mstrmojo.Box",alias:"visContainer",slot:"containerNode"}],oldNodeKey:null,nodeKey:null,vizBox:null,model:null,srcPanelKey:null,srcLayoutKey:null,srcViz:null,srcUnit:null,srcAxis:-1,getVizBox:function D(){return this.vizBox=this.vizBox||I.call(this);},setVizBoxPortalStateRestore:function K(){this.getVizBox().defn.ds=0;},onOpen:function H(){Q.call(this);O.call(this);N.call(this);V.call(this);var d=this.vizBox.boxContent,c=d.selCells||[];M.forEach(c,function(e){d.handleSelection({},null,e);d.clearHighlights();});},onClose:function E(){var d=this.vizBox,c=this.model;if(d.boxContent.cellHoverMgr.removeCue){d.boxContent.cellHoverMgr.removeCue();}mstrmojo.dnd.enable();delete this.actionMgr;delete this.silentMask;this.destroy();},removeCSViz:function F(h,g){var d=this.model,e,c;if(g){e={config:{silent:true}};}else{e={hideCancel:true};}e.style={params:{treesToRender:0}};e=P.copy({noUpdate:true,preserveStid:true,noDeltaXML:true},e);if(h){c={success:function(){h();}};}var f=d.getRemoveUnitAction(this.vizBox);f.clearTargets=true;d.getDataService().submitUpdates(f,c,e);},recreateCSVizForUndo:function X(n,m,p){var q=this.model,r=this.srcViz.model,o=r.getDataService(),d=q.getNextKey(),e,l=this;var c=q.getRemoveUnitAction(this.vizBox);c.clearTargets=true;e=[c];var f=0,g=n.length,k;if(f<g){k=n[f];f++;}e=e.concat(r.getCreateCSVizActions(this.srcUnit,this.srcAxis,d,k));var j=function(z){var v=l.srcLayoutKey,t=l.srcPanelKey,w=z.data,u=M.filterOne(w.layouts,function(AC){return AC.k===v;});q.controller.view.updateXtabStyles(v,u.xtabStyles);q.updateDefnCache(z.defn,[d,t]);q.updateDataCache(w,q.getTargetDefn(d));l.oldNodeKey=l.nodeKey;l.nodeKey=d;l.vizBox.destroy();delete l.vizBox;l.setVizBoxPortalStateRestore();var AA=l.getVizBox();AA.render();var x=0,AB=(m||[]).length,s=function(){if(x<AB){m[x++].perform(false,s,true);}else{mstrApp.hideWait(true);var AD=l.actionMgr;if(AD.hasFailedSorts()){var AC=AD.getActionsCount()-AD.getFailedSortsCount();AD.actions.splice(AC);AD.pos=AC-1;l.updateStatus();AD.showFailedSortsAndReset();if(p&&p.fail){p.fail();}}else{if(p&&p.success){p.success();}}}};s();},h=function(){o.submitUpdates(e,{success:function(s,t){if(f<g){e=o.getUpdateTemplateAction(d,n[f]);f++;h();}else{j(s);}}},{style:{params:{treesToRender:3}},noUpdate:true,preserveStid:true,noDeltaXML:true,hideCancel:true});};h();},wrapCustomSortAction:function B(g,e){var f=this.srcUnit,d=e?1:this.srcAxis,c=1,h=this.srcViz.model.data.gts[((this.srcAxis===c)?"row":"col")+"SubPos"];return{act:"customSortAddActions",unitType:f.otp,unitId:f.id,axis:d,subTotalsPos:[h],actions:g};},maskSilently:function W(c){var f=this.silentMask;if(!f){var e=this.curtainNode,d=document.createElement("div");d.innerHTML=e.outerHTML;d.firstChild.style.zIndex=this.zIndex+1;d.firstChild.style.opacity="0";d.firstChild.style.display="none";f=this.silentMask=this.domNode.appendChild(d.firstChild);}f.style.display=c?"block":"none";},updateStatus:function C(){var c=this.actionMgr;this.set("canUndo",c.pos>=0);this.set("canRedo",(c.actions.length-1)>c.pos);this.set("canApply",c.getSlientActionsBefore().length>0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.array");mstrmojo.requiresDescs(15677,15678,15679,15681,15682,15683,15684);var C=mstrmojo.Button.newWebButton,B={discard:0,open:2,closed:4};mstrmojo.vi.ui.editors.PromptOptionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.PromptOptionEditor",cssClass:"mstrmojo-PromptOptionEditor-Editor",title:mstrmojo.desc(15681,"Change Prompt Option and Save"),help:null,optVal:B.open,children:[{scriptClass:"mstrmojo.Box",cssClass:"icon-box"},{scriptClass:"mstrmojo.Box",alias:"box",children:[{scriptClass:"mstrmojo.Label",cssClass:"prompt-confirm",text:mstrmojo.desc(15682,"We have detected that this dossier contains prompts. Please confirm your prompt option.")},{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",col1Width:"20%",col2Width:"80%",cssClass:"chkBox",alias:"chkBox",children:[{scriptClass:"mstrmojo.ui.Checkbox",cssDisplay:"inline-block",slot:"col1Node",alias:"chk",oncheckedChange:function D(){var G=this.parent.parent,F=G.optPrompt,H=G.defaultLabel;F.set("visible",this.checked);H.set("visible",!this.checked);}},{scriptClass:"mstrmojo.Label",slot:"col2Node",text:mstrmojo.desc(15677,"Display prompt when opening this dossier")}]},{scriptClass:"mstrmojo.ui.CheckList",alias:"optPrompt",multiSelect:false,orientation:"v",selectedIndex:0,items:[{n:mstrmojo.desc(15678,"And use current answers as default answers"),v:B.open},{n:mstrmojo.desc(15679,"And discard current answers"),v:B.discard}]},{scriptClass:"mstrmojo.Label",alias:"defaultLabel",cssClass:"indent",text:mstrmojo.desc(15683,"It will use current answer as default answer")}]},{alias:"buttonBar",scriptClass:"mstrmojo.Box",slot:"buttonNode",children:[C(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.close();}),C(mstrmojo.desc(15684,"Confirm and Save"),function(){var G=this.parent.parent,H=G.box,F=H.chkBox.chk;G.optVal=F.checked?(H.optPrompt.selectedIndex===0?B.open:B.discard):B.closed;G.onSave();G.close();},true)]}],onOpen:function A(){var G=this.box,F=G.chkBox.chk,I=G.optPrompt,H=G.defaultLabel;F.set("checked",this.optVal!==B.closed);I.set("visible",F.checked);I.set("selectedIndex",this.optVal===B.discard?1:0);H.set("visible",!F.checked);H.set("enabled",false);},onSave:mstrmojo.emptyFn,onClose:function E(){this.destroy();}});mstrmojo.vi.ui.editors.PromptOptionEditor.OptValue=B;}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.TextBox","mstrmojo.vi.ui._IsValidURL");mstrmojo.vi.ui.TextBoxURLEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.vi.ui._IsValidURL],{scriptClass:"mstrmojo.vi.ui.TextBoxURLEditor",showTitle:false,autoClose:true,cssClass:"textBoxURLEditor",model:null,docControl:null,children:[{scriptClass:"mstrmojo.TextBox",width:"400px",height:"43px",alias:"text",layoutConfig:{h:{inputNode:"43px",searchNode:"20px"},w:{inputNode:"100%",searchNode:"0px"},xt:true},onkeyup:mstrmojo.emptyFn()}],onOpen:function B(){var C=this;window.setTimeout(function(){C.text.inputNode.focus();},10);},onClose:function A(){var G=this.quill,D=G&&G.quillInstance,F=this.text,I=F.inputNode.value,E=G.hlText,H=E.index,C=E.length;if(G&&F&&I&&E){G.renderRVText();G.parent.hideControlOverlay();if(this.isValidURL(I)){D.formatText(H,C,"link",I);}G.updatedirCachDel();G.onUnselected();}if(this._super){this._super();this.destroy();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocImage","mstrmojo.HBox","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo._HasDocLink","mstrmojo.css","mstrmojo.dom","mstrmojo.DocDataService","mstrmojo.vi.models.EnumFieldTypes");var F=mstrmojo.dom;var P=-1,e=0,b=1,K=2,O=3,E=4,a=mstrmojo.boxmodel.px2Inches,f=mstrmojo.models.FormatModel,N=f.ENUM_PROPERTY_NAMES,G=mstrmojo.vi.models.EnumFieldTypes,R=function R(){var g=this.domNode;if(!g){return ;}mstrmojo.css.toggleClass(g,"hasLink",this.hasActiveLink());},d=function d(){var h=this.imgNode.firstChild;this.originalImgDim={w:h.naturalWidth,h:h.naturalHeight};var g=this.getCalculatedImageDimensions();this.defn.ih=this.imgNode.style.height=g.h+"px";this.defn.iw=this.imgNode.style.width=g.w+"px";if(g.ml){this.imgNode.style.marginLeft=g.ml+"px";}if(g.mt){this.imgNode.style.marginTop=g.mt+"px";}};function I(){if(this._isNewUrl){Y.call(this);delete this._isNewUrl;}else{if(this._isNewEmbeddedImg){V.call(this);delete this._isNewEmbeddedImg;}}d.call(this);this.set("imgReady",true);}function c(g,l){var j=this.parent,p=this.imgNode.firstChild,r=this.model.getZoomProps(),h={},q=f.getFormatUpdate,o=p.naturalHeight,k=p.naturalWidth,n,m;if(o===0||k===0){n="30";m="30";}else{n=o;m=k;}q(N.IMAGE_HEIGHT,a(r,parseFloat(n)),h);q(N.IMAGE_WIDTH,a(r,parseFloat(m)),h);j.model.editField(j,G.IMAGE,{success:function(){j.selectVIUnit(true);}.bind(this)},g,l,{actions:[this.model.getUnitFormatAction(this,1,h,true)],extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA});}function V(){c.call(this,"","");}function Y(){c.call(this,this.v,null);}mstrmojo.vi.ui.rw.DocImage=mstrmojo.declare(mstrmojo.DocImage,[mstrmojo._HasDocLink],{scriptClass:"mstrmojo.vi.ui.rw.DocImage",markupString:'<div id="{@id}" class="mstrmojo-DocImage {@imgStateClass}" style="{@domNodeCssText}" mstrAttach:dblclick><div class="img-cntr"><img src="{@en@v}" mstrAttach:load,error><div mstrAttach:click></div></div>{@buttonNodeMarkup}</div>',markupMethods:{onheightChange:function L(){this.domNode.style.height=this.height;},onwidthChange:function M(){this.domNode.style.width=this.width;},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},formatHandlers:{domNode:["BG"]},originalImgDim:undefined,model:undefined,onload:function Z(){I.call(this);},onerror:function C(){I.call(this);},ondblclick:function H(g){this.cancelDocLink=true;if(!mstrApp.isAppStatePresentation()){this.parent.switchToEditMode();}if(this._super){this._super(g);}},update:function J(n){var m=this;var h=this._super;var k=function(){h.call(this,n);var p=this.parent;if(p){p.updateOverlay();}R.call(this);}.bind(this);var l=n&&n.defn&&n.defn.oid;if(l){var g=n.defn.fmts,j=g&&g["img-name"];if(this.parent&&j){this.parent.embeddedImageName=decodeURIComponent(j);}this.loadImage(n,function o(){k();m.refresh();});}k();},loadImage:function D(h,k){if(mstrApp.isSingleTier){var g={taskId:"getRWEmbeddedImage",fieldKey:h.k,oid:h.defn.oid};var l={success:function(m){if(m&&m.imageData){h.data.v=m.imageData;}k();}};mstrApp.serverRequest(g,l);}else{var j=this.model.getDataService();h.data.v=mstrConfig.taskURL+"?taskId=getRWEmbeddedImage&msgID="+j.msgId+"&oid="+h.defn.oid;}},postBuildRendering:function X(){this._super();R.call(this);d.call(this);},unrender:function W(g){this.clearCache();this._super(g);},isAspectRatioLocked:function A(){return this.defn.lock;},getSizeMode:function U(){return this.defn.ism;},getImageWidth:function Q(){return this.defn.iw;},getImageHeight:function B(){return this.defn.ih;},updateDimensionsFromFormats:mstrmojo.emptyFn,getCalculatedImageDimensions:function S(k){k=k||{mode:this.getSizeMode(),iw:parseFloat(this.getImageWidth()),ih:parseFloat(this.getImageHeight()),lock:this.isAspectRatioLocked()};var u={},p=this.parent,t=this.originalImgDim,m=k.mode;if(!t||!p.width){return u;}var j={w:parseFloat(p.width),h:parseFloat(p.height)};var o=(t.h!==0)?t.w/t.h:1,s=j.w/j.h;switch(m){case P:case b:var h=k.iw,n=k.ih;if(k.lock&&(h!==undefined||n!==undefined)&&(t.h!==0&&t.w!==0)){var r=n===undefined;if(r){u.w=h;u.h=(h/o).toFixed(0);}else{u.h=n;u.w=(n*o).toFixed(0);}}else{u.w=h;u.h=n;}break;case K:case O:var l=((m===O&&(o>s))||(m===K&&(o<s))),g=F.isFF;if(l){u.h=j.h;u.w=parseInt(j.h*o);if(g){u.ml=parseFloat((j.w-u.w)/2);}}else{u.w=j.w;u.h=parseInt(j.w/o);if(g){u.mt=parseFloat((j.h-u.h)/2);}}break;case E:case e:var q=m===E?j:t;u.w=q.w;u.h=q.h;break;default:break;}return u;}});mstrmojo.vi.ui.rw.DocImage.EnumSizeModes={ORIGINAL:e,FIT_TO_CONTAINER:K,FILL_CONTAINER:O,STRETCH:E,FIXED:b};mstrmojo.vi.ui.rw.DocImage.ImgDimConfigType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.ScrollableDocTextfield","mstrmojo._HasEditableText","mstrmojo.vi._MonitorsAppState","mstrmojo._HasDocLink","mstrmojo.string","mstrmojo.css","mstrmojo.dom");var A=mstrmojo.dom,S=mstrmojo.css;function C(V){return V.data.dl||V.defn.dl;}function O(V){this.getAnchor()[A.isFF?"textContent":"innerText"]=V;}function N(){S.toggleClass(this.domNode,"hasLink",this.hasActiveLink());}function P(){var X=this.defn.fmts,W,V,Z=0,Y=this.valueNode.className.indexOf(" hasVertical ")>-1;if(X&&(X.font||"").split(" ").indexOf("italic")>=0&&(X["text-align"]||"").toLocaleLowerCase()==="right"){W=(X.font||"").match(/([0-9]+)[,\.]?[0-9]*pt/);W=(W&&W[1])||8;V=this.valueNode&&this.valueNode.style;Z=Math.round(W/3)+(Y?30:0);V.paddingRight=Z+"px";}return Z;}mstrmojo.vi.ui.rw.DocTextfield=mstrmojo.declare(mstrmojo.vi.ui.ScrollableDocTextfield,[mstrmojo._HasEditableText,mstrmojo.vi._MonitorsAppState,mstrmojo._HasDocLink],{scriptClass:"mstrmojo.vi.ui.rw.DocTextfield",markupString:'<div id="{@id}" class="mstrmojo-DocTextfield {@cssClass}" style="{@domNodeCssText}"><div class="mstrmojo-DocTextfield-valueNode" style="{@valueNodeCssText}" mstrAttach:click ><div class="vi-doc-tf-value-text">{@en@v}</div></div>{@buttonNodeMarkup}</div>',editableSlot:"valueTextNode",editOnClick:false,editOnDoubleClick:true,allowEmptyText:true,allowNewLine:true,formatHandlers:{domNode:["background-color"],valueNode:["F","fx","text-align","white-space"]},markupSlots:{valueNode:function F(){return this.domNode.firstChild;},valueTextNode:function F(){return this.domNode.firstChild.firstChild;}},update:function H(X){delete this.fmts;this._super(X);this.text=this.v;var V=C(X);if(V){this.tooltip=V.items[0].n;}var W=this.parent;if(W){W.updateOverlay();}N.call(this);},postBuildRendering:function R(){if(mstrApp.isAppStatePresentation()&&this.node&&this.node.data&&this.node.data.v){this.text=this.node.data.v;}this._super();this.attachEventListener("renderComplete",this.id,function(){P.call(this);}.bind(this));N.call(this);if(this.getFormats().overflow==="auto"&&!this.hasCustomScrollbar){this.valueTextNode.style.overflow="auto";}},getAnchor:function B(){return this.valueTextNode;},getRawText:function I(){return this.node.data.rv||this.v;},ondblclick:function G(V){this.cancelDocLink=true;if(!this.isEditing&&mstrApp.isAppStatePresentation&&!mstrApp.isAppStatePresentation()){O.call(this,this.getRawText());this._super(V);}},onTextEditComplete:function L(W,V){if(W){this.parent.textEdited(this.text,W,V);this.updateScrollbars();}else{O.call(this,this.v);}if(!this.text){this.parent.updateOverlay();}},unrender:function Q(V){this.clearCache();this.isEditing=false;this._super(V);},setupScrollNodes:function J(){var V=this.getFormats();if(!V.overflow||V.overflow==="auto"){this.scrollNode=this.valueTextNode;}},updateScrollbars:function U(){this._super();if(this.scrollNode&&parseInt(this.height,10)<=24){var V=this.getDefaultScrollBarProps("v");S.toggleClass(this.scrollNode.parentNode,V.hostCls,false);S.toggleClass(this.scrollNode,V.scrollNodeCls,false);}},handleRotatedText:function E(){if(this.isTextFieldRotated()){this.valueNode.style.cssText="";window.setTimeout(function(){if(this.hasRendered){this.valueNode.style.cssText=this.valueNodeCssText;var a="px",W=this.getFormats(),V=this.valueNode,c=V.style,Y=W.fx&&W.fx.rt,b=V.offsetWidth,X=V.offsetHeight,Z=P.call(this);switch(Y){case 1:c.left=b+a;break;case 3:c.top=X-1+a;break;}c.height=b+a;c.width=X-Z+a;}}.bind(this),0);}},onAppStateChange:function M(V){var X=mstrApp.isAppStatePresentation(),W=mstrApp.isAppStatePause();this.editOnClick=this.editOnDoubleClick=!X;this.isEditing=!X&&!W;},onisEditingChange:function D(V){this._super(V);this.parent.set("useRichTooltip",!V.value);if(this.isEditing){this.parent.hideLinkButton();}else{this.parent.unhideLinkButton();}},canShowContentTooltip:function K(X,W){var V=A.eventTarget(W,X);return V===this.valueNode||V===this.valueTextNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.IconTabList","mstrmojo.vi.ui._HasMask","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.css");var K=mstrmojo.dom,N=mstrmojo.hash,c=mstrmojo.array,D=mstrmojo.css,q="hidden",A="drop-shadow",u="highlightSelected",v="fadeout";function p(){return(this.children||[]).filter(function(w){return w.slot==="containerNode";});}function h(w){return w.src.data.tabInfo;}function l(w){return(this.children||[]).filter(function(x){return x.alias===w.item.id;})[0];}function m(x,w){D.toggleClass(x.src.data.avatar,q,!w);}function J(w){this.tabList.removeTab(w.alias);this.removeChildren(w);}function o(){K.detachEvent(document,"mousemove",this._checkAndExtractTab);delete this._checkAndExtractTab;}function V(x,z){var w=this.tabList;w.exitDragMode(x);J.call(this,x.panel);m(z,true);if(!x.extractedFromSrcBPC){x.extractedFromSrcBPC=true;o.call(this);}}function I(x,z){this.resetMask();m(z,false);this.addChildren([x.panel]);var w=this.tabList;N.copy(w.addTab(x.item,NaN,true),x);w.enterDragMode(x,z);}function S(w){return w.some(function(x){return x instanceof mstrmojo.vi.ui.VIBoxPropertyEditor;});}mstrmojo.vi.ui.BoxPanelContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.BoxPanelContainer",markupString:'<div id="{@id}" class="mstrmojo-VIBoxPanelContainer {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-VIBoxPanelContainer-header"><div class="mstrmojo-VIBoxPanelContainer-handle"><div mstrAttach:click></div></div><div class="mstrmojo-VIBoxPanelContainer-tabs"></div><div class="mstrmojo-VIBoxPanelContainer-closeBtn enable" tooltip="'+mstrmojo.desc(1995,"Hide")+'"></div></div><div class="mstrmojo-VIBoxPanelContainer-content"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{headerNode:function(){return this.domNode.firstChild;},handleNode:function(){return this.domNode.firstChild.firstChild;},tabsNode:function(){return this.domNode.firstChild.childNodes[1];},closeNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},layoutConfig:{h:{handleNode:"11px",tabsNode:"18px",containerNode:"100%"},w:{handleNode:"100%",tabsNode:"100%",containerNode:"100%"},xt:true},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},draggable:true,dropZone:true,headerNode:null,tabsNode:null,tabList:null,model:null,parent:null,slot:"containerNode",children:[{scriptClass:"mstrmojo.vi.ui.IconTabList",slot:"tabsNode",alias:"tabList",selectedIndex:0,tabSelected:function(z){var x=this.parent,w=x.parent;p.call(x).forEach(function(AB){var AA=AB.alias===z.id;AB.set("visible",AA);if(AA){AB.doLayout();}});this.parent.ontabSelected();if(w){w.model.updateRootDefn({root:{layoutXML:w.getBoxLayoutConfig().box}});}}}],init:function r(w){this._super(w);if(!!mstrApp.isWSStyling){this.layoutConfig={h:{handleNode:"11px",tabsNode:"23px",containerNode:"100%"},w:{handleNode:"100%",tabsNode:"100%",containerNode:"100%"},xt:true};}this.tabList.attachEventListener("click",this.id,function(x){var AA=x.src.getItemFromTarget(x.getTarget());var z;if(AA!=null){this.parent.model.raiseEvent(N.copy({name:"viIconTabClicked",id:AA.id},z));}});this.model.attachEventListener("viUnitSelected",this.id,function(x){var AB=mstrmojo.all[x.id],AC=mstrmojo.vi.ui.rw.DocLayoutViewer.getViPanelType,z=null;if(x.isAddAction){z=this[AC(AB.getPanelForAddAction())];}else{var AA=AB?AB.getExcludedPanels().map(function(AE){return AC(AE);}):[];if(AA.indexOf(this.tabList.getSelectedItems()[0].id)>-1){var AD=mstrmojo.vi.ui.BoxPanel.PANEL_TYPES;Object.keys(AD).some(function(AF){var AG=AD[AF],AE=this[AG];if(AE&&AA.indexOf(AG)<0){z=AE;return true;}return false;},this);}}if(z){this.selectPanel(z);}});},postBuildRendering:function R(){if((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())){this.draggable=false;}this.toggleCloseButton(!mstrApp.isInVFConfigMode);this._super();},onRender:function(){if(this._super){this._super();}this.set("isMasked",mstrApp.isAppStateSelection());},toggleCloseButton:function(w){D.toggleClass(this.closeNode,"enable",w);},onAppStateChange:function k(w){this._super(w);var x=mstrApp.isAppStateSelection();this.set("isMasked",x);this.draggable=!(mstrApp.isAppStatePresentation()||mstrApp.isLayoutModePreview()||x);},onLayoutModeChange:function L(w){this.draggable=!(mstrApp.isAppStatePresentation()||mstrApp.isLayoutPreview(w.value)||mstrApp.isAppStateSelection());},getIdentifier:function t(){return this.tabList.getTabIds();},getDragData:function f(x){var AA={},z=x.src.node;if(K.contains(this.tabsNode,z,true,this.domNode)){var w=this.tabList.getDragTabInfo(z);if(w){w.panel=l.call(this,w);AA.tabInfo=w;w.extractedFromSrcBPC=false;}}return AA;},isDragValid:function U(w){return K.contains(this.headerNode,w.src.node,true,this.domNode);},ondragstart:function j(w){if(!h(w)){this.domNode.style.display="none";}this._super(w);},initializeDrag:function B(x){this._super(x);var w=h(x);if(w){if(w.isSingleTab){this.set("visible",false);V.call(this,w,x);}else{this.tabList.enterDragMode(w,x);}}var z=this;this._checkAndExtractTab=function AA(){var AB=h(x);if(AB&&!AB.extractedFromSrcBPC&&x.tgt&&z!==x.tgt.widget){V.call(z,AB,x);}};K.attachEvent(document,"mousemove",this._checkAndExtractTab);},createAvatar:function X(AC,AA){var AD=AA.src.data,w=AD.tabInfo,AB=mstrApp.rootCtrl.view.themeClassName;var z=document.createElement("div");z.className=this.domNode.className+" panelAvatar";z.style.width=this.width;var x=this.headerNode.cloneNode(true);if(w){var AE=Array.prototype.slice.call(x.getElementsByClassName("item"),0);if(w.isSingleTab){D.addClass(AE[0],"selected");}else{AE.forEach(function(AF){if(AF.className.indexOf("selected")===-1){AF.parentNode.removeChild(AF);}else{AF.style.left=0;}});}}z.appendChild(x);D.addClass(z,AB);AD.avatar=z;m(AA,!w||w.isSingleTab);return this.offsetAvatar(z);},cacheCtxtBoxPosition:function n(z){this._super(z);if(h(z)){var AA=z.boxCache[this.id],x=K.position(this.tabsNode),w=x.y;AA.tabTop=w;AA.tabBottom=w+x.h;}},getTargetDropZone:function a(AA){var AC=this._super(AA),AB=AA.boxCache[this.id],z=AA.tgt.pos.y,x=this.parent.boxLayoutConfig.getBoxPath(this).indexOf("|")>-1,w=z-AB.y<AB.h/2;if(h(AA)){if(z<AB.tabTop){return"Top";}else{if(z<AB.tabBottom){return"Tab";}else{if(x){return w?"Tab":"Bottom";}else{if(AC==="Top"){return"Tab";}return AC;}}}}if(x){return w?"Top":"Bottom";}return AC;},highlightMask:function F(AA,x){var w=h(x);if(w){var z=w.active;if(AA==="Tab"){if(!z){I.call(this,w,x);}this.tabList.dragTab(w,x);return true;}if(z){V.call(this,w,x);}}return this._super(AA,x);},ondragleave:function O(x){this._super(x);var w=h(x);if(w&&w.active){V.call(this,w,x);}},wasDropped:function e(z){var x=h(z);if(x){if(!x.active){var w=new mstrmojo.vi.ui.BoxPanelContainer({model:this.model}),AA=z.box;delete AA.initState;AA.boxId=w.id;this.parent.addChildren([w]);w.addPanel(x.item,x.panel,x.idx,true);}}this._super(z);},ondrop:function b(z){var x=h(z);if(x){if(x.active){var w=this.tabList;w.pivotTab(x);w.exitDragMode(x);this.doLayout();z.dropSuccessful=true;this.parent.saveBoxLayout();this.setMaskVisibility(false);return ;}z.box.parentPath+="x";}this._super(z);},ondragend:function E(x){if(!h(x)){this.domNode.style.display="block";}this._super(x);if(x.dropSuccessful){var w=p.call(this);if(!w.length){this.parent.removeChildren(this);this.destroy();}}o.call(this);},cancelBoxMove:function W(z){var x=h(z),w=this.tabList;if(!x){return false;}if(x.active){w.exitDragMode(x);return true;}this.addChildren([x.panel]);if(x.isSingleTab){this.set("visible",true);x.panel.domNode.style.display="block";}w.addTab(x.item,x.homeIdx,true);return false;},addPanel:function Y(AG,w,AF,x){var AB=AG.id,AA=this[AB];if(AA){this.removeChildren(AA);}if(w){w.alias=AB;w.width=this.width;w.visible=!!x;this.addChildren([w]);var z=this.tabList.addTab(AG,AF,x);var AD=this.vi_drz&&this.vi_drz.editorNode,AC=AD&&AD.style,AE=AG.disabled;if(AD&&AG.id==="vi_drz"){if(AC.visibility==="hidden"&&AE){this.tabList.enableItem(z.idx);}else{if(AC.visibility==="visible"&&!AE){this.tabList.disableItem(z.idx);}}}}},removeAllPanels:function H(){var w=p.call(this),z=this.model.getDataService().newUpdateWithoutCmd();z.addExtras(mstrmojo.DocDataService.SUPPRESS_DATA);c.forEach(w,function(AA){AA.setOpenStatus(false,false,z);});var x=z.actions;if(x&&x.length){z.submit();}},removePanel:function Q(w,AB,z,AA){J.call(this,w);if(w.alias===mstrmojo.vi.ui.BoxPanel.PANEL_TYPES.FILTERS){w.unrender();}else{w.destroy();}var x=this.parent;if(!z){x.saveBoxLayout(undefined,undefined,undefined,AB);}if(!p.call(this).length){if(z){x.deleteBox(this,AA);}else{x.deleteBoxAndSubmitDeferred(AB,this,undefined,true);}this.destroy();}},highlightSelected:function C(){var w=this;D.addClass(w.domNode,u);w._highlightTimeout=window.setTimeout(function(){D.addClass(w.domNode,v);D.removeClass(w.domNode,u);window.setTimeout(function(){D.removeClass(w.domNode,v);},500);},1000);},removeHighlightSelected:function G(){if(this._highlightTimeout){window.clearTimeout(this._highlightTimeout);}D.removeClass(this.domNode,v);D.removeClass(this.domNode,u);},ontabSelected:function d(){this.removeHighlightSelected();var w=this.parent&&this.parent.children;c.forEach(w,function(z){var x=z.vi_flt;if(z instanceof mstrmojo.vi.ui.BoxPanelContainer&&x&&x.onStatusChange){x.onStatusChange();}});},selectPanel:function M(x){var w=this.tabList;w.doItemSelect(w.items.filter(function(z){return z.id===x.alias;})[0],{});},onclick:function g(w){if(w.getTarget()===this.closeNode){this.removeAllPanels();}var z=this.tabList.selectedItem;var x;this.parent.model.raiseEvent(N.copy({name:"viIconTabClicked",id:z.id},x));},getPanelByType:function P(w){return(this.children||[]).filter(function(x){return x.viPanelType===w;})[0];},addChildren:function Z(AA,w,x){var z=this._super(AA,w,x);this.doLayout();return z;},onremoveChild:function(w){if(S((w&&w.value)||[])){D.removeClass(this.domNode,A);}},onaddChild:function(w){if(S((w&&w.value)||[])){var x=this.hasRendered;D[x?"addClass":"addWidgetCssClass"](x?this.domNode:this,A);}},getBoxBorderWidth:function s(){return 2;}});mstrmojo.vi.ui.BoxPanelContainer.boxConfiguration={f:{h:185,v:150},o:"h"};mstrmojo.vi.ui.BoxPanelContainer.boxConfigurationWS={f:{h:172,v:150},o:"h"};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxPanel","mstrmojo.css");mstrmojo.mstr.VisPropsEditorPanel=mstrmojo.declare(mstrmojo.vi.ui.BoxPanel,[],{scriptClass:"mstrmojo.vi.ui.VIBoxPropertyEditor",layoutConfig:{h:{controlNode:"0px",containerNode:"100%"},w:{controlNode:"0px",containerNode:"all"},xt:true},init:function B(C){this._super(C);mstrmojo.css.addWidgetCssClass(this,["mstrmojo-vi-PropEditor","mstrmojo-VisPropertyEditorPanel"]);this.onedtModelChanged();},onedtModelChanged:function A(){var D=this.edtModel,C=D&&D.getEditorContents();if(C){C.forEach(function(E){E.slot="containerNode";});this.contents.addChildren(C);this.contents.attachEventListener("childrenRendered",this.id,this.oneditorContentsRendered);this.doLayout();}},oneditorContentsRendered:function(){window.setTimeout(function(){this.updateScrollbars();}.bind(this),100);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasEditableText","mstrmojo._Formattable","mstrmojo.UUID","mstrmojo.Editor","mstrmojo.vi.ui.TextBoxURLEditor","mstrmojo.css","mstrmojo.models.FormatModel","mstrmojo.hash");var I=mstrmojo.hash,D=mstrmojo.css,d="\u01EF",M="\u00df",k="user",n="800000",F="8",S="https://www.microstrategy.com",a=mstrmojo.array,B="13",b=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,H=false;mstrmojo.vi.ui.rw.DocQuillTextField=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable],{scriptClass:"mstrmojo.vi.ui.rw.DocQuillTextField",markupString:'<div id="{@id}" class="mstrmojo-DocQuillTextField {@cssClass}" style="{@domNodeCssText}" mstrAttach:click,blur ></div>',hasActiveLink:mstrmojo.emptyFn,stringToSend:"",currentRawDeltaopsArr:null,isQuillselected:false,cachedDelta:null,cacheGProps:null,dirCachDel:null,savedCurPos:null,isQuill:true,hlText:null,hasFocus:false,arrFonts:["arialblack","arialnarrow","arialunicodems","batang","bookantiqua","bookmanoldstyle","bookshelfsymbolone","bookshelfsymboltwo","bookshelfsymbolthree","comicsansms","couriernew","garamond","haettenschweiler","helvetica","impact","lucidaconsole","lucidasansunicode","mapsymbols","marlett","monotypecorsiva","monotypesorts","msgothic","msoutlook","mssansserif","mtextra","symbol","tahoma","timesnewroman","trebuchetms","verdana","webdings","windings","windings2","windings3"],stringsOfFonts:["Arial Black","Arial Narrow","Arial Unicode MS","Batang","Book Antiqua","Bookman Old Style","Bookshelf Symbol 1","Bookshelf Symbol 2","Bookshelf Symbol 3","Comic Sans MS","Courier New","Garamond","Haettenschweiler","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Map Symbols","Marlett","Monotype Corsiva","Monotype Sorts","MS Gothic","MS Outlook","Microsoft Sans Serif","MT Extra","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Windings","Windings 2","Windings 3"],arrFontSizes:["size8","size9","size10","size11","size12","size14","size16","size18","size20","size22","size24","size36","highlight","nohighlight"],arrFontSzNums:[8,9,10,11,12,14,16,18,20,22,24,36],getRawText:function W(){return this.quillInstance.editor.delta;},init:function g(p){this._super(p);var o;if(!H){o=mstrmojo.getJsRoot();mstrmojo.requiresDepLib(o+"libraries/quill/quill.js");mstrmojo.insertCSSLinks([o+"libraries/quill/quill.bubble.css"]);H=true;}},setUpFontsSizes:function P(){var p=Quill["import"]("formats/font"),o=Quill["import"]("formats/size");p.whitelist=this.arrFonts;Quill.register(p,true);o.whitelist=this.arrFontSizes;Quill.register(o,true);},postBuildRendering:function N(){if(this._super){this._super();}this.domNode.addEventListener("blur",function(AJ){},true);var w=typeof this.quillInstance==="undefined",AH;if(!w){AH=this.quillInstance.editor.delta;}else{AH=null;}this.setUpFontsSizes();this.quillInstance=new Quill("#"+D.cssEscape(this.id),{modules:{toolbar:[],formula:false,syntax:false},placeholder:"Enter rich text here, and highlight and format to edit...",theme:"bubble"});if(!this.quillInstance.editor){return ;}var AE=this.quillInstance,s=AE&&AE.editor,AD=AE.root,x=this,z=x.parent,AC=this.node,AI=AC&&AC.data,AA=z.ctrlOverlay;AD.tabindex="1";AD.onpaste=function(AJ){AJ.preventDefault();AJ.cancelBubble=true;};AD.onfocus=function(AJ){if(mstrApp.isAppStatePresentation()){return ;}AJ.cancelBubble=true;};AD.onblur=function(AN){if(mstrApp.isAppStatePresentation()){return ;}AN.preventDefault();AN.stopPropagation();x.hlText=AE.getSelection();var AJ=x.hlText,AL="",AM=s.delta.ops;a.forEach(AM,function(AQ){AL+=AQ.insert;AL+=M;});var AO=x.utf8_to_b64(JSON.stringify(AM));AL+=d+AO;var AP=x.utf8_to_b64(x.domNode.style.background);AL+=d+AP;var AK=(x.node.data.rv&&x.node.data.rv!==AL);if(x.node.data.rv===undefined){AK=true;}if(AK){x.dirCachDel=null;}z.textEdited(AL,AK,"");x.updatedirCachDel();z.showControlOverlay();x.isEditing=false;};AE.on("selection-change",function(AJ,AN,AM){var AL=x.controller,AK=AL&&AL.getViPanel("prps");if(AK!==null){AL.getViPanel("prps").refresh();}});z.showControlOverlay();AA.domNode.onclick=mstrmojo.emptyFn();var t,q=this.dirCachDel,AF=this.cacheGProps,p,AB,AG,r,v;AA.domNode.ondblclick=function(){if(!mstrApp.isAppStatePresentation()){z.hideControlOverlay();x.isEditing=true;if(AI&&AI.rv){if(q&&!a.isArray(q.ops)){AE.setContents(q);}else{t=(AI.rv).split(d);var AK=x.b64_to_utf8(t[1]),AJ=JSON.parse(AK);if(a.isArray(AJ)){AE.setContents(AJ);x.cachedDelta=AJ;x.cacheGProps=x.b64_to_utf8(t[2]);x.domNode.style.background=AF;}}}}};if(mstrApp.isAppStatePresentation()){if(AI.v){p=(AI.v).split(d);AB=this.b64_to_utf8(p[1]);r=JSON.parse(AB);v=p[0].split(M);r=this.resolveDelta(r,v);if(r){AE.setContents(r);}this.cacheGProps=this.b64_to_utf8(p[2]);this.domNode.style.background=this.cacheGProps;AD.style["user-select"]="none! important";}z.showControlOverlay();if(z.ctrlOverlay.domNode.style.visibility!=="visible"){z.ctrlOverlay.domNode.style.visibility="visible";}}else{if(AH!==null&&!AI.rv){AE.setContents(AE.editor.delta);}else{if(AI.v){p=(AI.v).split(d);AB=this.b64_to_utf8(p[1]);r=JSON.parse(AB);v=p[0].split(M);r=this.resolveDelta(r,v);if(r){AE.setContents(r);}this.cacheGProps=this.b64_to_utf8(p[2]);this.domNode.style.background=this.cacheGProps;}else{if(this.isQuillselected&&this.dirCachDel){z.hideControlOverlay();x.isEditing=true;AE.setContents(this.dirCachDel);var u=this.cacheGProps,o=this.savedCurPos;if(u){this.domNode.style.background=u;}if(o&&o>=0){this.isEditing=true;}}else{if(AH&&AI&&AI.rv&&this.isQuillselected){t=(AI.rv).split(d);AG=this.b64_to_utf8(t[1]);AE.setContents(JSON.parse(AG));this.cachedDelta=JSON.parse(AG);this.cacheGProps=this.b64_to_utf8(t[2]);this.domNode.style.background=this.cacheGProps;}}}}}},onTextEditComplete:function U(p,o){var r=this.parent,q=this.text;if(p){r.textEdited(q,p,o);this.updateScrollbars();}if(!q){r.updateOverlay();}},setDelta:function X(p){var o=this.quillInstance;if(o!==null){o.setContents(p);}},unrender:function A(o){if(this._super){this._super();}},onisEditingChange:function Y(o){if(this._super){this._super(o);}this.parent.set("useRichTooltip",!o.value);},updatedirCachDel:function e(){var o=this.quillInstance,p=o&&o.editor;if(!p||!p.delta){return ;}this.dirCachDel=p.delta;},clickOrUnclick:function G(o){var p=this.parent;p.showControlOverlay();this.isEditing=false;if(this.quillInstance&&o){this.onSelected();}else{this.onUnselected();}},onSelected:function m(){var q=this.quillInstance,u=q&&q.editor,r=this.node,w=this.parent,t=r&&r.data;this.isEditing=false;if(q){this.isQuillselected=true;if(t){if(t.v){var p=(t.v).split(d),x=this.b64_to_utf8(p[1]),AB=JSON.parse(x),s=p[0].split(M);AB=this.resolveDelta(AB,s);if(AB){q.setContents(AB);}this.cachedDelta=u.delta;this.cachedDelta.ops=JSON.parse(x);}else{if(t.rv){var v=(t.rv).split(d),AA=this.b64_to_utf8(v[1]),z=u.delta;z.ops=JSON.parse(AA);q.setContents(z);this.cachedDelta=u.delta;this.cachedDelta.ops=JSON.parse(AA);var o=this.b64_to_utf8(v[2]);this.domNode.style.background=o;}}}}},onUnselected:function h(){var o=this.quillInstance,s=o&&o.editor,p=this.node,v=this.parent,r=p&&p.data;if(v.ctrlOverlay&&v.ctrlOverlay.visible){return ;}if(o){this.isQuillselected=false;var u="",w=this.dirCachDel&&this.dirCachDel.ops;a.forEach(w,function(AB){if(!AB.insert.image){u+=AB.insert;u+=M;}else{u+=JSON.stringify(AB.insert);u+=M;}});this.updatedirCachDel();var q=this.utf8_to_b64(JSON.stringify(w));u+=d+q;var z=this.utf8_to_b64(this.domNode.style.background);u+=d+z;this.cachedDelta=I.clone(s.delta);if(!r.v){return ;}var t=(r.v).split(d),x=this.b64_to_utf8(t[1]);this.cachedDelta.ops=JSON.parse(x);var AA=(JSON.stringify(s.delta.ops)!==JSON.stringify(this.cachedDelta.ops))||(z!==t[2]);v.textEdited(u,AA,"");if(!AA){this.refresh();}}},saveWithoutUnselecting:function E(){var o=this.quillInstance,s=o&&o.editor,u=this.parent;if(o){this.isQuillselected=true;var r=o.getSelection();if(r){this.savedCurPos=r.index+r.length;}var p="",q=s.delta.ops;a.forEach(q,function(w){p+=w.insert;p+=M;});var t=this.utf8_to_b64(JSON.stringify(q));p+=d+t;var v=this.utf8_to_b64(this.domNode.style.background);p+=d+v;u.textEdited(p,true,"");this.updatedirCachDel();}},processLocalFormat:function c(x){var z=x[0],AA,r=this.quillInstance,o=z.oldValue,p=z.newValue,q=o===false&&p===true,w=z.propertyName,u={2:"center",1:"right",6:"justify",0:""},s;if(w===b.FONT_WEIGHT){r.format("bold",q);}else{if(w===b.FONT_STYLE){r.format("italic",q);}else{if(w===b.UNDERLINE){r.format("underline",q);}else{if(w===b.LINE_THROUGH){r.format("strike",q);}else{if(w===b.FONT_SIZE){var AC=parseInt(p.replace(/[^\d.]/g,"")),t=this.arrFontSzNums,v=this.arrFontSizes;for(s=0;s<t.length;s++){if(AC===t[s]){r.format("size",v[s]);break;}}}else{if(w===b.COLOR){r.format("color",p);}else{if(w===b.TEXT_ALIGN){r.format("align",u[p]);}else{if(w===b.BACKGROUND_COLOR){this.domNode.style.background=p;this.cacheGProps=p;}else{if(w===b.FONT_FAMILY){var AB=this.stringsOfFonts;for(s=0;s<AB.length;s++){if((p).indexOf(AB[s])!==-1){AA=s;break;}}if(AA||AA===0){r.format("font",this.arrFonts[AA]);}}}}}}}}}}},formatHlText:function O(AA){var AC=AA[0],AD,r=this.quillInstance,o=AC.oldValue,p=AC.newValue,q=o===false&&p===true,z=AC.propertyName,s,AB=this.hlText,x=AB.index,w=AB.length,u={2:"center",1:"right",6:"justify",0:""};this.renderRVText();if(z===b.FONT_WEIGHT){r.formatText(x,w,"bold",q);}else{if(z===b.FONT_STYLE){r.formatText(x,w,"italic",q);}else{if(z===b.UNDERLINE){r.formatText(x,w,"underline",q);}else{if(z===b.LINE_THROUGH){r.formatText(x,w,"strike",q);}else{if(z===b.FONT_SIZE){var AF=parseInt(p.replace(/[^\d.]/g,"")),t=this.arrFontSzNums,v=this.arrFontSizes;for(s=0;s<t.length;s++){if(AF===t[s]){r.formatText(x,w,"size",v[s]);break;}}}else{if(z===b.COLOR){r.formatText(x,w,"color",p);}else{if(z===b.TEXT_ALIGN){r.formatLine(x,w,"align",u[p]);}else{if(z===b.BACKGROUND_COLOR){this.domNode.style.background=p;this.cacheGProps=p;}else{if(z===b.FONT_FAMILY){var AE=this.stringsOfFonts;for(s=0;s<AE.length;s++){if((p).indexOf(AE[s])!==-1){AD=s;break;}}if(AD||AD===0){r.formatText(x,w,"font",this.arrFonts[AD]);}}}}}}}}}}},getSelectionLength:function Z(){var o=this.quillInstance.getSelection();return(o&&o.length)||0;},utf8_to_b64:function J(o){return window.btoa(encodeURIComponent(o));},b64_to_utf8:function j(o){return decodeURIComponent(window.atob(o));},resolveDelta:function C(q,p){var o=0;a.forEach(q,function(r){if(!(r.insert&&r.insert.image)){var t;try{t=JSON.parse(p[o]);if(t.image){r.insert=t;}}catch(s){}if(!t){q[o].insert=p[o];}}o++;});return q;},uploadImage:function f(){var r=this,s=document.createElement("input"),p=this.quillInstance,q=p&&p.editor,o=p.container;s.setAttribute("type","file"),s.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),s.classList.add("ql-image"),s.addEventListener("change",function(){var t=new FileReader();t.onload=function(v){if(s.files[0].size<n){r.renderRVText();var u=q.delta.insert({image:v.target.result});p.setContents(u,k);s.value="";o.removeChild(s);r.saveWithoutUnselecting();}else{mstrmojo.alert(mstrmojo.desc(14650,"Cannot embed an image larger than ##MB. Your image is too large to be compressed up to ###MB").replace("###",F).replace("##",F));}};t.readAsDataURL(s.files[0]);});o.appendChild(s);s.click();},openURLBox:function R(o){var q=this;var p=new mstrmojo.vi.ui.TextBoxURLEditor({top:o.y+"px",left:o.x+"px",quill:q});p.open();this.setEditorFormatStyle(p);},retSelLink:function V(t){if(!t){return false;}var o=t.index,q=this.quillInstance,s=q.editor.delta.ops,r=0;while(r<s.length){var u=s[r];if(u&&u.insert.length<=o){o=o-u.insert.length;r++;}else{var p=u&&u.attributes;if(p&&p.link){return p.link;}return null;}}return null;},editURLLink:function Q(o,p){var s=this,q=new mstrmojo.vi.ui.TextBoxURLEditor({top:o.y+"px",left:o.x+"px",quill:s}),t=q.text;q.open();var r=t.inputNode;r.value=p;this.setEditorFormatStyle(q);},removeURLLink:function l(){this.quillInstance.format("link","");},setEditorFormatStyle:function K(o){var p=o.text.inputNode;p.onkeypress=function(r){var q=r.keyCode||r.which;if(q==B){o.close();}};p.placeholder=S;},renderRVText:function L(){var r=this.quillInstance,o=r.editor.delta,q=this,t=q.node.data,s=(t.rv).split(d),p=q.b64_to_utf8(s[1]);if(!a.isArray(p)){p=JSON.parse(p);}if(p.ops){o=p;}else{o.ops=p;}q.cacheGProps=q.b64_to_utf8(s[2]);q.domNode.style.background=this.cacheGProps;r.setContents(o);}});}());(function(){mstrmojo.requiresCls("mstrmojo.XtabBase","mstrmojo._Formattable","mstrmojo._IsSelectorTarget","mstrmojo._IsDocXtab","mstrmojo._XtabSelections","mstrmojo._XtabCellHoverMgr","mstrmojo.XtabCellHoverPopup","mstrmojo._HasPopup","mstrmojo.dom","mstrmojo.array","mstrmojo.vi.ui.rw.CustomSortDisplayPanel","mstrmojo.mstr.EnumWebAPIErrorCodes");var W=0,b="overflow:auto",Z="overflow:hidden",L=mstrmojo.dom,R=L.position,a=mstrmojo.array,n="mstrmojo.DocPanelStack",r="px",D=mstrmojo.DocDataService.SUPPRESS_DATA,h=mstrmojo.models.template.DataInterface,I=h.ENUM_GRID_RESIZE,m=I.FIXED,M=I.FIT_TO_WINDOW,H=I.FIT_TO_CONTENTS,G=L.isIOSTouch;var d=function K(t,u){var v=t&&t.parent;while(v&&v.scriptClass!==n){if(v.scriptClass===u){return v;}v=v.parent;}return v;};function l(){var AA=36;var u=this.model.docModel.getPanel(),w=u.containerNode,v=R(w),t=mstrApp.rootCtrl.view.toolbar,AB=R(t.domNode);var z={};z.x=v.x;z.w=v.w;z.y=(AB.y+AB.h)-AA;z.h=(v.y+v.h)-z.y;var x=v.y-(AB.y+AB.h);return{csPanelPos:z,spacerHeight:x};}mstrmojo.Xtab=mstrmojo.declare(mstrmojo.XtabBase,[mstrmojo._Formattable,mstrmojo._IsSelectorTarget,mstrmojo._IsDocXtab,mstrmojo._XtabSelections,mstrmojo._HasPopup],{scriptClass:"mstrmojo.Xtab",cellHoverMgr:"mstrmojo._XtabCellHoverMgr",cellHoverPopupRef:"mstrmojo.XtabCellHoverPopup",preBuildRendering:function A(){var v=this._super();var u=this.gridData;var t=this.lockHeadersCase===W&&u.co;this.scrollboxNodeOverflow=t&&!this.numRowFixed?Z:b;var w=this.getFormats();if(mstrmojo.dom.isIE8&&!u.co&&this.lockHeadersCase===W&&(!u.rw||(u.rw&&(u.rw.row.bc>=u.rw.row.tc)))&&mstrmojo.string.isEmpty(w.height)&&mstrmojo.string.isEmpty(w.width)){this.scrollboxNodeOverflow="";}this._useFilter=this._useFilter||u.cssflt||false;return v;},postBuildRendering:function e(){var v=this.gridData,u=this._super(),z=this.scrollboxNode;var x=this;if(this.viewport){var AA=function(){x.addDisposable(x.requiresContrib("cellHoverMgr",true));if(G){x.viewport.ontouchstart=null;}else{x.viewport.onmouseover=null;}};if(G){this.viewport.ontouchstart=AA;}else{this.viewport.onmouseover=AA;}}if(!this.getFormats().width&&this.model.docModel.addAutoWidthID&&(this.parent&&this.parent.scriptClass!=="mstrmojo.ExpressDocPanel")){this.model.docModel.addAutoWidthID(this.id);v=this.gridData;var t=v&&v.afc;if(t&&mstrmojo.dom.isIE7){var w=d(this,n);if(w&&w.scriptClass===n){this.viewport.style.width=this.contentNode.offsetWidth+(this.scrollboxNode.offsetWidth-this.scrollboxNode.clientWidth)+"px";}}}if(L.isIE&&!L.isIE8&&this._useFilter){window.setTimeout(function(){var AB=document.createElement("img");z.appendChild(AB);z.removeChild(AB);},0);}return u;},onCGBMapChange:function(t){if(this._resolveCGBToTKS(t.cgbMap)&&this._currentSelectedTD){this.defaultAction(this._currentSelectedTD);}},_resolveCGBToTKS:function k(AC){if(!AC){return false;}var AA=this.model.scm,v="\u001E",x,u,z,w,t,AB=false;for(u in AA){z=AA[u];w=z.cgb;for(x in w){t=AC[w[x]];if(t){if(!z.tks){z.tks=t;AB=true;}else{if(z.tks&&(z.tks.indexOf(t)<0)){z.tks+=v+t;AB=true;}}}}}return AB;},onGridWidthChanged:function Y(t){if(this._super){this._super(t);}if(this.cellHoverMgr.onXtabWidthChanged){this.cellHoverMgr.onXtabWidthChanged();}},getDim:function(){var t=this.contentNode;return{w:t.scrollWidth,h:t.scrollHeight};},unrender:function B(t){var u=this.cellHoverMgr;if(u&&u.shutdown){u.shutdown();}this._super(t);},link:function E(u,t){this.controller.onLink(this,this.model.getLinkAction(u,t));},sort:function p(t,u){this.controller.onSort(this,this.model.getSortAction(t,u));},advSort:function P(t,u,v){this.controller.onGetAdvSortData(this,u,t._e&&t._e.otp,v);},customSort:function q(AB,v){var z=this,AD=this.model,AA=AD.getDataService(),AC=AD.docModel,t=AC.getUnitDefinitions(this.k)[this.k].pnk,x=AC.currlaykey,u=AC.getNextKey(),w=AD.getCreateCSVizActions(AB,v,u);AA.submitUpdates(w,{success:function(AJ,AF){var AI=AJ.data,AH=a.filterOne(AI.layouts,function(AN){return AN.k===x;}),AE={};AE[u]=AH.xtabStyles[u];AC.controller.view.updateXtabStyles(x,AE);AC.updateDefnCache(AJ.defn,[u,t]);AC.updateDataCache(AI,AC.getTargetDefn(u));var AM=l.call(z),AK=R(z.domNode),AG=600,AL=mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.rw.CustomSortDisplayPanel",model:AC,nodeKey:u,srcPanelKey:t,srcLayoutKey:x,srcViz:z,srcUnit:AB,srcAxis:v,width:Math.max(AK.w,AG)+"px",height:AM.csPanelPos.h+"px",left:((typeof AK.x==="number")?AK.x:0)+"px",top:((typeof AM.csPanelPos.y==="number")?AM.csPanelPos.y:0)+"px",spacer:AM.spacerHeight});AL.setVizBoxPortalStateRestore();AL.open();AL.parent=mstrmojo.findAncestor(z,"openXtabCellMenu");},failure:function(AH,AI){var AF=6,AJ=10000,AG=0,AE=function(){AA.submitUpdates({act:"undo",stid:AA.stid},{success:function(AK,AL){mstrApp.hideWait();},failure:function(AK,AL){if(++AG<AF&&AK.code==mstrmojo.mstr.EnumWebAPIErrorCodes.MSI_ADDUSERJOB_ERROR){setTimeout(AE,AJ);}else{mstrApp.hideWait();}}},{config:{silent:true},hideCancel:true,noUpdate:true,preserveStid:true,noDeltaXML:true});};mstrApp.showWait();AE();}},{style:{params:{treesToRender:3}},noUpdate:true,preserveStid:true,noDeltaXML:true,hideCancel:true});},pivot:function N(t,u){this.controller.onPivot(this,this.model.getPivotAction(t,u));},drill:function o(t,u){this.controller.onDrill(this,this.model.getDrillAction(this.getActionCells(t),u));},removeUnit:function S(t){this.controller.onRemoveUnit(this,this.model.getRemoveTemplateUnitAction({id:t._e?t._e.oid:t.id,t:t._e?t._e.otp:t.otp}));this.onDemandDrillItems=null;this.onDemandDrillDynamicItems=null;},showViewFilter:function V(t){this.controller.onShowFilterEditor(this,t);},showTotal:function J(t,v,u){this.controller.onShowTotals(this,this.model.getTotalsAction(t,v,u));},derivedMetric:function j(t,z){var u,x=t._e.oid,v={did:x,alias:t._e.n,n:t._e.n,v:t.um?t.formula:t._e.v,idx:t.mix,host:this,nodeKey:this.k,dsid:this.controller.model.findDatasetIdFromUnit(x)||this.model.data.datasetId},AA;if(z==="edit"){u={metricId:v.did,action:{cmd:"edit",n:v.n,alias:v.alias}};AA=this.controller.model.getDataService().getEditDerivedMetricSubmitFunc(v);}else{u={metricId:"",action:{cmd:"editNew",refOi:{did:v.did,n:v.n}}};AA=this.controller.model.getDataService().getAddNewDerivedMetricToXtabSubmitFunc(v);}var w=this.controller.model;if(w.isFromSolrCube&&w.isFromSolrCube(v.did)||w.isFromMDXCube(v.did)){u.disableAFB=true;}this.controller.openDME(this,u,AA);},deleteSelectorControl:function Q(){var t=this.gridData,u=t.sc;if(u&&parseInt(u.ct,10)===6){delete t.sc;}},findSelectorControl:function C(){var t=this.gridData.sc;if(t&&parseInt(t.ct,10)===6){this.selectorControl=t;}else{delete this.selectorControl;}return this.selectorControl;},handlesMultiSelection:function g(u){var t=this.getCellForNode(L.findAncestorByName(u.getTarget(),"td",true,this.viewport)),w=t&&this.model.data.gts[t.axis===1?"row":"col"][t.tui||t.ui],v=w&&w.id&&w.sc;return !!(this.findSelectorControl()||v);},getBasicSubtotalEditorConfig:function c(v){var t=new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.express.ui.SubtotalsWidget({onchange:function u(){var w=this.getSubtotalTypes(),x=w[0].length>0||w[1].length>0;t.set("okEnabled",x);}}),data:{},okEnabled:false});if(!this.model.data.gsi.hidesb){t.contents.set("selectedItems",v||[]);}return t;},updateRelatedColWidths:function O(u){if(this.isCustomSort&&this.getActionMgr().isCurrentActionSilent()){return ;}var AA=(new mstrmojo.models.template.DataInterface(this.gridData)).getColumnHeaderData(true),x=this.gridData.twm||{},w=x.bottom,t=x.top,v=this.getTargetZone,z;(u||[]).forEach(function(AD){var AC=AD.colIndex,AE=AA[AC],AB=AE._ridx||[];z=AD.value;if(AB.length>1){AB.forEach(function(AF){t[AF]=t[AF]||{};t[AF].w=w[AF].w=z;});}else{t[AC]=t[AC]||{};t[AC].w=w[AC].w=z;}v.autoFitWindow=false;v.autoFitContent=false;});this.refresh();},updateScenario:function F(u){var t=this.gridData;t.afc=u===H;t.afw=u===M;if(u!==m){this.setAllXtabWidths("");}this.refresh();},setAllXtabWidths:function s(t){},changeResizeScenario:function f(AC,AH,AI,AD){var AK=new mstrmojo.models.template.DataInterface(this.gridData),v=this.gridData.twm||{},w=v.bottom,t=AK.getColumnHeaderData(true),AE=this,AA=this.model,u=this.id,AJ=this.k,x=[],z=[],AB=1,AG=[];if(AH){x.push({act:"changeXtabColWidthScenario",value:AC});t.forEach(function(AM,AL){var AP=AM.oid||AM.id,AO=function(AQ){return AQ.unitId===AP&&AQ.depth===AB;};if(!(AM.fs&&AM.fs.length>0)){AB=1;}var AN=AP===(AI&&AI.did)&&AB===AI.depth;if(!AG.some(AO)){AG.push({unitId:AP,depth:AB});z.push({colIndex:AL,value:AN?AI.width+r:w[AL].w});if(AC===m){x.push(AA.getColumnResizeAction(AP,AM.otp,AN?AI.width:parseInt((w[AL].w)||0,10),AB,AN?AI.isExtra:false));}}AB++;});var AF=function AF(AL,AN){var AM=mstrmojo.all[u];if(AL===m){AE.updateRelatedColWidths(AN);}AE.updateScenario(AL);};AF(AC,z);AE.submitColumnWidthChange(x,AD);}return AD?x:undefined;},submitColumnWidthChange:function X(v,t){if(!t){this.model.getDataService().submitTemplateUpdates(this.k,v,{success:function u(){}},D);}},changeColumnWidth:function U(x,AF,u,AG,v,AC){var AI=new mstrmojo.models.template.DataInterface(this.gridData),t=AI.getColumnHeaderData(true),AA=this.model,w=[],AE=this,z=[],AB=1,AD=-1,AH=[];if(AI.getColResizeScenario()!==m){w=this.changeResizeScenario(m,true,{did:x,t:AF,width:u,depth:AG,isExtra:v},AC);return AC?w:undefined;}if(x==="all"){t.forEach(function(AK,AJ){var AN=AK.oid||AK.id,AM=function(AO){return AO.unitId===AN&&AO.depth===AB;},AL=t[AJ-1];if(!(AK.fs&&AK.fs.length>0)||(AL&&AN!==(AL.oid||AL.id))){AB=1;}if(!AH.some(AM)){AH.push({unitId:AN,depth:AB});z.push({colIndex:AJ,value:u+r});w.push(AA.getColumnResizeAction(AN,AK.otp,u,AB,false));}AB++;});}else{t.every(function(AK,AJ){var AL=(AK.oid===x||AK.id===x);if(AL){AD=AJ+AG-1;}return !AL;});if(AD>=0){z.push({colIndex:AD,value:u+r});w.push(AA.getColumnResizeAction(x,AF,u,AG,v));}}AE.updateRelatedColWidths(z);AE.submitColumnWidthChange(w,AC);return AC?w:undefined;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.css","mstrmojo.url","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.ui.editors.CoverPageEditor","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");mstrmojo.requiresDescs(15016,15017,15018,15019,15020);var G=mstrmojo.array,E=mstrmojo.css,J=mstrmojo.url,I=mstrmojo.vi.controllers.EnumEvents;var H=80,D=45;function M(){return !(mstrApp.isAppStatePresentation()||mstrApp.isLayoutModePreview()||mstrApp.isAppStateSelection());}mstrmojo.vi.ui.CoverPageWidget=mstrmojo.declare(mstrmojo.Box,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.CoverPageWidget",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="image-and-btn"><img class="mstrmojo-coverpage-image" src="{@absImgUrl}" height="45px" mstrAttach:error,load><div class="mstrmojo-coverpage-default"></div><div class="mstrmojo-coverpage-btn" mstrAttach:click><span>{@btnText}</span></div></div><div class="extraInfo"><span>{@extraInfo}</span></div></div>',markupSlots:{containerNode:function(){return this.domNode;},imgAndBtnNode:function(){return this.domNode.firstChild;},imgNode:function(){return this.domNode.firstChild.firstChild;},defaultImgNode:function(){return this.domNode.firstChild.children[1];},buttonImgNode:function(){return this.domNode.firstChild.children[2];},extraInfoNode:function(){return this.domNode.children[1];}},cssClass:"mstrmojo-coverpage",imageUrl:"",absImgUrl:"",extraInfo:"",lastModifiedTime:null,chapterAndPageCnt:{chapter:0,page:0},btnText:mstrmojo.desc(15020,"Change Cover"),intervalID:null,modelId:null,coverPageEditor:null,onclick:function(){if(!M()){return ;}if(!this.coverPageEditor){this.coverPageEditor=this.addDisposable((new mstrmojo.vi.ui.editors.CoverPageEditor({id:"coverPageEditor",originURL:this.imageUrl,helpText:null,onSave:function N(S,R,U){if(R){var Q=this;mstrmojo.all[this.modelId].raiseEvent({name:I.CHANGE_COVER_IMAGE,url:S,originUrl:this.imageUrl,callback:function(V){Q.set("imageUrl",V);if(!U){window.setTimeout(function(){Q.showWarning({refNode:Q.containerNode,position:2,invalid:true,errorMsg:mstrmojo.desc(15021,"Sorry, this image cannot be loaded, either because the URL is not valid, or there is no internet connection. Please enter a valid URL, and make sure the internet is connected."),errorCode:null,highlight:false,lasting:4000});},0);}}});}}.bind(this),afterSave:function O(){this.close();},afterCancel:function P(){this.close();}})));}this.coverPageEditor.originURL=this.imageUrl;this.coverPageEditor.open();},onerror:function(){if(this.imageUrl){E.toggleClass(this.imgAndBtnNode,"error",true);}else{E.toggleClass(this.imgAndBtnNode,"default",true);}},onload:function(){E.toggleClass(this.imgAndBtnNode,"default",false);E.toggleClass(this.imgAndBtnNode,"error",false);var P=this.imgNode,O=P.naturalWidth,N=P.naturalHeight;if((O/N)>(H/D)){P.width=H;P.height=(H/O)*N;}else{P.height=D;P.width=(D/N)*O;}P.style.padding=(D-P.height)/2+"px "+(H-P.width)/2+"px";},onRender:function(){E.toggleClass(this.buttonImgNode,"disabled",!M());if(this._super){return this._super();}},init:function L(N){this._super(N);var O=this;if(this.lastModifiedTime){this.intervalID=window.setInterval(function(){O.onlastModifiedTimeChange();},5000);}this.bindWarningHandler(this);},onimageUrlChange:function C(){if(mstrApp&&mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode()&&this.imageUrl.indexOf(";base64,")===-1){this.absImgUrl=encodeURI(decodeURIComponent(J.getAbsoluteURL(this.imageUrl,window.FormWrapper.getDossierServerURL())));}else{this.absImgUrl=encodeURI(decodeURIComponent(this.imageUrl));}this.refresh();},destroy:function K(){if(this.intervalID){window.clearInterval(this.intervalID);}this._super();},onlastModifiedTimeChange:function B(){if(!!this.lastModifiedTime){var N=new Date(),Q=N.getTime(),O=Q-this.lastModifiedTime,P=this;if(O<0){return ;}window.clearInterval(P.intervalID);if(O<1000){P.set("extraInfo","Just saved");P.intervalID=window.setInterval(function(){P.onlastModifiedTimeChange();},5000);return ;}var R=[{value:null,name:"years",suffix:"year",suffixPlural:"years"},{value:null,name:"months",suffix:"month",suffixPlural:"months"},{value:null,name:"days",suffix:"day",suffixPlural:"days"},{value:null,name:"hours",suffix:"hour",suffixPlural:"hours",interval:3600000},{value:null,name:"minutes",suffix:"min",suffixPlural:"min",interval:60000},{value:null,name:"seconds",suffix:"s",suffixPlural:"s",interval:5000}];O=Math.floor(O/1000);R[5].value=O%60;O=Math.floor(O/60);R[4].value=O%60;O=Math.floor(O/60);R[3].value=O%60;O=Math.floor(O/24);R[2].value=O;R[1].value=Math.floor(O/30.5)%12;R[0].value=Math.floor(O/365);G.forEach(R,function(U){if(!!U.value){P.set("extraInfo","Saved: "+U.value+(U.value===1?U.suffix:U.suffixPlural)+" ago");var S=U.interval;if(S){P.intervalID=window.setInterval(function(){P.onlastModifiedTimeChange();},S);}return false;}});}},onchapterAndPageCntChange:function A(){var O=this.chapterAndPageCnt,P=(O.chapter>1)?mstrmojo.desc(15016,"## Chapters").replace("##",O.chapter):mstrmojo.desc(15017,"## Chapter").replace("##",O.chapter),N=(O.page>1)?mstrmojo.desc(15018,"## Pages").replace("##",O.page):mstrmojo.desc(15019,"## Page").replace("##",O.page);this.set("extraInfo",P+"<br>"+N);},onextraInfoChange:function F(){if(this.extraInfoNode){this.extraInfoNode.innerHTML="<span>"+this.extraInfo+"</span>";}},onAppStateChange:function(N){if(this._super){this._super(N);}E.toggleClass(this.buttonImgNode,"disabled",!M());}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.RenameEditor","mstrmojo.func");var E=mstrmojo.func;mstrmojo.vi.ui.editors.RenameDEEditor=mstrmojo.declare(mstrmojo.ui.editors.RenameEditor,null,{scriptClass:"mstrmojo.vi.ui.editors.RenameDEEditor",showSetParent:false,preBuildRendering:function B(){if(this.showSetParent){this.renameBox.layoutConfig.w.col1Node="100px";this.addChildren({scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",cssClass:"setParentBox",width:"264px",col1Width:"100px",col2Width:"100%",alias:"setParentBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14743,"Set Parent As:"),slot:"col1Node"},{scriptClass:"mstrmojo.ui.Pulldown",slot:"col2Node",alias:"setParent",getLayoutOffsets:function F(){return{h:0,w:2};}}]},1);}this.addChildren({scriptClass:"mstrmojo.Widget",slot:"buttonNode",alias:"btnNotifier",markupString:"<div class='mstrmojo-btnNotifier'><div class='vfNotifier'><div></div><div>"+mstrmojo.desc(15430,"The visualization filter selections will be cleared if you continue.")+"</div></div></div>"});return this._super();},onRename:function D(I){var F=mstrmojo.vi.ui.editors.DerivedElementsEditor.validateElementName(I);if(F){var M=this.view,O=M.model.docModel,H=this.action,K=this.controller,J=[],L={},G={};H.deName=(I)||((H.funcVal===-1)?mstrmojo.desc(5187,"Group"):mstrmojo.desc(5188,"Calculation"));if(this.showSetParent){var N=this.setParentBox.setParent.getSelectedItem();if(N){H.peId=N.id;H.peName=N.n;H.peLevel=N.level;}}O.addUpdateObjects(H,{id:H.oId,type:H.oTp,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE});J.push(K.dataService().getUpdateTemplateAction(M.k,H));if(O.hasSelectionOnVisFilter()&&H.act!=="editQuickDECalculation"){J=O.wrapUnsetVisualizationFilterAction(J);O.clearSelectionOnVisFilter(true);}L=E.wrapMethods(L,O.getDatasetsUpdateCallback(),K._getXtabCallback(M),O.getUpdateHiddenPanelsCallback(),O.getUpdateHiddenLayoutsCallback(),O.getHighLightNDECallback());if(H.isRA){G=mstrmojo.DocDataService.REQUEST_DEFN_DATA;}K.submitUndoRedoUpdates(J,{},L,G);}return F;},onOpen:function A(){this.toggleNotifier();},toggleNotifier:function(){var G=this.view,I=this.action,H=G&&G.model&&G.model.docModel,F=H&&H.hasSelectionOnVisFilter&&H.hasSelectionOnVisFilter();if(F&&I){F=I.act!=="editQuickDECalculation";}this.btnNotifier.domNode.style.display=!!F?"block":"none";},destroy:function C(F){delete this.view;delete this.action;delete this.controller;this._super(F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasLayout","mstrmojo._HasSuggestion","mstrmojo.css");var G=mstrmojo.css,D="clear";function E(){this.searchTriggered(this.inputNode.value);}mstrmojo.ui.SearchBox=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" mstrAttach:keyup,blur,focus/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',markupSlots:{inputNode:function I(){return this.domNode.firstChild;},searchNode:function B(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{inputNode:"20px",searchNode:"20px"},w:{inputNode:"100%",searchNode:"22px"},xt:true},getLayoutOffsets:function(){return{w:2,h:0};},searchNode:undefined,inputNode:undefined,searchDelay:-1,init:function M(P){this._super(P);var O=this.searchDelay;if(O===-1||isNaN(O)){this.searchDelay=parseInt(mstrApp.getSearchAutoCompleteDelay(),10);}},onfocus:function N(O){var P=O.getTarget();if(P===this.inputNode){this.inputNode.placeholder="";G.addClass(this.domNode,"onInputFocus");}},onblur:function H(O){var P=O.getTarget();if(P===this.inputNode){this.inputNode.placeholder="Search...";G.removeClass(this.domNode,"onInputFocus");}},onclick:function L(O){var P=O.getTarget();if(P===this.searchNode){if(this._hasText){this.clearSearch();}else{E.call(this);}}},onkeyup:function A(Q){var P=Q.hWin,U=Q.e||P.event;if(U.keyCode===27){this.clearSearch();return ;}var S=this,O=this.text,V=this.text=this.inputNode.value,R=this._hasText=V.length>0;if(O!==V){G.toggleClass(this.searchNode,[D],R);window.clearTimeout(this._searchTimeoutId);this._searchTimeoutId=window.setTimeout(function(){E.call(S);},this.searchDelay);}},unrender:function F(){this.text="";this._super();},clearSearch:function J(O){this.text=this.inputNode.value="";G.removeClass(this.searchNode,[D]);delete this._hasText;if(!O){E.call(this);}this.postClearSearch();},isClear:function C(){return !this.text||this.text.length===0;},postClearSearch:mstrmojo.emptyFn,searchTriggered:function K(O){}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo._HasSuggestion");var F=-1,E=0,D=1;mstrmojo._ValidateSuggestions=mstrmojo.provide("mstrmojo._ValidateSuggestions",mstrmojo.hash.copy(mstrmojo._HasSuggestion,{_mixinName:"mstrmojo._ValidateSuggestions",itemValidationField:"did",verifyObject:function C(J,H){var M=this.candidates,L;if(M){var I=M.items,G=mstrmojo.array.find(I,this.itemValidationField,H.data[this.itemValidationField]);G=G>-1?G:mstrmojo.array.find(I,this.itemField,J);if(G>-1){H.updateData(I[G]);L=E;}else{if(M.isComplete){L=D;}}}if(L!==undefined){return L;}var K=this._vqueue=this._vqueue||[];K.push({pattern:J,id:H.data[this.itemIdField]});if(!this._vInProgress){this.verifyNextCandidate();}return F;},verifyNextCandidate:function B(){var G=this._vqueue;if(!G||G.length===0){this._vInProgress=false;return ;}this.verifyCandidate(G.shift());},verifyCandidate:function A(H){var G=this;this._vInProgress=true;this.getCandidatesThroughTaskCall({pattern:H.pattern,blockBegin:1,blockCount:G.noCache?-1:this.suggestCount,isVerify:true},{success:function(N){var K=G.ctxtBuilder.itemWidgets,J=K&&K.length,O,M;for(M=0;M<J;M++){if(K[M].data[G.itemIdField]===H.id){O=K[M];break;}}if(!O){return ;}var L=N.items;if(L&&L.length===1){O.updateData(L[0]);}else{if(L&&L.length>1){var I=mstrmojo.array.find(L,"did",O.data.did);if(I>-1){O.updateData(L[I]);}else{O.set("state",D);}}else{O.set("state",D);}}},failure:function(I){mstrmojo.alert(I.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){G.verifyNextCandidate();}});}}));mstrmojo._ValidateSuggestions.ENUM_STATES={UNDETERMINED:F,VALID:E,INVALID:D};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(2140);var B=mstrmojo.array;mstrmojo.ME._DerivedMetricEditorHelper=mstrmojo.provide("mstrmojo.ME._DerivedMetricEditorHelper",{isDME:true,noCache:false,closeLabel:mstrmojo.desc(2140,"Cancel"),saveAsEnabled:false,tbBrowsable:false,init:function C(D){this._super(D);},onApplyMetricCallback:mstrmojo.emptyFn,optionPopupRef:{scriptClass:"mstrmojo.ME.DerivedMetricOptions",title:mstrmojo.desc(13035,"Metric Options"),help:"create_derived_metric.htm",width:300},replaceAttributeWithForms:function A(E){var D=[];B.forEach(E,function(F){if(F.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute&&F.fs){B.forEach(F.fs,function(G){if(G.obf||F.da){D.push({n:F.n+"@"+G.fnm,did:F.did+"@"+G.fid,fmdid:G.fid,fnm:G.fnm,t:G.t,frm:G,oi:F,path:F.path});}});}else{D.push(F);}});return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ui._HasScroller","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.gm.GMEnums");var Z=mstrmojo.Widget,b=mstrmojo.css,N=mstrmojo.array,Y=mstrmojo.num,U=mstrmojo.hash,a=mstrmojo.expr.DTP,d=mstrmojo.gm.EnumRefLineModelType,D=mstrmojo.gm.WidgetPropertyTag;var c;var K=["Reserved",mstrmojo.desc(2125,"Maximum"),mstrmojo.desc(2127,"Minimum"),mstrmojo.desc(2122,"Average"),mstrmojo.desc(2126,"Median"),mstrmojo.desc(4046,"First"),mstrmojo.desc(4049,"Last"),mstrmojo.desc(7194,"Constant")];function Q(o,p,h){var l=mstrmojo.dom.position(p),g=l.x,n=l.x+l.w,m=l.y,f=l.y+l.h,k=o.pageX,j=o.pageY;if(h){g+=1;n-=1;m+=1;f-=1;}return k>=g&&k<=n&&j>=m&&j<=f;}mstrmojo.ui.editors.controls.GMReferenceLineItemContainer=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ui.editors.controls.GMReferenceLineItemContainer",cssClass:"GMReferenceLineItemContainer",icnCss:"GMReferenceLineItemContainer-container",setupScrollNodes:function L(){this.scrollNode=this.itemsContainerNode;},getItemMarkup:function C(f){if(!c){c=this._super(f).replace(">{@en@n}<",'><span class="txt" title="{@en@n}">{@en@n}</span><span class="rmv hidden" rmv></span><');}return c;},onclick:function e(f){try{var j=f.getTarget(),h=this.getItemFromTarget(j);if(h){f.cancel();if(j.hasAttribute("rmv")){this.doItemRemove(h);}else{this.doItemSelect(h,f||{});}}}catch(g){mstrApp.onerror(g);}},onmouseover:function F(f){try{var j=f.getTarget(),g=j.className;if(g==="txt"||g==="rmv"){j=j.parentNode;}if(Q(f.e,j,false)){b.removeClass(j.children[1],"hidden");}}catch(h){mstrApp.onerror(h);}},onmouseout:function E(f){try{var j=f.getTarget(),g=j.className;if(g==="txt"||g==="rmv"){j=j.parentNode;}if(!Q(f.e,j,true)){b.addClass(j.children[1],"hidden");}}catch(h){mstrApp.onerror(h);}},doItemRemove:function I(g){var f=this.items.slice();N.removeItem(f,g);this.set("items",f);this.onremoveItem(g);},onremoveItem:function A(f){}});function R(){return{scriptClass:"mstrmojo.ui.editors.controls.GMReferenceLineItemContainer",items:[],alias:"refLnList",getItemDisplayName:function(g){var f=K[g.refType]||"";if(g.refType===d.CONST){if(!!g.lin){f=g.lin;}else{if(g.c!==undefined){f+=(" "+Y.toLocaleString(g.c));}}}return f;},postselectionChange:function(){this.parent.onselectRefLine(this.selectedItem);},ondblclick:function(f){var g=this,j=f.getTarget(),h=g.selectedItem;if(h.refType===d.CONST){j.contentEditable=true;j.onkeydown=function(k){if(k.keyCode===13){this.contentEditable=false;if(this.title!==this.textContent){this.title=this.textContent;h[D.REF_LINE_NAME]=this.title;g.parent.onrenameRefLine(h);}return false;}};j.onblur=function(k){if(this.contentEditable&&this.title!==this.textContent){this.contentEditable=false;this.title=this.textContent;h[D.REF_LINE_NAME]=this.title;g.parent.onrenameRefLine(h);}};}},onremoveItem:function(f){this.parent.onremoveRefLine(f);}};}function G(){function g(n){var o=this.refLnList.items;return(this.restrictedTypes||[]).indexOf(n)===-1&&(n===d.CONST||N.find(o,"refType",n)===-1);}function m(n,o){var p=this.generateNewRefLineItem(n,o);this.refLnList.addItems(p);this.onaddRefLine(p);}var f="propEditor-Menu",k=mstrApp.getThemeClassName(),h=this,l=new mstrmojo.ui.menus.MenuConfig({menuCssClass:f,hostId:h.id,hostElement:h.containerNode,isHostedWithin:false});var j=U.valarray(d);(j.slice(0,-1)).forEach(function(n){if(!g.call(h,n)){return ;}l.addMenuItem(K[n],"",function(){if(h.manager&&h.manager.host){h.manager.host.checkCustomScaleNotificationForReferenceLine(h.metricOpt.key);}m.call(h,n);});});l.addPopupMenuItem(K[7],h.id,function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:f+" "+k,data:{constantValid:false},contents:[{scriptClass:"mstrmojo.ValidationTextBox",alias:"constVal",cssClass:"reference-line-constant",dtp:a.FLOAT,required:true,valueChangeDelay:1000,constraints:{trigger:mstrmojo.validation.TRIGGER.NONE},onEnter:function(){this.blur();},onvalueChange:function(){this.validate();},onValid:function(){this.parent.data.set("constantValid",true);},onInvalid:function(){this.parent.data.set("constantValid",false);}}],bindings:{okEnabled:"this.data.constantValid"},fnOk:function(o,n){var p=n.constVal;if(p.isValid()){if(h.manager&&h.manager.host){h.manager.host.checkCustomScaleNotificationForReferenceLine(h.metricOpt.key);}m.call(h,d.CONST,p.value);}}});},"",h);h.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:l,themeClassName:k}));}function H(){return{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(531,"Add"),alias:"addBtn",cssClass:"link-btn",onclick:function(){G.call(this.parent);}};}mstrmojo.ui.editors.controls.GMReferenceLineList=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.ui.editors.controls.GMReferenceLineList",markupString:'<div id="{@id}" class="mstrmojo-ui-GMReferenceLineList {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:Z.visibleMarkupMethod,onenabledChange:mstrmojo.Container.enabledMarkupMethod,onheightChange:Z.heightMarkupMethod,onwidthChange:Z.widthMarkupMethod},restrictedTypes:undefined,items:undefined,shouldPropagateEnabled:true,children:[R(),H()],init:function W(f){this._super(U.copy(f,{items:[],restrictedTypes:[]}));this.onitemsChange();},onitemsChange:function V(){this.refLnList.set("items",this.items);},generateNewRefLineItem:function J(f,g){},getSelectedItem:function O(){return this.refLnList.selectedItem;},selectItemByField:function B(g,f){this.refLnList.singleSelect(N.find(this.refLnList.items,g,f));},onselectRefLine:function X(f){},onaddRefLine:function P(f){},onremoveRefLine:function M(f){},onrenameRefLine:function S(f){}});mstrmojo.ui.editors.controls.GMReferenceLineList.ItemType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.express.ui.SubtotalsWidget","mstrmojo.mstr.EnumDSSXMLDrillType","mstrmojo.ui.menus.EditorConfig","mstrmojo.vi.enums.EnumFeatures");var M=mstrmojo.hash,I=mstrmojo.array,G=mstrmojo.mstr.EnumDSSXMLDrillType,O={STATIC:0,DRILLING:1,SELECTOR_CONTROL:2,HYPERLINK:4,SORT:8,PIVOT:16,EDIT:32,GROUP:64,CALCULATION:128,GROUP_EDIT:256,KEEP_ONLY:512,TOTAL_HEADER:1024},C=mstrmojo.vi.enums.EnumFeatures;function F(X){return mstrmojo.resolveFeature("web-sort")&&!!(X&&(X.mix!==undefined&&X._e&&X._e.otp===4));}function R(Y){var c=new mstrmojo.ui.menus.MenuConfig(),b=Y.data,X=Y.cfg,a=[{n:mstrmojo.desc(1893,"Left"),btp:"l"},{n:mstrmojo.desc(1894,"Right"),btp:"r"},{n:mstrmojo.desc(13834,"To Beginning"),btp:"b"}],Z=this.delegateActionToXtab;if(!X.tabularGrid){a.push({n:mstrmojo.desc(152,"Up"),btp:"u"},{n:mstrmojo.desc(153,"Down"),btp:"d"},{n:mstrmojo.desc(1891,"To Columns"),btp:"2"},{n:mstrmojo.desc(1890,"To Rows"),btp:"1"});}I.forEach(a,function(d){if(Y.xtab.model.isPvtButtonVisible(b,d.btp)){c.addMenuItem(d.n,"xt",function(){Z(Y,"pivot",[d.btp]);});}});return c;}function B(a,e){if(!a.onDemandDrillDynamicItems){a.onDemandDrillDynamicItems={};}var d="drill"+e,Z=a.onDemandDrillItems,Y=a.onDemandDrillDynamicItems[d];if((!a.onDemandDrillItems||a.shouldUpdateDrillMenus)&&!a.loadingDCM&&a.gridData.odd){a.loadingDCM=true;delete a.shouldUpdateDrillMenus;var c=new mstrmojo.SimpleXHR({async:false});c.request("POST",mstrConfig.taskURL,{success:function b(f){I.forEach(f.dynamicMenus,function(g){a.onDemandDrillDynamicItems[g.n]=g.items;if(g.n===d){Y=g.items;}});Z=f.menuItems;a.onDemandDrillItems=Z;delete a.loadingDCM;}},{taskId:"RWOnDemandDrill",styleName:"OndemandDrillContextMenusStyle",viewMode:1,usePartDisplay:1,docGridKey:a.k,rwb:a.model.docModel.bs});}var X=[];I.forEach(Y,function(k){var f=k.idx,g=Z[f],j=JSON.parse(g.subMenuIndices||"[]");if(j.length>0){var h=[];I.forEach(j,function(l){h.push(Z[l]);});g.items=h;}X.push(g);});return X;}function S(Y){var X="";switch(Y){case G.DssXmlDrillToChild:X="drillDown";break;case G.DssXmlDrillToParent:X="drillUp";break;case G.DssXmlDrillToTemplate:X="drillTemplate";break;}return X;}function K(Y){var X=I.filter(Y,function(Z){return[G.DssXmlDrillToChild,G.DssXmlDrillToParent].indexOf(Z.dt)>-1;});return X.length>0?"drill":"";}function V(X){return X&&X.mix!==undefined&&!!X._e;}function D(X){return X&&X.otp===12;}mstrmojo.rw.xtab.XtabMenuConfig=mstrmojo.declare(mstrmojo.ui.menus.MenuConfig,null,{scriptClass:"mstrmojo.rw.xtab.XtabMenuConfig",xtab:undefined,data:undefined,isActionAvailable:function J(Y,X){return((((Y&&Y.at)||0)&X)>0);},delegateActionToXtab:function L(X,a,Y){var Z=X.xtab;Z[a].apply(Z,[X.data].concat(Y||[]));},buildXtabMenuConfig:function A(c){var h=this.xtab=c.xtab,a=h.id,b=this.selectedData=c.data=c.data||(h&&c.td&&h.getCellForNode(c.td)),e=h.model.getCellTitleInfo(b),d={xtab:h,data:b,cfg:c},g=this.delegateActionToXtab;this.selectedNode=c.td;if(c.onClose){this.addPopupHandlers(a,mstrmojo.emptyFn,c.onClose);}var j=h.model.getCellLinksInfo(b)||{},Z=j.links||[],X=this.isActionAvailable(b,O.HYPERLINK)&&Z.length>0&&(b.slm==undefined),Y=this.isActionAvailable(b,O.DRILLING)&&(b.sdm==undefined)&&!!mstrmojo.resolveFeature(C.WEB_DRILL_AND_LINK),f=(b&&b.mix===undefined&&e.isSrcTitle&&b.otp!==-1&&b.avst>0);if(Y){Y=this.addDrillMenuItem(d)?true:false;}if(X){Z.forEach(function(l,k){this.addMenuItem(l.n||l.url||(l.target&&(l.target.n||l.target.did)),"",function(){g(d,"link",[k]);});},this);}if(Y||X){this.addSeparator();}if(!mstrApp.isDossier){this.addPivotMenuItem(d);}this.addSortMenuItem(d);if(f){this.addSeparator();this.addShowTotalMenuItem(d);}if(!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode&&(mstrApp.isOIVM&&mstrApp.isOIVM()&&(D(b)||V(b)))){this.addViewFilterEditor(d);}this.addRemoveMenuItem(d);},addPivotMenuItem:function H(X){if(this.isActionAvailable(X.data,O.PIVOT)){var Y=R.call(this,X);if(Y.menus.length){this.addSubMenuItem(mstrmojo.desc(1889,"Move"),"",this.id,function(){return Y;},X);this.addSeparator();}}},addDrillMenuItem:function P(b,d){var f=b.xtab,Z=b.data,e=this.delegateActionToXtab,X=function(g){g.onDemandDrillItems=null;g.onDemandDrillDynamicItems=null;};var a=d?[d]:f.model.getAllDrillPathsForCell(Z),c=f.model.getCellTitleInfo(this.selectedData),Y=B(f,c.title.id);if(a.length<1&&Y.length<1){return ;}this.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,function(){var g=new mstrmojo.ui.menus.MenuConfig({menuCssClass:K(a),isHostedWithin:false,supportsScroll:true,alignWithAnchor:true,maxHeight:mstrmojo.dom.windowDim().h-50});I.forEach(a,function(h){if(h&&h.k){if(mstrApp.isDossier&&!h.within){return ;}g.addMenuItem(h.n||"",S(h.dt),function(){f.shouldUpdateDrillMenus=true;e(b,"drill",[h]);X(f);});}});I.forEach(Y,function(j){if(mstrApp.isDossier){var h=I.filter(j.items,function(k){return k.within;});if(h.length===0){return ;}}g.addPopupMenuItem(j.n,"",function(){var k=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:350,isHostedWithin:false,alignWithAnchor:true,menuCssClass:K(j.items)});I.forEach(j.items,function(l){if(mstrApp.isDossier&&!l.within){return ;}k.addMenuItem(l.n,S(l.dt),function(){f.shouldUpdateDrillMenus=true;e(b,"drill",[l]);X(f);});});return k;});});return g;});},addViewFilterEditor:function W(X){if(!mstrmojo.resolveFeature("use-view-filter-editor")){return ;}this.addMenuItem(mstrmojo.desc(3938,"edit view filter..."),"xt",this.delegateActionToXtab.bind(this,X,"showViewFilter"),X);},addRemoveMenuItem:function N(Y){if(!mstrmojo.resolveFeature("modify-grid-level-in-documents")){return ;}if(Y.data._e){if(Y.data._e.otp!==4){return ;}}if(Y.data.otp===-1){return ;}if(Y.data._tp){var X=Y.data._tp._e;if(X){if(X.otp===4){return ;}}}this.addSeparator();this.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",this.delegateActionToXtab.bind(this,Y,"removeUnit"),Y);},addSortMenuItem:function U(X){var b=X.data,Z=this.delegateActionToXtab,c=this.isActionAvailable(b,O.SORT),a=X.xtab.model,Y=a.isRecursiveAttribute&&a.isRecursiveAttribute(b.id),d=Y&&mstrApp.isAppStateDefault&&mstrApp.isAppStateDefault()&&!mstrApp.isDossier;if(c){this.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",function(){Z(X,"sort",[true]);},X);this.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",function(){Z(X,"sort",[false]);},X);if(d){this.addMenuItem(mstrmojo.desc(15676,"Custom Sort..."),"xt",function(){Z(X,"customSort",[b.axis]);},X);}}if(!X.cfg.hideAdvancedSort&&(c||F(b))&&!mstrApp.isDossier){this.addMenuItem(mstrmojo.desc(11099,"Advanced Sort..."),"xt",function(){Z(X,"advSort",[b.axis,X.ndeInfo]);},X);}},addShowTotalMenuItem:function E(X){this.addEditorMenuItem(mstrmojo.desc(6193,"Show Totals"),this.id,this.getSubtotalEditorConfig,M.copy(X,{isTotals:true}));},getSubtotalEditorConfig:function Q(Y){var Z=Y.data,b=Y.xtab,X=b.getBasicSubtotalEditorConfig(Z.ast);X.fnOk=function a(){var d=X.contents.getSubtotalTypes(),c=b.model;b.controller.onShowTotals(b,c.getShowTotalsUnitAction(Z.id,Z.otp,d[0],d[1]));};return X;}});mstrmojo.rw.xtab.XtabMenuConfig.ACTION_TYPES=O;mstrmojo.rw.xtab.XtabCellMenuItemContextType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo._FormatDefinition","mstrmojo.Table","mstrmojo._HasLayout","mstrmojo.color","mstrmojo.ColorPicker");var D=mstrmojo.hash,C=mstrmojo.array,F=mstrmojo._FormatDefinition,B=mstrmojo.color;var A=function(G){var H={scriptClass:"mstrmojo.List",cssClass:"mstrmojo-FormatEditor-fontFamily",itemCssClass:"mstrmojo-FormatEditor-bullet",selectedIndex:0,itemIdField:"v",itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">{@n}</div></div>'};return D.copy(G,H);};var E=function(I){var H=I.alias,G=I.label,J=I.pr;return{alias:H,scriptClass:"mstrmojo.TristateCheckBox",text:G,checked:false,grayed:false,bindings:{m:I.modelBinding,checked:function(){return this.m[J]==-1;},grayed:function(){return(typeof this.m[J]=="undefined")||this.m[J]=="pru";}},oncheckedChange:function(K){if(this.m){this.m.set(J,this.checked?-1:0);}}};};mstrmojo.FontFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.FontFormatter",cssClass:"mstrmojo-FontFormatter",markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){D.make(this.model,mstrmojo.Obj);}},children:[{scriptClass:"mstrmojo.Table",layout:[{cells:[{},{},{}]},{cells:[{},{colSpan:2}]}],children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2172),slot:"0,0"},A({items:F.Families,itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text" style="font-family:{@n}">{@n}</div></div>',pr:"Name",bindings:{selectedIndex:function(){var H=this.parent.parent.model;if(H){var I=H.Name,G=C.find(this.items,this.itemIdField,I);return G==-1?0:G;}}},onchange:function(){var G=this.parent.parent.model;if(G){G.set("Name",this.selectedItem.v);}},slot:"0,0"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3059),slot:"0,1"},A({items:F.Styles,cssClass:"mstrmojo-FormatEditor-fontStyle",bindings:{selectedIndex:function(){var K=this.parent.parent.model;if(K){var I=K.Bold||"",H=K.Italic||"",J=I==""&&H==""?"":I+","+H,G=mstrmojo.array.find(this.items,this.itemIdField,J);G=G==-1?mstrmojo.array.find(this.items,"v2",J):G;return(G==-1?0:G);}}},onchange:function(){var I=this.parent.parent.model;if(I&&this.selectedItem){var H=this.selectedItem.v.split(","),G=italic="pru";if(H[0]!="pru"){G=H[0]=="-1"?"-1":"0";italic=H[1]=="-1"?"-1":"0";}I.set("Bold",G);I.set("Italic",italic);}},slot:"0,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2178),slot:"0,2"},A({items:F.Sizes,cssClass:"mstrmojo-FormatEditor-fontSize",bindings:{selectedIndex:function(){var H=this.parent.parent.model;if(H){var I=H.Size,G=C.find(this.items,this.itemIdField,I);return G==-1?0:G;}}},onchange:function(){var G=this.parent.parent.model;if(G){G.set("Size",this.selectedItem.v);}},slot:"0,2"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3060),slot:"1,0"},{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-FormatEditor-fontEffect",postCreate:function(){this.addChildren(E({alias:"Underline",label:mstrmojo.desc(3061),pr:"Underline",modelBinding:"this.parent.parent.parent.model"}));this.addChildren(E({alias:"Strikeout",label:mstrmojo.desc(3062),pr:"Strikeout",modelBinding:"this.parent.parent.parent.model"}));},slot:"1,0"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3063),slot:"1,1"},mstrmojo.ColorPicker.createDropDown({pr:"Color",bindings:{fillColor:function(){var G=this.parent.parent.model;if(G){var H=G[this.pr];if(typeof (H)!="undefined"&&/^\d{1,8}$/.test(H)){return B.decodeColor(H);}}return"transparent";}},onfillColorChange:function(){if(this.parent.parent.model){this.parent.parent.model.set(this.pr,this.fillColor=="transparent"?"pru":B.encodeColor(this.fillColor));}},slot:"1,1"}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2036),slot:"1,1"},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FormatEditor-fontPreview",text:mstrmojo.desc(2037),bindings:{m:"this.parent.parent.model",cssText:function(){var H=this.m.Color,J=this.m.Size,K=this.m.Name,I=this.m.Bold,G=this.m.Italic,M=this.m.Underline,L=this.m.Strikeout;H=/^\d{1,8}$/.test(H)?B.decodeColor(H):B.decodeColor(F.DefaultFormat.FormattingFont.Color);J=J||F.DefaultFormat.FormattingFont.Size;K=K||F.DefaultFormat.FormattingFont.Name;I=I=="-1"?"bold":"normal";G=G=="-1"?"italic":"normal";M=parseInt(M)==-1;L=parseInt(L)==-1;return";font-family:"+K+";font-style:"+G+";font-weight:"+I+";font-size:"+J+"pt;color:"+H+";text-decoration:"+(M?" underline ":"")+(L?" line-through ":"");}},slot:"1,1"}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.FieldSet","mstrmojo.Label","mstrmojo.ColorPicker");var A=mstrmojo.hash,B=mstrmojo.color;mstrmojo.FillFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.FillFormatter",cssClass:"mstrmojo-FillFormatter",isChart:false,markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){A.make(this.model,mstrmojo.Obj);}},children:[{scriptClass:"mstrmojo.FieldSet",alias:"fill",cssClass:"mstrmojo-FormatEditor-fill",legend:mstrmojo.desc(2885,"Fill"),bindings:{legend:"this.parent.isChart ? mstrmojo.desc(3902, 'Series Colors') : mstrmojo.desc(2885, 'Fill')"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2060,"Color"),cssClass:"label"},mstrmojo.ColorPicker.createDropDown({bindings:{m:"this.parent.parent.model",fillStyle:function(){var H=this.m,J=parseInt(H.FillStyle,10);if(J===2){var E=parseInt(H.GradientAngle,10),I=E===0?1:0,D=B.decodeColor(H.FillColor),K=B.decodeColor(H.GradientColor),C=parseInt(H["Gradient"+(E===0?"X":"Y")+"Offset"],10)===100?1:0,G=(C!==1)?mstrmojo.css.buildGradient(I,D,K):mstrmojo.css.buildGradient(I,K,D);this.set("gradientCss",G.n+":"+G.v);this._updateGradientInfo();}else{var F=this.m.FillColor;if(F!==undefined&&/^\d{1,8}$/.test(F)){F=B.decodeColor(F);}else{F="transparent";}this.set("fillColor",F);}return J||0;}},_updateGradientInfo:function(){var C=this.m;this.gradient=mstrmojo.hash.copy({FillColor:B.decodeColor(C.FillColor),GradientColor:B.decodeColor(C.GradientColor)},A.copy(C));},onfillColorChange:function(){this.m.FillColor=(this.fillColor==="transparent"?"pru":B.encodeColor(this.fillColor));this.m.FillStyle=0;},ongradientChange:function(C){var F=["FillStyle","FillColor","GradientColor","GradientXOffset","GradientYOffset","GradientAngle"],E;for(E=0;E<F.length;E++){var D=C.value[F[E]];this.m[F[E]]=/Color$/.test(F[E])?B.encodeColor(D):D;}this.m.FillStyle=2;}},{showGradients:false})]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.FieldSet","mstrmojo._FormatDefinition","mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ColorPicker");var C=mstrmojo.hash,A=mstrmojo.color,D=mstrmojo._FormatDefinition;var B=function(F,I,E){var H=["Left","Right","Top","Bottom"];for(var G=0;G<3;G++){F[H[G]+I]=E;}F.set(H[3]+I,E);};mstrmojo.BorderFormatter=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.BorderFormatter",cssClass:"mstrmojo-BorderFormatter",markupString:'<div id={@id} class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},postCreate:function(){this.onmodelChange();},onmodelChange:function(){if(this.model&&!this.model.scriptClass){C.make(this.model,mstrmojo.Obj);}},children:[{scriptClass:"mstrmojo.FieldSet",alias:"borders",cssClass:"mstrmojo-FormatEditor-border",legend:mstrmojo.desc(2886),children:[{scriptClass:"mstrmojo.Table",alias:"borderTable",cssText:"width:100%;",rows:1,cols:2,children:[{scriptClass:"mstrmojo.List",alias:"borderTypes",selectedIndex:0,cssClass:"borderTypes",items:[{n:'<img border="0" align="absmiddle" src="../images/borders_none.gif" alt=""> '+mstrmojo.desc(2057),v:1},{n:'<img border="0" align="absmiddle" src="../images/borders_all.gif" alt=""> '+mstrmojo.desc(2058),v:2},{n:'<img border="0" align="absmiddle" src="../images/borders_custom.gif" alt=""> '+mstrmojo.desc(2056),v:3}],slot:"0,0",bindings:{m:"this.parent.parent.parent.model",selectedIndex:function(){var E=this.m;if(C.isEmpty(E)){return 0;}if(E.LeftStyle==0&&E.TopStyle==0&&E.RightStyle==0&&E.BottomStyle==0){return 0;}else{if(E.LeftStyle==E.TopStyle&&E.LeftStyle==E.RightStyle&&E.LeftStyle==E.BottomStyle){return 1;}}return 2;}},onchange:function(E){if(this.m){var G=this.parent.borderAndColor;if(!G){return ;}if(this.selectedIndex===0){var H=["Left","Right","Top","Bottom"];for(var F=0;F<4;F++){this.m.set(H[F]+"Style","0");this.m.set(H[F]+"Color","0");}}}}},{scriptClass:"mstrmojo.Container",alias:"borderAndColor",markupString:'<div class="borderStyles"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.Container",alias:"allBordersContainer",markupString:'<div class="mstrmojo-FormatEditor-ColorLine-borders"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:"this.parent.parent.borderTypes.selectedIndex==1"},children:[{scriptClass:"mstrmojo.Table",alias:"allBorders",rows:1,cols:3,onshowChange:function(){if(this.show){B(this.m,"Style",this.styles.value);B(this.m,"Color",A.encodeColor(this.colors.fillColor));}},bindings:{m:"this.parent.parent.parent.parent.parent.model"},postCreate:function(){var F=["Left","Right","Top","Bottom"];var E=[{scriptClass:"mstrmojo.Pulldown",alias:"styles",items:D.BorderStyles,itemIdField:"v",bindings:{m:"this.parent.m",value:function(){var I=this.m.LeftStyle,K=this.m.RightStyle,J=this.m.TopStyle,H=this.m.BottomStyle;var G=0;if(I==K&&K==H&&H==J){G=mstrmojo.array.find(D.BorderStyles,"v",I);}G=G==-1?0:G;return this.items[G][this.itemIdField];}},onvalueChange:function(){if(this.parent.parent.visible){B(this.m,"Style",this.value);}},slot:"0,1"},mstrmojo.ColorPicker.createDropDown({alias:"colors",bindings:{m:"this.parent.m",fillColor:function(){var H=this.m.LeftColor,K=this.m.RightColor,J=this.m.TopColor,G=this.m.BottomColor;if(H==K&&K==G&&G==J){var I=H;}if(typeof (I)!="undefined"&&/^\d{1,8}$/.test(I)){return A.decodeColor(I);}return"transparent";}},onfillColorChange:function(){if(this.parent.parent.visible){B(this.m,"Color",this.fillColor=="transparent"?"pru":A.encodeColor(this.fillColor));}},slot:"0,2"})];this.addChildren(E);}}]},{scriptClass:"mstrmojo.Container",alias:"customBordersContainer",markupString:'<div class="mstrmojo-FormatEditor-ColorLine-borders"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},bindings:{visible:"this.parent.parent.borderTypes.selectedIndex==2"},children:[{scriptClass:"mstrmojo.Table",alias:"customBorders",rows:1,cols:3,bindings:{m:"this.parent.parent.parent.parent.parent.model"},postCreate:function(){var H=["Left","Right","Top","Bottom"];var G=[];for(var F=0;F<H.length;F++){var E=H[F];G.push({scriptClass:"mstrmojo.Label",text:mstrmojo.desc({Left:3528,Right:3529,Top:3526,Bottom:3527}[E]),alias:E,slot:"0,0"},{scriptClass:"mstrmojo.Pulldown",items:D.BorderStyles,itemIdField:"v",pr:E+"Style",bindings:{m:"this.parent.m",value:function(){var K=this.m.LeftStyle,M=this.m.RightStyle,L=this.m.TopStyle,J=this.m.BottomStyle;var I=mstrmojo.array.find(D.BorderStyles,"v",this.m[this.pr]);I=I==-1?0:I;return this.items[I][this.itemIdField];}},onvalueChange:function(){if(this.parent.parent.visible){this.m.set(this.pr,this.value);}},slot:"0,1"},mstrmojo.ColorPicker.createDropDown({cssClassx:"mstrmojo-FormatEditor-colorPicker",alias:E+"Color",pr:E+"Color",bindings:{m:"this.parent.m",fillColor:function(){var J=this.m.LeftColor,M=this.m.RightColor,L=this.m.TopColor,I=this.m.BottomColor;var K=this.m[this.pr];if(typeof (K)!="undefined"&&/^\d{1,8}$/.test(K)){return A.decodeColor(K);}return"transparent";}},onfillColorChange:function(){if(this.parent.parent.visible){this.m.set(this.pr,this.fillColor=="transparent"?"pru":A.encodeColor(this.fillColor));}},slot:"0,2"}));}this.addChildren(G);}}]}],slot:"0,1"}]},{scriptClass:"mstrmojo.Label",cssClass:"borderPreview",text:mstrmojo.desc(7941),bindings:{m:"this.parent.parent.model",cssText:function(){var G={0:"None",3:"Dashed",4:"Dotted",6:"Double",7:"Solid"},E={1:"Thin",5:"Thick",6:"medium"};var F=this.parent.borderTable.borderTypes.selectedIndex;return";border-left-style: "+(G[this.m.LeftStyle]||"solid")+";border-right-style: "+(G[this.m.RightStyle]||"solid")+";border-top-style: "+(G[this.m.TopStyle]||"solid")+";border-bottom-style: "+(G[this.m.BottomStyle]||"solid")+";border-left-color: "+A.decodeColor(this.m.LeftColor||"0")+";border-right-color: "+A.decodeColor(this.m.RightColor||"0")+";border-top-color: "+A.decodeColor(this.m.TopColor||"0")+";border-bottom-color: "+A.decodeColor(this.m.BottomColor||"0")+";border-left-width: "+(E[this.m.LeftStyle]||"thin")+";border-right-width: "+(E[this.m.RightStyle]||"thin")+";border-top-width: "+(E[this.m.TopStyle]||"thin")+";border-bottom-width: "+(E[this.m.BottomStyle]||"thin");}}}]}]});})();(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.num","mstrmojo.expr","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ValidationTextBox","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.models.template.DataInterface");var E="selColScenario",N="colTargetAndWidth",D="selRowScenario",G="rowHeightContainer",C=mstrmojo.num,I=mstrConfig,F=mstrmojo.expr,H=mstrmojo.models.template.DataInterface.ENUM_GRID_RESIZE,M=H.FIXED,A=mstrmojo.ui.Pulldown.newPulldown;function B(P,O,Q){O.slot="col1Node";return{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:P,col1Width:"100%",col2Width:"56px",children:[O,{scriptClass:"mstrmojo.Box",slot:"col2Node",value:0,enabled:true,children:[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",cssText:"text-align:right;width:36px",cssDisplay:"inline-block",bindings:{value:"this.parent.value",enabled:"this.parent.enabled"},dtp:F.DTP.NUMERIC,onValid:function(){var R,S;if(C.UNIT.PX!==I.units){R=parseFloat(this.value).toFixed(2);S=R!==parseFloat(this.orignText);}else{R=parseInt(this.value,10);S=R!==parseInt(this.orignText,10);}if(S){Q.call(this.parent.parent.parent,R);}}},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssText:"width:16px;padding-left:2px;",text:C.UNIT_SYMBOL[I.units],title:I.unitsLabel}]}]};}function J(R,Q,P){var O=[{n:mstrmojo.desc(2987,"Fit to contents"),v:H.FIT_TO_CONTENTS},{n:mstrmojo.desc(2050,"Fixed"),v:M}];if(P){O.unshift({n:mstrmojo.desc(13580,"Fit to container"),v:H.FIT_TO_WINDOW});}return A(O,function(S){var U=this.parent;U[Q].set("enabled",S.v===M);if(!U._sync){U.targetXtab.changeResizeScenario(S.v,P);}},undefined,{alias:R,isHostedWithin:false});}mstrmojo.ui.editors.controls.XtabResizeGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.XtabResizeGroup",init:function K(O){this._super(O);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-XtabResize");var P=this;this.addChildren([{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(159,"Columns")},J(E,N,true),B(N,A([],function(W){var R=this.parent,V=W.width,Q=P.xtabInterface.getColResizeScenario()===M,U=P.xtabInterface.getColResizeInfo(P.targetXtab.model.docModel.datasets).widths||[{}];if(U.length){var S=U[0].width;if(Q&&W._renderIdx!==undefined){P.targetXtab.edtModel._lsfcw=W._renderIdx;}if(V===""){var X=U.every(function(Y){return Y.width===S;});if(X){V=S;}}R.parent.syncControls(function(){R.getControl(2).set("value",(Q&&V!=="")?((C.UNIT.PX===I.units)?V:parseFloat(C.convertUnits(C.UNIT.PX,I.units,V)).toFixed(2)):"");});}}),function(R){var Q=this[N].getControl(1).getSelectedItem();this.targetXtab.changeColumnWidth(Q.did,Q.t,Math.round(C.convertUnits(I.units,C.UNIT.PX,R)),Q.depth||1,false);}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(113,"Rows")},J(D,G,false),B(G,{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13581,"Row height:")},function(Q){this.targetXtab.changeRowHeight(Math.round(C.convertUnits(I.units,C.UNIT.PX,Q)));})]);},targetXtab:null,xtabInterface:null,setFormatSource:function L(U){var S=this,R=S.xtabInterface=this.addDisposable(new mstrmojo.models.template.DataInterface(U.model.data)),V=R.isEmpty(),Q=U.edtModel,O=Q._lsfcw=Q._lsfcw===undefined?1:Q._lsfcw,P=!V&&!U.excludeData;S.targetXtab=U;S.set("enabled",P);if(P){this.syncControls(function(){var b=R.getColResizeInfo(U.model.docModel.datasets),W=b.widths||[];S[E].selectItemByField("v",b.v);var Z=S[N],Y=Z.getControl(1);W.unshift({n:mstrmojo.desc(2429,"All Columns"),did:"all",width:""});Y.set("items",W);Y.set("selectedIndex",b.v===M?Math.min(O,W.length-1):0);var c=R.getRowResizeInfo(),a=c.v,X=c.height;S[D].selectItemByField("v",a);S[G].getControl(2).set("value",a===M?((C.UNIT.PX===I.units)?X:parseFloat(C.convertUnits(C.UNIT.PX,I.units,X)).toFixed(2)):"");});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ListPreviewButton","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.EditableLabel");var A=mstrmojo.css,E=mstrmojo.validation.STATUSCODE;mstrmojo.ui.editors.controls.ComboBox=mstrmojo.declare(mstrmojo.ui.editors.controls.ListPreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ComboBox",markupMethods:{onenabledChange:function D(){this.txtLabel.set("enabled",this.enabled);this.txtLabel.set("editOnClick",this.enabled);A.toggleClass(this.domNode,"disabled",!this.enabled);}},init:function B(F){this._super(F);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-ComboBox");},updatePreview:function C(){this.txtLabel.set("value",this.selectedValue||"");},updateSelection:function(){this.set("selectedValue",this.txtLabel.value);},validateTextInput:function(F){return true;},txtLabel:null,children:[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"txtLabel",slot:"previewNode",constraints:{validator:function(){if(!this.parent.validateTextInput(this.value)){return{id:this.id,code:E.INVALID,msg:""};}}},onValid:function(){this.parent.updateSelection();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Stepper","mstrmojo._HasLayout","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.expr","mstrmojo.css");var C=mstrmojo.expr.DTP,B=mstrmojo.css,A="mstrmojo-Stepper-ErrValidation";mstrmojo.ui.editors.controls.Stepper=mstrmojo.declare(mstrmojo.Stepper,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.ui.editors.controls.Stepper",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,mouseup,mousemove,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text"></div><div class="prev">-</div></div>',layoutConfig:{w:{textNode:"100%"},xt:true},textInput:null,init:function E(F){var G=F.provider;if(!!mstrApp.isWSStyling){this.layoutConfig=null;}this.children=[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"textInput",slot:"textNode",dtp:G.dtp||C.INTEGER,maxLength:G.maxLength,constraints:{validator:G.validator,max:G.max,min:G.min},onValid:function(){var H=this.parent;B.removeClass(H.domNode,A);G.setVal(parseInt(this.value,10)||0);H.updateDisplayText();}}];this._super(F);this.addDisposable(G);B.addWidgetCssClass(this,"mstrmojo-ui-ctrl-Stepper");},postBuildRendering:function(){this.updateDisplayText();this._super();},updateDisplayText:function D(){this.textInput.set("value",this.provider.getVal());}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.css");var D=mstrmojo.css;var B;mstrmojo.vi.ui.toolbars.TitleToolbar=mstrmojo.declare(mstrmojo.vi.ui.toolbars.Toolbar,null,{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",init:function F(H){this._super(H);D.addWidgetCssClass(this,"mstrmojo-VITitleToolbar");},markupMethods:{onvisibleChange:function A(){var H=this.visible,I=this.domNode;D.toggleClass(I,"visible",H);if(!H){D.onTransitionEnd(I,function(){D.addClass(I,"hidden");});}else{D.removeClass(I,"hidden");}}},getItemMarkup:function E(H){if(!B){B=this._super(H).replace("{@en@n}",'<div class="icn"></div>');}return B;},ontoolbarCfgChange:function G(H){var I=H.value;if(I){if(I.showContextMenu){I.addMenuToolbarBtn("","mnu");}if(I.hasCloseButton){I.addToolbarBtn(I.closeButtonText,"cls",function(K,J){J.parent.close();});}}this._super(H);},onItemContextMenu:function C(H){this.closePopup();if(H.fn){H.fn(H,this);return true;}}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.ui.menus.MenuConfig");var A=mstrmojo.func,J=mstrmojo.desc(2177,"Close");function G(L){return function(N,M){M.openMenu(L,N);};}mstrmojo.ui.menus.ToolbarConfig=mstrmojo.declare(mstrmojo.ui.menus.MenuConfig,null,{scriptClass:"mstrmojo.ui.menus.ToolbarConfig",btns:null,hasCloseButton:false,closeButtonText:J,showContextMenu:true,addCloseButton:function E(L){this.hasCloseButton=true;if(L){this.closeButtonText=L;}},preShowMenu:mstrmojo.emptyFn,addToolbarBtn:function I(R,M,P,L,N,Q){var O={n:R,cls:M,fn:P,ctxt:L,ttp:Q};if(isNaN(N)||N>=this.btns.length){this.btns.push(O);}else{this.btns.splice(N,0,O);}return O;},addDisabledToolbarBtn:function I(O,M,L){var N=this.addToolbarBtn(O,(M||"")+" disabled",mstrmojo.emptyFn,L);N.dsbld=true;},addToolbarPickerBtn:function B(R,M,P,Q,L,N){var O={n:R,cls:M,fn:P,ctxt:L,tp:"pb",menufn:G(Q||this)};if(isNaN(N)||N>=this.btns.length){this.btns.push(O);}else{this.btns.splice(N,0,O);}},addMenuToolbarBtn:function H(P,L,O,M,N){if(!O&&!this.hasMenuItems()){return ;}this.addToolbarBtn(P,L,A.composite([this.preShowMenu,G(O||this),(N||mstrmojo.emptyFn)]),null,M);},addToggleToolbarButton:function D(S,O,Q,N,M,R,L){var P=this.getToggleItemStates(S,O,Q,N,R,L);this.addDualStateItem(M,P[0],P[1],true);},addDualStateItem:function K(M,L,N,O){this["add"+(O?"ToolbarBtn":"MenuItem")](L.n,L.cls,this.getDualStateHandler(M,L,N),L.ctxt,undefined,L.ttp);},getDualStateHandler:function C(M,L,N){var O=this._super(M,L,N);return function(P,Q){O.call(this,P,Q);Q.refresh();};},clear:function F(){this.btns=[];this.hasCloseButton=false;this.closeButtonText=J;this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.string","mstrmojo.dom","mstrmojo.css","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig");var D=mstrmojo.string,A=mstrmojo.dom,E=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function B(){var K=this,J=K.statusList,F=J&&J.length||0,G=K.statusConfig||new mstrmojo.ui.menus.MenuConfig(),L=function(M){return function(N){K.set("status",M);K.onStatusClick(M);};};if(!G.hasMenuItems()&&F){for(var H=0;H<F;H++){var I=J[H];G.addMenuItem(I.n,I.cls||"",L(I),K);}}else{}if(G.hasMenuItems()){G.alignment=K.alignment||{host:E.BOTTOM_LEFT,popup:E.TOP_LEFT};G.hostId=K.id;G.hostElement=K[K.hostElementName]||K.domNode;K.openPopup(G.newInstance());}}function C(){var F=this.statusConfig||this.statusList&&this.statusList.length>1;this.menuButtonNode.style.display=F?"":"none";}mstrmojo.ui.StatusButton=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.ui.StatusButton",markupString:'<div id="{@id}" class="mstrmojo-StatusButton {@cssClass} {@iconClass}" title="{@title}" style="{@cssText}"><div class="mstrmojo-Button {@innerIconClass}"  mstrAttach:click><span class="mstrmojo-text"></span></div><div class="menuButton" mstrAttach:click></div></div>',markupSlots:{textNode:function(){return this.domNode.firstChild;},textSpanNode:function(){return this.domNode.firstChild.firstChild;},menuButtonNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onstatusChange:function(){this.textSpanNode.innerHTML=D.encodeHtmlString(this.status&&this.status.n||"");},onstatusListChange:function(){C.call(this);},onstatusConfigChange:function(){C.call(this);}},status:null,statusList:null,statusConfig:null,onclick:function(F){var G=A.eventTarget(F.hWin,F.e);if(A.contains(this.menuButtonNode,G,true)){B.call(this);}else{if(A.contains(this.textNode,G,true)){this.onButtonClick(this.status,F);}}},onButtonClick:mstrmojo.emptyFn,onStatusClick:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.ScrollableContainer","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Button");var H=mstrmojo.Button.newWebButton,E=mstrmojo.hash,L=mstrmojo.css,J=mstrmojo.dom;var B="grouping",C="highlight",I="disabled";function F(O,Q){J.preventDefault(window,O);J.stopPropogation(window,O);if(this.groupingOverlay.domNode.className.indexOf(C)===-1&&this.domNode.className.indexOf("selected")===-1){return ;}Q=E.copy(Q,{supportsScroll:true,isHostedWithin:false,maxHeight:J.getMaxScrollHeight()});var P=this.parent.getGroupContextMenuConfig(new mstrmojo.ui.menus.MenuConfig(Q),this.k);if(P.hasMenuItems()){this.openPopup(P.newInstance());}}mstrmojo.vi.ui._CanGroup=mstrmojo.provide("mstrmojo.vi.ui._CanGroup",{_mixinName:"mstrmojo.vi.ui._CanGroup",startGrouping:function G(O){L.addClass(this.domNode,B);var Q=this.groupingOverlay;if(!Q){var P=this,S=this.id;this.addChildren({scriptClass:"mstrmojo.ui.ScrollableContainer",cssClass:"groupingOverlay",alias:"groupingOverlay",cssDisplay:"",slot:"domNode",children:[H(mstrmojo.desc(1911,"Group"),function(U){U.cancel();P.groupSelection();},true,{cssClass:"btnGroup",cssDisplay:""}),H("",function(U){var V=mstrmojo.ui.PopupConfig.prototype.ENUM_CORNERS;F.call(mstrmojo.all[S],U.e,{hostId:S,hostElement:this.domNode,alignment:{host:V.BOTTOM_LEFT,popup:V.TOP_LEFT}});},false,{cssClass:"btnMenu",cssDisplay:""})]});this.groupingOverlay.render();var R=this.groupingOverlay.domNode;J.attachEvent(R,"contextmenu",function(U){F.call(P,U,{position:J.getMousePosition(U,window)});});J.attachEvent(R,"click",function(U){var V=U.target;if(V.className.indexOf("mstrmojo-scrollbar")!==-1){J.stopPropogation(window,U);}});}this.setGroupingStatus(O?"":I);this._menuBtnInfo=this.menuBtnInfo;this.menuBtnInfo=null;this._originalContextMenu=this.shouldShowCustomizeContextMenu;this.shouldShowCustomizeContextMenu=function(){return false;};},setGroupingStatus:function K(O){var Q=this,P=[I,C];P.forEach(function(R){L.toggleClass(Q.groupingOverlay.domNode,R,O===R);});},endGrouping:function N(){L.removeClass(this.domNode,B);this.setGroupingStatus("");this.menuBtnInfo=this._menuBtnInfo;delete this._menuBtnInfo;this.shouldShowCustomizeContextMenu=this._originalContextMenu;delete this._originalContextMenu;},initializeDrag:function A(){return this.domNode.className.indexOf(B)===-1;},groupSelection:function D(){this.parent.groupSelection();},widgetResized:function M(){if(this._super){this._super();}var O=this.groupingOverlay;if(O){this.groupingOverlay.updateScrollbars();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.ui._HasMask","mstrmojo.vi._MonitorsAppState","mstrmojo.EditableLabel","mstrmojo.vi.ui.rw.PanelSelectorList","mstrmojo.ui.menus.MenuConfig");mstrmojo.vi.ui.rw.DockedPanelSelector=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.rw.DockedPanelSelector",markupString:'<div id="{@id}" class="mstrmojo-DockedPanelSelector {@cssClass}" style="{@cssText}"><div class="panel-title"><div class="panel-name"></div><div class="panel-menu" mstrAttach:click>&nbsp;</div></div><div class="panel-list"></div><div class="panel-addBtn" mstrAttach:click></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{titleNode:function D(){return this.domNode.firstChild.firstChild;},menuNode:function E(){return this.domNode.firstChild.lastChild;},containerNode:function C(){return this.domNode.childNodes[1];},addBtnNode:function H(){return this.domNode.childNodes[2];},maskNode:function I(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},children:[{scriptClass:"mstrmojo.EditableLabel",alias:"title",slot:"titleNode",editOnClick:false,editOnDoubleClick:true,onTextEditComplete:function A(M){if(M){var L=this.parent;L.parent.renamePanel(L.panels[L.list.getSelectedItems()[0].idx],this.text);this.set("title",this.text);}}},{scriptClass:"mstrmojo.vi.ui.rw.PanelSelectorList",alias:"list",slot:"containerNode",postselectionChange:function G(L){var M=L.added;if(M){var N=this.items[M[0]],O=this.parent;O.parent.selectPanel(N.id);O.title.set("text",N.n);O.title.set("title",N.n);}}}],init:function K(L){this._super(L);this.title.set("editOnDoubleClick",!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign());},panels:null,onAppStateChange:function B(L){this._super(L);this.set("isMasked",mstrApp.isAppStateSelection());this.title.set("editOnDoubleClick",!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign());},setPanels:function F(L,N){this.panels=L;this.set("visible",L.length>1);var M=this.list;M.set("items",L.map(function(P,O){return{n:P.titleText,id:P.k,idx:O};}));M.singleSelect(N);},onclick:function J(V){var P=V.getTarget(),S=this.parent;if(P===this.addBtnNode){S.addPanel();}else{if(P===this.menuNode){var R=new mstrmojo.ui.menus.MenuConfig(),N=mstrmojo.ui.PopupConfig.ENUM_CORNERS;R.hostId=this.id;R.hostElement=this.menuNode;R.setAlignment(N.TOP_LEFT,N.BOTTOM_LEFT);var Q=this.list,O=Q.items.length,U=Q.getSelectedItems()[0].idx,L=this.panels[U],M=this.title;R.addMenuItem(mstrmojo.desc(4719,"Add Panel"),"",function(){S.addPanel();});R.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){S.duplicatePanel(L);});if(U){R.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){S.movePanel(U,U-1);});}if(U<O-1){R.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){S.movePanel(U,U+1);});}R.addSeparator();R.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){M.set("isEditing",true);});if(O>1){R.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){S.deletePanel(L);});}this.openPopup(R.newInstance());}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.Widget","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.ME.MetricDataService");mstrmojo.requiresDescs(3224);var Z=["(",")","{","}","-","+","*","/","<",">","|","~",","],I={" ":true,"@":true},Y=null,X=mstrmojo.dom,K=mstrmojo.css,H=mstrmojo.mstr.EnumDSSXMLObjectTypes,D=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,a=mstrmojo.ME.MetricDataService;function O(f){if(!Y){Y={};var e,d;for(e=0,d=Z.length;e<d;e++){Y[Z[e]]=true;}}return Y.hasOwnProperty(f);}function b(f){if(!f){return false;}var d=f.length,e,g;for(e=0;e<d;e++){g=f.charAt(e);if(g==="["){return false;}if(O(g)||I[g]){return true;}}return false;}function A(c){return b(c)?"["+c+"]":c;}function M(g){if(!g){return null;}var c=g.length,f=g.split("["),e=f.length,j,h;if(e===1){return g.split("@");}else{if(e===3){j=f[1];j="["+j.substring(0,j.length-1);h="["+f[2];}else{if(f[0].length===0){var k=f[1],d=k.indexOf("]");j="["+k.substring(0,d+1);if(d===k.length-1){return[j];}else{h=k.substring(d+2);}}else{var k=f[0];j=k.substring(0,k.length-1);h="["+f[1];}}}return[j,h];}var R={8:true,9:true,10:true};var C=function(d,c){return R[d]&&!/^\".*\"$/.test(c)?'"'+c+'"':c;};var F=function(d,c,e){var f=typeof e==="undefined"?true:R[e];if(c.length===2&&c==='""'){return c;}return d.tp===261&&c.length>=2&&f?(/^\s+$/.test(c.substr(1,c.length-2))?c:c.substr(1,c.length-2)):c;};mstrmojo.ME.MetricToken=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{data:null,markupString:'<span id={@id} class="mstrmojo-token {@cssClass}" mstrAttach:contextmenu></span>',active:false,markupMethods:{ondataChange:function(){var e=this.data,f=this.isEmbeddedFilter(),c=f?"&nbsp;":mstrmojo.string.encodeHtmlString(String(e.v));if(e.v===","){this.domNode.innerHTML=c+"&nbsp;";}else{if(e.tp===259&&e.v==="Desc"){this.domNode.innerHTML="&nbsp;"+c;}else{if(a.isLogicOrCompFunc(e)){this.domNode.innerHTML="&nbsp;"+c+"&nbsp;";}else{this.domNode.innerHTML=c;}}}K.toggleClass(this.domNode,["mstr"],this.isMstrO());K.toggleClass(this.domNode,["nfn"],!this.isFunction());K.toggleClass(this.domNode,["invalid"],e.sta===-1);K.toggleClass(this.domNode,["embeddedFilter"],f);},onactiveChange:function(){mstrmojo.css.toggleClass(this.domNode,["active"],this.active);}},oncontextmenu:function V(c){this.closePopup();if(this.isEmbeddedFilter()){var e=new mstrmojo.ui.menus.MenuConfig({position:X.getMousePosition(c.e,c.hWin),isHostedWithin:false,alignWithAnchor:true});var d=this;e.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){var f=d.parent;if(f&&f.editEmbeddedFilterToken){f.editEmbeddedFilterToken(d);}});this.openPopup(e.newInstance());}},isMstrO:function W(){return !!this.data.oi||!!this.data.rfd;},isFunction:function B(){return this.isMstrO()&&(this.data.oi&&this.data.oi.t===H.Function);},isEmbeddedFilter:function J(){var e=this.data.oi,d=e&&e.t,c=e&&e.st;return this.isMstrO()&&d===H.Filter&&c===D.Filter&&e.isEmbedded;},brackets:A,length:function E(){return this.isEmbeddedFilter()?1:this.data.v.toString().length;},isDelimiter:function U(){return this.data.isDelimiter||(this.length()===1&&O(this.data.v));},split2Tokens:function L(g){var f=this.data,e=f&&f.v.toString(),h=e.substring(0,g),c=e.substring(g);return[{v:h,isNew:true},{v:c,isNew:true}];},mergeTo:function N(e){var g=this.data,f=g&&g.v.toString(),c=e.data.v.toString();return{v:f+c,isNew:true};},brackets:A,setItemInfo:function S(c){var e=this.data;e.v=this.brackets(c.n);e.oi=c;e.sta=1;e.isNew=true;this.set("data",e);this.paint();},spliceContent:function P(k,h,e){var j=this.data,g=j&&j.v.toString(),l=g.substring(0,k);h=(h===null||h===undefined)?(g.length-k):h;var c=g.substring(k+h),f=l+(e||"")+c;j.v=f;j.isNew=true;j.sta=1;j.ift=(this.isAttributeToken()||j.at)&&(j.v.indexOf("@")>=0);if(j.ift){j.at=j.oi||j.at;}else{delete j.at;}delete j.oi;delete j.exv;delete j.extp;delete j.tp;this.set("data",j);this.paint();},isAttributeToken:function G(){return this.data&&this.data.oi&&this.data.oi.t===H.Attribute;},setFormInfo:function Q(e){var f=this.data,c=f.oi||f.at;f.v=this.brackets(c.n)+"@"+this.brackets(e.n);f.exv=e.did;f.extp=8;f.sta=1;f.isNew=true;f.oi=f.at;delete f.at;this.set("data",f);this.paint();}});mstrmojo.ME.MetricToken.isDelimiter=O;mstrmojo.ME.MetricToken.brackets=A;mstrmojo.ME.MetricToken.splitAttrAndAttrForm=M;mstrmojo.ME.MetricToken.quotes=C;mstrmojo.ME.MetricToken.unquotes=F;mstrmojo.ME.MetricToken.QUOTABLE_DATATYPES=R;mstrmojo.ME.MetricToken.argDelimiter={".":",",",":";"}[mstrConfig&&mstrConfig.decimalSep]||",";})();(function(){mstrmojo.requiresClsP("mstrmojo","Widget","css","dom","num");var I=mstrmojo.css,D=mstrmojo.dom,G=mstrmojo.num;mstrmojo.threshold.ColorMarker=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.threshold.ColorMarker",markupString:'<div class = "marker {@cssClass}" id="{@id}" style="{@cssText}" mstrAttach:contextmenu,mousedown,mouseover,mouseout></div>',markupMethods:{onleftChange:mstrmojo.Widget.leftMarkupMethod},hovered:false,selected:false,index:undefined,position:0,updatePosition:function E(M){this.set("position",M);},compValue:undefined,updateCompValue:function K(M){this.set("compValue",M);},realValue:undefined,updateRealValue:function F(M){this.set("realValue",M);},select:function(){this.set("selected",true);},unselect:function(){this.set("selected",false);},onselectedChange:function C(M){if(M.valueWas===false&&M.value===true){I.toggleClass(this.domNode,"selected",true);this.parent.onMarkerSelected(this.index);}else{I.toggleClass(this.domNode,"selected",false);this.parent.onMarkerUnselected(this.index);}this.parent.onMarkerUnhovered(this.index);},oncontextmenu:function H(N){D.preventDefault(window,N.e);var M=this,O=M.parent.parent;var P=new mstrmojo.ui.menus.MenuConfig({position:D.getMousePosition(N.e,N.hWin),isHostedWithin:false});P.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){O.bands.remove(M.index);O.markers.remove(M.index);O.update();});this.openPopup(P.newInstance());},onmousedown:function B(M){this.set("selected",!this.selected);},onmouseover:function L(){this.set("hovered",true);},onmouseout:function J(){this.set("hovered",false);},onhoveredChange:function A(M){if(!this.selected){if(M.valueWas===false&&M.value===true){I.toggleClass(this.domNode,"selected",true);this.parent.onMarkerHovered(this.index);}else{I.toggleClass(this.domNode,"selected",false);this.parent.onMarkerUnhovered(this.index);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.EditableLabel","mstrmojo.ui.menus.MenuConfig","mstrmojo.css");var A=mstrmojo.css,N=mstrmojo.dom,M="draggedTab",J="stopDragging",m=1,L=2,q=4,G=8,l=16;function n(r){return function(){A.toggleClass(this.tabStripMenuNode,"active",r);};}function h(AC){var w=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:N.getMaxScrollHeight()}),r=this.getMenuActions(),AA=this.index,t=this.id,u=this.total,x=this.parent,s=function(){var AD=x&&x.getTabs();return AD&&AD.length>AA?AD[AA]:mstrmojo.all[t];};if((r&l)>0){this.addNewTabMenuItem(w);}if((r&q)>0){var z=mstrmojo.desc(3397,"Duplicate"),AB=this.parent.scriptClass;if(AB.indexOf("LayoutTabStrip")>=0){z=mstrmojo.desc(15022,"Duplicate Chapter");}else{if(AB.indexOf("PanelTabStrip")>=0){z=mstrmojo.desc(14923,"Duplicate Page");}}w.addMenuItem(z,"dup",function(){s().tabDuplicated();});}if((r&L)>0){if(AA){w.addMenuItem(mstrmojo.desc(5362,"Move Left"),"lft",function(){s().tabMoved(true);});}if(AA<u-1){w.addMenuItem(mstrmojo.desc(5363,"Move Right"),"rgt",function(){s().tabMoved(false);});}}w.addSeparator();if((r&m)>0){w.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){s().lbl.set("isEditing",true);});}if((r&G)>0){if(u>1){w.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){s().tabDeleted();});}}var v=this.getCustomMenu();if(v&&v.hasMenuItems()){w.addSeparator();w.absorbMenuItems(v);}w.addPopupHandlers(this.id,n(true),n(false));this.showTabMenu(this.updateMenuCfg(w),AC);}mstrmojo.vi.ui.tabs.Tab=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._HasMenuPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.tabs.Tab",markupString:'<div id="{@id}" class="mstrmojo-VITab unselectable {@cssClass}" style="{@cssText}" unselectable="on" mstrAttach:contextmenu,click><div><div class="mstrmojo-VITab-tab"></div><div class="mstrmojo-VITab-menu"></div></div></div>',markupSlots:{containerNode:function S(){return this.domNode.firstChild.firstChild;},menuBtnNode:function p(){return this.domNode.firstChild.lastChild;}},markupMethods:{ontitleChange:function I(){this.lbl.set("text",this.title);},onisSelectedChange:function j(){mstrmojo.css.toggleClass(this.domNode,"selected",this.isSelected);},onzIndexChange:function k(){this.domNode.style.zIndex=this.zIndex;}},zIndex:1,menuBtnNode:null,lbl:null,title:"",index:-1,total:-1,isSelected:false,isCutoff:false,isHidden:false,isLeftMost:false,isRightMost:false,leftEdgeHiddenWidth:0,rightEdgeHiddenWidth:0,children:[{scriptClass:"mstrmojo.EditableLabel",alias:"lbl",editOnClick:false,onTextEditComplete:function W(s,r){if(s){this.parent.titleEdited(this.text,r);}}}],postBuildRendering:function Q(){var r=this.isValidMode();if(!r||(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview())){this.draggable=false;}this.lbl.set("editOnDoubleClick",r);this._super();},oncontextmenu:function b(r){this.onclick(r);r.preventDefault();},onclick:function e(r){var t=this.domNode;if(A.hasClass(t,J)){A.removeClass(t,J);return ;}var s=function(){if(this.isValidMode()){this.postTabClicked(this,r);}};if(!this.isSelected){this.tabSelected({success:s.bind(this)});}else{s.call(this);}},postTabClicked:function o(u,s){u=this.findSelectedTab(this)||u;var r=u.menuBtnNode,v=s.getTarget().className===r.className,t;if(v){t=N.position(r);}if(s.name==="contextmenu"||(v&&!(t.x||t.y))){t={x:s.e.clientX,y:s.e.clientY};}if(t){h.call(u,t);}},getMenuActions:function d(){return 0;},getCustomMenu:function Y(){return null;},isDragValid:function R(){return this.parent.children.length>1&&!this.lbl.isEditing&&this.isValidMode();},createAvatar:function U(){var r=document.createElement("div");r.appendChild(this.domNode.cloneNode(true));r.style.margin="-5px 0 0 10px";return r;},addTabDnDStyle:function X(){var r=this.lbl.domNode;if(r&&!this.isSelected){A.addClass(r,M);}},clearTabDnDStyle:function F(){var r=this.lbl.domNode;if(r&&!this.isSelected){A.removeClass(r,M);}},allowDrop:function D(r){var s=r.src.widget;return s&&s.parent===this.parent;},dropTab:function K(r){var u=r.src,t=u.data,s=u.widget;s.clearTabDnDStyle();this.parent.moveTab(t.idx,this.index,t.fromIdx);},ondragenter:function H(s){this._super(s);var u=s.src.data,t=s.src.widget,r=this.index;this.parent.moveTab(u.idx,r);u.idx=r;},ondragover:function a(t){var r=t.tgt.node,s=t.tgtData,u=s&&s.node,v=t.src.widget;if(!s||u!==r){t.tgtData={node:r};}if(v&&!v.isSelected){v.addTabDnDStyle();}},ondragleave:function P(r){this._super(r);var s=r.src.widget;if(s&&!s.isSelected){s.addTabDnDStyle();}},ondragend:function C(r){this._super(r);A.addClass(this.domNode,J);this.dropTab(r);},getDragData:function c(){var t=this.id,r=this.index;return{setAvatarClass:function s(u){var x=mstrmojo.all[t],v=x.avatar;if(v){var w=[x.avatarCssClass,"hasOwnAvatar",u];v.className=w.join(" ");}},fromIdx:r,idx:r};},getDropAvatarIcon:function B(){return"pivot";},isValidMode:function E(){return !((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())||(mstrApp.allowWebDashboardDesign&&!mstrApp.allowWebDashboardDesign()));},cleanUpAfterTarget:function f(r){this.clearTabDnDStyle();this._super(r);},onAppStateChange:function g(s){var u=this.lbl,t=this.isValidMode(),r=mstrApp.isLayoutPreview(s.value);u.set("isEditing",false);u.set("editOnDoubleClick",t);this.draggable=t&&!r;},onLayoutModeChange:function O(s){var t=this.isValidMode(),r=mstrApp.isLayoutPreview(s.value);this.draggable=t&&!r;},addNewTabMenuItem:function V(r){this.throwAbstractMethodError("addNewTabMenuItem");},findSelectedTab:mstrmojo.emptyFn,tabSelected:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,tabMoved:mstrmojo.emptyFn,tabDeleted:mstrmojo.emptyFn,tabDuplicated:mstrmojo.emptyFn,showTabMenu:mstrmojo.emptyFn,updateMenuCfg:function Z(r){return r;}});mstrmojo.vi.ui.tabs.Tab.ACTIONS={NEW_TAB:l,RENAME:m,MOVE:L,DUPLICATE:q,DELETE:G};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo._HasEditableText","mstrmojo.ui.Pulldown");var K=mstrmojo.array,H=mstrmojo.dom,D=mstrmojo.hash,A=mstrmojo.Enum_Keys,C=19,M=A.ENTER,E=A.ESCAPE,N=A.DOWN_ARROW,F=A.UP_ARROW;mstrmojo.ui.SearchablePulldown=mstrmojo.declare(mstrmojo.ui.Pulldown,[mstrmojo._HasEditableText],{scriptClass:"mstrmojo.ui.SearchablePulldown",editableSlot:"selectedNode",allowCustomText:false,isSearching:false,editOnClick:false,init:function P(V){this._super(V);var Q=this.getPopupList();Q.renderOnScroll=this.renderOnScroll||Q.renderOnScroll;Q.renderBlockSize=this.renderBlockSize||Q.renderBlockSize;var U=[];if((mstrApp.isWorkstation&&H.isMac())||H.isSafari){U=["clip-safari"];}mstrmojo.css.addWidgetCssClass(this,["mstrmojo-ui-SearchablePulldown"].concat(U));var S=Q.constructor.prototype,R=Q.getItemProps||S.getItemProps,W=Q.getItemMarkup||S.getItemMarkup;Q.getItemProps=function(b,Y){var Z=this._spft||"",d=b.n,a=d?d.toUpperCase().indexOf(Z):-1,X=function(f){var e=[],g;K.forEach(f.split(";"),function(h){g=h.split(":");if(g.length===2&&g[0].toLowerCase()!=="color"){e.push(h);}});return e.join(";");};if(a===-1){Z="";}var c=R.call(this,b,Y);if(this.selectedIndices[Y]){c.style=X(c.style);}if(d){c.before=d.slice(0,a);c.input=d.substring(a,a+Z.length);c.after=d.slice(a+Z.length,d.length);}return c;};Q.getItemMarkup=function(Z,X){var Y=W.call(this,Z,X);if(Z.n&&Z.v!=="u;"){return Y.replace("{@en@n}","{@en@before}<span class='sp-highlight'>{@en@input}</span>{@en@after}");}return Y;};this._originalFocusOnPopup=this.focusOnPopup;this.focusOnPopup=false;},onclick:function O(Q){if(this._originalFocusOnPopup!==undefined){this.focusOnPopup=false;}if(this.isClickingAnchorSlot(Q)){var S=Q.e.offsetX>=(this.selectedNode.offsetWidth-C),R=this.getPopupWidget().visible;if(!R||(R&&S)){this.set("isEditing",!R);this._super(Q);}else{if(!this.isEditing){this.set("isEditing",true);}}}},setDefaultListAndIndex:function(V,W){var U=this.getPopupList(),R=this.text,Q=K.find(V,"n",R);if(Q===-1&&!this.allowCustomText){var S=U.items[0]||V[0];Q=K.find(V,"n",S.n);}U.set("items",V);if(W){this.set("selectedIndex",Q);}},onPopupWidgetClosed:function I(Q){this.set("isEditing",false);var R=this.getPopupList(),S=R._oldItems;delete R._oldItems;if(S){this.setDefaultListAndIndex(S,Q&&Q.pressingEnter);}},_set_selectedIndex:function G(S,Q){if(this.allowCustomText&&Q===-1){this.selectedIndex=-1;this.onitemSelected(null,Q);}else{this.isSearching=false;this._super(S,Q,true);if(this.hasRendered){var R=this.selectedNode;this.text=R.innerText||R.textContent;}}return true;},onkeydown:function J(S){this._super(S);var R=window.event||S.e,U=R.keyCode,Q=this.getPopupWidget();if(U===M){Q.close({pressingEnter:true});}else{if(this._originalFocusOnPopup&&(U===N||U===F)){this.focusOnPopup=true;if(Q.focus){Q.focus();}Q.raiseEvent(S);}}},onkeyup:function B(S){var Q=window.event||S.e,U=Q.keyCode,R=this.getPopupWidget();this._super(S);if(U===E||U===M){R.close();}else{if(U!==N&&U!==F){this.processSearch();}}},processSearch:function L(){this.isSearching=true;this.hideTooltip();var Q=[],S=this.getPopupList(),V=this.selectedNode.innerHTML,W=S._oldItems||S.items,R=V.toUpperCase(),U;R=R.replace(/<BR>/,"");if(R.length>0){K.forEach(W,function(X){U=X.n;if(U&&U.toUpperCase().indexOf(R)>-1){Q.push(D.clone(X));}},this);}else{Q=W;}S._spft=R;if(this.customizeSearchResult){this.customizeSearchResult(Q);}S.set("items",Q);if(S.adjustCornersForPopupOverflow){S.adjustCornersForPopupOverflow();}delete S._spft;S._oldItems=W;S.set("visible",S.items.length!==0);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.expr","mstrmojo.Button","mstrmojo.ui._HasListTooltip","mstrmojo.ui.PopupWidget","mstrmojo.ui.Pulldown","mstrmojo.ui.CheckList");var E=mstrmojo.hash,L=mstrmojo.array,K=mstrmojo.dom,G=mstrmojo.Button.newWebButton,F=mstrmojo.expr.TP.DIM;function H(Q){var R=this.parent,S=this.list;if(Q){this.saveSelection();R.submitSelections();}else{S.selectedIndices=E.copy(R.selectedIndices);}this.close();}mstrmojo.ui.PulldownCheckList=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PulldownCheckList",visible:false,itemCssText:"",onOpen:function C(){var Q=this.list;Q.updateScrollbars();},onClose:function N(){this.list.refresh();},adjustCheckListForPopupOverflow:function M(S){var V=this.domNode,U,R,Y=this.list,X=Y&&(Y.scrollNode||Y.scrollboxNode);if(S&&X){U=K.position(V);R=U.y;if(R+U.h>K.position(document.body).h){var Q=V.offsetHeight,W=X&&X.offsetHeight;X.style.maxHeight=K.getMaxScrollHeight()-(Q-W)+"px";Y.updateScrollbars();}}},getItemFromTarget:function O(Q){return this.list.getItemFromTarget(Q);},getItemNodeFromTarget:function B(Q){return this.list.getItemNodeFromTarget(Q);},adjustCornersForPopupOverflow:function J(){var Q=this._super();this.adjustCheckListForPopupOverflow(Q);return Q;},saveSelection:function D(){this.parent.set("selectedIndices",E.copy(this.list.selectedIndices));},postselectionChange:function I(a){var Z=this.list,X=Z.items,Y=a.added||[],V=a.removed||[],U=Z.selectedIndices,Q=this.parent.allIdx,W=X[Q],S=Y.length+V.length,R=false;if(W&&W.t===F&&S===1){if(Q===Y[0]){X.forEach(function(c,b){if(!U[b]){R=true;U[b]=L.indexOf(V,b)===-1;}});}else{if(Q===V[0]){U={};L.forEach(Y,function(b){U[b]=true;});R=true;}else{if(U[Q]){delete U[Q];R=true;}}}}if(R){Z.set("selectedIndices",E.copy(U));Z.refresh();}},onitemsChange:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"list",postBuildRendering:function A(){this.icnCssText=this.parent.itemCssText||this.icnCssText;this.parent.adjustCheckListForPopupOverflow();},postselectionChange:function I(Q){this.parent.postselectionChange(Q);},onitemsChange:function P(Q){this.parent.onitemsChange(Q);}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-Buttons",children:[G(mstrmojo.desc(1442,"Ok"),function(){H.call(this.parent.parent,true);},true,{cssDisplay:"inline-block"}),G(mstrmojo.desc(2140,"Cancel"),function(){H.call(this.parent.parent,false);},false,{cssDisplay:"inline-block"})]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.hash","mstrmojo.array","mstrmojo.Button","mstrmojo.Label","mstrmojo.ToolSeparator","mstrmojo.ui.ScrollableContainer","mstrmojo.ui.Pulldown");mstrmojo.requiresDescs(1442,8689,11952,11953,11954,11955,11956,11957,12136);var D=mstrmojo.hash,K=mstrmojo.array,G=mstrmojo.Button.newWebButton,O=function(Q){if(Q){var P=Q.t;return Math.round(P/10)==52||P==115;}return false;},M={},L,E,I,F,H,B=function(){var e=this,U=e.vis,X=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",allowHTML:true,text:mstrmojo.desc(11952,"Use  <span>#</span> to filter the following targets:").replace("#",U.title),visible:true},{scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"VisContainer",cssClass:"mstrmojo-scrollable-container",children:[]},{scriptClass:"mstrmojo.ToolSeparator"},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-filter-type",cssDisplay:"table-cell",alias:"filterType",selectedIndex:(!!H&&H.length>0)&&!E&&!L?1:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(8689,"Filter"),v:true},{n:mstrmojo.desc(11953,"Highlight"),v:false}],onitemSelected:function(h){M.isFilter=h.v;this.isFilter=h.v;e.csl.set("enabled",Q>0&&this.isFilter);e.forType.set("enabled",this.isFilter);},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-type-label",cssDisplay:"table-cell",text:mstrmojo.desc(11954,"data on selection"),visible:true},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-for-type",cssDisplay:"table-cell",alias:"forType",value:0,visible:false,selectedIndex:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(11955,"for #").replace("#",(I[0]||{}).n),v:false},{n:mstrmojo.desc(11956,"for All Data"),v:true}],onitemSelected:function(h){M.forAllData=h.v;},onenabledChange:function(){mstrmojo.css[this.enabled?"removeClass":"addClass"](this.domNode,["disabled"]);}},{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-clear-check",alias:"csl",checked:(L?L.showall:true),cssDisplay:"block",label:mstrmojo.desc(11957,"Allow users to clear all selections"),enabled:false,oncheckedChange:function(){M.clearAll=this.checked;}}],R=U.parent.children,b,Z={},Q=0,V=function(l){var k=R[l],j=k.boxContent,n=j.isVisMap,o,p,h,m;if(H){o=mstrmojo.array.find(H,"k",k.k)!==-1;}else{if(I.length>0){if(I[0]&&I[0].sc&&I[0].sc.tks){o=I[0].sc.tks.indexOf(k.k)>-1;}}}Q+=o?1:0;if(k!==U&&O(k.defn)){p=k.boxContent.getFilterType();h=k.boxContent.model.getSelectorControlMapInfo();if(n){m=j.getAllLayerKeys(true);K.forEach(m,function(q){Z[q]={c:false,v:o,ft:p,cgbs:h};});}else{Z[k.k]={c:false,v:o,ft:p,cgbs:h};}X[1].children.unshift({scriptClass:"mstrmojo.CheckBox",cssDisplay:"block",label:k.title,checked:o,oncheckedChange:function(){var q=this.checked;if(n){m=j.getAllLayerKeys(true);K.forEach(m,function(r){Z[r]={c:true,v:q,ft:p,cgbs:h};});}else{Z[k.k]={c:true,v:q,ft:p,cgbs:h};}M.targetKeys=Z;Q+=this.checked?1:-1;e.forType.set("enabled",Q>0&&e.filterType.isFilter);e.filterType.set("enabled",Q>0);e.csl.set("enabled",Q>0&&e.filterType.isFilter);}});}};for(b=R.length-1;b>=0;b--){V(b);}var Y=U.boxContent,f=Y&&Y.isVisMap;if(f){var c=mstrmojo.desc(14751,"Use % of <span>#</span> to filter the following targets:"),S=c.split("%"),a=S&&S.length,g,P,W,d=K.map(Y.getGraphicLayerNameArr(),function(h){return{n:h.n,v:h.k};});if(a!==2){return ;}g=S[0].replace("#",U.title);P=S[1].replace("#",U.title);W={scriptClass:"mstrmojo.HBox",cssClass:"",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",allowHTML:true,text:g,visible:true},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"",cssDisplay:"table-cell",alias:"sourceLayer",selectedIndex:K.find(d,"v",Y.getKeyForTemplateSelection()),isHostedWithin:true,enabled:true,items:d,onitemSelected:function(h){M.layerKey=h.v;M.isLayerChanged=h.v!==Y.getKeyForTemplateSelection();}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",allowHTML:true,text:P,visible:true}]};X.splice(0,1,W);}this.addChildren(X);this.targetKeys=Z;};mstrmojo.vi.ui.editors.VisAsFilterDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.VisAsFilterDialog",title:mstrmojo.desc(12136,"Filtering options"),cssClass:"mstrmojo-vis-as-filter",btnAlignment:"right",vis:null,buttons:null,modal:true,visible:false,help:"filtering_options_dialog_box_html5.htm",onOpen:function C(){this.VisContainer.onOpen();},postBuildRendering:function A(){this._super();M={};},toggleFields:function J(){if(I.length!==0){this.forType.set("visible",true);this.filterType.set("enabled",true);}if(H&&H.length>0){this.filterType.set("enabled",true);}if(L){this.csl.set("enabled",true);}},preBuildRendering:function N(){var U=this,P=U.id,W=U.vis,V=W.boxContent,S=V.isVisMap,R=S?V.getWidgetForTemplateSelection().node.defn:W.defn,Q=V.model;I=(Q.getSelectorControlMapInfo?Q.getSelectorControlMapInfo():[]);if(I.length>0){L=I[0].sc;F=I[0].did;E=true;}else{H=R.an;L=V.selectorControl||(V.findSelectorControl&&V.findSelectorControl());E=false;}this.set("buttons",[G(mstrmojo.desc(1442,"OK"),function(){if(!D.isEmpty(M)){M.targetKeys=U.targetKeys;M.singleUnit=E;if(E){M.unitId=F;}M.sc=L;W.model.setVisAsFilter(W,M);}mstrmojo.all[P].destroy();},true),G(mstrmojo.desc(221,"Cancel"),function(){mstrmojo.all[P].destroy();})]);B.call(this);this.toggleFields();this._super();}});mstrmojo.vi.ui.editors.VisAsFilterDialog.open=function(Q){var P=mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.VisAsFilterDialog",vis:Q});P.open();};}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.StackContainer","mstrmojo.TabContainer","mstrmojo.TabStrip","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.ui._IsValidURL","mstrmojo.ui.Checkbox");var H=mstrmojo.array,S=mstrmojo.Button,X=mstrmojo.css,O=mstrmojo.hash,A=mstrmojo.string,P=S.newWebButton,K=mstrmojo.mstr.EnumDSSXMLObjectTypes,Q="http://",N={DISABLED:-1,URL:0,LINK_MSTR:1,LINK_PAGE:3},D=function(a,o,d,k,p){var q=function(r,t,s){if(s){return"<"+r+t+">"+s+"</"+r+">";}return"<"+r+t+"/>";},n=function(s,r){return(s!==undefined?" "+r+'="'+s+'"':"");},h=k?1:undefined,j=2,m=(a===N.URL?A.encodeXMLAttribute(o||""):undefined),c=0,f=(a===N.LINK_MSTR?d.did:undefined),Z=(a===N.LINK_MSTR?d.t:undefined),b=(a===N.LINK_MSTR?d.st:undefined),e=(a===N.LINK_PAGE?d.navPage:undefined),l=A.encodeXMLAttribute(p||""),g=1;return q("hls",n(h,"onw"),q("hl",n(g,"idf")+n(j,"aopam")+n(l,"dtxt")+n(m,"url")+n(a,"lt")+n(Z,"ttp")+n(f,"tid")+n(b,"tstp")+n(e,"np")+n(c,"so")));},B=N.DISABLED,F={},I=function I(Z){if(Z.linkType!==undefined){return Z.linkType;}if(Z.node.data.tid){return N.LINK_MSTR;}if(Z.node.data.navpage){return N.LINK_PAGE;}if(Z.url){return N.URL;}return N.DISABLED;},G=function G(Z){return A.decodeHtmlString((Z.defn.dl&&Z.defn.dl.items&&Z.defn.dl.items[0]&&Z.defn.dl.items[0].n)||Z.tooltip||"");},J=false,E=false,L=function L(){var f=mstrmojo.all[this.hostId],Z=f.node&&f.node.data,e=this.tabgroup.tabstack,b=e.selectedLinkType,d=(B!==b),g=(G(f)!==this.tooltip.text.value),c,a,h=false;if(this.hasRendered&&!J){switch(b){case N.DISABLED:h=d;break;case N.URL:c=e.linkText.text.value;if(!mstrmojo.string.isEmpty(c)&&c!==Q&&this.isValidURL(c)){h=d||(c!==f.url)||g;}break;case N.LINK_MSTR:a=(f.target==="_blank");if(F.did){h=d||(!Z||Z.tid!==F.did)||(a!==this.openNewWin.check.checked)||g;}break;case N.LINK_PAGE:if(F.navPage){h=d||(!Z||Z.navpage!==F.navPage)||g;}break;}this.set("dirty",h);}},C=function(j){if(j){var f=this,o=f.docModel,k=mstrmojo.all[this.hostId],g=this.tabgroup.tabstack,l=g.rwSelector,h=g.pageSelector&&g.pageSelector.text,a=g.selectedLinkType,Z=a===N.URL?true:a===N.LINK_PAGE?false:this.openNewWin&&this.openNewWin.check.checked,c=this.tooltip.text.value,n=A.encodeHtmlString(c),d=a!==N.URL?undefined:g.linkText.text.value,b,e,p,q,r=function(){if(k&&k.model.getSelectedViUnit().k===k.parent.k&&k.parent.id){k.model.selectVIUnit(k.parent.id,true);}k.parent.generateToolbar();},m=function(s){E=true;k.defn.dl=s.dl;k.target=s.target;k.url=s.url;k.tooltip=s.tooltip;k.linkType=s.linkType;k.node.data.tnm=s.linkObjInfo.n;k.node.data.tid=s.linkObjInfo.did;k.node.data.ttp=s.linkObjInfo.t;k.node.data.tstp=s.linkObjInfo.st;k.node.data.navpage=s.linkObjInfo.navPage;k.node.data.navpagenm=s.linkObjInfo.n;g.set("selectedLinkType",s.linkType);g.linkText.text.set("value",s.url||"");f.tooltip.text.set("value",s.tooltip);if(l){l.search.text.set("value",s.linkObjInfo.n||"");f.openNewWin.check.set("checked",s.target==="_blank");}if(h){h.set("selectedIndex",s.linkObjInfo.idx||0);}E=false;r();};if(!E){if(a===N.DISABLED){b="";q=true;}else{if(d||F||Z!==undefined){b=D(a,d,F,Z,n);}}e={dl:O.clone(k.defn.dl),target:k.target,url:k.url,tooltip:k.tooltip,linkType:k.linkType,linkObjInfo:{n:k.node.data.tnm||k.node.data.navpagenm,did:k.node.data.tid,navPage:k.node.data.navpage,t:k.node.data.ttp,st:k.node.data.tstp}};if(c!==undefined||q!==undefined){k.tooltip=q?"":n;if(k.defn.dl){k.parent.defn.dl.items[0].n=q?"":n;}}o.editLink(k.parent,f.hostType,b,{success:function(s){k.linkType=a;o.partialUpdate(s.data,o.getTargetDefn(k.k),s.defn);if(a===N.LINK_MSTR){g.linkText.text.set("value","");if(l){l.search.text.set("value",F.n);}if(h){h.set("selectedIndex",0);}}if(a===N.LINK_PAGE){g.linkText.text.set("value","");if(l){l.search.text.set("value","");}if(h){h.set("selectedIndex",F.idx);}}if(a===N.URL){g.linkText.text.set("value",d);if(l){l.search.text.set("value","");}if(h){h.set("selectedIndex",0);}}if(a===N.DISABLED){delete k.defn.dl;delete k.node.data.dl;delete k.target;delete k.url;g.linkText.text.set("value","");if(l){l.search.text.set("value","");}if(h){h.set("selectedIndex",0);}}else{k.target=Z?"_blank":"";f.tooltip.text.set("value",c);if(l&&l.visible){f.openNewWin.check.set("checked",Z);}}p={dl:O.clone(k.defn.dl),target:k.target,url:k.url,tooltip:k.tooltip,linkType:g.selectedLinkType,linkObjInfo:{n:k.node.data.tnm||k.node.data.navpagenm,did:k.node.data.tid,navPage:k.node.data.navpage,t:k.node.data.ttp,st:k.node.data.tstp}};r();},undo:function(){m(e);},redo:function(){m(p);}});}}this.close();},Y=function(d){var c=0,b=[{n:mstrmojo.desc(15776,"Select a page in this dossier"),idx:c++}],f=d.defn.layouts,a,Z,e;H.forEach(f,function(g){a=g.units;b.push({n:g.title,idx:c++});Z=d.getVisPanelKeys(g.k,true);H.forEach(Z,function(h){e=a[h];b.push({n:e.ttl,navPage:h,idx:c++});});});return b;},M=function M(Z){return Z.node.data.tnm;},U=function U(d,b){var a=d.children,Z=H.find(a,"alias",this._pageTab.alias),c=(Z>-1),e=H.filter(b,function(f){return f.navPage;}).length>1;if(!c&&e){H.insert(a,1,this._pageTab);}else{if(c&&!e){H.removeIndices(a,Z,1);if(d.selectedLinkType===N.LINK_PAGE){d.set("selectedLinkType",N.URL);}}}},W=function W(){var l=mstrmojo.all[this.hostId],c=l.node.data.navpage,j=Y(this.docModel),e=this.tabgroup,d=e.tabstrip,k=e.tabstack;U.call(this,k,j);d.clearButtons();d.ontargetChange();var a=k.linkText,f=k&&k.rwSelector,Z=k.pageSelector,h=Z&&Z.text,g=this.openNewWin,m=G(l);B=I(l);if(B===N.LINK_MSTR){if(mstrApp.isSingleTier){F={};m="";l.set("tooltip",m);B=N.DISABLED;}else{F={n:l.node.data.tnm,did:l.node.data.tid,t:l.node.data.ttp,st:l.node.data.tstp};}}else{if(B===N.LINK_PAGE){var b=H.filterOne(j,function(n){return n.navPage===c;});F=b?{navPage:c,n:l.node.data.navpagenm,idx:b.idx}:{};}else{F={};if(B===N.DISABLED){m="";l.set("tooltip",m);}}}k.set("selectedLinkType",B===N.DISABLED?k.selected.linkType:B);a.tooltip="";a.text.set("value",l.url||"");if(f){f.tooltip="";f.search.text.set("value",M(l));}if(h){Z.tooltip="";h.set("items",j);h.set("selectedIndex",F.idx||0);}if(g){g.check.set("checked",B===N.LINK_MSTR?l.target==="_blank":true);}this.tooltip.text.set("value",m);k.selected.tooltip=m;this.set("dirty",false);};mstrmojo.ui.editors.controls.LinkGroup=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.vi.ui._IsValidURL],{scriptClass:"mstrmojo.ui.editors.controls.LinkGroup",dirty:false,onOpenCallback:mstrmojo.emptyFn,onCloseCallback:mstrmojo.emptyFn,init:function R(j){this._super(j);var h=[],g=this,m=mstrmojo.all[this.hostId],a=m.url||"",f=M(m),l=Y(this.docModel),b=[],Z=new mstrmojo.ui.editors.controls.TwoColumnContainer({alias:"linkText",linkType:N.URL,n:mstrmojo.desc(9922,"URL"),tooltip:"",children:[{scriptClass:"mstrmojo.Label",slot:"col1Node",text:mstrmojo.desc(9922,"URL")},{scriptClass:"mstrmojo.TextBox",slot:"col2Node",alias:"text",hint:Q,value:a||Q,onfocus:function(){if(!this.value){this.set("value",Q);}},onblur:function(){if(this.value===Q){this.set("value","");}},onkeydown:function(n){if(n.e.keyCode===13){this.blur();}},onvalueChange:function k(){var n=this,o=function(){n.set("textValid",false);n.domNode.setAttribute("title","");};if(this.hasRendered){if(g.isValidURL(this.value)){o();}else{if(this.value){this.setInvalidState(mstrmojo.desc(12068,"Invalid URL"));}else{o();}}L.call(g);}}}]}),c=new mstrmojo.ui.editors.controls.TwoColumnContainer({alias:"rwSelector",linkType:N.LINK_MSTR,n:mstrmojo.desc(2711,"File"),tooltip:"",children:[{scriptClass:"mstrmojo.Label",slot:"col1Node",text:mstrmojo.desc(2711,"File")},{scriptClass:"mstrmojo.Box",alias:"search",slot:"col2Node",cssClass:"linkDoss",children:[{scriptClass:"mstrmojo.TextBox",alias:"text",cssClass:"rwselector"+(f?"":" mstrmojo-empty"),readOnly:true,hint:mstrmojo.desc(13864,"Choose a file"),tooltip:f,value:f,onvalueChange:function(n){if(this._super){this._super(n);}X.toggleClass(this.domNode,"mstrmojo-empty",!this.value);}},S.newIconButton("","icon",function(){var p=this,o=mstrmojo.vi.ui.DatasetUnitMenuUtils,n;g.set("closeOnClick",false);o.showObjectPicker(function q(r){p.parent.text.set("value",r.n);F=r;L.call(g);},[K.DocumentDefinition,K.ReportDefinition])();n=o.getObjectPicker();if(!this._editorCloseFunction){this._editorCloseFunction=n.onClose;n.onClose=mstrmojo.func.composite([n.onClose,function(){g.set("closeOnClick",true);}]);}})]}]}),e=new mstrmojo.ui.editors.controls.TwoColumnContainer({alias:"pageSelector",linkType:N.LINK_PAGE,n:mstrmojo.desc(3687,"Page"),tooltip:"",children:[{scriptClass:"mstrmojo.Label",slot:"col1Node",text:mstrmojo.desc(15697,"Page Name")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"text",slot:"col2Node",cssClass:"linkPage"+(F.idx?"":" mstrmojo-empty"),items:l,selectedIndex:F.idx||0,allowHTML:false,onSelectedItemChange:function(n){var o=(n.idx<=0);if(!o){F=n;L.call(g);}if(!this.value){this.set("value",n.n);}X.toggleClass(this.domNode,"mstrmojo-empty",o);},getPopupListConfig:function d(){var n=this.addDisposable(mstrmojo.ui.Pulldown.prototype.getPopupListConfig());n.listHooks={select:function(q,r,o){var s=r.navPage,p=g.docModel.getVizContentPanel().k;if(!s||p===s){return true;}this.parent.set("selectedIndex",o);if(this.visible&&this.closeAfterSelection){this.close();}},unselect:function(){var o=this.selectedItem,q=o&&o.navPage,p=g.docModel.getVizContentPanel().k;if(!q||p===q){return true;}}};n.getItemProps=function(q,o){var r=mstrmojo._IsList.getItemProps.call(this,q,o),s=q.navPage,p=g.docModel.getVizContentPanel().k;r.style=this.parent.itemCssText||"";if(o===0){r.addCls("hidden");}else{if(!s){r.addCls("chap");}else{if(s===p){r.addCls("curr_pg");}}}return r;};n.getItemMarkup=function(q){var r=q.navPage,p=g.docModel.getVizContentPanel().k,o="<span>"+mstrmojo.desc(15777,"(current page)")+"</span>";if(!r){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';}return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}"><div></div>{@en@n}'+(r===p?o:"")+"</{@tag}>";};return n;}}]});this._pageTab=e;h.push(Z);h.push(e);if(!mstrApp.isSingleTier){h.push(c);}b.push({scriptClass:"mstrmojo.TabContainer",alias:"tabgroup",children:[{scriptClass:"mstrmojo.TabStrip",autoHide:true,alias:"tabstrip",target:this.parent.tabstack},{scriptClass:"mstrmojo.StackContainer",slot:"stack",alias:"tabstack",cssClass:"linkGroup",selectedLinkType:N.URL,onselectedChange:function(){this.set("selectedLinkType",this.selected.linkType);if(g.tooltip){g.tooltip.text.set("value",this.selected.tooltip);}if(g.tabgroup){L.call(g);}},onselectedLinkTypeChange:function(){var n=false;switch(this.selectedLinkType){case N.DISABLED:return ;case N.URL:this.set("selected",Z);break;case N.LINK_MSTR:this.set("selected",c);n=true;break;case N.LINK_PAGE:if(this.hasRendered&&!e.hasRendered){e.render();}this.set("selected",e);break;}if(g.openNewWin){g.openNewWin.set("visible",n);}},postCreate:function(){this.set("selected",Z);},children:h}]},{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:"tooltip",cssClass:"linkGroup",children:[{scriptClass:"mstrmojo.Label",alias:"label",slot:"col1Node",text:mstrmojo.desc(15698,"Tooltip")},{scriptClass:"mstrmojo.TextBox",alias:"text",slot:"col2Node",valueChangeDelay:3000,value:G(m),hint:mstrmojo.desc(12070,"Hyperlink#").replace("#",""),onkeydown:function(n){if(n.e.keyCode===13){this.blur();}},onvalueChange:function k(){g.tabgroup.tabstack.selected.set("tooltip",this.value);L.call(g);}}]});if(!mstrApp.isSingleTier){b.push({scriptClass:"mstrmojo.HBox",alias:"openNewWin",cssClass:"linkNewWindow",visible:false,children:[new mstrmojo.ui.Checkbox({alias:"check",cssDisplay:"inline-block",checked:m.target==="_blank",oncheckedChange:function(){L.call(g);}}),new mstrmojo.Label({cssDisplay:"inline-block",text:mstrmojo.desc(3593,"Open in new window")})]});}b.push({scriptClass:"mstrmojo.Box",alias:"buttons",cssClass:"buttonBox",children:[{scriptClass:"mstrmojo.Box",alias:"rmvBtn",cssDisplay:"inline-block",children:[P(mstrmojo.desc(15701,"Remove Link"),function(){g.tabgroup.tabstack.set("selectedLinkType",N.DISABLED);C.call(g,true);g.close();},false,{alias:"btn",onenabledChange:function(){X.toggleClass(this.domNode,"disabled",!this.enabled);}})]},{scriptClass:"mstrmojo.Box",alias:"rtBtns",cssClass:"buttonBoxRt",cssDisplay:"inline-block",children:[P(mstrmojo.desc(118,"Save"),function(){C.call(g,true);},true,{alias:"saveBtn",cssDisplay:"inline-block",enabled:false,onenabledChange:function(){X.toggleClass(this.domNode,"disabled",!this.enabled);}}),P(mstrmojo.desc(221,"Cancel"),function(){C.call(g,false);},false,{cssDisplay:"inline-block"})]}]});this.addChildren(b);W.call(this);},onOpen:function(){W.call(this);this.buttons.rmvBtn.btn.set("enabled",B!==N.DISABLED);this.onOpenCallback();},onClose:function(){this.onCloseCallback();},oncloseOnClickChange:function(){if(this.closeOnClick&&this._zIndex!==undefined){this.domNode.parentNode.style.zIndex=this._zIndex;delete this._zIndex;this.hoverLock(false);this.lockHover();}else{if(!this.closeOnClick){this._zIndex=this.domNode.parentNode.style.zIndex;this.domNode.parentNode.style.zIndex="1";this.unlockHover();this.hoverLock(true);}}},ondirtyChange:function(){this.buttons.rtBtns.saveBtn.set("enabled",this.dirty);},destroy:function V(Z){this._pageTab.destroy();if(this._super){this._super(Z);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.array","mstrmojo.threshold.ThresholdModel");var G=mstrmojo.array;var I=[{n:mstrmojo.desc(5999,"Replace Text"),v:3},{n:mstrmojo.desc(6000,"Quick Symbol"),v:10},{n:mstrmojo.desc(11898,"Replace With Image"),v:4}];var F=mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL;function B(N,O,M){this.parent.raiseFormatValueChange(N,O,M);}function E(O){var N=this.parent.model,M=N.threshold;this.replaceType.set("enabled",O);this.replaceText.set("enabled",O);this.replaceSymbol.set("enabled",O);if(!O){delete M[N.getReplaceTypeName()];delete M[N.getReplaceTextName()];}}mstrmojo.threshold.TextGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.threshold.TextGroup",nameRow:undefined,replaceRow:undefined,replaceType:undefined,replaceText:undefined,replaceSymbol:undefined,preBuildRendering:function K(){this._sync=true;if(this._super){this._super();}},postBuildRendering:function A(){if(this._super){this._super();}this._sync=false;},children:[{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:"replaceRow",col1Width:"10%",col2Width:"90%",replaceChk:undefined,children:[{scriptClass:"mstrmojo.ui.Checkbox",slot:"col1Node",alias:"replaceChk",oncheckedChange:function D(){E.call(this.parent.parent,this.checked);}},{scriptClass:"mstrmojo.Label",slot:"col2Node",text:mstrmojo.desc(11888,"Enable Data Replace")}]},{scriptClass:"mstrmojo.ui.Pulldown",alias:"replaceType",selectedIndex:0,enabled:false,items:I,onenabledChange:function H(){if(this.enabled){B.call(this,"rtp",this.items[this.selectedIndex].v);}},postselectedIndexChange:function(O){var S=O.value,P=O.valueWas,N=this.parent,M=N.replaceText,R=N.replaceSymbol;if(S!==P){var Q=S===1;M.set("visible",!Q);M.set("hint",S===2?mstrmojo.desc(11889,"Image URL"):"");R.set("visible",Q);B.call(this,"rtp",this.items[S].v);}}},{scriptClass:"mstrmojo.TextBox",alias:"replaceText",enabled:false,onenabledChange:function H(){if(this.enabled){B.call(this,"rtxt",this.value);}},onvalueChange:function J(){B.call(this,"rtxt",this.value);var M=this.parent,N=M.replaceType;if(!M.parent.model.threshold.rtp){B.call(this,"rtp",N.items[N.selectedIndex]);}}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"replaceSymbol",selectedIndex:0,isHostedWithin:false,enabled:false,visible:false,items:F,allowHTML:true,getPopupListConfig:function C(){var M=mstrmojo.ui.Pulldown.prototype.getPopupListConfig();M.getItemMarkup=function N(){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@n}</{@tag}>';};return M;},onenabledChange:function H(){if(this.enabled){B.call(this,"rtxt",this.items[this.selectedIndex].v);}},postselectedIndexChange:function(M){var O=M.value,N=M.valueWas;if(O!==N){B.call(this,"rtxt",this.items[O].v);}}}],setFormatSource:function L(M){var N=this,O=N.parent.model;this.syncControls(function(){var P=M[O.getReplaceTextName()],S=M[O.getReplaceTypeName()];N.replaceRow.replaceChk.set("checked",!!P);var Q=G.find(I,"v",S);N.replaceType.set("selectedIndex",Q===-1?0:Q);if(S!==10){N.replaceText.set("value",P||"");N.replaceSymbol.set("selectedIndex",0);}else{var R=Math.max(G.find(F,"v",P),0);N.replaceSymbol.set("selectedIndex",R);N.replaceText.set("value","");}});}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Editor","HBox","Button","Label","TextBox","hash","dom","css","array","desc");mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.ui.Checkbox","mstrmojo.ui.Pulldown","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(959,2056,15656,15657,15658,15659,15660,15661,2397,2399);var M=mstrmojo.warehouse.EnumDatabaseType,D=mstrmojo.hash,J=mstrmojo.array,I=mstrmojo.dom,L=mstrmojo.css,F=mstrmojo.desc;var Q=[{v:"",n:F(959,"Default")},{v:"General Number",},{v:"Standard"},{v:"Currency"},{v:"Percent"},{v:"Scientific"},{v:"General Date"},{v:"Long Date"},{v:"Short Date"},{n:F(2056,"Custom")}];Q.forEach(function(R){if(R.n===undefined){R.n=R.v;}});var G={};G[M.MSAS]={min:0,max:65535,maxlength:5};G[M.EssBase]={min:0,max:126,maxlength:3};function O(U,W){var S=null,V=G[W],R=/^-?\d+$/;if(R.test(U)){U=parseInt(U);if(V&&U>=V.min&&U<=V.max||!V){S=U;}}return S;}function C(R){var S=/(\"|\-\-|\/\/|\/\*|\*\/)/;return R&&R.length&&!S.test(R);}var K={mptf:{mptso:{pru:1,v:500},mptsim:{pru:1,v:0},mptfms:""},dbt:M.MSAS,so_dft:0,sim_dft:0};function P(){return D.clone(K);}function B(R){switch(R){case"so":return this.config.mptf.mptso;case"si":return this.config.mptf.mptsim;case"fs":return this.config.mptf.mptfms;case"dbt":return this.config.dbt;case"soDefault":return this.config.so_dft;case"siDefault":return this.config.sim_dft;}}function N(){return{mptso:{pru:this.soBox.soDefaultCb.checked?1:0,v:parseInt(this.soBox.soTB.value)},mptsim:{pru:this.siBox.siDefaultCbBox.siDefaultCb.checked?1:0,v:this.siBox.siClBox.siCl.selectedIndex},mptfms:this.fsBox.fsTbBox.fsTb.value};}mstrmojo.PassThroughOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.PassThroughOptions",cssClass:"mstrmojo-PassThroughOptions",title:F(15656,"Pass-through Options"),updatePopupConfig:function H(R,U){if(R){this.onOK=R.onOK;delete R.onOK;}["left","top","width","height","zIndex"].forEach(function(V){if(R[V]!==undefined){this.set(V,R[V]);delete R[V];}}.bind(this));var S=P();D.forEach(R,function(W,V){if(W===undefined){delete R[V];}});this.config=D.copy(R,S);},onOpen:function E(){this.soBox.set("dirty",false);this.soBox.set("valid",true);this.siBox.set("dirty",false);this.fsBox.set("dirty",false);this.fsBox.set("valid",true);var U=B.call(this,"dbt")===M.EssBase,W=B.call(this,"so");L.toggleClass(this.editorNode,"ess",U);this.soBox.soDefaultCb.set("checked",W.pru);if(!W.pru){this.soBox.soTB.set("value",W.v);}else{this.soBox.soTB.set("value",B.call(this,"soDefault"));}if(!U){var S=B.call(this,"si"),R=B.call(this,"fs"),V;this.siBox.siDefaultCbBox.siDefaultCb.set("checked",S.pru);if(!S.pru){this.siBox.siClBox.siCl.select(S.v);}else{this.siBox.siClBox.siCl.select(B.call(this,"siDefault"));}V=J.find(Q,"v",R);if(V<0){V=J.find(Q,"v",undefined);}this.fsBox.fsPdBox.fsPd.set("selectedIndex",V);this.fsBox.fsTbBox.fsTb.set("value",R);}},children:[{scriptClass:"mstrmojo.Box",alias:"soBox",cssClass:"mstrmojo-PassThroughOptions-soBox",processDirty:function A(){var Y=this.parent,V=B.call(Y,"so"),X=V.pru,R=V.v,U=this.soDefaultCb.checked,S=this.soTB.value,W=X!=U||(!U&&R!=S);this.set("dirty",W);},children:[{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:F(15657,"Solve Order:")},{scriptClass:"mstrmojo.TextBox",alias:"soTB",cssClass:"mstrmojo-PassThroughOptions-soTB",cssDisplay:"inline-block",useRichTooltip:true,enabled:false,updateTooltipConfig:function(){var W=this.parent.parent,U=this.domNode,R=I.position(U),V=B.call(W,"dbt"),S=F(15658,"The value has to be between # and ##.").replace("#",G[V].min).replace("##",G[V].max);this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:S,top:R.y,left:R.x};},onvalueChange:function(){var V=this.parent.parent,U=B.call(V,"dbt"),S=O(this.value,U),R=(S!=null);this.set("textValid",R);if(!R){this.showTooltip();}else{this.hideTooltip();}this.parent.set("valid",R);this.parent.processDirty();}},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssClass:"right",text:F(959,"Default")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"soDefaultCb",cssDisplay:"inline-block",cssClass:"right",checked:true,oncheckedChange:function(R){var V=this.parent.parent,S=this.parent.soTB,U=this.checked;S.set("enabled",!U);if(U){S.set("value",B.call(V,"soDefault"));}this.parent.processDirty();}}]},{scriptClass:"mstrmojo.Box",alias:"siBox",cssClass:"mstrmojo-PassThroughOptions-siBox",processDirty:function A(){var Y=this.parent,X=B.call(Y,"si"),W=X.pru,R=X.v,U=this.siDefaultCbBox.siDefaultCb.checked,S=this.siClBox.siCl.selectedIndex,V=W!=U||(!U&&R!=S);this.set("dirty",V);},children:[{scriptClass:"mstrmojo.HBox",alias:"siDefaultCbBox",cssClass:"mstrmojo-PassThroughOptions-siDefaultCbBox",children:[{scriptClass:"mstrmojo.Label",text:F(15659,"Scope Isolation:")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"siDefaultCb",checked:true,oncheckedChange:function(R){var S=this.parent.parent,V=S.parent,U=S.siClBox.siCl;U.set("enabled",!this.checked);if(this.checked){U.select(B.call(V,"siDefault"));}S.processDirty();}},{scriptClass:"mstrmojo.Label",text:F(959,"Default")}]},{scriptClass:"mstrmojo.HBox",alias:"siClBox",cssClass:"mstrmojo-PassThroughOptions-siClBox",children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"siCl",multiSelect:false,orientation:"h",selectedIndex:1,items:[{n:"NONE",v:0},{n:"CUBE",v:1}],onchange:function(R){this.parent.parent.processDirty();}}]}]},{scriptClass:"mstrmojo.Box",alias:"fsBox",cssClass:"mstrmojo-PassThroughOptions-fsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fsPdBox",cssClass:"mstrmojo-PassThroughOptions-fsPdBox",children:[{scriptClass:"mstrmojo.Label",text:F(15660,"Format String:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"fsPd",selectedIndex:0,items:Q,onselectedIndexChange:function(){var S=this.getSelectedItem(),R=S&&S.v===undefined,U=this.parent.parent.fsTbBox.fsTb;U.set("visible",R);if(R){U.set("value","");}else{U.set("value",S&&S.v);}}}]},{scriptClass:"mstrmojo.HBox",alias:"fsTbBox",cssClass:"mstrmojo-PassThroughOptions-fsTbBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fsTb",updateTooltipConfig:function(){var U=this.domNode,R=I.position(U),S=F(15661,'Custom Format String should not be empty or contain ", //, --, /*, */.');this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:S,top:R.y,left:R.x};},onvalueChange:function(){var R=this.parent.parent;R.processDirty();},bindings:{textValid:function(){var R=this.parent.parent.fsPdBox.fsPd.selectedIndex,U=this.parent.parent,W=U.fsPdBox.fsPd.getSelectedItem(),S=W&&W.v===undefined,V=!S||C(this.value);U.set("valid",V);if(!V){this.showTooltip();}else{this.hideTooltip();}return V;}}}]}],processDirty:function(){var S=this.fsTbBox.fsTb.value,R=B.call(this.parent,"fs");this.set("dirty",S!==R);}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:F(2397,"OK"),bindings:{enabled:function(){var U=this.parent.parent.soBox.dirty,S=this.parent.parent.siBox.dirty,W=this.parent.parent.fsBox.dirty,V=this.parent.parent.soBox.valid,R=this.parent.parent.fsBox.valid;return(U||S||W)&&(V&&R);}},onclick:function(){if(this.enabled){var R=this.parent.parent;if(R.onOK){R.onOK(N.call(R));}R.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:F(2399,"Cancel"),onclick:function(){var R=this.parent.parent;R.close();}}]}]});}());(function(){mstrmojo.requiresClsP("mstrmojo","Box","Button","RadioList","Label","array");mstrmojo.requiresClsP("mstrmojo.ui","Pulldown");var H=mstrmojo.desc,R=mstrmojo.css,K=mstrmojo.array;function P(){R.addClass(this.list.domNode,"AdvancedSort-PopupList");this.parent.isActive(true);}mstrmojo.SortRow=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.SortRow",markupString:'<div id="{@id}" class="mstrmojo-SortRow {@cssClass}" style="{@cssText}" mstrAttach:click><div></div><div class="mstrmojo-sort-rule-delete"></div><div style="clear:both;"></div></div>',markupSlots:{containerNode:function O(){return this.domNode.firstChild;},deleteNode:function J(){return this.domNode.children[1];}},sortRule:undefined,sortOrder:undefined,rank:undefined,originalPos:null,isActive:function L(V){this.parent&&this.parent.pulldownActive(V);},onclick:function S(V){if(V.getTarget()===this.deleteNode){this.parent.deleteSortRule(this);}},isAscending:function U(){return this.sortOrder.value===0;},isCustomSort:function C(){return this.sortOrder&&this.sortOrder.value===2;},getSortKey:function F(){return this.sortRule.value;},setPulldownOptions:function Q(W){var V=this.sortRule;V.set("items",V.items.concat(W));},resetPulldownOptions:function E(){this.sortRule.set("selectedIndex",0);this.sortRule.set("items",[{v:"",n:" ",cls:"firstItem"}]);},setSelected:function N(b,X,a){var V=K.find(this.sortRule.items,"v",b);if(X===2){if(V===-1){var W=mstrApp.rootCtrl.docCtrl.model,c=W.findUnitInDataSet&&(W.findUnitInDataSet((b||"").split("!")[1])||{}).n;this.sortRule.set("items",this.sortRule.items.concat([{v:b,n:c}]));V=this.sortRule.items.length-1;}this.sortRule.set("selectedIndex",V);this.sortRule.set("enabled",false);var Y=K.find(this.sortOrder.items,"v",2);if(Y===-1){this.sortOrder.set("items",this.sortOrder.items.concat({n:H(5705,"Custom Sort"),v:2}));Y=this.sortOrder.items.length-1;}this.sortOrder.set("selectedIndex",Y);this.sortOrder.set("enabled",false);}else{if(V===-1){if(!a){this.sortRule.set("selectedIndex",0);this.sortOrder.set("selectedIndex",0);return ;}else{this.sortRule.set("items",this.sortRule.items.concat([{v:b,n:a}]));V=K.find(this.sortRule.items,"v",b);}}this.sortRule.set("selectedIndex",V);var Z=this.sortOrder.items;if(Z.length>2){this.sortOrder.set("items",Z.slice(0,2));}this.sortOrder.set("selectedIndex",(X===0?1:0));}},setRank:function B(V){this.rank.set("number",V);},getRank:function G(){return this.rank.number;},children:[{scriptClass:"mstrmojo.Widget",alias:"rank",number:0,markupString:'<div class="order-column"><div class="draggable-icon"></div><div class="order">{@number}</div></div>',markupMethods:{onnumberChange:function D(){this.domNode.children[1].innerText=this.number;this.refresh();}}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"sortRule",cssClass:"mstrmojo-sort-rule-pulldown",selectedIndex:0,value:"",allowHTML:false,items:[{v:"",n:" ",cls:"firstItem"}],bindings:{enabled:"this.items && this.items.length > 1"},isHostedWithin:false,onPopupWidgetOpened:function M(){P.call(this);},onPopupWidgetClosed:function A(){this.parent.isActive(false);},onitemSelected:function I(V){this.value=V.v;this.parent.parent.itemSelected();}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"sortOrder",cssClass:"mstrmojo-sort-rule-order",value:0,selectedIndex:0,bindings:{enabled:"this.parent.sortRule.items && this.parent.sortRule.items.length > 1"},isHostedWithin:false,onPopupWidgetOpened:function M(){P.call(this);},onPopupWidgetClosed:function A(){this.parent.isActive(false);},onitemSelected:function I(V){this.value=V.v;},items:[{n:H(1885,"Ascending"),v:0},{n:H(1886,"Descending"),v:1}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.num","mstrmojo.dom","mstrmojo.string","mstrmojo.expr","mstrmojo.ui.Pulldown","mstrmojo.MetricSelectorUtility","mstrmojo.hash");var O=mstrmojo.MetricSelectorUtility,N=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition,G=O.OP,a=O.EnumNumberCategory,W=mstrmojo.num,U=mstrmojo.dom,M=mstrmojo.string,R=mstrmojo.expr,Z=R.DTP,K=mstrmojo.hash,I=O.ErrorCode,V={FILTERBYVALUE:0,HIGHEST:1,LOWEST:2,HIGHESTPERCENT:3,LOWESTPERCENT:4},Y=O.OP_NAMES.slice(0),e=O.RANK_OP_NAMES.slice(0),l=function(){var o=function(q){return q===undefined||q===null;},p;for(p=0;p<arguments.length;p++){if(o(arguments[p])){return false;}}return true;},E=function(o){return o===O.Q._G;},b=function(o){return o===O.Q._PT||o===O.Q._PB;},Q=function(p,o){return !(E(p)&&(o===G._IS_NULL||o===G._IS_NOT_NULL));},f=function(p,o){return E(p)&&(o===G._BETWEEN||o===G._NOT_BETWEEN);},B=function(o){return !o.visible||M.isEmpty(o.value);},H=function(p,o){return((p===a.Date||p===a.Time)&&o===O.Q._G)?Z.DATE:Z.REAL;},C=function(p,o){return o+((p&&!M.isEmpty(o)&&!String(o).match(/^\d+%$/))?"%":"");},j=function(p,q,o){if(W.isBigDecimal(q)){return{dtp:Z.BIGDECIMAL,v:q};}else{return{dtp:p,v:C(o,q)};}},c=function(p){if(!p){return p;}if(p.dtp===Z.BIGDECIMAL){var o=String(p.v);if(o&&o.indexOf("#")===-1){return"#"+o+"#";}else{return o;}}else{return p.v;}},A=function(o){return E(o)?G._GREATER_EQUAL:G._LESS_EQUAL;},g=function(p,w,t,o,s){var v=[],u=H(p,w),x=b(w);if(t===G._IN||t===G._NOT_IN){var q=String(o).split(";"),r;for(r=0;r<q.length;r++){if(!mstrmojo.string.isEmpty(q[r])){v.push(j(u,q[r],x));}}}else{if(o!==null){v.push(j(u,o,x));}if(s!==null){v.push(j(u,s,x));}}return v;},h=function(o){this.parent.submit(this,true);},S=function(o){var p=this.parent;if(p.valueChanged||this.value===""){p.submit(this);}},J=function(){this.set("value","");},X=function(){var o=this.parent;o.docSelector.hideWarning();o.valueChanged=true;};mstrmojo.vi.ui.rw.selectors.MetricQualification=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.rw.selectors.MetricQualification",markupString:'<div id="{@id}" class="mstrmojo-vi-metric-qual {@cssClass}" style="{@cssText}"><div class="pulldown"></div><div class="v1"></div><div class="v2"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},leftTextNode:function(){return this.domNode.childNodes[1];},rightTextNode:function(){return this.domNode.childNodes[2];}},children:[{scriptClass:"mstrmojo.ui.Pulldown",alias:"func",isHostedWithin:false,items:Y,isSilentSelected:false,onitemSelected:function(){var t=this.parent,q=t.qua,o=t.opId,u=t.leftText,r=t.rightText,s=t.func.getSelectedItem().v,p=o;if(this.isSilentSelected){return ;}o=t.opId=E(q)?s:G._LESS_EQUAL;if(p!==o){t.opChanged=true;}u.set("visible",Q(q,o));r.set("visible",f(q,o));if(u.hasRendered&&u.visible){t.valueChanged=false;}if(E(q)){this.parent.submit();}else{t.set("qua",s);}}},{scriptClass:"mstrmojo.TextBox",alias:"leftText",slot:"leftTextNode",onEnter:S,onblur:h,onfocus:S,onvisibleChange:J,onvalueChange:X},{scriptClass:"mstrmojo.TextBox",alias:"rightText",slot:"rightTextNode",onEnter:S,onblur:h,onfocus:S,onvisibleChange:J,onvalueChange:X}],init:function k(o){this._super(o);this.func.set("useDarkTheme",!this.docSelector.isInFilterPanel()&&mstrApp.getRootController().isDarkThemeSelected());},parseModel:function d(){var z=this.qua,x=this.cs,AD=this.da,w=this.f,v=this.ft,q=E(z),AA=q?Y:e,AB=l(w,v)?O.getOpIdxByfunc(w,v):A(z),r,s;this.opId=AB;if(AD){var o,u;switch(z){case O.Q._G:o=Number(AD.low).toFixed(0);u=Number(AD.high).toFixed(0);break;case O.Q._RB:case O.Q._RT:o=1;u=AD.cnt;break;case O.Q._PB:case O.Q._PT:o=0;u=100;break;}this.set("low",o);this.set("high",u);}r=(x&&x.length>0)?W.toLocaleString(c(x[0])):"";if(AB===G._IN||AB===G._NOT_IN){for(s=1;s<x.length;s++){r+=";"+W.toLocaleString(String(c(x[s])));}}else{this.set("cs2",(x&&x.length>1)?W.toLocaleString(c(x[1])):"");}if(x&&x.length>0&&b(z)&&!r.match("%")){r=W.toLocaleString(Math.round(x[0].v*10000)/100);}this.set("cs1",r);var AC=this.leftText,t=this.rightText,p=this.func;AC.set("visible",Q(z,AB));AC.set("value",this.cs1);t.set("visible",f(z,AB));t.set("value",this.cs2);p.set("items",AA);p.isSilentSelected=true;p.selectItemByField("v",q?AB:z);p.isSilentSelected=false;this.valueChanged=false;},onquaChange:function L(x){var o=x.valueWas,u=x.value,q=O.getFuncInfo(this.opId,o).ft,t=O.getFuncInfo(this.opId,u).ft,r,p,s;this.opId=A(u);this.changeQual=true;if(o===V.FILTERBYVALUE||u===V.FILTERBYVALUE){var w=O.getFuncInfo(this.opId,u);this.f=w.f;this.ft=w.ft;this.cs=[];this.qualifyOnChanged=true;this.parseModel();this.submit();return ;}if(t!==q){var v=O.getFuncInfo(this.opId,u);if(this.cs&&this.cs.length!==0&&!this.da.nov){r=this.cs[0].v;s=this.da.cnt;if(u===V.HIGHEST||u===V.LOWEST){if(typeof r==="string"){r=W.toString(r,true).replace("%","")/100;}this.cs=[{v:Math.floor(r*s)}];}else{p=Math.ceil((r/s)*10000)/10000;this.cs=[{v:p>1?1:p}];}}else{this.cs=[];}this.f=v.f;this.ft=v.ft;this.parseModel();}if(this.cs&&this.cs.length!==0){this.submit();}},validateValues:function m(x){var z=this.leftText,s=this.rightText,v=this.qua,w=this.opId,r;if(w===G._IS_NULL||w===G._IS_NOT_NULL){this.docSelector.hideWarning();return null;}if(w===G._IN||w===G._NOT_IN){var p=String(z.value).split(";"),u;for(u=0;u<p.length;u++){r=O.doValidation(p[u],this,{refNode:z.inputNode,position:N.TOP,closeOnClick:false},true);if(r.invalid){if(r.errorCode===I.EmptyValue){r.clearValue=true;}return r;}}}else{x=x||z;r=O.doValidation(x.value,this,{refNode:x.inputNode,position:N.TOP,closeOnClick:false},true);var q,t;if(f(v,w)){var o=(x===z)?s:z;q=O.doValidation(o.value,this,{refNode:o.inputNode,position:N.TOP,closeOnClick:false},true);}if(r.errorCode===I.EmptyValue&&(!q||q.errorCode===I.EmptyValue)){t=true;}if(!r.invalid&&!!q){r=q;}if(t){r.clearValue=t;}return r.invalid?r:null;}return null;},submit:function P(z,p){var AA=this.validation&&this.validation.errorCode,o=this.validateValues(z),r=z?z.parent.parent.warning:null,q=r?r.visible:null,w=this.valueChanged||this.value==="",x=!!(w&&o&&o.clearValue),AB=function(){if(q&&p&&o.errorCode===AA){this.set("validation",null);}else{this.set("validation",o);U.setInputSelection(o.refNode);}};if(!o||!o.invalid||x){if(w||this.changeQual||!!this.opChanged){var v=this.qua,u=this.opId,t=this.cs1=Q(v,u)?this.leftText.value:null,s=this.cs2=f(v,u)?this.rightText.value:null;this.cs=g(this.numFmts.cat,v,u,t,s);this.parent.node.data.cs=this.cs;this.changeQual=true;this.forceUnset=x;this.onchange();this.valueChanged=false;this.opChanged=false;this.changeQual=false;if(z){z.blur();}}}else{if(z){AB.call(this);}}if(x||this.qualifyOnChanged){AB.call(this);this.qualifyOnChanged=false;}return !o;},updateData:function D(o,p){this.da=o;this.updateExpr(p);},updateExpr:function n(o){if(o){this.cs=o.cs;this.f=o.f;this.ft=o.ft;this.qua=o.qua;}this.parseModel();},doLayout:function F(){this.layoutConfig=this.layoutConfig?K.copy({xt:true},this.layoutConfig):{xt:true};if(this.parent.isInFilterPanel()){this.layoutConfig.w={containerNode:"65%",leftTextNode:"30%",rightTextNode:"30%"};}this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.css","mstrmojo.hash","mstrmojo.SearchWidget","mstrmojo.ui.Pulldown");var C=mstrmojo.css,F=mstrmojo.dom,H=mstrmojo.hash,E={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},A="sbClear",B="sbSearch";mstrmojo.SearchWidget2=mstrmojo.declare(mstrmojo.SearchWidget,null,{scriptClass:"mstrmojo.SearchWidget2",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td class="mstrmojo-searchBox-firstCell"><div></div></td><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" mstrAttach:keyup,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+A+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+B+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{filterNode:function(){return this.domNode.rows[0].cells[0].firstChild;},inputNode:function(){return this.domNode.rows[0].cells[1].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[2].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[3].firstChild.firstChild;}},filterNode:null,hasFilter:false,onfilterItemSelected:mstrmojo.emptyFn,filterSelectedIndex:null,filterItems:[],onfilterItemsChange:function(){this.filter.set("items",this.filterItems);this.filter.set("selectedIndex",this.filterSelectedIndex);},onfilterSelectedIndexChange:function(){this.filter.set("selectedIndex",this.filterSelectedIndex);},init:function G(J){if(this.hasFilter||J.hasFilter){this.children=[{scriptClass:"mstrmojo.ui.Pulldown",slot:"filterNode",alias:"filter",items:J.filterItems||[],selectedIndex:J.filterSelectedIndex||0,onitemSelected:function I(M,L){var N=this.selectedNode;this.parent.filterSelectedIndex=L;this.parent.onfilterItemSelected(M,N);},getPopupListConfig:function K(){return H.copy({useRichTooltip:true,showTooltip:function L(P,O){var N=F.eventTarget(O,P),M=this.getItemNodeFromTarget(N);if(M&&(M.scrollWidth>M.clientWidth)){this.constructor.prototype.showTooltip.call(this,P,O);}}},this.constructor.prototype.getPopupListConfig.call(this));}}];}this._super(J);},postBuildRendering:function D(){if(this._super){this._super();}if(this.hasFilter){this.filter.set("items",this.filterItems||[]);this.filter.set("selectedIndex",this.filterSelectedIndex||0);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash","mstrmojo.util.ui.ColorPicker","mstrmojo.ui.editors.controls.ColorList","mstrmojo.ui.editors.controls.ColorWheel","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.TextBoxWithLabel","mstrmojo.ui.ButtonBar","mstrmojo.Button","mstrmojo.css","mstrmojo.util.color");mstrmojo.requiresDescs(16164);var R=1,a=2,S=mstrmojo,B=S.css,U=S.array,W=mstrmojo.util.ui.ColorPicker,J=S.util.color,P=Math.round,Z=R,N=0,D=1,X=2,c="txtColor",f="automatic",j="#ffffff",A="transparent";var F=[{n:mstrmojo.desc(12071,"Color fill"),id:N},{n:mstrmojo.desc(12072,"No fill"),id:D},{n:mstrmojo.desc(12073,"Gradient"),id:X}];function O(){return this.color!==f?this.color:this.autoPreviewColor;}function V(m){return J.getCSSColorString(m);}function b(o,n,m){return mstrmojo.Button.newWebButton(o,m,n,{slot:"buttonNode",cssDisplay:"inline-block"});}function l(n){var o={},m=O.call(this);if(n&&(typeof m==="string")){m=V(m);var p=m.toLocaleLowerCase();n.forEach(function(r,q){if((p===r.id.toLocaleLowerCase())&&(p!==A)){o[q]=true;}});}return o;}function Q(m){return{scriptClass:"mstrmojo.ui.editors.controls.ColorList",items:m,selectedIndices:l.call(this,m),postselectionChange:function(n){var q=n.added;if(q){var p=this.parent,o=this.items[q[0]].id;p.set("color",o);p.colorChanged(o);}}};}function G(m){return"#"+m.replace("#","");}function E(){var m=this.txtColor1,p=this.txtColor2,n=this.color,o=false,q=this.colorStyle;switch(q.items[q.selectedIndex].id){case N:n=G(m.value);break;case D:n=A;break;case X:n={or:this.gradientOrientation.getSelectedItems()[0].id,c1:G(m.value),c2:G(p.value)};o=true;break;}B.toggleClass(this.containerNode,"grad",o);this.set("color",n);}function L(m){this.set("activeColor",m);var n=this[m];U.forEach([1,2],function(p){var o=this[c+p];B.toggleClass(o.domNode,"on",o===n);},this);this.colorWheel.set("color",G(n.value));}function K(m,n,o,p){if(typeof o==="string"){if(o===A){o=j;}}else{if(!!o&&o.c1){o=o["c"+m];}else{o=j;}}o=V(o);return{scriptClass:"mstrmojo.TextBoxWithLabel",alias:c+m,cssDisplay:"block",label:n,autoCorrect:false,maxLength:6,size:6,value:o.replace("#",""),bindings:p,onfocus:function(){L.call(this.parent,this.alias);},onvalueChange:function(q){if(!/^[0-9a-fA-F]{0,6}$/.test(q.value)){this.value=q.valueWas;}else{if(this.value.length===6){var r=this.parent;r.colorWheel.set("color",G(this.value));E.call(r);}}}};}function H(){var p=O.call(this),o="this.parent.colorStyle.items[ this.parent.colorStyle.selectedIndex ].id",s=o+" === "+X,r=o+" !== "+D,v=(this.showNoFill&&p===A)?1:0,t=F.slice(0,this.showGradient?3:2),m=0,n=this.showGradient,u=!!p&&p.c1;if(!this.showNoFill){t.splice(1,1);}if(u){v=U.find(t,"id",X);m=p.or?0:1;}this.addChildren([{scriptClass:"mstrmojo.ui.Pulldown",alias:"colorStyle",selectedIndex:v,items:t,visible:(t.length!=1||(u&&!n)),onRender:function q(){if(!n&&u){this.selectedNode.innerHTML='<div class="mstrmojo-ui-Pulldown-Gradient" style="color:#C0C0C0">'+mstrmojo.desc(16164,"Gradient (Not supported)")+"</div>";}},onitemSelected:function(){E.call(this.parent);}},{scriptClass:"mstrmojo.ui.ButtonBar",alias:"gradientOrientation",items:[{n:mstrmojo.desc(2066,"Horizontal"),id:1,css:"h"},{n:mstrmojo.desc(2069,"Vertical"),id:0,css:"v"}],selectedIndex:m,bindings:{visible:s},postselectionChange:function(w){if(w.added){E.call(this.parent);}}},{scriptClass:"mstrmojo.Button",cssClass:"simpleButton",text:mstrmojo.desc(11658,"Swap"),bindings:{visible:s},onclick:function(){var z=this.parent,x=z.txtColor1,AA=z.txtColor2,w=x.value;x.set("value",AA.value);AA.set("value",w);E.call(z);}},K(1,mstrmojo.desc(12074,"Color HEX:"),p,{visible:r,label:o+" === "+X+' ? "'+mstrmojo.desc(12075,"Color 1 HEX:")+'" : "'+mstrmojo.desc(12074,"Color HEX:")+'";'}),K(2,mstrmojo.desc(12076,"Color 2 HEX:"),p,{visible:s}),{scriptClass:"mstrmojo.ui.editors.controls.ColorWheel",alias:"colorWheel",color:(!!p&&!!p.c1)?p.c1:(p||j),onColorPicked:function(w){var x=this.parent;x[x.activeColor].set("value",w.replace("#",""));},bindings:{visible:r}},b(mstrmojo.desc(1442,"Ok"),true,function(){var x=this.parent,w=x.color;if(!w.c1){W.addCustomColor(w);}x.colorChanged(w);}),b(mstrmojo.desc(2140,"Cancel"),false,function(){this.parent.colorCanceled();})]);L.call(this,c+"1");}function e(o){var q=this.sampleNode,p=q.offsetWidth-q.clientWidth,n=q.clientWidth,r=q.clientHeight,s=Math.sqrt(n*n+r*r)-p,m=Math.atan2(r,n)*(-180)/Math.PI+2;q.style.backgroundColor="#FFFFFF";o.display="block";o.top=q.offsetTop+P(r/2)+"px";o.left=q.offsetLeft+"px";o.width=P(s)+"px";o[mstrmojo.dom.CSS3_TRANSFORM]="rotate("+P(m)+"deg)";}function k(){var o=O.call(this),n=this.sampleNode.style;if(o){if(o.c1){var p=B.buildGradient(o.or,o.c1,o.c2);n[B.convertCssToCamelCase(p.n)]=p.v;}else{n.background=o;if(this.showNoFill&&this.noFillNode&&this.enabled){var m=this.noFillNode.style;if(A===o){e.call(this,m);}else{m.display="none";}}}}n.backgroundOrigin="border-box";}mstrmojo.ui.editors.controls.AdvancedColorPicker=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.ui.editors.controls.AdvancedColorPicker",markupString:'<div id="{@id}" class="mstrmojo-ui-AdvColorPicker {@cssClass}" style="{@cssText}" mstrAttach:click><div class="acpToolbar"><div class="acpBtn acpSwatchBtn"></div><div class="acpBtn acpPaletteBtn"></div><div class="acpColor"></div><div class="slash"></div></div><div class="acpContent" ></div><div class="acpButtons" ></div></div>',markupSlots:{swatchBtnNode:function(){return this.domNode.firstChild.firstChild;},paletteBtnNode:function(){return this.domNode.firstChild.childNodes[1];},sampleNode:function(){return this.domNode.firstChild.childNodes[2];},noFillNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.nextSibling;},buttonNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onpickerModeChange:function M(){Z=this.pickerMode;this.renderContent();},oncolorChange:function d(){k.call(this);},onautoPreviewColorChange:function h(){k.call(this);}},color:"#000fff",showGradient:false,showNoFill:true,showAutomatic:false,autoPreviewColor:null,activeColor:c+"1",swatchBtnNode:null,paletteBtnNode:null,colorStyle:null,gradientOrientation:null,txtColor1:null,txtColor2:null,colorWheel:null,pickerMode:R,init:function g(m){this._super(m);this.pickerMode=Z;},renderContent:function I(){this.showPickerForCurrentMode();},showPickerForCurrentMode:function C(){var o=this;this.removeChildren();var p=Z===R;if(p){var n=W.getBasicColors();if(!this.showNoFill){n.shift();if(n[0]._renderIdx!==0){U.forEach(n,function(r,q){r._renderIdx=q;});}}if(this.showAutomatic&&this.color!==f){this.addChildren([{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(4531,"Automatic"),cssClass:"AutomaticOption",onclick:function m(){o.set("color",f);o.colorChanged(f);}}]);}this.addChildren([mstrmojo.hash.copy({alias:"basicColors"},Q.call(o,n)),Q.call(o,(mstrApp&&mstrApp.getPreferredColors)?U.map(mstrApp.getPreferredColors(),function(q){return{n:q,id:q};}):[]),Q.call(o,W.getCustomColors())]);}else{H.call(this);}B.toggleClass(this.swatchBtnNode,"on",p);B.toggleClass(this.paletteBtnNode,"on",!p);this.buttonNode.style.display=p?"none":"block";},colorChanged:mstrmojo.emptyFn,colorCanceled:mstrmojo.emptyFn,onclick:function Y(m){var n=m.getTarget(),o=this.pickerMode;if(n===this.swatchBtnNode){o=R;this.set("pickerMode",o);}else{if(n===this.paletteBtnNode){o=a;this.set("pickerMode",o);}}}});mstrmojo.ui.editors.controls.AdvancedColorPicker.VAL_AUTOMATIC=f;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo._FillsBrowser","mstrmojo.Container","mstrmojo.EnumRWUnitType","mstrmojo.Label","mstrmojo.ui.PopupButton","mstrmojo.ui.Pulldown","mstrmojo.vi.ui.TargetSelector","mstrmojo.vi.ui.TruncatedList");var b=mstrmojo.hash,U=mstrmojo.array,j=mstrmojo.css,J=mstrmojo.dom,a=mstrmojo.Button.newWebButton,h=mstrmojo.EnumRWUnitType,k=null,E=function(l){var m=this.vis.model,o=l.panelKey,n=this.currentPanelKey||m.getVizContentPanel().k;if(o===n){return ;}if(this.targetContainer.getTargetChildren().length===0){this.goToPage(l);return ;}this._tocNavWarn(l);},M=function(){var l=mstrApp.rootCtrl,t=l.view,o=l.toggleViewBar,s=l.tocPanel,p=l.galleryPanel,m=l.datasetsPanel,q=this.vis.model,u=[],r,n;r=[o,m,p];this.isCPVisible=n=t.isCPVisible;U.forEach(r,function(v){u.push(v&&v.getOpenStatus());});this.panelsIsOpen=u;this.panels=r;if(this.tocEnabled){if(!n){t.setIsCPVisible(true,true);}this.isTocNav=s.visible;s.set("isMasked",false);this.setNavIcon(true,true);}if(q.attachEventListener){this.layoutSelectedSubscription=q.attachEventListener("targetLayoutSelected",this.id,E.bind(this));}},F=function(){var o=this.vis.model,m=mstrApp.rootCtrl.view,n=this.panelsIsOpen,l=this.isCPVisible;U.forEach(this.panels,function(p,q){p.setOpenStatus(n[q],true,undefined,false);});if(this.tocEnabled){if(!l){m.setIsCPVisible(l,true);}this.setNavIcon(false,true);}if(o.detachEventListener){o.detachEventListener(this.layoutSelectedSubscription);}},Z=function(u){var v=u.length,m=this.targetContainer.getTargetChildren(),p=m.map(function(w){return w.key;}).sort(U.stringSorter),r=p.length,l,n,s,q,t,o=[];if(v>r){l=r;n=u;q=true;}else{l=v;n=p;q=false;}for(s=0;s<l;s++){if(u[s]!==p[s]){this.targetContainer.addAndRemoveKeys([this.targetKeys[n[s]]],q);return ;}}for(s;s<n.length;s++){t=this.targetKeys[n[s]];if(t){o.push(t);}}if(o.length){this.targetContainer.addAndRemoveKeys(o,q);}},S=function(l){var m=l.getVizContentPanel()._tgtSelections;if(m){m.notify();}},e=function(l){if(this.options){this.csl.set("enabled",l);this.options.set("enabled",l);}};function W(){var l=this.vis.model,n=this.vis.k,m;if(!this.targetSelector){this.targetSelector=this._createTargetSelector();}else{this.targetSelector.set("hostId",this.id);if(!mstrmojo.all[this.vis.id]){m=l.getLayoutKeyByUnitKey(n);if(m===l.getCurrentLayoutKey()){this.targetSelector.setSourceByKey(n);}}}this.showControlOverlay([this.targetSelector]);this.targetSelector.enterSelectMode();}function D(){var n,o=this.sc,l=o&&o.isNavigation&&o.navPage,m=this.options;if(this.vis.model.getVizContentPanel().children){if(m){m.closeDialog();}delete this.children;this.refresh();if(!l||l===this.currentPanelKey){n=b.valarray(this.targetKeys).filter(function(p){return p.v;}).map(function(p){return p.k;}).sort(U.stringSorter);if(n.length){Z.call(this,n);}}}}function V(m){var l=m.boxContent,t=l.isVisMap,r=t?l.getWidgetForTemplateSelection().node.defn:m.defn,n=l.model,o=(this.srcPanelKey===m.model.getVizContentPanel().k),s,q,p;this.cgbs=p=(n&&n.getSelectorControlMapInfo?n.getSelectorControlMapInfo():[]);if(p.length>0){s=p[0].sc;this.unitId=p[0].did;this.singleUnit=true;}else{q=r.an;s=l.selectorControl||(n&&l.findSelectorControl&&l.findSelectorControl());this.singleUnit=false;}this.cachedFiltertypeIndex=(!!q&&q.length>0)&&!this.singleUnit&&!s?1:0;if(k===null){k=o&&(s?s.showall:true);}this.sc=s;this.an=q;}mstrmojo.vi.ui.InlineDialogBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.vi.ui.InlineDialogBase",cssClass:"mstrmojo-inline-dialog",title:mstrmojo.desc(12136,"Filtering options"),targetKeys:null,vis:null,buttons:null,origTargetKeys:[],changes:{},sc:null,singleUnit:null,cgbs:null,unitId:null,an:null,panelsIsOpen:null,panels:null,isCPVisible:null,srcPanelKey:null,shouldNavigate:true,cachedFiltertypeIndex:0,numBoxesChecked:0,optionsStateForRefresh:{openOnRefresh:false,showAll:false},layoutSelectedSubscription:null,tocEnabled:true,isTocNav:false,isOnTocChange:false,selectFilters:false,targetSelector:null,markupString:'<div id="{@id}" class="mstrmojo-Dialog-Bar {@cssClass}" tabindex="0" mstrAttach:click><div class="win mstrmojo-bar"><div class="mstrmojo-bar-content"></div><div class="mstrmojo-bar-buttons"></div></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[0];},buttonNode:function(){return this.domNode.firstChild.lastChild;}},init:function c(m){if(this._super){this._super(m);}this.srcPanelKey=this.vis.parent.k;var l=this.vis.model;if(l.attachEventListener){l.attachEventListener("buildBoxLayoutComplete",this.id,this.buildBoxLayoutComplete);}},buildBoxLayoutComplete:function O(){var l=this.vis.model;if(this.tocEnabled&&!this.isTocNav){this.setNavIcon(true,true);}D.call(this);if(this.isOnTocChange){var n=l.getVizContentPanel()._tgtSelections,m=b.valarray(this.targetKeys).filter(function(o){return o.v;}).map(function(o){return o.k;});if(n){U.forEach(m,function(o){l.getUnitInstance(o,1).parent.toggleBoxSelection(true);if(!n.toggleSelection(o)){n.toggleSelection(o);}});this.isOnTocChange=false;}}S(l);},_createTargetSelector:function B(){return new mstrmojo.vi.ui.TargetSelector({alias:"targetSelector",orientation:"h",hostId:this.id,srcId:this.vis.id});},_createOptionsButton:function R(){var o=this,q=o.vis,m=q.model,n=(this.srcPanelKey===(this.currentPanelKey||m.getVizContentPanel().k));return{scriptClass:"mstrmojo.ui.PopupButton",alias:"options",cssDisplay:"inline-block",isHostedWithin:false,anchorSlot:"btnNode",markupString:'<div id="{@id}" class="mstrmojo-ui-OptionsButton {@cssClass}" style="{@cssText}"><div class="opts" mstrAttach:click></div></div>',markupSlots:{btnNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},onRender:function(){if(this._super){this._super();}j.toggleClass(this.domNode,"disabled",!this.enabled);},onenabledChange:function(){j.toggleClass(this.domNode,"disabled",!this.enabled);},getPopupWidget:function p(){return this.optionEditor;},getPopupConfig:function l(){var s=mstrmojo.ui.PopupConfig.ENUM_CORNERS,r=this.constructor.prototype.getPopupConfig.call(this);r.alignment={host:s.BOTTOM_RIGHT,popup:s.TOP_RIGHT};return r;},openDialog:function(){var s=o.optionsStateForRefresh,r=this.optionEditor;if(s.openOnRefresh){s.openOnRefresh=false;r.clrSel.set("checked",s.showAll);r.open();}},closeDialog:function(){var s=o.optionsStateForRefresh,r=this.optionEditor;if(r.visible){s.openOnRefresh=true;s.showAll=r.clrSel.checked;r.close();}},children:[{scriptClass:"mstrmojo.ui.PopupWidget",alias:"optionEditor",visible:false,onClose:function(){this.clrSel.set("checked",k);this.buttons.enableApply(false);},handleSelectionSubmit:function(r){var s=o.changes;if(r){if(s.clearAll!==undefined){delete s.clearAll;}else{s.clearAll=o.csl.checked;}k=o.csl.checked;S(m);}this.close();},children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-clear-check",cssDisplay:"inline-block",alias:"clrSel",enabled:false,checked:k,label:mstrmojo.desc(11957,"Allow users to clear all selections"),onenabledChange:function(){if(!n){this.enabled=false;this.set("checked",false);}else{if(!o.filterType.isFilter){this.set("checked",true);}else{this.set("checked",k);}}},oncheckedChange:function(){var r=this.parent;if(r){r.buttons.enableApply(this.enabled&&this.checked!==k);}}},{scriptClass:"mstrmojo.Box",alias:"buttons",cssClass:"buttonBox",children:[a(mstrmojo.desc(8473,"Done"),function(){var r=this.parent.parent;r.handleSelectionSubmit(true);},true,{cssDisplay:"inline-block",enabled:false}),a(mstrmojo.desc(221,"Cancel"),function(){var r=this.parent.parent;r.handleSelectionSubmit(false);},false,{cssDisplay:"inline-block"})],enableApply:function(r){this.children[0].set("enabled",r);}}]}]};},validT:function d(m){if(m){var l=m.t;if(this.selectFilters){return Math.round(l/10)===52||l===h.SELECTOR||l===h.MOJOVISUALIZATION;}else{return Math.round(l/10)===52||l===h.MOJOVISUALIZATION;}}return false;},setNavIcon:function I(o,r){var u=this.vis,p=u.model,t=p.getVizContentPanel().parent.selector,s=p.controller.view,m=s.layoutViewer.docLayout.selector,l=mstrApp.rootCtrl,q=l.tocPanel,n=u.k;if(this.isTocNav){q.setTOCIcon(o,r);}else{if(r||!o){m.setLinkIcon(o,r?p.getLayoutKeyByUnitKey(n):null);}t.setLinkIcon(o,r&&u.defn.pnk);}},getTargetKeys:function(){var l=[];b.forEach(this.targetKeys,function(n,m){if(n.v){l.push(m);}});l.sort(U.stringSorter);return this.origTargetKeys=l;},setTargets:function(v){var p=this.targetKeys,m=this.vis,o=m.model,n=this.currentPanelKey||o.getVizContentPanel().k,q=[],u=this.changes,r=this.singleUnit,s=this.srcPanelKey,l=this.filterType;v=o.updateFilterTargetsForSdp(v);U.forEach(this.an,function(w){if(!p[w.k]){p[w.k]={c:false,v:true};}});b.forEach(p,function(x,w){if(U.some(v,function(z){return z===w;})){q.push(w);if(!x.v){x.v=true;x.c=true;}}else{if(x.v){x.v=false;x.c=true;}}});u.filterKeys=q;u.targetKeys=p;u.singleUnit=r;if(r){u.unitId=this.unitId;}if(s!==n){u.isNav=true;u.navPage=n;u.srcKey=s;}u.sc=this.sc;u.isFilter=l&&l.isFilter;var t=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?(t.PAUSE|t.SELECTOR_TARGETING):t.SELECTOR_TARGETING);this._setTargetsFunc();},_setTargetsFunc:mstrmojo.emptyFn,isSelectionDirty:function A(o){var m=false,l=o.length,p=this.origTargetKeys,n=this.changes;o.sort(U.stringSorter);Z.call(this,o);if(l===p.length){U.forEach(o,function(r,q){if(r!==p[q]){m=true;return false;}});if(m){return m;}if(l>0){if(this.cachedFiltertypeIndex!==this.filterType.selectedIndex){return true;}if(n.isLayerChanged){return true;}if(n.clearAll!==undefined){return true;}}return false;}return true;},goToPage:function Q(l){var m=this.vis.model,n=l.layoutKey,o=l.panelKey;m.raiseEvent({name:"layoutSelected",panelKey:o,layoutKey:n});},_tocNavWarn:mstrmojo.emptyFn,onTocPageChange:function(n){var m,l;if(this._super){this._super(n);}if(this.visible){if(this.srcPanelKey===this.currentPanelKey){m=this.vis.model.getVizContentPanel().children;if(m){l=U.find(m,"k",this.vis.k);if(l!==-1){this.vis=m[l];}}else{return ;}}this.setNavIcon();if(!this.isTocNav){this.setNavIcon(true,true);}this.isOnTocChange=true;D.call(this);}},open:function K(){var l=this.vis;this.shouldNavigate=false;W.call(this);M.call(this);if(l.setSelectTargetsState){l.setSelectTargetsState(false);}},close:function X(){var m=this.vis;mstrApp.rootCtrl.view.closeInlineDialog();F.call(this);this.targetContainer.addAndRemoveKeys(this.targetContainer.getTargetChildren());var l=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?l.PAUSE:l.DEFAULT);k=null;if(m.setSelectTargetsState){m.setSelectTargetsState(true);}},cancel:function P(){var l=this.vis.model,n=l.getLayoutKeyByUnitKey(this.vis.k);var m=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?(m.PAUSE|m.SELECTOR_TARGETING):m.SELECTOR_TARGETING);l.raiseEvent({name:"layoutSelected",panelKey:this.srcPanelKey,layoutKey:n});},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width;}},updateViz:function N(l){this.vis=l;this.srcPanelKey=this.vis.parent.k;this.targetSelector.set("srcId",this.vis.id);this.shouldNavigate=true;D.call(this);this.shouldNavigate=false;},toggleFields:function g(){var m=this.filterType,l=this.cgbs;if(l.length!==0){this.forType.set("visible",true);}if(this.sc){e.call(this,true);}if(this.srcPanelKey===(this.currentPanelKey||this.vis.model.getVizContentPanel().k)&&(b.keyarray(this.targetKeys).length>0||l.length!==0)){m.set("enabled",true);}else{m.set("enabled",false);m.set("selectedIndex",0);}},_createTruncatedList:function H(){var l=this;return{scriptClass:"mstrmojo.vi.ui.TruncatedList",alias:"targetContainer",cssDisplay:"inline-block",items:[{alias:"defaultItem",cls:"tgtDefault",n:mstrmojo.desc(15090,"Please click on visualizations to select targets"),key:"-1"}],padding:12,overflowCls:"truncMore",cmCssClass:"mstrmojo-bar-overflow",setWidth:function m(){var q=this.parent,o=this.id,r,s=this.padding,p=parseInt(q.width,10);if(!this.width&&J.position(q.buttonNode).w){U.forEach(q.children,function(t){r=t.domNode;if(r&&t.id!==o){p-=Math.ceil(J.position(r).w+(t.scriptClass==="mstrmojo.ui.Pulldown"||t.alias==="ctrlOverlay"?0:s));}});if(J.isMac()&&(J.isSafari||mstrApp.isWorkstation)){p-=s;}this.width=p+"px";}this.domNode.style.width=this.width;},getAdditionalProperties:function n(p,o){if(o===0&&this.items.length>2){p.addCls("hide");}return p;},updateFields:function(){var p,o=l.filterType&&l.filterType.isFilter;l.numBoxesChecked=this.items.length-1;p=l.numBoxesChecked>0;l.forType.set("enabled",p&&o);e.call(l,p&&o);},getTargetChildren:function(){return this.items.slice(1);},addAndRemoveKeys:function(r,p){var o,s=false,q=this.items;if(p){s=true;U.forEach(r,function(t){if(!t.mp||t.mp===t.k){q.push({n:t.t,cls:"tgtItem",cssClass:"tgtItem",key:t.k});}});}else{U.forEach(r,function(t){o=t?U.find(q,"key",t.k||t.key):-1;if(o>-1){s=true;q.splice(o,1);}});}if(s){this.refresh();this.updateFields();l.setNavIcon(q.length!==1);}}};},_addVis:function Y(m,n){var u=this,l=u.vis,o=m.boxContent,v=o.isVisMap,s=u.cgbs||[],t=u.an,x,r,q,p;if(t){x=mstrmojo.array.find(t,"k",m.k)!==-1;}else{if(s.length>0){if(s[0]&&s[0].sc&&s[0].sc.tks){x=s[0].sc.tks.indexOf(m.k)>-1;}}}u.numBoxesChecked+=x?1:0;if(m!==l&&u.validT(m.defn)){var w=m.defn.t===h.SELECTOR;if(!w){r=o.getFilterType();q=o.model.getSelectorControlMapInfo();}if(v){p=o.getAllLayerKeys(true);U.forEach(p,function(z){n[z]={c:false,v:x,ft:r,cgbs:q,t:m.title,k:z,mp:m.k};});}else{n[m.k]={c:false,v:x,ft:r,cgbs:q,t:m.title,k:m.k};}}},_addChildren:function L(){var z=this,n=z.vis,v=n.model,p={scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-filter-type",cssDisplay:"inline-block",alias:"filterType",selectedIndex:z.filterType?z.filterType.selectedIndex:this.cachedFiltertypeIndex,isHostedWithin:true,isFilter:true,enabled:false,items:[{n:mstrmojo.desc(8689,"Filter"),v:true},{n:mstrmojo.desc(11953,"Highlight"),v:false}],onitemSelected:function(AC){this.isFilter=AC.v;e.call(z,z.numBoxesChecked>0&&this.isFilter);z.forType.set("enabled",this.isFilter);if(this.enabled){S(v);}},onenabledChange:function(){j.toggleClass(this.domNode,"disabled",!this.enabled);}},q=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:mstrmojo.desc(15031,"Use visualization <span>#</span> to").replace("#",n.title),visible:true},p,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-type-label",cssDisplay:"inline-block",text:mstrmojo.desc(15032,"data on selection in"),visible:true},z._createTruncatedList(),{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-for-type",cssDisplay:"inline-block",alias:"forType",value:0,visible:false,selectedIndex:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(11955,"for #").replace("#",(this.cgbs[0]||{}).n),v:false},{n:mstrmojo.desc(11956,"for All Data"),v:true}],onitemSelected:function(AC){z.changes.forAllData=AC.v;},onenabledChange:function(){j.toggleClass(this.domNode,"disabled",!this.enabled);}},z._createOptionsButton()],l=v.getPanel(this.currentPanelKey,this.currentLayoutKey).children||[],u,s={};for(u=l.length-1;u>=0;u--){z._addVis(l[u],s);}var r=n.boxContent,AA=r&&r.mapViewer&&r.isVisMap;if(AA){var t=n.title,AB="Use % of <span>#</span> to % the following targets:",w=mstrmojo.desc(15162,AB),m=w.split("%")||[],o,x=U.map(r.getGraphicLayerNameArr(),function(AC){return{n:AC.n,v:AC.k};});if(m.length!==3){m=AB.split("%");}o=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:m[0].replace("#",t),visible:true},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"",cssDisplay:"inline-block",alias:"sourceLayer",selectedIndex:U.find(x,"v",r.getKeyForTemplateSelection()),isHostedWithin:true,enabled:true,items:x,onitemSelected:function(AD){var AC=z.changes;AC.layerKey=AD.v;AC.isLayerChanged=AD.v!==r.getKeyForTemplateSelection();S(v);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:m[1].replace("#",t),visible:true},p,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:m[2].replace("#",t),visible:true}];q.splice(0,3);q=o.concat(q);}this.addChildren(q);this.targetKeys=s;this.csl=this.options.optionEditor.clrSel;},preBuildRendering:function C(){var o=this,p=o.vis,l=p.model,q,n,m,r;V.call(this,p);q=this.sc;n=this.an;if(this.shouldNavigate&&n&&n.length){m=l.getLayoutKeyByUnitKey(n[0].k);r=q&&q.isNavigation&&q.navPage;if(r&&r!==this.currentPanelKey){this.shouldNavigate=false;l.raiseEvent({name:"layoutSelected",panelKey:r,layoutKey:m});}}this._addChildren();this.addChildren([{scriptClass:"mstrmojo.Box",cssClass:"ctrlOverlay",alias:"ctrlOverlay",slot:"buttonNode"}]);this.toggleFields();this._super();},postBuildRendering:function f(){var l=this.targetContainer,m=this.sc;this.editorNode.style.width=this.width;this._super();this.changes={};if(k!==(m?m.showall:true)){this.changes.clearAll=k;S(this.vis.model);}W.call(this);if(l&&!l.width){l.setWidth();}if(this.options){this.options.openDialog();}},showControlOverlay:function G(n,m){var o=this.ctrlOverlay,q=o.domNode;function p(r){var s=r.children;if(s&&s.length){r.removeChildren();s.forEach(function(t){t.destroy();});}}if(q){var l=["ctrlOverlay","or-h"];if(m){l.push(m);}q.className=l.join(" ");}o.set("visible",true);p(o);o.addChildren(n);j.addClass(this.domNode,"overlay");}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.Obj","mstrmojo.ui.ButtonBar","mstrmojo.ui.Checkbox","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ThreeColumnContainer");var D=mstrmojo.hash;mstrmojo.vi.models.editors.ControlsViewFactory=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.editors.ControlsViewFactory",getEditorGroup:function B(H,I){return new mstrmojo.vi.ui.editors.EditorGroup(D.copy(I,{children:H}));},getLabelAndControl:function G(J,K,M,O,L,N){var P=new mstrmojo.Label({text:J,setDimensions:function(S,Q){var R=this.domNode;if(R){R.style.width=Q;}}}),I=P,H=K;if(L){I=K;H=P;}I.slot="col1Node";H.slot="col2Node";return new mstrmojo.ui.editors.controls.TwoColumnContainer(D.copy(N,{col1Width:M||"40%",col2Width:O||"60%",children:[I,H],getLabel:function(){return P;},getCtrl:function(){return this.children.filter(function(Q){return Q!==P;})[0];}}));},getLabelAndControlWithMsg:function C(L,M,P,O,S,H,N,Q){var R=new mstrmojo.Label({text:L,setDimensions:function(X,V){var W=this.domNode;if(W){W.style.width=V;}}}),U=new mstrmojo.Label({text:P?mstrmojo.desc(14548,"Changes will be applied after Desktop is restarted."):"",setDimensions:function(X,V){var W=this.domNode;if(W){W.style.width=V;}},setText:function(V){this.text=V;}}),K=R,J=M,I=U;if(N){K=M;J=R;}K.slot="col1Node";J.slot="col2Node";I.slot="col3Node";return new mstrmojo.ui.editors.controls.ThreeColumnContainer(D.copy(Q,{col1Width:O||"30%",col2Width:S||"30%",col3Width:H||"40%",children:[K,J,I],getLabel:function(){return R;},getCtrl:function(){return this.children.filter(function(V){return V!==R;})[0];},getMessage:function(){return U;}}));},getPulldown:function F(I,L,H,K,J){return mstrmojo.ui.Pulldown.newPulldown(I,function(M,N){L.call(this,M.v,N&&N.v);},H,K,J);},getCheckboxAndLabel:function A(N,L,K){var J=new mstrmojo.ui.Checkbox({checked:N,oncheckedChange:function(){var O=this.checked;K.call(this,O,!O);}});var M=this.getLabelAndControl(L,J,"14px","100%",true);M.cssClass="checkLabel";var I=M.getLabel();I.onclick=function H(){J.onclick();};I.cssDisplay="inline-block";return M;},getButtonBar:function E(J,H,L,K){K=K||{};K.items=J;var I=new mstrmojo.ui.ButtonBar(K);I.singleSelect(H);I.postselectionChange=function(M){var N=this.items,O=N[M.removed&&M.removed[0]];L.call(this,N[M.added[0]],O);};return I;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ListPreviewButton","mstrmojo.css");var C,D=mstrmojo.css;var J=mstrmojo.declare(mstrmojo.ui.PopupList,null,{getItemMarkup:function G(K){if(!C){C=this._super(K).replace(">{@en@n}<","><div>{@en@n}</div><");}return C;},getItemProps:function F(M,K){var L=this._super(M,K);L.addCls("bst"+K);if(K){L.title=M.n;L.n="";}else{L.tt="";}return L;}});mstrmojo.ui.editors.controls.LineStyleButton=mstrmojo.declare(mstrmojo.ui.editors.controls.ListPreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",itemValueField:"id",showThickOption:true,markupMethods:{onenabledChange:function E(){D.toggleClass(this.domNode,"disabled",!this.enabled);}},init:function H(L){this._super(L);var K=["mstrmojo-ui-LineStyle"];if(!this.showThickOption){K.push("no-thick");}D.addWidgetCssClass(this,K);},getListCfg:function I(){return new J({selectionPolicy:"reselect",items:[{n:mstrmojo.desc(2258,"None"),id:"none"},{n:mstrmojo.desc(2259,"Dashed"),id:"1pt dashed"},{n:mstrmojo.desc(2260,"Dotted"),id:"1pt dotted"},{n:mstrmojo.desc(2262,"Thin"),id:"1pt solid"},{n:mstrmojo.desc(2264,"Thick"),id:"2pt solid"}]});},postBuildRendering:function A(){this.borderStyleNode=this.previewNode.appendChild(document.createElement("div"));return this._super();},updatePreview:function B(){var N=this.borderStyleNode,L=this.selectedValue.split(" "),K=this.selectedValue==="conflict";D.toggleClass(this.previewNode,"conflict",K);if(N&&!K){var M=N.style;if(L.length===1){M.borderTopStyle=L[0];if(L[0]==="none"){M.position="static";N.innerHTML=mstrmojo.desc(2258,"None");N.classList.add("ellipsis");}}else{M.borderTopWidth=L[0];M.borderTopStyle=L[1];M.position="";N.innerHTML="";}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.vi.ui.HierarchyCheckList","mstrmojo.ui._IsIncFetchHierarchyList");var A=mstrmojo.css;mstrmojo.vi.ui.IncHierarchyCheckList=mstrmojo.declare(mstrmojo.vi.ui.HierarchyCheckList,[mstrmojo.ui._IsIncFetchHierarchyList],{scriptClass:"mstrmojo.vi.ui.IncHierarchyCheckList",cssClass:"elementsList"});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.HierarchyCheckList","mstrmojo.EnumSelectionType","mstrmojo.ui.PopupButton","mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.func","mstrmojo.dom","mstrmojo.tooltip","mstrmojo._HasTooltip","mstrmojo.fe.FilterUtils","mstrmojo.vi.ui.rw.selectors._CanSearchOnServer");mstrmojo.requiresDescs(3474,2119,2461,493);var O=mstrmojo.array,f=mstrmojo.css,V=mstrmojo.hash,G=mstrmojo.dom,g=mstrmojo.fe.FilterUtils,A=mstrmojo.EnumSelectionType;var K=28,e=70,Y=196;function X(m,n){var l=[],k=m.parent;n=n||"n";while(k){if(!k.hid&&k[n]){l.push(k[n]);}k=k.parent;}return l;}mstrmojo.vi.ui.rw.selectors.HierarchyCheckList=mstrmojo.declare(mstrmojo.vi.ui.HierarchyCheckList,[mstrmojo.vi.ui.rw.selectors._CanSearchOnServer],{scriptClass:"mstrmojo.vi.ui.rw.selectors.HierarchyCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList hierarchy {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="header"><span class="search-bar"><span class="ph"></span></span><span class="level-bar"><span class="ph"></span></span></div><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div><div class="footer"><div class="all-bar"><span class="allBtn select">'+mstrmojo.desc(3474,"Select All")+'</span><span class="allBtn clear">'+mstrmojo.desc(2119,"Clear All")+"</span></div></div></div>",markupSlots:{headerNode:function F(){return this.domNode.firstChild;},footerNode:function C(){return this.domNode.lastChild;},searchboxNode:function N(){return this.domNode.firstChild.firstChild.firstChild;},levelBtnNode:function S(){return this.domNode.firstChild.lastChild.firstChild;},scrollboxNode:function I(){return this.domNode.children[1];},itemsContainerNode:function h(){return this.domNode.children[1].firstChild;},tooltipNode:function H(){return this.domNode.children[1].firstChild;}},useRichTooltip:true,init:function b(k){this._super(k);if(G.isEdge){f.addWidgetCssClass(this,"edge");}},postBuildRendering:function d(){var l=this.levelBtn;if(!l){var k=this.getLevelPopupConfig(),m=V.walk(k.scriptClass,window);delete k.scriptClass;l=this.levelBtn=new m(k);this.addDisposable(l);}l.placeholder=this.levelBtnNode;l.render();return this._super();},unrender:function c(l){var k=this.levelBtn;if(k){k.unrender(l);}return this._super(l);},onclick:function j(k){var l=k.getTarget();if(f.hasClass(l,"allBtn")){this.doAllSelect(f.hasClass(l,"select"));k.cancel();}else{this._super(k);}},onSelectionChange:function P(l,k,m,n){this._super(l,k,m,n);this.onchange();},doExpandCollapse:function R(p,n){var m=this,l=!n.epd,o=this.scrollNode.scrollTop,k=false;if(this.delegateExpandCollapse){k=this.delegateExpandCollapse({elementId:n.v,isExpand:l},{success:function(q){m.scrollNode.scrollTop=o;}});}if(!k){this._super(p,n);}},searchLevel:-1,searchItems:[],updateItems:function M(k,l){this._super(k,l);this.clearSearch();},isHiearachyDisplay:function E(){return !this.isOnSearch();},showTooltip:function D(k,o){var n=k.target||G.eventTarget(k.hWin,k.e),l=this.getItemFromTarget(n);if(l&&!this.isHiearachyDisplay()){var p=this.getItemNodeFromTarget(n),m=G.position(p);this.tooltipOpenDelay=mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY;this.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:X(l).reverse().join(" > "),refNode:p,top:m.h,left:10};this._super(k,o);}},getSourceDefn:function Q(){var k=this.docSelector;return k&&k.node&&k.node.defn;},getDataService:function J(){var k=this.docSelector;return k&&k.model&&k.model.getDataService();},onSearchSuccess:function U(k,l){var m=[];k.forEach(function(o){var n=this.getItemByValue(o.v);if(!o.hid){m.push(o);}V.copy({lv:o.lv||0,dhid:!n||n.dhid,pid:o.pid?o.pid+";"+l.attributeId:o.pi>-1?k[o.pi].v:""},o);delete o.hcd;delete o.hid;delete o.epd;delete o.pi;},this);this.searchItems=this.searchItems.concat(k);this.addItems(k);m=m.map(function(n){return this.getItemByValue(n.v);},this);this._super(m,l);},widgetResized:function L(){var l=this.searchbox,k=this.footerNode;this._super();if(l&&l.hasRendered){l.onwidthChange();}if(k){f.toggleClass(k,"multi",parseInt(this.width)<Y);this.updateScrollbars();}},getSearchbarCfg:function Z(){return V.copy({scriptClass:"SearchWidget2",hasFilter:true,useRichTooltip:true,showTooltip:function k(o,n){var l=this.filter.selectedNode,m=G.eventTarget(n,o);if(m===l&&m.scrollWidth>m.clientWidth){this.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:l.innerText,refNode:l,top:G.position(l).h+6};this.constructor.prototype.showTooltip.call(this,o,n);}},onwidthChange:function(l){var n=this.filter.selectedNode,m=Math.max(Math.min(this.domNode.clientWidth,this.domNode.parentNode.clientWidth)*0.7-K,e);n.style.width="";if(n.scrollWidth>m){n.style.width=m+"px";}},onfilterItemSelected:function(n,p){var o=this.parent,m=o.searchLevel,l=n.v;o.searchLevel=l;o.expressionXML=l>=0?g.getExprXml(o.getLevelExpression(l)):"";if(this.hasRendered){this.onwidthChange();}},postCreateChildren:function(){this.filter.isHostedWithin=false;},preBuildRendering:function(){var m=this.parent,l=m.getLevelItems(true),n=m.searchLevel;this.filterSelectedIndex=0;this.set("filterItems",l);this.set("filterSelectedIndex",Math.max(O.find(l,"v",n),0));},postBuildRendering:function(){this.constructor.prototype.postBuildRendering.call(this);this.onwidthChange();}},this._super());},renderFilteredItems:function W(k){f.toggleClass(this.footerNode,"hidden",true);this._super(k);},renderOriginalItems:function B(){f.toggleClass(this.footerNode,"hidden",false);this._super();},clearSearchItems:function a(){this.searchItems=[];this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.WidgetTree","mstrmojo.expr","mstrmojo.mstr.EnumNodeProperties","mstrmojo.AndOrNode","mstrmojo.ConditionNode");var H=mstrmojo.expr,B=mstrmojo.mstr.EnumNodeProperties,C=H.ET;function A(I){var K=I&&I.src,L=K&&K.data,J=L&&L.et;return(J in H.ETs);}function E(I){return I&&I.et===C.ANDOR&&!(I.node&B.CONDITION);}mstrmojo.FilterExpr=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.FilterExpr",allowDrop:A,renderOnScroll:false,itemIdField:null,nodeClassMap:{14:mstrmojo.AndOrNode,"*":mstrmojo.ConditionNode},onBlankClick:function(I){this.clearTreeSelect();},onnodemousedown:function(J){var K=mstrmojo.dom.eventTarget(J.hWin,J.e),L=J.src,I=L.listMapper.findIndex(L,L.itemsContainerNode,K),M=I>=0?L.ctxtBuilder.itemWidgets[I]:null;if(!M||(M.isSelectableArea&&!M.isSelectableArea(K))){this.onBlankClick(J);}},getItemIdentityProp:function(I){return I.et;},itemFunction:function(N,K,O){var J=O.tree,L=J.getItemConfig(N,K,O),M=J.nodeClassMap,I=M[J.getItemIdentityProp(N)]||M["*"];return I&&(new I(L));},getItemConfig:function(L,I,M){var J=E(L),K=M.tree||M;return{data:L,tree:K,parent:M,bindings:{prefixedAndOrEditable:"this.parent.editable"},itemFunction:(J)?M.itemFunction:null,draggable:J?K.draggable:false,dropZone:J?K.dropZone:false,allowDrop:J&&K.dropZone?K.allowDrop:null,allowCopy:J?K.allowCopy:false,editable:K.isEditable?K.isEditable(L):K.editable,makeObservable:J&&M.makeObservable,onclick:K.onnodeclick,onadd:K.onnodeadd,onremove:K.onnoderemove};},getDragData:function(I){var K=this._super(I);if(K&&!K.html){var J=K.et&&H.ET2TGT[K.et];K.html=J?K[J]&&K[J].n||"":K.n||"";}return K;},newCondition:function G(M){M=M||{et:C.AQ};var L=this.selectionParentNode,I;L=(L&&L.hasRendered)?L:this;if(L!==this){I=L.add([M]);}else{var K=this.addCondition([M],null,true);I=K.index;L=K.widget;}var J={widget:L,index:I,data:M};if(this.onNew){this.onNew(J);}return J;},addCondition:function F(K,M){var N=this.items,J=N&&N.length,P=K&&K.length;if(!P){return null;}var L,I;if(J&&E(N[0])){L=this.ctxtBuilder.itemWidgets[0];I=L.add(K,null);}else{if(!J&&(P===1)){L=this;I=0;this.add(K,0);}else{if(J){var O=N[0];this.remove(O);K.unshift(O);}this.add([{et:C.ANDOR,fn:H.FN.AND,nds:K}],0);L=this.ctxtBuilder.itemWidgets[0];I=J?1:0;}}return{widget:L,index:I};},addSingleCondition:function D(J,I){var K=this.addCondition([J],I);return K.widget.ctxtBuilder.itemWidgets[K.index];},ondrop:function(L){if(this._super){this._super(L);}var J=this.items,I=J&&J.length,K=J.concat();if(I>1){if(J.remove){J.remove(0,J.length);}else{this.set("items",null);}this.add([{et:C.ANDOR,fn:H.FN.AND,nds:K}],0);}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.hash","mstrmojo.func","mstrmojo.css","mstrmojo.string","mstrmojo.HBox","mstrmojo.Box","mstrmojo.DropDownButton","mstrmojo.Popup","mstrmojo.WidgetTree","mstrmojo.ObjectBrowserDataProvider","mstrmojo.OBList","mstrmojo.FishEyeContainer","mstrmojo.SearchBox2","mstrmojo.Booklet","mstrmojo.IncFetch","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.mstr.ui.IncFetchOBList","mstrmojo.DI.DIConstants");var Q=mstrmojo.hash,Z=mstrmojo.func,A=mstrmojo.string,M=mstrmojo.meta.TP,G="5CECE58CC1D549F890EB61C4DB2156A3",W="E0CCB9CF22104A489CBE78D974AFD19E",S=mstrmojo.chart.model.enums.EnumDSSObjectType,L=mstrmojo.array,E=mstrmojo.dom,P=mstrmojo.DI.DIConstants,b=function(k,l,e){var h=k.scrollableIncFetch,g=h?"mstrmojo.mstr.ui.IncFetchOBList":"mstrmojo.OBList",j={scriptClass:g,items:l.items,multiSelect:e};if(h){j.browseConfig={blockBegin:l.bb,blockCount:l.bc,totalSize:l.sz,folderLinksContextId:k.folderLinksContextId,rootFolderID:l.did,browsableTypes:k.browsableTypes,browsableViewMedias:k.browsableViewMedias,dataProvider:k.dataProvider};j.onwaitingChange=function(){if(k.booklet){k.booklet.set("waiting",this.waiting);}};}var f=mstrmojo.insert(j);f.render();return f;},B=function(g,j,e){var f=mstrmojo.ObjectBrowser.widgetHandler||b;return f(g,j,e);},O={success:function(g){var h=this.ob,f=g.items,j=h.pageCache[h.currentPage],e=j._w;j.items=f;e.set("items",f);this.ob=null;this.item=null;window.clearTimeout(h._btm);h.booklet.set("waiting",false);if(h.scrollableIncFetch&&e.scrollNode){e.initScroll();e.updateScrollbars();}},failure:function(e){window.alert(e.getResponseHeader("X-MSTR-TaskFailureMsg"));this.ob.booklet.set("waiting",false);}},V=function(k,j,g){var h=g?-1:1,f=k.pageCache.length,l;for(l=k.currentPage+h;l<f&&l>=0;l+=h){var e=k.pageCache[l];if(e._k===j.k){return{steps:l-k.currentPage,cache:e};}}return null;},D=function(j,h,g,k){var m=j.currentPage+1,f=j.pageCache.length,e;for(e=m;e<f;e++){j.pageCache[e]._w.destroy();delete j.pageCache[e].items;}j.pageCache=j.pageCache.slice(0,m);k._w=g;k._k=h.k;j.pageCache[m]=k;j.cacheChange();},I=function(f){var e=mstrmojo.hash.walk("anc.items.0.items",f);this.set("canGoUp",!(!f.pf||!e));},J=function(j,h,k,g,f){delete j._btm;var e;if(!g){e=B(j,k,j.multiSelect);e.attachEventListener("change",j.id,"navigate");if(j.useDblSelect||j.useBothSglDblSelect){e.attachEventListener("dblclick",j.id,"dblselect");}}else{e=k._w;}j.obList=e;j.booklet.turn(e,f>0);window.setTimeout(function(){j.onBrowsing=false;},300);if(!g){D(j,h,e,k);}j.set("currentFolder",k);j.set("currentPage",j.currentPage+f);j.updateUpButton(k);if(j.scrollableIncFetch&&e.scrollNode){e.initScroll();e.updateScrollbars();}},R=function(g,f,e){var h=V(g,f,false);h=h||V(g,f,true);if(!h){window.clearTimeout(g._btm);g._btm=window.setTimeout(function(){g.booklet.set("waiting",true);},300);e.ob=g;e.item=f;g.getDataProvider().fetchFolderContents(g,f,e);}else{J(g,f,h.cache,true,h.steps);}},C=function(f,g,h,e){R(f,{fid:f.pageCache[f.currentPage].did,blockBegin:g,searchPattern:h,recursive:e},O);},K={success:function(f){var g=this.ob;if(g){window.clearTimeout(g._btm);if(!f.items){f.items=[{did:"empty",n:"("+mstrmojo.desc(2210)+")",t:"e"}];}var e=function j(k){var n=k.length,l;for(l=0;l<n;l++){var m=k[l];if(m.did===G||m.did===W){m.n=(m.did===G)?mstrmojo.desc(8112):mstrmojo.desc(9277);}if(m.items){e(m.items);}}};if(f.did===G||f.did===W){f.n=(f.did===G)?mstrmojo.desc(8112):mstrmojo.desc(9277);if(f.anc&&f.anc.items){e(f.anc.items);}}if(f&&f.items&&g.browsableViewMedias){var h={};L.forEach(g.browsableViewMedias.split(","),function(k){h[parseInt(k,10)]=true;});f.items=L.filter(f.items,function(k){return(k.t!==S.DssTypeDocumentDefinition)||h[k.dvm];});}if(f&&f.items&&mstrApp&&mstrApp.isSingleTier){f.items=L.filter(f.items,function(k){return(k.st!==772);});}if(g.isImportFromCube){f.items=L.filter(f.items,function(k){return(k.et!==P.DSSExType.DSSEXDISPARK);});}if(f.did&&this.item.k!==f.did){this.item.k=f.did;}J(g,this.item,f,false,1);this.ob=null;this.item=null;}},failure:function(e){this.ob.booklet.set("waiting",false);if(this.ob.onError){this.ob.onError(e);}else{if(e.getResponseHeader){mstrmojo.alert(e.getResponseHeader("X-MSTR-TaskFailureMsg"));}else{mstrmojo.alert(e.message);}}},complete:function(){if(this.ob){this.ob.onBrowsing=false;}}},d=function(g){var f=g.pageCache.length,e;for(e=0;e<f;e++){g.pageCache[e]._w.destroy();}g.pageCache=[];g.currentPage=-1;g.cacheChange();},N=function(h,g,j){var e=h.onBrowseFolder;if(e){e[0][e[1]](g);}if(g&&parseInt(g.acg,10)===33){return ;}var f={};if(g){f.k=g.did;f.fid=g.did;}else{if(h.rootFolderID){f.k=h.rootFolderID;f.fid=h.rootFolderID;}else{if(h.rootFolderType){f.k=h.rootFolderType;f.fty=h.rootFolderType;}else{if(h.folderLinksContextId){f.k=h.folderLinksContextId;}}}}R(h,f,Z.wrapMethods(j,Q.copy(K)));},Y=function(k,e,g){if(!g){return e;}var h=k.showCompletePath,m=e[0],j,f;while(m){var l;for(l=g.length-1;l>=0;l--){if(m.did===g[l].did){g.splice(l,1);m._isSc=true;}}f=m;m._open=true;m=m.items;m=m&&m[0];if(!m){f.lastLeaf=true;}}if(!h){m=e[0];while(m){if(m._isSc){e[0]=m;break;}m=m.items;m=m&&m[0];}}return e.concat(g);},X=function(f,e,g){f._naviInfo=Y(f,e,g);};mstrmojo.ObjectBrowser=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.ObjectBrowser",rootFolderType:null,rootFolderID:null,sId:null,closeOnSelect:true,browsableTypes:null,browsableViewMedias:null,includeObjectDesc:false,closeable:true,fishEyeVisible:false,searchVisible:true,upButtonVisible:false,currentFolder:null,pageCache:[],currentPage:-1,blockCount:50,canGoUp:true,folderLinksContextId:null,minSearchLength:2,showCompletePath:true,multiSelect:false,onCloseCB:null,onSelectCB:null,onBrowseFolder:null,scrollableIncFetch:false,useBothSglDblSelect:false,displaySaveLabel:false,useOldSearch:false,getDataProvider:function(){if(!this.dataProvider){this.dataProvider=mstrmojo.insert({scriptClass:"mstrmojo.ObjectBrowserDataProvider"});}return this.dataProvider;},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";}},children:[{scriptClass:"mstrmojo.HBox",alias:"titleBar",cssClass:"mstrmojo-OB-titleTable",children:[{alias:"saveLabel",scriptClass:"mstrmojo.Label",cssClass:"msrmojo-save-label",text:mstrmojo.desc(3178,"Save in:"),bindings:{visible:"this.parent.parent.displaySaveLabel"}},{alias:"title",scriptClass:"mstrmojo.DropDownButton",cssClass:"mstrmojo-FormatEditor-DropDownButton",cssText:"margin:0px;",popupRef:{scriptClass:"mstrmojo.Popup",alias:"popup",contentNodeCssClass:"mstrmojo-OBNavigatorPopup",cssText:"position:relative;",slot:"popupNode",locksHover:true,onOpen:function(){var e=this.opener.parent.parent,h=this.tree,g=e._naviInfo,f=this.parent.parent.parent.extraDDItems;if(h.items!==g){h._pup=this;this.ob=e;if(f){L.forEach(f,function(j){j.isExtra=true;});g=g.concat(f);}h.set("items",g);}if(e.getRecents&&!mstrApp.isSingleTier){e.getRecents(this);}},children:[{alias:"tree",scriptClass:"mstrmojo.WidgetTree",itemIdField:"did",itemFunction:function(j,e,f){var h=mstrmojo.WidgetTree.prototype.itemFunction(j,e,f);if(j.isExtra){if(j.cssClass){h.cssClass=j.cssClass;}h.onmousedown=j.onmousedown||mstrmojo.emptyFn;return h;}if(j._open){h.state=1;}h._ll=!!j.lastLeaf;h._pup=f._pup;h.onmousedown=function(k){var l=mstrmojo.dom.eventTarget(k.hWin,k.e),m=this._pup;if(l===this.domNode||l===this.textNode){if(!this._ll){N(m.ob,this.data);}m.close();}};h.markupMethods=Q.copy(h.markupMethods);h.markupMethods.onstateChange=function(){var k=this.data.items?this.state:0;this.stateNode.className="mstrmojo-TreeNode-state "+({0:"closed",1:"opened",2:"leaf"}[k]||"closed");this.itemsContainerNode.style.display=(k===1)?"block":"none";};h.useRichTooltip=true;var g=h.postBuildRendering;h.postBuildRendering=function(){if(g){g.call(h);}if(h.textNode.parentNode.clientWidth){h.textNode.style.width=(h.textNode.parentNode.clientWidth-20)+"px";}};h.premouseover=function(m){if(this.useRichTooltip){var l=this.textNode;if(l.clientWidth<l.scrollWidth){var k=E.position(l);this.richTooltip={areaId:this.id,cssClass:"vi-regular vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_TOPLEFT,content:A.encodeHtmlString(this.data[this.itemDisplayField]),top:k.y-2,left:k.x+k.w+6};}else{this.richTooltip=null;}mstrmojo.dom.stopPropogation(m.hWin,m.e);}return true;};return h;}}]}},{alias:"upButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-OBListItemIcon up",title:mstrmojo.desc(1152,"Up One Level"),onclick:function(){this.parent.parent.goUp();},bindings:{enabled:"this.parent.parent.canGoUp",visible:"this.parent.parent.upButtonVisible"}},{alias:"closebtn",scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-OBCloseButton",title:mstrmojo.desc(2102,"Close"),bindings:{visible:"this.parent.parent.closeable"},onclick:function(){this.parent.parent.close();}}]},{alias:"fishEye",scriptClass:"mstrmojo.FishEyeContainer",cssText:"width:100%",bindings:{visible:"this.parent.fishEyeVisible"}},{alias:"searchUpBar",scriptClass:"mstrmojo.HBox",cssClass:"searchBox",children:[{alias:"obSearchBox",scriptClass:"mstrmojo.SearchBox2",cssClass:"mstrmojo-charcoalbox mstrmojo-dxsprite",cssText:"margin: 3px 0; ",contentWidget:mstrmojo.all.obList,taskId:"searchMetadata",searchIncFetch:true,enableMatchCase:false,forceResetCache:true,bindings:{minSearchLength:"this.parent.parent.minSearchLength",quickSearch:"this.parent.parent.quickSearch"},serverRequest:function(e,f){this.parent.parent.getDataProvider().serverRequest(e,f);},preFetch:function(){this.objectTypes=this.parent.parent.browsableTypes||this.objectTypes;this.parent.parent.booklet.set("waiting",true);},postFetch:function(){this.parent.parent.booklet.set("waiting",false);},postBuildRendering:function a(){if(this._super){this._super();}this.inputNode.setAttribute("placeholder"," "+mstrmojo.desc(12666,"Search..."));},onUpdateSearchParams:function H(g){var f=this.parent.parent,e=f.sId;if(e){g.sessionState=e;}if(f.useOldSearch){g.quickSearch=0;g.nameWildcards=1;g.sortKey=6;}}}],bindings:{visible:"this.parent.searchVisible"}},{scriptClass:"mstrmojo.Booklet",cssClass:"mstrmojo-OB-booklet",alias:"booklet",hasAnimation:false,bindings:{scrollableIncFetch:"this.parent.scrollableIncFetch"}},{alias:"obIncFetch",scriptClass:"mstrmojo.IncFetch",height:"17px",cssText:"height:0px;overflow:hidden;",visible:false,np:0,cp:0,ds:{f:mstrmojo.desc(4046,"First"),p:mstrmojo.desc(1058,"Previous"),n:mstrmojo.desc(1059,"Next"),l:mstrmojo.desc(4049,"Last"),pgs:mstrmojo.desc(5972,"## of ### pages"),gt:mstrmojo.desc(5878,"Go to:"),v:mstrmojo.desc(6079,"This field should be # between ## and ###.")},onvisibleChange:function(f){var j=parseInt(this.height,10),e=this.np>1,g={target:this.domNode,props:{height:{start:(e?0:j),stop:(e?j:0),suffix:"px"}},onEnd:function(){if(e){this.target.style.overflow="visible";}}},k=new mstrmojo.fx.AnimateProp(g);this.domNode.style.overflow="hidden";mstrmojo.css.toggleClass(this.parent.domNode,"show-inc-fetch",this.visible);k.play();},onifsChange:function(e){var f=this.np;mstrmojo.hash.copy(e.value,this);if(this.np>1){this.children=null;this.refresh();}if((f<=1&&this.np>1)||(f>1&&this.np<=1)||(f===0&&this.np>0)){this.set("visible",this.np>1);}this.cssText="";}}],destroy:function c(){d(this);if(this._super){this._super();}},postBuildRendering:function(){if(this._super){this._super();}if(this.fishEye&&this.fishEyeVisible){this.fishEye.attachEventListener("selectedIndexChange",this.id,"onFishEyeChange");}var g=this.searchUpBar;if(g&&g.obSearchBox&&this.searchVisible){this.obSearchBox=this.searchUpBar.obSearchBox;this.obSearchBox.attachEventListener("itemsChange",this.id,"onSearchItemsChange");var e=this.obSearchBox.contentWidget||this.obSearchBox;if(!this.scrollableIncFetch){e.attachEventListener("ifsChange",this.id,function(h){if(!this.scrollableIncFetch){this.obIncFetch.set("ifs",h.value);}});}}if(!this.scrollableIncFetch&&this.obIncFetch){var f=this.obIncFetch;f.attachEventListener("fetch",this.id,function(h){f.cp=h.v;f.children=null;f.refresh();C(this,(h.v-1)*this.blockCount+1,this.searchVisible?this.obSearchBox.inputNode.value:"",1);});}mstrmojo.css.addClass(this.domNode,"mstrmojo-ObjectBrowser");},onSearchItemsChange:function(f){var g=f.value,e=this.pageCache[this.currentPage]._w;if(!g||g.length===0){g=[{did:"empty",n:"("+mstrmojo.desc(2210,"")+")",t:"e"}];}else{if(this.browsableViewMedias){var h={};L.forEach(this.browsableViewMedias.split(","),function(j){h[parseInt(j,10)]=true;});g=L.filter(g,function(j){return(j.t!==S.DssTypeDocumentDefinition)||h[j.dvm];});}}e.set("items",g);},navigate:function(n){var e=n.src,o=e.selectedItem,g=this.multiSelect,k=g&&e.getSelectedItems(),l=this,f=n.added&&n.added.length,j=n.removed&&n.removed.length,h=g?k.length===1&&(!j||f):!!o;if(h&&o.did==="empty"){return ;}if(h&&parseInt(o[M],10)===8){if(!this.onBrowsing){this.onBrowsing=true;N(this,o);}}else{if((o&&(!this.useDblSelect||this.useBothSglDblSelect))||k){this.select(g?k:o);}}},browseFolder:function(e,f){N(this,{did:e,n:f});},onFishEyeChange:function(e){this.goToPage(e.value);},goToPage:function(e){if(e<this.pageCache.length&&e!==this.currentPage){var g=e>this.currentPage,f=this.pageCache[e];this.set("currentPage",e);this.booklet.turn(f._w,g);this.set("currentFolder",f);I.call(this,f);}},oncurrentPageChange:function(e){if(this.fishEye){this.fishEye.setSelectedIndex(e.value);}var f=this.pageCache[this.currentPage];this.titleBar.title.set("text",mstrmojo.string.encodeHtmlString(f.n));if(this.searchVisible&&this.obSearchBox){this.obSearchBox.set("rootCacheItems",f.items||[]);this.obSearchBox.set("totalSize",f.sz);this.obSearchBox.set("rootID",f.did);this.obSearchBox.clearSearch();}if(!this.scrollableIncFetch&&this.obIncFetch){this.obIncFetch.set("ifs",{np:Math.floor(f.sz/f.bc)+((f.sz%f.bc>0)?1:0),cp:Math.floor(f.bb/f.bc)+((f.bb%f.bc>0)?1:0)});}},cacheChange:function(){if(this.fishEye&&this.fishEyeVisible){this.fishEye.setItems(this.pageCache);}},browse:function(f,e){Q.copy(f,this);if(this.searchVisible&&this.obSearchBox){this.obSearchBox.clear();}d(this);N(this,undefined,e);},close:function(){var f=this.ctx||this,e=f.onCloseCB;if(e){e[0][e[1]]();}f.set("visible",false);},select:function(f){var e=this.onSelectCB;if(e){e[0][e[1]](f);}if(this.closeOnSelect){this.close();}},dblselect:function U(f){var g=f&&f.src.selectedItem;if(!g||(g&&g.did==="empty")||g[M]===8){return ;}if(this.useBothSglDblSelect){var e=this.onDblSelectCB;if(e){e[0][e[1]](g);}if(this.closeOnSelect){this.close();}}else{this.select(g);}},goUp:function(){if(this.canGoUp){N(this,{did:this.currentFolder.pf});}},updateUpButton:function F(e){I.call(this,e);},oncurrentFolderChange:function(e){var f=e.value;X(this,f.anc.items,f.sc);},refreshContent:function(e){C(this,e);},onError:null,onheightChange:function(){var e=["titleBar","fishEye","searchUpBar","obIncFetch"],g=0,f;for(f in e){g+=parseInt(this[e[f]].domNode.offsetHeight,10);}this.booklet.set("height",parseInt(this.height,10)-g+"px");}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.WidgetTree","mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowserSelector");mstrmojo.TreeBrowserEnum={};var I=mstrmojo.TreeBrowserEnum;I.BRANCH_POLICY_TOGGLE="toggle";I.BRANCH_POLICY_SELECT="select";mstrmojo.TreeBrowser=mstrmojo.declare(mstrmojo.WidgetTree,null,{scriptClass:"mstrmojo.TreeBrowser",cssClass:"mstrmojo-TreeBrowser",browserNodeClass:mstrmojo.TreeBrowserNode,blockCount:30,noCheckBox:false,selectionAcrossBranch:true,branchClickPolicy:I.BRANCH_POLICY_TOGGLE,contentRetrieved:false,listSelector:mstrmojo.TreeBrowserSelector,handleNodeClicked:function(J){},getContentThroughTaskCall:function H(K,J){},isBranch:function F(J){},item2textCss:function C(J){return{"-1":"failed","-2":"loading","-3":"next","-4":"prev"}[J.st]||"";},failItemCreaterFunc:function(){return{n:"Loading Failed!",did:"-1",tp:"-1",st:"-1"};},loadingItemCreaterFunc:function(){return{n:mstrmojo.desc(5674,"Loading..."),did:"-2",tp:"-2",st:"-2"};},nextItemCreaterFunc:function(J){return{n:mstrmojo.desc(4507,"Next ##  item(s)...").replace("##",J?Math.min(J,this.blockCount):this.blockCount),did:"-3",tp:"-3",st:"-3"};},prevItemCreaterFunc:function(){return{n:mstrmojo.desc(4508,"Previous ##  item(s)...").replace("##",this.blockCount),did:"-4",tp:"-4",st:"-4"};},updateTreeContent:function(K,M){K.contentRetrieved=true;var L=M[K.itemChildrenField]||[],J=K.tree||K,O=M.bc,N=M.sz,P=M.bb;if(O!==-1){if(P+O<=N){L.push(J.nextItemCreaterFunc(N-P-O+1));}if((P-O)>-1){L.unshift(J.prevItemCreaterFunc());}}K.blockBegin=P;J.initializing=true;K.clearSelect(false);K.set("items",L);K.setSelectedItems(J.getTotalSelections(),true);J.initializing=false;if(J.onNodeExpand){J.onNodeExpand(K);}},getContent:function(K,O){var L=(K===this),J=this,P=function(Q){if(L){mstrmojo.css.removeClass(J.domNode,["loading"]);}J.updateTreeContent(K,Q);},M=function(Q){K.contentRetrieved=true;K.set("items",[J.failItemCreaterFunc()]);},N={success:P,failure:M};if(L){mstrmojo.css.addClass(J.domNode,["loading"]);}this.getContentThroughTaskCall({isRoot:L,data:K.data,blockBegin:L?0:(O||K.blockBegin),blockCount:J.blockCount},N);},postBuildRendering:function A(){this._super();if(!this.contentRetrieved){var J=this;setTimeout(function(){J.getContent(J);},0);}},itemFunction:function G(N,K,L){var J=L.tree||L,M=new J.browserNodeClass({data:N,state:0,parent:L,tree:J,multiSelect:L.multiSelect,text:N[L.itemDisplayField],textCssClass:J.item2textCss(N),items:N[L.itemChildrenField],itemIdField:L.itemIdField,itemDisplayField:L.itemDisplayField,itemIconField:L.itemIconField,itemChildrenField:L.itemChildrenField,itemFunction:L.itemFunction,listSelector:L.listSelector});return M;},clearTreeSelect:function E(){if(!this.selectionAcrossBranch){this._super();}else{var L=this._selectionParentNode,J=L&&L.length,K;for(K=0;K<J;K++){L[K].clearSelect();}this._selectionParentNode=null;this._totalSelections=null;}},onnodechange:function D(U){if(this.initializing){return ;}if(!this.selectionAcrossBranch){this._super(U);}else{this._totalSelections=this._totalSelections||[];this._selectionParentNode=this._selectionParentNode||[];var R=this._totalSelections,J=this._selectionParentNode,S=U.added,P=U.removed,Q=[],L=[],K=U.src,N,M,O,V;J.push(K);for(N=0,O=P&&P.length;N<O;N++){L.push(K.items[P[N]]);}mstrmojo.array.removeItems(R,"did",L);for(M=0,V=S&&S.length;M<V;M++){Q.push(K.items[S[M]]);}this._totalSelections=R.concat(Q);}},getTotalSelections:function B(){if(this.selectionAcrossBranch){return this._totalSelections||[];}var J=this.selectionParentNode;return J&&J.getSelectedItems();}});}());(function(){mstrmojo.requiresCls("mstrmojo.AndOrNode");mstrmojo.threshold.AndOrNode=mstrmojo.declare(mstrmojo.AndOrNode,null,{scriptClass:"mstrmojo.threshold.AndOrNode",cssClass:"adv-threshold",avatarCssCls:"mstrmojo-thresholdRow",onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);},consolidate:function A(){if(this.parent!==this.tree||this.itemCnt===0){this._super();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.AndOrNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo.expr","mstrmojo.dom","mstrmojo.array","mstrmojo.css");var L=mstrmojo.expr,N=mstrmojo.dom,C=mstrmojo.array,A=mstrmojo.css,F=mstrmojo.fe._IsRelationTreeNode.createSetHtml;var M=function(){var U="noRelationOperator",P=this[U],R=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],S=mstrmojo.array.filter(R,function(V){return V&&V[U]!==P&&V.data.et!==L.ET.RLS;}),O=S.length;for(var Q=0;Q<O;Q++){S[Q].set(U,P);}};mstrmojo.fe.AndOrNode=mstrmojo.declare(mstrmojo.AndOrNode,[mstrmojo.fe._IsRelationTreeNode],{scriptClass:"mstrmojo.fe.AndOrNode",markupString:'<div id="{@id}" class="mstrmojo-andor mstrmojo-AndOrNode {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-andor-prefix" mstrAttach:click><span class="mstrmojo-textset mstrmojo-andor-prefix-text"></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}">{@_prefixAndOrToolsMarkup}</span></div><div class="mstrmojo-andor-top"></div><div class="mstrmojo-andor-contentsWrapper" style="position:relative"><div class="mstrmojo-andor-contents" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue mstrmojo-AndOrNode-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner mstrmojo-AndOrNode-dropCue-inner"></div></div></div><div class="mstrmojo-andor-bottom"></div></div>',getPrefixAndOrToolsMarkup:function(){return(F+this._super());},markupSlots:mstrmojo.hash.copy({createSetNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupSlots)),markupMethods:mstrmojo.hash.copy({onnoRelationOperatorChange:function(){A.toggleClass(this.prefixHoverNode,["noRelation"],this.noRelationOperator);}},mstrmojo.hash.copy(mstrmojo.AndOrNode.prototype.markupMethods)),removeSet:function G(P){var O=P.childIndex(),Q=P.data,R=[Q];if(O>=0){this.remove(O,true);if(Q.nds&&Q.nds.length>0){R=Q.nds;if(Q.not){R[0].not=true;}}else{delete Q.dmy;delete Q.relation;delete Q.applySubExpr;delete Q.relation;delete Q.useSchema;delete Q.dmt;}this.add(R,O);this.consolidate(false);}},createSet:function E(Q,O){var P=this._ndsToMove(this,Q);if(!P){return ;}this.remove(P.idxs,true);var V=P.nds,U;if(V){if(V.length>1){var S={et:L.ET.ANDOR,nds:V};S.fn=this.data.fn;V=[S];U=S.nds[0].not;}else{var W=V[0];if(W&&W.not&&W.et===L.ET.ANDOR){U=W.not;delete W.not;}}}if(O&&O.rq){var R;if(O.isMetric){R=O.cq;mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],O.rq,R);}else{R=O.rq;R.nds=V;if(U){R.not=U;}}this.add([R],P.idxs[0]);}this.consolidate(false);},preclick:function H(O){var R=null,Q=N.eventTarget(O.hWin,O.e),P=this._super(O);if(N.contains(this.createSetNode,Q,true)&&!this.noRelationOperator){R="createSetOpt";}O.part=R||O.part;return P;},preadd:function I(O){if(this._super){this._super(O);}this.updateRelationOperator();},preremove:function K(O){if(this._super){this._super(O);}this.updateRelationOperator();},consolidate:function B(){this._super();this.updateRelationOperator();},postBuildRendering:function J(){var O=this._super();this.updateRelationOperator();return O;},updateRelationOperator:function D(){var O=this.ctxtBuilder&&this.ctxtBuilder.itemWidgets||[],P=!!C.filterOne(O,function(R){return R&&(R.data.et===L.ET.RLS||(R.data.et===L.ET.ANDOR&&R.noRelationOperator));}),Q=this.parent;this.set("noRelationOperator",P);M.call(this);if(Q&&Q.hasRendered&&Q.updateRelationOperator){Q.updateRelationOperator();}},onmouseover:function(){this.toggleGroupBorder(true);},onmouseout:function(){this.toggleGroupBorder(false);}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.num","mstrmojo._HasOwnAvatar","mstrmojo.XtabBase","mstrmojo.models.template.DataInterface");var Y=mstrmojo.array,D=mstrmojo.dom,Q=mstrmojo.num,W=mstrConfig,I="px",B="xrsz",Z="t",M=3,R=mstrmojo.XtabBase.EnumLockedHeaders,V=R.ROW,c=R.BOTH;function J(){var d=this.gridData.gts;return d.row.concat(d.col);}function N(){var u=this.gridData,h=this.lockHeadersCase,g=u.gts,m=u.ghs,d=m.rhs||[],r=m.chs||[],q=d.cws||[],v=(g.cws||[]).concat(r.cws||[]),p=u.gvs||[],n=q.concat(p.cws||[]),t=this.zone.domNode.getElementsByTagName("tr"),s=t&&t[t.length-1],j=false,o=this.isOutlineMode;if(s){var e=s.getElementsByTagName("td")[0];u.xrh=(e&&e.offsetHeight)||0;}j=Y.some(q,function(w){return w.w==="";});if(u.afw||u.afc||j){var l=this.rszmap;if(window.neeHandlingForSvgImgs){neeHandlingForSvgImgs(this.zone.domNode);}var f=Math.max(v.length,n.length);Y.forEach(t,function(w){var z=w.childNodes;if(z.length===f||o){var x=bottomIndex=0;Y.forEach(w.getElementsByTagName("td"),function(AE,AC){var AD=D.position(AE).w;var AB=parseInt(AE.colSpan,10),AF=AD/AB;if(v[x]&&AE.offsetParent!==null){if(!AE.colSpan||AE.colSpan===1){v[x++].w=AD+I;}else{for(var AA=0;AA<AB;AA++){if(!v[x]){v[x]={};}v[x].w=AF+I;x=x+1;}}}if(n[bottomIndex]&&AE.offsetParent!==null){if(!AE.colSpan||AE.colSpan===1){n[bottomIndex++].w=AD+I;}else{for(var AA=0;AA<AB;AA++){if(!n[bottomIndex]){n[bottomIndex]={};}n[bottomIndex].w=AF+I;bottomIndex=bottomIndex+1;}}}});return false;}});}if(n.length!==v.length){var k=J.call(this);Y.forEach(k,function(AB,w){var x=AB.fs,AC=(x&&x.length)||0;if(AC>1){var z=v[w],AA;for(AA=0;AA<AC-1;AA++){v.splice(w+AA+1,0,z);}}});if(n.length>v.length){v.push(n[n.length-1]);}}return{top:v,bottom:n};}function S(){var m=this.gridData,f=this.isOutlineMode,g=f?2:0;if(!m.gts.show&&f&&mstrApp.isExpress){return ;}var l=this.rszmap=[],k=0,h=0,e=m.twm=N.call(this),o=e.bottom,p=new mstrmojo.models.template.DataInterface(m),d=p.getColumnHeaderData(true),n=d.length;var j=0;Y.forEach(o,function(s,q){if(q>=n){return false;}var r=parseInt(s.w,10);if(isNaN(r)){return false;}if(f&&d&&d[q]&&d[q+1]&&d[q].id===d[q+1].id&&!d[q]._ridx){j=j+r;}else{j=j+r;k+=j;h+=j;if(q===n-1){k=k-1-g;h=h-1-g;}l.push({left:k,offsetLeft:h});j=0;}});Y.forEach(l,function(x,q){var t=l[q+1],s=(t&&t.left),r=(s-x.left),w=[this.zone.domNode],u=this.getColClonedZone&&this.getColClonedZone();if(u){w.push(u);}if(!t||(r>(M*2))){Y.forEach(w,function v(AA){var AC=document.createElement("div"),z=AC.style,AB=this;AC.setAttribute("idx",String(q));AC.setAttribute(Z,B);AC.className=B+((q>0&&l[q-1].skipped)?" zero":"");z.left=isNaN(x.offsetLeft)?"":((x.offsetLeft-M)+I);AA.appendChild(AC);AC.ondblclick=function(AD){AB.onHandleDblClick(AD);};},this);}else{x.skipped=true;}},this);}function a(f){if(!f){return ;}var d=f.getElementsByClassName(B),e=d.length-1;for(;e>-1;e--){f.removeChild(d[e]);}}function H(g,f){var d=g.getElementsByClassName(B),e=0;for(e=0;e<d.length;e++){f.appendChild(d[e].cloneNode());}}mstrmojo.rw.xtab._XtabColResize=mstrmojo.provide("mstrmojo.rw.xtab._XtabColResize",{_mixinName:"mstrmojo.rw.xtab._XtabColResize",rszmap:undefined,onRender:function F(){if(this._super){this._super();}if(this.gridData.eg!==undefined){return ;}var e=this;var d=mstrApp&&D.isMac()&&mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode();window.setTimeout(function(){if(!e.hasRendered){return ;}if(!mstrApp.isExpress||mstrApp.features["grid-layout"]){S.call(e);}e.raiseEvent({name:"xtabColsMeasured"});},d?500:0);D.attachMarkupEvent(this.id,this.domNode,"mousedown");},unrender:function X(d){D.detachEvent(this.domNode,"mousedown",mstrmojo.emptyFn);this._super(d);},refreshResizeHandlers:function G(){if(!mstrApp.isExpress||mstrApp.features["grid-layout"]){a(this.getTargetZone().domNode);a(this.getColClonedZone&&this.getColClonedZone());S.call(this);if(this.clonedRowHeader&&this.clonedRowHeader.domNode){a(this.clonedRowHeader.domNode.firstChild);H(this.getTargetZone().domNode,this.clonedRowHeader.domNode.firstChild);}if(this.clonedTitle&&this.clonedTitle.domNode){a(this.clonedTitle.domNode.firstChild);H(this.getTargetZone().domNode,this.clonedTitle.domNode.firstChild);}}},gridPagesRendered:function A(){this.refreshResizeHandlers();if(this._super){this._super();}},isColResizeNode:function P(d){return(d.className||"").indexOf(B)>=0;},isDragValid:function C(d){return this.isColResizeNode(d.src.node)||(this._super&&this._super(d))||false;},ondragstart:function b(f){if(this.isColResizeNode(f.src.node)){var d=D.position(this.domNode),k=D.findAncestorByAttr(f.src.node,"idx",true,this.domNode),n=k&&parseInt(k.value,10),j=this.rszmap,e=j[n].left-(n>0?j[n-1].left:0),o=Math.max(d.x,(f.src.pos.x-e)),r=new mstrmojo.models.template.DataInterface(this.gridData),q=this.gridData,g=this.isOutlineMode,h=this.zone.domNode.getElementsByTagName("tr");if(g){var m=h[0],l=m.getElementsByTagName("td"),p=0;Y.forEach(l,function(u,t){var s=parseInt(u.colSpan,10)||1;if(t<=n){p=t>0?p+1:p;p=p+s-1;}else{return false;}});n=p;}this.rszData={idx:n,originalWidth:e,min:o,max:d.x+d.w,colName:r.getColumnHeaderData(true)[n].n};}if(this._super){this._super(f);}this.ignoreHover=true;},ondragmove:function L(f){if(this.rszData){var e=this.rszData,d=f.src.pos,g=Math.max((e.originalWidth+(f.tgt.pos.x-d.x)),0);this.avatar.firstChild.innerHTML=e.colName+" "+((Q.UNIT.PX==W.units)?g:parseFloat(Q.convertUnits(Q.UNIT.PX,W.units,g)).toFixed(2))+" "+W.unitsLabel;}this._super(f);},ondragend:function E(h){if(this.rszData){var g=this.gridData,f=this.rszData.idx,k=(new mstrmojo.models.template.DataInterface(g)).getColumnHeaderData(true),l=k[f],e=l.fs,d=l.fix||1;if(e&&e.length>0){d=f-Y.find(k,"id",l.id)+1;}var j=l.oid||l.id;this.changeColumnWidth(j,l.otp,Math.max((parseInt(N.call(this).bottom[f].w,10)+(h.tgt.pos.x-h.src.pos.x)),0),d,(j===""&&l.axis===2));delete this.rszData;}this._super(h);this.ignoreHover=false;},createAvatar:function O(h){var k=document.createElement("div"),e=k.style,d=D.position(h),g=D.position(this.domNode);if(this.isColResizeNode(h)){this.avatarCssClass=B;e.top=g.y+I;e.left=d.x+I;e.height=g.h+I;var j=document.createElement("div");j.className=B+"-ttp";var f=document.createElement("div");f.className=B+"-anchr";k.appendChild(j);k.appendChild(f);}else{delete this.avatarCssClass;}return k;},positionAvatar:function K(h,f){if(this.rszData){var e=this.avatar,g=e.style,d=this.rszData;if(!this.avatar||!this.rszData){return ;}g.left=Math.min(Math.max(h.x,d.min),d.max)+"px";}else{this._super(h,f);}},isHandleNode:function U(d){return !!d&&d.getAttribute&&d.getAttribute(Z)===B;},onHandleDblClick:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._IsExprNode","mstrmojo.fe._IsRelationTreeNode","mstrmojo._HasPopup","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.ConditionNode","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr");var E=mstrmojo,A=E.css,I=E.dom,F=E.hash,G=E.string,C=function(N){var O=N.data,M=O.dmy&&O.dmy.uts||[],K=M.length,J=[],L;for(L=0;L<K;L++){J.push(G.encodeHtmlString(M[L].n));}return'<span class="mstrmojo-text">'+J.join(", ")+"</span>";};mstrmojo.fe.RelationNode=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsExprNode,mstrmojo.fe._IsRelationTreeNode,mstrmojo._HasPopup],{scriptClass:"mstrmojo.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><span class="mstrmojo-relationNode-inf"><span class="mstrmojo-relation-prefix-text">'+mstrmojo.desc(2790,"Set of").replace(/##/g,"")+'</span><span class="mstrmojo-textset"  mstrAttach:click></span><span class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(2793,"Where").replace(/##/g,"")+'</span><span class="mstrmojo-relation-convert-text"  mstrAttach:click >'+mstrmojo.desc(15412,"Convert to Condition")+'</span><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></span><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},convertNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[3];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){A.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){A.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=C(this);}},noRelationOperator:true,children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(J){this.parent.tree.onNew(J);},getItemConfig:function(M,J,N){var K=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,M,J,N),L=N.tree||N;return F.copy({tree:L,rootTree:this.parent.tree,noRelation:true,inRelation:true},K);},prenodeclick:function(J){if(!J||!J.part){return ;}var K=this.rootTree;if(K&&K.onnodeclick&&this.editable){J.editor=K.editor;K.onnodeclick.call(this,J);}}}],premousedown:function(J){if(this._super){this._super(J);}var K=I.eventTarget(J.hWin,J.e);if(!I.contains(this.childTree.domNode,K,true)){this.childTree.clearTreeSelect();}},preselectedChange:function(J){if(!J.value){this.childTree.clearTreeSelect();}},init:function(J){this._super(J);var K=this.data;if(K){delete this.data;this._set_data(null,K);}},_set_data:function(M,J){var K=this.data;if(J&&(!J.relation)){J.relation={};}var L=(K!==J);if(L){this.data=J;if(J){this.childTree.set("items",J.nds||[J]);}}return L;},isSelectableArea:function(J){return mstrmojo.dom.contains(this.relationNode,J,true);},preclick:function D(J){var L=null,K=I.eventTarget(J.hWin,J.e);if(I.contains(this.prefixNode,K,true)){L="andor";}else{if(I.contains(this.textNode,K,true)){L="createSet";}else{if(I.contains(this.convertNode,K,true)){this.parent.removeSet(this);return false;}}}J.part=L;},del:function H(){var J=this.parent;if(J&&J.remove&&this.data){J.remove(this.data);}},newCondition:function B(J){this.childTree.newCondition(J);},avatarCssCls:"mstrmojo-FE mstrmojo-relationNode",getAvatarNode:function(){return this.relationNode.cloneNode(true);}});})();(function(){mstrmojo.requiresCls("mstrmojo.FilterExpr","mstrmojo.threshold.AndOrNode","mstrmojo.threshold.ConditionNode","mstrmojo.expr");var H=mstrmojo.expr,G=H.ET,F=mstrmojo.mstr.EnumNodeProperties;mstrmojo.threshold.ThresholdExprTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.threshold.ThresholdExprTree",cssClass:"mstrmojo-ThresholdExprTree",allowCopy:false,containerResizable:false,draggable:true,dropZone:true,editable:true,makeObservable:true,supportRelation:true,nodeClassMap:{14:mstrmojo.threshold.AndOrNode,"*":mstrmojo.threshold.ConditionNode},getItemIdentityProp:function(I){if(I.node&F.CONDITION){return"*";}return this._super(I);},onConditionEdit:mstrmojo.emptyFn,editor:undefined,isEditable:function C(I){if(!this.editable){return false;}if(I&&I.et===G.XML){return !I.xml;}return true;},onNew:function E(I){I.data.isNew=true;this.editor.openConditionWalk(I.data,I.widget.ctxtBuilder.itemWidgets[I.index]);},onnodeclick:function D(I){var J=I.part;if(!I||!J){return ;}var L=J==="andor",K=this.tree.editor;if(!((L&&this.prefixedAndOrEditable)||(!L&&this.editable))){return ;}if(!this.editable){return ;}if(L){K.openAndORPopup(this,I.getTarget());return ;}else{if(J==="addCondition"){this.tree.newCondition({et:G.AE});return ;}}K.openConditionWalk(this.data,this);},allowDrop:function B(I){var N=I&&I.src,M=N&&N.data,K=M&&M.et,L=this.tree,J=N&&N.widget&&N.widget.tree;return K&&(this===L?(J!==L):true);},remove:function A(J){var I=this._super(J);if(this.items.length===0&&J.et===G.ANDOR&&J.nds.length===0&&this.parent.removeFromModel){this.parent.removeFromModel();}return I;}});}());(function(){mstrmojo.requiresCls("mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserTreeBrowser=mstrmojo.declare(mstrmojo.TreeBrowser,null,{scriptClass:"mstrmojo.ACL.UserTreeBrowser",itemIdField:"did",branchClickPolicy:mstrmojo.TreeBrowserEnum.BRANCH_POLICY_SELECT,getACLUserDataService:function D(){return mstrmojo.ACL.UserDataService;},getContentThroughTaskCall:function C(G,E){var F=this.getACLUserDataService();E.failure=mstrmojo.func.composite([function(H){if(H.getResponseHeader){mstrmojo.alert(H.getResponseHeader("X-MSTR-TaskFailureMsg"));}},E.failure]);if(G.isRoot){F.getTopLevelGroups(G,E);}else{F.getMembers(G,E);}},isBranch:function B(E){return E.isGroup;},item2textCss:function A(E){return(this._super&&this._super(E))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[E.st];}});})();(function(){mstrmojo.requiresCls("mstrmojo.VBox","mstrmojo.ObjectBrowser","mstrmojo.HTMLButton");mstrmojo.requiresDescs(1059,1441,3413,3414,4996,7972,9893);var A={768:true,769:true,774:true,776:true,779:true};mstrmojo.IVEDatasetPicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.IVEDatasetPicker",cssClass:"mstrmojo-vi-dataset-picker",title:mstrmojo.desc(11940,"Select Existing Dataset"),help:"add_existing_datasets.htm",startingFolder:null,item:null,multiSelect:false,selectedItems:null,children:[{alias:"newLabel",scriptClass:"mstrmojo.FieldSet",legend:mstrmojo.desc(4996,"New"),cssClass:"mstrmojo-ive-fs"},{alias:"btnImport",scriptClass:"mstrmojo.Button",text:mstrmojo.desc(13550,"Access External Data"),cssClass:"mstrmojo-ive-import",onclick:function(){this.parent.close({action:"import"});}},{alias:"useExistingLabel",scriptClass:"mstrmojo.FieldSet",legend:mstrmojo.desc(9893,"Use Existing"),cssClass:"mstrmojo-ive-fs"},{scriptClass:"mstrmojo.ObjectBrowser",alias:"ob",cssText:"border-width:1px;border-color:#DDDDDD;",closeable:false,browsableTypes:"8,768,769,774,776,779",closeOnSelect:false,showCompletePath:false,searchVisible:true,upButtonVisible:true,folderLinksContextId:1,bindings:{rootFolderID:function(){return this.parent.startingFolder;},multiSelect:"this.parent.multiSelect"}},{scriptClass:"mstrmojo.HBox",alias:"btnHBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1059,"Next"),onclick:function(){this.parent.parent.close({item:this.parent.parent.item});},bindings:{enabled:function(){return !!(this.parent.parent.multiSelect?this.parent.parent.selectedItem.length:this.parent.parent.item);}}}]}],preBuildRendering:function(){if(this._super){this._super();}this.ob.onSelectCB=[this,"onOBSelect"];this.ob.onBrowseFolder=[this,"onOBBrowseFolder"];this.ob.booklet.set("animates",false);this.ob.rootFolderID=this.startingFolder;},postBuildRendering:function(){if(this._super){this._super();}this.ob.browse();},onOBSelect:function(B){if(this.multiSelect){this.set("selectedItems",mstrmojo.array.filter(B,function(C){return A[C.st];}));}else{this.set("item",(A[B.st]?B:null));}},onOBBrowseFolder:function(B){if(this.multiSelect){this.set("selectedItems",null);}else{this.set("item",null);}},onstartingFolderChange:function(){this.ob.rootFolderID=this.startingFolder;this.ob.browse();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ObjectBrowser");var H=mstrmojo.array;var E=[257,1024,3072,12032];mstrmojo.vi.ui.editors.ObjectPicker=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ObjectPicker",cssClass:"mstrmojo-vi-ObjectPicker",zIndex:9,title:mstrmojo.desc(11496,"Select Object"),help:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:4,supportedTypes:H.hash(E),item:null,OKFn:null,children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"ob",closeable:false,browsableTypes:"8,"+E.join(","),closeOnSelect:false,showCompletePath:false,searchVisible:false,scrollableIncFetch:true,bindings:{rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",isImportFromCube:"this.parent.isImportFromCube",}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",alias:"btnHBox",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function C(){var J=this.parent.parent;this.parent.parent.close({item:J.item});var I=J.OKFn;if(I){I(J.item);}J.set("item",null);},bindings:{enabled:function B(){return !!this.parent.parent.item;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancle"),onclick:function C(){var I=this.parent.parent;this.parent.parent.close();I.set("item",null);}}]}],preBuildRendering:function A(){if(this._super){this._super();}this.ob.onSelectCB=[this,"onOBSelect"];},postBuildRendering:function D(){if(this._super){this._super();}this.browse();},onOBSelect:function F(I){this.set("item",((this.supportedTypes[I.t]||this.supportedTypes[I.st])?I:null));},browse:function G(){this.ob.browse();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.TextArea","mstrmojo.Table","mstrmojo.HBox","mstrmojo.Editor","mstrmojo.ObjectBrowser","mstrmojo.NewFolderEditor","mstrmojo.DI.DIHelpers");var C=mstrmojo.func,F=mstrmojo.DI.DIHelpers,E=mstrmojo.array;function B(){var H={alias:"newFolder",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var J=this.parent.parent,I={zIndex:J.zIndex+10,navigateAfter:false,fId:J.ob.currentFolder.did,okFn:function(K,L){J.ob.refreshContent();if(L){J.ob.browseFolder(K.fid,J.newFolder);}}};if(J.ob.dataProvider){I.dp=J.ob.dataProvider;}J.openPopup("newFolder",I);},postCreate:function(){this.set("visible",false);}},G=mstrmojo.hash.clone(mstrmojo.ObjectBrowser.prototype.children);G.push(H);return G;}mstrmojo.SaveAsObjectBrowser=mstrmojo.declare(mstrmojo.ObjectBrowser,null,{scriptClass:"mstrmojo.SaveAsObjectBrowser",cssClass:"mstrmojo-SaveAs-OB",children:B(),getRecents:function(G){var H=this;G.onClose=function(){if(H.recentFolders){this.removeChildren(this.recentLable);this.removeChildren(this.recentList);delete H.recentFolders;}};this.getDataProvider().loadRecentSaveAsFolders({success:function(I){if(H.recentFolders){G.removeChildren(G.recentLable);G.removeChildren(G.recentList);delete H.recentFolders;}if(I&&I!==""){H.recentFolders=H.getList(I.objects,G);G.addChildren(H.recentFolders);}},failure:function(I){mstrmojo.alert(I.message||I.getResponseHeader("X-MSTR-TaskFailureMsg"));},});},getList:function(H,G){var I=this;return[{scriptClass:"mstrmojo.Label",alias:"recentLable",cssClass:"recentLabel",text:mstrmojo.desc(14354,"Recents")},{scriptClass:"mstrmojo.ui.List",alias:"recentList",items:H,cssClass:"recentList",onclick:function(J){var K=this.getItemFromTarget(J.getTarget());I.browseFolder(K.did,"");G.close();}}];}});var A={success:function(G){var H=this.parent;if(H.onObjectSaved){H.onObjectSaved({name:H.name,did:G.did,desc:H.desc});}mstrmojo.alert(mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",H.typeDesc||"Object").replace("###",H.name),null,mstrmojo.desc(7984,"Object Saved"));H.ob.refreshContent();H.close();},failure:function(H){var G=parseInt(H.getResponseHeader("X-MSTR-TaskErrorCode"),10)+4294967296,I=this.parent;if(G===2147749923){mstrmojo.confirm(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",I&&I.typeDesc||"Object").replace("'###'",I&&I.name?'"'+I.name+'"':""),{confirmBtn:{fn:function(){I.saveAs(true);}}},{title:mstrmojo.desc(3179),zIndex:I&&I.zIndex+10});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+H.getResponseHeader("X-MSTR-TaskFailureMsg"));}}};mstrmojo.SaveAsEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SaveAsEditor",cssClass:"mstrmojo-SaveAsEditor",title:mstrmojo.desc(3167,"Save As"),sId:null,rootFolderID:null,rootFolderType:null,folderLinksContextId:null,browsableTypes:null,showCompletePath:true,desc:"",name:"",displaySaveLabel:true,searchVisible:true,upButtonVisible:true,children:[{scriptClass:"mstrmojo.SaveAsObjectBrowser",alias:"ob",closeable:false,closeOnSelect:false,fishEyeVisible:false,bindings:{showCompletePath:"this.parent.showCompletePath",rootFolderID:"this.parent.rootFolderID",rootFolderType:"this.parent.rootFolderType",folderLinksContextId:"this.parent.folderLinksContextId",browsableTypes:"this.parent.browsableTypes",displaySaveLabel:"this.parent.displaySaveLabel",searchVisible:"this.parent.searchVisible",upButtonVisible:"this.parent.upButtonVisible",sId:"this.parent.sId"},postCreate:function(){this.onSelectCB=[this.parent,"onOBSelect"];this.onBrowseFolder=[this.parent,"onOBBrowseFolder"];}},{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-Input-Panel",rows:2,cols:2,alias:"contPanel",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Name-Label",slot:"0,0",text:mstrmojo.desc(2211,"Name:")},{scriptClass:"mstrmojo.TextBox",slot:"0,1",value:mstrmojo.desc(8116,"New Folder"),alias:"name",cssClass:"mstrmojo-SaveAsEditor-nameInput",bindings:{value:"this.parent.parent.name"}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Desc-Label",slot:"1,0",text:mstrmojo.desc(1154,"Description:")},{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-SaveAsEditor-descInput",slot:"1,1",alias:"desc",bindings:{value:"this.parent.parent.desc"},rows:5}]},{scriptClass:"mstrmojo.HBox",alias:"buttonBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{alias:"newFolder",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton mstrmojo-createfolder",text:mstrmojo.desc(3245,"Create New Folder"),onclick:function(){var H=this.parent.parent,G={zIndex:H.zIndex+10,navigateAfter:false,fId:H.ob.currentFolder.did,okFn:function(I,J){H.ob.refreshContent();if(J){H.ob.browseFolder(I.fid,H.newFolder);}},cssClass:F.getEnvObj().isAppSchema()?"workstation":undefined};if(H.ob.dataProvider){G.dp=H.ob.dataProvider;}H.openPopup("newFolder",G);},postCreate:function(){this.set("visible",mstrmojo.resolveFeature("create-folder")||F.getEnvObj().isAppSchema());}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot okButton",alias:"ok",text:mstrmojo.desc(2400,"Save"),onclick:function(){this.parent.parent.saveAs();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]}],newFolder:{scriptClass:"mstrmojo.NewFolderEditor"},onOpen:function(){this.ob.browse();},onOBBrowseFolder:mstrmojo.emptyFn,onOBSelect:function(G){this.set("name",G.n);},saveAsCallback:function D(){return A;},saveAs:function(J){var H=this.contPanel;this.name=H.name.value;this.desc=H.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var L=this.saveParams||{};L.folderID=this.ob.currentFolder.did;L.description=this.desc||"";L.name=this.name||"";L.saveAsOverwrite=!!J;var G=this.saveAsCallback(),K=this,I={success:function(){K.saveRecentFolders(K.ob.currentFolder.did);},failure:function(M){mstrmojo.alert(M.message||M.getResponseHeader("X-MSTR-TaskFailureMsg"));}};G.parent=this;if(!mstrApp.isSingleTier){G=C.wrapMethods(G,I);}mstrmojo.xhr.request("POST",mstrConfig.taskURL,G,L);},saveRecentFolders:function(K){var I,G,H,J=this;J.ob.getDataProvider().loadRecentSaveAsFolders({success:function(L){G=[];E.forEach(L.objects,function(O){G.push(O.did);});H=mstrmojo.array.indexOf(G,K);if(H!==-1){G.splice(H,1);}G.unshift(K);I=G.slice(0,3).join(",")+",";var M={taskId:"setPreference",prefs:"recentFolders\u001E"+I};var N={success:function(){mstrConfig.recentFolders=I;},failure:function(O){mstrmojo.alert(O.message||O.getResponseHeader("X-MSTR-TaskFailureMsg"));}};J.ob.getDataProvider().serverRequest(M,N);},failure:function(L){mstrmojo.alert(L.message||L.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}});mstrmojo.SaveAsEditor.SAVEAS_CALLBACK=A;})();(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.FilterExpr");var D=mstrmojo.hash,B=mstrmojo.expr.ET;mstrmojo.fe.FilterExprTree=mstrmojo.declare(mstrmojo.FilterExpr,null,{scriptClass:"mstrmojo.fe.FilterExprTree",allowCopy:false,containerResizable:false,draggable:true,dropZone:true,editable:true,makeObservable:true,onConditionEdit:mstrmojo.emptyFn,modifyConditionNode:function(G,F){var H=G.data,E=H.isNew;D.copy(D.clone(F),D.clear(H));delete H.isNew;G.paint();if(H.et===B.MQ||H.et===B.MC){G.set("noCreateSet",!mstrApp.supportAdvFilter);}if(G.tree.onConditionEdit){G.tree.onConditionEdit(G,E);}},getItemConfig:function(H,E,I){var F=this._super(H,E,I),G=I.tree;return D.copy({onclick:G.prenodeclick,containerResizable:G.containerResizable,ondragend:G.ondragend,ondrop:G.ondrop},F);},ondragenter:function A(E){this.dropCuePos={left:0,top:0,idx:0,idxActual:0};this._super(E);},ondragend:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondragend.call(this,E);}},ondrop:function(E){if(this===this.tree){return this._super(E);}else{return this.constructor.prototype.ondrop.call(this,E);}},isEditable:function C(F){if(!this.editable){return false;}var E=false;switch(F&&F.et){case B.R:case B.F:E=false;break;case B.ANDOR:case B.MQ:case B.AQ:case B.AL:case B.AC:case B.MC:case B.AE:E=true;break;case B.XML:E=!F.xml||!!F.ph;}return E;},prenodeclick:function(E){if(!E||!E.part){return ;}if(E.part!=="createSet"&&E.part!=="createSetOpt"&&!(E.part==="andor"?this.prefixedAndOrEditable:this.editable)){return ;}var F=this.tree;if(F.onnodeclick){F.onnodeclick.call(this,E);}},getSelectedItemWidget:function(){var E=function(K){var I=K&&K.ctxtBuilder&&K.ctxtBuilder.itemWidgets,G=K.selectedIndex,F=I&&I.length||0;if(!I){return ;}if(G===-1){for(var H=0;H<F;H++){var J=E(I[H]);if(J){return J;}}}else{return I[G];}};return E(this);}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.Label","mstrmojo.Obj","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.warehouse.EnumObjectTypes");var H=mstrmojo.expr,I=H.ET,C=mstrmojo.array,F=mstrmojo.string,E=mstrmojo.warehouse.EnumObjectTypes,G=mstrmojo.mstr.EnumNodeDimty,D=mstrmojo.hash;mstrmojo.fe.CreateSetEditor=mstrmojo.declare(mstrmojo.Editor,null,{onOpen:function(){var Q=this.model,X=this.condition.data,R=!X.m,N=this.attrsBox.attrsList,J=this.relBox.relPd,S=C.filter(Q.metrics,function(a){return !a.um;}),Y=[{n:mstrmojo.desc(12037,"System Default"),t:-1,did:"default"}].concat(S),L=this.appQualBox.appQual,Z=D.clone(Q.attrs);C.forEach(Z,function(b){var a=false;if(b.t===E.ATTRIBUTE){C.forEach(b.fs,function(c){if(c.fgr>0){a=true;return false;}});}b.css=(b.css||"")+" "+(b.t?("t"+b.t+((b.da||b.um)?"d":"")+(a?"g":"")+(b.st?(" st"+b.st):"")):"");});N.set("items",Z);mstrmojo.array.forEach(["relBox","appQualBox"],function(a){this[a].set("visible",R);},this);if(X.dmt===4&&X.dmy.uts){var M={};C.forEach(X.dmy.uts,function(b){var a=C.find(Q.attrs,"did",b.utgt.did);if(a>=0){M[a]=true;}});N.set("selectedIndices",M);}if(R){J.set("items",Y);if(X.relation&&X.relation.guide){var O=X.relation.guide,W=C.find(Y,"did",O.did);J.set("selectedIndex",W>=0?W:0);}else{J.set("selectedIndex",0);}L.set("checked",!!X.applySubExpr);}if(mstrApp.isWSStyling){var V={left:parseInt(this.left,10),top:parseInt(this.top,10)},K=this.editorNode.getBoundingClientRect(),U={width:window.innerWidth,height:window.innerHeight},P={width:K.right-K.left,height:K.bottom-K.top};if(K.right>U.width){this.set("left",(V.left-P.width)+"px");}if(K.bottom>U.height){this.set("top",(V.top-P.height)+"px");}}},onOK:function(){var Q=this.model,U=this.condition,W=this.condition.data,N=this.attrsBox.attrsList,J=this.relBox.relPd,L=this.appQualBox.appQual;var Y=N.getSelectedItems(),K=[];C.forEach(Y,function(a){K.push({utgt:{n:a.n,did:a.did},utp:H.DMY_TP.ATTR,agg:1,flt:2,gb:true,rps:0,n:a.n});});var X;if(J.selectedIndex>0){var O=J.items[J.selectedIndex];X={n:O.n,did:O.did,t:E.METRIC,st:1024};}var M;if(W.et===15){W.dmt=G.NodeDimtyOutputLevel;W.dmy=W.dmy||{};W.dmy.uts=K;M=W.relation=W.relation||{};if(X){M.guide=X;W.useSchema=false;}else{delete M.guide;delete M.rsTp;delete M.joTp;delete M.paTp;delete M.erTp;W.useSchema=true;}W.applySubExpr=L.checked;U.set("data",W);}else{var V={et:15};V.dmt=G.NodeDimtyOutputLevel;V.dmy={};V.dmy.uts=K;M=V.relation={};if(X){M.guide=X;}else{V.useSchema=true;}V.applySubExpr=L.checked;var P=U,R={rq:V,cq:W},S=[U.childIndex()];if(W.et===I.ANDOR){if(W.nds&&W.nds.length>2){var Z=Q.childIdx;S=[Z,Z-1];}else{P=U.parent;}}else{P=U.parent;R.isMetric=!!W.m;}P.createSet(S,R);}},children:[{scriptClass:"mstrmojo.Box",alias:"attrsBox",cssClass:"Attributes-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14613,"Select attributes to create the set"),cssClass:"Label",alias:"attrsBoxLabel"},{scriptClass:"mstrmojo.ui.CheckList",alias:"attrsList",cssClass:"CheckList"}]},{scriptClass:"mstrmojo.Box",alias:"relBox",cssClass:"RelatedBy-Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12036,"Related by"),cssClass:"Label",cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"relPd",cssClass:"Pulldown",cssDisplay:"inline-block",allowHTML:false,onitemSelected:function B(J){}}]},{scriptClass:"mstrmojo.Box",alias:"appQualBox",cssClass:"AppQual-Box",children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"appQual",cssClass:"AppQual-CheckBox"},{scriptClass:"mstrmojo.Label",cssClass:"AppQual-Label",text:mstrmojo.desc(12038,"Apply this qualification independently of the relationship filter"),postBuildRendering:function(){if(this._super){this._super();}if(mstrApp.isWSStyling){this.set("text",mstrmojo.desc(15015,"Apply this qualification to define the set, and also to the results of the visualization."));}}}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float: right; border-collapse: separate; display: table;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(2397,"OK"),onclick:function(){var J=this.editor;J.onOK();J.close();},bindings:{enabled:function(){var K=this.parent.parent.attrsBox.attrsList,J=this.parent.parent.attrsBox.attrsList.selectedIndices;return K.getSelectedItems().length>0;},editor:"this.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.editor.close();},bindings:{editor:"this.parent.parent"}}]}],postBuildRendering:function A(){this._super();if(mstrApp&&mstrApp.isWSStyling){this.attrsBox.attrsBoxLabel.set("text",mstrmojo.desc(15013,"Select the attributes that you look for."));}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.css","mstrmojo.vi.ui.ElementsBrowser","mstrmojo.vi.ui.IncHierarchyCheckList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var G=mstrmojo.css,A=mstrmojo.mstr.EnumDSSXMLObjectTypes;var E="36px";mstrmojo.vi.ui.HierarchyElementsCheckListBrowser=mstrmojo.declare(mstrmojo.vi.ui.ElementsBrowser,null,{scriptClass:"mstrmojo.vi.ui.HierarchyElementsCheckListBrowser",children:[{scriptClass:"mstrmojo.HBox",slot:"searchBoxNode",alias:"util",cssClass:"elemsBrowser-utils-bar",children:[{scriptClass:"mstrmojo.Box",cssClass:"eb-box-search",alias:"box",children:[{scriptClass:"mstrmojo.TextBox",alias:"searchBox",hint:"Search",cssClass:"eb-searchBox",onEnter:function B(){var O=this.value,M=this.parent.parent.parent,N=!M.searchPattern&&!O;if(!N){M.set("searchPattern",O);}this.blur();}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-clear",text:"",onclick:function(){var M=this.parent.searchBox;M.set("value","");M.cleanUp();M.focus();M.onEnter();},bindings:{visible:"(this.parent.searchBox.value || '').length > 0"}},{scriptClass:"mstrmojo.Button",cssClass:"eb-searchBox-search",text:"",onclick:function(){var M=this.parent.searchBox;M.focus();M.onEnter();}}]}]},{scriptClass:"mstrmojo.HBox",slot:"buttonPanelNode",alias:"buttonPanel",cssClass:"elemsBrowser-button-panel"},{scriptClass:"mstrmojo.vi.ui.IncHierarchyCheckList",alias:"elementList",slot:"elementListNode",allowUnlistedValues:false,bindings:{disableLevel:"this.parent.disableLevel"},getDataHelper:function(){return this.parent.ifDataHelper;},getAttribute:function(){return this.parent.attribute;},isHiearachyDisplay:function F(){var M=this.parent;return !M.searchPattern||M.searchPattern==="";},setSelectedItems:function J(M){if(typeof M==="object"){this.setSelectionByExprJSON(M);}},postSelectionChange:function I(){var M=this.getAttribute();if(M){this.parent.onItemsSelectionChange(this.buildSelectionExprJSON(M));}}}],init:function L(M){this._super(M);G.addWidgetCssClass(this,"hierarchy");if(this.disableLevel){G.addWidgetCssClass(this,"disable-level");}},postCreateChildren:function D(){var M=this.elementList;this.util.addChildren(M.getLevelPopupConfig());this.buttonPanel.addChildren([M.getAllButtonConfig(true),M.getAllButtonConfig(false)]);},onattributeChange:function H(M){var N=this.elementList;N.clearItems();this._super(M);},onsearchPatternChange:function C(){var N=this.elementList,M=N.isHiearachyDisplay();this._super();this.buttonPanel.set("visible",M);this.layoutConfig.h.buttonPanelNode=M?E:"0px";this.doLayout();},isObjSearchable:function K(M){return true;},onElementsListchange:mstrmojo.emptyFn,updateClearAllBtnState:mstrmojo.emptyFn,_set_selectedItems:null});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.onetier.vi.prefs.LoginEditor","mstrmojo.vi.models.editors.ControlsViewFactory","mstrmojo.Editor","mstrmojo.hash");var V=mstrmojo.hash;function I(l){var m=mstrmojo.desc(14575,"Login failure."),o={"-50":mstrmojo.desc(15505,"Desktop cannot download dossiers with prompts that require an answer but do not have a default answer set."),"-51":mstrmojo.desc(15507,"You are not allowed to download dossiers from the server. Please check with the administrator of the project."),"-52":mstrmojo.desc(15543,"You are not allowed to upload dossiers to the server. Please check with the administrator of the project."),"-2147202292":m,"-2147216959":m};var n=o[l.taskErrorCode]||l.errorMessage||l.message||(l.taskErrorCode&&"TaskErrorCode:"+l.taskErrorCode+" (No error message).")||(l.getResponseHeader&&l.getResponseHeader("X-MSTR-TaskFailureMsg"));if(l.taskErrorCode!==-2147028992&&n!==undefined){mstrmojo.error({longDesc:n},undefined,{zIndex:100000});}return !n;}mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase",showPreferencesEditor:function B(){this.throwAbstractMethodError("savePreferences");},savePreferences:function d(l){this.throwAbstractMethodError("savePreferences");},getSavedPreferences:function h(l){this.throwAbstractMethodError("getSavedPreferences");},deleteServerConnections:function F(l){this.throwAbstractMethodError("deleteServerConnections");},testServerConnection:function J(l,m){this.throwAbstractMethodError("testServerConnection");},loginToWebserver:function C(m,o,l,n){this.throwAbstractMethodError("loginToWebserver");},loginToProxy:function D(p,o,l,m,n){this.throwAbstractMethodError("loginToProxy");},httpStatusCodeHandler:function k(p,l,n){var m=this,o;if(p===401||p===407){o=new mstrmojo.onetier.vi.prefs.LoginEditor(V.copy(n,{onLoginCancelled:function q(){m.authenticationCancelled();}}));}switch(p){case 200:l();break;case 401:case 407:o.open();break;case 404:case 500:mstrmojo.alert(mstrmojo.desc(13690,"Unable to connect to the server now. Please check your connection."));break;}},authenticationCancelled:function R(){this.throwAbstractMethodError("authenticationCancelled");},resumeDashboardExecution:function M(){this.throwAbstractMethodError("authenticationCancelled");},checkForDesktopUpdates:function a(){this.throwAbstractMethodError("checkForDesktopUpdates");},showProxyEditor:function O(){this.throwAbstractMethodError("showProxyEditor");},getProjects:function L(l,m){this.throwAbstractMethodError("getProjects");},getSessionState:function Z(n,m,l,o,p){this.throwAbstractMethodError("getSessionState");},getLoginFirstSessionState:function e(l,m){this.throwAbstractMethodError("getLoginFirstSessionState");},login:function S(l,m){this.throwAbstractMethodError("login");},loginFirst:function S(l,m){this.throwAbstractMethodError("loginFirst");},sendWebServerRequest:function Y(m,n,l){this.throwAbstractMethodError("sendWebServerRequest");},saveToServer:function E(l,m){this.throwAbstractMethodError("saveToServer");},openFromServer:function A(l,m){this.throwAbstractMethodError("openFromServer");},loadCube:function b(l,m){this.throwAbstractMethodError("loadCube");},getCubeInfo:function G(l,m){this.throwAbstractMethodError("getCubeInfo");},getPublicCloudSession:function N(l,m){this.throwAbstractMethodError("getPublicCloudSession");},saveToPublicCloud:function U(l,m){this.throwAbstractMethodError("saveToPublicCloud");},logout:function c(l,m){this.throwAbstractMethodError("saveToPublicCloud");},getWebServersProjects:function K(r){var l={},q=0,o=false,p=function(t){if(t&&!t.wsservlet){var v=this.parseServerURL(t.url);t.wsservlet=v.wsservlet;t.wsfolderpath=v.wsfolderpath;}return{success:function w(x){l[t.id]={};l[t.id].connection=t;l[t.id].loginInfo=x.loginInfo;if(x.loginRequired){l[t.id].loginFirst=true;}else{l[t.id].clusters=x.clusters;}},failure:function u(x){if(x.code===403){o=true;}else{if(!I(x)){if(x.status===401){l[t.id]={};l[t.id].connection=t;l[t.id].loginFirst=true;}}}},complete:function s(){q--;if(q===0){r.success(l,o);}}};}.bind(this),n=function n(s){this.getSavedPreferences({success:function u(v){s.success((v&&v.server&&v.server.conn)||[]);},failure:function t(v){s.failure(v);}});},m=function m(t,s){this.getProjects(t,s);};n.call(this,{success:function(s){s.forEach(function(t){if(t.url){q++;var v={connectionId:t.id},u=function(){m.call(this,v,p(t));}.bind(this);this.getLoginFirstSessionState(t.id,{success:function(w){v.sessionState=w.sessionState;u();},failure:function(){u();}});}}.bind(this));if(q===0){r.success(l);}}.bind(this),failure:function(s){r.failure(s);}});},getObjectInfo:function Q(l,m){this.throwAbstractMethodError("getObjectInfo");},getUserServices:function H(l,m){this.throwAbstractMethodError("getUserServices");},saveObjectACL:function P(l,m){this.throwAbstractMethodError("saveObjectACL");},getUserEntityInfo:function X(l,m){this.throwAbstractMethodError("getUserEntityInfo");},isCurrentProject:function j(m,l){this.throwAbstractMethodError("isCurrentProject");},getCleanDocModel:function g(l){this.throwAbstractMethodError("getCleanModel");},getDefaultPort:function W(l){return l==="https:"?443:80;},parseServerURL:function f(n){var s=document.createElement("a"),m="j2ee",o="asp";s.href=n;var q={};if(s.protocol!=="http:"&&s.protocol!=="https:"){s.href="http://"+n;}s.search.substr(1).split("&").forEach(function(u){var t=u.split("=");if(t.length===2){q[t[0].toLowerCase()]=t[1];}});var l=s.pathname.split("/"),r=l.pop(),p=l.splice(1,1)[0];return{url:n,conntp:s.protocol,wsn:s.hostname,wsport:s.port||this.getDefaultPort(s.protocol),wsfolderpath:l.join("/"),wsservlet:r,wspath:p,wstp:r.indexOf(".aspx")===-1?m:o,search:q};}});mstrmojo.onetier.vi.prefs.handleErrorMessage=I;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui._MonitorsTocPage","mstrmojo.vi.ui.LinkTargetSelector","mstrmojo.vi.ui.InlineDialogBase");mstrmojo.vi.ui.VisAsFilterInlineDialog=mstrmojo.declare(mstrmojo.vi.ui.InlineDialogBase,[mstrmojo.vi.ui._MonitorsTocPage],{scriptClass:"mstrmojo.vi.ui.VisAsFilterInlineDialog",_createTargetSelector:function C(){return new mstrmojo.vi.ui.LinkTargetSelector({alias:"targetSelector",orientation:"h",hostId:this.id,srcId:this.vis.id});},_setTargetsFunc:function B(){var E=this.vis,D=E.model;D.setVisAsFilter(E,this.changes);},_tocNavWarn:function A(D){var F=this,E=F.vis.model;mstrmojo.warn(mstrmojo.desc(15094,"Selecting targets on another page will discard all the selected targets on the current page."),{confirmBtn:{t:mstrmojo.desc(212,"Continue"),fn:function(){var G=E.getVizContentPanel()._tgtSelections;G&&G.clear();F.goToPage(D);},hot:true},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{title:mstrmojo.desc(15093,"Do you want to target visualizations on another page?")});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.EnumRWUnitType","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.vi.ui.TargetSelector","mstrmojo.vi.ui.TruncatedList","mstrmojo.vi.ui.InlineDialogBase");mstrmojo.requiresDescs(16166,11955,11956);var G=mstrmojo.array,A=mstrmojo.css,D=mstrmojo.dom;mstrmojo.vi.ui.FilterBoxInlineDialog=mstrmojo.declare(mstrmojo.vi.ui.InlineDialogBase,null,{scriptClass:"mstrmojo.vi.ui.FilterBoxInlineDialog",tocEnabled:false,selectFilters:true,init:function F(H){this._super(H);A.addWidgetCssClass(this,"filter-box-dialog");},_setTargetsFunc:function E(){this.vis.setTargets(this.changes.filterKeys);},toggleFields:function B(){if(this.cgbs.length!==0){this.forType.set("visible",true);}},_addChildren:function C(){var K=this,M=K.vis,I=M.model,N=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:mstrmojo.desc(16166,"Use <span>#</span> to filter data in").replace("#",M.title),visible:true},K._createTruncatedList(),{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-for-type",cssDisplay:"inline-block",alias:"forType",value:0,visible:false,selectedIndex:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(11955,"for #").replace("#",(K.cgbs[0]||{}).n),v:false},{n:mstrmojo.desc(11956,"for All Data"),v:true}],onitemSelected:function(O){K.changes.forAllData=O.v;},onenabledChange:function(){A.toggleClass(this.domNode,"disabled",!this.enabled);}}],H=I.getPanel(this.currentPanelKey,this.currentLayoutKey).children||[],J,L={};for(J=H.length-1;J>=0;J--){K._addVis(H[J],L);}this.addChildren(N);this.targetKeys=L;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.hash","mstrmojo.css");var A=mstrmojo.hash.copy;mstrmojo.ui.editors.controls.AdvancedColorPickerPopup=mstrmojo.declare(mstrmojo.ui.editors.controls.AdvancedColorPicker,[mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.editors.controls.AdvancedColorPickerPopup",locksHover:true,init:function E(F){this._super(F);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-AdvColorPickerPopup");},showPickerForCurrentMode:function D(){this._super();var G=this,F=function F(){if(G.visible){G.adjustCornersForPopupOverflow();}};if(this.pickerMode===2){this.colorStyle.markupMethods=A({onselectedIndexChange:F},A(this.colorStyle.markupMethods));}F();},onOpen:function C(){var F=this.parent;this.set("color",F?F.selectedValue:this.color);this.renderContent();this._super();},colorCanceled:function B(){this.close();}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Editor","HBox","HTMLButton","Label","SortRow","ButtonSwitch","CheckBox","_HasOwnAvatar","hash");mstrmojo.requiresCls("mstrmojo.ui._HasScroller","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(11591,3095,11592,2968,122,221,1442,12420,13153);var I=mstrmojo.desc,U=mstrmojo.array,Y=mstrmojo.hash,E=mstrmojo.dom,f=mstrmojo.css,L=0,h="top",V="bottom",g;mstrmojo.AdvancedSortData=null;function A(l,k){var m=new mstrmojo.SortRow(),j=mstrmojo.all[g];m.setPulldownOptions(k===L?j.sortData.rows:j.sortData.cols);m.setRank(l.children.length+1);l.addChildren([m]);}function K(j){return j&&j.isAsc===2;}function Q(s,l,p){var n,m,q,k=s.children,o=mstrmojo.all[g],r=function(){var z,x,w,v,AB,u=(p===L?o.sortData.rows:o.sortData.cols),t=[];for(z=0,x=l.length;z<x;z++){AB=l[z];if(K(AB)){var AA=AB.value.split("!").slice(0,2).join("!");if(U.some(u,function(j){return AA===j.v.split("!").slice(0,2).join("!");})){t.push(AB);}}else{for(w=0,v=u.length;w<v;w++){if(AB.value===u[w].v){t.push(AB);break;}}}}return t;};if(!o.isDesignMode){l=r();}for(n=0,m=0;n<k.length&&m<l.length;n++,m++){q=l[m];k[n].setSelected(q.value,q.isAsc,q.n);}for(;n<k.length;n++){k[n].setSelected("",1);}for(;m<l.length;m++){q=l[m];A(s,p);k[m].setSelected(q.value,q.isAsc,q.n);}}function J(){var j=this.children;if(j[j.length-1].getSortKey()===""){return ;}A(this,this.type);}function F(){var k,l=this.children;for(k=0;k<l.length;k++){var m=l[k];if(m.getRank()!==k+1){m.setRank(k+1);}}}function M(n,k){var m=this.xtab&&this.xtab.model,j;if(m){var l=((m.data||{}).gsi||{}).sorts;if(l){l=l[n.isRow?0:1]||[];j=U.filterOne(l,function(o){return o.key&&o.key.search(k)==0;});}}return j;}function Z(j){var k=j&&j.split&&j.split("!");return{unitType:k[0],unitId:k[1],axis:k[5]};}function P(){var o,m,l,q=[],s=mstrmojo.all[g],u=["appliedRows","appliedCols"],k=[];k.push(s.tabContainer.children[0].children);k.push(s.tabContainer.children[1].children);for(m=0;m<2;m++){var w=[],n;for(o=0;o<k[m].length;o++){n=k[m][o];l=n.getSortKey();if(l&&l!==" "){if(n.isCustomSort()){var r=M.call(s,n.originalPos,l),x=Y.copy(Z(r.key),{actions:r.actions,isCustomSort:true});w.push(x);}else{w.push({key:l,isAsc:n.isAscending()});}}}if(w.length===0){if(s.sortData[u[m]].length===0){w=null;}}q.push(w);}var v=s.sortData.hierarchicalSort,t=s.hrlSortBox.checked?v.stt:null,p=s.resHrlBox.checked?"1":"0";s.controller.onAdvancedSort(s.xtab,q,null,t,p);}mstrmojo.AdvancedSortEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.AdvancedSortEditor",help:"advanced_sort_editor.htm",cssClass:"mstrmojo-AdvancedSortEditor",title:I(11591,"Advanced Sort"),tabSwitcher:undefined,tabContainer:undefined,hrlSortBox:undefined,sortData:undefined,sourceAxis:1,init:function b(j){this._super(j);g=this.id;},onOpen:function H(){var j=this.sortData,m,p=["appliedRows","appliedCols"],l=this.sourceAxis-1,o=this.xtab,k=this.tabContainer,n=k.children;if(o&&o.isInFilterPanel&&o.isInFilterPanel()&&mstrApp&&mstrApp.isInVFInteractMode){f.addClass(this.domNode,"forVisFilter");}U.forEach(n,function(q,s){m=j[p[s]];U.forEach(q.children,function(t){t.setPulldownOptions(j[s===L?"rows":"cols"]);});Q(q,m,s);var r;U.forEach(q.children,function(u,t){r=u.getSortKey();if(r&&r.trim&&r.trim()){u.originalPos={isRow:s===L,index:t};}});J.call(q);F.call(q);});if(this.sourceType===mstrmojo.mstr.EnumDSSXMLObjectTypes.Metric){l^=1;}this.tabSwitcher.set("selected",l>=n.length?L:l);k.updateScrollbars();this.updateUseHierarchicalSort(l);},onClose:function(){U.forEach(this.tabContainer.children,function(j){U.forEach(j.children,function(k){k.resetPulldownOptions();});});},onTabChange:function(k){var j=this.tabContainer;j.children[k].set("visible",true);j.children[1-k].set("visible",false);j.set("selected",k);j.updateScrollbars();this.updateUseHierarchicalSort(k);},updateUseHierarchicalSort:function S(o){var n=(o===L)?"rows":"cols",t=(o===L)?"appliedRows":"appliedCols",k=this.sortData,r=k.hierarchicalSort,p=r.pref,u=r.rp,m=r.isOutlineMode,q=r.isRA,s=k[t],l=this.hrlSortBox,j=this.resHrlBox;l.set("visible",p==="1");l.set("checked",m||(p==="1"&&(s.length===0||q)));j.set("visible",false);j.set("checked",u);},updateTooltipConfig:function c(){if(E.isIE8){this.richTooltip.cssClass+=" ie8";c.repaint=!!!c.repaint;this.richTooltip.cssClass+=(c.repaint?" repaint":"");}},postBuildRendering:function d(){this._super();this.tabContainer.domNode.onselectstart=function(){return false;};},children:[{scriptClass:"mstrmojo.ButtonSwitch",alias:"tabSwitcher",label1:I(2968,"Rows"),label2:I(122,"Columns"),switchFn:function a(){this.parent.onTabChange(this.selected);}},{scriptClass:"mstrmojo.Widget",markupString:"<div class='rulesTitles'><div>"+I(3095,"Order")+"</div><div>"+I(11592,"Sort by")+"</div></div>"},{scriptClass:"mstrmojo.SortRulesPanelContainer",alias:"tabContainer",cssClass:"mstrmojo-AdvancedSortEditor-RulesPanelContainer"},{scriptClass:"mstrmojo.CheckBox",alias:"hrlSortBox",cssClass:"hrlSortBox",oncheckedChange:function(){if(E.isIE8){f[this.checked?"addClass":"removeClass"](this.labelNode,"checked");}},postBuildRendering:function d(){if(E.isIE8){var k=this,j=this.labelNode;E.attachEvent(j,"click",function(){k.set("checked",!k.checked);});}},label:I(13153,"Sort metrics hierarchically")},{scriptClass:"mstrmojo.CheckBox",alias:"resHrlBox",cssClass:"resHrlBox",oncheckedChange:function(){if(E.isIE8){f[this.checked?"addClass":"removeClass"](this.labelNode,"checked");}},postBuildRendering:function d(){if(E.isIE8){var k=this,j=this.labelNode;E.attachEvent(j,"click",function(){k.set("checked",!k.checked);});}},label:I(12420,"Respect Hierarchy")},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-WebButton Advanced-Sort-Editor-Button",text:I(221,"Cancel"),onclick:function(){mstrmojo.all[g].close();}},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-WebButton Advanced-Sort-Editor-Button",iconClass:"hot",text:I(1442,"OK"),onclick:function(){P();mstrmojo.all[g].close();}}]});function X(l,k){var j=Math.floor((l-k.y0-E.getVerticalScroll())/k.h);if(j<0){j=0;}else{if(j>=this.children.length){j=this.children.length-1;}}return j;}function B(n,l){var k=h,m=(Math.floor(n-l.y0)%l.h)/l.h,j=X.call(this,n,l);if(j===this.children.length-1){if(m>0.5||Math.floor((n-l.y0)/l.h)>j){k=V;}}else{if(m>0.5){if(j<this.children.length-1){j+=1;}}}return{edge:k,idx:j};}mstrmojo.SortRulesPanelContainer=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.SortRulesPanelContainer",selected:undefined,setupScrollNodes:function O(){var j=this.children[this.selected||0];this.scrollNode=j.domNode;if(!j.hasEventListener){f.addClass(this.scrollNode,"mstrmojo-scrollNode");E.attachMarkupEvent(this.id,this.scrollNode,"scroll");j.set("hasEventListener",true);}},onscroll:function e(){if(this._super){this._super();}var j;U.forEach(this.children,function(k){if(!j){U.forEach(k.children,function(n){if(!j){var m=n.sortRule.list,l=n.sortOrder.list;if(m.visible){j=m;}else{if(l.visible){j=l;}}}});}});if(j){j.set("visible",false);}},children:[{scriptClass:"mstrmojo.SortRulesPanel",cssClass:"mstrmojo-AdvancedSortEditor-RulesPanel",type:0},{scriptClass:"mstrmojo.SortRulesPanel",cssClass:"mstrmojo-AdvancedSortEditor-RulesPanel",type:1}]});mstrmojo.SortRulesPanel=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.SortRulesPanel",dropZone:true,draggable:true,avatarCssClass:"sort-rule-drag-avatar",type:undefined,hasEventListener:undefined,getDragData:function D(){return{};},createAvatar:function W(m,l){var n=l.src.data,k,j;n.y0=E.position(this.domNode).y;n.h=E.position(this.children[0].domNode).h;n.left=E.position(this.children[0].domNode).x;k=X.call(this,l.src.pos.y,n);j=this.children[k].domNode.cloneNode(true);n.index=k;n.node=this.children[k];if(mstrApp.getThemeClassName){f.addClass(j,mstrApp.getThemeClassName());}return j;},positionAvatar:function N(k,j){k.x=j.src.data.left+10;this._super(k,j);},isDragValid:function C(j){if(this.children.length===1){return false;}var k=this.domNode,m=this.children[Math.floor((j.src.pos.y-E.position(k).y-E.getVerticalScroll())/E.position(this.children[0].domNode).h)],l=j.src.e.target;return !(E.contains(m.sortRule.domNode,l,true,k)||E.contains(m.sortOrder.domNode,l,true,k));},ondragstart:function(j){this._super(j);var k=j.src.data;this.removeChildren(this.children[k.index]);k.y0=E.position(this.domNode).y;},ondragmove:function R(j){var p=j.src.data,q=j.last.y,o=p.tgtIdx,m=p.tgtEdge,n=B.call(this,q,p),l=n.idx,k=n.edge;if(o!==l||m!==k){if(o!==undefined){f.removeClass(this.children[o].domNode,m);}f.addClass(this.children[l].domNode,k);p.tgtIdx=l;p.tgtEdge=k;}this._super(j);},ondragend:function G(k){var l=k.src.data,j=l.tgtIdx;if(j!==undefined){f.removeClass(this.children[j].domNode,l.tgtEdge);}if(l.tgtEdge===V){j++;}this.addChildren([l.node],j);this.updatePanel();this._super(k);},pulldownActive:function(j){mstrmojo.css.toggleClass(mstrmojo.all[g].tabContainer.domNode,"disableScroller",j);},updatePanel:function(){F.call(this);J.call(this);mstrmojo.all[g].tabContainer.updateScrollbars();},deleteSortRule:function(j){this.removeChildren(j);this.updatePanel();},itemSelected:function(){this.updatePanel();},children:[{scriptClass:"mstrmojo.SortRow"},{scriptClass:"mstrmojo.SortRow"},{scriptClass:"mstrmojo.SortRow"}]});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.Widget","mstrmojo.ui.editors.controls.LinkGroup","mstrmojo.ui.PopupButton","mstrmojo.ui.PopupWidget");var D=mstrmojo.css,H="hidden";function E(){var K=this;this._hideLinkHandler=window.setTimeout(function(){if(!K._disableHide){D.addClass(K.linkBtnNode,H);}},200);}mstrmojo.vi.ui.rw._IsLinkBox=mstrmojo.provide("mstrmojo.vi.ui.rw._IsLinkBox",{_mixinName:"mstrmojo.vi.ui.rw._IsLinkBox",linkBtnNode:null,linkMenuCfg:null,init:function(L){if(this._super){this._super(L);}if(mstrApp.isDossier){return ;}var M=this,O=this.boxContent,K=this.model;this.linkMenuCfg=new mstrmojo.ui.PopupButton({cssDisplay:"",cssClass:H,isHostedWithin:false,anchorSlot:"domNode",alias:"linkMenu",markupString:'<div id="{@id}" class="hover-link-btn {@cssClass}" style="{@cssText}" mstrAttach:click></div>',markupSlots:{btnNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},postBuildRendering:function(){if(this._super){this._super();}M.linkBtnNode=this.domNode;},getPopupWidget:function N(){return this.linkPopup;},children:[{scriptClass:"mstrmojo.ui.editors.controls.LinkGroup",alias:"linkPopup",cssClass:"link-selection-editor "+mstrApp.getThemeClassName(),docModel:K,hostId:O.id,visible:false,onOpenCallback:function(){M._disableHide=true;},onCloseCallback:function(){M._disableHide=false;E.call(M);},postBuildRendering:function(){this.constructor.prototype.postBuildRendering.call(this);if(!this.popupConfig){this.popupConfig=this.parent.getPopupConfig();}}}]});this.addChildren([this.linkMenuCfg]);this._targetNameChangeListener=K.attachEventListener("ontitleChange",this.id,function(P){var Q=O&&O.node&&O.node.data;if(Q&&Q.navpage===P.panelKey){Q.navpagenm=P.newTitle;}});},destroy:function F(){if(this._targetNameChangeListener){this.model.detachEventListener(this._targetNameChangeListener);}this.linkMenuCfg=null;if(this._super){this._super();}},updateToolbar:function J(K){var L=this,M;if(this._super){K=this._super(K);}if(!mstrApp.isAppStatePresentation()){M=this.boxContent.hasActiveLink()?mstrmojo.desc(15703,"Edit Link..."):mstrmojo.desc(15702,"Link...");K.addMenuItem(M,"lnk",function(){var N=L.linkBtnNode;D.removeClass(N,H);N.click();});}return K;},addContextMenuItems:function B(K){return this.updateToolbar(K);},onmouseover:function I(K){if(!this._disableShow){this._super(K);if(this.boxContent.hasActiveLink()&&!mstrApp.isAppStatePresentation()){window.clearTimeout(this._hideLinkHandler);D.removeClass(this.linkBtnNode,H);}}},onmouseout:function G(K){this._super(K);E.call(this);},hideLinkButton:function A(){this.onmouseout();this._disableShow=true;},unhideLinkButton:function C(){this._disableShow=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.ui.PopupButton","mstrmojo.ui.PulldownCheckList");var G=mstrmojo.css,D=mstrmojo.hash,E={0:true};function B(){var O=this.selectedIndices=D.copy(this.getPopupList().selectedIndices),K=this.items,N=[],M=this.allIdx,L=this.noneIdx;if(K){if(O[M]){N.push(K[M].n);}else{if(O[L]){N.push(K[L].n);}else{mstrmojo.array.forEach(K,function(Q,P){if(O[P]){N.push(Q.n);}});}}}this.set("value",N.join(", "));}mstrmojo.ui.MultiSelectPulldown=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.ui._IsPulldown],{scriptClass:"mstrmojo.ui.MultiSelectPulldown",isHostedWithin:false,popupWidget:undefined,init:function J(K){this._super(K);G.addWidgetCssClass(this,"multi");this.hostedCSSClass=this.hostedCSSClass+" multi";},submitSelections:function A(){B.call(this);this.onchange();},_set_selectedIndices:function F(M,K){var L=this.selectedIndices=D.copy(K||this.selectedIndices||E);this.getPopupList().set("selectedIndices",L);B.call(this);return true;},select:function H(K){this.getPopupList().select(K);},getPopupWidget:function C(){return this.popupWidget;},getPopupList:function I(){return this.popupWidget.list;},children:[{scriptClass:"mstrmojo.ui.PulldownCheckList",alias:"popupWidget",useRichTooltip:true,showTooltipForLargeText:true}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Label","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ui.PulldownCheckList");var G=mstrmojo.array,A=mstrmojo.hash,D=mstrmojo.mstr.EnumDSSXMLObjectTypes.Dimension;mstrmojo.ui.SearchablePulldownCheckList=mstrmojo.declare(mstrmojo.ui.PulldownCheckList,null,{scriptClass:"mstrmojo.ui.SearchablePulldownCheckList",_changeList:null,useRichTooltip:true,showTooltipForLargeText:true,children:[{scriptClass:"mstrmojo.Label",alias:"noResults",cssClass:"nores",text:mstrmojo.desc(15559,"No result matches your search.")}].concat(mstrmojo.ui.PulldownCheckList.prototype.children),onOpen:function B(){var L=this.parent;if(this._super){this._super();}this._changeList=A.copy(L.selectedIndices);},onClose:function I(L){if(this._super){this._super(L);}this._changeList=null;},showTooltip:function J(L,N){var M=L.target||mstrmojo.dom.eventTarget(L.hWin,L.e);M=this.getItemNodeFromTarget(M);if(M){L=A.copy(L);L.srcElement=M;}this._super(L,N);},saveSelection:function C(){this.toggleCacheMode(true);this.parent.set("selectedIndices",A.copy(this._changeList));this.toggleCacheMode(false);},getChanges:function F(){return this._changeList;},onclearSelection:function(){var Q=this.list,O=this._changeList,M=Q.selectedIndices,P=this.parent.items,N=Q.items,L;if(A.isEmpty(M)){M={};A.forEach(O,function(S,R){if(S){L=G.find(N,"v",P[R].v);if(L>=0){M[L]=O[R];}}});Q.selectedIndices=M;}},onvisibleChange:function(){this.list.set("visible",this.visible);},postselectionChange:function E(W){if(this._super){this._super(W);}if(this._restoreSelection){delete this._restoreSelection;return ;}var P=this.parent.items,R=this.list.items,O=(P.length===R.length),S=W.added||[],N=W.removed||[],V=this._changeList,L=this.parent.allIdx,Q=R[L],U,M=function(){G.forEach(S,function(X){U=G.find(P,"v",R[X].v);V[U]=true;});G.forEach(N,function(X){U=G.find(P,"v",R[X].v);delete V[U];});};if(!V){return ;}if(Q&&(Q.t===D)){if(L===S[0]){G.forEach(R,function(X){if(X.t!==D||O){U=G.find(P,"v",X.v);if(U!==-1&&!V[U]){V[U]=true;}}});return ;}if(L===N[0]){G.forEach(R,function(X){U=G.find(P,"v",X.v);if(U!==-1&&V[U]){delete V[U];}});return ;}}if(V[L]){delete V[L];}M();},onitemsChange:function K(){var L=this.list.items;this.noResults.set("visible",L&&L.length===0);},toggleCacheMode:function H(L){this._restoreSelection=L;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.array","mstrmojo.Button","mstrmojo.css","mstrmojo.hash","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown","mstrmojo.func");mstrmojo.requiresDescs(221,1442,2751,2891,11949,11950,11951,11942,13397,13398,14640,14648);var R=mstrmojo.array,V=mstrmojo.css,N=mstrmojo.hash,O=mstrmojo.func,M=mstrmojo.Button.newWebButton,P=mstrmojo.dom,U="mstrmojo-link-validation",Q="mstrmojo-link-vt",F=function F(W){if(W.old){this.removedLinks.push(W);}this.links.removeChildren(W);},S=function S(){var t=this.dsMap,q=this.docModel,Z=q.datasets,v=function v(j,w,a){var k={n:a||"",did:w||null,parent:j||null,lv:(j?j.lv+1:-1),children:[]};if(j){j.children.push(k);}return k;},f=v(),Y,X,W,h,b,r,m,u,s,p,o,n,d,c,e,l,g;N.forEach(Z,function(a){if(q.isMDXDataset(a)){b=a.tables;for(p=0,c=b.length;p<c;p++){r=b[p];Y=v(f,r.did,r.n);Y.isMDX=true;for(o=0,e=r.dimensions.length;o<e;o++){m=r.dimensions[o];X=v(Y,m.did,m.n);for(n=0,l=m.hierarchies.length;n<l;n++){u=m.hierarchies[n];W=v(X,u.did,u.n);for(d=0,g=u.att.length;d<g;d++){s=u.att[d];h=v(W,s.did,s.n);h.att=s;t[r.did+":"+s.did]=h;}}}}}else{Y=v(f,a.did,a.name);Y.isMDX=false;R.forEach(a.att,function(j){h=v(Y,j.did,j.n);h.att=j;t[a.did+":"+j.did]=h;});}});return f;},B=function B(c,d){c=R.ensureArray(c);var b=this,a=this.attribute.did,e=this.docModel,Y=this.datasetId,X="\u001F",W={success:function(g){var j=g.als,f=(e.als&&e.als.links)||{},h=b.dsTree;R.forEach(c,function(r,m){var s={},k={},l=[],n={},q=a+" "+r,o=R.filter(j[m].ats,function(t){return !e.isInDataset(Y,t.at,["att"]);}),p=function p(t,u){if(!n[t]){n[t]={};}if(!n[t][u]){n[t][u]=true;}};R.forEach(o,function(v){var t=v.at,u=v.fms;s[t]=true;if(u){R.forEach(u,function(w){p(t,w.fm);});}});N.keyarray(f).forEach(function(t){if(t===q){R.forEach(f[t],function(u){u=u.split(" ");s[u[0]]=true;p(u[0],u[1]);});}});if(N.keyarray(s).length>0){R.forEach(h.children,function(u){var t=function(v){var w;if(!v.att){return ;}v=v.att;if(s[v.did]){if(!k[v.n]){k[v.n]={};}if(!k[v.n][v.did]){k[v.n][v.did]=[];}k[v.n][v.did].push(u.n);w=N.copy(v,w);w.dsId=u.did;l.push(w);}};if(u.isMDX){R.forEach(u.children,function(v){R.forEach(v.children,function(w){R.forEach(w.children,t);});});}else{R.forEach(u.children,t);}});}b.tgtAttrs[r]=l;b.tgtForms[r]=n;b.namesHash[r]=k;});}},Z={taskId:"validateDocumentLinks",msgID:e.mid,action:1,attributeList:a,attributeFormList:c.join(X)};mstrApp.serverRequest(Z,O.wrapMethods(W,d));},E=function(Z,b,X,a){Z.richTooltip=null;if(!Z.isSearching){var Y=b&&b.scrollWidth>b.clientWidth;X=Y?mstrmojo.desc(14648,"## from ###").replace("##",X):"";if(a){if(!Y){X=mstrmojo.desc(14640,"From ###");}X=X.replace("###",a);}var W=mstrmojo.dom.position(b);Z.richTooltip={cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:X,top:W.y-6,left:W.x};}},D=function D(d){var e=this,g=function(o){var m=o.fs,p=o.de,n=[];(m||[]).forEach(function(q){if(q.obf&&(!p||q.idf)){n.push({n:q.fnm,v:q.fid,idf:q.idf});}});return n;},h=g(this.attribute),a=function(p,n){var m=g(p);var q=(e.tgtForms[n]&&e.tgtForms[n][p.did])||{};var o=[];R.forEach(m,function(r){if(q[r.v]){o.push(r);}});return o;},c=function c(n){var m=[];R.forEach(e.tgtAttrs[n],function(o){if(a(o,n||e.idFormId).length>0){var q=e.namesHash[n],p=o.n;if(q[o.n]&&N.keyarray(q[o.n]).length>1){p=p+" ("+q[o.n][o.did].join(",")+")";}m.push({n:o.n,v:o,tt:p});}});if(m.length===0){m.push({n:mstrmojo.desc(13398,"No valid object"),v:{did:null},cls:"nvo",t:1});}return m;},j=c((d&&d.srcFormId)||this.idFormId),k=function(m,n){return R.find(m.fs,n?"fid":"idf",n||true);},l=function(n){var m=-1;j.forEach(function(p,o){if(p.v.did===n){m=o;}});return m;},X=function(n){var m=j[n];if(!m){return mstrmojo.desc(13397,"Select an attribute");}else{return m.n;}},Y=function(n){var o=n.items,m=n.selectedIndex;if(m>=0){if(o[m].idf){return ;}}o.forEach(function(q,p){if(q.idf){n.set("selectedIndex",p);}});};this.links.addChildren({scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-linkRow",slot:"containerNode",old:!!d,oldMeta:d,getMeta:function(){var m=this.linkFromForm,o=this.linkToAtt,n=this.linkToForm;return{srcAttrId:e.attribute.did,srcFormId:m.items[m.selectedIndex].v,tgtAttrId:o.items[o.selectedIndex]&&o.items[o.selectedIndex].v.did,tgtFormId:n.items[n.selectedIndex]&&n.items[n.selectedIndex].v};},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-attName",text:e.attribute.n,useRichTooltip:true,updateTooltipConfig:function(q){var p=q.target,m=this.text,n=e.datasetId,o=n?e.docModel.datasets[n].name:"";E(this,p,m,o);}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-linkFormFromPD",alias:"linkFromForm",value:"ID",isHostedWithin:true,items:h,selectedIndex:k(e.attribute,d&&d.srcFormId),onitemSelected:function(n){var m=this,o=function(){var q=m.parent.linkToAtt;j=c(n.v);q.set("items",j);q.set("selectedIndex",-1);q.set("text",mstrmojo.desc(13397,"Select an attribute"));V.addClass(q.selectedNode,"nvo");},p={success:o};if(this.hasRendered){if(this.parent.old){this.parent.oldUpdated=true;}if(!n.idf){Y(this.parent.linkToForm);if(!e.tgtForms[n.v]){B.call(e,n.v,p);return ;}}o();}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-linksToLabel",text:mstrmojo.desc(11949,"links to")},{scriptClass:"mstrmojo.ui.SearchablePulldown",cssClass:"mstrmojo-linkToAtt",alias:"linkToAtt",useRichTooltip:true,isHostedWithin:false,items:j,text:X(l(d&&d.tgtAttrId)),selectedIndex:l(d&&d.tgtAttrId),allowCustomText:true,allowEmptyText:true,updateTooltipConfig:function(r){var q=r.target,m=q.getAttribute("tt"),o=this.getSelectedItem(),n=o?o.v.dsId:null,p=n?e.docModel.datasets[n].name:"";if(this.selectedNode===q&&o){m=o.tt;}E(this,q,m,p);},onitemSelected:function(q){if(!q||q.v.did===null){return ;}var p=this.parent.linkToForm,o=this.parent.linkFromForm,n=a(q.v,o.items[o.selectedIndex].v),r=function r(s,u){var t=R.find(s,u?"v":"idf",u||true);if(t===-1&&s.length>0){t=0;}return t;},m;R.forEach(n,function(s){if(s.idf){m=false;return false;}});if(m){K.call(e,true);}p.set("items",n);p.set("selectedIndex",r(n,!this.hasRendered&&d&&d.tgtFormId));if(this.hasRendered&&this.parent.old){this.parent.oldUpdated=true;}J.call(e);},onPopupWidgetOpened:function b(){if(this.selectedIndex===-1){this.set("text","");}V.removeClass(this.selectedNode,"nvo");},onPopupWidgetClosed:function f(){mstrmojo.ui.SearchablePulldown.prototype.onPopupWidgetClosed.call(this);if(this.selectedIndex===-1&&this.text===""){this.set("text",mstrmojo.desc(13397,"Select an attribute"));V.addClass(this.selectedNode,"nvo");}else{V.removeClass(this.selectedNode,"nvo");}this.hideTooltip();R.forEach(e.collapseTargets,function(m){m.className="arrow-b";V.removeClass(m.parentNode.parentNode,"collapse");});R.forEach(e.collapseTreeNodes,function(m){delete m.collapse;});R.forEach(this.list.itemsContainerNode.childNodes,function(m){m.style.display="";});},postBuildRendering:function W(){mstrmojo.ui.SearchablePulldown.prototype.postBuildRendering.call(this);if(this.selectedIndex===-1){V.addClass(this.selectedNode,"nvo");}this.list.popupConfig.clear();},getPopupListConfig:function Z(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",width:"170px",tooltipOrientation:"vertical",selectionPolicy:"reselect",useRichTooltip:true,locksHover:true,listHooks:{select:function m(s,t,r){this.parent.set("selectedIndex",r);this.close();}},onclick:function n(AA){try{var s=AA.getTarget(),AB=this.getItemFromTarget(s),w=P.findAncestorByAttr(s,"idx",true,this.domNode),v=this.items;if(v){this.parent.set("items",v);}if(AB){AA.cancel();if(s.className==="arrow-b"||s.className==="arrow-r"){var r=this.itemsContainerNode.childNodes,u=function u(AD){var AC;while(AD){AC=AD.className||"";if(AC.indexOf("lv")===0){return window.parseInt(AC.substring(2),10);}AD=AD.firstChild;}return null;},z=function z(AC,AF){var AE=e.dsMap,AD=AE[AC.dsId+":"+AC.did];while(AD){if(AD.lv===AF){return AD;}AD=AD.parent;}return null;},x=function x(){var AL=(s.className==="arrow-b"),AF=s.parentNode.parentNode,AC=u(AF),AG=AB._renderIdx,AD=z(AB.v,AC),AJ=v.length,AI,AE,AH,AK,AN,AM;s.className=AL?"arrow-r":"arrow-b";if(!e.collapseTargets){e.collapseTargets=[];}e.collapseTargets.push(s);V.toggleClass(AF,"collapse",AL);AD.collapse=AL;if(!e.collapseTreeNodes){e.collapseTreeNodes=[];}e.collapseTreeNodes.push(AD);for(AI=AG+1;AI<AJ;AI++){AE=r[AI];AH=u(AE);if(AH<=AC){break;}AK=z(v[AI].v,AH);AN=AK.parent;AM=true;while(AN){if(AN.collapse){AM=false;break;}AN=AN.parent;}AE.style.display=(AM?"":"none");}};x();}else{if(w&&w.node.className.indexOf("item")!==-1){this.doItemSelect(AB,AA||{});}}}}catch(t){mstrApp.onerror(t);}},getItemProps:function o(t,r){var s=mstrmojo._IsList.getItemProps.call(this,t,r);var u=t.cls;if(u){s.addCls(u);}return s;},getItemMarkup:function q(AC,AB){if(AC.v.did===null){return'<{@tag} class="item {@cls}" did="'+AC.v.did+'" idx="{@idx}" style="{@style}">{@n}</{@tag}>';}var AD=[],z=AC.v.did,t=AC.v.dsId,u=t?e.docModel.datasets[t]:null,s=u?u.name:"",AA=AB>0&&this.items[AB-1].v,w=e.dsMap,v=w[AC.v.dsId+":"+z],r=w[(AA&&(AA.dsId+":"+AA.did))];AD.push("</div>");while(v){if(v.lv===-1){break;}if(v.att){var x=v.att.da?"derived-attr":"attr";AD.push('<div class="lv'+v.lv+' dim item {@cls}" tt="'+AC.tt+'" did="'+z+'" dsName="'+s+'" idx="{@idx}" style="{@style}"><div><div class="'+x+'"></div></div>{@n}</div>');}else{if(v!==r){AD.push('<div class="lv'+v.lv+' dim" dtt="'+v.n+'" idx="{@idx}"><div><div class="arrow-b"></div></div>'+v.n+"</div>");}else{break;}}v=v.parent;r=(r&&r.parent)||null;}AD.push("<div>");return AD.reverse().join("");},updateTooltipConfig:function p(w){var v=w.target,t=v.getAttribute("tt"),s=v.getAttribute("dtt"),u=v.getAttribute("dsName"),r=t||s;if(r){E(this,v,r,u);}}};}},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-linkFormToPD",alias:"linkToForm",value:"ID",isHostedWithin:true,items:[],onitemSelected:function(m){if(this.hasRendered){if(this.parent.old){this.parent.oldUpdated=true;}if(!m.idf){Y(this.parent.linkFromForm);}}}},M("",function(){F.call(e,this.parent);},false,{cssClass:"mstrmojo-removeLink"})]});this.links.renderChildren();},K=function(W){V.toggleClass(this.editorNode,"mstrmojo-advanced",W);},L=function(Z){var X=this,a=U,W;try{mstrmojo.all[a].destroy();}catch(Y){}W={scriptClass:"mstrmojo.Editor",id:a,title:mstrmojo.desc(2751,"Message"),cssClass:"mstrmojo-alert",buttons:[M(mstrmojo.desc(1442,"Ok"),function(){mstrmojo.all[a].destroy();H.call(X);},true)],children:[{scriptClass:"mstrmojo.Label",text:Z}],visible:true,zIndex:1000};mstrmojo.insert(W).render();},H=function(){var Y=this,X=this.illLinks,W=this.links.children,Z=Q;R.forEach(X,function(a){a=a.al;R.forEach(W||[],function(c){var e=c.getMeta(),f=c.linkToAtt,b,d;if(e.srcAttrId===a.alaid1&&e.tgtAttrId===a.alaid2){if(!mstrmojo.all[Z]){d=new mstrmojo.Tooltip({id:Z,cssClass:Y.themeClassName+" vi-warning vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,updatePopupConfig:null});P.attachEvent(Y.editorNode,"click",function(){d.close();V.toggleClass(f.selectedNode,"mstrmojo-Warning",false);});}else{d=mstrmojo.all[Z];}d.close();b=mstrmojo.dom.position(f.selectedNode);d.set("top",b.y-6);d.set("left",b.x);d.set("content",a.alstmsg);V.toggleClass(f.selectedNode,"mstrmojo-Warning",true);d.open();return false;}});});},A=function(){var W=mstrmojo.all[Q];if(W){W.close();}},J=function J(){this.buttons[0].enabled=true;if(this.btnHbox){this.btnHbox.children[0].set("enabled",true);}},G=function G(){var W=this,X=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-toolBox",alias:"tools",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-addLink",text:mstrmojo.desc(11950,"Add A Link"),title:mstrmojo.desc(11950,"Add A Link"),onclick:function(){D.call(W);A.call(W);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-showForms",text:mstrmojo.desc(2891,"Show Attribute Forms"),title:mstrmojo.desc(2891,"Show Attribute Forms"),onclick:function(){K.call(W,true);A.call(W);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton mstrmojo-hideForms",text:mstrmojo.desc(11951,"Hide Attribute Forms"),title:mstrmojo.desc(11951,"Hide Attribute Forms"),onclick:function(){K.call(W,false);A.call(W);}}],slot:"containerNode"},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-linksBox mstrmojo-advanced",alias:"links",slot:"containerNode"}];this.addChildren(X);};mstrmojo.vi.ui.editors.AttributeLinkEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.AttributeLinkEditor",title:mstrmojo.desc(11942,"Link Attributes"),cssClass:"mstrmojo-att-link",btnAlignment:"right",buttons:null,modal:true,visible:false,help:"link_attributes_editor.htm",attribute:null,tgtAttrs:null,tgtForms:null,docModel:null,datasetId:null,namesHash:null,removedLinks:null,preBuildRendering:function C(){var Z=this,X=this.docModel,Y=function(){var a=(X.als&&X.als.links)||{},b=[];N.keyarray(a).forEach(function(c){if(c.indexOf(Z.attribute.did+" ")===0){a[c].forEach(function(d){b.push({srcAttrId:c.split(" ")[0],srcFormId:c.split(" ")[1],tgtAttrId:d.split(" ")[0],tgtFormId:d.split(" ")[1]});});}});return b;},W;this.set("buttons",[M(mstrmojo.desc(1442,"OK"),function(){var h=[],b=Z.links.children,a=function(){var j=X.controller,k=X.controller.getRefreshCallback();if(h.length>0){j.cmdMgr.execute({execute:function(){this.submit(h,k,{style:{params:{treesToRender:3}}});},urInfo:{callback:k}});}Z.close();},g=false,d,e;Z.removedLinks.forEach(function(j){d=N.copy(j.oldMeta,{act:"applyAttributeLinking",unlink:true});h.push(d);});(b||[]).forEach(function(j){if(j.old&&j.oldUpdated){d=N.copy(j.oldMeta,{act:"applyAttributeLinking",unlink:true});h.push(d);}if(!j.old||(j.old&&j.oldUpdated)){e=j.getMeta();if(!e.tgtAttrId){return ;}d=N.copy(e,{act:"applyAttributeLinking",unlink:false});h.push(d);}});R.forEach(h,function(j){if(!j.unlink){g=true;return false;}});if(!g){a();return ;}var f={taskId:"validateDocumentLinks",msgID:X.mid,action:2,manipulationList:'{"ml":'+JSON.stringify(h)+"}"},c={success:function(j){if(j.als&&j.als.length>0){var k="";R.forEach(j.als,function(l){k+=l.al.alstmsg+"\n";});Z.illLinks=j.als;L.call(Z,k);return ;}a();}};mstrApp.serverRequest(f,c);},true,{enabled:false}),M(mstrmojo.desc(221,"Cancel"),function(){Z.close();})]);G.call(this);W=Y(this.attribute.did);if(W.length>0){W.forEach(function(a){D.call(Z,a);});J.call(this);}else{D.call(this);}this._super();},close:function I(){A.call(this);this.destroy();}});mstrmojo.vi.ui.editors.AttributeLinkEditor.open=function(c){var X=mstrmojo.insert(N.copy(c,{scriptClass:"mstrmojo.vi.ui.editors.AttributeLinkEditor",tgtAttrs:{},tgtForms:{},namesHash:{},removedLinks:[]})),a=X.attribute,d=a.did,W=X.docModel,Z=(W.als&&W.als.links)||{},Y=[],b={success:function(){X.set("visible",true);X.render();}};R.forEach(a.fs,function(e){if(e.idf){X.idFormId=e.fid;return false;}});N.keyarray(Z).forEach(function(f){var e=f.split(" ");if(e[0]===d){Y.push(e[1]);}});if(R.indexOf(Y,X.idFormId)===-1){Y.push(X.idFormId);}X.dsMap={};X.dsTree=S.call(X);B.call(X,Y,b);};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var N=mstrmojo.dom,b=mstrmojo.array,B=mstrmojo.css,h="animate",j="90px",o="70px",F="52px",v=200,Q=700,A=750;function D(){var AE=window.Modernizr,AD="transition";if(AE&&AE.testProp(AD)){return N.transEndEvtNames[AE.prefixed(AD)];}return null;}function x(AD){return function(){this.menuNode.style.display=AD?"block":"none";};}function P(AD){return Math.min(AD.offsetWidth-AD.firstChild.offsetWidth,0);}function w(AD){return AD.isAlignRight?"right":"left";}function AB(AD,AE){return parseInt(AD.style[w(AE)],10)||0;}function L(){var AH=this.tabContainerNode,AG=false,AF=false,AI=false,AJ=this.leftBtnNode,AD=this.rightBtnNode,AE=this.isValidMode();window.setTimeout(function(){if(P(AH)<0){var AL=N.position(AH),AK=N.position(AH.firstChild);AG=(AK.x<AL.x);AF=(AK.x+AK.w>AL.x+AL.w+1);}AI=AG||AF;B.toggleClass(this.btnBarNode,"highlightBar",AI);AJ.style.display=AD.style.display=AI?"block":"none";AJ.disabled=!AG;AD.disabled=!AF;B.toggleClass(AJ,"disable",!AG);B.toggleClass(AD,"disable",!AF);if(this.domNode){this.addBtnNode.style.display=this.tabStripMenuNode.style.display=AE?"block":"none";this.bufferNode.style.display=AE?"none":"block";this.floaterNode.style.display=this.hasFloater&&AG?"block":"none";}this.widgetResized();}.bind(this),v);}function U(AD,AE){AD=(AD||[]);if(!AD.filter){return b.filter(AD,AE);}return AD.filter(AE);}function X(AD,AE){AD=(AD||[]);if(!AD.map){return b.map(AD,AE);}return AD.map(AE);}function s(AT,AF,AG){var AR=this.tabContainerNode,AK=this.domNode;if(this.isStatic||!AR||!AK||AK.style.display==="none"){return ;}var AM=AR.firstChild,AS=P(AR),AJ=AB(AM,this),AD=Math.max(AJ,AS),AQ=U(this.children,function(AU){return AU.isSelected;})[0],AO=AG&&AG.domNode||AQ&&AQ.domNode;if(AT&&AO){if(AS<0){var AL=N.position(AO),AH=N.position(AR),AN=Math.floor(AL.x-AH.x),AP=Math.floor(AL.x+AL.w-(AH.x+AH.w));if(AG){var AE=Math.ceil(AO.offsetWidth);AN=AN===0?Math.max(AS,-AE):AN;AP=AP===0?Math.min(-AS,AE):AP;}var AI=AN<0?AN:(AP>0?AP:0);AD=this.isAlignRight?AD+AI:AD-AI;}}if(AD!==AJ){if(AF){this.setAnimation(AM);}AM.style[w(this)]=Math.max(AS,Math.min(AD,0))+"px";}L.call(this);}function C(AD){return AD.hasOwnProperty("index");}function J(){var AE=this.tabContainerNode,AF=N.position(AE),AD=this.isAlignRight;b.forEach(this.children||[],function(AH){var AN=AH.domNode,AO=N.position(AN),AK=Math.floor(AO.x-AF.x),AL=Math.floor(AO.x+AO.w-(AF.x+AF.w)),AG=AH.isSelected,AM=Math.ceil(AN.offsetWidth),AI=0;AH.isCutoff=AH.isHidden=AH.isLeftMost=AH.isRightMost=false;AH.leftEdgeHiddenWidth=AH.rightEdgeHiddenWidth=0;if(AK<0){var AJ=Math.abs(AK);AI=AM-AJ;AH.isLeftMost=AI>=0;AH.isCutoff=AH.isLeftMost&&AJ>0&&AI>0;AH.isHidden=AI<=0;AH.leftEdgeHiddenWidth=AJ;}else{if(AL>0){AI=AM-AL;AH.isRightMost=AI>=0;AH.isCutoff=AH.isRightMost&&AL>0&&AI>0;AH.isHidden=AI<=0;AH.rightEdgeHiddenWidth=AL;}}});}function Z(){var AD=this.children,AE=0;(AD||[]).every(function(AG,AF){if(!C(AG)){return false;}AE++;AG.index=AF;return true;});(AD||[]).every(function(AF){if(!C(AF)){return false;}AF.total=AE;return true;});}function g(AJ,AF){var AI=AJ.ENUM_CORNERS,AK=[AI.TOP_LEFT,AI.BOTTOM_LEFT],AE=this.parent;if(AE.position!=="bottom"){AK.reverse();}AJ.setAlignment(AK[0],AK[1]);var AD=N.position(AE.domNode),AH=AE.menuNode;var AG=AH.style;AG.top=(AF.y-AD.y)+"px";AG.left=(AF.x-AD.x)+"px";AJ.addPopupHandlers(AE.id,x(true),x(false));AJ.hostId=AE.id;AJ.hostElement=AH;AJ.isHostedWithin=false;AE.openPopup(AJ.newInstance());}function k(AD){AD.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-menu" mstrAttach:click><div id="tabCommonIcon" class="mstrmojo-VITabStrip-menuIcon"></div><div id="tabCommonButton" class="mstrmojo-VITabStrip-menuButton"></div><div id="tabCommonMenuHost" class="mstrmojo-VITabStrip-menuButtonHost"></div></div><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-buffer"></div><div class="mstrmojo-VITabStrip-btnBar"><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div class="mstrmojo-VITabStrip-addBtn-Img"></div><div class="mstrmojo-VITabStrip-addBtn-Text"></div></div><div class="mstrmojo-VITabStrip-navBtns"><div id="tabRightButton" class="mstrmojo-VITabStrip-rightBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div><div id="tabLeftButton" class="mstrmojo-VITabStrip-leftBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div></div></div><div class="mstrmojo-VITabStrip-floater"></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabStripMenuNode:function(){return this.domNode.firstChild;},menuImgNode:function(){return this.domNode.firstChild.firstChild;},menuBtnNode:function(){return this.domNode.firstChild.childNodes[1];},menuBtnHostNode:function(){return this.domNode.firstChild.lastChild;},tabContainerNode:function(){return this.domNode.childNodes[1];},containerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},bufferNode:function(){return this.domNode.childNodes[2];},btnBarNode:function(){return this.domNode.childNodes[3];},addBtnNode:function(){return this.domNode.childNodes[3].firstChild;},addBtnImgNode:function(){return this.domNode.childNodes[3].firstChild.firstChild;},addBtnTxtNode:function(){return this.domNode.childNodes[3].firstChild.lastChild;},navBtnsNode:function(){return this.domNode.childNodes[3].lastChild;},rightBtnNode:function(){return this.domNode.childNodes[3].lastChild.firstChild;},leftBtnNode:function(){return this.domNode.childNodes[3].lastChild.lastChild;},floaterNode:function(){return this.domNode.childNodes[4];},menuNode:function(){return this.domNode.childNodes[5];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabStripMenuNode:null,menuImgNode:null,menuBtnNode:null,menuBtnHostNode:null,tabContainerNode:null,addBtnNode:null,bufferNode:null,navBtnsNode:null,leftBtnNode:null,rightBtnNode:null,menuNode:null,position:"bottom",selectMovedTab:false,hasFloater:false,tabObjects:null,layoutConfig:{w:{tabContainerNode:"100%",bufferNode:"6px",addBtnNode:j,navBtnsNode:F,tabStripMenuNode:o},xt:true},onAppStateChange:function q(AK){var AI=mstrmojo.vi.VisualInsightApp.APP_STATES,AJ=AI.PRESENTATION,AD=AI.SELECTOR_TARGETING,AE=AK.value,AL=AK.valueWas,AH=this.isValidMode();if(AE&AJ||AL&AJ||AE&AD||AL&AD){var AF=this.addBtnNode,AG=this.tabStripMenuNode;if(AF&&AG){AF.style.display=AG.style.display=AH?"block":"none";this.bufferNode.style.display=AH?"none":"block";this.doLayout();}}},setStatic:function R(AD,AE){this.isStatic=AD;if(!AD){s.call(this,true,AE);}},setTabs:function p(AF,AD){this.removeChildren();this.tabObjects=AF;var AG=this,AE=(AF&&AF.length)||0;this.addChildren(X(AF,function(AJ,AH){var AI=AJ.k;return AG.getTabCfg(AF,AJ,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:AH,total:AE,draggable:!!AE,dropZone:!!AE,k:AI,isSelected:AI===AD,showTabMenu:g,tabMoved:function(AL){var AK=this.index;AG.moveTab(AK,AK+(AL?-1:1),AK);}});}));s.call(this,true);k(this);},getTabs:function l(){return U(this.children,C);},getTabCfg:function AC(AE,AF,AD){return AD;},deleteTab:function I(AD){var AJ=this.id,AI=this.children[AD],AH=D(),AG=function(){var AK=mstrmojo.all[AJ];AK.removeChildren(AI);AI.destroy();Z.call(AK);L.call(AK);k(AK);};if(AH){var AF=AI.domNode.firstChild,AE=AF.style;AE.width=AF.offsetWidth+"px";window.setTimeout(function(){B.addClass(AF,h);N.attachOneTimeEvent(AF,AH,AG);AE.width=0;},0);}else{AG();}},buildRendering:function c(){this._super();B.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function V(){var AD=this._super();s.call(this,true);return AD;},doLayout:function K(){this._super();s.call(this,true);},isValidMode:function E(){return !((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())||(mstrApp.allowWebDashboardDesign&&!mstrApp.allowWebDashboardDesign()));},setSelectedTab:function S(AD){b.forEach(this.children||[],function(AE){AE.set("isSelected",AE.k===AD);});k(this);},getSelectedTab:function f(){var AF=null,AE=this.children||[],AD;for(AD=0;AD<AE.length;AD++){if(AE[AD].isSelected){AF=AE[AD];break;}}return AF;},onclick:function n(AD){if(!this.isValidMode()){return ;}if(AD.getTarget()===this.addBtnImgNode||AD.getTarget()===this.addBtnTxtNode){this.addTab();}},addTab:mstrmojo.emptyFn,clearBtnTooltips:function O(AF){var AD=(AF===this.leftBtnNode),AE=(AF===this.rightBtnNode);if(AD||AE){this.clearTooltips();return true;}return false;},showBtnTooltips:function G(AD){var AF=AD.getTarget().parentNode,AE=this.clearBtnTooltips(AF);if(AE){this.toggleTooltip(AF);}},onmouseout:function t(AD){var AE=AD.getTarget().parentNode;this.clearBtnTooltips(AE);},onmouseover:function H(AD){this.showBtnTooltips(AD);},onmouseup:function a(AD){window.setTimeout(function(){this.showBtnTooltips(AD);}.bind(this),v);},onmousedown:function e(AM){var AI=AM.getTarget().parentNode,AN=(AI===this.leftBtnNode),AG=(AI===this.rightBtnNode);if(AN||AG){var AL=this.tabContainerNode,AH=AL.firstChild,AD=this.id,AJ=this,AF;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}B.addClass(AI,"active");var AK=function(){window.clearInterval(AF);B.removeClass(AI,"active");L.call(mstrmojo.all[AD]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};N.attachOneTimeEvent(document.body,"mouseup",AK);var AE=function(){var AQ=P(AL),AT=AB(AH,AJ),AU=AT-AQ,AS=0-AT;J.call(AJ);AJ.setAnimation(AH);var AO=AJ.getCornerTabs()||[],AR=U(AO,function(AV){if(AN&&AV.isLeftMost||AG&&AV.isRightMost){return AV;}})[0],AP=0;if(AR){AP=AR.isCutoff?(AN?AR.leftEdgeHiddenWidth:AR.rightEdgeHiddenWidth):Math.ceil(AR.domNode.offsetWidth);AP=Math.min(AP,AN?AS:AU);AP=AJ.isAlignRight?(AN?-AP:AP):(AN?AP:-AP);}AH.style[w(AJ)]=parseInt(AH.style[w(AJ)]||0)+AP+"px";};AE();AF=window.setInterval(function(){AE();},A);}},getCornerTabs:function d(){return U(this.children,function(AD){return AD.isLeftMost||AD.isRightMost;});},setAnimation:function Y(AD){var AE=D();if(AE){B.addClass(AD,h);N.attachOneTimeEvent(AD,AE,function(){B.removeClass(AD,h);});}},createTooltip:function z(AE){var AG=document.createElement("div");AG.className="navBtnTooltip";AG.appendChild(document.createTextNode(AE.getAttribute("tooltip")||""));var AJ=document.body.firstChild;AJ.parentNode.insertBefore(AG,AJ);var AH=5,AK=AG.offsetWidth-25,AF=AE.getBoundingClientRect(),AI=AG.getBoundingClientRect(),AD=AF.top-(AI.height+AH);AG.style.top=AD+"px";AG.style.left=(AF.left-AK)+"px";return AG;},clearTooltips:function m(){window.clearTimeout(this._tooltipTimeOut);var AD=document.querySelectorAll(".navBtnTooltip");b.forEach(AD||[],function(AE){AE.parentNode.removeChild(AE);});},toggleTooltip:function AA(AD){window.clearTimeout(this._tooltipTimeOut);if(AD.disabled){this._tooltipTimeOut=window.setTimeout(function(){this.createTooltip(AD);}.bind(this),Q);}},moveTab:function M(AD,AL,AJ,AI){var AE=this.children,AM=AE.splice(AD,1)[0];AE.splice(AL,0,AM);Z.call(this);this.setAnimation(this.tabContainerNode.firstChild);var AF=this.containerNode,AG=AF.childNodes,AK=AF.removeChild(AG[AD]),AH=AG[AL];if(AH){AF.insertBefore(AK,AH);}else{AF.appendChild(AK);}if(this.selectMovedTab||AM.isSelected){s.call(this,true,true,AM);}if(!AI&&AJ!==undefined&&AJ!==AL){this.commitTabMove(AJ,AL);k(this);}},commitTabMove:function u(AD,AE){throw new Error(this.scriptClass+" must implement commitTabMove.");},updateTabTable:function r(){if(!this.isStatic){s.call(this,true);}},setLinkIcon:function W(AD,AG){var AF,AE;if(AD){if(AG){AE="src";b.some(this.getTabs(),function(AH){if(AH.k===AG){AF=AH;}return AF;});if(!AF){return ;}}else{AE="tgt";AF=this.getSelectedTab();}B.addClass(AF.domNode,AE);}else{AE=AG?["src","tgt"]:"tgt";b.forEach(this.children,function(AH){B.removeClass(AH.domNode,AE);});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.color","mstrmojo.dom","mstrmojo.css","mstrmojo._HasOwnAvatar","mstrmojo.Container","mstrmojo.threshold.ThresholdModel","mstrmojo.threshold.ColorMarker");var Q=mstrmojo.color,D=mstrmojo.dom,R=mstrmojo.css;function B(X){var W=this.parent,V=W.width,Y=Math.min(Math.max(X.last.x-D.position(this.domNode).x,0),V-1);return Y/V;}mstrmojo.threshold.MarkersNode=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.threshold.MarkersNode",cssClass:"markers",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"  mstrAttach:click,mousedown,mouseover,mouseout></div>',markupSlots:{containerNode:function O(){return this.domNode;}},dropZone:true,draggable:true,avatarCssClass:"marker-drag-avatar",addMarker:function P(c){this.parent.parent.switchToCustomScheme();var V=this.parent,f=V.parent.model,e=D.position(this.containerNode).w,W=V.getPalette(),a=c/e,Y=V.addMarkerToMap(a),b=W.length,Z=new mstrmojo.threshold.ColorMarker();Z.updateCompValue(a);Z.updateRealValue(f.getRealValue(a,V.selectedOption,V.minValue(),V.maxValue()));Z.set("index",Y);this.addChildren([Z]);if(b===(Y+1)){Y--;}if(this.selectedIndex!==undefined&&this.selectedIndex>-1&&this.selectedIndex<this.children.length){this.children[this.selectedIndex].unselect();}this.selectedIndex=Z.index;var X=W[Y+1],d=Y===-1?X:W[Y];W.splice(Y+1,0,Q.findMidColorHex(d,X));V.update();this.children[this.selectedIndex].select();},remove:function M(V){if(V<0||V>=this.children.length){return ;}this.children[V].unselect();this.children.splice(V,1);this.domNode.removeChild(this.domNode.children[V]);},onclick:function U(W){if(this.parent.sliderMode===mstrmojo.threshold.ThresholdModel.SLIDER_MODE.COLOR_BASED&&W.getTarget()===this.domNode){var X=D.position(this.containerNode),V=W.e.clientX-X.x;this.addMarker(V);}},premousedown:function L(){this.parent.unselectAll();},createAvatar:function K(Y,X){var W;for(W=0;W<this.children.length;W++){if(this.children[W].id===Y.id){X.tgtNode=this.children[W];X.i=W;}}var V=Y.cloneNode(true),Z=document.createElement("div");R.addClass(Z,"bar");V.appendChild(Z);return V;},positionAvatar:function I(b){var V=this.avatar,X=V.style,Z=this.restrictedToAxis,W=D.position(this.domNode),Y=W.y;if(V){if(Z!=="y"){var a=b.x;if(a<W.x){a=W.x;}if(a>W.x+W.w){a=W.x+W.w-1;}X.left=a-2+"px";}if(Z!=="x"){X.top=Y+"px";}}},getMarkerComps:function H(V){if(!this.children){return undefined;}var W=this.children.map(function(X){return X.compValue;});return !!V?W.sort(V):W;},getMarkerRealValues:function N(V){if(!this.children){return undefined;}var W=this.children.map(function(X){return X.realValue;});return !!V?W.sort(V):W;},setMarkerRealValues:function F(W,Y,V,X){if(!this.children){return ;}this.children.forEach(function(a,Z){a.updateRealValue(W(a.compValue,Y,V,X));});},isDragValid:function A(V){return V.src.node!==this.domNode;},ondragstart:function S(W){this._super(W);var V=this.parent.getComp();this.selectedIndex=W.i;V.splice(W.i,1);},ondragmove:function J(W){this._super(W);var Z=this.parent,Y=Z.getComp(),d=Z.parent.model,X=B.call(this,W),a=this.children[W.i],V=W.tgt.pos.x-W.src.pos.x,b=V<0,c=V>0;if((a.compValue===0&&b)||(a.compValue===1&&c)){return ;}a.updateCompValue(X);a.updateRealValue(d.getRealValue(X,Z.selectedOption,Z.minValue(),Z.maxValue()));Z.editableBubble.showBubble(X,a.realValue);},ondragend:function E(X){var W=this.parent;comp=W.getComp(),currentMarker=this.children[X.i],newIndex=currentMarker.index,crossedIndices=this.children.filter(function(Z){return(Z.index>currentMarker.index&&Z.compValue<currentMarker.compValue)||(Z.index<currentMarker.index&&Z.compValue>currentMarker.compValue);}).map(function(Z){return Z.index;});if(crossedIndices.length>0){var V=crossedIndices[0],Y=crossedIndices[crossedIndices.length-1];newIndex=(currentMarker.index>V)?V:Y;}comp.splice(newIndex,0,currentMarker.compValue);this.remove(currentMarker.index);W.update();this.children[newIndex].select();this._super(X);},onmouseover:function G(W){if(this.parent.sliderMode===mstrmojo.threshold.ThresholdModel.SLIDER_MODE.COLOR_BASED&&!this._cursorAvatar){var Z=document,Y=this.domNode,X=this._cursorAvatar=Z.createElement("div"),V=this._mouseMoveHandler=function(d){var c=D.eventTarget(self,d),b=D.getMousePosition(d,self),a=X.style;a.top=b.y+12+"px";a.left=b.x+12+"px";a.display=(c===Y&&mstrApp.isInteractive())?"block":"none";};Z.body.appendChild(X);R.addClass(X,"mstrmojo-SimpleThresholdEditor add-cursor");D.attachEvent(Y,"mousemove",V);}if(this._super){return this._super(W);}},onmouseout:function C(V){if(this.parent.sliderMode===mstrmojo.threshold.ThresholdModel.SLIDER_MODE.COLOR_BASED){D.detachEvent(this.domNode,"mousemove",this._mouseMoveHandler);var W=this._cursorAvatar;W.parentNode.removeChild(W);delete this._cursorAvatar;delete this._mouseMoveHandler;}if(this._super){return this._super(V);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.range","mstrmojo.Widget","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo._HasSuggestion","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricDataService","mstrmojo.ui.ScrollableSuggestionList","mstrmojo.mstr.EnumDSSXMLObjectTypes");var R=mstrmojo.dom,U=mstrmojo.css,AI=mstrmojo.Enum_Keys,H=mstrmojo.range,l=H.EDGE,AA=mstrmojo.ME.MetricToken.isDelimiter,Q=mstrmojo.expr,s=mstrmojo.array,K=mstrmojo.hash;var M=R.isIE||R.isIEW3C;function AQ(E){return E.ctrlKey||R.isMetaKey(window,E)||(E.charCode||E.keyCode)===AI.CTRL;}mstrmojo.ME.SpanListMapper=mstrmojo.provide("mstrmojo.ME.SpanListMapper",mstrmojo.mixin({itemWrapperPrefix:function(E){return'<span class="'+this.getWrapperCss(E)+'">';},itemWrapperPrefill:"&nbsp;",itemWrapperSuffix:"</span>",createWrapperNode:function S(E){var AR=E.ownerDocument,AS=AR.createElement("span");return AS;},_iw2idx:function V(AR,AU,AT){var AS=this.wrapperNodes(AU),E=mstrmojo.array.indexOf(AS,AT);return E===-1?AS.length:E;},itemOffsetLeft:function j(AR,AV,E,AT){if(!AT){var AS=this.wrapperNodes(AV);AT=AS&&AS[E];if(!AT){return 0;}}var AU=AV.firstChild;if(!AU||(AU===AT)){return 0;}return AT.offsetLeft-AU.offsetLeft;},whereDrop:function AP(AZ,E,AT,AY,AR){var AV=this._nd2iw(AZ,E,AT),Aa,AX,AU,AW,AS;if(AV){AX=this._iw2idx(AZ,E,AV);Aa=AX;AU=this.itemOffsetLeft(AZ,E,null,AV);AW=AV.offsetTop;AS=AV.offsetWidth;if(AY.x>AR.left+AU+AS/2){Aa++;AU+=AS;}}else{return AZ.dropCuePos;}return{left:AU,top:AW,idx:Aa,idxActual:AX};}},mstrmojo.hash.copy(mstrmojo.WidgetListMapper)));mstrmojo.ME.TokenInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.ME.TokenInputBox",containerResizable:false,dropZone:true,suggestionPopupCssClss:"mstrmojo-ME-TokenInputBox-suggest",allowDrop:function G(E){var AR=E.src.data;return !!AR;},createToken:function A(E){return{v:mstrmojo.ME.MetricToken.brackets(E.n),oi:K.copyProps(["did","n","t"],E),isNew:true};},ondrop:function(AR){AR.src.data=this.createToken(AR.src.data.item);if(this.prepareDropItem){this.prepareDropItem(AR);}var E=this.insertTokens([AR.src.data]);this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");return E;},ondragenter:function I(E){this.dragdata=E.src.data;this._super(E);this.set("dropCuePos",{left:0,top:0});mstrmojo.css.addClass(this.domNode,"unselectable");},ondragleave:function W(){this.set("dropCuePos",null);mstrmojo.css.removeClass(this.domNode,"unselectable");},ondropCuePosChange:function Y(AR){var AS=AR.value,E=this.dragdata;if(E&&E.setAvatarClass){if(AS){E.setAvatarClass("add");}else{E.setInvalidAvatarClass();}}},makeObservable:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,markupString:'<div id={@id} class="mstrmojo-TokenInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit" contenteditable="true" tabindex="1" spellcheck="false"ondragstart = "return false;" oncontextmenu = "return false;" onkeydown = "return mstrmojo.all.{@id}.handlekeydown(event);" onkeypress = "return mstrmojo.all.{@id}.handlekeypress(event);" onkeyup = "return mstrmojo.all.{@id}.handlekeyup(event);" onmouseup = "return mstrmojo.all.{@id}.handlemouseup(event);" onpaste = "return mstrmojo.all.{@id}.handlepasteDirect(event);" onblur = "return mstrmojo.all.{@id}.handleblur(event);" >{@itemsHtml}</div><textarea class = "mstrmojo-TokenInputBox-clipboard" onkeyup = "return mstrmojo.all.{@id}.handlepaste(event);"></textarea><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild;},clipboardNode:function(){return this.domNode.childNodes[1];},scrollboxNode:function(){return this.domNode.firstChild;},dropCueNode:function(){return this.domNode.lastChild;}},suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",items:null,itemFunction:function J(AS,E,AR){return new mstrmojo.ME.MetricToken({data:AS,parent:AR});},listMapper:mstrmojo.ME.SpanListMapper,_set_items:function X(AR,E){if(this._super){this._super(AR,E);}if(this.oi){this.oi.tks.items=this.items;}if(!this.tokensCacheInitilized){this.pretokensModify();this.tokensCacheInitilized=true;}},tokensCache:[],tokensCachePointer:0,isDelimiter:AA,postBuildRendering:function e(){if(this._super){this._super();}this._eros=false;if(R.isFF){document.body.spellCheck=false;}mstrmojo.dom.attachEvent(this.editNode,"compositionstart",function(){this.saveStateForIME();this.composing=true;this.toggleIMEStatusBar(true);}.bind(this));mstrmojo.dom.attachEvent(this.editNode,"compositionupdate",function AR(AS){if(R.isIEW3C){this.lastImeChar=AS.data||(M&&this.lastImeChar);}else{this.lastImeChar=AS.data||this.lastImeChar;}}.bind(this));mstrmojo.dom.attachEvent(this.editNode,"compositionend",function E(AU){this.composing=false;if(R.isIE9||R.isIE10){var AT=H.getRangeInfo();this.imeBuffer=AT.startContainer.data.slice(this.prev_rInfo.startOffset,AT.startOffset).split("");}else{if(R.isIEW3C){var AT=H.getRangeInfo();this.imeBuffer=AT.startContainer.data.slice((this.prev_rInfo.startOffset-1)<0?0:this.prev_rInfo.startOffset,AT.startOffset).split("");}else{if(R.isEdge){var AS=AU.data||"";this.imeBuffer=(this.imeBuffer||[]).concat(AS.split(""));}else{var AS=AU.data||this.lastImeChar||"";this.imeBuffer=(this.imeBuffer||[]).concat(AS.split(""));}}}}.bind(this));},fnContextMenu:function N(E){if(E){E.cancelBubble=true;E.returnValue=false;}return false;},saveStateForIME:function h(){if(!this.doubleByte){this.doubleByte=true;this.prev_rInfo=H.getRangeInfo();this.prev_items=this.items;}},handleblur:function L(){if(this.doubleByte){this.doubleByte=false;this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;}},processDeleteKeyDown:function D(AR){if(!this.doubleByte){try{this.widgetHandleDelete(AR);this.startTokenSuggestion();this.raiseChangeEvent({type:"delete"});}catch(E){}return true;}},processBackspaceKeyDown:function AO(AR){if(!this.doubleByte){try{this.widgetHandleBackspace(AR);this.raiseChangeEvent({type:"backspace"});this.startTokenSuggestion();this.editNode.focus();}catch(E){}return true;}},handlekeydown:function b(AT){AT=AT||window.event;var E=AT.keyCode||AT.charCode,AR=false,AS=H.getRangeInfo();if((E===AI.LEFT_ARROW||E===AI.RIGHT_ARROW||E===AI.BACKSPACE)&&this.doubleByte){if(this.composing){return ;}this.doubleByte=false;if(E===AI.BACKSPACE){this.imeBuffer.pop();}this.widgetHandleImeInput(this.prev_rInfo);mstrmojo.dom.stopPropogation(window,AT);mstrmojo.dom.preventDefault(window,AT);return false;}switch(E){case AI.DELETE:AR=this.processDeleteKeyDown(AS);break;case AI.BACKSPACE:AR=this.processBackspaceKeyDown(AS);break;case AI.ENTER:if(this.breakOnEnterKeyDown&&this.breakOnEnterKeyDown()){break;}case AI.TAB:this._startDebug=true;if(this.suggestionShown){this.handleSuggestionItemSelect(this.getSelected());}else{this.startTokenSuggestion();}AR=true;break;case AI.ESCAPE:this.endTokenSuggestion();AR=true;break;case 86:if(AQ(AT)){this.handlePasteTriggeredDeletion();AR=false;}break;case 89:if(AQ(AT)){this.widgetHandleUndoRedo("redo");AR=true;}break;case 90:if(AQ(AT)){this.widgetHandleUndoRedo("undo");AR=true;}break;case 229:this.saveStateForIME();break;default:}if(AR){R.stopPropogation(window,AT);R.preventDefault(window,AT);return false;}return true;},handlePasteTriggeredDeletion:function F(){this.set("_saveRangeInfo",H.getRangeInfo());if(!this._saveRangeInfo.collapsed){this.widgetHandleDelete(this._saveRangeInfo);this.set("_saveRangeInfo",H.getRangeInfo());}this.clipboardNode.focus();},getCharacter:function AK(AR){var E=(R.isIE&&!R.isIE9)?AR.keyCode:AR.charCode;return(E>0)?String.fromCharCode(E):null;},handleCharacter:function AB(AT){var AU=this.getCharacter(AT),AR=false;if(AU&&!((AU==="c"||AU==="a")&&AQ(AT))){try{this.widgetHandleInput(H.getRangeInfo(),AU);this.raiseChangeEvent({type:"input",character:AU});if(!this.isDelimiter(AU)){if(this.useKeyDelay){var AS=this;window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){AS.startTokenSuggestion();},mstrmojo.ME.MetricDataService.suggestDelay);}else{this.startTokenSuggestion();}}else{this.endTokenSuggestion(true);}}catch(E){}AR=true;}return AR;},handlekeypress:function B(E){E=E||window.event;if(this.doubleByte){this.toggleIMEStatusBar(false);this.doubleByte=false;this.widgetHandleImeInput(this.prev_rInfo);window.setTimeout(function(){this.handleCharacter(E);}.bind(this),10);return false;}if(this.handleCharacter(E)){R.stopPropogation(window,E);R.preventDefault(window,E);return false;}return true;},handlekeyup:function g(AS){var E=AS.keyCode||AS.charCode,AR;if(E===AI.LEFT_ARROW||E===AI.RIGHT_ARROW){AR=this.findObjectToken();if(AR&&AR===this._saveActiveToken){this.startTokenSuggestion(AR);}else{this.endTokenSuggestion();}}else{if(E===AI.UP_ARROW){this.preHighlight();}else{if(E===AI.DOWN_ARROW){this.nextHighlight();}else{if(E===AI.BACKSPACE&&this.doubleByte){if(E===AI.BACKSPACE&&!this.composing&&!R.isIE9){this.doubleByte=false;this.imeBuffer.pop();this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;}}}}}this.set("_saveRangeInfo",H.getRangeInfo());},handlemouseup:function q(AT){if(this.dropCuePos){return false;}var AR=this.findObjectToken();if(AR&&AR===this._saveActiveToken){this.startTokenSuggestion(AR);}else{this.endTokenSuggestion();}var AS=H.getRangeInfo();if(this.doubleByte){this.doubleByte=false;var E=this.widgetHandleImeInput(this.prev_rInfo);this.prev_items=this.items;AR=R.findWidget(AS.startContainer);if(AR){this._delaySetTextCaretPos(AR.domNode,AS.startOffset);}else{this._delaySetTextCaretPos(E.domNode,AS.startOffset-1);}this.prev_rInfo=AS;}this.set("_saveRangeInfo",AS);},handlepasteDirect:function AF(E){this.clipboardNode.value=E.clipboardData.getData("Text");this.handlepaste(E);R.stopPropogation(window,E);R.preventDefault(window,E);this.handlePasteTriggeredDeletion();return false;},handlepaste:function o(AV){var AR=this.clipboardNode.value;this.clipboardNode.value="";var AU=[],E=AR&&AR.length,AT,AS="",AW;if(E>0){for(AT=0;AT<E;AT++){AW=AR.charAt(AT);if(this.isDelimiter(AW)){if(!mstrmojo.string.isEmpty(AS)){AU.push({v:AS,isNew:true});AS="";}AU.push({v:AW,isDelimiter:true,isNew:true});}else{AS=AS+AW;}}if(!mstrmojo.string.isEmpty(AS)){AU.push({v:AS,isNew:true});AS="";}this.insertTokens(AU);}},raiseChangeEvent:function(E){E.name="tokensModify";this.raiseEvent(E);},getTokensAsString:function AN(){var AR=[],AT=this.items,AS,E;for(AS=0,E=AT.length;AS<E;AS++){AR[AS]=AT[AS].v;}return AR.join("| ");},replaceErrorToken:function r(AT){var AS=this.items||[],AU=mstrmojo.array.find(AS,"sta",-1),AR,AV=function(Ab,AZ,Ac){var AY=(Ab&&Ab.items)||[],AX=s.find(AY,"did",AZ),AW,Aa;if(AX>-1){AW=AY[AX].fs;Aa=s.filterOne(AW,function(Ad){return Ad.fnm&&Ad.fnm.toUpperCase()===Ac.toUpperCase();});}return Aa;},E=function(Ab,AZ,Aa){var AW={v:AZ.n,oi:AZ,isNew:true},AY=Ab.v&&Ab.v.split("@"),AX;if(AY&&AY.length>1){AX=AV(Aa,AZ.did,AY[1]);if(AX){AW.exv=AX.fmdid||AX.fid;AW.extp=8;AW.v=mstrmojo.ME.MetricToken.brackets(AZ.n)+"@"+AX.fnm;}}return AW;};if(AU>-1){AR=E(AS[AU],AT,this.candidates);this.remove(AU);this.add([AR],AU);}},widgetHandleDelete:function f(AU){if(AU.collapsed){var AT,AS,E,AV=AU.startOffset,AR=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AU.startContainer,false,document.body)){H.collapseOnNode(this.editNode,false);return ;}AT=H.getEdgeInfo(AU.startContainer,AU.startOffset);AS=R.findWidget(AU.startContainer);E=this.itemIndex(AS.data);if(AT===l.EDGE_END){E++;AS=AR[E];AV=0;}if(!AS){H.collapseOnNode(this.editNode,false);return ;}if(AS.length()===1){this.remove(E);AS=AR[E];if(AS){H.collapseOnNode(AS.domNode,true);}else{H.collapseOnNode(this.editNode,false);}this.checkMergeTwoTokens(E-1,E);}else{AS.spliceContent(AV,1);H.collapseOnTextNode(AS.domNode,AV);}}else{this.widgetDeleteTokens(AU);}},widgetHandleBackspace:function z(AU){if(AU.collapsed){var AT,AS,E,AV=AU.startOffset,AR=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AU.startContainer,false,document.body)){if(AU.startOffset>0&&R.isFF){AS=AR[this.items.length-1];H.collapseOnNode(AS.domNode,false);AU=H.getRangeInfo();AT=H.getEdgeInfo(AU.startContainer,AU.startOffset);}else{H.collapseOnNode(this.editNode,true);return ;}}AT=H.getEdgeInfo(AU.startContainer,AU.startOffset);AS=R.findWidget(AU.startContainer);E=this.itemIndex(AS.data);if(AT===l.EDGE_BEGIN){E--;AS=AR[E];AV=AS.length();}if(!AS){H.collapseOnNode(this.editNode,true);return ;}if(AS.length()===1){this.remove(E);AS=AR[E-1];if(AS){H.collapseOnNode(AS.domNode,false);this.checkMergeTwoTokens(E-1,E);AS=AR[E-1];}else{H.collapseOnNode(this.editNode,true);}}else{AS.spliceContent(AV-1,1);H.collapseOnTextNode(AS.domNode,AV-1);}}else{this.widgetDeleteTokens(AU);}},widgetHandleInput:function AC(AV,AW){if(!AV.collapsed){this.widgetDeleteTokens(AV);AV=H.getRangeInfo();}var AS,AX,AY,AZ,E,AR,AT=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AV.startContainer,false,document.body)){this.add([{v:AW,isDelimiter:this.isDelimiter(AW),isNew:true}],0);AX=AT[0];H.collapseOnTextNode(AX.domNode,1);return ;}AS=H.getEdgeInfo(AV.startContainer,AV.startOffset);AX=R.findWidget(AV.startContainer);AY=this.itemIndex(AX.data);if(this.isDelimiter(AW)){AZ={v:AW,isDelimiter:true,isNew:true};if(AS===l.EDGE_MIDDLE){var AU=AX.split2Tokens(AV.startOffset);this.remove(AY);this.add([AU[0],AZ,AU[1]],AY);AY=AY+1;}else{AY=(AS===l.EDGE_BEGIN)?AY:AY+1;this.add([AZ],AY);}AX=AT[AY];H.collapseOnTextNode(AX.domNode,(AX.domNode.innerText||AX.domNode.textContent).length);}else{AR=AV.startOffset;if(AX.isDelimiter()){E=AT[(AS===l.EDGE_BEGIN)?AY-1:AY+1];if(E&&!E.isDelimiter()){AX=E;AR=(AS===l.EDGE_BEGIN)?AX.length():0;}}if(!AX.isDelimiter()){AX.spliceContent(AR,0,AW);H.collapseOnTextNode(AX.domNode,AR+1);}else{this.add([{v:AW,isNew:true}],(AS===l.EDGE_BEGIN)?AY:AY+1);AX=AT[(AS===l.EDGE_BEGIN)?AY:AY+1];H.collapseOnNode(AX.domNode,false);}}},widgetHandleImeInput:function AC(AU,AV){AV=AV||this.imeBuffer.join("");this.imeBuffer=[];this.lastImeChar=null;if(!AV){return ;}if(!AU.collapsed){this.widgetDeleteTokens(AU);AU=H.getRangeInfo();}var AS,AW,AX,AY,E,AR,AT=this.ctxtBuilder.itemWidgets;if(!R.contains(this.editNode,AU.startContainer,false,document.body)||this.items.length==0){this.clearTokens();this.add([{v:AV,isDelimiter:this.isDelimiter(AV),isNew:true}],0);AT=this.ctxtBuilder.itemWidgets;AW=AT[0];H.collapseOnTextNode(AW.domNode,1);this._delaySetCaretPos(AW.domNode,false);return ;}AS=H.getEdgeInfo(AU.startContainer,AU.startOffset);AW=R.findWidget(AU.startContainer);AX=this.itemIndex(AW.data);AR=AU.startOffset;if(AW.isDelimiter()){this.clearTokens();this.add(this.prev_items);AT=this.ctxtBuilder.itemWidgets;E=AT[(AS===l.EDGE_BEGIN)?AX-1:AX+1];if(E&&!E.isDelimiter()){AW=E;AR=(AS===l.EDGE_BEGIN)?AW.length():0;}}if(!AW.isDelimiter()){AW.spliceContent(AR,0,AV);this._delaySetTextCaretPos(AW.domNode,AR+AV.length);}else{this.add([{v:AV,isNew:true}],(AS===l.EDGE_BEGIN)?AX:AX+1);AW=AT[(AS===l.EDGE_BEGIN)?AX:AX+1];this._delaySetCaretPos(AW.domNode,false);}this.startTokenSuggestion();return AW;},findObjectToken:function C(){var AU=H.getRangeInfo(),AS=R.findWidget(AU.startContainer);if(!R.contains(this.editNode,AU.startContainer,false,document.body)){return null;}if(!AS||AS===this||!AS.isDelimiter){return null;}if(AS&&!AS.isDelimiter()){return AS;}var AT=H.getEdgeInfo(AU.startContainer,AU.startOffset),AR=this.ctxtBuilder.itemWidgets,E=this.itemIndex(AS.data);AS=AR[(AT===l.EDGE_BEGIN)?E-1:E+1];if(AS&&!AS.isDelimiter()){return AS;}return null;},checkMergeTwoTokens:function w(AU,AS){var AT=this.ctxtBuilder.itemWidgets,AR=AT[AU],E=AT[AS];if((AR&&!AR.isDelimiter())&&(E&&!E.isDelimiter())){this.remove([AU,AS]);this.add([AR.mergeTo(E)],AU);H.collapseOnTextNode(AT[AU].domNode,AR.length());}},insertTokens:function AE(AV){var AY=0,AX=this.editNode;var AS=this._saveRangeInfo||H.getRangeInfo();if(!AS||!R.contains(AX,AS.startContainer,false,document.body)){this.add(AV);AY=this.items.length-1;if(AY===0){this._delaySetTextCaretPos(AX,(AX.innerText||AX.textContent).length);}else{var E=this.ctxtBuilder.itemWidgets[AY].domNode;this._delaySetTextCaretPos(E,(E.innerText||E.textContent).length);}}else{var AR=H.getEdgeInfo(AS.startContainer,AS.startOffset),AW=R.findWidget(AS.startContainer);AY=this.itemIndex(AW.data);if(AR===l.EDGE_MIDDLE){var AT=AW.split2Tokens(AS.startOffset);this.remove(AY);AV.unshift(AT[0]);AV.push(AT[1]);this.add(AV,AY);}else{AY=(AR===l.EDGE_BEGIN?AY:AY+1);this.add(AV,AY);}AY=AY+AV.length-1;AW=this.ctxtBuilder.itemWidgets[AY];this._delaySetCaretPos(AW.domNode,false);}this.raiseChangeEvent({type:"insert"});var AU=this;window.setTimeout(function(){AU.set("_saveRangeInfo",H.getRangeInfo());},50);return AY;},insertParenthesisTokens:function AH(AR){var E=this;window.setTimeout(function(){var AS=E.insertTokens([{v:"(",isDelimiter:true,isNew:true},{v:")",isDelimiter:true,isNew:true}]);E._delaySetTextCaretPos(E.itemsContainerNode.childNodes[AS-1],1);},AR||50);},clearTokens:function v(E){this.set("items",E||[]);this.set("_saveRangeInfo",null);this._delaySetCaretPos(this.editNode,false);},focus:function AD(){var AR=this.ctxtBuilder.itemWidgets,E=AR.length;this._delaySetCaretPos(E>0?AR[E-1].domNode:this.editNode,false);},startTokenSuggestion:function AJ(E){this.endTokenSuggestion();if(!E){E=this.findObjectToken();}if(E&&!E.isDelimiter()){E.set("active",true);this._saveActiveToken=E;this.showSuggestion(this.getSearchPattern());}if(!E||this.getSearchPattern().length===0){this.hideSuggestion();}},browseItemVisible:true,folderLinksContextId:25,browsableTypes:[Q.TP.FOLDER,Q.TP.FACT,Q.TP.ATTR,Q.TP.FUNCTION,Q.TP.FILTER,Q.STP.PROMPT_OBJECTS,Q.TP.ATTR,Q.TP.DIM,Q.TP.METRIC,Q.TP.ROLE].join(","),getSearchPattern:function a(){var AR=this._saveActiveToken,AT=AR&&AR.data.v,E=AT&&AT.length;if(E>2){if(AT.charAt(0)==="["){AT=AT.substring(1);}if(AT.charAt(AT.length-1)==="]"){AT=AT.substring(0,AT.length-1);}}if(AR&&AR.data.ift){var AS=AR.data.v,AU=AS&&AS.indexOf("@");if(AU>=0){AT=AS.substring(AU);}}return AT||"";},getSuggestionPos:function k(){var E=this._saveActiveToken,AR=null,AT,AS;if(E){AT=E.data&&E.data.ift;AS=mstrmojo.dom.position(E.domNode,true);AR={left:Math.round(AS.x+(AT?AS.w:0))+"px",top:Math.round(AS.y+AS.h)+"px",zIndex:100};}return AR;},item2textCss:function O(AR){var E=(this._super&&this._super(AR))||{4:"m",11:"fx",12:"a",13:"fc",43:"tr",21:"afm","-99":"br"}[AR.t]||"";E+=AR.da?" da":"";E+=(AR.dm||AR.um)?" dm":"";E+=AR.de?" de":"";E+=AR.fs&&AR.fs.length&&AR.fs.some(function(AS){return AS.fgr>0;})?" g":"";return E;},onBrowserOpen:function x(){this.editNode.blur();},onSuggestionItemSelect:function AG(AR){var E=this._saveActiveToken;this.endTokenSuggestion();if(E){if(E.data.ift&&AR.t===21){E.setFormInfo(AR);}else{E.setItemInfo(AR);if(AR.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Function){this.insertParenthesisTokens();}}this._delaySetCaretPos(E.domNode,false);}this.closePopup();},_delaySetCaretPos:function AL(E,AS){var AR=this.editNode,AT=this,AU=function(){AR.focus();AR.focus();H.collapseOnNode(E,AS);AT.set("_saveRangeInfo",H.getRangeInfo());};window.setTimeout(AU,0);},_delaySetTextCaretPos:function AL(E,AU){var AR=this.editNode,AS=this,AT=function(){AR.focus();AR.focus();H.collapseOnTextNode(E,AU);AS.set("_saveRangeInfo",H.getRangeInfo());};window.setTimeout(AT,0);},getCandidatesThroughTaskCall:function d(AR,E){AR.objectType="11,12,13,43,4";AR.rootFolderType=39;AR.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AR,E);},filterCandidates:function u(AU,AT,E){var AR=this._saveActiveToken,AV=AR&&(AR.data.oi||AR.data.at),AS;if(AV&&AR.data.ift){E=E||this.suggestCount;AT=mstrmojo.string.regEscape(AT);AS=s.filter(AU,function(AW){return AW.t===21&&AW.attid===AV.did&&(new RegExp("^"+AT,"i")).test("@"+AW.n);},{max:E});}else{AS=s.filter(AU,function(AW){return AW.t!==21;});AS=this._super(AS,AT,E);}return AS;},endTokenSuggestion:function AM(AR){var E=this._saveActiveToken;if(E){if(AR){this.hideSuggestion();}E.set("active",false);this._saveActiveToken=null;}},widgetDeleteTokens:function p(AZ){var AR=AZ.startOffset,E=AZ.endOffset,Ac=R.findWidget(AZ.startContainer),Aa=R.findWidget(AZ.endContainer),AV=this.itemIndex(Ac.data),AT=this.itemIndex(Aa.data),AW=[],AX=H.getEdgeInfo(AZ.startContainer,AR),Ab=H.getEdgeInfo(AZ.endContainer,E),AY=(AX===l.EDGE_BEGIN?AV:AV+1),AS=(Ab===l.EDGE_END?AT:AT-1),AU;if(Ac===Aa){if((AX===l.EDGE_BEGIN)&&(Ab===l.EDGE_END)){this.remove(AV);Aa=this.ctxtBuilder.itemWidgets[AV===0?AV:AV-1];if(Aa){H.collapseOnNode(Aa.domNode,AV===0);}else{H.collapseOnNode(this.editNode,true);}}else{Ac.spliceContent(AR,E-AR);H.collapseOnTextNode(Aa.domNode,AR);}}else{for(AU=AY;AU<=AS;AU++){AW.push(AU);}this.remove(AW);if(AX===l.EDGE_MIDDLE){Ac.spliceContent(AR);}if(Ab===l.EDGE_MIDDLE){Aa.spliceContent(0,E);}if(AX===l.EDGE_BEGIN){Ac=this.ctxtBuilder.itemWidgets[AV===0?AV:AV-1];}if(Ac){H.collapseOnNode(Ac.domNode,AV===0);}else{H.collapseOnNode(this.editNode,false);}AV=(AX===l.EDGE_BEGIN)?AV-1:AV;this.checkMergeTwoTokens(AV,AV+1);}this.editNode.focus();},oncandidatesChange:function t(){var AR=this.candidates,E=(AR&&AR.items)||[];if(!this.noCache&&AR&&AR.isComplete){this.suggestCount=this.REQUEST_THRESHOLD=E.length;}else{this.suggestCount=mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=20;}},nudge:function(E){var AR=this.getSuggestionPos();if(AR){E.set("left",AR.left);E.set("top",AR.top);}},pretokensModify:function P(){this.tokensCache=this.tokensCache.slice(0,this.tokensCachePointer);var E=this.findObjectToken();this.tokensCache.push({items:K.clone(this.items),rInfo:H.getRangeInfo(),idx:E!==null?this.itemIndex(E.data):-1});this.tokensCachePointer=this.tokensCache.length;},widgetHandleUndoRedo:function n(AS){var AT,E,AR=function(AV){if(!AV){return ;}AV=AV||{};this.set("items",K.clone(AV.items));var AY=this.ctxtBuilder.itemWidgets,AU=AY[AV.idx],AX=AU&&AU.domNode||this.editNode,AW=AV.rInfo;this._delaySetTextCaretPos(AX,AW&&AW.startOffset||0);};switch(AS){case"undo":AT=--this.tokensCachePointer;if(AT>-1){E=this.tokensCache[AT-1];AR.call(this,E);}else{this.tokensCachePointer=1;}break;case"redo":AT=this.tokensCachePointer++;if(AT>-1&&AT<this.tokensCache.length){E=this.tokensCache[AT];AR.call(this,E);}else{this.tokensCachePointer=Math.min(Math.max(this.tokensCachePointer,1),this.tokensCache.length);}break;}},resetTokensCache:function Z(){this.tokensCache=[];this.tokensCachePointer=-1;this.tokensCacheInitilized=false;},toggleIMEStatusBar:function c(E){if((R.isIE9||R.isIE10||R.isIEW3C||R.isEdge)&&this.detectKoreanLocale()){if(E){if(!this.elStatus||!this.elStatus.offsetParent){var AR=this.elStatus=document.createElement("div");AR.innerText=mstrmojo.desc(15003,"Please enter space key to finish IME typing");AR.className="mstrmojo-TokenInputBox-status";this.domNode.appendChild(AR);}}else{this.domNode.removeChild(this.elStatus);delete this.elStatus;}}},detectKoreanLocale:function m(){var E=window.navigator;if(window.mstrConfig&&(window.mstrConfig.browserLang||[]).indexOf("ko")>=0){return true;}else{if(E.userLanguage=="ko"||E.userLanguage=="ko-KR"||E.browserLanguage=="ko"||E.browserLanguage=="ko-KR"){return true;}}return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.desc","mstrmojo.string","mstrmojo.Button","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui._HasMask","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.vi.models.EnumDragSources");mstrmojo.requiresClsP("mstrmojo.vi.ui","_IsViPanel");var L=mstrmojo.array,E=mstrmojo.dom,P=mstrmojo.hash,X=mstrmojo.vi.models.EnumDragSources,J=mstrmojo.emptyFn,B={};var V="ToggleContentsPanel",H="DisplayPanel",A="galleryPanel",I="propertiesPanel",b;function a(f){var e=this[f];if(e){return e;}return this.docCtrl.getViPanel(f);}function Y(f){var e=mstrApp.toggleViewBarModelData||mstrApp.menubarModelData,h=e&&e.items||[],g=[];L.forEach(h,function(j){if(j.n===f){g=j.items;return false;}});return g;}function G(e){return true;}function M(l,e){var j=this.model,h=j.controller,k=h.rootCtrl,g=k.view,f;if(l===V){return g.isCPVisible;}else{f=a.call(k,e);return f&&f.getOpenStatus();}}function U(j,e,h){var g=mstrApp.rootCtrl,f=g.view;if(j===V){return function(){f.setIsCPVisible(h);};}else{return function(){g.setPanelDisplay(e,h);};}}function S(e){var f=e&&e.src&&e.src.data;return f&&f.src;}function Z(f,e){if(f===H&&(e===A||e===I)){return mstrApp.allowWebDashboardDesign();}return true;}mstrmojo.vi.ui.ToggleViewBar=mstrmojo.declare(mstrmojo.vi.ui.toolbars.Toolbar,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsViPanel,mstrmojo.vi._MonitorsAppState,mstrmojo.vi.ui._HasMask,mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.vi.ui.ToggleViewBar",getItemMarkup:function C(f){var e;e=b=b||this._super(f).replace("{@en@n}",'<div><div class="btn"><div class="icn"></div></div></div>');return e;},getItemProps:function c(g,e){var f=this._super(g,e);if(g.active){f.addCls("active");}return f;},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onvisibleChange:function O(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";mstrApp.rootCtrl.view.toggleToggleViewBar(this.visible);},onisMaskedChange:function d(){this.onisMaskedChange();}},useRichTooltip:true,updateTooltipConfig:function R(f){var h=f.target||E.eventTarget(f.hWin,f.e),e=E.position(h),g=E.position(this.domNode);if(this.richTooltip){P.copy({posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:e.y-6,left:g.x+g.w+6},this.richTooltip);}},generateToolbar:function K(){var e=Y("view"),h=this;var f=new mstrmojo.ui.menus.ToolbarConfig(),g=0;e.forEach(function(k){var o=k.cmd,m=k.n,n=k.desc,l=k.descOff,j;if(o!==H&&o!==V||!Z(o,m)){return ;}B[m]=g++;j=G.call(h,o);f.addToggleToolbarButton({on:n,off:l,ttpOn:mstrmojo.desc(16022,"Click to Close ####").replace("####",n),ttpOff:mstrmojo.desc(16021,"Click to Open ####").replace("####",n)},m+(j?"":" disabled"),(j?U(o,m,true):J),(j?U(o,m,false):J),h.id,M.call(h,o,m));});this.set("toolbarCfg",f);},onRender:function F(){this._super();if(mstrApp.isAppStateSelection()){this.set("isMasked",true);}},onAppStateChange:function Q(e){this._super(e);var f=mstrApp.isAppStateSelection();this.set("isMasked",f);},allowDrop:function D(f){var e=[X.VIZ_EDITOR];return e.indexOf(S(f))>-1;},ondrop:function W(e){if(S(e)===X.VIZ_EDITOR){var f=e.src.data;f.onRemove(f.items&&f.items.length>1?f.items:f.item);}},getDropAvatarIcon:function N(e){return S(e)===X.VIZ_EDITOR?"remove":"move";}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.ToolbarConfig");mstrmojo.vi.ui.toolbars._HasToolbar=mstrmojo.provide("mstrmojo.vi.ui.toolbars._HasToolbar",{_mixinName:"mstrmojo.vi.ui.toolbars._HasToolbar",preBuildRendering:function A(){this.generateToolbar();return this._super();},generateToolbar:function B(){this.passToolbarCfg(this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));},updateToolbar:function D(E){if(this._super){E=this._super(E);}return E;},passToolbarCfg:function C(E){var F=this.toolbar.toolbarCfg;if(F){F.destroy();}this.toolbar.set("toolbarCfg",E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.hash","mstrmojo.array","mstrmojo.UUID","mstrmojo.ui.menus.ToolbarConfig");var J=mstrmojo.hash,G=mstrmojo.array,M=mstrmojo.css,D=mstrmojo.UUID;function Q(){var U=this.children,S=this.groupInfo,V=(S&&S._isDeleted)?S:{};delete V._isDeleted;U.forEach(function(X){var W=X.defn.gi;if(W&&W!==""){var Y=V[W];if(!Y){Y=V[W]=[];}Y.push(X.k);}});return V;}mstrmojo.vi.ui._HasGroup=mstrmojo.provide("mstrmojo.vi.ui._HasGroup",{_mixinName:"mstrmojo.vi.ui._HasGroup",clearGroupSelection:function O(){var V=this._tgtSelections;if(V){var U=this,S=V.getSelections();(S||[]).forEach(function(W){U.getUnitByKey(W).toggleBoxSelection(false);U.setLastSelectionClass(null,W);V.remove(W);});}},getGroupInfo:function I(){var S=this.groupInfo;if(!S||S._isDeleted){S=this.groupInfo=Q.call(this);J.forEach(S,function(V,U){if(V.length<2){delete S[U];}});}return S;},findGroupByKey:function R(U){var S=null;J.forEach(this.getGroupInfo(),function(W,V){G.forEach(W,function(X){if(U===X){S=V;return false;}});if(S){return false;}});return S;},getGroupContextMenuConfig:function N(b,c){var V=this._tgtSelections;if(V){var U=this.id,S=this.groupInfo,W,Y=1,Z=this.findGroupByKey(c);var a=function(d){return function(){S[d].push(c);V.notify(true,{selectedGroupId:d});};},X=function(e,d){return function(){var g=S[e],f=function(h){var j=mstrmojo.all[U].getUnitByKey(h);j.toggleBoxSelection(false);j.setGroupingStatus("");};g.splice(g.indexOf(c),1);if(g.length===1){f(g[0]);delete S[e];}if(d){S[d].push(c);}else{f(c);}V.notify(true,{selectedGroupId:d||e});};};for(W in S){if(W===Z){b.addMenuItem(mstrmojo.desc(15197,"Remove from Group ##").replace("##",Y),"",X(W,null),null,0);}else{if(Z){b.addMenuItem(mstrmojo.desc(15198,"Move to Group ##").replace("##",Y),"",X(Z,W));}else{b.addMenuItem(mstrmojo.desc(15199,"Add to Group ##").replace("##",Y),"",a(W));}}Y++;}if(Z){b.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"",function(){V.notify(true,{deleteGroupId:Z});});}return b;}},groupSelection:function E(){var S=this._tgtSelections;if(S){S.notify(true);}},addGroup:function F(S){var U=D.create();this.groupInfo[U]=S;return U;},selectGroup:function K(U){var S=this;var V=this._tgtSelections;if(V){U.forEach(function(W){V.toggleSelection(W);var X=S.getUnitByKey(W);X.toggleBoxSelection(true);X.setGroupingStatus("");});}},highlightGroup:function L(S){var V=this,U=this.getGroupInfo()[S];(U||[]).forEach(function(W){var X=V.getUnitByKey(W);X.setGroupingStatus("highlight");});},disableGroup:function H(S){var V=this,U=this.getGroupInfo()[S];var W=this._tgtSelections;if(W){(U||[]).forEach(function(X){var Y=V.getUnitByKey(X);Y.setGroupingStatus("disabled");Y.toggleBoxSelection(false);W.remove(X);});}},deleteGroup:function P(U){var W=this,S=this.getGroupInfo(),V=S[U];(V||[]).forEach(function(X){var Y=W.getUnitByKey(X);Y.setGroupingStatus("");});delete S[U];},clearGroupInfo:function A(){this.clearGroupSelection();var S=this.groupInfo;if(S){J.forEach(S,function(V,U){S[U]=[];});S._isDeleted=true;}},toggleHasGroupCSS:function B(S){M.toggleClass(this.domNode,"hasGroup",S);},submitGroupInfo:function C(){var W=this.getGroupInfo(),S=Q.call(this),V={},U={};J.forEach(W,function(Y,X){Y.forEach(function(a){var Z=S[X],b=Z?Z.indexOf(a):-1;if(b===-1){V[a]=X;U[a]="";}else{Z.splice(b,1);}});});J.forEach(S,function(Y,X){Y.forEach(function(Z){if(!V[Z]){V[Z]="";}U[Z]=X;});});if(Object.keys(V).length>0){this.model.saveGroupInfo(V,U,this);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi._MonitorsAppState","mstrmojo.EditableLabel","mstrmojo.vi.ui.toolbars.TitleToolbar");var J=mstrmojo.dom;mstrmojo.vi.ui.TitleBar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.TitleBar",markupString:'<div id="{@id}" class="mstrmojo-VITitleBar {@cssClass}" style="{@cssText}" mstrAttach:contextmenu,click><div class="left-toolbar"></div><div class="title-text"></div><div class="right-toolbar"></div></div>',markupSlots:{leftToolNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.childNodes[1];},rightToolNode:function(){return this.domNode.lastChild;},containerNode:function(){return this.domNode;}},markupMethods:{onhasContextMenuButtonChange:function(){var P=this.hasContextMenuButton;this.tbToolbar.set("visible",P);this.tbToolbar.set("enabled",P);},ontitleChange:function(){this.lblTitle.set("text",this.title||" ");},ontoolbarCfgChange:function(){var P=this.toolbarCfg;if(!P){return ;}this.tbToolbar.set("toolbarCfg",P);this.doLayout();},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{leftToolNode:"auto",textNode:"100%",rightToolNode:"auto"},h:{leftToolNode:"100%",textNode:"100%",rightToolNode:"100%"},xt:true},lblTitle:null,tbToolbar:null,hasContextMenuButton:true,editTitleOnClick:false,editTitleOnDoubleClick:true,editTitleOnTwoClicks:false,title:"",close:mstrmojo.emptyFn,toolbarCfg:null,beganEditingTitlebar:mstrmojo.emptyFn,titleEdited:mstrmojo.emptyFn,useRichTooltip:true,init:function O(P){this._super(P);this.addChildren([].concat(this.getLeftToolbarChildren()).concat(this.getTitleChildren()).concat(this.getRightToolbarChildren()));},shouldShowTooltip:function K(P,R){var Q=P.target||J.eventTarget(P.hWin,P.e);return Q===this.textNode.firstChild&&(Q.scrollWidth>Q.clientWidth);},getTooltipContent:function L(P){var R=P.target||J.eventTarget(P.hWin,P.e),Q=R.innerHTML;return Q;},showTooltip:function M(P,Q){if(this.shouldShowTooltip(P,Q)){this._super(P,Q);}},updateTooltipConfig:function I(Q){var R=Q.target||J.eventTarget(Q.hWin,Q.e),P=J.position(R);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.getTooltipContent(Q),top:P.y+P.h+3,left:P.x+4,cssClass:"vi-regular vi-tooltip-A"};},getLabelNode:function C(){return this.lblTitle.domNode;},getMenuConfig:function B(){var P=this.toolbarCfg;if(P){if(P.hasMenuItems()){return P;}}return null;},setToolbarVisibility:function D(P){this.tbToolbar.set("visible",P);},editTitle:function N(){this.lblTitle.set("isEditing",true);},onAppStateChange:function F(P){var Q=this.lblTitle,R=mstrApp.isAppStatePresentation(),S=!!(P.valueWas&mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION);if(R&&this._confgTitleEditable===undefined){this._confgTitleEditable=this.editTitleOnClick||this.editTitleOnDoubleClick||this.editTitleOnTwoClicks;}Q.set("isEditing",false);if(R||S){Q.set("editOnDoubleClick",!R&&this._confgTitleEditable);}},getLeftToolbarChildren:function A(){},getTitleChildrenLayoutOffsets:function H(){return{h:2,w:2};},getTitleChildren:function G(){return[{scriptClass:"mstrmojo.EditableLabel",slot:"textNode",alias:"lblTitle",bindings:{editOnClick:"this.parent.editTitleOnClick",editOnDoubleClick:"this.parent.editTitleOnDoubleClick",selectable:"this.isEditing",editOnTwoClicks:"this.parent.editTitleOnTwoClicks"},onTextEditBegin:function(){this.parent.beganEditingTitlebar();},onTextEditComplete:function(R,Q){this.parent.titleEdited(this.text,R,Q);},getLayoutOffsets:function P(){return this.parent.getTitleChildrenLayoutOffsets();}}];},getRightToolbarChildren:function E(){return[{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",slot:"rightToolNode",alias:"tbToolbar",visible:true,useRichTooltip:true,bindings:{hasContextMenuButton:"this.parent.hasContextMenuButton",}}];}});}());(function(){mstrmojo.requiresCls("mstrmojo.publisher","mstrmojo.Widget","mstrmojo.fx","mstrmojo.locales","mstrmojo.expr","mstrmojo.Button","mstrmojo.date","mstrmojo.ui.editors.controls.Stepper","mstrmojo.css");var AD=function(){return mstrmojo.locales.datetime;},k=mstrmojo.dom,j=mstrmojo.expr,AA=j.DTP,a=mstrmojo.date,J=mstrmojo.publisher,f=mstrmojo.hash,m=mstrmojo.array,N=m.removeIndices,l=mstrmojo.css;var AC=0,C=3,M=4,p=5,Q=6;var AE="month",d="day",W="year",Y="hour",AH="minute",w="second";var G='<table border="0" cellpadding="0" cellspacing="0">',v="</table>";function O(AI){return'<table border="0" cellpadding="0" cellspacing="0" style="'+AI+'">';}function H(AL,AI,AJ){var AK=a.getFirstDateOfMonth(AL,AI);return(AK.getDay()-AJ+8)%7;}function n(AL){var AK=a.parseDateAndOrTime(AL),AM,AI,AJ;if(AK){AJ={};AM=AK.date;AI=AK.time;if(AM){f.copy(AM,AJ);}if(AI){f.copy(AI,AJ);}}return AJ;}function F(AJ,AM,AL,AK,AI){var AN=a.formatDateInfo({day:AJ,month:AM,year:AL},AD().DATEOUTPUTFORMAT);return a.inDateTimeRange(AN,AK,AI)===0;}function U(AM,AL,AK){var AJ=AM.decreaseButton,AI=AM.increaseButton,AN="mstrmojo-Calendar";AJ.className=(AN+"-decrease");AI.className=(AN+"-increase");}function X(AM,AJ,AO,AL){var AK=0,AI=AM.length,AN;for(AK=0;AK<AI;AK++){AN=AM[AK];if(AN&&AN.day===AJ&&AN.month===AO&&AN.year===AL){return AK;}}return -1;}function q(AI,AK,AJ){var AL=new Date();return(AL.getFullYear()===AJ)&&((AL.getMonth()+1)===AK)&&(AL.getDate()===AI);}function u(AP,AQ){var AU=AP.dayView.getElementsByTagName("div"),AS=AP.selectedDates,AK=AS[AQ],AT=AP.browseYear,AJ=AP.browseMonth,AM=a.getDaysOfMonth(AT,AJ),AL=a.getPreMonth(AT,AJ),AO=a.getDaysOfMonth(AL.y,AL.m),AI=H(AT,AJ,AP.firstDayOfWeek),AN=((AK.month===AJ)?AK.day+AI-1:(AK.month>AJ?AK.day+AI+AM-1:AI-AO+AK.day-1)),AR=AU[AN];if(AR){c(AR,AP,false);}N(AS,AQ,1);}function B(AI){var AJ=AI.selectedDates;while(AJ.length){u(AI,0);}}function AG(AK,AI){var AJ=K(AK,AI),AL=AK.selectedDates;AL.push({day:AJ.d,month:AJ.m,year:AJ.y});c(AI,AK,true);}function o(AK,AL){if(!AL||!AL.length){return null;}var AN=AK.selectedDates;for(var AJ=0,AI=AL.length;AJ<AI;AJ++){var AM=AL[AJ],AO=r(AK,AM);AN.push({day:AM.d,month:AM.m,year:AM.y});if(AO){c(AO,AK,true);}}}function r(AQ,AS){var AU=AQ.dayView.getElementsByTagName("div"),AL=AU.length,AT=AQ.browseYear,AJ=AQ.browseMonth,AM=a.getPreMonth(AT,AJ),AN=a.getDaysOfMonth(AM.y,AM.m),AY=a.getNextMonth(AT,AJ),AK=a.getDaysOfMonth(AT,AJ),AI=H(AT,AJ,AQ.firstDayOfWeek);var AO=AI>0?{y:AM.y,m:AM.m,d:AU[0].innerHTML}:{y:AT,m:AJ,d:AU[0].innerHTML},AW=(AU.length-AK-AI)>0?{y:AY.y,m:AY.m,d:AU[AL-1].innerHTML}:{y:AT,m:AJ,d:AU[AL-1].innerHTML},AX=S(AO,AS),AP=S(AS,AW),AR=null;if(AX>=0&&AP>=0){var AV=0;if(AX<AI){AV=-1;}if(AP<(AU.length-AI-AK)){AV=1;}AR=((AV===0)?AS.d+AI-1:(AV===1?AS.d+AI+AK-1:AI-AN+AS.d-1));return AU[AR];}else{return null;}}function g(AQ,AI){var AS=AQ.selectedDates,AK=AS.length;if(!AK){return null;}var AJ=AS[AK-1],AL=K(AQ,AI),AV=S({y:AJ.year,m:AJ.month,d:AJ.day},AL),AW=[],AN=AV>0,AT=Math.abs(AV);for(var AP=0;AP<=AT;AP++){var AO=new Date(AL.y,AL.m-1,AL.d);AO.setDate(AO.getDate()+(AN?-AP:AP));var AU=AO.getFullYear(),AM=AO.getMonth()+1,AR=AO.getDate();if(AQ.isDateDisabled(AR,AM,AU,AQ.min,AQ.max)&&!AQ.canSelectDisabledDate){continue;}AW.push({y:AU,m:AM,d:AR});}return AW;}function S(AL,AK){var AI=new Date(AL.y,AL.m-1,AL.d),AJ=new Date(AK.y,AK.m-1,AK.d);return(AJ-AI)/1000/3600/24;}function K(AK,AI){var AL=AK.browseYear,AN=AK.browseMonth,AM=parseInt(AI.innerHTML,10),AO=parseInt(AI.getAttribute("m"),10),AJ=null;AJ=(AO===0)?{y:AL,m:AN}:(AO===1?a.getNextMonth(AL,AN):a.getPreMonth(AL,AN));AJ.d=AM;return AJ;}function h(AI){var AK=AI.selectedDates,AJ=AK.length;return(AJ===0)?null:AK[AJ-1];}function c(AJ,AK,AI){var AL=AK.selectedColor;l.toggleClass(AJ,["selected",AK.selectedCssStyle],AI);AJ.parentNode.style.backgroundColor=AI?AL:"";AJ.style.backgroundColor=AI?AL:"";}function z(AI){return AI.selectedColor?('style="background-color:'+AI.selectedColor+';"'):"";}function P(AI){return(AI.tagName.toLowerCase()==="td")?AI.firstChild:AI;}function R(AJ,AK){var AL=a.getDateJson(AJ),AI=a.formatDateInfo(AL,mstrmojo.locales.datetime.DATEOUTPUTFORMAT);if(AK===AA.TIMESTAMP){AI+=" "+a.formatTimeInfo(this.timeVal,mstrmojo.locales.datetime.TIMEOUTPUTFORMAT);}return AI;}function s(AN,AK){var AI=this.advancedValues,AJ=null;AI.set(AN,AK);switch(AI.baseDate){case C:AJ=new Date();break;case M:break;case p:break;case Q:break;default:return ;}var AL=AI.monthsToAdjust;if(AL>0){AJ.setMonth(AJ.getMonth()+(AI.toAddMonths?AL:-AL));}var AM=AI.daysToAdjust;if(AM>0){AJ.setDate(AJ.getDate()+(AI.toAddDays?AM:-AM));}this.set("value",R.call(this,AJ,this.dtp));}function V(){var AI=this.advancedValues,AJ=["isDyn"];if(AI.baseDate===AC){return null;}AJ.push(AI.baseDate);AJ.push(AI.toAddDays?AI.daysToAdjust:-AI.daysToAdjust);AJ.push(AI.toAddMonths?AI.monthsToAdjust:-AI.monthsToAdjust);AJ.push(0);AJ.push(0);AJ.push(0);AJ.push(0);AJ.push(this.value);AJ.push(this.timeVal.hour);AJ.push(this.timeVal.min);AJ.push(this.timeVal.sec);return AJ.join("::");}function AF(AI){if(AI.value!==undefined&&this.hasRendered){this.updateSelectedDate();}}function I(AK,AJ){var AL=this,AI=function(AM){return AM[0].toUpperCase()+AM.substring(1);};return{scriptClass:"mstrmojo.HBox",cssClass:"dateAdjustBox",alias:AK+"AdjustBox",children:[{scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:AJ>0?0:1,onitemSelected:function(AN,AM){s.call(AL,"toAdd"+AI(AK),AM===0);},items:[{did:0,n:mstrmojo.desc(9424,"plus")},{did:1,n:mstrmojo.desc(9425,"minus")}]},{scriptClass:"mstrmojo.ui.editors.controls.Stepper",width:null,height:null,provider:new mstrmojo.NumStepperContentProvider({item:{interval:1,min:0,value:Math.abs(AJ)},onTraverse:function(){s.call(AL,AK+"ToAdjust",this.curVal);}})},{scriptClass:"mstrmojo.Label",text:AK==="days"?mstrmojo.desc(707,"Days"):mstrmojo.desc(710,"Months")}]};}function Z(){this.buttonsNode.style.display=(this.wasAdvanced||this.changeValueOnOK||(this.showAdvanced&&this.isAdvanced)?"block":"none");this.advancedNode.style.display=this.showAdvanced?"block":"none";}mstrmojo.Calendar=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.Calendar",cssPrefix:"",browseMonth:null,browseYear:null,yearRangStart:null,selectedDates:null,selectedColor:"",isMultiSelect:false,hilightToday:false,yearViewSize:5,cssTextDay:"",cssTextMonth:"",cssTextYear:"",cssTextWeekDay:"",cssTextHeader:"",cssTextMonthYearLabel:"",forceNonEmptySelection:false,showCurMonthDatesOnly:false,currentView:d,duration:600,timeDelimiter:":",dtp:AA.DATE,value:"",firstDayOfWeek:1,changeValueOnOK:false,wasAdvanced:false,showAdvanced:false,isAdvanced:false,dynDateValue:null,canSelectDisabledDate:false,monthNames:function(AI){return AD().MONTHNAME_SHORT[AI];},dayNames:function(AI){return AD().dayShortNames[AI];},min:null,max:null,supportedViews:{day:true,month:true,year:true,hour:true,minute:true,second:true},sDirMatrix:{day:{month:"down",year:"down",hour:"up",minute:"up",second:"up"},month:{day:"up",year:"left",hour:"up",minute:"up",second:"up"},year:{day:"up",month:"right",hour:"up",minute:"up",second:"up"},hour:{day:"down",month:"down",year:"down",minute:"left",second:"left"},minute:{day:"down",month:"down",year:"down",hour:"right",second:"left"},second:{day:"down",month:"down",year:"down",hour:"right",minute:"right"}},markupString:'<div id="{@id}" class="{@cssPrefix} mstrmojo-Calendar {@cssClass}" style="{@cssText}" mstrAttach:mousedown,mouseup,mouseover,mouseout><div class="mstrmojo-Calendar-header" style="{@cssTextHeader}"><div class="mstrmojo-Calendar-decrease"></div><div class="mstrmojo-Calendar-increase"></div><div class="mstrmojo-Calendar-title"><span class="mstrmojo-Calendar-monthLabel" style="{@cssTextMonthYearLabel}">{@browseMonth}</span><span class="mstrmojo-Calendar-yearLabel" style="{@cssTextMonthYearLabel}">{@browseYear}</span></div></div><div class="mstrmojo-Calendar-body" style="{@cssTextBody}"><div class="mstrmojo-Calendar-dayView"></div></div><div class="mstrmojo-Calendar-timePart"><span class="mstrmojo-Calendar-hourLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-minuteLabel">00</span><span class="mstrmojo-Calendar-timeDelimiter">{@timeDelimiter}</span><span class="mstrmojo-Calendar-secondLabel">00</span><span class="mstrmojo-Calendar-AMPMLabel">AM</span></div><div class="mstrmojo-Calendar-advanced"></div><div class="mstrmojo-Calendar-buttons cf"></div></div>',markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onbrowseMonthChange:function(){this.monthLabel.innerHTML=this.monthNames(this.browseMonth-1);},onbrowseYearChange:function(){this.yearLabel.innerHTML=this.browseYear;},ondtpChange:function(){this.timePart.style.display=(this.dtp===AA.TIMESTAMP||this.dtp===AA.TIME)?"block":"none";this.advancedNode.style.display=this.showAdvanced?"block":"none";},onvalueChange:function(){if(this.lastValue===undefined||this.value!==this.lastValue){this.updateSelectedDate();}},onchangeValueOnOKChange:Z,onisAdvancedChange:Z},markupSlots:{monthLabel:function(){return this.domNode.firstChild.lastChild.firstChild;},yearLabel:function(){return this.domNode.firstChild.lastChild.lastChild;},decreaseButton:function(){return this.domNode.firstChild.firstChild;},increaseButton:function(){return this.domNode.firstChild.childNodes[1];},bodyContainer:function(){return this.domNode.childNodes[1];},dayView:function(){return this.domNode.childNodes[1].firstChild;},monthView:function(){return this.domNode.childNodes[1].firstChild;},yearView:function(){return this.domNode.childNodes[1].firstChild;},hourView:function(){return this.domNode.childNodes[1].firstChild;},minuteView:function(){return this.domNode.childNodes[1].firstChild;},secondView:function(){return this.domNode.childNodes[1].firstChild;},timePart:function(){return this.domNode.childNodes[2];},hourLabel:function(){return this.domNode.childNodes[2].firstChild;},minuteLabel:function(){return this.domNode.childNodes[2].childNodes[2];},secondLabel:function(){return this.domNode.childNodes[2].childNodes[4];},AMPMLabel:function(){return this.domNode.childNodes[2].childNodes[5];},advancedNode:function(){return this.domNode.childNodes[3];},buttonsNode:function(){return this.domNode.childNodes[4];}},init:function AB(AI){if(this._super){this._super(AI);}if(this.duration<1){this.duration=1;}if(!this.selectedDates){this.selectedDates=[];}this.timeVal={hour:0,min:0,sec:0};},ondynDateValueChange:function t(AI){if(AI.value!==undefined&&this.hasRendered){this.updateSelectedDate();this.buildChildren();}},onminChange:AF,onmaxChange:AF,buildChildren:function b(){var AO=this;if(this.showAdvanced){var AL=this.dynDateValue,AK=this.advancedValues||this.addDisposable(new mstrmojo.Model({})),AR=AL&&AL.split("::")||[],AN=AR[1]||AC,AJ=AR[2]||0,AS=AR[3]||0,AP=function AP(){if(AO.isAdvanced){AO.wasAdvanced=true;AO.changeValueOnOK=true;}AO.set("isAdvanced",!AO.isAdvanced);mstrmojo.css.toggleClass(AO.markupSlots.dayView.call(AO),["ddSelected"],AO.isAdvanced);s.call(AO,"baseDate",AO.isAdvanced?3:0);if(AO.parent&&AO.parent.nudge&&AO.isAdvanced){AO.parent.nudge();}};this.advancedValues=AK;AK.baseDate=parseInt(AN);AK.toAddDays=AJ>=0;AK.daysToAdjust=Math.abs(AJ);AK.toAddMonths=AS>=0;AK.monthsToAdjust=Math.abs(AS);this.isAdvanced=!!this.dynDateValue;if(this.domNode){mstrmojo.css.toggleClass(this.markupSlots.dayView.call(this),["ddSelected"],this.isAdvanced);}if(this.isAdvanced&&this.value){var AI=n(this.value),AM=this.timeVal;if(AI&&AI.hour!==undefined){AM.hour=AI.hour;AM.min=AI.min;AM.sec=AI.sec;}}s.call(AO,"baseDate",this.isAdvanced?3:0);this.destroyChildren(false);this.addChildren([{scriptClass:"mstrmojo.HBox",alias:"checkLabel",slot:"advancedNode",children:[{scriptClass:"mstrmojo.ui.Checkbox",alias:"checkbox",checked:!!AO.isAdvanced,oncheckedChange:AP},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13844,"Dynamic Date"),onclick:function AQ(){this.parent.checkbox.onclick();}}]},{scriptClass:"mstrmojo.Box",alias:"advancedPanel",slot:"advancedNode",bindings:{visible:"this.parent.isAdvanced"},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9423,"Today"),cssClass:"tdLabel"},I.call(this,"days",AJ),I.call(this,"months",AS)]},]);}else{this.destroyChildren(false);}this.addChildren([mstrmojo.Button.newWebButton(mstrmojo.desc(2140,"Cancel"),function(){AO.parent.close();},false,{slot:"buttonsNode"}),mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){if(AO.changeValueOnOK||AO.isAdvanced||AO.wasAdvanced){AO.updateValue(true);}},true,{slot:"buttonsNode"})]);},preBuildRendering:function A(){this.buildChildren();return this._super();},getSelectedDatesAsString:function E(AJ){var AI=[];m.forEach(this.selectedDates,function(AK){AI.push(a.formatDateInfo(AK,AJ||AD().DATEOUTPUTFORMAT));});return AI;},updateSelectedDate:function L(AN){var AI=this.value,AK=this.timeVal,AM=this.selectedDates,AL,AO=function(AQ,AP){AQ.set("browseYear",AP.year);AQ.set("browseMonth",AP.month);AQ.updateTimePart();AQ.updateView(AQ.currentView);if(!AQ.changeValueOnOK&&AQ.hasRendered&&AQ.closeOnValueChange!=true){AQ.updateValue();}};if(this.wasAdvanced){this.wasAdvanced=false;this.changeValueOnOK=false;}if(AI){AL=n(AI);if(AL&&AL.hour!==undefined){AK.hour=AL.hour;AK.min=AL.min;AK.sec=AL.sec;if(this.dtp===AA.TIME&&(AL.year===undefined||AL.month===undefined||AL.day===undefined)){var AJ=a.getDateJson(new Date());AL.year=AJ.year;AL.month=AJ.month;AL.day=AJ.day;}}}if((AL&&!this.isMultiSelect)||AN){B(this);}if(AM.length===0){if(!AL){if(this.parent.opener&&this.parent.opener.defaultDate){AL=n(this.parent.opener.defaultDate);}else{AL=a.getDateJson(new Date());}}if(!this.canSelectDisabledDate&&this.isDateDisabled(AL.day,AL.month,AL.year,this.min,this.max)){if(this.min&&a.compareDate(AL,this.min)<0){AL=n(this.min);}else{if(this.max&&a.compareDate(AL,this.max)>0){AL=n(this.max);}}}AM.push(AL);AO(this,AL);}else{AL=AM[0];if(this.value!==null){AO(this,AL);}}},updateValue:function e(AI){var AK=h(this),AJ="";if(AK){AJ=a.formatDateInfo(AK,AD().DATEOUTPUTFORMAT);if(this.dtp!==AA.DATE){var AL=a.formatTimeInfo(this.timeVal,AD().TIMEOUTPUTFORMAT);if(this.dtp===AA.TIME){AJ=AL;}else{AJ+=" "+AL;}}}this.lastValue=AJ;this.set("value",AJ);if(this.showAdvanced){this.set("dynDateValue",AI?V.call(this):null);}if(this.onValueUpdate){this.onValueUpdate();}},updateTimePart:function x(){var AJ=this.timeVal,AI=AJ.hour||0,AK=(AI%12===0)?12:(AI%12);this.hourLabel.innerHTML=AK;this.minuteLabel.innerHTML=a.formatInteger(AJ.min||0,2);this.secondLabel.innerHTML=a.formatInteger(AJ.sec||0,2);this.AMPMLabel.innerHTML=AI<12?" "+AD().AM_NAME:" "+AD().PM_NAME;},premousedown:function(AI){var AK=AI.e,AJ=k.eventTarget(AI.hWin,AK);if(AJ===this.decreaseButton||AJ===this.increaseButton){if(k.isFF){k.stopPropogation(window,AK);}return true;}else{return this.processEvent(AJ,AK);}},premouseup:function(AI){var AK=AI.e;if(AK.ctrlKey||AK.shiftKey){k.clearBrowserHighlights();}var AJ=k.eventTarget(AI.hWin,AK);if(AJ===this.decreaseButton&&!AJ.disabled){this.decrease();return true;}if(AJ===this.increaseButton&&!AJ.disabled){this.increase();return true;}},processEvent:function(AT,Aa){var AL=this.currentView,AM=this.selectedDates,AQ,AV,Ab,AI,AS;if(AT===this.monthLabel){if(AL!==AE){this.switchViewTo(AE);}return true;}if(AT===this.yearLabel){if(AL!==W){this.adjustYearStart();this.switchViewTo(W);return true;}}if(AT===this.hourLabel){if(AL!==Y){this.switchViewTo(Y);}return true;}if(AT===this.minuteLabel){if(AL!==AH){this.switchViewTo(AH);}return true;}if(AT===this.secondLabel){if(AL!==w){this.switchViewTo(w);}return true;}if(AT===this.AMPMLabel){if(AL!==Y){this.switchViewTo(Y);}return true;}if(AL===Y){var AO=AT.getAttribute("h");AS=parseInt(AT.innerHTML,10);if(!isNaN(AO)&&!isNaN(AS)){AO=parseInt(AO,10);this.timeVal.hour=AS%12+AO*12;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AL===AH){AS=parseInt(AT.innerHTML,10);if(!isNaN(AS)){this.timeVal.min=AS;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AL===w){AS=parseInt(AT.innerHTML,10);if(!isNaN(AS)){this.timeVal.sec=AS;this.updateTimePart();this.switchViewTo(d);if(!this.changeValueOnOK){this.updateValue();}}return true;}if(AL===d){var AZ=this.browseYear,AJ=this.browseMonth,AK;AT=P(AT);Ab=parseInt(AT.innerHTML,10);AI=parseInt(AT.getAttribute("m"),10);if(!isNaN(Ab)&&!isNaN(AI)){AK=(AI===0)?{y:AZ,m:AJ}:(AI===1?a.getNextMonth(AZ,AJ):a.getPreMonth(AZ,AJ));if((!this.canSelectDisabledDate&&this.isDateDisabled(Ab,AK.m,AK.y,this.min,this.max))||Aa.button===2){return true;}if(this.isAdvanced){return true;}var AW=X(AM,Ab,AJ,AZ),AU=AM.length>1,AR=this.forceNonEmptySelection,AX=this.isMultiSelect,AP=AX&&Aa.ctrlKey,AY=AX&&Aa.shiftKey,AN=null;if(AY){AN=g(this,AT);B(this);o(this,AN);}else{if(AP){if(AW===-1){AG(this,AT);}else{if(!AR||AU){u(this,AW);}}}else{B(this);if(AU||AW===-1||AR){AG(this,AT);}}}if(this.onselect||J.hasSubs(this.id,"select")){this.raiseEvent({name:"select",value:this.selectedDates});}if(AI===1){this.increase();}else{if(AI===-1){this.decrease();}}if(!this.changeValueOnOK){this.updateValue();}else{if(this.showAdvanced){this.checkLabel.checkbox.set("checked",false);s.call(this,"baseDate",0);}}}return true;}if(AL===AE){AT=P(AT);AV=parseInt(AT.getAttribute("m"),10);if(!isNaN(AV)){this.set("browseMonth",AV+1);this.switchViewTo(d);}return true;}if(AL===W){AT=P(AT);AQ=parseInt(AT.innerHTML,10);if(!isNaN(AQ)){this.set("browseYear",AQ);this.switchViewTo(d);}return true;}return true;},decrease:function(){var AK=this.currentView,AN=AK,AM=this.browseYear,AI=this.browseMonth,AJ=this.yearRangStart,AL;switch(AK){case d:AL=a.getPreMonth(AM,AI);this.set("browseMonth",AL.m);this.set("browseYear",AL.y);break;case AE:this.set("browseYear",AM-1);break;case W:this.yearRangStart=AJ-this.yearViewSize*this.yearViewSize;break;case Y:AN=w;break;case AH:AN=Y;break;case w:AN=AH;break;}this.switchViewTo(AN,"right");},increase:function(){var AK=this.currentView,AN=AK,AM=this.browseYear,AI=this.browseMonth,AJ=this.yearRangStart,AL;switch(AK){case d:AL=a.getNextMonth(AM,AI);this.set("browseMonth",AL.m);this.set("browseYear",AL.y);break;case AE:this.set("browseYear",AM+1);break;case W:this.yearRangStart=AJ+this.yearViewSize*this.yearViewSize;break;case Y:AN=AH;break;case AH:AN=w;break;case w:AN=Y;break;}this.switchViewTo(AN,"left");},updateView:function(AI){var AJ=this[AI+"ViewHTML"]();this[AI+"View"].innerHTML=AJ;},adjustYearStart:function(){this.yearRangStart=this.browseYear-10-this.browseYear%5;},switchViewTo:function(AJ,AL){var AP="mstrmojo-Calendar-"+AJ+"View",AO=document.createElement("div"),AI=this[this.currentView+"View"],AM=AJ+"ViewHTML",AN=this[this.currentView+"Label"],AK=this[AJ+"Label"];if(!this.supportedViews[AJ]){return ;}if(!AL){AL=this.sDirMatrix[this.currentView][AJ];}AO.className=AP;AO.innerHTML=this[AM]();this.currentView=AJ;this[AJ+"View"]=AO;mstrmojo.css.toggleClass(AO,["ddSelected"],this.isAdvanced);this._slideIntoView(AI,AO,AL);},_slideIntoView:function(AM,AQ,AK){var AI=this.bodyContainer,AO=(AK==="left"||AK==="right")?AM.offsetWidth:AM.offsetHeight,AJ=(AK==="left"||AK==="right")?"left":"top",AP=(AK==="left"||AK==="up")?AO:-AO,AN=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AM,onEnd:function(){AI.removeChild(AM);}}),AL=new mstrmojo.fx.AnimateProp({props:{},duration:this.duration,interval:this.duration/10,target:AQ});AQ.style[AJ]=AP+"px";AI.appendChild(AQ);AN.props[AJ]={start:0,stop:-AP,suffix:"px"};AL.props[AJ]={start:AP,stop:0,suffix:"px"};AN.play();AL.play();},dayViewHTML:function(){var AN=this.browseYear,AQ=this.browseMonth,AV=a.getDaysOfMonth(AN,AQ),AZ=a.getPreMonth(AN,AQ),AK=a.getDaysOfMonth(AZ.y,AZ.m),AJ=a.getNextMonth(AN,AQ),AR=H(AN,AQ,this.firstDayOfWeek),AO=[],AL=z(this),Ab=0,AI=this.selectedDates,AT=this.min,AX=this.max,Ac,AU,AY,AW,Aa=this.showCurMonthDatesOnly?'style="visibility:hidden;"':"";U(this,{d:AK,m:AZ.m,y:AZ.y},{d:1,m:AJ.m,y:AJ.y});AO.push(O(this.cssTextDay));AO.push(this._dayViewTHead());AO.push("<tr>");for(AY=0;AY<AR;AY++){Ac=AK-AR+AY+1;AU=this.isDateDisabled(Ac,AZ.m,AZ.y,AT,AX)?"disabled":"";AO.push("<td "+Aa+'><div class="mstrmojo-Calendar-day-pre '+AU+'" m="-1">');AO.push(Ac);AO.push("</div></td>");Ab++;}for(AY=0;AY<AV;AY++){Ac=AY+1;AU=this.isDateDisabled(Ac,AQ,AN,AT,AX)?" disabled":"";var AM=q(Ac,AQ,AN),AP=AM?" today":"",AS=X(AI,Ac,AQ,AN)!==-1;AP=(this.hilightToday&&AM)?" hilightToday":AP;AO.push("<td "+(AM?('class="'+AP+'" '):" ")+(AS?AL:"")+'><div class="mstrmojo-Calendar-day-cur'+(AS?(" selected "):"")+AU+'" m="0"'+(AS?AL:"")+">");AO.push(AY+1);AO.push("</div></td>");if((++Ab)%7===0){AO.push("</tr><tr>");}}for(AW=Ab;AW<42;AW++){Ac=Ab-AV-AR+1;AU=this.isDateDisabled(Ac,AJ.m,AJ.y,AT,AX)?"disabled":"";AO.push("<td "+Aa+'><div class="mstrmojo-Calendar-day-next '+AU+'" m="1">');AO.push(Ac);AO.push("</div></td>");if((++Ab)%7===0&&Ab!==42){AO.push("</tr><tr>");}}AO.push("</tr>");AO.push(v);return AO.join("");},_dayViewTHead:function(){var AL=[],AM='<thead><tr class="mstrmojo-Calendar-thead" style="'+this.cssTextWeekDay+';">',AK="</tr></thead>",AJ=this.firstDayOfWeek-1,AN=this.dayNames,AI;AL.push(AM);for(AI=AJ;AI<AJ+7;AI++){AL.push("<td>");AL.push(AN(AI%7));AL.push("</td>");}AL.push(AK);return AL.join("");},monthViewHTML:function(){var AJ=[],AL=this.browseMonth-1,AK=this.browseYear,AI;U(this,{d:31,m:12,y:AK-1},{d:1,m:1,y:AK+1});AJ.push(O(this.cssTextMonth));AJ.push("<tr>");for(AI=0;AI<12;AI++){AJ.push("<td "+((AI===AL)?z(this):"")+'><div class="mstrmojo-Calendar-month'+((AI===AL)?" selected":"")+'" m="');AJ.push(String(AI));AJ.push('">');AJ.push(this.monthNames(AI));AJ.push("</div></td>");if(AI%3===2){AJ.push("</tr><tr>");}}AJ.pop();AJ.push("</tr>");AJ.push(v);return AJ.join("");},yearViewHTML:function(){var AN=this.yearRangStart,AJ=[],AL=this.browseYear,AM,AI,AK=this.yearViewSize;U(this,{d:31,m:12,y:AN-1},{d:1,m:1,y:AN+AK*AK});AJ.push(O(this.cssTextYear));AJ.push("<tr>");for(AI=0;AI<AK*AK;AI++){AM=AN+AI;AJ.push("<td "+((AL===AM)?z(this):"")+'><div class="mstrmojo-Calendar-year'+((AL===AM)?" selected":"")+'">');AJ.push(AM);AJ.push("</div></td>");if(AI%AK===(AK-1)){AJ.push("</tr><tr>");}}AJ.pop();AJ.push("</tr>");AJ.push(v);return AJ.join("");},hourViewHTML:function(){var AK=[],AJ=this.timeVal.hour,AI;AK.push(G);AK.push('<tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AK.push(AD().AM_NAME);AK.push("</div></td></tr>");for(AI=0;AI<12;AI++){AK.push('<td><div class="mstrmojo-Calendar-hour'+((AI===AJ)?" selected":"")+'" h="0">');AK.push((AI===0)?12:AI);AK.push("</div></td>");if(AI===5){AK.push("</tr><tr>");}}AK.push('</tr><tr><td colspan="6"><div class="mstrmojo-Calendar-hourTitle">');AK.push(AD().PM_NAME);AK.push("</div></td></tr>");for(AI=0;AI<12;AI++){AK.push('<td><div class="mstrmojo-Calendar-hour'+(((12+AI)===AJ)?" selected":"")+'" h="1">');AK.push((AI===0)?12:AI);AK.push("</div></td>");if(AI===5){AK.push("</tr><tr>");}}AK.push("</tr>");AK.push(v);return AK.join("");},minuteViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.min,"mstrmojo-Calendar-minute");},secondViewHTML:function(){return this._minuteSecondViewHTML(this.timeVal.sec,"mstrmojo-Calendar-second");},_minuteSecondViewHTML:function(AK,AL){var AJ=[],AI;AJ.push(G);AJ.push("<tr>");for(AI=0;AI<60;AI++){AJ.push('<td><div class="');AJ.push(AL);AJ.push((AI===AK)?' selected">':'">');AJ.push(AI);AJ.push("</div></td>");if(AI%10===9){AJ.push("</tr><tr>");}}AJ.pop();AJ.push("</tr>");AJ.push(v);return AJ.join("");},isDateDisabled:function(AI,AK,AJ){return !F(AI,AK,AJ,this.min,this.max);},unrender:function D(AI){delete this.lastValue;this._super(AI);}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.num","mstrmojo.dom","mstrmojo.date","mstrmojo.Container","mstrmojo.VBox","mstrmojo.Button","mstrmojo.locales","mstrmojo._FormatDefinition","mstrmojo.mstr.EnumFunction","mstrmojo.ui.editors.controls.ComboBox","mstrmojo.vi.util.NumberFormatUtility");var M=mstrmojo.hash,c=mstrmojo.array,G=mstrmojo.num,J=mstrmojo._FormatDefinition,B=mstrmojo.css,a=mstrmojo.mstr.EnumFunction,L=mstrmojo.locales,H=mstrmojo.Button.newIconButton,O=mstrmojo.date,I=mstrmojo.vi.util.NumberFormatUtility,s="1234.12",E=J.NumberFormatCategory,q=J.FixedNegative,F=J.CurrencyNegative,f=J.PercentNegative,K=J.DefaultFormat.FormattingNumber,o="nf-MiddleRow ",X="nf-MiddleRow nf-HasWidget ",Z,U,e=function e(u,t){return{cls:this.value===u.v?"selected":"",v:u.v||"",n:u.n||"",style:u.r?"color:red;":"color:#fff;",sel:parseInt(this.idx,10)===t?"selected":""};},p={RIGHT:1,LEFT_WITH_SPACE:2,RIGHT_WITH_SPACE:3};var S=[{n:mstrmojo.desc(4531,"Automatic"),v:-3}].concat(J.Category.slice(2)),d=[{n:"$"},{n:"£"},{n:"€"},{n:"¥"},{n:"fr."}];function D(v,u){var t=c.find(v,"v",u);return t===-1?"":v[t].f;}function N(t){var v=this.parent.parent.parent.myData,u=t.v;v.set("format",D(this.items,u));v.set("negativeNumbers",u);B.toggleClass(this.selectedNode,"red",t.r);}function Y(v,w,t){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:v,onitemSelected:function u(x){var z=this.parent;while(z&&(!z.data||typeof z.data[w]==="undefined")){z=z.parent;}if(z){z.data.set(w,x.v);if(t){z.children[0].preview.preview_label.set("text",x.n);}}}};}function j(AE,z,x,AH,AD){var AG=M.clone(AE),u=z>0?L.number.DECIMALSEPARATOR:"",v=z>0?".":"",w=J.DefaultFormat.FormattingNumber,AF=new RegExp("\\"+L.number.THOUSANDSEPARATOR,"g"),t=new RegExp("\\"+L.number.DECIMALSEPARATOR+"\\d{2}","g"),AB;for(AB=0;AB<z;AB++){u+=AB%9;v+="0";}for(AB=0;AB<AG.length;AB++){var AC=AG[AB];AC.n=AC.n.replace(/,/g,"@");AC.n=AC.n.replace(/\./g,L.number.DECIMALSEPARATOR);AC.n=AC.n.replace(/@/g,L.number.THOUSANDSEPARATOR);if(x){AC.n=AC.n.replace(AF,"");AC.f=AC.f.replace(/,/g,"");}if(AH&&AH!==w.CurrencyPosition){switch(AH){case p.RIGHT:AC.n=AC.n.replace(/\$/g,"").replace(t,L.number.DECIMALSEPARATOR+"12$");AC.f=AC.f.replace(/"\$"/g,"").replace(/\.\d{2}/g,'.00"$"');break;case p.LEFT_WITH_SPACE:AC.n=AC.n.replace(/\$/g,"$ ");AC.f=AC.f.replace(/\$/g,"$ ");break;case p.RIGHT_WITH_SPACE:AC.n=AC.n.replace(/\$/g,"").replace(t,L.number.DECIMALSEPARATOR+"12 $");AC.f=AC.f.replace(/"\$"/g,"").replace(/\.\d{2}/g,'.00" $"');break;default:}}AC.n=AC.n.replace(t,u);AC.f=AC.f.replace(/\.\d{2}/g,v);if(AD&&AD!==w.CurrencySymbol){var AA=AD.replace(/\$/g,"$$$$");AC.n=AC.n.replace(/\$/g,AA);AC.f=AC.f.replace(/\$/g,AA);}AC.cls=AC.r?"red":null;}return AG;}function V(w){var t="1"+(w>0?".":"").toString(),x="0"+(w>0?".":"").toString(),u;for(u=0;u<w;u++){t+=u%10;x+="0";}return[t+"E+03",x+"E+0#"];}function R(AH,AJ){var AB="\u00A4",AF=/"[^"]*"/g,v=AH.match(AF),AK="\u0091",AG=/\[[^\]]*\]/g,t=AH.match(AG),AE,AI;AE=AH.replace(AF,AB);AE=AE.replace(AG,AK);var x=AH.indexOf("."),AD=G.getDecimalLength(AH),AA=Math.max(0,AD+AJ),w=AH.match(/\d(?!((\d)|(,\d)))/g),u=x!==-1?AH.charAt(x-1):w&&w[0],AC=(u||"0")+(AA>0?".":"").toString();for(var z=0;z<AA;z++){AC+="0";}AE=AE.replace(AD===0?/\d(?!((\d)|(,\d)))/g:/\d\.\d+/g,AC);AE=AE.split(AB);AI=AE[0];c.forEach(v,function(AM,AL){AI+=AM+AE[AL+1];});AE=AI.split(AK);AI=AE[0];c.forEach(t,function(AM,AL){AI+=AM+AE[AL+1];});return AI;}function P(AB,t,AA,z,v,u){var x=AB.parent.parent.parent,w=j(t,AA.decimalPlaces,z,v,u);AA.set("format",D(w,AA.negativeNumbers.toString()));AB.set("items",w);AB.set("selectedIndex",c.find(w,"v",AA.negativeNumbers.toString()));x.preview.preview_label.set("text",I.applyFormatToNumber(x.myData.format,s.replace(/\./g,L.number.DECIMALSEPARATOR)));}function m(){var AC=this.parent.parent,AG=AC.myData,w=AC.formatterContainer,u=S[AC.categoryPicker.selectedIndex].v,AJ=this.funcType===a.FunctionLeftStr?1:-1,z=null,AB=null,x=false,AI=0,AD=null,v=false,AF;switch(u){case E.Fixed:z=w.fixed_hBox.negativeDDL;AB=q;x=!AG.thousandSeparator;break;case E.Currency:z=w.currency_hBox2.negativeDDL;AB=F;AI=AG.currencyPosition;AD=AG.currencySymbol;break;case E.Percentage:z=w.percentage_hBox.negativeDDL;AB=f;break;case E.Scientific:v=true;break;case E.Custom:AF=true;break;default:return ;}if(AF){var AH=R(AG.format,AJ);AC.preview.preview_label.set("text",I.applyFormatToNumber(AH,s.replace(".",L.number.DECIMALSEPARATOR)));AC.formatterContainer.custom_text.set("value",AH);return ;}var AA=AG.decimalPlaces,t=AA+AJ;t=Math.max(0,t);t=Math.min(J.MaxNegativeDidigts,t);AG.set("decimalPlaces",t);if(v){var AE=V(t);AG.set("format",AE[1]);AC.preview.preview_label.set("text",AE[0]);}else{P(z,AB,AG,x,AI,AD);}}function r(t,u){return Math.max(c.find(t,"v",u),0);}function C(v){var u=this.parent.parent.categoryPicker,t=S.map(function(w){return w.v;}).indexOf(v);u.set("selectedIndex",t);}function n(t,u,w,v){return H(undefined,t,u,undefined,M.copy(v,{useRichTooltip:true,updateTooltipConfig:function(){this.richTooltip={cssClass:"vi-regular vi-tooltip-A A-center",content:w,refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPCENTER,left:15,top:33};}}));}function b(){if(mstrApp.isSingleTier&&!mstrmojo.dom.isMac()){var z=this.formatterContainer,x=L.datetime,t={day:7,month:4,year:1998},v={hour:9,min:41,sec:46},w=x&&x.DATEINPUTFORMATS,u=x&&x.TIMEINPUTFORMATS;Z=[];U=[];w.forEach(function(AA){Z.push({v:AA,n:O.formatDateInfo(t,AA)});});u.forEach(function(AA){U.push({v:AA,n:O.formatTimeInfo(v,AA)});});z.date_ddl.set("items",Z);z.time_ddl.set("items",U);}else{Z=J.Date;U=J.Time;}}mstrmojo.vi.ui.NumberFormatter=mstrmojo.declare(mstrmojo.VBox,null,{scriptClass:"mstrmojo.vi.ui.NumberFormatter",cssClass:"NumberFormatter-content",formatValue:null,myData:null,oldData:null,categoryPicker:null,formatterContainer:null,preview:null,shortcutRow:null,adjustAfterCategoryChange:mstrmojo.emptyFn,preBuildRendering:function(){if(this._super){this._super();}b.call(this);var t=this.formatterContainer;if(this.formatValue){t.currency_hBox1.currency_symbol.selectedValue=this.formatValue.currencySymbol;t.fixed_btn.checked=!!this.formatValue.thousandSeparator;B.addWidgetCssClass(t.fraction_ddl,f[c.find(f,"v",this.formatValue.negativeNumbers)].r?" red":"");}},postBuildRendering:function Q(){if(this._super){this._super();}if(this.formatValue){this.categoryPicker.set("selectedIndex",r(this.categoryPicker.items,this.formatValue.category.toString()));}},children:[M.copy({alias:"categoryPicker",cssClass:"nf-category",onitemSelected:function l(AH){if(!this.hasRendered){return ;}var AC=this,AF=AC.parent,w=AF.formatterContainer,t=AF.shortcutRow,AG=AF.preview.preview_label,AE=AH.v,z=AE===E.Automatic,v=AE===E.Scientific,u=[],AB=AF.myData;c.forEach(w.children,function(AI){AI.set("visible",false);});AF.border.set("visible",!z);AF.preview.set("visible",!z);AF.borderBottom.set("visible",!(!mstrApp.isWSStyling||z||v));["border","moveLeftBtn","moveRightBtn"].forEach(function(AI){t[AI].set("visible",!z);});AB.set("category",AE);AB.set("thousandSeparator",AE?K.ThousandSeparator:AF.formatValue.thousandSeparator);switch(AE){case E.Currency:P(w.currency_hBox2.negativeDDL,F,AB,false,AB.currencyPosition,AB.currencySymbol);w.currency_hBox1.currency_position.set("selectedIndex",r(J.CurrencyPosition,AB.currencyPosition.toString()));u=["currency_hBox1","currency_hBox2"];break;case E.Date:w.date_ddl.set("selectedIndex",r(Z,AB.format));u=["date_ddl"];break;case E.Time:w.time_ddl.set("selectedIndex",r(U,AB.format));u=["time_ddl"];break;case E.Percentage:P(w.percentage_hBox.negativeDDL,f,AB,false,0,null);u=["percentage_hBox"];break;case E.Fraction:w.fraction_ddl.set("selectedIndex",r(J.Fraction,AB.format));u=["fraction_ddl"];break;case E.Scientific:var AA=V(AB.decimalPlaces||0);AB.set("format",AA[1]);AG.set("text",AA[0]);break;case E.Custom:var x=AB.customText||AB.format,AD=w.custom_text;AB.set("format",x);AD.value=x;AD.refresh();AG.set("text",I.applyFormatToNumber(x,s.replace(".",L.number.DECIMALSEPARATOR)));u=["custom_condense","custom_text"];break;case E.Fixed:P(w.fixed_hBox.negativeDDL,q,AB,!AB.thousandSeparator,0,null);u=["fixed_hBox","fixed_btn"];break;}c.forEach(u,function(AI){w[AI].set("visible",true);});AF.adjustAfterCategoryChange();}},Y(S,"category")),{scriptClass:"mstrmojo.Box",cssClass:o+"nf-shortcut",alias:"shortcutRow",border:null,moveLeftBtn:null,moveRightBtn:null,children:[n("nf-shortcut-currency",function h(){C.call(this,E.Currency);},mstrmojo.desc(2051,"Currency"),undefined),n("nf-shortcut-percentage",function h(){C.call(this,E.Percentage);},mstrmojo.desc(2053,"Percentage"),undefined),n("nf-shortcut-fixed",function h(){C.call(this,E.Fixed);this.parent.parent.formatterContainer.fixed_btn.set("checked",true);},mstrmojo.desc(2050,"Fixed"),undefined),{scriptClass:"mstrmojo.Label",cssClass:"shortcut-border",alias:"border"},n("nf-MoveDecimalPoint left",function h(){m.call(this);},mstrmojo.desc(2189,"Increase Decimal"),{funcType:a.FunctionLeftStr,alias:"moveLeftBtn"}),n("nf-MoveDecimalPoint right",function h(){m.call(this);},mstrmojo.desc(2188,"Decrease Decimal"),{funcType:a.FunctionRightStr,alias:"moveRightBtn"})]},{scriptClass:"mstrmojo.Label",alias:"border",cssClass:"nf-border"},{scriptClass:"mstrmojo.Container",alias:"formatterContainer",cssClass:"nf-buttons",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"></div>',fixed_hBox:null,fixed_btn:null,currency_hBox1:null,currency_hBox2:null,date_ddl:null,time_ddl:null,percentage_hBox:null,fraction_ddl:null,custom_condense:null,custom_text:null,markupSlots:{containerNode:function W(){return this.domNode;}},children:[{scriptClass:"mstrmojo.HBox",alias:"fixed_hBox",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(t){N.call(this,t);}},Y([],"format"))]},{scriptClass:"mstrmojo.CheckBox",alias:"fixed_btn",cssClass:o,label:"",onclick:function h(){var t=this.parent.parent;t.myData.set("thousandSeparator",this.checked?-1:0);P(this.parent.fixed_hBox.negativeDDL,q,t.myData,!this.checked,0,null);},preBuildRendering:function A(){this.set("label",mstrmojo.desc(13898,"Use 1000 Separator(#)").replace("#",L.number.THOUSANDSEPARATOR));}},{scriptClass:"mstrmojo.HBox",alias:"currency_hBox1",cssClass:X,visible:true,currency_symbol:null,currency_position:null,children:[{scriptClass:"mstrmojo.ui.editors.controls.ComboBox",alias:"currency_symbol",cssClass:"nf-CurrencySymbol",selectedValue:"$",items:d,postselectedValueChange:function k(t){var x=this,w=x.parent.parent.parent,v=t.value,u=w.myData;u.set("currencySymbol",v);P(this.parent.parent.currency_hBox2.negativeDDL,F,u,false,parseInt(u.currencyPosition,10),v);}},M.copy({cssClass:"nf-CurrencyPosition align-right",alias:"currency_position",onitemSelected:function l(t){var w=this,v=w.parent.parent.parent,u=t.v;v.myData.set("currencyPosition",parseInt(u,10));P(this.parent.parent.currency_hBox2.negativeDDL,F,v.myData,false,parseInt(u,10),v.myData.currencySymbol);}},Y(J.CurrencyPosition,"currencyPosition"))]},{scriptClass:"mstrmojo.HBox",alias:"currency_hBox2",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(t){N.call(this,t);}},Y([],"format"))]},M.copy({alias:"date_ddl",cssClass:X},Y(J.Date,"format",true)),M.copy({alias:"time_ddl",cssClass:X},Y(J.Time,"format",true)),{scriptClass:"mstrmojo.HBox",alias:"percentage_hBox",cssClass:X,negativeDDL:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"negative-label",text:mstrmojo.desc(13891,"Negative:")},M.copy({alias:"negativeDDL",cssClass:"nf-NegativePullDown",getOptionProps:e,onitemSelected:function l(t){N.call(this,t);}},Y([],"format"))]},M.copy({alias:"fraction_ddl",cssClass:X},Y(J.Fraction,"format",true)),mstrmojo.Button.newWebButton(mstrmojo.desc(13893,"Condense (e.g.10M)"),function(){this.parent.custom_text.set("value",'[>=1000000]#,##0,,"M";[>=1000]#,##0,"K";0;[<=-1000000]#,##0,,"M";[<=-1000]#,##0,"K"');},false,{cssClass:"nf-condense",alias:"custom_condense"}),{scriptClass:"mstrmojo.TextBox",alias:"custom_text",cssClass:"nf-custom",onvalueChange:function g(){var v=this,u=v.parent.parent,t=v.value;u.myData.set("format",t);u.myData.set("customText",t);v.parent.parent.preview.preview_label.set("text",I.applyFormatToNumber(t,s.replace(".",L.number.DECIMALSEPARATOR)).replace(/\s/g,"&nbsp;"));}}]},{scriptClass:"mstrmojo.Label",alias:"borderBottom",cssClass:"nf-border"},{scriptClass:"mstrmojo.HBox",alias:"preview",cssClass:o+"nf-PreviewRow",preview_label:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"preview_lable",text:mstrmojo.desc(13892,"Preview:")},{scriptClass:"mstrmojo.Label",cssClass:"align-right preview-info-label",alias:"preview_label"}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.fx","mstrmojo.Box","mstrmojo.Editor","mstrmojo.Button","mstrmojo._FormatDefinition","mstrmojo.TabListContainer","mstrmojo.TabNameList","mstrmojo.StackContainer","mstrmojo.FontFormatter","mstrmojo.NumberFormatter","mstrmojo.AlignmentFormatter","mstrmojo.PaddingFormatter","mstrmojo.FillFormatter","mstrmojo.BorderFormatter");var C=mstrmojo.array,M=mstrmojo.hash,F=mstrmojo._FormatDefinition,B=mstrmojo.Button,L=F.MetricFormatTarget;var G="#999",E="mstrmojo-Editor-button mstrButton",H=M.clone(F.DefaultFormat);H.FormattingPatternsChart={FillColor:"16777215",FillStyle:"0",GradientColor:"16777215",GradientAngle:"0",GradientXOffset:"0",GradientYOffset:"0"};H.FormattingPatterns=M.clone(H.FormattingPatternsChart);var I={n:mstrmojo.desc(3434,"Number"),scriptClass:"mstrmojo.NumberFormatter",visible:false,pr:"FormattingNumber"},K={n:mstrmojo.desc(3435),scriptClass:"mstrmojo.Box",visible:false,pr:["FormattingAlignment","FormattingPadding"],cssClass:"alignmentPanel",children:[{scriptClass:"mstrmojo.AlignmentFormatter",bindings:{model:"this.parent.FormattingAlignment"}},{scriptClass:"mstrmojo.PaddingFormatter",bindings:{model:"this.parent.FormattingPadding"}}]},N={n:mstrmojo.desc(3433,"Font"),scriptClass:"mstrmojo.FontFormatter",visible:false,pr:"FormattingFont",cssClass:"mstrmojo-FormatEditor-fontTable",cellPadding:5},D={n:mstrmojo.desc(2886,"Borders"),scriptClass:"mstrmojo.BorderFormatter",visible:false,pr:"FormattingBorder"},A={n:mstrmojo.desc(3905,"Background"),scriptClass:"mstrmojo.FillFormatter",visible:false,pr:"FormattingPatterns"},J={n:mstrmojo.desc(3479,"Graph"),scriptClass:"mstrmojo.FillFormatter",visible:false,isChart:true,pr:"FormattingPatternsChart"};mstrmojo.ME.MetricFormatEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.MetricFormatEditor",cssClass:"mstrmojo-FormatEditor",title:mstrmojo.desc(2116,"Format"),model:null,obModel:null,_initModel:function(){if(!this.model){this.model={};for(var O=0;O<L.length;O++){this.model[L[O].p]={};}}if(!this.obModel){this.obModel=new mstrmojo.Model({onlevelNameChange:function(P){var Q=P.valueWas;if(Q){this._updateModel(Q);}this._setCurrentFormat();},onmodelChange:function(){return this.model?this._setCurrentFormat():false;},_updateModel:function(Q){var R=M.copy(this.currentFormat),Q=Q||this.levelName,P=this.model[Q];if(!P){P=this.model[Q]={};}F.extractModel(R,P,H);this.model.set(Q,P);},_setCurrentFormat:function(){var P=this.model?M.copy(this.model[this.levelName||L[0].p]):{};P=F.getStandardFormat(P,H);this.set("currentFormat",P);}});}},init:function(O){this._initModel();this._super(O);},onmodelChange:function(){this._initModel();var Q=this.obModel,O=M.clone(this.model)||{};if(O){var P={};if(O&&O[L[0].p]){var R=O[L[0].p].FormattingPatterns;if(R){for(pr in R){if(pr.match(/^Series\w+/gi)){P[pr.substring(6,pr.length)]=R[pr];}}}O[L[0].p].FormattingPatternsChart=P;}}if(O&&!O.attachEventListener){M.make(O,mstrmojo.Obj);}Q.set("model",O);Q.set("levelName",Q.levelName||L[0].p);},promptOnClearFormatRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:"",showTitle:false,children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",bindings:{text:function(){return mstrmojo.desc(9564,"Clear all formatting?");}}},{scriptClass:"mstrmojo.HBox",cssText:"float:right; margin-bottom:5px;",alias:"buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"Ok"),onclick:function(){var O=this.parent.parent;O.opener.onClearFormat();O.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var O=this.parent.parent;O.close();}}]}]},prompt2ClearFormat:function(){this.openPopup("promptOnClearFormatRef",{zIndex:this.zIndex+1});},onClearFormat:function(){var P=this.obModel;for(var O=0;O<L.length;O++){delete P.model[L[O].p];}P._setCurrentFormat();},onOK:function(){var Q=this.obModel;Q._updateModel();var R=Q.model[L[0].p];if(R){var P=R.FormattingPatterns,O=R.FormattingPatternsChart;if(O){for(pr in H.FormattingPatternsChart){if(O[pr]!=null){P["Series"+pr]=O[pr];}}delete O;}}var S=mstrmojo.hash.clone(this.model);F.saveFormatModel(Q.model,this.model,[L[0].p,L[1].p],F.DefaultFormat);this.model.dirty=!mstrmojo.hash.equals(S,this.model);},children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.HBox",alias:"btns",children:[{scriptClass:"mstrmojo.Pulldown",alias:"which",items:L,itemIdField:"v",bindings:{value:function(){var O=C.find(this.items,"p",this.parent.parent.parent.obModel.levelName);return this.items[O!=-1?O:0][this.itemIdField];}},cssClass:" mstrmojo-FormatEditor-DropDownButton",popupZIndex:100,value:L[0].v,onvalueChange:function(){var R=this.parent.parent.parent,P=this.parent.parent.formatPanels,S=P&&P.stck,Q=this.selectedItem;if(R&&R.obModel&&S){R.obModel.set("levelName",Q?Q.p:L[0].p);var O=C.find(S.children,"pr",J.pr);if(Q==null||Q.p==L[0].p){if(O==-1){S.addChildren(J);S.onchildRenderingChange(J);}}else{S.removeChildren(S.children[O]||[]);}}}},new B.newInteractiveButton(mstrmojo.desc(5976),function(O){var P=this.parent.parent.parent;P.prompt2ClearFormat();},G,{alias:"btnClear",cssClass:E+" clear"})]},{scriptClass:"mstrmojo.TabListContainer",alias:"formatPanels",listCssClass:"mstrmojo-FormatEditor-leftPanel",bindings:{currentModel:"this.parent.parent.obModel.currentFormat"},oncurrentModelChange:function(){this.parent.btns.which.onvalueChange();var O=this.lst;if(O.selectedIndex==0){O.onchange();}else{O.set("selectedIndex",0);}},children:[{scriptClass:"mstrmojo.TabNameList",alias:"lst",slot:"top",cssClass:"mstrmojo-FormatEditor-formatList",itemMarkup:'<div class="mstrmojo-FormatEditor-bullet"><div class="mstrmojo-text">{@n}</div></div>',onchange:function(){var R=this.parent,S=this.selectedIndex;if(R.stck&&S!=null&&S!=-1){var Q=this.items[S],O=Q&&Q.target;var U=O&&O.pr;if(U){if(U.constructor===Array){for(var P=0;P<U.length;P++){O.set(U[P],R.currentModel[U[P]]);}}else{O.set("model",R.currentModel[U]);}}}}},{scriptClass:"mstrmojo.StackContainer",cssClass:"mstrmojo-FormatEditor-rightPanel-container mstrmojo-FormatEditor-rightPanel",alias:"stck",slot:"stack",children:[I,K,N,D,A,J]}]}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",children:[new B.newInteractiveButton(mstrmojo.desc(2397),function(){var O=this.parent.parent;O.close();O.onOK&&O.onOK();},G,{alias:"btnOk",cssClass:E}),new B.newInteractiveButton(mstrmojo.desc(2399),function(){var O=this.parent.parent;O.close();},G,{alias:"btnCancel",cssClass:E})]}]});})();(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.rw.xtab.XtabMenuConfig","mstrmojo.dom","mstrmojo.hash");var G=mstrmojo.dom;function B(I,H){if(H){H.opener=this;}this.openPopup(I,H);}mstrmojo.express.ui._IsDocumentView=mstrmojo.provide("mstrmojo.express.ui._IsDocumentView",mstrmojo.hash.copy(mstrmojo._HasPopup,{_mixinName:"mstrmojo.express.ui._IsDocumentView",openXtabCellMenu:function A(H){var I=this.getXtabCellMenuConfig({isHostedWithin:false,position:H.cmPos||G.position(H.btn.domNode),hostId:this.id});I.buildXtabMenuConfig(H);if(I.hasMenuItems()){B.call(this,I.newInstance(),H);}},openXtabCellMenuWithSelectionStyleControl:function D(H){var J=null,I=this.getXtabCellMenuConfig({isHostedWithin:false,position:H.cmPos||G.position(H.btn.domNode),hostId:this.id});I.buildXtabMenuConfig(H);if(I.hasMenuItems()){J=I.newInstance();B.call(this,J,H);}return J;},getXtabCellMenuConfig:function(H){return new mstrmojo.rw.xtab.XtabMenuConfig(H);},drillLinkMenuRef:"mstrmojo.DrillLinkMenu",openDrillLinkMenu:function E(H){B.call(this,"drillLinkMenuRef",H);},goToLink:function C(H){if(H){mstrmojo.form.sendLink(H.url,H.target||"_self");}},openPopupMenu:function F(I,H){B.call(this,I,H);}}));}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._ValidateSuggestions","mstrmojo.WidgetList","mstrmojo.Editor","mstrmojo.LegacySuggestionList");mstrmojo.Enum_OIB_States=mstrmojo.hash.copy(mstrmojo._ValidateSuggestions.ENUM_STATES,{EDITING:2,ADDING:3,EMPTY:4});mstrmojo.Enum_OIB_States_CSS=(function(){var AF=mstrmojo.Enum_OIB_States,AE={},AG;for(AG in AF){if(AF.hasOwnProperty(AG)){AE[String(AF[AG])]=AG;}}return AE;}());var Q=mstrmojo.dom,S=mstrmojo.hash,b=mstrmojo.Enum_OIB_States,I=0,d="_did_",AA=mstrmojo.Enum_Keys,AC=80,V=200;function Y(){return(mstrApp&&mstrApp.searchAutoCompleteDelay&&mstrApp.searchAutoCompleteDelay())?mstrApp.searchAutoCompleteDelay():V;}function P(){return I++;}function j(AE){return(AE&&AE.state===b.ADDING);}function r(AE){var AF={n:AE||"",state:b.EMPTY};AF[d]=-2;return AF;}function O(AE){return(AE&&AE.state===b.EMPTY);}function v(AF){var AG=AF.items,AE=AG&&AG.length;if(!AE){return true;}return(AE===1&&j(AG[0]))||(AE===2&&O(AG[0])&&j(AG[1]));}function n(){var AF=this.ctxtBuilder.itemWidgets,AE=AF[AF.length-1];if(AE&&AE.isAdding){var AG=this;Q.attachEvent(AE.domNode,"click",function(){AG.editingIdx=null;});return AE;}return null;}function L(){var AE=this.editingIdx;if(AE!==null){return this.ctxtBuilder.itemWidgets[AE];}return n.call(this);}function D(){this.isActive=false;var AF=this.emptyText||"",AG=this.items;if(v(this)&&!O(AG[0])&&(AF.length>0)){this.add([r(AF)],0);var AH=this.ctxtBuilder.itemWidgets[0];AH.set("shouldEllipsize",true);AH.doEllipsize();}var AE=L.call(this);if(AE){if(j(AE)&&this.showEmptyItem){AE.domNode.style.visibility="hidden";}AE.blur();}Q.detachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.detachEvent(AE.inputNode,"keydown",this._tabKeyHander);}}function N(){if(!this.enabled){return ;}this.isActive=true;if(O(this.items[0])){this.remove(0);}var AE=L.call(this);if(AE){if(j(AE)&&!this.isFull){AE.domNode.style.display="block";AE.domNode.style.visibility="visible";}this.scrollTo(AE.data);AE.focus();}Q.attachEvent(document.body,"mousedown",this._mousedownHandler);if(this.tabNavigable){Q.attachEvent(AE.inputNode,"keydown",this._tabKeyHander);}}mstrmojo.ObjectInputBox=mstrmojo.declare(mstrmojo.WidgetList,[mstrmojo._ValidateSuggestions],{scriptClass:"mstrmojo.ObjectInputBox",cssClass:"mstrmojo-ObjectInputBox",emptyText:"",showEmptyItem:true,items:null,itemField:"n",dynamicVerify:true,suggestCount:10,candidates:null,makeObservable:true,renderOnScroll:false,editingIdx:null,isActive:false,maxObjectCount:null,isFull:false,suggestionListClass:"mstrmojo.LegacySuggestionList",acptSugItemOnly:false,useKeyDelay:false,showSuggestionOnEdit:true,tabNavigable:false,getSearchPattern:function(){var AE=L.call(this);if(AE){return AE.getSearchPattern();}return"";},getSuggestionTarget:function o(){return this.suggestTarget;},onsuggestTargetChanged:function q(AE){this._request_pattern=null;},getSuggestionPos:function e(){return this._pop_cfg;},onSuggestionItemSelect:function w(AE){if(this.suggestTarget){this.suggestTarget.setItem(AE[this.itemField],AE,false);}this.hideSuggestion();this.closePopup();},hideEditButton:function(AE){return !!this.noEditButton;},_set_items:function m(AJ,AG){AG=mstrmojo.hash.clone(AG)||[];var AI=this.maxObjectCount;this.set("isFull",(AI&&AG.length>=AI));if(AG.length===0){var AF=this.emptyText||"";if(AF.length>0){AG.push(r(AF));}}var AH={n:"",state:b.ADDING};AH[d]=-1;AG.push(AH);var AE=AG[AG.length-1];if(AE&&j(AE)&&this.maxObjectCount&&(this.getSelectedObjects().length>=this.maxObjectCount)){this.set("isFull",true);}this.itemIdField=d;return this._super(AJ,AG);},add:function E(AF,AE){var AG=n.call(this);if(!this.maxObjectCount||this.getSelectedObjects().length<this.maxObjectCount){this._super(AF,AE);}if(!v(this)&&O(this.items[0])){this.remove(0);}if(AG){AG.adjustInputWidth();if(this.maxObjectCount&&(this.getSelectedObjects().length===this.maxObjectCount)){this.set("isFull",true);AG.domNode.style.display="none";}else{AG.domNode.style.display=this.showEmptyItem?"none":"";}}},remove:function c(AE){this._super(AE);var AF=n.call(this);if(AF){if(this.maxObjectCount&&(this.getSelectedObjects().length<this.maxObjectCount)){this.set("isFull",false);}AF.adjustInputWidth();}},preBuildRendering:function(){if(this.items==null||this.items.length==0){this.set("items",[]);}if(this._super){this._super();}},postBuildRendering:function a(){this._super();var AF=this,AE=n.call(AF);if(AE&&(this.showEmptyItem||this.isFull)){AE.domNode.style.display="none";}this._clickHandler=function(){N.call(AF);};this._mousedownHandler=function(AG){if(!AF.isActive||AF.browserShown){return ;}var AH=Q.eventTarget(self,AG);if(AH&&AH.parentNode&&!Q.contains(L.call(AF).domNode,AH,false,document.body)&&!Q.contains(AF.suggestionPopup.domNode,AH,false,document.body)){D.call(AF);}};if(this.tabNavigable){this._tabKeyHander=function(AG){var AH=parseInt(AG.keyCode||AG.charCode,10);if(AH===AA.TAB){if(!AF.isActive||AF.browserShown){return ;}D.call(AF);}};}Q.attachEvent(this.domNode,"click",this._clickHandler);},nextId:P,item2textCss:function M(AE){return AE.cssClass||"";},itemFunction:function G(AG,AE,AF){AG[AF.itemIdField]=P();var AH=new mstrmojo.ObjectItem({parent:AF,itemField:AF.itemField,cssClass:AF.item2textCss(AG),data:AG,showSuggestionOnEdit:this.showSuggestionOnEdit,enabled:AF.enabled});AF.attachEventListener4ItemWidget(AH,AF);return AH;},attachEventListener4ItemWidget:function k(AI,AG){var AF=["ItemEditBegin","ItemEditEnd","ItemDeletePrev","ItemDelete","ItemAdd","SuggestionOn","SuggestionOff","ItemEditing"],AE=AF.length,AH;for(AH=0;AH<AE;AH++){AI.attachEventListener(AF[AH],AG.id,"_itemChangeHandler");}return AI;},getSelectedObjects:function l(){if(v(this)){return[];}var AE=this.items,AF=AE.length-1;if((AF>-1)&&j(AE[AF])){return AE.slice(0,AF);}return AE.concat();},isValid:function C(){var AF=this.ctxtBuilder.itemWidgets,AE=AF&&AF.length,AG;for(AG=0;AG<AE;AG++){if(!AF[AG].isValid()){return false;}}return true;},isEmpty:function W(){return v(this);},_itemChangeHandler:function(AH){var AJ=AH.name,AK=AH.d,AF,AE=this.items.length,AG;switch(AJ){case"ItemEditBegin":if(this.editingIdx!==null){AG=L.call(this);if(AG){AG.blur();}}AF=this.itemIndex(AK);this.editingIdx=AF;N.call(this);break;case"ItemEditEnd":this.editingIdx=null;if(AH.deactivate){D.call(this);}else{N.call(this);}AG=n.call(this);if(AG){AG.adjustInputWidth();}break;case"ItemDelete":if(this.editingIdx!==null){AG=L.call(this);if(AG){AG.blur();}this.editingIdx=null;}AF=this.itemIndex(AK);this.remove(AF);if(!AH.deactivate){this.editingIdx=null;N.call(this);}else{if(!this.isActive){D.call(this);}else{N.call(this);}}break;case"ItemDeletePrev":if(AE>1){this.remove(AE-2);}break;case"ItemAdd":var AI=S.copy(AH.d);this.add([AI],AE-1);if(AH.deactivate){D.call(this);}else{N.call(this);}break;case"SuggestionOn":this.set("suggestTarget",AH.target);this._pop_cfg={target:AH.target,left:AH.l,top:AH.t,zIndex:this.zIndex?this.zIndex:100};this.showSuggestion(AH.pattern);break;case"SuggestionOff":this.set("suggestTarget",null);this.hideSuggestion();break;}if(this.onitemchange&&(AJ==="ItemEditEnd"||AJ==="ItemAdd"||AJ==="ItemDelete"||AJ==="ItemDeletePrev"||AJ==="ItemEditing")){this.onitemchange();}},unrender:function B(AF){var AE=this.suggestionPopup;if(AE.hasRendered){AE.unrender(false);}if(this._super){this._super(AF);}},destroy:function u(AF){var AE=this.suggestionPopup;if(AE&&AE.hasRendered){AE.destroy(false);}if(this._super){this._super(AF);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.ObjectInputBox,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasEllipsis");var s="mstrmojo-ObjectItem-text";mstrmojo.ObjectItem=mstrmojo.declare(mstrmojo.Widget,[mstrmojo._HasEllipsis],{scriptClass:"mstrmojo.ObjectItem",markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode"><span title=" {@en@title}" class="'+s+' {@cssClass}"></span><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])"/></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" mstrAttach:keyup,keydown/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},editButtonNode:function(){return this.domNode.firstChild.childNodes[1];},delButonNode:function(){return this.domNode.firstChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},markupMethods:{oncssClassChange:function(){this.textNode.className=s+" "+this.cssClass;},onstateChange:function(){var AG=this.state,AF=mstrmojo.Enum_OIB_States_CSS[AG],AE=this.domNode;if(AG===b.EMPTY){AE.innerHTML=this.enabled?'<div class="mstrmojo-ObjectItem-emptyText">'+this.text+"</div>":"";}else{if(AG===b.EDITING){this.reduceWidth();}}AE.className="mstrmojo-ObjectItem "+AF;this.updateButtonsVisibility(this.data);},ontextChange:function(){this.inputNode.value=this.text;this.textNode.innerHTML=mstrmojo.string.encodeHtmlString(this.text);}},reduceWidth:function(){var AE=Math.round(this.displayNode.clientWidth);this.editNode.style.width=AE-4+"px";this.inputNode.style.width=AE-9+"px";},updateButtonsVisibility:function AD(){if(this.parent.hideEditButton(this.data)){this.editButtonNode.style.display="none";}},state:b.VALID,onstateChange:function g(AE){this.data.state=this.state;},ontextChange:function H(AE){this.data[this.itemField]=this.text;},onfocus:function x(){N.call(this.parent);},updateData:function F(AE){S.copy(AE,this.data);this.set("state",b.VALID);this.set("text",this.data[this.itemField]);this.set("cssClass",this.parent.item2textCss(this.data));},init:function z(AF){this._super(AF);var AH=this.data,AE=AH.state,AG=this.parent;AE=this.initState();this.cssClass=AG.item2textCss(AH);this.text=AH[this.itemField];this.state=AE;this.isAdding=j(AH);this.useRichTooltip=true;this.title=this.text;},initState:function K(){var AF=this.parent,AG=this.data,AE=AG.state;if(AG&&AG.did){AG.state=b.VALID;return AG.state;}if(typeof AE==="undefined"){AE=AF.dynamicVerify?AF.verifyObject(AG[this.itemField],this):b.UNDETERMINED;AG.state=AE;}return AE;},isValid:function C(){var AE=parseInt(this.state,10);return(AE!==b.INVALID&&AE!==b.UNDETERMINED);},adjustInputWidth:function A(){if(this.isAdding){var AH=this.inputNode.style;AH.width=AC+"px";var AG=this.domNode.parentNode,AE=AG.parentNode.offsetWidth,AF=Math.max(AE-AG.offsetLeft-20,AC);if(!isNaN(AF)){AH.width=AF+"px";}}},blur:function U(){this.hideSuggestion();if(!this.isActive){return ;}this.isActive=false;var AG=this.inputNode,AE=AG.value,AF=this.parent;window.setTimeout(function(){try{AG.blur();}catch(AH){}},0);if(!AE){return ;}if(AF.acptSugItemOnly&&this._tWas_){this.set("text",AE);this.set("text","");this._tWas_=null;return ;}this.setItem(AE,null,true);},focus:function t(){var AF=this.inputNode,AE=this.isActive;window.setTimeout(function(){try{AF.focus();if(AF.createTextRange&&!AE){var AH=AF.createTextRange(),AG=AF.value.length;AH.move("character",AG);AH.select();}else{if(AF.setSelectionRange&&!AE){var AG=AF.value.length;AF.setSelectionRange(AG,AG);}}}catch(AI){}},0);this.isActive=true;},prekeydown:function J(AE){var AG=this.inputNode.value,AF=parseInt(AE.e.keyCode||AE.e.charCode,10),AI=this.parent;if(!AG){return ;}if(AF===AA.TAB||AF===AA.ENTER){if(AF===AA.ENTER){Q.preventDefault(AE.hWin,AE.e);}var AH=AI.getSelected();if(AH&&AH.did){AI.handleSuggestionItemSelect(AH);}else{this.hideSuggestion();if(!AI.acptSugItemOnly){this.setItem(AG,null,false);}else{this.set("text",AG);this.set("text","");}}}else{if(AF===AA.DOWN_ARROW){if(!AI.noCache&&!AI.suggestionShown){this.showSuggestion(AG);AI.preHighlight();}AI.nextHighlight();}else{if(AF===AA.UP_ARROW){AI.preHighlight();}}}},prekeyup:function AB(AE){var AG=this.inputNode.value,AF=parseInt(AE.e.keyCode||AE.e.charCode,10),AJ=this.isAdding,AI=this.parent;if(!AG){if(AJ){if(AF===AA.BACKSPACE&&!this._tWas_){this.raiseEvent({name:"ItemDeletePrev"});Q.preventDefault(AE.hWin,AE.e);}this._tWas_=null;}else{this.raiseEvent({name:"ItemDelete",d:this.data});}this.hideSuggestion();return ;}if(AF===AA.ESCAPE||AF===AA.TAB){this.hideSuggestion();if(AI.acptSugItemOnly){this.set("text",AG);this.set("text","");this._tWas_=null;return ;}}else{if(this._tWas_!==AG){this.textChanged=true;this.raiseEvent({name:"ItemEditing",d:this.data});if(AI.useKeyDelay){window.clearTimeout(this._timerID);var AH=this;this._timerID=window.setTimeout(function(){var AK=AH.inputNode.value;if(AK){AH.showSuggestion(AK);}AH._timerID=null;},Y());}else{this.showSuggestion(AG);}}}this._tWas_=AG;},setItem:function(AE,AG,AF){var AH=this.isAdding;AF=AF||false;this.set("text",AE);if(AH){this.setItem_Adding(AE,AG,AF);}else{this.setItem_Editing(AE,AG,AF);}this._tWas_=null;},setItem_Adding:function(AE,AG,AF){this.set("text","");if(!AG){AG={};AG[this.itemField]=AE;}else{AG.state=b.VALID;}this.raiseEvent({name:"ItemAdd",d:AG,deactivate:AF});},setItem_Editing:function(AE,AG,AF){var AH=this.parent;this.set("text",AE);if(AG){this.updateData(AG);}else{if(this.textChanged){var AI={};AI[d]=this.data[d];delete this.data.did;this.data=AI;this.textChanged=false;}this.set("state",AH.verifyObject(AE,this));this.set("cssClass",AH.item2textCss(this.data));}this.isActive=false;this.raiseEvent({name:"ItemEditEnd",d:AG,deactivate:AF});},getSearchPattern:function X(){return(this.inputNode?this.inputNode.value:"");},showSuggestion:function p(AE){var AF=mstrmojo.dom.position(this.domNode,true);this.raiseEvent({name:"SuggestionOn",l:Math.round(AF.x)+"px",t:Math.round(AF.y+AF.h)+"px",pattern:AE,target:this});},hideSuggestion:function h(){this.raiseEvent({name:"SuggestionOff"});},del:function R(AE){AE=AE||self.event;Q.stopPropogation(self,AE);this.raiseEvent({name:"ItemDelete",d:this.data,deactivate:true});if(this.useRichTooltip&&this.hideTooltip){this.hideTooltip();}},edit:function Z(){this.set("state",b.EDITING);this.raiseEvent({name:"ItemEditBegin",d:this.data});if(this.showSuggestionOnEdit){this.showSuggestion(this.text);}},doEllipsize:function f(){if(!this.shouldEllipsize){return ;}var AF=this.maxItemWidth,AE;if(AF){this.domNode.style.maxWidth=AF;switch(parseInt(this.state,10)){case b.VALID:case b.UNDETERMINED:case b.INVALID:AE=this.textNode;break;case b.EMPTY:AE=this.domNode.firstChild;break;}if(AE){this.set("richTooltip",{content:this.text,contentNodeCssClass:"sp-tooltip",posType:mstrmojo.tooltip.POS_TOPLEFT,left:0,top:30,refNode:this.domNode});mstrmojo.css.addClass(AE,"truncated");}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.ui.SearchBox","mstrmojo._HasSuggestion","mstrmojo.vi.ui.editors.nlp.RichSuggestionList");var I=mstrmojo.css,E=mstrmojo.dom,K=mstrmojo.string,D="clear";function F(){this.searchTriggered(this.inputNode.value);}mstrmojo.vi.ui.editors.nlp.SearchBoxWithSuggestion=mstrmojo.declare(mstrmojo.ui.SearchBox,[mstrmojo._HasSuggestion],{scriptClass:"mstrmojo.vi.ui.editors.nlp.SearchBoxWithSuggestion",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><div class="pre-icon"></div><input class="mstrmojo-ui-sb-input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" mstrAttach:keydown,keyup,blur,focus/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',markupSlots:{inputNode:function J(){return this.domNode.children[1];},searchNode:function C(){return this.domNode.lastChild;}},layoutConfig:{h:{inputNode:"43px",searchNode:"20px"},w:{inputNode:"100%",searchNode:"0px"},xt:true},cssClass:"searchBoxWithSuggest",suggestionListClass:"mstrmojo.vi.ui.editors.nlp.RichSuggestionList",onkeydown:function H(P){var O=P.hWin,R=P.e||O.event;if(R.keyCode===9||R.keyCode===13){var Q=this.getSelected();if(Q){this.preventSearch=true;this.onSuggestionItemSelect(Q);}else{this.preventSearch=false;}P.preventDefault();}else{if(R.keyCode===40){this.nextHighlight(true);}else{if(R.keyCode===38){this.preHighlight(true);}}}},pattern:"",getSearchPattern:function(){return this.pattern;},onkeyup:function B(Q){var P=Q.hWin,V=Q.e||P.event;if(V.keyCode===27){if(this.inputNode.value==""){this.hideSuggestion();this.raiseEvent({name:"quitWatermelon"});}this.clearSearch(true);return ;}if(V.keyCode===13&&!this.preventSearch){F.call(this);return ;}var S=this,O=this.text,W=this.text=this.inputNode.value,R=this._hasText=W.length>0;var U=(W||"").split(" ").reverse();if(O!==W){I.toggleClass(this.searchNode,[D],R);window.clearTimeout(this._searchTimeoutId);this._searchTimeoutId=window.setTimeout(function(){var X=1;var Z=[U[0]];for(var Y=1;Y<U.length;Y++){Z.splice(0,0,U[Y]);var a=S.getSuggestion(Z.join(" "));if(a.length>0){X+=1;}else{Z.splice(0,1);break;}}S.pattern=Z.join(" ");S.tokenToSearchCnt=X;S.showSuggestion(S.pattern);},this.searchDelay);}},onclick:function N(O){var P=O.getTarget();if(P===this.searchNode){if(this._hasText){this.clearSearch(true);}else{F.call(this);}}},searchTriggered:function L(O){this.pattern="";},getSuggestionPos:function M(){var O=E.position(this.inputNode,true);return{left:Math.round(O.x-41)+"px",top:Math.round(O.y+O.h+4)+"px",zIndex:102};},onSuggestionItemSelect:function A(P){var O="\u200C";var Q=(this.inputNode.value||"").split(" ").reverse();Q.splice(0,this.tokenToSearchCnt);Q=Q.reverse();var R=P.type==="sample-question";if(R){Q.push(P[this.itemField]);}else{Q.push(O+P[this.itemField]+O);}this.text=this.inputNode.value=Q.join(" ");this.pattern="";this.tokenToSearchCnt=0;this.hideSuggestion();this.inputNode.focus();},postApplyProperties:function G(){var P=mstrmojo.hash.clone(this.suggestionPopup);P.cssClass="mstrmojo-ObjectInputBox-suggest nlpSuggestionPopUp";P.children=[{scriptClass:this.suggestionListClass,alias:"list",cssClass:"mstrmojo-suggest-list in-searchbox",updateTooltipConfig:function(){var R=mstrmojo.dom.position(this.domNode),Q=this.richTooltip;Q.cssClass="vi-regular vi-tooltip-C";Q.posType=mstrmojo.tooltip.POS_TOPLEFT;Q.left+=R.x;Q.top-=40;},getTooltipText:function O(Q){return Q&&K.encodeHtmlString(Q.n||"");}}];this.suggestionPopup=P;},updateSuggestionPos:function(){if(this.suggestionShown){var O=this;setTimeout(function(){var P=O._lastOpened,Q=O.getSuggestionPos();P.set("left",Q.left);P.set("top",Q.top);},0);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.CheckList","mstrmojo.ui.SearchBox","mstrmojo.string","mstrmojo.css","mstrmojo.hash","mstrmojo.dom");var B=mstrmojo.string,Y=mstrmojo.css,O=mstrmojo.hash,E=mstrmojo.dom,R=mstrmojo.tooltip,P="\u001E",F="\u001F";function K(a,d){var c=a.n;if(!d){return c;}var b=new RegExp(B.regEscape(d),"ig");if(c!==undefined&&b.test(c)){return c.replace(b,function(e){return P+e+F;});}return undefined;}function M(){return this.orientation==="v"?this.width:"135px";}function G(){return function(a){if(this._super){this._super(a);}var b=this.searchInput;if(b){b.set("width",M.call(this));}};}mstrmojo.vi.ui.rw.selectors.SearchableCheckList=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.CheckList,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.SearchableCheckList",init:function Q(a){this._super(a);Y.addWidgetCssClass(this,"searchable");},searchInput:null,_set_items:function N(b,c){this._super(b,c);var a=this.searchInput;if(a){a.set("visible",c.length>15);}},buildRendering:function I(){if(this.isHoriz&&this.itemWidthMode===0){this.renderOnScroll=false;}this._super();var c=document.createElement("div"),e=c.appendChild(document.createElement("div")),d=this.scrollboxNode,b=this.items,f=this.id;c.className="search";this.domNode.insertBefore(c,d);var a=this.searchInput;if(!a){a=this.searchInput=new mstrmojo.ui.SearchBox({width:M.call(this),searchTriggered:function(h){var g=mstrmojo.all[f];g.filterItems(h);g.hideTooltip();}});this.addDisposable(a);}a.visible=b&&b.length>15;a.placeholder=e;a.render();},preBuildRendering:function C(){var a=this._super();if(this.idx2ridx){delete this.idx2ridx;}return a;},onorientationChange:G(),onwidthChange:G(),updateScrollbars:function Z(){var a=this.scrollboxNode;if(this.hasRendered&&this.orientation==="v"){a.style.height=this.getScrollboxHeight()+"px";}this._super();},getScrollboxHeight:function L(){var a=this.searchInput,b=E.position(a.domNode);if(a.visible){return parseInt(this.height,10)-b.h-8;}return parseInt(this.height,10);},unrender:function V(b){var a=this.searchInput;if(a){a.unrender(b);}return this._super(b);},getItemProps:function W(b,a){var c=this._super(b,a);c.html=B.encodeHtmlString(c.n).replace(new RegExp(P,"ig"),"<em>").replace(new RegExp(F,"ig"),"</em>");return c;},getItemMarkup:function J(b,a){return this._super(b,a).replace("@en@n","@html");},_getItemNode:function H(a){var b;if(O.isEmpty(this.idx2ridx)){b=a;}else{if(this.idx2ridx[a]!==undefined){b=this.idx2ridx[a];}else{return null;}}return this._super(b);},updateTooltipConfig:function U(k,f){var h=k.target||E.eventTarget(k.hWin,k.e),a="vi-tooltip-C",j=R.POS_TOPLEFT;var d=h.parentElement||h,g=d.children[1],e=E.position(d);var b=e.w,c=E.windowDim().w;if(c<(e.x+b+300)){a="vi-tooltip-D";b=-10;j=R.POS_TOPRIGHT;}this.richTooltip={content:this.getTooltipContent(k),cssClass:"vi-regular "+a,top:-4,left:b,refNode:g||d,posType:j};},filterItems:function S(){var a=[];this.renderIndex=0;this.itemsContainerNode.innerHTML="";this.idx2ridx={};this.updateRenderableItems();this.renderableItems.forEach(function(c,b){a.push(this.itemRenderer.render(c,c._renderIdx,this));this.idx2ridx[c._renderIdx]=b;},this);this.itemsContainerNode.innerHTML=a.join("");this.updateScrollbars();},updateRenderableItems:function D(){var f=this.itemsContainerNode.lastChild,d=f&&parseInt(f.getAttribute("idx"),10)+1,c=typeof d==="number"?d:0,a=this.items.length,b=this.renderOnScroll?this.renderBlockSize:a,e;this.renderableItems=[];while(c<a&&this.renderableItems.length<b){e=this.getFilteredItem(c);if(e){this.renderableItems.push(e);}c++;}},getFilteredItem:function X(a){var f=this.items[a],d=this.searchInput;if(!d||d.isClear()){f._renderIdx=a;return f;}else{var e=d.text,c=K(f,e),b=e&&(!c||a===this.allIdx);if(!b){var g=JSON.parse(JSON.stringify(f));g._renderIdx=a;g.n=c;f._renderIdx=a;return g;}}return null;},onScrollEnd:function A(){var c={v:{dimension:"h",offsetDimension:"offsetHeight",scroll:"scrollTop",scrollDimension:"scrollHeight"},h:{dimension:"w",offsetDimension:"offsetWidth",scroll:"scrollLeft",scrollDimension:"scrollWidth"}},f=c[this.isHoriz?"h":"v"];if(this.renderOnScroll){var d=this.scrollNode,a=(this.renderIndex+1)*this.renderBlockSize;if(a>=this.items.length){return ;}if(d[f.offsetDimension]+Math.ceil(d[f.scroll])>=d[f.scrollDimension]){var b=[],e=this.itemsContainerNode.childElementCount;this.renderIndex++;this.updateRenderableItems();this.renderableItems.forEach(function(h,g){b.push(this.itemRenderer.render(h,h._renderIdx,this));if(this.idx2ridx){this.idx2ridx[h._renderIdx]=e+g;}},this);this.itemsContainerNode.innerHTML+=b.join("");}}},renderOnScroll:true,renderIndex:0,renderBlockSize:150});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupButton","mstrmojo.vi.ui.rw.selectors._IsLevelList","mstrmojo.ui.ButtonBar","mstrmojo.ui.PopupWidget","mstrmojo.vi.ui.rw.selectors.SearchableCheckList","mstrmojo.Box","mstrmojo.Widget","mstrmojo.Button.newWebButton","mstrmojo.css");var O=mstrmojo.Widget,K=mstrmojo.Button.newWebButton,D=mstrmojo.dom,Q=mstrmojo.css;var R="expand";function F(){var S=this.docSelector.model;if(S&&!this.refreshListener){this.refreshListener=S.attachEventListener("panelDisplaying",this.id,function(U){this.refresh();S.detachEventListener(this.refreshListener);});}}function I(d){var S=this.domNode.offsetWidth,a=Array.prototype.slice.call(d.itemsContainerNode.childNodes),W=0,Z=a[W],e=1,U=a.length-1,b=a[U],c=U-1;if(S===0){F.call(this);return ;}if(U===e+1){b.style.display="none";}var X=function(g){var f=g.offsetWidth;return f>0?Math.max(f+6,50):0;},V=a.map(function(f){return X(f);}),Y=V.reduce(mstrmojo.array.fnReduceNumber);if(Y>S+V[U]){while(Y>S){if(c===e){Z.title=Z.innerHTML;Z.innerHTML="";Y-=V[W];Y+=V[W]=X(Z);break;}else{a[c].style.display="none";Y-=V[c];c--;}}}else{b.style.display="none";Y-=V[U];}this.set("hiddenLevel",d.items[c+1].v);a.forEach(function(g,f){g.style.width=(V[f]/Y)*S+"px";});}function G(S){var V=this.parent.parent,U=parseInt(this.hiddenLevel,10)||0;this.set("items",V.getLevels(this.levels).filter(function(W){return W.v>=U;}));this.selectItemByField("v",U);}mstrmojo.vi.ui.rw.selectors.LevelPopupList=mstrmojo.declare(mstrmojo.ui.PopupButton,[mstrmojo.vi.ui.rw.selectors._IsLevelList],{scriptClass:"mstrmojo.vi.ui.rw.selectors.LevelPopupList",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-vi-sel-LevelPopupList {@cssClass}"><div class="level-control"></div><div class="level-container"></div></div>',markupSlots:{controlNode:function J(){return this.domNode.firstChild;},containerNode:function M(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:O.visibleMarkupMethod,onheightChange:O.heightMarkupMethod,onwidthChange:O.widthMarkupMethod,onapplyEnabledChange:function(){var S=this.getPopupWidget(),U=this.applyEnabled;if(S.hasRendered){Q.toggleClass(S.domNode,"noApply",!U);}else{Q[(U?"remove":"add")+"WidgetCssClass"](S,"noApply");}}},isHostedWithin:false,anchorSlot:"controlNode",hiddenLevel:R,children:[{scriptClass:"mstrmojo.ui.ButtonBar",slot:"controlNode",alias:"levelList",multiSelect:false,showIcon:false,selectionPolicy:"reselect",bindings:{levels:"this.parent.levels"},onlevelsChange:function(S){this.set("items",this.parent.getLevels(S.value));},postselectionChange:function(b){var V=b.added&&b.added[0],c=this.items[V];if(c){var a=this.parent,W=a.getPopupWidget(),U=c.v,S=U===R;if(!S){a.set("level",U);}a.openPopupWidget(S);if(W.visible){var X=this._getItemNode(V),Y=X.offsetLeft,Z=(X.offsetWidth-W.domNode.offsetWidth)/2;if(V===0){Y+=Math.max(Z,0);}else{if(V>=this.items.length-2){Y+=Z+Math.min(Z,0);}else{Y+=Z;}}W.offsetLeft=Y;W.domNode.style.left=Y+"px";}}}},{scriptClass:"mstrmojo.ui.PopupWidget",alias:"popupList",visible:false,autoCloses:false,adjustCornersForPopupOverflow:function P(){var S=mstrmojo._IsPopup.adjustCornersForPopupOverflow.call(this);this.adjustCheckListForPopupOverflow(S);this.domNode.style.left=this.offsetLeft+"px";return S;},adjustCheckListForPopupOverflow:function L(V){var Y=this.domNode,X,U,W=this.checklist,a=W&&(W.scrollNode||W.scrollboxNode);if(V&&a){X=D.position(Y);U=X.y;if(U+X.h>D.position(document.body).h){var S=Y.offsetHeight,Z=a&&a.offsetHeight;a.style.maxHeight=D.getMaxScrollHeight()-(S-Z)+"px";W.updateScrollbars();}}},shouldPropagateLockHover:function(){return false;},children:[{scriptClass:"mstrmojo.ui.Pulldown",alias:"levelPulldown",isHostedWithin:false,visible:false,bindings:{levels:"this.parent.parent.levels",hiddenLevel:"this.parent.parent.hiddenLevel"},onlevelsChange:G,onhiddenLevelChange:G,onvisibleChange:function(S){var U=this.getSelectedItem();if(S.value&&U){this.parent.parent.set("level",U.v);}},onitemSelected:function(S){this.parent.parent.set("level",S.v);}},{scriptClass:"mstrmojo.vi.ui.rw.selectors.SearchableCheckList",alias:"checklist",bindings:{level:"this.parent.parent.level"}},{scriptClass:"mstrmojo.Box",alias:"buttons",children:[K(mstrmojo.desc(134,"Apply"),function(){var S=this.parent.parent.parent;if(S.applyEnabled){S.handleSelectionSubmit(true);S.closePopup();}},true),K(mstrmojo.desc(221,"Cancel"),function(){var S=this.parent.parent.parent;S.handleSelectionSubmit(false);S.closePopup();},false)]}]}],getPopupWidget:function B(){return this.popupList;},getCheckList:function H(){return this.getPopupWidget().checklist;},getLevels:function E(S){var U=this._super(S);U[0].cls="iconRA-selItem";U.push({v:R,cls:"iconRA-epdItem"});return U;},preBuildRendering:function A(){var S=this.getPopupWidget(),U=this.labelCssText;this._super();if(S.cssText.indexOf(U)===-1){S.cssText+=U;}},postBuildRendering:function N(){this._super();this.closePopup();I.call(this,this.levelList);},openPopupWidget:function C(V){var S=this.getPopupWidget(),U=this.getCheckList();if(!S.visible){S.levelPulldown.set("visible",V);this.openPopup(S);Q.toggleClass(U.domNode,"strikeout",!this.include);U.updateScrollbars();}else{this.closePopup();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi.ui.rw.selectors._IsLevelList","mstrmojo.ui.Pulldown","mstrmojo.vi.ui.rw.selectors.SearchableCheckList","mstrmojo.Box","mstrmojo.Widget","mstrmojo.Button.newWebButton","mstrmojo.css");var G=mstrmojo.Widget,F=mstrmojo.Button.newWebButton,C=mstrmojo.css;var E="all";mstrmojo.vi.ui.rw.selectors.LevelCheckList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui.rw.selectors._IsLevelList],{scriptClass:"mstrmojo.vi.ui.rw.selectors.LevelCheckList",markupString:'<div id="{@id}" style="{@cssText}" class="mstrmojo-vi-sel-LevelCheckList {@cssClass}"><div class="level-control"></div><div class="level-container"></div><div class="level-buttonBar"></div></div>',markupSlots:{controlNode:function B(){return this.domNode.firstChild;},containerNode:function A(){return this.domNode.children[1];},buttonBarNode:function D(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:G.visibleMarkupMethod,onheightChange:G.heightMarkupMethod,onwidthChange:G.widthMarkupMethod,onapplyEnabledChange:function(){var I=this.applyEnabled;C.toggleClass(this.domNode,"noApply",!I);this.layoutConfig.h.buttonBarNode=I?"36px":"0px";this.doLayout();}},layoutConfig:{h:{controlNode:"30px",containerNode:"100%"},w:{controlNode:"100%",containerNode:"100%",buttonBarNode:"100%"},xt:true},children:[{scriptClass:"mstrmojo.ui.Pulldown",slot:"controlNode",alias:"levelPulldown",cssClass:"level",isHostedWithin:false,bindings:{levels:"this.parent.levels",level:"this.parent.level"},onlevelsChange:function(I){var L=this.level,J=parseInt(L,10)>=0,K=I.value;this.set("items",this.parent.getLevels(K));this.selectItemByField("v",(J&&!K[L])?E:L);},onlevelChange:function(I){this.selectItemByField("v",I.value);},onitemSelected:function(I){this.parent.set("level",I.v);}},{scriptClass:"mstrmojo.vi.ui.rw.selectors.SearchableCheckList",slot:"containerNode",alias:"checklist",bindings:{level:"this.parent.level"}},{scriptClass:"mstrmojo.Box",slot:"buttonBarNode",alias:"buttons",children:[F(mstrmojo.desc(134,"Apply"),function(){var I=this.parent.parent;if(I.applyEnabled){I.handleSelectionSubmit(true);}},true),F(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.handleSelectionSubmit(false);},false)]}],getCheckList:function H(){return this.checklist;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ObjectInputBox","mstrmojo.ACL.UserDataService");mstrmojo.ACL.UserInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{suggestionPopupCssClss:"mstrmojo-ACLInputBox-suggest",blockCount:10,useKeyDelay:true,getACLUserDataService:function C(){return mstrmojo.ACL.UserDataService;},item2textCss:function A(D){return(this._super&&this._super(D))||"mstrmojo-ACLInputBox-user "+{8704:"u",8705:"ug"}[D.st]||"";},getCandidatesThroughTaskCall:function B(E,D){this.getACLUserDataService().searchUserCandidates(E.pattern,!E.isVerify,E.blockCount,D);}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.desc","mstrmojo.vi.ui.NumberFormatter");var B=mstrmojo.desc;mstrmojo.vi.ui.NumberFormatterEditor=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.NumberFormatterEditor",onSubmenuOpen:function A(){},myData:null,oldData:null,formatValue:null,onOK:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.vi.ui.NumberFormatter",bindings:{myData:"this.parent.myData",oldData:"this.parent.oldData",formatValue:"this.parent.formatValue"}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-subtotals-button",children:[{scriptClass:"mstrmojo.Button",text:B(221,"Cancel"),onclick:function(){this.parent.parent.onSubmenuClosed();}},{scriptClass:"mstrmojo.Button",text:B(1442,"OK"),onclick:function(){var C=this.parent.parent,D=C.xtab;C.onSubmenuClosed();this.parent.parent.onOk();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ValidationTextBox","mstrmojo.Calendar","mstrmojo.Popup","mstrmojo._HasPopup","mstrmojo.locales","mstrmojo.date","mstrmojo.string");var B=mstrmojo.ValidationTextBox.prototype.markupMethods,D=mstrmojo.string,A=function(){return mstrmojo.locales.datetime;},C=mstrmojo.date;mstrmojo.DateTextBox=mstrmojo.declare(mstrmojo.ValidationTextBox,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.DateTextBox",calendarToBody:false,calendarZIndex:100,changeValueOnOK:false,dynDateValue:null,showAdvanced:false,canSelectDisabledDate:false,isList:false,dtp:14,defaultDate:null,autoFormat:true,enabled:true,min:"",max:"",markupString:'<div id="{@id}" class="mstrmojo-DateTextBox {@cssClass}" style="{@cssText}"><input class="mstrmojo-DateTextBox-input" type="text" title="{@tooltip}"value="{@value}" size="{@size}" maxlength="{@maxLength}" index="{@tabIndex}" mstrAttach:focus,keyup,blur /><div class="mstrmojo-DateTextBox-icon" mstrAttach:click> </div><div class="mstrmojo-DateTextBox-popup"></div></div>',markupSlots:{inputNode:function(){return this.domNode.firstChild;},iconNode:function(){return this.domNode.childNodes[1];},popupNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?this.cssDisplay:"none";},onwidthChange:function(){if(this.width){this.inputNode.style.width=(this.width-20)+"px";this.iconNode.style.left=(this.width-18)+"px";this.domNode.style.width=this.width+"px";}},onvalueChange:B.onvalueChange,onenabledChange:B.onenabledChange,onvalidationStatusChange:B.onvalidationStatusChange},calConfig:null,calendar:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-DateTextBox-calendar",locksHover:true,slot:"popupNode",onOpen:function(){var H=this.opener,G=H&&H.calendarZIndex,I=this.cal,E=H&&H.calConfig;if(G){this.domNode.style.zIndex=G;}for(var F in E){I.set(F,E[F]);}},children:[{scriptClass:"mstrmojo.Calendar",alias:"cal",forceNonEmptySelection:true,bindings:{showAdvanced:"this.parent.opener.showAdvanced",dtp:"this.parent.opener.dtp",value:"this.parent.opener.value",dynDateValue:"this.parent.opener.dynDateValue",enabled:"this.parent.opener.enabled",min:"this.parent.opener.min",max:"this.parent.opener.max",canSelectDisabledDate:"this.parent.opener.canSelectDisabledDate",changeValueOnOK:function(){var F=this.parent.opener.dtp,E=this.parent.opener.changeValueOnOK;return F===15||F===16||E;}},closeOnValueChange:true,onValueUpdate:function(F){var I=this.parent&&this.parent.opener;if(I){var G=I.value,E=window.mstrConfig&&window.mstrConfig.listSep||";",H=I.dtp===15?C.formatTimeInfo(this.timeVal,A().TIMEOUTPUTFORMAT):this.value;if(I.isList&&!D.isEmpty(G)){I.set("value",I.value+E+H);}else{I.set("dynDateValue",this.dynDateValue);I.set("value",H);}I.closePopup();}}}]},onclick:function(E){var F=this._lastOpened,G=this._calendarConfig;if(!G){G={};if(this.calendarToBody){delete this.calendar.slot;G.placeholder=document.body.appendChild(document.createElement("div"));G.nudge=function(){var M=this.opener;if(M){var H=mstrmojo.dom.position(M.popupNode,true),L=this.domNode,P=L.offsetHeight,I=L.offsetWidth,J=mstrmojo.dom.windowDim(),K=H.x,N=H.y;if(N+P>=J.h){N=Math.max(N-P,0);}if(K+I>=J.w){K=Math.max(K-I,0);}var O=L.style;O.top=N+"px";O.left=K+"px";}};}this._calendarConfig=G;}G.lockIW=this;if(F&&F.visible){this.closePopup();}else{this.openPopup("calendar",G);this.calendar.cal.updateSelectedDate(true);}},unrender:function(){this._super();if(this.calendarToBody&&this._calendarConfig){delete this._calendarConfig;}if(this.calendar.hasRendered){this.calendar.unrender();}},_set_value:function(H,F){var G=this.value,E=(G!==F);if(E){this.value=F;this.validate(F);}if(this.showAdvanced&&this.dynDateChanged){this.dynDateChanged=false;E=true;}return E;},_set_dynDateValue:function(H,F){var G=this.dynDateValue,E=(G!==F);if(E){this.dynDateValue=F;this.dynDateChanged=true;}return E;}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TitleBar","mstrmojo.ui.menus._HasMenuPopup");function E(H,F){var G=this.domPopupPH;G.style.top=H.y+"px";G.style.left=H.x+"px";G.innerHTML="";document.body.appendChild(G);F.hostId=this.id;F.hostElement=G;mstrmojo.css.toggleClass(G,mstrApp.getThemeClassName(),true);this.openPopup(F.newInstance());}function B(){var G=this.domPopupPH,H=G.firstChild,F=G.parentNode;if(H){G.removeChild(H);}if(F){F.removeChild(G);}}function A(G){var F;if(typeof this.parent.boxContent.getTitleRMCPopup==="function"){F=this.parent.boxContent.getTitleRMCPopup.call(this);}if(F){E.call(this,G,F);}}mstrmojo.vi.ui.TitleBarWithRMCPopup=mstrmojo.declare(mstrmojo.vi.ui.TitleBar,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.vi.ui.TitleBarWithRMCPopup",markupString:'<div id="{@id}" class="mstrmojo-VITitleBar {@cssClass}" style="{@cssText}" mstrAttach:contextmenu, click><div class="left-toolbar"></div><div class="title-text"></div><div class="right-toolbar"></div></div>',init:function D(F){this._super(F);var G=document.createElement("div");G.setAttribute("class","gm-menu-placeholder");this.domPopupPH=G;},oncontextmenu:function C(F){A.call(this,{x:F.e.pageX+2,y:F.e.pageY+2});},unrender:function(){this._super();B.call(this);},onclick:function(){B.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TitleBar","mstrmojo.vi.ui.PanelContents");function D(H,I,G){if(I){this.targetUnit.updateDisplayName(H,G);if(mstrApp.isInVFConfigMode){mstrmojo.all.visualizationFilterToolbar.updateDisplayFilterName(H);}}}function A(G){this.set("title",G.value);}function B(G){if(this.layoutKey!==this.model.currlaykey){return ;}if(this._vizTitleSub){this._vizTitleSub.clear();delete this._vizTitleSub;}this.set("title","");var I=this.contents,H=(I.children||[]).slice();I.removeChildren();H.forEach(function(K){K.destroy();});var J=mstrmojo.all[G.id];if(J){this.targetUnit=J;this.set("title",J.getDisplayName());this._vizTitleSub=J.attachEventListener("titleChange",this.id,A);this.onVIUnitSelected(J);}}mstrmojo.vi.ui._IsUnitDependentPanel=mstrmojo.provide("mstrmojo.vi.ui._IsUnitDependentPanel",{_mixinName:"mstrmojo.vi.ui._IsUnitDependentPanel",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,ontitleChange:function(){var G=this.toolbar;if(G){G.set("title",this.title||"");}}},targetUnit:null,init:function E(G){this._super(G);this.model.attachEventListener("viUnitSelected",this.id,B);this.toolbar.set("editTitleOnDoubleClick",mstrApp.allowWebDashboardDesign());},children:[{scriptClass:"mstrmojo.vi.ui.TitleBar",slot:"controlNode",alias:"toolbar",useRichTooltip:true,titleEdited:function(H,I,G){D.call(this.parent,H,I,G);},layoutConfig:{w:{textNode:"100%",rightToolNode:"23px"},h:{textNode:"all",rightToolNode:"all"},xt:true},getTitleChildrenLayoutOffsets:function F(){return{h:0,w:16};}},{scriptClass:"mstrmojo.vi.ui.PanelContents",slot:"containerNode",alias:"contents"}],onRender:function C(){var G=this.model.getSelectedViUnit();if(G){B.call(this,{id:G.id});}if(this._super){this._super();}},onVIUnitSelected:function(G){}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TitleBar","mstrmojo.Image","mstrmojo.css");mstrmojo.vi.ui.CollapsibleTitleBar=mstrmojo.declare(mstrmojo.vi.ui.TitleBar,null,{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",btnCollapse:null,canCollapse:false,isCollapsed:false,collapse:mstrmojo.emptyFn,onToggleCollapseByUI:mstrmojo.emptyFn,setToolbarVisibility:function C(D){if(!D||!this.isCollapsed){this._super(D);}},onisCollapsedChange:function B(){if(this.canCollapse){var D=this.isCollapsed;this.parent.set("isCollapsed",D);}},getLeftToolbarChildren:function A(){var D=this;return[{scriptClass:"mstrmojo.Image",slot:"leftToolNode",alias:"btnCollapse",onclick:function(F){var G=this.parent,E=G.parent;if(G.canCollapse){G.set("isCollapsed",!G.isCollapsed);D.onToggleCollapseByUI();var H=F.e;if(H&&H.stopPropagation){H.stopPropagation();}}if(E&&E.clickToCollapse){E.clickToCollapse();}}}];}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.CollapsibleTitleBar,{oncanCollapseChange:function(){this.btnCollapse.set("visible",this.canCollapse);},onisCollapsedChange:function(){mstrmojo.css.toggleClass(this.domNode,"collapsed",this.isCollapsed);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Container","mstrmojo.desc","mstrmojo.ME.TokenInputBox","mstrmojo.mstr.EnumDSSXMLTokenTypes","mstrmojo.ME.Enum","mstrmojo._HasTooltip","mstrmojo.dom","mstrmojo.string");mstrmojo.requiresDescs(221,547,9106,9565,9566,9567,9568,11897,13542,13543,15665);var M=mstrmojo.array,S=mstrmojo.hash,I=mstrmojo.desc,O=mstrmojo.mstr.EnumDSSXMLTokenTypes,N=mstrmojo.ME.Enum.METRIC_EDIT_TYPES,L=mstrmojo.string.escape4HTMLText,E=mstrmojo.dom;var Q={VALID:0,UNKNOWN:1,VALIDATING:2,ERROR:3,AMBIGUITY:4},G={0:"valid",1:"unknown",2:"validating",3:"error",4:"ambiguity"},R={0:I(9565,"Valid Metric Formula."),1:I(9106,"Require Validation?"),2:I(9566,"Validation in Progress..."),3:I(9567,"Validation Failed with Syntax Error!"),4:I(9568,"Validation Failed with Object Ambiguity!")},U={ERROR:"-2147214845",AMBIGUITY:"-2147214846"},B={};B[U.ERROR]=Q.ERROR;B[U.AMBIGUITY]=Q.AMBIGUITY;function P(a){if(!a){return Q.VALID;}return B[a]||Q.ERROR;}mstrmojo.ME.MetricEditBox=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo._HasTooltip],{scriptClass:"mstrmojo.MetricEditBox",vStatus:Q.VALID,iStatus:"",showStatus:true,browseItemVisible:true,absorbAmbiguity:true,validateFunc:null,isObjectVisible:function(a){return true;},markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-MEBox-edit"></div><div class="mstrmojo-MEBox-status {@statusCssClass}"><div class="mstrmojo-MEBox-vStatus"></div><div class="mstrmojo-MEBox-iStatus"></div></div></div>',markupSlots:{editNode:function(){return this.domNode.firstChild;},iStatusNode:function(){return this.domNode.lastChild.lastChild;},vStatusNode:function(){return this.domNode.lastChild.firstChild;},statusNode:function(){return this.domNode.lastChild;}},markupMethods:{onvStatusChange:function(){var b=this.vStatus,a=this.vStatusNode;a.className="mstrmojo-MEBox-vStatus "+G[b];a.innerHTML=(this.getStatusDesc&&this.getStatusDesc(b))||R[b]||"";if(this.vStatus===Q.VALID){this.set("cValid",true);}},oniStatusChange:function(){this.iStatusNode.innerHTML=this.iStatus;}},children:[{scriptClass:"mstrmojo.ME.TokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"},editEmbeddedFilterToken:function(a){var b=this.parent;if(b.editEmbeddedFilterToken){b.editEmbeddedFilterToken(a);}}}],init:function V(a){var b=this,c=a.validateFunc||this.validateFunc;if(c){b.children=[{scriptClass:"mstrmojo.Button",alias:"validateBtn",slot:"statusNode",text:I(11897,"Validate"),cssClass:"mstrmojo-WebHoverButton right hoverLink",cssDisplay:"inline-block",onclick:c}].concat(this.children);}if(this._super){this._super(a);}this.statusCssClass=this.showStatus?"":"hidden";},getSearchPattern:function Z(){return this.inputBox.getSearchPattern();},getHighlightedText:function W(b,a){return this.inputBox.getHighlightedText(b,a);},item2textCss:function K(a){return{4:"m",7:"am",11:"fx",12:"a",13:"fc",43:"tr",47:"cs"}[a.t]||"";},handleSuggestionItemSelect:function J(a){var b=this.ambiguityDialog;if(a){b.onItemSelect(a);}b.close();},showDesc:true,showPath:true,ambiguityDialog:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-ambiguityDialog",onOpen:function(){this.set("title",I(13542,"Object Ambiguity - ##").replace("##",this.ambiguousName));this.list.clearSelect();this.list.set("items",this.items);this.list.singleSelect(0);this.label.set("text",I(13543,"More than one object with the name '##' were found.").replace("##",this.ambiguousName));},children:[{scriptClass:"mstrmojo.Label",alias:"label",text:""},{scriptClass:"mstrmojo.ui.ScrollableSuggestionList",alias:"list",cssClass:"mstrmojo-ME-ambiguityList",bindings:{items:"this.parent.opener.suggestionItems"},onclick:function(a){mstrmojo._IsList.onclick.call(this,a);},getItemMarkup:function(d,a){var c=this.parent.opener,b=mstrmojo.string.escape4HTMLText;var f=(c&&c.item2textCss(d))||"";var e="";if(d.path){e='<div class="mstrmojo-object-additional-info" idx="'+a+'">'+mstrmojo.desc(16154,"From Dataset:")+" "+L(d.path)+"</div>";}else{d.standalone=true;}return'<div class="mstrmojo-object-item" idx="'+a+'"><div class="mstrmojo-object-name '+f+'" idx="'+a+'">'+L(d.n)+"</div>"+e+"</div>";},buildTooltip:function(a,b){if(a.standalone){return L(a.path)+"> "+L(a.n);}else{return L(a.n)+'<div class="mstrmojo-object-additional-info">'+mstrmojo.desc(16154,"From Dataset:")+" "+L(a.path)+"</div>";}}}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton hot",text:I(547,"Select"),onclick:function(){var a=this.parent.parent;a.opener.handleSuggestionItemSelect(a.list.selectedItem);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton",text:I(221,"Cancel"),onclick:function(){this.parent.parent.close();}}]},defaultOnTokensModify:function(){this.set("vStatus",Q.UNKNOWN);this.set("iStatus","");},postBuildRendering:function Y(){this._super();this.inputBox.attachEventListener("tokensModify",this.id,"defaultOnTokensModify");this.inputBox.attachEventListener("tokensModify",this.id,"ontokensModify");},updateInputBoxItems:function H(a){this.inputBox.set("items",a.items);},replaceErrorToken:function C(a){this.inputBox.replaceErrorToken(a);},clientSideValidation:function A(g){if(!g){return ;}var c=false,f=false,b=g.items;try{c=mstrApp.rootCtrl.docCtrl.model.isMDXDataset(S.any(this.parent.parent.datasets));f=g.met==N.ADVANCED&&b[0].tp==O.SimpPrefixFun&&b[0].v==="ApplySimple";}catch(h){}if(c&&f){var a=M.filterOne(b,function(e){return e.tp===O.DoubleQString;});var d=/(\'|\/\/|\-\-|\/\*|\*\/)/;if(a&&d.test(a.v)){g.vs=Q.ERROR;g.rjec=U.ERROR;g.rjed=I(15665,"MDX pass-through expression should not contain ', //, --, /*, */.");}}},handleValidation:function F(a){if(!a){this.set("vStatus",Q.ERROR);return ;}a.vs=P(a.rjec);this.set("vStatus",a.vs);this.set("iStatus",mstrmojo.string.encodeHtmlString(a.rjed)||"");this.updateInputBoxItems(a);this.inputBox.focus();if(a.vs===Q.AMBIGUITY){var l=this,h=a.items,g=M.find(h,"sta",-1),b=h[g].v,j=function(c){l.replaceErrorToken(c);l.set("iStatus","");l.set("vStatus",Q.UNKNOWN);if(l.continueValidataion){l.continueValidataion();}else{l.set("vStatus",Q.VALID);}};var d=M.filter(a.srfd.items,this.isObjectVisible);var k=this.parent.candidates,e=k&&k.items;if(e){M.forEach(d,function(f){var c=M.find(e,"did",f.did);if(c===-1){if(this.absorbAmbiguity){e.push(f);}}else{f.path=e[c].path;}});}if(d.length===1){j(d[0]);return ;}this.openPopup("ambiguityDialog",{zIndex:100,items:d,ambiguousName:b,onItemSelect:j});}else{if(this.postHandleValidation){this.postHandleValidation();}}},tooltip:"",useRichTooltip:true,updateTooltipConfig:function X(b){var c=b.target||E.eventTarget(b.hWin,b.e),a=E.position(c);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.getTooltipContent(b),top:a.y+a.h,left:a.x+10,cssClass:"vi-regular vi-tooltip-A"};},getTooltipContent:function(a){return this.iStatus;},showTooltip:function D(a,b){if(a.target===this.iStatusNode){this._super(a,b);}}});mstrmojo.ME.MetricEditBox.VALIDATION_STATUS=Q;mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_CSS=G;mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_DESC=R;}());(function(){mstrmojo.requiresCls("mstrmojo.ME.TokenInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.array","mstrmojo.css","mstrmojo.desc","mstrmojo.tooltip","mstrmojo.dom","mstrmojo.string","mstrmojo.range");var S=mstrmojo.mstr.EnumDSSXMLObjectTypes,P=mstrmojo.array,h=mstrmojo.css,N=mstrmojo.desc,J=mstrmojo.dom,G=mstrmojo.string,U=mstrmojo.range;var C='ApplySimple("',F='")',k="dragIn",j="err",M="mstrmojo-token",V={BEFORE_PREFIX:1,AT_PREFIX:2,AT_POSTFIX:3,AFTER_POSTFIX:4,OTHER:99},Z={x:0,y:9};mstrmojo.requiresDescs(15834);mstrmojo.vi.ui.editors.cm.CalculatedMemberExpressionInputBox=mstrmojo.declare(mstrmojo.ME.TokenInputBox,null,{scriptClass:"mstrmojo.vi.ui.editors.cm.CalculatedMemberExpressionInputBox",cssClass:"mstrmojo-CalculatedMemberExpressionInputBox",expValid:false,tooltipOpenDelay:100,useRichTooltip:true,renderOnScroll:false,renderBlockSize:0,postBuildRendering:function d(){this._super();this.onexpValidChange();},updateTooltipConfig:function c(){if(this.expValid){delete this.richTooltip;}else{var l=J.position(this.domNode);if(l.x||l.y||l.w||l.h){this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:G.encodeHtmlString(N(15834,"MDX pass-through expression should not contain '', //, --, /*, */ or be empty.")),top:l.y,left:l.x};}}},startTokenSuggestion:mstrmojo.emptyFn,resetDisplay:function f(o){o=o||"";var n=/-|\+|\*|\/|\(|\)/,l=o.search(n),m,p=[];while(l>=0){if(l>0){m=o.substring(0,l);p.push({v:m,isNew:true});}m=o.substr(l,1);p.push({v:m,isNew:true});o=o.substr(l+1);l=o.search(n);}if(o.length>0){p.push({v:o,isNew:true});}if(p.length>0){this.resetTokens(p);}else{this.resetTokens(null);}},createToken:function X(l){return{v:l.v.split(":")[1],isNew:true,isDelimiter:true};},resetTokens:function g(m){var o=[{v:C,isNew:true,isDelimiter:true,oi:{t:S.Function}}];if(m){o=o.concat(m);}o.push({v:F,isNew:true,isDelimiter:true,oi:{t:S.Function}});this.clearTokens();this.insertTokens(o);var l=this.editNode,n=this.listMapper.findWrapper(l,this.items.length-2);this._delaySetTextCaretPos(n,n.innerText.length);},getExpression:function b(){var l=this.items,m=l.length;if(m>=2&&l[0].v===C&&l[m-1].v===F){return P.map(l.slice(1,m-1),function(n){return n.v;}).join("");}},isExpressionValid:function D(){var m=this.getExpression(),l=/(\'|\/\/|\-\-|\/\*|\*\/)/;return m&&m.trim()&&!l.test(m);},insertTokens:function I(m){var l=this._super(m);this.set("expValid",this.isExpressionValid());return l;},getCaretPosition:function H(l,q){var r=V.OTHER,n,o,m;try{l=J.findAncestorByName(l,"span",true,this.domNode);if(l){n=this.editNode.firstElementChild.firstElementChild;o=this.editNode.lastElementChild.firstElementChild;m=C.length;if(l===n&&q<m){r=V.BEFORE_PREFIX;}else{if(l===n&&q===m||l.parentElement.previousElementSibling.firstElementChild===n&&q===0){r=V.AT_PREFIX;}else{if(l===o&&q>0){r=V.AFTER_POSTFIX;}else{if(l===o&&q===0||l.parentElement.nextElementSibling.firstElementChild===o&&q===l.textContent.length){r=V.AT_POSTFIX;}}}}}}catch(p){}return r;},on_saveRangeInfoChange:function B(){var n=this._saveRangeInfo;if(n){var m=this.getCaretPosition(n.startContainer,n.startOffset),l=this.getCaretPosition(n.endContainer,n.endOffset);if(m===V.BEFORE_PREFIX||l===V.BEFORE_PREFIX){var p=this.editNode.firstElementChild.firstElementChild;this._delaySetTextCaretPos(p,C.length);}else{if(m===V.AFTER_POSTFIX||l===V.AFTER_POSTFIX){var q=this.editNode.lastElementChild.firstElementChild,o=q.parentElement.previousElementSibling.firstElementChild;this._delaySetTextCaretPos(o,o.textContent.length);}}}},isSelectionOutOfRange:function R(){var n=this._saveRangeInfo;if(n){var m=this.getCaretPosition(n.startContainer,n.startOffset),l=this.getCaretPosition(n.endContainer,n.endOffset);return m===V.AFTER_POSTFIX||m===V.BEFORE_PREFIX||l===V.AFTER_POSTFIX||l===V.BEFORE_PREFIX;}},processDeleteKeyDown:function K(n){var l=this._saveRangeInfo;if(this.isSelectionOutOfRange()){return true;}if(l&&l.collapsed){var m=this.getCaretPosition(l.startContainer,l.startOffset);if(m===V.AT_POSTFIX||m===V.AT_PREFIX&&this.items.length===2){return true;}}return this._super(n);},processBackspaceKeyDown:function O(m){var l=this._saveRangeInfo;if(this.isSelectionOutOfRange()){return true;}if(l&&l.collapsed&&this.getCaretPosition(l.startContainer,l.startOffset)===V.AT_PREFIX){return true;}else{return this._super(m);}},handlekeypress:function Y(m){var l=this._super(m);this.set("expValid",this.isExpressionValid());return l;},handlekeydown:function E(m){this.set("_saveRangeInfo",U.getRangeInfo());var l=this._super(m);this.set("expValid",this.isExpressionValid());return l;},onexpValidChange:function a(){h.toggleClass(this.domNode,j,!this.expValid);if(this.expValid){this.hideTooltip();}else{if(document.activeElement===this.editNode){this.showTooltip();}}},ondropCuePosChange:function W(x){var v=x.value,o=this.dragdata;if(o&&o.setAvatarClass){o.setAvatarClass(v?"add":"");}var w=Math.min(v&&v.idx||1,this.items.length-1),m=this._saveRangeInfo,p=m&&m.startContainer,t=m&&m.startOffset;p=this.listMapper.findWrapper(this.editNode,w-1);t=p.innerText.length;if(p&&typeof t==="number"){if(this.listMapper.findIndex(this,this.editNode,p)!==-1){if(J.isSafari||mstrApp.isWorkstation&&J.isMac()){var q;if(!p.classList.contains(M)){var n=p.getElementsByClassName(M);if(n.length>0){q=n[0];}}else{q=p;}var l={collapsed:true,startContainer:q,startOffset:t};this.set("_saveRangeInfo",l);}else{this._delaySetTextCaretPos(p,t);}if(v!==null&&w!==(v&&v.idx)){var s=this.listMapper.findWrapper(this.editNode,w),u=this.listMapper.findWrapper(this.editNode,0);if(s&&u){this.set("dropCuePos",{idx:w,idxActual:w,top:s.offsetTop-u.offsetTop+Z.y,left:s.offsetLeft-u.offsetLeft+Z.x});}}}}},ondragenter:function Q(m){if(this.isDraggingItem(m)){h.addClass(this.domNode,k);this._super(m);var l=this.listMapper.findWrapper(this.editNode,0),n=l&&l.getBoundingClientRect();if(n){this.set("dropCuePos",{left:n.width+Z.x,top:Z.y});}}},ondragleave:function A(l){if(this.isDraggingItem(l)){h.removeClass(this.domNode,k);this._super(l);}},ondrop:function e(n){if(this.isDraggingItem(n)){h.removeClass(this.domNode,k);var m=this._super(n),o=this.listMapper.findWrapper(this.editNode,m),l=o.innerText.length;this._delaySetTextCaretPos(o,l);}},isDraggingItem:function L(l){return l.src&&l.src.node&&l.src.node.className.indexOf("item")>=0;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui._HasMask","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.models.FormatModel","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.ui.tabs.LayoutTabHelper","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents");mstrmojo.requiresDescs(13768,13769,14918,14919,15127,15128);var Q=mstrmojo.hash,H=mstrmojo.dom,O=mstrmojo.array,c=mstrmojo.css,C=mstrmojo.string,A=mstrmojo.vi.ui.tabs.Tab.ACTIONS,F=A.DELETE+A.DUPLICATE+A.MOVE+A.RENAME+A.NEW_TAB,V=mstrmojo.vi.models.VIComponentMap.TYPES,g=mstrmojo.models.FormatModel,X=mstrmojo.vi.ui.tabs.LayoutTabHelper,P=144,L=70,U=90,W=52,M=6,a=2,b=mstrmojo.vi.controllers.EnumLayoutManipulationType,d=mstrmojo.vi.controllers.EnumPanelManipulationType,G=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,B=mstrmojo.vi.controllers.EnumEvents;function D(h){return function(){c.toggleClass(this.menuBtnNode,"expand",h);this.menuBtnHostNode.style.display=h?"block":"none";};}mstrmojo.vi.ui.tabs.LayoutTabStrip=mstrmojo.declare(mstrmojo.vi.ui.tabs.TabStrip,[mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.tabs.LayoutTabStrip",docModel:null,isAlignRight:false,alignPosition:G.LEFT,selectMovedTab:true,cssClass:"mstrmojo-LayoutTabStrip",markupMethods:{onalignPositionChange:function(){var h=this.alignPosition===G.TOP;c.toggleClass(this.domNode,"alignTop",h);c.toggleClass(this.menuImgNode,"topButton",h);this.visible=this.alignPosition===G.LEFT?false:true;},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{bufferNode:M+"px",addBtnNode:U+"px",navBtnsNode:W+"px"},xt:true},onRender:function J(){this._super();var k=this.leftBtnNode,h=this.rightBtnNode,j=mstrApp.isWSStyling?mstrmojo.desc(15127,"Chapter"):mstrmojo.desc(15128,"Sheet");if(k&&!k.getAttribute("tooltip")){this.leftBtnNode.setAttribute("tooltip",mstrmojo.desc(15820,"This is the first ##").replace("##",j));}if(h&&!h.getAttribute("tooltip")){this.rightBtnNode.setAttribute("tooltip",mstrmojo.desc(15821,"This is the last ##").replace("##",j));}},onLayoutModeChange:function K(h){this.adjustInPreviewMode();},widgetResized:function N(){var h=function(){if(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview()){this.adjustInPreviewMode();}else{var l=!this.isValidMode(),k=H.position(this.domNode).w||parseInt(this.width,10)||0,n=l?W+a+M:P+L,m=Math.max(k-n,0),j=this.tabContainerNode;if(j&&m){j.style.maxWidth=m+"px";}}};if(this.hasRendered){h.call(this);return ;}this.attachEventListener("renderComplete",this.id,h);},buildRendering:function S(){this._super();var h=this.borderNode=document.createElement("div");h.className="mstrmojo-VILayoutTabs-divider";h.style.zIndex=this._borderZIndex;this.domNode.appendChild(h);this.addBtnTxtNode.innerHTML=mstrApp.isWSStyling?mstrmojo.desc(15127,"Chapter"):mstrmojo.desc(15128,"Sheet");},adjustInPreviewMode:function R(){var q=parseInt(this.parent.width,10)||0,k=mstrmojo.vi.ui.rw.DocRelativePanel.getLayoutBreakPoint(),p=!this.isValidMode(),h=mstrApp.isLayoutModePreview(),n=p?W+a:P+L,m=this.domNode,l=this.tabContainerNode;var j=h?Math.min(q,k):q,o=Math.max(j-n,0);this.set("width",j+"px");if(m){m.style.left=h?Math.max(q-k,0)/2+"px":"0px";if(l&&o){l.style.maxWidth=o+"px";}}},getTabCfg:function E(u,k,q){var m=q.k,h=this.id,n=k.model,w=n.controller.view;Q.copy({title:k.n,getMenuActions:function p(){return F;},addNewTabMenuItem:function s(z){z.addMenuItem(mstrApp.isWSStyling?mstrmojo.desc(14919,"Insert Page"):mstrmojo.desc(13768,"Insert Panel"),"",function(){var AC=(u||[]).filter(function(AE){return AE.k===m;})[0];var AB=AC.model,AA=AB.getVIComponent(V.VIZ_CONTENT,AB.getCurrentLayoutKey()),AD=AA&&AA.k;AB.raiseEvent({name:B.MANIPULATE_PANEL,type:d.NEW,layoutKey:AB.getCurrentLayoutKey(),panelStackKey:AD});});z.addSeparator();z.addMenuItem(mstrApp.isWSStyling?mstrmojo.desc(14918,"Insert Chapter"):mstrmojo.desc(13769,"Insert Sheet"),"",function(){mstrmojo.all[h].addTab();});},findSelectedTab:function l(z){var AA=w.getSelectedLayoutWidget();return AA.getSelector().getSelectedTab();},tabSelected:function j(AB){var AA=mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection();if(AA){n.raiseEvent({name:"targetLayoutSelected",layoutKey:m});}else{n.execute({execute:function z(){w.showLayout((u||[]).filter(function(AC){return AC.k===m;})[0],AB);},urInfo:{treesToRender:3}});}},tabDeleted:function v(){n.raiseEvent({name:B.MANIPULATE_LAYOUT,type:b.DELETE,layoutKey:m});},tabDuplicated:function t(){n.raiseEvent({name:B.MANIPULATE_LAYOUT,type:b.DUPLICATE,layoutKey:m});},titleEdited:function x(AA,z){n.raiseEvent({name:B.MANIPULATE_LAYOUT,type:b.RENAME,layoutKey:m,oldText:z,newText:AA});this.parent.updateTabTable();},postCreateChildren:function r(){Q.copy({autoApplyDelay:3000,editOnDoubleClick:mstrApp.allowWebDashboardDesign()},this.lbl);},useRichTooltip:true,updateTooltipConfig:function o(AA){var AB=AA.target;if(AB===this.lbl.domNode&&AB.scrollWidth>AB.clientWidth){var z=H.position(AB);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMCENTER,cssClass:"vi-regular vi-tooltip-V V-center",content:C.encodeHtmlString(this.title),top:z.y,left:z.x+z.w/2};}else{this.richTooltip=null;}}},q);this.docModel=k.model;return q;},addTab:function Y(){var h=this.parent.model;h.raiseEvent({name:B.MANIPULATE_LAYOUT,type:b.NEW});},commitTabMove:function Z(h,j){this.docModel.controller.view.moveLayout(h,j);},onclick:function f(h){this._super(h);if(h.getTarget().parentNode===this.tabStripMenuNode&&this.isValidMode()){var k=this.parent.model,j=k.controller.rootCtrl,l=j.getSelectorTabMenu(k);l.addPopupHandlers(this.id,D(true),D(false));l.hostId=this.id;l.hostElement=this.menuBtnHostNode;l.isHostedWithin=false;this.openPopup(l.newInstance());}},onmousedown:function e(j){this._super(j);var l=this,n=j.getTarget().parentNode,h=(n===this.leftBtnNode),m=(n===this.rightBtnNode);if(h||m){var k=function(){X.saveTabBarPosition(l);};H.attachOneTimeEvent(document.body,"mouseup",k);}},layoutSelected:function I(h){var k=this.docModel,o=k.controller.view,j=this.getSelectedTab(),l=this;var n=function n(p){k.raiseEvent({name:"selectPage",panelKey:p.panelKey,callback:p.callback});};if(j.k!==h.layoutKey){k.execute({execute:function m(){o.showLayout((l.tabObjects||[]).filter(function(p){return p.k===h.layoutKey;})[0],h.callback,undefined,h.panelKey);},urInfo:{treesToRender:3},isUntracked:mstrApp.isAppStateSelection()});}else{n(h);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui._HasMask","mstrmojo.vi.ui.tabs.Tab","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.vi.controllers.EnumLayoutSelectorPosition");mstrmojo.requiresDescs(3687,4780,14919,13768);var L=mstrmojo.hash,G=mstrmojo.dom,U=mstrmojo.css,C=mstrmojo.string,A=mstrmojo.vi.ui.tabs.Tab.ACTIONS,D=A.DELETE+A.DUPLICATE+A.MOVE+A.RENAME+A.NEW_TAB,F=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,K=144,O=90,P=52,I=6,S=2;mstrmojo.vi.ui.tabs.PanelTabStrip=mstrmojo.declare(mstrmojo.vi.ui.tabs.TabStrip,[mstrmojo.vi.ui._HasMask],{scriptClass:"mstrmojo.vi.ui.tabs.PanelTabStrip",cssClass:"mstrmojo-PanelTabStrip",docModel:null,isAlignRight:false,alignPosition:F.LEFT,selectMovedTab:true,hasFloater:true,markupMethods:{onalignPositionChange:function(){U.toggleClass(this.domNode,"alignTop",this.alignPosition===F.TOP);this.visible=this.alignPosition===F.LEFT?false:true;},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{bufferNode:I+"px",addBtnNode:O+"px",navBtnsNode:P+"px"},xt:true},onRender:function H(){this._super();var X=this.leftBtnNode,V=this.rightBtnNode,W=mstrApp.isWSStyling?mstrmojo.desc(3687,"Page"):mstrmojo.desc(4780,"Panel");if(X&&!X.getAttribute("tooltip")){this.leftBtnNode.setAttribute("tooltip",mstrmojo.desc(15820,"This is the first ##").replace("##",W));}if(V&&!V.getAttribute("tooltip")){this.rightBtnNode.setAttribute("tooltip",mstrmojo.desc(15821,"This is the last ##").replace("##",W));}},widgetResized:function J(){var V=function(){var Y=!this.isValidMode(),X=G.position(this.domNode).w||parseInt(this.width,10)||0,a=Y?P+S+I:K,Z=Math.max(X-a,0),W=this.tabContainerNode;if(W&&Z){W.style.maxWidth=Z+"px";}};if(this.hasRendered){V.call(this);return ;}this.attachEventListener("renderComplete",this.id,V);},buildRendering:function M(){this._super();var V=this.borderNode=document.createElement("div");V.className="mstrmojo-VIPanelTabs-divider";V.style.zIndex=this._borderZIndex;this.domNode.appendChild(V);this.addBtnTxtNode.innerHTML=mstrApp.isWSStyling?mstrmojo.desc(3687,"Page"):mstrmojo.desc(4780,"Panel");this.set("visible",this.children.length>1);},getTabCfg:function E(e,W,Z){var c=this.parent;L.copy({title:W.titleText,getMenuActions:function Y(){return D;},addNewTabMenuItem:function b(h){h.addMenuItem(mstrApp.isWSStyling?mstrmojo.desc(14919,"Insert Page"):mstrmojo.desc(13768,"Insert Panel"),"",function(){c.addPanel();});},tabSelected:function V(l){var j=mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection(),h=W.model,k=W.k;if(j){h.raiseEvent({name:"targetLayoutSelected",layoutKey:h.getLayoutKeyByUnitKey(k),panelKey:k});}else{c.selectPanel(k,false,false,null,l);}},tabDeleted:function f(){c.deletePanel(W);},tabDuplicated:function d(){c.duplicatePanel(W);},titleEdited:function g(j,h){c.renamePanel(W,j);},postCreateChildren:function a(){L.copy({autoApplyDelay:3000,editOnDoubleClick:mstrApp.allowWebDashboardDesign()},this.lbl);},useRichTooltip:true,updateTooltipConfig:function X(j){var k=j.target;if(k===this.lbl.domNode&&k.scrollWidth>k.clientWidth){var h=G.position(k);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMCENTER,cssClass:"vi-regular vi-tooltip-V V-center",content:C.encodeHtmlString(this.title),top:h.y,left:h.x+h.w/2};}else{this.richTooltip=null;}}},Z);this.docModel=W.model;return Z;},addTab:function Q(){this.parent.addPanel();},commitTabMove:function R(V,W){this.parent.movePanel(V,W);},onTabsChange:function B(){var V=this.children||[];this.set("visible",V.length>1);},selectPage:function N(V){this.parent.selectPanel(V.panelKey,undefined,undefined,undefined,V.callback);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.string","mstrmojo.ui.SearchablePulldownCheckList","mstrmojo.ui.SearchablePulldown");var I=mstrmojo.array,K=mstrmojo.css,G=mstrmojo.dom,E=mstrmojo.hash,M=mstrmojo.string,F={0:true};function C(){var V=this.selectedIndices=E.copy(this.getPopupList().selectedIndices),P=this.items,S=[],U,R=this.allIdx,Q=this.noneIdx;if(P&&P.length){if(V[R]){S.push(P[R].n);}else{if(V[Q]){S.push(P[Q].n);}else{I.forEach(P,function(X,W){if(V[W]){S.push(X.n);}});}}}U=S.join(", ");this.set("value",U);this.set("text",U);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",content:M.encodeHtmlString(U)});}mstrmojo.ui.MultiSelectSearchablePulldown=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,[],{scriptClass:"mstrmojo.ui.MultiSelectSearchablePulldown",isHostedWithin:false,init:function O(P){this._super(P);K.addWidgetCssClass(this,"multi");this.hostedCSSClass=this.hostedCSSClass+" multi";},submitSelections:function B(){this.onchange();},_set_selectedIndices:function H(S,Q){var P=this.getPopupList(),R=E.copy(this.selectedIndices);P.set("selectedIndices",Q||R||F);C.call(this);return true;},select:function L(P){this.getPopupList().select(P);},getPopupWidget:function D(){return this.popupWidget;},getPopupList:function N(){return this.popupWidget.list;},getPopupListConfig:function A(){return[{scriptClass:"mstrmojo.ui.SearchablePulldownCheckList",alias:"popupWidget",_unlockHoverCheck:function P(U,Q){var S=G.eventTarget(Q,U),R=this.opener;if(G.contains(R.domNode,S,true,document.body)){R.set("isEditing",true);}else{if(!G.contains(this.domNode,S,true,document.body)){this.close();}}},bindings:{itemCssText:function(){return(this.parent&&this.parent.itemCssText)||"";}}}];},processSearch:function J(){var P=this.getPopupWidget();P.toggleCacheMode(true);if(this._super){this._super();}P.toggleCacheMode(false);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.PreviewButton","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.ui.editors.controls.AdvancedColorPickerPopup","mstrmojo.css");var G=mstrmojo.css,F=Math.round;function J(O){var P=this.previewNode,N=P.clientWidth,R=P.clientHeight,Q=P.offsetWidth-N,S=Math.sqrt(N*N+R*R)-Q/2,M=Math.atan2(R,N)*(-180)/Math.PI;P.style.backgroundColor="#FFFFFF";O.display="block";O.top=F((P.offsetHeight+Q)/2)+"px";O.left=F((N-S+Q)/2)+P.offsetLeft+"px";O.width=F(S)+"px";O[mstrmojo.dom.CSS3_TRANSFORM]="rotate("+F(M)+"deg)";}mstrmojo.ui.editors.controls.ColorPickerButton=mstrmojo.declare(mstrmojo.ui.editors.controls.PreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onselectedValueChange:function(){this.updatePreview();this.colorPicker.set("color",this.selectedValue);},onautoPreviewColorChange:function D(){this.getPopupWidget().set("autoPreviewColor",this.autoPreviewColor);this.updatePreview();},onenabledChange:function H(){G.toggleClass(this.domNode,"disabled",!this.enabled);}},isHostedWithin:false,showGradient:false,showNoFill:true,showAutomatic:false,autoPreviewColor:null,selectedValue:null,init:function L(N){this._super(N);var M=this.colorPicker;M.showGradient=this.showGradient;if(this.showNoFill!==undefined){M.showNoFill=this.showNoFill;M.showAutomatic=this.showAutomatic;}M.showAutomatic=this.showAutomatic;G.addWidgetCssClass(this,"mstrmojo-ColorPickerBtn");},preBuildRendering:function K(){this.colorPicker.showNoFill=this.showNoFill;return this._super();},setDimensions:function I(N,M){this._super(N,M);window.setTimeout(function(){this.updatePreview();}.bind(this),0);},afterLayout:function C(){var M=this.previewNode,N=M.style,P=N.width,O=M.offsetWidth;if(O>0){N.width=(O-4)+"px";}else{if(P!==""){N.width=(parseInt(P,10)-4)+"px";}}if(N.height===""){N.height=(M.offsetHeight-4)+"px";}},postBuildRendering:function A(){var M=this.noFillNode=document.createElement("div");M.style.display="none";M.className="slash";this.domNode.firstChild.appendChild(M);this._super();},updatePreview:function B(){var Q=this.previewNode;if(Q){var O=this.selectedValue===mstrmojo.ui.editors.controls.AdvancedColorPicker.VAL_AUTOMATIC?this.autoPreviewColor:this.selectedValue;if(O){var R=Q.style;if(O.c1){var S=G.buildGradient(O.or,O.c1,O.c2);if(S&&S.n){R[G.convertCssToCamelCase(S.n)]=S.v;}}else{var M=G.buildGradient(0,"0","0");if(M&&M.n){R[G.convertCssToCamelCase(M.n)]=null;}var P="conflict"===O;G.toggleClass(Q,"conflict",P);R.backgroundColor=!P?O:null;}if(this.showNoFill&&this.noFillNode&&this.enabled){var N=this.noFillNode.style;if("transparent"===O){J.call(this,N);}else{N.display="none";}}}Q.style.backgroundOrigin="border-box";}},getPopupWidget:function E(){return this.colorPicker;},children:[{scriptClass:"mstrmojo.ui.editors.controls.AdvancedColorPickerPopup",alias:"colorPicker",slot:"widgetHostNode",color:this.selectedValue,isHostedWithin:true,colorChanged:function(M){this.parent.set("selectedValue",M);this.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase","mstrmojo.array","mstrmojo.hash","mstrmojo.func");var S=mstrmojo.array,X=mstrmojo.hash,e=mstrmojo.func,K="mstrTestOneTierPreferences",E={};function Y(k){return k&&[k.conntp,"//",k.wsn,k.wsport?(":"+k.wsport):"","/",k.wspath,k.wstp==="j2ee"?"/servlet/taskProc":"/asp/taskProc.aspx"].join("");}function R(l){var k=E[l];if(!k){k=E[l]={};}return k;}mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy=mstrmojo.declare(mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase,null,{scriptClass:"mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy",showPreferencesEditor:function B(){mstrApp.executeCommand("showPrefsEditor");},savePreferences:function g(k){this.getSavedPreferences({success:function l(m){sessionStorage.setItem(K,JSON.stringify(X.mergeHashes(m,k)));}});},getSavedPreferences:function j(m){var k={};try{k=JSON.parse(sessionStorage.getItem(K));}catch(l){console.error("Error retrieving the saved preferences (Error: ##).".replace("##",l));}m.success(k);},deleteServerConnections:function G(k){this.getSavedPreferences({success:function l(o){var m=o.server,n=m.conn;k.forEach(function(p){n.splice(n.map(function(q){return q.id;}).indexOf(p),1);});sessionStorage.setItem(K,JSON.stringify(o));}.bind(this)});},testServerConnection:function J(k,l){window.setTimeout(function(){l.success({code:200});},2000);},loginToWebserver:function C(l,n,k,m){window.setTimeout(function(){m.success({code:401,wsn:"localhost"});},500);},loginToProxy:function D(o,n,k,l,m){window.setTimeout(function(){m.success({code:407,proxyUrl:"localhost"});},500);},authenticationCancelled:function U(){console.log("authenticationCancelled");},resumeDashboardExecution:function M(){console.log("resumeDashboardExecution");},checkForDesktopUpdates:function c(){window.alert("Checking for updates: Native code.");},showProxyEditor:function O(){window.alert("Show proxy editor: Native code.");},getSessionState:function b(p,o,l,r,s){var k=R(p),n=k[o]&&k[o][l],q=n&&n[r],m=function m(t,v){var u={taskId:"isSessionAlive",notRestartSessionManager:true,sessionState:t,connectionId:p};this.sendWebServerRequest(u,v);}.bind(this);if(q){m(q.sessionState,{success:function(t){if(t.data===-1){s.failure({statusCode:401});}else{s.success(q);}}});}else{s.failure({statusCode:401});}},getLoginFirstSessionState:function h(m,n){var l=R(m),k=l.loginFirst;if(k){n.success(k);}else{n.failure({statusCode:401});}},getProjects:function L(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"getProjectsInfo",dataFlag:2}),l);},login:function V(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"login"}),e.wrapMethods({success:function(o){var m=R(k.connectionId),n=m[k.server],p;if(!n){n=m[k.server]={};}p=n[k.port];if(!p){p=n[k.port]={};}p[k.project]=o;}.bind(this)},l));},loginFirst:function V(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"loginFirst"}),{success:function(n){var m=R(k.connectionId);if(!m){m={};m.loginFirst={};}m.loginFirst={sessionState:n.sessionState,Uid:k.Uid,Pwd:k.Pwd};l.success(m.loginFirst);}.bind(this),failure:function(m){if(l&&l.failure){l.failure(m);}}});},saveToServer:function F(k,l){l.success({did:"250BFCDB4CA5AF712A36C68E92451AB7",n:"New Dashboard",fdid:"0C77FD3642136F4728D87283759C3CE8",servletPath:"http://was-gespinola:8080/Connectivity/servlet/"});},loadCube:function d(k,l){if(!k.addDatasetToDocument){l.success({did:"D28CB3AB48BCAB8E7D9A2BA4A7C9C2A0"});}else{l.success();}},getCubeInfo:function H(k,l){window.setTimeout(function(){l.success({hsf:false,acld:false,dda:true,cs:111,mmf:2});},100);},openFromServer:function A(k,l){l.success({cubeDLInfo:{maxcs:10,cubes:[{n:"cube1",id:"1234134...1234",dda:1},{n:"cube3",id:"1234134...1234",acld:1},{n:"cube2",id:"234...1234",cs:1500}]}});},getPublicCloudSession:function N(k,l){window.setTimeout(function(){l.success({status:true,message:"",code:0,session:"sessionstate",public_url:"http://was-gespinola:8080/MstrMain/servlet/mstrWeb"});},100);},saveToPublicCloud:function W(k,l){l.success({url:"http://google.com"});},logout:function f(k,l){window.setTimeout(function(){var m=R(k.connectionId),n=m[k.server],o;if(n){n=m[k.server];o=n[k.port];if(o){o=n[k.port];delete m.loginFirst;delete o[k.project];}}l.success();}.bind(this),0);},sendWebServerRequest:function a(l,m){this.getSavedPreferences({success:function k(o){var n="http://localhost:8080/main/servlet/taskProc";if(o){var p=o.server.conn;n=Y(p[S.find(p,"id",l.connectionId)]);delete l.connectionId;}mstrmojo.xhr.request("POST","taskProc",m,l,undefined,n);}});},getObjectInfo:function Q(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"getObjectInfo"}),l);},getUserServices:function I(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"getUserServices"}),l);},saveObjectACL:function P(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"saveObjectACL"}),l);},getUserEntityInfo:function Z(k,l){this.sendWebServerRequest(X.copy(k,{taskId:"getUserEntityInfo"}),l);}});}());(function(){mstrmojo.requiresCls("mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase","mstrmojo.hash");var W=mstrmojo.hash;mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy=mstrmojo.declare(mstrmojo.onetier.vi.prefs.DesktopConnectivityProxyBase,null,{scriptClass:"mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy",showPreferencesEditor:function B(l){window.FormWrapper.showPreferencesEditor(JSON.stringify(l));},savePreferences:function e(l){mstrApp.serverRequest({taskId:"updatePreference",value:l});},getSavedPreferences:function h(l){mstrApp.serverRequest({taskId:"getPreferences"},l);},deleteServerConnections:function G(l){mstrApp.serverRequest({taskId:"deleteServerConnections",value:l});},testServerConnection:function K(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"testServerConnection"}),m);},cancelRequest:function E(m,l){mstrApp.serverRequest({taskId:"cancelRequest",id:m},l,{});},loginToWebserver:function C(m,o,l,n){mstrApp.serverRequest({taskId:"loginToWebserver",wsn:m,username:o,password:l},n,{doNotHold:true});},loginToProxy:function D(p,o,l,m,n){mstrApp.serverRequest({taskId:"loginToProxy",proxyUrl:p,username:o,password:l,saveToPrefs:m},n,{doNotHold:true});},authenticationCancelled:function S(){var l={taskId:"authenticationCancelled"};if(mstrApp.recoveryIndex!=undefined){l.recoveryIndex=mstrApp.recoveryIndex;}mstrApp.serverRequest(l,null,{doNotHold:true});mstrApp.recoveryIndex=undefined;},resumeDashboardExecution:function N(m){var p=m&&m.callback;if(p){delete m.callback;}var o=W.copy(m,{taskId:"resumeDashboardExecution"}),p=W.copy(p,{success:function n(q){if(q&&q.statusOnly!==true){mstrApp.start(q);}},failure:function l(){if(mstrApp.hideWait){mstrApp.hideWait();}}});if(mstrApp.recoveryIndex!=undefined){o.recoveryIndex=mstrApp.recoveryIndex;}mstrApp.serverRequest(o,p,{doNotHold:true});mstrApp.recoveryIndex=undefined;},checkForDesktopUpdates:function a(){window.FormWrapper.runCheckUpdate();},showProxyEditor:function P(){window.FormWrapper.showProxyEditor();},getProjects:function M(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"getProjectsInfo",dataFlag:2}),m,{silent:true});},getSessionState:function Z(n,m,l,o,p){mstrApp.serverRequest({taskId:"getSessionState",connectionId:n,isLoginFirst:false,project:o,server:m,port:l},p);},getLoginFirstSessionState:function f(l,n){var m={taskId:"getSessionState",connectionId:l,isLoginFirst:true};mstrApp.serverRequest(m,n);},login:function U(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"login"}),m,{silent:true,doNotHold:true});},usherLoginWeb:function L(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"usherLoginWeb"}),m,{silent:true,doNotHold:true});},loginFirst:function U(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"loginFirst"}),m,{silent:true,doNotHold:true});},saveToServer:function F(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"desktopImportSaveDashboard"}),m,{silent:true});},loadCube:function b(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"loadCube",keepPolling:"true",maxWait:500}),m,{silent:true});},getCubeInfo:function I(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"checkCube"}),m,{silent:true});},openFromServer:function A(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"exportDocument",executionMode:18,keepPolling:"true",executeDefaultPromptOrFail:"true"}),m,{silent:true});},getPollingStatus:function H(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"getPollingStatus"}),m,{silent:true});},shutDownDesktop:function k(m,l){mstrApp.serverRequest({taskId:"shutDownDesktop",force:!!l},m,{silent:true,doNotHold:true});},refreshNativeDialogMenu:function c(){mstrApp.serverRequest({taskId:"refreshNativeDlgMenu"},{},{silent:true});},sendWebServerRequest:function Y(m,n,l){mstrApp.serverRequest(m,n,l);},saveToPublicCloud:function V(l,m){mstrApp.serverRequest({taskId:"desktopPublishPublicDashboard",sessionState:l},m);},logout:function d(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"logout"}),m);},getPublicCloudSession:function O(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"publicCloudLogin"}),m,{silent:true});},getObjectInfo:function R(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"getObjectInfo"}),m,{silent:true});},getUserServices:function J(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"getUserServices"}),m,{silent:true});},saveObjectACL:function Q(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"saveObjectACL"}),m,{silent:true});},getUserEntityInfo:function X(l,m){mstrApp.serverRequest(W.copy(l,{taskId:"getUserEntityInfo"}),m,{silent:true});},isCurrentProject:function j(m,l){mstrApp.serverRequest({taskId:"IsCurrentProj",pn:m.project.name,sn:m.iServer.name,isp:m.iServer.port},{success:function(n){l.success(!!n.ic);},failure:function(n){mstrmojo.error({longDesc:"Failure on IsCurrentProj task "+JSON.stringify(n||{})},undefined,{zIndex:100000});}},{silent:true});},getCleanDocModel:function g(l){mstrApp.serverRequest({taskId:"createDocInstance"},W.copy({failure:function(m){mstrmojo.error({longDesc:"Failure on createDocInstance task "+JSON.stringify(m||{})},undefined,{zIndex:100000});}},l),{silent:true});}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.mstr.EnumNodeProperties","mstrmojo.fe.FilterExprTree","mstrmojo.fe.AndOrNode","mstrmojo.fe.RelationNode","mstrmojo.fe.DynamicNode","mstrmojo.fe.ConditionNode");var M=mstrmojo.expr.ET,K=mstrmojo.mstr.EnumNodeProperties;mstrmojo.fe.RelationFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RelationFilterExprTree",nodeClassMap:{14:mstrmojo.fe.AndOrNode,15:mstrmojo.fe.RelationNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},getItemIdentityProp:function(N){if(N.node&K.CONDITION){return"*";}if(N.ph){return"ph";}if((N.et===10||N.et===12)&&N.dmt===4){return M.RLS;}return N.et;},isEditable:function L(O){var N=false;switch(O&&O.et){case M.RLS:N=true;break;}return N||this._super(O);},getItemConfig:function B(Q,N,R){var O=this._super(Q,N,R),P=(Q.et===M.RLS||!!Q.relation);if(P){O.itemFunction=R.itemFunction;}return O;},newCondition:function F(P){var O=this.getSelectedItemWidget(),N=0;if((typeof microstrategy!=="undefined")&&microstrategy.bones&&microstrategy.bones.rwb_viewer){N=microstrategy.bones.rwb_viewer.nextPhIndex;}else{if(mstrApp&&mstrApp.docModelData&&mstrApp.docModelData.phIndex){N=mstrApp.docModelData.phIndex;}}if(P&&P.ph&&!P.ph.idx){P.ph.idx=N++;}if(O&&O.selected&&O.newCondition){return O.newCondition(P);}else{return this._super(P);}},createSet:function E(O,N){var P=N.rq,Q=N.cq;if(P&&Q){this.remove(Q);if(N.isMetric){mstrmojo.hash.copyProps(["applySubExpr","dmy","dmt","relation","useSchema"],P,Q);P=Q;}else{P.nds=[Q];}this.add([P],O[0]);}},removeSet:function I(N){var O=N.data,P=[O];this.remove(O);if(O.nds&&O.nds.length>0){P=O.nds;}else{delete O.dmy;delete O.relation;delete O.applySubExpr;delete O.relation;delete O.useSchema;delete O.dmt;}this.add(P,0);},nameFactory:{counter:1,names:{},clear:function(){this.resetCounter();this.names={};},resetCounter:function D(){this.counter=1;},isNameExist:function J(N){return !!this.names[N];},setName:function H(N,O){this.names[N]=O;},changeName:function C(O,N,P){this.removeName(O);this.setName(N,P);},getNewName:function G(Q,P,S){var R=P||"",O=S||"",N;while(this.isNameExist(R+this.counter+O)){this.counter++;}N=R+this.counter+++O;this.names[N]=Q;return N;},removeName:function A(N){delete this.names[N];this.resetCounter();}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Editor");var B=null;function A(D){if(!B){B=new mstrmojo.IVEDatasetPicker({onRender:function C(){var F=false;this.btnImport.set("visible",F);this.newLabel.set("visible",F);this.useExistingLabel.set("visible",F);this.btnHBox.destroyChildren();var E=mstrmojo.Button.newWebButton(mstrmojo.desc(8708,"OK"),function(){B.close(B.item);},true);E.cssText="margin-right: 10px";E.bindings={enabled:function(){return !!this.parent.parent.item;}};var G=mstrmojo.Button.newWebButton(mstrmojo.desc(221,"Cancel"),function(){B.close();},false);this.btnHBox.addChildren([E,G]);}});B.render();}B.onClose=function(E){if(E){D(E);}};B.open();}mstrmojo.vi.ui.SelectDatasetWizardEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.SelectDatasetWizardEditor",title:mstrmojo.desc(11677,"Select a Dataset"),cssClass:"mstrmojo-SelectDatasetWizardEditor",callback:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11678,"Selecting Existing Dataset"),cssClass:"SelectDatasetWizardEditor-h1"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11679,"Browse Dataset..."),cssClass:"SelectDatasetWizardEditor-entry",onclick:function(){var C=this.parent;A(function(D){C.callback(D);});}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11680,"Import New Data"),cssClass:"SelectDatasetWizardEditor-h2"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3250,"File..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11681,"URL..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11480,"Database..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3190,"Freeform SQL"),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11682,"Salesforce..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11683,"More Data Sources..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11684,"Create New Dataset"),cssClass:"SelectDatasetWizardEditor-h2"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11685,"Enter Data Manually..."),cssClass:"SelectDatasetWizardEditor-entry"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11686,"Browse All Objects..."),cssClass:"SelectDatasetWizardEditor-entry last"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Close",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.close();}}]});})();(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.string","mstrmojo.fe.RelationNode","mstrmojo.fe.RelationFilterExprTree","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumNodeDimty","mstrmojo.Box","mstrmojo.ui.Pulldown","mstrmojo.Label","mstrmojo.vi.ui.toolbars.TitleToolbar","mstrmojo.vi.ui.toolbars._HasToolbar");mstrmojo.requiresDescs(2790,5895,5896,7931,12036,12037,15121,15122);var F=mstrmojo.hash,A=mstrmojo.array,G=mstrmojo.mstr.EnumDSSXMLObjectTypes,H=mstrmojo.mstr.EnumNodeDimty,C=mstrmojo.css,E=mstrmojo.string,D=function(P){var Q=P.data,O=Q.dmy&&Q.dmy.uts||[],L=O.length,K=[],N,M;for(N=0;N<L;N++){K.push(E.encodeHtmlString(O[N].n));}M=K.join(", ");return'<span class="mstrmojo-text" title="'+M+'">'+M+"</span>";};var I=function(){var M=mstrmojo.desc(2790,"Set of ##"),L=M.split("##")[0];var K=L.length;if(K>0&&L[K-1]===" "){L+="&nbsp;";}return L;};mstrmojo.vi.ui.editors.fe.RelationNode=mstrmojo.declare(mstrmojo.fe.RelationNode,[mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.editors.fe.RelationNode",markupString:'<div id="{@id}" class="mstrmojo-relation {@cssClass}"  style="position:relative;{@cssText}" mstrAttach:mousedown><div class="mstrmojo-onhoverparent mstrmojo-relation-prefix {@cssClass}"><span class="mstrmojo-textset mstrmojo-relation-prefix-text" mstrAttach:click></span><span class="mstrmojo-onhover-in mstrmojo-andor-tools {@cssClass}"><span class="mstrmojo-indent" onclick="mstrmojo.all[\'{@id}\'].ind()">'+mstrmojo.desc(5895,"Group conditions")+'</span><span class="mstrmojo-outdent" onclick="mstrmojo.all[\'{@id}\'].out()">'+mstrmojo.desc(5896,"Ungroup Conditions")+'</span></span></div><div class="mstrmojo-relationNode"><div class="mstrmojo-relationNode-inf"><div class="mstrmojo-relation-prefix-text">'+I()+'</div><div class="mstrmojo-textset"  mstrAttach:click></div><div class="mstrmojo-relation-prefix-text">'+(mstrmojo.desc(2790,"Set of ##").split("##")[1]||"")+'</div><div class="mstrmojo-relation-postfix-text">'+mstrmojo.desc(15121,"filtered by")+'</div><div class="mstrmojo-relation-related-by-box"></div><div class="mstrmojo-relation-toolbar"></div><img class="mstrmojo-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(7931,"Delete condition")+'"onclick="mstrmojo.all[\'{@id}\'].del()" /></div><div class="mstrmojo-relation-childTreeNode" style="position:relative;"></div></div></div>',markupSlots:{prefixHoverNode:function(){return this.domNode.firstChild;},prefixNode:function(){return this.domNode.firstChild.firstChild;},relationNode:function(){return this.domNode.lastChild;},textNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[1];},relatedByBoxNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[4];},toolbarNode:function(){return this.domNode.childNodes[1].firstChild.childNodes[5];},containerNode:function(){return this.domNode.childNodes[1].childNodes[1];}},markupMethods:{onprefixedAndOrEditableChange:function(){C.toggleClass(this.prefixNode,["editable"],this.prefixedAndOrEditable);},onselectedChange:function(){C.toggleClass(this.relationNode,["selected"],this.selected);},ondataChange:function(){this.prefixNode.innerHTML=this.andOrTxt();this.textNode.innerHTML=D(this);}},children:[{scriptClass:"mstrmojo.fe.RelationFilterExprTree",alias:"childTree",ignoreLayout:true,dropZone:false,draggable:false,nodeClassMap:{14:mstrmojo.fe.AndOrNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},onNew:function(K){this.parent.tree.onNew(K);},getItemConfig:function(N,K,O){var L=mstrmojo.fe.RelationFilterExprTree.prototype.getItemConfig.call(this,N,K,O),M=O.tree||O;return F.copy({tree:M,rootTree:this.parent.tree,noRelation:true,inRelation:true,onremove:function(){if(this.rootTree&&this.rootTree.onremove){this.rootTree.onremove();}},onadd:function(){if(this.rootTree&&this.rootTree.onadd){this.rootTree.onadd();}}},L);},prenodeclick:function(K){if(!K||!K.part){return ;}var L=this.rootTree;if(L&&L.onnodeclick&&this.editable){K.editor=L.editor;L.onnodeclick.call(this,K);}}},{scriptClass:"mstrmojo.Box",alias:"relBox",slot:"relatedByBoxNode",cssClass:"RelatedBy-Box",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12036,"Related by"),cssClass:"Label",cssDisplay:"inline-block"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"relPd",cssClass:"Pulldown",cssDisplay:"inline-block",isHostedWithin:false,allowHTML:false,onitemSelected:function B(O){var N=this.parent.parent,L=N.data,K=null;if(this.selectedIndex>0){K={n:O.n,did:O.did,t:O.t||G.Metric,st:O.st||1024};}L.dmt=H.NodeDimtyOutputLevel;L.dmy=L.dmy||{};var M=L.relation=L.relation||{};if(K){M.guide=K;L.useSchema=false;}else{delete M.guide;delete M.rsTp;delete M.joTp;delete M.paTp;delete M.erTp;L.useSchema=true;}N.set("data",L);}}]},{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",slot:"toolbarNode",alias:"toolbar",visible:true,hasContextMenuButton:true,cssClass:"relation-toolbar",cssDisplay:"inline-block"}],_set_data:function(N,S){var O=this._super(N,S);var L=this.data,P=!L.m,K=this.relBox.relPd,Q=A.filter(this.tree.editor.targetMetrics,function(V){return !V.um;}),U=[{n:mstrmojo.desc(12037,"System Default"),t:-1,did:"default"}].concat(Q);this.relBox.set("visible",P);if(P){var R=0;if(L.relation&&L.relation.guide){var M=L.relation.guide;R=A.find(U,"did",M.did);}if(R!==K.selectedIndex){K.set("items",U);K.set("selectedIndex",R>=0?R:0);}}return O;},updateToolbar:function J(K){var L=this;if(this._super){K=this._super(K);}K.addMenuItem(mstrmojo.desc(15122,"Convert to Condition"),"convert",function(){L.parent.removeSet(L);});K.isHostedWithin=false;return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.Pulldown","mstrmojo.string","mstrmojo.ui.ButtonBar","mstrmojo.ui.editors.controls.ComboBox","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.NumGroupStepperContentProvider","mstrmojo._FormatDefinition","mstrmojo.models.FormatModel");var C=mstrmojo.string,H=mstrmojo._FormatDefinition,V=mstrmojo.models.FormatModel,L=V.ENUM_PROPERTY_NAMES,K=1,G=2,P=4,F=8,J=16;var R;var M;var I={bold:L.FONT_WEIGHT,italic:L.FONT_STYLE,underline:L.UNDERLINE,strikeout:L.LINE_THROUGH};function D(W){return(W&J)>0;}function S(X){var b=L.FONT_FAMILY,W=X&&(X[b]||V.getFormatBlockValue(X,b)),Z=this.hcgControls.fontFamily,Y=this.getFontFamilyItems();if(W===-1){var a=Z&&Z.list;if(!a){return ;}a.clearSelect();delete Z.selectedIndex;if(Z.hasRendered){Z.refresh();}}else{if(Y){Z.set("selectedIndex",Math.max(Y.map(function(c){return c.n;}).indexOf(W)));}}}function Q(W){var X=[],Y=function(b,c,Z){var a=W[b];if(a===undefined){a=V.getFormatBlockValue(W,b);}if(a){X.push(Z);}};Y(L.FONT_WEIGHT,"bold",0);Y(L.FONT_STYLE,"italic",1);Y(L.UNDERLINE,"underline",2);Y(L.LINE_THROUGH,"line-through",3);this.hcgControls.fontStyle.select(X);}function N(W){var c=this.hcgControls,Z=L.FONT_SIZE,X=L.COLOR,b=W[Z]||V.getFormatBlockValue(W,Z),Y=c.fontSize;var a=W[X];if(typeof a==="undefined"||a===null){a=V.getFormatBlockValue(W,X);}if(typeof a==="undefined"||a===null){a="";}if(D(this.visibleControls)){if(b.length){Y.provider.set("curValGroup",b);}}else{if(b===-1){Y.list.clearSelect();Y.selectedValue="";Y.updatePreview();}else{Y.set("selectedValue",b?(parseInt(b,10)).toString():Y.items[0].n);}}c.fontColor.set("selectedValue",a===""?"conflict":V.decodeValue(L.COLOR,a));}function O(){if(R&&M){return ;}R=H.SizesInVI.map(function(W){return{idx:parseInt(W.n,10),n:W.n};});M=mstrmojo._FormatDefinition.Families.slice(1).map(function(W){return{n:W.n,id:W.n,preview:!W.symbolic};});}mstrmojo.ui.editors.controls._HasCharacterGroup=mstrmojo.provide("mstrmojo.ui.editors.controls._HasCharacterGroup",{_mixinName:"mstrmojo.ui.editors.controls._HasCharacterGroup",visibleControls:K+G+P,showNoFillInColor:true,hcgControls:null,getFontFamilyItems:function A(){return M;},getFontStyleItems:function U(){return[{n:mstrmojo.desc(2718,"Bold"),id:"b",css:"bold"},{n:mstrmojo.desc(2719,"Italic"),id:"i",css:"italic"},{n:mstrmojo.desc(2720,"Underline"),id:"u",css:"underline"},{n:mstrmojo.desc(3062,"Strikeout"),id:"s",css:"strikeout"}];},getHCGControls:function E(Z){O();var X=this.hcgControls={},W=this.visibleControls;if((W&K)>0){X.fontFamily=mstrmojo.ui.Pulldown.newPulldown(this.getFontFamilyItems(),function(b,c){Z(L.FONT_FAMILY,b.id,c&&c.id);},0,{isHostedWithin:false,scrollNodeMaxHeight:350,getPopupListConfig:function Y(){var b=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);b.getItemProps=function c(f,d){var e=mstrmojo._IsList.getItemProps.call(this,f,d);e.style=f.preview?"font-family:'"+C.encodeHtmlString(f.n,true)+"';":"";return e;};return b;}});}if((W&G)>0||(W&F)>0){var a=X.fontStyle=new mstrmojo.ui.ButtonBar({hasSpacing:true,multiSelect:true,items:this.getFontStyleItems(),postselectionChange:function(b){var d=b.added,e=this.items[d?d[0]:b.removed[0]],c=!!d;if(e){Z(I[e.css],c,!c);}}});if((W&F)>0){a.items.pop();}}if((W&P)>0){X.fontSize=D(W)?new mstrmojo.ui.editors.controls.Stepper({provider:new mstrmojo.NumGroupStepperContentProvider({item:{interval:1},curValGroup:[],min:Math.min.apply(Math,R.map(function(b){return b.idx;})),max:Math.max.apply(Math,R.map(function(b){return b.idx;})),container:this,onTraverse:function(){var b=this.container.fontSize;if(b._sync){return ;}this.container.raiseFormatValueChange(L.FONT_SIZE,b.provider.getValGroup());},oncurValGroupChange:function(){var b=this.container.fontSize;if(b.textNode){b.updateDisplayText();}}})}):new mstrmojo.ui.editors.controls.ComboBox({selectedValue:"10",items:R,isHostedWithin:false,validateTextInput:function(b){return(/^[0-9]+(pt)?$/.test(b));},updateSelection:function(){this.set("selectedValue",parseInt(this.txtLabel.value,10).toString());},postselectedValueChange:function(b){Z(L.FONT_SIZE,parseInt(b.value,10)+"pt",parseInt(b.valueWas,10)+"pt");}});X.fontColor=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:this.showNoFillInColor,selectedValue:"#000000",postselectedValueChange:function(b){Z(L.COLOR,b.value,b.valueWas);}});}return X;},setFormatSource:function B(W){var X=this;this.syncControls(function(){var Y=this.visibleControls;if((Y&K)>0){S.call(X,W);}if((Y&G)>0||(Y&F)>0){Q.call(X,W);}if((Y&P)>0){N.call(X,W);}});}});mstrmojo.ui.editors.controls._HasCharacterGroup.CTRL_FLAGS={FONT_FAMILY:K,FONT_STYLE:G,FONT_SIZE_AND_COLOR:P,FONT_STYLE_NO_STRIKEOUT:F,FONT_SIZE_USE_STEPPER:J};mstrmojo.ui.editors.controls._HasCharacterGroup.ControlsType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.hash","mstrmojo.array","mstrmojo.ValidationTextBox","mstrmojo.expr");var K=mstrmojo.emptyFn,B=mstrmojo.hash,H=mstrmojo.array,I=mstrmojo.expr.DTP,F={FILL_COLOR:"Clr",FILL_TRANSPARENT:"FillTrans"},C=1,J=2;function N(U,Q,P,S,R){return{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",alias:"fillColor",slot:U,showNoFill:S!==false,showAutomatic:!!R,showGradient:false,selectedValue:"#000000",isHostedWithin:Q||false,postselectedValueChange:function(V){if(this.propName&&this.parent&&this.parent.parent){this.parent.parent.raiseFormatValueChange(this.propName,V.value,V.valueWas);}},postclick:function(V){this.parent.parent.postclick(V);}};}function O(Q){return{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:"fillAlpha",slot:Q,col1Width:"100%",col2Width:"10px",children:[{scriptClass:"mstrmojo.ui.editors.controls.ValidationTextBox",alias:"fillAlphaText",slot:"col1Node",value:"100",cssText:"text-align:right",dtp:I.INTEGER,required:true,constraints:{min:0,max:100},onvalueChange:function(R){this.valueWas=R.valueWas;},onValid:function P(){if(this.propName&&this.value!==this.valueWas){this.parent.parent.parent.raiseFormatValueChange(this.propName,this.value,this.valueWas);}},postclick:function(R){this.parent.parent.parent.postclick(R);}},{scriptClass:"mstrmojo.Label",slot:"col2Node",text:"%"}]};}mstrmojo.ui.editors.controls.FillConfigGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.FillConfigGroup",propNames:undefined,postclick:K,visibleControls:C+J,fillColorAndTrans:undefined,init:function M(U){this._super(U);var Q=[],X="col1Node",R=U&&U.colorPickerHostWithin,P=U&&U.showGradient,W=U&&U.showNoFill,S=U&&U.showAutomaticInColor,V;if((this.visibleControls&C)>0){Q.push(N(X,R,P,W,S));X="col2Node";}if((this.visibleControls&J)>0){Q.push(O(X));}if(Q.length===1){V={col1Width:"100%",dividerWidth:"0",col2Width:"0"};}this.addChildren([B.copy(V,{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:"fillColorAndTrans",children:Q})]);},getChildComp:function L(P){if(P.indexOf(F.FILL_COLOR)!==-1){return this.fillColorAndTrans.fillColor;}if(P.indexOf(F.FILL_TRANSPARENT)!==-1){return this.fillColorAndTrans.fillAlpha.fillAlphaText;}return undefined;},iniChildrenComp:function E(P){this.propNames=P;H.forEach(P,function(R){var Q=this.getChildComp(R);if(Q!==undefined){Q.propName=R;}},this);},setChildValue:function D(Q,R){var P=this.getChildComp(Q);if(P===undefined){return false;}switch(P.alias){case"fillColor":if(R!==P.selectedValue){P.set("selectedValue",R==="undefined"?"conflict":R);}break;case"fillAlphaText":if(R!==P.value){P.set("value",R==="undefined"?"":R);}break;}},setChildEnable:function G(R,Q){var P=this.getChildComp(R);if(P!==undefined){P.set("enabled",Q);}},setChildrenValue:function A(P){var Q=this;P.forEach(function(R){Q.setChildValue(R[0],R[1]);});}});mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS={FILL_COLOR:C,FILL_TRANSPARENCY:J};mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName=F;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.Label","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.color","mstrmojo.hash","mstrmojo.models.FormatModel");var N=mstrmojo.color,K="fillColor",C="border",B=1,I=2,D=mstrmojo.models.FormatModel,H=D.ENUM_PROPERTY_NAMES,E=H.BACKGROUND_COLOR,A={all:{c:H.BORDER_COLOR,s:H.BORDER_STYLE},top:{c:H.BORDER_TOP_COLOR,s:H.BORDER_TOP_STYLE},right:{c:H.BORDER_RIGHT_COLOR,s:H.BORDER_RIGHT_STYLE},bottom:{c:H.BORDER_BOTTOM_COLOR,s:H.BORDER_BOTTOM_STYLE},left:{c:H.BORDER_LEFT_COLOR,s:H.BORDER_LEFT_STYLE}};function G(Q,O){O.forEach(function(S,R){S.slot="col"+(R+1)+"Node";});var P=this.secondColumnWidth;return{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:Q,col1Width:(100-P)+"%",col2Width:P+"%",children:O};}function J(Q,O,P){return mstrmojo.hash.copy(P,{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",showGradient:!!O,postselectedValueChange:function(R){this.parent.parent.raiseFormatValueChange(Q,R.value,R.valueWas);}});}function F(R){var Q="transparent",O="none",P;if(R){P=R.indexOf("#");if(P===-1){P=R.indexOf(Q);}}if(!isNaN(P)&&P>-1){O=R.substr(0,P-1);Q=N.fixFullHexValue(R.substr(P));}else{O=R;}if(O.indexOf("none")>-1){O="none";}return{s:O,c:Q};}mstrmojo.ui.editors.controls.ContainerGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.ContainerGroup",borderTitle:mstrmojo.desc(13631,"Outer border"),fillColorTitle:mstrmojo.desc(7993,"Fill color"),showThickBorderStyle:true,showBackgroundNoFill:true,showBackgroundGradient:false,showBorderNoFill:true,visibleControls:B+I,targetBorder:"all",secondColumnWidth:60,init:function L(R){this._super(R);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditContainer");var Q=[],P=this.visibleControls,O=A[this.targetBorder];if((P&B)>0){Q.push(G.call(this,K,[{scriptClass:"mstrmojo.Label",text:this.fillColorTitle},J(E,this.showBackgroundGradient,{showNoFill:this.showBackgroundNoFill})]));}if((P&I)>0){Q.push(new mstrmojo.Label({text:this.borderTitle}));Q.push(G.call(this,C,[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",showThickOption:this.showThickBorderStyle,postselectedValueChange:function(S){var U=this.parent.parent;U.raiseFormatValueChange(O.s,S.value,S.valueWas);U[C].getControl(2).set("enabled",S.value!=="none");}},J(O.c,false,{showNoFill:this.showBorderNoFill})]));}this.addChildren(Q);},setFormatSource:function M(P){var O=this[K],S=this[C],R=this.targetBorder,Q=A[R];if(R==="all"){Q=A.top;}this.syncControls(function(){if(O){var W=D.decodeGradientValue(D.getGradientValues(P)),Z;if(!W){if(P[H.FILL_STYLE]===1){Z="transparent";}else{var V=P[E];if(typeof V==="undefined"||V===null){V=P["background-color"];}if(typeof V==="undefined"||V===null){V=-1;}Z=D.decodeValue(E,V);}}O.getControl(2).set("selectedValue",W||Z);}if(S){var X=P.border;if(!X){if(typeof (P.borderStyle)!=="undefined"&&P.borderStyle!==null){X=typeof (P.borderStyle)==="string"?P.borderStyle:D.decodeValue("borderStyle",P.borderStyle);}else{X=D.decodeValue(Q.s,P[Q.s]);}if(typeof P.borderColor!=="undefined"&&P.borderColor!==null){X+=" "+D.decodeValue("borderColor",P.borderColor);}else{if(typeof P[Q.c]!=="undefined"&&P[Q.c]!==null){X+=" "+D.decodeValue(Q.c,P[Q.c]);}else{X+=" "+D.decodeValue(Q.c,-1);}}}var Y=F(X),U=S.getControl(2);S.getControl(1).set("selectedValue",Y.s);U.set("enabled",Y.s!=="none");U.set("selectedValue",Y.c);}});}});mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS={FILL_COLOR:B,BORDER:I};}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo._HasMarkup","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.dom","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.css");var E=mstrmojo.css,F=mstrmojo.dom;mstrmojo.threshold.ColorBand=mstrmojo.declare(mstrmojo.ui.editors.controls.ColorPickerButton,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.threshold.ColorBand",hovered:false,selected:false,index:undefined,showGradient:false,showNoFill:false,markupString:'<div class = "color-band mstrmojo-ui-PreviewButton {@cssClass}" id="{@id}" style="{@cssText}" mstrAttach:click,keyup,contextmenu,mouseover,mouseout><div class="host mstrmojo-ui-PreviewButton"></div></div>',markupSlots:{previewNode:function(){return this.domNode;},btnNode:function(){return this.domNode;},clickableNode:function(){return this.domNode;},widgetHostNode:function(){return this.domNode.lastChild;}},select:function(){this.set("selected",true);},unselect:function(){this.set("selected",false);},onhoveredChange:function C(I){if(I.valueWas===false&&I.value===true){E.toggleClass(this.domNode,"selected",true);this.parent.onBandHovered(this.index);}else{E.toggleClass(this.domNode,"selected",false);this.parent.onBandUnhovered(this.index);}},onselectedChange:function B(I){if(I.valueWas===false&&I.value===true){E.toggleClass(this.domNode,"selected",true);this.parent.onBandSelected(this.index);}else{E.toggleClass(this.domNode,"selected",false);this.parent.onBandUnselected(this.index);}this.parent.onBandUnhovered(this.index);},onmouseover:function H(){this.set("hovered",true);},onmouseout:function D(){this.set("hovered",false);},oncontextmenu:function G(I){F.preventDefault(window,I.e);var K=this,J=K.parent.parent;var L=new mstrmojo.ui.menus.MenuConfig({position:F.getMousePosition(I.e,I.hWin),isHostedWithin:false});L.addMenuItem(mstrmojo.desc(7604,"Change Color"),"",function(){K.onclick(I);});L.addMenuItem(mstrmojo.desc(13386,"Add Color Band"),"",function(){var N=J.markers;var O=F.position(N.containerNode),M=I.e.clientX-O.x;N.addMarker(M);});L.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){K.unselect();J.bands.remove(K.index);J.update();});this.openPopup(L.newInstance());},postselectedValueChange:function(J){var K=this.parent.parent,I=K.parent,M=K.getPalette().concat();if(J){var L=J.value;if(K.getReversedValue()){M.reverse();}this.backgroundColor=M[this.index]=L;I.switchToCustomScheme(undefined,M);}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.threshold.ColorBand,{onwidthChange:mstrmojo.Widget.widthMarkupMethod,onleftChange:mstrmojo.Widget.leftMarkupMethod,onbackgroundColorChange:function A(){this.selectedValue=this.backgroundColor;this.updatePreview();this.colorPicker.set("color",this.selectedValue);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.array","mstrmojo.hash","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.LineStyleButton");var L=mstrmojo.emptyFn,I=mstrmojo.array,C=mstrmojo.hash,E=mstrmojo.gm.EnumCombinedLineStyle;var J={LINE_COLOR:"Clr",LINE_STYLE:"Style"},A={"1pt solid":E.THIN,"2pt solid":E.THICK,"1pt dashed":E.DASHED,"1pt dotted":E.DOTTED,none:E.NONE};function D(P,O){return C.copy(O,{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",alias:"lineColor",slot:P,selectedValue:"#000000",postselectedValueChange:function(Q){if(this.propName){this.parent.parent.raiseFormatValueChange(this.propName,Q.value,Q.valueWas);}},postclick:function(Q){this.parent.parent.postclick(Q);}});}function K(P){return{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",showThickOption:true,showNoneOption:true,hideDashOptions:false,defaultSelectedIndex:3,propName:undefined,alias:"lineStyle",slot:P,postInit:function O(){var Q=["mstrmojo-ui-LineStyle"];if(!this.showNoneOption){Q.push("no-none");}if(this.hideDashOptions){Q.push("no-dash");}mstrmojo.css.addWidgetCssClass(this,Q);(this.list.items||[]).forEach(function(R){R.v=(A[R.id]!==undefined?A[R.id]:A["not defined"]);});},onshowNoneOptionChange:function(Q){var R=["no-none"];if(!Q.value){mstrmojo.css.addWidgetCssClass(this,R);}else{mstrmojo.css.removeWidgetCssClass(this,R);}var S=this.hasRendered;if(S){this.refresh();}},postselectedValueChange:function(R){this._super();var Q=I.find(this.list.items,"id",R.value);if(Q===-1){Q=this.defaultSelectedIndex;}var S=this.list.items[Q].v;if(this.propName){this.parent.parent.setChildEnable(J.LINE_COLOR,S!==A.none);this.parent.parent.raiseFormatValueChange(this.propName,S,A[R.valueWas]);}},postclick:function(Q){this.parent.parent.postclick(Q);}};}mstrmojo.ui.editors.controls.LineConfigGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,null,{scriptClass:"mstrmojo.ui.editors.controls.LineConfigGroup",propNames:undefined,postclick:L,hideColorControl:false,showGradient:false,showNoFillInColor:true,showAutomaticInColor:false,showNoneOption:true,lineColorAndStyle:undefined,lineTitle:undefined,init:function N(Q){this._super(Q);var O=[],R;O.push(K("col1Node"));if(!this.hideColorControl){O.push(D("col2Node",{showGradient:this.showGradient,showNoFill:this.showNoFillInColor,showAutomatic:this.showAutomaticInColor}));}else{R={col1Width:"100%",dividerWidth:"0",col2Width:"0"};}var P=[];if(this.lineTitle&&this.lineTitle!==""){P.push(new mstrmojo.Label({text:this.lineTitle}));}P.push(C.copy(R,{scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",alias:"lineColorAndStyle",children:O}));this.addChildren(P);},getChildComp:function M(O){if(O.indexOf(J.LINE_COLOR)!==-1){return this.lineColorAndStyle.lineColor;}if(O.indexOf(J.LINE_STYLE)!==-1){return this.lineColorAndStyle.lineStyle;}return null;},iniChildrenComp:function G(P){I.forEach(P,function(R){var Q=this.getChildComp(R);if(Q!==undefined){Q.propName=R;}},this);var O=this.lineColorAndStyle.lineStyle;O.showNoneOption=this.showNoneOption;O.hideDashOptions=this.hideDashOptions;O.postInit();},onshowNoneOptionChange:function(O){this.lineColorAndStyle.lineStyle.set("showNoneOption",O.value);},setChildValue:function F(Q,R){var O=this.getChildComp(Q);if(O===undefined){return false;}var P;switch(O.alias){case"lineColor":if(R!==O.selectedValue){O.set("selectedValue",typeof R==="undefined"?"conflict":R);}break;case"lineStyle":if(typeof R==="undefined"){O.list.clearSelect();this.syncControls(function(){O.set("selectedValue","conflict");});}else{P=I.find(O.list.items,"v",R);if(P===-1){P=O.defaultSelectedIndex;}var S=O.list.items[P].id;if(S!==O.selectedValue){O.set("selectedValue",S);}}break;}},setChildEnable:function H(Q,P){var O=this.getChildComp(Q);if(O!==undefined){O.set("enabled",P);}},setChildrenValue:function B(O){O.forEach(function(P){this.setChildValue(P[0],P[1]);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.css","mstrmojo._HasLayout","mstrmojo._HasBuilder","mstrmojo._IsPanelStack","mstrmojo._IsSelectorTarget","mstrmojo.string","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.rw._IsPanelStack","mstrmojo.vi.ui.rw.DockedPanelSelector","mstrmojo.vi.ui.rw._SavesChildPositions","mstrmojo.vi.ui.tabs.PanelTabStrip","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.ui.rw._HasBufferSlice","mstrmojo.array");mstrmojo.requiresDescs(4780);var L=mstrmojo.array,b=mstrmojo.css,D=mstrmojo.string,c="#d6d6d6",O="#323335",F=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,e=mstrmojo.vi.controllers.EnumPanelManipulationType,E=mstrmojo.vi.controllers.EnumEvents;function P(j){var k=this.model,h=k.tsp,g=j.visible,f=this.selector,l=f.hasRendered;var m=(h===F.LEFT||!g)?"":(h!==F.TOP?"bottom":"top");if(l||m){this.removeChildren(f);}f.slot=m+"SelectorNode";f.set("alignPosition",h);if(l||m){this.addChildren([f]);}if(k.getCurrentLayoutKey()===k.getLayoutKeyByUnitKey(this.k)){this.doLayout();}}function Z(){var f=this.selector,h=this.model,g=h.tsp,j=f.hasRendered;var k=g===F.LEFT||!mstrApp.rootCtrl.view.isCPVisible?"":(g!==F.TOP?"bottom":"top");if(j||k){this.removeChildren(f);}f.slot=k+"SelectorNode";f.set("alignPosition",g);if(j||k){this.addChildren([f]);}if(h.getCurrentLayoutKey()===h.getLayoutKeyByUnitKey(this.k)){this.doLayout();}}mstrmojo.vi.ui.rw.DocVIVisualizationsPanelStack=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasBuilder,mstrmojo._IsPanelStack,mstrmojo.vi.ui.rw._IsPanelStack,mstrmojo.vi._MonitorsAppState,mstrmojo._IsSelectorTarget,mstrmojo.vi.ui.rw._SavesChildPositions,mstrmojo.vi.ui.rw._HasBufferSlice],{scriptClass:"mstrmojo.vi.ui.rw.DocVIVisualizationsPanelStack",markupString:'<div id="{@id}" class="mstrmojo-VIVizPanel {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIVizPanel-top-selector"></div><div class="mstrmojo-VIVizPanel-content"></div><div class="mstrmojo-VIVizPanel-selector"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{topSelectorNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},bottomSelectorNode:function(){return this.domNode.childNodes[2];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{h:{topSelectorNode:"auto",containerNode:"100%",bottomSelectorNode:"auto"},w:{topSelectorNode:"100%",containerNode:"100%",bottomSelectorNode:"100%"},xt:true},getLayoutOffsets:function Y(){return{h:2,w:2};},panels:null,model:null,selector:null,init:function U(g){this._super(g);var f=this.model;f.attachEventListener("tspChange",this.id,Z);if(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_TOC_UPDATEPOISITION)){mstrApp.rootCtrl.view.attachEventListener(E.CONTENTS_PANEL_VISIBILITY_CHANGE,this.id,P);}Z.call(this);},children:[{scriptClass:"mstrmojo.vi.ui.tabs.PanelTabStrip",alias:"selector"}],postBuildRendering:function X(){this._super();var h=this.parent,f=h&&h.defn&&h.defn.fmts,g=f&&f.fx&&f.fx.gd,j=f&&f["background-color"];if(g&&g.sc){var k=b.buildGradient(g.t,g.sc,g.ec);k&&(this.domNode.style[k.n]=k.v);}else{if(j&&!(j===c||j===O)){this.domNode.style.backgroundColor=j;}}},addChildren:function J(h,f,g,k){var j=h[0];if(j&&j.hasOwnProperty("k")){this.panels=(this.panels||[]).concat(h);if(!k){this.notifyPanelSelector();}}return this._super(h,f,g);},removeChildren:function S(h,g){if(h){var f=[].concat(h).map(function(j){return j.k;});this.panels=(this.panels||[]).filter(function(j){return f.indexOf(j.k)===-1;});}this._super(h,g);},_set_children:function V(j,h,g){if(h!==this.children){var f=this.selector;if(f){h.push(f);}}return this._super(j,h,g);},onAppStateChange:function Q(g){var l=mstrmojo.vi.VisualInsightApp.APP_STATES,f=l.PRESENTATION,h=l.PAUSE;if(g.value&f||g.valueWas&f){Z.call(this);}var k=g.value&h,j=g.valueWas&h;if(k&&!j){this.defn.set("disableSelectionApply",true);}if(j&&!k){this.defn.set("disableSelectionApply",false);}},hasDisabledSelectionApply:function R(){var f=this.defn||this.node.defn;return !!f.disableSelectionApply;},notifyPanelSelector:function H(f){this.selector.setTabs(this.panels,this.selectedKey);if(!f){this.doLayout();}},selectPanelDeferred:function(j,g,h,f){if(g!==this.selectedKey){this._super(j,g,h,f);}},onpanelSelected:function G(){this.notifyPanelSelector();this.getSelectedPanel().buildBoxLayout();},removePanel:function N(f){var g=this.panels,k=g.indexOf(f),j=g[k],h;g.splice(k,1);h=this.removeChildren(j);return h;},removePanelsByIndex:function N(g){var f=this.panels,l=this,k=[].concat(g),j=[],h;L.forEach(k,function(m){j.push(f[m]);});k.sort(function(n,m){return m-n;});L.forEach(k,function(m){f.splice(m,1);});L.forEach(j,function(m){l.removeChildren(m);m.selected=false;});},changePanelPosition:function a(j,m,l,f,k){var h=this.children,g=this.panels;g.splice(m,1);h.splice(f,1);g.splice(l,0,j);h.splice(f+l-m,0,j);this.selectedIdx=k;this.notifyPanelSelector();},sortPanels:function K(h){var g=this.children||[],f=this.panels||[];f.sort(function(k,j){return k.defn.chdidx-j.defn.chdidx;});L.forEach(f,function(j){var k=g.indexOf(j);g.splice(k,1);});L.forEach(f,function(j){g.push(j);});this.selectedIdx=h;this.notifyPanelSelector();},deletePanel:function C(g){var h=this.model,f=this;h.raiseEvent({name:E.MANIPULATE_PANEL,type:e.DELETE,panelKeys:[g.k],panelStackKey:f.k,layoutKey:h.getLayoutKeyByUnitKey(f.k)});},movePanel:function W(j,k){var h=this.model,f=this,g=f.panels[j];h.raiseEvent({name:E.MANIPULATE_PANEL,type:e.MOVE,panelKey:g.k,panelKeys:[g.k],panelStackKey:f.k,layoutKey:h.getLayoutKeyByUnitKey(f.k),fromIdx:j,toIdx:k});},renamePanel:function B(g,j){var h=this.model,f=this;h.raiseEvent({name:E.MANIPULATE_PANEL,type:e.RENAME,panelKey:g.k,panelStackKey:f.k,layoutKey:h.getLayoutKeyByUnitKey(f.k),newTitle:j,oldTitle:g.title});},addPanel:function I(){var g=this.model,f=this;g.raiseEvent({name:E.MANIPULATE_PANEL,type:e.NEW,panelStackKey:f.k,layoutKey:g.getLayoutKeyByUnitKey(f.k)});},duplicatePanel:function A(g){var h=this.model,f=this;h.raiseEvent({name:E.MANIPULATE_PANEL,type:e.DUPLICATE,panelKey:g.k,panelStackKey:f.k,layoutKey:h.getLayoutKeyByUnitKey(f.k)});},getUIState:function d(){var g={},f=this.getSelectedPanel();g.pk=f.k;g.boxState=f.getBoxState();g.viUnitKey=this.model.getSelectedViUnit()&&this.model.getSelectedViUnit().k;return g;},restoreUIState:function M(k){var f=this.getSelectedPanel(),j=k.pk;if(j&&f.k!==j){this.selectPanel(j,null,true);f=this.getSelectedPanel();}var g=k.viUnitKey;if(g){var h=f.getUnitByKey(g);if(h){this.model.selectVIUnit(h.id,true);}}var l=k.boxState;if(l!==f.getBoxState()){f.restoreBoxState(l);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.string","mstrmojo.form","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricEditBox","mstrmojo.mstr.EnumDataType","mstrmojo.ME.Enum","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.PassThroughOptions");mstrmojo.requiresDescs(218,219,221,531,628,1442,1918,2102,2116,2154,2213,2919,5298,5424,5728,5891,7558,7984,7987,11566,13249,15656);var p=mstrmojo.array,F=mstrmojo.string,t=mstrmojo.mstr.EnumDataType,A=mstrmojo.ME.MetricDataService,s=mstrmojo.mstr.EnumDSSXMLObjectTypes,W=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,H=mstrmojo.hash;function V(AA){var w=AA.items,S=w.length,z="",x;for(x=0;x<S;x++){z+=w[x].v;}return z;}var L=mstrmojo.dom,E=mstrmojo.string,R=mstrmojo._FormatDefinition,o=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,C=mstrmojo.ME.Enum.METRIC_EDIT_TYPES;var Y=function(S){if(!S){return o.VALID;}return{"-2147214845":o.ERROR,"-2147214846":o.AMBIGUITY}[S]||o.ERROR;},X=function(AD){var AA=AD.items,w=AA.length,AC=AA[AA.length-1],z,AB,x=[],S="";if(AA[0]&&AA[0].tp!==38){x.push({v:"&",tp:38,lv:4,sta:2});}for(z=0,w=AA.length;z<w;z++){AB=AA[z];if(AB.isNew&&!AB.oi&&AB.tp!==283){S+=AB.v;}else{if(!E.isEmpty(S)){x.push({v:S,tp:2,lv:1});S="";}x.push(AB);}}if(!E.isEmpty(S)){x.push({v:S,tp:2,lv:1});S="";}if(AC&&AC.tp!==-1){x.push({v:"",tp:-1,lv:4,sta:2});}return{items:x};},P=function(x){var z=X(x.tks);var w={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true},S={getArrItemName:function(AC,AA,AB){return"tkn";},isSerializable:function(AC,AB,AA){return(w[AC])?true:false;}};return E.json2xml("tknstrm",z,S);},n=function(z){var w=z.items,S=w.length,x=w[w.length-1];if(x&&x.tp===-1){w.pop();}if(w[0]&&w[0].tp===38){w.splice(0,1);}},q=function(S){return"";},l=function(S,x){var w=[];S.oi.tks.items=w;x.clearTokens(w);},M=function(AB,AA){var z=[];z.push("<mt>");if(AB.fmt&&!AA){var S={getArrItemName:function(AE,AC,AD){return AE.substr(0,AE.length-1);},isSerializable:function(AJ,AH,AG){if(mstrmojo.array.indexOf(["header_format","grid_format"],AJ)>-1){var AK=AH[AG][AJ];if(!AK){return{};}var AE="<"+AJ+">",AI;for(AI in AK){AE+="<prs n='"+AI+"'>";var AD=AK[AI],AC;for(AC in AD){var AF=AD[AC];AE+="<pr n='"+AC+"' v='"+(AF==="pru"?"":AF)+"'";AE+=AF==="pru"?' pru="1"':"";AE+="/>";}AE+="</prs>";}AE+="</"+AJ+">";return{child:AE};}return true;},skipNull:true};z.push(E.json2xml("fmt",AB.fmt,S));}if(AB.prss&&!AA){var x={getArrItemName:function(AE,AC,AD){return AE.substr(0,AE.length-1);},isSerializable:function(AJ,AG,AE){if(mstrmojo.array.indexOf(["AnalyticalEngineProperties","DatamartProperties","VLDBSelect","VLDBFunction","VLDBReport"],AJ)>-1){var AF=AG[AE][AJ];if(!AF){return{};}var AD=[],AH=[],AI;AD.push("<prs n='"+AJ+"' ");for(AI in AF){var AC=AF[AI];if(AC!=null){if(typeof AC==="object"){AH.push(E.json2xml("pr",AC,{skipNull:true,convertBoolean:true,isSerializable:function(AM,AL,AK){return true;}}));}else{AD.push(AI+"='"+AC+"' ");}}}AD.push(">");AD.push(AH.join(""));AD.push("</prs>");return{child:AD.join("")};}return true;},skipNull:true};z.push(E.json2xml("prss",AB.prss,x));}if(AB.mps){z.push(E.json2xml("mps",AB.mps,{skipNull:true,convertBoolean:true,isSerializable:function(AE,AD,AC){return true;}}));}if(AB.datp&&!AA){z.push(E.json2xml("datp",AB.datp,{skipNull:true,convertBoolean:true,isSerializable:function(AE,AD,AC){return true;}}));}if(AB.sbs&&!AA){var w={getArrItemName:function(AE,AC,AD){return(AE==="avs")?"sb":AE.substr(0,AE.length-1);},isSerializable:function(AE,AD,AC){return true;},skipNull:true};z.push(E.json2xml("sbs",AB.sbs,w));}z.push("</mt>");return z.join("");},G=function(w,S){w.set("enabled",!S);var x="mstrmojo-InlineWaitIcon";if(w.iconClass){w.set("iconClass",w.iconClass.replace(new RegExp(x),"")+" "+(S?x:""));}else{mstrmojo.css.toggleClass(w.domNode,x,S);}},I=function(w,S){var x={taskId:"saveMetricDefinition",tokenStreamXML:P(w),localSymbolFolderXML:q(w),metricXML:M(w),metricId:w.did||"",outputFlags:327695,description:w.desc||"",name:w.n||"",saveAs:S};if(E.isEmpty(w.metricId)){x.isNew=true;}return x;},O=function(x){var w=function(z){var AB=this.parent;var AA=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##","Object").replace("'###'","");if(AB){AB.ob.refreshContent();AB.onObjectSaved({name:AB.name,did:z.did,desc:AB.desc});AA=mstrmojo.desc(7987,"The ## '###' has been saved successfully.").replace("##",AB.typeDesc||"Object").replace("###",AB.name);}mstrmojo.alert(AA,x.onSaved,mstrmojo.desc(7984,"Object Saved"));if(AB){AB.close();}x.dirty=false;},S={success:w,failure:mstrmojo.SaveAsEditor.SAVEAS_CALLBACK.failure};return S;},K=function K(AD){var z=AD.items,S;for(var x=0;x<z.length;x++){var AE=z[x];if(AE&&AE.oi&&A.hasLookupForAttributesProps(AE.oi.did)){var AC=z[x+1];if(AC.v==="<"){var AA=false;for(var AB=x+2;AB<z.length&&z[AB].v!==">";AB++){var w=z[AB];if(w&&w.v==="UseLookupForAttributes"){AA=true;break;}}if(!AA){S=x+2;z.splice(S,0,{v:"UseLookupForAttributes"},{v:"="},{v:"False"},{v:","});x=x+5;}}else{S=x+1;z.splice(S,0,{v:"<"},{v:"UseLookupForAttributes"},{v:"="},{v:"False"},{v:">"});x=x+5;}}}},N=function(AD,AA){var x=this;G(x,true);var AE=mstrmojo.ME._MetricEditorHelper.oi=AD.oi,z=P(AE),AB=q(AE),AC=M(AE,true),AF=function(AI){if(AI&&AI.tks){var AJ=AI.tks;n(AJ);var AH=AJ.items;if(mstrApp&&mstrApp.isVI){AE.conditions=[];var AG=mstrApp&&mstrApp.getRootController().docCtrl.model;p.forEach(AH,function(AM){var AN=AM.oi,AO=AN&&AN.t,AK=AN&&AN.st,AL=AN&&AN.did;if(AO===s.Filter&&AK===W.Filter){var AP=AG.getEmbeddedFilter(AL);if(AP){AN.isEmbedded=true;AE.conditions.push(AP);}}});}AE.tks=AJ;if(AD.clientSideValidation){AD.clientSideValidation(AJ);}AD.checkEditorFallback(AD.ide.candidates.items,AE);AJ.vs=Y(AJ.rjec);AD.set("vStatus",AJ.vs);AD.set("iStatus",AJ.rjed||"");if(AD.handleValidation){AD.handleValidation(AJ);}if(AA&&(AJ.vs===o.VALID)){K(AJ);switch(AA){case"save":case"saveAs":if(AD.isDME){AD.handleDerivedMetricAction(AA,AE);}else{AD.handleMetricAction(AA,AE);}break;case"switch":if(AD.cbSwtichEditor){AD.cbSwtichEditor(AD);}break;}}else{if(AA&&AJ.vs===o.ERROR){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));}}}},w=function(AG){mstrmojo.alert(AG.message||AG.getResponseHeader("X-MSTR-TaskFailureMsg"));},S=function(AG){G(x,false);};A.validateMetric({tokenStreamXML:z,localSymbolFolderXML:AB,metricXML:AC,metricId:AE.did,isNew:E.isEmpty(AE.did),msgID:AD.ide.isDME?mstrApp.getMsgID():null},{success:AF,failure:w,complete:S});},D=function(w,z){var AA=z,S=AA.oi.fmt,x=R.MetricFormatTarget;G(w,true);window.setTimeout(function(){if(!S){S=AA.oi.fmt={};var AB;for(AB=0;AB<x.length;AB++){S[x[AB].p]={};}}var AC=L.position(w.domNode,true);AA.openPopup("formatPopupRef",{zIndex:AA.zIndex+10,model:S,left:Math.max(0,(AC.x-(AA.formatPopupRef.width||565)))+"px",top:AC.y+"px"});G(w,false);},50);},j=function(x,z){var AA=z,S=AA.oi,w=function(){var AB=L.position(x.domNode,true);AA.openPopup(mstrmojo.all.mstrMEOptionsDialog||"optionPopupRef",{zIndex:AA.zIndex+10,model:S,funcs:AA.funcs,left:Math.max(0,(AB.x-(AA.optionPopupRef.width||565)))+"px",top:AB.y+"px"});};if(!AA.isDME&&!AA.funcs){G(x,true);A.getSubtotalFunctions(null,{success:function(AB){if(AB.items){AA.funcs=AB.items;w();G(x,false);}},failure:function(AB){mstrmojo.alert(AB.message||AB.getResponseHeader("X-MSTR-TaskFailureMsg"));G(x,false);}});}else{w();}},u=function(w,x){var AA=L.position(w.domNode,true),z=H.any(x.ide.datasets),S={zIndex:x.zIndex+10,left:Math.max(0,(AA.x-(x.ptoPopupRef.width||333)+AA.w/2))+"px",top:AA.y+"px",mptf:x.mptf||_getMptfFromDataset(x),dbt:z.tables[0].dbt,so_dft:z.so_dft,sim_dft:z.sim_dft,onOK:function(AC){x.mptf=AC;var AB=_getMptfFromDataset(x);if(!H.equals(AB,AC)){AC.dirty=true;}}};x.openPopup("ptoPopupRef",S);};_getMptfFromDataset=function(x){var S=mstrApp&&mstrApp.getRootController().docCtrl.model,AA=x.oi.did,z=S.findUnitInDataSet(AA),w;if(z){w=H.clone(z.mptf);}else{w={mptso:{pru:1,v:0},mptsim:{pru:1,v:0},mptfms:""};}return w;};mstrmojo.ME._MetricEditorHelper=mstrmojo.provide("mstrmojo.ME._MetricEditorHelper",{noCache:true,useKeyDelay:true,tbBrowsable:true,functionNameRef:{scriptClass:"mstrmojo.Label",alias:"fnLabel",cssClass:"mstrmojo-ME-fct-name",bindings:{visible:function(){return !this.parent.insertMode;},text:function(){return mstrmojo.desc(5424,"Function:")+" "+this.parent.fctName;}}},nameEditBoxRef:{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",visible:false,bindings:{visible:function(){return !this.parent.insertMode&&this.parent.visible;}},onvisibleChange:function(S){if(S.value==false){return ;}var w=this;if(!w.tmr){w.tmr=window.setInterval(function(){if(w.domNode){window.clearInterval(w.tmr);delete w.tmr;w.nameInput.inputNode.select();}},50);}},children:[{alias:"nameInput",scriptClass:"mstrmojo.TextBoxWithLabel",inputNodeCssClass:"mstrmojo-ME-nameInput",value:mstrmojo.desc(2213,"New metric"),size:20,useRichTooltip:true,showErrTooltip:function v(){var w=L.position(this.domNode),S=E.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+S+"</span></div>",top:w.y-5,left:w.x+w.w+10};this.hasOpenTooltip=false;this.showTooltip();},bindings:{value:function(){var S=this.parent.visible;return this.parent.parent.oi.alias||this.parent.parent.oi.n;},label:function(){var w=this.parent.parent.ide||{},S=w.nameLabel||mstrmojo.desc(11566,"Metric Name:");return this.parent.parent.oi.alias?mstrmojo.desc(13249,"Display Name:"):S;}},onvalueChange:function(x){var S=this.parent.parent.ide.action.alias,AC=function(AD){return !E.isEmpty(AD)&&(S?true:!/[\[\]\"\\]/g.test(AD));},AB=AC(this.value);if(AB){this.hideTooltip();}else{this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!AB);var z=this.parent.parent;z.set("cValid",AB);var AA=z.oi;if(AA){var w={n:AA.n,alias:AA.alias};AA.n=this.value;AA.alias=this.value;if(AA.n!==w.n&&AA.alias!==w.alias){z.dirty=true;}}}}]},saveasRef:{scriptClass:"mstrmojo.SaveAsEditor",typeDesc:"Metric",browsableTypes:"4,8",onObjectSaved:function(x){var w=this.opener,S=w&&w.oi;if(w&&S){S.did=x.did;S.n=x.name;S.desc=x.desc;w.set("title",mstrmojo.desc(2154,"Metric:")+" "+x.name);}}},optionPopupRef:{id:"mstrMEOptionsDialog",scriptClass:"mstrmojo.ME.OptionDialog",title:mstrmojo.desc(9572,"Advanced Metric Options"),help:"Advanced_Metric_Options_dialog_box.htm",height:340},ptoPopupRef:{scriptClass:"mstrmojo.PassThroughOptions",help:"create_derived_metric_mdx_hierarchy_reports.htm",width:333},formatPopupRef:{scriptClass:"mstrmojo.ME.MetricFormatEditor",contentNodeCssClass:"mstrmojo-balloon",alias:"formatEditor",title:mstrmojo.desc(2116,"Format"),left:"100px",top:"100px",useAnimate:false,height:360,width:565,help:"Format_Metric_dialog_box.htm",locksHover:true},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",cssText:"width:200px;",fishEyeVisible:false,closeable:false,closeOnSelect:false}]},switchRef:{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"switchToMetricEdtior",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(9563,"Switch to Formula Editor"),closeAfterSwitch:true,bindings:{visible:function(){return !this.parent.insertMode;}},getEditor:function(){return this.parent;},getFormulaEditorId:function(){var S=this.getEditor();return(S.ide&&S.ide.formulaEditorId)||"mstrME";},onclick:function(){var x=this.getEditor(),w=this.getFormulaEditorId();x.oi.tks.items=x.getMetricDefAsTokens();var S={vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN,oi:x.oi,did:x.oi.did,cValid:true};if(x.dirty){S.dirty=x.dirty;}if(x.mptf){S.mptf=x.mptf;}x.switch2Editor(w,S);if(x.ide){x.ide.set("showLeftPanel",true);x.set("simple",false);}}},formatAndOptionsBarRef:{scriptClass:"mstrmojo.HBox",alias:"formatbar",cssClass:"mstrmojo-ME-formatbar",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link format",alias:"formatButton",text:mstrmojo.desc(1918,"Format"),bindings:{visible:function(){return this.parent.parent.tbFormatable&&!this.parent.parent.insertMode;}},onclick:function(){D(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"optButton",text:mstrmojo.desc(13035,"Metric Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&!S.ide.disableAFB;}},onclick:function(){j(this,this.parent.parent);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link property",alias:"ptoButton",text:mstrmojo.desc(15656,"Pass-through Options"),bindings:{visible:function(){var S=this.parent.parent;return !S.insertMode&&S.ide.enablePTO&&(S.id===((S.ide&&S.ide.formulaEditorId)||"mstrME"));}},onclick:function(){u(this,this.parent.parent);}}]},saveLabel:mstrmojo.desc(5891,"Save"),saveAsLabel:mstrmojo.desc(628,"Save As"),closeLabel:mstrmojo.desc(221,"Cancel"),saveAsEnabled:true,cValid:true,buttonBarRef:{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:"",bindings:{enabled:function(){return this.parent.parent.cValid;},text:function(){return this.parent.parent.insertMode?mstrmojo.desc(531,"Add"):this.parent.parent.saveLabel;}},onclick:function(){var w=this.parent.parent;if(!w.insertMode&&w.isDirty&&!w.isDirty()){w.close();w.onCancel();return ;}if(!w.cValid){return ;}if(w.insertMode){w.insertOnFinish(w.getMetricDefAsTokens());w.close();}else{if(w.getMetricDefAsTokens){w.oi.tks.items=w.getMetricDefAsTokens();}var S=this;if(w.validateAndSave){G(S,true);w.validateAndSave(w.oi,function(){G(S,false);});}else{if(w.ide&&w.ide.validateAndSave){G(S,true);w.ide.validateAndSave(w.oi,function(){G(S,false);});}else{w.tbValidate=this;N.call(this,w,"save");}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",alias:"btnSaveAs",text:mstrmojo.desc(628,"Save As"),bindings:{visible:function(){return !this.parent.parent.insertMode&&!this.parent.parent.isDME;},text:function(){return this.parent.parent.saveAsLabel;}},onclick:function(){var S=this.parent.parent;if(S.getMetricDefAsTokens){S.oi.tks.items=S.getMetricDefAsTokens();}S.tbValidate=this;N.call(this,this.parent.parent,"saveAs");}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.parent.closeLabel;}},onclick:function(){var S=this.parent.parent;if(S.onPreClose()){S.close();if(!S.insertMode){S.onCancel();}}}}]},validateSyntax:function B(S){N.call(S,this);},validateSyntaxAndSwitch:function c(S){N.call(S,this,"switch");},preprocessTokenStram:function U(S){n(S);},isDirty:function k(){if(this.insertMode){return false;}return this.dirty||this.oi.dirty||(this.oi.fmt||{}).dirty||(this.oi.mps||{}).dirty||(this.mptf||{}).dirty;},onmetricModify:function h(){this.dirty=true;},save:function Q(){this.buttonBar.btnSaveAs.onclick();},prompt2saveRef:{scriptClass:"mstrmojo.Editor",cssText:"width:350px;",title:mstrmojo.desc(5728,"Confirm save"),children:[{scriptClass:"mstrmojo.Label",cssText:"margin:5px 5px 20px;",allowHTML:true,bindings:{text:function(){return mstrmojo.desc(9573,"Do you want to save changes made to #?").replace("#","<b>"+mstrmojo.string.encodeHtmlString(this.parent.opener.oi.n)+"</b>");}}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"left",cssText:"width:10px;"},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(219,"Yes"),onclick:function(){var S=this.parent.parent;S.opener.save();S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(218,"No"),onclick:function(){var S=this.parent.parent;S.opener.close();if(S.opener.onCancel){S.opener.onCancel();}S.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var S=this.parent.parent;S.close();}}]}]},prompt2save:function(){if(this.getMetricDefAsTokens){this.oi.tks.items=this.getMetricDefAsTokens();}this.openPopup("prompt2saveRef",{zIndex:this.zIndex+1});},handleMetricAction:function f(x,w){var S=this;var z=I(w,false);if((x==="save")&&w.did){mstrmojo.xhr.request("POST",mstrConfig.taskURL,O(S),z);}else{if(((x==="save")&&E.isEmpty(w.did))||x==="saveAs"){z.saveAs=true;S.openPopup("saveasRef",{zIndex:S.zIndex+10,folderLinksContextId:17,name:w.n||w.name||(S.name&&S.name.value)||mstrmojo.desc(2213,"New Metric"),saveParams:z,saveAsCallback:function(){var AA=O(S);if(AA.success){var AB=AA.success;AA.success=function(AC){AB.call(this,AC);if(S.ide.noRefresh!==true){var AD=mstrApp;mstrmojo.form.send({evt:5005,src:AD.name+"."+AD.pageName+".5005"});}};}return AA;}});}}},handleDerivedMetricAction:function g(AA,z){z=z||this.oi;if(AA==="save"){var S={tokenStreamXML:P(z),alias:z.n};var w=z.mps||{};if(w.dirty){if(w.fbf===0){w.afb=w.sfb=-1;}S.afb=w.afb;S.sfb=w.sfb;}if(this.originTks){S.originTokenStream=P({tks:{items:this.originTks}});S.originAfb=this.originAfb;S.originSfb=this.originSfb;}var AB=mstrmojo.all.mstrMetricIDE,x=AB.disableAFB;if(x){S.afb=0;S.sfb=1;}if((this.mptf||{}).dirty){S.mptf=this.mptf;}AB.onApplyMetricCallback(S);AB.close();}},onPreClose:function(){var S=this;if(S.isDirty&&S.isDirty()&&!this.isDME){S.prompt2save();return false;}return true;},onClose:function a(){this.dirty=false;delete this.mptf;if(this.onPostClose){this.onPostClose();}},init:function r(x){if(this._super){this._super(x);}var z=mstrApp,S=z&&z.useQuickSearch&&z.useQuickSearch(),w=S?((z&&z.searchAutoCompleteDelay&&z.searchAutoCompleteDelay())||0):0;this.suggestDelay=w||200;this.noCache=this.noCache&&S&&!this.isDME;this.ob.children[0].quickSearch=S;A.suggestDelay=this.suggestDelay;A.noCache=this.noCache;},_setupCandidatesCache:function m(S){if(this.candidates&&S){S.candidates=null;S.set("candidates",this.candidates);}},item2textCss:function J(S){return"mstrmojo-ME-icon t"+S.t+(S.st?" st"+S.st:(S.um||S.da?"d":""));},getSpecialFunctionEditorId:function e(S,z){var x=S&&S.did,w;if(x){if(A.isBasicAggMap(x)){w="mstrSME";}else{if(A.isRank(x)){w="mstrRFE";}else{if(A.isOLAPAgg(x)){w="mstrOFE";}else{w="mstrFE";}}}if(w){w+=z?"_1":"";}}return w;},isDimty:function(w,S){return(/^@[a-z]{1,}(\s*[+-]\s*\d{1,})?$/i).test(F.trim(w));},validateByDataType:function d(w,S){var x=false;switch(w){case t.DataTypeInteger:x=/^(-)?\d+$/.test(S);break;case t.DataTypeNumeric:case t.DataTypeReal:case t.DataTypeDouble:x=mstrmojo.num.isNumeric(S);break;case t.DataTypeChar:case t.DataTypeVarChar:x=true;break;case t.DataTypeDate:case t.DataTypeTimeStamp:x=true;break;default:x=true;}return x;},getRootFunction:function b(x){var w,S=x&&x.tks&&x.tks.met;if(S!==C.ADVANCED){var z=x.tks.items[0];w=z&&z.oi;}return w;},checkEditorFallback:function Z(S,z){var w=this.getRootFunction(z),x=mstrmojo.array.find(S,"did",w&&w.did)===-1;if(x&&z&&z.tks&&z.tks.items&&z.tks.items.length>0){z.tks.met=C.ADVANCED;}return x;}});mstrmojo.ME._MetricEditorHelper.getTokenStreamXML=P;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui.tabs.Tab","mstrmojo.Label","mstrmojo.Button","mstrmojo.Pulldown","mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.tooltip","mstrmojo.ME.MetricEditBox","mstrmojo.array","mstrmojo.hash","mstrmojo.mstr.EnumDSSXMLBaseFormType");var f=mstrmojo.array,N=mstrmojo.hash,M=mstrmojo.ME.MetricToken.brackets,B=mstrmojo.css,S=mstrmojo.vi.ui.tabs.Tab.ACTIONS,n=S.DELETE+S.RENAME,o=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,p=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_CSS,O=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS_DESC,W=mstrmojo.mstr.EnumDSSXMLObjectTypes,D=mstrmojo.string,r="This@ID",Y="45C11FA478E745FEA08D781CEA190FE5",V=mstrmojo.mstr.EnumDSSXMLBaseFormType,t=[{n:mstrmojo.desc(959,"Default"),v:V.DssXmlBaseFormReserved},{n:mstrmojo.desc(12276,"String"),v:V.DssXmlBaseFormText},{n:mstrmojo.desc(2052,"Date"),v:V.DssXmlBaseFormDate},{n:mstrmojo.desc(3434,"Number"),v:V.DssXmlBaseFormNumber}],Z=function(){var x="analytical_engine_version.htm",w=mstrApp.showHelpTopic;if(w){w(x,"upgrade");}else{window.open(mstrmojo.upgradeHelpPath()+x,"_blank");}};function H(w){return{n:w,k:w,ftk:[],vs:1,is:"",bft:V.DssXmlBaseFormReserved,bftp:V.DssXmlBaseFormReserved};}function Q(AD,AE,w,AB){var z=AD.forms[AE]||{},AC=AD.forms[w],x=AD.inputBox,AA=AD.statusBox.pulldownBox.pulldown;if(AE!==w){z.vs=AD.vStatus;z.is=AD.iStatus;z.bft=AD.formType||AA.getSelectedItem().v;z.bftp=AD.formType||AA.getSelectedItem().v;z.ftk=x.items;AD.set("vStatus",o.UNKNOWN);}AD.set("vStatus",AC.vs);AD.set("iStatus",AC.is);AD.updateInputBoxItems({items:AC.ftk});if(AD.curFormIdx!==w){AD.curFormIdx=w;AD.tabstrip.setSelectedTab(AC.k);}AA.set("selectedIndex",f.find(AA.items,"v",AC.bft));AD.raiseEvent({name:"tabSwitch",tks:AC.ftk,vs:AC.vs,is:AC.is,bft:AC.bft,bftp:AC.bftp,oidx:AE,nidx:w,toNewTab:AB});}function P(x){var w=x.forms[x.curFormIdx];if(w){w.ftk=x.inputBox.items;w.vs=x.vStatus;w.is=x.iStatus;}}var m=0;function c(w){m=Math.max(w.length-1,m);}function b(){m=0;}function s(w){var x="DESC"+(m?" "+m:"");m++;if(f.find(w,"n",x)>=0){return s(w);}return x;}function J(AA){var z={v:M(AA.n),oi:AA,isNew:true},x,w;if(AA.t===12){x=f.filter(AA.fs,function(AB){return AB.obf||AA.da;}).length;if(x===1){w=AA.fs[0];z=N.copy({v:M(AA.n)+"@"+M(w.fnm),ift:true,exv:w.fid,extp:8},z);}else{z=N.copy({v:M(AA.n)+"@",ift:true},z);}}return z;}function E(x,w){x.set("enabled",!w);var z="mstrmojo-InlineWaitIcon";if(x.iconClass){x.set("iconClass",x.iconClass.replace(new RegExp(z),"")+" "+(w?z:""));}else{mstrmojo.css.toggleClass(x.domNode,z,w);}}function L(w){return w.tp===33||w.tp===37;}function F(w){return w.tp===-1;}var a=function(AD){var AB=AD.items,x=AB.length,AA,AC,z=[],w="";z.push({v:"!",tp:33,lv:4,sta:2});for(AA=0;AA<x;AA++){AC=AB[AA];if((AA===0&&L(AC))||F(AC)){continue;}if(AC.isNew&&!AC.oi){w+=AC.v;}else{if(!D.isEmpty(w)){z.push({v:w,tp:2,lv:1});w="";}if(AC.v&&AC.v.indexOf(r)>=0){AC.v=AC.v.replace("["+r+"]",r);AC.exv=Y;AC.extp=8;delete AC.oi;}z.push(AC);}}if(!D.isEmpty(w)){z.push({v:w,tp:2,lv:1});w="";}z.push({v:"",tp:-1,lv:4,sta:2});return{items:z};},g=function(z){var w=z.items||[],x=w[w.length-1];if(x&&x.tp===-1){w.pop();}if(w[0]&&L(w[0])){w.splice(0,1);}f.forEach(w,function(AA){if(AA.v&&AA.v.indexOf(r)>=0){N.copy({extp:8,exv:Y,oi:{n:"This",did:"This",t:12}},AA);}});},e=function(w){if(!w){return o.VALID;}return{"-2147214845":o.ERROR,"-2147214846":o.AMBIGUITY}[w]||o.ERROR;},U=function(z){z=a(z);var x={items:true,v:true,tp:true,lv:true,oi:true,n:true,did:true,t:true,st:true,exv:true,extp:true,asc:true,vtp:true},w={getArrItemName:function(){return"tkn";},isSerializable:function(AA){return(x[AA])?true:false;}};return D.json2xml("tknstrm",z,w);},G=function(z,AC,AB,x){var AA=U(AC),AD=function(AE){if(AE&&AE.tks){var AF=AE.tks;g(AF);AF.vs=e(AF.rjec);AF.tokenXML=AA;if(x){x(AF);}}},w=function(AE){mstrmojo.alert(AE.message||AE.getResponseHeader&&AE.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.validateMetric({tokenStreamXML:AA,localSymbolFolderXML:"",metricXML:"",metricId:z||"",isNew:true,objectType:12,isIDForm:AB,msgID:mstrApp.getMsgID()},{success:AD,failure:w});};mstrmojo.ME.DerivedAttributeFormTab=mstrmojo.declare(mstrmojo.vi.ui.tabs.Tab,null,{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",valid:true,editable:true,postBuildRendering:function X(){if(this._super){this._super();}var w=this,x=w.lbl;x.editOnDoubleClick=this.editable;x.onTextEditComplete=function(AA,z){if(w.validate(x.text)){w.titleEdited(x.text,z);}};},onclick:function l(w){var x=mstrmojo.dom.eventTarget(w.hWin,w.e);if(x===this.menuBtnNode){this.tabDeleted();}else{if(!this.isSelected){this.tabSelected();}}},validate:function(w){var x=!/[\[\]\"\\]/g.test(w);if(!x){this.lbl.set("isEditing",true);}this.set("valid",x);return x;},showErrTooltip:function v(AB,z){var w=mstrmojo.dom.position(this.domNode),x=this,AA=x.errTooltip;if(!AA){x.errTooltip=AA=new mstrmojo.Tooltip({contentNodeCssClass:"me-tooltip-content up me-err",updatePopupConfig:null});this.addDisposable(AA);}AA.set("top",w.y+w.h+2);AA.set("left",w.x+w.w/2-z);AA.set("content",'<div class="content"><span>'+AB+"</span></div>");AA.open();window.setTimeout(function(){AA.close();},2500);},onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.showErrTooltip(mstrmojo.desc(11569,"Input contains invalid character"),95);}}});function k(AA,AB,AC){var z=f.find(AB,"k",AC.k);return{scriptClass:"mstrmojo.ME.DerivedAttributeFormTab",title:AC.n,draggable:false,editable:z!==0,cssClass:"mstrmojo-AEB-Tab "+(z===0?"mstrmojo-AEB-IDTab":""),getMenuActions:function(){return n;},tabSelected:function(){Q(AA,AA.curFormIdx,z);},titleEdited:function x(AE,AD){if(AE!==AD){if(f.find(AA.forms,"n",AE)>=0){this.showErrTooltip(mstrmojo.desc(7209,"Name already exists"),69);}else{var AF=AA.forms[z];AF.n=AE;AA.set("dirty",true);}}},tabDeleted:function w(){var AD=AA.forms.length,AG=(AA.curFormIdx===AD-1)?0:AA.curFormIdx,AE=AA.forms.slice(0),AF=AE[z];if(AF&&AF.did){AA.delForms.push({n:AF.n,did:AF.did});}AE.splice(z,1);AA.curFormIdx=AG;AA.set("forms",AE);Q(AA,-1,AG);AA.set("dirty",true);}};}mstrmojo.ME.AttributeEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,null,{scriptClass:"mstrmojo.ME.AttributeEditBox",markupString:'<div id="{@id}" class="mstrmojo-MEBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-AEB-TabStrip"></div><div class="mstrmojo-MEBox-edit mstrmojo-AEB-edit"></div><div class="mstrmojo-AEBox-status {@statusCssClass}"></div></div>',markupSlots:{tabstripNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},statusNode:function(){return this.domNode.lastChild;}},markupMethods:{onvStatusChange:function(){var x=this.vStatus,AC=(x===o.VALID),AA=(x===o.UNKNOWN||x===o.VALIDATING),z=this.statusBox.infoBox;this.validateBtn.set("visible",AA);z.set("visible",!AA);if(!AA){z.infoLabel.set("text",AC?mstrmojo.desc(11655,"Valid formula."):mstrmojo.desc(15953,"Validation failed."));var AB=p[x],w=z.infoIcon.domNode;if(!B.hasClass(AB)){B.removeClass(w,[p[o.VALID],p[o.ERROR],p[o.AMBIGUITY]]);B.addClass(w,AB);}}},oniStatusChange:function(){var z=this.vStatus,w=(z===o.ERROR||z===o.AMBIGUITY),x=this.statusBox.infoBox.infoIcon;x.title=w?(this.getStatusDesc&&this.getStatusDesc(z))||O[z]+" "+this.iStatus:"";}},forms:null,delForms:[],curFormIdx:0,attrid:null,absorbAmbiguity:false,init:function q(AA){var AB=this,AD=function(){AB.validateCurrentForm();},z=[{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",alias:"tabstrip",position:"top",slot:"tabstripNode",isAlignRight:false,getTabCfg:function x(AG,AH,AF){return N.copy(k(AB,AG,AH),AF);},addTab:function AE(){var AH=AB.forms,AF=AH.length,AI=s(AH),AG=AH.slice(0);AG.push(H(AI));AB.set("forms",AG);Q(AB,AB.curFormIdx,AF,true);AB.set("dirty",true);},clear:function w(){f.forEach(this.children,function(AF){AF.hideTooltip();});}},{scriptClass:"mstrmojo.Button",alias:"clearBtn",slot:"tabstripNode",text:mstrmojo.desc(2827,"Clear"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll hoverLink",onclick:function(){AB.inputBox.clearTokens([]);AB.inputBox.raiseChangeEvent({type:"clear"});}},{scriptClass:"mstrmojo.Box",alias:"statusBox",slot:"statusNode",cssClass:"statusBox",children:[{scriptClass:"mstrmojo.Box",alias:"pulldownBox",cssClass:"pulldownBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-AEBox-pulldownLabel AEBox-item",text:mstrmojo.desc(9918,"Data Type")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"pulldown",cssClass:"mstrmojo-AEBox-pulldown AEBox-item",selectedIndex:0,items:t,onitemSelected:function(AI){var AF=AB.curFormIdx,AG=AB.forms,AH=AG&&AG.length>AF&&AG[AF];if(AH){if(AH.bft!==AI.v){AH.bft=AH.bftp=AI.v;AB.set("dirty",true);}}}}]},{scriptClass:"mstrmojo.Box",cssClass:"helpIcon",cssDisplay:"inline-block",richTooltip:{cssClass:"vi-regular vi-tooltip-A A-center AE-tooltip",posType:mstrmojo.tooltip.POS_TOPCENTER,enableHover:true},useRichTooltip:true,tooltipCloseDelay:500,updateTooltipConfig:function AC(){var AG=this.richTooltip,AF=mstrmojo.dom.position(this.domNode);AG.left=AF.x+AF.w-8;AG.top=AF.y+28;AG.content=mstrmojo.desc(16313,"Data Type options for derived attribute forms are only available for data engine version 11.1 and later.");AG.content+="<br /><div class='help-link-label' onclick='mstrmojo.ME.AttributeEditBox.AEHelpFn()'>"+mstrmojo.desc(9849,"Learn More")+"</div>";}},{scriptClass:"mstrmojo.Box",alias:"infoBox",cssClass:"infoBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Button",alias:"infoIcon",cssClass:"mstrmojo-AEBox-infoIcon AEBox-item",title:"",tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){var AF=mstrmojo.dom.position(this.domNode);this.richTooltip={cssClass:"vi-regular A-center vi-tooltip-A",top:Math.max(AF.y+26,0),left:Math.max(AF.x+10,0),posType:mstrmojo.tooltip.POS_TOPCENTER,content:this.title};}},{scriptClass:"mstrmojo.Label",alias:"infoLabel",cssClass:"mstrmojo-AEBox-infoLabel AEBox-item"}]}]}];this.validateFunc=AD;AB.children=z.concat(this.children);this._super(AA);},item2textCss:function K(w){return this._super(w)||{21:"afm"}[w.t]||"";},onformsChange:function d(){var w=this.forms,x=w[this.curFormIdx].k;f.forEach(w,function(z){g({items:z.ftk});});this.tabstrip.setTabs(w,x);c(w);},selectFormTab:function A(w){Q(this,this.curFormIdx,w);},postBuildRendering:function X(){if(this._super){this._super();}this.clear();var w=this;this.inputBox.ondrop=function(AB){if(!AB.src.data||!AB.src.data.item){return ;}var AA=w.inputBox,AD=AA.ctxtBuilder.itemWidgets,AE=N.copyProps(["did","n","t","fs"],AB.src.data.item),AG=J(AE),x,AF,z;AB.src.data=AG;mstrmojo.ListBase2.prototype.ondrop.call(this,AB);var AC=function(AH){return AH.t===W.Function&&!(!isNaN(AH.fdid)&&AH.fdid<0);};if(AC(AG.oi)){this.insertParenthesisTokens();}if(w.ontokensModify){w.ontokensModify();}x=this.selectedIndices;if(AE.t===12&&AG.ift&&!AG.exv){for(AF in x){z=AD[AF];if(z){AA.startTokenSuggestion(z);}}}AA.clearSelect(true);B.removeClass(AA.domNode,"unselectable");};},clear:function j(){this.curFormIdx=0;this.delForms=[];this.attrid=null;b();this.set("forms",[H("ID")]);this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",o.UNKNOWN);this.set("iStatus","");this.tabstrip.clear();},validateCurrentForm:function C(x){var z=this,AA=this.validateBtn,w=function(AB){E(AA,false);z.set("vStatus",AB.vs);z.set("iStatus",AB.rjed||"");z.updateInputBoxItems({items:AB.items});z.statusNode.style.display="block";z.handleValidation(AB);if(x){x(AB.items,AB.vs===o.VALID);}};z.set("vStatus",o.VALIDATING);E(AA,true);G(this.attrid,{items:this.inputBox.items},z.curFormIdx===0,w);},validateAllForms:function u(z){var AA=this,x=AA.forms,w=0,AB=function(AE){var AD=(w===0);if(AE){var AC=x[w-1];AC.ftk=AE.items;AC.vs=AE.vs;AC.is=AE.rjed||"";AC.tokenXML=U({items:AE.items});if(AE.vs!==o.VALID){AA.selectFormTab(w-1);AA.handleValidation(AE);if(z){z(null,false);}return ;}}if(w===x.length){if(z){z(x,true);}return ;}G(AA.attrid,{items:x[w++].ftk},AD,AB);};P(AA);AB();},continueValidataion:function R(){this.validateCurrentForm();},getStatusDesc:function h(w){return{0:mstrmojo.desc(11655,"Valid Formula.")}[w];},onObjectInsert:function I(AA){var AB=this.inputBox,z=J(AA),w=AB.insertTokens([z]),x;if(AA.t===12&&z.ift&&!z.exv){x=AB.ctxtBuilder.itemWidgets[w];if(x){AB.startTokenSuggestion(x);}}}});mstrmojo.ME.AttributeEditBox.preprocessTokenStream=g;mstrmojo.ME.AttributeEditBox.postprocessTokenStream=a;mstrmojo.ME.AttributeEditBox.mapErrorCode=e;mstrmojo.ME.AttributeEditBox.getTokenStreamXML=U;mstrmojo.ME.AttributeEditBox.validateSyntax=G;mstrmojo.ME.AttributeEditBox.prepareInsertToken=J;mstrmojo.ME.AttributeEditBox.AEHelpFn=Z;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.CollapsibleTitleBar","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.ui.menus.Menu","mstrmojo.dom","mstrmojo.css");var F=mstrmojo.css,C="visible",G="containerNode";function E(Q){Q.btn.style.display=!!Q.menuCfg?"block":"none";}mstrmojo.vi.ui._IsPanel=mstrmojo.provide("mstrmojo.vi.ui._IsPanel",{_mixinName:"mstrmojo.vi.ui._IsPanel",markupString:'<div id="{@id}" class="mstrmojo-VIPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="mstrmojo-VIPanel-titlebar"></div><div class="mstrmojo-VIPanel-content"></div><div class="mstrmojo-VIDND-mask"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.childNodes[2];},handleNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onisCollapsedChange:function L(){if(this.canCollapse){this.containerNode.style.display=this.isCollapsed?"none":"block";if(!this.isCollapsed){this.doLayout();}}}},title:"",titleBar:null,titlebarNode:null,containerNode:null,maskNode:null,handleNode:null,bubbleMouseOver:true,canCollapse:false,isCollapsed:false,autoHideToolbar:false,init:function K(Q){this._super(Q);this.addChildren([this.getTitleBarCfg()]);this.menuBtnInfo={};},skipsSlotLayout:function(Q){return Q===G&&this.isCollapsed;},getTitleBarCfg:function P(){return{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",slot:"titlebarNode",alias:"titleBar",isCollapsed:this.isCollapsed,title:this.title,close:function(){this.parent.setOpenStatus(false);mstrApp.rootCtrl.generateToolbar();},collapse:function(Q){this.parent.set("isCollapsed",Q);}};},ontitleChange:function H(){this.titleBar.set("title",this.title);},_set_children:function A(U,R,Q){if(R!==this.children){var S=this.titleBar;if(S){R.push(S);}}return this._super(U,R,Q);},preBuildRendering:function I(){this.generateToolbar();this.titleBar.setToolbarVisibility(!this.autoHideToolbar);return this._super();},generateToolbar:function B(){var Q=this.titleBar;Q.set("toolbarCfg",this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));if(!Q.visible){this.menuBtnInfo.menuCfg=Q.getMenuConfig();}},updateToolbar:function O(Q){return Q;},setOpenStatus:function N(Q){if(this.visible!==Q){this.set("visible",Q);this.parent.doLayout();}},setTitleBarVisibility:function D(Q){var S=this.titleBar;S.set("visible",Q);this.generateToolbar();var U=this.menuBtnInfo,R=U.btn;if(!R){R=U.btn=document.createElement("div");R.className="hover-menu-btn";var V=this.id;mstrmojo.dom.attachEvent(R,"click",function(){var X=mstrmojo.all[V],W=U.menuCfg;W.hostId=V;W.hostElement=R;X.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:W}));});this.domNode.appendChild(R);}U.menuCfg=Q?null:S.getMenuConfig();E(U);this.doLayout();},onmouseover:function M(Q){if(!mstrApp.isInteractive()){return ;}if(!this.bubbleMouseOver){Q.cancel();}var S=this._panelTimeout;if(S){window.clearTimeout(S);delete this._panelTimeout;}if(this.autoHideToolbar){this.titleBar.setToolbarVisibility(true);}var R=this.menuBtnInfo;if(!!R.menuCfg){F.addClass(R.btn,C);}},onmouseout:function J(){var Q=this.id;this._panelTimeout=window.setTimeout(function(){var R=mstrmojo.all[Q];if(R){if(R.autoHideToolbar){R.titleBar.setToolbarVisibility(false);}var S=R.menuBtnInfo;if(!!S.menuCfg){F.removeClass(S.btn,C);}}},200);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui._IsUnitDependentPanel","mstrmojo.vi._MonitorsAppState","mstrmojo.css");mstrmojo.vi.ui.VIBoxPropertyEditor=mstrmojo.declare(mstrmojo.vi.ui.BoxPanel,[mstrmojo.vi.ui._IsUnitDependentPanel,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.VIBoxPropertyEditor",layoutConfig:{h:{controlNode:"25px",containerNode:"100%"},w:{controlNode:"all",containerNode:"all"},xt:true},init:function E(F){this._super(F);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-vi-PropEditor");},onAppStateChange:function B(N){var L=mstrmojo.vi.VisualInsightApp.APP_STATES,O=L.PAUSE,M=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();var J=!!(N.valueWas&O);if(M!==J&&!(mstrApp.enableUpdate&&J)){var I=this.targetUnit,P=I&&I.id,F=this.model&&this.model._selectedUnitId;if(P!==F){return ;}var K=this.contents,H=(K.children||[]).slice(),G=I&&I.boxContent;if(G){G.excludeData=M;}K.removeChildren();H.forEach(function(Q){Q.destroy();});this.onVIUnitSelected(I);}},onVIUnitSelected:function C(I){var H=I&&I.getEditorModel(),F=function(){this.updateScrollbars();},G=H&&H.getEditorContents(F.bind(this));if(G){G.forEach(function(J){J.slot="containerNode";});this.contents.addChildren(G);this.generateToolbar();this.doLayout();}else{if(H&&H.getDelayedEditorContents){H.getDelayedEditorContents(this,I);}}},onvisibleChange:function A(F){if(this.viPanelType===mstrmojo.vi.ui.BoxPanel.PANEL_TYPES.PROPS&&F.value){this.refresh();}},updateToolbar:function D(F){var H=this.targetUnit,G=H&&H.getEditorModel();this.addRenameTargetMenuItem(F);this.addHelpTopicMenuItem(F,mstrmojo.desc(1143,"Help"),G&&G.help);return this._super(F);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.TitleBarWithRMCPopup","mstrmojo.vi.ui._IsUnitContainerTitleBar","mstrmojo.vi.ui.toolbars.TitleToolbar");function C(F,D,E){return[{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",slot:F+"ToolNode",alias:D,visible:true,useRichTooltip:E}];}mstrmojo.vi.ui.VizBoxTitleBar=mstrmojo.declare(mstrmojo.vi.ui.TitleBarWithRMCPopup,[mstrmojo.vi.ui._IsUnitContainerTitleBar],{scriptClass:"mstrmojo.vi.ui.VizBoxTitleBar",leftToolbar:undefined,getLeftToolbarChildren:function A(){return C("left","leftToolbar",false);},getRightToolbarChildren:function B(){return C("right","tbToolbar",true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.string","mstrmojo.expr","mstrmojo.date","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox");var U=mstrmojo.array,R=mstrmojo.css,J=mstrmojo.string,Q=mstrmojo.date,P=mstrmojo.expr,B=P.FN,E=mstrmojo.validation;var A={};A[B.BETWEEN]=B.NOT_BETWEEN;A[B.NOT_BETWEEN]=B.BETWEEN;A[B.GREATER_EQUAL]=B.LESS;A[B.LESS]=B.GREATER_EQUAL;A[B.LESS_EQUAL]=B.GREATER;A[B.GREATER]=B.LESS_EQUAL;A[B.SEARCH]=B.SEARCH;function I(V){if(this.value!==this._lastInput){S.call(this,V,true);}}function N(V){mstrmojo.DateTextBox.prototype.onclick.call(this,V);R.addClass(this.calendar&&this.calendar.domNode,mstrApp.getThemeClassName());}function S(V,a){var Z=this.parent.parent;if(!Z._inSyncPhase){var X=this.calendar&&this.calendar.cal,Y=this,W=Z.submitTimer;if(W){window.clearTimeout(W);}if(!mstrApp.isWaiting()){if(a||X&&X.value===this.value){this._lastInput=this.value;Z.submit(Y);}else{Z.submitTimer=window.setTimeout(function(){Y._lastInput=Y.value;Z.submit(Y);},3000);this.set("dynDateValue",null);if(X){X.set("value",this.value);}}}else{if(this._lastInput){this.set("value",this._lastInput);}}}}function L(Y){if(!Y.isDyn){return null;}var X=["isDyn"];X.push(Y.dyt||0);X.push(Y.ddo||0);X.push(Y.dmo||0);X.push(Y.dm||0);X.push(Y.dd||0);X.push(Y.dw||0);X.push(Y.dow||0);X.push(Y.v||"");if(Y.dtp===P.DTP.TIMESTAMP){var W=Q.parseDateAndOrTime(Y.v||""),V=W&&W.time;if(V){Y.dh=V.hour;Y.dmi=V.min;Y.ds=V.sec;}}X.push(Y.dh||0);X.push(Y.dmi||0);X.push(Y.ds||0);return X.join("::");}function C(b,V,Y){return{parent:b,dt:V,f:Y,setDataType:function Z(e){this.dt=e;},setFunction:function c(e){this.f=e;},hasSecTextBox:function W(){var e=this.f;return e!==B.SEARCH;},adjustVisibleFields:function a(){var e=this.parent;if(!this.hasSecTextBox()){e.toBox.set("visible",false);e.fromBox.fromLabel.set("visible",false);}if(V===P.DTP.DATE||V===P.DTP.TIMESTAMP){e.fromBox.fromInput.set("visible",false);e.toBox.toInput.set("visible",false);}else{e.fromBox.fromPicker.set("visible",false);e.toBox.toPicker.set("visible",false);}},setMinMaxToInputs:function d(h,g){if(!this.hasSecTextBox()){return ;}var e=h.value&&h.validationStatus&&h.validationStatus.code===E.STATUSCODE.VALID,f=g.value&&g.validationStatus&&g.validationStatus.code===E.STATUSCODE.VALID;if(h.constraints){h.constraints.min=null;h.constraints.max=f?g.value:null;}if(g.constraints){g.constraints.min=e?h.value:null;g.constraints.max=null;}},passValueToInputs:function X(f){var h=this.parent,k,j,g=this,e=function(l,m){if(g.f===B.SEARCH||l.v!=="*"){m.set("value",l.v);m._lastInput=l.v;if(V===P.DTP.DATE||V===P.DTP.TIMESTAMP){m.set("dynDateValue",L(l));}}};if(V===P.DTP.DATE||V===P.DTP.TIMESTAMP){k=h.fromBox.fromPicker;j=h.toBox.toPicker;}else{k=h.fromBox.fromInput;j=h.toBox.toInput;}if(Y===B.BETWEEN||Y===B.NOT_BETWEEN){if(f&&f[0]){e(f[0],k);}else{k.set("value",k.min||"");k._lastInput=k.min||"";}if(this.hasSecTextBox()&&f&&f[1]){e(f[1],j);}else{j.set("value",j.max||"");j._lastInput=j.max||"";}}else{if(Y===B.GREATER_EQUAL||Y===B.LESS){if(f&&f[0]){e(f[0],k);j.set("value",j.max||"");j._lastInput=j.max||"";}}else{if(Y===B.LESS_EQUAL||Y===B.GREATER){if(f&&f[0]){e(f[0],j);k.set("value",k.min||"");k._lastInput=k.min||"";}}}}this.setMinMaxToInputs(k,j);}};}mstrmojo.vi.ui.rw.selectors.AttrQualInputBox=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.rw.selectors.AttrQualInputBox",markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},cssClass:"Attr-Qual-InputBox",children:[{scriptClass:"mstrmojo.Box",alias:"fromBox",cssClass:"from-box",children:[{scriptClass:"mstrmojo.Label",alias:"fromLabel",cssDisplay:"inline-block",cssClass:"input-label",text:"<span>"+mstrmojo.desc(146,"From:")+"</span>",allowHTML:true},{scriptClass:"mstrmojo.ValidationTextBox",alias:"fromInput",cssDisplay:"inline-block",required:false,constraints:{trigger:E.TRIGGER.ALL},autoFormat:false,onEnter:I,onblur:I,_lastInput:null,bindings:{dtp:"this.parent.parent.dt"}},{scriptClass:"mstrmojo.DateTextBox",alias:"fromPicker",cssDisplay:"inline-block",required:false,calendarToBody:true,constraints:{trigger:E.TRIGGER.ALL},autoFormat:false,onvalueChange:S,onEnter:I,onblur:I,_lastInput:null,bindings:{dtp:"this.parent.parent.dt",min:"this.parent.parent.min",max:"this.parent.parent.max",defaultDate:"this.parent.parent.min",showAdvanced:"this.parent.parent.showAdvanced",canSelectDisabledDate:"this.parent.parent.canSelectDisabledDate"},onclick:N}]},{scriptClass:"mstrmojo.Box",alias:"toBox",cssClass:"to-box",children:[{scriptClass:"mstrmojo.Label",alias:"toLabel",cssDisplay:"inline-block",cssClass:"input-label",text:"<span>"+mstrmojo.desc(147,"To:")+"</span>",allowHTML:true},{scriptClass:"mstrmojo.ValidationTextBox",alias:"toInput",cssDisplay:"inline-block",required:false,constraints:{trigger:E.TRIGGER.ALL},autoFormat:false,onEnter:I,onblur:I,_lastInput:null,bindings:{dtp:"this.parent.parent.dt"}},{scriptClass:"mstrmojo.DateTextBox",alias:"toPicker",cssDisplay:"inline-block",required:false,calendarToBody:true,constraints:{trigger:E.TRIGGER.ALL},autoFormat:false,onvalueChange:S,onEnter:I,onblur:I,_lastInput:null,bindings:{dtp:"this.parent.parent.dt",min:"this.parent.parent.min",max:"this.parent.parent.max",defaultDate:"this.parent.parent.max",showAdvanced:"this.parent.parent.showAdvanced",canSelectDisabledDate:"this.parent.parent.canSelectDisabledDate"},onclick:N}]}],setupScrollNodes:function F(){this.scrollNode=this.supportScrollbar?this.containerNode:null;},widgetResized:function(){var Y=this,V=parseInt(this.width,10),W=["fromBox","toBox"],Z,X,a;if(!this.widgetHelper.hasSecTextBox()){W=["fromBox"];}if(V>368){X=true;}else{X=false;}if(Y.parent.isInFilterPanel()||!this.widgetHelper.hasSecTextBox()){X=false;return ;}window.setTimeout(function(){Z=Y.hasRendered;if(Y.fromBox&&Y.fromBox.domNode){a=Y.fromBox.fromLabel.domNode.children[0].offsetWidth+Y.fromBox.fromPicker.domNode.offsetWidth;a+=Y.toBox.toLabel.domNode.children[0].offsetWidth+Y.toBox.toPicker.domNode.offsetWidth;a+=80;}U.forEach(W,function(b){if(Z){if(a>V){X=false;}R.toggleClass(Y[b].domNode,"onerow",X);Y[b].domNode.style.display=X?"inline-block":"block";}else{if(X){R.addWidgetCssClass(Y[b],"onerow");Y[b].cssDisplay="inline-block";}else{R.removeWidgetCssClass(Y[b],"onerow");Y[b].cssDisplay="block";}}});if(Y.supportScrollbar){Y.updateScrollbars();}},0);},init:function O(V){if(this._super){this._super(V);}if(this.supportScrollbar){mstrmojo.hash.copy({markupString:'<div id="{@id}" class="{@cssClass}" style="{@cssText}"><div style="height: {@height}; width: {@width}"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}}},this);}this.widgetHelper=C(this,this.dt,this.f);this.updateWidgetByData();},update:function D(V){if(V){this.cs=V.cs;if(V.f){this.f=V.f;}if(V.ft){this.ft=V.ft;}if(V.fid){this.fid=V.fid;}if(V.min){this.set("min",V.min);}if(V.max){this.set("max",V.max);}}this.updateWidgetByData();},updateWidgetByData:function M(){var V=this.widgetHelper,W=this.cs;this._inSyncPhase=true;V.adjustVisibleFields();V.passValueToInputs(W);this._inSyncPhase=false;},onincludeChange:function G(){this.f=A[this.f];if(!this._inSyncPhase){this.onchange();}},submit:function H(c){var a=this.cs=[],Y=this.parent.include,X=this.widgetHelper,W=(c.validationStatus.code===E.STATUSCODE.VALID),f=this.parent.model,d=c,e=c,Z;if(X.hasSecTextBox()){if(c.alias==="toInput"){Z=this.fromBox.fromInput;}else{if(c.alias==="toPicker"){Z=this.fromBox.fromPicker;}else{if(c.alias==="fromInput"){Z=this.toBox.toInput;}else{if(c.alias==="fromPicker"){Z=this.toBox.toPicker;}}}}d=(c.alias.indexOf("from")===0)?c:Z;e=(c.alias.indexOf("to")===0)?c:Z;X.setMinMaxToInputs(d,e);Z.validate();if(Z.validationStatus.code!==E.STATUSCODE.VALID){W=false;}}if(W){if(X.hasSecTextBox()){var V=d.dynDateValue||d.value,b=e.dynDateValue||e.value;this.unset=J.isEmpty(V)&&J.isEmpty(b);if(!J.isEmpty(V)&&!J.isEmpty(b)){a[0]={v:V};a[1]={v:b};this.f=Y?B.BETWEEN:B.NOT_BETWEEN;}else{if(!J.isEmpty(V)){if(f.isFromSolrCube&&f.isFromSolrCube(this.srcid)){a[0]={v:V};a[1]={v:"*"};this.f=Y?B.BETWEEN:B.NOT_BETWEEN;}else{a[0]={v:V};this.f=Y?B.GREATER_EQUAL:B.LESS;}}else{if(!J.isEmpty(b)){if(f.isFromSolrCube&&f.isFromSolrCube(this.srcid)){a[0]={v:"*"};a[1]={v:b};this.f=Y?B.BETWEEN:B.NOT_BETWEEN;}else{a[0]={v:b};this.f=Y?B.LESS_EQUAL:B.GREATER;}}}}X.setMinMaxToInputs(d,e);}else{a[0]={v:c.value};this.unset=J.isEmpty(a[0].v);this.f=B.SEARCH;}this.onchange();if(this.makeSelection){this.makeSelection({selItem:this.domNode});}}},getSummaryText:function K(){var X=this.cs||[],Y=this.f;if(this.unset||!X.length||J.isEmpty(X[0].v)&&(X.length<=1||J.isEmpty(X[1].v))){return"";}var W="",V=this.parent.include;switch(Y){case B.BETWEEN:case B.NOT_BETWEEN:W=mstrmojo.desc(4804).replace("##",X[0].v).replace("###",X[1].v);break;}if(!V){W=mstrmojo.desc(1099,"Not")+" "+W;}return W;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.Arr","mstrmojo.AjaxCall","mstrmojo.css","mstrmojo.Calendar","mstrmojo.WidgetDial","mstrmojo.Label","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.registry","mstrmojo.string","mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox","mstrmojo.mstr.EnumDataType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSConsolidationType");var s=mstrmojo.array,AH=s.map,J=mstrmojo.Arr,E=mstrmojo.css,V=mstrmojo.dom,W=mstrmojo.hash,AI=mstrmojo.string,A=mstrmojo.registry,U=mstrmojo.expr,O=U.ET,h=mstrmojo.mstr.EnumDataType,l=U.ET2TP,X=U.ET2TGT,AE=U.DTP,D=mstrmojo.meta.TP,P=mstrmojo.meta.STP,AO=mstrmojo.mstr.EnumDSSXMLObjectTypes,AA=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,G=mstrmojo.mstr.EnumDSSConsolidationType;var f="dummy",K={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:f,css:"unselectable",cls:"temp"},q={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:f,css:"unselectable",cls:"temp"},C={did:"idAttribute",v:"idAttribute",n:mstrmojo.desc(518,"Attribute"),t:f,css:"unselectable"},AC={did:"idMetric",v:"idMetric",n:mstrmojo.desc(517,"Metric"),t:f,css:"unselectable"},AB={did:"idSelect",v:"idSelect",n:mstrmojo.desc(547,"Select"),t:f,css:"unselectable"},v={did:"idWait",v:"idQualification",n:mstrmojo.desc(5225,"Qualification"),t:f,css:"unselectable"},B={did:"idWait",v:"idQualification",n:mstrmojo.desc(15008,"Qualify on"),t:f,css:"unselectable"};var AN={};AN[AE.DATE]=1;AN[AE.TIME]=1;AN[AE.TIMESTAMP]=1;var w={};w[O.MQ]={key:"metricFns",def:U.METRIC_FNS};w[O.MC]={key:"metricFns",def:U.METRIC_FNS};w[O.AQ]={key:"formFns",def:U.FORM_FNS};w[O.AL]={key:"formFns",def:U.FORM_FNS};w[O.AC]={key:"formFns",def:U.FORM_FNS};w[O.AE]={key:"elemFns",def:U.ELEM_FNS};var S=[U.STP.PROMPT,U.STP.PROMPT_OBJECTS,U.STP.PROMPT_ELEMENTS,U.STP.PROMPT_EXPRESSION,U.STP.PROMPT_EXPRESSION_DRAFT];function Z(AP){if(AP&&AP.t===AO.Consolidation&&AP.st===AA.ConsolidationManaged){return true;}return false;}function F(AR,AT,AQ){var AS=AR.items,AP=s.indexOf(AS,AT);if((AP===0)&&(AS.length===1)){AQ=mstrmojo.Arr.makeObservable((AQ&&AQ.length)?AQ.concat():[]);AR.set("items",AQ);}else{if(AP>-1){AS.splice(AP,1);}if(AQ&&AQ.length){s.insert(AS,(AP>-1)?AP:AS.length,AQ);}AR.refresh();}}function b(AX,AW){if(this.updating){return ;}var AP=this.multiSelect,AR=this.selectedItem,AU=AX&&AX.added,AT=AX&&AX.removed;AW=AW||this.alias;if(!AP&&AU&&AT&&AU[0]===AT[0]){return ;}if(AR&&AR[D]===f){this.updating=true;if(AP){this.removeSelect([this.selectedIndex]);}else{var AV=AT&&Number(AT[0]);AV=(AV==null)?-1:AV;this.set("selectedIndex",AV);}this.updating=false;}else{var AQ=this.parent.parent.parent.model;if(AP){var AS=this.items;AQ.edit(AW,{added:AU&&s.get(AS,AU),removed:AT&&s.get(AS,AT),itemIdField:this.itemIdField});}else{AQ.edit(AW,AR);}}}function R(AP,AR,AS){if(this.updating){return ;}AS=AS||this.alias;var AQ=AP.model;AQ.edit(AS,AR);}function t(){var AQ=this.parent,AP=((AQ&&AQ.cssText)||"").match(/height:\s*(\d*)px/);this.cssText=AP&&AP[0];}function N(AP){return mstrmojo.mixin(AP,{scriptClass:"mstrmojo.rw.ConditionList",cssClass:"mstrmojo-"+AP.alias,postCreate:t});}function Y(){var AQ=this.parent,AP=AQ.parent;AP["invalid"+AQ.cstIndex]=false;}function n(AR,AP,AS){var AQ=AR.cfg;if(AQ){AQ.data=AR;AQ.parent=AS;return A.ref(AQ);}AQ=new mstrmojo.Label({text:AR.n||"&nbsp;",cssClass:"dial-item "+(AR.t?("t"+AR.t):"")});AQ.markupMethods.onselectedChange=function(){E.toggleClass(this.domNode,["selected"],this.selected);};AQ.data=AR;AQ.parent=AS;return AQ;}function z(AP){switch(AP){case h.DataTypeInteger:case h.DataTypeUnsigned:case h.DataTypeDecimal:case h.DataTypeReal:case h.DataTypeDouble:case h.DataTypeFloat:case h.DataTypeCellFormatData:return h.DataTypeNumeric;default:return AP;}}function H(AR,AQ){var AP=AR.model||{},AS=AP.fn;return(AS!=null)&&((AP.et===O.MQ)||(AP.et===O.MC)||(AP.et===O.AQ)||(AP.et===O.AL)||(AP.et===O.AC))&&(U.fnCstCount(AS,AP.fnt)>AQ);}function p(AQ){var AT=AQ&&l[AQ.et],AS=AQ&&AQ.fm&&AQ.fm.dtp,AP=AS&&U.DTP2PROMPT_STP[AS],AR={};AR[AT]=true;if(AP){AR[AP]=true;}return AR;}function AK(AP,AR){var AQ;if(AR){switch(X[AP.et]){case"a":AQ=AR[O.AC];break;case"m":AQ=AR[O.MC];break;default:AQ=false;break;}}else{AQ=true;}return AQ&&U.fn_AC_MC(AP&&AP.fn);}function k(AP){var AS=AP.model,AW=AS&&AS[X[AS.et]]&&AS[X[AS.et]][AP.columnWalk.target.itemIdField||"did"],AR=AS&&AS.fm,AY=AR&&AR.dtp,AQ=AK(AS,AP.ets);if(this.targetsLastMod&&this.targetsLastMod===AP.targetsLastMod&&AW&&AW===this._lastTargetId&&this.lastFmDtp===AY&&this.lastFnTp===AQ){return ;}if(!AQ){this.clearSelect();if(this.items.length!==this.preLen){this.set("items",this.items.slice(0,this.preLen));}}else{var AU=AS.a?[C]:AS.m?[AC]:[],AT=e(AP),AX=AU.concat(AT),AV=this.items.slice(this.preLen);s.forEach(AV.reverse(),function(AZ){this.remove(AZ);},this);this.add(AX,-1);}this._lastTargetId=AW;this.lastFnTp=AQ;this.lastFmDtp=AY;this.targetsLastMod=AP.targetsLastMod;}function e(AP){var AQ=AP.model,AR=p(AQ),AS=AQ[X[AQ.et]];return U.getSortedObjectsByTypeGroup(s.filter(AP.targets,function(AT){return(AT.t!==4||AT.did!==AS.did)&&(AR[AT[D]]||AR[AT[P]]);}));}function a(AQ,AP){var AR=AQ.model||{},AS=AR.cs,AT=AS&&AS[AP];if(AR.et==O.MC&&AR["c"+(AP+2)]){AT=AR["c"+(AP+2)];}return AT;}function I(AP,AS){var AR=AP.model||{},AQ;switch(AR.et){case O.MC:case O.MQ:AQ=(AS&&AS.dtp)||z(AR.m.dt)||U.METRIC_DTP;if(AQ===AE.BIGDECIMAL){AQ=U.METRIC_DTP;}break;case O.AQ:case O.AC:case O.AE:case O.AL:AQ=AR.fm&&AR.fm.dtp;break;}return AQ||AE.CHAR;}function AM(AQ,AR){if(!AQ){return AQ;}if(AQ.dtp===AE.BIGDECIMAL&&AR===O.MQ){var AP=String(AQ.v);if(AP&&AP.indexOf("#")===-1){return"#"+AP+"#";}else{return AP;}}else{return AQ.v;}}function x(AQ,AP){var AS=AQ.model||{},AT=AS.cs,AU,AR;if(AS.et===O.AL){AR=[];s.forEach(AT,function(AV){AR.push(AV&&AV.v);});AR=AR.join(mstrConfig.listSep);}else{AU=a(AQ,AP);AR=AM(AU,AS.et);}return AR;}function L(Aj,Ab){Aj.updating=true;var AX=Aj.parent.parent.parent,Ai=H(AX,Ab),Ac,Ad;if(Ai){k.call(Aj,AX);var AS=AX.model||{},Ah=a(AX,Ab),AY=I(AX,Ah),Aa=x(AX,Ab);var AW=AS.fn,AU=U.fn_List(AW,AS.fnt),Ak=AN[AY],Ae=Ak&&!AU;var AQ=Aj.ctxtBuilder,Ag=AQ&&AQ.itemWidgets,AR=Ak?(Ae?Aj.calIndex:Aj.dtxtIndex):Aj.txtIndex,AV;for(Ac=0,Ad=Aj.preLen;Ac<Ad;Ac++){AV=Ag[Ac];if(Ac==AR){AV.set("dtp",AY);AV.set("isList",AU);var AP=AV.value,AT=AI.isEmpty(AP),Af=AI.isEmpty(Aa);if(!(AT&&Af)&&AP!==Aa){AV.set("value",Aa);}AV.set("visible",true);AV.set("hint",AU?mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep||";"):"");try{if(Aj.alias!=="c1"||Aj.parent.c1Selected){AV.focus&&AV.focus();}}catch(AZ){}if(AW===1||AW===2){AV.constraints.min=0;}if(AV.clearValidation){AV.clearValidation();}}else{AV.set("visible",false);}}if(AX.hasPrompt&&Aj.selectedItem&&Aj.selectedItem.st===U.STP.PROMPT_STRING){AX.invalid0=false;}switch(AS.et){case O.AQ:case O.AL:case O.MQ:if(Ah&&Ah.p){Aj.set("selectedItem",Ah.p);}else{Aj.set("selectedIndex",AR);}break;case O.MC:case O.AC:Aj.set("selectedItem",AS[X[AS.et]+(2+Ab)]);break;}}Aj.updating=false;}function AJ(){var AS=this.parent,AQ=AS.parent.parent.parent,AR=(this.isValid&&this.isValid())||(!this.isValid&&!AI.isEmpty(this.value)),AP=AQ.model;AQ["invalid"+AS.cstIndex]=!AR;if(!this.updating&&AR){this.updating=true;if(AP){AP.edit(AS.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}if(AQ.updateOkBtn){AQ.updateOkBtn();}}function j(AQ){var AP=[{did:660,cfg:{scriptClass:"mstrmojo.ValidationTextBox",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP|mstrmojo.validation.TRIGGER.VALUESET},onValid:AJ,onInvalid:AJ,onClearValidation:Y,size:6,visible:false}},{did:154,cfg:{scriptClass:"mstrmojo.Calendar",onvalueChange:AJ,visible:false}},{did:23,cfg:{scriptClass:"mstrmojo.DateTextBox",cssText:"margin-left:9px;",cssDisplay:"inline-block",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL-mstrmojo.validation.TRIGGER.ALL.ONBLUR},onValid:AJ,onInvalid:AJ,onClearValidation:Y,calendarToBody:true,autoFormat:false,calConfig:{onmousedown:function(AR){V.stopPropogation(AR.hWin,AR.e);}},visible:false}}];return N(W.copy(AQ,{scriptClass:"mstrmojo.WidgetDial",makeObservable:true,itemFunction:n,selectionPolicy:"reselect",items:AP.concat(),txtIndex:0,calIndex:2,dtxtIndex:2,preLen:AP.length,insertUnlistedValuesAt:-1,itemIdField:"did",update:function(){L(this,this.cstIndex);this.parent.updateScrollbars();},postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},itemsEffect:undefined,onchange:b}));}function AL(AQ,AP){var AR=AP+U.FN_SEP+AQ;return(AQ!=null)?{did:AR,n:AR}:null;}function Q(AR){var AT=this.selectedItem;AR=s.filter(AR,function(AU){return(!AU.icf);});if(AT){var AQ=s.find(AR,this.itemIdField,AT[this.itemIdField]);if(AQ>-1){AR=AR.concat();AR.splice(AQ,1);}}F(this,q,AR);var AS=this.items,AP=AS.length;if(AP===1){this.singleSelect(0);}this.updateScrollbars&&this.updateScrollbars();this.parent.updateScrollbars();}function o(AR,AQ,AS,AV){AR.updating=true;if(AQ){if(AS!=null){AR.set("items",[]);AR.clearSelect();AR.set("items",AS);}var AU=AR.itemIdField,AT=AR.selectedItem;if((AT&&AT[AU])!=(AV&&AV[AU])){var AP=Math.max(s.indexOf(AH((AS||[]),function(AW){return AW[AU];}),AV&&AV[AU]),0);AR.set("selectedIndex",AP);}}AR.updating=false;}function M(AR,AQ,AS,AV){AR.updating=true;if(AQ){if(AS!=null){AR.set("items",AS);}var AU=AR.itemIdField,AT=AR.getSelectedItem();if((AT&&AT[AU])!=(AV&&AV[AU])){var AP=Math.max(s.indexOf(AH((AS||[]),function(AW){return AW[AU];}),AV&&AV[AU]),0);AR.set("selectedIndex",AP);}}AR.updating=false;}function g(AP){return N(W.copy(AP,{insertUnlistedValuesAt:-1,hasDummyLabel:true,postCreate:function(){t.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,readCache:true,writeCache:true,params:{taskId:"getAttributeForms",attributeId:null,displayedForms:"0",styleName:"MojoAttributeStyle"},onsuccess:function(){var AS=this.parent,AR=this.response;if((AR&&AR.did)!==AS.lastAttrId){return ;}Q.call(this.parent,AR.fms||[]);},onerr:function(){F(this.parent,q,[K]);}});},update:function AQ(){var Ag=this.fmPost,AZ=this,AT=this.parent.parent.parent,AW=AT.model,Ae=AW&&AW["a"+Ag],Ab=!!Ae,AV,Aa,Af,AS=AT.disableElementsBrowsing,AR=Ae&&AS&&AS(Ae),Ad=Z(Ae);if(Ab){switch(AW.et){case O.AQ:case O.AL:Aa=AW.fm;break;case O.AC:Aa=AW["fm"+Ag];break;case O.AE:Aa=AL(AW.fn,1);break;}if(this.lastAttrId!==Ae.did){this.lastAttrId=Ae.did;AV=[];if(this.isFirstFm){if(!AR&&(!Ae.ilk&&(!AT.ets||AT.ets[O.AE]))){if(this.hasDummyLabel){AV.push(AB);}var AY=w[O.AE],Ac=AY&&AY.key,AU=AY.def;AV=AV.concat((Ac&&AT[Ac])||(Ad?s.filter(AU,function(Ah){return Ah.did!=="1,57";}):AU)||[]);s.forEach(AV,function(Ah){Ah.cls="fn";});}if(this.hasDummyLabel){AV.push(mstrApp.isWSStyling?B:v);}}if(Aa&&(AW.et!==O.AE)){AV.push(Aa);}Af=this.ajx;Af.params.attributeId=Ae.did;Af.params.otp=Ae.t||12;AV.push(q);J.makeObservable(AV);}}if(AR&&AW.et===O.AE){Aa=null;}o(this,Ab,AV,Aa);if(Ab&&Af){var AX;if(AT.getAttributeForms){AX=AT.getAttributeForms(Ae.did);}else{if(Ae.fms){AX=Ae.fms;}}if(AX&&AX.length>0){Q.call(this,AX);}else{if(Ae&&Ae.t===AO.Consolidation){Q.call(this,[]);}else{if(Af){if(mstrApp&&mstrApp.isWorkstation){mstrApp.serverRequest(Af.params,{success:function(Ah){if((Ah&&Ah.did)!==AZ.lastAttrId){return ;}Q.call(AZ,Ah.fms||[]);},failure:Af.onerror});}else{if(Af._delayId){window.clearTimeout(Af._delayId);delete Af._delayId;}Af._delayId=window.setTimeout(function(){delete Af._delayId;Af.send();},500);}}}}}}}));}function AG(AP){if(AP&&!W.isEmpty(AP)){var AQ=s.hash(S);W.forEach(AP,function(AS,AR){if(AS){AQ[l[AR]]=true;}});return AQ;}return null;}function m(AP,AQ,AS,AR){AP.updating=true;AP.clearSelect();s.forEach(AQ,function(AT){AT.title=AI.encodeHtmlString(AT.title||AT.n||"");});if(AQ){AP.set("items",AQ);}if(AS&&AS.length){AP.setSelectedItems(AS);}else{if(AR&&AR.length){AP.select(AR);}}AP.updating=false;}function d(AQ,AP,AR,AT,AS){if(AP){m(AQ,AR,AT,AS);}}mstrmojo.rw.ConditionList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.rw.ConditionList",allowUnlistedValues:true,itemIdField:"did",getItemProps:function u(AT,AP){var AS=!!this.selectedIndices[AP],AV=AT.n,AR=false,AU=AT.ndetype===G.DssRecursiveDerivedElement;if(AT.t===12){var AQ=s.filter(AT.fs,function(AW){return AW.fgr>0;});if(AQ.length>0){AR=true;}}return W.copy({cls:(AS?mstrmojo._IsList.SELECTED_CLS:"")+" "+(AT.css||"")+" "+(AT.t?("t"+AT.t+((AT.da||AT.um)?"d":"")+(AR?"g":"")+(AT.st?(" st"+AT.st+(AU?" nde4ra":"")):"")):""),n:AV||"&nbsp;"},this._super(AT,AP));},onselectionChange:function AD(AP){this._super(AP);b.call(this,AP);}});mstrmojo.rw.ConditionWalkProviderBase=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.rw.ConditionWalkProviderBase",browseEs:function c(AS,AR,AU){AS.openPopup("eb",{zIndex:AS.parent.zIndex+10,left:Math.round(AU.x)+"px",top:Math.round(AU.y)+"px"});var AQ=AS.eb.browser,AP=AS.model,AT=AP&&AP.a&&AP.a.did;if(!AT){return ;}AQ.set("attributeID",AT);AQ.set("selectedItems",AP.es?W.clone(AP.es):[]);AQ.initBrowser();},browseObjs:function AF(AW,AP,AQ){AW.openPopup("ob",{zIndex:AW.parent.zIndex+10,left:Math.round(AQ.x)+"px",top:Math.round(AQ.y)+"px"});var AR=AW.ob.browser;AR.target=AP;var AS;switch(AP.alias){case"dmy":AS=[U.TP.ATTR,U.TP.DIM];break;case"c0":case"c1":var AU=AW.model,AT=AU&&AU.et,AX=AU&&AU.fm,AV=AX&&AX.dtp||(AU.m?U.DTP.DECIMAL:U.DTP.UNKNOWN);AS=(AT===O.MQ||AT===O.MC)?[U.TP.METRIC,U.DTP2PROMPT_STP[AV]]:[U.TP.ATTR,U.DTP2PROMPT_STP[AV]];break;default:AS=AG(AW.ets);AS=AS?W.keyarray(AS,true):[U.TP.ATTR,U.TP.METRIC,U.STP.REPORT_GRID,U.STP.REPORT_GRAPH,U.STP.REPORT_ENGINE,U.STP.REPORT_TEXT,U.STP.REPORT_DATAMART,U.STP.REPORT_BASE,U.STP.REPORT_GRIDGRAPH,U.STP.REPORT_NONINTERACTIVE,U.STP.FILTER].concat(S);}AS[AS.length]=U.TP.FOLDER;AR.browse({rootFolderType:AU&&(AU.et===O.MQ||AU.et===O.MC)?5:26,folderLinksContextId:33,onSelectCB:[AW,"onOBSelect"],browsableTypes:AS.join(",")});},});var r=mstrmojo.rw.ConditionWalkProviderBase;r.onWalkChange=b;r.replaceItem=F;r.getChildJSON=N;r.walkChildPostCreateFn=t;r.cstJson=j;r.isComparisonAllowed=AK;r.clearInvalid=Y;r.updateCst=L;r.widgetItemFn=n;r.shouldShowCst=H;r.getConstant=a;r.getConstantDataType=I;r.getConstantValue=x;r.isDATE=AN;r.getCstListCompareTgts=e;r.fmJson=g;r.fnItem=AL;r.updateList=o;r.allowedTargetTypes=AG;r.updatePulldown=M;r.onWalkChangeThroughPulldown=R;r.updateListMultiData=m;r.updateListMulti=d;})();(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.CheckList","mstrmojo.TextBox","mstrmojo.TextBoxWithLabel","mstrmojo.CheckBox","mstrmojo.MouseOverContainer","mstrmojo.util.LibraryHelper");mstrmojo.requiresDescs(1825,8078,8079,629,8080,8081,8082,3336,9048,8083,8084,955,8085,531,8086,8087,8088,8089,8090,767,2056,8091,8093,1442,221,8092,13621,9772,9773,9774,272,271,8145,2509,8146,8147,9775,9776,9777,9771,12299,9151,2156,9892,9890,9891,9099,2140,2102);var W=mstrmojo.dom,E=mstrmojo.css,q=mstrmojo.array,r=mstrmojo.util.LibraryHelper,j=[],w=[{n:mstrmojo.desc(16034,"Grant"),v:0},{n:mstrmojo.desc(16035,"Deny"),v:1},{n:mstrmojo.desc(8441,"Default"),v:2}],Y="sharingEditor",t=199,X="294DEDC011D2F1D56000D98E67019608",I="C82C6B1011D2894CC0009D9F29718E4F",F=[1,4,8,16,32,64,128],B=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],f=["B","R","W","D","C","U","E"],h=false,v=true,Z=257,u=1024,b=772,d=776,O=777,l=mstrmojo.Button.newWebButton,s=mstrmojo.Button.newActionButton;function g(AA,AB,z){return{scriptClass:"mstrmojo.HBox",alias:AA,right:AB,cssText:"height:20px;",children:[{scriptClass:"mstrmojo.Label",text:z,cssText:"width:80px"},{scriptClass:"mstrmojo.Pulldown",cssText:"width:100px",itemIdField:"v",items:w,defaultSelection:2,selectionPolicy:"reselect",_set_value:function(AD,AC){this.value=AC;}}]};}function V(z){return(z&&z.t===8);}function x(z){return z&&z.st!=Z&&z.st!=u&&z.st!=b&&z.st!=d&&z.st!=O;}function N(z){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[z]||z;}function K(z){return{"253000":255000,"253":255,"32221":223,"56197":199}[z]||z;}function c(AF){var AE=[].concat(AF.acls),z=AF.inhs,AD=AF.acls,AH,AB,AG,AA,AC;AD.splice(0,AD.length);if(V(AF)){AE=AE.concat(mstrmojo.hash.valarray(z));}for(AA=0,AC=AE.length;AA<AC;AA++){AH=AE[AA];AG=AH.rgt;if(AG>1000){AB=mstrmojo.hash.copy(AH);AB.den=true;AB.rgt=Math.floor(AG/1000);AD.push(AB);}if((AG%1000)>0){AB=mstrmojo.hash.copy(AH);AB.den=false;AB.rgt=AG%1000;AD.push(AB);}}return AF;}function U(AA){var z={isSerializable:function(AD,AC,AB){switch(AD){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(AD,AB,AC){if(AD==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",AA,z);}function o(AE,AD){var AB=AE&&AE.oi,AA,z,AF,AC=AE.oneTierConnectivity;if(AB){AB=c(AB);AA=U(AB);AF={taskId:"saveObjectACL",objectXML:AA,objectType:AB.t,objectID:AB.did,propagateToChildren:AE.childrenAccessPulldown.value};z={success:function(AG){if(AD){AE.close();}else{mstrmojo.alert(mstrmojo.desc(3336,"## has been saved successfully.").replace("##",AG.n));AE.set("hasChanged",false);}},failure:function(AG){if(AG.getReponseHeader){mstrmojo.alert(AG.getResponseHeader("X-MSTR-TaskFailureMsg"));}if(AD){AE.close();}}};if(AC){delete AF.taskId;AF.connectionId=AC.connectionId;AF.sessionState=AC.sessionState;AC.connectivityProxy.saveObjectACL(AF,mstrmojo.func.wrapMethods(z,{failure:function(AG){mstrmojo.onetier.vi.prefs.handleErrorMessage(AG);}}));}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,z,AF);}}}function p(AH){var AL=AH.aclList,AM=AH.objectInputer,AC=AM.getSelectedObjects(),AE=AC.length,AI=[],AB,AK=199,AA,AJ,z;if(!AM.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,AH.alertTitle);return false;}for(AA=0;AA<AE;AA++){AB=AC[AA];if(AB.did===X||AB.did===I){var AD=mstrmojo.all[Y];if(AK===AD.currentPublicRight){if(v){E.removeClass(AD.userMessage.domNode,"hideMsg");}}}AJ=q.find(AL.items,"did",AB.did);if(AJ!==-1){z=AL.items[AJ];if(AH.uneditableRights[z.rgt]){continue;}}AI.push(new mstrmojo.Obj({n:AB.n,did:AB.did,st:AB.st,rgt:AK,newItem:true}));}if(AI.length>0){var AG=q.findMulti(AL.items,"did",AI);if(AG.count){var AF=AG.indices.concat().sort(q.numSorter).slice(0,AG.count);for(AA=AF.length-1;AA>-1;AA--){AL.remove(AF[AA]);}}AL.add(AI);AH.set("hasChanged",true);}AM.set("items",[]);return true;}function P(z){var AB=[],AE=Math.floor(z/1000),AC=z%1000,AF=F,AG=B,AD=AF.length,AH,AA;for(AA=0;AA<AD;AA++){AB.push(AG[AA]);AB.push(" ");if((AC&AF[AA])>0){AB.push(mstrmojo.desc(8083,"Granted"));}else{if((AE&AF[AA])>0){AB.push(mstrmojo.desc(8084,"Denied"));}else{AB.push(mstrmojo.desc(959,"Default"));}}AB.push(",");}AH=AB.join("");return AH.substring(AH,AH.length-1);}function k(AG){var AD=[],AF=AG%1000,AB=F,AE=f,z=AB.length,AC,AA;for(AA=0;AA<z;AA++){if((AF&AB[AA])>0){AD.push(AE[AA]);AD.push(",");}}AC=AD.join("");return AC.substring(AC,AC.length-1);}function R(AB,AC){var AD=AB.items,AA=q.find(AD,AB.itemIdField,AC),AF=AB.customItem,z=AD.length-2;if(AA===-1){var AE={n:k(AC),rgt:AC};if(AF){AD.splice(z,1);}z=AD.length-1;AD.splice(z,0,AE);AB.customItem=AE;}else{if(AF&&AA!==z){AD.splice(z,1);AB.customItem=null;}}if(mstrmojo.all[Y].showACLHint!==false){AB.set("title",P(AC));}AB.value=AC;}function C(z){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[z]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}];}function S(AG,AE){var AD="";if(AE){var AA=this.widthInput.value,AH=this.heightInput.value,z=' src="'+AG,AI="",AB=this.toolbarOptions.checkBoxList,AF=AB.items,AC;for(AC=0;AC<AF.length;AC++){if(!AB.selectedIndices.hasOwnProperty(AC)){if(AI==""){AI="&hiddensections="+AF[AC].alias;}else{AI+=","+AF[AC].alias;}}}AD='<iframe width="'+AA+'" ';AD+='height="'+AH+'" ';AD+=z;AD+=AI;AD+='"></iframe>';}else{AD='<iframe width="640" height="480" src="';AD+=AG;AD+='&hiddensections=header,path,dockTop,dockLeft,footer"></iframe>';}return AD;}function n(AB){var AD=mstrmojo.string.parseUri(AB).queryKey,AE=AB.indexOf("?"),AA=AE>0?AB.substring(0,AE):AB;var z=AA.indexOf(";jsessionid");AA=z>0?AA.substring(0,z):AA;if(AD.hasOwnProperty("iframe")){delete AD.iframe;}if(AD.hasOwnProperty("validateRandNum")){delete AD.validateRandNum;}if(!AD.hasOwnProperty("server")){AD.Server=encodeURIComponent(mstrApp.serverName);}if(!AD.hasOwnProperty("Project")){AD.Project=encodeURIComponent(mstrmojo.string.decodeHtmlString(mstrApp.projectName));}if(!AD.hasOwnProperty("port")){AD.Port=mstrApp.serverPort;}if(h&&mstrConfig.shareToGuestWhenEnabled){AD.connmode=8;AD.ru=1;}if(AD.evt!=="3185"){AD.share=1;}AA+="?";for(var AC in AD){AA+=AC+"="+AD[AC]+"&";}AA=AA.substring(0,AA.length-1);return AA;}function M(z){z.select();document.execCommand("copy");z.value=z.value;mstrmojo.alert(mstrmojo.desc(15340,"The link has been successfully copied to your clipboard"));}function D(AA,z){return(r.isLibraryConfigured()&&(AA===55||(AA===18&&z&&z.contains("documentID"))));}function H(AB,AA,z){if(AA===18&&D(AA,z)){var AC=mstrmojo.string.parseUri(z).queryKey;AB=AC.documentID;}return AB;}function a(AB,AA){var AC=window.location.protocol,z="mailto:?body="+window.encodeURIComponent(AA)+"&subject="+encodeURI(AB.objectName);if(mstrApp.isSingleTier){window.FormWrapper.openPage(z);}else{if(!!W.isChrome&&AC==="https:"){window.open(z,"_self");window.setTimeout("iframe.hideWaitPage()",2000);}else{window.open(z,"mailtoIframe");}}}function L(AA){var z;switch(AA){case 199:z="read";break;case 223:z="write";break;case 255:z="full";break;case 255000:z="deny";break;default:z="custom";}return"sharingEditor-privilegeIcon "+z;}function J(AC){var z=new Date(),AB=this.objectName+" "+z.toLocaleDateString()+" "+z.toLocaleTimeString(),AA=this,AD={success:function(AG){var AF=n(AG.url);AA.topSection.authorLinkRow.authorLinkBox.set("value",AF);AA.url=AF;AA.topSection.htmlPanel.htmlLinkRow.htmlBox.set("value",S(AF));var AE=AA.topSection.authorEmail.emailLink;AE.set("url",window.encodeURIComponent(AF));AE.set("name",AA.objectName);},failure:function(AE){mstrmojo.alert(AE.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){AA.hideWait();if(AC){var AE="mailto:?body="+window.encodeURIComponent(AA.url)+"&subject="+encodeURI(AA.objectName);var AF=mstrApp.openPage||mstrmojo._IsWebApp.openPage;AF(AE,"mailtoIframe");}}};this.showWait();mstrmojo.xhr.request("POST",mstrConfig.taskURL,AD,{taskId:"savePersonalView",messageID:this.mid,objectType:this.oi.t,subName:AB,objectSubType:0,viewMode:this.viewMode||0,isPVPublic:true});}function e(AC){var AA=this.getAvailableRightsForSelection(),z=AA.length,AB;for(AB=0;AB<z;AB++){if(AA[AB].rgt===AC){return AA[AB].n;}}return mstrmojo.desc(2056,"Custom");}function Q(z){return(((z.acg&32)>0)&&((z.acg&8)>0));}mstrmojo.SharingEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SharingEditor",cssClass:"mstrmojo-SharingEditor",showSharingOptions:true,showButtonBar:true,showPublisAccess:true,hasChanged:false,help:"sharing_dialog_box.htm",zIndex:199,defaultRight:223,showButtonText:true,uneditableRights:{},currentPublicRight:199,userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),showLinkOnOpen:true,closeEditorAfterSave:true,allowHTMLTitle:true,init:function(z){Y=z.id||Y;this._super(z);},onShowLink:function(AC){var z=["libraryLink","showLink","htmlCode"];for(var AB=0;AB<z.length;AB++){if(z[AB]!==AC){var AA=this.topSection.tabDock[z[AB]];AA.set("selected",false);E.removeClass(AA.domNode,"selected");}}},showWait:mstrmojo.emptyFn,hideWait:mstrmojo.emptyFn,checkPublicAccess:function(){var AG=this.oi.acls,AB,AJ=q.find(AG,"did",I),AE=this.aclList.itemsContainerNode,AF=this.publicAccessSection.publicLabel,AD,AI=false,z=q.find(AG,"did",X),AH;if(AJ!==-1&&h&&z!==-1){var AA=AG[AJ].rgt,AC=AG[z].rgt;if(AA===AC){AI=true;AH=AC;}}if(AJ!==-1&&!h){AI=true;AH=AG[AJ].rgt;}AD=AE.children[0].tBodies;if(h&&AD[z]){E.toggleClass(AD[z].rows[0],"hide",AI);}if(AD[AJ]){E.toggleClass(AD[AJ].rows[0],"hide",AI);}AF.set("checked",AI);if(AH){this.set("currentPublicRight",AH);}},oncurrentPublicRightChange:function(){var z=this.publicAccessSection.publicMouseOver;z.publicRight.set("value",this.currentPublicRight);z.publicRightLabel.set("text",e.call(this,this.currentPublicRight));},onOpen:function(){var AK=this.oi,AB=AK.n,AI=AK.t,AL=AK.acls,AD=this.topSection,AG=AD.tabDock,AC=false;var AE=H(AK.did,AI,this.href);if(this.objectId&&this.objectId===AE&&!this.isLinkDirty){AC=true;}this.objectId=AE;this.objectName=AB;this.set("showACL",!!AL);h=this.guestModeEnabled;if(x(AK)&&this.showSharingOptions){if(!AC){if(this.href&&!this.isLinkDirty){var AA=!this.urlReady?n(this.href):this.href,AH=AD.authorEmail.emailLink;this.url=AA;AH.set("url",window.encodeURIComponent(AA));AH.set("name",AB);AD.htmlPanel.htmlLinkRow.htmlBox.set("value",S(AA));AD.authorLinkRow.authorLinkBox.set("value",AA);}else{J.call(this);this.set("isLinkDirty",false);}if(D(AI,this.href)){var AA=r.constructLibraryUrl(AE);var AJ=AD.libraryLaunchButtons.libraryEmailLink;this.libraryUrl=AA;AD.libraryLinkRow.libraryLinkBox.set("value",this.libraryUrl);AJ.set("url",window.encodeURIComponent(AA));AJ.set("name",AB);}}if(this.initTab=="shareByLinkMSTRLibrary"){this.onShowLink("libraryLink");AG.libraryLink.set("selected",true);E.addClass(AG.libraryLink.domNode,"selected");}else{if(this.initTab=="shareByLinkEmbed"){this.onShowLink("htmlCode");AG.htmlCode.set("selected",true);E.addClass(AG.htmlCode.domNode,"selected");}else{this.onShowLink("showLink");AG.showLink.set("selected",true);E.addClass(AG.showLink.domNode,"selected");}}}this.set("title",mstrmojo.desc(8093,"share").replace("##",mstrmojo.string.encodeHtmlString(AB)));if(AL){this.checkPublicAccess();var AM=this.objectInputer,AF=this.userSelector,z=AF&&AF.userBrowser;AM.zIndex=this.zIndex;if(z&&z.hasRendered){AF.opener=this;z.set("items",[]);z.getContent(z);}this.set("hasChanged",false);}this.aclList.updateScrollbars();this.positionDialog();},_set_hasChanged:function(AB,z){var AA=(z!==this.hasChanged);this.hasChanged=z;if(z===true){this.checkPublicAccess();return z;}return AA;},_set_oi:function(AA,z){this.oi=this.preProcessACLs(z);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},getAvailableRightsForSelection:function(){return C(this.oi.st);},preProcessACLs:function(AG){if(AG&&AG.acls){var AE=AG.acls,AD=AE&&AE.length,AF=V(AG),AA={},AH,z,AB,AC;if(AF){AB={};AG.inhs=AB;}for(AC=0;AC<AD;AC++){AH=new mstrmojo.Obj(AE[AC]);if(AH.den){AH.rgt=AH.rgt*1000;}if(AF&&AH.inh){AB[AH.n]=mstrmojo.hash.copy(AH);continue;}z=AA[AH.n];if(!z){z=mstrmojo.hash.copy(AH);z.rgt=0;delete z.den;AA[AH.n]=z;}z.rgt=z.rgt+AH.rgt;if(z.rgt>255000){z.rgt=Math.floor(z.rgt/1000)*1000;}}AE=mstrmojo.hash.valarray(AA);AG.acls=AE;}return AG;},getACLItems:function(){var AC=this.aclList&&this.aclList.items,AA=[];for(var AB=0,z=AC.length;AB<z;AB++){AA.push(AC[AB]);}return AA;},onClose:function(){var z=this.objectInputer;z.set("items",[]);this.aclList.clearSelect();this.onShowLink("showLink");},getACLUserDataService:function m(){return mstrmojo.ACL.UserDataService;},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",getACLUserDataService:function m(){return this.parent.opener.getACLUserDataService();},updateTreeContent:function(AA,AC){AA.contentRetrieved=true;var AB=AC[AA.itemChildrenField],z=AA.tree||AA,AE=AC.bc,AD=AC.sz,AF=AC.bb;if(AE!==-1){if(AF+AE<=AD){AB.push(z.nextItemCreaterFunc());}if((AF-AE)>-1){AB.unshift(z.prevItemCreaterFunc());}}AA.blockBegin=AF;z.initializing=true;AA.clearSelect(false);AA.set("items",AB);AA.setSelectedItems(z.getTotalSelections(),true);z.initializing=false;},selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(AA){var z=this.parent.parent,AE=z.opener,AD=AE.objectInputer,AC=z.userBrowser,AB=AC.getTotalSelections();if(AB&&AB.length>0){AD.add(AB,AD.items.length-1);}z.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(z){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var AF=this.rgt,AG=Math.floor(AF/1000),AE=AF%1000,AB=this.children,AC,AD,AA,z;for(AA=0,z=7;AA<z;AA++){AC=AB[AA];AD=AC.right;if((AE&AD)>0){AC.children[1].value=0;}else{if((AG&AD)>0){AC.children[1].value=1;}else{AC.children[1].value=2;}}}this.refresh();},getACLValue:function(){var AD=0,AE=0,AB=this.children,AC,AA,z;for(AA=0,z=7;AA<z;AA++){AC=AB[AA];if(AC.children[1].value==0){AD+=AC.right;}else{if(AC.children[1].value==1){AE+=AC.right;}}}return AE*1000+AD;},children:[g("browse",1,mstrmojo.desc(1825,"Browse")),g("read",4,mstrmojo.desc(8078,"Read")),g("write",8,mstrmojo.desc(8079,"Write")),g("delete",16,mstrmojo.desc(629,"Delete")),g("control",32,mstrmojo.desc(8080,"Control")),g("use",64,mstrmojo.desc(8081,"Use")),g("execute",128,mstrmojo.desc(8082,"Execute")),{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(z){var AA=this.parent.parent;if(AA.onOK){AA.onOK();}AA.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(z){var AA=this.parent.parent;if(AA.onCancel){AA.onCancel();}AA.close();}}]}]},children:[{scriptClass:"mstrmojo.Box",alias:"topSection",cssClass:"sharingEditor-topSection",bindings:{visible:function(){return x(this.parent.oi)&&this.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.HBox",alias:"tabDock",cssClass:"sharingEditor-tabDock",bindings:{visible:function(){return x(this.parent.parent.oi)&&this.parent.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.Label",alias:"showLink",text:mstrmojo.desc(9773,"Link"),cssClass:"SharingEditor-ShowLink",selected:false,onclick:function(z){var AA=this.parent.parent.parent;if(!this.selected){AA.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}},},{scriptClass:"mstrmojo.Label",alias:"libraryLink",text:mstrmojo.desc(15572,"Library link"),cssClass:"SharingEditor-libraryLink",selected:false,onclick:function(z){var AA=this.parent.parent.parent;if(!this.selected){AA.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}},bindings:{visible:function(){return D(this.parent.parent.parent.oi.t,this.parent.parent.parent.href);}}},{scriptClass:"mstrmojo.Label",cssClass:"SharingEditor-ShowHtml",alias:"htmlCode",text:mstrmojo.desc(9774,"Show HTML"),selected:false,onclick:function(z){var AA=this.parent.parent.parent;if(!this.selected){AA.onShowLink(this.alias);this.set("selected",true);E.addClass(this.domNode,"selected");}}}]},{scriptClass:"mstrmojo.Box",alias:"htmlPanel",cssClass:"mstrmojo-SharingEditor-html-panel",children:[{scriptClass:"mstrmojo.HBox",alias:"htmlLinkRow",cssClass:"SharingEditor-LinkRow",children:[{scriptClass:"mstrmojo.TextBox",alias:"htmlBox",cssClass:"SharingEditor-Html"},{scriptClass:"mstrmojo.Button",alias:"copyHtmlLink",cssClass:"SharingEditor-CopyHtmlLink",onclick:function(z){var AA=this.parent.htmlBox.inputNode;M(AA);},bindings:{visible:"this.parent.parent.parent.tabDock.htmlCode.selected"}}]},{scriptClass:"mstrmojo.Label",alias:"IframeSize",text:mstrmojo.desc(9735,"Size:"),cssClass:"SharingEditor-Html-Size"},{scriptClass:"mstrmojo.TextBoxWithLabel",alias:"widthInput",label:mstrmojo.desc(272,"Width:"),value:640,onvalueChange:function(z){var AA=this.parent,AB=mstrmojo.all[Y];AA.htmlLinkRow.htmlBox.set("value",S.call(AA,AB.url,true));}},{scriptClass:"mstrmojo.TextBoxWithLabel",label:mstrmojo.desc(271,"Height:"),alias:"heightInput",value:480,onvalueChange:function(){var z=this.parent,AA=mstrmojo.all[Y];z.htmlLinkRow.htmlBox.set("value",S.call(z,AA.url,true));}},{scriptClass:"mstrmojo.HBox",alias:"toolbarOptions",cssClass:"SharingEditor-toolbarRow",children:[{scriptClass:"mstrmojo.Label",alias:"IframeShow",text:mstrmojo.desc(15341,"Show:"),cssClass:"SharingEditor-Html-Show"},{scriptClass:"mstrmojo.CheckListHoriz",alias:"checkBoxList",items:[{n:mstrmojo.desc(8145,"Navigation bar"),alias:"path"},{n:mstrmojo.desc(2509,"Toolbar"),alias:"dockTop"},{n:mstrmojo.desc(8146,"Tools panel"),alias:"dockLeft"},{n:mstrmojo.desc(8147,"Footer"),alias:"footer"}],multiSelect:true,onselectionChange:function(z){var AA=this.parent.parent,AB=mstrmojo.all[Y];AA.htmlLinkRow.htmlBox.set("value",S.call(AA,AB.url,true));}}]}],bindings:{visible:"this.parent.tabDock.htmlCode.selected"}},{scriptClass:"mstrmojo.HBox",alias:"authorLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"authorLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"authorCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(z){var AA=this.parent.authorLinkBox.inputNode;M(AA);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"libraryLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"libraryCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(z){var AA=this.parent.libraryLinkBox.inputNode;M(AA);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLaunchButtons",cssClass:"SharingEditor-LaunchButtons",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-launchLink" style="{@cssText}" mstrAttach:click>'+mstrmojo.desc(15334,"Launch")+' <iframe name="launchToIframe" target="_blank" style="display:none"></iframe> </div>',alias:"launchLink",onclick:function(){var z=this.parent.parent.parent;r.createTokenAndOpenLink(z.libraryUrl);},bindings:{visible:function(){return this.parent.parent.tabDock.libraryLink.selected&&this.parent.parent.parent.oi.t==55;}}},{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"libraryEmailLink",onclick:function(){var z=this.parent.parent.parent;if(!z.libraryUrl){r.constructLibraryUrl(z.objectId);}else{a(z,z.libraryUrl);}}}]},{scriptClass:"mstrmojo.HBox",alias:"authorEmail",cssClass:"SharingEditor-LaunchButtons email",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"emailLink",onclick:function(){var z=this.parent.parent.parent;if(!z.url||z.isLinkDirty){J.call(z,true);z.set("isLinkDirty",false);}else{a(z,z.url);}}}]}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9775,"Who Has Access"),cssClass:"SharingEditor-title",bindings:{visible:"this.parent.showACL"}},{scriptClass:"mstrmojo.Label",alias:"userMessage",text:mstrmojo.desc(9771,"The permission you added is already granted"),cssClass:"sharingEditorUserMessage hideMsg",bindings:{visible:"this.parent.showACL"},onclick:function(){E.addClass(this.domNode,"hideMsg");v=false;}},{scriptClass:"mstrmojo.Box",cssClass:"sharingEditor-ACLUserPanel",bindings:{visible:"this.parent.showACL"},children:[{scriptClass:"mstrmojo.HBox",cssClass:"sharingEditor-CPSection",children:[{scriptClass:"mstrmojo.ACL.AddUserInputBox",emptyText:mstrmojo.desc(15335,"Type to add users or groups here..."),getACLUserDataService:function m(){return this.parent.parent.parent.getACLUserDataService();},noCache:true,postCreate:function(){var z=this.parent.parent.parent;if(z){this.zIndex=z.zIndex+1;}},onRender:function(){var z=this.parent.parent.parent;if(z){z.objectInputer=this;}},bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}}},s(mstrmojo.desc(1825,"Browse"),function(z){var AA=this.parent.parent.parent;AA.openPopup("userSelector",{zIndex:AA.zIndex+10});},{bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}}})]}]},{scriptClass:"mstrmojo.HBox",alias:"publicAccessSection",cssClass:"sharingEditor-publicAccessSection",bindings:{visible:"this.parent.showACL && this.parent.showPublisAccess"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"publicLabel",cssClass:"SharingEditor-Public",bindings:{label:function(){if(this.parent.parent.guestModeEnabled){return mstrmojo.desc(9776,"Public (Login not required)");}return mstrmojo.desc(9777,"Everyone (Login not required)");},enabled:function(){return Q(this.parent.parent.oi);}},oncheckedChange:function(){E.toggleClass(this.domNode.children[1],"label-disabled",!this.checked);},getUserGroupsInfo:function(){if(h){this.getUserGroupFromTaskCall(X);}this.getUserGroupFromTaskCall(I);},getUserGroupFromTaskCall:function(AF){var AB=mstrmojo.all[Y],AC=AB.aclList,AD=AB.getACLUserDataService(),AE=function(AH){var AG=new mstrmojo.Obj({n:AH.n,did:AH.did,st:AH.st,rgt:t,newItem:true});j.push(AG);},AA=function(AG){},z=function(){if(!h||(h&&j.length==2)){AC.add(j);AB.set("hasChanged",true);}};AD.getMembers({blockBegin:0,blockCount:1,outputElements:1,data:{did:AF}},{success:AE,failure:AA,complete:z});},onclick:function(){var AA=mstrmojo.all[Y];var AB=AA.aclList.items;var AC=q.find(AB,"did",I);if(AC!==-1){AB.remove(AC);}var z=q.find(AB,"did",X);if(h&&z!==-1){AB.remove(z);}if(this.checked===true){if(j.length<1){this.getUserGroupsInfo();}else{mstrmojo.array.forEach(j,function(AD){AD.rgt=t;});AB.add(j);AA.set("hasChanged",true);}}else{AA.set("currentPublicRight",t);AA.set("hasChanged",true);}}},{scriptClass:"mstrmojo.MouseOverContainer",alias:"publicMouseOver",setupSelectedItem:function A(){this.mouseoverItem=this.publicRight;this.mouseoutItem=this.publicRightLabel;},bindings:{visible:"this.parent.publicLabel.checked",enabled:function(){return Q(this.parent.parent.oi);}},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return L(this.parent.parent.parent.currentPublicRight);}}},{scriptClass:"mstrmojo.Label",alias:"publicRightLabel",cssClass:"sharingEditor-rightLabel",bindings:{text:function(){var z=this.parent.parent.parent;return e.call(z,z.currentPublicRight);},enabled:function(){return Q(this.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-pulldown",itemIdField:"rgt",alias:"publicRight",visible:false,postCreate:function(){this.items=this.parent.parent.parent.getAvailableRightsForSelection();},bindings:{value:"this.parent.parent.parent.currentPublicRight",enabled:function(){return Q(this.parent.parent.parent.oi);}},selectionPolicy:"reselect",onvalueChange:function(){var z=this.parent;var AA=z.parent.parent;z.publicRightLabel.set("text",e.call(AA,this.value));},_set_value:function(AE,AA){var AB=this.value,z=(AB!==AA);if(z){if(AA===-1){var AD=this.parent.parent.parent,AC=this;AD.openPopup("customACL",{zIndex:AD.zIndex+10,rgt:AB,twoStates:true,onOK:function(){AC.set("value",this.getACLValue());},onCancel:function(){AC.set("value",AB);}});return false;}AA=K(AA);R(this,AA);this.updatePublicRight(AA);return true;}return true;},updatePublicRight:function(AA){var AB=this.parent.parent.parent;if(AB.aclList){var AC=AB.aclList.items;var z=q.find(AC,"did",X);var AD=q.find(AC,"did",I);if(h&&z!==-1){AC[z].rgt=AA;}if(AD!==-1){AC[AD].rgt=AA;}AB.set("hasChanged",true);AB.set("currentPublicRight",AA);}}}]}]},{scriptClass:"mstrmojo.DataGrid",alias:"aclList",cssClass:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",itemIdField:"did",dropZone:true,bindings:{items:function(){return this.parent.oi.acls||[];},visible:"this.parent.showACL"},onremove:function(AA){var AE=this.parent.oi;var AD=this;window.setTimeout(function(){AD.updateScrollbars();},10);if(!V(AE)){return ;}var AF=AE.inhs,AC=AA.value,z=AC&&AC.length,AG,AB;for(AB=0;AB<z;AB++){AG=AC[AB].n;delete AF[AG];}},onadd:function(AA){var AE=this.parent.oi;var AD=this;window.setTimeout(function(){AD.updateScrollbars();},10);if(!V(AE)){return ;}var AF=AE.inhs,AC=AA.value,z=AC&&AC.length,AG,AB;for(AB=0;AB<z;AB++){AG=AC[AB].n;AF[AG]=mstrmojo.hash.copy(AC[AB]);AF[AG].inh=true;}},onACLChanged:function(AA){var z=this.parent.oi;this.parent.set("hasChanged",true);if(!V(z)){return ;}if(this.parent.childrenAccessPulldown.value==1){z.inhs[AA.n]=mstrmojo.hash.copy(AA);z.inhs[AA.n].inh=true;}},columns:[{dataFunction:function(AB,z,AA){return'<div class="mstrmojo-ACLEditor-user '+(AB.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(AB.n)+"</div>";}},{dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",alias:"mouseOverContainer",bindings:{enabled:function(){return Q(this.parent.parent.parent.oi);}},setupSelectedItem:function A(){this.mouseoverItem=this.dataGridPulldown;this.mouseoutItem=this.dataGridLabel;},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return L(this.parent.parent.data.rgt);}}},{scriptClass:"mstrmojo.Label",cssClass:"sharingEditor-rightLabel",alias:"dataGridLabel",bindings:{text:function(){return e.call(mstrmojo.all[Y],this.parent.parent.data.rgt);},enabled:function(){return Q(this.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.HBox",alias:"dataGridPulldown",cssClass:"sharingEditor-datagridContainer",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-datagridPulldown",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",popupZIndex:1001,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var z=this.parent.parent.data;this.set("value",z[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(AE,AA){var AB=this.value,z=(AB!==AA);if(z){if(AA===-1){var AD=this.parent.parent.dataGrid.parent,AC=this;AD.openPopup("customACL",{zIndex:AD.zIndex+10,rgt:AB,twoStates:!!this.parent.parent.data.newItem,onOK:function(){AC.set("value",this.getACLValue());},onCancel:function(){AC.set("value",AB);}});return false;}AA=N(AA);R(this,AA);this.parent.parent.data.set(this.itemIdField,AA);if(AB!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;},bindings:{enabled:function(){return Q(this.parent.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(z){var AA=this,AB=function(){var AC=AA.parent.parent.dataGrid;AC.remove(AA.parent.parent.data);AC.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:AB}},{zIndex:2000});},bindings:{enabled:function(){return Q(this.parent.parent.parent.parent.parent.oi);}}}]}]}}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9892,"Children Access"),cssClass:"SharingEditor-title",bindings:{visible:function(){return this.parent.showACL&&V(this.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",alias:"childrenAccessPulldown",value:0,items:[{n:mstrmojo.desc(9890,"Preserve children's access control lists"),idx:0},{n:mstrmojo.desc(9891,"Overwrite children's access control lists"),idx:1}],itemIdField:"idx",bindings:{visible:function(){return this.parent.showACL&&V(this.parent.oi);}}},{scriptClass:"mstrmojo.HBox",cssClass:"Editor-buttonBox",slot:"buttonNode",bindings:{visible:"this.parent.showButtonBar"},children:[l(mstrmojo.desc(8473,"Done"),function(z){var AA=this.parent.parent;if(p(AA)){o(AA,AA.closeEditorAfterSave);}},true,{iconClass:"mstrmojo-Editor-button-OK",bindings:{visible:"this.parent.parent.showACL",enabled:function(){return Q(this.parent.parent.oi)&&this.parent.parent.hasChanged;},text:function(){return mstrmojo.desc(8473,"Done");}},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}}),l("",function(z){var AA=this.parent.parent;AA.close();AA.set("hasChanged",false);},false,{iconClass:"mstrmojo-Editor-button-Close",bindings:{iconClass:function(){var z=this.parent.parent;if(z.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){return mstrmojo.desc(2140,"Cancel");}}})]}]});mstrmojo.ACL.AddUserInputBox=mstrmojo.declare(mstrmojo.ACL.UserInputBox,null,{scriptClass:"mstrmojo.ACL.AddUserInputBox",add:function G(AA,z){var AB=this.parent.parent.parent;this._super(AA,z);p(AB);},});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.date","mstrmojo.dom","mstrmojo.NumberFormat","mstrmojo.Button","mstrmojo.Serializer","mstrmojo.vi.ui.editors.PromptOptionEditor","mstrmojo.vi.ui.editors.ExportPDFEditor","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.util.NavUtility");var A=mstrmojo.desc,AT=mstrmojo.css,D=mstrmojo.Button.newWebButton,AE=mstrmojo.Serializer,AJ=mstrmojo.date,c=mstrmojo.func,S=mstrmojo.hash,Q=mstrmojo.array,s=mstrmojo.dom,AN=mstrmojo.NumberFormat.getInstance(mstrConfig.decimalSep,mstrConfig.thousandsSep),H="1:Width",l="2:Page",R=44,AC=28,AG=29,AA=17,u=mstrmojo.vi.util.NavUtility,w=mstrmojo.vi.enums.EnumFeatures,x=function(){return mstrmojo.locales.datetime;};function AY(AZ){u.checkSessionAndSendForm(AZ,null,"post");}function AW(Aa,Ac){var AZ=Aa.model;var Ab={evt:2048001,messageID:AZ.mid,rwb:AZ.bs};if(Ac<50||Ac===2048){Ab.visMode=0;Ab.currentViewMedia=Ac;}else{Ab.visMode=Ac;Ab.currentViewMedia=1;}AY(Ab);}function AU(){var Aa=mstrApp.pathInfo.nb,AZ=mstrmojo.array.find(Aa,"n","Return");return AZ>-1?Aa[AZ].href:null;}function v(AZ){var Aa={};Aa.evt=3198;Aa.src=mstrApp.name+".3124";AY(Aa);}function AL(Ac,Ab,Ae,Ad){var Aa=Ac.model,AZ=mstrConfig&&mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||false;AY({evt:2048030,src:Aa.bp+".2048030",rePrompt:Ab,fresh:Ae,resolveOnly:AZ,regenerate:Ad,rwb:Aa.bs});}function Y(Ai,Aa){var Ae=Ai.model,Af=(Ae&&Ae.zt)||0,Ab,Ad,AZ;switch(Af){case 1:Ab="Width";AZ=H;Ad=A(4809);break;case 2:Ab="Page";AZ=l;Ad=A(4808);break;default:Ab=(Ae&&Ae.getZoomFactor())||1;AZ=Af+":"+AN.format(Ab);Ad=parseInt(Ab*100,10)+"%";}var Ac=Ai.zoomOptions,Ag;if(Ac){var Ah=mstrmojo.array.find(Ac,"dssid",AZ);if(Ah>-1){Ag=Ac[Ah];}}if(!Ag){Ag={n:Ad,dssid:AZ,f:Ab,tp:Af};}if(Aa===true){Ai.view.zoomValue=Ag;}else{Ai.view.set("zoomValue",Ag);}}function h(Af,Ai,AZ,Aa,Ag,Ac,Ae,Ah){var Ab=Af.model,Ad=Ab&&Ab.isnew;if(!Ad&&(!Ah||!mstrmojo.resolveFeature("save-analysis")||!(Af.isDocChanged&&Af.isDocChanged()))){Ag(Ac);return ;}mstrmojo.warn(Aa,{confirmBtn:{t:mstrmojo.desc(118,"Save"),fn:function(){Af.save(Ae);}},cancelBtn:{t:mstrmojo.desc(2140,"Cancel")}},{title:Ai||mstrmojo.desc(11812,"Notification"),help:AZ});}function I(Aa){var AZ=Aa.model;AZ.showDialogBeforeSave=false;AZ.getDataService().setPreference("askBeforeSaveChanges\u001E2",{success:mstrmojo.emptyFn,failure:function(Ab){mstrmojo.alert(Ab.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}var k=-1,AV=3,r=4,AR=7,AM=10,j=18;mstrmojo._DocToolbarActions=mstrmojo.provide("mstrmojo._DocToolbarActions",{_mixinName:"mstrmojo._DocToolbarActions",staticViewMode:function z(){AW(this,1);},interactiveViewMode:function AX(){AW(this,2);},editableMode:function L(){this.model.updateWidgetsProps();AW(this,4);},flashViewMode:function J(){AW(this,8);},IVEMode:function C(){AW(this,2048);},IVEHelp:function C(){var AZ=mstrmojo.helpPath();window.open(AZ+"Displaying_a_visual_representation_of_your_data__V.htm","_blank");return true;},remainExpressViewMode:function E(){},designViewMode:function O(AZ,Aa){this.model.updateWidgetsProps();AY({evt:3104,rwDesignMode:1,convertFromVI:(Aa===true)?1:0,messageID:this.model.mid,rwb:this.model.bs,jsonMode:false});},onmodelChange:function f(){Y(this,true);},convertToDoc:function o(Aa){var AZ=this;if(AZ.model.hasMDXRADataset()){mstrmojo.alert(mstrmojo.desc(14692,'The "Convert to Document" option is currently not available for MDX cube with Hierarchical Attributes.'),null,mstrmojo.desc(3610,"MicroStrategy Web"));}else{mstrmojo.warn(mstrmojo.desc(15498,"Converting a dossier to a document cannot be undone. Do you want to convert?"),{confirmBtn:{t:mstrmojo.desc(13654,"Convert"),fn:function(){AZ.designViewMode(undefined,Aa);}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{title:mstrmojo.desc(5180,"Convert to Document")});}},saveAs:function(AZ){this.save();},save:function X(Aa,AZ){if(mstrApp.isSingleTier){FormWrapper.saveas();return ;}this.model.saveAsRW(Aa,AZ);},dSave:function t(Aj,Ad,Ai){var Ag=this,Aa=Ag.model,Ae=Aa&&Aa.isnew,Ac=Aa&&Aa.isRWReadonly,Ab=60,Af=Aa.n;if(mstrApp.isExpress){this.model.updateWidgetsProps();}if(mstrApp.isSingleTier){if(Ai){FormWrapper.savePromptOption((Aa.prompt_option>=0)?Aa.prompt_option+1:3);}else{FormWrapper.save();}return ;}if(Af.length>Ab){Af=Af.substr(0,Ab-1)+"...";}if(Ae||Ac){this.save();}else{var Ak=mstrApp.features["ask-before-save-changes"];if(Ak){var AZ="dialogBeforeSave",Ah=function(){mstrmojo.all.dialogBeforeSave.destroy();};mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:AZ,title:A(5728),cssClass:"mstrmojo-dta save",btnAlignment:"right",modal:true,visible:true,onClose:Ah,buttons:[D(A(1442),function(){var Al=mstrmojo.all[AZ];if(Al.t.ctrlChk.checked){Ag.setDontAskAgain();mstrApp.features["ask-before-save-changes"]=false;}Ag.directSave(Aj);Ah();},true),D(A(218),function(){var Al=mstrmojo.all[AZ];if(Al.t.ctrlChk.checked){I(Ag);}Ag.save();Ah();}),D(A(2140),Ah)],children:[{scriptClass:"mstrmojo.Table",alias:"t",rows:2,cols:1,children:[{scriptClass:"mstrmojo.Label",text:A(11165,"Are you sure you want to overwrite the existing copy of ##?").replace(/##/,"<b>"+Af+"</b>"),visible:true,cssClass:"ucalert",slot:"0,0",allowHTML:true},{scriptClass:"mstrmojo.CheckBox",label:A(211),alias:"ctrlChk",visible:true,checked:false,slot:"1,0"}]}]}).render();}else{Ag.directSave(Aj);}}},setDontAskAgain:function AF(){var Aa=this,AZ=Aa.model;AZ.showDialogBeforeSave=false;AZ.getDataService().setPreference("askBeforeSaveChanges\u001E0",{success:mstrmojo.emptyFn,failure:function(Ab){mstrmojo.alert(Ab.getResponseHeader("X-MSTR-TaskFailureMsg"));}});},directSave:function W(Ag){Ag=Ag||{};var Af=this,Aa=Af.model,AZ=mstrmojo.string.decodeHtmlString(Aa.n),Ad=mstrmojo.emptyFn,Ah=Ag.success||Ad,Ac=Ag.failure||Ad,Ab=Ag.complete||Ad,Ae=mstrConfig&&mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||false;mstrApp.showWait({message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress",showCancel:true});mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(Ai){var Aj=function(){if(!Ag.ignoreOrgSucc){mstrApp.showWait({message:mstrmojo.desc(13781,"Saved Successfully"),cssClass:"save-successful-waitbox",_autoClose:true,timeout:2000});}Af.cmdMgr.reset();};Aa.lastSavedStid=Aa.getDataService().stid;Aa.dty=false;Ah(Ai);if(Ai.needToGetResults){Aa.getDataService().retrieveServerJson({},c.wrapMethods(Aa.controller.getRefreshCallback(),{success:Aj}),{preserveUndo:true,style:{name:"ServerJsonRWDStyle",params:{treesToRender:3}},params:{styleName:"ServerJsonRWDStyle"}});}else{Aj();}},failure:function(Ai){var Ak=Ai.getResponseHeader("X-MSTR-TaskErrorCode"),Aj=Ai.getResponseHeader("X-MSTR-TaskFailureMsg");if(Ak==="-2147468986"||Ak==="-2147217126"||Ak==="-1"||mstrApp.isVI&&Ak<0&&Aj){mstrmojo.alert(Aj);}else{if(!Ag.ignoreOrgFail){mstrmojo.alert(A(4107));}}Ac(Ai);},complete:function(Ai){mstrApp.hideWait();Ab(Ai);}},{taskId:"saveRW",msgID:(Aa.dataService&&Aa.dataService.msgId)||Aa.mid,folderID:Aa.sfid||Aa.pfid,objName:AZ,objDesc:mstrmojo.string.decodeHtmlString(Aa.dsc),saveAsFlags:(Aa.prompt_option>=0)?Aa.prompt_option+1:3,taskEnv:"xhr",skipRebuild:Ae,taskContentType:"json"});},quickSave:function p(){this.model.saveRW();},browseParent:function m(){var AZ=this.model,Aa={evt:3010};if(!AZ.pfh){Aa.evt=2001;Aa.folderID=AZ.pfid;if(AZ.sysFolder){Aa.systemFolder=AZ.sysFolder;}}AY(Aa);},close:function e(){v(this);},openPage:function AO(Aa){var AZ=this.model;AY({evt:3124,src:mstrApp.name+"."+mstrApp.pageName+".3124",relativePageNumber:Aa,messageID:AZ.mid,rwb:AZ.bs});},saveToInbox:function d(){var Aa=this;mstrApp.serverRequest({taskId:"addDocToHistoryList",rwb:Aa.model.bs},{success:function(){var Ab=Aa.model.features;if(Ab){if(Ab.set){Ab.set("enable-add-history-list",false);}else{Ab["enable-add-history-list"]=false;}}mstrmojo.alert(A(8047));},failure:function AZ(Ab){if(Ab&&Ab.message){mstrmojo.alert(Ab.message);}else{mstrmojo.alert(A(15211));}}},{silent:true});},ShowSharingEditor:function AD(Ai){var Ac="sharingEditor",Af=mstrmojo.all[Ac],Ag=this,Ad=Ag.model,Ae=Ad.isnew,Ah=(Ai&&Ai.cls)?Ai.cls:null,Ab=Ad.getDataService().stid,AZ=function(Aj){if(Af){Af.set("oi",Aj);S.copy({objectName:Ad.n,href:null,initTab:Ah,mid:Ad.mid,isLinkDirty:Af.lastState!==Ab,lastState:Ab},Af);}else{Af=new mstrmojo.SharingEditor({guestModeEnabled:mstrApp.guestModeEnabled,mid:Ad.mid,id:Ac,oi:Aj,href:null,initTab:Ah,isLinkDirty:true,viewMode:1,lastState:Ab});}Af.open();},Aa={success:function(Aj){AZ(Aj.objects[0]);},failure:function(Aj){mstrmojo.alert(Aj.getResponseHeader("X-MSTR-TaskFailureMsg"));}};if(Ae){mstrmojo.alert(mstrmojo.desc(15513,"You must save this dossier before you can share it."),null,mstrmojo.desc(8101,"Share ..."));}else{Ad.getDataService().getObjectInfo({objectIDs:this.model.oid,objectTypes:55,includeACL:mstrApp.features?!!mstrApp.features["web-use-sharing-editor"]:false},Aa);}},annotationMode:function F(){(mstrmojo.all.annotations||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.Annotations"})).displayAnnotations(this.rootCtrl.view);},createPersonalView:function n(){var Ac=this,AZ=Ac.model,Aa=AZ&&AZ.isnew;if(Aa){mstrmojo.alert(mstrmojo.desc(15504,"You must save your dossier before continuing."),null,mstrmojo.desc(9173,"Create Personal View"));}else{var Ag=AZ.n,Ab="mstrPVD",Af={scriptClass:"mstrmojo.PersonalViewSaveAs",id:Ab,objectType:55,objectSubType:14081},Ae=mstrmojo.all[Ab]||mstrmojo.insert(Af);if(Ag){var Ad=AJ.getDateJson(new Date());Ag+=" "+AJ.formatDateInfo(Ad,x().DATEOUTPUTFORMAT)+" "+AJ.formatTimeInfo(Ad,x().TIMEOUTPUTFORMAT);Ae.set("name",Ag);}Ae.msgID=this.model.mid;Ae.open();}},reprompt:function V(){AL(this,true,false,false);},refresh:function q(){AL(this,false,false,false);},rerun:function B(){AL(this,false,true,false);},toggleAutoRefresh:function(Ac){var Ab=Ac.src,Aa=this.model.controller,AZ=Aa.isAutoRefreshStarted();Aa[(AZ?"stop":"start")+"AutoRefresh"]();Ab.set("iconClass",(AZ?"tbStart":"tbStop")+"AutoRefresh");Ab.domNode.setAttribute("title",AZ?"*Resume Auto Refresh*":"*Pause Auto Refresh*");},popPromptOption:function AH(Ac){var AZ=this.model,Ab=new mstrmojo.vi.ui.editors.PromptOptionEditor({optVal:AZ.prompt_option===undefined?2:AZ.prompt_option,onSave:function Aa(){AZ.prompt_option=this.optVal;Ac(AZ.prompt_option);}});Ab.open();},docVisualizationModeAJAX:function Z(){AW(this,51);},docVisualizationModeFlash:function AI(){AW(this,50);},sendNow:function K(){h(this,mstrmojo.desc(2331,"Send Now"),"Sending_an_analysis_in_an_email.htm",mstrmojo.desc(2513,"You must save the report/document before you can send it."),AY,{evt:3037,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:2},false);},scheduleHL:function AK(){h(this,A(5017,"Subscribe to History List"),"",A(15504,"You must save your dossier before continuing."),AY,{evt:3128,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:3},false);},scheduleEmail:function AS(){h(this,A(3282,"Schedule Delivery to E-mail"),"",A(15504,"You must save your dossier before continuing."),AY,{evt:3036,objectType:55,objectSubType:14081,messageID:this.model.mid},{saveAsOrigin:3},false);},zoomValue:null,getRequiredZoomFactor:function AB(Ag){var Af=this.model,Ac=this.view.selected,Ad=(Ac&&Ac.docLayout)||null,Aj=Ad&&(Ad.containerNode||Ad.domNode),Ab=Aj&&Aj.ownerDocument.documentElement,Ae=(Af&&Af.getZoomFactor())||1,Ah=Ae;var Aa=function(Ak){Ak-=R;if(Af.multiLayout){Ak-=AC;}if(Af.hasGroupby){Ak-=AG;}return Ak;};var AZ=function(Am){var Ak=Aj&&Aj["offset"+Am];if(!Ak){return Ae;}var Al=Math.max(1,Ab["client"+Am]);if(Am==="Height"){Al=Aa(Al);}return Math.min(4,Math.max(0.1,Math.floor(Ae*Al*100/Ak)/100));};var Ai=function(An){var Ak=Aj&&Aj.offsetHeight;if(Ak){var Al=Math.max(1,Ab.clientWidth),Am=Aa(Math.max(1,Ab.clientHeight));if(Ak*An/Ae>Math.max(1,Am)){An=Math.floor(An*(Al-AA)*100/Al)/100;}}return An;};zf=AZ("Width");if(parseInt(Ag,10)===1){zf=Ai(zf);}if(Ag===2){zf=Math.min(zf,AZ("Height"));}return zf;},zoom:function N(Ac){var Aa=(Ac!==null)?String(Ac).split(":"):[],Af=parseInt(Aa[0],10),Ag=Aa[1],AZ=AN.parse(Ag),Ab=false;if(isNaN(Af)||(!Af&&isNaN(AZ))){return ;}var Ad=this.model;if(Af===1||Af===2){Ag=AN.format(this.getRequiredZoomFactor(Af));Ab=parseInt(Math.abs((AN.parse(Ag)-Ad.getZoomFactor())*100),10)>2;}else{Ab=Ag!==AN.format(Ad.getZoomFactor());}if(Af!==Ad.zt||Ab){Ad.zoomFactorUpdating=true;var Ah=this;Ad.getDataService().setDocZoom({zoomType:Af,zoomFactor:Ag,rwb:Ah.model.bs,currLayoutKey:Ad.currlaykey},{success:function(Al){Ad.zoomFactorUpdating=false;if(Af!==0){var An=Ah.view.children,Ak;for(Ak in An){var Am=An[Ak];if(Am.k===Ah.model.currlaykey){continue;}if(Am.defn){Am.defn.loaded=false;}}}Ad.zt=Al.zt;Ad.replaceLayout(Al.currlaykey,Al);Ad.raiseEvent({name:"rebuildLayout"});Y(Ah,false);Ah=null;},failureName:"zoom.set"});}else{if((Af===1||Af===2)&&this.view.selected){Ad.zoomFactorUpdating=false;var Ae=this.view.selected.docLayout,Aj=Ae&&(Ae.containerNode||Ae.domNode),Ai=Aj&&Aj.style;if(Ai){Ai.visibility="visible";}}}},syncZoom:function(){var AZ=this.model,Aa=AN.format(AZ.getZoomFactor());mstrApp.serverRequest({taskId:"setDocZoom",rwb:AZ.bs,styleName:"EmptyStyle",zoomFactor:Aa,zoomType:AZ.zt,layoutKey:AZ.currlaykey},null);},exportCmd:function AP(Af,An,Ar,Ap){An=typeof An!=="string"?undefined:An;if(!window.FormWrapper){var Ai=this.model,Ae=this.view,AZ=(parseInt(Af,10)===k)?3130:3132,Aj=Ai.exopt,Am=Ai.huc&&Af===AR,Ah=Aj.s&&(Af===r||Af===AV)&&!An,Al=false,Aq=false;if(Ah){if(!!(Ai.defn&&Ai.defn.layouts&&Ai.defn.layouts.length>1)){Aq=true;}else{var Ad=Ae.selected,As=Ad&&Ad.gb&&Ad.children[1];Al=(!As||As.areUnitsSetToAll());if(Al){Ah=false;}}}var Ag=function(){var Av={evt:AZ,src:mstrApp.name+"."+AZ};if(AZ===3132){Av.executionMode=Af;if(An!=null){Av.gridKey=An;}if(Ar>0){Av.sliceId=Ar;}}if(!Ah){Av.rwb=Ai.bs;}else{var At=[[2048062,Ai.bp+".2048062","mode",Aj.m,"range",Aj.r],[]];S.forEach(Av,function(Ax,Aw){if(Aw==="executionMode"){At[1]=At[1].concat([Aw,Ax]);}else{At[1].push(Ax);}});Av.evt=1024001;Av.src=Ai.bp+".1024001";Av.events=AE.serializeValueGroup(At);Av["1024001"]=1;Av.messageId=Ai.mid;}Av.name=Date.parse(new Date());var Au=function(){var Aw=(!(Aj.n)&&Af===AV&&(s.isIE||s.isIEW3C))?"GET":"POST";u.checkSessionAndSendForm(Av,null,Aw,(Aj.n)?"_blank":"mstrExportWindow");};if(!s.isIE||Af!==AR){Au();}else{mstrmojo.alert(A(5873),Au);}};var Ac;if(Ah||Am){Ac=function(){var Au="mojoExOpx9",At=function(){mstrmojo.all.mojoExOpx9.destroy();};mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:Au,title:A(971),cssClass:"mstrmojo-dta export",btnAlignment:"right",onClose:At,draggable:false,buttons:[D(A(1442),function(){var Av=mstrmojo.all[Au];if(Aq){Aj.r=Av.ctrlLyt.selectedIndex;}if(!Al){Aj.m=(Av.ctrlChk.checked)?0:1;}At();Ag();},true),D(A(2140),At)],children:[{scriptClass:"mstrmojo.Label",cssClass:"ucalert",text:A(7482),visible:Am},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"exp_opts",cssDisplay:"block",alias:"ctrlLyt",visible:!!Aq,selectedIndex:Aj.r,items:[{n:A(14583),v:0},{n:A(14582),v:1}]},{scriptClass:"mstrmojo.CheckBox",label:A(5165),cssDisplay:"block",alias:"ctrlChk",visible:!mstrApp.isVI&&!Al&&Ah,checked:(Aj.m===0)}]}).render();};}if(Af===r&&Aj.ds["3809"]!==undefined&&!An){mstrmojo.confirm(A(3809),{confirmBtn:{fn:Ac||Ag,t:A(1442)},cancelBtn:{t:A(2140)}});}else{if(mstrApp.isVI&&Ap&&Af==AV){var Aa;if(An){Aa=mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings;}var Ak=function(Av){var Aw={evt:3132,src:mstrApp.name+"."+3132};Aw.executionMode=AV;if(An){Aw.gridKey=An;}var At=[[2048062,Ai.bp+".2048062"],[]];S.forEach(Av,function(Ay,Ax){At[0].push(Ax);At[0].push(Ay);});S.forEach(Aw,function(Ay,Ax){if(Ax==="executionMode"){At[1]=At[1].concat([Ax,Ay]);}else{At[1].push(Ay);}});Aw.evt=1024001;Aw.src=Ai.bp+".1024001";Aw.events=AE.serializeValueGroup(At);Aw["1024001"]=1;if(Ai.mid){Aw.messageId=Ai.mid;}Aw.name=Date.parse(new Date());var Au=function(){u.checkSessionAndSendForm(Aw,null,"post",(Ai.n)?"_blank":"mstrExportWindow");};if(!s.isIE||Af!==AR){Au();}else{mstrmojo.alert(A(5873),Au);}};var Ab=new mstrmojo.vi.ui.editors.ExportPDFEditor({exOpts:Aa,exportHandler:Ak,singleVis:!!An});Ab.open();}else{if(!Ap&&Ac){Ac();}else{Ag();}}}}else{if(An!==undefined){var Ao={3:{mode:"2",version:""},4:{mode:"1",version:"4"},10:{mode:"5",version:""}};FormWrapper.doExport(Ao[Af].mode,Ao[Af].version,An);}}},printPDF:function U(AZ){var Aa=this;if(window.FormWrapper){Aa.exportCmd(AV,AZ,null,true);}else{mstrApp.featureFlagsCache=mstrApp.featureFlagsCache||{};if(mstrApp.featureFlagsCache["EE/NewEEExportOption"]===undefined){mstrmojo.xhr.request("POST",mstrConfig.taskURL,{success:function(Ab){mstrmojo.hash.copy(Ab,mstrApp.featureFlagsCache);Aa.exportCmd(AV,AZ,null,Ab["EE/NewEEExportOption"]);}},{taskId:"getNeeFeatureFlags"});}else{Aa.exportCmd(AV,AZ,null,mstrApp.featureFlagsCache["EE/NewEEExportOption"]);}}},exportExcel:function g(AZ){this.exportCmd(r,AZ);},exportCSV:function P(AZ){this.exportCmd(AM,AZ);},exportHTML:function b(){this.exportCmd(k);},exportMSTR:function a(){var Ac=this,Ad=Ac.isDocChanged&&Ac.isDocChanged(),Aa=mstrmojo.resolveFeature(w.SAVE_ANALYSIS),Ab=Ad?Aa:true,AZ=function AZ(Ae){Ac.exportCmd(Ae);};if(Ab){h(this,null,"",A(15504,"You must save your dossier before continuing."),AZ,j,{saveAsOrigin:14},true);}else{mstrmojo.alert(A(12933,"You do not have enough privileges to perform this operation"));}},openHome:function G(AZ){AY({evt:3010,src:mstrApp.name});},updateZoom:function M(){Y(this,false);},resetSelections:function AQ(){var Ab=this,Aa=Ab.model,AZ=!!Aa.hasGroupby;Aa.getDataService().resetSelections(null,AZ,{success:function(Af){var Ai=Ab.view.children,Ac=(Ai&&Ai.length)||0,Aj=Aa.getCurrentLayoutKey(),Ae;for(Ae=0;Ae<Ac;Ae++){var Ag=Ai[Ae];if(Ag.defn&&Ag.defn.loaded&&Aj!==Ag.k){Ag.defn.loaded=false;}}if(AZ){Aa.loadLayout(Af);return ;}if(Af.pukeys){var Ah=Aa.partialUpdate(Af.data,Aa.getUnitDefinitions(Af.pukeys)),Ad=Aa.getLayoutDataCache(Aa.getCurrentLayoutKey());S.forEach(Ah.upd,function(Am,Ao){var Al=mstrmojo.all[Ao];if(Al&&Al.defn&&Al.defn.t===mstrmojo.EnumRWUnitType.PANELSTACK){var Ak=Ad&&Ad[Ao]&&Ad[Ao].data,An=Ak&&Ak.selKey;if(An&&Al.selectedKey!==An){Al.defn.set("selKey",An);}Al.setDirtyChildren();}});}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.css","mstrmojo.AjaxCall","mstrmojo.hash","mstrmojo.array","mstrmojo.expr","mstrmojo.Label","mstrmojo.ListBase","mstrmojo.ui.CheckList","mstrmojo.ui.ColumnContainer","mstrmojo.rw.ConditionWalkProviderBase","mstrmojo.elementHelper");var G=mstrmojo.css,X=mstrmojo.hash,s=mstrmojo.array,W=mstrmojo.expr,M=W.ET,Z=W.ET2TGT,Y=W.FN,S=W.FN_MRP,n=W.DTP2FN_DTP,E=mstrmojo.meta.TP,AA=W.TP,J=W.STP,l=mstrmojo.elementHelper,q=mstrmojo.rw.ConditionWalkProviderBase;var P={};P[M.AQ]={target:1,fm:1,fn:1,c0:1,c1:1};P[M.AL]={target:1,fm:1,fn:1,c0:1};P[M.AE]={target:1,fm:1,es:1};P[M.AC]={target:1,fm:1,fm2:1,fm3:1,fn:1,c0:1,c1:1};P[M.MQ]={target:1,fn:1,c0:1,c1:1,dmy:1};P[M.MC]=P[M.MQ];P["*"]={target:1};var v={};v[M.MQ]={key:"metricFns",def:W.METRIC_FNS};v[M.MC]={key:"metricFns",def:W.METRIC_FNS};v[M.AQ]={key:"formFns",def:W.FORM_FNS};v[M.AL]={key:"formFns",def:W.FORM_FNS};v[M.AC]={key:"formFns",def:W.FORM_FNS};v[M.AE]={key:"elemFns",def:W.ELEM_FNS};var AF=mstrmojo.desc(14084,"Select a filter option or a qualification."),AE=mstrmojo.desc(15007,"Choose to select in list or qualify on an attribute form."),AD=mstrmojo.desc(14085,"Select one or more elements."),N=mstrmojo.desc(15009,"Select element(s)."),AC=mstrmojo.desc(14086,"Select an operator."),AB=mstrmojo.desc(14087,"Enter a value or select an attribute from the list."),C=mstrmojo.desc(15010,"Enter a specific value or select an attribute form as variable."),z=mstrmojo.desc(14088,"Select an attribute form. When done, click ## button.").replace("##",'"√"'),x=mstrmojo.desc(14089,"Select a condition."),AH=mstrmojo.desc(15011,"Select an operator."),w=mstrmojo.desc(14090,"Enter a value or select a metric from the list."),R=mstrmojo.desc(15012,"Enter a specific value or select a metric as variable.");var k=0,r=1;var H=mstrmojo.ui.ColumnContainer.prototype.updateColumnContainer;var e="dummy",I={did:"idErr",v:"idErr",n:mstrmojo.desc(7929,"Error loading data."),t:e,css:"unselectable"},p={did:"idWait",v:"idWait",n:mstrmojo.desc(2901,"Loading..."),t:e,css:"unselectable"},AG={did:"idSelect",v:"idSelect",n:mstrmojo.desc(547,"Select"),t:e,css:"unselectable"},u={did:"idWait",v:"idQualification",n:mstrmojo.desc(5225,"Qualification"),t:e,css:"unselectable"},D={did:"idWait",v:"idQualification",n:mstrmojo.desc(15008,"Qualify on"),t:e,css:"unselectable"};var b=q.onWalkChange,F=q.replaceItem,L=q.getChildJSON,t=q.walkChildPostCreateFn,o=q.updateList,AL=q.fnItem,AK=q.isComparisonAllowed,h=q.cstJson,f=q.fmJson,d=q.updateListMulti,m=q.updateListMultiData;function j(AM){return AM.targets?s.filter(AM.targets,function(AN){return AN[E]===W.TP.ATTR;}):[];}function K(AM){this.tip.set("text",AM);}var V=[W.STP.PROMPT,W.STP.PROMPT_OBJECTS,W.STP.PROMPT_ELEMENTS,W.STP.PROMPT_EXPRESSION,W.STP.PROMPT_EXPRESSION_DRAFT];var AJ=q.allowedTargetTypes;mstrmojo.rw.ConditionWalkProvider=mstrmojo.declare(mstrmojo.rw.ConditionWalkProviderBase,null,{scriptClass:"mstrmojo.rw.ConditionWalkProvider",browseEs:function c(AP,AO,AR){AP.openPopup("eb",{zIndex:AP.parent.zIndex+10,left:Math.round(AR.x)+"px",top:Math.round(AR.y)+"px"});var AN=AP.eb.browser,AM=AP.model,AQ=AM&&AM.a&&AM.a.did;if(!AQ){return ;}AN.set("attributeID",AQ);AN.set("selectedItems",AM.es?X.clone(AM.es):[]);AN.initBrowser();},browseObjs:function AI(AT,AM,AN){AT.openPopup("ob",{zIndex:AT.parent.zIndex+10,left:Math.round(AN.x)+"px",top:Math.round(AN.y)+"px"});var AO=AT.ob.browser;AO.target=AM;var AP;switch(AM.alias){case"dmy":AP=[W.TP.ATTR,W.TP.DIM];break;case"c0":case"c1":var AR=AT.model,AQ=AR&&AR.et,AU=AR&&AR.fm,AS=AU&&AU.dtp||(AR.m?W.DTP.DECIMAL:W.DTP.UNKNOWN);AP=(AQ===M.MQ||AQ===M.MC)?[W.TP.METRIC,W.DTP2PROMPT_STP[AS]]:[W.TP.ATTR,W.DTP2PROMPT_STP[AS]];break;default:AP=AJ(AT.ets);AP=AP?X.keyarray(AP,true):[W.TP.ATTR,W.TP.METRIC,W.STP.REPORT_GRID,W.STP.REPORT_GRAPH,W.STP.REPORT_ENGINE,W.STP.REPORT_TEXT,W.STP.REPORT_DATAMART,W.STP.REPORT_BASE,W.STP.REPORT_GRIDGRAPH,W.STP.REPORT_NONINTERACTIVE,W.STP.FILTER].concat(V);}AP[AP.length]=W.TP.FOLDER;AO.browse({rootFolderType:AR&&(AR.et===M.MQ||AR.et===M.MC)?5:26,folderLinksContextId:33,onSelectCB:[AT,"onOBSelect"],browsableTypes:AP.join(",")});},getFm2NodeProps:function U(){return{alias:"fm2",children:[f({alias:"fm2",fmPost:2})],updateColumnContainer:function AM(){var AN=this.parent.parent;if(this.domNode){G.addClass(this.domNode,"lastStage");}this.fm2.update();K.call(AN,z);H.call(this);}};},getC0NodeProps:function Q(){var AM=this;return{alias:"c0",c1Selected:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(527,"Value")},h({alias:"c0",cstIndex:0}),{scriptClass:"mstrmojo.Label",alias:"btwn",cssClass:"btwn",text:mstrmojo.desc(308,"and"),visible:false},h({alias:"c1",cstIndex:1,visible:false}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.c0);},visible:false}],updateColumnContainer:function AN(){this.c0.update();var AX=this.parent,AT=AX.parent,AS=AX.parent.model,AV=AS&&AS.fn,AP=AV===Y.BETWEEN||AV===Y.NOT_BETWEEN||AV===S.BETWEEN||AV===S.BETWEEN_DESCENDING,AU=AV===Y.EQUAL||AV===Y.NOT_EQUAL||AV===Y.GREATER||AV===Y.GREATER_EQUAL||AV===Y.LESS||AV===Y.LESS_EQUAL,AW=this.idx,AR=this.next;this.browseLink.set("visible",AT.objectBrowsingEnabled&&AK(AS,AT.ets));this.btwn.set("visible",AP);this.c1.set("visible",AP);if(AP){this.c1.update();}else{AS.edit("c1",{v:null,dtp:null,skipET:true},true);}if(AS.a2&&AU){if(!(AR&&AR.fm2)){AX.insertAndRemoveTrailing(AW,AM.getFm2NodeProps());}}else{AX.removeTrailingContainer(AW);}var AQ=mstrApp.isWSStyling?C:AB,AO=mstrApp.isWSStyling?R:w;K.call(AT,AS.a?AQ:AS.m?AO:"");if((!AS.a)&&AS.m&&this.domNode){G.addClass(this.domNode,"lastStage");}H.call(this);}};},getFnNodeProps:function a(){var AM=this;return{alias:"fn",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrApp.isWSStyling?mstrmojo.desc(15006,"Operator"):mstrmojo.desc(9579,"Condition")},f({alias:"fn",allowUnlistedValues:false,update:function(){var AT=this.parent.parent.parent,AP=AT.model||{},AU=AP.et,AS,AV=false,AW,AO;switch(AU){case M.AE:AV=!!AP.a;break;case M.AQ:case M.AC:case M.AL:AV=!!(AP.fm&&AP.fm.did);AS=AV?AP.fm.dtp:null;break;case M.MQ:case M.MC:AV=!!AP.m;AS=AV?W.METRIC_DTP:null;break;}if(AV){var AX=n[AS];if((this.lastEt!==AU)||(this.lastFnDtp!==AX)){this.lastEt=AU;this.lastFnDtp=AX;var AR=AU?v[AU]:null,AQ=AR&&AR.key;AW=(AQ&&AT[AQ])||AR.def||[];if(typeof (AW)==="object"){AW=AW[AX]||AW["*"];}}AO=AL(AP.fn,AP.fnt||1);}o(this,AV,AW,AO);this.parent.updateScrollbars();}})],updateColumnContainer:function AN(){this.fn.update();var AO=this.parent,AP=AO.parent,AQ=AP.model,AS=AQ&&AQ.fn,AR=this.next,AU=AS===Y.IS_NULL||AS===Y.IS_NOT_NULL;if(AS&&AU){AO.removeTrailingContainer(this.idx);}else{if(AS&&!(AR&&AR.c0)){AO.insertAndRemoveTrailing(this.idx,AM.getC0NodeProps());}}var AT=mstrApp.isWSStyling?AH:x;K.call(AP,AQ.a?AC:AQ.m?AT:"");AR=this.next;if(AR){AR.updateColumnContainer();}}};},getEsNodeProps:function B(){var AO=[{scriptClass:"mstrmojo.ui.CheckList",alias:"es",itemIdField:"v",allowUnlistedValues:true,insertUnlistedValuesAt:0,selectionPolicy:"toggle",postCreate:function AN(){t.apply(this,[]);this.ajx=mstrmojo.insert({parent:this,scriptClass:"mstrmojo.AjaxCall",isTask:true,params:{taskId:"browseElements",attributeID:null,styleName:"MojoAttributeStyle",blockBegin:1,blockCount:mstrApp.elementsBlockCount||30},onsuccess:function(){var AZ=this.parent,AT=this.response;if((AT&&AT.did)!==AZ.lastAttrId){return ;}var AV=(AT&&AT.es)?s.filter(AT.es,function(Aa){return !l.isNullElem(Aa.v);}):[],AY=AZ.parent.parent.parent.model&&AZ.parent.parent.parent.model.es,AW=function(Ag,Ab){var Af=Ag&&Ag.length||0,Ae=Ab&&Ab.length||0,Aa=[],Ad,Ac;for(Ad=0;Ad<Ae;Ad++){for(Ac=0;Ac<Af;Ac++){if(Ab[Ad].n===Ag[Ac].n){break;}}if(Ac===Af){Aa.push(Ab[Ad]);}}return Aa;},AX=function(Aa,Ab,Ae){var Ad=[],Ac;s.forEach(Aa,function(Af){Ac=s.filterOne(Ab,function(Ag){return Af[Ae]&&Ag[Ae]&&Af[Ae]===Ag[Ae];});if(Ac){Ad.push(Ac);}});return Ad.length===Aa.length?Ad:Aa;};AY=AY&&AX(AY,AV,"v");if(AZ.allowUnlistedValues){var AU=AW(AV,AY);AV=(AZ.insertUnlistedValuesAt===0)?AU.concat(AV):AV.concat(AU);}m(AZ,AV,AY,null);AZ.parent.updateScrollbars();},onerr:function(){F(this.parent,p,[I]);}});},onselectionChange:function AR(AT){mstrmojo.ListBase.prototype.onselectionChange.call(this,AT);b.call(this,AT);},update:function AQ(){var AW=this.parent.parent.parent,AV=AW.model,Aa=AV&&AV.a,Ab=!!Aa&&!Aa.ilk,Ac,AT,AZ,AX,AU,Ad;if(Ab){if(this.lastAttrId!==Aa.did){this.lastAttrId=Aa.did;Ac=AV.es;AX=Ac&&Ac.length;Ac=AX?Ac.concat():[];Ac.push(p);if(AX){AZ=[];for(AU=1;AU<=AX;AU++){AZ[AU]=AU;}}Ad=this.ajx;AW.updateBrowseElementsParams(Ad.params,Aa);}else{AT=AV.es;}}d(this,Ab,Ac,AT,AZ);if(Ab&&Ad){if(AW.getElements){var AY=this;AW.getElements(Aa,{success:function(Ae){m(AY,Ae.es||[],AW.model&&AW.model.es,null);AY.parent.updateScrollbars();},failure:function(){F(AY,p,[I]);}});}else{Ad.send();}}},setupScrollNodes:function AP(){this.scrollNode=null;}}];if(!mstrApp.isSingleTier){AO.splice(0,0,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7928,"Browse elements..."),onclick:function AM(){this.parent.parent.parent.browse(this.parent.es);}});}return{alias:"es",children:AO,updateList:function(AT){d(this.es,true,AT,this.parent.parent.model.es,null);this.updateScrollbars();},updateColumnContainer:function AS(){var AT=this.parent.parent;if(this.domNode){G.addClass(this.domNode,"lastStage");}this.es.update();K.call(AT,mstrApp.isWSStyling?N:AD);}};},getFmNodeProps:function O(){var AM=this;return{alias:"fm",children:[f({alias:"fm",fmPost:"",filter:false,isFirstFm:true})],updateColumnContainer:function AN(){this.fm.update();var AX=this.parent,AS=AX.parent,AR=AS.model,AU=AR&&AR.fm,AW=this.idx,AV=AR&&AR.a,AP=AS.disableElementsBrowsing,AO=AV&&AP&&AP(AV);var AT=(AR.etWas&&AR.etWas===M.AE)?r:k,AQ=k;if(AR.et===M.AE&&!AO){AQ=r;}if(AT!==AQ||AQ===k){AX.removeTrailingContainer(AW);if(AQ===k&&AU){AX.addNextColumn(AM.getFnNodeProps());}else{if(AQ===r){AX.addNextColumn(AM.getEsNodeProps());}}}K.call(AS,mstrApp.isWSStyling?AE:AF);H.call(this);}};},getTargetNodeProps:function g(){var AM=this;return{alias:"target",target:null,browseLink:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(11859,"Based On")},L({alias:"target",insertUnlistedValuesAt:0,makeObservable:true,hideIfEmpty:true,postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},onObjBrowsed:function(AP){if(AP.st===J.FILTER||AP.t===AA.REPORT||AP.t===AA.PROMPT){this.parent.parent.parent.onOK();}},update:function AO(){var AQ=this.parent.parent.parent,AR=AQ.model,AU=AQ.targetsLastMod,AV=AR&&AR.et;if(this.lastModel!==AR||this.targetsLastMod!==AU){this.lastModel=AR;this.targetsLastMod=AU;var AP=AQ.targets,AW=AQ.ets;if(AW&&AP&&AP.length){var AT=AJ(AQ.ets);AP=s.filter(AP,function(AX){return AT[AX[E]];});}var AS=AR&&AR[Z[AV]];o(this,true,W.getSortedObjectsByTypeGroup(AP),AS);this.parent.updateScrollbars();}}}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.target);}}],updateColumnContainer:function AN(){this.target.update();var AQ=this.parent,AR=AQ.parent,AS=AR.model,AU=AS&&AS.et,AP=this.idx,AT=this.next;this.browseLink.set("visible",AR.objectBrowsingEnabled);if(AU){switch(AU){case M.AQ:case M.AL:case M.AC:case M.AE:if(AS.a&&!(AT&&AT.fm)){this.parent.insertAndRemoveTrailing(AP,AM.getFmNodeProps());}break;case M.MQ:case M.MC:if(AS.m&&!(AT&&AT.fn)){this.parent.insertAndRemoveTrailing(AP,AM.getFnNodeProps());}break;case M.R:case M.F:case M.XML:this.parent.removeTrailingContainer(AP);break;}}AT=this.next;if(AT){AT.updateColumnContainer();}}};}});var A=mstrmojo.rw.ConditionWalkProvider;A.setTip=K;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi.ui._IsPanel","mstrmojo.dom","mstrmojo.css");var G=mstrmojo.dom;mstrmojo.vi.ui.PanelPortlet=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsPanel],{scriptClass:"mstrmojo.vi.ui.PanelPortlet",init:function H(I){this._super(I);if(!!mstrApp.isWSStyling){this.paddingCfg={levelDiff:10,paddingLeft:8};}mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIPanelPortlet");this.markupMethods=mstrmojo.hash.copy(this.markupMethods,{onenabledChange:mstrmojo.Widget.enabledMarkupMethod});},layoutConfig:{h:{titlebarNode:"20px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},showTitleBarContextMenu:false,preOpenContextMenu:mstrmojo.emptyFn,canCollapse:true,level:null,onCollapsedChange:mstrmojo.emptyFn,panelId:"",ignoreLayout:true,paddingCfg:{levelDiff:13,paddingLeft:9},togglePortlet:function F(I){if(this.canCollapse){this.titleBar.set("isCollapsed",I);}},customizeTitleBarCfg:function A(I){return I;},getTitleBarCfg:function D(){var I=this._super(),J=this;I.canCollapse=this.canCollapse;I.cssClass="small";I.editTitleOnDoubleClick=false;if(this.showTitleBarContextMenu){I.oncontextmenu=function(K){G.preventDefault(window,K.e);var L=K.getTarget();if(G.contains(this.textNode,L,true,this.domNode)){K.cancel();this.tbToolbar.closePopup();var M=this.getMenuConfig();if(M){M.hostId=this.tbToolbar.id;M.hostElement=this.tbToolbar.domNode;M.position=G.getMousePosition(K.e,K.hWin);J.preOpenContextMenu();this.tbToolbar.openPopup(M.newInstance());M.position=null;}}};}I.onToggleCollapseByUI=function(){J.onCollapsedChange();};return this.customizeTitleBarCfg(I);},onRender:function E(){this._super();if(this.level!==null){this.titleBar.leftToolNode.style.paddingLeft=(this.paddingCfg.paddingLeft)+this.level*(this.paddingCfg.levelDiff)+"px";this.titleBar.doLayout();}},updateToolbar:function C(I){var K=this;this.addMenuItems(I);I.preShowMenu=function(){K.preOpenContextMenu();};var J=this.panelId;if(J){mstrmojo.all[J].addPopupHandlers(I);}return this._super(I);},addMenuItems:function B(I){},getLayoutOffsets:function(){var I=this.portletSrc;return(I&&I.scriptClass==="mstrmojo.gmaps.MapLayerZone")?{h:0,w:26}:{h:0,w:18};}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi.ui._IsPanel","mstrmojo._HasBuilder","mstrmojo._IsPanelStack","mstrmojo.vi.ui.rw._SavesChildPositions","mstrmojo.vi.ui.rw._IsPanelStack");mstrmojo.vi.ui.rw.DocVIPanelStack=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsPanel,mstrmojo._HasBuilder,mstrmojo._IsPanelStack,mstrmojo.vi.ui.rw._IsPanelStack,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocVIPanelStack",layoutConfig:{h:{titlebarNode:"0px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.array","mstrmojo.hash","mstrmojo.color","mstrmojo._HasLayout","mstrmojo.vi.ui._IsPanel","mstrmojo._HasPopup","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._HasTargets","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo._Formattable","mstrmojo.vi.ui._IsUnitContainerTitleBar","mstrmojo.DynamicClassFactory","mstrmojo.Box","mstrmojo.css","mstrmojo.dom","mstrmojo.func","mstrmojo.models.FormatModel","mstrmojo.DocDataService","mstrmojo.vi.ui.TitleBar","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.vi.ui.rw._HasVisFilterIndicator","mstrmojo.EnumRWUnitType","mstrmojo.vi.ui._CanGroup","mstrmojo.EnumRWUnitType");mstrmojo.requiresDescs(629,1388,11477,11478);var W=mstrmojo.array,A2=mstrmojo.css,AP=mstrmojo.dom,Z=mstrmojo.hash,AG=mstrmojo.color,A8=mstrmojo.vi.models.EnumDragSources,m=mstrmojo.models.FormatModel,g=m.ENUM_PROPERTY_NAMES,Aj=1,AL="visible",k="mouse-left",A0="no-menu",AW="ctrlOverlay",p="or-v",H="or-h";var Am={SHORT:"ghost-short",TALL:"ghost-tall",GRANDE:"ghost-grande",VENTI:"ghost-venti",HIDE_TITLE:"ghost-hide-title",HIDE_DESC:"ghost-hide-desc"};var b={BLACK:"ghost-black",WHITE:"ghost-white",GREY:"ghost-grey"};var D=Z.valarray(Am);var c=Z.valarray(b);var U=D.concat(c);var j={W_LV1:{H_LV1:[Am.VENTI],H_LV2:[Am.GRANDE],H_LV3:[Am.TALL],H_LV4:[Am.TALL,Am.HIDE_TITLE],H_LV5:[Am.SHORT,Am.HIDE_TITLE],H_LV6:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC]},W_LV2:{H_LV1:[Am.GRANDE],H_LV2:[Am.GRANDE],H_LV3:[Am.TALL],H_LV4:[Am.TALL,Am.HIDE_TITLE],H_LV5:[Am.SHORT,Am.HIDE_TITLE],H_LV6:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC]},W_LV3:{H_LV1:[Am.TALL],H_LV2:[Am.TALL],H_LV3:[Am.TALL],H_LV4:[Am.TALL,Am.HIDE_TITLE],H_LV5:[Am.SHORT,Am.HIDE_TITLE],H_LV6:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC]},W_LV4:{H_LV1:[Am.SHORT],H_LV2:[Am.SHORT],H_LV3:[Am.SHORT],H_LV4:[Am.SHORT,Am.HIDE_TITLE],H_LV5:[Am.SHORT,Am.HIDE_TITLE],H_LV6:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC]},W_LV5:{H_LV1:[Am.SHORT],H_LV2:[Am.SHORT],H_LV3:[Am.SHORT],H_LV4:[Am.SHORT,Am.HIDE_TITLE],H_LV5:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC],H_LV6:[Am.SHORT,Am.HIDE_TITLE,Am.HIDE_DESC]}};function Af(BC){var BF=BC?BC.c1||BC:"",BE=AG.getLuminance(BF),BB=255,BG=68.7914,BD=Math.max(BB/BE,BE/BB),BH=Math.max(BG/BE,BE/BG);if(BD>=BH){return b.WHITE;}if(BE<190){return b.BLACK;}return b.GREY;}function A1(BF,BC){var BH,BG,BE;if(BF>=1024){BH="W_LV1";}else{if(BF>=640){BH="W_LV2";}else{if(BF>=320){BH="W_LV3";}else{if(BF>=100){BH="W_LV4";}else{BH="W_LV5";}}}}if(BC>=1024){BG="H_LV1";}else{if(BC>=640){BG="H_LV2";}else{if(BC>=320){BG="H_LV3";}else{if(BC>=200){BG="H_LV4";}else{if(BC>=100){BG="H_LV5";}else{BG="H_LV6";}}}}}BE=j[BH][BG];if(this.getFormats){var BB=this.getFormats(),BD=BB&&BB["background-color"];BE=BE.concat(Af(BD));}return BE;}mstrmojo.vi.ui.rw.UnitContainerTitleBar=mstrmojo.DynamicClassFactory.newComponent(mstrmojo.vi.ui.TitleBar,[mstrmojo.vi.ui._IsUnitContainerTitleBar],{scriptClass:"mstrmojo.vi.ui.rw.UnitContainerTitleBar"});var Ap={n:mstrmojo.desc(11477,"Hide Titlebar"),cls:"htb",fn:function(){this.toggleTitleBar(false);},dsbld:false};var A4={n:mstrmojo.desc(11478,"Show Titlebar"),cls:"stb",fn:function(){this.toggleTitleBar(true);},dsbld:false};function R(BC,BB,BD){var BE=mstrApp.isAppStatePresentation(),BF=this.domNode;A2.toggleClass(this.domNode,"pulse",BC&&!BE&&!BD);if(BB){setTimeout(function(){A2.toggleClass(BF,"pulse",false);},500);}}function Ax(BC,BB){return mstrmojo.all[BC].getPanel().getUnitByKey(BB);}function s(){var BD=this.menuBtnInfo,BF=BD&&BD.menuCfg,BC=BF&&BF.menus,BE=(BC&&BC.length>0),BB=BD&&BD.btn;if(BB){BB.style.display=BE?"block":"none";}A2.toggleClass(this.domNode,A0,!BE);}function A5(BB,BD){var BC=this.getContextDragData(BB);return !!(BC&&(BC.src===BD));}function v(BB){return A5.call(this,BB,A8.FILTERS);}function AR(BB){return A5.call(this,BB,A8.DATASETS);}function AH(BB){return A5.call(this,BB,A8.ALL_OBJECT_LIST);}function Ay(BB){var BC=BB.children;if(BC&&BC.length){BB.removeChildren();BC.forEach(function(BD){BD.destroy();});}}function O(){var BB=this.boxContent;if(BB&&BB.getFormats){return BB.getFormats();}return null;}function Ar(BB){if(BB.visible){if(BB.controls){this.showControlOverlay(BB.controls);}else{throw new Error('mstrmojo.vi.ui.rw.UnitContainer: "controls" should be provided when showing the control overlay');}}else{this.hideControlOverlay();}}function Ai(BF,BC){var BD=this.model.controller,BE="propertiesPanel",BB=function(){var BH=this.getFormatMenuItemTarget(BF);var BJ=this.getEditorModel();if(BJ.selectTargetByValue){BJ.selectTargetByValue(BH);}if(BC){BC(BH);}var BG=BD.getViPanel(BE),BI=BG&&BG.parent;if(BI&&BI.highlightSelected){BI.highlightSelected();}}.bind(this);if(BD.getViPanel(BE)){BD.selectViPanel(BE);BB();}else{BD.openViPanel(BE,{success:BB});}}function K(BD,BB){var BC=BD?"titlebarNode":"domNode";this.clearCache();this.clearSlotBackgroundCSS(BC);this.applyCSSFormatToNode(BC,BB);}mstrmojo.vi.ui.rw.UnitContainer=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._Formattable,mstrmojo._HasPopup,mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.vi.ui._HasTargets,mstrmojo.vi.ui.rw._HasVisFilterIndicator,mstrmojo.vi.ui._CanGroup],{scriptClass:"mstrmojo.vi.ui.rw.UnitContainer",markupString:'<div id="{@id}" class="mstrmojo-UnitContainer {@cssClass}" style="{@cssText} {@domNodeCssText}" mstrAttach:mouseenter,mouseleave,mouseover,mouseout,mousemove,click,contextmenu><div class="mstrmojo-UnitContainer-titlebar" style="{@titlebarNodeCssText}"></div><div class="mstrmojo-UnitContainer-content"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,ontopChange:mstrmojo.Widget.topMarkupMethod,onleftChange:mstrmojo.Widget.leftMarkupMethod,onzIndexChange:function(){this.domNode.style.zIndex=this.zIndex||Aj;},onenabledChange:function(){A2.toggleClass(this.domNode,"inactive",!this.enabled);},onorientationChange:function(){var BC=this.ctrlOverlay.domNode,BB=this.orientation;A2.toggleClass(BC,p,BB==="v");A2.toggleClass(BC,H,BB==="h");this.orientationHasChanged();},onghostImgCssChange:function(){var BC=this.ctrlOverlay.domNode,BB=this.ghostImgCss;A2.removeClass(BC,U);A2.addClass(BC,BB);}},layoutConfig:{h:{titlebarNode:"auto",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},formatHandlers:{domNode:["B","BG"],titlebarNode:{src:"ttl",props:["F","BG","text-align"]}},updateOverlay:mstrmojo.emptyFn,getCacheKey:function AK(){return this._super()+"-vi-uc";},getPanelForAddAction:function Ao(){return"propertiesPanel";},getExcludedPanels:function A3(){return["editPanel"];},titleBarCss:"",orientation:"h",k:"",boxContent:null,parent:null,enabled:true,draggable:true,ctrlOverlay:null,model:null,title:"",titleBar:null,showTitleBar:false,bubbleMouseOver:true,dimensionsSet:false,getEditOverlayControls:mstrmojo.emptyFn,isNewUnitContainer:true,ghostImgCss:[],shouldShowCustomizeContextMenu:function(BB){var BC=BB.getTarget(),BD=BC&&BC.nodeName.toLowerCase();return BD&&!(BD==="textarea"||(BD==="input"&&BC.type.toLowerCase()==="text"));},switchToEditMode:function Au(){this.showControlOverlay(this.getEditOverlayControls());},init:function AV(BD){this._super(BD);var BG=this.id,BC=this.model,BF=this.boxContent,BB;BC.attachEventListener("viUnitSelected",BG,function(BH){this.toggleBoxSelection(BG===BH.id);});BC.attachEventListener("viIconTabClicked",BG,function(BI){var BH=BC.hgl;if(BC.getSelectedViUnit()&&BI.id!=="vi_flt"&&!BH){R.call(this,BG===BC.getSelectedViUnit().id,true,false);}});BC.attachEventListener("viVizEditorDrag",BG,function(BI){var BH=BC.hgl;if(BC.getSelectedViUnit()&&BI.id!=="vi_flt"&&!BH){R.call(this,BG===BC.getSelectedViUnit().id,false,!BI.isIn);}});this.addChildren([this.getTitleBarCfg(),{scriptClass:"mstrmojo.Box",cssClass:AW,alias:"ctrlOverlay",slot:"containerNode",visible:false}],0);BB=this.titleBar;if(BB&&BB.tbToolbar){BB.tbToolbar.toolbarClicked=function(){BC.selectVIUnit(BG);};}this.menuBtnInfo={};this.showTitleBar=!!this.defn.httl;this.draggable=mstrApp.allowWebDashboardDesign();BF.attachEventListener("toggleCtrlOverlay",this.id,Ar);var BE=BF.edtModel;if(BE){BE.attachEventListener("BEMFormatChange",this.id,"updateGhostImgCss");}},getDocModel:function J(){return this.model;},getBoxBorderWidth:function An(){var BB=O.call(this),BC=BB&&BB.border;if(BC){var BD=[2,4];if(mstrApp.isSingleTier&&AP.getOSInfo().name.toLowerCase().indexOf("mac")>=0||mstrApp.isExporting){BD=[2.66,5.34];}return BC.indexOf("2pt")>-1?BD[1]:BD[0];}return 0;},onFormat:function w(){var BB=this.boxContent;if(BB.execFormatHandler){BB.execFormatHandler();return ;}Ai.call(this);},showControlOverlay:function F(BD,BC){var BE=this.ctrlOverlay,BF=BE.domNode;if(BF){var BB=[AW];BB.push((this.orientation==="v")?p:H);BB=BB.concat(this.ghostImgCss);if(BC){BB.push(BC);}BF.className=BB.join(" ");}BE.set("visible",true);Ay(BE);BE.addChildren(BD);},hideControlOverlay:function As(){var BB=this.ctrlOverlay;BB.set("visible",false);Ay(BB);},editingTitleCallback:function G(BB){var BC=this.menuBtnInfo;A2.toggleClass(BC.btn,"editing-title",BB);},getTitleBarCfg:function AM(){return{scriptClass:"mstrmojo.vi.ui.rw.UnitContainerTitleBar",slot:"titlebarNode",alias:"titleBar",title:this.title,editTitleOnDoubleClick:mstrApp.allowWebDashboardDesign(),beganEditingTitlebar:function BD(){this.parent.editingTitleCallback(true);},titleEdited:function BB(){this.parent.editingTitleCallback(false);},close:function(){this.parent.deleteSelf();},getLayoutOffsets:function BC(){return{h:mstrApp.getThemeProps(mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.LAYOUT).ucTBLOHeight,w:0};}};},getDisplayName:function Aa(){return this.title;},updateDisplayName:function AI(BE,BF,BB){var BC=this.model,BD=this.k;if(BB){BC.renameRWUnitTitle(BE,BF,BD,{success:function(BG){this.set("title",BG);}.bind(this),failure:function(BG){mstrmojo.err(BG);this.set("title",BF);}.bind(this)});}else{BC.renameRWUnit(BE,BF,BD,{success:function(){this.synchronizeEditors();}.bind(this)});}},ontitleChange:function BA(){this.titleBar.set("title",this.title);},oncontextmenu:function Ah(BB){if(mstrApp.isInVFInteractMode||(this.boxContent&&this.boxContent.isCustomSort)){AP.preventDefault(window,BB.e);}else{if(this.shouldShowCustomizeContextMenu(BB)){var BC=this.addContextMenuItems(new mstrmojo.ui.menus.MenuConfig({position:AP.getMousePosition(BB.e,BB.hWin),isHostedWithin:false}),BB);AP.preventDefault(window,BB.e);if(BC.hasMenuItems()){this.openPopup(BC.newInstance());}}}BB.cancel();},addContextMenuItems:function e(BE,BB){var BD=this.getEditorModel(),BC;if(BD.getFormattingToolbar){BC=function(BF){var BG=BD.getFormattingToolbar(BF,BB.getTarget());if(BG){this.openPopup(BG);}}.bind(this);}if(!mstrApp.isInVFConfigMode){this.addFormatMenuItem(BE,BB,BC);}return BE;},addFormatMenuItem:function L(BD,BC,BB){if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()){BD.addMenuItem(mstrmojo.desc(1918,"Format"),"",function(){this.selectVIUnit();Ai.call(this,BC,BB);}.bind(this));}return BD;},getFormatMenuItemTarget:function t(BB){return mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE;},applyBoxSize:function h(BB,BD,BG,BF){this._super(BB,BD,BG,BF);this.dimensionsSet=true;var BE=parseInt(BD,10),BH=parseInt(BB,10);var BC=BE>BH?"h":"v";if(BC!==this.orientation){this.set("orientation",BC);}this.set("ghostImgCss",A1.call(this,BE,BH));},childRenderCheck:function AZ(BC){var BB=this._super(BC);if(BC===this.boxContent){BB=BB&&this.dimensionsSet;}return BB;},postUpdateLayout:function z(){var BD=this.boxContent;if(!this.domNode){return ;}if(!BD.hasRendered){BD.render();var BB=this.model.getLatestSelectedViUnitKey(),BC=BB&&this.parent.getUnitByKey(BB);if(BC){this.model.selectVIUnit(BC.id);}else{this.parent.selectFirstBox();}}else{this.updateVisFilterIndicator();BD.refresh(null,!mstrApp.isPartialUpdate);}this.isNewUnitContainer=false;},orientationHasChanged:mstrmojo.emptyFn,onRender:function Ae(){this._super();var BB=this.model.getSelectedViUnit();this.toggleBoxSelection(BB&&BB.k===this.k);},onAppStateChange:function Ac(BC){var BG=mstrmojo.vi.VisualInsightApp.APP_STATES,BI=BG.SELECTOR_TARGETING,BB=BG.PRESENTATION,BD=BG.PAUSE,BH=mstrApp.isAppStatePresentation(),BE=mstrApp.isAppStatePause();if(BH||BC.valueWas&BB){this.draggable=!(BH||mstrApp.isLayoutModePreview());this.generateToolbar();}if(BC.valueWas&BI||mstrApp.isAppStateSelection()||BE||BC.valueWas&BD){this.generateToolbar();}var BF=this.model.getSelectedViUnit();this.toggleBoxSelection(BF&&BF.k===this.k);},onLayoutModeChange:function E(BB){var BC=mstrApp.isLayoutPreview(BB.value);if(BC||mstrApp.isLayoutPreview(BB.valueWas)){this.draggable=!(mstrApp.isAppStatePresentation()||BC);this.generateToolbar();}},selectVIUnit:function X(BB){var BC=this.parent;if(this.enabled&&BC&&BC.selectVIUnit&&!(mstrApp.isAppStateSelection()&&mstrApp.isLayoutModePreview())){this.toggleBoxSelection(this.parent.selectVIUnit(this,BB));}},synchronizeEditors:function AC(){if(this.model.getLatestSelectedViUnitKey()===this.k){this.selectVIUnit(true);}},addToggleTitleMenuItem:function P(BB){var BC=[Ap,A4];if(!this.showTitleBar){BC.reverse();}BB.addDualStateItem(this.id,BC[0],BC[1]);},canShowDesignMenuItems:function q(){return mstrApp.allowWebDashboardDesign();},updateToolbar:function n(BB){var BC=BB.ENUM_CORNERS,BD=this.boxContent,BF=BD&&BD.node,BE=BF&&(!BF.defn.vis||!BF.defn.vis.ve);BB.setAlignment(BC.BOTTOM_RIGHT,BC.TOP_RIGHT);BB.isHostedWithin=false;BB.showContextMenu=false;if(this.canShowDesignMenuItems()&&!mstrApp.isAppStatePresentation()){BB.addSeparator();if(!(mstrApp.isInVFConfigMode&&!BE)){this.addFormatMenuItem(BB);}if(this.showTitleBar){BB.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.draggable=false;this.titleBar.editTitle();}.bind(this));}if(undefined!==this.getEditOverlayControls()){BB.addMenuItem(mstrmojo.desc(3272,"Edit"),"cls",this.switchToEditMode.bind(this));}this.addDeleteMenuItem(BB);}return BB;},addDeleteMenuItem:function Al(BC){if(!mstrApp.isLayoutModePreview()&&!(mstrApp.isInVFConfigMode||mstrApp.isInVFInteractMode)){var BB=this.k,BD=this.model.id;BC.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){Ax(BD,BB).deleteSelf();});}return BC;},deleteSelf:function AT(BO){var BN,BG=this.k,BC=this.model,BM=BC.id,BQ=BC.data,BK=Ax(BM,BG).parent,BL=BK.k,BP=[BL],BB=[],BI=function(BR){return BR.sections||BR.subsections||BR.objects||BR.panels||BR.layouts||BR.children;},BD=function(BU,BT){var BS=BI(BU),BR;for(BR=0;BS&&(BR<BS.length);BR++){if((BS[BR]&&BS[BR].k)===BT){W.removeIndices(BS,BR,1);return ;}else{BD(BS[BR],BT);}}},BF=BC.getRebuildCallback(),BE=function(BV){var BT=Ax(BM,BG),BU=mstrmojo.all[BM],BW=BU.getCurrentLayoutDef(),BS=(BW&&BW.units)||{},BR=BS[BG];if(BT){if(BV){BT.defn._isDeleted=true;}else{delete BT.defn._isDeleted;}}if(BR){if(BV){BR._isDeleted=true;}else{delete BR._isDeleted;}}BU.syncLayerDefn(BG,BN,BV);};BB=BB.concat(BC.getSourceFilterKeys(BG,true));BB=BB.concat(BC.getTargetFilterKeys(this));this.model.execute({execute:function(){var BS=Ax(BM,BG);if(BS){var BR=BS.parent,BT=mstrmojo.all[BM],BW=BT.getDataService().newUpdate();var BU=BR.hasMultipleChildren();BW.addUpdate(BS.createDeleteUpdate());BN=BT.getMapLayerKeys(BS.boxContent);BW.addActions(BT.getDeleteMapLayersActions(BN));BW.addCallbacks({success:function BV(BX){BT.partialUpdate(BX.data,BT.getTargetDefn(BB),BX.defn,BB);BD(BQ,BG);BT.deleteDataCache(BS.boxContent&&BS.boxContent.id);BS.defn._isDeleted=true;BT.syncLayerDefn(BG,BN,true);BS.destroy();}});BR.deleteBoxAndSubmitDeferred(BW,BS,null,true);if(!BU){BT.addVisualizationDeferred(BW,BR.k);}BR.selectFirstBox();BW.addCallbacks(BO);BW.addExtras({style:{params:{treesToRender:0}}});this.submitUpdate(BW);}},urInfo:{undo:function BJ(){BE(false);},redo:function BH(){BE(true);},puKeys:BP,extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA,callback:BF}});},undoInsert:function Ag(){var BB=this.parent,BC=mstrmojo.all[this.model.id];BB.deleteBoxAndSubmitDeferred(BC.getDataService().newUpdate(),this,null,true);BB.selectFirstBox();this.destroy();},createDeleteUpdate:function u(){},getTitleBarVisibility:function V(){return this.titleBar&&this.showTitleBar;},setTitleBarVisibility:function r(BB){var BD=this.titleBar;BD.set("visible",BB);var BE=this.menuBtnInfo,BC=BE&&BE.btn;if(BE){if(!BE.menuCfg){BE.menuCfg=BD.getMenuConfig();}if(mstrApp&&mstrApp.isInVFInteractMode){BE.menuCfg=null;}if(!BC){BC=BE.btn=document.createElement("div");BC.className="hover-menu-btn";var BF=this.id;AP.attachEvent(BC,"click",function(BI){var BH=mstrmojo.all[BF],BG=BE.menuCfg;BG.hostId=BF;BG.hostElement=BC;BG.supportsScroll=true;BG.isHostedWithin=false;BG.maxHeight=AP.getMaxScrollHeight();BH.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:BG}));BI.preventDefault();});}this.domNode.appendChild(BC);}s.call(this);this.doLayout();},refresh:function Aq(){delete this._currentLayout;if(!this.parent.boxLayoutConfig.dirty){this._super();}else{K.call(this,false,this.getFormats());if(this.showTitleBar){K.call(this,true,this.getFormats());}}},addFormatProps:function a(BC,BB){return BC;},onclick:function AO(BB){BB.e.justSwitched=this.k!==this.getDocModel().getLatestSelectedViUnitKey();this.selectVIUnit();if(!BB.e.ptvSelected&&this.switchPropertyOnClick(BB)){this.boxContent.edtModel.selectTargetByValue(mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE);}},switchPropertyOnClick:function AU(){var BB=this.boxContent.edtModel;return !!(BB&&BB.selectTargetByValue);},getZonesModel:function Ak(){return null;},getEditorModel:function A7(){return this.boxContent.edtModel;},onmouseenter:function AY(){var BB=this.menuBtnInfo;if(BB&&BB.menuCfg){A2.addClass(BB.btn,AL);A2.removeClass(BB.btn,k);}},onmouseleave:function A9(){var BB=this.menuBtnInfo;if(BB&&BB.menuCfg){A2.addClass(BB.btn,k);A2.removeClass(BB.btn,AL);}},onmouseover:function I(BB){if(!mstrApp.isInteractive()){return ;}if(!this.bubbleMouseOver){BB.cancel();}var BC=this._panelTimeout;if(BC){window.clearTimeout(BC);delete this._panelTimeout;}if(this.titleBar.visible&&!mstrApp.isAppStateSelection()){this.titleBar.setToolbarVisibility(true);}},onmouseout:function AA(){var BB=this.id;this._panelTimeout=window.setTimeout(function(){var BC=mstrmojo.all[BB];if(BC){BC.titleBar.setToolbarVisibility(false);}},200);},menuDisplayCallback:function M(BC){var BB=this.menuBtnInfo;A2.toggleClass(BB.btn,AL,BC);A2.toggleClass(BB.btn,k,!BC);},onmousemove:function AN(){var BB=this,BC=BB.menuBtnInfo;if(BB.titleBar&&!BB.titleBar.visible&&BC&&BC.menuCfg){if(!!BB.mouseMovingTimer){clearTimeout(BB.mouseMovingTimer);clearTimeout(BB.menuDisplayTimeout);}BB.mouseMovingTimer=setTimeout(function(){clearTimeout(BB.menuDisplayDelay);BB.menuDisplayDelay=null;clearTimeout(BB.menuDisplayTimeout);BB.menuDisplayTimeout=setTimeout(function(){BB.menuDisplayCallback(false);},1500);},100);if(!BB.menuDisplayDelay){BB.menuDisplayDelay=setTimeout(function(){BB.menuDisplayCallback(true);},500);}}},isDragValid:function AJ(BC){var BE=BC.src.node,BB=BE.tagName,BD=BE.className;BB=(BB&&BB.toLowerCase())||"";BD=(BD&&BD.toLowerCase())||"";if(BB==="input"||BB==="textarea"||BD.indexOf("hover-menu-btn")>-1||BD.indexOf("icn")>-1){return false;}return this.parent.hasMultipleChildren();},initializeDrag:function AE(){if(this._super()!==false){this.selectVIUnit();}},getTargetDropZone:function AD(BB){if(AR.call(this,BB)||AH.call(this,BB)){return"";}return this._super(BB);},allowDrop:function B(BB){var BD=BB.src,BC=BD&&BD.widget;if(BC&&BC===this){return false;}if(v.call(this,BB)&&this.allowDropFromFilter(BB)){return true;}if(AR.call(this,BB)&&this.allowDropFromDataset(BB)){return true;}if(AH.call(this,BB)&&this.allowDropFromAllObjectsBrowser(BB)){return true;}return this._super(BB);},allowDropFromFilter:function Aw(BB){var BD=BB&&BB.src,BC=BD&&BD.widget;return mstrApp.allowWebDashboardDesign()&&!(BC&&BC.isVisFilter());},allowDropFromDataset:function Ad(BB){return false;},allowDropFromAllObjectsBrowser:function Q(BB){return this.allowDropFromDataset(BB);},close:function(){this.parent.deleteBoxAndSubmit(this);this.parent.removeChildren(this);mstrApp.rootCtrl.generateToolbar();this.destroy();},createAvatar:function S(){this.domNode.style.zIndex="-1";var BB=document.createElement("div");BB.className=this.getAvatarCls().join(" ");BB.textContent=this.getDisplayName();return this.offsetAvatar(BB);},ondragend:function Y(BB){this.domNode.style.zIndex=Aj;this._super(BB);},wasDropped:function l(BB){this.domNode.style.zIndex=Aj;this._super(BB);},ondrop:function A(BB){var BD=v.call(this,BB),BC=this.maskNode.zone,BF,BJ=this.getDocModel(),BI=this;if(BD){BF=BB.src.widget.selector.node;}this._super(BB);if(AR.call(this,BB)){BJ.selectVIUnit(this.id);this.dropFromDataset(BB);}if(AH.call(this,BB)){var BG=BB.src.widget,BE=BG&&BG.dataProvider;if(BE){BE.loadObjects(BB.getCtxtDragData().items,{success:function(){BI.dropFromAllObjects(BB);}});}}if(BD){var BH=this;if(!BC){BC=this.parent.getPanelTargetEdge(BB);if(BC){BH=null;}}this.model.insertExistingFilter(BF,BH,BC);}},postDropBox:function Av(){this.domNode.style.zIndex=Aj;},rebuildBoxContent:function AF(BB){var BD=this.boxContent,BC=this.parent;this.removeChildren(BD);BD.destroy();if(BB){BD=BC.builder.build([BB],this.model,{pk:BC.k})[0].boxContent;}else{BD=this.model.rebuildUnitFromDataCache(BD.id,BC.k,BC.builder).boxContent;}this.addChildren([BD]);},dropFromDataset:mstrmojo.emptyFn,dropFromAllObjects:mstrmojo.emptyFn,generateToolbar:function C(){var BB=this.titleBar,BC=BB.toolbarCfg,BD=this.menuBtnInfo;if(BD){if(BC){BC.destroy();}if(BD.menuCfg&&BD.menuCfg.destroy){BD.menuCfg.destroy();}if(mstrApp&&mstrApp.isInVFInteractMode||mstrApp.isAppStateSelection()){BD.menuCfg=null;}else{BB.set("toolbarCfg",this.updateToolbar(new mstrmojo.ui.menus.ToolbarConfig()));BD.menuCfg=BB.getMenuConfig();}}if(this.hasRendered){s.call(this);}},getTitleVisibilityFmts:function d(BB){return{FormattingView:{ShowTitleBar:BB}};},toggleTitleBar:function AQ(BC){var BH=this.boxContent.id,BF=this.model,BG=function BG(BI){var BK=mstrmojo.all[BH],BJ=BK.parent;clearTimeout(BJ.mouseMovingTimer);clearTimeout(BJ.menuDisplayTimeout);clearTimeout(BJ.menuDisplayDelay);BJ.setTitleBarVisibility(BI);BJ.parent.selectVIUnit(BJ,true);BJ.applyBoxSize(BJ.height,BJ.width,BJ.top,BJ.left);BJ.showTitleBar=BI;BJ.generateToolbar();BK.refresh(null,true);},BB=this.id;BG(BC);BF.controller.cmdMgr.execute({execute:function(){var BI=mstrmojo.all[BH].parent;this.submit([BF.getUnitFormatAction(BI,BI.defn.t===mstrmojo.EnumRWUnitType.SELECTOR?5:1,BI.getTitleVisibilityFmts(BC?1:0),true)],{success:function BK(){mstrmojo.all[BB].defn.httl=BC;},failure:function BJ(){BG(!BC);}},mstrmojo.DocDataService.RAPID_EXEC);BG(BC);},urInfo:{silent:true,undo:function BD(){BG(!BC);},redo:function BE(){BG(BC);}}});},getFormats:function AS(){var BB=this.boxContent;if(BB){return BB.getFormats();}return null;},clearFormats:function N(){var BB=this.boxContent;if(BB&&BB.clearFormats){BB.clearFormats();}},preBuildRendering:function f(){var BB=this.boxContent;if(BB){BB.attachEventListener("regenerateToolbar",this.id,"generateToolbar");}this.generateToolbar();return this._super();},postBuildRendering:function A6(){var BB=this.showTitleBar;this.setTitleBarVisibility(BB);if((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview())){this.draggable=false;}this._super();this.titleBar.setToolbarVisibility(false);this.applyBoxSize(this.height,this.width,this.top,this.left);return true;},changeUnitFormats:function Az(BE,BH,BL,BJ,BD,BB,BF,BI){var BG=function(BQ){if(BF){BQ=BF(BQ);}m.updateFormatBlock(BE?BL.ttl:BL,BJ,BQ);var BO=this.parent?this:this.model.getSelectedViUnit();K.call(BO,BE,BL);var BP=this.boxContent;if(!BP.excludeData){if(!BE&&BP.restylePlotly){BP.restylePlotly(BL);}}if(BI){BI(BQ);}BO.synchronizeEditors();if(BE&&BJ===g.FONT_SIZE){BO.doLayout();BO.postUpdateLayout();}},BK=function(BO){this.model.updateDefnCache(BO.defn,[this.k]);this.clearFormats();BL=this.getFormats();},BM={success:BG.bind(this,BD)};var BN="none",BC=mstrmojo.DocDataService.SUPPRESS_DATA;if(BJ===g.BORDER_STYLE&&BB===BN){BC=mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION;BM=mstrmojo.func.wrapMethods({success:BK.bind(this)},BM);}this.model.saveUnitFormatProperty(this,[{formatType:BH,propertyName:BJ,newValue:BD,oldValue:BB}],BM,BC,{silent:true,undo:BG.bind(this,BB),redo:BG.bind(this,BD)});},redraw:function AB(){if(this.boxContent.redraw()===true){return true;}return this._super();},getAvatarCls:function Ab(){return["mstrmojo-VIUnit-avatar","icn-avi",mstrApp.getThemeClassName()];},addDragHandle:function x(){var BB=document.createElement("div");BB.className="uc-drag-handle";this.domNode.appendChild(BB);},toggleDragHandleVisibility:function At(BB){A2.toggleClass(this.domNode,"no-handler",!BB);},toggleBoxSelection:function AX(BC){if(mstrApp.isInVFInteractMode){return ;}var BD=mstrApp.isAppStatePresentation(),BB=mstrApp.isAppStatePrintPreview(),BE=this.domNode;A2.toggleClass(BE,"selected",BC&&!(BD||BB));},updateGhostImgCss:function o(BB){if(BB.propertyName===g.BACKGROUND_COLOR&&!BB.isTitle){var BC=this.ghostImgCss||[];BC=W.filter(BC,function(BD){return c.indexOf(BD)===-1;});BC=BC.concat(Af(BB.value));this.set("ghostImgCss",BC);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.TokenInputBox","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.range","mstrmojo.ME.MetricToken","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.AttributeEditBox");var L=mstrmojo.dom,E=mstrmojo.range,B=E.EDGE,F=mstrmojo.hash,O=mstrmojo.css,H=mstrmojo.mstr.EnumDSSXMLObjectTypes,K=mstrmojo.ME.AttributeEditBox.prepareInsertToken;var N=["{","}"],J=null;function D(S){if(!J){J={};var R,Q;for(R=0,Q=N.length;R<Q;R++){J[N[R]]=true;}}return J.hasOwnProperty(S);}mstrmojo.ME.DynamicLinkTokenInputBox=mstrmojo.declare(mstrmojo.ME.TokenInputBox,[],{isDelimiter:D,itemFunction:function I(S,Q,R){return new mstrmojo.ME.MetricToken({data:S,parent:R,isDelimiter:function(){return this.data.isDelimiter||(this.length()===1&&D(this.data.v));}});},ondrop:function(V){var U=V.src.data,Q=U&&U.item;if(!Q){return ;}var Y=F.copyProps(["did","n","t","fs"],Q);var S=K(Y);var W=[S];if(Y.t===H.Attribute&&S.ift&&S.exv){W=[{v:"{",isDelimiter:true,isNew:true}].concat(W).concat([{v:"}",isDelimiter:true,isNew:true}]);}var Z=this.insertTokens(W);if(this.parent.ontokensModify){this.parent.ontokensModify();}this.set("dropCuePos",null);if(Y.t===H.Attribute&&S.ift&&!S.exv){var X=this.ctxtBuilder.itemWidgets||[],R=X[Z];if(R){this.startTokenSuggestion(R);}}this.clearSelect(true);O.removeClass(this.domNode,"unselectable");},insertLeftCurlyBraces:function P(R){var Q=this;window.setTimeout(function(){var S=Q.insertTokens([{v:"{",isDelimiter:true,isNew:true}]);Q._delaySetCaretPos(Q.itemsContainerNode.childNodes[S+1],false);},R||50);},insertRightCurlyBraces:function C(R){var Q=this;window.setTimeout(function(){var S=Q.insertTokens([{v:"}",isDelimiter:true,isNew:true}]);Q._delaySetCaretPos(Q.itemsContainerNode.childNodes[S],false);Q._delaySetTextCaretPos(Q.itemsContainerNode.childNodes[S],1);},R||50);},onSuggestionItemSelect:function A(U){var R=this._saveActiveToken;var S=true;this.endTokenSuggestion();if(R){if(R.data.ift&&U.t===H.AttributeForm){var Q=this.itemIndex(R.data);if(this.items[Q-1]&&this.items[Q-1].v==="{"&&this.items[Q+1]&&this.items[Q+1].v==="}"){S=false;}R.setFormInfo(U);if(S){this.insertLeftCurlyBraces();this._delaySetCaretPos(R.domNode,true);var V=this;window.setTimeout(function(){V._delaySetCaretPos(R.domNode,false);V.insertRightCurlyBraces();},50);}else{this._delaySetCaretPos(R.domNode,false);}}else{R.setItemInfo(U);this._delaySetCaretPos(R.domNode,false);}}this.closePopup();},handlemouseup:function G(Q){this.raiseEvent({name:"tokenInputBoxSelected"});this._super(Q);},widgetHandleInput:function M(W,X){if(!W.collapsed){this.widgetDeleteTokens(W);W=E.getRangeInfo();}var S,Y,Z,a,Q,R,U=this.ctxtBuilder.itemWidgets;if(!L.contains(this.editNode,W.startContainer,false,document.body)){this.add([{v:X,isDelimiter:this.isDelimiter(X),isNew:true}],0);Y=U[0];E.collapseOnTextNode(Y.domNode,1);return ;}S=E.getEdgeInfo(W.startContainer,W.startOffset);Y=L.findWidget(W.startContainer);Z=this.itemIndex(Y.data);if(this.isDelimiter(X)){a={v:X,isDelimiter:true,isNew:true};if(S===B.EDGE_MIDDLE){var V=Y.split2Tokens(W.startOffset);this.remove(Z);if(X==="{"){this.add([V[0],a,{v:"}",isDelimiter:true,isNew:true},V[1]],Z);}else{this.add([V[0],a,V[1]],Z);}Z=Z+1;}else{Z=(S===B.EDGE_BEGIN)?Z:Z+1;if(X==="{"){this.add([a,{v:"}",isDelimiter:true,isNew:true}],Z);}else{this.add([a],Z);}}Y=U[Z];E.collapseOnNode(Y.domNode,false);}else{R=W.startOffset;if(Y.isDelimiter()){Q=U[(S===B.EDGE_BEGIN)?Z-1:Z+1];if(Q&&!Q.isDelimiter()){Y=Q;R=(S===B.EDGE_BEGIN)?Y.length():0;}}if(!Y.isDelimiter()){Y.spliceContent(R,0,X);E.collapseOnTextNode(Y.domNode,R+1);}else{this.add([{v:X,isNew:true}],(S===B.EDGE_BEGIN)?Z:Z+1);Y=U[(S===B.EDGE_BEGIN)?Z:Z+1];E.collapseOnNode(Y.domNode,false);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.ValidationTextBox","mstrmojo.HBox","mstrmojo.ui.menus.EditorConfig","mstrmojo.mstr.EnumFunction","mstrmojo.DropDownList","mstrmojo.ui.Pulldown","mstrmojo.SearchablePulldown","mstrmojo.ButtonList","mstrmojo.Box","mstrmojo.Label","mstrmojo.RadioList","mstrmojo.CheckList","mstrmojo.EditableLabel","mstrmojo.CheckBox","mstrmojo._FormatDefinition","mstrmojo.num","mstrmojo.locales","mstrmojo.vi.models.VIComponentMap","mstrmojo.func","mstrmojo.dom","mstrmojo.ME.AttributeEditBox","mstrmojo.ME.MetricToken","mstrmojo.string","mstrmojo.dom","mstrmojo.models.datasets.DataInterface","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.ui.editors.ObjectPicker","mstrmojo.vi.ui.editors.AttributeLinkEditor","mstrmojo.vi.ui.NumberFormatter","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSConsolidationType");mstrmojo.requiresDescs(1442,1885,1886,2022,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,3993,4564,11494,11495,11496,11497,14612);var r=mstrmojo.mstr.EnumFunction,a=mstrmojo.hash,v=mstrmojo.array,D=mstrmojo.css,Y=mstrmojo.dom,z=mstrmojo.Button.newWebButton,V=mstrmojo.ME.MetricToken.brackets,AF=mstrmojo.ME.MetricToken.argDelimiter,W=mstrmojo._FormatDefinition,t=mstrmojo.models.datasets.DataInterface,K=mstrmojo.vi.models.VIComponentMap.TYPES,X=mstrmojo.chart.model.enums.EnumDSSObjectType,s=mstrmojo.mstr.EnumDSSXMLBaseFormType,AS=mstrmojo.mstr.EnumDSSXMLObjectTypes,N=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,AD=mstrmojo.mstr.EnumDSSConsolidationType;var b={SUM:mstrmojo.desc(2131,"Sum"),ADD:mstrmojo.desc(6017,"Add"),AVG:mstrmojo.desc(2122,"Average"),MAX:mstrmojo.desc(2125,"Maximum"),GST:mstrmojo.desc(5869,"Greatest"),MIN:mstrmojo.desc(2127,"Minimum"),LST:mstrmojo.desc(5868,"Least"),CNT:mstrmojo.desc(2123,"Count"),MTP:mstrmojo.desc(5418,"Multiply"),STD:mstrmojo.desc(2130,"Standard Deviation"),PTD:mstrmojo.desc(11494,"Population Standard Deviation")},g={SUM:{n:b.SUM,t:r.FunctionSum},ADD:{n:b.ADD,t:r.FunctionPlus},AVG:{n:b.AVG,t:r.FunctionAvg},MAX:{n:b.MAX,t:r.FunctionMax},GST:{n:b.GST,t:r.FunctionGreatest},MIN:{n:b.MIN,t:r.FunctionMin},LST:{n:b.LST,t:r.FunctionLeast},TMS:{n:b.MTP,t:r.FunctionTimes},CNT:{n:b.CNT,t:r.FunctionCount},GEM:{n:mstrmojo.desc(2124,"Geometric Mean"),t:r.FunctionGeomean},MED:{n:mstrmojo.desc(2126,"Median"),t:r.FunctionMedian},MOD:{n:mstrmojo.desc(2128,"Mode"),t:r.FunctionMode},PDT:{n:mstrmojo.desc(2129,"Product"),t:r.FunctionProduct},STD:{n:mstrmojo.desc(2130,"Standard Deviation"),t:r.FunctionStdev},VAR:{n:mstrmojo.desc(2132,"Variance"),t:r.FunctionVar}},c=[{n:b.SUM,t:r.FunctionOLAPSum},{n:b.AVG,t:r.FunctionOLAPAvg},{n:b.MIN,t:r.FunctionOLAPMin},{n:b.MAX,t:r.FunctionOLAPMax},{n:b.CNT,t:r.FunctionOLAPCount}],AQ=[{n:b.SUM,t:r.FunctionOLAPSum},{n:b.AVG,t:r.FunctionOLAPAvg},{n:b.MIN,t:r.FunctionOLAPMin},{n:b.MAX,t:r.FunctionOLAPMax},{n:b.CNT,t:r.FunctionOLAPCount}],M=[{n:mstrmojo.desc(1058,"Previous"),t:r.FunctionLag},{n:mstrmojo.desc(1059,"Next"),t:r.FunctionLead},{n:mstrmojo.desc(4046,"First"),t:r.FunctionFirst},{n:mstrmojo.desc(4049,"Last"),t:r.FunctionLast}];var AA={YEAR:"Year",QUARTER:"Quarter",CONCAT:"Concat",QUARTERSTARTDATE:"QuarterStartDate",MONTH:"Month",TOSTRING:"ToString",MONTHSTARTDATE:"MonthStartDate",WEEK:"Week",WEEKSTARTDATE:"WeekStartDate",DAYOFMONTH:"DayOfMonth",DAYOFWEEK:"DayOfWeek",DAYOFYEAR:"DayOfYear"};var AJ={};AJ[AA.YEAR]="6F7DF5F8449111D5BEA300B0D01A55EF";AJ[AA.QUARTER]="6F7DF5F7449111D5BEA300B0D01A55EF";AJ[AA.CONCAT]="6F7DF5FF449111D5BEA300B0D01A55EF";AJ[AA.QUARTERSTARTDATE]="59E10CE2ADDD4A6DAC2416A72999A9ED";AJ[AA.MONTH]="6F7DF5F6449111D5BEA300B0D01A55EF";AJ[AA.TOSTRING]="D1ED29645DEC4DBF99E8E09ED939074B";AJ[AA.MONTHSTARTDATE]="7C63D4E70B2741C3A5B54A2EFD40961B";AJ[AA.WEEK]="6F7DF5F5449111D5BEA300B0D01A55EF";AJ[AA.WEEKSTARTDATE]="44681336D0DB4E43AC333FFB3CC4400D";AJ[AA.DAYOFMONTH]="6F7DF5F2449111D5BEA300B0D01A55EF";AJ[AA.DAYOFWEEK]="6F7DF5F3449111D5BEA300B0D01A55EF";AJ[AA.DAYOFYEAR]="6F7DF5F4449111D5BEA300B0D01A55EF";var Q="@form";function d(AU){var AW=8,AX=1,AT=v.find(AU.fs,"idf",true);if(AT===-1){return null;}var AV=AU.fs[AT];return((AU.da||AV.obf)&&(AV.bftp===AW||AV.bftp===AX))?AV:null;}var AP={Year:{ID:[AA.YEAR,"(",Q,")"]},Quarter:{ID:[AA.YEAR,"(",Q,") * 10 + ",AA.QUARTER,"(",Q,")"],DESC:[AA.CONCAT,'("Q"',AF,AA.QUARTER,"(",Q,")",AF,' ", "',AF,AA.YEAR,"(",Q,"))"],DATE:[AA.QUARTERSTARTDATE,"(",Q,")"]},QuarterOfYear:{ID:[AA.QUARTER,"(",Q,")"],DESC:[AA.CONCAT,'("Q"',AF,"This@ID)"]},Month:{ID:[AA.YEAR,"(",Q,") * 100 + ",AA.MONTH,"(",Q,")"],DESC:[AA.TOSTRING,'<Pattern="mmm yyyy">(',Q,")"],DATE:[AA.MONTHSTARTDATE,"(",Q,")"]},MonthOfYear:{ID:[AA.MONTH,"(",Q,")"],DESC:[AA.TOSTRING,'<Pattern="mmmm">(',Q,")"]},Week:{ID:[AA.YEAR,"(",Q,") * 100 + ",AA.WEEK,"(",Q,")"],DESC:[AA.CONCAT,'("W"',AF,AA.WEEK,"(",Q,")",AF,' ", "',AF,AA.YEAR,"(",Q,"))"],DATE:[AA.WEEKSTARTDATE,"(",Q,")"]},WeekOfYear:{ID:[AA.WEEK,"(",Q,")"]},DayOfMonth:{ID:[AA.DAYOFMONTH,"(",Q,")"]},DayOfWeek:{ID:[AA.DAYOFWEEK,"(",Q,")"],DESC:[AA.TOSTRING,'<Pattern="ddd">(',Q,")"]},DayOfYear:{ID:[AA.DAYOFYEAR,"(",Q,")"]}};function k(AV,AX,AW,AT){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:AV,selectedIndex:AX,onitemSelected:function AU(AY){var AZ=this.parent;while(!AZ.data||!AZ.data[AW]){AZ=AZ.parent;}AZ.data.set(AW,AT?AT(AY):AY.v);}};}function AB(AV,AU,AT){return{scriptClass:"mstrmojo.Box",cssClass:"breakByBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13903,"Break by:"),cssClass:"menu-info-text"},a.copy(AT,k(AV,AU,"breakBy",function(AW){return{id:AW.did,type:AW.t,dmy:AW.dmy};}))]};}function AN(AW){var AX=AW.metrics,AY=AW.propName,AV=AW.optionValueField||"id",AT=v.find(AX,AV,AW.value),AZ=function AZ(Ab){var Aa=this.parent;while(!Aa.data||!Aa.data.hasOwnProperty(AY)){Aa=Aa.parent;}Aa.data.set(AY,Ab?{id:Ab[AV],type:4}:{cst:this.text});};return{scriptClass:"mstrmojo.ui.SearchablePulldown",isHostedWithin:false,cssClass:"Calculation-PullDown",items:AX,selectedIndex:AT,useRichTooltip:true,bindings:AW.bindings,valid:true,allowCustomText:true,allowEmptyText:true,allowHTML:false,onvalidChange:function AU(){mstrmojo.css.toggleClass(this.domNode,"invalid",!this.valid);if(this.hasRendered){this.hideTooltip();this.showTooltip();}},updateTooltipConfig:function(){if(this.valid){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:mstrmojo.desc(13819,"Invalid input")};},onitemSelected:AZ,onTextEditComplete:function(){AZ.call(this,this.items[this.selectedIndex]);},onPopupWidgetOpened:function(){this.set("valid",true);},postkeyup:AW.postkeyup};}function U(AW,AV,AU){if(AW&&AW.datap){var AT=v.filterOne(AW.datap,function(AY){return AY.tbid===AV;}),AX=AT&&AT.maps.amps;return v.filterOne(AX,function(AY){return AU===AY.aimp.atid;});}return null;}function n(AT,AX){var AV=v.filterOne(AT&&AT.afmps,function(AY){return AY.fmid===AX;}),AW=AV&&(AV.sqc?AV:AV.col.oi),AU;if(AW&&AW.sqc){AU={did:AW.sqc.id,n:mstrmojo.string.decodeHtmlString(AW.cln),coldtp:AW.sqc.dt.tp,georole:AW.geo,timerole:AW.tim,der:AW.sqc.der};}else{if(AW){AU={did:AW.did,n:mstrmojo.string.decodeHtmlString(AW.def.cln),coldtp:AW.def.dt.tp,georole:AV.geo,timerole:AW.def.dicl.time,der:AW.def.dicl.der};}}return AU;}function C(AV,AU,AX){var AW={success:function(AY){if(AY&&AY.msgid){mstrApp.serverRequest({taskId:"qBuilder.GetReportXDADefinition",msgid:AY.msgid,bindingflag:2,previewflag:261,browsetype:5},AX);}},failure:function(AY){mstrApp.onerror(AY);}};var AT=!!(mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause());mstrApp.serverRequest({taskId:"duplicateReportInstance",datasetID:AU,messageID:AV,skipRebuild:AT},AW);}function I(AY,AZ,AW){var AU=AY.srcTableId,Ab=AY.tgtTableId,AT,AX,AV=function(Af,Ae){var Ah="<mpcs><mpc ",Ad,Ag;for(Ad in Ae){Ag=Ae[Ad];Ah+='$ACT="$VAL" '.replace("$ACT",Ad).replace("$VAL",Ag);}Ah+="/></mpcs>";return{act:"changeEMMAMapping",tbid:Af,dsid:AY.dsid,mapping:Ah};},Aa=function(){var Ad=[],Ag={},Ae,Af;if(!AT||!AX){return ;}Ag[AU]={};Ag[Ab]={};v.forEach(AT.afmps,function(Ak){var Ai=v.find(AX.afmps,"fmid",Ak.fmid),Al,Aj,Ah;if(Ai>=0){Ae=n(AT,Ak.fmid);Af=n(AX,Ak.fmid);if(Ae.georole!==Af.georole){Ah=(Ae.georole===0)?AU:Ab;Al=(Ae.georole===0)?Ae.did:Af.did;Aj=Ae.georole||Af.georole;Ag[Ah][Al]=a.copy({did:Al,georole:Aj},Ag[Ah][Al]);}if(Ae.timerole!==Af.timerole){Ah=(Ae.timerole===0)?AU:Ab;Al=(Ae.timerole===0)?Ae.did:Af.did;Aj=Ae.timerole||Af.timerole;Ag[Ah][Al]=a.copy({did:Al,timerole:Aj},Ag[Ah][Al]);}if(Ae.der!==Af.der){Aj=Ae.der|Af.der;Ag[AU][Ae.did]=a.copy({did:Ae.did,drvflg:Aj},Ag[AU][Ae.did]);Ag[Ab][Af.did]=a.copy({did:Af.did,drvflg:Aj},Ag[Ab][Af.did]);}}});a.forEach(Ag,function(Ah,Ai){a.forEach(Ah,function(Aj){Ad.push(AV(Ai,Aj));});});Ae=n(AT,AT.afmps[0].fmid);Ad.push(AV(AU,{did:Ae.did,oid:AX.aimp.atid}));if(AW){AW(Ad);}},Ac=function(Af){var Ag={success:function(){Aa();}},Ae,Ad;AT=U(Af,AU,AY.srcId);AX=U(Af,Ab,AY.tgtId);Ae=n(AT,AT.afmps[0].fmid);Ad=[AV(AU,{did:Ae.did,oid:AX.aimp.atid,fg:1})];AZ.getDataService().submitUpdates(Ad,Ag);};C(AZ.mid,AY.dsid,{success:Ac});}function Z(AY,AV,AU,AZ){var AT=0,AX=[],AW=function(Aa){var Ab=AU[AT-1];if(Aa&&Aa.tks&&Ab){AX.push({fid:Ab.fid,fnm:Ab.fnm,ftk:Aa.tks.items});}if(AT===AU.length){AZ(AX);return ;}Ab=AU[AT++];mstrmojo.ME.MetricDataService.validateMetric({metricId:AV,formID:Ab.fid,objectType:12,tokenStreamXML:"",metricXML:"",msgID:AY},{success:AW});};AW();}function AG(AT,AU){return{v:V(AT.n)+"@"+V(AU.fnm),tp:275,lv:1,exv:AU.fid,extp:8,oi:{did:AT.did,t:AT.t,n:AT.n}};}function H(AU){var AW=(AU.t===AS.Filter||AU.t===AS.Consolidation),AV=(AU.t===AS.Attribute&&AU.de),AT=(AU.t===AS.Consolidation&&AU.st===N.ConsolidationManaged);return !!(AW&&!AT||AV);}mstrmojo.vi.ui.DatasetUnitMenuUtils=mstrmojo.provide("mstrmojo.vi.ui.DatasetUnitMenuUtils",{getAvailableShortcutMetricFunctionsGroup:function AM(AT){return{"12":[[g.AVG,g.CNT,g.MAX,g.MIN,g.STD,g.SUM,g.VAR]],"4":[[g.SUM,g.AVG,g.MIN,g.MAX,g.CNT],[g.GEM,g.MED,g.MOD,g.PDT,g.STD,g.VAR]]}[AT.t];},isAmongFunctions:function B(AU,AT){return AT.some(function(AV){return AV.some(function(AW){return AW.t===AU;});});},getMultiSelectionShortcutMetricFunctions:function J(AT){var AU=true;v.forEach(AT,function(AV){if(4!==AV.t){AU=false;return false;}return true;});return AU?[g.ADD,g.AVG,g.GST,g.LST,g.TMS]:[];},getRelativeReferenceMenu:function f(AX,AV,Aa,AT){var AW=0,AU=M[AW],AZ=0,AY=Aa&&Aa[AZ];return new mstrmojo.ui.menus.EditorConfig({data:{item:AX,relativeRef:AU,breakBy:AY},cssClass:"RelativeReference-MenuEditor",contents:[{scriptClass:"mstrmojo.Box",cssClass:"funcBox",children:[{scriptClass:"mstrmojo.Label",visible:AV&&AV.length,text:AV,cssClass:"menu-info-text"},a.copy({cssClass:"RelativeReferencePullDown"},k(M,AW,"relativeRef",function(Ab){return Ab.t;}))]},AB(Aa,AZ,{cssClass:"RelativeReferencePullDown"})],fnOk:function(Ab){return AT(Ab.item,Ab.relativeRef,[Ab.breakBy]);}});},getMovingTotalMenu:function A(Ad,AX,AZ){var Ae=1,AW=AQ[Ae].t,AY=1,AU=mstrmojo.desc(13289,"Starting previous##rows").split("##"),Ac=0,AV=AX&&AX[Ac];return new mstrmojo.ui.menus.EditorConfig({cssClass:"MovingTotal-MenuEditor",data:{item:Ad,funcType:AW,windowSize:AY,breakBy:AV},contents:[a.copy({cssClass:"MovingTotalPullDown"},k(AQ,Ae,"funcType",function(Af){return Af.t;})),{alias:"winSzBox",scriptClass:"mstrmojo.HBox",children:[{scriptClass:"mstrmojo.Label",cssClass:"WinSzPrefix menu-info-text",text:AU[0]},{alias:"winSz",scriptClass:"mstrmojo.ValidationTextBox",required:true,dtp:mstrmojo.expr.DTP.INTEGER,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:1},postCreate:function Ab(){this.set("value",AY);},_ontooltipover:function(){var Af=mstrmojo.all[this.id];Af._hovered=true;Af.showTooltip();},_ontooltipout:function(){var Af=mstrmojo.all[this.id];Af._hovered=false;Af.hideTooltip();},useRichTooltip:true,tooltipOpenDelay:0,onInvalid:function(){var Af=this.validationStatus.msg,Ag=!(this.richTooltip&&Af===this.richTooltip.content);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-V",top:-5,refNode:this.domNode,content:Af};if(this._hovered&&Ag){this.hideTooltip();this.showTooltip();}},onValid:function(){this.richTooltip=null;this.hideTooltip();},postvalueChange:function Aa(){var Af=this.isValid();this.parent.parent.popupConfig.data.set("windowSize",Af?parseInt(this.value,10):0);}},{scriptClass:"mstrmojo.Label",cssClass:"WinSzSuffix menu-info-text",text:AU[1]}]},AB(AX,Ac,{cssClass:"MovingTotalPullDown BreakByBox"})],bindings:{okEnabled:function(){return !!this.data.windowSize;}},fnOk:function AT(Af){if(AZ){AZ(Ad,Af.funcType,Af.windowSize,[Af.breakBy]);}}});},getRunningTotalMenu:function AL(AW,AZ,AU){var AV=0,AT=c[AV].t,AY=0,AX=AZ&&AZ[AY];return new mstrmojo.ui.menus.EditorConfig({data:{item:AW,func:AT,breakBy:AX},cssClass:"RunningTotal-MenuEditor",contents:[a.copy({cssClass:"RunningTotalPullDown"},k(c,AV,"func",function(Aa){return Aa.t;})),AB(AZ,AY,{cssClass:"RunningTotalPullDown BreakByBox"})],fnOk:function(Aa){return AU(Aa.item,Aa.func,[Aa.breakBy]);}});},getRankMetricEditor:function AC(AX,Aa,AV){var AT=[{n:mstrmojo.desc(1886,"Descending"),v:"0"},{n:mstrmojo.desc(1885,"Ascending"),v:"-1"}],AU=0,AW=AT[AU].v,AZ=0,AY=Aa&&Aa[AZ];return new mstrmojo.ui.menus.EditorConfig({data:{item:AX,order:AW,breakBy:AY},cssClass:"NewRankMetric-MenuEditor",contents:[{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14612,"Sort:"),cssClass:"menu-info-text"},a.copy({cssClass:"NewRankMetricPullDown"},k(AT,AU,"order"))]},AB(Aa,AZ,{cssClass:"NewRankMetricPullDown"})],fnOk:function(Ab){return AV(Ab.item,Ab.order,[Ab.breakBy]);}});},insertAddUnitToFilterMenu:function G(AY,AU,AT){var AW=this,AV=mstrmojo.desc(2022,"Add to Filter"),AX=v.ensureArray(AT).filter(function(AZ){return AW.isValidAddToFP(AU,AZ);});if(AX.length>0){AY.addMenuItem(AV,"",function(){AU.addFilterStackSelectors(AX);});}else{AY.addDisabledMenuItem(AV,"");}},isValidAddToFP:function O(AU,AZ,Ab){var AV=AU.controller.view.builder,AX=AV.getLayoutVIMap(AU.getCurrentLayoutKey()),AY=AX.getComponent(K.FILTER_STACK),Aa=true;if(!Ab){Aa=(!AY||v.find(AY.getFilterDefinitions(),"srcid",AZ.did)===-1);}if(Aa&&AZ.lock){var AW=AZ.fs||[],AT;Aa=false;for(AT=0;AT<AW.length;AT++){if(AW[AT].iidx){Aa=true;break;}}}return Aa;},renameItem:function u(AY,Ab,AU,AW){var AX=AY.mstrmojoId,Aa=mstrmojo.dom.findWidget(AY);AW=AW||{};if(!AX){var AZ=mstrmojo.insert({scriptClass:"mstrmojo.EditableLabel",editOnClick:false,editOnTwoClicks:true,text:Ab.n,title:Ab.dsc||"",allowEmptyText:AW.allowEmptyText,allowTrimming:AW.allowTrimming||false,cssClass:AW.cssClass||"",placeholder:AY,onTextEditComplete:function AT(Ac){if(Ac){return AU(this);}},onmousedown:function AV(Ac){if(this.isEditing){Ac.cancel();}}});if(Aa&&Aa.draggable){AZ.parent=Aa;}AZ.render();AX=AZ.id;}mstrmojo.all[AX].set("isEditing",true);return mstrmojo.all[AX];},getMultipleMetricsCalculationMenus:function m(Aa,AT,Ad){var AZ=new mstrmojo.ui.menus.MenuConfig(),Af=mstrmojo.vi.ui.DatasetUnitMenuUtils.getMultiSelectionShortcutMetricFunctions(Aa),AX=function(Ah,Ai,Ag){return{dsid:AT,funcType:Ai,funcType2:Ag,items:Ah};};AZ.useTooltip=true;Af.forEach(function(Ag){AZ.addMenuItem(Ag.n,"",function(){Ad(AX(Aa,Ag.t));});});if(Aa.length===2){var AY=mstrmojo.mstr.EnumFunction,AW=AY.FunctionDivide,AU=AY.FunctionMinus,Ac=Aa[0],Ab=Aa[1],Ae=function(Ak,Ai,Ag,Aj,Ah){AZ.addMenuItem(Ak,"",function(){Ad(AX([Ai,Ag],Aj,Ah));});},AV=[{n:function(Ah,Ag){return Ah.n+"/"+Ag.n;},fn:AW},{n:function(Ah,Ag){return Ah.n+"-"+Ag.n;},fn:AU},{n:function(Ah,Ag){return"("+Ah.n+"-"+Ag.n+")/"+Ag.n;},fn:AU,fn2:AW}];AV.forEach(function(Ag){AZ.addSeparator();Ae(Ag.n(Ac,Ab),Ac,Ab,Ag.fn,Ag.fn2);Ae(Ag.n(Ab,Ac),Ab,Ac,Ag.fn,Ag.fn2);});}return AZ;},getCalculationMetricEditor:function L(Ab,Ac,Aa){var AV=[{n:"",css:"operator-plus",funcType:r.FunctionPlus},{n:"",css:"operator-minus",funcType:r.FunctionMinus},{n:"",css:"operator-multiply",funcType:r.FunctionTimes},{n:"",css:"operator-divide",funcType:r.FunctionDivide},{n:!mstrApp.isWSStyling?"%":"",css:"operator-percent-diff",funcType:r.FunctionMinus,funcType2:r.FunctionDivide}],AW={m1:Ac.did,m2:Ab[0].did,operator:r.FunctionPlus,u1:{id:Ac.did,type:4},u2:null},AU=function(Ad){return{}.hasOwnProperty.call(Ad,"cst");},AZ=function(Ad){return typeof Ad==="string"&&!!Ad.length&&!isNaN(Number(Ad));};var AT="this.parent.popupConfig.valid || this.selectedIndex !== -1 || (!!this.selectedNode && this.selectedNode.innerHTML.length === 0)",AY=function AY(){var Ad=this.parent.popupConfig;if(Ad){Ad.set("okEnabled",this[this.editableSlot].innerHTML.length!==0);}};return new mstrmojo.ui.menus.EditorConfig({cssClass:"Calculation-MenuEditor",contents:[AN({metrics:Ab,value:AW.m1,propName:"u1",optionValueField:"did",bindings:{valid:AT},postkeyup:AY}),{scriptClass:"mstrmojo.ButtonListHoriz",items:AV,selectedIndex:0,postselectionChange:function AX(){this.parent.data.set("operator",this.selectedItem.funcType);this.parent.data.set("operator2",this.selectedItem.funcType2);}},AN({metrics:Ab,value:null,propName:"u2",optionValueField:"did",bindings:{valid:AT},postkeyup:AY})],data:AW,okEnabled:false,bindings:{valid:function(){var Af=this.data.u1,Ae=this.data.u2,Ag=this.data.operator;if(!Af||!Ae||!Ag){return false;}var Ad=!(AU(Af)&&AU(Ae))&&(!AU(Af)||AZ(Af.cst))&&(!AU(Ae)||AZ(Ae.cst));this.set("okEnabled",Ad);return Ad;}},fnOk:function(Ad){return Aa(Ad.u1,Ad.u2,Ad.operator,Ad.operator2);}});},getCfgForAddUnitFromAllObject:function(AT,AU){var AV=null,AW=null,AX=[],AY=function(AZ,Aa){if(!Aa){return false;}return v.find((Aa.att||[]).concat(Aa.mx||[]),"did",AZ.did)>-1;};a.forEach(AU,function(Aa,AZ){if(Aa.idd){AV=AZ;AW=Aa;return false;}return true;});if(!AV){AV="$GUID_141";AX.push({act:"createDataset",mgo:true,prm:true,name:mstrApp.projectName,idd:true,newObjectIds:[AV]});}v.forEach(AT,function(AZ){if(!AY(AZ,AW)){AX.push({act:"addUnitToDataset",dsid:AV,unitId:AZ.did,unitType:AZ.t});}});return{actions:AX,dsid:AV};},getAggregateByMenu:function q(AY,AW){var AU=new mstrmojo.ui.menus.MenuConfig(),AV=function(Ac,Ab){var Ae,Ad;if(Ab){var Aa=Ac.mexp.args[0];Ae=Aa.did;Ad=Aa.t;}else{Ae=Ac.did;Ad=Ac.t;}return{did:Ae,t:Ad};},AT=this.getAvailableShortcutMetricFunctionsGroup(AY),AZ=AY.mexp?AY.mexp.ft:null,AX=AY.mexp&&this.isAmongFunctions(AZ,AT);AT.forEach(function(Aa,Ab){if(Ab!==0){AU.addSeparator();}Aa.forEach(function(Ac){AU.addMenuItem(Ac.n,"",function(){AW(AV(AY,AX),Ac.t);});});});return AU;},showObjectPicker:function p(AU,AT){var AV="object_picker";return function(){var AW=mstrmojo.all[AV];if(!AW){AW=new mstrmojo.vi.ui.editors.ObjectPicker({id:AV});if(AT){AW.supportedTypes=v.hash(AT);AW.ob.browsableTypes="8,"+AT.join(",");}AW.render();}else{if(AT){AW.supportedTypes=v.hash(AT);AW.ob.browsableTypes="8,"+AT.join(",");}AW.browse();}AW.OKFn=AU||mstrmojo.emptyFn;AW.open();};},getObjectPicker:function p(){var AT="object_picker";return mstrmojo.all[AT];},generateNumberFormat:function x(AY){var AT=W.DefaultFormat.FormattingNumber,AU=W.NumberFormatCategory,AW=AY||{},AV=AW.nct,AX=AV===AU.General&&AW.nfs==="General";return{category:(AV===undefined||AX)?AU.Automatic:AV,decimalPlaces:AW.ndp===undefined?2:AW.ndp,thousandSeparator:AW.nth===undefined?parseInt(AT.ThousandSeparator,10):(AW.nth?-1:0),currencySymbol:AW.ncs||AT.CurrencySymbol,currencyPosition:AW.ncp||AT.CurrencyPosition,format:AW.nfs||"",negativeNumbers:AW.nnn||AT.NegativeNumbers};},getNumberFormatEditor:function AE(AW,AV,AU){var AT=this.generateNumberFormat(AV),AX=a.clone(AT),AZ=a.clone(AT);return new mstrmojo.ui.menus.EditorConfig({data:AX,bindings:{okEnabled:function(){return !(this.data.category===AZ.category&&this.data.format===AZ.format);}},cssClass:"NumberFormat-MenuEditor",contents:[{scriptClass:"mstrmojo.vi.ui.NumberFormatter",formatValue:AT,myData:AX,oldData:AZ,adjustAfterCategoryChange:function(){this.parent.adjustCornersForPopupOverflow();}}],fnOk:function AY(Aa){if(!(Aa.category===AZ.category&&Aa.format===AZ.format)){return AU(Aa,AZ);}}});},getHighlightElementHandler:function(AV,AU,AT){return function(){D.toggleClass(AU,AT||"open",AV);};},getConfDataTypeMenuCfg:function AI(AT,Ao,Ag,A2){var Ax="ToString",An="ToNumber",Al="ToDateTime",Af="keepOriginal",AW="Default",Ay={ToString:s.DssXmlBaseFormText,ToNumber:s.DssXmlBaseFormNumber,ToDateTime:s.DssXmlBaseFormDate},Ab={ToString:"D1ED29645DEC4DBF99E8E09ED939074B",ToNumber:"399C3EC1041643F1ACE8F2A92B1C1F2F",ToDateTime:"0A558C7295DE42DAA8C5594F1724563F"},AZ="_pattern",A0="_func",Aj="_bft",A5="_state",A3={UNCHANGED:0,TO_CREATE:1,TO_UPDATE:2},AY={n:"Default",v:"Default"},Av=[{n:"MM-DD-Year",v:"MM-DD-Year"},{n:"MM/DD/Year",v:"MM/DD/Year"},{n:"DD-MM-Year",v:"DD-MM-Year"},{n:"DD/mm/Year",v:"DD/mm/Year"},AY],AV=[{n:mstrmojo.desc(13772,"Keep Original"),v:Af},{n:mstrmojo.desc(12276,"String"),v:Ax},{n:mstrmojo.desc(2052,"Date"),v:Al},{n:mstrmojo.desc(3434,"Number"),v:An}];if(mstrApp&&mstrApp.showMultiDataType){AV=[{n:mstrmojo.desc(13772,"Keep Original"),v:Af},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(3434,"Number"),v:An,bft:s.DssXmlBaseFormNumber},{n:mstrmojo.desc(9920,"Big Decimal"),v:An,bft:s.DssXmlBaseFormBigDecimal},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(2052,"Date"),v:Al,bft:s.DssXmlBaseFormDate},{n:mstrmojo.desc(9919,"DateTime"),v:Al,bft:s.DssXmlBaseFormDateTime},{n:mstrmojo.desc(2170,"Time"),v:Al,bft:s.DssXmlBaseFormTime},{isSeparator:true,cls:"separator"},{n:mstrmojo.desc(3544,"Text"),v:Ax,bft:s.DssXmlBaseFormText},{n:mstrmojo.desc(9921,"HTML Tag"),v:Ax,bft:s.DssXmlBaseFormHTMLTag},{n:mstrmojo.desc(8984,"Phone Number"),v:Ax,bft:s.DssXmlBaseFormPhoneNumber},{n:mstrmojo.desc(4530,"Symbol"),v:Ax,bft:s.DssXmlBaseFormSymbol},{n:mstrmojo.desc(9922,"URL"),v:Ax,bft:s.DssXmlBaseFormUrl},{n:mstrmojo.desc(4699,"Email"),v:Ax,bft:s.DssXmlBaseFormEmail}];}var Ae=a.clone(AV).slice(1),Am=Ao.fs.filter(function(A7){return Ao.da||A7.obf;}),A6=Am.length>1,Ai=Am.length>5,Aa=false,Aw=false,Ap=[],Au=[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13773,"Select Data Type for New Attribute:"),cssClass:"menu-info-text menu-header-text"}],A4={okEnabled:false},Az=function(){var A7=false;Am.forEach(function(A8){A7=A7||(A4[A8.fnm+A0+A5]!==A3.UNCHANGED)||(A4[A8.fnm+AZ+A5]!==A3.UNCHANGED);});return A7;},Aq=function(A9,A8){var A7=0;if(A9.da){v.forEach([Ax,Al,An],function(BC,BA){var BB=new RegExp("^\\s*"+BC+"\\s*(<.*>)?\\s*\\((.+)\\)\\s*$","i").exec(A8.f);if(BB&&BB[2]){A7=BA+1;return false;}});}return A7;},At=function(A9,A8){var A7=0;if(A9.da){var BA=A8&&A8.bftp;v.forEach(AV,function(BC,BB){if(BC.bft===BA){A7=BB;return false;}});}return A7;},As=function(A9,A8){var BA=AW;if(Ao.da){var A7=new RegExp("^\\s*"+A8+'\\s*<\\s*Pattern\\s*=\\s*"(.+)"\\s*>.*$',"i").exec(A9.f);if(!mstrmojo.string.isEmpty(A7&&A7[1])){BA=A7[1];}}return BA;},Ar=function(){return Ai?this.parent.parent.parent:(A6?this.parent.parent:this.parent);},Ak=function(A7){if(Ai){A7.formList.updateScrollbars();}},AX=function(BE,BF,BD){var A7=BF.fnm,BA=Ai?BE.formList[BF.fnm+AZ]:BE[BF.fnm+AZ],BB=A6?BA.children[1]:BA,BC=A4[A7+A0],A9=Aa&&(BC===Al||BC===Ax),A8=BA.visible!==A9;if(A8){BA.set("visible",A9);if(A9){Ak(BE);}else{BB.hideTooltip();}}if(BD){BB.set("text",As(BF,BC));BB.set("items",BC===Al?Av:[AY]);}},Ah=function(A7){var A8=false;Am.forEach(function(A9){if(A4[A9.fnm+A0]===Al||A4[A9.fnm+A0]===Ax){A8=true;return false;}});A7.advancedLabel.set("visible",A8);},AU=function(A9,A7,BA){return{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,items:A9,alias:BA.fnm+A0,selectedIndex:A7,onPopupWidgetOpened:function(){Ak(Ar.call(this));},onitemSelected:function A8(BF,BD){var BE=Ar.call(this),BG=BE.data,BH=BA.fnm,BC=BF.v,BB=function(BI){if(BI){return(A9.length===3?A3.TO_UPDATE:A3.TO_CREATE);}return A3.UNCHANGED;};BG.set(BH+A0,BC);BG.set(BH+AZ,As(BA,BC));BG.set(BH+Aj,BC===Af?BA.bftp:(BF.bft?BF.bft:Ay[BC]));BG.set(BH+A0+A5,BB(BD!==A7));BG.set("okEnabled",Az());AX(BE,BA,true);Ah(BE);}};},Ad=function(A9,BA,A7){return{scriptClass:"mstrmojo.ui.SearchablePulldown",isHostedWithin:false,alias:A9.fnm+AZ,useRichTooltip:true,visible:A7,allowCustomText:true,allowEmptyText:true,onPopupWidgetOpened:function(){Ak(Ar.call(this));},customizeSearchResult:function(BB){if(v.find(BB,"v","Default")===-1&&this.items.length>0){BB.push(AY);}},onclick:function(BB){mstrmojo.ui.SearchablePulldown.prototype.onclick.call(this,BB);this.set("isEditing",true);},updateData:function(BD){var BB=Ar.call(this),BC=BB.data,BE=A9.fnm;BC.set(BE+AZ,BD);BC.set(BE+AZ+A5,BA!==BD?A3.TO_UPDATE:A3.UNCHANGED);BC.set("okEnabled",Az());},onitemSelected:function A8(BB){if(BB){this.updateData(BB.v);}},onkeyup:function(BB){mstrmojo.ui.SearchablePulldown.prototype.onkeyup.call(this,BB);var BC=this[this.editableSlot],BD=BC.innerText||BC.textContent;this.updateData(BD);},updateTooltipConfig:function(BC){this.tooltipOpenDelay=BC?500:0;var BB=Y.position(this.domNode);this.richTooltip={content:mstrmojo.desc(14114,'Pattern determines the formatting for the resulting string of characters. You can use the custom numeric, date, and time formatting symbols. <br/> Example: if pattern is defined as "0,000.00" for "1001", it returns the string "1,001.00"'),posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:BB.y-2,left:BB.x+BB.w+10};}};},A1=function(BF,BE,A7,A8,BD){var BA=mstrApp&&mstrApp.showMultiDataType?At(BF,BE):Aq(BF,BE),BC=As(BE,AV[BA].v),A9=BE.fnm,BB=AV;if(BA>0){BB=Ae;BA--;}A8[A9+AZ]="";A8[A9+A0]="";A8[A9+Aj]="";A8[A9+A0+A5]=A8[A9+AZ+A5]=A3.UNCHANGED;if(BD){A7.push({scriptClass:"mstrmojo.HBox",cssClass:"func-input",alias:A9+A0,children:[{scriptClass:"mstrmojo.Label",text:A9,useRichTooltip:true,updateTooltipConfig:function(BI){this.tooltipOpenDelay=BI?500:0;var BH=this.domNode;var BG=Y.position(BH);if(BH.scrollWidth>BH.offsetWidth){this.richTooltip={content:BH.innerText,posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-V",top:BG.y-BG.h-10,left:BG.x-10};}}},a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown HBOXPullDown"},AU(BB,BA,BE,true))]});A7.push({scriptClass:"mstrmojo.HBox",cssClass:"pattern-input",alias:A9+AZ,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12078,"Pattern"),cssClass:"menu-info-text"},a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown HBOXPullDown"},Ad(BE,BC,true))]});}else{A7.push(a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown"},AU(BB,BA,BE,false)));A7.push(a.copy({cssClass:"ConfDataTypePullDown MeContentPullDown"},Ad(BE,BC,false)));}};v.forEach(Ao.fs,function(A7){if(AT.als&&AT.als.links[Ao.did+" "+A7.fid]){Aw=true;return false;}});if(A6){Am.forEach(function(A7){A1(Ao,A7,Ai?Ap:Au,A4,true);});}else{A1(Ao,Am[0],Au,A4,false);}if(Ai){Au.push({scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"formList",cssClass:"formList",children:Ap});}Au.push({scriptClass:"mstrmojo.Label",cssClass:"advancedLabel",alias:"advancedLabel",allowHTML:true,text:"<span>"+mstrmojo.desc(702,"Advanced")+"</span>",onclick:function(){var A8=this.parent,A9,A7,BA=true;Aa=!Aa;D.toggleClass(this.domNode,"expanded",Aa);Am.forEach(function(BB){AX(A8,BB,false);A9=Ai?A8.formList[BB.fnm+AZ]:A8[BB.fnm+AZ];A7=A6?A9.children[1]:A9;if(A9.visible&&BA&&!Ai){BA=false;A7.showTooltip();}});}});return new mstrmojo.ui.menus.EditorConfig({data:A4,cssClass:"ConfDataType-MenuEditor",contents:Au,onOpen:function(){Ak(this);},bindings:{okEnabled:"this.data.okEnabled"},fnOk:function Ac(A9){var A7=[],BB=[],A8=false,BA=function(BE,BF,BD){var BH=[],BG=function(BI){var BJ=BI.ftk&&BI.ftk.slice(2,-2);if(!BJ){return null;}while((BJ.shift()).v!=="("){}return BJ;},BC=BG(BD)||[AG(Ao,BD)];BH.push({v:"!",tp:33,lv:4});if(BE!==Af){BH.push({v:BE,oi:{did:Ab[BE],t:11,st:2816,n:BE}});if(!mstrmojo.string.isEmpty(BF)&&BF!==AW&&(BE===Al||BE===Ax)){BH.push({v:'<Pattern="'+BF+'">(',tp:"2",lv:1});}else{BH.push({v:"(",tp:"2",lv:1});}BH=BH.concat(BC);BH.push({v:")",tp:"2",lv:1});}else{BH=BH.concat(BC);}BH.push({v:"",tp:-1,lv:4});return mstrmojo.ME.AttributeEditBox.getTokenStreamXML({items:BH});};if(Aw){A8=true;}else{Am.forEach(function(BC){if(A9[BC.fnm+A0+A5]===A3.TO_CREATE){A8=true;return false;}else{if(A9[BC.fnm+A0+A5]===A3.TO_UPDATE||(A9[BC.fnm+AZ+A5]===A3.TO_UPDATE&&(A9[BC.fnm+A0]===Al||A9[BC.fnm+A0]===Ax))){BB.push(BC);}}});}if(A8){Am.forEach(function(BC){A7.push({n:BC.fnm,formula:BA(A9[BC.fnm+A0],A9[BC.fnm+AZ],BC),bft:A9[BC.fnm+Aj]});});A2(A8,A7);}else{if(Ao.da){Z(AT.mid,Ao.did,BB,function(BC){BC.forEach(function(BD){A7.push({did:BD.fid,formula:BA(A9[BD.fnm+A0],A9[BD.fnm+AZ],BD),bft:A9[BD.fnm+Aj]});});A2(A8,A7);});}}}});},getCreateTimeDAEditorCfg:function P(AW,AV){var AT=d(AW);if(!AT){return null;}return new mstrmojo.ui.menus.EditorConfig({data:{okEnabled:false},cssClass:"CreateTimeAttribute-MenuEditor",contents:[{scriptClass:"mstrmojo.ui.CheckList",alias:"time_type",items:[{n:mstrmojo.desc(873,"Year"),v:"Year"},{n:mstrmojo.desc(10051,"Quarter of Year"),v:"QuarterOfYear"},{n:mstrmojo.desc(10050,"Quarter"),v:"Quarter"},{n:mstrmojo.desc(10049,"Month of Year"),v:"MonthOfYear"},{n:mstrmojo.desc(871,"Month"),v:"Month"},{n:mstrmojo.desc(10047,"Week of Year"),v:"WeekOfYear"},{n:mstrmojo.desc(10048,"Week"),v:"Week"},{n:mstrmojo.desc(11608,"Day of Year"),v:"DayOfYear"},{n:mstrmojo.desc(10046,"Day of Month"),v:"DayOfMonth"},{n:mstrmojo.desc(10045,"Day of Week"),v:"DayOfWeek"}],onchange:function AU(){var AY=false;a.forEach(this.selectedIndices,function(AZ){if(AZ){AY=true;return false;}});this.parent.data.set("okEnabled",AY);}}],bindings:{okEnabled:function(){return this.data.okEnabled;}},fnOk:function AX(Ac,Aa){var Ab=Aa.time_type,Af=Ab.selectedIndices,AZ=Ab.items,Ae=[],AY=[],Ad=function(Ag,Ai,Ak){var Aj=[{v:"!",tp:33,lv:4}],Ah;Ak.forEach(function(Al){if(Al===Q){Aj.push(AG(Ag,Ai));}else{Ah=AJ[Al];if(Ah){Aj.push({v:Ah,oi:{did:Ah,t:11,st:2816,n:Ah}});}else{Aj.push({v:Al,tp:"2",lv:1});}}});Aj.push({v:"",tp:-1,lv:4});return mstrmojo.ME.AttributeEditBox.getTokenStreamXML({items:Aj});};a.forEach(Af,function(Ag,Ah){if(Ag){AY=[];a.forEach(AP[AZ[Ah].v],function(Ai,Aj){AY.push({n:Aj,formula:Ad(AW,AT,Ai),bft:(Aj==="DATE"?8:0)});});Ae.push({isTokenStream:true,forms:AY,name:AW.n+" ("+AZ[Ah].n+")"});}});return AV(Ae);}});},RefreshAndCloseAllObjectBrowserCallback:function(AU,AT){return mstrmojo.func.wrapMethods(AT.getDatasetsUpdateCallback(),{success:function(){if(v.find(AU,"act","createDataset")!==-1){AT.controller.datasetsPanel.set("allObjectBrowserOpened",false);}}});},getUnitFromDataset:function e(AU,AW,AT){var AV=null;a.forEach(AU,function(AY){var AX=AY.att||[];if(AT===4){AX=AY.mx||[];}v.forEach(AX,function(AZ){if(AZ.did===AW){AV=AZ;return false;}});if(AV){return false;}});return AV;},getDatasetFromId:function R(AT,AU){var AV=null;a.forEach(AT,function(AW){if(AW.did===AU){AV=AW;return false;}});return AV;},getDatasetFromAttributeId:function R(AT,AU){var AV=null;a.forEach(AT,function(AW){if(v.find(AW.att,"did",AU)>=0){AV=AW;return false;}});return AV;},getSortedDatasetUnits:function E(AT){var AU=function AU(AV){return AV.t===X.DssTypeMetric?2:1;};AT=AT.concat();AT.sort(function(AY,AW){if(!AY||!AW){return true;}var AZ=AU(AY)-AU(AW),AX=AY.n.toUpperCase(),AV=AW.n.toUpperCase();return AZ!==0?AZ:(AX!==AV?AX.localeCompare(AV):AY.n.localeCompare(AW.n));});return AT;},isGeoAttr:function AK(AT,AU){return !!(AT.fs&&(AT.fs instanceof Array)&&AT.fs.length&&AT.fs.some(function(AV){return AV.fgr>0&&(!AU||(AU&&AV.obf));}));},isTimeAttr:function h(AT){return !!(AT.fs&&d(AT));},getUnitCssClass:function(AU){var AT=AU.t;if(this.isGeoAttr(AU,AU.useAvailGeoFmsOnly)){AT+="g";}else{if((AU.dm||AU.um)||AU.da){AT+="d";}else{if(AU.de){AT+="de";}else{if(this.isTimeAttr(AU)){AT+="t";}}}}if((AU.t===AS.Consolidation&&AU.st===N.ConsolidationManaged)||(AU.t===AS.Attribute&&AU.st&&AU.st===N.AttributeRecursive)){AT+=(" st"+AU.st);}if(AU.t===AS.Consolidation&&AU.st===N.ConsolidationManaged&&AU.ndetype===AD.DssRecursiveDerivedElement){AT+=" nde4ra";}return"ic"+AT;},hasMultiForms:function o(AU,AT){return t.getFormsByAttrId(AU,AT).length>1;},getDisplayFormsMenu:function F(Ai,Ag,Aa,Af){var Ae=[],Ah=[],AX=[],Ac=[{n:mstrmojo.desc(2411,"Off"),v:0},{n:mstrmojo.desc(2410,"On"),v:1},{n:mstrmojo.desc(8504,"Form Name Only"),v:2},{n:mstrmojo.desc(8505,"Show Attribute Name Once"),v:3},{n:mstrmojo.desc(4531,"Automatic"),v:4}];var Ab=Ag.model.data,AT=Ab.gts,Ad;var AW=Ai.t===AS.Consolidation&&Ai.st===N.ConsolidationManaged;v.forEach((AT.row||[]).concat(AT.col||[]),function(Aj){if(Aj.id===Ai.did){Ah=Ah.concat(Aj.fs);}});Ad=t.getFormsByAttrId(Ai.attId||Ai.did,Aa);v.forEach(Ad||[],function(Ak){var Al=Ak.fid;if(v.find(Ae,"id",Al)<0){Ae.push({id:Al,n:Ak.fnm});var Aj=v.find(Ah,"id",Al);if(Aj>-1){AX[Ae.length-1]=true;}}});var AY=[{alias:"fs",scriptClass:"mstrmojo.ui.CheckList",minimumSelectCnt:1,items:Ae,selectedIndices:AX},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11918,"Display attribute form names:"),cssClass:"menu-info-text"},{alias:"longNames",scriptClass:"mstrmojo.ui.Pulldown",items:Ac,isHostedWithin:false,selectedIndex:v.find(Ac,"v",Ab.lnm||0),onitemSelected:function AU(Aj){this.v=String(Aj.v);}}];if(Ag.getChartStyle&&Ag.getChartStyle()==="NewGraphMatrixVisualizationStyle"){AY.splice(-2,2);}if(AW){AY.splice(-2,2);}return new mstrmojo.ui.menus.EditorConfig({cssClass:"displayForms",data:{item:Ai,oldSelected:a.copy(AX,{})},contents:AY,okBtnText:mstrmojo.desc(1442,"Ok"),fnOk:function AV(Ao,As){var An=As.fs,Al=An.selectedIndices,Aq=An.items,Aw=[],Ap=[],At=[];if(!An.getSelectedItems().length){mstrmojo.alert("Please select at least one form!");return ;}var Ak=Ao.oldSelected,Av=Al,Am,Ar={},Au={};for(Am=0;Am<Aq.length;Am++){if(Ak[Am]&&!Av[Am]){Ar[Am]=true;}else{if(!Ak[Am]&&Av[Am]){Au[Am]=true;}}}a.forEach(Ar,function(Ax,Ay){if(Ax){Ap.push({act:"removeForm",unitId:Ai.did,unitType:Ai.t,attFormId:Aq[Ay].id});}});var Aj=Ag.model.data.gts;(Aj.row||[]).concat(Aj.col||[]).forEach(function(Ax){if(Ax.id===Ai.did){(Ax.fs||[]).forEach(function(Ay){if(v.find(Ae,"id",Ay.id)<0){Ap.push({act:"removeForm",unitId:Ai.did,unitType:Ai.t,attFormId:Ay.id});}});}});a.forEach(Au,function(Ax,Ay){if(Ax){Aw.push({act:"addForm",unitId:Ai.did,unitType:Ai.t,attFormId:Aq[Ay].id,unitPos:0});}});At.push({act:"putProperties",prs:"Template Formatting",pr:"LongNames",v:As.longNames?As.longNames.v:0});if(Af){Af([{act:"updateTemplate",keyContext:Ag.k,partialRetrieval:{nodes:[Ag.k]},actions:Ap.concat(Aw).concat(At)}]);}},onOpen:function AZ(){this.fs.updateScrollbars();}});},getAttributeLinkMenu:function j(Af,Ai,Ad,Ah,AY){var Aj=-2147483648,Aa=Ah.datasets,Ab=Aa[Ad],Ag=Ab.tables||[],AT={},Ac=[],AW=(Ai.fs&&Ai.fs[0])||{},Ae=[],AZ=779,AV=Ai.art>1,AU=!AV&&a.keyarray(Aa).length>1,AX=function(){mstrmojo.vi.ui.editors.AttributeLinkEditor.open({attribute:Ai,docModel:Ah,datasetId:Ad});};if((Ab.st!==AZ)||Ag.length<=1||Ai.da){if(AU){Af.addMenuItem(mstrmojo.desc(11941,"Link to Other Dataset..."),"",AX);}return ;}v.forEach(Ab.att,function(Am){var An=true,Al=null,Ak=(Am.fs&&Am.fs[0])||{};if(Am.da){return ;}if(AW.der===Aj||Ak.der===Aj||AW.fgr===-1||Ak.fgr===-1||AW.ftr===-1||Ak.ftr===-1){return ;}if(AW.fgr&&Ak.fgr&&AW.fgr!==Ak.fgr){return ;}if(AW.ftr&&Ak.ftr&&AW.ftr!==Ak.ftr){return ;}v.forEach(Ag,function(Ao){var Ap=v.find(Ao.attRefs,"did",Ai.did),Aq=v.find(Ao.attRefs,"did",Am.did);if(Ap>=0&&v.indexOf(Ac,Ao.did)<0){Ac.push(Ao.did);}if(Aq>=0){Al=Ao.did;}if(Ap>=0&&Aq>=0){An=false;}});if(An&&!Am.hide){AT[Am.did]=Al;Ae.push(Am);}});if(Ae.length>0&&Ab.hcs!==true&&!Ah.isSparkDataset(Ab)){Af.addEditorMenuItem(mstrmojo.desc(13172,"Map Attributes"),"",function(){return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"mapAttribute",okVisible:false,cancelVisible:false,contents:[{scriptClass:"mstrmojo.ui.ScrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:Ae,listHooks:{select:function Ak(Al,Am){Ah.warnForEditStandaloneDS(Ab,function(){v.forEach(Ac,function(An){I({dsid:Ad,srcId:Ai.did,srcTableId:An,tgtId:Am.did,tgtTableId:AT[Am.did]},Ah,AY);});});}}}]}]});});}if(AU){Af.addMenuItem(mstrmojo.desc(11941,"Link to Other Dataset..."),"",AX);}},isDocumentLevelItem:function w(AT){return AT&&(AT.um||AT.da||(AT.t===AS.Consolidation&&AT.st===N.ConsolidationManaged));},isLegalObjectName:function S(AT){var AU=/["\[\]\\]/g;if(AT.match(AU)){return false;}return true;},validateName:function l(AU,AV,AT){if(this.isLegalObjectName(AU)){AV();}else{mstrmojo.alert(mstrmojo.desc(8622,"The # cannot contain the reserved characters ##.").replace("##","'[', ']', '\"' and '\\'").replace("#",mstrmojo.desc(945,"Name")),AT,mstrmojo.desc(1388,"Rename"));}},hasCGorCon:function AR(AT){return AT.att.some(function(AU){return H(AU);});},isCGorCon:function AH(AT,AV){var AU=v.filterOne(AV&&AV.att,function(AW){return AW.did===AT.did;});return H(AU||AT);},hasOldDEOverDatasets:function(AW,AV){var AU=false,AT;a.forEach(AV,function(AX){AT=v.find((AX.att||[]),"did",AW);if(AT!==-1&&AX.att[AT].de){AU=true;return false;}});return AU;},getMarkGeoRoleEditorCfg:function AO(AT,A5,An,Ak,BE,BG){var Aj=268435456,BB=536870912,AY=1073741824,Ax=268435456,A8=805306368,A3=805306368,Ar=1879048192,BF=-2147483648,A6=0,A7=1,Aa=2,Ai=3,Am=4,Ag=5,BD=6,Ad=7,Ap=8,Ao=9,Az=10,AW=2,Aw=3,A4={v:A6,n:mstrmojo.desc(2057,"None")},BH={v:Ai,n:mstrmojo.desc(7674,"Country"),der:Aj},A2={v:Aa,n:mstrmojo.desc(7676,"State"),parents:[BH],der:BB},Ae={v:Ao,n:mstrmojo.desc(12919,"County"),parents:[BH,A2]},A9={v:A7,n:mstrmojo.desc(7675,"City"),parents:[BH,A2],der:AY},As={v:Ap,n:mstrmojo.desc(7677,"Zip Code"),parents:[BH,A2,A9]},Al={v:Ag,n:mstrmojo.desc(7696,"Latitude")},A0={v:BD,n:mstrmojo.desc(7697,"Longitude")},Ah={v:Am,n:mstrmojo.desc(7675,"City")+", "+mstrmojo.desc(7676,"State")},Av={v:Az,n:mstrmojo.desc(12973,"Area Code")},Ay={v:Ad,n:mstrmojo.desc(2056,"Custom")},Af={ID:[A4,BH,A2,Ae,A9,As,Al,A0,Ah,Av,Ay],ID_NUMERIC:[A4,As,Av,Al,A0],NON_ID:[A4,BH,A2,Ae,A9,As,Ah,Av,Ay],NON_ID_NUMERIC:[A4,As,Av]},At=v.filter(A5.fs,function(BI){return(BI.bftp===AW||BI.bftp===Aw)&&BI.der!==BF;});var A1=(At.length>1),AV=v.find(At,"idf",true),AX=(AV===-1?0:AV),Au=At[AX],Ac,AU,Aq,AZ=[],Ab=function(BI){var BJ=(BI.idf?"ID":"NON_ID")+(BI.bftp===AW?"_NUMERIC":"");return Af[BJ];},BC=function(BJ,BI){return v.find(Ab(BI),"v",BJ);};if(At.length===0||v.find(A5.fs,"fgr",-1)!==-1||Au.der===BF){return null;}v.forEach(At,function(BK,BI){var BJ=a.clone(BK);BJ.n=BJ.fnm;AZ.push(BJ);if(BK.fgr){Au=BJ;AX=BI;}});Ac=Au.fid;Aq=Au.fgr||0;AU=BC(Aq,Au);return new mstrmojo.ui.menus.EditorConfig({data:{item:A5,geoForm:Au,geoRole:Aq},cssClass:"MarkGeoRole-MenuEditor",contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13522,"Select Attribute Form:"),visible:A1},{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,cssClass:"MarkGeoRolePullDown",items:AZ,selectedIndex:AX,alias:"formList",visible:A1,onitemSelected:function BA(BK){var BI=this.parent.data,BJ=this.parent.geoRoleList;if(BI.geoForm.fid!==BK.fid){BI.set("geoForm",BK);BI.set("geoRole",BK.fgr);BJ.set("items",Ab(BK));BJ.set("selectedIndex",BC(BK.fgr,BK));}}},{scriptClass:"mstrmojo.ToolSeparator",visible:A1,markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13523,"Select Geographic Type:"),cssClass:"menu-info-text"},{scriptClass:"mstrmojo.ui.Pulldown",isHostedWithin:false,cssClass:"MarkGeoRolePullDown",items:Ab(Au),selectedIndex:AU,alias:"geoRoleList",onitemSelected:function BA(BO){var BN=this.parent,BI=BN.data,BP=BN.geoDrvList;var BK=[],BM=[],BJ=Au.der,BL;BI.set("geoRole",BO.v);v.forEach(BO.parents,function(BQ,BR){BL=BQ;BK.push({n:BL.n,der:BL.der});if((BJ&BL.der)!==0){BM[BR]=true;}});BP.set("items",BK);BP.set("selectedIndices",BM);v.forEach(["geoDrvSeparator","geoDrvLabel","geoDrvList"],function(BQ){BN[BQ].set("visible",BK.length>0);});if(BN.adjustCornersForPopupOverflow){BN.adjustCornersForPopupOverflow();}}},{scriptClass:"mstrmojo.ToolSeparator",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},alias:"geoDrvSeparator"},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13524,"(Optional) Create Additional Attributes:"),alias:"geoDrvLabel",cssClass:"menu-info-text"},{scriptClass:"mstrmojo.ui.CheckList",alias:"geoDrvList"}],fnOk:function(BN,BM){var BJ=function(BU){var BT=function(BY){var BZ="<mpcs>";v.forEach(BY,function(Ba){BZ+='<mpc did="'+Ba.did+'" n="'+Ba.n+'" georole="'+Ba.georole+'" drvflg="'+Ba.drvflg+'" />';});BZ+="</mpcs>";return BZ;},BP=function(BY,Ba,Bc,BZ){var Bb=function(Bg,Bd,Bf){var Be=U(BU,Bg,Bd),Bh=n(Be,Bf);return Bh&&Bh.did;};BE.forEach(function(Bd,Be){var Bf=Bb(Bd.did,A5.did,Ba.fid);if(Bf){BY[Be]=BY[Be]||[];BY[Be].push({did:Bf,n:Ba.fnm,georole:Bc,drvflg:BZ});}});},BR=[],BX=[],BV=BM.geoDrvList,BQ=0,BS=false,BW={2:Ax,1:A8,9:A3,8:Ar}[BN.geoRole]||0;a.forEach(BV.selectedIndices,function(BZ,BY){if(BZ){BQ|=BV.items[BY].der;}});BQ&=BW;if(Au.fgr!==BN.geoRole||Au.fid!==BN.geoForm.fid||Au.der!==BQ){if(A1&&Au.fid!==BN.geoForm.fid){if(Au.fgr!==A6){BP(BX,Au,A6,0);if(Au.der>0){BS=true;}}}if(BN.geoForm.fgr!==BN.geoRole||BN.geoForm.der!==BQ){BP(BX,BN.geoForm,BN.geoRole,BQ);if((BQ&BN.geoForm.der)!==BN.geoForm.der){BS=true;}}if(BX.length>0){BX.forEach(function(BZ,BY){BR.push({act:"changeEMMAMapping",dsid:An,tbid:BE[BY].did,mapping:BT(BZ)});});BG(BR,BS);}}},BK=function(){C(AT.mid,An,{success:BJ});};var BL=mstrApp.isAppStatePause();if(!Ak||BL){var BO,BI=BL?mstrmojo.desc(212,"Continue"):mstrmojo.desc(219,"Yes");if(Ak){BO=mstrmojo.desc(16237,"The operation requires the dataset to be unloaded from memory. It will be automatically reloaded when you resume data retrieval. Do you want to continue?");}else{BO=BL?mstrmojo.desc(16236,"The operation requires modifying the dataset and unloading it from memory. It will be automatically reloaded when you resume data retrieval, however the change will also affect other reports, documents, and dossiers that share the dataset. Do you want to continue?"):mstrmojo.desc(15493,"Modifications to this dataset will affect other reports, documents, and dossiers that share the dataset. Do you want to continue?");}mstrmojo.warn(BO,{},{buttons:[z(BI,function(){BK();},true,{cssText:"min-Width: 60px"}),z(mstrmojo.desc(221,"Cancel"),function(){})]});}else{BK();}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Editor","mstrmojo.ValidationTextBox","mstrmojo.ME.AttributeEditBox");mstrmojo.requiresDescs(2399,2400,2890,11569,11617);var H=mstrmojo.desc,R=mstrmojo.Button.newWebButton,I=mstrmojo.hash,B=mstrmojo.array,J=mstrmojo.ME.AttributeEditBox.getTokenStreamXML;function F(V,U){V.set("enabled",!U);V.set("iconClass",V.iconClass.replace(/mstrmojo-InlineWaitIcon/,"")+" "+(U?"mstrmojo-InlineWaitIcon":""));}function L(U){var V={isComplete:true,items:[].concat(U.candidates.items)};V.items.push({n:"This",did:"This",t:12});V.items.push({n:"ID",did:"ID",attid:"This",attn:"This",fmdid:"ID",t:21});U.descCandidates=V;}function K(U,V){if(U&&V){V.candidates=null;V.set("candidates",U);}}function S(U){if(U.oi&&U.oi.alias){return ;}U.tmr=window.setInterval(function(){if(U.visible&&U.domNode){window.clearInterval(U.tmr);delete U.tmr;U.nameEditBox.nameInput.inputNode.select();}},50);}mstrmojo.ME.DerivedAttributeEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DerivedAttributeEditor",cssClass:"mstrmojo-DAEditor",zIndex:10,help:"Attribute_Editor.htm",useKeyDelay:true,noCache:false,name:"New Attribute",init:function P(U){if(this._super){this._super(U);}L(this);},getAttributeEditBox:function N(){return this.attrEditBox;},getTokenInputBox:function A(){return this.attrEditBox.inputBox;},onObjectInsert:function O(U){this.getAttributeEditBox().onObjectInsert(U);},onOpen:function E(){var W=this,V=this.oi,Y=V.alias||V.n||"New Attribute",U=this.attrEditBox,X=U.inputBox;K(W.candidates,X);X.noCache=this.noCache;X.useKeyDelay=this.useKeyDelay;this.set("title",H(9559,"Formula Editor:")+" "+V.n);this.set("name",Y);this.set("nameLabel",V&&V.alias?H(2326,"Display Name"):H(11617,"Attribute Name"));if(V&&V.forms){this.originForms=I.clone(V.forms);U.set("attrid",V.did);U.set("forms",V.forms);U.selectFormTab(0);}U.set("cValid",V&&V.forms);S(this);},onClose:function C(){if(this._super){this._super();}this.clear();},handleValidation:function G(U){this.attrEditBox.handleValidation(U);},save:function Q(){var c=this,Y=this.parent.id,f=this.oi,X=this.buttonBar.saveBtn,d=this.attrEditBox,U=f.dsid,W=f.did,Z,b=this.oncreate,V=this.onupdate,j=this.nameEditBox.nameInput.value,h={success:function g(){F(X,false);d.clear();var k=mstrmojo.all[Y];if(k){k.close();}}},e=function(l){if(l&&b){var k=[],m;for(m=0;m<l.length;m++){k.push({n:l[m].n,formula:l[m].tokenXML,bft:l[m].bft||l[m].bftp,bftp:l[m].bftp||l[m].bft,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(l[m].bftp||l[m].bft)});}Z={act:"addDAToDataset",dsid:U,name:j,isTokenStream:true,forms:k};b(Z,h);}else{F(X,false);}},a=function(l){var n=c&&c.originForms;var o={};B.forEach(n,function(u){o[u.did]={n:u.n,formula:J({items:u.ftk}),bft:u.bft,bftp:u.bftp,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(u.bft)};});if(l&&V){var t=[],s=[],k=[],m,r,p;for(p=0;p<l.length;p++){m=l[p];r={n:m.n,formula:m.tokenXML,bft:m.bft,bftp:m.bftp,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(m.bft)};if(m.did){r.did=m.did;var q=o[r.did];if(mstrApp.isSingleTier&&q){r.originN=q.n;r.originFormula=q.formula;}k.push(r);}else{t.push(r);}}for(p=0;d.delForms&&p<d.delForms.length;p++){m=d.delForms[p];r={n:m.n,did:m.did};if(mstrApp.isSingleTier&&o[m.did]){r.originFormula=o[m.did].formula;}s.push(r);}Z={act:"updateDA",name:j,dsid:U,attrId:W,isTokenStream:true,add:t,del:s,update:k};V(Z,h);}else{F(X,false);}};if(d.dirty||j!==(f.alias||f.n)){F(X,true);d.validateAllForms(!W?e:a);}else{h.success();}},clear:function M(){var U=this.attrEditBox;this.name=null;U.clear();},children:[{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DA-nameLabel",bindings:{text:"this.parent.parent.nameLabel"}},{scriptClass:"mstrmojo.ValidationTextBox",alias:"nameInput",cssClass:"mstrmojo-ME-nameInput",size:20,tooltipOpenDelay:0,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,invalidCssClass:"mstrmojo-ME-invalidName"},prefocus:function(){if(this._super){this._super();}this.validate();},validate:function(U){U=U||this.value;var V=U&&!/[\[\]\"\\]/g.test(U);this.valid=null;this.set("valid",V);this.set("validationStatus",{code:V?0:1});return V;},showErrTooltip:function D(){var U=mstrmojo.dom.position(this.domNode),W=mstrmojo.string.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.useRichTooltip=true;this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+W+"</span></div>",top:U.y-5,left:U.x+U.w+10};this.showTooltip();var V=this;window.setTimeout(function(){V.hideTooltip();},1500);},valid:true,onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.set("validationStatus",1);this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!this.valid);},bindings:{value:"this.parent.parent.name"}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DAE-form-label",text:H(2890,"Attribute Forms")},{scriptClass:"mstrmojo.ME.AttributeEditBox",alias:"attrEditBox",browseItemVisible:false,cValid:false,ontabSwitch:function(V){var U=this.parent;K(V.nidx>0?U.descCandidates:U.candidates,this.inputBox);if(U.parent&&U.parent.onformsTabSwitch){U.parent.onformsTabSwitch(V);}},ontokensModify:function(){this.set("cValid",this.inputBox.items.length>0);this.set("dirty",true);},isObjectVisible:function(V){var X=mstrmojo.all.mstrDerivedAttrIDE;var W=X.candidates.all;var U=mstrmojo.array.find(W,"did",V.did);if(U>-1){return X.isObjectVisible(W[U]);}return true;}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[R(H(2400,"Save"),function(){var U=this.parent.parent;U.save();},true,{alias:"saveBtn",bindings:{enabled:"!!(this.parent.parent.nameEditBox.nameInput.valid && this.parent.parent.attrEditBox.cValid)"}}),R(H(2399,"Cancel"),function(){var U=this.parent.parent,V=U.parent;U.clear();V.close();})]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Button","mstrmojo.Editor","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper");mstrmojo.requiresDescs(12852);var J=mstrmojo.expr,A=mstrmojo.array,G=mstrmojo.hash,M=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.Enum.DYNAMIC_DIMTY,L=mstrmojo.ME.Enum.UI_DATA_TYPE,I=mstrmojo.ME.Enum.UI_OBJECT_TYPE,F=mstrmojo.ME.MetricToken.brackets;var K;function Q(){var E=mstrmojo.all[K];if(E&&E.onmetricModify){E.onmetricModify();}}function C(){var E=mstrmojo.all[K];if(E&&E.updateScrollbars){E.updateScrollbars();}}mstrmojo.ME.SortByInputList=mstrmojo.declare(mstrmojo.WidgetList,null,{makeObservable:true,isNewDef:true,isDME:false,init:function R(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-sortby");},preBuildRendering:function(){var E=this.items||[];if(this.isNewDef&&this.isDME){E.push(B.getAutomaticDimtyObject());}E.push({n:""});this.items=E;if(this._super){this._super();}},getTokens:function(){var X=this.items,E=X.length-1,W,b=[];if(E>0){b.push({v:"SortBy"});b.push({v:"=",isDelimiter:true});b.push({v:"(",isDelimiter:true});for(W=0;W<E;W++){var Z=X[W],a=Z.selFrm,V,Y=false;if(M.isDimty(Z.n)){V={v:Z.n};Y=true;}else{if(/^@/.test(Z.did)){V={v:Z.did};Y=true;}else{V={v:F(Z.n),oi:Z};}}if(a&&(Z.t===J.TP.ATTR||(Z.t===J.TP.CONS&&Z.st===J.STP.NDE))){G.copy({v:F(Z.n)+"@"+F(a.n),exv:a.dssid,extp:8},V);}b.push(V);if(!Y){if(!!Z.asc){b.push({v:"Desc",tp:259});}}if(W!==(E-1)){b.push({v:",",isDelimiter:true});}}b.push({v:")",isDelimiter:true});}return b;},itemFunction:function(Y,E,V){return new mstrmojo.Box({cssClass:"mstrmojo-ME-sortby-item",alias:"sortByItem",parent:V,children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"sortByInput",cssClass:"mstrmojo-ME-ObjectInputBox-sortby",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),isDME:V.isDME,dtp:L.Sortby,maxObjectCount:1,folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(","),getCandidatesThroughTaskCall:function a(d,c){d.objectType=J.TP.ATTR+","+J.TP.METRIC;d.rootFolderType=39;d.blockCount=d.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(d,c);},obCfg:{folderLinksContextId:16,browsableTypes:[J.TP.ATTR,J.TP.METRIC,J.TP.FOLDER].join(",")},bindings:{candidates:"this.parent.parent.candidates"},postCreate:function(c){if(!c){this.set("items",Y.did||Y.dimty?[Y]:null);}},onitemchange:function(){var e=this.getSelectedObjects()[0];if(!e||!e.did&&!e.n){return ;}Y.selFrm=null;mstrmojo.hash.copy(e,Y);var d=this.parent.formsPulldown;if(d){d.updateForms(e);}var c=this.parent.ascPulldown;if(c){c.set("visible",Y.t===4||Y.st===J.STP.NDE);}Q();},onadd:function W(){if(this.getSelectedObjects().length===0){return ;}if(this.parent===V.ctxtBuilder.itemWidgets[V.items.length-1]){V.add([{n:""}]);this.parent.del.set("visible",true);}},hidePulldownButton:function(){return !V.isDME;},hideDelButton:function(){return true;},hideItemWidgetBrowseButton:function(){return V.isDME;},getItemsToFilterOut:function(){return V.items;}},{scriptClass:"mstrmojo.Pulldown",alias:"formsPulldown",cssClass:"mstrmojo-ME-sortby-forms mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",defaultSelection:-1,bindings:{visible:function(){return this.items&&this.items.length>0;}},popupToBody:true,popupZIndex:100,postCreate:function(){this.retrieveDssForms(Y);},retrieveDssForms:function X(e){var d=this,c=function(){var m=function(n){e.dssforms=n;d.set("items",e.dssforms);d.selectedIndex=-1;d.selectedItem=null;d.value=null;d.set("value",e.selFrm);};var k=d.parent.sortByInput.candidates,f=k&&k.items;if(e.did&&f){var j=A.find(f,"did",e.did);if(j>-1){var h=mstrmojo.hash.clone(f[j].fs);if(h){A.forEach(h,function(n){n[d.itemIdField]=n.fid;n[d.itemField]=n.fnm;});m(h);return ;}}}var l=function(n){if(n){var o=n.container;if(o&&o.dssforms){e.dssforms=o.dssforms;m(e.dssforms);}}},g=function(n){mstrmojo.alert(n.getResponseHeader("X-MSTR-TaskFailureMsg"));};mstrmojo.ME.MetricDataService.getAttributeForms({attributeID:e.did,displayedForms:0},{success:l,failure:g});};switch(e.t){case J.TP.ATTR:c();break;case J.TP.CONS:if(e.st===J.STP.NDE){d.set("visible",false);}break;case J.TP.METRIC:d.set("visible",false);break;case I.Dimty:d.set("visible",false);break;}},updateForms:function Z(c){this.retrieveDssForms(c);},onvalueChange:function b(){if(this.selectedItem){Y.selFrm=this.selectedItem;}if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Pulldown",alias:"ascPulldown",cssClass:"mstrmojo-ME-sortby-asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"Ascending",v:0},{n:"Descending",v:1}],itemIdField:"v",popupToBody:true,popupZIndex:100,visible:false,bindings:{value:function(){return this.parent.parent.items[E].asc;},visible:function(){var c=this.parent.sortByInput.getSelectedObjects()[0];return this.parent.formsPulldown.visible&&this.parent.formsPulldown.value||c.t===J.TP.METRIC||c.st===J.STP.NDE;}},onvalueChange:function(c){Y.asc=this.value;if(this.hasRendered){Q();}}},{scriptClass:"mstrmojo.Button",alias:"del",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),bindings:{visible:function(){var c=V.itemIndex(Y);return this.parent.parent.items[c].did;}},onclick:function(){V.remove(V.items[V.itemIndex(Y)]);Q();}}]});},onadd:function H(){C();},onremove:function S(){C();}});mstrmojo.ME._HasSortBy=mstrmojo.provide("mstrmojo.ME._HasSortBy",{_mixinName:"mstrmojo.ME._HasSortBy",ios:false,oniosChange:function P(E){this.sortByContainer.set("visible",E.value);},onOpen:function(){if(this._super){this._super();}K=this.id;var V=this.oi.tks,W=!V.met;var E=this.sortByContainer&&this.sortByContainer.sortByWidgetList;if(E){E.set("isNewDef",W);E.set("isDME",this.isDME);E.set("candidates",this.getCandidates4Sortby());E.set("items",this.getSortByDefFromTokens().items||[]);}},getCandidates4Sortby:function U(){var V=this.candidates,E;if(V&&!this.noCache){E=A.filter(V.items,function(W){return W.t===J.TP.ATTR||W.t===J.TP.METRIC||W.st===J.STP.NDE;});if(this.isDME){E=B.getItems("sortby").concat(E);}}return{items:E||[],isComplete:V&&V.isComplete};},getSortByWidget:function D(E){var X=this,W=[{scriptClass:"mstrmojo.ME.SortByInputList",alias:"sortByWidgetList",cssClass:"sortBy mstrmojo-ME-sortby",cssDisplay:"table-cell"}],V={scriptClass:"mstrmojo.Label",alias:"sortByLabel",cssClass:"mstrmojo-ME-SortBy-label",cssDisplay:"table-cell",text:mstrmojo.desc(12852,"Sort By")};if(E){W.unshift(V);}return{scriptClass:"mstrmojo.Box",alias:"sortByContainer",cssClass:"mstrmojo-ME-SortBy-Container",cssDisplay:"table-row",visible:X.ios,postCreate:function(){X.sortByContainer=this;this.editor=X;},getTokens:function(){return this.sortByWidgetList.getTokens();},children:W};},getSortByDefFromTokens:function N(){var b=this.oi.tks.items,X=b.length,c,Z,V,W,Y={};for(W=0;W<X;W++){c=b[W];Z=c.tp;V=c.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(c.v)&&(c.v!=="("&&c.v!==")")||c.v==="&gt;"||c.v==="&lt;"){continue;}switch(V){case 131072:if(Z===302){c=b[++W];while(c){if(c.tp!==282){if(c.oi){c.oi.selFrm=c.exv;var a=b[W+1];if(a.v==="Desc"&&a.tp===259){c.oi.asc=1;W++;}Y.items=Y.items||[];Y.items.push(c.oi);}else{if(c.tp===64){Y.items=Y.items||[];var E=c.v+b[++W].v;c=b[W+1];if(c.tp===43||c.tp===45){E+=b[++W].v;E+=b[++W].v;}Y.items.push(B.getDimtyObject(E,this.isDME));}}}if((c=b[++W])["v"]===")"){break;}}}}}return Y;},getSortByDefAsTokens:function O(){return this.sortByContainer.getTokens();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui.ScrollableSuggestionList");var H=mstrmojo.expr,O=mstrmojo.Enum_OIB_States,J=mstrmojo.ME._MetricEditorHelper,R=mstrmojo.dom;mstrmojo.ME.ObjectInputBox=mstrmojo.declare(mstrmojo.ObjectInputBox,null,{cssClass:"",autoSelect:false,suggestionListClass:"mstrmojo.ui.ScrollableSuggestionList",suggestionPopupCssClss:"mstrmojo-ME-ObjectInputBox-suggest",blockCount:mstrmojo.ME.MetricDataService.blockCount,suggestCount:mstrmojo.ME.MetricDataService.suggestCount,useKeyDelay:true,showDesc:true,showPath:true,showFunctionSyntaxAsPath:true,emptyText:"Search for an object",showEmptyItem:false,noEditButton:true,browseItemVisible:true,click2edit:true,showSuggestionOnEdit:false,tabNavigable:true,obCfg:{},dynamicVerify:true,init:function P(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ME-ObjectInputBox");if(this.isDME){this.browseItemVisible=!this.isDME;this.suggestCount=this.isDME?1000:mstrmojo.ME.MetricDataService.suggestCount;this.REQUEST_THRESHOLD=1000;this.dynamicVerify=false;}},item2textCss:function D(X){if(this.isDME){return mstrmojo.ME._MetricEditorHelper.item2textCss(X);}var E=this._super(X)||{1:"f",4:"m",12:"a",13:"fc",43:"tr","-1":"rl","-99":"br"}[X.t]||"";return E?" icn "+E:"";},itemFunction:function B(Y,E,X,Z){Y[X.itemIdField]=X.nextId();var a=Z||mstrmojo.ME.ObjectItem,b=new a({parent:X,itemField:X.itemField,cssClass:X.item2textCss(Y),data:Y,bindings:{isFull:"this.parent.isFull"},onisFullChange:function(){if(this.hasRendered){this.updateButtonsVisibility();}}});X.attachEventListener4ItemWidget(b,X);return b;},getActiveItem:function M(){var E=this.editingIdx,Y,X;if(E>-1){Y=this.ctxtBuilder.itemWidgets[E];X=Y&&Y.data;}return X;},showObjectBrowser:function(E){this.set("suggestTarget",E);this.handleSuggestionItemSelect({t:-99},this.obCfg);},hideItemWidgetBrowseButton:function S(){return false;},hidePulldownButton:function G(){return true;},hideDelButton:function A(){return false;},dtp:0,verifyObject:function C(X,E){if(!this.dynamicVerify){return O.VALID;}var Z=E.data;var Y=parseInt(this.dtp,10);switch(Y){case -1:case -2:case -4:case -5:case -6:if(Z.t===-1||J.isDimty(X,Y===-1)){return O.VALID;}if(this.dynamicVerify){return this._super(X,E);}return Z.did?O.VALID:O.INVALID;case 1:case 2:case 3:case 4:case 5:case 6:case 7:if(Z.t<0){return O.VALID;}if(/^\d{1,}$/.test(mstrmojo.string.trim(X))||Z.did){return O.VALID;}if(this.dynamicVerify){return this._super(X,E);}return O.INVALID;default:return O.VALID;}},getItemsToFilterOut:function N(){return this.items;},updateSuggestion:function Q(E){var Y=this.getActiveItem();var X=this.getItemsToFilterOut();E=mstrmojo.array.filter(E,function(b){var a=b.did,Z=false,d;var c=function(e){mstrmojo.array.forEach(X,function(f){if(f!==Y&&f.did===e){Z=true;return false;}});};c(a);if(!Z){d=b;}return d;});if(this._super){this._super(E);}},nudge:function I(X){X.domNode.style.minWidth=this.suggestTarget.domNode.offsetWidth+(this.isDME&&!(mstrApp&&mstrApp.isWSStyling)?13:0)+"px";var Y=R.position(X.domNode),Z=R.position(this.suggestTarget.domNode),E=R.windowDim();if(Y.y+Y.h>E.h){X.domNode.style.top=(Z.y-Y.h-5)+"px";}}});mstrmojo.ME.ObjectItem=mstrmojo.declare(mstrmojo.ObjectItem,[mstrmojo._HasPopup],{markupString:'<div id={@id} class="mstrmojo-ObjectItem" style="{@cssText}"><div class="mstrmojo-ObjectItem-displayNode" tabindex="0" mstrAttach:click,focus><span class="mstrmojo-ObjectItem-text {@cssClass}"></span></div><div class="mstrmojo-ObjectItem-editNode"><input type="text" class="mstrmojo-ObjectItem-input" placeholder="{@placeholderText}" mstrAttach:keyup,keydown,focus/></div><div class="mstrmojo-ObjectItem-icons"><div class="mstrmojo-ObjectItem-down" onclick="mstrmojo.all[\'{@id}\'].showSuggestion(\'\')"></div><img class="mstrmojo-ObjectItem-browse" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1825,"Browse")+'" onclick="mstrmojo.all[\'{@id}\'].browse()"/><div class="mstrmojo-ObjectItem-opts" title="'+mstrmojo.desc(9598,"Level options")+'" onclick="mstrmojo.all[\'{@id}\'].options(arguments[0])" style="display:none;"></div><img class="mstrmojo-ObjectItem-edit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(1088,"Edit")+'" onclick="mstrmojo.all[\'{@id}\'].edit()"/><img class="mstrmojo-ObjectItem-del" src="../images/1ptrans.gif" title="'+mstrmojo.desc(629,"Delete")+'" onclick="mstrmojo.all[\'{@id}\'].del(arguments[0])" style="display:none;"/></div></div>',markupSlots:{displayNode:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.childNodes[1];},textNode:function(){return this.domNode.firstChild.firstChild;},pulldownButtonNode:function(){return this.domNode.lastChild.childNodes[0];},browseButtonNode:function(){return this.domNode.lastChild.childNodes[1];},optionButtonNode:function(){return this.domNode.lastChild.childNodes[2];},editButtonNode:function(){return this.domNode.lastChild.childNodes[3];},delButtonNode:function(){return this.domNode.lastChild.lastChild;},inputNode:function(){return this.domNode.childNodes[1].firstChild;}},init:function P(E){this._super(E);this.placeholderText=this.parent.emptyText;},initState:function U(){var X=this.parent,Y=this.data,E=Y.state;if(X.dynamicVerify){return this._super();}if(typeof E==="undefined"){E=X.verifyObject(Y[this.itemField],this);Y.state=E;}return E;},reduceWidth:function(){},updateButtonsVisibility:function F(){if(this._super){this._super();}if(this.parent.hidePulldownButton()){this.pulldownButtonNode.style.display="none";}if(this.parent.hideItemWidgetBrowseButton()){this.browseButtonNode.style.display="none";}this.optionButtonNode.style.display=this.data.state!==O.ADDING&&this.optionButtonVisible?"":"none";this.delButtonNode.style.display=this.data.state!==O.ADDING&&!this.parent.hideDelButton()&&!this.isFull?"":"none";},browse:function L(){this.set("state",this.data.state===O.ADDING?O.ADDING:O.EDITING);this.parent.showObjectBrowser(this);},click2edit:function K(){if(this.parent.click2edit){this.edit();}},onclick:function W(){this.click2edit();},onfocus:function V(E){if(E.getTarget()===this.inputNode){this._super();}else{this.click2edit();}}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Widget","num","css","Container","Box","Label","EditableLabel","Image");mstrmojo.requiresClsP("mstrmojo.threshold","ColorBand","ImageBand","MarkersNode","ColorMarker","ThresholdModel");var L=mstrmojo.dom,H=mstrmojo.num,B=mstrmojo.css,c=mstrmojo.array,N=mstrmojo.hash,s=["bands","markers"];var A=0,u=1;var a=mstrmojo.threshold.ThresholdModel,W=a.SLIDER_MODE,V=a.BASED_ON_TYPES,C=function(x,w){return x-w;},f=function(x,w){return w-x;},F=5;function P(w){var x;if(w===s[A]){x=this.sliderMode===W.IMAGE_BASED?new mstrmojo.threshold.ImageBand():new mstrmojo.threshold.ColorBand();}else{x=new mstrmojo.threshold.ColorMarker();}this[w].addChildren([x]);}function g(AC,AE,AF,AA){var x=AC.length-1,AD=AA?0:1,z=AA?x-1:x-2;for(var AB=AD;AB<=z;AB++){if(AB===AD&&AC[AB]<=0){AC[AB]=AE;}else{var w=AC[AB]-AC[AB-1];AC[AB]+=(w<AE)?(AE-w):0;AC[AB]=AC[AB]>=AF?(AF-AE):AC[AB];}}for(var AB=z;AB>AD;AB--){if(AB===z&&AC[z]>=AF){AC[AB]=AF-AE;}else{var w=Math.abs(AC[AB+1]-AC[AB]);AC[AB]-=(w<AE)?(AE-w):0;}}AC.sort(C);}function S(AA){var AB=this[s[AA]],AC=AB.children,x=AC?AC.length:0,AL=this.getComp().sort(C),AK=this.getPalette(),z=this.width,AN=AA?AL.length-1:AL.length,w=this.sliderMode===W.IMAGE_BASED,AO=this.parent.model.globalMinMax(this.minValue(),this.maxValue()),AJ,AD,AG;var AI=c.map(AL,function(AP){return parseInt(z*AP,10);});g(AI,F,z,this.selectedOption===V.VALUE);if(x>AN){for(AJ=x-AN-1;AJ>=0;AJ--){AB.removeChildren(AC[AJ]);}}else{if(AN>x){for(AJ=0;AJ<AN-x;AJ++){P.call(this,s[AA]);}}}if(AA===0&&this.getReversedValue()){AK=AK.concat().reverse();}AC=AB.children;var AF,AE;for(AJ=0;AJ<AN;AJ++){AD=AC[AJ];AF=(AJ===0)?0:AI[AJ-1];AE=AI[AJ];if(AA===0){AD.set("left",(this.containerNode.offsetLeft+AF+1)+"px");AG=AE-AF;B.toggleClass(AD.domNode,"no-border",!AG);AD.set("width",AG+"px");if(w){AD.set("src",AK[AJ]);AD.domNode.firstChild.style.left=AD.domNode.clientWidth/2-12+"px";}else{AD.set("backgroundColor",AK[AJ]);}}else{AD.set("left",AE-(w?0:1)+"px");AD.updateCompValue(AL[AJ]);var AM=this.parent.model,AH=AM.getRealValue(AL[AJ],this.selectedOption,this.minValue(),this.maxValue());AD.updateRealValue(AH);AD.updatePosition(AI[AJ]);}AD.set("index",AJ);}}function p(x,w,z){w.forEach(function(AB){var AA=x[AB.id]={palette:[],comp:[],reversed:false};AB.bands.forEach(function(AC){AA.palette.push(AC[z?"url":"bc"]);AA.comp.push(AC.end/100);});});}function D(){var w=this.parent.model,x={};p(x,w.getDefaultColors(),false);p(x,w.getDefaultImages(),true);return x;}function v(z){var w=H.parseNumeric(z);if(isNaN(w)&&window.numeral){var x=window.numeral(z.toLowerCase()).value();w=typeof x==="number"?x:w;}return w;}mstrmojo.threshold.TextBubble=mstrmojo.declare(mstrmojo.EditableLabel,null,{scriptClass:"mstrmojo.EditableLabel",visible:false,cssClass:"editable-bubble",text:"",isPercentage:true,maxValue:1,showBubble:function(w,z,x){this.updatePosition(w,x);this.updateText(z);this.set("visible",true);},hideBubble:function(){this.set("visible",false);},updatePosition:function U(x,w){var z=(w!==undefined)?w:this.parent.width*x;this.domNode.style.left=z+"px";},updateText:function(AA){var z=this.parent,w=z.parent.model,x=AA;if(z.selectedOption===V.VALUE){this.realValue=x;x=H.formatByMask(w.getFormatString(),x);}if(this.isPercentage){x+="%";}this.set("text",String(x));}});mstrmojo.threshold.ColorSlider=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.threshold.ColorSlider",markupString:'<div class = "mstrmojo-color-slider {@cssClass}"  style="{@cssText}" mstrAttach:click,keyup><div class="labels"></div><input type="text" class="hidden-field"></div>',markupSlots:{containerNode:function X(){return this.domNode;},labelsNode:function Q(){return this.domNode.firstChild;},hiddenField:function e(){return this.domNode.lastChild;}},sliderMode:W.COLOR_BASED,baseColor:undefined,editableBubble:undefined,hoverBubble:undefined,bands:undefined,markers:undefined,colorMap:undefined,selectedOption:undefined,userComp:[],getComp:function Y(){return this.userComp;},getPalette:function M(){return this.colorMap[this.baseColor].palette;},getReversedValue:function n(){var w=this.colorMap;return w&&w[this.baseColor].reversed||false;},postBuildRendering:function R(){this.width=L.position(this.containerNode).w;this.resetColorMap();if(this._super){this._super();}this.update();},resetColorMap:function t(){var w=undefined;if(this.colorMap){w=this.colorMap.custom;}this.colorMap=D.call(this);if(w){this.colorMap.custom=w;}if(this.baseColor in this.colorMap){this.userComp=N.clone(this.colorMap[this.baseColor].comp);}},onkeyup:function(AA){var x=window.event||AA.e,AB=x.keyCode;if(this.sliderMode===W.COLOR_BASED&&(AB===mstrmojo.Enum_Keys.DELETE||AB===mstrmojo.Enum_Keys.BACKSPACE)){if(this.editableBubble.isEditing){return ;}var z,w;if(this.bands.isSelected){z=this.bands;}else{if(this.markers.isSelected){z=this.markers;}else{return ;}}w=z.selectedIndex;z.children[w].unselect();z.remove(w);this.update();}},update:function d(){if(this.baseColor){S.call(this,A);S.call(this,u);}this.updateMinMax();},onsliderModeChange:function h(){B.toggleClass(this.domNode,"image-mode",this.sliderMode===W.IMAGE_BASED);this.resetMinMax();this.unselectAll();this.bands.removeChildren();},onbaseColorChange:function o(w){if(w.value&&w.value in this.colorMap){this.userComp=N.clone(this.colorMap[w.value].comp);}this.resetMinMax();this.unselectAll();this.update();},onselectedOptionChange:function K(x){var z=this.parent.model,AA=this.editableBubble,AB=x.valueWas===V.VALUE?AA.realValue:AA.text;if(x.valueWas!==undefined){this.resetMinMax();this.markers.setMarkerRealValues(z.getRealValue.bind(z),x.value,this.minValue(),this.maxValue());this.update();}if(AA.visible){if(x.valueWas===V.LOWEST_PERCENT||x.valueWas===V.HIGHEST_PERCENT){AB=AB.slice(0,AB.length-1);}var w=this.markers.selectedIndex;AA.updateText(this.markers.children[w].realValue);}},updateLabels:function G(x){var AB=this.parent.model,AC=this.editableBubble,AA=this.hoverBubble,AD=this.markers.selectedIndex,AE,z;x=x||this.selectedOption;if(x===V.LOWEST_PERCENT||x===V.HIGHEST_PERCENT){AE="0%";z="100%";AC.set("isPercentage",true);AA.set("isPercentage",true);}else{if(x===V.LOWEST||x===V.HIGHEST){AE="0";z=AB.getMetricsCount();AC.set("isPercentage",false);AA.set("isPercentage",false);}else{var w=AB.getFormatString();AE=(this.minValue()<AB.getMetricsMinValue())?"-&#8734":H.formatByMask(w,AB.getMetricsMinValue());z=(this.maxValue()>AB.getMetricsMaxValue())?"&#8734":H.formatByMask(w,AB.getMetricsMaxValue());AC.set("isPercentage",false);AA.set("isPercentage",false);}}this.startLabel.set("text",AE);this.endLabel.set("text",z);if(!!this.markers.children&&AD>-1&&AD<this.markers.children.length){AC.updateText(this.markers.children[AD].realValue);}},setColorComp:function j(x,w){this.userComp=N.clone(w);var z=this.colorMap;if(z){z[x].comp=w;this.unselectAll();this.update();}},addCustomScheme:function(x,w){this.colorMap.custom={comp:x,palette:w,reversed:false};this.set("baseColor","custom");},addMarkerToMap:function O(z){var AA=this.getComp(),w=AA.length,AB;if(AA[0]>z){AB=0;}else{for(AB=1;AB<w;AB++){if(AA[AB-1]<=z&&AA[AB]>=z){break;}}}AA.splice(AB,0,z);this.unselectAll();this.resetMinMax();return AB;},unselectAll:function r(){var x=this.bands,z=x.children&&x.selectedIndex>-1&&x.children[x.selectedIndex];if(x.isSelected&&z&&typeof (z.unselect)==="function"){z.unselect();}var AA=this.markers,w=AA.selectedIndex;if(AA.isSelected&&AA.children[w]){AA.children[w].unselect();}},reverseMapColor:function Z(){if(this.colorMap&&this.baseColor){var w=this.colorMap[this.baseColor];w.reversed=!w.reversed;this.unselectAll();this.update();}},_minRealValue:undefined,_maxRealValue:undefined,resetMinMax:function J(){this.set("_minRealValue",undefined);this.set("_maxRealValue",undefined);},updateMinMax:function k(){var AC=this.markers.getMarkerRealValues(C),AB=this.parent.model,AA=this.parent.model.globalMinMax(),z=AA.min,w=AA.max,x=-1;if(c.isArray(AC)){while(++x<AC.length){if(AC[x]!==undefined){z=AC[x];break;}}x=AC.length;while(--x>=0){if(AC[x]!==undefined){w=AC[x];break;}}}this.set("_minRealValue",z);this.set("_maxRealValue",w);this.updateLabels(this.selectedOption);},minValue:function E(){return this._minRealValue;},maxValue:function I(){return this._maxRealValue;},children:[{scriptClass:"mstrmojo.Label",cssClass:"start-label",alias:"startLabel",slot:"labelsNode",text:"0%",allowHTML:true},{scriptClass:"mstrmojo.Label",cssClass:"end-label",alias:"endLabel",slot:"labelsNode",text:"100%",allowHTML:true},{scriptClass:"mstrmojo.threshold.TextBubble",alias:"editableBubble",slot:"labelsNode",allowEmptyText:true,onTextEditComplete:function(AE,AF){if(AE){var AJ=this.parent,AC=AJ.parent.model,AB=AJ.markers.selectedIndex,AP=AJ.markers.children[AB];var AG=this.text;if(this.isPercentage){AG=AG.replace(/%$/,"");}var AL=AG.charAt(0),AQ=1;if(AL==="-"||AL==="+"){AG=AG.substring(1);AQ=(AL==="-")?-1:1;AL=AG.charAt(0);}if(AL.match(/\W/)!==null){AG=AG.replace(new RegExp("^\\"+AL),"");}var AH=AC.getFormatString(),AM=(AH||"").indexOf("%")>-1,AA=1,AD=AJ.selectedOption===V.VALUE;if(AD&&AM&&AG.indexOf("%")===-1){AA=0.01;}AG=v(AG)*AA;if(isNaN(AG)){this.set("text",AF);return ;}AG=AG*AQ;if(AG<0&&!AD){AG=0;}AP.updateRealValue(AG);AJ.updateMinMax();var AK=AJ.markers.getMarkerRealValues(C);AB=AK.indexOf(AG);var AN=AK.map(function(AR){return AC.getNormalizedValue(AR,AJ.selectedOption,AJ.minValue(),AJ.maxValue());}),AO=AJ.getComp(),z=AN[AB],x=AJ.width,w=(AJ.sliderMode===W.IMAGE_BASED),AI=parseInt(x*z,10);AN.forEach(function(AS,AR){AO[AR]=AS;AJ.markers.children[AR].updateCompValue(AS);});this.updatePosition(z);AP.updateCompValue(z);AP.set("left",AI-(w?0:1)+"px");AP.unselect();AJ.update();AJ.markers.children[AB].select();}}},{scriptClass:"mstrmojo.threshold.TextBubble",alias:"hoverBubble",slot:"labelsNode",allowEmptyText:false},{scriptClass:"mstrmojo.Box",cssClass:"color-bands",alias:"bands",isSelected:false,selectedIndex:0,remove:function b(z){if(this.children.length===1){return ;}var AA=this.parent;var x=AA.getComp(),w=AA.getPalette();if(z===this.children.length-1){x.splice(z-1,1);}else{x.splice(z,1);}w.splice(z,1);},onBandHovered:function(){this.isSelected=true;},onBandUnhovered:function(){this.isSelected=false;},onBandSelected:function(w){var x,AA=this.children,z=this.parent,AB=z.markers;for(x=0;x<AA.length;x++){if(x!==w&&AA[x].selected){AA[x].unselect();}}if(AB.isSelected===true){AB.children[AB.selectedIndex].unselect();}z.hiddenField.focus();this.isSelected=true;this.selectedIndex=w;},onBandUnselected:function(w){var x,z=this.children;for(x=0;x<z.length;x++){if(x!==w&&z[x].selected){return ;}}this.isSelected=false;}},{scriptClass:"mstrmojo.threshold.MarkersNode",alias:"markers",isSelected:false,selectedIndex:0,onMarkerSelected:function q(x){var w=this.parent,AC=this.children[x];w.editableBubble.showBubble(AC.compValue,AC.realValue,AC.position);var z,AB=this.children;for(z=0;z<AB.length;z++){if(z!==x&&AB[z].selected){AB[z].unselect();}}var AA=w.bands;if(AA.isSelected===true){AA.children[AA.selectedIndex].unselect();}this.parent.hiddenField.focus();this.isSelected=true;this.selectedIndex=x;},onMarkerUnselected:function(w){var x,z=this.children;for(x=0;x<z.length;x++){if(x!==w&&z[x].selected){return ;}}this.parent.editableBubble.hideBubble();this.isSelected=false;},onMarkerHovered:function m(x){var w=this.parent,z=this.children[x];w.hoverBubble.showBubble(z.compValue,z.realValue,z.position);this.isSelected=true;},onMarkerUnhovered:function l(){this.parent.hoverBubble.hideBubble();this.isSelected=false;}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.ControlGroup","mstrmojo.ui.editors.controls._HasCharacterGroup","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.css");mstrmojo.ui.editors.controls.CharacterGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,[mstrmojo.ui.editors.controls._HasCharacterGroup],{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",init:function A(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditCharacter");var H=this,C=this.getHCGControls(function(K,L,J){if(!H._sync){H.raiseFormatValueChange(K,L,J);}}),D=[];Object.keys(C).forEach(function(J){this[J]=C[J];}.bind(this));var B=this.fontFamily,I=this.fontStyle,G=this.fontSize,F=this.fontColor;if(B){D.push(B);}if(I){D.push(I);}if(G){G.slot="col1Node";F.slot="col2Node";D.push({scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",children:[G,F]});}if(D.length){this.addChildren(D);}}});mstrmojo.ui.editors.controls.CharacterGroup.CTRL_FLAGS=mstrmojo.ui.editors.controls._HasCharacterGroup.CTRL_FLAGS;}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.ToolbarPopup","mstrmojo.ui.editors._HostsControls","mstrmojo.ui.editors.controls._HasCharacterGroup","mstrmojo.vi.ui.TextAlignButtonBar","mstrmojo.models.FormatModel","mstrmojo.css");var B=mstrmojo.models.FormatModel;mstrmojo.ui.editors.CharacterToolbarPopup=mstrmojo.declare(mstrmojo.ui.editors.ToolbarPopup,[mstrmojo.ui.editors._HostsControls,mstrmojo.ui.editors.controls._HasCharacterGroup],{scriptClass:"mstrmojo.ui.editors.CharacterToolbarPopup",textAlignJustify:true,textAlignValueMap:null,textAlignFmtName:mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES.TEXT_ALIGN,btnTextAlign:null,init:function D(I){this._super(I);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditCharacter");var K=this.textAlignJustify,H=this,F=function(P,Q,O){H.raiseFormatValueChange(P,Q,O);},L=this.getHCGControls(F),J=L.fontFamily,N=L.fontSize,G=L.fontColor,M={alias:"btnTextAlign",includeJustify:K,onValueChange:function(P,O){F(H.textAlignFmtName,P,O);}};J.width="125px";N.width="50px";G.width="50px";this.width=K?"505px":"476px";var E=this.textAlignValueMap;if(E){M.itemsValueMap=E;}this.addChildren([J,L.fontStyle,N,G,new mstrmojo.vi.ui.TextAlignButtonBar(M)]);},shouldPropagateLockHover:function C(){return false;},setFormatSource:function A(E){this._super(E);this.syncControls(function(){if(this.textAlignFmtName in E){this.btnTextAlign.singleSelectByField(E[this.textAlignFmtName],"v");}else{this.btnTextAlign.singleSelectByField(B.getFormatBlockValue(E,B.ENUM_PROPERTY_NAMES.TEXT_ALIGN),"id");}});}});}());(function(){mstrmojo.requiresClsP("mstrmojo","array","css","hash","color","Editor","Button","Box","Label","num");mstrmojo.requiresClsP("mstrmojo.ui","Pulldown","Checkbox","CheckList");mstrmojo.requiresClsP("mstrmojo.threshold","ColorSlider","ThresholdModel");mstrmojo.requiresClsP("mstrmojo.models","FormatModel");mstrmojo.requiresDescs(16098,16096,16094,16097,16095,16099,16100,16101,16102,16103,16104,2290,16105,16106,16107,16108,5585,7665,7666,7905,7907,7908,7909,7910,12110,12111,16110,16109,16106);var O=mstrmojo.array,d=mstrmojo.css,V=mstrmojo.hash,W=mstrmojo.Button.newWebButton,a=mstrmojo.num,F=mstrmojo.models.FormatModel.getFormatUpdate,R=mstrmojo.vi.viz.EnumVizStyles,D=mstrmojo.vi.viz.EnumVisualizationTemplates,A=4,Q=20,P=[{n:mstrmojo.desc(16111,"Sequential"),idx:0},{n:mstrmojo.desc(16134,"Diverging"),idx:14},{n:mstrmojo.desc(16135,"Accessible"),idx:20}],G={BUSINESS_BLUE:1,MARINE_BLUE:2,BUSINESS_TEAL:3,AQUAMARINE:4,EMERALD:5,YELLOW_TO_GREEN:6,TANGERINE:7,HONEY:8,SUNFLOWER:9,BUSINESS_RED:10,RASPBERRY:11,LAVENDER:12,GRAY:13,TROPICAL_JUNGLE:15,ORANGE_AND_TEAL:16,WILD_BERRY:17,TRAFFIC_LIGHTS:18,TEMPERATURE:19,ACCESSIBLE_GOLD_AND_PURPLE:21,ACCESSIBLE_GRAY:22,ACCESSIBLE_ORANGE_AND_TEAL:23};var b=mstrmojo.threshold.ThresholdModel.SLIDER_MODE,H=mstrmojo.threshold.ThresholdModel.FEATURES;var M=null,B=null,c=[{n:mstrmojo.desc(527,"Value"),v:7},{n:mstrmojo.desc(4405,"Lowest"),v:4},{n:mstrmojo.desc(529,"Highest"),v:5},{n:mstrmojo.desc(4406,"Lowest %"),v:1},{n:mstrmojo.desc(4407,"Highest %"),v:2}];function Y(s){var u=[],q=this.colorSlider,p=q.getComp(),k=q.getPalette(),r=this.basedOn.value,m=this.model,n=this.controller,v=m.orgThresholds,g=this.metricId,j=v&&v[g],f=this.breakBy.breakByList,o=f.items[f.selectedIndex],h=p.length,l,w;if(q.getReversedValue()){k=k.concat().reverse();}for(l=0;l<h;l++){w={};if(this.colorSlider.sliderMode===b.IMAGE_BASED){w.rtp=4;w.rtxt=k[l];}else{w.fmt=F("bc",k[l]);}if(l>0){w.flr=a.toLocaleString(m.getRealValue(p[l-1],r,q.minValue(),q.maxValue()));}if(l<h-1||h===1){w.ceil=a.toLocaleString(m.getRealValue(p[l],r,q.minValue(),q.maxValue()));}if(o&&o.did!==-1){w.dmy={did:o.did,t:o.t};}u.push(w);}n.onSubmitActions(u,j,g,n.supportsFeature(H.SHOW_BASED_ON)?this.basedOn.selectedMetric:g,this.basedOn.value,s,A);}function L(q){var m=this.model,AI=m.data,h=m.thresholds&&m.thresholds[q],AD=AI.gsi,t=this.colorSlider,o=[],AH=[],n=[],s,AG,f,v=this.colorPalettes,r=this.imageSelector,AB=v.colorPulldown,AF=this.typeSelector.typeCheckList,g=r.imagePulldown,p=this.basedOn,l=p.options,z=p.metricsList,x=this.breakBy.breakByList,w=this.controller.supportsFeature(H.SHOW_BASED_ON);if(h&&h.length>0){s=m.getSimpleThresholdType(q);if(s!==-2){f=m.isImageBasedType(q);l.set("selectedIndex",O.find(l.items,"v",s));h.forEach(function(AJ){var AL=V.copy(AJ),AK=AL.ceil;if(AK!==Infinity){AL.comp=m.getNormalizedValue(AK,AJ.ttp,t.minValue(),t.maxValue());}else{AL.comp=1;}o.push(AL);});o.sort(function(AK,AJ){return AK.comp-AJ.comp;});o.forEach(function(AJ){AH.push(AJ.comp);if(f){n.push(AJ.rtxt);}else{n.push(AJ.fmt.bc);}});AF.set("selectedIndex",f?b.IMAGE_BASED:b.COLOR_BASED);if(f){AG=m.getImageSetName(n);g.set("selectedIndex",O.find(B,"v",AG));}else{AG=m.getColorScheme(n);if(AG==="custom"){this.switchToCustomScheme(AH,n);t.unselectAll();t.update();}else{AB.set("items",M);AB.set("selectedIndex",O.find(M,"v",AG));}}t.set("baseColor",AG);t.setColorComp(AG,AH);if(m.isMapReversed(AG,n,f)){t.reverseMapColor();}if(w){var k=h[0].expr,u=k.m||k.nds[0].m;z.set("selectedIndex",O.find(AD.mx,"did",(u&&u.did)||m.metricId));}var AE;try{AE=h[0].expr.nds[0].dmy.uts[0].utgt.did;}catch(AC){}x.set("selectedIndex",Math.max(0,O.find(x.items,"did",AE)));}}else{var AA=AI.visName,j;AF.set("selectedIndex",b.COLOR_BASED);AB.set("items",M);if(AA===undefined){AB.set("selectedIndex",G.TRAFFIC_LIGHTS);}else{if(AA===R.HEAT_MAP){AB.set("selectedIndex",G.TRAFFIC_LIGHTS);}else{if(AA===R.NETWORK){AB.set("selectedIndex",G.BUSINESS_BLUE);}else{if(AA===R.ESRI_MAP||AA===R.GOOGLE_MAP||AA===R.MAPBOX){AB.set("selectedIndex",G.MARINE_BLUE);}else{j=parseInt(V.walk("dz.visProp.fmt.visType",AI));switch(j){case D.GRAPHMATRIXVERTICALLINECLUSTERED:case D.GRAPHMATRIXVERTICALLINESTACKED:case D.GRAPHMATRIXVERTICALLINEPERCENT:case D.GRAPHMATRIXVERTICALLINEAUTOMATIC:case D.GRAPHMATRIXHORIZONTALLINECLUSTERED:case D.GRAPHMATRIXHORIZONTALLINESTACKED:case D.GRAPHMATRIXHORIZONTALLINEPERCENT:case D.GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case D.GRAPHMATRIXVERTICALAREACLUSTERED:case D.GRAPHMATRIXVERTICALAREASTACKED:case D.GRAPHMATRIXVERTICALAREAPERCENT:case D.GRAPHMATRIXVERTICALAREAAUTOMATIC:case D.GRAPHMATRIXHORIZONTALAREACLUSTERED:case D.GRAPHMATRIXHORIZONTALAREASTACKED:case D.GRAPHMATRIXHORIZONTALAREAPERCENT:case D.GRAPHMATRIXHORIZONTALAREAAUTOMATIC:AB.set("selectedIndex",G.TRAFFIC_LIGHTS);break;case D.GRAPHMATRIXBUBBLECIRCLEMM:case D.GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case D.GRAPHMATRIXBUBBLEGRIDSQUAREAA:case D.GRAPHMATRIXBUBBLESQUAREAM:case D.GRAPHMATRIXBUBBLESQUAREMM:AB.set("selectedIndex",G.MARINE_BLUE);break;default:AB.set("selectedIndex",G.BUSINESS_BLUE);break;}}}}}t.update();if(w){z.set("selectedIndex",O.find(AD.mx,"did",q||m.metricId));}x.set("selectedIndex",0);}}function S(f){this.parent.colorSlider.set("baseColor",f);this.selectedColor=f;}function U(){return W("",function(){this.parent.parent.colorSlider.reverseMapColor(this.checked);},false,{cssClass:"reverse-btn"});}function N(){var f=this.model,h=this.basedOn.options,k=h.items,l=isNaN(f.getMetricsMaxValue())||isNaN(f.getMetricsMinValue()),g=(l||!this.controller.supportsFeature(H.SHOW_VALUE_ITEM))?c.slice(1):c,j=k[h.selectedIndex];if(g.length!==k.length){h.set("items",g);h.set("selectedIndex",Math.max(g.indexOf(j),0));}}mstrmojo.threshold.SimpleThresholdEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.threshold.SimpleThresholdEditor",cssClass:"mstrmojo-SimpleThresholdEditor",title:mstrmojo.desc(3647,"Thresholds"),help:"thresholds_editor.htm",model:undefined,controller:undefined,metricId:undefined,metricName:undefined,typeSelector:undefined,basedOn:undefined,breakBy:undefined,colorSlider:undefined,colorPalettes:undefined,imageSelector:undefined,showAdvancedEditorLink:undefined,init:function X(h){this._super(h);var g=mstrApp.customization.getCustomThresholds(),f=function(j){return{n:mstrmojo.desc(j.title,"N/A"),v:j.id,cls:j.id};};if(!M){M=g.color.map(function(j){return f(j);});}O.forEach(P,function(j){M.splice(j.idx,0,{n:j.n,cls:"title",v:null});});this.colorPalettes.colorPulldown.set("items",M);if(!B){B=g.image.map(function(k){var j=f(k);j.bc=k.combinedImageUrl;return j;});this.imageSelector.imagePulldown.set("items",B);}},onOpen:function E(){var f=this.controller,g=this.model,l=this.basedOn,j=l.options,m=l.metricsList,h=this.metricId,k=g.data.gsi;this.colorSlider.resetColorMap();if(this.colorSlider.editableBubble){this.colorSlider.editableBubble.hideBubble();}d.toggleClass(this.containerNode,"hideImage",!f.supportsFeature(H.SHOW_IMAGE));if(f.supportsFeature(H.SHOW_BASED_ON)){d.addClass(j.domNode,"right-pulldown");m.set("items",k.mx);m.set("visible",true);}else{m.set("visible",false);d.removeClass(j.domNode,"right-pulldown");}this.breakBy.breakByList.set("items",[{n:mstrmojo.desc(2057,"None"),did:-1}].concat(this.targets.filter(function(n){return n.t===12;})));this.showAdvancedEditorLink.set("visible",f.supportsFeature(H.SHOW_ADVANCED_EDITOR));L.call(this,h);this.colorSlider.updateLabels();this.domNode.oncontextmenu=function(){if(mstrApp.isSingleTier){return false;}};},onClose:function C(){this.model.cleanUp();},switchToCustomScheme:function J(o,h){var j="custom",m=this.colorSlider,l=this.colorPalettes.colorPulldown,k=l.items,f=k.map(function(p){return p.v;}).indexOf(j)!==-1;o=o||m.getComp().concat();if(!h){var g=m.getPalette().concat();h=m.getReversedValue()?g.reverse():g;}m.addCustomScheme(o,h);if(!f){var n=V.clone(k);n.unshift({n:mstrmojo.desc(2056,"Custom"),v:j});l.set("items",n);}l.set("selectedIndex",O.find(l.items,"v",j));},children:[{scriptClass:"mstrmojo.Box",cssClass:"row",alias:"typeSelector",typeCheckList:undefined,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12112,"Thresholds Type:")},{scriptClass:"mstrmojo.ui.CheckList",alias:"typeCheckList",multiSelect:false,orientation:"h",postselectionChange:function K(s){var n=this.parent.parent,l=n.model,o=n.colorSlider,h=n.colorPalettes,k=h.colorPulldown,q=n.imageSelector,j=q.imagePulldown,g=k.items[k.selectedIndex],f=B[j.selectedIndex],r=s.added[0],m=r?f:g,p=r?l.getDefaultImages()[0].id:l.getDefaultColors()[0].id;h.set("visible",!r);q.set("visible",!!r);o.set("sliderMode",r);o.set("baseColor",(m&&m.v)||p);o.editableBubble.set("visible",false);if(r===b.IMAGE_BASED&&!j.selectedIndex){j.set("selectedIndex",0);}},selectedIndex:0,items:[{n:mstrmojo.desc(12113,"Color-based"),v:"color",cls:"color"},{n:mstrmojo.desc(12114,"Image-based"),v:"image",cls:"image"}]}]},{scriptClass:"mstrmojo.Box",cssClass:"row",alias:"colorPalettes",selectedColor:undefined,colorPulldown:undefined,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2060,"Color:")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"color-pulldown",alias:"colorPulldown",onitemSelected:function I(g){S.call(this.parent,g.v);for(var f=0;f<=Q;f++){d.removeClass(this.selectedNode,["C"+f]);}if(g.cls){d.addClass(this.selectedNode,g.cls);}},getPopupListConfig:function Z(){return{scriptClass:"mstrmojo.ui.PopupList",alias:"list",selectionPolicy:"reselect",locksHover:true,useRichTooltip:true,showTooltipForLargeText:true,scrollNodeMaxHeight:this.scrollNodeMaxHeight,getItemMarkup:function h(k,j){if(k.cls==="title"){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}">{@en@n}</{@tag}>';}return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}"><div class="text">{@en@n}</div></{@tag}>';},listHooks:{select:function f(k,l,j){this.parent.set("selectedIndex",j);if(this.visible&&this.closeAfterSelection){this.close();}}},getItemProps:function g(l,j){var k=mstrmojo._IsList.getItemProps.call(this,l,j);k.style=this.parent.itemCssText||"";return k;}};},selectedIndex:1,items:M},U()]},{scriptClass:"mstrmojo.Box",cssClass:"row",alias:"imageSelector",visible:false,selectedColor:undefined,imagePulldown:undefined,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(6369,"Images:")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"image-pulldown",alias:"imagePulldown",onitemSelected:function I(f){S.call(this.parent,f.v);},getPopupListConfig:function Z(){var f=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);f.getItemMarkup=function h(){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@title}"><div class="bc" style="{@bc}"></div><div class="text">{@n}</div></{@tag}>';};f.getItemProps=function g(l,j){var k=mstrmojo._IsList.getItemProps.call(this,l,j);k.bc="background:url("+l.bc+");background-size: contain;background-repeat: no-repeat;";return k;};return f;},items:B},U()]},{scriptClass:"mstrmojo.Box",cssClass:"row",alias:"basedOn",value:"",metricsList:undefined,options:undefined,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(4402,"Based on:")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"left-pulldown",alias:"metricsList",onitemSelected:function I(j){var h=this.parent,f=h.parent,g=j.did;h.selectedMetric=f.model.basedOnId=g;f.colorSlider.resetMinMax();f.colorSlider.update();f.colorSlider.updateLabels();N.call(f);}},{scriptClass:"mstrmojo.ui.Pulldown",selectedIndex:3,cssClass:"right-pulldown option",alias:"options",onitemSelected:function I(h){var l=this.parent,g=l.parent,k=g.breakBy,j=h.v,f=j===7;l.value=j;g.colorSlider.set("selectedOption",h.v);k.set("visible",!f);if(f){k.breakByList.set("selectedIndex",0);}},items:c}]},{scriptClass:"mstrmojo.Box",cssClass:"row",alias:"breakBy",breakByList:undefined,children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(4564,"Break By:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"breakByList"}]},{scriptClass:"mstrmojo.threshold.ColorSlider",alias:"colorSlider"},{scriptClass:"mstrmojo.Label",cssClass:"link",alias:"showAdvancedEditorLink",slot:"buttonNode",text:mstrmojo.desc(4569,"Advanced Thresholds Editor..."),onclick:function e(){var h=this.parent,g=h.breakBy.breakByList,f=g.items[g.selectedIndex].did!==-1,j=function(){h.colorSlider.unselectAll();h.close();h.model.editorMode=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES.ADVANCED_EDITOR;};mstrmojo.warn(f?mstrmojo.desc(14160,"Save thresholds definition before proceeding to the Advanced Thresholds Editor? The Break By attribute will be lost."):mstrmojo.desc(14159,"Save thresholds definition before proceeding to the Advanced Thresholds Editor?"),undefined,{cssClass:"save-threshold-warning",buttons:[W(mstrmojo.desc(2827,"Clear"),function(){j();h.controller.openEditor();},false,{cssClass:"nosave"}),W(mstrmojo.desc(2223,"Cancel")),W(mstrmojo.desc(2031,"Apply"),function(){j();g.set("selectedIndex",0);Y.call(h,true);},true)]});}},{scriptClass:"mstrmojo.Box",cssClass:"editor-buttons",slot:"buttonNode",children:[W(mstrmojo.desc(221,"Cancel"),function e(){var f=this.parent.parent;f.colorSlider.unselectAll();f.close();}),W(mstrmojo.desc(1442,"OK"),function e(){var f=this.parent.parent;Y.call(f);f.colorSlider.unselectAll();f.close();},true),W(mstrmojo.desc(2031,"Apply"),function e(){var f=this.parent.parent;Y.call(f,true);f.colorSlider.unselectAll();},true)]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.Pulldown","mstrmojo.ME.ObjectInputBox","mstrmojo.ME.MetricDataService","mstrmojo.ME.Enum");mstrmojo.requiresDescs(1107,12178);var J=mstrmojo.expr,D=mstrmojo.ME.Enum.DYNAMIC_DIMTY;mstrmojo.ME.LevelInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-level",oncandidatesChange:function F(E){this.candidates.items=D.getItems("level").concat(this.candidates.items);},hidePulldownButton:function(){return !this.isDME;},hideItemWidgetBrowseButton:function(){return this.isDME;},folderLinksContextId:16,browsableTypes:[J.TP.FOLDER,J.TP.ATTR,J.TP.DIM].join(","),getCandidatesThroughTaskCall:function K(L,E){L.rootFolderType=39;L.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(L,E);},itemFunction:function B(M,E,L){M.filtering=M.filtering||1;M.grouping=M.grouping||1;var N=this._super(M,E,L,mstrmojo.ME.LevelObjectItem);N.optionButtonVisible=true;return N;},updateSuggestion:function C(E){E=[{n:this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level"),did:-1,t:-1,state:0}].concat(E);if(this._super){this._super(E);}},add:function H(L,E){var N=true,M=this.items;mstrmojo.array.forEach(L,function(O){mstrmojo.array.forEach(M,function(P){if(P.did&&P.did===O.did){N=false;return false;}});});if(N){this._super(L,E);}}});mstrmojo.ME.LevelObjectItem=mstrmojo.declare(mstrmojo.ME.ObjectItem,[mstrmojo._HasPopup],{optsRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9598,"Level Options"),cssText:"width: 450px;",onOpen:function A(){var E=this.opener.data;this.filterOption.set("value",E.filtering);this.groupOption.set("value",E.grouping);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9599,"Relationship with Report Filter:")},{scriptClass:"mstrmojo.Pulldown",alias:"filterOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9600,"Standard - Metric calculates only for elements found in the filter"),did:1},{n:mstrmojo.desc(9601,"Absolute - Raises the calculation to the selected level, if possible"),did:2},{n:mstrmojo.desc(9602,"Ignore - Omit filtering criteria based on selected level and its related attributes"),did:3},{n:mstrmojo.desc(9603,"None - Unspecified - the selected level and group components define the filter"),did:4}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9604,"Metric Aggregations:")},{scriptClass:"mstrmojo.Pulldown",alias:"groupOption",itemField:"n",itemIdField:"did",items:[{n:mstrmojo.desc(9605,"Standard - Metric calculates at the selected level, if possible"),did:1},{n:mstrmojo.desc(9606,"None - Exclude the selected level and children from the GROUP BY clause in the SQL"),did:2},{n:mstrmojo.desc(9607,"Beginning lookup - Use the first value of the lookup table"),did:3},{n:mstrmojo.desc(9608,"Ending lookup - Use the last value of the lookup table"),did:4},{n:mstrmojo.desc(9609,"Beginning fact - Use the first value of the fact table"),did:5},{n:mstrmojo.desc(9610,"Ending fact - Use the last value of the fact table"),did:6}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent,L=E.opener;if(L.saveOnClose){L.saveOnClose(E.filterOption.value,E.groupOption.value);}E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},saveOnClose:function G(E,M){var L=this.data;L.filtering=E;L.grouping=M;if(this.parent.onSaveOnClose){this.parent.onSaveOnClose();}},options:function I(){this.openPopup("optsRef",{title:'"'+this.data[this.itemField]+'" '+mstrmojo.desc(9598,"Level Options"),zIndex:40});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.TransformInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-transform",items:[],noEditButton:true,folderLinksContextId:26,browsableTypes:[B.TP.FOLDER,B.TP.ROLE].join(","),getCandidatesThroughTaskCall:function A(E,D){mstrmojo.ME.MetricDataService.getTransformations(E,D);},hideItemWidgetBrowseButton:function C(){return this.isDME;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.ObjectInputBox");var B=mstrmojo.expr;mstrmojo.ME.ConditionInputBox=mstrmojo.declare(mstrmojo.ME.ObjectInputBox,null,{cssClass:"mstrmojo-ME-ObjectInputBox-condition",folderLinksContextId:10,browsableTypes:[B.TP.FOLDER,B.TP.FILTER,B.STP.PROMPT_OBJECTS].join(","),noEditButton:true,maxObjectCount:1,getCandidatesThroughTaskCall:function A(D,C){D.rootFolderType=39;D.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getFilters(D,C);},hideItemWidgetBrowseButton:function(){return this.isDME;}});})();(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.vi.viz.KnownVisualizations","mstrmojo.hash","mstrmojo.mstr.EnumDataType","mstrmojo.fe.FilterUtils","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.DocDataService","mstrmojo.UUID");var K=mstrmojo.func.wrapMethods,H=mstrmojo.array,A=mstrmojo.hash,G=mstrmojo.mstr.EnumDataType,D=mstrmojo.fe.FilterUtils.getExprXml,E=mstrmojo.vi.ui.DatasetUnitMenuUtils;function B(U,V,X){var M=X.s||"",Y=U[0],S=Y.did,P=Y.zoneId,Z=Y.t===4,R=Z?"":Y.fid,W=Y.isAsc!==undefined?Y.isAsc:false;var N,O;if(M===""||M==="VIHeatMapVisualizationStyle"){return{act:"updateTemplate",keyContext:V,actions:[{act:"sort",sorts:[[{key:Y.t+"!"+S+"!"+(Z?"":R)+"!"+(Z?"":"21")+"!!1",isAsc:W}]],nodeKey:V,subTotalsPos:[0],stt:-1}]};}else{if(M==="GraphMatrixVisualizationStyle"){var Q={act:"sortGM",nodeKey:V,subActions:[]};if(Z){N={4:2,3:1};O=N[P];if(!O){return null;}Q.subActions.push({sortIndex:0,sortType:1,objType:4,objID:S,ascending:W,axisIndex:O,subtotalsPosition:0,eIds:[{n:"Cost",id:"CD:"+S,oid:S,otp:4,at:12,prop:{"VLDB Select":[{n:"Metric Join Type",dt:3,v:"1"}]},cds:true,tid:"",gvsRI:0,gvsCI:0,axis:O}],formId:null,actionId:26});}else{N={4:1,3:2};O=N[P];if(!O){return null;}Q.subActions.push({sortIndex:0,sortType:3,objType:12,objID:S,ascending:W,axisIndex:O,subtotalsPosition:0,eIds:null,formId:R,actionId:26});}return Q;}}}function J(N,M){return{act:"threshold",nodeKey:M,thresholds:[{fmt:{FormattingPatterns:{FillColor:2434508,FillStyle:0}},ceil:10},{fmt:{FormattingPatterns:{FillColor:4934627,FillStyle:0}},flr:10,ceil:30},{fmt:{FormattingPatterns:{FillColor:8224233,FillStyle:0}},flr:30,ceil:50},{fmt:{FormattingPatterns:{FillColor:7984249,FillStyle:0}},flr:50,ceil:70},{fmt:{FormattingPatterns:{FillColor:5749335,FillStyle:0}},flr:70,ceil:90},{fmt:{FormattingPatterns:{FillColor:2924588,FillStyle:0}},flr:90}],thresholdType:1,basedOnId:N.did,did:N.did,objType:4};}function C(N,M){return{act:"threshold",nodeKey:M,thresholds:[{fmt:{FormattingPatterns:{FillColor:6176253,FillStyle:0}},ceil:33},{fmt:{FormattingPatterns:{FillColor:2404607,FillStyle:0}},flr:33,ceil:67},{fmt:{FormattingPatterns:{FillColor:9818658,FillStyle:0}},flr:67,ceil:100}],thresholdType:1,basedOnId:N.did,did:N.did,objType:4};}function I(N){var O={Max:"8107C31FDD9911D3B98100C04F2233EA",Min:"8107C31EDD9911D3B98100C04F2233EA",Avg:"8107C31DDD9911D3B98100C04F2233EA",Count:"8107C31CDD9911D3B98100C04F2233EA",Sum:"8107C31BDD9911D3B98100C04F2233EA"};var M=N.fn,P=N.n;return'<tknstrm ><items><tkn v="&amp;" tp="38" lv="4"></tkn><tkn v="'+M+'" tp="280" lv="4"><oi did="'+O[M]+'" t="11" st="2816" n="'+M+'"></oi></tkn><tkn v="&lt;"></tkn><tkn v="UseLookupForAttributes"></tkn><tkn v="="></tkn><tkn v="False"></tkn><tkn v="&gt;"></tkn><tkn v="(" tp="40" lv="4"></tkn><tkn v="'+P+'" tp="266" lv="4"><oi did="'+N.did+'" t="'+N.t+'" st="'+N.st+'" n="'+P+'"></oi></tkn><tkn v=")" tp="41" lv="4"></tkn><tkn v="" tp="-1" lv="4"></tkn></items></tknstrm>';}mstrmojo.vi.controllers._NLPControl=mstrmojo.provide("mstrmojo.vi.controllers._NLPControl",{_mixinName:"mstrmojo.vi.controllers._NLPControl",getClearTemplateDropZoneActions:function F(V){var N=[],c=V.boxContent.model,Q=this,b=this.model,a=c.xtab,Y=a.k,U=a.zonesModel,M=U.getClearAllUnitsActions(),P=U.getClearAllUnitsUnTemplateActions(),S=a.id,O=a.gridData||a.model.data||a.node.data,R=O.vlexpr,X=K({success:function(){var d=mstrmojo.all[S];if(d._viSelections){d.clearSelections();d.endSelections();}}},Q._getXtabCallback(a),{success:function Z(){mstrmojo.all[S].raiseEvent({name:"regenerateToolbar"});}}),W=c.getKeepOnlyActionsForAssociatedNodes([],X);if(M.length>0){N.push(b.getDataService().getUpdateTemplateAction(Y,M));}if(R){W.actions.push(Q.dataService().getUpdateTemplateAction(a.k,c.getRemoveMetricLimitsAction(R)));}if(P&&P.length>0){W.actions=W.actions.concat(P);}if(W.actions.length>0){N=N.concat(W.actions);}return N;},createSmartViz:function L(P,U,O,S,Z,N){var X,c=this.model,R=c.controller,V=P.objects,a=P.style,Q=[],W=this,b=false;V.forEach(function(d){if(d.isDM){b=true;}});var M=function(r){var AK=X.boxContent,n=AK.model,AM=AK.k,AG=AK.zonesModel,AL=AK.gridData||AK.model.data||AK.node.data;if(!N){c.getCurrentLayoutDef().units[AM]={};AL=AK.gridData=AK.model.data=AK.node.data={k:AM,wid:1,gsi:{rows:[],cols:[],mx:[],sorts:[[],[]],fmts:{rh:{},ch:{},va:{}},prop:{rows:{},cols:{},ln:"0"}}};}if(N){Q=Q.concat(this.getClearTemplateDropZoneActions(X));}var AB,o=[],AH=AL.visName,AF=a.s||"",s=a.wtp||0,d=mstrmojo.vi.viz.EnumVizStyles,z=mstrmojo.vi.viz.EnumDSSDropZones,v=AH===d.ESRI_MAP||AH===d.GOOGLE_MAP||AH===d.MAPBOX,m=AF===d.ESRI_MAP||AF===d.GOOGLE_MAP||AF===d.MAPBOX,l=mstrmojo.vi.viz.KnownVisualizations,AD=l.getDefinition(AF),k=R.visTransitionFactory.newVisualizationTransition(AF||"Grid",{vis:AK,newVizInfo:{s:AF,dz:a.dz}});if(v){AB=c.getMapLayerKeys(AK);o=c.getExtraActionsForChangeMapViz(AK,AB,o);}if(AF!==""&&AD.id!==l.UNKNOWN){o.push({act:"updateTemplate",keyContext:AM,actions:[{act:"createDefaultDropZones",nodeKey:AM,treeType:AK.defn.tt,datasetId:AL.datasetId,datasetType:3,widgetType:s,partialUpdate:{nodes:[AM]}}]});}var AC=k?k.transitionDropZones([],a.vt):{wp:""},AA=P.widgetProps||AC.wp,g=AC.wgtName,j=c.getWidgetClassNameByStyle(AF,s),AI=g?({FormattingAppearance:{Name:g}}):undefined;o.push(c.getUnitChangeVizAction(AF,j,AK.parent,AA,AI));o.push({act:"changeGridDisplayMode",nodeKey:AM,displayMode:AF===d.GRAPH_MATRIX?2:1});Q=Q.concat(o);var p=[],f=[],x,h,e=function e(AN){return AN===-1||AN===1||AN===2;};V.reverse().forEach(function(AT){var AQ=AT.t===4,AP=AT.zoneId?AT.zoneId:(AQ?-1:1),AO=AT.datasetId||U,AR=e(AP);if(!AQ){x=x||AO;}else{h=h||AO;}if(AR){f.push(n.getAddTemplateUnitAction(AT,AT.datasetId,AP,0));}else{f=f.concat(AG.getAddDropZoneUnitsActions({id:AP},[AT],0,{datasetId:AO})||[]);if(AP===7&&AQ){f.push(AF==="GoogleMapVisualizationStyle"?C(AT,AM):J(AT,AM));}var AS=AG.getAddDropZoneUnitsActions({id:AP},[AT],0,{datasetId:AO})||[],AN=AS&&AS[0];if(AP===z.ColorBy&&!AQ&&AF==="VIHeatMapVisualizationStyle"){if(AN&&AN.zoneId){AN.zoneId=z.Grouping;f.push(AN);}}if(AP===z.AdditionalMetrics&&AQ&&AF==="MapboxVisualizationStyle"){if(AN&&AN.zoneId){AN.zoneId=z.ColorBy;f.push(AN);}f.push(C(AT,AM));}if(AT.lat&&AT.lng&&m){f.push({act:"addForm",unitId:AT.did,attFormId:AT.lat,unitPos:1});f=f.concat(AG.getAddDropZoneUnitsActions({id:17},[{did:AT.lat,t:21}],0,{datasetId:AO}));f.push({act:"addForm",unitId:AT.did,attFormId:AT.lng,unitPos:1});f=f.concat(AG.getAddDropZoneUnitsActions({id:18},[{did:AT.lng,t:21}],0,{datasetId:AO}));}}if(AQ){p.push(AT);}},n);if(p.length){f.push(n.getValuesDefaultFormatGridZoneAction(p,true));}Q.push(c.getDataService().getUpdateTemplateAction(AM,f));x=h||x;if(x){Q.push({act:"editNode",nodeKey:AM,datasetId:x});}var u=function(AV){O=O||[];if(O.length<=0){return ;}var AS=mstrmojo.insert(AV);var AT=AK.parent.getLimitMdxUnitIdsHashTable(AV);AS.limitExpr={et:14,fn:19,nds:[]};AS.expr={et:14,fn:19,nds:[]};var AP;H.forEach(O,function(AY){if(["top","bottom","greater","less","equal"].indexOf(AY.fn)>-1){AP={m:{did:AY.did,dsid:AY.dsid||AS.dsid,title:AY.n,st:AY.st||1024,n:AY.n,t:AY.t||4,um:false},mdxUnitId:AY.did};}var AZ={fn:0,fnt:0,et:0,m:null,cs:[{v:0,dtp:G.DataTypeNumeric}]};var Aa={top:[13,2,10],bottom:[2,2,10],greater:[8,1,10],less:[9,1,10],equal:[6,1,10]};var AW=function AW(Ae){var Af=Ae.fn;if(Af==="in"){return null;}var Ac=A.copy(AZ);var Ab=Aa[Af];Ac.fn=Ab[0];Ac.fnt=Ab[1];Ac.et=Ab[2];Ac.cs[0].v=Ae.v;if(Af==="top"||Af==="bottom"){var Ad={v:1,dtp:G.DataTypeNumeric};Ac.cs.unshift(Ad);}return Ac;};var AX=AW(AY);if(AX){AS.limitExpr.nds.push(A.copy(AP,AX));}});var AO=AK.parent.getLimitMdxUnitIdsHashTable(AS),AQ=[];A.forEach(AT,function(AX,AW){if(!AO[AW]){AQ=AQ.concat({did:AW,t:4});}});var AR={expr:D(AS.expr),limitExp:D(AS.limitExpr),nodeKey:AK.k,limitMdxToRemove:AQ};var AN={act:"saveViewFilter",messageID:AS.messageID,nodeKey:AR.nodeKey,expr:AR.expr};var AU={act:"saveViewFilterLimit",messageID:AS.messageID,nodeKey:AR.nodeKey,limitExp:AR.limitExp,limitToRemove:AR.limitMdxToRemove||[]};Q.push(AN);Q.push(AU);};c.getViewFilter({nodeKey:AM,msgID:c.mid},{success:u});if(S&&S.length>0){S.forEach(function(AN){var AO=V.filter(function(AP){return AP.did===AN.did;})[0];AN.zoneId=AO?AO.zoneId:0;});var AE=B(S,AM,a);if(AE){Q.push(AE);}}if(Z){Q.push({act:"format",unitKey:AM,unitType:522,formatType:1,format:{FormattingView:{Title:Z}}});}var t=function t(){var AN=AK.parent.k;return{success:function(){c.getPanel().getUnitByKey(AN).selectVIUnit(true);}};};var AJ=K({success:function q(AQ){var AP=this.getCurrentLayoutKey(),AO=this.getPanel(),AR=AO.k;this.refreshDefinition(AM,this.getRawLayoutUnitDefn(AM,AQ.defn));this.updateDataCache(AQ.data,this.getTargetDefn([AM]));if(this.getLayoutDataCache(AP)[AO.id]){var AN=H.filterOne(this.data.layouts,function(AS){return(AS.k===AP);});this.updateDataCache({layouts:[AN]},this.getTargetDefn(AR));}if(AQ.data){AQ.data.layouts.some(function(AT){var AS=AT.k===AP;if(AS){this.controller.view.updateXtabStyles(AP,AT.xtabStyles);}return AS;},this);}this.selectVIUnit(AO.rebuildChild(AO.getUnitByKey(AM)).id,true);}.bind(c)},R._getXtabCallback(AK),{success:function(AN){c.partialUpdate(AN.data,c.getUnitDefinitions(AM));}},t());if(!r){R.submitUndoRedoUpdates(Q,null,AJ,mstrmojo.DocDataService.REQUEST_DEFN_DATA);}else{var w=c.getDataService().newUpdateWithoutCmd({actions:Q,callback:AJ,extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA});w.cmd=c.cmdMgr().getInterimCmd();w.submit();}};X=c.getSelectedViUnit();if(N&&!b){M.call(this);}else{c.execute({execute:function Y(){var f=c.getDataService(),h=f.newUpdate(this),g=c.getPanel().k;if(!N){X=c.addVisualizationDeferred(h,g);}h.extras={params:{suppressData:true}};h.callback.success=mstrmojo.emptyFn;if(b){var d=[],e=mstrmojo.UUID.create();V.forEach(function(k){if(k.isDM){var j={act:"addDerivedMetricToDataset",dsid:k.datasetId||U,formula:I(k),isTokenStream:true,name:k.dmName,newObjectIds:[e]};d.push(j);return false;}});h.addActions(d);h.extras={};h.addExtras(mstrmojo.DocDataService.REQUEST_ONLY_DATASETS);h.addCallbacks({success:function(k){c.als=k.als;c.updateDatasets(k.datasets,k.datasetsSettings);var j=E.getUnitFromDataset(c.datasets,e,4);var l=function(m){if(m.isDM){m.isDM=undefined;m.dmName=undefined;m.st=undefined;A.copy(A.clone(j),m);}};V.forEach(l);(O||[]).forEach(l);(S||[]).forEach(l);}});}h.addCallbacks({success:function(){M.call(W,true);}});this.submitUpdate(h,c.cmdMgr().CMD_PHASE.FIRST);},urInfo:{treesToRender:3,disablePU:true,callback:R.getRefreshCallback()}});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.models.template.DataInterface","mstrmojo.vi.ui.DatasetUnitMenuUtils");var D=mstrmojo.string,Y="TemplateObject",AB="Value",H=12,B=4,Q={},h={},o={},E={},f={},K=[],t={},n={},u=mstrmojo.array,L=mstrmojo.hash,C,AC=mstrmojo.vi.ui.DatasetUnitMenuUtils,x="\u200C",d={GEO:"geo",TIME:"time",CATEGORY:"category",SUBCATEGORY:"subcategory",PRODUCT:"product",DEPARTMENT:"department",BUSINESS_UNIT:"businessUnit",ALL_THE_REST:"allTheRest"},e={PROFIT:"profit",REVENUE:"revenue",COST:"cost",SOLD:"sold",SALES:"sales",AMOUNT:"amount",ALL_THE_REST:"allTheRest"},X={LEXICAL:0,OBJECT:1,CONDITION:2,AGGREGATION:3};function A(AJ){var AG=C(AJ,o).list[0].terms,AF=[],AI=0,AE=[],AL=[],AK,AD=function AD(AM){var AN="";u.forEach(AM,function(AO){AN=AN+" "+AO;AN=AN.trim();if(o[AN]){AF.push(AN.replace(/ +/g,x));AN="";}});},AH=function AH(AN){var AO=C(AN.join(" ")).values().numbers(),AM;if(u.isArray(AO)&&AO.length>0){AM=AO[0];AF.push(AM);}};while(AI<AG.length){AK=AG[AI].normal;if(!AG[AI].tags[Y]&&!AG[AI].tags[AB]){if(AL.length>0){AH(AL);}AL=[];if(AE.length>0){AD(AE);}AF.push(AK);AE=[];}else{if(AG[AI].tags[AB]&&!AG[AI].tags[Y]){AL.push(AK);}else{AE.push(AK);}}AI++;}if(AE.length>0){AD(AE);}if(AL.length>0){AH(AL);}return C(AF.join(" "),E);}function p(AG){var AF,AE,AD,AH={average:"Avg",maximum:"Max",max:"Max",minimum:"Min",min:"Min",sum:"Sum","sum of":"Sum",count:"Count","count of":"Count"};L.forEach(AH,function(AJ,AI){AF=AG.match(AI+" #"+Y).list;u.forEach(AF,function(AK){AD=u.filter(AK.terms,function(AL){return !!AL.tags[Y];});AE=AD[0];AE.symboltp=X.AGGREGATION;AE.fn=AJ;AE.isDM=true;});});return AG;}function k(AI){var AD=["sort by","sorted by"],AH,AG=[],AF,AE;u.forEach(AD,function(AJ){AH=AI.match(AJ+" #"+Y).list;u.forEach(AH,function(AK){AE=u.filter(AK.terms,function(AL){return !!AL.tags[Y];});AF=f[AE[0].normal];if(AF.t===H&&AF.fs&&AF.fs[0]){AF.fid=AF.fs[0].fid;}AG.push(AF);});});return AG;}function J(AL){var AG="greater",AM="less",AP="equal",AQ={"bigger than":AG,"larger than":AG,"greater than":AG,"smaller than":AM,"less than":AM,is:AP,are:AP},AJ,AE,AF,AK=AK||window.nlp;L.forEach(AQ,function(AS,AR){AJ=AL.match("#"+Y+" * "+AR+" #value").list;u.forEach(AJ,function(AT){AE=u.filter(AT.terms,function(AU){return !!AU.tags[Y];});AF=AE.slice(-1)[0];AF.symboltp=X.CONDITION;AF.condiOp=AS;AF.condiValue=u.filter(AT.terms,function(AU){return !!AU.tags[AB];})[0].normal;AF.condiValue=AK(AF.condiValue).values().numbers()[0];});});var AH=function AH(AR){var AS=["#"+Y+(AR?" with highest #":" with lowest #")+Y,"#"+Y+(AR?" with the highest #":" with the lowest #")+Y,"#"+Y+(AR?" with most #":" with fewest #")+Y,"#"+Y+(AR?" with the most #":" with the fewest #")+Y,"#"+Y+(AR?" with greatest #":" with least #")+Y,"#"+Y+(AR?" with the greatest #":" with the least #")+Y,"#"+Y+(AR?" with largest #":" with smallest #")+Y,"#"+Y+(AR?" with the largest #":" with the smallest #")+Y,"#"+Y+(AR?" with maximum #":" with minimum #")+Y,"#"+Y+(AR?" with the maximum #":" with the minimum #")+Y];return AS;};var AD=AH(true);var AI=AH(false);var AN=function AN(AS){var AR=(AS==="top")?AD:AI;u.forEach(AR,function(AU){var AT=AL.match(AU).list;u.forEach(AT,function(AV){AE=u.filter(AV.terms,function(AW){return !!AW.tags[Y];});AF=AE[1];AF.symboltp=X.CONDITION;AF.condiOp=AS;AF.condiValue=1;});});};AN("top");AN("bottom");var AO=["top #value #"+Y+" by #"+Y,"top #value #"+Y+" with the highest #"+Y];u.forEach(AO,function(AR){AJ=AL.match(AR).list;u.forEach(AJ,function(AS){AE=u.filter(AS.terms,function(AT){return !!AT.tags[Y];});AF=AE[1];AF.symboltp=X.CONDITION;AF.condiOp="top";AF.condiValue=u.filter(AS.terms,function(AT){return !!AT.tags[AB];})[0].normal;AF.condiValue=AK(AF.condiValue).values().numbers()[0];});});return AL;}function s(AE){var AD={kpi:"KPICardVisualizationStyle","geospatial map":"MapboxVisualizationStyle","heat map":"VIHeatMapVisualizationStyle",heatmap:"VIHeatMapVisualizationStyle","tree map":"VIHeatMapVisualizationStyle",treemap:"VIHeatMapVisualizationStyle",map:"GoogleMapVisualizationStyle",line:"LINE",bar:"BAR",pie:"PIE",bubble:"BUBBLE",network:"NetworkVisualizationStyle",table:"Grid",grid:"Grid"},AF="";L.forEach(AD,function(AH,AG){if(AE.match(AG).found){AF=AH;return false;}});return AF;}function g(AD){var AF=[],AH=[],AE,AG=A(AD);u.forEach(AG.list[0].terms,function(AI){if(AI.tags[Y]){AI.symboltp=X.OBJECT;}});AG=p(AG);AG=J(AG);u.forEach(AG.list[0].terms,function(AI){switch(AI.symboltp){case X.CONDITION:AE=f[AI.normal];AF.push({fn:AI.condiOp,v:AI.condiValue,did:AE.did,n:AE.n,t:AE.t,st:AE.st,dsid:AE.datasetId,isDM:AI.isDM});AH.push(L.copy({fn:AI.fn,isDM:AI.isDM,dmName:AI.fn+" "+AE.n,t:AI.isDM?B:AE.t},L.clone(AE)));break;case X.OBJECT:case X.AGGREGATION:AE=f[AI.normal];AH.push(L.copy({fn:AI.fn,isDM:AI.isDM,dmName:AI.fn+" "+AE.n,t:AE.t},L.clone(AE)));break;default:break;}});return{items:AH,visType:s(AG),filter:AF,sorts:k(AG)};}function z(AE,AD){var AF=AC.getUnitCssClass(AE);AD.push({n:AE.n,html:'<div class="icn '+AF+'"></div>'+D.encodeHtmlString(AE.n),dsName:AE.dsName});}function G(){K=[];L.forEach(h,function(AD){z(AD,K);});L.forEach(Q,function(AD){z(AD,K);});}function O(AF,AD){AD=u.ensureArray(AD);AF=AF.toLowerCase();var AE=false;u.forEach(AD,function(AG){if(AF.indexOf(AG)>-1){AE=true;return false;}return true;});return AE;}function V(AD){return AC.isTimeAttr(AD)||O(AD.n,["month","year","quarter","week","date"]);}function v(AD){if(AC.isGeoAttr(AD)){return d.GEO;}else{if(V(AD)){return d.TIME;}else{if(O(AD.n,["category","categories"])){return d.CATEGORY;}else{if(O(AD.n,["subcategory","subcategories","sub-category"])){return d.SUBCATEGORY;}else{if(O(AD.n,["product","products"])){return d.PRODUCT;}else{if(O(AD.n,["department","departments"])){return d.DEPARTMENT;}else{if(O(AD.n,["business unit","business units"])){return d.BUSINESS_UNIT;}else{return d.ALL_THE_REST;}}}}}}}}function b(AD){if(O(AD.n,["profit","profits"])){return e.PROFIT;}else{if(O(AD.n,["revenue"])){return e.REVENUE;}else{if(O(AD.n,["cost","costs"])){return e.COST;}else{if(O(AD.n,["sold","units sold"])){return e.SOLD;}else{if(O(AD.n,["sales"])){return e.SALES;}else{if(O(AD.n,["amount"])){return e.AMOUNT;}else{return e.ALL_THE_REST;}}}}}}}function q(){return{att:{geo:[],time:[],category:[],subcategory:[],product:[],department:[],businessUnit:[],preferredAttrs:[],allTheRest:[]},mx:{profit:[],revenue:[],cost:[],sold:[],sales:[],amount:[],preferredMetrics:[],allTheRest:[]}};}function F(){var AF=function AE(AI,AH){return u.some(AH,function(AJ){return AJ.did===AI.did&&AJ.datasetId===AI.datasetId;});};n={};t={};t=q();var AD=t.att,AG=t.mx;L.forEach(Q,function(AI){var AK=AI.datasetId;if(!n[AI.datasetId]){n[AI.datasetId]=q();}var AJ=n[AK].att,AH=v(AI);if(!AF(AI,AD[AH])){AD[AH].push(AI);}if(!AF(AI,AJ[AH])){AJ[AH].push(AI);}});AD.preferredAttrs=[].concat(AD.category).concat(AD.subcategory).concat(AD.product).concat(AD.department).concat(AD.businessUnit);u.forEach(L.keyarray(n),function(AI){var AH=n[AI].att;AH.preferredAttrs=[].concat(AH.category).concat(AH.subcategory).concat(AH.product).concat(AH.department).concat(AH.businessUnit);});L.forEach(h,function(AJ){var AK=AJ.datasetId;if(!n[AK]){n[AK]=q();}var AH=n[AK].mx,AI=b(AJ);if(!AF(AJ,AG[AI])){AG[AI].push(AJ);}if(!AF(AJ,AH[AI])){AH[AI].push(AJ);}});AG.preferredMetrics=[].concat(AG.profit).concat(AG.revenue).concat(AG.cost).concat(AG.sold).concat(AG.sales).concat(AG.amount);u.forEach(L.keyarray(n),function(AI){var AH=n[AI].mx;AH.preferredMetrics=[].concat(AH.profit).concat(AH.revenue).concat(AH.cost).concat(AH.sold).concat(AH.sales).concat(AH.amount);});}var N="%%METRIC_1%%";var M="%%METRIC_2%%";var I="%%ATTRIBUTE_1%%";var c="%%ATTRIBUTE_TIME_1%%";var r="%%ATTRIBUTE_GEO_1%%";var P='<div class="icn question"></div>';function U(AD){return x+AD+x;}function m(AD){return"<b>"+AD+"</b>";}var j=[{templates:[{n:"What is the total "+U(N)+"?",html:P+"What is the total "+m(N)+"?",type:"sample-question"}],config:{mx:1}},{templates:[{n:"Count ("+U(I)+")",html:P+"Count ("+m(I)+")",type:"sample-question"}],config:{att:1}},{templates:[{n:"What is the "+U(N)+" by "+U(c)+"?",html:P+"What is the "+m(N)+" by "+m(c)+"?",type:"sample-question"}],config:{att_time:1,mx:1}},{templates:[{n:"Show me the distribution of "+U(N)+" by "+U(r),html:P+"Show me the distribution of "+m(N)+" by "+m(r),type:"sample-question"},{n:"Show me a map of "+U(N)+" by "+U(r),html:P+"Show me a map of "+m(N)+" by "+m(r),type:"sample-question"}],config:{att_geo:1,mx:1}},{templates:[{n:"Show me the "+U(N)+" by "+U(I),html:P+"Show me the "+m(N)+" by "+m(I),type:"sample-question"}],config:{att:1,mx:1}},{templates:[{n:"Show me the "+U(N)+" by "+U(I)+" by "+U(c),html:P+"Show me the "+m(N)+" by "+m(I)+" by "+m(c),type:"sample-question"}],config:{att:1,att_time:1,mx:1}},{templates:[{n:"What is the correlation between "+U(N)+" and "+U(M)+" by "+U(I)+"?",html:P+"What is the correlation between "+m(N)+" and "+m(M)+" by "+m(I)+"?",type:"sample-question"}],config:{att:1,mx:2}},{templates:[{n:"What are the top 3 "+U(I)+" with the highest "+U(N)+"?",html:P+"What are the top 3 "+m(I)+" with the highest "+m(N)+"?",type:"sample-question"}],config:{att:1,mx:1}},{templates:[{n:"What is the "+U(N)+" by "+U(I)+" sorted by "+U(N)+"?",html:P+"What is the "+m(N)+" by "+m(I)+" sorted by "+m(N)+"?",type:"sample-question"}],config:{att:1,mx:1}}];function l(AD,AH){if(AD>AH){return 0;}var AG=1,AF=1;for(var AE=0;AE<AD;AE++){AG=AG*(AH-AE);AF=AF*(AD-AE);}return AG/AF;}function S(AF,AJ){var AI=AF.config,AQ=AJ.mx,AK=AJ.att,AR=AK.time.length,AP=AK.geo.length,AO=AK.preferredAttrs.length,AM=AK.allTheRest.length,AH=AQ.preferredMetrics.length,AG=AQ.allTheRest.length;var AN=AI.att||0,AL=AI.att_time||0,AE=AI.att_geo||0,AD=AI.mx||0;var AS={preferred:0,others:0,total:0};if(AL>AR||AE>AP||AN>(AO+AM)||AD>(AH+AG)){return AS;}if(AN>AO||AD>AH){AS.preferred=0;}else{AS.preferred=l(AN,AO)*l(AD,AH)*l(AL,AR)*l(AE,AP);}AS.total=l(AN,AO+AM)*l(AD,AH+AG)*l(AL,AR)*l(AE,AP);AS.others=AS.total-AS.preferred;return AS;}function w(AF,AI){var AE=AF.length;if(AE<AI){return null;}if(AE===AI){return AF;}var AH,AG=[],AD=[];while(AD.length<AI){AH=Math.floor(Math.random()*AE);if(AG.indexOf(AH)>-1){continue;}AG.push(AH);AD.push(AF[AH]);}return AD;}function AA(AQ,AU){var AH=AU.mx,AP=AU.att,AG=AP.preferredAttrs,AR=AP.time,AE=AP.geo,AN=AP.allTheRest,AK=AH.preferredMetrics,AD=AH.allTheRest;var AF=AQ.templates,AS=AQ.config,AT=w(AF,1)[0];var AJ=L.clone(AT);var AI=w(AR,AS.att_time),AV=w(AE,AS.att_geo),AO=[].concat(w(AG,Math.min(AG.length,AS.att))).concat(w(AN,Math.max(0,AS.att-AG.length))),AL=[].concat(w(AK,Math.min(AK.length,AS.mx))).concat(w(AD,Math.max(0,AS.mx-AK.length)));var AM=function(AX,AW){if(AW){return D.encodeHtmlString(AX&&AX.n||"");}return AX&&AX.n||"";};AJ.n=AJ.n.replace(new RegExp(N,"g"),AM(AL[0],false)).replace(new RegExp(M,"g"),AM(AL[1],false)).replace(new RegExp(I,"g"),AM(AO[0],false)).replace(new RegExp(c,"g"),AM(AI[0],false)).replace(new RegExp(r,"g"),AM(AV[0],false));AJ.html=AJ.html.replace(new RegExp(N,"g"),D.encodeHtmlString(AM(AL[0]))).replace(new RegExp(M,"g"),D.encodeHtmlString(AM(AL[1]))).replace(new RegExp(I,"g"),D.encodeHtmlString(AM(AO[0]))).replace(new RegExp(c,"g"),D.encodeHtmlString(AM(AI[0]))).replace(new RegExp(r,"g"),D.encodeHtmlString(AM(AV[0])));return AJ;}function a(){var AD=[],AE=[],AF={};u.forEach(L.keyarray(n),function(AG){AE.push(AG);AF[AG]=[];});u.forEach(L.keyarray(n),function(AI){var AH=[];u.forEach(j,function(AK){var AJ=S(AK,n[AI]);AH.push(AJ);});var AG=u.map(AH,function(AJ){return AJ.total;});AF[AI]=AG;});u.forEach(j,function(AG,AP){var AO=Math.floor(Math.random()*AE.length);if(AF&&AE&&AE[AO]){var AM=AE[AO];if(AF[AM][AP]>0){AD.push(AA(AG,n[AM]));}else{if(AF[AM][AP]===0){var AK=mstrmojo.hash.clone(AE),AI=0,AN=AK[AO],AH=AF[AN];while(AH&&AH[AP]===0&&AI<AK.length){var AJ=AN,AL=AK.indexOf(AJ);if(AL>-1){AK.splice(AL,1);}AO=Math.floor(Math.random()*AK.length);AN=AK[AO];AH=AF[AN];AI++;}if(AN&&AH&&AH[AP]&&AH[AP]>0){AD.push(AA(AG,n[AN]));}}}}});return AD;}mstrmojo.vi.models._IsNLPModel=mstrmojo.provide("mstrmojo.vi.models._IsNLPModel",{_mixinName:"mstrmojo.vi.models._IsNLPModel",isWordBaseBuilt:false,mapConfig:null,buildWordBase:function R(AF){if(AF){this.isWordBaseBuilt=false;}o={};E={};f={};if(!this.isWordBaseBuilt){var AD,AG,AE=true;Q={};h={};if(Object.keys){AE=Object.keys(this.datasets||{}).length>1;}L.forEach(this.datasets,function(AJ,AH){var AI=AJ.name||"";u.forEach(AJ.att,function(AK){if(AK.hide){return true;}AD=AK.n.toLowerCase();AG=AK.did.toLowerCase();AK.datasetId=AH;if(AE){AK.dsName=AI;}Q[AD]=AK;o[AD]=Y;o[AG]=Y;AD=AD.replace(/\s/g,x);E[AD]=Y;E[AG]=Y;f[AD]=AK;f[AG]=AK;});u.forEach(AJ.mx,function(AK){if(AK.hide){return true;}AK.datasetId=AH;if(AE){AK.dsName=AI;}AD=AK.n.toLowerCase();AG=AK.did.toLowerCase();h[AD]=AK;o[AD]=Y;o[AG]=Y;AD=AD.replace(/\s/g,x);E[AD]=Y;E[AG]=Y;f[AD]=AK;f[AG]=AK;});});F();G();this.isWordBaseBuilt=true;}},getSuggestionListItems:function W(AE,AF){var AH=AE.pattern,AD=[];AH=D.regEscape((AH||"").trim());if(!(AE&&AE.showSampleQuestion)){AF=AF||1000;var AI=u.filter(K,function(AJ){return(new RegExp("\\s"+AH+"|^"+AH,"i")).test(AJ.n);},{max:AF});u.forEach(AI,function(AK,AJ){AK.matchPos=((AK.n||"").toLowerCase()).indexOf((AH||"").toLowerCase())>-1?((AK.n||"").toLowerCase()).indexOf((AH||"").toLowerCase()):Infinity;AK.pos=AJ;});var AG=function(AK,AJ){if(AK.matchPos<AJ.matchPos){return -1;}else{if(AK.matchPos===AJ.matchPos){return AK.pos-AJ.pos;}}return 1;};AI=(AI||[]).sort(AG);AD=AI;}else{AD.push({n:"",html:"You may ask a question like",type:"dummy",cls:"label"});AD=AD.concat(a());}return AD;},getRelevantObjects:function Z(AD){C=C||window.nlp;AD=AD.replace(/\?+$/,"").toLowerCase();this.buildWordBase(true);var AE=AD.split(x);(AE||[]).forEach(function(AG,AF){if(o[AG]){if(Q[AG]){AE[AF]=Q[AG].did;}else{if(h[AG]){AE[AF]=h[AG].did;}}}});AD=AE.join("").toLowerCase();return g(AD);},checkForMapboxKey:function(){var AE=this;if(!AE.mapConfig){var AD={taskId:"getMultiMapConfig",key:"",taskEnv:"xhr",taskContentType:"json"},AF={success:function(AG){if(AG){AE.mapConfig=AG;}},failure:function(){}};mstrApp.serverRequest(AD,AF);}}});mstrmojo.vi.models._IsNLPModel.isTimeAttr=V;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.elementHelper","mstrmojo.mstr.EnumFunction","mstrmojo.mstr.EnumDSSConsolidationType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.rw.xtab.XtabMenuConfig","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.ui.NumberFormatterEditor","mstrmojo.vi.ui.CalculationMenuEditor","mstrmojo.vi.enums.EnumDerivedElementType","mstrmojo.array");mstrmojo.requiresDescs(14388,14717,13355,12197,15356,15599);var W=mstrmojo.hash,j=mstrmojo.array,V=mstrmojo.dom,f=mstrmojo.elementHelper,b=mstrmojo.vi.enums.EnumDerivedElementType,o=mstrmojo.vi.ui.DatasetUnitMenuUtils,O=mstrmojo.mstr.EnumFunction,D=mstrmojo.mstr.EnumDSSConsolidationType,F=mstrmojo.mstr.EnumDSSXMLObjectTypes,Z=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,e=mstrmojo.vi.enums.EnumFeatures;var G=mstrmojo.rw.xtab.XtabMenuConfig.ACTION_TYPES,m=G.GROUP,h=G.CALCULATION,d=2,C=3,U=1;function Q(){return mstrApp.isAppStatePresentation();}function R(r){if(!r||!r.items||!r.data||!r.xtab){return{};}var w=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,isHostedWithin:false,alignWithAnchor:true,maxHeight:350}),s=r.items,u=r.data,v=r.xtab,t=[];if(mstrmojo.resolveFeature("sort-drill-paths")){s.sort(function(z,x){if(z.n>x.n){return 1;}if(z.n<x.n){return -1;}return 0;});}s.forEach(function(z,x){if(t.indexOf(z.id)===-1){t.push(z.id);if(z.att){w.addPopupMenuItem(z.n,this.id,R,"xt",{items:s[x].att,data:u,xtab:v});}else{w.addMenuItem(z.n,"xt",function(){v.drill(u,s[x]);});}}});return w;}function q(z){var AF=z.xtab,u=z.data,v=AF.model,x=v.getAllDrillWithinPathsForCell(u,undefined,true),AA=x.length,w=v.docModel,s=w.datasets[v.data.datasetId],AG,AB=[],AD=-1,AC,AE,t,r;if(s&&w.isMDXDataset(s)){x.sort(function(AI,AH){AI.did=AI.id;AH.did=AH.id;if(AI.id<AH.id){return -1;}if(AI.id>AH.id){return 1;}return 0;});AG=s.tables[0];AG.dimensions.forEach(function(AH){t=true;AC=-1;AH.hierarchies.forEach(function(AI){r=true;AI.att.forEach(function(AJ){if(AJ){AE=j.findBin(x,AJ,"did",AA);if(AE!==-1){if(t){AB.push({id:AH.did,n:AH.n,att:[]});AD++;t=false;}if(r){AB[AD].att.push({id:AI.did,n:AI.n,att:[]});AC++;r=false;}AB[AD].att[AC].att.push(x[AE]);}}});});});}else{AB=x;}return R({items:AB,data:u,xtab:AF});}function k(s){var v=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:250});var u=s.xtab,t=s.deObject,r=s.groups;r.forEach(function(x,w){if(x.t===b.LIST&&!x.ido){v.addMenuItem(x.n,"",function(){u.addElementsToGroup(t,r[w],w,u.getContextMenuSelections());});}});return v;}function l(s){var r=s&&s.des;return !!r&&r.some(function(t){return(t.t===b.LIST&&!t.ido);});}function g(r,w,t){var s=false,v=undefined;if(w){s=!f.isNonGroupNull(r.data)&&this.isActionAvailable(r.data,m)&&r.de===undefined;}else{if(t){var u=M.call(this,r);s=u.isActionAvailable;v=u.group;}}return{isAddToGroupSupported:s,group:v};}function M(s,t){var u,w=undefined,v=s.xtab,z=0,x=v.cmSelCells;var r=x.filter(function(AA,AB){return x.indexOf(AA)===AB;});u=!r.some(function(AA){var AB=v.getCellForNode(AA);if(!f.isNonGroupNull(AB)&&this.isActionAvailable(AB,m)){if(AB.dei!==undefined){w=v.getDEInfo(AB).de;if(w.t!==b.LIST||++z>1){return true;}}return false;}else{return true;}},this);if(t){u=(u)?!!w:u;}return{isActionAvailable:u,group:(u)?w:undefined};}function P(r){var s=r.xtab;return !s.cmSelCells.some(function(t){var u=s.getCellForNode(t);return f.isNonGroupNull(u)||!this.isActionAvailable(u,m)||u.dei!==undefined;},this);}function I(s){var r;return !s.cmSelCells.some(function(t){r=s.getCellForNode(t);return(f.isNonGroupNull(r)||!this.isActionAvailable(r,h));},this);}function X(u){var r=o.generateNumberFormat(u&&u.de&&u.de.nf),v=W.clone(r),x=W.clone(r),s=new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.vi.ui.NumberFormatter({myData:v,oldData:x,formatValue:r}),data:v}),t=this.delegateActionToXtab;W.make(v,mstrmojo.Obj);W.make(x,mstrmojo.Obj);s.fnOk=function w(){t(u,"editQuickDECalculationNumberFormat",W.copy(this.data,{de:u.de}));};return s;}function a(v){var AG=new mstrmojo.ui.menus.MenuConfig(),z=4,AJ=5,AE=6,s=7,AH=" - ",x=" / ",AB={SINGLE:[{n:mstrmojo.desc(358,"Absolute"),v:O.FunctionAbs}],PAIR:[{n:mstrmojo.desc(6017,"Add"),v:O.FunctionAdd},{n:mstrmojo.desc(2122,"Average"),v:O.FunctionAverage},{n:mstrmojo.desc(5868,"Least"),v:O.FunctionLeast},{n:mstrmojo.desc(5869,"Greatest"),v:O.FunctionGreatest},{n:"A-B",v:O.FunctionMinus+";0"},{n:"B-A",v:O.FunctionMinus+";1"},{n:"A/B",v:O.FunctionDivide+";0"},{n:"B/A",v:O.FunctionDivide+";1"}],MORE:[{n:mstrmojo.desc(6017,"Add"),v:O.FunctionAdd},{n:mstrmojo.desc(2122,"Average"),v:O.FunctionAverage},{n:mstrmojo.desc(5868,"Least"),v:O.FunctionLeast},{n:mstrmojo.desc(5869,"Greatest"),v:O.FunctionGreatest}]},AF=v.isEdit,AI=AF&&v.de,AM=v.data,AK=AI&&AI.es,AL=v.xtab,AD=AF?(AK&&AK.length):AL.getCxtMnuSelectionSize(),r=(AD===1)?"SINGLE":((AD===2)?"PAIR":"MORE"),AC=AB[r],w=(AI&&AI.func),u;if(r==="PAIR"){if(AF&&AI){AC[z].n=AK[0].n+AH+AK[1].n;AC[AJ].n=AK[1].n+AH+AK[0].n;AC[AE].n=AK[0].n+x+AK[1].n;AC[s].n=AK[1].n+x+AK[0].n;}else{u=this.xtab.cmSelCells;var t=u[0].innerText||u[0].textContent,AA=u[1].innerText||u[1].textContent;AC[z].n=t+AH+AA;AC[AJ].n=AA+AH+t;AC[AE].n=t+x+AA;AC[s].n=AA+x+t;}}AC.forEach(function(AN){var AP=AN.v,AO=AF&&((typeof AP==="string"&&AP.indexOf(w)===0&&AP.indexOf(";0")>0)||AP===w);AG.addMenuItem(AN.n,"xt "+(AO?"checked":""),function(){var AR=v.xtab,AQ=AI&&AI.func;if((AI&&AQ===AP)||(typeof AP==="string"&&AP.indexOf(AQ)===0&&AP.indexOf(";0")>0)){return ;}if(v.isEdit===true){AR.editDECalculation(AM,AP);}else{AR.derivedElementCalculation(AM,AP);}});},this);return AG;}function A(t){var AH=t.xtab,x=t.data,AB=AH.model,w=AB.getCellTitleInfo(x),AI=AB.isRecursiveAttribute(x.id||w.title.id),AA=AH.getDEInfo(x),v=AA&&AA.deObject,AG=AA&&AA.de,AC=AG&&AG.t,AE=v&&AH.getOthersDEInfo(v),s=t.singleCellClick,z=AH.isSingleContextMenuAttrSelection(),AD=true,u=AH.getContextMenuSelections(),r=AH.isSingleContextMenuSelection(),AF={de:AG,xtab:AH,data:x,td:t.td,singleClick:s};if(AE&&!r&&z){u.forEach(function(AJ){if(AJ[0]&&AJ[0].eid.indexOf(AE.id)>-1){AD=false;return false;}});}if(!mstrApp.isInVFConfigMode&&(s||z)&&this.isActionAvailable(x,h)&&I.call(this,AH)&&mstrmojo.resolveFeature(e.INSERT_NEW_METRIC)){if(!AI&&!(r&&AC===b.RESIDUE)&&AD){this.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",this.id,a,W.copy(AF,{isEdit:false}));}else{if(AI&&r&&!AC&&!x.ln){this.addMenuItem(mstrmojo.desc(15356,"Calculated Member..."),"",function(){AH.derivedElementCalculation(x,O.FunctionApplySimple);});}}}if(!mstrApp.isInVFConfigMode&&r&&AI&&AC===b.CALCULATION){this.addMenuItem(mstrmojo.desc(15366,"Delete Calculated Member"),"",function(){this.delegateActionToXtab(AF,"removeQuickDE",AA);}.bind(this));this.addMenuItem(mstrmojo.desc(15599,"Edit Calculated Member..."),"",function(){this.delegateActionToXtab(AF,"derivedElementsEdit",[AA]);}.bind(this));}}function S(){var v=this.xtab,r=v.model,t=this.selectedData,s=v.getContextMenuSelections(),u=!t.olap;if(s.length>0){s.forEach(function(w){w.forEach(function(x){u=u&&r.supportsViewFilterActions(x.tid);});});}else{u=u&&r.supportsViewFilterActions(r.getCellTitleInfo(t).title.id);}if(t.mix!==undefined){u=u&&r.getCellDataUnion(t).every(function(w){return r.supportsViewFilterActions(w.tid);});}return u;}function c(r){return r&&r.mix!==undefined&&!!r._e;}function Y(r){return r&&r.otp===F.Attribute;}function E(r){return r&&r.otp===F.Consolidation&&r.ost===Z.ConsolidationManaged;}function n(r){var w=r.data,x=this.xtab,t=x.model,z=c(w),v=z?w._e:t.getCellTitleInfo(w).title,s=!z&&v.otp===-1,u;if(s){j.forEach([w._lp,w._tp],function(AB){var AC=AB;while(AC&&AC!==AC._p&&!u){if(AC.stt){continue;}var AA=t.getCellTitleInfo(AC),AF=AA.title,AE=AF&&AF.id;if(AE&&AF.ost===12033){var AD=x.getDEInfo(AC),AG=AD&&AD.de;if(AG&&AG.t===b.CALCULATION&&AG.nf&&Object.keys(AG.nf).length>0){u={de:AG,xtab:x,data:AC,td:r.td,singleClick:r.singleClick};break;}}AC=AC._p;}return !u;});}if(!u){if(s){v={oid:t.data.gsi.mx[w.mix].did,otp:4};}u={did:v.oid||v.id,t:v.otp,stp:v.ost,fs:v.fs};}return u;}function K(t,r){var s=t&&r.td&&t.getCellForNode(r.td);if(c(s)){s.id=s._e.oid;s.otp=s._e.otp;}return s;}function B(t){var u=t.de?t:n.call(this,t),v=u.de,w=t.xtab,s=w.model,AA,r,z,x=s.id;if(v){if(w.isSingleSelection()&&v.t===b.CALCULATION&&v.func!==O.FunctionApplySimple){AA=true;z=u;r=X;x=this.id;}}else{AA=s.showNumberFormat(u);z={item:u};r=s.getNumberFormatEditorCfg;}if(AA){this.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),x,r,z);}}function p(t,r){var s=this.delegateActionToXtab;if(Y(t)||(t.otp===47&&t.ost===12033)){this.addMenuItem(mstrmojo.desc(14655,"Expand All Levels"),"",function(){s(r,"raExpandAll",[true]);});this.addMenuItem(mstrmojo.desc(14656,"Collapse All Levels"),"",function(){s(r,"raExpandAll",[false]);});}else{this.addMenuItem(mstrmojo.desc(14669,"Expand All Lower Levels"),"",function(){s(r,"raExpandDescendants");});}}mstrmojo.vi.ui.rw.xtab.XtabMenuConfig=mstrmojo.declare(mstrmojo.rw.xtab.XtabMenuConfig,null,{scriptClass:"mstrmojo.vi.ui.rw.xtab.XtabMenuConfig",buildXtabMenuConfig:function N(AI){var AG=this.xtab=AI.xtab,Ai=Q(),x=AG.model,As=this.selectedData=AI.data=AI.data||K(AG,AI),Aq=o.getDatasetFromAttributeId(x.docModel.datasets,As.id),AW=As.stt===1,Ac=AG.getCellForNode(AI.td),AA=x.isSubtotalValue(Ac),AZ=As.otp,Al=As.ost,An=x.getCellTitleInfo(As),Af=AG.zonesModel,Ae=Af.id,u=Af.docModel,Ao=this.delegateActionToXtab,Ap=AG.isSingleContextMenuAttrSelection(),AB=AI.singleCellClick,AV=S.call(this),Ak=AG.getDEInfo(As),AS=Ak&&Ak.deObject,AD=Ak&&Ak.de,AJ=AD&&AD.t,Ah=x.isRecursiveAttribute(As.id||An.title.id),v=AG.isSingleContextMenuSelection(),AC=mstrmojo.desc(190,"Remove"),AO,AL,AK=!Aq||!u.isMDXDataset(Aq),Ar=AG.isInFilterPanel()&&mstrApp&&mstrApp.isInVFInteractMode,Ab={did:As.id||AS&&AS.did,t:AZ||AS&&AS.t,st:Al||AS&&AS.st,attId:AS&&AS.attId,ndetype:AS&&AS.ndetype},AT=Ab.attId&&E(As)&&x.getNDEFormsFromDataset(Ab.attId),t={n:As.n,did:As.id,t:Ab.t,st:Ab.st,ndeForms:AT},Aa={de:AD,ndeInfo:t,xtab:AG,data:As,cfg:AI,td:AI.td,singleClick:AB},AE=AG.isCustomSort;this.selectedNode=AI.td;if(AI.onClose){this.addPopupHandlers(AG.id,mstrmojo.emptyFn,AI.onClose);}if(!AA){if(AE){if(Ah&&!AW){p.call(this,As,Aa);}}else{if(Ar){this.addSortMenuItem(Aa);return ;}var AN=AG.model.getAttributeFormsInTemplate(As.id||An.title.id).length,w=As.fix;if(AN>1&&(!Ak||Ab.ndetype===D.DssRecursiveDerivedElement)){var z="pivot";var Aj=AS&&AS.t||AZ||"";var AF=!Ai&&!mstrApp.isInVFConfigMode&&v&&AJ===b.LIST;if(!Y(As)&&!E(As)&&!AF){w=An.title.fix||(Aa.data.fi||0)+1;z+="Form";}if(w&&!AW&&!mstrApp.isDossier){if(w>1){this.addMenuItem(mstrmojo.desc(5362,"Move Left"),"",function(){Ao(Aa,z,["l",Aj]);});}if(w<AN){this.addMenuItem(mstrmojo.desc(5363,"Move Right"),"",function(){Ao(Aa,z,["r",Aj]);});}this.addSeparator();}}if(Ah&&!AW){p.call(this,As,Aa);}if(!Ai&&!mstrApp.isInVFConfigMode){if(c(As)&&As.um){this.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){Ao(Aa,"derivedMetric",["edit"]);});}if(Y(As)){if(AG.getDerivedAttribute(As.id)&&AK){this.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){Af.editDerivedAttribute({item:{did:Ab.did,t:Ab.t,n:As.n}});});}}if(this.isActionAvailable(As,G.GROUP_EDIT)&&AS){this.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"",function(){Ao(Aa,"derivedElementsEdit",[Ak]);});}if(v&&AJ===b.CALCULATION&&!Ah){this.addSubMenuItem(mstrmojo.desc(12196,"Edit Calculation"),"",this.id,a,W.copy(Aa,{isEdit:true}));}}this.addSeparator();this.addSortMenuItem(Aa);if(AG.model.getAllDrillPathsForCell(As).length>1){this.addSeparator();}if(!Ai&&!mstrApp.isInVFConfigMode){if(v&&AJ===b.LIST){this.addSeparator();this.addMenuItem(mstrmojo.desc(13395,"Edit Group..."),"",function(){Ao(Aa,"derivedElementsEdit",Ak);});}if(v&&AJ===b.LIST){this.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"",function(){Ao(Aa,"removeQuickDE",Ak);});}if(v&&AJ===b.RESIDUE){this.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"",function(){Ao(Aa,"separateOthers",[AD]);});}if(Y(As)&&!Af.isDynamicLink(Ab)){this.addSeparator();if((!Aq||!o.isCGorCon(Ab,Aq))&&AK&&mstrmojo.resolveFeature(e.INSERT_NEW_METRIC)){this.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){Ao(Aa,"newDerivedAttribute");});this.addMenuItem(mstrmojo.desc(14717,"Create Links..."),"",function(){Ao(Aa,"newDynamicLinkAttr");});}if(this.isActionAvailable(As,G.GROUP_EDIT)&&!AS){this.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"",function(){Ao(Aa,"derivedElementsEdit",[Ak]);});}this.addSeparator();}}if(AG.isLinkedFilterEnabled&&AG.isLinkedFilterEnabled()){var s=function(){AG.handleContextMenuSelectionData(true);};this.addSeparator();this.addMenuItem(mstrmojo.desc(15070,"Go to Targets"),"",s);}if(!AW&&this.isActionAvailable(As,G.KEEP_ONLY)&&AV){this.addSeparator();var AQ=function(Au){return function(){Ao(Aa,"keepOnlyOrExclude",[Au]);};};if(!mstrApp.isInVFInteractMode){this.addMenuItem(mstrmojo.desc(11701,"Keep Only"),"",AQ(true));this.addMenuItem(mstrmojo.desc(3946,"Exclude"),"",AQ(false));}}if(!AW&&!(mstrApp.isInVFConfigMode||mstrApp.isInVFInteractMode)&&!Ah&&mstrmojo.resolveFeature(e.WEB_DRILL_AND_LINK)){this.addDrillMenuItem(Aa);}if(As&&As.mix===undefined&&An.isSrcTitle&&AZ!==-1&&AZ!==1&&!(AZ===47&&Al===12032)){this.addShowTotalMenuItem(Aa);}var AX=As.axis;if(!Ai){if(Af.shouldShowDisplayFormsMenu(Ab)){this.addPopupMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return o.getDisplayFormsMenu(Ab,AG,AG.model.docModel.datasets,function(Au){Af.submitDropZoneUpdates(Au);});});}this.addSeparator();if(!mstrApp.isInVFConfigMode&&(AB||Ap)&&this.isActionAvailable(As,m)&&P.call(this,Aa)&&mstrmojo.resolveFeature(e.INSERT_NEW_METRIC)){this.addMenuItem(mstrmojo.desc(1911,"Group"),"",function(){Ao(Aa,"derivedElementGroup");});}var Ad=l(AS)&&g.call(this,Aa,v,Ap);if(!!Ad.isAddToGroupSupported){this.addAddToGroupMenuItem(Aa.xtab,AS,Ad.group);}if(!mstrApp.isInVFConfigMode&&c(As)&&mstrmojo.resolveFeature(e.INSERT_NEW_METRIC)){var AR=AG&&AI.td&&AG.getCellForNode(AI.td)._e,Am={did:AR.oid,t:AR.otp},AU={zone:{id:-1,items:AG.model.data.gsi.mx},axis:AX,idx:As.idx,item:Am};this.addSeparator();if(u.findDatasetIdFromUnit(Am.did)&&!u.isFromSolrCube(Am.did)&&!u.isFromMDXCube(Am.did)){this.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",Ae,Af.getAggregateByMetricSubMenu,AU);this.addSeparator();}this.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",Ae,Af.getCalculationEditorCfg,AU);this.addSubMenuItem(mstrmojo.desc(12287,"Shortcut Metric"),"",Ae,Af.getShortcutMetricSubMenu,AU);this.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){Ao(Aa,"derivedMetric",["editNew"]);});}if(!c(As)&&!AZ&&mstrmojo.resolveFeature(e.INSERT_NEW_METRIC)){A.call(this,AI);}this.addSeparator();if(!AW){B.call(this,Aa);}if(c(As)||Y(As)){this.addThresholdMenuOptions(Aa);}}if(c(As)){this.addToggleMenuItem(mstrmojo.desc(6193,"Show Totals"),"",function(){Af.showQuickSubtotals();},function(){Af.hideDefinedSubtotals();},null,Af.hasVisibleSubtotals());}if(!AW&&this.isActionAvailable(As,G.KEEP_ONLY)&&AV&&!mstrApp.isDossier&&!AG.excludeData){this.addSeparator();this.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"",function(){mstrmojo.vi.ui.ViewDataDialog.open(AG.parent,true);});}var r=AG.gridData.gts,Ag,AP=[r.rowSubPos,r.colSubPos],AY,At;if(AW){At=AX===U;AY=AP[AX-1];if(AY===d){Ag=At?mstrmojo.desc(12206,"Move to Bottom"):mstrmojo.desc(13900,"Move to Right");AP[AX-1]=C;}else{Ag=At?mstrmojo.desc(12205,"Move to Top"):mstrmojo.desc(13901,"Move to Left");AP[AX-1]=d;}this.addMenuItem(Ag,"",function(){x.moveSubTotals(Aa,AP);});}if(this.isActionAvailable(As,G.TOTAL_HEADER)&&As.mix===undefined){AO=function(){Ao(Aa,"removeTotal");};}if(!Ai&&v){if(AJ===b.LIST){AL=function(){Ao(Aa,"renameDEList",Ak);};}else{if(AJ===b.CALCULATION&&!mstrApp.isInVFConfigMode){AL=function(){this.delegateActionToXtab(Aa,"editDECalculation");}.bind(this);AO=function(){this.delegateActionToXtab(Aa,"removeQuickDE",Ak);}.bind(this);AC=mstrmojo.desc(12197,"Delete Calculation");}}}this.addSeparator();}}if(!Ai&&!AE){var AM=AG.parent;if(AM.addFormatMenuItem){AM.addFormatMenuItem(this,{info:An,isMetricHeader:c(As)},function(Au){var Av=AG.highlightFormatTarget(Au,AW||AA);AG.openPopup(AG.edtModel.getFormattingToolbar(Au,AI.td,{onClose:function(){AG.restoreHighlights(Av);}}));});}}if(!AA&&!AE){if(((An&&An.isSrcTitle)||c(As))&&(!Ai||!!mstrmojo.resolveFeature(e.WEB_DRILL_AND_LINK))){this.addPopupMenuItem(mstrmojo.desc(14003,"Replace with"),Ae,Af.getReplaceSubMenu,"",{zone:Af.getZoneForObject(An.title.id||As.id),item:Ab});}if(AL){this.addMenuItem(mstrmojo.desc(2453,"Rename..."),"",AL);}if(AO&&!(Ah&&AJ===b.CALCULATION)){this.addMenuItem(AC,"",AO);}if(!Ai){if((An&&An.isSrcTitle)||c(As)){if(!AL){this.addMenuItem(mstrmojo.desc(2453,"Rename..."),"",function(){Ao(Aa,"renameUnit");});}if(!AO){this.addMenuItem(AC,"",function(){Ao(Aa,"removeUnit");});}}}var AH=W.walk("node.data.olm",AG)&&!(W.walk("node.data.rw.row.bc",AG)>0);if(AG.isCopySupported&&!AW&&!Y(As)&&!c(As)&&!AH){this.addSeparator();this.addMenuItem(mstrmojo.desc(14388,"Copy Rows"),"",function(){Ao(Aa,"copyRowsFromXtab",[AG.cmSelCells]);});}}this.supportsScroll=true;this.isHostedWithin=false;this.maxHeight=V.getMaxScrollHeight();},addAddToGroupMenuItem:function(u,s,t){var r=(s&&s.des)||[];this.addPopupMenuItem(mstrmojo.desc(14553,"Add to Group"),this.id,k,"",{xtab:u,deObject:s,groups:t?[t]:r});},addDrillMenuItem:function J(r){var v=r.xtab,u=r.data,s=v.model.getUnHiddenDrillPathsForCell(u),t=s.length;if(!(c(u)||u.mix!==undefined)){if(t>1){this.addSubMenuItem(mstrmojo.desc(145,"Drill"),"",this.id,q,r);}else{if(t===1){this._super(r,s[0]);}else{this.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}}}},getSubtotalEditorConfig:function H(s){var r=this._super(s),t=s.data,u=s.xtab;r.fnOk=u.getOnSubtotalsChangeFn(r,t);return r;},addThresholdMenuOptions:function L(s){var r=s.data._e||s.data,t={did:r.oid||r.id,t:r.otp,n:r.n};this.xtab.model.buildThresholdMenuOptions(this,{item:t},false,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models.EnumDragSources","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.models.DatasetDoubleClick","mstrmojo.vi.models._CheckDataCards","mstrmojo.vi.util.TemplateUtils");var U=mstrmojo.hash,k=mstrmojo.array,AA=mstrmojo.func,a=mstrmojo.vi.util.TemplateUtils,t=mstrmojo.vi.ui.DatasetUnitMenuUtils,X="00000000000000000000000000000000",l=mstrmojo.vi.models.EnumDragSources,W=mstrmojo.chart.model.enums.EnumDSSObjectType,d=mstrmojo.vi.enums.EnumFeatures,Y=mstrmojo.vi.viz.EnumDSSDropZones;var Z={ABOVE:0,ON:1,BELOW:2};mstrmojo.vi.models.DropZoneItemType=null;mstrmojo.vi.models.DropZoneType=null;mstrmojo.vi.models.DropZonesEditorConfigType=null;function J(AJ,AF,AH,AK,AN,AI,AL,AM){var AG={act:AJ,zoneId:AF,unitId:AH,unitType:AK};if(AN!==undefined){AG.unitPos=AN+1;}if(AM!==undefined){AG.is_disableonly=AM;}if(AI){AG.datasetId=String(AI);AG.datasetType=String(AL);}return AG;}function O(AF){return function(AG){var AH=[{t:AF,did:NaN}];return !!this.getAllowDropInfo(AG,AH,AG.items.length-1,Z.BELOW,{src:{data:{src:l.DATASETS}}}).allowedItems.length;};}mstrmojo.vi.models.DropZonesModel=mstrmojo.declare(mstrmojo.Obj,[mstrmojo.vi.models._CheckDataCards],{scriptClass:"mstrmojo.vi.models.DropZonesModel",hostId:"",docModel:null,getDropZones:mstrmojo.emptyFn,getDZFlatStruct:function L(){var AI=this.getHost().model.data,AJ=AI.gsi||{},AF=(AJ.rows||[]).concat(AJ.cols||[]),AH={},AG={};AF.forEach(function(AK){if(AK.hasOwnProperty("st")&&AK.hasOwnProperty("did")){AH[AK.did]=AK.st;}});if(AI.dz){Object.keys(AI.dz).forEach(function(AM){var AK=AI.dz[AM],AL=(AK.TemplateUnit||[]).concat(AK.TemplateMetric||[]);AL.forEach(function(AN){var AO=AN.id;if(AN.st===undefined&&AH.hasOwnProperty(AO)){AN.st=AH[AO];}});AG[AM]=AL;});}return AG;},getAvatarIconClass:function c(){throw new Error(this.scriptClass+" must implement getAvatarIconClass method.");},canSwapAxis:function s(){return false;},swapAxis:function A(){if(this.canSwapAxis()){throw new Error(this.scriptClass+" must implement swapAxis method if this.canSwapAxis returns true.");}},canDefineSubtotals:function(){var AF=this.getHost();if(AF&&AF.GMController&&AF.GMController.isWaterfall){return true;}return false;},hasVisibleSubtotals:function j(){var AF=this.getHost();return AF.getWidgetPropertyValue("totalShw")||(AF.getWidgetPropertyValue("intSumShw")&&AF.GMController.hasAttributesInDropzone("BreakBy"));},showQuickSubtotals:function I(){var AF=this.getHost();AF.writeGlobalProperty("totalShw:intSumShw",true);},hideDefinedSubtotals:function z(){var AF=this.getHost();AF.writeGlobalProperty("totalShw:intSumShw",false);},getZoneMenuItems:function v(AG,AF){},getUnitMenuItems:function n(AG,AF,AI,AH){},getMultiUnitsMenuItems:function h(AG,AF,AH){var AI=this.id;if(!mstrApp.isInVFConfigMode&&t.getMultiSelectionShortcutMetricFunctions(AH).length&&mstrmojo.resolveFeature(d.INSERT_NEW_METRIC)){AG.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",this.id,function(){return mstrmojo.all[AI].getMultipleMetricsCalcMenus(AF,AH,true);});}AG.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[AI].deleteItems(AF,AH);});},deleteItem:function K(AG,AF){this.throwAbstractMethodError("deleteItem");},deleteItems:function K(AF,AG){this.throwAbstractMethodError("deleteItems");},addZoneItem:function g(AH,AI){AH.t=AH.t||4;if(AH.did===undefined){AH.did=AH.id;}var AF=a.findUnitsById(this.getHost().model.data.gsi,AH.did)[0];if(AF){U.copyProps(["n","um"],AF,AH);}var AG=this.docModel.datasets,AK=false,AJ=AH.t===4?"mx":"att";Object.keys(AG).every(function(AL){(AG[AL][AJ]||[]).every(function(AN){if(AN.did===AH.did){AK=true;var AO,AM=AN.n;for(AO in AN){if(!AH.hasOwnProperty(AO)){AH[AO]=AN[AO];}}if(AM!==AH.n){AH.objectNameinDataset=AM;}}return !AK;});return !AK;});AI.push(AH);},getZone:function u(AK,AJ,AI,AF,AG){var AH=[];(AI||[]).forEach(function(AL){this.addZoneItem(U.copy(AL),AH,AG);},this);return{n:AK,id:AJ,enabled:!AF,cssClass:(AG&&AG.allowSingle)?"singleUnitZone":"",getDropIconCls:function(){return"pivot";},title:(AG&&AG.title)||"",items:AH};},getZoneForObject:function R(AG){var AF=null;this.getDropZones().zones.every(function(AH){if(k.find(AH.items,"did",AG)>-1){AF=AH;return false;}return true;});return AF;},getUnitIndexInZone:function r(AF,AG){return k.find(AF.items,"did",AG.did);},isZoneDropAllowed:function V(AF){if(!AF.enabled){return false;}return true;},getAllowDropInfo:function C(AG,AH,AF,AI){return{allowedItems:AH.concat(),removeReplaced:AI===Z.ON&&AG&&AG.items&&AG.items[AF]&&k.find(AH,"did",AG.items[AF].did)===-1};},getTargetEdgePortion:function P(AF){return 0.33;},allowInsertNewMetric:O(4),allowInsertNewAttribute:O(12),unitsDropped:function AB(AF,AG,AH,AJ,AI){if(this.unitDropped!==mstrmojo.vi.models.DropZonesModel.prototype.unitDropped){return this.unitDropped(AF,AG,AH.idx,AH.edge,AJ,AI);}this.throwAbstractMethodError("unitsDropped");},getHost:function e(){return mstrmojo.all[this.hostId];},getHostModel:function B(){this.throwAbstractMethodError("getHostModel");},shouldMetricNameShowIcon:function AE(){return true;},addUnitsFromDataSource:function H(AM,AK,AI,AG){var AN=this,AR=AN.docModel,AJ=AR.controller,AF;AI=AI||[];var AH=false,AQ=this.getHost(),AL=[],AS;[].concat(AM).forEach(function(AT){AS=this.isMetric(AT);AH=AS||AH;AF=mstrmojo.vi.models.DatasetDoubleClick.addObject(AT,AK,this);AI=AI.concat(AF);if(AS){AL.push(AT);}},this);if(AI&&AI.length){if(AH&&AF&&AF[0].actions){AF[0].actions.push(AQ.model.getValuesDefaultFormatGridZoneAction(AL,true));}var AP=AJ._getXtabCallback(this.getHost());if(AG){AP=AA.wrapMethods(AG,AP);}var AO=function(){AR.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:AI,zm:AN},function(){AI=AR.wrapUnsetVisualizationFilterAction(AI);return AJ.submitUndoRedoUpdates(AI,{},AP);},function(){return AJ.submitUndoRedoUpdates(AI,{},AP);});};if(this.existLargeOrManyItems()){this.warnAndExecCallBackForAddUnits(function(){AO();});return ;}if(this.getHost().isOutlineMode){this.warnAndExecCallBackForOutlineAddUnits(function(){AO();});return ;}AO();}},changeZoneUnits:function q(AG,AF,AH){},getZoneAddCandidates:function b(AF){return[];},getRequiredItemsInfo:function m(AG){if(!AG){return 0;}var AF=[];this.getDropZones().zones.forEach(function(AH){AF=AF.concat(AH.items);});return Number(AF.reduce(function(AH,AI){if(parseInt(AI.did,10)!==-1&&AI.t===AG){return AH+1;}return AH;},0));},getUpdateCallback:function S(){var AF=this.id;return{success:function(){var AJ=mstrmojo.all[AF];if(!AJ){return ;}var AL=AJ.getHost();if(!AL){return ;}var AK=mstrmojo.all.visualizationFilterToolbar,AI=AJ.docModel,AN,AH,AM,AG;if(mstrApp.isInVFConfigMode){AN=AL.zonesModel;AL.parent.selectVIUnit(true);AG=AN&&AN.isTemplateContainAttCategoryItem();mstrApp.isEnableSaveBtn=AG;AK.toggleSaveBtn(AG);}else{AH=AL.parent&&AL.parent.k;AM=AI.getPanel().getUnitByKey(AH);if(AM){AM.selectVIUnit(true);}}}};},getUpdateTemplateAction:function N(AF,AG){return this.docModel.getDataService().getUpdateTemplateAction(AG||this.getHost().k,AF);},getReplaceCandidates:function M(AI,AN){var AJ=[],AH=AN.t,AF=AN.did,AG=this.getHostModel().datasetId,AL=AI.id===Y.AdditionalMetrics,AM=this.getHost(),AK=AM.getChartStyle&&AM.getChartStyle()==="NewGraphMatrixVisualizationStyle";this.getDropZones().zones.forEach(function(AO){((AO&&AO.items)||[]).forEach(function(AQ){var AR=AQ.t,AP=AQ.did;if(AR!=undefined&&AP!=undefined&&AR!==21&&AP!=="-1"&&AP!==X&&((AR===4&&AH===4)||(AR!==4&&AH!==4))&&AP!==AF&&k.find(AJ,"did",AP)===-1){AJ.push(AQ);}});});if(!AK||!AL){if(AG){this.docModel.getDatasetUnits(AH===4?["mx"]:["att"],null,AG).forEach(function(AO){if(k.find(AJ,"did",AO.did)===-1&&AO.did!==AF&&!AO.hide&&!AM.model.hasSameRecursiveAttributeGroup(AO,AM.gridData,AN)){AJ.push(AO);}});}}return t.getSortedDatasetUnits(AJ);},getDropTargetIndex:function E(AG,AI){var AF=AI.idx,AH=(AI.edge===Z.ON&&!AI.removeReplaced)?Z.BELOW:AI.edge,AK=AF,AJ=this,AL={};AI.allowedItems.forEach(function(AN){var AM=AJ.getUnitIndexInZone(AG,AN);if(AM!==-1){AL[AM]=AN;}});U.forEach(AL,function(AN,AO){var AM=parseInt(AO,10);if(AM<AF){AK--;}else{if(AM===AF){AH=Z.ON;}}});return AH===Z.BELOW?(AK+1):AK;},getAddDropZoneUnitAction:function p(AG,AI,AF,AH){return J("addDropZoneUnit",AG.id,AI.did,AI.t,AF,AH&&AH.datasetId,(AH&&AH.datasetType)||W.DssTypeReportDefinition);},getAddDropZoneUnitsActions:function AD(AG,AH,AF,AI){return AH.reverse().map(function(AJ){return J("addDropZoneUnit",AG.id,AJ.did,AJ.t,AF,AI&&AI.datasetId,(AI&&AI.datasetType)||W.DssTypeReportDefinition);});},getRemoveDropZoneUnitActions:function G(AJ,AN,AL){if(AL===undefined||AL===null){AL=1;}var AG=[];if(AJ.id===Y.ColorBy&&this.isMetric(AN)){var AF=AN.id||AN.did;var AI=this.getHostModel(),AK=AI&&AI.gsi,AM=AK&&AK.thresholds&&AK.thresholds[AF]||[];for(var AH=AM.length-1;AH>=0;AH--){AG.push({act:"clearThreshold",unitId:AF,unitType:AN.t,tid:AM[AH].tid});}}if(AN){AG.push(J("removeDropZoneUnit",AJ.id,AN.did,AN.t,undefined,undefined,undefined,AL));}return AG;},checkAndAddThresholdAction:function x(AH,AF,AG){return false;},getAllZones:function(){return this.getDropZones().zones||[];},getClearAllUnitsActions:function Q(){var AF=[];(this.getAllZones()).forEach(function(AG){((AG&&AG.items)||[]).forEach(function(AH){Array.prototype.push.apply(AF,this.getRemoveDropZoneUnitActions(AG,AH));},this);},this);return AF;},getClearAllUnitsUnTemplateActions:function f(){return[];},clearAllDropZones:function w(AJ){var AG=this.docModel,AI=this,AF=AI.getAllZones().filter(function(AL){return AL&&AL.items&&AL.items.length;}).map(function(AL){return AL.id;}),AH=function(){AJ=AJ||{actions:[]};AJ.actions=AG.wrapUnsetVisualizationFilterAction(AJ.actions);AI.clearAllDropZonesDeferred(AJ);},AK=function(){AI.clearAllDropZonesDeferred(AJ);};return AG&&AG.checkAndNotifyVFChangeOnClearAll({zm:AI,ca:AF,cmb:true},AH,AK);},clearAllDropZonesDeferred:function D(AO){var AH=this.getClearAllUnitsActions(),AJ=this.getClearAllUnitsUnTemplateActions(),AQ=this.getHost(),AM=AQ.id,AI=AQ.gridData||AQ.model.data||AQ.node.data,AL=AI.vlexpr,AR=this.docModel,AG=AQ.model,AK=AR.controller,AN=AA.wrapMethods({success:function(){var AS=mstrmojo.all[AM];if(AS._viSelections){AS.clearSelections();AS.endSelections();}}},AK._getXtabCallback(AQ),{success:function AP(){mstrmojo.all[AM].raiseEvent({name:"regenerateToolbar"});}}),AF=AG.getKeepOnlyActionsForAssociatedNodes([],AN);if(AL){AF.actions.push(AK.dataService().getUpdateTemplateAction(AQ.k,AG.getRemoveMetricLimitsAction(AL)));}if(AO){AO.actions=[].concat(AO.actions).concat(AF.actions);AO.callback=AA.wrapMethods(AO.callback,AF.callback);}else{AO=AF;}if(AJ&&AJ.length>0){AO.actions=AO.actions.concat(AJ);}this.submitDropZoneTemplateUpdates(AH,AO);},submitDropZoneUpdates:function o(AL,AM,AH){var AJ=this.getHost(),AG=this.docModel,AF=AG.controller,AI=[].concat(AL||[]);if(AI&&AI.length){var AK=AM||AF._getXtabCallback(AJ);AF.cmdMgr.execute({execute:function(){this.submit(AI,AK,AH);},urInfo:{callback:AK}});}},submitDropZoneTemplateUpdates:function F(AF,AH){var AG=(AF&&AF.length)?[this.getUpdateTemplateAction(AF)]:[];if(AH&&AH.actions){AG=AG.concat(AH.actions);}this.submitDropZoneUpdates(AG,AH&&AH.callback,AH&&AH.extras);},getHighlightTargets:function AC(AG,AF){return[AF];}});mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION=Z;mstrmojo.vi.models.DropZonesModel.ENUM_REQUIREMENT_TYPE={ATTRIBUTE:12,METRIC:4,LONGITUDE:"long",LATITUDE:"lat"};}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.ui.SearchablePulldown","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.DataGrid");var B=" ReplaceObjectEditor-item ",L={REMOVE:1,KEEP:2,NO_REPLACE:3},F=mstrmojo.hash,H=mstrmojo.array,M=mstrmojo.string,A=mstrmojo.vi.ui.DatasetUnitMenuUtils,I="did";function E(O){return O.t===47&&O.st===12033;}function K(R,Q){var O=[],P=function(S){return H.find(R.cubes,"did",S)>-1;};if(R.da||R.um||R.de||E(R)){O.push({n:mstrmojo.desc(11832,"Keep existing definition"),did:L.KEEP,cls:B});}if(!Q.source.all&&R.cubes.length>1&&!(R.cubes.length===2&&P(Q.source.did)&&P(Q.target.did))){O.push({n:mstrmojo.desc(11834,"Do not replace"),did:L.NO_REPLACE,cls:B});}O.push({n:(typeof (mstrApp)!=="undefined"&&mstrApp.pageName==="rwd")?mstrmojo.desc(14556,"Remove from document"):mstrmojo.desc(15472,"Remove from dossier"),did:L.REMOVE,cls:B});return O;}function C(U,P){var O={id:null,n:null,k:null,nr:null,r:null},S,R,Q;for(Q=0;Q<P.length;Q++){S=P[Q];R=S.did;if(S.did===U.did){O.id=S;break;}else{if(!O.n&&S.n===U.n){O.n=S;}else{switch(S.did){case L.KEEP:O.k=S;break;case L.NO_REPLACE:O.nr=S;break;case L.REMOVE:O.r=S;break;}}}}return O.id||O.n||O.k||O.nr||O.r;}function N(O){return" ReplaceObjectUnit-icon ReplaceObjectUnit-"+A.getUnitCssClass(O)+" ";}function D(R,Q,P){var O=R.map(function(S){return S[Q];});return O.join(P);}mstrmojo.vi.ui.ReplaceObjectEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.ReplaceObjectEditor",source:null,target:null,conciliation:{},clearaf:false,showUnitTooltip:false,onOk:mstrmojo.emptyFn,onCancel:mstrmojo.emptyFn,onBack:mstrmojo.emptyFn,title:mstrmojo.desc(11674,"Replace Objects"),help:"replace_objects_dialog_box.htm",cssClass:"mstrmojo-ReplaceObject",getResizeHandler:function J(){var P=this,O=this._super();return mstrmojo.func.composite([O,function(){(P.dataGrid.ctxtBuilder.itemWidgets||[]).forEach(function(R){var Q=R.newObjSelector.selector.getPopupWidget();if(Q.visible){Q.adjustCornersForPopupOverflow();}});}]);},setUnits:function(Q){var P=this;["source","target"].forEach(function(R){if(Q[R]){P[R]=Q[R];}});this.conciliation={};var O=F.cloneArray(this.target.units);H.forEach(O,function(R){R.cls=(R.cls||"")+N(R)+B;});this.dataGrid.set("tgtitems",O);this.dataGrid.set("items",F.cloneArray(this.source.units));this.dataGrid.updateScrollbars();},onPreClose:function(){this.onCancel();return true;},onClose:function(){this.unrender();},children:[{scriptClass:"mstrmojo.Label",cssClass:"ReplaceObject-ExplainText",text:(typeof (mstrApp)!=="undefined"&&mstrApp.pageName==="rwd")?mstrmojo.desc(14554,"Replace or remove objects currently used in the document."):mstrmojo.desc(15485,"Replace or remove objects currently used in the dossier.")},{scriptClass:"mstrmojo.DataGrid",alias:"dataGrid",cssClass:"ReplaceObject-DataGrid",columns:[{headerText:mstrmojo.desc(11675,"Current Objects"),headerCss:"left-unit",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{text:"this.data.n",cssClass:function(){return N(this.data)+" left-unit ReplaceObject-Unit ";},useRichTooltip:"!!this.parent.dataGrid.parent.showUnitTooltip"},updateTooltipConfig:function(){var P=this.parent.dataGrid.parent.source.units,O=this.data;if(P.some(function(Q){return(Q.n===O.n)&&(Q.did!==O.did);})){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",top:28,refNode:this.domNode,content:this.data.n+" ("+D(this.data.cubes,"name",", ")+")"};}else{this.richTooltip=null;}}}},{headerText:mstrmojo.desc(11676,"New Objects"),dataWidget:{scriptClass:"mstrmojo.HBox",alias:"newObjSelector",children:[{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"selector",hostedCSSClass:"ReplaceObject-Pulldown-Popup",isHostedWithin:false,getPopupConfig:function(){var O=this.constructor.prototype.getPopupConfig.call(this);O.popupHandlers[this.list.id]={open:function(){var P=this.domNode;if(P.parentNode){P.parentNode.removeChild(P);}}};return O;},onitemSelected:function(O){this.selectedNode.className="mstrmojo-ui-Pulldown-text "+(O.cls||"");},postCreate:function(){var U=this.parent.data;var P=[];var R=this.parent.dataGrid.parent;var O=this.parent.dataGrid;P=mstrmojo.array.filter(O.tgtitems,function(V){return V.t===U.t&&!(E(U)&&U.did===V.did);});if(P.length){P[P.length-1]=F.clone(P[P.length-1]);P[P.length-1].cls+=" ReplaceObjectEditor-item-delimeter-above ";}var Q=K(U,R);if(Q.length){Q[0].cls+=" ReplaceObjectEditor-item-delimeter-below ";}P=P.concat(Q);var S=C(U,P);this.set("items",P);this.selectedIndex=H.find(P,I,S[I]);},postselectedIndexChange:function G(){var P=this.parent.data,Q=this.items[this.selectedIndex];var O=this.parent.dataGrid.parent;O.conciliation[P[I]]={source:P,target:Q};}}]}}]},{scriptClass:"mstrmojo.Box",cssClass:"ReplaceObject-overwrite",children:[{scriptClass:"mstrmojo.CheckBox",label:(typeof (mstrApp)!=="undefined"&&mstrApp.pageName==="rwd")?mstrmojo.desc(14555,"Clear object alias and number format on document"):mstrmojo.desc(15473,"Clear object alias and number format on dossier"),bindings:{checked:"this.parent.parent.clearaf"},oncheckedChange:function(){var O=this.isChecked();this.parent.parent.set("clearaf",O);}}]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var S=this.parent.parent,R=[],a={},W=[],O={},Q={};F.forEach(S.conciliation,function(d){var c=d.target,b=d.source;a[b[I]]={source:b,target:c};if(c[I]===L.REMOVE){var e=b.dependentObjects;if(e){e.forEach(function(f){W.push({dependOn:b,dependent:f});});}}});W.forEach(function(c){var e=c.dependOn,d=c.dependent,f=a[d.did],b=f.target;if(b[I]!==L.REMOVE){f.target={ID:L.REMOVE};Q[d.did]=d;O[e.did]=e;}});F.forEach(a,function(e){var d=e.target,c=e.source;function b(g,f){if(c.cont_did){g.srcContDid=c.cont_did;g.srcContType=c.cont_tp;}if(f&&f.cont_did){g.tgtContDid=f.cont_did;g.tgtContType=f.cont_tp;}return g;}switch(d[I]){case L.REMOVE:R.push(b({srcid:c[I],srct:c.t}));break;case L.KEEP:case L.NO_REPLACE:break;default:R.push(b({tgtid:d[I],tgtt:d.t,srcid:c[I],srct:c.t},d));}});var P=F.valarray(O),X=F.valarray(Q),V=function V(){S.onOk(R,S.clearaf);S.close();};if(X.length){var Y=P.length,U=Y>=2?mstrmojo.desc(13367,"### and ##").replace("###",P.slice(0,Y-1).map(function(b){return M.encodeHtmlString(b.n);}).join(", ")).replace("##",M.encodeHtmlString(P[Y-1].n)):M.encodeHtmlString(P[0].n),Z=mstrmojo.desc(13368,"Deleting ## will result in removal of the following dependent objects:").replace("##",U)+"</br>"+X.map(function(b){return M.encodeHtmlString(b.n)+"</br>";}).join("")+mstrmojo.desc(13369,"Do you wish to continue?");mstrmojo.warn(Z,{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){V();}},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:function(){S.open();}}},{cssClass:"removeDependentConfirm",onPreClose:function(){S.open();return true;}});}else{V();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.onCancel();this.parent.parent.close();}}]});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.DatasetUnitMenuUtils");var A=mstrmojo.vi.ui.DatasetUnitMenuUtils;mstrmojo.vi.ui._CanDropFromSchema=mstrmojo.provide("mstrmojo.vi.ui._CanDropFromSchema",{_mixinName:"mstrmojo.vi.ui._CanDropFromSchema",augmentDropContextForSchema:function B(E,C){var F=E.getCtxtDragData();if(F.src===mstrmojo.vi.models.EnumDragSources.ALL_OBJECT_LIST){var D=A.getCfgForAddUnitFromAllObject(F.items,C.datasets||{});F.dsid=D.dsid;if(D.actions.length){E.actions=D.actions;E.callback=C.getDatasetsUpdateCallback();}}}});})();(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.Label","mstrmojo.hash","mstrmojo.array","mstrmojo.ui.Checkbox","mstrmojo.css","mstrmojo.string","mstrmojo.threshold.ThresholdExprTree","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.models.FormatModel.getFormatUpdate","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL","mstrmojo.vi.util.NumberFormatUtility");mstrmojo.requiresDescs(2869,3397,5893,7978,7979,13788,13789,13790,13894,14599,14600,14601,14611);var M=mstrmojo.hash,I=mstrmojo.array,U=mstrmojo.css,B=mstrmojo.string,A=mstrmojo.models.FormatModel.decodeValue,J=mstrmojo.threshold.ThresholdModel.REPLACE_SYMBOL,D=mstrmojo.vi.ui.DatasetUnitMenuUtils,K=12,L=mstrmojo.models.FormatModel.ENUM_NUMBER_FORMAT_KEYS_OBJ,N=mstrmojo.vi.util.NumberFormatUtility;function S(W){this.threshold.scope=W;}function C(c,X,W,b){var Y=this.previewNode;switch(c){case 10:var a=I.filterOne(J,function(d){return d.v===X;});if(a){Y.innerHTML=a.n;}break;case 4:U.addClass(Y,"hasImage");Y.innerHTML='<img class="replaceImg" src="'+B.encodeHtmlString(X)+'" />';break;default:var Z=B.encodeHtmlString(X)||(W===K?mstrmojo.desc(14611,"Sample"):"1234.567");if(!!b){Z=N.applyFormatToNumber(b,Z);}Y.innerHTML=Z;}}function E(Y,W){W.fontFamily="'"+(Y.ff||"").replace(/\'/g,"")+"'";W.fontSize=parseInt(Y.fsz,10)+"pt";W.fontWeight=Y.fw?"bold":"normal";W.textDecoration=(Y.fun?"underline":"")+" "+(Y.fst?"line-through":"");W.fontStyle=Y.fit?"italic":"";W.color=Y.fc;var X;if(!!Y.bc&&!!Y.bc.c1){X=U.buildGradient(Y.bc.or,Y.bc.c1,Y.bc.c2);if(X&&X.n){W[X.n]=X.v;}}else{if(!!Y.gdc){X=U.buildGradient(Y.gda===90?0:1,Y.bc,Y.gdc);if(X&&X.n){W[X.n]=X.v;}}else{W.backgroundColor=Y.bc;}}W.textAlign=Y.alh;W.verticalAlign=Y.alv;W.wordWrap=Y.atw;W.direction=Y.atd;var Z=Y.bts;W.border=Y.borderStyle||(Z?A("bts",Z):"1px dotted");W.borderColor=Y.borderColor||Y.btc||"#e1e1e1";}mstrmojo.threshold.ThresholdRow=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.threshold.ThresholdRow",markupString:'<div id="{@id}" class="mstrmojo-thresholdRow cf {@cssClass}" style="{@cssText}" mstrAttach:click><div class="draggable-icon"></div><div class="container"></div><div class="previewWrap"><div class="preview"></div></div><div class="menu"></div><div class="delete"></div></div>',markupSlots:{containerNode:function P(){return this.domNode.children[1];},draggableNode:function O(){return this.domNode.firstChild;},previewNode:function P(){return this.domNode.children[2].firstChild;},menuNode:function P(){return this.domNode.children[3];},deleteNode:function G(){return this.domNode.children[4];}},threshold:undefined,idx:undefined,editor:undefined,model:undefined,lblIndex:undefined,chkBox:undefined,exprTree:undefined,postBuildRendering:function R(){this.destroyChildren(false);var W=this.threshold,X=this.model,Y=this.previewNode.style,a=M.copy(W.fmt,M.clone(X.getGridValueFormat())),Z=W.expr;C.call(this,W.rtp,W.rtxt,X.objectType,a.nfs);if(a){E(a,Y);}this.destroyChildren(false);this.addChildren([{scriptClass:"mstrmojo.Label",alias:"lblIndex",text:this.idx+1},{scriptClass:"mstrmojo.threshold.ThresholdExprTree",alias:"exprTree",editor:this.editor,model:this.model,items:[Z]}]);X.attachEventListener("selectedThresholdsChange",this.id,"onselectedThresholdsChange");return this._super();},onselectedThresholdsChange:function Q(){},onclick:function V(Z){var X=this.editor,b=Z.getTarget(),Y=this,W=this.model,a=X.objectType===K;if(b===this.deleteNode){this.removeFromModel();}else{if(b===this.menuNode){var c=new mstrmojo.ui.menus.MenuConfig();c.hostId=this.id;c.hostElement=this.menuNode;c.isHostedWithin=false;c.addSubMenuItem(mstrmojo.desc(13788,"Apply to"),"",X.id,function(){var d=new mstrmojo.ui.menus.MenuConfig();d.addRadioMenuGroup(Y.threshold.scope||1,S,[{value:1,text:a?mstrmojo.desc(14599,"Element Rows Only"):mstrmojo.desc(13789,"Metric Only")},{value:2,text:a?mstrmojo.desc(14600,"Subtotal Rows Only"):mstrmojo.desc(13790,"Subtotals Only")},{value:3,text:a?mstrmojo.desc(14601,"Elements and Subtotals"):mstrmojo.desc(13894,"Metric and Subtotals")}],"",Y,true);return d;});c.addMenuItem(mstrmojo.desc(2869,"Formatting"),"",function(){X.openPropertyPanel(Y);});if(W.showNumberFormat()){c.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),"",function(){var d=function(e){M.forEach(e,function(g,f){if(!Y.threshold.fmt){Y.threshold.fmt={};}Y.threshold.fmt[f]=g;});Y.model.raiseEvent(M.copy(Y.model,{name:"modelEdit"}));};return D.getNumberFormatEditor(Y,Y.threshold.fmt||{},function(f){var e={};e[L.CATEGORY]=f.category||-3;e[L.CURRENCY_POSITION]=f.currencyPosition||0;e[L.CURRENCY_SYMBOL]=f.currencySymbol||"$";e[L.DECIMAL_PLACES]=f.decimalPlaces||2;e[L.FORMAT]=f.format||"";e[L.NEGATIVE_NUMBERS]=f.negativeNumbers||3;e[L.THOUSAND_SEPARATOR]=f.thousandSeparator||0;d(e);});});}c.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"",function(){W.duplicateThreshold(Y.idx);});if(this.idx!==0){c.addMenuItem(mstrmojo.desc(7978,"Move Up"),"",function(){W.moveThreshold(Y.idx,Y.idx-1);});}else{c.addNonInteractiveMenuItem(mstrmojo.desc(7978,"Move Up"),"",true);}if(this.idx!==W.thresholds[W.metricId].length-1){c.addMenuItem(mstrmojo.desc(7979,"Move Down"),"",function(){W.moveThreshold(Y.idx,Y.idx+1);});}else{c.addNonInteractiveMenuItem(mstrmojo.desc(7979,"Move Down"),"",true);}c.addMenuItem(mstrmojo.desc(5893,"New Condition"),"",function(){Y.exprTree.newCondition(null);});this.openPopup(c.newInstance());}else{if(b===this.previewNode||b===this.previewNode.firstChild){X.openPropertyPanel(this);}}}},removeFromModel:function F(){this.model.deleteThreshold(this.threshold);},onpropertyModelChange:function H(W){M.copy(W.threshold,M.clear(this.threshold));this.refresh();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.Box","mstrmojo.ui.CheckList","mstrmojo.DataGrid","mstrmojo.hash","mstrmojo.models.FormatModel","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.func","mstrmojo.array","mstrmojo.dom");var J=mstrmojo.hash,f=mstrmojo.array,C=mstrmojo.css,V=mstrmojo.Button.newWebButton,n=mstrmojo.ui.Pulldown.newPulldown,j=mstrmojo.models.FormatModel.getFormatUpdate,a=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,d=mstrmojo.vi.ui.DatasetUnitMenuUtils,H,I=mstrmojo.dom;var B=1,k=2,G=3,D="480px",g="visfilter";var E=[{n:mstrmojo.desc(6031,"Off"),v:"0"},{n:mstrmojo.desc(6030,"On"),v:"1"},{n:mstrmojo.desc(8504,"Form name only"),v:"2"},{n:mstrmojo.desc(8505,"Show attribute name once"),v:"3"},{n:mstrmojo.desc(4531,"Automatic"),v:"4"}],Z=[{n:mstrmojo.desc(13786,"Show both nulls and zeros"),v:"-1"},{n:mstrmojo.desc(13787," Hide both nulls and zeros"),v:"2"},{n:mstrmojo.desc(9845,"Hide nulls only"),v:"0"},{n:mstrmojo.desc(9846,"Hide zeros only"),v:"1"}],N=[{n:mstrmojo.desc(13544,"Last selection only"),v:0},{n:mstrmojo.desc(13545,"Intersection of all selections"),v:1}],h=[{n:mstrmojo.desc(959,"Default"),v:"-1",title:mstrmojo.desc(959,"Default")},{n:mstrmojo.desc(9640,"Inner Join"),v:"0",title:mstrmojo.desc(9640,"Inner Join")},{n:mstrmojo.desc(9641,"Outer Join"),v:"1",title:mstrmojo.desc(9641,"Outer Join")}],M=[{n:mstrmojo.desc(959,"Default"),v:"-1",title:mstrmojo.desc(959,"Default")},{n:mstrmojo.desc(13177,"Inner Join"),v:"0",title:mstrmojo.desc(13178,"Results displaying only those attribute elements that have metric value")},{n:mstrmojo.desc(13179,"Outer Join - Ignore Filter"),v:"2",title:mstrmojo.desc(13180,"Outer join to attribute's look up table without considering the filter on template")},{n:mstrmojo.desc(13181,"Outer Join - Preserve Filter"),v:"3",title:mstrmojo.desc(13182,"Outer join to attribute's look up table after considering the filter on template")}];var c={"-1":mstrmojo.desc(959,"Default"),"0":mstrmojo.desc(9640,"Inner Join"),"2":mstrmojo.desc(13179,"Outer Join - Ignore Filter"),"3":mstrmojo.desc(13181,"Outer Join - Preserve Filter")},W={"-1":mstrmojo.desc(959,"Default"),"0":mstrmojo.desc(9640,"Inner Join"),"1":mstrmojo.desc(9641,"Outer Join")};var U;var e=false;function P(t,q,p,s){var r={scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",col1Width:t,col2Width:q,children:p};return J.copy(s,r);}function Q(q,r,p){return J.copy(p,{scriptClass:"mstrmojo.Label",slot:r,text:q});}function F(s,p){return[Q(s,"col1Node",{cssClass:"subTitle"}),{scriptClass:"mstrmojo.ui.CheckList",orientation:"h",slot:"col2Node",preBuildRendering:function q(){var w=mstrmojo.all[H].data[p],t=this.items,v=this.selectedIndices;if(w){f.forEach(t,function(z,x){v[x]=w[z.id]==="-1";});}var u=mstrmojo.all[H].olm;if(!!u&&p==="rows"){this.items[1].css="disabled";}else{this.items[1].css="";}},postselectionChange:function r(t){var v=this.items,u=[t.added,t.removed];u.forEach(function(x,w){if(x&&x.length>0){j(p+v[x[0]].id,w===0?"-1":"0",mstrmojo.all[H].newData);}});},items:[{n:mstrmojo.desc(2969,"Show"),id:a.SHOW_HEADER},{n:mstrmojo.desc(1095,"Merge"),id:a.MERGE_HEADER,css:""},{n:mstrmojo.desc(2970,"Lock"),id:a.LOCK_HEADER}]}];}function S(){var q=H.split("-"),p=q.length;if(!mstrApp.isInVFConfigMode&&q[p-1]===g){q.splice(q.length-1,1);}else{if(mstrApp.isInVFConfigMode&&q[p-1]!==g){q.splice(q.length,1,g);}}H=q.join("-");}function X(q){S();var p=mstrmojo.all[H];if(q){p.update=p.update.actions?p.update:{actions:[]};p.update.actions=p.update.actions.concat(mstrmojo.hash.valarray(p.joinActions));p.update.callback=mstrmojo.func.wrapMethods(p.update.callback,p.host.parent.model.getRebuildCallback());if(p.SelectionLimitSection&&p.limitVal){p.host.writeGlobalProperty("slctnLmt",p.limitVal);}p.submitAction(p.newData,p.update.actions,p.update.callback,p.update.extras);}p.newData=p.update={};p.joinActions={};p.close();}function O(q){var t=q.parent.data,r=mstrmojo.all[H],p=r.host.k,s=r.host.controller,u=new mstrmojo.ui.menus.MenuConfig();r.joinActions=r.joinActions||{};if(t.did==="AllAttr"){M.forEach(function(v){u.addMenuItem(v.n,"",function(){q.parent.jtValue.set("text",v.n);t.v=v.v;t.dv=v.n;r.joinActions.AllAttr=s.dataService().getSetAttributesJoinTypeAction(p,v.v);});});}else{h.forEach(function(v){u.addMenuItem(v.n,"",function(){q.parent.jtValue.set("text",v.n);t.v=v.v;t.dv=v.n;r.joinActions[t.did]=s.dataService().getSetMetricJoinTypeAction(p,t.did,t.dt,t.t,v.v);});});}u.hostId=H;u.isHostedWithin=false;u.hostElement=q.domNode;u.menuCssClass="joinbehavior";u.setAlignment(3,2);r.openPopup(u.newInstance());}mstrmojo.vi.ui.editors.MoreOptionsEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.vi.ui.editors.MoreOptionsEditor",host:undefined,showHeadersSection:false,showSelectionLimitSection:false,data:undefined,lockHeadersCase:undefined,update:undefined,newData:undefined,joinActions:undefined,cssClass:"mstrmojo-MoreOptions-Editor",title:mstrmojo.desc(9126,"More options"),help:"more_options_dialog_box.htm",submitAction:mstrmojo.emptyFn,init:function l(p){this._super(p);if(mstrApp.isInVFConfigMode){this.children.splice(2,1);}H=this.id;this.newData=this.update={};this.joinActions={};this.onshowHeadersSectionChange(this.showHeadersSection);this.onshowSelectionLimitSectionChange(this.showSelectionLimitSection);},onOpen:function R(){S();var p=this.host,q=p&&p.gridData,s=q&&q.olm&&!(q.rw&&q.rw.row.bc>0);this.olm=!!s;if(this.showSelectionLimitSection){var r=this.SelectionLimitSection.children[1].children[1].provider;r.curVal=p.readGlobalProperty("slctnLmt");this.limitVal=undefined;}this.refresh();},_set_lockHeadersCase:function Y(s,p){this.lockHeadersCase=p;var q=this.data,r=this.lockHeadersCase;if(!q){q=this.data={rows:{},cols:{}};}else{q.rows=q.rows||{};q.cols=q.cols||{};}q.rows.lhv=(r===G||r===B)?"-1":"0";q.cols.lhv=(r===G||r===k)?"-1":"0";},onshowHeadersSectionChange:function K(q){var r=q.value,p=this.headersSection;if(!r&&p){this._headersSecOrphan=p;this.removeChildren(p);}else{if(r&&!p){this.addChildren(this._headersSecOrphan,0);}}},onshowSelectionLimitSectionChange:function b(p){var r=p.value,q=this.SelectionLimitSection;if(!r&&q){this._selectionSecOrphan=q;this.removeChildren(q);}else{if(r&&!q){this.addChildren(this._selectionSecOrphan,2);}}},children:[P("26%","74%",[Q(mstrmojo.desc(2967,"Headers"),"col1Node",{cssClass:"title"}),P("20%","80%",F(mstrmojo.desc(2968,"Rows"),"rows"),{slot:"col2Node"}),P("20%","80%",F(mstrmojo.desc(122,"Columns"),"cols"),{slot:"col2Node"})],{alias:"headersSection",cssClass:"headers",width:D}),P("26%","74%",[Q(mstrmojo.desc(4083,"Display"),"col1Node",{cssClass:"title"}),{scriptClass:"mstrmojo.Box",slot:"col2Node",cssClass:"row1",children:[Q(mstrmojo.desc(8503,"Show attribute form names:"),"containerNode",null),n(E,function(p){j(a.LONG_NAME,p.v,mstrmojo.all[H].newData);},0,{width:"151px",preBuildRendering:function A(){var p=this.items.map(function(q){return q.v;}).indexOf(mstrmojo.all[H].data[a.LONG_NAME]);this.selectedIndex=Math.max(p,0);}},true)]},{scriptClass:"mstrmojo.Box",slot:"col2Node",cssClass:"row2",children:[Q(mstrmojo.desc(13200,"Hide Null/Zero"),"containerNode",null),n(Z,function(q){var p=q.v,r=p==="-1"?"-1":"0";if(p!=="-1"){j(a.HIDE_NULL,p,mstrmojo.all[H].newData);}j(a.SHOW_ALL_ROWS,r,mstrmojo.all[H].newData);},0,{width:"181px",preBuildRendering:function A(){var q=mstrmojo.all[H].data,p=q[a.SHOW_ALL_ROWS]==="-1"?0:this.items.map(function(r){return r.v;}).indexOf(q[a.HIDE_NULL]);this.selectedIndex=Math.max(p,0);}},true)]}],{alias:"viewSection",cssClass:"view",width:D}),P("26%","74%",[Q(mstrmojo.desc(13546,"Filtering"),"col1Node",{cssClass:"title"}),{scriptClass:"mstrmojo.Box",slot:"col2Node",cssClass:"row1",children:[Q(mstrmojo.desc(13547,"When this visualization is filtered by multiple other visualizations, filter by:"),"containerNode",{cssClass:"dropdownLabel"}),n(N,function(p){var q=mstrmojo.all[H],r=q.host;if(r.switchFilterType){q.update=r.switchFilterType(p.v);}},0,{width:"181px",preBuildRendering:function A(){var p=mstrmojo.all[H].host;if(p.getFilterType){this.selectedIndex=p.getFilterType();}}},true)]}],{alias:"filteringSection",cssClass:"filtering",width:D}),P("26%","73%",[Q(mstrmojo.desc(16265,"Selection Data Limit"),"col1Node",{cssClass:"title"}),{scriptClass:"mstrmojo.Box",slot:"col2Node",cssClass:"row1",children:[Q(mstrmojo.desc(16264,"Set a limit for the maximum quantity of data points that a user can select on this visualization."),"containerNode",{cssClass:"stepperLabel"}),{scriptClass:"mstrmojo.ui.editors.controls.Stepper",width:"75px",preBuildRendering:function A(){C.addWidgetCssClass(this,"selection");mstrmojo.ui.editors.controls.Stepper.prototype.preBuildRendering.call(this);},provider:new mstrmojo.NumStepperContentProvider({item:{interval:1},min:1,max:200000,onTraverse:function(){var p=mstrmojo.all[H];p.limitVal=this.item.value;}})},Q(mstrmojo.desc(16263,"(Max quantity should be no more than 200K.)"),"containerNode",{cssClass:"stepperLabel"})]}],{alias:"SelectionLimitSection",cssClass:"filtering",width:D}),P("26%","74%",[Q(mstrmojo.desc(4571,"Join Behavior"),"col1Node",{cssClass:"title"}),{scriptClass:"mstrmojo.DataGridWithTooltip",slot:"col2Node",cssClass:"jointype",banding:false,lockHeader:true,columns:[{headerText:mstrmojo.desc(5467,"Objects"),dataField:"n",headerCss:"objects-hd",tooltip:false,itemTooltipField:"tf",itemCSSField:"itemCss",colWidth:115,colHeight:24},{headerText:mstrmojo.desc(13176,"Join Type"),headerCss:"jointype-hd",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"jt-col",children:[{scriptClass:"mstrmojo.Label",cssClass:"jt-value",alias:"jtValue",bindings:{text:"this.parent.data.dv"}},{scriptClass:"mstrmojo.Button",cssClass:"jt-menu",alias:"jtBtn",onclick:function(){var p=mstrmojo.all[H];O.call(p,this);}}]}}],items:[],itemFunction:function(){var p=mstrmojo.DataGridWithTooltip.prototype.itemFunction.apply(this,arguments);p.themeClassName=!!mstrApp.isWSStyling?"":"mojo-theme-dark";return p;},preBuildRendering:function A(){var z=mstrmojo.all[H].host,x=z.model&&z.model.docModel,r=z.gridInfo||{},AA=r.rows||[],v=r.cols||[],w=r.mx||[],s=r.dmx||[],u=z.tmsProps,p=u.tpltProp&&u.tpltProp["VLDB Select"]&&u.tpltProp["VLDB Select"][0].v,t=[];p=(p&&p.length)?p:"-1";(AA.concat(v)).some(function(AB){if(AB.t===12){t.push({did:"AllAttr",n:mstrmojo.desc(13185,"All Attributes"),v:p,dv:c[p],itemCss:"jt-allattr"});return true;}return false;});w=f.filter(w,function(AC){var AD=d.getUnitFromDataset(x.datasets,AC.did,4),AB=AC.isSmart&&AC.decomposable===2;return AD&&(!AD.um||AC.afb||!AC.isSmart||AB);});var q=[].concat(u.mxProp);s.forEach(function(AC){var AB={};AB[AC.did]=AC.prop;q.push(AB);});(w||[]).forEach(function(AC){var AB={v:"-1"};(q||[]).forEach(function(AD){if(AD[AC.did]){(AD[AC.did]["VLDB Select"]||[]).forEach(function(AE){if(AE.n==="Metric Join Type"){AB=AE;}});}});t.push({did:AC.did,n:AC.n,dt:AB.dt,t:4,v:AB.v,dv:W[AB.v],itemCss:"jt-metric"});});this.items=t;mstrmojo.DataGridWithTooltip.prototype.preBuildRendering.apply(this,arguments);},postBuildRendering:function L(){mstrmojo.DataGridWithTooltip.prototype.postBuildRendering.apply(this,arguments);this.domNode.style.overflow="hidden";}}],{alias:"JoinBehaviorSection",cssClass:"joinbehavior",width:D}),{alias:"buttonBar",scriptClass:"mstrmojo.Box",slot:"buttonNode",children:[V(mstrmojo.desc(221,"Cancel"),function(){X(false);}),V(mstrmojo.desc(118,"Save"),function(){X(true);},true)]}]});mstrmojo.DataGridWithTooltip=mstrmojo.declare(mstrmojo.DataGrid,[mstrmojo._HasTooltip],{scriptClass:"mstrmojo.DataGridWithTooltip",tooltip:"",useRichTooltip:true,itemFunction:function(r,p,q){var s=new mstrmojo.DataRow({columns:q.columns,data:r,idx:p,dataGrid:q,parent:q});q.dataTextCSSClass=s.dataTextCSSClass;return s;},updateTooltipConfig:function m(q){var r=q.target||I.eventTarget(q.hWin,q.e),p=I.position(r);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMRIGHT,content:this.getTooltipContent(q),top:p.y+1.5*p.h,left:p.x,cssClass:"vi-regular vi-tooltip-D"};},getTooltipContent:function(p){return mstrmojo.string.regEscape(p.target.innerText);},showTooltip:function o(p,q){if(p.target.className===this.dataTextCSSClass){this._super(p,q);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.viz.DropZoneHelper","mstrmojo.string","mstrmojo.vi.ui.DatasetUnitMenuUtils");var G="mstrmojo-VIUnitList",I="icn clsx_sub",D=mstrmojo.vi.viz.DropZoneHelper.isMetricNames,C=mstrmojo.vi.ui.DatasetUnitMenuUtils,J=mstrmojo.string;mstrmojo.vi.ui.VIDragUnit=mstrmojo.declare(null,null,{scriptClass:"mstrmojo.vi.ui.VIDragUnit",getItemDisplayName:function F(K){return K.n;},getUnitAvatar:function A(N,Q){var M=document.createElement("div"),P=N.getCtxtDragData(),K=P.items,L=['<div class="',[G,mstrApp.getThemeClassName()].join(" "),'">'],O=this;K.forEach(function(S){var U=O.getItemDisplayName(S),R="item unit isAvatar "+C.getUnitCssClass(S);if(D(S)){U=mstrmojo.desc(3582,"Metrics");R+=" is-mh";}L.push('<div class="'+R+'"><span class="txt" unselectable="on">'+(Q?J.encodeHtmlString(U):U)+"</span></div>");});L.push("</div>");M.innerHTML=L.join("");return M.removeChild(M.firstChild);},getUnitDragData:function B(M,K){var L=this.setAvatarClass.bind(this);return{items:K,item:K[0],setAvatarClass:function N(P){L(M,P);},setInvalidAvatarClass:function O(){L(M,I);}};},getDragUnitOffsets:function E(){return{x:21,y:16};},setAvatarClass:function H(N,K){var L=N.avatar;if(L){var M=[G,"hasOwnAvatar",mstrApp.getThemeClassName(),K||""];L.className=M.join(" ");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxPanel","mstrmojo._HasBuilder","mstrmojo._IsPanelStack","mstrmojo.vi.ui.rw._IsPanelStack","mstrmojo.vi.ui.rw._HasBufferSlice","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig","mstrmojo.Label","mstrmojo.Button","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models.PanelFormatSaver","mstrmojo.ui.CheckList","mstrmojo.vi.ui._HasMask","mstrmojo.array","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.vi.ui.rw.selectors.EnumVizSelectorMode");mstrmojo.requiresDescs(134,1143,3581,3582,11473,11474,11815,11816,11817,11818,14594);var L=mstrmojo.array,F=mstrmojo.dom,U=mstrmojo.Button.newWebButton,C=mstrmojo.string,P={att:12,mx:4},N={CLEAR_TARGET:1,TARGET_ALL_BELOW:2},Y=mstrmojo.func,g=Y.wrapMethods,G=mstrmojo.vi.ui.DatasetUnitMenuUtils,I=mstrmojo.vi.ui.rw.selectors.EnumVizSelectorMode;function e(h){return(h||[]).map(function(j){return j.ckey;});}function V(){var l=this.model,m=this.getFilterDefinitions(),k=[],j={},n=this.id;function h(u,t){var s=l.getDatasetUnits([t],function(AA){var z=AA.t;if(!j[AA.did]&&(z===12||z===4||z===1||z===47)){if(L.find(m,"srcid",AA.did)<0&&AA.hide){return false;}j[AA.did]=true;return true;}return false;});s=G.getSortedDatasetUnits(s);if(!s.length){return ;}var r=(l.datasetsSettings&&l.datasetsSettings.units)||{};s=s.filter(function(z){return !(r[z.n]&&r[z.n].completeHide)&&G.isValidAddToFP(l,z,true);});var p={};(s||[]).forEach(function(AA,z){if(L.find(m,"srcid",AA.did)>-1){p[z]=true;}});var o=l.datasets,w,x=0;for(w in o){if(o.hasOwnProperty(w)&&o[w].did){++x;}}var q=new mstrmojo.ui.CheckList({cssClass:"units",items:s.map(function(z){z.tt=z.n+" ("+z.ds+")";z.css=G.getUnitCssClass(z);return z;}),selectedIndices:p,useRichTooltip:true,showTooltip:function v(z,AC){var AB=z.target||F.eventTarget(z.hWin,z.e),AA=this.getItemFromTarget(AB),AE=AB.firstChild,AD;AB.setAttribute("title","");if(AB.offsetWidth<AE.offsetWidth||x>0){AD=F.position(this.getItemNodeFromTarget(AB));this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",content:AA.tt,top:AD.y,left:AD.x+AD.w+18};mstrmojo.ui.CheckList.prototype.showTooltip.apply(this,z,AC);}}});k.push({scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:u,children:[q],t:P[t],getSelectedItems:function(){return(q.getSelectedItems()||[]).filter(function(z){return L.find(m,"srcid",z.did)===-1;});},getUnselectedFiltersDefns:function(){var z=this.t;return m.filter(function(AA){return !(r[AA.ttl]&&r[AA.ttl].completeHide)&&(L.find(q.getSelectedItems()||[],"did",AA.srcid)===-1)&&(AA.srct===z||z===12&&AA.srct===47);}).sort(function(AB,AA){var AC=function(AD){return(AD.fmts&&AD.fmts["z-index"])||0;};return(AC(AB)>AC(AA))?1:-1;});},updateListScrollbars:function(){q.updateScrollbars();}});}h(mstrmojo.desc(3581,"Attributes"),"att");h(mstrmojo.desc(3582,"Metrics"),"mx");return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"showFilters",contents:k,onOpen:function(){k.forEach(function(o){o.updateListScrollbars();});},fnOk:function(){var p=[],o=[];k.forEach(function(q){p=p.concat(q.getSelectedItems());o=o.concat(q.getUnselectedFiltersDefns());});mstrmojo.all[n].model.changeFilterStackSelectors(p,o);}});}function X(k){var l=this,j=l.model,m=j.getDataService(),n=g({success:function(){k=!k;l.set("autoApply",k);l.defn.set("cas",k);l.widgetResized();}},j.getRebuildCallback()),h=[];j.execute({execute:function(){var o=m.newUpdate(this);if(k){l.applyBufferedSlices(true,o,h);}l.set("autoApply",k);l.defn.set("cas",k);o.addActions(j.getUnitFormatAction(l,1,{FormattingLayout:{CtlAutoSubmit:(k?1:0)}}));o.addCallbacks({success:mstrmojo.emptyFn});o.submit();l.widgetResized();},urInfo:{extraPuKeys:h,callback:n}});}function E(){var r=this,o=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,isHostedWithin:false,maxHeight:F.getMaxScrollHeight()}),s=!!this.getFilters().length,j=mstrApp.isAppStatePresentation(),q=mstrApp.isAppStatePause(),p=0,t=1,n=function n(u){return !!r.getFilterDefinitions().filter(function(v){return v.ds===u;}).length;};if(!j){if(this.model.getDatasetUnits(["mx","att"]).length){var h=r.id;o.addEditorMenuItem(mstrmojo.desc(11815,"Add Filters"),h,V);o.addMenuItem(mstrmojo.desc(15288,"Add Visualization Filter..."),"",function(){var v=r.model,u=v.addVisFilterContainer(),w=v.getNextVisFilterTitle();v.addVisualizationSelector(u,I.CONFIGURATION,w);mstrApp.getRootController().enterVizFilterConfigMode(w,false);});}else{o.addDisabledMenuItem(mstrmojo.desc(11815,"Add Filters"));o.addDisabledMenuItem(mstrmojo.desc(15288,"Add Visualization Filter..."));}}if(s){o.addMenuItem(mstrmojo.desc(14594,"Unset All Filters"),"cf",function(){r.clearBuffSlices();r.contents.clearAllFilter();r.applyBufferedSlices();});}o.addSeparator();if(!j){if(!q){o.addToggleMenuItem(mstrmojo.desc(11818,"Auto-apply Filters"),"atc",function(){X.call(this,true);},function(){X.call(this,false);},r.id,r.autoApply);o.addSeparator();}var m=function(x){var z=this.ctxt,v=z.k,u=z.model,AA=u.getDataService().getChangeFilteringAction(z.k,x,true,[v]),AB={success:function(AC){u.partialUpdate(AC.data,u.getTargetDefn(v),AC.defn,e(z.getFilterDefinitions()));}},w={style:{params:{treesToRender:3}}};u.execute({execute:function(){this.submit(AA,AB,w);},urInfo:{treesToRender:3}});};o.addMenuItem(mstrmojo.desc(11474,"Target All Filters Below"),"",function(){m.call(this,N.TARGET_ALL_BELOW);},this);o.addMenuItem(mstrmojo.desc(11473,"Clear All Targeting"),"",function(){m.call(this,N.CLEAR_TARGET);},this);o.addSeparator();}if(s){var l=n(t),k=n(p);o[l?"addMenuItem":"addDisabledMenuItem"](mstrmojo.desc(11816,"Expand All"),"fea",l?function(){r.contents.toggleFilters(false);}:null,null);o[k?"addMenuItem":"addDisabledMenuItem"](mstrmojo.desc(11817,"Collapse All"),"fca",k?function(){r.contents.toggleFilters(true);}:null,null);}if(!j){o.addSeparator();this.addHelpTopicMenuItem(o,mstrmojo.desc(1143,"Help"),"filter_panel.htm");}o.hostId=r.id;o.isHostedWithin=false;o.hostElement=r.fpsTitleBar.menuBtn.domNode;if(o.hasMenuItems()){r.openPopup(o.newInstance());}}mstrmojo.vi.ui.rw.FilterPanelStack=mstrmojo.declare(mstrmojo.vi.ui.BoxPanel,[mstrmojo._HasBuilder,mstrmojo._IsPanelStack,mstrmojo.vi.ui.rw._IsPanelStack,mstrmojo.vi.ui.rw._HasBufferSlice,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState,mstrmojo.vi.ui._HasMask],{scriptClass:"mstrmojo.vi.ui.rw.FilterPanelStack",markupMethods:{onvisibleChange:function(){if(this.visible){this.domNode.style.display=this.cssDisplay;this.getFilters().forEach(function(h){h.refresh();});}else{this.domNode.style.display="none";this.onStatusChange();}}},title:"",k:"",contents:null,applyEnabled:false,editTitleOnDoubleClick:true,setOpenStatus:function O(k,h,n,l){if(!h){if(n){var j=this.model,m=n.actions;m.push(j.getUnitFormatAction(this,1,{FormattingAppearance:{Visible:true}}));}else{mstrmojo.vi.models.PanelFormatSaver.getPanelSaver(this.model,{visible:{set:"FormattingAppearance",name:"Visible"}},this).saveProperty("visible",true);}}if(!k){this.onStatusChange();}this._super(k,h,n,l);},getOpenStatus:function K(){return this.parent;},children:[{scriptClass:"mstrmojo.Box",slot:"controlNode",alias:"fpsTitleBar",cssClass:"fp-titlebar",ignoreLayout:true,children:[{scriptClass:"mstrmojo.EditableLabel",cssClass:"fp-title",alias:"fpsTitle",editOnClick:false,useRichTooltip:true,bindings:{text:function(){return this.parent.parent.title;},editOnDoubleClick:function(){return this.parent.parent.editTitleOnDoubleClick;}},updateTooltipConfig:function Z(j){var k=j.target,h=F.position(k);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:C.encodeHtmlString(this.parent.parent.title),top:h.y+h.h+3,left:h.x+4};},onTextEditComplete:function(k,h){if(k){var j=this.parent.parent;j.titleEdited(this.text,h);}},getLayoutOffsets:function d(){return{h:2,w:2};}},{scriptClass:"mstrmojo.Button",alias:"menuBtn",cssClass:"fp-menu",onclick:function(){E.call(this.parent.parent);}}]},{scriptClass:"mstrmojo.Box",slot:"controlNode",alias:"fpsBtnBar",cssClass:"fp-btnbar",ignoreLayout:true,bindings:{visible:"!this.parent.autoApply"},children:[U(mstrmojo.desc(134,"Apply"),function(){this.parent.parent.applyBufferedSlices();},true,{alias:"applyBtn",bindings:{enabled:"this.parent.parent.applyEnabled"}})]}],layoutConfig:{h:{controlNode:"auto",containerNode:"100%"},w:{controlNode:"100%",containerNode:"100%"},xt:true},init:function W(h){this._super(h);this.controller.view.attachEventListener("destroyLayout",this.id,function(k){var j=mstrmojo.vi.models.VIComponentMap.TYPES.FILTER_STACK;if(this.builder.getLayoutVIMap(k.key).getComponentKey(j)===this.k){this.destroy();}});if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){this.defn.set("cas",false);}this.set("autoApply",this.isAutoApply());this.set("title",this.model.getCurrentLayoutDef().title||"");this.set("editTitleOnDoubleClick",mstrApp.allowWebDashboardDesign());},postBuildRendering:function a(){this._super();if(this.contents){this.contents.attachEventListener("filterPanelUpdated",this.id,this.updateScrollbars);}},postBuildDom:function D(){if(this._super){this._super();}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()&&this.model&&this.model.hasRADataset()){this.set("isMasked",true);}},updateScrollbars:function f(){this._super();},getFilterDefinitions:function S(){return this.getFilters().map(function(h){return h.defn;});},getFilters:function B(){var h=this.contents;return h?(h.children||[]).map(function(j){return j.selector;}):[];},isEmpty:function M(){var h;try{h=this.node.data.panels[0].objects[0];}catch(j){}return !!h;},isAutoApply:function J(){var j=this.defn||this.node.defn;if(j.cas===undefined){var h=this.model;return !h.hasMDXRADataset(h.datasets);}return j.cas;},getFilterBySrcId:function A(h){return this.getFilters().filter(function(j){return j.defn.srcid===h;})[0];},widgetResized:function H(){if(this.hasRendered){this.containerNode.style.height=parseInt(this.height,10)-this.controlNode.offsetHeight+"px";}this._super();var h=this.fpsTitleBar&&this.fpsTitleBar.fpsTitle;if(h&&h.widgetResized){h.widgetResized();}},titleEdited:function c(k,h){var j=this.model;j.changeCurrLytTabTtl(k,h);},onscroll:function b(){this._super();var h=this.contents&&this.contents.children;if(h&&h[0]){h[0].updateForScroll();}},onAppStateChange:function Q(h){var m=mstrmojo.vi.VisualInsightApp.APP_STATES,j=m.PAUSE,k=mstrApp.isAppStatePause(),l=!!(h.valueWas&j);if(k!==l){if(k){this.casValue=this.defn&&this.defn.cas;this.set("autoApply",false);this.defn.set("cas",false);}else{this.defn.set("cas",this.casValue);delete this.casValue;this.set("autoApply",this.isAutoApply());}if(this.model&&this.model.hasRADataset()){this.set("isMasked",k);}}},onStatusChange:function R(){var h=this.contents&&this.contents.children;if(h&&h[0]){h[0].closeVisSelectorPanel();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.ui.HierarchyElementsCheckListBrowser","mstrmojo.vi.ui.ElementsBrowser","mstrmojo.ValidationTextBox","mstrmojo.DateTextBox","mstrmojo.Label","mstrmojo._IsList","mstrmojo.rw.ConditionWalkProviderBase","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown","mstrmojo.ui.CheckList","mstrmojo.ui.ColumnContainer","mstrmojo.vi.ui.DatasetUnitMenuUtils");var P=mstrmojo.array,W=mstrmojo.css,F=mstrmojo.string,M=mstrmojo.expr,X=mstrmojo.dom,Y=mstrmojo.hash,x=M.ET,a=M.ET2TGT,o=M.DTP2FN_DTP,Z=M.FN,n=M.FNT,S=M.FN_MRP,s=mstrmojo.rw.ConditionWalkProviderBase,d=s.onWalkChange,q=s.updateList,AI=s.fnItem,AH=s.isComparisonAllowed,b=s.clearInvalid,D=s.shouldShowCst,e=s.getConstant,G=s.getConstantDataType,w=s.getConstantValue,AJ=s.isDATE,f=s.getCstListCompareTgts,g=s.fmJson,AB=s.allowedTargetTypes,L=s.updatePulldown,U=s.onWalkChangeThroughPulldown,p=mstrmojo.mstr.EnumDSSXMLObjectTypes,AF=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,AL=mstrmojo.vi.ui.DatasetUnitMenuUtils,B=mstrmojo.ui._HasListTooltip;var E=mstrmojo.ui.ColumnContainer.prototype.updateColumnContainer;var Q=mstrmojo.meta.TP,AE=mstrmojo.meta.STP,C="-2";var N={SELECT:0,QUALIFICATION:1};var h={TEMPLATE_LEVEL:0,DATASET_LEVEL:1};var V={VALUE:1,RANK_PERCENTAGE:2,BOTH:3};var m=0,r=1;var H=368,AD=H-5,AK=5,R=26,K=10;var v={};v[x.MQ]={key:"metricFns",def:M.METRIC_FNS};v[x.MC]={key:"metricFns",def:M.METRIC_FNS};v[x.AQ]={key:"formFns",def:M.FORM_FNS};v[x.AL]={key:"formFns",def:M.FORM_FNS};v[x.AC]={key:"formFns",def:M.FORM_FNS};v[x.AE]={key:"elemFns",def:M.ELEM_FNS};function AG(AM){return'<div class="unit item '+AL.getUnitCssClass(AM)+'">'+F.encodeHtmlString(AM.n)+"</div>";}function AA(AM){var AN=this.selectedNode;P.forEach(AN.classList,function(AO){if(AO&&F.startsWith(AO,"ic")){W.removeClass(AN,AO);}});W.addClass(AN,"unit");W.addClass(AN,"item");W.addClass(AN,AL.getUnitCssClass(AM));return F.encodeHtmlString(AM.n);}function l(AN,AV){var AR=AN.model,AU=AR.et,AW=AR&&AR[a[AU]]&&AR[a[AU]][AN.columnWalk.target.itemIdField||"did"],AQ=AR&&AR.fm,AZ=AQ&&AQ.dtp,AO=AH(AR,AN.ets);if(this.targetsLastMod&&this.targetsLastMod===AN.targetsLastMod&&AW&&AW===this._lastTargetId&&this.lastFmDtp===AZ&&this.lastFnTp===AO&&this.lastEt===AU){return ;}var AT=this.attMxPd,AY=this.attMxLabel;if(!AO){AT.set("items",[]);AY.set("visible",false);AT.set("visible",false);}else{var AX=AR.a?mstrmojo.desc(518,"Attribute"):AR.m?mstrmojo.desc(517,"Metric"):"",AS=f(AN),AM=AR[a[AR.et]+(2+AV)],AP=AM?P.find(AS,"did",AM.did):undefined;AY.set("text",AX);AT.items=AS;AT.selectedIndex=AP>=0?AP:undefined;AT.refresh();AY.set("visible",true);AT.set("visible",true);}this._lastTargetId=AW;this.lastFnTp=AO;this.lastFmDtp=AZ;this.lastEt=AU;this.targetsLastMod=AN.targetsLastMod;}function J(AU,AX){AU.updating=true;var AQ=AU.parent.parent.parent,AW=D(AQ,AX);if(!AW){AU.updating=false;return ;}var AO=AQ.model||{},AT=e(AQ,AX),AP=G(AQ,AT),AY=w(AQ,AX),AV=AO.fn,AS=M.fn_List(AV,AO.fnt),AM=AJ[AP];var AR=AM?AU.dateInput:AU.txtInput;var AN=AM?AU.txtInput:AU.dateInput;AN.set("visible",false);AR.updating=true;AR.set("dtp",AP);AR.set("isList",AS);AR.set("value",AY);AR.set("visible",true);AR.set("hint",AS?mstrmojo.desc(8191,"value1## value2## ...## valueN").replace(/##/g,mstrConfig.listSep||";"):"");AR.updating=false;if(AV===1||AV===2){AR.constraints.min=0;}if(AR.clearValidation&&AR.inputNode){AR.clearValidation();}l.call(AU,AQ,AX);switch(AO.et){case x.AQ:case x.AL:case x.MQ:AU.attMxPd.set("selectedIndex",undefined);break;}AU.updating=false;}function AC(){var AP=this.parent,AN=AP.parent.parent.parent,AO=(this.isValid&&this.isValid())||(!this.isValid&&!F.isEmpty(this.value)),AM=AN.model;AN["invalid"+AP.cstIndex]=!AO;if(!this.updating){this.updating=true;if(AM){AM.edit(AP.alias,{v:this.value,dtp:this.dtp});}this.updating=false;}if(AN.updateOkBtn){AN.updateOkBtn();}}function I(AM){if(AM){var AO=AM.n,AN=AM.dsName;if(AO&&AN){return'<div class="name">'+F.encodeHtmlString(AO,true)+'</div><div class="dsc dataset">'+F.encodeHtmlString(AN,true)+"</div>";}else{return B.getTooltipText.call(this,AM);}}}function k(AM){return Y.copy(AM,{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ValidationTextBox",alias:"txtInput",cssText:"width: 100%",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.VALUESET},onValid:AC,onInvalid:AC,onClearValidation:b,size:6,visible:true},{scriptClass:"mstrmojo.DateTextBox",alias:"dateInput",cssDisplay:"inline-block",required:true,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL},onValid:AC,onInvalid:AC,onClearValidation:b,calendarToBody:true,autoFormat:false,calConfig:{onmousedown:function(AP){X.stopPropogation(AP.hWin,AP.e);}},visible:true},{scriptClass:"mstrmojo.Label",cssClass:"attMxLabel",text:"Attribute",alias:"attMxLabel"},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attMxPd",itemIdField:"did",cssClass:"conditionWalk-attMxPd",onSelectedItemChange:function AN(AQ,AR){if(this.hasRendered){var AP=this.parent.parent.parent.parent;U.call(this,AP,AQ,"c0");}},getPulldownTextInnerHTML:AG,getPopupListConfig:function AO(){var AP=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);AP.showTooltipForLargeText=false;AP.getItemProps=function AQ(AT,AR){var AS=mstrmojo._IsList.getItemProps.call(this,AT,AR);AS.title="";AS.style=this.parent.itemCssText||"";AS.addCls("unit "+AL.getUnitCssClass(AT));return AS;};AP.getTooltipText=I;return AP;}}],update:function(){J(this,this.cstIndex);this.parent.updateScrollbars();},postCreate:function(){this._super();this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});}});}function t(AM){return AM[Q]===p.Attribute&&AM[AE]===AF.AttributeRecursive;}function u(AM){var AO=AM[Q]===p.Consolidation&&AM[AE]===AF.ConsolidationManaged,AN=mstrApp&&mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model;if(AO&&AN&&AN.findUnitInDataSet){AM=AN.findUnitInDataSet(AM.did);if(AM&&AM.attId){return t(AN.findUnitInDataSet(AM.attId));}}}mstrmojo.vi.ui.ConditionWalkProvider=mstrmojo.declare(mstrmojo.rw.ConditionWalkProviderBase,null,{scriptClass:"mstrmojo.vi.ui.ConditionWalkProvider",getTargetNodeProps:function j(){var AW=this;return{alias:"target",isAttribute:false,isMetric:false,showChooseMethod:true,showLevel:false,children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(15115,"Based on")},{scriptClass:"mstrmojo.ui.SearchablePulldown",alias:"target",itemIdField:"did",cssClass:"conditionWalk-target",allowEmptyText:true,onRender:function(){if(this.hasRendered){this[this.editableSlot].setAttribute("placeholder",mstrmojo.desc(10,"Search"));}},postCreate:function(){this.parent.parent.parent.attachEventListener("updateTargets",this.id,function(){this.update();});},getEditableTextInnerHTML:function AX(){var AZ=this.selectedIndex,AY=this.getPopupList(),Aa=AY&&AY.items;if(this.selectedNode&&Aa&&Aa[AZ]){return this.getPulldownTextInnerHTML(Aa[AZ]);}else{return"";}},update:function AS(){var Ab=this.parent.parent.parent,Aa=Ab.model,AY=Ab.targetsLastMod,Ae=Aa&&Aa.et;if(this.lastModel!==Aa||this.targetsLastMod!==AY){this.lastModel=Aa;this.targetsLastMod=AY;var AZ=Ab.targets,Ac=Ab.ets;if(Ac&&AZ&&AZ.length){var Ad=AB(Ab.ets);AZ=P.filter(AZ,function(Aj){return Ad[Aj[Q]];});}var Ah=Aa&&Aa[a[Ae]],Ag=Ab.objectBrowsingEnabled,Ai=Ag&&(!AZ||P.find(AZ,"did",C)===-1);if(Ae===x.ANDOR){Ah=Aa.a||Aa.m||null;}this.set("objectBrowsingEnabled",Ag);if(Ai){AZ=AZ||[];var Af=mstrmojo.desc(15346,"Browse Metadata Objects...");AZ.push({did:C,n:Af,t:-1,title:Af});}L(this,true,M.getSortedObjectsByTypeGroup(AZ),Ah);if((!Ag||Ai)&&!Ah){this.set("isEditing",true);this.openPopup(this.getPopupList());}}},onitemSelected:function AN(Aa,AZ){if(this.hasRendered){var AY=this.parent.parent.parent;U.call(this,AY,Aa,"target");}},preisEditingChange:function AT(){if(this.hasRendered&&this.isEditing){var AY=this.selectedNode;this._lastText=AY.innerHTML;W.removeClass(AY,"unit");W.removeClass(AY,"item");}return true;},postisEditingChange:function AU(){if(this.hasRendered&&!this.isEditing){var AY=this.selectedNode;if(this._lastText){AY.innerHTML=this._lastText;W.addClass(AY,"unit");W.addClass(AY,"item");}else{AY.innerHTML="";}delete this._lastText;}},onPopupWidgetClosed:function AV(Aa){if(this.objectBrowsingEnabled&&Aa&&Aa.pressingEnter){var AY=this.getPopupList(),Ad=AY._oldItems,Ac=this.text;if(Ad&&Ac){var Ab=P.filterOne(Ad,function(Ae){return Ae.n===Ac;});Ab=Ab||AY.items[0];if(!Ab){delete AY._oldItems;AY.set("items",Ad);return ;}if(Ab.did===C){var AZ=this.parent.parent.parent;AZ.browse(this);delete AY._oldItems;AY.set("items",Ad);return ;}}}mstrmojo.ui.SearchablePulldown.prototype.onPopupWidgetClosed.call(this,Aa);},getPulldownTextInnerHTML:AA,getPopupListConfig:function AM(){var AY=mstrmojo.ui.SearchablePulldown.prototype.getPopupListConfig.call(this);AY.showTooltipForLargeText=false;AY.getItemProps=function AZ(Ae,Ac){var Ad=mstrmojo._IsList.getItemProps.call(this,Ae,Ac);Ad.title="";Ad.style=this.parent.itemCssText||"";Ad.addCls("unit "+AL.getUnitCssClass(Ae));Ad.addCls(Ae.isInvalid?"invalid":"");return Ad;};AY.doItemSelect=function Aa(Af,Ac){if(Af.did===C){var Ad=this.parent;Ad.parent.parent.parent.browse(Ad);}else{if(Af.isInvalid){var Ae=this;window.setTimeout(function(){Ae.showTooltip({target:Ae._getItemNode(Af._renderIdx)},window);},0);}else{mstrmojo._IsList.doItemSelect.call(this,Af,Ac);}}};AY.showTooltip=function Ab(Ah,Ag){if(!this.hasOpenTooltip&&!(this._lastOpened&&this._lastOpened.visible)){var Af=X.eventTarget(Ag,Ah),Ae=this.getItemFromTarget(Af);if(Ae&&Ae.isInvalid){var Ad=this.getItemNodeFromTarget(Af),Ac=X.position(Ad);this.richTooltip={content:mstrmojo.desc(15391,"This is an invalid object. Please contact your administrator for more information."),cssClass:"vi-warning triangle-warning vi-tooltip-C A-center",left:Ac.x+168,top:Ac.y};mstrmojo._HasTooltip.showTooltip.call(this,Ah,Ag);}else{this.constructor.prototype.showTooltip.call(this,Ah,Ag);}}};AY.tooltipOpenDelay=700;AY.getTooltipText=I;return AY;}},{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(15116,"Choose elements by"),alias:"attrLabel",bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chooseMethodPd",items:null,visible:false,bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"},onitemSelected:function AN(Ab){var Aa=this.parent.fm,AZ=Aa&&Aa.cssClass,AY=Aa&&Aa.domNode,Ac=Aa&&Aa.selectedItem;if(Ab.v===N.SELECT){W.toggleClass(AY,"forms",false);if((AZ||"").indexOf(" forms")>-1){Aa.cssClass=AZ.replace(" forms","");}if((!Ac)||Ac.did!=="1,22"&&Ac.did!=="1,57"){Aa.singleSelectByField("1,22","did");}}else{W.toggleClass(AY,"forms",true);if((AZ||"").indexOf(" forms")===-1){Aa.cssClass=(AZ||"")+" forms";}if(!Ac||Ac.did==="1,22"||Ac.did==="1,57"){Aa.singleSelect(2);}}Aa.updateScrollbars();},update:function AS(){var Ad=this.parent.parent.parent,Ab=Ad&&Ad.model,AZ=Ad&&Ad.disableElementsBrowsing,AY=Ab&&Ab.a,Aa=AY&&AZ&&AZ(AY);if(Aa){this.set("items",[{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION}]);}else{if(AY.ndetype===1){this.children[0].showTooltipForLargeText=false;this.set("items",[{n:mstrmojo.desc(15118,"Selecting in list"),v:N.SELECT,ttpDisabled:true},{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION,cls:"disabled",dsbld:true,ttp:mstrmojo.desc(16184,"This method is not available for this object type.")}]);}else{this.set("items",[{n:mstrmojo.desc(15118,"Selecting in list"),v:N.SELECT},{n:mstrmojo.desc(15117,"Qualification on"),v:N.QUALIFICATION}]);}}var Ac=this.getSelectedItem();switch(Ab.et){case x.AQ:case x.AL:case x.AC:if(!Ac||Ac.v!==N.QUALIFICATION){this.selectItemByField("v",N.QUALIFICATION);}break;default:if(!Ac||Ac.v!==N.SELECT){this.selectItemByField("v",N.SELECT);}break;}}},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fm",fmPost:"",itemIdField:"did",filter:false,isFirstFm:true,multiSelect:false,minimumSelectCnt:0,hasDummyLabel:false,lastAttrId:null,height:AD-R*4-K*2-AK+"px",onchange:function AQ(AY){d.call(this,AY,"fm");},bindings:{visible:"this.parent.isAttribute && this.parent.showChooseMethod"},onvisibleChange:function(){this.lastAttrId=null;}}),{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15119,"Output Level"),cssClass:"baseOn",alias:"metricLabel",bindings:{visible:"this.parent.isMetric && this.parent.showLevel"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"outputLevelPd",items:[{n:mstrmojo.desc(12178,"Visualization level"),v:h.TEMPLATE_LEVEL},{n:mstrmojo.desc(13519,"Dataset level"),v:h.DATASET_LEVEL}],selectedIndex:0,bindings:{visible:"this.parent.isMetric && this.parent.showLevel"},onSelectedItemChange:function AO(AZ,Aa){var AY=this.parent.parent.parent,Ab=AY.condition;Ab.level=AZ.v;}}],updateColumnContainer:function AP(){this.target.update();var Ab=this.parent,Ag=Ab.parent,Aj=Ag.model,Ar=Aj&&Aj.et,Ak=this.idx,Ao=this.next,Ap=Aj&&Aj.a,Ah=Aj&&Aj.fm,Ae=Ag&&Ag.inRelation;if(Ar){switch(Ar){case x.AQ:case x.AL:case x.AC:case x.AE:case x.ANDOR:if(Ap){this.set("isMetric",false);this.set("isAttribute",true);var An=Ag.disableElementsBrowsing,Aa=Ap&&An&&An(Ap),Al=Ag.getAttributeInfo(Ap.did),Af=t(Al)||u(Al),Ai=Ag.disableHierarchyLevel;if(Af){Aj.et=x.AE;this.set("showChooseMethod",false);}var Ad=(Aj.etWas&&Aj.etWas===x.AE)?r:m,Am=m;if(Aj.et===x.AE&&!Aa){Am=r;}if(Ad!==Am||Am===m||!Ab.next){Ab.removeTrailingContainer(Ak);if(Am===m&&Ah){Ab.addNextColumn(AW.getFnNodeProps());}else{if(Am===r){Ab.addNextColumn(AW.getEsNodeProps(Af,Ai));}}}Ag.condition.level=h.DATASET_LEVEL;var Aq=this.fm;Aq.updating=true;Aq.update();this.chooseMethodPd.update();Aq.updating=false;}break;case x.MQ:case x.MC:if(Aj.m){this.set("isMetric",true);this.set("isAttribute",false);var AZ=Ag.isMDXDM(Aj.m.did),AY=Ag.condition.level,Ac=Ag.editor&&Ag.editor.showLimits;if(AY!==h.TEMPLATE_LEVEL&&AY!==h.DATASET_LEVEL){AY=Ag.condition.level=Ac?h.TEMPLATE_LEVEL:h.DATASET_LEVEL;}if(!Ae&&!AZ&&Ac){this.set("showLevel",true);this.outputLevelPd.set("selectedIndex",AY);}else{this.set("showLevel",false);}if(!(Ao&&Ao.fn)){this.parent.insertAndRemoveTrailing(Ak,AW.getFnNodeProps());}}break;case x.R:case x.F:case x.XML:this.set("isMetric",false);this.set("isAttribute",false);Ag.condition.level=h.DATASET_LEVEL;this.parent.removeTrailingContainer(Ak);break;}}else{this.set("isMetric",false);this.set("isAttribute",false);}E.call(this);},setupScrollNodes:function AR(){this.scrollNode=null;}};},getEsNodeProps:function A(AT,AO){var AS=AT?"HierarchyElementsCheckListBrowser":"ElementsBrowser",AN=[{scriptClass:"mstrmojo.vi.ui."+AS,alias:"es",height:AD-5+"px",disableLevel:AO,update:function AR(){var AX=this.parent.parent.parent,AY=AX.model,AW=AY&&AY.a,AV=!!AW&&!AW.ilk;if(!AV){return ;}this.set("ifDataSource",AX.getIfDataSource());this.onUpdateBrowseElementsParams=function(Ab){AX.onUpdateBrowseElementsParams(Ab);};if(!AY.es){AY.es=[];}if(AT){var Aa=AX.getAttributeInfo(AW.did);Y.copyProps(["t","st"],Aa,AW);if(Aa&&Aa.attId){Aa=AX.getAttributeInfo(Aa.attId);}Y.copyProps(["fs","lvfs"],Aa,AW);}else{if(!AW.fs){Y.copyProps(["fs"],AX.getAttributeInfo(AW.did),AW);}}var AZ=Y.clone(AT?AY.data:AY.es);this.set("attribute",AW);this.set("selectedItems",AZ);},onBrowseElementsFailure:function AM(){var AY=this.attributeId,AV=this.parent.parent,AX=AV.parent,AW=P.filterOne(AX.targets,function(Aa){return Aa.did===AY;});AW.isInvalid=true;AW.cls=(AW.cls||"")+" invalid";AX.set("model",{et:5,isNew:true,defaultETAttr:5});var AZ=AV.target.target;AZ.openPopup(AZ.getPopupWidget());},onItemsSelectionChange:function AU(AV){var AW=this.parent.parent.parent,AX=AW.model;AX.edit(AT?"data":"es",AV);}}];return{alias:"es",children:AN,cssClass:"lastStage",updateColumnContainer:function AP(){this.es.update();},setupScrollNodes:function AQ(){this.scrollNode=null;}};},getFnNodeProps:function c(){var AQ=this,AN=[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrApp.isWSStyling?mstrmojo.desc(15006,"Operator"):mstrmojo.desc(9579,"Condition")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"fnTypePulldown",items:[{n:mstrmojo.desc(15302,"By Value"),v:V.VALUE},{n:mstrmojo.desc(15303,"By Rank"),v:V.RANK_PERCENTAGE}],onSelectedItemChange:function AR(AT,AV){var AU=this.parent;AU.fn.update();}},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fn",multiSelect:false,allowUnlistedValues:false,hideCheckMark:true,itemIdField:"did",onchange:function AM(AT){d.call(this,AT);},update:function(){var AV=this.parent,AZ=AV.parent.parent,AU=AZ.model||{},Aa=AU.et,AY,Ab=false,Ac,AT,Ae=V.BOTH;switch(Aa){case x.AE:Ab=!!AU.a;break;case x.AQ:case x.AC:case x.AL:Ab=!!(AU.fm&&AU.fm.did);AY=Ab?AU.fm.dtp:null;break;case x.MQ:case x.MC:Ab=!!AU.m;AY=Ab?M.METRIC_DTP:null;Ae=AV.fnTypePulldown.getSelectedItem().v;break;}if(!Ab){return ;}var Ad=o[AY];if((this.lastEt!==Aa)||(this.lastFnDtp!==Ad)||(this.lastFnTypeToDisplay!==Ae)){this.lastEt=Aa;this.lastFnDtp=Ad;this.lastFnTypeToDisplay=Ae;var AX=Aa?v[Aa]:null,AW=AX&&AX.key;Ac=(AW&&AZ[AW])||AX.def||[];if(typeof (Ac)==="object"){Ac=Ac[Ad]||Ac["*"];}if(Ae!=V.BOTH){Ac=P.filter(Ac,function(Af){var Ag=Af.tp===n.PER||Af.tp===n.RANK;return Ae===V.RANK_PERCENTAGE?Ag:!Ag;});}AT=AI(AU.fn,AU.fnt||1);AT=P.filterOne(Ac,function(Af){return Af.did===(AT&&AT.did);});q(this,Ab,Ac,AT);if(!AT){this.set("selectedIndex",0);}}this.parent.updateScrollbars();}})];return{alias:"fn",children:AN,updateColumnContainer:function AS(){var Ab=this.parent,AX=Ab.parent,AW=AX.model,AY=AW&&AW.fn,Aa=AW&&AW.fnt,AZ=AW&&AW.et,AV=this.next,AU=AY===Z.IS_NULL||AY===Z.IS_NOT_NULL,AT=(AZ===x.MC||AZ===x.MQ);this.changeFnTypePdVisibility(AT);if(AT){this.fnTypePulldown.getPopupList().singleSelectByField((Aa===n.RANK||Aa===n.PER)?V.RANK_PERCENTAGE:V.VALUE,"v");}else{this.fn.update();}if(AY&&AU){Ab.removeTrailingContainer(this.idx);}else{if(AY&&!(AV&&AV.c0)){Ab.insertAndRemoveTrailing(this.idx,AQ.getC0NodeProps());}}AV=this.next;if(AV){AV.updateColumnContainer();}},changeFnTypePdVisibility:function AP(AU){this.fnTypePulldown.set("visible",AU);var AT=AD-AK-R;if(AU){AT-=(R+K);}this.fn.set("height",AT+"px");},setupScrollNodes:function AO(){this.scrollNode=null;}};},getC0NodeProps:function O(){var AO=this;return{alias:"c0",children:[{scriptClass:"mstrmojo.Label",cssClass:"baseOn",text:mstrmojo.desc(527,"Value")},k({alias:"c0",cstIndex:0}),{scriptClass:"mstrmojo.Label",alias:"btwn",cssClass:"btwn",text:mstrmojo.desc(308,"and"),visible:false},k({alias:"c1",cstIndex:1,visible:false}),{alias:"browseLink",scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-walkstep-browse",text:mstrmojo.desc(7926,"Browse..."),onclick:function(){this.parent.parent.parent.browse(this.parent.c0);},visible:false},g({scriptClass:"mstrmojo.ui.CheckList",alias:"fm2",fmPost:2,itemIdField:"did",filter:false,multiSelect:false,minimumSelectCnt:0,hasDummyLabel:false,height:AD-R*4-K*2-AK+"px",onchange:function AM(AQ){d.call(this,AQ,"fm2");}})],updateColumnContainer:function AP(){this.c0.update();var AZ=this.parent,AV=AZ.parent,AU=AZ.parent.model,AX=AU&&AU.fn,AQ=AX===Z.BETWEEN||AX===Z.NOT_BETWEEN||AX===S.BETWEEN||AX===S.BETWEEN_DESCENDING,AW=AX===Z.EQUAL||AX===Z.NOT_EQUAL||AX===Z.GREATER||AX===Z.GREATER_EQUAL||AX===Z.LESS||AX===Z.LESS_EQUAL,AY=this.idx,AT=this.next;this.browseLink.set("visible",AV.objectBrowsingEnabled&&AH(AU,AV.ets));this.btwn.set("visible",AQ);var AS=this.c1;AS.set("visible",AQ);if(AQ){AS.update();}else{if(AU.c1){AU.edit("c1",{v:null,dtp:null,skipET:true},true);}}if((!AU.a)&&AU.m&&this.domNode){W.addClass(this.domNode,"lastStage");}var AR=this.fm2;if(AU.a2&&AW){AR.update();AR.set("visible",true);}else{AR.set("visible",false);}E.call(this);},setupScrollNodes:function AN(){this.scrollNode=null;}};},browseObjs:function z(AR,AQ,AT){var AP=X.position(AR.parent.containerNode);AT=AT||{};AT.x=AP.x+40;AT.y=AP.y;this._super(AR,AQ,AT);var AN=AR.ob.browser,AM=AR.parent.opener.docModel,AO=AQ.alias,AS=AR.model.et;AM.controller.rootCtrl.loadDataProvider(function(AU){if(AO==="target"||AS===x.AQ){AN.rootFolder={did:"6F55FB47F9974EABA18CB0C5FF46785C"};}else{if(AS===x.MQ){AN.rootFolder={did:"E0CCB9CF22104A489CBE78D974AFD19E"};}}AN.model=AM;AN.set("dataProvider",AU);AN.set("opened",true);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.dom","mstrmojo.elementHelper","mstrmojo.func","mstrmojo.VisEnum","mstrmojo.num","mstrmojo.array","mstrmojo.VisMenuList","mstrmojo.mstr.EnumFunction","mstrmojo._HasMarkup","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.models.FormatModel","mstrmojo._FormatDefinition","mstrmojo.css","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.chart.model.enums.EnumDSSBaseFormType","mstrmojo.string","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui.rw.GhostImageContainer","mstrmojo.vi.ui.rw.FreezingImageContainer");mstrmojo.requiresClsP("mstrmojo.ui.menus","MenuConfig","EditorConfig");var N=document.getElementById("vis-measure-canvas"),E=document.getElementById("vis-measure-span"),f={},M={},q={},AC=mstrmojo.dom,d=mstrmojo.elementHelper,AT=mstrmojo.vi.ui.DatasetUnitMenuUtils,V=mstrmojo.VisEnum.EnumColorRankMode,p=mstrmojo.chart.model.enums.EnumDSSObjectType,AL=mstrmojo.chart.model.enums.EnumDSSBaseFormType,AR=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,AV=mstrmojo.chart.enums.EnumFontStyle,X=mstrmojo.hash,c=mstrmojo.string,Ac=mstrmojo.func.wrapMethods,Z=mstrmojo.VisEnum,Q=mstrmojo._FormatDefinition,Af=Z.SERVER_JSON_ERROR_TYPE,v=mstrmojo.vi.viz.EnumVizStyles,AM=mstrmojo.vi.enums.EnumFeatures,D=mstrmojo.vi.ui.rw.FreezingImageContainer,Aa=mstrmojo.vi.ui.rw.GhostImageContainer;var t=64,AE=128,C=4,x=5,b=6,F=7,e=mstrmojo,S=e.array,Ad=mstrmojo.array,A=e.desc,j=e.mstr.EnumFunction,U=mstrmojo.vi.enums.EnumDerivedElementType,AY=e._HasMarkup,Ab=e.css;var P;mstrmojo.requiresDescs(221,358,1422,2122,6017,5868,5869,11819,11827);function Ae(Ak,Aj){var Ai=mstrmojo.VisUtility;var Al=Ai.pluck(Aj,"tid"),Am=Ai.pluck(Aj,"eid"),Ah=(Ak.getDocModel&&Ak.getDocModel())||Ai.getPropertyByPath(Ak,"model.docModel");if(Ai.getPropertyByPath(Ah,"getColorBy") instanceof Function){return Ah.getColorBy(Al,Am);}}function AZ(Ah,Aj,Al){var Ak=Aj.id,Ai=Aj.getHost();if(Ai&&Ai.observableModel){Ah.forEach(function(An){var Am=Ai.observableModel[An];if(Am){Am.attachEventListener("valueChanged",Ak,Al);}});}}function Ag(Ai){var Ah={SINGLE:[{text:A(358,"Absolute"),value:j.FunctionAbs,n:A(358,"Absolute"),v:j.FunctionAbs}],PAIR:[{text:A(6017,"Add"),value:j.FunctionAdd,n:A(6017,"Add"),v:j.FunctionAdd},{text:A(2122,"Average"),value:j.FunctionAverage,n:A(2122,"Average"),v:j.FunctionAverage},{text:A(5868,"Least"),value:j.FunctionLeast,n:A(5868,"Least"),v:j.FunctionLeast},{text:A(5869,"Greatest"),value:j.FunctionGreatest,n:A(5869,"Greatest"),v:j.FunctionGreatest},{text:"A-B",value:j.FunctionMinus+";0",n:"A-B",v:j.FunctionMinus+";0"},{text:"B-A",value:j.FunctionMinus+";1",n:"B-A",v:j.FunctionMinus+";1"},{text:"A/B",value:j.FunctionDivide+";0",n:"A/B",v:j.FunctionDivide+";0"},{text:"B/A",value:j.FunctionDivide+";1",n:"B/A",v:j.FunctionDivide+";1"}],MORE:[{text:A(6017,"Add"),value:j.FunctionAdd,n:A(6017,"Add"),v:j.FunctionAdd},{text:A(2122,"Average"),value:j.FunctionAverage,n:A(2122,"Average"),v:j.FunctionAverage},{text:A(5868,"Least"),value:j.FunctionLeast,n:A(5868,"Least"),v:j.FunctionLeast},{text:A(5869,"Greatest"),value:j.FunctionGreatest,n:A(5869,"Greatest"),v:j.FunctionGreatest}]};return Ah[Ai];}function AQ(Ai,Ah){return !!(((Ai&&Ai.at)||0)&Ah);}function Y(Ah){return !Ah.cmSelCells.some(function(Ai){var Aj=Ah.getCellForNode(Ai);return d.isNonGroupNull(Aj)||!AQ(Aj,t)||Aj.dei!==undefined||Ah.model.isRecursiveAttribute(Aj.tid);});}function l(Ai){var Ah;return !Ai.cmSelCells.some(function(Aj){Ah=Ai.getCellForNode(Aj);return(d.isNonGroupNull(Ah)||!AQ(Ah,AE))||Ai.model.isRecursiveAttribute(Ah.tid);});}function W(Ak,Aj,Am,Al,Ai){var Ah=Am&&Am.func;if((Ah===Al)||(typeof Al==="string"&&Al.indexOf(Ah)===0&&Al.indexOf(";0")>0)){return ;}if(Ai){Ak.editDECalculation(Aj,Al);}else{Ak.derivedElementCalculation(Aj,Al);}}function m(At,Ar,Ap){var As=Ar&&Ar.es,Ah=(As&&As.length)||At.cmSelCells.length,Ak=(Ah===1)?"SINGLE":((Ah===2)?"PAIR":"MORE"),Aq=Ag(Ak),Aj=(Ar&&Ar.func),Al,Au=At.cmSelCells,Ai,Ao,An,Am;if(Ak==="PAIR"){if(Ar){Am=As[0].v>As[1].v;if(Am){An=As[0].n;Ao=As[1].n;Aq[4]={value:j.FunctionMinus+";1",v:j.FunctionMinus+";1"};Aq[5]={value:j.FunctionMinus+";0",v:j.FunctionMinus+";0"};Aq[6]={value:j.FunctionDivide+";1",v:j.FunctionDivide+";1"};Aq[7]={value:j.FunctionDivide+";0",v:j.FunctionDivide+";0"};}else{Ao=As[0].n;An=As[1].n;}}else{Ao=Ap(Au[0]);An=Ap(Au[1]);}Aq[C].text=Ao+" - "+An;Aq[x].text=An+" - "+Ao;Aq[b].text=Ao+" / "+An;Aq[F].text=An+" / "+Ao;Aq[C].n=Ao+" - "+An;Aq[x].n=An+" - "+Ao;Aq[b].n=Ao+" / "+An;Aq[F].n=An+" / "+Ao;}for(Al in Aq){if(typeof Aq[Al].value==="string"&&Aq[Al].value.indexOf(Aj)===0&&Aq[Al].value.indexOf(";0")>0){Ai=Aq[Al];break;}if(Aq[Al].value===Aj){Ai=Aq[Al];break;}}return{items:Aq,selectedItem:Ai};}function u(Ah,Ak){if(!Ah){return Ah;}if(Ak.length===1){return Ah[Ak[0]];}var Aj=(Ak&&Ak.length)||0,Ai;for(Ai=0;Ai<Aj;Ai++){Ah=Ah[Ak[Ai]];if(!Ah){break;}}return Ah;}function AS(Aj,Ai,Ah){return Aj.every(function(Ak){return Ak.ttp===Ai||Ak.ttp===Ah;});}function G(Ai,Al,Am){var Ak=(Al&&Al.length)||0,Aj,Ah,An=Ai;for(Aj=0;Aj<Ak-1;Aj++){Ah=Al[Aj];if(!An[Ah]){An[Ah]={};}An=An[Ah];}An[Al[Ak-1]]=Am;}function AB(Ap){var Aq,Ao,Ak,Am,Ah,An=this.model.docModel.datasets,Ai=false,Al=false,Aj={isDM:false};for(Aq in An){if(An.hasOwnProperty(Aq)){Ao=An[Aq].mx;S.forEach((Ao||[]),function(Ar){if(Ar.did===Ap){if(Ar.um||Ar.rdm){Al=true;}Ai=true;return false;}});if(Ai){break;}}}if(Al){Ah=this.model.data.gts.col;Ak=(Ah&&Ah[Ah.length-1]);if(Ak&&Ak.otp===-1){Am=Ak.es;}S.forEach((Am||[]),function(Ar){if(Ar.oid===Ap){Aj={isDM:true,id:Ar.id};return false;}});}return Aj;}function L(Ah,Ak){var An=[],Aj={act:"updateElementsPropertiesMap",epm:An},Al=[],Ai={},Ap=[Ai],Ao=this;An.push({epmk:Al,epmv:Ap});Ah.forEach(function(Ar){var As=Ar.tid,Au=Ar.tp,Aq=As===-1,At={ob:{did:Aq?"":As,tp:Au}};Al.push(At);});if(Ak&&Ak.indexOf("default")<0){Ai.v={vv:Ak};}var Am=[];Ai.k={chn:Am};Ah.forEach(function(As){var At=As.tid,Aq=At===-1,Ar;if(Aq){Ar=AB.call(Ao,As.eid);if(Ar.isDM){Am.push({emt:2,ei:Ar.id});}else{Am.push({emt:2,mt:{did:As.eid,tp:4,ql:0}});}}else{Am.push({emt:1,ei:As.eid,at:{did:At,tp:As.tp,ql:0}});}});return Aj;}function AN(Al,Aj){var Ak="00000000000000000000000000000000",Ai=Al&&Al.dropZones,Ah=S.find(Ai,"id",Aj);return Ah===-1?[]:S.filter(Ai[Ah].items,function(Am){return Am.t===4&&Am.id!==Ak;});}function AH(Am,Aj,Al,Ai,Ah){var An=Ai?Am:Am&&Am.parentNode;while(An&&(An!==Ah)){var Ak=An.getAttribute&&An.getAttribute(Aj);if(Ak!==null&&Ak.indexOf(Al)>=0){return true;}An=An.parentNode;}return false;}function AA(Ai,Aj){var Ah=X.walk("rootCtrl.docCtrl",mstrApp);if(Ah&&(typeof Ah.selectViPanel==="function")){Ah.selectViPanel(Aj);}Ai.getDocModel().selectVIUnit(Ai.parent.id,true);}var H={sessions:{},instances:[],init:function AI(){this.supportedEventTypes=[];if(window.TouchEvent){this.supportedEventTypes.push("TouchEvent");}else{if(window.PointerEvent){this.supportedEventTypes.push("PointerEvent");}}if(window.MouseEvent){this.supportedEventTypes.push("MouseEvent");}return this;},startNewSessions:function AF(Ah){var Al=this;var Aj=this;var Ai=document;var Ak=function(Av){var Aq=Ah.callbacks.start.bind(Ah.callbackThis),Ar=Ah.callbacks.change.bind(Ah.callbackThis),As=Ah.callbacks.end.bind(Ah.callbackThis),Au=Ah.callbacks.context;var An={};An.identifier=Av.identifier;An.context=X.clone(Au);An.clientX=Av.clientX;An.clientY=Av.clientY;var Ap=function Ap(Aw){var Ax=this.context;return Aq({api:Aj,event:Aw,session:this,context:Ax});};var At=function At(Ax,Aw){var Ay=this.context,A0=0,Az=0;A0=Aw.clientX-this.clientX;Az=Aw.clientY-this.clientY;this.clientX=Aw.clientX;this.clientY=Aw.clientY;var A1={api:Aj,event:Ax,deltaX:A0,deltaY:Az,session:this,context:Ay};return Ar(A1);};var Ao=function Ao(Aw){var Ax=this.context;return As({api:Aj,event:Aw,session:this,context:Ax});};An.onStart=Ap;An.onChange=At;An.onEnd=Ao;return An;};var Am=function(Ao,An){Ao.listeners={};Ao.listeners.change=function(Ap){var Aq=Al.getChangedSessions(Ap);for(var Ar=0;Ar<Aq.length;Ar++){if(Ao.identifier===Aq[Ar].identifier){return Al.sessions[Ao.identifier].onChange(Ap,Aq[Ar]);}}};Ao.listeners.end=function(Aq){var Ar=Al.getChangedSessions(Aq);for(var As=0;As<Ar.length;As++){if(Ao.identifier===Ar[As].identifier){if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(An)){Ai.removeEventListener("touchmove",Ao.listeners.change);Ai.removeEventListener("touchend",Ao.listeners.end);Ai.removeEventListener("touchcancel",Ao.listeners.end);}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(An)&&(An.pointerType&&An.pointerType!=="mouse")){Ai.removeEventListener("pointermove",Ao.listeners.change);Ai.removeEventListener("pointerleave",Ao.listeners.end);Ai.removeEventListener("pointerup",Ao.listeners.end);}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(An)&&!An.pointerType){Ai.removeEventListener("mousemove",Ao.listeners.change);Ai.removeEventListener("mouseup",Ao.listeners.end);}}}var Ap=Al.sessions[Ao.identifier].onEnd(Aq);delete Al.sessions[Ao.identifier];return Ap;}}};if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(An)){Ai.addEventListener("touchmove",Ao.listeners.change);Ai.addEventListener("touchend",Ao.listeners.end);Ai.addEventListener("touchcancel",Ao.listeners.end);}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(An)&&(An.pointerType&&An.pointerType!=="mouse")){Ai.addEventListener("pointermove",Ao.listeners.change);Ai.addEventListener("pointerleave",Ao.listeners.end);Ai.addEventListener("pointerup",Ao.listeners.end);}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(An)&&!An.pointerType){Ai.addEventListener("mousemove",Ao.listeners.change);Ai.addEventListener("mouseup",Ao.listeners.end);}}}};return function(Ap){var Aq=Al.getChangedSessions(Ap),Ao=Al.sessions,Ar=Aq.filter(function(As){if(Ao[As.identifier]){return false;}else{return true;}});Ar.forEach(function(As){Al.sessions[As.identifier]=Ak(As);Am(Al.sessions[As.identifier],Ap);});var An=[];Ar.forEach(function(As){An.push(Al.sessions[As.identifier].onStart(Ap));});return An;};},newInstance:function AK(Ak,An,Am){var Aj,Ai,Ah=this.getInstanceIndex(Ak);if(Ah!==-1){for(Aj=0;Aj<this.supportedEventTypes.length;Aj++){Ai=this.supportedEventTypes[Aj];if(Ai==="TouchEvent"){Ak.removeEventListener("touchstart",this.instances[Ah].starter);}else{if(Ai==="PointerEvent"){Ak.removeEventListener("pointerdown",this.instances[Ah].starter);}else{if(Ai==="MouseEvent"){Ak.removeEventListener("mousedown",this.instances[Ah].starter);}}}}delete this.instances[Ah];}var Al={domNode:Ak,callbacks:An,callbackThis:Am};Al.starter=this.startNewSessions(Al);if(Ah!==-1){this.instances[Ah]=Al;}else{this.instances.push(Al);}for(Aj=0;Aj<this.supportedEventTypes.length;Aj++){Ai=this.supportedEventTypes[Aj];if(Ai==="TouchEvent"){Ak.addEventListener("touchstart",Al.starter);}else{if(Ai==="PointerEvent"){Ak.addEventListener("pointerdown",Al.starter);}else{if(Ai==="MouseEvent"){Ak.addEventListener("mousedown",Al.starter);}}}}return this;},getInstanceIndex:function J(Ah){return S.find(this.instances,"domNode",Ah);},getInstance:function o(Ai){var Ah=this.getInstanceIndex(Ai);return this.instances[Ah];},getChangedSessions:function AD(Ah){var Ai=[];if(window.TouchEvent&&window.TouchEvent.prototype.isPrototypeOf(Ah)){var Al=Ah.changedTouches;for(var Aj=0;Aj<Al.length;Aj++){var Ak={};Ak.identifier=Al[Aj].identifier;Ak.clientX=Al[Aj].clientX;Ak.clientY=Al[Aj].clientY;Ai.push(Ak);}}else{if(window.PointerEvent&&window.PointerEvent.prototype.isPrototypeOf(Ah)&&(Ah.pointerType&&Ah.pointerType!=="mouse")){Ai.push({identifier:Ah.pointerId,clientX:Ah.clientX,clientY:Ah.clientY,});}else{if(window.MouseEvent&&window.MouseEvent.prototype.isPrototypeOf(Ah)&&!Ah.pointerType){Ai.push({identifier:"mouse",clientX:Ah.clientX,clientY:Ah.clientY,});}}}return Ai;}};var s=H.init();mstrmojo.VisUtility=mstrmojo.provide("mstrmojo.VisUtility",{getCache:function(){return JSON.stringify(q);},getUpdateColorMapAction:function(Ai,Ah){return L.call(this,Ai,Ah);},measureTextSize:function(Ai,Ah,Aj){return{width:this.measureTextWidth(Ai,Ah,Aj),height:this.measureTextHeight(Ai,Ah,Aj)};},measureTextWidth:function(Ak,Aj,Al,Ai,Ah){if(AC.isIE||AC.isIEW3C){return this.measureTextWidthWithSpan(Ak,Aj,Al,Ai,Ah);}return this.measureTextWidthWithCanvas(Ak,Aj,Al);},measureTextWidthWithCanvas:function(Ak,Al,Ao,Am){Am=Am||false;if(Ak===""){return 0;}if(Ak===" "){Ak="\u00A0";}var An=Al.fontFamily,Aq=Al.fontSize,Aj=Al.fontStyle,Ap=Al.fontWeight;if(typeof Aq==="number"){Aq+="pt";}Aj=Aj||"normal";Ap=Ap||"normal";Ao=Ao||0;var Ai=Am?undefined:u(f,[An,Aq,Aj,Ap,Ak]);if(!Ai){if(!N){N=document.createElement("canvas");N.width=0;N.height=0;N.id="vis-measure-canvas";N.style.position="absolute";N.style.top="0";N.style.fontSize="medium";document.body.appendChild(N);}var Ah=N.getContext("2d");Ah.font=Aj+" "+Ap+" "+Aq+" "+this.surroundWithQuotes(An);Ai=Math.ceil(Ah.measureText(Ak).width);G(f,[An,Aq,Aj,Ap,Ak],Ai);}return Ai+Ao;},measureTextWidthQuick:function(Ak,Al,Ao,Am){Am=Am||false;if(Ak===""){return 0;}if(Ak===" "){Ak="\u00A0";}var An=Al.fontFamily,Aq=Al.fontSize,Aj=Al.fontStyle,Ap=Al.fontWeight;if(typeof Aq==="number"){Aq+="pt";}Aj=Aj||"normal";Ap=Ap||"normal";Ao=Ao||0;var Ai=Am?undefined:u(f,[An,Aq,Aj,Ap,Ak]);if(!Ai){if(!N){N=document.createElement("canvas");N.width=0;N.height=0;N.id="vis-measure-canvas";N.style.position="absolute";N.style.top="0";N.style.fontSize="medium";document.body.appendChild(N);}var Ah=N.getContext("2d");Ah.font=Aj+" "+Ap+" "+Aq+" "+this.surroundWithQuotes(An);Ai=Math.ceil(Ah.measureText(Ak).width);G(f,[An,Aq,Aj,Ap,Ak],Ai);}return Ai+Ao;},measureTextWidthWithSpan:function(Ak,Al,Ap,Ar,Am,Ah){if(Ak===""){return 0;}if(Ak===" "){Ak="\u00A0";}var An=Al.fontFamily,As=Al.fontSize,Aj=Al.fontStyle,Ao=Al.fontWeight;if(typeof As==="number"){As+="px";}Aj=Aj||"normal";Ao=Ao||"normal";Ar=Ar||"auto";Ap=Ap||0;Am=!!Am;if(typeof Ar==="number"){Ar+="px";}var Ai=u(M,[An,As,Aj,Ao,Ar,Ak]);if(!Ai||Ah){var Aq;if(!E){E=document.createElement("span");Aq=E.style;E.id="vis-measure-span";Aq.position="absolute";Aq.top="0";Aq.visibility="hidden";Aq.width="auto";Aq.height="auto";if(Am){Aq.whiteSpace="nowrap";}else{Aq.whiteSpace="normal";}document.body.appendChild(E);}Aq=E.style;if(Am){Aq.whiteSpace="nowrap";}else{Aq.whiteSpace="normal";}Aq.width="auto";Aq.height=Ar;Aq.fontFamily=this.surroundWithQuotes(An);Aq.fontSize=As;Aq.fontStyle=Aj;Aq.fontWeight=Ao;E.innerHTML=c.encodeHtmlString(Ak);Ai=Math.ceil(E.clientWidth);G(M,[An,As,Aj,Ao,Ar,Ak],Ai);}return Ai+Ap;},measureTextHeight:function(Aj,Ak,Ap,As,Ah,Am,Al){if(Aj===""){return 0;}if(Aj===" "){Aj="\u00A0";}var An=Ak.fontFamily,Au=Ak.fontSize,Ai=Ak.fontStyle,Ao=Ak.fontWeight,Ar=Ak.lineHeight||"inherit";Ah=Ah||"normal";Al=!!Al;if(typeof Au==="number"){Au+="px";}Ai=Ai||"normal";Ao=Ao||"normal";As=As||"auto";Ap=Ap||0;if(typeof As==="number"){As+="px";}var At=Am?undefined:u(q,[An,Au,Ai,Ao,As,Aj]);if(!At){var Aq;if(!E){E=document.createElement("span");Aq=E.style;E.id="vis-measure-span";Aq.position="absolute";Aq.top="0";Aq.visibility="hidden";Aq.width="auto";Aq.height="auto";if(Al){Aq.whiteSpace="nowrap";}else{Aq.whiteSpace="normal";}document.body.appendChild(E);}Aq=E.style;if(Al){Aq.whiteSpace="nowrap";}else{Aq.whiteSpace="normal";}Aq.heigth="auto";Aq.width=As;Aq.lineHeight=Ar;Aq.fontFamily=this.surroundWithQuotes(An);Aq.fontSize=Au;Aq.fontStyle=Ai;Aq.fontWeight=Ao;Aq.wordBreak=Ah;E.innerHTML=c.encodeHtmlString(Aj);At=E.clientHeight;if(!Am){G(q,[An,Au,Ai,Ao,As,Aj],At);}}return At+Ap;},getVisEmptyMsg:function(Ah,Ai){var Aj="";switch(Ah){case"AE_ERROR":Aj='<div class="gm-vis-msg-container"><div class="gm-vis-msg-vcenter"><div class="gm-vis-msg-hcenter"><div style="padding:25px"><div class="gm-warning-icon" style="padding-bottom:18px"></div><div style="padding-bottom:8px">'+(Ai||this.errorMsg||"")+"</div><div></div></div></div></div></div>";break;case"NODATA_OTHERERROR":Aj='<div class="error-msg"><div class="error-content"><div class="text" style="visibility: visible;padding-top:0px;"><div>'+(this.errorMsg||mstrmojo.desc(2388,"No data returned for this view. This might be because the applied filter excludes all data."))+"</div></div></div></div>";break;default:Aj='<div class="mstrmojo-Label dropMsg" style="display: block;" >'+mstrmojo.desc(11668,"Drag objects here.")+"</div>";}return Aj;},getVisEmptyMsgControls:function B(){var Aj=this.error,Ao,Am=this.errorType,Ai;var Ak=mstrmojo.VisUtility;if(this.excludeData){Ao=Ak.getVisStyle.call(this);var Al=Ak.getAttMetricCount.call(this);return[{scriptClass:"mstrmojo.vi.ui.rw.FreezingImageContainer",cssClass:Ao,visName:mstrConfig.pluginsVisList[Ao]&&mstrConfig.pluginsVisList[Ao].d,visDropzoneMsg:D.getVisDropzoneMsg(Al.attCount,Al.metricCount)}];}if(!this.hasError()){return ;}switch(Am){case Af.NO_DATASET:case Af.NO_TEMPLATE_UNIT:if(mstrApp&&mstrApp.supportFeature&&mstrApp.supportFeature(AM.SUPPORT_GHOST_IMG)){Ao=Ak.getVisStyle.call(this);var Ap="",An="",Ah="";if(Ao===v.HEAT_MAP){Ap="heatmap";An=mstrmojo.desc(11819,"Heat Map");Ah=Aa.getVisDesc("heatmap");}else{if(Ao===v.NETWORK){Ap="network";An=mstrmojo.desc(11827,"Network");Ah=Aa.getVisDesc("network");}else{if(Ao===v.KPICARD){Ap="kpicard";An=mstrmojo.desc(15800,"KPI");Ah=Aa.getVisDesc("kpicard");}}}Ai=[{scriptClass:"mstrmojo.vi.ui.rw.GhostImageContainer",cssClass:Ap,visName:An,visDesc:Ah}];}else{Ai=[{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:Aj}];}break;case Af.AE_ERROR:Ai=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:Ak.getVisEmptyMsg("AE_ERROR",Aj),markupSlots:{containerNode:function(){return this.domNode;}}}];break;default:Ai=[{scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content" style="visibility: visible">'+Aj+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;}}}];break;}return Ai;},applyStyles2DomNode:function(Am,Ap){var Ah,An=Am.style;if(Object.prototype.hasOwnProperty.call(Ap,"backgroundColor")&&Ap.backgroundColor!==""&&Ap.backgroundColor!=="transparent"){var Al=1;if(Object.prototype.hasOwnProperty.call(Ap,"opacity")&&Ap.opacity!==""){Al=Ap.opacity;}var Ai=Ap.backgroundColor,Ao=function Ao(Aq){if(isNaN(Aq)){Aq=0;}Aq%=16777216;return{b:Aq%256,g:(Aq>>8)%256,r:(Aq>>16)%256};},Ak="";if(Ai){var Aj=function Aj(Ar,As){if(Ar==="transparent"){return"rgba(0,0,0,0)";}Ar=this.parseCSSColor(Ar,false);var Aq=Ao(Ar);return"rgba("+Aq.r+" ,"+Aq.g+" ,"+Aq.b+" ,"+As+" )";}.bind(this);if(Ai.c1!==undefined&&Ai.c2!==undefined&&Ai.or!==undefined){Ak=(Ab.buildGradient(Ai.or,Aj(Ai.c1,Al),Aj(Ai.c2,Al))).v;}else{Ak=Aj(Ai,Al);}An.background=Ak;}}else{An.backgroundColor="rgba(0,0,0,0)";}for(Ah in Ap){if(Ah!=="backgroundColor"&&Ah!=="opacity"&&Object.prototype.hasOwnProperty.call(Ap,Ah)&&Ap[Ah]&&Ap[Ah]!==""){An[Ah]=Ap[Ah];if(Ah==="fontFamily"){An[Ah]="'"+Ap[Ah]+"'";}}}},parseCSSColor:function(Al,Ai){var Ah,Aj;if(Al.length===7){if(Ai===true){Ah=Al[5]+Al[6]+Al[3]+Al[4]+Al[1]+Al[2];}else{Ah=Al.slice(1);}}else{Ah=[];var Ak=Al.slice(1);if(Ai===true){for(Aj=2;Aj>=0;Aj--){Ah.push(Ak[Aj]);Ah.push(Ak[Aj]);}}else{for(Aj=0;Aj<3;Aj++){Ah.push(Ak[Aj]);Ah.push(Ak[Aj]);}}Ah=Ah.join("");}return parseInt(Ah,16);},positionDomNode:function(Aj,Al){var Ai,Ao,Am,Ak=["width","height","top","left","right","bottom"],An=Ak.length,Ah=Aj.style;for(Ai=0;Ai<An;Ai++){Ao=Ak[Ai];Am=Al[Ao];if(Am!==undefined){if((typeof Am)==="number"){Am+="px";}Ah[Ao]=Am;}}},getComputedFontStyle:function K(Aj){var Ah=mstrmojo.css.getComputedStyle(Aj);var Ak={};Ak.fontFamily=Ah.fontFamily;Ak.fontSize=Ah.fontSize;Ak.fontStyle=Ah.fontStyle;Ak.fontWeight=Ah.fontWeight;Ak.fontVariant=Ah.fontVariant;var Ai=parseInt(Ah.paddingLeft)||0,Al=parseInt(Ah.paddingLeft)||0;Ak.bonus=Ai+Al;return Ak;},splitWordIfTooLong:function(Ar,Ap,Ak){var An=[];var Ao=Ar.length;var Al;for(Al=0;Al<Ao;Al++){var Ai=Ar[Al];while(true){var As=this.measureTextWidth(Ai,Ak);if(As>Ap){var Aq=(Ap/As)*Ai.length;var Ah=Math.max(Math.round(Aq),1);while(Ah>0){var Am=Ai.substr(0,Ah);var Aj=Math.round(this.measureTextWidth(Am,Ak));if(Aj<=Ap||Ah===1){An.push(Am);break;}else{Ah--;}}Ai=Ai.substr(Ah,Ai.length-Ah);}else{An.push(Ai);break;}}}return An;},truncateTextToLineWithWordWrap:function k(A7,A0,Ay,An,Az,Ar){var Av=A7.split(" "),A1=Av.length;if(!Ar){Av=this.splitWordIfTooLong(Av,Ay,A0);}var BE,At=[],A9=[],Ah=0,Al=Av.length,BG=this.measureTextWidth(" ",A0),Ak=0,Aq=false,Ax=(A1===Av.length);A9.push(0);for(BE=0;BE<Al;BE++){var A5=this.measureTextWidth(Av[BE],A0);if(!Ar&&A5>Ay){var Ai=Av[BE];var BC=(Ay/A5)*Ai.length;Av[BE]=Ai.substr(0,parseInt(BC,10));A5=Ay;}At.push(A5);Ah+=A5;A9.push(Ah);if(BE!==Al-1){Ah+=BG;}}var BB,BD,A3=An;for(BB=0,BD=0;BD<A9.length;){var Ap=A9[BD]-A9[BB];if(BB>0&&BD!==BB){Ap-=BG;}var Ao=A9[BD+1]-A9[BB];if(BB>0&&BD+1!==BB){Ao-=BG;}if(Ap<=Ay&&((BD+1===A9.length)||(Ao>Ay))){Ak=Math.max(Ak,Ap);A3--;if(A3===0||BD===Al){break;}else{BB=BD;BD++;}}else{BD++;}}if(BD>Al){BD=Al;}var As=A9[BD]-A9[BB];if(BB>0&&BD!==BB){As-=BG;}var A6;if(BD>=Al&&As<Ay){A6=Av.join(" ");}else{Aq=true;Ak=Ay;A6=Av.slice(0,BD).join(" ");var Au=this.measureTextWidth("...",A0);if(As+Au<=Ay){if(As+BG+Au>Ay){A6+="...";}else{var BF=Av[BD],Aw;for(var A2=1;A2<BF.length;A2++){Aw=this.measureTextWidth(BF.substr(0,A2),A0);if(As+BG+Aw+Au>Ay){break;}}A6+=" "+BF.substr(0,A2-1)+"...";}}else{if(A6.charAt(A6.length-1)===" "){A6=A6.substr(0,A6.length-1);}var A4=A6.lastIndexOf(" ");var Aj=A6.length-1-A4;if(Aj===3){A6=A6.substr(0,A6.length-3)+" ...";}else{var A8=0,Am="",BA=0;while(A8<Au&&A6.length>BA){BA++;Am=A6.substr(A6.length-BA,A6.length);A8=this.measureTextWidth(Am,A0);}A6=A6.substr(0,A6.length-BA)+"...";}}}if(Az){return{text:A6,truncated:Aq,maxLineLen:Ak,canWordWrap:Ax};}return A6;},measureSuperTextWidth:function w(Ai,Aj,Ah,Ak){return Ai?this.measureTextWidth("<sup>"+Aj+"</sup>",Ah,Ak):this.measureTextWidth(Aj,Ah,Ak);},splitTokenIfTooLong:function h(As,Aq,Ak){var Ao=[];var Ap=As.length;var Al,Ai,At,An,Au;for(Al=0;Al<Ap;Al++){Ai=As[Al];An=Ai.isSuper;while(true){At=Ai.v;if(Ai.textWidth!==undefined){Au=Ai.textWidth;}else{Au=Ai.textWidth=this.measureSuperTextWidth(An,At,Ak);}if(Au>Aq){var Ar=(Aq/Au)*At.length;var Ah=Math.max(Math.round(Ar),1);while(Ah>0){var Am=At.substr(0,Ah);var Aj=Math.round(this.measureSuperTextWidth(An,Am,Ak));if(Aj<=Aq||Ah===1){Ao.push({v:Am,isSuper:An,textWidth:Aj});break;}else{Ah--;}}Ai={v:At.substr(Ah,At.length-Ah),isSuper:An};}else{Ao.push(Ai);break;}}}return Ao;},truncateTextToLineWithWordWrapForTokens:function AW(Ar,Al,BA,A2,BB,Ax){var A5=Ar.length;Ar=this.splitTokenIfTooLong(Ar,BA,Al);var A9,Aw=[],Ah=0,A0=Ar.length,Ai=0,A1=false,An=(A5===Ar.length),Ap,Au,A3,Aj,A7,Aq,Av;if(Ax&&!An){return{canWordWrap:An};}Aw.push(0);for(A9=0;A9<A0;A9++){Ap=Ar[A9];A3=Ap.v;Au=Ap.isSuper;if(Ap.textWidth!==undefined){Aj=Ap.textWidth;}else{Aj=Ap.textWidth=this.measureSuperTextWidth(Au,A3,Al);}if(Aj>BA){var A8=(BA/Aj)*A3.length;Ap.v=A3.substr(0,parseInt(A8,10));Aj=Ap.textWidth=BA;}Ah+=Aj;Aw.push(Ah);}var At,A4,As=A2;for(At=0,A4=0;A4<Aw.length;){var Ao=Aw[A4]-Aw[At];var Am=Aw[A4+1]-Aw[At];if(Ao<=BA&&((A4+1===Aw.length)||(Am>BA))){Ai=Math.max(Ai,Ao);As--;if(As===0||A4===A0){break;}else{At=A4;A4++;}}else{A4++;}}if(A4>A0){A4=A0;}var Az=Aw[A4]-Aw[At];var BC;if(A4>=A0&&Az<BA){BC=Ar;}else{A1=true;Ai=BA;BC=Ar.slice(0,A4);var Ak=this.measureTextWidth("...",Al);if(Az+Ak<=BA){Aq=Ar[A4];A3=Aq.v;Au=Aq.isSuper;for(A7=1;A7<A3.length;A7++){Av=this.measureSuperTextWidth(Au,A3.substr(0,A7),Al);if(Az+Ak+Av>BA){break;}}if(A7>1){Ap={v:A3.substr(0,A7-1),isSuper:Au};Ap.textWidth=this.measureSuperTextWidth(Au,Ap.v,Al);BC.push(Ap);BC.push({v:"...",textWidth:Ak});}}else{var Ay=0,A6;for(A9=BC.length-1;A9>=0;A9--){Ap=BC[A9];A3=Ap.v;Au=Ap.isSuper;A6=0;for(A7=A3.length-1;A7>=0;A7--){A6=this.measureSuperTextWidth(Au,A3.substr(A7),Al);if(Ay+A6>=Ak){break;}}if(A7>=0){break;}else{Ay+=A6;}}if(A9>=0){if(A7>0){Ap.v=A3.substr(0,A7);Ap.textWidth=this.measureSuperTextWidth(Au,Ap.v,Al);BC=BC.slice(0,A9+1);}else{if(A7===0){BC=BC.slice(0,A9);}}BC.push({v:"...",textWidth:Ak});}else{BC=[{v:"...",textWidth:Ak}];}}}if(BB){return{text:BC,truncated:A1,maxLineLen:Ai,canWordWrap:An};}return BC;},getRankMode:function O(An){var Ap=1,Ao=2,Am=3,Ai=4,Ak=5,Ah=6,Al=7,Aj=V.INVALID;if(An){if(AS(An,Am,Ao)){Aj=V.TOP_PERCENT;}else{if(AS(An,Am,Ap)){Aj=V.BOTTOM_PERCENT;}else{if(AS(An,Ah,Ai)){Aj=V.BOTTOM;}else{if(AS(An,Ah,Ak)){Aj=V.TOP;}else{if(AS(An,Al)){Aj=V.VALUE;}}}}}}return Aj;},getColorByTitle:function a(Ai,Ah){if(Ah===V.BOTTOM_PERCENT||Ah===V.TOP_PERCENT){Ai=mstrmojo.desc(2787,"Percentage of ##").replace("'##'",Ai);}else{if(Ah===V.BOTTOM||Ah===V.TOP){Ai=mstrmojo.desc(2788,"Rank of ##").replace("'##'",Ai);}}return Ai;},getColorByFormatStr:function g(Ai,Ah){if(Ah===V.BOTTOM_PERCENT||Ah===V.TOP_PERCENT){Ai="0%;(0%)";}else{if(Ah===V.BOTTOM||Ah===V.TOP){Ai="";}}return Ai;},getColorByItems:function AX(Ah,Ar,Ay,Au,Ap,An,Av){var At=[],Az,Aj,Ao=mstrmojo.num,Am,Aq;if(Ah===undefined||Ah.length===0){return At;}var A1=true;if(Ah.length>1){if(Ah[0].ceil===Ah[1].flr){A1=false;}else{A1=true;}}for(Az=0;Az<Ah.length;Az++){var A0=Ah[Az],Al={},Ai=A0.ceil,Ax=A0.flr;if((Az===0&&A1)||(Az===Ah.length-1&&!A1)){if(Ar===V.BOTTOM_PERCENT||Ar===V.TOP_PERCENT){Al.flr=Ax/100;Al.ceil=1;}else{if(Ar===V.TOP||Ar===V.BOTTOM){Ax+=1;Al.flr=Math.floor(Ax);Al.ceil=Ap;}else{Al.flr=Ax;Al.ceil=Ay;}}Aq=Al.ceil;}else{if((Az===0&&!A1)||(Az===Ah.length-1&&A1)){if(Ar===V.BOTTOM_PERCENT||Ar===V.TOP_PERCENT){Al.flr=0;Al.ceil=Ai/100;}else{if(Ar===V.TOP||Ar===V.BOTTOM){Al.flr=0;Al.ceil=Math.floor(Ai);}else{Al.flr=Au;Al.ceil=Ai;}}Am=Al.flr;}else{if(Ar===V.BOTTOM_PERCENT||Ar===V.TOP_PERCENT){Ax=Ax/100;Ai=Ai/100;}else{if(Ar===V.TOP||Ar===V.BOTTOM){Ax+=1;Ax=Math.floor(Ax);Ai=Math.floor(Ai);}}Al.flr=Ax;Al.ceil=Ai;}}if(Ar===V.TOP||Ar===V.BOTTOM){Al.ceil=Al.ceil>Ap?Ap:Al.ceil;}if(An){Al.label=Ao.formatByMask(An,Al.flr);if(Al.flr!==Al.ceil){Al.label+=" - "+Ao.formatByMask(An,Al.ceil);}}else{Al.label=Al.flr;if(Al.flr!==Al.ceil){Al.label+=" - "+Al.ceil;}}if(A0.fmt&&A0.fmt.bc){Al.color=A0.fmt.bc;}else{Al.color=Av;}At.push(Al);}At=At.filter(function(A2){return A2.flr<=A2.ceil&&!(A2.flr>Aq||A2.ceil<Am);});if(Ar!==V.VALUE){if(At[0]&&(At[0].label===0)){At.shift();}}if(Ar===V.TOP||Ar===V.BOTTOM){Aj=Ap;}else{if(At.length>0){if(A1){Aj=At[0].ceil-At[(At.length-1)].flr;}else{Aj=At[(At.length-1)].ceil-At[0].flr;}}}var Aw=0,As,Ak;for(Az=0;Az<At.length;Az++){if(Az===At.length-1){At[Az].scopePercent=1-Aw;}else{if(Ar===V.TOP||Ar===V.BOTTOM){Ak=At[Az].ceil-At[Az].flr+1;}else{Ak=At[Az].ceil-At[Az].flr;}As=Ak/Aj;At[Az].scopePercent=As;Aw+=As;}}return At;},getDefaultColorByItems:function(Ak,Ai,Aj){var Ah={};Ah.label=Aj+" - "+Ai;Ah.flr=Aj;Ah.ceil=Ai;Ah.color=Ak;Ah.scopePercent=1;return[Ah];},getNumberFormat:function(Ak,Ai){var Al=Ak.nf,Aj=Ak.gvs;function Ah(){var Ao=(Aj&&Aj.items&&Aj.items[0]&&Aj.items[0].items)||[],An=Ao[Ai]||{},Am=An.nfs;return typeof Am==="string"?Am:"";}if(Al[Ai]&&typeof Al[Ai].nfs!=="string"){Al[Ai].nfs=Ah();}return Al[Ai]&&Al[Ai].nfs;},hasOnlyMetricsOnColumn:function(Ai){var Ah=(Ai&&Ai.gts&&Ai.gts.col)||[];return Ah.every(function(Aj){return Aj.otp===p.DssTypeUnknown&&(Aj.es||[]).every(function(Ak){return Ak.otp===p.DssTypeMetric;});});},hasNoMetricOnRow:function(Ai){var Aj=(Ai&&Ai.gts&&Ai.gts.row)||[],Ah=function(Ak){return Ak.otp!==p.DssTypeMetric;};return Aj.every(Ah);},getAttMetricCount:function(){var Ak=this.getEditingGridData&&this.getEditingGridData()||this.model&&this.model.data,Ao=Ak&&Ak.gsi,An=Ao&&Ao.rows||[],Aj=Ao&&Ao.cols||[],Ai=[].concat(An).concat(Aj),Am=Ao&&Ao.mx||[],Ah=0,Al=Am.length;Ad.forEach(Ai,function(Ap){if(Ap.t!==p.DssTypeMetric){Ah++;}});return{attCount:Ah,metricCount:Al};},isOnExpressMode:function(){return mstrApp.isExpress;},modifyScExp:function(Ap,Ah,At,An){if(!Ap||!Ah){return ;}var Ak=Ap.nds,Ao,Ai,Aq,As,Ar,Am,Al,Aj;Ad.forEach(Ak||[],function(Au){Ao=Au.nds;Ad.forEach(Ao||[],function(Av){Ai=Av.es;Ad.forEach(Ai||[],function(Aw){As=Aw.v;Am=An[As];if(!Am){Am=At.getNormalizedFormElementId(As);An[As]=Am;}Ad.forEach(Ah||[],function(Ax){Aq=Ax.es;Ad.forEach(Aq||[],function(Ay){Aj=false;Ar=Ay.id;if(Ar===As){Aj=true;}else{Al=An[Ar];if(!Al){Al=At.getNormalizedFormElementId(Ar);An[Ar]=Al;}if(Am===Al){Aj=true;}}if(Aj){Aw.v=Ay.id;Aw.n=Ay.n;return false;}});if(Aj){return false;}});});});});},modifyScExpDeprecated:function(An,Ao,Al,Aj){if(!An||!Ao){return ;}var Ak=An.nds,Ai,Ah,Am;Ad.forEach(Ak||[],function(Ap){Ai=Ap.nds;Ad.forEach(Ai||[],function(Aq){Ah=Aq.es;Ad.forEach(Ah||[],function(Ar){Ad.forEach(Ao||[],function(As){Ad.forEach(As||[],function(At){Am=At.es;Ad.forEach(Am||[],function(Au){if(Al.call(Aj,Au.id,Ar.v)){Ar.v=Au.id;Ar.n=Au.n;}});});});});});});},getMouseOffset:function(Ai){var Ah=(Ai.offsetX!==undefined)?Ai.offsetX:(Ai.layerX),Aj=(Ai.offsetY!==undefined)?Ai.offsetY:(Ai.layerY);return{x:Ah,y:Aj};},translateLineStyle:function(Ah){var Aj=["none","solid","solid","dashed","dotted"],Ai=["1px","1px","2px","1px","1px"];return{width:Ai[Ah]||"0px",style:Aj[Ah]||"none"};},getVisStyle:function(){var Ah=mstrmojo.VisUtility;return Ah.getPropertyByPath(this,"model.data.visName")||Ah.getPropertyByPath(this,"model.data.vis.vn");},getGroupAndCalculationContextMenuForDataPoints:function(As,A6){var Au,Aw=[],Aj=[],A3=[],Ao=A6.fnCellName,Ay=A6.fnUnique,An=A6.fnMakeNode,A1=As.getCellForNode.bind(As),A8=A6.selection;var Am=new e.ui.menus.MenuConfig(),Ai=new e.ui.menus.MenuConfig(),A0=new e.ui.menus.MenuConfig(),A5=new e.ui.menus.MenuConfig();function A7(A9){As.cmSelCells=Aw[A9].cmSelCells;As.derivedElementGroup(A1(As.cmSelCells[0]));}function Ap(BB){As.cmSelCells=Aj[BB].cmSelCells;var BA=A1(Aj[BB].cmSelCells[0]),A9=As.getDEInfo(BA);As.derivedElementsEdit(A1(As.cmSelCells[0]),A9);}function Ax(BA){As.cmSelCells=Aj[BA].cmSelCells;var A9=A1(Aj[BA].cmSelCells[0]);As.removeQuickDE(A9);}function Av(BA){As.cmSelCells=Aj[BA].cmSelCells;var A9=A1(Aj[BA].cmSelCells[0]);As.renameDEList(A9);}function Az(A9){W(As,A1(As.cmSelCells[0]),null,A9,false);}function Ah(A9){W(As,A1(As.cmSelCells[0]),null,A9,true);}function Al(BA){var A9=A1(Aj[BA].cmSelCells[0]);As.removeQuickDE(A9);}function A4(BA){var A9=A1(Aj[BA].cmSelCells[0]);As.editDECalculation(A9);}function Aq(BA,A9){return function(){var BB=new e.ui.menus.MenuConfig();BB.addNonInteractiveMenuItem(mstrmojo.desc(11859,"Based on"),"xt",true);BB.addRadioMenuGroup(null,BA,A9,"checkMark",undefined,true);return BB;};}function At(A9){A9=A9||[];function BA(BE){var BB=BE.extra||{},BF=BE.setup||mstrmojo.emptyFn,BC=BE.action||mstrmojo.emptyFn,BD=[];BF(BD,BB);BC(BD,BB);}A9.forEach(BA);}var Ak=[{name:"group",setup:function(A9){Aw.forEach(function(BA){As.cmSelCells=Aw[BA.v].cmSelCells;if(!Object.prototype.hasOwnProperty.call(Aj,BA.v)&&Y(As)){A9.push(BA);}});},action:function(BA){var A9;if(BA.length===1){A9=BA[0].v;Am.addMenuItem(mstrmojo.desc(1911,"Group"),"xt",function(){As.cmSelCells=Aw[A9].cmSelCells;As.derivedElementGroup(A1(As.cmSelCells[0]));});}if(BA.length>1){Am.addPopupMenuItem(mstrmojo.desc(1911,"Group"),As.id,Aq(A7,BA),"xt");}}},{name:"edit-group",setup:function(A9){Aj.forEach(function(BD){var BC=A1(Aj[BD.v].cmSelCells[0]),BB=As.getDEInfo(BC),BA=BB&&BB.de;if(BA&&BA.t===U.LIST){A9.push(BD);}});},action:function(BA){var A9,BC,BB;if(BA.length===1){A9=Aj[BA[0].v].cmSelCells;BC=A1(A9[0]);BB=As.getDEInfo(BC);Ai.addMenuItem(mstrmojo.desc(13395,"Edit Group..."),"xt",function(){As.cmSelCells=A9;As.derivedElementsEdit(A1(As.cmSelCells[0]),BB);});Ai.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"xt",function(){As.cmSelCells=A9;As.removeQuickDE(BC);});A5.addMenuItem(mstrmojo.desc(13968,"Rename Group..."),"xt",function(){As.cmSelCells=A9;As.renameDEList(BC);});}if(BA.length>1){Ai.addPopupMenuItem(mstrmojo.desc(13395,"Edit Group..."),As.id,Aq(Ap,BA),"xt");Ai.addPopupMenuItem(mstrmojo.desc(12195,"Ungroup"),As.id,Aq(Ax,BA),"xt");A5.addPopupMenuItem(mstrmojo.desc(13968,"Rename Group..."),As.id,Aq(Av,BA),"xt");}}},{name:"calculation",setup:function(A9){A3.forEach(function(BC,BB,BA){As.cmSelCells=BA[BC.v].cmSelCells;var BE=A1(As.cmSelCells[0]),BD=As.getDEInfo(BE),BF=BD&&BD.de;if(!(BF&&BF.t===U.RESIDUE)&&l(As)){A9.push(BC);}});},action:function(A9){if(A9.length===1){Am.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),As.id,function(){var BA=A9[0].v,BB=new e.ui.menus.MenuConfig();As.cmSelCells=A3[BA].cmSelCells;BB.addRadioMenuGroup(null,Az,m(As,null,Ao).items,"checkMark",undefined,true);return BB;},"xt");}if(A9.length>1){Am.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),As.id,function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:"base-on-calculation-editor",data:{},hasToggleItem:true,contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attrList",items:A9,selectedIndex:0,onitemSelected:function(BA){var BB=BA.v;As.cmSelCells=A3[BB].cmSelCells;this.parent.checkList.set("items",[]);this.parent.checkList.set("items",m(As,null,Ao).items);this.parent.data.set("valid",false);}},{scriptClass:"mstrmojo.VisMenuList",alias:"checkList"}],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(BB,BA){W(As,A1(As.cmSelCells[0]),null,BA.checkList.selectedItem.v,false);}});});}}},{name:"edit-calculation",setup:function(A9){Aj.forEach(function(BD){var BC=A1(Aj[BD.v].cmSelCells[0]),BB=As.getDEInfo(BC),BA=BB&&BB.de;if(BA&&BA.t===U.CALCULATION&&l(As)){A9.push(BD);}});},action:function(A9){function BA(){var BB=A9[0].v;As.cmSelCells=Aj[BB].cmSelCells;var BF=A1(As.cmSelCells[0]),BE=As.getDEInfo(BF),BG=BE&&BE.de,BD=m(As,BG,Ao),BC=new e.ui.menus.MenuConfig();BC.addRadioMenuGroup(BD.selectedItem.value,Ah,BD.items,"checkMark",undefined,true);return BC;}if(A9.length===1){A0.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),As.id,BA,"xt");A0.addMenuItem(mstrmojo.desc(12197,"Delete Calculation"),"xt",function(){var BB=A9[0].v;As.cmSelCells=Aj[BB].cmSelCells;var BC=A1(As.cmSelCells[0]);As.removeQuickDE(BC);});A5.addMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),"xt",function(){var BB=A9[0].v;As.cmSelCells=Aj[BB].cmSelCells;var BC=A1(As.cmSelCells[0]);As.editDECalculation(BC);});}if(A9.length>1){A0.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),As.id,function(){return new mstrmojo.ui.menus.EditorConfig({data:{},hasToggleItem:true,contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attrList",items:A9,selectedIndex:0,onitemSelected:function(BE){var BF=BE.v;As.cmSelCells=Aj[BF].cmSelCells;var BD=A1(As.cmSelCells[0]),BC=As.getDEInfo(BD),BG=BC&&BC.de;var BB=m(As,BG,Ao);this.parent.checkList.set("items",[]);this.parent.checkList.set("items",BB.items);this.parent.checkList.set("selectedItem",BB.selectedItem);this.parent.data.set("valid",false);}},{scriptClass:"mstrmojo.VisMenuList",alias:"checkList"}],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(BC,BB){W(As,A1(As.cmSelCells[0]),null,BB.checkList.selectedItem.v,true);}});});A0.addPopupMenuItem(mstrmojo.desc(12197,"Delete Calculation"),As.id,Aq(Al,A9),"xt");A5.addPopupMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),As.id,Aq(A4,A9),"xt");}}}];Au=Ay(A8);Au.forEach(function(BA){var BC=An(BA),A9=A1(BC),BB,BD,BE;if(!As.model.supportsViewFilterActions(A9.tid)){return ;}BB=A9.dei===undefined?Aw:Aj;BD=A9.tid;BE=As.model.getObjectInfo(BD).n;if(BB[BD]===undefined){BB[BD]={};BB[BD].cmSelCells=[];BB.push({n:BE,v:BD,text:BE,value:BD});}BB[BD].cmSelCells.push(BC);if(A3[BD]===undefined){A3[BD]={};A3[BD].cmSelCells=[];A3.push({n:BE,v:BD,text:BE,value:BD});}A3[BD].cmSelCells.push(BC);});var Ar=mstrmojo.VisUtility;var A2=Ar.getVisStyle.call(As);if(A2===v.HEAT_MAP){Ak.splice(2,2);}At(Ak);return{createDe:Am,editGroup:Ai,editCalculation:A0,renameDe:A5};},getGroupAndCalculationContextMenu:function(Ap,A3,A0){var A2=Ap,Aw=A0.skipSingleAttrCheck||A2.isSingleAttrSelection(),Ak=false,Am=A2.isSingleContextMenuSelection(),Aq=A2.getDEInfo(A3),Al=Aq&&Aq.deObject,Az=Aq&&Aq.de,Au=Al&&A2.getOthersDEInfo(Al),As=A2.getContextMenuSelections(),Ay=true,Ao=A0.fnCellName,A1=this.getPropertyByPath(A2,"model.data.visName")||this.getPropertyByPath(A2,"model.data.vis.vn");var An=new e.ui.menus.MenuConfig(),Ai=new e.ui.menus.MenuConfig(),At=new e.ui.menus.MenuConfig(),Ax=new e.ui.menus.MenuConfig();A2.cmSelCells=A0.selection;if(Ap.model.supportsViewFilterActions(A3.tid)){if((Ak||Aw)&&AQ(A3,t)&&Y(A2)){An.addMenuItem(mstrmojo.desc(1911,"Group"),"xt",function(){Ap.derivedElementGroup(A3);});}if(Am&&Az&&Az.t===U.LIST){Ai.addMenuItem(mstrmojo.desc(13395,"Edit Group..."),"xt",function(){Ap.derivedElementsEdit(A3,Aq);});Ai.addMenuItem(mstrmojo.desc(12195,"Ungroup"),"xt",function(){Ap.removeQuickDE(A3);});Ax.addMenuItem(mstrmojo.desc(13968,"Rename Group..."),"xt",function(){Ap.renameDEList(A3);});}var Ar=function(A4){W(A2,A3,Az,A4,false);},Av=function(A4){W(A2,A3,Az,A4,true);};if(Au&&!Am&&Aw){S.forEach(As,function(A4){if(A4[0]&&A4[0].eid.indexOf(Au.id)>-1){Ay=false;return false;}});}if(A1!=="VIHeatMapVisualizationStyle"&&!(Am&&Az&&Az.t===U.RESIDUE)&&(Ak||Aw)&&AQ(A3,AE)&&l(A2)){var Ah=function(){var A4=new e.ui.menus.MenuConfig(),A5=m(A2,null,Ao);A4.addRadioMenuGroup(null,Ar,A5.items,"checkMark",undefined,true);return A4;};An.addPopupMenuItem(mstrmojo.desc(5188,"Calculation"),this.id,Ah,"xt");}if(Am&&Az&&Az.t===U.CALCULATION&&l(A2)){var Aj=function(){var A4=new e.ui.menus.MenuConfig(),A5=m(A2,Az,Ao);A4.addRadioMenuGroup(A5.selectedItem.value,Av,A5.items,"checkMark",undefined,true);return A4;};At.addPopupMenuItem(mstrmojo.desc(12196,"Edit Calculation"),this.id,Aj,"xt");At.addMenuItem(mstrmojo.desc(12197,"Delete Calculation"),"xt",function(){Ap.removeQuickDE(A3);});Ax.addMenuItem(mstrmojo.desc(13967,"Rename Calculation..."),"xt",function(){Ap.editDECalculation(A3);});}}return{createDe:An,editGroup:Ai,editCalculation:At,renameDe:Ax};},isHostedPopupNode:function(Ak,Aj,Ai,Ah){return AH(Ak,Aj,"mstrmojo-popup-widget-hosted",Ai,Ah);},isMojoEditorNode:function(Ak,Aj,Ai,Ah){return AH(Ak,Aj,"mstrmojo-Editor",Ai,Ah);},applyStyle2Legend:function(Ak,Aj,Ai){var Ah,Am={},Al={};for(Ah in Ak){if(Ah.indexOf("font")>=0||Ah.indexOf("color")>=0||Ah.indexOf("textDecoration")>=0){Am[Ah]=Ak[Ah];}else{Al[Ah]=Ak[Ah];}}if(Aj){Aj.style.background="";this.applyStyles2DomNode(Aj,Al);}if(Ai){this.applyStyles2DomNode(Ai,Am);}},mergeMenuConfigs:function AG(Ai,Ah){function Aj(Al,Am,Ak){if(!Am){return ;}if(!Ak&&Al.hasMenuItems()&&Am.hasMenuItems()){Al.addSeparator();}if(Am.hasMenuItems()){Al.absorbMenuItems(Am);}}return Ah.reduce(function(Ak,Al){Aj(Ak,Ai[Al.name],Al.noSeparator);return Ak;},new mstrmojo.ui.menus.MenuConfig());},absorbMenuItems:function(Ai,Ah,Aj){Ai.addDisposable(Ah);Ai.absorbMenuItems(Ah);if(Aj&&Ah.menus.length>0){Ai.addSeparator();}},addWheelListener:(function(){var Ak=mstrmojo.dom,Aj=Ak.attachEvent,Ai=Ak.preventDefault,Al;function Ah(Ap,Ao,Aq,An){var Am=(Al==="wheel")?Aq:function(Ar){if(!Ar){Ar=window.event;}var At={originalEvent:Ar,target:Ar.target||Ar.srcElement,type:"wheel",deltaMode:(Ar.deltaMode!==undefined?Ar.deltaMode:1),deltaX:0,deltaZ:0,preventDefault:function(){Ai(window,Ar);}},As=this;if(Al==="mousewheel"){At.deltaY=-Ar.wheelDelta;if(Ar.wheelDeltaX!==undefined){At.deltaX=-Ar.wheelDeltaX;}}else{At.deltaY=Ar.detail;}return Aq.call(As,At);};return Aj(Ap,Ao,Am,An);}if(Object.prototype.hasOwnProperty.call(document.createElement("div"),"onwheel")){Al="wheel";}else{Al=document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";}return function(An,Ao,Am){return Ah(An,Al,Ao,Am);};}()),addTouchSupportHelper:function AJ(Ah,Aj,Ai,Am,Al){Ah.style["touch-action"]="none";var Ak={MINDRAG:function(An){return(((An.event.type.indexOf("touch")===0)||(An.event.type.indexOf("pointer")===0))?5:1);},TAPHOLDDELAY:250,DBLCLICKDELAY:300};s.newInstance(Ah,{context:Ak,start:Ai,change:Am,end:Al},Aj);},addBasicTouchSupport:function z(Am,Ao,Ar,Al,Aq){function As(Aw){var Av={left:0,top:0};function At(Ax){if(Ax===window||Ax===document||Ax===document.body){return Av;}else{return Ax.getBoundingClientRect();}}function Au(A0,A1,Ay){A1=A1||A0.currentTarget||A0.srcElement;if(!Array.isArray(Ay)){Ay=[0,0];}var Ax=A0.clientX||0;var A2=A0.clientY||0;var Az=At(A1);Ay[0]=Ax-Az.left;Ay[1]=A2-Az.top;return Ay;}return Au(Aw.changedTouches?Aw.changedTouches[0]:Aw,document.body);}function Ak(At,Av){if(At.touches.length>1||(At.type==="touchend"&&At.touches.length>0)){return undefined;}var Au=null,Ax=null;switch(At.type){case"touchstart":Au="mousedown";Ax=At.changedTouches[0];break;case"touchmove":Au="mousemove";Ax=At.changedTouches[0];break;case"touchend":Au="click";Ax=At.changedTouches[0];break;}if(Av){Au=Av;}var Aw={bubbles:At.bubbles,cancelable:At.cancelable,view:At.view,screenX:Ax.screenX,screenY:Ax.screenY,clientX:Ax.clientX,clientY:Ax.clientY};if(Av==="contextmenu"){Aw.button=2;Aw.buttons=2;}return new MouseEvent(Av,Aw);}function An(Av,At){var Au;if(Av.type.indexOf("touch")===0){Au=Ak(Av,At);}else{var Aw=As(Av),Ax={bubbles:Av.bubbles,cancelable:Av.cancelable,view:Av.view,detail:Av.detail,screenX:Av.screenX,screenY:Av.screenY,clientX:Aw[0],clientY:Aw[1]};if(At==="contextmenu"){Ax.button=2;Ax.buttons=2;}Au=new MouseEvent(At,Ax);}Au.originEvent=Av;return Au;}function Aj(At){if(At.stopPropagation){At.stopPropagation();}if(At.preventDefault){At.preventDefault();}At.cancelBubble=true;return false;}function Ah(Au){var Ax=Au.event,At=Au.context;At.startOffset=As(Ax);At._dragged=false;At._dragging=true;At._taphold=false;At.initialTarget=Ax.target;var Aw=(new Date()).getTime();if(Aw-At._mouseDownTime<At.DBLCLICKDELAY){At.numClicks+=1;}else{At.numClicks=1;At._mouseDownTime=Aw;}At.tapholdTimeoutId=setTimeout(function(){if((new Date()).getTime()-At._mouseDownTime>At.TAPHOLDDELAY&&!At._dragged){At._taphold=true;}if(!At._dragged&&At._taphold){Au.session.listeners.end(Ax);}},At.TAPHOLDDELAY+10);var Av;if(Ar){Av=Ar(Au);}if(Av===undefined||(Av&&Av.pause)){Aj(Au.event);}}function Ap(Ax){var At=Ax.event,Aw=Ax.context,Az=As(At),Av=Az[0]-Aw.startOffset[0],Au=Az[1]-Aw.startOffset[1];if(Math.abs(Av)<Aw.MINDRAG(Ax)){Av=0;}if(Math.abs(Au)<Aw.MINDRAG(Ax)){Au=0;}if(Av||Au){Aw._dragged=true;}if((new Date()).getTime()-Aw._mouseDownTime>Aw.TAPHOLDDELAY&&!Aw._dragged){Aw._taphold=true;}var Ay;if(Al){Ay=Al(Ax);}if(Ay===undefined||(Ay&&Ay.pause)){Aj(Ax.event);}}function Ai(Au){var At=Au.context,Aw=Au.event;if(At.tapholdTimeoutId){clearTimeout(At.tapholdTimeoutId);}if(!At._dragging){At._dragged=false;return ;}At._dragging=false;if((new Date()).getTime()-At._mouseDownTime>At.DBLCLICKDELAY){At.numClicks=Math.max(At.numClicks-1,1);}if((new Date()).getTime()-At._mouseDownTime>At.TAPHOLDDELAY&&!At._dragged){At._taphold=true;}var Av;if(Aq){Av=Aq(Au);}if(Aw.type.indexOf("mouse")===0){At._dragged=false;At._taphold=false;return ;}else{if(!At._dragged){if(At._taphold){At.initialTarget.dispatchEvent(An(Aw,"contextmenu"));}else{At.initialTarget.dispatchEvent(An(Aw,"click"));}}At._dragged=false;At._taphold=false;if(Av===undefined||(Av&&Av.pause)){Aj(Au.event);}}}this.addTouchSupportHelper(Am,Ao,Ah,Ap,Ai);},isNearZero:function(Ai,Ah){Ah=Ah||5;var Aj=1/Math.pow(10,Ah);return(Math.abs(Ai)<Aj);},hasMergedRowCells:function(Ah){return false;},getMockUpThresholds:function(Aj,Ak){var Ah=[{tid:1,n:"threshold 0",scope:1,rtp:2,rtxt:"",fmt:{bc:"#cc2525",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"10%",dtp:5}],fn:2,fnt:3}],fn:19},ttp:1,flr:0,ceil:10},{tid:2,n:"threshold 1",scope:1,rtp:2,rtxt:"",fmt:{bc:"#e34b4b",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"10%",dtp:5},{v:"30%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:10,ceil:30},{tid:3,n:"threshold 2",scope:1,rtp:2,rtxt:"",fmt:{bc:"#e97d7d",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"30%",dtp:5},{v:"50%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:30,ceil:50},{tid:4,n:"threshold 3",scope:1,rtp:2,rtxt:"",fmt:{bc:"#79d479",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"50%",dtp:5},{v:"70%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:50,ceil:70},{tid:5,n:"threshold 4",scope:1,rtp:2,rtxt:"",fmt:{bc:"#57ba57",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"70%",dtp:5},{v:"90%",dtp:5}],fn:3,fnt:3}],fn:19},ttp:3,flr:70,ceil:90},{tid:6,n:"threshold 5",scope:1,rtp:2,rtxt:"",fmt:{bc:"#2ca02c",bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:"4C051DB611D3E877C000B3B2D86C964F",n:"Profit"},cs:[{v:"90%",dtp:5}],fn:5,fnt:3}],fn:19},ttp:1,flr:90,ceil:100}];S.forEach(Ah,function(Am){var Al=Am.expr.nds[0].m;Al.did=Aj;Al.n=Ak;});var Ai={};Ai[Aj]=Ah;return Ai;},generateThresholdsInfo:function(Aj,Ao,Ah,Al){var An=Ah.length,Ai=[],Ar,Ak,As=0,Aq=0;for(var Am=0;Am<An;Am++){Ak=Math.round(Al[Am]*100);Aq=As;As=Ak||100;Ar={tid:Am+1,n:"threshold "+Am,scope:1,rtp:2,rtxt:"",fmt:{bc:Ah[Am],bgs:0},expr:{et:14,nds:[{et:10,dmt:7,m:{did:Aj,n:Ao},cs:[{v:Ak+"%",dtp:5}],fn:2,fnt:3}],fn:19},ttp:1,ceil:As,flr:Aq};Ai.push(Ar);}var Ap={};Ap[Aj]=Ai;return Ap;},psPt2CssPt:function(Aj,Ai){var Ah=parseInt(Aj,10)*0.75;if(Ai instanceof Function){Ah=Ai(Ah);}return Ah+"pt";},captureEventOnce:function(Am,Al,Ah,Ak,Aj){function Ai(An){Al.call(Ah,AY.newDomEvent(Am,window,An||window.event),Aj);AC.detachEvent(Ak,Am,Ai);}Aj=Aj||{};Ak=Ak||document;AC.attachEvent(Ak,Am,Ai);},getPropertyByPath:function(Al,Ak,Ah){var Ai,Aj;if(typeof Ak!=="string"){return Ah;}Ai=Ak.split(".");Aj=Ai.every(function(An){var Am=Al[An];if(Am!==undefined){Al=Am;return true;}return false;});return Aj?Al:Ah;},mergeHashes:function(){return Array.prototype.slice.apply(arguments).reduce(function(Ah,Ai){if(Ai){Object.keys(Ai).forEach(function(Aj){Ah[Aj]=Ai[Aj];});}return Ah;},{});},toggleControlEnabled:function(Ah,Ai){[].concat(Ah).forEach(function(Aj){Aj.set("enabled",!!Ai);});},findInArray:function(Ak,Aj,Ai){var Am=-1,Al,Ah;if(!Array.isArray(Ak)){return Am;}for(Al=Ai===undefined?0:Ai,Ah=Ak.length;Al<Ah;Al+=1){if(Aj(Ak[Al])){return Al;}}return Am;},arrayUnique:function(Ah,Aj){if(!Array.isArray(Ah)){return Ah;}var Ai=mstrmojo.VisUtility;return Ah.filter(function(Ak,Al){return Ai.findInArray(Ah,function(Am){return Aj(Ak,Am);},Al+1)===-1;});},range:function(Ah,Al,Ak){Ak=Ak||1;var Aj,Ai=[];for(Aj=Ah;Aj!==Al;Aj+=Ak){Ai.push(Aj);}return Ai;},drawDashLine:function I(Ap,Aj,An,Ai,Al,Ah,Ao){var Am=(Aj===Ai),Ak;Ap.beginPath();Ap.moveTo(Aj,An);if(Am){Ak=0;An+=Ah;while(An<=Al){if(Ak%2===0){Ap.lineTo(Aj,An);An+=Ao;}else{Ap.moveTo(Aj,An);An+=Ah;}Ak++;}if(Ak%2===0){Ap.lineTo(Ai,Al);}}else{Ak=0;Aj+=Ah;while(Aj<=Ai){if(Ak%2===0){Ap.lineTo(Aj,An);Aj+=Ao;}else{Ap.moveTo(Aj,An);Aj+=Ah;}Ak++;}if(Ak%2===0){Ap.lineTo(Ai,Al);}}Ap.stroke();},repeat:function(Aj,Ak){var Ah=[],Ai;Ak=Math.max(0,Ak);for(Ai=0;Ai<Ak;Ai+=1){Ah[Ai]=Aj;}return Ah;},isHierarchyObject:function(Ah){return(Ah&&Ah.t)===p.DssTypeDimension;},selectDropZonePanel:function(Ah){AA(Ah,"editPanel");},selectPropertyPanel:function(Ai,Aj){AA(Ai,"propertiesPanel");var Ah=Ai.edtModel;if(Ah){Ah.selectTargetByValue(Aj);}},pluck:function(Ai,Ah){if(!S.isArray(Ai)){return Ai;}return Ai.map(function(Aj){return Aj&&Aj[Ah];});},pick:function(Ai,Ah){return Ah.reduce(function(Ak,Aj){Ak[Aj]=Ai[Aj];return Ak;},{});},isColorManuallySet:function(Aj,Ai){var Ah=Ae(Aj,Ai);if(Ah){return Ah.isManual;}},getCombColor:function(Aj,Ai){var Ah=Ae(Aj,Ai);if(Ah){return Ah.color;}},setColorPickerShowAutomatic:function(Ai,Ah){Ai.children[0].fillColor.colorPicker.showAutomatic=Ah;},getCharGroupValueChangeCb:function(Ah){var Ai=(function(){var Aj={};Aj[AR.FONT_WEIGHT]=AV.FS_BOLD;Aj[AR.FONT_STYLE]=AV.FS_ITALIC;Aj[AR.UNDERLINE]=AV.FS_UNDERLINE;Aj[AR.LINE_THROUGH]=AV.FS_STRIKETHROUGH;return function(Ak,Al){return Ak^Aj[Al];};}());return function(Ak,Aj){if(Ah instanceof Function){Ah=Ah();}if(!Ah){return ;}switch(Ak){case AR.COLOR:Ah.fontColor.fill.value.setValue(Aj);break;case AR.FONT_SIZE:Ah.fontSize.setValue(Aj);break;case AR.FONT_FAMILY:Ah.fontFamily.setValue(Aj);break;case AR.FONT_WEIGHT:case AR.FONT_STYLE:case AR.UNDERLINE:case AR.LINE_THROUGH:Ah.fontStyle.setValue(Ai(Ah.fontStyle.getValue(),Ak));break;}};},getMetricsInDropZone:AN,addLegendFontChangeListeners:function(Ai,Aj){var Ah=["lgdFntClr","lgdFntSz","lgdFntFml","lgdFntStyle"];AZ(Ah,Ai,Aj);},addLegendBackgroundChangeListeners:function(Ai,Aj){var Ah=["lgdBgFillClr","lgdBgFillTrans"];AZ(Ah,Ai,Aj);},isValidDropZone:function(Ah){if(Ah===undefined){return false;}var Aj=Object.keys(Ah).filter(function(Ak){return Ak!=="visProp";});var Ai=X.copyProps(Aj,Ah);return Ah&&!X.equals(Ai,{});},unitExistInTemplate:function(Ak,Ah){var Aj,Am,Al=Ah.row,Ai=Ah.col;for(Aj=0,Am=Al.length;Aj<Am;Aj++){if(Al[Aj].id===Ak){return true;}}for(Aj=0,Am=Ai.length;Aj<Am;Aj++){if(Ai[Aj].id===Ak){return true;}}return false;},findDisabledUnits:function(Aq,Ar){var Am,Ai,Ak=Ar.docModel.datasets,Ah=Aq.gts,Ao=Aq.datasetId,Al=Ak[Ao]||{},An=Al.att||[],Ap=[];var Aj=mstrmojo.VisUtility;if(An){for(Am=0,Ai=An.length;Am<Ai;Am++){if(!Aj.unitExistInTemplate(An[Am].did,Ah)){Ap.push(An[Am]);}}}return Ap;},getDrillCandidates:function(Am,An){var Ap=Am.modelData,Ar=Am.model,Al=Ar.docModel.datasets,Ah=Ap.gts,Aj=mstrmojo.VisUtility,As=Aj.findDisabledUnits(Ap,Ar),Ai=[],Ak=(function(){var At;if(An){S.forEach(Ah.row.concat(Ah.col),function(Au){if(Au.id&&Au.id===An){At=Au.dp;}});}return At;}()),Ao=function(At,Aw){var Au=S.find(At,"did",Aw.id),Av=At[Au];if(Av&&!Av.hide){Aw.n=Av.n;return true;}return false;},Aq=S.filter(Ak,function(Av){var At;for(At in Al){var Au=Al[At];if(Ao(Au.att,Av)){return true;}}return false;});if(Aq){Ai=S.filter(As,function(Au){for(var At in Aq){if(Aq[At].n===Au.n){return true;}}return false;});}return Ai;},getDrillSubMenu:function(Ah){if(!Ah||!Ah.items||!Ah.drillAction){return{};}var Al=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,isHostedWithin:false,alignWithAnchor:true,maxHeight:350}),Ai=Ah.items,Ak=Ah.drillAction,Aj=[];if(mstrmojo.resolveFeature("sort-drill-paths")){Ai.sort(function(An,Am){if(An.n>Am.n){return 1;}if(An.n<Am.n){return -1;}return 0;});}Ai.forEach(function(Ao,Am){if(Aj.indexOf(Ao.did)===-1){Aj.push(Ao.did);if(Ao.att){var An=mstrmojo.VisUtility;var Ap={};X.copy(Ah,Ap);Ap.items=Ai[Am].att;Al.addPopupMenuItem(Ao.n,this.id,An.getDrillSubMenu,"xt",Ap);}else{Al.addMenuItem(Ao.n,"xt",Ak,X.copy(Ah,{drillUnit:Ao}));}}});return Al;},getDrillMenu:function(An,Ao,At,Ah){var Ap=An.model,Ak=mstrmojo.VisUtility,Aq=Ak.getDrillCandidates(An,Ao),Ar=Aq.length,Am=Ap.docModel,Aj=Am.datasets[An.modelData.datasetId],Ax,As=[],Av=-1,Au,Aw,Al,Ai;if(Aj&&Am.isMDXDataset(Aj)){Ak.sortMdxDrillCandidates(Aq);Ax=Aj.tables[0];Ax.dimensions.forEach(function(Ay){Al=true;Au=-1;Ay.hierarchies.forEach(function(Az){Ai=true;Az.att.forEach(function(A0){Aw=Ad.findBin(Aq,A0,"did",Ar);if(Aw!==-1){if(Al){As.push({id:Ay.did,did:Ay.did,n:Ay.n,att:[]});Av++;Al=false;}if(Ai){As[Av].att.push({id:Az.did,did:Az.did,n:Az.n,att:[]});Au++;Ai=false;}As[Av].att[Au].att.push(Aq[Aw]);}});});});}else{As=Aq;}return Ak.getDrillSubMenu(X.copy(Ah,{items:As,drillAction:At}));},sortMdxDrillCandidates:function(Ah){Ah.sort(function(Aj,Ai){if(Aj.did<Ai.did){return -1;}if(Aj.did>Ai.did){return 1;}return 0;});return Ah;},getDrillMenuItemsCallback:function(Aj,Ak,Ah,Ai){return function(){var Am=mstrmojo.VisUtility;var An=Am.getDrillCandidates(Aj,Ai),Al=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,maxHeight:350});An.forEach(function(Ao){Al.addMenuItem(Ao.n,"xt",Ak,X.copy(Ah,{drillUnit:Ao}));});return Al;};},doDrill:function(Aj,Ax,As,Ay){var Az=Aj;function Ap(A1){return A1.model.controller.cmdMgr;}function Av(){return{success:function A1(){var A2=mstrmojo.VisUtility;A2.visPrint("reaise");this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}var Ai=Az.model,Aw=(Az.getDocModel&&Az.getDocModel())||Az.model.docModel,Au=Aw.getDataService(),Am=Au.newUpdate();var Ao=true;if(Aw.prefs&&Aw.prefs.rtprnt){Ao=parseInt(Aw.prefs.rtprnt,10)===1;}else{if(Ai.xtab.defn.tkp!==undefined){Ao=parseInt(Ai.xtab.defn.tkp,10)===-1;}}Ay=Ay||{};Ay.keepParent=Ao;var An=As.call(Aj,Ax,Ay);var Aq=Az.zonesModel,A0=Aq.getUpdateCallback(),Ar=Az.model.controller||Aw.controller,Ak=Ar._getXtabCallback(Az);Am.add(An,Ac(A0,Ak));var Ah=Ai.getSelectorDataFromTemplateLimit(Az.model.data.tpl).concat({keepOnly:true,data:Az.getContextMenuSelections()}),At=Aw.getKeepOnlyOrExcludeAction(Az.k,Ah);Am.add(At,Av.call(Az));Ap(Az).execute({execute:function Al(){this.submitUpdate(Am);},urInfo:{callback:Am.callback}});},strStartsWith:function(Aj,Ai,Ah){Ah=Ah||0;return Aj.lastIndexOf(Ai,Ah)===Ah;},changeWidgetBackground:function(Aj,Ak,Ai){var Ah=Aj.parent;if(Ah&&Ak!==Ai){Ah.changeUnitFormats(false,1,Aj.getFormats(),AR.BACKGROUND_COLOR,Ak,Ai);Ah.raiseEvent({name:"BEMFormatChange",propertyName:AR.BACKGROUND_COLOR,value:Ak,isTitle:false});}},translateGridError:function(Ai,Ah){if(Ah===undefined){Ah=Af.AE_ERROR;}if(Ah===Af.EMPTY_DATA){Ai=mstrmojo.desc(2388,"No data returned for this view. This might be because the applied filter excludes all data.");}if(Ah===Af.NO_DATASET||Ah===Af.NO_TEMPLATE_UNIT){Ai=mstrmojo.desc(11668,"Drag objects here.");}if(!Ai){Ai=mstrmojo.desc(13687,"Unknown error");}return{msg:Ai,type:Ah};},hasValidValueInMetric:function(Ak,Ai){var Ah=mstrmojo.VisUtility;var Aj=Ah.getPropertyByPath(Ak,"model.data.gsi.mx");if(Aj===undefined||Aj.length<=Ai||Ai<0){return false;}var Al=Aj[Ai];return["min","max"].every(function(Am){var An=Al[Am];return An!==undefined&&An!==null&&An!=="";});},renderWidgetErrorRSD:function(Ak,Am,Ai){var Ao=document.createElement("div");var An='<div style="display: table; height: 100%; width: 100%; background-color:#F5F5F2; border: solid 1px #A7A7A7; box-sizing: border-box;"><div style="display: table-cell; vertical-align: middle; text-align: center; color: #000000; font-size: 14pt;">'+Am+"</div></div>";Ao.innerHTML=An;Ao=Ao.firstChild;var Ah=Ak.width,Aj=Ak.height;if(Ah!==undefined){Ao.style.width=Ah+"px";}if(Aj!==undefined){Ao.style.height=Aj+"px";}var Al=Ak.domNode;if(Al){Ai.forEach(function(Ap){Al["on"+Ap]=undefined;});while(Al.firstChild){Al.removeChild(Al.firstChild);}Al.appendChild(Ao);}else{Ak.parent.domNode.appendChild(Ao);}},visPrint:function(){var Ah=mstrmojo.VisUtility.enableInVis;if(Ah&&window.mstr_profile&&mstr_profile.enabled&&console){Function.prototype.apply.call(console.log,console,arguments);}},hasCGorCon:function(Ak,Ah){var Aj=Ah&&Ah.did,Ai=Ak.model.data.datasetId||"",Al=null;if(Aj){Al=AT.getDatasetFromAttributeId(Ak.model.docModel.datasets,Aj);}else{if(Ai){Al=AT.getDatasetFromId(Ak.model.docModel.datasets,Ai);}}return Al&&AT.hasCGorCon(Al);},isCGorCon:function n(Ak,Ah){var Aj=Ah&&Ah.did,Ai=Ak.model.data.datasetId||"",Al=null;if(Aj){Al=AT.getDatasetFromAttributeId(Ak.model.docModel.datasets,Aj);}else{if(Ai){Al=AT.getDatasetFromId(Ak.model.docModel.datasets,Ai);}}return Al&&AT.isCGorCon(Ah,Al);},findElementsByAttribute:function R(Aj,Al,Ak,Ah){Ah=!!Ah;var Am=[];if(Ak.constructor!==Array){Ak=[Ak];}var An=function(Ao){if(Ah){return Ao.identity&&Ao.identity.tlOpt&&Ao.identity.tlOpt[Al];}else{return Ao.getAttribute(Al);}};function Ai(Aq){var Ao=An(Aq),Ap;if(Aq.hasChildNodes()){Ap=Aq.firstChild;while(Ap){if(Ap.nodeType===1){Ao=An(Ap);if(Ak.indexOf(Ao)!==-1){Am.push(Ap);}else{Ai(Ap);}}Ap=Ap.nextSibling;}}}Ai(Aj);return Am;},restoreEsForUnit:function AP(Al){if(!Al){return ;}var Am=Al.es,Ai=Al.fs,Ak=Al.otp,Ah=Ai&&Ai.length||0;function Aj(An){var Ao=document.createElement("div");Ao.innerHTML=An;return Ao.innerText;}if(Am){S.forEach(Am,function(Ao,An){Ao.n=c.decodeHtmlString(Ao.n);if(Ak===p.DssTypeAttribute&&Ah){switch(Ai[An%Ah].bftp){case AL.DssBaseFormHTMLTag:Ao.n=Aj(Ao.n);break;default:}}});}},isTrue:function AU(Ah){return Ah==="true"||Ah===true;},getFontFamilyItems:function r(){if(P){return P;}else{P=[];S.forEach(Q.Families.slice(1),function(Ah){P.push({n:Ah.n,id:Ah.n,did:Ah.n,preview:!Ah.symbolic});});return P;}},surroundWithQuotes:function AO(Ah){if(!Ah){return"";}return"'"+Ah.replace(/^['|"]+/,"").replace(/['|"]+$/,"")+"'";}});mstrmojo.VisUtility.enableInVis=true;}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.vi.ui.DatasetUnitMenuUtils");var B=mstrmojo.vi.ui.DatasetUnitMenuUtils;mstrmojo.vi.ui.UnitList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.vi.ui.UnitList",init:function C(D){this._super(D);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIUnitList");},getItemProps:function A(F,D){var E=this._super(F,D);E.addCls("unit "+B.getUnitCssClass(F));return E;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.ME.MetricToken","mstrmojo.ME.MetricEditBox","mstrmojo.ME.DynamicLinkTokenInputBox","mstrmojo.ME.AttributeEditBox","mstrmojo.mstr.EnumDSSXMLTokenTypes","mstrmojo.mstr.EnumDSSXMLTokenStates");var G=mstrmojo.array,J=mstrmojo.hash,I=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,E=mstrmojo.ME.AttributeEditBox.prepareInsertToken,F=mstrmojo.ME.AttributeEditBox.validateSyntax,W=mstrmojo.mstr.EnumDSSXMLTokenTypes,P=mstrmojo.mstr.EnumDSSXMLTokenStates,M=mstrmojo.ME.MetricToken.argDelimiter,C=function C(X){X=X||"";return'"'+X+'"';},L=function L(X){if(!X){return X;}return X.replace(/^"(.*)"$/,"$1");},R=function R(X){return G.filter(X,function(Y){return !((Y.tp===W.SimpPrefixFun&&Y.v==="Concat")||(Y.tp===W.LeftParen&&Y.v==="(")||(Y.tp===W.Comma&&Y.v===",")||(Y.tp===W.Semicolon&&Y.v===";")||(Y.tp===W.RightParen&&Y.v===")"));});},U=function U(X,Z){var Y=[];G.forEach(X,function(a){if(a.tp===W.AttrFormRef||a.sta===P.Error){Y.push({v:"{",isDelimiter:true});Y.push(a);Y.push({v:"}",isDelimiter:true});}else{if(Z){a.v=decodeURI(L(a.v));}else{a.v=L(a.v);}a.isRawStr=true;Y.push(a);}});return Y;},A=function A(X){if(X.isRawStr){X.v=X.v.replace(/"/g,"'");X.v=C(X.v);X.isRawStr=false;}return X;},D=function D(Y){if(Y.length===1){A(Y[0]);return Y;}var X,Z=[{v:"Concat(",isRawStr:false,isNew:true}];for(X=0;X<Y.length;X++){Z.push(A(Y[X]));Z.push({v:M,isRawStr:false,isNew:true,isDelimiter:true});}Z[Z.length-1].v=")";return Z;},S=function S(a,f){if(!G.isArray(a)){return undefined;}var c=[],b=false,d=false,X,e,Z="{",Y="}";for(e=0;e<a.length;e++){X=J.copy(a[e]);if(X.v===Z){if(d){return undefined;}d=true;b=false;}else{if(X.v===Y){if(!d){return undefined;}b=false;d=false;}else{if(b&&d){return undefined;}X.isRawStr=!d;X.isNew=true;if(X.isRawStr&&f){X.v=encodeURI(X.v);}c.push(X);b=true;}}}return !d?c:undefined;},V=function V(Y){if(!Y||Y.length===0){return[];}var X=Y[0];X.isNew=true;X=D(Y);return[].concat(X);};mstrmojo.ME.DynamicLinkEditBox=mstrmojo.declare(mstrmojo.ME.MetricEditBox,[],{children:[{scriptClass:"mstrmojo.ME.DynamicLinkTokenInputBox",alias:"inputBox",slot:"editNode",renderOnScroll:false,renderBlockSize:0,bindings:{browseItemVisible:"this.parent.browseItemVisible",candidates:"this.parent.candidates"}}],init:function O(X){this.validateFunc=function Y(){this.backendValidate();}.bind(this);this._super(X);},ontokensModify:function(){this.set("cValid",this.inputBox.items.length>0);this.set("dirty",true);this.localValidate();},defaultOnTokensModify:mstrmojo.emptyFn,clear:function K(){this.inputBox.set("items",[]);this.inputBox.resetTokensCache();this.set("vStatus",I.UNKNOWN);this.set("iStatus","");},postBuildRendering:function Q(){if(this._super){this._super();}this.clear();},onObjectInsert:function N(a){var d=this.inputBox;var Y=E(a);var b=[Y];if(a.t===12&&Y.ift&&Y.exv){b=[{v:"{",isDelimiter:true,isNew:true}].concat(b).concat([{v:"}",isDelimiter:true,isNew:true}]);}var c=d.insertTokens(b);if(this.ontokensModify){this.ontokensModify();}if(a.t===12&&Y.ift&&!Y.exv){var Z=d.ctxtBuilder.itemWidgets,X=Z[c];if(X){d.startTokenSuggestion(X);}}},backendValidate:function H(Y){var Z=this,X=function(b){Z.set("vStatus",b.vs);Z.set("iStatus",b.rjed||"");Z.set("cValid",(b.vs===0));var a={};J.copy(b,a);a.items=U(R(b.items));Z.updateInputBoxItems(a);Z.handleValidation(a);if(Y){Y(b.items,b.vs===I.VALID);}};if(this.cValid){Z.set("vStatus",I.VALIDATING);F(null,{items:V(S(this.inputBox.items)||[])},false,X);}},localValidate:function B(){var X=this.inputBox.items;if(X.length>0){if(!S(X)){this.set("vStatus",I.ERROR);this.set("iStatus","");this.set("cValid",false);return ;}}if(this.inputBox.items.length>0){this.set("cValid",true);this.set("vStatus",I.UNKNOWN);this.set("iStatus","");}}});mstrmojo.ME.DynamicLinkEditBox.preProcessBackendTks=R;mstrmojo.ME.DynamicLinkEditBox.convertBackendTksToDisplayTks=U;mstrmojo.ME.DynamicLinkEditBox.addDoubleQuotationMark=C;mstrmojo.ME.DynamicLinkEditBox.removeDoubleQuotationMark=L;mstrmojo.ME.DynamicLinkEditBox.preprocessDisplayTokens=S;mstrmojo.ME.DynamicLinkEditBox.constructBackendToken=V;}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.string","mstrmojo.Label","mstrmojo.vi.ui.rw.UnitContainer","mstrmojo.vi.ui.ScrollableDocTextfield","mstrmojo.DocHTMLContainer","mstrmojo.ui.ScrollableTextArea");var a=mstrmojo.css,J=mstrmojo.dom,C=mstrmojo.string;var R=0,A=1;var U="url",N="htmlText";var K="http://",c=null,O=[{n:mstrmojo.desc(4555,"iFrame"),v:R,id:0},{n:mstrmojo.desc(4554,"Html Text"),v:A,id:1}];function d(e,f,g){this.model.editHtmlContainer(this,e,f,g);}function Q(e,f){var h=this.ctrlOverlay,g=parseInt(f.match(/\d+/),10);if(h&&h.visible){a.toggleClass(h.domNode,"v",g<310||parseInt(e.match(/\d+/),10)>g);}}function L(e,f,g){return function(){var p=e?N:U,n=mstrmojo.all[g],m=n.parent,l=n.node,k=m.defn,j=m.htmlType!==e;if(j){m.htmlType=e;var h={scriptClass:e===R?"mstrmojo.DocHTMLContainer":"mstrmojo.vi.ui.ScrollableDocTextfield",id:l.id,node:l,slot:"containerNode",alias:"boxContent",controller:n.controller,model:n.model,k:l.k,defn:l.defn,builder:n.builder,tooltip:n.tooltip,formatHandlers:{domNode:["D"]},edtModel:n.edtModel};m.removeAndDestroyChild(n);m.addChildren(h);if(mstrApp&&mstrApp.isSingleTier){m.boxContent.attachEventListener("renderComplete",m.id,function(){J.redirectUrlToFormWrapper(this.boxContent.domNode);});}m.boxContent.render();n=m.boxContent;}if(j||k[p]!==f){k[p]=f;l.data.v=l.data.rv=f;if(m.htmlType===A){n.updateScrollbars();}}n.update(l);n.refresh();m.selectVIUnit(true);var o=m.ctrlOverlay;if(o&&o.visible&&!mstrmojo.string.isEmpty(f)){m.hideControlOverlay();}};}function D(){return mstrApp.isSingleTier||mstrmojo.resolveFeature("create-html-container");}mstrmojo.vi.ui.rw.HtmlBox=mstrmojo.declare(mstrmojo.vi.ui.rw.UnitContainer,null,{scriptClass:"mstrmojo.vi.ui.rw.HtmlBox",htmlType:R,textArea:undefined,typeBtn:undefined,maskTooltip:mstrmojo.desc(15271,"HTML container cannot be selected as target"),init:function W(f){this._super(f);var e=this.defn,g=this.boxContent.node.data;this.htmlType=e.ht?A:R;e[this.htmlType?N:U]=C.decodeHtmlString(g.rv||g.v);a.addWidgetCssClass(this,"mstrmojo-HtmlBox");if(mstrApp&&mstrApp.isSingleTier){this.boxContent.attachEventListener("renderComplete",this.id,function(){J.redirectUrlToFormWrapper(this.boxContent.domNode);});}},postBuildRendering:function X(){this._super();this.addDragHandle();if(!this.boxContent.node.data.v&&mstrApp.allowWebDashboardDesign()&&D.call(this)){this.showControlOverlay(this.getEditOverlayControls());}},applyBoxSize:function V(e,g,k,j){this._super(e,g,k,j);var h=this.boxContent,f=h&&h.getFormats();if(f){h.clearCache();f.height=e;f.width=g;h.refresh();}Q.call(this,e,g);},getAvatarCls:function S(){return this._super().concat(["htmlAvatar"]);},getDisplayName:function M(){return this.defn.n||mstrmojo.desc(4538,"HTML Container");},createDeleteUpdate:function G(){return this.model.getRemoveFieldUpdate(this);},updateHtmlBox:function Z(g,h){var e=this.htmlType,f=this.defn[e?N:U],j=this.boxContent.node.id;if(e!==g||f!==h){d.call(this,g,h,{success:L(g,h,j),undo:L(e,f,j),redo:L(g,h,j)});}},setDefaultTextCaretPosition:function F(f,e){if(f.value===e){window.setTimeout(function(){var g=e===c?(e.indexOf("</body>")-1):(e.indexOf("//")+2);J.setCaret(f,g);},0);}},getHintText:function b(){return[K,c];},isDragValid:function B(e){if(!this._super(e)){return false;}var h=e.src,g=this.ctrlOverlay,f=g&&g.textArea;return !(f&&J.contains(f.domNode,J.eventTarget(h.hWin,h.e)));},getEditOverlayControls:function I(){var h=this,f=this.htmlType,g=this.boxContent.edtModel;return[{scriptClass:"mstrmojo.Label",cssClass:"icn"},{scriptClass:"mstrmojo.Label",cssClass:"title",text:mstrmojo.desc(13623,"HTML container:")},g.getButtonBar(O,f,function(l){var k=l.v,m=this.parent.textArea;m.set("emptyText",h.getHintText()[k]);m.set("value","");m.refresh();},{alias:"typeBtn",showIcon:false,cssClass:"htmlTypeBtn"}),{scriptClass:"mstrmojo.ui.ScrollableTextArea",emptyText:this.getHintText()[f],maxLength:undefined,alias:"textArea",cssClass:"htmlText",keepEmpty:true,onfocus:function j(){h.setDefaultTextCaretPosition(this.inputNode,this.emptyText);if(this.inputNode.value===this.emptyText){this.scrollNode.scrollTop=35;}},postvalueChange:function e(){this.parent.ctrlOkBtn.set("enabled",!!this.value);}},mstrmojo.Button.newWebButton(mstrmojo.desc(8708,"OK"),function(){var k=this.parent;h.updateHtmlBox(k.typeBtn.selectedItem.v,k.textArea.value);h.hideControlOverlay();},true,{alias:"ctrlOkBtn",enabled:false})];},showControlOverlay:function E(e){this.toggleDragHandleVisibility(false);this._super(e);this.boxContent.set("visible",false);},hideControlOverlay:function Y(){this._super();this.toggleDragHandleVisibility(true);this.boxContent.set("visible",true);},switchToEditMode:function P(){var h=this.boxContent.node.data,e=h.rv||h.v,g=this.ctrlOverlay,f=g.textArea;if(g.visible){f.focus();return ;}this._super();a.toggleClass(g.domNode,"v",parseInt(this.height.match(/\d+/),10)>parseInt(this.width.match(/\d+/),10));f=g.textArea;f.set("value",e);f.refresh();f.focus();},canShowDesignMenuItems:function H(){return this._super()&&D.call(this);}});mstrmojo.vi.ui.rw.HtmlBox.boxConfiguration={f:{h:150,v:140},minSize:{h:150,v:40},o:"v"};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.UnitContainer","mstrmojo.tooltip","mstrmojo.dom");var A=mstrmojo.dom;mstrmojo.vi.ui.rw.RichTooltipBox=mstrmojo.declare(mstrmojo.vi.ui.rw.UnitContainer,null,{scriptClass:"mstrmojo.vi.ui.rw.RichTooltipBox",tooltipOpenDelay:300,tooltipTopOffset:8,tooltipLeftOffset:16,useRichTooltip:true,showTooltip:function C(H,G){var F=this,E=this.boxContent;if(E.canShowContentTooltip&&!E.canShowContentTooltip(H,G)){return ;}if(!F.hasOpenTooltip&&E){var D=A.getMousePosition(H,G);F.richTooltip={cssClass:"vi-regular vi-tooltip-A",content:E.tooltip,top:Math.max(D.y+this.tooltipTopOffset,0),left:Math.max(D.x-this.tooltipLeftOffset,0),posType:mstrmojo.tooltip.POS_TOPLEFT};this._super(H,G);}},moveTooltip:function B(D,F){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;if(this.hideTooltip){this.hideTooltip();}else{mstrmojo.tooltip.close();}}var H=this,E=D,G=F;this._tooltipTimeOut=setTimeout(function(){H.showTooltip(E,G);},this.tooltipOpenDelay);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui._IsDropTarget");var H=mstrmojo.css,C="dragIn";function E(J){var K=J.tgt,L=this.dropzoneTgt;if(L&&K){K.node=L.domNode.firstChild;K.widget=L;}}mstrmojo.vi.ui.VisualizationEditorPanelPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.vi.ui.VisualizationEditorPanelPortlet",dropzoneTgt:null,allowDrop:function F(J){E.call(this,J);return this.dropzoneTgt.allowDrop(J);},ondragover:function D(J){this.addBorder();E.call(this,J);this.dropzoneTgt.ondragover(J);},ondrop:function I(J){E.call(this,J);this.dropzoneTgt.ondrop(J);},addBorder:function G(){H.addClass(this.domNode,C);},clearBorder:function B(){H.removeClass(this.domNode,C);},postBuildRendering:function A(){if(this._super){this._super();this.dropzoneTgt=this.children[0];}},getLayoutOffsets:function(){return(!!mstrApp.isWSStyling)?{h:0,w:26}:this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.PanelPortlet","mstrmojo.dom","mstrmojo.hash","mstrmojo.css");var B=mstrmojo.css,G=mstrmojo.hash,E=mstrmojo.dom;function D(){B.toggleClass(this.titleBar.leftToolNode,"hidden",this.hideCollapse);}mstrmojo.vi.ui.DatasetPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.DatasetPortlet",cssClass:"docdataset-unitlist-portlet",suffix:"",showTitleBarContextMenu:true,init:function F(H){this._super(H);if(mstrApp.isWSStyling){this.paddingCfg.paddingLeft=3;}this.addChildren([this.getDatasetTypeCfg(H.dataset)]);if(this.dataset&&this.dataset.unpublished){this.unpublished=true;}},getDatasetTypeCfg:function(I){var J=(I.dsm===1)?mstrmojo.desc(14453,"In memory"):mstrmojo.desc(14452,"Live");if(I.connInfo&&I.dsm===2){J+="("+I.connInfo.isn+")";}return{scriptClass:"mstrmojo.Label",markupString:'<div id="{@id}" class="mstrmojo-Label {@cssClass}" style="{@cssText}" title="{@title} "mstrAttach:click,contextmenu></div>',slot:"titlebarNode",alias:"typeBar",text:J,cssClass:"dataset-type",useRichTooltip:true,oncontextmenu:function(L){E.preventDefault(window,L.e);var K=this.parent,M=G.walk("parent.titleBar",this),N=G.walk("src.parent.titleBar.lblTitle.domNode",L);if(M&&E.contains(M.textNode,N,true,M.domNode)){L.cancel();M.tbToolbar.closePopup();var O=M.getMenuConfig();if(O){O.hostId=M.tbToolbar.id;O.hostElement=M.tbToolbar.domNode;O.position=E.getMousePosition(L.e,L.hWin);K.preOpenContextMenu();M.tbToolbar.openPopup(O.newInstance());O.position=null;}}},updateTooltipConfig:function H(K){this.parent.titleBar.updateTooltipConfig(K);this.richTooltip=this.parent.titleBar.richTooltip;}};},postBuildRendering:function(){this._super();D.call(this);B.toggleClass(this.domNode,"unpublished",this.unpublished);},getTitleBarCfg:function C(){var H=this._super(),I=this;if(this.suffix&&this.suffix.length>0){H.getTitleChildren=function(){return[{scriptClass:"mstrmojo.Label",slot:"textNode",alias:"suffixNode",cssClass:"suffix",text:I.suffix}].concat(this.constructor.prototype.getTitleChildren.call(this));};}H.layoutConfig=(!!mstrApp.isWSStyling)?{w:{leftToolNode:"auto",textNode:"100%",rightToolNode:"auto"},h:{leftToolNode:"26px",textNode:"26px",rightToolNode:"26px",containerNode:"26px"},xt:true}:{w:{leftToolNode:"auto",textNode:"100%",rightToolNode:"auto"},h:{leftToolNode:"22px",textNode:"22px",rightToolNode:"22px",containerNode:"22px"},xt:true};return H;},onAppStateChange:function A(H){this._super(H);var I=mstrmojo.vi.VisualInsightApp.APP_STATES.PAUSE,K=!!(H.valueWas&I),J=mstrApp.isAppStatePause();if(K!==J){this.generateToolbar();}if(!!mstrApp.isWSStyling&&!mstrApp.isAppStatePresentation()&&this.parent.parent.visible){this.titleBar.refresh();}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.DatasetPortlet,{onhideCollapseChange:function(){D.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasPopup","mstrmojo.ui.ColumnWalk","mstrmojo.Button","mstrmojo.mstr.EnumNodeDimty","mstrmojo.ConditionModel","mstrmojo.rw.ConditionWalkProvider");var S=mstrmojo.Widget,J=mstrmojo.array,F=mstrmojo.dom,O=mstrmojo.hash,A=mstrmojo.mstr.EnumNodeDimty,K=mstrmojo.rw.ConditionWalkProvider.setTip,Q=mstrmojo.expr,I=Q.ET;var C=mstrmojo.desc(11899,"Select a dataset object.");var M=J.hash([A.NodeDimtyOutputLevel]);function E(){var X=this.model;if(X){if(!X.attachEventListener){O.make(X,mstrmojo.ConditionModel,{});}X.attachEventListener("edit",this.id,"onmodeledit");}}function N(Y,X){if(X&&X.detachEventListener){X.detachEventListener("edit",Y.id,"onmodeledit");}}function P(c,X){var a=X,b=[],Z=[],Y=[],d=false;O.forEach(a,function(e){b=b.concat(e.att.filter(function(f){return f.did===c;}));});d=b[0]&&b[0].da;b.forEach(function(e){Z=Z.concat(e.fs||[]);});Z.forEach(function(e){if((e.obf||d)&&Y.filter(function(f){return f.did===e.fid;}).length===0){Y.push({did:e.fid,dtp:mstrmojo.expr.mapBaseFormTypeToDataType(e.bftp),n:e.fnm,t:e.t,isbf:e.isbf});}});return Y;}function D(c,X){var Y,a=X,b,Z=false;if(typeof microstrategy!=="undefined"){a=a||microstrategy.bones.rwb_viewer.datasetInfos;}O.forEach(a,function(d){Y=d.mx;O.forEach(Y,function(e){if(e.did===c){b=d;Z=e.um||e.rdm;return false;}});return !b;});return Z&&b&&b.isMDX;}mstrmojo.rw.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasPopup],{scriptClass:"mstrmojo.rw.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="apply"></div></div>',markupSlots:{conditionNode:function(){return this.domNode.firstChild;},walkNode:function(){return this.domNode.children[1];},applyNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:function L(){S.visibleMarkupMethod.call(this);if(this.visible){this.initWalk();}},onheightChange:S.heightMarkupMethod,onwidthChange:S.widthMarkupMethod},layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",applyNode:"auto"},xt:true},editor:undefined,columnWalk:undefined,tip:undefined,walkProvider:null,objectBrowsingEnabled:true,postCreate:function B(){if(this._super){this._super();}if(!this.walkProvider){this.walkProvider=mstrmojo.insert(mstrmojo.rw.ConditionWalkProvider);}},initWalk:function R(){var X=this.columnWalk,Y=this.walkProvider;K.call(this,C);X.removeTrailingContainer(-1);X.addNextColumn(Y.getTargetNodeProps());X.target.updateColumnContainer();this.updateOkBtn();},updateBrowseElementsParams:function(a,Z){a.attributeID=Z.did;a.otp=Z.t||12;var Y=this.editor,X=Y&&Y.onUpdateBrowseElementsParams;if(X){X.call(Y,a,Z);}},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"750px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var X=this.parent;if(X.close){X.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var X=this.parent;if(X.onOK){X.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:C,ignoreLayout:true}],eb:{scriptClass:"mstrmojo.Editor",cssClass:F.isIE7?"mstrmojo-ElementsEditorIE7":"mstrmojo-ElementsEditor",title:mstrmojo.desc(6149,"Select Elements"),help:"element_browser_dialog_box.htm",children:[{scriptClass:"mstrmojo.ElementsBrowser",alias:"browser",onUpdateBrowseElementsParams:function(Y){var X=this.parent.opener;X.updateBrowseElementsParams(Y,X.model.a);}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(1442,"OK"),cssClass:"mstrmojo-WebButton hot",cssText:"width: 66px;",onclick:function(){var X=this.parent.parent,Y=X&&X.opener;if(Y){Y.onEBSelect();Y.closePopup();}}},{scriptClass:"mstrmojo.Button",alias:"ok",text:mstrmojo.desc(221,"Cancel"),cssClass:"mstrmojo-WebButton",cssText:"min-width: 66px; margin-left: 11px;",onclick:function(){var X=this.parent.parent,Y=X&&X.opener;if(Y){Y.closePopup();}}}]}]},ob:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(5298,"Select an Object"),help:"Select_Objects_dialog_box_.htm",children:[{scriptClass:"mstrmojo.ObjectBrowser",alias:"browser",fishEyeVisible:false,upButtonVisible:true,scrollableIncFetch:true,showCompletePath:false,closeable:false,closeOnSelect:false,browsableTypes:"3,4,8,10,12,256",includeObjectDesc:true,quickSearch:true,minSearchLength:1}]},_set_model:function V(a,X){var Y=this.model,Z=(X!==Y);if(Z){N.call(this,Y);X.dimtyTypes=this.dimtyTypes||M;this.model=X;E.call(this,X);if(this.hasRendered&&this.visible){this.columnWalk.target.updateColumnContainer();}}return Z;},onmodeledit:function H(Y){var X=Y.prop,a=X==="c0"||X==="c1",Z=this.columnWalk[a?"c0":X];if(a){Z.c1Selected=X==="c1";}Z.updateColumnContainer();Z.c1Selected=false;this.updateOkBtn();},browse:function G(Z){var b=this.parent.editorNode,a=function(d,f){var c=mstrmojo.dom.position(d,true),e=mstrmojo.dom.position(f,true);return{x:c.x+c.w,y:e.y};},X=this.columnWalk,Y=this.walkProvider;switch(Z&&Z.alias){case"target":case"dmy":Y.browseObjs(this,Z,a(Z.alias==="target"?X.target.domNode:this.dmyNode,b));break;case"c0":case"c1":Y.browseObjs(this,Z,a(X.c0.domNode,b));break;case"es":Y.browseEs(this,Z,a(X.es.domNode,b));break;}},onOBSelect:function(b){var Z=this.ob.browser,d=Z.target;this.closePopup();var Y=this.targets,c=d.itemIdField,a=Y||[],X=J.find(Y,c,b[c]);if(X===-1){a.push(b);this.targets=a;this.targetsLastMod=new Date();this.raiseEvent({name:"updateTargets",targets:this.targets});}d.setSelectedItems([b],d.multiSelect);if(d.onObjBrowsed){d.onObjBrowsed(b);}},onEBSelect:function(){var Y=this.eb.browser,a=this.columnWalk.es.es;a.set("selectedIndices",{});var X=a.items,Z=[];J.forEach(Y.selectedItems||[],function(c){if(J.find(a.items,"v",c.v)<0){Z.push(c);}});var b=a.insertUnlistedValuesAt||0;if(b<0){b=X.length;}a.set("items",X.slice(0,b).concat(Z).concat(X.slice(b)));a.setSelectedItems(Y.selectedItems,false);},destroy:function U(Y){var X=this.walkProvider;if(X&&X.destroy){this.walkProvider.destroy();}this._super(Y);},updateOkBtn:function W(){var a=true,X=this.model,Y,Z=X&&Q.fnCstCount(X.fn,X.fnt);if(!X){return ;}switch(X.et){case I.AQ:case I.AL:case I.MQ:for(Y=0;Y<Z;Y++){a=a&&!this["invalid"+Y];}break;}a=a&&!!X.completed;this.okBtn.set("visible",a);this.raiseEvent({name:"conditionWalkUpdateOkBtn",valid:a});}});mstrmojo.rw.ConditionWalk.getAttForms=P;mstrmojo.rw.ConditionWalk.isMdxDM=D;}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.rw.ConditionWalk","mstrmojo.Label","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.expr","mstrmojo.css");var F=mstrmojo.expr.ET.MQ,H=mstrmojo.expr.ET.MC,C=mstrmojo.css,B=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var G=function(L,N){var K=L.et,I=L.m&&mstrmojo.rw.ConditionWalk.isMdxDM(L.m.did),M=((K===F||K===H)&&!this.inRelation&&!I)?"block":"none",J=(((N===1)||K!==F)&&!I)?1:0;C.toggleClass(this.toolNode,"unselectable",K===H);this.toolNode.style.display=M;this.level.set("selectedIndex",J);this.includeExist.set("visible",J===1&&(K===H||K===F));this.includeExist.set("checked",L.idcsi===undefined?false:L.idcsi);};mstrmojo.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,null,{scriptClass:"mstrmojo.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},postCreate:function E(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function I(J){var K=this.parent;if(K&&K.condition&&K.visible){K.includeExist.set("visible",J.v===1);K.condition.level=J.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=B;},oncheckedChange:function(){var J=this.parent;if(J){J.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function A(I){var J=this.condition;if(J&&this.toolNode&&this.visible){G.call(this,J.data,J.tree.level);}if(this._super){this._super(I);}},onmodeledit:function D(I){if(this._super){this._super(I);}if(this.toolNode){G.call(this,this.model.get(),this.model.level);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css","mstrmojo.Button","mstrmojo.Label","mstrmojo.rw.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.ui._IsIncFetchList","mstrmojo.ui.ColumnWalk","mstrmojo.mstr.DocElementDataHelper");var F=mstrmojo.expr.ET.MQ,B=mstrmojo.expr.ET.MC,H=mstrmojo.css,G=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var D=function(Q,S){var P=Q.et,N=this.parent&&this.parent.docModel&&this.parent.docModel.datasets,M=Q.m&&mstrmojo.rw.ConditionWalk.isMdxDM(Q.m.did,N),R=((P===F||P===B)&&!this.inRelation&&!M)?"block":"none",O=(((S===1)||P!==F)&&!M)?1:0;H.toggleClass(this.toolNode,"unselectable",P===B);this.toolNode.style.display=R;this.level.set("selectedIndex",O);this.includeExist.set("visible",O===1&&(P===B||P===F));this.includeExist.set("checked",Q.idcsi===undefined?false:Q.idcsi);};mstrmojo.vi.ui.editors.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,[mstrmojo.ui._IsIncFetchList],{scriptClass:"mstrmojo.vi.ui.editors.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"800px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var M=this.parent;if(M.close){M.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var M=this.parent;if(M.onOK){M.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:"",ignoreLayout:true}],init:function K(M){this._super(M);this.attachEventListener("conditionWalkUpdateOkBtn",this.id,function(N){var P=N.valid,O=this.parent;O.toggleOkButtonStatus(P);});},postCreate:function I(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function M(N){var O=this.parent;if(O&&O.condition&&O.visible){O.includeExist.set("visible",N.v===1);O.condition.level=N.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=G;},oncheckedChange:function(){var N=this.parent;if(N){N.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function J(M){var N=this.condition;if(N&&this.toolNode&&this.visible){D.call(this,N.data,N.tree.level);}if(this._super){this._super(M);}},onmodeledit:function A(M){if(this._super){this._super(M);}if(this.toolNode){D.call(this,this.model.get(),this.model.level);}},getAttributeForms:function L(M){return mstrmojo.rw.ConditionWalk.getAttForms(M,this.editor.docModel.datasets);},getElements:function E(P,R){var Q={},N=R.complete,O=this;this.scrollNode=this.columnWalk.es.scrollNode;var M=this.scrollNode&&this.scrollNode.style;if(M){M.height="100%";}if(!this.ifDataHelper){this.ifDataHelper=new mstrmojo.mstr.DocElementDataHelper({source:this.editor.docModel.getDataService()});}else{this.ifDataHelper.set("items",null);}this.columnWalk.es.es.allowUnlistedValues=false;this.updateBrowseElementsParams(Q,P);this.ifDataHelper.browseConfig=Q;R=mstrmojo.func.wrapMethods(R,{complete:function(S){O.initScroll();}});this.ifDataHelper.getItems(1,R);},postNext:function C(){this.columnWalk.es.updateList(this.ifDataHelper.items);}});}());(function(){mstrmojo.requiresCls("mstrmojo.rw.ConditionWalk","mstrmojo.array","mstrmojo.css","mstrmojo.expr","mstrmojo.mstr.EnumNodeDimty","mstrmojo.mstr.DocElementDataHelper","mstrmojo.ui._IsIncFetchList");var E=mstrmojo.array,G=mstrmojo.css,C=mstrmojo.mstr.EnumNodeDimty,K=E.hash([C.NodeDimtyUnspecified,C.NodeDimtyNone]);function H(){var L=this.thresholdRow,M=this.editor;if(L){this.removeChildren(L);}G.toggleClass(M.content.domNode,"no-overflow",false);this.set("visible",false);M.setRowPanelVisibility(true);}mstrmojo.threshold.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,[mstrmojo.ui._IsIncFetchList],{objectBrowsingEnabled:false,dimtyTypes:K,targets:null,targetsLastMod:null,ets:null,condition:null,onOK:function B(){var L=this.editor;L.model.setConditionData(this.condition,this.model.get());H.call(this);L.toggleButtonStatus(true);},close:function I(){var O=this.editor;var Q=this.condition,M=Q.tree.parent,L=M.exprTree;if(Q.isEmpty()){Q.del();}var N=L&&L.items,P=N&&N.length;if(!P||P===0){O.model.deleteThreshold(M.threshold);}H.call(this);O.toggleButtonStatus(true);},browse:function F(L){this._super(L);if(L.alias==="es"){G.toggleClass(this.eb.domNode,"adv-threshold",true);}},getAttributeForms:function J(L){return mstrmojo.rw.ConditionWalk.getAttForms(L,this.editor.controller.datasets);},getElements:function D(O,R){var Q={},M=R.complete,N=this;this.scrollNode=this.columnWalk.es.scrollNode;var L=this.scrollNode&&this.scrollNode.style;if(L){L.height="100%";}if(!this.ifDataHelper){this.ifDataHelper=new mstrmojo.mstr.DocElementDataHelper({source:this.editor.controller.dataService});}else{var P=this.ifDataHelper;P.set("items",null);P.set("blockBegin",1);P.set("blockCount",0);P.set("totalSize",0);P.browseConfig.attributeID=O.did;}this.columnWalk.es.es.allowUnlistedValues=false;this.updateBrowseElementsParams(Q,O);this.ifDataHelper.browseConfig=Q;R=mstrmojo.func.wrapMethods(R,{complete:function(S){N.initScroll();N.set("isFetching",false);}});this.ifDataHelper.getItems(1,R);},postNext:function A(){this.columnWalk.es.updateList(this.ifDataHelper.items);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.css","mstrmojo.string","mstrmojo.dom","mstrmojo.boxmodel","mstrmojo.vi.models.EnumFieldTypes","mstrmojo.vi.ui.rw._IsLinkBox","mstrmojo.vi.ui.rw.RichTooltipBox","mstrmojo.vi.ui.rw.ImageBoxOverlay","mstrmojo.vi.ui.rw.ImageBoxOverlayURL","mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded");mstrmojo.requiresDescs(3415,10493,12277,12963,14634);var X=mstrmojo.css,B=mstrmojo.string,O=mstrmojo.hash,V=mstrmojo.boxmodel.px2Inches,G=mstrmojo.dom,H=mstrmojo.desc(14634,"Embedded_Image");function W(){if(this.boxContent&&B.isEmpty(this.boxContent.origV)){this.showControlOverlay(this.getEditOverlayControls());K.call(this,this.height,this.width);}else{this.hideControlOverlay();}}function K(Y,a){var b=this.ctrlOverlay;if(b&&b.imageBoxOverlay){var Z=b.imageBoxOverlay;Z.set("height",Y);Z.set("width",a);Z.doLayout();Z.hasChanged();}}mstrmojo.vi.ui.rw.ImageBox=mstrmojo.declare(mstrmojo.vi.ui.rw.RichTooltipBox,[mstrmojo.vi.ui.rw._IsLinkBox],{scriptClass:"mstrmojo.vi.ui.rw.ImageBox",ctrlOverlay:null,mode:"o",fw:100,fh:100,lock:true,isDynamicTooltip:true,tooltipTopOffset:35,isEmbedded:false,isEmbeddedImageFeatureEnabled:true,embeddedImageName:undefined,maskTooltip:mstrmojo.desc(15272,"Image cannot be selected as target"),init:function Q(b){this._super(b);var a=this.defn,Y=a&&a.fmts,Z=Y&&Y["img-name"];this.isEmbeddedImageFeatureEnabled=!!mstrApp.enableEmbeddedImages&&!G.isIE9;this.isEmbedded=!!a&&a.oid;this.embeddedImageName=(Z)?decodeURIComponent(Z):H;X.addWidgetCssClass(this,"mstrmojo-ImageBox");this.hostType=mstrmojo.vi.models.EnumFieldTypes.IMAGE;},getDisplayName:function I(){return this.defn.n||mstrmojo.desc(2922,"Image");},applyBoxSize:function P(Y,a,d,c){this._super(Y,a,d,c);var Z=parseInt(a,10)>=302?"h":"v";if(Z!==this.orientation){this.set("orientation",Z);}var b=this.boxContent;b.fw=this.fw;b.fh=this.fh;b.mode=this.mode;b.lock=this.lock;if(b.hasRendered){b.refresh();}K.call(this,Y,a);},getBoxDimension:function C(Y){return(Y==="h")?{f:false,l:null}:{f:true,l:40};},getAvatarCls:function L(){return this._super().concat(["imageAvatar"]);},createDeleteUpdate:function E(){return this.model.getRemoveFieldUpdate(this);},postBuildRendering:function S(){this._super();W.call(this);},updateOverlay:function N(){W.call(this);},showControlOverlay:function D(Y){this._super(Y);this.boxContent.set("visible",false);},hideControlOverlay:function U(){this._super();this.boxContent.set("visible",true);},urlEdited:function R(Y){this.boxContent.v=Y;this.isEmbedded=false;this.refresh();this.boxContent._isNewUrl=true;},localImageAdded:function M(Y){var Z=this.boxContent;Y.fieldKey=Z.k;Y.fieldName=Z.defn&&Z.defn.n||Z.k;Y.nodeKey=Z.defn.pnk;Y.sectionKey=Z.defn.pnk;Y.fieldGroupKey=Z.defn.fgk;var a=this;var b={success:function(c){a.boxContent.v=Y.base64Str;a.isEmbedded=true;a.refresh();a.boxContent._isNewEmbeddedImg=true;},complete:function(){mstrApp.hideWait();}};mstrApp.showWait({message:mstrmojo.desc(12963,"Uploading File...")});this.model.controller.uploadImageToServer(Y,b);},addFormatProps:function A(c,b){var a=this.boxContent,Y=this.model;c=this._super(c,b)||this.model.getUnitFormatAction(this,NaN,null,b);if(a&&!B.isEmpty(a.origV)){var Z=c.format=O.copy(c.format,{FormattingSize:{}});Z.FormattingSize.ImageWidth=V(Y.getZoomProps(),parseFloat(a.getImageWidth()));Z.FormattingSize.ImageHeight=V(Y.getZoomProps(),parseFloat(a.getImageHeight()));}return c;},getEditOverlayControls:function F(){return[{scriptClass:this.isEmbeddedImageFeatureEnabled?"mstrmojo.vi.ui.rw.ImageBoxOverlayEmbeded":"mstrmojo.vi.ui.rw.ImageBoxOverlayURL",alias:"imageBoxOverlay",imageBox:this,defn:this.defn}];},switchToEditMode:function J(){var a=this.ctrlOverlay;if(a.visible){a.imageBoxOverlay.imgURL.focus();return ;}this._super();K.call(this,this.height,this.width);var Z=this.boxContent.origV,Y=a.imageBoxOverlay.imgURL;if(this.isEmbedded){Y.set("value",this.embeddedImageName);a.imageBoxOverlay.origURLStr=this.embeddedImageName;}else{if(Z){Y.set("value",Z);a.imageBoxOverlay.origURLStr=Z;}}Y.focus();}});mstrmojo.vi.ui.rw.ImageBox.boxConfiguration={f:{h:166,v:76},minSize:{h:38,v:40},o:"v"};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.RichTooltipBox","mstrmojo._FormatDefinition","mstrmojo.css","mstrmojo.Label","mstrmojo.ui.menus.EditorConfig","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.vi.ui.rw._IsLinkBox","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.models.EnumFieldTypes","mstrmojo.hash");var e=mstrmojo.css,X=mstrmojo.hash,K=mstrmojo._FormatDefinition,D=mstrmojo.string,f=mstrmojo.vi.models.EnumDragSources,Q=mstrmojo.array,L=mstrmojo.vi.models.EnumFieldTypes;function P(j){this.boxContent.update({defn:this.defn,data:{v:j}});}function J(j){var m=j&&j.src&&j.src.data,k=this.model.datasets,l;if(!m||(m.src!==f.DATASETS&&m.src!==f.ALL_OBJECT_LIST)){return[];}l=k&&k[m.dsid];return(m.items||[]).filter(function(n){return !!n.n;}).map(function(o){var n=true;X.forEach(k,function(p){if(p.did!==m.dsid&&p.mx&&p.mx.some(function(q){return q.n===o.n;})){n=false;}});return l&&!n?"{["+l.name+"]:["+o.n+"]}":"{["+o.n+"]}";});}function U(){return !this.boxContent||D.isEmpty(this.boxContent.getRawText());}function c(){if(U.call(this)){this.showControlOverlay(this.getEditOverlayControls());}else{this.hideControlOverlay();}}function E(l,k,j){if(k!==j){P.call(mstrmojo.all[l],j);}}mstrmojo.vi.ui.rw.TextBox=mstrmojo.declare(mstrmojo.vi.ui.rw.RichTooltipBox,[mstrmojo.vi.ui._CanDropFromSchema,mstrmojo.vi.ui.rw._IsLinkBox],{scriptClass:"mstrmojo.vi.ui.rw.TextBox",isDynamicTooltip:true,tooltipTopOffset:35,maskTooltip:mstrmojo.desc(15273,"Text box cannot be selected as target"),selected:false,init:function Y(j){this._super(j);e.addWidgetCssClass(this,"mstrmojo-VITextBox");this.hostType=L.TEXT;},getDisplayName:function M(){return this.defn.n||mstrmojo.desc(1013,"Text");},textEdited:function S(l,k,j){if(k){var m=this.id;this.model.editField(this,L.TEXT,{fail:function(){E(m,l,j);}},l,j,null);}},getFormats:function h(){var j=X.clone(this._super());if(j){delete j.fx;}return j;},dropFromAllObjectsHandler:function Z(m,l,j,k){if(l){var n=this.id;this.model.editField(this,L.TEXT,{fail:function(){E(n,m,j);}},m,j,{actions:k.actions,callback:k.callback});}},applyBoxSize:function W(j,m,o,n){this._super(j,m,o,n);var l=this.boxContent,k=l&&l.getFormats();if(k){k.height=j;k.width=m;if(l.isQuill&&l.isEditing){l.updatedirCachDel();l.savedCurPos=null;l.refresh();}}},createDeleteUpdate:function G(){return this.model.getRemoveFieldUpdate(this);},addFormatProps:function B(l,k){l=this._super(l,k)||this.model.getUnitFormatAction(this,NaN,null,k);var j=l.format=X.copy(l.format,{FormattingSize:{}});j.FormattingSize.HeightMode=0;return l;},getBoxDimension:function F(k){var l=this.boxContent,j=l&&l.getFormats();return(k==="h")?{f:false,l:null}:{f:true,l:parseInt(j.height||"40px",10)};},getAvatarCls:function R(){return this._super().concat(["textAvatar"]);},ondrop:function b(n){this._super(n);var AA=J.call(this,n),u=this.boxContent,x=u.quillInstance,AC=x&&x.editor;if(AA.length&&u.isQuill){var z=u.dirCachDel,l=AC.delta,t=u.node.data&&u.node.data.rv,r="\u00df",v="\u01EF",w,k,p,o,m,j;if(!z&&!t){w={};w.insert=AA.join(" ")+" ";l.ops.unshift(w);x.setContents(l);k="";p=AC.delta.ops;Q.forEach(p,function(AE){k+=AE.insert;k+=r;});o=u.utf8_to_b64(JSON.stringify(p));k+=v+o;m=u.utf8_to_b64(u.domNode.style.background);k+=v+m;j=(u.node.data.rv&&u.node.data.rv!==k);if(j===undefined){j=true;}if(j){u.dirCachDel=null;}this.textEdited(k,j,"");}else{var AD=u.node.data;var q=(AD.rv).split(v),AB=u.b64_to_utf8(q[1]);if(!Q.isArray(AB)){AB=JSON.parse(AB);}if(AB.ops){l=AB;}else{l.ops=AB;}x.setContents(l);u.cacheGProps=u.b64_to_utf8(q[2]);u.domNode.style.background=this.cacheGProps;w={};w.insert=AA.join(" ")+" ";l.ops.unshift(w);x.setContents(l);k="";p=AC.delta.ops;Q.forEach(p,function(AE){k+=AE.insert;k+=r;});o=u.utf8_to_b64(JSON.stringify(p));k+=v+o;m=u.utf8_to_b64(u.domNode.style.background);k+=v+m;j=(AD.rv&&AD.rv!==k);if(j===undefined){j=true;}if(j){u.dirCachDel=null;}this.textEdited(k,j,"");}}else{if(AA.length){var s=u.getRawText();if(s){AA.unshift(s);}if(n.getCtxtDragData().src===f.ALL_OBJECT_LIST){this.augmentDropContextForSchema(n,this.getDocModel());this.dropFromAllObjectsHandler(AA.join(" "),true,s,n);}else{this.textEdited(AA.join(" "),true,s);}}}},allowDropFromDataset:function g(){return mstrApp.allowWebDashboardDesign();},getEditOverlayControls:function H(){return[{scriptClass:"mstrmojo.Widget",markupString:'<div class="init-img"></div>'},{scriptClass:"mstrmojo.Label",cssClass:"init-label",text:mstrmojo.desc(13034,"Type directly or drag objects here.")}];},switchToEditMode:function N(){var k=mstrApp.isAppStatePresentation();if(k){return ;}var j=this.boxContent;if(this.ctrlOverlay.visible){this.hideControlOverlay();}if(!j.isEditing){var l=j.getRawText();if(l&&j.isQuill){j.set("text",l);j.setDelta(l);}else{if(l){j.set("text",l);}}}this.boxContent.set("isEditing",true);},updateToolbar:function I(q){q.menus=[];var k=this.id,s=K.DefaultFormat.FormattingNumber,o=this.model;var n=this.boxContent,m=n.quillInstance,l=n.isQuill,r=mstrApp.isAppStatePresentation(),t,p=n&&l&&m;if(p&&n.retSelLink(m.getSelection())){q.menus=[];var j=n.retSelLink(m.getSelection());if(!r){t=mstrmojo.desc(15703,"Edit Link...");q.addMenuItem(t,"",function(){n.editURLLink(q.position,j);});t=mstrmojo.desc(15701,"Remove Link");q.addMenuItem(t,"",function(){n.removeURLLink(j);});t=mstrmojo.desc(15704,"Go To...");q.addMenuItem(t,"",function(){window.open(j);});}return q;}if(p&&n.getSelectionLength()>0){if(this._super){q=this._super(q);}q.menus=[];if(!r){t=n.hasActiveLink()?mstrmojo.desc(15703,"Edit Link..."):mstrmojo.desc(15702,"Link...");q.addMenuItem(t,"lnk",function(){if(n&&n.openURLBox){n.openURLBox(q.position);}});}return q;}if(p&&m.getSelection&&m.getSelection()){if(this._super){q=this._super(q);}q.menus=[];if(!r){t=mstrmojo.desc(11501,"Insert An Image");q.addMenuItem(t,"lnk",function(){n.uploadImage();});}return q;}else{if(this.canShowDesignMenuItems()&&!r){q.addPopupMenuItem(mstrmojo.desc(13237,"Number Format"),k,function(){var x=this.defn.numFmts||{},v=x.cat,u={category:v===undefined?K.NumberFormatCategory.Automatic:v,decimalPlaces:x.dp||2,thousandSeparator:x.ts||parseInt(s.ThousandSeparator,10),currencySymbol:x.cs||s.CurrencySymbol,currencyPosition:x.cp||s.CurrencyPosition,format:x.nfs||"",negativeNumbers:x.nn||s.NegativeNumbers},w=X.clone(u);return new mstrmojo.ui.menus.EditorConfig({data:w,cssClass:"NumberFormat-MenuEditor",contents:[{scriptClass:"mstrmojo.vi.ui.NumberFormatter",formatValue:u,myData:w,oldData:X.clone(u)}],fnOk:function z(AB){o.execute({execute:function AA(){var AE=o.getDataService().newUpdate(this),AD=mstrmojo.all[k];AE.addActions(Object.keys(s).map(function(AF){var AG={};AG[AF]=AB[AF.substr(0,1).toLowerCase()+AF.substr(1)];return o.getUnitFormatAction(AD,1,{FormattingNumber:AG});}));AE.addCallbacks({success:function AC(AF){o.partialUpdate(AF.data,o.getTargetDefn(AD.k),AF.defn,[AD.k]);o.selectVIUnit(k);}});AE.addExtras({style:{params:{treesToRender:3}}});AE.submit();}});}});});}}return this._super(q);},isDragValid:function C(j){return this._super(j)&&!this.boxContent.isEditing;},postBuildRendering:function a(){this._super();this.ctrlOverlay.domNode.onclick=function j(){this.switchToEditMode();}.bind(this);},postUpdateLayout:function A(){var j=this.isNewUnitContainer;this._super();if(j&&U.call(this)){this.switchToEditMode();}},toggleBoxSelection:function O(j){this._super(j);this.selected=!this.selected;},destroy:function d(k){var j=this.ctrlOverlay.domNode;if(j){delete j.onclick;}this._super(k);},shouldShowCustomizeContextMenu:function(){var j=this.boxContent;if(j.isQuill&&j.getSelectionLength()>=0){return true;}return !j.isEditing;},updateOverlay:function V(){c.call(this);}});mstrmojo.vi.ui.rw.TextBox.boxConfiguration={f:{h:150,v:42},minSize:{h:150,v:24},o:"v"};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Editor","mstrmojo.Box","mstrmojo.ValidationTextBox","mstrmojo.ME.AttributeEditBox","mstrmojo.ME.MetricEditBox","mstrmojo.ME.MetricToken","mstrmojo.ME.DynamicLinkEditBox","mstrmojo.mstr.EnumDSSXMLTokenStates");mstrmojo.requiresDescs(2399,2400,3993,4547,11569,11617,14720,14722);var N=mstrmojo.desc,l=mstrmojo.Button.newWebButton,c=mstrmojo.array,P=mstrmojo.hash,M=mstrmojo.ME.MetricToken.brackets,Y=mstrmojo.ME.AttributeEditBox.preprocessTokenStream,j=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,A=mstrmojo.ME.AttributeEditBox.validateSyntax,H=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS,X=mstrmojo.ME.DynamicLinkEditBox.preProcessBackendTks,m=mstrmojo.ME.DynamicLinkEditBox.convertBackendTksToDisplayTks,V=mstrmojo.ME.DynamicLinkEditBox.addDoubleQuotationMark,h=mstrmojo.ME.DynamicLinkEditBox.preprocessDisplayTokens,o=mstrmojo.ME.DynamicLinkEditBox.constructBackendToken,K=mstrmojo.mstr.EnumDSSXMLTokenStates,R="linkBox",E="hrefBox",D="linkTextInput",J="hrefInput";var Q="<a data='",a="' href='",L="' target='_blank'>",B="</a>",O="<a href='";function F(r,q){r.set("enabled",!q);r.set("iconClass",r.iconClass.replace(/mstrmojo-InlineWaitIcon/,"")+" "+(q?"mstrmojo-InlineWaitIcon":""));}function g(q,r){if(q&&r){r.candidates=null;r.set("candidates",q);}}function f(q){if(q.oi&&q.oi.alias){return ;}q.tmr=window.setInterval(function(){if(q.visible&&q.domNode){window.clearInterval(q.tmr);delete q.tmr;q.nameEditBox.nameInput.inputNode.select();}},50);}function G(q){return{n:q,k:q,ftk:[],vs:1,is:""};}mstrmojo.ME.DynamicLinkEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.ME.DynamicLinkEditor",cssClass:"mstrmojo-DAEditor mstrmojo-DLEditor",zIndex:10,help:"Dynamic_links_in_a_Grid_visualization.htm",useKeyDelay:true,noCache:false,name:"New Link",attrid:null,forms:null,defaultIDToken:undefined,editingNode:undefined,init:function k(r){var s=this,q=function(u){return s.children[c.find(s.children,"alias",u)];},t=function(u){var v=q(u);if(v){v.validateFunc=function(){this.parent.backendValidate();};}};t(D);t(J);if(this._super){this._super(r);}},postBuildRendering:function U(){this._super();this.hrefInput.inputBox.attachEventListener("tokenInputBoxSelected",this.id,"ontokenInputBoxSelected");this.linkTextInput.inputBox.attachEventListener("tokenInputBoxSelected",this.id,"ontokenInputBoxSelected");},onObjectInsert:function I(q){this.editingNode=this.editingNode||this.hrefInput;this.editingNode.onObjectInsert(q);},onOpen:function Z(){var v=this;var u=this.oi;var x=u.alias||u.n||"New Link";g(v.attrCandidates,v.linkTextInput.inputBox);g(v.attrCandidates,v.hrefInput.inputBox);this.linkTextInput.inputBox.noCache=this.hrefInput.inputBox.noCache=this.noCache;this.linkTextInput.inputBox.useKeyDelay=this.hrefInput.inputBox.useKeyDelay=this.useKeyDelay;this.set("name",x);this.set("nameLabel",mstrmojo.desc(14722,"Link Name"));if(u&&u.forms){this.set("attrid",u.did);this.forms=u.forms;c.forEach(this.forms,function(z){Y({items:z.ftk});});this.updateInputBoxesItems();}else{var s=this.parent.action.refOi;var w=s&&s.fs&&s.fs[0];this.defaultIDToken=w?{extp:8,exv:w.fid,ift:true,isNew:true,oi:s,v:M(s.n)+"@"+M(w.fnm),isRawStr:false}:null;var r=P.clone(this.defaultIDToken);var q=[{isDelimiter:true,isNew:true,v:"{"},r,{isDelimiter:true,isNew:true,v:"}"}],t=[{v:"http://",isDelimiter:false,isNew:true,sta:1,ift:undefined}];this.linkTextInput.updateInputBoxItems({items:q});this.hrefInput.updateInputBoxItems({items:t});this.set("forms",[G("ID"),G("DYNAMICLINK")]);}this.linkTextInput.set("cValid",true);this.hrefInput.set("cValid",true);f(this);},onClose:function b(){if(this._super){this._super();}this.clear();},onformsChange:function(){var q=this.forms;c.forEach(q,function(r){Y({items:r.ftk});});},ontokenInputBoxSelected:function(s){var q=s&&s.src&&s.src.parent,r=q&&q.alias;this.editingNode=this[r]||this.hrefInput;},updateInputBoxesItems:function(){var q=this.forms;if(!q){return ;}var t=q[0].ftk,r=q[1].ftk,w=this.translateBackendTokensToDisplayTokens(r),s=w[0],v=w[1];this.linkTextInput.updateInputBoxItems({items:s});this.hrefInput.updateInputBoxItems({items:v});var u=X(t);this.defaultIDToken=u[0];this.defaultIDToken.isRawStr=false;},save:function S(){var v=this.parent.id,AD=this.oi,t=this.buttonBar.saveBtn,u=this,w=this.hrefInput,AB=this.linkTextInput,q=AD.dsid,s=AD.did,x,AA=this.oncreate,r=this.onupdate,AG=this.nameEditBox.nameInput.value;var AF={success:function AE(){F(t,false);u.clear();var AH=mstrmojo.all[v];if(AH){AH.close();}}};var AC=function(AI){if(AI&&AA){var AH=[],AJ;for(AJ=0;AJ<AI.length;AJ++){AH.push({n:AI[AJ].n,formula:AI[AJ].tokenXML});}if(AH[1]){AH[1].bft=7;}x={act:"addDAToDataset",dsid:q,name:AG,isTokenStream:true,forms:AH};AA(x,AF);}else{F(t,false);}};var z=function(AH){if(AH&&r){var AK=[],AJ=[],AM,AL,AI;for(AI=0;AI<AH.length;AI++){AM=AH[AI];AL={n:AM.n,formula:AM.tokenXML};if(AM.did){AL.did=AM.did;AJ.push(AL);}else{AK.push(AL);}}x={act:"updateDA",name:AG,dsid:q,attrId:s,isTokenStream:true,add:AK,del:[],update:AJ};r(x,AF);}else{F(t,false);}};if(w.dirty||AB.dirty||AG!==(AD.alias||AD.n)){F(t,true);this.linkTextInput.set("vStatus",H.VALIDATING);this.hrefInput.set("vStatus",H.VALIDATING);this.validateForms(!s?AC:z);}else{AF.success();}},generateTksToBeSent:function C(s,v,t){var r=function(AF,AE){var AD=[],AC={};if(t){AD.push(t);AC[t.v]=[t.oi&&t.oi.did];}var AB=function AB(AH,AJ){var AG=AJ[AH.v];if(AG){var AI=AH.oi&&AH.oi.did;if(AI&&AG.indexOf(AI)===-1){AG.push(AI);return false;}return true;}AJ[AH.v]=[AH];return false;};c.forEach([].concat(AF,AE),function(AG){if(!AG.isRawStr&&!AB(AG,AC)){AD.push(AG);}});return o(AD);};var z={v:Q,isRawStr:true,isNew:true},x={v:a,isRawStr:true,isNew:true},AA={v:L,isRawStr:true,isNew:true},w={v:B,isRawStr:true,isNew:true},q=h(s,true)||[],u=h(v)||[];return[r(q,u),o([z].concat(u).concat(x).concat(q,AA,u,w))];},translateBackendTokensToDisplayTokens:function W(v){var u=X(v),q=c.find(u,"v",V(L));if(q===-1||(u[0].v!==V(Q)&&u[0].v!==V(O))||u[u.length-1].v!==V(B)){return[[],[]];}var t=c.find(u,"v",V(a));if(t===-1){t=c.find(u,"v",V(O));}var s=u.slice(t+1,q),r=u.slice(q+1,u.length-1);return[m(r),m(s,true)];},validateForms:function n(z){var x=this,r=this.hrefInput,v=this.linkTextInput,w=this.generateTksToBeSent(r.inputBox.items,v.inputBox.items,this.defaultIDToken);this.forms[0].ftk=w[0];this.forms[1].ftk=w[1];var s=this.forms;var u=function q(AB){var AA=s[0];AA.ftk=AB.items;AA.vs=AB.vs;AA.is=AB.rjed||"";AA.tokenXML=j({items:AB.items});if(AB.vs!==H.VALID){if(z){z(null,false);}}else{if(z){z(s,true);}}};var t=function t(AE){var AD=s[1];AD.ftk=AE.items;AD.vs=AE.vs;AD.is=AE.rjed||"";AD.tokenXML=j({items:AE.items});if(AE.vs!==H.VALID){var AB=x.translateBackendTokensToDisplayTokens(AE.items);var AA={};var AC={};P.copy(AE,AA);P.copy(AE,AC);AA.items=AB[0];AC.items=AB[1];if(c.find(AA.items,"sta",K.Error)===-1){AA.vs=H.UNKNOWN;AA.rjed=undefined;AA.rjec=undefined;}if(c.find(AC.items,"sta",K.Error)===-1){AC.vs=H.UNKNOWN;AC.rjed=undefined;AC.rjec=undefined;}v.handleValidation(AA);r.handleValidation(AC);if(z){z(null,false);return ;}}A(x.attrid,{items:s[0].ftk},true,u);};A(this.attrid,{items:s[1].ftk},false,t);},clear:function e(){this.name=null;this.linkTextInput.clear();this.hrefInput.clear();},children:[{scriptClass:"mstrmojo.Box",alias:"nameEditBox",cssClass:"mstrmojo-ME-nameEditBox",cssDisplay:"inline-block",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DA-nameLabel",bindings:{text:"this.parent.parent.nameLabel"}},{scriptClass:"mstrmojo.ValidationTextBox",alias:"nameInput",cssClass:"mstrmojo-ME-nameInput",size:20,tooltipOpenDelay:0,constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,invalidCssClass:"mstrmojo-ME-invalidName"},prefocus:function(){if(this._super){this._super();}this.validate();},validate:function(q){q=q||this.value;var r=q&&!/[\[\]\"\\]/g.test(q);this.valid=null;this.set("valid",r);this.set("validationStatus",{code:r?0:1});return r;},showErrTooltip:function p(){var q=mstrmojo.dom.position(this.domNode),s=mstrmojo.string.isEmpty(this.value)?mstrmojo.desc(9122,"Name cannot be empty"):mstrmojo.desc(11569,"Input contains invalid character");this.useRichTooltip=true;this.richTooltip={contentNodeCssClass:"me-tooltip-content left me-err",content:'<div class="content"><span>'+s+"</span></div>",top:q.y-5,left:q.x+q.w+10};this.showTooltip();var r=this;window.setTimeout(function(){r.hideTooltip();},1500);},valid:true,onvalidChange:function(){if(this.valid){this.hideTooltip();}else{this.set("validationStatus",1);this.showErrTooltip();}mstrmojo.css.toggleClass(this.parent.domNode,"err",!this.valid);},bindings:{value:"this.parent.parent.name"}}]},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-LE-Box",alias:R,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DL-Label mstrmojo-LE-Label",text:mstrmojo.desc(14720,"URL Display Text")},{scriptClass:"mstrmojo.Button",alias:"clearBtnLinkBox",text:mstrmojo.desc(2827,"Clear"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll hoverLink",onclick:function(){this.parent.parent.linkTextInput.clear();this.parent.parent.linkTextInput.set("cValid",false);}}]},{scriptClass:"mstrmojo.ME.DynamicLinkEditBox",alias:D,renderOnScroll:false,renderBlockSize:0,browseItemVisible:false,cValid:false,bindings:{candidates:"this.parent.parent.attrCandidates"},getStatusDesc:function d(q){return{0:mstrmojo.desc(11655,"Valid Formula."),1:mstrmojo.desc(3993,"Example:")+" Link for {City@ID}'s images"}[q];}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-LE-Box",alias:E,children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-DL-Label mstrmojo-LE-Label",text:mstrmojo.desc(4547,"Navigate to this URL")},{scriptClass:"mstrmojo.Button",alias:"clearBtnHRefBox",text:mstrmojo.desc(2827,"Clear"),cssClass:"mstrmojo-WebHoverButton mstrmojo-AEB-clearAll hoverLink",onclick:function(){this.parent.parent.hrefInput.clear();this.parent.parent.hrefInput.set("cValid",false);}}]},{scriptClass:"mstrmojo.ME.DynamicLinkEditBox",alias:J,renderOnScroll:false,renderBlockSize:0,browseItemVisible:false,cValid:false,bindings:{candidates:"this.parent.parent.attrCandidates"},getStatusDesc:function d(q){return{0:mstrmojo.desc(11655,"Valid Formula."),1:mstrmojo.desc(3993,"Example:")+" http://www.google.com/search?tbm=isch&q={City@ID}"}[q];}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[l(N(2400,"Save"),function(){var q=this.parent.parent;q.save();},true,{alias:"saveBtn",bindings:{enabled:"!!(this.parent.parent.nameEditBox.nameInput.valid && this.parent.parent.hrefInput.cValid && this.parent.parent.linkTextInput.cValid)"}}),l(N(2399,"Cancel"),function(){var q=this.parent.parent,r=q.parent;q.clear();r.close();})]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.locales");mstrmojo.requiresCls("mstrmojo.chart.enums.EnumFontStyle");mstrmojo.requiresCls("mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.chart.common","DSSDateTime","ScalePlate");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphProperty","EnumDSSGraphDataTextShowType","EnumDSSGraphObject");var h=mstrmojo.chart,d=h.model,q=mstrmojo.VisUtility,Q=h.enums,E=Q.EnumFontStyle,S=d.enums,AA=S.EnumDSSGraphProperty,Y=S.EnumDSSGraphDataTextShowType,AB=S.EnumDSSGraphObject;var F=mstrmojo.gm.EnumDataLabels;var W=[["xAxLbFntClr","yAxLbFntClr","dlFntClr","lgdFntClr"],["xAxLbFntFml","yAxLbFntFml","dlFntFml","lgdFntFml"],["xAxLbFntSz","yAxLbFntSz","dlFntSz","lgdFntSz"],["xAxLbFntStyle","yAxLbFntStyle","dlFntStyle","lgdFntFml"]];var r=[["majorGridLnThk","minerGridLnThk","majorGridLnThk","minerGridLnThk"],["majorGridLnClr","minerGridLnClr","majorGridLnClr","minerGridLnClr"],["majorGridLnStyle","minerGridLnStyle","majorGridLnStyle","minerGridLnStyle"]];var Z=[["bgFillClr"],["bgFillStyle"],["bgFillTrans"]];function V(AK){switch(AK){case AA.DssGraphFontColor:return 0;case AA.DssGraphFontName:return 1;case AA.DssGraphFontSize:return 2;case AA.DssGraphFontStyle:return 3;case AA.DssGraphFontSize100:return 4;default:return -1;}}function v(AK){switch(AK){case AA.DssGraphAreaColor:return 0;case AA.DssGraphFillEffect:return 1;case AA.DssGraphAreaAlpha:return 2;}return -1;}function x(AK){var AL;switch(AK){case AB.DssGraphX1Body:case AB.DssGraphX1Label:case AB.DssGraphX1Major:case AB.DssGraphX1Minor:case AB.DssGraphUserLabel3:case AB.DssGraphUserLine3:AL="X1";break;case AB.DssGraphX2Body:case AB.DssGraphX2Label:case AB.DssGraphX2Major:case AB.DssGraphX2Minor:case AB.DssGraphUserLabel4:case AB.DssGraphUserLine4:AL="X2";break;case AB.DssGraphY1Body:case AB.DssGraphY1Label:case AB.DssGraphY1Major:case AB.DssGraphY1Minor:case AB.DssGraphUserLabel1:case AB.DssGraphUserLine1:AL="Y1";break;case AB.DssGraphY2Body:case AB.DssGraphY2Label:case AB.DssGraphY2Major:case AB.DssGraphY2Minor:case AB.DssGraphUserLabel2:case AB.DssGraphUserLine2:AL="Y2";break;case AB.DssGraphZBody:AL="Z";break;case AB.DssGraphO1Body:case AB.DssGraph2DO1Label:case AB.DssGraphO1Major:case AB.DssGraphO1Minor:AL="O1";break;case AB.DssGraphO2Body:case AB.DssGraph2DO2Label:case AB.DssGraphO2Major:case AB.DssGraphO2Minor:AL="O2";break;default:AL="No_Axis";break;}return AL;}function e(AK,AL){if(!!AK===false){return undefined;}return undefined;}function X(AP,AK){if(!!AP===false){return undefined;}var AU,AS,AR=AK.isVertical!==undefined?AK.isVertical:true,AM=AK.isGridChart||false,AV=AK.isPieShape||false,AQ={Name:0,Value:0},AN=AP.gaid,AO=AP.goid,AL=AP.gsid,AT=AP.v;if(!!AN===false){return undefined;}switch(AN){case AA.DssGraphShowLBLFeeler:if(AV){AQ.Name="DataLabel";if((AT&Y.DssGraphDataTextValue)!==0){AQ.Value=F.SHOW_VALUE_ONLY;}else{if((AT&Y.DssGraphDataTextLabel)!==0){AQ.Value=F.SHOW_TEXT_ONLY;}else{AQ.Value=F.HIDE;}}}break;case AA.DssGraphAreaColor:case AA.DssGraphFillEffect:case AA.DssGraphAreaAlpha:AS=v.call(this,AN);if(AS<0){return undefined;}if(AO===AB.DssGraphBackground){AQ.Name=Z[AS][0];if(AQ.Name.search("Trans")!==-1){AQ.Value=AT/255*100;}else{AQ.Value=AT;}}break;case AA.DssGraphShowLegendText:AQ.Name="LegendVisibleness";AQ.Value=AT===0?false:true;break;case AA.DssGraphSDShowDataText:AQ.Name="ShowSeriesDataLabel";AQ.Value=AT!==0;break;case AA.DssGraphShowDataText:if(AV===false){AQ.Name="DataLabel";AQ.Value=F.HIDE;if(AT&Y.DssGraphDataTextValue){AQ.Value=F.SHOW_VALUE_ONLY;}else{if(AT&Y.DssGraphDataTextLabel){AQ.Value=F.SHOW_TEXT_ONLY;}}}break;case AA.DssGraphFontColor:case AA.DssGraphFontName:case AA.DssGraphFontSize100:case AA.DssGraphFontSize:case AA.DssGraphFontStyle:AQ.Value=AT;AU=x.call(this,AO);AS=V.call(this,AN);if(AS<0){return undefined;}if(AS===4){AS=3;AQ.Value/=100;}if(AU==="No_Axis"){if(AO===AB.DssGraphDataText){if(AV){return undefined;}AQ.Name=W[AS][2];}else{if(AO===AB.DssGraphPieFeelerLabel||AO===AB.DssGraphPieFeelerLabel){if(AV===false){return undefined;}AQ.Name=W[AS][2];}else{if(AO===AB.DssGraphLegendText){AQ.Name=W[AS][3];}else{return undefined;}}}}else{if(AU[0]==="X"){AQ.Name=W[AS][0];}else{if(AU[0]==="Y"){AQ.Name=W[AS][1];}else{if(AU[0]==="O"){AQ.Name=AR?W[AS][0]:W[AS][1];}else{return undefined;}}}}break;}return AQ;}var U,k=String.fromCharCode,AE=mstrmojo.locales.datetime,AJ=0,L=document.getElementById("measureText"),B={},j={};var o=0.03,K=0,R=0,H=0.2;function p(AL){var AK,AM=[],AN;for(AK=0;AK<=AL;AK++){AN=AK.toString(16);if(AN.length===1){AN="0"+AN;}AM[AK]=AN;}U=AM;return AM;}function AH(AK){var AL=parseFloat(AK);if(isNaN(AL)===false&&AL!==undefined&&AL!==null){return AL;}return 0;}function D(AK){AK=AK.replace(/ddd/g,"EEE");AK=AK.replace(/AM\/PM/g,"a");AK=AK.replace(/tt/g,"a");AK=AK.replace(/:'/g,":");AK=AK.replace(/'\/'/g,"/");AK=AK.replace(/\\/g,"");var AL,AN=true,AM=AK.length;for(AL=0;AL<AM;AL++){if(AK[AL]==="h"||AK[AL]==="H"||AK[AL]===":"){AN=true;}else{if(AK[AL]===" "&&AN){AN=true;}}if(AK[AL]==="m"&&AN){AK=AK.substring(0,AL)+"M"+AK.substring(AL+1);}}return AK;}mstrmojo.chart.common.Utility=mstrmojo.provide("mstrmojo.chart.common.Utility",{point2D:{},rect2D:{},tripleId:{create:function M(AL,AP,AN,AM,AO){if(AL===null||AL===undefined){AL=-3;}if(AP===null||AP===undefined){AP=-3;}if(AN===null||AN===undefined){AN=-3;}var AK={mObjectId:AL,mSeriesId:AP,mGroupId:AN};if(AM!==undefined&&AM!==null){AK.angleByIndex=AM;}if(AO!==undefined&&AO!==null){AK.sliceById=AO;}return AK;},walks:function m(AO,AM){if(!!AO===false||!!AM===false){return null;}if(AO.length===1){return AM[AO[0]];}var AN=(AO&&AO.length)||0,AL,AK=AO[AL];for(AL=0;AL<AN;AL++){if(AM[AK]===undefined){AM[AK]={};}AM=AM[AK];}return AM;},equal:function b(AK,AL){return(AK.mObjectId===AL.mObjectId&&AK.mSeriesId===AL.mSeriesId&&AK.mGroupId===AL.mGroupId);},reset:function s(AM,AO,AN,AL,AK,AP){AM.mObjectId=AO!==undefined?AO:-3;AM.mSeriesId=AN!==undefined?AN:-3;AM.mGroupId=AL!==undefined?AL:-3;if(AK!==undefined&&AK!==null){AM.angleByIndex=AK;}if(AP!==undefined&&AP!==null){AM.sliceById=AP;}return AM;}},transformProperty:function A(AK,AM,AL){if(AM===0){return X.call(this,AK,AL);}return e.call(this,AK,AL);},abbreviateNumber:function c(AU,AK){var AV,AL,AW="",AN=(AU<0),AX=(this.isIntegar(AU)===false);if(AX){AK++;}if(AU<0){AK++;}var AQ=AN?-AU:AU;var AR=0;if(AQ>=1e+27){AQ=999;AW="Y";}else{if(AQ>=1e+24){AQ/=1e+24;AW="Y";}else{if(AQ>=1e+21){AQ/=1e+21;AW="Z";}else{if(AQ>=1000000000000000000){AQ/=1000000000000000000;AW="E";}else{if(AQ>=1000000000000000){AQ/=1000000000000000;AW="P";}else{if(AQ>=1000000000000){AQ/=1000000000000;AW="T";}else{if(AQ>=1000000000){AQ/=1000000000;AW="B";}else{if(AQ>=1000000){AQ/=1000000;AW="M";}else{if(AQ>=1000){AQ/=1000;AW="K";}else{if(AQ>=1){AR++;}else{if(AQ>=0.001){AR++;}else{if(AQ>=0.000001){AR++;}else{if(AQ>=1e-9){AR++;}else{if(AQ>=1e-12){AR++;}else{AN=false;}}}}}}}}}}}}}}if(this.isIntegar(AQ)===false){AV=AQ.toString();var AM=5,AP=2,AY;AL=AV.indexOf(".");AY=AV.length-AL-1;if(AY>AM||(AY>AP&&AY>AL)){if(AY>AM&&AK-AY<0){AP=Math.max(AP,Math.min(AP,AK-AY));}else{AP=Math.max(1,Math.min(AP,AK-AY));}AQ=AQ.toFixed(AP);}}AV=AQ.toString();if(this.isIntegar(AQ)===false){var AT=AV.length-1;AL=AV.indexOf(".");if(AL!==-1){if(AL>=AT){AV=AV.substring(0,AL);}else{var AS,AO=true;for(AS=AT;AS>AL&&AO;--AS){if(AV[AS]!=="0"){AO=false;}}if(AO){AV=AV.substring(0,AL);}}}}if(AN){AV="-"+AV;}AV+=AW;return AV;},getScalePlate:function AG(AK){AK=AK||false;this.mScalePlate=mstrmojo.chart.common.ScalePlate;if(AK){this.mScalePlate.clear();}return this.mScalePlate;},prepareScalePlateOptions:function AD(AM,AL,AN){var AK={mUseLogarithmicScale:AM,mAlwaysIncludeZero:!AM&&(AL||!!(AN&1)||!!(AN&2)),mShowMinLabel:true,mShowMaxLabel:true,mDrawCustomLine:false,mAxisMinValue:0,mAxisMaxValue:0,mAxisCustomValue:0,mUseCustomMinMax:false};return AK;},evaluateTextMargin:function P(AK){this.mTextMargins=this.mTextMargins||{};var AL=this.mTextMargins;if(AL[AK]){return AL[AK];}var AM=[];AM[0]=Math.floor(AK*o+0.5);AM[1]=Math.floor(AK*K+0.5);AM[2]=Math.max(Math.floor(AK*R+0.5),1);AL[AK]=AM;return AM;},AlmostZero:function z(AK){return(Math.abs(AK)<0.000001);},isValidNumber:function J(AK){if(typeof AK==="number"){if(AK===0){return true;}return !!AK;}return false;},isIntegar:function l(AK){return AK===+AK&&AK===(AK|0);},HasArrayIntersection:function O(AL,AK){var AM;for(AM=0;AM<AL.length;AM++){if(AK.indexOf(AL[AM])!==-1){return true;}}return false;},EscapeString:function C(AK){var AM='"',AL='\\"',AN=new RegExp(AM,"g");return String(AK).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"\\\\").replace(AN,AL).replace(/\r\n/g,"<br/>").replace(/\r/g,"<br/>").replace(/\n/g,"<br/>");},EscapeStringForJSON:function N(AK){var AM='"',AL='\\"',AN=new RegExp(AM,"g");return String(AK).replace(/\\/g,"\\\\").replace(AN,AL).replace(/\r/g,"\\r").replace(/\n/g,"\\n");},TrimLastComma:function AF(AL){var AK;if(!AL.buf||AL.len===-1){return ;}AK=AL.len;var AM=String(AL.buf[AK]);if(AM&&AM[AM.length-1]===","){AL.buf[AK]=AM.slice(0,-1);}},decodeUTF8:function g(AK){var AL="",AN=0,AP=0,AO=0,AM=0;while(AN<AK.length){AP=AK.charCodeAt(AN);if(AP<128){AL+=k(AP);AN++;}else{if((AP>191)&&(AP<224)){AO=AK.charCodeAt(AN+1);AL+=k(((AP&31)<<6)|(AO&63));AN+=2;}else{AO=AK.charCodeAt(AN+1);AM=AK.charCodeAt(AN+2);AL+=k(((AP&15)<<12)|((AO&63)<<6)|(AM&63));AN+=3;}}}return AL;},formatDateTimeValue:function f(AL,AQ){var AO=new mstrmojo.chart.common.DSSDateTime({ifTime:AQ});var AK="";var AN="";var AR=0;while(AR<AL.length){var AM=1;switch(AL.charAt(AR)){case"[":AR++;while(AR<AL.length&&AL.charAt(AR)!=="]"){AN+=AL.charAt(AR);AR++;}if(AN.length>0&&(AN[0]===">"||AN[0]==="<"||AN[0]==="=")){AN="";}AR++;break;case"y":AR++;while(AR<AL.length&&AL.charAt(AR)==="y"){AM++;AR++;if(AM===4){break;}}if(AM===1||AM===2){AK+=this.fillZeroToWidth(AO.mnYear%100,2);}else{if(AM===3){AK+=this.fillZeroToWidth(AO.mnYear%100,2);AR--;}else{if(AM===4){AK+=AO.mnYear;}}}break;case"M":AR++;while(AR<AL.length&&AL.charAt(AR)==="M"){AM++;AR++;}if(AM<3){AK+=this.fillZeroToWidth(AO.mnMonth,AM);}else{if(AM===3){AK+=AE.MONTHNAME_SHORT[AO.mnMonth];}else{AK+=AE.MONTHNAME_FULL[AO.mnMonth];}}break;case"d":AR++;while(AR<AL.length&&AL.charAt(AR)==="d"){AM++;AR++;}if(AM<3){AK+=this.fillZeroToWidth(AO.mnDay,AM);}else{if(AM===3){AK+=AE.dayShortNames[AO.mnDay];}else{AK+=AE.dayNames[AO.mnDay];}}break;case"h":AR++;while(AR<AL.length&&AL.charAt(AR)==="h"){AM++;AR++;}var AP=AO.mnHour;if(AP===0){AP=12;}if(AP>12){AP-=12;}AK+=this.fillZeroToWidth(AP,AM);break;case"H":AR++;while(AR<AL.length&&AL.charAt(AR)==="H"){AM++;AR++;}AK+=this.fillZeroToWidth(AO.mnHour,AM);break;case"m":AR++;while(AR<AL.length&&AL.charAt(AR)==="m"){AM++;AR++;}AK+=this.fillZeroToWidth(AO.mnMinute,AM);break;case"s":AR++;while(AR<AL.length&&AL.charAt(AR)==="s"){AM++;AR++;}AK+=this.fillZeroToWidth(AO.mnSecond,AM);break;case"S":AR++;while(AR<AL.length&&AL.charAt(AR)==="S"){AM++;AR++;}AK+=this.fillZeroToWidth(AO.mnMillisecond,AM);break;case"a":AP=AO.mnHour;if(AP<12){AK+=AE.AM_NAME;}else{AK+=AE.PM_NAME;}AR++;break;default:AK+=AL.charAt(AR++);break;}}if(AN.length!==0){AK='<SPAN STYLE="COLOR: '+AN+'" >'+AK+"</SPAN>";}return AK;},fillZeroToWidth:function n(AO,AM){var AL="",AN=AL+AO;var AK=AN.length;while(AK<AM){AN="0"+AN;AK++;}return AN;},updateCache:function AI(AL,AO,AP){var AN=(AO&&AO.length)||0,AM,AK,AQ=AL;for(AM=0;AM<AN-1;AM++){AK=AO[AM];if(!AQ[AK]){AQ[AK]={};}AQ=AQ[AK];}AQ[AO[AN-1]]=AP;},measureTextHeight:function(AP,AM,AT,AQ,AK){var AS,AO=AP;if(AO===" "){AO="\u00A0";}AK=AK||"pt";if(typeof AT==="number"){AT=AT+AK;}var AL="none",AR="normal";if(AQ&E.FS_ITALIC){AL="italic";}if(AQ&E.FS_BOLD){AR="bold";}var AN={fontFamily:AM,fontSize:AT,fontStyle:AL,fontWeight:AR};if(j&&j.H&&j.H[AM]&&j.H[AM][AT]&&j.H[AM][AT][AQ]){AS=j.H[AM][AT][AQ];}else{AS=q.measureTextHeight("H",AN,1);this.updateCache(j,["H",AM,AT,AQ],AS);}return AS;},measureText:function w(AR,AO,AX,AS,AM){var AL=true,AK,AV=AX+1;var AQ=AR;if(AQ===" "){AQ="\u00A0";}AM=AM||"pt";if(typeof AX==="number"){AX=AX+AM;}if(B&&B[AQ]&&B[AQ][AO]&&B[AQ][AO][AX]&&B[AQ][AO][AX][AS]){return B[AQ][AO][AX][AS];}if(AL){var AN="normal",AT="normal";if(AS&E.FS_ITALIC){AN="italic";}if(AS&E.FS_BOLD){AT="bold";}var AP={fontFamily:AO,fontSize:AX,fontStyle:AN,fontWeight:AT};if(j&&j.H&&j.H[AO]&&j.H[AO][AX]&&j.H[AO][AX][AS]){AV=j.H[AO][AX][AS];}else{AV=q.measureTextHeight("H",AP,true);this.updateCache(j,["H",AO,AX,AS],AV);}AK=q.measureTextWidth(AR,AP,0);}else{if(!L){var AU=document.createElement("div");AU.id="measureText";AU.style.position="absolute";AU.style.top="0";AU.style.visibility="hidden";AU.style.height="auto";AU.style.width="auto";document.body.appendChild(AU);L=AU;}L.innerHTML="";L.appendChild(document.createTextNode(AQ));L.style.fontFamily=AO;L.style.fontSize=AX;L.style.fontWeight="normal";L.style.fontStyle="none";if(AS&E.FS_ITALIC){L.style.fontStyle="italic";}if(AS&E.FS_BOLD){L.style.fontWeight="bold";}AK=L.scrollWidth+1;AV=L.scrollHeight+1;}var AW={Width:AK,Height:AV};this.updateCache(B,[AQ,AO,AX,AS],AW);return AW;},ReplaceDecimalPoint:function AC(AL,AK){return AL.replace(".",AK);},ReplaceMinusSign:function u(AK,AL){return AK.replace("-",AL);},insert:function G(AL,AK,AM){if(typeof AL==="string"&&typeof AK==="string"&&AM<=AL.length){return AL.substr(0,AM)+AK+AL.substr(AM);}return AL;},InsertThousandSeparator:function t(AM,AN,AR){var AK=AR.mstrDecimalPoint;var AL=AM.indexOf(AK);if(AL===-1){AL=AM.length;}var AO=0;while(AO<AL&&!this.chk_val(AM.charAt(AO))){AO++;}var AQ=AM;var AP;for(AP=AL-3;AP>AO;AP-=3){AQ=this.insert(AQ,AN,AP);}return AQ;},chk_val:function I(AK){return/^\d+$/.test(AK);},hFormatValue:function a(AX,AO,Ai,A7){var AV=0;var Aq=0;var Ae=AX.length;var BF=false;if(!A7){A7={};var Ao=window.navigator.userLanguage||window.navigator.language;var BQ=Ao.split("-");this.mstrLanguageCode=BQ[0];this.mstrCountryCode=BQ[1]||BQ[0];A7.mstrThousandSeparator=mstrmojo.locales.number.THOUSANDSEPARATOR||",";A7.mstrCurrencySymbol="$";A7.mstrDecimalPoint=mstrmojo.locales.number.DECIMALSEPARATOR||".";A7.mstrPercentSign="%";A7.mstrMinusSign="-";}while(AV<Ae){if(AX.charAt(AV)==='"'){AV++;while(AV<Ae&&AX.charAt(AV)!=='"'){AV++;}AV++;}else{if(AX.charAt(AV)==="["){AV++;var Ap="";while(AV<Ae&&AX.charAt(AV)!=="]"){Ap+=AX.charAt(AV);AV++;}if(Ap.length>1&&(Ap.charAt(0)===">"||Ap.charAt(0)==="<"||Ap.charAt(0)==="=")){var AL=-1;var A9=0;switch(Ap.charAt(0)){case">":if(Ap.charAt(1)>="0"&&Ap.charAt(1)<="9"){AL=1;A9=1;}else{if(Ap.charAt(1)==="="&&Ap.length>2&&Ap.charAt(2)>="0"&&Ap.charAt(2)<="9"){AL=2;A9=2;}}break;case"=":if(Ap.charAt(1)>="0"&&Ap.charAt(1)<="9"){AL=3;A9=1;}else{if(Ap.charAt(1)==="="&&Ap.length>2&&Ap.charAt(2)>="0"&&Ap.charAt(2)<="9"){AL=3;A9=2;}}break;case"<":if(Ap.charAt(1)>="0"&&Ap.charAt(1)<="9"){AL=5;A9=1;}else{if(Ap.charAt(1)==="="&&Ap.length>2&&Ap.charAt(2)>="0"&&Ap.charAt(2)<="9"){AL=4;A9=2;}}break;}if(AL>0){var AZ=Ap.substr(A9);var BI=parseFloat(AZ);if((AL===1&&AO>BI)||(AL===2&&AO>=BI)||(AL===3&&AO===BI)||(AL===4&&AO<=BI)||(AL===5&&AO<BI)){BF=true;}return mstrmojo.num.formatByMask(AX,AO);}}}else{if(AX.charAt(AV)===";"){if(BF){Ae=AV;break;}else{Aq=AV+1;AV++;}}else{AV++;}}}}if(!BF){Aq=0;}AV=Aq;var Av=false;while(AV<Ae){if(AX.charAt(AV)==='"'){AV++;while(AV<Ae&&AX.charAt(AV)!=='"'){AV++;}}else{if(AX.charAt(AV)==="["){AV++;while(AV<Ae&&AX.charAt(AV)!=="]"){AV++;}}else{if(AX.charAt(AV)==="y"||AX.charAt(AV)==="M"||AX.charAt(AV)==="d"||AX.charAt(AV)==="h"||AX.charAt(AV)==="H"||AX.charAt(AV)==="m"||AX.charAt(AV)==="s"||AX.charAt(AV)==="S"){Av=true;break;}else{AV++;}}}}if(Av){var BD="";if(BF){BD=AX.substr(Aq,Ae-Aq);}else{BD=AX;}return mstrmojo.num.formatByMask(BD,AO);}var BH;var Am;var As=false;var AR=false;var BC=false;var Ad=false;var BN=[];var Ah="";var Aa=0;var A8=false;var AY=0;var BO="";var AS="";var Al="";var A6="";var AW=0;var BK=0;var BJ=false;var BA=A7.mstrCurrencySymbol;var A1=A7.mstrThousandSeparator;var Ax=A7.mstrDecimalPoint;var BB=A7.mstrPercentSign;var A5=A7.mstrMinusSign;AV=Aq;var Ak="";if(AO<0&&!BF){while(AV<Ae&&AX.charAt(AV)!==";"){if(AX.charAt(AV)==='"'){AV++;while(AV<Ae&&AX.charAt(AV)!=='"'){AV++;}}AV++;}AV++;if(AV>=Ae){if(AO<0){BO+="-";}AV=Aq;}}var BP=false;while(AV<Ae){var Ar=false;switch(AX.charAt(AV)){case"[":AV++;while(AV<Ae&&AX.charAt(AV)!=="]"){Al+=AX.charAt(AV);AV++;}if(Al.length>0&&(Al.charAt(0)===">"||Al.charAt(0)==="<"||Al.charAt(0)==="=")){Al="";}AV++;break;case'"':AV++;while(AV<Ae&&AX.charAt(AV)!=='"'){if(BP){AS+=AX.charAt(AV);}else{BO+=AX.charAt(AV);}AV++;}AV++;break;case"#":case"0":var Ac=AX.charAt(AV);BP=true;var Ag=1;AV++;while(AV<Ae&&AX.charAt(AV)===Ac){Ag++;AV++;}if(AV+1<Ae&&AX.charAt(AV)==="-"&&AX.charAt(AV+1)===Ac){Ad=true;BN.push(Ag);AV++;while(true){Ag=0;while(AV<Ae&&AX.charAt(AV)===Ac){Ag++;AV++;}BN.push(Ag);if(AV>=Ae||AX.charAt(AV)!=="-"){break;}AV++;}}while(AV<Ae){if(AX.charAt(AV)===","){if(AV+1<Ae&&AX.charAt(AV+1)===Ac){As=true;}else{break;}}else{if(AX.charAt(AV)!==Ac){break;}}AV++;}break;case".":BP=true;AV++;Aa=0;while(AV<Ae&&AX.charAt(AV)==="0"){Aa++;AV++;}if(Aa===0){while(AV<Ae&&AX.charAt(AV)==="#"){Aa++;AV++;}}break;case"E":BK=6;while(AV<Ae&&AX.charAt(AV)!=="0"){if(AX.charAt(AV)==="+"&&AV<Ae&&AX.charAt(AV+1)==="0"){AR=true;}else{A6+=AX.charAt(AV);}AV++;}AW=0;while(AV<Ae&&AX.charAt(AV)==="0"){AW++;AV++;}break;case"%":BK=4;AV++;break;case"(":AV++;BO+="(";break;case")":AV++;AS+=")";break;case"-":AV++;if(AO<0){BO+=A5;}break;case"?":AV++;break;case"/":if(AV>Aq&&AX.charAt(AV-1)==="?"&&AV+1<Ae&&AX.charAt(AV+1)==="?"){BK=5;A8=false;Am=AV-1;while(Am>Aq&&AX.charAt(Am)==="?"){Am--;}while(Am>Aq&&AX.charAt(Am)===" "){Am--;}if(Am>=Aq&&(AX.charAt(Am)==="#"||AX.charAt(Am)==="0")){A8=true;}AY=0;AV++;while(AV<Ae&&AX.charAt(AV)==="?"){AY++;AV++;}}else{AV++;}break;case",":if(AV>Aq&&(AX.charAt(AV-1)==="0"||AX.charAt(AV-1)==="#")){BC=true;AV++;}Am=AV+1;while(Am<Ae){if(AX.charAt(Am)===","){Am++;continue;}else{break;}}if(Am===Ae||AX.charAt(Am)==="."){BJ=true;}if(BJ||(!BJ&&AV+1<Ae&&AX.charAt(AV+1)===",")){while(AV<Ae&&AX.charAt(AV)===","){AO/=1000;AV++;}AV--;}AV++;break;case";":Ar=true;break;case"$":if(BP){AS+=BA;}else{BO+=BA;}AV++;break;case"_":if(BP){AS+=" ";}else{BO+=" ";}AV++;AV++;break;default:if(BP){AS+=AX.charAt(AV);}else{BO+=AX.charAt(AV);}AV++;}if(Ar){break;}}if(AO<0){AO=-AO;if(BO.length===0){BO=A5;}}var Az="";if(Ad){var Au=0;for(BH=0;BH<BN.length;BH++){Au+=BN[BH];}Az=Ak=this.fillZeroToWidth(Au,AO.toFixed());for(BH=0;BH<BN.length-1;BH++){Au-=BN[BH];var At=Az.length-Au;Az=Az.slice(0,At)+"-"+Az.slice(At);}}else{switch(BK){case 0:if(BC){AO/=1000;}var A3=AO;if(A3<0){A3=-A3;}var AK=0;while(A3>=10){A3/=10;AK++;}if(AK>=15){Az=Ak=this.fillZeroToWidth((AO<0?-AO:AO),10);var An=Az.indexOf(".");if(An!==-1){Az=Az.slice(0,An)+Az.slice(An+1);}Az=Az.substr(0,16);if(Az.charAt(15)>="5"){var AU=14;while(AU>=0&&Az.charAt(AU)==="9"){Az=Az.slice(0,AU)+"0"+Az.slice(AU+1);AU--;}var AP=Az.charAt(AU);AP++;if(AU>=0){Az=Az.slice(0,AU)+AP+Az.slice(AU+1);}else{Az="1"+Az;}}Az=Az.substr(0,15);var BG;for(BG=AK-14;BG>0;BG--){Az+="0";}if(AO<0){Az=A5+Az;}}else{Ak+=(AO+Math.pow(0.1,Aa+6)).toFixed(Aa);Az=Ak;Az=this.ReplaceDecimalPoint(Az,Ax);if(AO<0){Az=this.ReplaceMinusSign(Az,A5);}}if(As){Az=this.InsertThousandSeparator(Az,A1,A7);}if(BC){Az+=Ah;}break;case 5:if(BC){AO/=1000;}var Aj=10;for(BH=1;BH<AY;BH++){Aj*=10;}var AM={numerator:0,denominator:1};var AT={numerator:1,denominator:1};var AQ={numerator:1,denominator:2};var Ay={numerator:0,denominator:1};var Af=AO>=0;var A4=Math.abs(AO);var A2=parseInt(A4,10);A4-=A2;while(AQ.denominator<Aj){if(Math.abs(AH.call(AQ)-A4)<1e-15){Ay=AQ;break;}if(AH.call(AQ)>A4){AT=AQ;}else{AM=AQ;}AQ.denominator=AM.denominator+AT.denominator;AQ.numerator=AM.numerator+AT.numerator;}if(AQ.denominator>=Aj){if(A4-AH.call(AM)<AH.call(AT)-A4){Ay=AM;}else{Ay=AT;}}if(A2>0){Ay.numerator+=A2*Ay.denominator;}if(Ay.denominator===0){A8=false;}var BE=false;var A0=false;var BM=Ay.numerator;if(A8){A2=Math.floor(Ay.numerator/Ay.denominator);BM=Ay.numerator%Ay.denominator;A0=A0||(BM!==0);if(A2>0){BE=true;Ak+=A2;if(A0){Ak+=" ";}}}if(!A0&&!BE&&BM===0){Ak+="0";}else{if(!A0&&BE&&BM===0){AJ++;}else{Ak+=BM;Ak+="/";Ak+=Ay.denominator;}}Az=Ak;if(!Af){Az=A5+Az;}if(As){Az=this.InsertThousandSeparator(Az,A1,A7);}if(BC){Az+=Ah;}break;case 4:AO*=100;Ak+=(AO+Math.pow(0.1,Aa+6)).toFixed(Aa);Az=Ak;Az=this.ReplaceDecimalPoint(Az,Ax);if(AO<0){Az=this.ReplaceMinusSign(Az,A5);}if(As){Az=this.InsertThousandSeparator(Az,A1,A7);}Az+=BB;break;case 6:var Aw=AO;var BL=0;if(Aw>1){while(Aw>=10){Aw/=10;BL++;}}else{if(Aw!==0){while(Aw<1){Aw*=10;BL--;}}}Ak+=(Aw+Math.pow(0.1,Aa+6)).toFixed(Aa);Ak+=A6;if(AR&&BL>=0){Ak<<"+";}if(BL<0){Ak<<"-";BL=-BL;}Ak+=this.fillZeroToWidth(BL,AW);Az=Ak;Az=this.ReplaceDecimalPoint(Az,Ax);if(AO<0){Az=this.ReplaceMinusSign(Az,A5);}break;}}var AN=BO+Az+AS;var Ab=false;if(Al.length!==0&&Ab){AN='<SPAN STYLE="COLOR: '+Al+'" >'+AN+"</SPAN>";}return AN;}});}());(function(){mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSObjectType","EnumDSSAxisName");mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.VisUtility");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","EnumVisualizationTemplates","VisualizationTransition","HeatMapVisualizationHelper","NetworkVisualizationHelper","ImageLayoutHelper","MapHelper");var b=mstrmojo,N=b.hash,J=b.array,a=b.vi.viz,B=a.KnownVisualizations,R=b.chart.model.enums,P=R.EnumDSSObjectType,G=R.EnumDSSAxisName,K="Grid",L=b.VisUtility,Y=[0.1,0.3,0.5,0.7,0.9],I=["#CC2525","#E34B4B","#E97D7D","#79D479","#57BA57","#2CA02C"];function C(d){var g=N.copy(d.data.gsi),e=g.tma===1?"rows":"cols",c=g[e],f=g.mx;g[e]=c.filter(function(h){return h.t!==-1&&h.did!=="-1";});if(f){f.forEach(function(h){h.t=4;});}return g;}function A(c){return c.did==="-1"||c.t===4;}function X(f,e,h,c,g){var d=e.getAddDropZonesAction();if(e.colorBy.length>0){var j=e.colorBy[0];if(A(j)){this.addThresholds(f,j,g,I,Y);}}d.actions=c.concat(d.actions).concat(g);if(d.actions.length){h.push(d);}return e.getXml();}function Z(g,d,k){var f,c,h=k.rows,e=k.cols;for(f=0,c=h.length;f<c;f++){var j=h[f];if(A(j)){d.push({act:"pivot",axis:G.DssAxisColumns,unitPos:e.length});}else{if(j.t!==P.DssTypeMetric&&!A(j)){g.groupingObjects.push(j);}}}}function M(g,h){var f,c,e=h.cols;for(f=0,c=e.length;f<c;f++){var d=e[f];if(d.t!==P.DssTypeMetric&&!A(d)){g.groupingObjects.push(d);}}}function V(f,e,c){var d=[],j=new a.HeatMapVisualizationHelper({node:e}),g,m=C(e);Z(j,d,m);M(j,m);var k=m.mx,n=m.rows,l=[];var h=new mstrmojo.threshold.ThresholdModel({});h.set("data",N.clone(e.data));h.objectType=e.defn.t;if(!N.isEmpty(m.thresholds)){l=J.filter(k,function(o){if(Object.keys(m.thresholds).indexOf(o.did)>-1){h.metricId=o.did;return !h.isAdvanced(o.did);}});}if(l.length===0){if(n.length>0){j.colorBy.push(n[n.length-1]);}if(k.length>0){j.sizeByMetric=k[0];}}else{j.colorBy.push(l[0]);j.sizeByMetric=k.length===1?k[0]:(k[0].did===l[0].did?k[1]:k[0]);}for(g=1;g<k.length;g++){if((j.sizeByMetric&&k[g].did!==j.sizeByMetric.did)&&(j.colorBy[0]&&k[g].did!==j.colorBy[0].did)){j.tooltipMetrics.push(k[g]);}}return X.call(this,e,j,f,d,c);}function U(h,g){var e,d,f=h.mx,c;if(f.length>0){for(e=0,d=f.length;e<d;e++){c=f[e];if(g.colorBy.length===0){g.colorBy.push(c);}else{if(!g.sizeByMetric){if(c.t===P.DssTypeMetric){g.sizeByMetric=c;}}else{if((c.did!==g.sizeByMetric.did)&&(c.did!==g.colorBy[0].did)&&c.t===P.DssTypeMetric){g.tooltipMetrics.push(c);}}}}}}function E(c,f,d,e){J.forEach(c,function(g){J.forEach(f[g],function(h){if(!A(h)){d.groupingObjects.push(h);}else{if(!d.sizeByMetric&&!e){d.sizeByMetric=h;}else{d.tooltipMetrics.push(h);}}});});}function F(c){var d=c.groupingObjects.length;if(c.colorBy.length===0&&d>0){c.colorBy.push(c.groupingObjects[d-1]);}}function O(j,g,h){var d=[],f=new a.HeatMapVisualizationHelper({node:g}),c=new a.NetworkVisualizationHelper({node:g});c.setData(g.data.dz);var k=f.groupingObjects;if(c.fromItemAttribute){k.push(c.fromItemAttribute);}if(c.toItemAttribute){k.push(c.toItemAttribute);}var e=c.edgeColorMetric;if(e){f.colorBy.push(e);}else{F(f);}if(c.edgeSizeMetric){f.sizeByMetric=c.edgeSizeMetric;}else{if(c.nodeSizeMetric){f.sizeByMetric=c.nodeSizeMetric;}}return X.call(this,g,f,j,d,h);}function W(j,g,c){var f=[],k=new a.HeatMapVisualizationHelper({node:g}),e=new a.GraphMatrixHelper({node:g}),l=C(g);l.mx=this.filterGMTrainingMetric(g.data.dz,l.mx);e.setData(g.data.dz);var h=["columnObjects","rowObjects","yAxisObjects","xAxisObjects","breakByObjects","sliceObjects"];E(h,e,k,true);k.colorBy=e.colorByObjects;F(k);k.sizeByMetric=e.angleObjects[0];if(!k.sizeByMetric){k.sizeByMetric=e.sizeByObjects[0];}else{if(e.sizeByObjects[0]){k.tooltipMetrics.push(e.sizeByObjects[0]);}}var d=[];J.forEach(k.tooltipMetrics,function(m){d.push(m.did);});J.forEach(e.tooltipMetrics,function(m){if(A(m)){if(!k.sizeByMetric){k.sizeByMetric=m;}else{if(d.indexOf(m.did)===-1){k.tooltipMetrics.push(m);}}}});return X.call(this,g,k,j,f,c);}function Q(j,h,c,l){var f=[],k=new a.HeatMapVisualizationHelper({node:h}),e=new a.GraphMatrixHelper({node:h}),m=C(h);m.mx=this.filterGMTrainingMetric(h.data.dz,m.mx);e.setData(h.data.dz);var g=["columnObjects","rowObjects","yAxisObjects","xAxisObjects","breakByObjects"];E(g,e,k,false);k.colorBy=e.colorByObjects;F(k);if(!k.sizeByMetric){k.sizeByMetric=e.sizeByObjects[0];}else{if(e.sizeByObjects[0]){k.tooltipMetrics.push(e.sizeByObjects[0]);}}if(!l){var d=[];J.forEach(k.tooltipMetrics,function(n){d.push(n.did);});J.forEach(e.tooltipMetrics,function(n){if(A(n)){if(!k.sizeByMetric){k.sizeByMetric=n;}else{if(d.indexOf(n.did)===-1){k.tooltipMetrics.push(n);}}}});}return X.call(this,h,k,j,f,c);}function H(j,f,g){var c=[],d=new a.HeatMapVisualizationHelper({node:f}),e=new a.ImageLayoutHelper({node:f}),h=C(f);e.setData(f.data.dz);if(e.geoAttribute){d.groupingObjects.push(e.geoAttribute);}if(e.colorByMetric){d.colorBy.push(e.colorByMetric);}if(e.sizeByMetric){d.sizeByMetric=e.sizeByMetric;}U.call(this,h,d);return X.call(this,f,d,j,c,g);}function D(k,f,e){var g,j,m=a.MapHelper,n=new a.HeatMapVisualizationHelper({node:f.node}),h=[],d=f.getTopLayerHost();g=new m({data:f.node.data});g.setWidget(d);var c=g.getSizeByUnit();n.sizeByMetric=c;var p=g.getAngleUnit();if(p){if(c){n.tooltipMetrics.push(p);}else{n.sizeByMetric=p;}}var q=g.getColorByUnit();if(q){if(A(q)){n.colorBy.push(q);}else{n.groupingObjects.push(q);}}j=g.getGeoUnit();if(j){n.groupingObjects.push(j);}var l=g.getSliceByUnits();if(l){n.groupingObjects=n.groupingObjects.concat(l);}var o=g.getTooltipUnits();J.forEach(o,function(r){if(A(r)){if(!n.sizeByMetric&&n.colorBy.length===0){n.sizeByMetric=r;}else{n.tooltipMetrics.push(r);}}else{n.groupingObjects.push(r);}});F(n);return X.call(this,f.node,n,k,h,e);}mstrmojo.vi.viz.HeatMapVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.HeatMapVisualizationTransition",transitionDropZones:function S(k,p){var n="";var f=this.vis,m=f.node.data,q=m.visName?m.visName:K,g=B.getDefinition(q).id,e=[],l=L.getPropertyByPath(f,"node.data.gsi.thresholds");if(g===B.GOOGLEMAP||g===B.ESRIMAP||g===B.MAPBOX){var c=f.getTopLayerHost();l=L.getPropertyByPath(c,"node.data.gsi.thresholds");}this.clearImageThreshold(l,e);switch(g){case B.GRAPHMATRIX:case B.NEWGRAPHMATRIX:var h=f.getChartInfo(),j=h&&(h.isPie||h.isRing),o=h&&h.isHistogram,d=h&&h.isBoxPlot;if(j){n=W.call(this,k,f.node,e);}else{if(o||d){n=Q.call(this,k,f.node,e,true);}else{n=Q.call(this,k,f.node,e,false);}}break;case B.GOOGLEMAP:case B.ESRIMAP:case B.MAPBOX:n=D.call(this,k,f,e);break;case B.IMAGELAYOUT:n=H.call(this,k,f.node,e);break;case B.NETWORK:n=O.call(this,k,f.node,e);break;case B.HEATMAP:break;default:n=V.call(this,k,f.node,e);break;}return{wp:n,handled:false};}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.VisUtility","mstrmojo.vi.viz.EnumVizStyles");mstrmojo.requiresClsP("mstrmojo.vi.viz","VisualizationTransition","EnumDSSDropZones","NetworkVisualizationHelper");var V=mstrmojo,I=V.array,U=V.vi.viz,L=V.VisUtility,B=U.KnownVisualizations,P=V.chart.model.enums,N=P.EnumDSSObjectType,C=N.DssTypeMetric,A=mstrmojo.vi.viz.EnumVizStyles,F=["#CC2525","#E34B4B","#E97D7D","#79D479","#57BA57","#2CA02C"],K=[0.1,0.3,0.5,0.7,0.9];function G(Y,a,X){var Z=[];I.forEach(Y,function(b){I.forEach(a,function(c){if((b.id===c.did)||(b.did===c.did)){if((X&&(c.t===C))||(!X&&(c.t!==C))){Z.push(c);return false;}}});});return Z;}function E(Y,X){var Z=[];I.forEach(Y,function(a){var b=false;I.forEach(X,function(c){if(a.id===c.id){b=true;return false;}});if(!b){Z.push(a);}});return Z;}function H(X,Y){if(X&&X.ColorBy&&X.ColorBy.TemplateMetric){return G(X.ColorBy.TemplateMetric,Y,true);}return[];}function M(X,Y){if(X&&X.SizeBy&&X.SizeBy.TemplateMetric){return G(X.SizeBy.TemplateMetric,Y,true);}return[];}function S(X){return(X&&X.TemplateUnit)||[];}function O(X){return(X&&X.TemplateMetric)||[];}function W(X,a,c){var b=[],Y=0,Z;I.forEach(X,function(d){if(Y===c){Z=b.length;}Y++;if(d instanceof Array){b=b.concat(d);}else{if(a==="attribute"){b=b.concat(S(d));}else{b=b.concat(O(d));}}});if(a==="attribute"){return b;}return{metrics:b,idx:Z};}function J(a,d){var c=a.node.data,j=c.visName;if(j===A.ESRI_MAP||j===A.GOOGLE_MAP||j===A.MAPBOX){var Y=a.getTopLayerHost();c=Y.node.data;}var e=c.gsi,h=c.dz,g,X=(e.rows||[]).concat(e.cols||[]);switch(j){case A.GRAPH_MATRIX:var f=S(h.ColorBy),b=E(S(h.SliceBy),f),Z=E(S(h.BreakBy),f);g=W([b,h.Rows,h.YAxis,h.Columns,h.XAxis,f,Z],"attribute");break;case A.HEAT_MAP:g=W([h.Grp],"attribute");break;case A.ESRI_MAP:case A.GOOGLE_MAP:case A.MAPBOX:g=W([h.Geo,h.Lat,h.Long,h.AdditionalMetrics],"attribute");break;}if(g&&g.length>0){g=G.call(this,g,X,false);}else{g=X;}I.forEach(g,function(k){if(k.t!==N.DssTypeMetric&&k.t!==N.DssTypeDimension&&k.did!=="-1"){d.fromItemAttribute=k;return false;}});I.forEach(g,function(k){if(k.t!==N.DssTypeMetric&&k.t!==N.DssTypeDimension&&k.did!=="-1"&&k.did!==d.fromItemAttribute.did){d.toItemAttribute=k;return false;}});}function D(Z,f,c,Y){var d=Z.node.data,m=d.visName;if(m===A.ESRI_MAP||m===A.GOOGLE_MAP||m===A.MAPBOX){var X=Z.getTopLayerHost();d=X.node.data;}var l=d.dz,k=d.gsi.mx||[],j,e,b;k.forEach(function(n){n.t=4;});var h=H.call(this,l,k);if(h.length>0){f.edgeColorMetric=h[0];h=h.slice(1);}var a=M.call(this,l,k);switch(m){case A.GRAPH_MATRIX:case A.NEW_GRAPH_MATRIX:e=W([l.AngleBy,l.Rows,l.YAxis,l.Columns,l.XAxis,h,a,l.AdditionalMetrics],"metric",6);break;case A.HEAT_MAP:if(a.length>0){f.edgeSizeMetric=a[0];}e=W([l.AdditionalMetrics],"metric");var g=G.call(this,e.metrics,k,true);if(!f.edgeColorMetric){if(g.length>0){f.edgeColorMetric=g[0];if(g.length>1){f.nodeSizeMetric=g[1];}}}else{if(g.length>0){f.nodeSizeMetric=g[0];}}return ;case A.ESRI_MAP:case A.GOOGLE_MAP:case A.MAPBOX:e=W([h,a,l.AdditionalMetrics],"metric",1);break;default:j=k;break;}if(e){b=e.idx;j=e.metrics;}if(j&&j.length>0){j=G.call(this,j,k,true);}else{if(!l||!l.ColorBy){j=k;}}if(!f.edgeColorMetric&&j&&j[0]){f.edgeColorMetric=j[0];j=j.slice(1);b--;}if(a.length>0){f.nodeSizeMetric=a[0];if(b>=0){j=j.slice(0,b).concat(j.slice(b+1));}}if(!j&&d.visName&&B.getDefinition(d.visName).id===B.UNKNOWN){f.edgeColorMetric=null;f.nodeSizeMetric=null;f.edgeSizeMetric=null;j=k;}j.forEach(function(n){if(!f.nodeSizeMetric){f.nodeSizeMetric=n;}else{if(!f.edgeSizeMetric){f.edgeSizeMetric=n;}}});if(f.edgeColorMetric){this.addThresholds(Z.node,f.edgeColorMetric,Y,F,K);}}function R(b,c,Y,a){var X=new U.NetworkVisualizationHelper({node:b.node});J.call(this,b,X);D.call(this,b,X,Y,a);var Z=X.getAddDropZonesAction();Z.actions=Y.concat(Z.actions).concat(a);if(Z.actions.length){c.push(Z);}return{wp:X.getXml(),handled:false};}mstrmojo.vi.viz.NetworkVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.NetworkVisualizationTransition",transitionDropZones:function Q(c,f){var Z=this.vis,b=Z.node,d=b.data,g=d.visName||"Grid",a=[],Y=[],e=L.getPropertyByPath(Z,"node.data.gsi.thresholds");if(g===B.GOOGLEMAP||g===B.ESRIMAP||g===B.MAPBOX){var X=Z.getTopLayerHost();e=L.getPropertyByPath(X,"data.gsi.thresholds");}this.clearImageThreshold(e,Y);if(B.getDefinition(g).id!==B.NETWORK){return R.call(this,Z,c,a,Y);}return{wp:"",handled:false};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo._HasSuggestion","mstrmojo.Enum_Keys","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.hash","mstrmojo.dom");var K=mstrmojo.dom,E=mstrmojo.css,R="srchBoxState",C=mstrmojo.Enum_Keys,S=mstrmojo.VisUtility,M=200,g,H=24,Q={fontFamily:"Arial",fontSize:"11px"};var e={2147762262:mstrmojo.desc(16256,"Please enter a numeric value"),2147762227:mstrmojo.desc(16257,"Unable to perform search with the operators provided")};var P={DEFAULT:1,ADDING:2,EMPTY:3,FULL:4};var l="mstrmojo-SimpleObjectInputBox-del";function F(){var q=this.inputBox,r=q&&q.value;if(r!==""&&(r!==this._lastPattern||!this.suggestionShown)){this.showSuggestion(r);this._isSearching=true;if(this.hitEnterToTest){this.inputBox.blur();}}this._lastPattern=r;delete this._timerHandle;}function D(){var q=this._timerHandle;if(q){window.clearTimeout(q);delete this._timerHandle;}}function A(){if(this.richTooltip){if(this.tooltip){this.tooltip.set("allowOtherTooltips",false);}this.hideTooltip();}}function b(q){var s=this._inputPos,r=!mstrApp.isAppStatePresentation||mstrApp.isAppStatePresentation(),t=this,u;if(this.richTooltip){u=this.richTooltip;if(!this.hasOpenTooltip&&!this.suggestionShown){u.top=(s.h+s.y)+"px";u.left=s.x+"px";if(!this.hitEnterToTest&&!r){window.setTimeout(function(){var x=t.tooltip,w=x&&x.contentNode,z,v;z=w?w.childNodes:null;if(z&&z.length>1){v=z[1];z=v.childNodes;if(z&&z.length>1){v=z[1];}else{v=null;}}if(t.hasOpenTooltip&&v&&!E.hasClass(w,"lng")){if(u.onclick){t.tooltip.onclick=u.onclick;K.attachMarkupEvent(t.tooltip.id,v,"click");}E.addClass(w,"lng");}},3000);}this.showTooltip(q.e,q.hWin);this.set("allowOtherTooltips",!this.hitEnterToTest);}}}function G(){if(window.mstrLocalStorage===undefined){return{};}var q=(mstrLocalStorage.getLocalStorage()||{})[R];return(q&&JSON.parse(q))||{};}function Y(q){if(window.mstrLocalStorage!==undefined){mstrLocalStorage.setItem(R,JSON.stringify(q));}}mstrmojo.SimpleObjectInputBox=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo._HasSuggestion,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.SimpleObjectInputBox",markupString:'<div id="{@id}" class="mstrmojo-ListBase mstrmojo-SimpleObjectInputBox {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-SimpleObjectInputBox-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}<input type="text" mstrAttach:keydown,keyup,blur,focus style="display: none;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" /><div class="mstrmojo-SimpleObjectInputBox-empty"><div>{@emptyText}</div></div></div></div>',markupSlots:{itemsContainerNode:function(){return this.domNode.firstChild;},emptyTextNode:function(){return this.domNode.firstChild.lastChild;},inputBox:function(){var q=this.domNode.firstChild.children;return q[q.length-2];},scrollboxNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onmaxItemWidthChange:function d(){var q=this.maxItemWidth;if(!isNaN(q)&&q>0){this.emptyTextNode.style.maxWidth=q+"px";}}},itemField:"n",emptyText:"",state:0,maxItemWidth:"none",useKeyDelay:false,hitEnterToTest:false,maxObjectCount:null,useRichTooltip:true,init:function m(q){this._super(q);if(mstrApp.isWorkstation){Q.fontFamily="Helvetica";}},showTooltip:function p(r,u){var t=r.target||K.eventTarget(r.hWin,r.e),s=this.getItemFromTarget(t);if(s&&s.n){var v=this.getItemNodeFromTarget(t).firstChild,q=K.position(v);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPCENTER,cssClass:"vi-regular vi-tooltip-A A-center",refNode:v,content:mstrmojo.string.encodeHtmlString(s.n),top:q.h+11,left:q.w/2};this._super(r,u);}},getItemMarkup:function(q){if(!g){var r=this.itemField;g=this._super(q).replace(">{@en@n}<",'"><div class="elem">{@en@'+r+'}<div class="'+l+'"></div></div><');}return g;},getItemProps:function c(u,q){var s=this._super(u,q),v=this.itemField;var t=this.maxItemWidth;if(!isNaN(t)&&t>0){t=(t-H);}if(!mstrmojo.string.isEmpty(u[v])){var r=u[v];s[v]=r;if(t<S.measureTextWidth(r,Q)){s.title=r;}}s.addStyle("max-width:"+t+"px");return s;},getSuggestionPos:function U(){var q=this._inputPos;return{target:this.inputBox,left:q.x+"px",top:q.y+q.h+"px",zIndex:100};},updateSuggestion:function Z(q){var r=G();if(!r.srch){if(this._super){this._super(q);}}this.inputBox.focus();A.call(this);},failMessage:function B(r){var s=e[r.errCode]||r.msg,q=s?[{n:s,t:-101,cls:"nomatch"}]:[];this.updateSuggestion(q);},getSearchPattern:function N(){return this.inputBox?this.inputBox.value:"";},showInfoTooltip:function X(t){var u=G(),q=this.parent.parent,v=K.position(q.domNode),r=this.richTooltip,s=this;if(!u.hasShownInfo&&!mstrmojo.SimpleObjectInputBox.HAS_SHOWN_INFO){mstrmojo.SimpleObjectInputBox.HAS_SHOWN_INFO=true;u.hasShownInfo=true;this.set("richTooltip",{posType:mstrmojo.tooltip.POS_BOTTOMCENTER,cssClass:"vi-regular vi-tooltip-V vi-tooltip-leftcenter",contentNodeCssClass:"srch info",top:v.y+"px",left:v.x+v.w+8+"px",content:mstrmojo.desc(15909,'You can re-enable "Instant Search" from the menu.'),onClose:function(){s.set("richTooltip",r);}});this.showTooltip(window.event,window);if(this.tooltip){this.tooltip.set("allowOtherTooltips",false);}else{this.set("allowOtherTooltips",false);}}u.srch=t;Y(u);},onIncrementalFetch:function J(){this.inputBox.blur();},onSuggestionItemSelect:function j(q){D.call(this);this.set("items",this.items.concat(q));this._super();var r=this.id;window.setTimeout(function(){var s=mstrmojo.all[r];if(parseInt(s.state,10)!==P.FULL){s.set("state",P.ADDING);}},0);},onstateChange:function W(r){var s=r.value;this.emptyTextNode.style.display=(s===P.ADDING)?"none":"block";var q=this.inputBox,t=q.style;if(s===P.ADDING){t.display="";this.updateScrollbars();q.focus();this._inputPos=K.position(q,true);}else{D.call(this);t.display="none";q.value="";this._lastPattern="";this.updateScrollbars();if(this.parent.getFormats&&!this.parent.getFormats().height&&this.parent.parent.performCanGrowCanShrink){this.parent.parent.performCanGrowCanShrink(this.parent.parent.children);}}},postBuildRendering:function O(){var q,r=G();M=(mstrApp.getSearchAutoCompleteDelay&&mstrApp.getSearchAutoCompleteDelay())||M;this.state=0;this.setDefaultState();if(r.srch){this.inputBox.value=r.srch;this.set("state",P.ADDING);delete r.srch;Y(r);}q=this._super();return q;},preitemsChange:function L(){this.setDefaultState();},onclick:function f(r){var u=K.eventTarget(r.hWin,r.e);if(u&&u.className===l){var t=K.findAncestorByAttr(u,"idx",true,this.domNode),q=t&&parseInt(t.value,10);this.hideTooltip();if(q!==null&&!isNaN(q)){var s=this.items.concat();s.splice(q,1);this.set("items",s);}return ;}if(parseInt(this.state,10)!==P.FULL){this.set("state",P.ADDING);}},onblur:function V(){if(this._isSearching||this.tooltip){return ;}D.call(this);A.call(this);if(!this.suggestionShown){this.setDefaultState();}},onfocus:function k(){this._isSearching=false;if(this.suggestionShown){A.call(this);}},prekeydown:function I(r){var u=r.e;switch(parseInt(u.keyCode||u.charCode,10)){case C.DOWN_ARROW:this.nextHighlight();break;case C.UP_ARROW:this.preHighlight();break;case C.TAB:case C.ENTER:K.preventDefault(r.hWin,u);if(this.suggestionShown){var t=this.getSelected();if(t){this.handleSuggestionItemSelect(t);}else{this.hideSuggestion();}}else{if(this.hitEnterToTest){A.call(this);F.call(this);}}break;case C.ESCAPE:D.call(this);if(this.suggestionShown){this.hideSuggestion();}else{this.setDefaultState();}break;case C.BACKSPACE:if(!this.getSearchPattern()&&!mstrApp.hasRequests()){K.preventDefault(r.hWin,u);var s=this.items&&this.items.concat();if(s&&s.length){s.splice(s.length-1,1);mstrApp.ignoreBackSpace=true;this.set("items",s);var w=this.id;window.setTimeout(function(){mstrmojo.all[w].set("state",P.ADDING);mstrApp.ignoreBackSpace=false;},0);}}break;}var q=this.richTooltip,v=(q&&q.contentNodeCssClass)||"";if(v.indexOf("srch info")>-1){A.call(this);}},prekeyup:function o(q){var t=q.e,r=parseInt(t.keyCode||t.charCode,10),s=this.getSearchPattern();if(!s||s!==this._lastPattern){K.preventDefault(q.hWin,q.e);this.hideSuggestion();}if(this.inputBox.value.length&&r!==C.ENTER&&r!==C.TAB&&!this.suggestionShown){b.call(this,q);}else{A.call(this);}if(this.hitEnterToTest){return ;}if(this.useKeyDelay){var u=this.id;if(!this._timerHandle){this._timerHandle=window.setTimeout(function(){F.call(mstrmojo.all[u]);},M);}}else{F.call(this);}},widgetResized:function n(){if(this.hasRendered){var t=parseInt(this.width,10),v=this.items.length,w=this.itemsContainerNode.childNodes;if(v<=(w&&w.length)){var u=t-H;for(var s=0;s<v;s++){var q=w[s],r=q.textContent;q.style.maxWidth=u+"px";if(r&&u<S.measureTextWidth(r,Q)){q.title=r;}else{q.title="";}}}if(this.emptyTextNode){this.emptyTextNode.style.maxWidth=t+"px";}this.updateScrollbars();}},setupScrollNodes:function h(){this.scrollNode=this.scrollboxNode;},setDefaultState:function a(){var s=this.maxObjectCount,q=(this.items&&this.items.length)||0,r=(s!==null&&s!==undefined&&q>=s);this.set("state",!q?P.EMPTY:(r?P.FULL:P.DEFAULT));}});mstrmojo.SimpleObjectInputBox.HAS_SHOWN_INFO=false;}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.color","mstrmojo.string","mstrmojo.vi.enums.EnumFeatures","mstrmojo.VisUtility");var u=mstrmojo,d=u.dom,C=u.css,v=u.array,Q=u.color,AO=u.string,AP=mstrmojo.VisUtility,AJ=90,e=-90,AB=180,J=-180,AD=true,R=u.vi.enums.EnumFeatures,x="http://www.w3.org/2000/svg";var I;function W(){var AW=navigator.userAgent.toLowerCase();return d.isIE||(AW&&AW.match(/rv:([\d.]+)\) like gecko/));}mstrmojo.gmaps.MapUtils=mstrmojo.provide("mstrmojo.gmaps.MapUtils",{_mixinName:"mstrmojo.gmaps.MapUtils",checkVal:function P(AW){return this.checkDefined(AW)&&!(isNaN(parseInt(AW)));},checkVals:function A(AX){var AW=true;v.forEach(AX,function(AY){if(!this.checkVal(AY)){AW=false;return false;}});return AW;},checkHasFunction:function r(AX,AW){return AX&&AX[AW]&&AX[AW] instanceof Function;},checkDefined:function B(AW){return(AW!==undefined)&&(AW!==null);},parseBoolean:function M(AW){return AW===true||AW==="true";},isAsp:function X(){return(window.location.pathname.indexOf("/asp/")>0);},trimString:function AM(AW){return mstrmojo.string.trim(AW);},log:function N(AW){if(console&&console.log){console.log(AW);}},replaceSpace:function m(AY,AX){if(!this.checkDefined(AY)){return ;}var AW=(this.checkDefined(AX))?AX:"_";return AY.replace(/ /g,AW);},getProtocol:function O(){return this.isSingleTier()?"http:":window.location.protocol;},createMouseEvt:function AV(AX){var AW;if(W()||d.isFF){AW=document.createEvent("MouseEvents");AW.initEvent(AX,true,false);}else{if(window.MouseEvent){AW=new MouseEvent(AX);}}return AW;},isRMClick:function E(AW){var AX=false;if(AW){if(AW.which){AX=AW.which===3;}else{if(AW.button){AX=AW.button===2;}}}return AX;},createNormalNode:function AF(AW){if(!!AW){return document.createElement(AW);}},createSvgNode:function AG(AW){if(!!AW){return document.createElementNS(x,AW);}},appendNode:function AC(AW,AX){if(this.checkHasFunction(AW,"appendChild")&&AX){AW.appendChild(AX);}},appendSvgNode:function f(AW){if(!AW){return ;}var AX=this.createSvgNode("svg");this.setCssStyles(AX,{position:"absolute",width:AW.style.width,height:AW.style.height,top:"0px",left:"0px"});AW.appendChild(AX);return AX;},appendGNode:function K(AX){if(!this.checkHasFunction(AX,"appendChild")){return ;}var AW=this.createSvgNode("g");AX.appendChild(AW);return AW;},setNodeAttributes:function k(AX,AW){if(!this.checkHasFunction(AX,"setAttribute")||!AW){return ;}for(var AY in AW){if(this.checkDefined(AW[AY])){AX.setAttribute(AY,AW[AY]);}}},setCssStyles:function F(AY,AX){var AW=AY&&AY.style,AZ;if(!AW||!AX){return ;}for(AZ in AX){if(this.checkDefined(AX[AZ])){AW[AZ]=AX[AZ];}}},setCssTransform:function l(AW,AX){if(!AX||!this.checkVal(AX.x)||!this.checkVal(AX.y)){return ;}v.forEach(v.ensureArray(AW),function(AY){this.setNodeAttributes(AY,{transform:"translate("+AX.x+" "+AX.y+")"});},this);},emptyDomElement:function a(AW){if(!this.checkHasFunction(AW,"removeChild")){return ;}while(AW.firstChild){AW.removeChild(AW.firstChild);}},insertAfter:function U(AY,AX){var AW=AX&&AX.parentNode;if(AY&&this.checkHasFunction(AW,"insertBefore")){if(AX.nextSibling){AW.insertBefore(AY,AX.nextSibling);}else{AW.appendChild(AY);}}},insertAsFirstChild:function AR(AW,AX){if(AW&&AX){if(AW.firstChild){AW.insertBefore(AX,AW.firstChild);}else{AW.appendChild(AX);}}},getEvtCoordInsideNode:function AA(AX,AW){var AY=this.getBoundingRect(AW);if(!AX||!this.checkVal(AX.clientX)||!this.checkVal(AX.clientY)||!AY||!this.checkVal(AY.left)||!this.checkVal(AY.top)){this.log("getEvtCoordInsideNode(): Invalid clientRect.");return ;}return{x:AX.clientX-AY.left,y:AX.clientY-AY.top};},getBoundingRect:function c(AW){if(this.checkHasFunction(AW,"getBoundingClientRect")){return AW.getBoundingClientRect();}},showWait:function AU(){if(this.checkHasFunction(mstrApp,"showWait")){mstrApp.showWait();}else{if(this.checkHasFunction(microstrategy,"showWait")){microstrategy.showWait(true);}}},hideWait:function j(AW){if(this.checkHasFunction(mstrApp,"hideWait")){mstrApp.hideWait(AW);}else{if(this.checkHasFunction(microstrategy,"showWait")){microstrategy.showWait(false);}}},isValidLatLng:function Z(AX,AW){if(!this.checkVal(AX)||!this.checkVal(AW)){return false;}return parseInt(AX)>=e&&parseInt(AX)<=AJ&&parseInt(AW)>=J&&parseInt(AW)<=AB;},isExpress:function q(){return !!(mstrApp&&mstrApp.isExpress);},isVI:function AS(){return mstrApp&&mstrApp.isVI;},isOIVM:function AI(){return mstrApp&&(mstrApp.isExpress||mstrApp.isVI);},isSingleTier:function AN(){return !!(mstrApp&&mstrApp.isSingleTier);},isWorkstation:function S(){return mstrApp&&mstrApp.isWorkstation;},isWSLiveMode:function Y(){return mstrApp&&mstrApp.supportFeature(R.SUPPORT_LIVEMODE)&&(typeof mstrApp.getWSLiveMode==="function")&&mstrApp.getWSLiveMode();},getEvent:function AQ(AW){if(!d.supportsTouches){return AW;}else{return d.firstChangedTouch(window,AW);}},enableZoomLevelAndPosSaving:function h(){return !this.isWorkstation()||AD;},isCanvasSupported:function o(){var AW=document.createElement("canvas");return !!(AW.getContext&&AW.getContext("2d"));},convertImageUrl:function p(AW){if(mstrApp.isDossier&&AW&&AW.indexOf("../")===0){return u.getStyleRoot()+"/../"+AW.substr(3);}return AW;},encode:function H(AY,AX){var Aa=AY;if(!this.checkDefined(AX)){AX=false;}if(AY&&AY.length>0){Aa="";for(var AZ=0,AW=AY.length;AZ<AW;AZ++){switch(AY.charAt(AZ)){case"&":if((AY.length!==(AZ+1))&&(AY.charAt(AZ+1)==="#")){Aa+="&";}else{Aa+="&amp;";}break;case"<":Aa+="&lt;";break;case">":Aa+="&gt;";break;case"'":Aa+="&#039;";break;case"\n":if(!AX){Aa+="<br />";}else{Aa+=AY.charAt(AZ);}break;case'"':Aa+="&quot;";break;case" ":if(AZ===0||(AZ<AY.length-1&&AY.charAt(AZ+1)===" ")){Aa+="&nbsp;";}else{Aa+=AY.charAt(AZ);}break;default:Aa+=AY.charAt(AZ);break;}}}return Aa;},loadCss:function s(AW,Ab){var Aa=document.styleSheets;if(Aa){var AY,AZ;for(AY=0;AY<Aa.length;AY++){AZ=Aa[AY];if(AZ.id===AW){return ;}}}var AX=document.createElement("link");AX.setAttribute("rel","stylesheet");AX.setAttribute("type","text/css");AX.setAttribute("href",Ab);AX.setAttribute("id",AW);document.getElementsByTagName("head")[0].appendChild(AX);},getGraphicLayerById:function L(AW){var AX=mstrmojo.all[AW];if(!AX){this.hideWait();}return AX;},isEmbedded:function AL(){return mstrApp&&mstrApp.isEmbedded;},_verifyProtocol:function AH(AW){if("https:"===window.location.protocol&&(-1!==AW.search(/^http\:\/\/server\.arcgisonline\.com/i)||-1!==AW.search(/^http\:\/\/services\.arcgisonline\.com/i)||-1!==AW.search(/^http\:\/\/.+\.arcgis\.com/i))){AW=AW.replace(/http:/i,"https:");}return AW;},loadExternalScript:function V(AX,Aa,AY){if(!AX){return ;}var AW=document.createElement("script");AW.type="text/javascript";AW.src=AX;if(AY){AW.onerror=AY;}if(AW.addEventListener){AW.addEventListener("load",function AZ(){AW.removeEventListener("load",AZ);AW.onerror=null;if(Aa){Aa();}},false);}else{if(AW.readyState){AW.onreadystatechange=function(){if(AW.readyState==="loaded"||AW.readyState==="complete"){AW.onreadystatechange=null;AW.onerror=null;if(Aa){Aa();}}};}}document.getElementsByTagName("head")[0].appendChild(AW);},getNoInternetMessage:function b(){var AX,AW;if(mstrApp.isSingleTier){AX="Unable to create the map. Please check you connection. You can configure an Internet proxy through your computer's #";AW='<a href="" style="color:#7CC5EC" onclick="window.FormWrapper.showProxyEditor(); return false;">'+mstrmojo.desc(7831,"Settings")+"</a>.";AX=AX.replace("#",AW);}else{AX="Unable to download the requested map. Please contact your administrator to resolve this issue.";}return AX;},getThemeClass:function g(){if(mstrApp&&mstrApp.getThemeClassName){return" "+mstrApp.getThemeClassName();}},adjustHSV:function t(Ag,AY,Aa,Af){if(!Ag||!this.checkVal(AY)||!this.checkVal(Aa)||!this.checkVal(Af)){return Ag;}var Ad,Ah,AX,AW,Ab,Ac,AZ,Ae;if(!Ag){return Ag;}if(Ag.length===7){Ad=parseInt(Ag.substring(1,3),16);Ah=parseInt(Ag.substring(3,5),16);AX=parseInt(Ag.substring(5,7),16);}else{if(Ag.length===4){Ad=parseInt(Ag.substring(1,2)+Ag.substring(1,2),16);Ah=parseInt(Ag.substring(2,3)+Ag.substring(2,3),16);AX=parseInt(Ag.substring(3,4)+Ag.substring(3,4),16);}else{return Ag;}}AW=Q.rgb2hsv(Ad,Ah,AX);AW[0]=AW[0]*AY;AW[1]=AW[1]*Aa;AW[2]=parseInt(AW[2]*Af>100?100:AW[2]*Af,10);Ab=Q.hsv2rgb(AW[0],AW[1],AW[2]);Ad=parseInt(Ab[0],10);Ah=parseInt(Ab[1],10);AX=parseInt(Ab[2],10);Ac=Ad<16?"0"+Ad.toString(16):Ad.toString(16);AZ=Ah<16?"0"+Ah.toString(16):Ah.toString(16);Ae=AX<16?"0"+AX.toString(16):AX.toString(16);Ag="#"+Ac+AZ+Ae;return Ag;},fillColorAjustForCMSelection:function D(AW){return this.adjustHSV(AW,1,0.5,1.2);},fillColorAjustForHover:function G(AW){return this.adjustHSV(AW,1,0.6,1.15);},setLayerNodeProps:function w(AZ,Aa,AY,AX,AW){this.setNodeAttributes(AZ,{id:Aa,"class":AY});this.setCssStyles(AZ,{position:"absolute",top:"0px",left:"0px"});if(this.checkVal(AX)&&this.checkVal(AW)){AX=parseInt(AX);AW=parseInt(AW);this.setCssStyles(AZ,{width:AX+"px",height:AW+"px"});}},destroyNode:function z(AW){if(!AW){return ;}try{if(AW.parentNode){AW.parentNode.removeChild(AW);}if(d.isIE&&AW.outerHTML!==undefined){AW.outerHTML="";}}catch(AX){}},destroyObj:function AT(AW){if(AW&&AW.destroy instanceof Function){AW.destroy();}},removeHTMLTagsAndProps:function n(AX,AZ,AW){try{(AX.match(/<[^>]+>/g)||[]).forEach(function(Ae){var Ah,Ac,Ab,Ad,Ai,Aa,Af,Aj,Ag=Ae.toLowerCase();Ac=Ag.match(/<\/?([a-z]+\b)/);if(Ac&&Ac.length===2){Ab=Ac[1];if(AZ.indexOf(Ab)<0){AX=AX.replace(Ae,"");return ;}if(Ag.charAt(1)==="/"){Ag=Ag.substring(2);Af="</";}else{Ag=Ag.substring(1);Af="<";}Ah=Ag.length-2;if(Ag.charAt(Ah)==="/"){Ag=Ag.substring(0,Ah);Aj="/>";}else{Ag=Ag.substring(0,Ag.length-1);Aj=">";}Ag=Ag.replace(Ab,"");Aa="";Ai="";while(Ag!=Aa){Aa=Ag;Ag=AO.trim(Ag);Ac=Ag.match(/([^=]+)=\s*('[^']*'|"[^"]*")/);if(Ac&&Ac.length===3){Ad=AO.trim(Ac[1]).split(/\s+/);if(Ad&&Ad.length>0){Ad=Ad[Ad.length-1];if(AW.indexOf(Ad)>=0){Ai+=" "+Ad+"="+Ac[2];}}Ag=Ag.substring(Ac[0].length);}}AX=AX.replace(Ae,Af+Ab+Ai+Aj);}});}catch(AY){console.log("HTML Parse Error: "+AY);}finally{return AX;}},addArrowNode:function AE(AX){if(AX){var AW=this.createNormalNode("div");C.addClass(AW,"mstrmojo-Tooltip-arrow");this.appendNode(AX,AW);}},getFontFamilyItems:function AK(AW){if(I){return I;}else{I=v.filter(AP.getFontFamilyItems(),function(AX){return v.indexOf(AW,AX.n)===-1;});return I;}},});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.VisUtility");var M=mstrmojo.css,I=mstrmojo.VisUtility,L=mstrmojo.array,N=mstrmojo.string,F="vis-tooltip",E=20,C=165,D="px";function Q(){var U=this.domNode;U.innerHTML="";var R=document.createElement("div");R.className=F+"-container";var V=document.createElement("table");V.className=F+"-table";for(var S=0;S<2;S++){V.appendChild(document.createElement("COL"));}R.appendChild(V);this.domNode.appendChild(R);return V;}function K(S){var R=[],U=false;L.forEach(S,function(V){if(!V.isSuper){R.push(V.v);}else{U=true;R.push("<sup>"+V.v+"</sup>");}});return{hasSuper:U,htmlText:R.join("")};}mstrmojo.VisTooltip=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.VisTooltip",init:function P(R){this._super(R);M.addWidgetCssClass(this,(R&&R.widgetClass)?[R.widgetClass,F]:F);},toggle:function H(R){var S=mstrApp.isAppStatePrintPreview&&mstrApp.isAppStatePrintPreview();if(this.domNode){this.domNode.style.display=R&&!S?"block":"none";}},displayInfo:function O(X,a,R,S){var V=this.domNode,c=Q.call(this),Y=false,U=0,Z=0,b=c.childNodes[0],W=c.childNodes[1];X.forEach(function(l){var t,j,v,p,d,h,r,n,w,m,u,s,o=false,k=false;var e=c.insertRow(-1),g=e.insertCell(-1),q=e.insertCell(-1);e.className=F+"-tr";g.className=F+"-name "+F+"-td";q.className=F+"-value "+F+"-td";if(l===null){M.addClass(e,"separator");Y=true;}else{if(Y){M.addClass(e,"below-separator");}t=l.n;s=!l.skipEncode;g.innerHTML=s?N.encodeHtmlString(t,true):t;v=I.getComputedFontStyle(g);if(S){p=Math.ceil(I.measureTextWidthWithSpan(g.innerHTML,v,v.bonus,null,true,true));}else{p=Math.ceil(I.measureTextWidth(g.innerHTML,v,v.bonus));}r=3;if(p>C){n=I.truncateTextToLineWithWordWrap(t,v,C,r,true);if(n.canWordWrap){g.innerHTML=s?N.encodeHtmlString(n.text,true):n.text;}else{n=I.truncateTextToLineWithWordWrap(t,v,C,1);g.innerHTML=s?N.encodeHtmlString(n,true):n;}o=true;}U=Math.min(Math.max(U,p),C);j=l.v;m=l.isTrendLineFuncToken;if(m){w=K(j);}if(!m||!w.hasSuper){if(m){j=w.htmlText;}q.innerHTML=s?N.encodeHtmlString(j,true):j;d=I.getComputedFontStyle(q);if(S){h=Math.ceil(I.measureTextWidthWithSpan(q.innerHTML,v,v.bonus,null,true,true));}else{h=Math.ceil(I.measureTextWidth(q.innerHTML,d,d.bonus,null,true));}if(h>C){n=I.truncateTextToLineWithWordWrap(j,d,C,l.noTruncate?100:r,true);if(!n.canWordWrap){n=I.truncateTextToLineWithWordWrap(j,d,C,1,true);}q.innerHTML=s?N.encodeHtmlString(n.text,true):n.text;h=n.maxLineLen;k=true;}Z=Math.min(Math.max(Z,h),C);}else{q.innerHTML=w.htmlText;d=I.getComputedFontStyle(q);h=0;L.forEach(j,function(x){x.textWidth=I.measureSuperTextWidth(x.isSuper,x.v,d,d.bonus);h+=x.textWidth;});h=Math.ceil(h);if(h>C){n=I.truncateTextToLineWithWordWrapForTokens(j,d,C,l.noTruncate?100:r,true,true);if(!n.canWordWrap){n=I.truncateTextToLineWithWordWrapForTokens(j,d,C,1,true);}q.innerHTML=K(n.text).htmlText;h=n.maxLineLen;k=true;}Z=Math.min(Math.max(Z,h),C);}var f=parseInt(M.getComputedStyle(g).paddingRight);b.style.width=(U+f+1)+"px";W.style.width=(Z+1)+"px";u=U+Z+f;c.style.width=(u+2)+"px";Y=false;if(o||k){M.addClass(e,"wrapped");}}});if(a){this.moveTo(a.x,a.y);}},moveTo:function(a,Z){var Y=mstrmojo.dom.position(document.body),W=this.domNode,b=W.offsetWidth,X=W.offsetHeight,V=Y.x+Y.w,c=Y.y+Y.h,S=a+E,R=Z+E;if(S>V-b||R>c-X){if(S<=V-b){R=c-X;}else{if(R<=c-X){S=V-b;}else{S=V-b;R=Z-E-X;}}}var U=W.style;U.left=S+D;U.top=R+D;},doLayout:function A(R){var U=this.domNode.getElementsByTagName("table")[0];if(!U){return ;}var V=M.getComputedStyle(this.domNode),S=R-parseInt(V.paddingLeft,10)-parseInt(V.paddingRight,10);S-=U.rows[0].cells[0].offsetWidth;U.getElementsByClassName(F+"-value").forEach(function(W){W.style.maxWidth=S+D;});},posTo:function B(S){var R=this.domNode.style;R.left=S.x+D;R.top=S.y+D;},renderErrMsg:function G(R){Q.call(this).insertRow(-1).insertCell(-1).innerText=R;},hide:function J(){var R=this.domNode;this.toggle(false);if(R&&R.parentNode){R.parentNode.removeChild(R);R.innerHTML="";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.Box","mstrmojo.Label","mstrmojo.ui.CheckList","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.models.datasets.DataInterface","mstrmojo.expr","mstrmojo.array","mstrmojo.VisUtility");mstrmojo.requiresDescs(2031,3945,3946,11505,11571,13629,13630,13860,14595,15952);var K=mstrmojo.vi.ui.DatasetUnitMenuUtils,F=mstrmojo.models.datasets.DataInterface,Q=mstrmojo.expr.DTP,L=mstrmojo.array,D=mstrmojo.VisUtility;function R(c){var a=350,V={fontFamily:"Arial",fontSize:"12px"},Z=D.measureTextWidth(c,V);if(Z>a){var Y,W,X=c.indexOf(" "),b=X;while(X>-1){Y=c.substring(0,X);W=D.measureTextWidth(Y,V);if(W>=a){break;}b=X;X=c.indexOf(" ",X+1);}if(X>-1){c=c.substring(0,b)+"\n"+c.substring(b);}}return c;}function E(a){var Y,V=a.selector,X=a.fn(),c=X.keys,W=X.items,b=new mstrmojo.ui.CheckList({cssClass:"units",items:W.map(function(d){d.css=K.getUnitCssClass(d.src||{});return d;}),onchange:function(){if(Y){Y.set("okEnabled",true);}}}),Z=R(a.title);b.setSelectedItems(W.filter(function(d){return c.indexOf(d.id)>-1;}));Y=new mstrmojo.ui.menus.EditorConfig({contents:new mstrmojo.Box({cssClass:"mstrmojo-vi-FilterBox-content",children:[{scriptClass:"mstrmojo.Label",text:Z},b]}),okEnabled:false,data:{},onOpen:function(){b.updateScrollbars();},cssClass:"mstrmojo-vi-FilterBox-targets",okBtnText:mstrmojo.desc(2031,"Apply"),fnOk:function(){V.model.changeFilterTargets(V,c,b.getSelectedItems().map(function(d){return d.id;}),V.isInFilterPanel());}});return Y;}function J(V,W){return function(X,Y){var Z=X!==Y;if(Z){V.set(W,X);}return Z;};}mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu",{_mixinName:"mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu",addModeMenuItems:function M(W,V,X){if(!V.supportsInclude()){return false;}var Y=function(b,Z){var a=V.include===Z;W.addMenuItem(b,a?"on":"",function(){if(!a){V.set("include",Z);this.generateToolbar();if(X){X();}}return !a;}.bind(this));}.bind(this);Y(mstrmojo.desc(3945,"Include"),true);Y(mstrmojo.desc(3946,"Exclude"),false);W.hasToggleItem=true;W.addSeparator();return true;},addShowAllMenuItem:function N(W,V){if(!V.supportsShowAllToggle()||V.isAttrQualSelector()||V.isRecursiveAttributeSelector()||V.isSearchBox()||mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()){return false;}var Y=mstrmojo.desc(4741,"Show option for all");if(!V.include){W.addNonInteractiveMenuItem(Y,"",true);return true;}var X=function(){var b=!V.defn.showall,Z=V.model,a=Z.getSelectorPropsChangeAction(V,{showAll:b}),c=a.concat(Z.getCtrlActionsByStyleForToggleShowAll(V,b));Z.submitToggleShowAllActions(V,c);};W.addToggleMenuItem(Y,"",X,X,this.id,V.defn.showall);return true;},addClearFilterMenuItem:function H(W,V,X){W.addMenuItem(mstrmojo.desc(14595,"Unset Filter"),"",function(){V.clearSelector(true);if(X){X();}});return true;},addMenuItemIfSelectTargetsValid:function U(W,V,X){if(!mstrApp.isAppStatePresentation()){var Y=this.getTargetInfo();if(Y.items.length){W.addEditorMenuItem(mstrmojo.desc(13629,"Select Targets"),this.id,E,{selector:V,fn:this.getTargetInfo.bind(this),title:X});}}},addFilterStyleMenuItem:function C(W,V){if(mstrApp.isAppStatePresentation()||V.isSolrSelector()){return false;}var X=V.getSelectorStyleList();if(!X.length){return false;}W.addSubMenuItem(mstrmojo.desc(11505,"Display Style"),"",this.id,function(){var Z=V.defn.style,Y=function(b){return function(){if(b!==Z){var c=mstrmojo.DocSelector.STYLES.ATTR_QUAL;if(b===c||Z===c){V.model.openSelWarnFlag(V.k);}V.model.changeFilterStyle(V,b);}};};var a=new mstrmojo.ui.menus.MenuConfig();if(V.isDynamicAttributeSelector()&&V.expr){a.useTooltip=true;X.forEach(function(c){var b=c.n;if(Z!==c.v){b=typeof b==="object"?b.n:b;a.addDisabledMenuItem({n:b,ttp:mstrmojo.desc(15952,"Please unset filter selections before switching to the # display style").replace("#",b)});}else{a.addMenuItem(b,"on",mstrmojo.emptyFn);}});}else{X.forEach(function(b){var c=b.v;a.addMenuItem(b.n,Z===c?"on":"",Y(c));},this);}a.hasToggleItem=true;return a;});return true;},addMultiSelectMenuItem:function I(W,V){if(!V.allowsTogglingMultiSelect()||mstrApp.isAppStatePresentation()){return false;}W.addMenuItem(mstrmojo.desc(13860,"Allow Multiple Selections"),V.multi?"on":"",function(){V.model.changeFilterStyle(V,V.style,!V.multi,V.iase);});W.hasToggleItem=true;return true;},addAutoSearchMenuItem:function G(W,V){if(!V.allowsTogglingAutoSearch()||mstrApp.isAppStatePresentation()){return false;}W.addMenuItem(mstrmojo.desc(15913,"Allow Instant Search"),V.iase?"on":"",function(){V.model.changeFilterStyle(V,V.style,V.multi,!V.iase);});W.hasToggleItem=true;return true;},addConfigVisSelectorMenu:function B(W,V){var X=this;W.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){X.closeVisSelectorPanel();var Z=V.model,Y=V.k;Z.checkLargeItemsForVisFilter(Y,function(){var a=Z.addVisFilterContainer(),c=Z.getSelectedViUnit(),b;Z.oldSelectedVizBoxId=c.id;mstrApp.isInVFConfigMode=true;mstrApp.restoreVFKey=Y;b=Z.insertVizBox(Y,a,{});Z.controller.rootCtrl.initPanelStautsInConfigMode();Z.selectVIUnit(b.id,true,{isAddAction:true});mstrApp.getRootController().enterVizFilterConfigMode(V.parent.baseTitle,true);});});},addQualMenuItems:function O(W,V){if(V.isSolrSelector()||!V.isMetricSelector()||V.isRankMetricSelector()||!V.isNumericMetricSelector()){return false;}W.addRadioMenuGroup(V.qua>0?1:0,J(V,"qua"),[{value:0,text:mstrmojo.desc(11571,"Qualify on Value")},{value:1,text:mstrmojo.desc(13630,"Qualify on Rank")}],"",undefined,true);W.addSeparator();return true;},addSetDisplayFormsMenuItem:function A(b,Y){var W=Y.node.data.dt;if(!Y.isAttributeSelector()&&!Y.isNewDerivedRecursiveElementSelector()||(Y.isAttrQualSelector()&&(W===Q.DATE||W===Q.TIMESTAMP))){return false;}var Z=Y.model,c=Y.defn,X=[],g=K.getUnitFromDataset(Z.datasets,c.srcid,c.srct),e=g&&g.attId,V=F.getFormsByAttrId(e||c.srcid,Z.datasets);if(Y.isRecursiveAttributeSelector()){V=L.filter(V,function(h){return h.fid!=="A9BFF03B4D72CC4F457ACBB4B185E91D"&&h.fnm!=="LEVEL_NUMBER";});}if(V.length<2){return false;}var d=c.fs;if(!d){var a=[],f=Z.getDatasetUnits(["att","mx"],function(h){return h.did===(e||c.srcid);})[0]||{};(f.fs||[]).forEach(function(h){if(h.isbf){a.push({did:h.fid});}});if(a.length){d=a;}}V=L.map(V,function(j,h){var k=j.fid;if(L.find(d,"did",k)!==-1){X[h]=true;}return{id:k,n:j.fnm};});if(mstrmojo.resolveFeature("set-attributeform-display")&&!mstrApp.isAppStatePresentation()){b.addPopupMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:"displayForms",data:{defn:c,oldSelectedIndices:X.slice()},contents:[{alias:"formCheckList",scriptClass:"mstrmojo.ui.CheckList",minimumSelectCnt:1,items:V,selectedIndices:X.slice()}],fnOk:function j(o,s){var m=[],q=s.formCheckList,t=q.items,k=q.selectedIndices,n=false,p;for(p=0;p<t.length;p++){var l=!!o.oldSelectedIndices[p],r=!!k[p];if(l!==r){n=true;break;}}if(!n){return ;}L.forEach(k,function(u,v){if(u){m.push(t[v]);}});Z.setFilterDisplayForms(Y,m);},onOpen:function h(){this.formCheckList.updateScrollbars();}});});}},addReplaceWithMenuItem:function S(W,V){var X=V.getSelectorReplaceUnitList();if(X.length===0){return false;}W.addEditorMenuItem(mstrmojo.desc(14003,"Replace with"),"",function(){return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"replaceReference",okVisible:false,cancelVisible:false,contents:[{scriptClass:"mstrmojo.ui.ScrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:V.getSelectorReplaceUnitList(),listHooks:{select:function Y(Z,a){if(V.isInFilterPanel()){V.model.replaceFilterStackSelectors(V.defn,a);}else{V.model.replaceFilter(V,a);}}}}]}]});});return true;},getTargetInfo:function P(){this.throwAbstractMethodError("getTargetInfo");}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.VisUtility","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.models.FormatModel","mstrmojo.chart.enums.EnumFontStyle");var B=mstrmojo.VisUtility,F=mstrmojo.hash,D=mstrmojo.models.FormatModel,C=D.ENUM_PROPERTY_NAMES,G=mstrmojo.chart.enums.EnumFontStyle,A=mstrmojo.vi.enums.EnumThemeProperties;mstrmojo.heatmap.vi.VisHeatmapUtility=mstrmojo.provide("mstrmojo.heatmap.vi.VisHeatmapUtility",{fontStyleValueMap:{bold:G.FS_BOLD,italic:G.FS_ITALIC,underline:G.FS_UNDERLINE,strikeout:G.FS_STRIKETHROUGH},setStepperEnabled:function(H,L,J){var K=["min","max"],I=["gt","lt"];K.forEach(function(O,M){var N=L.every(function(Q){var P=I[M],R=B.getPropertyByPath(J,[Q,O].join("."),P);return R===P;});H.getControl(M+1).set("enabled",N);});},getStepper:function(K,H){var J=new mstrmojo.Button(mstrmojo.Button.newIconButton(mstrmojo.desc(13608,"Decrease Font Size"),"single-operator minus",function(){K(-1);},undefined,{slot:"col1Node"})),I=new mstrmojo.Button(mstrmojo.Button.newIconButton(mstrmojo.desc(13607,"Increase Font Size"),"single-operator plus",function(){K(1);},undefined,{slot:"col2Node"}));H=F.copy(H,{col1Width:"50%",col2Width:"50%",dividerWidth:"10px",children:[J,I]});return new mstrmojo.ui.editors.controls.TwoColumnContainer(H);},isInvalidTemplate:function E(I){var H=I&&I.gts,J=H&&H.row;return(!(J&&J.length>0)||!B.hasOnlyMetricsOnColumn(I)||!B.hasNoMetricOnRow(I));},getInvalidTemplateErrMsg:function(H){return H||mstrmojo.desc(13685,"The Heat Map requires at least one attribute on the row axis to render properly; it is recommended that two metrics be placed on the column axis as well");},isSpatial:function(){return mstrApp.getThemeProps&&mstrApp.getThemeProps(A.SUBTYPE.HEATMAP).smallGap===A.DEFAULT_THEME_PROPS.HEATMAP.smallGap||false;},convertFontStyle:function(I,H){if((I&G.FS_BOLD)>0){H[C.FONT_WEIGHT]="bold";}if((I&G.FS_ITALIC)>0){H[C.FONT_STYLE]="italic";}if((I&G.FS_UNDERLINE)>0){H[C.UNDERLINE]="underline";}if((I&G.FS_STRIKETHROUGH)>0){H[C.LINE_THROUGH]="line-through";}},processFontStyle:function(H,I){H.fontWeight=(I&G.FS_BOLD?"bold":"normal");H.fontStyle=(I&G.FS_ITALIC?"italic":"normal");if((I&G.FS_STRIKETHROUGH)&&(I&G.FS_UNDERLINE)){H.textDecoration="line-through underline";}else{if(I&G.FS_STRIKETHROUGH){H.textDecoration="line-through";}else{if(I&G.FS_UNDERLINE){H.textDecoration="underline";}else{H.textDecoration="none";}}}},getFontStyleItems:function(){return[{n:mstrmojo.desc(2718,"Bold"),id:"b",css:"bold"},{n:mstrmojo.desc(2719,"Italic"),id:"i",css:"italic"},{n:mstrmojo.desc(2720,"Underline"),id:"u",css:"underline"},{n:mstrmojo.desc(3062,"Strikeout"),id:"s",css:"strikeout"}];},updateFontStyle:function(J,H){var I=[],K=function(N,O,L){var M=H[N];if(M){I.push(L);}};K(C.FONT_WEIGHT,"bold",0);K(C.FONT_STYLE,"italic",1);K(C.UNDERLINE,"underline",2);K(C.LINE_THROUGH,"line-through",3);J.select(I);},});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.hash","mstrmojo.dom","mstrmojo.tooltip","mstrmojo.css","mstrmojo.VisUtility");var C=mstrmojo.hash,E=mstrmojo.dom,F=mstrmojo.css,G=mstrmojo.VisUtility;mstrmojo.mapbox.ui.selectors.OveralZoomSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,null,{scriptClass:"mstrmojo.mapbox.ui.selectors.OveralZoomSlider",thumbWidth:3,cssBkBW:0,sliderDefaultWidth:140,multiSelect:true,disableDnD:false,worldLabel:mstrmojo.desc(8173,"World"),stateLabel:mstrmojo.desc(7676,"State"),cityLabel:mstrmojo.desc(7675,"City"),streetLabel:mstrmojo.desc(13821,"Street"),verticalLineHeight:"0px",markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation} mapbox-overal-zoom-slider" style="{@cssText}" ><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative;margin-top:21px;margin-bottom:10px"><div class="bk" style="{@bkCssText}"><div class="ruler" ></div><div class="ruler-label" >{@worldLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@stateLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@cityLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@streetLabel}</div></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div style="{@handel2CssText}"><div class="t3" mstrAttach:mouseout></div><div class="vertical-line" style="height:{@verticalLineHeight}"></div></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2NodeContainer:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3].firstChild;},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3]];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod,onwidthChange:function(){this.synchronizeSlider();},onmultiSelectChange:function(){F.toggleClass(this.domNode,"scm",this.multiSelect);F.toggleClass(this.domNode,"sc1",!this.multiSelect);},oncurrentZoomLevelChange:function(){var N=this.typeHelper,O;this.cs2Idx=this.getIndexByValue(this.currentZoomLevel);O=this.items[this.cs2Idx];if(O){this.cs2Vl=O.v;this.cs2Nm=O.n;}if(N&&N.updateThumb){N.updateThumb();}}},init:function M(P){P=C.copy(P,{isHoriz:true,multiSelect:true,min:0,max:22});if(!P.baseLayer){throw new Error(this.scriptClass+" must be initialized with baseLayer.");}if(!P.items||!P.getIndexByValue){throw new Error(this.scriptClass+" must be initialized with items and getIndexByValue function.");}P.currentZoomLevel=P.baseLayer.getZoom();var N=P.getIndexByValue(P.currentZoomLevel),O={0:true};if(!P.multiSelect){P.selectedIndex=N;}else{O[N]=true;P.selectedIndices=O;}this._super(P);if(P.baseLayer){this.zoomLevelChangeListener=P.baseLayer.attachEventListener("zoomLevelChanged",this.id,function(Q){this.set("currentZoomLevel",Q.zoomLevel);});}},synchronizeSlider:function D(){this._super();if(!this.hasRendered){return ;}var N=[0,5,9,14,22],O=parseFloat(this.width)/2,Z=this._effectiveLength/22,X=this.bgNode,a=X.children,R,S,P=F.getComputedStyle(a[1]),Q={fontFamily:P.fontFamily,fontSize:P.fontSize,fontStyle:P.fontStyle,fontWeight:P.fontWeight},Y=parseFloat(P.paddingLeft)+parseFloat(P.paddingRight),V,U,W=false;for(R=0;R<4;R++){S=Math.round((R===0?0:this.thumbWidth/2)+N[R]*Z)+"px";if(R!==0){a[3*R-1].style.left=S;}V=Math.round((N[R+1]-N[R])*Z+(R===0||R===3?this.thumbWidth/2:0));a[3*R+1].style.left=S;a[3*R+1].style.width=V+"px";U=G.measureTextWidth(a[3*R+1].innerText,Q,Y);if(!W){W=U>V;}a[3*R].style.left="0px";a[3*R].style.width=Math.round((N[R+1]-N[0])*Z+(R===3?this.thumbWidth:this.thumbWidth/2))+"px";}if(W){F.toggleClass(a[1],"left",true);a[1].style.width=O+"px";F.toggleClass(a[4],"hide",true);F.toggleClass(a[7],"hide",true);F.toggleClass(a[10],"right",true);a[10].style.width=O+"px";a[10].style.left=O+"px";}else{F.toggleClass(a[1],"left",false);F.toggleClass(a[4],"hide",false);F.toggleClass(a[7],"hide",false);F.toggleClass(a[10],"right",false);}},updateTypeHelper:function B(){var N=C.walk("mapbox.ui.selectors.OveralSliderHelper",mstrmojo);this.typeHelper=new N({slider:this});},createGhost:function J(N){var O=this._super(N);O.handle2NodeContainer=O.handle2Node;O.handle2Node=O.handle2NodeContainer.firstChild;return O;},initDrag:function L(O,N){if(this.enabled&&!this.disableDnD){this._super(O,N);}},_updateTooltip:function I(V,S){var P=E.eventTarget(S,V),R,Z,Y,W,O=null,X=null,U='<div class="name">{@content}</div>',N='<div class="dsc">{@description}</div>',b,a=false,Q=this.dnd.initD!==null;switch(P){case this.handle2Node:R=Q?String(this.cs2Nm).replace("$","$$$$"):Number(this.currentZoomLevel).toFixed(4);Y=mstrmojo.tooltip.POS_BOTTOMLEFT;W="vi-tooltip-V ";X=0;O=-4;a=true;break;default:break;}if(a&&this.enabled){b={cssClass:"mstrmojo-VISlider vi-regular "+W+mstrApp.getThemeClassName(),content:U.replace(/\{@content\}/g,R)+(Z&&Z.length>0?N.replace(/\{@description\}/g,Z):""),contentNodeCssClass:"scm-tooltip",refNode:P,posType:Y,left:O,top:X};this.set("richTooltip",b);}},destroy:function H(N){if(this.baseLayer){if(this.zoomLevelChangeListener){this.baseLayer.detachEventListener(this.zoomLevelChangeListener);}delete this.baseLayer;}this._super(N);}});mstrmojo.mapbox.ui.selectors.OveralSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:" mstrmojo.mapbox.ui.selectors.OveralSliderHelper",updateSummary:function K(){},updateHandleNodeStyle:function A(R,N,Q,O,P){R.handle1Node.style[N]=Q+P;R.handle2NodeContainer.style[N]=O+P;}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.func","mstrmojo.Dialog","mstrmojo.Button","mstrmojo._IsPopup","mstrmojo._CanAutoClose","mstrmojo.VisUtility","mstrmojo.vi._MonitorsAppState","mstrmojo.PerformanceLogOutput");var k=60,Z=mstrmojo,C=Z.css,O=Z.dom,r=Z.func,W=Z.VisUtility,c=Z.Button.newWebButton,n=2,J=60,X=3,o=44,v=48,D=4,q=160,f=Z.PerformanceLogOutput;function B(){f.startTimer({functionName:"VisFilter.updateSelections",purpose:"from Apply filter to End"},"timerid_VisFilter_updateSelections");f.visPrint("VisFilter updateSelections start");var x=this.filterPortlet,z=this._actionCache;if(x&&z){x.selector.applySelections(z);}this.destroy();}function g(){var x=this.vizBox;return x&&x.boxContent;}function S(){return mstrApp?mstrApp.getThemeClassName():"";}function L(){var z=this.filterPortlet,x=z&&z.domNode;if(x){return x.getBoundingClientRect();}}function d(){var z=this.filterPortlet,x=z&&z.parent;return x&&x.parent;}function R(z){var AB=this.filterPortlet,x=AB&&AB.domNode,AA=x&&x.parentNode;if(AA){AA.style.paddingBottom=z+"px";}}function H(){var z=d.call(this),x=z&&z.containerNode;if(x){return x.getBoundingClientRect();}}function Q(){if(!this.model){return ;}var x=this.model.getMainPanelFormatting(),AA=L.call(this),z={top:x.top,height:x.height};if(AA.left<x.left){z.left=AA.right;z.width=x.right-z.left;}else{z.left=x.left;z.width=AA.left-z.left;}return z;}function u(){var AC=P.call(this),z=L.call(this),AB=H.call(this),AA=n/2,x={top:Math.max(z.top,AB.top)+AA};x.height=(z.bottom<AB.bottom)?(z.bottom-x.top)-AA:(AB.bottom-x.top)-AA;x.height=x.height<0?0:x.height;if(z.left<AC.left){x.right=AC.left+n;x.left=AC.left-n*3;}else{x.left=AC.right+AA;x.right=z.left+n*2;}x.width=x.right-x.left;return x;}function w(){var x=document.getElementById("VisFilterCurtain-main"),z=Q.call(this);if(x){x.style.left=z.left+"px";x.style.width=z.width+"px";x.style.top=z.top+"px";x.style.height=z.height+"px";}}function b(){var z=document.getElementById("VisFilterCurtain-border"),x=u.call(this);if(z){z.style.left=x.left+"px";z.style.width=x.width+"px";z.style.top=x.top+"px";z.style.height=x.height+"px";}}function K(z){var AD=this.filterPortlet,AA=AD&&AD.domNode,AE=AA&&AA.previousSibling&&AA.previousSibling.previousSibling,x=AE&&AE.querySelector(".splitter"),AB=z?"block":"none",AC;if(AA){C.setStyleValue(AA.querySelector(".splitter"),["display"],[AB]);}if(x){AC=C.getStyleValue(x,"display");if(!z&&AC==="none"){this.ignorePreDivider=true;}if(!this.ignorePreDivider){C.setStyleValue(x,["display"],[AB]);delete this.ignorePreDivider;}}}function m(){w.call(this);b.call(this);K.call(this,false);}function P(){var AA=this.model,x=AA.getMainPanelFormatting(),AC=AA.getFilterPanelFormatting(),AB=x.width>J?J:0,z={top:x.top+X,height:x.height-o-X};if(AC.left<x.left){z.left=AC.right-n;z.right=x.right-AB;}else{z.right=AC.left-n*2;z.left=x.left+AB;}z.bottom=z.top+z.height;z.width=z.right-z.left;return z;}function p(AA){var AB=AA,x=document.body;while(AB&&(AB!==x)){var z=AB.getAttribute&&AB.getAttribute("class");if(z!==null&&z.indexOf("forVisFilter")>=0){return true;}AB=AB.parentNode;}return false;}function U(AA){var x=this.filterPortlet,AB=AA&&AA.getSelectionCache(),z=(AB&&AB._viSelections)||{};if(x&&AA){x.updateSummaryBar(z);}}mstrmojo.vi.ui.rw.VisFilterDisplayPanel=mstrmojo.declare(mstrmojo.Dialog,[mstrmojo._IsPopup,mstrmojo._CanAutoClose,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.rw.VisFilterDisplayPanel",markupString:'<div id="{@id}" class="mstrmojo-Dialog {@cssClass}" style="z-index: 8;" tabindex="0" mstrAttach:click,contextmenu><div class="mstrmojo-Editor" style="height:{@height}"><div class="mstrmojo-Editor-titlebar"><div class="mstrmojo-Editor-title">{@title}</div></div><div class="mstrmojo-Editor-content"></div></div><svg id="VisFilterCurtain-main" /><svg id="VisFilterCurtain-border" /><div class="mstrmojo-Editor-tip"></div></div>',cssClass:"mstrmojo-VisFilterDisplayPanel",children:[{scriptClass:"mstrmojo.Box",cssClass:"titlebar-container",slot:"titleNode",alias:"titleBar",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(1763,"Clear All"),alias:"clearAllBtn",cssClass:"edt-link disabled",disabled:true,onclick:function(AA){var x=this.parent.parent,z=g.call(x);if(!this.disabled&&z){z.clearAllSelectionsAndHighlight(AA);}}},{scriptClass:"mstrmojo.Box",alias:"btnBox",children:[c(mstrmojo.desc(221,"Cancel"),function(){var x=this.parent.parent.parent;if(x){x.cancelSelections();}}),c(mstrmojo.desc(8473,"Done"),function(){var x=this.parent.parent.parent;if(x){B.call(x);}},true,{alias:"savebtn",enabled:false})]}]},{scriptClass:"mstrmojo.Box",alias:"visContainer",slot:"containerNode"}],locksHover:true,nodeKey:null,vizBox:null,filterPortlet:null,include:null,model:null,_actionCache:null,_prevSelectionInfo:null,disposable:false,init:function s(x){this._super(x);if(!this.model){return ;}this.cssClass+=" "+S();},_addVizBox:function j(){var z=this.vizBox=this.model.getVizBox(this.nodeKey,{width:parseInt(this.width),height:parseInt(this.height)-k}),x=z&&z.boxContent;if(x){x.filterCtrl=this;}this.visContainer.addChildren(z);return z;},preBuildRendering:function A(){var x=P.call(this),AA=this.vizBox;if(!x){return ;}this.height=x.height+"px";this.width=x.width+"px";this.left=x.left+"px";this.top=x.top+"px";var z=this.selectedVizBox=document.querySelector(".mstrmojo-VIMainVizPanel .mstrmojo-UnitContainer.selected");C.removeClass(z,"selected");if(!AA){this.vizBox=this._addVizBox();}else{AA.updateLayout({height:(x.height-k)+"px",width:x.width+"px"});}this._super();},postBuildRendering:function V(){this._super();m.call(this);this.updateTitleBar();this.updateVisFilterPortletStyle();},updateVisFilterPortletStyle:function t(){var AJ=d.call(this),AA=AJ.scrollNode;if(!AJ||!AA){return ;}AJ.disableScroll();var AC=this.filterPortlet.domNode,AE=AA.scrollTop,AK=AA.clientHeight,AL=AA.scrollHeight,AD=AA.getBoundingClientRect(),z=AC.offsetTop,AG=AC.getBoundingClientRect(),AI=AG.height,AB=z+AI,AF=this.model.getMainPanelFormatting(),AH=AD.bottom-AF.bottom+v,x;if(z<AE){AA.scrollTop=z;}else{if(AE+AK<AB+AH){x=AL-AB;if(x<AH){R.call(this,AH);}AA.scrollTop=AB+AH-AK;}}},close:function l(x){var z=this.filterPortlet,AB=z&&z.domNode,AA=W.isHostedPopupNode(x,"class",true,document.body)||p(x),AC=W.isMojoEditorNode(x,"class",true,document.body);if(!(AB&&x&&AB.contains(x))&&!AA&&!AC){this._super();}},onClose:function Y(){K.call(this,true);this.cancelSelections();},onAppStateChange:function h(x){this._super(x);this.cancelSelections();},cacheUpdateAction:function E(x){this.updateTitleBar(true);this._actionCache=x;},updateTitleBar:function N(AB){var z=this.titleBar,AA=z&&z.clearAllBtn,AC=g.call(this),x=AC?AC.getSelectionSize():0;if(!AA||!AC){return ;}U.call(this,AC);z.btnBox.savebtn.set("enabled",!!AB);if(x>0){C.removeClass(AA.domNode,"disabled");AA.disabled=false;}else{C.addClass(AA.domNode,"disabled");AA.disabled=true;}},getResizeHandler:function e(){var x=this.id;return r.debounce(function(){var z=mstrmojo.all[x];if(z){z.resizeDialog();z.positionDialog();}},q);},resizeDialog:function M(){this._super();this.refresh();},cancelSelections:function F(){var x=g.call(this);if(x){x.setSelectionCache(x.getPrevSelectionInfo());x.clearHighlightsCache();}U.call(this,x);this.destroy();},updateFormats:function G(){b.call(this);},oncontextmenu:function a(x){O.stopPropogation(window,x);O.preventDefault(window,x);},updateVis:function I(x){var z=g.call(this),AA=x&&x.data&&x.data.sc;if(AA){AA.exp=null;}if(z&&x){z.updateForInteractiveMode=true;z.node=x;z.update(x);z.refresh();delete z.updateForInteractiveMode;}},destroy:function(){var AC=this.vizBox,x=this.model,AB=g.call(this),z=this.filterPortlet,AA=d.call(this);if(AA){AA.enableScroll();}R.call(this,D);K.call(this,true);if(z){z.resetVisFilterState();this.filterPortlet=null;}C.addClass(this.selectedVizBox,"selected");if(x&&AC){x.destroyVisualiztionselector(AC);}if(AB){AB.filterCtrl=null;}this.vizBox=null;this.model=null;this._super();mstrApp.isInVFInteractMode=false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.array","mstrmojo.vi.ui.theme","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui.VIDragUnit","mstrmojo.hash");var G=mstrmojo.css,E=mstrmojo.dom,B=mstrmojo.vi.ui.theme,F=mstrmojo.array,C=mstrmojo.hash;function D(P,Q,O){var N=false;F.forEach(this.getSelectedItems(),function(R){if(R.itemNode===Q||R===P){N=true;}});if(P&&!N){this.doItemSelect(P,O||{});}}var M={avatarCssClass:"mstrmojo-VIUnitList",encodeUnitAvatar:true,getDragData:function L(N){var O=N.src.node,Q=E.findAncestorByAttr(O,"idx",true,this.domNode);N.src.node=Q?Q.node:O;var P=(N.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit()).getUnitDragData(N,this.getSelectedItems());if(this.getItemDisplayName){mstrmojo.func.override({getItemDisplayName:this.getItemDisplayName},N.dragUnitHelper);}P.srcId=this.id;return P;},createAvatar:function A(O,N){if(N.dragUnitHelper){return N.dragUnitHelper.getUnitAvatar(N,this.encodeUnitAvatar);}},selectDragNode:function K(N){var O=N.src;D.call(this,this.getItemFromTarget(O.node),this.getItemNodeFromTarget(O.node),O);},onItemContextMenu:function J(O,N){D.call(this,O,this.getItemNodeFromTarget(N.getTarget()),N);if(this._super){return this._super(O,N);}},positionAvatar:function H(O,N){N.dragOffsets=N.dragUnitHelper.getDragUnitOffsets();if(this._super){this._super(O,N);}}},I=C.copy(M);I._mixinName="mstrmojo.vi.ui._HasUnitListAvatar2";I.getDragData=function(N){if(this.isDraggingItem&&!this.isDraggingItem(N)){if(this._super){return this._super(N);}}else{return M.getDragData.call(this,N);}};mstrmojo.vi.ui._HasUnitListAvatar2=mstrmojo.provide("mstrmojo.vi.ui._HasUnitListAvatar2",I);mstrmojo.vi.ui._HasUnitListAvatar=mstrmojo.provide("mstrmojo.vi.ui._HasUnitListAvatar",mstrmojo.mixin(M,mstrmojo.mixin(mstrmojo._HasOwnAvatar)));}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.func","mstrmojo.array","mstrmojo.vi.models.editors.ControlsViewFactory","mstrmojo.Label","mstrmojo.vi.ui.TextAlignButtonBar","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.vi.ui.editors.MoreOptionsEditor");var J=mstrmojo.hash,H=mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS,Q="mstrmojo-more-options-editor",F="mstrmojo-more-options-editor-visfilter";mstrmojo.vi.models.editors.EditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.ControlsViewFactory,null,{scriptClass:"mstrmojo.vi.models.editors.EditorModel",hostId:"",help:"",getHost:function C(){return mstrmojo.all[this.hostId];},docModel:null,getEditorContents:mstrmojo.emptyFn,getGroupTitle:function D(S){return new mstrmojo.Label({cssClass:"edt-title",text:S});},getShowTitleCheckbox:function K(){var S=this.getHost();return this.getCheckboxAndLabel(S.parent.getTitleBarVisibility(),mstrmojo.desc(13599,"Show titlebar"),function(U){S.parent.toggleTitleBar(!!U);});},getTextAlign:function G(V,W,U){var S=new mstrmojo.vi.ui.TextAlignButtonBar(!U?null:{itemsValueMap:U});S.singleSelect(mstrmojo.array.find(S.items,"id",V));S.onValueChange=W;return S;},getWrapText:function P(U,S){return this.getCheckboxAndLabel(U,mstrmojo.desc(13577,"Wrap text"),S);},getTextDirection:function E(U,V){var S=0;if(U){S=U===3?1:2;}return this.getLabelAndControl(mstrmojo.desc(11914,"Direction:"),this.getPulldown([{n:mstrmojo.desc(2066,"Horizontal"),v:0},{n:mstrmojo.desc(5155,"90 degrees"),v:90},{n:mstrmojo.desc(5156,"-90 degrees"),v:-90}],V,S));},getOverflow:function L(U,S){return this.getLabelAndControl(mstrmojo.desc(11915,"Overflow:"),this.getPulldown([{n:mstrmojo.desc(2974,"Clip"),v:false},{n:mstrmojo.desc(2976,"Scroll"),v:true}],S,U?1:0));},getChangeFormatPropertyFn:function A(S,U){var V=this.id;return function(Y,W){var X=mstrmojo.all[V];X.docModel.changeUnitFormatProperty(X.getHost().parent,[{formatType:U||1,propertyName:S,newValue:Y,oldValue:W}]);};},getChangeGroupPropertyFn:function R(S){var U=this.id;return function(V,X,W){(mstrmojo.all[U].getChangeFormatPropertyFn(V,S))(X,W);};},getCharacterGroup:function B(W,S,U){var X={onGroupValueChange:W};if(U){X.visibleControls=U;}var V=new mstrmojo.ui.editors.controls.CharacterGroup(X);V.setFormatSource(S);return V;},getContainerGroup:function O(S,W,U,V){var X=new mstrmojo.ui.editors.controls.ContainerGroup(J.copy(V,{onGroupValueChange:W||this.getChangeGroupPropertyFn(),visibleControls:U||(H.FILL_COLOR+H.BORDER)}));X.setFormatSource(S);return X;},getMoreOptionsEditorLink:function M(U,S,V){return new mstrmojo.Label({text:mstrmojo.desc(9126,"More options"),cssClass:"edt-link",onclick:function(){this.openMoreOptionsEditor(U,S,V);}.bind(this)});},openMoreOptionsEditor:function N(X,S,Y){var W=this.getHost(),V;var U=function(b,Z,f,a){var c=this.host,d=c.controller,e=[];if(!J.isEmpty(b)){f=mstrmojo.func.wrapMethods(d._getXtabCallback(c),f);e=[d.dataService().getUpdateTemplateAction(c.k,[c.model.getAdvancedPropertiesAction(b)])];}e=e.concat(Z||[]);if(!J.isEmpty(e)){d.submitUndoRedoUpdates(e,null,f,a);}};if(mstrApp.isInVFConfigMode){V=mstrmojo.all[F]||new mstrmojo.vi.ui.editors.MoreOptionsEditor({id:F,submitAction:U});}else{V=mstrmojo.all[Q]||new mstrmojo.vi.ui.editors.MoreOptionsEditor({id:Q,submitAction:U});}V.set("data",X);V.set("showHeadersSection",!!S);V.set("showSelectionLimitSection",!!W.GMController);V.set("lockHeadersCase",Y);V.set("host",W);V.open();return V;},replaceChildControls:function I(V,U){var S=[].concat(V.children||[]);V.removeChildren();S.forEach(function(W){W.destroy();});V.addChildren(U);V.doLayout();}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.hash","mstrmojo.Container","mstrmojo.threshold.TextGroup","mstrmojo.threshold.ThresholdRow","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.ui.editors.controls.CharacterGroup");var G=mstrmojo.Widget,F=mstrmojo.hash,D="180px";mstrmojo.threshold.PropertyPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo.threshold.PropertyPanel],{markupString:'<div class="mstrmojo-threshold-PropertyPanel"><div class="condition"></div><div class="format mstrmojo-vi-PropEditor"><div class="text"><div class="title">'+mstrmojo.desc(5998,"Replace Data")+'</div></div><div class="font mstrmojo-vi-EditorGroup"><div class="title">'+mstrmojo.desc(3433,"Font")+'</div></div><div class="border"><div class="title">'+mstrmojo.desc(5616,"Color And Borders")+'</div></div></div><div class="apply"></div></div>',markupSlots:{conditionNode:function(){return this.domNode.firstChild;},textNode:function(){return this.domNode.children[1].firstChild;},fontNode:function(){return this.domNode.children[1].children[1];},borderNode:function(){return this.domNode.children[1].children[2];},applyNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:G.visibleMarkupMethod,onheightChange:G.heightMarkupMethod,onwidthChange:G.widthMarkupMethod},model:undefined,editor:undefined,textGroup:undefined,charGroup:undefined,containerGroup:undefined,onvisibleChange:function A(){if(this.visible){var J=this.model;J.updateControl(this);var H=F.clone(J.threshold),I=this.thresholdRow;if(I){this.removeChildren(I);}this.addChildren({scriptClass:"mstrmojo.threshold.ThresholdRow",alias:"thresholdRow",slot:"conditionNode",idx:J.thresholdRow.idx,model:this.editor.model,threshold:H,onclick:mstrmojo.emptyFn});this.refresh();}},onOK:function B(){this.model.submitChange();this.close();},close:function E(){var H=this.thresholdRow;if(H){this.removeChildren(H);}this.set("visible",false);this.editor.toggleButtonStatus(true);this.editor.setRowPanelVisibility(true);},children:[{scriptClass:"mstrmojo.threshold.TextGroup",slot:"textNode",alias:"textGroup",width:D,onGroupValueChange:function C(H,I){this.parent.model.changeFormatProperty("threshold",H,I);}},{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",slot:"fontNode",alias:"charGroup",width:D,onGroupValueChange:function C(H,I){this.parent.model.changeFormatProperty("fmt",H,I);}},{scriptClass:"mstrmojo.ui.editors.controls.ContainerGroup",slot:"borderNode",alias:"containerGroup",width:D,onGroupValueChange:function C(H,I){this.parent.model.changeFormatProperty("fmt",H,I);}},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",onclick:function(){var H=this.parent;if(H.close){H.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",onclick:function(){var H=this.parent;if(H.onOK){H.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:mstrmojo.desc(14000,"Press ## after finishing formatting.").replace("##",'"√"')}]});}());(function(){mstrmojo.requiresCls("mstrmojo.DocPanel","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.models.EnumDragSources","mstrmojo.models.FormatModel","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.css","mstrmojo.hash","mstrmojo.array","mstrmojo.vi.ui.DatasetUnitMenuUtils");var a=mstrmojo.vi.models.EnumDragSources,f=mstrmojo.models.FormatModel,I=f.getFormatUpdate,U=f.ENUM_PROPERTY_NAMES,G=mstrmojo.vi.ui.DatasetUnitMenuUtils,N=mstrmojo.array,e=mstrmojo.css,W=mstrmojo.hash;function C(h){var g=this.width;h.forEach(function(m){var k=m.getLayoutOffsets&&m.getLayoutOffsets(),l=(k&&k.w)||0,j=g;if(l){j=parseInt(j,10)-l+"px";}if(m.setDimensions){m.setDimensions(m.height,j);}});}function J(){this._dividers.forEach(function(g){g.style.height=0;});}function A(){var g=this.containerNode;this._dividers.forEach(function(h){g.removeChild(h);});this._dividers=[];}function d(){var p=this._orderedSelectors=(this.getPanelChildren()||[]).filter(function(u){return !!u.togglePortlet;}).sort(function(v,u){var w=function(x){return(x&&x.selector&&x.selector.defn&&x.selector.defn.fmts&&x.selector.defn.fmts["z-index"])||0;};return(parseInt(w(v))>parseInt(w(u)))?1:-1;});this.set("empty",!p.length);A.call(this);var o=p.map(function(v){var u=v.selector;return{node:v.domNode,selector:u,fmts:u.defn.fmts};}),j=this.containerNode,n=this.model,m=this._dividers=[],q="z-index",l=[];while(j.lastChild){j.removeChild(j.lastChild);}o.forEach(function(w,u){if(parseInt(w.fmts[q],10)!==u){l.push(n.getUnitFormatAction(w.selector,1,I(U.Z_INDEX,u)));}w.fmts[q]=u;var v=document.createElement("div");v.className="fp-divider";j.appendChild(v);m.push(v);j.appendChild(w.node);});var s=this.emptyMsgBoxNode;if(s){j.appendChild(s);}if(l.length){var r=n.controller.cmdMgr,h=r.getInterimCmd(),t,k=mstrmojo.DocDataService.SUPPRESS_DATA;if(h){t={success:mstrmojo.emptyFn};h.submit(l,t,k,r.CMD_PHASE.LAST);}else{var g=n.getDataService();t={success:function(){var u=n.getDataService().stid||0,v=n.lastSavedStid||0;if(u-v===1){n.lastSavedStid=u;}}};g.submitUpdates(l,t,W.copy(k,{preserveUndo:true}));}}}function B(h){var g=h&&h.src;return g&&(g===a.DATASETS||g===a.VIZ_EDITOR||g===a.ALL_OBJECT_LIST);}function P(j){var p=j.tgtData,o=j.tgt.pos.y,h=p.map,l=h&&h.length;if(!h){var k=mstrmojo.dom.position(this.domNode).y;h=j.tgtData.map=(this._orderedSelectors||[]).map(function(q){var r=q.domNode;return k+r.offsetTop+Math.round(r.offsetHeight/2);});l=h&&h.length;}(p.map||[]).every(function(r,q){if(o<r){l=q;return false;}return true;});if(p.tgtIdx===l){return ;}p.tgtIdx=l;J.call(this);var n=this._dividers[l],g=j.src.data,m=(g&&g.dim&&g.dim.h)||null;if(n){n.style.height=(m||"48")+"px";}}function Q(h){var g=this.model;return h.did!=="-1"&&h.t!==14&&G.isValidAddToFP(g,h);}mstrmojo.vi.ui.rw.FilterPanel=mstrmojo.declare(mstrmojo.DocPanel,[mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._CanDropFromSchema],{scriptClass:"mstrmojo.vi.ui.rw.FilterPanel",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onwidthChange:function(){C.call(this,this.children||[]);},onemptyChange:function(){var g=this.empty;e.toggleClass(this.emptyMsgBoxNode,"hide",!g);e.toggleClass(this.containerNode,"fp-empty-center",g&&mstrApp.isAppStatePresentation());}},width:null,model:null,subPanelCssText:"background-color: transparent; background: transparent;",empty:true,init:function X(g){this._super(g);e.addWidgetCssClass(this,"mstrmojo-VIFilterPanel");this._dividers=[];this.attachEventListener("childrenRendered",this.id,d);},postBuildRendering:function b(){var g=this.containerNode;if(g&&!this.emptyMsgBoxNode){var j=document.createElement("div");var h=mstrApp.isAppStatePresentation();j.className="fp-empty-msgbox";j.innerHTML=h?mstrmojo.desc(16185,"There are no filters in this chapter."):mstrmojo.desc(13258,"Drag objects here.");j.style.textAlign=h?"center":"left";g.appendChild(j);this.addSlots({emptyMsgBoxNode:j});}return this._super();},isEmpty:function S(){return this.empty;},updateForPU:function Z(g){var j=g.defn&&g.defn.ck;this.node.data.objects=this.node.data.objects.filter(function(k){if(j&&j[k.k]){return true;}return false;});if(g.data&&g.data.objects){var h=this.node.data.objects;N.forEach(g.data.objects,function(k){if((j&&j[k.k]||k.sc)&&N.find(h,"k",k.k)<0){h.push(k);}});}this.update(g);},refresh:function D(j,h){var g=this.domNode.clientWidth-2*2;this.contentWidth=(g>0)?g:0;this._super(j,h);},refreshFP:function H(){d.call(this);},unrender:function Y(g){A.call(this);this._super(g);},addChildren:function M(j,g,h){var k=this.parent;if(j&&j.constructor!==Array){j=[j];}C.call(this,j);this._super(j,g,h);if(!j||!j.length){d.call(this);}if(k&&k.scrollNode){k.updateScrollbars();}},toggleFilters:function L(l){var o=this,m=o.model,n=l?1:0,g=mstrmojo.DocDataService,q=g.EMPTY_CALLBACK,j=g.SUPPRESS_DATA,k=l,h=function(){o.raiseEvent({name:"filterPanelUpdated"});};var p=function(){k=!k;(o.children||[]).forEach(function(r){if(!r.isVisFilter()){r.set("_onCollapseAll",true);r.togglePortlet(k);r.set("_onCollapseAll",false);}});h();};m.execute({execute:function(){var r=m.getDataService().newUpdate(this);(o.children||[]).forEach(function(s){if(!s.isVisFilter()&&s.togglePortlet){s.set("_onCollapseAll",true);s.togglePortlet(l);s.set("_onCollapseAll",false);r.addActions(m.getUnitFormatAction(s.selector,1,{FormattingView:{WindowState:n}}));}});r.addCallbacks({success:function(){if(!l){var s;(o.children||[]).forEach(function(t){if(!t.isVisFilter()){s=t.selector;if(s&&s.expandOrEditToFetchElements){s.expandOrEditToFetchElements();}}});}h();}});r.addExtras(g.REQUEST_ONLY_DEFINITION);r.submit();},urInfo:{undo:function(){p();},redo:function(){p();},callback:q,extras:j}});},getContextDragData:function(g){var h=this._super(g);if(h.src===a.ALL_OBJECT_LIST){this.augmentDropContextForSchema(g,this.model);g.preInfo={actions:g.actions,callback:g.callback};}return h;},allowDrop:function E(g){var k=this.getContextDragData(g);if(k){var j=k.src;if(B(k)){var h=this;return k.items.some(function(l){return Q.call(h,l);});}if(j===a.FILTERS){return true;}}return false;},ondragenter:function O(g){this._super(g);g.tgtData={tgtIdx:999};P.call(this,g);},ondragover:function V(g){P.call(this,g);},ondrop:function c(h){var k=h.tgtData;if(!k){return this._super(h);}var n=h.src&&h.src.data,j=n&&n.src,r=this.model,t=this,q=function(){return k.tgtIdx;};if(B(n)){var o=[];n.items.forEach(function(u){if(Q.call(t,u)){o.push(u);}});var g=function(u){r.addFilterStackSelectors(u,q(),{preInfo:h.preInfo,postInfo:h.postInfo});};if(j===a.ALL_OBJECT_LIST){var p=h.src.widget,m=p&&p.dataProvider;if(m){m.loadObjects(o,{success:function(u){g((u&&u.objects)||o);}},true,true);}}else{g(o);}}else{if(j===a.FILTERS){var s=parseInt(n.idx,10),l=q();if(s<l){l--;}if(s!==l){r.pivotFilterStackSelector(this._orderedSelectors[s].selector,s,l);}}}this._super(h);},getDropAvatarIcon:function R(h){var k=h.src.data,j=k&&k.src,g="unselectable";if(B(k)){g="add";}else{if(j===a.FILTERS){g="move";}}return g;},cleanUpAfterTarget:function K(g){J.call(this);this._super(g);},clearAllFilter:function F(){(this.children||[]).forEach(function(g){if(g.clearFilters){g.clearFilters();}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.ListBase","mstrmojo._IsList","mstrmojo.array","mstrmojo.hash","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.models.DropZonesModel");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");mstrmojo.requiresDescs(11819,11825,11827,16057,16058,16059,16060,16061,16062,16063,16064,16065,16066,16067,16068,16069,16070,16071,16072,16073,16074,16075,16076,16077,16078,16079,16080,16081,16082,16083,16084,16085,16086,16087,16088,16089,16090,16091,16092,16093,16208,16209);var c=mstrmojo,O=c.array,S=c.hash,G=mstrmojo.dom,V=mstrmojo.string,b=c.vi.viz,M=mstrmojo.vi.models.DropZonesModel.ENUM_REQUIREMENT_TYPE,N=M.ATTRIBUTE,W=M.METRIC,C=b.EnumVisualizationTemplates,R=b.EnumVizStyles,K=R.GRAPH_MATRIX,Z=R.NEW_GRAPH_MATRIX,e=b.EnumWidgetTypes.GRAPH_MATRIX,d=R.MAPBOX,B={},P="custom",U="plugins.";B[R.GOOGLE_MAP]=C.GOOGLEMAP;B[R.HEAT_MAP]=C.HEATMAP;B[R.ESRI_MAP]=C.ESRIMAP;B[R.NETWORK]=C.NETWORK;B[R.IMAGE_LAYOUT]=C.IMAGELAYOUT;var X=["plugins.KPIWidget.KPIWidget","plugins.SmartKPIWidget.SmartKPIWidget"];function H(j,h,m){var k=[],l=function(o,p){var n={t:o,r:p};if(o===W&&m){n.s=true;}k.push(n);};if(j){l(W,j);}if(h){l(N,h);}return k;}var Q=[{n:mstrmojo.desc(11820,"Bar Chart"),id:"BarChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALBARAUTOMATIC,h:C.GRAPHMATRIXHORIZONTALBARAUTOMATIC}},{n:mstrmojo.desc(8121,"Line Chart"),id:"LineChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALLINEAUTOMATIC,h:C.GRAPHMATRIXHORIZONTALLINEAUTOMATIC}},{n:mstrmojo.desc(11821,"Area Chart"),id:"AreaChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALAREAAUTOMATIC,h:C.GRAPHMATRIXHORIZONTALAREAAUTOMATIC}},{n:mstrmojo.desc(11822,"Bubble Chart"),id:"BubbleChart",mr:H(2,1),vt:C.GRAPHMATRIXBUBBLECIRCLEMM},{n:mstrmojo.desc(11823,"Pie Chart"),id:"PieChart",mr:H(1,1),vt:C.GRAPHMATRIXPIE},{n:mstrmojo.desc(11824,"Combo Chart"),id:"ComboChart",mr:H(2,1),vt:C.GRAPHCOMBINATIONBARAREADUALAXIS}];Q.forEach(function(h){h.s=K;h.wtp=e;});var g=[{n:mstrmojo.desc(15130,"Clustered Bar Chart"),id:"ClusteredBarChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALBARCLUSTERED,h:C.GRAPHMATRIXHORIZONTALBARCLUSTERED}},{n:mstrmojo.desc(15129,"Stacked Bar Chart"),id:"BarChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALBARSTACKED,h:C.GRAPHMATRIXHORIZONTALBARSTACKED}},{n:mstrmojo.desc(8121,"Line Chart"),id:"LineChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALLINEAUTOMATIC,h:C.GRAPHMATRIXHORIZONTALLINEAUTOMATIC}},{n:mstrmojo.desc(15233,"Stacked Area Chart"),id:"AreaChart",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALAREASTACKED,h:C.GRAPHMATRIXHORIZONTALAREASTACKED}},{n:mstrmojo.desc(11822,"Bubble Chart"),id:"BubbleChart",mr:H(2,1),vt:C.GRAPHMATRIXBUBBLECIRCLEMM},{n:mstrmojo.desc(350,"Histogram"),id:"Histogram",mr:H(1,1,true),vt:C.GRAPHMATRIXVERTICALHISTOGRAM},{n:mstrmojo.desc(15411,"Grid Chart"),id:"GridChart",mr:H(0,0),vt:C.GRAPHMATRIXGRIDCHART},{n:mstrmojo.desc(3156,"Box Plot"),id:"BoxPlot",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALBOXPLOT,h:C.GRAPHMATRIXHORIZONTALBOXPLOT}},{n:mstrmojo.desc(5594,"Waterfall"),id:"Waterfall",mr:H(1,1),vt:{v:C.GRAPHMATRIXVERTICALWATERFALL,h:C.GRAPHMATRIXHORIZONTALWATERFALL}}];g.forEach(function(h){h.cls="ngm";h.s=Z;h.wtp=e;});var L={GridChart:{summary:mstrmojo.desc(16057,"Displays data in a tabular format"),example:mstrmojo.desc(16058,"Example: Create directory with customer information and key performance indicators (KPIs)"),requirements:mstrmojo.desc(16059,"Uses 1+ ##attributes### and/or 1+ #metrics###")},BarChart:{summary:mstrmojo.desc(16060,"Uses length to compare data values across categories"),example:mstrmojo.desc(16061,"Example: Compare profit data of different sales teams"),requirements:mstrmojo.desc(16062,"Uses 1+ ##attributes### and 1+ #metrics###")},ClusteredBarChart:{summary:mstrmojo.desc(16060,"Uses length to compare data values across categories"),example:mstrmojo.desc(16061,"Example: Compare profit data of different sales teams"),requirements:mstrmojo.desc(16062,"Uses 1+ ##attributes### and 1+ #metrics###")},LineChart:{summary:mstrmojo.desc(16065,"Uses a line to show the value of a metric over time"),example:mstrmojo.desc(16066,"Example: Show stock prices over the past decade"),requirements:mstrmojo.desc(16067,"Uses 1+ ##attributes### and 1+ #metrics### (time attribute recommended)")},AreaChart:{summary:mstrmojo.desc(16068,"Uses the area within a line chart to show the value of a metric over time"),example:mstrmojo.desc(16069,"Example: Compare the amount of revenue from different sources over time"),requirements:mstrmojo.desc(16067,"Uses 1+ ##attributes### and 1+ #metrics### (time attribute recommended)")},BubbleChart:{summary:mstrmojo.desc(16070,"Uses position, color and size to show relationships and correlations"),example:mstrmojo.desc(16071,"Example: Compare GDP, population and life expectancy for different countries"),requirements:mstrmojo.desc(16072,"Uses 1+ ##attributes### and 2+ #metrics###")},PieChart:{summary:mstrmojo.desc(16073,"Shows the composition of a total value broken by category"),example:mstrmojo.desc(16074,"Example: Compare the proportions of funding sources for a university"),requirements:mstrmojo.desc(16075,"Uses 1+ ##attributes### and 1 #metric###")},ComboChart:{summary:mstrmojo.desc(16076,"Combines a line and bar chart for comparison of metrics with different units"),example:mstrmojo.desc(16077,"Example: Compare monthly precipitation and temperature in a given region"),requirements:mstrmojo.desc(16078,"Uses 1+ ##attributes### and 2+ #metrics###")},Histogram:{summary:mstrmojo.desc(16087,"Uses length to show the frequency of values within given categories/metric ranges"),example:mstrmojo.desc(16088,"Example: Determine the number of employees that fall within a given salary range"),requirements:mstrmojo.desc(16075,"Uses 1+ ##attributes### and 1 #metric###")},BoxPlot:{summary:mstrmojo.desc(16089,"Uses several data points to visualize means, medians, ranges and outliers"),example:mstrmojo.desc(16090,"Example: Show how customer satisfaction scores vary among different survey questions"),requirements:mstrmojo.desc(16091,"Uses 1+ ##attributes### and 1+ #metrics###")},Waterfall:{summary:mstrmojo.desc(16092,"Uses bars and colors to show how categories increase or decrease a metric value"),example:mstrmojo.desc(16093,"Example: Examine how different spending and income categories impact monthly budgeting"),requirements:mstrmojo.desc(16091,"Uses 1+ ##attributes### and 1+ #metrics###")},VIHeatMapVisualizationStyle:{summary:mstrmojo.desc(16063,"Uses rectangles of varying sizes and colors to show hierarchical data"),example:mstrmojo.desc(16064,"Example: Compare sales from different clothing categories at a retail store"),requirements:mstrmojo.desc(16062,"Uses 1+ ##attributes### and 1+ #metrics###")},MapboxVisualizationStyle:{summary:mstrmojo.desc(16079,"Uses Mapbox to visualize data geographically"),example:mstrmojo.desc(16080,"Example: Use layering and clustering features to visualize frequency of earthquakes around the world"),requirements:mstrmojo.desc(16081,"Uses 1+ ##attributes### (including one geographic) and 1+ #metrics###")},NetworkVisualizationStyle:{summary:mstrmojo.desc(16084,"Uses links and nodes to show relationships between data"),example:mstrmojo.desc(16085,"Example: Create a family tree"),requirements:mstrmojo.desc(16086,"Uses 2+ ##attributes### and 1+ #metrics###")},GoogleMapVisualizationStyle:{summary:mstrmojo.desc(16082,"Uses ESRI maps to visualize data geographically"),example:mstrmojo.desc(16083,"Example: Create a density map of world population"),requirements:mstrmojo.desc(16081,"Uses 1+ ##attributes### (including one geographic) and 1+ #metrics###")},KPICardVisualizationStyle:{summary:mstrmojo.desc(16208,"Provides quick performance indications as a single numeric or with an additional trend indicator"),example:mstrmojo.desc(16209,"Example: View daily unique visitor counts for a website over the last month"),requirements:mstrmojo.desc(16075,"Uses 1+ ##attributes### and 1 #metric###")}};var F={BUILT_IN_LIST:1,CUSTOM_LIST:2};function I(k){var l=[],h=mstrConfig.pluginsVisList||{},j=function(m,o,n){n=n||[];o=isNaN(o)?0:parseInt(o,10);if(o>0){n.push({t:m,r:o});}return n;};Object.keys(h).forEach(function(s){var t=h[s],u=t.s,m=t.d,o=t.c,q=o.indexOf(U)!==-1?F.CUSTOM_LIST:F.BUILT_IN_LIST;if(!(k&q)){return ;}if(u===K){t.st.forEach(function(w){var v=O.find(Q,"id",w);if(v>=0){l.push(Q[v]);}});return ;}if(u===Z){if(mstrApp.supportFeature("ngm")){var n=mstrApp.supportFeature("ngmPartial");t.st.forEach(function(w){var v=O.find(g,"id",w);if(v>=0){if(n){if(w==="Waterfall"||w==="Histogram"||w==="BoxPlot"){l.push(g[v]);}}else{l.push(g[v]);}}});}return ;}if(u===d&&!mstrApp.supportFeature("mbx")){return ;}if(u==="VisBuilderNew"&&!mstrApp.isVisBuilder){return ;}if(X.indexOf(o)>=0){return ;}var r=t.desc;if(r){m=mstrmojo.desc(r,"");}var p;if(u===R.KPICARD){p=H(t.mm,t.ma,true);}else{p=j(N,t.ma,j(W,t.mm));}l.push({n:m,s:u,mr:p,id:u,dz:t.dz,vt:B[u],wtp:t.wtp,isNS:t.isNS,pn:t.pn||null});});O.forEach(l,function(m){if(m.id in L){var n=L[m.id];m.summary=n.summary;m.example=n.example;m.requirements=n.requirements;}});return l;}function J(h){return I(F.BUILT_IN_LIST+F.CUSTOM_LIST).filter(function(j){return j.s===h;}).map(function(j){return{s:j.s,vt:j.vt||-1};})[0];}function A(h,j){window.FormWrapper.doVisRemove(h,j);}mstrmojo.vi.ui.VizGalleryList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.vi.ui.VizGalleryList",init:function Y(h){this._super(h);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIGalleryList");this.items=(this.items||[]).concat(I(this.type));},items:null,useRichTooltip:true,itemMarkup:null,type:F.BUILT_IN_LIST,getItemMarkup:function E(h){if(!this.itemMarkup){this.itemMarkup=this._super(h).replace(">{@en@n}<",'><div><div><div class="unsafe-icn"></div></div></div><');}return this.itemMarkup;},getItemProps:function f(k,h){var j=this._super(k,h);j.addCls("ic-"+k.id);if(k.isNS){j.addCls("nonsafe");}if(this.type===F.CUSTOM_LIST){j.addCls(P);}return j;},select:function(k,h){if(!k){return ;}k=O.ensureArray(k);var m=this._removeAll(),o=this._addSelections(k),l;if(this.selectionPolicy!=="reselect"){for(l=m.length-1;l>=0;l--){var n=O.indexOf(o,m[l]);if(n>-1){m.splice(l,1);o.splice(n,1);}}}var j={name:"selectionChange",added:o,removed:m};if(h){if(this.onselectionChange){this.onselectionChange(j);}}else{this.raiseEvent(j);}},showTooltip:function D(t,n){var j=G.eventTarget(n,t);if(j.className.indexOf("unsafe-ic")===-1){return ;}G.stopPropogation(null,t);var p=G.findAncestorByAttr(j,"idx",true,this.domNode),l=p&&p.node,r=l&&l.className.indexOf(P)>-1,v=this.parent,q=r?v&&v.customVizList:v&&v.vizList,u=p&&q&&q.items[p.value],h=u&&u.n;if(!h||h===""){return ;}var m=G.position(l),s=mstrmojo.desc(15365,"Visualizations that use it may display as a grid when this dossier is opened in a context where these plugins are not available."),k=mstrmojo.desc(15364,"## plugin is only available on your local machine.").replace("##",h),o='<div class="name">'+k+'</div><div class="dsc">'+s+"</div>";this.richTooltip={posType:mstrmojo.tooltip.POS_TOPRIGHT,cssClass:"viGallery-tooltip vi-warning nsicn-tooltip vi-regular vi-tooltip-D",content:o,top:m.y-12,left:m.x-7,keepArrowYPos:true};this._super(t,n);},onItemContextMenu:function a(j,h){var k;if(j.pn&&!(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){this.hideTooltip();k=new mstrmojo.ui.menus.MenuConfig({position:mstrmojo.dom.getMousePosition(h.e,h.hWin),isHostedWithin:false});k.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){A(j.id,j.pn);});this.openPopup(k.newInstance());}}});mstrmojo.vi.ui.VizGalleryList.getVizList=I;mstrmojo.vi.ui.VizGalleryList.getVisType=J;mstrmojo.vi.ui.VizGalleryList.VIZ_LIST_TYPE=F;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.xtab.XtabMenuConfig");var A=mstrmojo.rw.xtab.XtabMenuConfig.ACTION_TYPES;mstrmojo.vi.ui.rw.xtab.ViewDataXtabMenuConfig=mstrmojo.declare(mstrmojo.vi.ui.rw.xtab.XtabMenuConfig,null,{scriptClass:"mstrmojo.vi.ui.rw.xtab.ViewDataXtabMenuConfig",buildXtabMenuConfig:function B(C){this._super(C);this.menus=this.menus.filter(function(D){return D.ctxt&&!D.ctxt.isTotals&&(this.isActionAvailable(D.ctxt.data,A.SORT)||this.isActionAvailable(D.ctxt.data,A.PIVOT));},this);},addDrillMenuItem:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.gm.GMEnums","mstrmojo.vi.viz.EnumWidgetTypes","mstrmojo.hash","mstrmojo.vi.models._IsNLPModel");var L=mstrmojo.vi.viz.EnumVizStyles,E=mstrmojo.vi.viz.EnumDSSDropZones,F=mstrmojo.mstr.EnumDSSXMLObjectTypes,A=mstrmojo.mstr.EnumDSSXMLBaseFormType,G=mstrmojo.gm.EnumGraphType,J=mstrmojo.vi.viz.EnumWidgetTypes,D=mstrmojo.vi.models._IsNLPModel.isTimeAttr,B=mstrmojo.hash;var I={KPICardVisualizationStyle:{s:"KPICardVisualizationStyle",dz:"mstrmojo.vi.models.KPICardDropZones",wtp:J.KPICARD},GoogleMapVisualizationStyle:{s:L.GOOGLE_MAP,vt:2,wtp:J.GOOGLEMAP},MapboxVisualizationStyle:{s:L.MAPBOX,wtp:J.MAPBOX},VIHeatMapVisualizationStyle:{s:L.HEAT_MAP,vt:1,wtp:J.HEATMAP},GraphMatrixVisualizationStyle:{s:L.GRAPH_MATRIX,vt:{v:70,h:71},wtp:J.GRAPH_MATRIX},BAR:{s:L.GRAPH_MATRIX,chartType:G.BAR,vt:{v:70,h:71},wtp:J.GRAPH_MATRIX},BUBBLE:{s:L.GRAPH_MATRIX,chartType:G.BUBBLE,vt:21,wtp:J.GRAPH_MATRIX},LINE:{s:L.GRAPH_MATRIX,chartType:G.LINE,vt:{v:72,h:73},wtp:J.GRAPH_MATRIX},PIE:{s:L.GRAPH_MATRIX,chartType:G.PIE,vt:61,wtp:1},NetworkVisualizationStyle:{s:L.NETWORK,vt:58,wtp:J.NETWORK},Grid:{s:"",vt:0,wtp:J.GRID}};function H(R,Q){var O=[],N=[],S=null,P=null;(R||[]).forEach(function(V,U){if(V.t===F.Metric||V.isDM){O.push(V);}else{N.push(V);}if(!P){(V.fs||[]).forEach(function(X){var W=X.fgr;V.lat=W===5?X.fid:V.lat;V.lng=W===6?X.fid:V.lng;});P=(V.lat&&V.lng)?V:P;}if(!S&&D(V)){S=V;}if(Q){Q(V,U);}});return{metrics:O,attributes:N,dateAttr:S,geoAttr:P};}mstrmojo.vi.viz.SmartVisualizationPicker=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.vi.viz.SmartVisualizationPicker",buildVisualization:function(Q,O){var S=Q.items,P=Q.sorts;var N={};if(P&&P.length>0){P.forEach(function(V){N[V.did]=true;});}(S||[]).forEach(function(V){V.useInSort=!!(N[V.did]);});var U=this.getVisualizationStyle(S,O);this.setObjectsDropzone(S,U);var R=this.getVisualizationProperties(S,U);return{objects:S,style:U,widgetProps:R};},mapConfig:null,getVisualizationStyle:function M(V,Q){var N,R=this,P=function P(){return I[B.walk("mapConfig.mapbox.token",R)?L.MAPBOX:L.GOOGLE_MAP];};if(Q&&((Q===L.GOOGLE_MAP)||(Q===L.ESRI_MAP)||(Q===L.MAPBOX))){return P();}if(Q&&Q!==""){return I[Q]||{n:Q,wtp:J.CUSTOM};}var O=H(V),U=O.metrics.length,S=O.attributes.length;if(U===1&&S===0){N=I.KPICardVisualizationStyle;}else{if(U===2&&S===1){N=I.BUBBLE;}else{if(O.geoAttr){N=P();}else{if(O.dateAttr){N=I.LINE;}else{N=I.BAR;}}}}return N;},setObjectsDropzone:function K(a,P){var Y,X,V,U,R,N=function(f,d,h){var g=f[0],e=f[1],c=d&&d[0];if(h){if(g){g.zoneId=E.SizeBy;}if(c){c.zoneId=E.ColorBy;}}else{if(g){g.zoneId=E.ColorBy;}if(e){e.zoneId=E.SizeBy;}}};a=a||[];switch(P.s){case"MapboxVisualizationStyle":Y=H(a,function(c){c.zoneId=E.AdditionalMetrics;});var b=Y.geoAttr;if(b){b.zoneId=E.GeoAttribute;b.usedInDropZones=true;}mstrmojo.array.forEach(Y.metrics,function(c){c.zoneId=9;});break;case"KPICardVisualizationStyle":Y=H(a);U=Y.metrics[0];if(U){U.zoneId=E.Metric;}break;case L.GRAPH_MATRIX:switch(P.chartType){case G.LINE:case G.BAR:var Z=true,Q,O;a.forEach(function(d,c){if(c===0){O=d.isDM&&d.fn?F.Metric:d.t;d.zoneId=E.YAxis;}else{if(Q&&O&&Z&&!d.useInSort){d.zoneId=E.ColorBy;Z=false;}else{if(d.t===O){d.zoneId=E.YAxis;}else{d.zoneId=E.XAxis;Q=d.t;}}}});break;case G.PIE:var W;Y=H(a);V=Y.attributes;R=V[0];if(R){R.zoneId=E.ColorBy;}R=V[1];if(R){R.zoneId=E.XAxis;}for(W=2;W<V.length;W++){V[W].zoneId=E.AdditionalMetrics;}X=Y.metrics;U=X[0];if(U){U.zoneId=E.Angle;}U=X[1];if(U){U.zoneId=E.YAxis;}U=X[2];if(U){U.zoneId=E.SizeBy;}for(W=3;W<X.length;W++){X[W].zoneId=E.AdditionalMetrics;}break;case G.BUBBLE:var S=false;a.forEach(function(c){if(c.t===F.Metric||c.isDM){if(!S){c.zoneId=E.YAxis;S=true;}else{c.zoneId=E.XAxis;}}else{c.zoneId=E.BreakBy;}});break;}break;case L.GOOGLE_MAP:Y=H(a,function(c){c.zoneId=E.AdditionalMetrics;});if(Y.geoAttr){Y.geoAttr.zoneId=E.GeoAttribute;}X=Y.metrics;N(X);break;case L.HEAT_MAP:Y=H(a,function(c){c.zoneId=(c.t===F.Metric)?E.AdditionalMetrics:E.Grouping;});X=Y.metrics;V=Y.attributes;N(X,V,true);break;case L.NETWORK:Y=H(a);V=Y.attributes;R=V[0];if(R){R.zoneId=E.FromItem;}R=V[1];if(R){R.zoneId=E.ToItem;}X=Y.metrics;N(X);U=X[2];if(U){U.zoneId=E.ItemSize;}break;}},getVisualizationProperties:function C(O,N){switch(N.s){case L.GOOGLE_MAP:return'<props><widgetProps><fmt><gtp value="2"/><lm value="1"/><LegendPosition value="2"/><showLegend value="false"/><clgd value="1"/><ls value="false"/><bmt value="1"/><dv value="Topographic Map"/><lx value="0"/><ln value="Layer 1"/><ih value="0"/><ga value=""/><lat value=""/><lng value=""/><cmt value=""/><smt value=""/><tooltip value=""/><elx value="0"/><dlShw value="0"/><dlShwAll value="false"/><dlFntFml value="Arial"/><dlFntSz value="8pt"/><dlFntStyle value="0"/><dlFntClr value="0"/><mtp value="5"/><maxst value="1"/><minst value="1"/></fmt></widgetProps></props>';}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Editor","mstrmojo.vi.viz.SmartVisualizationPicker","mstrmojo.dom","mstrmojo.mstr.EnumDSSEmptyGraphMsgType","mstrmojo.VisEnum","mstrmojo.vi.ui.editors.nlp.SearchBoxWithSuggestion");mstrmojo.requiresDescs(15928);var G=mstrmojo.dom,E=mstrmojo.mstr.EnumDSSEmptyGraphMsgType,H="mstrmojo.vi.ui.rw.VizBox",A=mstrmojo.array,F=1000,O=["kpi","geospatial map","heat map","heatmap","tree map","treemap","map","line","bar","pie","bubble","network"],M=mstrmojo.VisEnum.VIS_CARDLIMIT.NON_GRID;function B(S){if(S&&S.scriptClass===H){var Q=S&&S.boxContent&&S.boxContent.node,R=Q&&Q.data;return R&&(R.egt===E.DssNoTemplateUnit);}return false;}function C(g){var S=new mstrmojo.vi.viz.SmartVisualizationPicker();S.mapConfig=this.model.mapConfig;var Y=this.model.getRelevantObjects(g),Q=false,b,W=S.buildVisualization(Y,Y.visType),V=this.docControl,h=V&&V.model,d=h&&h.getVizContentPanel(),f=false,U="",a=W.objects,c=this;A.forEach(O,function(e){if(g.indexOf(e)!==-1){Q=true;b=e;return false;}});if(d){d.restoreAnyMaxedVizBox();}if(W.objects.length>0){try{var X=false;if(d.firstVizBoxId){if(B(h.getSelectedViUnit())){X=true;}else{A.forEach(d.children,function(e){if(B(e)){X=true;h.selectVIUnit(e.id);return false;}});}}A.forEach(a,function(e){if(e.card>M){f=true;U=e.n;return false;}});var R=function R(k){var e=false,l=false;if(k===true){A.forEach(O,function(m){if(g.indexOf(m)!==-1){e=true;g=g.replace(m,"Grid");l=true;}});if(!l){g=g.replace(/\?+$/,"");g+=" as Grid";}Y=c.model.getRelevantObjects(g);W=S.buildVisualization(Y,Y.visType);}V.createSmartViz(W,Y.datasetId,Y.filter,Y.sorts,g,X);};if(f&&Q){var j=mstrmojo.desc(16281,"The attribute ##  has too many elements. Creating a ### may impact dossier performance. Would you like to show as a grid instead?").replace("##",U).replace("###",b);mstrmojo.warn(j,{},{buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:"Create Grid",onclick:function(){R(true);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:"Create Visualization",onclick:R},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",text:"Cancel",onclick:mstrmojo.emptyFn}],allowHTML:false});}else{if(f&&!Q){R(true);this.close();}else{R();this.close();}}}catch(Z){mstrmojo.error({shortDesc:mstrmojo.desc(15428,"Something went wrong during NLP processing.")});this.close();}}else{mstrmojo.alert(mstrmojo.desc(15429,"Cannot create a visualization based on your search."),undefined,undefined,undefined,undefined,{id:"nlpAlert"});}}mstrmojo.vi.ui.editors.nlp.NLPEditor=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.vi.ui.editors.nlp.NLPEditor",showTitle:false,autoClose:true,cssClass:"NLPEditor",model:null,docControl:null,children:[{scriptClass:"mstrmojo.vi.ui.editors.nlp.SearchBoxWithSuggestion",height:"43px",candidates:null,alias:"searchBox",suggestCount:F,REQUEST_THRESHOLD:F,noCache:true,text:"",searchTriggered:function(R){var Q=this.parent;Q.onSearchTriggered(R);},filterCandidates:function J(Q){return Q;},getCandidatesThroughTaskCall:function(Q,S){var R=this.parent,U=R.model;Q.showSampleQuestion=(this.text||"").trim()==="";S.success({items:U.getSuggestionListItems(Q,F)});}}],_set_visible:function K(S,Q){var R=this;this._close_handler=function(W){var a=G.eventTarget(self,W);var b=R.searchBox,Z=b&&b.suggestionPopup,V=Z&&Z.domNode,Y=mstrmojo.all.nlpAlert,X=Y&&Y.domNode,U=document.body;if(a&&a.parentNode&&!G.contains(R.editorNode,a,true,U)&&!G.contains(V,a,true,U)&&!G.contains(X,a,true,U)){R.close();}};return this._super(S,Q);},onSearchTriggered:function I(Q){C.call(this,Q);},candidates:[],init:function P(Q){this._super(Q);this.themeClassName=this.themeClassName+" nlp-editor";this.searchBox.attachEventListener("quitWatermelon",this.id,function(){this.close();});},onOpen:function D(){var R=this,Q=this.model;Q.checkForMapboxKey();Q.buildWordBase();window.setTimeout(function(){R.searchBox.inputNode.focus();R.searchBox.showSuggestion("");},10);},onClose:function L(){this.searchBox.clearSearch(true);this.searchBox.hideSuggestion();},postBuildRendering:function(){var Q=this;this.onResize=function(){var R=Q.searchBox;R.updateSuggestionPos();};G.attachEvent(window,"resize",this.onResize);this._super();},destroy:function N(Q){if(this.onResize){G.detachEvent(window,"resize",this.onResize);delete this.onResize;}this._super(Q);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Dialog","mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.Box","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui.toolbars.Toolbar","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.ui.rw._IsViewDataGrid","mstrmojo.vi.ui.rw.xtab.ViewDataXtabMenuConfig");mstrmojo.requiresClsP("mstrmojo.vi.models","VIComponentMap");var g=mstrmojo.array,b=mstrmojo.hash,d=mstrmojo.dom,a=mstrmojo.Button.newWebButton,O=mstrmojo.vi.ui.DatasetUnitMenuUtils,L=mstrmojo.vi.models,Z=L.VIComponentMap.TYPES,J=4,D=3,N=10,W,V=function V(k,l){var j=[],m=k.getDatasetUnits(["mx","att"]),h=l&&l.getDropZones();if(h&&h.zones){h.zones.forEach(function(n){n.items.forEach(function(o){if(parseInt(o.did,10)!==-1){j.push(m[g.find(m,"did",o.did)]);}});});}return j;},C=function(j,h,l){var k=V(j,h);return j.getDatasetUnits(["mx","att"],null,l).filter(function(m){return g.find(k,"did",m.did)===-1&&!m.hide;});},I=function I(){var n=this.grid,s=this.model,r=s.getSelectedViUnit(),j=r.boxContent.model.data.datasetId,o=r.getZonesModel(),m=[],k=function(w){w.tooltip=w.n+" ("+w.ds+")";return w;},v=C(s,o,j),q=(v.filter(function(w){return w.t!==4&&!n.model.hasSameRecursiveAttributeGroup(w,n.gridData);})).map(k),u=(v.filter(function(w){return w.t===4;})).map(k),l=function(w){var x={};(w||[]).forEach(function(AA,z){if(g.find(V(s,n.zonesModel),"did",AA.did)>-1){x[z]=true;}});return x;},t=function(w){return(w||[]).filter(function(x){return !x.hide||x.usedInDropZones;});},h=function(w){w.unshift({t:"All",formType:3,n:mstrmojo.desc(4928,"All"),tooltip:"Select All Objects"});return w;};function p(z,w){w=t(w);w=h(w);if(w.length){var x=new mstrmojo.ui.CheckList({cssClass:"units",allIdx:0,items:w.map(function(AA){AA.tt=AA.n+" ("+AA.ds+")";AA.css=O.getUnitCssClass(AA);return AA;}),selectedIndices:l(w)});m.push({scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:z,children:[x],getSelectedItems:function(){var AA=x.getSelectedItems();if(AA.length>0&&AA[0].t=="All"){AA.shift();}return AA||[];}});}}p(mstrmojo.desc(3581,"Attributes"),O.getSortedDatasetUnits(q));p(mstrmojo.desc(3582,"Metrics"),O.getSortedDatasetUnits(u));return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"mstrmojo-ui-Menu visible datasetObjects",contents:m,hostId:this.id,fnOk:function(){var AB=[],AH,AD,w=n.zonesModel,z=w.getDropZones().zones,AF=z[1],AI=z[0],AC=[],x=AF.items.length+1,AG=AI.items.length+1,AA=V(w.docModel,w),AE=V(s,o);m.forEach(function(AJ){AB=AB.concat(AJ.getSelectedItems());});AH=(AB||[]).filter(function(AJ){return g.find(AA,"did",AJ.did)===-1;});AD=(AA||[]).filter(function(AJ){if(AJ.did==="-1"){return false;}return g.find(AB,"did",AJ.did)===-1&&g.find(AE,"did",AJ.did)===-1;});AH.forEach(function(AJ){AC.push(n.model.getAddTemplateUnitAction(AJ,j,(AJ.t===4?AF:AI).id,AJ.t===4?x++:AG++));});AD.forEach(function(AJ){AC.push(n.model.getRemoveTemplateUnitAction(AJ));});n.controller.onSubmitTemplateUpdates(n,AC);}});},M=function(k,l,h){return{success:function m(o){var n=mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.ViewDataDialog",grid:o,model:k,isViewFilter:l,showUnits:h});n.set("visible",true);n.render();},failure:function j(n){throw {message:"Couldn't open view data dialog <br>("+(n.message||"")+")",name:"Something went wrong"};}};},E=function(j){var h=mstrApp.isInVFConfigMode?Z.FILTER_STACK:Z.VIZ_CONTENT;return mstrApp.rootCtrl.docCtrl.view.builder.getLayoutVIMap(j.getCurrentLayoutKey()).getComponent(h).selectedKey;},A,S=function S(h){if(h&&mstrmojo.dom.isMetaKey(null,h)&&h.keyCode===65&&A){A.selectAll();return false;}return true;},K=function K(j){var k=mstrApp.isSingleTier,h=mstrApp.isWorkstation&&mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode();if(mstrApp.isInVFConfigMode){return ;}if((k||!!mstrApp.features["web-export-to-excel-privilege"])&&!h){j.push({n:mstrmojo.desc(3958,"Excel"),v:J});}if(k||!!mstrApp.features["web-export-to-pdf-privilege"]){j.push({n:mstrmojo.desc(1877,"PDF"),v:D});}if(k||!!mstrApp.features["web-export-to-csv-privilege"]){j.push({n:mstrmojo.desc(11807,"Data"),v:N});}};B=function B(h){return{scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",alias:"toolbar",useRichTooltip:true,visible:h.showUnits};};F=function F(h){var j=this;return{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-export-type",alias:"exportType",value:mstrmojo.desc(13287,"Export Data"),isHostedWithin:true,items:h,visible:h.length>0&&f(A)>0,onitemSelected:function(k){this.selectedNode.innerHTML=mstrmojo.desc(121,"Export Data");j.xport(k.v);}};};X=function X(){var h=this;return{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-addGridButton mstrmojo-WebHoverButton",text:mstrmojo.desc(11893,"Add as Grid"),onclick:function(){h.close(true);},bindings:{visible:function(){return mstrApp.allowWebDashboardDesign();},enabled:function(){return !mstrApp.isLayoutModePreview();}}};};Y=function Y(){return{scriptClass:"mstrmojo.Label",alias:"rowCount",cssClass:"mstrmojo-rowcount",text:""};};U=function U(n,k){var o=B(n),j=X.call(this),m=F.call(this,k),h=Y(),l=[o,j,m,h];if(mstrApp.isInVFConfigMode||mstrApp.isAppStatePresentation()){l.splice(1,1);}return l;};f=function f(h){var j=h.gridData;return b.walk("rw.row.tc",j)||0;};mstrmojo.vi.ui.ViewDataDialog=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.ViewDataDialog",title:mstrmojo.desc(11476,"Show Data"),help:"Show_Data_dialog_box.htm",cssClass:"mstrmojo-ViewDataDialog",modal:true,visible:false,btnAlignment:"right",init:function c(k){var j=k.grid,l=this,h=[];this.grid=j;j.viewDataDialog=this;A=j;j.openPopup=function(){};j.model.canShowCellMenu=function(m){var n=j.model.getCellDataUnion(m);return !!m&&(n.length===0||(n.length===1&&!n[0].eid));};this.set("buttons",[a(mstrmojo.desc(2177,"Close"),function(){l.close();})]);K.call(this,h);k.children=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-toolBox",alias:"tools",children:U.call(l,k,h),slot:"containerNode"},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-gridBox",children:[j],slot:"containerNode"}];d.attachEvent(document.body,"keydown",S);this._super(k);},postBuildRendering:function e(){this._super();var j=this.tools.exportType;if(j.visible){j.list.popupConfig.clear();}var h=document.createElement("textarea");h.className="hiddenArea";h.onblur=function(){h.focus();h.select();};this.editorNode.appendChild(h);this.grid.hiddenField=h;},openXtabCellMenu:function R(h){var k=mstrApp.rootCtrl.document,j=new mstrmojo.vi.ui.rw.xtab.ViewDataXtabMenuConfig({isHostedWithin:false,position:h.cmPos||d.position(h.btn.domNode),hostId:this.id});j.buildXtabMenuConfig(b.copy({tabularGrid:true,hideAdvancedSort:true},h));if(j.hasMenuItems()){h.opener=this;k.openPopup(j.newInstance(),h);}},closePopup:function(){var h=mstrApp.rootCtrl.document;if(h){h.closePopup();}},close:function Q(k){var j=this;d.detachEvent(document.body,"keyup",S);A=null;if(mstrApp.isAppStatePresentation()){this.model.controller.startAutoRefresh();}this.model.removeViewDataGrid(this.grid,!!k,W,{failure:function h(l){throw {name:"Something went wrong.",message:"Couldn't close view data dialog <br>("+(l.message||"")+")"};}});j.destroy();},xport:function P(j){var h=this.model.controller;switch(j){case N:h.exportCSV(this.grid.k);break;default:h.exportVisualization(this.grid,j);}},updateToolbar:function H(j){var m=this,k=this.model,o=k.getSelectedViUnit(),n=o.boxContent.model.data.datasetId,h=o.getZonesModel(),l=C(k,h,n);j.btns.push({n:mstrmojo.desc(11780,"Add Data"),cls:"add "+(!!mstrApp.isWSStyling?"mojo-theme-light":"mojo-theme-dark")+" mstrmojo-Button mstrmojo-WebButton"+(l.length===0?" disabled":""),fn:function(q,p){if(l.length!==0){p.openMenu(I.call(m),q);}}});return j;},passToolbarCfg:function G(h){this.tools.toolbar.set("toolbarCfg",h);},oncontextmenu:function(h){d.preventDefault(window,h.e);return false;},updateToolbarChildren:function(h){this.tools.rowCount.set("text",h);if(f(A)>0){this.tools.exportType.set("visible",true);}}});mstrmojo.vi.ui.ViewDataDialog.openDS=function(h,k,j){W=h.createViewDataGrid(h.getDatasetUnits(["mx","att"],null,j),h.getCurrentLayoutKey(),null,M(h,false,false),j);};mstrmojo.vi.ui.ViewDataDialog.openDSTable=function(h,l,j,k){W=h.createViewDataGrid(h.getDatasetUnits(["mx","att"],null,j,k),h.getCurrentLayoutKey(),null,M(h,false,false),j);};mstrmojo.vi.ui.ViewDataDialog.open=function(s,p){var n=s.getDocModel(),o=n.controller;if(o.autoRefReqSent){mstrApp.serverProxy.cancelRequest(o.autoRefReqId);}o.pauseAutoRefresh();s.selectVIUnit();var h=s.boxContent,t=h.isVisMap,j=t&&h.getXtabForSelection()?h.getXtabForSelection():h,m=j.model,u=m.data,r=s.getZonesModel(),l=t?r.getDropZones(true,j.k):r.getDropZones(),k=(h.getContextMenuSelections&&h.getContextMenuSelections())||{},q,v=function v(){W=n.createViewDataGrid(null,E(n),q,M(n,p,true),null,j,l);};if(p){q=m.getSelectorDataFromTemplateLimit(u.tpl)||[];q=q.concat({keepOnly:true,data:k});v();}else{v();}};}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui._HasScroller","mstrmojo.util.ui._HostsSplitter","mstrmojo.vi.ui._HasMask","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.models.DropZonesModel","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.tooltip","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.models.EnumDragSources");mstrmojo.requiresClsP("mstrmojo.vi.ui","_IsViPanel","VizGalleryList","CollapsibleTitleBar");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates","EnumVizStyles","EnumWidgetTypes");mstrmojo.requiresDescs(114,517,518,1143,1995,7696,7697,11790,14813,10833,13521,14119);var g=mstrmojo,C=g.vi.viz,N=g.dom,E=g.css,AB=g.string,z=C.EnumWidgetTypes,V=z.GRID,Q=C.EnumVisualizationTemplates,h=mstrmojo.array,t=mstrmojo.vi.ui.VizGalleryList,w=t.VIZ_LIST_TYPE,L=mstrmojo.vi.enums.EnumFeatures,r=mstrmojo.vi.models.EnumDragSources;var n={n:mstrmojo.desc(114,"Grid"),id:"VisGrid",summary:mstrmojo.desc(16057,"Displays data in a tabular format"),example:mstrmojo.desc(16058,"Example: Create directory with customer information and key performance indicators (KPIs)"),requirements:mstrmojo.desc(16059,"Uses 1+ ##attributes### and/or 1+ #metrics###"),vt:Q.GRID},b="custom",Z="none",c="https://community.microstrategy.com/s/gallery";function B(){if(mstrApp.isSingleTier&&!(mstrApp.supportFeature(L.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode())){return new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy();}return new mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy();}function AC(AG,AI,AJ){var AF=AI.getSelectedViUnit(),AL=AF&&AF.getZonesModel(),AM=['<div><span class="vi-name">{@n}</span>'+(AJ?'<div class="vi-tooltip-icn icn-tooltip-{@id}"></div>':"")],AN=[],AQ={};if(AL&&AG){AG.forEach(function(AU){var AT=AU.t,AV=AU.r,AW=!!AU.s,AS=AL.getRequiredItemsInfo(AT),AR={12:mstrmojo.desc(13429,"# more ##attributes###"),4:mstrmojo.desc(13431,"# more ##metrics###"),"long":mstrmojo.desc(13433,"# more ##longitudes###"),lat:mstrmojo.desc(13435,"# more ##latitudes###"),sglmtc:mstrmojo.desc(15668,"# ##metric###")};if(AS<AV){AN.push(AR[AW?"sglmtc":AT].replace("###","</span><br/>").replace("##",'<span class="type'+AT+'">').replace("#",AV-AS));}else{AQ["t"+AT]=AV;}});if(!AN.length){var AK=AQ["t"+12],AP=AQ["t"+4],AO=[mstrmojo.desc(13436,"# attribute and ## metric"),mstrmojo.desc(13437,"# attribute and ## metrics"),mstrmojo.desc(13438,"# attributes and ## metric"),mstrmojo.desc(13439,"# attributes and ## metrics"),mstrmojo.desc(13440,"# attribute"),mstrmojo.desc(13441,"# attributes"),mstrmojo.desc(13442,"## metric"),mstrmojo.desc(13443,"## metrics")],AH=-1;if(AK&&AP){AH=Math.min(AK-1,1)<<1|Math.min(AP-1,1);}else{if(AK){AH=3+Math.min(AK,2);}else{if(AP){AH=5+Math.min(AP,2);}}}if(AH!==-1){AN.push(AO[AH].replace("##",AP).replace("#",AK));}}}if(AN.length){AN=['<span class="vi-reqs">'].concat(AN).concat(["</span>"]);}AM=AM.concat(AN);AM.push("</div>");return AM.join("");}function AD(){var AF=this.model.getSelectedViUnit();return !AF||!(AF instanceof mstrmojo.vi.ui.rw.VizBox);}function p(){this.set("isMasked",AD.call(this));var AF=this.model.getVizOfSelectedViUnit();this.selectViz(AF&&AF.id,AF&&AF.s);}function J(AF){var AG=AF.added,AH=AG&&this.items[AG[0]];if(AH){this.parent.model.changeSelectedVisType(AH.s||"",AH.vt,AH.wtp||V,AH.dz);}}function X(AF){var AG=AF&&AF.src&&AF.src.data;return AG&&AG.src;}mstrmojo.vi.ui.VizGallery=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsViPanel,mstrmojo.ui._HasScroller,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState,mstrmojo.util.ui._HostsSplitter,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.VizGallery",markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-VIGallery {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VIGallery-handle splitter v"></div><div class="mstrmojo-VIPanel-titlebar"></div><div class="mstrmojo-VIGallery-contents"><div class="mstrmojo-VIGallery-builtInLabel"></div><div class="mstrmojo-VIGallery-builtinVizList"></div><div class="mstrmojo-VIGallery-divider"></div><div class="mstrmojo-VIGallery-galleryLabel"></div><div class="mstrmojo-VIGallery-customVizList"></div><div class="mstrmojo-VIGallery-importCustomVizButton"></div></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{handleNode:function R(){return this.domNode.firstChild;},titlebarNode:function AA(){return this.domNode.childNodes[1];},containerNode:function Y(){return this.domNode.childNodes[2];},builtInLabelNode:function W(){return this.domNode.childNodes[2].childNodes[0];},builtinVizListNode:function K(){return this.domNode.childNodes[2].childNodes[1];},dividerNode:function d(){return this.domNode.childNodes[2].childNodes[2];},galleryLabelNode:function S(){return this.domNode.childNodes[2].childNodes[3];},customVizListNode:function a(){return this.domNode.childNodes[2].childNodes[4];},importCustomVizBtnNode:function s(){return this.domNode.childNodes[2].childNodes[5];},maskNode:function P(){return this.domNode.lastChild;}},layoutConfig:{h:{titlebarNode:"0px",containerNode:"100%"},xt:true},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},init:function x(AH){if(!!mstrApp.isWSStyling){this.layoutConfig={h:{titlebarNode:"28px",containerNode:"100%"},xt:true};}this._super(AH);mstrApp.features=mstrApp.features||{};var AI=this.id,AF=mstrApp.features.ngm,AG=mstrApp.features.ngmPartial;this.toolbar=this.titleBar;B().getSavedPreferences({success:function AJ(AK){function AL(){if(AF!==mstrApp.features.ngm||AG!==mstrApp.features.ngmPartial){if(mstrmojo.all[AI]){mstrmojo.all[AI].update();}}}if(mstrApp.updateFeatureFlag){mstrApp.updateFeatureFlag(AK,AL);}}.bind(this)});this.model.attachEventListener("viUnitSelected",this.id,p);},useRichTooltip:true,preview:false,DEFAULT_WIDTH:60,DEFAULT_LEFT_MARGIN:7,vizList:null,customVizList:null,model:null,title:g.desc(10833,"Gallery"),titleBar:null,titlebarNode:null,handleNode:null,ttpContentMarkup:'<div class="vi-rich-gallery-tooltip"><div class="vi-tooltip-name name">{@n}</div><div class="vi-tooltip-desc dsc">{@summary}</div><div class="vi-tooltip-example dsc">{@example}</div><div class="vi-tooltip-requirement dsc">{@requirements}</div></div>',onAppStateChange:function k(AF){this._super(AF);this.set("isMasked",AD.call(this)||mstrApp.isAppStateSelection());},setOpenStatus:function G(AG,AF,AJ,AH){this._super(AG,AF,AJ,AH);if(!AF){var AI=mstrApp.rootCtrl.docCtrl.view.layoutViewer;AI.boxLayoutConfig.setVizGalleryOpen(this.visible);AI.saveBoxLayout(undefined,undefined,undefined,AJ);}},children:[{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",slot:"titlebarNode",alias:"titleBar",editTitleOnDoubleClick:false,close:function q(){},onclick:function(){},bindings:{title:"this.parent.title"}},{scriptClass:"mstrmojo.Label",text:g.desc(14119,"Built-in"),slot:"builtInLabelNode",cssClass:"galleryLabel builtInLabel"},{scriptClass:"mstrmojo.vi.ui.VizGalleryList",slot:"builtinVizListNode",alias:"vizList",selectionPolicy:"reselect",type:w.BUILT_IN_LIST,items:[n],postselectionChange:function A(AF){this.parent.customVizList.clearSelect();J.call(this,AF);}},{scriptClass:"mstrmojo.Widget",markupString:"<div class='separator'></div>",slot:"galleryLabelNode"},{scriptClass:"mstrmojo.Label",text:g.desc(13521,"Custom"),slot:"galleryLabelNode",cssClass:"galleryLabel"},{scriptClass:"mstrmojo.vi.ui.VizGalleryList",slot:"customVizListNode",alias:"customVizList",type:w.CUSTOM_LIST,selectionPolicy:"reselect",items:[],postselectionChange:function A(AF){this.parent.vizList.clearSelect();J.call(this,AF);}},{scriptClass:"mstrmojo.Button",slot:"importCustomVizBtnNode",cssClass:"importVizButton",onclick:function(){var AF=N.position(this.domNode),AG=this.domNode.parentNode;AF.x=AF.x+4;AF.y=AF.y+3.65;E.addClass(AG,"clicked");var AH=new mstrmojo.ui.menus.MenuConfig({position:AF,isHostedWithin:false,menuCssClass:"importVizMenu"});AH.addMenuItem(mstrmojo.desc(14736,"Import Visualization..."),"",function(){window.FormWrapper.importCustomVisualization();});AH.addSeparator();AH.addMenuItem(mstrmojo.desc(14691,"Browse Gallery..."),"",function(){window.FormWrapper.openPage(c);});this.parent.openPopup(AH.newInstance(),{onClose:function(){E.removeClass(AG,"clicked");}});}}],postBuildRendering:function U(){var AF=this.handleNode;AF.style.display="block";this.registerSplitter(AF);if(!mstrApp.isSingleTier||(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){this.importCustomVizBtnNode.style.display=Z;if(this.customVizList.items.length===0){this.dividerNode.style.display=Z;this.galleryLabelNode.style.display=Z;this.customVizListNode.style.display=Z;}}return this._super();},updateToolbar:function l(AF){AF.isHostedWithin=false;AF.addMenuItem(mstrmojo.desc(1143,"Help"),"help",function(){mstrApp.showHelpTopic("viz_gallery.htm");});return this._super(AF);},selectViz:function O(AH,AG){var AF=-1;this.vizList.clearSelect();this.customVizList.clearSelect();(this.vizList.items||[]).forEach(function(AJ,AI){if(AJ.id===AH&&(!AG||AG===AJ.s)){AF=AI;return true;}});if(AF>-1){this.vizList.select([AF]);}else{if((AF=h.find(this.customVizList.items,"id",AH))>-1){this.customVizList.select([AF]);}}},setDimensions:function m(AL,AG){this._super(AL,AG);var AK=parseInt(AG,10),AJ=this.titlebarNode,AI=AJ&&AJ.style;if(AI){AI.display=AK<2*(this.DEFAULT_WIDTH-this.DEFAULT_LEFT_MARGIN)?"none":this.cssDisplay;}var AH=this.handleNode,AF=AH&&AH.style;if(AF){AF.top=0;AF.right=AG;AF.height=AL;AF.width="6px";}},getSplitterInfo:function v(){return{isReverseMove:true,min:this.DEFAULT_WIDTH,max:(this.DEFAULT_WIDTH-this.DEFAULT_LEFT_MARGIN)*3+this.DEFAULT_LEFT_MARGIN+4};},splitterMoved:function M(AF){var AL="width",AG=parseInt(this[AL],10),AK=0,AH=AF/this.DEFAULT_WIDTH,AJ=parseInt(AH),AI=Math.abs(AH%1);if(AI>0.25){AK=(AF>0)?1:-1;}AJ+=AK;if(AJ!==0){AG+=(this.DEFAULT_WIDTH-this.DEFAULT_LEFT_MARGIN)*AJ;this.set(AL,AG+"px");}this.parent.doLayout();},splitterMouseDown:function H(){this.domNode.parentNode.previousSibling.style.pointerEvents="none";},splitterMouseUp:function F(){this.domNode.parentNode.previousSibling.style.pointerEvents="inherit";},update:function f(AG){if(mstrApp.getRecentGallery){mstrApp.getRecentGallery(AG);}this.vizList.set("items",[n].concat(t.getVizList(w.BUILT_IN_LIST)));this.customVizList.set("items",t.getVizList(w.CUSTOM_LIST));var AF=this.model.getVizOfSelectedViUnit();this.selectViz(AF&&AF.id,AF&&AF.s);this.cleanUpListeners();this.updateScrollbars(true);},showTooltip:function AE(AS,AN){var AP=N.findAncestorByAttr(N.eventTarget(AN,AS),"idx",true,this.domNode),AI=AP&&AP.node,AR=AI&&AI.className.indexOf(b)>-1,AQ=AR?this.customVizList:this.vizList,AT=AP&&AI.className.indexOf("mnu")===-1&&AQ.items[AP.value],AF=AT&&AT.n,AH=AT&&AT.id;if(!AF||AF===""){return ;}var AL=N.position(AI),AO="";if(AT.summary&&AT.example&&AT.requirements){var AG='<span class="icon vi-tooltip-metricIcon">',AK='<span class="icon vi-tooltip-attrIcon">',AJ=AT.requirements.replace(/###/g,"</span>").replace("##",AK).replace("#",AG);AO=AB.apply(this.ttpContentMarkup,{n:AF,summary:AT.summary,example:AT.example,requirements:AJ});}else{AO=AB.apply(AC(AT.mr,this.model,this.preview),{n:AF,id:AH});}if(!AO){return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPRIGHT,cssClass:"viGallery-tooltip vi-regular vi-tooltip-D"+(this.preview?" preview":""),content:AO,top:AL.y-12-(this.preview?56:0),left:AL.x-7,keepArrowYPos:true,updatePosition:function AM(){this.domNode.style.top="-100000px";this.domNode.style.left="-100000px";g.Tooltip.prototype.updatePosition.call(this);}};this._super(AS,AN);},setupScrollNodes:function o(){this.scrollNode=this.containerNode;},updateScrollbars:function u(AF){this._super();if(AF){this.addScrollNodeProperties();}},cleanUpListeners:function j(){h.forEach(this.installedEventListeners,function(AF){N.detachEvent(AF.e,AF.evt,AF.fn);});},allowDrop:function I(AG){var AF=[r.VIZ_EDITOR];return AF.indexOf(X(AG))>-1;},ondrop:function e(AF){if(X(AF)===r.VIZ_EDITOR){var AG=AF&&AF.src&&AF.src.data;AG.onRemove(AG.items&&AG.items.length>1?AG.items:AG.item);}},getDropAvatarIcon:function D(AF){return X(AF)===r.VIZ_EDITOR?"remove":"move";}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.Button","mstrmojo.vi.models.editors.EditorModel","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.models.FormatModel","mstrmojo.ui.ScrollableTextArea");var E=mstrmojo.string,B=mstrmojo.models.FormatModel;var F="url",D="htmlText";var A=[{n:mstrmojo.desc(4555,"iFrame"),v:0,id:0},{n:mstrmojo.desc(4554,"Html Text"),v:1,id:1}];function G(H,I,N,J){var M=this.getHost(),L=M.parent,K=function(O){B.updateFormatBlock(H,I,O);if(!L.parent){L=this.getHost().parent;}L.clearSlotBackgroundCSS("domNode");L.applyCSSFormatToNode("domNode",H);L.selectVIUnit(true);};this.docModel.saveUnitFormatProperty(L,[{formatType:undefined,propertyName:I,newValue:N,oldValue:J}],{success:K.bind(this,N,J)},mstrmojo.DocDataService.SUPPRESS_DATA,{silent:true,undo:K.bind(this,J,N),redo:K.bind(this,N,J)});}mstrmojo.vi.models.editors.HtmlContainerEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.HtmlContainerEditorModel",help:"format_panel_html_container.htm",getEditorContents:function C(){if(!mstrApp.allowWebDashboardDesign()||(!mstrApp.isSingleTier&&!mstrmojo.resolveFeature("create-html-container"))){return[];}var H=this.id,O=this.getHost(),J=O.node.data,N=O.parent,L=N.getHintText(),M=O.getFormats(),K=new mstrmojo.ui.editors.controls.ContainerGroup({showBackgroundNoFill:false,showBackgroundGradient:true,showBorderNoFill:false,onGroupValueChange:function(Q,S,R){G.call(mstrmojo.all[H],M,Q,S,R);}}),I=N.htmlType;K.setFormatSource(M);return[this.getEditorGroup([this.getButtonBar(A,I,function(R){var Q=R.v,S=this.parent.textArea;S.set("emptyText",L[Q]);S.value=N.defn[Q?D:F];S.refresh();},{alias:"typeBtn",showIcon:false,cssClass:"htmlTypeBtn"}),{scriptClass:"mstrmojo.ui.ScrollableTextArea",alias:"textArea",cssClass:"htmlText",value:E.decodeHtmlString(J.rv||J.v),emptyText:L[I],maxLength:undefined,keepEmpty:true,onfocus:function P(){N.setDefaultTextCaretPosition(this.inputNode,this.emptyText);if(this.inputNode.value===this.emptyText){this.scrollNode.scrollTop=35;}}},mstrmojo.Button.newWebButton(mstrmojo.desc(8708,"OK"),function(){var Q=this.parent;N.updateHtmlBox(Q.typeBtn.selectedItem.v,Q.textArea.value);N.hideControlOverlay();},true)]),this.getEditorGroup([K])];}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.EditorModel","mstrmojo.ui.editors.CharacterToolbarPopup","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.hash");var C=mstrmojo.models.FormatModel,E=C.ENUM_PROPERTY_NAMES;mstrmojo.vi.models.editors.TextEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.TextEditorModel",help:"format_panel_text.htm",getEditorContents:function D(){var R=this.getHost(),N=R.getFormats(),F=R.quillInstance;if(F){try{var O=F.getFormat();if(R.cacheGProps){N["background-color"]=R.cacheGProps;}N.font="";if(!O.size){N.font="10pt 'Arial'";}else{var U=(O.size).replace(/\D/g,"");N.font=U+"pt 'Arial'";}var V=R.stringsOfFonts,L=R.arrayOfFonts;if(O.font){var I=L.indexOf(O.font);if(I>-1){if(N.font.includes("'Arial'")){var K=(N.font).replace("Arial",V[I]);N.font=K;}else{var P=(N.font).split(" ");for(var G=0;G<P.length;G++){if(P[G].includes("pt")&&(""+P[G]).length<=4){N.font=P[G]+" "+V[I];}}}}}if(O.bold&&!(N.font).includes("bold")){N.font="bold "+N.font;}if(O.color){N.color=O.color;}else{N.color="#000000";}if(O.italic===true&&!(N.font).includes("italic")){N.font="italic "+N.font;}if(O.underline===true){N["text-decoration"]="underline";}else{N["text-decoration"]="";}if(O.strike===true&&!(N["text-decoration"]).includes("line-through")){N["text-decoration"]="line-through "+N["text-decoration"];}if(O.align==="left"){N["text-align"]="left";}else{if(O.align==="center"){N["text-align"]="center";}else{if(O.align==="right"){N["text-align"]="right";}else{if(O.align==="justify"){N["text-align"]="justify";}else{if(!O.align){N["text-align"]="left";}}}}}}catch(J){}}var S=this.getChangeGroupPropertyFn(),Q=new mstrmojo.ui.editors.controls.CharacterGroup({onGroupValueChange:S,showNoFillInColor:false}),M=this,H=new mstrmojo.ui.editors.controls.ContainerGroup({showBackgroundNoFill:false,showBackgroundGradient:true,showBorderNoFill:false,onGroupValueChange:function(){M.getHost().parent.clearCache();S.apply(null,arguments);}});if(!mstrApp.allowWebDashboardDesign()){return[];}Q.setFormatSource(N);H.setFormatSource(N);return[this.getEditorGroup([Q]),this.getEditorGroup([this.getTextAlign(N["text-align"]||"left",this.getChangeFormatPropertyFn(E.TEXT_ALIGN)),this.getWrapText(N["white-space"]!=="nowrap",this.getChangeFormatPropertyFn(E.TEXT_WRAP)),this.getTextDirection(N.fx&&N.fx.rt,this.getChangeFormatPropertyFn(E.TEXT_DIRECTION)),this.getOverflow(N.overflow==="auto",this.getChangeFormatPropertyFn(E.TEXT_OVERFLOW))]),this.getEditorGroup([H])];},getChangeFormatPropertyFn:function B(F,G){var H=this.id;return function(O,K){var L=mstrmojo.all[H],N=L.getHost().parent,J=L.docModel,I=[{formatType:G||1,propertyName:F,newValue:O,oldValue:K}],M=L.getHost();if(M.isQuill){if(M.hlText){M.renderRVText();M.formatHlText(I);M.parent.hideControlOverlay();M.updatedirCachDel();M.onUnselected();}else{M.processLocalFormat(I);}}else{J.saveUnitFormatProperty(N,I,{success:function(R){if(!(N&&N.parent)){N=J.getSelectedViUnit();}var Q=N.parent,S=N.k,P=N.boxContent;J.partialUpdate(null,J.getTargetDefn(S),R.defn,[S]);P.update(P.node);N.refresh();Q.selectVIUnit(N,true);}},mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION);}};},getFormattingToolbar:function A(F,I,G){var H=new mstrmojo.ui.editors.CharacterToolbarPopup(mstrmojo.hash.copy({onGroupValueChange:this.getChangeGroupPropertyFn(),anchorElement:I},G));H.setFormatSource(this.getHost().getFormats());return H;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.EditorModel","mstrmojo.models.FormatModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.vi.ui.TextAlignButtonBar","mstrmojo.ui.editors.CharacterToolbarPopup","mstrmojo.array","mstrmojo.hash","mstrmojo.VisEnum");var B=0,I=mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS,W=mstrmojo.models.FormatModel,H=W.ENUM_PROPERTY_NAMES.TEXT_ALIGN,L=mstrmojo.hash,X=B,P=B,K=mstrmojo.VisEnum.SERVER_JSON_ERROR_TYPE;function M(d,Y,a,e,b){var Z=d===this.getTitleFormatCode(),c;if(a===H){c=function(f){return this.titleAlignButtonBar.items.filter(function(g){return g.v===f;})[0].id;}.bind(this);}this.getHost().parent.changeUnitFormats(Z,d,Y,a,e,b,c,function(f){this.raiseEvent({name:"BEMFormatChange",propertyName:a,value:f,isTitle:Z});}.bind(this));}function U(Z,a){var Y=new mstrmojo.vi.ui.TextAlignButtonBar({includeJustify:false});this.titleAlignButtonBar=Y;Y.singleSelect(Y.items.map(function(b){return b.id;}).indexOf(Z));Y.onValueChange=function(c,b){a(H,c,b);};return Y;}function C(a){var d=this.getHost().getFormats(),g=d.ttl,e=[];if(g){var b=this,Y=M.bind(this,this.getTitleFormatCode(),d),f=this.getHost(),Z=f.parent.getTitleBarVisibility(),c=[this.getCharacterGroup(Y,g),U.call(this,W.getFormatBlockValue(g,H),Y),this.getContainerGroup(g,Y,I.FILL_COLOR,{showBackgroundNoFill:false})];c.forEach(function(h){h.set("enabled",Z);});e.push(this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(4756,"Title")),this.getCheckboxAndLabel(Z,mstrmojo.desc(13599,"Show titlebar"),function(j){var h=b.getHost();if(h){h.parent.toggleTitleBar(!!j);}})].concat(c),{cssClass:"bem-tc-title",showDivider:false}));}e.push(this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(11917,"Container")),this.getContainerGroup(d,M.bind(this,1,d),this.getContainerCtrlFlags(),{showBackgroundNoFill:false,showBorderNoFill:false})],{cssClass:"bem-tc-container"}));this.replaceChildControls(a,e.concat(this.getTitleAndContainerControls()));}function D(Y){var a=this.getTargetPulldownItems(Y);var Z=this.getPulldown(a,function(b){if(a.length>1){X=b;}else{X=P;}a[a.map(function(c){return c.v;}).indexOf(b)].h(b);if(Y&&Y.postUpdateFn){Y.postUpdateFn();}});if(Z.items&&Z.items.length){Z.set("selectedIndex",Math.max(a.map(function(b){return b.v;}).indexOf(X),0));}return Z;}mstrmojo.vi.models.editors.BaseEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.BaseEditorModel",titleAlignButtonBar:null,init:function Q(Y){this._super(Y);P=this.getInitialTarget(X);X=P;},selectTargetByValue:function N(Y){if(Y!==undefined){var Z=this._targetPulldown;if(Z){Z.selectItemByField("v",Y);}}},getInitialTarget:function V(){return B;},getEditorContents:function R(Y){var Z=this.getEditorGroup([],{cssClass:"bem-dynamic-grp",showDivider:false,isNested:true,isContainer:true,postUpdateFn:Y});var b=this._targetPulldown=D.call(this,Z),a=[Z].concat(this.getCommonControls());if(b.items.length>1){a.unshift(this.getEditorGroup([b]));}this.addDisposable(b);return a;},getFormattingToolbar:function F(Z,e,a){if(Z===B){var d=this.getHost(),Y=d.getFormats(),c=Y.ttl;if(c){c=L.copy(c);c[H]=this.titleAlignButtonBar.items.filter(function(f){return f.id===c["text-align"];})[0].v;var b=new mstrmojo.ui.editors.CharacterToolbarPopup(L.copy({onGroupValueChange:M.bind(this,this.getTitleFormatCode(),Y),textAlignJustify:false,textAlignFmtName:H,anchorElement:e},a));b.setFormatSource(c);return b;}}return null;},getCommonControls:function E(){return[];},getContainerCtrlFlags:function A(){return I.FILL_COLOR+I.BORDER;},getTitleAndContainerControls:function S(){return[];},getTargetPulldownItems:function G(Z){var b=this.getHost(),Y=b.getFormats(),a=[];if(Y&&(b.showTitleAndContainerFormats!==false)&&!mstrApp.isInVFConfigMode){a.push({n:mstrmojo.desc(12049,"Title and Container"),v:B,h:C.bind(this,Z)});}return a;},getTitleFormatCode:function J(){return 2;},isNormalOrExcludeAllDataButNotInPauseMode:function O(a){var Y=!a.isEmpty()||a.errorType===K.EMPTY_DATA,Z=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();return Y&&!Z;}});mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE=B;}());(function(){mstrmojo.requiresCls("mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.num","mstrmojo.Button","mstrmojo.TextBox","mstrmojo.models.FormatModel","mstrmojo.vi.ui.rw.DocImage","mstrmojo.vi.models.editors.EditorModel","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.vi.ui.ImageEditorPanelImagePicker");mstrmojo.requiresDescs(12057,13580,12059,12060,14552);var J=mstrmojo.vi.ui.rw.DocImage.EnumSizeModes,U=J.FIXED,I=J.FIT_TO_CONTAINER,M=J.FILL_CONTAINER,E=J.STRETCH,F=mstrmojo.dom,S=mstrmojo.boxmodel.px2Inches,V=mstrmojo.models.FormatModel,L=V.ENUM_PROPERTY_NAMES,Q=mstrmojo.num;var N=[{n:mstrmojo.desc(12057,"Fixed to"),v:U},{n:mstrmojo.desc(13580,"Fit to container"),v:I},{n:mstrmojo.desc(12059,"Fill container"),v:M},{n:mstrmojo.desc(12060,"Stretch"),v:E}];function H(g,h){var k=g.model,j=k.getZoomProps(),e=[].concat(h),d=function(m,o){var n,l;for(n=0,l=e.length;n<l;n++){if(e[n].propertyName===m){return e[n][o];}}},Z=function(l){if(l!==undefined){l=typeof l==="number"?l:Q.parseNumeric(l);return(l*j.zf*j.dpi).toFixed();}return NaN;},a=function(l){return{ih:Z(d("ih",l)),iw:Z(d("iw",l)),ism:d("ism",l),lock:d("lockAspectRatio",l)};},W=a("oldValue"),X=a("newValue"),f=g.parent,Y=f.parent.k,c=f.k,b=function(o){var n=k.getCurrentLayoutKey(),m=k.getLayoutUnitDefn(c,n),l=k.getPanel(Y,n);if(!m){return ;}if(o.ih!==undefined){m.ih=o.ih+"px";}if(o.iw!==undefined){m.iw=o.iw+"px";}if(o.ism!==undefined){m.ism=o.ism;}if(o.lock!==undefined){m.lock=o.lock;}l.selectVIUnit(l.rebuildChild(l.getUnitByKey(c)),true);};k.saveUnitFormatProperty(f,e,{success:b.bind(this,X)},mstrmojo.DocDataService.SUPPRESS_DATA,{undo:b.bind(this,W),redo:b.bind(this,X)});}function O(f,j){var g=f.model.getZoomProps(),c=f.getImageWidth(),d=f.getImageHeight(),Y=function(k){if(typeof j[k]!=="undefined"&&isNaN(j[k])){j[k]=(k==="iw")?parseInt(c):parseInt(d);}};Y("iw");Y("ih");var a=f.getCalculatedImageDimensions(j),e=a.h,h=a.w,Z=j.mode,b=[{formatType:1,propertyName:L.IMAGE_HEIGHT,newValue:S(g,e===undefined?d:e),oldValue:S(g,d)},{formatType:1,propertyName:L.IMAGE_WIDTH,newValue:S(g,h===undefined?c:h),oldValue:S(g,c)}];if(Z!==U){var W=f.defn.lock,X=Z!==E;if(X!==W){b=b.concat({formatType:1,propertyName:L.LOCK_ASPECT_RATIO,newValue:X,oldValue:W});}}return b;}function G(W){return O(W,{mode:J.ORIGINAL});}function B(X,W){return new mstrmojo.TextBox({value:X,valueChangeDelay:3000,onvalueChange:W,onkeydown:function(Y){if(Y.e.keyCode===13){this.blur();}}});}function K(){var W=this.getHost();var X=W.v;if(W.parent.isEmbedded){X=W.parent.embeddedImageName;}return B(X,function Y(){var Z=this.value;if(Z!==X){W.parent.urlEdited(Z);}});}function R(){var X=this.getHost();var Z=X.v;if(X.parent.isEmbedded){Z=X.parent.embeddedImageName;}var W=new mstrmojo.vi.ui.ImageEditorPanelImagePicker();W.slot="col1Node";W.imageBox=X.parent;var b=mstrmojo.Button.newWebButton(mstrmojo.desc(1442,"OK"),function(){X.parent.urlEdited(a.value);},false,{alias:"okBtn",slot:"col2Node",enabled:false});var Y=new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:"50%",col2Width:"50%",children:[W,b]});var a=new mstrmojo.TextBox({value:Z,hint:mstrmojo.desc(14552,"Enter an image URL or choose a file."),onvalueChange:function(){var d=this.value;var c=!mstrmojo.string.isEmpty(d)&&(d!==Z);Y.okBtn.set("enabled",c);Y.okBtn.set("iconClass",c?"hot":"");},onkeydown:function(c){if(c.e.keyCode===13){if(Y.okBtn.enabled===true){Y.okBtn.onclick();}else{this.blur();}}}});return this.getEditorGroup([a,Y]);}function A(){var X=this.getHost(),Y=X.getSizeMode(),W=Math.max(N.map(function(Z){return Z.v;}).indexOf(Y),0);return this.getLabelAndControl(mstrmojo.desc(9735,"Size:"),this.getPulldown(N,function(a,Z){var b={mode:a,lock:X.isAspectRatioLocked()};H(X,O(X,b).concat({formatType:1,propertyName:L.IMAGE_SIZE_MODE,newValue:a,oldValue:Z}));},W));}function C(){var X=this.getHost(),Y=function Y(c,a){var b={mode:X.getSizeMode(),lock:X.isAspectRatioLocked()};b[c]=parseFloat(a);H(X,O(X,b));},W=this.getLabelAndControl("X:",B(X.getImageWidth(),function(a){Y(L.IMAGE_WIDTH,a.value);}),"20%","70%"),Z=this.getLabelAndControl("Y:",B(X.getImageHeight(),function(a){Y(L.IMAGE_HEIGHT,a.value);}),"30%","70%");W.slot="col1Node";Z.slot="col2Node";W.cssClass=Z.cssClass="dim-input";Z.cssClass+=" y";return new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:"50%",col2Width:"50%",children:[W,Z],visible:X.getSizeMode()===U});}function D(){var X=this.getHost(),a=X.getSizeMode(),Z=a===I||a===M,W=a===E,b=Z?true:(W?false:X.isAspectRatioLocked()),Y=this.getCheckboxAndLabel(b,mstrmojo.desc(13639,"Lock aspect ratio"),function(d){var c=[{formatType:1,propertyName:L.LOCK_ASPECT_RATIO,newValue:d,oldValue:!d}];c=c.concat(O(X,{lock:d}));H(X,c);});Y.enabled=!Z&&!W;return Y;}mstrmojo.vi.models.editors.ImageEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.EditorModel,null,{scriptClass:"mstrmojo.vi.models.ImageEditorModel",help:"format_panel_image.htm",getChangeFormatPropertyFn:function(W,X){var Y=this.id;return function(b,Z){var e=mstrmojo.all[Y],d=e.docModel,j=e.getHost().parent,a=j.parent,f=j.k,h="domNode",g=[{formatType:X||1,propertyName:W,newValue:b,oldValue:Z}],c=function(m){var l,k;d.partialUpdate(m.data,d.getTargetDefn(f),m.defn,[f]);l=a.rebuildChild(a.getUnitByKey(f));k=l.defn.fmts;a.selectVIUnit(l,true);l.clearCache();l.clearSlotBackgroundCSS(h);l.applyCSSFormatToNode(h,k);};d.saveUnitFormatProperty(j,g,{success:c.bind(j)},mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION);};},getEditorContents:function P(){var c=this.getHost(),a=c.getFormats(),Y=mstrmojo.Button.newWebButton(mstrmojo.desc(12061,"Restore to Original Size"),function(){H(c,c.getSizeMode()===U?G(c):G(c).concat({formatType:1,propertyName:L.IMAGE_SIZE_MODE,newValue:U,oldValue:c.getSizeMode()}));}),Z=this.getChangeGroupPropertyFn(),d=!!c.v||!!c.oid,b={showDivider:false,enabled:d,shouldPropagateEnabled:true};if(!mstrApp.allowWebDashboardDesign()){return[];}var X=!!mstrApp.enableEmbeddedImages&&!F.isIE9;var W=X?[R.call(this)]:[this.getEditorGroup([K.call(this)])];return W.concat([this.getEditorGroup([A.call(this)],{showDivider:X,enabled:d,shouldPropagateEnabled:true}),this.getEditorGroup([C.call(this)],b),this.getEditorGroup([D.call(this)],b),this.getEditorGroup([Y],b),this.getEditorGroup([this.getContainerGroup(a,function(){c.parent.clearCache();Z.apply(null,arguments);},NaN,{showBackgroundNoFill:false,showBackgroundGradient:true,showBorderNoFill:false})])]);}});}());(function(){mstrmojo.requiresClsP("mstrmojo","css","array","desc","dom","string");mstrmojo.requiresCls("mstrmojo.ui.List","mstrmojo.ui._HasScroller","mstrmojo.ui._IsHierarchyList","mstrmojo.ui._IsIncFetchHierarchyList","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui._IsDraggableList","mstrmojo.elementHelper");mstrmojo.requiresDescs(15595);var a=mstrmojo.css,O=mstrmojo.array,K=mstrmojo.desc,G=mstrmojo.dom,D=mstrmojo.string,Z=mstrmojo.elementHelper;var e="dragIn";var c="hidden",U="selected",Y="iconRA-expanded",H="iconRA-collapsed",M="hierarchy",Q="hasChildren",L="d",A="x";var S="u;",g=10;function X(h){var h=Z.terseLong2OldShort(h)||"",j=h.split(":");return j.slice(j.length-2).join(":");}mstrmojo.vi.ui.IncHierarchyList=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._HasUnitListAvatar2,mstrmojo.vi.ui._IsDropTarget,mstrmojo.ui._IsHierarchyList,mstrmojo.ui._IsIncFetchHierarchyList,mstrmojo.vi.ui._IsDraggableList],{scriptClass:"mstrmojo.vi.ui.IncHierarchyList",cssClass:"mstrmojo-IncHierarchyList",getItemMarkup:function E(k,h){var j;if(k.fetcher){j=this._super(k,h);}else{j='<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><div class="content"><span class="indent" style="padding-left: {@indent}px;"></span><span class="raBtn {@epdsts}"></span><span class="text">{@en@n}</span></div><div class="btn {@disabled}">'+D.encodeHtmlString(K(15595,"Set Parent"))+"</div></{@tag}>";}return j;},isParentElement:function N(k){var j=k&&k.v,h=this.getCurrentPE();return h&&X(h.v)===j;},getItemProps:function d(l,h){var k=this._super(l,h);if(this.isHiearachyDisplay()){k.epdsts=l.hcd?(l.epd?Y:H):"";}k.disabled=!this.canSetAsParent(l)?L:"";var j=this.getExcludeList();if(j&&j[l.v]){k.addCls(A);l.x=true;}return k;},canSetAsParent:function b(h){return !this.isParentElement(h)&&!h.ln;},onclick:function f(j){var m=j.getTarget(),p=this.getItemNodeFromTarget(m),k=this.getItemFromTarget(m);if(!k){return ;}if(a.hasClass(m,"raBtn")){if(k.hcd){this.doExpandCollapse(p,k);}}else{if(a.hasClass(m,"btn")&&this.canSetAsParent(k)){var o=this.getCurrentPE(),l=X(o&&o.v),h=this.itemMap[l],n=h&&this._getItemNode(h.idx);this.handleSetParent(k);a.toggleClass(n&&n.getElementsByClassName("btn")[0],L,h&&!this.canSetAsParent(h));a.toggleClass(p.getElementsByClassName("btn")[0],L,true);}else{this._super(j);}}j.cancel();},oncontextmenu:function V(h){G.preventDefault(window,h.e);},toggleCollapseExpandCss:function P(k,h){var j=k.getElementsByClassName("raBtn")[0];a.toggleClass(j,H,!h);a.toggleClass(j,Y,h);},getSelectedItems:function J(){var h=this._super();return O.filter(h,function(j){return !j.x;});},processContinuousSelection:function R(l,k,j){var m,h,o=this._shiftStartIndex,n=this.selectedIndices;O.forEach(this.itemsContainerNode.children,function(q){var p=parseInt(q.getAttribute("idx"));if(p===j||p===o){if(!m){m=true;}else{h=true;}}if(m&&!q.classList.contains("x")&&!q.classList.contains("hidden")&&!this.items[p].fetcher&&!n[p]){l.push(p);}return !(m&&h);},this);},handleSetParent:mstrmojo.emptyFn,getExcludeList:mstrmojo.emptyFn,getCurrentPE:mstrmojo.emptyFn,isDragValid:function C(j){var h=this._super(j);if(h&&this.isDraggingItem(j)){if(this.isItemDraggable(j.src.node)){var k=this.getItemFromTarget(j.src.node);if(!this.selectedIndices[k.idx]){this.doItemSelect(k,{});j.src.data.items=[k];j.src.data.item=k;}return true;}else{return false;}}return h;},adjustPosition:mstrmojo.emptyFn,isDraggingItem:function I(h){var j=G.findAncestorByAttr(h.src.node,"idx",true,this.itemsContainerNode);return j&&j.node.className.indexOf("item")>=0;},isItemDraggable:function B(h){if(h){return !this.isFetcher(h)&&!this.isExcluded(h);}},isExcluded:function F(h){if(h instanceof HTMLElement){h=this.getItemFromTarget(h);}return h&&h.x;},ondrop:function W(h){a.removeClass(this.domNode,e);this.processDrop(h);h.src.data.isDropSuccess=true;},processDragStart:mstrmojo.emptyFn,processDrop:mstrmojo.emptyFn,processDragEnd:mstrmojo.emptyFn,});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.UnitList","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo._CanHandleTwoClicks");mstrmojo.requiresDescs(629,6424);var I=mstrmojo.desc,F=mstrmojo.dom,J=mstrmojo.hash,B=mstrmojo.string,L="mnu",C="clsx",O="icn "+L+"_sub",M="icn "+C+"_sub",R;function Q(S,V,U){return function(){V.style.overflow=S?"visible":"hidden";if(U){U();}};}mstrmojo.vi.ui.InteractiveUnitList=mstrmojo.declare(mstrmojo.vi.ui.UnitList,[mstrmojo.vi.ui._HasUnitListAvatar,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._CanHandleTwoClicks],{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:true,panelId:"",useRichTooltip:true,hasTooltipContent:function(U,V){var S=this.getLabelNode(V);return S.scrollWidth>S.clientWidth;},getItemTooltip:function(e,V,b){var c=this.getLabelNode(V);if(this.hasTooltipContent(e,V)){var W=F.position(c),Y=e.desc?e.desc:e.dsc,d=(this.zonesModel||{}).docModel,U,a='<div class="name">'+B.encodeHtmlString(e.n,true)+"</div>"+(e.objectNameinDataset?('<div class="dsc">'+B.encodeHtmlString(mstrmojo.desc(15112,"Name in Dataset:")+" "+e.objectNameinDataset,true)+"</div>"):"");if(e.dsName){U=e.dsName;}else{if(e.datasetId){U=d&&d.datasets&&d.datasets[e.datasetId].name;}else{if(e.id){var Z=d&&d.getObjectInfo(e.id),X=Z&&d.findDatasetIdFromUnit(Z.did);U=d&&d.datasets&&X&&d.datasets[X].name;}}}a+=(U?'<div class="dataset">'+B.encodeHtmlString(mstrmojo.desc(8502,"Dataset")+": "+U,true)+"</div>":"")+(Y?'<div  class="dsc">'+B.encodeHtmlString(Y,true)+"</div>":"");var S={areaId:e._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:a,top:W.y-6,left:W.x,enableHover:true};return S;}return null;},showTooltip:function D(S,W){var V=S.target||F.eventTarget(S.hWin,S.e),U=this.getItemFromTarget(V);if(U&&U.n){var X=this.getItemNodeFromTarget(V);this.richTooltip=this.getItemTooltip(U,X,V);if(this.richTooltip){this._super(S,W);}}},getItemMarkup:function E(S){if(!R){R=this._super(S).replace(">{@en@n}",'><span class="txt" unselectable="on">{@en@n}</span><div class="'+L+'"><div title="'+I(6424,"Menu")+'" class="'+O+'"></div></div><div class="'+C+'"><div class="'+M+'"></div></div>').replace("<{@tag}",'<{@tag} unselectable="on" ');}return R;},getLabelNode:function N(S){return S.getElementsByClassName("txt")[0];},ondblclick:function H(S){var V=S.getTarget(),W=this.getItemNodeFromTarget(V),U=(F.findWidget(W)===this)&&this.getItemFromTarget(V);if(!!U){S.cancel();this.doubleClickItem(U);}},onItemContextMenu:function P(W,U){var Y=U.getTarget();if(W){this.closePopup();var S=mstrmojo.all[this.panelId],V=S&&S.getPanelSelectedItems&&S.getPanelSelectedItems(),X=V&&V.length>1;this[X?"showMultiSelectionMenu":"showItemMenu"](X?V:W,this.getItemNodeFromTarget(Y),F.getMousePosition(U.e,U.hWin));return true;}},configurePopup:function K(S,X,W,V){mstrmojo.all[this.panelId].addPopupHandlers(S);var U=X.parentNode;S.addPopupHandlers("iulMenuOverflow",Q(true,U,W),Q(false,U,V));S.hostId=this.id;S.isHostedWithin=false;S.hostElement=X;},showItemMenu:mstrmojo.emptyFn,showMultiSelectionMenu:mstrmojo.emptyFn,deleteItem:mstrmojo.emptyFn,doubleClickItem:mstrmojo.emptyFn,twoClicksItem:mstrmojo.emptyFn,onTwoClicks:function(S){if(S.firstTarget==S.secondTarget){var U=this.getItemFromTarget(S.secondTarget);S.cancel();if(!!U){this.twoClicksItem(U,S);}}},isDragValid:function A(S){return !isNaN(parseInt(S.src.node.getAttribute("idx"),10))||this._super(S)||false;},getSelectedItems:function G(){var W=this,S=this.items,V=null,U=[];J.forEach(this.selectedIndices,function(Y,X){V=S[X];if(Y&&V){V=J.copy(V);V.ulist=W;V.itemNode=W._getItemNode(V._renderIdx);U.push(V);}});return U;}});mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_MENU="has-m";mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_X="has-x";}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.UnitList","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.vi.models.EnumDragSources","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.vi.ui.DatasetUnitMenuUtils");var L=mstrmojo.array,K=mstrmojo.dom,B=mstrmojo.func,F=mstrmojo.hash,J=mstrmojo.vi.ui.DatasetUnitMenuUtils,D="tbl",P="dmaList";function I(Y,W,Q){var R=this,U=this.setting&&this.setting.table&&this.setting.table(W.did);return({scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:W.n,tableId:W.did,dataset:Y,tabelsWidget:this,ignoreLayout:false,showTitleBarContextMenu:true,level:R.level+1,getLayoutOffsets:function(){return{h:0,w:0};},setting:U,isCollapsed:U?!!(U.getCollapsed()):false,onclick:function(Z){if(K.contains(this.titleBar.leftToolNode,Z.getTarget(),true,this.domNode)){R.onTableCollapsedChange(this.tableId,this.isCollapsed);}},updateToolbar:function V(Z){Z.hostId=this.id;Z.isHostedWithin=false;Z.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.ctxt.titleBar.editTitle();},this);return Z;},postCreate:function S(){var Z=this;R.attachEventListener("toggleAllCollapsed",this.id,function(a){if(a.isRecover){Z.togglePortlet(Z.setting?Z.setting.getCollapsed():Z.defaultCollapsed?Z.defaultCollapsed:false);}else{if(a.changeSetting){Z.setting.isCollapsed=a.isCollapsed;}Z.togglePortlet(a.isCollapsed);}});},layoutConfig:(!!mstrApp.isWSStyling)?{h:{titlebarNode:"26px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true}:{h:{titlebarNode:"20px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},getTitleBarCfg:function X(){var Z=this.constructor.prototype.getTitleBarCfg.call(this),a=this;return F.copy({editTitleOnDoubleClick:true,titleEdited:function c(e,g,d){if(g){var f=function(){a.titleBar.set("title",d);},h=function(){var j=a.parent.parent.docModel;j.warnForEditStandaloneDS(Y.set,function(){j.renameEmmaSrcTable(W.did,Y.id,e.trim(),B.wrapMethods(j.getDatasetsUpdateCallback()),{failure:function(k){mstrApp.onerror(k);a.titleBar.set("title",d);}});},f);};J.validateName(e,h,f);}},updateTooltipConfig:function b(e){var f=e.target||K.eventTarget(e.hWin,e.e);if(f.scrollWidth<=f.clientWidth){this.richTooltip=null;}else{var d=K.position(this.domNode);this.richTooltip={content:this.getTooltipContent(e),posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:d.y-2,left:d.x+d.w+6};}}},Z);},children:[{alias:"tulist",scriptClass:this.unitListScriptClass,draggable:false,panelId:this.panelId,docModel:this.docModel,bindings:{filterScope:"this.parent.tabelsWidget.filterScope",filterExpr:"this.parent.tabelsWidget.filterExpr",level:"this.parent.level + 1"},postCreate:function S(){this.doubleClickItem=B.composite([this.doubleClickItem,mstrmojo.all[this.panelId].doubleClickItemHandler]);},dataset:Y,getAllItems:function(){return[].concat(W.att).concat(W.mx);},onitemsChange:function(){this.parent.set("visible",!!this.items.length);}}]});}function O(){var V=this.dataset,R=[];L.forEach(V.set.tables,function(Y,X){R.push(I.call(this,V,Y,X));},this);var U=this.tbl;var W=[].concat(U.children||[]);U.removeChildren();W.forEach(function(X){X.destroy();});U.addChildren(R);U.children.forEach(function(X){X.doLayout();});if(!this[P]){this.addChildren({alias:P,scriptClass:this.unitListScriptClass,draggable:false,dataset:V,docModel:this.docModel,panelId:this.panelId,bindings:{filterScope:"this.parent.filterScope",filterExpr:"this.parent.filterExpr",level:"this.parent.level + 1"},postCreate:function S(){this.doubleClickItem=B.composite([this.doubleClickItem,mstrmojo.all[this.panelId].doubleClickItemHandler]);},getAllItems:function Q(){return[].concat(V.set.att).concat(V.set.mx).filter(function(X){return J.isDocumentLevelItem(X);});}});}}mstrmojo.vi.ui.DatasetTables=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout],{layoutConfig:{w:{containerNode:"100%"},xt:true}});mstrmojo.vi.ui.DatasetTableView=mstrmojo.declare(mstrmojo.Box,[mstrmojo.vi.ui._HasUnitListAvatar,mstrmojo._HasLayout],{scriptClass:"mstrmojo.vi.ui.DatasetTableView",layoutConfig:{w:{containerNode:"100%"},xt:true},markupMethods:{ondatasetChange:function A(){O.call(this);},onfilterExprChange:function(){var Q=false;Q=this[D].children.some(function(R){return !!R.tulist.items.length;})||!!(this[P].items&&this[P].items.length);this.emptyIndicator.set("visible",!Q);}},draggable:true,avatarCssClass:"mstrmojo-VIUnitList",dataset:null,unitListScriptClass:"",docModel:null,panelId:"",setting:{},onTableCollapsedChange:mstrmojo.emptyFn,children:[{alias:"emptyIndicator",cssClass:"emptyIndicator",scriptClass:"mstrmojo.Label",bindings:{text:function(){if(!this.visible){return"";}return this.parent.filterExpr?mstrmojo.desc(11904,"No matched object"):mstrmojo.desc(11905,"No object");}}},{alias:D,scriptClass:"mstrmojo.vi.ui.DatasetTables"}],getTableWidgets:function H(){return this[D].children||[];},toggleAllNodesCollapsed:function G(Q,S,R){this.raiseEvent({name:"toggleAllCollapsed",isCollapsed:Q,changeSetting:S,isRecover:R});},getSelectedItems:function C(){var Q=this[P];return this[D].children.reduce(function(R,S){L.forEach(S.tulist.getSelectedItems(),function(U){if(L.find(R,"did",U.did)<0){R.push(U);}});return R;},[]).concat(Q.getSelectedItems());},clearSelect:function(){this[D].children.forEach(function(Q){Q.tulist.clearSelect();});this[P].clearSelect();},isDragValid:function M(Q){return !isNaN(parseInt(Q.src.node.getAttribute("idx"),10))||this._super(Q)||false;},ondragstart:function E(S){var U=null,R=this[P],Q=function(V){return K.contains(V.domNode,S.src.node,true,V.domNode);};L.forEach(this[D].children,function(W){var V=W.tulist;if(Q(V)){U=V;return false;}});if(!U&&Q(R)){U=R;}if(U){U.selectDragNode(S);}this._super(S);},getDragData:function N(Q){var R=this._super(Q);R.item=R.items&&R.items[0];R.dsid=this.dataset.id;R.src=mstrmojo.vi.models.EnumDragSources.DATASETS;return R;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.UnitList","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.vi.models.EnumDragSources","mstrmojo._HasMarkup","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.vi.ui.DatasetUnitMenuUtils");var U=mstrmojo.hash,G=mstrmojo.dom,Z=mstrmojo.func,H=mstrmojo.vi.ui.DatasetUnitMenuUtils,Y=mstrmojo._HasMarkup.addMarkupMethods,O="dimensions",V="metricFolder",M="folders",J="metrics",Q="levels",L="derivedObjects",d="multiLevelHierarchies",b="singleLevelHierarchies",F="recursiveAttributes",P="_emptyIndicator";function C(n,h){var l=U.copy(h,{scriptClass:n.unitListScriptClass,treeContext:n,docModel:n.docModel,panelId:n.datasetsPanelId,_isUnitList:true,postCreate:function k(){this.doubleClickItem=Z.composite([this.doubleClickItem,n.doubleClickItemHandler]);},onallItemsChange:function j(){this.reloadItems();},getAllItems:function g(){return this.allItems||[];},isEmpty:function m(){return !(this.items&&this.items.length);}});l.bindings=U.copy(h.bindings,{dataset:function(){var o=this.treeContext.dataset;return o&&{id:o.did,set:o};},filterScope:"this.treeContext.filterScope",filterExpr:"this.treeContext.filterExpr",filterFunc:"this.treeContext.filterFunc",level:"this.parent.level + 1"});return l;}function a(h,g){return U.copy(g,{scriptClass:"mstrmojo.vi.ui.MDXTreeNodeList",treeContext:h});}function A(h,g){return U.copy(g,{treeContext:h});}mstrmojo.vi.ui._IsMDXTreeComponent=mstrmojo.provide("mstrmojo.vi.ui._IsMDXTreeComponent",{treeContext:null,data:null,setting:null,isEmpty:function S(){return this.getRealChildren().every(function(g){return g.isEmpty();});},isRealChild:function D(g){return !g.ignoredChild;},getRealChildren:function I(){return(this.children||[]).filter(this.isRealChild,this);},getSelectedItems:function K(){return this.getRealChildren().reduce(function(g,h){return g.concat(h.getSelectedItems());},[]);},clearSelect:function f(){this.getRealChildren().forEach(function(g){g.clearSelect();});}});mstrmojo.vi.ui.MDXTreePortletNode=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo.vi.ui._IsMDXTreeComponent],{scriptClass:"mstrmojo.vi.ui.MDXTreePortletNode",ignoreLayout:false,getLayoutOffsets:function(){return{h:0,w:0};},handleDataChange:mstrmojo.emptyFn,init:function X(g){var h=this;this._super(g);this.treeContext.view.attachEventListener("toggleAllCollapsed",this.id,function(j){if(j.isRecover){h.togglePortlet(h.setting?h.setting.getCollapsed():h.defaultCollapsed?h.defaultCollapsed:false);}else{if(j.changeSetting){h.setting.isCollapsed=j.isCollapsed;}h.togglePortlet(j.isCollapsed);}});},isRealChild:function D(g){return g.alias!=="titleBar"&&this._super(g);},onCollapsedChange:function(){this.treeContext.view.onNodeCollapsedChange(this);}});Y(mstrmojo.vi.ui.MDXTreePortletNode,{ondataChange:function W(){this.handleDataChange();}});mstrmojo.vi.ui.MDXTreeNodeList=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsMDXTreeComponent],{scriptClass:"mstrmojo.vi.ui.MDXTreeNodeList",treeContext:null,data:null,createChildConfig:null,layoutConfig:{w:{containerNode:"100%"},xt:true}});Y(mstrmojo.vi.ui.MDXTreeNodeList,{ondataChange:function W(){this.destroyChildren();this.addChildren((this.data||[]).map(this.createChildConfig,this));}});mstrmojo.vi.ui.MDXDimension=mstrmojo.declare(mstrmojo.vi.ui.MDXTreePortletNode,null,{scriptClass:"mstrmojo.vi.ui.MDXDimension",handleDataChange:function N(){var h=this.data,g=[],j=[];if(h.recursiveAtt&&h.recursiveAtt.length>0){(h.recursiveAtt||[]).forEach(function(k){g.push(k);});}else{(h.hierarchies||[]).forEach(function(k){j.push(k);});}this[d].set("data",j);this[F].set("allItems",g);},init:function X(g){var h=this;this._super(g);this.addChildren([a(this.treeContext,{alias:d,createChildConfig:function(k){var j=h.setting&&h.setting.hierarchy&&h.setting.hierarchy(k.did);return A(this.treeContext,{scriptClass:"mstrmojo.vi.ui.MDXHierarchy",title:k.n,data:k,setting:j,defaultCollapsed:true,isCollapsed:j?!!(j.getCollapsed()):true,level:h.level+1});}}),C(this.treeContext,{alias:F})]);}});mstrmojo.vi.ui.MDXHierarchy=mstrmojo.declare(mstrmojo.vi.ui.MDXTreePortletNode,null,{scriptClass:"mstrmojo.vi.ui.MDXHierarchy",init:function X(g){this._super(g);this.addChildren([C(this.treeContext,{alias:Q,bindings:{allItems:"this.parent.data.att"}})]);}});mstrmojo.vi.ui.MDXMetricFolder=mstrmojo.declare(mstrmojo.vi.ui.MDXTreePortletNode,null,{scriptClass:"mstrmojo.vi.ui.MDXMetricFolder",init:function X(g){var h=this;this._super(g);this.addChildren([a(this.treeContext,{alias:M,bindings:{data:"this.parent.data && this.parent.data.folders"},createChildConfig:function(j){var k=h.setting&&h.setting.folder&&h.setting.folder(j.n);return A(this.treeContext,{scriptClass:"mstrmojo.vi.ui.MDXMetricFolder",title:j.n,data:j,setting:k,defaultCollapsed:true,isCollapsed:k?!!(k.getCollapsed()):true,level:h.level+1});}}),C(this.treeContext,{alias:J,bindings:{allItems:"this.parent.data.mx"}})]);}});function R(){var g=function(){if(this.isEmpty){var j=this.isEmpty();this.set("visible",!j);if(!j){var h=this.getRealChildren&&this.getRealChildren();if(h&&h.length){h.forEach(function(k){g.call(k);});}}}};this[P].set("visible",this.isEmpty());this.getRealChildren().forEach(function(h){g.call(h);});}mstrmojo.vi.ui.DatasetMDXView=mstrmojo.declare(mstrmojo.Box,[mstrmojo._HasLayout,mstrmojo.vi.ui._HasUnitListAvatar,mstrmojo.vi.ui._IsMDXTreeComponent],{scriptClass:"mstrmojo.vi.ui.DatasetMDXView",draggable:true,avatarCssClass:"mstrmojo-VIUnitList",data:null,unitListScriptClass:"",docModel:null,datasetsPanelId:"",layoutConfig:{w:{containerNode:"100%"},xt:true},onNodeCollapsedChange:mstrmojo.emptyFn,init:function X(h){this._super(h);var j=this;var k=this.treeContext=new mstrmojo.Model({view:this,docModel:this.docModel,datasetsPanelId:this.datasetsPanelId,unitListScriptClass:this.unitListScriptClass,bindings:{dataset:"this.view.data",table:"this.dataset && this.dataset.tables && this.dataset.tables[0]",filterExpr:"this.view.filterExpr",filterScope:"this.view.filterScope",filterFunc:"this.view.filterFunc"},doubleClickItemHandler:mstrmojo.all[this.datasetsPanelId].doubleClickItemHandler});var g=j.setting&&j.setting.rootMetricFolder;this.addChildren([a(k,{alias:O,bindings:{data:"this.treeContext.table && this.treeContext.table.dimensions",visible:'this.treeContext.filterScope !== "mx"'},createChildConfig:function(m){var l=j.setting&&j.setting.dimension&&j.setting.dimension(m.did);return A(this.treeContext,{scriptClass:"mstrmojo.vi.ui.MDXDimension",data:m,title:m.n,setting:l,defaultCollapsed:true,isCollapsed:l?!!(l.getCollapsed()):true,level:j.level+1});}}),A(this.treeContext,{alias:V,scriptClass:"mstrmojo.vi.ui.MDXMetricFolder",bindings:{data:"this.treeContext.table && this.treeContext.table.metricFolder",visible:'this.treeContext.filterScope !== "att"'},title:mstrmojo.desc(14007,"Measures"),setting:g,isCollapsed:g?!!(g.getCollapsed()):false,level:j.level+1}),C(k,{alias:L,bindings:{allItems:function(){var l=this.treeContext.dataset;return l&&[].concat(l.att).concat(l.mx).filter(function(m){return H.isDocumentLevelItem(m);})||[];}}})]);},markupMethods:{onfilterExprChange:function(){if(this.hasRendered){R.call(this);}}},onRender:function(){this._super();R.call(this);},toggleAllNodesCollapsed:function e(g,j,h){this.raiseEvent({name:"toggleAllCollapsed",isCollapsed:g,changeSetting:j,isRecover:h});},children:[{alias:P,cssClass:"emptyIndicator",scriptClass:"mstrmojo.Label",ignoredChild:true,bindings:{text:function(){if(!this.visible){return"";}return this.parent.filterExpr?mstrmojo.desc(11904,"No matched object"):mstrmojo.desc(11905,"No object");}}}],isDragValid:function B(g){return !isNaN(parseInt(g.src.node.getAttribute("idx"),10))||this._super(g)||false;},ondragstart:function c(g){var j=g.src.node;var h=G.findWidget(j);while(h&&h!==this){if(h._isUnitList&&h.treeContext===this.treeContext){h.selectDragNode(g);break;}h=h.parent;}return this._super(g);},getDragData:function E(g){var h=this._super(g);h.item=h.items&&h.items[0];h.dsid=this.data.id||this.data.did;h.src=mstrmojo.vi.models.EnumDragSources.DATASETS;return h;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo.TreeBrowserNode","mstrmojo.TreeBrowser","mstrmojo.TreeBrowserSelector","mstrmojo.DynamicClassFactory","mstrmojo._HasLayout","mstrmojo.ObjectBrowserDataProvider","mstrmojo.ui._HasScroller","mstrmojo.ui.SearchBox","mstrmojo.ui._HasUITheme","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui._IsViPanel","mstrmojo.vi.ui.UnitList","mstrmojo.vi.ui._HasUnitListAvatar","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui.CollapsibleTitleBar","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.css","mstrmojo.vi.ui.theme");var G=mstrmojo.DynamicClassFactory,V=mstrmojo.array,I=mstrmojo.hash,H=mstrmojo.dom,A=mstrmojo.css,h=mstrmojo.string,F=mstrmojo.vi.ui.theme,b=mstrmojo.vi.ui.DatasetUnitMenuUtils,g=[4,12,1,47];var J={n:mstrmojo.desc(15348,"No applicable objects"),t:0},R={n:mstrmojo.desc(15559,"No result matches your search."),t:0};function L(p){var o=[],n=[],t=this._shiftStartIndex,s=this.selectedIndices,r=Math.min(t,p),q=Math.max(t,p);V.forEach(this.items,function(u,w){if(r<=w&&w<=q){if(!s[w]){o.push(w);}}else{if(s[w]){n.push(w);}}});this.addSelect(o);this.removeSelect(n);}function P(){return !mstrmojo.resolveFeature("hide-objects-description");}function Y(o){var n=mstrmojo.vi.enums.EnumDSSAccessRightFlags;return o.acg&&(o.acg&n.DssAccessRightUseFlag)&&(o.acg&n.DssAccessRightExecuteFlag);}function j(o,r){var q=o.itemsContainerNode,p=H.isMetaKey(r.src.hWin,r.src.e),t=H.eventTarget(r.src.hWin,r.src.e),n=-1;if(q&&t){V.forEach(q.childNodes,function(u,w){if(H.contains(u,t,true,u)){n=w;return false;}});}if(n!==-1){var s=o.items[n];if(!p&&!o.selectedIndices[n]){o.tree.clearTreeSelect();}if(V.indexOf(g,s.t)>=0){o.addSelect(n);}return true;}return false;}function c(p,n){var o=this.listSelector;if(o){o[p](this,this.itemsContainerNode,n);}}function M(o,p){var n=false;if(o.itemsContainerNode){V.forEach(o.ctxtBuilder.itemWidgets,function(q){if(H.contains(q.itemsContainerNode,p,q.domNode)){n=true;}});}return n;}mstrmojo.vi.ui.BrowserNodesAvatarContent=G.newComponent(mstrmojo.vi.ui.UnitList,null,{getItemProps:function(p,n){var o=this._super(p,n);o.addCls("isAvatar");return o;}});mstrmojo.vi.ui.TreeBrowserSelector=I.copy({premousedown:function(o,q,n){o.tree._selectNode=H.eventTarget(n.hWin,n.e);},premouseup:function D(x,n,AA){if(H.isPrimaryMouseBtn(AA.e)){var r=AA.hWin,t=AA.e,u=H.eventTarget(r,t),q=H.shiftKey(AA.hWin,AA.e),z=x._shiftStartIndex,s=M(x,u),v=x.listMapper.findIndex(x,n,u);if(v>-1&&!s&&x.tree._selectNode===u){var o=V.indexOf(g,x.items[v].t)!==-1;if(q&&z>-1&&o){x.rangeSelect(v);}else{x.toggleSelect(v);if(x.selectedIndices[v]&&o){x._shiftStartIndex=v;}}}}}},mstrmojo.TreeBrowserSelector);mstrmojo.vi.ui.TreeBrowser=G.newComponent(mstrmojo.TreeBrowser,[mstrmojo.vi.ui._HasUnitListAvatar],{containerResizable:false,draggable:true,avatarCssClass:"mstrmojo-VIUnitList",rangeSelect:L,_selectNode:null,_shiftStartIndex:-1,blockBegin:1,blockCount:50,getContent:function(o,s){o=o||this;var p=(o===this),n=this,t=function(u){if(p){mstrmojo.css.removeClass(n.domNode,["loading"]);}n.updateTreeContent(o,u);},q=function(u){o.contentRetrieved=true;o.set("items",[n.failItemCreaterFunc()]);mstrmojo.err(u);},r={success:t,failure:q};if(p){mstrmojo.css.addClass(n.domNode,["loading"]);}if(mstrApp.objectsBlockCount){this.blockCount=parseInt(mstrApp.objectsBlockCount,10);}this.getContentThroughTaskCall({isRoot:p,data:o.data,blockBegin:s||o.blockBegin,blockCount:parseInt(mstrApp.objectsBlockCount,10)||n.blockCount},r);},getDragData:function k(o){o.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit();var r=this,s=function(w){V.forEach(w.ctxtBuilder.itemWidgets,function(x){var z=H.eventTarget(o.src.hWin,o.src.e);if(z&&H.contains(x.itemsContainerNode,z,true,x.itemsContainerNode)){r=x;s(x);return false;}});};s(this);var p=j(r,o);var t=p?this.getSelectedItems().filter(function(w){return V.indexOf(g,w.t)!==-1;}):null;var n=this.id,q=function q(w){var AA=mstrmojo.all[n],x=AA.avatar;if(x){var z=[AA.avatarCssClass,"hasOwnAvatar",w];x.className=z.join(" ");}};return{items:t,item:t&&t[0],src:mstrmojo.vi.models.EnumDragSources.ALL_OBJECT_LIST,setAvatarClass:function u(w){q(w);},setInvalidAvatarClass:function v(){q("icn clsx_sub");}};},getSelectedItems:function(){var n=this.ctxtBuilder,o=[];if(n){V.forEach(n.itemWidgets,function(p){if(p.state===1){o=o.concat(p.getSelectedItems());}});}o=(this._super()||[]).concat(o);return o;},createAvatar:function(p,o){var n=document.createElement("div");this.avatarContent=new mstrmojo.vi.ui.BrowserNodesAvatarContent({items:o.src.data.items});this.avatarContent.render();A.addClass(this.avatarContent.domNode,[F.getThemeClass.call(this)]);n.appendChild(this.avatarContent.domNode);return n;},ondragend:function(n){this._super(n);if(this.avatarContent&&this.avatarContent.destroy){this.avatarContent.destroy();}delete this.avatarContent;},isDragValid:function S(o){var n=o.src.data.items;return(n&&n.length)||this._super(o)||false;},contentRetrieved:false,onvisibleChange:function(){if(!this.contentRetrieved){this.getContent(this);}}});mstrmojo.vi.ui.TreeBrowserNode=G.newComponent(mstrmojo.TreeBrowserNode,[{_mixinName:"newClass"}],{containerResizable:false,draggable:false,_shiftStartIndex:-1,rangeSelect:L,premousedown:function(n){this.tree._selectNode=H.eventTarget(n.hWin,n.e);},premouseup:function(o){if(H.isPrimaryMouseBtn(o.e)){var s=H.isMetaKey(o.hWin,o.e),r=H.shiftKey(o.hWin,o.e),t=H.eventTarget(o.hWin,o.e),u=H.contains(this.itemsContainerNode,t,true,this.domNode),q=u&&M(this,t),p=(this.state===2),n=!p&&(t!==this.stateNode&&t!==this.textNode)&&!u;if(q||this.tree._selectNode!==t){return ;}if((!s&&!r)||this.tree.isSelectedFolder||n){this.tree.clearTreeSelect();}if(n){this.tree.isSelectedFolder=true;}else{if(!u){this.tree.isSelectedFolder=false;}}if(!p&&(t===this.stateNode||t===this.textNode)){this.toggleState();this.tree.updateScroller();H.stopPropogation(o.hWin,o.e);}else{if(u){c.call(this,"premouseup",o);}else{this.handleNodeClicked();}}}},getSelectedItems:function(){var n=this.ctxtBuilder,o=[];if(n){V.forEach(n.itemWidgets,function(p){if(p.state===1){o=o.concat(p.getSelectedItems());}});}o=(this._super()||[]).concat(o);return o;}});function Z(p){var o=this;return I.copy(p,{scriptClass:"mstrmojo.vi.ui.TreeBrowser",alias:"contents",slot:"containerNode",isSelectedFolder:false,browserNodeClass:mstrmojo.vi.ui.TreeBrowserNode,noCheckBox:true,itemIdField:"did",useRichTooltip:true,dataProvider:this.dataProvider,listSelector:mstrmojo.vi.ui.TreeBrowserSelector,showTooltip:function s(u,AB){var AA=u.target||H.eventTarget(u.hWin,u.e),z=H.findWidget(AA),x=z.data;if(x&&x.n){var v=z.domNode.firstChild;var w='<div class="name">'+h.encodeHtmlString(x.n,true)+"</div>"+(x.desc?'<div  class="dsc">'+h.encodeHtmlString(x.desc,true)+"</div>":"");var t=H.position(v);this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",content:w,top:t.y-4,left:t.x+t.w+6};this.constructor.prototype.showTooltip.call(this,u,AB);}},updateScroller:function(){o.updateScrollbars();},isBranch:function(t){return t.t===8;},items:null,bindings:{data:"this.parent.rootFolder"},setDimensions:mstrmojo.emptyFn,item2textCss:function n(u){var w={8:"folder",3:"report",12:"attribute",4:"metric",47:"consolidation",1:"custom-group",0:"no-obj"},t=mstrmojo.TreeBrowser.prototype.item2textCss(u)||w[u.t],v=this.parent&&this.parent.highlightItems;if(v&&v.indexOf(u.did)!==-1){t+=" highlight";}return t;},onnodechange:function r(t){this.constructor.prototype.onnodechange.call(this,t);this.parent.onSelectedItemsChange(t);},getTotalSelections:function(){return[];},getContentThroughTaskCall:function q(AB,x){var t=this.parent,w=AB.data||{fty:t.rootFolderType},v=AB.isRoot,u=t.folderList,z=AB.blockBegin,AA=AB.blockCount;this.dataProvider.fetchFolderContents({sId:mstrApp.sessionState,browsableTypes:t.getObjectSubTypes().join(","),includeObjectDesc:true,folderLinksContextId:t.folderLinksContextId||29,blockCount:AA||50},{fid:w.did,fty:w.fty,blockBegin:z||1},{success:function(AD){var AC=AD.items?AD.items.filter(function(AF){return AF.t===8||Y(AF);}):[];x.success({items:AC.length?AC:[J],sz:AD.sz,bb:AD.bb,bc:AD.bc});if(v&&!u.initialized){u.set("items",AD.sc);var AE=V.find(AD.sc,"did",AD.did);if(AE!==-1){u.set("selectedIndex",AE);}}u.initialized=true;o.updateScrollbars();},failure:x.failure});}});}function e(o,p){if(o.state===2){var n=o.data;A.toggleClass(o.textNode,"highlight",n&&(p.indexOf(n.did)!==-1));}else{o.ctxtBuilder.itemWidgets.forEach(function(q){e(q,p);});}}mstrmojo.vi.ui.AllObjectsBrowser=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._IsViPanel,mstrmojo.ui._HasScroller,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.vi.ui.AllObjectsBrowser",markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-VIAllObjectsBrowser {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIPanel-titlebar"></div><div class="filter"></div><div class="search-box"></div><div class="horizontal-line"></div><div class="mstrmojo-VIPanel-contentContainer"><div style="overflow:hidden;"><div class="mstrmojo-VIPanel-content"></div></div></div></div>',markupSlots:{titlebarNode:function l(){return this.domNode.firstChild;},filterNode:function B(){return this.domNode.childNodes[1];},searchBox:function Q(){return this.domNode.childNodes[2];},contentNode:function m(){return this.domNode.childNodes[4].firstChild;},containerNode:function U(){return this.domNode.childNodes[4].firstChild.firstChild;}},title:mstrmojo.desc(5679,"All Objects"),model:null,rootFolder:null,rootFolderType:null,highlightItems:null,getObjectSubTypes:function(){var n=[2048,3072,1024];if(!mstrApp.isSingleTier){n.push(12032);n.push(257);n.push(2560);}return n;},layoutConfig:{h:{titlebarNode:"30px",filterNode:"30px",searchBox:"33px",containerNode:"100%"},w:{titlebarNode:"100%",searchBox:"100%",containerNode:"100%"},xt:true},opened:false,dataProvider:null,onSelectedItemsChange:mstrmojo.emptyFn,onopenedChange:function(){if(!this.searchList&&this.opened){var n=this.folderList,o=n.getSelectedItem(),p=this.rootFolder;if(o&&p&&o.did!==p.did){n.initialized=false;}this.addChildren([Z.call(this,{ondataChange:function(){if(this.data){this.getContent(this);}},ondblclick:this.dblClickOnNodes.bind(this)}),Z.call(this,{alias:"searchList",visible:false,contentRetrieved:true,ondblclick:this.dblClickOnNodes.bind(this)})]);}},reset:function(){if(this.contents){this.removeChildren(this.contents);}if(this.searchList){this.removeChildren(this.searchList);}},dblClickOnNodes:function N(o){var r=o.getTarget(),q=H.findWidget(r).data,p=this.model,n=p.getSelectedViUnit();if(n&&q&&V.indexOf(g,q.t)!==-1){this.dataProvider.loadObjects([q],{success:function(){var s=b.getCfgForAddUnitFromAllObject([q],p.datasets);if(n){n.getZonesModel().addUnitsFromDataSource([q],s.dsid,s.actions,p.getDatasetsUpdateCallback());}}},true);}},getSelectedItems:function K(){var o=this.contents,n=o.visible?o:this.searchList;return n.getSelectedItems();},getLayoutOffsets:function(){return{w:18,h:0};},children:[{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",cssClass:"vi-allObjects-tb",slot:"titlebarNode",alias:"titleBar",editTitleOnDoubleClick:false,getLayoutOffsets:function(){return{w:0,h:5};},onclick:function W(){this.close();},close:function(){this.parent.close();},bindings:{title:"this.parent.title"}},{scriptClass:"mstrmojo.ui.Pulldown",slot:"filterNode",alias:"folderList",initialized:false,getLayoutOffsets:function(){return{w:0,h:9};},onitemSelected:function(n){if(this.initialized){this.parent.set("rootFolder",n);this.parent.obSearchBox.clearSearch(true);}}},{scriptClass:"mstrmojo.ui.SearchBox",slot:"searchBox",alias:"obSearchBox",getLayoutOffsets:function(){return{w:0,h:13};},searchTriggered:function O(s){this.text=s;if(!s){this.clearSearch(true);return ;}var n=this.parent,q=n.contents.visible?n.contents:n.searchList,u=q.getSelectedItems(),o=n.folderList,p=this.parent.dataProvider,t=o.items[o.selectedIndex].did,r=this;u.forEach(function(v){if(v.t===8){t=v.did;return false;}});A.addClass(q.domNode,["loading"]);p.fetchFolderContents({browsableTypes:n.getObjectSubTypes().join(","),includeObjectDesc:true,folderLinksContextId:n.folderLinksContextId||29,blockCount:50,enableQuickSearch:!!(mstrApp.useQuickSearch&&mstrApp.useQuickSearch())},{fid:t,searchPattern:s,recursive:1},{success:function(v){A.removeClass(q.domNode,["loading"]);if(r.inputNode.value===s){n.contents.set("visible",false);n.searchList.set("visible",true);(n.searchList||this).set("items",v.items||[R]);n.updateScrollbars();}}});},onkeyup:function f(o){var n=o.hWin,p=o.e||n.event;if((mstrApp.useQuickSearch&&mstrApp.useQuickSearch())||((p.keyCode===13||p.keyCode===27||!this.inputNode.value))){this.constructor.prototype.onkeyup.call(this,o);}},postClearSearch:function(){var n=this.parent,p=n.contents,o=n.searchList;if(p){p.set("visible",true);}if(o){o.set("visible",false);}}}],getDropAvatarIcon:function C(n){return" ";},passToolbarCfg:function E(n){this.titleBar.set("toolbarCfg",n);},updateToolbar:function a(n){n.hasCloseButton=true;n.closeButtonText="";return n;},onhighlightItemsChange:function X(){var n=this.highlightItems;if(n){e(this.contents,n);e(this.searchList,n);}},setupScrollNodes:function d(){this.scrollNode=this.containerNode;},updateScrollbars:function(){this._super();if(this.scrollNode&&this.hasCustomScrollbar){var o=this.scrollNode,n=H.getComputedScrollbarWidth(o);o.style.marginRight=-n+"px";o.style.paddingRight=n+"px";}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.mapbox.ui.selectors.OveralZoomSlider","mstrmojo.mapbox.ui.selectors.ClusterMaxZoomSlider","mstrmojo.mapbox.ui.selectors._SliderCommon","mstrmojo.dom","mstrmojo.tooltip");var B=mstrmojo.dom,A=mstrmojo.mapbox.ui.selectors._SliderCommon.getIndexByValue;mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.mapbox.ui.selectors._SliderCommon],{scriptClass:"mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl",cssClass:"mapbox-control-container mapbox-cluster-maxzoom-container",layoutConfig:{w:{containerNode:"100%",leftPadding:"7px",rightPadding:"7px"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;},tooltipNode:function(){return[];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.mapbox.ui.selectors._SliderCommon.enabledMarkupMethod},init:function C(J){if(!J.host){throw new Error(this.scriptClass+"must be initialized with a host which is a mapbox");}var H=J.host,G=H.mapViewer,E=G&&G.baseLayer,F,K=E.minZoom,D=E.maxZoom;F=[{scriptClass:"mstrmojo.mapbox.ui.selectors.OveralZoomSlider",alias:"overalSlider",baseLayer:E,items:this.generateItems(K,D),getIndexByValue:A,onselectionChange:function(){var L=this.cs2Vl;E.setZoom(L);},multiSelect:false,disableDnD:true,thumbWidth:14,_updateTooltip:function I(R,P){var N=B.eventTarget(P,R),O,W,V,S,M=null,U=null,Q='<div class="name">{@content}</div>',L='<div class="dsc">{@description}</div>',Y,X=false;switch(N){case this.handle2Node:O=mstrmojo.desc(15724,"Current zoom level of map:")+" "+Number(this.currentZoomLevel).toFixed(1);W=mstrmojo.desc(15725,"The value will update when you zoom.");V=mstrmojo.tooltip.POS_TOPLEFT;S="vi-tooltip-C ";U=-8;M=this.handle2Node.offsetWidth+16;X=true;break;default:break;}if(X&&this.enabled){Y={cssClass:"mstrmojo-VISlider vi-regular "+S+mstrApp.getThemeClassName(),content:Q.replace(/\{@content\}/g,O)+(W&&W.length>0?L.replace(/\{@description\}/g,W):""),contentNodeCssClass:"scm-tooltip",refNode:N,posType:V,left:M,top:U};this.set("richTooltip",Y);}},},{scriptClass:"mstrmojo.mapbox.ui.selectors.ClusterMaxZoomSlider",host:H,cssClass:"sc mapbox-cluster-maxzoom",items:this.generateItems(K,D,1),getIndexByValue:A}];this.children=F;this._super(J);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo.color","mstrmojo.css","mstrmojo.array");var R=mstrmojo.css,H=mstrmojo.array,Q=mstrmojo.color,Y=mstrmojo.models.FormatModel,I=Y.ENUM_PROPERTY_NAMES,X="transparent",A="#000000",S="#2f9ad3",G="#ffffff",V,N,E;function O(){return this.docSelector.style===mstrmojo.DocSelector.STYLES.LINK;}function F(){return(this.isHoriz&&(this.orientation!=="v"))||(!this.isHoriz&&this.orientation==="h");}function K(a,c){if(O.call(this)){var Z=a.style,b=this.stateCssText[c];Z.background=b.bg;Z.color=b.text;}}function J(){if(this.itemWidthMode===1){var Z=Array.prototype.slice.call(this.itemsContainerNode.childNodes);if(Z.length>0&&Z.length<100){var d=mstrmojo.emptyFn;if(this.isHoriz){var c=this,b=Z.map(function(e){return e.offsetWidth;}),a=b.reduce(mstrmojo.array.fnReduceNumber);this.scaleConst=(this.domNode.clientWidth-(Z.length-1)*(O.call(this)?this.itemGap:0))/a;if(a>0){d=function(g,e,h){var f=b[e];g.minWidth=f+"px";g.width=f*h.scaleConst+"px";};}}else{d=function(e){e.minWidth=e.width="auto";};}Z.forEach(function(f,e){d(f.style,e,c);});}}}function B(b){var Z=this.domNode,a=document.createElement("div");R.addClass(a,"content");a.innerText=b;Z.style.display="flex";Z.innerHTML="";Z.appendChild(a);}function L(Z){this.toggle(Z);var a=this.domNode.style;if(a.display==="block"){a.display="flex";}}mstrmojo.vi.ui.rw.selectors.LinkList=mstrmojo.declare(mstrmojo.ui.ScrollableList,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.LinkList",markupString:'<div id="{@id}" class="mstrmojo-ListBase {@cssClass}" style="{@cssText}" mstrAttach:click,dblclick,mousemove,mouseover,mouseout,contextmenu><div class="list-content"><div class="items-container {@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div></div>',renderOnScroll:true,itemGap:1,init:function M(Z){this._super(Z);R.addWidgetCssClass(this,"mstrmojo-vi-sel-LinkList");if(F.call(this)&&this.itemWidthMode===0){R.addWidgetCssClass(this,"mstrmojo-vi-sel-LinkList-iwm");}if(!N){N=new mstrmojo.VisTooltip({widgetClass:"LinkList-Vis-Tooltip"});N.hide();N.render();}},listHooks:{select:function(Z){K.call(this,Z,"selected");},unselect:function(Z){K.call(this,Z,"base");}},onmousemove:function(b){var a=b.getTarget();if(!a||H.indexOf(a.classList,"item-wrapper")===-1){L.call(N);return ;}var Z={x:b.e.pageX,y:b.e.pageY};L.call(N,true);N.moveTo(Z.x,Z.y);if(E===a){return ;}E=a;if(!N.domNode.parentNode){document.body.appendChild(N.domNode);}B.call(N,a[a.innerText!==undefined?"innerText":"textContent"]);},onmouseout:function(Z){N.hide();E=null;},getItemMarkup:function D(a,Z){if(mstrmojo.string.isEmpty(a.n)){return this._super(a,Z).replace("{@en@n}",'<div class="item-wrapper">&nbsp;</div>');}if(!V){V=this._super(a,Z).replace("{@en@n}",'<div class="item-wrapper">{@en@n}</div>');}return V;},getItemProps:function W(g,e){var d=this._super(g,e),f=F.call(this),c=this.items.length,b=e===c-1;if(O.call(this)){var a=this.stateCssText,h=d.sel?a.selected:a.base;d.addStyle("background:"+h.bg+";color:"+h.text);if(f&&!b){d.addStyle("margin-right:"+this.itemGap+"px");}}if(this.itemWidthMode===0){d.addCls("equal-width");if(f){var Z=100/c;if(b){Z=100-((c-1)*Z);}if(O.call(this)){d.addStyle("width:calc("+Z+"% - "+this.itemGap+"px)");}else{d.addStyle("width:"+Z+"%");}}}return d;},preBuildRendering:function C(){if(O.call(this)){var a=this.docSelector,Z=a.getFormats(),d=this.getPropertyDefaultValue(I.SELECTOR_SELECTION_COLOR)||S,c=this.getPropertyDefaultValue(I.COLOR)||G,b=a.defn.ssc!==undefined?Y.decodeValue(I.SELECTOR_SELECTION_COLOR,a.defn.ssc):d;this.stateCssText={base:{bg:Z["background-color"]||X,text:Z.color||A},selected:{bg:b,text:Q.encodeColor(b)===Q.encodeColor(d)?c:Q.getContrastingColor(b,"#ffffff","#000000")}};}return this._super();},postBuildRendering:function P(){if(!O.call(this)){R.addClass(this.domNode,"buttons");}J.call(this);return this._super();},onclick:function(Z){var a=this.getItemFromTarget(Z.getTarget());if(a){this.doItemSelect(a,Z||{});}},getPropertyDefaultValue:function(a){var b=mstrApp.getThemeClassName(),Z=null;switch(a){case I.SELECTOR_SELECTION_COLOR:Z=b==="mojo-theme-light"?"#34ABEB":"#34ABEB";break;case I.COLOR:Z=b==="mojo-theme-light"?"#444649":"#ffffff";break;}return Z;},updateScrollbars:function U(){if(this.hasRendered&&this.orientation==="v"){this.scrollboxNode.style.height=this.height;}this._super();}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.rw.selectors.LinkList,{onorientationChange:function(){J.call(this);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.hash","mstrmojo.dom","mstrmojo.tooltip","mstrmojo.css","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.VisUtility");var B=mstrmojo.hash,E=mstrmojo.dom,F=mstrmojo.css,C=mstrmojo.gmaps,G=C.MapUtils,K=C.EnumPropertyType,H=mstrmojo.VisUtility;mstrmojo.mapbox.ui.selectors.LayerZoomSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.mapbox.ui.selectors.LayerZoomSlider",thumbWidth:3,cssBkBW:0,sliderDefaultWidth:140,multiSelect:true,markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation}" style="{@cssText}"><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1 {@handle1Exlcude}" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div class="t3 {@handle2Exlcude}" style="{@handel2CssText}" mstrAttach:mouseout></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[0],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[4]];}},init:function Q(X){X=B.copy(X,{isHoriz:true,cssClass:"mapbox_layer_zoom_slider"});if(!X.layer){throw new Error(this.scriptClass+"must be initialized with a graphic layer.");}if(!X.items||!X.getIndexByValue){throw new Error(this.scriptClass+"must be initialized with items and getIndexByValue function.");}var V=X.layer,W=V.getLayerProp(K.minLayerZoomLvl),S=V.getLayerProp(K.maxLayerZoomLvl),U,R;X.minLayerZoomLvl=!G.checkDefined(W)?X.minZoom:parseFloat(W);X.maxLayerZoomLvl=!G.checkDefined(S)?X.maxZoom:parseFloat(S);U=X.getIndexByValue(X.maxLayerZoomLvl);R=X.getIndexByValue(X.minLayerZoomLvl);X.selectedIndices={};X.selectedIndices[U]=true;X.selectedIndices[R]=true;this._super(X);},updateTypeHelper:function A(){var R=B.walk("mapbox.ui.selectors.LayerSliderHelper",mstrmojo);this.typeHelper=new R({slider:this});},positionLayerName:function P(){if(!this.hasRendered){return ;}var S=this.layer,R=S&&S.getLayerName(),U=F.getComputedStyle(this.thumbNode),W={fontFamily:U.fontFamily,fontSize:U.fontSize,fontStyle:U.fontStyle,fontWeight:U.fontWeight},V=parseFloat(U.paddingLeft)+parseFloat(U.paddingRight),X=H.measureTextWidth(R,W,V);this.thumbNode.innerText="";this.upperRange.innerText="";this.lowerRange.innerText="";if(X<=this.thumbNode.offsetWidth){this.layerNameNode=this.thumbNode;}else{if(X<=this.upperRange.offsetWidth){this.layerNameNode=this.upperRange;}else{if(X<=this.lowerRange.offsetWidth){this.layerNameNode=this.lowerRange;}else{this.layerNameNode=this.thumbNode;}}}this.layerNameNode.innerText=R;this.layerNameWidth=X;this.layerName=R;},synchronizeSlider:function D(){this._super();this.positionLayerName();},onselectionChange:function J(){this._super();this.parent.onLayerSelectionChange(this);},initDrag:function O(S,R){if(this.enabled){this._super(S,R);}},_updateTooltip:function M(X,V){var S=E.eventTarget(V,X),U,a,Y,R,Z,W='<div class="name">{@content}</div>',c,b=false;a=mstrmojo.tooltip.POS_BOTTOMLEFT;Y="vi-tooltip-V ";Z=0;R=-7;switch(S){case this.handle1Node:U=String(this.cs1Nm).replace("$","$$$$");b=true;break;case this.handle2Node:U=String(this.cs2Nm).replace("$","$$$$");b=true;if(parseFloat(U)<1.5){W='<div class="name" style="font-weight: bold">'+mstrmojo.desc(15861,"## is not a safe level to stop showing layer.").replace("##","{@content}")+'</div><div class="dsc">'+mstrmojo.desc(15862,"You might never see this layer under certain screen resolution.")+"</div>";}break;case this.lowerRange:case this.thumbNode:case this.upperRange:if(this.layerNameWidth>this.layerNameNode.offsetWidth){U=this.layerName;b=true;R=0;}break;default:break;}if(b&&this.enabled){c={cssClass:"mstrmojo-VISlider vi-regular "+Y+mstrApp.getThemeClassName(),content:W.replace(/\{@content\}/g,U),contentNodeCssClass:"scm-tooltip",refNode:S,posType:a,left:R,top:Z};}else{c=null;}this.set("richTooltip",c);},destroy:function I(R){delete this.layer;this._super(R);}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.mapbox.ui.selectors.LayerZoomSlider,{onenabledChange:function(){F.toggleClass(this.handle1Node,"enable",this.enabled);F.toggleClass(this.handle2Node,"enable",this.enabled);}});mstrmojo.mapbox.ui.selectors.LayerSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:" mstrmojo.mapbox.ui.selectors.LayerSliderHelper",updateSummary:function N(){},initialSlider:function L(){var R=this.slider;this._super();R.min=R.cs1Idx;R.max=R.cs2Idx;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.elementHelper","mstrmojo.SimpleObjectInputBox","mstrmojo._HasTooltip","mstrmojo.mstr.EnumDSSXMLObjectTypes");var N=mstrmojo.array,H=mstrmojo.dom,B=mstrmojo.Enum_Keys,P=mstrmojo.hash,c=mstrmojo.mstr.EnumDSSXMLObjectTypes,Q=mstrConfig.thousandsSep;if(Q===undefined){Q=",";}var K=2147762227,X=2147762262,I=2147762269,L=140,O=118,Y=350,J=-100,W=-101,C=64;var U;mstrmojo.SearchBoxSelectorList=mstrmojo.declare(mstrmojo.SuggestionList,null,{postBuildRendering:function V(){var f=this._super(),d=this.parent,h=d.id;if(!this.onScroll){this.onScroll=function e(){var j=mstrmojo.all[h],k=j.domNode;if(!j.isFetching&&Math.ceil(k.offsetHeight+k.scrollTop)>=k.scrollHeight){j.isFetching=true;j.opener.getCandidatesThroughTaskCall({isIncFetch:true},{});}};}var g=d.domNode;if(d.supportsIncFetch){H.attachEvent(g,"scroll",this.onScroll);}else{H.detachEvent(g,"scroll",this.onScroll);}return f;},getItemMarkup:function(e,d){if(!U){U=this._super(e,d).replace(">{@"+this.itemField+"}<",">{@"+this.itemField+"}{@weight}<");}return U;},getItemProps:function b(f,d){var e=this._super(f,d),g=f.wt;e.weight=g?"<em>("+mstrmojo.num.addSeparators(g,Q)+" "+this.parent.opener.wtStr+")</em>":"";return e;},onmouseover:function(f,g){var d=f.e.srcElement;if(d.scrollWidth<=d.offsetWidth){d.title="";}},onclick:function(e){var h=this.parent.opener.suggestionItems,d=h.length;this._super(e);if(d<=1){return ;}var f=N.find(h,"t",J),g=this.getItemFromTarget(e.getTarget());if(g&&g.t&&g.t===J){N.forEach(h,function(j,k){if(!this.selectedIndices[k]){this.doItemSelect(j,{});}},this);}else{if(this.selectedIndices[f]){this.doItemSelect(h[f],{});}}}});mstrmojo.SearchBoxSelector=mstrmojo.declare(mstrmojo.SimpleObjectInputBox,[mstrmojo._HasTooltip],{scriptClass:"mstrmojo.SearchBoxSelector",cssClass:"mstrmojo-SearchBoxSelector",srcid:null,srct:c.Attribute,dataSourcesXML:null,useClientForm:false,maxItemWidth:"",wtStr:"likes",suggestionListClass:"mstrmojo.SearchBoxSelectorList",useRichTooltip:false,postCreate:function A(){var d=P.clone(this.suggestionPopup);d.cssClass="mstrmojo-SearchBoxSelector-suggest";d.nudge=function(){var p=this.domNode,h=this.containerNode;if(!p){return ;}var m=Math.min(h&&h.offsetHeight||L,(mstrApp&&mstrApp.MAX_SUGGESTION_POPUP_HEIGHT)||L),e=p.offsetWidth,f=H.windowDim(),g=parseInt(this.left,10),k=parseInt(this.top,10);if(k+m>=f.h){k=Math.max(k-m-(this.target?this.target.offsetHeight:0),0);if(k+m>=f.h){k=5;m=H.getMaxScrollHeight();}}if(g+e>=f.w){g=Math.max(g-e,0);}var o=p.style;o.top=k+"px";o.left=g+"px";o.maxHeight=m+"px";var l=this.opener,n=l&&l.width,j=H.position(p).w;if(n!==undefined&&j<parseInt(n,10)&&o.maxWidth!==n){o.maxWidth=n;this.nudge();}};this.suggestionPopup=d;},preBuildRendering:function D(){var d=this.parent.contentNode.offsetWidth||this.parent.width;this.set("maxItemWidth",parseInt(d,10));this._super();},postBuildRendering:function V(){var d=this.parent.defn.fmts;if(!d.height){this.domNode.style.height="auto";}return this._super();},filterCandidates:function a(e,h,d){var j=e,f=this.suggestCount;if(!this.noCache){d=d||f;if(h==="*"){h="";}else{h=mstrmojo.string.regEscape(h);}var k=this.itemField,g=new RegExp(h,"i");j=N.filter(e,function(l){return g.test(l[k]);},{max:d});}if(j.length){N.forEach(this.items,function(m){var l=N.find(j,"v",m.v);if(l>-1){j.splice(l,1);}});}return j;},getCandidatesThroughTaskCall:function G(x,AC){var r=this.id,k=this.getSuggestionTarget(),o=x.pattern||"",n=o,l=this.parent,t=this.srcid,p=x.isIncFetch,m=this._last_hit,AA=this,v=false,j;if(p){o=x.pattern=m.pattern;}if(o===""||o.trim()==="%"){return ;}if(t){var AB={taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:t,dataSourcesXML:this.dsrc||"",blockBegin:p?m.loadedCount:1,blockCount:this.items.length+this.suggestCount,searchPattern:o,rawInput:n,browseFlags:1,otp:this.srct},q=null;var f=l.defn;if(f.dsid){q={};q.datasetID=f.dsid;q.messageID=l.model.mid;q.ctlKey=l.ckey;}if(this.srct===c.Consolidation){AB.browseFlags=C;}var w=f.fs||f.sfs;if(w){var u="",h="";N.forEach(w,function(AD){u+=h+AD.did;h=";";});AB.searchForms=u;if(l.model.isnew||this.useClientForm){var z="",d="",g=l.model,s=N.filterOne(g.getDatasetUnits(["att"]),function(AD){return AD.did===t;}),e=s.fs||[];N.forEach(w,function(AD){var AE=N.filterOne(e,function(AF){return AF.fid===AD.did;});z+=d+AD.did+":"+(AE&&AE.bftp||0);d=";";});AB.clientFormPatterns=z;}}AC.success=function(AL){var AH=mstrmojo.all[r],AF=AH&&AH.suggestionPopup,AK,AJ,AN,AM,AE=x.pattern,AD=AH&&AH._searchQueue,AG=!AD||AD.length<=(p?0:1)||!AH.stifleIntermediateSearch;if(AH){if(AL&&AL.es){AK=AH.getSuggestionTarget();AJ=AL.es.length;if(!AL||!AK||(k!==AK)){return ;}AN=AK.getSearchPattern();AM=AL.es;if(t){AM=mstrmojo.elementHelper.buildElemsTerseID(AM,t,true);}AH._last_hit={items:AM,pattern:AE,loadedCount:AL.bb+AJ};AF.isFetching=false;if(AG){AF.supportsIncFetch=(AL.bb+AL.bc)<AL.sz;if(AN&&AN.indexOf(AE)>-1){var AI=AH.filterCandidates(AM,AN);AH.updateSuggestion(p?AH.suggestionItems.concat(AI):AI);}if(AH.inputBox){AH.inputBox.focus();}if(!AH._ListenerProc){AH._ListenerProc=function(){var AO=AH.suggestionPopup;if(AO.visibile){AO.nudge();}};H.attachEvent(window,"resize",AH._ListenerProc);}}}else{if(AG){AH.updateSuggestion([]);}}}};AC.failure=function(AE){var AG=mstrmojo.all[r],AD=parseInt(AE.code,10)+4294967296,AF=(AD===K||AD===X||AD===I);if(!AF){mstrmojo.alert(AE.message);}if(AG&&AG.failMessage){AG.failMessage(AF?{errCode:AD,msg:AE.message}:{});}};AC.complete=function(){var AE=AA._searchQueue,AD=AE&&AE.pop();mstrApp.hideWait();if(AE&&AE.length&&AA.showSuggestion){AA._searchQueue=[];AA.showSuggestion(AD);}};if(this.hitEnterToTest){if(p&&this.onIncrementalFetch){this.onIncrementalFetch();}mstrApp.showWait({message:mstrmojo.desc(15823,'Searching "#"...').replace("#",o)});}else{if(!p){j=this._searchQueue;v=j&&j.length;if(!j){this._searchQueue=[];}this._searchQueue.push(o);}}if(!v){mstrmojo.elementHelper.browseElements(AC,AB,q);}}},destroy:function Z(d){if(this._ListenerProc){H.detachEvent(window,"resize",this._ListenerProc);delete this._ListenerProc;}this._super(d);},onsuggestionItemsChange:function F(){var h=this.suggestionItems,e=this.suggestionPopup,g=e.editorNode,m=h&&(h.length>8),l="",j="";if(m){l=(mstrApp&&mstrApp.MAX_SUGGESTION_POPUP_HEIGHT)||L;j="px";}if(g){g.style.maxHeight=l+j;}else{if(m){j+=";";e.cssText=(e.cssText||"")+"max-height:"+l+j;}}if(mstrApp.isExpress){var f=this.parent.contentNode.offsetWidth,d=(f===null||O<f)?O:f,k=(f===null||Y>f)?Y:f;e.cssText=(e.cssText||"")+"min-width:"+d+"px; max-width:"+k+"px;";}},getSuggestionPos:function R(){var d=this._super();if(d){d.lockIW=this;}return d;},updateSuggestion:function S(e){var d=e&&e.length;this.autoSelect=true;this.set("disableClick",false);if(this.parent.defn.multi&&d&&d>1){e=N.filter(e,function(g){return(g.v!=="u;"&&g.t!==14)&&(g.t!==J);});e.unshift({n:mstrmojo.desc(13976,"(All search results)"),t:J});this.autoSelect=false;}if(!d){e=[{n:mstrmojo.desc(13779,"No elements match your search"),t:W,cls:"nomatch"}];}if(e.length===1&&e[0].t===W){this.autoSelect=false;this.set("disableClick",true);}this._super(e);var f=this;f.mw=f.mw||function(k){var g=f._lastOpened;if(!g||!g.visible){H.detachEvent(document,H.isFF?"DOMMouseScroll":"mousewheel",f.mw);return ;}var j=H.eventTarget(self,k);var h=g.domNode;if(!H.contains(h,j,true,document.body)){g.close();H.detachEvent(document,H.isFF?"DOMMouseScroll":"mousewheel",f.mw);}};H.attachEvent(document,H.isFF?"DOMMouseScroll":"mousewheel",f.mw);},handleSuggestionItemSelect:function M(e,f){if(N.isArray(e)||e.t===J){e=N.ensureArray(e);var d=N.filter(e,function(g){return g.t!==J;});if(d.length<e.length){d=N.filter(this.suggestionItems,function(g){return g.t!==J;});}this.onSuggestionItemSelect(d);}else{this._super(e,f);}},prekeydown:function E(n){this._super(n);var k=n.e,o=(mstrApp&&mstrApp.MAX_SUGGESTION_POPUP_HEIGHT)||L,h=8,f=o/h;var g=this.getSelected();if(g){var j=g._renderIdx,d=(j-h+1)*f,m=(j-1)*f,l=this.suggestionPopup.domNode.scrollTop;switch(parseInt(k.keyCode||k.charCode,10)){case B.DOWN_ARROW:if(l<=d){this.suggestionPopup.domNode.scrollTop=d;}else{if(l>m){this.suggestionPopup.domNode.scrollTop=m;}}break;case B.UP_ARROW:if(l<=d||l>m){this.suggestionPopup.domNode.scrollTop=m;}break;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.string","mstrmojo.Enum_Keys","mstrmojo.SimpleObjectInputBox");var D=mstrmojo.array,B=mstrmojo.dom,E=mstrmojo.Enum_Keys,A=mstrConfig.thousandsSep;var H={DEFAULT:1,ADDING:2,EMPTY:3,FULL:4};if(A===undefined){A=",";}var I;mstrmojo.TextBoxSelector=mstrmojo.declare(mstrmojo.SimpleObjectInputBox,null,{cssClass:"mstrmojo-TextBoxSelector",srcid:null,dataSourcesXML:null,maxItemWidth:"",preBuildRendering:function G(){this.set("maxItemWidth",parseInt(this.parent.contentNode.style.width,10));this._super();},prekeydown:function C(J){var L=J.e;switch(parseInt(L.keyCode||L.charCode,10)){case E.TAB:case E.ENTER:B.preventDefault(J.hWin,L);var M=this.inputBox.value;if(M){if(D.find(this.items,"v",M)===-1){this.onSuggestionItemSelect({n:M,v:M});}else{this.setDefaultState();}}break;case E.ESCAPE:this.setDefaultState();break;case E.BACKSPACE:if(!this.getSearchPattern()){B.preventDefault(J.hWin,L);var K=this.items&&this.items.concat();if(K&&K.length){K.splice(K.length-1,1);this.set("items",K);var N=this.id;window.setTimeout(function(){mstrmojo.all[N].set("state",H.ADDING);},0);}}break;}},prekeyup:function F(J){}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","VisualizationTransition","BaseVisualizationTransition","GridVisualizationTransition","GMVisualizationTransition","HeatMapVisualizationTransition","NetworkVisualizationTransition","MapVisualizationTransition","MapboxVisualizationTransition","ImageLayoutVisualizationTransition","CustomVisualizationTransition","KPICardVisualizationTransition");var B=mstrmojo.vi.viz;mstrmojo.vi.factories.VisualizationTransitionFactory=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.factories.VisualizationTransitionFactory",newVisualizationTransition:function A(D,F){var C=B.KnownVisualizations,E=C.getDefinition(D);if(E!==undefined){switch(E.id){case C.GRID:return new B.GridVisualizationTransition(F);case C.NETWORK:return new B.NetworkVisualizationTransition(F);case C.GRAPHMATRIX:case C.NEWGRAPHMATRIX:return new B.GMVisualizationTransition(F);case C.HEATMAP:return new B.HeatMapVisualizationTransition(F);case C.ESRIMAP:case C.GOOGLEMAP:return new B.MapVisualizationTransition(F);case C.MAPBOX:return new B.MapboxVisualizationTransition(F);case C.IMAGELAYOUT:return new B.ImageLayoutVisualizationTransition(F);case C.KPICARD:return new B.KPICardVisualizationTransition(F);case C.UNKNOWN:return new B.BaseVisualizationTransition(F);case C.CUSTOM:return new B.CustomVisualizationTransition(F);}}return null;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.num","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.color","mstrmojo.chart","mstrmojo.chart.common.Utility");mstrmojo.requiresClsP("mstrmojo.chart.enums","EnumGraphMajorType");mstrmojo.requiresClsP("mstrmojo.chart.model.enums","EnumDSSGraphObject");var p=mstrmojo,B=p.css,q=mstrmojo.array,Q=mstrmojo.hash,I=mstrmojo.num,H=mstrmojo.VisUtility,c=mstrmojo.chart,L=c.enums,d=L.EnumGraphMajorType,K=c.common.Utility,V=c.model,N=V.enums,x=N.EnumDSSGraphObject,AC=mstrmojo.VisEnum.ControlType,z=p.gm,W=mstrmojo.gm.EnumTextAlignH,s=mstrmojo.gm.EnumTextAlignV,w=";",l=",",A="_tmsp",M=" ",a=-20,m=mstrmojo.gm.EnumSelectionOptionLevel,AE=mstrmojo.gm.EnumShape,h=mstrmojo.color,J=mstrmojo.gm.EnumIdentityType,S=0.00001,E,b=Math.pow(2,30),e=Math.pow(2,60);var g=["Reserved",mstrmojo.desc(2125,"Maximum"),mstrmojo.desc(2127,"Minimum"),mstrmojo.desc(2122,"Average"),mstrmojo.desc(2126,"Median"),mstrmojo.desc(4046,"First"),mstrmojo.desc(4049,"Last"),mstrmojo.desc(7194,"Constant")];function n(AK,AJ){var AL,AI=AK.length;if(AI!==AJ.length){return false;}for(AL=0;AL<AI;AL++){if(AK[AL]!==AJ[AL]){return false;}}return true;}function AD(AL,AJ,AM){var AK=false,AN=AM+A,AI=AL[AN],AO=AJ[AN];if(AJ[AM]===undefined){AK=true;}else{if((AO===undefined&&AI!==undefined)||(AO!==undefined&&AI!==undefined&&AO<AI)){AK=true;}}if(AK){AJ[AM]=AL[AM];if(AO!==undefined){AJ[AN]=AI;}}}function AH(AJ,AI){var AK;for(AK in AJ){if(AJ.hasOwnProperty(AK)){AD(AJ,AI,AK);}}return AI;}function Y(AM){var AL={},AK,AJ=[],AI;q.forEach(AM,function(AN){if(AN!==undefined){AJ.push(AN);}});AI=AJ.length;if(AI===1){return AJ[0];}for(AK=0;AK<AI;AK++){AH(AJ[AK],AL);}return AL;}function AB(AI){return{n:AI,s:AI.toString(),on:AI};}function Z(AK,AI,AM){if(AI===AK){return 0;}var AJ=AI-AK,AL=1;while(AJ<1){AJ*=10;AL/=10;}while(AJ>=10){AJ/=10;AL*=10;}if(AJ<1.8){AL*=0.2;}else{if(AJ<3.1){AL*=0.4;}else{if(AJ<4.6){AL*=0.5;}else{if(AJ>=8.1){AL*=2;}}}}if(AM){AL=Math.round(AL);if(AL<1){AL=1;}}return AL;}function C(AL,AP,AR,AJ){var AN=[];if(AL===AP){if(AL<0){AN.push(mstrmojo.gm.GMUtility.formatNumber(AL,"nearest"));}AN.push({n:0,s:"0",on:0});if(AL>0){AN.push(mstrmojo.gm.GMUtility.formatNumber(AL,"nearest"));}return AN;}var AI=AJ>0?AJ:Z(AL,AP,AR);var AK=Math.ceil(AP/AI)*AI;if(AK-AP>=AI*0.9){AK=Math.floor(AP/AI)*AI;}var AO=Math.floor(AL/AI)*AI;if(AL-AO>=AI*0.9){AO=Math.ceil(AL/AI)*AI;}var AQ=Math.floor((AK-AO+AI/100)/AI)+1,AM;for(AM=0;AM<AQ;++AM){AN.push(mstrmojo.gm.GMUtility.formatNumber(AO+AM*AI,"nearest"));}return AN;}function U(AI,AL){var AK;AI.mMaxTick=1;if(this.mChartContextPtr.mIsGraphMatrix){AI.mStep=this.mMinimum<0?0.2:0.1;if(AL.mUseCustomMinMax){var AJ=AL;AI.mMaxTick=AJ.mAxisMaxValue;AI.mMinTick=AJ.mAxisMinValue;AI.mMaxTick=Math.min(1,AI.mMaxTick);AI.mMinTick=Math.max(-1,AI.mMinTick);AI.mStep=0.1;}else{if(this.mMaximum>=0.5){AI.mMaxTick=1;AI.mMinTick=Math.floor(this.mMinimum/AI.mStep)*AI.mStep;AI.mMinTick=(AI.mMinTick*this.mMinimum<0)?0:(AI.mMinTick>0?0:AI.mMinTick);if(this.mMinimum<-0.5){AI.mMinTick=-1;}}else{if(this.mMaximum>0){AI.mMaxTick=Math.ceil(this.mMaximum/AI.mStep)*AI.mStep;AI.mMinTick=-1;}else{AI.mStep=0.1;AI.mMaxTick=0;AI.mMinTick=-1;}}}}else{AI.mMinTick=(this.mMinimum<0)?-1:0;if(v.call(this,AI)){return ;}AI.mStep=this.mMajorGrid.mUseManualGrid?this.mMajorGrid.mGridInterval:(AI.mMaxTick-AI.mMinTick)/10;}for(AK=AI.mMinTick+AI.mStep;AK+c.gModuleMain.mTolerance<AI.mMaxTick;AK+=AI.mStep){AI.mTicks.push(Math.round(AK*100)/100);}}function P(AI,AN){var AM,AJ,AP=AN,AO=AP.mDrawCustomLine,AK=AP.mAxisCustomValue,AL;AI.mStep=1;if(this.mMaximum<=0){AI.mMinTick=1;AI.mMaxTick=10;if(AO&&AK<=1){AP.mAxisCustomValue=AI.mMinTick;}return ;}if(this.mMinimum<=0){AJ=this.mMaximum>1?0:-1;AI.mMinTick=Math.pow(10,AJ);if(AP.mUseCustomMinMax){AI.mMaxTick=this.mMaximum;AM=Math.floor(j.call(this,this.mMaximum));if(j.call(this,this.mMaximum)===AM){AM--;}}else{AM=Math.ceil(j.call(this,this.mMaximum));AI.mMaxTick=Math.pow(10,AM);}for(AL=AJ+1;AL<AM;++AL){AI.mTicks.push(Math.pow(10,Math.floor(AL)));}if(AO&&AK<=0){AP.mAxisCustomValue=Math.max(AI.mMinTick,AP.mAxisCustomValue);}return ;}if(AP.mUseCustomMinMax){AM=j.call(this,this.mMaximum);AJ=j.call(this,this.mMinimum);AI.mMaxTick=this.mMaximum;AI.mMinTick=this.mMinimum;}else{AM=Math.ceil(j.call(this,this.mMaximum));AJ=Math.floor(j.call(this,this.mMinimum));AI.mMaxTick=Math.pow(10,AM);AI.mMinTick=Math.pow(10,AJ);}for(AL=AJ+1;AL<AM;++AL){AI.mTicks.push(Math.pow(10,Math.floor(AL)));}if(AO&&AK<=0){AP.mAxisCustomValue=AI.mMinTick;}}function t(AS,AN){var AK=AN,AI,AL;AS.mStep=f.call(this,this.mMaximum,this.mMinimum,AK.mAlwaysIncludeZero);AS.mMaxTick=Math.ceil(this.mMaximum/AS.mStep)*AS.mStep;AS.mMinTick=Math.floor(this.mMinimum/AS.mStep)*AS.mStep;AS.mMaxTick=AS.mMaxTick<this.mMaxmum?this.mMaxmum:AS.mMaxTick;AS.mMinTick=AS.mMinTick>this.mMinimum?this.mMinimum:AS.mMinTick;AS.mMinTick=(AS.mMinTick*this.mMinimum<0)?0:AS.mMinTick;if(AK.mAlwaysIncludeZero){AS.mMaxTick=(this.mMaximum<0)?0:AS.mMaxTick;AS.mMinTick=(this.mMinimum>0)?0:AS.mMinTick;}var AM=AS.mMaxTick-AS.mMinTick;if(AS.mStep>=AM){return ;}if(v.call(this,AS)){return ;}AI=Math.floor((AS.mMaxTick-AS.mMinTick+AS.mStep/100)/AS.mStep)+1;var AO=this.mNumberFormat;for(AL=1;AL<AI-1;++AL){var AQ=AS.mMinTick+AL*AS.mStep,AR,AJ,AP;if(AS.mStep<1&&AO.mFormatType===4&&AO.mCustomFormat.indexOf("%")!==-1){AR=AQ*100;if(!K.isIntegar(AR)){AJ=Math.round(AR);AP=Math.abs(AR-AJ);if(AP<S){AQ=AJ/100;}}}AS.mTicks.push(AQ);}}function D(AS,AM){var AR=AM,AL,AI,AP,AK,AO,AN,AJ,AQ;AS.mMaxTick=AR.mAxisMaxValue;AS.mMinTick=AR.mAxisMinValue;if(v.call(this,AS)){return ;}if(!X.call(this)||this.mMajorGrid.mUseManualGrid){AS.mStep=f.call(this,AS.mMaxTick,AS.mMinTick,false);AL=AS.mMaxTick-AS.mMinTick;if(AS.mStep>=AL){return ;}AI=Math.floor(AL/AS.mStep);if(!(this.mChartContextPtr.mIsTimeSeriesChart)&&AL===AI*AS.mStep){for(AK=1;AK<AI;++AK){AS.mTicks.push(AS.mMinTick+AK*AS.mStep);}}else{AL=AS.mMaxTick-AS.mMinTick;AP=10;AO=false;for(AK=3;AK<AI;++AK){AN=AL/AK;while(AN<1){AN*=10;}while(AN>=10){AN/=10;}if(AN===Math.floor(AN)){AP=AK;AO=true;break;}}if(AO){AS.mStep=AL/AP;for(AK=1;AK<AP;++AK){AS.mTicks.push(AS.mMinTick+AK*AS.mStep);}}else{AJ=Math.ceil((AS.mMinTick+AS.mStep/100)/AS.mStep)*AS.mStep;AQ=Math.floor((AS.mMaxTick-AS.mStep/100-AJ)/AS.mStep)+3;for(AK=0;AK<AQ-2;++AK){AS.mTicks.push(AJ+AK*AS.mStep);}}}}else{AL=AS.mMaxTick-AS.mMinTick;AP=10;for(AK=6;AK<=9;++AK){AN=AL/AK;while(AN<10){AN*=10;}while(AN>=100){AN/=10;}if(AN===Math.floor(AN)){AP=AK;break;}}AS.mStep=AL/AP;for(AK=1;AK<AP;++AK){AS.mTicks.push(AS.mMinTick+AK*AS.mStep);}}}function F(AI,AM){var AL,AJ,AK;AI.mMaxTick=AM.mAxisMaxValue;if(AI.mMaxTick<=this.mMinimum){this.mMinimum=AI.mMaxTick-1;}AI.mStep=f.call(this,AI.mMaxTick,this.mMinimum,AM.mAlwaysIncludeZero&&(AI.mMaxTick>0));AL=(AM.mAlwaysIncludeZero&&(this.mMinimum>0))?0:this.mMinimum;if(X.call(this)){AI.mMinTick=AI.mMaxTick-Math.ceil((AI.mMaxTick-AL)/AI.mStep)*AI.mStep;}else{AI.mMinTick=Math.floor(AL/AI.mStep)*AI.mStep;}if(v.call(this,AI)){return ;}AJ=Math.floor((AI.mMaxTick-AI.mStep/100-AI.mMinTick)/AI.mStep)+2;for(AK=1;AK<AJ-1;++AK){AI.mTicks.push(AI.mMinTick+AK*AI.mStep);}}function k(AI,AN){var AJ,AM,AK,AL;AI.mMinTick=AN.mAxisMinValue;if(AI.mMinTick>=this.mMaximum){this.mMaximum=AI.mMinTick+1;}AI.mStep=f.call(this,this.mMaximum,AI.mMinTick,AN.mAlwaysIncludeZero&&(AI.mMinTick<0));AJ=(AN.mAlwaysIncludeZero&&(this.mMaximum<0))?0:this.mMaximum;if(X.call(this)){AI.mMaxTick=AI.mMinTick+Math.ceil((AJ-AI.mMinTick)/AI.mStep)*AI.mStep;}else{AI.mMaxTick=Math.ceil(AJ/AI.mStep)*AI.mStep;}if(v.call(this,AI)){return ;}AM=Math.ceil((AI.mMinTick+AI.mStep/100)/AI.mStep)*AI.mStep;AK=Math.floor((AI.mMaxTick-AM+AI.mStep/100)/AI.mStep)+2;for(AL=0;AL<AK-2;++AL){AI.mTicks.push(AM+AL*AI.mStep);}}function f(AY,AS,AK){var AR,AM;if(this.mMajorGrid.mUseManualGrid){return this.mMajorGrid.mGridInterval;}AR=0;if(AK){AR=Math.max(AY,AY-AS);AR=Math.max(AR,-AS);}else{AR=AY-AS;}if(AR===0){this.mIsShown=false;return 1;}if(AR>=1&&AR<=4&&parseInt(AR)===AR){var AZ=this.PrimaryMetricIndex,AN=AZ.length;for(var AU=0;AU<AN;AU++){var AQ=this.mChartContextPtr.mDatasetPtr,AT=AQ.dataProvider,AL=AT.getSeriesCount(),AP=AT.getGroupCount(),AJ=AZ[AU],AO,AW;for(var AX=0;AX<AL;AX++){AO=AT.getMetricIndexForSeries(AX);if(AO===AJ){AW=true;for(var AV=0;AV<AP;AV++){var Aa=AQ.GetData(AX,AV);if(parseInt(Aa)!==Aa){AW=false;break;}}}if(AW){return 1;}}}}var AI=AR;AM=1;while(AR<1){AR*=10;AM/=10;}while(AR>=10){AR/=10;AM*=10;}if(AR<1.8){AM*=2;AM/=10;}else{if(AR<3.1){AM*=4;AM/=10;}else{if(AR<4.6){AM*=5;AM/=10;}else{if(AR>=8.1){AM*=2;}}}}AM=this.postProcessStep(AM,AI);return AM;}function v(AI){if(this.mChartContextPtr.mIsGraphMatrix){return false;}var AJ=this.mMajorGrid;return AJ.mUseManualGrid&&(AJ.mGridInterval<(AI.mMaxTick-AI.mMinTick)/30);}function j(AI){return Math.log(AI)/Math.log(10);}function X(){return(this.mGraphMajorType===d.GMT_HISTOGRAM||this.mGraphMajorType===d.GMT_POLAR)&&this.mTripleId.mObjectId===x.DssGraphX1Body;}function AA(AL){var AM=this,AI=AM.id,AK=AL.metricId,AJ=new p.ui.menus.MenuConfig();(AL.options).forEach(function(AN){if(AN!==z.EnumRefLineModelType.CONST){AJ.addMenuItem(g[AN],"xt",function(){AM.toggleRefLineEnabled(AK,AN,true);});}else{AJ.addEditorMenuItem(g[z.EnumRefLineModelType.CONST],AI,function(){return new mstrmojo.ui.menus.EditorConfig({data:{},contents:[{scriptClass:"mstrmojo.ValidationTextBox",alias:"constVal",dtp:mstrmojo.expr.DTP.FLOAT,constraints:{trigger:mstrmojo.validation.TRIGGER.ONBLUR},onEnter:function(){this.validate();}}],fnOk:function(AP,AO){var AQ=AO.constVal;if(AQ.isValid()){AM.toggleRefLineEnabled(AK,AN,true,AQ.value);}}});});}});return AJ;}function u(AK){var AL=this,AJ=AK.metricId,AI=new p.ui.menus.MenuConfig();(AK.options).forEach(function(AO){var AM=AO.refType,AN=g[AM]+((AM===z.EnumRefLineModelType.CONST)?("-["+I.toLocaleString(AO.c)+"]"):"");AI.addMenuItem(AN,"xt",function(){AL.toggleRefLineEnabled(AJ,AM,false,0,AO.modix);});});return AI;}function AF(AM,AI){var AL=AM.GMController,AJ=AL.getForbiddenShapeForMetric(AI),AK=[];[{text:mstrmojo.desc(12097,"Bar"),value:AE.BAR},{text:mstrmojo.desc(2059,"Line"),value:AE.LINE},{text:mstrmojo.desc(9738,"Area"),value:AE.AREA},{text:mstrmojo.desc(12100,"Circle"),value:AE.CIRCLE},{text:mstrmojo.desc(12101,"Square"),value:AE.SQUARE},{text:mstrmojo.desc(12102,"Tick"),value:AE.TICK}].forEach(function(AN){if(AJ.indexOf(AN.value)<0){AK.push(AN);}});if(AL.chartType===mstrmojo.gm.EnumGraphType.BAR||AL.chartType===mstrmojo.gm.EnumGraphType.LINE){AK=AK.filter(function(AN){return AN.value!==AE.AREA;});}return AK;}function r(AJ,AI){return function(AL,AK){if(AL!==AK){AI({ctxt:{sp:AL,mid:AJ}});}};}function AG(AL){var AJ=AL.options,AI=this.getMenuHandler("changeShape"),AK=new mstrmojo.ui.menus.MenuConfig();AK.addRadioMenuGroup(AL.currValue,r(AL.metricId,AI),AJ,"checkMark",undefined,true);return AK;}mstrmojo.gm.GMUtility=mstrmojo.provide("mstrmojo.gm.GMUtility",{mTimers:[],mUseTimer:true,timerId:0,timerHistory:[],timerHistoryMax:50,startTimer:function R(AJ){if(this.mUseTimer){var AI=this.timerId++;this.mTimers.push({timeStamp:new Date(),timerId:AI,desc:AJ.functionName+": "+AJ.purpose});return AI;}},endTimer:function G(AM,AO){if(this.mUseTimer){var AJ,AK=this.mTimers,AP=0;if(AM===undefined){AJ=AK.pop();}else{var AN,AQ;for(AN=0;AN<AK.length;AN++){AQ=AK[AN];if(AQ.timerId===AM){AJ=AQ;AK.splice(AN,1);AN--;}}}if(AJ){var AI=new Date();var AL=(AI-AJ.timeStamp);if(AO){this.timerHistory[this.timerId%this.timerHistoryMax]={desc:AJ.desc,duration:AL,start:AJ.timeStamp.getTime(),end:AI.getTime()};}H.visPrint("%c"+AJ.desc+": "+AL+"ms","color: blue");AP=new Date()-AJ.timeStamp;}return AP;}},computeTicksForPercentchart:function(AJ,AI,AK){return C(AJ,AI,false,AK);},computeTicksForFlexMinMax:function(AJ,AI,AK,AL){return C(AJ,AI,AK,AL);},formatNumber:function(AK,AJ,AI){return AB(AK,AJ,AI===undefined?3:AI);},sizeCalculator:{sum:function(AI,AM,AN){var AK,AJ=0,AL=0;if(AN===undefined){AN=AI.length;}AM=AM||1;for(AK=0;AK<AN;AK++){if(AI[AK]>0){AL+=AI[AK];AJ+=1;}}if(AJ>1){AL+=(AJ-1)*AM;}return AL;},add:function(AK,AI,AJ){AJ=AJ||1;if(AI>0){AK+=(AI+AJ);}return AK;},minus:function(AK,AI,AJ){if(AI>0){AK-=(AI+AJ);}return AK;}},replaceSpecialChars:function(AI){return AI.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");},restoreSpecialChars:function(AI){return AI.replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&amp;/g,"&");},removeExtraSpace:function(AI){return AI.replace(/ {2,}/g," ");},stringToJSON:function(AI){if(AI===undefined){return undefined;}if(typeof AI==="string"){AI=AI.replace(/'/g,'"');try{return JSON.parse(AI);}catch(AJ){return AI;}}return AI;},everythingToString:function(AJ){if(AJ===undefined){return undefined;}var AI;if(typeof AJ==="object"){AI=JSON.stringify(AJ.jsonObj||AJ);}else{AI=AJ.toString();}AI=AI.replace(/"/g,"'");return AI;},compareElementObj:function(AM,AJ){var AL=AM.tid.toString(),AI=AJ.tid.toString(),AN=AM.eid,AK=AJ.eid;if(AL!==AI){return AL>AI?1:-1;}if(AN===AK){return 0;}return AN>AK?1:-1;},isEqualComb:function(AJ,AI){var AN=true,AM,AL=AJ.length,AK=AI.length;if(AL!==AK){return false;}if(AJ.length>1){AJ.sort(this.compareElementObj);}if(AI.length>1){AI.sort(this.compareElementObj);}for(AM=0;AM<AL;AM++){if(this.compareElementObj(AJ[AM],AI[AM])!==0){AN=false;break;}}return AN;},serializeCombination:function(AJ){var AI="";if(AJ.length>1){AJ.sort(this.compareElementObj);}q.forEach(AJ,function(AK){if(AI!==""){AI+=w;}AI+=(AK.tid+l+AK.eid);});return AI;},deserializeCombination:function(AJ){var AK=AJ.split(w),AI=[];q.forEach(AK,function(AO){var AL=AO.split(l);var AN=AL[0];var AM=AL[1];AI.push({tid:AN,eid:AM});});return AI;},getElementCombinationForMetric:function(AI){var AJ=[];AJ.push({tid:-1,eid:AI});return AJ;},getResolvedFormatsObject:function(AI){return Y(AI);},isDigitalArrayEqual:function(AJ,AI){return n.call(this,AJ,AI);},indexOf:function(AJ,AL){var AK,AI=AJ.length;for(AK=0;AK<AI;AK++){if(n(AJ[AK],AL)){return AK;}}return -1;},parseAxisScaleData:function(AM){var AK,AN,AJ,AI=AM.split(","),AL=[];for(AK=0,AN=AI.length;AK<AN;AK++){AJ=AI[AK].split(":");AL.push(AJ);}return AL;},parseCSSColor:function(AM,AJ){var AL=AM.slice(1),AI=[],AK;if(AL.length===6){if(AJ===true){AI[0]=AL[4];AI[1]=AL[5];AI[2]=AL[2];AI[3]=AL[3];AI[4]=AL[0];AI[5]=AL[1];}else{for(AK=0;AK<6;AK++){AI[AK]=AL[AK];}}}else{if(AJ===true){for(AK=2;AK>=0;AK--){AI.push(AL[AK]);AI.push(AL[AK]);}}else{for(AK=0;AK<3;AK++){AI.push(AL[AK]);AI.push(AL[AK]);}}}return parseInt("0x"+AI.join(""),16);},RGB_BRG_Switch:function(AJ){var AL=(AJ>>16)&255,AK=(AJ>>8)&255,AI=(AJ>>0)&255;return(AI<<16)|(AK<<8)|(AL<<0);},encodeColor:function(AJ){if(AJ===undefined||AJ===null||AJ==="transparent"||AJ==="default"){return AJ;}var AK=false,AI={};if(AK){if(typeof AJ==="object"){AI.c1=this.RGB_BRG_Switch(h.encodeColor(AJ.c1));AI.c2=this.RGB_BRG_Switch(h.encodeColor(AJ.c2));AI.or=AJ.or;return AI;}return this.RGB_BRG_Switch(h.encodeColor(AJ));}if(typeof AJ==="object"){AI.c1=h.encodeColor(AJ.c1);AI.c2=h.encodeColor(AJ.c2);AI.or=AJ.or;return AI;}return h.encodeColor(AJ);},checkEquality:function(AJ,AI){if(typeof AJ==="object"&&AJ.c1!==undefined){if(AJ.c1!==AI.c1){return false;}if(AJ.c2!==AI.c2){return false;}if(AJ.or!==AI.or){return false;}return true;}return AJ===AI;},decodeColor:function(AJ){if(AJ===undefined||AJ===null||AJ==="transparent"||AJ==="default"){return AJ;}var AK=false,AI={};if(AK){if(typeof AJ==="object"){AI.c1=h.decodeColor(this.RGB_BRG_Switch(AJ.c1));AI.c2=h.decodeColor(this.RGB_BRG_Switch(AJ.c2));AI.or=AJ.or;return AI;}return h.decodeColor(this.RGB_BRG_Switch(AJ));}if(typeof AJ==="object"){AI.c1=h.decodeColor(AJ.c1);AI.c2=h.decodeColor(AJ.c2);AI.or=AJ.or;return AI;}return h.decodeColor(AJ);},getTrendLineToggleHandler:function(AI,AK,AJ){return function(){AI.switchOnOffTrendLineForMetric(AK,AJ);};},getTrendLineToggleState:function(AI,AJ){return AI.queryTrendLineStatusForMetric(AJ);},getEditTrendLineHandler:function(AI,AJ){return function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");AI.raiseEventCMSelection(J.TREND_LINE,AJ);};},getEditRefLineHandler:function(AI,AJ){return function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");AI.raiseEventCMSelection(J.REF_LINE,AJ);};},getEditAxisScaleHandler:function(AI,AJ){return function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");AI.raiseEventCMSelection(J.AXIS_SCALE,AJ);};},getEditAxisOriginHandler:function(AI,AJ){return function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");AI.raiseEventCMSelection(J.AXIS_ORIGIN_DEFINE,AJ);};},getEditLogScaleHandler:function(AI,AJ){return function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");AI.raiseEventCMSelection(J.LOG_SCALE,AJ);};},getOptionObjArr:function(AI,AK,AM){if(!E){E=mstrmojo.gm.GMUtility;}var AJ={},AL;if(AK!==undefined){AK=AK.toLowerCase();if(AK==="x1"){AK="x";}else{if(AK==="y1"){AK="y";}}}if(AI.length>1||(AM&&AI.length===1)){if(AK==="x"){AJ.opt=mstrmojo.desc(11712,"Bottom Axis");AJ.key="XAxis";}else{if(AK==="x2"){AJ.opt=mstrmojo.desc(11710,"Top Axis");AJ.key="X2Axis";}else{if(AK==="y"){AJ.opt=mstrmojo.desc(11715,"Left Axis");AJ.key="YAxis";}else{if(AK==="y2"){AJ.opt=mstrmojo.desc(11713,"Right Axis");AJ.key="Y2Axis";}else{if(AK==="z"){AJ.opt=mstrmojo.desc(12090,"SizeBy");AJ.key="SizeBy";}}}}}AJ.optLvl=m.AXIS;AJ.mos=this.getMetricFormatFromIndexArray(AI);}else{if(AI.length===1){AL=this.getMetricFormat(AI[0]);AJ.opt=AL.n;AJ.mos=[AL];AJ.key=AL.mId;AJ.comb=E.getElementCombinationForMetric(AL.mId);AJ.optLvl=m.METRIC;if(AK==="z"){AJ.sizeBy=true;}}}return AJ;},filterInValidMetricIndex:function(AJ){var AI=[];q.forEach(AJ,function(AK){if(AK!==a){AI.push(AK);}});return AI;},fillBackgroundDiv:function(AJ){var AI=document.createElement("div");AI.setAttribute("class","gm-bk-div");AI.style.backgroundColor="rgba(0,0,0,0)";AJ.appendChild(AI);},getSubMenu:function(AN,AO,AM,AL){var AK=AF(AN,AL),AI=AN.getMenuHandler("changeShape"),AJ=AN.GMController.getOnTheFlyShapeForMetric(AL);if(AK.length>1){AO.addSubMenuItem(mstrmojo.desc(11972,"Change Shape"),"",AN.id,AG,{currValue:AJ,options:AK,metricId:AM});}else{AO.addRadioMenuGroup(AJ,r(AM,AI),AK,"checkMark",undefined,true);}},getReferenceLineSubMenu:function(AJ,AN,AO,AI){var AP=mstrmojo.gm.EnumSubtype,AM=AJ.GMController.chartSubType;if(AO&&AM===AP.PERCENT){return ;}var AQ=AJ.id,AK=AJ.getAvailableRefLineTypes(AI)||[];if(AK.length>0){AN.addSubMenuItem(mstrmojo.desc(13021,"Add Reference Line"),"xt",AQ,AA,{metricId:AI,options:AK});}var AL=AJ.getExistingRefLineOptions(AI)||[];if(AL.length>0){AN.addMenuItem(mstrmojo.desc(13659,"Edit Reference Line"),"xt",E.getEditRefLineHandler(AJ,AI));AN.addSubMenuItem(mstrmojo.desc(13022,"Remove Reference Line"),"xt",AQ,u,{metricId:AI,options:AL});}},reverseMapping:function o(AJ){var AL={},AK,AI=AJ.length;for(AK=0;AK<AI;AK++){AL[AJ[AK]]=AK;}return AL;},longIntAnd:function(AJ,AI){var AK;if(AJ===AI){return AJ;}if(AJ>e||AI>e){throw new Error("Operand exceeds valid data range.");}if(AJ<b&&AI<b){return AJ&AI;}if(AJ>=b||AI>=b){if(AJ<AI){AK=AJ;AJ=AI;AI=AK;}}var AM=Math.floor(AJ/b),AL=Math.floor(AI/b),AO=AJ-AM*b,AN=AI-AL*b;return(AO&AN)+(AM&AL)*b;},longIntOr:function(AJ,AI){var AK;if(AJ===AI){return AJ;}if(AJ<b&&AI<b){return AJ|AI;}if(AJ<AI){AK=AJ;AJ=AI;AI=AK;}AK=this.longIntAnd(AJ,AI);return AI-AK+AJ;},parseNumeric:function(AI){return +AI||parseFloat(AI);},fillImageInDiv:function(AL,AK,AJ,AI){AI=AI||"gm-img";AL.innerType=AK;if(AK===4){AL.innerHTML="<img class="+AI+' src="'+AJ+'"/>';}else{if(AK===7){AL.innerHTML=AJ;B.addClass(AL.firstChild,AI);}}},fillTextInDiv:function(AI,AR,AT,AJ,AU,AK,AW,AM,AP){if(AJ===undefined){AJ=AI.offsetWidth;}if(AU===undefined){AU=AI.offsetHeight;}if(AM===undefined){AM=W.MIDDLE;}if(AP===undefined){AP=s.MIDDLE;}if(AK===undefined){AK=false;}AT=this.replaceSpecialChars(AT);var AQ,AS,AO,AV=AK?"gm-text-body":"gm-text-body-nowrap",AL=false,AN;AQ=H.measureTextWidth(AT,AW,6);AN=H.measureTextWidth("...",AW,6);if(AQ>AJ&&AN>AJ){return ;}AO=document.createElement("div");AO.setAttribute("class",AV);AO.setAttribute("type",AC.GM_TEXT_BODY);AO.identity=AR;H.applyStyles2DomNode(AO,AW);AO.innerHTML=AT;AI.appendChild(AO);if(AK){if(AQ>AJ){AS=AO.offsetHeight;}else{AS=H.measureTextHeight(AT,AW,4);}}else{AS=H.measureTextHeight(AT,AW,4);AL=AQ>AJ;}AQ=Math.min(AQ,AJ);AO.style.width=AQ+"px";if(AK){AL=AO.scrollWidth>AQ||AO.scrollHeight>AS;}if(AL){AO.setAttribute("title",AT);}else{AO.setAttribute("title","");}switch(AM){case W.LEFT:AO.style.left="0px";AO.style.textAlign="left";break;case W.MIDDLE:AO.style.left=((AJ-AQ)>>1)+"px";break;case W.RIGHT:AO.style.right="0px";AO.style.textAlign="right";break;}switch(AP){case s.TOP:AO.style.top="0px";break;case s.MIDDLE:AO.style.top=((AU-AS)>>1)+"px";break;case s.BOTTOM:AO.style.bottom="0px";break;}},updateTextColorAndAlignment:function(AI,AK,AL){var AM=AI.firstChild,AN=AM.style,AJ=AI.clientWidth,AO=AM.clientWidth,AQ=AI.clientHeight,AP=AM.clientHeight;AN.left="auto";AN.right="auto";switch(AK){case W.LEFT:AN.left="0px";break;case W.MIDDLE:AN.left=((AJ-AO)>>1)+"px";break;case W.RIGHT:AN.right="0px";break;}AN.top="auto";AN.bottom="auto";switch(AL){case s.TOP:AN.top="0px";break;case s.MIDDLE:AN.top=((AQ-AP)>>1)+"px";break;case s.BOTTOM:AN.bottom="0px";break;}},toggleDisplay:function(AJ,AI){if(!AJ){return ;}if(AI){AJ.style.display="block";}else{AJ.style.display="none";}},isTrendLineAvailableForMetric:function(AM,AN,AQ){var AX=AM&&AM.excludeData,AU=mstrmojo.gm.EnumSubtype,AP=p.gm.EnumShape,AV=AM.GMController,AR=AV.chartSubType,AW=AM.model.data.dz,AK=AW.XAxis,AI=AW.YAxis,AL=AW.BreakBy,AO=AW.SliceBy,AS=AQ,AJ=AV.getChartInfo(),AT=AV.getBreakByAttrsID().length>0||(AJ.isABL&&((AK.MetricNames!==undefined)||(AI.MetricNames!==undefined)||(AL.MetricNames!==undefined)||(AO.MetricNames!==undefined)));if(AS===undefined){AS=AV.getOnTheFlyShapeForMetric(AN);}if(AJ.isABL&&AR===AU.PERCENT){AX=true;}if(AT&&!AJ.isBubbleOrScatter&&(AS===AP.BAR||AR===AU.STACKED||(AR===AU.AUTO&&AS===AP.AREA))){AX=true;}if(AJ.isABL){if(AK.TemplateUnit&&AK.TemplateUnit.length>1){AX=true;}if(AI.TemplateUnit&&AI.TemplateUnit.length>1){AX=true;}if(AK.TemplateUnit===undefined&&AI.TemplateUnit===undefined){AX=true;}}AX=AX||this.isIgnoredMetric(AM,AN);return !AX;},isTrendLineAvailableForAnyMetric:function(AK){var AJ=AK.model.data.gsi.mx,AI;for(AI in AJ){if(this.isTrendLineAvailableForMetric(AK,AI)){return true;}}return false;},isIgnoredMetric:function(AL,AJ){var AK=AL.GMController,AM,AI;if(AK.bubbleSeriesNum!==undefined){AM=AK.getMetricsOnYAxis();AI=AM.indexOf(AJ);if(AI>=AK.bubbleSeriesNum){return true;}AM=AK.getMetricsOnXAxis();AI=AM.indexOf(AJ);if(AI>=AK.bubbleSeriesNum){return true;}}return false;},getAxisMetricsInfo:function(AN){var AI=AN.model.data.dz,AO=AN.model.data.gsi.mx,AJ,AK,AM=[];if(!AI||!AI.ColorBy||!AO){return AO;}var AL=function(AP){return(AP&&AP.TemplateMetric)||[];};AJ=AL(AI.YAxis).concat(AL(AI.XAxis));q.forEach(AO,function(AP){AK=false;q.forEach(AJ,function(AQ){if(AP.did===AQ.id){AK=true;return false;}});if(AK){AM.push(AP);}});return AM;},isInvalidTemplate:function O(AL){if(AL.eg){return false;}var AJ=AL.gts;var AI=AJ.row.length===0&&AJ.col.length===0;q.forEach(AJ.row,function(AO){if(AO.otp===-1){AI=true;}});var AN=AJ.col;if(AN.length>0){var AK,AM=AN.length-1;for(AK=0;AK<AM;AK++){if(AN[AK].otp===-1){AI=true;}}}return AI;},isNoData:function(AI){return AI.eg!==undefined;},getInvalidTemplateErrMsg:function(AI){return AI||mstrmojo.desc(12094,"The Graph Matrix requires:")+"\n"+mstrmojo.desc(12095,"- at least one attribute to be placed on the row or column axis")+"\n"+mstrmojo.desc(12096,"- all metrics to be placed on the column axis, below any attributes");},initColorPickerBtnWithGradientDir:function(AJ,AK){mstrmojo.func.override({showPickerForCurrentMode:function AI(){this._super();if(this.pickerMode===2&&typeof this.color!=="object"){var AL=this.gradientOrientation,AM=AK.getChartInfo().dirc===mstrmojo.gm.EnumABLDirection.VERTICAL;AL.set("selectedIndex",q.find(AL.items,"id",AM?0:1));}}},AJ.colorPicker);},generateToolTipContent:function(AR,AM,AI,AN,AP,AO,AU){var AL,AJ,AK,AQ,AS,AT;for(AL=AR;AL<AM;AL++){AJ=AN[AL];AQ=AP[AL];if(AL>AR){AK=AN[AL-1];AS=AP[AL-1];if(AJ.id===AK.id){if(AQ===""){continue;}if(AJ.fid===AK.fid&&AQ.idx===AS.idx){continue;}if(AJ.n===""){AO[AO.length-1].v+=M+AQ.n;continue;}}}if(AU){AO.push({n:AJ.n,tid:AJ.id,v:AQ.n});}else{AT=AI===undefined?AJ.isRowAttribute:AI;AO.push({n:AJ.n,tid:AJ.id,v:AQ.n,eid:AQ.id,tp:AJ.otp,axis:AT?1:2,tui:AJ.tui,ui:AJ.tui,dpt:AJ.tui+1,at:AQ.at,isRowAttribute:AT,dei:AQ.dei,o:AQ.o});}}},getAttributeFormCnt:function(AI){var AJ;if((AI.fcnt===undefined||AI.fcnt===null)&&AI.fs){AI.fcnt=AI.fs.length||1;}if(AI.fcnt!==undefined&&AI.fcnt!==null){AJ=AI.fcnt;}else{if(AI.t===47){AJ=1;}else{AJ=AI.cs!==undefined?AI.cs:AI.rs;}}return AJ;},isTrueForBoolValue:function(AI){return AI===true||AI==="true";},computeTicksForAxis:function(AL,AJ){var AK=AL.mOptions,AM,AI={mTicks:[]};if(AJ){AM=Q.copy(AK);Q.copy(AJ,AM);}else{AM=AK;}if(AL.mIsPercent){U.call(AL,AI,AM);return AI;}if(AM.mUseLogarithmicScale){P.call(AL,AI,AM);return AI;}if(AL.mGraphMajorType===d.GMT_BUBBLE&&AL.mTripleId.mObjectId===x.DssGraphZBody){AI.mMinTick=AM.mUseMinValue?AM.mAxisMinValue:AL.mMinimum;AI.mMaxTick=AM.mUseMaxValue?AM.mAxisMaxValue:AL.mMaximum;if(AL.mMinTick>=AL.mMaxTick){AI.mMaxTick=AI.mMinTick+1;}return AI;}if(!AM.mUseMaxValue&&!AM.mUseMinValue){t.call(AL,AI,AM);}else{if(AM.mUseMaxValue&&AM.mUseMinValue){D.call(AL,AI,AM);}else{if(AM.mUseMaxValue){F.call(AL,AI,AM);}else{k.call(AL,AI,AM);}}}return AI;},computeTicksForLogScale:function(AK){var AJ=AK.mOptions,AI={mTicks:[]};P.call(AK,AI,AJ);return AI;},destroyDisposable:function(AI,AJ){if(AJ){q.removeItem(AI.disposables,AJ);AJ.destroy();}},handleDestroy:function(AM,AL,AJ){if(!AM){return ;}var AN,AK=0,AI=AM.disposables,AO=(AI&&AI.length)||0;while(AK<AO){AN=AI[AK];if((!AN.scriptClass||AL.indexOf(AN.scriptClass)<0)&&q.indexOf(AJ,AN.id)===-1){this.destroyDisposable(AM,AN);}if(AI.length<AO){AO=AI.length;}else{AK++;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.hash","mstrmojo.Box","mstrmojo.Button","mstrmojo.Dial","mstrmojo.Editor","mstrmojo.FilterExpr","mstrmojo.HBox","mstrmojo.Label","mstrmojo.Obj","mstrmojo.CheckBox","mstrmojo.mstr.EnumNodeProperties","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.fe.FilterExprTree","mstrmojo.fe.RelationFilterExprTree","mstrmojo.fe.CreateSetEditor","mstrmojo.fe.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.StatusButton");var a=mstrmojo.expr,I=a.ET,O=a.BRANCH_FNS,Y=mstrmojo.Obj,X=mstrmojo.dom,b=mstrmojo.array,S=mstrmojo.hash,e=mstrmojo.css,F=mstrmojo.mstr.EnumNodeProperties,C=mstrmojo.warehouse.EnumObjectTypes,K={TEMPLATE:0,DATASET:1},E=mstrmojo.mstr.EnumNodeDimty,Q=b.hash([E.NodeDimtyUnspecified,E.NodeDimtyNone]),M=200,H=mstrmojo.ui.PopupConfig.ENUM_CORNERS;function Z(){var h=this.avatar;if(h){h.parentNode.removeChild(h);delete this.avatar;e.removeClass(h,[this.avatarCssClass]);}}mstrmojo.fe.FilterEditorBase=mstrmojo.declare(mstrmojo.Editor,null,{onSave:null,onCancel:null,title:mstrmojo.desc(12032,"View Filter Editor"),help:"view_filter_editor_for_report_services_documents.htm",cssClass:"mstrmojo-charcoalboxe mstrmojo-FE",showLimits:true,objectBrowsingEnabled:false,children:null,showCondWalk:false,isNewCond:false,vizTitle:"",init:function U(h){this.children=[{alias:"feContent",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-content",postCreate:function(){this.children=[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-exprTool",children:[{scriptClass:"mstrmojo.ui.StatusButton",cssClass:"mstrmojo-FE-addCondition",postCreate:function j(){this.editor=this.parent.parent.parent;this.statusList=this.editor.getAddConditionList();this.status=this.statusList[0];},onButtonClick:function(k){if(k){k.handler.apply(this.editor);}}}]},this.parent.getExpressionContainerCfg()];}},this.getConditionWalkConfig(),{alias:"buttonBar",scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",slot:"buttonNode",toggleBtnStatus:function(j){this.children[0].btnSave.set("enabled",j);this.children[0].btnCancel.set("enabled",j);},children:[{scriptClass:"mstrmojo.HBox",cssText:"float:right; border-collapse: separate",cellSpacing:3,children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),alias:"btnSave",onclick:function(){var j=this.editor;j.save();j.close();},bindings:{enabled:function(){return !this.editor.readOnly;},editor:"this.parent.parent.parent"}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"btnCancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var j=this.editor;if(j.onCancel){j.onCancel(j.model);}j.close();},bindings:{editor:"this.parent.parent.parent"}}]}]}];this._super(h);this.model=this.model||new Y();},save:function W(){var h=this.model;h.expr=f(h.exprForest);h.limitExpr=f(c(h.limitExprForest));this.onSave(h);},getExpressionContainerCfg:function(){var h=this;return{alias:"feExpr",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-FE-expr-list",postCreate:function(){this.children=h.getExpressionContentsConfig();},onRender:function(){X.attachMarkupEvent(this.id,this.domNode,"mousedown");},onmousedown:function(j){var k=X.eventTarget(j.hWin,j.e);if(this.isBlankArea(k)){this.clearSelect();}},isBlankArea:function(j){return j===this.domNode;},clearSelect:function(){}};},getExpressionContentsConfig:function(){return[];},getConditionWalkConfig:function(){var j=this;return{scriptClass:"mstrmojo.rw.ConditionWalk",width:"750px",objectBrowsingEnabled:false,dimtyTypes:Q,alias:"walk",visible:false,onOK:function h(){var l=this.condition;j.feContent.set("visible",true);this.set("visible",false);j.onConditionEdit(l,this.model.get());j.toggleButtonStatus(true);j.set("showCondWalk",false);},close:function k(){j.feContent.set("visible",true);this.set("visible",false);var l=this.condition;if(l&&l.isEmpty()){l.del();}j.toggleButtonStatus(true);j.set("showCondWalk",false);},targets:null,targetsLastMod:null,ets:null,condition:null,bindings:{disableElementsBrowsing:"this.parent.disableElementsBrowsing"}};},onConditionEdit:function(j,h){j.tree.modifyConditionNode(j,h);},getAddConditionList:function d(){return[{n:mstrmojo.desc(1994,"Add Condition"),handler:function(){this.mainExpr.newCondition(null,true);}}];},toggleButtonStatus:function B(h){this.buttonBar.toggleBtnStatus(h);},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-FE-andOrPopup mstrmojo-CGE-andOrPopup mstrmojo-ConditionWalk",contentNodeCssClass:"mstrmojo-balloon",slot:"containerNode",modal:false,autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var h=this.condition,l=h&&h.data&&h.data.not,m=h&&h.parent,j=m&&m.data,k=(j&&j.fn)+(l?21:0);this.list.opening=true;this.list.set("selectedItem",isNaN(k)?null:{did:k});this.list.opening=false;},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",renderOnScroll:false,items:[{did:19,n:O[19]},{did:20,n:O[20]},{did:19+21,n:O["19_21"]},{did:20+21,n:O["20_21"]}],onchange:function(){if(this.opening){return ;}var j=this.parent,h=j.condition,o=this.selectedItem,n=o&&o.did,m=n>21?true:null,l=n-(m?21:0);j.close();var k=h&&h.parent;if(k&&k.data&&k.data.et===I.ANDOR){k.edit(h,l,m);}else{var p=h&&h.data;if(p&&(p.not!==m)){p.not=m;h.paint();}}}}]},createSetPopupRef:{scriptClass:"mstrmojo.fe.CreateSetEditor",contentNodeCssClass:"",cssClass:"CreateSet-Editor",title:mstrmojo.desc(12034,"Create a Set"),slot:"containerNode"},_set_busy:function(j,h){if(h){this.set("enabled",false);this.set("iconClass","mstrmojo-WaitIcon");}else{this.set("enabled",true);this.set("iconClass","");}},_set_model:function(m,j){var k=this.model,l=k!==j;if(l){this.model=j;this.modelLastSet=new Date();var h=function(n){return P(J(n));};j.exprForest=h(j.expr);j.limitExprForest=h(j.limitExpr);if(this.feContent&&this.feContent.feExpr.ve){this.feContent.feExpr.ve.nameFactory.clear();}}return l;},onUpdateBrowseElementsParams:mstrmojo.emptyFn,openWalk:function(q,r,v,w){var t=this,j=X.delta(r.domNode,t.containerNode);j.y+=(v==="andor"?16:parseInt(r.domNode.offsetHeight,10));var u={condition:r,zIndex:t.zIndex+10,left:j.x+"px",top:j.y+"px"},h;switch(v){case"andor":if(t.skipAndOrPopup){return ;}h="andOrPopupRef";break;case"createSet":case"createSetOpt":if(w&&w.e&&w.e.target){var m=w&&w.e&&w.e.target,p=X.delta(m,t.containerNode);u.left=p.x+"px";u.top=p.y+parseInt(m.offsetHeight,10)+"px";}var s=t.model.targets;h="createSetPopupRef";u.type=v;u.model={attrs:b.filter(s,function(n){return n.t===C.ATTRIBUTE;}),metrics:b.filter(s,function(n){return n.t===C.METRIC;})};if(v==="createSetOpt"){u.condition=r.parent;u.model.childIdx=r.childIndex();}break;case"condition":var o=t.walk,k=r.textNode.cloneNode(true),l=o.conditionNode.firstChild;e.removeClass(k,"editable");e.addClass(o.conditionNode,"mstrmojo-ConditionNode");if(l.firstChild){l.removeChild(l.firstChild);}l.appendChild(k);o.set("objectBrowsingEnabled",t.objectBrowsingEnabled);o.set("targets",t.model.targets);o.set("targetsLastMod",t.modelLastSet);o.set("ets",r.tree.validExprTypes||t.validExprTypes);o.set("condition",r);o.set("model",S.clone(q));o.set("hasPrompt",t.model.hasPrompt);o.set("disableElementsBrowsing",t.disableElementsBrowsing||o.disableElementsBrowsing);o.set("editor",t);o.set("inRelation",r.inRelation);t.feContent.set("visible",false);o.set("visible",true);o.columnWalk.target.updateScrollbars();t.toggleButtonStatus(false);t.set("showCondWalk",true);t.set("isNewCond",!!q.isNew);return ;}t.openPopup(h,u);}});mstrmojo.fe._isReportFilterEditor=mstrmojo.provide("mstrmojo.fe._isReportFilterEditor",{_mixinName:"mstrmojo.fe._isReportFilterEditor",getExpressionContainerCfg:function(){var h=this._super();return mstrmojo.mixin({clearSelect:function(){this.re.clearTreeSelect();}},h);},getExpressionContentsConfig:function(){return[{alias:"re",scriptClass:"mstrmojo.fe.ReportFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}}];}});mstrmojo.fe.ReportFilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,[mstrmojo.fe._isReportFilterEditor],{scriptClass:"mstrmojo.fe.ReportFilterEditor"});mstrmojo.fe.ReportFilterExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.ReportFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",onNew:function(h){h.data.isNew=true;this.editor.openWalk(h.data,h.widget.ctxtBuilder.itemWidgets[h.index],"condition");},onnodeclick:function A(h){var j=h.editor||this.tree.editor;j.openWalk(this.data,this,h&&h.part,h);},allowDrop:function G(h){var k=h&&h.src,m=k&&k.data,l=m&&m.et,j=k&&k.widget&&k.widget.tree;return l&&this!==j;}});mstrmojo.fe.FilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditorBase,null,{getExpressionContainerCfg:function(){var h=this._super();return mstrmojo.mixin({isBlankArea:function(j){if(this._super(j)){return true;}return !b.filterOne([this.ve,this.vle,this.re],function(k){if(k&&X.contains(k.domNode,j,true)){return true;}});},clearSelect:function(){this.ve.clearTreeSelect();this.vle.clearTreeSelect();}},h);},getExpressionContentsConfig:function(){return[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11746,"Dataset Level Conditions"),cssClass:"mstrmojo-FE-expr-header dl",bindings:{visible:"true || this.parent.parent.parent.showLimits"}},{alias:"ve",scriptClass:"mstrmojo.fe.RWViewFilterExprTree",level:K.DATASET,bindings:{items:"this.editor.model.exprForest || []"},onBlankClick:function(h){this.parent.clearSelect(h);},supportRelation:true,postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11747,"Template Level Conditions"),cssClass:"mstrmojo-FE-expr-header tl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"vle",scriptClass:"mstrmojo.fe.RWViewLimitExprTree",level:K.TEMPLATE,bindings:{visible:"this.editor.showLimits",items:"this.editor.model.limitExprForest || []"},onBlankClick:function(h){this.parent.clearSelect(h);},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("limitExpr",this);}}];},getConditionWalkConfig:function(){var h=this._super();S.copy({scriptClass:"mstrmojo.fe.ConditionWalk"},h);return h;},getAddConditionList:function d(){var h=this._super();h.push({n:mstrmojo.desc(12055,"Add Dynamic Condition"),handler:function(){this.mainExpr.newCondition({et:I.XML,idc:1,ph:{}},true);}});return h;},onConditionEdit:function(k,j){if(k.tree.level===k.level||k.tree.level===undefined){this._super(k,j);}else{k.parent.remove(k.data);var h=K.TEMPLATE===k.level?this.limitExpr:this.mainExpr;h.addSingleCondition(j);}}});mstrmojo.fe.RWViewFilterExprTree=mstrmojo.declare(mstrmojo.fe.RelationFilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewFilterExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-datasetExpr",levelSwitchValidTypes:[I.MQ],onNew:function(h){h.data.isNew=true;if(!h.data.ph){this.editor.openWalk(h.data,h.widget.ctxtBuilder.itemWidgets[h.index],"condition");}},onnodeclick:function A(j){var h=this.tree,l=j.editor||h.editor;this.level=h.level;var k=typeof (l.disableElementsBrowsing)==="function"&&l.disableElementsBrowsing();if(k&&this.data.et===I.AE){return ;}l.openWalk(this.data,this,j&&j.part,j);},ondragend:function N(k){var j=k&&k.tgt,h=j&&j.widget;if(this.tree&&h&&h.tree&&h.tree!==this.tree){Z.call(this);return ;}this._super(k);},getItemConfig:function(k,h,l){var j=this._super(k,h,l);return S.copy({getConditionTextPostfix:function(){if(this.data.et!==I.MQ){return"";}return'<img class="mstrmojo-moveToViewLimit" src="../images/1ptrans.gif" title="'+mstrmojo.desc(4978,"Move to view limit")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewLimit(w); return false;\" />";}},j);},moveMQNodeToViewLimit:function(k){if(b.indexOf(this.levelSwitchValidTypes,k.data.et)===-1){return ;}var j=S.copy(k.data);k.parent.remove(k.data);var h=this.editor.limitExpr;h.addSingleCondition(j);},allowDrop:function G(h){var k=h&&h.src,n=k&&k.data,m=n&&n.et,l=this.tree,j=k&&k.widget&&k.widget.tree;return m&&(this===l?(j!==l):true);}});mstrmojo.fe.RWViewLimitExprTree=mstrmojo.declare(mstrmojo.fe.FilterExprTree,null,{scriptClass:"mstrmojo.fe.RWViewLimitExprTree",cssClass:"mstrmojo-expr mstrmojo-FE-limitExpr",validExprTypes:b.hash([I.MQ]),levelSwitchValidTypes:[I.MQ],onnodeclick:function A(j){var h=this.tree,k=h.editor;this.level=h.level;k.openWalk(this.data,this,j&&j.part,j);},onConditionEdit:function(j,h){this._super(j,h);j.data.mdxUnitId=j.data.m.did;V(j);},addSingleCondition:function(j){var h=this._super(j);V(h);},allowDrop:function(h){var l=h&&h.src,n=l&&l.data,m=n&&n.et,k=this.tree,j=l&&l.widget&&l.widget.tree;if(k===j){return this!==j&&this.data&&(this===l.parent||this.data.mdxUnitId===(n&&n.mdxUnitId));}return !(b.indexOf(this.levelSwitchValidTypes,m)===-1);},ondrop:function L(j){var m=j&&j.src,h=m&&m.widget;if(h&&h.tree!==this.tree){var l=m&&m.data;if(l&&l.index!==null){var k=h.ctxtBuilder.itemWidgets[l.index];k.tree.moveMQNodeToViewLimit(k);}m.data=null;}this._super(j);},isEditable:function(h){return h.mdxUnitId&&this._super(h);},ondragend:function R(h){var l=h&&h.tgt,j=l&&l.widget;if(j&&j.tree!==this.tree){var k=h.src&&h.src.data;if(k&&(k.indices||(k.index!==null))){this.remove(k.indices||k.index);}Z.call(this);}else{this._super(h);}},moveMQNodeToViewFilter:function(j){var h=this.editor.mainExpr;j.parent.remove(j.data);h.addSingleCondition(j.data);},getItemConfig:function(k,h,l){k.mdxUnitId=D(k);var j=this._super(k,h,l);return S.copy({cssClass:g(k,h,l)?"per-metric-limit":"",forbidRelation:true,getConditionTextPostfix:function(){if(this.data.et!==I.MQ||mstrmojo.rw.ConditionWalk.isMdxDM(this.data.m.did)){return"";}return'<img class="mstrmojo-moveToViewFilter" src="../images/1ptrans.gif" title="'+mstrmojo.desc(9746,"Move to view filter")+'"onclick="var w = mstrmojo.all[\''+this.id+"']; w.tree.moveMQNodeToViewFilter(w); return false;\" />";}},j);}});function P(j){var h=[];b.forEach(j,function(k){if(!k){return ;}if(k.et===I.ANDOR&&!(k.node&F.CONDITION)){k.nds=P(k.nds);if(k.nds.length===0){return ;}else{if(k.nds.length===1){var l=k.nds[0];if(k.not){l.not=!l.not;}h.push(l);return ;}}}h.push(k);});return h;}function J(h){return h?[h]:[];}function f(h){return h&&h.length===1?h[0]:null;}function c(k){var j=P(k),h;if(!j[0]||j[0].mdxUnitId){h={et:I.ANDOR,fn:a.FN.AND,nds:j};}else{h=j[0];}return[h];}function g(j,h,k){return(k===k.tree||k.parent===k.tree)&&!!j.mdxUnitId;}function D(j){if(!("mdxUnitId" in j)){var h;switch(j.et){case I.MQ:case I.MC:h=j.m.did||null;break;case I.ANDOR:b.forEach(j.nds,function(l){var k=D(l);if(h===undefined){h=k;}else{if(h!==k){h=null;return false;}}return true;});break;default:h=undefined;break;}j.mdxUnitId=h;}return j.mdxUnitId;}function V(n){var p=n.tree,o=p.ctxtBuilder.itemWidgets[0],s=n.parent,q=b.indexOf(s.items,n.data),l=s.items[q],j=l.mdxUnitId;if(s===p){return ;}if(s.data.mdxUnitId===j){return ;}if(o.data.mdxUnitId){var k={et:I.ANDOR,fn:a.FN.AND,nds:[o.data,l]};p.remove(0);p.add([k]);p.ctxtBuilder.itemWidgets[0].ctxtBuilder.itemWidgets[0].remove(l);}else{var m=o,h;b.forEach(o.data.nds,function(u,t){if(u.mdxUnitId===l.mdxUnitId&&o.items[t]!==l){m=o.ctxtBuilder.itemWidgets[t];h=t;return false;}});if(m===s){return ;}if(m.data.et!==I.ANDOR){var r={et:I.ANDOR,fn:a.FN.AND,nds:[m.data,l]};o.add([r],h+1);o.remove(m.data);}else{m.add([l]);}s.remove(l);}}}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.fe.FilterEditor","mstrmojo.fe.AndOrNode","mstrmojo.fe.DynamicNode","mstrmojo.fe.ConditionNode","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.editors.fe.RelationNode");var C=mstrmojo.hash,B=mstrmojo.expr,A=B.ET;mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree=mstrmojo.declare(mstrmojo.fe.RWViewFilterExprTree,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree",markupString:'<div id="{@id}"><div class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},nodeClassMap:{14:mstrmojo.fe.AndOrNode,15:mstrmojo.vi.ui.editors.fe.RelationNode,ph:mstrmojo.fe.DynamicNode,"*":mstrmojo.fe.ConditionNode},levelSwitchValidTypes:[A.MQ,A.MC],setupScrollNodes:function(){this.scrollNode=this.scrollboxNode;},getItemConfig:function(F,D,G){var E=this._super(F,D,G);return C.copy({getConditionTextPostfix:function(){return"";}},E);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.Editor","mstrmojo.registry","mstrmojo.fe.FilterUtils","mstrmojo.fe.FilterEditor","mstrmojo.func");mstrmojo.requiresDescs(15544);var G=mstrmojo.array,F=mstrmojo.hash,D=mstrmojo.fe.FilterUtils.getExprXml,E=mstrmojo.expr,A=E.TP,C=E.STP;mstrmojo.fe._HasFilterEditor=mstrmojo.provide("mstrmojo.fe._HasFilterEditor",{filterEditorScriptClass:"mstrmojo.fe.FilterEditor",limitMdxUnitIdsHashTable:{},getLimitMdxUnitIdsHashTable:function B(I){var H=I&&I.limitExpr,K=H&&H.nds||[],L={};var J=function(M){G.forEach(M,function(N){if(N.mdxUnitId){L[N.mdxUnitId]=true;}else{if(N.m&&N.m.did){L[N.m.did]=true;}else{if(N.nds){J(N.nds);}}}});};J(K);return L;},onShowFilterEditor:function(Q){var O=this,V=this.model,L=this.getDataService?this.getDataService():V.getDataService(),H=this._getXtabCallback?this:V.controller,I="mfe",P={},N=Q.getNodeKeys?Q.getNodeKeys():[Q.k],M=function M(Y,a){var X,Z=Y.nds;if(Y.ph){a[Y.ph.idx]=true;}else{if(Z){for(X=0;X<Z.length;X++){M(Z[X],a);}}}return a;},K=function K(Z){var Y=O.getLimitMdxUnitIdsHashTable(Z),X=[];F.forEach(O.limitMdxUnitIdsHashTable,function(b,a){if(!Y[a]){X=X.concat({did:a,t:4});}});L.saveViewFilter({filterModel:Z,limitExp:D(Z.limitExpr),nodeKeys:N,limitMdxToRemove:X},mstrmojo.func.wrapMethods(H._getXtabCallback(Q),{success:function(){var a=Q.boxContent;a&&a.raiseEvent&&a.raiseEvent({name:"regenerateToolbar"});}}));},W=function(X){var Y=I&&window.mstrmojo&&mstrmojo.all[I];if(!Y){Y=mstrmojo.insert({id:I,scriptClass:O.filterEditorScriptClass,onUpdateBrowseElementsParams:function(b,a){var Z=this.model;b.datasetID=Z.dsid;b.messageID=Z.messageID;b.templateNodeKey=Q.k;}});}Y.editorTitle=mstrmojo.desc(15544,"Advanced Filter Editor");Y.set("vizTitle",Q.title);X.targets=G.filter(X.targets,function(Z){switch(Z.t){case A.FILTER:return(Z.st!==C.CUSTOMGROUP);case A.CONS:return Z.st===C.NDE;}return !Z.olap;});O.limitMdxUnitIdsHashTable=O.getLimitMdxUnitIdsHashTable(X);Y.set("onSave",K);Y.set("model",X);if(O.filterEditorScriptClass==="mstrmojo.vi.ui.editors.FilterEditor"){Y.set("docModel",V);}if(Y.mainExpr.items.length>0){P=M(Y.mainExpr.items[0],P);}Y.open();},R={taskId:"getRWGridViewFilter",nodeKey:N[0],rwb:V.bs,msgID:V.mid},S=V.newCallback({success:function U(Y){var X=mstrmojo.insert(Y);W(X);},failure:function J(X){mstrmojo.alert(X.code+": "+X.message);}});L.getViewFilter(R,S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.hash","mstrmojo.fe.FilterEditor","mstrmojo.ui._HasScroller");var C=mstrmojo.hash,B=mstrmojo.expr,A=B.ET;mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree=mstrmojo.declare(mstrmojo.fe.RWViewLimitExprTree,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree",markupString:'<div id="{@id}"><div class="mstrmojo-ListBase2 {@cssClass}" style="position:relative;{@cssText}" mstrAttach:keyup,keypress,mousedown,mouseup,dblclick><div class="mstrmojo-ListBase2-itemsContainer" style="position:relative;{@itemsContainerCssText}">{@itemsHtml}</div><div class="mstrmojo-ListBase2-dropCue {@cssClass}"><div class="mstrmojo-ListBase2-dropCue-inner"></div></div></div></div>',markupSlots:{scrollboxNode:function(){return this.domNode.firstChild;},itemsContainerNode:function(){return this.domNode.firstChild.firstChild;},dropCueNode:function(){return this.domNode.firstChild.lastChild;}},levelSwitchValidTypes:[A.MQ,A.MC],getItemConfig:function(F,D,G){var E=this._super(F,D,G);return C.copy({getConditionTextPostfix:function(){return"";}},E);},setupScrollNodes:function(){this.scrollNode=this.scrollboxNode;}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.expr","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.models.FormatModel","mstrmojo.VisEnum","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.gm.GMUtility","mstrmojo.VisUtility","mstrmojo.models.FormatModel","mstrmojo._CanValidate","mstrmojo.num");mstrmojo.requiresClsP("mstrmojo.ui.editors.controls","CharacterGroup","ContainerGroup","TwoColumnContainer","ColorPickerButton","LineStyleButton");var I=mstrmojo.hash,e=mstrmojo.array,k=mstrmojo.gm.GMUtility,w=mstrmojo.VisUtility,C=mstrmojo.num,V=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,X=mstrmojo.VisEnum.SERVER_JSON_ERROR_TYPE;var F=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,S=mstrmojo.models.FormatModel,M=S.ENUM_PROPERTY_NAMES,B=mstrmojo.chart.enums.EnumFontStyle,O=F.LEGEND_BG_COLOR,l=F.LEGEND_BG_FILL_TRANSPARENCY,v=F.LEGEND_FONT_SIZE,c=F.LEGEND_FONT_FAMILY,AA=F.LEGEND_FONT_COLOR,E=F.LEGEND_FONT_STYLE,m=mstrmojo.VisEnum.NETWORK_MAX_NODE_SIZE_TYPE,d=mstrmojo.VisEnum.NETWORK_MIN_NODE_SIZE_TYPE,t=mstrmojo.expr.DTP;var AB={};AB[M.FONT_SIZE]=v;AB[M.FONT_FAMILY]=c;AB[M.COLOR]=AA;var N="de",o="lgd";var U="30%",Q="70%";function K(AD){var AC=AD,AE=this.getHost().defaultsLegendPop||{},AF=this.getPropertyValue(AC);return AF!==undefined?AF:AE[AD];}function z(AC){this._doNotSave=true;AC.call(this);this._doNotSave=false;}function G(){function AH(AN,AU,AO,AK){var AS=this,AL="observableModel."+AN;function AJ(AZ){var AY=AS.getHost();var AX=w.getPropertyByPath(AY,AL);if(AX){AX.setValue(AZ);}}function AV(){var Aa=AP.getSelectedItem().v,AZ={type:Aa};var AY=AS.getPropertyInfo();AY.unmarshal(AN,AZ);AZ=AY[AN];AT.set("enabled",AK.textboxEnabled(Aa));AT.updateText(C.toLocaleString(AZ.ratio));AJ(AZ);var AX=AK.onSizeChanged;if(AX instanceof Function){AX(AZ);}}var AW=this.getHost();var AM=w.getPropertyByPath(AW,AL,{});var AR=AM.type.getValue();var AQ=AM.ratio.getValue();var AP=this.getPulldown(AO,AV,!isNaN(AR)?(AR-1):0);var AT=new mstrmojo.ui.editors.controls.ValidationTextBox({required:true,dtp:t.FLOAT,constraints:I.copy(AK.valueRange,{min:0.01,max:1,trigger:mstrmojo.validation.TRIGGER.ALL}),validationDelay:1500,value:C.toLocaleString(AQ),enabled:AK.textboxEnabled(AR),onValid:function(){var AY={type:AP.getSelectedItem().v,ratio:C.parseNumeric(this.value)};AJ(AY);var AX=AK.onSizeChanged;if(AX instanceof Function){AX(AY);}},updateText:function(AX){this.inputNode.value=AX;this.value=AX;}});return[new mstrmojo.Label({text:AU}),r([AP,AT],{col1Width:"70%",col2Width:"30%"})];}var AI=(function(){var AJ=["not used",mstrmojo.desc(13743,"The smallest element's size is proportional to its data element"),mstrmojo.desc(13744,"The smallest element's size is fixed, independent of its data value"),mstrmojo.desc(13740,"The smallest element's size is ## of the largest element's size")];return function(){var AM=this.getHost();if(AM.hasSizeByMetric()){var AK=AM.propInfo;var AL=AK.minNodeSize;var AN=AJ[AL.type];if(AL.type===d.ADJUSTED_RANGE){AN=AN.replace("##",(AL.ratio*100).toFixed(0)+"%");}return AN;}}.bind(this);}.call(this));var AG=AH.call(this,"maxNodeSize",mstrmojo.desc(14116,"Item Max Size (0.01 - 1)"),[{n:mstrmojo.desc(6019,"Automatic"),v:m.AUTOMATIC},{n:mstrmojo.desc(8262,"Manual"),v:m.MANUAL}],{textboxEnabled:function(AJ){return AJ===m.MANUAL;}});var AE=AH.call(this,"minNodeSize",mstrmojo.desc(14117,"Item Min Size (0.00 - 1)"),[{n:mstrmojo.desc(11990,"Proportional"),v:d.PROPORTIONAL},{n:mstrmojo.desc(13741,"Full Range"),v:d.FULL_RANGE},{n:mstrmojo.desc(14118,"Adjusted Range"),v:d.ADJUSTED_RANGE}],{valueRange:{min:0,max:1},textboxEnabled:function(AJ){return AJ===d.ADJUSTED_RANGE;},onSizeChanged:function(){AC.set("text",AI());}});var AC;var AD=[].concat(AG,AE);var AF=this.getHost();if(!AF.hasSizeByMetric()){AE.forEach(function(AJ){AJ.set("enabled",false);});}else{AC=new mstrmojo.Label({text:AI(),cssText:"line-height: 115%;"});AD.push(AC);}return this.getEditorGroup(AD);}function J(AD){var AC=function(AJ,AI,AH){return this.getCheckboxAndLabel(this.getPropertyValue(AH),AJ,a.call(this,AI));}.bind(this);var AF="nodeSizeAggregation",AE=this.getHost().model.data,AG=mstrmojo.VisEnum.NETWORK_AGGREGATION_METHOD[this.getPropertyValue("nodeSizeAggregation")];this.replaceChildControls(AD,[this.getEditorGroup([AC(mstrmojo.desc(12080,"Show Edge Direction"),"showEdgeDirection","showEdgeDirection"),AC(mstrmojo.desc(12081,"Animate Layout Transition"),"showTransition","showTransition"),new mstrmojo.Label({text:mstrmojo.desc(12082,"Item Size Aggregation:")}),this.getPulldown([{n:mstrmojo.desc(2123,"Count"),v:"Count of"},{n:mstrmojo.desc(2131,"Sum"),v:"Sum of"},{n:mstrmojo.desc(2122,"Average"),v:"Average of"},{n:mstrmojo.desc(2127,"Minimum"),v:"Min of"},{n:mstrmojo.desc(2125,"Maximum"),v:"Max of"}],a.call(this,AF),AG===undefined?1:AG)]),G.call(this),this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(13861,"Item Formatting"))].concat(f.call(this))),Y.call(this),this.getEditorGroup([this.getEditorGroup([this.getMoreOptionsEditorLink((AE&&AE.gsi&&AE.gsi.prop)||{})])],{isNested:true,showDivider:true,isContainer:true})]);}function R(AE){var AI=P.call(this,{controlName:"LegendTextFontGroup"}),AG=new mstrmojo.Label({text:mstrmojo.desc(13601,"Fill:")}),AC=g.call(this,null,{controlName:"LegendBackgroundFillGroup"}),AF=[AI,AC],AK=this.getHost(),AD=w.getPropertyByPath(AK,"observableModel.showLegend"),AJ=!!(AD&&AD.getValue()),AH=this.getEditorGroup([L.call(this,AD,AF),AI,AG,AC]);AH.attachEventListener("renderComplete",AH.id,function(){w.toggleControlEnabled(AF,AJ);});this.replaceChildControls(AE,[AH]);}function A(){var AC=[{n:mstrmojo.desc(12100,"Circle"),v:"Circle"},{n:mstrmojo.desc(12101,"Square"),v:"Square"},{n:mstrmojo.desc(14433,"Diamond"),v:"Diamond"},{n:mstrmojo.desc(14434,"Hexagon"),v:"Hexagon"},{n:mstrmojo.desc(14435,"Triangle"),v:"Triangle"},{n:mstrmojo.desc(12103,"Ring"),v:"Ring"}];return AC;}var u=function(AF,AE){var AC="",AD=false;e.forEach(AF,function(AG){var AH=AE==="color"?AG.color.opacity.getValue():AG.shape.getValue();if(!AD){AC=AH;AD=true;}else{if(AC!==AH){AC="";}}});return AC;};var h=function(){var AC=[0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1];return AC;};var D=function(AC){mstrmojo.css.toggleClass(AC.previewNode,"conflict",true);AC.selectedValue="";if(!!AC.list){AC.setEmptyOption();}AC.previewNode.style.backgroundColor="white";};function p(AC,AE){var AD;e.forEach(AC,function(AG,AF){if(AG===AE||AG.v===AE){AD=AF;return false;}});return AD;}function b(AF,AG){var AC=A(),AD=p(A(),AF),AE=this.getPulldown(AC,AG,AD);AE.setEmptyOption=function(){AE.selectedNode.innerHTML="";AE.selectedIndex="";AE.list.selectedIndices="";AE.list.render();};return this.addDisposable(AE);}function x(AC,AF){var AD=[0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1];var AE=this.getPulldown(AD.map(function(AG){return{v:AG,n:(AG*100)+"%"};}),AF,AD.indexOf(AC),{getIndexOfValue:function(AH){var AG=true;return this.items.reduce(function(AJ,AL,AI){if(!AG){return AJ;}var AK=AH-AL.v,AM=AH-AJ.v;if(AK*AM<=0){AG=false;return Math.abs(AK)<Math.abs(AM)?AI:AI-1;}return AL;});}});AE.setEmptyOption=function(){AE.selectedNode.innerHTML="";AE.selectedIndex="";AE.list.selectedIndices="";AE.list.render();};return this.addDisposable(AE);}function n(AC){return function(AD){var AF=AD.value,AE=AD.valueWas;if(!I.equals(AF,AE)){AC(AF,AE);}};}function W(AE,AF,AD){var AC=this.addDisposable(new mstrmojo.ui.editors.controls.ColorPickerButton(I.copy(AD,{selectedValue:AE})));AC.postselectedValueChange=n(AF);AC.setEmptyOption=function(){AC.selectedValue="";AC.list.selectedIndices="";AC.list.render();};return AC;}function j(AC,AE){var AD=this.addDisposable(new mstrmojo.ui.editors.controls.LineStyleButton());z.call(this,function(){AD.set("selectedValue",AC);});AD.postselectedValueChange=n(AE);AD.setEmptyOption=function(){AD.selectedValue="";AD.list.selectedIndices="";AD.list.render();};return AD;}function Y(){var AH=this,AL=this.getHost(),AG=AL&&AL.stage,AK="stage.observableModel.circleLabelStyle",AC="stage.observableModel.circleStyle.showNodeLabel",AJ=w.getCharGroupValueChangeCb(function(){var AN=AH.getHost();return w.getPropertyByPath(AN,AK);}),AE=this.getCharacterGroup(AJ,(AG&&AG.getDataLabelFormats())||{}),AM=w.getPropertyByPath(AL,AC),AD=!!(AM&&AM.getValue()),AI=this.getCheckboxAndLabel(AD,mstrmojo.desc(13596,"Show Data Labels"),function(AO){var AP=AH.getHost(),AN=w.getPropertyByPath(AP,AC);if(AN!==undefined){AN.setValue(AO);}AE.set("enabled",AO===true);}),AF=w.getPropertyByPath(AL,AK);AE.set("enabled",AD);if(AM!==undefined){AM.attachEventListener("valueChanged",this.id,function(){AI.getCtrl().set("checked",AM.getValue());});}if(AF!==undefined){AF.attachEventListener("valueChanged",this.id,function(){var AN=this.getHost(),AO=AN&&AN.stage;AE.setFormatSource(AO.getDataLabelFormats());});}return this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(11993,"Data Labels")),AI,AE]);}function r(AC,AD){AC.forEach(function(AF,AE){AF.slot="col"+(AE+1)+"Node";});AD=I.copy(AD,{col1Width:"50%",col2Width:"50%",children:AC});return new mstrmojo.ui.editors.controls.TwoColumnContainer(AD);}function f(){var AR=this.getHost(),AY=AR&&AR.stage,Aa=AY&&AY.observableModel,AF=Aa&&Aa.circleStyle,AD=AR.textSelectedIndex||0;if(!AF){return[];}var AS=function(Ac){var Ab=w.getPropertyByPath(AR,"stage.observableModel."+Ac);if(Ab===undefined){throw new Error("invalid observable model");}return Ab;},AH=function(Ad,Ae,Ac){var Ab=AS(Ae);return Ad.call(this,Ab.getValue(),function(Aj){var Ai,Af=function(Ak,Al,Am){Ae=Ae.replace(new RegExp(Ak?"fromNode":"toNode","g"),Ak?"toNode":"fromNode");Ai=AS(Ae);Ai.setValue(Al,Am);};if(AR.textSelectedIndex===2){Af(true,Aj,false);}else{if(AR.textSelectedIndex===1){Af(false,Aj,false);}else{Ai=AS(Ae);var Ah=Ai.getValue(),Ag=Ae.split(".").indexOf("fromNode")===-1;if(Ah!==Aj){Af(!Ag,Aj,true);}else{Af(Ag,Aj,true);Ag=!Ag;}Af(Ag,Aj,false);}}},Ac);}.bind(this);var AL=AH(x,"circleStyle.fromNode.color.opacity"),AQ=AH(x,"circleStyle.toNode.color.opacity"),AE=AH(W,"circleStyle.fromNode.color.value",{showNoFill:false}),AU=AH(W,"circleStyle.toNode.color.value",{showNoFill:false}),AG=AH(W,"circleStyle.fromNode.border.color.value",{showNoFill:false,showGradient:false}),AM=AH(W,"circleStyle.toNode.border.color.value",{showNoFill:false,showGradient:false}),AJ=AH(j,"circleStyle.fromNode.border.style"),AP=AH(j,"circleStyle.toNode.border.style"),AK=AH(b,"circleStyle.fromNode.shape"),AZ=AH(b,"circleStyle.toNode.shape"),AX=AD===1?[AS("circleStyle.fromNode")]:[AS("circleStyle.toNode")],AC,AI,AO,AT,AW,AN=A();AF.attachEventListener("valueChanged",this.id,function(){var Ab="selectedValue";if(AR.textSelectedIndex===1){AK.set("selectedIndex",p(AN,AF.fromNode.shape.getValue()));AL.set("selectedIndex",AL.getIndexOfValue(AF.fromNode.color.opacity.getValue()));AE.set(Ab,AF.fromNode.color.value.getValue());AG.set(Ab,AF.fromNode.border.color.value.getValue());AJ.set(Ab,AF.fromNode.border.style.getValue());}else{if(AR.textSelectedIndex===2){AZ.set("selectedIndex",p(AN,AF.toNode.shape.getValue()));AQ.set("selectedIndex",AQ.getIndexOfValue(AF.toNode.color.opacity.getValue()));AU.set(Ab,AF.toNode.color.value.getValue());AM.set(Ab,AF.toNode.border.color.value.getValue());AP.set(Ab,AF.toNode.border.style.getValue());}else{if(AF.fromNode.shape.getValue()===AF.toNode.shape.getValue()){AK.set("selectedIndex",p(AN,AF.fromNode.shape.getValue()));AZ.set("selectedIndex",p(AN,AF.toNode.shape.getValue()));}if(AF.fromNode.color.opacity.getValue()===AF.toNode.color.opacity.getValue()){AL.set("selectedIndex",AL.getIndexOfValue(AF.fromNode.color.opacity.getValue()));AQ.set("selectedIndex",AQ.getIndexOfValue(AF.toNode.color.opacity.getValue()));}if(AF.fromNode.color.value.getValue()===AF.toNode.color.value.getValue()){AE.set(Ab,AF.fromNode.color.value.getValue());AU.set(Ab,AF.toNode.color.value.getValue());}if(AF.fromNode.border.color.value.getValue()===AF.toNode.border.color.value.getValue()){AG.set(Ab,AF.fromNode.border.color.value.getValue());AM.set(Ab,AF.toNode.border.color.value.getValue());}if(AF.fromNode.border.style.getValue()===AF.toNode.border.style.getValue()){AJ.set(Ab,AF.fromNode.border.style.getValue());AP.set(Ab,AF.toNode.border.style.getValue());}}}});if(AD===0||AR.textSelectedIndex===0){AC=AK;AC.selectedIndex=AK.selectedIndex===AZ.selectedIndex?AK.selectedIndex:-1;AI=AE;AI.selectedValue=AE.selectedValue===AU.selectedValue?AE.selectedValue:"conflict";AO=AL;AO.selectedIndex=AL.selectedIndex===AQ.selectedIndex?AL.selectedIndex:"conflict";AT=AG;AT.selectedValue=AG.selectedValue===AM.selectedValue?AG.selectedValue:"conflict";AW=AJ;AW.selectedValue=AJ.selectedValue===AP.selectedValue?AJ.selectedValue:"conflict";}else{var AV=AD===1||AR.textSelectedIndex===1;AC=AV?AK:AZ;AI=AV?AE:AU;AO=AV?AL:AQ;AT=AV?AG:AM;AW=AV?AJ:AP;}return[this.getPulldown([{n:mstrmojo.desc(14430,"From and To Items"),v:"AllItems"},{n:mstrmojo.desc(14431,"From Items"),v:"FromItems"},{n:mstrmojo.desc(14432,"To Items"),v:"ToItems"}],function(Ad){if(Ad==="FromItems"){AR.textSelectedIndex=1;}else{if(Ad==="ToItems"){AR.textSelectedIndex=2;}else{AR.textSelectedIndex=0;}}if(AR.textSelectedIndex===0){AX=[AF.fromNode,AF.toNode];if(AF.fromNode.color.opacity.getValue()!==AF.toNode.color.opacity.getValue()){AO.setEmptyOption();}if(AF.fromNode.color.value.getValue()!==AF.toNode.color.value.getValue()){D(AI);}if(AF.fromNode.border.color.value.getValue()!==AF.toNode.border.color.value.getValue()){D(AT);}if(AF.fromNode.border.style.getValue()!==AF.toNode.border.style.getValue()){D(AW);}if(AF.fromNode.shape.getValue()!==AF.toNode.shape.getValue()){AC.setEmptyOption();}}else{if(AR.textSelectedIndex===1){AX=[AF.fromNode];}else{AX=[AF.toNode];}}var Ab=p(A(),u(AX,"shape")),Ac=p(h(),u(AX,"color"));if(Ab!==undefined&&AR.textSelectedIndex!==0){var Ae;if(AR.textSelectedIndex===2){Ae=AF.toNode;}else{Ae=AF.fromNode;}AC.set("selectedIndex",Ab);AI.set("selectedValue",Ae.color.value.getValue());AO.set("selectedIndex",Ac);AT.set("selectedValue",Ae.border.color.value.getValue());AW.set("selectedValue",Ae.border.style.getValue());}},AD),this.getLabelAndControl(mstrmojo.desc(9734,"Shape:"),AC,U,Q),this.getLabelAndControl(mstrmojo.desc(13601,"Fill:"),r([AI,AO]),U,Q),this.getLabelAndControl(mstrmojo.desc(13598,"Border:"),r([AT,AW]),U,Q)];}function L(AD,AC){var AE=!!(AD&&AD.getValue()),AG=this.getCheckboxAndLabel(AE,mstrmojo.desc(13600,"Show legend"),function(AH){w.toggleControlEnabled(AC,AH);if(AD){AD.setValue(AH);}}),AF=AG.getCtrl();if(AD){AD.attachEventListener("valueChanged",this.id,function(AH){var AI=AH.newValue;if(AF.checked!==AI){AF.set("checked",AI);}});}return AG;}function H(AG){var AF=function(){var AI=K.call(this,c),AL=K.call(this,v),AK=k.decodeColor(K.call(this,AA)),AJ=parseInt(K.call(this,E),10);var AH={"text-decoration":""};AH[M.FONT_FAMILY]=AI;AH[M.FONT_SIZE]=parseInt(AL,10);AH[M.COLOR]=AK;if((AJ&B.FS_BOLD)>0){AH[M.FONT_WEIGHT]="bold";}if((AJ&B.FS_ITALIC)>0){AH[M.FONT_STYLE]="italic";}if((AJ&B.FS_UNDERLINE)>0){AH[M.UNDERLINE]="underline";}if((AJ&B.FS_STRIKETHROUGH)>0){AH[M.LINE_THROUGH]="line-through";}z.call(this,function(){AG.setFormatSource(AH);});}.bind(this);var AD=this.getHost(),AC={bold:B.FS_BOLD,italic:B.FS_ITALIC,underline:B.FS_UNDERLINE,strikeout:B.FS_STRIKETHROUGH};AG.fontColor.showNoFill=false;var AE=AG.fontStyle;if(AE){AE.postselectionChange=function(AH){var AK=AH.added,AL=this.items[(AK&&AK[0]!==undefined)?AK[0]:AH.removed[0]],AJ=!!AK,AI=AD.readGlobalProperty(E),AM=(AI===undefined?0:AI);if(AJ){AM=AM|AC[AL.css];}else{AM=AM&(~AC[AL.css]);}if(this.parent){this.parent.raiseFormatValueChange(E,AM,AI);}};}AF();w.addLegendFontChangeListeners(this,function(){if(AG.eventFromEdtModel){return ;}AF();});}function a(AD,AC){var AE=this.id;return function(AJ){var AH=mstrmojo.all[AE],AI=AH.getHost(),AF=AI&&AI.observableModel,AG=AD;if(AF&&AF[AG]){AF[AG].setValue(AJ,AH._doNotSave);}else{if(!AH._doNotSave){AI.setProperty(AD,AJ,{suppressData:AC});}}};}function P(AC){var AE=this;var AD=new mstrmojo.ui.editors.controls.CharacterGroup(I.copy({onGroupValueChange:function(AG,AH,AF){if(AG!==E){AG=AB[AG];}if(AG===AA){AH=k.encodeColor(AH);AF=k.encodeColor(AF);}AD.eventFromEdtModel=true;(a.call(AE,AG))(AH,AF);AD.eventFromEdtModel=false;},onFmtPropsChangedDefault:function(){z.call(this,mstrmojo.emptyFn);}},AC));z.call(this,function(){H.call(AE,AD);});return AD;}function g(AJ,AI){var AC=this.id,AH,AG=function(){z.call(this,function(){AF.setChildrenValue([[O,k.decodeColor(K.call(this,O))],[l,K.call(this,l)]]);});}.bind(this),AF=new mstrmojo.ui.editors.controls.FillConfigGroup(I.copy({onGroupValueChange:function(AM,AN,AL){if(AM===O){AN=k.encodeColor(AN);AL=k.encodeColor(AL);}AH=true;(a.call(mstrmojo.all[AC],AM))(AN,AL);AH=false;},getChildComp:function AK(AL){if(AL===O){return this.fillColorAndTrans.fillColor;}if(AL===l){return this.fillColorAndTrans.fillAlpha.fillAlphaText;}return undefined;},setChildValue:function AE(AM,AN){var AL=this.getChildComp(AM);if(AL===undefined){return false;}switch(AL.alias){case"fillColor":if(AN!==AL.selectedValue){AL.set("selectedValue",AN);}break;case"fillAlphaText":if(AN!==AL.value){AL.set("value",AN);}break;}},setChildrenValue:function AD(AL){var AM=this;AL.forEach(function(AN){AM.setChildValue(AN[0],AN[1]);});},onFmtPropsChangedDefault:function(AL,AM){this.syncControl(function(){this.setChildValue(AL,AM);});}},AI));AF.fillColorAndTrans.fillColor.propName=O;AF.fillColorAndTrans.fillAlpha.fillAlphaText.propName=l;AG();w.addLegendBackgroundChangeListeners(this,function(){if(AH){return ;}AG();});return !!AJ?this.getLabelAndControl(AJ,AF,U,Q):AF;}mstrmojo.vi.models.editors.NetworkEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.NetworkEditorModel",help:"format_panel_network.htm",init:function(AC){this._super(AC);},getPropertyInfo:function(){var AC=this.getHost();return(AC&&AC.propInfo)||{};},getPropertyValue:function(AC){var AD=this.getPropertyInfo();return AD&&AD[AC];},getInitialTarget:function s(){return N;},getTargetPulldownItems:function q(AC){var AE=this.getHost(),AD=this._super(AC),AF=function(AG){return AG.bind(this,AC);}.bind(this);if(this.isNormalOrExcludeAllDataButNotInPauseMode(AE)){AD.unshift({n:mstrmojo.desc(11974,"Data Exploration"),v:N,h:AF(J)});if(AE.hasSizebyOrColorby()){AD.push({n:mstrmojo.desc(2403,"Legend"),v:o,h:AF(R)});}}return AD;},onBEMFormatChange:function Z(AC){if(!AC.isTitle&&AC.propertyName===V.BACKGROUND_COLOR){var AF=this.getHost()||{},AE=AF.stage||{},AD=AE.observableModel;if(AD){AD.background.value.setValue(AC.value);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.VisUtility","mstrmojo.gm.GMUtility");var E=mstrmojo.hash,D=mstrmojo.VisUtility,C=mstrmojo.gm.GMUtility;mstrmojo.gmaps.MapColorUtils=mstrmojo.provide("mstrmojo.gmaps.MapColorUtils",{_mixinName:"mstrmojo.gmaps.MapColorUtils",cbSelectionToIndices:function B(G,F){return(G||[]).map(function(H){H=E.clone(H);return D.findInArray(F,function(I){return C.isEqualComb(H,E.clone(I.comb));});}).filter(function(H){return H!==-1;});},getColorInfoForItemAll:function A(F){var H,N,O,J,M,G,P,L,K=true,Q=true,I;if(F){O=F.length;if(O>=1){K=false;Q=false;J=F[0];M=J.color;G=J.opacity;P=M;L=G;for(I=1;I<O;I=I+1){J=F[I];M=J.color;G=J.opacity;if(P!==M){K=true;}if(L!==G){Q=true;}if(K&&Q){break;}}}}H=K?"#ffffff":P;N=Q?"":L;return{color:H,opacity:N};}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.string","mstrmojo.gm.GMEnums","mstrmojo.gm.GMUtility","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.vi.viz.EnumVisualizationTemplates");var AG=mstrmojo.gm,t=mstrmojo.array,W=mstrmojo.hash,D=mstrmojo.css,J=AG.GMUtility,G=mstrmojo.chart.enums.EnumFontStyle,q=AG.WidgetPropertyTag,V=AG.FormatingPropertyTag,c=AG.ShapeFillType,AC=mstrmojo.vi.viz.EnumVisualizationTemplates,e=AG.EnumFitTo,K=AG.EnumAxisScale,O=AG.EnumShape,AD=AG.EnumSubtype,N=AG.EnumDataLabels,AM=AG.EnumDataLabelPlacements,X=AG.EnumLegend,B=AG.EnumLegendMode,g=AG.EnumTextAlignH,u=AG.EnumTextAlignV,l=AG.EnumMaxSizeType,h=AG.EnumMinSizeType,AE=AG.EnumAxes,AL=AG.EnumMatrixLines,x=AG.EnumGridLines,F=AG.EnumLegendSlot,p=AG.EnumGraphType,H=mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_THEME;var n={Content:1,Window:2,Compact:3,Manual:4},AP={Global:0,PerRC:1,Local:2,Custom:3,Different:4},s={Area:0,Bar:1,Line:2,Circle:4,Square:6,Tick:7,Pie:10,Ring:11},AO={Automatic:1,Absolute:2,Stacked:3,Clustered:4,Percent:5},AB={Hide:1,"Show only values":2,"Show only text":3},Q={Automatic:1,Generic:2,Reserved:3},z={Automatic:1,Manual:2,"Auto fit":3},w={Automatic:1,Manual:2,Proportional:3},o={"Show Both":1,"Show None":2,"Show Only X":3,"Show Only Y":4},U={"Show All":1,"Show None":2,"Show Only Horizontal":3,"Show Only Vertical":4},L={Automatic:1,Show:2,Hide:3};var AF=[null,"Content","Window","Compact"],m=["Global","PerRC","Local","Custom","Different"],b=["Area","Bar","Line","StepLine","Circle","Rectangle","Square","Tick","PieSlice","Polygon","Pie","Ring"],S=[null,"Automatic","Absolute","Stacked","Clustered","Percent"],Y=[null,"Hide","Show only values","Show only text"],AJ=[null,"Automatic","Generic","Reserved"],AI=[null,"Automatic","Manual","Auto fit"],AA=[null,"Automatic","Manual","Proportional"],A=[null,"Show Both","Show None","Show Only X","Show Only Y"],AN=[null,"Show All","Show None","Show Only Horizontal","Show Only Vertical"],k=[null,"Automatic","Show","Hide"];var R={allAxLnShw:"xAxLnShw:yAxLnShw",allAxLnClr:"xAxLnClr:yAxLnClr",allAxLnStyle:"xAxLnStyle:yAxLnStyle",allAxLnCmbStyle:"xAxLnCmbStyle:yAxLnCmbStyle",allAxLnThk:"xAxLnThk:yAxLnThk",allAxTtShw:"xAxTtShw:yAxTtShw",allAxTtCtt:"xAxTtCtt:yAxTtCtt",allAxTtFntClr:"xAxTtFntClr:yAxTtFntClr",allAxTtFntFml:"xAxTtFntFml:yAxTtFntFml",allAxTtFntStyle:"xAxTtFntStyle:yAxTtFntStyle",allAxTtFntSz:"xAxTtFntSz:yAxTtFntSz",allAxLbFntClr:"xAxLbFntClr:yAxLbFntClr",allAxLbFntSz:"xAxLbFntSz:yAxLbFntSz",allAxLbFntFml:"xAxLbFntFml:yAxLbFntFml",allAxLbFntStyle:"xAxLbFntStyle:yAxLbFntStyle",allAxLbRtt:"xAxLbRtt:yAxLbRtt",allAxLbShw:"xAxLbShw:yAxLbShw",allMatrixLnShw:"vMatrixLnShw:hMatrixLnShw",allMatrixLnClr:"vMatrixLnClr:hMatrixLnClr",allMatrixLnThk:"vMatrixLnThk:hMatrixLnThk",allMatrixLnStyle:"vMatrixLnStyle:hMatrixLnStyle",allMatrixLnCmbStyle:"vMatrixLnCmbStyle:hMatrixLnCmbStyle",allNGMGridLnShw:"xGridLnShw:yGridLnShw",allGridLnShw:"majorGridLnShw:minerGridLnShw",allGridLnClr:"majorGridLnClr:minerGridLnClr",allGridLnThk:"majorGridLnThk:minerGridLnThk",allGridLnStyle:"majorGridLnStyle:minerGridLnStyle",allGridLnCmbStyle:"majorGridLnCmbStyle:minerGridLnCmbStyle",allRwColShw:"rwHdrShw:colHdrShw:rwVlShw:colVlShw",allLnShw:"xAxLnShw:yAxLnShw:xAxOriLnShw:yAxOriLnShw",allLnClr:"xAxLnClr:yAxLnClr:xAxOriLnClr:yAxOriLnClr",allLnStyle:"xAxLnStyle:yAxLnStyle:xAxOriLnStyle:yAxOriLnStyle",allLnCmbStyle:"xAxLnCmbStyle:yAxLnCmbStyle:xAxOriLnCmbStyle:yAxOriLnCmbStyle",allLnThk:"xAxLnThk:yAxLnThk:xAxOriLnThk:yAxOriLnThk",allTxtFntClr:"rwHdrTxtFntClr:colHdrTxtFntClr:rwVlTxtFntClr:colVlTxtFntClr:lgdFntClr:dlFntClr:rfLnFntClr:xAxTtFntClr:xAxLbFntClr:yAxTtFntClr:yAxLbFntClr",allTxtFntSz:"rwHdrTxtFntSz:colHdrTxtFntSz:rwVlTxtFntSz:colVlTxtFntSz:lgdFntSz:dlFntSz:rfLnFntSz:xAxTtFntSz:xAxLbFntSz:yAxTtFntSz:yAxLbFntSz",allTxtFntFml:"rwHdrTxtFntFml:colHdrTxtFntFml:rwVlTxtFntFml:colVlTxtFntFml:lgdFntFml:dlFntFml:rfLnFntFml:xAxTtFntFml:xAxLbFntFml:yAxTtFntFml:yAxLbFntFml",allTxtFntStyle:"rwHdrTxtFntStyle:colHdrTxtFntStyle:rwVlTxtFntStyle:colVlTxtFntStyle:lgdFntStyle:dlFntStyle:rfLnFntStyle:xAxTtFntStyle:xAxLbFntStyle:yAxTtFntStyle:yAxLbFntStyle",allRwColTxtFntClr:"rwHdrTxtFntClr:colHdrTxtFntClr:rwVlTxtFntClr:colVlTxtFntClr",allRwColTxtFntSz:"rwHdrTxtFntSz:colHdrTxtFntSz:rwVlTxtFntSz:colVlTxtFntSz",allRwColTxtFntFml:"rwHdrTxtFntFml:colHdrTxtFntFml:rwVlTxtFntFml:colVlTxtFntFml",allRwColTxtFntStyle:"rwHdrTxtFntStyle:colHdrTxtFntStyle:rwVlTxtFntStyle:colVlTxtFntStyle",allRwColTxtAlignH:"rwHdrTxtAlignH:colHdrTxtAlignH:rwVlTxtAlignH:colVlTxtAlignH",allRwColTxtAlignV:"rwHdrTxtAlignV:colHdrTxtAlignV:rwVlTxtAlignV:colVlTxtAlignV",outBdrShw:"OutSideBorder",allFillClr:"bgFillClr:rwHdrFillClr:colHdrFillClr",allFillTrans:"bgFillTrans:rwHdrFillTrans:colHdrFillTrans",colTxtShw:"colHdrShw:colVlShw",rwTxtShw:"rwHdrShw:rwVlShw",rwTxtTxtFntClr:"rwHdrTxtFntClr:rwVlTxtFntClr",rwTxtTxtFntSz:"rwHdrTxtFntSz:rwVlTxtFntSz",rwTxtTxtFntFml:"rwHdrTxtFntFml:rwVlTxtFntFml",rwTxtTxtFntStyle:"rwHdrTxtFntStyle:rwVlTxtFntStyle",rwTxtTxtAlignH:"rwHdrTxtAlignH:rwVlTxtAlignH",rwTxtTxtAlignV:"rwHdrTxtAlignV:rwVlTxtAlignV",colTxtTxtFntClr:"colHdrTxtFntClr:colVlTxtFntClr",colTxtTxtFntSz:"colHdrTxtFntSz:colVlTxtFntSz",colTxtTxtFntFml:"colHdrTxtFntFml:colVlTxtFntFml",colTxtTxtFntStyle:"colHdrTxtFntStyle:colVlTxtFntStyle",colTxtTxtAlignH:"colHdrTxtAlignH:colVlTxtAlignH",colTxtTxtAlignV:"colHdrTxtAlignV:colVlTxtAlignV",axOriLnShw:"xAxOriLnShw:yAxOriLnShw",axOriLnClr:"xAxOriLnClr:yAxOriLnClr",axOriLnStyle:"xAxOriLnStyle:yAxOriLnStyle",axOriLnCmbStyle:"xAxOriLnCmbStyle:yAxOriLnCmbStyle",axOriLnThk:"xAxOriLnThk:yAxOriLnThk",autoGridLnClr:"majorGridLnClr",autoGridLnCmbStyle:"majorGridLnCmbStyle",autoGridLnThk:"majorGridLnThk",autoGridLnStyle:"majorGridLnStyle"};var C={metricShapes:1,mtcLvlDataLabel:1,axisOrigin:1,AxisScale:1,fmtOnComb:1,yr:1,xr:1,y2r:1,x2r:1,rvr:1,chr:1,groupInfo:1};var AK=/[{}\[\],"'_:;\s]/i;var v="@pLd";var I=/@pLd/g;function j(AQ){var AR=new window.DOMParser();return AR.parseFromString(AQ,"text/xml");}function AH(){var AQ=this.xmlData,AR=this.xmlDoc;if(!AR&&AQ){this.xmlDoc=AR=j(AQ);}return AR;}function a(AR,AQ){if(!C[AR]){return AQ;}return AQ.replace(I,"");}function f(AV,AQ,AX){if(!C[AV]){return AQ;}var AW="",AU=0,AT,AS,AR;if(!AQ||AQ.length===0){return AQ;}AT=AQ.search(AK);while(AT!==-1){if(AT!==AU){AS=AQ.substring(AU,AT);if(AS.length===32){AR=AX[AS];if(AR!==undefined){AW+=v+AS;}}else{AW+=AS;}}AW+=AQ[AT];AQ=AQ.substring(AT+1);AT=AQ.search(AK);}AW+=AQ;return AW;}function P(AR){var AQ=new XMLSerializer();return AQ.serializeToString(AR);}function E(AR,AT){var AQ,AS="",AU=AT.length;for(AQ=0;AQ<AU;AQ++){if(AQ!==0){AS+=",";}AS+=AR[AQ]+":"+AT[AQ];}return AS;}function M(AU){AU=AU||"";var AS,AR,AQ=AU.split(","),AV=AQ.length,AT={};for(AS=0;AS<AV;AS++){AR=AQ[AS].split(":");if(AR.length===2){AT[AR[0]]=parseFloat(AR[1]);}}return AT;}function Z(AS){AS=AS||"";var AQ=AS.split(":"),AR={};if(AQ.length===2){AR[AQ[0]]=parseFloat(AQ[1])||1;}return AR;}function r(AR){AR=AR||"";var AQ=AR.split(",");return{first:parseInt(AQ[0],10),second:parseInt(AQ[1],10)};}mstrmojo.gm.GMProperty=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.gm.GMProperty",scales:null,generalProps:null,xmlDoc:null,xmlData:null,xmlDirty:false,jsonData:null,controller:null,rhIds:null,chIds:null,yIds:null,xIds:null,y2Ids:null,x2Ids:null,templateObjectMapping:null,isItemCached:null,readItemCache:null,init:function(AQ){if(this._super){this._super(AQ);}this.resetScales();this.resetGeneralProps();this.rhIds=[];this.chIds=[];if(!mstrmojo.gm.GMProperty.propertyMap){this.generatePropertyMap();}this.isItemCached={};this.readItemCache={};this.gm="OGM";},generatePropertyMap:function(){var AR,AT=mstrmojo.gm.GMProperty.propertyMap={};function AQ(AU,AV){if(!AT[AU]){AT[AU]=[AV];}else{if(AT[AU].indexOf(AV)<0){AT[AU].push(AV);}}}function AS(AU){return function(AV){AQ(AV,AU);};}for(AR in R){if(R.hasOwnProperty(AR)){AT[AR]=R[AR].split(":");t.forEach(AT[AR],AS(AR));}}},updateDefaults:function(AU,AR){var AQ=AR[V.MODIFIED_DEF_FILL_COLOR],AS;if(AQ){if(AQ==="transparent"){AS=AQ;}else{if(AQ==="default"){AS=undefined;}else{if(!isNaN(AQ)){AS=parseInt(AR[V.MODIFIED_DEF_FILL_COLOR],10);}else{try{AS=JSON.parse(AQ.replace(/'/g,'"'));}catch(AT){AS=undefined;}}}}}if(AS!==undefined){AU[V.SHAPE_FILL_COLOR]=AS;AU[V.SHAPE_FILL_COLOR_DEFAULT]=false;}else{AU[V.SHAPE_FILL_COLOR_DEFAULT]=true;}this.defaultsObj=AU;},resetScales:function(){this.scales={rh:[],ch:[],y:1,y2:1,x:1,x2:1,lgd:1,ctw:1,cth:1};},updateChartProps:function(AT){var AU=this,AS=this.jsonData,AR;AR=mstrApp.getThemeProps(this.gm);AR=W.mergeHashes(AR.GENERAL_PROPS.ALL,AR.GENERAL_PROPS[AT]);W.keyarray(AR).forEach(function(AV){AU.generalProps[AV]=AR[AV];});var AQ={legendShow:q.LEGEND_VISIBLE,FitTo:q.FIT_TO,dataLabels:q.DATA_LABEL};W.keyarray(AQ).forEach(function(AV){if(AS[AQ[AV]]){AU.initItem(AQ[AV]);}});},resetGeneralProps:function(){var AQ={};AQ.fitTo=e.NONE;AQ.axisScale=K.GLOBAL;AQ.shape=O.LINE;AQ.subtype=AD.AUTO;AQ.dataLabels=N.HIDE;AQ.dataLabelPlacements=AM.AUTOMATIC;AQ.banding=true;AQ.legend=X.SHOW;AQ.legendMode=B.RESTORED;AQ.legendShow=true;AQ.colAlign=g.CENTER;AQ.rowAlignH=g.CENTER;AQ.rowAlignV=u.CENTER;AQ.maxSizeType=l.AUTO;AQ.minSizeType=h.AUTO;AQ.maxSizeValue=0.9;AQ.minSizeValue=0.2;AQ.outBorder=true;AQ.axes=AE.SHOW_BOTH;AQ.matrixLine=AL.SHOW_ALL;AQ.gridLine=x.AUTO;AQ.legendSlot=F.RIGHT_MIDDLE;this.generalProps=AQ;},getXMLString:function(){return this.xmlData;},isXMLDirty:function(){return this.xmlDirty;},resetXMLDirtyFlag:function(){this.xmlDirty=false;},initFromXML:function(AT){if(AT){if(this.xmlData&&this.xmlData!==AT){this.xmlDoc=null;}this.xmlData=AT;}var AR,AU,AQ=[q.FIT_TO,q.AXIS_SCALE,q.SHAPE,q.SUB_TYPE,q.DATA_LABEL,q.DATA_LABELS_PLACEMENT,q.BANDING,q.LEGEND_VISIBLE,q.COL_ALIGNMENT,q.ROW_ALIGNMENT,q.MAX_SIZE_TYPE,q.MAX_SIZE_VALUE,q.MIN_SIZE_TYPE,q.MIN_SIZE_VALUE,q.SELECTION_TYPE,q.SELECTIONS,q.OUTSIDE_BORDER,q.AXES,q.MATRIX_LINES,q.GRID_LINES,q.LEGEND_MODE,q.LEGEND_POSITION,q.SCALE_LEGEND_WIDTH,q.SCALE_CHART_WIDTH,q.SCALE_CHART_HEIGHT,q.METRIC_SHAPES,q.AXIS_ORIGIN,q.LOG_SCALE,q.TREND_LINE_DEF,q.TREND_BUBBLE_FORE_DEF,q.REF_LINE_DEF,V.FORMATS_ON_COMBINATION,V.ALL_SHAPE_FORMAT,V.V_MATRIX_LINES_SHOW,V.V_MATRIX_LINES_COLOR,V.V_MATRIX_LINES_THICKNESS,V.V_MATRIX_LINES_STYLE,V.H_MATRIX_LINES_SHOW,V.H_MATRIX_LINES_COLOR,V.H_MATRIX_LINES_THICKNESS,V.H_MATRIX_LINES_STYLE];for(AR=0,AU=AQ.length;AR<AU;AR++){this.initItem(AQ[AR]);}var AS=this.generalProps;if(AS.legendShow){AS.legend=(AS.legendMode===B.MINIMIZED)?X.MINIMIZED:X.SHOW;}else{AS.legend=X.HIDE;}},reInitItem:function(AT,AR){var AQ=this.generalProps;var AS=this.hGetPropValue(AT);switch(AT){case q.FIT_TO:AQ.fitTo=n[AS]||AR;break;case V.CONTAINER_FIT_MODE:AQ[V.CONTAINER_FIT_MODE]=AS===undefined?AR:AS;break;default:break;}},initItem:function(AZ){var Ah,Ad,AX,AW,Ag,Af,AY,AS,Aj,AV,Ak,AQ,Ac,AT,Ai=this.rhIds,Aa=this.chIds,Ab=this.controller,AU=this.scales,AR=this.generalProps,Ae;Ae=this.hGetPropValue(AZ);switch(AZ){case q.FIT_TO:AR.fitTo=n[Ae]||W.walk("GENERAL_PROPS.ALL.fitTo",mstrApp.getThemeProps(this.gm));break;case q.AXIS_SCALE:AR.axisScale=AP[Ae]||K.GLOBAL;break;case q.SHAPE:AX=s[Ae];AR.shape=isNaN(AX)?O.LINE:AX;break;case q.METRIC_SHAPES:case q.METRIC_LEVEL_DATA_LABEL:case q.AXIS_ORIGIN:case q.LOG_SCALE:case q.TREND_LINE_DEF:case q.TREND_BUBBLE_FORE_DEF:case q.REF_LINE_DEF:case q.FORMATS_ON_COMBINATION:case V.ALL_SHAPE_FORMAT:AR[AZ]=J.stringToJSON(Ae);break;case q.SUB_TYPE:AR.subtype=AO[Ae]||AD.AUTO;break;case q.DATA_LABEL:AR.dataLabels=AB[Ae];break;case q.DATA_LABELS_PLACEMENT:AR.dataLabelPlacements=Q[Ae];break;case q.BANDING:AR.banding=Ae==="true";break;case q.LEGEND_VISIBLE:AR.legendShow=Ae!=="Hide";break;case q.COL_ALIGNMENT:if(Ae!==undefined){AX=parseInt(Ae,10);if(!isNaN(AX)&&AX>=0&&AX<=2){this.updateItem(V.COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL,AX);this.updateItem(V.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL,AX);}}break;case q.ROW_ALIGNMENT:if(Ae!==undefined){AX=r(Ae).first;if(!isNaN(AX)&&AX>=0&&AX<=2){this.updateItem(V.ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL,AX);this.updateItem(V.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL,AX);}AX=r(Ae).second;if(!isNaN(AX)&&AX>=0&&AX<=2){this.updateItem(V.ROW_HEADER_TEXT_ALIGNMENT_VERTICAL,AX);this.updateItem(V.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL,AX);}}break;case q.MAX_SIZE_TYPE:AR.maxSizeType=z[Ae]||l.AUTO;break;case q.MAX_SIZE_VALUE:AX=parseFloat(Ae);AR.maxSizeValue=isNaN(AX)?0.9:AX;break;case q.MIN_SIZE_TYPE:AR.minSizeType=w[Ae]||(mstrApp.getThemeProps("THEME_STYLE")===H.DEFAULT?h.AUTO:h.PROPORTIONAL);break;case q.MIN_SIZE_VALUE:AX=parseFloat(Ae);AR.minSizeValue=isNaN(AX)?0.2:AX;break;case q.OUTSIDE_BORDER:AR.outBorder=Ae!=="Hide";break;case q.AXES:if(Ae!==undefined){AR.axes=o[Ae]||AE.SHOW_BOTH;if(AR.axes===AE.SHOW_BOTH){Ag=Af=true;}else{if(AR.axes===AE.SHOW_X){Ag=true;Af=false;}else{if(AR.axes===AE.SHOW_Y){Ag=false;Af=true;}else{Ag=Af=false;}}}this.updateItem(V.X_AXIS_LINE_SHOW,Ag);this.updateItem(V.Y_AXIS_LINE_SHOW,Af);}break;case q.MATRIX_LINES:if(Ae!==undefined){AR.matrixLine=U[Ae]||AL.SHOW_ALL;if(AR.matrixLine===AL.SHOW_ALL){Ag=Af=true;}else{if(AR.matrixLine===AL.SHOW_HORIZONTAL){Ag=false;Af=true;}else{if(AR.matrixLine===AL.SHOW_VERTICAL){Ag=true;Af=false;}else{Ag=Af=false;}}}this.updateItem(V.V_MATRIX_LINES_SHOW,Ag);this.updateItem(V.H_MATRIX_LINES_SHOW,Af);}break;case q.GRID_LINES:AR.gridLine=L[Ae]||x.AUTO;break;case q.LEGEND_MODE:AR.legendMode=parseInt(Ae,10);break;case q.LEGEND_POSITION:AT=parseInt(Ae,10);if(AT===F.LEFT){AT=F.LEFT_MIDDLE;}else{if(AT===F.RIGHT){AT=F.RIGHT_MIDDLE;}}AR.legendSlot=AT||F.RIGHT_MIDDLE;break;case q.SCALE_LEGEND_WIDTH:AU.lgd=parseFloat(Ae)||undefined;break;case q.SCALE_CHART_WIDTH:AU.ctw=parseFloat(Ae)||1;break;case q.SCALE_CHART_HEIGHT:AU.cth=parseFloat(Ae)||1;break;case q.SCALE_ROW_HEADERS:Ai.length=0;Aj=M(Ae);AS=Ab.getRowTitleInfo(true);Ad=AS.items.length;for(Ah=0;Ah<Ad;Ah++){AY=AS.items[Ah].id;if(Aj.hasOwnProperty(AY)){AU.rh[Ah]=Aj[AY]||1;}else{AU.rh[Ah]=1;}Ai.push(AY);}break;case q.SCALE_COL_HEADERS:Aa.length=0;Ak=M(Ae);AV=Ab.getColTitleInfo(true);Ad=AV.items.length;for(Ah=0;Ah<Ad;Ah++){AY=AV.items[Ah].id;if(Ak.hasOwnProperty(AY)){AU.ch[Ah]=Ak[AY]||1;}else{AU.ch[Ah]=1;}Aa.push(AY);}break;case q.SCALE_Y:case q.SCALE_X:case q.SCALE_Y2:case q.SCALE_X2:if(AZ===q.SCALE_Y){AQ=Ab.getYAxisInfo(undefined,undefined,true,false);AW="y";}else{if(AZ===q.SCALE_X){AQ=Ab.getXAxisInfo(undefined,undefined,true,false);AW="x";}else{if(AZ===q.SCALE_Y2){AQ=Ab.getYAxisInfo(undefined,undefined,false,false);AW="y2";}else{if(AZ===q.SCALE_X2){AQ=Ab.getXAxisInfo(undefined,undefined,false,false);AW="x2";}}}}Ac=Z(Ae);Ad=AQ.ids.length;AY="";for(Ah=0;Ah<Ad;Ah++){if(Ah!==0){AY+=",";}AY+=AQ.ids[Ah];}this[AW+"Ids"]=AY;AU[AW]=Ac[AY]||1;break;}},readItem:function(AU,AQ){var AR=this.generalProps,AX=this.scales,AT,AW;switch(AU){case q.FIT_TO:if(AX.ctw!==1||AX.cth!==1){AW=e.MANUAL;}else{AW=AR.fitTo;}break;case V.CONTAINER_FIT_MODE:AW=AR[V.CONTAINER_FIT_MODE];break;case q.AXIS_SCALE:AW=AR.axisScale;break;case q.SHAPE:AW=AR.shape;break;case q.SUB_TYPE:AW=AR.subtype;break;case q.DATA_LABEL:AW=AR.dataLabels;break;case q.DATA_LABELS_PLACEMENT:AW=AR.dataLabelPlacements;break;case q.BANDING:AW=AR.banding;break;case q.LEGEND_VISIBLE:AW=AR.legendShow;break;case q.COL_ALIGNMENT:AW=AR.colAlign;break;case q.ROW_ALIGNMENT:AW={};AW.h=AR.rowAlignH;AW.v=AR.rowAlignV;break;case q.MAX_SIZE_TYPE:AW=AR.maxSizeType;break;case q.MAX_SIZE_VALUE:AW=AR.maxSizeValue;break;case q.MIN_SIZE_TYPE:AW=AR.minSizeType;break;case q.MIN_SIZE_VALUE:AW=AR.minSizeValue;break;case q.OUTSIDE_BORDER:AW=AR.outBorder;break;case q.AXES:AW=AR.axes;break;case q.MATRIX_LINES:AW=AR.matrixLine;break;case q.GRID_LINES:AW=AR.gridLine;break;case q.LEGEND_MODE:AW=AR.legendMode;break;case q.LEGEND_POSITION:AW=AR.legendSlot;break;case q.SCALE_LEGEND_WIDTH:AW=AX.lgd;break;case q.SCALE_CHART_WIDTH:AW=AX.ctw;break;case q.SCALE_CHART_HEIGHT:AW=AX.cth;break;case q.SCALE_ROW_HEADERS:AW=AX.rh;break;case q.SCALE_COL_HEADERS:AW=AX.ch;break;case q.SCALE_Y:AW=AX.y;break;case q.SCALE_X:AW=AX.x;break;case q.SCALE_Y2:AW=AX.y2;break;case q.SCALE_X2:AW=AX.x2;break;case q.SCALE_ALL:AW=AX;break;default:AW=this.hGetPropValue(AU);break;}AT=AW;switch(AU){case V.LINE_MARKER_SHOW:case V.LEGEND_BORDER_SHOW:case V.X_AXIS_ORIGIN_LINE_SHOW:case V.Y_AXIS_ORIGIN_LINE_SHOW:case V.X_AXIS_LINE_SHOW:case V.X_AXIS_TITLE_SHOW:case V.X_AXIS_LABELS_SHOW:case V.Y_AXIS_LINE_SHOW:case V.Y_AXIS_TITLE_SHOW:case V.Y_AXIS_LABELS_SHOW:case V.V_MATRIX_LINES_SHOW:case V.H_MATRIX_LINES_SHOW:case V.ALL_ROW_COLUMN_SHOW:case V.COLUMN_HEADER_SHOW:case V.ROW_HEADER_SHOW:case V.COLUMN_VALUES_SHOW:case V.ROW_VALUES_SHOW:case V.GRID_LINE_AUTO:case q.SORT_ORDER:case V.TOTAL_SHOW:case V.INT_SUM_SHOW:case V.INT_SUM_FULL:case V.SHOW_MODEBAR:if(AT){AW=(AT==="true"||AT===true);}break;case V.MAJOR_GRID_LINES_SHOW:if(AT===undefined){AT=AR.gridLine;}AW=parseInt(AT,10);break;case V.MINOR_GRID_LINES_SHOW:if(AT===undefined){AT=AR.gridLine;if(AT===2){AT=x.HIDE;}}AW=parseInt(AT,10);break;case V.X_AXIS_LABELS_ROTATION:if(AT){AW=parseInt(AT,10);}break;case q.SORT_INDEX:if(AT){AW={};AW.row=r(AT).first;AW.col=r(AT).second;}break;case q.AXIS_SCALE_DATA:if(AT){AW=J.parseAxisScaleData(AT);}break;case q.METRIC_SHAPES:case q.METRIC_LEVEL_DATA_LABEL:case q.AXIS_ORIGIN:case q.LOG_SCALE:case q.TREND_LINE_DEF:case q.TREND_BUBBLE_FORE_DEF:case q.REF_LINE_DEF:case q.SELECTIONS:case q.FORMATS_ON_COMBINATION:case V.ALL_SHAPE_FORMAT:var AV=this.isItemCached;var AS=this.readItemCache;if(!AV[AU]){AS[AU]=J.stringToJSON(AW);AV[AU]=true;}AW=AS[AU];break;case q.SCALE_V_EXTRA_LINE:AW=parseFloat(AW)||1;break;case q.MAX_SIZE_VALUE:case q.MIN_SIZE_VALUE:if(AT){AW=parseFloat(AT);}break;case V.REF_LABELS_FONT_FAMILY:case V.REF_LABELS_FONT_SIZE:case V.REF_LABELS_FONT_STYLE:case V.REF_LABELS_FONT_COLOR:if(AT&&typeof AT==="string"&&AT.indexOf("{")>=0){AW=J.stringToJSON(AT);}break;case V.POINT_SIZE:case V.POINT_POS:case V.JITTER:case V.JTR_TYPE:case V.PTSZ_TYPE:case V.PTPOS_TYPE:if(AT){AW=parseFloat(AT);}break;case V.XBINS_START:case V.XBINS_END:case V.XBINS_SIZE:if(AT){AW=parseFloat(AT);}case V.POSITIVE_COLOR:case V.NEGATIVE_COLOR:case V.TOTAL_COLOR:case V.INT_SUM_COLOR:if(AW==="default"){AW=undefined;}default:break;}if(AW===undefined){if(!AQ){AW=this.defaultsObj&&this.defaultsObj[AU];}}else{if(AU.slice(-3)==="Clr"&&typeof AW==="string"){if(AW!=="transparent"){if(isNaN(AW)){AW=J.stringToJSON(AW);}else{AW=parseInt(AW,10);}}}}if(typeof AW==="string"&&!isNaN(AW)){AW=parseInt(AW,10);}return AW;},clearReadItemCache:function(){this.isItemCached={};},updateItem:function(AS,AR){var AU=this.scales,AQ=this.generalProps,AT=J.everythingToString(AR);this.clearReadItemCache();switch(AS){case q.FIT_TO:AR=AR===n.Manual?AQ.fitTo:AR;AQ.fitTo=AR;AT=AF[AR===n.Manual?AQ.fitTo:AR];break;case q.AXIS_SCALE:AQ.axisScale=AR;AT=m[AR];break;case q.SHAPE:AQ.shape=AR;AT=b[AR];break;case q.SUB_TYPE:AQ.subtype=AR;AT=S[AR];break;case q.DATA_LABEL:AQ.dataLabels=AR;AT=Y[AR];break;case q.DATA_LABELS_PLACEMENT:AQ.dataLabelPlacements=AR===true?1:2;AT=AJ[AQ.dataLabelPlacements];break;case q.BANDING:AQ.banding=AR;break;case q.LEGEND_VISIBLE:AQ.legendShow=AR;AT=AR?"Show":"Hide";break;case q.ROW_ALIGNMENT:AQ.rowAlignH=AR.h;AQ.rowAlignV=AR.v;AT=AR.h+","+AR.v;break;case q.COL_ALIGNMENT:AQ.colAlign=AR;break;case q.MAX_SIZE_TYPE:AQ.maxSizeType=AR;AT=AI[AR];break;case q.MAX_SIZE_VALUE:AQ.maxSizeValue=AR;break;case q.MIN_SIZE_TYPE:AQ.minSizeType=AR;AT=AA[AR];break;case q.MIN_SIZE_VALUE:AQ.minSizeValue=AR;break;case q.OUTSIDE_BORDER:AQ.outBorder=AR;AT=AR?"Show":"Hide";break;case q.AXES:AQ.axes=AR;AT=A[AR];break;case q.MATRIX_LINES:AQ.matrixLine=AR;AT=AN[AR];break;case q.GRID_LINES:AQ.gridLine=AR;AT=k[AR];break;case q.LEGEND_MODE:AQ.legendMode=AR;break;case q.LEGEND_POSITION:AQ.legendSlot=AR;break;case q.SCALE_LEGEND_WIDTH:AU.lgd=AR;break;case q.SCALE_CHART_WIDTH:AU.ctw=parseFloat(AR)||1;break;case q.SCALE_CHART_HEIGHT:AU.cth=parseFloat(AR)||1;break;case q.SCALE_ROW_HEADERS:AU.rh=AR;AT=E(this.rhIds,AU.rh);break;case q.SCALE_COL_HEADERS:AU.ch=AR;AT=E(this.chIds,AU.ch);break;case q.SCALE_Y:AU.y=AR;AT=this.yIds+":"+AU.y;break;case q.SCALE_X:AU.x=AR;AT=this.xIds+":"+AU.x;break;case q.SCALE_Y2:AU.y2=AR;AT=this.y2Ids+":"+AU.y2;break;case q.SCALE_X2:AU.x2=AR;AT=this.x2Ids+":"+AU.x2;break;case q.SORT_INDEX:AT=AR.row+","+AR.col;break;default:break;}this.hSetPropValue(AS,AT);},removeItem:function(AQ){this.hRemoveProp(AQ);},updateItems:function(AT,AQ){var AR,AS=AT.length;for(AR=0;AR<AS;AR++){this.updateItem(AT[AR],AQ[AR]);}},setController:function(AQ){this.controller=AQ;this.initItem(q.SCALE_ROW_HEADERS);this.initItem(q.SCALE_COL_HEADERS);this.initItem(q.SCALE_Y);this.initItem(q.SCALE_X);this.initItem(q.SCALE_Y2);this.initItem(q.SCALE_X2);},initHTML5Props:function(AS){var AX=this.readItem,Af=AS.LEGEND={},Al=AS.BK={},Ai=AS.RH_BK={},Ac=AS.CH_BK={},Aa=AS.RH_TITLE={},AY=AS.RH={},Ab=AS.CH_TITLE={},AU=AS.CH={},Ae=AS.AXIS_LABEL_X={},Ad=AS.AXIS_LABEL_Y={},Ak=AS.AXIS_TITLE_X={},Aj=AS.AXIS_TITLE_Y={},AV=AS.AXIS_LINE_X={},AT=AS.AXIS_LINE_Y={},Ah=AS.MATRIX_LINE_H={},AW=AS.MATRIX_LINE_V={},AR=AS.GRID_LINE_MAJOR={},AZ=AS.GRID_LINE_MINOR={},AQ=AS.OUTSIDE_BORDER={},An=function(Ar,Ao,Ap){if(Ao===c.Gradient){Ap=J.decodeColor(Ap);var Aq=D.buildGradient(Ap.or,Ap.c1,Ap.c2);if(Aq){Ar[Aq.n]=Aq.v;}}else{Ar.backgroundColor=J.decodeColor(Ap);}},Am=function(Ap,Ao){Ap.fontWeight=(Ao&G.FS_BOLD?"bold":"normal");Ap.fontStyle=(Ao&G.FS_ITALIC?"italic":"normal");if((Ao&G.FS_STRIKETHROUGH)&&(Ao&G.FS_UNDERLINE)){Ap.textDecoration="line-through underline";}else{if(Ao&G.FS_STRIKETHROUGH){Ap.textDecoration="line-through";}else{if(Ao&G.FS_UNDERLINE){Ap.textDecoration="underline";}else{Ap.textDecoration="none";}}}},Ag=function(Ao){var Ap=["solid","dashed","dotted"];return Ap[Ao]||"none";};Af.fontFamily=AX.call(this,V.LEGEND_FONT_FAMILY);Af.fontSize=AX.call(this,V.LEGEND_FONT_SIZE);Am(Af,AX.call(this,V.LEGEND_FONT_STYLE));Af.color=J.decodeColor(AX.call(this,V.LEGEND_FONT_COLOR));An(Af,AX.call(this,V.LEGEND_BG_FILL_STYLE),AX.call(this,V.LEGEND_BG_COLOR));Af.opacity=AX.call(this,V.LEGEND_BG_FILL_TRANSPARENCY)/100;if(AX.call(this,V.LEGEND_BORDER_SHOW)){Af.borderWidth=parseInt(AX.call(this,V.LEGEND_BORDER_THICKNESS),10)+"px";Af.borderStyle=Ag(AX.call(this,V.LEGEND_BORDER_LINE_STYLE));Af.borderColor=J.decodeColor(AX.call(this,V.LEGEND_BORDER_COLOR));}An(Al,AX.call(this,V.BG_FILL_STYLE),AX.call(this,V.BG_COLOR));Al.opacity=AX.call(this,V.BG_FILL_TRANSPARENCY)/100;An(Ai,AX.call(this,V.ROW_HEADER_FILL_STYLE),AX.call(this,V.ROW_HEADER_FILL_COLOR));Ai.opacity=AX.call(this,V.ROW_HEADER_FILL_TRANSPARENCY)/100;An(Ac,AX.call(this,V.COLUMN_HEADER_FILL_STYLE),AX.call(this,V.COLUMN_HEADER_FILL_COLOR));Ac.opacity=AX.call(this,V.COLUMN_HEADER_FILL_TRANSPARENCY)/100;Aa.fontFamily=AX.call(this,V.ROW_HEADER_TEXT_FONT_FAMILY);Aa.fontSize=AX.call(this,V.ROW_HEADER_TEXT_FONT_SIZE);Am(Aa,AX.call(this,V.ROW_HEADER_TEXT_FONT_STYLE));Aa.color=J.decodeColor(AX.call(this,V.ROW_HEADER_TEXT_FONT_COLOR));Ab.fontFamily=AX.call(this,V.COLUMN_HEADER_TEXT_FONT_FAMILY);Ab.fontSize=AX.call(this,V.COLUMN_HEADER_TEXT_FONT_SIZE);Am(Ab,AX.call(this,V.COLUMN_HEADER_TEXT_FONT_STYLE));Ab.color=J.decodeColor(AX.call(this,V.COLUMN_HEADER_TEXT_FONT_COLOR));AY.fontFamily=AX.call(this,V.ROW_VAVLUE_TEXT_FONT_FAMILY);AY.fontSize=AX.call(this,V.ROW_VAVLUE_TEXT_FONT_SIZE);Am(AY,AX.call(this,V.ROW_VAVLUE_TEXT_FONT_STYLE));AY.color=J.decodeColor(AX.call(this,V.ROW_VAVLUE_TEXT_FONT_COLOR));AU.fontFamily=AX.call(this,V.COLUMN_VAVLUE_TEXT_FONT_FAMILY);AU.fontSize=AX.call(this,V.COLUMN_VAVLUE_TEXT_FONT_SIZE);Am(AU,AX.call(this,V.COLUMN_VAVLUE_TEXT_FONT_STYLE));AU.color=J.decodeColor(AX.call(this,V.COLUMN_VAVLUE_TEXT_FONT_COLOR));Ad.fontFamily=AX.call(this,V.Y_AXIS_LABELS_FONT_FAMILY);Ad.fontSize=AX.call(this,V.Y_AXIS_LABELS_FONT_SIZE);Am(Ad,AX.call(this,V.Y_AXIS_LABELS_FONT_STYLE));Ad.color=J.decodeColor(AX.call(this,V.Y_AXIS_LABELS_FONT_COLOR));Ae.fontFamily=AX.call(this,V.X_AXIS_LABELS_FONT_FAMILY);Ae.fontSize=AX.call(this,V.X_AXIS_LABELS_FONT_SIZE);Am(Ae,AX.call(this,V.X_AXIS_LABELS_FONT_STYLE));Ae.color=J.decodeColor(AX.call(this,V.X_AXIS_LABELS_FONT_COLOR));Aj.fontFamily=AX.call(this,V.Y_AXIS_TITLE_FONT_FAMILY);Aj.fontSize=AX.call(this,V.Y_AXIS_TITLE_FONT_SIZE);Am(Aj,AX.call(this,V.Y_AXIS_TITLE_FONT_STYLE));Aj.color=J.decodeColor(AX.call(this,V.Y_AXIS_TITLE_FONT_COLOR));Ak.fontFamily=AX.call(this,V.X_AXIS_TITLE_FONT_FAMILY);Ak.fontSize=AX.call(this,V.X_AXIS_TITLE_FONT_SIZE);Am(Ak,AX.call(this,V.X_AXIS_TITLE_FONT_STYLE));Ak.color=J.decodeColor(AX.call(this,V.X_AXIS_TITLE_FONT_COLOR));AV.borderWidth=parseInt(AX.call(this,V.X_AXIS_LINE_THICKNESS),10)+"px";AV.borderColor=J.decodeColor(AX.call(this,V.X_AXIS_LINE_COLOR));AV.borderTopStyle=Ag(AX.call(this,V.X_AXIS_LINE_STYLE));AT.borderWidth=parseInt(AX.call(this,V.Y_AXIS_LINE_THICKNESS),10)+"px";AT.borderColor=J.decodeColor(AX.call(this,V.Y_AXIS_LINE_COLOR));AT.borderLeftStyle=Ag(AX.call(this,V.Y_AXIS_LINE_STYLE));Ah.borderWidth=parseInt(AX.call(this,V.H_MATRIX_LINES_THICKNESS),10)+"px";Ah.borderColor=J.decodeColor(AX.call(this,V.H_MATRIX_LINES_COLOR));Ah.borderTopStyle=Ag(AX.call(this,V.H_MATRIX_LINES_STYLE));AW.borderWidth=parseInt(AX.call(this,V.V_MATRIX_LINES_THICKNESS),10)+"px";AW.borderColor=J.decodeColor(AX.call(this,V.V_MATRIX_LINES_COLOR));AW.borderLeftStyle=Ag(AX.call(this,V.V_MATRIX_LINES_STYLE));AR.borderWidth=parseInt(AX.call(this,V.MAJOR_GRID_LINES_THICKNESS),10)+"px";AR.borderColor=J.decodeColor(AX.call(this,V.MAJOR_GRID_LINES_COLOR));AR.borderTopStyle=Ag(AX.call(this,V.MAJOR_GRID_LINES_STYLE));AR.borderLeftStyle=AR.borderTopStyle;AZ.borderWidth=parseInt(AX.call(this,V.MINER_GRID_LINES_THICKNESS),10)+"px";AZ.borderColor=J.decodeColor(AX.call(this,V.MINER_GRID_LINES_COLOR));AZ.borderTopStyle=Ag(AX.call(this,V.MINER_GRID_LINES_STYLE));AZ.borderLeftStyle=AZ.borderTopStyle;AQ.borderWidth=parseInt(AX.call(this,V.OUTSIDE_BORDER_THICKNESS),10)+"px";AQ.borderColor=J.decodeColor(AX.call(this,V.OUTSIDE_BORDER_COLOR));AQ.borderLeftStyle=Ag(AX.call(this,V.OUTSIDE_BORDER_STYLE));AQ.borderTopStyle=Ag(AX.call(this,V.OUTSIDE_BORDER_STYLE));},readItemDefault:function(AV,AT){var AU,AR={CIRCLE:0.7,Bar:0.7,AREA:0.7,PIE:0.8,RING:0.8},AS={CIRCLE:2,Bar:1,AREA:2,PIE:1,RING:1},AQ={1:AO.Stacked,2:AO.Automatic,0:AO.Automatic};switch(AV){case V.X_AXIS_TITLE_SHOW:case V.Y_AXIS_TITLE_SHOW:AU=AT.isMetric?true:false;break;case V.SHAPE_FILL_TRANSPARENCY:AU=AR[AT.shapeType];break;case V.SHAPE_BORDER_THICKNESS:AU=AS[AT.shapeType];break;case q.SUB_TYPE:AU=AQ[AT.shapeType];break;}return AU;},consumeJsonFmt:function(AR){var AT,AS=[],AQ=[];for(AT in AR){if(AR.hasOwnProperty(AT)){AS.push(AT);AR[AT]=a(AT,AR[AT],this.templateObjectMapping);AQ.push(AR[AT]);}}this.xmlData=this.makeDefaultPropXML(AS,AQ);this.jsonData=AR;},hSyncWithJson:function(AS,AR,AT){var AQ=this.jsonData;if(AQ){if(AT){delete AQ[AS];}else{AQ[AS]=AR;}}},hGetPropValue:function(AU){var AT,AR=this.jsonData,AS;if(AR){return AR[AU];}else{AT=AH.call(this);if(AT){var AQ=AT.getElementsByTagName("fmt")[0],AV=AQ.getElementsByTagName(AU)[0];if(AV){AS=AV.getAttribute("value");return a(AU,AS,this.templateObjectMapping);}}}return undefined;},hRemoveProp:function(AS){this.hSyncWithJson(AS,"",true);var AR=AH.call(this),AQ=AR.getElementsByTagName("fmt")[0],AT=AQ.getElementsByTagName(AS)[0];if(AT){AT.parentNode.removeChild(AT);this.xmlData=P(AR);this.xmlDirty=true;}return this.xmlData;},hSetPropValue:function(AT,AS){if(typeof AS==="undefined"){return this.hRemoveProp(AT);}if((typeof AS)!=="string"){AS=AS.toString();}this.hSyncWithJson(AT,AS);var AR=AH.call(this),AQ=AR.getElementsByTagName("fmt")[0],AU=AQ.getElementsByTagName(AT)[0];if(!AU){AU=AR.createElement(AT);AQ.appendChild(AU);}AU.setAttribute("value",f(AT,AS,this.templateObjectMapping));this.xmlData=P(AR);this.xmlDirty=true;return this.xmlData;},hSetPropValues:function(AX,AW){var AU,AT,AQ,AV,AR=AX.length,AY=AH.call(this),AS=AY.getElementsByTagName("fmt")[0];for(AU=0;AU<AR;AU++){AQ=AX[AU];AV=AW[AU];this.hSyncWithJson(AQ,AV);AT=AS.getElementsByTagName(AQ)[0];if(!AT){AT=AY.createElement(AQ);AS.appendChild(AT);}AT.setAttribute("value",f(AQ,AV,this.templateObjectMapping));}this.xmlData=P(AY);this.xmlDirty=true;return this.xmlData;},clearCachedXMLDoc:function(){if(this.xmlDoc){delete this.xmlDoc;}},setTemplateObjectMapping:function(AQ){this.templateObjectMapping=AQ;},makeDefaultPropXML:function d(AW,AX){var AT,AS,AQ=AW.length,AV=new window.DOMParser(),AU="<props><widgetProps><fmt></fmt></widgetProps></props>",AY=AV.parseFromString(AU,"text/xml"),AR=AY.getElementsByTagName("fmt")[0];for(AT=0;AT<AQ;AT++){AS=AY.createElement(AW[AT]);AS.setAttribute("value",f(AW[AT],AX[AT],this.templateObjectMapping));AR.appendChild(AS);}return P(AY);}});mstrmojo.gm.GMProperty.getUnderlyingPropertyNameWithAll=function(AQ){return(R[AQ]||AQ).split(":");};}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.RadioList","mstrmojo.VisEnum","mstrmojo.array","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.Pulldown","mstrmojo._FormatDefinition","mstrmojo.hash","mstrmojo.models.FormatModel","mstrmojo.gm.GMUtility","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.func","mstrmojo.css","mstrmojo.string","mstrmojo.models.FormatModel","mstrmojo.VisUtility","mstrmojo.heatmap.vi.VisHeatmapUtility","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.vi.viz.EnumDSSDropZones");var j=mstrmojo.array,O=mstrmojo.hash,c=mstrmojo.gm.GMUtility,v=mstrmojo.func,D=mstrmojo.css,z=mstrmojo.VisUtility,M=mstrmojo.heatmap.vi.VisHeatmapUtility,d=mstrmojo.ui.editors.controls.AdvancedColorPicker,x=mstrmojo.string,a=mstrmojo.models.FormatModel,S=a.ENUM_PROPERTY_NAMES,K=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,H=mstrmojo.chart.enums.EnumFontStyle,b=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,f=mstrmojo.VisEnum.HEATMAP_LABEL_SIZE,G=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS,t=mstrmojo.vi.viz.EnumDSSDropZones,e=mstrmojo.VisEnum.SERVER_JSON_ERROR_TYPE;var AA={};AA[S.FONT_SIZE]=K.LEGEND_FONT_SIZE;AA[S.FONT_FAMILY]=K.LEGEND_FONT_FAMILY;AA[S.COLOR]=K.LEGEND_FONT_COLOR;var I="de",l="lgd";var R="widgetSelectionChangeHandlers",n="colorByColorChangeHandlers",m="fontScaleChangeHandlers";function k(AC){var AD=this;return function(AG){var AF=AD.getHost(),AE=z.getPropertyByPath(AF,"observableModel."+AC);if(AE){AE.setValue(AG);}};}function E(){var AC=this.getHost();if(AC){return AC.getPropsInfo();}return null;}function AB(AI,AG,AF){AI=AI&&AI!=="false";var AE=new mstrmojo.ui.Checkbox({checked:AI,oncheckedChange:function(){var AJ=this.checked;AF(AJ,!AJ);}});var AH=this.getLabelAndControl(AG,AE,"20px","100%",true);D.addWidgetCssClass(AH,"checkLabel");var AD=AH.getLabel();AD.onclick=function AC(){AE.onclick();};AD.cssDisplay="inline-block";return AH;}function N(AD,AC,AH,AG,AF){var AE=new mstrmojo.ui.Pulldown(O.copy(AF,{items:AD}));AE.set("selectedIndex",AC);AE.postselectedIndexChange=function(AI){var AL=AI.value,AK=AI.valueWas;if(AL!==AK){var AJ=this.items;AG(AJ[AL]&&AJ[AL].id,AJ[AK]&&AJ[AK].id);}};if(AH){return this.getLabelAndControl(AH,AE);}else{AE.getCtrl=function(){return AE;};return AE;}}function Y(AC){return new mstrmojo.Label({text:AC});}function o(AC,AE){var AD,AF;if(typeof AE==="number"){j.forEach(AC,function(AH,AG){if(!AF){AD=AG;}else{if((AE-AH.id)*(AE-AF.id)<=0){AD=Math.abs(AE-AH.value)<Math.abs(AE-AF.value)?AG:AG-1;return false;}}AF=AH;});}else{if(typeof AE==="string"){j.forEach(AC,function(AH,AG){if(AH.id===AE){AD=AG;return false;}});}}return AD;}function A(AE,AD,AF){var AC=[];if(AE!==undefined){AC.push(Y.call(this,AE));}var AG={onGroupValueChange:function(AL,AM,AK){if(AL.indexOf("FillTrans")>=0){if(!O.equals(AM,AK)){AD.opacity.setValue(AM/100);}}}};AG.propNames=[AF+"Clr",AF+"FillTrans"];var AJ=new mstrmojo.ui.editors.controls.FillConfigGroup(AG);if(AJ){AJ.iniChildrenComp(AG.propNames);}var AH=AJ.getChildComp(AG.propNames[0]);if(AH){AH.set("selectedValue",AD.value.getValue());AH.postselectedValueChange=function(AK){var AM=AK.value,AL=AK.valueWas;if(!O.equals(AM,AL)){AD.value.setValue(AM);}};}var AI=AJ.getChildComp(AG.propNames[1]);if(AI){AI.set("value",AD.opacity.getValue()*100);}AC.push(AJ);AD.attachEventListener("valueChanged",this.id,function(){AH.set("selectedValue",AD.value.getValue());AI.set("value",AD.opacity.getValue()*100);});return AC;}function Q(AC){var AL=this.getHost(),AG=AL.textSelectedIndex?AL.textSelectedIndex:0;AL.attachEventListener("formatclick",this.id,function(AU){if(AU.formatValue==="headerOnTop.header"){AL.textSelectedIndex=1;}else{if(AU.formatValue==="headerOnTop.cell"){AL.textSelectedIndex=2;}}});function AP(){var AU=E.call(this).labelSize;if(AU===f.Proportional){if(AQ&&AH.getSelectedItem().id!==1||!AQ){AK.set("enabled",false);}}}var AE=function(AW){var AU="",AV=false;j.forEach(AW,function(AX){var AY=AX.family.getValue();if(!AV){AU=AY;AV=true;}else{if(AU!==AY){AU="";}}});return AU;};var AQ=!!AC.cell,AN=AQ?(AG===0?[AC.header,AC.cell]:(AG===1?[AC.header]:[AC.cell])):[AC],AM=z.getFontFamilyItems(),AK=M.getStepper(function(AX){var AU=AN.length,AW;for(AW=0;AW<AU;AW++){var AY=AW!==AU-1,AV=AN[AW];if(AX>0){AV.scale.setValue(AV.scale.getValue()+0.1,AY);}else{AV.scale.setValue(Math.max(0.1,AV.scale.getValue()-0.1),AY);}}}),AD=N.call(this,AM,o(AM,AE(AN)),null,function(AW){var AU=AN.length,AV;for(AV=0;AV<AU;AV++){AN[AV].family.setValue(AW,AV!==AU-1);}},{isHostedWithin:false,scrollNodeMaxHeight:350,getPopupListConfig:function AO(){var AU=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);AU.getItemProps=function AV(AY,AW){var AX=mstrmojo._IsList.getItemProps.call(this,AY,AW);AX.style=AY.preview?"font-family:'"+x.encodeHtmlString(AY.n,true)+"';":"";return AX;};return AU;}}),AS=new mstrmojo.ui.ButtonBar({hasSpacing:true,multiSelect:true,items:M.getFontStyleItems(),postselectionChange:function(AV){if(AR.flag){AR.flag=false;return ;}var AZ=AV.added,Aa=this.items[(AZ&&AZ[0]!==undefined)?AZ[0]:AV.removed[0]],AX=(AZ&&AZ.length>0);var AU=AN.length,AY,AW,Ab;for(AY=0;AY<AU;AY++){AW=AN[AY].style.getValue();Ab=(AW===undefined?H.NORMAL:AW);if(AX){Ab=Ab|M.fontStyleValueMap[Aa.css];}else{Ab=Ab&(~M.fontStyleValueMap[Aa.css]);}AN[AY].style.setValue(Ab.toString());}}}),AJ=function(AV){var AU=j.map(AV,function(AX){var AW={};var AY=parseInt(AX.style.getValue());M.convertFontStyle(AY,AW);return AW;});return AU.reduce(function(AW,AY){var AX=O.copy(AW,O.copy(AY,{}));j.forEach(O.keyarray(AX),function(AZ){if(AW[AZ]!==AY[AZ]){delete AW[AZ];}});return AW;});},AI=function(AV){AR.flag=true;var AU=AJ.call(AR,AV);M.updateFontStyle(AS,AU);AR.flag=false;};this._fontStepper=AK;AC.attachEventListener("valueChanged",this.id,function(AU){var AW=AU.target,AX=false,AV=false;j.forEach(AN,function(AY){if(AW===AY.family){AX=true;return false;}if(AW===AY.style){AV=true;return false;}});if(AX){AD.set("selectedIndex",o(AM,AE(AN)));}if(AV){AI(AN);}});var AT=this.getTwoColumnContainer([AD,AK],{col1Width:"50%",col2Width:"50%",dividerWidth:"8px",});var AH;var AR=this;var AL=this.getHost();var AF=[AT,AS];if(AQ){AH=N.call(this,[{n:mstrmojo.desc(2461,"All"),id:0,limitNames:["header","cell"]},{n:mstrmojo.desc(2967,"Headers"),id:1,limitNames:["header"]},{n:mstrmojo.desc(12007,"Labels"),id:2,limitNames:["cell"]}],AG,null,function(AV){if(AV===0){AN=[AC.header,AC.cell];}else{if(AV===1){AN=[AC.header];}else{AN=[AC.cell];}}var AU=o(AM,AE(AN));if(AU!==undefined){AD.set("selectedIndex",AU);}else{if(AU===undefined){AD.selectedNode.innerHTML="";}}AI(AN);AL.triggerFontScaleChangeEvent();},{isHostedWithin:false});AF.unshift(AH);}V.call(this,m,"stepper",function(AU){var AV;if(AQ){AV=(AH.getSelectedItem().limitNames||[]).map(function(AW){return"headerOnTop."+AW;});}else{AV=["headerOnMiddle"];}M.setStepperEnabled(AK,AV,AU.limits);AP.call(AR);});AL.triggerFontScaleChangeEvent();AR.flag=false;AI(AN);return AF;}function L(AH){var AC=function(){var AN=this.getHost(),AK=AN.readGlobalAttriLegndProperty(K.LEGEND_FONT_FAMILY),AO=AN.readGlobalAttriLegndProperty(K.LEGEND_FONT_SIZE),AM=c.decodeColor(AN.readGlobalAttriLegndProperty(K.LEGEND_FONT_COLOR)),AL=parseInt(AN.readGlobalAttriLegndProperty(K.LEGEND_FONT_STYLE),10);var AJ={};AJ["text-decoration"]="";AJ[S.FONT_FAMILY]=AK;AJ[S.FONT_SIZE]=parseInt(AO,10);AJ[S.COLOR]=AM;M.convertFontStyle(AL,AJ);AH.setFormatSource(AJ);}.bind(this);var AG=this.getHost();var AF=["fontFamily","fontStyle","fontSize","fontColor"];function AE(AK,AJ){var AL=null;if(AF.indexOf(AJ)>-1){AL=AK[AJ];}return AL;}var AI=AE(AH,AF[3]);AI.showNoFill=false;var AD=AE(AH,AF[1]);if(AD){AD.postselectionChange=function(AJ){var AM=AJ.added,AN=this.items[(AM&&AM[0]!==undefined)?AM[0]:AJ.removed[0]],AL=!!AM,AK=AG.readGlobalAttriLegndProperty(K.LEGEND_FONT_STYLE),AO=(AK===undefined?H.NORMAL:AK);if(AL){AO=AO|M.fontStyleValueMap[AN.css];}else{AO=AO&(~M.fontStyleValueMap[AN.css]);}if(this.parent){this.parent.raiseFormatValueChange(K.LEGEND_FONT_STYLE,AO,AK);}};}AC();z.addLegendFontChangeListeners(this,function(){if(AH.eventFromEdtModel){return ;}AC();});return AH;}function U(AC){var AD=this;return L.call(this,new mstrmojo.ui.editors.controls.CharacterGroup(O.copy({onGroupValueChange:function(AG,AI,AF){if(O.equals(AI,AF)){return ;}if(AG!==K.LEGEND_FONT_STYLE){AG=AA[AG];}if(AG===K.LEGEND_FONT_COLOR){AI=c.encodeColor(AI);}var AH=AD.getHost(),AE=AH.observableModel[AG];if(AE){this.eventFromEdtModel=true;AE.setValue(AI);this.eventFromEdtModel=false;}},onFmtPropsChangedDefault:mstrmojo.emptyFn},AC)));}function w(){var AG="layout",AF=E.call(this)[AG],AC={isHostedWithin:false},AD=[{n:mstrmojo.desc(13758,"Keep readability"),displayName:mstrmojo.desc(12124,"Keep readability, not element order"),id:0},{n:mstrmojo.desc(13759,"Balance"),displayName:mstrmojo.desc(13760,"Balance readability and element order"),id:1},{n:mstrmojo.desc(13761,"Keep element order"),displayName:mstrmojo.desc(12126,"Keep element order, not readability"),id:2}],AE=N.call(this,AD,AF,null,k.call(this,AG),AC);AE.list.getItemDisplayName=function(AH){return AH.displayName;};return AE;}function u(){var AJ="isHeaderOnTop",AF=E.call(this)[AJ],AG=k.call(this,AJ),AI=this.getHost(),AC=AI&&AI.model.docModel,AH=this;var AD=[{n:mstrmojo.desc(13605,"On top"),id:true},{n:mstrmojo.desc(13604,"In center"),id:false}];var AE=mstrmojo.desc(13602,"Headers");return N.call(this,AD,AF?0:1,AE,function(AL,AK){var AM=M.isSpatial();if(AM){AH.manualChangeLabelSize=false;var AN=E.call(AH)["labelSize"];if(!AL&&AH.memoLabelSize===undefined&&AN===0){AH._labelSizeController.getCtrl().set("selectedIndex",1);}else{if(AL&&AH.memoLabelSize===undefined&&AN===1){AH._labelSizeController.getCtrl().set("selectedIndex",0);}else{AH._labelSizeController.getCtrl().set("selectedIndex",AN);AH.memoLabelSize=AN;}}}AG(AL,AK);if(AC){AC.selectVIUnit(AI.parent.id,true);}});}function X(){var AF="labelSize",AD=E.call(this)[AF],AE=this;var AC=0;if(AD===f.Off){AC=1;}else{if(AD===f.Proportional){AC=2;}}this._labelSizeController=N.call(this,[{n:mstrmojo.desc(6030,"On"),id:"On"},{n:mstrmojo.desc(6031,"Off"),id:"Off"},{n:mstrmojo.desc(11990,"Proportional"),id:"Proportional"}],AC,mstrmojo.desc(13603,"Labels"),v.composite([k.call(this,AF),function(AI){var AH=M.isSpatial();if(AH){if(AE.manualChangeLabelSize){AE.memoLabelSize=AI;}else{AE.manualChangeLabelSize=true;}}AE._showMetricValuesController.set("enabled",AI!=="Off");var AG=AE.getHost();if(AG){AG.triggerFontScaleChangeEvent();}}]));return this._labelSizeController;}function C(){var AD=E.call(this);var AC=mstrmojo.desc(12122,"Show metric values");var AF="showMetricValues";var AE=AB.call(this,AD[AF],AC,k.call(this,AF));AE.enabled=AD.labelSize!==f.Off;this._showMetricValuesController=AE;return AE;}function Z(){function AO(AT,AS){function AU(){if(AS===undefined){AS=0;}else{AI=AS;}if(AP){AR=AP.getColorByElements();}var AW=AR[AS];this.setChildValue(AM,AW.color);this.setChildValue(AF,AW.opacity);var AV=AG().some(function(AX){return z.isColorManuallySet(AP,AR[AX].comb);});z.setColorPickerShowAutomatic(this,AV);}AH.fillColorAndTrans.fillColor.set("enabled",AS!==0);if(AT){this.syncControls(AU);}else{AU.call(this);}}function AN(AS){return(AS||[]).map(function(AT){AT=O.clone(AT);return z.findInArray(AR,function(AU){return c.isEqualComb(AT,O.clone(AU.comb));});}).filter(function(AT){return AT!==-1;});}function AG(){return[].concat(AI===0?AK:AI);}var AP=this.getHost(),AR=AP.getColorByElements(),AQ=AN(AP&&(AP.contextMenuCbSelection||AP.edtModelCbInitSelection)),AI,AM="ShapeClr",AF="ShapeFillTrans",AL=d.VAL_AUTOMATIC,AC=AR.map(function(AT,AS){return{n:AT.text,v:AS};}),AK=z.range(1,AC.length),AE=false,AJ=mstrmojo.desc(12092,"Multiple Elements"),AD,AH;if(AQ.length===0){AI=0;}else{if(AQ.length===1){AI=AQ[0];}else{AI=AQ;AE=true;}}AH=new mstrmojo.ui.editors.controls.FillConfigGroup({onGroupValueChange:function(AY,AX){var AW=[],AU=[],AS=AY===AM,AT=AY===AF,AV=AG();AV.forEach(function(AZ){var Ac=AR[AZ],Ab=Ac.comb,Aa;AU.push(Ab);if(AS){if(AX===AL){AW.push("default");Aa=AP.listenToUpdateColorMap(function(){var Ae=AU.length,Ad;AV.forEach(function(Af){var Ag=AR[Af];Ad=c.decodeColor(z.getCombColor(AP,Ag.comb));Ag.color=Ad;});if(Ae>1){Ad=AR[0].color;}AH.syncControls(function(){this.setChildValue(AM,Ad);z.setColorPickerShowAutomatic(AH,false);});AP.detachUpdateColorMapListener(Aa);});}else{AW.push(c.encodeColor(AX));Ac.color=AX;}}else{if(AT){AW.push(AX);Ac.opacity=AX;}}});if(AS){AP.updateColorMap(AU,AW);z.setColorPickerShowAutomatic(this,true);}if(AT){AP.updateColorByOpacity(AU,AW);}}});if(AH){AH.iniChildrenComp([AM,AF]);AO.call(AH,true,AE?undefined:AI);AH.fillColorAndTrans.fillColor.set("enabled",AI!==0);}AD=this.getPulldown(AC,AO.bind(AH,true),AE?undefined:AI,{setDisplayText:function(AS){var AT=this.selectedNode;if(AT){AT.innerHTML=AS;AT.title=AS;}},allowHTML:false,isHostedWithin:false});if(AE){AD.attachEventListener("renderComplete",AD.id,function(){AD.setDisplayText(AJ);});}V.call(this,R,"shapeColor",function(AS){var AU=AN(AS.colorbyElements),AT=AU.length;if(AT<1){return ;}if(AU.length===1){AD.set("selectedIndex",AU[0]);}else{AD.setDisplayText(AJ);AI=AU;AO.call(AH,true);}});V.call(this,n,"fill",function(AS){AH.syncControls(function(){AH.setChildValue(AM,AS.fill);z.setColorPickerShowAutomatic(AH,AS.showAutomatic);});});V.call(this,n,"opacity",function(AS){AH.syncControls(function(){AH.setChildValue(AF,AS.opacity);});});V.call(this,n,"invalidateCache",function(){AR.forEach(function(AT,AS){if(AS===0){return ;}AT.color=c.decodeColor(z.getCombColor(AP,AT.comb));});});return this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(13753,"Shape Color")),AD,AH]);}function q(){var AE=this.getHost(),AC=z.getMetricsInDropZone(AE.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy),AF=AC[0],AD=AE.modelData.gsi,AH=AD.mx,AG=AD.thresholds[AF.id];return new mstrmojo.vi.ui.ColorRangeSelector({thresholds:AG,metric:AH[j.find(AH,"did",AF.id)],onclick:function(){AE.model.openThresholdEditor(z.getMetricsInDropZone(AE.zonesModel,t.ColorBy)[0],true,false);}});}function h(){function AH(){AE.syncControls(function(){var AL=z.getPropertyByPath(AG,"observableModel.colorByOpacity"),AM=AL!==undefined?AL.getValue():1,AK=AM*100;this.setChildValue(AJ,AK.toString());});}var AG=this.getHost();var AJ="ShapeFillTrans";var AD;var AI=q.call(this);var AE=new mstrmojo.ui.editors.controls.FillConfigGroup({visibleControls:G.FILL_TRANSPARENCY,onGroupValueChange:function(AM,AL){if(AM===AJ){var AK=z.getPropertyByPath(AG,"observableModel.colorByOpacity");if(AK){AK.setValue(AL/100);}}}});if(AE){AE.iniChildrenComp([AJ]);AH();AD=z.getPropertyByPath(AG,"observableModel.colorByOpacity");if(AD){AD.attachEventListener("valueChanged",AG.id,AH);}}var AF=this.getTwoColumnContainer([AI,AE],{col1Width:"60%",col2Width:"40%",});var AC=this.getEditorGroup([new mstrmojo.Label({text:mstrmojo.desc(2885,"Fill")}),AF],{showDivider:false,isNested:true,isContainer:true});return this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(13753,"Shape Color")),AC]);}function J(){var AE=this.getHost(),AD=E.call(this),AC=AE.levelAttributes;if(AE&&AD.isHeaderOnTop&&AC&&AC.length>1){var AF=A.call(this,undefined,AE.observableModel.headerColors,"headerColor");AF.unshift(this.getGroupTitle(mstrmojo.desc(14115,"Header Fill:")));return this.getEditorGroup(AF);}}function P(AG){var AK=this.getHost(),AF=AK.observableModel,AJ=AK.getPropsInfo().colorByType,AC,AI;if(!AF){return ;}var AH=AF&&AF.fonts,AD=AH&&(AK.props&&AK.props.isHeaderOnTop?AH.headerOnTop:AH.headerOnMiddle),AE=[this.getGroupTitle(mstrmojo.desc(3544,"Text"))];if(AD){AE=AE.concat(Q.call(this,AD));}AC=[this.getEditorGroup([Y.call(this,mstrmojo.desc(7195,"Layout")),w.call(this),u.call(this),X.call(this),C.call(this)]),this.getEditorGroup(AE),J.call(this),this.getEditorGroup([this.getMoreOptionsEditorLink((AK.modelData&&AK.modelData.gsi&&AK.modelData.gsi.prop)||{})])];if(AJ==="attribute"){AI=Z.call(this);}else{if(AJ==="metric"&&z.getMetricsInDropZone(AK.zonesModel,t.ColorBy)[0]!==undefined){AI=h.call(this);}}if(AI){AC.splice(1,0,AI);}this.replaceChildControls(AG,AC);}function B(AE,AD){var AC=!!(AE&&AE.getValue()),AG=AB.call(this,AC,mstrmojo.desc(13600,"Show legend"),function(AH){z.toggleControlEnabled(AD,AH);if(AE){AE.setValue(AH);}}),AF=AG.getCtrl();if(AE){AE.attachEventListener("valueChanged",this.id,function(AH){var AI=AH.newValue;if(AF.checked!==AI){AF.set("checked",AI);}});}return AG;}function W(AH){var AG=this.getHost().observableModel,AE=AG&&AG.showLegend,AD=!!(AE&&AE.getValue()),AC=[U.call(this,{controlName:"LegendTextFontGroup"})],AF;AC=AC.concat(A.call(this,mstrmojo.desc(13601,"Fill:"),AG.legendBackground,"legendBackground"));AF=AC.slice();AC.unshift(B.call(this,AE,AF));this.replaceChildControls(AH,[this.getEditorGroup(AC)]);z.toggleControlEnabled(AF,AD);}function V(AC,AG,AF,AE){var AD=this[AC];if(AD===undefined){this[AC]={};AD=this[AC];}AD[AG]={fn:AF,context:AE};}function F(AC){var AD=this;return function(AE){var AF=AD[AC]||{},AH=AE.type==="*"?Object.keys(AF):[].concat(AE.type),AG;AH.forEach(function(AI){if(AF.hasOwnProperty(AI)){AG=AF[AI];AG.fn.call(AD,AE,AG.context);}});};}mstrmojo.vi.models.editors.HeatMapEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.HeatMapEditorModel",help:"format_panel_heat_map.htm",memoLabelSize:undefined,manualChangeLabelSize:true,init:function(AD){if(this._super){this._super(AD);}var AE=this.getHost();if(!AE){return ;}var AC=F.bind(this);AE.attachEventListener("selectionChange",this.id,AC(R));AE.attachEventListener("colorByColorChange",this.id,AC(n));AE.attachEventListener("fontScaleChange",this.id,AC(m));},getInitialTarget:function s(){return I;},getTargetPulldownItems:function p(AC){var AE=this.getHost(),AD=this._super(AC),AF=function(AG){return AG.bind(this,AC);}.bind(this);if(this.isNormalOrExcludeAllDataButNotInPauseMode(AE)){AD.push({n:mstrmojo.desc(11974,"Data Exploration"),v:I,h:AF(P)});AD.push(AD.shift());if(AE.hasSizebyOrColorby()){AD.push({n:mstrmojo.desc(2403,"Legend"),v:l,h:AF(W)});}}return AD;},getTwoColumnContainer:function r(AC,AD){AC.forEach(function(AF,AE){AF.slot="col"+(AE+1)+"Node";});AD=O.copy(AD,{col1Width:"50%",col2Width:"50%",children:AC});return new mstrmojo.ui.editors.controls.TwoColumnContainer(AD);},onBEMFormatChange:function g(AC){if(!AC.isTitle&&AC.propertyName===b.BACKGROUND_COLOR){var AE=this.getHost()||{},AD=AE.observableModel;if(AD){AD.background.value.setValue(AC.value);}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo.MetricSlider","mstrmojo.MetricQualification","mstrmojo.SearchBoxSelector","mstrmojo.TextBoxSelector","mstrmojo.css","mstrmojo.dom","mstrmojo.expr","mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.string","mstrmojo._IsSelectorTarget","mstrmojo.elementHelper","mstrmojo.MetricSelectorUtility","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi._MonitorsAppState","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSConsolidationType");mstrmojo.requiresDescs(4729,4730,4732,4733,4734,4735,5225,5443,6738,8967,12297);var V=mstrmojo.array,a=mstrmojo.hash,AJ=mstrmojo.dom,Aq=mstrmojo.expr,AV=Aq.BFTP,An=Aq.TP,j=Aq.STP,A6=mstrmojo.css,AW=mstrmojo.MetricSelectorUtility,Ad=mstrmojo.vi.ui.DatasetUnitMenuUtils,Ar=0,Al=1,Av=2,Ac=3,AF=4,AL=5,Af=6,z=7,Aa=8,Ah=9,h=10,B=11,k=12,A7=mstrmojo.elementHelper,w=A7.ELEM_ALL_ID,A9=mstrmojo.func.wrapMethods,Q=mstrmojo.string.escapeIllegalXML,AG=mstrmojo.mstr,H=AG.EnumDSSXMLBaseFormType.DssXmlBaseFormHTMLTag,J=AG.EnumDSSConsolidationType,c=AG.EnumDSSXMLObjectTypes,AS=An.FILTER,Y=An.METRIC,Ab=An.ATTR,A4=An.CONS,At=0,Ax=j.NDE,Ai=3076,x=3077,G=j.CUSTOMGROUP,AA=A7.ELEM_ALL,AN=338;mstrmojo.DocSelectorEvtType=null;var m={};m[z]="MetricSlider";m[Aa]="MetricQualification";m[Ah]="SearchBoxSelector";m[h]="TextBoxSelector";var BD=2;var AQ=function AQ(){var BE={type:parseInt(this.type,10),src:this.k,ck:this.ck,ctlKey:this.ckey,tks:this.tks,include:this.include,isUConDS:!!this.defn.dsTks};if(this.style===Aa||this.style===z){mstrmojo.hash.copy(BE,{srcid:this.srcid,srct:this.type,f:this.f,ft:this.ft,qt:this.qt,unset:!!this.unset,cs:this.cs});}return BE;},Aj=function Aj(){var BF=this.node,BH=BF&&BF.data,BE=BF&&BF.defn,BG=BE&&BE.srct;return((mstrApp.isAppStatePause&&mstrApp.isAppStatePause())||mstrConfig.resolveOnly)&&this.style!==Ah&&BG&&this.hasAttrData()&&!BH[C.ELMSREADY]&&!BH[C.ELMSREQUEST]&&parseInt(BE.ds,10)===At&&!BH[C.DISABLED];},Ag=function Ag(BE){var BH=this.node.defn,BK=this.node.data,BG=mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||mstrConfig.resolveOnly,BL={taskId:"browseElements",styleName:"MojoAttributeStyle",attributeID:BH.srcid||"",dataSourcesXML:BH.dsrc||"",browseFlags:1};if(!BH.srcid){return ;}var BF=function(BP){var BM=this.model,BO=BM.datasets,BN=Object.keys(BO),BR=[],BQ;V.forEach(BN,function(BS){BR=BO[BS].att;V.forEach(BR,function(BT){if(BT&&BT.did===BP){BQ=BS;return false;}});if(!!BQ){return false;}});return BQ;};if(!BE){BL.datasetID=BH.dsid||BF.call(this,BH.srcid);BL.messageID=this.model.mid;if(!BL.datasetID){return ;}}var BJ=this,BI={success:function(BM){BJ.bGetElems=true;BJ.set("wait",false);if(BM&&BM.es){BK.elms=(BH.srcid)?A7.buildElemsTerseID(BM.es,BH.srcid,true):BM.es;if(BG){BJ.toggleDisplayAll(BH.showall);}var BN=BJ.parent,BO=BN&&BN.parent;if(BH.sec&&BK.ces&&BK.elms&&BK.elms.length>0&&BN){BN.set("count",A7.buildElemsCountStr(BK.ces,BK.elms,BJ.isSelectionExcluded()));}if(BJ.isInvalid){BJ.isInvalid=false;}if(BJ.hasRendered){BJ.refresh();if(BG&&BN){A6.toggleClass(BN&&BN.domNode,"invalid",false);if(BO){BO.rebuildChild(BN);}}if(BJ.isInFilterPanel()){if(BN&&BN.defn&&BN.defn.ttl){BN.updateContentHeight();}if(BO&&BO.refreshFP){BO.refreshFP();}}}}},failure:function(BM){if(BG){BJ.model.setDataReady(BJ.k,BJ.id,C.DISABLED,true);var BN=BJ.parent;BJ.isInvalid=true;A6.toggleClass(BN&&BN.domNode,"invalid",true);if(BJ.isInFilterPanel()){if(BN){BN.canCollapse=false;if(BN.titleBar){BN.titleBar.canCollapse=false;}BN.generateToolbar();}}else{if(BN.hasRendered&&BN.showInvalidMessage){BN.showInvalidMessage();}}return ;}mstrmojo.alert(BM.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){if(BG){BJ.node.data[C.ELMSREQUEST]=false;BJ.model.setDataReady(BJ.k,BJ.id,C.ELMSREQUEST,false);if(!mstrApp.isSingleTier){mstrApp.hideWait();}}}};this.set("wait",true);if(BG){BK[C.ELMSREQUEST]=true;this.model.setDataReady(this.k,this.id,C.ELMSREQUEST,true);}if(mstrApp.isSingleTier&&BG){mstrApp.serverRequest(BL,BI,{hideFailureErr:true});}else{if(BG){mstrApp.showWait();}mstrmojo.xhr.request("POST",mstrConfig.taskURL,BI,BL,false,null,true);}},n={getWidgetClass:function D(BH,BG,BF){var BE=m[BG];if(BE&&BE.constructor===Array){BE=BE[BF?0:1];}return BE;},getWidgetConfig:function U(BK,BG,BI,BE){var BL=BG===2?false:BI.horiz,BJ=BK.getFormats(),BM=BJ&&BJ.height,BH={scriptClass:this.getWidgetClass(BK,BG,BL),docSelector:BK,enabled:this.enabled,multiSelect:BI.multi,isHoriz:BL,include:BI.include,itemWidthMode:BI.iwm,allIdx:V.find(BE,"v",mstrmojo.elementHelper.ELEM_ALL_ID),noneIdx:BI.include?-1:V.find(BE,"v",mstrmojo.elementHelper.ELEM_ALL_ID),renderAllItems:!BM,onchange:function BF(){if(!BK._inSyncPhase){BK.selectorControlChange(this);}}};if(BH.noneIdx!==-1){BH.allIdx=-1;}if(BJ&&BG===mstrmojo.DocSelector.STYLES.PULLDOWN){if(BJ.color){BH.itemCssText="color: "+BJ.color+";";}if(BJ.font){BH.itemCssText=(BH.itemCssText||" ")+"font:"+BJ.font;}if(mstrApp.isExpress){BH.cssTextClass="express";}}return BH;},expandOrEditToFetchElements:function d(){var BE=this.node&&this.node.data;if(BE&&BE[C.DISABLED]){BE[C.DISABLED]=false;}this.model.setDataReady(this.k,this.id,C.disabled,false);this.checkAndFetchAllElemsForDelayed();},checkAndFetchAllElemsForDelayed:function L(BE){if(BE||Aj.call(this)){Ag.call(this);}},newSelectorWidget:function A0(BP){var BL=BP.style,BG=BP.node,BO=BG.defn,BJ=BG.data,BE=BJ.elms||[],BK=BP.isInFilterPanel(),BF,BN=this.getWidgetConfig(BP,BL,BO,BE),BI=BN.scriptClass,BM=function(BS){var BQ=this.getPopupList(),BR=this.items;if(BQ.items.length!==BR.length){this.selectedIndex=V.find(BR,"v",BS.v);}if(BS){this.set("text",BS.n||mstrmojo.desc(14561,"(null)"));}};if(!BI){BF=new mstrmojo.Label({cssClass:"unsupported",text:"This selector is not supported."});}else{if(BL===Ar){if(mstrApp&&mstrApp.isVI){BN.useDarkTheme=!BK&&mstrApp.getRootController().isDarkThemeSelected();BN.scrollNodeMaxHeight=AN;BN.focusOnPopup=true;BN.allowEmptyText=true;BN.onitemSelected=BN.onitemSelected?mstrmojo.func.composite([BM,BN.onitemSelected]):BM;BN.customizeSearchResult=function(BS){var BV,BT=this.allIdx,BR=this.multiSelect,BQ=BS.length,BU={v:"u;",n:mstrmojo.desc(13976,"(All search results)"),t:c.Dimension,_renderIdx:BT};if(BQ!==this.items.length){if(BT>=0){BV=V.find(BS,"v","u;");if(BV>-1){if(BR&&BQ>1){BS.splice(BV,1,BU);}else{BS.splice(BV,1);}}else{if(BR&&BQ>0){BS.splice(BT,0,BU);}}}}};BN.setDefaultListAndIndex=function(BR){var BQ=this.getPopupList();BQ.set("items",BR);if(!this.multiSelect){BQ.set("selectedIndex",this.selectedIndex);this.set("text",BR[this.selectedIndex].n||mstrmojo.desc(14561,"(null)"));}else{this.set("selectedIndices",this.selectedIndices);}};BN.onclearSelection=function(){var BR=this.getSelectedItem(),BQ=this.getPopupList();if(BR){BQ.set("selectedIndex",V.find(BQ.items,"v",BR.v));}};}}delete BN.scriptClass;var BH=a.walk(BI,mstrmojo);BF=new BH(BN);}return BF;},getCekEvtListener:function Aw(BF,BE){return function(BG){var BJ=[],BH=this.node.data.elms,BI={};V.forEach(BH,function(BL,BK){BI[BL.v]=BK;});V.forEach(BG.value,function(BL){var BK=BI[BL];if(BK>-1){BJ.push(BK);}});this.handleActionInSyncPhase(function(){if(BE&&BE.select){BE.select(BJ);}});};},newAndInitWidget:function AI(BI){var BK,BG=BI._cekEvtListener,BF=BI.node,BE=BF.defn,BH=BI.id,BJ;if(BG){BE.detachEventListener(BG);delete BI._cekEvtListener;}BK=this.newSelectorWidget(BI);if(BK){BJ=this.getCekEvtListener(BI,BK);}BH=BJ.cekContextId||BH;BJ=BJ.cekEvtListener||BJ;if(BJ){BI._cekEvtListener=BE.attachEventListener("cekChange",BH,BJ);}BI.addChildren(BK);return BK;},updateWidget:function As(BF){var BE=BF.children,BG=BE&&BE[0];if(!BG){BG=this.newAndInitWidget(BF);}else{BG.set("enabled",this.enabled);}return BG;}};function Ao(BE){return BE.some(function(BF){return this.style===BF;},this);}function g(){var BE=this;return BE.model.getDatasetUnits(["mx"],function(BF){return BF.did===BE.defn.srcid;})[0]||{};}function AH(BE,BI,BJ,BL,BO,BH,BF){if(!BE){return[];}var BN=0,BK,BM=BE.length-(BH?1:0)-(BI?1:0),BG=[];if(BF){if(BJ&&BI){BN++;}else{if(BL){BN=(BE.length-1);if(BH){BN--;}}}for(BK=0;BK<BO;BK++){if(BJ){if(BN<=BM&&BE[BN]){BG.push(BE[BN++]);}}else{if(BL){if(BN>=(BI?1:0)){BG.push(BE[BN--]);}}}}}else{if(BJ){BN=BO;if(BH){BN--;}}else{if(BL){BN=0;if(BI){BN++;}}}for(BK=BO+1;BK<=BM;BK++){if(BN<=BM){BG.push(BE[BN++]);}}}return BG;}mstrmojo.DocSelector=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._IsSelectorTarget,n,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.DocSelector",markupString:'<div id="{@id}" k="{@k}" class="mstrmojo-DocSelector {@cssClass} {@extCls}" nm="{@en@n}" title="{@tooltip}" style="{@domNodeCssText}"><div class="filter" style="{@filterNodeCssText}"></div><div class="wait" style="display:none;z-index:100;position:absolute;top:0;left:0;width:100%;height:100%"></div><div class="content" style="{@contentNodeCssText}"></div></div>',markupSlots:{filterNode:function(){return this.domNode.firstChild;},contentNode:function(){return this.domNode.lastChild;},dimNode:function(){return this.domNode.lastChild;},containerNode:function(){return this.domNode.lastChild;},scrollboxNode:function(){return this.domNode.lastChild;},wIconNode:function(){return this.domNode.childNodes[1];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod,onenableChange:mstrmojo.Widget.enabledMarkupMethod,onincludeChange:function(){A6.toggleClass(this.domNode,"strikeout",!this.include);},onwaitChange:function(){A6.toggleClass(this.domNode,"wait",!!this.wait);this.wIconNode.style.display=((this.wait)?"block":"none");}},_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},ckey:null,ck:null,tks:null,style:0,selIdx:null,extCls:"",min:-1,max:-1,bGetElems:false,n:"",_inSyncPhase:false,toggleDisplayAll:function A5(BE){var BI=this.node,BJ=BI.data,BH=BI.defn,BG=V.filterOne(BJ.elms,function(BK){return BK.t===14;});if(BE&&!BG){BG=AA;BJ.elms=V.insert(BJ.elms,0,[BG]);}if(!BE&&BG){BJ.elms=V.filter(BJ.elms,function(BK){return BK.t!==14;});}if(this.children&&this.children[0]){var BF=V.find(BJ.elms,"v",mstrmojo.elementHelper.ELEM_ALL_ID);this.children[0].items=BJ.elms;this.children[0].allIdx=BF;this.children[0].noneIdx=BH.include?-1:BF;}BJ[C.ELMSREADY]=true;this.model.setDataReady(this.k,this.id,C.ELMSREADY,true,"elms",BJ.elms);},init:function AR(BG){this._super(BG);if(mstrmojo.dom.isIE){this.formatHandlers=this._ieformatHandlers;}var BF=BG.node.defn,BE=BF.style;this.n=BF.n;if(mstrApp.showSelectAllMenuOptionForSelector===1&&BF.multi){switch(BE){case Av:case AF:case AL:case Af:this.spm=true;break;}}},_fetchOnInit4UCOnDS:function Ae(BG){var BE=!this.bGetElems&&parseInt(this.node.defn.subTp,10)===BD,BF=this.node.data;if(BE||Aj.call(this)){Ag.call(this,BE);BG=BF.elms;}return BG;},initControlInfo:function K(){var BT=this.node,BY=BT.data,BG=BT.defn,BR=BY.elms,BX=BY.ces;var BL=["include","ckey","ck","tks","style","multi","iase","showall"];BR=this._fetchOnInit4UCOnDS(BR,BY);this.type=BG.ct;var BQ=BG.fmts;if(BQ){var BO=BQ.width;if(!BO||parseInt(BO,10)<=0){BQ.width="95px";}}a.copyProps(BL,BG,this);var BK=this.selIdx={},BI=false,BS=BG.multi;if((BG.style===Al)||BS){if(!this.oces&&(BX!==undefined)){this.oces=a.cloneArray(BX);BI=true;}var BF=BG.showall,BW=(V.find(BX,"v",mstrmojo.elementHelper.ELEM_ALL_ID)>-1),BV=(parseInt(BG.dfm,10)===1),BH=(BY.unset===true),BU=(!BV&&BH&&(BX&&BX.length===0)),BE=(BF&&BW)||(BW&&!BV&&BH)||(BF&&BV&&BH);if(BE){BX=BR;}else{if(BU){if(!BI&&(BG.sus!==1)){var BP=BG.htot,BM=(BG.sus===2),BN=(BG.sus===4),BZ=BG.suc||1;BX=AH(BR,BF,BM,BN,BZ,BP,this.include);}else{if(this.oces){BX=this.oces;}}}}}if(BX){var BJ={};V.forEach(BX,function(Ba){BJ[Q(Ba.v)]=true;});V.forEach(BR,function(Bb,Ba){if(BJ[Q(Bb.v)]){BK[Ba]=true;}});}if(BG.min>=0){this.min=BG.min;}if(BG.max>=0){this.max=BG.max;}if(this.isRecursiveAttributeSelector()){this.levelForms=BY.lvfs||[];}},resetFormatHandlers:function P(){this.formatHandlers={contentNode:["RW"]};},_getSelectionCount:function t(BE){return a.keyarray(BE.selectedIndices).length;},canApply:function M(BI){var BH=this.defn,BJ=BH.multi,BG=this.min,BE=BJ?this.max:1,BF=this._getSelectionCount(BI||this.content);return(BG>=0&&BE>=0&&BG>BE)||((BG<0||BG<=BF)&&(BE<0||BE>=BF));},_buildEvent:mstrmojo.emptyFn,selectorControlChange:function W(BG){var BF=AQ.call(this),BM=this.isInFilterPanel()&&this.getFilterPanel(),BJ=(BM&&BM.isAutoApply());this._buildEvent(BF,BG);if(!this.canApply(BG)){var BE=this.getPanelContainer();if(this.isInSearchBoxPanel(BE)){BE.set("canApplySbp",false);}if(BJ){this.set("err",true);mstrmojo.alert(mstrmojo.desc(12297,"One or more selectors are incorrectly set. Please review the selector(s) and try again."));}if(BM){BM.set("applyEnabled",false);}return ;}if(BJ){this.set("err",false);}if(mstrApp.isExpress&&this.node.defn.style===Ar){this.handleExpressPulldown();}if(BF.requireToggle){this.deferredEvt=BF;this.set("include",BF.include);this.deferredEvt=undefined;}else{this.slice(BF);}if(this.node.data.unset===true){this.node.data.unset=null;}var BH=this.model,BI=BH&&BH.controller,BL=BI&&BI.view,BK=this.k,BN=this.defn&&this.defn._lkz;V.forEach(BL&&BL.children,function(BS){var BR=BS.defn,BP=BR&&BR.loaded,BO=BR&&BR.units;if(BP&&BS.k!==BN){for(var BQ in BO){if(BQ===BK){if(BO[BQ].tsk!==""){BR.loaded=false;}break;}}}});},showInfoWin:function r(BJ){var BM=this.node&&this.node.defn,BG=BM&&BM.ifw,BF=this.model,BH=[].concat(BF.getTargetInfoWin(BG)).concat(BF.getTargetInfoWin(this.tks));if(BH&&BH.length){var BO=this.defn.horiz,BE=BJ||this.contentNode,BL=AJ.position(BE),BN=AJ.position(this.contentNode),BK=(BO||parseInt(this.defn.style,10)===Al)?null:{x:BN.x,y:BL.y,w:BN.w,h:BL.h},BI;for(BI=0;BI<BH.length;BI++){BF.showInfoWin(BH[BI],BE,BO?"v":"h",false,a.copy(BK));}}},unrender:function AD(BE){delete this.formatHandlers;this._super(BE);},postBuildRendering:function BC(){var BG=this.node.defn.style,BI=this.filterNode.style,BE=this.contentNode,BF=this.node.defn;if(this.isInFilterPanel()&&!this.isHorizFP()){this.domNode.style.width=this.contentNode.style.width="100%";if(this.formatHandlers.filterNode){this.filterNode.style.width=this.contentNode.style.width="100%";}this.set("visible",parseInt(BF.ds,10)===At);}this.handleActionInSyncPhase(this._super,this);if(mstrApp.isExpress&&BG===Ar){this.handleExpressPulldown();}if(this.isInFilterPanel()&&this.parent.adjustFP){this.parent.adjustFP();}if(this.formatHandlers.filterNode){var BH=this.getFormats();if(!BH.width){BI.width=BE.clientWidth+"px";}if(!BH.height){BI.height=BE.clientHeight+"px";}}else{BI.display="none";}this.model.attachEventListener("CGBMapChange",this.id,"onCGBMapChange");if(AJ.isAndroid&&BG===Al){BE.style.overflow="visible";}A6.toggleClass(this.parent.domNode,"invalid",this.isInvalid);return true;},updateHeight:function Az(){this.contentNode.style.height=this.filterNode.style.height=this.content.getClientHeight()+"px";var BE=this.parent;if(BE&&(BE.defn.ttl!==undefined)&&BE.updateContentHeight){BE.updateContentHeight();}},handleExpressPulldown:function I(){var BG=this.model.getZoomFactor();if(BG!==1){var BH=this.contentNode.firstChild.firstChild,BI=parseInt(window.getComputedStyle(BH).height),BE=BI*BG+"px";BH.style.height=BE;BH.style.lineHeight=BE;}var BF=document.createElement("DIV");BF.setAttribute("class","mstrmojo-ui-Pulldown-arrow");BF.setAttribute("src","#");this.content.selectedNode.appendChild(BF);},handleActionInSyncPhase:function Au(BG,BF){var BE=this._inSyncPhase;this._inSyncPhase=true;try{if(BF){BG.call(BF);}else{BG();}}catch(BH){throw ("There was an error handling the selector action in sync phase.");}this._inSyncPhase=BE;},onCGBMapChange:function Ay(BF){var BE=BF.cgbMap;if(!BE){return ;}var BG=this.tks;a.forEach(this.defn.cgb,function(BI){var BH=BE[BI];if(BH&&BG.indexOf(BH)<0){BG+="\u001E"+BH;}});this.tks=BG;},onAppStateChange:function AU(BN){var BL=mstrmojo.vi.VisualInsightApp.APP_STATES,BP=BL.PAUSE,BM=mstrApp.isAppStatePause&&mstrApp.isAppStatePause(),BK=this.model,BG=this.node,BJ=BG&&BG.data,BO=BK.updateCSKeysforPause,BI=this.k,BE=this.id;var BF=BN.valueWas&BP;if(BJ){if(BM&&!BF){if(this.hasAttrData()){var BR=(V.indexOf(BO,this.ckey)===-1)&&BJ.elms&&(BJ.elms.length>0),BQ=this.style===Ah,BH=BR&&!BQ;BJ[C.ELMSREADY]=BH;BJ[C.CESREADY]=BR;BJ[C.DISABLED]=!BR&&!BQ;BK.setDataReady(BI,BE,C.ELMSREADY,BH);BK.setDataReady(BI,BE,C.CESREADY,BR);BK.setDataReady(BI,BE,C.DISABLED,!BR&&!BQ);if(!BH&&this.shouldDisableGdde()){this.isInvalid=true;}}else{if(this.hasQualData()){BJ[C.METRICVALUES]=!mstrConfig.resolveOnly;BK.setDataReady(BI,BE,C.METRICVALUES,!mstrConfig.resolveOnly);BJ[C.CSREADY]=true;if(this.isAttrQualSelector()&&this.children&&this.children.length){BK.setDataReady(BI,BE,C.CSREADY,true,"cs",this.children[0].cs);}else{BK.setDataReady(BI,BE,C.CSREADY,true);}}}}if(!BM&&BF){if(this.hasAttrData()){BJ[C.ELMSREADY]=BJ[C.CESREADY]=BJ[C.ELMSREQUEST]=BJ[C.DISABLED]=false;BK.setDataReady(BI,BE,C.DISABLED,false);BK.setDataReady(BI,BE,C.ELMSREADY,false);BK.setDataReady(BI,BE,C.CESREADY,false);BK.setDataReady(BI,BE,C.ELMSREQUEST,false);}else{if(this.hasQualData()){BJ[C.METRICVALUES]=BJ[C.CSREADY]=false;BK.setDataReady(BI,BE,C.METRICVALUES,false);BK.setDataReady(BI,BE,C.CSREADY,false);}}}}},update:function p(BS){this._super(BS);var BM=mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||mstrConfig.resolveOnly,BE=this.node&&this.node.data,BI=this.model;if(BM&&BE){if(!BS.data){BS.data={};}var BT=BS.data;if(BE[C.CESREADY]){BT.ces=BE.ces;BT[C.CESREADY]=BE[C.CESREADY];}else{if(!this.hasQualData()){BT.ces=BS.defn&&BS.defn.ces;BT[C.CESREADY]=true;BI.setDataReady(this.k,this.id,C.CESREADY,true,"ces",BT.ces);}}if(BE[C.ELMSREADY]){BT[C.ELMSREADY]=BE[C.ELMSREADY];BT.elms=BE.elms;}if(BE[C.DISABLED]){BT[C.DISABLED]=BE[C.DISABLED];}if(BE[C.METRICVALUES]){BT[C.METRICVALUES]=BE[C.METRICVALUES];AW.restoreMetricSelectorProps(BT,BE);}if(BE[C.CSREADY]){BT[C.CSREADY]=BE[C.CSREADY];AW.restoreMetricSelectorSelections(BT,BE);}}this.node=BS;var BH=this.node.defn,BZ=this.node.data,BV=BH.style,BP=BZ.elms,BN=this.parent,BQ=(BV===Al),BG=(BV===Ah),BR=this.isDynamicAttributeSelector(),BX,BW;if(BM){if(BZ&&BH){if(this.hasAttrData()){BI.setDataReady(this.k,this.id,C.CESREADY,true);if(BG){BZ.elms=BZ.ces;BZ[C.ELMSREADY]=false;BZ[C.DISABLED]=false;BI.setDataReady(this.k,this.id,C.ELMSREADY,false);BI.setDataReady(this.k,this.id,C.DISABLED,false);}else{BI.setDataReady(this.k,this.id,C.DISABLED,!BE[C.ELMSREADY]);}if(!BZ[C.ELMSREADY]&&this.shouldDisableGdde()){this.isInvalid=true;}}else{if(this.hasQualData()){BI.setDataReady(this.k,this.id,C.CSREADY,true);}}}}if(BH.srct===Ab&&BH.srcid&&this.model.getBrowseFormTypes&&this.model.getBrowseFormTypes(BH.srcid).indexOf(H)>-1){BX=window.document.createElement("span");V.forEach(BP,function(Ba){BX.innerHTML=Ba.n;BW=BX.firstChild;Ba.n=BW&&(BW.text||BW.alt)||Ba.n||"";});BW=null;BX=null;}if(BQ&&BH.multi){var BO=V.find(BP,"v",mstrmojo.elementHelper.ELEM_ALL_ID);if(BO>-1){BZ.del={idx:BO,elem:BP[BO]};V.removeIndices(BP,BO,1);}}if(BH.sec){var BU=[].concat(BS.data.ces||[]);if(BN&&(BN.count!==null&&BN.count!==undefined)){if(BQ||BR){BN.set("count","");}else{if((BU&&BP&&BP.length)||BH.sos){if(!BH.include){var BY=V.find(BU,"v",mstrmojo.elementHelper.ELEM_ALL_ID);if(BY>=0){V.removeIndices(BU,BY,1);}}var BK={};V.forEach(BP,function(Ba){BK[Ba.v]=true;});BU=V.filter(BU,function(Ba){return BK[Ba.v];});var BF=BU,BL;if(!BG){if(!BH.multi){BF=BP;}BL=BP;}if(BS.data.unset){BN.set("count",A7.buildElemsCountStr(BL,BL));}else{BN.set("count",A7.buildElemsCountStr(BF,BL,this.isSelectionExcluded()));}}}}}if(this.content){this.content.allIdx=V.find(this.node.data.elms,"v",w);}this.initControlInfo();var BJ=this.content=this.updateWidget(this);if(!BJ){this.set("visible",false);}this.clearCache();},refresh:function Ak(){var BF=this.parent,BE=this.node&&this.node.defn;if(BF&&BF.generateToolbar){BF.set((this.isInFilterPanel()?"baseTitle":"title"),BE.ttl);BF.generateToolbar();}this._super();if(BF.fc&&BF.updateContentHeight){BF.updateContentHeight();}},onselectAllChange:function AZ(BN){var BF=this.children&&this.children[0],BL=BF.items,BE=BF.allIdx,BH=BF.selectedIndices,BM,BK=[];if(BN.value){if(BH[BE]){BF.removeSelect(BE,true);var BJ=BF.itemRenderer,BI=BJ&&BJ.unselect;if(BI){var BG=BF._getItemNode(BE);if(BG){BI(BG,BL[BE],BE,BF);}}}for(BM=0;BM<BL.length;BM++){if(BM!==BE&&!BH[BM]){BK.push(BM);}}BF.addSelect(BK);}else{for(BM in BH){BK.push(parseInt(BM,10));}BF.removeSelect(BK);}},onincludeChange:function u(BS){var BQ=this.node.defn,BG=BS.value,BP=this.model,BK=this.isInFilterPanel()&&this.getFilterPanel(),BO=BP.getDataService().newUpdate(BK);BQ.include=this.include=BG;if(BK&&BK._bufferedSlices){BK.applyBufferedSlices(true,BO);}if(this.style!==z&&this.style!==B){var BI=AQ.call(this);BI.ckey=this.ckey;BI.changeInclude=true;if(BQ.srct===Ab||BQ.srct===A4){var BR=this,BL=this.model,BM=this.node.k,BJ=BL.getDataService(),BF=BL.getSliceCallback(BI),BH=this.isDynamicAttributeSelector(),BN=[BJ.getSelectorShowAllAction({ck:BQ.ck,ckey:BQ.ckey,type:BQ.type,showAll:BG}),BJ.getSelectorIncludeAction({ck:BQ.ck,ckey:BQ.ckey,type:BQ.type,include:BG})],BT=A9(BF,{success:function(BU){BR.set("wait",false);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){BR.toggleDisplayAll(BG);}if(!BH){BL.partialUpdate(BU.data,BL.getTargetDefn(BM));}if(!BR.isInFilterPanel()&&BR.parent){BR.parent.selectVIUnit(BR,true);}}});this.showall=this.defn.showall=BS.value;var BE=this.deferredEvt;if(!!BE){BL.sliceDeferred(BO,BE);}BN=!!BE?BN.concat(BO.actions):(BO.actions||[]).concat(BN);this.set("wait",true);BL.controller.cmdMgr.execute({execute:function(){this.submit(BN,BT);},urInfo:{extraPuKeys:BQ.ck.split("\u001E").slice(1),treesToRender:3}});}else{this.slice(BI);}}},getSelectorStyleList:function AK(){var BH=[],BK=this.defn.srct;if(this.useAttrStyle()){var BL=!this.isInFilterPanel();if(this.isRecursiveAttributeSelector()){return[{n:mstrmojo.desc(4733,"Check Boxes"),v:AF},{n:mstrmojo.desc(8967,"Search Box"),v:Ah},{n:mstrmojo.desc(4729,"Drop-down"),v:Ar}];}BH=[{n:mstrmojo.desc(4733,"Check Boxes"),v:AF},{n:mstrmojo.desc(4730,"Slider"),v:Al}];if(BK===Ab){BH.push({n:mstrmojo.desc(8967,"Search Box"),v:Ah});}if(BL){BH=BH.concat([{n:mstrmojo.desc(4735,"Link Bar"),v:Af},{n:mstrmojo.desc(4734,"Button Bar"),v:AL}]);}BH=BH.concat([{n:mstrmojo.desc(4732,"Radio Buttons"),v:Ac},{n:mstrmojo.desc(4729,"Drop-down"),v:Ar}]);if(BL){BH=BH.concat([{n:mstrmojo.desc(6738,"List Box"),v:Av}]);}var BJ=Ad.getUnitFromDataset(this.model.datasets,this.defn.srcid,12),BE=BJ&&V.some(BJ.fs,function(BM){return(BM.bftp===AV.DATE||BM.bftp===AV.DATETIME)&&(BM.istf||BM.idf);});if(BE&&(BJ&&!BJ.de)){BH.push({n:mstrmojo.desc(5443,"Calendar"),v:B});}}else{if(BK===Y){var BG=this.node,BF=BG&&BG.defn,BI=BG&&BG.data;if((mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||mstrConfig.resolveOnly)&&BF&&BF.style!==z&&!(BI&&BI.max&&BI.min)){BH=[{n:mstrmojo.desc(5225,"Qualification"),v:Aa}];}else{BH=[{n:mstrmojo.desc(4730,"Slider"),v:z},{n:mstrmojo.desc(5225,"Qualification"),v:Aa}];}}}return BH;},supportsInclude:function AP(){var BE=this.defn;if(this.isRecursiveAttributeSelector()){return !this.isDynamicAttributeSelector();}return((BE.srct===Ab&&!this.hasDE)||(BE.srct===Y&&BE.style===z))&&!this.isSolrSelector()&&!mstrApp.isInVFConfigMode;},isSelectionExcluded:function e(){return this.isDynamicAttributeSelector()&&!this.defn.include;},isSolrSelector:function F(){return this.model.isFromSolrCube(this.defn.srcid);},isMetricSelector:function A2(){return this.defn.srct===Y;},isRankMetricSelector:function AT(){var BE=g.call(this).f;return BE&&typeof BE==="string"&&BE.search(/rank/i)===0;},isNumericMetricSelector:function Ap(){var BE=g.call(this).dt;return this.model.isNumericDataType(BE);},isAttributeSelector:function AX(){return this.defn.srct===Ab;},supportsShowAllToggle:function A8(){return this.defn.srct===Ab||this.defn.srct===A4||(this.defn.srct===AS&&this.defn.srcst===G);},useAttrStyle:function A(){var BE=this.defn.srct;return BE===AS||BE===Ab||BE===A4;},hasAttrData:function A1(){return this.useAttrStyle()&&!this.isAttrQualSelector();},hasQualData:function s(){return this.isAttrQualSelector()||this.isMetricSelector();},isDerivedAttributeSelector:function Am(){return this.defn.srct===Ab&&this.defn.srcst===x;},isNewDerivedElementSelector:function l(){return this.defn.srct===A4&&this.defn.srcst===Ax;},isNewDerivedRecursiveElementSelector:function E(){return this.isNewDerivedElementSelector()&&this.defn.ndetype===J.DssRecursiveDerivedElement;},isAttrQualSelector:function AB(){return this.defn.srct===Ab&&this.defn.style===B;},isRecursiveAttributeSelector:function v(){var BE=this.defn;return BE.srct===Ab&&BE.srcst===Ai||this.isNewDerivedRecursiveElementSelector();},isDynamicAttributeSelector:function AO(){return this.isRecursiveAttributeSelector()&&this.isInFilterPanel()&&this.defn.style===AF;},allowsOrientationChange:function AY(){return !this.isAttrQualSelector()&&!Ao.call(this,[Ah,Av,Ar,Al,z,Aa]);},isSearchBox:function O(){return Ao.call(this,[Ah]);},isAttrElemListSelector:function A3(){return this.defn.srct===Ab&&this.defn.style!==B;},isCGSelector:function N(){return this.defn.srcst===G;},isGeoSelector:function b(){var BE=Ad.getUnitFromDataset(this.model.datasets,this.defn.srcid,12);return !!BE&&Ad.isGeoAttr(BE);},shouldDisableGdde:function R(){return this.isCGSelector()||this.isGeoSelector();},getInvalidTooltip:function o(){var BF=mstrmojo.desc(15787,"Unable to retrieve the list of elements for this filter")+mstrmojo.desc(1006,"."),BE=" "+mstrmojo.desc(15931,"Please resume data retrieval to use this filter.");if(this.isCGSelector()){BF=mstrmojo.desc(15924,"This Filter is based on a Custom Group, which is not supported when data retrieval is paused.")+BE;}else{if(this.isGeoSelector()){BF=mstrmojo.desc(15932,"This filter is based on a Geo Attribute, which is not supported when data retrieval is paused.")+BE;}}return BF;},slice:function f(BH){var BE=this.model;if(BH&&BH.eid){BH.eid=Q(BH.eid);}if(BE.closeSelWarnFlag){BE.closeSelWarnFlag(this.k);}if(this.isInFilterPanel()){var BF=this.getFilterPanel();if(BF&&!BF.isAutoApply()){BF.bufferSlice(BH);return ;}}var BI=this.getPanelContainer();if(this.isInSearchBoxPanel(BI)){BI.parent.bufferSlice(BH);BI.set("canApplySbp",BI.canApplySearchBoxPanel());return ;}var BG=BI&&BI.parent;if(BG&&BG.bufferSlice&&BG.hasDisabledSelectionApply&&BG.hasDisabledSelectionApply()&&BH&&!BH.forceApply){BG.bufferSlice(BH);return ;}BE.slice(BH);},isInFilterPanel:function AC(){var BE=this.parent;return(BE&&BE.isInFilterPanel&&BE.isInFilterPanel())||false;},isHorizFP:function BA(){var BE=this.parent;return(BE&&BE.isHorizFP&&BE.isHorizFP())||false;},getFilterPanel:function BB(){var BE=this.parent;return(BE&&BE.getFilterPanel&&BE.getFilterPanel())||null;},isInSearchBoxPanel:function(BE){var BF=BE||this.getPanelContainer();return BF&&(BF.isSbp||(BF._isSearchBoxPanel&&BF._isSearchBoxPanel()));},getPanelContainer:function(){var BE=mstrmojo.EnumRWUnitType,BF;for(BF=this.parent;BF&&BF.defn;BF=BF.parent){if(parseInt(BF.defn.t,10)===BE.PANEL){return BF;}}return null;},clearSelector:function Z(BE){var BQ=AQ.call(this),BM=[w],BP=this.node.data.elms||[],BZ="\u001E",BU=this.style,BF=this.defn.include,BH=this.isFilterNothing&&this.isFilterNothing(),BJ=this.node.defn,BW=BJ.srcst===257||(BJ.srct===47&&BJ.srcst!==12033),Ba=mstrApp&&mstrApp.getSelectAllForUnsetForVI&&mstrApp.getSelectAllForUnsetForVI(),BT=[AA],BI=C.CESREADY,BK="ces",BR=[],BO=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();if(BU===Ah){if(Ba){BQ.eid=BM.join(BZ);BR=BT;}else{BQ.ckey=this.ckey;BQ.unset=true;}this.defn.set("cek",[]);}else{if(BU===z||BU===Aa){BQ.cs="";BQ.ckey=this.ckey;BQ.unset=true;BJ.set("cek",{cs:null,qua:this.qua,include:BF,f:null,ft:null});BI=C.CSREADY;BK=["f","ft","cs"];BR=[null,null,""];}else{if(BU===B){BQ.unset=true;BQ.ckey=this.ckey;var BN=[{v:""},{v:""}];BJ.set("cek",{cs:BN});BI=C.CSREADY;BK="cs";BR=BN;}else{if(Ba){BQ.eid=BM.join(BZ);BR=BT;}else{BQ.ckey=this.ckey;BQ.unset=true;}var BY;if((BF||BU===Al)&&this.multi){V.forEach(BP,function(Bc){var Bb=Bc.v;if(BM[0]!==Bb){BM.push(Bb);if(!BY){BY=[Bc];}}});}var BL=BF||BU===Al;if(!BW){BJ.set("cek",BL?BM:[]);BR=BL?BT:[];}else{if(BO){BJ.set("cek",(BL&&BM.length>1)?[BM[1]]:[]);}BR=BY||[];}BK="ces";}}}if(this.defn.sec&&BU!==Al){this.parent.set("count",BU===Ah?"":A7.buildElemsCountStr(BM,BP,this.isSelectionExcluded()));}BQ[BE?"forceApply":"forceBuffer"]=true;if(BH&&!BW){BQ.ignoreTargetData=true;}BQ.retrieveCtrlKey=BW;if(BO){var BV=this.model,BX=BV.getCurrentLayoutDef(),BS=BX&&BX.units,BG=this.k;if(BS&&BS[BG]){BS[BG].cesChange=false;}BV.setDataReady(BG,this.id,BI,true,BK,BR);}this.slice(BQ);},allowsTogglingMultiSelect:function AE(){return Ao.call(this,[Ar,AL,Af,Ah,Al,Av]);},allowsTogglingAutoSearch:function X(){return !this.isRecursiveAttributeSelector()&&Ao.call(this,[Ah]);},allowsSameSizeItems:function S(){return Ao.call(this,[AF,Ac,AL,Af])&&!this.isRecursiveAttributeSelector();},supportsSetTarget:function AM(){var BE=this.defn;return this.isAttrElemListSelector()||(BE.srct===A4||BE.srcst===G);},supportSelectionColor:function q(){return Ao.call(this,[Av,Af]);}});mstrmojo.DocSelector.UC_ON_DS=BD;mstrmojo.DocSelector.STYLES={PULLDOWN:Ar,SCROLLER:Al,LIST:Av,RADIO:Ac,CHECKBOX:AF,BUTTON:AL,LINK:Af,METRIC_SLIDER:z,METRIC_QUAL:Aa,SEARCH_BOX:Ah,TEXT_BOX:h,ATTR_QUAL:B,VISUALIZATION:k};mstrmojo.DocSelector.DATAPARAMS={CESREADY:"cesReady",ELMSREADY:"elmsReady",ELMSREQUEST:"elemsRequest",METRICVALUES:"metricValues",CSREADY:"csReady",DISABLED:"disabled"};var C=mstrmojo.DocSelector.DATAPARAMS;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.mapbox.ui.selectors.OveralZoomSlider","mstrmojo.mapbox.ui.selectors.LayerZoomSlider","mstrmojo.mapbox.ui.selectors._SliderCommon","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.tooltip");var F=mstrmojo.gmaps,E=F.MapUtils,C=F.EnumPropertyType,D=3,B=mstrmojo.mapbox.ui.selectors._SliderCommon.getIndexByValue;mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.mapbox.ui.selectors._SliderCommon],{scriptClass:"mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl",cssClass:"mapbox-control-container mapbox-zoom-through-layers-container",layoutConfig:{w:{containerNode:"100%",leftPadding:"7px",rightPadding:"7px"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;},tooltipNode:function(){return[];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.mapbox.ui.selectors._SliderCommon.enabledMarkupMethod},init:function G(N){if(!N.host){throw new Error(this.scriptClass+"must be initialized with a host which is a mapbox");}var M=this,L=N.host,K=L.mapViewer,I=K&&K.baseLayer,J,O=I.minZoom,H=I.maxZoom;J=[{scriptClass:"mstrmojo.mapbox.ui.selectors.OveralZoomSlider",alias:"overalSlider",baseLayer:I,items:M.generateItems(O,H),getIndexByValue:B,verticalLineHeight:(8+K.getGraphicLayerCount()*22)+"px",onselectionChange:function(){var P=this.cs2Vl;I.setZoom(P);}}];K.forEachGraphicLayer(function(P){J.push({scriptClass:"mstrmojo.mapbox.ui.selectors.LayerZoomSlider",host:L,layer:P,items:M.generateItems(O,H),getIndexByValue:B,minZoom:O,maxZoom:H});},true,true);this.children=J;this._super(N);},onLayerSelectionChange:function A(J){if(!J){return null;}var X=this.host,Q=J.items,I=J.layer.key,K,P,R,M=this.children,H,S,O,N,L={},V=J.typeHelper,U=V&&V.getUnit(),W=U>0?D/U:D,Y;K=J.minLayerZoomLvl;P=K!==Q[J.min].v;R=P?J.min:J.max;for(N=1;N<M.length;N++){H=M[N];O=H.layer;S=O&&O.key;if(S!==I){if(Math.abs(R-H.min)<=W){Y=H.min;W=Math.abs(R-H.min);}if(Math.abs(R-H.max)<=W){Y=H.max;W=Math.abs(R-H.max);}}}if(E.checkDefined(Y)){R=Y;}if(R>=0&&R<Q.length){L[I]={};L[I][P?C.minLayerZoomLvl:C.maxLayerZoomLvl]=Q[R].v;X.writeMultipleProperties(L,true);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo._HasPopup","mstrmojo.Popup","mstrmojo.hash","mstrmojo.expr","mstrmojo.Container","mstrmojo.ConditionModel","mstrmojo.Widget","mstrmojo.Button","mstrmojo.ui.ColumnWalk","mstrmojo.rw.ConditionWalk","mstrmojo.mstr.EnumNodeDimty","mstrmojo.vi.ui.ConditionWalkProvider","mstrmojo.vi.ui.AllObjectsBrowser");var U=mstrmojo.Widget,M=mstrmojo.array,G=mstrmojo.dom,Q=mstrmojo.hash,b=mstrmojo.css,V=mstrmojo.Button.newWebButton,L=mstrmojo.expr,C=L.ET,A=mstrmojo.mstr.EnumNodeDimty,N=M.hash([A.NodeDimtyOutputLevel]);var O=mstrmojo.rw.ConditionWalk.getAttForms,E=mstrmojo.rw.ConditionWalk.isMdxDM;function F(){var d=this.model;if(d){if(!d.attachEventListener){Q.make(d,mstrmojo.ConditionModel,{defaultETAttr:d.defaultETAttr,data:d.data});}d.attachEventListener("edit",this.id,"onmodeledit");}}function P(e,d){if(d&&d.detachEventListener){d.detachEventListener("edit",e.id,"onmodeledit");}}mstrmojo.vi.ui.ConditionWalk=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.ConditionWalk",markupString:'<div id="{@id}" class="mstrmojo-vi-ui-ConditionWalk" mstrAttach:click><div class="walk"></div></div>',markupSlots:{walkNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:U.visibleMarkupMethod,onheightChange:U.heightMarkupMethod,onwidthChange:U.widthMarkupMethod},layoutConfig:{h:{walkNode:"100%"},xt:true},editor:undefined,columnWalk:undefined,walkProvider:null,objectBrowsingEnabled:false,children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"370px",width:"600px"}],postCreate:function B(){if(this._super){this._super();}if(!this.walkProvider){this.walkProvider=this.addDisposable(mstrmojo.insert(mstrmojo.vi.ui.ConditionWalkProvider));}},initWalk:function W(){var d=this.columnWalk,e=this.walkProvider;d.removeTrailingContainer(-1);d.addNextColumn(e.getTargetNodeProps());d.target.updateColumnContainer();this.updateOkBtn();},ob:{scriptClass:"mstrmojo.Popup",cssClass:"mstrmojo-vi-ui-ConditionWalk ObjectBrowserPopup mojo-theme-light",children:[{scriptClass:"mstrmojo.vi.ui.AllObjectsBrowser",alias:"browser",title:mstrmojo.desc(5298,"Select an Object"),layoutConfig:null,onSelectedItemsChange:function K(){var d=this.getSelectedItems(),e=d&&d[0],f=e&&e.t;this.parent.buttons.selectBtn.set("enabled",f&&f!==L.TP.FOLDER);},browse:function R(d){Q.copy(d,this);},getObjectSubTypes:function(){var d=this.browsableTypes;if(d){return d.split(",");}return this.constructor.prototype.browsableTypes();},dblClickOnNodes:function a(d){var g=this.onSelectCB,f=d.getTarget(),e=G.findWidget(f).data;g[0][g[1]](e);}},{scriptClass:"mstrmojo.Box",alias:"buttons",cssClass:"buttons",children:[V(mstrmojo.desc(221,"Cancel"),function(){this.parent.parent.opener.closePopup();}),V(mstrmojo.desc(547,"Select"),function(){var f=this.parent.parent,g=f.browser,h=g.onSelectCB,e=g.getSelectedItems(),d=this.parent.parent.opener;if(e&&e.length>0){h[0][h[1]](e[0]);}else{d.closePopup();}},true,{alias:"selectBtn",enabled:false})]}],onOpen:function H(){var h=this.shadowNode,d=document.body,e=document.documentElement,g=h.style,f=this.domNode;this.browser.obSearchBox.clearSearch(true);g.width=Math.max(d.clientWidth,e.scrollWidth)+"px";g.height=Math.max(d.clientHeight,e.scrollHeight)+"px";window.setTimeout(function(){b.addClass(f,"open");},1);},onClose:function D(){b.removeClass(this.domNode,"open");var d=this.browser;d.opened=false;d.reset();}},_set_model:function Z(g,d){var e=this.model,f=(d!==e);if(f){P.call(this,e);d.dimtyTypes=this.dimtyTypes||N;this.model=d;F.call(this,d);this.initWalk();}return f;},onmodeledit:function J(e){var d=this.columnWalk[e.prop==="c1"?"c0":e.prop];if(e.prop==="fm"){d=this.columnWalk.target;}if(d){d.updateColumnContainer();}this.updateOkBtn();this.postmodeledit(e);},postmodeledit:mstrmojo.emptyFn,updateOkBtn:function c(){var g=true,d=this.model,e,f=d&&L.fnCstCount(d.fn,d.fnt);if(!d){return ;}switch(d.et){case C.AQ:case C.AL:case C.MQ:for(e=0;e<f;e++){g=g&&!this["invalid"+e];}break;}g=g&&!!d.completed;this.delegateUpdateOkBtn(g);},delegateUpdateOkBtn:mstrmojo.emptyFn,browse:function I(f){var h=this.parent.editorNode,g=function(k,m){var j=G.position(k,true),l=G.position(m,true);return{x:j.x+j.w,y:l.y};},d=this.columnWalk,e=this.walkProvider;switch(f&&f.alias){case"target":case"dmy":e.browseObjs(this,f);break;case"c0":case"c1":e.browseObjs(this,f);break;case"es":e.browseEs(this,f,g(d.es.domNode,h));break;}},onOBSelect:function(j){var l=j.t;if(l===L.TP.FOLDER||l===0||l===undefined){return ;}var g=this.ob.browser,m=g.target;this.closePopup();if(m.alias==="c0"){m=m.attMxPd;}var e=this.targets,k=m.itemIdField,h=e||[],d=M.find(e,k,j[k]);if(d===-1){h.push(j);this.targets=h;this.targetsLastMod=new Date();this.raiseEvent({name:"updateTargets",targets:this.targets});}m.list.set("selectedIndex",M.find(m.items,"did",j.did));if(m.onObjBrowsed){m.onObjBrowsed(j);}},getDatasets:mstrmojo.emptyFn,getAttributeForms:function X(f){var e=this.editor;if(e&&e.getAttributeForms){return e.getAttributeForms(f);}var d=this.getDatasets();return O(f,d);},getAttributeInfo:function Y(d){var e,g=this.editor;if(g&&g.model&&g.model.targets){M.forEach(g.model.targets,function(h){if(h.did===d){e=Q.clone(h);return false;}});}else{var f=this.getDatasets();Q.forEach(f,function(h){e=Q.clone(h.att.filter(function(j){return j.did===d;})[0]);if(e){return false;}});}if(e){e.fs=this.getAttributeForms(d);}return e?e:{};},isMDXDM:function S(d){return E(d,this.getDatasets());},getIfDataSource:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.InteractiveUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.models.EnumDragSources","mstrmojo.ui.menus.MenuConfig","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.ui.DatasetUnitMenuUtils");mstrmojo.requiresDescs(221,629,1388,3397,14919,14920,14921,14923,14924,15023,15024);var R=mstrmojo.array,f=mstrmojo.css,J=mstrmojo.dom,Y=mstrmojo.hash,C=mstrmojo.string,L=mstrmojo.vi.ui.DatasetUnitMenuUtils,g=18,K=5,d=10,P=13,X="\u001E",j=mstrmojo.vi.controllers.EnumPanelManipulationType,e=mstrmojo.vi.controllers.EnumLayoutManipulationType,W=mstrmojo.vi.models.EnumDragSources,D=mstrmojo.vi.controllers.EnumEvents;function N(){this.set("items",(this.getAllItems()||[]).map(function(l){return Y.copy(l);}));}function k(q){var p=q.tgt.node,s=J.findAncestorByAttr(p,"idx",true,this.domNode),o=s&&s.node,r=parseInt(s&&s.value,10);var m=q.last&&q.last.y,n=o.getBoundingClientRect(),t=n&&n.top,l=n&&n.bottom;return(l-m)>(m-t);}function M(){return !(mstrApp.isAppStatePresentation()||mstrApp.isAppStateSelection())&&mstrApp.allowWebDashboardDesign();}mstrmojo.vi.ui.TableOfContentsUnitList=mstrmojo.declare(mstrmojo.vi.ui.InteractiveUnitList,[mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.vi.ui.TableOfContentsUnitList",chapter:null,level:null,multiSelect:true,useListModKeys:true,avatarCssClass:"tableOfContentUnitList",encodeUnitAvatar:true,init:function Z(l){this._super(l);N.call(this);},getItemMarkup:function G(l){return this._super(l).replace('<span class="txt" unselectable="on">{@en@n}</span>','<div class="icon" style="{@iconLeft}"></div><span class="txt {@midTruncateCssClass}" unselectable="on"">{@en@n}</span>').replace("{@midTruncateCssClass}",this.midTruncateCssClass);},getItemProps:function h(n,l){var m=this._super(n,l);if(n.mnu){m.addCls(mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_MENU);}m.dsc=n.dsc;if(this.level!==null){var o=d+this.level*P;m.addStyle("padding-left: "+(o+g+K)+"px;");m.iconLeft=C.encodeHtmlString("left:"+o+"px;");}return m;},getItemTooltip:function(o,q,p){var m=this.getLabelNode(q);if(this.hasTooltipContent(o,q)){var l=J.position(m),n="<div>"+C.encodeHtmlString(o.n)+"</div>"+(o.dsc?"<div>"+C.encodeHtmlString(o.dsc)+"</div>":"");return{areaId:o._renderIdx+"text",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:n,top:l.y-6,left:l.x,enableHover:true};}return null;},onchapterChange:N,getAllItems:function S(){return this.chapter&&this.chapter.panels;},reloadItems:N,addMenuProp:false,lastDragOverInfo:null,twoClicksItem:function c(s,q){if(!M()){return ;}var o=mstrmojo.all[this.panelId],p=o.model.id,m=this.chapter.k,r=this.chapter.panelStackKey,l=s.k,t=s.n;var n=this.getLabelNode(this.getItemNodeFromTarget(q.getTarget()));L.renameItem(n,s,function(u){mstrmojo.all[p].raiseEvent({name:D.MANIPULATE_PANEL,type:j.RENAME,panelKey:l,panelStackKey:r,layoutKey:m,newTitle:u.text,oldTitle:t});},{allowEmptyText:false,cssClass:n.className});},doItemSelect:function F(x,w){var p=w&&w.hWin,q=w&&w.e,n=(mstrApp.isAppStateSelection()),r=mstrmojo.all[this.panelId],m=J.isMetaKey(p,q),s=J.shiftKey(p,q),v=r.getPanelSelectedItems(),u=this.chapter.k,l=x.k,t=v.some(function(z){return z.ulist!==this;},this);if(t){if(s){if(!this.getSelectedItems().length){return ;}}else{if(m){return ;}else{var o={};R.forEach(v,function(AA){var z=AA.ulist.chapter.k;if(!o[z]){o[z]=true;r.getChapterPanel(z).clearSelect();}});}}}if(!s&&!m){r.model.raiseEvent({name:n?"targetLayoutSelected":"layoutSelected",layoutKey:u,panelKey:l});}if(!n){r.clearChapterSelect();this._super(x,w);}},isDragValid:function B(l){return M()&&this._super(l);},oncontextmenu:function a(l){if(!M()){mstrmojo.dom.preventDefault(window,l.e);return false;}return this._super(l);},showMultiSelectionMenu:function O(n,q,m){var l={};R.forEach(n,function(u){var t=u.layoutKey;if(!l[t]){l[t]={layoutKey:t,layoutName:u.ulist.chapter.title,panelKeys:[u.k],panelNames:[u.n],panelStackKey:u.pnk,panelCntInLayout:u.ulist.items.length,allPanelsSelected:false};}else{l[t].panelKeys.push(u.k);l[t].panelNames.push(u.n);}});Y.forEach(l,function(t){t.allPanelsSelected=(t.panelCntInLayout===t.panelKeys.length);});l=Y.valarray(l);var p=mstrmojo.all[this.panelId],o=p.model,s=o.id;var r=new mstrmojo.ui.menus.MenuConfig({position:m,isHostedWithin:false});if(l.length===1&&l[0].allPanelsSelected&&p.chapterCount>1){r.addMenuItem(mstrmojo.desc(15023,'Delete Chapter "##"').replace("##",l[0].layoutName),"",function(){mstrmojo.warn(mstrmojo.desc(14921,"Deleting a chapter will delete all the pages in this chapter. Do you want to continue?"),{confirmBtn:{t:mstrmojo.desc(629,"Delete"),fn:function(){mstrmojo.all[s].raiseEvent({name:D.MANIPULATE_LAYOUT,type:e.DELETE,layoutKey:l[0].layoutKey});},hot:false},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});});}else{if(l.length===1&&!l[0].allPanelsSelected){r.addMenuItem(mstrmojo.desc(15024,"Delete ## Pages").replace("##",n.length),"",function(){mstrmojo.all[s].raiseEvent({name:D.MANIPULATE_PANEL,type:j.DELETE,panelKeys:l[0].panelKeys,layoutKey:l[0].layoutKey});});}}if(r.hasMenuItems()){this.openPopup(r.newInstance());}},showItemMenu:function H(AB,n,t){this.doItemSelect(AB,{});var w=new mstrmojo.ui.menus.MenuConfig({position:t,isHostedWithin:false}),v=mstrmojo.all[this.panelId],m=this.chapter.k,p=this.chapter.title,AA=this.chapter.panelStackKey,l=AB.k,s=v.model,z=s.id;var u=this.items.length,r=v.chapterCount,x=AB._renderIdx,q=this.title;w.addMenuItem(mstrmojo.desc(14919,"Insert Page"),"",function(){mstrmojo.all[z].raiseEvent({name:D.MANIPULATE_PANEL,type:j.NEW,panelKey:l,panelStackKey:AA,layoutKey:m});});w.addMenuItem(mstrmojo.desc(14923,"Duplicate Page"),"dup",function(){mstrmojo.all[z].raiseEvent({name:D.MANIPULATE_PANEL,type:j.DUPLICATE,panelKey:l,panelStackKey:AA,layoutKey:m});});var o=this.getLabelNode(this.getItemNodeFromTarget(n));w.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){L.renameItem(o,AB,function(AC){mstrmojo.all[z].raiseEvent({name:D.MANIPULATE_PANEL,type:j.RENAME,panelKey:l,panelStackKey:AA,layoutKey:m,newTitle:AC.text,oldTitle:AB.n});},{allowEmptyText:false,cssClass:o.className});});if(u>1){w.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.all[z].raiseEvent({name:D.MANIPULATE_PANEL,type:j.DELETE,panelKey:[l],panelKeys:[l],panelStackKey:AA,layoutKey:m});});}else{if(u===1&&r>1){w.addMenuItem(mstrmojo.desc(15023,'Delete Chapter "##"').replace("##",p),"cls",function(){mstrmojo.warn(mstrmojo.desc(14921,"Deleting a chapter will delete all the pages in this chapter. Do you want to continue?"),{confirmBtn:{t:mstrmojo.desc(629,"Delete"),fn:function(){mstrmojo.all[z].raiseEvent({name:D.MANIPULATE_LAYOUT,type:e.DELETE,layoutKey:m});},hot:false},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});});}}this.openPopup(w.newInstance());},allowDrop:function I(o){var p=o.getCtxtDragData(),l=p.src;if(l===W.TOC_PAGES_LIST&&p.chapterKey===this.chapter.k){return true;}else{if(l===W.TOC_PAGES_LIST&&p.chapterKey!==this.chapter.k&&p.items.length===1){return true;}}var n=mstrmojo.all[this.panelId],q=n.getChapterPanel(this.chapter.k),m=q.pageDnDIndicatorNode;m.style.display="none";return false;},getDragData:function E(m){this.selectDragNode(m);var l=this.avatarCssClass,n=this,p=this._super(m);p.src=W.TOC_PAGES_LIST;p.chapterKey=this.chapter&&this.chapter.k;p.panelStackKey=this.chapter&&this.chapter.panelStackKey;p.isAllPageSelected=(this.chapter&&this.chapter.panels.length)===p.items.length;p.setAvatarClass=function o(q){var r=n.avatar;if(r){var s=["mstrmojo-VIUnitList",l,"hasOwnAvatar",mstrApp.getThemeClassName(),q||""];r.className=s.join(" ");}};return p;},ondrop:function b(p){var r=p.getCtxtDragData&&p.getCtxtDragData(),z=mstrmojo.all[this.panelId],AA=z.getChapterPanel(this.chapter.k),AC=AA.pageDnDIndicatorNode,w=this.chapter.k,x=this.chapter.panelStackKey,AB=this.chapter.panels.length,q=z.model,AG=this.lastDragOverInfo&&this.lastDragOverInfo.targetIdx,m=this.lastDragOverInfo&&this.lastDragOverInfo.onTopHalf;AC.style.display="none";if(!(r.item&&r.items.length>0&&this.lastDragOverInfo)){return ;}var v=[],l=[];R.forEach(r.items,function(AH){v.push(AH.k);l.push(AH._renderIdx);});if(r.chapterKey===w){var AD=l[0],o=AG,t=AD>AG,s=AD<AG;if(m&&s){o=AG-1;}else{if(!m&&t){o=AG+1;}}var u=[o];for(var AF=1;AF<l.length;AF++){for(var AE=AF;AE<l.length;AE++){if(AD<l[AE]&&l[AE]<=o){l[AE]--;}else{if(o<=l[AE]&&l[AE]<AD){l[AE]++;}}}AD=l[AF];if(AD>o){o=Math.min(o+1,AB-1);}u.push(o);}q.raiseEvent({name:D.MANIPULATE_PANEL,type:j.MOVE,panelKeys:v,panelStackKey:x,layoutKey:w,fromIdx:l,toIdx:u});}else{var n=function(){q.raiseEvent({name:D.MANIPULATE_PANEL,type:j.CROSS_CHAPTER_MOVE,panelKeys:v,srcPanelStackKey:r.panelStackKey,srcLayoutKey:r.chapterKey,tgtPanelStackKey:x,tgtLayoutKey:w,toIdx:m?AG:AG+1,isAllPageSelected:r.isAllPageSelected});};if(q.hasFilters(r.chapterKey)){mstrmojo.warn(mstrmojo.desc(15630,"Moving this page will clear the filtering applied through the Filter Panel and may cause visualizations to return a very large amount of data. Do you want to continue?"),{confirmBtn:{t:mstrmojo.desc(212,"Continue"),fn:n},cancelBtn:{t:"Cancel"}});}else{n();}}},ondragover:function V(p){var u=mstrmojo.all[this.panelId],x=u.getChapterPanel(this.chapter.k),z=x.pageDnDIndicatorNode,o=p.tgt.node,s=J.findAncestorByAttr(o,"idx",true,this.domNode),n=s&&s.node,q=parseInt(s&&s.value,10);var t=k(p);var w=this.domNode.getBoundingClientRect(),m=n.getBoundingClientRect(),v=m&&m.top,l=m&&m.bottom,r=-15-w.top;this.lastDragOverInfo={onTopHalf:t,targetIdx:q};z.style.display="block";if(t){z.style.top=(v+r)+"px";}else{z.style.top=(l+r)+"px";}},ondragleave:function A(l){var n=mstrmojo.all[this.panelId],p=n.getChapterPanel(this.chapter.k),m=p.pageDnDIndicatorNode,o=l.tgt&&l.tgt.widget;if(o.id!==p.id){m.style.display="none";}if(this._super){this._super(l);}},positionAvatar:function Q(m,l){l.dragOffsets={x:15,y:20};if(this._super){this._super(m,l);}},getDropAvatarIcon:function U(l){return"move";}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.InteractiveUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.vi.models.EnumDragSources");mstrmojo.requiresDescs();var F=mstrmojo.array,G=mstrmojo.css,E=mstrmojo.dom,B=mstrmojo.hash,L=mstrmojo.string,O=18,M=3,A=10,K=13,D="\u001E";function C(){this._dsetId=this.dataset&&this.dataset.id||"";this.set("items",this.filterItems(this.getAllItems()).map(function(Q){return B.copy(Q);}));}mstrmojo.vi.ui.DatasetUnitList=mstrmojo.declare(mstrmojo.vi.ui.InteractiveUnitList,null,{scriptClass:"mstrmojo.vi.ui.DatasetUnitList",dataset:null,filterScope:"",filterExpr:"",filterFunc:null,level:null,dropZone:false,init:function P(Q){this._super(Q);if(!!mstrApp.isWSStyling){A=7;}C.call(this);},getItemMarkup:function J(Q){return this._super(Q).replace('<span class="txt" unselectable="on">{@en@n}</span>','<div class="icon" style="{@iconLeft}"></div><span class="txt {@midTruncateCssClass}" unselectable="on"">{@en@n}</span>').replace("{@en@n}","{@matchHTML}").replace("{@midTruncateCssClass}",this.midTruncateCssClass);},getItemProps:function H(Y,X){var U=this._super(Y,X);if(Y.mnu){U.addCls(mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_MENU);}U.dsc=Y.dsc;var R=this.filterExpr,W,Z=U.n,S=mstrmojo.string.encodeHtmlString;if(R){W=new RegExp(L.regEscape(R),"ig");if(W.test(Z)){Z=Z.replace(W,function(a){return D+a+D;});}var Q=F.map((Z||"").split(D),function(b,a){return(a%2===0)?S(b):("<em>"+S(b)+"</em>");});U.matchHTML=Q.join("");}else{U.matchHTML=S(Z);}if(this.level!==null){var V=A+this.level*K;U.addStyle("padding-left: "+(V+O+M)+"px;");U.iconLeft=L.encodeHtmlString("left:"+V+"px;");}return U;},prefilterScopeChange:C,prefilterExprChange:C,ondatasetChange:C,getAllItems:null,reloadItems:C,filterItems:function(Q){Q=Q.filter(function(U){return U&&!U.hide;});switch(this.filterScope){case"att":Q=Q.filter(function(U){return U.t!==4;});break;case"mx":Q=Q.filter(function(U){return U.t===4;});break;}var S=this.filterExpr;if(S){var R=[];F.forEach(Q,function(V){var U=B.copy(V),X=U.n,W=new RegExp(L.regEscape(S),"ig");if(W.test(X)){R.push(U);}});Q=R;}if(this.filterFunc){Q=this.filterFunc(Q);}return Q;},addMenuProp:false,getDragData:function N(Q){this.selectDragNode(Q);var R=this._super(Q);R.item=R.items&&R.items[0];R.dsid=this.dataset.id;R.src=mstrmojo.vi.models.EnumDragSources.DATASETS;return R;},selectDragNode:function I(R){this._super(R);var S=R.src.data;if(S){var Q=S.items=mstrmojo.all[S.srcId].getSelectedItems();S.item=Q&&Q[0];}}});}());(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.vi.ui.ElementsBrowser","mstrmojo.vi.ui.IncHierarchyList","mstrmojo.Label","mstrmojo.css","mstrmojo.hash","mstrmojo.desc");mstrmojo.requiresDescs(15830,10);var H=mstrmojo.desc,S=mstrmojo.css,M=mstrmojo.hash;mstrmojo.vi.ui.editors.HierarchyElementsListPanel=mstrmojo.declare(mstrmojo.vi.ui.ElementsBrowser,null,{scriptClass:"mstrmojo.vi.ui.editors.HierarchyElementsListPanel",markupString:'<div id="{@id}" class="mstrmojo-Box mstrmojo-ui-vi-ElementsBrowser mstrmojo-HierarchyElementsListPanel {@cssClass}" style="{@cssText}"><div class="searchBar"><div></div><div></div></div><div></div></div>',markupSlots:{containerNode:function(){return this.domNode;},titleNode:function(){return this.domNode.firstChild.childNodes[0];},searchBoxNode:function(){return this.domNode.firstChild.childNodes[1];},elementListNode:function(){return this.domNode.childNodes[1];}},layoutConfig:null,children:[{scriptClass:"mstrmojo.Label",cssClass:"title",text:H(15830,"Elements List"),slot:"titleNode"},{scriptClass:"mstrmojo.SearchWidget",slot:"searchBoxNode",alias:"searchBox",quickSearchForClear:true,placeholderText:H(10,"Search"),onsearch:function F(V){var W=!this.parent.searchPattern&&!V;if(!W){this.parent.set("searchPattern",V);}},onclear:function U(){this.onsearch();},},{scriptClass:"mstrmojo.vi.ui.IncHierarchyList",alias:"elementList",slot:"elementListNode",allowUnlistedValues:false,bindings:{multiSelect:function(){return this.parent.multiSelect;},useListModKeys:function(){return this.parent.useListModKeys;},disableDrop:function(){return this.parent.disableDrop;}},getDataHelper:function(){return this.parent.ifDataHelper;},getAttribute:function(){return this.parent.attribute;},isHiearachyDisplay:function E(){var V=this.parent;return !V.searchPattern||V.searchPattern==="";},setSelectedItems:function K(V){if(typeof V==="object"){this.setSelectionByExprJSON(V);}},postSelectionChange:function C(){var V=this.getAttribute();if(V){this.parent.onItemsSelectionChange(this.buildSelectionExprJSON(V));}},ondblclick:function G(V){this.parent.handleDblClick(this,V);},handleSetParent:function O(V){this.parent.handleSetParent(V);},getCurrentPE:function B(){return this.parent.getCurrentPE();},getExcludeList:function P(){return this.parent.getExcludeList();},processDragStart:function N(V){return this.parent.processDragStart(V);},processDrop:function L(V){return this.parent.processDrop(V);},processDragEnd:function I(V){return this.parent.processDragEnd(V);}}],onattributeChange:function A(V){var W=this.elementList;W.clearItems();this._super(V);},getSearchBox:function J(){return this.searchBox;},onsearchPatternChange:function R(){this._super();this.toggleFlatCssClassForList();},toggleFlatCssClassForList:function D(){var V=this.elementList;if(V.hasRendered){S.toggleClass(V.domNode,"flat",!V.isHiearachyDisplay());}},resetDisplay:function Q(){var W=mstrApp.rootCtrl.docCtrl,V=W.model;this.getSearchBox().reset();this.searchPattern="";this.toggleFlatCssClassForList();this.elementList.clearSelect();this.set("ifDataSource",W.dataService());this.onUpdateBrowseElementsParams=function(X){M.copyProps(["datasetID","messageID"],this.getBrowseConfig(),X);};this.set("attribute",M.copyProps(["did","fs","n","t","st"],V.findUnitInDataSet(this.getAttributeIdFromModel())));this.postResetDisplay();},_set_selectedItems:null,getAttributeIdFromModel:mstrmojo.emptyFn,getBrowseConfig:mstrmojo.emptyFn,postResetDisplay:mstrmojo.emptyFn,onElementsListchange:mstrmojo.emptyFn,updateClearAllBtnState:mstrmojo.emptyFn,handleDblClick:mstrmojo.emptyFn,handleSetParent:mstrmojo.emptyFn,getCurrentPE:mstrmojo.emptyFn,getExcludeList:mstrmojo.emptyFn,processDragStart:mstrmojo.emptyFn,processDrop:mstrmojo.emptyFn,processDragEnd:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.chart.enums.EnumFontStyle");mstrmojo.requiresClsP("mstrmojo.ui.editors.controls","CharacterGroup","ContainerGroup","TwoColumnContainer","ColorPickerButton","LineStyleButton","ValidationTextBox");var R=mstrmojo.hash,Y=mstrmojo.emptyFn,O=mstrmojo.array,H=mstrmojo.ui.editors.controls.CharacterGroup.CTRL_FLAGS,A=mstrmojo.chart.enums.EnumFontStyle,Q=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,N=mstrmojo.gm,W=mstrmojo.expr.DTP;var P="allTxt",E="lg",Z=0,b=1;var I=false;function B(c){if(I&&window.console){window.console.log(c);}}function a(c,e){return{broker:c,smartNames:e,controlName:e[0],reInitDefault:function(){(this.listenFormatProps).forEach(function(f){this.onFmtPropsChanged(f,this.broker.getFormatPropertyValue(f));},this);},reInit:function(){this.reInitDefault();},preBuildRendering:function(){this.reInit();},syncControl:function(f){var g=this._sync;this._sync=true;var h=f.call(this);this._sync=g;return h;},onFmtPropsChangedDefault:Y,onFmtPropsChanged:function(f,h,g){this.onFmtPropsChangedDefault(f,h,g);},onSelectorsValueChangedDefault:function(){this.reInit();},onSelectorsValueChanged:function(f,g){this.onSelectorsValueChangedDefault(f,g);},destroy:function d(f){this.broker.removeRegisterFormatControl(this);return this.constructor.prototype.destroy.call(this,f);}};}function L(h,f,d,c){if(!h){return ;}function g(p){return Object.keys(O.hash(O.ensureArray(p)));}var k=h.listenFormatProps||[],m=h.listenSelector||[];(h.smartNames||[]).forEach(function(p){O.insert(k,null,p);O.insert(m,null,h.broker.getDependingSelectorNames(p));});h.listenFormatProps=g(k);h.listenSelector=g(m);h.broker.registerFormatControl(h);var o=h;if(typeof f==="string"){var e=(d===b),j=e?"20px":"30%",l=e?"100%":"70%";if(c){j=c[0];l=c[1];}o=this.getLabelAndControl(f,h,j,l,e);h.label=o.getLabel();if(e){o.cssClass="checkLabel multiLine";h.label.onclick=function n(){h.onclick();};h.label.cssDisplay="inline-block";}else{if(d===Z){o.cssClass="characterGroup";}}}h.getCtrlContainer=function(){return o;};return o;}function U(e,d){var f=e.getFormatPropertyValue(d);function c(h){var j=h.value;return(j===undefined||j==="")&&f===undefined;}return{onInvalid:function g(){if(c(this)){if(this.hasRendered){this.clearValidation();}return ;}else{if(this.hasRendered){mstrmojo.ui.editors.controls.ValidationTextBox.prototype.onInvalid.call(this);}}},onRender:function(){if(c(this)){this.clearValidation();}}};}function G(f,d){var c={},j=f.getFormatPropertyValue(d.fontStyle),g=f.getFormatPropertyValue(d.fontColor),e=f.getFormatPropertyValue(d.fontFamily),h=f.getFormatPropertyValue(d.fontSize);if(j!==undefined){c[Q.FONT_WEIGHT]=(!isNaN(j)&&((j&A.FS_BOLD)>0));c[Q.FONT_STYLE]=(!isNaN(j)&&((j&A.FS_ITALIC)>0));c[Q.UNDERLINE]=(!isNaN(j)&&((j&A.FS_UNDERLINE)>0));c[Q.LINE_THROUGH]=(!isNaN(j)&&((j&A.FS_STRIKETHROUGH)>0));}c[Q.COLOR]=g!==undefined?g:-1;c[Q.FONT_SIZE]=h!==undefined?h:-1;c[Q.FONT_FAMILY]=e!==undefined?e:-1;return c;}mstrmojo.imagelayout.ImageLayoutEditorHelper=mstrmojo.provide("mstrmojo.imagelayout.ImageLayoutEditorHelper",{getFillConfigComp:function V(g,d,e,k){var c=g.propertyManager,j=R.valarray(e),f=a(c,j);R.copy({smartNamesMap:e,onGroupValueChange:function(l,m){if(!this._sync){c.setFormatPropertyValue(l,m);}},onFmtPropsChangedDefault:function(l,m){this.syncControl(function(){var n=this;if(O.filterOne(this.propNames,function(o){return(o===l);})){n.setChildValue(l,m);}else{this.propNames.forEach(function(o){n.setChildValue(o,c.getFormatPropertyValue(o));});}});}},f);R.copy(k,f);var h=g.addDisposable(new mstrmojo.ui.editors.controls.FillConfigGroup(f));h.iniChildrenComp(j);return L.call(this,h,d);},getLineConfigComp:function X(g,d,e,k){var c=g.propertyManager,j=R.valarray(e),f=a(c,j);R.copy({smartNamesMap:e,onGroupValueChange:function(l,m){if(!this._sync){c.setFormatPropertyValue(l,m);}},onFmtPropsChangedDefault:function(l,m){this.syncControl(function(){this.setChildValue(l,m);});}},f);R.copy(k,f);var h=g.addDisposable(new mstrmojo.ui.editors.controls.LineConfigGroup(f));h.iniChildrenComp(j);return L.call(this,h,d);},getCharacterConfigComp:function D(h,l,g,m){var c=h.propertyManager,n=R.valarray(g),k=a(c,n),j={},f={};f[Q.FONT_SIZE]=g.fontSize;f[Q.COLOR]=g.fontColor;f[Q.FONT_FAMILY]=g.fontFamily;f[Q.FONT_WEIGHT]=f[Q.FONT_STYLE]=f[Q.UNDERLINE]=f[Q.LINE_THROUGH]=g.fontStyle;j[Q.FONT_WEIGHT]=A.FS_BOLD;j[Q.FONT_STYLE]=A.FS_ITALIC;j[Q.UNDERLINE]=A.FS_UNDERLINE;j[Q.LINE_THROUGH]=A.FS_STRIKETHROUGH;R.copy({smartNamesMap:g,syncWithAllText:false,onGroupValueChange:function(r,q){var t=f[r];if(t===g.fontStyle){var p=c.getFormatPropertyValue(t),s=j[r],o=q;q=o?(p|s):(p&(~s));}else{if(t===g.fontSize){if(this.visibleControls&H.FONT_SIZE_USE_STEPPER){q=q[0];}q=parseInt(q,10)+"pt";}}this.broker.setFormatPropertyValue(t,q);},onFmtPropsChangedDefault:function(o){this.syncControl(function(){var p=this.smartNamesMap,q=O.filterOne(R.keyarray(p),function(r){return p[r]===o;});if(q||this.syncWithAllText){if(!q&&o.indexOf(P)===-1){B("[CharacterGroup] Unnecessary refresh which might be due to incorrect listenFormatProps.");}this.refreshValues();}});},refreshValues:function(){this.syncControl(function(){var o=G(this.broker,this.smartNamesMap);if(this.visibleControls&H.FONT_SIZE_USE_STEPPER){o[Q.FONT_SIZE]=[parseInt(o[Q.FONT_SIZE],10)];}this.setFormatSource(o);});}},k);R.copy(m,k);if(k.syncWithAllText){var e=R.valarray(c.getSmartNamesMapForFontGroup(P));k.listenFormatProps=(k.listenFormatProps||[]).concat(e);}var d=h.addDisposable(new mstrmojo.ui.editors.controls.CharacterGroup(k));return L.call(this,d,l);},getPropertyCheckBox:function J(g,e,d,k){var c=g.propertyManager,j=[d],f=a(c,j);R.copy({oncheckedChange:function(){if(this._sync){return ;}c.setFormatPropertyValue(this.smartNames[0],this.checked);},onFmtPropsChangedDefault:function(l,m){this.syncControl(function(){this.set("checked",!!m);});}},f);R.copy(k,f);var h=g.addDisposable(new mstrmojo.ui.Checkbox(f));return L.call(this,h,e,b);},getPropertyPulldown:function S(g,k,h,c,l){l=l||{};var e=g.propertyManager,m=[c],j=a(e,m),d=l.fnChange||function(n){if(this._sync){return ;}e.setFormatPropertyValue(this.smartNames[0],n);};R.copy({onFmtPropsChangedDefault:function(n,o){this.syncControl(function(){if(typeof o==="undefined"){this.set("selectedIndex",-1);}else{this.selectItemByField("v",o);}});}},j);R.copy(l,j);var f=g.addDisposable(this.getPulldown(h,d,0,j));return L.call(this,f,k,null,["40%","60%"]);},getPropertyButtonBar:function M(f,j,g,c,k){var d=f.propertyManager,l=[c],h=a(d,l);R.copy({showIcon:false,items:g,onFmtPropsChangedDefault:function(m,n){this.syncControl(function(){if(this.multiSelect){this.select((this.items||[]).map(function(p,o){return(n&p.v)>0?o:null;}).filter(function(o){return o!==null;}));}else{if(typeof n==="undefined"){this.clearSelect();}else{this.singleSelectByField(n,"v");}}});},postselectionChange:function(m){if(this._sync){return ;}var n=m.added&&this.items[m.added[0]].v;if(this.multiSelect){if(!g||!g.length){return B("[ImageLayoutEditorModel getBitwiseValFromMultiSelection] no items in caller");}n=g.reduce(function(q,p,o){return this.selectedIndices[o]?q|=p.v:q;}.bind(this),0);}d.setFormatPropertyValue(this.smartNames[0],n);}},h);R.copy(k,h);var e=f.addDisposable(new mstrmojo.ui.ButtonBar(h));return L.call(this,e,j);},getPropertyValidationTextBox:function C(g,e,d,k){var c=g.propertyManager,j=[d],f=a(c,j);R.copy({dtp:W.FLOAT,required:true,onValid:function(){if(this._sync){return ;}c.setFormatPropertyValue(this.smartNames[0],this.value);},onFmtPropsChangedDefault:function(l,m){this.syncControl(function(){this.set("value",m);this.validate();});}},f);R.copy(k,R.copy(U(c,d),f));var h=g.addDisposable(new mstrmojo.ui.editors.controls.ValidationTextBox(f));return L.call(this,h,e);},getPulldown:function F(d,g,c,f,e){R.copy({_set_selectedIndex:function h(l,j){if(j===-1){this.selectedIndex=j;this.getPopupList().clearSelect();var k=this.selectedNode;if(k){k.innerHTML="";}return false;}return this.constructor.prototype._set_selectedIndex.call(this,l,j);}},f);return mstrmojo.ui.Pulldown.newPulldown(d,function(j,k){g.call(this,j.v,k&&k.v);},c,f,e);},getLabelAndControl:function K(e,f,h,k,g,j){var l=new mstrmojo.Label({text:e,setDimensions:function(o,m){var n=this.domNode;if(n){n.style.width=m;}}}),d=l,c=f;if(g){d=f;c=l;}d.slot="col1Node";c.slot="col2Node";return new mstrmojo.ui.editors.controls.TwoColumnContainer(R.copy(j,{col1Width:h||"40%",col2Width:k||"60%",children:[d,c],getLabel:function(){return l;},getCtrl:function(){return this.children.filter(function(m){return m!==l;})[0];}}));}});}());(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.hash","mstrmojo.color","mstrmojo.expr","mstrmojo.Button","mstrmojo.ui.Checkbox","mstrmojo.ui.Pulldown","mstrmojo.util.ui.ColorPicker","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.kpicard.editors.KPICardThresholdHeaderControl","mstrmojo.models.FormatModel","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum","mstrmojo.string","mstrmojo._CanValidate","mstrmojo._FormatDefinition","mstrmojo.NumStepperContentProvider","mstrmojo.ui.editors.controls.Stepper","mstrmojo.VisEnum");var P=mstrmojo.hash,d=mstrmojo.array,g=mstrmojo.expr.DTP,l=mstrmojo.models.FormatModel,L=mstrmojo.ui.Pulldown,Q=mstrmojo.util.ui.ColorPicker,w=mstrmojo.string,a=mstrmojo.kpicard.DISPLAY_MODE,Y=mstrmojo.kpicard.BADGE_MODE,X=mstrmojo.kpicard.KPI_STYLES,S=mstrmojo.kpicard.KPI_PROPERTIES,K=mstrmojo.kpicard.DEFAULT_PROPS,j=mstrmojo.kpicard.TEXT_SIZE_TYPE,Z=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,f=mstrmojo.validation.STATUSCODE;var k=1,r="automatic",I=K.ibc,x=K.dbc;var E=[{n:mstrmojo.desc(959,"Default"),id:a.DEFAULT},{n:mstrmojo.desc(359,"Stacked"),id:a.STACKED},{n:mstrmojo.desc(12286,"Horizontal"),id:a.HORIZONTAL},{n:mstrmojo.desc(12285,"Vertical"),id:a.VERTICAL},{n:mstrmojo.desc(114,"Grid"),id:a.GRID}],t=[{n:mstrmojo.desc(2057,"None"),id:Y.NONE},{n:mstrmojo.desc(2053,"Percentage"),id:Y.PERCENTAGE},{n:mstrmojo.desc(527,"Value"),id:Y.VALUE}];function z(AB){var AC=this.id;return function(AH){var AG=mstrmojo.all[AC];if(!AG){return ;}if(AB===S.DISPLAY_MODE){if(AG.warning){AG.warning=false;return ;}if(AH.id===a.STACKED){var AE=this,AF=AG.getHost(),AD=AF.getFormatPropertyValue(AB),AJ=function(){mstrmojo.all[AC].onPropertiesChanged(AB,AH.id);},AI=function(){AG.warning=true;AE.set("selectedIndex",parseInt(AD)-1);};AF.zonesModel.checkBreakByLimit(AJ,AI);return ;}}mstrmojo.all[AC].onPropertiesChanged(AB,AH.id);};}function b(){var AC=this.getHost(),AB=AC.getDefaultPrimaryValueColor();AC.addColorThreshold(AB);}function u(AC){var AB=this.getHost();AB.plusMinus=AC;this.setFontPropertyValue(this.selectedFontPart,S.UNIFY_STEPS,AC);}function F(AD,AC){var AB={};AB.scriptClass="mstrmojo.Button";AB.cssClass="mstrmojo-WebButton kpi-icon "+AC;AB.onclick=u.bind(AD,AC==="reset"?0:(AC==="plus"?1:-1));return AB;}mstrmojo.vi.models.editors.KPICardEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.KPICardEditorModel",help:"format_panel_kpi.htm",warning:false,updateColorSub:null,init:function s(AB){if(this._super){this._super(AB);}var AC=this.getHost();if(AC&&AC.id&&AC.onBEMFormatChange){this.updateColorSub=this.attachEventListener("BEMFormatChange",AC.id,AC.onBEMFormatChange);}},destroy:function o(AB){if(this._super){this._super(AB);}var AC=this.updateColorSub;if(AC){this.detachEventListener(AC);this.updateColorSub=null;}},getInitialTarget:function p(){return k;},getTargetPulldownItems:function m(AC){var AF=this._super(AC),AE=this.getHost(),AD=this,AB=function(){var AG=AD.getKPISettingControls;AD.replaceChildControls(AC,AG.call(AD));};if(this.isNormalOrExcludeAllDataButNotInPauseMode(AE)){AF.unshift({n:mstrmojo.desc(6560,"General Settings"),v:k,h:AB});}return AF;},fnGetPulldown:function G(AJ,AE,AD,AH,AL){var AG,AK;if(AJ&&AJ.length){AK=L.newPulldown(AJ,z.call(this,AH),AE,{isHostedWithin:false,getPopupListConfig:function AF(){var AM=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);AM.getItemProps=function AN(AQ,AO){var AP=mstrmojo._IsList.getItemProps.call(this,AQ,AO);AP.style=AQ.preview?"font-family:'"+w.encodeHtmlString(AQ.n,true)+"';":"";return AP;};return AM;}});if(AD!==undefined){var AB=AL||{};var AI=AB.labelWidth||"50%";var AC=AB.pulldownWidth||"50%";AG=this.getLabelAndControl(AD,AK,AI,AC);}else{AG=AK;}}return AG;},onPropertiesChanged:function e(AC,AD){var AB=this.getHost();AB.writeProperties(AC,AD);},getKPISettingControls:function O(){var AB=[],AD=this.getHost();if(AD.getUnitsByDropZoneID("BreakBy").length>0){AB.push(this.getDisplayModeCtrolGroup());}AB.push(this.getStyleControls());if(AD.getUnitsByDropZoneID("trend").length>0){AB.push(this.getBadgeControlGroup());}AB.push(this.getThresholdControlGroup());var AC=[this.getEditorGroup([this.getEditorGroup(AB)],{showDivider:true,isNested:true,isContainer:true}),this.getEditorGroup([this.getMoreOptionsEditorLink((AD.modelData&&AD.modelData.gsi&&AD.modelData.gsi.prop)||{})])];return AC;},getShowMetricNameCheckbox:function N(){var AE=this,AD=this.getHost(),AG=AD.getFormatPropertyValue(S.SHOW_METRIC_NAME),AC=new mstrmojo.ui.Checkbox({checked:AG==="true",oncheckedChange:function AH(AI){AE.onPropertiesChanged(S.SHOW_METRIC_NAME,AI.value.toString());}}),AF=this.getLabelAndControl(mstrmojo.desc(15915,"Show metric name"),AC,"14px","100%",true),AB=AF.getLabel();AB.onclick=function(){AC.onclick();};return AF;},getDisplayModeCtrolGroup:function B(){var AC=[],AD=this.getHost(),AB=AD.getFormatPropertyValue(S.DISPLAY_MODE);AC.push(this.getShowMetricNameCheckbox());AC.push(new mstrmojo.Label({text:mstrmojo.desc(4963,"Display Mode")}));AC.push(this.fnGetPulldown(E,this.getDisplayModeSelectedIndex(),undefined,S.DISPLAY_MODE));if(AB===a.STACKED){AC.push(this.getAutoPlayCheckbox());}else{if(AB===a.GRID){var AE=AD.getFormatPropertyValue(S.FIX_CARD_HEIGHT);AC.push(this.getGridColumnCountInputCtrl());AC.push(this.getFixCardHeightCheckbox());if(AE){AC.push(this.getFixedCardHeightInputCtrl());}}}return this.getEditorGroup(AC,{showDivider:true,isNested:true,isContainer:true});},getDisplayModeSelectedIndex:function C(){var AD=this.getHost(),AC=AD.getFormatPropertyValue(S.DISPLAY_MODE),AB=0;switch(AC){case a.DEFAULT:AB=0;break;case a.STACKED:AB=1;break;case a.HORIZONTAL:AB=2;break;case a.VERTICAL:AB=3;break;case a.GRID:AB=4;break;default:break;}return AB;},getFixCardHeightCheckbox:function J(){var AD=this.getHost(),AF=AD.getFormatPropertyValue(S.FIX_CARD_HEIGHT),AC=new mstrmojo.ui.Checkbox({checked:AF,oncheckedChange:function AG(AI){var AJ=AI.value;var AL=[];if(AJ){var AN=AD.getFormatPropertyValue(S.GRID_COLUMN_COUNT),AK=AD.singleKPIModels.length,AM=Math.ceil(AK/AN),AH=Math.floor(parseFloat(AD.height)/AM);AL.push({propertyName:S.CARD_HEIGHT,value:AH,oldValue:AD.getFormatPropertyValue(S.CARD_HEIGHT)});}AD.writeProperties(S.FIX_CARD_HEIGHT,AI.value.toString(),AL);}}),AE=this.getLabelAndControl(mstrmojo.desc(16027,"Fix card height"),AC,"14px","100%",true),AB=AE.getLabel();AB.onclick=function(){AC.onclick();};return AE;},getNumericInputCommonProperty:function R(AB){return{cssClass:"kpi-cth-TextBox",errRevert:false,dtp:g.INTEGER,validationDelay:1500,updateText:function(AC){this.inputNode.value=AC;this.value=AC;},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C triangle-warning",left:this.domNode.offsetWidth+10,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};if(this.tooltipTimeout){window.clearTimeout(this.tooltipTimeout);}this.tooltipTimeout=window.setTimeout(this.hideTooltip,1500);},onValid:AB};},getFixedCardHeightInputCtrl:function v(){var AE=this.getHost(),AG=1,AC=/[0-9]+/,AF=AE.getFormatPropertyValue(S.FIX_CARD_HEIGHT);var AD=this.getNumericInputCommonProperty(function(){AE.writeProperties(S.CARD_HEIGHT,this.value);});var AB=new mstrmojo.ui.editors.controls.ValidationTextBox(P.copy(AD,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:AG,regExp:AC,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},value:AE.getFormatPropertyValue(S.CARD_HEIGHT),getInvalidMsg:function(AH){if(AH.code===f.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min-1);}return mstrmojo.desc(11935,"Invalid characters");}}));return this.getLabelAndControl("px",AB,"90%","10%",true,{enabled:AF});},getGridColumnCountInputCtrl:function c(){var AE=this.getHost(),AF=1,AB=/[0-9]+/;var AD=this.getNumericInputCommonProperty(function(){AE.writeProperties(S.GRID_COLUMN_COUNT,this.value);});var AC=new mstrmojo.ui.editors.controls.ValidationTextBox(P.copy(AD,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:AF,regExp:AB,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},value:AE.getFormatPropertyValue(S.GRID_COLUMN_COUNT),getInvalidMsg:function(AG){if(AG.code===f.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min-1);}return mstrmojo.desc(11935,"Invalid characters");}}));return this.getLabelAndControl(mstrmojo.desc(6052,"Column"),AC,"50%","50%",undefined,{enabled:true});},getAutoPlayCheckbox:function H(){var AF=this,AE=this.getHost(),AD=AE.getFormatPropertyValue(S.AUTO_PLAY),AC=new mstrmojo.ui.Checkbox({checked:AD,oncheckedChange:function AH(AI){AF.onPropertiesChanged(S.AUTO_PLAY,AI.value);}}),AG=this.getLabelAndControl(mstrmojo.desc(15869,"Auto Play"),AC,"14px","100%",true),AB=AG.getLabel();AB.onclick=function(){AC.onclick();};return AG;},getStyleSelectedIndex:function W(){var AD=this.getHost(),AC=AD.getFormatPropertyValue(S.KPI_STYLE),AB=0;switch(AC){case X.LIGHT:AB=0;break;case X.NIGHT:AB=1;break;case X.DESERT:AB=2;break;case X.OCEAN:AB=3;break;default:break;}return AB;},getTextSizeController:function M(AC){var AE=this,AF,AB=F(AE,"reset"),AG=F(AE,"minus"),AD=F(AE,"plus");if(!AC){AB.cssClass+=" inactive";}AB.slot="col1Node";AG.slot="col2Node";AD.slot="col3Node";AF=new mstrmojo.ui.editors.controls.ThreeColumnContainer({col1Width:"33%",col2Width:"33%",col3Width:"33%",divider1Width:"18px",divider2Width:"18px",children:[AB,AG,AD],cssText:"padding-bottom: 6px"});return AF;},getFontControlGroup:function(){var AG=this;var AK=this.getHost();var AL=mstrmojo.kpicard.CAN_SET_FONT_PARTS;var AC="__all__";var AB=-1;var AF=function(AN){var AP=function(AQ,AT){var AS=AQ[0][AT];var AR=AQ.every(function(AU){return AU[AT]===AS;});return{equal:AR,value:AS};};var AM=function(AS){var AR=P.valarray(AS);var AT=P.keyarray(AR[0]);var AQ={};return AT.reduce(function(AV,AX){var AU=AP(AR,AX);if(AU.equal){AV[AX]=AU.value;return AV;}var AW;switch(AX){case l.ENUM_PROPERTY_NAMES.FONT_FAMILY:AW=AB;break;case l.ENUM_PROPERTY_NAMES.FONT_SIZE:AW=AB;break;case l.ENUM_PROPERTY_NAMES.COLOR:AW="";break;default:AW=false;}AV[AX]=AW;return AV;},AQ);};var AO=AK.getFormatPropertyValue(S.NEW_FONT);if(AN===AC){return AM(AO);}return AO[AN];};var AI=function(AO,AP,AQ){var AM=function(AU,AS,AR){var AT=AR;if(AS===S.UNIFY_STEPS){var AV=AK.getFormatPropertyValue(S.NEW_FONT);AT=AR===0?"0":(Number(AV[AU][AS])+AR).toString();}return{part:AU,propName:AS,propValue:AT};};var AN;if(AO===AC){AN=P.valarray(AL).map(function(AR){return AM(AR,AP,AQ);});}else{AN=[AM(AO,AP,AQ)];}return AG.onPropertiesChanged(S.NEW_FONT,AN);};var AH=function(){var AO=[{n:mstrmojo.desc(16296,"Unified"),id:j.UNIFIED},{n:mstrmojo.desc(12058,"Fit to container"),id:j.FIT_TO_CONTAINER},{n:mstrmojo.desc(4961,"Fixed"),id:j.FIXED},];if(AK.getFormatPropertyValue(S.DISPLAY_MODE)===a.STACKED){AO=d.filter(AO,function(AP){return AP.id!==j.UNIFIED;});}var AN=AK.getFormatPropertyValue(S.TEXT_SIZE_TYPE);var AM=d.find(AO,"id",AN);return AG.fnGetPulldown(AO,AM,mstrmojo.desc(16258,"Text Size"),S.TEXT_SIZE_TYPE,{labelWidth:"30%",pulldownWidth:"70%"});};var AE=function(){var AN=[{n:mstrmojo.desc(2461,"All"),id:AC},{n:mstrmojo.desc(8263,"Label"),id:AL.LABEL},{n:mstrmojo.desc(16260,"Primary Value"),id:AL.PRIMARY_VALUE},{n:mstrmojo.desc(16261,"Previous Value"),id:AL.PREVIOUS_VALUE},{n:mstrmojo.desc(16262,"Trend Identity"),id:AL.TREND_IDENTITY},];var AO=function(AP,AR){var AQ=0;d.forEach(AP,function(AT,AS){if(AT.id===AR){AQ=AS;return false;}});return AQ;};var AM=function(AP){AG.selectedFontPart=AP.id;AG.getHost().zonesModel.getUpdateCallback().success();};return L.newPulldown(AN,AM,AO(AN,AG.selectedFontPart),{isHostedWithin:false});};var AD=function(){var AM=function(AV,AW){AI(AG.selectedFontPart,AV,AW);};var AU=function(AW,AV){var AX=AV[Z.FONT_SIZE];if(AX&&AX!==AB){AV[Z.FONT_SIZE]=Math.round(parseInt(AX)/4*3)+"pt";}return AG.getCharacterGroup(function(AY,AZ){if(AY===Z.FONT_SIZE){AZ=parseInt(AZ)/3*4+"px";}AW(AY,AZ);},AV);};var AS=AF(AG.selectedFontPart);var AT=AU(AM,AS);var AP=AK.getFormatPropertyValue(S.TEXT_SIZE_TYPE);var AN=AS[S.UNIFY_STEPS];var AQ=AN===false||AN!=="0";var AR=AG.getTextSizeController(AQ);var AO=AP===j.FIXED;AT.fontSize.set("enabled",AO);AR.set("visible",!AO);return[AT,AR];};this.selectedFontPart=this.selectedFontPart||AC;this.setFontPropertyValue=AI;var AJ=[AG.getGroupTitle(mstrmojo.desc(16259,"Font")),AH(),AE(),].concat(AD());return this.getEditorGroup(AJ,{showDivider:true,isNested:true,isContainer:true,});},getKPIStyleControls:function V(){var AD="custom";var AC=[];var AE=this.getHost();var AG=AE.getFormatPropertyValue(S.KPI_STYLE);var AB=[{n:mstrmojo.desc(8959,"Light"),id:X.LIGHT},{n:mstrmojo.desc(15866,"Night"),id:X.NIGHT},{n:mstrmojo.desc(9237,"Desert"),id:X.DESERT},{n:mstrmojo.desc(15867,"Ocean"),id:X.OCEAN},{n:mstrmojo.desc(14417,"Customize"),id:AD},];AC.push(this.fnGetPulldown(AB,d.find(AB,"id",AG)||0,mstrmojo.desc(1400,"Style"),S.KPI_STYLE));if(AG===AD){var AF=function(AJ,AK){var AI=function(AM){var AL=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName;if(AM===AL.FILL_COLOR){return AJ;}if(AM===AL.FILL_TRANSPARENT){return AK;}return AJ;};return function(AL,AM){AE.writeProperties(S.CUSTOM_KPI_STYLE,AE.generateUpdatedCustomStyleConfigs(AD,AI(AL),AM));};};var AH=AE.getSpecificKPIStyle(AG)||{};AC.push(this.getColorFormatsControl(mstrmojo.desc(16291,"Area Fill Color"),AH.bgColor,AH.bgOpacity,AF("bgColor","bgOpacity")));AC.push(this.getColorFormatsControl(mstrmojo.desc(16290,"Trend Fill Color"),AH.chartColor,AH.chartOpacity,AF("chartColor","chartOpacity")));}return this.getEditorGroup(AC,{showDivider:false,isNested:true,isContainer:true});},getColorFormatsControl:function A(AG,AD,AE,AF){var AJ=false;var AB=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName.FILL_COLOR;var AI=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName.FILL_TRANSPARENT;var AH=new mstrmojo.Label({text:AG});var AC=new mstrmojo.ui.editors.controls.FillConfigGroup({showNoFill:false,onGroupValueChange:function(AK,AL){if(!AJ){return ;}if(AK===AI){AL=AL/100;}AF(AK,AL);},});AC.iniChildrenComp([AB,AI]);AC.setChildrenValue([[AB,AD],[AI,AE*100],]);AJ=true;return this.getEditorGroup([AH,AC],{showDivider:false,isNested:true,isContainer:true});},getStyleControls:function U(){var AD=this.getHost(),AC=[],AE=AD.getFormatPropertyValue(S.PREVIOUS_METRIC_NAME),AB;AC.push(this.getKPIStyleControls());AC.push(this.getFontControlGroup());if(AD.getUnitsByDropZoneID("trend").length>0){AC.push(new mstrmojo.Label({text:mstrmojo.desc(15872,"Previous Value Label")}));AB=new mstrmojo.ui.editors.controls.ValidationTextBox({required:false,dtp:g.VARCHAR,validationDelay:1500,value:AE,autoComplete:false,onValid:function(){AD.writeProperties(S.PREVIOUS_METRIC_NAME,this.value);},onRender:function(){var AF=document.createElement("input");AF.type="text";AF.style.cssText="display: none !important;";if(this.domNode.parentNode){this.domNode.parentNode.appendChild(AF);}}});AC.push(AB);}return this.getEditorGroup(AC,{showDivider:false,isNested:true,isContainer:true});},getBadgeModeSelectedIndex:function n(){var AD=this.getHost(),AC=AD.getFormatPropertyValue(S.BADGE_MODE),AB=1;switch(AC){case Y.NONE:AB=0;break;case Y.PERCENTAGE:AB=1;break;case Y.VALUE:AB=2;break;default:break;}return AB;},getBadgeControlGroup:function q(){var AG=[],AF=this,AH=this.getHost(),AD=AH.getFormatPropertyValue(S.BADGE_MODE),AB=AH.getFormatPropertyValue(S.INCREASE_BG_COLOR),AI=AH.getFormatPropertyValue(S.DECREASE_BG_COLOR),AJ=AD!==Y.NONE,AE,AC;AG.push(this.getGroupTitle(mstrmojo.desc(15870,"Trend Indicator")));AG.push(this.fnGetPulldown(t,this.getBadgeModeSelectedIndex(),undefined,S.BADGE_MODE));Q.addCustomColor(I);Q.addCustomColor(x);AE=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,showAutomatic:true,autoPreviewColor:I,selectedValue:AB===I?r:AB,postselectedValueChange:function(AK){var AL=AK.value;AF.onPropertiesChanged(S.INCREASE_BG_COLOR,AL===r?I:AL);}});AC=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,showAutomatic:true,autoPreviewColor:x,selectedValue:AI===x?r:AI,postselectedValueChange:function(AK){var AL=AK.value;AF.onPropertiesChanged(S.DECREASE_BG_COLOR,AL===r?x:AL);}});AG.push(this.getLabelAndControl(mstrmojo.desc(8314,"Increase"),AE,"50%","50%",undefined,{enabled:AJ}));AG.push(this.getLabelAndControl(mstrmojo.desc(8315,"Decrease"),AC,"50%","50%",undefined,{enabled:AJ}));return this.getEditorGroup(AG,{showDivider:true,isNested:true,isContainer:true});},getThresholdControlGroup:function D(){var AB=[],AD=this,AC;AB.push(this.getGroupTitle(mstrmojo.desc(3647,"Thresholds")));this.initThresholdControls(AB);AC=new mstrmojo.Button.newWebButton(mstrmojo.desc(531,"Add"),b.bind(AD),false,{});AB.push(AC);return this.getEditorGroup(AB,{showDivider:true,isNested:true,isContainer:true});},initThresholdControls:function h(AD){var AH=this.getHost(),AC=AH.readColorThresholdsProp(),AF=AC&&AC.thresholds,AI,AB,AG,AE;if(!AF||!d.isArray(AF)){return ;}AI=AF.length;for(AE=0;AE<AI;AE+=1){AB=AF[AE];AG=this.initSingleThresholdControlItem(AE,AB.enabled,AB.min,AB.max,AB.color);AD.push(AG);}},initSingleThresholdControlItem:function AA(AP,AK,AH,AN,AF){var AQ=[],AO,AJ,AB,AI,AL,AD,AR,AM=this,AE,AC=/^$|(^(-|\d*)\d+(\.\d+)?)$/;AJ=new mstrmojo.ui.Checkbox({checked:AK,colorThresholdIdx:AP,oncheckedChange:function AG(AS){var AT=AS.value,AU=AM.getHost();AU.setColorThresholdProperty(this.colorThresholdIdx,"enabled",AT);}});AO=this.getGroupTitle(mstrmojo.desc(15873,"Threshold ##").replace("##",(AP+1)));AB=mstrmojo.Button.newIconButton(undefined,"kpi-cth-delete-button",function(){var AS=AM.getHost();this.hideTooltip();AS.removeColorThreshold(this.colorThresholdIdx);},undefined,{colorThresholdIdx:AP,useRichTooltip:true,updateTooltipConfig:function(){this.richTooltip={cssClass:"vi-regular vi-tooltip-C",content:mstrmojo.desc(15874,"Delete the threshold"),refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:25,top:-7};}});AJ.slot="col1Node";AO.slot="col2Node";AB.slot="col3Node";AI=new mstrmojo.kpicard.editors.KPICardThresholdHeaderControl({col1Width:"15px",col2Width:"auto",col3Width:"18px",children:[AJ,AO,AB]});AE={cssClass:"kpi-cth-TextBox",errRevert:false,dtp:g.FLOAT,validationDelay:1500,colorThresholdIdx:AP,updateText:function(AS){this.inputNode.value=AS;this.value=AS;},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C triangle-warning",left:this.domNode.offsetWidth+10,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};if(this.tooltipTimeout){window.clearTimeout(this.tooltipTimeout);}this.tooltipTimeout=window.setTimeout(this.hideTooltip,1500);},onValid:function(){var AS=this.value,AU=AS&&parseFloat(AS),AT=AM.getHost();if(isNaN(AU)||(!AU&&AU!==0)||AU===""){AU=undefined;}AT.setColorThresholdProperty(this.colorThresholdIdx,this.cthPropName,AU);},onfocus:function(){this.orignText=this.value;var AS=this.inputNode;if(AS){this.inputNode.setAttribute("placeholder","");}},onblur:function(){if(this.value!==this.orignText){this.validate();}var AS=this.inputNode;if(AS){this.inputNode.setAttribute("placeholder",this.hint);}}};AL=new mstrmojo.ui.editors.controls.ValidationTextBox(P.copy(AE,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,max:!isNaN(AN)?parseFloat(AN):undefined,regExp:AC,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},hint:"\ue80d",value:AH?AH.toString():AH,cthPropName:"min",getInvalidMsg:function(AS){if(AS.code===f.INVALID_OUTOFRANGE){return mstrmojo.desc(15875,"Value should be less than ##").replace("##",this.constraints.max);}return mstrmojo.desc(11935,"Invalid characters");}}));AD=new mstrmojo.ui.editors.controls.ValidationTextBox(P.copy(AE,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:!isNaN(AH)?parseFloat(AH):undefined,regExp:AC,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},hint:"\ue80e",value:AN?AN.toString():AN,cthPropName:"max",getInvalidMsg:function(AS){if(AS.code===f.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min);}return mstrmojo.desc(11935,"Invalid characters");}}));AR=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,selectedValue:AF,colorThresholdIdx:AP,postselectedValueChange:function(AS){var AU=AS.value,AT=AM.getHost();AT.setColorThresholdProperty(this.colorThresholdIdx,"color",AU);}});AQ.push(AI);AQ.push(this.getLabelAndControl(mstrmojo.desc(9305,"From"),AL,"33%","67%",undefined,{enabled:AK}));AQ.push(this.getLabelAndControl(mstrmojo.desc(15877,"To"),AD,"33%","67%",undefined,{enabled:AK}));AQ.push(this.getLabelAndControl(mstrmojo.desc(6242,"Color"),AR,"50%","50%",undefined,{enabled:AK}));return this.getEditorGroup(AQ,{showDivider:false,isNested:true,isContainer:true});}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.ui.editors.controls.XtabResizeGroup","mstrmojo.ui.editors.CharacterToolbarPopup","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.Label","mstrmojo.hash","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.color","mstrmojo.models.FormatModel","mstrmojo.models.template.DataInterface");mstrmojo.requiresDescs(15191,15192,15193,15230,15231,15232,15792);var A=2,H=3,J=4,t=5,D=5000;var AE=mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS,j=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,r=mstrmojo.models.FormatModel.getFormatUpdate,P=mstrmojo.hash,Z=mstrmojo.array,z=mstrmojo.VisUtility;var c={};c[A]="ch";c[H]="rh";c[J]="va";var B="st";var d={};d[H]="SUBTOTAL_FORMAT_USE_ROWHEADERS";d[A]="SUBTOTAL_FORMAT_USE_COLUMNHEADERS";d[J]="SUBTOTAL_FORMAT_USE_VALUES";var I={left:2,center:3,right:4,justify:6};function a(AF){return Object.keys(AF).length===0;}function b(){var AF=this.getHost().gridData,AG=AF&&AF.gsi;return(AG&&AG.fmts)||{};}function S(){var AH=this.getHost(),AF=AH.gridInfo&&AH.gridInfo.prop&&AH.gridInfo.prop.sb,AG=function(AI){AH.showBanding(AI);};return this.getCheckboxAndLabel(!!AF,mstrmojo.desc(15758,"Enable Banding"),AG);}var AA=function AA(){var AF=this.getHost();AF.showOutlineModeOption(true);};function x(){var AK=this.getHost(),AH=AK.gridData,AJ=this,AF=AH.olm&&!(AH.rw&&AH.rw.row.bc>0),AI=function AI(AL){var AM=parseInt(AK.rhsCP&&AK.rhsCP.rc||0,10);if(AL&&AM&&AM>mstrmojo.vi.models.editors.XtabEditorModel.ENUM_MAX_ROWS_OUTLINE){var AO=function AO(AP){AP.checked=false;};var AN=this;mstrmojo.confirm(mstrmojo.desc(15792,"The dossier will attempt to display more than 5000 rows in outline mode. This may affect performance and stability. Do you want to continue?"),null,{id:"OutlineModeWarningDialog",title:mstrmojo.desc(15759,"Enable Outline"),allowHTML:false,buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(212,"Continue"),AA.bind(AJ)),mstrmojo.Button.newWebButton(mstrmojo.desc(3416,"Cancel"),AO(AN))],onPreClose:function(){AO();return true;}});}else{AK.showOutlineModeOption(AL);}},AG=this.getCheckboxAndLabel(!!AF,mstrmojo.desc(15759,"Enable Outline"),AI);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||AK.model.hasRecursiveAttribute(AH)){AG.set("enabled",false);}return AG;}function AD(AF,AG){return this.getButtonBar([{n:mstrmojo.desc(7575,"Top"),v:1,css:"top"},{n:mstrmojo.desc(8631,"Middle"),v:2,css:"middle"},{n:mstrmojo.desc(7576,"Bottom"),v:3,css:"bottom"}],AF[j.VERTICAL_ALIGN]-1,function(AH,AI){AG(AH.v,AI&&AI.v);},{cssClass:"cellAlign"});}function q(AF,AG){return this.getTextAlign(P.keyarray(I).filter(function(AH){return AF[j.TEXT_ALIGN]===I[AH];})[0],AG,I);}function W(AI,AF){var AG=b.call(this),AJ=c[AI];if(!AF){return AG[AJ];}var AH=AG[B]||{};return AH[AJ]||AG[AJ];}function k(AH,AF){var AI=this.getHost(),AG=AI.getSubtotalFormatUseGridFormat(AH);return function(AJ,AK){if(!AF||(AF&&!AG)){AI.formatGridZone(c[AH],r(AJ,AK),{isSubtotalFormat:AF,isSubtotalUseGridFormatting:AG});}else{AI.UpdatePropAndformatGridZone(AH,r(AJ,AK),{isSubtotalFormat:AF,isSubtotalUseGridFormatting:AG});}};}function U(AI,AG){var AF=W.call(this,AI,AG),AJ=k.call(this,AI,AG),AH=function(AK){return function(AL){AJ(AK,AL);};};return[this.getCharacterGroup(AJ,AF),q.call(this,AF,AH(j.TEXT_ALIGN)),AD.call(this,AF,AH(j.VERTICAL_ALIGN)),this.getContainerGroup(AF,AJ,AE.FILL_COLOR,{showBackgroundNoFill:AI===J}),this.getContainerGroup(AF,AJ,AE.BORDER,{borderTitle:mstrmojo.desc(12130,"Horizontal lines"),targetBorder:"bottom"}),this.getContainerGroup(AF,AJ,AE.BORDER,{borderTitle:mstrmojo.desc(12131,"Vertical lines"),targetBorder:"right"}),this.getWrapText(!!AF[j.TEXT_WRAP],AH(j.TEXT_WRAP))];}function E(AG){var AK={};AK[A]=mstrmojo.desc(15232,"Same as Column Headers");AK[H]=mstrmojo.desc(15231,"Same as Row Headers");AK[J]=mstrmojo.desc(15230,"Same as Values");var AL=this.getHost(),AI=AL.getSubtotalFormatUseGridFormat(AG),AJ=AL.hasSubtotal(AG),AH=function(AM){AL.applyGridCellFormatForSubtotalChange(AM,AG);},AF=[];AF.push(this.getCheckboxAndLabel(AI,AK[AG],AH));if(!AI&&AJ){return AF.concat(U.call(this,AG,true));}return AF;}function L(AH){var AK={};AK[A]=mstrmojo.desc(15191,"Subtotal Column Headers");AK[H]=mstrmojo.desc(15192,"Subtotal Row Headers");AK[J]=mstrmojo.desc(15193,"Subtotal Values");var AF=[this.getGroupTitle(AK[AH])].concat(E.call(this,AH)),AG=AF.slice(),AJ=this.getHost(),AI=AJ.hasSubtotal(AH);if(!AI){z.toggleControlEnabled(AG,false);}return AF;}function Q(AF,AG){this.replaceChildControls(AF,[this.getEditorGroup(U.call(this,AG)),this.getEditorGroup(L.call(this,AG))]);}var G="#fff";function AB(AG){var AJ=AG?AG.c1||AG:"",AI=mstrmojo.color.getLuminance(AJ),AF=255,AK=121.71921,AH=Math.max(AF/AI,AI/AF),AM=Math.max(AK/AI,AI/AK),AL="#35383a";if(AH>=AM){return G;}return AL;}var w={FMT_GROUP_GRID_COLOR:{type:[c[A],"st.ch"],props:[j.BACKGROUND_COLOR,j.BORDER_BOTTOM_COLOR,j.BORDER_BOTTOM_COLOR]},FMT_GROUP_GRID_STYLE:{type:[c[A],c[H],c[J],"st.ch","st.rh","st.va"],props:[j.BORDER_BOTTOM_STYLE,j.BORDER_RIGHT_STYLE]}};var O={GRAY:mstrmojo.desc(null,"Gray"),BLUE:mstrmojo.desc(null,"Blue"),NAVY:mstrmojo.desc(null,"Navy Blue"),EMERALD:mstrmojo.desc(null,"Emerald"),ORANGE:mstrmojo.desc(null,"Orange")},g={GRAY:"gray",BLUE:"blue",NAVY:"navy",EMERALD:"emerald",ORANGE:"orange"},X={FLAT:mstrmojo.desc(7805,"Flat"),CLASSIC:mstrmojo.desc(125,"Classic"),CUSTOM:"Custom"},C={FLAT:"flat",CLASSIC:"classic",CUSTOM:"custom"};var AC={},n=AB(G);AC[C.FLAT]=[{n:O.GRAY,css:g.GRAY,iconBc:"#d1d1d1",fc:n,bc:G,bbc:"#ababab",brc:"#ebebeb",stbc:"#f8f8f8"},{n:O.BLUE,css:g.BLUE,iconBc:"#1c8dd4",fc:n,bc:G,bbc:"#1c8dd4",brc:"#ebebeb",stbc:"#f1f9f2"},{n:O.NAVY,css:g.NAVY,iconBc:"#193b67",fc:n,bc:G,bbc:"#193b67",brc:"#ebebeb",stbc:"#f2f4f6"},{n:O.EMERALD,css:g.EMERALD,iconBc:"#38ae6f",fc:n,bc:G,bbc:"#38ae6f",brc:"#ebebeb",stbc:"#f4fbf6"},{n:O.ORANGE,css:g.ORANGE,iconBc:"#e69912",fc:n,bc:G,bbc:"#e69912",brc:"#ebebeb",stbc:"#fef8f1"}];AC[C.CLASSIC]=[{n:O.GRAY,css:g.GRAY,iconBc:"#d1d1d1",bc:"#f5f5f5",bbc:"#ebebeb",brc:"#ebebeb",fc:AB("#f5f5f5"),stbc:"#f8f8f8"},{n:O.BLUE,css:g.BLUE,iconBc:"#1c8dd4",bc:"#1c8dd4",bbc:"#187ab8",brc:"#187ab8",fc:AB("#1c8dd4"),stbc:"#f1f9fe"},{n:O.NAVY,css:g.NAVY,iconBc:"#193b67",bc:"#193b67",bbc:"#50698b",brc:"#50698b",fc:AB("#193b67"),stbc:"#f2f4f6"},{n:O.EMERALD,css:g.EMERALD,iconBc:"#38ae6f",bc:"#38ae6f",fc:AB("#38ae6f"),bbc:"#29965d",brc:"#29965d",stbc:"#f4fbf6"},{n:O.ORANGE,css:g.ORANGE,iconBc:"#e69912",bc:"#e69912",fc:AB("#e69912"),bbc:"#ca850a",brc:"#ca850a",stbc:"#fef8f1"}];var v={rh:{bc:"#fff",bbc:"#ebebeb",brc:"#ebebeb"},va:{bc:"#fff",bbc:"#ebebeb",brc:"#ebebeb"},st:{rh:{bc:"#f8f8f8",bbc:"#ebebeb",brc:"#ebebeb"},va:{bc:"#f8f8f8",bbc:"#ebebeb",brc:"#ebebeb"}}};var p={};function N(AF){if(!p[AF]){p[AF]=mstrmojo.color.encodeColor(AF);}return p[AF];}function R(AG,AF){return(AG.substring&&AG.substring(0,1)==="#")?N(AG)===N(AF):AG===AF;}function o(AG,AH){var AF=true;P.forEach(AG,function(AJ,AI){if(AH[AI]===undefined){AF=false;}else{if(typeof AH[AI]==="object"){if(a(AH[AI])){AF=true;}else{AF=o(AJ,AH[AI]);}}else{AF=R(AH[AI],AJ);}}if(!AF){return false;}});return AF;}function f(AH,AG){var AK=-1,AF=AK,AJ=w.FMT_GROUP_GRID_COLOR.type,AI=w.FMT_GROUP_GRID_COLOR.props;if(!o(v,AH)){return AF;}Z.forEach(AG,function(AM,AL){AF=AL;Z.forEach(AJ,function(AO){var AN=P.walk(AO,AH);Z.forEach(AI,function(AP){if(!R(AN[AP],AM[AP])){AF=AK;return false;}});if(AF===AK){return false;}});if(AF!==AK){return false;}});return AF;}var M=[],F={};F[C.FLAT]=0;F[C.CLASSIC]=1;F[C.CUSTOM]=-1;var V="1pt solid",h="none";M[F[C.FLAT]]={id:C.FLAT,n:X.FLAT,css:C.FLAT,brs:h,bbs:V};M[F[C.CLASSIC]]={id:C.CLASSIC,n:X.CLASSIC,css:C.CLASSIC,brs:V,bbs:V};function K(AF){var AG=w.FMT_GROUP_GRID_STYLE,AJ=AG.props,AH=AG.type,AI=null,AK=function(AL){if(AL===V){return 1;}else{if(AL===h){return 0;}}return -1;};Z.forEach(M,function(AL){AI=AL.id;Z.forEach(AH,function(AN){var AM=P.walk(AN,AF);if(a(AM)){return true;}Z.forEach(AJ,function(AO){if(AM[AO]!==AK(AL[AO])){AI=null;return false;}});if(!AI){return false;}});if(AI){return false;}});return AI||C.CUSTOM;}function e(AF,AG){var AH=[c[A],"st.ch"],AJ=j.BACKGROUND_COLOR,AI;return AH.every(function(AK){AI=P.walk(AK,AF)[AJ];return AI&&R(AI,AG);});}function Y(){var AN=this,AU=this.getHost(),AP=AU.gridData,AQ=AP&&AP.gsi&&AP.gsi.fmts,AI=e(AQ,G),AM=K(AQ),AJ=AM===C.CUSTOM?(AI?C.FLAT:C.CLASSIC):AM,AT=AC[AJ],AL=f(AQ,AT),AF=AL<0?AT[0].css:AT[AL].css,AS=AN.getLabelAndControl(mstrmojo.desc(6242,"Color"),new mstrmojo.ui.CheckList({items:AT,selectedIndex:AL,hideCheckMark:true,cssClass:"color",orientation:"h",multiSelect:false,itemMarkup:null,postselectionChange:function AK(AW){var AX=AW.added[0],AV=this.items[AX];AU.formatGridColor(v,AV);},getItemMarkup:function AR(AV){if(!this.itemMarkup){this.itemMarkup=mstrmojo.ui.List.prototype.getItemMarkup.apply(this,AV).replace('title="{@title}">{@en@n}<','title="{@en@n}"><div class="color" style="background-color: {@en@iconBc}"></div><');}return this.itemMarkup;},getItemProps:function AO(AX,AV){var AW=mstrmojo.ui.CheckList.prototype.getItemProps.call(this,AX,AV);AW.iconBc=AX.iconBc;return AW;}}),"30%","70%",false,{cssClass:"gt-color",showIcon:true,alias:"gtColor"}),AG=AN.getLabelAndControl(mstrmojo.desc(1400,"Style"),new mstrmojo.ui.CheckList({items:M,selectedIndex:F[AM],cssClass:"style",orientation:"v",multiSelect:false,postselectionChange:function AK(AW){var AY=AW.added[0],AV=this.items[AY],AX=(AL)>-1?AC[AV.id][AL]:null;AU.formatGridStyle(AV,AX,v);}}),"30%","70%",false,{cssClass:"gt-style",showIcon:true,alias:"gtStyle"}),AH=new mstrmojo.Box({alias:"gt",cssClass:"gt "+AF,children:[AS,AG]});return AH;}function m(AP){var AV=this.getHost(),AR=AV.gridData,AJ=new mstrmojo.models.template.DataInterface(AR);var AF=new mstrmojo.ui.editors.controls.XtabResizeGroup({});AF.setFormatSource(AV);AV.attachEventListener("xtabColsMeasured",AF.id,function(){AF.setFormatSource(AV);});var AN=AJ.getAggregatePadding(),AL=mstrApp.getThemeProps(mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.GRID),AK=AL.paddingSize,AS=0,AH=[AK,AK],AQ=AK,AO=false;if(AN){AH=[AN.h,AN.v].sort(function(AY,AX){return AY-AX;});AQ=AH[1];AS=Math.max(Math.min(Math.round((AQ-AK)/AK),2),0);AO=true;}var AT=this.getLabelAndControl(mstrmojo.desc(13579,"Padding"),this.getButtonBar([{n:mstrmojo.desc(12141,"S"),v:AK,css:"small"},{n:mstrmojo.desc(12142,"M"),v:AK*AL.mRatio,css:"medium"},{n:mstrmojo.desc(12140,"L"),v:AK*AL.lRatio,css:"large"}],AS,function(AX){AV.formatPadding(AX.v,AX.v*(AH[0]/AQ),{isSubtotalUseGridFormatting:true});},{cssClass:"cellPadding",showIcon:false}));AT.set("enabled",AO);var AU=this,AG=function(AX,AY){AV.batchFormatGridZones([A,H,J].map(function(AZ){return c[AZ];}),Z.isArray(AY)?AY.map(function(AZ){return r(AX,AZ);}):[A,H,J].map(function(){return r(AX,AY);}),{isSubtotalUseGridFormatting:true});},AI=function(){var AZ=null,AX=b.call(AU),AY=AX[B];[A,H,J].forEach(function(Aa){[AX,AY].forEach(function(Ai){var Ah=Ai&&Ai[c[Aa]]||{},Aj=j.FONT_SIZE,Ab=j.FONT_FAMILY,Af=j.COLOR,Ac=j.FONT_WEIGHT,Ae=j.UNDERLINE,Ad=j.FONT_STYLE,Ag=j.LINE_THROUGH;if(a(Ah)){return ;}if(!AZ){AZ=P.copy(Ah);AZ[Aj]=Z.ensureArray(AZ[Aj]);}else{AZ[Aj].push(Ah[Aj]);if(AZ[Ab]!==Ah[Ab]){AZ[Ab]=-1;}if(AZ[Af]!==Ah[Af]){delete AZ[Af];}[Ac,Ae,Ad,Ag].forEach(function(Ak){AZ[Ak]=AZ[Ak]||Ah[Ak];});}});});return AZ;},AW=[],AM=[this.getEditorGroup([]),this.getEditorGroup([S.call(this),x.call(this)]),AL.gridTemplateVisible?this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(16044,"Grid Template")),Y.call(this)]):null,this.getEditorGroup([this.getGroupTitle(mstrmojo.desc(14006,"All Grid Fonts")),this.getCharacterGroup(AG,AI(),23),this.getGroupTitle(mstrmojo.desc(12129,"Grid Size")),AT,AF]),this.getEditorGroup([this.getMoreOptionsEditorLink(AR&&AR.gsi&&AR.gsi.prop,true,AR&&AR.lhv)])];AW=AW.concat(AM);this.replaceChildControls(AP,AW);}mstrmojo.vi.models.editors.XtabEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.XtabEditorModel",help:"format_panel_grid.htm",getInitialTarget:function s(){return t;},getTargetPulldownItems:function l(AH){var AL=this.getHost(),AJ=AL.gridInfo,AK=this._super(AH);if(AJ&&(AJ.rows.length||AJ.cols.length)){var AF=AL.getFormats(),AG=Q.bind(this,AH);AK.unshift({n:mstrmojo.desc(6560,"General Settings"),v:t,h:m.bind(this,AH)});if(AF){var AI=b.call(this);if(AI){if(AI.ch){AK.push({n:mstrmojo.desc(12132,"Column Headers"),v:A,h:AG});}if(AI.rh){AK.push({n:mstrmojo.desc(12133,"Row Headers"),v:H,h:AG});}if(AI.va){AK.push({n:mstrmojo.desc(12134,"Values"),v:J,h:AG});}}}}return AK;},getFormattingToolbar:function u(AF,AI,AJ){var AO=this.getHost(),AG=AO.model,AN=AO.getCellForNode(AI),AM=(AF===J&&AG.isSubtotalValue(AN)),AH=(AN&&AN.stt===1)||AM,AK=W.call(this,AF,AH);if(AK){var AL=new mstrmojo.ui.editors.CharacterToolbarPopup(P.copy({onGroupValueChange:k.call(this,AF,AH),textAlignValueMap:I,anchorElement:AI},AJ));AL.setFormatSource(AK);return AL;}return this._super(AF,AI,AJ);}});mstrmojo.vi.models.editors.XtabEditorModel.ENUM_EDITOR_TARGETS={GENERAL:t,COLUMNS:A,ROWS:H,VALUES:J};mstrmojo.vi.models.editors.XtabEditorModel.ENUM_TARGET_FORMAT=c;mstrmojo.vi.models.editors.XtabEditorModel.ENUM_TARGET_SUBTOTAL_FORMAT_PROPNAME=d;mstrmojo.vi.models.editors.XtabEditorModel.ENUM_MAX_ROWS_OUTLINE=D;}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.css","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.models.editors.XtabEditorModel","mstrmojo.elementHelper");var Y=mstrmojo.css,R=mstrmojo.hash,I=mstrmojo.dom,N=mstrmojo.array,A=mstrmojo.chart.model.enums.EnumDSSObjectType,X=mstrmojo.elementHelper,Z=mstrmojo.vi.models.editors.XtabEditorModel.ENUM_EDITOR_TARGETS,b={cssClass:"grpHlt",top:"grpT",bottom:"grpB",left:"grpL",right:"grpR",midHoriz:"grpMidH",midVert:"grpMidV"},H=function(h,g){var e=this.zone;g=g||(e&&e.tableNode);if(g){var f=[],j=g.tBodies,k=function(n,m){var p=n.length,l=-1,o;while(p-l>1){if(n[o=p+l>>1].getAttribute("ei")<m){l=o;}else{p=o;}}return(n[p]&&parseInt(n[p].getAttribute("ei"),10)===m)?n[p]:null;};N.forEach(h,function(m){var p=m._ei,n;for(n=0;n<j.length;n++){var l=j[n],o=k(l.getElementsByClassName(m.css),p);if(o){f.push(o);}}});return f;}return[];},E=function(e){var g=this.model.getCellDataUnion(e),f={};N.forEach(g,function(h){f[h.tid]=[{id:h.eid,n:h.v}];});return f;},d=function(k){var j=k[R.keyarray(k)[0]],e=R.keyarray(j),g,h=this,f=this.model,l={};return H.call(this,N.filter(this.interactiveCellsArray,function(n){if(n.hasOwnProperty("mix")){var o=E.call(h,n);g=N.filter(e,function(p){var q=f.getLinkedAttributes(p),r=false;if(!!o[p]){l[p]=p;r=true;}else{N.forEach(q,function(s){if(!!o[s]){l[p]=s;r=true;return false;}});}return r;});var m=false;R.forEach(k,function(p){N.forEach(g,function(q){if(!f.compareElementsId(o[l[q]][0].id,p[q][0].id)){m=false;return false;}m=true;});if(m){return false;}});return m;}return false;}));},C=function(k,o){var p=(function(){var j=[];R.forEach(k,function(r){R.forEach(r,function(s,t){N.forEach(s,function(u){j.push([t,u.id]);});});});return j;}()),n,l=this,e=N.filter(this.interactiveCellsArray,function(r){n=false;var s=!r.hasOwnProperty("mix")&&r._e&&r.fi===undefined,j=!s&&E.call(l,r);if(s){N.forEach(p,function(t){if((!o||l.model.getCellTitleInfo(r).title.id===t[0])){n=l.model.compareElementsId(r._e.id,t[1]);}if(n){return false;}});}else{if(!o&&j){R.forEach(j,function(t){N.forEach(p,function(u){N.forEach((t||[]),function(v){if(v.id){n=l.model.compareElementsId(v.id,u[1]);}});if(n){return false;}});if(n){return false;}});}}return n;}),m=H.call(this,e),q=[],h,g,f;if(o){q=m;}else{N.forEach(m,function(j){h=e[N.find(e,"_ei",j.getAttribute("ei"))];if(h.axis===1){var t=0,s=j.rowSpan||1,r=j.parentNode;do{f=r.childNodes;for(g=0;g<f.length;g++){q.push(f[g]);}}while((++t<s)&&(r=r.nextSibling));}else{q.push(j);}});}return q;},M=function(j,f){if(!this.getFormatTargetFromCell){return[];}var h=this.getSubtotalFormatUseGridFormat(j),g=this.model;var k=this.id,e;return H.call(this,N.filter(this.interactiveCellsArray,function(l){e=mstrmojo.all[k].getFormatTargetFromCell(l)===j;if(f){return(e&&(l.stt===1||g.isSubtotalValue(l)));}if(!h){return(e&&!(l.stt===1||g.isSubtotalValue(l)));}return e;}));},L=function(g){var j=[],k;var h=this.getSubtotalFormatUseGridFormat(Z.COLUMNS);if(this.getFormatTargetFromCell){N.forEach(this.interactiveCellsArray,function(l){if(this.getFormatTargetFromCell(l)!==Z.COLUMNS){return false;}if((g&&l.stt===1)||(!g&&(h||(!h&&l.stt!==1)))){j.push(l);}return true;},this);}var f=this.xtabClonedNodes;if(f){var e=N.filterOne(f,function(l){return l.lockType===2;});if(e){k=e.domNode.getElementsByTagName("table")[0];}}return H.call(this,j,k);},J=function(e,f,h){var g=["xtabSel"].concat(I.isIE||I.isIEW3C?"ie":[],"sc_"+this.k);if(!f||h){g.push("range");}if(!f){g=g.concat(R.valarray(b));}Y.toggleClass(e,g,f);},S=function(e,f){var g=["XtabContextMenuSel"].concat(I.isIE||I.isIEW3C?"ie":[],"sc_"+this.k);Y.toggleClass(e,g,f);},P=function(f){var e=this;return H.call(this,N.filter(this.interactiveCellsArray,function(g){var h=e.model.getCellInfo(g);if(h.isHeader||h.isTitle){return false;}if(g.hasOwnProperty("mix")){if(f.target.id===g._tp._e.oid){var k=true;var j=e.model.getCellDataUnion(g);return !N.some(j,function(l){return f.parentElementIds.indexOf(l.eid)<0;});}}return false;}));},K=function(f){var e=this;return H.call(e,N.filter(e.interactiveCellsArray,function(g){var j=!g.hasOwnProperty("mix")&&g._e&&g.fi===undefined;if(j){if(f.target.id===g._e.id){var h=g;while(h.hasOwnProperty("_p")){if(f.parentElementIds.indexOf(h._p._e.id)<0){return false;}else{h=h._p;}}return true;}}return false;}));};mstrmojo.vi.ui.rw._XtabHighlights=mstrmojo.provide("mstrmojo.vi.ui.rw._XtabHighlights",{_mixinName:"mstrmojo.vi.ui.rw._XtabHighlights",highlights:null,contextMenuHighLights:null,highlight:function G(g,j,e){if(this._super){this._super.apply(this,arguments);}var h=mstrmojo.vi.ui.rw.SelectionType,f=[];this.clearHighlights();switch(g){case h.METRICS:f=d.call(this,j);break;case h.ATTS:f=C.call(this,j,e);break;}this.highlightCells(f,e);},highlightAttrOrMetricCell:function a(h){var g=this,e=[],f=mstrmojo.vi.ui.rw.SelectionType;this.clearHighlights();N.forEach(h,function(j){if(j.target.selectionType===f.ATTS){e=e.concat(K.call(g,j));}else{e=e.concat(P.call(g,j));}});this.highlightCells(e,false);},highlightRange:function c(g,k,e){var h=mstrmojo.vi.ui.rw.SelectionType,j=k?this.highlights.slice():null,f=[];this.clearHighlights();switch(g){case h.COL_HEADERS:f=L.call(this,e);break;case h.ROW_HEADERS:f=M.call(this,Z.ROWS,e);break;case h.METRIC_VALUES:f=M.call(this,Z.VALUES,e);break;}N.forEach(f,function(n){var m=true;if(j){var l=N.indexOf(j,n);m=l===-1;if(!m){j.splice(l,1);}}J.call(this,n,true,m);},this);this.highlights=f;},clearSelections:function D(){if(this._super){this._super();}this.clearHighlights();},clearCxtMnuSelection:function F(){if(this._super){this._super();}this.clearContextMenuHighlights();},clearHighlights:function B(){N.forEach(this.highlights,function(e){J.call(this,e,false);},this);this.highlights=[];try{var g=this.getCellForNode(this.lastSelectedCell),k=g&&this.gridData.gts[g.axis===1?"row":"col"],f=k&&k[g.tui||g.ui],h=f&&f.id;if(h){this.zone.clearHilites(h);}}catch(j){}},clearContextMenuHighlights:function W(){N.forEach(this.contextMenuHighLights,function(e){S.call(this,e,false);},this);this.contextMenuHighLights=[];},highlightCellsById:function Q(k,j,h){var g=this.model,e=function(l,m,n){return l[m]&&l[m]._e&&l[m]._e[n]===k;},f=H.call(this,N.filter(this.interactiveCellsArray,function(m){var l=false;if(j===A.DssTypeMetric){l=e(m,"_tp","oid")||e(m,"_lp","oid");}else{if(j===A.DssTypeAttribute){if(h){l=e(m,"_tp","id")||e(m,"_lp","id");}else{if(g&&g.getNormalizedFormElementId&&m._e&&m._e.id){l=X.getAttributeId(g.getNormalizedFormElementId(m._e.id))===k;}}}}return l;}));this.clearHighlights();this.highlightCells(f);},highlightCells:function(f,e){if(this._super){this._super(f,e);}N.forEach(f,function(g){J.call(this,g,true);},this);this.highlights=f;},highlightCellsWithContextMenuSelection:function(e){N.forEach(e,function(f){S.call(this,f,true);},this);this.contextMenuHighLights=e;},configureActions:function O(){if(this._super){this._super();}if(!!this.selectorControl&&!this.isCustomSort){this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}},highlightGroupCells:function V(f,e){var g=this.highlights;N.forEach(f,function(j){var n=j[0]&&j[0].axis||1,o=(n===1),k=this[o?"clonedRowHeader":"clonedColHeader"],m=(k?k.getTableNode():this.zone.tableNode),l=H.call(this,j,m),h=l.length;g=g.concat(l);N.forEach(l,function(s,p){var r=b,q=[r.cssClass];if(h>1){if(o){q.push(p>0?(p<h-1?r.midVert:r.bottom):r.top);}else{q.push(p>0?(p<h-1?r.midHoriz:r.right):r.left);}}Y.addClass(s,q);},this);},this);this.highlights=g;},clearGroupHighlights:function U(){var e=R.valarray(b);N.forEach(this.highlights,function(f){Y.toggleClass(f,e,false);},this);}});mstrmojo.vi.ui.rw._XtabHighlights.GROUP_BORDER_CSS=b;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.imagelayout.ImageLayoutEditorHelper","mstrmojo.locales");mstrmojo.requiresClsP("mstrmojo.ui.editors.controls","CharacterGroup","ContainerGroup","TwoColumnContainer","ColorPickerButton","LineStyleButton","FillConfigGroup");var K=mstrmojo.hash,X=mstrmojo.array,m=mstrmojo.func,p=mstrmojo.locales,F=mstrmojo.VisEnum.IMAGELAYOUT_PROPERTIES,k=mstrmojo.gm,Z=k.EnumIdentityType,a=mstrmojo.imagelayout.ImageLayoutEditorHelper,J=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS;var C="de",b="lgd",I="rcl",V="dl";var h="allTxt",A="dl",Q="lg",P=Q+"Bg",d="shape",M="shapeBorder",S="@",E="selBdrMtxLn4";function W(r,q,t,s){r.slot="col1Node";q.slot="col2Node";return this.addDisposable(new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:t||"40%",col2Width:s||"60%",children:[r,q]}));}function n(q,s,r,u){var t=this.addDisposable(a.getPulldown(s,u.fnChange||function(v){r.onTargetSelectionChanged(q,v);if(this._sync){return ;}},0,u));r.registerSelector(q,t);return t;}function e(){var r=this.broker.vis,q=r.zonesModel.getZoneModelByZoneId(mstrmojo.vi.viz.EnumDSSDropZones.ColorBy).items;return this.getLabelAndControl(mstrmojo.desc(6242,"Color"),this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13174,"Select color ranges..."),cssText:"text-decoration: underline;cursor: pointer;",onclick:function(){r.model.openThresholdEditor(q[0],true,false);}})),"30%","70%");}function j(){var x=this.getHost(),s=this.broker,v=this.getGroupTitle(mstrmojo.desc(13751,"Shape Formatting")),u,t,w,z=[v],q=s.getSmartNamesMapForColorFormat(d),r=s.getSmartNamesMapForLineGroup(M);if(x.getColorByIndex()>=0){u=e.call(this);t=this.addDisposable(this.getLabelAndControl(mstrmojo.desc(13658,"Fill Opacity"),a.getFillConfigComp(x,null,q,{visibleControls:J.FILL_TRANSPARENCY}),"60%","40%"));w=this.addDisposable(this.getLabelAndControl(mstrmojo.desc(3538,"Border Style"),a.getLineConfigComp(x,null,r,{hideColorControl:true,showNoFillInColor:false,showAutomaticInColor:true}),"60%","40%"));z=z.concat([u,t,w]);}else{t=a.getFillConfigComp(x,mstrmojo.desc(13601,"Fill:"),q,{controlName:"shapeFormattingFillGroup",showGradient:false});w=a.getLineConfigComp(x,null,r,{lineTitle:mstrmojo.desc(9736,"Border")});z=z.concat([t,w]);}return z;}function H(){var u=this.getHost(),q=u.propertyManager,w=q.CONSTANTS.DISPLAY_MODE,t=F.DISPLAY_MODE,s=this.getGroupTitle(mstrmojo.desc(4963,"Display Mode")),r=a.getPropertyPulldown(u,null,[{n:mstrmojo.desc(6019,"Automatic"),v:w.AUTOMATIC},{n:mstrmojo.desc(9738,"Area"),v:w.AREA},{n:mstrmojo.desc(348,"Bubble"),v:w.BUBBLE}],t,{listenFormatProps:["enableDisplayMode"],onFmtPropsChanged:function(x,z){if(x==="enableDisplayMode"){this.set("enabled",!!z);}else{this.onFmtPropsChangedDefault(x,z);}}}),v=[s,r];return v;}function l(){var u=this.getHost(),s=u.propertyManager,t=F.MAP_FILE_PATH,r=this.getGroupTitle(mstrmojo.desc(14446,"Shape File")),q=a.getPropertyPulldown(u,null,X.map(u._shapeFileList,function(x){var w=x.descWeb,z=w?mstrmojo.desc(parseInt(w.slice(w.indexOf(".")+1),10),x.name):x.name;return{n:z,v:x.shapeFile};}),t,{listenFormatProps:["isMultipleIL"],onFmtPropsChanged:function(w,x){if(w==="isMultipleIL"){this.set("enabled",!x);}else{this.onFmtPropsChangedDefault(w,x);}}}),v=[r,q];return v;}function G(v){var z=this.getHost(),t=z.propertyManager,x=t.CONSTANTS.DATA_LABEL,s=[{n:mstrmojo.desc(1013,"Text"),v:x.SHOW_TEXT},{n:mstrmojo.desc(2175,"Values"),v:x.SHOW_VALUE},{n:mstrmojo.desc(2057,"None"),v:x.NONE}],r=F.DATA_LABEL_SWITCH,u=this.broker,q=this.getGroupTitle(mstrmojo.desc(11993,"Data Labels")),w=a.getPropertyButtonBar(z,null,s,r,{multiSelect:true,cssClass:"dataLabel "+("itemsCnt"+s.length),onFmtPropsChangedDefault:function(AC,AD){this.syncControl(function(){if(AD===x.NONE){this.singleSelectByField(AD,"v");}else{this.select((this.items||[]).map(function(AF,AE){return(AD&AF.v)>0?AE:null;}).filter(function(AE){return AE!==null;}));}});},postselectionChange:function(AC){if(this._sync){return ;}var AF=AC.added&&this.items[AC.added[0]].v,AD=(AF===x.NONE),AE=AC.removed&&(this.items[AC.removed[0]].v===x.NONE),AG=!this.selectedIndices||(this.selectedIndices&&!this.selectedIndices[0]&&!this.selectedIndices[1]);if(AE){if(AG){if(!this.selectedIndices[2]){this.addSelect(2);}}return ;}if(AD){X.forEach([0,1],function(AH){if(this.selectedIndices[AH]){this.removeSelect(AH);}}.bind(this));}else{if(AG){if(!this.selectedIndices[2]){this.addSelect(2);}}else{if(this.selectedIndices[2]){this.removeSelect(2);}}AF=s.reduce(function(AJ,AI,AH){return this.selectedIndices[AH]?AJ|=AI.v:AJ;}.bind(this),0);}this.broker.setFormatPropertyValue(this.smartNames[0],AF);}}),AB=a.getCharacterConfigComp(z,null,u.getSmartNamesMapForFontGroup(A),{controlName:"DataLabelFontGroup",listenFormatProps:[r],onFmtPropsChanged:function(AC,AD){if(AC===r){this.set("enabled",AD!==x.NONE);}else{this.onFmtPropsChangedDefault(AC,AD);}}}),AA=[q,w,AB];return AA;}function Y(){var AH=this.getHost(),w=AH.propertyManager,AC=w.CONSTANTS.EnumMaxSizeType,AA=w.CONSTANTS.EnumMinSizeType,q=(AH.calculateSizeByIndex()>-1),x=p.number.DECIMALSEPARATOR,r={trigger:mstrmojo.validation.TRIGGER.ONBLUR,min:0.01,max:1,regExp:new RegExp("^\\d+("+x+"\\d{1,2})?$")},u=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13918,"Max size (0.01 - 1.0):")})),v=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13917,"Min size (0.01 - 1.0):")})),AG=this.addDisposable(new mstrmojo.Label()),t=mstrmojo.desc(13740,"The smallest element's size is ## of the largest element's size");var AE=w.CONSTANTS.DISPLAY_MODE,z=w.getFormatPropertyValue(F.DISPLAY_MODE)===AE.BUBBLE;var AD=F.MAX_SIZE_TYPE,AB=F.MIN_SIZE_TYPE,s=W.call(this,a.getPropertyPulldown(AH,null,[{n:mstrmojo.desc(6019,"Automatic"),v:AC.AUTO},{n:mstrmojo.desc(8262,"Manual"),v:AC.MANUAL}],AD,{listenFormatProps:["calcDisplayMode"],onFmtPropsChanged:function(AI,AJ){if(AI==="calcDisplayMode"){this.parent&&this.parent.set("enabled",AJ!==AE.AREA&&q);}else{this.onFmtPropsChangedDefault(AI,AJ);}}}),a.getPropertyValidationTextBox(AH,null,F.MAX_SIZE_VALUE,{constraints:r,listenFormatProps:[AD],onFmtPropsChanged:function(AI,AJ){if(AI===AD){this.set("enabled",AJ===AC.MANUAL);}else{this.onFmtPropsChangedDefault(AI,AJ);}}}),"75%","25%"),AF=W.call(this,a.getPropertyPulldown(AH,null,[{n:mstrmojo.desc(11990,"Proportional"),v:AA.PROPORTIONAL},{n:mstrmojo.desc(13741,"Full Range"),v:AA.AUTO},{n:mstrmojo.desc(14118,"Adjusted Range"),v:AA.MANUAL}],AB,{listenFormatProps:["calcDisplayMode"],onFmtPropsChanged:function(AI,AJ){if(AI==="calcDisplayMode"){this.parent&&this.parent.set("enabled",AJ!==AE.AREA&&q);}else{this.onFmtPropsChangedDefault(AI,AJ);if(AJ===AA.PROPORTIONAL){AG.set("text",mstrmojo.desc(13743,"The smallest element's size is proportional to its data element"));}else{if(AJ===AA.AUTO){AG.set("text",mstrmojo.desc(13744,"The smallest element's size is fixed, independent of its data value"));}}}}}),a.getPropertyValidationTextBox(AH,null,F.MIN_SIZE_VALUE,{constraints:r,listenFormatProps:[AB],onFmtPropsChanged:function(AI,AK){if(!q){this.set("enabled",false);return ;}if(AI===AB){var AJ=AK===AA.MANUAL;this.set("enabled",AJ);if(AJ){AG.set("text",t.replace("##",this.value*100+"%"));}}else{this.onFmtPropsChangedDefault(AI,AK);if(this.enabled){AG.set("text",t.replace("##",AK*100+"%"));}}}}),"75%","25%");this.addDisposable([s,AF]);return[u,s,v,AF,AG];}function o(){var u=this.getHost(),s=u.propertyManager,r=this.broker,t=E,q=t+S;var v=this.getGroupTitle(mstrmojo.desc(12050,"Matrix Lines"));return[v,n.call(this,t,[{n:mstrmojo.desc(11998,"All Matrix Lines"),prefix:"allMatrixLn",identity:(Z.H_MATRIX_LINE|Z.V_MATRIX_LINE),v:0},{n:mstrmojo.desc(11999,"Horizontal Matrix Lines"),prefix:"hMatrixLn",identity:Z.H_MATRIX_LINE,v:1},{n:mstrmojo.desc(12000,"Vertical Matrix Lines"),prefix:"vMatrixLn",identity:Z.V_MATRIX_LINE,v:2}],s,{highlightObjects:[(Z.H_MATRIX_LINE|Z.V_MATRIX_LINE),Z.H_MATRIX_LINE,Z.V_MATRIX_LINE],groupTitle:v}),a.getLineConfigComp(u,null,r.getSmartNamesMapForLineGroup(t+S),{listenSelector:[t],listenFormatProps:["allMatrixLnClr","allMatrixLnCmbStyle"],lineTitle:mstrmojo.desc(13927,"Line:"),controlName:"MatrixLineGroup",groupTitle:v,showNoFillInColor:false,showGradient:false})];}function L(r){var q=[this.getEditorGroup(H.call(this)),this.getEditorGroup(l.call(this)),this.getEditorGroup(Y.call(this))];this.replaceChildControls(r,q);}function B(r){var q=[this.getEditorGroup(o.call(this))];this.replaceChildControls(r,q);}function U(r){var q=[this.getEditorGroup(j.call(this)),this.getEditorGroup(G.call(this))];this.replaceChildControls(r,q);}function D(r,s){m.override({showPickerForCurrentMode:function q(){this._super();if(this.pickerMode===2&&typeof this.color!=="object"){var t=this.gradientOrientation;t.set("selectedIndex",X.find(t.items,"id",0));}}},r.colorPicker);}function R(v){var z=this.getHost(),s=F.LEGEND_SHOW,u=this.broker,w=function(AB,AD){if(AB===s){var AC=this.parent,AA=this;if(AC&&AC.scriptClass==="mstrmojo.ui.editors.controls.TwoColumnContainer"){AA=AC;}AA.set("enabled",!!AD);}else{this.onFmtPropsChangedDefault(AB,AD);}},t=a.getPropertyCheckBox(z,mstrmojo.desc(13600,"Show legend"),s),q=a.getCharacterConfigComp(z,null,u.getSmartNamesMapForFontGroup(Q),{controlName:"LegendFontGroup",listenFormatProps:[s],onFmtPropsChanged:w}),x=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13601,"Fill:")})),r=a.getFillConfigComp(z,null,u.getSmartNamesMapForColorFormat(P),{controlName:"LegendBackgroundFillGroup",listenFormatProps:[s],onFmtPropsChanged:w});mstrmojo.css.addWidgetCssClass(t,"title");this.replaceChildControls(v,[this.getEditorGroup([t,q,x,r])]);}mstrmojo.vi.models.editors.ImageLayoutEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.ImageLayoutEditorModel",help:"format_panel_image.htm",broker:null,init:function(q){this._super(q);this.broker=this.getHost().propertyManager;var r=this.getHost();r.switchToPanelListener=r.attachEventListener("switchToPanel",this.id,function(s){var t=s.panelID;if(t!==undefined){this.switchPanelByValue(t);}});r.switchTargetSelectorListener=r.attachEventListener("switchTargetSelector",this.id,function(s){var t=s.selName,u=s.value;this.switchTargetSelector(t,u);});},getInitialTarget:function g(){return C;},getTargetPulldownItems:function c(q){var s=this._super(q),r=this.getHost(),t=function(v){this.broker.clearRegisterFormatControl();return v.bind(this,q);}.bind(this),u=function(v){this.broker.clearRegisterFormatControl();return function(){var w=this.getHost();w.getShapeFileListWithXHR(v.bind(this,q));}.bind(this);}.bind(this);if(r.excludeData){return s;}s.unshift({n:mstrmojo.desc(11974,"Data Exploration"),v:C,h:u(L)});s.push({n:mstrmojo.desc(11978,"Rows and Columns"),v:I,h:t(B)});s.push({n:mstrmojo.desc(13757,"Shapes and Data Labels"),v:V,h:t(U)});if(r.hasSizeByOrColorByThs()){s.push({n:mstrmojo.desc(2403,"Legend"),v:b,h:t(R)});}return s;},getEditorGroup:function O(q,r){if(!this._super){return new mstrmojo.vi.ui.editors.EditorGroup(K.copy(r,{children:q}));}return this.addDisposable(this._super(q,r));},switchPanelByValue:function(q){if(this.initializing){return ;}this.selectTargetByValue(q);},switchTargetSelector:function(r,s){if(this.initializing){return ;}var q=this.broker,t=q.getTargetSelector(r);if(t.selectItemByField){t.selectItemByField("v",s);}},detachListeners:function N(){var q=this.getHost();if(q.switchToPanelListener){q.detachEventListener(q.switchToPanelListener);delete q.switchToPanelListener;}if(q.switchTargetSelectorListener){q.detachEventListener(q.switchTargetSelectorListener);delete q.switchTargetSelectorListener;}},destroy:function f(q){this.detachListeners();if(this._super){this._super(q);}delete this.broker;}});}());(function(){mstrmojo.requiresClsP("mstrmojo","Box","HBox","Widget","Button","hash","dom","array","css","desc","tooltip","string");mstrmojo.requiresCls("mstrmojo.mstr.EnumDataType","mstrmojo.vi.ui.editors.HierarchyElementsListPanel","mstrmojo.ExpressionToolbar","mstrmojo.vi.ui.editors.cm.CalculatedMemberExpressionInputBox");mstrmojo.requiresDescs(945,15656,15597,15831,15832,15358,15833);var F=mstrmojo.desc,G=mstrmojo.mstr.EnumDataType,E=mstrmojo.hash,H=mstrmojo.dom,I=mstrmojo.array,J=mstrmojo.css,K=mstrmojo.string;var B="xsp";mstrmojo.vi.ui.editors.CalculatedMemberPanel=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.editors.CalculatedMemberPanel",cssClass:"mstrmojo-CalculatedMemberPanel",isNew:false,canChangeParent:true,enablePTO:false,parentElement:null,children:[{scriptClass:"mstrmojo.Box",alias:"rootVBox",children:[{scriptClass:"mstrmojo.HBox",alias:"definitionBox",cssClass:"definitionBox",children:[{scriptClass:"mstrmojo.vi.ui.editors.HierarchyElementsListPanel",alias:"listPanel",disableDrop:true,handleDblClick:function A(U,Q){if(U.scriptClass==="mstrmojo.vi.ui.IncHierarchyList"){var S=Q.getTarget();if(!J.hasClass(S,"raBtn")&&!J.hasClass(S,"btn")){var R=U.getItemFromTarget(S);if(R&&!R.fetcher){var P=this.parent.defnPanel.inputBox;P.insertTokens([P.createToken(R)]);}}}},handleSetParent:function D(P){this.parent.parent.parent.set("parentElement",E.copyProps(["v","n"],P));},getCurrentPE:function C(){return this.parent.parent.parent.parentElement;},getAttributeIdFromModel:function M(){return this.parent.parent.parent.getAttributeId();},getBrowseConfig:function O(){return this.parent.parent.parent.getBrowseConfig();}},{scriptClass:"mstrmojo.Box",alias:"defnPanel",cssClass:"defn",children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-HBox deNameBox",alias:"deNameBox",bindings:{visible:function(){return this.parent.parent.parent.parent.isNew;}},children:[{scriptClass:"mstrmojo.TextBoxWithLabel",cssClass:"deNameTB",alias:"deNameTB",label:F(945,"Name"),cssDisplay:"block"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",alias:"ptoBtn",text:F(15656,"Pass-through Options"),onclick:function(){var S=this.parent.parent.parent.parent.parent,U=S.parent,P="mstrPTO",Q=mstrmojo.all[P]||mstrmojo.insert({scriptClass:"mstrmojo.PassThroughOptions",help:"create_derived_element_mdx_hierarchy_reports.htm",id:P}),W=H.position(this.domNode,true),V=S.getDataset(),R={zIndex:U.zIndex+10,left:Math.max(0,(W.x-333+W.w/2))+"px",top:W.y+"px",dbt:V.tables[0].dbt,so_dft:V.so_dft,sim_dft:V.sim_dft,onOK:function(X){U.mptf=X;}};if(U.mptf){R.mptf=U.mptf;}Q.open(U,R);},bindings:{visiable:function(){return this.parent.parent.parent.parent.parent.enablePTO;}}}]},{scriptClass:"mstrmojo.Box",alias:"parentLabelBox",cssClass:"parentBox",children:[{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:F(15597,"Parent:")},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",alias:"parentLabel",useRichTooltip:true,text:"",bindings:{text:function(){var P=this.parent.parent.parent.parent.parent.parentElement;return P&&P.n;}},updateTooltipConfig:function(){var R=this.domNode,P,Q=this.parent.parent.parent.parent.parent.parentElement;if((R.scrollWidth>R.clientWidth||!R.textContent)&&(Q&&Q.v)){P=H.position(this.domNode);this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:R.textContent||("<b>Name: </b>"+$ENC(Q.n)+"<br><b>ID: </b>"+$ENC(Q.v)),top:P.y,left:P.x};}else{delete this.richTooltip;}}}]},{scriptClass:"mstrmojo.Label",alias:"parentHint",cssClass:"hint",bindings:{text:function(){var P=this.parent.parent.parent.parent.canChangeParent;return P?F(15831,"Please change parent from Elements List"):F(15832,"The parent could not be changed");}}},{scriptClass:"mstrmojo.Label",cssClass:"blue bold expr",text:F(15358,"MDX Expression")},{scriptClass:"mstrmojo.ExpressionToolbar",onmouseup:function(W){var P=H.eventTarget(W.hWin,W.e),V=P.getAttribute("idx")||-1;this.set("selectedIndex",V);var S=this.parent.inputBox,Q=this.selectedItem,Y=Q&&Q.v.split(""),U=[];if(Q&&H.getButton(W.hWin,W.e)===H.MOUSE_BUTTON.LEFT){switch(Q.t){case 1:I.forEach(Y,function R(Z){U.push({v:Z,isDelimiter:true,isNew:true});},this);var X=S.insertTokens(U);if(Y.length===2){var V=X-Math.floor(U.length/2);S._delaySetTextCaretPos(S.itemsContainerNode.childNodes[V],1);}break;case 3:S.resetTokens();break;}}},},{scriptClass:"mstrmojo.vi.ui.editors.cm.CalculatedMemberExpressionInputBox",alias:"inputBox",postexpValidChange:function(){this.parent.parent.parent.applyBox.applyBtn.set("enabled",this.expValid);}}]}]},{scriptClass:"mstrmojo.HBox",alias:"applyBox",cssClass:"applyBox",bindings:{visible:function(){return !this.parent.parent.isNew;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div class="apply-text">'+K.encodeHtmlString(F(15833,"Drag and drop elements to create a Calculated Member. Click # button to apply.")).replace("#",'"&#10003;"')+"</div>"},{scriptClass:"mstrmojo.Button",iconClass:"applyBtn",alias:"applyBtn",onclick:function(){if(this.enabled){var R=this.parent.parent.parent,U=R.inputBox().getExpression(),P=R.parentElement,Q=[{dtp:G.DataTypeChar,v:U,}],S=R.parent;if(S.commitEdit(Q,false,P)){R.set("visible",false);S.toggleEdit(false);}}}},{scriptClass:"mstrmojo.Button",iconClass:"cancelBtn",alias:"cancelBtn",onclick:function(){var P=this.parent.parent.parent,Q=P.parent;P.set("visible",false);Q.toggleEdit(false);}}]}]}],resetDisplay:function N(){this.listPanel().resetDisplay();this.set("canChangeParent",!this.isEssbaseSource());this.set("parentElement",this.canChangeParent?this.getPeInModel():this.listPanel().attribute);this.inputBox().resetDisplay(this.getCmExpressionInModel());if(this.isNew){this.deNameTB().set("value",this.getCmNameInModel());this.set("enablePTO",this.isEssbaseSource()||this.isMDXSource());}},oncanChangeParentChange:function L(){if(this.hasRendered){J.toggleClass(this.domNode,B,!this.canChangeParent);}this.parentHint().set("visible",this.canChangeParent);this.parentLabelBox().set("visible",this.canChangeParent);},listPanel:function(){return this.rootVBox.definitionBox.listPanel;},deNameTB:function(){return this.rootVBox.definitionBox.defnPanel.deNameBox.deNameTB;},parentHint:function(){return this.rootVBox.definitionBox.defnPanel.parentHint;},parentLabelBox:function(){return this.rootVBox.definitionBox.defnPanel.parentLabelBox;},inputBox:function(){return this.rootVBox.definitionBox.defnPanel.inputBox;},getDataset:function(){var R=this.getAttributeId(),P=this.getDocModel(),Q=P&&P.findDatasetIdFromUnit(R);if(Q){return P.datasets[Q];}},isMDXSource:function(){var P=this.getDocModel();return P&&P.isMSASDataset(this.getDataset());},isEssbaseSource:function(){var P=this.getDocModel();return P&&P.isEssbaseDataset(this.getDataset());},getBrowseConfig:function(){return{datasetID:this.getDataset().did,messageID:mstrApp.getMsgID()};},getPeInModel:mstrmojo.emptyFn,getCmNameInModel:mstrmojo.emptyFn,getCmExpressionInModel:mstrmojo.emptyFn,getDocModel:mstrmojo.emptyFn,getAttributeId:mstrmojo.emptyFn,});}());(function(){mstrmojo.requiresClsP("mstrmojo","Box","HBox","VBox","css","dom","string","array","hash");mstrmojo.requiresCls("mstrmojo.ui.ScrollableList","mstrmojo._HasScrollbox","mstrmojo.vi.ui._HasUnitListAvatar2","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.mstr.ElementsDataHelper","mstrmojo.ui._IsIncFetchList","mstrmojo.Label","mstrmojo.SearchWidget","mstrmojo.vi.ui.editors.HierarchyElementsListPanel","mstrmojo.vi.ui._IsDraggableList");mstrmojo.requiresDescs(513,514,2827,12200,14743,14561,13779,15788);var Z=mstrmojo.array,B=mstrmojo.css,L=mstrmojo.desc,p=mstrmojo.string,U=mstrmojo.hash,n="dragIn",t="\u001E",N=200,G="x";function A(){var u=this._timerHandle;if(u){window.clearTimeout(u);delete this._timerHandle;}}function J(u){return u&&u.classList.contains(G);}mstrmojo.vi.ui.editors.DerivedElementPanel=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.vi.ui.editors.DerivedElementPanel",cssClass:"mstrmojo-DerivedElementPanel",isNew:true,isRA:false,excludeList:null,children:[{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.HBox",cssClass:"title-area",bindings:{visible:function(){return !this.parent.parent.isRA;}},children:[{scriptClass:"mstrmojo.Label",text:L(513,"Available"),cssClass:"available-label"},{scriptClass:"mstrmojo.Box",cssClass:"search-box",children:[{scriptClass:"mstrmojo.SearchWidget",alias:"search",quickSearch:true,onsearch:function q(x){var u=this.parent.parent.parent.parent,v=this;if(this._timerHandle){A.call(this);}this._timerHandle=window.setTimeout(function(){u.availableElems().startBrowsing(u.parent.browseConfig,x);delete v._timerHandle;},N);},onclear:function f(){var u=this.parent.parent.parent.parent;A.call(this);u.availableElems().startBrowsing(u.parent.browseConfig);}}]},{scriptClass:"mstrmojo.Label",cssClass:"selected-label",text:L(514,"Selected")},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton clear-btn",text:L(2827,"Clear"),onclick:function(){var u=this.parent.parent.parent,v=u.selectedElems().items;if(v.length>0){u.updateExcludeList(v,false);u.selectedElems().set("items",[]);u.availableElems().refresh();u.enableSaveBtn();}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"cart-table",children:[{scriptClass:"mstrmojo.vi.ui.editors.AvailableElements",alias:"availableElems",bindings:{visible:function(){return !this.parent.parent.parent.isRA;},dePanel:function(){return this.parent.parent.parent;}}},{scriptClass:"mstrmojo.vi.ui.editors.HierarchyElementsListPanel",alias:"hierarchyListPanel",multiSelect:true,useListModKeys:true,bindings:{visible:function(){return this.parent.parent.parent.isRA;}},toggleExcludedForItem:function r(u,w){var x=this.elementList,z=x.itemMap[u];if(z){B.toggleClass(x._getItemNode(z.idx),G,w);z.x=w;}},handleDblClick:function s(AA,v){if(AA.scriptClass==="mstrmojo.vi.ui.IncHierarchyList"){var z=v.getTarget();if(!B.hasClass(z,"raBtn")&&!J(AA.getItemNodeFromTarget(z))){var x=AA.getItemFromTarget(z);if(x&&!x.fetcher){var u=this.parent.parent.parent;u.selectedElems().addItems(U.copyProps(["v","t","n"],x));AA.parent.toggleExcludedForItem(x.v,true);u.updateExcludeList([x],true);u.enableSaveBtn();}}}},getExcludeList:function b(){return this.parent.parent.parent.excludeList;},getAttributeIdFromModel:function F(){return this.parent.parent.parent.parent.model.attId;},getBrowseConfig:function V(){return this.parent.parent.parent.parent.browseConfig;},processDragStart:function h(v){var w=this.elementList;if(w.isDraggingItem(v)){var u=v.src.data.items;Z.forEach(u,function(x){this.toggleExcludedForItem(x.v,true);},this);w.parent.parent.parent.parent.updateExcludeList(u,true);w.clearSelect();}},processDrop:function C(w){var x=this.elementList,v=x.parent.parent.parent.parent,u=w.src.data.items;Z.forEach(u,function(z){this.toggleExcludedForItem(z.v,false);},this);v.updateExcludeList(u,false);v.enableSaveBtn();},processDragEnd:function R(v){var x=this.elementList,w=v.src.data;if(!w.isDropSuccess&&w.srcId===x.id){var u=v.src.data.items;Z.forEach(u,function(z){this.toggleExcludedForItem(z.v,false);},this);x.parent.parent.parent.parent.updateExcludeList(u,false);}}},{scriptClass:"mstrmojo.Box",cssClass:"selected",alias:"selectedPanel",bindings:{visible:function(){return this.parent.parent.parent.isRA;}},children:[{scriptClass:"mstrmojo.HBox",alias:"titlebar",children:[{scriptClass:"mstrmojo.Label",cssClass:"selected-label",text:L(514,"Selected")},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton clear-btn",text:L(2827,"Clear"),onclick:function(){var u=this.parent.parent.parent.parent.parent,z=u.selectedElems(),x=z.items;if(x.length>0){u.updateExcludeList(x,false);z.set("items",[]);var v=u.hierarchyListPanel();Z.forEach(x,function(w){v.toggleExcludedForItem(w.v,false);});u.enableSaveBtn();}}}]},{scriptClass:"mstrmojo.vi.ui.editors.SelectedElements",alias:"selectedElems",bindings:{isRA:function(){return this.parent.parent.parent.parent.isRA;},dePanel:function(){return this.parent.parent.parent.parent;}},items:[],onitemsChange:function(){var u=this.parent.parent.parent.parent,v=u.hierarchyListPanel();}}]},{scriptClass:"mstrmojo.vi.ui.editors.SelectedElements",alias:"selectedElems",bindings:{visible:function(){return !this.parent.parent.parent.isRA;},dePanel:function(){return this.parent.parent.parent;}},items:[]}]},{scriptClass:"mstrmojo.Widget",markupString:"<div class='separator'></div>"},{scriptClass:"mstrmojo.HBox",cssClass:"setParent",visible:false,children:[{scriptClass:"mstrmojo.Label",text:L(14743,"Set Parent As:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"setParent"}]},{scriptClass:"mstrmojo.HBox",cssClass:"apply",children:[{scriptClass:"mstrmojo.Widget",markupString:'<div class="apply-text">'+L(12200,"Drag and drop elements to create group. Click # button to apply.").replace("#",'"&#10003;"')+"</div>"},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-Button okBtn",enabled:false,onclick:function(){var u=this.parent.parent.parent;if(u.parent.commitEdit(u.selectedElems().items,u.isNew)){this.set("enabled",false);u.set("visible",false);u.parent.toggleEdit(false);}}},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-Button cancelBtn",onclick:function(){var u=this.parent.parent.parent;u.set("visible",false);u.parent.initExcludeList();u.parent.toggleEdit(false);u.postClose();}}]}]}],postClose:function D(){this.selectedElems().set("items",[]);this.enableSaveBtn();},_set_visible:function d(w,u){this[w]=u;if(u===true){if(this.isRA){this.hierarchyListPanel().resetDisplay();}else{if(this.hasRendered){this.searchField().reset();}this.availableElems().startBrowsing(this.parent.browseConfig);this.enableCancelBtn();}}},onisRAChange:function e(w,u){if(this.hasRendered){B.toggleClass(this.domNode,"ra",this.isRA);}},updateExcludeList:function g(u,v){var w=this;if(v){Z.forEach(u,function(x){w.excludeList[x.v]=true;});}else{Z.forEach(u,function(x){delete w.excludeList[x.v];});}},enableSaveBtn:function(){this.children[0].children[4].children[1].set("enabled",this.selectedElems().items.length>0);},enableCancelBtn:function(){this.children[0].children[4].children[2].set("enabled",true);},availableElems:function P(){return this.children[0].children[1].availableElems;},hierarchyListPanel:function S(){return this.children[0].children[1].hierarchyListPanel;},selectedElems:function H(){return this.isRA?this.children[0].children[1].selectedPanel.selectedElems:this.children[0].children[1].selectedElems;},searchField:function M(){return this.children[0].children[0].children[1].search;},setParentBox:function(){return this.children[0].children[3];},setParentPulldown:function(){return this.children[0].children[3].children[1];}});function E(u){var v=u.getTarget();return v&&(v.className.indexOf("item")>=0||(v.parentNode&&v.parentNode.className.indexOf("item")>=0));}mstrmojo.vi.ui.editors.SelectedElements=mstrmojo.declare(mstrmojo.ui.ScrollableList,[mstrmojo._HasOwnAvatar,mstrmojo.vi.ui._HasUnitListAvatar2,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._IsDraggableList,mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.vi.ui.editors.SelectedElements",cssClass:"mstrmojo-SelectedElements",restrictedToAxis:"",multiSelect:true,useListModKeys:true,getSelectedItems:function Q(){var x=this,u=this.items,w=null,v=[];U.forEach(this.selectedIndices,function(AA,z){w=U.copy(u[z]);if(AA&&w){w.itemNode=x._getItemNode(z);if(w.itemNode.style.display!=="none"){v.push(w);}}});return v;},init:function o(u){this._super(u);},getItemDisplayName:function X(u){return u.n||L(14561,"(null)");},getItemProps:function a(w,u){var v=this._super(w,u);v.cls="mstrmojo-VIGroupDEElement";return v;},processDrop:function C(z){var AC=z.src.data,x=AC.items,AA=this,u=this.dePanel;if(AC.srcId===this.id){this.items=this.cachedItems;}else{var v=this.dePanel,AB=v.availableElems();Z.forEach(x,function(w){AA.items.push({n:w.n,v:w.v});});v.updateExcludeList(x,true);AB.refreshAndRetainScrollBar();if(AB._scroll){AB._scroll();}}u.enableSaveBtn();},scrollToEnd:function c(){this.refresh();var u={x:this.getScrollPos().x,y:Number.MAX_SAFE_INTEGER}||{x:0,y:0};this.scrollTo(u);},refreshAndRetainScrollBar:function j(){var u=this.getScrollPos()||{x:0,y:0};this.refresh();this.scrollTo(u);},ondrop:function Y(u){this._super(u);this.scrollToEnd();},findVisibleItemsNodeIndex:function(w){var u=0;if(this.itemsContainerNode&&this.itemsContainerNode.children){var v=[].slice.call(this.itemsContainerNode.children);v.some(function(x){x.style.display!=="none"&&u++;return x.textContent===w;});}return u;},scrollToItem:function(AA,x,v,w){var u=Z.filterOne(AA.items,function(AB){return AB&&AB.n===x.n;}),z=u?(w?AA.findVisibleItemsNodeIndex(u.n):u._renderIdx):-1;if(z>-1){AA.scrollTo({x:v.x,y:AA.itemsNode.offsetHeight*(z-1)});}else{AA.scrollTo(v);}},ondblclick:function O(v){var w=this.dePanel,u=w.availableElems(),x=this.selectedItem;if(E(v)){this.items.splice(this.selectedIndex,1);w.updateExcludeList([this.selectedItem],false);this.refreshAndRetainScrollBar();if(this.isRA){w.hierarchyListPanel().toggleExcludedForItem(this.selectedItem.v,false);}else{u.scrollToItem(x);}w.enableSaveBtn();}},processDragStart:function h(v){var u=this.getScrollPos()||{x:0,y:0};this._super(v);this.scrollTo(u);},});mstrmojo.vi.ui.editors.AvailableElements=mstrmojo.declare(mstrmojo.vi.ui.editors.SelectedElements,[mstrmojo.ui._IsIncFetchList,mstrmojo._HasScrollbox],{scriptClass:"mstrmojo.vi.ui.editors.AvailableElements",cssClass:"mstrmojo-AvailableElements",init:function o(u){this._super(u);this.ifDataHelper=new mstrmojo.mstr.ElementsDataHelper({browseConfig:{styleName:"MojoAttributeStyle",blockCount:mstrApp.elementsBlockCount||30,useBrowseForm:1}});},getItemProps:function a(w,u){var v=this._super(w,u),z=this.ifDataHelper&&this.ifDataHelper.browseConfig&&this.ifDataHelper.browseConfig.searchPattern,x;v.style="display:"+(this.dePanel.excludeList[w.v]?"none":"inline-block");v.html=v.n;if(z){x=new RegExp(p.regEscape(z),"ig");if(x.test(v.html)){v.html=v.html.replace(x,function(AA){return t+AA+t;});}}v.html=p.encodeHtmlString(v.html);if(z){while(v.html.indexOf(t)!==-1){v.html=v.html.replace(t,"<em>").replace(t,"</em>");}}return v;},getItemMarkup:function I(v,u){return this._super(v,u).replace("@en@n","@html");},selectedElems:function H(){return this.parent.selectedElems.items;},processDragStart:function h(v){var u=v.src.data.items;Z.forEach(u,function(w){if(!isNaN(w._renderIdx)){w.itemNode.style.display="none";}});this.clearSelect();},processDrop:function C(x){var z=x.src.data,v=z.items,u=this.dePanel;if(z.srcId!==this.id){u.updateExcludeList(v,false);u.selectedElems().refreshAndRetainScrollBar();}u.enableSaveBtn();},scrollToItem:function K(u){this.refresh();var v=this.getScrollPos()||{x:0,y:0};this._super(this,u,v,true);},ondrop:function Y(u){this._super(u);var v=u.src.data;this.scrollToItem(v.items[0]);},startBrowsing:function k(u,x){if(this.ifDataHelper&&this.ifDataHelper.browseConfig){U.copy(u,this.ifDataHelper.browseConfig);if(x){this.ifDataHelper.browseConfig.searchPattern=x;}else{delete this.ifDataHelper.browseConfig.searchPattern;}this.ifDataHelper.set("blockBegin",1);this.ifDataHelper.set("items",null);}var w=this,v=function(AA){w.inWaitPos=0;w.set("items",AA.items);w.initScroll();if(!AA.items||AA.items.length===0){w.itemsContainerNode.innerHTML="<div class='mstrmojo-VIGroupDENoResults'>"+AA.message+"</div>";}},z={success:function(AA){if(!AA.message){AA.message=L(13779,"No elements match your search");}v(AA);if(AA.items&&w._scroll){w._scroll();}},failure:function(AA){v(AA);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){w.itemsContainerNode.innerHTML="<div class='mstrmojo-VIGroupDENoResults invalid'>"+L(15788,"Unable to retrieve the list of elements for this attribute")+"</div>";}}};this.ifDataHelper.getItems(1,z);},preNext:function l(){if(!this.inWaitPos&&this.items&&this.items.length){this.itemsContainerNode.innerHTML+="<div class='item mstrmojo-VIGroupDEElement'>Wait...</div>";this.inWaitPos=this.items.length;}},onisFetchingChange:function m(u){if(!u.value&&this.supportsIncFetch&&this._scroll){this._scroll();}},postNext:function W(){if(this.inWaitPos>0){this.itemsContainerNode.removeChild(this.itemsContainerNode.childNodes[this.inWaitPos]);this.inWaitPos=0;this.updateScrollbars();}},ondblclick:function O(u){var v=this.dePanel.selectedElems(),x=v.items,w=this.selectedItem;if(E(u)&&w&&w.v&&Z.find(x,"v",w.v)<0){x.push({n:w.n,v:w.v});this.dePanel.updateExcludeList([w],true);this.refreshAndRetainScrollBar();v.scrollToEnd();if(this._scroll){this._scroll();}this.dePanel.enableSaveBtn();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocDataService","mstrmojo.array","mstrmojo.dom","mstrmojo.hash","mstrmojo.Button");mstrmojo.requiresClsP("mstrmojo.mstr","EnumFunction","EnumDSSXMLBaseFormType","EnumDSSXMLObjectTypes","EnumDSSXMLObjectSubTypes","EnumDSSConsolidationType","EnumDataType","EnumWebAPIErrorCodes");mstrmojo.requiresClsP("mstrmojo.ME","AttributeEditBox","MetricToken");mstrmojo.requiresClsP("mstrmojo.vi.ui","DatasetUnitList","DatasetUnitMenuUtils");mstrmojo.requiresClsP("mstrmojo.ui.menus","MenuConfig","Menu","EditorConfig");mstrmojo.requiresDescs(190,1388,2213,2453,2789,3323,3329,5188,9748,11490,11491,11492,11493,11614,11615,14717);var h=mstrmojo.array,M=mstrmojo.dom,x=mstrmojo.func,O=mstrmojo.hash,w=mstrmojo.mstr,l=w.EnumDataType,E=w.EnumDSSXMLBaseFormType,AA=w.EnumDSSXMLObjectTypes,W=w.EnumDSSXMLObjectSubTypes,B=w.EnumDSSConsolidationType,e=w.EnumFunction,H=w.EnumWebAPIErrorCodes,Y=mstrmojo.vi.enums.EnumFeatures,q=mstrmojo.vi.ui.DatasetUnitMenuUtils,f=1,A="\u001E",AC=mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS,Q=mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY,g,s={style:{params:{treesToRender:1}}};function V(AI,AJ,AH){var AG=this.docModel,AF=AG.controller;AJ=x.wrapMethods({failure:function(AK,AL){this.canceled(AL.id);}},AJ);O.copy({skipUICmdMgrOnFailure:[H.E_INVALID_EXPRESSION]},AH);AF.cmdMgr.execute({execute:function(){this.submit(AI,AJ,AH);},urInfo:{callback:AJ}});}function D(AG,AH,AI){var AF=AG.docModel;return q.getAggregateByMenu(AH,function(AK,AJ){AF.addShortcutMetric({dsid:AI,funcType:AJ,items:[{did:AK.did,t:AK.t}]},AF.getDatasetsUpdateCallback());});}function C(AG,AH,AJ){var AI=AG.dataset.set.mx,AF=h.filter(AI,function(AK){return !AK.hide;});return q.getCalculationMetricEditor(AF,AH,function(AM,AL,AP,AN){var AK=AG.docModel,AO={act:"addShortcutMetric",dsid:AJ,funcType:AP,funcType2:AN,units:[AM,AL]};V.call(AG,AO,AK.getDatasetsUpdateCallback(),s);});}function Z(AG){if(!AG){return ;}if(!AG.links){AG.links={};var AF=AG.links;h.forEach(AG,function(AH){O.forEach(AH,function(AI,AJ){if(!AF[AJ]){AF[AJ]=[];}AF[AJ].push(AI);if(!AF[AI]){AF[AI]=[];}AF[AI].push(AJ);});});}}function R(AM,AH,AK){if(AK.t!==AA.Attribute){return ;}var AL=AH._dsetId,AG=AH.docModel,AF=AG.controller,AJ=function(AN){var AO=AN.code||AN.getResponseHeader("X-MSTR-TaskErrorCode");if(AO==="-2147156975"){mstrmojo.confirm(mstrmojo.desc(14148,"For this dataset, this action can only be performed in the Dataset Editor. Click OK to open the editor now."),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){a(AH);}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}},AI=function(AN){var AO=x.wrapMethods(AF.getRefreshCallback(),{success:function(){AF.cmdMgr.reset();},failure:AJ});AG.getDataService().submitUpdates(AN,AO,{config:{showProgress:true,hideProgress:true,progressStateText:[mstrmojo.desc(8445,"Loading")],silent:true}});};Z(AG.als);q.getAttributeLinkMenu(AM,AK,AL,AG,AI);}function a(AI){var AF=mstrmojo.all[AI.panelId],AH=AI.dataset.set,AJ=AI._dsetId,AG=AI.docModel;AF.showDataImport({isEdit:true,isNewAnalysis:false,isManagedCube:AH.mngd,AnalysisId:AG.mid,ReportId:AJ,CubeName:AH.name,CubeDesc:AH.dsc,StatusCode:1});}function AB(AH,AG,AF){return AH.links[AG+" "+AF];}function N(AH,AF,AG){if(!c(AG,AF.docModel.als).isLinked){return ;}AH.addMenuItem(mstrmojo.desc(9748,"Unlink"),"",function(){var AJ=AF.docModel,AM=AG.did,AK=[],AI=[],AN=[],AL;h.forEach(AG.fs,function(AP){var AO=AB(AJ.als,AM,AP.fid);h.forEach(AO,function(AQ){AK.push(AP.fid);var AR=AQ.split(" ");AI.push(AR[0]);AN.push(AR[1]);});});AL={act:"applyAttributeLinking",srcAttrId:AM,srcFormId:AK.join(A),tgtAttrId:AI.join(A),tgtFormId:AN.join(A),unlink:true};V.call(AF,AL,AJ.controller.getRefreshCallback(),{style:{params:{treesToRender:3}}});});}function P(AH){if(!this.docModel){return false;}var AG=0,AF=2;O.forEach(this.docModel.datasets,function(AI){if(AG>=AF){return false;}h.forEach(AI.att,function(AJ){if(AJ.did===AH){AG++;return false;}});});return AG>=AF;}function c(AH,AI){var AF={isLinked:false,isId:false},AG=P.call(this,AH.did);if(AH.t===AA.Attribute){if(AG){return{isLinked:true,isId:true};}if(AI){Z(AI);h.forEach(AH.fs,function(AJ){if(AB(AI,AH.did,AJ.fid)){AF={isLinked:true,isId:!!AJ.idf};return false;}});}}return AF;}function t(AH,AF){var AG=0;h.forEach(AF,function(AI){if(h.find(AI.att,"did",AH.did)>=0){AG++;}});return AG>=2;}function U(AM,AI,AK){var AH=mstrmojo.all[AI.panelId].data,AF=AI.docModel,AJ=[{3072:true,3077:true}],AL=function(AP,AO){var AN=false;if(AP.st===AO.st){AN=true;}else{AJ.some(function(AQ){if(AQ[AP.st]&&AQ[AO.st]){AN=true;return true;}});}return AN;},AG=[];O.forEach(AH,function(AN){h.forEach(AN.mx.concat(AN.att),function(AO){if(AO.did!==AK.did&&AO.t===AK.t&&AL(AO,AK)&&!AO.hide&&h.find(AG,"did",AO.did)===-1){AG.push(AO);}});});if(AG.length===0){return ;}AG=q.getSortedDatasetUnits(AG);AM.addEditorMenuItem(mstrmojo.desc(11490,"Replace Reference With"),"",function(){return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"replaceReference",okVisible:false,cancelVisible:false,contents:[{scriptClass:"mstrmojo.ui.ScrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:AG,listHooks:{select:function AN(AO,AP){var AQ={act:"applyReconciliation",is_rr:true,members:[{srcid:AK.did,srct:AK.t,tgtid:AP.did,tgtt:AP.t}]};AF.submitDataDefnUpdate(AF.addUpdateObjects(AQ,{id:AP.did,type:AP.t,flag:AC.DATA_CHANGE}),x.wrapMethods(AF.getDatasetsUpdateCallback(),AF.controller.getPartialUpdateCallback()),mstrmojo.DocDataService.REQUEST_DEFN_DATA);}}}]}]});});}function u(){return mstrApp.rootCtrl.docCtrl;}function o(AK,AM,AG,AJ){if(AM.t===AA.Metric){var AI=u(),AL=AI.model.getDataService(),AF,AH={dsid:AK._dsetId,alias:AM.alias||AM.n},AN=null;if(AG==="edit"){AF={metricId:AM.did,metric:AM,editorId:AJ,action:{cmd:"edit",n:AM.n}};AH.did=AM.did;AN=AL.getEditDerivedMetricSubmitFunc(AH);}else{AF={metricId:"",editorId:AJ,action:{cmd:AG,refOi:{did:AM.did,n:AM.n}}};AN=AL.getAddNewDerivedMetricToDatasetSubmitFunc(AH);}if(AI.model.isFromSolrCube(AM.did)||AI.model.isFromMDXCube(AM.did)){AF.disableAFB=true;}AI.openDME(AK,AF,AN);}}function AE(AJ,AG){var AM=this.ctxt,AL=AG.parentNode,AK=new mstrmojo.WaitIcon({placeholder:AL.appendChild(document.createElement("span")),markupString:'<span id="{@id}" class="mstrmojo-WaitIcon {@cssClass}" style="{@cssText}"></span>',cssText:"z-index:1; position:absolute; top:0;; right:3px;"});AK.render();if(AM.t===AA.Attribute&&AM.da){var AI=u(),AH={dsid:AJ._dsetId,did:AM.did,n:AM.n,forms:AM.fs};var AN=function(AO){AK.set("visible",AO);};var AF=AH.forms||[];if(J(AM)){AI.openDynamicLinkEditor(AJ,AH,AN);}else{AI.openDAE(AJ,AH,AN);}}}function r(AJ,AH){var AG=AJ.docModel,AF=AG.controller,AL=AJ._dsetId,AK=[];var AI=[];AH.forEach(function(AO){var AM=AO.did,AN=AO.t;if(AN===4&&AO.um){AK.push({act:"removeDerivedMetricFromDataset",dsid:AL,metricId:AM});}else{if(AN===12&&AO.da){AK.push({act:"removeDAFromDS",dsid:AL,attrId:AM});}else{if(AO.st===12033){AK.push({act:"removeNDEFromDS",dsid:AL,oid:AM});}else{AK.push({act:"removeBaseUnitFromDataset",dsid:AL,unitId:AM,unitType:AN});}}}AI.push({id:AM,type:AN,flag:AC.DATA_CHANGE});});return function(){AF.cmdMgr.execute({execute:function(){this.submit(AK,AF.getRefreshCallback(),mstrmojo.DocDataService.REQUEST_DEFN_DATA);},urInfo:{treesToRender:3,undo:function(){this.urInfo.puObjs=AI;this.urInfo.callback=x.wrapMethods(AG.getDatasetsUpdateCallback(),{success:function(AM){if(AM.pukeys){AG.getRebuildCallback().success(AM);}}});},redo:function(){this.urInfo.puObjs=null;this.urInfo.callback=AF.getRefreshCallback();}}});};}function F(AF){if(mstrApp.isInVFConfigMode){return false;}return AF.every(function(AG){return(AG.t===AA.Metric&&AG.um)||(AG.t===AA.Attribute&&AG.da)||AG.st===12033;});}function n(){var AF=this.docModel,AG=AF.getSelectedViUnit().getZonesModel();return x.wrapMethods(AF.getDatasetsUpdateCallback(),{success:function(AJ){if(AJ.pukeys){var AH=AJ.pukeys&&AJ.pukeys.split("\u001E"),AK=AF.getUnitDefinitions(AH),AL=AF.partialUpdate(AJ.data,AK,AJ.defn,AH),AI=Object.keys(AK).filter(function(AM){return Object.keys(AL.def).indexOf(AM)===-1;});AI.forEach(function(AP){var AN=AF.getWidgetId({k:AP,wid:1}),AO=AN&&mstrmojo.all[AN],AM;while(AO){AM=AO.defn;if(AM&&AM.t===mstrmojo.EnumRWUnitType.PANEL&&AO.setDirty){AO.setDirty(true);break;}AO=AO.parent;}});}}},AF.getUpdateHiddenLayoutsCallback(),AG&&AG.getUpdateCallback());}function AD(AF,AH,AG){return{success:function(){var AM=mstrmojo.all[AF],AP=AM.getDatasetPanel(AG),AL=AP.ulist,AJ=AP.tableView,AK=AP.mdxView;var AO=function AO(AQ){return !!h.filterOne(AQ.items,function(AR){return AR.did===AH;});};if(AJ){h.filterOne(AJ.tbl.children,function(AQ){AL=AQ.tulist;return AO(AL);});}else{if(AK){h.forEach(AK.dimensions.children,function(AR){var AQ=AR.recursiveAttributes;if(AO(AQ)){AL=AQ;return false;}h.forEach(AR.multiLevelHierarchies.children,function(AS){var AT=AS.levels;if(AO(AT)){AL=AT;}return !AL;});return !AL;});if(!AL&&AO(AK.derivedObjects)){AL=AK.derivedObjects;}if(!AL&&AO(AK.metricFolder.metrics)){AL=AK.metricFolder.metrics;}if(!AL){h.filterOne(AK.metricFolder.folders.children,function(AQ){AL=AQ.metrics;return AO(AL);});}}}var AN=h.filterOne(AL.items,function(AQ){return AQ.did===AH;});if(AN){var AI=AN._renderIdx;AL.singleSelect(AI);AL._getItemNode(AI).scrollIntoView();}}};}function v(AH,AI,AG,AK){var AF=AH.docModel,AJ;if(AI.t===AA.Metric&&AI.um){AJ={act:"updateDerivedMetricOnDataset",dsid:AK,did:AI.did,name:AG};}else{if(AI.t===AA.Attribute&&AI.da){AJ={act:"updateDA",dsid:AK,attrId:AI.did,name:AG};}else{if(AI.t===AA.Consolidation&&AI.st===12033){AJ={act:"applyDEChanges",deId:AI.did,attId:AI.attId,actions:[{act:"updateDeObject",name:AG}]};}else{AJ={act:"editDocUnitProp",dsid:AI.t===AA.Metric?AK:null,unitId:AI.did,unitType:AI.t,prop:f,value:AG};}}}V.call(AH,AF.addUpdateObjects(AJ,{id:AI.did,type:AI.t,flag:AC.FORMAT_CHANGE}),x.wrapMethods(n.call(AH),AD(AH.panelId,AI.did,AK)),mstrmojo.DocDataService.REQUEST_DEFN_DATA);}function k(AI,AO,AL,AK,AF){var AP=AO.t===AA.Metric,AJ=AP?O.copyProps([AK],AI.docModel.datasets,{}):AI.docModel.datasets,AG=AP?"mx":"att",AM=[],AH=[],AN=function(){v(AI,AO,AL,AK);};O.forEach(AJ,function(AS){var AR=false,AQ=false;h.forEach(AS[AG],function(AT){if(AT.did===AO.did){AR=true;}else{if(AT.t===AO.t&&AT.n===AL){AQ=true;}}});if(AQ){if(AR){AM.push(AS.name);}else{AH.push(AS.name);}}});if(AM.length){mstrmojo.alert(mstrmojo.desc(11650,'Cannot rename: "##" already exists in dataset ###.').replace("###",AM.join(", ")).replace("##",AL),AF,mstrmojo.desc(1388,"Rename"));return ;}if(AH.length){mstrmojo.warn(mstrmojo.desc(11654,'"##" already exists in dataset ###. Do you want to proceed?').replace("###",AH.join(", ")).replace("##",AL),{confirmBtn:{fn:AN},cancelBtn:{fn:AF}},{title:mstrmojo.desc(1388,"Rename")});return ;}if((AO.t===AA.Metric&&AO.um)||(AO.t===AA.Attribute&&AO.da)||(AO.t===AA.Consolidation)){q.validateName(AL,AN,AF);}else{AN();}}function p(AH,AF){var AG=h.filter(AH.items,function(AI){return h.find(AF,"did",AI.did)<0;});AH.clearSelect();AH.set("items",AG);}function z(AI,AH){var AK=[],AG=AI.docModel,AJ=AI._dsetId,AF=function(AL){return AG.getToggleHiddenObjectAction(AJ,AL,true);};h.forEach(AH,function(AL){AK.push(AF(AL));});return function(){p(AI,AH);V.call(AI,AK,AG.getDatasetsUpdateCallback(),s);};}function L(AF){return{act:"addShortcutMetric",funcType:AF.formType===2?e.FunctionSum:e.FunctionCount,units:[{id:AF.did,type:AF.t}],prs:[{n:"UseLookupForAttributes",v:"0"}]};}function b(AI,AH){var AF=true,AJ,AG;h.forEach(O.keyarray(AH),function(AK){AJ=AH[AK];AG=AJ.att.concat(AJ.mx);if(h.find(AG,"did",AI)!==-1&&q.hasCGorCon(AJ)){AF=false;return false;}});return AF;}function J(AG){var AF=AG.fs||[];return AG.t===AA.Attribute&&AG.da&&AF.length===2&&AF[1].bftp===E.DssXmlBaseFormHTMLTag&&AF[1].fnm==="DYNAMICLINK";}mstrmojo.vi.ui.DocDatasetUnitList=mstrmojo.declare(mstrmojo.vi.ui.DatasetUnitList,null,{scriptClass:"mstrmojo.vi.ui.DocDatasetUnitList",docModel:null,addMenuProp:true,multiSelect:true,useListModKeys:true,getItemTooltip:function(AG,AH){var AF=M.position(AH);return O.copy({cssClass:"vi-regular vi-tooltip-C",posType:mstrmojo.tooltip.POS_TOPLEFT,top:AF.y-2,left:AF.x+AF.w+6},this._super(AG,AH));},hasTooltipContent:function(AF,AG){return true;},tooltipOpenDelay:Q,showMultiSelectionMenu:function X(AH,AJ,AF){var AL=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,isHostedWithin:false,alignWithAnchor:true,maxHeight:M.getMaxScrollHeight()}),AM=this.id,AG=this.docModel,AI=q.getMultiSelectionShortcutMetricFunctions(AH),AK=AH.filter(function(AN){return AN.t===AA.Attribute||AN.t===AA.Metric||AN.t===AA.Filter||AN.t===AA.Consolidation;});if(!mstrApp.isInVFConfigMode&&AI&&AI.length&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AL.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",AM,function(){return q.getMultipleMetricsCalculationMenus(AH,mstrmojo.all[AM]._dsetId,function(AN){AG.addShortcutMetric(AN,AG.getDatasetsUpdateCallback());});});AL.addSeparator();}if(AK.length>0&&!mstrApp.isInVFConfigMode){q.insertAddUnitToFilterMenu(AL,this.docModel,AK);}AL.addMenuItem(mstrmojo.desc(1995,"Hide"),"",z(this,AH));if(F(AH)&&((this.dataset.set.att||[]).length+(this.dataset.set.mx||[]).length)>AH.length){AL.addMenuItem(mstrmojo.desc(629,"Delete"),"",r(this,AH));}this.configurePopup(AL,AJ);AL.position=AF;if(AL.hasMenuItems()){this.openPopup(AL.newInstance());}},ondragstart:function m(AF){this.isIgnoreTooltipCloseDelay=true;this.hideTooltip();if(this._super){this._super(AF);}},showItemMenu:function I(Aa,AG,Ag){var AL=this._dsetId,Ae=this,AZ=Ae.docModel,AU=AZ.controller,AW=new mstrmojo.ui.menus.MenuConfig({position:Ag,isHostedWithin:false,supportsScroll:true,alignWithAnchor:true,maxHeight:M.getMaxScrollHeight()}),AV=Ae.id,AJ=mstrmojo.vi.ui.DatasetUnitMenuUtils.getHighlightElementHandler,AQ=function(){return q.getCreateTimeDAEditorCfg(Aa,function(Ai){for(var Ah in Ai){Ai[Ah].act="addDAToDataset";Ai[Ah].dsid=AL;}V.call(mstrmojo.all[AV],Ai,AZ.getDatasetsUpdateCallback(),s);});},Af=this.dataset.set,AS=Af.st===779,AK=Aa.t===AA.Attribute&&Aa.st===3076,Ad=J(Aa),AY=AZ.isMDXDataset(Af),AM=AZ.isDDADataset(Af),AO=AZ.isSparkDataset(Af),AT=AZ.isDatasetFromPushApi(Af);if(Aa.t===AA.Attribute){if(!mstrApp.isInVFConfigMode){if(Aa.da&&!(AM&&AY)){AW.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){AE.call(this,Ae,AG);},Aa);AW.addSeparator();}if(!Aa.da&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addMenuItem(mstrmojo.desc(13236,"Duplicate as Metric"),"",function(){V.call(mstrmojo.all[AV],[O.copy(L(Aa),{dsid:AL})],AZ.getDatasetsUpdateCallback(),s);},Aa);}}if(!q.isCGorCon(Aa,Af)&&!AK&&!Ad&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addEditorMenuItem(mstrmojo.desc(9918,"Data Type"),AV,function(){return q.getConfDataTypeMenuCfg(AZ,Aa,AL,function(Aj,Ah){var Ai;if(Aj){Ai={act:"addDAToDataset",isTokenStream:true,dsid:AL,forms:Ah,name:Aa.n};}else{Ai={act:"updateDA",isTokenStream:true,dsid:AL,attrId:Aa.did,update:Ah};}V.call(Ae,AZ.addUpdateObjects(Ai,{id:Aa.did,type:Aa.t,flag:AC.DATA_CHANGE}),x.wrapMethods(AZ.getDatasetsUpdateCallback(),AU.getPartialUpdateCallback()),mstrmojo.DocDataService.REQUEST_DEFN_DATA);});},Aa);if(!mstrApp.isInVFConfigMode&&!(AM&&AY)&&!Ad&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){u().openDAE(Ae,{dsid:AL},mstrmojo.emptyFn,Aa);},Aa);AW.addMenuItem(mstrmojo.desc(14717,"Create Links..."),"",function(){u().openDynamicLinkEditor(Ae,{dsid:AL},mstrmojo.emptyFn,Aa);},Aa);}}AW.addSeparator();}else{if(Aa.t===AA.Metric&&!mstrApp.isInVFConfigMode){if(Aa.um){AW.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){o.call(this,Ae,this.ctxt,"edit");},Aa);AW.addSeparator();}if(!Aa.um&&!Aa.rdm&&b(Aa.did,AZ.datasets)&&!AZ.isMDXDataset(this.dataset.set)&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addMenuItem(mstrmojo.desc(13235,"Duplicate as Attribute"),"",function(){var Ai=Aa.dt,Ah=(Ai===l.DataTypeDouble||Ai===l.DataTypeFloat||Ai===l.DataTypeReal),Ak=function(Am){var An=[],Al={v:mstrmojo.ME.MetricToken.brackets(Aa.n),tp:266,lv:1,oi:{did:Aa.did,t:Aa.t,n:Aa.n}};An.push({v:"!",tp:33,lv:4});if(Am){An.push({v:"Round2(",tp:"2",lv:1});An.push(Al);An.push({v:mstrConfig.listSep+"2)",tp:"2",lv:1});}else{An.push(Al);}An.push({v:"",tp:-1,lv:4});return mstrmojo.ME.AttributeEditBox.getTokenStreamXML({items:An});},Aj={act:"addDAToDataset",dsid:AL,isTokenStream:true,forms:[{bft:E.convertDataType2BaseFormType(Ai),formula:Ak(Ah)}],name:Aa.n};V.call(Ae,Aj,AZ.getDatasetsUpdateCallback(),s);},Aa);}if(AZ.findDatasetIdFromUnit(Aa.did)&&!AZ.isFromSolrCube(Aa.did)&&!AZ.isFromMDXCube(Aa.did)&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",AV,function(){var Ah=D(Ae,Aa,AL);return Ah;});}AW.addSeparator();if(mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),AV,function(){return C(Ae,Aa,AL);},Aa);AW.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){o.call(this,Ae,this.ctxt,"editNew");},Aa);AW.addSeparator();}}else{if(!mstrApp.isInVFConfigMode&&Aa.t===AA.Consolidation&&Aa.st===12033){AW.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"",function(){AU.openDEEditor(Ae,{dsId:AL,attId:null,attName:null,deObj:Aa,elemId:null,dispName:Aa.n,fromDatasetPanel:true});},Aa);AW.addSeparator();}}}var AR=[1,2,8,9,11];if(Aa.t===AA.Metric||(Aa.t===AA.Attribute&&!Ad&&(Aa.fs||[]).some(function(Ah){return AR.indexOf(Ah.bftp)!==-1;}))){AW.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),AV,function(){var Aj=function(Ak){V.call(Ae,AZ.addUpdateObjects(Ak,{id:Aa.did,type:Aa.t,flag:AC.FORMAT_CHANGE}),n.call(Ae),mstrmojo.DocDataService.REQUEST_DEFN_DATA);};if(Aa.um){var Ah=function Ai(Al){var An=["Format","Category","DecimalPlaces","ThousandSeparator","CurrencySymbol","CurrencyPosition","NegativeNumbers"],Am=null,Ak={};O.forEach(Al,function(Ap,Ao){Am=An.filter(function(Aq){return Aq.toLowerCase()===Ao.toLowerCase();})[0];if(Am){Ak[Am]=Ap;}});return Ak;};return q.getNumberFormatEditor(Aa,Aa.nf||{},function(Ak){var Al={act:"formatDerivedMetric",dsid:AL,mid:Aa.did,format:{FormattingNumber:Ah(Ak)}};Aj(Al);});}else{return q.getNumberFormatEditor(Aa,Aa.nf||{},function(Al){var Ak=AZ.getNumberFormatAction(Aa.did,Aa.t,Al);if(Aa.t===AA.Metric){Ak.datasetId=AL;Ak.datasetType=Ae.dataset.set.type;}Aj(Ak);});}});AW.addSeparator();}if(Aa.t===AA.Attribute){if(!Aa.da&&AZ.allowManageDocumentDataset()&&(!AS||(AS&&AZ.hasPrivilegesForAllTables(this.dataset.set.tables)))&&!AM){var AN=h.filter(this.dataset.set.tables,function(Ah){return h.find(Ah.attRefs,"did",Aa.did)!==-1;}),AF=this.dataset.set.mngd,Ac;if(AN&&AN.length>0){Ac=function(){return q.getMarkGeoRoleEditorCfg(AZ,Aa,AL,AF,AN,function(Ai,Ah){if(Ah){AZ.getDataService().submitUpdates(Ai,AU.getRefreshCallback());}else{AZ.getDataService().submitUpdates(AZ.addUpdateObjects(Ai,{id:Aa.did,type:Aa.t,flag:AC.DATA_CHANGE}),x.wrapMethods(AZ.getDatasetsUpdateCallback(),AU.getPartialUpdateCallback()),mstrmojo.DocDataService.REQUEST_DEFN_DATA);}});};if(Ac()&&!AZ.isFromSolrCube(Aa.did)&&!(mstrApp.isSingleTier&&Af.hcs)){var AI=-2147483648,AP=true,AX=h.filter(Aa.fs,function(Ah){return(Ah.bftp===2||Ah.bftp===3)&&(Number(Ah.der&2147483648)!==AI);});for(i=0;i<AX.length;i++){if(AX[i].fnm==="Latitude"||AX[i].fnm==="Longitude"){AP=false;break;}}AP=AP&&!AO&&!AT;if(AP){AW.addEditorMenuItem(mstrmojo.desc(13526,"Define Geography"),AV,Ac,Aa);}else{AW.addDisabledMenuItem(mstrmojo.desc(13526,"Define Geography"),"");}}}}if(!mstrApp.isInVFConfigMode&&!(AM&&AY)&&!q.isCGorCon(Aa,Af)&&AQ()&&mstrmojo.resolveFeature(Y.INSERT_NEW_METRIC)){AW.addEditorMenuItem(mstrmojo.desc(12701,"Create Time Attributes"),AV,AQ,Aa);}AW.addSeparator();}if(AZ.allowManageDocumentDataset()&&!Ad){R(AW,Ae,Aa);N(AW,Ae,Aa);if(Aa.t===AA.Attribute&&t(Aa,this.dataset.set.tables)){var Ab=mstrmojo.all[this.panelId],Af=this.dataset.set;if(this.dataset.set.hcs!==true&&!AO){AW.addMenuItem(mstrmojo.desc(13173,"Unmap Attributes..."),"",function(){a(Ae);});}}AW.addSeparator();}U(AW,Ae,Aa);if((!mstrApp.isInVFConfigMode)&&(Aa.t===AA.Attribute||Aa.t===AA.Metric||Aa.t===AA.Filter||Aa.t===AA.Consolidation)){q.insertAddUnitToFilterMenu(AW,AZ,Aa);}if(Aa.t===AA.Attribute||(Aa.t===AA.Metric)||Aa.t===AA.Filter||Aa.t===AA.Consolidation||Aa.t===AA.Dimension){var AH=this.getLabelNode(this.getItemNodeFromTarget(AG));AW.addMenuItem(mstrmojo.desc(1388,"Rename"),"",function(){q.renameItem(AH,Aa,function(Ah){var Ai=Aa.n,Aj=function(){Ah.set("text",Ai);},Ak=!Ah.allowTrimming?Ah.text:Ah.text.trim();k(Ae,Aa,Ak,AL,Aj);},{allowEmptyText:true,allowTrimming:false,cssClass:AH.className});},Aa);AW.addMenuItem(mstrmojo.desc(1995,"Hide"),"",z(Ae,[Aa]));if(F([Aa])&&((this.dataset.set.att||[]).length+(this.dataset.set.mx||[]).length)>1){AW.addMenuItem(mstrmojo.desc(629,"Delete"),"",r(Ae,[Aa]));}}this.configurePopup(AW,AG);AW.addPopupHandlers("highlight",AJ(true,AG),AJ(false,AG));AW.position=Ag;this.openPopup(AW.newInstance());},doItemSelect:function(AQ,AP){var AI=AP.hWin,AL=AP.e,AH=mstrmojo.all[this.panelId],AG=M.isMetaKey(AI,AL),AM=M.shiftKey(AI,AL),AO=AH.getPanelSelectedItems(),AF=AO[0]&&AO[0].ulist.dataset.set.did,AK=this.dataset.set.did,AJ=AF&&AF!==AK,AN=AO.some(function(AR){return AR.ulist!==this;},this);if(AN){if(AM){if(!this.getSelectedItems().length){return ;}}else{if(AG){if(AJ){return ;}}else{AH.getDatasetPanel(AF).clearSelect();}}}this._super(AQ,AP);},getItemMarkup:function K(AF){if(!g){g=this._super(AF).replace("</{@tag}>",'<div class="mark"></div></{@tag}>');}return g;},getItemProps:function j(AI,AF){AI.useAvailGeoFmsOnly=true;var AH=this._super(AI,AF),AG=c.call(this,AI,this.docModel.als);if(AI.t===AA.Attribute&&AG.isLinked){if(!AG.isId){AH.addCls("noId");}AH.addCls("isAttrLink");}AH.addCls(AI.ne?"hilight":"");AI.ne=false;if(AI.t===AA.Consolidation&&AI.st===W.ConsolidationManaged&&AI.ndetype===B.DssRecursiveDerivedElement){AH.addCls("nde4ra");}return AH;},deleteItem:function G(AF){var AG=this.dataset;window.alert('Delete item "'+(AF.n||AF.did)+'" from dataset "'+((AG&&AG.id)||"unknown")+'".');},doubleClickItem:function d(AF){u().model.getSelectedViUnit().getZonesModel().addUnitsFromDataSource([AF],this._dsetId);},twoClicksItem:function S(AI,AF){if(AI.t===AA.Attribute||(AI.t===AA.Metric)||AI.t===AA.Filter||AI.t===AA.Consolidation||AI.t===AA.Dimension){var AH=this,AJ=this._dsetId;var AG=this.getLabelNode(this.getItemNodeFromTarget(AF.getTarget()));q.renameItem(AG,AI,function(AK){var AL=AI.n,AM=function(){AK.set("text",AL);},AN=!AK.allowTrimming?AK.text:AK.text.trim();k(AH,AI,AN,AJ,AM);},{allowEmptyText:true,allowTrimming:false,cssClass:AG.className});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.TableOfContentsUnitList","mstrmojo._HasOwnAvatar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.css","mstrmojo.vi.models.EnumDragSources","mstrmojo.array","mstrmojo.string");mstrmojo.requiresDescs(221,629,1388,3397,14918,14919,14921,15022);var W=mstrmojo.vi.controllers.EnumLayoutManipulationType,X=mstrmojo.vi.controllers.EnumPanelManipulationType,C=mstrmojo.vi.controllers.EnumEvents,K=mstrmojo.css,N=mstrmojo.vi.models.EnumDragSources,D=mstrmojo.array,S=mstrmojo.string;function Q(b,d,Z){var c=d.parentNode;var a=0;Z=Z||100;while(c!=null&&a<Z){if(c==b){return true;}c=c.parentNode;a++;}return false;}function I(d){var c=mstrmojo.all[this.panelId].model,b=this.chapter,Z=b.k,a=c.getCurrentLayoutKey(),e=mstrApp.isAppStateSelection(),f=this.parent.parent;if(a!==Z){d=false;}if(!d){c.raiseEvent({name:e?"targetLayoutSelected":"layoutSelected",layoutKey:Z,panelKey:b&&b.panels&&b.panels[0].k});}if(!e){f.clearPageSelect();f.clearChapterSelect();this.selectTitleBar();}}function G(){return !(mstrApp.isAppStatePresentation()||mstrApp.isAppStateSelection())&&mstrApp.allowWebDashboardDesign();}mstrmojo.vi.ui.TableOfContentsChapterPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo._HasOwnAvatar,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.vi.ui.TableOfContentsChapterPortlet",markupString:'<div id="{@id}" class="mstrmojo-VIPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="mstrmojo-VIPanel-titlebar"></div><div class="mstrmojo-VIPanel-content"><div class="page-dnd-indicator"><div class="line"></div></div></div><div class="mstrmojo-VIDND-mask"></div><div class="reorder-dropzone"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.childNodes[2];},reorderDropNode:function(){return this.domNode.childNodes[3];},handleNode:function(){return this.domNode.lastChild;},pageDnDIndicatorNode:function(){return this.domNode.childNodes[1].firstChild;}},title:null,level:0,panelId:null,alias:null,chapterKey:null,panelStackKey:null,chapter:null,showTitleBarContextMenu:true,index:null,chapterCnt:null,layoutConfig:{h:{titlebarNode:"26px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},paddingCfg:{paddingLeft:3},lastDragOverInfo:null,avatarCssClass:"mstrmojo-VIUnitList tableOfContentUnitList",preOpenContextMenu:function O(){I.call(this,true);},init:function R(Z){this._super(Z);this.paddingCfg.paddingLeft=3;this.titleBar.set("hasContextMenuButton",G());},onAppStateChange:function P(Z){this._super(Z);this.titleBar.set("hasContextMenuButton",!(mstrApp.isAppStateSelection()||mstrApp.isAppStatePresentation())&&mstrApp.allowWebDashboardDesign());this.generateToolbar();},customizeTitleBarCfg:function V(a){var b=mstrmojo.all[this.panelId].model,Z=this.chapterKey,c=this;a.editTitleOnTwoClicks=G();a.getMenuConfig=function(){return G()?this.constructor.prototype.getMenuConfig.call(this):null;};a.onclick=function(){I.call(c);};a.titleEdited=function d(f,g,e){if(g){b.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.RENAME,layoutKey:Z,oldText:e,newText:f});}};return a;},getLayoutOffsets:function(){return{h:0,w:0};},getSelectedItems:function(){var Z=this.ulist;return Z.getSelectedItems();},clearSelect:function(){this.ulist.clearSelect();},removeSelect:function(Z){this.ulist.removeSelect(Z);},clearTitleSelect:function(){K.toggleClass(this.titleBar&&this.titleBar.domNode,"selected",false);},selectTitleBar:function(){K.toggleClass(this.titleBar&&this.titleBar.domNode,"selected",true);},isDragValid:function B(a){var Z=this.titleBar.lblTitle;return G()&&!Z.isEditing;},createAvatar:function L(){var Z=document.createElement("div");Z.innerHTML='<div class="'+this.avatarCssClass+" "+mstrApp.getThemeClassName()+'"><div class="item unit isAvatar"><span class="txt" unselectable="on">'+S.encodeHtmlString(this.titleBar.title)+"</span></div></div>";return Z.removeChild(Z.firstChild);},getDropAvatarIcon:function J(Z){return"move";},allowDrop:function F(a){var c=a&&a.src&&a.src.widget,b=a.getCtxtDragData&&a.getCtxtDragData(),Z=b&&b.src;if(!c){return false;}return(Z===N.TOC_CHAPTER&&c.id!==this.id)||((Z===N.TOC_PAGES_LIST)&&(c.id===this.ulist.id||b.items.length===1));},ondrop:function U(b){var k=b&&b.src&&b.src.widget,h=b.getCtxtDragData&&b.getCtxtDragData(),c=h&&h.src,Z=h&&h.idx,m=mstrmojo.all[this.panelId],j=m.model,l=this.index,o=m.chapterDnDIndicatorNode,g=this.lastDragOverInfo;var e=function(){if(g&&g.onTop){if(Z>l){j.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.MOVE,fromIdx:Z,toIdx:l});}else{j.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.MOVE,fromIdx:Z,toIdx:l-1});}}else{if(g&&!g.onTop){if(Z>l){j.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.MOVE,fromIdx:Z,toIdx:l+1});}else{j.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.MOVE,fromIdx:Z,toIdx:l});}}}};if(c===N.TOC_PAGES_LIST){var a=h.chapterKey;if(o.style.display==="block"){var n=D.map(h.items,function(p){return p.k;});if(!h.isAllPageSelected){j.raiseEvent({name:C.MANIPULATE_PANEL,type:X.MOVE_TO_NEW_CHAPTER,newChapterIdx:g&&g.onTop?l:l+1,srcChapterKey:a,panelKeys:n});}else{var d=mstrmojo.all[this.panelId];var f=d.getChapterPanel(a);Z=f&&f.index;e();}}else{this.ulist.ondrop(b);}}else{e();}o.style.display="none";},ondragover:function M(b){var e=b&&b.getCtxtDragData&&b.getCtxtDragData();if(e&&e.src===N.TOC_PAGES_LIST&&((e.items||[]).length>1||(e.chapterKey===this.chapterKey&&this.ulist.items.length===1))){return ;}var f=mstrmojo.all[this.panelId],j=f.chapterDnDIndicatorNode,a=b.tgt.node;var h=f.containerNode.getBoundingClientRect(),c=-15-h.top+f.containerNode.scrollTop;var d=Q(this.titlebarNode,a,5),k=a===this.reorderDropNode;if(d){j.style.display="block";var g=this.titlebarNode.getBoundingClientRect().top;j.style.top=(g+c)+"px";}else{if(k){j.style.display="block";var Z=this.reorderDropNode.getBoundingClientRect().bottom;j.style.top=(Z+c)+"px";}else{j.style.display="none";}}if(d||k){f.lastDragOverInfo={chapterKey:this.chapter.k};this.lastDragOverInfo={onTop:d};}else{this.lastDragOverInfo=null;}},ondragleave:function A(c){var d=c&&c.getCtxtDragData&&c.getCtxtDragData(),Z=d&&d.src;if(Z===N.TOC_PAGES_LIST){this.pageDnDIndicatorNode.style.display="none";}var b=mstrmojo.all[this.panelId],a=b.chapterDnDIndicatorNode;if(!(c&&c.tgt&&c.tgt.widget&&c.tgt.widget.id===this.panelId)){a.style.display="none";}if(this._super){this._super(c);}},getDragData:function E(){var b=this.id,Z=this.index;return{setAvatarClass:function a(c){var f=mstrmojo.all[b],d=f.avatar;if(d){var e=[f.avatarCssClass,"hasOwnAvatar",c];d.className=e.join(" ");}},fromIdx:Z,idx:Z,src:N.TOC_CHAPTER};},addMenuItems:function Y(b){var d=mstrmojo.all[this.panelId].model,a=this.chapterKey,e=this.panelStackKey,c=this.index,Z=this.chapterCnt;b.hostId=this.id;b.isHostedWithin=false;b.addMenuItem(mstrmojo.desc(14919,"Insert Page"),"",function(){d.raiseEvent({name:C.MANIPULATE_PANEL,type:X.NEW,layoutKey:a,panelStackKey:e});});b.addMenuItem(mstrmojo.desc(14918,"Insert Chapter"),"",function(){d.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.NEW});});b.addMenuItem(mstrmojo.desc(15022,"Duplicate Chapter"),"",function(){d.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.DUPLICATE,layoutKey:a});});b.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.ctxt.titleBar.editTitle();},this);if(Z>1){b.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){mstrmojo.warn(mstrmojo.desc(14921,"Deleting a chapter will delete all the pages in this chapter. Do you want to continue?"),{confirmBtn:{t:mstrmojo.desc(629,"Delete"),fn:function(){d.raiseEvent({name:C.MANIPULATE_LAYOUT,type:W.DELETE,layoutKey:a});},hot:false},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});});}return b;},positionAvatar:function H(a,Z){Z.dragOffsets={x:15,y:20};if(this._super){this._super(a,Z);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.mstr.EnumNodeDimty","mstrmojo.vi.ui.ConditionWalk","mstrmojo.fe.FilterUtils","mstrmojo.expr");mstrmojo.requiresDescs(15540);var I=mstrmojo.array,M=mstrmojo.hash,R=mstrmojo.Button.newWebButton,G=mstrmojo.mstr.EnumNodeDimty,P=I.hash([G.NodeDimtyUnspecified,G.NodeDimtyNone]),B=mstrmojo.fe.FilterUtils,J=mstrmojo.expr,Q=J.ET;mstrmojo.vi.ui.ConditionEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.ConditionEditor",cssClass:"mstrmojo-vi-ui-ConditionEditor",help:"Creating_a_Metric_Qualification.htm",title:mstrmojo.desc(15540,"Edit Qualification"),objectBrowsingEnabled:false,targets:null,targetsLastMod:null,ets:null,condition:null,model:null,hasPrompt:false,disableElementsBrowsing:null,inRelation:null,editor:null,children:[{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"></div>',cssDisplay:"inline-block",cssClass:"conditionBar",model:null,alias:"conditionBar",bindings:{model:"this.parent.model"},update:function(){var E=this.model,U=B.getExprNodeHtmlAndText(E.data?E.data:E,{emptyText:mstrmojo.desc(15413,"Qualification Details"),elemsEmpty:" "});if(this.containerNode){this.containerNode.innerHTML=U.html;this.containerNode.title=U.text;}}},{scriptClass:"mstrmojo.vi.ui.ConditionWalk",alias:"walk",dimtyTypes:P,delegateUpdateOkBtn:function D(V){var E=this.parent,W=E&&E.btnHbox,U=W&&W.okBtn;if(U){U.set("enabled",!!V);}},onOK:function O(){var U=this.condition,E=this.editor;E.onConditionEdit(U,this.model.get());},close:function L(){var E=this.condition;if(E&&E.isEmpty()){E.del();}},postmodeledit:function H(E){this.parent.updateConditionBar();},getIfDataSource:function S(){return this.parent.getIfDataSource();},onUpdateBrowseElementsParams:function N(E){this.parent.onUpdateBrowseElementsParams(E);},getDatasets:function F(){return this.parent.getDatasets();}}],buttons:[R(mstrmojo.desc(1442,"OK"),function(){var E=this.parent.parent;E.walk.onOK();E.close();},true,{enabled:true,alias:"okBtn"}),R(mstrmojo.desc(221,"Cancel"),function(){var E=this.parent.parent;E.close();})],updateConditionBar:function A(){this.conditionBar.update();},open:function K(V,E){this._super(V,E);var U={objectBrowsingEnabled:this.objectBrowsingEnabled,targets:this.targets,targetsLastMod:this.targetsLastMod,ets:this.ets,condition:this.condition,hasPrompt:this.hasPrompt,disableElementsBrowsing:this.disableElementsBrowsing,disableHierarchyLevel:this.disableHierarchyLevel,inRelation:this.inRelation,editor:this.editor};M.copy(U,this.walk);if(!(this.disableElementsBrowsing&&this.disableElementsBrowsing())){this.model.defaultETAttr=Q.AE;}this.walk.set("model",this.model);this.updateConditionBar();},onClose:function C(){this.walk.close();},getDatasets:mstrmojo.emptyFn,getIfDataSource:mstrmojo.emptyFn,onUpdateBrowseElementsParams:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.elementHelper","mstrmojo.DocSelector","mstrmojo.ui.MultiSelectPulldown","mstrmojo.ui.MultiSelectSearchablePulldown","mstrmojo.ui.Pulldown","mstrmojo.ui.SearchablePulldown");var N=mstrmojo.hash,J=mstrmojo.array,D=mstrmojo.dom,Q=mstrmojo.elementHelper,P=mstrmojo.DocSelector.DATAPARAMS,S=mstrmojo.DocSelector.STYLES;var M=0,B=1,C=2,G=4,H=1000;function L(c){var b=null,X=null,a=0,Z,Y;for(Z in c){Y=Number(Z);a++;b=(b===null||b>Y)?Y:b;X=(X===null||X<Y)?Y:X;}return a===0||X-b===a-1;}mstrmojo.ListDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.ListDocSelector",formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P","height"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},_buildEvent:function I(w,b){var o=this.node,a=this.defn,l=o.data.elms,c=[],r=[],z=b.multiSelect,d=b.selectedIndices,h=b.allIdx,f=!!d[h],s,n,u=[],g=this.include,j=function(){var AA=this.isInFilterPanel()&&this.getFilterPanel();return AA&&AA.isAutoApply();}.bind(this);if(!z){var X=l[b.selectedIndex],k=X.v;c=[k];u=[k+";"+X.n];r=[X];}else{if(f){n=l[h].v;c=[n];u=[n];r=[l[h]];}else{if(d[h]){d[h]=false;}var t=N.keyarray(d,true).sort(J.numSorter),m={};for(s in t){m[t[s]]=d[t[s]];}d=m;N.forEach(d,function(AB,AA){if(AB&&!l[AA].hid){c.push(l[AA].v);u.push(l[AA].v+";"+l[AA].n);r.push(l[AA]);}});}}this.defn.set("cek",c);if(c.length>0||!a.nsb||a.nsb===M){if(mstrApp&&mstrApp.isVI&&parseInt(this.style,10)===G&&l&&l.length>H&&c.length>l.length/2&&(j()||!this.isInFilterPanel())){w.include=!g;w.forceBuffer=true;w.requireToggle=true;b.include=!g;var q=[],Z=[];J.forEach(l,function(AB,AA){if(AA!==h&&!d[AA]){q.push(AB.v);Z.push(AB.v+";"+AB.n);}});this.defn.set("cek",q);w.eid=((parseInt(w.type,10)===1)?Z:q).join(Q.ELEM_SEPARATOR);}else{w.eid=((parseInt(w.type,10)===1)?u:c).join(Q.ELEM_SEPARATOR);}}else{if(a.nsb===B||!a.showall){w.unset=true;}else{if(a.nsb===C){w.eid=Q.ELEM_ALL_ID;r=[l[h]];}}}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){var v=this.model,x=v.getCurrentLayoutDef(),p=x&&x.units,Y=this.k;if(p&&p[Y]){p[Y].cesChange=true;}o.data.ces=r;o.data[P.CESREADY]=true;this.model.setDataReady(this.k,this.id,P.CESREADY,true,"ces",r);}var e=D.position(b.domNode,true);if(e){w.left=e.x;w.top=e.y;}if(f&&this.multi&&g){J.forEach(l,function(AB){var AA=AB.v;if(c[0]!==AA){c.push(AA);}});}if(a.sec){if(a.style!==mstrmojo.DocSelector.STYLES.SCROLLER){this.parent.set("count",Q.buildElemsCountStr(a.multi?c:l,l,this.isSelectionExcluded()));}}},getCekEvtListener:function W(Z,Y){var X=Z.defn.style;if(X===S.PULLDOWN||X===S.SCROLLER){return function(a){var e=Y.items,f={};if(!Y.multiSelect){var b=Y.selectedIndex=J.find(e,"v",a.value[0]);if(b>-1){f[b]=true;}}else{var d=Y.allIdx,c;if(d>-1&&J.indexOf(a.value,e[d].v)>-1){for(c=0;c<e.length;c++){f[c]=true;}}else{J.forEach(a.value,function(h){var g=J.find(e,"v",h);if(g>-1){f[g]=true;}});}}Z.selIdx=Y.selectedIndices=f;Z.handleActionInSyncPhase(function(){Y.refresh();});};}return this._super(Z,Y);},preBuildRendering:function A(){var Z=this.node.defn.style,Y=N.clone(this.formatHandlers),X=Y.contentNode;if(X){if((Z===S.RADIO||Z===S.CHECKBOX)&&Y.filterNode){X.push("fx");X.push("background-color");delete Y.filterNode;}if(Z===S.LIST){delete X.height;}}this.formatHandlers=Y;return this._super();},getWidgetClass:function U(Z,Y,X){if(Y===S.PULLDOWN){if(mstrApp.isVI&&!D.isMobile){return Z.multi?"ui.MultiSelectSearchablePulldown":"ui.SearchablePulldown";}return Z.multi?"ui.MultiSelectPulldown":"ui.Pulldown";}return this._super(Z,Y,X);},getWidgetConfig:function F(c,a,Z,b){var Y=c.getFormats(),X=this._super(c,a,Z,b);if(a===S.SCROLLER){c.extCls="extSlider";if(mstrApp&&mstrApp.isVI){X.isHoriz=true;}N.copyProps(["height","width"],Y,X);}if(a===S.PULLDOWN&&!Z.multi){X.isHostedWithin=false;X.onitemSelected=X.onchange;X.allowHTML=false;X.focusOnPopup=mstrmojo.App&&mstrmojo.App.isOIVM();}if(this.isRecursiveAttributeSelector()){X.getlevelNames=function(){var d={};J.forEach(c.levelForms,function(e){d[e.lv]=e.lvfn;});return d;};}return X;},updateWidget:function O(a){var b=this._super(a),X=a.selIdx;var Y=b.items=a.node.data.elms;b.selectedIndices=X;b.include=a.defn.include;if(!b.multiSelect&&Y&&Y.length){var Z=N.keyarray(X);if(Z.length===1){b.selectedIndex=Number(Z[0]);}else{b.selectedIndices={};b.selectedIndex=-1;}}return b;},isSelectAll:function E(){var a=this.node.data.elms,Z=this.children&&this.children[0],b=Z.selectedIndices,Y=Z.allIdx,X=!!b[Y],c=(a[Y]&&a[Y].v)||Q.ELEM_ALL_ID;if(this.include){return X||J.filter(a,function(d){return d.v!==c;}).length===N.keyarray(b).length;}else{return N.isEmpty(b);}},isFilterNothing:function K(){var Z=this.children&&this.children[0],a=Z.selectedIndices,Y=Z.allIdx,X=!!a[Y];return X;},destroy:function V(){var X=this.node.data;this._super();if(X.del){J.insert(X.elms,X.del.idx,X.del.elem);delete X.del;}},isValidSelection:function R(){var Z=this.node,a=Z.data,Y=Z.defn,b=a.ces,X=this.model;if(!Y.multi&&b&&b.length>1&&!this.allowsTogglingMultiSelect()){return false;}if(Y.style===mstrmojo.DocSelector.STYLES.SCROLLER&&!L(this.selIdx)){return false;}if(X.isSelWarnFlagOn(this.k)&&b&&b.length===0&&a.elms.length>0){return this.children[0].noneIdx&&this.children[0].noneIdx>-1;}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.util.ui._HostsSplitter","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.CheckList","mstrmojo.ui.ScrollableContainer","mstrmojo.Label","mstrmojo.ToolSeparator","mstrmojo.vi.ui.InteractiveUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.boxmodel","mstrmojo.css","mstrmojo.expr","mstrmojo.vi.models.VIComponentMap","mstrmojo.ME._MetricEditorHelper","mstrmojo.DocDataService","mstrmojo.DocSelector","mstrmojo.vi.ui.rw.VisFilterDisplayPanel","mstrmojo._HasPopup");var V=mstrmojo.array,a=mstrmojo.hash,AW=mstrmojo.css,w=mstrmojo.dom,AN=mstrmojo.expr,AI=AN.BFTP,AX=mstrmojo.DocSelector.STYLES,C=mstrmojo.DocSelector.DATAPARAMS,g=mstrmojo.elementHelper,N=mstrmojo.vi.ui.rw,b=mstrmojo.vi.models.VIComponentMap.TYPES,AP=N.VisFilterDisplayPanel,AG="\u001E",Z=4,AL=12,AV=47,I=257,AA=776,AE=779,Aa=1,A=250,J=1,c=10,Q=74,u=85,k=mstrmojo.getJsRoot()+"mojo/css/images/VisualizationFilter_icon.svg",AS="VisFilter",j="expanded",AT="default",m="ns-resize",q;function P(Ac){var Af=Ac.tgt.pos,Ai=Af.x,Ah=Af.y,Ag=Ac.src.data.parentDim,Ak=Ag.x,Aj=Ak+Ag.w,Ae=Ag.y,Ad=Ae+Ag.h;return Ai>=Ak&&Ai<=Aj&&Ah>=Ae&&Ah<=Ad;}function d(){var Aj=function(Ar,Aq){var Ap=[];Object.keys(Ar).forEach(function(At){var As=Ar[At];Ap=Ap.concat((As[Aq]||[]).filter(function(Au){var Av=V.find(Ap,"did",Au.did);if(Av>-1){if(Ap[Av].hide&&!Au.hide){Ap[Av].hide=false;}return false;}return true;}).map(function(Au){var Av=mstrmojo.hash.clone(Au);Av.dsc="("+As.name+")";return Av;}));});return Ap;},Ad=this.selector,Ao=Ad.model,Ac=Ad.defn.srcid,Ae=Ao.datasets,Am=Aj(Ae,["att"]),Ah=Aj(Ae,["mx"]),Ak=function(Ar){var Aq=[],Ap={};Object.keys(Ar).forEach(function(As){var Av=Ar[As],At=Av.att||[],Aw=Av.mx||[];if(V.find(At,"did",Ac)>=0){var Au=At.filter(function(Ax){return Ax.formType===AI.NUMBER&&Ax.did!==Ac&&!Ax.hide&&!Ap[Ax.did];}).map(function(Ax){Ax.dsc=Av.name;return Ax;}).concat(Aw.filter(function(Ax){return !Ax.hide&&!Ap[Ax.did];}).map(function(Ax){Ax.dsc=Av.name;return Ax;}));Aq=Aq.concat(Au);Au.forEach(function(Ax){Ap[Ax.did]=true;});}});return Aq;},Ag=V.filterOne(Am,function(Ap){return Ap.did===Ac;}),Ai=Ak(Ae||{}),An=function(Aq){var Ap={},Ar={};(Aq||[]).forEach(function(As){if(As.n&&Ap[As.n]){Ar[As.n]=true;}Ap[As.n]=true;});return Ar;},Af=An(Ai);return new mstrmojo.ui.menus.EditorConfig({cssClass:"topRank",okVisible:false,cancelVisible:false,contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11503,"Ranked By:")},{scriptClass:"mstrmojo.ui.ScrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:Ai,hasTooltipContent:function(Ap){return mstrmojo.vi.ui.InteractiveUnitList.prototype.hasTooltipContent.apply(this,arguments)||Af[Ap.n];},getItemTooltip:function(Ar,As){var Aq=mstrmojo.vi.ui.InteractiveUnitList.prototype.getItemTooltip.apply(this,arguments);if(Aq){var Ap=w.position(As);a.copy({cssClass:"vi-regular vi-tooltip-C",content:Ar.n+" ("+Ar.dsc+")",posType:mstrmojo.tooltip.POS_TOPLEFT,top:Ap.y,left:Ap.x+Ap.w+6},Aq);}return Aq;},listHooks:{select:function Al(As,At){var Aq=Ao.findDatasetIdFromUnit(Ag.did),Ar=function(A0,A2){var Az=A2+" by "+A0,Ax=Az,A1=V.hash(Ah.map(function(A3){return A3.n;})),Ay=1;while(A1[Ax]){Ax=Az+" ("+(Ay++)+")";}return Ax;},Ap=Ar(Ag.n,At.n),Aw=Ao.getDataService(),Au=function(Az,Ax){var A1=[],A2={oi:{did:"8107C31BDD9911D3B98100C04F2233EA",t:11,st:2826,n:"Sum"},v:"Sum"},A0=function(A3){return{tp:2,lv:1,v:A3};},Ay=function(A4){var A3={v:mstrmojo.ME.MetricToken.brackets(A4.n),lv:1,oi:{did:A4.did,t:A4.t,n:A4.n}};if(A4.st){A3.oi.st=A4.st;}return A3;};A1=[A2,A0("("),Ay(Az),A0(")"),A0("{"),Ay(Ax),A0("}")];return mstrmojo.ME._MetricEditorHelper.getTokenStreamXML({tks:{items:A1}});},Av=[Aw.getAddDerivedMetricToDatasetAction({dsid:Aq,formula:Au(At,Ag),isTokenStream:true,name:Ap,Ids:["$GUID_1"],afb:true,sfb:true}),Aw.getEditDocUnitPropAction({dsid:Aq,unitId:"$GUID_1",unitType:Z,prop:2,value:"1"})];Ao.datasetsSettings.unitOpr(Ap,"isDeleteWithFilter",true);Ao.datasetsSettings.unitOpr(Ap,"completeHide",true);Av=Av.concat(Ao.datasetsSettings.getSaveActions());Aw.submitUpdates(Av,mstrmojo.func.wrapMethods(Ao.getDatasetsUpdateCallback(),{success:function(Ay){var Ax=Aj(Ay.datasets,["mx"]).filter(function(Az){return V.find(Ah,"did",Az.did)===-1;}).map(function(Az){Az.isTopRank=true;Az.qt=J;Az.cs=c;return Az;});Ao.addFilterStackSelectors(Ax,Ad.fmts["z-index"]+1,null,true);}}));this.hideTooltip();this.parent.parent.closeAllMenus();return true;}}}]}]});}var AU=function(Ad){var Ac=[];(Object.keys(Ad)||[]).forEach(function(Af){var Ae=Ad[Af];if(Ae&&Ae.st!==AA&&Ae.st!==AE){Ac=Ac.concat({n:Ae.name,did:Af});}});return Ac;};function s(){var Ad=this.selector,Af=Ad.model,Ac=(Ad.defn.dsTks||"").split(AG),Ah=Af.datasets,Ae=AU(Ah)||[],Ag={};Ac.forEach(function(Ak){var Aj=V.find(Ae,"did",Ak);if(Aj>=0){Ag[Aj]=true;}});var Ai=new mstrmojo.ui.CheckList({cssClass:"selectors",items:Ae,selectedIndices:Ag});return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"filterDataset",contents:[Ai],fnOk:function(){var An=[],Ak=Ad.model,Am=Ak.getDataService(),Aj=Ai.getSelectedItems()||[],Al=Ad.defn.ck;if(!Aj.length){mstrmojo.alert(mstrmojo.desc(13765,"Please choose at least one dataset as target."));return false;}An.push(Am.getClearCtrlTargetAction(Al));An.push(Am.getClearCtrlTargetDatasetAction(Al));if(Aj.length>0){Aj.forEach(function(Ao){An.push(Am.getAddCtrlTargetDatasetAction(Al,Ao.did));});An.push(Am.getChangeControlElementSource(Al,Aa));Ak.submitDataDefnUpdate(An,mstrmojo.func.wrapMethods(Af.controller.getRefreshCallback(),Af.controller.resumeVIPanelSelection()));}}});}function l(){var Ad=this.baseTitle,Ac=this.count;if(Ac&&Ac.length){Ad+=" ("+Ac+")";}return Ad;}function o(){var Af=this.selector,Aj=Af&&Af.defn,Ah=Af.children&&Af.children[0],Ac=Ah.items,Ad=Af.style,Ae=Af.include;if(Ad!==AX.VISUALIZATION&&(!Aj||Aj.srct!==AL)){return"";}if(Ad===AX.ATTR_QUAL||Ad===AX.VISUALIZATION||(Ad===AX.CHECKBOX&&Af.isRecursiveAttributeSelector())){return Ah.getSummaryText();}var Ag=Ad===AX.SEARCH_BOX?Object.keys(Ac):Object.keys(Af.selIdx),Al=Ag.length;if(!!Af.unset||Ag.indexOf(String(V.find(Ac,"v",g.ELEM_ALL_ID)))>-1){return"";}if(!Al){return mstrmojo.desc(2057,"None");}if(Ad===AX.SCROLLER&&(Ag[Ag.length-1]-Ag[0])===(Al-1)){var Ai=Ae?"":mstrmojo.desc(1099,"Not")+" ";return Ai+(Al===1?Ac[Ag[0]].n:(Ac[Ag[0]].n+" - "+Ac[Ag[Al-1]].n));}var Ak=Ag.map(function(Am){return Ac[Am].n;}).join(", ");if(!Aj.include){Ak=mstrmojo.desc(1099,"Not")+" "+Ak;}return Ak;}function AF(Ad){var Ac=this;Ad=Ad||"";return[{scriptClass:"mstrmojo.Label",alias:"summaryBar",cssClass:"subtitle",title:Ad,text:Ad,slot:"summaryNode",onclick:function(){Ac.clickToCollapse();}}];}function W(Ac){var Ae=Ac.parent;if(Ae.isCollapsed){var Ad=o.call(Ae),Af=Ae.summaryBar;Af.set("text",Ad);Af.set("title",Ad);}}function AO(Ac){var Ae=[],Ag=Ac.defn.srcid,Af=Ac.defn.srct===4?"mx":"att";mstrmojo.hash.forEach(Ac.model.datasets,function(Ai){var Ah=Ai[Af];Ae=Ae.concat(Ah);});var Ad=V.filterOne(Ae,function(Ah){return Ah.did===Ag;});return !!V.filterOne(Ae,function(Ah){return Ad&&Ah.n===Ad.n&&Ah.did!==Ad.did&&Ah.t===Ad.t;});}function AQ(Ac){var Ae=Ac.defn.srct===4?"mx":"att",Af=Ac.defn.srcid,Ad=[];mstrmojo.hash.forEach(Ac.model.datasets,function(Ai){var Ah=Ai[Ae];var Ag=V.find(Ah,"did",Af);if(Ag!==-1){Ad.push(Ai.name);}});return Ad;}function f(Ad,Ac){var Ae;w.attachEvent(Ad,"mousedown",function(){Ae=window.setTimeout(function(){AW.addClass(Ac,"showFPBorder");},300);});w.attachEvent(Ad,"mouseup",function(){window.clearTimeout(Ae);AW.removeClass(Ac,"showFPBorder");});}var AM=mstrmojo.mixin({scriptClass:"__DraggableFP",avatarCssClass:"mstrmojo-filterportlet-avatar",selfAvatarCssClass:"mstrmojo-filterportlet-selfAvatar",getDragData:function AZ(Ac){var Af=this.id,Ad=this;return{item:this.selector,idx:this.selector.defn.fmts["z-index"],src:mstrmojo.vi.models.EnumDragSources.FILTERS,dim:w.position(this.domNode),parentDim:w.position(this.parent.domNode),setAvatarClass:function Ae(Ag){var Aj=mstrmojo.all[Af],Ah=P(Ac)?Ac._selfAvatar:Ac._avatarNode;if(Ah){var Ai=[(Ah===Ac._selfAvatar?Aj.selfAvatarCssClass:Aj.avatarCssClass),"hasOwnAvatar",Ag];Ah.className=Ai.join(" ");}},onRemove:function(Ai){delete Ad.domNode;var Ah=Ai.model;if(Ad.isVisFilter()){Ah.deleteVisFilterStackSelectors(Ai);}else{var Ag=!!(Ai.isFilterNothing&&Ai.isFilterNothing());Ah.deleteFilterStackSelectors([Ai.defn],Ag);}}};},isDragValid:function r(Ac){return w.contains(this.titlebarNode,Ac.src.node);},ondragstart:function L(Ac){this._super(Ac);this.domNode.style.display="none";},ondragmove:function D(Ad){if(P(Ad)){var Ae=Ad.src.data,Af=Ae&&Ae.dim,Ac=Ae&&Ae.parentDim;this.avatar=Ad._selfAvatar;this.positionAvatar({x:(Af.x-Ac.x),y:(Ad.tgt.pos.y-Ac.y)});Ad._avatarNode.style.display="none";Ad._selfAvatar.style.display="block";return true;}this.avatar=Ad._avatarNode;Ad._avatarNode.style.display="block";Ad._selfAvatar.style.display="none";return this._super(Ad);},wasDropped:function(){delete this.selector.node.defn.iifp;this.parent.removeChildren(this);this.destroy();},ondragend:function Y(Ac){var Ae=this.domNode;if(Ae){AW.removeClass(Ae,"showFPBorder");Ae.style.display="block";}this.avatar=Ac._avatarNode;this._super(Ac);if(Ac._selfAvatar){var Ad=this.parent;if(Ad){Ad.domNode.firstChild.removeChild(Ac._selfAvatar);}delete Ac._selfAvatar;}},createAvatar:function S(Af,Ad){var Ac;if(!Ad._avatarNode){Ac=Ad._avatarNode=document.createElement("div");Ac.appendChild(this.titlebarNode.cloneNode(true));Ac.style.margin="20px 0 0 20px";Ac.style.display="none";Ac.className=this.avatarCssClass;}if(!Ad._selfAvatar){if(this.domNode.className.indexOf("showFPBorder")===-1){AW.addClass(this.domNode,"showFPBorder");}Ac=Ad._selfAvatar=document.createElement("div");Ac.className=this.selfAvatarCssClass;Ac.appendChild(this.domNode.cloneNode(true));var Ae=document.createElement("div");Ae.className="icon";Ac.appendChild(Ae);Ac.style.position="absolute";Ac.style.opacity=0.75;this.parent.domNode.firstChild.appendChild(Ac);}return Ad._avatarNode;}},mstrmojo.mixin(mstrmojo._HasOwnAvatar,{}));function x(){if(!this.isVisFilter()){return ;}var Ad,Ae=this.domNode,Af=Ae.querySelectorAll(".mstrmojo-EditableLabel, .mstrmojo-Label"),Ac=Ae.querySelector(".right-toolbar");Ae.style.cursor="pointer";for(Ad=0;Ad<Af.length;Ad++){Af[Ad].style.cursor="pointer";}if(Ac){Ac.style.cursor=AT;}}mstrmojo.vi.ui.rw.FilterPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[AM,mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.util.ui._HostsSplitter,mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.rw.FilterPortlet",markupString:'<div id="{@id}" class="mstrmojo-VIPanel {@cssClass}" style="{@cssText}" mstrAttach:mouseover,mouseout,click><div class="mstrmojo-VIPanel-titlebar"></div><div class="mstrmojo-VIPanel-content"></div><div class="mstrmojo-summary-Label"></div><div class="mstrmojo-VIDND-mask"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},summaryNode:function(){return this.domNode.childNodes[2];},maskNode:function(){return this.domNode.childNodes[3];},handleNode:function(){return this.domNode.lastChild;}},layoutConfig:{h:{titlebarNode:"20px",containerNode:"100%",handleNode:"4px"},w:{titlebarNode:"all",containerNode:"all"},xt:true},canCollapse:true,showTitleBarContextMenu:true,srcId:"",selector:null,summaryBar:null,init:function AD(Ac){this._super(Ac);if(!!mstrApp.isWSStyling){this.layoutConfig={h:{titlebarNode:"26px",containerNode:"100%",handleNode:"1px"},w:{titlebarNode:"all",containerNode:"all",handleNode:"all"},xt:true};}if(this.isVisFilter()||a.walk("selector.node.data.disabled",this)){this.isCollapsed=true;this.set("isCollapsed",true);this.titleBar.set("isCollapsed",true);}},getLayoutOffsets:function(){return(!!mstrApp.isWSStyling)?{h:0,w:mstrApp.isWorkstation&&w.isMac()?16:18}:this._super();},postBuildRendering:function Ab(){var Ag=this.handleNode;AW.addClass(Ag,"showSplitter "+mstrApp.getThemeClassName());AW.removeClass(Ag,"v");AW.addClass(Ag,"h");Ag.style.cursor=this.isCollapsed?AT:m;if(this.isCollapsed){this.unRegisterSplitter(this.handleNode);}else{this.registerSplitter(this.handleNode);}var Af=this.titleBar,Ae=Af.lblTitle,Ac=Ae.onclick;Ae.onclick=function(Ah){var Aj=this._timeoutClick,Ai=this;if(!Aj){this._timeoutClick=window.setTimeout(function(){Ac.call(Ae,Ah);Af.btnCollapse.onclick(Ah);delete Ai._timeoutClick;},A);}};if(this.isVisFilter()){Af.btnCollapse.src=k;AW.addClass(this.titlebarNode,AS);this.domNode.style["padding-right"]="13px";Ae.onTextEditComplete=function(An,Ai){var Am=this.text,Al=this.parent.parent,Ah=Al.selector,Ak=Ah.k,Aj=Ah.model;if(An){Aj.renameRWUnitTitle(Am,Ai,Ak,{success:function(Ao){Al.set("baseTitle",Ao);},failure:function(Ao){mstrmojo.err(Ao);Al.set("baseTitle",Ai);}});}};}f(this.titlebarNode,this.domNode);if(this.isCollapsed&&!this.summaryBar&&!this.selector.isInvalid){this.addChildren(AF.call(this,o.call(this)));}this.height=Math.max(parseInt(this.height,0),Q)+"px";if((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview())){this.draggable=false;}var Ad=this._super();x.call(this);return Ad;},onAppStateChange:function AH(Ae){var Aj=mstrmojo.vi.VisualInsightApp.APP_STATES,Ad=Aj.PRESENTATION,Ag=Ae.value&Ad,Ai=mstrApp.isAppStatePause(),Ah=!!(Ae.valueWas&Aj.PAUSE);if(Ag||(Ae.valueWas&Ad)){this.draggable=!(Ag||mstrApp.isLayoutModePreview());this.generateToolbar();}if(Ai&&!Ah){var Ac=this.selector,Af=Ac&&Ac.node&&Ac.node.data;if(Af&&Af[C.DISABLED]){this.isCollapsed=true;this.set("isCollapsed",true);this.titleBar.set("isCollapsed",true);}}},onLayoutModeChange:function F(Ac){var Ad=mstrApp.isLayoutPreview(Ac.value);if(Ad||mstrApp.isLayoutPreview(Ac.valueWas)){this.draggable=!(mstrApp.isAppStatePresentation()||Ad);this.generateToolbar();}},getFormats:function AC(){var Ac=this.selector.getFormats();delete Ac.left;delete Ac.top;return Ac;},getTitleBarCfg:function v(){var Ad=this._super(),Ac=this.selector,Ag=this;Ad.isCollapsed=this.isCollapsed;this.baseTitle=Ad.title;this.title=Ad.title=l.call(this);Ad.useRichTooltip=true;Ad.updateTooltipConfig=function Ah(Aj){if(Ac&&Ac.isInvalid){var Ak=Ag.domNode;this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,content:this.getTooltipContent(Aj),refNode:Ak,top:3,left:Ak&&(Ak.getBoundingClientRect().width+5),cssClass:"vi-regular vi-tooltip-C"};}else{return this.constructor.prototype.updateTooltipConfig.call(this,Aj);}};Ad.shouldShowTooltip=function Af(Aj,Ak){this._showTooltipForSameNameObj=AO(Ac);return this.constructor.prototype.shouldShowTooltip.call(this,Aj,Ak)||this._showTooltipForSameNameObj||Ac.isInvalid;};Ad.getTooltipContent=function Ae(Aj){if(Ac&&Ac.isInvalid){return Ac.getInvalidTooltip();}return this.constructor.prototype.getTooltipContent.call(this,Aj)+(this._showTooltipForSameNameObj?"("+mstrmojo.string.encodeHtmlString(AQ(Ac).join(","))+")":"");};Ad.getTitleChildrenLayoutOffsets=function Ai(){return{h:2,w:3};};Ad.layoutConfig={w:{leftToolNode:"18px",textNode:"100%",rightToolNode:"22px"},h:{leftToolNode:"100%",textNode:"100%",rightToolNode:"100%"},xt:true};if(Ac.isInvalid){Ad.canCollapse=false;}return Ad;},onisCollapsedChange:function O(){if(this.isVisFilter()){this.isCollapsed=true;this.clickToCollapse();return ;}var Aj=this,Ai=Aj.k,Ae=this.selector,Ah=Ae.model,Ag=this.isCollapsed,Ac=Ag?1:0;Ae.defn.set("ds",Ac);Ae.set("visible",!Ag);this.handleNode.style.cursor=this.isCollapsed?AT:m;if(this.isCollapsed){this.unRegisterSplitter(this.handleNode);}else{this.registerSplitter(this.handleNode);}if(!this._onCollapseAll){var Al=Ah.getVIComponent(b.FILTER_PANEL),Af=function(){Al.raiseEvent({name:"filterPanelUpdated"});};Ah.execute({execute:function(){this.submit(Ah.getUnitFormatAction(Ae,1,{FormattingView:{WindowState:Ac}}),{success:function(){if(!Ag&&!Aj.isVisFilter()){Ae.expandOrEditToFetchElements();}Af();}},a.copy(mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION,{resolveOnly:true}));},urInfo:{callback:{success:function(Am){Ah.updateDefnCache(Am.defn,[Ai]);Al.rebuildChild(Al.children.filter(function(An){return An.k===Ai;})[0]);Af();}},treesToRender:1}});}var Ad=this.summaryBar;if(Ag&&!Ae.isInvalid){var Ak=o.call(this);if(!Ad){this.addChildren(AF.call(this,Ak));}else{Ad.set("text",Ak);Ad.set("title",Ak);Ad.render();}}else{if(Ad){Ad.unrender();this.removeChildren(Ad);}}},oncountChange:function R(){this.set("title",l.call(this));},onbaseTitleChange:function U(){this.set("title",l.call(this));},clearFilters:function AK(){var Ac=this.selector;if(Ac){Ac.clearSelector();W(Ac);}},updateSummaryBar:function h(Ae){var Ac=this.selector,Ad=Ac&&Ac.content;if(Ad&&Ac.style===AX.VISUALIZATION){Ad.updateSummaryText(Ae);W(Ac);}},refreshFilterSummaryBar:function AJ(){var Ac=this.selector;if(Ac){W(Ac);}},getSplitterInfo:function M(){return{min:u};},splitterMoved:function z(Ai){var Ak=parseInt(this.height,10)+Ai+"px",Am,Ae=this.selector,Ah=Ae.model,Ac=this.handleNode,Aj=this,An=Aj.parent,Ad=function(Ao){var Ap=Aj;if(!Ap.parent){(An.children||[]).forEach(function(Aq){if(Aq.k===Ap.k){Ap=Aq;}});}Am=Ap.height;Ap.set("height",Ao);Ac.style.top="";Ap.doLayout();Ae.getFilterPanel().updateScrollbars();};Ad(Ak);var Ag=Ah.getUnitFormatAction(Ae,1,{FormattingSize:{Height:mstrmojo.boxmodel.px2Inches(Ah.getZoomProps(),Ak)}}),Al={success:function(Ao){Ah.updateDefnCache(Ao.defn,[Ae.k]);}},Af={style:{params:{treesToRender:1}}};Ah.execute({execute:function(){this.submit(Ag,Al,Af);},urInfo:{undo:function(){Ad(Am);},redo:function(){Ad(Am);},callback:Al,extras:Af}});},setSlotDimensions:function K(Ae,Ad,Ac){if(Ae!=="containerNode"){this._super(Ae,Ad,Ac);}},doLayout:function t(){this._super();var Ac=this.domNode;if(Ac){Ac.style.height="auto";}},addMenuItems:function X(Ae){var As=this,Am=As.selector,Aq=Am&&Am.isInvalid,Ak=function Ak(){var Av=Am.model;if(As.isVisFilter()){As.closeVisSelectorPanel();Av.deleteVisFilterStackSelectors(Am);}else{var Au=!!(Am.isFilterNothing&&Am.isFilterNothing());Av.deleteFilterStackSelectors([Am.defn],Au);}};Ae.isHostedWithin=false;Ae.hostId=this.id;Ae.supportsScroll=true;Ae.maxHeight=w.getMaxScrollHeight();if(Aq){Ae.addMenuItem(mstrmojo.desc(629,"Delete"),"Delete",Ak);return ;}this.addModeMenuItems(Ae,Am,function(){W(Am);});Ae.addSeparator();this.addShowAllMenuItem(Ae,Am);Ae.addSeparator();var Ac=Am.ckey,Al=Am.getFilterPanel(),An=this.id,Ar=mstrApp.isAppStatePresentation(),Ai=Am.defn.srcid,Ad=Am.model,Ah=Ad.isFromMDXCube(Ai),Af=Ad.isFromSolrCube(Ai);this.addClearFilterMenuItem(Ae,Am,function(){Al.clearSingleBuffSlice(Ac);W(Am);});Ae.addSeparator();this.addQualMenuItems(Ae,Am);if(!Ar){if(Am.isAttributeSelector()&&!Ah&&!Af){Ae.addEditorMenuItem(mstrmojo.desc(13628,"Filter by Rank"),An,d);}Ae.addSeparator();this.addSetDisplayFormsMenuItem(Ae,Am);Ae.addSeparator();if(!Af){this.addFilterStyleMenuItem(Ae,Am);}this.addMultiSelectMenuItem(Ae,Am);this.addAutoSearchMenuItem(Ae,Am);Ae.addSeparator();}if(Am.supportsSetTarget()&&!Af){this.addMenuItemIfSelectTargetsValid(Ae,Am,mstrmojo.desc(11572,"Select other filters within the Filter panel."));Ae.addSeparator();}if(!Ar&&Am.style===mstrmojo.DocSelector.STYLES.VISUALIZATION){this.addConfigVisSelectorMenu(Ae,Am);Ae.addSeparator();}if(!Ar){this.addReplaceWithMenuItem(Ae,Am);Ae.addSeparator();if(As.isVisFilter()){Ae.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){As.titleBar.lblTitle.set("isEditing",true);});}Ae.addMenuItem(mstrmojo.desc(629,"Delete"),"Delete",Ak);}var Aj=Ae.menus,Ap=Aj.length,Ao,At=-1,Ag=Ap;if(Aj&&Ap>1){for(Ao=0;Ao<Ap;Ao++){if(Aj[Ao].cls!=="seperator"){break;}At=Ao;}for(Ao=Ap-1;Ao>=0;Ao--){if(Aj[Ao].cls!=="separator"){break;}Ag=Ao;}Ae.menus=Aj.slice(At+1,Ag);}},getTargetInfo:function n(){var Ac=this.selector,Ae=Ac.model;var Ad=Ac.getFilterPanel().getFilterDefinitions().filter(function(Af){return(Af.ckey!==Ac.ckey)&&((Af.srct===AL&&Af.style!==AX.ATTR_QUAL)||Af.srct===AV||Af.srct===I);}).map(function(Af){return{n:Af.ttl,id:Af.ckey,st:Af.style,src:Ae.getObjectInfo(Af.srcid)};});return{keys:(Ac.defn.tks||"").split(AG).filter(function(Af){return Ad.some(function(Ag){return Ag.id===Af;});}),items:Ad};},isVisFilter:function p(){return this.selector.style===AX.VISUALIZATION;},clickToCollapse:function G(){if(!this.isVisFilter()){return ;}var Ad=this.parent&&this.parent.parent,Ag=Ad&&Ad.model,Af=this.k,Ah=this,Ac=this.selector;if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){if(mstrApp.isInVFConfigMode){return ;}var Ae=Ag.addVisFilterContainer(),Aj=Ag.getSelectedViUnit(),Ai;Ag.oldSelectedVizBoxId=Aj.id;mstrApp.isInVFConfigMode=true;mstrApp.restoreVFKey=Af;Ai=Ag.insertVizBox(Af,Ae,{});Ag.controller.rootCtrl.initPanelStautsInConfigMode();Ag.selectVIUnit(Ai.id,true,{isAddAction:true});mstrApp.getRootController().enterVizFilterConfigMode(Ac.parent.baseTitle,true);return ;}if(Ag){Ah.openVizSelectorPanel(Af,Ag);}},openVizSelectorPanel:function E(Ae,Ad){if(!Ae||!Ad||q){return ;}var Ac=this.selector;mstrApp.isInVFInteractMode=true;q=new AP({nodeKey:Ae,model:Ad,filterPortlet:this,include:Ac.include});AW.addClass(this.domNode,j);this.openPopup(q);Ad.cachePrevSelectedUnitId();},updateVizSelectorPanel:function e(){var Ac=this.selector&&this.selector.node;if(q&&Ac){q.updateVis(Ac);}},updateVisFilterTitle:function AY(){if(q){q.updateTitleBar();}},closeVisSelectorPanel:function B(){if(q){q.cancelSelections();}},resetVisFilterState:function AR(){AW.removeClass(this.domNode,j);q=null;mstrApp.isInVFInteractMode=false;delete this._lastOpened;},updateForScroll:function AB(){if(mstrApp.isInVFInteractMode&&q){q.updateFormats();}},destroy:function H(){if(q){q.cancelSelections();}if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.vi.ui.rw.selectors.SearchableCheckList","mstrmojo.vi.ui.rw.selectors.LevelCheckList","mstrmojo.vi.ui.rw.selectors.LevelPopupList","mstrmojo.vi.ui.rw.selectors.HierarchyCheckList","mstrmojo.vi.ui.rw.selectors.PageBySlider","mstrmojo.vi.ui.rw.selectors.PageByButtonBar","mstrmojo.vi.ui.rw.selectors.MetricQualification","mstrmojo.vi.ui.rw.selectors.MetricSlider","mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.LinkList","mstrmojo.vi.ui.rw.selectors.ListBoxSelector","mstrmojo.vi.ui.rw.selectors.VisSelectorBox","mstrmojo.array","mstrmojo.css","mstrmojo.hash");var J=mstrmojo.hash,G=mstrmojo.array,I="vi.ui.rw.selectors.",A=mstrmojo.DocSelector.STYLES;var D=12,E=47,P=12033,S=3076;var L={};L[A.CHECKBOX]=L[A.RADIO]=I+"SearchableCheckList";L[A.LIST]=["ListBoxHoriz",I+"ListBoxSelector"];L[A.SCROLLER]=I+"Slider";L[A.METRIC_SLIDER]=I+"MetricSlider";L[A.METRIC_QUAL]=I+"MetricQualification";L[A.LINK]=L[A.BUTTON]=I+"LinkList";L[A.VISUALIZATION]=I+"VisSelectorBox";function C(Y){var X=Object.keys(Y),W=X.length,Z=W-1,V=G.applyLargeArray(X,Math.min,Number.POSITIVE_INFINITY),U=G.applyLargeArray(X,Math.max,Number.NEGATIVE_INFINITY);return W===0||U-V===Z;}mstrmojo.vi.ui.rw.selectors._IsDocSelector=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsDocSelector",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsDocSelector",model:null,multi:false,k:"",init:function N(U){this._super(U);mstrmojo.css.addWidgetCssClass(this,"vi-DocSelector");},layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true},getLayoutOffsets:function Q(){if(this.isInFilterPanel()){return null;}return{h:18,w:18};},update:function F(W){var U=W.defn&&W.defn.fmts||{},X=this.isViPageBy,V=W.defn;if(X||this.isInFilterPanel()){V.fmts=J.copyProps(["height","z-index"],U);}else{V.fmts=J.copy(U);}if(X){V.multi=false;}this._super(W);},preBuildRendering:function B(){if(!this.isViPageBy&&!this.isInFilterPanel()){this.formatHandlers={domNode:["F","text-align","vertical-align","line-height"],contentNode:["fx"],item:["F","text-align","line-height"]};}var W=this.style,V=W===A.RADIO,U=W===A.CHECKBOX;if(U||V||W===A.LINK||W===A.BUTTON){var X=this.children[0];X.orientation=this.node.defn.horiz?"h":"v";if(U||V){X.multiSelect=!V;}}this.content.hostedCSSClass="selector";this._super();},postBuildRendering:function O(U){if(this.bindWarningHandler){this.bindWarningHandler(this,this.content);this.validate();}return this._super(U);},getWidgetClass:function R(X,W,V){if(X.isViPageBy){if(W===A.SCROLLER){return I+"PageBySlider";}if(W===A.BUTTON){return I+"PageByButtonBar";}}if(this.isRecursiveAttributeSelector()&&W===A.CHECKBOX){if(this.isInFilterPanel()){return I+"HierarchyCheckList";}else{return I+(V?"LevelPopupList":"LevelCheckList");}}var U=L[W];if(U){if(U.constructor===Array){U=U[V?0:1];}return U;}return this._super(X,W,V);},updateWidget:function K(V){var U=this._super(V);if(V.style===mstrmojo.DocSelector.STYLES.SCROLLER&&!C(V.selIdx)){U.selectedIndices={};}return U;},validate:function H(){if(this.isValidSelection&&!this.isValidSelection()){this.set("validation",{refNode:this.parent.domNode,position:1,invalid:true,errorCode:"unableDisplaySelectionVIWarning"});}},getSelectorReplaceUnitList:function M(){var V=[],U=[];if(!this.isRecursiveAttributeSelector()){return[];}if(this.isInFilterPanel()){U=this.getFilterPanel().getFilterDefinitions();}J.forEach(this.model.datasets,function(W){G.forEach(W.att,function(Y){var X=this.defn&&this.defn.srcid,b=this.model.getDEObject(X),a=Y.did,Z=this.model.getDEObject(a);if(!Y.hide&&X!==a&&G.find(U,"srcid",a)<0&&(b?b.attId:X)===(Z?Z.attId:a)){V.push(Y);}},this);},this);return V;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.vi.ui.rw.selectors.AttrQualInputBox","mstrmojo.array","mstrmojo.expr","mstrmojo.date","mstrmojo.VisChartUtils","mstrmojo.locales","mstrmojo.elementHelper","mstrmojo.vi.ui.DatasetUnitMenuUtils");var J=mstrmojo.expr,K=J.BFTP,E=mstrmojo.date,P=mstrmojo.VisChartUtils,F=mstrmojo.array,A=mstrmojo.vi.ui.DatasetUnitMenuUtils,R=mstrmojo.locales,L=mstrmojo.DocSelector.DATAPARAMS;function H(U,V){if(!U){return ;}var W=E.getDateJson(new Date(P.convertRawValueToMilliseconds(U))),S=E.formatDateInfo(W,R.datetime.DATEOUTPUTFORMAT);if(V===J.DTP.TIMESTAMP){S+=" "+E.formatTimeInfo(W,R.datetime.TIMEOUTPUTFORMAT);}return S;}mstrmojo.AttrQualDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.AttrQualDocSelector",getWidgetClass:function N(V,U,S){return"vi.ui.rw.selectors.AttrQualInputBox";},newAndInitWidget:function M(S){var U=this._super(S);S.attachEventListener("includeChange",U.id,function(V){this.set("include",V.value);});return U;},_buildEvent:function D(a,Z){a.f=Z.f;a.ft=Z.ft;a.fid=Z.fid;a.ckey=this.ckey;a.srcid=Z.srcid;a.srct=Z.srct;var Y=Z.dt,X=[];F.forEach(Z.cs,function(b){if(!mstrmojo.string.isEmpty(b.v)){X.push(b.v);}});if(X.length){a.cs=X.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}a.dtp=Y;a.unset=Z.unset;if(a.unset||mstrmojo.string.isEmpty(a.cs)){delete a.fid;}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){var U=this.model,W=U.getCurrentLayoutDef(),V=W&&W.units,S=this.k;if(V[S]){V[S].cesChange=true;}U.setDataReady(this.k,this.id,L.CSREADY,true,["f","ft","cs"],[Z.f,Z.ft,Z.cs]);}},getCekEvtListener:function Q(U,S){return function(V){U.handleActionInSyncPhase(function(){S.update(V.value);});};},updateWidget:function I(W){var X=this._super(W),U=W.node,V=U.data;if(X.update){var S={cs:V.cs,f:V.f,ft:V.ft,fid:V.fid,min:H(V.min,V.dt),max:H(V.max,V.dt)};X.update(S);}return X;},getWidgetConfig:function B(g,Z,d,S){var a=g.model,e=g.getFormats(),Y=g.node.data,c=this._super(g,Z,d,S);c={scriptClass:c.scriptClass,cssText:e.height?"height: "+e.height:"",srcid:d.srcid||"",srct:d.srct||"",cs:Y.cs,min:H(Y.min,Y.dt),max:H(Y.max,Y.dt),showAdvanced:true,canSelectDisabledDate:true,f:Y.f,ft:Y.ft||1,fid:Y.fid,dt:Y.dt,onchange:function(){if(!g._inSyncPhase){g.selectorControlChange(this);}}};if(!c.fid||!c.dt){var X=A.getUnitFromDataset(a.datasets,d.srcid,12),b=(X&&X.fs)||[],f=b[0],W,V=function(h){if(!c.fid){c.fid=h.fid;}if(!c.dt){switch(h.bftp){case K.TEXT:c.dt=J.DTP.CHAR;break;case K.DATE:c.dt=J.DTP.DATE;break;case K.DATETIME:c.dt=J.DTP.TIMESTAMP;break;default:c.dt=J.DTP.CHAR;}}};for(W=0;W<b.length;W++){if(b[W].iidx){f=b[W];break;}if(b[W].idf){f=b[W];}}if(f){V(f);}}var U=c.dt;if(c.f===undefined){if(U===J.DTP.CHAR){c.f=J.FN.SEARCH;}else{if(U===J.DTP.DATE||U===J.DTP.TIMESTAMP){c.f=d.include?J.FN.BETWEEN:J.FN.NOT_BETWEEN;}}}if(!(mstrApp.isOIVM&&mstrApp.isOIVM()||d.iifp)){c.supportScrollbar=true;}return c;},isValidSelection:function O(){var U=this.node.data,S=this.model;return !S.isSelWarnFlagOn(this.k)||(U.cs&&U.cs.length);},isSelectAll:function C(){var Z=this.children&&this.children[0];if(Z===undefined){return true;}var U=R.datetime.DATEOUTPUTFORMAT,W=R.datetime.TIMEOUTPUTFORMAT,X=E.parseDateAndOrTime;var S=X.call(E,Z.min,U,W),a=X.call(E,Z.fromBox.fromPicker.value),b=E.compareDate(a&&a.date,S&&S.date);if(b>0){return false;}if(b===0){if(E.compareTime(a&&a.time,S&&S.time)>0){return false;}}var c=X.call(E,Z.max,U,W),Y=X.call(E,Z.toBox.toPicker.value),V=E.compareDate(Y&&Y.date,c&&c.date);if(V<0){return false;}if(V===0){if(E.compareTime(Y&&Y.time,c&&c.time)<0){return false;}}return true;},isFilterNothing:function G(){return this.isSelectAll();}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.array","mstrmojo.elementHelper");var I=mstrmojo.array,F=mstrmojo.DocSelector.ELEM_ALL_ID,H=mstrmojo.elementHelper;var C=0,K=1,J=2;var B=1,M=3;function A(O){I.forEach(O,function(P){P.n=P.v;});return O;}mstrmojo.TextBoxDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.TextBoxDocSelector",_ieformatHandlers:{domNode:["font","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["font","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},_fetchOnInit4UCOnDS:function G(){},_getSelectionCount:function L(P){var O=P.items;return O?O.length:0;},_buildEvent:function D(R,Q){var O=[],P=this.defn;I.forEach(Q.items,function(S){O.push(S.v);});if(O.length>0||P.nsb===C){R.eid=O.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}else{R.eid="";}if(P.sec){this.parent.set("count",H.buildElemsCountStrByNum(O.length,0));}},updateWidget:function N(Q){var R=this._super(Q),O=Q.node,P=O.data;R.items=P.vs?A(P.vs.concat()):[];return R;},getWidgetConfig:function E(V,R,Q,U){var P=V.getFormats(),S=V.node.data,O=this._super(V,R,Q,U);O={scriptClass:O.scriptClass,cssText:P.height?"height: "+P.height:"",emptyText:mstrmojo.desc(4325,"Search")+" "+(Q.ttl||""),items:S.vs?A(S.vs.concat()):[],srcid:Q.srcid||"",dsrc:Q.dsrc||"",onitemsChange:function(){if(!V._inSyncPhase){V.selectorControlChange(this);}}};if(!Q.multi){O.maxObjectCount=1;}return O;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.fe.FilterUtils","mstrmojo.func","mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.DocDataService");var V=mstrmojo.fe.FilterUtils,M=mstrmojo.array,O=mstrmojo.hash,R=mstrmojo.func,Q=mstrmojo.expr;var K="LEVEL_NUMBER",G=mstrmojo.DocDataService.SUPPRESS_DATA;var H=16,L=1;function C(X){return X.t===47&&X.st===12033;}function B(){return{type:parseInt(this.type,10),src:this.k,ck:this.ck,ctlKey:this.ckey,ckey:this.ckey,tks:this.tks};}mstrmojo.DynamicListDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.DynamicListDocSelector",_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P","height"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},_buildEvent:function J(a,Z){var Y=this.node,b=this.getAttrInfo(),X;X=Z.buildSelectionExprJSON(b);Y.defn.set("cek",{expr:X,disablePU:true});a.expr=V.getExprXml(X);if(this.incFetch){a.prKey=this.k;}},initControlInfo:function F(){var X=this.node.data;this._super();O.copy({incFetch:X.inc!==false,levelForms:X.lvfs||[]},this);},getCekEvtListener:function W(Y,X){return function(Z){var a=Z.value;if(a.hasOwnProperty("expr")){Y.expr=a.expr;if(!a.disablePU){Y.handleActionInSyncPhase(function(){X.setSelectionByExprJSON(a.expr);X.refresh();});}}};},updateWidget:function P(b){var c=this._super(b),X=b.getAttrInfo(),Z=b.node,a=Z.data,Y=Z.defn;c.updateItems(a.elms,a.p_relation);if(b.lockSelection){c.setSelectionByExprJSON(b.expr);}else{if(a.unset){c.setSelectionByExprJSON();}else{if(a.exp){c.setSelectionByExprJSON(a.exp);}else{if(a.ces){c.setSelectionByList(a.ces,Y.include);}}}b.expr=c.buildSelectionExprJSON(this.getAttrInfo());}c.browseFlags=H+(C(X)?0:L);return c;},clearSelector:function S(Y){var X=B.call(this);this.node.defn.set("cek",{expr:null});X.unset=true;X[Y?"forceApply":"forceBuffer"]=true;this.slice(X);},getWidgetConfig:function E(c,Z,Y,a){var b=c.levelForms,X=this._super(c,Z,Y,a);if(b.length>0){X.getMaxLevel=function(){return c.getMaxLevel();};X.getLevels=function(){return c.getLevels();};}X.getLevelExpression=function(e){var d=c.getAttrInfo();return c.getLevelExpression(d,e);};X.delegateExpandCollapse=function(d,e){return c.onExpandCollapse(d,e,!c.incFetch);};return X;},onExpandCollapse:function U(c,j,X){var h=this,Z=this.isInFilterPanel()&&this.getFilterPanel(),a=this.node,g=a.defn,e=this.model,Y=e.getDataService(),d=[Y.getRASelectorExpandAction({ck:g.ck,ckey:g.ckey,elementId:c.elementId,isExpand:c.isExpand?1:0})],f=X?j:R.wrapMethods({success:function(l){var k;if(Z){k=Z.getBufferedSlice(g.ckey);}h.lockSelection=true;e.partialUpdate(l.data,e.getTargetDefn(a.k));h.lockSelection=false;if(Z&&k){Z.bufferSlice(k);}}},j),b=X?G:{};e.controller.cmdMgr.execute({execute:function(){this.submit(d,f,b);},urInfo:{extraPuKeys:g.ck.split("\u001E").slice(1),treesToRender:3}});return !X;},getMaxLevel:function A(){var X=0;M.forEach(this.levelForms,function(Y){if(Y.lv>0){X=Math.max(X,Y.lv);}});return X;},getLevels:function D(){return M.map(this.levelForms,function(X){return{v:X.lv,n:X.lvfn};});},getLevelExpression:function I(Y,Z){var X=(Y.fs||[]).filter(function(a){return(a.n||a.fnm)===K;})[0];if(X&&parseInt(Z,10)>=0){return{et:Q.ET.AQ,fn:Q.FN.EQUAL,a:O.copyProps(["did","n","t","st"],Y),fm:{did:X.did||X.fid,n:K,dtp:Q.DTP.INTEGER},cs:[{v:Z,dtp:Q.DTP.INTEGER}]};}return null;},getAttrInfo:function N(X){var a=this.node.defn,Z=this.model.datasets,Y;X=X||a.srcid;O.forEach(Z,function(c){Y=c.att.filter(function(d){return d.did===X;})[0];if(Y){return false;}});if(Y&&C(Y)){var b=this.getAttrInfo(Y.attId);Y.fs=b.fs;Y.lvfs=b.lvfs;}return Y?Y:{};}});}());(function(){mstrmojo.requiresCls("mstrmojo.models.FormatModel","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.DocSelector");var C=3;var B=mstrmojo.ui.editors.controls.CharacterGroup.CTRL_FLAGS,E=mstrmojo.models.FormatModel,M=E.getFormatUpdate,H=E.ENUM_PROPERTY_NAMES,G="#DBDBDC";function D(Q,O,P,N){return this.getLabelAndControl(Q,this.getPulldown(O,P,N||0));}function J(O){var P=O.k,N=O.parent;return{success:function(){var Q=N.getUnitByKey(P);N.selectVIUnit(N.rebuildChild(Q),true);}};}function I(V){var W=this,S=this.getHost(),Q=S.parent,U=S.model,X=S.defn,a=[],Z=S.getSelectorStyleList(),Y=X.ssc,P;if(!S.isRecursiveAttributeSelector()){a.push(D.call(this,mstrmojo.desc(3059,"Style:"),Z,function(b){U.changeFilterStyle(S,b);},Z.map(function(b){return b.v;}).indexOf(X.style)));}a.push(this.getCharacterGroup(this.getChangeGroupPropertyFn(1),this.getHost().getFormats()||{},B.FONT_FAMILY+B.FONT_SIZE_AND_COLOR+B.FONT_STYLE_NO_STRIKEOUT));if(S.supportSelectionColor()){if(S.content&&S.content.getPropertyDefaultValue){P=S.content.getPropertyDefaultValue(H.SELECTOR_SELECTION_COLOR);}if(!P){P=G;}a.push(this.getLabelAndControl(mstrmojo.desc(14057,"Selection:"),new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:true,selectedValue:Y!==undefined?E.decodeValue(H.SELECTOR_SELECTION_COLOR,Y):P,postselectedValueChange:function(b){U.changeUnitFormatProperty(Q,[{formatType:1,propertyName:H.SELECTOR_SELECTION_COLOR,newValue:b.value,oldValue:b.valueWas}]);}})));}if(S.allowsOrientationChange()){a.push(this.getButtonBar([{n:mstrmojo.desc(4604,"Auto"),v:-1},{n:mstrmojo.desc(12286,"Horizontal"),v:1},{n:mstrmojo.desc(12285,"Vertical"),v:0}],X.ob?(X.horiz?1:2):0,function(d){var f=d.v,e=Q.domNode,c=f===-1,g=(c?(e.offsetWidth>e.offsetHeight):f)?1:0;Q.set("orientation",g?"h":"v");X.ob=c?0:1;var b=M(H.CONTROL_ORIENTATION_BEHAVIOR,c?0:1);M(H.CONTROL_ORIENTATION,g?1:0,b);U.submitUndoRedoFormatChange(Q,{1:b},null,null,mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION);},{showIcon:false}));}if(S.supportsInclude()){a.push(D.call(this,mstrmojo.desc(2707,"Mode:"),[{n:mstrmojo.desc(3945,"Include"),v:true},{n:mstrmojo.desc(3946,"Exclude"),v:false}],function(b){S.set("include",b);},S.include?0:1));}if(S.allowsTogglingMultiSelect()){a.push(this.getCheckboxAndLabel(S.multi,mstrmojo.desc(4742,"Allow multiple selections"),function(c,b){U.submitUndoRedoFormatChange(Q,{1:M(H.CONTROL_MULTISELECT,c)},null,{success:function(){var e=U.getUnitDefinitions(S.k)[S.k];e.multi=c;var d=mstrmojo.all[Q.id];Q.parent.selectVIUnit(Q.parent.rebuildChild(d),true);}},mstrmojo.DocDataService.SUPPRESS_DATA);}));}if(S.allowsTogglingAutoSearch()){a.push(this.getCheckboxAndLabel(S.iase,mstrmojo.desc(15913,"Allow Instant Search"),function(c,b){U.submitUndoRedoFormatChange(Q,{1:M(H.CONTROL_AUTOSEARCH,c)},null,{success:function(){var e=U.getUnitDefinitions(S.k)[S.k];e.iase=c;var d=mstrmojo.all[Q.id];Q.parent.selectVIUnit(Q.parent.rebuildChild(d),true);}},mstrmojo.DocDataService.SUPPRESS_DATA);}));}if(S.allowsSameSizeItems()){var O=this.getCheckboxAndLabel(X.iwm===0,mstrmojo.desc(4782,"Make all items the same width"),function(b){U.submitUndoRedoFormatChange(Q,{1:M(H.CONTROL_ITEM_WIDTH_MODE,b?0:1)},null,{success:function(){var d=U.getUnitDefinitions(S.k)[S.k];d.iwm=b?0:1;U.itemsFitContent=d.iwm;var c=mstrmojo.all[Q.id];Q.parent.selectVIUnit(Q.parent.rebuildChild(c),true);}},mstrmojo.DocDataService.SUPPRESS_DATA);});U.itemsFitContent=!O.children[0].checked;a.push(O);}if(S.supportsShowAllToggle()&&!S.isAttrQualSelector()&&!S.isRecursiveAttributeSelector()&&!S.isSearchBox()&&S.include){var R=X.showall;a.push(this.getCheckboxAndLabel(R,mstrmojo.desc(4741,"Show option for all"),function(b){U.submitSelectorPropsChange(Q,{showAll:!!b},J(Q));}));if(R){var N=this.getLabelAndControl(mstrmojo.desc(4851,"Alias:"),new mstrmojo.TextBox({value:X.allStr||"",valueChangeDelay:500,onvalueChange:function(){X.allStr=this.value;U.submitSelectorPropsChange(Q,{allAlias:this.value},J(Q));}}),"53px","100%");N.getLabel().cssText="text-align:right;";a.push(N);}}this.replaceChildControls(V,[this.getEditorGroup(a,{showDivider:false})]);}mstrmojo.vi.models.editors.FilterEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.FilterEditorModel",help:"format_panel_filter.htm",getInitialTarget:function A(N){return[mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE,C].indexOf(N)>-1?N:mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE;},getTargetPulldownItems:function K(N){var P=this._super(N),O=this.getHost();if(!(O&&O.isInvalid)){P.push({n:mstrmojo.desc(6189,"Filter"),v:C,h:I.bind(this,N)});P.reverse();}return P;},getTitleFormatCode:function L(){return 5;},getEditorContents:function F(N){return mstrApp.allowWebDashboardDesign()?this._super(N):[];}});mstrmojo.vi.models.editors.FilterEditorModel.SELECTOR_VALUE=C;}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.UnitContainer","mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu","mstrmojo.vi.ui.TargetSelector","mstrmojo.vi.ui.FilterBoxInlineDialog","mstrmojo.Label","mstrmojo.dom","mstrmojo.css","mstrmojo.func","mstrmojo.hash","mstrmojo.tooltip","mstrmojo.DocSelector","mstrmojo.vi.ui._HasMask","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.vi.models.EnumDragSources","mstrmojo.models.FormatModel","mstrmojo.EnumRWUnitType");var I=mstrmojo.css,W=mstrmojo.dom,AC=mstrmojo.func,AE=mstrmojo.string,Y=mstrmojo.hash,D="\u001E",v=mstrmojo.EnumRWUnitType,u=mstrmojo.models.FormatModel,w=u.getFormatUpdate,q=u.ENUM_PROPERTY_NAMES,U=mstrmojo.DocSelector.STYLES,Z=mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY;function M(AJ){return AJ&&AJ.did!=="-1"&&AJ.t!==14;}function S(AJ){var AK=AJ.getCtxtDragData();return(AK.items||[]).filter(M)[0];}function E(AK){var AL=AK.getCtxtDragData(),AJ=AL.items||[];return AL.src&&AJ.some(M);}function AG(){return !!this.boxContent.defn.srcid;}function L(){var AK=this.boxContent.defn.srcid,AJ=this.model.getDatasetUnits(["att","mx"],function(AL){return AL.did===AK;});return(AJ.length&&AJ[0])||null;}function P(){var AJ=this;this.showControlOverlay([mstrmojo.Button.newWebButton(mstrmojo.desc(1088,"Edit"),function(){var AK=AJ.boxContent;if(AK&&AK.expandOrEditToFetchElements){AK.expandOrEditToFetchElements();}AJ.hideControlOverlay();},false,{alias:"ctrlEditBtn",enabled:true,cssClass:"filterBoxEdit"})]);I.toggleClass(this.ctrlOverlay&&this.ctrlOverlay.domNode,"editOverLay",true);}function J(){var AJ=this,AK=mstrmojo.Button.newWebButton(mstrmojo.desc(4799,"Select Target"),function(AL){var AM=mstrmojo.all[AJ.id];mstrApp.rootCtrl.view.openInlineDialog(AF(AM));AL.cancel();},true,{alias:"btnSelect"});AK.cssClass+=" btn-select-targets";this.showControlOverlay([AK]);this.setSelectTargetsState(true);}function R(){var AJ=this.boxContent;if(AJ.isInvalid){this.showInvalidMessage();return ;}if(!AG.call(this)||(mstrApp&&(mstrApp.isAppStatePresentation()||mstrApp.isAppStatePrintPreview()))){return ;}if(this.getTargetKeys().length>0){if(Y.walk("boxContent.node.data.disabled",this)){P.call(this);}else{this.hideControlOverlay();}return ;}J.call(this);}function g(){return !this.defn.ob;}function AI(AJ){this.set("useRichTooltip",AJ);}function V(){I.toggleClass(this.domNode,"horizontal",!!this.defn.horiz);}function AF(AJ){return{scriptClass:"mstrmojo.vi.ui.FilterBoxInlineDialog",vis:AJ};}mstrmojo.vi.ui.rw.FilterBox=mstrmojo.declare(mstrmojo.vi.ui.rw.UnitContainer,[mstrmojo.vi.ui.rw.selectors._HasFilterContextMenu,mstrmojo.vi.ui._CanDropFromSchema,mstrmojo.vi.ui._HasMask],{scriptClass:"mstrmojo.vi.ui.rw.FilterBox",targetSelector:null,useRichTooltip:true,isDynamicTooltip:true,tooltipOpenDelay:Z,maskTooltip:mstrmojo.desc(15274,"Selector cannot be selected as target"),allowFilters:true,markupMethods:Y.mergeHashes(mstrmojo.vi.ui.rw.UnitContainer.prototype.markupMethods,{onenabledChange:function(){I.toggleClass(this.domNode,"inactive",!this.enabled);this.targetMask.set("useRichTooltip",!this.enabled);}}),init:function AD(AJ){this._super(AJ);I.addWidgetCssClass(this,"mstrmojo-FilterBox");},onclick:function p(AJ){var AN=W.isPrimaryMouseBtn(AJ.e),AK=AG.call(this),AM=W.contains(this.containerNode,AJ.getTarget(),true,this.domNode),AL;if(AN&&AK){if(AM){AL=true;AJ.e.ptvSelected=true;}else{if(!W.contains(this.titlebarNode,AJ.getTarget(),true,this.domNode)){AJ.e.ptvSelected=true;}}}this._super(AJ);if(AL){this.getEditorModel().selectTargetByValue(mstrmojo.vi.models.editors.FilterEditorModel.SELECTOR_VALUE);}},moveTooltip:function c(AJ,AL){var AK=W.findWidget(AJ.target);if(AK.id!==this.boxContent.id){return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:this.getTooltipContent(),top:AJ.clientY+15,left:AJ.clientX-15};this._super(AJ,AL);},getTooltipContent:function AH(){var AM=L.call(this),AL=AM&&AM.n,AJ=this.getDisplayName(),AK=(AJ!==AL);return('<div class="name">'+AJ+"</div>"+(AK?('<div class="dsc">'+AE.encodeHtmlString(mstrmojo.desc(15112,"Name in Dataset:")+" "+AL,true)+"</div>"):""));},setSelectTargetsState:function h(AJ){var AK=(this.ctrlOverlay||{}).btnSelect;if(AK){AK.set("enabled",AJ);AK.set("visible",AJ);}},postBuildRendering:function d(){V.call(this);this._super();this.generateToolbar();var AJ=this.boxContent;if(!AG.call(this)){this.setSelectTargetsState(false);AJ.set("visible",false);this.showControlOverlay([{scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:mstrmojo.desc(13258,"Drag object here.")}]);}else{if(AJ&&AJ.isInvalid){this.showInvalidMessage();}else{if(!this.getTargetKeys().length&&!mstrApp.isAppStatePresentation()){J.call(this);}else{if(Y.walk("node.data.disabled",AJ)){P.call(this);}}}}var AK=L.call(this);this.set("title",(AK&&AK.n)||"");if(this.model){I.toggleClass(this.domNode,"items-fit-content",this.model.itemsFitContent);}},showInvalidMessage:function O(){this.showControlOverlay([{scriptClass:"mstrmojo.Label",cssClass:"invalidMsg",text:this.boxContent.getInvalidTooltip()}]);},onRender:function G(){if(this._super){this._super();}AI.call(this,!this.showTitleBar);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()&&this.model&&this.model.hasRADataset()){this.set("isMasked",true);}},orientationHasChanged:function m(){if(g.call(this)){var AJ=this.orientation,AM=AJ==="h",AL=this.boxContent,AK=AL.content;this.defn.horiz=AM;if(AL.isRecursiveAttributeSelector()&&AK.isHoriz!==AM){this.rebuildBoxContent(AL.node);this.doLayout();}else{AK.isHoriz=AM;AK.set("orientation",AJ);}V.call(this);}},addFormatProps:function x(AL,AK){AL=this._super(AL,AK);var AJ=this.orientation;if(this.boxContent.content.orientation!==AJ&&g.call(this)){AL=AL||this.model.getUnitFormatAction(this,NaN,null,AK);mstrmojo.models.FormatModel.getFormatUpdate(mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES.CONTROL_ORIENTATION,AJ==="v"?0:1,AL.format);this.defn.horiz=AJ==="h";if(!AK){window.setTimeout(function(){this.parent.rebuildChild(this);}.bind(this),0);}}return AL;},createDeleteUpdate:function o(){var AJ=this.model,AK=AJ.getRemoveControlUpdate(this.k,this.parent.k,this.defn.tks||"");if(this.defn.tks&&this.boxContent.isFilterNothing&&!this.boxContent.isFilterNothing()){AK.setTreesToRender(3);}AK.addUpdate(AJ.associatedNodesUpdate(this.parent.children));return AK;},updateToolbar:function s(AJ){R.call(this);var AK=this.boxContent;if(this.canShowDesignMenuItems()&&AK&&AG.call(this)){this.addModeMenuItems(AJ,AK);AJ.addSeparator();this.addClearFilterMenuItem(AJ,AK);AJ.addSeparator();this.addQualMenuItems(AJ,AK);this.addSetDisplayFormsMenuItem(AJ,AK);AJ.addSeparator();this.addFilterStyleMenuItem(AJ,AK);this.addMultiSelectMenuItem(AJ,AK);this.addAutoSearchMenuItem(AJ,AK);AJ.addSeparator();this.addMenuItemIfSelectTargetsValid(AJ,AK,mstrmojo.desc(12288,"Target the following visualizations or filters:"));AJ.addSeparator();this.addToggleTitleMenuItem(AJ);AJ.addSeparator();this.addReplaceWithMenuItem(AJ,AK);}return this._super(AJ);},showControlOverlay:function n(AK,AJ){this._super(AK,AJ);I.addClass(this.domNode,"overlay");},hideControlOverlay:function C(){this._super();I.removeClass(this.domNode,"overlay");},onAppStateChange:function r(AJ){var AM=mstrmojo.vi.VisualInsightApp.APP_STATES,AK=mstrApp.isAppStatePause(),AL=!!(AJ.valueWas&AM.PAUSE);if(AK!==AL){if(this.model.hasRADataset()){this.set("isMasked",AK);}}if(this._super){this._super(AJ);}},addContextMenuItems:function AA(AL,AK){this._super(AL,AK);var AJ=this.boxContent;if(AG.call(this)&&!(AJ&&AJ.isInvalid)){this.addMenuItemIfSelectTargetsValid(AL,AJ,mstrmojo.desc(12288,"Target the following visualizations or filters:"),false);}if(AJ&&AJ.isInvalid){this.addDeleteMenuItem(AL);}return AL;},getFormatMenuItemTarget:function H(AJ){if(!AJ||!W.contains(this.titlebarNode,AJ.getTarget(),true,this.domNode)){return mstrmojo.vi.models.editors.FilterEditorModel.SELECTOR_VALUE;}return this._super(AJ);},getTargetInfo:function b(){var AN=this.parent,AL=this.model,AJ=this.boxContent,AM=[v.GRID,v.GRAPH,v.MOJOVISUALIZATION].concat(AL.isFromSolrCube(AJ.defn.srcid)?[]:[v.SELECTOR]),AK=AN&&AN.getTargetKeysByType(AM).map(function(AO){var AQ=AN.getUnitByKey(AO),AP=AQ.defn;return{n:AQ.getDisplayName(),id:AO,st:AP.style,src:AL.getObjectInfo(AP.srcid)};}).filter(function(AO){return AO.id!==this.k&&AO.st!==U.ATTR_QUAL;},this)||[];return{keys:this.getTargetKeys(),items:AK};},toggleTitleBar:function f(AJ){this._super(AJ);AI.call(this,!AJ);},getDisplayName:function F(){return this._super()||mstrmojo.desc(6189,"Filter");},updateDisplayName:function K(AJ,AK){this._super(AJ,AK,true);},getAvatarCls:function t(){return this._super().concat(["filterAvatar"]);},allowDropFromDataset:function e(AJ){return !AG.call(this)&&E.call(this,AJ)&&mstrApp.allowWebDashboardDesign();},dropFromDataSource:function AB(AL){var AZ=S.call(this,AL),AV=this.id,Ab,AU,AT;if(AZ){var AM=this.getDocModel(),AX=AM.getDataService(),AN=this.defn,AK=this.getTargetKeys(),AY=[this.k].concat(AK),AJ=this.boxContent,AS=Y.valarray(AN.cgb).map(function(Ac){return[Ac,true];}),AR=(AL.actions||[]).concat([AX.getSetCtrlSourceAction(AN.ck,AZ.did,AZ.t,AS)]),AO=AC.wrapMethods(AL.callback,{success:function(Ac){var Ad=mstrmojo.all[AV];AM.partialUpdate(Ac.data,AM.getTargetDefn(AY.join(D)),Ac.defn,[AJ.defn.ckey]);if(!(mstrApp.isAppStatePause&&mstrApp.isAppStatePause())){Ad=Ad.parent.rebuildChild(Ad);}Ad.boxContent.set("visible",true);Ad.generateToolbar();}});Ab=AM.getCtrlStyleFromDatasetUnit(AZ);AR=AR.concat(AM.getCtrlActionsByStyle(AZ,AJ.ck,Ab,this.orientation==="v"?0:1,parseInt(this.height,10),parseInt(this.width,10)));AT=this.height;AU=0;if(AZ.t===4){AR.push(AM.getUnitFormatAction(this,5,w(q.SHOW_TITLE_BAR,true)));if(AT==="40px"){AU=20;}}if(this.orientation==="h"){var AW=this.parent,Aa=AW.boxLayoutConfig,AQ=Aa.box,AP=AQ&&AQ.children&&AQ.children[Aa.getBoxPath(this)];AU=AU+AM.getICSCtrlMoveHeightByStyle(Ab);if(AP&&AP.f){AP.l=AP.l+AU;AR=AR.concat(AW.getChildPositionActions(true));AR=AR.concat(AW.getBoxLayoutActions(true));}}AM.submitDataDefnUpdate(AR,AO);}},dropFromDataset:function X(AJ){this.dropFromDataSource(AJ);},dropFromAllObjects:function z(AJ){this.augmentDropContextForSchema(AJ,this.getDocModel());this.dropFromDataSource(AJ);},validateTarget:function B(AJ){return true;},setTargets:function j(AJ){this.getDocModel().changeFilterTargets(this,this.getTargetKeys(),AJ,true,true);},getTargetKeys:function A(){var AJ=this.defn.tks;return(AJ&&AJ.split(D))||[];},isSelectionDirty:function Q(AJ){return AJ.length;},getTitleBarCfg:function N(){var AJ=this._super(),AK=this;AJ.titleEdited=function AL(AN,AR,AM){var AQ=this.parent,AT={success:function AS(AU){AQ.defn.ttl=AU;AQ.set("title",AU);},failure:function AP(AU){mstrApp.onerror(AU);AQ.titleBar.set("title",AM);}};if(AR){var AO=AQ.getDocModel();AO.updateTitle(AN,this.title,AQ.k,AO.currlaykey,"ttl",AT);}AQ.editingTitleCallback(false);};AJ.getTooltipContent=function(){return AK.getTooltipContent();};AJ.shouldShowTooltip=function(){return true;};AJ.tooltipOpenDelay=Z;return AJ;},applyCSSFormatToNode:function l(AK,AJ){var AM=this.boxContent;if(AM&&AM.content&&AM.content.hasRendered){var AL=AM._inSyncPhase;AM._inSyncPhase=true;AM.content.refresh();AM._inSyncPhase=AL;}this._super(AK,AJ);},getBoxConfiguration:function a(){var AJ=this._super();if(this.showTitleBar){AJ=mstrmojo.hash.clone(AJ);AJ.f.v+=20;}return AJ;},cancel:function k(){this.refresh();},});mstrmojo.vi.ui.rw.FilterBox.boxConfiguration={f:{h:150,v:42},o:"v"};}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.Button","mstrmojo.form");var V=8,P=16,W=4,S=1,K=2,D=4,R=8,B=16,N=268435456,J=536870912,A=1073741824,I=window.mstrConfig&&!window.mstrConfig.simpleDialog,M=2147755235,L=2147755236;var C="mstrmojo-oivmSprite ";function E(a,Z,Y){if(I){mstrmojo.confirm(a,{confirmBtn:{fn:Z},cancelBtn:{fn:Y}});}else{if(mstrmojo.confirm(a)){if(Z){Z();}}else{if(Y){Y();}}}}function X(Z,Y){if(I){mstrmojo.alert(Z,Y,null,null,null,{allowHTML:true});}else{mstrmojo.alert(Z);Y();}}function O(Y){var Z=mstrmojo.findAncestor(this,"scriptClass","mstrmojo.DocInfoWindow");if(!!Z){Z[Y?"registerLock":"releaseLock"](this);}}mstrmojo._DocActionSelector=mstrmojo.provide("mstrmojo._DocActionSelector",{_mixinName:"mstrmojo._DocActionSelector",extCls:"mstrmojo-ActionSelector",type:V,targets:null,initControlInfo:function G(){var Y=this.node.defn;this.aa=parseInt(Y.aa,10);this.dpTxt=Y.dpTxt||{8:mstrmojo.desc(5369),4:mstrmojo.desc(8233),16:mstrmojo.desc(8232)}[this.aa]||"";this.dpCfm=Y.dpCfm;this.sac=parseInt(Y.sac,10);this.msg=Y.msg;this.rsid=Y.rsid;this.rst=Y.rst;this.node.data.elms=[{n:this.dpTxt,v:this.dpTxt}];if(this._super){this._super();}},selectorControlChange:function(Y){if(Y.selectedIndex!==0){return ;}this.executeAction();Y.select([]);},executeAction:function(){var Z=this.aa,Y=this,a=function(){O.call(Y,false);};O.call(Y,true);if(Z===V){if(this.dpCfm){E(mstrmojo.desc(8313),function(){Y.onCommit();},a);}else{Y.onCommit();}}else{if(Z===W){if(this.dpCfm){E(mstrmojo.desc(8322),function(){Y.onDiscard();},a);}else{Y.onDiscard();}}else{this.onRecalculate();}}},postBuildRendering:function(){this._super();this.domNode.ontouchstart=function(Y){mstrmojo.css.addClass(Y.target,"glow");};this.domNode.ontouchend=function(Y){mstrmojo.css.removeClass(Y.target,"glow");};},onCommit:function(){var b=this,c=this.model,Z=b.controller,Y=mstrApp.useBinaryFormat;O.call(this,false);if(!this.checkValidationStatus()){X(mstrmojo.desc(9205));return ;}if(!Y&&!this.validateRequiredObjects()){X(mstrmojo.desc(9200));return ;}var a=function(d){if((b.sac&J)>0){Z.invalidClientCache();}if((b.sac&B)>0){var e={did:b.rsid,objType:b.rst,forceExec:(b.sac&N)>0};if((b.sac&A)>0){e.linkAnswers='<hl mid="'+c.mid+'" srct="2" aopam="1"><prms></prms></hl>';}Z.onExecuteNewObject(b,e);}else{if((b.sac&R)>0){Z.onReExecute(b);}else{if(mstrApp.isMobile){Z.generateActionToolbar();}c.transactionUpdate(d);}}};mstrmojo.mask.show("Running");c.sendTransactionActions(this.ck,V,c.newCallback({success:function(d){mstrmojo.mask.hide();if(c.txrcd||d.offln){Z.offlineTransactionsSubmitted(b.ck);}if(d.offln){if(Y&&!b.networkToastShowed){b.networkToastShowed=true;mstrmojo.toast(mstrmojo.desc(9258,"No Network Connectivity")+". "+mstrmojo.desc(9259,"Transaction will be submitted when connectivity is resumed."));}c.transactionUpdate(d);}else{if((b.sac&S)>0&&b.msg){if(Y){mstrmojo.toast(b.msg);window.setTimeout(function(){a(d);},100);}else{X(b.msg,function(){a(d);});}}else{a(d);}}},failure:function(f){var d=mstrmojo.all.mojoAlertx9;if(d){d.destroy();}mstrmojo.mask.hide();if(c.txrcd){Z.offlineTransactionsSubmitted(b.ck);}var e=4294967296+parseInt(f.code,10);if(e===M){if(Y){b.validateRequiredObjects();}X(mstrmojo.desc(9200,"You have some required inputs that are not modified."));}else{if(e===L){var g=mstrmojo.desc(9201,"You haven't made any changes to submit.");if(Y){mstrmojo.toast(g);}else{X(g);}}else{X(mstrmojo.base64.decodeHttpHeader(f.message),function(){if(!Y){b.controller.onReExecute(b,true);}});}}}}));},onDiscard:function F(){var Z=this,a=this.model,Y=Z.controller;O.call(this,false);a.txDiscardTargets=this.getTxTargets();a.sendTransactionActions(this.ck,W,{success:function(b){a.transactionUpdate(b);Y.transactionDiscarded(Z.ck);},complete:function(){delete a.txDiscardTargets;if(mstrApp.isMobile){Y.generateActionToolbar();}}});},onRecalculate:function(){O.call(this,false);this.model.sendTransactionActions(this.ck,P);},getTxTargets:function U(){var e=this.tks.split("\u001E"),d,Y,c,f,Z,a,b={};for(d=0,Y=e.length;d<Y;d++){c=e[d];f=1;do{Z=this.model.getUnitInstance(c,f++);if(Z&&Z.checkRequiredObjects){if(Z.isPanelStack){for(a in Z.txWidgets){b[Z.txWidgets[a].id]=1;}}else{b[Z.id]=1;}}else{break;}}while(true);}return b;},validateRequiredObjects:function Q(){var Y=true,Z;for(Z in this.getTxTargets()){Y=mstrmojo.all[Z].checkRequiredObjects()&&Y;}return Y;},checkValidationStatus:function H(){var Y;for(Y in this.getTxTargets()){if(mstrmojo.all[Y].checkValidationStatus&&!mstrmojo.all[Y].checkValidationStatus()){return false;}}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.ui._IsViPanel","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.vi.ui._HasMask","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.DocSelector","mstrmojo.vi.ui.toolbars.TitleToolbar");var C=mstrmojo.DocSelector.STYLES;function I(){var P=this.unit;if(P){var O=mstrmojo.all[P.id];this.removeChildren(O);O.destroy();this.set("unit",null);}}mstrmojo.vi.ui.PageByPanel=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.vi.ui._IsViPanel,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.PageByPanel",markupString:'<div id="{@id}" class="mstrmojo-VIPageByStack" style="{@cssText}"><div class="mstrmojo-VIPageByStack-Values horizontal"></div><div class="mstrmojo-VIPageByStack-Toolbar"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;},toolbarNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onunitChange:function(){if(this.hasRendered){this.generateToolbar();this.doLayout();this.pageByStack.doLayout();}}},layoutConfig:{h:{toolbarNode:"100%",containerNode:"100%",maskNode:"100%"},w:{toolbarNode:"auto",containerNode:"all",maskNode:"all"},xt:true},unit:null,parent:null,pageByStack:null,useRichTooltip:true,isDynamicTooltip:true,getLayoutOffsets:function H(){return{h:2,w:2};},children:[{scriptClass:"mstrmojo.vi.ui.toolbars.TitleToolbar",alias:"toolbar",slot:"toolbarNode"}],onAppStateChange:function D(O){this._super(O);var P=mstrmojo.vi.VisualInsightApp.APP_STATES,R=O.value,Q=this.toolbarNode;this.set("isMasked",mstrApp.isAppStateSelection());if(Q){Q.style.display=mstrApp.isAppStatePresentation()?"none":"";}},onLayoutModeChange:function B(O){if(this.hasRendered){this.adjustInPreviewMode();}},preBuildRendering:function J(){var O=this.parent;this.model=O.model;this.builder=O.builder;return this._super();},adjustInPreviewMode:function E(){var Q=parseInt(this.parent.width,10)||0,P=mstrmojo.vi.ui.rw.DocRelativePanel.getLayoutBreakPoint(),O=this.domNode;if(mstrApp.isLayoutModePreview()){var R=Math.min(Q,P);this.set("width",R+"px");if(O){O.style.left=Math.max(Q-P,0)/2+"px";}}else{this.set("width",Q+"px");if(O){O.style.left="0px";}}},moveTooltip:function F(O,Q){this.richTooltip=null;var P=this.unit;if(P){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-A",content:P.n,top:O.clientY+15,left:O.clientX-15};}this._super(O,Q);},updateToolbar:function N(P){var Q=P.ENUM_CORNERS;P.setAlignment(Q.BOTTOM_RIGHT,Q.TOP_RIGHT);P.isHostedWithin=false;var U=this.unit,R=this.parent.model;if(U){var O=U.style,S=function(X,W){var V=W===O?"on":"";P.addMenuItem(X,V,function(Z){var Y=Z.ctxt.style;if(Y===O){return false;}R.changePageByStyle(mstrmojo.all[U.id],Y);return true;},{style:W});P.hasToggleItem=true;};S(mstrmojo.desc(4734,"Button Bar"),C.BUTTON);S(mstrmojo.desc(4730,"Slider"),C.SCROLLER);S(mstrmojo.desc(4729,"Drop-down"),C.PULLDOWN);P.addSeparator();P.addMenuItem(mstrmojo.desc(629,"Delete"),"cls",function(){mstrmojo.warn(mstrmojo.desc(13245,"This action will permanently delete the page-by panel. A new one can be created by inserting a new filter. Do you want to proceed?"),{confirmBtn:{t:mstrmojo.desc(1442,"OK"),fn:function(){I.call(this);this.model.removePageByUnit(this,U);}.bind(this),isHot:true},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}});}.bind(this));}return this._super(P);},widgetResized:function G(){if(this.hasRendered&&mstrApp.isLayoutModePreview()){this.adjustInPreviewMode();}},close:function L(){this.setOpenStatus(false);},setOpenStatus:function M(P,O){var R=this._super,Q=this.id;if(P&&!this.pageByStack){this.model.loadHiddenPageByStack(this.builder,function(){R.call(mstrmojo.all[Q],P,true);});}else{R.call(this,P,O);}},getPanelSaver:function(){return mstrmojo.vi.models.PanelFormatSaver.getPanelSaver(this.model,{visible:{set:"FormattingAppearance",name:"Visible"}},this.pageByStack);},setPageByStack:function A(P){var O=this.pageByStack;if(O){this.removeChildren(O);O.destroy();}if(P){P.slot="containerNode";P.alias="pageByStack";this.addChildren([P]);}},resetLayout:function K(){this.parent.buildBoxLayout(true);this.parent.doLayout();}});mstrmojo.vi.ui.PageByPanel.boxConfiguration={f:{h:32,v:45},o:"v",r:true};}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl","mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights","mstrmojo.hash","mstrmojo.array","mstrmojo.func","mstrmojo.VisUtility","mstrmojo.PerformanceLogOutput");var S=mstrmojo,J=S.hash,V=S.vi.ui.rw,H=S.VisUtility,R=V._HasVisSelections,O=V.selectors._IsMultiUnitControl,E=V.selectors._BrushesAndHighlights,U=mstrmojo.func.wrapMethods,G=S.PerformanceLogOutput;function M(Z){var X,d,b=Z.sc.exp,Y=b&&b.nds,W=Z&&Z.gts,c=Z&&Z.k,a=mstrmojo.DocXtabModel.prototype,e=J.copy(R,{k:c,model:a});if(!Z||!W||!b||!Y||Y.length<=0){return{};}X=(W.row||[]).concat(W.col||[]);H.modifyScExp(b,X,a,{});d=O.getSelectorDataFromExpression(b);e.addSelectionsFromExpression(d);return e.getSelectionHash();}mstrmojo.VisDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.VisDocSelector",postBuildRendering:function Q(){this._super();var Y=this,W=Y.model,X=Y.parent;if(X&&X.refreshFilterSummaryBar){X.refreshFilterSummaryBar();}if(W){this.clearSelectorListener=W.attachEventListener("clearSelector",this.id,function(Z){if(Z.k===Y.k){var a=this.content;if(a){a.updateSummaryText({});}}});}},onAppStateChange:function L(W){var b=mstrmojo.vi.VisualInsightApp.APP_STATES,X=b.PAUSE,Y=mstrApp.isAppStatePause&&mstrApp.isAppStatePause(),a=!!(W.valueWas&X);if(Y!==a){var Z=this.parent;if(Z){Z.updateSummaryBar();}}},getWidgetConfig:function D(c,Y,X,a){var Z=c.node&&c.node.data,b=Z&&Z.sc,W=this._super(c,Y,X,a);if(b){W.exp=b&&b.exp;W.include=b.include;}return W;},getSelectionInfo:function C(){var X,W=this.node&&this.node.data,Z=W&&W.sc,Y=Z&&Z.exp;if(Y&&Y.nds){return M(W);}X=R.getSelectionCache.call(this);return X&&X._viSelections;},updateWidget:function K(W){var X=this._super(W);if(X){X.include=this.include;if(X.updateSummaryText){X.updateSummaryText(this.getSelectionInfo());}}return X;},clearSelector:function P(e){G.startTimer({functionName:"VisFilter.unsetFilter",purpose:"from Unset filter to End"},"timerid_VisFilter_unsetFilter");var d,Z=this.parent,W=this.content,a=this.node&&this.node.data,c=a&&a.sc,X=(a&&(a.sid!==undefined))?a.sid:1,Y=this.getSelectionInfo(),b=!Y||Object.keys(Y).length===0;if(Z&&Z.closeVisSelectorPanel){Z.closeVisSelectorPanel();}if(!c||b){return ;}d={ck:c.ck,ct:c.ct,ctlKey:c.ckey,selections:[],sid:X,tks:c.tks,type:521,isNavigation:false,ignoreTargetData:true};d[e?"forceApply":"forceBuffer"]=true;c.exp=null;R.setSelectionCache.call(this,{});E.clearSelections.call(this);this.slice(d);if(W){W.updateSummaryText({});}},update:function I(X){if(mstrApp.isInVFInteractMode){var W=this.parent;if(W){W.updateVizSelectorPanel();}}this._super(X);},supportsInclude:function N(){return true;},applySelections:function A(W){W.include=this.include;this.slice(W);},initControlInfo:function F(){this._super();var W=this.node,X=W&&W.data,Y=X&&X.sc;if(Y){J.copyProps(["allselected","ckey","ck","tks","style","showall","ct","include"],Y,this);}},onincludeChange:function B(g){var Y=g.value,e=this.model,Z=this.isInFilterPanel()&&this.getFilterPanel(),d=e.getDataService().newUpdate(Z);this.include=Y;if(Z&&Z._bufferedSlices){Z.applyBufferedSlices(true,d);}var f=this,b=this.node.k,a=e.getDataService(),X=e.getSliceCallback({type:parseInt(this.type,10),src:this.k,ck:this.ck,ctlKey:this.ckey,tks:this.tks,include:this.include,changeInclude:true}),c=[a.getSelectorIncludeAction({ck:this.ck,ckey:this.ckey,type:this.type,include:Y})],h=U(X,{success:function(j){f.set("wait",false);e.partialUpdate(j.data,e.getTargetDefn(b));}});var W=this.deferredEvt;if(!!W){e.sliceDeferred(d,W);}c[0].partialRetrieval=a.newRetrievalKeysConfig().addNode(b);c=!!W?c.concat(d.actions):(d.actions||[]).concat(c);this.set("wait",true);e.controller.cmdMgr.execute({execute:function(){this.submit(c,h);},urInfo:{extraPuKeys:f.ck.split("\u001E").slice(1),treesToRender:3}});},generateSummaryText:function(W){if(this.include){return W>1?mstrmojo.desc(15291,"## data points included").replace("##",W):mstrmojo.desc(15292,"1 data point included");}else{return W>1?mstrmojo.desc(15293,"## data points excluded").replace("##",W):mstrmojo.desc(15294,"1 data point excluded");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.MetricSelectorUtility","mstrmojo.hash","mstrmojo.array","mstrmojo.expr");var G=mstrmojo.hash,L=mstrmojo.array,D=mstrmojo.DocSelector.DATAPARAMS;mstrmojo.MetricQualDocSelector=mstrmojo.declare(mstrmojo.DocSelector,null,{scriptClass:"mstrmojo.MetricQualDocSelector",_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["width","B","P","height"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},init:function P(Q){this._super(Q);this.spm=true;},initControlInfo:function O(){this._super();var R=mstrmojo.MetricSelectorUtility,U=this.node,V=U.data,S=U.defn;G.copyProps(["srcid","srct"],S,this);this.qua=V.qt;this.dt=V.dt;var Q=R.getOpIdxByfunc(V.f,V.ft);if(Q!==-1){this.include=R.getIncludeByOp(Q);}},canApply:function E(Q){return true;},onquaChange:function J(Q){this.node.data.qt=Q.value;},_buildEvent:function H(S,U){var V=[];var R=false;L.forEach(U.cs,function(a){V.push(a.v);if(S.dtp===undefined){S.dtp=a.dtp;}if(a.dtp===mstrmojo.expr.DTP.BIGDECIMAL){R=true;}});if(R){S.dtp=mstrmojo.expr.DTP.BIGDECIMAL;}if(V.length){S.cs=V.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}var Y=mstrmojo.MetricSelectorUtility.getFuncInfo(U.opId,U.qua);S.f=U.f=Y.f;S.ft=U.ft=Y.ft;S.include=this.defn.include=this.include=U.include;S.ckey=this.ckey;S.srcid=this.srcid;S.srct=this.srct;if(U.forceUnset){S.retrieveCtrlKey=true;}S.unset=U.unSet||U.forceUnset;S.onlyInclude=U.onlyInclude;if(U.changeInclude){S.changeInclude=U.changeInclude;S.forceApply=true;U.changeInclude=false;}if(U.changeQual){S.changeQual=U.changeQual;U.changeQual=false;}S.qt=U.qua;if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){var Z=this.model,W=Z.getCurrentLayoutDef(),X=W&&W.units,Q=this.k;if(X[Q]){X[Q].cesChange=true;}Z.setDataReady(this.k,this.id,D.CSREADY,true,["f","ft","cs"],[U.f,U.ft,U.cs]);}this.node.defn.set("cek",{id:this.id,f:U.f,ft:U.ft,cs:U.cs,qua:U.qua,include:U.include});},preBuildRendering:function M(){var Q=this._super();if(this.isInFilterPanel()&&!this.isHorizFP()){this.children[0].width=this.parent.parent.contentWidth;}return Q;},postBuildRendering:function B(){this._super();if(this.formatHandlers.filterNode){var Q=this.getFormats();if(!Q.height){this.updateHeight();}}},getCekEvtListener:function C(R,Q){return function(S){R.handleActionInSyncPhase(function(){R.set("qua",S.value.qua);if(R.id!==S.value.id){Q.updateExpr(S.value);if(R.style===mstrmojo.DocSelector.STYLES.METRIC_SLIDER){R.set("include",S.value.include);}}});};},updateWidget:function N(V){var W=this._super(V),R=V.node,Q=V.selIdx,U=R.data,S=U.elms;if(W.updateData){W.numFmts=V.defn.numFmts;V.handleActionInSyncPhase(function(){W.updateData({low:U.min,high:U.max,cnt:U.cnt,nov:U.nov},{cs:U.cs,f:U.f,ft:U.ft,qua:U.qt});});}W.items=S;W.selectedIndices=Q;return W;},newAndInitWidget:function K(Q){var R=this._super(Q);Q.attachEventListener("quaChange",R.id,function(S){this.set("qua",S.value);});return R;},getWidgetConfig:function I(W,U,S,V){var R=W.getFormats(),Q=this._super(W,U,S,V);G.copyProps(["height","width","font"],R,Q);G.copyProps(["cs","ft"],S,Q);Q.fmts=S.f;Q.dt=W.dt;Q.qua=W.qua;Q.numFmts=S.numFmts;return Q;},isSelectAll:function A(){var S=mstrmojo.MetricSelectorUtility.OP,R=this.children&&this.children[0],Q=R&&(S._IS_NULL===R.opId||S._IS_NOT_NULL===R.opId);return R===undefined?true:(!R.cs||R.cs.length===0)&&!Q;},isFilterNothing:function F(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.boxmodel","mstrmojo.Model","mstrmojo.VisUtility","mstrmojo.elementHelper","mstrmojo._CanProxyCallback","mstrmojo.EnumRWUnitType","mstrmojo.models.template.DataInterface","mstrmojo.StringBuffer","mstrmojo.EnumReadystate","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.viz.EnumWidgetTypes","mstrmojo.DocSelector","mstrmojo.MetricSelectorUtility","mstrmojo.UUID","mstrmojo.ExpressVisList","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.vi.models.VIComponentMap");var BA=mstrmojo.EnumRWUnitType,P=mstrmojo.EnumReadystate,a=mstrmojo.hash,BT=a.forEach,BR=mstrmojo.func.wrapMethods,BM=mstrmojo.Obj.free,R=mstrmojo.array,Ac=mstrmojo.boxmodel,D=mstrmojo.mixin,Ax=mstrmojo.VisUtility,k=mstrmojo.elementHelper,BO=mstrmojo.MetricSelectorUtility,AW=mstrmojo.UUID,As=mstrmojo.vi.viz.EnumVizStyles,Bb=mstrmojo.vi.viz.EnumWidgetTypes,C=mstrmojo.DocSelector.DATAPARAMS,m="\u001E";var H={},c={},BX="76CB9F3E366345DF89811386CBAA82CB",Ap=mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_STYLE.DEFAULT,S=[11826975,1381846,1810715,950271,12407690,2276796,13614615,8355711,15255470,9869567,9101208,7912447,14004421,9296859,15063710,13092807],K=mstrmojo.vi.models.VIComponentMap.TYPES.FILTER_STACK,Ad={ESRIMapVisualizationStyle:"com.microstrategy.web.vf.viewer.EsriMapApplicationViewer",GoogleMapVisualizationStyle:"com.microstrategy.web.vf.viewer.GoogleMapApplicationViewer",MapboxVisualizationStyle:"com.microstrategy.web.vf.viewer.MapboxApplicationViewer",KPICardVisualizationStyle:"com.microstrategy.web.vf.viewer.KPICardApplicationViewer"},q="com.microstrategy.web.vf.viewer.CustomVisApplicationViewer";mstrmojo.MultiRWUnitFormatEventsType=null;var Ae={isObservable:function(Bf){var Be=Bf&&Bf.t;if((!Be&&Be!==BA.LAYOUT)||!this.hasOwnProperty(Be)||Bf.scriptClass){return false;}return(Be!==BA.SUBSECTION||!Bf.dt);},makeObservable:function(Be){var Bf=Be.audibles=this[Be.t]||{};if(Bf.hasOwnProperty("readyState")){Be.readyState=P.IDLE;}return new mstrmojo.Model(Be);}};Ae[BA.PANELSTACK]={"*":false,selKey:true,readyState:true};Ae[BA.GRID]={"*":false,readyState:true,ds:true};Ae[BA.GRAPH]={"*":false,readyState:true,ds:true};Ae[BA.GRIDGRAPH]={"*":false,qsm:true,ds:true};Ae[BA.SUBSECTION]={"*":false,resize:true,adjustSize:true};Ae[BA.VISUALIZATION]={"*":false,ds:true};Ae[BA.SELECTOR]={"*":false,cek:true,ds:true,readyState:true};Ae[BA.MOJOVISUALIZATION]={"*":false,ds:true};Ae[BA.LAYOUT]={"*":false,readyState:true};var A5={};function BD(Be){return A5[Be]||A5["*"];}A5["*"]={update:function z(Bf,Bg,Be,Bh){a.copy(Be,Bg);if(Be&&!Be.ck){delete Bg.ck;}if(Be&&!Be.fs){delete Bg.fs;}}};A5[BA.PANEL]=D({update:function z(Bf,Bg,Be,Bh){delete Bg.layoutXML;if(Bg.isNavigation){delete Bg.exp;}this._super(Bf,Bg,Be);}},A5["*"]);function t(Bj,Bk){var Bf=Bj&&Bj.layoutMap&&Bj.layoutMap[Bk];if(Bf){if(!Bf.t){Bf.t=BA.LAYOUT;}if(Ae.isObservable(Bf)){Bf=Bj.layoutMap[Bk]=this.addDisposable(Ae.makeObservable(Bf));}return Bf;}var Be=Bj&&Bj.layouts,Bi=(Be&&Be.length)||0,Bh;for(Bh=0;Bh<Bi;Bh++){if(Be[Bh].k===Bk){var Bg=Be[Bh];if(!Bg.t){Bg.t=BA.LAYOUT;}if(Ae.isObservable(Bg)){Be[Bh]=this.addDisposable(Ae.makeObservable(Bg));}return Be[Bh];}}return null;}function AN(Bh,Bj,Bg,Bf){var Be=t.call(this,Bh,Bj);if(Bg===Bj){Be._lkz=Bj;return Be;}if(Be){var Bi=Be.units[Bg];if(Bi){if(parseInt(Bi.t,10)===BA.GRIDGRAPH){if(!Be.units[Bg+"_0"]){Be.units[Bg+"_0"]={ck:Bi.ck,fmts:Bi.fmts.gd,txi:Bi.txi,t:BA.GRID};Be.units[Bg+"_1"]={ck:Bi.ck,fmts:Bi.fmts.gp,t:BA.GRAPH};}}if(!Bf&&Ae.isObservable(Bi)){Bi=Be.units[Bg]=Ae.makeObservable(Bi);this.disposables.push(Bi);}Bi._lkz=Bj;}}return Be&&Be.units[Bg];}function Ak(Bi,Bh,Bg,Be){var Bf=this.getChildren(Bi,Bh,0);return(mstrApp.isMobile?(R.filter(Bf,function(Bl){var Bj=Bg&&Bg.indexOf(Bl.defn.t),Bk=Bl.defn.dk;return Be?(Bj>-1&&Bk===-1):(Bj<0||Bk!==-1);})):(Be?[]:Bf));}var M=function(Be,Bf){var Bg=new mstrmojo.StringBuffer();if(Bf){Bg.append("*l"+Bf);}Bg.append("*k"+Be.k);if(Be.hasOwnProperty("wid")){Bg.append("*x"+Be.wid);}Bg.append("*t"+this.buildTime);return Bg.toString();};function AY(Bg){var Bf,Be,Bj=this.delta,Bh=this.pendingUpdate=this.pendingUpdate||{},Bi=[];if(!a.isEmpty(Bj)){Bi.push("<updates>");for(Bf in Bj){if(Bj.hasOwnProperty(Bf)){Be=Bj[Bf];Bi.push(Be.getUpdates());}}Bh[Bg]=Bj;this.delta={};Bi.push("</updates>");}return Bi.join("");}function BZ(Bj,Bf){var Bi;if(Bj){var Be=R.isArray(Bj)?Bj:Bj.split(Bf||m),Bh=Be.length,Bg;for(Bg=0;Bg<Bh;Bg++){Bi=Bi||{};Bi[Be[Bg]]=AN.call(this,this.defn,this.currlaykey,Be[Bg]);}}return Bi;}function AC(Be,Bf){return mstrmojo.all[M.call(this,{k:Be,wid:Bf},this.currlaykey)];}function A6(Bf,Be){var Bg=this.getLayoutUnitDefn(Bf,Be);return(Bg&&Bg.t===BA.PANELSTACK&&Bg.ifw);}function A8(Bf,Be){return !Be||(Bf.wid===Be);}function s(Bi,Bq){var Bl=this,Br=Bl.getSliceCallback(Bq),Bg=Br.shared,Bs=Bq.tks,Bf=Bq.eid,Bo=Bl.getDataService();if(!Bs){return ;}var Bn=AN.call(Bl,Bl.defn,Bl.currlaykey,Bf);if(!Bn){return ;}var Bk=Bf,Bm=Bg.tgtDefs[Bs],Be=function(){Bm.set("selKey",Bf);},Bh;Bm.newSelKey=Bf;if(Bn.l){var Bj=Bn.dirtyKeys;if(!!Bj){Bk=a.keyarray(Bj).join(",");Bg.orignalTargetDefs=Bg.tgtDefs=BZ.call(Bl,Bk,",");Bh=function(){Be();BT(Bg.dataCacheUpdate.upd,function(Bt,Bu){var Bv=mstrmojo.all[Bu];if(Bv&&Bv.setDirty){Bv.setDirty(false);}});};}else{if(Bq.skipServerCall){Be();return ;}Bo.requestPanelChangeDeferred(Bi,Bf,null,false,false,Bl.newCallback({method:"slice",success:Be}));return ;}}else{Bh=function(){Be();Bn.l=true;};}var Bp=Br.success;Br.success=function(Bu){if(!Bl.checkStatus(Bu)){return ;}Bl.updateDefnCache(Bu.defn,[Bf]);Bp(Bu);Bh();var Bt=AC.call(Bl,Bq.tks,0);if(Bt){Bt.clearDirtyChild(Bf);}};Bo.requestPanelChangeDeferred(Bi,Bf,Bk,true,!Bq.hasLoader,Br);}function Z(Be,Bf){if(Bf[C.ELMSREADY]){Be[C.ELMSREADY]=Bf[C.ELMSREADY];Be.elms=Bf.elms;}if(Bf[C.CESREADY]){Be[C.CESREADY]=Bf[C.CESREADY];Be.ces=Bf.ces;}if(Bf[C.ELMSREQUEST]){Be[C.ELMSREQUEST]=Bf[C.ELMSREQUEST];}if(Bf[C.METRICVALUES]){BO.restoreMetricSelectorProps(Be,Bf);Be[C.METRICVALUES]=Bf[C.METRICVALUES];}if(Bf[C.CSREADY]){Be[C.CSREADY]=Bf[C.CSREADY];BO.restoreMetricSelectorSelections(Be,Bf);}if(Bf[C.DISABLED]){Be[C.DISABLED]=Bf[C.DISABLED];}}function f(Bf,Be){if(Bf.defn&&Bf.defn.t>=BA.GRID){mstrmojo.models.template.DataInterface.inflateGridData(Bf.data);}var Bh=Bf.id,Bg=Be[Bh]&&Be[Bh].data;if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()&&Bg&&Bf.defn.t===BA.SELECTOR){if(!Bf.data){Bf.data={};}Z(Bf.data,Bg);}Be[Bf.id]=Bf;return Bf;}function Ah(Bz,Bo,Be,Bk){var Bs=this.currlaykey,Bh;if(Bz){Bh=Bz.defn;Bs=(Bh&&Bh._lkz)||Bz.k;}var CA=this.getLayoutDataCache(Bs),B0=(!Be&&!a.isEmpty(CA)),B6;if(!Bz){B6=this.data;}else{var Bn=Bz.data||Bz;if(B0){B6=CA[M.call(this,Bn,Bs)];B6=(B6&&B6.data)||B6||Bn;}else{B6=Bn;}}if(!!B6.sections){this._buildingLayoutKey=B6.k;}var Bf=B6?this.extractChildren(B6):[],Bu=[];var B3=(Bf&&Bf.length)||0;if(B3){Bh=this.defn;var Bw=!Bz,Bq=Bz?Bs:null,Bj=(Bz&&((Bz.defn)?Bz.defn.t:AN.call(this,Bh,Bq,Bz.k).t));var Bg=(Bj===BA.GRIDGRAPH),B4=(Bj===BA.DETAILS),B2,B1;Bf=Bo(Bf);for(B2=0,B1=Bf.length;B2<B1;B2++){var B8=Bf[B2];if(Bg){B8.k=Bz.k;B8.wid=Bz.data.wid;}var CC=B8.k,Br=B8.wid,By=M.call(this,B8,Bq),B9=!Bw&&A6.call(this,CC,Bq),B7;if(!Bw&&B9&&(!Be||!this.getInfoWinByKey(CC))){var B5=this.getLayoutUnitDefn(CC),Bv=f({data:B8,defn:B5,id:By,k:CC,p:B6},CA);if(!this.getInfoWinByKey(CC,Br)){var Bi=this.infoWindows=this.infoWindows||{};Bi[B5.n]=Bv;this.addInfoWinByKey(CC,Bv);}continue;}else{if(!Bw&&B9&&Be){var Bl=this.getInfoWinByKey(CC,Br);if(Bl){this.mergeInfoWin(B8,Bl.data,this.getCurrentLayoutKey());}}}if(Bg){By+="_"+B2;B7=AN.call(this,Bh,Bq,B8.k+"_"+B2);}else{B7=AN.call(this,Bh,Bq||B8.k,B8.k);}if(B4){B7.dt=true;}if(CA===null&&(B7.t===BA.LAYOUT)){CA=this.getLayoutDataCache(B8.k);}var CB;if(B7.t===BA.PANEL&&CA[By]&&B0){var Bm=this.extractChildren(B8)||[],Bt=this.extractChildren(CA[By].data)||[],Bp=false;if(Bm.length!=Bt.length){R.forEach(Bt,function(CE){var CD=R.find(Bm,"k",CE.k);if(CD>-1){Bm[CD]=CE;Bp=true;}});if(Bp){Bt.splice(0,Bt.length);R.forEach(Bm,function(CD){Bt.push(CD);});}}CB=B8;}else{CB=B0?(CA[By]&&CA[By].data)||B8:B8;}var Bx={k:B8.k,id:By,defn:B7,data:CB,p:B6};if(!CA[By]){f(Bx,CA);}Bu.push(Bx);}}return Bk?{nodes:Bu,total:B3}:Bu;}function Ba(Bk,Bf,Bj){var Be=Ac.px2Inches,Bg=this.getZoomProps(),Bi=1,Bh=2;if((Bj&Bi)>0){Bk.FormattingPosition={Left:Be(Bg,Bf.x||0),Top:Be(Bg,Bf.y||0)};}if((Bj&Bh)>0){Bk.FormattingSize={Height:Be(Bg,Bf.h||0),Width:Be(Bg,Bf.w||0)};}}function AG(Bf){function Be(Bh,Bg){return Bh<Bg?-1:(Bh>Bg?1:0);}Bf.sort(function(Bh,Bg){var Bi=Be(Bh.levelID,Bg.levelID);return Bi!==0?Bi:Be(Bh.elemID,Bg.elemID);});return Bf;}function BW(Be,Bf){return Be.map(function(Bg){return Bg[Bf];}).join(m);}function O(Be){return BW(Be,"levelID");}function BY(Be){return BW(Be,"elemID");}function AZ(Bf){if(Bf){c={};}H={};var Be=this.defn&&this.defn.epm;if(Be){Be.forEach(function(Bg){Bg.epmv.forEach(function(Bh){var Bj=AG(Bh.k.chn.map(function(Bm){var Bl=Bm.emt!==2;return{levelID:Bl?Bm.at.did:"-1",elemID:Bl?Bm.ei:Bm.mt.did};})),Bk=O(Bj),Bi=BY(Bj);if(!H[Bk]){H[Bk]={};}H[Bk][Bi]=JSON.parse(Bh.v.vv);});});}}function l(Be){if(Be){Be=mstrmojo.rw.model.RetrievalKeysConfig.parseResponseFilters(Be);}return Be;}function AR(){var Bf=this.data&&this.data.layouts,Be=Bf[R.find(Bf,"k",this.getCurrentLayoutKey())],Bh=Be&&Be.gbys&&Be.gbys.groupbys,Bg=false;R.forEach(Bh,function(Bi){if(Bi.unit&&Bi.unit.elms&&Bi.unit.elms[Bi.unit.idx].v==="u;"){Bg=true;return false;}});return Bg;}function BH(Be,Bg,Bf){Be=Be.replace(Bg,function(Bh,Bi){if(Bi==="&"){return(Bf+"&");}return Bf;});if(mstrmojo.dom.isIE){Be+="&cb"+mstrmojo.now()+"=1";}return Be;}mstrmojo.DocModel=mstrmojo.declare(mstrmojo.Model,[mstrmojo._CanProxyCallback],{scriptClass:"mstrmojo.DocModel",audibles:{"*":false,data:true,tsp:true},features:null,dataCache:null,searchElemsCache:null,controller:null,sdp:null,dpi:96,keySeed:0,currlaykey:"",init:function Am(Be){this._super(Be);if(!this.features){this.features=new mstrmojo.Model();this.disposables.push(this.features);}this.ondefnChange();AZ.call(this);this.buildTime=mstrmojo.now();},hasFeatures:function Aj(Bi){var Bg=this.features;if(!Bg){return false;}var Bf=Bi.split(","),Be=Bf.length,Bh;for(Bh=0;Bh<Be;Bh++){var Bj=Bf[Bh],Bk=Bj.match(/^!/);if(Bk){Bj=Bj.replace("!","");}if(!!Bk===!!Bg[Bj]){return false;}}return true;},makeObservable:function Al(Be){return Ae.makeObservable(Be);},checkStatus:function BN(Be){if(parseInt(Be.status,10)===4){Be.message=mstrmojo.desc(5781,"Request timed out.");mstrmojo.err(Be);return false;}return true;},getDataService:function A3(){var Bf=this.dataService;if(!Bf){var Be={rwb:this.bs,msgId:this.mid,stid:this.stid,cbKey:this.cbKey,model:this};if(mstrApp.modelFactory){Bf=mstrApp.modelFactory.newDataService("Document",Be);}else{Bf=mstrApp.viewFactory.newDocDataService(Be);}this.dataService=Bf;this.disposables.push(Bf);}return Bf;},getNextKey:function BB(){return"W"+(mstrmojo.resolveFeature("guid-as-node-identifier")?AW.create():this.keySeed++);},resetKeySeed:function E(Be){this.keySeed=Be;},getWidgetId:function L(Be,Bf){return M.call(this,Be,Bf||this.getCurrentLayoutKey());},getUIState:function b(){return{};},ondefnChange:function AI(){var Bj=this.defn,Bg=Bj&&Bj.layouts,Bf={};if(Bj){Bj.layoutMap=Bf;var Bi=(Bg&&Bg.length)||0,Bh;for(Bh=0;Bh<Bi;Bh++){var Be=Bg[Bh];Bf[Be.k]=Be;}}},extractChildren:function AJ(Be){return Be&&(Be.sections||Be.subsections||Be.objects||Be.panels||Be.layouts||Be.children);},getChildren:function V(Bg,Bf,Bj,Be,Bi){Bj=Bj||0;var Bh=function(Bk){return Bk.slice(Bj,Bj+(Be||Bk.length));};return Ah.call(this,Bg,Bh,Bf,Bi);},getChildrenByKey:function Ag(Bg,Bf,Be,Bi){var Bh=function(Bk){var Bj=[],Bl;R.forEach(Be,function(Bm){Bl=R.find(Bk,"k",Bm);if(Bl!==-1){Bj.push(Bk[Bl]);}});return Bj;};return Ah.call(this,Bg,Bh,Bf,Bi);},getTargetDefn:function Af(Be){return BZ.call(this,Be);},getUnitDefinitions:function(Bf,Be){return BZ.call(this,Bf,Be);},getUnitInstance:function AE(Be,Bf){return mstrmojo.all[M.call(this,{k:Be,wid:Bf},this.currlaykey)];},getFirstUnitInstanceByName:function AK(Bh){var Be=t.call(this,this.defn,this.currlaykey);if(Be){var Bf=Be.units,Bg;for(Bg in Bf){var Bi=Bf[Bg];if(Bi.n===Bh){return this.getUnitInstance(Bg,1);}}}return null;},getLayoutUnitDefn:function B(Bf,Be){return AN.call(this,this.defn,Be||this.currlaykey,Bf);},mergeInfoWin:function N(Bi,Bh,Be){if(Bi.k&&Bh.k&&Bi.k===Bh.k){var Bg=this;var Bf=this.getLayoutUnitDefn(Bi.k,Be);if(Bf&&Bf.t===BA.PANELSTACK){R.forEach(Bh.panels,function(Bk){var Bj=R.filterOne(Bi.panels,function(Bl){return Bl.k&&Bl.k===Bk.k;});if(!Bj){Bi.panels.push(Bk);}else{N.call(Bg,Bj,Bk,Be);}});}else{R.forEach(Bh.objects,function(Bk){var Bj=R.filterOne(Bi.objects,function(Bl){return Bl.k&&Bl.k===Bk.k;});if(!Bj){if(Bi.objects){Bi.objects.push(Bk);}}else{N.call(Bg,Bj,Bk,Be);}});}}},getRawLayoutUnitDefn:function d(Bf,Bg,Be){return AN.call(this,Bg||this.defn,Be||this.currlaykey,Bf,true);},getSelectedKey:function BI(Be){return(!Be&&this.currlaykey)||null;},getCurrentLayoutKey:function AD(){return this.currlaykey;},getLayoutKeyByUnitKey:function I(Bi){var Bg=this.defn,Bh=Bg&&Bg.layouts,Be,Bf=null;R.forEach(Bh,function(Bj){Be=Bj.units;if(Be[Bi]&&(!Be[Bi]._isDeleted)){Bf=Bj.k;return !Be[Bi];}});return Bf;},getLayoutDefn:function Ar(Be){var Bf=this.defn,Bg=Bf&&Bf.layouts;return Bg&&Bg[R.find(Bg,"k",Be)];},getCurrentLayoutDef:function Aw(){return this.getLayoutDefn(this.getCurrentLayoutKey());},replaceLayout:function BQ(Bm,Bf,Bn){var Bj=this.defn,Bi=this.data,Bg=Bf&&Bf.defn,Be=Bf&&Bf.data,Bo=this.dataCache;if(Bo&&Bo[Bm]){Bo[Bm]={};}var Bl=(Bi&&Bi.layouts)||(Bj&&Bj.layouts),Bh,Bk=false;for(Bh=(Bl&&Bl.length-1)||0;Bh>=0;Bh--){if(Bl[Bh].k===Bm){break;}}if(Bn&&Bh<0){Bh=R.find(Be.layouts||Bg.layouts,"k",Bm);Bk=true;}this.bs=Bf.bs;if(Be){if(Bk){R.insert(Bi.layouts,Bh,[Be.layouts[Bh]]);}else{Bi.layouts[Bh]=Be.layouts[Bh];}Bi.elems=Be.elems;}if(Bg){if(Bk){R.insert(Bj.layouts,Bh,[Bg.layouts[Bh]]);}else{Bj.layouts[Bh]=Bg.layouts[Bh];}this.ondefnChange();}},loadLayout:function j(Be,Bg,Bf){this.replaceLayout(Be.currlaykey,Be);this.raiseEvent({name:"rebuildLayout",unloadCache:!!Bg,restoreIW:!!Bf});},getLayoutDataNode:function Bd(Bf){var Be=this.data&&this.data.layouts;return R.filterOne(Be,function(Bg){return Bg.k===Bf;});},getLayoutDataCache:function AA(Bf){if(!Bf){return null;}var Be=this.dataCache;if(!Be){Be=this.dataCache={};}if(!Be[Bf]){Be[Bf]={};}return Be[Bf];},saveRW:function BE(Bf,Bh){var Bg=mstrmojo.desc,Be=this.getDataService();Be.saveRW({objName:Bf||this.n,folderID:this.pfid,saveAsFlags:1},Bh||{success:function(Bi){mstrmojo.alert(Bg(3819,"Document Saved")+": "+Bi.n);}});},saveAsRW:function Bc(Bi,Bh){var Bg=this,Bf=!!(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()||mstrConfig&&mstrConfig.resolveOnly),Be=Bg.prompt_option;switch(Be){case 0:Be=3;break;case 4:Be=1;break;default:Be=2;}var Bj=mstrmojo.hash.copy(Bi,{evt:3102,applyChanges:false,executionMode:2,parentFolderID:mstrApp.saveFolderId||Bg.sfid||Bg.pfid,saveFromDesignMode:false,saveAsReportSaveAsFlags:Be,resolveOnly:Bf,rwb:Bg.bs});if(Bh){Bj.target=Bh;Bj.saveAsOrigin=13;}mstrmojo.form.send(Bj,null,"post");},getDocPropsActions:function AV(Be){var Bf={act:"setDocumentProperties",props:Be};a.forEach(Be.RWDocumentProperties,function(Bh,Bg,Bi){Bi[Bg]=String(Bh);});return Bf;},saveDocProps:function AU(Be,Bg,Bh,Bl){var Bk=this.getDataService(),Bj=Bh?null:mstrmojo.DocDataService.RAPID_EXEC,Bf=mstrmojo.DocDataService.REQUEST_DEFN_DATA,Bi=[this.getDocPropsActions(Be)];if(Bg){this.controller.cmdMgr.execute({execute:function(){this.submit(Bi,Bl||{},a.copy(Bf,a.copy(Bj,{})));},urInfo:Bg});}else{Bk.submitUpdates(Bi,Bl||{},a.copy(Bf,a.copy(Bj,{preserveUndo:true})));}},partialUpdate:function AP(Bj,Be,Bh,Bg,Bf){if(Bh){this.updateDefnCache(Bh,Bg,Bf);}if(Bj){if(mstrApp){mstrApp.isPartialUpdate=true;}var Bi=this.updateDataCache(Bj,Be,undefined,Bf);this.raiseEvent({name:"partialUpdate",tree:Bj,ids:Bi});if(mstrApp){mstrApp.isPartialUpdate=false;}return Bi;}},refreshDefinition:function h(Bh,Bg,Bf,Bi){var Be=this.getLayoutUnitDefn(Bh,Bf||this.getCurrentLayoutKey());if(!Be){return ;}BD(Be.t).update(this,Be,Bg,Bi);},loadPartialData:function AM(Bj,Bf){var Bh={};Bh[Bf]=AN.call(this,this.defn,this.currlaykey,Bf);var Bg=this.updateDataCache(Bj,Bh),Be=this.getLayoutDataCache(this.getCurrentLayoutKey()),Bi=this;R.forEach(Bj.layouts,function(Bk){var Bl=Bk&&Bk.xtabStyles;if(Bl){Bi.raiseEvent({name:"updateStyles",key:Bk.k,updatedStyles:Bl});}});BT(Bg,function(Bl,Bk){if(Bk==="upd"){BT(Bl,function(Bn,Bo){var Bm=mstrmojo.all[Bo];if(Bm&&Bm.update){Bm.update(Be[Bo]);}});}});},updateDefnCache:function A(Bf,Bl,Bi){var Bo=this.currlaykey,Bh=t.call(this,Bf,Bo),Bq=t.call(this,this.defn,Bo),Bm=function(Br,Bs){var Bt;for(Bt in Bs){if(Br[Bt]===undefined){Br[Bt]=Bs[Bt];}}},Bp=Bh&&Bh.units,Bn=Bq&&Bq.units,Bg=Bh&&Bh.cgbMap,Be=Bq&&Bq.cgbMap,Bj=Bi&&l(Bi).defn,Bk=this;R.forEach(Bl,function(Br){Bk.refreshDefinition(Br,Bp&&Bp[Br],null,Bj&&Bj[Br]);});if(Bp){Bm(Bn,Bp);}if(Bg){Bm(Be,Bg);this.raiseEvent({name:"CGBMapChange",cgbMap:Be});}},deleteDataCache:function U(Bf){var Be=this.getLayoutDataCache(this.getCurrentLayoutKey());if(Be[Bf]){delete Be[Bf];}},setDataReady:function Ab(Bn,Bk,Bf,Bl,Be,Bo){var Bi=this.extractChildren(this.data),Bg=this.getLayoutDataCache(this.getCurrentLayoutKey()),Bj=this,Bm=false;if(!Bi){return ;}function Bh(Bp){if(!Bp){return ;}R.forEach(Bp,function(Bq){if(Bq.k===Bn){if(Bf){Bq[Bf]=Bl;}if(R.isArray(Be)&&Bo){R.forEach(Be,function(Bs,Br){Bq[Bs]=Bo[Br];});}else{if(Be){Bq[Be]=Bo;}}Bm=true;return false;}else{if(!Bm){Bh(Bj.extractChildren(Bq));}}});}Bh(Bi);if(!Bg[Bk]){Bg[Bk]={};}Bg[Bk][Bf]=Bl;},updateDataCache:function An(Bp,Bo,Be,Bi){var Bg=this.getLayoutDataCache(this.getCurrentLayoutKey()),Bf=Bi&&l(Bi).data,Bq={ifws:{},upd:{},tgts:{},def:{},secs:{}},Bk=this,Bn=function(Bt,Br){var Bu=Bk.extractChildren(Bt.data);if(Bu){return ;}var Bw=Bk.extractChildren(Br);for(var Bs in (Bw||[])){if(!!Bw[Bs]){var Bv=Bw[Bs];if(Bv.k===Bt.k){if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()&&Bw[Bs]&&Bt.defn&&Bt.defn.t===BA.SELECTOR){if(!Bt.data){Bt.data={};}Z(Bt.data,Bw[Bs]);}Bw[Bs]=Bt.data;}}}},Bj=function(Bx,Bs,Br){var Bw=Bg[Bx];if(Bf){var Bv=mstrmojo.all[Bx];if(Bv){var Bt=Bw.k,Bu=Bf[Bt];if(Bu){if(!a.isEmpty(Bu.exclude)){a.copy(Bs.data,Bw.data);}else{Bs.data=a.copyProps(Bu.serialized.split(";"),Bs.data,Bw.data);}}}}f(Bs,Bg);Bn(Bs,Br);};function Bm(B7,CC,Bs,Bv){var Bx=false,B4=this.getChildren(B7,true),B2;if(!B4.length){return ;}if(Bs){B2=mstrmojo.all[B7.id];Bx=!B7.id||!!B2;}var Bw=B7.defn,Bt=B7.data,B9;if(Bw&&Bw.t===BA.PANELSTACK&&Bw.od){B9=Bt.selKey;}var B8,B1,CE=function(CF){return(CF.k===B1);};for(B8 in B4){var B5=B4[B8],B6=B5.id,Bu=null,CA;B1=B5.k;if(CC){var By=this.extractChildren(CC);if(By){CA=R.filterOne(By,CE);if(!CA){By.push(a.clone(B5.data));}}else{a.copy(a.clone(B7.data),CC);}}if(mstrmojo.all[B6]){Bx=true;}if(Bo.hasOwnProperty(B1)){if(A6.call(this,B1)&&A8(B5.data,Be)){Bj(B6,B5,CC);var CD=this.getInfoWinByKey(B1);if(!Bv&&CD){Bq.ifws[B1]=CD.id;}}Bu=B1;if(Bx){if(B9&&B9!==B1){continue;}if(!Bv){Bq.tgts[B6]=true;}var Br=B2&&B2.defn,CB=Br&&Br.t,B0=Br&&Br.ck;if(CB===BA.SUBSECTION&&(B0&&B0.hasOwnProperty(B1))){Bq.secs[B2.id]=true;}}}if((Bv||Bu)&&(!B9||B9===B1)){Bj(B6,B5,CC);Bq.def[B1]=true;if(Bx){Bq.upd[B6]=true;}}var Bz=mstrmojo.all[B6],Bw=Bz?Ax.getPropertyByPath(Bz,"node.defn"):null;if(mstrApp.isInVFConfigMode&&Bw&&Bw.iifp){var B3=this.adjustNodeId(B5.id);if(mstrmojo.all[B3]){B5.id=B3;Bj(B3,B5,CC);B5.id=this.restoreNodeId(B3);Bq.upd[B3]=true;Bq.tgts[B3]=true;}else{if((Bw.t===BA.GRID||Bw.t===BA.GRAPH)&&Bv&&Bo[mstrmojo.all[B5.id].k]){Bq.upd[B5.id]=true;Bq.tgts[B5.id]=true;}}}Bm.call(this,B5,CA,Bx,Bv||Bu);}}if(Bp&&Bp.layouts&&Bo){var Bh=R.filterOne(Bp.layouts,function(Br){return(Br.loaded);}),Bl=this.data.layouts;if(Bh){Bm.call(this,Bh,Bl[R.find(Bl,"k",Bh.k)],true);}}return Bq;},getDimensionAndPositionAction:function W(Bf,Be,Bh){var Bg=this.getUnitFormatAction(Bf,null,null,Bh);Ba.call(this,Bg.format,Be,3);return Bg;},getDimensionAction:function W(Bf,Be,Bh){var Bg=this.getUnitFormatAction(Bf,null,null,Bh);Ba.call(this,Bg.format,Be,2);return Bg;},getUnitFormatAction:function p(Bm,Bf,Bl,Bh){var Bj=Bm.defn,Bn=(Bj&&Bj.t)||1,Bk=Bm.k,Bi=[Bk];var Be={act:"format",unitKey:Bk,unitType:Bn===115?521:Bn,formatType:Bf||1,format:Bl||{}};if(!Bh){Be.partialRetrieval={nodes:Bi};}if(Bn===BA.SELECTOR){var Bo=Bj.ck;Be.keyContext=Bo;Bi[0]=this.getDataService().getNodeKeyFromKeyContext(Bo);}if(Bn===BA.TEXTFIELD||Bn===BA.IMAGE||Bn===BA.HTMLCONTAINER){var Bg=Bm.nk||Bj.fgk;Be.fieldKey=Bk;Be.nodeKey=Bg;Be.keyContext=Bn+m+Bg+m+Bk;Bi[0]=Bg;}return Be;},updateUnitFormat:function A9(Bf,Bh,Bi,Bj,Be){var Bg=this.getUnitFormatAction(Bf,Bh,Bi);this.getDataService().submitUpdates(Bg,Bj,Be);},selectPanelDeferred:function(Bj,Bi,Bh,Bg,Bf,Be){s.call(this,Bj,{type:3,tks:Bi,eid:Bh,sid:Bg||1,ck:Bi,hasLoader:Bf,skipServerCall:Be});},getSearchElemsCache:function BL(){var Be=this.searchElemsCache;if(!Be){Be=this.searchElemsCache={};}return Be;},getCGBMap:function A0(){var Be=t.call(this,this.defn,this.currlaykey);return Be&&Be.cgbMap;},getSliceCallback:function AT(Be){var Bh=this,Bi={};Bi.dataCacheUpdate=null;Bi.tgtDefs=Be.tks?BZ.call(this,Be.tks):null;Bi.orignalTargetDefs=Bi.tgtDefs;var Bg=Bi.tgtDefs,Bf=function(Bl){var Bm=Bg;if(Be.disablePU){Bm=BZ.call(Bh,Bh.currlaykey);}BT(Bm,function(Bn){if(Bn&&Bn.set){Bn.set("readyState",Bl);}});},Bk=this.newCallback({method:"slice",shared:Bi,submission:function(){Bf(P.WAITING);},success:function(Bm){if(!Bh.checkStatus(Bm)){return ;}if(Be.disablePU){Bh.loadLayout(Bm,Be.isUConDS,Be.restoreIW);return ;}if(Bm.pukeys){Bi.tgtDefs=BZ.call(Bh,Bm.pukeys);}Bi.dataCacheUpdate=Bh.updateDataCache(Bm.data,Bi.tgtDefs,Be&&Be.sid,Bm.puFilters);if(typeof Bm==="object"){a.copyProps(["bs","exopt","dty"],Bm,Bh);}var Bl={name:"partialUpdate",tree:Bm.data,ids:Bi.dataCacheUpdate,unloadCache:Be.isUConDS};if(!mstrmojo.hash.isEmpty(Bl.ids.ifws)){if(Be&&!Be.suppressIW&&(Be.type===BA.GRID||Be.type===BA.GRAPH)){Bl.anchor=Be.anchor;}else{Bl.ids.ifws={};}}if(mstrApp){mstrApp.isPartialUpdate=true;}Bh.raiseEvent(Bl);if(mstrApp){mstrApp.isPartialUpdate=false;}},complete:function(){Bf(P.IDLE);}}),Bj={success:function(){BT(Bi.orignalTargetDefs,function(Bx,Bv){var Bw=AC.call(Bh,Bv,1);if(!Bw){if(!!Bh.sdp&&!!Bh.sdp[Bv]){var Bu=Bh.getLayoutDataCache(Bh.getCurrentLayoutKey());var By=M.call(Bh,{k:Bv,wid:1},Bh.getLayoutKeyByUnitKey(Bv));Bh.raiseEvent({name:"secondaryDataSliced",key:Bv,data:Bu[By].data});}return ;}if(Bi.dataCacheUpdate&&!Bi.dataCacheUpdate.def.hasOwnProperty(Bv)){if(Bw.setDirty){Bw.setDirty(true);}}else{if(parseInt(Bx.t,10)===BA.PANELSTACK){Bw.setDirtyChildren();}}});var Bt=Be.events||{K0:Be},Bp;for(Bp in Bt){var Bl=AC.call(Bh,Bt[Bp].ctlKey,1);if(Bl&&Bi.dataCacheUpdate&&!Bi.dataCacheUpdate.upd.hasOwnProperty(Bl.id)){var Bs=(Bl.children&&Bl.children[0].selectedIndices)||{},Bo=Bl.node.data,Bm=mstrmojo.DocSelector.STYLES,Bn=[];if(Bl.isDynamicAttributeSelector()){Bo.exp=Bl.expr;if(!Bl.expr&&R.find(Bo.elms,"v",k.ELEM_ALL_ID)>=0){Bn.push(k.ELEM_ALL);}}else{if(Bl.style===Bm.SEARCH_BOX){var Br=(Bl.children&&Bl.children[0].items)||[];R.forEach(Br,function(Bu){Bn.push(a.clone(Bu));});}else{a.forEach(Bs,function(Bv,Bu){if(Bv){Bn.push(Bo.elms[Bu]);}});}}var Bq=R.find(Bn,"v",k.ELEM_ALL_ID);if(Bq>-1){Bn=[Bn[Bq]];}Bo.ces=Bn;Bl.selIdx=Bs;}}}};if(Be.isUConDS||(parseInt(Be.type,10)===BA.GRAPH&&Be.tty===1)){Bk.success=function(Bl){Bh.controller.setData(Bl,true);};return Bk;}if((parseInt(Be.type,10)===3)){return Bk;}return BR(Bk,Bj);},slice:function g(Be){var Bf=this.getDataService(),Bg=Bf.newUpdateWithoutCmd();this.sliceDeferred(Bg,Be);if(Bg.actions&&Bg.actions.length>0){Bf.addSuppressData(Bg.extras);Bg.submit();}},sliceDeferred:function(Bm,Bp){var Bk={};try{if(!Bp||(!mstrmojo.dom.isAndroid&&!Bp.tks&&!Bp.multiSelect&&(Bp.type===3||(Bp.type===BA.GRAPH&&parseInt(Bp.tty,10)!==1)))){return Bk;}var Bh=this.getSliceCallback(Bp),Bv=this,Bq=this.getDataService(),Bo=Bv.controller.view;var Bw=parseInt(Bp.type,10);if(Bw===3){s.call(Bv,Bm,Bp);return ;}if(Bp.multiSelect){if(Bp.selectorObjects.length>0){Bq.setMultiDocSelectorElements(Bp.selectorObjects,Bp.multiSelect,Bh);}return ;}if(Bw===BA.GRAPH){Bm.add(Bq.getGraphSelectionAction(Bp.src,Bp.cks,Bp.sid,Bp.x,Bp.y,(Bp.tty===1)),Bh);if(!!Bp.showLoadingIcon){Bm.addExtras({config:mstrmojo.DocDataService.PROGRESS_CONFIG});}return ;}var Be=Bp.events||{K0:Bp},Bn=[],Bu,Bi={config:mstrmojo.DocDataService.PROGRESS_CONFIG},Bt=Bi.params={},Br,Bf={},Bg=function(By,Bx){if(By){Bf[Bx]=By.visName;}};for(Br in Be){Bp=Be[Br];if(!Bp){break;}if(Bp.hasOwnProperty("eid")){if(Bp.isUConDS){Bp.disablePU=true;}if(AR.call(this)){Bp.disablePU=true;Bp.restoreIW=true;}Bu=Bq.getSelectorElementsAction(Bp);if(Bv.sdp){Bf={};BT(Bv.sdp,Bg);Bt.sdpKeys=JSON.stringify(Bf);}if(Bp.disablePU){Bt.disablePU=true;}}else{if(Bp.fromGM){Bu=Bq.getSelectorFromGMAction(Bp);}else{if(parseInt(Bp.srct,10)===4||Bp.fid){if(Bp.fid&&AR.call(this)){Bp.disablePU=true;}Bu=Bq.getSelectorExpressionAction(Bp);}else{if(Bp.unset){Bu=Bq.getUnsetSelectorAction(Bp);}else{if(Bp.expr){Bu=Bq.getAttributeSelectorExpressionAction(Bp);}else{if(parseInt(Bp.ct,10)===6){Bu=Bq.getMultiUnitSelectorAction(Bp);Bv.hasUnitSelector=Bp.selections&&Bp.selections.hasElements;}else{Bu=Bq.getSelectorIncludeAction(Bp);}}}}}}Bn.push(Bu);}Bm.add(Bn,Bh,Bi);var Bl=function(Bx){Bx.extras.style={params:{treesToRender:3}};Bx.callback=BR({success:function By(Bz){Bv.partialUpdate(Bz.data,Bv.getUnitDefinitions(Bp.cgb),Bz.defn,Bp.cgb,Bz.puFilters);}},Bx.callback);return Bx;};if(Bp.isNavigation){var Bj=(Bo._layouts||[]).filter(function(Bx){return Bx.k===Bp.layoutKey;})[0];if(Bj){if(!Bo.showLayout(Bj,null,Bm,Bp.panelKey)){Bm=Bl(Bm);Bo.showPanel(Bp.panelKey,Bp.layoutKey,Bm);}}else{Bo.loadDocLayout({layoutKey:Bp.layoutKey,panelKey:Bp.panelKey},null,Bm);}}else{Bm=Bl(Bm);}}catch(Bs){mstrmojo.err(Bs);}},getInfoWindow:function AF(Bf){var Be=this.infoWindows;return Be&&Be[Bf];},getTargetInfoWin:function(Bf){var Be=[],Bg=BZ.call(this,Bf);if(Bg){var Bh;for(Bh in Bg){if(Bg[Bh]&&Bg[Bh].ifw){Be.push(Bh);}}}return Be;},addInfoWinByKey:function AO(Bf,Be){if(!this.infoWinByKey){this.infoWinByKey={};}if(!this.infoWinByKey[Bf]){this.infoWinByKey[Bf]=[Be];return ;}if(R.find(this.infoWinByKey[Bf],"id",Be.id)===-1){this.infoWinByKey[Bf].push(Be);}},getInfoWinByKey:function BV(Bg,Be){var Bh=null,Bf=this.getCurrentLayoutKey();if(this.infoWinByKey&&this.infoWinByKey[Bg]){R.forEach(this.infoWinByKey[Bg],function(Bi){var Bj=Bi&&Bi.id;if(Bj&&Bj.indexOf(Bg)>-1&&Bj.indexOf(Bf)>-1){if(!Be||Bj.indexOf("*x"+Be)>-1){Bh=Bi;return false;}}});}return Bh;},showInfoWin:function AB(Bi,Bh,Bf,Bj,Bk,Be){var Bg=this.getInfoWinByKey(Bi,Be);if(Bg===null){return ;}this.raiseEvent({name:"showInfoWin",psId:Bg.id,psKey:Bg.k,anchor:Bh,anchorOrientation:Bf,anchorPosition:Bk,invalidate:Bj});},getSelectedXtabStyles:function x(Bg){var Bf=Bg||this.currlaykey;var Bi={};var Be=this.data&&this.data.layouts,Bh;for(Bh in Be){if(Be[Bh].k===Bf){Bi=Be[Bh].xtabStyles;break;}}return Bi;},downloadGridData:function G(Bj,Bk){var Bh=this,Bg=Bj.xtabId,Bf=Bj.memo,Bi=mstrmojo.all[Bg],Be=this.newCallback({success:function(Bs){function Bl(Bw,By){var Bz=Bh.getChildren(Bw,true),Bx=Bz.length,Bv;for(Bv=0;Bv<Bx;Bv++){var B0=Bz[Bv];if(By===B0.id){return B0;}var Bu=Bl(B0,By);if(Bu){return Bu;}}return null;}var Bp=t.call(Bh,Bs.data,Bh.currlaykey);if(Bp){if(Bh.restoreNodeId){Bg=Bh.restoreNodeId(Bg);}var Bo=Bl(Bp,Bg);if(Bo){mstrmojo.models.template.DataInterface.inflateGridData(Bo.data);if(Bi){Bi.dataDownloaded(Bo,Bf);}}var Br=Bp.xtabStyles;if(Br){Bh.raiseEvent({name:"updateStyles",key:Bp.k,updatedStyles:Br});}}var Bq=AN.call(Bh,Bh.defn,Bh.currlaykey,Bj.nodeKey);if(Bq&&Bq.t===BA.GRIDGRAPH&&Bf.recalculating){var Bn=Bi.parent,Bt=Bn&&Bn.getGraphWidget();if(Bt&&Bn.updateGraph){Bn.updateGraph(Bl(Bp,Bt.id));}}if(Bs.pukeys){var Bm=BZ.call(Bh,Bs.pukeys);delete Bm[Bj.nodeKey];if(!a.isEmpty(Bm)){Bh.partialUpdate(Bs.data,Bm);}}},failure:Bi.dataDownloadErr||mstrmojo.emptyFn});this.getDataService().downloadGridData(Bj,BR(Be,Bk));},clearDisposables:function Az(){var Be=[];R.forEach(this.disposables,function(Bf){if(Bf._lkz){BM(Bf);}else{Be.push(Bf);}});this.disposables=Be;},getFixedHeaders:function(Bf,Be){return Ak.call(this,Bf,Be,[BA.PAGEHEADER],true);},getFixedFooters:function(Bf,Be){return Ak.call(this,Bf,Be,[BA.PAGEFOOTER],true);},getNonFixedSections:function(Bf,Be){return Ak.call(this,Bf,Be,[BA.PAGEHEADER,BA.PAGEFOOTER],false);},addAutoWidthID:function u(Bg){var Bf=this.aws||{},Be=Bf[this.currlaykey]||[];Be.push(Bg);Bf[this.currlaykey]=Be;this.aws=Bf;},getAutoWidthIDs:function Q(){var Bg=this.aws,Be=this.currlaykey;var Bf=Bg&&Bg[Be];if(Bf){delete Bg[Be];}return Bf;},getTransactionUpdates:function w(Be){return this.txDiscardTargets?"":AY.call(this,Be);},clearTransactionUpdates:function Aa(Be){this.clearTxDeltaUpdate(Be);},resetTransactionUpdates:function A4(Be){var Bf=this.pendingUpdate,Bg=this.delta;if(Bf&&Bf[Be]){BT(Bf[Be],function(Bh,Bi){if(Bg&&!Bg[Bi]){Bg[Bi]=Bh;}});delete Bf[Be];}},transactionUpdate:function BK(Bg,Bf){if(!Bg.data){return null;}var Bi;if(Bf&&Bf.tks){Bi=BZ.call(this,Bf.tks);}if(Bg.pukeys){Bi=BZ.call(this,Bg.pukeys);var Bj;for(Bj in Bi){if(Bi[Bj]&&Bi[Bj].cek){Bi[Bj].cek=null;}}}if(Bg.txrcd){this.txrcd=Bg.txrcd;}else{delete this.txrcd;}var Bh=this.updateDataCache(Bg.data,Bi,Bf&&Bf.sid),Be={name:"partialUpdate",tree:Bg.data,ids:Bh};if(!a.isEmpty(Bh.ifws)){if(Bf&&Bf.type===BA.GRID){Be.anchor=Bf.anchor;}else{Bh.ifws={};}}this.raiseEvent(Be);return Bh;},deltaUpdate:function A2(Be){var Bf=this.delta;if(!Bf){Bf=this.delta={};}Bf[Be.id]=Be;},clearTxDeltaUpdate:function e(Bf){var Bi=this.txDiscardTargets,Be=!Bi,Bh=this.pendingUpdate,Bg=this;if(!Be){BT(Bi,function(Bj,Bk){if(Bg.delta&&Bg.delta[Bk]){Bg.delta[Bk].clear();delete Bg.delta[Bk];}});}if(Bh&&Bh[Bf]){BT(Bh[Bf],function(Bj){Bj.clear();});delete this.pendingUpdate[Bf];}},sendTransactionActions:function J(Bf,Be,Bh){var Bg=this;if(!Bh){Bh={success:function(Bi){Bg.transactionUpdate(Bi);}};}Bg.getDataService().sendTransactionActions({keyContext:Bf,actions:Be,txrcd:this.txrcd},Bh);},sendTransactionUpdates:function Av(Be){var Bg=this.getSliceCallback(Be),Bf=this.getDataService();Bf.submitUpdates([Bf.getUpdateTransactionAction(Be)],Bg);},addSDP:function BF(Bf,Be){if(!Bf||!Be){return ;}if(!this.sdp){this.sdp={};}this.sdp[Bf]={k:Be.k,visName:Be.visName};},removeSDP:function A7(Be){if(!Be||!this.sdp||!this.sdp[Be]){return ;}delete this.sdp[Be];},getUpdateColorMapCallback:function o(){var Be=this;return{success:function(Bf){Be.defn.epm=Bf.defn&&Bf.defn.epm;AZ.call(Be);Be.raiseEvent({name:"colorMapChanged"});}};},getUpdateThemePaletteCallback:function A1(Bg){var Bh=this,Be,Bf;if(mstrApp.isInVFConfigMode){mstrApp.requireRestoreVFConfigMode=true;Be=Bh.getVIMap().getComponent(K);Bf=mstrApp.getRootController();mstrApp.isInVFConfigPage=false;Bf.view.closeInlineDialog();Bh.destroyVisualiztionselector();Bf.restorePanelStatus(Be);Bf.maskMenuToolbar(false);}return{success:function(Bi){Bh.thm=Bi.thm;Bh.plt=Bi.plt;Bh.defmts=Bi.defmts;AZ.call(Bh,!Bg);Bh.layoutstyle=Bi.layoutstyle;}};},getCurrentPaletteColors:function Ai(){return(this.plt&&this.plt.colors)||S;},getCurrentPaletteId:function F(){return this.plt&&this.plt.did;},getCurrentDefaultPaletteId:function BG(){return(this.thm&&this.thm.dplt)||BX;},getCurrentLayoutStyle:function BS(){return this.layoutstyle||Ap;},getColorBy:function(Bk,Be){var Bi=Be.map(function(Bm,Bl){return{levelID:Bk[Bl].toString(),elemID:Bm};});if(Bi&&Bi.length>1){AG(Bi);}var Bj=O(Bi),Bh=BY(Bi),Bg=c[Bj];if(!Bg){Bg=c[Bj]={_currentColorIdx:0};}if(!Bg[Bh]){var Bf=this.getCurrentPaletteColors();Bg[Bh]=Bf[Bg._currentColorIdx];Bg._currentColorIdx=(Bg._currentColorIdx+1)%Bf.length;}if(H[Bj]&&H[Bj][Bh]){return{color:H[Bj][Bh].color,isManual:true};}return{color:Bg[Bh],isManual:false};},getZoomFactor:function AQ(){return this.getCurrentLayoutDef().zf||1;},getZoomProps:function Au(){return{dpi:this.dpi,zf:this.getZoomFactor()};},executeLink:function v(Be,Bg,Bi){if(Be.indexOf("prevMsgID")>0){Be=BH(Be,/prevMsgID=0($|&)/g,"prevMsgID="+this.mid);}if(Be.indexOf("originMessageID")>0){Be=BH(Be,/originMessageID=[a-zA-Z0-9]*($|&)/g,"originMessageID="+this.mid);}Be=mstrmojo.addCSRFTokenToURL(Be);if(Be.indexOf(mstrApp.name+"=")===-1&&!mstrmojo.isUrlExternal(Be)){var Bh=mstrApp.servletState||mstrConfig.servletState||"";var Bf=mstrApp.name+"="+window.encodeURIComponent(Bh);if(Be.indexOf("?")>-1){Be+="&";}else{Be+="?";}Be+=Bf;}this.controller.onLink(this,{url:Be,target:Bg,src:Bi||null,submitAsPost:!mstrmojo.isUrlExternal(Be)});},getDatasetUnits:function BJ(Bf,Be,Bh,Bj){var Bi=this.datasets,Bg=[];a.keyarray(Bi).forEach(function(Bl){if(!Bh||Bl===Bh){var Bm=Bi[Bl],Bk=Bm,Bn=[];Bf.forEach(function(Bo){if(Bj!==undefined){Bk=Bm.tables[Bj];}(Bk[Bo]||[]).forEach(function(Bp){if(!Be||Be(Bp)){Bn.push(Bp);}});});Bg=Bg.concat(Bn.map(function(Bo){return mstrmojo.hash.copyProps(["did","attId","n","t","st","ndetype","formType","dt","f","hide","usedInDropZones","card","lock","fs","lvfs"],Bo,{ds:Bm.name,dsId:Bl,dm:!!Bo.um,da:!!Bo.da,de:!!Bo.de});}));}});return Bg;},getMapLayerKeys:function Ay(Be){if(Be&&Be.getSdpKeyArr){return Be.getSdpKeyArr();}return[];},getDeleteMapLayersActions:function BP(Bg){var Be,Bh=[],Bf=this;(Bg||[]).forEach(function(Bi){Be=Bf.getLayoutUnitDefn(Bi);Bh.push({act:"removeUnit",unitKey:Bi,unitType:(Be&&Be.t)||522});});return Bh;},syncLayerDefn:function r(Bi,Bg,Bf){var Bh=this.getCurrentLayoutDef(),Be=(Bh&&Bh.units)||{};(Bg||[]).forEach(function(Bj){if(Be[Bj]){if(Bf){Be[Bj]._isDeleted=true;}else{delete Be[Bj]._isDeleted;}}});if(Bf){mstrApp.primaryScdpMap[Bi]=[];}else{mstrApp.primaryScdpMap[Bi]=Bg;}},getFormatSDPAction:function Ao(Bg,Bf){var Be={FormattingWidget:{SecondaryDataProviders:Bf.join(",")}};return this.getUnitFormatAction(Bg,1,Be,true);},addMapLayerActions:function BC(Br,Bj,Bm,Bl){var Bn=this.getNextKey(),Bh=this.getPanel().k,Bq=Br.scriptClass==="mstrmojo.mapbox.VisMapbox",Bf=Bq?As.MAPBOX:As.GOOGLE_MAP,Be=Bq?Bb.MAPBOX:Bb.GOOGLEMAP,Bp=this.getWidgetClassNameByStyle(Bf,Be),Bo=this.getMapLayerKeys(Br),Bg=Br.defn.tt,Bk={k:Bn,defn:{t:521}},Bi={FormattingAppearance:{Visible:0,Name:Bl}};Bj.push(this.getCopyEmptyTemplateAction(Bn,Bh));Bj.push({act:"updateTemplate",keyContext:Bn,actions:[{act:"createDefaultDropZones",nodeKey:Bn,treeType:Bg,datasetType:3,widgetType:Be}]});Bj.push(this.getUnitChangeVizAction(Bf,Bp,Bk,Bm,Bi));Bj.push({act:"changeGridDisplayMode",nodeKey:Bn,displayMode:1});Bj.push(this.getFormatSDPAction(Br,Bo.concat(Bn)));return Bn;},removeMapLayerActions:function AH(Bg,Bf,Bh){var Be=this.getLayoutUnitDefn(Bf);Bh.push({act:"removeUnit",unitKey:Bf,unitType:(Be&&Be.t)||522});Bh.push(this.getFormatSDPAction(Bg,this.getMapLayerKeys(Bg)));},getExtraActionsForChangeMapViz:function AL(Bg,Bf,Bj){var Bh=Bg.parent,Bi,Be=this;if(Bf&&Bf.length>0){R.forEach(Bf,function(Bk){if(!Bg.isPrimaryKey(Bk)){Bi=Be.clearVisAsFilterActionForMapLayer(Bh,Bg.fnGetWidget(Bk),true);if(Bi&&Bi.actions){Bj=Bj.concat(Bi.actions);}}});Bj=Bj.concat(this.getDeleteMapLayersActions(Bf));Bj.push(this.getFormatSDPAction(Bg,[]));this.syncLayerDefn(Bg.k,Bf,true);}return Bj;},isMapLayerNode:function n(Bf){var Be=false;a.forEach(mstrApp.primaryScdpMap,function(Bg){if(Bg.indexOf(Bf)>=0){Be=true;return false;}});return Be;},getMapLayersDataByHostKey:function X(Bk){var Bg={},Bj,Bi=this,Bh=mstrApp.primaryScdpMap[Bk],Bf=this.getCurrentLayoutKey(),Be=this.getLayoutDataCache(Bf);R.forEach(Bh,function(Bl){Bj=Be[M.call(Bi,{k:Bl,wid:1},Bf)];Bg[Bl]=Bj&&Bj.data;});return Bg;},getNodeDataByKey:function AX(Bf){var Bg=this.getLayoutKeyByUnitKey(Bf),Be=this.getLayoutDataCache(this.getCurrentLayoutKey()),Bh=Be[M.call(this,{k:Bf,wid:1},Bg)];return Bh;},getMapLayerDataByLayerKey:function AX(Be){var Bf=this.getNodeDataByKey(Be);return Bf&&Bf.data;},updatePrimaryScdpMap:function Aq(Bi,Bg,Bf){var Be,Bh=mstrApp.primaryScdpMap[Bi];if(!Bh){Bh=mstrApp.primaryScdpMap[Bi]=[];}Be=Bh.indexOf(Bg);if(Bf&&Be<0){Bh.push(Bg);}else{if(!Bf&&Be>=0){Bh.splice(Be,1);}}},updateWidgetsProps:function BU(){this.raiseEvent({name:"updWgtsProps"});},restoreVFConfigMode:function AS(){var Be=this;return{success:function(){if(mstrApp.requireRestoreVFConfigMode){mstrApp.requireRestoreVFConfigMode=false;var Bi=Be,Bf=mstrApp.isVFEditingMode,Bh=mstrApp.restoreVFKey,Bg=mstrApp.restoreVFTitle;Bi.checkLargeItemsForVisFilter(Bh,function(){var Bj=Bi.addVisFilterContainer(),Bm=Bi.getSelectedViUnit(),Bl;Bi.oldSelectedVizBoxId=Bm.id;mstrApp.isInVFConfigMode=true;Bl=Bi.insertVizBox(Bh,Bj,{});Bi.controller.rootCtrl.initPanelStautsInConfigMode();Bi.selectVIUnit(Bl.id,true,{isAddAction:true});mstrApp.getRootController().enterVizFilterConfigMode(Bg,Bf);if(Bf===false){mstrApp.restoreVFCreate=true;var Bk=mstrmojo.all.visualizationFilterToolbar;Bk.toggleSaveBtn(mstrApp.isEnableSaveBtn);}});}}};},getWidgetClassNameByStyle:function At(Bg,Bf){var Be=mstrmojo.ExpressVisList.findWidgetName(Bg)||Ad[Bg];if(!Be&&parseInt(Bf)===Bb.CUSTOM){Be=q;}return Be||"";},clearColorByMap:function Y(){c={};}});mstrmojo.DocModel.fnBuildId=M;}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.Button","mstrmojo.form");var G=mstrmojo.css,C=mstrmojo.dom,E=mstrmojo.array,H="show";mstrmojo._CanWSItemDragandDrop=mstrmojo.provide("mstrmojo._CanWSItemDragandDrop",{_mixinName:"mstrmojo._CanWSItemDragandDrop",wsItemdndNode:null,model:null,init:function I(J){this._super(J);if(this.wsItemdndNode===null||!this.model){return ;}this.installedEventListeners=[this.model.attachEventListener(EVENTS.WSITEM_DRAG_ENTER,this.id,this.handleWSItemDragEnter),this.model.attachEventListener(EVENTS.WSITEM_DROP,this.id,this.handleWSItemDrop),this.model.attachEventListener(EVENTS.WSITEM_DRAG_EXIT,this.id,this.handleWSItemDragExit)];},unrender:function F(J){E.forEach(this.installedEventListeners,function(K){this.model&&this.model.detachEventListener(K);});this.installedEventListeners=[];this._super(J);},handleWSItemDragEnter:function D(){G.addClass(this.wsItemdndNode,H);},handleWSItemDragExit:function B(){G.removeClass(this.wsItemdndNode,H);},handleWSItemDrop:function A(){G.removeClass(this.wsItemdndNode,H);}});}());(function(){mstrmojo.ngm.NewGMProperty=mstrmojo.declare(mstrmojo.gm.GMProperty,null,{scriptClass:"mstrmojo.ngm.NewGMProperty",init:function A(B){this._super(B);this.gm="NGM";}});mstrmojo.ngm.NGMCharacterGroup=mstrmojo.declare(mstrmojo.ui.editors.controls.ControlGroup,[mstrmojo.ui.editors.controls._HasCharacterGroup],{scriptClass:"mstrmojo.ngm.NGMCharacterGroup",init:function A(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-ui-EditCharacter");var H=this,C=this.getHCGControls(function(J,K,I){if(!H._sync){H.raiseFormatValueChange(J,K,I);}}),D=[];Object.keys(C).forEach(function(I){this[I]=C[I];}.bind(this));var B=this.fontFamily,G=this.fontSize,F=this.fontColor;if(B){D.push(B);}if(G){G.slot="col1Node";F.slot="col2Node";D.push({scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",children:[G,F]});}if(D.length){this.addChildren(D);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.color","mstrmojo.expr","mstrmojo.Label","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.viz.MapHelper","mstrmojo.vi.util.ThresholdUtils","mstrmojo.ui.CheckList","mstrmojo.ui.editors.controls.ContainerGroup","mstrmojo.models.FormatModel","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps._AreaMapHelper","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.gmaps.MapColorUtils","mstrmojo.num");mstrmojo.requiresDescs(8068,6030,6031,13254,13256,13255,11849,11850,11851,11852,11853,11854,11855);mstrmojo.requiresDescs(7736,8068,8102,8069,9237,2797,8958,8764,8765,13254,13256,11845,11846,11847);mstrmojo.requiresDescs(7674,15745,15746,15747,15748,15749,15750);var k=mstrmojo.vi.viz.EnumDSSDropZones,R=mstrmojo.array,Z=mstrmojo.hash,Ad=mstrmojo.color,Ah=mstrmojo.expr.DTP,q=mstrmojo.emptyFn,BJ=mstrmojo.vi.viz.MapHelper,Ap=mstrmojo.vi.util.ThresholdUtils,Au=mstrmojo.gmaps,Q=mstrmojo.VisUtility,AK=Au.MapUtils,AW=Au.EnumBaseMapType,O=Au.EnumGraphicType,A8=Au.EnumMarkerType,Ab=Au.EnumClusterMode,AS=Au.EnumPropertyType,Ay=Au.EnumMaxSizeType,AB=Au.EnumMinSizeType,AC=Au.EnumGeographicRole,AJ=Au.EnumZoomBehavior,H=Au.EnumDataLabel,BA=Au.EnumShapeFormatting,A0=Au.EnumDefaultShapeFormatStyle,AF=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,BF=mstrmojo.chart.enums.EnumFontStyle,Ax=Au.EnumDataLabelShowOption,BI=mstrmojo.gmaps.EnumLayerZoneSource,BG=Au._AreaMapHelper,A4=Au.TARGET_MAPOPTIONS,W=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS,AU=mstrmojo.ui.editors.controls.AdvancedColorPicker,N=0,w=1,AY=Au.ENABLE_MAX_MIN_SIZE_CONTROL,Ak=mstrmojo.gm.GMUtility,Y=Au.MapColorUtils,m=mstrmojo.num;var e="Clr";var M=["not used",mstrmojo.desc(13743,"The smallest element's size is proportional to its data element"),mstrmojo.desc(13744,"The smallest element's size is fixed, independent of its data value"),mstrmojo.desc(13740,"The smallest element's size is ## of the largest element's size")];var V=1,p=2,Aj=4;var z=[AW.Google,AW.Esri];var Ai="colorByColorChangeHandlers";var AE=[BA.SHAPE_FORMAT_FILL_COLOR,BA.SHAPE_FORMAT_BORDER_COLOR];function c(BL,BP,BO,BN){var BM=this[BL];if(BM===undefined){this[BL]={};BM=this[BL];}BM[BP]={fn:BO,context:BN};}function L(){var BL=this.getEditingGridData()||{},BM=Q.getPropertyByPath(BL,"gts.row",[]),BO=Q.getPropertyByPath(BL,"gts.col",[]),BN=BM.concat(BO);return BN;}function t(BN,BM){function BL(BP){var BQ=BP.value;return(BQ===undefined||BQ==="")&&BN.getEditingPropertyVal(BM)===undefined;}return{onInvalid:function BO(){if(BL(this)){if(this.hasRendered){this.clearValidation();}return ;}if(this.hasRendered){mstrmojo.ui.editors.controls.ValidationTextBox.prototype.onInvalid.call(this);}},onRender:function(){if(BL(this)){this.clearValidation();}}};}function Aw(BQ,BO,BM,BL){if(!BQ){return ;}var BS=this;function BP(BY){return Object.keys(R.hash(R.ensureArray(BY)));}var BT=BQ.listenFormatProps||[],BV=BQ.listenSelector||[];(BQ.smartNames||[]).forEach(function(BY){R.insert(BT,null,BY);});BQ.listenFormatProps=BP(BT);BQ.listenSelector=BP(BV);var BX=BQ;if(typeof BO==="string"){var BN=(BM===w),BR=BN?"14px":"30%",BU=BN?"100%":"70%";if(BL){BR=BL[0];BU=BL[1];}BX=this.getLabelAndControl(BO,BQ,BR,BU,BN);BQ.label=BX.getLabel();if(BN){BX.cssClass="checkLabel multiLine";BQ.label.onclick=function BW(){BQ.onclick();};BQ.label.cssDisplay="inline-block";}else{if(BM===N){BX.cssClass="characterGroup";}}}BQ.getCtrlContainer=function(){return BX;};return BX;}E:function E(BL){var BM=this;return function(BP){var BO=BM.getHost(),BN=BO.getEditingGridKey();BO.writeProperties(BL,BP,BN);};}function s(BL){var BM=this;return function(BN){var BO=BM[BL]||{},BQ=BN.type==="*"?Object.keys(BO):[].concat(BN.type),BP;BQ.forEach(function(BR){if(BO.hasOwnProperty(BR)){BP=BO[BR];BP.fn.call(BM,BN,BP.context);}});};}mstrmojo.vi.models.editors.MapEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.MapEditorModel",vizUnit:null,propertyEditor:null,help:"format_panel_map.htm",editingProperty:null,defaultShapeId:null,colorBySub:null,baseMapOptionsControls:null,mapStyleControl:null,graphicLayersControl:null,graphicLayerOptionsControls:null,onPropertiesChanged:function Aa(BM,BS){var BR=this.getHost(),BQ,BO,BL,BN,BP=this;if(BM===AS.graphicType){BQ=L.call(BR);BO=BR.getEditingGridData()||{};BL=BO.vp;BN=BL&&BL.gtp;if(BN!==BS){BR.zonesModel.addAttributeNameAndTargetVisForAddUnits(BO,BQ,undefined,BS,undefined);BR.zonesModel.checkAndWarnLargeItemsForAddUnits(BQ,function(){BP.editingProperty=BM;BR&&BR.writeProperties(BM,BS);});}}else{if(BS===AU.VAL_AUTOMATIC&&AE.indexOf(BM)>=0){BS=undefined;}if(BR){BR.writeProperties(BM,BS);}}},getActionsWithUpdateProperty:function Ag(BM){var Bb=this.getHost(),BQ=Bb&&Bb.getEditingHost(),BO=[],Ba=Bb&&Bb.zonesModel.getZonesCfg(),BW=this,BR,BZ,BX,BP,BV,BU;if((this.editingProperty!==AS.graphicType)||!BQ||!Ba){return BO;}BX=BQ.zonesModel;BP=BQ.model&&BQ.model.data;if(!BP||!BX){return BO;}BV=BP.vp;R.forEach(Ba,function(Bc){if(!Bc.show(BV)){BO=BO.concat(BW.getRemoveUnitAction(Bc.id,BX));}});if(BM===O.Area){BU=Bb.getEditingDropZoneItems(k.GeoAttribute);if(BU&&BU[1]){BO=BO.concat(BX.getRemoveDropZoneUnitActions({id:k.GeoAttribute},BU[1]));}}BZ=BV&&BV[AS.graphicType];BR=BP.datasetId;BO=BO.concat(this.getAddFormUnitAction(k.Latitude,BR,A9,A1,BZ,BX));BO=BO.concat(this.getAddFormUnitAction(k.Longitude,BR,A9,K,BZ,BX));if(AQ.call(this,BZ)){var BT=BX.getZoneModelByZoneId(k.ColorBy),BN=!!BT?BT.items[0]:{},BY=BP.gsi&&BP.gsi.thresholds,BL=BY&&BN&&BY[BN.did],BS=false;if(BL&&(BL.length>0&&BL[0].rtp===4)){BS=true;}if(BS){Ap.addThresholds(BQ.model,BQ,BQ.node,BN,BO,null,null,true);}}return BO.length>0?R.ensureArray(BX.getUpdateTemplateAction(BO)):[];},getRemoveUnitAction:function Ar(BL,BO){if(!BO){return[];}var BN=this.getHost(),BM=BN&&BN.getEditingDropZoneItems(BL),BQ=[];if(BM&&BM.length>0){var BP={did:BM[0].id,t:BM[0].t};BQ=BQ.concat(BO.getRemoveDropZoneUnitActions({id:BL},BP));}return BQ;},getAddFormUnitAction:function l(BN,BP,BW,BL,BU,BT){var BO=[],BV=this.getHost(),BR=BV&&BV.zonesModel,BS,BQ,BM;if(!(BW.call(this,BU,BN))||!BT||!BR){return BO;}BR.getDropZones();BS=BR.getZoneModelByZoneId(k.GeoAttribute);BQ=!!BS?BS.items[0]:{};BM=BL.call(this,BQ);if(BT&&BM){BO.push({act:"addForm",unitId:BQ.did,attFormId:BM.fid,unitPos:1});BO=BO.concat(BT.getAddDropZoneUnitsActions({id:BN},[{did:BM.fid,t:21}],0,{datasetId:BP}));}return BO;},getMapViewer:function An(){var BL=this.getHost();return BL&&BL.mapViewer;},getEditingPropertyVal:function h(BM){var BL=this.getHost();return BL&&BL.getPropertyValue(BM);},getDensityTheme:function AN(){var BL=this.getEditingPropertyVal(AS.themeType);BL=parseInt(BL,10);return isNaN(BL)?1:BL;},getAreaShape:function C(){return this.getEditingPropertyVal(AS.shapeFile);},getBaseMapTypes:function Aq(){var BM=this.getHost(),BL=[];if(!BM){return ;}if(BM.hasGooglePlugin()){BL.push({n:mstrmojo.desc(14744,"Google"),id:AW.Google});}else{R.removeItem(z,AW.Google);}if(BM.isESRIKeyValid()){BL.push({n:mstrmojo.desc(14745,"Esri"),id:AW.Esri});}else{R.removeItem(z,AW.Esri);}if(z.indexOf(AW.Mapbox)!==-1){BL.splice(0,0,{n:mstrmojo.desc(15301,"Mapbox"),id:AW.Mapbox});}if(z.indexOf(AW.Image)!==-1){BL.push({n:mstrmojo.desc(2922,"Image"),id:AW.Image});}return BL;},getMapStyles:function J(){var BM=this.getMapViewer(),BL=BM&&BM.baseLayer;return BL&&BL.getMapStyles();},getMapRedrawTypes:function AT(){return[{id:AJ.Keep,n:mstrmojo.desc(7982,"Static")},{id:AJ.Automatic,n:mstrmojo.desc(15251,"Dynamic")}];},shouldRemoveAreaOption:function(){return AK.isSingleTier()&&!AK.isWSLiveMode()&&this._getBaseMapType()===AW.Google;},getGraphicTypes:function AO(){var BL=[{n:mstrmojo.desc(13254,"Marker"),id:O.Marker},{n:mstrmojo.desc(348,"Bubble"),id:O.Bubble},{n:mstrmojo.desc(13255,"Area"),id:O.Area},{n:mstrmojo.desc(13256,"Density"),id:O.Density}];if(this.shouldRemoveAreaOption()){BL.splice(2,1);}return BL;},getMarkerTypes:function BE(){return[{n:mstrmojo.desc(11837,"Pins"),id:A8.Pin},{n:mstrmojo.desc(154,"Squares"),id:A8.Square},{n:mstrmojo.desc(14746,"Diamonds"),id:A8.Diamond},{n:mstrmojo.desc(14747,"Images"),id:A8.Image}];},getMarkerClusteringTypes:function AP(){return[{n:mstrmojo.desc(6030,"On"),id:Ab.ON},{n:mstrmojo.desc(344,"Pie"),id:Ab.PIE},{n:mstrmojo.desc(6031,"Off"),id:Ab.OFF}];},getBubbleClusteringTypes:function AG(){return[{n:mstrmojo.desc(6030,"On"),id:Ab.ON},{n:mstrmojo.desc(6031,"Off"),id:Ab.OFF}];},getDensityThemes:function A5(){return[{id:1,cls:"rainbow",title:mstrmojo.desc(9234,"Rainbow")},{id:2,cls:"fire",title:mstrmojo.desc(9235,"Fire")},{id:3,cls:"sunrise",title:mstrmojo.desc(9236,"Sunrise")},{id:4,cls:"desert",title:mstrmojo.desc(9237,"Desert")},{id:5,cls:"brick",title:mstrmojo.desc(9238,"Brick")}];},getAreaShapes:function AM(){var BV=this.getHost(),BN=[],BL,BQ,BR,BP,BS,BT,BO,BW,BM,BU;if(!BV){return BN;}BL=BV.getEditingGridData();BQ=BV.getEditingGridProps();BR=BV.getEditingDropZoneItems(k.GeoAttribute);R.forEach(BR,function(BX){BU=BX.id;return false;});if(!BU||BU.length===1){BQ.lid="";this.defaultShapeId=null;return null;}BS=BG.getShapeAttributeGeoRole(BL,BU)||AC.EnumGeographicRoleNone;BP=BV.getBaseMapType();BT=BV.getMapConfig();BO=BT&&BT.common;BW=BT&&BT.esri;if(BP===AW.Esri&&BW&&parseInt(BW.useESRICloud,10)!=1){return null;}if(BO){BM=BG.getAvailableShapes(BO.shapes,BO.layers,BS,BP);BN=this.getShapeOptions(BM,BP);}this.loadDefaultShape(BM,BS);return BN;},_getBaseMapType:function b(){var BL=this.getHost();return BL&&BL.getBaseMapType();},getShapeOptions:function Az(BL,BP){var BT=[{id:"-----",n:mstrmojo.desc(11290,"Please select")}],BO,BM,BS,BR,BQ;if(!!BL){for(BM=0,BS=BL.length;BM<BS;BM++){BO=BL[BM];if(BO){BR=BO.desc;if(BP===AW.Mapbox&&BO.descWeb){try{BQ=parseInt(BO.descWeb.substring(8));if(!isNaN(BQ)){BR=mstrmojo.desc(BQ,BR);}}catch(BN){}}BT.push({id:BO.id,n:BR});}}}return BT;},loadDefaultShape:function d(BL,BM){this.defaultShapeId=null;var BN=BG.getMatchingShape(BL,null,BM);if(!!BN){this.defaultShapeId=BN.id;}},getBaseMapTypeSelectedIndex:function X(){var BM=this.getEditingPropertyVal(AS.baseMapType),BL=z.indexOf(BM);if(BL!==-1){return BL;}},getMapStyleSelectedIndex:function At(BT){var BO=this.getEditingPropertyVal(AS.mapStyle),BL=BT||this.getMapStyles(),BQ=-1,BN=this.getMapViewer(),BR=BN&&BN.baseLayer,BM,BP,BS;if(!BR){return ;}if(BO!=undefined&&!!BL&&BL.length>0){for(BP=0,BS=BL.length;BP<BS;BP++){BM=BL[BP];if(BM.id==BO){BQ=BP;break;}}}return(BQ!==-1)?BQ:BR.getDefaultStyleIdx();},getMapRedrawSelectedIndex:function v(){var BM=this.getEditingPropertyVal(AS.zoomSetting),BL=0;switch(BM){case AJ.Keep:BL=0;break;case AJ.Automatic:BL=1;break;default:break;}return BL;},getGraphicTypeSelectedIndex:function P(BM){var BL=0;switch(BM){case O.Marker:BL=0;break;case O.Bubble:BL=1;break;case O.Area:BL=2;break;case O.Density:BL=3;break;default:break;}if(this.shouldRemoveAreaOption()){if(BL===2){BL=-1;}else{if(BL>2){BL-=1;}}}return BL;},getMarkerTypeSelectedIndex:function AL(){var BM=this.getEditingPropertyVal(AS.markerType),BL=0;switch(BM){case A8.Pin:BL=0;break;case A8.Square:BL=1;break;case A8.Diamond:BL=2;break;case A8.Image:BL=3;break;default:break;}return BL;},getMarkerClusteringTypeSelectedIndex:function B(){var BM=this.getEditingPropertyVal(AS.clusterMode),BL=0;switch(BM){case Ab.ON:BL=0;break;case Ab.PIE:BL=1;break;case Ab.OFF:default:BL=2;break;}return BL;},getBubbleClusteringTypeSelectedIndex:function x(){var BM=this.getEditingPropertyVal(AS.clusterMode),BL=0;switch(BM){case Ab.ON:BL=0;break;case Ab.OFF:default:BL=1;break;}return BL;},getDensityThemeSelectedIndex:function f(){return this.getDensityTheme()-1;},getAreaShapeSelectedIndex:function g(){var BM=this.getAreaShapes(),BQ=this.getAreaShape(),BP=BM?BM.length:0,BO,BN,BL=0;for(BO=1;BO<BP;BO++){BN=BM[BO];if(BN.id==BQ){BL=BO;break;}}return BL;},getEditorContents:function D(BL){var BM=this.getHost();if(BM.editorContentReady===true){return this._super(BL);}else{return null;}},getDelayedEditorContents:function I(BL,BN){var BM=this.getHost();this.propertyEditor=BL;this.vizUnit=BN;BM.propEditorListener={listener:this,callback:this.updateEditorContent};},updateEditorContent:function BC(){if(this.vizUnit){var BL=this.propertyEditor;if(BL){BL.onVIUnitSelected(this.vizUnit);}}this.propertyEditor=null;this.vizUnit=null;},getContainerCtrlFlags:function AV(){return mstrmojo.ui.editors.controls.ContainerGroup.CTRL_FLAGS.BORDER;},getInitialTarget:function BK(){return A4;},getTargetPulldownItems:function Ae(BM){var BP=this._super(BM),BO=this.getHost(),BN=this,BL=function(){var BQ=BN.getMapOptionControls;BN.replaceChildControls(BM,BQ.call(BN));};if(BO.isBaseMapValid()&&!(BO.excludeData||BO.isEmpty())){BP.unshift({n:mstrmojo.desc(13271,"Map Options"),v:A4,h:BL});}return BP;},getTwoColumnContainer:function AZ(BL,BM){BL.forEach(function(BO,BN){BO.slot="col"+(BN+1)+"Node";});BM=Z.copy(BM,{col1Width:"50%",col2Width:"50%",children:BL});return new mstrmojo.ui.editors.controls.TwoColumnContainer(BM);},getBaseMapControls:function a(){var BM=[],BL=this.getBaseMapTypeControl();if(BL){BM.push(BL);}this.baseMapOptionsControls=this.getEditorGroup(this.getBaseMapOptionsControls(),{isNested:true,showDivider:false,isContainer:true});BM.push(this.baseMapOptionsControls);if(AK.enableZoomLevelAndPosSaving()){BM.push(this.getKeepZoomLevelandPosCtrl());}return this.getEditorGroup(BM,{isNested:true,showDivider:false,isContainer:true});},getBaseMapTypeControl:function Ac(){return this.fnGetPulldown(this.getBaseMapTypes(),this.getBaseMapTypeSelectedIndex(),mstrmojo.desc(14748,"Base map")+":",AS.baseMapType);},getKeepZoomLevelandPosCtrl:function Am(){var BS=this,BU=this.getHost(),BR=BU&&BU.getProperties(),BQ=BR[AS.zoomSetting]!==AJ.Automatic,BO=AS.keepZoomAndPos,BL=BR[BO]===true||BR[BO]==="true",BP=new mstrmojo.ui.Checkbox({checked:BL,oncheckedChange:function BM(BV){BS.onPropertiesChanged(BO,BV.value);}}),BN=this.getLabelAndControl(mstrmojo.desc(15743,"Remember zoom level"),BP,"14px","100%",true,{enabled:BQ}),BT=BN.getLabel();BT.onclick=function(){BP.onclick();};return BN;},getGraphicLayersControls:function Ao(){var BL=[];if(!mstrApp.isInVFConfigMode){var BN=new mstrmojo.Label({text:"Layers",setDimensions:function(BQ,BO){var BP=this.domNode;if(BP){BP.style.width=BO;}}}),BM=this.getGraphicLayerListControl();BL=[BN,BM];}this.graphicLayerOptionsControls=this.getGraphicLayerOptionsControls();return this.getEditorGroup(BL.concat([this.graphicLayerOptionsControls]),{isNested:true,showDivider:true,isContainer:true});},getZoomControls:function A7(){return this.fnGetPulldown(this.getMapRedrawTypes(),this.getMapRedrawSelectedIndex(),mstrmojo.desc(15744,"Zoom behavior"),AS.zoomSetting,{isNested:true,showDivider:false,isContainer:true});},getBaseMapOptionsControls:function o(){var BL=this.getZoomControls();this.mapStyleControl=this.getMapStyleControls();return !this.mapStyleControl?[BL]:[this.mapStyleControl,BL];},getMapStyleControls:function A(){var BL=this.getMapStyles(),BM=this;if(this._getBaseMapType()===AW.Image){return new mstrmojo.ui.editors.controls.ValidationTextBox({required:true,validationDelay:120000,value:BL[0],hint:"image URL...",onValid:function(){var BN=BM.getHost();if(BN){BN.writeProperties(AS.mapStyle,this.value);}},updateText:function(BN){this.inputNode.value=BN;this.value=BN;}});}if(!!BL&&BL.length>0){return this.fnGetPulldown(BL,this.getMapStyleSelectedIndex(BL),mstrmojo.desc(13583,"Map style"),AS.mapStyle);}},getGraphicLayerListControl:function n(){var BL=this.getHost();if(BL&&BL.getLayerZoneControl instanceof Function){return BL.getLayerZoneControl(BI.PROPERTY_PANEL);}},getClusteringControlForMarker:function A3(){return this.fnGetPulldown(this.getMarkerClusteringTypes(),this.getMarkerClusteringTypeSelectedIndex(),mstrmojo.desc(11841,"Clustering"),AS.clusterMode);},getClusteringControlForBubble:function u(){return this.fnGetPulldown(this.getBubbleClusteringTypes(),this.getBubbleClusteringTypeSelectedIndex(),mstrmojo.desc(11841,"Clustering"),AS.clusterMode);},getGraphicLayerOptionsControls:function BD(){var BM=[],BN=this.getEditingPropertyVal(AS.graphicType),BL=this.getEditingPropertyVal(AS.markerType);BM.push(this.fnGetPulldown(this.getGraphicTypes(),this.getGraphicTypeSelectedIndex(BN),mstrmojo.desc(2043,"Type"),AS.graphicType));switch(BN){case O.Marker:BM.push(this.fnGetPulldown(this.getMarkerTypes(),this.getMarkerTypeSelectedIndex(),mstrmojo.desc(2923,"Shape"),AS.markerType));BM.push(this.getClusteringControlForMarker());break;case O.Bubble:BM.push(this.getClusteringControlForBubble());break;case O.Area:BM.push(this.fnGetPulldown(this.getAreaShapes(),this.getAreaShapeSelectedIndex(),mstrmojo.desc(11842,"Boundaries"),AS.shapeFile));break;case O.Density:this.addDensityControls(BM);break;default:break;}if(BN&&(BN!==O.Density&&!(BN===O.Marker&&BL===A8.Image))){var BO=this.getShapeFormatControls(BN);if(BO){BM.push(BO);}}if(AY&&BN===O.Bubble){BM.push(this.getMaxMinSizeControls());}if(BN&&BN!==O.Density){BM.push(this.getDataLabelControls());}this.addShowLegendControl(BM);return this.getEditorGroup(BM,{isNested:true,showDivider:false,isContainer:true});},getMoreOptionsControl:function Al(){var BM=this.getHost(),BL=BM&&BM.getEditingGridData();return this.getEditorGroup([this.getMoreOptionsEditorLink((BL&&BL.gsi&&BL.gsi.prop)||{})],{isNested:true,showDivider:true,isContainer:true});},addShowLegendControl:function j(BM){var BO=this.getHost(),BN=BO.getEditingGridKey(),BR=BO.getGraphicLayer(BN),BL=this.getEditingPropertyVal(AS.legendSwitch),BP=this.getGroupTitle(mstrmojo.desc(2403,"Legend")),BQ;if(BO.hasColorByOrSizeBy(BN)&&BR&&BR.isVisible()){BQ=this.getCheckboxAndLabel(BL===true||BL==="true",mstrmojo.desc(12001,"Show Legend"),E.call(this,AS.legendSwitch));BM.push(this.getEditorGroup([BP,BQ],{isNested:true,showDivider:true,isContainer:true}));}},openMoreOptionsEditor:function BB(BO,BL,BP){var BN=this.getHost();BN=BN&&BN.getEditingHost();var BM=this._super(BO,BL,BP);if(BM&&BN){BM.set("host",BN);}},getMaxMinSizeControls:function A6(){var BS,BR,BM,BU,BW=this.getHost(),BT=BW.getEditingGridKey(),BQ=BW.getProperties(BT),BN=BW.getGraphicLayer(),BL={trigger:mstrmojo.validation.TRIGGER.ALL,min:0.01,max:1,regExp:mstrmojo.locales.number.DECIMALSEPARATOR==="."?/^\d+(\.\d{1,2})?$/:/^\d+(\,\d{1,2})?$/},BV;if(!BN){return ;}BV=BN.enableMinSizeOption();function BP(BX,BY,Bf,Ba,BZ){function Bg(Bi){var Bj=BN.getMaxMinSizeValue(BY,Bi);Bd.set("enabled",BZ.textboxEnabled(Bi));Bd.updateText(m.toLocaleString(Bj));var Bh=BZ.onSizeChanged;if(Bh instanceof Function){Bh(Bi,Bj);}BW.writeProperties(BX,Bi);}var Bc=BN.getMaxMinSizeType(BX),Be=BN.getMaxMinSizeValue(BY,Bc),Bb=this.getPulldown(Ba,Bg,!isNaN(Bc)?(Bc-1):0),Bd=new mstrmojo.ui.editors.controls.ValidationTextBox({required:true,dtp:Ah.FLOAT,constraints:BL,validationDelay:1500,value:m.toLocaleString(Be),enabled:BZ.textboxEnabled(Bc),onValid:function(){var Bj=Bb.getSelectedItem().v,Bi=m.parseNumeric(this.value);var Bh=BZ.onSizeChanged;if(Bh instanceof Function){Bh(Bj,Bi);}BW.writeProperties(BY,Bi);},updateText:function(Bh){this.inputNode.value=Bh;this.value=Bh;}});return[new mstrmojo.Label({text:Bf}),this.getTwoColumnContainer([Bb,Bd],{col1Width:"70%",col2Width:"30%"})];}function BO(BY,BX){var BZ;BY=parseInt(BY);BZ=M[BY];if(BY===AB.ADJUSTED_RANGE){if(BX===undefined){BX=0.2;}BZ=BZ.replace("##",(BX*100).toFixed(0)+"%");}return BZ;}BS=BP.call(this,AS.MAX_SIZE_TYPE,AS.MAX_SIZE_VALUE,mstrmojo.desc(13918,"Max size (0.01 - 1.0):"),[{n:mstrmojo.desc(6019,"Automatic"),v:Ay.AUTOMATIC},{n:mstrmojo.desc(8262,"Manual"),v:Ay.MANUAL}],{textboxEnabled:function(BX){return BX===Ay.MANUAL;}});BR=BP.call(this,AS.MIN_SIZE_TYPE,AS.MIN_SIZE_VALUE,mstrmojo.desc(13917,"Min size (0.01 - 1.0):"),[{n:mstrmojo.desc(11990,"Proportional"),v:AB.PROPORTIONAL},{n:mstrmojo.desc(13741,"Full Range"),v:AB.FULL_RANGE},{n:mstrmojo.desc(14118,"Adjusted Range"),v:AB.ADJUSTED_RANGE}],{textboxEnabled:function(BX){return BX===AB.ADJUSTED_RANGE;},onSizeChanged:function(BY,BX){BM.set("text",BO(BY,BX));}});BU=[].concat(BS,BR);if(!BV){BR.forEach(function(BX){BX.set("enabled",false);});}else{BM=new mstrmojo.Label({text:BO(BQ[AS.MIN_SIZE_TYPE],BQ[AS.MIN_SIZE_VALUE]),cssText:"line-height: 115%;"});BU.push(BM);}return this.getEditorGroup(BU,{isNested:true,showDivider:true,isContainer:true});},getColorByAttrControls:function AI(BZ){var Bb=this,BS=this.getHost(),Bd=BS&&BS.getGraphicLayer(),BM=this.colorBySub;if(!Bd){return ;}var BN=0,BU=Bd.getFormatColorByElements(),Ba="ShapeClr",BY="ShapeFillTrans",BQ=AU.VAL_AUTOMATIC,BR=BU.map(function(Bg,Bf){return{n:Bg.text,title:Bg.text,v:Bf};}),BL=Q.range(1,BR.length,1),BX,BW,Bc=s.bind(this),BO,BP=false,BT=mstrmojo.desc(12092,"Multiple Elements");if(BM){BS.detachEventListener(BM);}this.colorBySub=BS.attachEventListener("colorByColorChange",this.id,Bc(Ai));BO=Y.cbSelectionToIndices(Bd.getContextMenuColorBySelections(),BU);if(BO.length===0){BN=0;}else{if(BO.length===1){BN=BO[0];}else{BN=BO;BP=true;}}function BV(){return[].concat(BN===0?BL:BN);}function Be(Bg,Bf){function Bh(){var Bi,Bm,Bk,Bl;if(Bf===undefined){Bi=BV();Bm=[];R.forEach(Bi,function(Bn){Bm.push(BU[Bn]);});Bk=Y.getColorInfoForItemAll(Bm);this.setChildValue(Ba,Bk.color);this.setChildValue(BY,Bk.opacity);}else{BN=Bf;Bl=BU[Bf];this.setChildValue(Ba,Bl.color);this.setChildValue(BY,Bl.opacity);}var Bj=BV().some(function(Bn){return Q.isColorManuallySet(BS,BU[Bn].comb);});Q.setColorPickerShowAutomatic(this,Bj);}if(Bg){this.syncControls(Bh);}else{Bh.call(this);}}BX=new mstrmojo.ui.editors.controls.FillConfigGroup({showGradient:false,onGroupValueChange:function(Bg,Bh){var Bp=Bb.getHost(),Bm,Bq=[],Bj=[],Bl=Bg===Ba,Bi=Bg===BY,Bn=BV(),Bo=false,Bf,Bk;Bn.forEach(function(Br){var Bt=BU[Br],Bs=Bt.comb;Bj.push(Bs);if(Bl){if(Bh===BQ){Bq.push("default");Bo=true;}else{Bq.push(Ak.encodeColor(Bh));Bt.color=Bh;}}else{if(Bi){Bq.push(Bh);Bt.opacity=Bh;}}});if(Bo){Bf=Bp.listenToUpdateColorMap(function(){var Bs=Bj.length,Br;Bn.forEach(function(Bt){var Bu=BU[Bt];Br=Ak.decodeColor(Q.getCombColor(Bp,Bu.comb));Bu.color=Br;});Bk=Y.getColorInfoForItemAll(BU.slice(1));BU[0].color=Bk.color;if(Bs>1){Br=BU[0].color;}BX.syncControls(function(){this.setChildValue(Ba,Br);Q.setColorPickerShowAutomatic(BX,false);});Bp.detachUpdateColorMapListener(Bf);});}if(Bl){Bp.updateColorMap(Bj,Bq);Bk=Y.getColorInfoForItemAll(BU.slice(1));BU[0].color=Bk.color;Q.setColorPickerShowAutomatic(this,true);}if(Bi){Bm=Bp&&Bp.getGraphicLayer();if(!Bm){return ;}Bm.updateLayerColorByOpacity(Bj,Bq);BU=Bm.getFormatColorByElements();}}});if(BX){BX.iniChildrenComp([Ba,BY]);Be.call(BX,true,BP?undefined:BN);}c.call(this,Ai,"fill",function(Bf){BX.syncControls(function(){BX.setChildValue(Ba,Bf.fill);Q.setColorPickerShowAutomatic(BX,Bf.showAutomatic);});});c.call(this,Ai,"opacity",function(Bf){var Bh=Bb.getHost(),Bg=Bh&&Bh.getGraphicLayer();if(!Bg){return ;}BU=Bg.getFormatColorByElements();BX.syncControls(function(){BX.setChildValue(BY,Bf.opacity);});});c.call(this,Ai,"invalidateCache",function(){BU.forEach(function(Bh,Bg){if(Bg===0){return ;}Bh.color=Ak.decodeColor(Q.getCombColor(BS,Bh.comb));});var Bf=Y.getColorInfoForItemAll(BU.slice(1));BU[0].color=Bf.color;});c.call(this,Ai,"opacityFullUpdate",function(){var Bf,Bh=Bb.getHost(),Bg=Bh&&Bh.getGraphicLayer();if(!Bg){return ;}BU=Bg.getFormatColorByElements();if(BN>=0){Bf=BU[BN].opacity;BX.syncControls(function(){BX.setChildValue(BY,Bf);});}});c.call(this,Ai,"colorFullUpdate",function(){var Bf,Bh,Bi=Bb.getHost(),Bg=Bi&&Bi.getGraphicLayer();if(!Bg){return ;}BU=Bg.getFormatColorByElements();if(BN>=0){Bf=BU[BN].color;Bh=BV().some(function(Bj){return Q.isColorManuallySet(Bi,BU[Bj].comb);});BX.syncControls(function(){BX.setChildValue(Ba,Bf);Q.setColorPickerShowAutomatic(BX,Bh);});}});BW=this.getPulldown(BR,Be.bind(BX,true),BP?undefined:BN,{setDisplayText:function(Bf){var Bg=this.selectedNode;if(Bg){Bg.innerHTML=Bf;Bg.title=Bf;}}});if(BP){BW.attachEventListener("renderComplete",BW.id,function(){BW.setDisplayText(BT);});}BZ.push(BW);BZ.push(BX);},getShapeFormatControls:function U(BW){var BT=this.getHost(),Be=this,Bf=BT.isEditingDropZoneColorByAttr(),Bc=BT.getEditingDropZoneItems(k.ColorBy),BN=Bf===false&&Bc&&Bc.length>0,BS=Bf===true&&Bc&&Bc.length>0,Bd=BT.getGraphicLayer(),BR=Bd&&Bd.dataValidate(),Bb=this.getGroupTitle(mstrmojo.desc(13751,"Shape Formatting")),BU,BM,BQ=[],BP={isNested:true,showDivider:true,isContainer:true},BX;function BZ(Bj,Bg,Bm,Bn){var Bh=function(Bo){switch(Bo){case BA.SHAPE_FORMAT_FILL_OPACITY:return A0.FILL_OPACITY;case BA.SHAPE_FORMAT_FILL_COLOR:return A0.FILL_COLOR;case BA.SHAPE_FORMAT_BORDER_STYLE:return A0.BORDER_STYLE;case BA.SHAPE_FORMAT_BORDER_COLOR:return A0.BORDER_COLOR;}};var Bl={groupTitle:Bb,preBuildRendering:q,onRender:function(){this.reInit();},broker:Be,reInitDefault:function(){(this.listenFormatProps).forEach(function(Bo){this.onFmtPropsChanged(Bo,this.broker.getEditingPropertyVal(Bo));},this);},reInit:function(){this.reInitDefault();},preBuildRendering:function(){this.reInit();},onFmtPropsChanged:function(Bo,Bq,Bp){if(!Bq){Bq=Bh(Bo);}this.onFmtPropsChangedDefault(Bo,Bq,Bp);},syncControl:function(Bo){var Bp=this._sync;this._sync=true;var Bq=Bo.call(this);this._sync=Bp;return Bq;},onFmtPropsChangedDefault:q,onSelectorsValueChangedDefault:function(){this.reInit();},onSelectorsValueChanged:function(Bo,Bp){this.onSelectorsValueChangedDefault(Bo,Bp);}},Bi=Be.getEditingPropertyVal(Bg);if(!Bj){Z.copy({reInit:function(){if(Bm){this.getCtrlContainer().set("enabled",true);}else{this.setChildEnable(e,true);}this.reInitDefault();},onGroupValueChange:q,onFmtPropsChanged:function Bk(Bo,Bq){var Br=Bh(Bo);if(!Bq){Bq=Br;}if(Bg&&Bo===Bg){var Bp=!Bi;this.syncControl(function(){this.getChildComp(Bo).set("autoPreviewColor",Br);this.setChildValue(Bo,Bp?AU.VAL_AUTOMATIC:Bq);});}else{this.onFmtPropsChangedDefault(Bo,Bq);if(Bn&&Bo===Bn){this.setChildEnable(e,Bq!==mstrmojo.gmaps.EnumCombinedLineStyle.NONE);}}}},Bl);}return Bl;}var Ba=function Ba(Bj,Bg){if(Bg){Z.copy({col1Node:"58%",col2Node:"42%"},Bj.layoutConfig.w);var Bh=3;Z.copy({cssText:"margin-left: "+Bh+"px;",getLayoutOffsets:function Bi(){return{h:0,w:Bh};}},Bj.getCtrl());}return Bj;};var BV=function(Bn){var Bl=this,Bi={fillColor:BA.SHAPE_FORMAT_FILL_COLOR,fillAlpha:BA.SHAPE_FORMAT_FILL_OPACITY},Bp=Z.valarray(Bi),Bm=Z.copy({controlName:"shapeFillGroup",showGradient:false,smartNamesMap:Bi,showAutomaticInColor:true,listenFormatProps:Bp},BZ(Bn,Bi.fillColor,Bn));if(Bn){delete Bi.fillColor;Bm.visibleControls=W.FILL_TRANSPARENCY;}Bm.onGroupValueChange=function(Bq,Br){Bl.onPropertiesChanged(Bq,Br);};Bm.onFmtPropsChangedDefault=function(Bq,Br){this.syncControl(function(){if(R.filterOne(this.propNames,function(Bs){return(Bs===Bq);})){this.setChildValue(Bq,Br);}else{this.propNames.forEach(function(Bs){this.setChildValue(Bs,Be.getEditingPropertyVal(Bs));});}});};var Bh=this.addDisposable(new mstrmojo.ui.editors.controls.FillConfigGroup(Bm));Bh.iniChildrenComp(Bp);var Bg=null,Bj=Bi.fillAlpha,Bk=Bj&&Bh.getChildComp(Bj);if(Bk){Z.copy(t(Be,Bj),Bk);}if(Bn){var Bo=BO.call(this);Bg=this.getTwoColumnContainer([Bo,Bh],{col1Width:"60%",col2Width:"40%"});}else{Bg=Bh;}return this.getEditorGroup([new mstrmojo.Label({text:mstrmojo.desc(2885,"Fill")}),Bg],{showDivider:false,isNested:true,isContainer:true});}.bind(this);var BL=function(Bm,Bj){var Bn=null,Bk=this,Bi={lineColor:BA.SHAPE_FORMAT_BORDER_COLOR,lineStyle:BA.SHAPE_FORMAT_BORDER_STYLE},Bo=Z.valarray(Bi),Bg=Bm,Bl=Z.copy({lineTitle:mstrmojo.desc(9736,"Border"),controlName:"shapeBorderGroup",hideColorControl:Bm,showNoFillInColor:false,showAutomaticInColor:true,listenFormatProps:Bo},BZ(Bm,Bi.lineColor,Bm,Bi.lineStyle));if(Bm){delete Bi.lineColor;Bn=mstrmojo.desc(3538,"Border Style");Bl.lineTitle=null;}Bl.onGroupValueChange=function(Bp,Bq){Bk.onPropertiesChanged(Bp,Bq);};Bl.onFmtPropsChangedDefault=function(Bp,Bq){this.syncControl(function(){this.setChildValue(Bp,Bq);});};Bl.hideDashOptions=!!Bj;var Bh=this.addDisposable(new mstrmojo.ui.editors.controls.LineConfigGroup(Bl));Bh.iniChildrenComp(Bo);return Ba(Aw.call(this,Bh,Bn),Bg);}.bind(this);function BO(){var Bj=this.id,Bq=this.getHost(),Bo=Bq.zonesModel.getDropZones(true),Bk=Q.getMetricsInDropZone({dropZones:Bo.zones},k.ColorBy),Bm=Bk[0]||{},Bh=Bq.getEditingHost(),Bn=Bh.model.data,Bp=Bn.gsi,Bl=Bp.mx,Bg=Bl[R.find(Bl,"did",Bm.id)],Bi=Bp.thresholds[Bm.id];return new mstrmojo.vi.ui.ColorRangeSelector({thresholds:Bi,metric:Bg,onclick:function(){var Bt=mstrmojo.all[Bj],Br=Bt&&Bt.getHost(),Bs=Br&&Br.getEditingHost(),Bu,Bv;if(Bs&&Bs.model){Bu=Br.zonesModel;Bv=Bu&&Bu.canSupportImageThreshold();Bs.model.openThresholdEditor(Bm,true,Bv);}}});}switch(BW){case O.Bubble:BX=true;case O.Area:BM=BL(BN,BX);if(!(BS&&BR)){BU=BV(BN);BQ.push(BU,BM);}else{BQ.push(BM);}break;case O.Marker:if(!(BS&&BR)){BU=BV(BN);BQ.push(BU);}break;case O.Density:default:return null;}var BY=[Bb];if(BS&&BR){this.getColorByAttrControls(BY);}return this.getEditorGroup(BY.concat(BQ),BP);},getDataLabelControls:function AD(){var BN=this.getGroupTitle(mstrmojo.desc(11993,"Data Labels")),BL=this.getDataLabelShowOptionControl(),BM=BL.disableCtrls;return this.getEditorGroup([BN,BL.control,this.getDataLabelShowAllCheckBoxControl(BM),this.getDataLabelCharacterControl(BM)],{isNested:true,showDivider:true,isContainer:true});},getMapOptionControls:function AR(){var BL=[];if(mstrApp&&mstrApp.enableImageMap&&z.indexOf(AW.Image)===-1){z.push(AW.Image);}BL.push(this.getBaseMapControls());this.graphicLayersControl=this.getGraphicLayersControls();BL.push(this.graphicLayersControl);BL.push(this.getMoreOptionsControl());return[this.getEditorGroup([this.getEditorGroup(BL)],{showDivider:true,isNested:true,isContainer:true})];},addDensityControls:function F(BN){var BL=this.getDensityThemes(),BM,BO;if(BL&&BL.length>0){BM=Av.call(this,AS.themeType);BO=new mstrmojo.ui.CheckList({cssClass:"mem-density-list",orientation:"h",items:BL,multiSelect:false});BO.set("selectedIndex",this.getDensityThemeSelectedIndex());BO.postselectionChange=function(BP){BM(BL[BP.added[0]]);};BN.push(r.call(this,mstrmojo.desc(11839,"Density map color gradient:")));BN.push(BO);}},getDataLabelExtraControlProps:mstrmojo.emptyFn,getDataLabelControlConfig:function As(){return V+p+Aj;},getDataLabelCharacterControl:function AX(BO){var BS,BR=this,BQ=this.getHost(),BM=BQ.getEditingGridKey(),BL=BQ.getProperties(BM),BN={enabled:!BO,visibleControls:this.getDataLabelControlConfig()},BP={};BP[AF.FONT_WEIGHT]=BF.FS_BOLD;BP[AF.FONT_STYLE]=BF.FS_ITALIC;BP[AF.UNDERLINE]=BF.FS_UNDERLINE;BP[AF.LINE_THROUGH]=BF.FS_STRIKETHROUGH;BN.onGroupValueChange=function(BU,BV){var BW,BT=BV;switch(BU){case AF.COLOR:BW=H.DATA_LABEL_FONT_COLOR;BT=BV==="transparent"?BV:Ad.encodeColor(BV);break;case AF.FONT_SIZE:BW=H.DATA_LABEL_FONT_SIZE;break;case AF.FONT_FAMILY:BW=H.DATA_LABEL_FONT_FAMILY;break;case AF.FONT_WEIGHT:case AF.FONT_STYLE:case AF.UNDERLINE:case AF.LINE_THROUGH:BW=H.DATA_LABEL_FONT_STYLE;BT=BV?(BL[BW]|BP[BU]):(BL[BW]&(~BP[BU]));break;}BR.onPropertiesChanged(BW,BT);};BS=new mstrmojo.ui.editors.controls.CharacterGroup(Z.copy(this.getDataLabelExtraControlProps(),BN));BS.setFormatSource(BH(BL));return BS;},getFontFormats:BH,getDataLabelShowOptionControl:function Af(){var BP,BQ,BN=false,BL=false,BT=this,BW=this.getHost(),BR=BW.getGraphicLayer(),BU={multiSelect:true,showIcon:false},BS=BW.getEditingGridProps(),BM=[{n:mstrmojo.desc(2057,"None"),v:Ax.NONE}],BO={txt:{n:mstrmojo.desc(1013,"Text"),v:Ax.SHOW_TEXT},val:{n:mstrmojo.desc(2175,"Values"),v:Ax.SHOW_VALUE}};if(BR){if(BR.showDataLabelValues()){BM.unshift(BO.val);}if(BR.showDataLabelText()){BM.unshift(BO.txt);}}BQ=BM.length;if(BQ===1){BM.splice(0,0,BO.txt,BO.val);BL=true;}BU.items=BM;if(BL){BU.enabled=false;}BU.postselectionChange=function(BX){if(this._sync){return ;}this._sync=true;var BZ,Ba,BY;if(BX.added){if(this.items[BX.added[0]].v===Ax.NONE){for(BZ=0;BZ<BQ-1;BZ++){if(this.selectedIndices[BZ]){this.removeSelect(BZ);}}}else{if(this.selectedIndices[BQ-1]){this.removeSelect(BQ-1);}}}else{if(BX.removed){BY=true;for(BZ=0;BZ<BQ;BZ++){if(this.selectedIndices[BZ]){BY=false;break;}}if(BY){this.addSelect(BQ-1);}}else{mstr_profile.log("Should never happen");}}Ba=BM.reduce(function(Bd,Bc,Bb){return this.selectedIndices[Bb]?(Bd|Bc.v):Bd;}.bind(this),0);BT.onPropertiesChanged(H.DATA_LABEL_SHOW,Ba);this._sync=false;};BP=new mstrmojo.ui.ButtonBar(BU);var BV=function(BY){var BX;this._sync=true;if(BY===Ax.NONE){this.singleSelectByField(BY,"v");BN=true;}else{BX=(this.items||[]).map(function(Ba,BZ){return(BY&Ba.v)>0?BZ:null;}).filter(function(BZ){return BZ!==null;});if(BX.length<=0){this.singleSelectByField(Ax.NONE,"v");BN=true;}else{this.select(BX);}}this._sync=false;}.bind(BP);BV(BS[H.DATA_LABEL_SHOW]);return{control:BP,disableCtrls:BL||BN};},getDataLabelShowAllCheckBoxControl:function S(BM){var BR=this,BT=this.getHost(),BQ=BT&&BT.getEditingGridProps(),BO=H.DATA_LABEL_SHOW_ALL,BP=new mstrmojo.ui.Checkbox({checked:!BQ[BO],oncheckedChange:function BL(BU){BR.onPropertiesChanged(BO,!BU.value);}}),BN=this.getLabelAndControl(mstrmojo.desc(14606,"Hide overlapping labels"),BP,"14px","100%",true,{enabled:!BM}),BS=BN.getLabel();BS.onclick=function(){BP.onclick();};return BN;},fnGetPulldown:function AH(BM,BL,BR,BP,BN){var BQ,BO;if(BM&&BM.length){BO=mstrmojo.ui.Pulldown.newPulldown(BM,Av.call(this,BP),BL,{isHostedWithin:false});if(BN){BQ=this.getEditorGroup([r.call(this,BR),BO],{showDivider:BN.showDivider,isNested:BN.isNested,isContainer:BN.isContainer});}else{if(BR!=undefined){BQ=this.getLabelAndControl(BR,BO);}else{BQ=BO;}}}return BQ;},onBaseMapTypeChange:function A2(){this.replaceChildControls(this.baseMapOptionsControls,this.getBaseMapOptionsControls());},destroy:function G(){delete this.baseMapOptionsControls;delete this.mapStyleControl;delete this.graphicLayersControl;delete this.graphicLayerOptionsControls;this._super();}});function r(BL){return new mstrmojo.Label({text:BL,cssClass:"prop-title"});}function A9(BN,BL){var BO=this.getHost(),BP,BM;if(BN===O.Marker||BN===O.Bubble||BN===O.Density){BP=BO.getEditingDropZoneItems(k.GeoAttribute);if(BP&&BP.length>0){BM=BO.getEditingDropZoneItems(BL);if(!BM||BM.length<=0){return true;}}}return false;}function AQ(BL){return(BL===O.Bubble||BL===O.Area);}function AA(BM,BL){return R.filterOne(BM.fs,function(BN){return BL(BN.fnm,BN.fgr)&&BN.obf;});}function A1(BL){return AA(BL,BJ.isLatitude);}function K(BL){return AA(BL,BJ.isLongitude);}function Av(BL){var BM=this.id;return function(BN){mstrmojo.all[BM].onPropertiesChanged(BL,BN.id);};}function BH(BN){var BM,BL={},BO=BN[H.DATA_LABEL_FONT_STYLE];BL[AF.FONT_WEIGHT]=(BO&BF.FS_BOLD)>0;BL[AF.FONT_STYLE]=(BO&BF.FS_ITALIC)>0;BL[AF.UNDERLINE]=(BO&BF.FS_UNDERLINE)>0;BL[AF.LINE_THROUGH]=(BO&BF.FS_STRIKETHROUGH)>0;BM=BN[H.DATA_LABEL_FONT_COLOR];BL[AF.COLOR]=BM==="transparent"?BM:Ad.decodeColor(BM);BL[AF.FONT_SIZE]=BN[H.DATA_LABEL_FONT_SIZE];BL[AF.FONT_FAMILY]=BN[H.DATA_LABEL_FONT_FAMILY];return BL;}}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.form","mstrmojo._IsDocController","mstrmojo.AdvancedSortEditor","mstrmojo._DocToolbarActions","mstrmojo.func","mstrmojo.vi.controllers.UICmdMgr","mstrmojo.fe._HasFilterEditor");var H=3,j="mstrmojo-advancedSort";var W=mstrmojo.func,c=mstrmojo.array;mstrmojo.rw.DocController=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsDocController,mstrmojo._DocToolbarActions,mstrmojo.fe._HasFilterEditor],{scriptClass:"mstrmojo.rw.DocController",start:function E(){var k=this.model;k.lastSavedStid=k.stid||0;this.cmdMgr=new mstrmojo.vi.controllers.UICmdMgr({controller:this,model:k});this.cmdMgr.dataService=k.getDataService();},onCmdMgrChanged:function f(){},getSorts:function A(n){var l=[],k=n.axis-1,m=[],o=[];l[k]=m;m.push({key:n.sortKey,isAsc:n.isAsc});o[k]=n.subTotalsPos;return{sorts:l,subTotalsPos:o};},onSort:function Q(k,m){var l=this.getSorts(m);this.onAdvancedSort(k,l.sorts,l.subTotalsPos,m.stt);},onAdvancedSort:function h(l,m,k,n){l.model.sort({sorts:m,stp:k,stt:n},this._getXtabCallback(l));},onGetAdvSortData:function D(l,o,n,q){var p=this,k=function k(s,r){var w=mstrmojo.all[j]||mstrmojo.insert({scriptClass:"mstrmojo.AdvancedSortEditor",id:j,postCreate:function z(){if(mstrmojo.dom.isIE8){mstrmojo.css.addWidgetCssClass(this,"ie8");}}});var AA=s;if(r&&r.ndeForms){var v,x,t=[];var u=l.gridInfo;if(c.find(u.rows||[],"did",r.did)>=0){v="rows";}else{v="cols";t=AA&&AA[v].length>0?AA[v][0].v.split("!"):[];}AA=AA||{rows:[],cols:[],appliedRows:[],appliedCols:[],hierarchicalSort:{}};x=AA[v];t[0]=r.t;t[1]=r.did;c.forEach(r.ndeForms||[],function(AC){if(AC.obf){t[2]=AC.fid;t[3]=AC.t;var AD=t.join("!");var AE=r.n+" ("+AC.fnm+")";var AB=c.find(x,"v",AD);if(AB<0){x.push({n:AE,v:AD});}else{x[AB].n=AE;}}});}w.set("sortData",AA);w.set("controller",p);w.set("xtab",l);w.set("sourceAxis",o||1);w.set("sourceType",n||-1);w.open();};l.model.getAdvSortData({partialDisplayKeys:l.k,gridStyle:"AdvSortDataStyle"},this.model.newCallback({success:function(r){k(r&&r.grids&&r.grids[0],q);},failure:function m(r){mstrmojo.alert(r.code+": "+r.message);}}));},onPivot:function g(k,l){k.model.pivot(this._addNodeKeyToAction(k,l),this._getXtabCallback(k));},onSubmitTemplateUpdates:function J(k,l,m){k.model.submitTemplateActions(k.k,l,W.wrapMethods(this._getXtabCallback(k),m));},onShowTotals:function Z(k,l){k.model.showTotals(this._addNodeKeyToAction(k,l),this._getXtabCallback(k));},onDrill:function X(k,o,q){var m=this.model,l=this.model.prefs,p=l.rtprnt,n=l.rtthld;if(o.isWithin){if(!this.isInRequest()){o.retainParent=isNaN(p)?"":p;this.submitDrillWithin(k,o,q);}}else{if(!l.drillnw){mstrApp.showWait();}mstrmojo.form.send({evt:3125,displayMode:-1,drillPathKey:o.drillPathKey,elementList:o.drillElements,rwMesageID:m.mid,retainParent:isNaN(p)?"":p,retainThresh:isNaN(n)?"":n,rwGroupByElements:this.getGroupByElements(k).join(","),sliceId:k.sid||0},null,null,((l.drillnw)?"_blank":null));}},onDrillGraph:function d(k,o,q){var m=this.model,l=this.model.prefs,p=l.rtprnt,n=l.rtthld;if(o.isWithin){if(!this.isInRequest()){o.retainParent=l.rtprnt;this.submitDrillWithin(k,o,q);}}else{if(!l.drillnw){mstrApp.showWait();}mstrmojo.form.send({evt:3126,drillPathKey:o.drillPathKey,retainParent:isNaN(p)?"":p,retainThresh:isNaN(n)?"":n,rwMesageID:m.mid,"3126.x":o.x,"3126.y":o.y,graphHeight:o.graphHeight,graphWidth:o.graphWidth,rwGroupByElements:this.getGroupByElements(k).join(","),sliceId:k.sid||0,displayMode:o.displayType||2},null,null,((l.drillnw)?"_blank":null));}},submitDrillWithin:function b(k,l,m){k.model.drillGrid(this._addNodeKeyToAction(k,l),mstrmojo.func.wrapMethods(this._getXtabCallback(k),m));},onExecuteNewObject:function O(l,n){if(n){var k={};if(n.objType===H){k.evt=4001;k.reportID=n.did;k.reportViewMode=1;if(n.forceExec){k.execFlags=1;k.doNotUpdateCaches=true;}}else{k.evt=2048001;k.objectID=n.did;if(n.forceExec){k.freshExec=true;k.doNotUpdateCaches=true;}}if(n.linkAnswers){k.linkAnswers=n.linkAnswers;}mstrmojo.form.send(k,null,"POST",null);}},onReExecute:function(k,n){var l=k.model,m={evt:2048030,src:l.bp+".2048030",rwb:l.bs};if(n){m.ignoreStatus=true;mstrmojo.form.send(m,null,"POST",null);}else{mstrmojo.form.send(m,null,"POST",null);}},isAutoRefreshEnabled:function R(){return this.model&&this.model.rf;},isAutoRefreshStarted:function G(){return !!this.autoRefreshHandler;},startAutoRefresh:function M(){var k=this.model,l=k.rf,m=this;if(this.autoRefreshHandler){this.stopAutoRefresh();}this.autoRefreshHandler=setTimeout(function(){k.getDataService().refresh({sessionState:mstrApp?mstrApp.sessionState:""},{success:function n(o){if(k.clearDisposables){k.clearDisposables();}k.loadLayout(o);if(m.autoRefreshHandler){m.startAutoRefresh();}}});},l*1000);},stopAutoRefresh:function P(){clearTimeout(this.autoRefreshHandler);this.autoRefreshHandler=null;},offlineTransactionsSubmitted:function C(k){},transactionDiscarded:function I(k){},openOfflineTransactions:function N(){},invalidClientCache:function a(){},confirmMsgBeforeSubmit:function S(){},onLink:function B(r,m){if(m.link){var n,t,q=m.link,l=(q.prms?q.prms.length:0);for(n=0;n<l;n++){t=q.prms[n];if(t.pa&&t.pa.v){t.pa.v=mstrmojo.string.decodeHtmlString(t.pa.v,false);}}var s=m.link.toXml();if(s){m.linkAnswers=s;}delete m.link;}if(m.linkInfo&&m.linkInfo.so>0){m.originMessageID=this.model.mid;if(!m.linkAnswers){m.promptAnswerMode="0";}m.selectorMode=m.linkInfo.so;}var p=m.target||m.linkTarget||"_self",o=!mstrmojo.isUrlExternal(m.url||"");if(p==="_self"&&(o||(m.linkInfo&&m.linkInfo.target))){mstrApp.showWait({showCancel:true,onCancel:mstrApp.hideWait});}if(m.url){if(m.url.toLowerCase().indexOf("javascript:")>=0&&!mstrConfig.isLinkJSEnabled){return ;}if(mstrApp.isSingleTier){window.FormWrapper.openPage(m.url);}else{if(m.submitAsPost||m.url.length>2083){var k=mstrmojo.form.createDynamicForm(m.url);k.target=p;k.submit();}else{window.open(m.url,p);}}}else{mstrmojo.form.send(m,null,"POST",p);}},onTransactionUpdates:function e(m,o,n,k){var l={name:"TransactionUpdates",ctlKey:k};if(n){m.autoRefresh(l);}},onDownloadGridData:function K(k,l,m){this.model.downloadGridData(this._addNodeKeyToAction(k,l),m);},onGroupBy:function L(k,o){var m=k.model,l=o.groupbyKey,n=false;o.flags=m.agb===2?2:0;n=!!o.flags;m.getDataService().changeDocGroupBy(o,{success:function(p){if(n){k.parent.parent.unloadGbLayuts(l);}m.loadLayout(p);}});},_getAdvSortCallback:function(m,k){var p=this,o=p.model,l=function l(r){var s=mstrmojo.all[j];if(!s){s=mstrmojo.insert({scriptClass:"mstrmojo.AdvancedSortEditor",gridData:r,controller:p,model:o,xtab:m,subTotalsPos:k});}else{s.set("gridData",r);}s.open();};return o.newCallback({submission:mstrmojo.emptyFn,success:function q(r){l(r.grids[0]);},failure:function n(r){mstrmojo.alert(r.code+": "+r.message);},complete:mstrmojo.emptyFn});},onXtabColumnsResized:function U(k,l){k.model.resizeXtabColumn(this._addNodeKeyToAction(k,l));},addScrollPosition:function V(k,m,l){if(window.sessionStorage){window.sessionStorage.setItem("sp."+k,JSON.stringify({x:m,y:l}));}},getScrollPosition:function Y(k){var l=(window.sessionStorage&&window.sessionStorage.getItem("sp."+k));if(l){l=JSON.parse(l);}return l;},onRemoveUnit:function F(k,l){k.model.removeUnit(this._addNodeKeyToAction(k,l),this._getXtabCallback(k));}});}());(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils","mstrmojo.vi.models.editors.MapEditorModel","mstrmojo.Label","mstrmojo.expr","mstrmojo.array","mstrmojo.models.FormatModel","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl","mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl");var b=mstrmojo,q=b.mapbox.EXCLUDED_FONT_FAMILIES,I=b.gmaps,c=mstrmojo.array,B=I.MapUtils,L=I.EnumMarkerType,E=I.EnumPropertyType,X=I.EnumClusterMode,h=I.EnumGraphicType,R=I.EnumLanguageType,f=I.EnumDistUnitType,A=I.TARGET_FORMATTING_LAYERS,d=mstrmojo.expr.DTP,M=[{id:f.KM,n:mstrmojo.desc(15733,"km")},{id:f.Miles,n:mstrmojo.desc(11140,"miles").toLowerCase()}];var l=1,N=4;mstrmojo.vi.models.editors.MapboxEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.MapEditorModel,null,{scriptClass:"mstrmojo.vi.models.MapboxEditorModel",help:"Format_Panel_Geospatial_Service.htm",getInitialTarget:function n(){return A;},getTargetPulldownItems:function k(r){var u=this._super(r),t=this.getHost(),s=this,v=function(){var w=s.getFormattingLayerControls;s.replaceChildControls(r,w.call(s));};if(t.isBaseMapValid()&&!(t.excludeData||t.isEmpty())){u.unshift({n:mstrmojo.desc(15734,"Formatting on layer"),v:A,h:v});}return u;},getMapLabelsControls:function o(){var r=[],s=this.getHost();r.push(this.getGroupTitle(mstrmojo.desc(15925,"Map Labels")));r.push(this.getMapboxCheckboxControl(E.showMapLable,mstrmojo.desc(15735,"Show map labels")));r.push(this.getMapboxCheckboxControl(E.mapLabelOnTop,mstrmojo.desc(15736,"Bring map labels to front")));var t=this.fnGetPulldown(this.getLanguageTypes(),this.getSelectedLanguageIndex(),mstrmojo.desc(13111,"Language"),E.languageType);t.set("enabled",s.getPropertyValue(E.showMapLable));r.push(t);return r;},getZoomingFunctionControls:function K(){var r=[],s=this.getHost();r.push(this.getGroupTitle(mstrmojo.desc(15926,"Zooming Function")));r.push(this.getZoomControls());r.push(this.getKeepZoomLevelandPosCtrl());if(s.isZoomThroughLayerCtrlShown&&s.isZoomThroughLayerCtrlShown()){r.push(this.getZoomThroughLayersControls());}return r;},getGeoUnitControls:function F(){var r=[];r.push(this.fnGetPulldown(M,this.getSelectedDistUnitIndex(),mstrmojo.desc(15737,"Geo unit"),E.distUnit,{isNested:true,showDivider:true,isContainer:true}));return r;},getMapOptionControls:function P(){var r=[];r.push(this.getMapStyleControls());r.push(this.getEditorGroup(this.getMapLabelsControls(),{isNested:true,showDivider:true,isContainer:true}));r.push(this.getEditorGroup(this.getZoomingFunctionControls(),{isNested:true,showDivider:true,isContainer:true}));r.push(this.getEditorGroup(this.getGeoUnitControls(),{isNested:true,showDivider:true,isContainer:true}));r.push(this.getMoreOptionsControl());return[this.getEditorGroup([this.getEditorGroup(r)],{showDivider:true,isNested:true,isContainer:true})];},getFormattingLayerControls:function S(){var r=[];if(!mstrApp.isInVFConfigMode){this.mapLayersPullDown=this.getMapLayersPullDown();r.push(this.mapLayersPullDown);}r.push(this.getGraphicLayerOptionsControls());return[this.getEditorGroup([this.getEditorGroup(r)],{showDivider:true,isNested:true,isContainer:true})];},getMapboxCheckboxControl:function G(u,AA){var x=this,AB=this.getHost(),w=AB&&AB.getProperties(),r=!!(w&&(w[u]===true||w[u]==="true")),v=new mstrmojo.ui.Checkbox({checked:r,oncheckedChange:function s(AC){x.onPropertiesChanged(u,AC.value);}}),t=this.getLabelAndControl(AA,v,"10px","100%",true,{enabled:this.isBmpLabelCtrlEnabled(u)}),z=t.getLabel();z.onclick=function(){v.onclick();};return t;},isBmpLabelCtrlEnabled:function O(w){var v=this.getHost(),s=!!(v&&v.isLbGrpEstInBaseLayer()),u=E.showMapLable,t,r;if(w===u){return s;}else{t=v&&v.getProperties();r=!!(t&&(t[u]===true||t[u]==="true"));return s&&r;}},getSelectedDistUnitIndex:function H(){var t=this.getHost(),s=t&&t.getProperties(),u=s&&s[E.distUnit],r=0;if(u===undefined){u=t.getDefaultDistanceUnit();}switch(u){case f.KM:default:r=0;break;case f.Miles:r=1;break;}return r;},getMapLayersPullDown:function J(){var s=this.getHost(),r=s.getGraphicLayerNameArr();c.forEach(r,function(u,t){u.id=t;});return this.fnGetPulldown(r,s.getEditingLayerIdx(),undefined,E.editingLayerIdx);},selectLayerForRMCFmt:function W(r){if(this.mapLayersPullDown&&r){this.mapLayersPullDown.selectItemByField("k",r);}},getLanguageTypes:function e(){return[{id:R.Local,n:mstrmojo.desc(14937,"Local")},{id:R.English,n:mstrmojo.desc(1376,"English")},{id:R.Both,n:mstrmojo.desc(1376,"English")+" + "+mstrmojo.desc(14937,"Local")}];},getSelectedLanguageIndex:function V(){var s=this.getEditingPropertyVal(E.languageType),r=1;switch(s){case R.Local:r=0;break;case R.English:r=1;break;case R.Both:r=2;break;default:break;}return r;},getGraphicTypes:function p(){return[{n:mstrmojo.desc(13254,"Marker"),id:h.Marker},{n:mstrmojo.desc(348,"Bubble"),id:h.Bubble},{n:mstrmojo.desc(13255,"Area"),id:h.Area}];},getGraphicTypeSelectedIndex:function Z(s){var r=0;switch(s){case h.Marker:r=0;break;case h.Bubble:r=1;break;case h.Area:r=2;break;default:break;}return r;},getMarkerTypes:function g(){return[{n:mstrmojo.desc(12100,"Circle"),id:L.Circle},{n:mstrmojo.desc(11837,"Pins"),id:L.Pin},{n:mstrmojo.desc(154,"Squares"),id:L.Square},{n:mstrmojo.desc(14746,"Diamonds"),id:L.Diamond},{n:mstrmojo.desc(14747,"Images"),id:L.Image}];},getMarkerTypeSelectedIndex:function U(){var s=this.getEditingPropertyVal(E.markerType),r=0;switch(s){case L.Circle:r=0;break;case L.Pin:r=1;break;case L.Square:r=2;break;case L.Diamond:r=3;break;case L.Image:r=4;break;default:break;}return r;},getValidationTextBoxWithUnitControl:function Y(t,s,r){r=r||{col1Width:"100%",col2Width:"12px"};return this.getTwoColumnContainer([new mstrmojo.ui.editors.controls.ValidationTextBox(t),new mstrmojo.Label(s)],r);},getClusteringControlForMarker:function a(){return this.getClusteringControls();},getClusteringControlForBubble:function j(){return this.getClusteringControls();},getClusteringControls:function D(AB){var v=this,AC=this.getHost(),w=AC&&AC.getEditingGridProps(),t=E.clusterMode,s=this.getGroupTitle(mstrmojo.desc(11841,"Clustering")),u=function(){return w[t]===X.ON;},AA=this.getCheckboxAndLabel(u(),mstrmojo.desc(15705,"Enable Clustering"),function(AD){var AE=AD?X.ON:X.OFF;v.onPropertiesChanged(t,AE);}),x=this.getTwoColumnContainer([new mstrmojo.Label({text:mstrmojo.desc(15738,"Cluster radius"),enabled:u()}),this.getValidationTextBoxWithUnitControl({alias:"clusterRadius",required:true,errRevert:false,dtp:d.INTEGER,constraints:{min:1,max:300,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},getInvalidMsg:function(){return mstrmojo.desc(15739,"Cluster radius should be integer between 1 and 300");},useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C mapbox_cluster_radius",left:this.domNode.offsetWidth+6+20,top:-4,refNode:this.domNode,keepArrowYPos:true,content:'<div class="name">'+mstrmojo.desc(15740,"All points within the radius of R pixels will be clustered.")+'</div><div class="cluster_radius_img"></div>'};return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+6+20,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};},validationDelay:1500,value:parseInt(w[E.clusterRadius],10)||50,enabled:u(),onValid:function(){v.onPropertiesChanged(E.clusterRadius,this.value);}},{text:"px",enabled:u()})]),r=new mstrmojo.Label({text:mstrmojo.desc(15741,"Set zoom level for clustering"),enabled:u()}),z=new mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl({host:AC,enabled:u()});return this.getEditorGroup([s,AA,r,z,x],{isNested:true,showDivider:true,isContainer:true});},getZoomThroughLayersControls:function Q(){var v=this,u=this.getHost(),w=E.enableZoomThroughLayer,r=function(){return B.parseBoolean(u.getPropertyValue(w));},s=this.getCheckboxAndLabel(r(),mstrmojo.desc(15742,"Zoom through layers"),function(x){v.onPropertiesChanged(w,x);}),t=new mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl({host:u,enabled:r()});s.cssClass="";return this.getEditorGroup([s,t],{isNested:true,showDivider:false,isContainer:true});},getDataLabelControlConfig:function C(){return l+N;},getDataLabelExtraControlProps:function m(){return{getFontFamilyItems:B.getFontFamilyItems.bind(this,q),getFontStyleItems:function(){return[{n:mstrmojo.desc(2718,"Bold"),id:"b",css:"bold"},{n:mstrmojo.desc(2719,"Italic"),id:"i",css:"italic"}];}};}});}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.num","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.ui.Pulldown","mstrmojo.tooltip","mstrmojo.gm.GMUtility","mstrmojo.VisUtility","mstrmojo.NumStepperContentProvider","mstrmojo.ui.CheckList","mstrmojo.vi.ui.rw.selectors.CheckList","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.Menu","mstrmojo.gm.GMEnums","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.Stepper","mstrmojo.ui.editors.controls.CustomRange","mstrmojo.ui.editors.controls.GMReferenceLineList","mstrmojo.Button","mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.ColorRangeSelector");var Bn="[undefinedIdentity]",f=0;var Cl=mstrmojo.emptyFn,CJ=mstrmojo.Widget,Cb=mstrmojo.array,Az=mstrmojo.hash,CB=mstrmojo.css,AT=mstrmojo.func,C=mstrmojo.num,B5=mstrmojo.gm,Aq=mstrmojo.VisUtility,s=mstrmojo.expr.DTP,CZ=B5.GMUtility,CF=B5.EnumSelectionOptionLevel,Ac=B5.WidgetPropertyTag,Cv=B5.FormatingPropertyTag,A9=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,AE=mstrmojo.chart.enums.EnumFontStyle,BO=B5.EnumIdentityType,CH=B5.EnumShape,Ao=B5.EnumFitTo,Ct=B5.EnumSubtype,E=B5.EnumSelectionOptionLevel,c=mstrmojo.ui.editors.controls.CharacterGroup.CTRL_FLAGS,W=mstrmojo.ui.editors.controls.AdvancedColorPicker,B=B5.EnumContainerFitModes,CA=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS,B0={isNested:false,showDivider:false},BD={isNested:false,showDivider:true},CX={propagateChildProps:function(Cx){if(Cx!=="enabled"){this._super();}}};var B7=Ac.AXIS_SCALE_DATA,t=Ac.AXIS_ORIGIN;var CO=1,AN=2,Bg=4,Am=8,Ai=16,BB=32,Bb=64,z=128,Cc=256,u=512,AD=1024,b=2048,L=4096,Bo=8192,Bf=16384,CU=32768,B3=65536,AM=131072,AZ=262144,AG=524288;var Y="de",CQ="tln",Bs="rln",BA=mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE,CR="sp",Bt="ax",O="lgd",AW="rcl",BG="bp",BU="hst",Cj="wf";var x="panel",Aa="selector";var AY="default";var B8="selAxSc4",Br="selBdrMtxLn4",BT="selBgFill4",BW="rwColBgFill4",BQ="selAxLbl4",AJ="selAxLn4",Au="selAxTil4",CT="selGL4",G="selRwCl4",At="selTln4",p="selRfMtcln4",BF="selRfTyln4";var Aw="@",Co=":",H="#",Aj="_default",BV="rwTxt",AC="colTxt",BE="rwHdr",Bq="colHdr",By="allTxt",o="lgd",Bj="lgdBg",Bx="shp",n="shpBdr",CK="dl",BS="allAxLb",Bl="xAxLb",N="yAxLb",A8="FntFml",V="FntStyle",CC="FntSz",Cp="FntClr",BI="Rtt",Bh="Shw",Bm="Clr",As="CmbStyle",A7="FillClr",r="FillTrans",Cm="TxtAlignH",Be="TxtAlignV",Ar=1,BK=0,Ck=1;var A3=[{n:mstrmojo.desc(11980,"Per cell"),v:B5.EnumTrendRefLevel.DssModelLevelPerCell},{n:mstrmojo.desc(11981,"Per row"),v:B5.EnumTrendRefLevel.DssModelLevelPerRow},{n:mstrmojo.desc(11982,"Per column"),v:B5.EnumTrendRefLevel.DssModelLevelPerColumn},{n:mstrmojo.desc(11983,"Entire table"),v:B5.EnumTrendRefLevel.DssModelLevelPerPanel}];var A2="propEditor-Menu";var A1=false;function Av(Cx){if(A1&&window.console){window.console.log(Cx);}}function Ak(Cx){Av(Cx);return undefined;}var R={IN_FORMATTING_MODE:"inFmtMode",SELECTED_CATEGORY:"selCat"},D={};function B1(Cx){(Cx||[]).forEach(function(Cy){Cy.onHighlightObjChange(f);});}function AI(Cz,Cy){var Cx=Cy?CB.addClass:CB.removeClass;Cx(Cz.domNode,"hilight");}function A5(C1,C0,Cy){var Cz=C0,Cx;for(;Cz>0;Cz--){Cx=Array(Cz+1).join("#");C1=C1.replace(Cx,Cy[Cz-1]);}return C1;}function v(Cx){return function(){var Cz=(Cx&&Cx._hilightObjListens);if(Cz){B1(Cz);}if(!Cx.host.formattingMode){return ;}if(this.groupTitle){AI(this.groupTitle,true);}var Cy=((this.groupTitle&&this.groupTitle.scopeSelectors&&this.groupTitle.scopeSelectors[0])||(this.scopeSelectors&&this.scopeSelectors[0]));if(Cy){Cx.sendNonShapeTargetSelectionIdentity(Cy);}};}function A0(Cy,Cx){return Cy.some(function(Cz){return CZ.longIntAnd(Cz,Cx)===Cz;});}function M(Cx){while(Cx&&Cx.parentIdentity){Cx=Cx.parentIdentity;}return Cx;}function Ba(Cy,Cx){var Cz=[];(Cy||[]).forEach(function(C0){if(Cz.length===0&&Cx){Cz.push({n:C0.opt,identity:Cx,v:C0});}else{Cz.push({n:C0.opt,v:C0});}});return Cz;}function CP(Cx){return(Cx||[]).map(function(Cy){return Az.copy(Cy,{v:Cy});});}function U(){return Ba(this.getHost().getNumericAxisOptions(true));}function A4(){return Ba(this.getHost().getReferenceAxisOption());}function Cw(){return Ba(this.getHost().getDependentMetricOptions());}function BP(){return Ba(this.getHost().getIndependentMetricOptions());}function w(C1,C0){var Cy=this.broker,Cx=Cy.editorManager,Cz=this.getGroupTitle(C1);Az.copy({onHighlightObjChange:function(C3){var C2=this.highlightObjects;if(!C2){return Ak("[GroupTitle] "+C1+": not listen on any Highlight Objects but was registered as listener.");}AI(this,A0(C2,C3));},highlightObjects:[]},Cz);Az.copy(C0,Cz);Cx.registerGroupTitle(Cz);return Cz;}function Ay(Cz,Cx){var Cy=Cz._sync;Cz._sync=true;Cx.call(Cz);Cz._sync=Cy;}function F(C2,Cx,Cz,C5,C3){var C0=Az.copy(C3,{postclick:v(C5),updateSelection:function(C7,C9){var C8=this._sync;this._sync=true;var C6=-1,DA=f;this.items.forEach(function(DC,DB){var DD=DC.identity;if(A0([DD],C7)&&A0([DA],DD)){C6=DB;DA=DD;}});this.set("selectedIndex",C6);this._sync=C8;},isHostedWithin:false});var Cy=this.addDisposable(this.getPulldown(Cz,C0.fnChange||function(C6){C5.onTargetSelectionChanged(Cx,C6);if(this._sync){return ;}C5.sendNonShapeTargetSelectionIdentity(Cx);},0,C0));C5.registerSelector(Cx,Cy,C0.highlightObjects);if(typeof C2==="string"){var C4=!!this.usingSpecialFormat,C1=this.getLabelAndControl(C2,Cy,C4?"40%":"30%",C4?"60%":"70%");Cy.label=C1.getLabel();return C1;}return Cy;}function AA(Cx,Cy){return{broker:Cx,manager:Cx.editorManager,smartNames:Cy,controlName:Cy[0],reInitDefault:function(){(this.listenFormatProps).forEach(function(Cz){this.onFmtPropsChanged(Cz,this.broker.getFormatPropertyValue(Cz));},this);},reInit:function(){this.reInitDefault();},preBuildRendering:function(){this.reInit();},syncControl:function(Cz){var C0=this._sync;this._sync=true;var C1=Cz.call(this);this._sync=C0;return C1;},onFmtPropsChangedDefault:Cl,onFmtPropsChanged:function(Cz,C1,C0){this.onFmtPropsChangedDefault(Cz,C1,C0);},onSelectorsValueChangedDefault:function(){this.reInit();},onSelectorsValueChanged:function(Cz,C0){this.onSelectorsValueChangedDefault(Cz,C0);},postclick:v(Cx.editorManager),onHighlightObjChange:function(C0){var Cz=this.highlightObjects;if(!Cz||!Cz.length||!this.label){return Ak("[Control] "+this.controlName+": was registered as listener but does not listen on any Highlight Objects or has no label attached.");}AI(this.label,A0(Cz,C0));}};}function CS(C2,C0,Cy,Cx){if(!C2){return ;}function C1(C9){return Object.keys(Cb.hash(Cb.ensureArray(C9)));}var C4=C2.listenFormatProps||[],C6=C2.listenSelector||[];(C2.smartNames||[]).forEach(function(C9){Cb.insert(C4,null,C9);Cb.insert(C6,null,C2.broker.getDependingSelectorNames(C9));});C2.listenFormatProps=C1(C4);C2.listenSelector=C1(C6);C2.manager.registerFormatControl(C2);var C8=C2;if(typeof C0==="string"){var Cz=(Cy===Ck),C3=Cz?"20px":"30%",C5=Cz?"100%":"70%";if(Cx){C3=Cx[0];C5=Cx[1];}C8=this.getLabelAndControl(C0,C2,C3,C5,Cz);C2.label=C8.getLabel();if(Cz){C8.cssClass="checkLabel multiLine";C2.label.onclick=function C7(){if(C2.enabled){C2.onclick();}};C2.label.cssDisplay="inline-block";}else{if(Cy===BK){C8.cssClass="characterGroup";}}}C2.getCtrlContainer=function(){return C8;};return C8;}function AF(Cy,C3){var Cz=this.broker,C5=Cz.editorManager,C2=Cy.allItem,C1=Cy.metricItems,C4=Cy.colorByItems,Cx=true;if(C1.length<2&&C4.length<1&&(!Cz.getLocalState(R.IN_FORMATTING_MODE)||!Cz.getVisProfile(Bf))){Cx=false;}var C0=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown(Az.copy(C3,{selectorName:"shapeObjectSelector",visible:Cx,syncControl:function(C6){var C7=this._sync;this._sync=true;var C8=C6.call(this);this._sync=C7;return C8;},value:C4.length?C4[0]:C2,valueWas:null,onvalueChange:function(C6){var C7=C6.value;if(!C7){return ;}this.updateTooltip(this.selectedNode,C7.opt);if(!this._sync&&C7&&!(C7.optLvl===CF.COLOR_BY&&C7.key==="multiple")){C5.sendShapeOption(true);}C5.shapeFormatControls.forEach(function(C8){C8=C8.getCtrl?C8.getCtrl():C8;C8.reInit();});},updateSelection:function(C6){this.syncControl(function(){var C7=this.value;if(!C5.isShapeOptionEqual(this.value,C6)||(C7&&(C7.key==="multiple"||C7.optLvl===E.ITSELF))){this.set("value",Az.copy(C6));if(Cz.getLocalState(R.IN_FORMATTING_MODE)){this.set("valueWas",Az.copy(C6));}}});},updateTooltip:function(C8,DA){if(!C8){return ;}var C7={};C7.fontFamily=CB.getStyleValue(C8,"font-family");C7.fontSize=CB.getStyleValue(C8,"font-size");C7.fontStyle=CB.getStyleValue(C8,"font-style");C7.fontWeight=CB.getStyleValue(C8,"font-weight");var C9=Aq.measureTextWidth(DA,C7),C6=parseInt(CB.getStyleValue(C8,"width"));C8.title=C9>C6?DA:"";},onwidthChange:function(){if(this.selectedNode){this.updateTooltip(this.selectedNode,this.selectedNode.innerHTML);}},postBuildRendering:function(){if(this.selectedNode){this.updateTooltip(this.selectedNode,this.selectedNode.innerHTML);}},getDisplayText:function(C6){return(C6&&C6.opt)||"";},setShapeObjectOptions:function(C6){this.shapeObjectOptions=C6;},getMenuConfig:function(){var C9=this,DC=this.shapeObjectOptions||Cy,C8=DC.allItem,C7=DC.metricItems,DB=DC.colorByItems;function C6(DD){var DE=new mstrmojo.ui.menus.MenuConfig({menuCssClass:A2,newInstance:function(DF){return new mstrmojo.ui.menus.Menu(mstrmojo.hash.copy({popupConfig:this,themeClassName:mstrApp.getThemeClassName()},DF));}});(DD||[]).forEach(function(DF){DE.addMenuItem(C9.getDisplayText(DF),"",function(){C9.set("value",DF);});});return DE;}var DA=new mstrmojo.ui.menus.MenuConfig({menuCssClass:A2,hostId:C9.id,hostElement:C9.containerNode,isHostedWithin:false});Aq.absorbMenuItems(DA,C6([C8]));if(C7.length>1){if(DB.length>0){DA.addPopupMenuItem(mstrmojo.desc(962,"Metrics"),"",function(){return C6(C7);});DA.addSeparator();}else{Aq.absorbMenuItems(DA,C6(C7));}}if(DB.length>0){Aq.absorbMenuItems(DA,C6(DB));}return DA;}})));C5.shapeObjSel=C0;C5.sendShapeOption(true);return C0;}function B6(C4,Cx,Cy,C6,C5){var C0=this.broker,C7=C0.editorManager,C2=AA(C0,C6);function C3(C9,C8){return C0.generateSmartName(null,Ac.REF_LINE_DEF,C9,C8);}Az.copy({controlName:Cy,items:[],metricOpt:Cx,_toggleRefLineEnabled:function(C9,C8){var DA=C3(Ac.REF_ENABLED,C9.v);C0.setFormatPropertyValue(DA,C8);},reInitDefault:function(){this.syncControl(function(){this.set("items",this.broker.getOptionItems(this.controlName,this.metricOpt));if(this.items.length>0){this.selectItemByField("key",this.items[0].key);}});},generateNewRefLineItem:function Cz(C8,DB){var C9=C0.vis.getRealReferenceOptionFromAxisOption(this.metricOpt,C8),DA=Az.copy(C9,{v:C9});if(DA.refType===B5.EnumRefLineModelType.CONST){DA.c=C.parseNumeric(DB);}return DA;},onselectRefLine:function(C8){this.manager.onTargetSelectionChanged(Cy,C8);},onremoveRefLine:function(C8){if(this._sync){return ;}this._toggleRefLineEnabled(C8,false);},onrenameRefLine:function(C9){if(this._sync){return ;}var C8=C9.key;if(C9.refType===B5.EnumRefLineModelType.CONST){var DA=C3(Ac.REF_LINE_NAME,C9.v);C0.setFormatPropertyValue(DA,C9[Ac.REF_LINE_NAME]);}this.selectItemByField("key",C8);},onaddRefLine:function(C9){if(this._sync){return ;}var C8=C9.key;if(C9.refType===B5.EnumRefLineModelType.CONST){var DA=C3(Ac.REF_CONST_VALUE,C9.v);C0.setFormatPropertyValue(DA,C9.c);}else{this._toggleRefLineEnabled(C9,true);}this.selectItemByField("key",C8);},onFmtPropsChangedDefault:function(){this.syncControl(function(){var C9=this.getSelectedItem(),C8=C9&&C9.key;this.reInit();this.selectItemByField("key",C8);});},onSelectorsValueChangedDefault:function(C8,C9){if(C9!==this.metricOpt){this.metricOpt=C9;this.reInit();}}},C2);Az.copy(C5,C2);var C1=this.addDisposable(new mstrmojo.ui.editors.controls.GMReferenceLineList(C2));C7.registerSelector(Cy,C1,C2.highlightObjects);return CS.call(this,C1,C4);}function Ax(C0,Cz,Cy,C4){var Cx=this.broker,C3=[Cy],C1=AA(Cx,C3);Az.copy({showIcon:false,items:Cz,onFmtPropsChangedDefault:function(C5,C6){this.syncControl(function(){if(this.multiSelect){this.select((this.items||[]).map(function(C8,C7){return(C6&C8.v)>0?C7:null;}).filter(function(C7){return C7!==null;}));}else{if(typeof C6==="undefined"){this.clearSelect();}else{this.singleSelectByField(C6,"v");}}});},postselectionChange:function(C5){if(this._sync){return ;}var C6=C5.added&&this.items[C5.added[0]].v;if(this.multiSelect){if(!Cz||!Cz.length){return Ak("[GMEditorModel getBitwiseValFromMultiSelection] no items in caller");}C6=Cz.reduce(function(C9,C8,C7){return this.selectedIndices[C7]?C9|=C8.v:C9;}.bind(this),0);}this.broker.setFormatPropertyValue(this.smartNames[0],C6);}},C1);Az.copy(C4,C1);var C2=this.addDisposable(new mstrmojo.ui.ButtonBar(C1));return CS.call(this,C2,C0);}function Ci(C1,Cz){var C0="00000000000000000000000000000000",Cy=C1.dropZones,Cx=Cb.find(Cy,"id",Cz);return Cx===-1?[]:Cb.filter(Cy[Cx].items,function(C2){return C2.t===4&&C2.id!==C0;});}function BY(C5,C3,Cx,C6,C2){C6=C6||{};var C0=this.broker,C7=[Cx],C4=AA(C0,C7),Cz=C6.associatedPropValueTuples,Cy=C6.fnChange||function(C8){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],C8,undefined,undefined,Cz);};Az.copy({onFmtPropsChangedDefault:function(C8,C9){if(this.preFmtPropsChangedHook){C9=this.preFmtPropsChangedHook(C8,C9);}this.syncControl(function(){if(C9==="undefined"){this.set("selectedIndex",-1);}else{this.selectItemByField("v",C9);}});}},C4);Az.copy(C6,C4);var C1=this.addDisposable(this.getPulldown(C3,Cy,0,C4));return CS.call(this,C1,C5,null,C2||["40%","60%"]);}function Ae(C4,Cx,C5,Cz,Cy,C6){var C0=this.broker,C7=[Cy],C3=AA(C0,C7);var C2=function(){var C8;for(C8=Cx;C8<=C5;C8+=Cz){if((C8+Cz)>=C5){C8=C5;}this.items.push({n:C8.toFixed(2),v:C8});}};Az.copy({items:[],postCreate:C2,onselectionChange:C4,onFmtPropsChangedDefault:function(C8,C9){this.syncControl(function(){this.set("selectedIndex",C9);});}},C3);Az.copy(C6,C3);var C1=this.addDisposable(new mstrmojo.vi.ui.rw.selectors.Slider(C3));CB.addWidgetCssClass(C1,"rank");CB.addWidgetCssClass(C1,"jitter");C1.set("multiSelect",false);return CS.call(this,C1);}function AV(C4,C2,Cx,Cy,C3){var Cz=this.broker,C5=[Cx],C1=AA(Cz,C5);Az.copy({onClick:C2,onFmtPropsChangedDefault:function(C6,C7){this.syncControl(function(){this.set("value",C7);});}},C1);Az.copy(C3,C1);var C0=this.addDisposable(new mstrmojo.Button(mstrmojo.Button.newWebButton(C4,C2,Cy,C1)));return CS.call(this,C0);}function e(Cz,Cy,C3){var Cx=this.broker,C2=[Cy],C0=AA(Cx,C2);Az.copy({dtp:s.FLOAT,required:true,onValid:function(){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],C.parseNumeric(this.value));},onFmtPropsChangedDefault:function(C4,C5){this.syncControl(function(){this.set("value",C5);this.validate();});}},C0);Az.copy(C3,Az.copy(X(Cx,Cy),C0));var C1=this.addDisposable(new mstrmojo.ui.editors.controls.ValidationTextBox(C0));return CS.call(this,C1,Cz);}function AR(C0,Cz,C4,Cx){var Cy=this.broker,C3=[Cz],C1=AA(Cy,C3);Az.copy({provider:new mstrmojo.NumStepperContentProvider(Az.copy(Cx,{item:{interval:1},curVal:0,min:0,getInvalidMsg:function(){return mstrmojo.desc(14312,"This field accepts only integers greater than or equal to zero");},onTraverse:function(){var C5=this.parent,C6=this;if(C5._sync){return ;}if(this._lastTimeoutId){window.clearTimeout(this._lastTimeoutId);}this._lastTimeoutId=window.setTimeout(function(){delete C6._lastTimeoutId;C5.broker.setFormatPropertyValue(C5.smartNames[0],C6.curVal);},1000);},oncurValChange:function(){var C5=this.parent;if(C5.textNode){C5.updateDisplayText();}}})),preBuildRendering:function(){this.reInit();mstrmojo.ui.editors.controls.Stepper.prototype.preBuildRendering.call(this);},onFmtPropsChangedDefault:function(C5,C6){this.syncControl(function(){if(typeof C6==="undefined"){C6="";}this.provider.set("curVal",C6);});}},C1);Az.copy(C4,C1);var C2=this.addDisposable(new mstrmojo.ui.editors.controls.Stepper(C1));C2.provider.parent=C2;return CS.call(this,C2,C0,null,["40%","60%"]);}function Bv(Cy,Cx,C2){var C3=Cy.getFormatPropertyKey(Cx),C0=function(){var C5=Cy._resolveLevelOptionWithRuntime(C3),C4=[];if(C5.key==="AllMetrics"){C4.push(C5.mos[0].mId);}else{C5.mos.forEach(function(C6){C4.push(C6.mId);});}return C4;};var Cz,C1=C0();Cz=Cy.vis.formatAsAxisLabel(C1,C2);if(Cz!==undefined){return Cz;}return this.constructor.prototype.getConvertValue(C2);}function Bw(C3,C2,Cz){var Cy=String(C3),Cx=String(C2),C8=mstrmojo.locales.number.DECIMALSEPARATOR,C7=Cy.split(C8)[1],C5=Cx.split(C8)[1],C1=C7?C7.length:0,C0=C5?C5.length:0,C6=Number(Cy.replace(C8,"")),C4=Number(Cx.replace(C8,""));if(Cz){return C6*C4/Math.pow(10,C1+C0);}else{return Bw(C6/C4,Math.pow(10,C0-C1),true);}}function BX(C4,C2,Cy,Cx,C5){var C1=[mstrmojo.desc(11976,"Global"),mstrmojo.desc(11985,"Per row/column"),mstrmojo.desc(11980,"Per cell"),mstrmojo.desc(13871,"Custom..."),mstrmojo.desc(13661,"Different")];var Cz=this.broker,C6=[C2],C3=AA(Cz,C6);Az.copy({getMenuConfig:function(){var C7=this,C8=Az.valarray(B5.EnumAxisScale).slice(0,3),C9=new mstrmojo.ui.menus.MenuConfig({menuCssClass:A2,hostId:C7.id,hostElement:C7.containerNode,isHostedWithin:false});C8.forEach(function(DA){C9.addMenuItem(C7.getDisplayText(DA),"",function(){C7.set("value",DA);});});C9.addPopupMenuItem(C7.getDisplayText(B5.EnumAxisScale.CUSTOM),"",function(){var DA=Cy,DD=Cx,DB={},DG={},DC=Cz.getVisProfile(Cc),DE=DC?100:1;Az.keyarray(DA).forEach(function(DH){DB[DH]=Bw(Cz.getFormatPropertyValue(DA[DH]),DE,true);});Az.keyarray(DD).forEach(function(DH){DG[DH]=Cz.getFormatPropertyValue(DD[DH]);});var DF=DC?{min:-100,max:100}:{min:DB.min,max:DB.max};return new mstrmojo.ui.menus.EditorConfig({cssClass:A2+" "+mstrApp.getThemeClassName(),data:{newRangeValid:true,rangeKeysChanged:[],autoKeysChanged:[],scaleTypeWillChange:C7.value!==B5.EnumAxisScale.CUSTOM},contents:[{scriptClass:"mstrmojo.ui.editors.controls.CustomRange",alias:"rangeCtrl",range:DB,auto:DG,labelOfCustomRange:mstrmojo.desc(13662,"Axis Range"),rangeConstraints:{min:{min:null,max:DB.max},max:{min:DB.min,max:null}},oninputValidChange:function(DH){this.parent.data.set("newRangeValid",DH.value);},autoChanged:function(){var DI=this.getAuto(),DH=Cb.filter(Az.keyarray(DG),function(DJ){return String(DG[DJ])!==String(DI[DJ]);});if(this.parent){this.parent.data.set("autoKeysChanged",DH);}},rangeChanged:function(){var DH=this.getRange(),DI=Cb.filter(Az.keyarray(DB),function(DJ){return String(DB[DJ])!==String(DH[DJ]);});this.parent.data.set("rangeKeysChanged",DI);},getConvertValue:function(DH){return Bv.call(this,Cz,DA.min,Bw(DH,DE,false));}}],bindings:{okEnabled:function(){return(this.data.newRangeValid&&(this.data.rangeKeysChanged.length>0||this.data.scaleTypeWillChange))||this.data.autoKeysChanged.length>0;}},onOpen:function(){this.rangeCtrl.updateDisplay();},fnOk:function(DL,DJ){var DI=DJ.rangeCtrl.getRange(),DK=this.data.rangeKeysChanged,DM=DJ.rangeCtrl.getAuto(),DH=this.data.autoKeysChanged;DK.forEach(function(DP,DO,DN){Cz.setFormatPropertyValue(DA[DP],Bw(DI[DP],DE,false),null,DL.scaleTypeWillChange||DO!==DN.length-1);});DH.forEach(function(DP,DO,DN){Cz.setFormatPropertyValue(DD[DP],DM[DP],null,DL.scaleTypeWillChange||DO!==DN.length-1);});C7.set("value",B5.EnumAxisScale.CUSTOM);}});});return C9;},getDisplayText:function(C7){return(!isNaN(C7)&&C1[C7])||"";},onvalueChange:function(C7){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],C7.value);},onFmtPropsChangedDefault:function(C7,C8){this.syncControl(function(){this.set("value",C8);});}},C3);Az.copy(C5,C3);var C0=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown(C3));return CS.call(this,C0,C4,null,["40%","60%"]);}function B2(Cy,C4){var C1=this,Cx=this.broker,C3=[Cy],C0=AA(Cx,C3),Cz=BP.call(this);Az.copy({value:Cz[0],getDisplayText:function(C5){return(C5&&C5.n)||"";},getMenuConfig:function(){var C5=this,C6=new mstrmojo.ui.menus.MenuConfig({menuCssClass:A2,hostId:C5.id,hostElement:C5.containerNode,isHostedWithin:false});Cz.forEach(function(C7){C6.addPopupMenuItem(C5.getDisplayText(C7),"",function(){var DD=C7.v;function DF(DG){return Cx.generateSmartName(null,Ac.TREND_BUBBLE_FORE_DEF,DG,DD);}var C8=DF(Ac.TREND_BUBBLE_FORE_ENABLED),DB=Cx.getFormatPropertyValue(C8),DA={min:DF(Ac.TREND_BUBBLE_MIN),max:DF(Ac.TREND_BUBBLE_MAX),customMin:DF(Ac.TREND_BUBBLE_FORE_BWD),customMax:DF(Ac.TREND_BUBBLE_FORE_FWD)},DC={};Az.keyarray(DA).forEach(function(DG){DC[DG]=Cx.getFormatPropertyValue(DA[DG]);});var C9=C1.addDisposable(new mstrmojo.ui.editors.controls.CustomRange({alias:"rangeCtrl",range:DC,enabled:DB,labelOfCustomRange:mstrmojo.desc(13734,"Forecast"),rangeConstraints:{min:{min:null,max:DC.min},max:{min:DC.max,max:null}},oninputValidChange:function(DG){this.parent.data.set("newRangeValid",DG.value);},rangeChanged:function(){var DG=this.getRange(),DH=Cb.filter(Az.keyarray(DC),function(DI){return String(DC[DI])!==String(DG[DI]);});this.parent.data.set("rangeKeysChanged",DH);},getConvertValue:function(DG){return Bv.call(this,Cx,DA.min,DG);},getTextBoxCfg:function(DG,DH){DH=[];Az.copy({getInvalidMsg:function(DI){if(DI.code===mstrmojo.validation.STATUSCODE.INVALID_OUTOFRANGE){if(!this.constraints.min){return mstrmojo.desc(14325,"Forecasting requires the horizontal axis to be extrapolated to smaller than its current min value of #").replace("#",this.parent.getConvertValue(DC.min));}if(!this.constraints.max){return mstrmojo.desc(14326,"Forecasting requires the horizontal axis to be extrapolated to greater than its current max value of #").replace("#",this.parent.getConvertValue(DC.max));}}return this.constructor.prototype.getInvalidMsg(DI);}},DH);return this.constructor.prototype.getTextBoxCfg(DG,DH);}})),DE=C1.getCheckboxAndLabel(DB,mstrmojo.desc(12026,"Enable Forecasting"),function(){this.parent.parent.data.set("rangeEnabled",this.checked);C9.set("enabled",this.checked);});return new mstrmojo.ui.menus.EditorConfig({cssClass:A2+" "+mstrApp.getThemeClassName(),data:{newRangeValid:true,rangeKeysChanged:[],rangeEnabled:DB},contents:[DE,{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12027,"Extrapolate values by adjusting the horizontal axis"),cssClass:"textLabel"},C9],bindings:{okEnabled:function(){var DG=this.data.rangeEnabled!==DB;return(this.data.rangeEnabled&&this.data.newRangeValid&&(this.data.rangeKeysChanged.length>0||DG))||(!this.data.rangeEnabled&&DG);}},fnOk:function(DK){var DH=DK.rangeEnabled,DI=DH!==DB;if(DH){var DG=C9.getRange(),DJ=this.data.rangeKeysChanged;DJ.forEach(function(DN,DM,DL){Cx.setFormatPropertyValue(DA[DN],DG[DN],null,DI||DM!==DL.length-1);});}if(DI){Cx.setFormatPropertyValue(C8,DH);}C5.set("value",C7);}});});});return C6;}},C0);Az.copy(C4,C0);var C2=this.addDisposable(new mstrmojo.ui.editors.controls.MenuPulldown(C0));return CS.call(this,C2);}function CE(Cz,Cy,C2){var Cx=this.broker,C1=[Cy],C0=AA(Cx,C1);Az.copy({oncheckedChange:function(){if(this._sync||!this.enabled){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],this.checked);},onFmtPropsChangedDefault:function(C3,C4){this.syncControl(function(){if(C4==="false"){C4=false;}this.set("checked",!!C4);});}},C0);Az.copy(C2,C0);return CS.call(this,this.addDisposable(new mstrmojo.ui.Checkbox(C0)),Cz,Ck);}function AX(Cz,Cy,C4){var Cx=this.broker,C3=[Cy],C1=Cb.find(Cz,"isAll",true),C0=AA(Cx,C3);Az.copy({items:Cz,allIdx:C1,reInitDefault:function(){var C5=this.smartNames[0],C6={};(this.listenFormatProps).forEach(function(C7){if(C7===C5){return ;}this.onFmtPropsChanged(C7,this.broker.getFormatPropertyValue(C7));},this);(this.items||[]).forEach(function(C8,C7){if(this.broker.getFormatPropertyValue(Cy,C8.opt)){C6[C7]=true;}},this);this.syncControl(function(){this.set("selectedIndices",C6,true);});},postselectionChange:function(C6){if(this._sync){return ;}var C8=!!C6.added,C5=C8?C6.added[0]:C6.removed[0],C7=this.items[C5].opt;this.broker.setFormatPropertyValue(this.smartNames[0],C8,C7);},onFmtPropsChangedDefault:function(C5,C7,C6){this.syncControl(function(){var DA=Cb.filterOne(this.items,function(DB){return DB.opt.key===C6.key;}),C8=DA&&this.items.indexOf(DA);if(!!C7){if(this.allIdx>-1&&C8>-1){var C9=Az.copy(this.selectedIndices);C9[C8]=true;if(Az.keyarray(C9).length===this.items.length-1){C8=this.allIdx;}}this.addSelect(C8);}else{this.removeSelect(C8);}});}},C0);Az.copy(C4,C0);var C2=this.addDisposable(new mstrmojo.ui.CheckListIcon(C0));return CS.call(this,C2,null);}mstrmojo.ui.CheckListIcon=mstrmojo.declare(mstrmojo.ui.CheckList,null,{scriptClass:"mstrmojo.ui.CheckListIcon",init:function Cr(Cx){this._super(Cx);mstrmojo.css.addWidgetCssClass(this,"gm-CheckList");},getItemMarkup:function Af(Cz,Cx){var Cy='<table><tr><td><span class="icon"></span></td><td><span>{@en@n}</span></td></tr></table>';return this._super(Cz).replace('<span class="text">{@en@n}</span>',Cy);}});function Ca(Cy,Cz){AT.override({showPickerForCurrentMode:function Cx(){this._super();if(this.pickerMode===2&&typeof this.color!=="object"){var C0=this.gradientOrientation,C1=Cz.getChartInfo().dirc===B5.EnumABLDirection.VERTICAL;C0.set("selectedIndex",Cb.find(C0.items,"id",C1?0:1));}}},Cy.colorPicker);}function X(Cz,Cy){function Cx(C1){var C2=C1.value;return(C2===undefined||C2==="")&&Cz.getFormatPropertyValue(Cy)===undefined;}return{onInvalid:function C0(){if(Cx(this)){if(this.hasRendered){this.clearValidation();}return ;}if(this.hasRendered){mstrmojo.ui.editors.controls.ValidationTextBox.prototype.onInvalid.call(this);}},onRender:function(){if(Cx(this)){this.clearValidation();}}};}function g(Cz,Cy,C3){var Cx=this.broker,C2=[Cy],C0=AA(Cx,C2);Az.copy({showGradient:false,postselectedValueChange:function(C4){if(this._sync){return ;}var C5=C4.value;if(C5===W.VAL_AUTOMATIC){C5=AY;}this.broker.setFormatPropertyValue(this.smartNames[0],C5);},onFmtPropsChangedDefault:function(C4,C5){this.syncControl(function(){if(typeof C5==="undefined"){C5="conflict";}if(this.colorDefaultSN&&this.broker.getFormatPropertyValue(this.colorDefaultSN)){this.set("autoPreviewColor",C5);C5=W.VAL_AUTOMATIC;}this.set("selectedValue",C5);});}},C0);Az.copy(C3,C0);var C1=this.addDisposable(new mstrmojo.ui.editors.controls.ColorPickerButton(C0));return CS.call(this,C1,Cz);}function Bu(C0,Cy){var Cx={},C3=C0.getFormatPropertyValue(Cy.fontStyle),C1=C0.getFormatPropertyValue(Cy.fontColor),Cz=C0.getFormatPropertyValue(Cy.fontFamily),C2=C0.getFormatPropertyValue(Cy.fontSize);if(C3!==undefined){Cx[A9.FONT_WEIGHT]=(!isNaN(C3)&&((C3&AE.FS_BOLD)>0));Cx[A9.FONT_STYLE]=(!isNaN(C3)&&((C3&AE.FS_ITALIC)>0));Cx[A9.UNDERLINE]=(!isNaN(C3)&&((C3&AE.FS_UNDERLINE)>0));Cx[A9.LINE_THROUGH]=(!isNaN(C3)&&((C3&AE.FS_STRIKETHROUGH)>0));}Cx[A9.COLOR]=C1!==undefined?C1:-1;Cx[A9.FONT_SIZE]=C2!==undefined?C2:-1;Cx[A9.FONT_FAMILY]=Cz!==undefined?Cz:-1;return Cx;}function BH(C5,C0,C6){var Cx=this.broker,C7=Az.valarray(C0),C3=AA(Cx,C7),C2={},C1={};C1[A9.FONT_SIZE]=C0.fontSize;C1[A9.COLOR]=C0.fontColor;C1[A9.FONT_FAMILY]=C0.fontFamily;C1[A9.FONT_WEIGHT]=C1[A9.FONT_STYLE]=C1[A9.UNDERLINE]=C1[A9.LINE_THROUGH]=C0.fontStyle;C2[A9.FONT_WEIGHT]=AE.FS_BOLD;C2[A9.FONT_STYLE]=AE.FS_ITALIC;C2[A9.UNDERLINE]=AE.FS_UNDERLINE;C2[A9.LINE_THROUGH]=AE.FS_STRIKETHROUGH;Az.copy({smartNamesMap:C0,syncWithAllText:false,onGroupValueChange:function(DB,DA){var DD=C1[DB];if(DD===C0.fontStyle){var C9=Cx.getFormatPropertyValue(DD),DC=C2[DB],C8=DA;DA=C8?(C9|DC):(C9&(~DC));}else{if(DD===C0.fontSize){if(this.visibleControls&c.FONT_SIZE_USE_STEPPER){DA=DA[0];}DA=parseInt(DA,10)+"pt";}}this.broker.setFormatPropertyValue(DD,DA);},onFmtPropsChangedDefault:function(C8){this.syncControl(function(){var C9=this.smartNamesMap,DA=Cb.filterOne(Az.keyarray(C9),function(DB){return C9[DB]===C8;});if(DA||this.syncWithAllText){if(!DA&&C8.indexOf(By)===-1){Av("[CharacterGroup] Unnecessary refresh which might be due to incorrect listenFormatProps.");}this.refreshValues();}});},refreshValues:function(){this.syncControl(function(){var C8=Bu(this.broker,this.smartNamesMap);if(this.visibleControls&c.FONT_SIZE_USE_STEPPER){C8[A9.FONT_SIZE]=[parseInt(C8[A9.FONT_SIZE],10)];}this.setFormatSource(C8);});}},C3);Az.copy(C6,C3);if(C3.syncWithAllText){var Cz=Az.valarray(Cx.getSmartNamesMapForFontGroup(By));C3.listenFormatProps=(C3.listenFormatProps||[]).concat(Cz);}var C4=this.getHost()&&this.getHost().node&&this.getHost().node.data&&this.getHost().node.data.visName;var Cy=mstrApp.supportFeature("ngm")&&C4===mstrmojo.vi.viz.EnumVizStyles.NEW_GRAPH_MATRIX?this.addDisposable(new mstrmojo.ngm.NGMCharacterGroup(C3)):this.addDisposable(new mstrmojo.ui.editors.controls.CharacterGroup(C3));return CS.call(this,Cy,C5,BK);}function CN(Cy,Cz,C4){var Cx=this.broker,C3=Az.valarray(Cz),C0=AA(Cx,C3);Az.copy({smartNamesMap:Cz,onGroupValueChange:function(C5,C6){if(this._sync){return ;}this.broker.setFormatPropertyValue(C5,C6);},onFmtPropsChangedDefault:function(C5,C6){this.syncControl(function(){this.setChildValue(C5,C6);});}},C0);Az.copy(C4,C0);var C2=this.addDisposable(new mstrmojo.ui.editors.controls.LineConfigGroup(C0));C2.iniChildrenComp(C3);var C1=C2.getChildComp(Bm);if(C1){Ca(C1,this.getHost());}return CS.call(this,C2,Cy);}function Cu(Cy,Cz,C4){var Cx=this.broker,C3=Az.valarray(Cz),C0=AA(Cx,C3);Az.copy({smartNamesMap:Cz,onGroupValueChange:function(C5,C6){if(!this._sync){Cx.setFormatPropertyValue(C5,C6);}},onFmtPropsChangedDefault:function(C5,C6){this.syncControl(function(){var C7=this;if(Cb.filterOne(this.propNames,function(C8){return(C8===C5);})){C7.setChildValue(C5,C6);}else{this.propNames.forEach(function(C8){C7.setChildValue(C8,C7.broker.getFormatPropertyValue(C8));});}});}},C0);Az.copy(C4,C0);var C2=this.addDisposable(new mstrmojo.ui.editors.controls.FillConfigGroup(C0));C2.iniChildrenComp(C3);var C1=C2.getChildComp(Bm);if(C1){Ca(C1,this.getHost());}return CS.call(this,C2,Cy);}mstrmojo.vi.models.editors.GMEditorManager=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.editors.GMEditorManager",host:null,initializing:false,targetSelectors:null,shapeObjSel:null,shapeFormatControls:null,_fmtPropBindings:null,_fmtSelBindings:null,_hilightObjListens:null,_IdentityTypeMapping:null,_nonShapeSelectionToIdentityMapping:null,init:function Cr(Cx){this._super(Az.copy(Cx,{targetSelectors:{},_fmtPropBindings:{},_fmtSelBindings:{},_hilightObjListens:[],_IdentityTypeMapping:{},_nonShapeSelectionToIdentityMapping:{},shapeFormatControls:[]}));},clearControlsReference:function(){this.targetSelectors={};this._fmtPropBindings={};this._fmtSelBindings={};this._hilightObjListens=[this.model];this.shapeFormatControls.length=0;var Cx=this._IdentityTypeMapping;Cb.forEach(Object.keys(Cx),function(Cy){Cx[Cy][Aa].length=0;});},_addListener:function(C0,Cx,Cz){var Cy=C0[Cx]||[];Cy.push(Cz);C0[Cx]=Cy;},initIdentityPanelMapping:function(){var Cz=x,Cx=this._IdentityTypeMapping;Az.forEach(BO,function(C0){var C1=Cx[C0]={};C1[x]=[];C1[Aa]=[];});var Cy=this._nonShapeSelectionToIdentityMapping;Cy[BO.X_NUMERIC]=BO.X_CATEGORY;Cy[BO.Y_NUMERIC]=BO.Y_CATEGORY;Cx[BO.AXIS_SCALE][Cz]=Cx[BO.LOG_SCALE][Cz]=Cx[BO.AXIS_ORIGIN_DEFINE][Cz]=Y;Cx[BO.TREND_LINE][Cz]=CQ;Cx[BO.REF_LINE][Cz]=Bs;Cx[BO.VIZ_BOX_TITLE][Cz]=Cx[BO.VIZ_BOX_CONTAINER][Cz]=BA;Cx[BO.LEGEND][Cz]=Cx[BO.LEGEND_TEXT][Cz]=Cx[BO.COLOR_SQUARE][Cz]=O;Cx[BO.X_AXIS][Cz]=Cx[BO.Y_AXIS][Cz]=Cx[BO.X2_AXIS][Cz]=Cx[BO.Y2_AXIS][Cz]=Cx[BO.X_NUMERIC][Cz]=Cx[BO.X_CATEGORY][Cz]=Cx[BO.Y_NUMERIC][Cz]=Cx[BO.Y_CATEGORY][Cz]=Cx[BO.GRID_LINE][Cz]=Cx[BO.MINOR_GRID_LINE][Cz]=Cx[BO.X_METRIC_AXIS_TITLE][Cz]=Cx[BO.Y_METRIC_AXIS_TITLE][Cz]=Cx[BO.AXIS_ORIGIN][Cz]=Bt;Cx[BO.ROW_TITLE][Cz]=Cx[BO.COL_TITLE][Cz]=Cx[BO.ROW_HEADER][Cz]=Cx[BO.COL_HEADER][Cz]=Cx[BO.ROWS_BACKGROUND][Cz]=Cx[BO.COLS_BACKGROUND][Cz]=Cx[BO.H_MATRIX_LINE][Cz]=Cx[BO.V_MATRIX_LINE][Cz]=AW;Cx[BO.GRAPH_SHAPE][Cz]=Cx[BO.SHAPE_COLLECTION][Cz]=Cx[BO.DATA_LABEL][Cz]=CR;},switchPanelByValue:function(Cx){if(this.initializing){return ;}this.model.selectTargetByValue(Cx);},notifyPropChangeToListeners:function(Cx,Cz,Cy){if(this.initializing){return ;}(this._fmtPropBindings[Cx]||[]).forEach(function(C0){if(C0.onFmtPropsChanged){C0.onFmtPropsChanged(Cx,Cz,Cy);}});},notifyNonShapeSelectionChangeToListeners:function(C4){if(this.initializing){return ;}var C0=C4.identities.length===0,Cx=f,C3=f,Cz=[],C2=this;if(!C0){C4.identities.forEach(function(C7){var C8=M(C7);if(!(C8&&C8.objType!==undefined)){return ;}var C6=(C2._nonShapeSelectionToIdentityMapping[C8.objType]||C8.objType);Cx=CZ.longIntOr(Cx,C6);Cz.push(C6);});C3=M(C4.identities[0]).objType;C3=(C2._nonShapeSelectionToIdentityMapping[C3]||C3);if(!C2._IdentityTypeMapping[C3]){return ;}var C5=C2._IdentityTypeMapping,Cy=C5[C3][x];this.switchPanelByValue(Cy);var C1=[];Cz.forEach(function(C6){C1=C1.concat(Cb.difference(C5[C6][Aa]||[],C1));});C1.forEach(function(C6){if(C6.updateSelection){C6.updateSelection(Cx,C4.identities);}});}this._hilightObjListens.forEach(function(C6){C6.onHighlightObjChange(Cx);});},_notifyShapeSelectionChangeToListeners:function(Cx){if(this.initializing){return ;}var C1=this.host,C4=Al.call(this.model),C0=Cx.arrayOfComb||Cx.arrayOfColorByComb,C3={opt:"Multiple Elements",key:"multiple",optLvl:CF.COLOR_BY,comb:[]};var C2=Cx.selectionlevel,Cz=C2===CF.COLOR_BY,Cy;if(C0&&C0.length>1&&Cz){Cy=C3;}else{if(C0&&(Cz||C2===CF.METRIC)){Cy=Az.copy(Cb.filterOne(Cz?C4.colorByItems:C4.metricItems,function(C5){return CZ.isEqualComb(C5.comb,C0[0]);}));}else{Cy=Az.copy(Cb.filterOne(C4.originCollection,function(C5){return C2===C5.optLvl;}));}}if(!this.host.noSwitch){this.switchPanelByValue(CR);delete this.host.noSwitch;}if(this.shapeObjSel){this.shapeObjSel.updateSelection(Cy);}},_notifyFormatModeChangeToListeners:function(Cx){if(this.initializing){return ;}if(this.shapeObjSel){this.shapeObjSel.onFormattingModeChange(Cx);}},_notifyOnContextMenuSelectionListeners:function(Cx){this.switchPanelByValue(this._IdentityTypeMapping[Cx.identityType][x]);var Cy=this._IdentityTypeMapping[Cx.identityType][Aa]||[];Cy.forEach(function(Cz){if(Cz.updateSelection){Cz.updateSelection(Cx.identityType,[{key:Cx.metricId,tlOpt:{key:Cx.metricId}}]);}});this._hilightObjListens.forEach(function(Cz){Cz.onHighlightObjChange(Cx.identityType);});},refreshShapeFormattingTargets:function(){if(this.shapeObjSel){var Cx=Al.call(this.model);this.shapeObjSel.setShapeObjectOptions(Cx);this.shapeObjSel.set("value",Cx.allItem);}},getTargetSelector:function(Cx){if(!this.targetSelectors[Cx]){Av("Selector with name "+Cx+" does not found.");}return this.targetSelectors[Cx];},getSelectedValue:function(Cy,C0,Cx){var Cz=this.getTargetSelector(Cy);C0=C0||"v";return Cz&&Cz.getSelectedItem(Cx)&&Cz.getSelectedItem(Cx)[C0];},onTargetSelectionChanged:function(Cx,Cz){var Cy=Cx&&this._fmtSelBindings[Cx];(Cy||[]).forEach(function(C0){if(!C0.onSelectorsValueChanged){return Ak("[Manager] onSelectorsValueChanged not defined for control: "+C0.controlName);}C0.onSelectorsValueChanged(Cx,Cz);},this);},sendNonShapeTargetSelectionIdentity:function(Cy){var Cx=this.targetSelectors[Cy];if(!this.host.formattingMode||!Cx||Cx.selectedIndex===undefined||Cx.selectedIndex===null){return ;}var Cz=Cx.items[Cx.selectedIndex].identity,C0=[];if(!Cz||Cz===Bn){return ;}Az.forEach(BO,function(C2){if((Cz&C2)>0){C0.push(C2);}});var C1={name:"highLightObjectChange",identities:C0};this.host.raiseEvent(C1);return C1;},isShapeOptionEqual:function(Cy,Cx){if(!Cy&&!Cx){return true;}if(!Cy||!Cx){return false;}if(Cy.optLvl!==Cx.optLvl){return false;}if(Cy.opt!==Cx.opt){return false;}return(Cy.comb===Cx.comb)||(Cy.comb&&Cx.comb&&CZ.isEqualComb(Cy.comb,Cx.comb));},sendShapeOption:function(Cy){var Cx=this.shapeObjSel,Cz=Cx.value;if((!Cy&&!this.host.formattingMode)||this.isShapeOptionEqual(Cz,Cx.valueWas)){return ;}Cx.set("valueWas",Az.copy(Cz));this.host.onFormatableTargetChanged(Cz);},registerFormatControl:function(Cy){var Cx=Cy.listenFormatProps;(Cx||[]).forEach(function(Cz){this._addListener(this._fmtPropBindings,Cz,Cy);},this);Cx=Cy.listenSelector;(Cx||[]).forEach(function(Cz){this._addListener(this._fmtSelBindings,Cz,Cy);},this);if(Cy.highlightObjects&&Cy.highlightObjects.length){this._hilightObjListens.push(Cy);}},registerSelector:function(Cx,C1,C0){var Cz=Aa,Cy=this._IdentityTypeMapping;this.targetSelectors[Cx]=C1;(C0||[]).forEach(function(C2){if(!Cy[C2]){var C3=Cy[C2]={};C3[x]=[];C3[Aa]=[];}Cy[C2][Cz].push(C1);});C1.set("selectedIndex",0);},registerGroupTitle:function(Cx){if(Cx.highlightObjects){this._hilightObjListens.push(Cx);}}});mstrmojo.vi.models.editors.GMBroker=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.vi.models.editors.GMBroker",vis:null,editorManager:null,_smartNameToPropertyKeyLookup:null,_dynamicPrefixToSmartNamesLookup:null,_subscriptions:null,_titleSubs:null,init:function Cr(Cx){this._super(Az.copy(Cx,{_smartNameToPropertyKeyLookup:{},_dynamicPrefixToSmartNamesLookup:[],_subscriptions:[]}));},getLocalState:function AB(Cz){var Cy=D[this.vis.node.k],Cx=Cy&&Cy[Cz];if(Cx===undefined){switch(Cz){case R.IN_FORMATTING_MODE:Cx=this.vis.formattingMode;break;case R.SELECTED_CATEGORY:Cx=Y;break;}}return Cx;},updateLocalState:function Ch(Cz,Cy){var Cx=D[this.vis.node.k]||{};Cx[Cz]=Cy;D[this.vis.node.k]=Cx;},attachEditorRuntime:function Bi(Cx){if(!Cx){return Ak("[Broker] Could not attach undefined editor manager! Broker not connected to panel runtime.");}var Cy=this.vis;this.editorManager=Cx;this._subscriptions=[Cy.attachEventListener("formattingObjectChanged",this.id,function(Cz){if(Cz.selectionlevel!==CF.COLOR_BY||(Cz.arrayOfComb&&Cz.arrayOfComb.length>0)){Cx._notifyShapeSelectionChangeToListeners(Cz);}else{B1(Cx._hilightObjListens);}}),Cy.attachEventListener("nonShapeFormatableChanged",this.id,function(Cz){if(true||this.getLocalState(R.IN_FORMATTING_MODE)){Cx.notifyNonShapeSelectionChangeToListeners(Cz);}}),Cy.attachEventListener("propertyChanged",this.id,function(Cz){var C0=this.translateFormatPropertyChangeFromGM(Cz.n,Cz.v,Cz.opt);(C0||[]).forEach(function(C1){Cx.notifyPropChangeToListeners(C1.sn,C1.val,Cz.opt);});}),Cy.attachEventListener("formattingModeChanged",this.id,function(Cz){this.updateLocalState(R.IN_FORMATTING_MODE,Cz.isFmtMode);Cx._notifyFormatModeChangeToListeners(Cz.isFmtMode);B1(Cx._hilightObjListens);}),Cy.attachEventListener("onContextMenuSelection",this.id,function(Cz){if(Cz.identityType){Cx._notifyOnContextMenuSelectionListeners(Cz);}}),Cy.attachEventListener("shapeFormattingTargetsChanged",this.id,function(){Cx.refreshShapeFormattingTargets();})];this._titleSubs=[Cy.parent.titleBar&&Cy.parent.titleBar.attachEventListener("titleBarRMC",this.id,function(Cz){if(this.getLocalState(R.IN_FORMATTING_MODE)){Cz.identities=[{objType:BO.VIZ_BOX_TITLE}];Cx.notifyNonShapeSelectionChangeToListeners(Cz);}})];},detachEditorRuntime:function AQ(){(this._subscriptions).forEach(function(Cy){this.vis.detachEventListener(Cy);},this);(this._titleSubs).forEach(function(Cy){if(this.vis.parent.titleBar){this.vis.parent.titleBar.detachEventListener(Cy);}},this);var Cx=this.editorManager;this.editorManager=null;return Cx;},translateFormatPropertyChangeFromGM:function m(C2,Cz,C0){function C7(C9,C8,DA){return Cb.filter(C9,function(DB){return(DB.indexOf(C8+(DA||""))===0);});}function C1(DA,C9,DD){var DC=Az.keyarray(C3._smartNameToPropertyKeyLookup),C8=C7(DC,DA),DB="";if(C9){DB+=Co+C9;C8=C7(C8,DA,DB);}if(C8.length===1){return C8[0];}if(C8.length>1){if(C8.indexOf(DA+(DB||""))!==-1){return DA+(DB||"");}DB+=DD&&(DD.opt||DD.key);C8=C7(C8,DA,DB);}if(C8.length===1){return C8[0];}return undefined;}var C3=this,Cx=[undefined],Cy,C5,C6=[Cz],C4=[];if(Cz&&Cz.modifiedPropertyKeys){Cx=Cz.modifiedPropertyKeys;if(!Cx){return Ak("[Broker] modifiedPropertyKeys is empty for actual prop name: "+C2);}C6=Cx.map(function(C8){return Cz.jsonObj[C8];});}Cx.forEach(function(DA,C9){var C8=[],DC=Az.keyarray(C3._dynamicPrefixToSmartNamesLookup),DB;Cy=C1(C2,DA,C0);if(Cy){C8.push(Cy);}(DC||[]).forEach(function(DD){DB=C3.editorManager.getSelectedValue(DD.slice(0,-1),"prefix");if(C2.indexOf(DB)===0){Cy=C1(C2.replace(DB,DD),DA,C0);if(Cy){C8.push(Cy);}}});C5=C6[C9];if(C5!==undefined&&C8.length!==0&&C3.isColorProperty(C3.getFormatPropertyKey(C8[0]))){C5=CZ.decodeColor(C5);}C8.forEach(function(DG){var DF=C3.getFormatPropertyKey(DG),DE=DF&&DF.levelSelector,DD;if(!DF){return Ak("[Broker] Got a smart name in event but failed to locate the matched property key: "+DG);}if(DE&&typeof DE==="string"){DD=C3.editorManager.getSelectedValue(DE);if(!DD){return Ak("[Broker] Failed to get selection option by selector name: "+DE);}if(DD.key!==C0.key){return undefined;}}C4.push({sn:DG,val:C5});});});return C4;},getSmartNamesMapForFontGroup:function Bd(C2,C4,Cy,Cx,C1,Cz){var C0=this;function C3(C7){var C6=C4,C5=Cy;if(Cx==="fld"){C5=(C5||"")+C7;}else{C6=(C6||"")+C7;}return C0.generateSmartName(C2,C6,C5,C1,Cz);}return{fontFamily:C3(A8),fontStyle:C3(V),fontSize:C3(CC),fontColor:C3(Cp)};},getSmartNamesMapForLineGroup:function Cn(C2,C4,Cy,Cx,C1,Cz){var C0=this;function C3(C7){var C6=C4,C5=Cy;if(Cx==="fld"){C5=(C5||"")+C7;}else{C6=(C6||"")+C7;}return C0.generateSmartName(C2,C6,C5,C1,Cz);}return{lineColor:C3(Bm),lineStyle:C3(As)};},getSmartNamesMapForFillGroup:function CV(C2,C4,Cy,Cx,C1,Cz){var C0=this;function C3(C7){var C6=C4,C5=Cy;if(Cx==="fld"){C5=(C5||"")+C7;}else{C6=(C6||"")+C7;}return C0.generateSmartName(C2,C6,C5,C1,Cz);}return{fillColor:C3(A7),fillAlpha:C3(r)};},getVisProfile:function Bk(Cx){var Cz=this.vis,Cy=Cz.GMController.enableCombiChart?Cz.GMController.metricShapeArr:[Cz.getChartInfo().shape];switch(Cx){case CO:return Cz.getChartInfo().isBubbleOrScatter;case AD:return Cz.getChartInfo().isABL;case b:return Cz.GMController.pureAreaChart;case AN:return Cz.isSeasonalityEnabled();case Bg:return Cz.getNumericAxisOptions().length>0;case Am:return Cz.GMController.hasSizeBy();case Ai:return Cz.GMController.hasColorBy();case Bf:return Cz.GMController.hasAttributesInDropzone("BreakBy");case AG:return Cz.GMController.isMetricNamesInZone("BreakBy");case BB:return Cz.GMController.textTypeDataLabelEnabled();case Bb:return Cy.every(function(C0){return C0===CH.LINE||C0===CH.TICK;});case z:return Cz.GMController.valueTypeDataLabelEnabled();case Cc:return Cz.GMController.chartSubType===Ct.PERCENT;case u:return Cz.GMController.getSizeByMetrics()&&Cz.GMController.getSizeByMetrics().length>0;case L:return Cz.getChartInfo().shape===CH.LINE;case Bo:return Cz.getChartInfo().shape===CH.TICK;case CU:return Cy.every(function(C0){return[CH.BAR,CH.AREA,CH.CIRCLE,CH.SQUARE,CH.RING,CH.PIE].indexOf(C0)!==-1;});case B3:return Cy.indexOf(CH.LINE)>-1||Cy.indexOf(CH.AREA)>-1;case AM:return Cz.GMController.isAxisAttributeInColorBy();case AZ:return Cz.GMController.isEmptyVis();}return Ak("[Broker getVisProfile] Unrecognized profile name: "+Cx);},getOptionItems:function BM(Cy,Cx){var Cz=this.vis;switch(Cy){case BF:return CP(Cz.getEnabledReferenceLineOptions(Cx));}return Ak("[Broker getOptionItems] Unrecognized optionName: "+Cy);},getDataLabelItems:function Bc(){var Cx=this.vis.getShowDataLabelOptions(),Cy=[];(Cx||[]).forEach(function(Cz){Cy.push({n:Cz.opt,opt:Cz,isAll:Cz.key&&Cz.key==="AllMetrics"});});return Cy;},generateSmartName:function BJ(C0,C5,C3,C1,Cz){function C2(C6){var C7=C6.levelSelector,C9=C7&&(C7.opt||C7.key),C8=(C6.namePrefix||"")+(C6.nameSuffix||"");if(C6.filedAlias){C8+=Co+C6.filedAlias;}if(C9){C8+=H+C9;}return C8;}var C4={namePrefix:C0,nameSuffix:C5,filedAlias:C3,levelSelector:C1,target:Cz},Cy=C2(C4),Cx=this._smartNameToPropertyKeyLookup[Cy];if(Cx&&!Az.equals(Cx,C4)){Av("[Broker] smart name conflict for : "+Cy);}this._smartNameToPropertyKeyLookup[Cy]=C4;if(C0&&C0.slice(-1)===Aw){this._dynamicPrefixToSmartNamesLookup[C0]=this._dynamicPrefixToSmartNamesLookup[C0]||[];this._dynamicPrefixToSmartNamesLookup[C0].push(Cy);}return Cy;},getFormatPropertyKey:function Ag(Cx){var Cy=this._smartNameToPropertyKeyLookup[Cx];if(!Cy){Av("[Broker] Format property key not found for smart name: "+Cx);}return Cy;},getDependingSelectorNames:function CG(Cy){var Cz=this.getFormatPropertyKey(Cy),C1=[];if(!Cz){return C1;}var Cx=Cz.namePrefix,C0=Cz.levelSelector;if(this._dynamicPrefixToSmartNamesLookup[Cx]){C1.push(Cx.slice(0,-1));}if(C0&&typeof C0==="string"){C1.push(C0);}return C1;},_resolveFormatPropNameWithRuntime:function Ah(Cy){var Cx=Cy.namePrefix,Cz;if(this._dynamicPrefixToSmartNamesLookup[Cx]){Cz=this.editorManager.getSelectedValue(Cx.slice(0,-1),"prefix",Cy.nameSuffix);}else{Cz=Cx;}return(Cz||"")+Cy.nameSuffix;},_resolveLevelOptionWithRuntime:function A(Cy){var Cz=Cy.levelSelector,Cx;if(!Cz){return undefined;}if(typeof Cz==="string"){Cx=this.editorManager.getSelectedValue(Cz);if(!Cx){return Ak("[Broker] Failed to get selection option by selector name: "+Cz);}}else{Cx=Cz;}return Cx;},isColorProperty:function(Cy){var Cx=Cy.filedAlias||Cy.nameSuffix;if(Cx&&Cx.slice(-3)===Bm){return true;}return false;},getFormatPropertyValue:function BZ(Cy,C0){var Cz=this.getFormatPropertyKey(Cy);if(!Cz){return Ak("[Broker] Failed to locate a property key by smart name: "+Cy);}if(!this.editorManager){return Ak("[Broker] Editor runtime offline while trying to get property value for : "+Cy);}var C2=this.vis,C1,Cx,C3;if(Cz.target===Ar){Cx=C2.getPropertiesOfFormatable();}else{C0=C0||this._resolveLevelOptionWithRuntime(Cz);C1=this._resolveFormatPropNameWithRuntime(Cz);Cx=C2.readGlobalProperty(C1,C0);}if(Cz.filedAlias){if(!Cx||!Cx.jsonObj){return Ak("[Broker] Result value collection is not in expected structure for smart name: "+Cy);}C3=Cx.jsonObj[Cz.filedAlias];}else{if(typeof Cx==="object"){return Ak("[Broker] Expect a string value while got a structure for smart name: "+Cy);}C3=Cx;}if(C3===undefined){C3=C2.getDefaultProperties()[C1];Av("[Broker] get format value failed for smart name: "+Cy+". Fall back to default value and got: "+C3);}if(C3!==undefined&&this.isColorProperty(Cz)){C3=CZ.decodeColor(C3);}return C3;},setFormatPropertyValue:function S(Cy,C4,C3,C7,C1){var C5=this.getFormatPropertyKey(Cy);if(!C5){return Ak("[Broker] Failed to locate a property key by smart name: "+Cy);}if(!this.editorManager){return Ak("[Broker] Editor runtime offline while trying to set property value for : "+Cy);}if(C4!==undefined&&this.isColorProperty(C5)&&C4!==AY){C4=CZ.encodeColor(C4);}var C6=this.vis,C2,C0=C5.filedAlias,Cz,Cx;if(C5.target===Ar){Cz=C6.getPropertiesOfFormatable();}else{C3=C3||this._resolveLevelOptionWithRuntime(C5);C2=this._resolveFormatPropNameWithRuntime(C5);Cz=C6.readGlobalProperty(C2,C3);if(C2==="refDef"){Cz.opt=C3;}}if(C0){if(!Cz||!Cz.jsonObj){return Ak("[Broker] Result value collection is not in expected structure for smart name: "+Cy);}Cx=Cz.jsonObj[C0];if(C4!==Cx){Cz.setProperty(C0,C4);if(C5.target===Ar){Av("[Broker] writeFormatableProperties("+C0+", "+C4+")");C6.writeFormatableProperties(Cz);}else{Av("[Broker] writeGlobalProperty("+C2+":"+C0+", "+C4+", "+C3+")");C6.writeGlobalProperty(C2,Cz,C3,C7,C1);}}}else{if(typeof Cz==="object"){return Ak("[Broker] Expect a string value while got a structure for smart name: "+Cy);}Cx=Cz;if(C4!==Cx){Av("[Broker] writeGlobalProperty("+C2+", "+C4+", "+C3+")");C6.writeGlobalProperty(C2,C4,C3,C7,C1);}}}});mstrmojo.ui.editors.controls.MenuPulldown=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.editors.controls.MenuPulldown",markupString:'<div id="{@id}" class="mstrmojo-ui-Pulldown {@cssClass}" mstrAttach:mousedown,click><div class="mstrmojo-ui-Pulldown-text">{@value}</div><div class="container"></div></div>',markupSlots:{selectedNode:function Z(){return this.domNode.firstChild;},containerNode:function CY(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:CJ.visibleMarkupMethod,onheightChange:CJ.heightMarkupMethod,onwidthChange:CJ.widthMarkupMethod,onvalueChange:function Bp(){this.selectedNode.innerHTML=CZ.replaceSpecialChars(this.getDisplayText(this.value));},onenabledChange:mstrmojo.Widget.enabledMarkupMethod},value:undefined,anchorSlot:"selectedNode",getDisplayText:function h(Cx){return Cx||"";},onclick:function BR(){var Cx=this.getMenuConfig();if(!Cx){return ;}if(!this.isClosedByAnchor){this.openPopup(new mstrmojo.ui.menus.Menu({popupConfig:Cx,themeClassName:mstrApp.getThemeClassName()}));}else{this.closePopup();this.isClosedByAnchor=false;}},onPopupAutoClosed:function CI(Cy,Cx){if(mstrmojo.dom.eventTarget(Cx,Cy)===this[this.anchorSlot]){this.isClosedByAnchor=true;}},getMenuConfig:Cl});function k(Cy,Cx,C0,Cz){Cy.slot="col1Node";Cx.slot="col2Node";return new mstrmojo.ui.editors.controls.TwoColumnContainer({col1Width:C0||"40%",col2Width:Cz||"60%",children:[Cy,Cx]});}function Cg(){var Cx=w.call(this,mstrmojo.desc(14313,"All Graph Fonts"));return[Cx,BH.call(this,null,this.broker.getSmartNamesMapForFontGroup(By),{controlName:"AllTextFontGroup",groupTitle:Cx,visibleControls:c.FONT_FAMILY|c.FONT_SIZE_AND_COLOR|c.FONT_STYLE|c.FONT_SIZE_USE_STEPPER})];}function B4(){var DF=this.broker,C5=DF.editorManager,C0=B8,DB=U.call(this),C7=DF.getVisProfile(Cc),DE=C7?100:1;if(!DB.length){return[];}function C4(DH,DG){return DF.generateSmartName(null,DH,DG,C0);}function C6(){var DG=DA.items[DA.selectedIndex];return DG._renderIdx===0||!(DG.v.sizeBy||DG.v.key==="SizeBy");}var DD=w.call(this,mstrmojo.desc(13872,"Axis Configuration"),{highlightObjects:[BO.AXIS_SCALE,BO.LOG_SCALE,BO.AXIS_ORIGIN_DEFINE],scopeSelectors:[C0]}),DA=F.call(this,null,C0,DB,C5),C1=C4(B7,Ac.SINGLE_AXIS_SCALE_TYPE),Cx=BX.call(this,mstrmojo.desc(13873,"Axis scale"),C1,{min:C4(B7,Ac.AXIS_SCALE_REAL_MIN),max:C4(B7,Ac.AXIS_SCALE_REAL_MAX),customMin:C4(B7,Ac.AXIS_SCALE_MANUAL_MIN),customMax:C4(B7,Ac.AXIS_SCALE_MANUAL_MAX)},{autoMin:C4(B7,Ac.AXIS_SCALE_AUTO_MIN),autoMax:C4(B7,Ac.AXIS_SCALE_AUTO_MAX)},{groupTitle:DD}),C3=BY.call(this,mstrmojo.desc(13874,"Log scale"),[{n:mstrmojo.desc(10035,"Yes"),v:true},{n:mstrmojo.desc(2180,"No"),v:false}],C4(B7,Ac.LOG_SCALE),{groupTitle:DD,reInit:function(){this.reInitDefault();this.parent.set("enabled",!C7&&C6());}}),Cz=C4(t,Ac.AXIS_ORIGIN_AUTO),DC=CE.call(this,null,Cz),C8=C4(t,Ac.AXIS_ORIGIN_VALUE),C2=e.call(this,null,C8,{listenFormatProps:[Cz],errRevert:false,useRichTooltip:true,constraints:C7?{min:-100,max:100}:{min:null,max:null},updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}var DG=this.validationStatus;this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+12,top:this.domNode.offsetHeight+5,refNode:this.domNode,content:this.getInvalidMsg(DG)};},onValid:function(){var DG=Bw(this.value,DE,false);if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],DG);},onFmtPropsChanged:function(DH,DJ){if(DH===Cz){this.set("enabled",!DJ);var DG=DJ?mstrmojo.desc(12143,"Automatic"):"";this.syncControl(function(){this.set("emptyText",DG);if(DJ){this.set("value",null);}if(DJ&&this.hasRendered){this.clearValidation();}});}else{if(this.enabled){if(DH===C8){DJ=Bw(DJ,DE,true);}this.onFmtPropsChangedDefault(DH,mstrmojo.num.toLocaleString(DJ));}}var DI=C6();if(this.parent&&this.parent.parent){this.parent.parent.set("enabled",DI);}this.set("enabled",DI&&!DC.checked);}}),Cy=this.getLabelAndControl(mstrmojo.desc(13875,"Axis origin"),this.addDisposable(k(DC,C2,"20px","100%")),"40%","60%"),C9=[DD,Cx,C3,Cy];if(DA.items.length>1){Cb.insert(C9,1,[DA]);}if(C9.length){C9=[this.getEditorGroup(C9)];}return C9;}function Ce(){var C2=this.broker,Cx=C2.getVisProfile(Am),Cy={trigger:mstrmojo.validation.TRIGGER.ONBLUR,min:0.01,max:1},C4=C2.getVisProfile(b),C1=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13917,"Min size (0.01 - 1.0)")})),C9=this.addDisposable(new mstrmojo.Label()),C0=mstrmojo.desc(13740,"The smallest element's size is ## of the largest element's size");function C5(DA){return C2.generateSmartName(null,DA);}function C7(){if(this._sync){return ;}this.broker.setFormatPropertyValue(this.smartNames[0],C.parseNumeric(this.value).toFixed(2));}var C6=C5(Ac.MAX_SIZE_TYPE),C3=C5(Ac.MIN_SIZE_TYPE),Cz=k(BY.call(this,null,[{n:mstrmojo.desc(6019,"Automatic"),v:B5.EnumMaxSizeType.AUTO},{n:mstrmojo.desc(8262,"Manual"),v:B5.EnumMaxSizeType.MANUAL}],C6,{reInit:function(){this.parent.set("enabled",!C4);if(!C4){this.reInitDefault();}}}),e.call(this,null,C5(Ac.MAX_SIZE_VALUE),{constraints:Cy,listenFormatProps:[C6],onValid:C7,onFmtPropsChanged:function(DA,DB){if(DA===C6){this.set("enabled",DB===B5.EnumMaxSizeType.MANUAL);}else{this.onFmtPropsChangedDefault(DA,C.toLocaleString(DB));}}}),"75%","25%"),C8=k(BY.call(this,null,[{n:mstrmojo.desc(11990,"Proportional"),v:B5.EnumMinSizeType.PROPORTIONAL},{n:mstrmojo.desc(13741,"Full Range"),v:B5.EnumMinSizeType.AUTO},{n:mstrmojo.desc(14118,"Adjusted Range"),v:B5.EnumMinSizeType.MANUAL}],C3,{reInit:function(){var DA=!C4&&Cx;this.parent.set("enabled",DA);C1.set("enabled",DA);if(DA){this.reInitDefault();}},onFmtPropsChanged:function(DA,DB){this.onFmtPropsChangedDefault(DA,DB);}}),e.call(this,null,C5(Ac.MIN_SIZE_VALUE),{constraints:Cy,listenFormatProps:[C3],onValid:C7,onFmtPropsChanged:function(DA,DC){if(!Cx){this.set("enabled",false);return ;}if(DA===C3){var DB=DC===B5.EnumMinSizeType.MANUAL;this.set("enabled",DB);if(DB){C9.set("text",C0.replace("##",(this.value*100).toFixed(0)+"%"));}}else{this.onFmtPropsChangedDefault(DA,C.toLocaleString(DC));if(this.enabled){C9.set("text",C0.replace("##",(DC*100).toFixed(0)+"%"));}}}}),"75%","25%");this.addDisposable([Cz,C8]);return[this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13918,"Max size (0.01 - 1.0)")})),Cz,C1,C8,C9];}function J(){var Cx=this.broker;function Cy(Cz){return Cx.generateSmartName(null,Cz);}return[BY.call(this,mstrmojo.desc(14795,"Container fit:"),[{n:mstrmojo.desc(2057,"None"),v:B5.EnumFitTo.NONE},{n:mstrmojo.desc(4531,"Automatic"),v:B5.EnumFitTo.AUTOMATIC},{n:mstrmojo.desc(14796,"Compact"),v:B5.EnumFitTo.COMPACT},{n:mstrmojo.desc(8262,"Manual"),v:B5.EnumFitTo.MANUAL}],Cy(Ac.FIT_TO),{associatedPropValueTuples:[{name:Ac.SCALE_CHART_WIDTH,value:undefined,valueWas:Cx.vis.getWidgetPropertyValue(Ac.SCALE_CHART_WIDTH)},{name:Ac.SCALE_CHART_HEIGHT,value:undefined,valueWas:Cx.vis.getWidgetPropertyValue(Ac.SCALE_CHART_HEIGHT)}],preFmtPropsChangedHook:function(C2,C1){var Cz=Cx.vis.getWidgetPropertyValue(Ac.SCALE_CHART_WIDTH),C0=Cx.vis.getWidgetPropertyValue(Ac.SCALE_CHART_HEIGHT);if((Cz&&Cz!==1)||(C0&&C0!==1)){C1=Ao.MANUAL;}return C1;}},["55%","45%"]),this.getLabelAndControl(mstrmojo.desc(13745,"Banding on rows"),CE.call(this,null,Cy(Ac.BANDING)),"20px","100%",true)];}function Ab(Cy){var Cx=B4.call(this);this.replaceChildControls(Cy,Cx.concat([this.getEditorGroup(Ce.call(this),BD),this.getEditorGroup(J.call(this),BD),this.getEditorGroup(Cg.call(this),BD),this.getEditorGroup([this.getMoreOptionsEditorLink(this.getHost().model.data.gsi.prop)],BD)]));}function CL(Cy){var Cx=[];Cx.push(this.getEditorGroup(CD.call(this),BD));this.replaceChildControls(Cy,Cx);}function BC(DE){var DQ=this.broker,DH=DQ.editorManager,C5=At,DF=Ac.TREND_LINE_DEF,DA=Cw.call(this),DD=CZ.isTrendLineAvailableForAnyMetric(DQ.vis);function C9(DT,DU){return DQ.generateSmartName(null,DF,DT,DU);}function Cx(DT){return{listenFormatProps:[DT],onFmtPropsChanged:function(DU,DV){if(DU===DT){this.getCtrlContainer().set("enabled",DV&&DD);}else{this.onFmtPropsChangedDefault(DU,DV);}}};}function C4(){return(DA||[]).some(function(DT){return DQ.getFormatPropertyValue(DC,DT.v);});}var DC=C9(Ac.TREND_ENABLED,C5),DI=F.call(this,null,C5,DA,DH,{highlightObjects:[BO.TREND_LINE],enabled:DD,updateSelection:function DG(DU,DW){var DV=DW[0].tlOpt.key,DT=-1;Cb.forEach(this.items,function(DY,DX){if(DY.v.key===DV){DT=DX;return false;}});Ay(this,function(){this.set("selectedIndex",DT);});}}),C1=CE.call(this,mstrmojo.desc(13746,"Enable Trend Line"),DC),DO=CN.call(this,null,DQ.getSmartNamesMapForLineGroup(null,DF,"trdRefLn","fld",C5),Az.copy({lineTitle:mstrmojo.desc(13927,"Line"),controlName:"TrendLineLineGoup",showNoneOption:false,showNoFillInColor:false,showGradient:false},Cx(DC))),C3=C9(Ac.TREND_TYPE,C5),C0=BY.call(this,mstrmojo.desc(13876,"Model"),[{n:mstrmojo.desc(13877,"Best fit"),v:B5.EnumTrendLineModelType.BEST_FIT},{n:mstrmojo.desc(4888,"Linear"),v:B5.EnumTrendLineModelType.LINEAR},{n:mstrmojo.desc(12021,"Logarithmic"),v:B5.EnumTrendLineModelType.LOG},{n:mstrmojo.desc(12022,"Exponential"),v:B5.EnumTrendLineModelType.EXP},{n:mstrmojo.desc(12023,"Power"),v:B5.EnumTrendLineModelType.POW},{n:mstrmojo.desc(12024,"Polynomial"),v:B5.EnumTrendLineModelType.POLY}],C3,Az.copy(Cx(DC))),Cy=BY.call(this,mstrmojo.desc(13919,"Degree:"),[{n:"2",v:2},{n:"3",v:3},{n:"4",v:4},{n:"5",v:5},{n:"6",v:6}],C9(Ac.TREND_POLY_DEGREE,C5),{listenFormatProps:[DC,C3],onFmtPropsChanged:function(DT,DU){if(DT===DC){this.set("enabled",DU&&DD);}else{if(DT===C3){this.parent.set("visible",DU===B5.EnumTrendLineModelType.POLY);}else{this.onFmtPropsChangedDefault(DT,DU);}}}},{curVal:2,min:2,max:6}),DS=BY.call(this,mstrmojo.desc(1452,"Level"),A3,C9(Ac.TREND_LEVEL,C5),{listenFormatProps:[DC],onFmtPropsChanged:function DL(DU,DW){if(DU===DC){var DV=DQ.vis.GMController,DT=DV.hasAttributesInDropzone("Rows")||DV.hasAttributesInDropzone("Columns");this.parent.set("enabled",DD&&DT&&DW);}else{this.onFmtPropsChangedDefault(DU,DW);}}}),C8=[C1,DO,C0,Cy,DS],DB;C1.set("enabled",DD);if(DI.items.length>1){Cb.insert(C8,0,[DI]);}mstrmojo.css.addWidgetCssClass(C1,"title");if(DQ.getVisProfile(AD)){var C7=CE.call(this,mstrmojo.desc(13878,"Include Break-by Attribute"),C9(Ac.TREND_INCLUDE_BREAK_BY,C5),{listenFormatProps:[DC],onFmtPropsChanged:function(DT,DU){if(!DQ.getVisProfile(Bf)){this.parent.set("enabled",false);}else{if(DT===DC){this.parent.set("enabled",DU&&DD);}else{this.onFmtPropsChangedDefault(DT,DU);}}}});Cb.insert(C8,C8.length,[C7]);var C2=C9(Ac.TREND_FORECAST_ENABLED),DN=CE.call(this,mstrmojo.desc(12026,"Enable Forecasting"),C2,{listenFormatProps:[DC],onFmtPropsChanged:function(DT,DU){if(DT===DC){this.parent.set("enabled",DD&&C4());}else{this.onFmtPropsChangedDefault(DT,DU);}}});var DM=function(){return{listenFormatProps:[DC,C2],onFmtPropsChanged:function(DT,DU){if(DT===DC||DT===C2){this.parent.set("enabled",DD&&DQ.getFormatPropertyValue(C2)&&C4());}else{this.onFmtPropsChangedDefault(DT,DU);}}};};var C6=AR.call(this,mstrmojo.desc(13879,"Forward"),C9(Ac.TREND_FWD_FORECAST),DM()),Cz=AR.call(this,mstrmojo.desc(13880,"Backward"),C9(Ac.TREND_BWD_FORECAST),DM()),DK=BY.call(this,mstrmojo.desc(13881,"Seasons"),[{n:mstrmojo.desc(5949,"None"),v:B5.EnumTimeRole.None},{n:mstrmojo.desc(10048,"Week"),v:B5.EnumTimeRole.DayOfWeek},{n:mstrmojo.desc(871,"Month"),v:B5.EnumTimeRole.DayOfMonth},{n:mstrmojo.desc(10050,"Quarter"),v:B5.EnumTimeRole.MonthOfQuarter},{n:mstrmojo.desc(873,"Year"),v:B5.EnumTimeRole.MonthOfYear},{n:mstrmojo.desc(13748,"Decade"),v:B5.EnumTimeRole.YearOfDecade}],C9(Ac.TREND_SEASONALITY),{listenFormatProps:[DC,C3],onFmtPropsChanged:function(DT,DU){if(DT===C3||DT===DC){this.parent.set("enabled",DD&&DQ.getVisProfile(AN)&&C4());}else{this.onFmtPropsChangedDefault(DT,DU);}}});Az.copy({useRichTooltip:true,updateTooltipConfig:function DJ(){this.richTooltip=this.enabled?null:{content:mstrmojo.desc(14314,"This option is available only when a time based attribute is placed on the axis"),refNode:this.domNode,cssClass:"vi-regular",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,top:18,left:70};}},DK);mstrmojo.css.addWidgetCssClass(DN,"title");DB=[this.getEditorGroup(C8,B0),this.getEditorGroup([DN,C6,Cz],B0),this.getEditorGroup([DK],B0)];}else{var DP=w.call(this,mstrmojo.desc(13932,"Forecasting")),DR=B2.call(this,DC,{groupTitle:DP,onFmtPropsChanged:function(){var DT=DD&&C4();this.set("enabled",DT);DP.set("enabled",DT);}});DB=[this.getEditorGroup(C8,B0)].concat(this.getEditorGroup([DP,DR],B0));}this.replaceChildControls(DE,DB);}function K(DB){var DG=this.broker,DF=DG.editorManager,DC=Ac.REF_LINE_DEF,DE=p,Cx=BF,C8=DG.generateSmartName(null,DC,Ac.REF_ENABLED),C4=DG.generateSmartName(null,DC,Ac.REF_LINE_NAME),DI=!DG.getVisProfile(Cc),C6={reInit:function(){var DJ=this.manager.getSelectedValue(Cx,"v");this.getCtrlContainer().set("enabled",!!DJ&&DI);if(this.controlName==="ReferenceLineLabelCharacterGroup"){var DK=parseInt(this.fontSize.selectedValue,10).toString();this.fontSize.set("selectedValue",DK);}if(DJ){this.reInitDefault();}else{Ay(this,function(){this.resetValue();});}}};function C7(DJ){return DG.generateSmartName(null,DC,DJ,Cx);}var DA=A4.call(this),Cz=F.call(this,null,DE,DA,DF,{enabled:DI}),C9=B6.call(this,null,DA[0].v,Cx,[C8,C4],{restrictedTypes:DG.getVisProfile(CO)?[B5.EnumRefLineModelType.FIRST,B5.EnumRefLineModelType.LAST]:[],listenSelector:[DE],highlightObjects:[BO.REF_LINE],enabled:DI,updateSelection:function DD(DJ,DK){var DN=DK[0],DM=DN.key,DL=DK[0].tlOpt.key;Ay(Cz,function(){var DO=-1;Cb.forEach(Cz.items,function(DQ,DP){if(DQ.v.key===DM){DO=DP;return false;}});Cz.set("selectedIndex",DO);});Ay(this,function(){this.selectItemByField("key",DL);});}}),C2=CN.call(this,null,DG.getSmartNamesMapForLineGroup(null,DC,"trdRefLn","fld",Cx),Az.copy(C6,{lineTitle:mstrmojo.desc(13927,"Line"),controlName:"ReferenceLineLineGroup",showNoneOption:false,showNoFillInColor:false,showGradient:false,resetValue:function C0(){this.lineColorAndStyle.lineColor.set("color","#000000");this.lineColorAndStyle.lineStyle.set("selectedValue","none");}})),C1=BY.call(this,mstrmojo.desc(1452,"Level"),A3,C7(Ac.REF_LEVEL),{reInit:function(){var DL=this.manager.getSelectedValue(Cx,"v"),DK=DG.vis.GMController,DJ=DI&&(DK.hasAttributesInDropzone("Rows")||DK.hasAttributesInDropzone("Columns"))&&(DL&&DL.refType!==B5.EnumRefLineModelType.CONST);if(this.parent){this.parent.set("enabled",DJ);}if(DJ){this.reInitDefault();}if(!DL){Ay(this,function(){this.resetValue();});}},resetValue:function C0(){this.set("selectedIndex",0);}}),Cy=C7(Ac.REF_SHOW_LABEL),C5=CE.call(this,mstrmojo.desc(13749,"Show label"),Cy,Az.copy(C6,{resetValue:function C0(){this.set("checked",false);}})),DH=Ax.call(this,null,[{n:mstrmojo.desc(8733,"Type"),v:B5.EnumTrendRefModelLabels.DssModelLabelsType},{n:mstrmojo.desc(4779,"Metric"),v:B5.EnumTrendRefModelLabels.DssModelLabelsMetric},{n:mstrmojo.desc(527,"Value"),v:B5.EnumTrendRefModelLabels.DssModelLabelsValue}],C7(Ac.REF_LABEL_TYPE),Az.copy(C6,{listenFormatProps:[Cy],onFmtPropsChanged:function(DJ,DK){if(DJ===Cy){var DL=this.manager.getSelectedValue(Cx,"v");this.set("enabled",!!DL&&DK&&DI);}else{this.onFmtPropsChangedDefault(DJ,DK);}},multiSelect:true,resetValue:function C0(){this.clearSelect();}})),C3=BH.call(this,null,DG.getSmartNamesMapForFontGroup(null,DC,"rfLn","fld",Cx),Az.copy(C6,{controlName:"ReferenceLineLabelCharacterGroup",syncWithAllText:true,listenFormatProps:[Cy],onFmtPropsChanged:function(DJ,DL){if(DJ===Cy){var DM=this.manager.getSelectedValue(Cx,"v"),DK=!!DM&&DL&&DI;this.set("enabled",DK);if(DK){this.refreshValues();}}else{if(this.enabled){this.onFmtPropsChangedDefault(DJ,DL);}}},resetValue:function C0(){this.fontColor.set("selectedValue","#000000");this.fontStyle.clearSelect();this.fontSize.set("selectedValue","10");this.fontFamily.set("selectedIndex",0);}}));mstrmojo.css.addWidgetCssClass(C5,"title");this.replaceChildControls(DB,[this.getEditorGroup([Cz,C9,C2,C1],B0),this.getEditorGroup([C5,DH,C3],B0)]);}function AS(C7){var C4=this.broker;function C8(DE){return C4.generateSmartName(null,DE);}var DB=C8(Ac.LEGEND_VISIBLE),C9=function(DF,DH){if(DF===DB){var DG=this.parent,DE=this;if(DG&&DG.scriptClass==="mstrmojo.ui.editors.controls.TwoColumnContainer"){DE=DG;}DE.set("enabled",!!DH);}else{this.onFmtPropsChangedDefault(DF,DH);}},Cz=CE.call(this,mstrmojo.desc(13600,"Show legend"),DB),DD=BH.call(this,null,C4.getSmartNamesMapForFontGroup(o),{controlName:"LegendTextFongGroup",syncWithAllText:true,listenFormatProps:[DB],onFmtPropsChanged:C9}),DC=this.addDisposable(new mstrmojo.Label({text:mstrmojo.desc(13601,"Fill")})),Cy=Cu.call(this,null,C4.getSmartNamesMapForFillGroup(Bj),{controlName:"LegendBackgroundFillGroup",listenFormatProps:[DB],onFmtPropsChanged:C9}),DA=C8(Ac.LEGEND_POSITION),C3=mstrmojo.gm.EnumLegendSlot,C5=[{n:mstrmojo.desc(2166,"Right"),v:C3.RIGHT},{n:mstrmojo.desc(2256,"Top"),v:C3.LEFT_TOP},{n:mstrmojo.desc(2257,"Bottom"),v:C3.LEFT_BOTTOM},],C6=Cb.find(C5,"v",C4.getFormatPropertyValue(DA)),C1=C6===-1?0:C6,C0=this.getPulldown(C5,function(DE){C4.setFormatPropertyValue(DA,DE);},C1),Cx=w.call(this,mstrmojo.desc(2971,"Position")),C2=[Cz,DD,DC,Cy];if(this.getHost().scriptClass==="mstrmojo.ngm.VisNewGraphMatrix"){C2=[Cz,Cx,C0];}else{C2=[Cz,DD,DC,Cy];}mstrmojo.css.addWidgetCssClass(Cz,"title");this.replaceChildControls(C7,[this.getEditorGroup(C2,B0)]);}function An(){var DG=this.broker,C1=BQ,C0=C1+Aw;function C7(DH){return DG.generateSmartName(C0,DH);}function DA(DH){return(DH.TemplateMetric!==undefined)||(DH.TemplateUnit!==undefined)||(DH.MetricNames!==undefined);}var C6=DG.vis.model.data.dz,DF=this.broker.vis,C2=DF.GMController.isWaterfall&&DF.getWaterfallOptions().totalShw,C4=DA(C6.XAxis)||(C2&&C6.YAxis.TemplateMetric!==undefined),C3=DA(C6.YAxis)||(C2&&C6.XAxis.TemplateMetric!==undefined),C5=C4&&C3,DC=[],Cz=[];if(C5){Cz.push((BO.X_CATEGORY|BO.Y_CATEGORY));DC.push({n:mstrmojo.desc(13920,"X and Y axes"),identity:(BO.X_CATEGORY|BO.Y_CATEGORY),prefix:BS,v:0});}if(C4){Cz.push(BO.X_CATEGORY);DC.push({n:mstrmojo.desc(13921,"X axis"),identity:BO.X_CATEGORY,prefix:Bl,v:1});}if(C3){Cz.push(BO.Y_CATEGORY);DC.push({n:mstrmojo.desc(13922,"Y axis"),identity:BO.Y_CATEGORY,prefix:N,v:2});}var DB=DC.length===0,C8=C7(Bh),DE=w.call(this,mstrmojo.desc(12003,"Axis Labels"),{highlightObjects:Cz,scopeSelectors:[C1]}),DD=!DB?F.call(this,null,C1,DC,DG.editorManager,{highlightObjects:Cz,groupTitle:DE}):undefined,Cy=CE.call(this,mstrmojo.desc(13923,"Show labels"),C8,{groupTitle:DE}),Cx=C7(BI);var C9=[DE,DD,Cy,BH.call(this,null,DG.getSmartNamesMapForFontGroup(C0),{controlName:"AxisLabelsFontGroup",syncWithAllText:true,groupTitle:DE,listenFormatProps:[C8],showNoFillInColor:false,onFmtPropsChanged:function(DH,DI){if(DH===C8){this.set("enabled",DI);}else{this.onFmtPropsChangedDefault(DH,DI);}}})];if(this.getHost().scriptClass!=="mstrmojo.ngm.VisNewGraphMatrix"){C9.push(BY.call(this,mstrmojo.desc(13924,"Rotation:"),[{n:mstrmojo.desc(12284,"Automatic"),v:B5.EnumLabelRotation.AUTOMATIC},{n:mstrmojo.desc(12285,"Vertical"),v:B5.EnumLabelRotation.VERTICAL},{n:mstrmojo.desc(12286,"Horizontal"),v:B5.EnumLabelRotation.HORIZONTAL}],Cx,{groupTitle:DE,listenFormatProps:[C8],onFmtPropsChanged:function(DI,DJ){var DK=DD&&DD.selectedIndex===1,DH=Cy.getCtrl().checked;if(DI===C8||DI===Cx){this.parent.set("enabled",DH&&DK);}if(DI===Cx&&DJ!==undefined){this.onFmtPropsChangedDefault(DI,DJ);}}}));}return C9;}function Cd(){var C2=this.broker,C7=C2.editorManager,C0=AJ,C3=C0+Aw,Cx=w.call(this,mstrmojo.desc(12008,"Axis Lines"),{highlightObjects:[(BO.X_AXIS|BO.Y_AXIS|BO.AXIS_ORIGIN),(BO.X_AXIS|BO.Y_AXIS),BO.X_AXIS,BO.Y_AXIS,BO.AXIS_ORIGIN],scopeSelectors:[C0]}),C5=[{n:mstrmojo.desc(13925,"All lines"),identity:(BO.X_AXIS|BO.Y_AXIS|BO.AXIS_ORIGIN),prefix:"allLn",v:0},{n:mstrmojo.desc(13920,"X and Y axes"),identity:(BO.X_AXIS|BO.Y_AXIS),prefix:"allAxLn",v:1},{n:mstrmojo.desc(13921,"X axis"),identity:BO.X_AXIS,prefix:"xAxLn",v:2},{n:mstrmojo.desc(13922,"Y axis"),identity:BO.Y_AXIS,prefix:"yAxLn",v:3}],C4={n:mstrmojo.desc(13926,"Axis origin"),identity:BO.AXIS_ORIGIN,prefix:"axOriLn",v:4},C1=U.call(this);if(C1&&C1.length>0){var C6=C2.generateSmartName(null,t,Ac.AXIS_ORIGIN_AUTO,B8),C8=C2.getFormatPropertyValue(C6,C1[0].v);if(!C8){C5.push(C4);}}var Cz=F.call(this,null,AJ,C5,C7,{highlightObjects:[(BO.X_AXIS|BO.Y_AXIS|BO.AXIS_ORIGIN),(BO.X_AXIS|BO.Y_AXIS),BO.X_AXIS,BO.Y_AXIS,BO.AXIS_ORIGIN],groupTitle:Cx}),Cy=CN.call(this,null,C2.getSmartNamesMapForLineGroup(C3),{lineTitle:mstrmojo.desc(13927,"Line"),controlName:"AxisLineGroup",groupTitle:Cx,showNoFillInColor:false,showNoneOption:false,showGradient:false,onSelectorsValueChanged:function(C9,DA){if(C9===AJ){this.set("showNoneOption",DA!==4&&DA!==0);}this.onSelectorsValueChangedDefault(C9,DA);}});return[Cx,Cz,Cy];}function AH(){var C4=this.broker,DB=C4.editorManager,C2=Au,C5=C2+Aw,Cx=w.call(this,mstrmojo.desc(12010,"Axis Titles"),{highlightObjects:[CZ.longIntOr(BO.X_METRIC_AXIS_TITLE,BO.Y_METRIC_AXIS_TITLE),BO.X_METRIC_AXIS_TITLE,BO.Y_METRIC_AXIS_TITLE],scopeSelectors:[C2]});var Cy=[],C9={XAxisTitle:{n:mstrmojo.desc(13921,"X axis"),identity:BO.X_METRIC_AXIS_TITLE,prefix:"xAxTt",v:1},YAxisTitle:{n:mstrmojo.desc(13922,"Y axis"),identity:BO.Y_METRIC_AXIS_TITLE,prefix:"yAxTt",v:2},XAndYAxesTitle:{n:mstrmojo.desc(13920,"X and Y axes"),identity:CZ.longIntOr(BO.X_METRIC_AXIS_TITLE,BO.Y_METRIC_AXIS_TITLE),prefix:"allAxTt",v:0}},DA=C4.vis.GMController,C7=DA.haveMetricAxisTitle("y"),C3=DA.haveMetricAxisTitle("x");C7=C7||DA.haveAttributeAxisTitle("y");C3=C3||DA.haveAttributeAxisTitle("x");if(C7){Cy.unshift(C9.YAxisTitle);}if(C3){Cy.unshift(C9.XAxisTitle);}if(C7&&C3){Cy.unshift(C9.XAndYAxesTitle);}var C8=Cy.length===0,C1=!C8?F.call(this,null,C2,Cy,DB,{highlightObjects:[CZ.longIntOr(BO.X_METRIC_AXIS_TITLE,BO.Y_METRIC_AXIS_TITLE),BO.X_METRIC_AXIS_TITLE,BO.Y_METRIC_AXIS_TITLE],groupTitle:Cx,enabled:!C8}):undefined,C6=C4.generateSmartName(C5,Bh),C0=CE.call(this,mstrmojo.desc(13928,"Show axis titles"),C6,{groupTitle:Cx}),Cz=BH.call(this,null,C4.getSmartNamesMapForFontGroup(C5),C8?null:{controlName:"AxisTitlesFontGroup",groupTitle:Cx,syncWithAllText:true,listenFormatProps:[C6],onFmtPropsChanged:function(DC,DD){if(DC===C6){this.set("enabled",DD);}else{this.onFmtPropsChangedDefault(DC,DD);}}});Cx.set("enabled",!C8);C0.set("enabled",!C8);Cz.set("enabled",!C8);return[Cx,C1,C0,Cz];}function Ap(){var C1=this.broker,C5=C1.editorManager,Cz=CT,C2;var Cx=w.call(this,mstrmojo.desc(11991,"Grid Lines"),{highlightObjects:[(BO.GRID_LINE|BO.MINOR_GRID_LINE),BO.GRID_LINE,BO.MINOR_GRID_LINE],scopeSelectors:[Cz]}),C0;if(this.getHost().scriptClass==="mstrmojo.ngm.VisNewGraphMatrix"){C2=C1.generateSmartName(null,Cv.ALL_NGM_GRID_LINES_SHOW);C0=BY.call(this,null,[{n:mstrmojo.desc(6019,"Automatic"),v:B5.EnumNGMGridLines.AUTO},{n:mstrmojo.desc(15672,"Show horizontal"),v:B5.EnumNGMGridLines.SHOW_Y},{n:mstrmojo.desc(15673,"Show vertical"),v:B5.EnumNGMGridLines.SHOW_X},{n:mstrmojo.desc(15674,"Show both"),v:B5.EnumNGMGridLines.SHOW},{n:mstrmojo.desc(15675,"Show none"),v:B5.EnumNGMGridLines.HIDE}],C2,{groupTitle:Cx,listenFormatProps:[C2]});C5.registerSelector(Cz,C0);return[Cx,C0];}else{C2=C1.generateSmartName(null,Cv.ALL_GRID_LINES_SHOW);C0=BY.call(this,null,[{n:mstrmojo.desc(6019,"Automatic"),v:B5.EnumGridLines.AUTO},{n:mstrmojo.desc(13929,"Show major and minor"),v:B5.EnumGridLines.SHOW},{n:mstrmojo.desc(13930,"Show major only"),v:B5.EnumGridLines.SHOW_MAJOR_ONLY},{n:mstrmojo.desc(2772,"Hide"),v:B5.EnumGridLines.HIDE}],C2,{groupTitle:Cx,fnChange:function(C7){C5.onTargetSelectionChanged(Cz,C7);C5.sendNonShapeTargetSelectionIdentity(Cz);if(this._sync){return ;}C1.setFormatPropertyValue(C2,C7);}});C5.registerSelector(Cz,C0);var Cy=C1.generateSmartName(BQ+Aw,Bh),C3=C1.generateSmartName(Bl,Bh),C6=C1.generateSmartName(N,Bh);var C4=CN.call(this,null,C1.getSmartNamesMapForLineGroup(null,"allGridLn"),{lineTitle:mstrmojo.desc(13927,"Line"),controlName:"GridLineGroup",showNoneOption:false,groupTitle:Cx,showNoFillInColor:false,listenFormatProps:[Cy,C2],showGradient:false,onFmtPropsChanged:function(C8,DD){if(C8===Cy||C8===C2){var C7=true,C9=C1.getFormatPropertyValue(C3),DE=C1.getFormatPropertyValue(C6);if(C1.getVisProfile(CO)&&!C9&&!DE){C7=false;}else{if(C1.getVisProfile(AD)){var DB=C1.vis.getChartInfo();if(DB.dirc===B5.EnumABLDirection.HORIZONTAL&&!C9){C7=false;}else{if(DB.dirc===B5.EnumABLDirection.VERTICAL&&!DE){C7=false;}}}}this.getCtrlContainer().parent.set("enabled",C7);var DA=C1.getFormatPropertyValue(C2),DC=(DA===B5.EnumGridLines.AUTO&&!C1.vis.isMajorGridLineShow())||DA===B5.EnumGridLines.HIDE;this.getCtrlContainer().set("enabled",C7&&!DC);}else{this.onFmtPropsChangedDefault(C8,DD);}}});return[Cx,C0,C4];}}function CM(Cx){var Cy=this.getHost().scriptClass==="mstrmojo.ngm.VisNewGraphMatrix";if(Cy){this.replaceChildControls(Cx,[this.getEditorGroup(An.call(this),BD),this.getEditorGroup(AH.call(this),Az.copy(BD,CX)),this.getEditorGroup(Ap.call(this),BD)]);}else{this.replaceChildControls(Cx,[this.getEditorGroup(An.call(this),BD),this.getEditorGroup(Cd.call(this),BD),this.getEditorGroup(AH.call(this),Az.copy(BD,CX)),this.getEditorGroup(Ap.call(this),BD)]);}}function AP(Cy){var Cx=[];Cx.push(this.getEditorGroup(B9.call(this),B0));Cx.push(this.getEditorGroup(Cs.call(this),B0));Cx.push(this.getEditorGroup(Q.call(this),BD));Cx.push(this.getEditorGroup(Ad.call(this),BD));Cx.push(this.getEditorGroup([this.getMoreOptionsEditorLink(this.getHost().model.data.gsi.prop)],BD));this.replaceChildControls(Cy,Cx);}function B9(){var Cz=this.broker,Cx=Cz.generateSmartName(null,Cv.TOTAL_SHOW),C3=Cz.generateSmartName(null,Cv.TOTAL_LABEL),Cy=w.call(this,mstrmojo.desc(2121,"Total")),C0=CE.call(this,mstrmojo.desc(15772,"Show total"),Cx,{groupTitle:Cy,listenFormatProps:[Cx],onFmtPropsChanged:function(C4,C5){if(C4===Cx){this.onFmtPropsChangedDefault(C4,C5);}}}),C2=new mstrmojo.Label({text:mstrmojo.desc(8263,"Label")}),C1=k(C2,e.call(this,null,C3,{dtp:s.VARCHAR,onValid:function(){if(this._sync){return ;}Cz.setFormatPropertyValue(this.smartNames[0],this.value);},groupTitle:Cy,listenFormatProps:[Cx],onFmtPropsChanged:function(C4,C5){if(C4===Cx){this.set("enabled",C5);C2.parent.set("enabled",C5);}else{this.onFmtPropsChangedDefault(C4,C5);}}}),"50%","50%");this.addDisposable([Cy,C0,C1]);return[Cy,C0,C1];}function Cs(){var C0=this.broker,C3=C0.generateSmartName(null,Cv.INT_SUM_SHOW),C2=C0.generateSmartName(null,Cv.INT_SUM_FULL),Cz=w.call(this,mstrmojo.desc(9713,"Subtotal")),C1=C0.getVisProfile(Bf)||C0.getVisProfile(AG),Cy=CE.call(this,mstrmojo.desc(3720,"Show subtotals"),C3,{groupTitle:Cz,listenFormatProps:[C3],onFmtPropsChanged:function(C4,C5){if(!C1){this.parent.set("enabled",false);}if(C4===C3){this.onFmtPropsChangedDefault(C4,C5&&C1);}}}),Cx=CE.call(this,mstrmojo.desc(15773,"Cumulative subtotals"),C2,{groupTitle:Cz,listenFormatProps:[C3],onFmtPropsChanged:function(C4,C5){if(C4===C3){this.parent.set("enabled",C5&&C1);}else{this.onFmtPropsChangedDefault(C4,C5&&C1);}}});this.addDisposable([Cz,Cy,Cx]);return[Cz,Cy,Cx];}function Q(){var C3=this.broker,C1=this.broker.vis,C2=C3.generateSmartName(null,Cv.TOTAL_SHOW),Cx=C3.generateSmartName(null,Cv.INT_SUM_SHOW),C6=CZ.decodeColor(C1.getWidgetPropertyValue(Cv.POSITIVE_COLOR)),C0=CZ.decodeColor(C1.getWidgetPropertyValue(Cv.NEGATIVE_COLOR)),C8=CZ.decodeColor(C1.getWidgetPropertyValue(Cv.TOTAL_COLOR)),DB=CZ.decodeColor(C1.getWidgetPropertyValue(Cv.INT_SUM_COLOR)),C7=C3.getVisProfile(Bf)||C3.getVisProfile(AG),Cy=w.call(this,mstrmojo.desc(6242,"Color")),DA=k(new mstrmojo.Label({text:mstrmojo.desc(8314,"Increase")}),g.call(this,null,C3.generateSmartName(null,Cv.POSITIVE_COLOR),{groupTitle:Cy,showGradient:false,showAutomatic:true,selectedValue:C6,onFmtPropsChanged:function C9(DC,DF){var DE=CZ.decodeColor(C1.property.defaultsObj[DC]),DD=DF==="default"||DF===DE;this.syncControl(function(){this.set("autoPreviewColor",DD?DE:null);});}}),"60%","40%"),C4=k(new mstrmojo.Label({text:mstrmojo.desc(8315,"Decrease")}),g.call(this,null,C3.generateSmartName(null,Cv.NEGATIVE_COLOR),{groupTitle:Cy,showGradient:false,showAutomatic:true,selectedValue:C0,onFmtPropsChanged:function C9(DC,DF){var DD=DF==="default",DE=CZ.decodeColor(C1.property.defaultsObj[DC]);this.syncControl(function(){this.set("autoPreviewColor",DD?DE:null);});}}),"60%","40%"),C5=k(new mstrmojo.Label({text:mstrmojo.desc(2121,"Total")}),g.call(this,null,C3.generateSmartName(null,Cv.TOTAL_COLOR),{groupTitle:Cy,showGradient:false,listenFormatProps:[C2],showAutomatic:true,selectedValue:C8,onFmtPropsChanged:function C9(DC,DF){var DD=DF==="default",DE=CZ.decodeColor(C1.property.defaultsObj[DC]);this.syncControl(function(){this.set("autoPreviewColor",DD?DE:null);});if(DC===C2){this.parent.set("enabled",DF);}}}),"60%","40%"),Cz=k(new mstrmojo.Label({text:mstrmojo.desc(1912,"Subtotals")}),g.call(this,null,C3.generateSmartName(null,Cv.INT_SUM_COLOR),{groupTitle:Cy,listenFormatProps:[Cx],showGradient:false,showAutomatic:true,selectedValue:DB,onFmtPropsChanged:function C9(DC,DF){var DD=DF==="default",DE=CZ.decodeColor(C1.property.defaultsObj[DC]);this.syncControl(function(){this.set("autoPreviewColor",DD?DE:null);});if(DC===Cx){this.parent.set("enabled",DF&&C7);}}}),"60%","40%");this.addDisposable([Cy,DA,C4,C5,Cz]);return[Cy,DA,C4,C5,Cz];}function CD(){var Cx=this.broker,C1=Cx.vis,C3=C1.GMController,Cz=Cx.generateSmartName(null,Cv.CONTAINER_FIT_MODE),C2,Cy,C0=[{n:mstrmojo.desc(4531,"Automatic"),v:B.AUTOMATIC},{n:mstrmojo.desc(12058,"Fit To Container"),v:B.FIT_TO_CONTAINER},{n:mstrmojo.desc(16039,"Fit To Content"),v:B.FIT_TO_CONTENT}];if(C3.isHistogram){C0.pop();}Cy=new mstrmojo.Label({text:mstrmojo.desc(14795,"Container fit:")});C2=BY.call(this,null,C0,Cz,{onFmtPropsChanged:function(C4,C5){this.onFmtPropsChangedDefault(C4,C5);}});this.addDisposable([Cy,C2]);return[Cy,C2];}function Cf(Cy){var Cx=[];Cx.push(this.getEditorGroup(Bz.call(this),BD));Cx.push(this.getEditorGroup(Ad.call(this),BD));Cx.push(this.getEditorGroup([this.getMoreOptionsEditorLink(this.getHost().model.data.gsi.prop)],BD));this.replaceChildControls(Cy,Cx);}function Bz(){var C1=this.broker,Cy,C7=C1.generateSmartName(null,Cv.MANUAL_BINS_MODE),C6=C1.generateSmartName(null,Cv.CUSTOM_BINS_MODE),Cx=w.call(this,mstrmojo.desc(15767,"Bin Configuration"));var C8,DA,C2,DC,Cy,C9,C0,C5,C4,DB,DA;Cy=BY.call(this,new mstrmojo.Label({text:mstrmojo.desc(8262,"Manual")}),[{n:mstrmojo.desc(15687,"By Number of Bins"),v:B5.EnumHistogram.BY_BIN_NUMBER},{n:mstrmojo.desc(15688,"By Bin Size"),v:B5.EnumHistogram.BY_BIN_SIZE}],C7,{enabled:this.broker.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL,visible:true,listenFormatProps:[C6],onFmtPropsChanged:function(DD,DE){if(DD===C6){this.set("enabled",DE===B5.EnumHistogram.MANUAL);}else{this.onFmtPropsChangedDefault(DD,C.toLocaleString(DE));}}});C9=CE.call(this,mstrmojo.desc(12143,"Automatic"),null,{listenFormatProps:[C6],onFmtPropsChanged:function(DE,DD){if(DE===C6){this.checked=DD===B5.EnumHistogram.AUTOMATIC;}},oncheckedChange:function(){if(this.sync){return ;}var DD=this.checked?B5.EnumHistogram.AUTOMATIC:B5.EnumHistogram.MANUAL;this.broker.vis.setWidgetPropertyValue(Cv.HAS_UNCHECKED_AUTO,true);this.broker.setFormatPropertyValue(C6,DD);}});C2=new mstrmojo.Label({text:mstrmojo.desc(15692,"Bin Qty")});C0=e.call(this,null,C1.generateSmartName(null,Cv.NUM_BINS),{constraints:{trigger:mstrmojo.validation.TRIGGER.ONBLUR,min:1,max:500},visible:this.broker.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL&&this.broker.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_NUMBER,listenFormatProps:[C7,C6],onFmtPropsChanged:function(DD,DE){if(DD===C7){C2.set("visible",DE===B5.EnumHistogram.BY_BIN_NUMBER&&(C1.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL));if(this.parent){CB.toggleClass(this.parent.domNode,"hiddenPP",!(DE===B5.EnumHistogram.BY_BIN_NUMBER&&(C1.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL)));}if(!(C1.vis.getWidgetPropertyValue(Cv.HAS_UNCHECKED_AUTO))&&DE===B5.EnumHistogram.BY_BIN_NUMBER&&(C1.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL)){this.set("value",C1.getFormatPropertyValue("numBins"));}this.set("visible",DE===B5.EnumHistogram.BY_BIN_NUMBER&&(C1.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL));}else{if(DD===C6){this.set("visible",DE===B5.EnumHistogram.MANUAL&&C1.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_NUMBER);C2.set("visible",DE===B5.EnumHistogram.MANUAL&&C1.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_NUMBER);if(this.parent){CB.toggleClass(this.parent.domNode,"hiddenPP",!(this.visible));}}else{this.onFmtPropsChangedDefault(DD,C.toLocaleString(DE));}}}});DC=k(C2,C0,"40%","60%");var C3={min:this.broker.vis.GMController.getExtremes(0,1).YMinValue,max:this.broker.vis.GMController.getExtremes(0,1).YMaxValue};C1.generateSmartName(null,Cv.XBINS_START);C1.generateSmartName(null,Cv.XBINS_END);var Cz=C1.generateSmartName(null,Cv.RANGE_TYPE);C5=new mstrmojo.Label({text:mstrmojo.desc(16179,"Bin Range")});C4=CE.call(this,mstrmojo.desc(12552,"Custom range"),Cz,{listenFormatProps:[C7],onFmtPropsChanged:function(DD,DE){if(DD===C7&&DE===B5.EnumHistogram.BY_BIN_SIZE&&!this.broker.vis.getWidgetPropertyValue(Cv.HAS_UNCHECKED_DATASET_RANGE)){}else{if(DD===C6){this.set("visible",DE===B5.EnumHistogram.MANUAL&&this.broker.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_NUMBER);}}},oncheckedChange:function(){if(this.sync){return ;}if(this.checked){C1.setFormatPropertyValue(Cv.HAS_UNCHECKED_DATASET_RANGE,true);DB.min.set("enabled",true);DB.max.set("enabled",true);DB.max.setValue(this.broker.vis.getWidgetPropertyValue(Cv.XBINS_END));DB.max.hint=DB.max.value;DB.min.setValue(this.broker.vis.getWidgetPropertyValue(Cv.XBINS_START));DB.min.hint=DB.min.value;DA.children[1].onFmtPropsChanged(Cv.XBINS_SIZE,this.broker.vis.getWidgetPropertyValue(Cv.XBINS_SIZE));if(C1.vis.getWidgetPropertyValue(Cv.RANGE_TYPE)!==B5.EnumHistogram.CUST_INPUT){C1.setFormatPropertyValue(Cv.RANGE_TYPE,B5.EnumHistogram.CUST_INPUT);C1.vis.clientRerenderGraphMatrix();}}else{DB.max.set("enabled",false);DB.min.set("enabled",false);DB.max.setValue(C3.max);DB.max.hint=C3.max;DB.min.setValue(C3.min);DB.min.hint=C3.min;if(C1.vis.getWidgetPropertyValue(Cv.RANGE_TYPE)!==B5.EnumHistogram.DATASET){C1.setFormatPropertyValue(Cv.RANGE_TYPE,B5.EnumHistogram.DATASET);C1.vis.clientRerenderGraphMatrix();}}}});DB=new mstrmojo.ui.editors.controls.CustomRange({alias:"rangeCtrl",range:C3,data:{newRangeValid:true,rangeKeysChanged:[],autoKeysChanged:[]},scriptClass:"mstrmojo.ui.editors.controls.CustomRange",rangeConstraints:{min:{min:null,max:null},max:{min:null,max:null}},rangeChanged:function(){var DE=this.getRange(),DF=DE.customMin,DD=DE.customMax;C1.setFormatPropertyValue(Cv.XBINS_START,DF);C1.setFormatPropertyValue(Cv.XBINS_END,DD);C1.vis.clientRerenderGraphMatrix();}});C8=new mstrmojo.Label({text:mstrmojo.desc(16187,"Bin Size")});DA=k(C8,e.call(this,null,C1.generateSmartName(null,Cv.XBINS_SIZE),{visible:this.broker.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL&&this.broker.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_SIZE,listenFormatProps:[C7,C6],onFmtPropsChanged:function(DD,DF){if(DD===C7){var DG=this.broker.getFormatPropertyValue(C6),DE=DG===B5.EnumHistogram.MANUAL;this.set("visible",DF===B5.EnumHistogram.BY_BIN_SIZE&&DE);if(this.parent){CB.toggleClass(this.parent.domNode,"hiddenPP",!(DF===B5.EnumHistogram.BY_BIN_SIZE&&DE));}C5.set("visible",DF===B5.EnumHistogram.BY_BIN_SIZE&&DE);C4.set("visible",DF===B5.EnumHistogram.BY_BIN_SIZE&&DE);C8.set("visible",DF===B5.EnumHistogram.BY_BIN_SIZE&&DE);DB.set("visible",DF===B5.EnumHistogram.BY_BIN_SIZE&&DE);if(C1.vis.getWidgetPropertyValue(Cv.RANGE_TYPE)===B5.EnumHistogram.DATASET){DB.max.set("enabled",false);DB.min.set("enabled",false);}if(!(C1.vis.getWidgetPropertyValue(Cv.HAS_UNCHECKED_AUTO))&&DF===B5.EnumHistogram.BY_BIN_SIZE&&DE){this.set("value",C1.getFormatPropertyValue("xBinsSize"));}}else{if(DD===C6){if(DF===B5.EnumHistogram.AUTOMATIC){this.set("visible",false);if(this.parent){CB.toggleClass(this.parent.domNode,"hiddenPP",true);}C8.set("visible",false);C5.set("visible",false);C4.set("visible",false);DB.set("visible",false);}else{if(DF===B5.EnumHistogram.MANUAL&&C1.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_SIZE){this.set("visible",true);if(this.parent){CB.toggleClass(this.parent.domNode,"hiddenPP",false);}C8.set("visible",true);C5.set("visible",true);C4.set("visible",true);DB.set("visible",true);if(C1.vis.getWidgetPropertyValue(Cv.RANGE_TYPE)===B5.EnumHistogram.DATASET){DB.max.set("enabled",false);DB.min.set("enabled",false);}}}}else{this.onFmtPropsChangedDefault(DD,C.toLocaleString(DF));}}}}),"50%","50%");if(this.broker.getFormatPropertyValue(C6)===B5.EnumHistogram.MANUAL&&this.broker.getFormatPropertyValue(C7)===B5.EnumHistogram.BY_BIN_SIZE&&this.broker.vis.getWidgetPropertyValue(Cv.RANGE_TYPE)!==B5.EnumHistogram.DATASET){C8.set("visible",true);DB.set("visible",true);DB.max.setValue(this.broker.vis.getWidgetPropertyValue(Cv.XBINS_END));DB.max.hint=this.broker.vis.getWidgetPropertyValue(Cv.XBINS_END);DB.min.setValue(this.broker.vis.getWidgetPropertyValue(Cv.XBINS_START));DB.min.hint=this.broker.vis.getWidgetPropertyValue(Cv.XBINS_START);DB.range={min:this.broker.vis.getWidgetPropertyValue(Cv.XBINS_START),max:this.broker.vis.getWidgetPropertyValue(Cv.XBINS_END)};}if(this.broker.getFormatPropertyValue(Cz)===B5.EnumHistogram.CUST_INPUT){C4.getCtrl().set("checked",true);}this.addDisposable([Cx,C9,Cy,DC,C5,C4,DB,DA]);return[Cx,C9,Cy,DC,C5,C4,DB,DA];}function AK(Cy){var Cx=[];Cx.push(this.getEditorGroup(a.call(this),BD));Cx.push(this.getEditorGroup(P.call(this),BD));Cx.push(this.getEditorGroup(Ad.call(this),BD));Cx.push(this.getEditorGroup([this.getMoreOptionsEditorLink(this.getHost().model.data.gsi.prop)],BD));this.replaceChildControls(Cy,Cx);}function P(){var Cy=this.broker,C0=Cy.generateSmartName(null,Cv.MEAN_SD),Cz=new mstrmojo.Label({text:mstrmojo.desc(13952,"Other Parameters:")}),Cx=BY.call(this,null,[{n:mstrmojo.desc(15317,"No Mean"),v:B5.EnumBoxPlotMean.NO_MEAN},{n:mstrmojo.desc(15318,"Only Mean"),v:B5.EnumBoxPlotMean.ONLY_MEAN},{n:mstrmojo.desc(15319,"Mean and Standard Deviation"),v:B5.EnumBoxPlotMean.MEAN_STDEV}],C0);this.addDisposable([Cz,Cx]);return[Cz,Cx];}function a(){var Cx=this.broker,C2=Cx.generateSmartName(null,Cv.SHOW_OUTLIERS),C1=Cx.generateSmartName(null,Cv.JITTER);var C3=function(){var C5=this.typeHelper;C5.updateSelection();if(this.enabled){var C6=this.selectedIndex;this.broker.setFormatPropertyValue(C1,C.parseNumeric(this.items[C6].v));this.broker.vis.clientRerenderGraphMatrix();}};var C4=Ae.call(this,C3,0,1,0.01,null,{isHoriz:true,min:0,max:1,enabled:true,listenFormatProps:[C2],onFmtPropsChanged:function(C5){if(C5===C2){this.set("enabled",Cz.getCtrl().checked);if(!this.enabled){CB.addWidgetCssClass(this,"disabled");Cy.domNode&&Cy.domNode.classList.add("disabled");this.selectedIndex=0;this.selectedIndices={};this.selectedIndices[0]=true;this.selectedItem=this.items[0];this.refresh();}else{this.domNode&&this.domNode.classList.remove("disabled");Cy.domNode&&Cy.domNode.classList.remove("disabled");}}},reInit:function C0(){this.getCtrlContainer().set("enabled",Cz.getCtrl().checked);if(this.enabled){var C5=Math.min(Math.floor(C.parseNumeric(this.broker.vis.getWidgetPropertyValue("jitter"))*100),99);this.selectedIndex=C5;this.selectedIndices={};this.selectedIndices[C5]=true;this.selectedItem=this.items[C5];}this.reInitDefault();}});var Cz=CE.call(this,mstrmojo.desc(15309,"Show all points"),C2,{oncheckedChange:function(){if(this._sync){return ;}var C5=this.checked?B5.EnumBoxPlotOutliers.ALL_POINTS:B5.EnumBoxPlotOutliers.OUTLIERS;this.broker.setFormatPropertyValue(C2,C5);if(!this.checked){this.broker.setFormatPropertyValue(C1,0);C4.reInit();}},onFmtPropsChanged:function(C6){if(C6===C2){var C5=this.broker.vis.getWidgetPropertyValue(C2)===B5.EnumBoxPlotOutliers.ALL_POINTS;this.set("checked",C5);}}});var Cy=new mstrmojo.Label({text:mstrmojo.desc(null,"Jitter (0.00 - 1.0):")});this.addDisposable([Cz,Cy,C4]);return[Cz,Cy,C4];}function j(){var C5=this.broker,DA=C5.editorManager,C3=G,C6=C3+Aw,Cy=C7(Bh);function C4(){return{highlightObjects:[(BO.ROW_HEADER|BO.COL_HEADER|BO.ROW_TITLE|BO.COL_TITLE),(BO.ROW_HEADER|BO.ROW_TITLE),(BO.COL_HEADER|BO.COL_TITLE),BO.ROW_TITLE,BO.COL_TITLE,BO.ROW_HEADER,BO.COL_HEADER]};}function C7(DB){return C5.generateSmartName(C6,DB);}function C2(){return{listenFormatProps:[Cy],onFmtPropsChanged:function(DB,DC){if(DB===Cy){this.getCtrlContainer().set("enabled",DC);}else{this.onFmtPropsChangedDefault(DB,DC);}}};}var Cx=w.call(this,mstrmojo.desc(1013,"Text"),Az.copy(C4(),{scopeSelectors:[C3]})),C1=F.call(this,null,C3,[{n:mstrmojo.desc(3524,"All"),identity:(BO.ROW_HEADER|BO.COL_HEADER|BO.ROW_TITLE|BO.COL_TITLE),prefix:"allRwCol",v:0},{n:mstrmojo.desc(13665,"Row Text"),identity:(BO.ROW_HEADER|BO.ROW_TITLE),prefix:BV,v:1},{n:mstrmojo.desc(13666,"Column Text"),identity:(BO.COL_HEADER|BO.COL_TITLE),prefix:AC,v:2},{n:mstrmojo.desc(12014,"Row Headers"),identity:BO.ROW_TITLE,prefix:BE,v:3},{n:mstrmojo.desc(12015,"Column Headers"),identity:BO.COL_TITLE,prefix:Bq,v:4},{n:mstrmojo.desc(12016,"Row Values"),identity:BO.ROW_HEADER,prefix:"rwVl",v:5},{n:mstrmojo.desc(12017,"Column Values"),identity:BO.COL_HEADER,prefix:"colVl",v:6}],DA,Az.copy(C4(),{groupTitle:Cx})),C0=CE.call(this,mstrmojo.desc(14315,"Show text"),Cy,{groupTitle:Cx}),Cz=BH.call(this,null,C5.getSmartNamesMapForFontGroup(C6,"Txt"),Az.copy(C2(),{controlName:"RowsAndColsFontGroup",groupTitle:Cx,syncWithAllText:true})),C9=Ax.call(this,null,[{n:mstrmojo.desc(3049,"Left"),v:B5.EnumTextAlignH.LEFT,css:"left"},{n:mstrmojo.desc(2193,"Center"),v:B5.EnumTextAlignH.MIDDLE,css:"center"},{n:mstrmojo.desc(2166,"Right"),v:B5.EnumTextAlignH.RIGHT,css:"right"}],C7(Cm),Az.copy(C2(),{cssClass:"txtAlign",showIcon:true,groupTitle:Cx})),C8=Ax.call(this,null,[{n:mstrmojo.desc(2256,"Top"),v:B5.EnumTextAlignV.TOP,css:"top"},{n:mstrmojo.desc(8631,"Middle"),v:B5.EnumTextAlignV.MIDDLE,css:"middle"},{n:mstrmojo.desc(2257,"Bottom"),v:B5.EnumTextAlignV.BOTTOM,css:"bottom"}],C7(Be),Az.copy(C2(),{cssClass:"verticalAlign",showIcon:true,groupTitle:Cx}));return[Cx,C1,C0,Cz,C9,C8];}function AL(){var C0=this.broker,C3=C0.editorManager,C1=BW,Cx=C1+Aw,C2=BT+Aw;var Cz=w.call(this,mstrmojo.desc(3905,"Background"),{highlightObjects:[BO.ROWS_BACKGROUND,BO.COLS_BACKGROUND],scopeSelectors:[C1]}),Cy=C0.getSmartNamesMapForFillGroup(Cx);return[Cz,F.call(this,null,C1,[{n:mstrmojo.desc(2968,"Rows"),prefix:BE,identity:BO.ROWS_BACKGROUND,v:0},{n:mstrmojo.desc(122,"Columns"),prefix:Bq,identity:BO.COLS_BACKGROUND,v:1}],C3,{highlightObjects:[BO.ROWS_BACKGROUND,BO.COLS_BACKGROUND],groupTitle:Cz}),Cu.call(this,mstrmojo.desc(2885,"Fill"),Cy,{listenFormatProps:Az.valarray(this.broker.getSmartNamesMapForFillGroup(C2)),controlName:"BackgroundFillGroup",groupTitle:Cz,showGradient:false})];}function AU(){var Cy=this.broker,C1=Cy.editorManager,Cz=Br,Cx=Cz+Aw;var C0=w.call(this,mstrmojo.desc(12050,"Matrix Lines"),{highlightObjects:[(BO.H_MATRIX_LINE|BO.V_MATRIX_LINE),BO.H_MATRIX_LINE,BO.V_MATRIX_LINE],scopeSelectors:[Cz]});return[C0,F.call(this,null,Cz,[{n:mstrmojo.desc(11998,"All Matrix Lines"),prefix:"allMatrixLn",identity:(BO.H_MATRIX_LINE|BO.V_MATRIX_LINE),v:0},{n:mstrmojo.desc(11999,"Horizontal Matrix Lines"),prefix:"hMatrixLn",identity:BO.H_MATRIX_LINE,v:1},{n:mstrmojo.desc(12000,"Vertical Matrix Lines"),prefix:"vMatrixLn",identity:BO.V_MATRIX_LINE,v:2}],C1,{highlightObjects:[(BO.H_MATRIX_LINE|BO.V_MATRIX_LINE),BO.H_MATRIX_LINE,BO.V_MATRIX_LINE],groupTitle:C0}),CN.call(this,null,Cy.getSmartNamesMapForLineGroup(Cx),{lineTitle:mstrmojo.desc(13927,"Line"),controlName:"MatrixLineGroup",groupTitle:C0,showNoFillInColor:false,showGradient:false})];}function Cq(Cx){this.replaceChildControls(Cx,[this.getEditorGroup(j.call(this),B0),this.getEditorGroup(AL.call(this),BD),this.getEditorGroup(AU.call(this),BD)]);}function I(Cx){var C0=this.broker.vis,Cz=Ci(C0.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy),C1=Cz[0],Cy=C0.model.xtab.gridInfo,C3=Cy.mx,C2=Cy.thresholds[C1.id];return this.getLabelAndControl(mstrmojo.desc(6242,"Color"),this.addDisposable(new mstrmojo.vi.ui.ColorRangeSelector({thresholds:C2,metric:C3[Cb.find(C3,"did",C1.id)],postclick:Cx,onclick:function(){C0.model.openThresholdEditor(Cz[0],true,false);}})),"30%","70%");}function Al(){var Cz,Cy=[],C0=[],Cx=this.getHost().getStyleEffectsOptions(),C1=false;Cx.forEach(function(C3){var C2=C3.optLvl;if(C2===CF.ALL_SHAPE){Cz=C3;}else{if(C2===CF.METRIC){Cy.push(C3);}else{if(C2===CF.COLOR_BY){if(C3.isMetricNames){C1=true;}C0=C3.subOptions||[];}}}});if(C1){Cy=[];}return{allItem:Cz,metricItems:Cy,colorByItems:C0,originCollection:Cx};}function BL(){var Cz=this.getHost(),C9=this.broker,DN=C9.editorManager,DJ=Ci(C9.vis.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy).length>0,DF=Cz.isShapeCombonation(),DG=DF.isComb,C7=Al.call(this),DT=C7.allItem,DB=C7.metricItems,C3=C7.colorByItems;var DV="ShapeFormatting";function DI(DX){return C9.generateSmartName(null,DV,DX,null,Ar);}function C5(DX){return DI(C9.getFormatPropertyKey(DX).filedAlias+Aj);}function DL(){return function(){v(DN).call(this);DN.sendShapeOption();};}var C1=w.call(this,mstrmojo.desc(13751,"Shape Formatting")),C2=AF.call(this,{allItem:DT,metricItems:DB,colorByItems:C3},{groupTitle:C1,postclick:DL(DN)}),C6=[];function DR(){var DX=[CH.AREA,CH.LINE];if(C9.getVisProfile(AD)){DX=[];}else{if(C9.getVisProfile(CO)){DX.push(CH.BAR);}}return Cb.filter([{n:mstrmojo.desc(12097,"Bar"),v:CH.BAR},{n:mstrmojo.desc(12098,"Line"),v:CH.LINE},{n:mstrmojo.desc(12099,"Area"),v:CH.AREA},{n:mstrmojo.desc(12100,"Circle"),v:CH.CIRCLE},{n:mstrmojo.desc(12101,"Square"),v:CH.SQUARE},{n:mstrmojo.desc(12102,"Tick"),v:CH.TICK},{n:mstrmojo.desc(12103,"Ring"),v:CH.RING},{n:mstrmojo.desc(12104,"Pie"),v:CH.PIE}],function(DY){return DX.indexOf(DY.v)===-1;});}var DM=[CH.BAR,CH.AREA,CH.CIRCLE,CH.SQUARE],Cy=[CH.LINE,CH.TICK],DC=function DC(){var DX=C2.value&&C2.value.optLvl;return(C3.length>0&&DX!==CF.ALL_SHAPE&&DX!==CF.METRIC)||(C3.length===0&&DX===CF.ALL_SHAPE);},DW=function DW(Da,DX){if(DX){Az.copy({col1Node:"58%",col2Node:"42%"},Da.layoutConfig.w);var DY=3;Az.copy({cssText:"margin-left: "+DY+"px;",getLayoutOffsets:function DZ(){return{h:0,w:DY};}},Da.getCtrl());}return Da;};function DD(DZ,DX,Dc,Dd){var Db={postclick:DL(DN),groupTitle:C1,preBuildRendering:Cl,onRender:function(){this.reInit();}},DY=C5(DX);if(!DZ){Az.copy({reInit:function(){var De=DC();if(Dc){this.getCtrlContainer().set("enabled",De);}else{this.setChildEnable(Bm,De);}this.reInitDefault();},onGroupValueChange:function(De,Df){if(DX&&De===DX&&Df===W.VAL_AUTOMATIC){Df=AY;}this.broker.setFormatPropertyValue(De,Df);},onFmtPropsChanged:function Da(De,Dg){if(DX&&De===DX){var Df=this.broker.getFormatPropertyValue(DY);this.syncControl(function(){this.getChildComp(De).set("autoPreviewColor",Df?Dg:null);this.setChildValue(De,Df?W.VAL_AUTOMATIC:Dg);});}else{this.onFmtPropsChangedDefault(De,Dg);if(Dd&&De===Dd){this.setChildEnable(Bm,DC()&&Dg!==mstrmojo.gm.EnumCombinedLineStyle.NONE);}}}},Db);}return Db;}var DP=function(Da,Db){var DY=Da?mstrmojo.desc(13752,"Line Style"):null,DX={lineColor:DI(Cv.SHAPE_FILL_COLOR),lineStyle:DI(Cv.SHAPE_LINE_COMBINED_STYLE)},Dc=Da,DZ=AT.override(Db,Az.copy({controlName:"shapeLineGroup",hideColorControl:Da,showNoFillInColor:false,showAutomaticInColor:true,showNoneOption:false},DD(Da,DX.lineColor,Dc,DX.lineStyle)));if(Da){delete DX.lineColor;}return DW(CN.call(this,DY,DX,AT.override({reInit:function(){var De=Cz.GMController,Dd=Cb.difference(De.getShapeForOption(C2.value),Cy).length===0,Df=De.getSizeByMetrics().length>0;this.setChildEnable(DX.lineStyle,!(Dd&&Df));this._super();}},DZ)),Da);}.bind(this);var DS=function(Df,Dc,DZ){var Dg=mstrmojo.desc(2885,"Fill"),Da=C9.getSmartNamesMapForFillGroup(null,DV,Bx,"fld",null,Ar),DX=Df||Dc,De=Az.copy({controlName:"shapeFillGroup",showAutomaticInColor:true},DD(Df,Da.fillColor,DX));if(Df){Dg=mstrmojo.desc(13658,"Fill Opacity");delete Da.fillColor;De.visibleControls=CA.FILL_TRANSPARENCY;}else{if(Dc){Dg=mstrmojo.desc(13753,"Shape Color");delete Da.fillAlpha;De.visibleControls=CA.FILL_COLOR;}}var DY=DW(Cu.call(this,Dg,Da,AT.override(DZ,De)),DX),Db=Da.fillAlpha,Dd=Db&&DY.getCtrl().getChildComp(Db);if(Dd){Az.copy(X(C9,Db),Dd);}return DY;}.bind(this);var C0=function(Da,Db){var DY=null,DX=C9.getSmartNamesMapForLineGroup(null,DV,n,"fld",null,Ar),Dc=Da,DZ=Az.copy({lineTitle:mstrmojo.desc(9736,"Border"),controlName:"shapeBorderGroup",hideColorControl:Da,showNoFillInColor:false,showAutomaticInColor:true},DD(Da,DX.lineColor,Dc,DX.lineStyle));if(Da){delete DX.lineColor;DY=mstrmojo.desc(3538,"Border Style");DZ.lineTitle=null;}return DW(CN.call(this,DY,DX,AT.override(Db,DZ)),Dc);}.bind(this);var DO=DR(),C4,C8;if(DG){C4=-1;}else{if(DF.shapeType===undefined){C8=Cz.getChartInfo().shape;}else{C8=DF.shapeType;}C4=Cb.map(DO,function(DX){return DX.v;}).indexOf(C8);}var DU=this.getPulldown(DO,function(DX){Cz.setWidgetPropertyValue(Ac.METRIC_SHAPES,{});Cz.processChangeShape(DX);},C4,{onRender:function(){var DX=this.selectedNode;if(DX&&DG){DX.innerHTML=mstrmojo.desc(5576,"Combination");}}}),DA=this.getLabelAndControl(mstrmojo.desc(13754,"Shape Type"),DU,"40%","60%");if(C9.getVisProfile(Bb)){C6.push(DP(DJ));}else{if(C9.getVisProfile(CU)){C6.push(DS(DJ),C0(DJ));}else{if(DG){if(!DJ){C6.push(DS(false,true));}var DQ=function DQ(DX){return{reInit:function(){this._super();if(DX){var DY=Cz.GMController.getShapeForOption(C2.value);this.getCtrlContainer().set("enabled",Cb.intersection(DY,DX).length>0);}}};},DH=DP(true,DQ(Cy)),DK=DS(true,false,DQ(DM)),DE=C0(false,DQ(DM));C6.push(DH,DK,DE);}}}DN.shapeFormatControls=C6;var Cx=[DA,C1,C2];if(DJ){Cx.splice(DB.length===1?3:2,0,I.call(this,DL(DN)));}return Cx.concat(C6);}function AO(){var Cy=this.broker;function C1(C3,C2){return Cy.generateSmartName(null,C3,C2);}var C0=C1(Cv.LINE_MARKER_SHOW),Cx=function(C2){return Cy.getVisProfile(B3)&&!Cy.getVisProfile(u)&&(Cy.vis.skipPaintedCheck||Cy.vis.interactor.isLineOrAreaPaint());};return[CE.call(this,mstrmojo.desc(13755,"Show Marker"),C0,{reInit:function Cz(){this.getCtrlContainer().set("enabled",Cx(this));this.reInitDefault();}}),g.call(this,mstrmojo.desc(13756,"Marker Color"),C1(Cv.LINE_MARKER_COLOR,Cv.LINE_MARKER_COLOR),{listenFormatProps:[C0],colorDefaultSN:C1(Cv.LINE_MARKER_COLOR,Cv.LINE_MARKER_COLOR+Cv.IS_DEFAULT_VALUE),showAutomatic:true,onFmtPropsChanged:function(C2,C3){if(C2===C0){this.parent.set("enabled",C3&&Cx(this));}else{this.onFmtPropsChangedDefault(C2,C3);}}})];}function Ad(){var C2=this.broker,C1=[{n:mstrmojo.desc(2057,"None"),v:B5.EnumDataLabels.HIDE}],C4={val:{n:mstrmojo.desc(2175,"Values"),v:B5.EnumDataLabels.SHOW_VALUE_ONLY},txt:{n:mstrmojo.desc(1013,"Text"),v:B5.EnumDataLabels.SHOW_TEXT_ONLY}},Cx=false;if(C2.getVisProfile(z)){C1.unshift(C4.val);}if(C2.getVisProfile(BB)){C1.unshift(C4.txt);}if(C1.length===1){Cb.insert(C1,0,Az.valarray(C4));Cx=true;}var Cz=C2.generateSmartName(null,Ac.DATA_LABEL),C6=C2.generateSmartName(null,Ac.DATA_LABELS_PLACEMENT),C3=C2.getDataLabelItems(),Cy=C3&&C3.length>1,C5=[w.call(this,mstrmojo.desc(11993,"Data Labels"),{highlightObjects:[BO.DATA_LABEL]}),Ax.call(this,null,C1,Cz,Az.copy(Cx?{enabled:false}:undefined,{cssClass:"dataLabel "+("itemsCnt"+C1.length)}))];if(this.getHost().scriptClass!=="mstrmojo.ngm.VisNewGraphMatrix"){C5.push(CE.call(this,mstrmojo.desc(14606,"Hide overlapping labels"),C6,{listenFormatProps:[C6],reInitDefault:function(){(this.listenFormatProps).forEach(function(C8){this.onFmtPropsChanged(C8,this.broker.getFormatPropertyValue(C8)!==mstrmojo.gm.EnumDataLabelPlacements.GENERIC);},this);}}));}if(Cy&&this.getHost().scriptClass!=="mstrmojo.ngm.VisNewGraphMatrix"){C5.push(AX.call(this,C3,C2.generateSmartName(null,Ac.METRIC_LEVEL_DATA_LABEL),{controlName:"DataLabelList",listenFormatProps:[Cz],onFmtPropsChanged:function(C8,DA,C9){if(C8===Cz){this.set("enabled",DA!==B5.EnumDataLabels.HIDE);}else{this.onFmtPropsChangedDefault(C8,DA,C9);}}}));}C5.push(BH.call(this,null,C2.getSmartNamesMapForFontGroup(CK),{controlName:"DataLabelFontGroup",syncWithAllText:true,memory:{snDataLabelType:undefined},listenFormatProps:[Cz],onFmtPropsChanged:function(C8,C9){if(C8===Cz){this.memory.snDataLabelType=C9;this.set("enabled",this.memory.snDataLabelType!==B5.EnumDataLabels.HIDE);}else{this.onFmtPropsChangedDefault(C8,C9);}}}));if(this.getHost().scriptClass==="mstrmojo.ngm.VisNewGraphMatrix"){var C0=new mstrmojo.Label({text:mstrmojo.desc(15647,"Rotation")});var C7=k(C0,BY.call(this,null,[{n:mstrmojo.desc(12286,"Horizontal"),v:0},{n:mstrmojo.desc(12285,"Vertical"),v:270}],C2.generateSmartName(null,Ac.DATA_LABEL_TEXT_ANGLE),{listenFormatProps:[Cz],onFmtPropsChanged:function(C8,DA,C9){if(C8===Cz){this.parent.set("enabled",(DA!==B5.EnumDataLabels.HIDE));}else{this.onFmtPropsChangedDefault(C8,DA,C9);}}}),"40%","60%");C5.push(C7);}return C5;}function l(Cy){var Cx=[];if(this.getHost().scriptClass!=="mstrmojo.ngm.VisNewGraphMatrix"){Cx.push(this.getEditorGroup(BL.call(this),B0));if(this.broker.getVisProfile(B3)){Cx.push(this.getEditorGroup(AO.call(this),BD));}}Cx.push(this.getEditorGroup(Ad.call(this),BD));this.replaceChildControls(Cy,Cx);}mstrmojo.vi.models.editors.GMEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.editors.GMEditorModel",help:"format_panel_graph.htm",broker:null,init:function Cr(Cx){this._super(Cx);this.broker=this.addDisposable(new mstrmojo.vi.models.editors.GMBroker({vis:this.getHost()}));},getInitialTarget:function A6(){return Y;},getEditorContents:function BN(C6){var C1=this._targetPulldown,C3=C1?[C1.id]:[];CZ.handleDestroy(this,["mstrmojo.vi.models.editors.GMBroker"],C3);var C5=this.addDisposable(new mstrmojo.vi.models.editors.GMEditorManager({host:this.getHost(),model:this}));C5.initializing=true;var C0=this.broker;if(C0.editorManager){C0.detachEditorRuntime().destroy();}this.broker.attachEditorRuntime(C5);C5.initIdentityPanelMapping();var Cz=this._super(C6),Cx=this.id,C4=Cz[0],C2=function(){var C7=mstrmojo.all[Cx];if(!C4.hasRendered){CB.addWidgetCssClass(C4,[(C7._hilightGMTitle?"hilightGMTitle":""),(C7._hilightGMContainer?"hilightGMContainer":"")]);}else{CB.toggleClass(C4.domNode,"hilightGMTitle",C7._hilightGMTitle);CB.toggleClass(C4.domNode,"hilightGMContainer",C7._hilightGMContainer);}};C2();this.onHighlightObjChange=function Cy(C7){var C8=mstrmojo.all[Cx];C8._hilightGMTitle=A0([BO.VIZ_BOX_TITLE],C7);C8._hilightGMContainer=A0([BO.VIZ_BOX_CONTAINER],C7);C2();};C0.editorManager._hilightObjListens.push(this);C5.initializing=false;return Cz;},getTargetPulldownItems:function q(Cy){var C1=this._super(Cy),C0=C1.length>0,Cx=this.broker,C4=this.getHost(),C3=C4.GMController,Cz=C4.scriptClass==="mstrmojo.ngm.VisNewGraphMatrix",C2=function(C5){return function(C7){var C8=this._targetPulldown,C6=C8?[C8.id]:[];Cx.editorManager.clearControlsReference();CZ.handleDestroy(this,["mstrmojo.vi.models.editors.GMBroker","mstrmojo.vi.models.editors.GMEditorManager"],C6);C5.bind(this,Cy)(C7);}.bind(this);}.bind(this);if(Cx.getVisProfile(AZ)||C4.excludeData||C4.noData){return C1;}if(C3.isBoxPlot){this.help="Format_Panel_Box_Plot.htm";C1.push({n:mstrmojo.desc(11974,"Data Exploration"),v:Y,h:C2(CL)});C1.push({n:mstrmojo.desc(15307,"Box Plot Options"),v:BG,h:C2(AK)});C1.push({n:mstrmojo.desc(13931,"Axis Lines and Labels"),v:Bt,h:C2(CM)});if(Cx.getVisProfile(Ai)){C1.push({n:mstrmojo.desc(2403,"Legend"),v:O,h:C2(AS)});}return C1;}else{if(C3.isHistogram){this.help="Format_Panel_Histogram.htm";if(C3.view.gridInfo.mx.length){C1.push({n:mstrmojo.desc(11974,"Data Exploration"),v:Y,h:C2(CL)});C1.push({n:mstrmojo.desc(15322,"Histogram Options"),v:BU,h:C2(Cf)});C1.push({n:mstrmojo.desc(13931,"Axis Lines and Labels"),v:Bt,h:C2(CM)});return C1;}}else{if(C3.isWaterfall){this.help="Format_Panel_Waterfall.htm";C1.push({n:mstrmojo.desc(11974,"Data Exploration"),v:Y,h:C2(CL)});C1.push({n:mstrmojo.desc(15383,"Waterfall Options"),v:Cj,h:C2(AP)});C1.push({n:mstrmojo.desc(13931,"Axis Lines and Labels"),v:Bt,h:C2(CM)});return C1;}}}if(!Cz){C1.push({n:mstrmojo.desc(11974,"Data Exploration"),v:Y,h:C2(Ab)});if(Cx.getVisProfile(Bg)){C1.push({n:mstrmojo.desc(12018,"Trend Lines"),v:CQ,h:C2(BC)});C1.push({n:mstrmojo.desc(12030,"Reference Lines"),v:Bs,h:C2(K)});}C1.push({cls:"separator"});}else{C1.push({n:mstrmojo.desc(11974,"Data Exploration"),v:Y,h:C2(CL)});}if(C0){C1.push(C1.shift());}if(Cx.getVisProfile(Am)||Cx.getVisProfile(Ai)){C1.push({n:mstrmojo.desc(2403,"Legend"),v:O,h:C2(AS)});}C1.push({n:mstrmojo.desc(13931,"Axis Lines and Labels"),v:Bt,h:C2(CM)});if(!Cz){C1.push({n:mstrmojo.desc(11978,"Rows and Columns"),v:AW,h:C2(Cq)});}C1.push({n:mstrmojo.desc(13757,"Shapes and Data Labels"),v:CR,h:C2(l)});return C1;},getFormatToTargetFn:function d(){var Cx=this.id;return function(Cz){var C0=mstrmojo.all[Cx],Cy=C0&&C0.broker&&C0.broker.editorManager;if(Cz===mstrmojo.vi.models.editors.BaseEditorModel.TITLE_CONTAINER_VALUE&&Cy&&Cy.notifyNonShapeSelectionChangeToListeners){Cy.notifyNonShapeSelectionChangeToListeners({identities:[{objType:BO.VIZ_BOX_TITLE}]});}};},getPulldown:function CW(Cy,C1,Cx,C0,Cz){C0=Az.copy({_set_selectedIndex:function C2(C5,C3){if(C3===-1){this.selectedIndex=C3;this.getPopupList().clearSelect();var C4=this.selectedNode;if(C4){C4.innerHTML="";}return false;}return this.constructor.prototype._set_selectedIndex.call(this,C5,C3);}},C0);return this._super.apply(this,arguments);}});mstrmojo.vi.models.editors.GMEditorModel.PropertyKeyType=null;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.dom","mstrmojo.css","mstrmojo.Box","mstrmojo.Label","mstrmojo.VBox","mstrmojo.func","mstrmojo.array","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.util.ui._HostsSplitter","mstrmojo._CanWSItemDragandDrop");mstrmojo.requiresClsP("mstrmojo.ui","_HasScroller","ScrollableList","Pulldown");mstrmojo.requiresClsP("mstrmojo.ui.menus","_HasMenuPopup","MenuConfig","ToolbarConfig");mstrmojo.requiresClsP("mstrmojo.vi.ui","_IsDropTarget","_IsViPanel","_HasMask","PanelContents","PanelPortlet","DatasetPortlet","DatasetTableView","DatasetMDXView","DatasetUnitList","TableOfContentsChapterPortlet","TableOfContentsUnitList","CollapsibleTitleBar","CoverPageWidget");mstrmojo.requiresDescs(14917,14918,14919);var k=mstrmojo.array,C=mstrmojo.css,Q=mstrmojo.dom;var G="TOC_Chapter_",l=mstrmojo.vi.controllers.EnumLayoutManipulationType,b=mstrmojo.vi.controllers.EnumPanelManipulationType,D=mstrmojo.vi.controllers.EnumEvents,w=mstrmojo.vi.models.VIComponentMap.TYPES,K=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,v=mstrmojo.vi.models.EnumDragSources;var n=300,O=162;function AF(){var AL=this.data,AI=[],AO,AK=this.id,AG=this,AH=AL&&AL.length,AJ=0;this.chapterCount=AH;k.forEach(AL,function(AQ,AP){AO=this.getChapterPorlet(AQ,AG,AK,AP,AH);AI.push(AO);AJ+=(AQ.panels||[]).length;},this);this.pageCount=AJ;var AN=this.contents;var AM=[].concat(AN.children||[]);AN.removeChildren();AM.forEach(function(AP){AP.destroy();});AN.addChildren(AI);this.doLayout();this.previousDisplayPageInfo=null;this.ondisplayPageInfoChange();}function F(){var AG=this;window.setTimeout(function(){AG.updateScrollbars();},0);}function g(AH){var AM=this.displayPageInfo,AL=AM&&AM.panelKey,AJ=AM&&AM.layoutKey,AK=this.getChapterPanel(AJ),AI,AG;if(AK){AI=AK.ulist.items;AG=k.find(AI,"k",AL);if(AG!==-1){C.addClass(AK.ulist._getItemNode(AG),AH);}}}function AC(AG){var AH;k.forEach(this.contents.children,function(AI){AH=AI.ulist;k.forEach(AH.items,function(AK,AJ){C.removeClass(AH._getItemNode(AJ),AG);});});}function c(AG){var AH=AG&&AG.src&&AG.src.data;return AH&&AH.src;}mstrmojo.vi.ui.TableOfContents=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._IsViPanel,mstrmojo.util.ui._HostsSplitter,mstrmojo.ui._HasScroller,mstrmojo.vi.ui._HasMask,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo.vi._MonitorsAppState,mstrmojo._CanWSItemDragandDrop],{scriptClass:"mstrmojo.vi.ui.TableOfContents",markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-TableOfContents {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIPanel-titlebar content"></div><div class="mstrmojo-TOC-coverpage"></div><div class="mstrmojo-VIPanel-content-wrapper" style="overflow:hidden;" mstrAttach:contextmenu><div class="mstrmojo-VIPanel-content"><div class="chapter-dnd-indicator"><div class="line"></div></div></div></div><div class="mstrmojo-NavigationBox-WSDND-overlay"></div><div class="mstrmojo-VIDND-mask"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function AD(){return this.domNode.firstChild;},coverPageNode:function q(){return this.domNode.childNodes[1];},containerNode:function d(){return this.domNode.childNodes[2].firstChild;},wsItemdndNode:function A(){return this.domNode.childNodes[3];},maskNode:function S(){return this.domNode.childNodes[4];},handleNode:function V(){return this.domNode.lastChild;},chapterDnDIndicatorNode:function L(){return this.domNode.childNodes[2].firstChild.firstChild;}},markupMethods:{ondataChange:function t(){AF.call(this);this.updateChapterAndPageCount();},onvisibleChange:function Y(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";if(this.visible){this.ondisplayPagePositionChange(this.displayPageInfo);this.generateToolbar();this.raiseEvent({name:"showPanel"});}}},model:null,width:"auto",titleBar:null,titlebarNode:null,containerNode:null,maskNode:null,contents:null,coverPage:null,data:null,chapterCount:0,pageCount:0,title:mstrmojo.desc(14917,"CONTENTS"),displayPageInfo:null,previousDisplayPageInfo:null,layoutConfig:{h:{titlebarNode:"26px",coverPageNode:"49px",containerNode:"100%"},w:{titlebarNode:"100%",coverPageNode:"100%",containerNode:"100%"},xt:true},children:[{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",slot:"titlebarNode",alias:"titleBar",editTitleOnDoubleClick:false,close:function u(){},onclick:function(){},bindings:{title:"this.parent.title"}},{scriptClass:"mstrmojo.vi.ui.CoverPageWidget",alias:"coverPage",slot:"coverPageNode"},{scriptClass:"mstrmojo.vi.ui.PanelContents",alias:"contents",slot:"containerNode"}],lastDragOverInfo:null,allowManipulation:true,onContentPanelVisibilityChange:function P(AH){var AJ=this.model,AI=mstrApp.rootCtrl,AG=AJ.tsp;if(AG===K.LEFT){AI.setPanelDisplay("tocPanel",AH.visible);}},postBuildRendering:function X(){var AG=this.handleNode;AG.style.display="block";this.registerSplitter(AG);return this._super();},setDimensions:function r(AJ,AH){this._super(AJ,AH);var AI=this.handleNode,AG=AI&&AI.style;if(AG){AG.display=mstrApp.isAppStatePresentation()?"none":"block";AG.top=0;AG.left=AH;AG.height=AJ;AG.width="6px";}this.ondisplayPagePositionChange(this.displayPageInfo);},getSplitterInfo:function z(){return{min:O,max:n};},splitterMoved:function R(AG){var AJ="width",AI=parseInt(this[AJ],10)+AG+"px";this.set(AJ,AI);this.parent.doLayout();var AH=this.getPanelSaver();if(AH){AH.saveProperty("size",AI);}},init:function AB(AJ){this._super(AJ);var AH=this.model,AG=AH&&AH.objInfo,AI=AG&&AG.icp;this.coverPage.set("modelId",AH.id);if(AI){this.coverPage.set("imageUrl",AI);}this.allowManipulation=mstrApp.allowWebDashboardDesign();},refresh:function AE(){this._super();this.previousDisplayPageInfo=null;this.ondisplayPageInfoChange();this.generateToolbar();},onAppStateChange:function(AG){if(this._super){this._super(AG);}this.allowManipulation=mstrApp.isAppStateDefault()&&mstrApp.allowWebDashboardDesign();this.set("isMasked",mstrApp.isAppStateSelection());this.generateToolbar();},oncontextmenu:function m(AG){if(this.shouldShowCustomizeContextMenu()){var AH=this.addContextMenuItems(new mstrmojo.ui.menus.MenuConfig({position:Q.getMousePosition(AG.e,AG.hWin),isHostedWithin:false}),AG);if(AH.hasMenuItems()){Q.preventDefault(window,AG.e);this.openPopup(AH.newInstance());}}},shouldShowCustomizeContextMenu:function a(){return this.allowManipulation;},addContextMenuItems:function x(AJ){var AH=this.model,AI=AH.getCurrentLayoutKey(),AG=AH.getVIComponent(w.VIZ_CONTENT,AI),AK=AG.k;AJ.addMenuItem(mstrmojo.desc(14918,"Insert Chapter"),"",function(){AH.raiseEvent({name:D.MANIPULATE_LAYOUT,type:l.NEW});});AJ.addMenuItem(mstrmojo.desc(14919,"Insert Page"),"",function(){AH.raiseEvent({name:D.MANIPULATE_PANEL,type:b.NEW,layoutKey:AI,panelStackKey:AK});});return AJ;},setupScrollNodes:function s(){this.scrollNode=this.containerNode;},addPopupHandlers:function h(AG,AI,AH){AG.addPopupHandlers(this.id,AI,AH);},getPanelSelectedItems:function I(){var AH=this.contents;var AG=[];k.forEach(this.data,function(AI){var AJ=AH[G+AI.k];AG=AG.concat(AJ.getSelectedItems());});return AG;},getChapterPorlet:function f(AJ,AH,AK,AI,AN){var AM=this,AL=this.getChapterPanel(AJ.k);return new mstrmojo.vi.ui.TableOfContentsChapterPortlet({title:AJ.title,panelId:AK,alias:G+AJ.k,chapterKey:AJ.k,panelStackKey:AJ.panelStackKey,chapter:AJ,index:AI,chapterCnt:AN,isCollapsed:AL?!!AL.isCollapsed:false,children:[{scriptClass:"mstrmojo.vi.ui.TableOfContentsUnitList",alias:"ulist",chapter:AJ,panelId:AK}],onisCollapsedChange:function AG(){F.call(AM);}});},getChapterPanel:function(AG){return this.contents[G+AG];},ondisplayPageInfoChange:function AA(){var AM=this.displayPageInfo,AL=AM&&AM.panelKey,AH=AM&&AM.layoutKey,AK=this.previousDisplayPageInfo,AI=AK&&AK.layoutKey,AG=this.getChapterPanel(AI);if(AL===(AK&&AK.panelKey)){return ;}var AJ=this.domNode.getElementsByClassName("item unit current-display");k.forEach(AJ,function(AO){C.removeClass(AO,"current-display");var AN=AO.getAttribute("idx");if(AO.className.indexOf("selected")!==-1&&AN>=0&&AG){AG.removeSelect([AN]);}});this.ondisplayPagePositionChange(AM);if(this.getChapterPanel(AH)){this.previousDisplayPageInfo={panelKey:AL,layoutKey:AH};}},ondisplayPagePositionChange:function W(AM){if(!AM){return ;}var AL=AM.panelKey,AH=AM.layoutKey,AK=this.getChapterPanel(AH),AI=(AK&&AK.ulist.items)||[],AG=k.find(AI,"k",AL);if(AG!==-1){var AJ=AK.ulist._getItemNode(AG);C.addClass(AJ,"current-display");if(AJ.scrollIntoViewIfNeeded){AJ.scrollIntoViewIfNeeded();}else{this.scrollIntoViewIfNeeded(AJ);}}},setTOCIcon:function H(AG,AH){if(AG){g.call(this,AH?"src":"tgt");}else{AC.call(this,AH?["src","tgt"]:"tgt");}},clearPageSelect:function p(){var AG=this;k.forEach(this.data,function(AH){var AI=AG.getChapterPanel(AH.k);AI.clearSelect();});},clearChapterSelect:function e(){var AG=this;k.forEach(this.data,function(AH){var AI=AG.getChapterPanel(AH.k);AI.clearTitleSelect();});},allowDrop:function E(AH){var AG=[v.VIZ_EDITOR,v.TOC_CHAPTER,v.TOC_PAGES_LIST];return AG.indexOf(c(AH))>-1;},ondrop:function j(AH){var AJ=AH&&AH.getCtxtDragData&&AH.getCtxtDragData(),AG=AJ&&AJ.src;if((AG===v.TOC_CHAPTER||AG===v.TOC_PAGES_LIST)&&this.lastDragOverInfo){var AI=this.getChapterPanel(this.lastDragOverInfo.chapterKey);AI.ondrop(AH);}else{if(c(AH)===v.VIZ_EDITOR){AJ.onRemove(AJ.items&&AJ.items.length>1?AJ.items:AJ.item);}}},ondragleave:function U(AH){var AI=AH&&AH.getCtxtDragData&&AH.getCtxtDragData(),AG=AI&&AI.src;if(AG===v.TOC_CHAPTER){this.chapterDnDIndicatorNode.style.display="none";}this._super(AH);},getDropAvatarIcon:function B(AG){return c(AG)===v.VIZ_EDITOR?"remove":"move";},updateLastModifiedTime:function J(AG){this.coverPage.set("lastModifiedTime",AG);},updateChapterAndPageCount:function Z(){this.coverPage.set("chapterAndPageCnt",{chapter:this.chapterCount,page:this.pageCount});},passToolbarCfg:function N(AG){var AH=this.titleBar.toolbarCfg;if(AH){AH.destroy();}this.titleBar.set("toolbarCfg",AG);},updateToolbar:function o(AG){AG.hostId=this.id;AG.isHostedWithin=false;this.toolbar=this.titlebar;var AH=this.parent.controller;AH.getSelectorTabMenu(this.model,AG);return AG;},expandOrCollapseAll:function M(AG){this.contents&&this.contents.children.forEach(function(AH){var AI=AH.titleBar;if(AI.canCollapse){AI.set("isCollapsed",!AG);}});}});mstrmojo.vi.ui.TableOfContents.MAX_WIDTH=n;mstrmojo.vi.ui.TableOfContents.MIN_WIDTH=O;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.SearchWidget","mstrmojo.SearchWidget2","mstrmojo.Label","mstrmojo.Box","mstrmojo.func","mstrmojo.css","mstrmojo.hash","mstrmojo.array","mstrmojo.vi._MonitorsAppState","mstrmojo._CanWSItemDragandDrop");mstrmojo.requiresClsP("mstrmojo.ui","_HasScroller","ScrollableList","Pulldown");mstrmojo.requiresClsP("mstrmojo.ui.menus","_HasMenuPopup","MenuConfig");mstrmojo.requiresClsP("mstrmojo.vi.ui","_IsDropTarget","_IsViPanel","_HasMask","PanelContents","PanelPortlet","DatasetPortlet","DatasetTableView","DatasetMDXView","DatasetUnitList","CollapsibleTitleBar");mstrmojo.requiresDescs(221,1158,1388,2461,3303,3581,5903,8708,11241,11307,11308,11241);var M=mstrmojo.hash,Y=mstrmojo.array,D=mstrmojo.css,f=mstrmojo.vi.models.EnumDragSources;var h="dsGroup_",P=mstrmojo.desc(2461,"All"),O=776,c=779,g=256;function Q(){var t=this,s=this.search,p=this.getDatasetCount(),r=this.data,q=this.gridSource,o=[{n:P,dsId:"",fScope:"",cls:"all"}],n=0;if(t.filterNodeConfig.att){o.push({n:mstrmojo.desc(3581,"Attributes"),dsId:"",fScope:"att",cls:"att"});}if(t.filterNodeConfig.mx){o.push({n:mstrmojo.desc(1158,"Metrics"),dsId:"",fScope:"mx",cls:"mx"});}if(p>1){o.push({isSeparator:true,cls:"separator"});M.forEach(r,function(u,v){o.push({n:u.name,dsId:v,fScope:"ds",cls:" ds "+(q===v?"grid-source":"")});});}o.some(function(v,u){if(!v.isSeparator&&t._filterSelection===(v.dsId||v.fScope)){n=u;return true;}return false;});s.set("filterItems",o);s.set("filterSelectedIndex",n);}function H(){var r=this.data,q=[],p=this.id,o=this;M.forEach(r,function(t,u){q.push(this.getDatasetPortlet(t,u,o,p));},this);var n=this.contents;var s=[].concat(n.children||[]);n.removeChildren();s.forEach(function(t){t.destroy();});n.addChildren(q);this.doLayout();}function G(){var n=this;window.setTimeout(function(){n.updateScrollbars();},0);}mstrmojo.vi.ui.DatasetObjects=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._IsViPanel,mstrmojo.ui._HasScroller,mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsAppState,mstrmojo._CanWSItemDragandDrop],{scriptClass:"mstrmojo.vi.ui.DatasetObjects",importDataBox:null,markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-VIDatasetObjects {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIPanel-titlebar top"></div><div class="mstrmojo-VIPanel-search"><div><div><div class = "search-box"></div></div></div></div><div class="mstrmojo-VIPanel-content-wrapper" style="overflow:hidden;"><div class="mstrmojo-VIPanel-content"></div></div><div class="mstrmojo-NavigationBox-WSDND-overlay"></div><div class="mstrmojo-VIDND-mask"></div><div class="mstrmojo-object-browser-content"></div><div class="mstrmojo-VIPanel-handle splitter v"></div></div>',markupSlots:{titlebarNode:function m(){return this.domNode.firstChild;},searchNode:function k(){return this.domNode.childNodes[1];},searchBox:function S(){return this.domNode.childNodes[1].firstChild.firstChild.firstChild;},containerNode:function U(){return this.domNode.childNodes[2].firstChild;},wsItemdndNode:function B(){return this.domNode.childNodes[3];},maskNode:function L(){return this.domNode.childNodes[4];},browserNode:function b(){return this.domNode.childNodes[5];},handleNode:function N(){return this.domNode.lastChild;}},layoutConfig:{h:{titlebarNode:"19px",searchNode:"39px",containerNode:"100%",browserNode:"0"},w:{titlebarNode:"100%",searchNode:"100%",containerNode:"100%",browserNode:"0"},xt:true},filterNodeConfig:{att:true,mx:true},getLinksForEmptyData:function A(){return[];},markupMethods:{onvisibleChange:function R(){this.domNode.style.display=(this.visible)?this.cssDisplay:"none";if(this.visible){this.raiseEvent({name:"showPanel"});}},ondataChange:function e(){var p=this.data,q=this.importDataBox;if(!p||!Object.keys(p).length){if(!q){var o=this.getLinksForEmptyData();if(o.length){this.addChildren([{scriptClass:"mstrmojo.Box",markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="alignBox"></div></div>',markupSlots:{containerNode:function(){return this.domNode.childNodes[0];}},alias:"importDataBox",cssClass:"importDataBox",ignoreLayout:true,children:o,postBuildRendering:function n(){var r=this.constructor.prototype.postBuildRendering.call(this);this.domNode.style.marginTop=((this.parent.domNode.offsetHeight-320)*0.33)+"px";return r;}}]);}}}else{if(q){this.removeChildren(q);q.destroy();}}H.call(this);Q.call(this);}},onAppStateChange:function a(n){this._super(n);if(mstrConfig.resolveOnly){var q=this.data,o=this.model,u=2,s,p,t=Y.filter(M.keyarray(q),function(v){s=q[v];p=s.st;return s.dsm!==u&&(s.state&g)&&(p===O||p===c);}),r={success:function(v){o.setUserDICubeInfo(v);if(o.hasUnpublishedCube()){o.updateCubePublishStatus(o.unpublishedCubes);mstrApp.rootCtrl.generateToolbar();}}};if(t.length>0&&(!mstrApp.isSingleTier||mstrApp.getWSLiveMode())){this.model.getDataService().getUserDICubeInfo(t,r);}}this.set("isMasked",mstrApp.isAppStateSelection());},doubleClickItemHandler:mstrmojo.emptyFn,twoClicksItemHandler:mstrmojo.emptyFn,datasetUnitListScriptClass:"mstrmojo.vi.ui.DatasetUnitList",onuseTableViewChange:function(){if(this.hasRendered){H.call(this);}},getDatasetTableView:function J(o,p){var n=this;return{alias:"tableView",scriptClass:"mstrmojo.vi.ui.DatasetTableView",panelId:this.id,docModel:this.model,unitListScriptClass:this.datasetUnitListScriptClass,dataset:{id:p,set:o},bindings:{filterScope:"this.parent.parent.filterScope",filterExpr:"this.parent.parent.filterExpr",level:"this.parent.level"},onTableCollapsedChange:function(){G.call(n);}};},getDatasetMDXView:function(o){var n=this;return{alias:"mdxView",scriptClass:"mstrmojo.vi.ui.DatasetMDXView",docModel:this.model,datasetsPanelId:this.id,unitListScriptClass:this.datasetUnitListScriptClass,data:o,bindings:{filterScope:"this.parent.parent.filterScope",filterExpr:"this.parent.parent.filterExpr",filterFunc:"this.parent.parent.parent.filterFunc",level:"this.parent.level"},onNodeCollapsedChange:function(){G.call(n);}};},getDatasetPortlet:function j(r,n,o,q){var w=this,t=function(){return[].concat(r.att).concat(r.mx);},s=function(z){return M.copy(z,{scriptClass:w.datasetUnitListScriptClass,panelId:q,docModel:o.model,bindings:{filterScope:"this.parent.parent.filterScope",filterExpr:"this.parent.parent.filterExpr",filterFunc:"this.parent.parent.parent.filterFunc",level:"this.parent.level + 1"},dataset:{id:n,set:r},postCreate:function AA(){this.doubleClickItem=mstrmojo.func.composite([this.doubleClickItem,w.doubleClickItemHandler]);this.twoClicksItem=mstrmojo.func.composite([this.twoClicksItem,w.twoClicksItemHandler]);}});};var v={scriptClass:"mstrmojo.vi.ui.DatasetPortlet",dataset:r,title:r.name,alias:h+n,did:n,level:0,panelId:q,useTableView:w.useTableView&&r.tables&&r.tables.length>1,layoutConfig:{h:{titlebarNode:(!!mstrApp.isWSStyling)?"46px":"35px",containerNode:"100%"},w:{titlebarNode:"100%",containerNode:"100%"},xt:true},getLayoutOffsets:function(){return{h:0,w:(!!mstrApp.isWSStyling)?0:4};},onisCollapsedChange:function u(){G.call(w);},getTitleBarCfg:function x(){return w.getDatasetTitleBarCfg(this);}};if(this.model.isMDXDataset(r)){M.copy({children:[this.getDatasetMDXView(r,n)],getSelectedItems:function(){return this.mdxView.getSelectedItems();},clearSelect:function(){this.mdxView.clearSelect();}},v);}else{if(v.useTableView){M.copy({children:[this.getDatasetTableView(r,n)],getSelectedItems:function(){return this.tableView.getSelectedItems();},clearSelect:function(){this.tableView.clearSelect();}},v);}else{M.copy({children:[s({alias:"ulist",getAllItems:function p(){return t();}}),{scriptClass:"mstrmojo.Label",cssClass:"emptyIndicator",bindings:{visible:"!this.parent.ulist.items.length",text:function(){if(!this.visible){return"";}return this.parent.ulist.filterExpr?mstrmojo.desc(11904,"No matched object"):mstrmojo.desc(11905,"No object");}}}],getSelectedItems:function(){var z=this.ulist;return z.getSelectedItems();},clearSelect:function(){this.ulist.clearSelect();}},v);}}return v;},getDatasetTitleBarCfg:function(n){return n.constructor.prototype.getTitleBarCfg.call(n);},title:mstrmojo.desc(11241,"Datasets"),titleBar:null,titlebarNode:null,containerNode:null,maskNode:null,contents:null,data:null,model:null,dropZone:true,isSearching:false,init:function(n){if(!!mstrApp.isWSStyling){this.layoutConfig={h:{titlebarNode:"26px",searchNode:"32px",containerNode:"100%",browserNode:"0"},w:{titlebarNode:"100%",searchNode:"100%",containerNode:"100%",browserNode:"0"},xt:true};}this.children=[{scriptClass:"mstrmojo.vi.ui.CollapsibleTitleBar",slot:"titlebarNode",alias:"titleBar",editTitleOnDoubleClick:false,close:function p(){this.parent.setOpenStatus(false);},onclick:function(){this.parent.clickOnCollapsibleTitleBar();},bindings:{title:"this.parent.title"}},{scriptClass:"mstrmojo.vi.ui.PanelContents",alias:"contents",slot:"containerNode"},{scriptClass:"mstrmojo.SearchWidget2",slot:"searchBox",alias:"search",quickSearch:true,hasFilter:true,filterSelectedIndex:0,filterItems:[{n:"All",dsId:"",fScope:"",cls:"all"},{n:mstrmojo.desc(3581,"Attributes"),dsId:"",fScope:"att",cls:"att"}],onsearch:function r(s){this.parent.contents.set("filterExpr",s);this.parent.toggleAllNodesCollapsed(false,false);this.parent.isSearching=true;},onclear:function o(){this.parent.contents.set("filterExpr","");this.parent.recoverAllNodesCollapsed();this.parent.isSearching=false;},onfilterItemSelected:function q(u,w){var v=u.dsId,x=u.fScope,z=w,s=this.parent,t=s.contents;if(z){z.className="mstrmojo-ui-Pulldown-text "+x;}M.forEach(s.data,function(AC,AA){var AB=t[h+AA];if(AB){AB.set("visible",!v||AA===v);if(AA===v){AB.togglePortlet(false);}}});t.set("filterScope",x);s._filterSelection=v||x;s.onDatasetFilterChange(v);}}];this._super(n);},allowDrop:function F(o){var p=o.src.data,n=!!(p&&p.src===f.VIZ_EDITOR)||!!(p&&p.src===f.FILTERS)||!!(p&&p.src===f.VIZ)||!!(p&&p.src===f.VIZ_LAYER);if(p!==undefined&&p.allowDropOnTarget!==undefined){n&=p.allowDropOnTarget(f.DATASETS);}return n;},ondrop:function X(o){var p=o.src.data,n=p.items;if(p){p.onRemove(n&&n.length>1?n:p.item);}},getDropAvatarIcon:function E(o){var p=o.src.data,n="unselectable";if(p.src===f.VIZ_EDITOR||p.src===f.FILTERS||p.src===f.VIZ||p.src===f.VIZ_LAYER){n="remove";}return n;},ongridSourceChange:function(){Q.call(this);},clickOnCollapsibleTitleBar:mstrmojo.emptyFn,getPanelSelectedItems:function I(){var n=this.contents;return M.keyarray(this.data).reduce(function(o,q){var p=n[h+q];return o.concat(p.getSelectedItems(q));},[]);},doLayout:function K(){if(!this.visible){return ;}this._super();},onCubePublishChange:function l(q,o){if(q){if(this.data[q]){this.data[q].unpublished=o;}var p=this.contents,n=p&&p.children;Y.forEach(n,function(r){if(r.did===q){r.dataset.unpublished=o;r.unpublished=o;D.toggleClass(r&&r.domNode,"unpublished",o);r.generateToolbar();return false;}});}},updateDatasets:function V(n){var o=this.contents,p=this.data;M.forEach(n,function(t,q){var s=o[h+q].ulist,r=n[q];if(s&&r){s.set("dataset",{id:q,set:t});p[q]=t;}});},getDatasetPanel:function(n){return this.contents[h+n];},addPopupHandlers:function W(n,p,o){n.addPopupHandlers(this.id,p,o);},setupScrollNodes:function d(){this.scrollNode=this.containerNode;},getDatasetCount:function C(){return M.keyarray(this.data).length;},onDatasetFilterChange:function(){this.updateScrollbars();},toggleAllNodesCollapsed:function(o,p){var n=mstrmojo.all[this.id],q=n.settings,r=(n.contents.children||[]).length===1;(n.contents.children||[]).forEach(function(u){var t=q&&q.dataset(u.did),s=u.tableView||u.mdxView;if(p){t.isCollapsed=r?false:o;}u.togglePortlet(r?false:o);if(s){s.toggleAllNodesCollapsed(o,p);}});this.updateScrollbars();if(p){n.saveSettings();}},recoverAllNodesCollapsed:function(){var n=mstrmojo.all[this.id],o=n.settings;(n.contents.children||[]).forEach(function(r){var q=o&&o.dataset(r.did),p=r.tableView||r.mdxView;r.togglePortlet(q?q.getCollapsed():r.defaultCollapsed?r.defaultCollapsed:false);if(p){p.toggleAllNodesCollapsed(null,null,true);}});this.updateScrollbars();},destroy:function Z(o){var n=this.model;Y.forEach(this.subs,function(p){if(p){n.detachEventListener(p);}});this._super(o);}});}());(function(){mstrmojo.requiresCls("mstrmojo.MetricQualDocSelector");mstrmojo.MetricSliderDocSelector=mstrmojo.declare(mstrmojo.MetricQualDocSelector,null,{scriptClass:"mstrmojo.MetricSliderDocSelector",_ieformatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P"],filterNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},formatHandlers:{domNode:["F","text-align","vertical-align","line-height","z-index","top","left"],contentNode:["height","width","B","P","fx","background-color"],item:["color","font","text-decoration","text-align","line-height"]},newAndInitWidget:function B(E){var F=this._super(E);E.attachEventListener("includeChange",F.id,function(G){this.set("include",G.value);});return F;},getWidgetConfig:function D(I,G,F,H){var E=this._super(I,G,F,H);I.extCls="extSlider";E.isHoriz=true;E.include=F.include;return E;},isSelectAll:function C(){var E=this.children&&this.children[0];return E===undefined?true:E.unSet;},isFilterNothing:function A(){return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasBuilder","mstrmojo._HasLayout","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.ui._HasBoxLayout","mstrmojo.vi.ui._IsBoxLayoutChild","mstrmojo.ui._HasUITheme","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.ui.PageByPanel","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.ui.rw._SavesChildPositions","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.ui.tabs.LayoutTabStrip");var W=mstrmojo.vi.models.VIComponentMap.TYPES,D=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,C=mstrmojo.vi.controllers.EnumEvents,G="45px",M="pageByPanel",B="selector",U="pageByNode";function K(Y){var a=this.model,Z=mstrApp.rootCtrl,X=a.tsp;if(X!==D.LEFT&&this.k===this.model.getCurrentLayoutKey()){this.toggleSelectorVisibility(!Y.visible);}Z.generateToolbar();}function N(){var X=this.pageByPanel,Y;if(X){Y=X.pageByStack;X.set("visible",Y&&Y.visible);}}function V(){var X=this.selector,Z=this.model,g=mstrApp.rootCtrl,c=g.view,f=Z.tsp,b=X.hasRendered,a=c.isCPVisible,e=this.parent,Y=!e||e.showTOC!==false,d;if(!Y&&f===D.LEFT){f=D.BOTTOM;}Y=f===D.LEFT;d=Y?"":(f!==D.TOP?"bottom":"top");if(b||d){this.removeChildren(X);}X.slot=d+"CtrlNode";X.set("alignPosition",f);if(b||d){this.addChildren([X]);}if(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_TOC_UPDATEPOISITION)){Z.controller.rootCtrl.setPanelDisplay("tocPanel",Y&&a);}if(this.k===this.model.getCurrentLayoutKey()){this.toggleSelectorVisibility(Y||!a);}}mstrmojo.vi.ui.rw.DocLayout=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasBuilder,mstrmojo._HasLayout,mstrmojo.vi.ui._HasBoxLayout,mstrmojo.vi.ui._IsBoxLayoutChild,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocLayout",markupString:'<div id="{@id}" class="mstrmojo-VIDocLayout"><div class="mstrmojo-VIDocument-top-selector"></div><div class="mstrmojo-VIDocLayout-pageby"></div><div class="mstrmojo-VIDocLayout-content {@cssClass}" style="{@cssText}"></div><div class="mstrmojo-VIDocument-selector"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{topCtrlNode:function(){return this.domNode.firstChild;},pageByNode:function(){return this.domNode.childNodes[1];},containerNode:function(){return this.domNode.childNodes[2];},bottomCtrlNode:function(){return this.domNode.childNodes[3];},maskNode:function(){return this.domNode.lastChild;}},layoutConfig:{h:{topCtrlNode:"auto",pageByNode:"auto",containerNode:"100%",bottomCtrlNode:"auto",maskNode:"auto"},w:{topCtrlNode:"100%",pageByNode:"100%",containerNode:"100%",bottomCtrlNode:"100%",maskNode:"100%"},xt:true},init:function R(Y){this._super(Y);var Z=this.id;this.builder.getLayoutVIMap(this.k).attachEventListener("viCompBuilt",Z,function(a){if(a.type===W.PAGEBY_STACK){this.pageByPanel.setPageByStack(a.widget);}});var X=mstrmojo.ui._HasUITheme.EnumThemeNames.DARK_THEME;if(!!mstrApp.isWSStyling&&(mstrApp.getThemeClassName()===X||mstrApp.rootCtrl.isDarkThemeSelected())){mstrmojo.css.addWidgetCssClass(this,X);}else{mstrmojo.css.removeWidgetCssClass(this,X);}this.model.attachEventListener("tspChange",this.id,V);if(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_TOC_UPDATEPOISITION)){mstrApp.rootCtrl.view.attachEventListener(C.CONTENTS_PANEL_VISIBILITY_CHANGE,this.id,K);}},onRender:function F(){this._super();N.call(this);V.call(this);if(!this.selector.children){this.selector.setTabs(this.parent.parent._layouts,this.model.getCurrentLayoutKey());}},onAppStateChange:function O(Y){var X=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;if(mstrApp.isAppStatePresentation()||Y.valueWas&X){V.call(this);}},postCalculateBoxLayout:function H(Y,X){var a=parseInt(this.docSection.width,10)||0,Z=mstrmojo.vi.ui.rw.DocRelativePanel.getLayoutBreakPoint();if(mstrApp.isWSStyling&&!mstrApp.isAppStatePresentation()){if(a===Z&&mstrApp.isLayoutModePreview()){X.left=Math.max(X.width-Z,0)/2;}}return Y;},applyBoxSize:function L(X,Z,b,a){this._super(X,Z,b,a);if(!this.boxLayoutConfig){var c=this.boxLayoutConfig=new mstrmojo.vi.ui.BoxLayoutConfig({hostId:this.id,identifier:"id"});var Y=c.box=c.getNewRootBox(true);c.addNewChild(Y,100,this.id);}this.buildBoxLayout();},alias:"docLayout",selector:null,pageByPanel:null,docSection:null,dropZone:true,resizeOrReposition:mstrmojo.emptyFn,getIdentifier:function I(){return"layout";},getSplitterHost:function E(){return this.containerNode;},children:[{scriptClass:"mstrmojo.vi.ui.PageByPanel",alias:M,slot:U,height:G,zIndex:2},{scriptClass:"mstrmojo.vi.ui.tabs.LayoutTabStrip",alias:B}],_set_children:function Q(b,Z,Y){if(Z!==this.children){var X=this[M];if(X){Z.push(X);}var a=this[B];if(a){Z.push(a);}}return this._super(b,Z,Y);},getTargetDropZone:function J(X){var Y=X.boxCache[this.id];return X.tgt.pos.x-Y.x<Y.w/2?"Left":"Right";},getViPanel:function P(X){return(X==="pageByPanel")?this[M]:((X==="selector")?this[B]:null);},toggleSelectorVisibility:function S(b){var Z=this.selector.domNode;if(Z){var Y=mstrApp.rootCtrl.tocPanel,a=Y&&Y.chapterCount===1,X=Y&&Y.pageCount>1;Z.style.setProperty("display",b||mstrApp.isVisBuilder||(mstrApp.isAppStatePresentation()&&a&&X)?"none":"block");this.doLayout();}},viPanelChangedVisibility:function A(X){var Y=this.boxLayoutConfig;if(X.visible){Y.addDropBox(this.docSection,"Top",{box:{boxId:String(X.id),cfg:X.getBoxConfiguration()}});}else{Y.deleteBox(X);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.TextBoxDocSelector","mstrmojo.array","mstrmojo.string","mstrmojo.elementHelper","mstrmojo.mstr.EnumDSSXMLObjectTypes");var H=mstrmojo.array,G=mstrmojo.string,J=mstrmojo.elementHelper,N=mstrmojo.DocSelector.DATAPARAMS,U=mstrmojo.mstr.EnumDSSXMLObjectTypes,M=J.ELEM_ALL_ID;var K=0,B=1,C=2;var Q=1,R=3;var O=J.ELEM_ALL;mstrmojo.SearchBoxDocSelector=mstrmojo.declare(mstrmojo.TextBoxDocSelector,null,{scriptClass:"mstrmojo.SearchBoxDocSelector",filterElemALL:false,_buildEvent:function F(W,a){var d=[],X,Z=[],c=this.defn;H.forEach(a.items,function(g){g.n=mstrmojo.string.multiReplace(g.n,{";":"\\;"});d.push(g.v+";"+G.decodeHtmlString(g.n));Z.push(g);});X=d.length;if(!X){d.push(M);}if(d.length>0||!c.nsb||c.nsb===K){W.eid=d.join(mstrmojo.elementHelper.ELEM_SEPARATOR);}else{if(c.nsb===B||!c.showall){W.unset=true;}else{if(c.nsb===C){W.eid=M;Z=[O];}}}if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){var f=this.model,Y=this.node,e=f.getCurrentLayoutDef(),b=e&&e.units,V=this.k;if(b[V]){b[V].cesChange=true;}Y.data.elms=Y.data.ces=Z;Y.data[N.CESREADY]=true;f.setDataReady(this.k,this.id,N.CESREADY,true,"ces",Z);f.setDataReady(this.k,this.id,"elms",Z);}if(c.sec){if(c.multi){this.parent.set("count",J.buildElemsCountStrByNum(X,0));}else{this.parent.set("count",J.buildElemsCountStrByNum(0,0));}}},updateWidget:function L(d){var W=this._super(d),X=d.node,c=X.defn,a=X.data,V=a.elms;if(V&&!c.sos){W.candidates=this.setupCandidates(c,V);}if(c.srcid){var Y=[],b,Z=H.filter(a.ces,function(f){return f.v!=="u;";});if(Z&&Z.constructor===Array){if(c.dfm===Q){for(b=0;b<Z.length;b++){if(Z[b].t!==R){Y.push(Z[b]);}}}else{Y=Z.concat();}}if(!c.sos){var e=[];H.forEach(Y,function(f){if(H.find(W.candidates.items,"v",f.v)>-1){e.push(f);}});Y=e;}W.items=Y;}return W;},getCekEvtListener:function S(W,V){return function(X){W.handleActionInSyncPhase(function(){V.set("items",X.value);});};},getWidgetConfig:function D(f,Z,c,V){var e=f.getFormats(),Y=f.node.data,b=this._super(f,Z,c,V),W=100,a=mstrApp.isVI,X=a&&(f.isRecursiveAttributeSelector()||f.node.defn.iase===false),d=this,g=X?{posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular pulldown",contentNodeCssClass:"srch htEnter",content:mstrmojo.desc(15764,"Hit Enter to search")}:{posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular pulldown",contentNodeCssClass:"srch",onclick:function(){var j=d.content,l=j.getSearchPattern(),k=d.id;d.model.changeFilterStyle(d,d.style,d.multi,false);this.set("allowOtherTooltips",false);j.hideTooltip();if(mstrApp.isWaiting()){var h=mstrApp.getWaitBox();var m=h.attachEventListener("visibleChange",h.id,function(n){if(n.value===false){mstrmojo.all[k].content.showInfoTooltip(l);m.clear();}});}},content:'<div class="auto">'+mstrmojo.desc(15910,"Searching...")+'</div><div class="separator"><div class="wait">'+mstrmojo.desc(15911,"Tired of waiting?")+'</div><div class="actn">'+mstrmojo.desc(15912,"Disable Instant Search")+"</div></div>"};b={scriptClass:b.scriptClass,cssText:e.height?"height: "+e.height:"",emptyText:mstrmojo.desc(4325,"Search")+" "+(c.ttl||""),richTooltip:a?g:null,items:c.srcid?(Y.ces?Y.ces.concat():[]):[],REQUEST_THRESHOLD:(mstrApp&&mstrApp.SEARCH_REQUEST_THRESHOLD)||55,suggestCount:(mstrApp&&mstrApp.SEARCH_SUGGESTION_LENGTH)||W,hitEnterToTest:X,stifleIntermediateSearch:true,srcid:c.srcid||"",srct:c.srct||U.Attribute,dsrc:c.dsrc||"",useClientForm:c.srct===U.Consolidation,onitemsChange:function(){if(!f._inSyncPhase){f.showInfoWin();f.selectorControlChange(this);}}};if(V&&!c.sos){b.candidates=this.setupCandidates(c,V);}else{b.useKeyDelay=true;b.noCache=true;}if(!c.multi){b.maxObjectCount=1;}return b;},isSelectAll:function E(){var V=this.children&&this.children[0];return V===undefined?true:(!V.items||V.items.length===0);},isFilterNothing:function I(){return this.isSelectAll();},setupCandidates:function A(W,X){var V=W.srcid?X:[];if(this.filterElemALL){V=H.filter(V,function(Y){return Y.v!=="u;";});}return{isComplete:true,items:V};},isValidSelection:function P(){var W=this.node.data,V=this.model;if(V.isSelWarnFlagOn(this.k)&&W.ces&&W.ces.length===0){return W.elms.length!==0;}return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Widget","mstrmojo.Label","mstrmojo.Box","mstrmojo.desc","mstrmojo.css","mstrmojo.hash","mstrmojo.dom","mstrmojo.array","mstrmojo.expr","mstrmojo.models.FormatModel","mstrmojo.ui._HasScroller","mstrmojo._HasPopup","mstrmojo.vi.ui.ConditionEditor","mstrmojo.threshold.ThresholdRow","mstrmojo.threshold.ConditionWalk","mstrmojo.threshold.PropertyPanel","mstrmojo.threshold.PropertyModel","mstrmojo.threshold.ThresholdRowPanel","mstrmojo.mstr.EnumNodeProperties","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes");var B=mstrmojo.css,P=mstrmojo.hash,O=mstrmojo.dom,E=mstrmojo.mstr.EnumNodeProperties,Z=mstrmojo.mstr.EnumDSSXMLObjectTypes,s=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,N=mstrmojo.expr,a=N.ET,h=N.BRANCH_FNS,d=mstrmojo.Button.newWebButton,n=mstrmojo.models.FormatModel.getFormatUpdate,j=600,L="";var Y=mstrmojo.models.FormatModel.ENUM_NUMBER_FORMAT_KEYS_OBJ,p=[Y.CATEGORY,Y.CURRENCY_POSITION,Y.CURRENCY_SYMBOL,Y.DECIMAL_PLACES,Y.FORMAT,Y.NEGATIVE_NUMBERS,Y.THOUSAND_SEPARATOR],W=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,w=[W.BORDER_TOP_STYLE,W.BORDER_RIGHT_STYLE,W.BORDER_BOTTOM_STYLE,W.BORDER_LEFT_STYLE],o={0:"none",1:"1pt solid",3:"1pt dashed",4:"1pt dotted",5:"1.5pt solid"};function l(x,AA){var z=[];if(AA){AA.forEach(function(AC){var AD=AC.fmt,AB={FormattingAppearance:{Visible:-1}};if(!!AD){AD.nth=AD.nth?-1:0;if(!!AD.bc&&!!AD.bc.c1){delete AD.gdc;delete AD.gda;}}P.forEach(AD,function(AE,AF){var AG=false;if(p.indexOf(AF)>-1){n(AF,AE,AB);}else{if(w.indexOf(AF)===-1){n(AF,AE,AB);}else{if(!AD.borderStyle&&!AG){n(W.BORDER_STYLE,o[AE],AB);}}}});x.setAttIdToNDE(AC.expr);z.push({n:AC.n,scope:AC.scope,rtp:AC.rtp,rtxt:AC.rtxt,expr:mstrmojo.fe.FilterUtils.getExprXml(AC.expr),fmt:AB});});}return z;}function r(AC){var z=this.controller,AA=this.model,AB=AA.thresholds,AD=this.metricId,AF=AB&&AB[AD],AE=AA.orgThresholds,x=AE&&AE[AD];z.onSubmitActions(l(AA,AF),x,AD,undefined,-1,AC,this.objectType);}function G(x){(x||[]).forEach(function(z){delete z.dmy;var AA=z.nds;if(AA){G(AA);}});}function c(){var AB=this.content,x=this.model,AF=x.thresholds,AA=this,AC=[],AE=AB.rowPanel,AD=AF&&AF[x.metricId],z=0;if(AD){AD.forEach(function(AG){G(AG.expr.nds);AC.push({scriptClass:"mstrmojo.threshold.ThresholdRow",threshold:AG,editor:AA,model:x,idx:z++});});}AE.destroyChildren(false);AE.addChildren(AC);this.updateScrollbars();}function m(){var AD=this.content.rowPanel,AB=AD.children,z=(AB&&AB.length)||0,AA=this.model,AE=AA.thresholds,AC=AE&&AE[AA.metricId],x={expr:{et:14,fn:19}},AF={et:a.AE};if(!AE){AE=AA.thresholds={};}if(!AC){AC=AE[AA.metricId]=[];}AC.push(x);AD.addChildren([{scriptClass:"mstrmojo.threshold.ThresholdRow",threshold:x,editor:this,model:AA,idx:z}]);if(this.disableElementsBrowsing&&this.disableElementsBrowsing()){AF.et=a.AQ;}AD.children[z].exprTree.newCondition(AF);this.updateScrollbars();}function u(z){var x=this.model,AB=x.thresholds,AA=AB&&AB[x.metricId];if(AA){AA.forEach(function(AC){x.toggleThresholdSelected(AC,z);});}}function J(AC,AD){var x=this.controller,z=this.model,AA=this.metricId,AB=z.selectedThresholds;if(AB.length>0){x.onSaveThresholds(l(z,AB),AA,-1,AC,AD);}}function M(z){var AB="mstrIVE_THRESHOLD_SAVER",x=z.controller.dataService.model,AA=mstrmojo.all[AB];if(!AA){AA=new mstrmojo.SaveAsEditor({id:AB,zIndex:z.zIndex+1,folderLinksContextId:32,rootFolderID:x.isnew?null:x.pfid,showCompletePath:false,saveParams:{},typeDesc:mstrmojo.desc(3647,"Thresholds"),saveAs:function(AE){var AC=this.contPanel;this.name=AC.name.value;this.desc=AC.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var AF=this.saveParams||{};AF.folderId=this.ob.currentFolder.did;AF.name=this.name||"New Thresholds";AF.saveAsOverwrite=!!AE;var AD=this.saveAsCallback();AD.failure=function(AH){var AG=AH.code,AI=this.parent;if(AG==="-2147217373"||AG==="-2147216857"){mstrmojo.warn(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",AI.typeDesc||"Object").replace("###",AI.name),{confirmBtn:{fn:function(){AI.saveAs(true);}}},{title:mstrmojo.desc(3179,"Confirm Overwrite"),zIndex:AI&&AI.zIndex+10});}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+AH.message);}};AD.parent=this;J.call(z,AF,AD);}});AA.render();}AA.open();}function g(AA){var AF="mstrIVE_THRESHOLD_LOADER",AD=mstrmojo.all[AF],z=AA.controller.dataService.model,AE=[72];if(!AD){AD=new mstrmojo.vi.ui.editors.ObjectPicker({id:AF,supportedTypes:mstrmojo.array.hash(AE),zIndex:AA.zIndex+1,rootFolderID:z.isnew?null:z.pfid,onOpen:function x(){this.browse();},postBuildRendering:function AC(){mstrmojo.Editor.prototype.postBuildRendering.apply(this);},OKFn:function(AG){if(AG){AA.controller.onLoadThresholds(AA.metricId,AG.did);}}});var AB=AD.ob;AB.set("folderLinksContextId",32);AB.set("multiSelect",false);AB.set("searchVisible",true);AB.set("upButtonVisible",true);AB.set("browsableTypes","8,"+AE.join(","));AD.render();}AD.open();}function S(z){if(!z){return ;}if(z.t===Z.Consolidation&&z.st===s.ConsolidationManaged){var x=mstrApp&&mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model;if(x&&x.findUnitInDataSet){z=x.findUnitInDataSet(z.did);if(z&&z.attId){z=x.findUnitInDataSet(z.attId);}}}return z.t===Z.Attribute&&z.st===s.AttributeRecursive;}function F(z){var AA=P.clone(z);if(!(AA.node&E.CONDITION)&&S(AA.a)){AA={et:a.ANDOR,fn:mstrmojo.expr.FN.AND,node:E.CONDITION,nds:[AA]};}if(AA&&AA.et===a.ANDOR&&(AA.node&E.CONDITION)){var AB=P.valarray(N.findTargets(AA,"did"))[0],x={et:a.ANDOR,data:AA};switch(AB&&AB.t){case Z.Attribute:case Z.Consolidation:x.a=AB;break;case Z.Metric:x.m=AB;break;}return x;}return AA;}mstrmojo.threshold.AdvancedThresholdEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ui._HasScroller,mstrmojo._HasPopup],{scriptClass:"mstrmojo.threshold.AdvancedThresholdEditor",cssClass:"adv-threshold",title:"Advanced Threshold Editor",help:"Advanced_Thresholds_Editor.htm",model:undefined,targets:undefined,content:undefined,buttonBar:undefined,init:function q(x){this._super(x);L=this.id;},postBuildRendering:function R(){this._super();var x=this.content;c.call(this);x.conditionWalk.set("editor",this);x.property.set("editor",this);},onOpen:function U(){c.call(this);this.setRowPanelVisibility(true);var x=this.content;x.conditionWalk.set("visible",false);x.property.set("visible",false);x.set("editorNode",this.editorNode);var z=this.buttonBar&&this.buttonBar.quickLink;if(!!z){z.set("visible",this.objectType!==12);}},setupScrollNodes:function k(){this.scrollNode=this.content.containerNode;},onClose:function b(){this.model.cleanUp();},onmodelChange:function A(){var x=this.model;if(x){x.attachEventListener("modelEdit",this.id,"onmodelEdit");x.attachEventListener("selectedThresholdsChange",this.id,"onselectedThresholdsChange");c.call(this);}},onselectedThresholdsChange:function I(){},openConditionWalk:function D(AE,AD){var AB=this,AC=AB.content,z=AD.tree.parent,x=P.clone(z.threshold),AA=O.position(AB.titleNode);x.expr=AE;var AF=new mstrmojo.threshold.ThresholdRow({alias:"thresholdRow",slot:"conditionNode",idx:z.idx,model:this.model,threshold:x,onclick:mstrmojo.emptyFn});AF.render();B.toggleClass(AB.content.domNode,"no-overflow",true);AB.openPopup("conditionEditorPopupRef",{editor:AB,objectBrowsingEnabled:AB.objectBrowsingEnabled,showLimits:true,targets:AB.targets,targetsLastMod:new Date(),ets:AD.tree.validExprTypes,condition:AD,hasPrompt:false,model:F(AE),left:parseInt(AA.x+(AA.w-j)/2,10)+"px",top:parseInt(AA.y+AA.h,10)+"px",zIndex:AB.zIndex+1,title:AD.isEmpty()?mstrmojo.desc(5893,"New Condition"):mstrmojo.desc(14916,"Edit Condition"),disableHierarchyLevel:true});},onmodelEdit:function V(){c.call(this);},openPropertyPanel:function H(x){this.setRowPanelVisibility(false);var AA=this.content.property,z=AA.model=new mstrmojo.threshold.PropertyModel({thresholdRow:x,threshold:P.clone(x.threshold),gridValueFormat:P.clone(this.model.getGridValueFormat())});this.disposables.push(z);z.attachEventListener("propertyModelChange",x.id,"onpropertyModelChange");AA.set("visible",true);this.toggleButtonStatus(false);this.updateScrollbars();},getDatasets:function f(){if(this.model){return this.model.controller.datasets;}return null;},getIfDataSource:function X(){if(this.model){return this.model.controller.dataService;}return null;},onUpdateBrowseElementsParams:mstrmojo.emptyFn,onConditionEdit:function K(AA,z){var x=this;x.model.setConditionData(AA,z);x.setRowPanelVisibility(true);x.toggleButtonStatus(true);x.updateScrollbars();},conditionEditorPopupRef:{scriptClass:"mstrmojo.vi.ui.ConditionEditor",isHostedWithin:false,getIfDataSource:function X(){return this.editor.getIfDataSource();},getDatasets:function f(){return this.editor.getDatasets();},onUpdateBrowseElementsParams:function v(x){this.editor.onUpdateBrowseElementsParams(x);}},openAndORPopup:function t(AB,x){var z=new mstrmojo.ui.menus.MenuConfig();z.hostId=this.id;z.hostElement=x;z.isHostedWithin=false;z.menuCssClass="andor-PopupList";var AA=function AA(AH){var AC=AB,AG=AH.ctxt.did,AF=AG>21?true:null,AE=AG-(AF?21:0);var AD=AC&&AC.parent;if(AD&&AD.data&&AD.data.et===a.ANDOR){AD.edit(AC,AE,AF);}else{var AI=AC&&AC.data;if(AI&&(AI.not!==AF)){AI.not=AF;AC.paint();}}};z.addMenuItem(h[19],"",AA,{did:19});z.addMenuItem(h[20],"",AA,{did:20});z.addMenuItem(h["19_21"],"",AA,{did:19+21});z.addMenuItem(h["20_21"],"",AA,{did:20+21});this.openPopup(z.newInstance());},toggleButtonStatus:function C(x){this.buttonBar.children.forEach(function(z){z.set("enabled",x);});},setRowPanelVisibility:function Q(z){var x=this.content;x.rowPanel.set("visible",z);x.newCondition.set("visible",z);this.updateScrollbars();},children:[{scriptClass:"mstrmojo.Widget",alias:"rulesTitles",markupString:"<div class='rulesTitles'><div class='container'></div><div class='order'>"+mstrmojo.desc(3095,"Order")+"</div><div class='condition'>"+mstrmojo.desc(11890,"Threshold Conditions")+"</div><div class='format'>"+mstrmojo.desc(11891,"Format Preview")+"</div></div>"},{scriptClass:"mstrmojo.Box",cssClass:"content",alias:"content",editorNode:undefined,markupString:'<div id="{@id}" class="mstrmojo-Box {@cssClass}" style="{@cssText}"><div class="scroll-container"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},rowPanel:undefined,newCondition:undefined,conditionWalk:undefined,property:undefined,children:[{scriptClass:"mstrmojo.threshold.ThresholdRowPanel",alias:"rowPanel",children:[]},{scriptClass:"mstrmojo.Label",alias:"newCondition",cssClass:"link",text:mstrmojo.desc(4585,"New Threshold"),onclick:function e(){m.call(mstrmojo.all[L]);}},{scriptClass:"mstrmojo.threshold.ConditionWalk",alias:"conditionWalk",height:"300px",width:"750px",visible:false},{scriptClass:"mstrmojo.threshold.PropertyPanel",alias:"property",visible:false}]},{alias:"buttonBar",scriptClass:"mstrmojo.Box",slot:"buttonNode",children:[d(mstrmojo.desc(221,"Cancel"),function(){mstrmojo.all[L].close();},false,{enabled:true,alias:"cancelBtn"}),d(mstrmojo.desc(1442,"OK"),function(){r.call(mstrmojo.all[L],false);mstrmojo.all[L].close();},true),d(mstrmojo.desc(2031,"Apply"),function(){r.call(mstrmojo.all[L],true);},true),{scriptClass:"mstrmojo.Label",cssClass:"link",alias:"quickLink",text:mstrmojo.desc(14004,"Quick Thresholds Editor..."),onclick:function e(){var AA=mstrmojo.all[L],z=AA.model,x=AA.controller,AC=z.isAdvanced(z.metricId),AD=function(){AA.close();z.editorMode=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES.SIMPLE_EDITOR;},AB=[d(AC?mstrmojo.desc(1442,"OK"):mstrmojo.desc(2827,"Clear"),function(){AD();x.openEditor();},AC,AC?undefined:{cssClass:"nosave"})];if(!AC){AB.push(d(mstrmojo.desc(2031,"Apply"),function(){AD();r.call(AA,true);},true));}AB.push(d(mstrmojo.desc(2223,"Cancel")));mstrmojo.warn(AC?mstrmojo.desc(13998,"This action will clear the thresholds definition. Do you want to proceed?"):mstrmojo.desc(13999,"Do you want to apply your thresholds before using the Quick Thresholds Editor?"),undefined,{cssClass:AC?undefined:"save-threshold-warning",buttons:AB});}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.Box","mstrmojo.Button","mstrmojo.Editor","mstrmojo.Dial","mstrmojo.Label","mstrmojo.fe.CreateSetEditor","mstrmojo.fe.FilterEditor","mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.ui.ConditionWalk","mstrmojo.vi.ui.ConditionEditor","mstrmojo.vi.ui.editors.fe.ConditionWalk","mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree","mstrmojo.warehouse.EnumObjectTypes");mstrmojo.requiresDescs(118,2397,5758,14915,15540,15005,15014,15091);var b=mstrmojo.hash,W=mstrmojo.array,f=mstrmojo.css,L=mstrmojo.dom,Z=mstrmojo.expr,h=mstrmojo.mstr.EnumDSSXMLObjectTypes,S={TEMPLATE:0,DATASET:1},O=Z.ET,Y=Z.BRANCH_FNS,B=mstrmojo.warehouse.EnumObjectTypes,K=mstrmojo.mstr.EnumNodeProperties,I="VFEmpty";var G=10,U=46,H=116,P=286,R=369,F=42;DL_LABEL_HEIGHT=26;function g(k){var j={et:k.defaultExpressionType};if(k.disableElementsBrowsing&&k.disableElementsBrowsing()){j={et:O.AQ};}k.mainExpr.newCondition(j,true);}function N(j){var k=G;if(j<G){k=G;}else{if(j<=U){k=U;}else{k=H;}}return k;}function A(o,z){var u=o&&o.domNode,s=z&&z.domNode,k=u&&u.style,t=s&&s.style;var m=o.parent.domNode.offsetHeight;if(!z){k.height=m+"px";if(o.updateScrollbars){o.updateScrollbars();}return ;}if(u&&s){var r=R-P;if(!o.editor.showLimits){r-=F+DL_LABEL_HEIGHT;}var j=m-r;var l=L.position(o.itemsContainerNode),p=L.position(z.itemsContainerNode),w=l.h,x=p.h;var n=N(x),v=j-n;var q=Math.min(G+w,v);k.height=q+"px";t.height=j-q+"px";if(o.updateScrollbars){o.updateScrollbars();}if(z.updateScrollbars){z.updateScrollbars();}}}function D(k){var l=b.clone(k);if(k&&k.et===O.ANDOR&&(k.node&K.CONDITION)){var m=b.valarray(Z.findTargets(k,"did"))[0],j={et:O.ANDOR,data:l};switch(m&&m.t){case h.Attribute:j.a=m;break;case h.Metric:j.m=m;break;}return j;}return l;}mstrmojo.vi.ui.editors.FilterEditor=mstrmojo.declare(mstrmojo.fe.FilterEditor,null,{scriptClass:"mstrmojo.vi.ui.editors.FilterEditor",titleMarkupString:'<div class="mstrmojo-Editor-title-container"><div class="mstrmojo-Editor-title"></div><div class="edt-title-btn mstrmojo-Editor-help" tooltip="'+mstrmojo.desc(1143,"help")+'"></div><div class="edt-title-btn mstrmojo-Editor-close" tooltip="'+mstrmojo.desc(2102,"Close")+'"></div></div><div class="mstrmojo-Editor-subtitle-container"></div><div class="mstrmojo-Editor-titleSpacer"></div>',markupSlots:b.copy({subTitleNode:function X(){return this.showTitle?this.domNode.firstChild.children[1]:null;},containerNode:function d(){return this.domNode.firstChild.childNodes[3];},buttonNode:function J(){return this.domNode.firstChild.childNodes[4];},curtainNode:function E(){return this.domNode.lastChild;}},b.copy(mstrmojo.fe.FilterEditor.prototype.markupSlots)),help:"view_filter_editor_for_dossiers.htm",cssClass:"mstrmojo-charcoalboxe mstrmojo-FE mstrmojo-vi-ui-FE",postCreate:function C(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Box",slot:"subTitleNode",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(14915,"New Qualification"),cssDisplay:"inline-block",cssClass:"mstrmojo-relation-relateby-text",bindings:{text:function(){return this.editor.isNewCond?mstrmojo.desc(14915,"New Qualification"):mstrmojo.desc(15540,"Edit Qualification");},editor:"this.parent.parent",visible:function(){return !!this.editor.showCondWalk;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"newQualificationBtn",cssText:"float: left",cssDisplay:"inline-block",text:mstrmojo.desc(15005,"Add New Qualification"),onclick:function(){g(this.editor);},bindings:{enabled:function(){return !this.editor.readOnly;},visible:function(){return !this.editor.showCondWalk;},editor:"this.parent.parent"}}]}]);if(this._super){this._super();}},editorTitle:mstrmojo.desc(5758,"Filter Editor"),defaultExpressionType:O.AE,onvizTitleChange:function(){this.set("title",this.editorTitle+" - "+this.vizTitle);},getExpressionContainerCfg:function(){var j=this._super();j.cssDisplay="flex";return j;},onOpen:function M(){var j=this.mainExpr,k=this.limitExpr;if(j){A(j,k);}if(!this.model.expr){g(this);}},getExpressionContentsConfig:function(){return[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15091,"Metric values are not aggregated."),cssClass:"mstrmojo-FE-expr-header dl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"ve",scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewFilterExprTree",level:S.DATASET,bindings:{items:"this.editor.model.exprForest || []"},onBlankClick:function(o){this.parent.clearSelect(o);},supportRelation:true,postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("mainExpr",this);},onNew:function(p){p.data.isNew=true;if(!p.data.ph){this.editor.openWalk(p.data,p.widget.ctxtBuilder.itemWidgets[p.index],"condition");}var o=this.parent.vle;A(this,o);},onadd:function j(){f.toggleClass(this.parent.domNode,I,this.items.length===0);var o=this.parent.vle;A(this,o);},onremove:function l(){f.toggleClass(this.parent.domNode,I,this.items.length===0);var o=this.parent.vle;A(this,o);},onnodeadd:function k(){var o=this.tree.parent.vle;A(this.tree,o);},onnoderemove:function n(){var o=this.tree.parent.vle;A(this.tree,o);},onitemsChange:function m(o){var q=this.items.length===0,p=this.parent;if(this.hasRendered){f.toggleClass(p.domNode,I,q);}else{if(q){f.addWidgetCssClass(p,I);}else{f.removeWidgetCssClass(p,I);}}}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15014,"Metric values are aggregated based on the attributes in the visualization."),cssClass:"mstrmojo-FE-expr-header tl",bindings:{visible:"this.parent.parent.parent.showLimits"}},{alias:"vle",scriptClass:"mstrmojo.vi.ui.editors.fe.RWViewLimitExprTree",level:S.TEMPLATE,validExprTypes:W.hash([O.MQ,O.MC]),bindings:{visible:"this.editor.showLimits",items:"this.editor.model.limitExprForest || []"},onBlankClick:function(o){this.parent.clearSelect(o);},postApplyProperties:function(){this.editor=this.parent.parent.parent;this.editor.set("limitExpr",this);},onnodeadd:function k(){var o=this.tree.parent.ve;A(o,this.tree);},onnoderemove:function n(){var o=this.tree.parent.ve;A(o,this.tree);},onadd:function j(){var o=this.parent.ve;A(o,this);},onremove:function l(){var o=this.parent.ve;A(o,this);}}];},getConditionWalkConfig:function c(){return undefined;},toggleOkButtonStatus:function V(j){var k=this.buttonBar.children[0].btnSave;k.set("enabled",!!j);},andOrPopupRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-FE-andOrPopup mstrmojo-ConditionWalk",contentNodeCssClass:"mstrmojo-balloon",slot:"containerNode",modal:false,autoClose:true,showTitle:false,draggable:false,openEffect:null,closeEffect:null,onOpen:function(){var j=this.condition,m=j&&j.data&&j.data.not,n=j&&j.parent,k=n&&n.data,l=(k&&k.fn)+(m?21:0);this.list.opening=true;this.list.set("selectedItem",isNaN(l)?null:{did:l});this.list.opening=false;},children:[{scriptClass:"mstrmojo.Dial",cssClass:"mstrmojo-CGE-andOrDial",alias:"list",animate:false,itemMarkup:'<div class="dial-item {@css}">{@n}</div>',itemIdField:"did",renderOnScroll:false,items:[{did:19,n:Y[19]},{did:20,n:Y[20]},{did:19+21,n:Y["19_21"]},{did:20+21,n:Y["20_21"]}],onchange:function(){if(this.opening){return ;}var k=this.parent,j=k.condition,p=this.selectedItem,o=p&&p.did,n=o>21?true:null,m=o-(n?21:0);k.close();var l=j&&j.parent;if(l&&l.data&&l.data.et===O.ANDOR){l.edit(j,m,n);}else{var q=j&&j.data;if(q&&(q.not!==n)){q.not=n;j.paint();}}}}]},createSetPopupRef:{scriptClass:"mstrmojo.fe.CreateSetEditor",contentNodeCssClass:"",cssClass:"VI-CreateSet-Editor",slot:"containerNode",autoClose:true,showTitle:false,isHostedWithin:false},conditionEditorPopupRef:{scriptClass:"mstrmojo.vi.ui.ConditionEditor",isHostedWithin:false,getIfDataSource:function e(){return this.editor.getIfDataSource();},getDatasets:function Q(){return this.editor.getDatasets();},onUpdateBrowseElementsParams:function a(j){this.editor.onUpdateBrowseElementsParams(j);}},docModel:null,targetMetrics:null,_set_model:function(m,k){var l=this._super(m,k);if(l){var j=this.model.targets;this.targetMetrics=W.filter(j,function(n){n.title=n.n||"";return n.t===h.Metric;});}return l;},openWalk:function(o,p,t,u){var r=this,k=L.delta(p.domNode,r.containerNode);k.y+=(t==="andor"?16:parseInt(p.domNode.offsetHeight,10));var s={condition:p,zIndex:r.zIndex+10,left:k.x+"px",top:k.y+"px"},j;switch(t){case"andor":if(r.skipAndOrPopup){return ;}j="andOrPopupRef";break;case"createSet":case"createSetOpt":if(mstrApp&&mstrApp.isWSStyling&&u&&u.e&&u.e.target){var l=u&&u.e&&u.e.target,m=L.delta(l,r.containerNode);s.left=m.x+"px";s.top=m.y+parseInt(l.offsetHeight,10)+"px";}var q=r.model.targets;j="createSetPopupRef";s.type=t;s.model={attrs:W.filter(q,function(n){return n.t===B.ATTRIBUTE;}),metrics:W.filter(q,function(n){return n.t===B.METRIC;})};if(t==="createSetOpt"){s.condition=p.parent;s.model.childIdx=p.childIndex();}break;case"condition":var v=L.position(this.titleNode);s=b.copy({editor:r,objectBrowsingEnabled:r.objectBrowsingEnabled,showLimits:r.showLimits,targets:r.model.targets,targetsLastMod:r.modelLastSet,ets:p.tree.validExprTypes||r.validExprTypes,condition:p,hasPrompt:r.model.hasPrompt,disableElementsBrowsing:r.disableElementsBrowsing,inRelation:p.inRelation,model:D(o),left:v.x+50+"px",top:v.y+20+"px",draggable:!r.conditionEditorNotDraggable},s);if(!!o.isNew){s.title=mstrmojo.desc(14915,"New Qualification");}else{s.title=mstrmojo.desc(15540,"Edit Qualification");}j="conditionEditorPopupRef";}r.openPopup(j,s);},getIfDataSource:function e(){if(this.docModel){return this.docModel.getDataService();}return null;},onUpdateBrowseElementsParams:mstrmojo.emptyFn,getDatasets:function Q(){if(this.docModel){return this.docModel.datasets;}return null;},conditionEditorNotDraggable:false});}());(function(){mstrmojo.requiresClsP("mstrmojo","Editor","Container","TextBoxWithLabel","EditableLabel","Label","Container","PassThroughOptions","hash","dom","string","array");mstrmojo.requiresCls("mstrmojo.vi.ui.GroupDEList","mstrmojo.vi.ui.editors.DerivedElementPanel","mstrmojo.vi.ui.editors.CalculatedMemberPanel","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.vi.enums.EnumDerivedElementType","mstrmojo.warehouse.EnumDatabaseType");mstrmojo.requiresDescs(118,221,1911,5207,5348,6199,12091,12409,12410,12411,12412,13248,13249,13253,13916,15656);var E=mstrmojo.desc,Q=mstrmojo.css,K=mstrmojo.hash,C=mstrmojo.dom,M=mstrmojo.string.encodeHtmlString,G=mstrmojo.array.forEach,H=mstrmojo.vi.enums.EnumDerivedElementType,L=mstrmojo.warehouse.EnumDatabaseType,R;function P(){Q.addClass(this.list.domNode,"mstrmojo-others-rules");}function J(S){if(S.search(/\\|"|\[|\]/)!==-1){mstrmojo.alert(E(13916,'Group and calculation names cannot contain the following characters: \\"[].'));return false;}return true;}mstrmojo.vi.ui.editors.DerivedElementsEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.DerivedElementsEditor",cssClass:"mstrmojo-DerivedElementsEditor",title:E(13248,"Group Editor"),help:"Consolidating_unused_elements_into_a_group.htm",browseConfig:null,init:function N(S){this._super(S);R=this.id;},preBuildRendering:function B(){if(this.model&&this.model.isRA){this.cssClass+=" ra";}return this._super();},onOpen:function D(){this.deList.updateScrollbars();this.toggleNotifier();},close:function I(S){this._super(S);this.elementPanel.postClose();},_set_model:function(V,S){var U=S.attName+E(13253,"(Group)");this.model=S;this.deList.set("items",S.items);this.set("title",E(13248,"Group Editor")+" - "+(S.isNew===true?U:S.n));this.children[0].editDEName.set("label",(S.isNew||S.fromDS)?E(12199,"Attribute Name:"):E(13249,"Display Name:"));this.children[0].editDEName.set("value",(S.isNew===true)?U:(S.dispName?S.dispName:S.n));this.children[0].editDEName.set("emptyText",(S.isNew===true)?U:(S.dispName?S.dispName:S.n));this.initExcludeList();this.toggleEdit(false,false);this.othersProp.showChildren.set("selectedIndex",S.isNew?0:S.othersDE.showChildren?0:1);return true;},initExcludeList:function(){var S=this.elementPanel.excludeList={};G(this.model.items,function(U){if(U.t===1){G(U.es,function(V){S[V.v]=true;});}});},editItem:function(U){var S=this;if(U){G(this.model.items,function(W,V){if(W.id===U){S.deList.set("selectedIndex",V);S.toggleEdit(true,false,W);return false;}});}else{this.toggleEdit(true,true);}},commitEdit:function(V,S,U){var X=this.newGroupNode.editDEName;X.set("isEditing",false);var W=X.text,Y=J(W);if(Y){if(S){this.model.addDE(W,V);}else{this.model.updateDE(this.deList.selectedIndex,W,V,U,this.mptf);}this.deList.refresh();}return Y;},toggleEdit:function(Y,a,h){var g=1,Z=this.model,c=Z.items,f=mstrmojo.desc(5187,"Group"),d=this.elementPanel,j=this.cmPanel,V=function(k){return k.n===f+" "+g;},U=Z.isRA,S=U&&h&&h.t===H.CALCULATION,X=Y&&S;this.othersProp.showChildren.set("enabled",!Y&&!U);if(Y===true){if(S){j.set("model",h);j.set("visible",true);j.resetDisplay();var W=K.any(Z.docModel.datasets),b=W.tables[0].dbt,e=b===L.MSAS||b===L.EssBase;this.newGroupNode.ptoBtn.set("visible",e);}else{d.set("isRA",U);d.set("isNew",a);d.set("visible",true);d.setParentBox().set("visible",false);d.selectedElems().set("items",a?[]:K.clone(h.es));}}else{d.set("visible",false);j.set("visible",false);this.newGroupNode.ptoBtn.set("visible",false);delete this.mptf;}if(a&&c){while(true){if(c.some(V)){g++;}else{break;}}}this.newGroupNode.toggleEdit(Y,a?f+" "+g:h&&h.n);this.elementsTitles.toggleEdit(Y);if(Y){this.okBtn.set("enabled",false);}else{this.enableOkBtn();}},enableOkBtn:function(){this.okBtn.set("enabled",this.model.isDirty()&&this.deList.items&&this.deList.items.length>1);},toggleNotifier:function(){var V=this.model,U=V&&V.docModel,S=U&&U.hasSelectionOnVisFilter&&U.hasSelectionOnVisFilter();this.btnNotifier.domNode.style.display=!!S?"block":"none";},children:[{scriptClass:"mstrmojo.Container",markupString:'<div  class="{@cssClass}"><div></div><div style="clear:both;"></div></div>',cssClass:"attrNameEdit",markupSlots:{editNode:function(){return this.domNode.firstChild;}},children:[{scriptClass:"mstrmojo.TextBoxWithLabel",slot:"editNode",alias:"editDEName",label:E(13249,"Display Name:"),value:"Attribute(group)",onkeyup:function(){var S=mstrmojo.all[R].model;if(this.value&&this.value.length>0&&this.value!==S.n){S.isNameChanged=true;if(S.isNew||S.fromDS){S.n=this.value;}else{S.dispName=this.value;}}this.parent.parent.enableOkBtn();}}]},{scriptClass:"mstrmojo.Widget",alias:"elementsTitles",markupString:"<div class='elementsTitles'><div>"+M(E(5207,"Group Name"))+"</div><div>"+M(E(12091,"Selected Elements"))+"</div></div>",toggleEdit:function A(S){if(this.hasRendered){this.domNode.children[1].style.visibility=S?"hidden":"visible";}}},{scriptClass:"mstrmojo.Container",alias:"newGroupNode",markupString:"<div class='mstrmojo-VIGroupDERow new {@cssClass}'><div><div class='group-column'><div class='draggable-icon'></div><div class='name' mstrAttach:click>"+mstrmojo.desc(12412,"Add a Group")+"</div><div></div></div></div><div style='clear:both;float:none;'></div></div></div>",markupSlots:{rootContainer:function(){return this.domNode.firstChild;},editNode:function(){return this.domNode.firstChild.firstChild.children[2];},newNode:function(){return this.domNode.firstChild.firstChild.children[1];}},children:[{scriptClass:"mstrmojo.EditableLabel",cssClass:"mstrmojo-new-DEName",visible:false,slot:"editNode",alias:"editDEName",onkeyup:function(S){mstrmojo.EditableLabel.prototype.onkeyup.call(this,S);if(this.isEditing){var U=this[this.editableSlot];if(this.text!==(U.innerText||U.textContent||"")){var V=this.parent.parent.cmPanel;if(V.visible){V.set("isNameChanged",true);}else{this.parent.parent.elementPanel.enableSaveBtn();}}}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebHoverButton",visible:false,slot:"rootContainer",alias:"ptoBtn",text:E(15656,"Pass-through Options"),onclick:function(){var W=this.parent.parent,S="mstrPTO",U=mstrmojo.all[S]||mstrmojo.insert({scriptClass:"mstrmojo.PassThroughOptions",help:"create_derived_element_mdx_hierarchy_reports.htm",id:S}),Y=C.position(this.domNode,true),X=K.any(W.model.docModel.datasets),V={zIndex:W.zIndex+10,left:Math.max(0,(Y.x-333+Y.w/2))+"px",top:Y.y+"px",mptf:W.mptf||W.cmPanel.model.mptf,dbt:X.tables[0].dbt,so_dft:X.so_dft,sim_dft:X.sim_dft,onOK:function(Z){W.set("mptf",Z);}};U.open(W,V);}}],onclick:function(){mstrmojo.all[R].toggleEdit(true,true);},toggleEdit:function(U,S){if(this.hasRendered){Q.toggleClass(this.domNode,"isEdit",U);}else{this.set("cssClass",U?"isEdit":"");}this.editDEName.set("visible",U);this.editDEName.set("text",S);this.editDEName.set("isEditing",U);}},{scriptClass:"mstrmojo.vi.ui.GroupDEList",alias:"deList",items:[]},{scriptClass:"mstrmojo.EditableLabel",cssClass:"mstrmojo-edit-DEName",isEditing:true,visible:false,alias:"renameDE",allowEmptyText:false,onTextEditComplete:function(S){this.set("visible",false);if(S&&J(this.text)){this.parent.deList.selectedItem.isDirty=true;this.parent.deList.selectedItem.n=this.text;this.parent.enableOkBtn();this.parent.deList.refresh();}}},{scriptClass:"mstrmojo.HBox",alias:"othersProp",cssClass:"othersProp",children:[{scriptClass:"mstrmojo.Label",text:E(12409,"Display all other elements as")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-others-rule",alias:"showChildren",selectedIndex:0,isHostedWithin:false,onPopupWidgetOpened:function O(){P.call(this);},onitemSelected:function F(U){var S=this.parent.parent;if(this.hasRendered){S.model.editOthers({showChildren:U.v});S.enableOkBtn();}},items:[{n:E(12410,"individual items"),v:true},{n:E(12411,"a consolidated group"),v:false}]}]},{scriptClass:"mstrmojo.Widget",slot:"buttonNode",alias:"btnNotifier",markupString:"<div class='mstrmojo-btnNotifier'><div class='vfNotifier'><div></div><div>"+E(null,"This Visualization filter will be unset if you continue")+"</div></div></div>"},{scriptClass:"mstrmojo.Button",slot:"buttonNode",cssClass:"mstrmojo-WebButton Derived-Elements-Editor-Button",text:E(221,"Cancel"),onclick:function(){mstrmojo.all[R].close();this.parent.elementPanel.postClose();}},{scriptClass:"mstrmojo.Button",slot:"buttonNode",alias:"okBtn",cssClass:"mstrmojo-WebButton Derived-Elements-Editor-Button saveBtn",iconClass:"hot",text:E(118,"Save"),onclick:function(){this.parent.model.save();mstrmojo.all[R].close();}},{scriptClass:"mstrmojo.vi.ui.editors.DerivedElementPanel",alias:"elementPanel",visible:false},{scriptClass:"mstrmojo.vi.ui.editors.CalculatedMemberPanel",alias:"cmPanel",visible:false,getPeInModel:function(){var S=this.model;return S&&S.getParentElement();},getCmExpressionInModel:function(){var S=this.model;return S&&S.getPassThroughExpression();},getDocModel:function(){var S=this.parent.model;return S&&S.docModel;},getAttributeId:function(){var S=this.parent.model;return S&&S.attId;}}]});mstrmojo.vi.ui.editors.DerivedElementsEditor.validateElementName=J;}());(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.hash","mstrmojo.dom","mstrmojo.color","mstrmojo.string","mstrmojo.boxmodel","mstrmojo.array","mstrmojo.Label","mstrmojo.DocDataService","mstrmojo.Xtab","mstrmojo._HasOwnAvatar","mstrmojo._HasPopup","mstrmojo.vi.ui._IsDropTarget","mstrmojo.rw.xtab._XtabColResize","mstrmojo.vi.ui._XtabCellHoverMgr","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.VIDragUnit","mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl","mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights","mstrmojo.ui.editors.RenameEditor","mstrmojo.models.FormatModel","mstrmojo.models.template.DataInterface","mstrmojo.vi.models.editors.XtabEditorModel","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste","mstrmojo.vi.ui.rw.GhostImageContainer","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui.rw.FreezingImageContainer");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_IsMultiselectXtab","_HasVisSelections","_XtabHighlights","_XtabDE","_XtabRA","_SupportViewFilterInVizBox","VizDropCue");mstrmojo.requiresClsP("mstrmojo.vi.viz","EnumVisualizationTemplates");mstrmojo.requiresDescs(11664,11668,13766,13767,14668);var p=mstrmojo,A3=p.array,t=p.func,a=p.hash,AS=p.dom,g=p.string,AV=p.models,AJ=p.vi.models,A1=p.vi.viz,Aj=AV.template.DataInterface,AA=AV.FormatModel,x=AA.ENUM_PROPERTY_NAMES,Ae=AA.getFormatUpdate,K=mstrmojo.DocDataService.SUPPRESS_DATA,I=A3.fnReduceNumber,AO="px",Au=A1.EnumVisualizationTemplates,An=mstrmojo.vi.models.EnumDragSources,Ab=mstrmojo.vi.enums.EnumFeatures,k=mstrmojo.vi.models.editors.XtabEditorModel.ENUM_TARGET_FORMAT,A7=mstrmojo.vi.models.editors.XtabEditorModel.ENUM_TARGET_SUBTOTAL_FORMAT_PROPNAME,A0=mstrmojo.vi.ui.rw.GhostImageContainer;var r=Aj.ENUM_GRID_RESIZE,Aa=r.FIXED,S=r.FIT_TO_WINDOW,Ad=r.FIT_TO_CONTENTS,z=AJ.EnumDragSources,Ak=AJ.editors.XtabEditorModel.ENUM_EDITOR_TARGETS,Ar=Ak.COLUMNS,Ac=Ak.ROWS,A5=Ak.VALUES,AB=4,E="00000000000000000000000000000000";var A8={isSubtotalFormat:false,isSubtotalUseGridFormatting:true};function AX(BA){this.submitUndoRedoActionsWithCallback(this.controller.dataService().getUpdateTemplateAction(this.k,BA));}function s(){var BC=this.id,BA=this.model.docModel;return{success:function BB(BE){var BG=mstrmojo.all[BC],BF=BG.parent,BD=BG.getScrollPos();BF=BA.partialUpdateAndRebuildChild(BF,BE)||BF;window.setTimeout(function(){BA.selectVIUnit(BF.id,true);BF.boxContent.scrollTo(BD,true);},0);}};}function A6(){var BC={scriptClass:"mstrmojo.Label",cssClass:"dropMsg",text:mstrmojo.desc(11668,"Drag objects here.")},BB=this.gridData,BE=BB&&BB.eg;if(this.excludeData){var BD=mstrmojo.VisUtility.getAttMetricCount.call(this);BC={scriptClass:"mstrmojo.vi.ui.rw.FreezingImageContainer",cssClass:"xtab",visName:mstrmojo.desc(114,"Grid"),visDropzoneMsg:mstrmojo.vi.ui.rw.FreezingImageContainer.getVisDropzoneMsg(BD.attCount,BD.metricCount)};}else{if(BE){BC={scriptClass:"mstrmojo.Container",cssClass:"error-msg",markupString:'<div class="{@cssClass}"><div class="error-content" style="visibility: visible"><div class="text" style="padding-top:0">'+BE+"</div></div></div>",markupSlots:{containerNode:function(){return this.domNode;}}};}else{if(mstrApp&&mstrApp.supportFeature(Ab.SUPPORT_GHOST_IMG)){var BA=A0.getVisDesc("grid");BC={scriptClass:"mstrmojo.vi.ui.rw.GhostImageContainer",cssClass:"xtab",visName:mstrmojo.desc(114,"Grid"),visDesc:BA};}}}this.raiseEvent({name:"toggleCtrlOverlay",visible:(!BB||BE!==undefined)||this.excludeData,controls:[BC]});}function AK(){var BA=document.createElement("textarea");BA.className="xTabHiddenTextArea";BA.setAttribute("tabindex","-1");this.domNode.appendChild(BA);this.xTabHiddenTextArea=BA;}function AE(BB,BA,BC){BB.push({x:BA,y:BC});}function o(BE,BC,BF,BB,BK,BD,BI,BA){var BL=BI.o,BH=0,BG={or:BL,size:BI.cueSize+AO},BJ=function(){return Math.max(BH+BD-6,BI.cueMinPos)+AO;};if(BL==="v"){BH=BE;BG.top=BC+AO;BG.left=BJ();}else{BH=BC;BG.top=BJ();BG.left=BE+AO;}BA.push({id:BF+"|"+BB,points:BK,cue:BG});}function c(BF,BE,BB,BG){var BD=[],BA=BB/2,BC=BG.end;AE(BD,BF,BE);if(BG.o==="v"){AE(BD,BF,BC);AE(BD,BF+BA,BC);AE(BD,BF+BA,BE);}else{AE(BD,BF,BE+BA);AE(BD,BC,BE+BA);AE(BD,BC,BE);}return BD;}function H(BG,BF,BB,BH,BD){var BA=BB/2,BC=BH.end,BE=[];if(BH.o==="v"){AE(BE,BG+BA,BF);AE(BE,BG+BA,BC);if(BD){AE(BE,BH.side,BC);AE(BE,BG+BB,BH.header);}else{AE(BE,BG+BB,BC);}AE(BE,BG+BB,BF);}else{AE(BE,BG,BF+BA);AE(BE,BG,BF+BB);if(BD){AE(BE,BC,BH.side);AE(BE,BC,BF+BB);}else{AE(BE,BC,BF+BB);}AE(BE,BC,BF+BA);}return BE;}function AR(BI,BE,BG,BD,BF,BH,BA){var BC=BI.x,BB=BI.y;o(BC,BB,BD,BF,c(BC,BB,BE,BH),0,BH,BA);o(BC,BB,BD,BF+1,H(BC,BB,BE,BH,BG),BE,BH,BA);}function Q(BE,BG,BF,BH,BC,BJ,BB){var BI=0,BD=BE[0],BA=function(){var BK=BG.splice(0,BI).map(BC).reduce(I,0);AR(BJ(BF),BK,false,-1,BD+1,BH,BB);return BK;};BE.forEach(function(BK){if(BK===BD){BI++;}else{BF+=BA();BD=BK;BI=1;}});BA();}function h(BC,BA,BD,BF,BG,BB){var BE=BC.length-1;BC.forEach(function(BI,BH){AR(BG(BA,BD),BI,BH===BE,BD,BH+1,BF,BB);BA+=BI;});}function AL(BD,BC,BB){var BA={order:[]};BD.forEach(function(BG){var BE=BG.id||"metrics",BF=BA[BE];if(!BF){BA.order.push(BE);}BA[BE]=(BF&&BF+1)||(BG.fs&&BG.fs.length)||1;});return BA.order.map(function(BE){return BC.splice(0,BA[BE]).map(BB).reduce(I,0);});}function As(BA){var BV=new mstrmojo.models.template.DataInterface(this.gridData),BN=AS.position(this.zone.tableNode),BM=this.gridInfo,BO=this.gridData,BS=BO.twm.bottom.map(function(BW){return parseInt(BW.w,10);}),BT=AL(BV.getRowTitles().titles,BS,function(BW){return BW;}),BG=Array.prototype.slice.call(this.zone.domNode.getElementsByTagName("tr"),0),BI=BT.reduce(I,0),BK=AL(BV.getColTitles().titles,BG,function(BW){return BW.offsetHeight;}),BP=BN.y,BF=BP+BK.reduce(I,0),BH=BN.x+BN.w,BJ=BN.y+BN.h,BU=BN.x,BQ=AS.position(this.domNode.parentNode),BL={cueSize:Math.min(BQ.h,BN.h),cueMinPos:BQ.x,header:BF,side:BH,end:BJ,o:"v"},BB={cueSize:Math.min(BQ.w,BN.w),cueMinPos:BQ.y,header:BF,side:BJ,end:BH,o:"h"},BE=function(BW){return{x:BW,y:BP};},BR=function(BW,BX){var BY={x:BU,y:BW};if(BX===2){BY.x+=BI;}return BY;},BD=[];if(BA.getCtxtDragData().item.t===AB&&BM.mx&&BM.mx.length){var BC=BO.gvs.items;if(BM.tma===2){Q(BC[0].items.map(function(BW){return BW.mix;}),BS,BU+BI,BL,function(BW){return BW;},BE,BD);}else{Q(BC.map(function(BW){return BW.items[0].mix;}),BG,BF,BB,function(BW){return BW.offsetHeight;},BR,BD);}}else{BB.cueSize-=BI;h(BT,BU,1,BL,BE,BD);h(BK,BP,2,BB,BR,BD);}return BD;}function A(){var BA=this.model;return !!(BA.getSelectorControlMapInfo?BA.getSelectorControlMapInfo():[]).length;}function Ao(BC){if(!BC){return Ak.GENERAL;}var BA=BC.info;if(!BA){return undefined;}if(BA.isSrcTitle){return Ar;}var BB=BA.title;if(BB.otp===-1&&!BC.isMetricHeader){return A5;}return BB.axis===1?Ac:Ar;}function U(){var BB=this.msgNode,BA=this.getFormats()["background-color"];if(BB&&BA){BB.style.color=mstrmojo.color.getContrastingColor(BA,"#cdcdcd","#444649");}}mstrmojo.vi.ui.rw.Xtab=mstrmojo.declare(mstrmojo.Xtab,[mstrmojo._HasOwnAvatar,mstrmojo.rw.xtab._XtabColResize,mstrmojo.ui._HasScroller,mstrmojo.vi.ui.rw._IsMultiselectXtab,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.vi.ui.rw._XtabHighlights,mstrmojo.vi.ui.rw._XtabDE,mstrmojo._HasPopup,mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste,mstrmojo.vi.ui.rw._XtabRA,mstrmojo.vi.ui.rw._SupportViewFilterInVizBox,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.rw.Xtab",controller:null,formatHandlers:{msgNode:["height"],viewport:["D"]},dropZone:true,isMultiSelect:true,cellHoverMgr:"mstrmojo.vi.ui._XtabCellHoverMgr",CELL_HIGHLIGHT:"xtabSel",isVIXtab:true,excludeData:false,supportsEditorClickSwitching:true,init:function AZ(BA){this.excludeData=!!(mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause());if(this._super){this._super(BA);}},renderEmptyGrid:function V(){return true;},_set_edtModel:function d(BB,BC){var BA=this._edtModelListener;if(BA){BA.clear();}this.edtModel=this.addDisposable(BC);this._edtModelListener=BC.attachEventListener("BEMFormatChange",this.id,function(BD){if(BD.propertyName===x.BACKGROUND_COLOR){U.call(this);}});return true;},handlesMultiSelection:function v(){return true;},getVisType:function C(){return{s:"VisGrid",vt:Au.GRID};},_set_gridData:function f(BB,BA){this.gridData=BA;this.raiseEvent({name:"regenerateToolbar"});return true;},submitUndoRedoActionsWithCallback:function AC(BA,BB){this.controller.submitUndoRedoTemplateWithCallback(this,BA,BB);},updateForPU:function(BA){this.node=BA;this.update(BA);},onAppStateChange:function(BA){var BB=mstrApp.isAppStatePause(),BC=BA.valueWas&mstrmojo.vi.VisualInsightApp.APP_STATES.PAUSE;this.excludeData=!!(mstrConfig.resolveOnly||BB);if(this._super){this._super(BA);}if((BB&&!BC)||(!BB&&BC&&!mstrApp.enableUpdate)){A6.call(this);}},refresh:function Am(BA){if(this.excludeData){A6.call(this);return ;}this._super(BA);},update:function u(BD){var BC=this.gridData,BF=BC&&BC.gsi&&BC.gsi.fmts;if(BF){var BB=BD.data,BE=BB[0]||BB,BA=BE&&BE.gsi&&BE.gsi.fmts;if(BA){a.keyarray(BA).forEach(function(BG){if(BA[BG].empty){BA[BG]=BF[BG];}});}}this._super(BD);A6.call(this);},postBuildRendering:function A9(){this._super();this.shouldClipLockableXtab=false;U.call(this);A6.call(this);AK.call(this);},setupScrollNodes:function O(){this.scrollNode=this.scrollboxNode;this.scrollbarHostNode=this.domNode;},drill:function Ag(BA,BE){var BD,BB=this.model,BC=this;if(!BA._e){BD=BB.getDrillAction(this.getActionCells(BA),BE);}else{BD=BB.getDrillAction(A3.map(this.cmSelCells,function(BF){return BC.getCellForNode(BF);}),BE);}this.controller.onDrill(this,BD);},pivot:function m(BB,BD){var BE=this,BC=this.model,BA=function(){AX.call(BE,BC.getPivotAction(BB,BD));};if(BD==="2"){BC.xtab.zonesModel.checkAndWarnLargeItemsForAddUnits([BB],BA,null,true);return ;}BA();},pivotForm:function P(BA,BB,BC){if(BB==="l"||BB==="r"){AX.call(this,this.model.getPivotFormAction(BA,BB,BC));}},showTotal:function e(BA,BC,BB){AX.call(this,this.model.getTotalsAction(BA,BC,BB));},renameUnit:function Af(BH){var BF=BH&&BH.mix!==undefined&&!!BH._e,BB=(BF?BH._e.oid:BH.id),BG=BF?4:BH.otp,BD=this.model,BE=this.gridInfo,BA=BE.rows.concat(BE.cols).concat(BE.mx).filter(function(BJ){return BJ.did===BB;})[0],BC=BD.getUnitNameInDataSet(BB),BI=(BA&&BA.n)||BH.n||BH.v;(new mstrmojo.ui.editors.RenameEditor({renameText:BI,helpText:BC&&BI!==BC?mstrmojo.desc(14668,"Original Name: ##").replace("##",BC):null,onRename:function(BJ){var BK=function(){AX.call(this,BD.getRenameTemplateUnitAction(BB,BG,BJ,false));}.bind(this);if(BD.doesNameExistOnTemplate(this,BB,BG,BJ)){mstrmojo.confirm(mstrmojo.desc(11664,'"##" already exists in the visualization. Do you want to proceed?').replace("##",BJ),{confirmBtn:{fn:BK}});}else{BK();}}.bind(this)})).open();},hasSubtotal:function AM(BE){var BC=this.model,BB=BC&&BC.data,BA=BB&&BB.gts,BJ=BA&&BA.row||[],BF=BA&&BA.col||[],BD={},BH=false,BI=BB&&BB.gsi,BG=BI&&BI.hidesb;if(BG){return false;}BD[Ak.ROWS]=BJ;BD[Ak.COLUMNS]=BF;BD[Ak.VALUES]=BJ.concat(BF);A3.forEach(BD[BE||Ak.VALUES],function(BK){if(BK.ast&&BK.ast.length>0){BH=true;return false;}});return BH;},getSubtotalFormatUseGridFormat:function At(BC){var BA=this.model,BB=BA&&BA.data,BD=BB&&BB.gsi,BE=BD&&BD.prop||{};return BE[x[A7[BC]]];},removeUnit:function Z(BA){var BG=BA&&BA.mix!==undefined&&!!BA._e,BC=this.model,BE=BG?BA._e.oid:BA.id,BF=BC.getCurrentUnitAxisAndPosition(BE),BB=BF&&BF.axis,BD=BF&&BF.depth;AX.call(this,BC.getRemoveTemplateUnitAction({did:BE,t:BG?4:BA.otp,axis:BB,unitPos:BD}));},removeTotal:function Y(BB){var BD=BB.hst;if(BD!==undefined){var BC=this.model,BE=BC.getCellTitleInfo(BB).title;var BA=![].concat(BE.ast||[]).some(function(BF){return BF.t===BD;});if(BA){AX.call(this,BC.getRemoveAxisTotalsAction(BD,BB.axis));}else{this.showTotal(BE,[],[BD]);}}},formatGridZone:function AT(BC,BB,BA){AX.call(this,this.model.getZoneFormatAction(BC,BB,this.k,BA));},getFormatDefaultColorActions:function Aq(BA){if(!BA){return[];}var BB=this,BC=function BC(BD,BE){var BF=[];a.forEach(BD,function(BH,BG){if(BG==="st"){BF=BF.concat(BC(BH,true));}else{a.forEach(BH,function(BI,BJ){BF.push(BB.model.getZoneFormatAction(BG,Ae(BJ,BI),BB.k,{isSubtotalFormat:!!BE,isSubtotalUseGridFormatting:false}));});}});return BF;};return BC(BA);},getFormatSelectedColorActions:function Ay(BB){var BA=k[Ak.COLUMNS],BC={bc:A8,fc:A8,bbc:A8,brc:A8},BE=[],BD=this;if(BB){a.forEach(BC,function(BF,BG){if(BB[BG]){BE.push(BD.model.getZoneFormatAction(BA,Ae(BG,BB[BG]),BD.k,BF));}});}return BE;},getFormatGridColorAction:function Ax(BA,BB){return this.getFormatDefaultColorActions(BA).concat(this.getFormatSelectedColorActions(BB));},formatGridColor:function Ax(BA,BB){AX.call(this,this.getFormatGridColorAction(BA,BB));},formatGridStyle:function W(BA,BB,BC){AX.call(this,(BB?this.getFormatGridColorAction(BC,BB):[]).concat(this.getFormatSelectedStyleActions(BA)));},getFormatSelectedStyleActions:function F(BB){var BA=k,BC={bbs:A8,brs:A8},BE=[],BD=this;a.forEach(BA,function(BF){a.forEach(BC,function(BG,BH){if(BB[BH]!=undefined){BE.push(BD.model.getZoneFormatAction(BF,Ae(BH,BB[BH]),BD.k,BG));}});});return BE;},UpdatePropAndformatGridZone:function n(BE,BC,BB){var BA=this.model.getAdvancedPropertiesAction(Ae(x[A7[BE]],0)),BD=this.model.getZoneFormatAction(k[BE],BC,this.k,BB);AX.call(this,[BA,BD]);},batchFormatGridZones:function N(BC,BB,BA){var BD=this;AX.call(this,BC.map(function(BF,BE){return !!BB[BE]?BD.model.getZoneFormatAction(BF,BB[BE],BD.k,BA):null;}).filter(function(BE){return !!BE;}));},formatPadding:function Az(BC,BD,BB){var BA=Ae(x.GRID_HORIZONTAL_PADDING,BC,Ae(x.GRID_VERTICAL_PADDING,BD));AX.call(this,["ch","rh","va"].map(function(BE){return this.model.getZoneFormatAction(BE,BA,this.k,BB);},this));},keepOnlyOrExclude:function G(BA,BC){var BB=this.controller,BD=this.getContextMenuSelections(),BE=t.wrapMethods(BB._getXtabCallback(this));BB.applyKeepOnly(this,BE,{keepOnly:BC,data:BD.length>0?BD:[this.model.getCellDataUnion(BA)]});if(!BC){this.clearSelections();this.endSelections();}},setAllXtabWidths:function b(BD){var BC=this.gridData.twm||{},BA=BC.top,BB=BC.bottom,BE=BD?(BD+AO):BD;(BB||[]).forEach(function(BF,BG){BA[BG]=BA[BG]||{};BA[BG].w=BF.w=BE;});},changeResizeScenario:function Ai(BN,BA,BG,BR){var BB=new mstrmojo.models.template.DataInterface(this.gridData),BF=BB.getRowResizeInfo(),BL=this.gridData.twm||{},BO=BL.bottom,BJ=BB.getColumnHeaderData(true),BV=this,BE=this.model,BM=this.id,BW=this.k,BI=[],BD=[],BQ=[],BC=1,BP=BA?BB.getColResizeScenario():BF.v,BT=[];if(BP===BN){return ;}if(BA){BI.push({act:"changeXtabColWidthScenario",value:BN});if(BN===Aa||BP===Aa){BJ.forEach(function(BY,BX){var Bc=BY.oid||BY.id,Bb=function(Bd){return Bd.unitId===Bc&&Bd.depth===BC;},Ba=BJ[BX-1];if(!(BY.fs&&BY.fs.length>0)||(Ba&&Bc!==(Ba.oid||Ba.id))){BC=1;}var BZ=Bc===(BG&&BG.did)&&BC===BG.depth;if(!BT.some(Bb)){BT.push({unitId:Bc,depth:BC});BD.push({colIndex:BX,value:BZ?BG.width+AO:BO[BX].w});BQ.push({colIndex:BX,value:BO[BX].w});if(BN===Aa){BI.push(BE.getColumnResizeAction(Bc,BY.otp,BZ?BG.width:parseInt((BO[BX].w)||0,10),BC,BZ?BG.isExtra:false));}}BC++;});}var BS=function BS(BX,BZ){var BY=mstrmojo.all[BM];if(BX===Aa){BV.updateRelatedColWidths(BZ);}BV.updateScenario(BX);};if(!BR){if(this.isCustomSort){this.updateRelatedColWidths(BD);this.delegateToActionMgr(BI);}else{this.controller.cmdMgr.execute({execute:function BH(){BS(BN,BD);this.submit(BE.getDataService().getUpdateTemplateAction(BW,BI),s.call(mstrmojo.all[BM]),K);},urInfo:{undo:function BU(){BS(BP,BQ);},redo:function BK(){BS(BN,BD);},callback:s.call(this)}});}}else{BS(BN,BD);}}else{BI.push({act:"changeXtabRowHeightScenario",value:BN,height:BF.height});if(!BR){AX.call(this,BI);}}return BR?BI:undefined;},submitColumnWidthChange:function j(BD,BH,BF,BE){var BI=this;if(!BH){var BC=BI.k,BA=BI.model.getDataService(),BB=s.call(BI);if(this.isCustomSort){this.delegateToActionMgr(BD);}else{this.controller.cmdMgr.execute({execute:function BJ(){this.submit(BA.getUpdateTemplateAction(BC,BD),BB,K);},urInfo:{undo:function BK(){BI.updateRelatedColWidths(BF);},redo:function BG(){BI.updateRelatedColWidths(BE);},callback:s.call(this),extras:K}});}}},changeColumnWidth:function A2(BO,BM,BL,BB,BJ,BP){var BA=new mstrmojo.models.template.DataInterface(this.gridData),BI=this.gridData.twm||{},BK=BI.bottom,BH=BA.getColumnHeaderData(true),BR=this,BF=this.model,BG=[],BD=[],BN=[],BC=1,BE=-1,BQ=[];if(BA.getColResizeScenario()!==Aa){BG=this.changeResizeScenario(Aa,true,{did:BO,t:BM,width:BL,depth:BB,isExtra:BJ},BP);return BP?BG:undefined;}if(BO==="all"){BH.forEach(function(BT,BS){var BW=BT.oid||BT.id,BV=function(BX){return BX.unitId===BW&&BX.depth===BC;},BU=BH[BS-1];if(!(BT.fs&&BT.fs.length>0)||(BU&&BW!==(BU.oid||BU.id))){BC=1;}if(!BQ.some(BV)){BQ.push({unitId:BW,depth:BC});BD.push({colIndex:BS,value:BL+AO});BN.push({colIndex:BS,value:BK[BS].w});BG.push(BF.getColumnResizeAction(BW,BT.otp,BL,BC,false));}BC++;});}else{BH.every(function(BT,BS){var BU=(BT.oid===BO||BT.id===BO);if(BU){BE=BS+BB-1;}return !BU;});if(BE>=0){BD.push({colIndex:BE,value:BL+AO});BN.push({colIndex:BE,value:BK[BE].w});BG.push(BF.getColumnResizeAction(BO,BM,BL,BB,BJ));}}BR.updateRelatedColWidths(BD);BR.submitColumnWidthChange(BG,BP,BN,BD);return BP?BG:undefined;},changeRowHeight:function Av(BA){AX.call(this,{act:"changeXtabRowHeightScenario",value:Aa,height:BA});},showBanding:function AF(BA){if(mstrApp.isInVFConfigMode){mstrApp.showBandingInVFConfigMode=true;}this.controller.submitUndoRedoUpdates(this.model.getDataService().getUpdateTemplateAction(this.k,{act:"showBanding",show:!!BA}),{},s.call(this));},showOutlineModeOption:function AD(BI){var BD=BI?1:0,BE=BI?0:-1,BJ=BI?-1:0,BA={act:"advancedProperties",props:{"Template Formatting":{Indented:BD}}};if(BI){BA.props["Template Formatting"]["MergeCells"]=BJ;}var BF=this.k,BB={act:"format",unitKey:BF,unitType:521,formatType:1,format:{FormattingIncrementalFetch:{EnableIFOnGrid:BE}}};if(mstrApp.isInVFConfigMode){mstrApp.showOutlineInVFConfigMode=true;}if(!this.hasSubtotal()&&BI){var BG=this.zonesModel.getShowQuickTotalAction();var BH=this.model.getDataService().getUpdateTemplateAction(this.k,BA);for(var BC=0;BC<BG.length;BC++){BH.actions.push(BG[BC]);}this.controller.submitUndoRedoUpdates([BH,BB],{},s.call(this));}else{this.controller.submitUndoRedoUpdates([this.model.getDataService().getUpdateTemplateAction(this.k,BA),BB],{},s.call(this));}},applyGridCellFormatForSubtotalChange:function q(BA,BB){var BC=[this.model.getAdvancedPropertiesAction(Ae(x[A7[BB]],BA?1:0))];if(BA){BC.push(this.model.getApplyGridCellFormatToSubtotalAction(k[BB]));}AX.call(this,BC);},getDragData:function A4(BA){var BD=BA.src.node,BF=this;if(!this.isColResizeNode(BD)&&!this.isDraggingScrollBar(BA)){var BE=this.model,BJ=this.getCellForNode(BD),BC=BE.getCellInfo(BJ),BG=BC.isTitle,BI=(BC.isMetric&&BC.isHeader);if(BG||BI){var BH=BG?BE.getCellTitleInfo(BJ).title.id:BJ._e.oid,BK=BE.getObjectInfo(BH);BK.cell=BJ;var BB=(BA.dragUnitHelper=new mstrmojo.vi.ui.VIDragUnit()).getUnitDragData(BA,[BK]);BB.src=An.VIZ;BB.onRemove=function(BL){BF.removeUnit(BL.cell);};BB.allowDropOnTarget=function(BL){if(BL===An.DATASETS){return true;}return false;};return BB;}}return this._super(BA);},isDragValid:function AH(BB){var BD=BB.src.node,BA={},BC;if(!this.isColResizeNode(BD)&&!this.isDraggingScrollBar(BB)){BA=this.model.getCellInfo(this.getCellForNode(BD));}BC=BA.isTitle||(BA.isMetric&&BA.isHeader);if(mstrApp.isDossier&&BC){return false;}return mstrApp.isInVFInteractMode&&BC?false:(BC||this._super(BB));},createAvatar:function R(BB,BA){if(BA.dragUnitHelper&&!this.isColResizeNode(BB)){return BA.dragUnitHelper.getUnitAvatar(BA,true);}return this._super(BB,BA);},positionAvatar:function l(BB,BA){if(BA.dragUnitHelper){BA.dragOffsets=BA.dragUnitHelper.getDragUnitOffsets();}this._super(BB,BA);},allowBoxDropFromDataset:function AN(BB){var BA=this.gridData;return !BA||BA.egt!==undefined;},allowDrop:function D(BB){var BC=BB.getCtxtDragData(),BA=BC&&BC.items;return(BB.dragUnitHelper&&BB.src.widget===this)||((BA&&BA.length===1)&&BC.src===z.DATASETS);},getDropData:function AG(BB){var BD=BB.getCtxtDragData().item,BC=BD&&(new mstrmojo.models.template.DataInterface(this.gridData)).getUnitById(BD.did),BA=!this.model.hasSameRecursiveAttributeGroup(BD),BE=!!BC?mstrmojo.desc(13766,"Move ##"):mstrmojo.desc(13767,"Add ##");return{cue:new mstrmojo.vi.ui.rw.VizDropCue(),unit:BC,tip:BA?BE.replace("##",g.encodeHtmlString(BD.n)):"",avatar:BA?(!!BC?"move":"add"):"no-op",allowDrop:BA};},ondragenter:function L(BB){var BA=BB.xtabMaps=BB.xtabMaps||{};if(!BA[this.id]){BA[this.id]=As.call(this,BB);}this.closePopup();this.openPopup(BB.getCtxtDropData().cue);this.ignoreHover=true;},ondragover:function AP(BA){var BB=BA.xtabMaps[this.id],BG=BA.getCtxtDropData(),BE;BB.every(function(BJ){if(mstrmojo.boxmodel.isPtInPolygon(BA.tgt.pos,BJ.points)){BE=BJ;return false;}return true;});var BD=(BE&&BE.id)||"";if(BG.areaId!==BD){var BC=BA.getCtxtDragData(),BH=null,BI="",BF=BE&&BE.cue;if(BF){BH={tip:BG.tip,or:BF.or,size:BF.size,top:BF.top,left:BF.left};BI=BG.avatar;}else{if(BC.src===z.DATASETS){BI=(BG.unit||!BG.allowDrop)?"no-op":"add";}}BG.cue.set("cueConfig",BH);BG.areaId=BD;BC.setAvatarClass(BI);}},ondrop:function B(BC){var BH=BC.getCtxtDropData().areaId,BE=BC.getCtxtDragData();if(BH){var BP=BH.split("|"),BM=parseInt(BP[0],10),BJ=parseInt(BP[1],10),BG=BE.items[0],BD=this.model,BQ=BG.did,BS=BD.getCurrentUnitAxisAndPosition(BQ),BO;if(BC.src===this||BS){var BK=BS.axis,BN=BS.depth;if(BM!==BK||(BJ!==BN&&BJ!==BN+1)){if(BM===BK&&BN<BJ){BJ--;}BO=BD.getPivotUnitAction(BM,BJ-1,BQ,BG.t,BK,BN-1);}}else{if(!BD.hasSameRecursiveAttributeGroup(BG)){BD.addEditNodeForDatasetAction(BC,this.k);BO=BD.getAddTemplateUnitAction(BG,BE.dsid,BM,BJ-1);}}if(BO){var BT=this,BI=this.controller,BA=function(){var BY=BC.actions||[],BW;BW=BI.dataService().getUpdateTemplateAction(BT.k,[BO]);if(BW&&BW.actions){var BX=false,BV=[],BU;A3.forEach(BC.getCtxtDragData().items,function(BZ){BU=(BZ.t===AB&&BZ.id!==E);BX=BU||BX;if(BU){BV.push(BZ);}});if(BX){BW.actions.push(BT.model.getValuesDefaultFormatGridZoneAction(BV,true));}}BY.push(BW);BT.submitUndoRedoActionsWithCallback(BY,BC.callback);},BB=function(){var BU=BC.actions||[];BT.submitUndoRedoActionsWithCallback(BU,BC.callback);};var BR=BD.xtab.zonesModel;if(BM===2){BR.checkAndWarnLargeItemsForAddUnits([BG],BA,BB,true);return this._super(BC);}else{BR.checkAndWarnForOutlineAddUnits([BG],BM,BA);return this._super(BC);}if(BE.src===z.ALL_OBJECT_LIST){var BF=BC.src.widget,BL=BF&&BF.dataProvider;if(BL){BL.loadObjects([BG],{success:BA});}}else{BA();}}}else{if(BE.dsid){this.zonesModel.addUnitsFromDataSource(BE.items,BE.dsid,BC.actions,BC.callback);}}this._super(BC);},cleanUpAfterTarget:function Al(BB){this._super(BB);var BA=BB.getCtxtDropData().cue;if(BA){this.closePopup();BA.destroy();}this.ignoreHover=false;},getFormatMenuItemTarget:Ao,getFormatTargetFromCell:function M(BA){return Ao({info:this.model.getCellTitleInfo(BA),isMetricHeader:BA&&BA.mix!==undefined&&!!BA._e});},highlightFormatTarget:function AW(BE,BA){var BD=mstrmojo.vi.ui.rw.SelectionType,BC=BD.METRIC_VALUES,BB=!!(this.hasAssociatedNodes()&&this.getSelections()),BF=(this.highlights||[]).slice();if(BE===Ar){BC=BD.COL_HEADERS;}else{if(BE===Ac){BC=BD.ROW_HEADERS;}}this.highlightRange(BC,BB,BA);return BB?BF:null;},highlightNumberFormatTarget:function Aw(BA){var BB=(this.highlights||[]).slice();if(BA&&BA.did){this.highlightCellsById(BA.did,BA.t);}else{if(BA&&BA._e){this.highlightCellsById(BA._e.id,12,true);}}return BB;},restoreHighlights:function AI(BA){if(BA){this.clearHighlights();this.highlightCells(BA);}else{this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}},onclick:function AQ(BB){this._super(BB);var BC=this.selCells,BA=this.parent;if(AS.isPrimaryMouseBtn(BB.e)&&!BB.ctrlKey&&!BB.shiftKey&&!BB.metaKey&&(this.model.docModel.getLatestSelectedViUnitKey()===this.k)){var BD=this.getCellForNode(BB.getTarget());if(BD){var BE=this.getFormatTargetFromCell(BD);if(BE){BB.e.ptvSelected=true;if(this.edtModel){this.edtModel.selectTargetByValue(BE);}}}}if(BC&&BC.length&&BA&&BA.displayVisFilterIndicator){BA.displayVisFilterIndicator();}},editDerivedAttribute:function J(BD){var BA=this.model.docModel,BC=this.getDerivedAttribute(BD.id),BB;if(BC){BB={dsid:BC.dsid,did:BD.id,n:BD.n,alias:BD.n,forms:BC.fs,datasets:BA.datasets};this.controller.openDAE(this,BB,mstrmojo.emptyFn,null);}},newDerivedAttribute:function w(BE){var BA=this.model.docModel,BD=this,BB={forceRefresh:true,alias:"New Attribute",datasets:BA.datasets,precreate:function BC(BF){BF=a.copy({act:"addDAToTemplate",nodeKey:BD.k,treeType:BD.defn.tt,axis:BE.axis},BF);if(BE.ui!==undefined){BF.pos=BE.ui+2;}return BF;}};this.controller.openDAE(this,BB,mstrmojo.emptyFn,null);},newDynamicLinkAttr:function AU(BG){var BB=this.model.docModel,BF=this,BD={forceRefresh:true,alias:"New Link",datasets:BB.datasets,precreate:function BE(BH){BH=a.copy({act:"addDAToTemplate",nodeKey:BF.k,treeType:BF.defn.tt,axis:BG.axis},BH);if(BG.ui!==undefined){BH.pos=BG.ui+2;}return BH;}};var BC=function BC(BH){return BH.did===BG.id;};var BA=BB.getDatasetUnits(["att"],BC)[0]||null;this.controller.openDynamicLinkEditor(this,BD,mstrmojo.emptyFn,BA);},getDerivedAttribute:function AY(BD){var BB=this.model.docModel,BA=BB.datasets,BC=null;a.forEach(BA,function(BG,BF){var BE=A3.find(BG.att,"did",BD);if(BE>=0&&BG.att[BE].da){BC=BG.att[BE];BC.dsid=BF;return false;}});return BC;},isStatusBarPositioned:true,doSelection:function X(BC,BA,BD){var BB=mstrmojo._HasMarkup.newDomEvent("click",BA,BC);BB.getTarget=function(){return BD;};this.onclick(BB);},selectSiblings:function Ah(BA){return !(!(this.selectorControl||A.call(this))||this.isSelectAllCell(BA));},onNDECreated:function(){this.clearSelections();this.clearSelectionsCache();},getOnSubtotalsChangeFn:function(BA,BB,BC){return function(){var BG=BA.contents.getSubtotalTypes(),BF=this.model,BH=BG[0],BE=BG[1],BI=[];if(BF.data.gsi.hidesb){if(BB.ast){BE=BB.ast.map(function(BJ){return BJ.t;});BE=A3.filter(BE,function(BJ){return A3.indexOf(BH,BJ)===-1;});}BI.push(BF.getShowDefinedSubtotalsAction());}BI.push(BF.getShowTotalsUnitAction(BB.id,BB.otp,BH,BE));if(!BB.ast&&BH.length>0){var BD=BF.getMoveSubTotalAction(BB,undefined,this.key);if(BD){BI.push(BD);}}this.controller.submitUndoRedoTemplateUpdates(this,BI,BC);}.bind(this);},onPageRendered:function Ap(BC,BA,BB,BD,BE){if(this._super){this._super(BC,BA,BB,BD);}if(!BE){this.updateScrollbars();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.Xtab","mstrmojo.vi.ui._CustomSortXtabCellHoverMgr","mstrmojo.vi.ui.rw.CustomSortAvatar");mstrmojo.requiresClsP("mstrmojo","array","dom","css");var K=mstrmojo.array,G=mstrmojo.dom,L=mstrmojo.hash,W=mstrmojo.css;function I(b,a,c,Z){var Y=this.getCellForNode(b),d=a&&this.getCellForNode(a);return{e:Y._e.id,rele:d&&d._e&&d._e.id,before:c,flag:Z?1:0};}mstrmojo.vi.ui.rw.CustomSortXtab=mstrmojo.declare(mstrmojo.vi.ui.rw.Xtab,null,{scriptClass:"mstrmojo.vi.ui.rw.CustomSortXtab",cssClass:"mstrmojo-CustomSortXtab",cellHoverMgr:"mstrmojo.vi.ui._CustomSortXtabCellHoverMgr",isCustomSort:true,selCells:null,appliedSortActions:null,cachedSortActions:null,init:function R(Y){this.appliedSortActions=[];this.cachedSortActions=[];this._super(Y);},getAppliedSortActions:function U(){return L.clone(this.appliedSortActions);},getAllSortActions:function V(){var Y=L.clone(this.appliedSortActions),Z=L.clone(this.cachedSortActions);return Y.concat(Z);},scrolled:function C(){var Y=this.scrollboxNode,Z=this.zone&&this.zone.domNode;if(Y&&Z){return G.position(Y).y!==G.position(Z).y;}},validCustomSortTgtRow:function J(Z){var a=G.findAncestorByName(this.selCells&&this.selCells[0],"tr",true,this.zone.tableNode),Y=Z&&Z.rowIndex,b=a&&a.rowIndex;if(Y===undefined||b===undefined){return false;}return !(Y===0&&this.scrolled()||b===Y||b===Y+1);},getRelElementInfo:function E(f){var d,e;if(G.checkTagName(f,"td")){var c=G.findAncestorByName(f,"tr"),a=G.findAncestorByName(c,"table"),Z=c.rowIndex===0,b=c.rowIndex===a.rows.length-1,Y=this.getCellForNode(f);if(Z){d=false;}else{if(b){d=true;}else{d=Y.hcd&&!Y.epd;}}if(Z||b){e=null;}else{e=d?a.getElementsByTagName("tr")[c.rowIndex+1].cells[f.cellIndex]:f;}}return{before:d,relEle:e};},getActionMgr:function H(){var Z=this.getCSDisplayPanel(),Y=Z&&Z.actionMgr;return Y;},getCSDisplayPanel:function Q(){return this.parent.parent.parent;},delegateToActionMgr:function A(Z,d,b,a){var c=this.getActionMgr(),Y=c.wrapUnsilentAction(K.ensureArray(Z),d,b,a);c.execute(Y);},onclick:function X(h){var c=h.getTarget&&h.getTarget(),d=h.e,b=d.button===2||G.isMac()&&G.ctrlKey(h.hWin,d)&&d.button===0;if(!c||b){return ;}var g=this.isSorting(),Z=G.checkTagName(c,"td")?c:G.findAncestorByName(c,"td");if(c.hasAttribute("rabtn")&&!g){this._super(h);}else{if(Z&&Z.classList.contains("xtab-td")){var j=this.selCells||[],a=G.findAncestorByName(Z,"tr"),f=this;if(g){if(this.validCustomSortTgtRow(a)){K.forEach(j,function(k){f.handleSelection({},null,k);f.clearHighlights();var l=f.getRelElementInfo(Z),n=f.getActionMgr(),m=I.call(f,k,l.relEle,l.before,0),e=n.wrapCustomSortAction(m,k,l.relEle);n.execute(e);});this.cellHoverMgr.toggleCueDisplay(false);this.toggleSortingStatus(false);}}else{if(a.rowIndex>0){this.resetRAcellsHighlight();this.handleSelection(h.e,h.hWin,Z);var Y=[];K.forEach(a&&a.children,function(e){if(G.checkTagName(e,"td")){Y.push(e);}});this.highlightCells(Y);this.toggleSortingStatus(true,Z);}}}}},isSorting:function N(){return(this.selCells||[]).length>0;},cancelSortingSelection:function S(){var Y=this.selCells||[],Z=this;K.forEach(Y,function(a){Z.handleSelection({},null,a);Z.clearHighlights();});this.cellHoverMgr.toggleCueDisplay(false);this.toggleSortingStatus(false);},handleSelection:function O(d,Y,c){var f=G.findAncestorByName(c,"td",true,this.viewport);if(f){var b="xtabSel",Z=K.filter(this.selCells,function(e){return e!==f;}),a=Z.length<(this.selCells||[]).length;W.toggleClass(f,b,!a);if(a){this.selCells=Z;}else{this.selCells=this.selCells||[];this.selCells.push(f);}}},toggleSortingStatus:function D(Z,Y){this.toggleSortingClass(Z);this.toggleAvatar(Z,Y);},toggleSortingClass:function F(Y){W.toggleClass(this.domNode,"sorting",Y);},toggleAvatar:function B(b,Z){var a=this.csAvatar,c=this;if(b){if(!a){a=this.csAvatar=new mstrmojo.vi.ui.rw.CustomSortAvatar({zIndex:30,onclick:function(j){var k=j.getTarget&&j.getTarget(),l=k&&k.classList;if(l.contains("icon")&&l.contains("close")){c.cancelSortingSelection();this.close();}}});this.addDisposable(a);}var f=this.getCellForNode(Z),h=G.position(this.parent.domNode),d=G.position(this.zone.tableNode),e=h.y+14,Y=d.x+d.w+14,g=168;if(Y+g>h.x+h.w){Y=h.x+h.w-g;}a.open(null,{text:f.v||(f._e&&f._e.n),top:e+"px",left:Y+"px"});}else{if(a){a.close();}}},getCallbackForRACollapseExpand:function M(Z){var Y=this.getCSDisplayPanel();return{success:function(){Y.getVizBox().boxContent.highlightRAcells(Z,true);}};},highlightGroupCells:function P(b,Z){if(this.getActionMgr().getContSlientActionsBefore().length>0){var a=this.zone.tableNode,c=[],Y=[];K.forEach(b,function(d){c=c.concat(K.map(d,function(e){return e._ei;}));});if(c.length>0){K.forEach(a.getElementsByTagName("td"),function(e){var d=parseInt(e.getAttribute("ei"),10);if(c.indexOf(d)>-1){Y.push(e);if(Y.length===c.length){return false;}}});}this.highlights=this.highlights.concat(Y);K.forEach(Y,function(e,m){var d=mstrmojo.vi.ui.rw._XtabHighlights.GROUP_BORDER_CSS,h=[d.cssClass],j=a.getElementsByTagName("tr"),l=e.parentElement.rowIndex,k=e.cellIndex,f=Y[m-1]&&Y[m-1]===(j[l-1]&&j[l-1].cells[k]),g=Y[m+1]&&Y[m+1]===(j[l+1]&&j[l+1].cells[k]);if(f){if(g){h.push(d.midVert);}else{h.push(d.bottom);}}else{if(g){h.push(d.top);}}W.addClass(e,h);});}else{return this._super(b,Z);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.func","mstrmojo.hash","mstrmojo.array","mstrmojo.ToolSeparator","mstrmojo.CheckBox","mstrmojo.Label","mstrmojo.Dialog","mstrmojo.Button","mstrmojo.fe._HasFilterEditor","mstrmojo.fe.FilterUtils","mstrmojo.vi.ui.editors.SQLCSIViewer","mstrmojo.ui.menus.MenuConfig","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.ui.VizBoxTitleBar","mstrmojo.vi.ui.ViewDataDialog","mstrmojo.vi.ui.VisAsFilterInlineDialog","mstrmojo.vi.ui.rw.UnitContainer","mstrmojo.vi.ui.editors.VisAsFilterDialog","mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.vi.ui.VizGalleryList","mstrmojo.EnumRWUnitType","mstrmojo.vi.viz.KnownVisualizations","mstrmojo.vi.viz.EnumWidgetTypes","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.enums.EnumFilterClearActionType");mstrmojo.requiresDescs(2827,5282,6985,9126,11671,11672,13402,13528,14389,14810,15076,15123,15621);var AT=mstrmojo.css,AA=mstrmojo.dom,c=mstrmojo.func,O=mstrmojo.hash,K=mstrmojo.array,AF=mstrmojo.EnumRWUnitType,AQ=mstrmojo.vi.viz.KnownVisualizations,AR=mstrmojo.fe.FilterUtils.isExprEmpty,S=mstrmojo.fe.FilterUtils.getExprText,AP=mstrmojo.vi.models.EnumDragSources,u="px",AM=0,AS=2,M=mstrmojo.vi.models.VIComponentMap.TYPES,F=mstrmojo.vi.enums.EnumFilterClearActionType;var a=mstrmojo;var r="invalid",l="hasViewFilter",Ab="hasSelector",v="visible",V="mouse-left";var AV=3,z=4;var t="web-export-to-pdf-privilege",AJ="web-export-to-excel-privilege",Q="web-export-to-csv-privilege";var k=4;function N(Ac){mstrApp.onerror(Ac);}function f(Ae){var Ad=this.model,Ah=this,Ai=mstrApp.isWSStyling,Ac=[{n:mstrmojo.desc(11670,"Copy to"),toLayoutTitle:mstrmojo.desc(13933,"Copy to #"),toNewLayoutTitle:mstrmojo.desc(13934,"Copy to a New Sheet"),crossLayoutMessage:mstrmojo.desc(12137,"Copying will clear all filters from the new visualization. Do you want to continue?"),cls:"",fn:function Ag(Aj,Al,Am,Ak){Ad.copyVisualization(Aj,Al,Am,Ak);}},{n:mstrmojo.desc(10461,"Move to"),toLayoutTitle:mstrmojo.desc(13935,"Move to #"),toNewLayoutTitle:mstrmojo.desc(13936,"Move to a New Sheet"),crossLayoutMessage:mstrmojo.desc(13937,"Moving will clear all filters from the new visualization. Do you want to continue?"),cls:"",fn:function Ag(Aj,Am,An,Al){var Ak=Ad.getVizContentPanel();Ak.restoreAnyMaxedVizBox();Ad.moveVisualization(Aj,Am,An,Al);}}],Af=function Af(Al,Ak,Aj){return function(){mstrmojo.warn(Ak,{confirmBtn:{fn:Aj}},{title:Al});};};Ac.forEach(function(Aj){Ae.addPopupMenuItem(Aj.n,null,function(){var Ap=Aj.fn,Al=new mstrmojo.ui.menus.MenuConfig(),Am=Ah.boxContent.builder.getLayoutVIMap(Ad.getCurrentLayoutKey()).getComponent(M.VIZ_CONTENT),Ak=Ad.getCurrentLayoutKey(),An=Am.panels.filter(function(Aq){return Aq.k!==Am.selectedKey;}),Ao=Ad.defn.layouts.filter(function(Aq){return Aq.k!==Ak;});An.forEach(function(Aq){var Ar=Aq.k;Al.addMenuItem(Aq.titleText,"",function(){Ap(Ah,Am,Ar,Ak);});});Al.addMenuItem(Ai?mstrmojo.desc(6985,"New Page"):mstrmojo.desc(11671,"New Panel"),"",function(){Ap(Ah,Am,null,Ak);});Al.addSeparator();Ao.forEach(function(Aq){Al.addMenuItem(Aq.title,"",Af(Aj.toLayoutTitle.replace("#",Aq.title),Aj.crossLayoutMessage,function(){Ap(Ah,Am,null,Aq.k);}));});Al.addMenuItem(Ai?mstrmojo.desc(14810,"New Chapter"):mstrmojo.desc(11672,"New Sheet"),"",Af(Aj.toNewLayoutTitle,Aj.crossLayoutMessage,function(){Ap(Ah,Am,null,null);}));return Al;},Aj.cls);});}function H(){AT.toggleClass(this.domNode,Ab,!!(this.selectorMenuCfg));AT.toggleClass(this.domNode,l,!!(this.filterMenuCfg));AT.toggleClass(this.filterBtnNode,r,!(this.filterMenuCfg));AT.toggleClass(this.selectorBtnNode,r,!(this.selectorMenuCfg));var Ad=this.parent,Ac=!!(Ad&&Ad.hasMultipleChildren&&Ad.hasMultipleChildren()&&!mstrApp.isAppStateSelection());AT.toggleClass(this.maxRestoreBtnNode,r,!Ac);AT.toggleClass(this.maxRestoreBtnNode,"restore",this.isMaxed);}function j(Ac){AT.toggleClass(this.filterBtnNode,v,Ac);AT.toggleClass(this.filterBtnNode,V,!Ac);AT.toggleClass(this.selectorBtnNode,v,Ac);AT.toggleClass(this.selectorBtnNode,V,!Ac);AT.toggleClass(this.maxRestoreBtnNode,v,Ac);AT.toggleClass(this.maxRestoreBtnNode,V,!Ac);}function d(Ac){return{scriptClass:"mstrmojo.vi.ui.VisAsFilterInlineDialog",vis:Ac,tocPanel:mstrApp.rootCtrl.view.tocPanel,shouldNavigate:true};}function P(){this.selectorMenuCfg=null;if(mstrApp.isAppStateSelection()){return ;}var Ak=this,Ag=Ak.model,Al=this.boxContent,Ae=Al.model,Ah,Ac=function(Am,An){return Al[Am]&&Al[Am](An);},Aj=Al.selectorControl||Ac("findSelectorControl"),Ad=Ac("isLinkedFilter"),Af=function(){mstrApp.rootCtrl.view.openInlineDialog(d(Ak));},Ai=function(){var Aq={},Ap=Ac("getAssociatedNodes")||[],Ar=Al.getFilterType(),Ao=Al.isVisMap,An=Ac("getAllLayerKeys",true),Am=Ae.getSelectorControlMapInfo&&Ae.getSelectorControlMapInfo();K.forEach(Ap,function(As){if(Ao){K.forEach(An,function(At){Aq[At]={c:true,v:false,ft:Ar,cgbs:Am,k:At};});}else{Aq[As.k]={c:true,v:false,ft:Ar,cgbs:Am,k:As.k};}});Ag.setVisAsFilter(Ak,{sc:Aj,targetKeys:Aq});};if(Ad&&!mstrApp.isAppStatePresentation()){Ah=this.addDisposable(new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-viz-fe-menu",isHostedWithin:false,useTooltip:true}));Ah.addMenuItem(mstrmojo.desc(15069,"Edit Targets..."),"",Af);Ah.addMenuItem(mstrmojo.desc(11473,"Clear All Targets"),"",Ai);}this.selectorMenuCfg=Ah;}function A(){this.filterMenuCfg=null;if(mstrApp.isInVFInteractMode||mstrApp.isAppStateSelection()){return ;}var A4=mstrmojo.desc(2827,"Clear"),Aq=this.boxContent,A2=Aq.model,Au=this.k,As=this,BC=Aq.controller,Az=Aq.node,BF=Az.data||null,Av=function(BH,BK,BJ){var BI=As.boxContent;return BI&&BI[BH]&&BI[BH](BK,BJ);},A6=mstrmojo.desc(5283,"OR"),Ap=mstrmojo.desc(5282,"AND"),BG=Av("makeBold",A6),Aw=Av("makeBold",Ap);if(!BF){this.filterMenuCfg=null;return ;}var A9=BF.vfexpr,Ah,Aj=BF.vlexpr,Ao=Av("getSelectorObjectsFromTemplateLimit"),At,Am=Av("hasKeepOnly",Ao),Ad=this.model,Al,Ac;Ah=Ad.getVfNdFromExpr(A9);Al=!AR(Ah);Ac=Ah!==A9;var Ag=this.model,An=Ag.getCurrentLayoutKey(),Ay=(Ag.defn.layouts).filter(function(BH){return BH.k===An;})[0],BD=Ay.cgbMap||{},A5=O.keyarray(BD).filter(function(BH){return BD[BH]===As.k;}),A8,Ae,BA,BB,A0=[],Ax,Ak;function Ai(BJ){var BL=" "+(BJ?BG:A6)+" ",BK=" "+(BJ?Aw:Ap)+" ",BI=Ae.fn===20?BL:Ae.fn===19?BK:"",BH=[A4+' "'];BB=A2.getSelectorDataFromViewFilter(Ae);K.forEach(BB,function(BM){Ak=Av("getLinkingSelectorExpr",BM,BJ);if(BH.length>1){Ak=BI+Ak;}BH.push(Ak);});BH.push('"');return BH.join("");}if(A5.length){K.forEach(A5,function(BH){A8=Ag.getLayoutUnitDefn(BH);Ae=A8&&A8.t&&A8.t===AF.UNITCONTAINER&&A8.exp;if(Ae){BA=A8.latestctlkey;if((K.filterOne(Ay.units[BH].scs,function(BI){return BI.ckey===BA;})||{}).isNavigation){A0.push({menuString:Ai(),menuTtpString:Ai(true),ucKey:BH,ckey:BA});}}});}Ax=A0.length;if(Am||Aj||Al||Ax||Ac){var A3=function A3(BH){var BJ=c.wrapMethods(BC._getXtabCallback(Aq),{success:function BI(){var BK=As.boxContent;if(BK){BK.raiseEvent({name:"regenerateToolbar"});}}});if(Ax){BJ=c.wrapMethods({success:function BI(BL){var BM=As.boxContent,BK=A5;if(BM.getSdpKeyArr){BK=A5.concat(BM.getSdpKeyArr());}Ag.partialUpdate(BL.data,Ag.getUnitDefinitions(BK),BL.defn,A5,BL.puFilters);}},BJ);}if(Aq.filterMenuHandler){Aq.filterMenuHandler(BH.ctxt,BJ);}};At=this.addDisposable(new mstrmojo.ui.menus.MenuConfig({menuCssClass:"mstrmojo-viz-fe-menu",isHostedWithin:false,useTooltip:true}));if(!mstrApp.isDossier&&(Am||Ax||Ac)){At.addMenuItem(mstrmojo.desc(1763,"Clear All"),"",A3,{type:F.CLEAR_ALL});}if(Am){if(At.hasMenuItems()){At.addSeparator();}var Ar=Av("getFilterMenuPairs",Ao)||[];K.forEach(Ar,function(BH){At.addMenuItem({n:BH.menuString,ttp:BH.menuTtpString},"",A3,{type:F.CLEAR_KEEP_ONLY,idx:BH.ctxt});});}if(Ac){if(At.hasMenuItems()){At.addSeparator();}At.addMenuItem({n:mstrmojo.desc(15076,"Clear drill conditions"),ttp:S(Ad.getVfexprWithUpdatedVf(Au,null),true)},"",A3,{type:F.CLEAR_DRILLING});}if(Al||Aj){if(At.hasMenuItems()){At.addSeparator();}var A7;var A1=[];var BE=S(Ah,true),Af=S(Aj,true);if(BE){A1.push(BE);}if(Af){A1.push(Af);}A1=A1.join(" "+Aw+" ");if(mstrApp.isWSStyling&&mstrApp.isAppStateDefault()){A7={n:mstrmojo.desc(14016,"Advanced Qualification")};At.addMenuItem(A7,"",function(){As.onShowFilterEditor(As);});}else{if(!(mstrApp.isDossier||(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation()))){A7={n:mstrApp.isWSStyling?mstrmojo.desc(15123,"Clear advanced qualification"):mstrmojo.desc(13528,"Clear existing filter"),ttp:A1||BF.vftext};At.addMenuItem(A7,"",A3,{type:F.CLEAR_ADV_QUALIFICATION});}}}if(Ax){At.addSeparator();K.forEach(A0,function(BH){At.addMenuItem({n:BH.menuString,ttp:BH.menuTtpString},"",A3,{type:F.CLEAR_LINKING,nodeKey:BH.ucKey,ckey:BH.ckey});});}}this.filterMenuCfg=At&&(At.hasMenuItems()?At:null);}function AX(Ac){var Ad=mstrApp.isWorkstation&&mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode();return(Ac===AQ.GRID&&!Ad&&(!!mstrApp.features[AJ]||!!mstrApp.isSingleTier));}function W(Ac){return([AQ.UNKNOWN].indexOf(Ac)===-1&&(!!mstrApp.features[t]||!!mstrApp.isSingleTier));}function L(){return !!mstrApp.features[Q]||!!mstrApp.isSingleTier;}function AI(){var Ac=AQ.getDefinition(this.boxContent.model.data.visName||"Grid").id;return !(mstrApp&&mstrApp.isVisBuilder)&&(AX(Ac)||W(Ac)||L());}function AY(Ac){var Af=this.model.controller.id,Ae=this.boxContent,Ad=Ae.k;var Ag=!O.walk("gridInfo.cols.length",Ae)&&!O.walk("gridInfo.rows.length",Ae),Ah=mstrmojo.desc(246,"Export");if(Ag){Ac.addNonInteractiveMenuItem(Ah,null,true);}else{Ac.addPopupMenuItem(Ah,this.id,function(){var Aj=new mstrmojo.ui.menus.MenuConfig(),Ai=AQ.getDefinition(this.boxContent.model.data.visName||"Grid").id;if(AX(Ai)){Aj.addMenuItem(mstrmojo.desc(3958,"Excel"),"exportToExcel",function(){mstrmojo.all[Af].exportVisualization(Ae,z);});}if(W(Ai)){Aj.addMenuItem(mstrmojo.desc(1877,"PDF"),"exportToPDF",function(){if(Ae.isClientExport&&Ae.exportVisualization){Ae.exportVisualization(AV);}else{mstrmojo.all[Af].exportVisualization(Ae,AV);}});}if(L()){Aj.addMenuItem(mstrmojo.desc(11807,"Data"),"exportToCSV",function(){mstrmojo.all[Af].exportCSV(Ad);});}return Aj;},"export");}}function h(Ad){var Ae=this.boxContent,Ac=(Ae.getDocModel&&Ae.getDocModel())||Ae.model.docModel;Ad.addPopupMenuItem(mstrmojo.desc(13165,"Change Visualization"),this.id,function(){var Ah=new a.ui.menus.MenuConfig({supportsScroll:true,maxHeight:AA.windowDim().h-50}),Ai=Ac.getVizOfSelectedViUnit(),Af=Ae.controller.galleryPanel,Aj=Af.vizList,Ak=Aj.items.length>0,Al=Af.customVizList;function Ag(Am,An){if(Am.id!=="VisGrid"&&a.ExpressVisList.getVis(Am.s)===null){return ;}Ah.addMenuItem(Am.n,Am.id===(Ai&&Ai.id)?"on":"",function(){var Ao=K.find(An.items,"id",Am.id);An.select([Ao]);});}Ah.hasToggleItem=true;if(Ak){Ah.addMenuTitle(mstrmojo.desc(14119,"Built-in"));Aj.items.forEach(function(Am){Ag(Am,Aj);});}if(Al.items.length>0){if(Ak){Ah.addSeparator();}Ah.addMenuTitle(mstrmojo.desc(2056,"Custom"));Al.items.forEach(function(Am){Ag(Am,Al);});}return Ah;},"");}function AK(Ac,Ae){var Ad=Ac.getCtxtDragData();this.getZonesModel().addUnitsFromDataSource(Ad.items,Ad.dsid,Ac.actions,Ae?Ac.callback:null);}function AW(){var Ae=this.parent,Ac=this.boxContent,Ad=false;if(Ac.handlesMultiSelection){if(mstrApp.isWSStyling){if(this.getDocModel().getVisibleUnitKeysByType([AF.GRID,AF.GRAPH,AF.MOJOVISUALIZATION]).length>1){Ad=true;}}else{if(Ae&&Ae.getTargetKeysByType([AF.GRID,AF.GRAPH,AF.MOJOVISUALIZATION]).length>1){Ad=true;}}}return Ad;}function AL(Ad,Ac,Af){var Ag=this.id;Ad=document.createElement("div");Ad.className=Ac;var Ae=function(){var Ak=mstrmojo.all[Ag],Ai=Ak[Af];Ai.hostId=Ag;Ai.hostElement=Ad;if(Ai.hasMenuItems()){var Al=new mstrmojo.ui.menus.Menu({popupConfig:Ai,getTooltipText:function Ah(Am){return(Am&&Am.ttp)||"";}});Al.tooltipCss={enableHover:true,leftCssClass:"menuTooltip mstrmojo-VIBox",rightCssClass:"menuTooltip mstrmojo-VIBox",updatePosition:function Aj(){mstrmojo.Tooltip.prototype.updatePosition.call(this);var Au=this.domNode,Ar=this.arrowNode,As=Au.getBoundingClientRect(),Am=As.top,Ao=Math.max(document.documentElement.clientHeight,window.innerHeight||0),At=Al._getItemNode(Al._lastHoverIx),Aq=(At&&At.getBoundingClientRect())||{},An=As.top+this.containerNode.offsetHeight,Ap=An+10-Ao;if(Ap>0){Au.style.top=(Am=As.top-Ap)+"px";}if(Aq&&Aq.top){Ar.style.top=Aq.top-Am+6+"px";}}};Ak.openPopup(Al);}};AA.attachEvent(Ad,"click",Ae);this.domNode.appendChild(Ad);this.installedEvtListeners.push({e:Ad,evt:"click",fn:Ae});return Ad;}function n(Ac){var Ae=this.id;Ac=document.createElement("div");Ac.className="hover-max-restore-btn";var Ad=function(){var Af=mstrmojo.all[Ae],Ag=Af.isMaxed;Af.parent.setPortalState(Af,Ag?AM:AS);if(Ag){delete Af.isMaxed;}else{Af.isMaxed=true;}AT.toggleClass(Ac,"restore",Af.isMaxed);};AA.attachEvent(Ac,"click",Ad);this.domNode.appendChild(Ac);this.installedEvtListeners.push({e:Ac,evt:"click",fn:Ad});return Ac;}mstrmojo.vi.ui.rw.VizBox=mstrmojo.declare(mstrmojo.vi.ui.rw.UnitContainer,[mstrmojo.vi.ui._CanDropFromSchema,mstrmojo.fe._HasFilterEditor],{scriptClass:"mstrmojo.vi.ui.rw.VizBox",filterEditorScriptClass:"mstrmojo.vi.ui.editors.FilterEditor",showTitleBar:true,titleBar:null,selectorMenuCfg:null,selectorBtnNode:null,filterMenuCfg:null,filterBtnNode:null,maxRestoreBtnNode:null,generateToolbarSub:null,init:function AC(Ac){this._super(Ac);AT.addWidgetCssClass(this,"mstrmojo-VIBox");this.isMaxed=(this.defn.ds===AS);this.installedEvtListeners=[];},unrender:function(Ac){K.forEach(this.installedEvtListeners,function(Ad){AA.detachEvent(Ad.e,Ad.evt,Ad.fn);});this.installedEvtListeners=[];delete this.filterBtnNode;delete this.selectorBtnNode;delete this.maxRestoreBtnNode;this._super(Ac);},getPanelForAddAction:function AO(){return"editPanel";},getExcludedPanels:function AU(){return[];},getDocModel:function E(){var Ac=this.model;return Ac.docModel||Ac;},editingTitleCallback:function C(Ac){this._super(Ac);AT.toggleClass(this.filterBtnNode,"editing-title",Ac);AT.toggleClass(this.selectorBtnNode,"editing-title",Ac);AT.toggleClass(this.maxRestoreBtnNode,"editing-title",Ac);},getTitleBarCfg:function w(){var Ac=this._super();Ac.scriptClass="mstrmojo.vi.ui.VizBoxTitleBar";Ac.close=function Af(){var Ah=this.parent,Ag=Ah.parent;Ag.deleteBoxAndSubmit(Ah);Ag.removeChildren(Ah);Ah.destroy();};Ac.beganEditingTitlebar=function Ae(){var Ag=this.parent;Ag.draggable=false;Ag.editingTitleCallback(true);};Ac.titleEdited=function Ad(Ah,Al,Ag){var Ak=this.parent;Ak.draggable=true;if(Al){var Aj=Ak.getDocModel();Aj.renameRWUnitTitle(Ah,this.title,Ak.k,{success:function Am(An){Ak.defn.ttl=An;Ak.set("title",An);},failure:function Ai(An){N(An);Ak.titleBar.set("title",Ag);}});}Ak.editingTitleCallback(false);};return Ac;},getTitleVisibilityFmts:function R(Ad){var Ac=this._super(Ad);Ac.FormattingView.ShowWidgetTitleBar=Ad;return Ac;},onclick:function x(){this.model.setVizBoxActive(this.id);this.titleBar.onclick();},switchPropertyOnClick:function AD(Ac){var Ad=this.boxContent;if(!Ad||!Ad.supportsEditorClickSwitching||Ac.e.justSwitched){return false;}return this._super();},postBuildRendering:function AZ(){try{this._super();this.selectorBtnNode=AL.call(this,this.selectorBtnNode,"hover-selector-btn","selectorMenuCfg");this.filterBtnNode=AL.call(this,this.filterBtnNode,"hover-filter-btn","filterMenuCfg");if(this.defn.ds===AS){this.parent.setPortalState(this,AS,true);}this.maxRestoreBtnNode=n.call(this,this.maxRestoreBtnNode);H.call(this);if(this.menuBtnInfo&&this.menuBtnInfo.btn){AA.attachEvent(this.menuBtnInfo.btn,"mousedown",function(){this.generateToolbar();}.bind(this));}var Ad=this;this.getDocModel().attachEventListener("vizBoxActive",Ad.id,function(Ag){j.call(Ad,Ad.id===Ag.id);var Ah=Ad.menuBtnInfo;if(Ah&&Ah.menuCfg){AT.toggleClass(Ah.btn,v,Ad.id===Ag.id);AT.toggleClass(Ah.btn,V,Ad.id!==Ag.id);}if(Ad.id===Ag.id){Ad.selectVIUnit();}});this.getDocModel().attachEventListener("visActive",Ad.id,function(Ag){if(Ad.boxContent&&Ad.boxContent.id===Ag.id){this.model.setVizBoxActive(Ad.id);}});}catch(Ae){var Af=this.domNode.appendChild(document.createElement("div"));Af.className="errorNode";Af.innerText=mstrmojo.desc(11461,"There was an error rendering your visualization");this.getZonesModel=function Ac(){return null;};}},doLayout:function s(){var Ac=this.boxContent;if(Ac){Ac.skipReRender=true;}this._super();if(Ac){delete Ac.skipReRender;}},applyBoxSize:function U(Ac,Ae,Ai,Ah){this._super(Ac,Ae,Ai,Ah);var Ag=this.boxContent,Ad=Ag&&Ag.getFormats();if(Ad){var Af=this.titleBar.visible?AA.position(this.titlebarNode).h:0;Ad.height=(parseInt(Ac,10)-Af)+u;Ad.width=Ae;}},updateDisplayName:function p(Ac,Ad){this._super(Ac,Ad,true);},createDeleteUpdate:function g(){var Ag=this.model,Aj=Ag.getDataService().newUpdate(),Ai=this.boxContent.node.k,Ah=this.parent._tgtSelections,Af=Ag.getSourceFilterKeys(Ai,true),Ad=Af.concat(Ag.getTargetFilterKeys(this)),Ae=[],Ac;this.parent.children.forEach(function(Al){var Ak=Al.defn,Am=Ak.tks;if(Am){if((Am||"").split("\u001E").indexOf(Ai)>-1){Aj.addActions(Ag.getDataService().getRemoveCtrlTargetAction(Ak.ck,Ai,undefined,true));if(Al.defn&&Al.defn.srct&&Al.defn.srct===k){Aj.setTreesToRender(3);}}}});if(Ah){Ah.remove(Ai);}if(Ad){Aj.setTreesToRender(3);}Aj.addUpdate(Ag.getRemoveUnitUpdate({unit:this,partialRetrievalKeys:Ad,clearTargets:true}));K.forEach(Af,function(Ak){Ac=Ag.getVisualizationByKey(Ak);if(Ac){Ae.push(Ac);}});Aj.addUpdate(Ag.associatedNodesUpdate(Ae.concat(this.parent.children)));return Aj;},generateToolbar:function B(){var Ah=this.parent,Ad=Ah&&Ah.parent;if(Ad){var Ac=this.model.controller,Af=this.model.getLayoutKeyByUnitKey(Ad.k),Ae=Ac.view.getLayoutByKey(Af),Ag=Ac.view.layoutViewer;if(Ae){if(Ae.k===Ag.k){if(this.generateToolbarSub){Ae.detachEventListener(this.generateToolbarSub);delete this.generateToolbarSub;}}else{if(!this.generateToolbarSub){this.generateToolbarSub=Ae.attachEventListener("generateVizBoxToolbar",this.id,"generateToolbar");}return ;}}}P.call(this);A.call(this);if(this.hasRendered){H.call(this);}this._super();},updateToolbar:function Y(Ai){var Ak=this,An=this.boxContent,Af=this.canShowDesignMenuItems(),Al=An&&An.excludeData,Ah=function(){if(!mstrApp.isDossier&&!mstrApp.isInVFConfigMode&&!Al){Ai.addMenuItem(mstrmojo.desc(11476,"Show Data"),"shwd",function(){mstrmojo.vi.ui.ViewDataDialog.open(mstrmojo.all[Ak.id]);});}},Ae=mstrApp.isAppStatePresentation(),Aj=mstrApp.isLayoutModePreview(),Am=mstrApp.isWSStyling,Ag=Am?mstrmojo.desc(15087,"Select Targets..."):mstrmojo.desc(11958,"Use as Filter...");Ai.supportsScroll=true;Ai.isHostedWithin=false;Ai.maxHeight=AA.getMaxScrollHeight();if(!Ae&&mstrApp.allowWebDashboardDesign()){var Ad=this.model.hasMDXRADataset();h.call(this,Ai);if(An.getContainerMenuItems){An.getContainerMenuItems(Ai);}Ai.addSeparator();var Ac=An.zonesModel;if(Ac&&Ac.canSwapAxis()){Ai.addMenuItem(mstrmojo.desc(11658,"Swap"),"",function(){Ac.swapAxis();});Ai.addSeparator();}if(Ac&&Ac.canDefineSubtotals()){Ai.addToggleMenuItem(mstrmojo.desc(6193,"Show Totals"),"",function(){Ac.showQuickSubtotals();},function(){Ac.hideDefinedSubtotals();},null,Ac.hasVisibleSubtotals());Ai.addSeparator();}if(mstrApp.supportAdvFilter&&!mstrApp.isInVFInteractMode&&!Ad){Ai.addMenuItem(mstrmojo.desc(13402,"Edit Filter..."),"",function(){Ak.onShowFilterEditor(Ak);});}if(!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode){if(AW.call(this)){Ai.addMenuItem(Ag,"uaf",function(){var Ap=mstrmojo.all[Ak.id],Ao=Ak.model&&Ak.model.getVizContentPanel();if(Ao){Ao.restoreAnyMaxedVizBox();}mstrApp.rootCtrl.view.openInlineDialog(d(Ap));});Ai.addSeparator();}}if(!Al){Ai.addMenuItem(mstrmojo.desc(15621,"Query Details..."),"",function(){var Ap=mstrmojo.all.sqlViewer,Aq=Ak.boxContent&&Ak.boxContent.model&&Ak.boxContent.model.data,Ao=Aq&&Aq.csi;if(!Ap){Ap=mstrmojo.insert({id:"sqlViewer",title:mstrmojo.desc(15619,"Query Details"),scriptClass:"mstrmojo.vi.ui.editors.SQLCSIViewer"});}Ap.set("csiText",Ao||"");Ap.open();});}Ah();if(!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode){Ai.addMenuItem(mstrmojo.desc(14389,"Remove Data"),"",function(){Ak.vizRemoveDataHandler(An);});}Ai.addPopupMenuItem(mstrmojo.desc(12949,"Data Source"),this.id,function(){var As=new mstrmojo.ui.menus.MenuConfig(),Aq=Ak.model,Ar=Aq.datasets,Ap=Ak.boxContent.model.data.datasetId||"",Ao=[];O.forEach(Ar,function(At,Au){Ao.push({name:At.name,id:Au});});if(!Ad){Ao.push({name:mstrmojo.desc(5949,"None"),id:""});}Ao.forEach(function(At){var Au=At.id;As.addMenuItem(At.name,Ap===Au?"on":"",function(){var Av=Ak.k,Aw=Au;if(Ap===Au){return ;}An.zonesModel.submitActionForDatasetUpdate({act:"editNode",nodeKey:Av,treeType:Ak.defn.tt,datasetId:Aw||"00000000000000000000000000000000",partialRetrieval:{nodes:[Av]}});});});As.hasToggleItem=true;return As;});Ai.addSeparator();if(AI.call(this)&&!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode&&!Al){AY.call(this,Ai);}if(!Aj&&Af&&!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode&&!mstrApp.isVisBuilder){Ai.addMenuItem(mstrmojo.desc(3397,"Duplicate"),"dup",function(){var Ao=Ak.model&&Ak.model.getVizContentPanel();if(Ao){Ao.restoreAnyMaxedVizBox();}Ak.model.duplicateVisualization(Ak);});f.call(this,Ai);}Ai.addSeparator();if(!mstrApp.isInVFConfigMode){this.addToggleTitleMenuItem(Ai);if(An.addToggleToolbarMenuItem){An.addToggleToolbarMenuItem(Ai);}}}else{Ah();if(AI.call(this)&&!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode){AY.call(this,Ai);}}this._super(Ai);if(!Ae&&mstrApp.allowWebDashboardDesign()&&!mstrApp.isInVFConfigMode&&!mstrApp.isInVFInteractMode){Ai.addSeparator();Ai.addMenuItem(mstrmojo.desc(9126,"More Options...")+"...","",function(){var Ao=Ak.getEditorModel(),Ap=Ao.getHost().model,Ar=Ap&&Ap.data,Aq=(Ar&&Ar.gsi&&Ar.gsi.prop)||{};if(An instanceof mstrmojo.vi.ui.rw.Xtab){Ao.openMoreOptionsEditor(Aq,true,Ar.lhv);}else{Ao.openMoreOptionsEditor(Aq);}});}return Ai;},vizRemoveDataHandler:function X(Ac){if(Ac.scriptClass==="mstrmojo.VisMapBase"){Ac.reset();}else{var Ad=Ac&&Ac.zonesModel;if(Ad&&Ad.docModel){Ad.clearAllDropZones(Ad.docModel.clearVisAsFilterAction(this));}}},addFormatMenuItem:function G(Ag,Af,Ac){var Ae=this.getEditorModel(),Ad=Ae.getFormatToTargetFn&&Ae.getFormatToTargetFn();if(Ad){Ac=Ac?c.composite([Ac,Ad]):Ad;}return this._super(Ag,Af,Ac);},getFormatMenuItemTarget:function e(Ae){var Ac=this.boxContent;if(Ac.getFormatMenuItemTarget){var Ad=Ac.getFormatMenuItemTarget(Ae);if(Ad!==undefined){return Ad;}}return this._super(Ae);},getZonesModel:function AN(){return this.boxContent.zonesModel;},allowDropFromDataset:function AH(Ac){var Ad=this.boxContent;if(Ad&&Ad.allowBoxDropFromDataset){return Ad.allowBoxDropFromDataset(Ac);}return true;},dropFromDataset:function o(Ac){AK.call(this,Ac,false);},dropFromAllObjects:function Z(Ac){this.augmentDropContextForSchema(Ac,this.getZonesModel().docModel);AK.call(this,Ac,true);},isDragValid:function q(Ac){var Ad=this.boxContent;if(Ad.canOnlyDragOnTitleBar){if(!AA.contains(this.titleBar.getLabelNode(),Ac.src.node,true,this.domNode)){return false;}}return this._super(Ac)&&!this.isMaxed;},menuDisplayCallback:function I(Ac){this._super(Ac);j.call(this,Ac);},getAvatarCls:function AG(){return this._super().concat(["viz-avi"]);},ondragenter:function D(Ad){var Ae=this.boxContent,Ac=Ad.getCtxtDragData().src;if(Ae.handleDndForParentNode&&Ae.ondragenter){if(Ac===AP.DATASETS||Ac===AP.VIZ_EDITOR||Ac===AP.VIZ||Ac===AP.ALL_OBJECT_LIST){Ae.ondragenter(Ad);return ;}}this._super(Ad);},ondragleave:function m(Ad){var Ae=this.boxContent,Ac=Ad.getCtxtDragData().src;if(Ae.handleDndForParentNode&&Ae.ondragleave){if(Ac===AP.DATASETS||Ac===AP.VIZ_EDITOR||Ac===AP.VIZ||Ac===AP.ALL_OBJECT_LIST){Ae.ondragleave(Ad);return ;}}this._super(Ad);},setTitleBarVisibility:function b(Ac){this._super(Ac);this.titleBar.onclick();},onmouseenter:function AE(Ac){this._super(Ac);j.call(this,true);},onmouseleave:function Aa(Ac){this._super(Ac);j.call(this,false);},validateTarget:function AB(){return true;},getNodeKeys:function J(){var Ad=this.boxContent,Ac=Ad&&Ad.isVisMap;return(Ac&&Ad.getNodeKeys)?Ad.getNodeKeys():[this.k];}});mstrmojo.vi.ui.rw.VizBox.ENUM_PORTAL_STATE={RESTORE:AM,MAXIMIZE:AS};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.vi.ui.editors.FilterEditor");mstrmojo.requiresDescs(5758,16037);var C=mstrmojo.array,A=mstrmojo.hash,B=mstrmojo.mstr.EnumDSSXMLObjectTypes,E=mstrmojo.mstr.EnumDSSXMLObjectSubTypes;mstrmojo.ME._HasConditionMetricFilterEditor=mstrmojo.provide("mstrmojo.ME._HasConditionMetricFilterEditor",{openConditionMetricFilterEditor:function D(G){var J="cmfe",K,H={},I=G.filter;function F(){C.forEach(G.att,function(N){if(N.t!==B.Attribute||N.da){return ;}var M=N.did,O=N.path;H[M]={did:M,n:N.n,t:N.t,st:N.st,fs:N.fs,da:N.da||false,datasetId:N.datasetId,ttp:N.n+(O?" - "+O:""),dsName:O};});C.forEach(G.mx,function(N){var M=N.did,O=N.path;H[M]={did:M,n:N.n,t:N.t,st:N.st||E.Metric,um:N.um,datasetId:N.datasetId,ttp:N.n+(O?" - "+O:""),dsName:O};});var L={expr:A.clone(I),targets:A.valarray(H)};K=J&&window.mstrmojo&&mstrmojo.all[J];if(!K){K=mstrmojo.insert({id:J,scriptClass:"mstrmojo.vi.ui.editors.FilterEditor",showLimits:false,docModel:G.docModel,title:mstrmojo.desc(11579,"Metric Editor")+" - "+mstrmojo.desc(16037,"Add Filter")});}if(G.zIndex){K.set("zIndex",G.zIndex);}K.set("model",L);K.targetMap=H;K.onSave=G.fnOk;K.onCancel=G.onCancel;K.onUpdateBrowseElementsParams=G.browseParam;K.open();}F();}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.fe.FilterEditor");mstrmojo.vi.ui.editors.ReportFilterEditor=mstrmojo.declare(mstrmojo.vi.ui.editors.FilterEditor,[mstrmojo.fe._isReportFilterEditor],{scriptClass:"mstrmojo.vi.ui.editors.ReportFilterEditor"});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.threshold.ThresholdModel","mstrmojo.threshold.SimpleThresholdEditor","mstrmojo.threshold.AdvancedThresholdEditor");var $HASH=mstrmojo.hash,SIMPLE_THRESHOLD_ID="mstrmojo-simple-threshold-editor",ADVANCED_THRESHOLD_ID="mstrmojo-advanced-threshold-editor",EDITOR_TYPES=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES;mstrmojo.threshold.ThresholdController=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.threshold.ThresholdController",metricId:undefined,data:undefined,model:undefined,targets:undefined,editor:undefined,messageId:undefined,datasets:undefined,dataService:undefined,onSubmitActions:mstrmojo.emptyFn(),onSaveThresholds:mstrmojo.emptyFn(),onLoadThresholds:mstrmojo.emptyFn(),supportsFeature:function supportsFeature(featureId){return true;},init:function init(props){this._super(props);if(!window.numeral){var numeral=mstrmojo.loadFileSync(mstrmojo.getJsRoot()+"libraries/numeral.js.2.0.6/numeral.min.js");function evalInContext(){eval(numeral);}try{evalInContext.call(window);}catch(e){}}this.model=new mstrmojo.threshold.ThresholdModel({controller:this});},openEditor:function openEditor(){var data=this.data;if(!data){throw new Error("Visualization data not provided.");}var metricId=this.metricId,objectType=this.objectType,model=this.model,messageId=this.messageId,editor;model.set("data",$HASH.clone(data));model.metricId=metricId;model.objectType=objectType;var isAdvanced=model.isAdvanced(metricId),forceOpenEditorType=model.editorMode,forceOpenSimpleEditor=forceOpenEditorType===EDITOR_TYPES.SIMPLE_EDITOR;if(forceOpenEditorType===EDITOR_TYPES.ADVANCED_EDITOR||(!forceOpenSimpleEditor&&isAdvanced)){editor=mstrmojo.all[ADVANCED_THRESHOLD_ID]||new mstrmojo.threshold.AdvancedThresholdEditor({id:ADVANCED_THRESHOLD_ID,onUpdateBrowseElementsParams:function onUpdateBrowseElementsParams(params){var datasetId,datasets=this.controller.datasets,findAttrFn=function(attribute){return attribute.did===params.attributeID;};for(datasetId in datasets){if(datasets[datasetId].att.filter(findAttrFn).length>0){params.datasetID=datasetId;break;}}params.messageID=messageId;params.templateNodeKey=data.k;}});}else{if(isAdvanced){model.clearData();}editor=mstrmojo.all[SIMPLE_THRESHOLD_ID]||new mstrmojo.threshold.SimpleThresholdEditor({id:SIMPLE_THRESHOLD_ID});}this.editor=editor;editor.set("model",model);editor.set("controller",this);editor.set("metricId",metricId);editor.set("objectType",objectType);editor.set("title",this.title);editor.set("targets",this.targets);editor.set("allowHTMLTitle",true);editor.open();this.addDisposable([model,editor]);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.DynamicClassFactory","mstrmojo.ListDocSelector","mstrmojo.TextBoxDocSelector","mstrmojo.SearchBoxDocSelector","mstrmojo.MetricQualDocSelector","mstrmojo.MetricSliderDocSelector","mstrmojo.AttrQualDocSelector","mstrmojo.VisDocSelector","mstrmojo.DynamicListDocSelector","mstrmojo._DocActionSelector","mstrmojo._IsThresholdConditionTarget");var B=4,G=12,E=47,I=12033,C=3076;var D={"default":"ListDocSelector",dynamic:"DynamicListDocSelector",7:"MetricSliderDocSelector",8:"MetricQualDocSelector",9:"SearchBoxDocSelector",10:"TextBoxDocSelector",11:"AttrQualDocSelector",12:"VisDocSelector"};function H(J){return J.srct===G&&J.srcst===C||J.srct===E&&J.srcst===I&&J.ndetype===2;}mstrmojo.DocSelectorViewFactory=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DocSelectorViewFactory",getDocSelectorClass:function F(L,O,K,P){var N=O.defn,M=N.style,J=D[M]||D["default"];if(H(N)&&M===B&&N.iifp){J=D.dynamic;}if(O.defn.ct==="4"){return(mstrmojo.DynamicClassFactory.newComponent(mstrmojo[J],[mstrmojo._DocActionSelector,mstrmojo._IsThresholdConditionTarget],{scriptClass:"mstrmojo.DocActionXSelector"}));}return mstrmojo[J];},newDocSelector:function A(K,M,J,O){var N=this.getDocSelectorClass(K,M,J,O),L={id:M.id,node:M,model:K};return new N(L);}});mstrmojo.DocSelectorViewFactory.CLASS_MAP=D;}());(function(){mstrmojo.requiresCls("mstrmojo.DocSelectorViewFactory","mstrmojo.RadioList","mstrmojo.CheckList","mstrmojo.ListBoxHoriz","mstrmojo.ListBoxSelector","mstrmojo.LinkList","mstrmojo.ButtonList","mstrmojo.DropDownList","mstrmojo.Slider","mstrmojo.AttributeSlider","mstrmojo.TextBoxSelector");var E=mstrmojo.DocSelector.STYLES;var F={};F[E.RADIO]=["RadioListHoriz","RadioList"];F[E.CHECKBOX]=["CheckListHoriz","CheckList"];F[E.LIST]=["ListBoxHoriz","ListBoxSelector"];F[E.LINK]=["LinkListHoriz","LinkList"];F[E.BUTTON]=["ButtonListHoriz","ButtonList"];F[E.SCROLLER]="AttributeSlider";F[E.METRIC_SLIDER]="MetricSlider";F[E.METRIC_QUAL]="MetricQualification";F[E.SEARCH_BOX]="SearchBoxSelector";F[E.TEXT_BOX]="TextBoxSelector";var D={_mixinName:"_oivmDocSelector",preBuildRendering:function C(){var Q=this._super(),O=this.style,I=this.children[0],J=this.node,P=J.defn,V=P.horiz,S=this.getFormats(),K,W,U,Y,X=O===E.PULLDOWN;if(P.hm===0&&O!==E.SCROLLER&&O!==E.METRIC_SLIDER){this.contentNodeCssText+="overflow-"+(V?"x":"y")+":hidden;";}if(S){I.color=K=S.color;W=S.height;U=S["background-color"];Y=S["text-decoration"];if(Y){mstrmojo.css.addWidgetCssClass(this,Y);}}if(X){if(S){if(K){this.itemCssText+="color:"+K+";";}}I.cssText=this.itemCssText;}else{I.cellCssClass="";I.tableCssText="table-layout:"+((P.iwm===0)?"fixed":"auto")+";";if(W!==undefined){if(O===E.LIST){if(W.indexOf("px")==W.length-2){var N=parseInt(W.substr(0,W.length-2));if(N>4){N=N-4;}W=N+"px";}}I.cssText="height:"+W+";";}if(O===E.LIST&&U){I.cssText+="background-color:"+U+";";}switch(O){case E.RADIO:case E.CHECKBOX:I.labelCssText=this.itemCssText;break;case E.BUTTON:case E.LINK:case E.LIST:if(O===E.BUTTON){if(K){this.itemCssText+="color:"+K+";";}}if(V){this.itemCssText+="height:"+W+";";}I.itemCssText=this.itemCssText;this["background-color"]=U;break;}}var R=this,M=R.model.getTargetInfoWin(P.tks),L=(X&&I.list)?I.list:I;if(P.ifw||(M&&M.length)){L.makeSelection=function(Z){R.showInfoWin(Z&&Z.selItem);};if(L.selectionPolicy!==undefined){if(!P.multi){L.selectionPolicy="reselect";}if(!L.makeSelHandler&&P.ct!=="4"){L.makeSelHandler=L.attachEventListener("selectionChange",L.id,function(a){if(a){var c=a.added||[],b=a.removed||[],Z=c.length?c[0]:b[0];if(Z!==undefined&&Z!==null&&I.hasRendered){if(X){this.makeSelection({selItem:I.domNode});}else{this.makeSelection({selItem:this._getItemNode(Z)});}}}});}}}return Q;},newPulldown:function H(I){return new mstrmojo.DropDownList({k:I.ck,cssDisplay:"block",cssClass:"mstrmojo-DocSelector-DropDownList",selectCssClass:"mstrmojo-DocSelector-DropDownList-select",onselectedChange:function(){if(!I._inSyncPhase){I.showInfoWin();I.selectorControlChange(this);}}});},getWidgetClass:function B(L,K,J){var I=F[K];if(I){if(I.constructor===Array){I=I[J?0:1];}return I;}else{return this._super(L,K,J);}}};mstrmojo.OIVMDocSelectorViewFactory=mstrmojo.declare(mstrmojo.DocSelectorViewFactory,null,{scriptClass:"mstrmojo.OIVMDocSelectorViewFactory",getDocSelectorClass:function A(J,K){var I=this._super(J,K);return mstrmojo.DynamicClassFactory.newComponent(I,[D],null);},getOIVMDocSelectorMixin:function G(){return D;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.models.template.DataInterface","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.Button","mstrmojo.Label","mstrmojo.ui.CheckList","mstrmojo.ui.Pulldown","mstrmojo.models.datasets.DataInterface","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.models.VIComponentMap","mstrmojo.threshold.ThresholdController","mstrmojo.threshold.ThresholdModel","mstrmojo.chart.model.enums.EnumDSSAxisName","mstrmojo.chart.model.enums.EnumDSSDynamicShortcut","mstrmojo.chart.model.enums.EnumDSSXMLAxesBitMap","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSConsolidationType");var c=mstrmojo,N=c.array,S=c.hash,AP=mstrmojo.chart.model.enums.EnumDSSObjectType,f=c.vi.ui.DatasetUnitMenuUtils,X=mstrmojo.models.datasets.DataInterface,AK=c.vi.models.VIComponentMap,g=mstrmojo.vi.viz.EnumDSSDropZones,I=mstrmojo.ME.MetricDataService,H=1,AI=2,F=3,AR=4,P=5,AD=6,k=7,O=8,v=9,AU=10,A=11,AA=12,D="00000000000000000000000000000000",AG=-1,d=mstrmojo.chart.model.enums.EnumDSSXMLAxesBitMap,AC=mstrmojo.chart.model.enums.EnumDSSAxisName,Ab=mstrmojo.chart.model.enums.EnumDSSDynamicShortcut,R=mstrmojo.mstr.EnumDSSXMLBaseFormType,V=mstrmojo.mstr.EnumDSSXMLObjectTypes,Aa=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,G=mstrmojo.mstr.EnumDSSConsolidationType;function W(Ag){var Ah=this.getHost(),Ai=Ah.model.data.gsi;return Ai.cols.concat(Ai.rows).filter(function(Aj){return Aj.t===Ag;});}function z(Ag,Ai,Ah){return{act:"updateTemplate",keyContext:Ag.k,partialRetrieval:{nodes:Ah?null:[Ag.k]},actions:Ai};}function AQ(Aj,Ah,Ak){var Ao=this,Al=[],Am=[],Ap={};if(Ah.useDropzone){Aj.useDropzone=true;Ap.dropzoneId=Ah.zone.id;if(Ah.item.ax!==undefined){Ap.ax=Ah.item.ax;}}Ap.position=Ah.idx+1+(Ak.offset||0);if(Ak.replaceSourceId){Aj.replaceSourceId=Ak.replaceSourceId;}if(Ak.addToTooltip){Am.push({dropzoneId:v,position:Ao.gmZones.getTooltipDropzoneIdx(Ah.item),});}Aj.partialRetrieval={nodes:[Aj.nodeKey]};Am.push(Ap);Aj.dropzones=Am;Al.push(Aj);var An="$GUID_115",Ag=[],Ai=this.checkAndAddThresholdAction(Ah.zone.id,{did:An,t:4},Ag);if(Ai){Aj.newObjectIds=[An];Al.push(this.getUpdateTemplateAction(Ag));}return Al;}function Af(Aj){var Ag=this.getHost().model.data.datasetId,Ai=N.ensureArray(Aj),Ah=N.hash(Ai);if(!Ag){S.forEach(this.docModel.datasets,function(Am,An){var Ak=(Am.att||[]).concat(Am.mx||[]),Al=Ak.some(function(Ao){return Ah[Ao.did];});if(Al){Ag=An;return false;}});}return Ag;}function AV(Ag,Ak,Ah){var An=this,As=this.docModel,Am=Ag.item,Aq=f.getUnitFromDataset(An.docModel.datasets,Am.did,Am.t)||Am,At=this.getHost(),Ap=An.docModel.getDataService(),Al=Ak==="edit",Ao=At.getChartStyle&&At.getChartStyle()==="NewGraphMatrixVisualizationStyle",Ai,Aj={dsid:Al?As.findDatasetIdFromUnit(Aq.did):Af.call(An,Aq.did),alias:Aq.alias||Aq.n},Ar=null;if(Aq.t===V.Metric){if(Al){Ai={metricId:Aq.did,metric:Aq,action:{cmd:Ak,n:Aq.n,alias:Am.n}};Aj.did=Aq.did;Aj.nodeKey=At.k;Ar=Ap.getEditDerivedMetricSubmitFunc(Aj);}else{Ai={metricId:"",action:{cmd:Ak,refOi:{did:Aq.did,n:Aq.n}}};Aj.nodeKey=At.k;Aj.idx=Ag.idx;Aj.host=At;Aj.zoneid=Ag.zone.id;if(Ao){Aj.extraZone={id:v,idx:An.gmZones.getTooltipDropzoneIdx(Ag.item),};}if(Ah){Aj.replace={did:Aq.did,t:Aq.t};}if(Ag.useDropzone){Ar=Ap.getAddNewDerivedMetricToDropzoneSubmitFunc(Aj);}else{Ar=Ap.getAddNewDerivedMetricToXtabSubmitFunc(Aj);}}if(An.docModel.isFromSolrCube(Aq.did)||An.docModel.isFromMDXCube(Aq.did)){Ai.disableAFB=true;}An.docModel.controller.openDME(At,Ai,Ar);}}mstrmojo.vi.models._DropZoneCommon=mstrmojo.provide("mstrmojo.vi.models._DropZoneCommon",{_mixinName:"mstrmojo.vi.models._DropZoneCommon",isMetric:function j(Ag){return Ag&&Ag.t===V.Metric&&Ag.id!==D;},isAttribute:function AE(Ag){return Ag&&Ag.t===V.Attribute;},isRecursiveAttribute:function b(Ag){return Ag&&Ag.t===V.Attribute&&Ag.st===Aa.AttributeRecursive;},isNewDerivedElement:function AL(Ag){return Ag.t===V.Consolidation&&Ag.st===Aa.ConsolidationManaged;},isNewDerivedRecursiveElement:function AL(Ag){return Ag.t===V.Consolidation&&Ag.st===Aa.ConsolidationManaged&&Ag.ndetype===G.DssRecursiveDerivedElement;},isConsolidation:function AZ(Ag){return Ag.t===V.Consolidation&&Ag.st===Aa.Consolidation;},isCustomGroup:function C(Ag){return Ag.t===V.Filter;},isAttrCategory:function Y(Ag){return Ag&&(Ag.t===V.Attribute||Ag.t===V.Filter||Ag.t===V.Consolidation||Ag.t===V.Dimension);},isMetricName:function AT(Ag){return Ag&&(Ag.id===D||Ag.did===D);},differInType:function U(Ah,Ag){return(this.isMetric(Ah)&&this.isAttrCategory(Ag))||(this.isAttrCategory(Ah)&&this.isMetric(Ag));},isDynamicLink:function J(Ah){if(this.isAttribute(Ah)){var Ag=Ah.fs||X.getFormsByAttrId(Ah.did,this.docModel.datasets);return Ag.length===2&&Ag[1].bftp===R.DssXmlBaseFormHTMLTag&&Ag[1].fnm==="DYNAMICLINK";}return false;},hasOldDEOverDatasets:function(Aj){var Ai=this.docModel.datasets,Ah=false,Ag;S.forEach(Ai,function(Ak){Ag=N.find((Ak.att||[]),"did",Aj);if(Ag!==-1&&Ak.att[Ag].de){Ah=true;return false;}});return Ah;},getZoneModelByZoneId:function(Ag){var Ah=this.dropZones,Ai;N.forEach(Ah,function(Aj){if(Aj.id===Ag){Ai=Aj;return false;}});return Ai;},hGetItemOccurrence:function(Ak,Am){Am=Am||[];if(Am.length===0){Am=[H,AI,F,AR,k,P,O,v,AD,AU];}var Ai,Ag,Ah,Al=Am.length,Aj=[];for(Ai=0;Ai<Al;Ai++){Ah=this.getZoneModelByZoneId(Am[Ai]);if(!Ah){continue;}Ag=this.getUnitIndexInZone(Ah,Ak);if(Ag!==-1){Aj.push({zoneId:Am[Ai],itemIndex:Ag});}}return Aj;},removeColorByItemFromBreakByIfExists:function AB(Aj,Al){var Ak,Ai,Ag,Ah;Ak=this.hGetItemOccurrence(Aj,[H,AI,F,AR,P,O,AD]);if((Ak.length===1)&&(Ak[0].zoneId===P||Ak[0].zoneId===AD)){Ai=Ak[0];Ag=this.getZoneModelByZoneId(Ai.zoneId);Ah=Ag.items[Ai.itemIndex];if(Ah.hidden){Array.prototype.push.apply(Al,this.getRemoveDropZoneUnitActions(Ag,Ah));}}},updateBreakByAndSliceUnits:function m(){var Ag=this,Ai=[H,AI,F,AR,k,O,A,AA],Ah=this.getZoneModelByZoneId(AD)||this.getZoneModelByZoneId(P),Aj;Ah.items.forEach(function(Ak){if(Ag.isAttrCategory(Ak)||Ag.isMetricName(Ak)){Aj=Ag.hGetItemOccurrence(Ak,Ai);if((Aj.length===1)&&(Aj[0].zoneId===k)){Ak.hidden=true;}}});},getAxisSummary:function AM(){var Ag={};Ag[F]=this.getItemCountInZone(F);Ag[AR]=this.getItemCountInZone(AR);Ag[AU]=this.getItemCountInZone(AU);return Ag;},getItemCountInZone:function(Ag){var Ah=this.getZoneModelByZoneId(Ag);if(Ah){return Ah.items.length;}return 0;},isOnlyMetricZone:function h(Ag){var Ai,Ak,Aj,Ah=this.getZoneModelByZoneId(Ag);if(!Ah){return false;}Aj=Ah.items;Ak=Aj.length;if(Ak===0){return false;}for(Ai=0;Ai<Ak;Ai++){if(!this.isMetric(Aj[Ai])){return false;}}return true;},isMetricZone:function x(Ag){var Ai,Ak,Aj,Ah=this.getZoneModelByZoneId(Ag);if(!Ah){return false;}Aj=Ah.items;Ak=Aj.length;if(Ak===0){return false;}for(Ai=0;Ai<Ak;Ai++){if(!this.isMetric(Aj[Ai])){if(this.isMetricName(Aj[Ai])){continue;}else{return false;}}}return true;},getMetricCntInZone:function(Ag){var Ai=this,Ah=this.getZoneModelByZoneId(Ag),Ak=Ah.items,Aj=0;N.forEach(Ak,function(Al){if(Ai.isMetric(Al)){Aj++;}});return Aj;},isAttrCategoryZone:function(Ag){var Ai,Ak,Aj,Ah=this.getZoneModelByZoneId(Ag);if(!Ah){return false;}Aj=Ah.items;Ak=Aj.length;if(Ak===0){return false;}for(Ai=0;Ai<Ak;Ai++){if(!this.isAttrCategory(Aj[Ai])&&!this.isMetricName(Aj[Ai])){return false;}}return true;},getZoneSummary:function AJ(Ag){var Aj=this,Ah=this.getZoneModelByZoneId(Ag),Al=Ah?Ah.items:[],Ak=0,Am=0,Ai=false;N.forEach(Al,function(An){if(Aj.isMetric(An)){Ak++;}else{if(Aj.isAttrCategory(An)){Am++;}else{if(Aj.isMetricName(An)){Ai=true;}}}});return{metricCount:Ak,attributeCount:Am,hasMetricName:Ai};},isTemplateContainAttCategoryItem:function AO(){var Aj=this,Ai=Aj.getHost(),Ak=Ai.model.data.gsi,Ah=(Ak.rows||[]).concat(Ak.cols||[]),Ag=false;if(Ah&&Ah.length){N.forEach(Ah,function(Al){if(Aj.isAttrCategory(Al)){Ag=true;return false;}});}return Ag;},showNumberFormat:function(Ag){return mstrmojo.all[this.hostId].model.showNumberFormat(Ag);},renameItem:function(Ah,Ag){var Ai=this.id;f.renameItem(Ah,Ag,function(Am){var Ao=mstrmojo.all[Ai],Ar=Ao.getHost(),Al=Ao.getHostModel().gsi,An=Am.allowTrimming?Am.text.trim():Am.text,As=Ag.t===V.Metric,Ak=As?Al.mx:Al.rows.concat(Al.cols),Aq=function(){Ao.submitDropZoneUpdates(z(Ar,[{act:"renameUnit",id:Ag.did,type:Ag.t,name:An,isDynamicAlias:false}]));},Aj=function(){Am.set("text",Ag.n);},Ap=Ak.some(function(At){return At.did!==Ag.did&&(As||At.t===Ag.t)&&At.n===An;});if(Ap){mstrmojo.warn(mstrmojo.desc(11664,'"##" already exists in the visualization. Do you want to proceed?').replace("##",An),{confirmBtn:{fn:Aq},cancelBtn:{fn:Aj}});}else{Aq();}},{allowEmptyText:true,cssClass:Ah.className});},getPageByUnit:function Ac(){var Ah=this.getHost(),Ag=Ah.builder.getLayoutVIMap(Ah.defn._lkz).getComponent(AK.TYPES.PAGEBY_PANEL);return Ag&&Ag.unit;},shouldShowDisplayFormsMenu:function E(Aj){if(!mstrmojo.resolveFeature("set-attributeform-display")||!this.isAttribute(Aj)&&!this.isNewDerivedRecursiveElement(Aj)||this.isDynamicLink(Aj)){return false;}var Ag=X.getFormsByAttrId(Aj.attId||Aj.did,this.docModel.datasets),Ak=this.getHost().model.data,Ah=Ak&&Ak.gts,Ai=!!Ah&&Ag.length>1;if(Ah&&Ag.length===1){var Al=false;N.forEach((Ah.row||[]).concat(Ah.col||[]),function(Am){if(Am.id===Aj.did&&N.find(Am.fs||[],"id",Ag[0].fid)>-1){Al=true;return false;}});if(!Al){Ai=true;}}return Ai;},getDisplayFormsMenu:function(Ah){var Ag=this;return f.getDisplayFormsMenu(Ah,Ag.getHost(),Ag.docModel.datasets,function(Ai){Ag.submitDropZoneUpdates(Ai);});},editDerivedMetric:function(Ag){AV.call(this,Ag,"edit");},newDerivedMetric:function(Ah){var Ag=mstrmojo.all[this.hostId].zonesModel.allowInsertNewMetric(Ah.zone);if(Ah.zone.id===k){Ag=false;}AV.call(this,Ah,"editNew",!Ag);},newDerivedAttribute:function e(Am,Ai){var An=Am.item,Al=f.getUnitFromDataset(this.docModel.datasets,An.did,An.t)||An,Ak=this.getHost(),Ah=Ak.getChartStyle&&Ak.getChartStyle()==="NewGraphMatrixVisualizationStyle",Aj=this,Ag={forceRefresh:true,alias:"New Attribute",precreate:function(Ap){if(Aj.getAddItemActions){var Ao=Aj.getAddItemActions(Am.zone,[{did:"$GUID_1",t:12}]);Ap.newObjectIds=["$GUID_1"];if(Ai){Ao=Aj.getRemoveDropZoneUnitActions(Am.zone,Al).concat(Ao);}Ap=[Ap,{act:"updateTemplate",keyContext:Ak.k,actions:Ao}];}else{Ap=S.copy({act:"addDAToTemplate",nodeKey:Ak.k,treeType:Ak.defn.tt},Ap);if(Am.useDropzone){Ap.useDropzone=true;Ap.dropzones=[{dropzoneId:Am.zone.id,position:0}];if(Am.item.ax!==undefined){Ap.dropzones[0].ax=Am.item.ax;}if(Ai){Ap.dropzones[0].replaceSourceId=Al.did;}}else{Ap.axis=Am.axis;}if(Ah){Ap.dropzones.push({dropzoneId:v,position:0});}}return Ap;}};this.docModel.controller.openDAE(this,Ag,mstrmojo.emptyFn,Al);},newDynamicLinkAttr:function w(Al,Ah){var Am=Al.item,Ak=f.getUnitFromDataset(this.docModel.datasets,Am.did,Am.t)||Am,Aj=this.getHost(),Ai=this,Ag={forceRefresh:true,alias:"New Link",precreate:function(Ao){if(Ai.getAddItemActions){var An=Ai.getAddItemActions(Al.zone,[{did:"$GUID_1",t:12}]);Ao.newObjectIds=["$GUID_1"];if(Ah){An=Ai.getRemoveDropZoneUnitActions(Al.zone,Ak).concat(An);}Ao=[Ao,{act:"updateTemplate",keyContext:Aj.k,actions:An}];}else{Ao=S.copy({act:"addDAToTemplate",nodeKey:Aj.k,treeType:Aj.defn.tt},Ao);if(Al.useDropzone){Ao.useDropzone=true;Ao.dropzoneId=Al.zone.id;if(Al.item.ax!==undefined){Ao.ax=Al.item.ax;}if(Ah){Ao.replaceSourceId=Ak.did;}}else{Ao.axis=Al.axis;Ao.pos=Al.idx+2;}}return Ao;}};this.docModel.controller.openDynamicLinkEditor(this,Ag,mstrmojo.emptyFn,Ak);},editDerivedAttribute:function(Aj){var Ai=this.getHost(),Al=Aj.item,Ah=f.getUnitFromDataset(this.docModel.datasets,Al.did,Al.t)||Al,Ak=this.docModel.findDatasetIdFromUnit(Ah.did),Ag={dsid:Ak,did:Ah.did,n:Ah.n,alias:Al.n,forms:Ah.fs,preupdate:function(An){var Am=An.name;An.name=Ah.n;An=[An,z(Ai,[{act:"renameUnit",id:Ah.did,type:12,name:Am}],true)];return An;}};if(this.isDynamicLink(Al)){this.docModel.controller.openDynamicLinkEditor(this,Ag,mstrmojo.emptyFn);}else{this.docModel.controller.openDAE(this,Ag,mstrmojo.emptyFn);}},getTemplateAttributes:function l(){return W.call(this,12);},getTemplateHierarchies:function Z(){return W.call(this,14);},getTemplateDEs:function AX(){var Ag=this.getHost(),Ah=Ag.model.data.gsi;return Ah.cols.concat(Ah.rows).filter(function(Ai){return Ai.st===Aa.ConsolidationManaged;});},getUnitInfoInTemplate:function o(Ah){var Ai={},Ag=this.getHost().model.data.gts;[{axis:H,name:"row"},{axis:AI,name:"col"}].forEach(function(Aj){N.forEach(Ag[Aj.name],function(Al,Ak){if(Al.id===Ah){Ai.axis=Aj.axis;Ai.axisName=Aj.name;Ai.tplIdx=Ak;Ai.unit=Al;return false;}});});return Ai;},sortGrid:function s(Am,Ak){var An=this.getHost(),Aj=Am.t,Al=Am.did,Ag=null,Ai=null;if(Aj===AP.DssTypeMetric){Ai=["","","",1];}else{Ag=this.getUnitInfoInTemplate(Am.did);Ai=[Ag.unit.fid||(Ag.unit.fs&&Ag.unit.fs[0].id),"21","",Ag.axis];}var Ao=Ag?Ag.axis:H,Ah=An.model.data.gts[(Ao===H?"row":"col")+"SubPos"];An.controller.onSort(An,An.model.getSortGridAction(Ah,[Aj,Al].concat(Ai).join("!"),Ao,Ak));},addSortMenu:function a(Ah,Al,Ap){var Ao=this,Aq=this.getHost(),Ar=Ah.item,Ai=Ah.axis,Aj=Aq.model.data,Ag=Aj.gts,An=Aj.gsi.tma,Am=S.copy(Ar);if(Ar.t===AP.DssTypeFilter){return ;}if(Ar.t===AP.DssTypeDimension){N.forEach((Ag.row||[]).concat(Ag.col||[]),function(At){if(At.hid===Am.did){Am.did=At.id;Am.t=At.otp;return false;}});}if(Ai!==AG||An!==H){if(Ah.zone.id!==AG||Ag.col.length<=1){Al.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",function(){Ao.sortGrid(Am,true);});Al.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",function(){Ao.sortGrid(Am,false);});}if(Aq.isVIXtab&&Aq.model.isRecursiveAttribute(Ar.did)&&mstrApp&&mstrApp.isAppStateDefault()&&!mstrApp.isDossier){Al.addMenuItem(mstrmojo.desc(15676,"Custom Sort..."),"xt",function(){if(Aq.customSort){Aq.customSort(N.filterOne(Ag.col.concat(Ag.row),function(At){return At.id===Ar.did;}),Ai);}});}}if(Ap){if(!Aq.excludeData){Al.addMenuItem(mstrmojo.desc(11099,"Advanced Sort..."),"xt",function(){if(Ai===AG){Ai=An;}Aq.controller.onGetAdvSortData(Aq,Ai,Am.t);});}}else{var Ak=Aj.gsi.sorts.some(function(At){return !!At.length;}),As=mstrmojo.desc(11699,"Clear Sort");if(Ak){Al.addMenuItem(As,"",function(){Ao.submitDropZoneTemplateUpdates([{act:"clearSort"}]);});}}},convertToMetric:function p(Am){var Al=this.getHost(),Ag=Al.model&&Al.model.data&&Al.model.data.datasetId,Ai=Al.k,Ak=Al.defn.tt,Aj=Am.item;if(!Ag){mstrmojo.hash.forEach(this.docModel.datasets,function(Ao,Ap){if(mstrmojo.array.find((Ao.att||[]),"did",Aj.did)!==-1){Ag=Ap;return false;}});}var Ah=mstrmojo.mstr.EnumFunction,An=AQ.call(this,{act:"addShortcutMetric",nodeKey:Ai,treeType:Ak,funcType:Aj.formType===2?Ah.FunctionSum:Ah.FunctionCount,units:[{id:Aj.did,type:Aj.t}],prs:[{n:"UseLookupForAttributes",v:"0"}],dsid:Ag,replaceSourceId:Aj.did},Am);this.submitActionForDatasetUpdate(An);},getAddMetricNameAction:function(Ap,Al){if(!this.gmZones){return null;}var An=this,Ah=0,Am=false,Ak,Ag=An.gmZones.getZoneModelByZoneId((Al===H)?AR:F),Ao={n:"Metric Names",did:D,t:0},Aj=S.clone(Ao),Ai=An.gmZones.hGetItemOccurrence(Aj,[H,AI,F,AR,k]);N.forEach(Ag.items,function(Aq){if(An.isMetric(Aq)){Ah++;}});if(Ai.length===0&&Ah<=1){Am=true;}if(Am){Ak={act:"updateTemplate",keyContext:Ap.k,actions:An.gmZones.getUpdateMetricNameUnitActions(Am,Al)};}return Ak;},getAggregateByMetricSubMenu:function(Ah){var Al=this,Ak=Ah.item,Ao=f.getUnitFromDataset(this.docModel.datasets,Ak.did,Ak.t)||Ak,Ag=this.id,Ap=this.getHost(),Aj=Ap.k,Ai=Ap.defn.tt,Am=this.submitActionForDatasetUpdate,An=Ap.getChartStyle&&Ap.getChartStyle()==="NewGraphMatrixVisualizationStyle";return f.getAggregateByMenu(Ao,function(Au,As){var Ar=Al.allowInsertNewMetric(Ah.zone),Aw=[];if(Ah.zone.id===k){Ar=false;}if(Ar&&Ah.useDropzone&&Al.gmZones){var Av=Al.gmZones.getZoneModelByZoneId((Ah.zone.id===AR)?H:AI);var At=Al.getAddMetricNameAction(Ap,Av.id);if(At){Aw.push(At);}At=Al.gmZones.getUpdateGroupInfoActionForNewMetric(Ah.zone.id,Ah.idx+1,Ak.ax===0);if(At){Aw.push(At);}}var Aq=[];if(I.isFuncHasUseLookupForAttributeProp(As)){Aq=[{n:"UseLookupForAttributes",v:"0"}];}Am.call(mstrmojo.all[Ag],Aw.concat(AQ.call(Al,{act:"addShortcutMetric",dsid:Af.call(Al,Ao.did),nodeKey:Aj,treeType:Ai,funcType:As,units:[{id:Au.did,type:Au.t}],prs:Aq},Ah,{offset:Ar?1:0,replaceSourceId:Ar?null:Ao.did,addToTooltip:An})));});},getCalculationEditorCfg:function AS(Ag){var Al=this,Ao=this.getHost(),Ak=this.submitActionForDatasetUpdate.bind(this),Aj=Ao.k,An=Ao.model.data.gsi,Ah=Ao.defn.tt,Ap=Al.allowInsertNewMetric(Ag.zone),Ai=[],Am=Ao.getChartStyle&&Ao.getChartStyle()==="NewGraphMatrixVisualizationStyle";if(Ag.zone.id===k){Ap=false;}return f.getCalculationMetricEditor(An.mx,Ag.item,function(Ar,Aq,Av,As){if(Ap&&Ag.useDropzone&&Al.gmZones){var Au=Al.gmZones.getZoneModelByZoneId((Ag.zone.id===AR)?H:AI);var At=Al.getAddMetricNameAction(Ao,Au.id);if(At){Ai.push(At);}At=Al.gmZones.getUpdateGroupInfoActionForNewMetric(Ag.zone.id,Ag.idx+1,Ag.item.ax===0);if(At){Ai.push(At);}}Ak(Ai.concat(AQ.call(Al,{act:"addShortcutMetric",dsid:Af.call(Al,Ag.item.did),nodeKey:Aj,treeType:Ah,funcType:Av,funcType2:As,units:[Ar,Aq]},Ag,{offset:Ap?1:0,replaceSourceId:Ap?null:Ag.item.did,addToTooltip:Am})));});},submitAddShortcutMetric:function(Am,Ay){var A0=this,At=A0.id,Aq=this.getHost(),Ah=Aq.k,Aj=Aq.defn.tt,A1=A0.submitActionForDatasetUpdate,Aw=A0.allowInsertNewMetric(Am.zone),Ao=[],Ar=Aq.getChartStyle&&Aq.getChartStyle()==="NewGraphMatrixVisualizationStyle";if(Am.zone.id===k){Aw=false;}if(Aw&&Am.useDropzone&&A0.gmZones){var Al=A0.gmZones.getZoneModelByZoneId((Am.zone.id===AR)?H:AI);var Av=A0.getAddMetricNameAction(Aq,Al.id);if(Av){Ao.push(Av);}Av=A0.gmZones.getUpdateGroupInfoActionForNewMetric(Am.zone.id,Am.idx+1,Am.item.ax===0);if(Av){Ao.push(Av);}}var Ax=Ay.item,Ap=Ay.extraItem,Az=Ay.funcType,Ai=Ay.funcType2,An=Ay.breakBys,Ag=Ay.sortBys,Ak=Ay.prs,Au=[{id:Ax.did,type:Ax.t}],As;if(Ap){Au.push(Ap);}As={act:"addShortcutMetric",dsid:Af.call(A0,Ax.did),nodeKey:Ah,treeType:Aj,funcType:Az,units:Au,breakBys:An,sortBys:Ag};if(Ai){As.funcType2=Ai;}if(Ak){As.prs=Ak;}if(I.isFuncHasUseLookupForAttributeProp(Az)){As.prs=As.prs||[];As.prs.push({n:"UseLookupForAttributes",v:"0"});}Ao=Ao.concat(AQ.call(A0,As,Am,{offset:Aw?1:0,replaceSourceId:Aw?null:Ax.did,addToTooltip:Ar}));A1.call(mstrmojo.all[At],Ao);},getDynamicBreakByAxisOptions:function(Ai){var Ak=this,Aj=Ak.getHost(),Al=Aj.model.data.gsi,Ag=[],Ah=function Ah(Am){return Am.some(function(An){return Ak.isAttribute(An)||Ak.isNewDerivedElement(An)||Ak.isCustomGroup(An)||Ak.isConsolidation(An);});};if(Ah(Al.rows)){Ag.push({n:Ai?mstrmojo.desc(3326,"By Columns"):mstrmojo.desc(122,"Columns"),axes_bitmap:d.DssXmlAxisRowsBit,dmy:"@cols"});}if(Ah(Al.cols)){Ag.push({n:Ai?mstrmojo.desc(3327,"By Rows"):mstrmojo.desc(2968,"Rows"),axes_bitmap:d.DssXmlAxisColumnsBit,dmy:"@rows"});}return Ag;},getBreakByAxisOptions:function(Ah){var Ag=[{n:mstrmojo.desc(4531,"Automatic"),axes_bitmap:AC.DssAxisDynamicShortcutRoot+Ab.DssDynamicShortcutAuto,dmy:"@auto"},{n:Ah?mstrmojo.desc(13408,"By None"):mstrmojo.desc(2057,"None"),axes_bitmap:d.DssXmlAxisPagesBit,dmy:"@p"}];if(Ah){Ag.splice(1,0,{isSeparator:true});}return Ag.concat(this.getDynamicBreakByAxisOptions(Ah));},getBreakByAttributeOptions:function(){var Ag=this,Ah=[],Aj=Ag.getTemplateAttributes().concat(Ag.getTemplateDEs()),Ai=Ag.getPageByUnit();Ah=Ah.concat(Aj);if(Ai&&Ai.srcid){if(N.find(Ah,"did",Ai.srcid)===-1){Ah.push({n:Ai.n,did:Ai.srcid,t:Ai.srct});}}return Ah;},getDynamicBreakByOptions:function(Ag){var Ah=this,Ai=Ah.getBreakByAttributeOptions();if(Ag&&Ai.length){Ai.unshift({isSeparator:true});}return Ah.getBreakByAxisOptions(Ag).concat(Ai);},getDynamicLevelOptions:function(){var Ag=this,Ai=Ag.getBreakByAxisOptions(true),Ah=Ag.getBreakByAttributeOptions();Ai.some(function(Aj){if(Aj.axes_bitmap===d.DssXmlAxisPagesBit){Aj.n=mstrmojo.desc(3329,"Grand Total");return true;}});if(Ah.length){Ah.unshift({isSeparator:true});}return Ai.concat(Ah);},getShortcutMetricSubMenu:function(Ak){var Aj=this,Ag=new mstrmojo.ui.menus.MenuConfig(),Al=Ak.item,Ai=f.getUnitFromDataset(this.docModel.datasets,Al.did,Al.t)||Al,Ah=Aj.allowInsertNewMetric(Ak.zone);if(Ai.t===V.Metric){Aj.addRankShortcutMenu(Ak,Ag);Aj.addPercentileShortcutMenu(Ak,Ag);Aj.addPercentToTotalShortcutMenu(Ak,Ag);Ag.addSeparator();Aj.addPercentOfShortcutMenu(Ak,Ag);Aj.addPercentChangeShortcutMenu(Ak,Ag);Aj.addDifferenceShortcutMenu(Ak,Ag);Ag.addSeparator();Aj.addMovingTotalShortcutMenu(Ak,Ag);Aj.addRunningTotalShortcutMenu(Ak,Ag);Aj.addPercentRunningTotalShortcutMenu(Ak,Ag);}Ag.addSeparator();Ag.addMenuItem(mstrmojo.desc(11491,"More Functions..."),"",function(){AV.call(Aj,Ak,"add",!Ah);},Ai);return Ag;},hasReplaceCandidates:function(Ag){var Ah=this.getReplaceCandidates(Ag.zone,Ag.item);return Ah&&Ah.length>0;},getReplaceSubMenu:function(Ah,Aj){var An,Ao=Ah.item,Ak=Ah.zone,Ai=this.getReplaceCandidates(Ak,Ao),Al=this;An=Aj?[Aj]:[];An.push({scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"scrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:Ai,listHooks:{select:function Am(Ap,Aq){Al.unitsDropped(Ak,{src:{data:{item:Aq,items:[Aq],dsid:Aq.dsId}},getCtxtDragData:function(){var Ar=this.src;return(Ar&&Ar.data)||{};}},{allowedItems:[Aq],idx:N.find(Ak.items,"did",Ao.did)===-1?Ao._renderIdx:N.find(Ak.items,"did",Ao.did),edge:mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION.ON,removeReplaced:true});if(this.parent&&this.parent.parent&&this.parent.parent.closeAllMenus){this.parent.parent.closeAllMenus();}}}}]});return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"replaceReference",okVisible:false,cancelVisible:false,contents:An,onOpen:function Ag(){this.scrollableContainer.updateScrollbars();}});},addRankShortcutMenu:function r(Aj,Ah){var Ai=this,Al=this.id;function Ag(Ao,An,Am){Ai.submitAddShortcutMetric(Aj,{item:Ao,funcType:mstrmojo.mstr.EnumFunction.FunctionRank,prs:[{n:"ASC",v:An}],breakBys:Am});}function Ak(Am){return f.getRankMetricEditor(Am.item,Ai.getDynamicBreakByOptions(),Ag);}Ah.addActionPopupMenuItem(mstrmojo.desc(2789,"Rank"),Al,function(){Ag(Aj.item,"0",[{dmy:"@auto"}]);},Ak,"",Aj);},addPercentileShortcutMenu:function q(Ai,Ag){var Ah=this,Al=this.id;function Aj(Am){var An;if(Am.dmy){An={dmy:Am.dmy};}else{An={id:Am.did,type:Am.t};}Ah.submitAddShortcutMetric(Ai,{item:Ai.item,funcType:mstrmojo.mstr.EnumFunction.FunctionPercentRank,breakBys:[An],prs:[{n:"inclusive",v:"False"}]});}function Ak(){var An=new mstrmojo.ui.menus.MenuConfig(),Am=Ah.getDynamicBreakByOptions(true);Am.forEach(function(Ao){if(Ao.isSeparator){An.addSeparator();return ;}An.addMenuItem(Ao.n,"",function(){Aj(Ao);});});return An;}Ag.addActionPopupMenuItem(mstrmojo.desc(13409,"Percentile Rank"),Al,function(){Aj({dmy:"@auto"});},Ak,"",Ai);},addPercentToTotalShortcutMenu:function AF(Ah,An){var Ap=this,Ag=this.id,As=Ah.item,At=Ap.getHost(),Ao=Ap.submitActionForDatasetUpdate.bind(Ap),Am=Ap.getDynamicLevelOptions(),Al=At.k,Ai=At.defn.tt,Ar=Ap.allowInsertNewMetric(Ah.zone),Ak=[];if(Ah.zone.id===k){Ar=false;}function Aq(Au){if(Ar&&Ah.useDropzone&&Ap.gmZones){var Aw=Ap.gmZones.getZoneModelByZoneId((Ah.zone.id===AR)?H:AI);var Av=Ap.getAddMetricNameAction(At,Aw.id);if(Av){Ak.push(Av);}Av=Ap.gmZones.getUpdateGroupInfoActionForNewMetric(Ah.zone.id,Ah.idx+1,Ah.item.ax===0);if(Av){Ak.push(Av);}}Ao(Ak.concat(AQ.call(Ap,{act:"addPercentToTotalMetric",nodeKey:Al,treeType:Ai,metric_id:As.did,axes_bitmap:Au.axes_bitmap||0,units:Au.did&&[{id:Au.did,type:Au.t}]},Ah,{offset:Ar?1:0,replaceSourceId:Ar?null:Ah.item.did})));}function Aj(){var Au=new mstrmojo.ui.menus.MenuConfig();Am.forEach(function(Av){if(Av.isSeparator){Au.addSeparator();return ;}Au.addMenuItem(Av.n,"",function(){Aq(Av);});});return Au;}An.addActionPopupMenuItem(mstrmojo.desc(3323,"Percent to Total"),Ag,function(){Aq({axes_bitmap:AC.DssAxisDynamicShortcutRoot+Ab.DssDynamicShortcutAuto});},Aj,"",Ah);},addPercentOfShortcutMenu:function M(Ak,Ag){var Aj=this,Al=this.id;function Ai(An,Ao,Am){Aj.submitAddShortcutMetric(Ak,{item:An,funcType:Ao,funcType2:mstrmojo.mstr.EnumFunction.FunctionDivide,breakBys:Am,sortBys:[{dmy:"@auto"}]});}function Ah(Am){return f.getRelativeReferenceMenu(Am.item,mstrmojo.desc(13394,"Percent of:"),Aj.getDynamicBreakByOptions(),Ai);}Ag.addActionPopupMenuItem(mstrmojo.desc(13390,"Percent Of"),Al,function(){Ai(Ak.item,mstrmojo.mstr.EnumFunction.FunctionLag,[{dmy:"@auto"}]);},Ah,"",Ak);},addPercentChangeShortcutMenu:function n(Aj,Ah){var Ai=this,Al=this.id;function Ak(An,Ao,Am){Ai.submitAddShortcutMetric(Aj,{item:An,funcType:Ao,funcType2:mstrmojo.mstr.EnumFunction.FunctionVar,breakBys:Am,sortBys:[{dmy:"@auto"}]});}function Ag(Am){return f.getRelativeReferenceMenu(Am.item,mstrmojo.desc(146,"From:"),Ai.getDynamicBreakByOptions(),Ak);}Ah.addActionPopupMenuItem(mstrmojo.desc(13391,"Percent Change"),Al,function(){Ak(Aj.item,mstrmojo.mstr.EnumFunction.FunctionLag,[{dmy:"@auto"}]);},Ag,"",Aj);},addDifferenceShortcutMenu:function K(Aj,Ag){var Ai=this,Al=this.id;function Ah(An,Ao,Am){Ai.submitAddShortcutMetric(Aj,{item:An,funcType:Ao,funcType2:mstrmojo.mstr.EnumFunction.FunctionMinus,breakBys:Am,sortBys:[{dmy:"@auto"}]});}function Ak(Am){return f.getRelativeReferenceMenu(Am.item,mstrmojo.desc(146,"From:"),Ai.getDynamicBreakByOptions(),Ah);}Ag.addActionPopupMenuItem(mstrmojo.desc(11495,"Difference"),Al,function(){Ah(Aj.item,mstrmojo.mstr.EnumFunction.FunctionLag,[{dmy:"@auto"}]);},Ak,"",Aj);},addMovingTotalShortcutMenu:function AH(Ai,Ag){var Ah=this,Al=this.id;function Ak(Ap,Ao,An,Am){Ah.submitAddShortcutMetric(Ai,{item:Ap,funcType:Ao,breakBys:Am,sortBys:[{dmy:"@auto"}],prs:[{n:"OLAPWinStType",v:"3"},{n:"OLAPWinStOffset",v:An.toString()},{n:"OLAPWinEndType",v:"2"}]});}function Aj(Am){return f.getMovingTotalMenu(Am.item,Ah.getDynamicBreakByOptions(),Ak);}Ag.addActionPopupMenuItem(mstrmojo.desc(13392,"Moving Average"),Al,function(){Ak(Ai.item,mstrmojo.mstr.EnumFunction.FunctionOLAPAvg,1,[{dmy:"@auto"}]);},Aj,"",Ai);},addRunningTotalShortcutMenu:function AY(Ak,Ag){var Aj=this,Al=this.id;function Ai(Ao,An,Am){Aj.submitAddShortcutMetric(Ak,{item:Ao,funcType:An,breakBys:Am,sortBys:[{dmy:"@auto"}],prs:[{n:"OLAPWinStType",v:"0"},{n:"OLAPWinEndType",v:"2"}]});}function Ah(Am){return f.getRunningTotalMenu(Am.item,Aj.getDynamicBreakByOptions(),Ai);}Ag.addActionPopupMenuItem(mstrmojo.desc(11906,"Running Total"),Al,function(){Ai(Ak.item,mstrmojo.mstr.EnumFunction.FunctionOLAPSum,[{dmy:"@auto"}]);},Ah,"",Ak);},addPercentRunningTotalShortcutMenu:function B(Aj,Ah){var Ai=this,Al=this.id;function Ag(Ao,Am){var An=[];Am.forEach(function(Ap){if(Ap.dmy){An.push({dmy:Ap.dmy});}else{An.push({id:Ap.did,type:Ap.t});}});Ai.submitAddShortcutMetric(Aj,{item:Ao,funcType:mstrmojo.mstr.EnumFunction.FunctionOLAPSum,funcType2:mstrmojo.mstr.EnumFunction.FunctionDivide,breakBys:An,sortBys:[{dmy:"@auto"}],prs:[{n:"OLAPWinStType",v:"0"},{n:"OLAPWinEndType",v:"2"}]});}function Ak(Ao){var An=new mstrmojo.ui.menus.MenuConfig(),Am=Ai.getDynamicLevelOptions();Am.forEach(function(Ap){if(Ap.isSeparator){An.addSeparator();return ;}An.addMenuItem(Ap.n,"",function(){Ag(Ao.item,[Ap]);});});return An;}Ah.addActionPopupMenuItem(mstrmojo.desc(13393,"Percent Running Total"),Al,function(){Ag(Aj.item,[{dmy:"@auto"}]);},Ak,"",Aj);},getMultipleMetricsCalcMenus:function u(An,Am,Ap){var Ao=this,Aq=this.getHost(),Al=this.submitActionForDatasetUpdate.bind(this),Aj=Aq.k,Ah=Aq.defn.tt,Ai=Am.map(function(Ar){return Ar.did;}),Ag=An.items.map(function(Ar){return Ar.did;}),Ak=-1;Ai.forEach(function(Ar){var As=N.indexOf(Ag,Ar);if(As>Ak){Ak=As;}});return f.getMultipleMetricsCalculationMenus(Am,Aq.model.data.datasetId,function(At){var As={act:"addShortcutMetric",dsid:Af.call(Ao,Ai),nodeKey:Aj,treeType:Ah,funcType:At.funcType,funcType2:At.funcType2,units:At.items.map(function(Av){return{id:Av.did,type:Av.t};}),position:Ak+2,partialRetrieval:{nodes:[Aj]}},Au=[],Ar;if(Ap){As.useDropzone=Ap;As.dropzoneId=An.id;}Au.push(As);if(Ao.gmZones){Ar=Ao.gmZones.getUpdateGroupInfoActionForNewMetric(An.id,Ak+1,true);}if(Ar){Au.push(Ar);}Al(Au);});},getCreateOrEditElementGroupFunc:function Ae(Ah){var Ag=this;return function(){var Al=Ag.getHost(),Am=Al.model,Ak=Ah.item,Aj=Ak.did,Ai=Ag.getUnitInfoInTemplate(Aj),Ao="$GUID_1",An=Ai.unit.ost===Aa.ConsolidationManaged&&Am.docModel.getDEObject(Aj);Al.controller.openDEEditor(Al,An?{deObj:An}:{dsId:Am.data.datasetId,attId:Aj,attName:Ak.n,deId:Ao,getExtraSaveActions:function(){var Ap=Ah.zone,Aq=Ag.getRemoveDropZoneUnitActions(Ap,Ak);Aq.push(Ag.getAddDropZoneUnitAction(Ap,{did:Ao,t:AP.DssTypeConsolidation},Ah.idx));return Ag.getUpdateTemplateAction(Aq);}});};},buildThresholdMenuOptions:function t(Ah,Ai,Ag){mstrmojo.all[this.hostId].model.buildThresholdMenuOptions(Ah,Ai,Ag,this.canSupportImageThreshold());},canSupportImageThreshold:function L(){return false;},getNumberFormatEditorCfg:function Q(Ag){return mstrmojo.all[this.hostId].model.getNumberFormatEditorCfg(Ag);},submitUpdatesAndPersistWidgetXMLIfNecessary:function Ad(Aj,Ai,Ah){var Ag=Aj.model.docModel,Ak=Ag.getDataService(),Am,Al;if(!Aj.isXMLDirty()){Aj.controller.onSubmitTemplateUpdates(Aj,Ai,Ah);}else{Al={act:"updateTemplate",keyContext:Aj.k,actions:Ai};Am=Aj.getPersistAction();Ak.submitUpdates([Al,Am],mstrmojo.func.wrapMethods(Aj.controller._getXtabCallback(Aj),Ah));Aj.resetXMLDirtyFlag();}},submitActionForDatasetUpdate:function AN(Ah){var Ag=this.docModel;this.submitDropZoneUpdates(Ah,mstrmojo.func.wrapMethods(Ag.getDatasetsUpdateCallback(),Ag.controller._getXtabCallback(this.getHost())));},getVFNotifierBlackList:function AW(Ai,Ag){var Ah=11,Aj=12;switch(Ai){case"XtabGrid":return[g.Rows,g.Columns];case"GraphMatrixVisualizationStyle":case"NewGraphMatrixVisualizationStyle":if(Ag){return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.BreakBy,g.SliceBy,g.Angle,Ah,Aj];}else{return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.BreakBy,g.SliceBy,g.Angle];}case"VIHeatMapVisualizationStyle":return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.Grouping];case"NetworkVisualizationStyle":return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.FromItem,g.ToItem];case"ImageLayoutVisualizationStyle":return[g.GeoAttribute,g.Layout];case"GoogleMapVisualizationStyle":case"ESRIMapVisualizationStyle":case"MapboxVisualizationStyle":return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.SliceBy,g.Angle,g.GeoAttribute,g.Latitude,g.Longitude];case"KPICardVisualizationStyle":return[g.Rows,g.Columns,g.XAxis,g.YAxis,g.Metric,g.BreakBy];default:return[];}}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocXtabModel","mstrmojo.vi.ui._CanDropFromSchema","mstrmojo.models.template.DataInterface","mstrmojo.vi.models.EnumDragSources","mstrmojo.array","mstrmojo.expr","mstrmojo.func","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.fe.FilterUtils","mstrmojo.vi.enums.EnumVisFilterType","mstrmojo.EnumRWUnitType","mstrmojo.models.FormatModel","mstrmojo.models.template.DataInterface","mstrmojo.warehouse.EnumObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes");var M=mstrmojo.expr,Q=M.FN,U=M.ET,Y=mstrmojo.hash,t=mstrmojo.array,z=mstrmojo.vi.models.EnumDragSources,AL=mstrmojo.fe.FilterUtils.getExprXml,C=mstrmojo.fe.FilterUtils.isExprEmpty,AE=mstrmojo.vi.ui.DatasetUnitMenuUtils,o=mstrmojo.array,a=mstrmojo.string,AM=mstrmojo.models.FormatModel,O=AM.ENUM_PROPERTY_NAMES,AA=mstrmojo.vi.enums.EnumVisFilterType,X=mstrmojo.EnumRWUnitType,AK=mstrmojo.models.template.DataInterface,AR=AK.ENUM_GRID_RESIZE.FIT_TO_CONTENTS,I=mstrmojo.warehouse.EnumObjectTypes,x=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,k=mstrmojo.vi.enums.EnumFeatures,m=mstrmojo.elementHelper;var L=4,j=12,AB="-1";var B=3;var d=[O.GRID_VERTICAL_PADDING,O.GRID_HORIZONTAL_PADDING],r={},g="tp",R="lp";r[O.GRID_VERTICAL_PADDING]=g;r[O.GRID_HORIZONTAL_PADDING]=R;function K(AS){return AS.docModel.controller.cmdMgr;}function v(AV,AX){var AY=AV.xtab.k,AU=AV.docModel,AT=AU.getSelectedViUnit(),AS=AT&&AT.boxContent,AW=!(AS&&AS.isInFilterPanel&&AS.isInFilterPanel());return[AY].concat(AW?AU.getSourceFilterKeys(AY,true):[]);}function f(AV,AT,AU,AW,AS){AT.reverse().forEach(function(AX){AW.push(AV.model.getClearThresholdAction(AU,AS,AX.tid));});}mstrmojo.vi.models.DocXtabModel=mstrmojo.declare(mstrmojo.DocXtabModel,[mstrmojo.vi.ui._CanDropFromSchema],{scriptClass:"mstrmojo.vi.models.DocXtabModel",getUnHiddenDrillPathsForCell:function AG(AS,AW){var AU=this.getAllDrillPathsForCell(AS,AW),AV=this.docModel.datasets,AT=function(AX,Aa){var AY=o.find(AX,"did",Aa.id),AZ=AX[AY];if(AZ&&!AZ.hide){Aa.n=AZ.n;return true;}return false;};return o.filter(AU,function(AZ){var AX;for(AX in AV){var AY=AV[AX];if(AT(AY.att,AZ)){return true;}}return false;});},getAllDrillWithinPathsForCell:function p(AS,AV,AU){var AT=AU?this.getUnHiddenDrillPathsForCell(AS,AV):this.getAllDrillPathsForCell(AS,AV);return AT.filter(function(AW){return !!AW.within;});},sort:function AN(AU,AV){var AS=this;K(this).execute({execute:function AT(){var AW=AS.xtab.k;this.submit(AS.docModel.getDataService().getUpdateTemplateAction(AW,{act:"sort",sorts:AU.sorts,nodeKey:AW,subTotalsPos:AU.stp||AS.getSubTotalsPos(),stt:AU.stt||-1}),AV);}});},customSort:function AO(AV,AW,AS){var AT=this,AV=Y.clone(AV);K(this).execute({execute:function AU(){var AX=AT.xtab.k;this.submit(AT.docModel.getDataService().getUpdateTemplateAction(AX,AV),AW,AS);}});},drillGrid:function s(AU,AV){var AS=this;K(this).execute({execute:function AT(){this.submit(AS.docModel.getDataService().getDrillGridAction(AU),AV);}});},getClearThresholdAction:function F(AU,AS,AT){return{act:"clearThreshold",unitId:AU,unitType:AS,tid:AT};},getCreateSimpleThresholdAction:function W(AX,AV,AS,AW,AU,AT){return{act:"threshold",nodeKey:AV,thresholds:AX,thresholdType:AW,basedOnId:AU||AS,did:AS,objType:AT};},getZoneFormatAction:function N(Ad,Af,Aa,AW){var AY=AW&&AW.skipSubtotals,AU=AW&&AW.isSubtotalFormat,Ac=AW&&AW.isSubtotalUseGridFormatting,Ab=[],AV=[],AZ="h",AS="g",Ae="sh",AX="sg",AT=function(Ag,Ah){AV.push({axis:Ag,regions:Ah});};if(AU){if(Ad==="ch"){AT(2,[Ae]);}else{if(Ad==="rh"){AT(1,[Ae]);}else{if(Ad==="va"){AT(1,[AX]);AT(2,[AX]);}}}}else{if(Ad==="ch"){AT(1,[AZ]);AT(2,!AY&&Ac?[AZ,AS,Ae]:[AZ,AS]);}else{if(Ad==="rh"){AT(1,!AY&&Ac?[AS,Ae]:[AS]);}else{if(Ad==="va"){this.data.gsi.mx.forEach(function(Ag){Ab.push({unitId:Ag.did,unitType:4,regions:[AS]});});if(!AY&&Ac){AT(1,[AX]);AT(2,[AX]);}}}}}return{act:"formatGridZone",nodeKey:Aa,props:Af,units:Ab,axis:AV};},getApplyGridCellFormatToSubtotalAction:function S(AU){var AT={},AV,AY=this.xtab,AX=AY.gridInfo.fmts,AW=AX[AU];var AS;Y.forEach(AW,function(Aa,AZ){AS=AM.getFormatPropertyInfo(AZ);if(AS&&AS.ps!==AM.ENUM_PROPERTY_SETS.FORMATTING_NUMBER){AT=Y.mergeHashes(AT,AM.getFormatUpdate(AZ,(AS.pt==B)?Aa:AM.decodeValue(AZ,Aa)));}});AV=AY.model.getZoneFormatAction.call(AY.model,AU,AT,AY.k,{isSubtotalFormat:true});return AV;},getSelectorDataFromTemplateLimit:function P(AS){return this.getSelectorDataFromViewFilter(AS);},getSelectorDataFromViewFilter:function AD(AV){var AS=[],AW="The expression is not supported by the View Filter Exception Parser.",AT=function AT(AZ){if(m.isNullElem(AZ.id)&&a.isEmpty(AZ.v)){throw AW;}},AY=function AY(Ab){var AZ=null;if([U.AE,U.ANDOR].indexOf(Ab.et)>-1||(Ab.et===U.AQ&&Ab.fn===Q.IS_NULL)){if(!Ab){return true;}var Aa=Ab.nds;AZ=!(Ab.not||Ab.fn===Q.NOT||Ab.fn===Q.NOT_IN_LIST);if(Aa){Aa.every(function(Ac){AZ=AZ&&AY(Ac);});}}else{throw AW;}return AZ;},AU=function AU(Ab,Ad,Af){var Ah=Ab&&Ab.nds,Aa=Ab.fn===Q.OR;Af=Af||Ad;if(Ah&&Ah.length){var Ac=Ad;Ah.forEach(function(Ai){if(Aa){Ac=[];}AU(Ai,Ac,Af);if(Aa&&Ac.length>0){Ad.push(Ac);}});}else{if(Ab.fn===Q.IS_NULL){var Ag=Ab.a=Ab.a||{n:"Null Attribute",did:""};Ad.push({tn:Ag.n,tid:Ag.did,eid:null,v:""});}else{if(Ab.et===U.AE){var AZ=Ab.es||[];var Ae=AZ.length;if(Ae===1){AT(AZ[0]);Ad.push({tn:Ab.a.n,tid:Ab.a.did,eid:AZ[0].v,v:AZ[0].n});}else{if(Af){AZ.forEach(function(Ai){AT(Ai);Af.push([{tn:Ab.a.n,tid:Ab.a.did,eid:Ai.v,v:Ai.n}]);});}}}}}return Ad;};try{if(AV){(AV.nds||[]).forEach(function(AZ){var Aa=AU(AZ,[]);if(Aa.length>0){AS.push({keepOnly:AY(AZ),data:Aa});}});}}catch(AX){if(AX!==AW){console.error("vi.models.DocXtabModel: Encountered a problem parsing the view filter expression ("+AX+")");}else{return[];}}return AS;},getRemoveMetricLimitsAction:function AJ(AS){var AU=[],AV=[],AT=function AT(AX,AY){if(!AX){return ;}var AW=AX.nds;if(AW){AW.forEach(function(Aa){var AZ=Aa.m;if(AZ!==undefined){AY.push(AZ.did);}else{AT(Aa,AY);}});}};if(AS){AT(AS,AU);AU.forEach(function(AW){AV.push({act:"removeMetricLimits",unitId:AW});});}return AV;},getAddTemplateUnitAction:function E(AW,AX,AU,AS){var AV=this._super(AW,AX,AU,AS),AT=v(this,AV);if(AT.length>0){AV.partialRetrieval={nodes:AT};}return AV;},getRemoveTemplateUnitAction:function AI(AU){var AT=this._super(AU),AS=v(this,AT);if(AU.axis!==undefined&&AU.unitPos!==undefined){AT.axis=AU.axis;AT.unitPos=AU.unitPos;}if(AS.length>0){AT.partialRetrieval={nodes:AS};}return AT;},getAdvancedPropertiesAction:function W(AS){return{act:"advancedProperties",props:AS};},canShowCellMenu:function AC(AS){return true;},isSubtotalValue:function D(AS){var AT=this.getCellDataUnion(AS);return !AS.stt&&AT.some(function(AU){return !!AU.isSubtotal;});},getKeepOnlyActionsForAssociatedNodes:function AF(AT,AZ,AV){var AS=this.docModel,AY=[AS.getKeepOnlyOrExcludeAction(this.xtab.k,AT)],AU=!!AV?AV:this.xtab,AX=!mstrApp.isInVFConfigMode?(AU.getAssociatedNodes&&AU.getAssociatedNodes()||[]):[];AZ=mstrmojo.func.wrapMethods(AZ,{success:function AW(){o.forEach(AX,function(Ab){var Aa=AS.getPanel().getUnitByKey(Ab.k);if(Aa&&Aa.boxContent){Aa.boxContent.raiseEvent({name:"regenerateToolbar"});}});}});o.forEach(AX,function(Aa){AY.push(AS.getKeepOnlyOrExcludeAction(Aa.k,AT));});return{actions:AY,callback:AZ};},getSaveViewFilterAction:function V(AT,AS){return{act:"saveViewFilter",nodeKey:(AT&&AT.k)||this.xtab.k,expr:C(AS)?'<exp><nd et="14" fn="19"></nd></exp>':AL(AS)};},getClearLinkingAction:function w(AS){var AV=[],AY=this.docModel,Aa=AS.k,AW=AY.getCurrentLayoutKey(),AZ=(AY.defn.layouts).filter(function(Ac){return Ac.k===AW;})[0],AX=AZ.cgbMap||{},AU=AZ.units||{},Ab,AT=Y.keyarray(AX).filter(function(Ac){if(AX[Ac]===Aa){Ab=AU[Ac];return Ab&&Ab.isNavigation;}return false;});o.forEach(AT,function(Ac){AV.push({act:"clearUCNodeCondition",nodeKey:Ac});});return AV;},getClearFiltersForVisActions:function n(Ae,Ad,AV,Ac){var Af=this.docModel,Ab=Af.getDataService(),AT=Ae.model,AW=Ae.gridData||Ae.model.data||Ae.node.data,AS=AW.vfexpr,AY=AW.vlexpr,AX=(Ad&&Ad.k)||this.xtab.k,Aa={actions:[],callback:Ac};AV=[].concat(AV);if(AV.indexOf(AA.KEEP_ONLY)>-1){Aa=AT.getKeepOnlyActionsForAssociatedNodes([],Aa.callback,Ad);}if(AV.indexOf(AA.ADV_QUALIFICATION)>-1){if(AY){Aa.actions.push(Ab.getUpdateTemplateAction(Ae.k,AT.getRemoveMetricLimitsAction(AY)));}if(AS){var AU=AV.indexOf(AA.DRILLING);if(AU>-1){Aa.actions.push(AT.getSaveViewFilterAction(Ad));AV.splice(AU,1);}else{Aa.actions.push(AT.getSaveViewFilterAction(Ad,Af.getVfexprWithUpdatedVf(AX)));}}}if(AV.indexOf(AA.DRILLING)>-1){var AZ=Af.getVfNdFromExpr(AS)||{et:14,nds:[]};Aa.actions.push(AT.getSaveViewFilterAction(Ad,AZ));}if(AV.indexOf(AA.LINKING)>-1){Aa.actions=Aa.actions.concat(AT.getClearLinkingAction(Ae));Aa.extras={style:{params:{treesToRender:3}}};}return Aa;},getObjectInfo:function H(AS){var AU=this.xtab.zonesModel,AT=null;if(AU){(AU.getDropZones().zones||[]).some(function(AV){return !!AV.items.some(function(AW){if(AW.did===AS){AT=AW;return true;}});});}else{AT=this._super(AS);}return AT;},getObjectInfoFromDataset:function H(AS){var AT;Y.forEach(this.docModel.datasets,function(AU){if(!AT){AT=(AU.mx.concat(AU.att)).filter(function(AV){return AV.did===AS;})[0];}});return AT;},hasDerivedElements:function A(AS){var AT=this.getObjectInfo(AS);return !!(AT&&AT.de);},isRecursiveAttribute:function u(AS){var AU=this.docModel.getDEObject(AS),AT=this.getObjectInfoFromDataset(AU?AU.attId:AS);return AT&&AT.t===12&&AT.st===3076;},getNDEFormsFromDataset:function G(AT){var AS=this.getObjectInfoFromDataset(AT);return AS&&AS.fs;},hasRecursiveAttribute:function AH(AS){var AT=this,AU=(AS||this.data).gsi||{};return(AU.rows||[]).concat(AU.cols||[]).some(function(AV){return AT.isRecursiveAttribute(AV.did);});},hasSameRecursiveAttributeGroup:function q(AW,AU,AT){var AS=this.docModel,AY=AW.did,AV=AS.getDEObject(AY),AX=(AU||this.data).gsi||{};if(this.isRecursiveAttribute(AY)){return o.filterOne((AX.rows||[]).concat(AX.cols||[]),function(Ab){var AZ=Ab.did,Aa=AS.getDEObject(AZ);return o.find(o.ensureArray(AT),"did",AZ)<0&&(AZ!==AY)&&(AV?AV.attId:AY)===(Aa?Aa.attId:AZ);});}return false;},supportsViewFilterActions:function b(AS){var AT=this.getObjectInfo(AS);return AT&&!AT.de&&(AT.t!==1)&&(AT.t!==47||AT.st===12033);},addEditNodeForDatasetAction:function c(AT,AS){this.augmentDropContextForSchema(AT,this.docModel);var AW=AT.getCtxtDragData(),AV=AW.src;if(AV===z.DATASETS||AV===z.ALL_OBJECT_LIST){var AU=AT.getCtxtDragData().dsid,AX=AT.actions||[];if(AU){AX.push({act:"editNode",nodeKey:AS,datasetId:AU});}AT.actions=AX;}},getCurrentUnitAxisAndPosition:function AP(AS){return new mstrmojo.models.template.DataInterface(this.data).getUnitById(AS)||null;},getNumberFormatEditorCfg:function l(AT){var AX=this,AS=AX.xtab,AV=AX.data,AU=(AV.gnf||[]).concat(AV.gnfu),Ab=AT.item,Aa=o.find(AU,"id",Ab.did),AY=Aa===-1?{}:AU[Aa],AW=AS&&(!AS.defn.vis||!AS.defn.vis.ve);var AZ=AE.getNumberFormatEditor(AT.item,AY,function(Ag){var Ae=AX.docModel.getNumberFormatAction(Ab.did,Ab.t,Ag),Ad=!!Ae.partialRetrieval,Af,Ac;if(Ad){Af=mstrmojo.DocDataService.REQUEST_DEFN_DATA;Ac={treesToRender:3};}AS.controller.submitUndoRedoTemplateUpdates(AS,Ae,AX.docModel.controller._getXtabCallback(AS,undefined,Ad),Af,Ac);});return AZ;},showNumberFormat:function(Aa){var Ab=[1,2,8,9,11],AY;if(Aa.t===12){var AT=this.xtab.node.data,AS=AT&&AT.gts,AU=new mstrmojo.models.template.DataInterface(AT),AX=AS&&(AU.getRowTitles().titles||[]).concat(AU.getColTitles().titles||[]),AZ=o.filterOne(AX,function(Ac){return Aa.did===Ac.id;}),AW=((AZ&&AZ.fs)||[]).map(function(Ac){return Ac.id;});AY=(Aa.fs||[]).some(function(Ac){return Ab.indexOf(Ac.bftp)!==-1&&AW.indexOf(Ac.fid||Ac.id)!==-1;});}var AV=mstrApp&&mstrApp.supportFeature&&mstrApp.supportFeature(k.NUMBER_FORMATTING);return(Aa.t===4&&Aa.did!==AB&&AV)||AY;},openThresholdEditor:function(Ag,AW,Ac){var AV=this,AT=AV.xtab,Ae=AV.docModel,Ab=AV.data,Ad=Ab.gsi,Aa=Ag.did,AS=mstrmojo.desc(3647,"Thresholds");if(Ag.t===L||Ag.t===j){var AZ=Y.clone(Ad.mx),AY;AZ.forEach(function(Ah){Ah.t=4;});AY=Ad.rows.concat(Ad.cols,AZ).filter(function(Aj){var Ah=Aj.t,Ak=Aj.st,Ai=Aj.did;return !((Ah===1&&Ak===257)||(Ah===47&&Ak===12032)||(AV.hasDerivedElements(Ai))||(Ai==="-1")||(Ah===14));});AY.forEach(function(Aj){if(Aj.t===12){var Ai=this.getObjectInfo(Aj.did);Aj.da=Ai?Ai.da:undefined;}else{if(Aj.t===47&&Aj.st===12033){var Ai=this.getObjectInfo(Aj.did);Aj.ndetype=Ai.ndetype;}else{if(Aj.t===4){var Ah=this.getObjectInfoFromDataset(Aj.did);Aj.dt=Ah&&Ah.dt;}}}},this);if(Aa!==AB){AS+=" - "+Ag.n;}var AX=mstrmojo.threshold.ThresholdModel.FEATURES,Af=new mstrmojo.threshold.ThresholdController({metricId:Aa,objectType:Ag.t,title:AS,data:Ab,targets:AY,messageId:Ae.mid,datasets:Ae.datasets,dataService:Ae.getDataService(),supportsFeature:function AU(Aj){switch(Aj){case AX.SHOW_ADVANCED_EDITOR:return !AW;case AX.SHOW_BASED_ON:return !AW;case AX.SHOW_IMAGE:return Ac;case AX.SHOW_VALUE_ITEM:var Ai=AV.getObjectInfoFromDataset(this.model.basedOnId),Ak=Ai&&Ai.dt,Ah=[8,9,10,14,15,16,30];return !Ak||Ah.indexOf(Ak)===-1;}},onSubmitActions:function(Ap,Aj,Ai,Ak,An,Ao,Ah){var Am=this,Al=[];if(Aj){f(AT,Aj,Ai,Al,Ah);}Al.push(AV.getCreateSimpleThresholdAction(Ap,AT.k,Ai,An,Ak,Ah));AT.controller.submitUndoRedoTemplateUpdates(AT,Al,{success:function(){if(Ao){Am.set("data",AV.data);Am.openEditor();Ao=false;}}});},onSaveThresholds:function(Aj,Ah,Ai,Al,Ak){this.dataService.saveThresholds(Y.copy(Al,{thresholds:JSON.stringify(Aj),basedOnId:Ah,thresholdType:Ai}),Ak,{hideFailureErr:true});},onLoadThresholds:function(Ai,Aj){var Ah=this.model;this.dataService.getThresholds({thresholdsID:Aj},{success:function(Ap){var Ao=Ap.thresholds,Al=[],Ak,Aq,An={};o.forEach(Ao||[],function(Ar){Ak=M.findTargets(Ar.expr,"did");Aq=true;Y.forEach(Ak,function(As,At){if(!AV.getObjectInfo(At)){An[At]=As.n;Aq=false;}});if(Aq){Al.push(Ar);}});if(!Y.isEmpty(An)){var Am=Y.valarray(An);mstrmojo.alert(mstrmojo.desc(15431,"The following objects: # are not on the visualization, so some thresholds will not be loaded...").replace("#",Am.join(",")));}Ah.addThresholds(Al);}});}});if(Ag.t===j){Af.model.editorMode=mstrmojo.threshold.ThresholdModel.EDITOR_TYPES.ADVANCED_EDITOR;}Af.openEditor();}},buildThresholdMenuOptions:function e(AX,AT,AW,Ad){var AV=this,AS=AV.xtab,Ac=AV.data,Ae=Ac.gsi,AU=Ae.thresholds,Af=AT.item,Ab=Af.did,Aa=AU&&AU[Ab],AY=mstrmojo.desc(13261,"Clear Thresholds"),AZ=AS.excludeData;if((!AZ&&Af.t===L)||Af.t===j&&!AV.docModel.isOldDEObject(Ab)){AX.addMenuItem(mstrmojo.desc(6050,"Thresholds..."),"",function(){AV.openThresholdEditor(Af,AW,Ad);},this);if(Ab!==AB){if(Aa){AX.addMenuItem(AY,"",function(){var Ag=[];f(AS,Aa,Ab,Ag,Af.t);AS.controller.submitUndoRedoTemplateUpdates(AS,Ag);},this);}}}},moveSubTotals:function Z(AS,AT){var AU=this;K(this).execute({execute:function AV(){var AX=AU.xtab,AW=AX.k;this.submit(AU.docModel.getDataService().getUpdateTemplateAction(AW,AU.getMoveSubTotalAction(AS.data,AT,AW)),AX.controller._getXtabCallback(AX));}});},getAttributeFormsInTemplate:function(AU){var AS=this.data.gts,AT=[];(AS.row||[]).concat(AS.col||[]).forEach(function(AV){if(AV.id===AU&&AV.fs){AT=AT.concat(AV.fs);}});return AT;},getPivotFormAction:function(Ac,AT,AY){var AU=this.getCellTitleInfo(Ac),AZ=AU.title,AV=AZ.fs,AW=AZ.id,AX=this.getAttributeFormsInTemplate(AW),Ab=(AZ.fix&&AZ.fix-1)||(Ac.fi||0),AS=AX[Ab],Aa;if(AT==="l"){Aa=Ab-1;}else{if(AT==="r"){Aa=Ab+1;}}return{act:"pivot",unitPos:Aa+1,attFormId:AS.id,unitId:AW,unitType:AY||"",originUnitPos:Ab+1};},getValuesDefaultFormatGridZoneAction:function(AZ,AW){var AU={},Ag,Ae=this.xtab,AX=Ae&&Ae.gridInfo,AT=AX&&AX.fmts,AY=[],Ad,AV={};Y.forEach(AZ,function(Ah){AY.push({unitId:Ah.did,unitType:L,regions:["g"]});});if(AT){var Aa=AT.va,Ac=AT.rh,AS=AT.ch;Y.forEach(AT.va,function(Ai,Ah){Ad=AM.getFormatPropertyInfo(Ah);if(Ad&&Ad.ps!==AM.ENUM_PROPERTY_SETS.FORMATTING_NUMBER){AU=Y.mergeHashes(AU,AM.getFormatUpdate(Ah,(Ad.pt==B)?Ai:AM.decodeValue(Ah,Ai)));}});var Af=Aa[g]?Aa:(Ac[g]?Ac:AS),Ab;t.forEach(d,function(Ah){Ad=AM.getFormatPropertyInfo(Ah);if(Ad){Ab=Af[r[Ah]];AU=Y.mergeHashes(AU,AM.getFormatUpdate(Ah,AM.decodeValue(Ah,Ab)));}});}AV.skipSubtotals=AW;Ag=Ae.model.getZoneFormatAction.call(Ae.model,"va",AU,Ae.k,AV);Ag.units=[].concat(AY);return Ag;},getRAExpandAction:function J(AT,AY,AV){var AX=this.getCellTitleInfo(AT).title.id,AW=this.docModel.getDEObject(AX),AS={act:"raExpandCollapse",sliceId:AY,depth:AT.dpt,ordinal:(AT.o!==undefined)?AT.o:AT._ei,id:AT._e&&AT._e.id,isExpand:AV?1:(AT.epd?0:1)},AU=v(this);if(AV){AS.expand_dsts=1;}AS[AW?"deId":"attId"]=AX;if(AU.length>0){AS.partialRetrieval={nodes:AU};}return AS;},getRAExpandAllAction:function AQ(AW,AV){var AU=this.docModel.getDEObject(AW),AS={act:"raExpandCollapseAll",isExpandAll:AV?1:0},AT=v(this);AS[AU?"deId":"attId"]=AW;if(AT.length>0){AS.partialRetrieval={nodes:AT};}return AS;},getCreateCSVizActions:function h(AT,AU,Ak,AS){var Aa=[],AZ=[],Ah=this.docModel,Ae=Ah.getDataService(),Ab=Ah.getVizContentPanel(),AY=Ab.k,Ao=this.xtab,AX=Ao.k,AW=Ao.parent;Aa.push({act:"macroCopyUnit",newKey:Ak,unitType:X.GRID,unitKey:AX,toKey:AY,partialRetrieval:{nodes:[Ak]}});var Ai=Ah.clearVisAsFilterAction(AW),Af=Ai&&Ai.actions;t.forEach(Af,function(Ap){if(!Ap.controlKey){Ap.nodeKey=Ak;Aa.push(Ap);}});var Ad=AW.parent.children,Ac,AV=Ao.getFilterType()===1;t.forEach(Ad,function(Ar){if(t.find(Ar.defn&&Ar.defn.an,"k",AX)!==-1){Aa.push({act:"associateNodes",nodeKey:Ar.k,targetKeys:[Ak]});var Aq=Ar.boxContent.selectorControl;if(Aq){var Ap=As===undefined||AV,As=Ap?Ah.getNextKey():As;Aa.push({act:"addVisToFilter",parentKey:AX,targetKey:Ak,ctrlKey:Aq.ckey,newCGB:Ap,cgbKey:As});}}});t.forEach(Ad,function(Aq){var Ap=Aq.defn,Ar=(Ap&&Ap.tks||"").split("\u001E");t.forEach(Ar,function(As){if(As===AX){var Av=Ap.ck,Au=Ap.srct,At=Ap.srcst,Aw=(Au===I.Consolidation&&At!==x.ConsolidationManaged)||Au===I.Filter;Aa.push(Ae.getAddCtrlTargetAction(Av,Ak,Ak,Aw));}});});var Aj=this.data,Al=Aj.gsi,Am=this,Ag=function(Ap,Aq){t.forEach(Ap,function(As,Ar){if(As.did==="-1"){t.forEach(Al.mx,function(Aw,Au){var Av=Y.copy(Aw);Av.axis=-1;Av.unitPos=Au+1;AZ.push(Am.getRemoveTemplateUnitAction(Av));});}else{if(As.did!==AT.id){var At=Y.copy(As);At.axis=Aq;At.unitPos=Ar+1;AZ.push(Am.getRemoveTemplateUnitAction(At));}}});};Ag(Al.rows,1);Ag(Al.cols,2);if(AU===2){AZ.push(this.getPivotUnitAction(1,0,AT.id,12,2,0));}AZ.push({act:"advancedProperties",props:{"Template Formatting":{ShowColumnHeaders:"-1",LockColumnHeaders:"-1"}}});var An=new AK(Aj);if(An.getColResizeScenario()!==AR){AZ.push({act:"changeXtabColWidthScenario",value:AR});}if(AS){AZ=AZ.concat(AS);}t.forEach(AZ,function(Ap){delete Ap.partialRetrieval;});Aa.push(Ae.getUpdateTemplateAction(Ak,AZ));return Aa;},getUnitNameInDataSet:function(AS){return this.docModel.findUnitNameInDataSetFromUnit(AS);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.Box","mstrmojo.Button","mstrmojo.Container","mstrmojo.ui.Pulldown","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.hash","mstrmojo.Label","mstrmojo.DynamicClassFactory","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.AllObjectsBrowser","mstrmojo.vi.ui.DatasetUnitList","mstrmojo.vi.ui.editors.ReportFilterEditor","mstrmojo.ui.CheckList","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui._HasScroller","mstrmojo.DI.DIConstants");var P=mstrmojo.hash,O=mstrmojo.dom,B=mstrmojo.css,W=mstrmojo.array,h=mstrmojo.vi.models.EnumDragSources,I=mstrmojo.DI.DIConstants,c={IN_MEMORY:1,LIVE:2},g={id:"",att:[],mx:[]},a="Selecting_how_a_dataset_accesses_its_data__Direct_.htm";var X=mstrmojo.desc(13402,"Edit Filter..."),m=mstrmojo.desc(15347,"Add Filter..."),F=mstrmojo.desc(13231,"Clear All Selections");function n(p,t,r){var q=r?p.add:p.del,s=r?p.del:p.add;var u=W.find(s,"did",t.did);if(u===-1){q.push(t);}else{W.removeIndices(s,u,1);}if(!r){p.fs.add=W.filter(p.fs.add,function(v){return t.did!==v.unitId;});p.fs.del=W.filter(p.fs.del,function(v){return t.did!==v.unitId;});}}function K(q,u,s){var r=s?q.fs.add:q.fs.del,t=s?q.fs.del:q.fs.add,v=-1,p;for(p=0;p<t.length;p++){if(t[p].unitId===u.unitId&&t[p].attFormId===u.attFormId){v=p;}}if(v===-1){r.push(u);return true;}W.removeIndices(t,v,1);return false;}function N(p,q){p.set("highlightItems",q.mx.concat(q.att).map(function(r){return r.did;}));}function A(p,r){var q=p.btnHbox.warningBtn;if(r.att.length>1&&(r.mx.length-p.derivedMetricCount)===0){q.set("visible",true);window.setTimeout(function(){q.showTooltip();q._autoHideTimeout=window.setTimeout(function(){q.hideTooltip();},3000);},0);}else{q.hideTooltip();q.set("visible",false);}}function R(v){var t=v.dataset,r=v.editorContainer.unitListContainer,s=r.clearBtn,p=W.filter(t.att.concat(t.mx),function(z){return !z.um&&!z.da&&z.st!==12033;}).length,w=v.btnHbox.okBtn,x=!!W.filterOne(t.att,function(z){return(v.invalidItems||{})[z.did];}),u=v.modifiedItems,q=!!u.add.length||!!u.del.length||!!u.fs.add.length||!!u.fs.del.length||((u.filter||null)!==(t.filter||null))||!!u.convert;s.set("itemCount",p);s.set("visible",p!==0);w.set("enabled",!!p&&q&&!x);}function U(q,r,p){W.forEach(q,function(s){n(p,s,true);s.isNew=true;W.insert(s.t===4?r.mx:r.att,null,[s]);});this.updateScrollbars();N(this.editorContainer.objectBrowser,r);A(this,r);R(this);}function L(q){var p,r=this,s=r.dataset;W.forEach(q,function(t){p=t.t===4?s.mx:s.att;n(r.modifiedItems,t,false);W.removeIndices(p,W.find(p,"did",t.did),1);});r.set("dataset",P.copy(s));r.updateScrollbars();N(r.editorContainer.objectBrowser,s);A(r,s);R(r);}function M(q,r,p){if(mstrApp.serverRequest){mstrApp.serverRequest(q,r,p);}else{window.$MAPF=function(){return false;};this.getServerProxy().request(r,q,false,p);}}function E(q,s,p){var r=[];W.forEach(q,function(t){if((t.t===4&&W.find(s,"did",t.did)===-1)||(t.t!==4&&W.find(p,"did",t.did)===-1)){r.push(t);}});return r;}function e(q,p){return function(){var u=[],v=null,t=new mstrmojo.ui.menus.EditorConfig({data:{item:p},contents:[{alias:"fs",scriptClass:"mstrmojo.ui.CheckList",selectedIndices:u,postBuildRendering:function(){var x=this.itemsContainerNode.childNodes;W.forEach(this.items,function(AA,z){if(AA.idf){mstrmojo.css.addClass(x[z],"disableOption");return false;}});},preselectionChange:function s(z){var x=z.removed&&z.removed[0];if(z.removed&&this.items[x].idf){this.selectedIndices[x]=true;return false;}return true;}}],okBtnText:mstrmojo.desc(1442,"Ok"),setAllItems:function(x){this.contents[0].items=x;this.set("contents",this.contents);},fnOk:function w(AC,AB){var z=q.parent.parent.parent,AD=AB.fs,AA=AD.selectedIndices,x=AD.items,AE=1;P.forEach(v,function(AF,AG){if(AF){K(z.modifiedItems,{act:"removeAttrFormFromDataset",unitId:p.did,attFormId:x[AG].id},false);p.fs[AG].obf=false;}});P.forEach(AA,function(AF,AH){if(AF){var AG=K(q.parent.parent.parent.modifiedItems,{act:"addAttrFormToDataset",unitId:p.did,attFormId:x[AH].id,unitPos:AE},true);if(AG){AE++;}p.fs[AH].obf=true;}});R(z);}});var r=[];W.forEach(p.fs,function(x){r.push({id:x.fid,n:x.fnm,idf:x.idf});if(x.obf||x.idf){u[r.length-1]=true;}});if(!v){v=P.cloneArray(u);}t.setAllItems(r);return t;};}function S(t){return{scriptClass:"mstrmojo.vi.ui.DatasetUnitList",alias:t+"List",cssClass:t+"Unitlist",cssDisplay:"inline-block",multiSelect:true,draggable:false,useListModKeys:true,tooltipOpenDelay:0,postCreate:function(){this.avatarCssClass+=" noIcon";},doItemSelect:function(AA,v){var z=this,w=O.isMetaKey(v.hWin,v.e);if(!w){W.forEach(this.parent.allList,function(AC){if(AC!==z.alias){z.parent[AC].clearSelect();}});}if(typeof v.getTarget==="function"){var AB=v.getTarget();if(AB.className.indexOf("clsx")!==-1){var x=this.parent.parent.parent;L.call(x,[AA]);return ;}}this.constructor.prototype.doItemSelect.call(this,AA,v);},onItemContextMenu:function q(AF,AE){var AB=AE.e,w=this.getItemNodeFromTarget(AE.getTarget()),z=AE.hWin,x=this.getSelectedItems().some(function(AG){return AG.itemNode===w;});if(AF&&!x){this.doItemSelect(AF,AE);}var AC=AE.getTarget(),AD=this.parent.getSelectedItems();if(AD.length){this.closePopup();var AA=AD&&AD.length>1,v=AA?"showMultiSelectionMenu":"showItemMenu";this[v](AA?AD:AF,this.getItemNodeFromTarget(AC),mstrmojo.dom.getMousePosition(AB,z));return true;}},hasTooltipContent:function(v,w){return(!!v&&!!v.n)||(this.parent.parent.parent.invalidItems||{})[v.did];},getItemTooltip:function(w,z,x){var v=this.constructor.prototype.getItemTooltip.call(this,w,z,x);if(v){if(z.classList.contains("invalid")){v.content=mstrmojo.desc(15392,"This is an invalid object. Please remove it before adding this dataset to the Dossier.");v.cssClass+=" vi-warning triangle-warning";v.left=v.left+102;return v;}v.refNode=z;v.top=-5;if(w.t===mstrmojo.warehouse.EnumObjectTypes.METRIC){v.left=z.getBoundingClientRect().width+12;v.posType=mstrmojo.tooltip.POS_TOPLEFT;v.cssClass="vi-regular vi-tooltip-C";}else{v.left=-4;v.posType=mstrmojo.tooltip.POS_TOPRIGHT;v.cssClass="vi-regular vi-tooltip-D";}return v;}return null;},getItemProps:function r(AB,v){var z=this.constructor.prototype.getItemProps.call(this,AB,v),x=this.parent.parent.parent,AC=x.dataset,AA=AB.did,w=W.find(AC[t],"did",AA);AC[t][w].isNew=false;z.addCls((x.invalidItems||{})[AA]?"invalid":"");return z;},getAttributeForms:function s(v,w){M.call(this,{taskId:"getAttributeForms",styleName:"VIMojoAttributeStyle",attributeID:v,displayedForms:0},w,{showProgress:false});},showItemMenu:function u(AB,z,v){var AD=new mstrmojo.ui.menus.MenuConfig({position:v,isHostedWithin:false}),x=this.parent.parent.parent;AD.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){L.call(x,[AB]);});if(AB.t===12){var w=AB.fs,AA=function(){if(w.length>1){AD.addPopupMenuItem(mstrmojo.desc(14327,"Available Attribute Forms"),"",e(this,AB));}}.bind(this);if(!w){var AC=function AC(){this.getAttributeForms(AB.did,{success:function(AF){var AE=x.dataset.att;w=AB.fs=AE[W.find(AE,"did",AB.did)].fs=(AF.fms||[]).map(function(AG){return{fid:AG.did,fnm:AG.n,obf:!!AG.obf,idf:!!AG.idf};});AA();this.openPopup(AD.newInstance());}.bind(this),failure:function(AE){mstrmojo.alert(AE.message);}});}.bind(this);if(mstrApp.isSingleTier){x.editorContainer.objectBrowser.dataProvider.loadObjects([AB],{success:function(){AC();}});}else{AC();}return ;}AA();}this.openPopup(AD.newInstance());},showMultiSelectionMenu:function p(w,z,v){var AA=new mstrmojo.ui.menus.MenuConfig({position:v,isHostedWithin:false}),x=this.parent.parent.parent;AA.addMenuItem(mstrmojo.desc(629,"Delete"),"",function(){L.call(x,w);});this.openPopup(AA.newInstance());},getAllItems:function(){return this.dataset&&W.filter(this.dataset[t],function(v){return !v.um&&!v.da&&v.st!==12033;});},filterItems:function(v){return v;},bindings:{dataset:"this.parent.parent.parent.dataset"}};}mstrmojo.vi.ui.DatasetEditorContent=mstrmojo.DynamicClassFactory.newComponent(mstrmojo.Box,[mstrmojo.vi.ui._IsDropTarget,mstrmojo.vi.ui._HasUnitListAvatar],{allowDrop:function(r){var t=r.src.data,q=t.items,s=this.dataset,u=s.mx,p=s.att;return E(q,u,p).length&&t.src===h.ALL_OBJECT_LIST;},isDragValid:function Q(p){return !isNaN(parseInt(p.src.node.getAttribute("idx"),10))||this._super(p)||false;},ondragstart:function b(q){var s=null,r=this,p=function(t){return O.contains(t.domNode,q.src.node,true,t.domNode);};W.forEach(this.allList,function(t){if(p(r[t])){s=r[t];return false;}});if(s){s.selectDragNode(q);}this._super(q);}});var j=mstrmojo.Button.newWebButton(mstrmojo.desc(118,"Save"),function(){var AC=this.parent.parent,u=AC.dataset,r=AC.docModel.datasets,t=[],AA=AC.modifiedItems.fs.add.concat(AC.modifiedItems.fs.del),x={act:"addUnitToDataset"},z={act:"removeBaseUnitFromDataset"},v={act:"setDatasetFilter",useJson:false},s="$GUID_141",AB=0;if(AC.modifiedItems.convert){t.push(AC.modifiedItems.convert);AB=W.indexOf(P.keyarray(r),u.did)+1;x.dsidx=z.dsidx=v.dsidx=AB;W.forEach(AA,function(AD){AD.dsidx=AB;});}else{if(!u.did&&AC.modifiedItems.add.length){var q=u.dsm===c.LIVE;if(AC.modifiedItems.create){AC.modifiedItems.create.idd=q;}t.push(AC.modifiedItems.create||{act:"createDataset",prm:true,mgo:true,idd:q,newObjectIds:[s]});var p=AC.docModel.getSelectedViUnit().getZonesModel();if(p){t.push({act:"editNode",nodeKey:p.getHost().k,datasetId:s});}t=t.concat(AC.docModel.getOpenDatasetPanelAction());x.dsid=v.dsid=s;W.forEach(AA,function(AD){AD.dsid=s;});}else{if(u){var w=u.did;x.dsid=z.dsid=v.dsid=w;W.forEach(AA,function(AD){AD.dsid=w;});}}}W.forEach(AC.modifiedItems.add,function(AD){t.push(P.copy(x,{unitId:AD.did,unitType:AD.t}));});W.forEach(AC.modifiedItems.del,function(AD){t.push(P.copy(z,{unitId:AD.did,unitType:AD.t}));});t=t.concat(AA);if((AC.modifiedItems.filter||null)!==(u.filter||null)){t.push(P.copy(v,{expr:mstrmojo.fe.FilterUtils.getExprXml(AC.modifiedItems.filter)}));}if(t.length){if(!u.mngd&&!!u.did&&!AC.modifiedItems.convert){t.push({act:"datasetSaveAs",managed:false,nonDelta:true,dsID:u.did,rptName:u.name,rptDesc:"",folderID:u.pfid,saveAsOverwrite:true});}}if(AC.modifiedItems.add.length){AC.editorContainer.objectBrowser.dataProvider.loadObjects(AC.modifiedItems.add,{success:function(){AC.onOk(t);}});}else{AC.onOk(t);}if(AC.closeOnSubmit){AC.close();}},true,{alias:"okBtn"}),J=mstrmojo.Button.newWebButton(mstrmojo.desc(221,"Cancel"),function(){var p=this.parent.parent;if(p.onCancel){p.onCancel();}p.close();}),l=mstrmojo.Button.newWebButton("",null,false,{cssClass:"warningBtn",alias:"warningBtn",useRichTooltip:true,tooltipOpenDelay:0,updateTooltipConfig:function k(){var p=O.position(this.domNode);this.richTooltip={content:'<div class="name">'+mstrmojo.desc(15393,"Adding at least one metric is recommended")+'</div><div class="dsc">'+mstrmojo.desc(15394,"It may prevent attributes from different hierarchies to be cross joined.")+"</div>",cssClass:"vi-warning vi-tooltip-D A-center",left:p.x-308,top:p.y-7};},showTooltip:function o(){window.clearTimeout(this._autoHideTimeout);this._autoHideTimeout=undefined;if(this.hasOpenTooltip){this.hideTooltip();}this.constructor.prototype.showTooltip.call(this);}});function D(q){var v="dfe",u,r={},t=q.datasetFilter;function s(w){if(!w.et){return false;}if(w.et===mstrmojo.expr.ET.RLS){return false;}if(w.p){return false;}if(w.cs&&w.cs.some(function(x){return !!x.p;})){return false;}return !w.nds||w.nds.every(s);}function p(){W.forEach(q.att,function(z){if(z.t!==12||z.da){return ;}var x=z.did;r[x]={did:x,n:z.n,t:z.t,isInvalid:q.invalidItems[x],fs:z.fs};});W.forEach(q.mx,function(x){if(x.um){return ;}r[x.did]={did:x.did,n:x.n,t:x.t};});if(t){mstrmojo.expr.findTargets(t,"did",r);}var w={expr:P.clone(t),targets:P.valarray(r)};u=v&&window.mstrmojo&&mstrmojo.all[v];if(!u){u=mstrmojo.insert({id:v,scriptClass:"mstrmojo.vi.ui.editors.ReportFilterEditor",showLimits:false,objectBrowsingEnabled:true});}if(q.zIndex){u.set("zIndex",q.zIndex);}u.set("title",mstrmojo.desc(5758,"Filter Editor"));u.set("onSave",q.fnOk);u.onCancel=q.onCancel;u.set("model",w);u.set("docModel",q.docModel);u.onUpdateBrowseElementsParams=q.browseParam;u.open();}if(t&&!s(t)){mstrmojo.warn(mstrmojo.desc(15700,"The filter contains an advanced condition or a prompt that cannot be edited. Would you like to clear the existing filter?"),{confirmBtn:{t:mstrmojo.desc(13528,"Clear existing filter"),fn:function(){t=null;p();}},cancelBtn:{t:mstrmojo.desc(221,"Cancel")}},{title:mstrmojo.desc(11812,"Notification")});}else{p();}}mstrmojo.vi.ui.DatasetEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.vi.ui.DatasetEditor",cssClass:"mstrmojo-VIDatasetEditor",dataset:g,docModel:null,dataProvider:null,help:"Add_Existing_Objects.htm",modifiedItems:{add:[],del:[],fs:{add:[],del:[]},filter:undefined},useRichTooltip:false,closeOnSubmit:true,init:function(p){this.buttons=[l,j,J];this._super(p);if(!this.docModel.allowModifyReportList()){this.dataModeContainer.children=[];}j.text=this.okBtnText||mstrmojo.desc(118,"Save");},onOpen:function(){var q=this.dataset,p=this.modifiedItems;if(!q.did){q=this.dataset=P.clone(g);}else{this.updateScrollbars();}p.add=[];p.del=[];p.fs.add=[];p.fs.del=[];p.filter=q.filter;A(this,q);R(this,q.att.length+q.mx.length);this.editorContainer.filterBtn.refresh();},onPreClose:function H(){if(this.onCancel){this.onCancel();}return this._super();},setupScrollNodes:function f(){this.scrollNode=this.editorContainer.containNode;},children:[{scriptClass:"mstrmojo.Container",alias:"editorContainer",markupString:'<div class="mstrmojo-VIDatasetEditorContents"><div class="objbrowserContainer"></div><div class="datasetEditorContainer"><div class="datasetEditorTopContainer"><div class="filterLink"></div></div><div class="datasetEditorContent"><div mstrAttach:mouseout,mouseover></div></div></div></div>',markupSlots:{browserNode:function(){return this.domNode.firstChild;},filterNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},containNode:function(){return this.domNode.childNodes[1].childNodes[1].firstChild;}},onmouseout:function(){mstrmojo.css.removeClass(this.containNode.parentNode,"entered");},onmouseover:function(){mstrmojo.css.addClass(this.containNode.parentNode,"entered");},children:[{scriptClass:"mstrmojo.vi.ui.AllObjectsBrowser",alias:"objectBrowser",cssClass:"datasetEditorobjbrowser",slot:"browserNode",bindings:{model:"this.parent.parent.docModel"},dblClickOnNodes:function(p){var t=p.getTarget(),r=O.findWidget(t).data,q=this.parent.parent,s=q.dataset;if(r&&W.indexOf([4,12,1,47],r.t)!==-1){if((r.t===4&&W.find(s.mx,"did",r.did)===-1)||(r.t!==4&&W.find(s.att,"did",r.did)===-1)){U.call(q,[r],s,q.modifiedItems);}q.set("dataset",P.copy(s));}},postBuildRendering:function(){var p=this.parent.parent;this.set("dataProvider",p.dataProvider);this.set("opened",true);this.constructor.prototype.postBuildRendering.call(this);N(this,p.dataset);},allowDrop:function(p){var q=p.src.data;return q&&q.src!==h.ALL_OBJECT_LIST;},getDropAvatarIcon:function C(){return"hasIcon remove";},ondrop:function V(p){if(p.src.data.onRemove){p.src.data.onRemove(p.src.data.items);}}},{scriptClass:"mstrmojo.Button",alias:"filterBtn",slot:"filterNode",cssClass:"filterButton",disabled:false,text:m,richTooltip:{cssClass:"vi-regular V-center vi-tooltip-V disabled-filter-button",posType:mstrmojo.tooltip.POS_BOTTOMCENTER},useRichTooltip:false,updateTooltipConfig:function k(){var q=this.richTooltip,p=O.position(this.domNode);q.left=p.x+p.w-36;q.top=p.y-5;},buildRendering:function d(){var s=this.parent.parent,r=s.modifiedItems.filter,t=r&&r.nds,u=P.walk("dataset.xdaType",s),p=this.richTooltip;if(u===I.xdaType.customFreeFormSQL){this.enabled=false;this.useRichTooltip=true;p.content="<div class='info-icon long-text'></div>"+mstrmojo.desc(16297,"Adding filters at the dataset level is not supported for Free Form SQL Reports. To filter your data, add filters to the dossier via the Filter Panel or in the canvas.");}else{this.text=(r&&(!t||t.length>0))?X:m;p.content="<div class='info-icon'></div>"+mstrmojo.desc(15814,"Adding a filter at the dataset level is only supported for In-Memory data access mode.");}var q=this.constructor.prototype.buildRendering.call(this);B.toggleClass(this.domNode,"hasFilter",r);return q;},onenabledChange:function(){if(this.enabled){this.useRichTooltip=false;}else{this.useRichTooltip=true;}},onclick:function(){var s=this,r=this.parent.parent,u=r.dataset,q=r.modifiedItems.filter,p=function(z,x){var w=x.invalidItems||{};z.targets.forEach(function(AA){if(AA.isInvalid){w[AA.did]=true;}});x.invalidItems=w;x.editorContainer.unitListContainer.attList.refresh();R(x);},t=function(x){r.modifiedItems.filter=x.expr;var w=x.expr,z=w&&w.nds;p(x,r);this.text=(w&&(!z||z.length>0))?X:m;B.toggleClass(this.domNode,"hasFilter",w);s.refresh();},v=function(w){p(w,r);};if(u){D({datasetName:"- "+(u.name||mstrmojo.desc(11636,"New Dataset")),datasetFilter:q,att:r.editorContainer.unitListContainer.attList.items,mx:r.editorContainer.unitListContainer.mxList.items,invalidItems:r.invalidItems||{},docModel:r.docModel,fnOk:t,onCancel:v,browseParam:mstrmojo.emptyFn,zIndex:r.zIndex+1});}}},{scriptClass:"mstrmojo.vi.ui.DatasetEditorContent",alias:"unitListContainer",slot:"containNode",bindings:{dataset:"this.parent.parent.dataset",cssClass:function(){return"datasetEditorUnitlistContainer"+(this.dataset.idd?" noFilter":"");}},ondrop:function V(p){var s=this,r=s.parent.parent,t=r.dataset,q=E(p.src.data.items,r.dataset.mx,r.dataset.att);U.call(r,q,t,s.parent.parent.modifiedItems);r.set("dataset",P.copy(t));r.updateScrollbars();},allList:["attList","mxList"],getDragData:function Y(p){var s=this.constructor.prototype.getDragData.call(this,p),r=this,q=r.parent.parent;s.onRemove=function(t){L.call(q,t);};return s;},getSelectedItems:function(){var q=this,p=[];this.allList.forEach(function(r){p=p.concat(q[r].getSelectedItems());});return p;},children:[{scriptClass:"mstrmojo.Button",alias:"clearBtn",cssClass:"clearButton",text:F,itemCount:0,onitemCountChange:function G(){this.set("text",F+" ("+this.itemCount+")");},onclick:function Z(){var p=this.parent.parent.parent,q=p.dataset;L.call(p,q.att.concat(q.mx));}},S.call(this,"att"),S.call(this,"mx"),{scriptClass:"mstrmojo.Label",cssClass:"dragObjectMsg",bindings:{visible:"!this.parent.attList.items.length && !this.parent.mxList.items.length"},text:mstrmojo.desc(11668,"Drag objects here.")}]}]},{scriptClass:"mstrmojo.Container",slot:"buttonNode",alias:"dataModeContainer",useRichTooltip:false,richTooltip:{cssClass:"vi-regular V-center vi-tooltip-V pulldown-tooltip",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,enableHover:true,},updateTooltipConfig:function k(){var r=this.richTooltip,p=O.position(this.dataModeInfoIcon.domNode),q=this.parent;r.left=p.x+p.w-9;r.top=p.y-8;if(q.dataset.dsm){r.content=mstrmojo.desc(15813,"Switching data access mode is not supported.");}else{r.content=mstrmojo.desc(15812,"We only support one Live dataset per dossier using existing application objects. If you would like to add new objects, please edit the existing Live dataset.");}r.content+="<br /><div class='help-link-label' onclick='mstrApp.showHelpTopic(\"##HELPTOPIC##\")'>"+mstrmojo.desc(15811,"Learn more about Data Access Mode")+"</div>";r.content=r.content.replace("##HELPTOPIC##",a);},markupString:'<div class="dataModeContainer"><div class="live-mode-pulldown-label"></div><div class="live-mode-pulldown"></div><div></div></div>',markupSlots:{dataModeLabelNode:function(){return this.domNode.firstChild;},dataModePulldownNode:function(){return this.domNode.childNodes[1];},dataModeInfoNode:function(){return this.domNode.childNodes[2];}},children:[{scriptClass:"mstrmojo.Label",slot:"dataModeLabelNode",alias:"dataModeLabel",text:mstrmojo.desc(11922,"Data Access Mode"),postCreate:function(){var p=this.parent,q=p.parent;if(q.dataset.dsm||q.hasLTSDataset){p.set("useRichTooltip",true);}},postBuildRendering:function(){var p=this.parent,q=p.parent;if(q.dataset.dsm||q.hasLTSDataset){this.set("enabled",false);}this.constructor.prototype.postBuildRendering.call(this);}},{scriptClass:"mstrmojo.ui.Pulldown",slot:"dataModePulldownNode",alias:"dataModePulldown",items:[{n:mstrmojo.desc(11921,"In-Memory"),v:c.IN_MEMORY,d:mstrmojo.desc(15826,"Retrieves dataset results from a data source and stores them in memory.")},{n:mstrmojo.desc(12726,"Connect Live"),v:c.LIVE,d:mstrmojo.desc(15827,"Retrieves dataset results directly from the source.")}],getPopupListConfig:function(){var p=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);p.showTooltip=function q(v,u){if(!this.hasOpenTooltip){var t=O.eventTarget(u,v),s=this.getItemFromTarget(t);if(s){var r=this.getItemNodeFromTarget(t);this.richTooltip={content:s.d,refNode:r,cssClass:"vi-regular vi-tooltip-C pulldown-tooltip",left:149,top:0};mstrmojo._HasTooltip.showTooltip.call(this,v,u);}}};p.tooltipOpenDelay=700;return p;},postBuildRendering:function(){var p=this.parent.parent,r=p.dataset.dsm,q=p.editorContainer.filterBtn;if(r||p.hasLTSDataset){this.set("enabled",false);if(r===c.LIVE){q.set("enabled",false);}}this.selectedIndex=r?r-1:0;this.constructor.prototype.postBuildRendering.call(this);},onSelectedItemChange:function(){var p=this.parent.parent,r=p.editorContainer.filterBtn,s=function(v,u){mstrmojo.confirm("<b>"+mstrmojo.desc(15819,"Switching to Connect Live will remove the filters defined in this dataset. Would you like to continue?")+"</b><br /><br />"+mstrmojo.desc(15816,"Filter at the dataset level is only supported for In-Memory data access mode."),{confirmBtn:{t:mstrmojo.desc(7660,"Switch"),fn:v},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:u}},{title:mstrmojo.desc(15817,"Switch to Connect Live Mode"),allowHTML:true});},q=function(){p.dataset.dsm=this.selectedIndex+1;p.modifiedItems.filter=undefined;r.set("enabled",false);r.refresh();},t=function(){this.set("selectedIndex",c.IN_MEMORY-1);};if(this.selectedIndex===c.LIVE-1){if(p.modifiedItems.filter){s(q.bind(this),t.bind(this));}else{q.bind(this)();}}else{p.dataset.dsm=this.selectedIndex+1;r.set("enabled",true);r.refresh();}}},{scriptClass:"mstrmojo.Label",slot:"dataModeInfoNode",alias:"dataModeInfoIcon",cssClass:"info-icon",richTooltip:{cssClass:"vi-regular V-center vi-tooltip-V pulldown-tooltip",posType:mstrmojo.tooltip.POS_BOTTOMCENTER,enableHover:true,},useRichTooltip:false,updateTooltipConfig:function k(){var q=this.richTooltip,p=O.position(this.domNode);q.left=p.x+p.w-9;q.top=p.y-9;q.content=mstrmojo.desc(15818,"You can determine how a dossier accesses data in this dataset. The dataset access mode determines whether the data is loaded in-memory or retrieved directly from the source.");q.content+="<br /><div class='help-link-label' onclick='mstrApp.showHelpTopic(\"##HELPTOPIC##\")'>"+mstrmojo.desc(15811,"Learn more about Data Access Mode")+"</div>";q.content=q.content.replace("##HELPTOPIC##",a);},postCreate:function(){var p=this.parent.parent;if(p.dataset.id===""&&!p.hasLTSDataset){this.useRichTooltip=true;}}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.expr","mstrmojo.Table","mstrmojo.CheckBox","mstrmojo.UUID","mstrmojo.ME.LevelInputBox","mstrmojo.ME.ConditionInputBox","mstrmojo.ME.TransformInputBox","mstrmojo.ME.MetricDataService","mstrmojo.Button","mstrmojo.Box","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.vi.ui.editors.FilterEditor","mstrmojo.vi.enums.EnumFeatures","mstrmojo.fe.FilterUtils","mstrmojo.ME._HasConditionMetricFilterEditor","mstrmojo.ME.DerivedMetricOptions");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,2827,3324,3377,4788,6223,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853,15004,15646);var U=mstrmojo.expr,I=mstrmojo.array,X=mstrmojo.css,e=mstrmojo.dom,R=mstrmojo.hash,G=mstrmojo.UUID,j=mstrmojo.mstr.EnumDSSXMLObjectTypes,a=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,W=mstrmojo.ME._MetricEditorHelper,B=mstrmojo.ME.MetricToken.brackets,P=mstrmojo.vi.enums.EnumFeatures,f=mstrmojo.desc(15004,"Filter Applied"),A=mstrmojo.desc(15347,"Add Filter..."),g=mstrmojo.fe.FilterUtils.getExprXml,J=mstrmojo.ME.DerivedMetricOptions.isNonAFB;var Q,O;var F=function(){var E=this.isDME?mstrmojo.desc(12178,"Visualization level"):mstrmojo.desc(1107,"Report Level");return mstrmojo.hash.copy({n:E,did:-1,t:-1,state:0});};var k={level:-4,condition:-5,transformation:-6,simple:-7},b=function(E){return E===-4||E===-5||E===-6||E===-7;};var h={n:"",did:"-1",desc:""},D={1:"+",2:"*",3:"%",4:""},H={1:"",2:"!",3:"<",4:">",5:"<|",6:">|"};mstrmojo.ME._HasLevel=mstrmojo.provide("mstrmojo.ME._HasLevel",R.copy(mstrmojo.ME._HasConditionMetricFilterEditor,{_mixinName:"mstrmojo.ME._HasLevel",isAggFunction:false,init:function d(E){if(this._super){this._super(E);}Q=this.id;O=this;},onOpen:function N(){if(this._super){this._super();}if(!this.isAggFunction){return ;}O=this;var q=this.getLCTDefFromTokens();this.updateToggleBarStatus(q);var t=this.metricLCT.levelInput;t.set("candidates",this.getCandidates4LCT([U.TP.ATTR,U.STP.NDE]));t.set("items",q.level);var u=this.metricLCT.conditionInput;if(!this.isDME){if(!this.noCache&&!u.candidates){mstrmojo.ME.MetricDataService.getFilters({pattern:"*",blockBegin:1,blockCount:-1},{success:function(v){if(v){u.set("candidates",{items:v.items,isComplete:(v.bc===-1||(v.bb+v.bc>v.sz))});}},failure:function(v){mstrmojo.alert(v.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{u.candidates=this.getCandidates4LCT([U.TP.FILTER,U.STP.PROMPT_OBJECTS]);this.metricLCT.lblCondition.set("visible",q.filter.length>0);}u.set("items",q.filter);}var E=this.metricLCT.transformInput;if(!this.noCache&&!E.candidates&&!this.isDME){mstrmojo.ME.MetricDataService.getTransformations({pattern:"*",blockBegin:1,blockCount:-1},{success:function(v){if(v){E.set("candidates",{items:v.items,isComplete:(v.bc===-1||(v.bb+v.bc>v.sz))});}},failure:function(v){mstrmojo.alert(v.getResponseHeader("X-MSTR-TaskFailureMsg"));}});}else{E.candidates=this.getCandidates4LCT(U.TP.ROLE);this.metricLCT.lblTransform.set("visible",q.tranformation.length>0);}E.set("items",q.tranformation);var p=this.metricLCT.addFilterBox,n=p.btnAddFilter,r=p.btnClearFilter,m=this.oi&&this.oi.conditions&&this.oi.conditions[0],o=m&&m.exp,s=q.filter&&q.filter[0],l={did:s&&s.did,n:s&&s.n,exp:o,isEmbedded:!!(o||(!s))};n.set("filter",l);r.set("filter",l);},hasConditionFilter:function V(){var l=this.metricLCT.addFilterBox,E=l.btnAddFilter;return !!(E.filter&&E.filter.did);},clearConditionFilter:function c(){var m=this,n=m.metricLCT.addFilterBox,l=n.btnAddFilter,E=n.btnClearFilter;l.set("filter",{isEmbedded:true});E.set("filter",{isEmbedded:true});m.onmetricModify();},onMpsChange:function M(){var m=this,n=m.metricLCT.addFilterBox,l=n.btnAddFilter,E=n.btnClearFilter;l.refresh();E.refresh();},useEmbeddedFilter:function C(){return this.isDME&&!this.ide.disableConditionMetric;},getLCTDefAsTokens:function S(){if(!this.isAggFunction){return[];}var u=this.metricLCT.levelInput.getSelectedObjects(),o=this.useEmbeddedFilter()?this.metricLCT.addFilterBox.btnAddFilter.getFilterObj():this.metricLCT.conditionInput.getSelectedObjects(),m=this.metricLCT.transformInput.getSelectedObjects(),r=[],l,n,p,E=function(w,v){return w.filtering===1?"("+v+")":v;};r.push({v:"{",isDelimiter:true});var s=null;for(n=0,p=u.length;n<p;n++){s=u[n];r.push({v:H[s.grouping],isDelimiter:true});if(W.isDimty(s.n)){r.push({v:E(s,s.n)});}else{if(/^@/.test(s.did)){r.push({v:E(s,s.did)});}else{if(s.did===-1){r.push({v:"~",isDelimiter:true});}else{r.push({v:B(s.n),oi:s});}}}r.push({v:D[s.filtering],isDelimiter:true});if(n<(p-1)){r.push({v:", ",isDelimiter:true});}}if(!this.levelFilterRest){r.push({v:";",isDelimiter:true});r.push({v:"-",isDelimiter:true});}if(!this.levelCanContinue){r.push({v:";",isDelimiter:true});r.push({v:"/",isDelimiter:true});}r.push({v:"}",isDelimiter:true});if(o.length>0){r.push({v:"<",isDelimiter:true});l={v:B(o[0].n)};if(o[0].did){l.oi=o[0];}r.push(l);r.push({v:";",isDelimiter:true});r.push({v:"@",isDelimiter:true});r.push({v:this.conditionEmbedMethod});r.push({v:";",isDelimiter:true});r.push({v:this.conditionIgnoreFilterElem?"-":"+",isDelimiter:true});r.push({v:">",isDelimiter:true});}var t=I.indexOf(m,h);p=t<0?m.length:t;if(p>0){r.push({v:"|",isDelimiter:true});var q=null;for(n=0;n<p;n++){q=m[n];l={v:B(q.n)};if(q.did){l.oi=q;}r.push(l);if(n<(p-1)){r.push({v:", ",isDelimiter:true});}}r.push({v:"|",isDelimiter:true});}for(n=0,p=r.length;n<p;n++){r[n].isNew=true;}return r;},getLCTDefFromTokens:function Y(){var l=[],n=false,s=[],q=[],u=this.oi.tks.items,t=u.length,r;if(this.insertMode||t===0){l.push(F.call(this));}else{for(r=0;r<t;r++){var o=u[r],v=o.tp,m=o.sctt;switch(m){case 262144:n=true;switch(v){case 64:case 126:case 264:case 265:case 310:var p=r,w;if(v===64){var E=o.v+u[++r].v;o=u[r+1];if(o.tp===43||o.tp===45){E+=u[++r].v;E+=u[++r].v;}else{if(o.tp===41){r++;}}w=mstrmojo.ME.Enum.DYNAMIC_DIMTY.getDimtyObject(E,this.isDME);}else{w=v===126?F.call(this):o.oi;}w.grouping=1;w.filtering=4;switch(u[p-1].tp){case 33:w.grouping=2;break;case 60:w.grouping=3;break;case 62:w.grouping=4;break;case 297:w.grouping=5;break;case 298:w.grouping=6;break;}switch(u[r+1].tp){case 37:w.filtering=3;break;case 42:w.filtering=2;break;case 43:w.filtering=1;break;}l.push(w);break;case 45:this.levelFilterRest=false;break;case 47:this.levelCanContinue=false;break;}break;case 327680:switch(v){case 270:case 273:s.push(o.oi);break;case 262:this.conditionEmbedMethod=o.v;break;case 43:this.conditionIgnoreFilterElem=false;break;case 45:this.conditionIgnoreFilterElem=true;break;}break;case 393216:switch(v){case 271:q.push(o.oi);break;}break;}}if(l.length===0&&!n){l.push(F.call(this));}}return{level:l,filter:s,tranformation:q};},levelCanContinue:true,levelFilterRest:true,conditionEmbedMethod:"2",conditionIgnoreFilterElem:true,_set_candidates:function(p,l){this.candidates=l;if(this.hasRendered){var E=this.metricLCT.levelInput,m=this.metricLCT.conditionInput,o=this.metricLCT.transformInput;E.candidates=this.getCandidates4LCT([U.TP.ATTR,U.STP.NDE]);m.candidates=this.getCandidates4LCT([U.TP.FILTER]);o.candidates=this.getCandidates4LCT([U.TP.ROLE]);}return true;},getCandidates4LCT:function L(n,E){var m=this.candidates,l;if(m){n=I.ensureArray(n);l=I.filter(m.items,function(o){return I.indexOf(n,o.t)>-1||I.indexOf(n,o.st)>-1;});if(I.indexOf(n,12)>-1&&E){if(this.replaceAttributeWithForms){l=this.replaceAttributeWithForms(l);}}return{items:l,isComplete:m.isComplete};}return null;},updateToggleBarStatus:function K(E){var l=false;if(E.level){l=E.level.length>1||E.level.length===1&&E.level[0].did!==-1;}if(E.filter){l=l||E.filter.length>0;}if(E.transformation){l=l||E.transformation.length>0;}if(b(this.did)){l=true;}this.metricLCT.toggle.set("selected",l);},levelAdvRef:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(9577,"Level Advanced Options"),help:"Level_Advanced_Options_dialog_box.htm",cssClass:"mstrmojo-ME-level-options",onOpen:function(){var E=this.opener;this.contentTable.ccCheckBox.set("checked",E.levelCanContinue);this.contentTable.frCheckBox.set("checked",E.levelFilterRest);},children:[{scriptClass:"mstrmojo.Table",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.CheckBox",alias:"ccCheckBox",slot:"0,0",label:mstrmojo.desc(9583,"Allow other users to add extra units to this definition")},{scriptClass:"mstrmojo.CheckBox",alias:"frCheckBox",slot:"1,0",label:mstrmojo.desc(9584,"Include filter attributes which are not in report or level in metric calculation")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveLevelOptions(E.contentTable.ccCheckBox.checked,E.contentTable.frCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},conditionAdvRef:{scriptClass:"mstrmojo.Editor",title:"Condition Advanced Options",help:"Condition_Advanced_Options_dialog_box.htm",cssText:"width: 286px;",onOpen:function(){var E=this.opener;this.contentTable.emPulldown.set("value",E.conditionEmbedMethod);this.contentTable.irfeCheckBox.set("checked",E.conditionIgnoreFilterElem);},children:[{scriptClass:"mstrmojo.Table",cssText:"margin-top:5px;",alias:"contentTable",rows:3,cols:1,children:[{scriptClass:"mstrmojo.Label",slot:"0,0",text:mstrmojo.desc(9585,"Interaction between metric filter and report filter: ")},{scriptClass:"mstrmojo.Pulldown",alias:"emPulldown",itemField:"n",itemIdField:"did",slot:"1,0",value:"2",items:[{n:mstrmojo.desc(9586,"Merge into new"),did:"1"},{n:mstrmojo.desc(9587,"Merge report filter into metric"),did:"2"},{n:mstrmojo.desc(9588,"Merge metric condition into report"),did:"3"}]},{scriptClass:"mstrmojo.CheckBox",alias:"irfeCheckBox",slot:"2,0",label:mstrmojo.desc(9589,"Ignore related report filter elements")}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(1442,"OK"),onclick:function(){var E=this.parent.parent;E.saveConditionOptions(E.contentTable.emPulldown.value,E.contentTable.irfeCheckBox.checked);E.opener.onmetricModify();E.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var E=this.parent.parent;E.close();}}]}]},getLCTComponent:function Z(){return{scriptClass:"mstrmojo.Table",cssClass:"mstrmojo-ME-LCT",alias:"metricLCT",layout:[{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{cssText:"width:252px;padding-right:6px;"}]},{cells:[{cssClass:"mstrmojo-SME-label mstrmojo-ME-LCT-label"},{}]}],bindings:{visible:function(){return this.parent.isAggFunction;}},labelWidth:"auto",children:[{scriptClass:"mstrmojo.Button",cssClass:"toggle",alias:"toggle",text:mstrmojo.desc(6223,"Show All"),selected:false,bindings:{visible:function(){return !this.parent.parent.isDME;}},onclick:function(){var o=!this.selected;this.set("selected",o);},slot:"0,0"},{scriptClass:"mstrmojo.Label",alias:"lblLevel",text:mstrmojo.desc(4788,"Level"),bindings:{visible:function(){return this.parent.parent.isDME||!this.parent.parent.isDME&&this.parent.toggle.selected;},width:"this.parent.labelWidth"},onwidthChange:function(){if(this.hasRendered){this.domNode.style.width=this.width;}},slot:"1,0"},{scriptClass:"mstrmojo.ME.LevelInputBox",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),alias:"levelInput",dtp:-4,xacptSugItemOnly:true,bindings:{noCache:function(){return this.parent.parent.noCache;},isDME:function(){return this.parent.parent.isDME;},visible:function(){return this.parent.lblLevel.visible;}},reportLevelAdded:true,onadd:function(){var o=this.getSelectedObjects();this.set("reportLevelAdded",I.find(o,"did",-1)>-1);},onremove:function(){var o=this.getSelectedObjects();this.set("reportLevelAdded",I.find(o,"did",-1)>-1);},onitemchange:function(){this.parent.parent.onmetricModify();if(O.updateScrollbars){O.updateScrollbars();}},onSaveOnClose:function(){this.parent.parent.onmetricModify();},slot:"1,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold",text:mstrmojo.desc(9577,"Level Advanced Options"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},onclick:function(){var o=this.parent.parent;o.openPopup("levelAdvRef",{saveLevelOptions:function(q,p){o.levelCanContinue=q;o.levelFilterRest=p;},zIndex:o.zIndex+10});},slot:"1,1"},{scriptClass:"mstrmojo.Label",alias:"lblCondition",text:mstrmojo.desc(9579,"Condition"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"2,0"},{scriptClass:"mstrmojo.ME.ConditionInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-condition singleObject",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(1281,"Filter").toLowerCase()),alias:"conditionInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblCondition.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();},slot:"2,1"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ME-link-text right bold condition",text:mstrmojo.desc(9581,"Condition Advanced Options"),bindings:{visible:function(){return this.parent.lblCondition.visible&&!this.parent.parent.isDME;}},onclick:function(){var o=this.parent.parent;o.openPopup("conditionAdvRef",{saveConditionOptions:function(q,p){o.conditionEmbedMethod=q;o.conditionIgnoreFilterElem=p;},zIndex:o.zIndex+10});},slot:"2,1"},{scriptClass:"mstrmojo.Label",alias:"lblTransform",text:mstrmojo.desc(3324,"Transformation"),bindings:{visible:function(){return !this.parent.parent.isDME&&this.parent.toggle.selected;}},slot:"3,0"},{scriptClass:"mstrmojo.ME.TransformInputBox",cssClass:"mstrmojo-ME-ObjectInputBox-transform",emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),alias:"transformInput",dtp:-4,xacptSugItemOnly:true,bindings:{visible:function(){return this.parent.lblTransform.visible;},isDME:function(){return this.parent.parent.isDME;},noCache:function(){return this.parent.parent.noCache;}},onitemchange:function(){this.parent.parent.onmetricModify();if(O.updateScrollbars){O.updateScrollbars();}},slot:"3,1"},{scriptClass:"mstrmojo.Label",alias:"lblFilter",text:mstrmojo.desc(1281,"Filter"),bindings:{visible:function(){return !!(this.parent.parent.isDME&&!this.parent.parent.ide.disableConditionMetric);}},slot:"4,0"},{scriptClass:"mstrmojo.Box",alias:"addFilterBox",slot:"4,1",cssClass:"addFilterBox",bindings:{visible:function(){return !!(this.parent.parent.isDME&&!this.parent.parent.ide.disableConditionMetric);}},children:[{scriptClass:"mstrmojo.Button",alias:"btnAddFilter",text:A,cssClass:"btnAddFilter",cssDisplay:"inline-block",getFilterObj:function m(){var p=this.filter,o=p&&p.isEmbedded;if(!p||!p.did){return[];}if(o){return[].concat(p.exp?{did:p.did,t:j.Filter,st:a.Filter,n:p.n,isEmbedded:true,condition:{did:p.did,exp:p.exp}}:[]);}return[{did:p.did,t:j.Filter,st:a.Filter,n:p.n}];},onfilterChange:function(){this.refresh();},buildRendering:function l(){if(!this.filter){this.filter={isEmbedded:true};}var s=this.filter,t=this.parent.parent,r=t.parent,u=r&&r.ide,p;r=u&&u.editor;p=r&&r.oi&&r.oi.mps;this.text=(s.did)?f:A;var q=this.constructor.prototype.buildRendering.call(this);X.toggleClass(this.domNode,"hasFilter",s.did);this.set("enabled",s.isEmbedded&&(!J(p)));var o=!!(s.did||(mstrApp.isVI&&t.parent.useEmbeddedFilter()));t.lblFilter.set("visible",o);t.addFilterBox.set("visible",o);return q;},useRichTooltip:true,updateTooltipConfig:function n(){var q=e.position(this.domNode),p=this.parent.parent.parent,r=p&&p.ide;p=r&&r.editor;var o=p&&p.oi&&p.oi.mps;this.richTooltip=!J(o)?null:{content:mstrmojo.desc(15646,"This metric is not configured to aggregate from the base dataset. Please go to the Metric Options to change this behavior."),cssClass:"vi-regular vi-tooltip-C A-center",left:q.x+q.w+10,top:q.y-4};},onclick:function E(){var r=this.parent.parent.parent,s=this.parent.btnClearFilter,w=r.dsUnits,u=[],x=[],z=mstrApp.getRootController().docCtrl.model,v=z&&z.getDataService(),o=this.filter,q=o&&o.exp,t=this;I.forEach(w&&w.items,function(AA){if(AA.t===j.Attribute){u.push(AA);}else{if(AA.t===j.Metric){x.push(AA);}}});var p=function(AB){var AA=G.create();t.filter={did:AA,n:AA,exp:AB.expr,isEmbedded:true};var AD=AB.expr;var AC=function(){t.text=AD?f:A;X.toggleClass(t.domNode,"hasFilter",AD);r.onmetricModify();t.refresh();s.set("filter",t.filter);};if(AD){v.createEmbeddedFilter({expr:g(AD),expJson:AD,filterId:t.filter.did,filterName:t.filter.n},{success:function(){AC();}});}else{t.filter={isEmbedded:true};AC();}};r.openConditionMetricFilterEditor({filter:q,att:u,mx:x,docModel:z,invalidItems:[],fnOk:p,onCancel:mstrmojo.emptyFn,browseParam:function(AA){AA.messageID=z.mid;AA.datasetID=z.findDatasetIdFromUnit(AA.attributeID);},zIndex:r.zIndex+1});}},{scriptClass:"mstrmojo.Button",alias:"btnClearFilter",text:mstrmojo.desc(2827,"Clear"),cssClass:"btnClearFilter",cssDisplay:"inline-block",buildRendering:function l(){var p=this.filter;var o=this.constructor.prototype.buildRendering.call(this);this.set("visible",p&&p.did);return o;},onfilterChange:function(){this.refresh();},onclick:function(){var p=this.parent.btnAddFilter,o=this.parent.parent.parent;p.set("filter",{isEmbedded:true});this.set("filter",{isEmbedded:true});o.onmetricModify();}}]}]};}}));mstrmojo.ME._HasLevel.EnumEditorComponents=k;}());(function(){mstrmojo.requiresCls("mstrmojo.DocPanel","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.ui._HasBoxLayout","mstrmojo.ui._HasScroller","mstrmojo.vi.ui.BoxLayoutConfig","mstrmojo.vi.ui.rw.VizBox","mstrmojo.vi.ui.rw.FilterBox","mstrmojo.func","mstrmojo.array","mstrmojo.hash","mstrmojo.string","mstrmojo.boxmodel","mstrmojo.models.FormatModel","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.css","mstrmojo.vi.ui._HasGroup","mstrmojo.DocDataService");var AB=mstrmojo.func,k=mstrmojo.array,U=mstrmojo.hash,D=mstrmojo.css,AF=mstrmojo.string,AE=mstrmojo.vi.models.EnumDragSources,X=mstrmojo.vi.ui.rw.VizBox.ENUM_PORTAL_STATE,r=mstrmojo.models.FormatModel,x=r.getFormatUpdate,n=r.ENUM_PROPERTY_NAMES,N=mstrmojo.vi.enums.EnumFeatures,AD=mstrmojo.vi.controllers.EnumEvents,f=mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.LAYOUT,o=768,L=11,Z=0,v=1;var w=2;function t(AL,AK){AL=AL||[];(this.children||[]).forEach(function(AN){var AM=AN.addFormatProps(undefined,AK);if(AM){AL.push(AM);}});return AL;}function c(AL,AK){AL.push(this.model.getUnitFormatAction(this,1,x(n.LAYOUT_XML,this.boxLayoutConfig.getBoxState()),AK));return AL;}function AG(){(this.children||[]).forEach(function(AK){AK.generateToolbar();});}function M(){if(this.visible){this.raiseEvent({name:"panelDisplaying"});var AM=this.node,AL=AM.defn,AN=AM.k,AK=AL._lkz;this.model.raiseEvent({name:"panelDisplaying",panelKey:AN,layoutKey:AK});}}function V(AK){D.toggleClass(this.domNode,"undraggable-uc",AK);}function B(){var AK=!mstrApp.isAppStatePresentation()&&!mstrApp.isAppStateSelection(),AL=this.domNode;D.toggleClass(this.domNode,"pulse",AK);setTimeout(function(){D.toggleClass(AL,"pulse",false);},500);}function m(AQ,AT,AS){var AR=this,AU=[],AL={},AM={},AK=this.getGroupInfo();U.forEach(AK,function(AW,AV){AW.forEach(function(AX){AM[AX]=AV;});});var AN=function(AW){if(AW.t==="c"){AW.f=true;AW.l=AW.h;var AY=AW.k,AV=AM[AY],AX;if(AV&&AV!==""){AX=AL[AV];if(!AX){AX=AL[AV]=[];}AX.push(AW);if(AU.indexOf(AX)===-1){AU.push(AX);}}else{AW.w=AT;AU.push(AW);}}else{k.forEach(AW.children,function(AZ){AN(AZ);});}};AN(AQ);var AO=[],AP=0;AU.forEach(function(AW){if(Array.isArray(AW)){var AX=AW.length,Ac,Aa,Ah,Af,Aj,Ai,Ae,AV=[],Ab,Ag,AZ,AY;var Ad=function(Ak){Ak.forEach(function(Al){Al.f=false;Al.l=parseInt(Al.w/Ab,10);});};for(AZ=0;AZ<AX;AZ++){Ac=AW[AZ];if(!Ac){continue;}Ag=Ac.h;Ah=AR.getUnitByKey(Ac.k);Aj=Ah.originalDim||Ah.domNode.style;Ah.originalDim=undefined;Ae=[Ac];Ab=Ac.w;for(AY=AZ+1;AY<AX;AY++){Aa=AW[AY];if(!Aa){continue;}Af=AR.getUnitByKey(Aa.k);Ai=Af.originalDim||Af.domNode.style;AV.push(Af);if(Aj.top===Ai.top&&Aj.height===Ai.height){Ae.push(Aa);AW[AY]=undefined;Ab+=Aa.w;}}if(Ae.length>1){Ad(Ae);AO.push({children:Ae,o:"h",t:"b",f:true,l:Ac.h,h:Ac.h,w:AT});}else{Ac.w=AT;AO.push(Ac);}AP+=Ag;}k.forEach(AV,function(Ak){Ak.originalDim=undefined;});}else{AO.push(AW);AP+=AW.h;}});return{children:AO,o:"v",t:"b",h:AP+(AO.length-1)*AS,w:AT};}mstrmojo.vi.ui.rw.DocRelativePanel=mstrmojo.declare(mstrmojo.DocPanel,[mstrmojo.vi.ui._HasBoxLayout,mstrmojo.ui._HasScroller,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.vi.ui._HasGroup],{scriptClass:"mstrmojo.vi.ui.rw.DocRelativePanel",formatHandlers:null,childPadding:4,allowPanelEdgeTargeting:true,children:null,model:null,titleText:null,previousLayout:null,subPanelCssText:"position:absolute;",markupString:'<div id="{@id}" class="mstrmojo-DocPanel {@cssClass}" style="{@cssText}{@domNodeCssText}"><div class="mstrmojo-DocSubPanel-content" style="{@containerNodeCssText}{@subPanelCssText}"><div></div></div></div>',markupSlots:{panelNode:function(){return this.domNode;},subPanelNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.firstChild;}},init:function AC(AK){this._super(AK);this.childPadding=mstrApp.getThemeProps(f).drpChildPadding;D.addWidgetCssClass(this,"mstrmojo-VIDocRelativePanel");var AL=this.id;this.controller.view.getLayout(this.node.defn._lkz).attachEventListener("layoutRedisplay",AL,function(){if(this.selected){M.call(this);}});this.markupMethods=AB.override({onvisibleChange:function(){this._super();if(this.visible){AG.call(this);}M.call(this);}},U.copy(this.markupMethods));this.boxLayoutConfig=new mstrmojo.vi.ui.BoxLayoutConfig({hostId:AL,padding:this.childPadding,needsValidation:true,getBoxChildClass:function(AM){return mstrmojo.all[AL].getBoxLayoutChild(AM).scriptClass;}});this.model.attachEventListener("viIconTabClicked",AL,function(AN){var AM=this.model.hgl;if(AN.id==="vi_flt"&&!AM){B.call(this);}});this.model.attachEventListener(AD.UPDATE_TOC,AL,function(){if(this.isPanelDisplaying()){AG.call(this);}}.bind(this));this.model.attachEventListener("visOutsideScrolled",AL,function(AM){if(this.scrollbarHostNode){this.scrollbarHostNode.scrollTop+=-AM.deltaY;this.scrollbarHostNode.scrollLeft+=-AM.deltaX;}}.bind(this));this.isInteractive=mstrApp.allowWebDashboardDesign();},onAppStateChange:function(){if(this._tgtSelections&&!mstrApp.isAppStateSelection()){this._tgtSelections.clear();}},onLayoutModeChange:function(){this.isInteractive=mstrApp.allowWebDashboardDesign()&&!mstrApp.isLayoutModePreview();if(!mstrApp.supportFeature(N.SUPPORT_RESPONSIVE_RESIZING)){var AL=this.controller.view.layoutViewer.docLayout,AK=parseInt(AL.width,10)||0;if(AK<=o){this.buildBoxLayout();}}},onremoveChild:function P(){V.call(this,!this.hasMultipleChildren());},onaddChild:function O(){V.call(this,!this.hasMultipleChildren());},setupScrollNodes:function u(){if(mstrApp.supportFeature(N.SUPPORT_RESPONSIVE)){this.scrollNode=this.subPanelNode;this.scrollbarHostNode=this.panelNode;}else{this.scrollNode=null;this.scrollbarHostNode=null;}},isPanelDisplaying:function(){return this.selected&&this.node.defn._lkz===this.model.getCurrentLayoutKey();},getLayoutOffsets:function F(){var AK=mstrApp.getThemeProps(f);return{h:8-2*w+AK.drpLOHW_Compensation,w:8-2*w+AK.drpLOHW_Compensation};},getBoxLayoutChild:function W(AK){var AL=this._super(AK);if(!AL){return this.getUnitByKey(AK.k);}return AL;},addChildren:function h(AN,AK,AL){this._super(AN,AK,AL);var AM=this.model,AQ=AM.findKeyMap(this.node);if(AQ){var AP=this.boxLayoutConfig.replaceLayoutXmlKeys(AQ);if(AP){var AO=AM.replaceKeyBoxes=AM.replaceKeyBoxes||[];AO.push(this);}}this.buildBoxLayout();},refresh:function AJ(){this.boxLayoutConfig.dirty=true;this._super();this.buildBoxLayout();},update:function l(AN){var AM=AN.defn,AK=AM&&AM.layoutXML,AL=this.boxLayoutConfig;if(AK){AL.box=AK;}else{this.defn.layoutXML=AL.useDefaultBox(AN.data.objects||[]);}this.titleText=AM&&AM.ttl;this.title=AF.encodeHtmlString(this.titleText);},hasMultipleChildren:function g(){return(this.children.length>1);},getSplitterHost:function A(){return this.containerNode;},getTargetKeysByType:function p(AK){return(this.children||[]).filter(function(AL){return(AK||[]).indexOf(parseInt(AL.defn.t,10))>-1;}).map(function(AL){return AL.k;});},getTargetKeysExcludingTypes:function Q(AK){return(this.children||[]).filter(function(AL){return(AK||[]).indexOf(parseInt(AL.defn.t,10))<0;}).map(function(AL){return AL.k;});},insertNewBoxAndSaveDeferred:function(AQ,AM,AN,AP,AK,AL){var AO=this.id;this.addChildren([AM]);this._super(AQ,AM,AN,AB.wrapMethods({failure:function(){mstrmojo.all[AO].removeChildren(AM);AM.destroy();}},AP),AK,AL);},addUnit:function I(AN,AL,AM,AP,AO){this.addChildren([AN]);var AK=this.insertNewBox(AN,AL,AM,AP);if(AP){this.addSaveBoxLayoutActions(AP,AO);}return AK;},restoreAnyMaxedVizBox:function z(){var AK=this.maximizedBox;if(!AK||!AK.isMaxed){return ;}this.setPortalState(AK,X.RESTORE,false);delete AK.isMaxed;D.toggleClass(AK.maxRestoreBtnNode,"restore",AK.isMaxed);},setPortalState:function a(AN,AK,AQ){var AL=this.id,AO=this.model,AU=AN.defn,AM=AU.ds,AS=function(AY){var AX=mstrmojo.all[AL];if(!mstrmojo.all[AN.id]){var AW=AN.k;mstrmojo.array.forEach(AX.children,function(Aa){if(Aa.k===AW){AN=Aa;return false;}});}if(!mstrmojo.all[AN.id]){return ;}var AZ=AN.isMaxed=AY===X.MAXIMIZE,AV=AZ?2:1;if(AZ){AX.maximizedBox=AN;}else{if(AY===X.RESTORE){delete AX.maximizedBox;}}V.call(this,AN.isMaxed);AN.set("zIndex",AV);AU.ds=AY;AX.buildBoxLayout();AN.generateToolbar();};if(!AQ){AO.controller.cmdMgr.execute({execute:function AR(){var AX=mstrmojo.all[AL],AY=AK===X.MAXIMIZE,AV=AY?2:1,AZ=[AO.getUnitFormatAction(AN,1,{FormattingOrder:{ZIndex:AV},FormattingView:{WindowState:AK}})];t.call(AX,AZ);this.submit(AZ,{failure:function AW(){AS(AM);}},mstrmojo.DocDataService.RAPID_EXEC);AS(AK);},urInfo:{silent:true,undo:function AT(){AS(AM);},redo:function AP(){AS(AK);}}});}else{AS(AK);}},buildBoxLayout:function K(AL,AK){if(!this.visible){return ;}if(!this.children){return ;}var AN=this.boxLayoutConfig,AP=mstrApp.isWSStyling;if(AN.needsValidation){var AM=this.children;if(!AN.validateBoxLayout(AM)){this.defn.layoutXML=AN.useDefaultBox(AM);}AN.needsValidation=false;}if(AP&&this.height&&this.width){this.height=(parseInt(this.height,10)-2*w)+"px";this.width=(parseInt(this.width,10)-2*w)+"px";}this._super(AL,AK);var AQ=this.maximizedBox;if(AQ){if(AQ.domNode){var AO=AQ.domNode.style;AQ.originalDim={top:AO.top,height:AO.height};}if(this.height!==undefined&&this.width!==undefined){AQ.updateLayout({left:"0px",top:"0px",height:this.height,width:this.width});}}if(AP&&this.height&&this.width){this.height=(parseInt(this.height,10)+2*w)+"px";this.width=(parseInt(this.width,10)+2*w)+"px";}if(mstrApp.isAppStateSelection()){this.model.raiseEvent({name:"buildBoxLayoutComplete"});}},endBoxMove:function Y(AL,AK){this._super(AL,AK);this.getSplitterHost().appendChild(AK.domNode);},getChildPositionActions:function E(AK){return t.call(this,[],AK);},getBoxLayoutActions:function AH(AK){return c.call(this,[],AK);},getBoxLayoutSaveCallback:function q(){var AK=this.id;return{success:function(){AG.call(mstrmojo.all[AK]);}};},addSaveBoxLayoutActions:function J(AN,AK){var AM=this.id,AL=AN.actions;t.call(this,AL,AK);c.call(this,AL,AK);AN.addCallbacks({success:function(){AG.call(mstrmojo.all[AM]);}});},saveBoxLayout:function e(AM,AK,AO,AN,AL){this._super(AM,AK,AO,AN,AL);this.defn.layoutXML=this.boxLayoutConfig.box;if(AN){AN.addCallbacks(this.getBoxLayoutSaveCallback());}},postBuildBoxLayout:function AA(){var AK=this.model.getLatestSelectedViUnitKey(),AL=AK&&this.getUnitByKey(AK);if(AL){this.model.selectVIUnit(AL.id);}else{this.selectFirstBox();}},postCalculateBoxLayout:function s(AL,AU,AQ){var AX=mstrmojo.vi.VisualInsightApp.LAYOUT_MODES,AR=AX.PREVIEW_TOGGLED,AY=mstrApp.supportFeature(N.SUPPORT_RESPONSIVE_RESIZING),AT=mstrApp.layoutMode,AW=this.controller.view.layoutViewer.docLayout.docSection,AP=parseInt(AW.width,10)||0;if(mstrApp.supportFeature(N.SUPPORT_RESPONSIVE)){if(AP<=o&&(AY||AT===AR)){if(!this.previousLayout){this.previousLayout=U.clone(AL);}AU.width=Math.min(AU.width,parseInt(this.width,10));var AK=AL.children,AN=AK[0];if(!(AN.h||AN.w)){AU.width-=L;AQ.call(this,AL,AU,0);AU.width+=L;}if(this.maximizedBox){if(this.previousLayout){AL=U.clone(this.previousLayout);}AU.width=parseInt(this.width,10);AU.height=parseInt(this.height,10);}else{if(AK.length>1){var AO=this.containerNode,AZ=AO&&AO.clientHeight,AS=AL.h,AV=AU.height;if((AS&&AS<AV)||(AZ&&AZ<AV)){AK.forEach(function(Aa){Aa.f=false;});AQ.call(this,AL,AU,0);}AL=m.call(this,U.clone(AL),AU.width,this.boxLayoutConfig.padding);AU.width=AL.w;AU.height=AL.h;}}if(AU.height>parseInt(this.height,10)){AU.width-=L;}if(!mstrApp.isLayoutModePreview()&&AY){mstrApp.set("layoutMode",AX.PREVIEW_RESIZE);}}else{if(AT!==AR){if(this.previousLayout){AL=U.clone(this.previousLayout);this.previousLayout=null;AU.width=parseInt(this.width,10);AU.height=parseInt(this.height,10);var AM=this.domNode;if(AM){AM.scrollTop=0;}mstrApp.set("layoutMode",AX.DEFAULT);}}else{AL=null;AW.domNode.style.left=(AP-o)/2+"px";window.setTimeout(function(){AW.set("width",o+"px");}.bind(this),0);}}}return AL;},selectFirstBox:function d(){var AL=this.firstVizBoxId||this.firstBoxId,AK=mstrApp.isAppStateSelection();if(this.visible&&AL&&!AK){this.model.selectVIUnit(AL);}},selectVIUnit:function j(AL,AK){var AN=this._tgtSelections,AM=true;if(AN){if(AL.id===AN.id){AM=false;}else{AM=AN.toggleSelection(AL.k);AN.notify();}}else{this.model.selectVIUnit(AL.id,AK);}return AM;},getUnitByKey:function S(AK){return(this.children||[]).filter(function(AL){return AL.k===AK;})[0];},enterTargetSelectionMode:function R(AP,AO,AN,AT,AM){if(!this._tgtSelections&&this.children&&this.children[0].hasRendered){this.children.forEach(function(AU){AT(AU);});var AR=this.model,AS=AR.getSelectedViUnit(),AQ=AS&&AS.id,AL={},AK=function(){return U.keyarray(AL).filter(function(AU){return AL[AU];});};this._tgtSelections={id:AO,notify:function(AV,AU){AP(AK(),!!AV,AU);},toggleSelection:function(AU){AL[AU]=!AL[AU];return AL[AU];},getSelections:function(){return AK();},remove:function(AU){if(AL[AU]!==undefined){delete AL[AU];}},restore:function(){AR.selectVIUnit(AQ,true);},clear:function(){AM();}};AR.selectVIUnit("");(AN||[]).forEach(function(AU){AR.getUnitInstance(AU,1).parent.selectVIUnit();},this);}},exitTargetSelectionMode:function H(AK,AL){var AM=this._tgtSelections;if(AM){delete this._tgtSelections;this.children.forEach(function(AN){AL(AN);});AM.restore();if(AK){AM.notify(AK);}}},unload:function C(){this.destroyChildren();this.defn.l=false;this.builtChildren=false;},getPanelTargetEdge:function AI(AK){if(AK.src.widget.parent!==this&&AK.getCtxtDragData().src!==AE.FILTERS){return"";}return this._super(AK);},setLastSelectionClass:function G(AN,AM){if(AN!==AM){var AL,AK="lastSelected";if(AM){AL=this.getUnitByKey(AM);D.removeClass(AL.domNode,AK);}if(AN){AL=this.getUnitByKey(AN);D.addClass(AL.domNode,AK);}}},dropBox:function b(AN,AL,AO,AR){AR=false;this._super(AN,AL,AO,AR);var AK=this,AM=AK.model,AQ=mstrmojo.DocDataService;var AP=AM.getUIState();AP[U.keyarray(AP)[0]].boxState=U.clone(AN.box.initState);AM.execute({execute:function(){AK.saveBoxLayout(this);},urInfo:{callback:AQ.EMPTY_CALLBACK,extras:AQ.SUPPRESS_DATA},undoUIState:AP});}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.rw.DocRelativePanel,{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod});mstrmojo.vi.ui.rw.DocRelativePanel.getLayoutBreakPoint=function(){return o;};mstrmojo.vi.ui.rw.DocRelativePanel.EnumPreviewModes={DefaultDesktop:Z,DefaultPreview:v,TabletPreview:v};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo._HasPopup","mstrmojo.Label","mstrmojo.HTMLButton","mstrmojo.ObjectBrowser","mstrmojo.DataGrid","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.ObjectInputBox","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME.MetricDataService","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(629,2148,3377,9582,12173,12179,12852);var J=mstrmojo.hash,m=mstrmojo.array,M=mstrmojo.expr,j=mstrmojo.ME._MetricEditorHelper,A=mstrmojo.ME.MetricDataService,d=mstrmojo.mstr.EnumDSSXMLObjectTypes,p=mstrmojo.ME.Enum.DYNAMIC_DIMTY,O=mstrmojo.ME.Enum.UI_OBJECT_TYPE;var V,Y;var f=function(E){if(E.onmetricModify){E.onmetricModify();}},c=function(){if(Y.updateScrollbars){Y.updateScrollbars();}};var Z=mstrmojo.ME.MetricToken.brackets,L=mstrmojo.ME.MetricToken.quotes,a=mstrmojo.ME.MetricToken.unquotes;var e=function(){var E={"9C374236DD9F11D3B98100C04F2233EA":"Forecast","9C374233DD9F11D3B98100C04F2233EA":"Growth","9C374233DD9F11D3B98100C04F2233EA":"Trend","677E93B2786B11D4B82F00C04F356781":"Case",C41C34F0786B11D4B82F00C04F356781:"CaseV",B2C0FA4420C711D6AD1400C04F0423DE:"IF","8107C324DD9911D3B98100C04F2233EA":"Not"};return E.hasOwnProperty(this.fctOi.did);};var h=function(t){var s=t.split(",")[0],r=s.replace(/\d$/,""),E=s.replace(r,"");return{prefix:r,startAt:parseInt(E,10)};};var G=function(z){var x=function(){if(z.isRepeated){var w=this.parent.dataGrid.ctxtBuilder.itemWidgets[this.parent.idx].labelWidget;if(w){w.set("count",this.getSelectedObjects().length);}}};var r=Y.getParamObjectTypes();var E={scriptClass:"mstrmojo.Table",cssClass:"funcParam",layout:[{cells:[{cssText:"width: 338px"},{}]}],children:[{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",slot:"0,0",cssClass:"mstrmojo-ME-param",dtp:z.dtp,isDME:Y.isDME,hideEditButton:function(w){return true;},hideDelButton:function(w){return this.isFull;},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},browsableTypes:r.concat([M.TP.FOLDER]).join(","),folderLinksContextId:17,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(3377,"Object").toLowerCase()),getCandidatesThroughTaskCall:function v(AA,w){AA.objectType=r.join(",");AA.rootFolderType=39;AA.blockCount=this.blockCount;mstrmojo.ME.MetricDataService.getMetricComponents(AA,w);},postCreate:function(AD){var AC=this.parent.dataGrid,AF=AC&&AC.parent;this.noCache=AF.noCache;if(!this.noCache){this.candidates=AF.getCandidates(function(AG){return mstrmojo.array.indexOf(r,AG.t)>-1;});var w=this.candidates.items||[];if(Y.isDME){w=Y.replaceAttributeWithForms(m.filter(w,function(AG){return m.indexOf(r,AG.t)>-1&&AG.st!==M.STP.NDE;}));}for(var AB=0,AA=(z.items||[]).length;AB<AA;AB++){var AE=z.items[AB];if(AE&&AE.t===mstrmojo.ME.Enum.UI_OBJECT_TYPE.Sub_Expression){w.push(AE);}}this.candidates.items=w;if(!AD){AC.candidatesListener.push(this.id);}}if(!AD){this.set("items",z.items);}},onitemchange:function(){f(this.parent.dataGrid.parent);},onadd:function s(){x.call(this);},onremove:function u(){x.call(this);},obCfg:{folderLinksContextId:17,browsableTypes:r.concat([M.TP.FOLDER]).join(",")}}],getTokens:function(){var AC=this.paramInput.getSelectedObjects(),AD,w=AC.length,AB,AE=[],AA;if(w>0){for(AB=0;AB<w;AB++){AD=AC[AB];if(AD.state===mstrmojo.Enum_OIB_States.VALID&&AD.did){if(AD.t===O.Sub_Expression){AE=AE.concat(AD.tks);}else{AA={v:Z(AD.n)};if(AD.t===21){AA.oi=AD.oi;AA.exv=AD.fmdid||AD.exv;AA.extp=8;AA.v=AD.fnm?Z(AD.oi.n)+"@"+Z(AD.fnm):AA.v;}else{AA.oi=AD;}AE.push(AA);}}else{AA={v:L(z.dtp,AD.n)};AE.push(AA);}AE.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}AE.pop();}return AE;}};var t=E.children&&E.children[0];if(!z.isRepeated){t.cssClass="mstrmojo-ME-ObjectInputBox-param singleObject noVerify";t.maxObjectCount=1;}else{t.cssClass="mstrmojo-ME-ObjectInputBox-param noVerify";}return E;};var C=function(s){var r=mstrmojo.all[V];var E=null;if(s.isParam){E=r.getParamWidget(s);}else{switch(s&&s.dtp){case 11:E={scriptClass:"mstrmojo.Pulldown",cssClass:"bool mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:"False",did:"0"},{n:"True",did:"-1"}],popupToBody:true,itemIdField:"did",postCreate:function(t){var u=this.data;this.value=!!u.v?(u.v==="False"?0:-1):(u.dfv||0);},getTokens:function(){var t=this.data;if(!A.isValEqual(this.value,t.dfv)){return[{v:t.n},{v:"=",isDelimiter:true},{v:A.isValEqual(this.value,"-1")?"True":"False"}];}return[];},onvalueChange:function(){f(this.parent.dataGrid.parent);}};break;case -2:E=r.getBreakByWidget(s);break;case -1:E=r.getSortByWidget(s);break;default:E=r.getTextWidget(s);break;}}E.alias="inputWidget";return E;};var X=function(t,E,r){var s={scriptClass:"mstrmojo.ui.List",alias:"labelWidget",cssClass:"mstrmojo-FunctionWidzard-labels",count:t.items&&t.items.length||0,buildItems:function(){var u=[],w=this.count,z=(t.isParam?"*":"")+":",x=t.np;if(x){for(var v=0;v<=w;v++){u.push({n:x.n+(x.startAt+v)+z,title:t.desc||""});}}else{u.push({n:(t.dn||t.n)+z,title:t.desc||""});}this.set("items",u);},postCreate:function(){this.buildItems();},oncountChange:function(){this.buildItems();}};return s;};var P=function(u){var r=mstrmojo.all[V];return{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"breakByInput",cssClass:"mstrmojo-ME-breakby",isDME:r.isDME,dtp:u.dtp,emptyText:mstrmojo.desc(12179,"Search for #").replace("#",mstrmojo.desc(2148,"Attribute").toLowerCase()),folderLinksContextId:16,browsableTypes:[M.TP.FOLDER,M.TP.ATTR].join(","),getCandidatesThroughTaskCall:function t(w,v){w.rootFolderType=39;w.blockCount=w.blockCount||this.blockCount;mstrmojo.ME.MetricDataService.getAttributes(w,v);},obCfg:{folderLinksContextId:16,browsableTypes:[M.TP.ATTR,M.TP.FOLDER].join(",")},postCreate:function(x){var v=this.parent.dataGrid,z=v&&v.parent;this.noCache=z.noCache;if(!this.noCache){this.candidates=z.getCandidates(function(AC){return AC.t===d.Attribute||AC.t===d.Consolidation;});if(this.isDME){this.candidates.items=p.getItems("breakby").concat(this.candidates.items);}if(!x){v.candidatesListener.push(this.id);}}if(!x){var w=u.items||[],AA=r.oi.tks,AB=!AA.met||AA.items&&(AA.items.length===0);if(AB&&this.isDME){w.push(p.getAutomaticDimtyObject());}this.set("items",w);}},onitemchange:function(){f(this.parent.dataGrid.parent);},onadd:function E(){c();},onremove:function s(){c();},hidePulldownButton:function(){return this.parent.dataGrid.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.dataGrid.parent.tbBrowsable;},getTokens:function(){var z=this.getSelectedObjects(),v=z.length,x,AB=[];if(v>0){AB.push({v:"BreakBy"});AB.push({v:"=",isDelimiter:true});AB.push({v:"{",isDelimiter:true});for(x=0;x<v;x++){var AA=z[x],w;if(j.isDimty(AA.n)){w={v:AA.n};}else{if(/^@/.test(AA.did)){w={v:AA.did};}else{w={v:Z(AA.n),oi:AA};}}AB.push(w);if(x!==(v-1)){AB.push({v:",",isDelimiter:true});}}AB.push({v:"}",isDelimiter:true});}return AB;}};};var F=function(t,u){var r=t.length,E;for(E=0;E<r;E++){var s=mstrmojo.array.find(t[E].fns,"n",u);if(s>-1){return J.clone(t[E].fns[s]);}}return null;};var S=function(s,t){var r,E=t.length,u=s&&s.length;if(u>0){for(r=0;r<u-1;r++){s[r].items=[t[r]];s[r].dynamicVerify=true;}s[u-1].items=[];for(r=u-1;r<E;r++){s[u-1].items.push(t[r]);s[u-1].dynamicVerify=true;}}return s;};var N=function(r,s,v){var u={items:[]},t={301:"}",302:")"}[v],E=s[++r];while(E){if(E.oi){if(v==302){E.oi.selFrm=E.exv;E.oi.asc=E.asc;}u.items.push(E.oi);}if((E=s[++r]).v===t){break;}}return u;};mstrmojo.ME.FunctionWizard=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.FunctionWizard",cssClass:"mstrmojo-Editor-me mstrmojo-FunctionWidzard",title:mstrmojo.desc(9582,"Function Editor: "),help:"Function_Arguments_dialog_box.htm",fctOi:null,fctArgs:null,fctArgsDataGridCssClass:"functionArgs",fctSyntax:"",fctDesc:"",hiddenPs:[],bindings:{candidates:"this.opener.candidates"},getParamObjectTypes:function g(){var E=[M.TP.METRIC,M.TP.FACT];if(this.isAgg(this.fctOi)){E.push(M.TP.ATTR);}return E;},getCandidates:function R(s){var r=this.candidates,E;if(r){E=mstrmojo.array.filter(r.items,s);return{items:E,isComplete:r.isComplete};}return{};},_set_candidates:function(w,r){this.candidates=r;if(this.hasRendered&&this.visible){var t=this.argsGrid,u=t.candidatesListener,E=u.length,s;for(s=0;s<E;s++){if(mstrmojo.all[u[s]]){mstrmojo.all[u[s]].postCreate(true);}}}if(this._super){this._super(w,r);}return true;},postProcessParamsFromToken:function(t){if(this.refOi&&this.candidates){var u=this.refOi.did;this.refOi=mstrmojo.array.filterOne(this.candidates.items,function(z){return z.did===u;});}var x=[],v,s,r=t.pars,E=(r&&r.length)||0;for(s=0;s<E;s++){v=J.copy(r[s]);v.isParam=true;if(s===0&&this.refOi){v.items=[this.refOi];this.refOi=null;}x.push(v);}if(t.rpc>0&&!e.call(this)){v.isRepeated=true;var w=h(v.n);v.np={n:w.prefix,startAt:w.startAt||1};}return x;},postProcessProsFromToken:function(t){var u=[],s,E=(t.pros&&t.pros.length)||0,r=function(v){if(m.indexOf(mstrmojo.ME.Enum.NonExposableParams,v.n)>-1){v.itemCss="hidden";}return v;};for(s=0;s<E;s++){u.push(r(J.copy(t.pros[s])));}return u;},buildSyntax:function(s){var r=[],t,E;r.push(s.n);r.push("(");E=(s.pars&&s.pars.length)||0;for(t=0;t<E;t++){r.push(s.pars[t].n);if(t!==(E-1)){r.push(", ");}}r.push(")");return r;},onOpen:function(){V=this.id;this._setupCandidatesCache();var s=this.getArgsFromTokens();var u=this,t=s||this.fctOi;var E=this.buildSyntax(t),v=this.postProcessParamsFromToken(t);v=v.concat(this.postProcessProsFromToken(t));if(t.sqt===5){v.push({n:"BreakBy",dn:mstrmojo.desc(12173,"Break By"),dtp:-2,desc:"Break By is a parameter representing the break by levels for this function.",items:t.bb&&t.bb.items});}if(t.ios){v.push({n:"SortBy",dn:mstrmojo.desc(12852,"Sort By"),dtp:-1,desc:"Sort By is a parameter representing the sort by levels for this function.",items:t.sb&&t.sb.items});}v=v.concat(this.hiddenPs||[]);u.set("fctArgs",v);u.set("fctSyntax",E.join(""));u.set("fctDesc",mstrmojo.ME.FunctionInfo.getDescAndExample(this.fctOi).desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(t.h));u.set("title",this.insertMode?t.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);u.set("fctName",t.n);this.raiseEvent({name:"fctDidChange",did:this.fctOi.did});this.set("isAggFunction",this.isAgg());this.set("ios",t.ios);if(this._super){this._super();}if(this.isAggFunction){var r=this.argsGrid.ctxtBuilder.itemWidgets;if(r&&r.length>0){this.metricLCT.set("labelWidth",r[0].labelWidget&&r[0].labelWidget.domNode.clientWidth+"px");}}},getArgsFromTokens:function Q(){if(!this.oi||this.oi.tks.items.length===0){return null;}var t={},v=this.oi.tks.items,AK=v.length,AF=[],r=[],AE=0,E=[],AJ;for(AJ=0;AJ<AK;AJ++){var x=v[AJ],s=x.tp,AM=x.sctt;if(mstrmojo.ME.MetricToken.isDelimiter(x.v)&&(x.v!=="("&&x.v!==")")||x.v==="&gt;"||x.v==="&lt;"){continue;}switch(AM){case 65536:t.n=x.oi?x.oi.n:x.v;var z=this.fctOi=F(this.functions,t.n);AF=z.pars||[];r=z.pros||[];t.rpc=z.rpc;t.sqt=z.sqt;t.ios=z.ios;break;case 196608:var AI=[],AD=[],AB,AH,AG;x=v[++AJ];while(x&&(x.sctt===196608||x.sctt===196609)){if(x.sctt===196608){AD.push(x);}else{AI.push(AD);AD=[];}x=v[++AJ];}AI.push(AD);AI[AI.length-1].pop();for(AG=0;AG<AI.length;AG++){AD=AI[AG];var u={n:""};AB=AD.length;if(AB===1){x=AD[0];if(x.extp){u={n:x.v,did:x.oi.did+"@"+x.exv,exv:x.exv,extp:x.extp,oi:x.oi,t:21,tk:x};}else{var AC=Math.min(AF.length-1,E.length),AL=a(x,x.v,AF[AC].dtp);u=x.oi||{n:AL,v:AL,t:O.Sub_Expression};}}else{for(AH=0;AH<AB;AH++){u.n+=AD[AH].v+" ";}u.v=u.n;u.did=u.n;u.t=O.Sub_Expression;u.tks=AD;}E.push(u);}break;case 131072:if(s==301){var AA={};x=v[++AJ];while(x){if(x.tp!=282){if(x.oi){AA.items=AA.items||[];AA.items.push(x.oi);}else{if(x.tp===64){AA.items=AA.items||[];var w=x.v+v[++AJ].v;x=v[AJ+1];if(x.tp===43||x.tp===45){w+=v[++AJ].v;w+=v[++AJ].v;}AA.items.push(p.getDimtyObject(w,this.isDME));}}}if((x=v[++AJ])["v"]==="}"){break;}}t.bb=AA;}else{if(s==302){t.sb={};}else{if(s==259){mstrmojo.array.forEach(r,function(AP){if(AP.n===v[AJ].v){AJ=AJ+2;var AO=v[AJ],AN=[];do{AN.push(v[AJ++].v);if(v[AJ].sctt===131072&&v[AJ].tp===62||v[AJ].sctt===131073){break;}}while(true);AN=AN.join("");AN=a(AO,AN,AP.dtp);AP.v=AN;return false;}});}}}break;}}t.pars=S(AF,E);t.pros=r;return t;},getTokens:function H(){var t=this.argsGrid.ctxtBuilder.itemWidgets,x=t.length,v,AC,z=[],s=[],AD=[],AA,u,r,E,AB=this.fctOi;for(v=0;v<x;v++){AC=t[v].inputWidget;if(AC.data.isParam){s.push(AC.getTokens());}else{z.push(AC.getTokens());}}AD.push({v:AB.n,oi:AB});x=z.length;if(x>0){E=false;AD.push({v:"<",isDelimiter:true});for(v=0;v<x;v++){AA=z[v];r=AA.length;if(r===0){continue;}E=true;for(u=0;u<r;u++){AD.push(AA[u]);}AD.push({v:",",isDelimiter:true});}AD.pop();if(E){AD.push({v:">",isDelimiter:true});}}x=s.length;AD.push({v:"(",isDelimiter:true});E=false;for(v=0;v<x;v++){AA=s[v];r=AA.length;if(r===0){continue;}E=true;for(u=0;u<r;u++){AD.push(AA[u]);}AD.push({v:mstrmojo.ME.MetricToken.argDelimiter,isDelimiter:true});}if(E){AD.pop();}AD.push({v:")",isDelimiter:true});for(v=0,x=AD.length;v<x;v++){AD[v].isNew=true;}return AD;},getMetricDefAsTokens:function q(){var E=this.getTokens();if(this.getLCTDefAsTokens){E=E.concat(this.getLCTDefAsTokens());}return E;},handleValidation:function o(u){if(u&&!u.rjec){return ;}var t=u&&u.rjec==="-2147214846";if(t){var s=u.items,v=mstrmojo.array.find(s,"sta",-1),E=s[v].v;mstrmojo.alert('More than one object with the name "#" found. Browse to select the object or retype to select it from the search autocomplete list.'.replace("#",E));}else{mstrmojo.alert(u&&u.rjed);}},getPROPBuilder:function b(){return X;},getDTPBuilder:function k(){return C;},getParamWidget:function B(E){return G(E);},getBreakByWidget:function U(E){return P(E);},getSortByWidget:function l(E){return this._super();},getTextWidget:function W(E){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-functionArgs-textInput",postCreate:function(r){var s=this.data;this.value=s.v||((s.dfv||s.dfv===0)?s.dfv:"");},getTokens:function(){var r=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==r.dfv){return[{v:r.n},{v:"=",isDelimiter:true},{v:L(r.dtp,this.value)}];}return[];},onvalueChange:function(){f(this.parent.dataGrid.parent);}};},getDataGridRef:function D(){return{scriptClass:"mstrmojo.DataGrid",alias:"argsGrid",cssClass:this.fctArgsDataGridCssClass,makeObservable:true,banding:false,columns:[{headerText:"Property Name",dataWidgetBuilder:this.getPROPBuilder(),colCss:"name"},{headerText:"Property Type",dataWidgetBuilder:this.getDTPBuilder(),colCss:"dtp"}],postCreate:function(){this.candidatesListener=[];},bindings:{items:"this.parent.fctArgs"},onadd:function(){c();}};},init:function n(E){this.children=this.getChildren();this._super(E);V=this.id;Y=this;},isAgg:function K(E){return(E||this.fctOi||{}).sqt===1;},getChildren:function I(){return[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,this.getDataGridRef(),this.getLCTComponent(),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:function(){return this.parent.fctSyntax;}}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode || this.parent.simplex",text:function(){return this.parent.fctDesc;}}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ME.TokenInputBox","mstrmojo.ME.MetricDataService","mstrmojo.DataGrid","mstrmojo.Button","mstrmojo.ToolBar","mstrmojo.Editor","mstrmojo.ME._MetricEditorHelper","mstrmojo.mstr.EnumFunction","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.ME._HasLevel","mstrmojo.ME._HasSortBy","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(1107,1281,2148,2397,2399,3324,3377,3693,4531,4788,6223,6397,6398,9577,9579,9581,9582,9583,9584,11564,11565,12178,12179,12853,13806,13807,13808,14173,14334);var N=mstrmojo.expr,C=mstrmojo.array,K=mstrmojo.hash,B=mstrmojo.mstr.EnumFunction,A=mstrmojo.ME.MetricToken.brackets,O=mstrmojo.ME.MetricToken.splitAttrAndAttrForm,F=mstrmojo.mstr.EnumDSSXMLObjectTypes,W=mstrmojo.ME.MetricDataService;var J,H;var L=function(E){return(E||H.metricContent1.fctPulldown.selectedItem).fnt===B.FunctionCount;};var U=function(Z,E){var a=E.fnt===B.FunctionCount,b=H.useGUIDefault;var Y=[{n:"Distinct",dtp:11,dfv:"0",v:(a&&b?"-1":"0"),desc:"",dn:mstrmojo.desc(13806,"Include Distinct Elements:")},{n:"Null",dtp:11,dfv:"0",desc:"",dn:mstrmojo.desc(13807,"Include Null:")},{n:"UseLookupForAttributes",dtp:11,dfv:"0",v:"0",desc:"",dn:mstrmojo.desc(13808,"Use Lookup For Attributes:")},{n:"FactID",dtp:-1,desc:"",dn:"",items:[]}];if(!a||H.isDME){Y.splice(C.find(Y,"n","Null"),1);}if(H.isDME){Y.splice(C.find(Y,"n","FactID"),1,{n:"MetricID",dtp:-3,desc:"",dn:mstrmojo.desc(14173,"Metric Guide:"),items:[]});}mstrmojo.array.forEach(Z,function X(d){var c=mstrmojo.array.find(Y,"n",d.n);if(c>-1){mstrmojo.hash.copy(d,Y[c]);}});return Y;};mstrmojo.ME.SimpleMetricEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ME._HasLevel,mstrmojo.ME._HasSortBy],{scriptClass:"mstrmojo.ME.SimpleMetricEditor",cssClass:"mstrmojo-Editor-me mstrmojo-SimpleMetricEditor",title:"",help:"create_derived_metric.htm",fctSyntax:"",fctDesc:"",did:mstrmojo.ME._HasLevel.EnumEditorComponents.simple,isAggFunction:true,bindings:{candidates:"this.opener.candidates"},init:function S(E){if(this._super){this._super(E);}J=this.id;H=this;},getMetricDefAsTokens:function R(){var f=this.metricContent1.fctPulldown.selectedItem,h=this.metricContent1.paramInput,d=[],b,Z,c;d.push({v:f.n,oi:f});var e=this.functionPropsRef.getTokens();if(this.ios&&this.getSortByDefAsTokens){var Y=this.getSortByDefAsTokens();if(Y.length>0){e.push(Y);}}c=e.length;if(c>0){var E,g,X,k=[];E=false;k.push({v:"<",isDelimiter:true});for(b=0;b<c;b++){g=e[b];X=g.length;if(X===0){continue;}E=true;for(Z=0;Z<X;Z++){k.push(g[Z]);}k.push({v:", ",isDelimiter:true});}k.pop();if(E){k.push({v:">",isDelimiter:true});}d=d.concat(k);}d.push({v:"(",isDelimiter:true});d=d.concat(h.getTokens());d.push({v:")",isDelimiter:true});for(b=0,c=d.length;b<c;b++){d[b].isNew=true;}if(this.getLCTDefAsTokens){d=d.concat(this.getLCTDefAsTokens());}return d;},getMetricDefFromTokens:function P(){var c=[],Z=[],e=[],b=this.oi.tks.items,a=b.length,Y;for(Y=0;Y<a;Y++){var X=b[Y],d=X.tp,E=X.sctt;switch(E){case 65536:switch(d){case 280:c=X.oi;this.ios=c.ios;break;}break;case 131072:if(d===259||d===303||d===311){Z.push({n:b[Y].v,v:b[Y+2].v,oi:b[Y+2].oi});}break;case -1:case 196608:e.push(X);break;}}if(e.length>2){if(e[0].v==="("){e.shift();}if(e[e.length-1].v===")"){e.pop();}}return{fct:c,fctProps:Z,expr:e};},insertMode:false,_set_candidates:function(Y,E){this.candidates=E;if(this.hasRendered){var X=this.metricContent1.paramInput;X.candidates=this.getCandidates([N.TP.METRIC,N.TP.ATTR,N.STP.NDE],true);if(this._super){this._super(Y,E);}}return true;},getCandidates:function M(Z,E){var Y=this.candidates,X;if(Y){Z=C.ensureArray(Z);X=C.filter(Y.items,function(a){return C.indexOf(Z,a.t)>-1||C.indexOf(Z,a.st)>-1;});if(C.indexOf(Z,12)>-1&&E){if(this.replaceAttributeWithForms){X=this.replaceAttributeWithForms(X);}}return{items:X,isComplete:Y.isComplete};}return null;},getParamInputCandidates:function(){return this.getCandidates([N.TP.METRIC,N.TP.ATTR].concat(L()?[N.STP.NDE]:[]),true);},onOpen:function G(){H=this;var Y=this.getMetricDefFromTokens();var g=this.oi;if(g&&g.tks){this.originTks=K.clone(g.tks.items);this.originAfb=g.mps&&g.mps.afb;this.originSfb=g.mps&&g.mps.sfb;}var c=W.getAggFunctions(),d=this.metricContent1.fctPulldown,h=Y.fct&&Y.fct.did||this.did;if(c&&d){d.set("items",c);if(h&&W.isBasicAggMap(h)){d.set("value",h);}else{d.set("value","8107C31BDD9911D3B98100C04F2233EA");}}this.set("fctProps",Y.fctProps);if(this.functionPropsRef){this.functionPropsRef.propsCache=null;this.functionPropsRef.originFctProps=U(this.fctProps,this.metricContent1.fctPulldown.selectedItem);}var a=this.metricContent1.paramInput;a.candidates=this.getParamInputCandidates();var b,X=Y.expr.length;if(this.isDME&&this.refOi&&this.candidates){var E=this.refOi.did;b=mstrmojo.array.filterOne(this.candidates.items,function(k){return k.did===E;});}if(X>0){b={n:""};if(X===1){var j=Y.expr[0];if(j.extp){b={n:j.v,did:j.exv,exv:j.exv,extp:j.extp,oi:j.oi,tk:j};}else{b=j.oi||{n:j.v,t:j.tp};}}else{for(var Z=0;Z<X;Z++){var f=Y.expr[Z],e=O(f.v);if(f.oi&&f.exv&&e.length===2){b.n+=(A(e[0])+"@"+A(e[1]));}else{if(W.isLogicOrCompFunc(f)){b.n+=(" "+f.v+" ");}else{if(f.oi&&(f.oi.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Metric||f.oi.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Fact||f.oi.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Attribute)){b.n+=A(f.v);}else{b.n+=f.v;}}}}b.t=-2;b.tks=Y.expr;}}a.set("items",null);a.set("items",b?[b]:null);this.set("title",this.insertMode?this.metricContent1.fctPulldown.selectedItem.n:mstrmojo.desc(9582,"Function Editor: ")+" "+this.oi.n);this.raiseEvent({name:"fctDidChange",did:h});if(this._super){this._super();}this.set("ios",d.selectedItem.ios);},useGUIDefault:false,functionPropsRef:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-ME-functionParameters",useRichTooltip:false,setupFunctionProps:function Q(){var X=this.opener;this.fctPropsGrid.items=null;var E=X.metricContent1.fctPulldown.selectedItem;this.propsCache=this.propsCache||{};this.propsCache[E.did]=this.propsCache[E.did]||U(X.fctProps,E);this.cleanCopy={did:E.did,props:mstrmojo.hash.clone(this.propsCache[E.did])};this.set("fctProps",this.propsCache[E.did]);},onOpen:function(){this.setupFunctionProps();var E=this.opener;this.set("title",E.metricContent1.fctPulldown.selectedItem.n+" "+mstrmojo.desc(11565,"Parameters"));},children:[{scriptClass:"mstrmojo.DataGrid",alias:"fctPropsGrid",cssClass:"functionPropsGrid",cssText:"margin: 5px auto; 0",makeObservable:true,banding:false,columns:[{headerText:"",dataFunction:function(E){return'<div class="mstrmojo-DataRow-text"title="'+(E.desc||"")+'">'+(E.dn||E.n)+"</div>";},colCss:"name"},{headerText:"",dataWidgetBuilder:function(Y){var E;switch(Y.dtp){case 11:E={scriptClass:"mstrmojo.ListHoriz",cssClass:"radio",itemIdField:"did",items:[{n:mstrmojo.desc(6397,"True"),did:"-1"},{n:mstrmojo.desc(6398,"False"),did:"0"}],popupToBody:true,popupZIndex:100,postCreate:function(){var a=this.data;var Z=!!a.v?(a.v==="False"||a.v==="0"?0:-1):(a.dfv||0);this.set("selectedIndex",mstrmojo.array.find(this.items,"did",Z));},onchange:function(Z){if(Z.removed.length===1){this.data.v=this.selectedItem.did;if(this.data.n==="UseLookupForAttributes"){this.dataGrid.factID.set("enabled",this.data.v==="0"||this.data.v==="False");}this.dataGrid.parent.set("dirty",true);}},getTokens:function(){var a=this.data,Z=this.selectedItem.did;if(Z!==a.dfv){return[{v:a.n},{v:"=",isDelimiter:true},{v:Z==="-1"?"True":"False"}];}else{return[];}}};break;default:E={scriptClass:"mstrmojo.Pulldown",alias:"factID",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"did",items:Y.items,popupToBody:true,popupZIndex:100,postApplyProperties:function X(){this.fixHeight=window.mstrApp&&(mstrApp.isWorkstation||mstrApp.isVI)?true:false;},getTokens:function(){var Z=this.data;return this.enabled&&this.selectedIndex>0?[{v:Z.n},{v:"=",isDelimiter:true},{v:mstrmojo.ME.MetricToken.brackets(this.selectedItem.n),oi:this.selectedItem,isNew:true}]:[];},postCreate:function(){this.dataGrid.factID=this;var d={};mstrmojo.array.forEach(this.dataGrid.parent.fctProps,function(f){if(f.n==="UseLookupForAttributes"){d=f;return false;}});var Z=!!d.v?(d.v==="False"||d.v==="0"?0:-1):(d.dfv||0);this.enabled=Z===0;var c=this;switch(Y.dtp){case -1:var e=function(f){if(f){c.set("items",[{n:mstrmojo.desc(3693,"(None)"),did:-1}].concat(f.items));c.set("value",Y.oi&&Y.oi.did||-1);}},a=function(f){mstrmojo.alert(f.getResponseHeader("X-MSTR-TaskFailureMsg"));};W.getFacts({pattern:"*",blockBegin:1,blockCount:-1,rootFolderType:39},{success:e,failure:a});break;case -2:break;case -3:var b=[{n:mstrmojo.desc(4531,"Automatic"),did:-1}];mstrmojo.array.forEach(H.dsUnits.items,function(f){if(f.t===4){b.push(f);}});this.set("items",b);this.set("value",(Y.oi&&Y.oi.did)||-1);break;}},onvalueChange:function(Z){if(Z.valueWas!==null){this.data.oi=this.selectedItem;this.dataGrid.parent.set("dirty",true);}}};break;}E.alias="inputWidget";return E;},colCss:"dtp"}],bindings:{items:function(){return this.parent.fctProps;}}},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cssText:"float:right;margin: 5px 0px;",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:mstrmojo.desc(2397,"OK"),bindings:{enabled:"this.parent.parent.dirty"},onclick:function(){var E=this.parent.parent;E.opener.onmetricModify();E.originFctProps=null;E.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var E=this.parent.parent;var X=E.cleanCopy;E.propsCache[X.did]=X.props;E.set("dirty",false);E.close();}}]}],getTokens:function(){var f=[],Z,d;var b=this.fctPropsGrid;var a=this.originFctProps;if(a){var E,c,X,h;d=a.length;for(Z=0;Z<d;Z++){E=a[Z];c=E.dtp;X=E.v||E.dfv;if(c===11){var e=!W.isValEqual(X,E.dfv);h=e?[{v:E.n},{v:"=",isDelimiter:true},{v:W.isValEqual(X,"True")?"True":"False"}]:[];f.push(h);}else{if(E.oi){h=[{v:E.n},{v:"=",isDelimiter:true},{v:A(E.oi.n),oi:E.oi}];f.push(h);}}}}else{if(b){var Y=b&&b.ctxtBuilder.itemWidgets;for(Z=0,d=Y.length;Z<d;Z++){f.push(Y[Z].inputWidget.getTokens());}}else{return[];}}return f;}},handleValidation:function(){},postBuildRendering:function(){if(this._super){this._super();}this.addSlots({scrollBoxNode:this.metricLCT.domNode});},children:[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,mstrmojo.ME._MetricEditorHelper.functionNameRef,{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-SME-content1",alias:"metricContent1",children:[{scriptClass:"mstrmojo.Pulldown",alias:"fctPulldown",cssClass:"mstrmojo-SME-funcs-pulldown mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",popupToBody:true,itemIdField:"did",itemField:"n",postApplyProperties:function V(){this.fixHeight=window.mstrApp&&(mstrApp.isWorkstation||mstrApp.isVI)?true:false;},onvalueChange:function(d){var X="",a="",e=this.selectedItem;if(e){a=mstrmojo.ME.FunctionInfo.getDescAndExample(e).desc+"  "+W.getFunctionHelpTopic(e.h);var E=e.pars,c=[],Y,b;c.push(e.n);c.push("(");for(Y=0,b=E.length;Y<b;Y++){c.push(E[Y].n);if(Y!==(b-1)){c.push(", ");}}c.push(")");X=c.join("");}var Z=this.parent.parent;Z.set("fctSyntax",X);Z.set("fctDesc",a);Z.set("fctName",e&&e.n);Z.set("ios",e&&e.ios);Z.raiseEvent({name:"fctDidChange",did:e&&e.did});if(d.valueWas){Z.onmetricModify();}H.functionPropsRef.originFctProps=U(H.fctProps,e);H.metricContent1.paramInput.candidates=H.getParamInputCandidates();}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SME-agg-label",text:mstrmojo.desc(12853,"of")},{scriptClass:"mstrmojo.ME.ObjectInputBox",alias:"paramInput",cssClass:"mstrmojo-SME-ObjectInputBox-param",maxObjectCount:1,browsableTypes:[11,12,13,43,4,8].join(","),folderLinksContextId:25,emptyText:mstrmojo.desc(14334,"Search for a fact, metric or attribute ..."),getCandidatesThroughTaskCall:function D(X,E){X.objectType="12,13,43,4";X.rootFolderType=39;X.blockCount=this.blockCount;W.getMetricComponents(X,E);},bindings:{isDME:function(){return this.parent.parent.isDME;},dtp:function(){var E=this.parent.fctPulldown.selectedItem;return E.pars[0].dtp;}},hidePulldownButton:function(){return this.parent.parent.tbBrowsable;},hideItemWidgetBrowseButton:function(){return !this.parent.parent.tbBrowsable;},onSuggestionItemSelect:function I(b){if(mstrApp&&mstrApp.isVI){var Z=this.selectedItem,X=Z&&Z.t;if(b&&b.t===F.Metric&&X!==F.Metric){var a=this.parent.parent,c=(a&&a.fctProps)||[],d={n:"UseLookupForAttributes",v:"False"},Y=a.functionPropsRef,E=C.find(c,"n","UseLookupForAttributes");if(E>-1){K.copy(d,c[E]);}else{c.push(d);}a.set("fctProps",c);if(Y){Y.propsCache=null;Y.originFctProps=U(a.fctProps,a.metricContent1.fctPulldown.selectedItem);}}}mstrmojo.ME.ObjectInputBox.prototype.onSuggestionItemSelect.call(this,b);},onitemchange:function(){this.parent.parent.onmetricModify();},getTokens:function(){var Z=this.getSelectedObjects(),b,E=Z.length,Y,c=[],X,a;if(E>0){for(Y=0;Y<E;Y++){b=Z[Y];if(b.state===mstrmojo.Enum_OIB_States.VALID&&b.did){a=O(b.n);if((b.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.AttributeForm||b.exv)&&a.length===2){X={v:A(a[0])+"@"+A(a[1]),tp:2,lv:1};var d=b.fmdid||b.exv;if(d){X.tp=275;X.exv=d;X.extp=8;X.lv=3;X.oi=b.oi;}}else{X={v:A(b.n),oi:b};}}else{X={v:b.n};}c.push(X);c.push({v:",",isDelimiter:true});}c.pop();}return c;}}]},{scriptClass:"mstrmojo.Button",iconClass:"mstrmojo-ME-link mstrmojo-SME-fpLink",text:mstrmojo.desc(11564,"Function Parameters"),onclick:function(){var E=this.parent;E.openPopup("functionPropsRef",{selectedFunction:E.metricContent1.fctPulldown.selectedItem,zIndex:E.zIndex+1});}},mstrmojo.ME._HasLevel.getLCTComponent(),mstrmojo.ME._HasSortBy.getSortByWidget(true),{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionSyntax",bindings:{visible:"this.parent.insertMode",text:"this.parent.fctSyntax"}},{scriptClass:"mstrmojo.Label",slot:"buttonNode",cssClass:"mstrmojo-FE-functionDesc",allowHTML:true,bindings:{visible:"this.parent.insertMode",text:"this.parent.fctDesc"}},mstrmojo.ME._MetricEditorHelper.switchRef,mstrmojo.ME._MetricEditorHelper.buttonBarRef]});}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.mstr.EnumWebAPIErrorCodes","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui.DatasetObjects","mstrmojo.vi.ui.DocDatasetUnitList","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.util.ui._HostsSplitter","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.ToolbarConfig","mstrmojo.IVEDatasetPicker","mstrmojo.vi.ui.PanelContents","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.ui.SelectDatasetWizardEditor","mstrmojo.vi.ui.ReplaceObjectEditor","mstrmojo.ui.ScrollableContainer","mstrmojo.fe.FilterEditor","mstrmojo.fe.FilterUtils","mstrmojo.array","mstrmojo.hash","mstrmojo.form","mstrmojo.func","mstrmojo.dom","mstrmojo.Button","mstrmojo.mstr.EnumFunction","mstrmojo.DocDataService","mstrmojo.SaveAsEditor","mstrmojo.vi.ui.ViewDataDialog","mstrmojo.vi.ui.DatasetEditor","mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy","mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.vi.enums.EnumDSSAccessRightFlags","mstrmojo.vi.enums.EnumFeatures","mstrmojo._HasPopup","mstrmojo.Popup","mstrmojo.CheckBox","mstrmojo.ui.PopupConfig","mstrmojo.storage.DOMLocalStorage");mstrmojo.requiresDescs(16029,16030);var a=mstrmojo.hash,m=mstrmojo.array,AM=mstrmojo.func,Y=mstrmojo.dom,P=mstrmojo.vi.ui.DatasetUnitMenuUtils,z=mstrmojo.DI.DIConstants,o=mstrmojo.Button.newWebButton,q=mstrmojo.DI.DIHelpers,AP=mstrmojo.chart.model.enums.EnumDSSObjectType,R={IN_MEMORY:1,DIRECT_ACCESS:2},g={SupportDDAOrInMemory:1,SupportInMemoryOnly:2,SupportDDAOnly:3},AE={style:{params:{treesToRender:1}}},l={att:AP.DssTypeAttribute,mx:AP.DssTypeMetric},AA=mstrmojo.warn,n=mstrmojo.vi.enums.EnumDSSAccessRightFlags,V=mstrmojo.mstr.EnumWebAPIErrorCodes,k=mstrmojo.vi.enums.EnumFeatures,j=mstrmojo.DocDataService.REQUEST_DEFN_DATA;var L="dontShowAddDataHint";function AO(AW,AY,AX,AV){AX.getDataService().checkMissingCredentials({dsid:AY},{success:function(AZ){var Aa=AV&&AV.callback;if(AZ.success){if(Aa&&Aa.success){Aa.success();}}else{if(Aa&&Aa.failure){Aa.failure(AZ);}else{mstrmojo.confirm(mstrmojo.desc(14396,"Some credentials are missing for the selected dataset. You will have to enter these credentials in order to proceed. Do you want to continue?"),{confirmBtn:{fn:function(){window.setTimeout(function(){if(AW&&AW.showDataImport){AW.showDataImport({documentModel:AZ,StatusCode:4,callback:function(){AO(AW,AY,AX,AV);}});}},0);return true;}},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:mstrmojo.emptyFn}},{title:mstrmojo.desc(1695,"Warning")});}}},failure:function(AZ){mstrmojo.alert(AZ);}});}function F(){return mstrApp.isSingleTier?new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy():new mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy();}function f(AV){this.model.cmdMgr().execute({execute:function(){AV(this);}});}function G(AV){return mstrmojo.resolveFeature(AV);}function p(){return !G("single-workingset");}function c(AZ){var AY=AZ.st===779,AV=AZ.mngd,AX=this.model,AW=AX.isFromFile(AZ);return(AV&&AY&&AW)||((!AZ.hcs||AZ.idd)&&!(AZ.tables&&AZ.tables[0]&&AZ.tables[0].xdaType===400));}function AN(AV){var AY=AV.id||"mstrIVE_DS",AW=mstrmojo.all[AY];if(!AW){AW=new mstrmojo.IVEDatasetPicker({id:AY,onOk:mstrmojo.emptyFn,onCancel:mstrmojo.emptyFn,onPreClose:function(){this.onCancel();return true;},onRender:function AX(){var Aa=false;this.btnImport.set("visible",Aa);this.newLabel.set("visible",Aa);this.useExistingLabel.set("visible",Aa);this.ob.set("scrollableIncFetch",true);this.btnHBox.destroyChildren();var AZ=o(mstrmojo.desc(547,"Select"),function(){if(this.enabled){AW.onOk();AW.close();}},true);AZ.bindings={enabled:function(){return this.parent.parent.multiSelect?!!this.parent.parent.selectedItems.length:!!this.parent.parent.item;}};this.btnHBox.addChildren([AZ,o(mstrmojo.desc(221,"Cancel"),function(){AW.onCancel();AW.close();},false)]);}});if(AV.title){AW.set("title",AV.title);}}a.forEach(AV,function(Aa,AZ){AW.set(AZ,Aa);});return AW;}function AU(AX,AW){var AV=this;return function(){mstrApp.rootCtrl.docCtrl.openDME(AV,{metricId:"",editorId:"mstrME",action:{cmd:"editNew"},disableAFB:AW.isMDXDataset(AX)},AW.getDataService().getAddNewDerivedMetricToDatasetSubmitFunc({dsid:AX.did}));};}function AD(AX,AW){var AV=this;return function(){mstrApp.rootCtrl.docCtrl.openDAE(AV,{dsid:AX,datasets:AW},mstrmojo.emptyFn);};}function x(AW,AY){var AX=new mstrmojo.ui.menus.MenuConfig(),AV=[{n:mstrmojo.desc(14476,"Primary (outer join)"),v:1},{n:mstrmojo.desc(14477,"Secondary (inner join)"),v:0}];AV.forEach(function(AZ){AX.addMenuItem(AZ.n,AZ.v===AY.ipm?"on":"",function(){var Aa=AW.controller,Ab=Aa.getRefreshCallback();Aa.cmdMgr.execute({execute:function(){this.submit([{act:"setJoinBehavior",dsid:AY.did,dst:AY.type,prm:AZ.v}],Ab,{style:{params:{treesToRender:3}}});},urInfo:{callback:Ab}});});});AX.hasToggleItem=true;return AX;}function M(AV,AW,Aa,AZ){var AY={taskId:"mojoGetDocumentManifest"},AX=function(Ac){var Ad=[],Ab=1;a.forEach(AV.data,function(Ae){Ac.forEach(function(Af){if(Ab===parseInt(Af,10)){Ad.push(Ae);}});Ab++;});return Ad;};if(AZ){AY.dsid=AZ;}AW.getDataService().submitUpdates({},{success:function(Ad){var Ab=[],Ae={},Ac={};a.forEach(AV.data,function(Af){Af.att.concat(Af.mx).forEach(function(Ag){Ae[Ag.did]=Ag;});});Ad.manifest_objects.forEach(function(Af){if(Ae[Af.did]){Af.cubes=AX(Af.cube_ids||[]);Ab.push(a.copy(Ae[Af.did],Af));Ac[Af.did]=Af;}});Ad.manifest_objects.forEach(function(Af){if(Af.dependents){Af.dependentObjects=[];Af.dependents.forEach(function(Ag){Af.dependentObjects.push(Ac[Ag]);});}});Ab=P.getSortedDatasetUnits(Ab);Aa(Ab);},failure:function(){AW.cmdMgr().onFailure();}},{params:AY,preserveUndo:true});}function b(AV,AX,AY){var AW=AV.datasets[AX];if(AW){AY(AW);}else{AV.getDataService().submitUpdates({},{success:function(AZ){AY(AZ);},failure:function(){AV.cmdMgr().onFailure();}},{params:{taskId:"mojoGetReportWorkingSet",reportId:AX,chkViewReport:1},preserveUndo:true});}}function r(AW){var AV=a.clone(AW.att.concat(AW.mx));AV.forEach(function(AX){if(AX.hc){AX.cont_did=AW.did;AX.cont_tp=AW.type;}});return m.filter(AV,function(AX){return !AX.um;});}function X(AX,AY,AW,AZ,AV,Aa){return function Ab(Ae,Af){var Ai=[{act:"applyReconciliation",clr_af:Af,clr_fs:false,members:Ae,disablePU:true}].concat(AV);if(!!AZ.isOneTierCubeImport){Ai[0].sourceId=(AW?"all":AZ.source.did);}if(AW){a.forEach(AX.data,function(Ak,Aj){Ae.unshift({srcid:Aj,srct:3,tgtid:AZ.target.did,tgtt:3});});}else{Ae.unshift({srcid:AZ.source.did,srct:3,tgtid:AZ.target.did,tgtt:3});}var Ah=AY.cmdMgr(),Ag=Ah.getInterimCmd(),Ad=AY.controller.getRefreshCallback(),Ac=AM.wrapMethods(Ad,(Aa||mstrmojo.emptyFn));if(Ag){Ag.urInfo.callback=Ad;Ag.submit(Ai,Ac,j,Ah.CMD_PHASE.LAST);}else{Ah.execute({execute:function(){this.submit(Ai,Ac,j);},urInfo:{callback:Ad}});}};}function AR(AY,Ac){var Af=AY.model,Ag="mstrReconReplaceEditor",Ab=null,Ad=function Ad(){var Ai=Af.cmdMgr().getInterimCmd();if(Ai){var Ah=Ai.urInfo;Ah.callback={success:mstrmojo.emptyFn};Ah.treesToRender=0;Ai.cancel();}},AV=function(Ah){if(!Ab){Ab=mstrmojo.all[Ag]||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.ReplaceObjectEditor",id:Ag});}Ab.set("showUnitTooltip",Ac);Ab.setUnits({source:Ah.source,target:Ah.target});D(a.keyarray(Af.datasets).filter(function(Ai){return Ai===Ah.target.did;}).map(function(Ai){return{dsid:Ai,collapsed:false};}),AY);Ab.onOk=X(AY,Af,Ac,Ah,AY.settings.getSaveActions(),{failure:function(){Ab.open();}});Ab.onCancel=Ad;Ab.set("onBack",Ah.onBack||mstrmojo.emptyFn);Ab.open();},AX=function(Ah){window.setTimeout(function(){AY.showDataImport({isEdit:false,AnalysisId:Af.mid,callback:function Ai(Aj){if(Aj){var Ak=Aj[0];if(Ak.mngd){if(!mstrApp.isSingleTier){Af.cmdMgr().getInterimCmd().resetCmdMgrOnComplete();}Ah(Ak);}else{b(Af,Ak.did,Ah);}}else{Ad();}}});},0);},Aa=function(Ah){Af.controller.createDataset({isParam:true,modifiedItems:{create:{act:"createDataset",mgo:true,prm:true,noRowCount:1,newObjectIds:["$GUID_141"]},add:[],del:[],fs:{add:[],del:[]},filter:null},onOk:function(An){var Ak=this,Am=Af.cmdMgr(),Al=Am.getInterimCmd(),Ai={success:function(Ao){a.forEach(Ao.datasets,function(Ap,Aq){if(!Af.datasets[Aq]){Ao.datasets[Aq].did=Aq;Ah(Ao.datasets[Aq]);}});Ak.close();},failure:function(Ao,Ap){this.canceled(Ap.id);}},Aj={skipUICmdMgrOnFailure:u()};if(Al){Al.submitInterim(An,Ai,Aj);}else{Am.execute({execute:function(){this.submit(An,Ai,Aj);}});}},closeOnSubmit:false,onCancel:Ad});},AZ=function(Ah){Af.controller.addDataset({isParam:true,id:"mstrReconDatasetPicker",title:mstrmojo.desc(11940,"Select Existing Dataset"),multiSelect:false,onOk:function(Ai){b(Af,Ai||this.item.did,Ah);},onCancel:Ad});},AW=function(Ah){Af.controller.openCubeBrowser({success:function(Ai){b(Af,Ai.did,Ah);},failure:function(){Ad();}});},Ae=function(Aj){var Ah=Aj.sourceDatasetId,Ak=!!Aj.isOneTierCubeImport,Ai=Aj.openDialog;M(AY,Af,function(Al){function Am(){f.call(AY,function(){Ai(function(Ao){var An=r(Ao);AV({isOneTierCubeImport:Ak,source:{did:Ah,all:!!Ac,units:Al},target:{did:Ao.did,units:An},onBack:AM.composite([Ad||mstrmojo.emptyFn,Am])});});});}Am();},Ac?null:Ah);};return function(){var Ah=new mstrmojo.ui.menus.MenuConfig({supportsScroll:true,menuCssClass:"reconsoliationMenu"}),Al=this.did,Ak=Ac?null:Al,Ai=Object.keys(AY.data).length;if(p()){var Aj=mstrApp.isSingleTier;if(Af.allowImportData()){Ah.addMenuItem(mstrmojo.desc(14303,"New Data..."),"",function(){Ae({sourceDatasetId:Al,openDialog:AX});});Ah.addSeparator();}if(!(mstrApp.isWorkstation&&mstrApp.isVisBuilder)){Ah.addMenuItem(mstrmojo.desc(13573,"Existing Dataset..."),"",function(){Ae({sourceDatasetId:Al,isOneTierCubeImport:Aj,openDialog:AZ});});}if(!AY.hasUnsubmitDataset&&Af.allowNewOrEditRolapDS()&&(Af.isSchemaDefined()||mstrApp.isWorkstation)){Ah.addMenuItem(mstrmojo.desc(15397,"Existing Objects..."),"",function(){Ae({sourceDatasetId:Al,openDialog:Aa});});}}if(Ai>1){Ah.addSeparator();a.forEach(AY.data,function(An,Am){if(Am===Al){return true;}Ah.addMenuItem(An.name,"",function(){f.call(AY,function(){M(AY,Af,function(Ao){b(Af,Am,function(Ap){AV({source:{did:Al,all:!!Ac,units:Ao},target:{did:Am,units:r(Ap)}});});},Ak);});});});}return Ah;};}function AG(){var AW=this,AV=AW.model,AX=[];a.forEach(AV.datasets,function(AY){if(AY.st===779&&AV.hasPrivilegesForAllTables(AY.tables)){AX.push(AY);}});return function(){AW.showDataImport({isEdit:false,datasets:AX,AnalysisId:AW.model.mid,needDefn:true});};}function Z(){var AW=this,AV=AW.model,AX=[];a.forEach(AV.datasets,function(AY){if(AY.st===779&&AV.hasPrivilegesForAllTables(AY.tables)){AX.push({cube_id:AY.did,cname:AY.name,ddam:AY.dsm,mdt:"2014-12-10 20:57:25",sz:421,st:AY.st});}else{if(AY.st===776){AX.push({cube_id:AY.did,cname:AY.name,ddam:AY.dsm,mdt:"2014-12-10 20:57:25",sz:421,st:AY.st});}}});return function(){AW.showDataImport({isEdit:false,datasets:{cubes:{cube:AX}},AnalysisId:AW.model.mid,StatusCode:2,refreshMultipleCubes:true,rwb:AV.getDataService().rwb});};}function AL(AV){return function(){var AW=new mstrmojo.ui.menus.MenuConfig(),AX=this;if(p()&&AX.model.allowImportData()){AW.addMenuItem(mstrmojo.desc(14303,"New Data..."),"",AG.call(AX));AW.addSeparator();}if(!(mstrApp.isWorkstation&&mstrApp.isVisBuilder)){AW.addMenuItem(mstrmojo.desc(13573,"Existing Dataset..."),"",function(){AX.model.controller.addDataset();});}if(!AV.hasUnsubmitDataset&&AX.model.allowNewOrEditRolapDS()&&(AX.model.isSchemaDefined()||mstrApp.isWorkstation)){AW.addMenuItem(mstrmojo.desc(15397,"Existing Objects..."),"",function(){AX.model.controller.createDataset();});}return AW;};}function AT(AV){var AX=AV&&AV.datasets,AW=(AV.datasetsSettings&&AV.datasetsSettings.units)||{},AZ=function(Ab){return Ab.hide&&!(AW[Ab.n]&&AW[Ab.n].completeHide);},Aa,AY;for(AY in AX){Aa=AX[AY];if(m.filterOne(Aa&&Aa.att,AZ)||m.filterOne(Aa&&Aa.mx,AZ)){return true;}}return false;}function H(AW){var AY=AW&&AW.datasets,AZ=[];function AV(Af,Ac){var Ab=(AW.datasetsSettings&&AW.datasetsSettings.units)||{},Aa=[],Ah=0,Ad={};a.forEach(AY,function(Aj,Ak){if(Aj.did){++Ah;}var Ai=m.filter(Aj[Ac],function(Al){Al.dsid=Ak;Al.ds=Aj.name;Al.tt=Al.n+" ("+Al.ds+")";Al.css=P.getUnitCssClass(Al);return Al.hide&&!(Ab[Al.n]&&Ab[Al.n].completeHide);});Aa=Aa.concat(Ai);});if(!Aa.length){return ;}Aa=P.getSortedDatasetUnits(Aa);var Ae=new mstrmojo.ui.CheckList({cssClass:"units",items:Aa,selectedIndices:Ad,useRichTooltip:true,showTooltip:function Ag(Ai,Al){var Ak=Ai.target||Y.eventTarget(Ai.hWin,Ai.e),Aj=this.getItemFromTarget(Ak),An=Ak.firstChild,Am;Ak.setAttribute("title","");if(Ak.offsetWidth<An.offsetWidth||Ah>0){Am=Y.position(this.getItemNodeFromTarget(Ak));this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",content:Aj.tt,top:Am.y,left:Am.x+Am.w+18};mstrmojo.ui.CheckList.prototype.showTooltip.apply(this,Ai,Al);}}});AZ.push({scriptClass:"mstrmojo.vi.ui.PanelPortlet",title:Af,children:[Ae],t:l[Ac],getSelectedItems:function(){return Ae.getSelectedItems()||[];},updateListScrollbars:function(){Ae.updateScrollbars();}});}AV(mstrmojo.desc(3581,"Attributes"),"att");AV(mstrmojo.desc(3582,"Metrics"),"mx");return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"mstrmojo-ShowHiddenEditor",contents:AZ,onOpen:function AX(){AZ.forEach(function(Aa){Aa.updateListScrollbars();});},fnOk:function(){var Aa=[];AZ.forEach(function(Ac){var Ad=Ac.getSelectedItems();Ad.forEach(function(Ae){Aa.push(AW.getToggleHiddenObjectAction(Ae.dsid,Ae,false));});});var Ab=AW.getDatasetsUpdateCallback();AW.controller.cmdMgr.execute({execute:function(){this.submit(Aa,Ab,AE);},urInfo:{callback:Ab}});}});}function D(AW,AV){m.forEach(AW,function(AY){var AZ=AY.dsid,AX=AV.settings.dataset(AZ);AX.isCollapsed=!!AY.isCollapsed;});}function K(AW,AV){D(AW,AV);AV.saveSettings();}function AS(AW,AV){return function(){var AY=AW.model,AX=AY&&AY.controller,AZ=[{act:"removeDataset",did:AV,disablePU:true,skipCleanup:true}],Aa=AX.getRefreshCallback();if(AW.getDatasetCount()===2){D(a.keyarray(AY.datasets).filter(function(Ab){return Ab!==AV;}).map(function(Ab){return{dsid:Ab,collapsed:false};}),AW);AZ=AZ.concat(AW.settings.getSaveActions());}AX.cmdMgr.execute({execute:function(){this.submit(AZ,Aa,{style:{params:{treesToRender:3}}});},urInfo:{callback:Aa}});};}function AF(AW,Af,AX,AV,Ac){var Ad=F(),Ab=mstrmojo.onetier.vi.prefs.handleErrorMessage,AY=AX.dsm===Ac,Ag,AZ=function Ae(Ai,Ak){Ad.getPollingStatus({id:Ai.id},{success:function Aj(Al){switch(Al.status){case 1:case 2:mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),false);if(Al.status===2){if(Ak.failure){Ak.failure(Al.data);}}else{Ad.refreshNativeDialogMenu();Ak.success(Al.data);}break;case 4:mstrApp.getRootController().showOrHideProgressBar(mstrmojo.desc(13568,"Download from server"),false);return ;default:mstrApp.getRootController().updateProgressBar({pct:Al.pct,msg:Al.msg,requestID:Ai.id,canCancel:Al.status===0});AZ(Al,Ak);}},failure:function Ah(){mstrApp.getRootController().showOrHideProgressBar("Download from server",false);}});},Aa=function(){Ad.loadCube({objectID:AV,addDatasetToDocument:false,dda:Ac===R.DIRECT_ACCESS},{success:function(Ah){mstrApp.getRootController().showOrHideProgressBar("Download from server",true);AZ({id:Ah.id},{success:function(){M(AW,Af,function(Ai){b(Af,AX.did,function(Am){var Ak=r(Am),Aj=[],Al;Ak.forEach(function(An){if(mstrmojo.array.find(Ai,"did",An.did)!==-1){Al={tgtid:An.did,tgtt:An.t,srcid:An.did,srct:An.t};if(An.cont_did&&An.cont_tp){Al.cont_did=An.cont_did;Al.cont_tp=An.cont_tp;}Aj.push(Al);}});X(AW,Af,false,{isOneTierCubeImport:true,source:{did:AV,units:Ai},target:{did:Am.did,units:Ak},onBack:mstrmojo.emptyFn})(Aj,false);});},AV);}});}});};Ad.getCubeInfo({cubeIds:AV},{success:function(Aj){if(Ac===R.IN_MEMORY){if(Aj.hsf){mstrmojo.alert(mstrmojo.desc(14171,"You can not download the data because a security filter has been defined for you in this project."));}else{if(Aj.acld){mstrmojo.alert(mstrmojo.desc(14172,"You can not download the data because you do not have access to all the objects in the selected Intelligent cube."));}else{if(Aj.dda){Ag=AY?mstrmojo.desc(14079,"Data Access Mode for the corresponding Intelligent Cube on the MicroStrategy Server has changed from In-Memory to Connect Live. Due to this change, you will not be able to continue in In-Memory mode. Do you want to switch to Live Connection?"):mstrmojo.desc(14080,"Data Access Mode for the corresponding Intelligent Cube on the MicroStrategy Server has changed from In-Memory to Connect Live. Due to this change, you will not be able to switch to In-Memory mode.");mstrmojo.confirm(Ag,{confirmBtn:{fn:function(){Ac=R.DIRECT_ACCESS;Aa();}}});}else{var Ai=function(Am){return"{"+(Am>=1048576?(Am/1048576).toFixed(2)+"GB":(Math.round((Am||0)*100/1024)/100).toFixed(2)+"MB")+"}";},Al=Aj.maxcs*1024,Ah=Aj.cs,Ak=Ah>Al;if(Ak){mstrmojo.alert(mstrmojo.desc(14081,"The size of the Intelligent Cube #  is more than the download limit ## set by the administrator. Therefore, you can only Connect Live to the selected Intelligent Cube.").replace("##",Ai(Al)).replace("#",Ai(Ah)));}else{Aa();}}}}}else{Aa();}},failure:function(Ah){Ab(Ah);}});}function d(AX,AZ,AV,AY,Aa){if(mstrApp.isSingleTier&&AX.hcs){var AW=AX.dsm===R.DIRECT_ACCESS?"You are using Live connection to an Intelligent Cube residing on a MicroStrategy Server. In order to continue, you need to first convert the cube to a local cube. Do you want to continue?":"You are using an Intelligent Cube from a MicroStrategy Server. In order to continue, you need to first convert the cube to a local cube. Do you want to continue?";mstrmojo.confirm(AW,{confirmBtn:{fn:function(){AV.getDataService().submitUpdates({act:"disconnectDataset",dsid:AZ,dsm:R.IN_MEMORY,ignoreExecution:AY},AM.wrapMethods(Aa,{failure:mstrApp.onerror}),{style:{params:{treesToRender:0}}});}}});}}function s(AV,AY,Aa,AW){function AX(Ad){var Ab=AV.model,Ac=function(){if(Ad===AY.dsm){return ;}if(AY.hcs){AF(AV,Ab,AY,Aa,Ad);}else{function Ae(){AW.controller.cmdMgr.execute({execute:function(){this.submit({act:"toggleDatasetServeMode",dsid:Aa,dsm:Ad},AW.controller.getRefreshCallback(),{style:{params:{treesToRender:3}}});},urInfo:{callback:AW.controller.getRefreshCallback()}});}if(mstrApp.isSingleTier&&!(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){AO(AV,Aa,Ab,{callback:{success:Ae}});}else{Ae();}}};return function(){AW.warnForEditStandaloneDS(AY,Ac);};}return function AZ(){var Ab=new mstrmojo.ui.menus.MenuConfig();Ab.addMenuItem(mstrmojo.desc(11921,"In-Memory"),AY.dsm===R.IN_MEMORY?"on":"",AX(R.IN_MEMORY));Ab.addMenuItem(mstrmojo.desc(12726,"Connect Live"),AY.dsm===R.DIRECT_ACCESS?"on":"",AX(R.DIRECT_ACCESS));Ab.hasToggleItem=true;return Ab;};}function AQ(AX,AY,AW){var AV={act:"datasetSaveAs",managed:AX.managed,nonDelta:true,dsID:AX.dsID,rptName:AX.rptName,rptDesc:AX.rptDesc,saveAsOverwrite:AX.saveAsOverwrite};if(!AX.managed){AV.folderID=AX.folderID;}AW.model.controller.submitUndoRedoUpdates([AV],{},AM.wrapMethods(AW.model.getDatasetsUpdateCallback(),AY),{config:{showProgress:true,hideProgress:true,progressStateText:[mstrmojo.desc(8445,"Loading")],silent:true}},{disablePU:true,treesToRender:mstrmojo.DocDataService.EnumTreesToRender.DEFN,callback:AW.model.getDatasetsUpdateCallback(),extras:mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION});}function I(AW,AX){var AY="mstrIVE_DS_SAVER";return function AV(){var AZ=mstrmojo.all[AY];if(!AX){return ;}if(!AZ){AZ=new mstrmojo.SaveAsEditor({id:AY,folderLinksContextId:32,showCompletePath:false,saveParams:{},saveAs:function(Ac){var Aa=this.contPanel;this.name=Aa.name.value;this.desc=Aa.desc.value;if(!this.name){mstrmojo.alert(mstrmojo.desc(3380,"Please enter valid name"));return ;}var Ad=this.saveParams||{};Ad.managed=false;Ad.folderID=this.ob.currentFolder.did;Ad.rptName=this.name||"";Ad.rptDesc=this.desc||"";Ad.saveAsOverwrite=!!Ac;var Ab=this.saveAsCallback();Ab.failure=function(Af){var Ae=Af.code,Ag=this.parent;if(Ae==="-2147217373"||Ae==="-2147216857"){AA(mstrmojo.desc(7986,"The ## '###' already exists. Do you want to replace the existing one?").replace("##",Ag.typeDesc||"Object").replace("###",Ag.name),{confirmBtn:{fn:function(){Ag.saveAs(true);}}},{title:mstrmojo.desc(3179,"Confirm Overwrite")});}else{if(Ae==="-2147202302"){mstrmojo.alert(mstrmojo.desc(11642,"Cannot save report ## to overwrite report ###, because report #### is also used by the document.").replace("##",AW.data[AX].name).replace("###",Ag.name).replace("####",Ag.name),null,mstrmojo.desc(11643,"Dataset Overwrite Error"));}else{mstrmojo.alert(mstrmojo.desc(7985,"Error while saving: ")+Af.message);}}};Ab.complete=AM.wrapMethods(Ab.complete,function(){mstrApp.hideWait();});Ab.parent=this;AQ(Ad,Ab,AW);mstrApp.showWait({message:mstrmojo.desc(10492,"Saving...")});AZ.close();}});AZ.render();}AZ.saveParams.dsID=AX;AZ.open();};}function U(AX,AV,AZ){var AW=AZ.tables.map(function(Ab){var Ac=Ab.mxRefs[m.find(Ab.mxRefs,"rm",true)],Aa=Ac&&AZ.mx[m.find(AZ.mx,"did",Ac.did)];return a.copy(Ab,{rowCountMetric:Aa});}).filter(function(Aa){return Aa.rowCountMetric&&Aa.rowCountMetric.hide;});if(!AW.length){return ;}var AY=new mstrmojo.ui.menus.MenuConfig();AW.forEach(function(Aa){AY.addMenuItem(Aa.n,"",function(){var Ab=[AV.getToggleHiddenObjectAction(AZ.did,Aa.rowCountMetric,false)];var Ac=AV.getDatasetsUpdateCallback();AV.controller.cmdMgr.execute({execute:function(){this.submit(Ab,Ac,AE);},urInfo:{callback:Ac}});});});AX.addSubMenuItem(mstrmojo.desc(13228,"Show Row Count"),"",null,function(){return AY;});}function N(){var AV=[];m.forEach(this.contents.children,function(AW){if(AW.visible){AV.push(AW);}});return AV;}function w(AW,AV){return function(){var AX=AW.model;AX.getDataService().submitUpdates([{act:"refreshReport",dsID:AV}],AX.controller.getRefreshCallback());};}function Q(AW,AX,AV){return function(){var AZ=AW.model;function Aa(Ae){AW.showDataImport({AnalysisId:AZ.mid,ReportId:AX,CubeName:AV.name,CubeDesc:AV.dsc,isManagedCube:AV.mngd,StatusCode:2,missingCredentialsData:Ae,needDefn:true});}function Ad(){AZ.getDataService().checkMissingCredentials({dsid:AX},{success:function(Ae){window.setTimeout(function(){if(Ae.success){Aa();}else{Aa(Ae);}},0);},failure:function(Ae){mstrmojo.alert(Ae);}});}function AY(Ae){if(Ae&&Ae.tables){return Ae.tables.some(function(Af){return Af.dbRole;});}return false;}if(mstrApp.isSingleTier&&!(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){Ad();}else{if(!mstrApp.isSingleTier&&AY(AV)){var Ac=a.clone(AV),Ab=q.standardizeDBRolesFormat({dsid:Ac});Aa({datasets:Ab});}else{Aa();}}};}function C(){var AV=this.settings;this.set("useTableView",!!(AV&&AV.useTableView));}function J(AV){var AY=this.settings,AZ=(this.contents.children||[]).length===1;if(AV){if(AZ){var AX=this.contents.children[0],AW=AX.tableView||AX.mdxView;return AW&&AW.setting.hasCollapsedChildNodes(false,false);}else{return(this.contents.children||[]).some(function(Ab){var Aa=AY.dataset(Ab.did);return Aa.getCollapsed()===false;});}}else{return(this.contents.children||[]).some(function(Ac){var Ab=AY.dataset(Ac.did),Aa=Ac.tableView||Ac.mdxView;if(Ab.getCollapsed()===true){return true;}else{return Aa&&Aa.setting&&Aa.setting.hasCollapsedChildNodes(true,true);}});}}function u(){return[mstrApp.isWorkstation?V.UICMD_DEFAULT_ERROR:V.DOCDATA_PREPARE_TASK_REPORT_INCOMP];}function B(AV,AZ){if(!mstrApp.isOpenExisting&&!mstrApp.isVisBuilder&&this.model.isnew&&!AV&&AZ){var AY=Y.position(AZ.domNode);this.openPopup({scriptClass:"mstrmojo.Popup",autoCloses:true,locksHover:true,cssClass:"mstrmojo-VIDocDatasetObjects mstrmojo-Tooltip vi-regular vi-tooltip-C A-center",titleNodeCssClass:"mstrmojo-Tooltip-arrow",contentNodeCssClass:"mstrmojo-Tooltip-contentWrapper",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15623,"To get started, click here to add your data.")},{scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(14851,"Don’t show me again"),postcheckedChange:function AX(){if(mstrApp.isWorkstation){var Ac=new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy(),Aa={feature_flag:{}};Aa.feature_flag[L]=true;Ac.savePreferences(Aa);}else{var Ab=mstrmojo.global.localStore;Ab.setItem(L,this.checked,-1);}}}],updatePopupConfig:function AW(Ab){var Aa=this.popupConfig;if(!Aa){Aa=this.popupConfig=this.addDisposable(new mstrmojo.ui.PopupConfig({isHostedWithin:false}));}Aa.position=Ab.position;}},{position:{x:AY.x+AY.w+15,y:AY.y-4}});}}mstrmojo.vi.ui.DocDatasetObjects=mstrmojo.declare(mstrmojo.vi.ui.DatasetObjects,[mstrmojo.util.ui._HostsSplitter,mstrmojo.vi.ui.toolbars._HasToolbar,mstrmojo._HasPopup],{scriptClass:"mstrmojo.vi.ui.DocDatasetObjects",cssClass:"mstrmojo-VIDocDatasetObjects",datasetUnitListScriptClass:"mstrmojo.vi.ui.DocDatasetUnitList",settings:null,onLogout:function(AW){var AV=mstrApp.rootCtrl,AX=AV.dataProvider,AY=AX&&AX.sessionState;if(!AW||(AY&&AY===AW)){AV.set("dataProvider",null);}},init:function AK(AV){this._super(AV);this.model.attachEventListener("updateUseTableView",this.id,function(){C.call(this);});C.call(this);},onsettingsChange:function(){C.call(this);},onAppStateChange:function t(AV){this._super(AV);if(this.visible&&mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION&AV.valueWas&&!mstrApp.isAppStatePresentation()){this.refresh();}},getLinksForEmptyData:function A(){var AW=this.model,Aa=function Aa(Ad){return{useRichTooltip:true,updateTooltipConfig:function Ac(){var Af=this.parent.parent._lastOpened,Ae=Af&&Af.visible,Ag=Y.position(this.domNode);this.richTooltip=(Ae&&this.alias==="newDataLink")?null:{content:Ad,cssClass:"vi-regular vi-tooltip-C A-center",left:Ag.x+Ag.w+10,top:Ag.y-4};}};},Ab=o(mstrmojo.desc(15398,"Existing Objects"),function(){this.model.controller.createDataset();}.bind(this),false,Aa(mstrmojo.desc(15399,"Create a new dataset using attributes and metrics available on any one of your connected environments."))),AV=o(mstrmojo.desc(15343,"Existing Dataset"),function(){this.model.controller.addDataset();}.bind(this),false,Aa(mstrmojo.desc(15400,"Select a dataset from any one of your connected environments. Includes existing reports and cubes."))),AY=o(mstrmojo.desc(15396,"New Data"),function(){this.model.controller.importFile();}.bind(this),false,a.copy({alias:"newDataLink"},Aa(mstrmojo.desc(15401,"Import data from your local machine, such as excel or csv files, or connect to a database.")))),AX=[];if(AW.allowImportData()){AX.push(AY);AX.push({scriptClass:"mstrmojo.Box",cssClass:"button-splitter"});}if(AW.allowManageDocumentDataset()&&!(mstrApp&&mstrApp.isWorkstation&&mstrApp.isVisBuilder)){AX.push(AV);}if(AW.allowNewOrEditRolapDS()&&(AW.isSchemaDefined()||mstrApp.isWorkstation)){AX.push(Ab);}var AZ={text:""};AX.forEach(function(Ac){var Ad=Ac.text;if(Ad&&(Ad.length>AZ.text.length)){AZ=Ac;}});AZ.cssClass+=" longest";if(AX.length>0){AX.unshift({scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11780,"Add Data")});}return AX;},getDatasetTableView:function O(AX,AY){var AW=this,AV=this.settings;return mstrmojo.mixin({setting:AV.dataset(AY),onTableCollapsedChange:function(Aa,AZ){this._super();if(!AW.isSearching){this.setting.table(Aa).isCollapsed=AZ;AW.saveSettings();}}},this._super(AX,AY));},getDatasetMDXView:function AC(AX,AY){var AW=this,AV=AX.tables&&AX.tables[0]&&AX.tables[0].did;return mstrmojo.mixin({setting:this.settings.dataset(AY).table&&this.settings.dataset(AY).table(AV),onNodeCollapsedChange:function(AZ){this._super();if(!AW.isSearching){AZ.setting.isCollapsed=AZ.isCollapsed;AW.saveSettings();}}},this._super(AX,AY));},getDatasetPortlet:function AJ(Aa,AW,AX,AZ){var Af=this,Ab=Af.model,Ai=this._super(Aa,AW,AX,AZ),Ag=Aa.st===768,Ac=Aa.st===776,Ah=Aa.st===779,AY=Aa.acg,Ae=AY&&(AY&n.DssAccessRightUseFlag)&&(AY&n.DssAccessRightExecuteFlag),Aj=this.settings&&this.settings.dataset(AW);a.copy({isCollapsed:Aj?!!(Aj.getCollapsed()):false,onCollapsedChange:function Ad(){K([{dsid:AW,isCollapsed:this.isCollapsed}],AX);},onclick:function(Al){var Am=Al.getTarget(),Ak=this;if(mstrmojo.dom.contains(Ak.titleBar.leftToolNode,Am,true,Ak.domNode)){Af.updateScrollbars();if(!Af.isSearching){K([{dsid:Ak.did,isCollapsed:Ak.isCollapsed}],AX);}}},addMenuItems:function AV(An){var Ak=false;An.hostId=this.id;An.isHostedWithin=false;An.supportsScroll=true;An.maxHeight=Y.getMaxScrollHeight();var As=(mstrApp.getWSLiveMode&&!mstrApp.getWSLiveMode())&&Ab.hasHadoopSource(Aa)&&!Ab.isLiveDataset(Aa);function Aq(){var Au=Ab.controller,Ay=function(A0){mstrmojo.confirm(mstrmojo.desc(16016,"Updating this dataset may take some time. Do you want to update it anyway?"),{confirmBtn:{t:mstrmojo.desc(505,"Update"),fn:A0},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:mstrmojo.emptyFn}},{title:mstrmojo.desc(13850,"Update Dataset")});},At={dataset:a.clone(Aa),docModel:Ab,title:mstrmojo.desc(3034,"Edit Dataset")+" - "+Aa.name,okBtnText:mstrmojo.desc(13850,"Update Dataset"),onOk:function(A2){var A0=this,A3=AM.wrapMethods(Au.getRefreshCallback(),{failure:function(A4,A5){this.canceled(A5.id);}});if(A2.length){var A1=function(){Au.cmdMgr.execute({execute:function(){this.submit(A2,AM.wrapMethods(A3,{success:function(){A0.close();}}),a.copy({skipUICmdMgrOnFailure:u()},j));},urInfo:{callback:A3}});};if(A0.dataset.dsm===R.DIRECT_ACCESS&&A0.modifiedItems.del.length===0){A1();}else{Ay(A1);}}}},Ax={isEdit:true,isNewAnalysis:false,isManagedCube:Aa.mngd,AnalysisId:Ab.mid,ReportId:AW,CubeName:Aa.name,CubeDesc:Aa.dsc,StatusCode:1,needDefn:true};if(!Aa.mngd){var Aw=o(mstrmojo.desc(13364,"Keep Changes Local"),function(){var A1=Ab.datasets,A0={act:"convertDatasetToManaged",dsID:AW};if(Ah){f.call(Af,function(){var A2=Au.cmdMgr.getInterimCmd();A2.urInfo.callback=Au.model.getDatasetsUpdateCallback();A2.submitInterim(A0,{success:function(A5){var A4=null,A3=null;a.forEach(A5.datasets,function(A6,A7){if(!A1[A7]){A4=A6;A4.did=A3=A7;return false;}});Af.showDataImport({isEdit:true,isNewAnalysis:false,isManagedCube:A4.mngd,AnalysisId:Ab.mid,ReportId:A3,CubeName:A4.name,CubeDesc:A4.dsc,StatusCode:1,callback:function(A8){var BA=Af.model.cmdMgr(),A9=BA.getInterimCmd();if(A8){var A7=Af.model.controller.getRefreshCallback();A9.urInfo.callback=A7;A9.resetCmdMgrOnComplete();A9.submit([],A7,j,BA.CMD_PHASE.LAST);}else{var A6=A9.urInfo;A6.callback={success:mstrmojo.emptyFn};A6.treesToRender=0;A9.cancel();}}});}});});}else{AX.openDatasetEditor(a.copy(At,{modifiedItems:{convert:A0,add:[],del:[],fs:{add:[],del:[]},filter:null}}));}},true);var Az=Aa.acg&n.DssAccessRightWriteFlag;var Av=Aa.acg&n.DssAccessRightExecuteFlag;if(!(Az&&Av)){AA(mstrmojo.desc(16029,"You do not have execute or write access to this stand-alone dataset. You can only make changes local to this dossier by duplicating and embedding the dataset in this dossier."),{},{cssClass:"mstrmojo-warning-ConfirmEditDataset",buttons:[o(mstrmojo.desc(3034,"Edit Dataset"),mstrmojo.emptyFn,true,{enabled:false}),o(mstrmojo.desc(2140,"Cancel"),mstrmojo.emptyFn),Aw]});}else{AA(mstrmojo.desc(16030,"Editing this dataset will immediately affect other documents and dossiers that share the dataset. Do you want to edit the stand-alone dataset or keep your changes local by duplicating and embedding the dataset in this dossier?"),{},{cssClass:"mstrmojo-warning-ConfirmEditDataset",buttons:[o(mstrmojo.desc(3034,"Edit Dataset"),function(){if(Ah){Af.showDataImport(Ax);}else{var A0=a.copy(At);A0.onOk=function(A2){if(A2.length){var A1=this;Ay(function(){var A3=AM.wrapMethods(Au.getRefreshCallback(),{failure:function(A4,A5){this.canceled(A5.id);}});Au.cmdMgr.execute({execute:function(){this.submit(A2,AM.wrapMethods(A3,{success:function(){A1.close();}}),{skipUICmdMgrOnFailure:u(),style:{params:{treesToRender:3}}});},urInfo:{callback:A3}});});}};AX.openDatasetEditor(A0);}}),o(mstrmojo.desc(2140,"Cancel"),mstrmojo.emptyFn),Aw]});}}else{if(Ah){Af.showDataImport(Ax);}else{AX.openDatasetEditor(At);}}}var Al=Aa.copyable==="true"||Aa.copyable===undefined;if(!(Ab.isRADataset(Aa)&&(!Ah||mstrApp.isSingleTier))&&!Ac&&Aa.rt!==8&&c.call(Af,Aa)&&!(Ag&&!Ab.allowModifyReportList())&&!Ak&&((Ah&&Ab.hasPrivilegesForAllTables(Aa.tables))||(!Ah&&((!Aa.idd&&!Aa.mngd&&Ab.allowManageDocumentDataset())||(!Aa.idd&&Aa.mngd&&Ab.allowNewOrEditRolapDS())||(Aa.idd&&Ab.allowNewOrEditDummyDS()))))&&!mstrApp.isInVFConfigMode&&!Ab.isSparkDataset(Aa)&&!As){var Ao,Ap;if(Al){Ao="addMenuItem";Ap="";}else{Ao="addDisabledMenuItem";Ap=mstrmojo.desc(16119,"Editing the dataset is not available for this dossier as the data has been limited for your specific user.");}An[Ao]({n:mstrmojo.desc(11923,"Edit Dataset..."),ttp:Ap},"",function(){var At=false;if(mstrApp.isSingleTier&&!(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){m.forEach(Aa.tables,function(Au){if(Au.xdaType===z.xdaType.salesforce){At=true;return false;}});if(At){Aq();}else{AO(AX,AW,Ab,{callback:{success:Aq}});}}else{Aq();}});}if(Aa.dsm===R.IN_MEMORY&&!Ab.isMDXDataset(Aa)&&!(mstrApp.isAppStatePause&&mstrApp.isAppStatePause())){if(!Aa.tables||Aa.tables.length===1){An.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"shwd",function(){mstrmojo.vi.ui.ViewDataDialog.openDS(Ab,Aa,AW);});}else{An.addPopupMenuItem(mstrmojo.desc(11476,"Show Data"),"",function(){var Au=new mstrmojo.ui.menus.MenuConfig(),At=Aa.tables;At.forEach(function(Aw,Av){Au.addMenuItem(Aw.n,"",function(){mstrmojo.vi.ui.ViewDataDialog.openDSTable(Ab,Aa,AW,Av);});});return Au;});}}if(!mstrApp.isInVFConfigMode){if(Ab.allowManageDocumentDataset()){An.addSubMenuItem(mstrmojo.desc(4571,"Join Behavior"),"",this.id,function(){return x(Ab,Aa);});An.addSeparator();}if(!Ab.isDataImportRemoteDataSource(Aa)||mstrApp.isSingleTier){if(Aa.hcs){if(Aa.idd!==true){An.addMenuItem(mstrmojo.desc(773,"Refresh"),"",function(){AF(AX,AX.model,Aa,AW,Aa.dsm);});}}else{if((Aa.rt===1&&Ab.allowReExecuteRegularReport())||(Aa.rt===8&&Ab.allowReExecuteViewReport())){An.addMenuItem(mstrmojo.desc(15209,"Refresh Dataset"),"",function(){mstrmojo.confirm(mstrmojo.desc(16015,"Refreshing this dataset may take some time. Do you want to update it anyway?"),{confirmBtn:{t:mstrmojo.desc(505,"Update"),fn:w(AX,Aa.did)},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:mstrmojo.emptyFn}},{title:mstrmojo.desc(15209,"Refresh Dataset")});});}else{if(Ac&&Ab.allowManageDocumentDataset()&&Ab.allowReExecuteCubeReport()&&!Aa.localbin&&Ae){An.addMenuItem(mstrmojo.desc(13610,"Republish Cube..."),"",function(){mstrmojo.confirm(mstrmojo.desc(13956,"Publishing time depends on your dataset. Are you sure you want to republish?"),{confirmBtn:{t:mstrmojo.desc(13953,"Republish"),fn:w(AX,Aa.did)},cancelBtn:{t:mstrmojo.desc(2140,"Cancel"),fn:mstrmojo.emptyFn}},{title:mstrmojo.desc(2914,"Warning")});});}else{if(Ah&&Aa.sda!==g.SupportDDAOnly&&Aa.dsm!==R.DIRECT_ACCESS&&Ab.allowManageDocumentDataset()&&Ab.allowReExecuteCubeReport()&&Ab.hasPrivilegesForAllTables(Aa.tables)&&!Ab.isSparkDataset(Aa)&&Ae){An.addMenuItem(mstrmojo.desc(13610,"Republish Cube..."),"",Q(AX,AW,Aa));}}}}}}if(Aa.sda===g.SupportDDAOrInMemory&&Aa.rt===7&&Ab.allowManageDocumentDataset()&&Aa.acg&n.DssAccessRightWriteFlag&&!Ab.isSparkDataset(Aa)&&mstrmojo.resolveFeature(k.WEB_IMPORT_DATABASE)){An.addSubMenuItem(mstrmojo.desc(11922,"Data Access Mode"),"",this.id,s(AX,Aa,AW,Ab));}if((p()||Af.getDatasetCount()>1)&&Ab.allowManageDocumentDataset()&&!(this.mdxView&&this.mdxView.docModel.isRADataset(this.dataset))){if(mstrApp.isInVFConfigMode){An.addNonInteractiveMenuItem(mstrmojo.desc(11484,"Replace Dataset with"),"",true);}else{An.addSubMenuItem(mstrmojo.desc(11484,"Replace Dataset with"),"",this.id,AR(AX));}}An.addSeparator();if(Ah&&this.useTableView){U(An,Ab,Aa);}if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(k.INSERT_NEW_METRIC)){An.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",AU.call(this,Aa,Ab));if(!mstrApp.isInVFConfigMode&&!(Ab.isMDXDataset(Aa)&&Ab.isDDADataset(Aa))){An.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",AD.call(this,this.did,Af.data));}}An.addSeparator();if(!mstrApp.isSingleTier&&!Aa.idd&&Ab.allowSaveDataset()&&Ab.allowWebExecuteCubeReport()){if(((Aa.att||[]).length+(Aa.mx||[]).length)>0){var Ao,Ap;if(Al){Ao="addMenuItem";Ap="";}else{Ao="addDisabledMenuItem";Ap=mstrmojo.desc(16120,"Saving the dataset is not available for this dossier as the data has been limited for your specific user.");}An[Ao]({n:mstrmojo.desc(13239,"Save Dataset..."),ttp:Ap},"",I(AX,this.did));}}if(Aa.mngd&&Ab.allowManageDocumentDataset()){if(((Aa.att||[]).length+(Aa.mx||[]).length)>0){if(!(mstrApp.isSingleTier&&Aa.hcs&&!Aa.idd)){An.addMenuItem(mstrmojo.desc(1388,"Rename"),"rnm",function(){this.ctxt.titleBar.editTitle();},this);}}}if(Ab.allowManageDocumentDataset()){if(mstrApp.isInVFConfigMode){An.addNonInteractiveMenuItem(mstrmojo.desc(629,"Delete"),"",true);}else{An.addMenuItem(mstrmojo.desc(629,"Delete"),"",AS(this.parent.parent,this.did));}}if(AX.gridSource===this.did){An.addToolbarBtn(mstrmojo.desc(11647,"This is the primary dataset."),"default-set",mstrmojo.emptyFn);}if(Aa.unpublished){An.addToolbarBtn(mstrmojo.desc(15803,"This cube is not published"),"unpublished",mstrmojo.emptyFn);}var Am=P.getHighlightElementHandler;An.addPopupHandlers(this.id,Am(true,this.titlebarNode),Am(false,this.titlebarNode));if(Ah&&Ab.allowManageDocumentDataset()&&Ab.hasPrivilegesForAllTables(Aa.tables)&&!Ab.isSparkDataset(Aa)){var Ar=Aa.tables;if(Ar&&Ar.length>1&&!(mstrApp.isSingleTier&&Aa.dsm===R.DIRECT_ACCESS)){An.addSubMenuItem(mstrmojo.desc(11924,"Delete Table"),"","",function(){var At=new mstrmojo.ui.menus.MenuConfig();Ar.forEach(function(Au){At.addMenuItem(Au.n,"",function(){var Av=function(){Ab.warnForEditStandaloneDS(Aa,function(){Ab.getDataService().submitUpdates({act:"deleteEMMATable",dsid:AW,tbid:Au.did},AM.override({success:function(Aw){this._super.call(Ab,Aw);Ab.controller.cmdMgr.reset();}},Ab.controller.getRefreshCallback()));});};if(mstrApp.isSingleTier&&Aa.hcs){d(Aa,AW,Ab,true,{success:function(){Av();}});}else{Av();}});});return At;});}}return An;}},Ai);return Ai;},getDatasetTitleBarCfg:function(Ab){var AV=this._super(Ab),AX=this,Aa=Ab.dataset;a.copy({editTitleOnDoubleClick:AX.model.allowManageDocumentDataset()&&!!Aa.mngd&&((Aa.att||[]).length+(Aa.mx||[]).length)>0,useRichTooltip:true,titleEdited:function AZ(Ad,Ag,Ac){if(Ag){var Ae=function(){Ab.titleBar.set("title",Ac);},Ah=function(){AX.model.renameDataset(Ab.did,Ad.trim(),AM.wrapMethods(AX.model.getDatasetsUpdateCallback()),{failure:function(Ai){mstrApp.onerror(Ai);Ab.titleBar.set("title",Ac);}});};var Af=false;a.forEach(AX.model.datasets,function(Ai){if(Ai.name===Ad.trim()){Af=true;return false;}});if(Af){AA(mstrmojo.desc(13365,"Another dataset with same name exists. Do you want to keep this name?"),{},{buttons:[o(mstrmojo.desc(1442,"OK"),function(){P.validateName(Ad,Ah,Ae);},true),o(mstrmojo.desc(2140,"Cancel"),function(){Ae();})]});}else{P.validateName(Ad,Ah,Ae);}}},updateTooltipConfig:function AY(Ad){var Ac=Y.position(this.domNode);this.richTooltip={content:this.getTooltipContent(),posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:Ac.y-2,left:Ac.x+Ac.w+6};},shouldShowTooltip:function(Ac,Ad){return true;},getTooltipContent:function AW(){Aa=this.parent.dataset;var Af=Aa.name,Ah,Ac='<span class="dsc">#####</span>',Ad='<div class="name">@@@@@</div>',Ae={1:mstrmojo.desc(16230,"Standard Report"),7:{"true":mstrmojo.desc(16232,"OLAP Cube"),"false":mstrmojo.desc(16233,"Super Cube")},8:mstrmojo.desc(16231,"Cube Report")},Ag=Ae[Aa.rt];Ah=(Ag||{})[!!Aa.xdaType];Ah=Ah||Ag;if(mstrApp.isSingleTier){if(!Aa.hcs&&!Aa.connInfo){if(Aa.dsm==2){Ad=Ad.replace("@@@@@","@@@@@ "+Ac.replace("#####",mstrmojo.desc(13575,"(Live)")));}}else{if(!!Aa.hcs&&!!Aa.connInfo){if(Aa.dsm==2&&(Aa.sdsm==1||Aa.sdsm==2)){Ad=Ad.replace("@@@@@","@@@@@ "+Ac.replace("#####",mstrmojo.desc(16235,"(Live to Server)")));}}}}else{if(Aa.dsm===2){Ad=Ad.replace("@@@@@","@@@@@ "+Ac.replace("#####",mstrmojo.desc(13575,"(Live)")));}}if(Ah){if(mstrApp.isAppStatePause()&&Aa.unpublished){Ad+='<div class="dsc unpublished">'+mstrmojo.desc(16234,"This ##### is unpublished.")+"</div>";}else{Ad+='<div class="dsc">'+mstrmojo.desc(16229,"Dataset type")+": #####</div>";}Ad=Ad.replace("#####",Ah);}Ad=Ad.replace("@@@@@",mstrmojo.string.encodeHtmlString(Af));return Ad;},},AV);return AV;},saveSettings:function(){if(this.settings){this.settings.save();this.generateToolbar();}},ongridSourceChange:function(){this._super();var AW=this,AV=function(){a.forEach(AW.data,function(AY,AX){var AZ=AW.getDatasetPanel(AX);if(AZ){AZ.generateToolbar();}});};if(this.visible){AV();}else{if(!this.updateToolbarHandle){this.updateToolbarHandle=this.attachEventListener("showPanel",this.id,function(){AW.updateToolbarHandle.clear();delete AW.updateToolbarHandle;AV();});}}},handleNode:null,unit:null,gridSource:null,postBuildRendering:function e(){var AX=this.handleNode;AX.style.display="block";this.registerSplitter(AX);var AW=this._super();var Ab=this.importDataBox,Aa=Ab&&Ab.newDataLink;if(mstrApp.isWorkstation&&!(mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode())){var AY=new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy(),AZ=this;AY.getSavedPreferences({success:function(Ac){var Ae=Ac.feature_flag||{},Ad=Ae[L];B.call(AZ,Ad,Aa);}});}else{var AV=mstrmojo.global.localStore;B.call(this,AV.getItem(L),Aa);}return AW;},unrender:function E(AV){this.closePopup();this._super(AV);},setDimensions:function AB(AY,AW){this._super(AY,AW);var AX=this.handleNode,AV=AX&&AX.style;if(AV){AV.top=0;AV.left=AW;AV.height=AY;AV.width="6px";}},getSplitterInfo:function AH(){return{min:120,max:Math.max(parseInt(this.parent&&this.parent.width,10)/2,330)};},postCreate:function h(){var AV=this.getSplitterInfo().min,AW=Y.windowDim().w/2;if(parseInt(this.width,10)<AV){this.set("width",AV);}if((AW>=AV&&parseInt(this.width,10)>AW)||parseInt(this.width,10)>2000){this.set("width","174px");}},splitterMoved:function W(AV){var AX="width",AW=parseInt(this[AX],10)+AV;this.set(AX,AW+"px");this.parent.doLayout();this.getPanelSaver().saveProperty("size",AW);},passToolbarCfg:function S(AV){var AW=this.titleBar.toolbarCfg;if(AW){AW.destroy();}this.titleBar.set("toolbarCfg",AV);},updateToolbar:function v(Ac){var Ab=mstrApp.isSingleTier;var AX=this.id,Ad=this,Aa=this.contents.children,AZ=N.call(this),Ae=Ab?mstrmojo.desc(14305,"Add New Data"):mstrmojo.desc(11780,"Add Data");Ac.hostId=this.id;Ac.isHostedWithin=false;Ac.supportsScroll=true;Ac.maxHeight=Y.getMaxScrollHeight();if(!Ad.model.hasMDXRADataset(Ad.model.datasets)){if((mstrApp.isWorkstation&&Ad.model.allowImportData())||Ad.model.allowManageDocumentDataset()){if(mstrApp.isInVFConfigMode){Ac.addNonInteractiveMenuItem(Ae,"",true);}else{Ac.addPopupMenuItem(Ae,AX,AL(Ad),"");}}}if((p()||Ad.getDatasetCount()>1)&&Ad.model.allowManageDocumentDataset()&&!Ad.model.hasMDXRADataset()){Ac[(!mstrApp.isInVFConfigMode&&Ad.getDatasetCount()>0)?"addSubMenuItem":"addDisabledMenuItem"](mstrmojo.desc(11485,"Replace All Datasets"),"",this.id,AR(Ad,true));}Ac.addSeparator();if(AT(Ad.model)){Ac.addEditorMenuItem(mstrmojo.desc(11612,"Show Hidden Objects"),this.id,function(){return H(Ad.model);});}Ac.addSeparator();var Af=a.valarray(Ad.data).some(function(Ag){return Ag.tables&&Ag.tables.length>1;});var AW=a.valarray(Ad.data).some(function(Ah){if(Ad.model.isMDXDataset(Ah)){var Ag=Ah.tables[0];return(Ag.dimensions&&Ag.dimensions.length>0)||(Ag.metricFolder&&Ag.metricFolder.folders&&Ag.metricFolder.folders.length>0);}return false;});if(Af){Ac.addSeparator();Ac.addRadioMenuGroup(!!Ad.settings.useTableView,function(Ag){var Ah=Ad.settings;Ah.useTableView=Ag;Ad.model.raiseEvent({name:"updateUseTableView",useTableView:Ag});Ad.saveSettings();},[{value:false,text:mstrmojo.desc(11925,"Flat View")},{value:true,text:mstrmojo.desc(11926,"Table View")}],"",null,true);}if(Aa&&(Aa.length>1||(Af&&Ad.settings.useTableView)||AW)){Ac.addSeparator();var AY=true,AV=true;if(AZ.length<Aa.length){AY=false;AV=false;}else{AY=J.call(Ad,false);AV=J.call(Ad,true);}if(!AY){Ac.addDisabledMenuItem(mstrmojo.desc(11816,"Expand All"),"expand-all");}else{Ac.addMenuItem(mstrmojo.desc(11816,"Expand All"),"expand-all",function(){Ad.toggleAllNodesCollapsed(false,true);});}if(!AV){Ac.addDisabledMenuItem(mstrmojo.desc(11817,"Collapse All"),"collapse-all");}else{Ac.addMenuItem(mstrmojo.desc(11817,"Collapse All"),"collapse-all",function(){Ad.toggleAllNodesCollapsed(true,true);});}}Ac.addSeparator();Ac.addMenuItem(mstrmojo.desc(1143,"Help"),"help",function(){mstrApp.showHelpTopic("datasets_panel.htm");});return Ac;},getShowDatasetPicker:function(AV){var AW=this;return function(){var AX=AN(a.copy(AV,{id:"mstrIVE_DS",multiSelect:true,onOk:function(){f.call(AW,function(){AW.model.addDataset(AX.selectedItems);});}}));AX.open();};},openDatasetEditor:function(AZ){var AW=AZ.docModel,AV=AW.controller,Aa=this,AY=AW.datasets,AX=a.copy(AZ,{onOk:function(Ac){var Ab=this,Ad=AM.wrapMethods(AV.getRefreshCallback(),{failure:function(Ae,Af){this.canceled(Af.id);}});if(Ac.length){AV.cmdMgr.execute({execute:function(){this.submit(Ac,AM.wrapMethods(Ad,{success:function(){Ab.close();}}),{skipUICmdMgrOnFailure:u(),style:{params:{treesToRender:3}}});},urInfo:{callback:Ad}});}},closeOnSubmit:false,hasLTSDataset:AW.hasLTSDataset(AY),derivedMetricCount:AW.getDerivedMetricCount(AZ.dataset)});this.model.controller.rootCtrl.loadDataProvider(function(Ab){AX.dataProvider=Ab;var Ac=new mstrmojo.vi.ui.DatasetEditor(AX);Aa.datasetEditorId=Ac.id;Ac.open();});},onDatasetFilterChange:function(AV){if(AV&&this.settings.dataset(AV).isCollapsed){K([{dsid:AV,isCollapsed:false}],this);}this.generateToolbar();this.updateScrollbars();},showDataImport:function AI(AW){AW.hasNonRADataset=this.model.hasNonRADataset();var AY;if(this.dataImportId){AY=mstrmojo.all[this.dataImportId];}if(!AY){AY=mstrmojo.insert(mstrmojo.DI.DIContainer);}this.dataImportId=AY.id;var AX=this,AV=function(){a.copy(AW,AY.dataImportParams);AY.open();};var AZ=function(){var Aa=AW&&AW.missingCredentialsData,Ac={},Ad=function(Ah,Ai){if(!Ah||Ai[Ah.id]){return ;}if(Ah.id&&Ah.destroy){Ai[Ah.id]=true;}if(Ah.constructor===Array){for(var Af=0;Af<Ah.length;Af++){Ad(Ah[Af],Ai);}}else{if(typeof Ah==="object"){var Ag;for(Ag in Ah){if(Ah.hasOwnProperty(Ag)){Ad(Ah[Ag],Ai);}}}}};Ad(Aa,Ac);var Ae;for(Ae in Ac){if(Ac.hasOwnProperty(Ae)){var Ab=mstrmojo.all[Ae];if(Ab&&Ab.destroy){Ab.destroy();}}}};if(AW.callback){AY.dataImportCallback=function(Aa){AW.callback(Aa);AZ();};AV();}else{AY.dataImportCallback=function(Ae){var Ac=[],Ag=AX.model.cmdMgr(),Af=Ag.getInterimCmd();if(Ae){Ac=(Ae||[]).filter(function(Ah){return !AX.model.datasets[Ah.did]&&!Ah.mngd;});if(Ac.length){AX.model.addDataset(Ac,{success:function(){Af.completeSubmit();}});}else{var Ab=AX.model.controller.getRefreshCallback(),Ad=AW.needDefn?j:null;Af.urInfo.callback=Ab;Af.resetCmdMgrOnComplete();Af.submit(AX.model.getOpenDatasetPanelAction(),Ab,Ad,Ag.CMD_PHASE.LAST);}}else{var Aa=Af.urInfo;Aa.callback={success:mstrmojo.emptyFn};Aa.treesToRender=0;Af.cancel();}AZ();};f.call(AX,AV);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.vi.models.DocXtabModel","mstrmojo.EnumRWUnitType");var C=mstrmojo.array,B=mstrmojo.hash;var F="Metrics",D=2,H="\u001E",E="\u001F";mstrmojo.vi.models.DocVisModel=mstrmojo.declare(mstrmojo.vi.models.DocXtabModel,null,{scriptClass:"mstrmojo.vi.models.DocVisModel",getHMSelecAttrElemIdsInfo:function(R){var Q=R[0],L=Q.tid,N=Q.tids,M=Q.selections,K={},S=[],P=this.scm,O=(L&&P&&P[L]);C.forEach(M,function(V){var U=(V&&V.length)||0,W=U>0?V[U-1]:{},X=W.tid;if(P[X]){if(!K[X]){K[X]=[];}K[X].push(W.eid);}});B.forEach(K,function(U){S.push(U.join(H));});if(O&&O.showall&&S.length===0){C.forEach(N,function(U){S.push("OA:(All)");K[U]=[];});}return{eids:S.join(E),tids:Object.keys(K)};},getSelectedAttributeElementIdStr:function(S){var R=S[0],K=R.tid,L,M=R.selections,N=[],P=[];C.forEach(M||[],function(U){N=N.concat(C.filter(U,function(V){return V.tid===K;}));});N=C.distinct(N,"eid");(N||[]).forEach(function(U){P.push(U.eid);});L=P.join(H);var Q=this.scm,O=(K&&Q[K]);if(O&&O.showall&&P.length===0){L="OA:(All)";}return L;},getHMAction:function A(Z){var Y=Z[0],N=Y&&Y.at,R=Y.anchor,M=Y.selections,W=this.scm,K=[],O=[],Q=[],a=[],S,U,X,L,V,P;V=this.getHMSelecAttrElemIdsInfo(Z);L=V.eids;if(M.length!==0&&L===""){return null;}if(N&&((N&D)>0)&&W){C.forEach(V.tids,function(c){var b=W[c];if(b){K.push(b);O.push(b.ck);Q.push(b.ckey);a.push(b.tks);}});S=O.join(E);U=Q.join(E);X=a.join(H);if(K.length&&L!==""){P={h:"onGridSelector",a:{type:mstrmojo.EnumRWUnitType.GRID,anchor:R,ck:S,tks:X,eid:L,ctlKey:U,sliceId:this.xtab.sid,isUConDS:K[0].isUConDS,isDocVis:true}};}}return P;},getDrillWithinActionsForAssociatedNodes:function G(K,L,Q,R){var O=this,U=this.docModel,M=[U.getDataService().getDrillGridAction(this.getDrillAction(this.xtab.k,L,K))],S=!!R?R:this.xtab,N=!mstrApp.isInVFConfigMode?(S.getAssociatedNodes&&S.getAssociatedNodes()||[]):[];Q=mstrmojo.func.wrapMethods(Q,{success:function P(){C.forEach(N,function(W){var V=U.getPanel().getUnitByKey(W.k);if(V&&V.boxContent){V.boxContent.raiseEvent({name:"regenerateToolbar"});}});}});C.forEach(N,function(V){M.push(U.getDataService().getDrillGridAction(O.getDrillAction(V.k,L,K)));});return{actions:M,callback:Q};},getDrillAction:function I(L,N,K){function M(S){var R=[];for(var Q=0,O=S.length;Q<O;Q++){var V=S[Q];for(var P=0,W=V.length;P<W;P++){var U=V[P];if(mstrApp.useBinaryFormat){R.push(U.axis+"A"+(U.ui+1)+"A"+U.o);}else{R.push(U.axis+"A"+(U.ui+1)+"A"+U.o);}}}return(mstrApp.useBinaryFormat)?R:R.join(",");}return{srcMsgId:this.data.mid,sliceId:this.xtab.sid,nodeKey:L,retainParent:K.retainParent||"",isWithin:K.drillPath.within,drillPathKey:K.drillPath.k,drillPathIndex:K.drillPath.dpi,drillElements:M(N)};},getAction:function J(U){var S=U[0],N=S&&S.at,P=S.anchor,K=S.tid,L,O,M=S.selections;L=this.getSelectedAttributeElementIdStr(U);if(M.length!==0&&L===""){return null;}if(N&&((N&D)>0)){var R=this.scm;var Q=(K&&R[K])||R[F];if(Q&&L!==""){O={h:"onGridSelector",a:{type:mstrmojo.EnumRWUnitType.GRID,anchor:P,ck:Q.ck,tks:Q.tks,eid:L,ctlKey:Q.ckey,sliceId:this.xtab.sid,isUConDS:Q.isUConDS,isDocVis:true}};}}return O;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.models._DropZoneCommon","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.util.ThresholdUtils","mstrmojo.models.datasets.DataInterface");var b=mstrmojo,c=b.array,O=b.hash,m=mstrmojo.func,P=mstrmojo.kpicard.KPI_PROPERTIES,d=mstrmojo.kpicard.DISPLAY_MODE,e=b.vi.viz.EnumDSSDropZones,k=mstrmojo.vi.ui.DatasetUnitMenuUtils,U=mstrmojo.VisUtility,Q=b.mstr.EnumDSSXMLObjectTypes,G=b.vi.models.DropZonesModel.ENUM_TARGET_POSITION,V=mstrmojo.vi.enums.EnumFeatures,B=e.BreakBy,E=e.Trend,Y=e.Metric,q=mstrmojo.kpicard.CARDLIMIT,X=mstrmojo.models.datasets.DataInterface,I=1,K=-1;mstrmojo.vi.models.KPICardDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{scriptClass:"mstrmojo.vi.models.KPICardDropZones",help:"editor_panel_kpi.htm",propertyChanged:false,getHostModel:function A(){return this.getHost().model.data;},getDropZones:function g(){var u=this.getDZFlatStruct(),t=function(v){return{allowSingle:true,title:v};},s=[this.getZone(mstrmojo.desc(517,"Metric"),Y,u.metric,false,t(mstrmojo.desc(13829,"Drag a metric here"))),this.getZone(mstrmojo.desc(12173,"Break By"),B,u.BreakBy,false,t(mstrmojo.desc(13833,"Drag an attribute here"))),this.getZone(mstrmojo.desc(15863,"Trend"),E,u.trend,false,t(mstrmojo.desc(13833,"Drag an attribute here")))];this.dropZones=s;return{n:this.getHost().defn.ttl,zones:s};},getAllowDropInfo:function C(x,w,AA,u,s){var z=this,t=this._super(x,w,AA,u,s),AB=x.items.length!==0&&u!==G.ON,v=AB?null:c.filterOne(t.allowedItems,function(AD){var AC=z.isMetric(AD);return Y===x.id?AC:(!AC&&AD.t!==Q.Dimension);});return O.copy({allowedItems:v?[v]:[]},t);},unitsDropped:function n(AD,s,AF){var w=s.actions||[],u=[],AA,z=s.src.data,AH=AF.idx,t=AF.edge,x=AF.allowedItems,AG,AE=this,v,AB=AE.getHost().getFormatPropertyValue(P.DISPLAY_MODE),AC=AD.id===B;if(t===G.ON&&AF.removeReplaced){u=u.concat(this.getRemoveDropZoneUnitActions(AD,AD.items[AH]));}u=u.concat(this.getAddDropZoneUnitsActions(AD,x,this.getDropTargetIndex(AD,AF),{datasetId:z.dsid}));AA=w.concat(AE.getUpdateTemplateAction(u));AG=function(AI){return function(){var AJ=AI?AE.docModel.wrapUnsetVisualizationFilterAction(AA):AA;AE.submitDropZoneUpdates(AJ,m.wrapMethods(s.callback,AE.getHost().model.docModel.controller._getXtabCallback(AE.getHost())),undefined,AC);};};if(AD.id===B&&AB===d.STACKED){v=q;}else{v=undefined;}this.checkAndWarnLargeItemsForAddUnits(x,function(){AE.docModel.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:AA,zm:AE},AG(true),AG(false));},undefined,undefined,undefined,undefined,v);},checkBreakByLimit:function(u,t){var s=this;this.checkAndWarnLargeItemsForAddUnits(s.dropZones[1].items,u,undefined,undefined,undefined,true,q,t);},getAddItemActions:function o(AA,z,AC,x,t,w){var v=[],AB=this,u={datasetId:w},s=function(AD,AF,AE){c.insert(v,null,AB.getAddDropZoneUnitsActions(AD,[AF],0,AE));};s(AA,z[0],u);return v;},clearGridModeSettings:function p(t){if(t.id===E){return ;}var u=this.getHost(),s=u.getFormatPropertyValue(P.DISPLAY_MODE);if(u&&s&&s===d.GRID){u.updateProperties(P.GRID_COLUMN_COUNT);u.updateProperties(P.FIX_CARD_HEIGHT);u.updateProperties(P.CARD_HEIGHT);this.propertyChanged=true;}},getAddDropZoneUnitsActions:function r(t,u,s,v){this.clearGridModeSettings(t);return this._super(t,u,s,v);},getRemoveDropZoneUnitActions:function D(s,u){var v=this._super(s,u),t=this.getHost();if(s.id===E){t.updateProperties(P.PREVIOUS_METRIC_NAME);this.propertyChanged=true;}this.clearGridModeSettings(s);return v;},deleteItem:function F(u,s){var w=this,v=w.docModel,x=this.getRemoveDropZoneUnitActions(u,u.items[s]),t=x.length?[this.getUpdateTemplateAction(x)]:[];v&&v.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[u.id],zm:w},function(){w.submitDropZoneUpdates(t.concat(v.wrapUnsetVisualizationFilterAction()));},function(){w.submitDropZoneUpdates(t);});},submitDropZoneUpdates:function h(t,z,s,w){var AB=this.getHost(),AA=this.docModel,u=AB.model,v=u.xtab.k,x=AB.getSortRows();if(this.propertyChanged){t=t.concat(AB.getSetPropertiesAction());this.propertyChanged=false;}if(x&&x.length>0&&w){t=t.concat(AA.getDataService().getUpdateTemplateAction(v,{act:"clearSort"}));}this._super(t,z,s);},generateSortKeyByItem:function J(u,x){var z=this.handleSortItem(u),w=z.t,v=z.did,s=this.getUnitInfoInTemplate(v),t=x||(s.unit.fid||(s.unit.fs&&s.unit.fs[0].id));return this.generateSortKey(w,v,t);},generateSortKey:function S(u,t,s){return[u,t,s,"21"].join("!");},handleSortItem:function W(u){var t=this.getHost(),v=t.model.data,s=v.gts,w=O.copy(u);if(u.t===Q.DssTypeDimension){c.forEach((s.row||[]).concat(s.col||[]),function(x){if(x.hid===w.did){w.did=x.id;w.t=x.otp;return false;}});}return w;},getAppliedSortInfo:function R(u,s){var w=this.resolveDropZoneItem(u),t=null,v=this,AA,z,x;if(!w){return t;}AA=this.handleSortItem(w);z=AA.t;x=AA.did;c.forEach(s,function(AD){var AB=AD&&AD.key,AC;if(AB){AC=AB.split("!");if(AC[0]===z.toString()&&AC[1]===x){t={key:v.generateSortKey(z,x,AC[2]),isAsc:AD.isAsc};}}});return t;},generateSortInfo:function M(t,u,s){return{key:this.generateSortKeyByItem(t,u),isAsc:s};},resolveDropZoneItem:function N(t){var u=this.getZoneModelByZoneId(t),s=u&&u.items;return s&&s[0];},handleKPISort:function H(v,w){var AA=this.getHost(),x=AA.getSortRows(),AB,u,s,z=[],t=[];if(v.sortIdx===0){z.push(this.generateSortInfo(v,null,w));s=this.getAppliedSortInfo(E,x);if(s){z.push(s);}}else{if(v.sortIdx===1){AB=this.getAppliedSortInfo(B,x);if(AB){z.push(AB);}else{u=this.resolveDropZoneItem(B);if(u){z.push(this.generateSortInfo(u,null,true));}}z.push(this.generateSortInfo(v,v.sortForm,w));}}t.push(z);t.push(null);this.docModel.controller.onAdvancedSort(AA,t,null,null);},getTrendSortSubMenu:function j(u,z){var x=this,AC=u.item,w=this.handleSortItem(AC),v,s=[],AB=[];v=X.getFormsByAttrId(AC.attId||AC.did,this.docModel.datasets);c.forEach(v||[],function(AD){var AE=AD.fid;if(c.find(s,"id",AE)<0){s.push({id:AE,n:AD.fnm,sortItem:w,isAsc:z});}});AB.push({scriptClass:"mstrmojo.ui.ScrollableContainer",alias:"scrollableContainer",children:[{scriptClass:"mstrmojo.vi.ui.InteractiveUnitList",draggable:false,CLS_HAS_MENU:"",items:s,listHooks:{select:function AA(AD,AE){var AF=AE.sortItem;if(AF){AF.sortIdx=1;AF.sortForm=AE.id;x.handleKPISort(AF,AE.isAsc);}if(this.parent&&this.parent.parent&&this.parent.parent.closeAllMenus){this.parent.parent.closeAllMenus();}}}}]});return new mstrmojo.ui.menus.EditorConfig({data:{},cssClass:"replaceReference",okVisible:false,cancelVisible:false,contents:AB,onOpen:function t(){this.scrollableContainer.updateScrollbars();}});},getTrendSortAscendingSubMenu:function L(s){return this.getTrendSortSubMenu(s,true);},getTrendSortDescendingSubMenu:function Z(s){return this.getTrendSortSubMenu(s,false);},addTrendSortMenu:function l(s,v){var AA=this.getHost(),z=AA.getSortRows(),AB=s.item,t=s.axis,u=AA.model.data,x=u.gsi.tma,w=this;if(AB.t===Q.DssTypeFilter){return ;}if(t!==K||x!==I){v.addPopupMenuItem(mstrmojo.desc(7974,"Sort Ascending"),this.id,this.getTrendSortAscendingSubMenu,"",s);v.addPopupMenuItem(mstrmojo.desc(7975,"Sort Descending"),this.id,this.getTrendSortDescendingSubMenu,"",s);if(z&&z.length>0){v.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"",function(){w.submitDropZoneTemplateUpdates([{act:"clearSort"}]);});}}},addBreakBySortMenu:function a(s,v){var AB=this.getHost(),AA=AB.getSortRows(),AC=s.item,t=s.axis,u=AB.model.data,z=u.gsi.tma,x,w=this;if(AC.t===Q.DssTypeFilter){return ;}if(t!==K||z!==I){x=this.handleSortItem(AC);x.sortIdx=0;v.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",function(){w.handleKPISort(x,true);});v.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",function(){w.handleKPISort(x,false);});if(AA&&AA.length>0){v.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"",function(){w.submitDropZoneTemplateUpdates([{act:"clearSort"}]);});}}},getUnitMenuItems:function f(v,AF,AE,s){var AI=this,AK=this.id,t=this.isMetric(AE),AC=this.isAttribute(AE),AA=AF.items,AD=AA.length,w={zone:AF,idx:c.find(AA,"id",AE.id),cnt:AD,item:AE,useDropzone:true},x=(AE.t===47&&AE.st===12033),AB=this.docModel,AG=AE.did,z=k.getDatasetFromAttributeId(AB.datasets,AG),AJ=mstrApp.isInVFConfigMode,u=mstrmojo.resolveFeature(V.INSERT_NEW_METRIC);if(x&&!AJ){v.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"eg",this.getCreateOrEditElementGroupFunc(w));v.addSeparator();}if(AF.id===B){this.addBreakBySortMenu(w,v);v.addSeparator();}if(AF.id===E){this.addTrendSortMenu(w,v);v.addSeparator();}if(t&&!AJ){if(AE.um){v.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){AI.editDerivedMetric(w,"edit");},w);v.addSeparator();}if(u){if(AB.findDatasetIdFromUnit(AG)&&!AB.isFromSolrCube(AG)&&!AB.isFromMDXCube(AG)){v.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",AK,AI.getAggregateByMetricSubMenu,w);v.addSeparator();}v.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),AK,AI.getCalculationEditorCfg,w);v.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){AI.newDerivedMetric(w);},w);}}else{if(AC&&!AJ){var AH=this.isDynamicLink(AE);if(!z||!AB.isMDXDataset(z)){if(AE.da){v.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){AI.editDerivedAttribute(w);},w);v.addSeparator();}if(AC&&(AE.de!==true)&&!U.isCGorCon(this.getHost(),AE)&&!this.isDynamicLink(AE)&&u){v.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){AI.newDerivedAttribute(w,!AI.allowInsertNewAttribute(AF));},w);}}if(!k.hasOldDEOverDatasets(AG,AB.datasets)&&!this.isRecursiveAttribute(AE)&&!AH){v.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"eg",this.getCreateOrEditElementGroupFunc(w));}}}v.addSeparator();if(this.showNumberFormat(AE)){v.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),AK,this.getNumberFormatEditorCfg,w);}if(this.shouldShowDisplayFormsMenu(AE)){v.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return AI.getDisplayFormsMenu(AE);});}v.addSeparator();if(AI.hasReplaceCandidates(w)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(V.WEB_DRILL_AND_LINK))){v.addSubMenuItem(mstrmojo.desc(14003,"Replace With"),"",AK,AI.getReplaceSubMenu,w);}v.addMenuItem(mstrmojo.desc(1388,"Rename"),"",function(){AI.renameItem(s,AE);});v.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){AI.deleteItem(AF,AI.getUnitIndexInZone(AF,AE));});}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.DropZonesModel","mstrmojo.array","mstrmojo.hash","mstrmojo.vi.models._DropZoneCommon","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLBaseFormType");mstrmojo.requiresDescs(190,1388,3224,5188,11806,12287,13295,13296,13624,13625,14003,14655,14656,14717);var H=mstrmojo.array,C=mstrmojo.hash,E=mstrmojo.vi.ui.DatasetUnitMenuUtils,I="-1",D=mstrmojo.mstr.EnumDSSXMLBaseFormType,J=mstrmojo.vi.enums.EnumFeatures,F=mstrmojo.mstr.EnumDSSXMLObjectTypes;mstrmojo.vi.models.TemplateBasedDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{getClearAllUnitsActions:function G(){var L=[],K=this.getHost().model;this.getDropZones().zones.forEach(function(M){var N=M.id;M.items.forEach(function(P,O){if(P.did!==I){L.push(K.getRemoveTemplateUnitAction(C.copy(P,{axis:N,unitPos:O+1})));}});});return L;},getMultiUnitsMenuItems:function B(L,K,M){var N=this.id;if(!mstrApp.isInVFConfigMode&&E.getMultiSelectionShortcutMetricFunctions(M).length&&mstrmojo.resolveFeature(J.INSERT_NEW_METRIC)){L.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",this.id,function(){return mstrmojo.all[N].getMultipleMetricsCalcMenus(K,M,false);});L.addSeparator();}L.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[N].deleteItems(K,M);});},getExtraUnitMenuItems:function A(L,K,N,M){},getUnitMenuItems:function A(O,a,Y,Z){if(!Y){throw new Error(this.scriptClass+"::getUnitMenuItems: Item must be provided.");}var U=a.items,K=this.getHost(),X=U.length,M=a.id,P={zone:a,axis:M,idx:H.indexOf(U,Y),cnt:X,item:Y,metricsAxis:(this.getHost().gridInfo||{}).tma,useDropzone:false},d=this,V=this.id,L=Y.did===I,Q=(Y.t===F.Consolidation&&Y.st===12033),e=mstrApp.isInVFConfigMode,N=mstrmojo.resolveFeature(J.INSERT_NEW_METRIC),W=this.docModel,b=Y.did;if(Q&&!e){O.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"eg",function(){var f={otp:Y.t,id:b,n:Y.n,axis:a.id,ui:P.idx};K.derivedElementsEdit(f);});O.addSeparator();}if(!L){if(K.model.isRecursiveAttribute(Y.did)){O.addMenuItem(mstrmojo.desc(14655,"Expand All Levels"),"",function(){var f={id:Y.did};K.raExpandAll(f,true);});O.addMenuItem(mstrmojo.desc(14656,"Collapse All Levels"),"",function(){var f={id:Y.did};K.raExpandAll(f,false);});O.addSeparator();}this.addSortMenu(P,O,true);O.addSeparator();if(Y.t===F.Metric&&!e){if(Y.um){O.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){d.editDerivedMetric(P);},P);O.addSeparator();}if(N){if(W.findDatasetIdFromUnit(b)&&!W.isFromSolrCube(b)&&!W.isFromMDXCube(b)){O.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",V,d.getAggregateByMetricSubMenu,P);O.addSeparator();}O.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),V,d.getCalculationEditorCfg,P);O.addSubMenuItem(mstrmojo.desc(12287,"Shortcut Metric"),"",V,d.getShortcutMetricSubMenu,P);O.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){d.newDerivedMetric(P);},P);}}if(Y.t===F.Attribute){var S=Y.did||"",R=S?E.getDatasetFromAttributeId(this.docModel.datasets,S):null,c=this.isDynamicLink(Y);if((!R||!this.docModel.isMDXDataset(R))&&!e){if(Y.da){O.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){d.editDerivedAttribute(P);},P);O.addSeparator();}if(((!R)||!E.isCGorCon(Y,R))&&!c&&N){O.addMenuItem(mstrmojo.desc(13625,"New Attribute..."),"",function(){d.newDerivedAttribute(P);},P);O.addMenuItem(mstrmojo.desc(14717,"Create Links..."),"",function(){d.newDynamicLinkAttr(P);},P);}}if(!e&&!E.hasOldDEOverDatasets(Y.did,this.docModel.datasets)&&!c&&Y.st!==3076){O.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"eg",function(){var f={otp:Y.t,id:Y.did,n:Y.n,axis:a.id,ui:P.idx};K.derivedElementsEdit(f);});}}this.getExtraUnitMenuItems(O,a,Y,P);O.addSeparator();if(d.hasReplaceCandidates(P)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(J.WEB_DRILL_AND_LINK))){O.addSubMenuItem(mstrmojo.desc(14003,"Replace With"),"",V,d.getReplaceSubMenu,P);}O.addMenuItem(mstrmojo.desc(1388,"Rename"),V,function(){mstrmojo.all[V].renameItem(Z,Y);});O.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[V].deleteItem(a,P.idx);});}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.func","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.models._DropZoneCommon");var O=mstrmojo.array,Y=mstrmojo.func,I=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,d=mstrmojo.vi.models.EnumDragSources,J=mstrmojo.vi.ui.DatasetUnitMenuUtils,D=mstrmojo.vi.viz.EnumDSSDropZones,B=D.GeoAttribute,L=D.SizeBy,U=D.ColorBy,K=D.Layout,b=D.AdditionalMetrics,A=mstrmojo.vi.util.ThresholdUtils,H=mstrmojo.vi.enums.EnumFeatures,E=["#65D22B","#FFC561","#FF9547","#FF5824","#CC1D1D"],R=[0.2,0.4,0.6,0.8],C=mstrmojo.VisEnum.IMAGELAYOUT_PROPERTIES;var P="0",c="1",G="2";mstrmojo.vi.models.ImageLayoutDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{getHostModel:function M(){return this.getHost().model.data;},getDisplayMode:function Q(){var e=this.getHost().propertyManager;return e.getFormatPropertyValue(C.DISPLAY_MODE);},isZoneAvalaible:function X(e){if(e===L){return this.getDisplayMode()!==c;}return true;},getDropZones:function V(){var g=this.getDZFlatStruct(),f={allowSingle:true},e=[this.getZone(mstrmojo.desc(11661,"Geo Attribute"),B,g.GeoAttribute||g.Geo,false,f),this.getZone(mstrmojo.desc(11662,"Color By"),U,g.ColorBy,false,f),this.getZone(mstrmojo.desc(11663,"Size By"),L,g.SizeBy,this.getDisplayMode()===c,f),this.getZone(mstrmojo.desc(2962,"Tooltip"),b,g.AdditionalMetrics),this.getZone(mstrmojo.desc(14473,"Path To Map"),K,g.Layout||g.layout,false,f)];this.dropZones=e;return{n:this.getHost().defn.ttl,zones:e};},getUnitMenuItems:function a(j,m,s,p){var o=this,h=this.id,t=this.isMetric(s),l=m.items,f=l.length,e={zone:m,idx:O.find(l,"id",s.id),cnt:f,item:s,useDropzone:true},k=mstrApp.isInVFConfigMode,q=s.did,r=this.docModel,g=J.getDatasetFromAttributeId(r.datasets,q),n=mstrmojo.resolveFeature(H.INSERT_NEW_METRIC);if(t&&!k){if(s.um){j.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){o.editDerivedMetric(e,"edit");},e);j.addSeparator();}if(n){if(r.findDatasetIdFromUnit(q)&&!r.isFromSolrCube(q)&&!r.isFromMDXCube(q)){j.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",h,o.getAggregateByMetricSubMenu,e);j.addSeparator();}j.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),h,o.getCalculationEditorCfg,e);j.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){o.newDerivedMetric(e);},e);}}else{if((!g||!r.isMDXDataset(g))&&!k){if(s.da){j.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){o.editDerivedAttribute(e);},e);j.addSeparator();}if(!this.isDynamicLink(s)&&n){j.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){o.newDerivedAttribute(e,!o.allowInsertNewAttribute(m));},e);}}}j.addSeparator();if(this.shouldShowDisplayFormsMenu(s)){j.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return o.getDisplayFormsMenu(s);});}if(this.showNumberFormat(s)){j.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),h,this.getNumberFormatEditorCfg,e);}if(t){if(m.id===U){this.buildThresholdMenuOptions(j,e,true);}}j.addSeparator();j.addMenuItem(mstrmojo.desc(1388,"Rename"),"",function(){o.renameItem(p,s);});j.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){o.deleteItem(m,o.getUnitIndexInZone(m,s));});},getAllowDropInfo:function N(o,k,s,h,f){var q=this,g=this._super(o,k,s,h,f),n=g.allowedItems,l=f.src.data,e=l.src===d.VIZ_EDITOR?l.srcZoneId:null,t=h===I.ON,m=true,p=true,j=this.getZoneModelByZoneId(U).items,r=this.getZoneModelByZoneId(L).items;switch(o.id){case B:case K:m=false;break;case b:p=false;break;}return mstrmojo.hash.copy({allowedItems:(p&&!(o.items.length===0||t))?[]:O.filter(n,function(v){var u=q.isMetric(v);return m?u:!u;},p?{max:1}:null),removeReplaced:t&&(p||O.find(k,"did",o.items[s].did)===-1)},g);},getAddDropZoneUnitsActions:function F(f,g,e,h){var k=f.id,j;j=this._super(f,g,e,h);if(k===U){this.checkAndAddThresholdAction(U,g[0],j);}return j;},unitsDropped:function Z(o,e,q){var l=e.src.data,h=e.actions||[],j=[],s=q.idx,f=q.edge,k=q.allowedItems,n=o.id,p=this,m,g,r=function(u){var v=p.getZoneModelByZoneId(u),t=O.intersection(v.items,k,"did");t.forEach(function(w){j=j.concat(p.getRemoveDropZoneUnitActions(v,w,1));});};switch(n){case L:r(b);break;case U:r(b);break;case b:r(L);r(U);break;}if(f===I.ON&&q.removeReplaced){j=j.concat(this.getRemoveDropZoneUnitActions(o,o.items[s]));}O.insert(j,null,this.getAddDropZoneUnitsActions(o,k,this.getDropTargetIndex(o,q),{datasetId:l.dsid}));m=h.concat(this.getUpdateTemplateAction(j));g=function(t){return function(){var u=t?p.docModel.wrapUnsetVisualizationFilterAction(m):m;p.submitDropZoneUpdates(u,Y.wrapMethods(e.callback,p.getHost().model.docModel.controller._getXtabCallback(p.getHost())));};};p.docModel.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:m,zm:p},g(true),g(false));},checkAndAddThresholdAction:function W(h,f,g){var e=this.getHost();if(h===U&&this.isMetric(f)){A.addThresholds(e.model,e,e.node,f,g,E,R,false);return true;}return false;},deleteItem:function S(f,e){var h=this,g=h.docModel;g&&g.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[f.id],zm:h},function(){var j=h.getRemoveDropZoneUnitActions(f,f.items[e]);j=g.wrapUnsetVisualizationFilterAction((j&&j.length>0)?h.getUpdateTemplateAction(j):[]);h.submitDropZoneUpdates(j);},function(){h.submitDropZoneTemplateUpdates(h.getRemoveDropZoneUnitActions(f,f.items[e]));});}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.models.datasets.DataInterface","mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.viz.MapHelper","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.gmaps.EnumActions","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums");mstrmojo.requiresClsP("mstrmojo.vi.models","_DropZoneCommon");mstrmojo.requiresClsP("mstrmojo.vi.util","TemplateUtils","ThresholdUtils");var m=mstrmojo,n=m.array,U=m.hash,p=m.vi.viz.EnumDSSDropZones,AE=m.vi.viz.MapHelper,H=m.chart.model.enums.EnumDSSObjectType,v=m.vi.ui.DatasetUnitMenuUtils,V=m.vi.util,M=V.ThresholdUtils,b=V.TemplateUtils,Z=m.vi.models.DropZonesModel.ENUM_TARGET_POSITION,O=m.gmaps,C=O.MapUtils,J=O.EnumPropertyType,x=O.EnumGraphicType,Y=O.EnumActions,j=mstrmojo.vi.enums.EnumFeatures,F=O.EnumBaseMapType,AF=mstrmojo.gmaps.EnumLayerZoneSource;var AD=true;function S(AJ,AI){return(!!AI)&&AJ.did===AI.did;}mstrmojo.vi.models.MapDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{help:"editor_panel_map.htm",dirtyVP:false,getHost:function l(AJ){var AI=this._super();if(!!AI){return(AJ!==true)?AI.getEditingHost():AI;}},getRequiredItemsInfo:function s(AJ){if(!AJ){return 0;}var AI=[];this.getDropZones(true).zones.forEach(function(AK){if(AK){AI=AI.concat(AK.items);}});return Number(AI.reduce(function(AK,AL){if(parseInt(AL.did,10)!==-1&&AL.t===AJ){return AK+1;}return AK;},0));},getDropZones:function t(AI,AP){var AQ=[],AO=this,AL=function(AS){switch(AS){case p.GeoAttribute:return mstrmojo.desc(13830);case p.Latitude:return mstrmojo.desc(13831);case p.Longitude:return mstrmojo.desc(13832);case p.SliceBy:return mstrmojo.desc(13833);case p.Angle:case p.SizeBy:return mstrmojo.desc(13829);case p.ColorBy:if(AO.isMapBox()){return mstrmojo.desc(11668);}return mstrmojo.desc(13829);case p.AdditionalMetrics:return mstrmojo.desc(11668);}return"";},AR=this.getHost(true),AM,AK,AJ,AN;if(!AP&&AR){AP=AR.getEditingGridKey();}if(!C.checkDefined(AP)){return{zones:AQ};}AK=AR.getProperties(AP);if(!AI&&!mstrApp.isInVFConfigMode){AJ=AR.getLayerZoneControl(AF.DROP_ZONE);if(AJ){AJ.n="Layers";AQ.push(AJ);}}AM=AR.getBaseMapType()===F.Image;AN=this.isMapBoxArea();U.forEach(this.getZonesCfg(),function(AT){if(AT.show(AK)){var AS=AT.n;if(AM){if(AT.id===p.Latitude){AS="Y";}else{if(AT.id===p.Longitude){AS="X";}}}AQ.push(AO.getZone(AS,AT.id,AR.getDropZoneItems(AT.id,AP),false,{allowSingle:AT.id===p.GeoAttribute&&AN?false:AT.allowSingle,title:AL(AT.id)}));}});if(!AI){this.dropZones=AQ;}return{n:AR.node.defn.ttl,zones:AQ};},getZonesCfg:function AC(){return mstrmojo.vi.viz.MapHelper.zonesCfg;},getAllZones:function(AI){return this.getDropZones(true,AI).zones||[];},getClearAllUnitsActions:function P(AI){var AJ=[];(this.getAllZones(AI)).forEach(function(AK){((AK&&AK.items)||[]).forEach(function(AL){Array.prototype.push.apply(AJ,this.getRemoveDropZoneUnitActions(AK,AL));},this);},this);return AJ;},getZone:function w(AP,AO,AN,AK,AL){if((AO===p.Latitude||AO===p.Longitude)&&AN[0]&&(AN[0].t===21)){var AJ=this.getHost(true).getEditingDropZoneItems(p.GeoAttribute),AI=AJ.length>0?AJ[0].id:null,AM=b.findUnitsById(this.getHostModel().gsi,AI)[0];if(AM){return this._super(AP,AO,[{did:AN[0].id,t:21,n:AM.n+"@"+((AO===p.Latitude)?mstrmojo.desc(7696,"Latitude"):mstrmojo.desc(7697,"Longitude"))}],AK,AL);}}return this._super(AP,AO,AN,AK,AL);},getUnitMenuItems:function r(AL,AU,AS,AT){if(!AS||!AU){return ;}var AO=AU.items,AR=AO.length,AI=AU.id,AM={zone:AU,idx:n.indexOf(AO,AS),cnt:AR,item:AS,useDropzone:true},AX=this,AP=this.id,AY=mstrApp.isInVFConfigMode,AJ=mstrmojo.resolveFeature(j.INSERT_NEW_METRIC),AQ=this.docModel,AW=AS.did,AN=v.getDatasetFromAttributeId(AQ.datasets,AW),AV=false;if(AS.t===H.DssTypeAttributeForm){return ;}if(AS.t===H.DssTypeMetric&&!AY){if(AS.um){AL.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){AX.editDerivedMetric(AM,"edit");},AM);AL.addSeparator();}if(AJ){if(AQ.findDatasetIdFromUnit(AW)&&!AQ.isFromSolrCube(AW)&&!AQ.isFromMDXCube(AW)){AL.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",AP,AX.getAggregateByMetricSubMenu,AM);AL.addSeparator();}AL.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),AP,AX.getCalculationEditorCfg,AM);AL.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){AX.newDerivedMetric(AM);},AM);}}else{if((!AN||!AQ.isMDXDataset(AN))&&!AY){if(AS.da){AL.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){AX.editDerivedAttribute(AM);},AM);AL.addSeparator();}if(AS.t===12){if(this.allowInsertNewAttribute(AU)&&!this.isDynamicLink(AS)&&AJ){AL.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){AX.newDerivedAttribute(AM);},AM);}}}if((AU.id===p.GeoAttribute||AU.id===p.SliceBy||AU.id===p.AdditionalMetrics)&&this.shouldShowDisplayFormsMenu(AS)){var Aa=this.getZoneModelByZoneId(p.GeoAttribute)||{},AK=this.getZoneModelByZoneId(p.Latitude)||{},AZ=this.getZoneModelByZoneId(p.Longitude)||{};if(this.isPolygonMap()||(n.find((Aa.items||[]).concat(AK.items||[]).concat(AZ.items),"did",AS.did)<0)){AL.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),AP,function(){return AX.getDisplayFormsMenu(AS);});}}}AL.addSeparator();if(this.showNumberFormat(AS)&&AI!==p.GeoAttribute&&AI!==p.Latitude&&AI!==p.Longitude){AL.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),AP,this.getNumberFormatEditorCfg,AM);AV=true;}if(AS.t===H.DssTypeMetric&&AI===p.ColorBy){this.buildThresholdMenuOptions(AL,AM,true);AV=true;}if(AV){AL.addSeparator();}if(AX.hasReplaceCandidates(AM)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(j.WEB_DRILL_AND_LINK))){AL.addSubMenuItem(mstrmojo.desc(14003,"Replace With"),"",AP,AX.getReplaceSubMenu,AM);}AL.addMenuItem(mstrmojo.desc(1388,"Rename"),AP,function(){mstrmojo.all[AP].renameItem(AT,AS);});AL.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[AP].deleteItem(AU,AM.idx);});},isPolygonMap:function o(){var AI=this.getEditingVp();return !!AI&&(AI[J.graphicType]===x.Area);},buildThresholdMenuOptions:function e(AJ,AK,AI){var AL=this.getHost();AL.model.buildThresholdMenuOptions(AJ,AK,AI,this.canSupportImageThreshold());},showNumberFormat:function N(AI){var AJ=this.getHost();return AJ.model.showNumberFormat(AI);},getNumberFormatEditorCfg:function k(AI){var AJ=this.getHost();return AJ.model.getNumberFormatEditorCfg(AI);},getAllowDropInfo:function B(AT,AN,AW,AL,AJ){var AK=this._super(AT,AN,AW,AL,AJ),AQ=AK.allowedItems,AX=AL===Z.ON,AI={max:1},AM=this.isMapBoxArea(),AP,AO,AR,AU=this,AS=function(AY,AZ){return n.filter(AQ,function(Aa){return AZ?(Aa.t!==AY):(Aa.t===AY);},AI);},AV=function(Ac){var Ab,Aa,AY,AZ;switch(Ac){case p.AdditionalMetrics:Ab=AU.getZoneModelByZoneId(p.SliceBy);Aa=Ab&&Ab.items;AZ=AQ&&AQ[0];if(AZ&&AU.isAttribute(AZ)&&Aa&&Aa.length){AY=n.some(Aa,function(Ad){return AQ.length&&S(AZ,Ad);});if(!AY||Aa.length>1){AQ=AS(H.DssTypeAttribute,true);}}break;default:break;}};if(!AT){return AK;}switch(AT.id){case p.GeoAttribute:if(AM){AI={max:2};}AQ=AS(H.DssTypeAttribute);break;case p.Latitude:case p.Longitude:AQ=AS(H.DssTypeAttribute);break;case p.SliceBy:AI=null;AQ=AS(H.DssTypeAttribute);break;case p.Angle:case p.SizeBy:AQ=AS(H.DssTypeMetric);break;case p.ColorBy:if(this.isMapBox()){AQ=AS(H.DssTypeAttributeForm,true);}else{AQ=AS(H.DssTypeMetric);}break;case p.AdditionalMetrics:AI=null;AQ=AS(H.DssTypeAttributeForm,true);break;}if(AD){AV(AT.id);}AO=AX&&AT.items&&AT.items[AW]&&n.find(AQ,"did",AT.items[AW].did)===-1;if(AM&&AT.id===p.GeoAttribute){if(!AQ||AQ.length<=0){AP=[];}else{AR=(AT.items&&AT.items.length)||0;if(AR>=2){if(AO){AP=[AQ[0]];}else{AP=[];}}else{if(AR===1){if(AX){AP=AQ;}else{AP=n.filter(AQ,function(AY){return AY.did!==AT.items[0].did;},{max:1});}}else{AP=AQ;}}}}else{AP=(AI&&AT.items&&!(AT.items.length<AI.max||AX))?[]:AQ;}return U.copy({allowedItems:AP,removeReplaced:AO},AK);},getDropActions:function f(AV,AO,AK){if(!AV||!AO){return[];}var AS=AO.allowedItems,AR=AO.idx,AW=AS[0],AI=AV.id,AP=[],AX=function(Ad){var Ae=null;n.forEach(Ad.fs||[],function(Af){if(AE.isLatitude(Af.fnm,Af.fgr)&&Af.obf){Ae=Af;return false;}});return Ae;},AJ=function(Ad){var Ae=null;n.forEach(Ad.fs||[],function(Af){if(AE.isLongitude(Af.fnm,Af.fgr)&&Af.obf){Ae=Af;return false;}});return Ae;};if(!AI){return AP;}AP=AP.concat(this.getCreateDropZonesAction(AI));if(this.hasLatLngZone()&&AI===p.GeoAttribute){var AM=AX(AW),Ab=AJ(AW);if(!AM||!Ab){if(AM&&AE.isLatitude(AW.n)){AI=p.Latitude;AV=this.getZoneModelByZoneId(AI);}else{if(Ab&&AE.isLongitude(AW.n)){AI=p.Longitude;AV=this.getZoneModelByZoneId(AI);}}}}if(!AV){return AP;}if(AO.edge===Z.ON&&AO.removeReplaced){var AN=this.getRemoveDropZoneUnitActions(AV,AV.items[AR]);if(AN){AP=AP.concat(AN);if((AI===p.Latitude||AI===p.Longitude)&&AV.items[0].t===21){var AL=this.getZoneModelByZoneId(p.GeoAttribute),Ac=AL&&AL.items;if(Ac&&Ac[0]){AP=AP.concat(this.getRemoveDropZoneUnitActions(AL,Ac[0]));}AL=this.getZoneModelByZoneId(AV.id===p.Latitude?p.Longitude:p.Latitude);Ac=AL&&AL.items;if(Ac&&Ac[0]&&Ac[0].t===21){AP=AP.concat(this.getRemoveDropZoneUnitActions(AL,Ac[0]));}}}}var AZ=this.getDropTargetIndex(AV,AO);n.insert(AP,null,this.getAddDropZoneUnitsActions(AV,AS,AZ,{datasetId:AK}));this.checkExistingUnitsToRemove(AI,AS,AP);this.checkAndAddThresholdAction(AI,AW,AP);if(this.isMapBox()){AP=this.checkAndAddToTooltipZone(AI,AS,AP,{datasetId:AK});}var Aa=function(Ad){AP.push({act:"addForm",unitId:AW.did,attFormId:Ad.fid,unitPos:1});};if(AI===p.GeoAttribute){this.addClearZoneAction(AP,p.Latitude);this.addClearZoneAction(AP,p.Longitude);var AU=AX(AW),AQ=this.getZoneModelByZoneId(p.Latitude),AY=AJ(AW),AT=this.getZoneModelByZoneId(p.Longitude);if(AU){Aa(AU);if(AQ){AP=AP.concat(this.getAddDropZoneUnitsActions({id:p.Latitude},[{did:AU.fid,t:21}],0,{datasetId:AK}));}}if(AY){Aa(AY);if(AT){AP=AP.concat(this.getAddDropZoneUnitsActions({id:p.Longitude},[{did:AY.fid,t:21}],0,{datasetId:AK}));}}}else{if(AI===p.Latitude||AI===p.Longitude){this.addClearZoneAction(AP,p.GeoAttribute);}}return AP.length?this.getUpdateTemplateAction(AP):[];},addClearZoneAction:function W(AK,AI){var AJ=this.getZoneModelByZoneId(AI);if(AJ&&AJ.items&&AJ.items.length){Array.prototype.push.apply(AK,this.getRemoveDropZoneUnitActions(AJ,AJ.items[0]));}},unitsDropped:function AB(AN,AI,AP){var AL=AI.src.data,AJ=AI.actions||[],AK=AP.allowedItems,AO=this,AR=AO.docModel,AS=AO.getHost(),AM,AQ=AS&&AS.getData();this.addAttributeNameAndTargetVisForAddUnits(AQ,AK);this.checkAndWarnLargeItemsForAddUnits(AK,function(){AM=AJ.concat(AO.getDropActions(AN,AP,AL.dsid));AR.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:AM,zm:AO},function(){var AT=AR.wrapUnsetVisualizationFilterAction(AM);AO.submitDropZoneUpdates(AT,AI.callback);},function(){AO.submitDropZoneUpdates(AM,AI.callback);});});},checkAndAddThresholdAction:function AA(AN,AL,AM){var AK=this.getHost(),AJ=["#abcffa","#7ca8de","#4570af","#224b8f","#0e3270"],AI=[0.2,0.4,0.6,0.8];if(this.isMetric(AL)&&AN===p.ColorBy){M.addThresholds(AK.model,AK,AK.model,AL,AM,AJ,AI);return true;}return false;},checkExistingUnitsToRemove:function Q(AK,AW,AR){var AP=this.getZoneModelByZoneId(p.GeoAttribute),AX=this.getZoneModelByZoneId(p.Latitude),AO=this.getZoneModelByZoneId(p.Longitude),AI=this.getZoneModelByZoneId(p.Angle),AU=this.getZoneModelByZoneId(p.ColorBy),AN=this.getZoneModelByZoneId(p.SizeBy),AY=this.getZoneModelByZoneId(p.SliceBy),Ah=this.getZoneModelByZoneId(p.AdditionalMetrics),AV=AP&&AP.items.length&&AP.items,Ak=AX&&AX.items.length&&AX.items[0],Ac=AO&&AO.items.length&&AO.items[0],AT=AI&&AI.items.length&&AI.items[0],Ag=AU&&AU.items.length&&AU.items[0],Aa=AN&&AN.items.length&&AN.items[0],Ae=AY&&AY.items.length&&AY.items,AS=this.isMapBox()?[]:(Ah&&Ah.items.length&&Ah.items),Ai=this,AJ=function(Am,Al){Array.prototype.push.apply(AR,Ai.getRemoveDropZoneUnitActions(Am,Al));},Af,AL,AM,Aj,Ab,AQ,AZ,Ad;switch(AK){case p.AdditionalMetrics:if(!this.isMapBox()){for(Ab=0,AQ=AW.length;Ab<AQ;Ab++){Af=AW[Ab];if(this.isMetric(Af)){if(Ag&&S(Af,Ag)){AJ(AU,Ag);}if(Aa&&S(Af,Aa)){AJ(AN,Aa);}if(AT&&S(Af,AT)){AJ(AI,AT);}}else{if(Ae){for(AZ=0,Ad=Ae.length;AZ<Ad;AZ++){AM=Ae[AZ];if(AM&&S(Af,AM)){AJ(AY,AM);}}}if(AV){for(AZ=0,Ad=AV.length;AZ<Ad;AZ++){Aj=AV[AZ];if(Aj&&S(Af,Aj)){AJ(AP,Aj);this.addClearZoneAction(AR,p.Latitude);this.addClearZoneAction(AR,p.Longitude);}}}if(Ak&&S(Af,Ak)){AJ(AX,Ak);}if(Ac&&S(Af,Ac)){AJ(AO,Ac);}}}}break;case p.ColorBy:case p.SizeBy:case p.Angle:Af=AW[0];if(this.isMetric(Af)&&AS){for(Ab=0;Ab<AS.length;Ab++){AL=AS[Ab];if(S(Af,AL)){AJ(Ah,AL);}}}break;case p.SliceBy:for(Ab=0,AQ=AW.length;Ab<AQ;Ab++){Af=AW[Ab];if(this.isMetric(Af)){continue;}if(AS){for(AZ=0,Ad=AS.length;AZ<Ad;AZ++){AL=AS[AZ];if(!this.isMetric(AL)&&(AD||S(Af,AL))){AJ(Ah,AL);}}}if(AV){for(AZ=0,Ad=AV.length;AZ<Ad;AZ++){Aj=AV[AZ];if(Aj&&S(Af,Aj)){AJ(AP,Aj);this.addClearZoneAction(AR,p.Latitude);this.addClearZoneAction(AR,p.Longitude);}}}if(Ak&&S(Af,Ak)){AJ(AX,Ak);}if(Ac&&S(Af,Ac)){AJ(AO,Ac);}}break;case p.GeoAttribute:for(Ab=0,AQ=AW.length;Ab<AQ;Ab++){Af=AW[Ab];if(!this.isMetric(Af)){if(AS){for(Ab=0;Ab<AS.length;Ab++){AL=AS[Ab];if(S(Af,AL)){AJ(Ah,AL);}}}if(Ae){for(AZ=0,Ad=Ae.length;AZ<Ad;AZ++){AM=Ae[AZ];if(AM&&S(Af,AM)){AJ(AY,AM);}}}if(Ak&&S(Af,Ak)){AJ(AX,Ak);}if(Ac&&S(Af,Ac)){AJ(AO,Ac);}}}break;case p.Latitude:Af=AW[0];if(!this.isMetric(Af)){if(AS){for(Ab=0;Ab<AS.length;Ab++){AL=AS[Ab];if(S(Af,AL)){AJ(Ah,AL);}}}if(Ae){for(AZ=0,Ad=Ae.length;AZ<Ad;AZ++){AM=Ae[AZ];if(AM&&S(Af,AM)){AJ(AY,AM);}}}if(Ac&&S(Af,Ac)){AJ(AO,Ac);}}break;case p.Longitude:Af=AW[0];if(!this.isMetric(Af)){if(AS){for(Ab=0;Ab<AS.length;Ab++){AL=AS[Ab];if(S(Af,AL)){AJ(Ah,AL);}}}if(Ae){for(AZ=0,Ad=Ae.length;AZ<Ad;AZ++){AM=Ae[AZ];if(AM&&S(Af,AM)){AJ(AY,AM);}}}if(Ak&&S(Af,Ak)){AJ(AX,Ak);}}break;default:break;}},checkAndAddToTooltipZone:function A(AM,AK,AN,AI){var AJ=this.getZoneModelByZoneId(p.AdditionalMetrics),AL=n.map(n.ensureArray(AJ&&AJ.items),function(AO){return AO&&AO.did;});AK=n.filter(AK,function(AO){return AE.shouldSyncItemToTooltipZone(AO.did,AM,AL);});if(AK.length>0){AN=AN.concat(this.getAddDropZoneUnitsActions({id:p.AdditionalMetrics},AK,this.getItemCountInZone(p.AdditionalMetrics),AI));}return AN;},getAvatarIconClass:function d(){return"viMap";},getActionsForDeleteItem:function q(AL,AJ){var AO=this.getRemoveDropZoneUnitActions(AL,AL.items[AJ]);if(AL.id===p.GeoAttribute){var AK=this.getZoneModelByZoneId(p.Latitude),AN=AK&&AK.items&&AK.items[0],AI=this.getZoneModelByZoneId(p.Longitude),AM=AI&&AI.items&&AI.items[0];if(AN){AO=AO.concat(this.getRemoveDropZoneUnitActions({id:p.Latitude},AN));}if(AM){AO=AO.concat(this.getRemoveDropZoneUnitActions({id:p.Longitude},AM));}}return AO;},deleteItem:function I(AJ,AI){var AL=this,AK=AL.docModel;AK&&AK.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[AJ.id],zm:AL},function(){var AM=AL.getActionsForDeleteItem(AJ,AI);AL.submitDropZoneUpdates(AK.wrapUnsetVisualizationFilterAction((AM&&AM.length>0)?AL.getUpdateTemplateAction(AM):[]));},function(){AL.submitDropZoneTemplateUpdates(AL.getActionsForDeleteItem(AJ,AI));});},deleteItems:function I(AI,AJ){var AM=[],AN=this.id,AL=this,AK=AL.docModel;AJ.forEach(function(AP){var AO=mstrmojo.all[AN];if(AO){AM=AM.concat(AO.getRemoveDropZoneUnitActions(AI,AP));}});AK&&AK.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[AI.id],zm:AL},function(){AL.submitDropZoneTemplateUpdates(AK.wrapUnsetVisualizationFilterAction(AM||[]));},function(){AL.submitDropZoneTemplateUpdates(AM||[]);});},getEditingVp:function R(){var AI=this.getHostModel();if(AI){return AI.vp;}},hasLatLngZone:function c(){var AI=this.getEditingVp(),AJ=AI&&AI[J.graphicType];return !!AJ&&AJ!==x.Area;},isMapBox:function h(){var AI=this.getHost(true);return AI.scriptClass==="mstrmojo.mapbox.VisMapbox";},isMapBoxArea:function AH(){var AJ=this.getHost(true),AI=this.getEditingVp();return AJ.getBaseMapType()===F.Mapbox&&AI&&AI[J.graphicType]===x.Area;},getWidgetPropsAction:function L(){var AI=this.getHost(true),AJ;AI.modelData=this.getHostModel();AJ=AI.getSetPropertiesAction();delete AI.modelData;return AJ&&AJ[0];},getHostModel:function(){var AI=this.getHost(true);if(AI&&(AI.getEditingGridData instanceof Function)){return AI.getEditingGridData();}},getAddDropZoneUnitsActions:function AG(AJ,AK,AI,AL){var AN=[],AM=this;AK.reverse().forEach(function(AO){g.call(AM,AM.getHostModel().vp,{item:AO,idx:AI,zone:AJ},"onAdd");AN.push(AM.getAddDropZoneUnitAction(AJ,AO,AI,AL));});return AN;},getAddItemActions:function(AK,AL,AI,AM){var AJ=this.getAddDropZoneUnitsActions(AK,AL,AI,{datasetId:AM});this.checkAndAddThresholdAction(AK.id,AL[0],AJ);return AJ;},getRemoveDropZoneUnitActions:function E(AJ,AK){var AL=this._super(AJ,AK),AI=n.find(AJ.items,"did",AK.did);g.call(this,this.getHostModel().vp,{item:AK,idx:AI,zone:AJ},"onDel");return AL;},submitDropZoneUpdates:function u(AN,AO,AJ){var AM=this.getHost(true),AK=this.getHost(),AI={};if(!AK||!AM){return ;}AN=[].concat(AN||[]);if(this.dirtyVP){AN.push(this.getWidgetPropsAction());this.dirtyVP=false;}AM.syncLayerProperties(AK.model.data.vp,AI);var AL=AO||AK.model.docModel.controller._getXtabCallback(AK);this._super(AN,AL,AJ);},isShowAllRows:function G(AJ){var AI=U.walk("model.data.gsi.prop.sar",AJ);return AI===undefined||AI==="-1";},checkAttributeChanges:function K(AK){var AR=false,AQ=this.getHost(),AO=n.ensureArray(AK),AI=function(AS){return AS&&(((AS.act===Y.add||AS.act===Y.remove)&&(AS.unitType===H.DssTypeAttribute||AS.unitType===H.DssTypeAttributeForm))||(AS.act===Y.addForm||AS.act===Y.removeForm));},AN,AM,AP,AJ,AL;if(!this.isShowAllRows(AQ)){AQ.useRefresh=false;return ;}for(AM=0,AP=AO.length;AM<AP;AM++){if(AO[AM]&&AO[AM].act==="updateTemplate"){AN=AO[AM].actions;if(!n.isArray(AN)){continue;}for(AJ=0,AL=AN.length;AJ<AL;AJ++){if(AI(AN[AJ])){AR=true;break;}}if(AR===true){break;}}}AQ.useRefresh=!AR;},canSupportImageThreshold:function X(){var AJ=this.getHost(),AK=AJ&&AJ.model&&AJ.model.data,AI=AK&&AK.vp;return AE.supportImageThreshold(AI);},getCreateDropZonesAction:function a(AJ){var AK=this.getHost(true),AI=AK&&AK.getEditingDz(),AL=[];if(!C.checkDefined(AJ)||!C.checkDefined(AI)){return AL;}if(AJ===p.SliceBy&&(AI.SliceBy===undefined)){AL.push(this.getCreateDropZoneAction(p.SliceBy,3,34,-1));}if(AJ===p.Angle&&(AI.AngleBy===undefined)){AL.push(this.getCreateDropZoneAction(p.Angle,4,4,1));}return AL;},getCreateDropZoneAction:function D(AJ,AI,AK,AO){var AN=this.getHost(true),AL,AM;if(!AN){return{};}AL=AN.getEditingGridKey();AM=AN.defn&&AN.defn.tt;if(!AL||!AM){return{};}return{act:"createDefaultDropZone",treeType:AM,nodeKey:AL,zoneId:AJ,dropzone_index:AI,dropzone_types:AK,dropzone_sizelimit:AO};},hasReplaceCandidates:function(AI){return(!AI||!AI.zone)?null:this._super(AI);},destroy:function z(AK){var AI=this.dropZones,AJ=AI&&AI[0];if(AJ&&AJ.destroy){AJ.destroy(AK);AI.splice(0,1);}this._super(AK);}});function g(AJ,AK,AL){var AI=AK.zone.id;if(AI===p.GeoAttribute&&AK.idx>0){return ;}n.forEach(this.getZonesCfg(),function(AM){if(AM.id===AI){AM[AL](AJ,AK);return false;}});this.dirtyVP=true;}}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.VisUtility","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.models._DropZoneCommon","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.util.ThresholdUtils");var N=mstrmojo.array,R=mstrmojo.hash,X=mstrmojo.func,C=mstrmojo.chart.model.enums.EnumDSSObjectType,F=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,A=mstrmojo.vi.util.ThresholdUtils,W=mstrmojo.vi.ui.DatasetUnitMenuUtils,D=mstrmojo.vi.viz.EnumDSSDropZones,c=mstrmojo.vi.models.EnumDragSources,G=mstrmojo.vi.ui.DatasetUnitMenuUtils,Y=mstrmojo.VisUtility,O=D.Grouping,H=D.SizeBy,Q=D.ColorBy,b=D.AdditionalMetrics,E=mstrmojo.vi.enums.EnumFeatures,B=["#ec7b75","#f6db7f","#84c87b"];HEATMAP_THRESHOLD_BANDS=[0.35,0.65];mstrmojo.vi.models.HeatMapDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{scriptClass:"mstrmojo.vi.models.HeatMapDropZones",help:"editor_panel_heat_map.htm",getHostModel:function K(){return this.getHost().model.data;},getDropZones:function S(){var e=this.getDZFlatStruct(),d=[this.getZone(mstrmojo.desc(2941,"Grouping"),O,e.Grp,false,{title:mstrmojo.desc(13828)}),this.getZone(mstrmojo.desc(11663,"Size By"),H,e.SizeBy,false,{allowSingle:true,title:mstrmojo.desc(13829)}),this.getZone(mstrmojo.desc(11662,"Color By"),Q,e.ColorBy,false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(2962,"Tooltip"),b,e.AdditionalMetrics,false,{title:mstrmojo.desc(13827)})];this.dropZones=d;return{n:this.getHost().defn.ttl,zones:d};},getUnitMenuItems:function a(g,q,p,d){var t=this,v=this.id,e=this.isMetric(p),n=this.isAttribute(p),l=q.items,o=l.length,h={zone:q,idx:N.find(l,"id",p.id),cnt:o,item:p,useDropzone:true},j=(p.t===47&&p.st===12033),k=G.getDatasetFromAttributeId(this.docModel.datasets,p.did);if(j&&!mstrApp.isInVFConfigMode){g.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"eg",this.getCreateOrEditElementGroupFunc(h));g.addSeparator();}this.addSortMenu(h,g,false);g.addSeparator();var f=mstrmojo.resolveFeature(E.INSERT_NEW_METRIC),m=this.docModel,u=mstrApp.isInVFConfigMode;if(e&&!u){var r=p.did;if(p.um){g.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){t.editDerivedMetric(h,"edit");},h);g.addSeparator();}if(f){if(m.findDatasetIdFromUnit(r)&&!m.isFromSolrCube(r)&&!m.isFromMDXCube(r)){g.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",v,t.getAggregateByMetricSubMenu,h);g.addSeparator();}g.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),v,t.getCalculationEditorCfg,h);g.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){t.newDerivedMetric(h);},h);}}else{if(n&&!u){var s=this.isDynamicLink(p);if(!k||!this.docModel.isMDXDataset(k)){if(p.da){g.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){t.editDerivedAttribute(h);},h);g.addSeparator();}if(n&&(p.de!==true)&&this.allowInsertNewAttribute(q)&&!Y.isCGorCon(this.getHost(),p)&&!s&&f){g.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){t.newDerivedAttribute(h);},h);}}if(!G.hasOldDEOverDatasets(p.did,this.docModel.datasets)&&!this.isRecursiveAttribute(p)&&!s){g.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"eg",this.getCreateOrEditElementGroupFunc(h));}}}g.addSeparator();if(this.showNumberFormat(p)){g.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),v,this.getNumberFormatEditorCfg,h);}if(e){if(q.id===Q){this.buildThresholdMenuOptions(g,h,true);}}if(this.shouldShowDisplayFormsMenu(p)){g.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return t.getDisplayFormsMenu(p);});}g.addSeparator();if(t.hasReplaceCandidates(h)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(E.WEB_DRILL_AND_LINK))){g.addSubMenuItem(mstrmojo.desc(14003,"Replace With"),"",v,t.getReplaceSubMenu,h);}g.addMenuItem(mstrmojo.desc(1388,"Rename"),"",function(){t.renameItem(d,p);});g.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){t.deleteItem(q,t.getUnitIndexInZone(q,p));});},getAvatarIconClass:function I(){return"viHeatMap";},getAllowDropInfo:function M(o,h,s,g,d){var f=this._super(o,h,s,g,d),m=f.allowedItems,q=this,t=g===F.ON,l,p=false,k=false,n=function(u,v){return N.filter(m,function(x){var w=q.isMetric(x);return u?w:!w;},v?{max:1}:null);};switch(o.id){case O:l=false;break;case Q:var e=!!n(false,true).length,j=!!n(true,true).length,r=this.isMetricZone(o.id);if(r){l=j;}else{l=!e;}p=l;k=r||l;break;case H:l=true;p=true;k=true;break;case b:l=true;m=m.filter(function(v){var u=[H,Q],w=d.src.data;if(w.src===c.VIZ_EDITOR){N.removeItem(u,w.srcZoneId);}return u.every(function(x){return q.getUnitIndexInZone(q.getZoneModelByZoneId(x),v)===-1;});});break;}return R.copy({allowedItems:(k&&!(o.items.length===0||t))?[]:n(l,p),removeReplaced:t&&(k||N.find(h,"did",o.items[s].did)===-1)},f);},unitsDropped:function Z(n,e,p,q,d){var k=e.src.data,h=e.actions||[],r=p.idx,f=p.edge,m=this.docModel,j=p.allowedItems,g=(f===F.ON&&p.removeReplaced)?n.items[r]:null,o=this,l=function(){var s=o.getAddItemActions(n,j,o.getDropTargetIndex(n,p),true,g,k.dsid),u=h.concat(o.getUpdateTemplateAction(s)),t=function(v){return function(){var w=v?m.wrapUnsetVisualizationFilterAction(u):u;o.submitDropZoneUpdates(w,X.wrapMethods(e.callback,o.getHost().model.docModel.controller._getXtabCallback(o.getHost())));};};m.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:u,zm:o},t(true),t(false));};if(n.id===O||(!o.isMetric(j[0])&&n.id===Q)){o.checkAndWarnLargeItemsForAddUnits(j,l);return ;}l();},getAddItemActions:function V(n,m,r,k,f,j){var l=n.id,s=this.isMetric(m[0]),o=this,g={datasetId:j},h=[],q=false,e=function(u){var w=o.getZoneModelByZoneId(u),t=w.items.length,v=m.filter(function(x){return s?(k&&t===0):(o.getUnitIndexInZone(w,x)===-1);});if(v.length){N.insert(h,null,o.getAddDropZoneUnitsActions(w,v,s?0:t,g));return true;}},p=function(t){var u=o.getZoneModelByZoneId(t);m.forEach(function(v){if(o.getUnitIndexInZone(u,v)!==-1){h=h.concat(o.getRemoveDropZoneUnitActions(u,v,1));}});};switch(l){case O:var d=this.getZoneModelByZoneId(Q);if(d.items.length===0){N.insert(h,null,this.getAddDropZoneUnitsActions(d,m,0,g));}break;case H:p(b);break;case Q:if(s||this.isMetricZone(l)){n.items.forEach(function(t){h=h.concat(o.getRemoveDropZoneUnitActions(n,t));});r=0;f=null;}if(s){p(b);q=true;}else{e(O);}break;case b:p(H);p(Q);break;}if(f){h=h.concat(this.getRemoveDropZoneUnitActions(n,f));}N.insert(h,null,this.getAddDropZoneUnitsActions(n,m,r,g));if(q){this.checkAndAddThresholdAction(Q,m[0],h);}return h;},checkAndAddThresholdAction:function U(g,e,f){var d=this.getHost();if(g===Q&&this.isMetric(e)){A.addThresholds(d.model,d,d.node,e,f,B,HEATMAP_THRESHOLD_BANDS,false);return true;}return false;},deleteItem:function P(e,d){var g=this,f=g.docModel,h=this.getRemoveDropZoneUnitActions(e,e.items[d]);f&&f.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[e.id],zm:g},function(){g.submitDropZoneTemplateUpdates(h,{actions:f.wrapUnsetVisualizationFilterAction()});},function(){g.submitDropZoneTemplateUpdates(h);});},deleteItems:function P(d,e){var g=this,f=g.docModel,h=[];N.forEach(e,function(j){h=h.concat(g.getRemoveDropZoneUnitActions(d,j));});f&&f.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[d.id],zm:g},function(){g.submitDropZoneTemplateUpdates(h,{actions:f.wrapUnsetVisualizationFilterAction()});},function(){g.submitDropZoneTemplateUpdates(h);});},getHighlightTargets:function L(f,e){if(f.id===Q&&f.items.length&&e.item.t!==f.items[e.idx].t){var d=[];f.items.forEach(function(h,g){d.push({idx:g,edge:e.edge});},this);return d;}return this._super(f,e);},getReplaceCandidates:function J(e,f){var g=this._super(e,f);if(e.id===Q){var d=this._super(e,{t:f.t===4?12:4});g=g.concat(d);}return W.getSortedDatasetUnits(g);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.gm.GMEnums","mstrmojo.gm.GMUtility","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.util.ThresholdUtils","mstrmojo.vi.viz.EnumVisualizationTemplates");mstrmojo.requiresClsP("mstrmojo.vi.ui","SubtotalsWidget","DatasetUnitMenuUtils");mstrmojo.requiresClsP("mstrmojo.vi.models","DropZonesModel","EnumDragSources","_DropZoneCommon");mstrmojo.requiresDescs(101,122,144,190,1018,2453,2968,3582,7974,7975,7976,7978,7979,11099,11699,12143,12144,12145,12146,12147);var q=mstrmojo,r=q.array,R=q.hash,AM=q.func,AJ=mstrmojo.gm,H=AJ.GMUtility,AS=AJ.EnumABLDirection,Z=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,W=mstrmojo.vi.models.EnumDragSources,Y=mstrmojo.vi.viz.EnumDSSDropZones,M=mstrmojo.vi.util.ThresholdUtils,AD=mstrmojo.vi.ui.DatasetUnitMenuUtils,AP=3,n=AJ.WidgetPropertyTag,j=mstrmojo.vi.enums.EnumFeatures,D=q.vi.viz,L=D.EnumVizStyles,k=L.NEW_GRAPH_MATRIX,x=AJ.EnumShape,O=Y.Rows,AH=Y.Columns,z=Y.XAxis,a=Y.YAxis,I=Y.BreakBy,e=Y.SliceBy,m=Y.ColorBy,U=Y.SizeBy,K=Y.AdditionalMetrics,v=Y.Angle,c=1,P=AJ.DualAxisSubAxisBit,X="00000000000000000000000000000000",d=0,AI={n:"Metric Names",did:X,t:d},h=3,g=-20;function f(AT){return(AT===O||AT===AH||AT===a||AT===z||AT===I||AT===e);}function C(AT){return AT===a||AT===z;}function Q(AU,AV){var AW=[];function AT(AX){return !!(AX[0]===g&&AX[1]===g);}r.forEach(AU,function(AX){if(AX[0]===AV){AX[0]=g;}if(AX[1]===AV){AX[1]=g;}if(!AT(AX)){AW.push(AX);}});return AW;}function AL(AU,AY,AX){var AV=false,AW=[g,g],AT=AX?0:1;r.forEach(AU,function(AZ){if(!AV&&AZ[AT]===g){AV=true;AZ[AT]=AY;}});if(AV){return AU;}AW[AT]=AY;AU.push(AW);return AU;}function F(AX,AW,Ag,Af){var Ab=AX.tgtData,AZ=Ab.edge,AU=Ab&&Ab.tgtInfo,Ai=AU&&(parseInt(AU.axisIndex,10)+(AZ===Z.BELOW?1:0)),Aa=Af?0:1,AV=AZ===Z.ABOVE||AZ===Z.BELOW,Ah,AT,AY,Ad,Ae,Ac;for(Ae=0;Ae<AW.length;Ae++){Ad=AW[Ae];for(Ac=0;Ac<Ad.length;Ac++){if(Ad[Ac]===Ag){if(Ad[1-Ac]===g&&(Ai!==Ae||AV)){AW.splice(Ae,1);if(Ae<Ai){Ai--;}}else{Ad[Ac]=g;}}}}if(Ai>AW.length){Ai=AW.length;}if(AZ===AP&&Ai<AW.length&&AW[Ai][Aa]===g){AW[Ai][Aa]=Ag;}else{if(AZ===Z.ON){AW[Ai][Aa]=Ag;}else{Ah=AW.slice(0,Ai);AT=AW.slice(Ai);AY=[g,g];AY[Aa]=Ag;AW=Ah.concat([AY],AT);}}return AW;}mstrmojo.vi.models.XtabDropZonesMenuContextType=null;function l(){return mstrmojo.all[this.hostId];}function AG(){var AT=l.call(this);return AT.getHostStructure();}function b(AT){return AM.wrapMethods(AT.controller._getXtabCallback(AT),{success:function(){AT.resetXMLDirtyFlag();}});}function AF(){var Ag=l.call(this),Ac=this.getZoneModelByZoneId(O),AY=this.getZoneModelByZoneId(AH),AV=this.getZoneModelByZoneId(a),AX=this.getZoneModelByZoneId(z),AW=[],AT=Ag.GMController.getChartInfo(),AU=[],Af=[],Ad=Ag.getChartStyle()==="NewGraphMatrixVisualizationStyle";if(AT.isBubbleOrScatter){AU=Ag.copyTrendLineInfoForSwap(AV,AX);}if(AT.isABL){Af=Ag.copyRefLineInfoForSwap();}AW=AW.concat(this.getSwapDZUnitActions(Ac,AY,Ad));AW=AW.concat(this.getSwapDZUnitActions(AV,AX,Ad));var Ae=this.docModel.getDataService(),Aa=Ag.k,Ab=b(Ag),AZ=[Ae.getUpdateTemplateAction(Aa,AW)].concat(AU).concat(Af);if(Ag.isXMLDirty()){AZ.push(Ag.getPersistAction());}Ag.controller.submitUndoRedoUpdates(AZ,null,Ab);}function AE(AT,AY){var AV,AW=this,AX=[],AU=[];AV=this.getZoneModelByZoneId(AT);r.forEach(AV.items,function(AZ){if(AZ.t===12){AU.push(AZ);Array.prototype.push.apply(AX,AW.getRemoveDropZoneUnitActions(AV,AZ,AY));}});return{actions:AX,removedItems:AU};}function AA(AT,AW){var AV=[],AY=this,AU=this.getZoneModelByZoneId(AT),AX=this.getItemCountInZone(AT);r.forEach(AW,function(AZ){AV.push(AY.getAddDropZoneUnitAction(AU,AZ,AX++));});return{actions:AV};}function AC(AT,AY){var AW=[],AX=this,AU=this.getZoneModelByZoneId(AT),AV=AU.items;r.forEach(AY,function(Aa){var AZ=r.find(AV,"did",Aa.did);if(AZ!==-1&&f(Aa.zone)){AW.push(AX.getAddDropZoneUnitAction(AU,Aa,AZ));}});return{actions:AW};}function AO(AT,AU){var AV=AT.id;if((AV===z||AV===a)&&this.isMetric(AU)){return true;}return false;}function AN(AT,AW,AV){var AY="0",AU=AW.item,AX=AW.idx;if(AV){AY="1";}return function(){var Ad=this.getAddDropZoneUnitAction(AT,AU,AX,{isPrimary:AU.ax===0});Ad.condense=AY;var Ac=l.call(this),Ag=Ac.id,Af=Ac.getDocModel().getDataService(),AZ=Ac.k,Aa=Af.getUpdateTemplateAction(AZ,Ad);var Ab=function(Al){var Aj=q.all[Ag],Ak=Aj.model.data,Ah=Ak.dz,Ai=[Ah.AngleBy,Ah.Rows,Ah.YAxis,Ah.Columns,Ah.XAxis,Ah.ColorBy,Ah.SizeBy,Ah.AdditionalMetrics],Am=Aj.parent.getZonesModel&&Aj.parent.getZonesModel().getUpdateCallback();r.forEach(Ai,function(An){if(An&&An.TemplateMetric){r.forEach(An.TemplateMetric,function(Ao){if(Ao.id===AU.id){Ao.cds=Al;return false;}});}});Aj.clientRerenderGraphMatrix();if(Am&&Am.success){Am.success();}};var Ae={undo:function(){Ab(!AV);},redo:function(){Ab(AV);}};Ab(AV);Ac.submitUpdatesAndPersistXML([Aa],undefined,Ae,true);};}mstrmojo.vi.models.GMDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{scriptClass:"mstrmojo.vi.models.GMDropZones",dropZones:[],getHostStructure:function AG(){var AT=l.call(this);return AT.getHostStructure();},isZonesEmptyAfterDelItem:function V(AU){var AV={},AW=this.getHostStructure(),AT=AU.zone;AV[O]=AW.Rows.length;AV[AH]=AW.Columns.length;AV[z]=AW.XAxis.length;AV[a]=AW.YAxis.length;AV[U]=AW.SizeBy.length;AV[I]=AW.BreakBy.length;AV[v]=AW.AngleBy.length;AV[K]=this.getItemCountInZone(K);AV[AT]--;if(AV[O]>0||AV[AH]>0||AV[z]>0||AV[a]>0||AV[U]>0||AV[v]>0||AV[K]>0){return false;}return true;},getAutoSubtypeControl:function(AV){var Ac,AY,Ab,AX,Aa;var AZ=mstrmojo.gm.EnumSubtype,AU=mstrmojo.gm.WidgetPropertyTag.SUB_TYPE,AT=l.call(this),AW=AT.GMController.chartSubType,Ad=AT.readGlobalProperty(AU);AY={scriptClass:"mstrmojo.ui.Checkbox",enabled:!AV,alias:"AutoSubType",checked:Ad===AZ.AUTO,oncheckedChange:function(Ae){if(Ae.value){AT.writeGlobalProperty(AU,AZ.AUTO);}else{AT.writeGlobalProperty(AU,AW);}}};Ab={scriptClass:"mstrmojo.Label",text:mstrmojo.desc(12135,"Automatic subtype"),setDimensions:function(Ag,Ae){var Af=this.domNode;if(Af){Af.style.width=Ae;}}};AY.slot="col1Node";Ab.slot="col2Node";Ac={scriptClass:"mstrmojo.ui.editors.controls.TwoColumnContainer",col1Width:AX||"20%",col2Width:Aa||"80%",children:[AY,Ab]};return Ac;},getSubtypeButtonBar:function B(AX,AU,Ab){var AW=[null,{id:12143,desc:"Automatic",css:"automatic"},{id:12144,desc:"Absolute",css:"clustered"},{id:12145,desc:"Stacked",css:"stacked"},{id:12146,desc:"Clustered",css:"clustered"},{id:12147,desc:"Percent",css:"percent"}],Ae=mstrmojo.gm.EnumSubtype,Aa=mstrmojo.gm.WidgetPropertyTag.SUB_TYPE,AZ=l.call(this),Ag=AZ.GMController.chartSubType,AV=AZ.getChartInfo();function Af(Aj){var Ah=[],Ai;if(Aj.shape===x.BAR){Ai=[Ae.CLUSTERED,Ae.STACKED,Ae.PERCENT];}else{Ai=[Ae.ABSOLUTE,Ae.STACKED,Ae.PERCENT];}if(!Aj.isCombo){Ai.forEach(function(Ak){var Al=AW[Ak];Ah.push({n:Al?mstrmojo.desc(Al.id,Al.desc):null,id:Ak,css:Al?Al.css:null});});}else{Ai.forEach(function(Ak){var Al=AW[Ak],Am=AW[Ae.ABSOLUTE];Ah.push({n:(Ak===Ae.CLUSTERED)?mstrmojo.desc(Am.id,Am.desc):(Al?mstrmojo.desc(Al.id,Al.desc):null),id:Ak,css:Al?Al.css:null});});}return Ah;}function AT(Aj){var Ai=-1,Ah=0;Aj.forEach(function(Ak){if(Ak.id===Ag){Ai=Ah;}Ah++;});return Ai;}function AY(Ai,Ah){if(Ah!==Ai&&(Ah===Ae.PERCENT||Ai===Ae.PERCENT)){AZ.abandonCustomAxisScale();AZ.resetAxisOrigin();}AZ.writeGlobalProperty(Aa,Ai);}var Ad={scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-chart-brkby-subtype",n:"Subtype",selectedIndex:-1,enabled:!Ab,showIcon:true,alias:"SubtypeBB",useRichTooltip:true,updateTooltipConfig:function Ac(Aj){var Am=mstrmojo.dom,Al=Aj.target||Am.eventTarget(Aj.hWin,Aj.e),Ak=this.getItemFromTarget(Al),An=this.getItemNodeFromTarget(Al),Ah=Am.position(An),Ai=8;if(Ak){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPCENTER,content:Ak.n,top:Ah.y+Ah.h+Ai,left:Ah.x+Ah.w/2,cssClass:"vi-regular vi-tooltip-A A-center"};}},postselectionChange:function(Ah){AY(Ah.src.items[Ah.added[0]].id,Ah.src.items[Ah.removed[0]].id);}};Ad.items=Af(AV);Ad.selectedIndex=AT(Ad.items,Ag);return Ad;},getDropZones:function(){var AT=AG.call(this),AX=l.call(this),Aa=AX.GMController,AZ=Aa.isPie,Ab=Aa.isHistogram,AU=Aa.isBoxPlot,AW=Aa.isWaterfall,AY=[this.getZone(mstrmojo.desc(14294,"Angle"),v,AT.AngleBy),this.getZone(mstrmojo.desc(6188,"Slice"),e,AT.SliceBy),this.getZone(mstrmojo.desc(2968,"Rows"),O,AT.Rows),this.getZone(mstrmojo.desc(122,"Columns"),AH,AT.Columns),this.getZone(mstrmojo.desc(12086,"XAxis"),z,AT.XAxis),this.getZone(mstrmojo.desc(12088,"YAxis"),a,AT.YAxis),this.getZone(mstrmojo.desc(11662,"Color By"),m,AT.ColorBy)];var AV=this.getZone(mstrmojo.desc(12173,"Break By"),I,AT.BreakBy);if(AX.getChartInfo().isABL&&AV.items.length>0&&!(AX.getChartStyle()===k)){AV.siblings=[this.getSubtypeButtonBar("Subtype",[],false)];}AY.push(AV);AY.push(this.getZone(mstrmojo.desc(12090,"Size By"),U,AT.SizeBy));AY.push(this.getZone(mstrmojo.desc(2962,"Tooltip"),K,AT.AdditionalMetrics));if(!AZ){AY=AY.slice(2);}else{AY.splice(1,0,AY.splice(6,1)[0]);}if(Ab){AY=[this.getZone(mstrmojo.desc(517,"Metric"),a,AT.YAxis),this.getZone(mstrmojo.desc(11806,"Aggregate By"),z,AT.XAxis),this.getZone(mstrmojo.desc(2962,"Tooltip"),K,AT.AdditionalMetrics)];}else{if(AU){AY=[this.getZone(mstrmojo.desc(2968,"Rows"),O,AT.Rows),this.getZone(mstrmojo.desc(122,"Columns"),AH,AT.Columns),this.getZone(mstrmojo.desc(12086,"XAxis"),z,AT.XAxis),this.getZone(mstrmojo.desc(12088,"YAxis"),a,AT.YAxis),AV,this.getZone(mstrmojo.desc(11662,"Color By"),m,AT.ColorBy),this.getZone(mstrmojo.desc(2962,"Tooltip"),K,AT.AdditionalMetrics)];}else{if(AW){AY=[this.getZone(mstrmojo.desc(2968,"Rows"),O,AT.Rows),this.getZone(mstrmojo.desc(122,"Columns"),AH,AT.Columns),this.getZone(mstrmojo.desc(12086,"XAxis"),z,AT.XAxis),this.getZone(mstrmojo.desc(12088,"YAxis"),a,AT.YAxis),AV,this.getZone(mstrmojo.desc(2962,"Tooltip"),K,AT.AdditionalMetrics)];}}}this.dropZones=AY;return{n:l.call(this).defn.ttl,zones:AY};},updateMetricNameUnit:function(){var AV,AX,AY,Aa=l.call(this),AT=R.clone(AI),AZ=this.shouldShowMetricNames(),Ab=this.hGetItemOccurrence(AT),AW=Ab.length,AU=[];if(AZ&&AW===0){AY=this.getZoneModelByZoneId(O);AT.zone=O;AU.push(this.getAddDropZoneUnitAction(AY,AT,AY.items.length));AY.items.push(AT);}if(!AZ&&AW>0){for(AV=0;AV<AW;AV++){AY=this.getZoneModelByZoneId(Ab[AV].zoneId);AX=Ab[AV].itemIndex;AU=AU.concat(this.getRemoveDropZoneUnitActions(AY,AY.items[AX]));AY.items.splice(AX,1);}}if(AU.length>0){this.submitUpdatesAndPersistWidgetXMLIfNecessary(Aa,AU,mstrmojo.emptyFn);}},shouldShowMetricNames:function(){var AU=this;if(AU.getMetricCntInZone(z)>c){return true;}if(AU.getMetricCntInZone(a)>c){return true;}var AT=AU.getZoneModelByZoneId(v)!==undefined;if(AT&&AU.getMetricCntInZone(v)>c){return true;}return false;},hHasMetricInZone:function(AT){var AW,AU=false,AV=this.getZoneModelByZoneId(AT).items,AX=AV.length;for(AW=0;AW<AX;AW++){if(AV[AW].t===4){AU=true;break;}}return AU;},hHasAttributeInZone:function(AT){var AW,AU=false,AV=this.getZoneModelByZoneId(AT).items,AX=AV.length;for(AW=0;AW<AX;AW++){if(AV[AW].t===12){AU=true;break;}}return AU;},getAttributesZone:function(){var AT=z;if(this.hHasMetricInZone(z)){AT=a;}return AT;},canSwapAxis:function AB(){return true;},swapAxis:function A(){var AT=l.call(this);AT.clearChartScale();AT.clearContainerFit();AF.call(this);},shouldShowCondensedMenu:function(AT,AU){return AO.call(this,AT,AU);},getCondenseLableHandler:function(AT,AV,AU){return AN(AT,AV,AU);},getUnitMenuItems:function s(Aa,Aq,Ap,AU){if(!Ap){throw new Error(this.scriptClass+"::getUnitMenuItems: Item must be provided.");}var At=this,Ak=mstrmojo.all[this.hostId].zonesModel.id,AT=l.call(this),Aj=AT,Ar=AT.GMController,Af=Ar.getChartInfo(),Ai=Aq.items,Am=Ai.length,AV=Aq.id,Ab={zone:Aq,axis:AV,idx:r.find(Ai,"id",Ap.id),cnt:Am,item:Ap,metricsAxis:AG.call(this).tma,useDropzone:true},AX;function Al(Av,Aw){if(Aw.axis===O||Aw.axis===AH){}}if(this.isMetricName(Ap)){if(Aq.id===m){Aa.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[Ak].deleteItem(Aq,Ab.idx);});return ;}return ;}var AW=Ar.attributeSelectionInfo;if(this.isNewDerivedElement(Ap)){if(!mstrApp.isInVFConfigMode){Aa.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"eg",this.getCreateOrEditElementGroupFunc(Ab));}if((AV===O||AV===AH||AV===z||AV===a)&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){Aa.addSeparator();AX=AW&&AW[Ap.id];Aa.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:true,selInfo:AX});Aa.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:false,selInfo:AX});if(Ar.firstRes.gsi.sorts[0].length!==0||Ar.firstRes.gsi.sorts[1].length!==0){Aa.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"xt",AT.getMenuHandler("clearSort"));}Aa.addSeparator();}}else{if(this.isConsolidation(Ap)){if(AV===O||AV===AH||AV===z||AV===a){Aa.addSeparator();AX=AW&&AW[Ap.id];Aa.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:true,selInfo:AX});Aa.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:false,selInfo:AX});if(Ar.firstRes.gsi.sorts[0].length!==0||Ar.firstRes.gsi.sorts[1].length!==0){Aa.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"xt",AT.getMenuHandler("clearSort"));}Aa.addSeparator();}}else{if(this.isMetric(Ap)){if(Ap.um&&!mstrApp.isInVFConfigMode){Aa.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){At.editDerivedMetric(Ab,"edit");},Ab);Aa.addSeparator();}if(Ar.supportSort()&&Af.isABL&&(AV===a||AV===z)&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"&&!Aj.excludeData){var An=Ar.metricSelectionInfo;AX=An&&An[Ap.id];Aa.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",AT.getMenuHandler("sortMetricTitle"),{isAsc:true,selInfo:AX});Aa.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",AT.getMenuHandler("sortMetricTitle"),{isAsc:false,selInfo:AX});Al(Aa,Ab);if(Ar.firstRes.gsi.sorts[1].length!==0||Ar.firstRes.gsi.sorts[0].length!==0){Aa.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"xt",AT.getMenuHandler("clearSort"));}}Aa.addSeparator();if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(j.INSERT_NEW_METRIC)){if(this.docModel.findDatasetIdFromUnit(Ap.did)&&!this.docModel.isFromSolrCube(Ap.did)&&!this.docModel.isFromMDXCube(Ap.did)){Aa.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",Ak,At.getAggregateByMetricSubMenu,Ab);Aa.addSeparator();}Aa.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),Ak,At.getCalculationEditorCfg,Ab);if(Ar.getChartInfo().isABL){Aa.addSubMenuItem(mstrmojo.desc(12287,"Shortcut Metric"),"",Ak,At.getShortcutMetricSubMenu,Ab);}Aa.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){At.newDerivedMetric(Ab);},Ab);Aa.addSeparator();}if(AO.call(this,Aq,Ap)&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){var Ao=Ap.cds;var Ah=AN.call(this,Aq,Ab,true),Ag=AN.call(this,Aq,Ab,false);Aa.addToggleMenuItem(mstrmojo.desc(14324,"Condense Axis Labels"),"",Ah,Ag,this.id,Ao);}if(mstrApp&&mstrApp.supportFeature&&mstrApp.supportFeature(j.NUMBER_FORMATTING)){Aa.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),Ak,this.getNumberFormatEditorCfg,Ab);}if(Aq.id===m){this.buildThresholdMenuOptions(Aa,Ab,true);}Aa.addSeparator();if(Af.isABL&&(Aq.id===z||Aq.id===a)&&!Af.isPie&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){H.getSubMenu(Aj,Aa,Ap.id,Ap.idx);}Aa.addSeparator();if((AV===z||AV===a)&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){if((Af.isBubbleOrScatter&&AV===a)||Af.isABL){if(H.isTrendLineAvailableForMetric(AT,Ap.idx)){Aa.addToggleMenuItem(mstrmojo.desc(12155,"Enable trendline for ##").replace("##",Ap.n),"xt",H.getTrendLineToggleHandler(AT,Ap.id,true),H.getTrendLineToggleHandler(AT,Ap.id,false),Ak,H.getTrendLineToggleState(AT,Ap.id));if(H.getTrendLineToggleState(AT,Ap.id)){Aa.addMenuItem(mstrmojo.desc(12163,"Edit trendline..."),"xt",H.getEditTrendLineHandler(AT,Ap.id));}}}}var As=Ar.getMetricsOnXAxis().concat(Ar.getMetricsOnYAxis()),AZ=Ar.model&&Ar.model.getMetricIDsFromIndex(As),Au=false;if(Ap.id){if(AZ&&AZ.indexOf(Ap.id)>=0){Au=true;}}var AY=false;if(Ar.isStacked&&!Ar.splitPlottingMetrics){AY=true;}else{if(!Au){AY=true;}}AY=AY||H.isIgnoredMetric(Aj,Ap.idx);if(!AY){H.getReferenceLineSubMenu(Aj,Aa,Af.isABL,Ap.id);}Aa.addSeparator();}else{if(this.isAttrCategory(Ap)){var Ae=Ap.did||"",Ad=Ae?AD.getDatasetFromAttributeId(this.docModel.datasets,Ae):null,Ac=!Ad||!this.docModel.isMDXDataset(Ad);if(Ap.da&&Ac&&!mstrApp.isInVFConfigMode){Aa.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){At.editDerivedAttribute(Ab);},Ab);Aa.addSeparator();}if((AV===O||AV===AH||AV===z||AV===a)&&Aj.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){AX=AW&&AW[Ap.id];Aa.addMenuItem(mstrmojo.desc(7974,"Sort Ascending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:true,selInfo:AX});Aa.addMenuItem(mstrmojo.desc(7975,"Sort Descending"),"xt",AT.getMenuHandler("sortAttributeTitle"),{isAsc:false,selInfo:AX});Al(Aa,Ab);if(Ar.firstRes.gsi.sorts[0].length!==0||Ar.firstRes.gsi.sorts[1].length!==0){Aa.addMenuItem(mstrmojo.desc(11699,"Clear Sort"),"xt",AT.getMenuHandler("clearSort"));}Aa.addSeparator();}if(!mstrApp.isInVFConfigMode&&!this.isDynamicLink(Ap)){if(this.allowInsertNewAttribute(Aq)&&((!Ad)||!AD.isCGorCon(Ap,Ad))&&Ac&&mstrmojo.resolveFeature(j.INSERT_NEW_METRIC)){Aa.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){At.newDerivedAttribute(Ab);},Ab);}if(!AD.hasOldDEOverDatasets(Ap.did,this.docModel.datasets)&&!this.isRecursiveAttribute(Ap)&&!this.isCustomGroup(Ap)){Aa.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"eg",this.getCreateOrEditElementGroupFunc(Ab));}Aa.addSeparator();}if(this.showNumberFormat(Ap)&&!(Ar.isHistogram||Ar.isBoxPlot||Ar.isWaterfall)){Aa.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),Ak,this.getNumberFormatEditorCfg,Ab);}if(this.shouldShowDisplayFormsMenu(Ap)&&!Ar.isHistogram){Aa.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),Ak,function(){return At.getDisplayFormsMenu(Ap);});}}}}}Aa.addSeparator();if(At.hasReplaceCandidates(Ab)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(j.WEB_DRILL_AND_LINK))){Aa.addSubMenuItem(mstrmojo.desc(14003,"Replace with"),"",Ak,At.getReplaceSubMenu,Ab);}Aa.addMenuItem(mstrmojo.desc(1388,"Rename"),"xt",function(){At.renameItem(AU,Ap);});Aa.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){At.deleteItem(Aq,Ab.idx);});},isGraphDroppingAllowed:function S(AX,AT,Ab){var AU=AX.id,AY=true,Aa=l.call(this).GMController,AW=Aa.isBubbleOrScatter();var AZ=this.isMetric(Ab),AV=this.isMetricName(Ab);switch(AU){case O:case AH:if(AZ){AY=false;}break;case z:case a:if(!AW&&AV&&this.hHasMetricInZone(AU)){AY=false;}break;default:break;}return AY;},allowDropOnTarget:function G(AU,AV){var AT=true;if(AU===W.DATASETS&&this.isMetricName(AV.item)){AT&=(AV.srcZoneId===m);}return AT;},allowMoveMetricName:function J(AT,AU){if(this.isDualAxis(a)&&AT===AH&&AU===z){return false;}else{if(this.isDualAxis(z)&&AT===O&&AU===a){return false;}}return true;},isItemDropAllowed:function p(Ap,Ae,Aj,AX,AY){var Ab;if(AX&&AX.src){Ab=AX.src.data.src;}var Ad,Ag=Ap.id,Ac=this.getItemCountInZone(Ag),Ak=l.call(this).scriptClass==="mstrmojo.ngm.VisNewGraphMatrix",AU=l.call(this).GMController,Am=AU.getChartInfo().isABL,Al=AU.isHistogram,Aa=AU.isBoxPlot,AT=AU.isWaterfall,An=AU.isBubbleOrScatter(),AV=AU.isGrid()&&!AU.isEmptyVis(),AW=this.isMetric(Ae),Ah=this.isAttrCategory(Ae),Ai=this.isMetricName(Ae);if(AY===Z.BELOW||AY===AP){AY=Z.ABOVE;Aj++;}if(AY===Z.ON){Ad=Ap.items[Aj];if(this.isMetricName(Ad)&&Ap.id!==m){return false;}}if(Ae===Ap.items[Aj]){return false;}switch(Ag){case O:case AH:if(AW){return false;}if(Ai&&(Aj<Ac||!this.allowMoveMetricName(Ap.id,Ae.zone))){return false;}break;case z:case a:if(Al){if((this.isAttrCategory(Ae)&&Ag===z)||(Ag===a&&this.isMetric(Ae)&&(Ac===0||AY===Z.ON))){return true;}return false;}else{if(AT||Aa){var Af=Ag===z?a:z;if(this.isMetric(Ae)&&this.hHasMetricInZone(Af)&&(this.getUnitIndexInZone(this.getZoneModelByZoneId(Af),Ae)===-1||this.getZoneModelByZoneId(Af).items.length>1)){return false;}if(this.isAttribute(Ae)&&this.hHasAttributeInZone(Af)&&(this.getUnitIndexInZone(this.getZoneModelByZoneId(Af),Ae)===-1||this.getZoneModelByZoneId(Af).items.length>1)){return false;}}else{if(!Ai&&Am&&AY!==Z.ON){return true;}}}if(Ai){if(An||Am){return false;}else{if(this.hHasMetricInZone(Ag)||AY===Z.ON){return false;}}}break;case U:if(Ah||Ai){return false;}if(AW){if(Ac>0&&!An&&AY!==Z.ON){if(this.getUnitIndexInZone(Ap,Ae)===-1){return false;}}}break;case I:if(AV||AW){return false;}break;case m:if(Aa){if(this.isMetric(Ae)){return false;}var Ao=this.hGetItemOccurrence(Ae,[I]);if(Ao.length){return false;}}if(AW){if(Ac>0&&AY!==Z.ON){return false;}}else{if(Ah){if(Ac>0&&this.isMetric(Ap.items[0])&&AY!==Z.ON){return false;}}}break;case e:if(AW){return false;}break;case v:if(AW){return true;}else{return false;}break;case K:var Aq=this.getMetricCntInZone(Ag),AZ=Ac-Aq;if(Ai){return false;}if(Ah){if(!Ak){return false;}Ao=this.hGetItemOccurrence(Ae);if(Ao.length<=0){return false;}if(Aq>0){if(AZ===0){if(Aj!==0||AY!==0){return false;}}else{if(Aj===AZ&&AY!==0||Aj>AZ-1&&Aj!==AZ){return false;}}}}if(AW){if(AZ>0&&Aj<AZ){return false;}}break;default:break;}return true;},changeToDualAxis:function w(AT){var AU=0,AV=0;r.forEach(AT.items,function(AW){if(AW.ax===0){AU++;}else{if(AW.ax===1){AV++;}}});return AU>0&&AV>0;},getActionsOnUnitDropped:function(Az,Ai,BN,BI,Ag,AV,Af,BO){var Al=this,BD,BA,An,Ae=false,Aq=Al.getZoneModelByZoneId(I),Ap=Al.getZoneModelByZoneId(K),Ab=l.call(Al),A5=Ab.GMController,As=Ab.getChartStyle()==="NewGraphMatrixVisualizationStyle",BK=A5.getChartInfo(),BC=Al.getUnitIndexInZone(Ai,Az),AZ=Al.getUnitIndexInZone(Ap,Az),Ad=Ai.id,Ah=Ai.items,A3=[],Am={},Ac={},Ao,AU=Al.isAttrCategory(Az),AY=Al.isMetricName(Az),Ay,A8,BF,BB,BJ=BN.src.data.src,BH=Al.isDualAxis(Ai.id),BE=Al.isMetricZone(Ad),Ak=function(){if(Ad===m){An=Al.hGetItemOccurrence(Az,[O,AH,z,a,I,e]);if(An.length===0&&!Al.isMetric(Az)){var BU=function(BV){var BX=Al.getZoneModelByZoneId(m),BY,BW;if(BV.id===e||BV.id===I){for(BW=BI-1;BW>=0;BW--){BY=r.find(BV.items,"did",BX.items[BW].did);if(BY!==-1){return BY+1;}}}return 0;};var BP,BR,BT;if(A5.isBoxPlot){BP=Al.getAttributesZone();BR=Al.getZoneModelByZoneId(BP);BT=BR.items.length;var BQ=BP;BQ=Al.getZoneModelByZoneId(BQ);r.forEach(BR.items,function(BW,BV){A3.push(Al.getAddDropZoneUnitAction(BQ,BW,BT-BV));});}else{BP=BK.isPie?e:(A5.isGrid()?z:I);BR=Al.getZoneModelByZoneId(BP);BT=BU(BR);}A3.push(Al.getAddDropZoneUnitAction(BR,Az,BT));}}else{if((Az.zone===m)&&f(Ad)){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Al.getZoneModelByZoneId(m),Az,1));}else{if(Ad===I&&BK.tp===2&&A5.view.chartInfo&&A5.view.chartInfo.subtype===1){var BS=Al.getZoneModelByZoneId(m),BR;if(!(BS.items.length&&BS.items[0].t===4)){BR=Al.getZoneModelByZoneId(m);A3.push(Al.getAddDropZoneUnitAction(BR,Az));}}}}};AV=(AV===undefined?true:AV);Am[z]=Al.isMetricZone(z);Am[a]=Al.isMetricZone(a);Ac[z]=Al.getMetricCntInZone(z);Ac[a]=Al.getMetricCntInZone(a);Ao=Al.getZoneModelByZoneId(v)!==undefined;if(Ao){Am[v]=Al.isMetricZone(v);Ac[v]=Al.getMetricCntInZone(v);}else{Am[v]=false;Ac[v]=0;}if(Ah.length){if(Ad===m&&Ag!==Z.ON&&(Al.isMetric(Az)||((Al.isAttrCategory(Az)||Al.isMetricName(Az))&&Al.isOnlyMetricZone(Ad)))){Ag=Z.ON;}if(C(Ad)&&this.differInType(Az,Ah[0])){if(AU){Am[Ad]=false;}if(this.isMetric(Az)){Am[Ad]=true;}Ac[Ad]=1;A3=A3.concat(this.getClearDZUnitActions(Ai));if(As){for(var BD=0;BD<Ah.length;BD++){A3=A3.concat(Al.removeFromTooltipDropZone(Ah[BD],Ad));}}BI=0;}else{if(Ag===Z.ON){A8=Ai.items.filter(function(BP){return BP.dzidx!==undefined?BP.dzidx===BI:BP.idx!==undefined?BP.idx===BI:true;})[0];BF=(Az.did===A8.did);BB=(Ad===m);if(Al.getUnitIndexInZone(Ai,Az)!==-1&&A8.did!==Az.did){Ac[Ad]--;}if(Al.isMetric(Az)&&Al.isMetric(A8)){AV=A8.ax===0;}if(BB&&((Al.isAttrCategoryZone(m)&&Al.isMetric(Az))||(Al.isMetricZone(m)&&AU))){if(As){for(var BD=0;BD<Ah.length;BD++){A3=A3.concat(Al.removeFromTooltipDropZone(Ah[BD],Ad));}}A3=A3.concat(Al.getClearDZUnitActions(Ai,false));BI=0;}else{if(!BF){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Ai,A8));if(As){A3=A3.concat(Al.removeFromTooltipDropZone(A8,Ad));}if(BC<BI&&BC>=0){BI--;}}}if(BB&&Al.isAttrCategory(A8)&&!BF){this.removeColorByItemFromBreakByIfExists(A8,A3);}else{Ak();}}else{if(Ag===Z.ABOVE&&Al.getUnitIndexInZone(Ai,Az)===-1){Ac[Ad]+=1;if(Ac[Ad]===1&&Az.t===4){Am[Ad]=true;}}else{if((Ag===Z.BELOW||Ag===AP)&&Al.getUnitIndexInZone(Ai,Az)===-1){Ac[Ad]+=1;if(Ac[Ad]===1&&Az.t===4){Am[Ad]=true;}if((BI<Ah.length)&&(BC===-1)){BI++;}}}}}}else{Ac[Ad]+=1;if(Ac[Ad]===1&&Al.isMetric(Az)){Am[Ad]=true;}BI=0;}if(C(Ad)&&Az.zone===Ad&&BK.isBubbleOrScatter&&Ah.length>1){var A2=(Az.ax===0);if(A2!==AV){r.forEach(Ah,function(BP){if(BP.did!==Az.did){A3.push(Al.getAddDropZoneUnitAction(Ai,BP,BI,{isPrimary:AV}));}});}}if(Ad===I&&A5.isBoxPlot){An=Al.hGetItemOccurrence(Az);for(BD=0,BA=An.length;BD<BA;BD++){if(An[BD].zoneId===m){Ay=Al.getZoneModelByZoneId(An[BD].zoneId);A3=A3.concat(Al.getRemoveDropZoneUnitActions(Ay,Ay.items[An[BD].itemIndex],1));if(Ac[Ay.id]){Ac[Ay.id]--;}}}}if(!As){if(Ad!==K&&AZ!==-1){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Ap,Ap.items[AZ],1));}if(Ad===K){An=Al.hGetItemOccurrence(Az);for(BD=0,BA=An.length;BD<BA;BD++){if(An[BD].zoneId!==K){Ay=Al.getZoneModelByZoneId(An[BD].zoneId);A3=A3.concat(Al.getRemoveDropZoneUnitActions(Ay,Ay.items[An[BD].itemIndex],1));if(Ac[Ay.id]){Ac[Ay.id]--;}}}}}else{if(!AY&&Ad!==K){var AX=Al.getTooltipDropzoneIdx(Az);A3.push(Al.getAddDropZoneUnitAction(Ap,Az,AX,{isPrimary:AV}));}}if(!Am[z]&&!Am[a]&&Ai.id!==I&&Aq!==undefined){if(As){var A6=Aq.items;for(var BD=0;BD<A6.length;BD++){A3=A3.concat(Al.removeFromTooltipDropZone(A6[BD],I));}}A3=A3.concat(Al.getClearDZUnitActions(Aq));var Aj=Al.hGetItemOccurrence(AI,[I]);if(Aj){A3=A3.concat(Al.getClearDZUnitActions(Aq,false));}}if(AU||AY){if(BC!==-1){if(Ad===I||Ad===e){if(Ah[BC].hidden){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Al.getZoneModelByZoneId(m),Az));}}else{if(Ad===m){Ak();}}}else{Ak();}}else{if(this.isMetric(Az)){var Au=this.hGetItemOccurrence(Az,[z,a,v]),A7=([z,a,v,m,U,K]).filter(function(BP){return BP!==Az.zone;}),AW=Al.hGetItemOccurrence(Az,A7),Aa=AW.length>0?1:0;if((BJ===W.VIZ_EDITOR||BJ===W.VIZ)&&Az.zone&&(Az.zone!==Ad&&(!As||Ad!==K))){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Al.getZoneModelByZoneId(Az.zone),Az,1));if(Au.length&&Ac[Au[0].zoneId]&&Au[0].zoneId!==Ad){Ac[Au[0].zoneId]--;}}else{if(BJ===W.DATASETS&&Au.length!==0&&Ad!==m&&Ad!==U&&Ad!==v&&Au[0].zoneId!==Ad&&Au[0].zoneId!==v){if(!As){A3=A3.concat(Al.getRemoveDropZoneUnitActions(Al.getZoneModelByZoneId(Au[0].zoneId),Az,Aa));Ac[Au[0].zoneId]--;}}}}}A3.push(Al.getAddDropZoneUnitAction(Ai,Az,BI,{isPrimary:AV}));if(!BN.metricNamesHandled){if(!this.isMetricName(Az)){var Aw=R.clone(AI,[O,AH,z,a]),BM=Al.hGetItemOccurrence(Aw),Ax=BM.length>0,Ar=Al.hGetItemOccurrence(AI,[O]),AT=Al.hGetItemOccurrence(AI,[AH]),A4=Al.hGetItemOccurrence(AI,[z]),At=Al.hGetItemOccurrence(AI,[a]),A1=Al.hGetItemOccurrence(AI,[O,AH,z,a,I]);if((Am[z]&&Ac[z]>c)||(Am[a]&&Ac[a]>c)||(Am[v]&&Ac[v]>c)){Ae=true;}var Av=A1.length?A1[0].zoneId:O,BG=Al.changeToDualAxis(Ai);if(!Ax&&Ad===z){Av=AH;}if(!Ax&&BN.dndGM&&Al.isMetric(Az)&&Ag!==Z.ON){if(Af){if(Ad===z){Av=AH;}else{Av=O;}}else{if(Ad===z){Av=a;}else{Av=z;}}}var A9=false;if(Al.isAttrCategory(Az)&&Ad!==O&&Ad!==AH&&Ad!==m&&Ad!==I&&Ad!==e){r.forEach(BM,function(BP){if(BP.zoneId===Ad){A9=true;}});if(!BE&&(Ad===z||Ad===a)){A9=true;}if(Ae&&Ax&&!A9){if(A4.length){Av=AH;}else{if(At.length){Av=O;}}Ai=Al.getZoneModelByZoneId(Av);Aw.zone=Av;A3.push(Al.getAddDropZoneUnitAction(Ai,Aw,Ai.items.length));}}if(!BH&&BG&&(Az.zone===z||Ad===z)&&Ar.length>0){Av=a;}else{if(!BH&&BG&&(Az.zone===a||Ad===a)&&AT.length>0){Av=z;}}if(Ae!==Ax||BJ===W.VIZ||(Ax&&Af!==[AH,O].indexOf(BM[0].zoneId)>=0)){A3=A3.concat(Al.getUpdateMetricNameUnitActions(Ae,Av));}}}if(Az.t===4){var A0;if(A5.shallWeUseGroupInfo){if(Al.isMetricName(Az)&&(Ad===z||Ad===a)){A5.shallWeUseGroupInfo=false;A5.removeGroupInfo();}else{A0=A5.getGroupInfo();if((BK.dirc===AS.VERTICAL&&Ad===a)||(BK.dirc===AS.HORIZONTAL&&Ad===z)){if(Ag===Z.ON&&A8!==undefined&&Al.isMetric(A8)){A0=Al.replaceItemInGroupInfo(A0,Az.did,AV,A8.did);}else{A0=Al.fillGroupInfo(BN,A0,Az.did,AV);}}A5.setGroupInfo(A0);}}else{if((AV===false&&A5.getSplitPlottingMetrics())){A5.shallWeUseGroupInfo=true;if(BK.isBubbleOrScatter&&Ac[a]===0){A5.horizontalMode=true;}A0=A5.getDummyGroupInfo();A0=Al.fillGroupInfo(BN,A0,Az.did,AV);}else{if(Al.isMetricName(Az)&&(Ad===O||Ad===AH)&&A5.getSecondaryMetrics().length>0){A5.shallWeUseGroupInfo=true;A0=A5.getDummyGroupInfo();}else{if(BO){A5.shallWeUseGroupInfo=true;A0=A5.getDummyGroupInfo(Az.did,AV,Ag===Z.ABOVE);}}}}if(A5.shallWeUseGroupInfo){Ab.setWidgetPropertyValue(n.GROUP_INFO,JSON.stringify(A0));}}Al.checkAndAddThresholdAction(Ad,Az,A3);var BL=function(BR){if(!AU){return BR;}var BQ=Al.getZoneModelByZoneId(m),BV=Al.getZoneModelByZoneId(e),BU=Al.getZoneModelByZoneId(I),BX,BS,BT=[],BY=function(){for(BD=r.find(BQ.items,"did",Az.did)-1;BD>=0;BD--){BX=r.find(Ai.items,"did",BQ.items[BD].did);if(BX!==-1){return BX+1;}}return 0;},BW=function(Ba,BZ,Bb){Ba.items=Ba.items.filter(function(Bc){return Bc.did!==Bb.did;});Ba.items.splice(BZ,0,Bb);},BP=function(BZ,Ba){return BR.some(function(Bb){return(Bb.zoneId===BZ.id&&Bb.unitId===Ba.did);});};BR.forEach(function(BZ){if(BZ.act==="addDropZoneUnit"){Ai=Al.getZoneModelByZoneId(BZ.zoneId);Az={t:BZ.unitType,did:BZ.unitId};BI=BZ.unitPos-1;BI=BI>=0?BI:0;if(Ai.id===I||Ai.id===e){if(r.find(BQ.items,"did",Az.did)!==-1){BI=BY();BZ.unitPos=BI+1;}BW(Ai,BI,Az);}else{if(Ai.id===m){BW(Ai,BI,Az);if(BV&&r.find(BV.items,"did",Az.did)!==-1){BX=BY();BW(BV,BX,Az);if(!BP(BV,Az)){BS=R.clone(BZ);BS.zoneId=BV.id;BS.unitPos=BX+1;BT.push(BS);}}if(BU&&r.find(BU.items,"did",Az.did)!==-1){BX=BY();BW(BU,BX,Az);if(!BP(BU,Az)){BS=R.clone(BZ);BS.zoneId=BU.id;BS.unitPos=BX+1;BT.push(BS);}}}}}});return BR.concat(BT);};return A3;},checkAndAddThresholdAction:function AK(AY,AV,AW){var AU=this.getHost(),AT=AU.getVisType().vt,AX=M.getDefaultGMThreshold(AT);if(this.isMetric(AV)&&AY===m){M.addThresholds(AU.model,AU,AU.node,AV,AW,AX.colors,AX.ranges,false);return true;}return false;},isDualAxis:function N(AT){var AY=this,AX=AY.getZoneModelByZoneId(AT),AV=0,AW=0;var AU=function(AZ){if(AZ===true||AZ===1){AV++;}else{if(AZ===false||AZ===0){AW++;}}};r.forEach(AX.items,function(AZ){if(AY.isMetric(AZ)){AU(AZ.ax);}});return AV>0&&AW>0;},getUnitDroppedActions:function(Ai,Ab,AU,Ag,AV,Ac,AT,Af){var AY=[],Ad=(Af===O||Af===AH);AY=AY.concat(this.getActionsOnUnitDropped(Ai,Ab,AU,Ag,AV,Ac,AT,Ad));if(Af){var AX=R.clone(AI,[O,AH,z,a]),Ah=this.hGetItemOccurrence(AX),AZ=this.getZoneModelByZoneId(Af),AW=AZ.items.length,Ae;if(Ah.length>0){var Aa=this.getZoneModelByZoneId(Ah[0].zoneId);Ae=Aa.items[Ah[0].itemIndex];}else{Ae=AX;Ae.zone=Af;}AY=AY.concat(this.getActionsOnUnitDropped(Ae,AZ,AU,AW,Z.BELOW,true));}return AY;},getUpdateMetricNameUnitActions:function(Ab,Ac){var AW,AY,Aa,AU=R.clone(AI),Ad=this.hGetItemOccurrence(AU),AX=Ad.length,AV=[];if(Ab&&AX===0){Aa=this.getZoneModelByZoneId(Ac);AU.zone=Ac;AV.push(this.getAddDropZoneUnitAction(Aa,AU,Aa.items.length));}if(!Ab&&AX>0){for(AW=0;AW<AX;AW++){Aa=this.getZoneModelByZoneId(Ad[AW].zoneId);AY=Ad[AW].itemIndex;AV=AV.concat(this.getRemoveDropZoneUnitActions(Aa,Aa.items[AY]));}}if(AV.length===0&&Ac!==O){if(AX>0){var AZ=false;var AT;for(AW=0;AW<AX;AW++){AT=Ad[AW].zoneId;if(AT===Ac){AZ=true;break;}}if(AZ===false){Aa=this.getZoneModelByZoneId(Ac);AU.zone=Ac;AV.push(this.getAddDropZoneUnitAction(Aa,AU,Aa.items.length));}}}return AV;},getClearDZUnitActions:function(AU,AT){var AV,AW,AX=AU.items,AZ=AX.length,AY=[];if(AT===undefined){AT=true;}for(AV=AZ-1;AV>=0;AV--){AW=AX[AV];if(this.isMetricName(AW)&&AT){continue;}AY=AY.concat(this.getRemoveDropZoneUnitActions(AU,AW));}return AY;},getClearDZMetricActions:function(AX,Aa,AZ){var AW,Ab,Ad=AX.items,AT=Ad.length,Ac=this.getZoneModelByZoneId(K),AY=Ac.items.length,AU=Ac.items.map(function(Ae){return Ae.did;}),AV=[];for(AW=AT-1;AW>=0;AW--){Ab=Ad[AW];if(!this.isMetric(Ab)){continue;}if(AU.indexOf(Ab.did)===-1){AZ.push(Ab.did);}AV.push(this.getAddDropZoneUnitAction(Ac,Ab,AY++,{isPrimary:Ab.ax===0}));AV=AV.concat(this.getRemoveDropZoneUnitActions(AX,Ab,Aa));}return AV;},removeMetricFromTooltips:function(AT){var AU,AV,AZ=this.getZoneModelByZoneId(K),AW=AZ.items,AY=AW.length,AX=[];for(AU=AY-1;AU>=0;AU--){AV=AW[AU];if(this.isMetric(AV)&&AT.indexOf(AV.did)>=0){AX=AX.concat(this.getRemoveDropZoneUnitActions(AZ,AV,1));}}return AX;},getSwapDZUnitActions:function(AX,AV,Ad){var AY,Ah,AZ=AX.items.slice(0),Af=AV.items.slice(0),Ag=AZ.length,Ae=Af.length,AW=[],Ab=[],Aa=[],Ac=[],AU,AT=this.isAttrCategoryZone(AX.id);AW=AW.concat(this.getClearDZMetricActions(AX,1,Ac));AW=AW.concat(this.getClearDZMetricActions(AV,1,Ac));for(AY=0;AY<Ag;AY++){Ah=AZ[AY];if(this.isMetric(Ah)){AU={isPrimary:Ah.ax===0};}else{AU={};}Ab.push(this.getAddDropZoneUnitAction(AV,Ah,AY,AU));}for(AY=0;AY<Ae;AY++){Ah=Af[AY];if(this.isMetric(Ah)){AU={isPrimary:Ah.ax===0};}else{AU={};}Aa.push(this.getAddDropZoneUnitAction(AX,Ah,AY,AU));}if(AT){AW=AW.concat(Ab);AW=AW.concat(Aa);}else{AW=AW.concat(Aa);AW=AW.concat(Ab);}AW=AW.concat(this.removeMetricFromTooltips(Ac));return AW;},getAddDropZoneUnitAction:function u(AY,Ab,AZ,AV){var Aa=l.call(this),AW=Aa.model,Ac=AW.data,AX=Aa.itemId2DsIdMap[Ab.did]||Ac.datasetId,AT,AU;AV=AV||{};AV.datasetId=AX;AV.datasetType=AX===X?d:h;if(this.isMetricName(Ab)){AZ=AY.items.length;}AU=this._super(AY,Ab,AZ,AV);if(AV.isPrimary===undefined||AV.isPrimary===true){AT=P.PRIMARY;}else{AT=P.SECONDARY;}if(AY.id===z||AY.id===a){Ab.ax=AT;AU.ax=AT;if(Ab.zone===z||Ab.zone===a){Ab.zone=AY.id;}}if(AY.items===undefined){return AU;}if(AZ<=AY.items.length){if(AY.id===I){r.forEach(AY.items,function(Ad){if(Ad.did===Ab.did&&Ad.hidden){Ab.hidden=true;}});}AY.items=AY.items.filter(function(Ad){return Ad.did!==Ab.did;});AY.items.splice(AZ,0,Ab);}return AU;},getRemoveDropZoneUnitActions:function E(AT,AU,AV){var AW=this._super(AT,AU,AV);if(AT.items===undefined){return AW;}AT.items=AT.items.filter(function(AX){return AX.did!==AU.did;});return AW;},moveAttributesToZone:function(AY,AU){var AV,AX,AT;var AZ=l.call(this),AW=AZ.getChartStyle()==="NewGraphMatrixVisualizationStyle";AV=AE.call(this,AY,1);AX=AA.call(this,AU,AV.removedItems);appendTooltip=AW?AA.call(this,9,AV.removedItems):{actions:[]};if(this.getZoneModelByZoneId(m)){AT=AC.call(this,m,AV.removedItems);return AV.actions.concat(AX.actions).concat(AT.actions).concat(appendTooltip.actions);}return AV.actions.concat(AX.actions).concat(appendTooltip.actions);},deleteItem:function(AU,AT,AW,AV){this.deleteItems([AU.items[AT]],AW,AV);},deleteItems:function(Ak,Au,An){var Az=l.call(this),Ae,At=Az.GMController,Af=At.getChartInfo(),Ac=[],Aa,Ap=R.clone(AI),AT={},Aq={},As,Ar,Ai,AY,Ad,AX,Aj=Az.getChartStyle()==="NewGraphMatrixVisualizationStyle",Aw=this;var Ag=function(BB,A6){Ae=BB.zone;if(f(Ae)&&Aw.isMetricName(BB)){var A7=At.dz.XAxis.TemplateMetric||[],BC=At.dz.YAxis.TemplateMetric||[];if(BB.cs&&(A7.length>1||BC.length>1)){Ac=Ac.concat(Aw.getUpdateMetricNameUnitActions(true,I));}return ;}var A8=Aw.getZoneModelByZoneId(Ae),A0=Aw.getZoneModelByZoneId(m),A2=Aw.getZoneModelByZoneId(I),A3=Aw.getZoneModelByZoneId(K),A4=Aw.hGetItemOccurrence(BB,[m]),A5=Aw.hGetItemOccurrence(BB,[z,a,m,I]);if(BB.cs&&BB.zone===e&&A4.length){Ac=Ac.concat(Aw.getRemoveDropZoneUnitActions(A8,BB));if(A6){Ac=Ac.concat(Aw.getAddDropZoneUnitAction(A0,BB,A0.items.length));Ac=Ac.concat(Aw.getAddDropZoneUnitAction(A2,BB,A2.items.length));}return ;}if(BB.cs&&BB.zone===U&&!A5.length){Ac=Ac.concat(Aw.getRemoveDropZoneUnitActions(A8,BB));Ac=Ac.concat(Aw.getAddDropZoneUnitAction(A3,BB,A3.items.length));return ;}Au=Au||c;Ai=Aw.getZoneModelByZoneId(v)!==undefined;AT[z]=Aw.isMetricZone(z);AT[a]=Aw.isMetricZone(a);Aq[z]=Aw.getMetricCntInZone(z);Aq[a]=Aw.getMetricCntInZone(a);if(Ai){AT[v]=Aw.isMetricZone(v);Aq[v]=Aw.getMetricCntInZone(v);}else{AT[v]=false;Aq[v]=0;}if(BB.t===4&&(Ae===z||Ae===a||Ae===v)){Aq[Ae]-=1;if(Aq[Ae]===0){AT[Ae]=false;}}if(!((AT[z]&&Aq[z]>Au)||(AT[a]&&Aq[a]>Au)||(AT[v]&&Aq[v]>Au))){As=Aw.hGetItemOccurrence(Ap);AX=As.length;for(Ar=0;Ar<AX;Ar++){Ad=Aw.getZoneModelByZoneId(As[Ar].zoneId);AY=As[Ar].itemIndex;Ac=Ac.concat(Aw.getRemoveDropZoneUnitActions(Ad,Ad.items[AY]));}}if(!(AT[z]&&Aq[z])&&!(AT[a]&&Aq[a])){if(!Aw.isZonesEmptyAfterDelItem(BB)){var A1=Aw.getZoneModelByZoneId(I);if(A1!==undefined){r.forEach(A1.items,function(BD){if(Aw.isMetricName(BD)){var BE=Aw.getZoneModelByZoneId(O);Ac.push(Aw.getAddDropZoneUnitAction(BE,Ap,BE.items.length));}Ac=Ac.concat(Aw.getRemoveDropZoneUnitActions(A1,BD));});}}}if(Aw.isMetricName(BB)&&BB.zone===m){var A9=Aw.hGetItemOccurrence(AI,[O,AH,z,a,I,e]);if(A9.length===0){if(Af.isPie){Ac=Ac.concat(Aw.getUpdateMetricNameUnitActions(true,e));}else{Ac=Ac.concat(Aw.getUpdateMetricNameUnitActions(true,I));}}}if(Aj&&Ae!==K){Ac=Ac.concat(Aw.removeFromTooltipDropZone(BB,Ae));}Ac=Ac.concat(Aw.getRemoveDropZoneUnitActions(A8,BB));if(Aw.isAttrCategory(BB)&&Ae===m){Aw.removeColorByItemFromBreakByIfExists(BB,Ac);}if(Af.isABL&&BB.t===4){Az.updateMetricShape(BB);var BA=At.hasGroupInfoStored();if(BA.existing){Aa=BA.gi;if((Af.dirc===AS.VERTICAL&&Ae===a)||(Af.dirc===AS.HORIZONTAL&&Ae===z)){Aa=Q(Aa,BB.did);}At.setGroupInfo(Aa);}}};var Am=Aw.getZoneModelByZoneId(I);Am=Am&&Am.items.length||0;r.forEach(Ak,function(A0){Ag(A0,An);});if(Aw.getZoneModelByZoneId(I)!==undefined){var Av=Aw.getZoneModelByZoneId(I).items.length;if(Av===0&&Am>0){Az.updateSubtype();}}if(Ac.length===0&&!Az.isXMLDirty()){return ;}var AW=this.docModel,Ao=AW.getDataService(),AV=Az.k,Ay=b(Az),Ah=Ao.getUpdateTemplateAction(AV,Ac),Al=Ah.partialRetrieval.nodes,AU=[Ah],Ax=AW.getSelectedViUnit(),Ab=Ax&&Ax.boxContent,AZ=!(Ab&&Ab.isInFilterPanel());Ah.partialRetrieval.nodes=Al.concat(AZ?this.docModel.getSourceFilterKeys(AV):[]);if(Az.isXMLDirty()){AU.push(Az.getPersistAction());}return AW&&AW.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:AU,zm:Aw,cmb:true},function(){AU=AW.wrapUnsetVisualizationFilterAction(AU);Az.controller.submitUndoRedoUpdates(AU,null,Ay);},function(){Az.controller.submitUndoRedoUpdates(AU,null,Ay);});},getHostModel:function(){return this.getHost().model.data;},replaceItemInGroupInfo:function(AT,Ab,AZ,Aa){var AY=AT.length,AV,AW,AX,AU;AW=AZ?0:1;for(AX=0;AX<AY;AX++){AV=AT[AX];AU=false;if(AV[AW]===Ab){AV[AW]=g;if(AV[1-AW]===g){AU=true;}}else{if(AV[1-AW]===Ab){AV[1-AW]=g;if(AV[AW]===g){AU=true;}}}if(AU){AT.splice(AX,1);AY=AT.length;AX-=1;}}for(AX=0;AX<AY;AX++){AV=AT[AX];if(AV[AW]===Aa){AV[AW]=Ab;break;}}return AT;},fillGroupInfo:function o(AU,AT,Ac,Aa){var AX,AV,AZ,AW=-1,Ab=-1,AY=AT.length;if(!AU.dndGM){for(AX=0;AX<AY;AX++){AV=AT[AX];if(AV[0]===Ac){AW=AX;}if(AV[1]===Ac){Ab=AX;}}if((Aa&&AW!==-1)||(!Aa&&Ab!==-1)){return AT;}if(Aa&&Ab!==-1){AZ=Ab;AV=AT[AZ];AV[1]=g;if(AV[0]===g){AV[0]=Ac;return AT;}}if(!Aa&&AW!==-1){AZ=AW;AV=AT[AZ];AV[0]=g;if(AV[1]===g){AV[1]=Ac;return AT;}}AT=AL(AT,Ac,Aa);}else{AT=F(AU,AT,Ac,Aa);}return AT;},removeFromTooltipDropZone:function t(AX,AT){var AW=this,AZ=AW.hGetItemOccurrence(AX),AY=[],Aa=AW.getZoneModelByZoneId(K);if(f(AT)){for(var AU=0;AU<AZ.length;AU++){var AV=AW.getZoneModelByZoneId(AZ[AU].zoneId);AY=AY.concat(AW.getRemoveDropZoneUnitActions(AV,AX));}}else{if(AZ.length===2){for(var AU=0;AU<AZ.length;AU++){if(AZ[AU].zoneId===K){AY=AY.concat(AW.getRemoveDropZoneUnitActions(Aa,AX));}}}}return AY;},getTooltipDropzoneIdx:function AR(AW){var AV=this,AT=AV.getZoneModelByZoneId(K),AX=this.isAttribute(AW),AY=AV.hGetItemOccurrence(AW);for(var AU=0;AU<AY.length;AU++){if(AY[AU].zoneId===K){return AY[AU].itemIndex;}}if(AX){return AT.items.filter(function(AZ){return AV.isAttribute(AZ);}).length;}else{return AT.items.length;}return index;},getHighlightTargets:function AQ(AY,AV,AX){if(!AY.items.length){return null;}var AU=true;AX.allowedItems.forEach(function(AZ){if(AZ.t===AY.items[AX.idx].t){AU=false;}});if(AU){var AW=[],AT;AY.items.forEach(function(Aa,AZ){AT=AZ+(AV||0);AW.push({idx:AT,edge:AX.edge});},this);return AW;}return null;},getUpdateGroupInfoActionForNewMetric:function(AT,AU,AZ){if(AU<=0){return null;}var AY=l.call(this),AX=AY.GMController,Aa,AV,AW;if(AX.shallWeUseGroupInfo){AV=AX.getGroupInfo();Aa=AX.getChartInfo();if(Aa.isABL&&((Aa.dirc===AS.VERTICAL&&AT===a)||(Aa.dirc===AS.HORIZONTAL&&AT===z))){AW="idx:"+AU;AV=this.fillGroupInfo({dndGM:false},AV,AW,AZ);AX.setGroupInfo(AV);if(AY.isXMLDirty()){return AY.getPersistAction();}}}return null;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.VisUtility","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.models._DropZoneCommon","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.util.ThresholdUtils");var O=mstrmojo.hash,M=mstrmojo.array,S=mstrmojo.func,U=mstrmojo.VisUtility,C=mstrmojo.chart.model.enums.EnumDSSObjectType,R=mstrmojo.vi.viz.EnumDSSDropZones,B=mstrmojo.vi.util.ThresholdUtils,F=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,G=mstrmojo.vi.ui.DatasetUnitMenuUtils,D=mstrmojo.vi.enums.EnumFeatures,A=R.FromItem,Y=R.ToItem,H=R.ColorBy,X=R.SizeBy,J=R.ItemSize,E=["#d2e0e8","#a4cbe6","#80add9","#558dcc","#2e78bb"];NETWORK_THRESHOLD_BANDS=[0.2,0.4,0.6,0.8];mstrmojo.vi.models.NetworkDropZones=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{scriptClass:"mstrmojo.vi.models.NetworkDropZones",help:"editor_panel_network.htm",getHostModel:function K(){return this.getHost().model.data;},getDropZones:function P(){var b=this.getDZFlatStruct(),a=function(c){return{allowSingle:true,title:c};},Z=[this.getZone(mstrmojo.desc(11910,"From Item"),A,b.from,false,a(mstrmojo.desc(13833))),this.getZone(mstrmojo.desc(11911,"To Item"),Y,b.to,false,a(mstrmojo.desc(13833))),this.getZone(mstrmojo.desc(11912,"Edge Color"),H,b.ColorBy,false,a(mstrmojo.desc(13829))),this.getZone(mstrmojo.desc(11913,"Edge Size"),X,b.SizeBy,false,a(mstrmojo.desc(13829))),this.getZone(mstrmojo.desc(4781,"Item Size"),J,b.itemsz,false,a(mstrmojo.desc(13829)))];this.dropZones=Z;return{n:this.getHost().defn.ttl,zones:Z};},getUnitMenuItems:function W(g,k,p,b){var m=this,f=this.id,q=this.isMetric(p),c=this.isAttribute(p),j=k.items,d=j.length,a={zone:k,idx:M.find(j,"id",p.id),cnt:d,item:p,useDropzone:true},h=mstrApp.isInVFConfigMode,o=this.docModel,n=p.did,l=mstrmojo.resolveFeature(D.INSERT_NEW_METRIC),Z=(p.t===47&&p.st===12033),e=G.getDatasetFromAttributeId(o.datasets,n);if(Z&&!h){g.addMenuItem(mstrmojo.desc(13296,"Edit Groups..."),"eg",this.getCreateOrEditElementGroupFunc(a));}if(q&&!h){if(p.um){g.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){m.editDerivedMetric(a,"edit");},a);g.addSeparator();}if(l){if(o.findDatasetIdFromUnit(n)&&!o.isFromSolrCube(n)&&!o.isFromMDXCube(n)){g.addSubMenuItem(mstrmojo.desc(11806,"Aggregate By"),"",f,m.getAggregateByMetricSubMenu,a);g.addSeparator();}g.addEditorMenuItem(mstrmojo.desc(5188,"Calculation"),f,m.getCalculationEditorCfg,a);g.addMenuItem(mstrmojo.desc(13624,"Create Metric..."),"",function(){m.newDerivedMetric(a);},a);}}else{if(c&&!h){if(!e||!o.isMDXDataset(e)){if(p.da){g.addMenuItem(mstrmojo.desc(3224,"Edit..."),"",function(){m.editDerivedAttribute(a);},a);g.addSeparator();}if(!U.isCGorCon(this.getHost(),p)&&!this.isDynamicLink(p)&&l){g.addMenuItem(mstrmojo.desc(13625,"Create Attribute..."),"",function(){m.newDerivedAttribute(a,!m.allowInsertNewAttribute(k));},a);}}if(!G.hasOldDEOverDatasets(n,this.docModel.datasets)&&!this.isRecursiveAttribute(p)){g.addMenuItem(mstrmojo.desc(13295,"Create Groups..."),"eg",this.getCreateOrEditElementGroupFunc(a));}}}g.addSeparator();if(this.showNumberFormat(p)){g.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),f,this.getNumberFormatEditorCfg,a);}if(q){if(k.id===H){this.buildThresholdMenuOptions(g,a,true);}}if(this.shouldShowDisplayFormsMenu(p)){g.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return m.getDisplayFormsMenu(p);});}g.addSeparator();if(m.hasReplaceCandidates(a)&&(!(mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||!!mstrmojo.resolveFeature(D.WEB_DRILL_AND_LINK))){g.addSubMenuItem(mstrmojo.desc(14003,"Replace With"),"",f,m.getReplaceSubMenu,a);}g.addMenuItem(mstrmojo.desc(1388,"Rename"),"",function(){m.renameItem(b,p);});g.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){m.deleteItem(k,m.getUnitIndexInZone(k,p));});},getAvatarIconClass:function I(){return"viNetwork";},getAllowDropInfo:function L(f,d,h,b,Z){var g=this,a=this._super(f,d,h,b,Z),j=f.items.length!==0&&b!==F.ON,e=[H,X,J].indexOf(f.id)!==-1,c=j?null:M.filterOne(a.allowedItems,function(l){var k=g.isMetric(l);return e?k:(!k&&l.t!==C.DssTypeDimension);});return O.copy({allowedItems:c?[c]:[]},a);},getAddItemActions:function(b,c,Z,d){var a=this.getAddDropZoneUnitsActions(b,c,Z,{datasetId:d});this.checkAndAddThresholdAction(b.id,c[0],a);return a;},checkAndAddThresholdAction:function Q(c,a,b){var Z=this.getHost();if(this.isMetric(a)&&c===H){B.addThresholds(Z.model,Z,Z.node,a,b,E,NETWORK_THRESHOLD_BANDS,false);return true;}return false;},unitsDropped:function V(h,a,k,l,Z){var d=a.actions||[],c=[],g,f=a.src.data,n=k.idx,b=k.edge,e=k.allowedItems,m,j=this;if(b===F.ON&&k.removeReplaced){c=c.concat(this.getRemoveDropZoneUnitActions(h,h.items[n]));}c=c.concat(this.getAddItemActions(h,e,this.getDropTargetIndex(h,k),f.dsid));g=d.concat(j.getUpdateTemplateAction(c));m=function(o){return function(){var p=o?j.docModel.wrapUnsetVisualizationFilterAction(g):g;j.submitDropZoneUpdates(p,S.wrapMethods(a.callback,j.getHost().model.docModel.controller._getXtabCallback(j.getHost())));};};this.checkAndWarnLargeItemsForAddUnits(e,function(){j.docModel.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:g,zm:j},m(true),m(false));});},deleteItem:function N(a,Z){var c=this,b=c.docModel,d=this.getRemoveDropZoneUnitActions(a,a.items[Z]);b&&b.checkAndNotifyVFChangeOnDZUnitsUpdate({ca:[a.id],zm:c},function(){c.submitDropZoneTemplateUpdates(d,{actions:b.wrapUnsetVisualizationFilterAction()});},function(){c.submitDropZoneTemplateUpdates(d);});}});}());(function(){mstrmojo.requiresCls("mstrmojo.OIVMDocSelectorViewFactory","mstrmojo.DocSelector","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.models.editors.FilterEditorModel","mstrmojo.vi.ui.rw.selectors._IsDocSelector","mstrmojo.vi.ui.rw.selectors._IsPageBySelector","mstrmojo.vi.ui.rw.selectors._IsFilterSelector","mstrmojo.vi.ui.rw.selectors._HasWarningMessage","mstrmojo._HasLayout");var C=mstrmojo.vi.models.VIComponentMap.TYPES;function D(G,E,F){return this.docBuilder.getLayoutVIMap(G.defn._lkz).isComponent(F,E);}mstrmojo.vi.ui.rw.selectors.DocSelectorViewFactory=mstrmojo.declare(mstrmojo.OIVMDocSelectorViewFactory,null,{scriptClass:"mstrmojo.vi.ui.rw.selectors.DocSelectorViewFactory",docBuilder:null,getDocSelectorClass:function A(I,J,H,L){var E=[mstrmojo._HasLayout,mstrmojo.vi.ui.rw.selectors._IsDocSelector,mstrmojo.vi.ui.rw.selectors._HasWarningMessage],G=L.pk,F=J.defn,K=this._super(I,J);if(D.call(this,J,G,C.PAGEBY_PANEL)){E.push(mstrmojo.vi.ui.rw.selectors._IsPageBySelector);}if(D.call(this,J,G,C.FILTER_PANEL)){E.push(mstrmojo.vi.ui.rw.selectors._IsFilterSelector);}return mstrmojo.DynamicClassFactory.newComponent(K,E,null);},newDocSelector:function B(G,H,F,J){var I=this.getDocSelectorClass(G,H,F,J),E=J.pk,K=new I({id:H.id,node:H,controller:G.controller,model:G,slot:this.docBuilder.defaultSlot});if(!D.call(this,H,E,C.PAGEBY_PANEL)&&!D.call(this,H,E,C.FILTER_PANEL)){K.edtModel=new mstrmojo.vi.models.editors.FilterEditorModel({hostId:K.id,docModel:G});K.addDisposable(K.edtModel);}if(H.defn&&H.defn.style===9){K.filterElemALL=true;}return K;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.gm.EnumGraphType","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.gm.EnumShape","mstrmojo.chart.model.enums.EnumDSSAxisName","mstrmojo.chart.model.enums.EnumDSSDynamicShortcut","mstrmojo.chart.model.enums.EnumDSSXMLAxesBitMap");mstrmojo.requiresClsP("mstrmojo.vi.models","DropZonesModel","GMDropZones","EnumDragSources");mstrmojo.requiresDescs(11710,11711,11712,11713,11714,11715);var v=mstrmojo,w=v.array,U=v.hash,AM=v.func,AU=v.vi,Q=v.chart.model.enums.EnumDSSObjectType,c=AU.models.DropZonesModel.ENUM_TARGET_POSITION,a=mstrmojo.vi.models.EnumDragSources,AP=c.ABOVE,z=c.ON,S=c.BELOW,h=1,b="00000000000000000000000000000000",j=0,AH={n:"Metric Names",did:b,t:j},q=false,AB=mstrmojo.gm.EnumShape,N=mstrmojo.gm.DualAxisSubAxisBit,V=N.PRIMARY,e=N.SECONDARY,AK=v.gm,AJ=AK.WidgetPropertyTag,m=mstrmojo.vi.enums.EnumFeatures,M=1,AG=2,AC=3,g=4,F=5,l=6,p=7,W=8,H=9,AA=10,R=11,f=12,o={1:4,4:1,2:3,3:2},Y=mstrmojo.chart.model.enums.EnumDSSXMLAxesBitMap,Z=mstrmojo.chart.model.enums.EnumDSSAxisName,E=mstrmojo.chart.model.enums.EnumDSSDynamicShortcut;function C(AV){return AV===g||AV===AC;}function AF(AX,Aa){var AW=Aa.getZoneModelByZoneId(p),Ad=Aa.getZoneModelByZoneId(l),Ac=Aa.getZoneModelByZoneId(F),Ag,Af,Ab,AV,AY=[],Ae=function(){return[Ad&&Ad.items,Ac&&Ac.items].every(function(Ah){for(Ab=0,AV=0;Ah&&Ab<Ah.length;Ab++){Ag=Ah[Ab];Af=w.find(AW.items,"did",Ag.did);if(Af!==-1&&Af<AV){return false;}AV=Af>AV?Af:AV;}return true;});},AZ=function(){[Ad,Ac].forEach(function(Ah){for(Ab=0;Ah&&Ah.items&&Ab<AW.items.length;Ab++){Ag=AW.items[Ab];Af=w.find(Ah.items,"did",Ag.did);if(Af!==-1){AY.push(Aa.getAddDropZoneUnitAction(Ah,Ag,Ah.items.length-1));}}});};if((AX===l||AX===F||AX===p)&&!Ae()){AZ();}return AY;}function AS(Ab,Ag,AX,Ae,AW){AX=(AX===undefined)?z:AX;var Aa=this.gmZones,AZ,AV,Ac,AY,Af,Ad=AX;switch(Ab.id){case R:case f:AV=Aa.getZoneModelByZoneId((Ab.id===f)?g:AC);AZ=Aa.getZoneModelByZoneId((Ab.id===f)?M:AG);if(AV.items.length===0&&AZ.items.length===0){if(AW){AY=AZ;Af=0;Ad=S;}else{AY=AV;Af=0;Ad=AP;}}else{Ac=AZ.items.length;if(Ag===Ac-1&&AX===S&&Ae){AY=AV;Af=0;Ad=AP;}else{if(Ag<Ac){AY=AZ;Af=Ag;}else{if(Ag===Ac&&AX===AP&&!Ae){AY=AZ;Af=(Ac>0)?(Ac-1):0;Ad=S;}else{AY=AV;Af=Ag-Ac;}}}}break;default:AY=Aa.getZoneModelByZoneId(Ab.id);Af=Ag;break;}return{zone:AY,idx:Af,edge:Ad};}function u(AX,AY,AW,Aa,Ab){var AZ=AS.call(this,AX,AW,Ab,this.isMetric(AY),this.isMetricName(AY));var AV=this.gmZones.isItemDropAllowed(AZ.zone,AY,AZ.idx,Aa,AZ.edge);if(q){window.console.log("isItemDrop: zone="+AX.id+",idx="+AW+",edge="+Ab+",xzone="+AZ.zone.id+",xidx="+AZ.idx+",xedge="+AZ.edge+",res="+AV);}return AV;}function K(){var AW=this,AV=[AC,g];return AV.some(function(AX){return AW.gmZones.isDualAxis(AX);});}function P(Aa,AZ,Ab){var AY,Ac,AV=[],AX=this;w.forEach(AZ,function(Ad){if(AX.isMetric(Ad)){AV.push(Ad);}});AY=Aa.readGlobalProperty(AJ.METRIC_SHAPES);Ac=AY.jsonObj[Ab.did];if(Ac!==undefined){Aa.updateMetricShape(Ab);for(var AW=0;AW<AV.length;AW++){AY=Aa.readGlobalProperty(AJ.METRIC_SHAPES);AY.setProperty(AV[AW].did,Ac);Aa.setWidgetPropertyValue(AJ.METRIC_SHAPES,AY.jsonObj);}}}mstrmojo.vi.models.CombineDropZonesModel=mstrmojo.declare(mstrmojo.vi.models.DropZonesModel,[mstrmojo.vi.models._DropZoneCommon],{scriptClass:"mstrmojo.vi.models.CombineDropZonesModel",help:"editor_panel_graph.htm",dropZones:[],gmZones:null,init:function AL(AV){this._super(AV);},getMetricCntInAxis:function d(AV){var AX=0,AW=this;w.forEach(AV.items,function(AY){if(AW.isMetric(AY)){AX++;}});return AX;},shouldMetricNameShowIcon:function AR(AZ,AW){var AY=this,AX=this.gmZones,Ab=AX.getHost(),Aa=Ab.GMController,AV=K.call(AY);if(AY.isMetricName(AZ)){if(!Aa.isPie){return false;}}return true;},addZoneItem:function s(AW,AX,AV){if(!AW.did){AW.did=AW.id;}this._super(AW,AX,AV);},getDropZones:function(){var Ag=this.gmZones,AW=Ag.getHostStructure(),Ad=Ag.getHost(),Aj=Ad.GMController,AZ=Ad.getChartInfo(),Ah=Ad.getChartStyle(),Af=Aj.isPie,Ak=Aj.isHistogram,AX=Aj.isBoxPlot,Ab=Aj.isWaterfall,Ae=(Aj.chartType===mstrmojo.gm.EnumGraphType.GRID&&!Aj.isEmptyVis()&&!Aj.isEmptyBreakby()),Ai=Aj.pureAreaChart||(AZ.tp===3&&Ah==="NewGraphMatrixVisualizationStyle"),Aa=this.getZone(mstrmojo.desc(12173,"Break By"),F,AW.BreakBy,Ae,{title:mstrmojo.desc(13828)}),AY=this.getZone(mstrmojo.desc(12090,"Size By"),W,AW.SizeBy,Ai,{allowSingle:!Aj.isBubbleOrScatter(),title:mstrmojo.desc(13829)}),Al=this.getZone(mstrmojo.desc(2962,"Tooltip"),H,AW.AdditionalMetrics,false,{title:mstrmojo.desc(13827)}),Ac=[this.getZone(mstrmojo.desc(14294,"Angle"),AA,AW.AngleBy,false,{title:mstrmojo.desc(13827)}),this.getZone(mstrmojo.desc(6188,"Slice"),l,AW.SliceBy,false,{title:mstrmojo.desc(13828)}),this.getZone(mstrmojo.desc(2069,"Vertical"),f,AW.Rows.concat(AW.YAxis),false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(3691,"Horizontal"),R,AW.Columns.concat(AW.XAxis),false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(11662,"Color By"),p,AW.ColorBy,false,{title:mstrmojo.desc(11668)}),Aa,AY,Al];if(!Af){Ac=Ac.slice(2);}else{Ac.splice(1,0,Ac.splice(4,1)[0]);}if(Ak){this.help="creating_histogram.htm";Ac=[this.getZone(mstrmojo.desc(517,"Metric"),g,AW.YAxis,false,{allowSingle:true,title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(11806,"Aggregate By"),AC,AW.XAxis,false,{title:mstrmojo.desc(11668)})];}else{if(AX){this.help="create_box_plot.htm";Ac=[this.getZone(mstrmojo.desc(2069,"Vertical"),f,AW.Rows.concat(AW.YAxis),false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(3691,"Horizontal"),R,AW.Columns.concat(AW.XAxis),false,{title:mstrmojo.desc(11668)}),Aa,this.getZone(mstrmojo.desc(11662,"Color By"),p,AW.ColorBy,false,{title:mstrmojo.desc(11668)})];}else{if(Ab){this.help="create_waterfall.htm";Ac=[this.getZone(mstrmojo.desc(2069,"Vertical"),f,AW.Rows.concat(AW.YAxis),false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(3691,"Horizontal"),R,AW.Columns.concat(AW.XAxis),false,{title:mstrmojo.desc(11668)}),Aa,Al];}}}this.dropZones=Ac;if(Ai){AY.items.forEach(function(Am){Am.hidden=true;});}if(Ae){Aa.items.forEach(function(Am){Am.hidden=true;});}var AV=Ag.getDropZones();AV.zones.forEach(function(Am){if(Am.id===F){Aa.siblings=Am.siblings;}});return{n:Ag.getHost().defn.ttl,zones:Ac};},getZone:function AE(Ac,Ab,Aa,AW,AY){var AV=this._super(Ac,Ab,Aa,AW,AY),AX=this.getHost(),AZ=AX.GMController;if(Ab===R||Ab===f){AV.cssClass=AV.cssClass+" mergedZone";}if(AZ.isHistogram){if(Ab===AC||Ab===g){AV.cssClass+=" hideIcz";}}return AV;},canSwapAxis:function AD(){var AV=this.getHost(),AW=AV.GMController;if(!AW.isHistogram){return this.gmZones.canSwapAxis();}else{return false;}},swapAxis:function A(){this.gmZones.swapAxis();},getClearAllUnitsActions:function O(){var AW=[],AV=this;w.forEach(AV.gmZones.getDropZones().zones,function(AX){w.forEach((AX&&AX.items)||[],function(AY){Array.prototype.push.apply(AW,AV.getRemoveDropZoneUnitActions(AX,AY));});});return AW;},getClearAllUnitsUnTemplateActions:function r(){var AY=[],AW=this,AV=this.getHost(),AX=AV.GMController;AX.removeGroupInfo();if(AV.isXMLDirty()){AY.push(AV.getPersistAction());}return AY;},getUnitMenuItems:function x(AY,Al,Ak,AX){if(!Ak){throw new Error(this.scriptClass+"::getUnitMenuItems: Item must be provided.");}var Aq=this,AW=Aq.gmZones,Af=(Ak.t===Q.DssTypeMetric&&!this.isMetricName(Ak)),An=(Ak.ax||V),AV=(An===V),Aa=AW.getZoneModelByZoneId((Al.id===f)?M:AG),Ac=AW.getZoneModelByZoneId((Al.id===f)?g:AC),Ao,Am=Aq.isMetricName(Ak),Ah=K.call(Aq),Ae=Aq.getHost(),Ag=Ae.GMController.isBubbleOrScatter(),Ai=Ae.GMController.isPie,Ap=Aq.getMetricCntInAxis(Al);if(Am){Ao=AW.getZoneModelByZoneId(Ak.zone);}else{var Ab=AS.call(this,Al,Ak._renderIdx);Ao=Ab.zone;}var Aj=Af?An:(Ao.id===Ac.id?V:e),Ad=function(Ar,As,Au){var At=Ar!==As,Av=C(Au.newZone.id);if(At){Aq.unitsDropped(Au.newZone,{src:{data:{src:a.VIZ_EDITOR}}},{idx:Av?0:Au.newZone.items.length,edge:Av?AP:S,allowedItems:[Ak]},Au.isPrimary);}return At;};if(Al.id===R){if(!(Af&&Ae.getChartStyle()==="NewGraphMatrixVisualizationStyle")&&(!Am||(Am&&Ai&&!Ah&&(Ag||(!Ag&&Ap<=0))))){AY.addRadioMenuGroup(Aj,Ad,[{value:e,text:Af?mstrmojo.desc(11710,"Top Axis"):mstrmojo.desc(11711,"Top Column"),newZone:Af?Ac:Aa,isPrimary:Af?!AV:true},{value:V,text:mstrmojo.desc(11712,"Bottom Axis"),newZone:Ac,isPrimary:true}],"checkMark");}}else{if(Al.id===f){var AZ=[];if(!(Af&&Ae.getChartStyle()==="NewGraphMatrixVisualizationStyle")&&(!Am||(Am&&Ai&&!Ah&&(Ag||(!Ag&&Ap<=0))))){if(!Af){AZ.push({value:e,text:mstrmojo.desc(11714,"Left Row"),newZone:Aa,isPrimary:true});}AZ.push({value:V,text:mstrmojo.desc(11715,"Left Axis"),newZone:Ac,isPrimary:true});}if(Af&&Ae.getChartStyle()!=="NewGraphMatrixVisualizationStyle"){AZ.push({value:e,text:mstrmojo.desc(11713,"Right Axis"),newZone:Ac,isPrimary:!AV});}AY.addRadioMenuGroup(Aj,Ad,AZ,"checkMark");}}if(!this.isMetricName(Ak)&&(Al.id===R||Al.id===f)){AY.addSeparator();}if(Ae.getChartStyle()==="NewGraphMatrixVisualizationStyle"){return Ae.interactor.getMenuConfig(Ae,{type:"title"},AY,{attributeAxis:!Af,identity:Ak,el:AX});}return this.gmZones.getUnitMenuItems(AY,Ao,Ak,AX);},getDynamicBreakByAxisOptions:function(AW){var AX=this.getHost(),AY=AX.GMController,AV=[];if(AY.getAttributesOnDropZone("Rows").length){AV.push({n:AW?mstrmojo.desc(3326,"By Columns"):mstrmojo.desc(122,"Columns"),axes_bitmap:Y.DssXmlAxisRowsBit,dmy:"@cols"});}if(AY.getAttributesOnDropZone("Columns").length){AV.push({n:AW?mstrmojo.desc(3327,"By Rows"):mstrmojo.desc(2968,"Rows"),axes_bitmap:Y.DssXmlAxisColumnsBit,dmy:"@rows"});}if(AY.getAttributesOnDropZone("Rows").length||AY.getAttributesOnDropZone("Columns").length){AV.push({n:AW?mstrmojo.desc(13283,"By Cell"):mstrmojo.desc(13399,"Cell"),axes_bitmap:Z.DssAxisDynamicShortcutRoot+E.DssDynamicShortcutCell,dmy:"@cell"});}if(AY.getAttributesOnDropZone("BreakBy").length){AV.push({n:AW?mstrmojo.desc(13284,"By Shape"):mstrmojo.desc(2923,"Shape"),axes_bitmap:Z.DssAxisDynamicShortcutRoot+E.DssDynamicShortcutShape,dmy:"@shape"});}return AV;},filterAllowItems:function X(Aa,AW,AY,AZ){var AX,AV;if(AY>0&&AZ>0){for(AX=Aa.length-1;AX>=0;AX--){AV=this.isMetric(Aa[AX]);if((AV&&AW)||(!AV&&!AW)){Aa.splice(AX,1);}}}if(Aa.length>1&&this.isMetric(Aa[0])){Aa.splice(1,Aa.length-1);}return Aa;},allowDropOnTarget:function AI(AV,AX){var AW=AS.call(this,this.getZoneModelByZoneId(AX.srcZoneId),AX.itemIdx),AY=U.copy(AX);AY.srcZoneId=AW.zone.id;AY.itemIdx=AW.idx;return this.gmZones.allowDropOnTarget(AV,AY);},getAllowDropInfo:function B(Al,AW,Ac,AX,AV){var Ak=this._super(Al,AW,Ac,AX,AV),Ab=Ak.allowedItems,Am=this,Aj,Ag=0,An=0,Ad=0,Ai={},Ah=AV.src.data.src,Ae=this.gmZones.getZoneModelByZoneId(AA)!==undefined;Ai[AC]=Am.gmZones.getMetricCntInZone(AC);Ai[g]=Am.gmZones.getMetricCntInZone(g);if(Ae){Ai[AA]=this.gmZones.getItemCountInZone(AA);}w.forEach(Ab,function(Ao){if(Am.isMetric(Ao)){An++;}else{if(Am.isMetricName(Ao)){Ad++;}else{Ag++;}}});if(An>0&&Ad>0&&Al.id!==Ah){var AY=Al;if(Al.id===f||Al.id===R){AY=this.gmZones.getZoneModelByZoneId((Al.id===f)?g:AC);if(Ah===AG||Ah===M){Ah=this.gmZones.getZoneModelByZoneId((Al.id===f)?AC:g);}}Ai[AY.id]+=An;Ai[Ah.id]-=An;w.forEach(Ab,function(Ap,Ao){if(Am.isMetricName(Ap)&&!(Ai[AC]>1||Ai[g]>1||Ai[AA]>1)){Ab.splice(Ao,1);}});}if(An>0&&Ag>0&&(Al.id===R||Al.id===f)){if(AX===c.ON){var Aa=Al.items[Ac];if(this.isMetricName(Aa)){Ak.allowedItems=[];}}return Ak;}else{if(Ab.length>1&&(An>=1||Ag>=1)&&Al.id===p){if(this.getItemCountInZone(p)===0){var AZ=(Ag+Ad>=An);Ab=this.filterAllowItems(Ab,AZ,An,Ag+Ad);return Ak;}var Af=this.isAttrCategory(Al.items[0])||this.isMetricName(Al.items[0]);Ab=this.filterAllowItems(Ab,Af,An,Ag+Ad);return Ak;}}for(Aj=Ab.length-1;Aj>=0;Aj--){if(!u.call(Am,Al,Ab[Aj],Ac,AV,AX)){Ab.splice(Aj,1);}}return Ak;},getAvatarIconClass:function k(){var AV=this.gmZones,AX=AV.getHost(),AY=AX.getChartInfo();if(AY.isCombo){return"viGMCombo";}if(AY.isPie){return"viGMPie";}if(AY.isBubbleOrScatter){return"viGMBubble";}if(AY.isABL){var AW=AY.shape;if(AW===AB.BAR){return"viGMBar";}if(AW===AB.LINE){return"viGMLine";}if(AW===AB.AREA){return"viGMArea";}return"viGMLine";}return"viGMCombo";},shouldAddMetricCount:function L(Aa,AW,AZ,AV){var AX=1,AY=this.gmZones.hGetItemOccurrence(AH,[F]);Aa.forEach(function(Ab){if(Ab.did===AW.did){AX=0;}});if(AZ===z&&AY.length&&Aa[AV].did===AW.did){AX=-1;}return AX;},processDualAxis:function J(Ab,Ag){var Ac=0,Ad=this,AW=Ad.gmZones.getZoneModelByZoneId(AC),AV=Ad.gmZones.getZoneModelByZoneId(g),AY=[],AZ,Af=Ab===AC?AW:AV,Ae=Af===AW?AV:AW,AX=Ab===AC?g:AC,Aa=Ad.gmZones.getMetricCntInZone(AX);if(Aa){w.forEach(Af.items,function(Ah){if(Ad.isMetric(Ah)&&Ah.id!==Ag.id&&Ah.ax!==Ag.ax){Ac=1;AY.push(Ad.gmZones.getAddDropZoneUnitAction(Af,Ah,Ah.idx,{isPrimary:Ag.ax===0?true:false}));}});}if(Ac!==1){AZ=Ad.gmZones.isDualAxis(AX);if(AZ){w.forEach(Ae.items,function(Ah){if(Ah.id!==Ag.id&&Ah.ax===1){AY.push(Ad.gmZones.getAddDropZoneUnitAction(Ae,Ah,Ah.idx,{isPrimary:true}));}});}}return AY;},getUnitDroppedActions:function I(At,AX,Ar,Af,Ab,Aj,Ap,AY){var Aw=this,AV=this.gmZones,Au=AS.call(this,At,Af,Ab,this.isMetric(Ar),this.isMetricName(Ar)),As=AX.src.data.src,Ae=[],AW=Aw.isMetric(Ar);if(AX&&(As===a.DATASETS||As===a.VIZ_EDITOR)&&!u.call(Aw,At,Ar,Af,AX,Ab)){return Ae;}if(q){window.console.log("unitDropped: zone="+At.id+", idx="+Af+", edge="+Ab+", xzone="+Au.zone.id+", xidx="+Au.idx+", xedge="+Au.edge);}if(!Ar.did){Ar.did=Ar.id;}if(At.id===f||At.id===R){var Ad=AV.getZoneModelByZoneId((At.id===f)?g:AC),Ac=AV.getZoneModelByZoneId((At.id===f)?M:AG),Ai=AV.isMetricZone(Ad.id),An=false,Am;if((Au.zone.id===Ad.id)&&Ad.id!==Ar.zone&&!Ai&&Ab!==z&&!this.isMetricName(Ar)){w.forEach(Ad.items,function(Ax){if(!Aw.isMetricName(Ax)&&Ax.did!==Ar.did){Am=Ax;return false;}});if(Am){Ae.push(AV.getAddDropZoneUnitAction(Ac,Am,Ac.items.length));Ad.items.splice(w.indexOf(Ad.items,Am),1);if(Au.idx){Au.idx--;}else{if(Au.idx===0&&Au.edge===S){Au.edge=AP;}}Ae.callback=AM.wrapMethods(AV.getUpdateCallback(),{failure:function(){Ac.items.pop();Ad.items=[Am].concat(Ad.items);}});}AX.metricNamesHandled=true;}if(AW){var Ao=AV.getZoneModelByZoneId(AA),Ag=false,AZ=0,Aa=Ac.id;if(Ao!==undefined){Ag=this.isMetricZone(AA);AZ=Ao.items.length;}var Av=0;w.forEach(Ad.items,function(Ax){if(Aw.isMetric(Ax)){Av++;}});var Al=Aw.shouldAddMetricCount(Ad.items,Ar,Au.edge,Au.idx);if(Av+(Al&&Ab!==z?1:0)>h){An=true;}if(AX.dndGM&&!Ap&&Ab!==c.ON){if(Ad.id===AC){Aa=g;}else{Aa=AC;}}var Ak=U.clone(AH),Aq=this.gmZones.hGetItemOccurrence(Ak,[M,AG,AC,g,p,F,l]);if(Aq.length===0){Ae=Ae.concat(AV.getUpdateMetricNameUnitActions(An,Aa));AX.metricNamesHandled=true;}else{AX.metricNamesHandled=false;}}}Ae=Ae.concat(AV.getUnitDroppedActions(Ar,Au.zone,AX,Au.idx,Au.edge,Aj,Ap,AY));if(AW&&(At.id===f||At.id===R)){var Ah=AV.getZoneModelByZoneId((At.id===f)?g:AC);if(Ah.id===AC){Ae=Ae.concat(Aw.processDualAxis(AC,Ar));}else{if(Ah.id===g){Ae=Ae.concat(Aw.processDualAxis(g,Ar));}}}if(AW&&AX.src.data.src===mstrmojo.vi.models.EnumDragSources.VIZ){if(At.id===AC){Ae=Ae.concat(Aw.processDualAxis(AC,Ar));}else{if(At.id===g){Ae=Ae.concat(Aw.processDualAxis(g,Ar));}}}return Ae;},unitsDropped:function AO(Ae,A9,Aq,AY,Ac,Ar){var At=this.gmZones,Aw=A9.actions||[],Az=[],AW,A8=Aq.idx,Ad=Aq.edge,Ap=Aq.allowedItems,Ai=this,A6,AZ=v.all[this.hostId],A0=false,A7,A2=K.call(this);if(Ae.id===f||Ae.id===R){if(this.isMetric(Ae.items[A8])&&AY===undefined){if(Ad===z){AY=(Ae.items[A8].ax===0);}else{if(Ap.length>0&&this.isMetric(Ap[0])&&Ap[0].ax!==undefined){AY=(Ap[0].ax===0);}}}}if(Ad===z&&this.isMetric(Ae.items[A8])){P.call(this,AZ,Ap,Ae.items[A8]);}if(Ap.length>1&&(Ae.id===R||Ae.id===f)){var Aj=[],A4=[];w.forEach(Ap,function(BA){if(Ai.isMetric(BA)){Aj.push(BA);}else{A4.push(BA);}});if(Aj.length>0&&A4.length>0){var As=AS.call(this,Ae,A8,Ad,false),Aa=As.zone,Am=At.getZoneModelByZoneId(o[Aa.id]),Ak=(Aa.id===AC||Aa.id===g)?Aj:A4,A3=(Am.id===AC||Am.id===g)?Aj:A4,Ag=function(BB,BA){return Ai.isAttrCategory(BB)&&Ai.isMetricName(BA.items[BA.items.length-1]);};A8=As.idx;Ad=As.edge;if(Ag(Ak[0],Aa)&&(A8>=Aa.items.length-1)){A8-=1;}Ak.forEach(function(BB,BA){A7=(BA!==0?S:Ad);AW=Ai.getUnitDroppedActions(Aa,A9,BB,A8,A7,true,Ac);A8+=(AW.length>0&&A7===S?1:0);Az=Az.concat(AW);});A8=Am.items.length-1;if(Ag(A3[0],Am,A8)){A8-=1;}A3.forEach(function(BA){AW=Ai.getUnitDroppedActions(Am,A9,BA,A8++,S,true,Ac);Az=Az.concat(AW);});A0=true;}}if(!A0){for(A6=0;A6<Ap.length;A6++){A7=(A6!==0?S:Ad);AW=Ai.getUnitDroppedActions(Ae,A9,Ap[A6],A8,A7,AY,Ac,Ar);A8+=(AW.length>0&&A7===S?1:0);Az=Az.concat(AW);}}var AV=K.call(this);var Ah=At.getZoneModelByZoneId(p);if(!A2&&AV&&Ah!==undefined&&Ah.items.length===0){Az=Az.concat(At.getUpdateMetricNameUnitActions(true,p));}var Ao=At.getZoneModelByZoneId(F);if(Ao!==undefined){var Al=Ao.items.length;if(Ae.id!==p&&Al>0){Ao.items.forEach(function(BA){if(w.find(Ap,"did",BA.did)>=0){Al--;}});if((!Ap||Ap&&(Ap.length===0||Ae.id!==F))&&Al===0){AZ.updateSubtype();}}}var AX=this.docModel,A5=AX.getDataService(),Ay=AZ.k,Ab=AM.wrapMethods({success:function(){AZ.resetXMLDirtyFlag();}},AZ.controller._getXtabCallback(AZ)),Ax=A5.getUpdateTemplateAction(Ay,Az),Au=Ax.partialRetrieval.nodes,Av=AX.getSelectedViUnit(),A1=Av&&Av.boxContent,Af=!(A1&&A1.isInFilterPanel());Ab=AM.wrapMethods(A9.callback,Ab);Ax.partialRetrieval.nodes=Au.concat(Af?AX.getSourceFilterKeys(Ay):[]);Aw.push(Ax);if(AZ.isXMLDirty()){Aw.push(AZ.getPersistAction());}var An=function(BA){return function(){var BB=BA?AX.wrapUnsetVisualizationFilterAction(Aw):Aw;Ai.checkAndWarnLargeItemsForAddUnits(Ap,function(){AZ.controller.submitUndoRedoUpdates(BB,null,Ab);});};};AX.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:Aw,zm:Ai},An(true),An(false));},getRemoveDZUnitAction:function AN(AW,AV){var AX=AS.call(this,AW,AV);return this.gmZones.getRemoveDZUnitAction(AX.zone,AX.idx);},getClearDZUnitActions:function AT(AW,AV){var AX=this.gmZones,AY=[];switch(AW.id){case R:AY.concat(AX.getClearDZUnitActions(AX.getZoneModelByZoneId(AG),AV));AY.concat(AX.getClearDZUnitActions(AX.getZoneModelByZoneId(AC),AV));break;case f:AY.concat(AX.getClearDZUnitActions(AX.getZoneModelByZoneId(M),AV));AY.concat(AX.getClearDZUnitActions(AX.getZoneModelByZoneId(g),AV));break;default:AY=AX.getClearDZUnitActions(AW,AV);break;}return AY;},getAddDZUnitAction:function(AW,AY,AV,AZ){var AX=this.gmZones;return AX.getAddDropZoneUnitAction(AW,AY,AV,{isPrimary:AZ});},moveAttributesToZone:function n(AW,AV){return this.gmZones.moveAttributesToZone(AW,AV);},deleteItem:function G(AW,AV){var AX=AS.call(this,AW,AV);this.gmZones.deleteItem(AX.zone,AX.idx,h-1);},deleteItems:function(AV,AW){this.gmZones.deleteItems(AW,h-1);},getHostModel:function(){return this.gmZones.getHostModel();},getMultiUnitsMenuItems:function t(AW,AV,AX){var AZ=this.id;if(!mstrApp.isInVFConfigMode&&mstrmojo.vi.ui.DatasetUnitMenuUtils.getMultiSelectionShortcutMetricFunctions(AX).length&&mstrmojo.resolveFeature(m.INSERT_NEW_METRIC)){var AY=AV;if(AV.id===f||AV.id===R){AY=this.gmZones.getZoneModelByZoneId((AV.id===f)?g:AC);}AW.addSubMenuItem(mstrmojo.desc(5188,"Calculation"),"",this.id,function(){return mstrmojo.all[AZ].getMultipleMetricsCalcMenus(AY,AX,true);});}AW.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[AZ].deleteItems(AV,AX);});},addUnitsFromDataSource:function D(AW,AX,AY,AV){this.gmZones.addUnitsFromDataSource(AW,AX,AY,AV);},getHighlightTargets:function AQ(AZ,Ad){var AV=AS.call(this,AZ,Ad.dzidx||Ad.idx,Ad.edge),Ab=AV.zone,AY=this.gmZones,AX=AY.getHost(),Af=AX.GMController,Aa,AW,Ac;if(!Af.isHistogram&&(Ab.id===AC||Ab.id===g)){AW=this.gmZones.getZoneModelByZoneId((AZ.id===f)?M:AG);Ac=AW.items.length;Aa=this.gmZones.getHighlightTargets(Ab,Ac,{allowedItems:Ad.allowedItems,idx:AV.idx,edge:AV.edge});}var Ae=(this.isAttrCategory(Ad.item)&&this.isMetric(AZ.items[Ad.idx]))||(this.isMetric(Ad.item)&&(this.isAttrCategory(AZ.items[Ad.idx])||this.isMetricName(AZ.items[Ad.idx])));if(AZ.id===p&&AZ.items.length&&Ae){Aa=[];AZ.items.forEach(function(Ah,Ag){Aa.push({idx:Ag,edge:Ad.edge});},this);return Aa;}if(!Aa){return this._super(AZ,Ad);}return Aa;},clearAllDropZones:function(AW){var AV=v.all[this.hostId];AV.updateSubtype();this._super(AW);}});mstrmojo.vi.models.CombineDropZonesModel.EnumDropZones={HORIZONTAL:R,VERTICAL:f};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.models.MapDropZones");var A=mstrmojo,D=A.array,B=A.vi.viz.EnumDSSDropZones;mstrmojo.vi.models.MapboxDropZones=mstrmojo.declare(mstrmojo.vi.models.MapDropZones,null,{help:"Editor_Panel_Geospatial_Service.htm",getZonesCfg:function C(){return D.filter(this._super(),function(E){return E.id!==B.SliceBy&&E.id!==B.Angle;});}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.TemplateBasedDropZones","mstrmojo.vi.models.EnumDragSources","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.array","mstrmojo.hash","mstrmojo.func");var I=mstrmojo.array,C=mstrmojo.hash,M="-1",P=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION;function O(){var Q=this.getHostModel();return Q?Q.gsi:null;}function L(Z,W,U,Y,Q){var a=this.getHost(),V=a.controller,S,X;S=Z.did;X=Z.t;if(Q){var R=this.getUnitIndexInZone(W,Z);if(R!==-1){if(R<Y){Y--;}}}V.submitUndoRedoUpdates(this.getUpdateTemplateAction([a.model.getPivotUnitAction(U,Y,S,X)]),null,mstrmojo.func.wrapMethods(V._getXtabCallback(a),this.getUpdateCallback()));}function J(U){var d=U.item,Y=U.zone,Q=U.dsid,b=U.index,R=U.edge,a=U.isPivot;var e=this.getHost(),X=e.controller,c=Y.items,W=e.model,S=Y.id,V=[];if(c.length){if(R===P.ON){var Z=c[b];V.push(W.getRemoveTemplateUnitAction(Z));}else{if(R===P.BELOW){b++;}}}else{b=0;}if(a&&R!==P.ON){L.call(this,d,Y,S,b,true);return ;}V.push(W.getAddTemplateUnitAction(d,Q,S,b));X.submitUndoRedoUpdates((U.actions||[]).concat(this.getUpdateTemplateAction(V)),null,mstrmojo.func.wrapMethods(X._getXtabCallback(e),this.getUpdateCallback()));}function K(Q){return Q.src.data.src===mstrmojo.vi.models.EnumDragSources.VIZ_EDITOR;}mstrmojo.vi.models.BaseVisDropZones=mstrmojo.declare(mstrmojo.vi.models.TemplateBasedDropZones,null,{scriptClass:"mstrmojo.vi.models.BaseVisDropZones",addZoneItem:function A(S,U,R){var V=R.mx,Q;if(S.did===M){I.forEach(V,function(W){Q={did:W.did,n:W.n,t:4};U.push(Q);});}else{this._super(S,U);}},getDropZones:function N(){var Q=O.call(this),R=this.getHost();return Q?{n:R.defn.ttl,zones:[this.getZone(mstrmojo.desc(3581,"Attributes"),1,Q.rows,false,{mx:Q.mx,title:mstrmojo.desc(13828)}),this.getZone(mstrmojo.desc(3582,"Metrics"),-1,Q.mx,false,{mx:Q.mx,title:mstrmojo.desc(13827)})]}:{n:R.defn.ttl,zones:[]};},getAvatarIconClass:function G(){return"viXtab";},getAllowDropInfo:function F(R,S,Q,V,U){var X=this._super(R,S,Q,V,U),W=R.id===-1;return C.copy({allowedItems:X.allowedItems.filter(function(Z){var Y=Z.t===4;return W?Y:!Y;})},X);},unitsDropped:function E(Q,S,U,W,V){var R=U.allowedItems[0];J.call(this,{item:R,zone:Q,dsid:S.src.data.dsid,index:U.idx,edge:U.edge,isPivot:K(S),actions:S.actions});},deleteItem:function B(R,Q){this.deleteItems(R,[R.items[Q]]);},deleteItems:function D(R,S){var U=this.getHost(),Q=U.controller,V=[];(S||[]).forEach(function(W){V.push(U.model.getRemoveTemplateUnitAction(W));});if(V.length){Q.submitUndoRedoUpdates(this.getUpdateTemplateAction(V),null,mstrmojo.func.wrapMethods(Q._getXtabCallback(U),this.getUpdateCallback()));}},getExtraUnitMenuItems:function H(R,Q,U,S){this._super(R,Q,U,S);if(U.t===mstrmojo.mstr.EnumDSSXMLObjectTypes.Metric&&this.getHost().showThreshold){R.addSeparator();this.buildThresholdMenuOptions(R,{item:U},true);}},getHostModel:function(){return this.getHost().model.data;}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.TemplateBasedDropZones","mstrmojo.vi.models.EnumDragSources","mstrmojo.express.ui.SubtotalsWidget","mstrmojo.array","mstrmojo.func","mstrmojo.hash","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.VisEnum");mstrmojo.requiresDescs(101,122,144,190,1018,2453,2968,3224,3573,3582,3647,5188,7974,7975,7976,7978,7979,8138,11099,11609,11610,11667,11806,11908,12193,12194);var d=mstrmojo.array,k=mstrmojo.vi.ui.DatasetUnitMenuUtils,V=mstrmojo.hash,P=mstrmojo.func.wrapMethods,O=-1,M=1,n=2,j="-1",a=[null,"rows","cols"],R=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION;mstrmojo.vi.models.XtabDropZonesMenuContextType=null;mstrmojo.vi.models.DropZonePivotItemType=null;function Z(){return mstrmojo.all[this.hostId];}function o(){return Z.call(this).gridInfo||{};}function h(u){var t=Z.call(this).model.docModel.getVIComponentKey(mstrmojo.vi.models.VIComponentMap.TYPES.PAGEBY_PANEL);if(t){u.forEach(function(x){var w=x.partialRetrieval=x.partialRetrieval||{},v=w.nodes=w.nodes||[];v.push(t);});}}function H(AE,AA,AC,x,u,z){var AD=Z.call(this),w,AB,t;if(AE.did!==j){w=AE.did;AB=AE.t;}if(u){var v=this.getUnitIndexInZone(AA,AE);if(v!==-1){z=x;t=v;if(v<AC){AC--;}}else{t=AE._renderIdx;}}return AD.model.getPivotUnitAction(x,AC,w,AB,z,t);}function D(v,t,w,u){var AD=Z.call(this),AA=[],AC=[],x=0,AB=this;if(w){AA=V.copy(w,AA);AC=V.copy(w,AC);}d.forEach(v.items,function(AF){AA.push(H.call(AB,AF,v.zone,v.idx+(x++),v.axis,t,v.originAxis));});if(v.axis===n){v.items.forEach(function(AG){var AF=AG.cardg>0?AG.cardg:AG.card;if(!AF||AF<=AB.CARDLIMIT){AC.push(H.call(AB,AG,v.zone,v.idx+(x++),v.axis,t,v.originAxis));}});}var z=function(){AD.controller.submitUndoRedoTemplateUpdates(AD,AA,AB.getUpdateCallback());},AE=function(){AD.controller.submitUndoRedoTemplateUpdates(AD,AC,AB.getUpdateCallback());};if(v.axis===n){this.checkAndWarnLargeItemsForAddUnits(v.items,z,AE,true,v.zone);}else{AB.checkAndWarnForOutlineAddUnits(v.items,v.axis,z,mstrmojo.emptyFn,u);}}function m(w){var z=Z.call(this),u=z?z.gridData.gts:undefined,x=u[w.axis===n?"col":"row"][w.idx],t=z.getBasicSubtotalEditorConfig(x.ast),v=this;t.fnOk=z.getOnSubtotalsChangeFn(t,x,v.getUpdateCallback());return t;}function N(v){var t=this.getDropZones().zones,u={};t.forEach(function(w){(w.items||[]).forEach(function(z,x){if(z.did===v.did){u.index=x;u.axis=w.id;}if(z.did===-1){u.metricAxis=w.id;}});});return u;}function F(v,x){var AA=[],u=[],z=o.call(this).mx,w=z.length-1,t;for(w;w>=0;w--){t=N.call(this,z[w]);AA.push(v.getRemoveTemplateUnitAction(V.copy(z[w],{axis:t.axis,unitPos:t.index+1})));if(u){u.push(v.getAddTemplateUnitAction(V.copy(z[w],{t:4}),x||this.docModel.findDatasetIdFromUnit(z[w]),t.metricAxis,t.index));}}u.reverse();return{actions:AA,undoActions:u};}function f(t){return t.src.data.src===mstrmojo.vi.models.EnumDragSources.VIZ_EDITOR;}function K(t){var u=o.call(this);[M,n].forEach(function(v){u[a[v]].forEach(function(x,w){t.call(this,v,x,w);},this);},this);}function X(){var v=Z.call(this),t=v.model,w=[],u;K.call(this,function(z,AA,x){if(AA.did===j){u=F.call(this,t);w=w.concat(u.actions);}else{AA.axis=z;AA.unitPos=x+1;w.push(t.getRemoveTemplateUnitAction(AA));}});v.controller.submitUndoRedoTemplateUpdates(v,w,this.getUpdateCallback());}function Y(v,u){var t=v.model,w=[];if(u.did===j){w=w.concat(F.call(this,t).actions);}else{w=[t.getRemoveTemplateUnitAction(u)];}return w;}function r(x,v,u,w,t){return[x.model.getAddTemplateUnitAction(v,w,u,t)];}mstrmojo.vi.models.XtabDropZones=mstrmojo.declare(mstrmojo.vi.models.TemplateBasedDropZones,null,{CARDLIMIT:mstrmojo.VisEnum.VIS_CARDLIMIT.GRID,getDropZones:function e(){var t=o.call(this);return{n:Z.call(this).defn.ttl,zones:[this.getZone(mstrmojo.desc(2968,"Rows"),M,t.rows,false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(122,"Columns"),n,t.cols,false,{title:mstrmojo.desc(11668)}),this.getZone(mstrmojo.desc(3582,"Metrics"),O,t.mx,false,{title:mstrmojo.desc(13827)})]};},getAvatarIconClass:function U(){return"viXtab";},canSwapAxis:function l(){return true;},swapAxis:function A(){var AC=Z.call(this),w=[],AA=[],v={},x={};this.getDropZones().zones.every(function(AD){x=(AD.id===M)?AD:null;return !x;});K.call(this,function(AD,AE){v[AD]=true;});K.call(this,function(AG,AH,AD){var AF=null,AK=AH.did===j,AJ=AG===M?n:M,AI=AC.model.getPivotUnitAction(AJ,AD,AK?"":AH.did,AK?"":AH.t,AG,AD);w.push(AI);if(AJ===n){x.items.every(function(AL){AF=(AL.did===AH.did)?AL:null;return !AF;});var AE=AF.cardg>0?AF.cardg:AF.card;if(!AE||AE<=this.CARDLIMIT){AA.push(AI);}}else{AA.push(AI);}});var z=this,u=function(){AC.controller.submitUndoRedoTemplateUpdates(AC,w,z.getUpdateCallback());},t=function(){AC.controller.submitUndoRedoTemplateUpdates(AC,AA,z.getUpdateCallback());};var AB=AC.model.getMoveSubTotalAction(undefined,undefined,AC.k,true);if(w.length){if(AB){w.push(AB);if(AA.length){AA.push(AB);}}this.checkAndWarnLargeItemsForAddUnits(x.items,u,t,true,x);return ;}u();},canDefineSubtotals:function E(){var u=this.getHostModel().gsi,t=u&&u.mx;return t&&t.length>0;},hasVisibleSubtotals:function c(){var t=this.getHostModel().gsi;return t&&t.hassb&&!t.hidesb;},showQuickSubtotals:function G(){var u=Z.call(this),v=this.getHostModel().gsi,t=u.model;if(v.hassb){if(v.hidesb){u.controller.submitUndoRedoTemplateUpdates(u,t.getShowDefinedSubtotalsAction());}return ;}u.controller.submitUndoRedoTemplateUpdates(u,this.getShowQuickTotalAction());},getShowQuickTotalAction:function s(){var w=Z.call(this),z=this.getHostModel().gsi,v=w.model;var x=[],u=z.tma===M?n:M;z[a[u]].forEach(function(AA){x.push(v.getShowTotalsUnitAction(AA.did,AA.t,[-10],[]));});var t=v.getMoveSubTotalAction(undefined,undefined,w.k);if(t){x.push(t);}return x;},hideDefinedSubtotals:function p(){var t=Z.call(this);t.controller.submitUndoRedoTemplateUpdates(t,{act:"hideDefinedSubtotals"});},clearAllSubtotals:function(){var t=Z.call(this);t.controller.submitUndoRedoTemplateUpdates(t,{act:"clearAllSubtotals"});},getExtraUnitMenuItems:function W(u,t,x,w){var v=this,z=this.id;u.addSeparator();if(this.showNumberFormat(x)){u.addEditorMenuItem(mstrmojo.desc(13237,"Number Format"),z,this.getNumberFormatEditorCfg,w);}this.buildThresholdMenuOptions(u,w,false);if(x.t===12||x.t===14||(x.t===47&&x.st===12033)){u.addEditorMenuItem(mstrmojo.desc(6193,"Show Totals"),z,m,w);}else{if(x.t===4){u.addToggleMenuItem(mstrmojo.desc(6193,"Show Totals"),"",function(){this.showQuickSubtotals();},function(){this.hideDefinedSubtotals();},z,this.hasVisibleSubtotals());}}if(this.shouldShowDisplayFormsMenu(x)){u.addEditorMenuItem(mstrmojo.desc(11908,"Display Attribute Forms"),this.id,function(){return v.getDisplayFormsMenu(x);});}},getMultiUnitsMenuItems:function b(u,t,v){var z=this.id,w=t.id;if(w!==O){var x=(w===M)?mstrmojo.desc(13262,"Move to Column Header"):mstrmojo.desc(13263,"Move to Row Header");u.addMenuItem(x,"xt",function(){D.call(mstrmojo.all[z],{items:v,zone:t,axis:w===M?n:M,idx:0},false);});u.addSeparator();}this._super(u,t,v);},getAllowDropInfo:function C(z,w,AC,v,t){var u=this._super(z,w,AC,v,t),x=z.id===O,AA=this,AB=o.call(AA);return V.copy({allowedItems:u.allowedItems.filter(function(AF){var AD=AA.docModel,AE=AA.getHost().model;if(AF.t===4){if(AF.did===j){if(x){return false;}}else{if(!x&&AB.mx&&AB.mx.length){return false;}}}else{if(x){return false;}else{if(AE.hasSameRecursiveAttributeGroup(AF)){return false;}}}return true;})},u);},getHostModel:function B(){return this.getHost().gridData;},unitsDropped:function q(AO,w,AD){var AQ=this.getHost(),z=AQ.model,AL=AD.allowedItems,AB=w.getCtxtDragData&&w.getCtxtDragData().dsid,AH=AD.idx,AA=AD.edge,AF=[],AI=[],v=AO.id,AE=[],AG=AO.items;if(AG.length){if(AA===R.ON&&AD.removeReplaced){var AN=AG[AH];AE=[AN];if(AN.did===j){AF=AF.concat(F.call(this,z,AB).actions);}else{AN.axis=v;AN.unitPos=AH+1;AF.push(z.getRemoveTemplateUnitAction(AN));}}else{if(AA===R.BELOW){AH++;}}}else{AH=0;}if(f(w)){D.call(this,{items:AL,zone:AO,axis:v,idx:AH,originAxis:w.src.data.srcZoneId},true,AF,AE);return ;}var x=false,AC=[];AL.reverse().forEach(function(AU){var AS=this.isMetric(AU),AV=AS&&AO.id!==O&&x,AR=AV?O:AO.id,AX=AV?0:AH,AT=AV?O:(AO.id===1?n:M),AW=-1;AI=AF.concat(r.call(this,AQ,AU,AT,AB,AW));AF=AF.concat(r.call(this,AQ,AU,AR,AB,AX));if(AS){AC.push(AU);}x=x||AS;},this);if(x){AF.push(AQ.model.getValuesDefaultFormatGridZoneAction(AC,true));}var AM=z.docModel,AK=AM.controller,AP=this,t=function(){AK.submitUndoRedoUpdates(AF,null,P(w.callback,AK._getXtabCallback(AQ),{success:function(AR){AM.partialUpdate(AR.data,AM.getUnitDefinitions(AQ.k));}},AP.getUpdateCallback()));},u=function(){AK.submitUndoRedoUpdates(AI,null,P(w.callback,AK._getXtabCallback(AQ),{success:function(AR){AM.partialUpdate(AR.data,AM.getUnitDefinitions(AQ.k));}},AP.getUpdateCallback()));};AF=(w.actions||[]).concat(this.getUpdateTemplateAction(AF));AI=(w.actions||[]).concat(this.getUpdateTemplateAction(AI));h.call(this,AF);h.call(this,AI);var AJ=function(AR){return function(){if(AR){AF=AP.docModel.wrapUnsetVisualizationFilterAction(AF);AI=AP.docModel.wrapUnsetVisualizationFilterAction(AI);}if(v===n){AP.checkAndWarnLargeItemsForAddUnits(AL,t,u,true,AO);}else{AP.checkAndWarnForOutlineAddUnits(AL,v,t,mstrmojo.emptyFn,AE);}};};this.docModel.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:AF,zm:AP},AJ(true),AJ(false));},deleteItem:function J(u,t){this.changeZoneUnits(u,[u.items[t]]);},deleteItems:function I(t,u){this.changeZoneUnits(t,u);},changeZoneUnits:function g(u,t,x){var v=this,w=Z.call(this),z=[];t=t||[];x=x||[];x.forEach(function(AA){z=z.concat(r.call(this,w,AA,u.id,AA.dsId,u.items.length-t.length));},this);t.forEach(function(AA){AA.axis=u.id;AA.unitPos=this.getUnitIndexInZone(u,AA)+1;z=z.concat(Y.call(this,w,AA));},this);h.call(this,z);this.docModel.checkAndNotifyVFChangeOnDZUnitsUpdate({actions:z,zm:v},function(){var AB=w,AA=AB.controller,AC=AA&&AA.dataService();z=v.docModel.wrapUnsetVisualizationFilterAction(AC.getUpdateTemplateAction(AB.k,z));AB.controller.submitUndoRedoTemplateWithCallback(AB,z,v.getUpdateCallback());},function(){w.controller.submitUndoRedoTemplateUpdates(w,z,v.getUpdateCallback());});},getZoneAddCandidates:function S(t){return this.docModel.getDatasetUnits(t.id===-1?["mx"]:["att"]);},clearAllUnits:function L(){X.call(this);},canSupportImageThreshold:function Q(){return true;}});}());(function(){mstrmojo.requiresCls("mstrmojo.DocModel","mstrmojo.func","mstrmojo.array","mstrmojo.expr","mstrmojo.hash","mstrmojo.num","mstrmojo.string","mstrmojo.elementHelper","mstrmojo.EnumRWUnitType","mstrmojo.boxmodel","mstrmojo.models.FormatModel","mstrmojo.DocDataService","mstrmojo.mstr.EnumDataType","mstrmojo.DI.DIConstants","mstrmojo.vi.models._LayoutActions","mstrmojo.vi.models._PanelActions","mstrmojo.vi.models._FilterStackActions","mstrmojo.vi.models._VisActions","mstrmojo.vi.models._FieldActions","mstrmojo.vi.models._DataGridActions","mstrmojo.vi.models._IsNLPModel","mstrmojo.vi.models._NotificationVisFilter","mstrmojo.vi.controllers.EnumEvents","mstrmojo.Button","mstrmojo.mstr.EnumWebAPIErrorCodes","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.DocSelector","mstrmojo.vi.enums.EnumFeatures","mstrmojo.ME.MetricDataService","mstrmojo.vi.viz.EnumVizStyles");mstrmojo.requiresClsP("mstrmojo.vi.models","PanelFormatSaver","EnumPanelTypes","VIComponentMap");mstrmojo.requiresClsP("mstrmojo.vi.ui","DatasetObjects","DocDatasetObjects","DatasetUnitMenuUtils");var a=mstrmojo,AD=a.func,CX=a.array,BM=a.boxmodel,Av=a.hash,C=a.num,BA=a.string,Ch=a.elementHelper,CJ=a.mstr.EnumWebAPIErrorCodes,CW=a.vi.ui.DatasetUnitMenuUtils,AV=a.expr,AQ=AV.ET,AO=AV.FN,x=mstrmojo.models.FormatModel,CI=x.getFormatUpdate,Az=x.ENUM_PROPERTY_NAMES,CH=a.EnumRWUnitType,Ad=mstrmojo.DocSelector.STYLES,Cx=mstrmojo.mstr.EnumDSSXMLBaseFormType,Ct=a.mstr.EnumDataType,R="\u001E",AF=a.vi.models,Cm=AF.EnumPanelTypes,BC=mstrmojo.vi.models.VIComponentMap.TYPES,K=BC.MAIN_CONTENT,B9=BC.VIZ_CONTENT,Cn=BC.PAGEBY_PANEL,H=[B9],Cu=mstrmojo.DI.DIConstants,BT=Cu.xdaType,Y=Cu.backendSourceSubtype,F=Cu.datasetServeMode,AM=Cu.dbType,CF=mstrmojo.vi.controllers.EnumEvents,CQ=mstrmojo.DocSelector.STYLES,Ar=mstrmojo.vi.enums.EnumFeatures,CV=mstrmojo.mstr.EnumNodeProperties,S=mstrmojo.ME.MetricDataService,AR=mstrmojo.vi.viz.EnumVizStyles;var c=12,N=4,O="$";var CP=3076;var BD=2;var CG=8;var Bv=mstrmojo.DocModel.fnBuildId;mstrmojo.vi.models.DatasetInfoType=null;mstrmojo.vi.models.DEObjectType=null;function n(C1){return mstrmojo.resolveFeature(C1);}function Ba(C1,C2){return(C1===47&&C2!==12033)||C1===1;}function AE(C2){var C4=this.controller.view.getLayouts(),C1=C4.length,C3;for(C3=0;C3<C1;C3++){this.data.layouts[C3].loaded=false;if(C2){C4[C3].defn.loaded=false;}}}function BK(C2,C3){if(!C3){return false;}var C1=false;C2=C2||this.datasets;Av.forEach(C2,function(C4){if(C3(C4)){C1=true;return false;}},this);return C1;}function Ah(C1){this.raiseEvent({name:"updateHasUnpublishedCube",hasUnpublishedCube:C1});}function Ax(){this.raiseEvent({name:"updateDatasets",datasets:this.datasets,datasetsSettings:this.datasetsSettings});}function BX(){var C1=this.unpublishedCubes;Av.forEach(this.datasets,function(C2,C3){CX.forEach(C1,function(C4){if(C4.did===C3){C2.unpublished=!C4.published;return false;}});});}function CC(){var C4=Object.keys(this.datasets),C2=CX.filter(this.unpublishedCubes,function(C6){return CX.indexOf(C4,C6.did)>-1;}),C1=CX.map(C2,function(C6){if(!C6.published){return C6.did;}}),C3=this,C5={success:function(C6){C3.setUserDICubeInfo(C6);},complete:function(){BX.call(C3);Ax.call(C3);}};if(C1.length>0){this.getDataService().getUserDICubeInfo(C1,C5);return true;}return false;}function Bc(C1,C3,C2,C4){CI(Az.HEIGHT,mstrmojo.boxmodel.px2Inches(this.getZoomProps(),this.getCtrlHeightByStyle(C3,C2&&(C4?C2+1:C2)||((C3===CQ.RADIO||C3===CQ.CHECKBOX)?CG:0)+(C4?1:0))),C1);}function Cv(C3,C1,C9,C8,C6,C5,DD){C8=C8||this.currlaykey;var C7=this;var DA=this.defn.layouts.filter(function(DE){return DE.k===C8;})[0],C4=C9===C8?DA:DA.units[C9],C2=function C2(DE){return x.getFormatUpdate(C5,DE);},DB={k:C9,defn:C4},DC;if(C6){DD=AD.wrapMethods({success:function(DG){var DF=C7.getLayoutDefn(C8),DE=C9===C8?DF:C7.getLayoutUnitDefn(C9,C8);DE[C6]=DG;}},DD);}if(C9===C8||(C4&&C4.t)===CH.PANEL){DD=AD.wrapMethods(DD,{success:function(){C7.raiseEvent({name:CF.UPDATE_TOC});},failure:function(){C7.raiseEvent({name:CF.UPDATE_TOC});}});}DC=DD.success;DD.success=function(DE){DC(x.getValueFromUpdate(C5,DE)||C3);};this.updateUnitFormatWithUndo(DB,1,C2(C3),C2(C1),DD);}var Cw=mstrmojo.DocDataService.REQUEST_DEFN_DATA;var Cp=mstrmojo.DocDataService.REQUEST_ONLY_DATASETS;function P(C3,C1,C2,C5,C4){C5=C5||this.getNextKey();C4=C4||this.getCurrentLayoutKey();var C7={k:C5,wid:1},C6={k:C5,id:this.getWidgetId(C7,C4),defn:{fmts:{top:"0px",left:"0px",height:"100px",width:"100px"},_lkz:C4},data:C7};if(C3){C6.data=C3(C7,C6);}if(C1){C6.defn=C1(C6.defn,C6);}if(C2){C6=C2(C6);}return C6;}function B0(C1){var C2=this.controller.view.getLayouts();C2.forEach(function(C3){if(C3.k===C1){C3.defn.loaded=false;}});this.data.layouts.forEach(function(C3){if(C3.k===C1){C3.loaded=false;}});}function t(C4,C6,C3){var C1=this.controller,C2=C1.view.builder;C3=C3||this.getLayoutKeyByUnitKey(C6);var C5=this.getPanel(C6,C3);C6=C5.k;return C2.build([C4],this,{pk:C6})[0];}function BG(C3){var C1=this.getVIPanelKeyFromUnits(C3),C2=this.getTargetDefn(C1)[C1];return this.getUnitFormatAction({defn:C2,k:C1},1,{FormattingAppearance:{Visible:1}});}function v(C1,C9,C4,C7){var C5=this.getVIPanelKeyFromUnits(C1),C8=this.getTargetDefn(C5),C2=C4.data;var C6=this.getCurrentLayoutKey(),C3=Av.walk(C9,C2.layouts.filter(function(DA){return DA.k===C6;})[0]);this.updateDataCache(C2,C8);C7.build(this.getChildren({data:C3,defn:C8[C5],id:this.getWidgetId(C3),k:C5}).filter(function(DA){return DA.k===C5;}),this);}function BQ(C5,C2,C1,C4){var C3=this.id;this.getDataService().submitUpdates(BG.call(this,C5),{success:function(C6){v.call(mstrmojo.all[C3],C5,C2,C6,C1);C4();}},{preserveUndo:true});}function AW(C1,C2){return"1"+R+C1+R+C2;}function Ce(C1){var C2=C1.split(R);return{nodeKey:C2[1],ctrlKey:C2[2]};}function Bp(C3,C6,C1,C5){C5=C5||{};var C2=this,C7=(C3&&this.extractChildren(C3))||[],C4;C7.forEach(function(C8){C4=C8.k;C1=C1||C6.hasOwnProperty(C4);if(C1){C5[C4]=true;}Bp.call(C2,C8,C6,C1,C5);});return C5;}function l(C1){Av.forEach(C1,function(C2){C2.att=CW.getSortedDatasetUnits(C2.att);C2.mx=CW.getSortedDatasetUnits(C2.mx);if(C2.tables&&!this.isMDXDataset(C2)){C2.tables.forEach(function(C3){C3.att=CW.getSortedDatasetUnits(C3.att);C3.mx=CW.getSortedDatasetUnits(C3.mx);});}},this);}function Cy(C2){var C1=this;if(typeof C2==="string"){if(C2.indexOf("{")===0){C2=JSON.parse(C2);}}C2=Av.copy({dataset:function(C7){var C6=function(C9,C8){C9.getCollapsed=function(){return this.isCollapsed===undefined?C8.isCollapsed:this.isCollapsed;};};var C5=function(DB,DA,C8){this[DB]=this[DB]||{};var C9=this[DB][DA]=this[DB][DA]||{};C6(C9,C8);return C9;};var C4=function(){return C1.datasets[C7];};if(!C4()){return null;}var C3=C5.call(this,"datasets",C7,{isCollapsed:false});C3.hasCollapsedChildNodes=function(DA,C9){var C8=false,DB=this;Av.forEach(C4().tableMap,function(DD,DC){var DE=DB.table(DC);if(DE.getCollapsed()===DA||(C9&&DE.hasCollapsedChildNodes(DA,C9))){C8=true;return false;}});return C8;};if(!C3.table){C3.table=function(DC){var DA=function(){return C4().tableMap[DC];};if(!DA()){return null;}var DB=C5.call(this,"tables",DC,{isCollapsed:false});DB.hasCollapsedChildNodes=function(){return false;};if(C1.isMDXTable(DA())){DB.hasCollapsedChildNodes=function(DG,DF){var DE=false,DH=this;Av.forEach(DA().dimensionMap,function(DL,DJ){var DK=DH.dimension(DJ);if(DK.getCollapsed()===DG||(DF&&DK.hasCollapsedChildNodes(DG,DF))){DE=true;return false;}});if(DE){return DE;}var DI=DH.rootMetricFolder;if(DI.getCollapsed()===DG||(DF&&DI.hasCollapsedChildNodes(DG,DF))){DE=true;}return DE;};if(!DB.dimension){DB.dimension=function(DE){var DG=function(){return DA().dimensionMap[DE];};if(!DG()){return null;}var DF=C5.call(this,"dimensions",DE,{isCollapsed:true});DF.hasCollapsedChildNodes=function(DI){var DH=false,DJ=this;Av.forEach(DG().hierarchyMap,function(DK,DL){var DM=DJ.hierarchy(DL);if(DM.getCollapsed()===DI){DH=true;return false;}});return DH;};if(!DF.hierarchy){DF.hierarchy=function(DI){var DH=function(){var DJ=DG().hierarchyMap;return DJ&&DJ[DI];};if(!DH()){return null;}return C5.call(this,"hierarchies",DI,{isCollapsed:true});};}return DF;};}var C9=function(DF,DE){if(!DF.hasCollapsedChildNodes){DF.hasCollapsedChildNodes=function(DI,DH){var DJ=this,DG=false;Av.forEach(DE().folderMap,function(DM,DL){var DK=DJ.folder(DL);if(DK.getCollapsed()===DI||(DH&&DK.hasCollapsedChildNodes(DI,DH))){DG=true;return false;}});return DG;};}if(!DF.folder){DF.folder=function(DH){var DG=function(){return DE().folderMap[DH];};if(!DG()){return null;}var DI=C5.call(this,"folders",DH,{isCollapsed:true});C9(DI,DG);return DI;};}};var C8=function(){return DA().metricFolder;},DD=DB.rootMetricFolder=DB.rootMetricFolder||{};C6(DD,{isCollapsed:false});C9(DD,C8);}return DB;};}return C3;},getSaveActions:function(){var C3=this;Av.forEach(this.datasets,function(C5,C6){var C7=C1.datasets[C6];if(!C7){delete C3.datasets[C6];return ;}if(!C7.tables){delete C5.tables;return ;}Av.forEach(C5.tables,function(DA,C9){var DB=C7.tableMap[C9];if(!DB){delete C5.tables[C6];return ;}if(C1.isMDXTable(DB)){var C8=function(DC,DD){Av.forEach(DC.folders,function(DE,DF){if(!DD.folderMap[DF]){delete DC.folders[DF];return ;}C8(DE,DD.folderMap[DF]);});if(Av.isEmpty(DC.folders)){delete DC.folders;}};Av.forEach(DA.dimensions,function(DE,DD){var DC=DB.dimensionMap[DD];if(!DC){delete DA.dimensions[DD];return ;}Av.forEach(DE.hierarchies,function(DH,DF){var DG=DC.hierarchyMap[DF];if(!DG){delete DE.hierarchies[DF];}});if(Av.isEmpty(DE.hierarchies)){delete DE.hierarchies;}});if(Av.isEmpty(DA.dimensions)){delete DA.dimensions;}C8(DA.rootMetricFolder,DB.metricFolder);delete DA.metricFolders;}});});var C4=JSON.stringify(this);return[C1.getUnitFormatAction(C1.getRootNode(),1,{FormattingAnalysis:{DatasetsSettings:C4}})];},save:function(){C1.execute({execute:function(){this.submit(C2.getSaveActions(),{},mstrmojo.DocDataService.RAPID_EXEC);},urInfo:{callback:C1.getDatasetsUpdateCallback()}});},unitOpr:function(C6,C7,C3){var C5,C4;this.units=this.units||{};this.units[C6]=this.units[C6]||{};C5=this.units[C6];if(C3!==undefined){if(C3){C4=C5[C7]=C3;}else{delete C5[C7];if(Av.isEmpty(C5)){delete this.units[C6];}}}else{C4=C5[C7];}return C4;}},C2);return C2;}function Bg(C1,C2){this.datasetsSettings=Cy.call(this,C2);Av.forEach(C1,function(C5,C7){C5.did=C7;if(C5.tables){var C4=function(C8){return function(C9){return C8.filter(function(DA){return DA.did===C9.did;})[0]||null;};},C3=C4(C5.att),C6=C4(C5.mx);C5.tableMap={};C5.tables.forEach(function(C9){C5.tableMap[C9.did]=C9;if(this.isMDXTable(C9)){var C8=function(DA){DA.folderMap={};DA.mxRefs=DA.mxRefs||[];DA.folders=DA.folders||[];DA.mx=(DA.mxRefs||[]).map(C6);DA.folders.forEach(function(DB){DA.folderMap[DB.n]=DB;C8(DB);});};C9.dimensionMap={};if(this.isRADataset(C5)){C9.dimensions.forEach(function(DA){C9.dimensionMap[DA.did]=DA;DA.recursiveAtt=[];(DA.hierarchies||[]).forEach(function(DC){var DB=C3(DC);if(DB){DA.recursiveAtt.push(DB);}});});}else{C9.dimensions.forEach(function(DA){C9.dimensionMap[DA.did]=DA;DA.hierarchyMap={};(DA.hierarchies||[]).forEach(function(DB){DA.hierarchyMap[DB.did]=DB;DB.att=(DB.attRefs||[]).map(C3);});});}C9.metricFolder=C9.metricFolder||{};C8(C9.metricFolder);}else{C9.attRefs=C9.attRefs||[];C9.att=(C9.attRefs||[]).map(C3);C9.mxRefs=C9.mxRefs||[];C9.mx=(C9.mxRefs||[]).map(C6);}},this);}},this);delete this.deMap;l.call(this,C1);this.set("datasets",C1);}function M(C1,C2){Av.forEach(C2,function(C6,C5){var C3=C1[C5],C4=C3&&C3.att.concat(C3.mx),C7=C6.att.concat(C6.mx);if(C4){CX.forEach(C7,function(C9){var C8=CX.find(C4,"did",C9.did);if(C8<0){C9.ne=true;}if(C9.t===47&&C9.st===12033){var DA=C8<0?null:C4[C8];CX.forEach(C9.des,function(DB){if(!DA||CX.find(DA.des,"id",DB.id)<0){DB.ne=true;}});}});}});}function BF(C2,C4){var C1=this.getVIComponent(Cn),C3=C1.id,C5=[C1.k];if(C2){C5.push(this.getVIComponentKey(K));}return function(C7){this.partialUpdate(C7.data,this.getTargetDefn(C5.join(R)),C7.defn,C4);var C6=mstrmojo.all[C3];C6.parent.rebuildChild(C6);}.bind(this);}function CZ(C1){var C3,C2=this.getCurrentLayoutKey();this.obCntrs=this.obCntrs||{};this.obCntrs[C2]=this.obCntrs[C2]||{};C3=this.obCntrs[C2][C1];if(isNaN(C3)){C3=0;Av.forEach(this.getCurrentLayoutDef().units,function(C4){if(C4.t===C1){C3++;}});this.obCntrs[C2][C1]=C3;}return C3;}function k(C6){if(!C6||(C6.node&CV.DRILL)){return ;}if((C6.nds||[]).length===0){return C6;}var C3=C6.nds||[];var C5=C3.length;if(C5!==2){var C2=true,C7=false;CX.forEach(C3,function(C8){C2=C2&&(C8.node&CV.DRILL);C7=C7||(C8.node&CV.DRILL);});if(C7&&!C2){throw {message:"something is wrong"};}if(!(C2||C7)){return C6;}}else{var C4=C3[0],C1=C3[1];if((C4.node&CV.DRILL)&&!(C1.node&CV.DRILL)){C4=C3[1];C1=C3[0];}if(!(C1.node&CV.DRILL)){return C6;}if(C4.node&CV.DRILL){return ;}return k(C4);}}mstrmojo.vi.models.DocModel=mstrmojo.declare(mstrmojo.DocModel,[mstrmojo.vi.models._LayoutActions,mstrmojo.vi.models._PanelActions,mstrmojo.vi.models._FilterStackActions,mstrmojo.vi.models._VisActions,mstrmojo.vi.models._FieldActions,mstrmojo.vi.models._DataGridActions,mstrmojo.vi.models._NotificationVisFilter,mstrmojo.vi.models._IsNLPModel],{scriptClass:"mstrmojo.vi.models.DocModel",datasets:null,deObjectMap:null,controller:null,lastSavedStid:0,lastModifiedTime:null,toolbarModelStates:{presModeFiltersAvailable:false,presModeTOCVisible:false},_selectedUnitId:null,_latestSelectedViUnitKey:null,init:function Cs(C1){if(!mstrApp.isSingleTier&&C1&&C1.prefs){C1.prefs.rtprnt=mstrApp.drillRtnPrntVal;}this._super(C1);Bg.call(this,this.datasets,this.datasetsSettings);if(mstrApp.isSingleTier&&this.hasUnpublishedCube()&&mstrApp.isAppStatePause()){CC.call(this);}},getVIMap:function CY(C1){return this.getDocBuilder().getLayoutVIMap(C1||this.getCurrentLayoutKey());},getVIComponent:function A6(C2,C1){return this.getVIMap(C1).getComponent(C2);},getVIComponentKey:function AL(C2,C1){return this.getVIMap(C1).getComponentKey(C2);},buildKeyContext:AW,loadHiddenVIStack:BQ,buildLoadedVIStack:v,getShowVIStackAction:BG,getVIPanelKeyFromUnits:function CL(C3,C1){var C2=this.getLayoutDefn(C1||this.getCurrentLayoutKey()).units;return Object.keys(C2).filter(function(C4){return C2[C4].psType===C3;})[0];},updateTitle:function AZ(C4,C3,C2,C1,C6,C5){Cv.call(this,C4,C3,C2,C1,C6,Az.TITLE,C5);},createNewUnitNode:P,getPanel:function Bj(C4,C3){var C2=this,C1=C4?mstrmojo.all[this.getWidgetId({k:C4,wid:1},C3)]:this.getVizContentPanel(C3);if(!C1&&C4&&!C3){CX.forEach(this.defn.layouts,function(C5){C1=mstrmojo.all[C2.getWidgetId({k:C4,wid:1},C5.k)];return !C1;});}return C1;},createUnit:t,deferredInsertUnit:function AJ(C6,C2,C5,C1,C3){var C4=C2.k;C6.setTreesToRender(3);C6.addCallbacks({success:function(C8){var DC=C2.defn._lkz,DA=C8.defn.layouts.filter(function(DH){return DH.k===DC&&DH.loaded;})[0],DB=!Av.isEmpty(DA);if(!DB){B0.call(this,DC);return ;}var DF=this.getPanel(C5),C7=C2.nk,C9,DG,DD=this.currlaykey;this.controller.view.updateXtabStyles(DC,C8.data.layouts[CX.find(C8.data.layouts,"k",DC)].xtabStyles);this.updateDefnCache(C8.defn,[C4,DF.k]);this.updateDataCache(C8.data,this.getTargetDefn(C4));if(this.getLayoutDataCache(DD)[DF.id]){DG=CX.filterOne(this.data.layouts,function(DH){return(DH.k===DD);});this.updateDataCache({layouts:[DG]},this.getTargetDefn(DF.k));}DF.update(DF.node);var DE=DB&&(!!this.getChildrenByKey(DF.node,false,[C4])[0]);if(DE){C9=DF.rebuildChild(DF.getUnitByKey(C4));this.selectVIUnit(C9.id,true,{isAddAction:true});}if(C7){C9.nk=C7;}}.bind(this)});this.getPanel(C5).addUnit(C2,C1,C3,C6,true);},markDirtyLayout:B0,getVizContentPanel:function AU(C1){return this.getVIComponent(B9,C1).getSelectedPanel();},getSelectedViUnit:function w(){return mstrmojo.all[this._selectedUnitId];},getVizOfSelectedViUnit:function B4(){var C6=this.getSelectedViUnit();if(!C6){return ;}var C3=C6.boxContent,C4=C3.model.data.visName||"VisGrid",C7=(typeof C3.getVisType==="function"?C3.getVisType():{}).vt,C5=this.controller.galleryPanel,C2=C4===AR.GRAPH_MATRIX||C4===AR.NEW_GRAPH_MATRIX;function C1(C8){var C9=typeof C8.vt==="object"?[C8.vt.v,C8.vt.h]:[C8.vt];return C2?C8.s===C4&&(C9[0]!==undefined&&C7===C9[0]||C9[1]!==undefined&&C7===C9[1]):C4===(C8.s||"VisGrid");}return CX.filterOne(C5.vizList.items.concat(C5.customVizList.items),C1);},resetSelectedViUnitId:function Al(){this._selectedUnitId=null;},getRootNode:function Ci(){var C1=this.defn.root;return{k:C1.k,defn:C1};},getHighLightNDECallback:function Bt(){var C1=this;return this.newCallback({method:"hightLightNDE",success:function(C3){var C4=C3.datasets,C2=[];Av.forEach(C4,function(C5){CX.forEach(C5.att,function(C6){if(C6.t===47&&C6.st===12033){CX.forEach(C6.des,function(C7){if(C7.ne&&C7.t!==4){C2.push({id:C7.id,n:C7.n,es:C7.es,attId:C6.attId,unitId:C6.did});}});}});});if(C2.length>0){C1.callOnNDECreated(C2);}}});},callOnNDECreated:function(C2){var C1=this.getPanel();CX.forEach(C1.children,function(C3){if(C3.boxContent&&C3.boxContent.onNDECreated){C3.boxContent.onNDECreated(C2);}});},getRebuildCallback:function L(){var C1=this;return this.newCallback({method:"rebuild",success:function(DE){if(!C1.checkStatus(DE)){return ;}var DA=DE.data,DD=DE.defn,DB=DE.pukeys,DC=DB&&DB.split(R),DF={},C7;if(DC&&DC.length){if(DD){var DG=C1.getLayoutDefn(C1.getCurrentLayoutKey()),C3=DG&&DG.units,DH=(DG&&DG.cgbMap)||{},C4=DD.layouts,C9=C4&&C4[CX.find(C4,"k",C1.getCurrentLayoutKey())],C6=C9&&C9.units,C2=(C9&&C9.cgbMap)||{},C8=function(DI){var DJ=[];DI.forEach(function(DL){if(!C3[DL]&&C6&&C6[DL]){var DK=C6[DL].pnk;if(DK){DJ.push(DK);}}});return DJ;},C5=C8(DC);while(C5.length){DC=DC.concat(C5);C5=C8(C5);}C7=CX.hash(DC);DF=Bp.call(C1,DA,C7,false);Av.forEach(C7,function(DI,DJ){if(C2[DJ]||DH[DJ]){DF[DJ]=true;}});}else{C7=CX.hash(DC);}C1.partialUpdate(DA,C7,DD,Av.keyarray(DF));}else{if(C1.updateLayouts(DE)){C1.controller.view.updateLayouts(DE);}}}});},buildSliceUrInfo:function Cl(C6){var C8=C6.events||{K0:C6},C3=[],C2=2,C1,C7,C4=[],C9,C5=this;Object.keys(C8).forEach(function(DA){C1=C8[DA];C7=C1.ck;C9=C1.isNavigation;if(C7){var DB=Ce(C7);C3.push(DB.nodeKey,DB.ctrlKey);}if(C9&&C1.layoutKey){C4.push(function(){var DC=C5.controller.view.getLayoutByKey(C1.layoutKey);if(DC){DC.defn.loaded=false;}});}if(C1.changeInclude||C1.changeQual||C9){C2=3;}});return{extraPuKeys:C3,treesToRender:C2,undo:AD.composite(C4)};},getUIState:function Bm(){var C1={};H.forEach(function(C2){C1[C2]=this.getVIComponent(C2).getUIState();},this);return C1;},restoreUIState:function A4(C1){H.forEach(function(C2){this.getVIComponent(C2).restoreUIState(C1[C2]);},this);},cmdMgr:function BZ(){return this.controller.cmdMgr;},execute:function Ag(C1){return this.controller.cmdMgr.execute(C1);},slice:function AA(C1){var C2=this;this.execute({execute:function(){var C3=C2.getDataService().newUpdate(this);C2.sliceDeferred(C3,C1);if(C3.actions&&C3.actions.length>0){this.submitUpdate(C3);}},urInfo:C2.buildSliceUrInfo(C1)});},insertNewFilter:function A2(){var C6=this.id,C2=mstrmojo.all[C6],C4=C2.getDataService(),C5=C2.getVizContentPanel().k,C1=C2.getNextKey(),C3=C2.createNewUnitNode(null,function(C7,C8){C7.t=CH.SELECTOR;C7.ck=AW(C1,C8.k);C7.ckey=C8.k;return new mstrmojo.Model(C7);});this.execute({execute:function(){var C9=C4.newUpdate(this,{extras:Cw}),C7=C2.createUnit(C3,C5),C8=C7.k;C9.addActions([C4.getAddCtrlAction(C5,C1,C8,[C8]),C2.getUnitFormatAction(C3,5,CI(Az.SHOW_TITLE_BAR,false)),C2.getUnitFormatAction(C3,1,CI(Az.CONTROL_ITEM_WIDTH_MODE,0)),C2.getUnitFormatAction(C3,1,CI(Az.CONTROL_EXPORT_AS_SHOWN_ON_WEB,1))]);C2.deferredInsertUnit(C9,C7,C5,null,null);this.submitUpdate(C9);},urInfo:{undo:function(){this.urInfo.callback={};var C8=C2.getPanel(C5),C7=C8.getUnitByKey(C3.k);if(C7){C8.deleteBoxAndSubmitDeferred(C2.getDataService().newUpdate(),C7,null,true);C7.destroy();}},redo:function(){if(C3){var C8=C4.newUpdate(this,{extras:Cw}),C7=C2.createUnit(C3,C5);C2.deferredInsertUnit(C8,C7,C5,null,null);if(this.urInfo){this.urInfo.callback=C8.callback;}}},extraPuKeys:[C5],treesToRender:3}});},insertExistingFilter:function Ai(C6,C7,C1){var C4=this,C2=this.getPanel().k,C9=this.getDataService(),DB=C6.defn,C5=C6.defn.tks.split(R),DC=this.getVizContentPanel().getTargetKeysByType([CH.GRID,CH.GRAPH,CH.MOJOVISUALIZATION]),DA=C4.getVIComponent(BC.FILTER_PANEL),C8=DA.id,C3=function(DD){DD.raiseEvent({name:"filterPanelUpdated"});};C4.execute({execute:function(){var DH=C9.newUpdate(this),DF=DA.children,DN=[],DE=[];DF.forEach(function(DP){var DQ=DP.selector,DO=DQ.tks;if(DO&&DO.indexOf(C6.k)!==-1){DE.push(DP.k);DN.push(DP);}});var DM=C4.createUnit(C6,C2),DJ=DB.ck,DK=DB.srct,DI=DB.srcst,DG=[],DD=false;C5.forEach(function(DO){var DP=mstrmojo.array.ensureArray(DO);if(!DD){DP.push(DB.pnk);DD=true;}DG.push(C9.getRemoveCtrlTargetAction(DJ,DO,DP));});DN.forEach(function(DO){DG.push(C9.getRemoveCtrlTargetAction(DO.selector.ck,C6.k,DO.k));});DC.forEach(function(DO){DG.push(C9.getAddCtrlTargetAction(DJ,DO,DO,Ba(DK,DI)));});DG.push(C9.getMoveControlAction(DJ,C2));if(C1==="Top"||C1==="Bottom"){DG.push(C4.getUnitFormatAction(C6,1,CI(Az.CONTROL_ORIENTATION,1)));}DG.push(C4.getUnitFormatAction(C6,1,CI(Az.FILL_STYLE,0)));DG.push(C4.getUnitFormatAction(C6,5,CI(Az.FILL_STYLE,0)));DG.push(C4.getUnitFormatAction(C6,1,CI(Az.BORDER_COLOR,"#fefefe")));DH.addActions(DG);C4.deferredInsertUnit(DH,DM,C2,C7,C1);C5.push(DA.defn.pnk);var DL=C5.join(R);DH.callback={success:function(DO){var DQ=C4.getPanel(C2),DP=DQ.getUnitByKey(C6.k);if(DP&&DP.clearFormats){DP.clearFormats();}DA.refreshFP();C4.partialUpdate(DO.data,C4.getTargetDefn(DL),DO.defn,[C6.k,C2,DB.pnk].concat(DE));DN.forEach(function(DR){DA.rebuildChild(DR);});C3(DA);}};this.submitUpdate(DH);},urInfo:{undo:function(){this.urInfo.callback=C4.getRebuildCallback();var DE=C4.getPanel(C2),DD=DE.getUnitByKey(C6.k);if(DD){DE.removeChildren(DD);DD.destroy();mstrApp.rootCtrl.docCtrl.selectViPanel("filterPanel");}C3(DA);},redo:function(){DA=mstrmojo.all[C8];var DE=(DA.children||[]).filter(function(DH){return DH.k===C6.k;})[0];if(DE){DA.removeChildren(DE);DE.destroy();}delete C6.defn.iifp;var DG=C9.newUpdate(this),DF=C4.createUnit(C6,C2);if(!C7.parent){C4.getPanel(C2).children.forEach(function(DH){if(DH.k===C7.k){C7=DH;}});}C4.deferredInsertUnit(DG,DF,C2,C7,C1);var DD=C5.join(R);DG.callback={success:function(DH){var DI=C4.getPanel(C2);DE=DI.getUnitByKey(C6.k);if(DE&&DE.clearFormats){DE.clearFormats();}C4.partialUpdate(DH.data,C4.getTargetDefn(DD),DH.defn,[C6.k,C2,DB.pnk]);C3(DA);}};if(this.urInfo){this.urInfo.callback=DG.callback;}},extraPuKeys:[C4.getVIComponent(BC.FILTER_PANEL).k,C2]}});},adjustNodeId:function B5(C1){return C1+O;},restoreNodeId:function AB(C3){if(!C3){return ;}var C2=C3.length-1,C1=C3[C2];if(C1===O){return C3.substring(0,C2);}return C3;},selectVIUnit:function A3(C3,C1,C2){if(C1||C3!==this._selectedUnitId){this._selectedUnitId=C3;this._latestSelectedViUnitKey=C3&&mstrmojo.all[C3].k;this.raiseEvent(Av.copy({name:"viUnitSelected",id:C3},C2));}},setVisActive:function Bl(C2,C1){this.raiseEvent(Av.copy({name:"visActive",id:C2},C1));},setVizBoxActive:function Br(C2,C1){this.raiseEvent(Av.copy({name:"vizBoxActive",id:C2},C1));},getLatestSelectedViUnitKey:function D(){return this._latestSelectedViUnitKey;},getDocDatasetsPanel:function A(){var C2=this.getRootNode(),C3=C2.defn,C4=this.id,C1=new mstrmojo.vi.ui.DocDatasetObjects({data:this.datasets,visible:!!C3.dsv,width:C3.dsw,model:this,unit:C2,settings:this.datasetsSettings,getPanelSaver:function(){var C5=mstrmojo.all[C4];return AF.PanelFormatSaver.getPanelSaver(C5,{size:{set:"FormattingAnalysis",name:"DatasetObjectsWidth",convert:true},visible:{set:"FormattingAnalysis",name:"DatasetObjectsVisible"}});}});C1.subs=[];C1.subs[0]=this.attachEventListener("updateDatasets",C1.id,function(C5){C1.set("data",C5.datasets);C1.set("settings",C5.datasetsSettings);});C1.subs[1]=this.attachEventListener("viUnitSelected",C1.id,function(C6){var C5=mstrmojo.all[C6.id];C1.set("gridSource",C5&&C5.boxContent.model.data.datasetId);});C1.subs[2]=this.attachEventListener("cubePublishChange",C1.id,function(C5){this.onCubePublishChange(C5.cubeID,C5.unpublished);});return C1;},getVisPanelStackKey:function Am(C3){var C1=this.getLayoutDefn(C3).units||[],C2=null;Av.forEach(C1,function(C5,C4){if(C5.t===CH.PANELSTACK&&C5.psType===Cm.VISUALIZATION){C2=C4;return false;}});return C2;},getVisPanelKeys:function h(C4,C5){var C3=[],C1=this.getLayoutDefn(C4).units||[],C2=this.getVisPanelStackKey(C4);if(C2){Av.forEach(C1,function(C7,C6){if(C7.t===CH.PANEL&&C7.pnk===C2&&!(C5&&C7._isDeleted)){C3.push(C6);}});}return C3;},getFilterPanelStackKey:function AG(C3){var C2=this.getLayoutDefn(C3).units||[],C1=null;Av.forEach(C2,function(C5,C4){if(C5.t===CH.PANELSTACK&&C5.psType===Cm.FILTERS){C1=C4;return false;}});return C1;},getFilterPanelKey:function By(C2){var C1=this.getLayoutDefn(C2).units||[],C3=null;Av.forEach(C1,function(C5,C4){if(C5.t===CH.PANEL&&C5.isFilterPanel){C3=C4;return false;}});return C3;},getCurrentLayoutSelectorDefn:function Bf(C5){var C3=this.getCurrentLayoutKey(),C7=this.getFilterPanelKey(C3),C2=this.getLayoutDefn(C3).units||[],C6={},C1={},C4;Av.forEach(C2,function(C9,C8){if(C9.t===CH.SELECTOR&&!(C5&&C9._isDeleted)){C4=C9.pnk;if(C4===C7){C6[C8]=C9;}else{if(C2[C4]&&C2[C4].t!==CH.SUBSECTION){C1[C8]=C9;}}}});return{filterPanelSelectors:C6,canvasSelectors:C1};},hasCanvasSelOrTargetedSel:function Bz(){var C3=this.getCurrentLayoutSelectorDefn(),C2=C3.canvasSelectors,C1=C3.filterPanelSelectors;if(!!Object.keys(C2).length){return true;}var C5=Object.keys(C1),C4=false;CX.forEach(C5,function(C6){var C8=C1[C6],C7=C8&&C8.tks&&C8.tks.split("\x1E");CX.forEach(C7,function(C9){if(C1[C9]){C4=true;return false;}});if(C4){return false;}});return C4;},getCurrentLayoutAndUnitDefn:function X(){var C2={},C1=this.getCurrentLayoutKey(),C3=this.getVizContentPanel(C1).k;C2.layoutDefn=this.getLayoutDefn(C1);C2.layoutUnitDefn=this.getLayoutUnitDefn(C3,C1);return C2;},getTocData:function BJ(){var C1=[],C2=this;CX.forEach(this.defn&&this.defn.layouts,function(C8){var C6=[],C7=C8.k,C5=C2.getVisPanelStackKey(C7),C4=C2.getVisPanelKeys(C7,true),C3=C8.units;CX.forEach(C4,function(C9){var DA=C3[C9];C6[DA.chdidx-1]={pnk:DA.pnk,k:C9,chdidx:DA.chdidx,n:BA.decodeHtmlString(DA.ttl),l:DA.l,layoutKey:C7};});C6=CX.filter(C6,function(C9){return !!C9;});C1=C1.concat({k:C7,title:BA.decodeHtmlString(C8.title),loaded:C8.loaded,panels:C6,panelStackKey:C5});});return C1;},getDatasetsPanel:function BR(C4,C2,C3,C5){var C1=new mstrmojo.vi.ui.DatasetObjects({data:(!C3?this.datasets:C3(this.datasets)),width:C4||((!!mstrApp.isWSStyling)?"174px":"200px"),model:this,useTableView:this.datasetsSettings.useTableView,title:mstrmojo.desc(2870,"Objects"),filterFunc:C2,filterNodeConfig:C5||{att:true,mx:true}});C1.subs=[];C1.subs[0]=this.attachEventListener("updateDatasets",C1.id,function(C6){C1.set("useTableView",C6.datasetsSettings.useTableView);C1.set("data",!C3?C6.datasets:C3(C6.datasets));});C1.subs[1]=this.attachEventListener("updateUseTableView",C1.id,function(C6){this.set("useTableView",C6.useTableView);});C1.subs[2]=this.attachEventListener("cubePublishChange",C1.id,function(C6){this.onCubePublishChange(C6.cubeID,C6.unpublished);});return C1;},setUserDICubeInfo:function CU(C1){this.unpublishedCubes=CX.map(CX.filter(Object.keys(C1),function(C2){return !C1[C2].published;}),function(C2){return C1[C2];});Ah.call(this,this.hasUnpublishedCube());},updateCubePublishStatus:function Z(C2){var C4=this.datasets,C5,C3,C1=this;CX.forEach(CX.ensureArray(C2),function(C6){C5=C6.did;C3=!C6.published;if(C3!==!!C4[C5].unpublished){C4[C5].unpublished=C3;C1.raiseEvent({name:"cubePublishChange",cubeID:C5,unpublished:C3});}});},removeUnpublishedCubes:function BU(C1){var C2=CX.ensureArray(C1);this.unpublishedCubes=CX.filter(this.unpublishedCubes,function(C3){return CX.indexOf(C2,C3.did)===-1;});Ah.call(this,this.hasUnpublishedCube());},hasUnpublishedCube:function CN(){var C1=Av.keyarray(this.datasets);return !!(this.unpublishedCubes&&CX.filter(this.unpublishedCubes,function(C2){return CX.indexOf(C1,C2.did)>-1;}).length);},updateDatasets:function Bb(C1,C2){if(!C1){return ;}M(this.datasets,C1);Bg.call(this,C1,C2);if(mstrmojo.resolveFeature(Ar.SUPPORT_NLP)&&this.buildWordBase){this.buildWordBase(true);}if(!this.hasUnpublishedCube()||!CC.call(this)){Ax.call(this);}},getDatasetsUpdateCallback:function Ak(){var C1=this;return{success:function(C2){C1.als=C2.als;C1.updateDatasets(C2.datasets,C2.datasetsSettings);if(C2&&C2.defn&&C2.defn.efs){C1.defn.efs=C2.defn.efs;}}};},renameDataset:function A9(C2,C1,C4){var C3={act:"renameDataset",datasetID:C2,name:C1};this.controller.submitUndoRedoUpdates(C3,null,C4,Cp);},renameEmmaSrcTable:function Cf(C2,C3,C1,C4){this.getDataService().submitUpdates([{act:"renameEmmaSrcTable",dsid:C3,did:C2,n:C1}],C4,Cw);},addDataset:function J(C3,C4){if(!C3||!C3.length){return ;}var C5=this,C2=C5.controller;function C6(C8){var DA=[],C7=[];function C9(){var DE=C2.cmdMgr,DD=DE.getInterimCmd();if(DA.length>0){var DC={success:function(DF){C2.getRefreshCallback().success(DF);C2.datasetsPanel.set("allObjectBrowserOpened",false);},failure:function(){window.setTimeout(function(){var DF=DD.urInfo;DF.callback={success:mstrmojo.emptyFn};DD.cancel(true);},0);}},DB=DE.CMD_PHASE;DD.urInfo.callback=DC;DD.submit(DA,AD.wrapMethods(DC,C4),{skipUICmdMgrOnFailure:[CJ.DOCDATA_PREPARE_TASK_REPORT_INCOMP],style:{params:{treesToRender:3}}},C4?DB.MIDDLE:DB.LAST);}else{DD.cancel();}}C3.forEach(function(DC){var DB=C8[DC.did];DA.push({act:"addDataset",did:DC.did,t:DC.t,g:Av.keyarray(C2.datasetsPanel.data).length===1?1:0,disablePU:true});if(DB&&!DB.published){if(!(DB.dda===1&&DB.ddam===F.dda)&&DB.dda!==3){DA.pop();C7.push(DC);}}});if(DA.length){DA=DA.concat(C5.getOpenDatasetPanelAction());}if(C7.length>0){mstrmojo.alert(mstrmojo.desc(13762,"The following datasets will not be added. You need to publish them first.")+" "+C7.map(function(DB){return"<br/>- "+mstrmojo.string.encodeHtmlString(DB.n);}).join(""),C9,null,null,null,{allowHTML:true});}else{C9();}}var C1=C3.map(function(C7){return C7.did;});if(mstrApp.isSingleTier){C6({});}else{this.getDataService().getUserDICubeInfo(C1,{success:function(C7){C6(C7);}});}},getReloadLayoutModelCallback:function At(C2){var C1=this;return AD.wrapMethods({success:function(C3){AE.call(C1,true);C1.loadLayout(C3);}},C2);},getRemoveUnitUpdate:function Cq(C4){var C2=C4.unit,C1=C4.partialRetrievalKeys,C3=[{act:"removeUnit",unitKey:C2.k,unitType:C2.defn.t,clearTargets:C4.clearTargets}];if(C1){C3[0].partialRetrieval={nodes:C1};}return this.getDataService().newUpdate(null,{actions:C3});},getCopyEmptyTemplateAction:function CS(C5,C1,C3){var C4=this.getLayoutDefn(C3||this.getCurrentLayoutKey());var C2=C4.units;var C6=C4.btn;if(!C6){Av.forEach(C4.units,function(C9,C7){var C8=C2[C9.pnk];if(C9.n==="SourceGrid"&&C9.chdidx===1&&C9.t===521&&C8&&C8.n==="Body Footer"){C6=C7;return true;}});}return{act:"copyUnit",unitKey:C6,unitType:521,newKey:C5,toKey:C1,partialRetrieval:{nodes:[C5]}};},getToggleHiddenObjectAction:function BB(C3,C2,C1){return{act:"editDocUnitProp",dsid:C3,unitId:C2.did,unitType:C2.t,prop:BD,value:C1?"1":"0"};},updateUnitFormatWithUndo:function A1(C4,C5,C6,C2,C8){var C7=this.getDataService(),C3=this,C1=function(){var C9=this,DA=C7.newUpdate(C9,{actions:[C3.getUnitFormatAction(C4,C5,C9.getStateValue(C6,C2))],callback:Av.copy({success:function(){C8.success(C6);}},Av.copy(C8)),extras:mstrmojo.DocDataService.SUPPRESS_DATA});DA.submit();};this.execute({execute:C1,urInfo:{silent:true,undo:function(){C8.success(C2);},redo:function(){C8.success(C6);}}});},renameRWUnit:function AY(C1,C2,C3,C4){Cv.call(this,C1,C2,C3,this.currlaykey,"n",Az.NAME,C4);},getRemoveControlUpdate:function e(C1,C9,C2){var C8=this.getDataService(),C4=C8.newUpdate(),C7=[C9].concat(C2.split(R)),C3=C8.getRemoveCtrlAction(C1,C7),C6=this,C5={success:function(DA,DC){var DE=JSON.parse(DC.params.params),DB=DE.partialRetrieval,DD=(DB&&DB.nodes)?DB.nodes.join(R):"";C6.partialUpdate(DA.data,C6.getTargetDefn(DD),DA.defn);}};C4.addActions(C3);C4.addCallbacks(C5);return C4;},findKeyMap:function Cr(C5){var DB=this.mapLayKeys;if(!DB){return null;}var C7=DB.oldKey,DF=DB.newKey,C8=C7?this.getLayoutDefn(C7):null,DA=DF?this.getLayoutDefn(DF):null,C9=C5.k,C2={},DH,DE,DG,C6;var DD=function(DJ){var DI={};Object.keys(DJ.units).forEach(function(DK){var DM=DJ.units[DK],DL=DM.pnk;if(DL){var DN=DI[DL]=DI[DL]||[];DN[DM.chdidx]=DK;}});return DI;};var C1=function(DK,DM,DJ,DL){if(DK===DM||!DM){return[];}var DN=DL[DM].pnk,DI=DL[DM].chdidx;DH=C1(DK,DN,DJ,DL).concat(DI);return DH;};var C4=function(DI,DM,DK){var DL=DI[DK];if(DM.length>0&&DL){var DJ=DM.shift();return C4(DI,DM,DL[DJ]);}return DL;};var C3=DD(DA);if(C8){if(!C8.loaded){return null;}var DC=DD(C8);DH=C1(DF,C9,C3,DA.units);DE=C4(DC,DH,C7);DG=C3[C9];for(C6=0;DE&&C6<DE.length;C6++){if(DE[C6]){C2[DE[C6]]=DG[C6];}}}else{C2["default"]=CX.filterOne(C3[C9],function(DI){return !!DI;});}return C2;},loadHiddenPageByStack:function As(C1,C2){BQ.call(this,Cm.PAGEBY,"sections.0.subsections.0.objects.0.panels.0",C1,C2);},getCtrlStyleFromDatasetUnit:function V(DC,C6){if(DC.um&&DC.isTopRank){return Ad.METRIC_QUAL;}var DA=DC.t,C8=DC.card||0,DE,DB;if(C8===-1){DE=Ad.SEARCH_BOX;DB=Ad.SEARCH_BOX;}else{DE=C8<=15?(C6?Ad.CHECKBOX:Ad.LINK):C8<=100?Ad.CHECKBOX:Ad.SEARCH_BOX;DB=C8<=50?Ad.SCROLLER:C8<=1000?Ad.CHECKBOX:Ad.SEARCH_BOX;}var DD={12:{3:DE,2:DB,8:Ad.ATTR_QUAL,1:Ad.ATTR_QUAL,9:DB,11:DB,"default":DE},4:{1:Ad.METRIC_SLIDER,6:Ad.METRIC_SLIDER,9:Ad.METRIC_QUAL,16:Ad.METRIC_QUAL,30:Ad.METRIC_SLIDER,31:Ad.METRIC_SLIDER,"default":Ad.METRIC_SLIDER},1:Ad.CHECKBOX,47:Ad.CHECKBOX}[DA];if(DA===c){if(DC.lock){return Ad.ATTR_QUAL;}if(DC.st===CP){return Ad.CHECKBOX;}if(DC.de&&DD[DC.formType]===Ad.ATTR_QUAL){return DD["default"];}if(!C8){var C4=this.datasets,C2,C5,C9,C1,C3=false,C7=function(DF){C9=DF.formType;C1=DF.did===DC.did&&!DF.card;C3=C3||C1;return C1;};for(C2 in C4){C5=C4[C2];if(C5.att.some(C7)&&(C5.dsm===2||C5.idd)){if(C9===Cx.DssXmlBaseFormDate||C9===Cx.DssXmlBaseFormDateTime){return DD[C9]||DD["default"];}return Ad.SEARCH_BOX;}}if(!C3){C9=DC.formType;if(C9&&(C9===Cx.DssXmlBaseFormDate||C9===Cx.DssXmlBaseFormDateTime)){return DD[C9]||DD["default"];}return Ad.SEARCH_BOX;}}return DD[DC.formType]||DD["default"];}if(DA===N){if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){return Ad.METRIC_QUAL;}return DD[DC.dt||"default"]||DD["default"];}return DD;},getCtrlHeightByStyle:function Aj(C2,C1){var C3={"default":140,4:C1>15?243:235,9:140,1:100,3:C1>15?243:235,0:80,7:100,8:86,11:100,12:50};if((C2===3||C2===4)&&C1<=8){return 26*Math.max(C1,2)+27;}return C3[C2]||C3["default"];},getICSCtrlMoveHeightByStyle:function Ay(C1){var C2={"default":20,4:20,9:40,1:60,3:20,0:60,7:60,8:60,11:60};return C2[C1]||C2["default"];},getCtrlActionsByStyleForVisFilter:function BV(C2,C4){var C1={},C3=[];if(C4!==undefined){CI(Az.Z_INDEX,C4,C1);}C3.push({act:"format",unitKey:C2,unitType:CH.GRAPH,formatType:1,format:C1});return C3;},getSelectorPropsChangeAction:function W(C1,C2){var C3=C1.defn.ck;return[Av.copy(C2,{act:"editSelectorProps",keyContext:C3,ctrlKey:C1.k,partialRetrieval:{nodes:[this.getDataService().getNodeKeyFromKeyContext(C3)]}})];},submitToggleShowAllActions:function AH(C3,C6,C7){var C2=this,C1=C3.isInFilterPanel(),C5=C3.k;this.controller.submitUndoRedoUpdates(C6,{},AD.wrapMethods({success:function C4(C8){C2.partialUpdate(C8.data,C2.getTargetDefn(C5),C8.defn,[C5]);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){var DA=C2.getTargetDefn(C5);if(DA&&DA[C5]){C3.toggleDisplayAll(DA[C5].showall);}}if(C1){var C9=C2.getVIComponent(BC.FILTER_PANEL);C9.rebuildChild(C9.children.filter(function(DB){return DB.k===C5;})[0]);}}},C7),Cw);},getCtrlActionsByStyleForToggleShowAll:function Af(C5,C4){var C2={},C6=[],C7=C5.isInFilterPanel(),C1=C5.style,C8=C5.k,DA=this.getDatasetUnits(["att","mx"],function(DB){return DB.did===C5.defn.srcid;})[0],C3=DA.card,C9=C5.defn.ck;if(C7){Bc.call(this,C2,C1,C3,C4);C6.push({act:"format",unitKey:C8,unitType:CH.SELECTOR,formatType:1,format:C2,keyContext:C9});}return C6;},isNumericDataType:function Q(C1){return !C1||C1===Ct.DataTypeBigDecimal||C1===Ct.DataTypeCellFormatData||C1===Ct.DataTypeDecimal||C1===Ct.DataTypeDouble||C1===Ct.DataTypeFloat||C1===Ct.DataTypeInt64||C1===Ct.DataTypeInteger||C1===Ct.DataTypeLong||C1===Ct.DataTypeNumeric||C1===Ct.DataTypeReal||C1===Ct.DataTypeShort||C1===Ct.DataTypeUnsigned;},getCtrlActionsByStyle:function B(DC,DA,DD,C4,DF,C3,DB,C8){var C5={FormattingSize:{HeightMode:"0"}},DH=C5.FormattingSize,DG=Ce(DA),C7=DG.nodeKey,C2=DG.ctrlKey,C6=[],DE=this.getZoomProps(),C1=DC.n,C9=DC.card||0;CI(Az.CONTROL_STYLE,DD,C5);if(C1){CI(Az.NAME,C1,C5);}if(DC.t===N&&!this.isNumericDataType(DC.dt)){CI(Az.CONTROL_METRIC_CONDITION_TYPE,1,C5);}if(C4){CI(Az.CONTROL_ORIENTATION,C4,C5);}if(DF){DH.Height=C.toLocaleString(BM.px2Inches(DE,DF));}if(C3){DH.Width=C.toLocaleString(BM.px2Inches(DE,C3));}if(DB!==undefined){CI(Az.Z_INDEX,DB,C5);}if(C9===0||C9>50){CI(Az.CONTROL_ITEM_WIDTH_MODE,1,C5);}if(C8!==undefined){CI(Az.CONTROL_SHOW_ELEMENT_COUNT,C8,C5);}CI(Az.CONTROL_EXPORT_AS_SHOWN_ON_WEB,1,C5);C6.push({act:"format",unitType:CH.SELECTOR,keyContext:DA,formatType:1,format:C5});if(DC.isTopRank){C6.push(this.getDataService().getSelectorExpressionAction({ck:DA,ckey:C2,srcid:DC.did,srct:DC.t,f:1,ft:2,cs:DC.cs,dtp:Ct.DataTypeReal,type:1,include:true,changeQual:true,qt:DC.qt,unset:false}));}if(DD!==3){C6.push({act:"setControlShowAll",nodeKey:C7,controlKey:C2,showAll:true});}return C6;},clearMapLayout:function AI(){delete this.mapLayKeys;delete this.replaceKeyBoxes;},isInDataset:function s(C3,C5,C1){C1=C1||["att","mx"];var C4=this.datasets[C3]||{},C2=false;CX.forEach(C1,function(C6){Av.forEach(C4[C6]||{},function(C7){C2=C7.did===C5;return !C2;});return !C2;});return C2;},findDatasetIdFromUnit:function(C2){var C1=null;Av.forEach(this.datasets,function(C3,C4){Av.forEach((C3.att||[]).concat(C3.mx),function(C5){if(C5.did===C2){C1=C4;return false;}});if(!!C1){return false;}});return C1;},findUnitNameInDataSetFromUnit:function(C2){var C1=this.findUnitInDataSet(C2);return(C1&&C1.n)||null;},findUnitInDataSet:function(C2){var C1=null;Av.forEach(this.datasets,function(C3){Av.forEach((C3.att||[]).concat(C3.mx),function(C4){if(C4.did===C2){C1=C4;return false;}});if(!!C1){return false;}});return C1;},addShortcutMetric:function(C3,C4){var C1=C3.items,C2=this;C2.execute({execute:function(){var C5=[];if(S.isFuncHasUseLookupForAttributeProp(C3.funcType)){C5=[{n:"UseLookupForAttributes",v:"0"}];}this.submit(Av.copyProps(["dsid","nodeKey","treeType","funcType","funcType2","prs","breakBys"],C3,{act:"addShortcutMetric",units:C1&&C1.length?C1.map(function(C6){return{id:C6.did,type:C6.t};}):[],prs:C5}),C4,{style:{params:{treesToRender:1}}});},urInfo:{callback:C4}});},submitDataDefnUpdate:function u(C1,C2){this.getDataService().submitUpdates(C1,C2,Cw);},rebuildUnitFromDataCache:function An(C3,C2,C1){return C1.build([this.getLayoutDataCache(this.getCurrentLayoutKey())[C3]],this,{pk:C2})[0];},getDocBuilder:function j(){return this.controller.view.builder;},submitUndoRedoFormatChange:function A8(C9,C2,C4,DC,C3){var C7=this,C8=C9.k,C5=C9.id,C1=C9.parent,C6=function(DD){var DE=[];Av.keyarray(DD).forEach(function(DF){DE.push(C7.getUnitFormatAction(C9,DF,DD[DF]));});return DE;},DA=!!(DC&&DC.success);this.controller.submitUndoRedoUpdates(C6(C2),{},AD.wrapMethods({success:function DB(DE){C7.partialUpdate(DE.data,C7.getTargetDefn(C8),DE.defn,[C8]);if(!DA){var DD=mstrmojo.all[C5];C1.selectVIUnit(C1.rebuildChild(DD),true);}}},DC),C3||Cw);},removePageByUnit:function CT(C1,C3){var C6=this.getDataService(),C2=this,C4=false,C7={success:function C5(C8){BF.call(C2,true)(C8);C1.setOpenStatus(C4,true);C4=!C4;}};this.cmdMgr().execute({execute:function(){var C8=C2.getVIComponent(Cn),C9=C6.newUpdate(this,{actions:[C6.getRemoveCtrlAction(C3.ckey,[C8.k,C2.getVIComponentKey(B9)]),C2.getUnitFormatAction(C8,1,CI(Az.VISIBLE,false))],callback:C7});this.submitUpdate(C9);},urInfo:{callback:C7}});},changePageByStyle:function AS(C1,C2){var C4=C1.ckey,C3=this.getUnitFormatAction(C1.node,1,CI(Az.CONTROL_ORIENTATION,1,CI(Az.CONTROL_STYLE,C2)));this.controller.submitUndoRedoUpdates(C3,null,{success:BF.call(this,false,[C4])},Cw);},updateFilterTargetsForSdp:function AN(C3){var C2=mstrApp.primaryScdpMap,C1=[];CX.forEach(C3,function(C4){if(C2[C4]&&C2[C4].length>0){C1=C1.concat(C2[C4]);}});return C3.concat(C1);},changeFilterTargets:function Aa(C5,DD,C7,C2,C1){C7=this.updateFilterTargetsForSdp(C7);var DB=this.getDataService(),DG=C5.defn,C8=DG.ck,C9=DG.srct,C6=DG.srcst,DA=C5.k,DF=C7.filter(function(DH){return DD.indexOf(DH)<0;}),DE=DD.filter(function(DH){return C7.indexOf(DH)<0;}),C3=[DA].concat(DF).concat(DE),DC=function(DI){var DJ=this.getTargetDefn(DI)[DI],DH=DJ&&DJ.ck;if(DH){DI=Ce(DH).nodeKey;}return DI;}.bind(this),C4=DE.map(function(DH){DH=DC(DH);return DB.getRemoveCtrlTargetAction(C8,DH,DH,C2);}).concat(DF.map(function(DI){var DJ=this.getTargetDefn(DI)[DI],DL=DJ&&DJ.tks&&DJ.tks.split(R)||[],DK=Ba(C9,C6),DH=DH;C3=C3.concat(DL);DI=DC(DI);DH=(DI&&DK)?false:DH;return DB.getAddCtrlTargetAction(C8,DI,[DI].concat(DL),DK,DH,C1);}.bind(this)));if(C4.length===0){return ;}this.controller.submitUndoRedoUpdates(C4,null,{success:function(DI){var DJ=this.getVizContentPanel().getUnitByKey(DA),DH=C3.join(R);this.partialUpdate(DI.data,this.getTargetDefn(DH),DI.defn,[DA]);if(DJ){DJ.parent.rebuildChild(DJ);}}.bind(this)},Cw);},changeFilterStyle:function Cd(C1,DF,DJ,DK){var C3=C1.defn,DM=C1.node.data,DD=C1.isInFilterPanel(),DH=C1.style,DI=C1.k,C7=C3.srct,DG=DM.ces||[],C9=C1.isRecursiveAttributeSelector(),DC=CI(Az.CONTROL_STYLE,DF),DB=DJ?1:(DJ===false?-1:0),C5=DK?1:(DK===false?-1:0),DE=this.getDatasetUnits(["att","mx"],function(DN){return DN.did===C3.srcid;})[0],C6,DL={style:{params:{treesToRender:1}}};if(!DB){switch(DF){case CQ.RADIO:DB=-1;break;case CQ.PULLDOWN:case CQ.BUTTON:case CQ.LINK:case CQ.LIST:DB=DG.length<=1?-1:1;break;case CQ.CHECKBOX:case CQ.SCROLLER:case CQ.SEARCH_BOX:DB=1;break;}}if(DB){CI(Az.CONTROL_MULTISELECT,DB>0,DC);}if(C5){CI(Az.CONTROL_AUTOSEARCH,C5>0,DC);}if(DD){var DA=function(DN){return(DN===CQ.SCROLLER||DN===CQ.METRIC_QUAL||DN===CQ.METRIC_SLIDER)?1:0;};C6=DA(DF);if(DA(DH)!==C6){CI(Az.CONTROL_ORIENTATION,C6,DC);}var C2=DE.card,C4=C1.showall;Bc.call(this,DC,DF,C2,C4);}else{C6=C3.horiz?1:0;CI(Az.CONTROL_ORIENTATION,C6,DC);}if((C7===N)||((DH===CQ.SEARCH_BOX||DF===CQ.SEARCH_BOX)&&C3.sos)||(DH===CQ.ATTR_QUAL)||(DF===CQ.ATTR_QUAL)||((DH===CQ.CHECKBOX||DF===CQ.CHECKBOX)&&C9&&DD)){DL=Cw;}var C8=function(){var DP=this,DO=DP.controller,DN=DO.cmdMgr;this.controller.submitUndoRedoUpdates(this.getUnitFormatAction(C1,1,DC),null,{failure:function(DQ){var DR=null;if(DQ.code===CJ.DFC_QRYENG_RES_TRUNC){DR=function(){DN.cmds.pop();DN.pos--;C1.skipUR=true;DP.changeFilterStyle(C1,CQ.SEARCH_BOX);};}mstrmojo.error({longDesc:DQ.message},DR,{onClose:DR,title:"Error"});},success:function(DR){this.updateDefnCache(DR.defn,[DI]);this.updateDataCache(DR.data,this.getTargetDefn(DI));if(C1.skipUR){C1.skipUR=false;DN.cmds.pop();DN.pos--;}if(DD){var DS=this.getVIComponent(BC.FILTER_PANEL);DS.rebuildChild(DS.children.filter(function(DT){return DT.k===DI;})[0]);}else{var DQ=this.getVizContentPanel().getUnitByKey(DI);DQ.parent.rebuildChild(DQ);}}.bind(this)},DL);}.bind(this);if(DL===Cw&&DF!==CQ.SEARCH_BOX&&DE&&DE.card>2000){mstrmojo.warn(mstrmojo.desc(13140,"This attribute has ## distinct values. Changing the display style may take a long time or potentially cause instability. Are you sure you want to continue?").replace("##",DE.card),{confirmBtn:{fn:C8}},{cssClass:"filterPanel-confirm"});}else{C8();}},setFilterDisplayForms:function Cz(C4,C1){var C2=this,C3=C4.k,C5={act:"setControlAttributeForms",keyContext:C4.ck,ctrlKey:C4.ckey,treeType:"1",fs:CX.map(C1,function(C6){return C6.id;}),partialRetrieval:{nodes:[C3]}};this.controller.submitUndoRedoUpdates([C5],undefined,{success:function(C6){C4.lockSelection=true;C2.partialUpdate(C6.data,C2.getTargetDefn(C3),C6.defn,[C3]);C4.lockSelection=false;}},Cw);},replaceFilter:function BE(C3,C5){var C4=C3.defn,C2=C3.k,C7=C4.tks?C4.tks.split(R):[],C1=[C2].concat(C7),C6=this.getDataService().getReplaceCtrlAction(C4.ck,C4.ckey,C4.ct,C5.did,C5.t,C1);this.controller.submitUndoRedoUpdates(C6,null,{success:function(C9){var DA=this.getVizContentPanel().getUnitByKey(C2),C8=C1.join(R);this.partialUpdate(C9.data,this.getTargetDefn(C8),C9.defn,[C2]);if(DA){DA.parent.rebuildChild(DA);}}.bind(this)},Cw);},changeUnitFormatProperty:function U(C4,C1){var C2=C4.parent,C5=C4.k,C3=this;this.saveUnitFormatProperty(C4,C1,{success:function(C6){C3.partialUpdate(C6.data,C3.getTargetDefn(C5),C6.defn,[C5]);C2.selectVIUnit(C2.rebuildChild(C2.getUnitByKey(C5)),true);}},mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION);},saveUnitFormatProperty:function AX(C8,C6,C9,C2,C4){var C7=this.getDataService(),C1=C8.parent,C5=C8.k,C3=this;C4=C4||{callback:C9};this.execute({execute:function(){var DA=C7.newUpdate(this,{extras:C2});[].concat(C6).forEach(function(DB){DA.addActions(C3.getUnitFormatAction(C1.getUnitByKey(C5),DB.formatType,CI(DB.propertyName,this.getStateValue(DB.newValue,DB.oldValue))));},this);DA.addCallbacks(C9);DA.submit();},urInfo:C4});},saveGroupInfo:function Ac(C8,C1,C2){var C5=this,C3=C2.id,C7=[],C6=this.getDataService(),C4=function(C9){var DA=C9?C1:C8;return function(){var DB=mstrmojo.all[C3];Av.forEach(DA,function(DD,DC){DB.getUnitByKey(DC).defn.gi=DD;});};};Av.forEach(C8,function(DA,C9){var DB=C2.getUnitByKey(C9);C7.push(C5.getUnitFormatAction(DB,1,CI(Az.GROUP_INFO,DA),true));});this.execute({execute:function(){var C9=C6.newUpdate(this,{extras:mstrmojo.DocDataService.SUPPRESS_DATA});C7.forEach(function(DA){C9.addActions(DA);},this);C9.addCallbacks({success:C4(false)});C9.submit();},urInfo:{undo:C4(true),redo:C4(false),slient:true}});},getKeepOnlyOrExcludeAction:function CK(C3,C4){var C6=this,C5={},C8,C2=C6.getSelectedViUnit(),C1=C2&&C2.boxContent,C7=!(C1&&C1.isInFilterPanel&&C1.isInFilterPanel());CX.forEach(C4,function(C9){CX.forEach(C9.data,function(DA){CX.forEach(DA,function(DB){if(Ch.isNonGroupNull(DB)){DB.eid="h"+Ch.TERSE_NULL+";"+DB.tid;}else{C8=DB.tid;if(C5[C8]===undefined){C5[C8]=!!C6.getDEObject(C8);}DB.isDe=C5[C8];}});});});return{act:"keepOnly",keyContext:C3,selectorObjects:[].concat(C4),partialRetrieval:{nodes:C7?[C3].concat(this.getSourceFilterKeys(C3)):[C3]}};},partialUpdateAndRebuildChild:function B1(C4,C1,C2){if(!C1.data&&!C1.defn){return ;}var C3=[C1.data,this.getTargetDefn(C4.k)];if(C2){C3=C3.concat([C1.defn,C2]);}this.partialUpdate.apply(this,C3);if(C4.clearCache){C4.clearCache();}return C4.parent.rebuildChild(C4);},getUpdateHiddenPanelsCallback:function A7(){var C1=this;return{success:function(C3){if(C3.pukeys){var C4=C1.getUnitDefinitions(C3.pukeys),C5=C1.partialUpdate(C3.data,C4),C2=Object.keys(C4).filter(function(C6){return Object.keys(C5.def).indexOf(C6)===-1;});C2.forEach(function(C9){var C7=C1.getWidgetId({k:C9,wid:1}),C8=C7&&mstrmojo.all[C7],C6;while(C8){C6=C8.defn;if(C6&&C6.t===mstrmojo.EnumRWUnitType.PANEL&&C8.setDirty){C8.setDirty(true);break;}C8=C8.parent;}});}}};},getUpdateHiddenLayoutsCallback:function AK(){var C1=this;return{success:function(C5){var C4=C5.pukeys&&C5.pukeys.split("\u001E");if(C4&&C4.length>0){var C2=C1.getUnitDefinitions(C4);var C3=function(C8){var C7=C8.defn;if(C7.units[C6]!==undefined){C7.loaded=false;}};for(var C6 in C2){if(C2[C6]===undefined){(C1.controller.view.getLayouts()||[]).forEach(C3);}}}}};},submitSelectorPropsChange:function A0(C1,C3,C7){var C2=this,C4=C1.defn.ck,C6=C1.k;this.controller.submitUndoRedoUpdates(Av.copy(C3,{act:"editSelectorProps",keyContext:C4,ctrlKey:C1.k,partialRetrieval:{nodes:[this.getDataService().getNodeKeyFromKeyContext(C4)]}}),{},AD.wrapMethods({success:function C5(C8){C2.partialUpdate(C8.data,C2.getTargetDefn(C6),C8.defn,[C6]);}},C7),Cw);},getObjectInfo:function CO(C1){var C2;Av.forEach(this.datasets,function(C3){if(!C2){C2=(C3.mx.concat(C3.att)).filter(function(C4){return C4.did===C1;})[0];}});return C2;},getDEObject:function Bq(C4){var C3=this.deMap=this.deMap||{},C2=C3[C4],C1;if(!C2){Av.forEach(this.datasets,function(C7,C5){C1=CX.find(C7.att,"did",C4);var C6=C7.att[C1];if(C1>=0&&C6.t===47&&C6.st===12033){C2=C6;C2.dsId=C5;C3[C4]=C2;return false;}});}return C2;},getBrowseFormTypes:function AP(C3){var C2=[],C1;Av.forEach(this.datasets,function(C4){C1=CX.find(C4.att,"did",C3);if(C1>=0){CX.forEach(C4.att[C1].fs,function(C5){if(C5.isbf){C2.push(C5.bftp);}});return false;}});return C2;},isOldDEObject:function CR(C3){var C2=false,C1;Av.forEach(this.datasets,function(C4){C1=CX.find(C4.att,"did",C3);if(C1>=0&&C4.att[C1].de){C2=true;return false;}});return C2;},changeCurrLytTabTtl:function CA(C2,C1){this.controller.view.changeCurrLytTabTtl(C2,C1);},updateRootDefn:function CM(C1){Av.copy(C1&&C1.root,this.getRootNode().defn);this.raiseEvent({name:"updateRootDefn"});},addUpdateObjects:function Ae(C2,C1){if(C2){C2.partialUpdate=C2.partialUpdate||{};C2.partialUpdate.objects=mstrmojo.array.ensureArray(C1);}return C2;},updateTypeCounter:function G(C2){var C1=CZ.call(this,C2)+1;this.obCntrs[this.getCurrentLayoutKey()][C2]=C1;return C1;},getNumberFormatAction:function BI(C6,C2,C5){var C4=this.getVIComponent(BC.FILTER_STACK),C1=C4&&C4.getFilterBySrcId(C6),C3=Av.copy({act:"numberFormat",unitId:C6,unitType:C2},this.createNumberFormatParams(C5));if(C2===4&&C1){C3.partialRetrieval={nodes:[C1.k]};}return C3;},getWSItemDragDropAction:function Bo(){var C2=mstrmojo.vi.models.ENUM_WS_ITEM_INSERT,C1=mstrmojo.vi.models.ENUM_WS_ITEM_TYPE,C3={},C4=[];C3[C1.DOSSIER]=C2.CHAPTER;C3[C1.GRID]=C2.DATASET;C3[C1.CHART]=C2.DATASET;C3[C1.DATASET]=C2.DATASET;C3[C1.REPORT]=C2.DATASET;if(this.WSItemDroppable){CX.forEach(this.WSDragItems,function(C5){if(C3[C5.type]){C5.action=C3[C5.type];C4.push(C5);}});}return C4;},getVfNdFromExpr:function BS(C2){var C1=k(C2);this.handleInvalidAQNd(C1);return C1;},handleInvalidAQNd:function BP(C4){if(C4&&C4.et===AQ.AQ&&C4.fn===AO.IS_NOT_NULL&&(!C4.fm)&&C4.a){var C1=this.getDatasetUnits(["att"],function(C6){return C6.did===C4.a.did;});if(C1.length===1){C1=C1[0];var C3=(C1.fs&&C1.fs[0])||{};C4.fm={did:C3.fid,n:C3.fnm,dtp:AV.DTP.CHAR};}}else{var C5=C4&&C4.nds||[];var C2=this;CX.forEach(C5,function(C6){C2.handleInvalidAQNd(C6);});}},getDataNode:function Bk(C3){var C2=this.getCurrentLayoutKey(),C1=this.getLayoutDataCache(this.getCurrentLayoutKey()),C5=Bv.call(this,{k:C3,wid:1},C2),C4=(mstrmojo.all[C5]&&mstrmojo.all[C5].node)||(C1&&C1[C5]);return C4&&C4.data;},getVfexprWithUpdatedVf:function Ao(C2,C6){var C5=this.getDataNode(C2),C7=Av.clone(C5&&C5.vfexpr);if(!C7){return C6;}C6=C6||{et:AQ.ANDOR,fn:AO.AND,nds:[]};var C1=this.getVfNdFromExpr(C7);if(C1){for(var C3 in C1){if(C1.hasOwnProperty(C3)){delete C1[C3];}}for(var C4 in C6){if(C6.hasOwnProperty(C4)){C1[C4]=C6[C4];}}}else{C7.node=1;C7={et:AQ.ANDOR,fn:AO.AND,node:0,nds:[C6,C7]};}return C7;},getViewFilter:function r(C1,C9){var C2=this.getDataNode(C1.nodeKey),C7=Av.clone(C2&&C2.vfexpr||{et:14,nds:[]}),C6=Av.clone(C2&&C2.vlexpr||{et:14,nds:[]}),C4=this.datasets,C3={};C7=this.getVfNdFromExpr(C7)||{et:14,nds:[]};C3.dsid=C2&&C2.datasetId||Av.keyarray(C4)[0];C3.messageID=C1.msgID;C3.expr=C7;C3.limitExpr=C6;C3.targets=[];var C5=[],C8=[];Av.forEach(C4,function(DB,DA){var DD=DA,DC=DB.name||"";CX.forEach(DB.att,function(DE){C5=C5.concat(Av.copyProps(["da","did","n","t","st","fs","lvfs","ndetype"],DE,{dsid:DD,dsName:DC,ttp:DE.n+(DC?" - "+DC:"")}));});CX.forEach(DB.mx,function(DE){if(DE.hide){return ;}C8=C8.concat({did:DE.did,st:DE.st||"1024",n:DE.n,t:DE.t,um:DE.um,dsid:DD,dsName:DC,ttp:DE.n+(DC?" - "+DC:"")});});});C3.targets=[].concat(C5).concat(C8);C9.success(C3);},isFromSolrCube:function m(C3){var C2=this.datasets[this.findDatasetIdFromUnit(C3)],C1=C2&&C2.tables&&C2.tables.length===1&&C2.tables[0];return C1&&C1.dict===131078;},isFromLiveMDXCube:function q(C2){var C1=this.datasets[this.findDatasetIdFromUnit(C2)];return C1&&this.isMDXDataset(C1)&&this.isLiveDataset(C1);},isFromMDXCube:function C0(C1){return this.isMDXDataset(this.datasets[this.findDatasetIdFromUnit(C1)]);},isMDXDataset:function BY(C1){return C1&&C1.tables&&C1.tables[0]&&C1.tables[0].xdaType===2;},isEssbaseDataset:function B2(C1){return C1&&C1.tables&&C1.tables[0]&&C1.tables[0].dbt===AM.ESSBASE;},isMSASDataset:function Bx(C1){return C1&&C1.tables&&C1.tables[0]&&C1.tables[0].dbt===AM.MSFT_AS;},isEssbaseRADataset:function BO(C3){var C2=this.isRADataset(C3),C1=this.isEssbaseDataset(C3);return C2&&C1;},isMSASRADataset:function Aq(C3){var C2=this.isRADataset(C3),C1=this.isMSASDataset(C3);return C2&&C1;},isSparkDataset:function Au(C1){if(C1&&C1.tables&&C1.tables.length>0){return C1.tables[0].xdaType===BT.sparkDataset;}else{return false;}},isDatasetFromPushApi:function b(C1){if(C1&&C1.tables&&C1.tables.length>0){var C2=C1.tables[0].dict;return C2===Y.dataFromPushApi||C2===Y.dataFromPushApiV2;}return false;},isFromFile:function Ck(C3){var C2=true,C1=[BT.text,BT.excel,BT.refine,BT.dataImportOAuthGDrive,BT.dataImportOAuthDropbox];CX.forEach(C3.tables,function(C4){if(C1.indexOf(C4.xdaType)===-1){C2=false;return false;}});return C2;},isRADataset:function BN(C1){return CX.some(C1&&C1.att,function(C2){return C2.t===c&&C2.st===CP;});},hasRADataset:function z(C1){var C2=this;return BK.call(this,C1,function(C3){return C2.isRADataset(C3);});},hasLTSDataset:function Bn(C2){var C1=false,C3=this;if(C2){CX.forEach(Av.valarray(C2),function(C4){if(C3.isLiveDataset(C4)&&C4.idd){C1=true;return false;}});}return C1;},isLiveDataset:function Aw(C1){return C1.dsm===F.dda;},hasHadoopSource:function Ca(C2){var C1=false;CX.forEach(C2&&C2.tables,function(C3){var C4=(C3.dbt===AM.BIG_DATA_ENGINE)||(parseInt(C3.dict,10)===Cu.backendSourceSubtype.hadoopFileBrowser);if(C4){C1=true;return false;}});return C1;},getDerivedMetricCount:function Ap(C2){var C1=0;if(!C2){return C1;}CX.forEach(C2.mx,function(C3){if(C3.um){C1+=1;}});return C1;},hasMDXRADataset:function AC(C1){var C2=this;return BK.call(this,C1,function(C3){return C2.isMDXDataset(C3)&&C2.isRADataset(C3);});},hasNonRADataset:function o(C1){var C2=this;return BK.call(this,C1,function(C3){return !(C2.isMDXDataset(C3)&&C2.isRADataset(C3));});},isMDXTable:function Bi(C1){return C1.xdaType===2;},isDDADataset:function CE(C1){return C1.st===779&&C1.dsm===F.dda;},isDataImportRemoteDataSource:function B6(C1){return C1.tables&&C1.tables[0]&&C1.tables[0].xdaType===400;},createNumberFormatParams:function Cc(C3){var C1=C3.category,C2={c:C1,f:C3.format};var C5=C3.decimalPlaces,C4=C3.negativeNumbers;switch(C1){case 0:C2.ndp=C5;C2.nth=C3.thousandSeparator;C2.nnn=C4;break;case 1:C2.ndp=C5;C2.ncs=C3.currencySymbol;C2.ncp=C3.currencyPosition;C2.nnn=C4;break;case 4:C2.ndp=C5;C2.nnn=C4;break;case 6:C2.ndp=C5;break;}return C2;},_selsWarningFlags:null,openSelWarnFlag:function Cg(C2){var C1=this._selsWarningFlags=this._selsWarningFlags||{};C1[C2]=true;},closeSelWarnFlag:function A5(C2){var C1=this._selsWarningFlags=this._selsWarningFlags||{};C1[C2]=false;},isSelWarnFlagOn:function E(C2){var C1=this._selsWarningFlags;if(C1){return !!C1[C2];}return false;},allowManageDocumentDataset:function Co(){return !n("web-disable-manage-document-dataset");},allowNewOrEditRolapDS:function g(){return !n("vi-unsupport-create-edit-rolap-report");},allowNewOrEditDummyDS:function CB(){return !n("vi-unsupport-create-edit-dummy-dataset");},allowSaveDataset:function Cb(){return !n("disable-save-dataset");},allowAccessDataFromFile:function Ab(){return !n("disable-access-data-from-file");},allowAccessDataFromDatabase:function AT(){return !n("disable-access-data-from-database");},allowAccessDataFromCloudApp:function Bd(){return !n("disable-access-data-from-cloud-app");},allowImportData:function BH(){return this.allowAccessDataFromFile()||this.allowAccessDataFromDatabase()||this.allowAccessDataFromCloudApp();},allowReExecuteRegularReport:function Be(){return !n("disable-reexecute-regular-report");},allowReExecuteViewReport:function Bh(){return !n("disable-reexecute-view-report");},allowReExecuteCubeReport:function d(){return !n("disable-reexecute-cube-report");},allowModifyReportList:function B8(){return n("modify-report-list");},allowWebExecuteCubeReport:function BL(){return n("web-execute-cube-report");},isSchemaDefined:function f(){return !!n("web-is-schema-defined");},isProjectLevelMCEJoinMin:function I(){return n("project-MCE-join");},hasPrivilegesForAllTables:function B3(C2){var C1=true;C2.forEach(function(C3){switch(C3.xdaType){case BT.text:case BT.excel:case BT.refine:case BT.dataImportOAuthGDrive:case BT.dataImportOAuthDropbox:if(!this.allowAccessDataFromFile()){C1=false;return ;}break;case BT.dataImportOAuthGBigQuery:case BT.dataImportOAuthGBigQueryFFSQL:case BT.dataImportOAuthGBigQuerySingleTable:case BT.qbSingleTable:case BT.ffsql:case BT.querybuilder:case BT.mdx:if(!this.allowAccessDataFromDatabase()){C1=false;return ;}break;case BT.salesforce:case BT.dataImportOAuthGAnalytics:case BT.twitter:case BT.facebook:if(!this.allowAccessDataFromCloudApp()){C1=false;return ;}break;}},this);return C1;},getOpenDatasetPanelAction:function Cj(){var C1=this.controller.rootCtrl.datasetsPanel;if(C1.getOpenStatus()!==true){C1.setOpenStatus(true,true);return[this.getUnitFormatAction(this.getRootNode(),1,{FormattingAnalysis:{DatasetObjectsVisible:true}},true)];}return[];},populateAttributeIdLinkInfo:function BW(){var C2=this.als;if(!C2){return ;}if(!C2.idLinks){C2.idLinks={};var C1=C2.idLinks;CX.forEach(C2,function(C3){Av.forEach(C3,function(DC,DD){var DB=DD.split(" "),DA=DC.split(" "),C7=DB[0],C6=DA[0],C9,C8;C1[C7]=C1[C7]||[];C9=C1[C7];CX.forEach(C9,function(DE){C1[DE]=C1[DE]||[];C1[DE].push(C6);});C1[C7].push(C6);if(!!C1[C6]){var C5=C1[C6];CX.forEach(C5,function(DE){if(DE!==C7&&C1[C7].indexOf(DE)===-1){C1[C7].push(DE);}});}C1[C6]=C1[C6]||[];C8=C1[C6];CX.forEach(C8,function(DE){C1[DE]=C1[DE]||[];C1[DE].push(C7);});C1[C6].push(C7);if(!!C1[C7]){var C4=C1[C7];CX.forEach(C4,function(DE){if(DE!==C6&&C1[C6].indexOf(DE)===-1){C1[C6].push(DE);}});}});});}},warnForEditStandaloneDS:function(C3,C1,C2){if(!C3.mngd){mstrmojo.confirm(mstrmojo.desc(15493,"Modifications to this dataset will affect other reports, documents, and dossiers that share the dataset. Do you want to continue?"),{confirmBtn:{fn:function(){C1();}},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:C2}});}else{C1();}},hasFilters:function B7(C3){var C2,C1=false;CX.forEach(this.defn&&this.defn.layouts,function(C4){if(C4.k===C3||!C3){C2=C4.units;Av.forEach(C2,function(C5){if(C5.t===CH.PANEL&&C5.isFilterPanel&&C5.ck){C1=true;return false;}});if(C1){return false;}}});return C1;},hasFiltersEx:function CD(){var C4=this.defn&&this.defn.layouts,C3=[],C2,C1=false;CX.forEach(C4,function(C5){C2=C5.units;Av.forEach(C2,function(C7,C6){if(C7.t===CH.PANEL&&C7.isFilterPanel){C3.push(C6);}});});if(C3.length>0){CX.forEach(C4,function(C5){C2=C5.units;Av.forEach(C2,function(C6){if(C6.ck&&!C6.destroyed&&CX.indexOf(C3,C6.pnk)>-1){C1=true;return false;}});if(C1){return false;}});}return C1;},getVisibleUnitKeysByType:function Bw(C3){var C5=this.getTocData(),C6,C2,C1=[],C4=function(C7,DA,C9){var C8=C9;while(CX.find(C7,"k",C8.pnk)===-1){C8=DA[C8.pnk];if(!C8||!C8.pnk||!C8.t||!(C8.t===mstrmojo.EnumRWUnitType.UNITCONTAINER||C8.t===mstrmojo.EnumRWUnitType.PANEL)){return false;}}return true;};C3=C3||[];CX.forEach(this.defn.layouts,function(C7){C2=CX.find(C5,"k",C7.k);if(C2>-1){C6=C5[C2];Av.forEach(C7.units,function(C8){if(!(C8._isDeleted||C8.destroyed)&&C3.indexOf(parseInt(C8.t,10))>-1&&C4(C6.panels,C7.units,C8)){C1.push(C8);}});}});return C1;},getEmbeddedFilter:function Bu(C3){var C2=this.defn.efs||[];var C1=CX.find(C2,"did",C3);return C1!==-1?C2[C1]:null;},createVizBoxForCustomSort:function Bs(C4,C5){var C1=this.getNodeDataByKey(C4),C6=this.getCurrentLayoutKey(),C7=function(){return C1.data;},C8=function(){return C1.defn;},C3=function(){return C1;},C2=this.createNewUnitNode(C7,C8,C3,C4,C6),C9;C2.defn.iics=true;C9=this.createUnit(C2,"",C6);C9.showTitleBar=false;C9.updateLayout(C5);return C9;},applyBufferedSelections:function p(C9){var C4=this.getVIComponent(BC.FILTER_STACK),DD=this.getVIComponent(BC.VIZ_CONTENT),C7=this.getCurrentLayoutSelectorDefn(),DA=C7.filterPanelSelectors,C6=C7.canvasSelectors,C3=Object.keys(DA).concat(Object.keys(C6)),C1=this.getCurrentLayoutDef(),DE=C1&&C1.units,C2=false,DB,C8,C5,DC=this;CX.forEach(C3,function(DF){DB=DE[DF];if(DB&&DB.cesChange&&DB.srcid){C8=DC.getNodeDataByKey(DF);if(C8&&C8.id){C5=mstrmojo.all[C8.id];if(C5&&C5.selectorControlChange&&C5.content){C5.selectorControlChange(C5.content);C2=true;}}}});if(C2){C4.applyBufferedSlices(true,C9);DD.applyBufferedSlices(true,C9);}}});mstrmojo.vi.models.DocModel.DatasetUnitType=null;mstrmojo.vi.models.DocModel.UnitFormatInfo=null;mstrmojo.vi.models.ENUM_WS_ITEM_INSERT={CHAPTER:"insertAsChapter",DATASET:"insertAsDataSet"};mstrmojo.vi.models.ENUM_WS_ITEM_TYPE={DOSSIER:"Dossier",GRID:"Grid",CHART:"Chart",DATASET:"Dataset",REPORT:"Report"};}());(function(){mstrmojo.requiresCls("mstrmojo.ui._HasScroller","mstrmojo.ME.SimpleMetricEditor","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.ME.DerivedSimpleMetricEditor=mstrmojo.declare(mstrmojo.ME.SimpleMetricEditor,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedSimpleMetricEditor",init:function C(D){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(D);},setupScrollNodes:function B(){this.scrollNode=this.containerNode;},onOpen:function A(){this._super();if(this.ide&&this.ide.action.cmd===mstrmojo.ME.ENUM.METRIC_ACTIONS.EDIT_NEW){this.dirty=true;}if(this.updateScrollbars){this.updateScrollbars();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.FunctionWizard","mstrmojo.ME._MetricEditorHelper","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(1058,1059,4046,4049,12853,13357,13358,13359,13360,13361);var K=mstrmojo.hash;var J,C;var G={First:"0",Last:"1",Current:"2",Previous:"3",Next:"4"},I=[{n:mstrmojo.desc(4046,"First"),did:G.First},{n:mstrmojo.desc(1058,"Previous"),did:G.Previous},{n:mstrmojo.desc(13361,"Current"),did:G.Current},{n:mstrmojo.desc(1059,"Next"),did:G.Next},{n:mstrmojo.desc(4049,"Last"),did:G.Last}],L={StartAt:-3,StopAt:-4};var A=function(O){var N=mstrmojo.all[J];var H=null;if(O.isParam){H=N.getParamWidget(O);}else{switch(O&&O.dtp){case L.StartAt:case L.StopAt:H={scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-olap-type-box",children:[{scriptClass:"mstrmojo.Pulldown",alias:"winType",cssClass:"mstrmojo-olapArgs-pulldown mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:{"-3":I.slice(0,4),"-4":I.slice(1)}[O.dtp],itemIdField:"did",postCreate:function(){var P=this.parent.data.type;this.value=P.v||P.dfv;},getTokens:function(){var P=this.parent.data.type;if(this.value!==P.dfv){return[{v:P.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];},onvalueChange:function(){C.onmetricModify();}},{scriptClass:"mstrmojo.ValidationTextBox",alias:"winOffset",cssClass:"mstrmojo-olap-offset",bindings:{visible:function(){return this.parent.winType.value===G.Previous||this.parent.winType.value===G.Next;}},postCreate:function(){var P=this.parent.data.offset;this.value=P.v||P.dfv;},dtp:mstrmojo.expr.DTP.INTEGER,constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},getTokens:function(){var P=this.parent.data.offset;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==P.dfv){return[{v:P.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];}},{scriptClass:"mstrmojo.Label",bindings:{visible:function(){return this.parent.winType.value===G.Previous||this.parent.winType.value===G.Next;},text:function(){return this.parent.winType.value===G.Previous?mstrmojo.desc(13357,"row(s) before current"):mstrmojo.desc(13358,"row(s) after current");}}}],getTokens:function(){var R=[],S=this.winType.getTokens(),Q=this.winOffset.getTokens(),P;P=S.length;if(P>0){R=R.concat(S);}P=Q.length;if(P>0){R.push({v:",",isDelimiter:true});R=R.concat(Q);}return R;}};break;case -2:H=N.getBreakByWidget(O);break;case -1:H=N.getSortByWidget(O);break;default:H=N.getTextWidget(O);}}if(H){H.alias="inputWidget";}return H;};mstrmojo.ME.OLAPEditor=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._MetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.OLAPEditor",init:function M(H){this._super(H);mstrmojo.css.addWidgetCssClass(this,"olap");J=this.id;C=this;},onOpen:function D(){J=this.id;C=this;this._super();var H=this.argsGrid.ctxtBuilder.itemWidgets[0].fctBox.fctPulldown;H.set("value",this.fctOi.did);if(this.updateScrollbars){this.updateScrollbars();}},setupScrollNodes:function E(){if(!mstrmojo.dom.ISIE8){this.scrollNode=this.containerNode;}},getPROPBuilder:function B(){return function(P){var N=null;if(P.isParam){var O=function(){return mstrmojo.array.map(mstrmojo.ME.MetricDataService.getOLAPAggFunctions(),function(Q){Q.dn=Q.n.substring(4);return Q;});};N={scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-olap-fctBox",alias:"fctBox",children:[{scriptClass:"mstrmojo.Pulldown",alias:"fctPulldown",cssClass:"mstrmojo-SME-funcs-pulldown mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",itemIdField:"did",itemField:"dn",items:O(),onvalueChange:function(S){var U="",Y="",X=this.selectedItem;if(X){Y=X.desc+"  "+mstrmojo.ME.MetricDataService.getFunctionHelpTopic(X.h);var W=X.pars,R=[],V,Q;R.push(X.n);R.push("(");for(V=0,Q=W.length;V<Q;V++){R.push(W[V].n);if(V!==(Q-1)){R.push(", ");}}R.push(")");U=R.join("");}C.set("fctSyntax",U);C.set("fctDesc",Y);C.set("fctName",X&&X.n);C.fctOi=X;if(S.valueWas){C.onmetricModify();}C.raiseEvent({name:"fctDidChange",did:X.did});}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-SME-agg-label",text:mstrmojo.desc(12853,"of")}]};}else{var H=(P.dtp===-1?" sortBy":"");N={scriptClass:"mstrmojo.Label",markupString:'<div id="{@id}" class="mstrmojo-DataRow-text '+H+'"title="'+(P.desc||"")+'"></div>',alias:"labelWidget",text:(P.dn||P.n)+(P.isParam?"*":"")+":"};}return N;};},getDTPBuilder:function F(){return A;},postProcessProsFromToken:function(O){var S=[],R,N,Q=O.pros,H=(Q&&Q.length)||0,P=[];for(N=0;N<H;N++){R=K.copy(Q[N]);switch(R.n){case"OLAPWinStType":S.push({n:mstrmojo.desc(13359,"Start At"),dtp:L.StartAt,type:K.copy(Q[N]),offset:K.copy(Q[++N])});break;case"OLAPWinEndType":S.push({n:mstrmojo.desc(13360,"Stop At"),dtp:L.StopAt,type:K.copy(Q[N]),offset:K.copy(Q[++N])});break;default:if(R.v!=null){P.push(R);}}}this.hiddenPs=P;return S;}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.expr","mstrmojo.ui._HasScroller","mstrmojo.SearchableDropDownList","mstrmojo.ME.FunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs(3377,11569,12179);var A,C;mstrmojo.ME.DerivedFunctionWizard=mstrmojo.declare(mstrmojo.ME.FunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.DerivedFunctionWizard",init:function F(G){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(G);A=this.id;C=this;},setupScrollNodes:function E(){this.scrollNode=this.containerNode;},onOpen:function B(){this._super();if(this.ide&&this.ide.action.cmd===mstrmojo.ME.ENUM.METRIC_ACTIONS.EDIT_NEW){this.dirty=true;}if(this.updateScrollbars){this.updateScrollbars();}},getParamObjectTypes:function D(){var G=this.opener||{};return G.getValidFuncParamTypes?G.getValidFuncParamTypes(this.fctOi):this._super();}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.ME.RepeatPulldownList","mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper","mstrmojo.RadioList");mstrmojo.requiresDescs(518,959,1885,1886,2789,11569,12170,12171,12172,12173,12176,12177,12179);var A=mstrmojo.desc;var B=function(E){if(E.onmetricModify){E.onmetricModify();}};var D=function(E){var F={ValueList:A(2789,"Rank"),ASC:A(12170,"Rank Order"),ByValue:A(12171,"Display As"),NullInclude:A(12172,"Treat Null Value As"),BreakBy:A(12173,"Break By")}[E.n];return{scriptClass:"mstrmojo.Label",markupString:'<div id="{@id}" class="mstrmojo-DataRow-text"title="'+(E.desc||"")+'"></div>',alias:"labelWidget",text:F+(E.isParam?"*":"")+":"};};mstrmojo.ME._IsRankEditor=mstrmojo.provide("mstrmojo.ME._IsRankEditor",{fctArgsDataGridCssClass:"functionArgs rank",getPROPBuilder:function C(){return D;},getDTPBuilder:function C(){var E=this;return function(G){var F=null;if(G.isParam){F=E.getParamWidget(G);}else{switch(G&&G.dtp){case 11:case 3:switch(G.n){case"ASC":F={scriptClass:"mstrmojo.Pulldown",cssClass:"asc mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:A(1885,"Ascending"),did:-1},{n:A(1886,"Descending"),did:0}],popupToBody:true,itemIdField:"did",postCreate:function(){var H=this.data;this.value=!!H.v?(H.v==="False"?0:-1):(H.dfv||0);},getTokens:function(){var H=this.data;if(this.value!==H.dfv){return[{v:H.n},{v:"=",isDelimiter:true},{v:this.value===-1?"True":"False"}];}return[];},onvalueChange:function(){B(this.parent.dataGrid.parent);}};break;case"ByValue":F={scriptClass:"mstrmojo.RadioListHoriz",itemIdField:"did",items:[{n:A(13536,"Number (1,2,3)"),did:-1},{n:A(12175,"Percentage (10%,50%,100%)"),did:0}],postCreate:function(){var I=this.data;var H=!!I.v?(I.v==="False"||parseInt(I.v,10)===0?0:-1):(I.dfv||0);this.set("selectedIndex",mstrmojo.array.find(this.items,this.itemIdField,H));},onselectionChange:function(H){if(H.removed.length===1){B(this.parent.dataGrid.parent);}},getTokens:function(){var I=this.data,H=this.selectedItem[this.itemIdField];if(H!==parseInt(I.dfv,10)){return[{v:I.n},{v:"=",isDelimiter:true},{v:H===-1?"True":"False"}];}return[];}};break;case"NullInclude":F={scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:[{n:A(959,"Default"),did:0},{n:A(12176,"First in rank"),did:-1},{n:A(12177,"Last in rank"),did:1}],itemIdField:"did",postCreate:function(){var H=this.data;this.value=H.v||H.dfv;},getTokens:function(){var H=this.data;if(this.value!==H.dfv){return[{v:H.n},{v:"=",isDelimiter:true},{v:this.value}];}return[];},onvalueChange:function(){B(this.parent.dataGrid.parent);}};break;}break;case -2:F=E.getBreakByWidget(G);break;}}F.alias="inputWidget";return F;};}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.MetricDataService","mstrmojo.ME.AttributeEditBox","mstrmojo.expr","mstrmojo.array","mstrmojo.hash");var G;var f=mstrmojo.ME.MetricDataService,V=mstrmojo.hash,N=mstrmojo.array,X=mstrmojo.ME.AttributeEditBox.getTokenStreamXML,b=mstrmojo.expr.DTP,Q={SHOW_BAND_NAMES:-4,BANDON_UNITS:-6},B={START_END:'BandNames<ResidueName="All Others">(this@ID, "#s - #e")',BAND_NUM:'BandNames<ResidueName="All Others">(this@ID, "Band #b")',BAND_NUM_START_END:'BandNames<ResidueName="All Others">(this@ID, "Band #b: #s - #e")',NO:"No"},R=[{n:mstrmojo.desc(14145,"Start - End"),v:B.START_END},{n:mstrmojo.desc(14146,"Band #"),v:B.BAND_NUM},{n:mstrmojo.desc(14147,"Band #: Start - End"),v:B.BAND_NUM_START_END},{n:mstrmojo.desc(218,"No"),v:B.NO}],K={"8107C337DD9911D3B98100C04F2233EA":"BAND_SIZE","8107C338DD9911D3B98100C04F2233EA":"BAND_COUNT","8107C339DD9911D3B98100C04F2233EA":"BAND_POINTS"},D=function(){return[];};function Z(g){return g.replace(/\s/g,"").toLowerCase();}function O(g){var h=[{v:"BandNames",tp:279,lv:1,oi:{did:"ACA96B1F9F99412B867045747DD88575",n:"BandNames",st:2816,t:11}},{v:"<",tp:60,lv:1},{v:"ResidueName",tp:259,lv:1},{v:"=",tp:282,lv:1},{v:'"All Others"',tp:261,lv:1},{v:">",tp:62,lv:1},{v:"(",tp:40,lv:1},{lv:1,tp:275,v:"this@ID"},{v:",",tp:44,lv:1}];switch(g){case B.BAND_NUM:h.push({v:'"Band #b"',tp:261,lv:1});break;case B.BAND_NUM_START_END:h.push({v:'"Band #b: #s - #e"',tp:261,lv:1});break;case B.START_END:h.push({v:'"#s - #e"',tp:261,lv:1});break;}h.push({v:")",tp:41,lv:1});return h;}function e(g){var h="";N.forEach(g.slice(1,-1),function(j){h+=j.v;});return h;}function J(g){if(g.t===4){return"BandOn";}return g.n;}function E(g){if(g.t===4){return Q.BANDON_UNITS;}return g.dtp;}var C=function(g,h){return{did:"",n:"New Attribute",forms:[{n:"ID",tks:{items:[]}}]};};function U(h,g){return h.dtp===8&&h.n==="Delimiter"?'"'+g+'"':g;}function P(k){var j=k.split(",")[0],h=j.replace(/\d$/,""),g=j.replace(h,"");return{prefix:h,startAt:parseInt(g,10)};}function L(g,h){return{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",items:g,popupToBody:true,itemIdField:"v",postCreate:function(){var j=this.data;this.value=j.v||j.dfv;},getTokens:h||D,onvalueChange:function(){G.set("dirty",true);}};}function I(h,k){var g=function(l){return l.inputWidget&&l.inputWidget.widgetName===k;},j=mstrmojo.array.filterOne(h.argsGrid.ctxtBuilder.itemWidgets,g);return j&&j.inputWidget;}var H=function(h){var g=null;switch(h&&h.dtp){case Q.SHOW_BAND_NAMES:g=L(R);g.widgetName="bandNames";g.getDescTokens=function(){var j=this.selectedItem&&this.selectedItem.v;return j===B.NO?null:O(j);};break;case Q.BANDON_UNITS:g=G.getParamWidget(h);g.widgetName="bandOn";break;case b.DOUBLE:case b.INTEGER:case b.VARCHAR:g=G.getTextWidget(h);break;default:g=G.getParamWidget(h);g.onitemsChange=mstrmojo.emptyFn;break;}if(g){g.alias="inputWidget";}return g;};var M=function(o,p,l,q){var m=o.did,j=o.n,g=o.dsid,h=o.forms,n={items:p},k=function(r){if(r.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var t,s={n:"ID",formula:r.tokenXML};if(m){s.did=h[0].did;t={act:"updateDA",name:j,dsid:g,attrId:m,isTokenStream:true,update:[s]};if(l){if(l.did&&!l.del){t.update.push(l);}else{if(l.did&&l.del){t.del=[{did:l.did}];}else{t.add=[l];}}}}else{t={act:"addDAToDataset",dsid:g,name:j,evFlags:1,isTokenStream:true,forms:[s].concat(l?[l]:[])};}q(t);};mstrmojo.ME.AttributeEditBox.validateSyntax(m,n,true,k);};var a=function(m){var l=m.forms,h=l&&l.length,k=h&&l[0],j=h&&l[1],o=N.some(k&&k.ftk,function(p){return p.oi&&K[p.oi.did];});if(!o){return false;}if(h===1){return true;}if(j&&j.ftk&&h===2){var g=false,n=Z(e(j.ftk));V.forEach(B,function(p){if(Z(p)===n){g=true;return false;}});return g;}return false;};mstrmojo.ME.BandingDAEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,null,{scriptClass:"mstrmojo.ME.BandingDAEditor",ide:null,insertMode:false,init:function W(g){this._super(g);G=this;},getDTPBuilder:function Y(){return H;},getParamObjectTypes:function S(){return[mstrmojo.expr.TP.METRIC];},getTextWidget:function c(h){var j=P(h.n).prefix;return{scriptClass:"mstrmojo.ValidationTextBox",emptyText:(h.dtp===b.DOUBLE||h.dtp===b.INTEGER)?mstrmojo.desc(14143,"Type a number"):"",postCreate:function(){this.value=(h.items&&h.items[0].v)||h.dfv;},oninput:function k(l){G.set("dirty",true);this.createNextInputParamWidget();},constraints:{trigger:mstrmojo.validation.TRIGGER.ONKEYUP,min:1},dtp:h.dtp,getTokens:function(){var l=this.data;if(!mstrmojo.string.isEmpty(this.value)&&this.value!==l.dfv){return[{v:U(l,this.value)}];}return[];},createNextInputParamWidget:function g(){var p=this.data,o=this.dataGrid,q=G._lastRpIdx;if(!(p.isRepeated&&p.rpIdx===q)){return ;}var m=q+1,n=j+m,l=mstrmojo.hash.copy({desc:n,n:n,items:null,dn:n,rpIdx:m},mstrmojo.hash.copy(p));o.items.add([l],mstrmojo.array.indexOf(o.items,p)+1);G._lastRpIdx=l.rpIdx;if(G.updateScrollbars){G.updateScrollbars();}}};},onOpen:function F(){G=this;this.oi.tks=this.oi.forms[0].tks||{items:this.oi.forms[0].ftk};this._super();if(this.updateScrollbars){this.updateScrollbars();}},insertOnFinish:function(){var l=mstrmojo.all.mstrDAE.attrEditBox,g=l.inputBox,k=I(this,"bandNames"),h=this.getTokens(),j=k.getDescTokens();g.insertTokens(h);if(j){l.tabstrip.addTab();g.insertTokens(j);}},validateAndSave:function A(n,m){var l=this,k=l.ide.action,g=n.forms,h=I(this,"bandNames"),p=h.getDescTokens(),j=V.copy(p?{n:"DESC",formula:X({items:p})}:null,g[1]?{did:g[1].did}:null),o=function(r){m();l.ide.close();var q=n.did?k.onupdate:k.oncreate;if(q){q(r);}};if(p===null&&j){j.del=true;}M.call(l,l.oi,this.getTokens(),j,o);},postProcessParamsFromToken:function(k){var m=[],l,j,h=k.pars,g=(h&&h.length)||0;for(j=0;j<g;j++){l=V.copy(h[j]);l.dtp=E(l);l.n=J(l);l.isParam=true;m.push(l);}l=m[m.length-1];if(k.rpc>0){m=m.concat(this.postProcessRepeatParam(l));}return m;},postProcessRepeatParam:function d(o){var n=P(o.n),m=n.prefix,j=n.startAt||1,g=[],l,h;o.isRepeated=true;o.rpIdx=this._lastRpIdx=j;o.n=m+(j++);var k=o.items||[];if(k.length>0){o.items=[k[0]];for(h=1;h<=k.length;h++){l=V.copy(o);l.rpIdx=j;l.n=m+(j++);l.items=(h===k.length?null:[k[h]]);g.push(l);}this._lastRpIdx=l.rpIdx;}return g;},postProcessProsFromToken:function(g){var j=[],h={dfv:B.START_END,n:"ShowBandNames",desc:mstrmojo.desc(14144,"Show band names"),dtp:Q.SHOW_BAND_NAMES};if(this.oi.forms.length>1){var k=Z(e(this.oi.forms[1].ftk));V.forEach(B,function(l){if(Z(l)===k){h.v=l;return false;}});}else{if(this.oi.did!==""){h.v=B.NO;}}j.push(h);return j;}});mstrmojo.ME.BandingDAEditor.getNewDefinition=C;mstrmojo.ME.BandingDAEditor.showAsBandingEditor=a;}());(function(){mstrmojo.requiresCls("mstrmojo.ME.OLAPEditor","mstrmojo.ME._DerivedMetricEditorHelper");mstrmojo.requiresDescs();mstrmojo.ME.DerivedOLAPEditor=mstrmojo.declare(mstrmojo.ME.OLAPEditor,[mstrmojo.ME._DerivedMetricEditorHelper],{scriptClass:"mstrmojo.ME.DerivedOLAPEditor"});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.models.XtabDropZones","mstrmojo.vi.models.EnumDragSources","mstrmojo.array");mstrmojo.requiresDescs(3631,3632,3582);var H=mstrmojo.array,B=-1,C=1,G=2;function F(){return mstrmojo.all[this.hostId];}function D(){return F.call(this).gridInfo;}mstrmojo.vi.models.GraphDropZones=mstrmojo.declare(mstrmojo.vi.models.XtabDropZones,null,{getDropZones:function E(){var I=D.call(this);return{n:F.call(this).defn.ttl,zones:[this.getZone(mstrmojo.desc(3631,"Categories"),C,I.rows),this.getZone(mstrmojo.desc(3632,"Series"),G,I.cols),this.getZone(mstrmojo.desc(3582,"Metrics"),B,I.mx)]};},getUnitMenuItems:function A(M,O,Q,P){if(!Q){throw new Error(this.scriptClass+"::getUnitMenuItems: Item must be provided.");}var N=O.items,K=N.length,L=O.id,J={zone:O,axis:L,idx:H.indexOf(N,Q),cnt:K,item:Q,metricsAxis:D.call(this).tma},I=this.id;M.addMenuItem(mstrmojo.desc(190,"Remove"),"xt",function(){mstrmojo.all[I].deleteItem(O,J.idx);});}});})();(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.InteractiveUnitList","mstrmojo.vi.ui._IsDropTarget","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus.EditorConfig","mstrmojo.vi.models.CombineDropZonesModel","mstrmojo.vi.models.DropZonesModel","mstrmojo.vi.models.EnumDragSources","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.array","mstrmojo.gm.GMEnums","mstrmojo.boxmodel","mstrmojo.tooltip","mstrmojo.vi.viz.DropZoneHelper");var N=mstrmojo.dom,C=mstrmojo.css,P=mstrmojo.hash,p=mstrmojo.array,W=mstrmojo.boxmodel,r=mstrmojo.vi.viz.EnumDSSDropZones,AL=mstrmojo.tooltip,U=mstrmojo.vi.models.DropZonesModel.ENUM_TARGET_POSITION,AG=U.ABOVE,AF=U.ON,O=U.BELOW,AH=mstrmojo.vi.models.EnumDragSources,AK="is-mh",c="icon",A="zone",H="form",S=mstrmojo.vi.viz.EnumDSSDropZones,k=mstrmojo.vi.models.CombineDropZonesModel.EnumDropZones,M=k.HORIZONTAL,Y=k.VERTICAL,x=S.XAxis,Z=S.YAxis,j=S.ColorBy,AA="mstrmojo-VIVizEditor-Menu",K=mstrmojo.gm.DualAxisSubAxisBit,X=K.SECONDARY,g=mstrmojo.vi.viz.DropZoneHelper.isMetricNames,Q=mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY;var R={};R[AG]="Top";R[AF]="";R[O]="Bottom";var o='<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}"><div class="outer-wrap"><div unselectable="on" class="inner-wrap"><span unselectable="on" class="txt">{@en@n}</span><div class="'+c+'"></div><div class="'+A+'"></div></div></div></{@tag}>';var l=[];function u(AO){var AN=Array.prototype.slice.apply(this.itemsContainerNode.childNodes),AM=function(AQ){var AP=AQ.idx===undefined?AQ:AN[AQ.idx];P.keyarray(R).forEach(function(AR){C.removeClass(AP,"dragIn"+R[AR]);});};p.forEach(AN,AM);l=[];AM(AO);}function t(AP,AS,AN){var AR=AP.y-2,AM=AP.h*this.zonesModel.getTargetEdgePortion(AN),AO=N.getMousePosition(AS).y,AQ=AF;if((AO>=AR)&&(AO<AR+AM)){AQ=AG;}else{if(AO>=AR+AP.h-AM){AQ=O;}}return AQ;}function h(AO,AM){if(!g(AO)){var AN={zone:this.zonesSource,item:AO};if(this.zonesModel.hasReplaceCandidates(AN)){var AP=this.zonesModel.getReplaceSubMenu(AN,{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11703,"Replace with:"),cssClass:"mstrmojo-menu-replaceLabel"});AP.position=AM;AP.isHostedWithin=false;AP.hostId=this.id;this.openPopup(AP.newInstance());}}}function AE(AP,AM){var AO=this.zonesSource.id;if(AO===r.Latitude||AO===r.Longitude){var AN={zone:this.zonesSource,item:AP};if(this.zonesModel.getSelectGeoFormMenu){var AQ=this.zonesModel.getSelectGeoFormMenu(AN);if(AQ){AQ.position=AM;AQ.isHostedWithin=false;AQ.hostId=this.id;this.openPopup(AQ.newInstance());}}}}function AI(){if(this.panelId==undefined){return ;}var AM=mstrmojo.all[this.panelId];if(!!AM){AM.set&&AM.set("activeZoneId",this.id);}}function G(){var AM=mstrmojo.all[this.panelId]&&mstrmojo.all[this.panelId].activeZoneId;return !AM||(AM===this.id);}function AC(AO,AM,AN){var AQ=new mstrmojo.ui.menus.MenuConfig({menuCssClass:AA,supportsScroll:true,alignWithAnchor:true,isHostedWithin:false,maxHeight:N.getMaxScrollHeight()}),AP=this.getLabelNode(AO);AN.call(this,AQ,AP);if(AQ.hasMenuItems()){AQ.position=AM;AQ.isHostedWithin=false;AQ.hostId=this.id;this.openPopup(AQ.newInstance());}}function V(Aa,AX,AU,AR){if(!this.visible&&!AR){return ;}var AT=this.content,AQ=this.contentNode,Ag=this.domNode,Ah=Ag.style;if(AQ&&AT){Ah.left=0+"px";AQ.innerHTML=AT;}mstrmojo.Tooltip.prototype.updatePosition.call(this,AR);var Ab=Ag.className,AW=(Ab&&Ab.split(" "))||[],AZ=p.indexOf(AW,"offset")!==-1;if(AZ){var AP=this.refNode,AO=AP?W.offset(AP,document.body):{left:N.getHorizontalScroll()},Ac=this.containerNode,Af=Ac.offsetWidth,AM=this.posType,AV=AM===AL.POS_BOTTOMRIGHT||AM===AL.POS_TOPRIGHT,AS=AM===AL.POS_BOTTOMLEFT||AM===AL.POS_BOTTOMRIGHT||AM===AL.POS_BOTTOMCENTER,AN=parseInt(this.left,10)+AO.left-(AV?Af:((AM.indexOf("C")>-1)?Math.floor(Af/2):0)),AY,Ae=N.windowDim(),Ad=N.getHorizontalScroll()+Ae.w;if(AN!==null&&!AV&&!AS&&AN>Ad-Af){AY=parseInt(Aa.x-6,10)+AO.left-Af;if(AY>0){this.posType=AS?AL.POS_BOTTOMRIGHT:AL.POS_TOPRIGHT;this.left=Aa.x-6;this.cssClass=AU+" vi-tooltip-D";}else{this.posType=AL.POS_BOTTOMLEFT;this.left=AX.x;this.top=AX.y-6;this.cssClass=AU+" vi-tooltip-V";}}}}mstrmojo.vi.ui.VisualizationEditorUnitList=mstrmojo.declare(mstrmojo.vi.ui.InteractiveUnitList,[mstrmojo.vi.ui._IsDropTarget],{scriptClass:"mstrmojo.vi.ui.VisualizationEditorUnitList",zonesModel:null,zonesSource:null,multiSelect:true,useListModKeys:true,useRichTooltip:true,tooltipOpenDelay:Q,hasTooltipContent:function(AM,AN){return true;},getItemTooltip:function(AQ,AT,AS){var AM=N.position(AS),AN=N.position(AT),AR=N.position(this.getLabelNode(AT));if(AS===this.getIconNode(AT)&&!g(AQ)){return{areaId:AQ._renderIdx+"icon",cssClass:"vi-regular vi-tooltip-V",contentNodeCssClass:"regular-unitlist-tooltips",posType:AL.POS_BOTTOMLEFT,content:mstrmojo.desc(11687,"Click to replace"),top:AM.y-8,left:AM.x-4};}else{if(AS===this.getZoneNode(AT)){if(AQ.geoWarning){return{areaId:AQ._renderIdx+"zone",cssClass:"vi-regular vi-tooltip-A",contentNodeCssClass:"regular-unitlist-tooltips",posType:AL.POS_TOPLEFT,content:mstrmojo.desc(14113,"Select an attribute form as geographic role"),top:AM.y+28,left:AM.x-4};}else{if(AT.className.indexOf("icz12")>0){var AP=this.zonesModel.getHost(true),AO=AP&&AP.getTtpContent4GeoItem&&AP.getTtpContent4GeoItem(AQ._renderIdx);return{areaId:AQ._renderIdx+"zone",cssClass:"vi-warning vi-tooltip-C",contentNodeCssClass:"regular-unitlist-tooltips",posType:AL.POS_TOPLEFT,content:AO||"",enableHover:true,top:AM.y-6,left:AM.x+AM.w+6,updatePosition:function(AU){return V.call(this,AN,AR,"vi-warning",AU);}};}}}}return P.copy({cssClass:"vi-regular vi-tooltip-C",posType:AL.POS_TOPLEFT,top:AN.y-2,left:AN.x+AN.w+6,keepArrowXPos:true,updatePosition:function(AU){return V.call(this,AN,AR,"vi-regular",AU);}},this._super(AQ,AT,AS));},doItemSelect:function(AO,AN){var AM=AN.hWin,AP=AN.e;if(G.call(this)||(!N.shiftKey(AM,AP)&&!N.isMetaKey(AM,AP))){AI.call(this);this._super(AO,AN);}},isDragValid:function d(AM){var AN=AM.src.e;return !(!G.call(this)&&(AN.ctrlKey||AN.shiftKey||AN.metaKey))||this._super(AM)||false;},ondragstart:function z(AM){this.isIgnoreTooltipCloseDelay=true;this.hideTooltip();this.selectDragNode(AM);this._super(AM);},onItemContextMenu:function b(AV,AU){var AR=AU.e,AN=this.getItemNodeFromTarget(AU.getTarget()),AP=AU.hWin,AO=this.getSelectedItems().some(function(AW){return AW.itemNode===AN;});if(AV&&!AO){this.doItemSelect(AV,AU);}var AS=AU.getTarget(),AT=this.getSelectedItems();if(AT.length){this.closePopup();var AQ=AT&&AT.length>1,AM=AQ?"showMultiSelectionMenu":"showItemMenu";this[AM](AQ?AT:AV,this.getItemNodeFromTarget(AS),N.getMousePosition(AR,AP));return true;}},showItemMenu:function I(AO,AN,AM){AC.call(this,AN,AM,function(AP,AQ){this.zonesModel.getUnitMenuItems(AP,this.zonesSource,AO,AQ);});},showMultiSelectionMenu:function e(AN,AO,AM){AC.call(this,AO,AM,function(AP){this.zonesModel.getMultiUnitsMenuItems(AP,this.zonesSource,AN,null);});},deleteItem:function F(AM){this.zonesModel.deleteItem(this.zonesSource,AM._renderIdx);},deleteItems:function E(AM){this.zonesModel.deleteItems(this.zonesSource,AM);},getItemProps:function q(AO,AM){var AN=this._super(AO,AM);AN.n=AN.n||"&nbsp; ";if(AO.t===4&&g(AO)){AN.addCls(AK);AN.n=mstrmojo.desc(11808,"Metric Names");}var AP=AO.zone;if((!this.zonesModel||this.zonesModel.destroyed)||this.zonesModel.shouldMetricNameShowIcon(AO,AO.zone)){if(AP!==undefined){AP="icz"+AP;if(AO.ax===X){AP+="s";}AN.addCls(AP);}}if(AO.hidden){AN.addCls("hidden");}if(AO.attn&&AO.fnm){AN.attn=AO.attn;AN.fnm=AO.fnm;}if(AO.geoWarning){AN.addCls(AO.geoWarning);}return AN;},getItemMarkup:function J(AN){var AM=o.replace("{@midTruncateCssClass}",this.midTruncateCssClass);if(AN&&AN.attn&&AN.fnm){AM.replace("{@en@n}",'{@en@attn}@<span unselectable="on" class="'+H+'">{@en@fnm}</span>');}return AM;},getDragData:function s(AM){this.selectDragNode(AM);var AO=this._super(AM),AN=this;AO.itemIdx=AM.src.node.getAttribute("idx");AO.item=this.items[AO.itemIdx];if(AO.items===undefined){AO.items=[];}if(!!AO.item&&p.find(AO.items,"did",AO.item.did)===-1){AO.items.push(AO.item);}AO.src=AH.VIZ_EDITOR;AO.srcZoneId=this.zonesSource&&this.zonesSource.id;AO.onRemove=function(AP){if(AP.length>1){AN.deleteItems(AP);}else{AN.deleteItem(AP);}};AO.allowDropOnTarget=function(AR,AQ){var AP=true;if(this.allowDropOnTarget){AP&=this.allowDropOnTarget(AQ,AR);}return AP;}.bind(AN.zonesModel,AO);return AO;},createAvatar:function f(AO,AN){var AM=this._super(AO,AN);Array.prototype.slice.call((AM&&AM.childNodes)||[]).forEach(function(AP){C.removeClass(AP,mstrmojo.vi.ui.InteractiveUnitList.CLS_HAS_X);C.addClass(AP,mstrApp.rootCtrl.view.themeClassName);},this);return AM;},getIconNode:function AJ(AN){var AM=AN.firstElementChild.firstElementChild.childNodes;return AM&&AM[1];},getZoneNode:function L(AN){var AM=AN.firstElementChild.firstElementChild.childNodes;return AM&&AM[2];},ondragover:function n(Ay){var Ab=this,AM=Ay.tgt,AW=Ab.getItemNodeFromTarget(AM.node)||AM.node,Av=parseInt(AW.getAttribute("idx"),10),Af=Ay.tgtData,Aa=Af&&Af.node,Ao=(AM.widget||{}).items,AN=Ao&&Ao[0];if(!Af||Aa!==AW){Af=Ay.tgtData={item:Ab.zonesSource.items[Av],node:AW,pos:N.position(AW,true)};if(Aa){u.call(Ab,Aa);}}u.call(Ab,AW);var Ax=this.getTargetEdgeAndIndex(Af.pos,AM.e,Ay,AW),AR=Ax&&Ax.edge,Aj=AR===AG,Ah=AR===AF,AQ=AR===O,Aq=this.getContextDragData(Ay),Ak=this.zonesModel,AY=this.zonesSource,AV=AY.id,At=Ak.getZoneSummary(AV),AS=AV===j,AP=AV===M,Aw=AV===Y,Ag=Ax&&P.copy(Ax,Ak.getAllowDropInfo(AY,Aq.items,Ax.idx,Ax.edge,Ay)),Ac=false,Ad=Ah&&Ag.removeReplaced,Al=At.attributeCount+(At.hasMetricName?1:0),As=false,AZ=Ak.isAttrCategory(AN),AX=Ak.isMetric(AN),An=Ak.isMetricName(AN);if(Ag&&Ag.allowedItems.length){var AU=this.itemsContainerNode,Ap=Array.prototype.slice.apply(AU.childNodes);if((AP||Aw)&&AX&&!Af.item&&Ak.isAttrCategory(Ag.item)&&Ao.length===1&&Ay.last.y<=Af.pos.y){As=true;}if(!!mstrApp.isWSStyling){this.parent.addBorder();}if(!Ap.length||Ap.every(function(A0){return(A0.className||"").indexOf("hidden")>-1;})){C.addClass(AU,"dragIn");this.raiseHLToggle(true);}else{var Am=Ak.getHighlightTargets(AY,Ag);p.forEach(Am,function(A7){var A0=Ap[A7.idx],A2=AY.items[A7.idx],BC=Aq.item,BB=Ak.differInType(BC,A2),A1=Ak.isMetricName(A2),BD=Ak.isMetric(A2),A3=Ak.isAttrCategory(A2),BA=BB&&BD,A5=BD&&A7.idx>Al,A4=Av===A7.idx;l.push(A2);if(AS&&(BB||BD||A1)){var A6=Ak.isAttrCategory(BC);if(A1&&A6&&(Aj||AQ)){C.addClass(A0,"dragInTop");return false;}else{C.addClass(A0,"dragIn");}}else{if((Aw||AP)&&(BA||A1)){if(As){C.addClass(A0,"dragInTop");}else{if(Ak.isMetric(BC)){if(A1){C.addClass(A0,"dragInBottom");}}else{if(A1&&AQ){C.addClass(A0,"dragInTop");return false;}else{if(!A5){Ac=(!(Aj&&A4)||Ad)&&!A1;if(!Ac){var A8=null,A9=false;p.forEach(AY.items,function(BE){if(Ak.isAttrCategory(BE)){A8=BE;}else{if(!!A8){C.addClass(Ap[A8.idx],"dragInBottom");A9=true;return false;}else{if(Ak.isMetricName(BE)){C.addClass(Ap[BE._renderIdx],"dragInTop");A9=true;return false;}else{return false;}}}});if(!A8&&!A9){C.addClass(A0,"dragIn"+R[A7.edge]);}return false;}else{C.addClass(A0,"dragIn");}}else{if(Ac){C.addClass(A0,"dragIn");}}}}}}else{if(Aw||AP){if(A3&&BB){C.addClass(A0,Ah?"dragIn":"dragIn"+R[O]);}else{C.addClass(A0,"dragIn"+R[A7.edge]);}}else{C.addClass(A0,"dragIn"+R[A7.edge]);}}}});this.raiseHLToggle(true);}if(Aq.setAvatarClass){var Ae=Aq.src,AO="";if(Ae===AH.DATASETS||Ae===AH.ALL_OBJECT_LIST){AO=Ah?"replace":"add";p.forEach(Ao,function(A0){if(A0.zone===j){var A1=0,A2=0;p.forEach(Aq.items,function(A3){if(Ak.isMetric(A3)){A1++;}else{if(Ak.isAttrCategory(A3)){A2++;}}});if(!(A1&&A2)&&(Ak.differInType(A0,Aq.item)||Ak.isMetric(Aq.item))){AO="replace";}}if((A0.zone===x||A0.zone===Z)&&Ak.differInType(A0,Aq.item)){if(!Ah&&Ak.isMetric(Aq.item)){AO="add";}else{AO="replace";}}});if(AP||Aw){if(As){AO="add";}else{if(AN){var Ar,Ai,AT=Ak.isAttrCategory(Aq.item);if(AZ&&AT){var Az=true;AO=Ah?"replace":"add";for(Ar=0;Ar<l.length;Ar++){Ai=l[Ar];if(!Ai&&!Ai.hasOwnProperty("idx")){var Au=parseInt(Ai.getAttribute("idx"));Ai=AY.items[Au];}if(Ak.isMetric(Ai)){if(Az){AO=Aj?"add":"replace";}else{AO="replace";}Az=false;}}}else{if((AX||An)&&AT){AO=Ac?"replace":"add";}}}}}}else{if(Ae===AH.VIZ_EDITOR||Ae===AH.VIZ){AO=(Aj||AQ||AM.node===AU)?"move":(Ah?"replace":"");}}Aq.setAvatarClass(AO);}}else{if(Aq.setInvalidAvatarClass){Aq.setInvalidAvatarClass();}}},getDropAvatarIcon:function B(AO){var AP=AO.getCtxtDragData(),AM=AP.src,AN=this.zonesSource.getDropIconCls(AP);if(AM===AH.DATASETS||AM===AH.ALL_OBJECT_LIST){AN="add";}return AN;},ondrop:function m(AN){this.ondragover(AN);var AU=AN.tgt,AR=AN.src&&AN.src.data,AO=AR&&AR.src,AM=this.getTargetEdgeAndIndex(AN.tgtData.pos,AU.e,AN,this.getItemNodeFromTarget(AU.node)||AU.node),AT=this.zonesModel,AV=this.zonesSource,AW=AM&&P.copy(AM,AT.getAllowDropInfo(AV,AN.getCtxtDragData().items,AM.idx,AM.edge,AN));if(AW&&AW.allowedItems.length&&AO!==AH.VIZ_LAYER){AT.getHost().model.addEditNodeForDatasetAction(AN,AT.getHost().k);var AP=function(){AT.unitsDropped(AV,AN,AW);};if(AO===AH.ALL_OBJECT_LIST){var AS=AN.src.widget,AQ=AS&&AS.dataProvider;if(AQ){AQ.loadObjects(AW.allowedItems,{success:AP},true);}}else{AP();}}this._super(AN);},allowDrop:function D(AN){var AO=AN.getCtxtDragData(),AM=AO.src;if(AM===AH.DATASETS||AM===AH.VIZ_EDITOR||AM===AH.ALL_OBJECT_LIST||AM===AH.VIZ){return this.zonesModel.isZoneDropAllowed(this.zonesSource,AO);}return false;},onclick:function v(AM){var AO=AM.target||N.eventTarget(AM.hWin,AM.e),AN=this.getItemFromTarget(AO);if(AN!==undefined){switch(AO.className){case c:N.preventDefault(window,AM.e);AO=AM.getTarget();AN=this.getItemFromTarget(AO);if(AN){AM.cancel();this.closePopup();h.call(this,AN,N.getMousePosition(AM.e,AM.hWin));}break;case A:case H:N.preventDefault(window,AM.e);AO=AM.getTarget();AN=this.getItemFromTarget(AO);if(AN&&(AN.geoWarning||(AN.attn&&AN.fnm))){AM.cancel();this.closePopup();AE.call(this,AN,N.getMousePosition(AM.e,AM.hWin));break;}default:this._super(AM);}}},cleanUpAfterTarget:function w(AM){var AN=AM.tgtData;if(AN){u.call(this,AN.node);if(!!mstrApp.isWSStyling&&this.parent.clearBorder){this.parent.clearBorder();}this.raiseHLToggle(false);}this._super(AM);},clearBorderClasses:u,raiseHLToggle:function AB(AN){var AM;try{this.parent.parent.parent.model.raiseEvent(P.copy({name:"viVizEditorDrag",isIn:AN,id:this.parent.parent.parent.viPanelType},AM));}catch(AO){}},getTargetEdgeAndIndex:function AD(AN,AQ,AM,AR){if(N.contains(this.itemsContainerNode,AR,true,this.domNode)){var AT=AM.tgtData.item,AU=(this.items||[]).length-1,AO=t.call(this,AN,AQ,AM);if(AT){AU=AT._renderIdx;}else{var AP=N.getMousePosition(AQ).y,AS=AP>AN.y;if(AS){AO=O;}else{AU=0;AO=AG;}}return{item:AM.getCtxtDragData().item,edge:AO,idx:Math.max(AU,0)};}return null;},twoClicksItem:function a(AO,AM){var AP=this.getLabelNode(this.getItemNodeFromTarget(AM.getTarget())),AQ=new mstrmojo.ui.menus.MenuConfig({menuCssClass:AA});this.zonesModel.getUnitMenuItems(AQ,this.zonesSource,AO,AP);var AN=AQ.menus;if(p.some(AN,function(AR){return AR.n===mstrmojo.desc(1388,"Rename");})){this.zonesModel.renameItem(AP,AO);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.toolbars._HasToolbar","mstrmojo.vi.ui._IsUnitDependentPanel","mstrmojo.vi.ui.PanelPortlet","mstrmojo.vi.ui.VisualizationEditorPanelPortlet","mstrmojo.vi.ui.VisualizationEditorUnitList","mstrmojo.array","mstrmojo.hash","mstrmojo.css","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(14389,15643);var F=mstrmojo.array,C=mstrmojo.hash,G=mstrmojo.css,E=mstrmojo.dom;mstrmojo.vi.ui.VisualizationEditor=mstrmojo.declare(mstrmojo.vi.ui.BoxPanel,[mstrmojo.vi.ui._IsUnitDependentPanel,mstrmojo.vi.ui.toolbars._HasToolbar],{scriptClass:"mstrmojo.vi.ui.VisualizationEditor",markupString:'<div id="{@id}" class="mstrmojo-VIBoxPanel {@cssClass}" style="{@cssText}"><div class="mstrmojo-VIBoxPanel-control"></div><div class="mstrmojo-VIBoxPanel-content"></div><div class="mstrmojo-VIBoxPanel-mask"></div><div class="mstrmojo-VIBoxPanel-Editor-disabled"><div class="mstrmojo-VIBoxPanel-Editor-disabled-icon"></div><div class="mstrmojo-VIBoxPanel-Editor-disabled-text">'+mstrmojo.desc(15643,"Editor panel is not applicable for current container. It is for visualizations.")+"</div></div></div>",markupSlots:{controlNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.childNodes[1];},maskNode:function(){return this.domNode.lastChild;},editorNode:function(){return this.domNode.childNodes[3];}},activeZoneId:"",layoutConfig:{h:{controlNode:"25px",containerNode:"100%"},w:{controlNode:"100%",containerNode:"100%"},xt:true},onvisibleChange:function H(K){if(this.viPanelType===mstrmojo.vi.ui.BoxPanel.PANEL_TYPES.DROP_ZONES&&K.value){this.refresh();}},init:function I(K){this._super(K);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VIVizEditor");},onactiveZoneIdChange:function D(K){var L=K.valueWas;if(L){mstrmojo.all[L].clearSelect();}},onVIUnitSelected:function B(L){var Y=L&&L.getZonesModel(),Q=Y&&Y.getDropZones(),Z=this.contents,X=this.id;G.toggleClass(this.domNode,"empty",!Q);var a=this.parent.tabList,W=a.items,P=mstrmojo.array.find(W,"id",mstrmojo.vi.ui.BoxPanel.PANEL_TYPES.DROP_ZONES);var U=this.editorNode;if(U){if(Y==null){if(P!==-1){a.disableItem(P);}U.style.visibility="visible";}else{if(P!==-1){a.enableItem(P);}U.style.visibility="hidden";}}if(Q){var V=(!!mstrApp.isWSStyling)?"mstrmojo.vi.ui.VisualizationEditorPanelPortlet":"mstrmojo.vi.ui.PanelPortlet";var S=function(d){return{scriptClass:d.scriptClass==="mstrmojo.gmaps.MapLayerZone"?"mstrmojo.vi.ui.PanelPortlet":V,title:d.n,panelId:X,canCollapse:false,enabled:d.enabled,portletSrc:d,children:[d]};},c=function(e){var d={scriptClass:V,title:e.n,getTitleBarCfg:function(){return C.copy({useRichTooltip:true,shouldShowTooltip:function(){return true;},getTooltipContent:function(){return e.title;}},this.constructor.prototype.getTitleBarCfg.call(this));},panelId:X,canCollapse:false,enabled:e.enabled,portletSrc:e,children:[{scriptClass:"mstrmojo.vi.ui.VisualizationEditorUnitList",items:e.items,alias:"unitList",cssClass:e.cssClass,panelId:X,zonesModel:Y,zonesSource:e}]};if(e.siblings){d.children=d.children.concat(e.siblings);}return d;},W=[],R=Y.docModel.datasets,b=function(d){(d||[]).forEach(function(e){if(e.usedInDropZones){e.usedInDropZones=false;}});},M=function(d,f){var e=F.find(d,"did",f.did);if(e>-1){d[e].usedInDropZones=true;return true;}return false;},O=new mstrmojo.ui.menus.ToolbarConfig({supportsScroll:true,alignWithAnchor:true,isHostedWithin:false,maxHeight:E.getMaxScrollHeight()});(Q.zones||[]).forEach(function(d){W=W.concat(d.items);});if(Y.canSwapAxis()){O.addToolbarBtn(mstrmojo.desc(11658,"Swap"),"swap",function(){Y.swapAxis();});}else{O.addDisabledToolbarBtn(mstrmojo.desc(11658,"Swap"),"swap");}if(Y.canDefineSubtotals()){O.addToggleToolbarButton(mstrmojo.desc(6193,"Show Totals"),"totals",function(){Y.showQuickSubtotals();},function(){Y.hideDefinedSubtotals();},null,Y.hasVisibleSubtotals());}else{O.addDisabledToolbarBtn(mstrmojo.desc(6193,"Show Totals"),"totals");}var K=function(j,h){var g=j&&j.boxContent,e=g&&g.isVisMap,f,d=h.docModel;if(!mstrApp.isInVFConfigMode&&g.isInFilterPanel&&g.isInFilterPanel()){if(e){f=d.clearVisAsFilterActionForMapLayer(j,g.getEditingHost(),false);}else{f=d.clearVisAsFilterAction(j,false);}}h.clearAllDropZones(f);};O.addToolbarBtn(mstrmojo.desc(14389,"Remove Data"),"clearall",function(){K(L,Y);});Z.addChildren([{scriptClass:"mstrmojo.vi.ui.toolbars.Toolbar",alias:"toolbar",visible:true,useRichTooltip:true,cssClass:"VizEditorToolbar",getItemMarkup:function N(d){return this.constructor.prototype.getItemMarkup.call(this,d).replace("{@en@n}",'<div class="icn"></div>');},getLayoutOffsets:function(){return{w:6};}}]);Z.toolbar.set("toolbarCfg",O);C.keyarray(R).forEach(function(d){b(R[d].att);b(R[d].mx);(W||[]).forEach(function(e){if(!M(R[d].att,e)){M(R[d].mx,e);}});});(Q.zones||[]).forEach(function(d){if(d.scriptClass){Z.addChildren([S(d)]);}else{Z.addChildren([c(d)]);}});this.activeZoneId="";this.generateToolbar();}this.doLayout();this.updateGeoItemsIcon(L);},updateGeoItemsIcon:function A(M){var L=M&&M.boxContent,K=L&&L.isVisMap;if(K){L.showInfoIcon4GeoItem();}},updateToolbar:function J(K){var M=this.targetUnit,N=M&&M.getZonesModel(),L="editor_panel.htm";if(mstrApp.allowWebDashboardDesign()){this.addRenameTargetMenuItem(K);}if(N&&N.help){L=N.help;}this.addHelpTopicMenuItem(K,mstrmojo.desc(1143,"Help"),L);return this._super(K);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.Editor","mstrmojo.tooltip","mstrmojo.SearchWidget","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.Enum","mstrmojo.ME.FunctionInfo");mstrmojo.requiresDescs(13141,9590,4561,9591,3273,9592,9579,9593,3324,9594,11656,11657,4565,9595,9925,1088,13141,9563,9597,221);var R=mstrmojo.hash,X=mstrmojo.dom,M=mstrmojo.css,Z=mstrmojo.ME.Enum.SHORTCUT_FUNCTIONS;var D={n:mstrmojo.desc(9590,"Search Result"),did:-1,fns:[]},E={n:mstrmojo.desc(4561,"All Functions"),did:-2,fns:[]},Q={n:mstrmojo.desc(9591,"Metric Templates"),did:-3,fns:[{n:mstrmojo.desc(3273,"Level"),did:Z.Level,desc:mstrmojo.desc(9592,"Create a level metric."),h:"standard_functions_Level"},{n:mstrmojo.desc(9579,"Condition"),did:Z.Condition,desc:mstrmojo.desc(9593,"Create a conditional metric."),h:"standard_functions_condition"},{n:mstrmojo.desc(3324,"Transformation"),did:Z.Transformation,desc:mstrmojo.desc(9594,"Create a transformation metric."),h:"standard_functions_transformation"},{n:mstrmojo.desc(11656,"Row Count"),desc:mstrmojo.desc(11657,"Row Count calculates the total number of rows in the dataset."),did:Z.Row_Count,tks:{items:[{v:"Count",tp:280,oi:{n:"Count",did:"8107C31CDD9911D3B98100C04F2233EA",t:11,st:2816}},{v:"<",tp:60},{v:"Null",tp:259},{v:"=",tp:282},{v:"True",tp:299},{v:",",tp:44},{v:"UseLookupForAttributes",tp:259},{v:"=",tp:282},{v:"False",tp:300},{v:">",tp:62},{v:"(",tp:40},{v:'"*"',tp:261},{v:")",tp:41},{v:"{",tp:123},{v:"~",tp:126},{v:"}",tp:125}]}}]},G={n:mstrmojo.desc(4565,"Select a category:"),did:-4,fns:[]},F=function(a,b){var c=a.functionList;a.openWizard(c.items[c.selectedIndex],b);},H=function(){return mstrmojo.hash.copy(mstrmojo.ME.ENUM.NEW_METRIC_DEFINITION);};var Y=function(b){var a="mstrmojo-ME-fct-tip",c=this.tooltip&&this.tooltip.domNode;if(c){M.toggleClass(c,a,b);}};mstrmojo.ME.FunctionSelector=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.FunctionSelector",title:mstrmojo.desc(9595,"Select a function or template"),help:"Select_a_Function_dialog_box.htm",isDME:false,functions:null,includeFakeFuncs:true,functionItems:null,selectedCategory:1,selectedIndex:-1,init:function U(a){this._super(a);M.addWidgetCssClass(this,"mstrmojo-FunctionSelector");},getFunctionSyntax:function L(h,c){var e=this.functionItems;if(!e){return"";}var g=e[h].fns[c];if(g.did<0){return g.n;}var a=g.pars,k=g.pros,j=[],b,d;j.push(g.n);k=mstrmojo.hash.clone(k)||[];if(g.ios){k.push({n:"SortBy"});}if(g.sqt===5){k.push({n:"BreakBy"});}if(this.showFullSyntax){if(k.length>0){j.push("<");for(b=0,d=k.length;b<d;b++){j.push(k[b].n);j.push(", ");}j.pop();j.push(">");}}j.push("(");for(b=0,d=a.length;b<d;b++){j.push(a[b].n);if(b!==(d-1)){j.push(", ");}}j.push(")");return j.join("");},getFunctionDesc:function P(d,a){var c=this.functionItems;if(!c){return"";}var b=c[d].fns[a];return mstrmojo.ME.FunctionInfo.getDescAndExample(b).desc;},getFunctionHelpTopic:function O(d,a){var c=this.functionItems;if(!c){return"";}var b=c[d].fns[a];if(b.did===Z.Row_Count){return"";}return mstrmojo.ME.MetricDataService.getFunctionHelpTopic(b.h);},getMetricDefAsTokens:function S(){return this.getTokens();},getTokens:function K(){var b=this.functionList,a=b.items[b.selectedIndex],c=[];if(a){if(a.did<-1){switch(a.did){case -7:c=a.tks.items;break;case -4:case -5:case -6:break;}}else{c.push({v:a.n,oi:a,isNew:true});}}return c;},onfunctionsChange:function W(){if(!this.functions){return ;}this.selectedCategory=0;this.set("selectedCategory",1);this.set("selectedIndex",-1);var c=mstrmojo.hash.clone(this.functions),a=c.length;if(!c.add){c=R.make(c,mstrmojo.Arr);}if(a>=1&&this.includeFakeFuncs){var b=c[mstrmojo.ME.MetricDataService.getBasicCategoryIndex(c)];b.fns.push(Q.fns[0]);if(!this.isDME){b.fns.push(Q.fns[1]);b.fns.push(Q.fns[2]);}else{b.fns.push(Q.fns[3]);}}this.set("functionItems",c);},onPreClose:function N(){this.cleanup();return true;},cleanup:function I(){this.searchWidget.clearSearch();this.set("selectedIndex",-1);},handleCloseAction:function C(){this.close();},clearSearchResult:function V(b){var c=this.fcHBox.fcPulldown,d=this.functionItems,a=d.length-1;if(a>-1&&d[a]===D){if(this.selectedCategory===a){if(b!==false){this.set("selectedCategory",1);this.set("selectedIndex",-1);}}d.remove(a);c.refresh();}},clearSearchPattern:function A(){var a=this.searchWidget;if(a&&a.hasRendered){a.reset();this.clearSearchResult(false);}},openWizard:function J(d,c){var b=this,a;if(mstrmojo.ME.MetricDataService.isBasicAggMap(d.did)||d.did<-1){a={zIndex:b.zIndex+10,did:d.did,oi:H};a.insertMode=false;a.id="mstrSME";}else{a={functions:mstrmojo.ME.MetricDataService.getFunctionCatList(),fctOi:d,zIndex:b.zIndex+10,oi:H};a.id="mstrFE";}a.insertMode=this.insertMode;if(a.insertMode){a.insertOnFinish=this.insertOnFinish;}b.switch2Editor(a.id,a);},handleSelectedFunction:function(a){F(this);},onshowFullSyntaxChange:function B(){this.functionList.onchange();},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-FunctionSelector-label",text:mstrmojo.desc(9925,"Functions")},{scriptClass:"mstrmojo.SearchWidget",alias:"searchWidget",cssClass:"mstrmojo-FunctionSelector-search",width:"65px",quickSearch:true,placeholderText:"",onsearch:function(h){var a=this.parent,g=a.fcHBox.fcPulldown,e=a.functionItems,j=a.functionList.itemDisplayField,f=[],b=function(l){var k=mstrmojo.hash.copy(l),n=k.n,m;try{m=new RegExp(h,"ig");}catch(o){m=new RegExp(mstrmojo.string.regEscape(h),"ig");}if(m.test(n)){k[j]=n.replace(m,function(p){return"<em>"+mstrmojo.string.encodeHtmlString(p)+"</em>";});f.push(k);}},c,d;for(c=0,d=e.length;c<d;c++){if(e[c]===D||e[c].did===E.did){continue;}if(h){mstrmojo.array.forEach(e[c].fns,b);}}D.fns=f;if(e[e.length-1]!==D){e.add([D]);}g.refresh();a.selectedCategory=0;a.set("selectedCategory",e.length-1);a.set("selectedIndex",-1);},onclear:function(a){if(a){this.parent.clearSearchResult();}}},{scriptClass:"mstrmojo.HBox",alias:"fcHBox",cssClass:"mstrmojo-FunctionSelector-fctBox",children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"mstrmojo-ME-Pulldown",popupCssClass:"mstrmojo-ME-Pulldown-Popup",alias:"fcPulldown",itemIdField:"did",itemField:"n",items:[],bindings:{items:function(){var b=this.parent.parent.functionItems,c=[];if(!b){return b;}c=mstrmojo.ME.MetricDataService.sortFunctions(b);if(b[0].did!==E.did){var a=E;a.fns=c;b.unshift(a);}return b;},selectedIndex:"this.parent.parent.selectedCategory",value:function(){var a=this.parent.parent.selectedCategory;return this.items[a][this.itemIdField];}},onvalueChange:function(a){var b=this.parent.parent;b.set("selectedCategory",this.selectedIndex);b.set("selectedIndex",-1);if(a.valueWas===D.did&&this.selectedItem.did!==D.did){this.parent.parent.clearSearchPattern();}}}]},{scriptClass:"mstrmojo.ME.FunctionList",alias:"functionList",itemIdField:"dssid",itemField:"n",itemDisplayField:"dn",items:[{n:"",cls:"wait"}],cssClass:"mstrmojo-FE-functionList mstrmojo-suggest-list",renderOnScroll:false,itemMarkupFunction:function(d,a,c){var b="mstrmojo-Button mstrmojo-Editor-button mstrmojo-WebButton tbFunction";if(!mstrApp.isWSStyling){b+=" hot";}return'<div class="mstrmojo-suggest-text '+(d.cls||"fn")+'" idx="'+a+'"'+(d.did<0?'did="'+d.did+'"':"")+" onmouseover=\"mstrmojo.all['"+c.id+"'].onmouseover(this, event)\" onmouseout=\"mstrmojo.all['"+c.id+"'].onmouseout(this, event)\">"+((c.itemDisplayField&&d[c.itemDisplayField])||d[c.itemField])+'<div class="'+b+'" t="edt"><div class="mstrmojo-Button-text" t="edt">'+mstrmojo.desc(1088,"Edit")+"</div></div></div>";},bindings:{items:function(){var a=this.parent.functionItems,b=this.parent.selectedCategory;return(a&&a[b].fns)||this.items;},selectedIndex:"this.parent.selectedIndex"},buffer:"",onkeypress:function(m){var l=this,h=m.e,d=h.keyCode||h.charCode,n=mstrmojo.Enum_Keys,a=function(p){var o=(X.isIE&&!X.isIE9)?p.keyCode:p.charCode;return(o>0)?String.fromCharCode(o):"";},j=this.items,g=j.length,b=this.selectedIndex,c=function(e){l.scrollTo(e);};switch(d){case n.UP_ARROW:this.set("selectedIndex",(b+g-1)%g);break;case n.DOWN_ARROW:this.set("selectedIndex",(b+1)%g);break;default:var f=(this.buffer+=a(h));if(g>0&&f.length>0){mstrmojo.array.forEach(j,function(p,k,e){var o=new RegExp("^"+f,"i");if(o.test(p[l.itemField])){if(k>-1){this.selectedIndex=-1;this.set("selectedIndex",k);}return false;}},this);}}if(this.selectedIndex>-1){c(this.selectedIndex);}window.clearTimeout(this.tmr);this.tmr=window.setTimeout(function(){l.buffer="";},300);mstrmojo.dom.stopPropogation(m.hWin,h);return false;},onkeyup:function(a){this.onkeypress(a);},onchange:function(a){var c=this.parent;if(this.selectedIndex!==c.selectedIndex){c.set("selectedIndex",this.selectedIndex);}var e=c.selectedCategory,b=c.selectedIndex,d=e>-1&&b>-1;c.set("funcSyntax",d?c.getFunctionSyntax(e,b):"");c.set("funcDesc",d?c.getFunctionDesc(e,b)+"  "+c.getFunctionHelpTopic(e,b):"");if(this.changeByMouse){if(c.selectedCategory>-1&&c.selectedIndex>-1){c.handleSelectedFunction(false);}this.changeByMouse=false;}},onmouseup:function(a){var c=a.getTarget(),b=c.getAttribute("t");if(b==="edt"){mstrmojo.dom.stopPropogation(a.hWin,a.e);mstrmojo.dom.preventDefault(a.hWin,a.e);this.openFunctionEditor();return false;}},openFunctionEditor:function(){var c=this.parent.parent.parent,d=c.getTokenInputBox(),a={zIndex:c.zIndex+1,insertMode:true,oi:mstrmojo.ME.ENUM.getNewDefinition(),insertOnFinish:function(e){d.insertTokens(e);}},b=this.parent.functionList.selectedItem;if(c.isBanding&&c.isBanding(b.did)){a={zIndex:c.zIndex+1,insertMode:true,fctOi:b,id:"mstrBDAE_1",oi:mstrmojo.ME.BandingDAEditor.getNewDefinition(),ide:c};}else{if(mstrmojo.ME.MetricDataService.isBasicAggMap(b.did)||b.did<-1){a.candidates=d.candidates;a.did=b.did;a.id="mstrSME_1";a.useGUIDefault=true;}else{a.fctOi=b;a.id="mstrFE_1";a.paramItemsPath=c.feParamItemsPath;}}a.modal=true;c.getModalEditor(a).open(c);},ondblclick:function(a){var c=this.getItemNodeFromTarget(a.getTarget());if(c){var b=this.parent;if(b.selectedCategory>-1&&b.selectedIndex>-1){b.handleSelectedFunction(true);}}},useRichTooltip:false,onmouseover:function(c,k){var m=this,b=this.parent,l=b.selectedCategory,f=c.getAttribute("idx"),d=X.eventTarget(window,k),a=d.getAttribute("t")==="edt";if((!isNaN(f)&&f>-1)||a){window.clearTimeout(m.hideTmr);var j='<dl class="fct-info"><dt class="fct-syntax">'+b.getFunctionSyntax(l,f)+'</dt><dd class="fct-desc">'+(b.getFunctionDesc(l,f)+"  "+b.getFunctionHelpTopic(l,f))+"</dd></dl>";var n=mstrmojo.dom.position(c,true),o=function(){var p=(m.tooltip&&m.tooltip.domNode.offsetWidth+15)||200,e=n.x,t=n.y-c.offsetHeight/2,s=e<p?"left":"right",r=e<p?mstrmojo.tooltip.POS_TOPLEFT:mstrmojo.tooltip.POS_TOPRIGHT;e=e<p?n.x+n.w+8:e-10;return{arrow_css:s,contentNodeCssClass:"me-tooltip-content "+s,posType:r,left:e,top:t};},h=o(),g="hidden";m.richTooltip=a?m.getEditBtnTooltip(d,f,h):{cssClass:g,contentNodeCssClass:"me-tooltip-content "+h.arrow_css,posType:h.posType,left:h.left,top:h.top,content:j,areaId:f};m.useRichTooltip=true;m.hasOpenTooltip=false;m.showTooltip();window.clearInterval(m.posTmr);var q=0;if(!m.posTmr){m.posTmr=window.setInterval(function(){if(m.tooltip){var r=m.tooltip.domNode,p=r.childNodes[1].firstChild,e=h.posType;h=o();if(h.posType!==e){r.style.left=h.left+"px";M.addClass(p,[h.arrow_css]);}window.setTimeout(function(){M.removeClass(r,g);},10);window.clearInterval(m.posTmr);delete m.posTmr;}else{if(q++>10){window.clearInterval(m.posTmr);}}},200);}Y.call(this,!a);}},getEditBtnTooltip:function(b,c,a){if(a){return{posType:mstrmojo.tooltip.POS_TOPLEFT,content:mstrmojo.desc(13141,"Edit function parameters"),top:a.top+50,left:a.left+200,cssClass:"vi-regular vi-tooltip-A"};}return{posType:mstrmojo.tooltip.POS_TOPRIGHT,contentNodeCssClass:"me-tooltip-content regular up tbFunction",top:28,left:67,refNode:b,content:mstrmojo.desc(13141,"Edit function parameters"),areaId:c};},onmouseout:function(){var a=this;this.hideTmr=window.setTimeout(function(){Y.call(a);a.hideTooltip();a.useRichTooltip=false;},500);}},R.copy({slot:"buttonNode",cssText:"text-align: center; float:left;",text:mstrmojo.desc(9563,"Switch to Formula Editor"),title:mstrmojo.desc(9597,"Build a metric formula using metrics, facts, attributes and functions."),closeAfterSwitch:false,getEditor:function(){return this.parent;},postclick:function(){this.getEditor().buttonNode.style.visibility="hidden";},bindings:{visible:function(){return !this.parent.insertMode;}}},R.copy(mstrmojo.ME._MetricEditorHelper.switchRef)),{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-ME-buttonBox",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){this.parent.parent.handleCloseAction();}}]}]});}());(function(){mstrmojo.requiresCls("mstrmojo.List","mstrmojo.ui._HasScroller");var E=mstrmojo.dom;mstrmojo.ME.FunctionList=mstrmojo.declare(mstrmojo.List,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.ME.FunctionList",setupScrollNodes:function D(){this.scrollNode=this.itemsContainerNode;this.scrollNode.style.height=this.scrollboxNode.offsetHeight+"px";this.scrollboxNode=this.itemsContainerNode;},getItemNodeFromTarget:function C(H){var G=mstrmojo.dom.findAncestorByAttr(H,"idx",true,this.domNode);return(G&&G.node)||null;},premousedown:function A(H){this.changeByMouse=false;if(E.isPrimaryMouseBtn(H.e)){var I=this.getItemNodeFromTarget(H.getTarget()),G=I&&parseInt(I.getAttribute("idx"),10);if(G!==null&&!isNaN(G)&&G!==this.selectedIndex){this.domNode.tabIndex=0;this.domNode.focus();this.changeByMouse=true;}this._super(H);}},getDragData:function B(G){return{item:this._super(G)};},premouseup:function F(G){if(E.getButton(G.hWin,G.e)===E.MOUSE_BUTTON.LEFT){this._super(G);return true;}mstrmojo.dom.stopPropogation(G.hWin,G.e);mstrmojo.dom.preventDefault(G.hWin,G.e);return false;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.RepeatPulldownList","mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME._DerivedMetricEditorHelper","mstrmojo.ME._IsRankEditor","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs();var B=mstrmojo.mstr.EnumDSSXMLObjectTypes;mstrmojo.ME.DerivedRankEditor=mstrmojo.declare(mstrmojo.ME.DerivedFunctionWizard,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ME._IsRankEditor],{scriptClass:"mstrmojo.ME.DerivedRankEditor",init:function A(C){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(C);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.dom","mstrmojo.Editor","mstrmojo.SaveAsEditor","mstrmojo.UUID","mstrmojo._FormatDefinition","mstrmojo.ME.MetricDataService","mstrmojo.ME.MetricFormatEditor","mstrmojo.ColorPicker","mstrmojo.ME.MetricEditBox","mstrmojo.InlineEditBox","mstrmojo.MenuButton","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.FunctionSelector","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.fe.FilterUtils","mstrmojo.ExpressionToolbar");mstrmojo.requiresDescs(517,1907,2213,2827,9559,9562,11897);var I=mstrmojo.desc,D=mstrmojo.array,R=mstrmojo.dom,J=mstrmojo.hash,C=mstrmojo.UUID,U=mstrmojo.mstr.EnumDSSXMLObjectTypes,H=mstrmojo.mstr.EnumDSSXMLObjectSubTypes,S=mstrmojo.fe.FilterUtils.getExprXml;var P={functionSelector:0,advanced:65536,simple:131072,func:196608},M=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS;function B(V,X){var W=[];V.oi.tks.met=P.functionSelector;V.oi.tks.items=W;X.oi=V.oi;X.clearTokens(W);}mstrmojo.ME.MetricEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.ME._MetricEditorHelper],{scriptClass:"mstrmojo.ME.MetricEditor",cssClass:"mstrmojo-MetricEditor",zIndex:10,title:I(517,"Metric"),help:"Metric_Formula_Editor.htm",init:function Q(V){this._super(V);this.formulaLabel.set("visible",mstrApp&&mstrApp.isWSStyling);},getMetricEditBox:function K(){return this.metricEditBox;},getTokenInputBox:function K(){return this.metricEditBox.inputBox;},isEmpty:function L(){return this.getMetricDefAsTokens().length===0;},onObjectInsert:function N(W){var X=this.metricEditBox.inputBox,V={v:mstrmojo.ME.MetricToken.brackets(W.n),oi:W,isNew:true};X.insertTokens([V]);this.closePopup();},onOpen:function F(){var V=this.oi,W=this.metricEditBox,X=W.inputBox;this._setupCandidatesCache(X);X.noCache=this.noCache;X.useKeyDelay=this.useKeyDelay;this.set("title",I(9559,"Formula Editor:")+" "+V.n);if(V&&V.tks){this.preprocessTokenStram(V.tks);X.oi=V;X.set("items",V.tks.items);this.originTks=J.clone(V.tks.items);this.originAfb=V.mps&&V.mps.afb;this.originSfb=V.mps&&V.mps.sfb;}W.set("iStatus","");W.set("vStatus",V.tks.items.length>0?this.vStatus:mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN);if(X.items.length===0){this.set("cValid",false);}},getMetricDefAsTokens:function O(){return(this.oi.tks.items);},onClose:function E(){if(this._super){this._super();}this.vStatus=mstrmojo.ME.MetricEditBox.VALIDATION_STATUS.UNKNOWN;this.metricEditBox.inputBox.oi=null;this.metricEditBox.inputBox.editNode.onblur=null;this.metricEditBox.inputBox.resetTokensCache();},handleValidation:function G(V){this.metricEditBox.handleValidation(V);},clientSideValidation:function A(V){this.metricEditBox.clientSideValidation(V);},children:[mstrmojo.ME._MetricEditorHelper.formatAndOptionsBarRef,mstrmojo.ME._MetricEditorHelper.nameEditBoxRef,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-ME-formula-label",alias:"formulaLabel",text:I(1907,"Formula")},{scriptClass:"mstrmojo.ExpressionToolbar",alias:"metricEditorOperators",onmouseup:function(W){var X=mstrmojo.dom.eventTarget(W.hWin,W.e),V=X.getAttribute("idx")||-1;this.validate(W,V);},validate:function(c,b){this.set("selectedIndex",b);var a=this.parent,W=a.metricEditBox,Y=W.inputBox,X=this.selectedItem,e=X&&X.v.split(""),Z=[];if(!X){return ;}if(R.getButton(c.hWin,c.e)===R.MOUSE_BUTTON.LEFT){switch(X.t){case 1:D.forEach(e,function V(f){Z.push({v:f,isDelimiter:true,isNew:true});},this);var d=Y.insertTokens(Z);if(Z.length===2){Y._delaySetTextCaretPos(Y.itemsContainerNode.childNodes[d-1],1);}break;case 2:W.set("vStatus",M.VALIDATING);a.tbValidate=this;a.validateSyntax(this);break;case 3:B(a,Y);Y.raiseChangeEvent({type:"clear"});break;}}}},{scriptClass:"mstrmojo.ME.MetricEditBox",alias:"metricEditBox",bindings:{browseItemVisible:"!this.parent.isDME",candidates:"this.parent.candidates"},ontokensModify:function(W){this.parent.onmetricModify();var V=this.inputBox.items.length;this.parent.set("cValid",V>0);if(V===0){this.parent.btnSwitch.set("enabled",true);}},continueValidataion:function(){var V=this.parent;V.validateSyntax(V.tbValidate);},validateFunc:function(V){this.parent.parent.metricEditorOperators.validate(V,7);},editEmbeddedFilterToken:function(Y){var Z=this.parent;if(Z.openConditionMetricFilterEditor){var d=Z.dsUnits,b=[],e=[],f=mstrApp.getRootController().docCtrl.model,c=f&&f.getDataService(),V;D.forEach(d&&d.items,function(g){if(g.t===U.Attribute){b.push(g);}else{if(g.t===U.Metric){e.push(g);}}});var a=Y.data&&Y.data.oi;var X=a&&a.condition||f.getEmbeddedFilter(a&&a.did);V=X&&X.exp;var W=function(h){V=h.expr;var j=C.create(),g=j;var k=function(){var l=Y.data;if(V){l.oi={did:j,n:g,t:U.Filter,st:H.Filter,isEmbedded:true,condition:{did:j,exp:V}};l.v=g;}else{l.v=" ";l.oi=null;}Y.set("data",l);Z.onmetricModify();};if(V){c.createEmbeddedFilter({expr:S(V),expJson:V,filterId:j,filterName:g},{success:function(){k();}});}else{k();}};Z.openConditionMetricFilterEditor({filter:V,att:b,mx:e,docModel:f,invalidItems:[],fnOk:W,onCancel:mstrmojo.emptyFn,browseParam:function(g){g.messageID=f.mid;g.datasetID=f.findDatasetIdFromUnit(g.attributeID);}});}}},{scriptClass:"mstrmojo.Button",alias:"btnSwitch",cssClass:"mstrmojo-ME-switch mstrmojo-Editor-button mstrmojo-WebButton",text:I(9562,"Switch to Function Editor"),bindings:{enabled:function(){var W=this.parent.metricEditBox.vStatus===M.ERROR&&!this.parent.cValid,V=parseInt(this.parent.oi.tks.met,10),X=!W&&(!V||(V&&V!==P.advanced));return X;}},onclick:function(){var W=this.parent;var V=function(a){var b=a.oi,Y=b.tks.met||P.functionSelector,X={zIndex:a.zIndex+1,candidates:a.candidates,oi:b,did:b.did,insertMode:false},c={0:"functionSelector",131072:"simpleMetricRef",196608:"wizard"}[Y],Z={0:"mstrFSE",131072:"mstrSME",196608:"mstrFE"}[Y];if(Y===P.functionSelector||Y===P.func){X.functions=a.functions;}if(c){if(a.dirty){X.dirty=a.dirty;}if(a.mptf){X.mptf=a.mptf;}a.switch2Editor(Z,X);}};if(W.metricEditBox.inputBox.items.length===0){W.close();W.ide.browsersContainer.funcBrowser.handleSelectedFunction();}else{W.cbSwtichEditor=V;W.tbValidate=this;W.validateSyntaxAndSwitch(this,"switch");}},slot:"buttonNode"},mstrmojo.ME._MetricEditorHelper.buttonBarRef]});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.Container","mstrmojo.vi._MonitorsAppState","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.models.FormatModel","mstrmojo.vi.ui.rw._SavesChildPositions","mstrmojo.vi.ui._HasBoxLayout","mstrmojo.vi.ui.BoxPanelContainer","mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.VisualizationEditor","mstrmojo.vi.ui.VIBoxPropertyEditor","mstrmojo.vi.ui.BoxLayoutConfig","mstrmojo.vi.ui.rw.DocRootBoxLayoutConfig","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.DocDataService","mstrmojo.boxmodel","mstrmojo.dom","mstrmojo.array","mstrmojo.func","mstrmojo.hash");mstrmojo.requiresClsP("mstrmojo.vi.models","VIComponentMap","EnumPanelTypes");mstrmojo.requiresClsP("mstrmojo.vi.ui","_HasBoxLayout","BoxPanelContainer","BoxPanel","VisualizationEditor","VIBoxPropertyEditor");var h=mstrmojo,W=h.vi.models,j=h.array,x=h.func,Z=h.boxmodel,Q=h.dom,R=h.hash,q=h.models.FormatModel,u=q.getFormatUpdate,m=q.ENUM_PROPERTY_NAMES,J="layout",U="c",f=W.VIComponentMap.TYPES,M=h.vi.ui.BoxPanel.PANEL_TYPES,AC=M.DROP_ZONES,v=M.PROPS,P=M.FILTERS,K=h.DocDataService.RAPID_EXEC,b=h.EnumRWUnitType,p=W.EnumPanelTypes,I,l=mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.LAYOUT;var s={};s[AC]={n:mstrmojo.desc(11312,"Editor"),cls:"edt",id:AC};s[v]={n:mstrmojo.desc(1918,"Format"),cls:"prp",id:v};s[P]={n:mstrmojo.desc(6189,"Filter"),cls:"flt",id:P};function AA(AH){if(AH==="filterPanel"){return P;}return AH==="editPanel"?AC:v;}function n(AH){return AH.src.data.tabInfo;}function V(AH){if(AH.t===U){AH.k=mstrmojo.all[AH.id].getIdentifier();}else{j.forEach(AH.children,function(AI){V(AI);});}return AH;}function AD(AI,AH,AJ){return AH.getLayoutVIMap(AI.getCurrentLayoutKey()).getComponent(AJ);}function N(AI,AH){return AD(AI,AH,f.FILTER_STACK);}function a(AL,AJ,AH){var AM=AL.id,AK={model:AJ,viPanelType:AM,layoutKey:AJ.currlaykey};switch(AM){case AC:return new mstrmojo.vi.ui.VisualizationEditor(AK);case v:if(!mstrApp.allowWebDashboardDesign()){return null;}return new mstrmojo.vi.ui.VIBoxPropertyEditor(AK);default:var AI=N(AJ,AH);if(AI){AI.viPanelType=AM;return AI;}return null;}}function AB(AI,AJ,AK,AL){if(AI.t===U){var AQ=AI.k;if(!AQ){return[];}if(AQ===J){AI.id=AL.id;}else{var AM=[];AQ.split("|").forEach(function(AW,AR){var AU=AW.length-1,AT=AW.charAt(AU)==="*";if(AT){AW=AW.substr(0,AU);}var AS=s[AW],AV=a(AS,AJ,AK);if(AV){AV.setOpenStatus(true,true,null);AM.push({panelItem:AS,panelEditor:AV,idx:AR,isSelected:AT});}});if(AM.length>0){var AH=new mstrmojo.vi.ui.BoxPanelContainer({model:AJ});AI.id=AH.id;AM.forEach(function(AR){AH.addPanel(AR.panelItem,AR.panelEditor,AR.idx,AR.isSelected);});return[AH];}return[];}}else{var AP=AI.children,AN=[],AO=[];j.forEach(AP,function(AS){var AR=AB(AS,AJ,AK,AL);if(AS.k===J||AR.length>0){AO.push(AS);}AN=AN.concat(AR);});if(AP.length!==AO.length){AI.children=AO;}return AN;}return[];}function E(){return j.filter(this.children,function(AH){return AH instanceof mstrmojo.vi.ui.BoxPanelContainer;});}function k(AH,AL){var AJ=this.boxLayoutConfig;var AI=(!!mstrApp.isWSStyling)?["174",100]:["185",100];AJ.useDefaultBox([{},this.docLayout],AI);var AK=AJ.box.children;AJ.setVizGalleryOpen(!!AL);AK[0].k=AH.map(function(AN,AM){return AN+(!AM?"*":"");}).join("|");AK[1].k=J;if(!AK[0].k){AK.shift();}if(mstrApp.isAppStatePresentation()){g(AK);}}function L(AL){var AK=this.model,AJ=this.builder,AM=JSON.stringify(AL);if(AL&&AM.match('"k":"(1|2|3)')){AL=null;}AL=AL&&JSON.parse(AM.replace(/vi_edt/g,AC));if(mstrApp.isAppStatePresentation()){g(AL&&AL.children);}var AN=this.boxLayoutConfig=new mstrmojo.vi.ui.rw.DocRootBoxLayoutConfig({hostId:this.id,identifier:"id",box:AL,padding:mstrApp.getThemeProps(l).dlvPadding});if(!AL){var AH=[],AO=AK.getVIPanelKeyFromUnits(mstrmojo.vi.models.EnumPanelTypes.VISUALIZATION),AI=AK.getUnitDefinitions(AO);AI=AI&&AI[AO];if(!(AI&&!AI.dzv)){AH.push(AC);}if(N(AK,AJ)){AH.push(P);}if(AH.length>0){AH.push(v);}k.call(this,AH,true);}E.call(this).forEach(function(AP){this.removeChildren(AP);AP.unrender();},this);this.addChildren(AB(AN.box,AK,AJ,this.docLayout));}function g(AI){var AH=-1;if(!AI){return ;}j.forEach(AI,function(AK,AJ){if(AK.k.indexOf(M.FILTERS)>-1){AH=AJ;}});if(AH>-1&&AH!==AI.length-1){AI.push(AI.splice(AH,1)[0]);}}mstrmojo.vi.ui.rw.DocLayoutViewer=mstrmojo.declare(mstrmojo.Container,[mstrmojo.vi.ui._HasBoxLayout,mstrmojo.vi._MonitorsAppState,mstrmojo.vi._MonitorsLayoutMode,mstrmojo.vi.ui.rw._SavesChildPositions],{scriptClass:"mstrmojo.vi.ui.rw.DocLayoutViewer",markupString:'<div id="{@id}" class="mstrmojo-VIDocLayoutViewer {@cssClass}" style="{@cssText}"></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},docLayout:null,editorPanel:null,model:null,builder:null,margin:8,init:function z(AH){this._super(AH);if(!!mstrApp.isWSStyling){this.margin=mstrApp.getThemeProps(l).dlvMargin;}if(mstrApp.isAppStatePresentation()||mstrApp.isLayoutModePreview()){this.isBoxLayoutDirty=true;}this.model.attachEventListener("updateRootDefn",this.id,function(){if(!this.parent){this.isBoxLayoutDirty=true;}});},updateRootBoxLayout:function O(){L.call(this,this.model.getRootNode().defn.layoutXML);},onAppStateChange:function o(AH){if(this.model.getCurrentLayoutKey()===this.k){I=!!this.getViPanel("filterPanel");this.changePanelsVisibility();}this._super(AH);},shouldSaveSplitterMoves:function F(){return false;},getSplitterHost:function C(){return this.containerNode;},preBuildRendering:function B(){var AK=this.parent;if(AK){var AJ=AK[this.slot].style,AI=this.height,AH=this.width;this.height=parseInt((AI&&AI!=="auto")?AI:AJ.height,10)+(mstrApp.getThemeProps(l).dlvLOH_Compensation)-this.margin+"px";this.width=parseInt((AH&&AH!=="auto")?AH:AJ.width,10)-this.margin+"px";}this.bs=this.model.bs;return this._super();},onRender:function D(){this._super();this.updateRootBoxLayout();if(!!mstrApp.isWSStyling){this.boxLayoutConfig.padding=mstrApp.getThemeProps(l).dlvPadding;}this.buildBoxLayout();delete this.isBoxLayoutDirty;},destroy:function t(){this._super();this.controller.view.raiseEvent({name:"destroyLayout",key:this.k});},getLayoutOffsets:function H(){return{h:this.margin-mstrApp.getThemeProps(l).dlvLOH_Compensation,w:this.margin};},beginBoxMove:function Y(AJ,AH,AK){var AI=n(AJ);this._super(AJ,AH,!!(AI&&!AI.isSingleTab)||AK);},endBoxMove:function d(AI,AH){this._super(AI,AH);if(!n(AI)){this.getSplitterHost().appendChild(AH.domNode);}},getBoxLayoutSaveAction:function S(AJ){var AI=this.model,AH={};u(m.USE_PAGE_WIDTH_AS_LAYOUT_WIDTH,true,AH);u(m.MARGIN_LEFT,0,AH);u(m.MARGIN_RIGHT,0,AH);var AK=[AI.getUnitFormatAction(AI.getRootNode(),1,u(m.LAYOUT_XML,V(AJ)))];AI.defn.layouts.forEach(function(AL){AK.push(AI.getUnitFormatAction({k:AL.k,defn:AL},1,JSON.parse(JSON.stringify(AH))));});return AK;},getChildPositionActions:function G(){var AS=this._super(),AV=this.builder,AL=this.model,AT=N(AL,AV),AK=AD(AL,AV,f.MAIN_CONTENT),AP=AD(AL,AV,f.PAGEBY_STACK),AN=AD(AL,AV,f.VIZ_CONTENT),AU=Q.position(AT&&AT.domNode),AM=Q.position(AK.domNode),AX=Q.position(AP&&AP.domNode),AJ=Q.position(AN.domNode),Ab=5,AW=Math.abs(AU.x-AM.x)>Ab,AZ=AW?"x":"y",AI=AU[AZ]<AM[AZ],AQ=(AT&&AT.getFilters().length>0),Aa=Q.position(mstrApp.rootCtrl.view.domNode).w,AH=2,AO=19;AU.x=AU.y=0;AM.x=AM.y=0;AX.x=AX.y=0;AJ.x=AJ.y=0;if(AT){AU.w=AU.w||parseInt(AT.width,10);AU.h=AU.h||parseInt(AT.height,10);}if(AI&&AQ){AM[AZ]=AU[AZ==="x"?"w":"h"];}else{if(!AI){AU[AZ]=AM[AZ==="x"?"w":"h"];}}if(AP&&AP.visible){AJ.y+=AX.h;var Ac=AP.unit;if(Ac){var AY=Ac.ckey;AS.push(AL.getDimensionAndPositionAction({k:AY,defn:AL.getCurrentLayoutDef().units[AY]},AX));}}if(AQ){if(AW){AM.w=AJ.w=Aa-AU.w;}}else{AM.w=AJ.w=Aa;}AJ.w-=AH;AJ.h-=AH;var AR=[undefined,AU,AM,AX,AJ];AL.defn.layouts.forEach(function(Ad){AS.push(AL.getUnitFormatAction({k:Ad.k,defn:Ad},1,u(m.PAGE_WIDTH,Z.px2Inches(AL.getZoomProps(),Aa))));Object.keys(p).forEach(function(Af){var Ae=AL.getVIPanelKeyFromUnits(p[Af],Ad.k);AS.push(AL.getDimensionAndPositionAction({k:Ae,defn:Ad.units[Ae]},AR[p[Af]]));});});AL.defn.layouts.forEach(function(Ad){Object.keys(Ad.units).forEach(function(Aj){var Ai=Ad.units,Al=Ai[Aj],An=(Al&&Al.t)||b.LAYOUT,Ak=Al.layoutXML;if(Al&&(Al._isDeleted||Al.destroyed)){return ;}if(An===b.SUBSECTION){var Ah=R.copy(AM);Ah.h+=2;AS.push(AL.getDimensionAction({k:Aj,defn:Al},Ah));}else{if(An===b.GRID||An===b.GRAPH||An===b.GRIDGRAPH){var Ae=Al&&Al.vis;if(Ae){if(Ae.we&&Ae.wcn){var Am=this.builder.visList.findVisName(Ae.wcn);if(Am){AS.push(AL.getUnitChangeVizAction(Am,Ae.wcn,{k:Aj,defn:Al}));}}}}}if(Ak!==undefined){var Af=new mstrmojo.vi.ui.BoxLayoutConfig({box:Ak,padding:0,getBoxChildClass:function(Ap){var Ao=mstrmojo.vi.ui.BoxLayoutConfig.prototype.getBoxChildClass(Ap);if(Ao){return Ao;}return AV.getPortletClass(Ai[Ap.k]);}}),Ag=this.calculateBoxLayout(Af,{height:AJ.h-AH-AO,width:AJ.w-AH,top:AJ.y,left:AJ.x}).box;Object.keys(Ag).forEach(function(Ap){var Ao=Ag[Ap].dim;AS.push(AL.getDimensionAndPositionAction({k:Ap,defn:Ai[Ap]},{h:(parseInt(Ao.height,10)-AH)+"px",w:(parseInt(Ao.width,10)-AH)+"px",x:Ao.left,y:Ao.top}));});}},this);},this);return AS;},getViPanel:function AF(AJ){var AH=this.docLayout.getViPanel(AJ);if(!AH){var AI=AA(AJ);E.call(this).every(function(AK){AH=AK.getPanelByType(AI);return !AH;});}return AH;},getPanelTypeFromKey:function X(AH){if(AH===P){return"filterPanel";}return AH===AC?"editPanel":"propertiesPanel";},getPanelItems:function AE(){return s;},getSelector:function A(){return this.docLayout.selector;},openViPanel:function w(AP,AQ,AM,AH){var AJ=AA(AP),AL=E.call(this)[0],AN=this.model,AO=this.builder,AI=this.id,AK=function(){var AU=mstrmojo.all[AI],AV=AN.getDataService().newUpdateWithoutCmd();if(AL){var AS=s[AJ],AR=a(AS,AN,AO);AL.addPanel(AS,AR,NaN,true);if(AR){AR.setOpenStatus(true,false,AV);}}else{k.call(AU,[AJ],AU.boxLayoutConfig.isVizGalleryOpen());var AT=AB(AU.boxLayoutConfig.box,AN,AO,AU.docLayout);AU.addChildren(AT);AT.forEach(function(AX){var AW=AX&&AX[AJ];if(AW){AW.setOpenStatus(true,false,AV);}});if(!AH){AU.buildBoxLayout();}}if(!AM){AU.saveBoxLayout(undefined,undefined,AQ,AV);AV.addExtras(K);AV.submit();}mstrApp.rootCtrl.generateToolbar();};if(AJ!==P||N(AN,AO)){AK();}else{AN.loadHiddenFilterStack(AO,function(){AK();});}},changePanelsVisibility:function c(){var AL=this.controller,AH=AL._oldBoxLayout,AK=["propertiesPanel","editPanel"],AJ,AM,AI=function(AN){AN.forEach(function(AP){var AO=this.getViPanel(AP);if(AO){AO.setOpenStatus(false,true,undefined,true);}},this);};if(mstrApp.isAppStatePresentation()){AL._oldBoxLayout=R.clone(this.getBoxLayoutConfig().box);AI.call(this,AK);if(I){AL._oldBoxLayoutWithFilter=R.clone(this.getBoxLayoutConfig().box);}AJ=this.getViPanel("filterPanel");AM=AJ&&AJ.contents;if(AM&&AM.empty){AJ.setOpenStatus(false,true,undefined,true);}g(this.getBoxLayoutConfig().box.children);this.model.updateRootDefn({root:{layoutXML:this.getBoxLayoutConfig().box}});}else{if(mstrApp.isAppStatePrintPreview()){AL._oldBoxLayout=R.clone(this.getBoxLayoutConfig().box);AI.call(this,["propertiesPanel","editPanel","filterPanel"]);this.model.updateRootDefn({root:{layoutXML:this.getBoxLayoutConfig().box}});}else{if(AH){this.model.updateRootDefn({root:{layoutXML:AH}});this.updateRootBoxLayout();delete AL._oldBoxLayout;delete AL._oldBoxLayoutWithFilter;}}}},syncFilterPanelStack:function r(){var AJ=this.model,AI=this.controller,AM=AJ.getVIComponent(mstrmojo.vi.models.VIComponentMap.TYPES.FILTER_STACK),AK=this.getViPanel("filterPanel"),AH=AM&&AM.isEmpty(),AL=!!mstrApp.isWSStyling;if(I){if(AH&&!AK){L.call(this,AI._oldBoxLayoutWithFilter);this.buildBoxLayout();}if(!AH&&AK&&!AL){AK.setOpenStatus(false,true,undefined);}}},getBoxLayoutConfig:function AG(){var AH=this.boxLayoutConfig;if(AH){V(AH.box);}return AH;},saveBoxLayout:function e(AL,AJ,AN,AM,AH){var AI=this.model,AK=this.getBoxLayoutConfig();if(AK){AN=AN||{};x.wrapMethods({success:function(){AI.updateRootDefn({root:{layoutXML:AK.box}});}},AN);}this._super(AL,AJ,AN,AM,undefined,AH);}});mstrmojo.vi.ui.rw.DocLayoutViewer.getViPanelType=function(AH){return AA(AH);};}());(function(){mstrmojo.requiresCls("mstrmojo.DocBuilder","mstrmojo.vi.ui.rw.selectors.DocSelectorViewFactory","mstrmojo.ui.BuilderBox","mstrmojo.ExpressVisList","mstrmojo.hash","mstrmojo.array","mstrmojo.string","mstrmojo.DynamicClassFactory","mstrmojo.EnumRWUnitType","mstrmojo.vi.ui.ScrollableDocTextfield","mstrmojo.DocHTMLContainer","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi.ui.rw.DocQuillTextField");mstrmojo.requiresClsP("mstrmojo.vi.models","DocXtabModel","DocVisModel","EnumPanelTypes","XtabDropZones","GMDropZones","MapDropZones","MapboxDropZones","ImageLayoutDropZones","CombineDropZonesModel","PanelFormatSaver","VIComponentMap","GraphDropZones","BaseVisDropZones","HeatMapDropZones","NetworkDropZones","KPICardDropZones");mstrmojo.requiresClsP("mstrmojo.vi.models.editors","TextEditorModel","ImageEditorModel","HtmlContainerEditorModel","HeatMapEditorModel","ImageLayoutEditorModel","NetworkEditorModel","BaseEditorModel","XtabEditorModel","MapEditorModel","MapboxEditorModel","GMEditorModel","KPICardEditorModel");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","DocLayoutViewer","DocLayout","DocSection","DocSubsection","Xtab","CustomSortXtab","ImageBox","FilterPanelStack","FilterPanel","FilterPortlet","DocVIPanelStack","DocVIMainPanel","DocVIVisualizationsPanelStack","DocRelativePanel","VizBox","DocTextfield","DocQuillTextField","DocImage","TextBox","FilterBox","ImageBox","HtmlBox","_IsViewDataGrid");var R=mstrmojo.hash,h=mstrmojo.array,Y=mstrmojo.DynamicClassFactory.newComponent,m=mstrmojo.vi.models.editors,H=mstrmojo.vi.models.VIComponentMap.TYPES,k=mstrmojo.vi.models.EnumPanelTypes,c=k.FILTERS,l=k.PAGEBY,J={},C=mstrmojo.vi.viz.EnumVizStyles,d=mstrmojo.elementHelper,V=mstrmojo.EnumRWUnitType,Q=mstrmojo.DocSelector.STYLES,Z=mstrmojo.string.escapeIllegalXML;J[V.IMAGE]="mstrmojo.vi.ui.rw.ImageBox";J[V.TEXTFIELD]="mstrmojo.vi.ui.rw.TextBox";J[V.HTMLCONTAINER]="mstrmojo.vi.ui.rw.HtmlBox";J[V.SELECTOR]="mstrmojo.vi.ui.rw.FilterBox";var D="containerNode";var X=function B(){this.parent.set("unit",this.unit);};function j(u){var t=u.defn.psType;if(!t){return 0;}return parseInt(t,10);}function n(u,AC){var z=u.defn,AD=u.data.elms,x=u.data.ces||[],AE=u.data.unset,v=AC.isSelectionExcluded&&AC.isSelectionExcluded(),t=AC.isDynamicAttributeSelector&&AC.isDynamicAttributeSelector(),AA="";if(!z.sec||t){return"";}if(z.style===Q.SEARCH_BOX){if(!z.sos&&(h.find(x,"v",d.ELEM_ALL_ID)>-1||x.length===0||AE)){return"";}AA=d.buildElemsCountStr(x,[]);}else{if(z.style!==Q.SCROLLER){if(z.multi){if(AE&&(!x||x.length===0)){AA=d.buildElemsCountStr(AD,AD);}else{var AF={};h.forEach(AD,function(w){AF[Z(w.v)]=true;});var AB=h.filter(x,function(w){return AF[Z(w.v)];});AA=d.buildElemsCountStr(AB,AD,v);}}else{AA=d.buildElemsCountStr(AD,AD);}}}return AA;}function I(v,w,u,t){var z=R.walk(u.scriptClass,window),AA=new t({docModel:v}),x=new z({id:w.id,node:w,controller:this.parent.controller,model:v,edtModel:AA});x.addDisposable(AA);x.edtModel.hostId=x.id;return x;}mstrmojo.vi.ui.DocBuilder=mstrmojo.declare(mstrmojo.DocBuilder,null,{scriptClass:"mstrmojo.vi.ui.DocBuilder",viMap:null,defaultSlot:D,visList:mstrmojo.ExpressVisList,init:function q(t){if(this._super){this._super(t);}this.viMap={};},createSelectorFactory:function g(){return new mstrmojo.vi.ui.rw.selectors.DocSelectorViewFactory({docBuilder:this});},createClassMap:function e(){var t=this._super();t[V.LAYOUT]={n:"Layout"};t[V.SUBSECTION]={n:"DocSubsection"};t[V.PANELSTACK]={n:"PanelStack"};t[V.PANEL]={n:"Panel"};t[V.IMAGE]={n:"Image",scriptClass:"mstrmojo.vi.ui.rw.DocImage"};t[V.TEXTFIELD]={n:"Textfield",scriptClass:"mstrmojo.vi.ui.rw.DocQuillTextField"};return t;},isPortlet:function s(u){var t=u.t;return !!((u.httl||this._super(u))||t===V.TEXTFIELD||t===V.IMAGE||t===V.SELECTOR||t===V.HTMLCONTAINER);},extractWidget:function M(u,t){return this._super(u,t)||j(t)===l;},getPortletClass:function N(t){return(t&&J[t.t])||"mstrmojo.vi.ui.rw.VizBox";},createPortlet:function f(AG,v,AE,AF){var x=j(v);if(x){if(x===c){return null;}return AE;}var AA=v.defn,z=this.getLayoutVIMap(AA._lkz);if(AA.iifp){AE.alias="selector";return new mstrmojo.vi.ui.rw.FilterPortlet({title:AA.ttl||"",children:[AE],panelId:z.getComponent(H.FILTER_STACK).id,k:AE.k,isCollapsed:parseInt(AA.ds,10)===1,count:n(v,AE),srcId:AE.defn.srcid,height:AA.fmts.height});}var AD=AF&&AF.pk;if(AD){if(z.getComponentKey(H.PAGEBY_PANEL)===AD){return AE;}if(z.isRelativePanel(AD)){var AC=AA.fmts,u=AC.left,AB=AC.top,AH=R.walk(this.getPortletClass(AA),window);AC.left=0;AC.top=0;AE.slot="containerNode";AE.alias="boxContent";return new AH({title:AA.ttl||"",children:[AE],k:AE.k,defn:AA,model:this.model,height:AC.height,width:AC.width,top:AB,left:u,nk:AA.fgk||AF.fgk});}}},newLayout:function G(v,AA){var u=AA.data,t=AA.defn,x,w,AB={alias:"layoutViewer",n:t.title||mstrmojo.desc(3437,"Layout")+" 1",numDupl:t.numDupl||0,model:v,node:AA,controller:this.parent.controller,tbc:t.tbc,slot:D,ifs:u.ifs,gb:u.gbys};x=new mstrmojo.vi.ui.rw.DocLayoutViewer(AB);w=x.defn=R.copy(t);w.fmts=R.copy(t.fmts);this.viMap[AA.k]=this.addDisposable(new mstrmojo.vi.models.VIComponentMap());var z=new mstrmojo.vi.ui.rw.DocLayout({cssClass:"mstrmojo-VILayout",slot:"containerNode",id:AA.id,k:AA.k,rules:t.rules,builder:this,node:AA,defn:t,model:v});x.addChildren([z]);return x;},removeVIMapRef:function L(t){var u=this.viMap[t];h.removeItem(this.disposables,u);u.destroy();delete this.viMap[t];},newSection:function b(t,u){return this.newRWUnitInstance(t,u,mstrmojo.vi.ui.rw.DocSection,{slot:D});},newDocSubsection:function E(t,u){return this.newRWUnitInstance(t,u,mstrmojo.vi.ui.rw.DocSubsection,{slot:D});},newTextfield:function r(w,x,v){var u=x&&x.data,z=u&&u.v,AA=!!(z&&z.indexOf("\u00df")>=0),AB=!!(mstrApp.isQuillFlag),t=AB?(AA||!z):AA;v.scriptClass=t&&AB?"mstrmojo.vi.ui.rw.DocQuillTextField":"mstrmojo.vi.ui.rw.DocTextfield";return I.call(this,w,x,v,m.TextEditorModel);},newImage:function F(u,v,t){return I.call(this,u,v,t,m.ImageEditorModel);},newHTMLContainer:function W(v,w,u){var t=this.newRWUnitInstance(v,w,(w.defn.ht===1)?mstrmojo.vi.ui.ScrollableDocTextfield:mstrmojo.DocHTMLContainer,{formatHandlers:{domNode:["D"]}});t.edtModel=new m.HtmlContainerEditorModel({hostId:t.id,docModel:v});return t;},newPanelStack:function O(t,w){var v=w.defn,z=0,u={id:w.id,node:w,k:w.k,controller:this.parent.controller,model:t,builder:this},x;switch(j(w)){case c:z=H.FILTER_STACK;x=mstrmojo.vi.ui.rw.FilterPanelStack;u.cssClass="mstrmojo-VIFilterStack";u.title=t.getCurrentLayoutDef().title;break;case k.VIS_CONTENT:z=H.MAIN_CONTENT;x=mstrmojo.vi.ui.rw.DocVIPanelStack;u.cssClass="mstrmojo-VIMainVizPanel";u.slot=D;break;case l:if(v.empty===true){return ;}z=H.PAGEBY_STACK;x=mstrmojo.ui.BuilderBox;u.height="45px";u.slot=D;u.onunitChange=X;break;case k.VISUALIZATION:z=H.VIZ_CONTENT;x=mstrmojo.vi.ui.rw.DocVIVisualizationsPanelStack;u.slot=D;u.title=v.n;break;}if(x){return this.getLayoutVIMap(v._lkz).createComponent(z,x,u);}},newPanel:function S(x,w,v,AD){var AC=w.k,AE=mstrmojo.DocPanel,z=this.getLayoutVIMap(w.defn._lkz),AB=AD.pk,AA={id:w.id,node:w,numDupl:0,model:x,builder:this,controller:x.controller},u=0;if(z.isComponent(H.FILTER_STACK,AB)){AE=mstrmojo.vi.ui.rw.FilterPanel;AA.alias="contents";AA.cssClass="mstrmojo-VIFilterPanel";AA.slot=D;u=H.FILTER_PANEL;}else{if(z.isComponent(H.VIZ_CONTENT,AB)){AE=mstrmojo.vi.ui.rw.DocRelativePanel;AA.slot=D;z.addRelativePanel(AC);}else{if(z.isComponent(H.MAIN_CONTENT,AB)){AE=mstrmojo.vi.ui.rw.DocVIMainPanel;AA.slot=D;}else{if(z.isComponent(H.PAGEBY_STACK,AB)){AE=mstrmojo.ui.BuilderBox;AA.slot=D;AA.onunitChange=X;AA.preBuildRendering=function(){this.set("unit",null);return mstrmojo.ui.BuilderBox.prototype.preBuildRendering.call(this);};u=H.PAGEBY_PANEL;}}}}var t;if(u){t=z.createComponent(u,AE,AA);}else{t=new AE(AA);}return t;},getDefaultXtab:function U(t){if(t&&!!t.isViewDataGrid){if(!mstrmojo.VDXtab){mstrmojo.VDXtab=Y(mstrmojo.vi.ui.rw.Xtab,[mstrmojo.vi.ui.rw._IsViewDataGrid],{scriptClass:"mstrmojo.VDXtab"});}return mstrmojo.VDXtab;}return mstrmojo.vi.ui.rw.Xtab;},getCustomSortXtab:function A(){return mstrmojo.vi.ui.rw.CustomSortXtab;},newXtab:function p(u,v,t,x){var w=this._super(u,v,t,x);w.zonesModel=w.addDisposable(new mstrmojo.vi.models.XtabDropZones({hostId:w.id,docModel:u}));w.set("edtModel",new mstrmojo.vi.models.editors.XtabEditorModel({hostId:w.id,docModel:u}));return w;},getDefaultMojoVisModel:function a(){return mstrmojo.vi.models.DocVisModel;},newXtabModel:function P(t){return new mstrmojo.vi.models.DocXtabModel(t);},newMojoVisualization:function K(x,u){var AF=this._super(x,u),AC=u.data.visName,t,AA,w;if(!!AF){t={hostId:AF.id,docModel:x};}if(AF instanceof mstrmojo.Xtab){return AF;}if(AC===C.GRAPH_MATRIX||AC===C.NEW_GRAPH_MATRIX){AF.zonesModel=AF.addDisposable(new mstrmojo.vi.models.CombineDropZonesModel({hostId:AF.id,docModel:x,gmZones:AF.addDisposable(new mstrmojo.vi.models.GMDropZones(t))}));AF.edtModel=AF.addDisposable(new mstrmojo.vi.models.editors.GMEditorModel({hostId:AF.id,docModel:x}));}else{if(AC===C.GOOGLE_MAP||AC===C.ESRI_MAP){AA="MapDropZones";w="MapEditorModel";}else{if(AC===C.MAPBOX){AA="MapboxDropZones";w="MapboxEditorModel";}else{if(AC===C.IMAGE_LAYOUT){AA="ImageLayoutDropZones";w="ImageLayoutEditorModel";}else{if(AC===C.HEAT_MAP){AA="HeatMapDropZones";w="HeatMapEditorModel";}else{if(AC===C.NETWORK){AA="NetworkDropZones";w="NetworkEditorModel";}else{if(AC===C.KPICARD){AA="KPICardDropZones";w="KPICardEditorModel";}else{if(mstrConfig.pluginsVisList[AC]){var AE=mstrConfig.pluginsVisList[AC],v=AE.dz,AB=AE.em;if(v){mstrmojo.requiresCls("mstrmojo."+v);var AD=R.walk(v,mstrmojo);AF.zonesModel=AF.addDisposable(new AD({hostId:AF.id,docModel:x,visModel:AF.model}));}else{AF.zonesModel=AF.addDisposable(new mstrmojo.vi.models.BaseVisDropZones({hostId:AF.id,docModel:x,visModel:AF.model}));}if(AB){mstrmojo.requiresCls("mstrmojo."+AB);var z=R.walk(AB,mstrmojo);AF.edtModel=AF.addDisposable(new z(t));}else{w="BaseEditorModel";}}}}}}}}}if(AA){AF.zonesModel=AF.addDisposable(new mstrmojo.vi.models[AA](t));}if(w){AF.edtModel=AF.addDisposable(new m[w](t));}if(AF){AF.updateFormatsOnUpdate=false;}return AF;},getLayoutVIMap:function o(t){return this.viMap[t];}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.ME.MetricEditor","mstrmojo.ME._DerivedMetricEditorHelper","mstrmojo.ME._HasConditionMetricFilterEditor","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.mstr.EnumDSSXMLObjectSubTypes");mstrmojo.requiresDescs(2213,8950);var G=mstrmojo.desc,D=mstrmojo.array,B=mstrmojo.mstr.EnumDSSXMLObjectTypes,F=mstrmojo.mstr.EnumDSSXMLObjectSubTypes;mstrmojo.ME.DerivedFormulaMetricEditor=mstrmojo.declare(mstrmojo.ME.MetricEditor,[mstrmojo.ME._DerivedMetricEditorHelper,mstrmojo.ME._HasConditionMetricFilterEditor],{scriptClass:"mstrmojo.ME.DerivedFormulaMetricEditor",title:mstrmojo.desc(2536,"Derived Metric:"),init:function E(H){mstrmojo.css.addWidgetCssClass(this,"dme");this._super(H);},hasConditionFilter:function A(){var J=this.oi&&this.oi.tks,I=J&&J.items,H=false;D.forEach(I,function(K){if(K&&K.oi&&K.oi.t===B.Filter&&K.oi.st===F.Filter){H=true;return false;}});return H;},clearConditionFilter:function C(){var O=this.oi&&this.oi.tks,N=O&&O.items;for(var L=0;L<N.length;L++){var P=N[L];if(P&&P.oi&&P.oi.t===B.Filter&&P.oi.st===F.Filter){var M=L>0?N[L-1]:undefined,H=L,K=1;if(M&&M.v==="<"){H=L-1;for(var J=H+1;J<N.length;J++){var I=N[J];K++;if(I.v===">"){break;}}}N.remove(H,K);L=H-1;}}}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.css","mstrmojo.Box","mstrmojo.Pulldown","mstrmojo.Label","mstrmojo.TextBoxWithLabel","mstrmojo.ME.MetricEditor","mstrmojo.ME._MetricEditorHelper","mstrmojo.ME.FunctionInfo","mstrmojo.func","mstrmojo.mstr.EnumDSSXMLObjectSubTypes","mstrmojo.mstr.EnumDSSXMLObjectTypes");mstrmojo.requiresDescs(1952,2213,8950,9560);var R=mstrmojo.hash,O=mstrmojo.array,f=mstrmojo.css,P=mstrmojo.ME._MetricEditorHelper,j=mstrmojo.ME.MetricDataService,Q=mstrmojo.func,M=mstrmojo.mstr.EnumDSSXMLObjectTypes,g=mstrmojo.mstr.EnumDSSXMLObjectSubTypes;var N={SUM:"8107C31BDD9911D3B98100C04F2233EA"};var B=null;mstrmojo.ME.ENUM={METRIC_ACTIONS:{ADD:"add",EDIT:"edit",EDIT_NEW:"editNew"},EDITOR_IDS:{ADVANCED:"mstrME",FORMULA:"mstrME",WIZARD:"mstrFE",SIMPLE:"mstrSME",SELECOTR:"mstrFSE"},EDITOR_TYPES:{ADVANCED:"ADVANCED",FUNCTION:"FUNCTION",SIMPLE:"SIMPLE",SELECTOR:"SELECTOR"},METRIC_EDIT_TYPES:{ADVANCED:65536,SIMPLE:131072,FUNCTION:196608},METRIC_TYPES:{65536:"ADVANCED",131072:"SIMPLE",196608:"FUNCTION"},NEW_METRIC_DEFINITION:{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}},getNewDefinition:function(){return{did:"",n:mstrmojo.desc(2213,"New Metric"),tks:{items:[],vs:0,vm:""},mhfts:{},mvfts:{}};}};var F=function(k){k=R.copy(k,{left:0,top:0});this.left=(parseInt(this.left||this.editorNode.style.left,10)||0)+k.left+"px";this.top=(parseInt(this.top||this.editorNode.style.top,10)||0)+k.top+"px";};var Z=function(l){var o=this,k=o.isDME,n=l.id,m=n.replace("_1",""),p=o.getEditorHelpTopic(m);var q={scriptClass:o.getEditorScriptClass(m),id:n,isDME:k,zIndex:o.zIndex++,oi:l.oi,bindings:{functions:o.funcsPath||"mstrmojo.all.mstrMetricIDE.functions",candidates:o.candidatesPath||"mstrmojo.all.mstrMetricIDE.candidates",dsUnits:"this.ide.dsUnits",attrCandidates:"this.ide.attrCandidates"},tbBrowsable:!k,tbFormatable:!k,ide:o};if(p){q.help=p;}R.copy(l,q);return q;};var A=function(k){var m=this.getEditorId(k),l=mstrmojo.all[m];if(!l){l=mstrmojo.insert(Z.call(this,k));l.onvisibleChange=F;l.onPostClose=function(){this.destroy();};}R.copy(k,l);l.candidates=null;l.set("candidates",this.candidates);return l;};var E=function(k){var o=this,n=k.oi;if(o.setExtraMetricTokens){o.setExtraMetricTokens(n);}var m=this.getEditorId(k);var l=mstrmojo.all[m];if(!l){var p=mstrmojo.hash.copy({slot:"editorsContainerNode",left:"0px",top:"0px",modal:false,showTitle:false,postCreate:function(){f.addWidgetCssClass(this,"mstrmojo-MetricIDE-editor inline");},onPostClose:function(){var q=o.curtain;if(q){q.set("visible",false);q.set("refNode",null);}o.editorConfig=null;o.set("editor",null);},onCancel:function(){o.close();},onSaved:function(){o.close();},switch2Editor:function(r,q){if(q){q.id=r;}o.set("editorConfig",{editorId:r,cfg:q});}},Z.call(this,k));if(o.isExpEditor(m)){p.onvisibleChange=function(){var z=B,q=o.browsersContainer.ob,AA=this.visible,w=250;if(AA){q.set("visible",AA);var s=o.browsersContainer.funcBrowser,r=s.functionList,u=r.domNode,t=u.querySelector&&u.querySelector(".mstrmojo-suggest-text.fn[idx]");if(t){var x=t.lastChild;f.addClass(x,"forceDisplay");window.setTimeout(function(){r.richTooltip=r.getEditBtnTooltip(x);mstrmojo.tooltip.open(r);window.setTimeout(function(){f.removeClass(x,"forceDisplay");r.hideTooltip();},1000);},w);}}else{q.set("visible",AA);}f.toggleClass(o.editorNode,"exp",AA);f.addClass(o.editorNode,"transition-left");mstrmojo.dom.center(z.editorNode);window.setTimeout(function(){f.removeClass(o.editorNode,"transition-left");F.call(o);},w);};}if(o.configInlineEditor){o.configInlineEditor(p);}l=mstrmojo.insert(p);l.attachEventListener("fctDidChange",o.browsersContainer.funcBrowser.id,"onfctDidChange");o.addChildren([l]);}else{l.set("oi",n);l.candidates=null;l.set("candidates",o.candidates);}if(k.useGUIDefault!==true){l.useGUIDefault=false;}o.set("editor",l);o.set("help",l.help);return l;};function L(){var m=this,o=500,l=function(q){var p=(q&&q.items)||[],r=m.candidates||{items:[]};r.items=r.items.concat(p);r.isComplete=r.isComplete&&(q.bc===-1||(q.bb+q.bc>q.sz));if(m.functions){r.items=r.items.concat(j.sortFunctions(m.functions));}m.candidates=null;m.set("candidates",r);},k=function(p){mstrmojo.alert(p.getResponseHeader("X-MSTR-TaskFailureMsg"));},n=function(p){if(p){var q={items:p.items,isComplete:(p.bc===-1||(p.bb+p.bc>p.sz))};m.candidates=q;}j.getMetrics({rootFolderType:j.rootFolderTypes.ALL,pattern:"*",blockBegin:1,blockCount:o},{success:l,failure:k});};if(!this.noCache&&!this.candidates){j.getMetricComponents({rootFolderType:j.rootFolderTypes.ALL,pattern:"*",blockBegin:1,blockCount:o},{success:n,failure:k});}else{l({bc:-1,mcComplete:true});}}var b=function(m,o){var n=null,l=function(w,s){if(!mstrmojo.all[o.id]||mstrmojo.all[o.id]._timeStamp!==s){return ;}if(w&&w.tks){P.preprocessTokenStram(w.tks);P.checkEditorFallback(j.sortFunctions(o.functions),w);}o.set("oi",w);if(!o.action.n){o.set("title",o.titleBase+" - "+w.n);}if(o.action.cmd!==mstrmojo.ME.ENUM.METRIC_ACTIONS.ADD){var u=o.showAsSimpleIDE(w);o.set("showLeftPanel",!u);var v=E.call(o,{id:o.editorId,oi:w,functions:n,simple:u});v.open(o);if(mstrApp&&mstrApp.isVI&&!w.did&&v.id==="mstrME"){var r=o.browsersContainer,t=r&&r.funcBrowser,q=t&&t.functionList;if(q){q.set("selectedIndex",Math.max(O.find(q.items||[],"did",N.SUM),0));v.close();t.handleSelectedFunction();}}}},k=function(q){mstrmojo.alert(q.message||q.getResponseHeader("X-MSTR-TaskFailureMsg"));},p=function(r){try{if(!mstrmojo.all[o.id]){return ;}n=o.filterFunctions(r);o.set("functions",n);L.call(o);o.loadObjectDefn({success:function(s){l(s,o._timeStamp);},failure:k});}catch(q){}};j.getFunctions({success:p,failure:k});};mstrmojo.ME.MetricIDE=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.ME.MetricIDE",cssClass:"mstrmojo-MetricIDE",id:"mstrMetricIDE",_timeStamp:0,titleBase:mstrmojo.desc(11579,"Metric Editor"),title:this.titleBase,help:" ",zIndex:4,noCache:true,editorId:null,editor:null,editorConfig:{editorId:null,cfg:{}},getEditorHelpTopic:function W(k){switch(k){case"mstrME":return"Creating_a_new_derived_metric_from_scratch.htm";}return"create_derived_metric.htm";},getEditorScriptClass:function H(k){return"mstrmojo.ME."+{mstrFE:"FunctionWizard",mstrSME:"SimpleMetricEditor",mstrME:"MetricEditor",mstrRFE:"RankEditor",mstrOFE:"OLAPEditor"}[k];},oneditorConfigChange:function S(){var l=this.editorConfig,k=l.cfg;if(this.editor){this.editor.close();}E.call(this,k).open(this,k);},showLeftPanel:true,onshowLeftPanelChange:function K(){f.toggleClass(this.editorNode,"simple",!this.showLeftPanel);if(this.editor){this.editor.set("simple",!this.showLeftPanel);this.browsersContainer.funcBrowser.set("showFullSyntax",this.isExpEditor(this.editor.id));}var k=this.getBrowsersContainer().domNode.offsetWith/2||120;this.set("left",(parseInt(this.left||this.editorNode.style.left,10)||0)+(this.showLeftPanel?-1:1)*k+"px");if(this.showLeftPanel){this.browsersContainer.funcBrowser.functionList.refresh();}},filterFunctions:function h(k){return k;},isExpEmpty:function e(){var k=mstrmojo.all.mstrME;return k&&k.getMetricDefAsTokens().length===0;},init:function Y(m){if(this._super){this._super(m);}var n=mstrApp,k=n&&n.useQuickSearch&&n.useQuickSearch(),l=k?((n&&n.searchAutoCompleteDelay&&n.searchAutoCompleteDelay())||0):0;this.suggestDelay=l||200;this.noCache=this.noCache&&k&&!this.isDME;j.suggestDelay=this.suggestDelay;j.noCache=this.noCache;B=this;this._timeStamp=mstrmojo.now();},onClose:function D(){if(this.editor){this.editor.close();}this.browsersContainer.funcBrowser.cleanup();this.destroy();},onOpen:function I(){F.call(this);this.set("showLeftPanel",true);b(this.metricId||this.did,this);this.set("title",this.titleBase+" - "+(this.action.n||mstrmojo.desc(2213,"New Metric")));B=this;},setExtraMetricTokens:mstrmojo.emptyFn,getTokenInputBox:function C(){return mstrmojo.all.mstrME&&mstrmojo.all.mstrME.metricEditBox.inputBox;},insertTokens:function(k){return this.getTokenInputBox().insertTokens(k);},onObjectInsert:function(k){mstrmojo.all.mstrME.onObjectInsert(k);},setRefOi:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-MetricIDE-browsers-container",alias:"browsersContainer",children:[{scriptClass:"mstrmojo.ME.FunctionSelector",cssClass:"mstrmojo-MetricIDE-editor inline",alias:"funcBrowser",left:"0px",top:"0px",modal:false,showTitle:false,bindings:{functions:function(){return this.parent.parent.functions;},oi:function(){return this.parent.parent.oi||mstrmojo.ME.ENUM.getNewDefinition();},isDME:function(){return this.parent.parent.isDME;},activeEditor:function(){var k=this.parent.parent.editor;this.buttonNode.style.visibility=this.parent.parent.editor?"hidden":"visible";if(k){this.set("showFullSyntax",B.isExpEditor(k.id));}}},onfctDidChange:function(m){var l=Math.max(0,j.getCategoryIndex(m.did)),k=this.fcHBox.fcPulldown,o=k.selectedItem.did;if(o<0){return ;}k.set("value",j.getFunctionCatList()[l].did);var n=this.functionList;window.setTimeout(function(){l=mstrmojo.array.find(n.items,"did",m.did);n.singleSelect(l,false);},100);},switch2Editor:function(l,k){if(k){k.id=l;}B.set("editorConfig",{editorId:l,cfg:k});},handleCloseAction:function(){if(this.onPreClose()){B.close();}},handleSelectedFunction:function(o){var k=this;var m=B.editor;if(m&&B.isExpEditor(m.id)){if(o){B.insertTokens(k.getTokens());var l=function(p){return !isNaN(p)&&p<0;};if(!l(this.functionList.selectedItem.did)){B.getTokenInputBox().insertParenthesisTokens();}}}else{var n=k.functionList;k.openWizard(n.items[n.selectedIndex]);}},openWizard:function(n,m){B.help=B.getEditorHelpTopic("mstrFE");if(!n||n.did===-7){return ;}var l=B,k={zIndex:l.zIndex+1,candidates:l.candidates,oi:mstrmojo.ME.ENUM.getNewDefinition()};if(j.isBasicAggMap(n.did)||n.did<-1){k.did=n.did;k.id="mstrSME";k.useGUIDefault=true;}else{k.fctOi=n;k.id="mstrFE";k.paramItemsPath=l.feParamItemsPath;}l.setRefOi(k);l.set("editorConfig",{cfg:k,opener:m});}}]},{scriptClass:"mstrmojo.Box",alias:"editorsContainer",cssClass:"mstrmojo-MetricIDE-editors-container",children:[{scriptClass:"mstrmojo.Label",cssText:"line-height:380px; text-align:center;",text:mstrmojo.desc(11567,"Select a function from left"),bindings:{visible:"!this.parent.parent.editor",editor:function(){return !this.parent.parent.editor;}}}]},{scriptClass:"mstrmojo.ME.FunctionInfo",slot:"buttonNode",alias:"funcSyntaxDesc",bindings:{foi:function(){return this.parent.browsersContainer.funcBrowser.functionList.selectedItem;},showFullSyntax:function(){return this.parent.browsersContainer.funcBrowser.showFullSyntax;}}}],getBrowsersContainer:function d(){return this.browsersContainer;},renderObjectsBrowser:function c(){var l=this;var k=this.getBrowsersContainer();if(k){k.addChildren([{scriptClass:"mstrmojo.ObjectBrowser",cssClass:"mstrmojo-MetricIDE-ob",alias:"ob",fishEyeVisible:false,closeable:false,closeOnSelect:false,quickSearch:true,visible:false,bindings:{visible:function(){var m=this.parent.parent.editorRef;return m&&m.id==="mstrME";}},onvisibleChange:function(){if(this.visible&&!this.loaded){this.browse({folderLinksContextId:23,onSelectCB:[l,"onObjectInsert"],useDblSelect:true,browsableTypes:""});this.loaded=true;}},postCreate:function(){this.children=[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(1952,"All objects"),cssClass:"mstrmojo-MetricIDE-obLabel"}].concat(this.children);}}]);}},postBuildRendering:function(){if(this._super){this._super();}this.addSlots({editorsContainerNode:this.editorsContainer.domNode});this.renderObjectsBrowser();this.set("help",this.getBrowsersContainer().funcBrowser.help);},onmousedown:function(l){var k=l.e.target;var m=this.getTokenInputBox();if(m&&!mstrmojo.dom.contains(m.domNode,k,true,this.editorNode)){this.getTokenInputBox().handleblur();}},loadObjectDefn:function a(o){var l=this.metricId||this.did;if(!this.metric&&this.datasets){var k;R.forEach(this.datasets,function(p){O.forEach(p.mx,function(q){if(q.did===l){k=q;return false;}});if(k){return false;}});this.metric=k;}var n=this.metric&&this.metric.condition;if(l){if(mstrApp&&mstrApp.isVI){o.success=Q.composite([function(q){if(!q.condition){q.condition=n;}var t=q.tks,r=[],u={};O.forEach(t&&t.items,function(v){var w=v&&v.oi;if(w&&w.t===M.Filter&&w.st===g.Filter){r.push(w.did);u[w.did]=v;}});var p=mstrApp&&mstrApp.getRootController().docCtrl.model;var s=[];O.forEach(r,function(w){var v=p.getEmbeddedFilter(w);if(v){s.push(v);u[w].oi.isEmbedded=true;u[w].oi.condition=v;}});q.conditions=s;},o.success]);}j.getMetricDefintion({id:l,msgID:this.isDME?mstrApp.getMsgID():null},o);}else{var m=mstrmojo.ME.ENUM.getNewDefinition();o.success(m);}},isExpEditor:function X(k){return k==="mstrME";},getModalEditor:function V(k){this.setRefOi(k);return A.call(this,k);},getEditorId:function U(l){var n=l.oi,k=n&&n.tks&&n.tks.met;var m=l.id||{65536:"mstrME",131072:"mstrSME",196608:"mstrFE"}[k]||"mstrME";if(m==="mstrSME"||m==="mstrFE"||m==="mstrSME_1"||m==="mstrFE_1"){m=P.getSpecialFunctionEditorId(this.getRootFunction(l),l.modal)||m;}l.id=m;return m;},showAsSimpleIDE:function G(k){var l=false;if(this.isDME&&k.did&&k.tks){l=parseInt(k.tks.met,10)!==mstrmojo.ME.ENUM.METRIC_EDIT_TYPES.ADVANCED&&!mstrmojo.string.isEmpty(P.getSpecialFunctionEditorId(k.tks.items[0].oi));}return l;},getRootFunction:function J(k){var l=k.fctOi;if(!l){l=P.getRootFunction(k.oi);}return l;}});}());(function(){mstrmojo.requiresCls("mstrmojo.expr","mstrmojo.ME.DerivedFunctionWizard","mstrmojo.ME.DerivedSimpleMetricEditor","mstrmojo.ME.DerivedRankEditor","mstrmojo.ME.DerivedFormulaMetricEditor","mstrmojo.ME.DerivedOLAPEditor","mstrmojo.ME.MetricIDE","mstrmojo.hash");mstrmojo.requiresDescs();var F=mstrmojo.desc,N=mstrmojo.expr,A=mstrmojo.hash;var B;function G(E){return E.datasets;}function H(V){var P=G(V),U=[],X={},E;for(E in P){var Q=P[E],Z=Q.name,Y=O([].concat(Q.mx).concat(Q.att)),S=Y.length,R;for(R=0;R<S;R++){var W=Y[R];W.dsdid=E;W.path=Z;if(!X[W.did]){X[W.did]=W;}}}U=A.valarray(X);return{items:U,isComplete:true,bc:-1};}function O(E){return mstrmojo.array.filter(E,function(P){return P.st!==N.STP.CONS&&P.st!==N.STP.CUSTOMGROUP&&P.did!==B.metricId&&(!P.hide);});}function I(){return mstrmojo.all.mstrMetricIDE;}mstrmojo.ME.DerivedMetricIDE=mstrmojo.declare(mstrmojo.ME.MetricIDE,null,{scriptClass:"mstrmojo.ME.DerivedMetricIDE",isDME:true,noCache:false,disableAFB:false,enablePTO:false,getEditorScriptClass:function J(E){return{mstrFE:"mstrmojo.ME.DerivedFunctionWizard",mstrSME:"mstrmojo.ME.DerivedSimpleMetricEditor",mstrME:"mstrmojo.ME.DerivedFormulaMetricEditor",mstrRFE:"mstrmojo.ME.DerivedRankEditor",mstrOFE:"mstrmojo.ME.DerivedOLAPEditor"}[E];},filterFunctions:function K(P){var E={"1762CA4760014C78B365C868019C6F3E":"HistogramMedian"};return mstrmojo.array.filter(P,function(Q){var R=Q.fns;Q.fns=mstrmojo.array.filter(R,function(S){return(!S.idbo&&S.ip)&&!E[S.did];});return Q;});},onOpen:function D(){this.set("datasets",G(this));this.set("dsUnits",H(this));this.set("feParamItemsPath","mstrmojo.all.mstrMetricIDE.dsUnits.items");this.set("candidates",H(this));var E=mstrApp&&mstrApp.rootCtrl&&mstrApp.rootCtrl.docCtrl&&mstrApp.rootCtrl.docCtrl.model;if(E){var P=this;A.forEach(this.datasets,function(Q){if(E.isEssbaseRADataset(Q)||E.isMSASRADataset(Q)){P.set("enablePTO",true);return false;}});}if(this._super){this._super();}},init:function L(E){this._super(E);mstrmojo.css.addWidgetCssClass(this,"dme");B=this;},setExtraMetricTokens:function M(E){if(mstrmojo.string.isEmpty(E.n)){E.n=this.action.n||mstrmojo.desc(2213,"New Metric");}E.alias=E.alias||this.action.alias;},setRefOi:function(E){E.refOi=this.action&&this.action.refOi;},renderObjectsBrowser:function C(){var E=this.datasetsObjects;if(E){E.alias="ob";E.bindings={visible:function(){return mstrmojo.all.mstrME.visible;}};E.onvisibleChange=function(){if(this.visible){var P=this;window.setTimeout(function(){if(P.doLayout){P.doLayout();}},50);}};E.doubleClickItemHandler=function(P){I().onObjectInsert(P);};this.getBrowsersContainer().addChildren([E]);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.ME.MetricIDE","mstrmojo.ME.DerivedAttributeEditor","mstrmojo.ME.DynamicLinkEditor","mstrmojo.ME.AttributeEditBox","mstrmojo.ME.BandingDAEditor","mstrmojo.ME.MetricDataService","mstrmojo.mstr.EnumDSSXMLBaseFormType","mstrmojo.vi.ui.DatasetUnitMenuUtils");mstrmojo.requiresDescs(11404,2870,11616,11618,12199,9826,9571);var J=mstrmojo.desc,N=mstrmojo.array,V=mstrmojo.hash,F=mstrmojo.dom,c=mstrmojo.expr,D="daObjectBrowsers",X=1,I=0,H=mstrmojo.vi.ui.DatasetUnitMenuUtils,O=mstrmojo.ME.AttributeEditBox.getTokenStreamXML;function S(k){return k.action.datasets||k.view.docModel.datasets;}function R(n){var k=n.fs||[],o=0,l=0,q=0,m=mstrmojo.mstr.EnumDSSXMLBaseFormType,p=mstrmojo.ME.DerivedAttributeIDE;mstrmojo.array.forEach(k,function(r){switch(r.bftp){case m.DssXmlBaseFormDateTime:case m.DssXmlBaseFormDate:q++;break;case m.DssXmlBaseFormText:o++;break;case m.DssXmlBaseFormNumber:l++;break;}});if(q){return p.FUNC_CATEGORY_DATE;}if(l&&k.length===l){return p.FUNC_CATEGORY_BASIC;}return p.FUNC_CATEGORY_STRING;}function f(l){var m=mstrmojo.ME.DerivedAttributeIDE,n=mstrmojo.ME.MetricDataService,k=l.browsersContainer.funcBrowser;if(k){k.postfunctionsChange=function(){var p=l.action||{},r=p.funccat||m.FUNC_CATEGORY_STRING,q=this.functions,o;switch(r){case m.FUNC_CATEGORY_BASIC:o=n.getBasicCategoryIndex(q);break;case m.FUNC_CATEGORY_DATE:o=n.getDateTimeCategoryIndex(q);break;default:o=n.getStringCategoryIndex(q);break;}this.set("selectedCategory",o+1);};}}function Y(l,k){return !(l.um||l.rdm||l.t===48||(l.t===47&&l.st===12033)||l.did===k||H.isCGorCon(l));}function L(s,w,t){var n=S(s),r={},p=s.action,l=p.did,o,k,v,m=function(x){if(!Y(x,l)){return ;}x.dsdid=k;x.path=v;r[x.did]=x;if(!w){N.forEach(x.fs,function(z){if(z.obf||x.da){z.path=v;z.attid=x.did;z.attn=x.n;z.did=z.fmdid=z.fid;z.n=z.fnm;r[z.attid+"@"+z.did]=z;}});}};var q=[];var u;for(k in n){o=n[k];if(o.isMDX&&o.isDDA){continue;}v=o.name;u=[].concat((t||o.isMDX)?[]:o.mx).concat(o.att);q=q.concat(u);N.forEach(u,m);}return{all:q,items:V.valarray(r),isComplete:true,bc:-1};}function K(k){var l={isComplete:true,items:[]};l.items.push({n:"This",did:"This",t:12,fs:[{fnm:"ID",fid:"ID",t:21}]});if(!k){l.items.push({n:"ID",did:"ID",attid:"This",attn:"This",fnm:"ID",t:21});}return l;}function g(o){var l=o.datasetsObjects,q=mstrmojo.insert({scriptClass:"mstrmojo.StackContainer",cssClass:"mstrmojo-DA-obContainer",id:D,alias:"ob",children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-DA-obDESC",visible:false,initWarning:function p(){var r=this;r.thisid.showInfo(document.getElementById("DA_THIS_ID"));window.setTimeout(function(){r.thisid.hideInfo();},3000);},children:[{scriptClass:"mstrmojo.Label",text:J(2870,"Objects")},{scriptClass:"mstrmojo.ListBase",cssClass:"mstrmojo-VIUnitList",alias:"thisid",draggable:true,itemField:"n",items:[{n:"This@ID"}],ondblclick:function(){o.onObjectInsert(this.items[0]);},getDragData:function n(){var s=this.items[0],r='<div class="mstrmojo-VIUnitList"><div class="item unit ic21" ><span>'+s.n+"</span></div></div>";return{item:s,html:r};},showInfo:function m(s){var u=mstrmojo.dom.position(s,false),t=this,r=t._autoCloseFn=function(w){var v=self,x=t.tooltip;if(x&&!F.contains(x.domNode,F.eventTarget(v,w),true,document.body)){t.hideInfo();}};t.richTooltip={posType:mstrmojo.tooltip.POS_TOPRIGHT,content:J(11618,"You can define this and additional DESC forms based on the current attribute ID."),contentNodeCssClass:"dae-desc-info me-tooltip-content regular up",left:u.x+32,top:u.y+20};t.hasOpenTooltip=false;t.showTooltip();F.attachEvent(document.body,"mousedown",r,true);},hideInfo:function k(){o.hideTooltip();if(this._autoCloseFn){F.detachEvent(document.body,"mousedown",this._autoCloseFn,true);delete this._autoCloseFn;}},itemRenderer:{render:function(t,r,s){return'<div class="item unit ic21" ><span>'+t.n+'</span><div id="DA_THIS_ID" class="tidinfo" onclick="mstrmojo.all[\''+s.id+"'].showInfo(this)\" ></div></div>";}}}]}]});if(l){q.addChildren([l]);q.set("selected",l);}return q;}function M(k,r,q){var n=r.did,l=r.n,o=(r.forms&&r.forms[0])||{},p=o.did,s=r.tks;var m=function(u){if(u.vs!==0){mstrmojo.alert(mstrmojo.desc(9826,"The metric definition has an error. Please correct before proceeding."),null,mstrmojo.desc(9571,"Syntax Error!"));return ;}var w;if(n){var t=o.n,v={did:p,formula:u.tokenXML,n:t};if(mstrApp.isSingleTier){v.originN=t;v.originFormula=O({items:o.ftk||[]});}w={act:"updateDA",name:l,dsid:k,attrId:n,isTokenStream:true,update:[v]};}else{w={act:"addDAToDataset",dsid:k,name:l,isTokenStream:true,forms:[{n:"ID",formula:u.tokenXML}]};}q(w);};mstrmojo.ME.AttributeEditBox.validateSyntax(n,s,true,m);}mstrmojo.ME.DerivedAttributeIDE=mstrmojo.declare(mstrmojo.ME.MetricIDE,null,{scriptClass:"mstrmojo.ME.DerivedAttributeIDE",id:"mstrDerivedAttrIDE",noCache:false,isDME:true,title:J(11616,"Attribute Editor"),titleBase:J(11616,"Attribute Editor"),formulaEditorId:"mstrDAE",nameLabel:J(12199,"Attribute Name:"),hasFunctionBrowser:true,getEditorScriptClass:function E(k){return{mstrFE:"mstrmojo.ME.DerivedFunctionWizard",mstrSME:"mstrmojo.ME.SimpleMetricEditor",mstrDAE:"mstrmojo.ME.DerivedAttributeEditor",mstrBDAE:"mstrmojo.ME.BandingDAEditor",mstrDLE:"mstrmojo.ME.DynamicLinkEditor"}[k];},isBanding:function U(k){return mstrmojo.ME.MetricDataService.isBanding(k);},isObjectVisible:Y,filterFunctions:function h(m){var l=mstrmojo.ME.MetricDataService.getDataMiningCatIndex(m),k=l>-1?m[l].did:"";return mstrmojo.array.filter(m,function(n){if(n.did!==k){var o=n.fns;n.fns=mstrmojo.array.filter(o,function(p){return(!p.idbo&&p.ip&&p.sqt===3);});return n.fns.length>0;}});},getTokenInputBox:function B(){var l=mstrmojo.all.mstrDAE,k=l&&l.attrEditBox;return k&&k.inputBox;},onObjectInsert:function(k){mstrmojo.all.mstrDAE.onObjectInsert(k);},onOpen:function G(){this.set("datasets",S(this));this.set("dsUnits",L(this,true));this.set("candidates",L(this));this.set("feParamItemsPath","mstrmojo.all.mstrDerivedAttrIDE.dsUnits.items");this.set("funcsPath","mstrmojo.all.mstrDerivedAttrIDE.functions");this.set("candidatesPath","mstrmojo.all.mstrDerivedAttrIDE.candidates");this.browsersContainer.funcBrowser.set("includeFakeFuncs",false);if(!this.hasFunctionBrowser){this.set("attrCandidates",L(this,false,true));this.browsersContainer.funcBrowser.set("visible",false);this.funcSyntaxDesc.set("visible",false);}var k=this.browsersContainer.ob,l=k&&k.children[X];if(l){k.set("selected",l);l.refresh();if(l.doLayout){window.setTimeout(function(){l.doLayout();},50);}}if(this._super){this._super();}if(this.editorId==="mstrDLE"){this.set("titleBase",mstrmojo.desc(14718,"Link Editor"));this.set("title",this.titleBase+" - "+(this.action.n||"New Link"));}else{this.set("title",this.titleBase+" - "+(this.action.n||mstrmojo.desc(11404,"New Attribute")));}},renderObjectsBrowser:function e(){var k=mstrmojo.all[D]||g(this);this.getBrowsersContainer().addChildren([k]);},onformsTabSwitch:function j(l){var n=this.browsersContainer.ob,m=(l&&l.nidx)||0,k=n&&n.children[m>=1?I:X];mstrmojo.css.toggleClass(n.domNode," show-all",m>0);if(k){n.set("selected",k);if(l.toNewTab){k.initWarning();}}this.set("dsUnits",m===0?L(this,true):K(true));},isExpEditor:function b(k){return k==="mstrDAE";},configInlineEditor:function P(l){var k=this.action;l.paramItemsPath=this.feParamItemsPath;l.oncreate=k.oncreate;l.onupdate=k.onupdate;},postBuildRendering:function d(){if(this._super){this._super();}f(this);mstrmojo.css.addClass(this.editorNode,"mstrmojo-DA-IDE");if(this.editorId==="mstrDLE"){mstrmojo.css.addClass(this.editorNode,"mstrmojo-mstrDLE");}if(!this.hasFunctionBrowser){mstrmojo.css.addClass(this.editorNode,"hideFuncBrowser");}},setRefOi:function(k){k.refOi=this.action&&this.action.refOi;},getEditorId:function Z(l){var o=l.oi,p=o.forms&&o.forms.length,m,k,n;if(p===1){m=o.forms[0];k=m.met;o.tks={items:m.ftk,met:m.met};}if(!l.id&&mstrmojo.ME.BandingDAEditor.showAsBandingEditor(o)){n="mstrBDAE";}else{n=l.id||{65536:"mstrDAE",196608:"mstrFE"}[k]||"mstrDAE";}l.id=n;return n;},getEditorHelpTopic:function a(l){var k={mstrDLE:"Dynamic_links_in_a_Grid_visualization.htm"};return k[l]||"Attribute_Editor.htm";},showAsSimpleIDE:function C(k){var l=k.forms&&k.forms.length;return(l===1||mstrmojo.ME.BandingDAEditor.showAsBandingEditor(k))&&parseInt(k.forms[0].met,10)!==mstrmojo.ME.ENUM.METRIC_EDIT_TYPES.ADVANCED;},oneditorConfigChange:function W(){var l=this.editorConfig,k=l.cfg,m=k.oi||{},n=m.forms&&m.forms.length;if(m.tks&&n===1){m.forms[0].ftk=m.tks.items;}this._super();},getValidFuncParamTypes:function Q(k){var l=[c.TP.METRIC];if(!k||k.sqt===1||k.sqt===3){l.push(c.TP.ATTR);}return l;},validateAndSave:function A(n,l){var m=this,k=m.action,o=k.dsid;savefn=function(q){l();m.close();var p=n.did?k.onupdate:k.oncreate;if(p){p(q);}};M(o,n,savefn);},loadObjectDefn:function(s){var q=this.action,m=q.n,l=q.did,n,r=0,k=[],p=q.msgID,o=function(t){var u=n[r-1];if(t&&t.tks&&u){k.push({did:u.fid,n:u.fnm,k:u.fid,ftk:t.tks.items,bft:u.bft||u.bftp,bftp:u.bftp||u.bft,met:t.tks.met,vs:1,is:""});}if(r===n.length){s.success({n:m,did:l,forms:k,dsid:q.dsid,alias:q.alias});return ;}u=n[r++];mstrmojo.ME.MetricDataService.validateMetric({metricId:l,formID:u.fid,objectType:12,tokenStreamXML:"",metricXML:"",msgID:p},{success:o});};if(l){n=q.forms;o();}else{s.success({n:m||mstrmojo.desc(11404,"New Attribute"),dsid:q.dsid});}}});mstrmojo.ME.DerivedAttributeIDE.FUNC_CATEGORY_BASIC=1;mstrmojo.ME.DerivedAttributeIDE.FUNC_CATEGORY_DATE=2;mstrmojo.ME.DerivedAttributeIDE.FUNC_CATEGORY_STRING=3;mstrmojo.ME.DerivedAttributeIDE.getDefaultFunctionCategory=R;}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo._HasBuilder","mstrmojo._IsRwDocument","mstrmojo.express.ui._IsDocumentView","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.ui.DocBuilder","mstrmojo.vi.ui.VisualizationEditor","mstrmojo.array","mstrmojo.func","mstrmojo.hash","mstrmojo.css","mstrmojo.vi.ui.rw.xtab.XtabMenuConfig","mstrmojo.vi.ui.tabs.LayoutTabHelper","mstrmojo.vi.controllers.EnumEvents");var W=mstrmojo.array,h=mstrmojo.func,M=mstrmojo.hash,C=mstrmojo.DocDataService,D=mstrmojo.vi.controllers.EnumEvents,I=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,g=mstrmojo.vi.ui.tabs.LayoutTabHelper;function U(w,t){var s=mstrmojo.desc(11450,"## copy ###"),q=W.find(w,"k",t),v=w[q],r=v.numDupl===0?s.replace("###","").replace("##",v.n):s.replace("###",v.numDupl).replace("##",v.n),u={};(w||[]).forEach(function(x){u[x.n]=true;});while(u[r]){v.numDupl++;r=s.replace("###",v.numDupl).replace("##",v.n);}return r;}function P(q){return{success:function(){var r=q.replaceKeyBoxes,s=q.cmdMgr().getInterimCmd(),t=q.getDataService().newUpdate(s,{extras:mstrmojo.DocDataService.SUPPRESS_DATA});if(r&&r.length>0){W.forEach(r,function(u){u.addSaveBoxLayoutActions(t,true);});}q.clearMapLayout();q.raiseEvent({name:D.UPDATE_TOC});s.submitUpdate(t,q.cmdMgr().CMD_PHASE.LAST);}};}mstrmojo.vi.ui.DocumentView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo._HasBuilder,mstrmojo._IsRwDocument,mstrmojo.express.ui._IsDocumentView,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.DocumentView",markupString:'<div id="{@id}" class="mstrmojo-VIDocument {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VIDocument-doc"></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true},hasDataSource:false,selector:null,layoutViewer:null,model:null,builder:null,renderedLayoutsQueue:[],LAYOUTS_CACHE_SIZE:10,init:function j(r){this._super(r);var q=this.model;this.addDisposable(this.builder=new mstrmojo.vi.ui.DocBuilder({parent:this,model:q}));},buildChildren:function R(){var r=this.editor,q=r?[r]:[];this._layouts=this._super(true);this.addChildren(q);},onRender:function B(){var q=this.getSelectedLayoutWidget();this.addChildren([q]);},pushToRenderedQueue:function J(t,u){var q=this.renderedLayoutsQueue||[];if(q.indexOf(t.k)===-1){q.push(t.k);if(q.length>this.LAYOUTS_CACHE_SIZE){var s=q.shift(),v=this._layouts,r=v[W.find(v,"k",s)]||{};if(r.hasRendered&&s!==u.k){r.unrender();}}}},setDimensions:function b(r,q){this._super(r,q);this.forceLayout=false;},showPanel:function n(u,r,t){var s=this.builder.getLayoutVIMap(r),q=s&&s.getComponent(mstrmojo.vi.models.VIComponentMap.TYPES.VIZ_CONTENT);if(q){q.selectPanel(u,null,null,t);}},showLayout:function K(t,x,w,v){var u=t.k,r=this.getSelectedLayoutWidget(),s=typeof x==="function",q={success:function(AA){AA.getSelector().setTabs(this._layouts,AA.k);this.reDisplayLayout(r,AA,s?x:mstrmojo.emptyFn);var z=mstrApp.isLayoutModePreview();if(z||AA.isPreview){this.controller.rootCtrl.adjustLayoutSectionWidth(z,false);}AA.raiseEvent({name:"generateVizBoxToolbar"});}.bind(this)};if(!s){q=h.wrapMethods(q,x);}if(u!==r.k){this.getNewLayout({layoutKey:u,panelKey:v},this._layouts,true,q,w);return true;}return false;},reDisplayLayout:function F(v,z,AD){var s=z.getSelector(),u=this.model,r=u.getSelectedViUnit(),t=r&&r.k,w=z.k,AC=this._layouts,AF=mstrApp.rootCtrl,AA=AF.view;s.setStatic(true);g.saveTabBarPosition(v.getSelector());var x=(this.children||[]).filter(function(AG){return AG.k===w;})[0];if(x){z=this.rebuildChild(x);}else{this.removeChildren(v);this.pushToRenderedQueue(v,z);u.resetSelectedViUnitId();this.addChildren([z]);if(z.isBoxLayoutDirty){z.updateRootBoxLayout();z.buildBoxLayout();delete z.isBoxLayoutDirty;}}var AB=W.find(AC,"k",w);AC[AB]=z;(x||z).raiseEvent({name:"layoutRedisplay"});this.updateXtabStyles(w);var AE=u.getVizContentPanel(),q=t&&AE.getUnitByKey(t);if(q){AE.selectVIUnit(q,true);}else{AE.selectFirstBox();}z.docLayout.toggleSelectorVisibility(u.tsp===I.LEFT||!AA.isCPVisible);g.applyTabBarPosition(s);s.setSelectedTab(w);s.setStatic(false,true);AF=this.controller.rootCtrl;AF.generateToolbar();if(AD){AD();}if(mstrApp.isAppStatePresentation()){this.layoutViewer.syncFilterPanelStack();}this.doLayout();},replaceLayout:function E(t,r,s){var u=this._layouts||[],q=W.find(u,"k",t&&t.k);if(q>=0){t.unrender();t.destroy();this.model.getDocBuilder().removeVIMapRef(t.k);}var v=this.builder.build([r],this.model)[0];if(q>=0){u[q]=v;}else{W.insert(u,s,[v]);}this._layouts=u;return v;},destroy:function d(q){(this._layouts||[]).forEach(function(r){r.destroy(q);});this.builder.destroy();this._super(q);},getLayoutByKey:function e(q){return W.filterOne(this.getLayouts(),function(r){return r.k===q;});},getLayouts:function(){return this._layouts;},updateLayouts:function(r){var x=this.getLayouts(),s=[],q=this.model.getChildren(r,false),u=this.getSelectedLayoutWidget(),t,AA,z;for(t=0;t<q.length;t++){AA=q[t].k;z=W.find(x,"k",AA);if(z<0){this.replaceLayout(null,q[t]);}else{if(q[t].data.loaded&&this.model.currlaykey!==r.currlaykey){this.replaceLayout(x[z],q[t]);}}}for(t=0;t<x.length;t++){z=W.find(q,"k",x[t].k);if(z<0){var v=x.splice(t,1)[0];v.unrender();v.destroy();t--;}}for(t=0;t<q.length;t++){AA=q[t].k;z=W.find(x,"k",AA);if(z>=0){s.push(x[z]);}}this._layouts=s;this.model.currlaykey=r.currlaykey;var w=this.getLayoutByKey(r.currlaykey);w.getSelector().setTabs(this._layouts,r.currlaykey);this.reDisplayLayout(u,w);},moveLayout:function S(q,AB){var x=this,v=this.model,AA=this._layouts,s=this.layoutViewer.getSelector(),AC=this.getSelectedLayoutWidget(),r=AC.k,AD=AA[q],u=AD.k,w=s.selectMovedTab&&r!==u,t=function(AE,AF){v.moveLayout(AE,AF);AA.splice(AF,0,AA.splice(AE,1)[0]);v.raiseEvent({name:D.UPDATE_TOC});};v.execute({execute:function z(){var AG=this.urInfo,AF=function(){AG.extras=M.copy({style:{params:{treesToRender:C.EnumTreesToRender.BOTH}}},AG.extras);}.bind(this);AG=M.copy({silent:s.selectMovedTab?false:true,undo:function(){AF();t(AB,q);x.layoutViewer.getSelector().moveTab(AB,q,AB,true);return !w;},redo:function(){AF();t(q,AB);x.layoutViewer.getSelector().moveTab(q,AB,q,true);return !w;}},AG);var AE=v.getMoveLayoutAction(q,AB);if(!w){t(q,AB);this.submitSilent(AE);}else{var AI=v.getDataService().newUpdate(),AH=x.needLoadLayout(AD);AI.addExtras(AH?C.REQUEST_DEFN_DATA:C.REQUEST_ONLY_DEFINITION);t(q,AB);AI.actions.push(AE);x.showLayout(AD,null,AI);if(AH){this.submitUpdate(AI);}}}});},deleteLayout:function f(z,t){var x=this._layouts,q=W.find(x,"k",z),AA=q+1,s,r=this.id,w=true,u=function(AD){var AG=mstrmojo.all[r],AF=x.splice(q,1)[0],AC=w?AG.model.getChildren(AD,false):x,AB=AD.currlaykey,AE=W.find(AC,"k",AB),AH;AG.model.currlaykey=AB;if(w){AG.model.replaceLayout(AB,AD,false);AH=AG.replaceLayout(x[AE],AC[AE],AE);}else{AH=AC[AE];}AG.layoutViewer.getSelector().deleteTab(q);AH.getSelector().setTabs(AG.getLayouts(),AB);AG.reDisplayLayout(AF,AH);AF.unrender();AF.destroy();AG.model.getDocBuilder().removeVIMapRef(z);AG.model.raiseEvent({name:D.UPDATE_TOC});},v=function(AB){return !M.isEmpty(AB.defn&&AB.defn.cgbMap);};this.model.removeLayout(z,{success:u},t);s=x[AA];if(!s){AA=q-1;s=x[AA];}this.model.getDataService().setCurrentDocLayout(s.k,null,t);w=this.needLoadLayout(s)||v(x[q])||v(s);t.setTreesToRender(w?3:1);},duplicateLayout:function N(u,q){var s=this.getLayouts(),r=W.find(s,"k",q)+1,t=this.model.getNextKey();this.model.duplicateLayout(u,{srcKey:q,destKey:t,name:U(s,q),index:r+1},h.wrapMethods(this.getRedisplayLayoutCallback(r,t,this.getSelectedLayoutWidget(),u),P(this.model)));},addNewLayout:function H(u,r,t){var s=(t&&t.nodeKey)||this.model.getNextKey(),q=this.getLayouts().length;r=(0<=r&&r<q)?r:q;this.model.addNewLayout(u,M.copy(t,{nodeKey:s,index:r+1}),h.wrapMethods(this.getRedisplayLayoutCallback(r,s,this.getSelectedLayoutWidget()),P(this.model)));},importDashboard:function Z(u,q,t){var s=this.model,r=this.controller.rootCtrl;q=this.getLayouts().length;this.model.addExistingLayouts(u,M.copy(t,{index:q+1}),{success:function(){r.displayLightTheme();s.raiseEvent({name:D.UPDATE_TOC});}});},getSelectedLayoutWidget:function L(){return(this._layouts||[]).filter(function(q){return(q.k===this.model.getCurrentLayoutKey());},this)[0];},showSelectedLayout:function Y(){var q=this.getSelectedLayoutWidget();if(this.containerNode.children.length>0){return ;}if(this.model.clearDisposables){this.model.clearDisposables();}(this.children||[]).filter(function(r){return r.k===q.k;}).forEach(function(r){this.removeChildren(r);r.destroy();},this);this.addChildren([q]);},getViPanel:function p(q){return this.getSelectedLayoutWidget().getViPanel(q);},selectViPanel:function m(r){var q=this.getViPanel(r);if(q){q.parent.selectPanel(q);}else{this.openViPanel(r);}},getPanelItems:function o(){return this.getSelectedLayoutWidget().getPanelItems();},getPanelTypeFromKey:function Q(q){return this.getSelectedLayoutWidget().getPanelTypeFromKey(q);},openViPanel:function k(r,s,q){this.getSelectedLayoutWidget().openViPanel(r,s,q);},onAppStateChange:function a(s){var t=mstrApp.rootCtrl,r=t.view.isCPVisible;this.layoutViewer.getSelector().set("visible",(!mstrApp.isAppStatePrintPreview())&&(!mstrApp.isAppStatePresentation()||this._layouts.length>1)&&r);this.forceLayout=false;var q=mstrmojo.vi.VisualInsightApp.APP_STATES.PRESENTATION;if(s.value&q||s.valueWas&q){this.forceLayout=true;}},onLayoutSelected:function c(t){var q=this.model,s=q.controller.cmdMgr,r=s.getInterimCmd();if(r){r.submitUpdate(t,s.CMD_PHASE.LAST);}else{q.execute({execute:function(){this.submitUpdate(t,s.CMD_PHASE.LAST);},urInfo:{treesToRender:3}});}},loadDocLayout:function X(q,t,s){var r=!s;s=s||this.model.getDataService().newUpdate();this._super(q,t,s);if(r){this.onLayoutSelected(s);}},setCurrentDocLayout:function V(q,s,r){r=r||this.model.getDataService().newUpdate(this);this._super(q,s,r);r.setTreesToRender(1);this.onLayoutSelected(r);},changeCurrLytTabTtl:function O(s,q){var r=this.layoutViewer.getSelector().getSelectedTab();if(r){r.set("title",s);r.titleEdited(s,q);}},getXtabCellMenuConfig:function(q){return new mstrmojo.vi.ui.rw.xtab.XtabMenuConfig(q);},layoutSelected:function G(q){this.layoutViewer.getSelector().layoutSelected(q);},selectPage:function l(r){var s=this.getLayout(),u=s&&s.docLayout,t=u&&u.docSection,v=t&&t.docSubSection,q=v&&v.children[0]&&v.children[0].children[1]&&v.children[0].children[1].children[0]&&v.children[0].children[1].children[0].selector;q.selectPage(r);},getRedisplayLayoutCallback:function A(r,s,t){var q=this.model;return{success:function(u){var v=this.replaceLayout(null,q.getChildren(u,false,r,1)[0],r);q.currlaykey=u.currlaykey;v.isPreview=mstrApp.isLayoutModePreview();this.reDisplayLayout(t,v);}.bind(this),failure:function(u){mstrApp.onerror(u);}};}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.vi.ui.DocumentView,{onhasDataSourceChange:function(){mstrmojo.css.toggleClass(this.domNode,"noDataSource",!this.hasDataSource);}});}());(function(){mstrmojo.requiresCls("mstrmojo.rw.DocController","mstrmojo.vi.ui.DocumentView","mstrmojo.vi.models.DocModel","mstrmojo.vi.controllers.EnumEvents","mstrmojo.hash","mstrmojo.func","mstrmojo.UUID","mstrmojo.vi.controllers.UICmdMgr","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.expr","mstrmojo.dom","mstrmojo.DocDataService","mstrmojo.vi.enums.EnumFeatures","mstrmojo.string");mstrmojo.requiresClsP("mstrmojo.vi.factories","VisualizationTransitionFactory");mstrmojo.requiresDescs(221,1388,5414,5415,5421,5422,11812,13157,14719);var x=mstrmojo.vi,v=mstrmojo.func,R=mstrmojo.hash,g=mstrmojo.array,k=mstrmojo.UUID,O=mstrmojo.desc,j=mstrmojo.Button.newWebButton,M=mstrmojo.expr,q=mstrmojo.DocDataService,Q=mstrmojo.dom,F=mstrmojo.vi.controllers.EnumEvents,U=x.models,K=mstrmojo.vi.enums.EnumFeatures;var b=3,l=4,X=1000;var r=12,d=3076;var I=1,n=2;var w={config:{waitBoxCfg:{message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress"}}};function C(E){return !!Object.keys(E.datasets||{}).length;}mstrmojo.vi.controllers.DocumentControllerBase=mstrmojo.declare(mstrmojo.rw.DocController,[],{scriptClass:"mstrmojo.vi.controllers.DocumentControllerBase",model:null,rootCtrl:null,view:null,visTransitionFactory:null,cmdMgr:null,start:function c(AA){var AC=new mstrmojo.vi.models.DocModel(AA),AB=this.rootCtrl;AC.lastSavedStid=AC.stid||0;AC.controller=this;AC.copyable=(AA.defn||{})["copyable"]!=="false";var AD=this.cmdMgr=new mstrmojo.vi.controllers.UICmdMgr({controller:this,model:AC});AD.dataService=AC.getDataService();var E=this.visTransitionFactory=new x.factories.VisualizationTransitionFactory();var AE=parseInt(mstrApp.viLayoutsCacheSize);var z=this.view=new x.ui.DocumentView({controller:this,model:AC,hasDataSource:C(AC),LAYOUTS_CACHE_SIZE:AE>=0?AE:10});this.set("model",AC);AC.attachEventListener("layoutSelected",z.id,"layoutSelected");AC.attachEventListener("selectPage",z.id,"selectPage");this.addDisposable([AD,E,AC,z]);},build:function o(){this.view.buildChildren();},submitTemplateUpdates:function H(E,AC,AD,AB,z,AA){if(AA){this.submitUndoRedoTemplateUpdates(E,AC,AD,AB,z);}else{this.model.getDataService().submitTemplateUpdates(E.k,AC,v.wrapMethods(this._getXtabCallback(E),AD),AB);}},submitUndoRedoTemplateUpdates:function e(E,AB,AC,AA,z){this.submitUndoRedoTemplateWithCallback(E,this.dataService().getUpdateTemplateAction(E.k,AB),AC,AA,z);},submitUndoRedoTemplateWithCallback:function B(E,AB,AC,AA,z){this.submitUndoRedoUpdates(AB,{},v.wrapMethods(this._getXtabCallback(E),AC),AA,z);},submitUndoRedoUpdates:function t(AB,z,AC,AA,E){this.cmdMgr.execute({execute:function(){this.submit(AB,AC,AA);},urInfo:R.copy(E,{callback:AC})});},exportVisualization:function D(E,AC){var AA=10000000;var AB=E.node.data.rw,z=function(){switch(AC){case b:this.printPDF(E.k);break;case l:this.exportExcel(E.k);break;}}.bind(this);if(AB&&(AB.col.tc*AB.row.tc>AA)){mstrmojo.warn(mstrmojo.desc(15506,"Exporting the dossier may take a few minutes. Do you want to export anyway?"),undefined,{buttons:[j(mstrmojo.desc(246,"Export"),z),j(mstrmojo.desc(221,"Cancel"),undefined,true)]});}else{z();}},getReloadLayoutViewCallback:function f(z){var E=this.view;return v.wrapMethods({success:function(){E.showSelectedLayout();}},z);},getRefreshCallback:function Y(){var E=this.model;return v.wrapMethods(E.getDatasetsUpdateCallback(),E.getReloadLayoutModelCallback(),this.getReloadLayoutViewCallback(),this.getUpdateTOCPanlelCallback());},getUpdateLayoutViewCallback:function h(z){var E=this.view;return v.wrapMethods({success:function(AA){E.updateLayouts(AA);}},z);},getUpdateTOCPanlelCallback:function J(z){var E=this.model;return v.wrapMethods({success:function(){E.raiseEvent({name:F.UPDATE_TOC});}},z);},getUpdateLayoutsCallback:function S(){var E=this.model;return v.wrapMethods(E.getDatasetsUpdateCallback(),this.getUpdateLayoutViewCallback());},getPartialUpdateCallback:function G(AC){var E={},AA=this,z=AA.model,AB=z.getSelectedViUnit().getZonesModel();return v.wrapMethods({success:function(AE){var AD=AE.pukeys&&AE.pukeys.split("\u001E");if(AD&&AD.length>0){E=z.getUnitDefinitions(AD);}z.partialUpdate(AE.data,E,AE.defn,AD);}},z.getUpdateHiddenLayoutsCallback(),AC||(AB&&AB.getUpdateCallback()));},_getXtabCallback:function W(z,AA,E){return v.wrapMethods(this._super(z,E),AA||(z.parent.getZonesModel&&z.parent.getZonesModel().getUpdateCallback()));},undo:function a(){this.cmdMgr.undo();},redo:function P(){this.cmdMgr.redo();},onCmdMgrChanged:function p(){mstrApp.rootCtrl.generateToolbar();},isDocChanged:function V(){var E=this.model,z=E.getDataService().stid||0,AA=E.lastSavedStid||0;return z>AA||!!E.dty;},dataService:function u(){return this.model.getDataService();},onKeepOnlyOrExcludeNodeAdded:function Z(z,E,AA){AA();},applyKeepOnly:function A(AG,AF,AE,AB,z){var E=AG.model,AA=AG.gridData||AG.model.data||AG.node.data,AD=this,AC=function(AK){var AL=E.getKeepOnlyActionsForAssociatedNodes(AK||[],AF),AI=AD.model,AJ=function(AM){var AN=AM?AI.wrapUnsetVisualizationFilterAction(AL.actions):AL.actions;AD.submitUndoRedoUpdates(AN,null,AL.callback);};if(z===false){AJ(false);return ;}AI.checkAndNotifyVFChangeOnKeepOnlyExclude({},function(){AJ(true);},function(){AJ(false);});}.bind(this),AH=AG.getSelectorDataForKeepOnly(AE,AB);if(AE){this.onKeepOnlyOrExcludeNodeAdded(E,AA,function(){AC(AH);});}else{AC(AH);}},clearFiltersForVis:function N(AB,E,AC){var z=AB.model,AA=z.getClearFiltersForVisActions(AB,undefined,E,AC);this.submitUndoRedoUpdates(AA.actions,null,AA.callback,AA.extras);},clearLinkingFilter:function s(E,z){this.submitUndoRedoUpdates([{act:"clearUCNodeCondition",nodeKey:E.nodeKey}],null,z,{style:{params:{treesToRender:3}}});},clearLinkingMultiFilter:function s(AG,AH,AI){var AA=[],AC=this.model,AB=AC.getCurrentLayoutKey(),AD=(AC.defn.layouts).filter(function(AL){return AL.k===AB;})[0],AF=AD.units,AK=AD.cgbMap,AE=R.keyarray(AK),z=AG.ckey,E,AJ;g.forEach(AH,function(AL){AJ=AL.vis.k;E=g.filter(AE,function(AM){if(AK[AM]===AJ){return AF[AM]&&g.find(AF[AM].scs,"ckey",z)>-1;}return false;});if(E.length){g.forEach(E,function(AM){AA.push({act:"clearUCNodeCondition",nodeKey:AM});});}});this.submitUndoRedoUpdates(AA,null,AI,{style:{params:{treesToRender:3}}});},applyKeepOnlyForMutilTemplate:function m(AI,AK,AF){var AL,AG,AE,z,AC,AD,AJ=this.model,AA,E,AM,AO=this,AB={actions:[],callback:AK},AN=function(AR,AT,AP,AQ){var AS=AR.getKeepOnlyActionsForAssociatedNodes(AQ,AB.callback,AT);AB.callback=AS.callback;AB.actions=AB.actions.concat(AS.actions);};g.forEach(AI,function(AP){AL=AP.vis;AG=AP.selectorData;AE=AP.nodeIdxToRemove;AD=AP.graphicLayer;z=AL.model;AA=AL.model.data||AL.node.data;AC=AA.k;E=AA.tpl;if(AE===-1){AM=[];}else{AM=[].concat(z.getSelectorDataFromTemplateLimit(E));}if(AE===-2){AM=mstrmojo.array.filter(AM,function(AQ){return !AQ.keepOnly;});}else{if(AE>=0){AM.splice(AE,1);}}if(AG){AM=AM.concat(AG);AO.onKeepOnlyOrExcludeNodeAdded(z,AA,function(){AN(z,AD,AC,AM);});}else{AN(z,AD,AC,AM);}});if(AB.actions&&AB.actions.length>0){var AH=function(AP){var AQ=AP?AJ.wrapUnsetVisualizationFilterAction(AB.actions):AB.actions;AO.submitUndoRedoUpdates(AQ,null,AB.callback);};if(!AF){AH(false);return ;}AJ.checkAndNotifyVFChangeOnKeepOnlyExclude({},function(){AH(true);},function(){AH(false);});}},clearFiltersForVisMultipleTemplate:function L(AC,E,AE){var AB,AA,AD,z={actions:[],callback:AE};g.forEach(AC,function(AG){AB=AG.vis;AD=AG.graphicLayer;AA=AB.model;var AF=AA.getClearFiltersForVisActions(AB,AD,E,z.callback);z.actions=z.actions.concat(AF.actions);z.callback=AF.callback;z.extras=AF.extras;});this.submitUndoRedoUpdates(z.actions,null,z.callback,z.extras);}});}());(function(){mstrmojo.requiresCls("mstrmojo.vi.controllers.DocumentControllerBase","mstrmojo.DI.DIConstants","mstrmojo.vi.ui.DocumentView","mstrmojo.vi.ui.VizGallery","mstrmojo.vi.ui.TableOfContents","mstrmojo.vi.models.DocModel","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.controllers._PanelControl","mstrmojo.vi.controllers._LayoutControl","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.ME.DerivedAttributeIDE","mstrmojo.hash","mstrmojo.func","mstrmojo.UUID","mstrmojo.vi.ui.DatasetEditor","mstrmojo.vi.controllers.UICmdMgr","mstrmojo.vi.ui.editors.ConfirmSaveEditor","mstrmojo.vi.ui.DatasetUnitMenuUtils","mstrmojo.vi.ui.editors.DerivedElementsEditor","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.Button","mstrmojo.vi.models.DEConsolidation","mstrmojo.vi.ui.editors.RenameDEEditor","mstrmojo.vi.ui.editors.CalculatedMemberEditor","mstrmojo.expr","mstrmojo.models.FormatModel","mstrmojo.dom","mstrmojo.DocDataService","mstrmojo.vi.ui.ToggleViewBar","mstrmojo.vi.ui.editors.nlp.NLPEditor","mstrmojo.vi.controllers._NLPControl","mstrmojo.vi.enums.EnumFeatures","mstrmojo.mstr.EnumFunction","mstrmojo.mstr.ElementsDataHelper","mstrmojo.string");mstrmojo.requiresClsP("mstrmojo.vi.factories","VisualizationTransitionFactory");mstrmojo.requiresDescs(221,1388,5414,5415,5421,5422,11812,13157,14719);var z=mstrmojo.vi,g=mstrmojo.func,R=mstrmojo.hash,N=mstrmojo.array,l=mstrmojo.array.forEach,AB=mstrmojo.UUID,A=mstrmojo.desc,C=mstrmojo.Button.newWebButton,AK=mstrmojo.expr,h=mstrmojo.vi.ui.DatasetUnitMenuUtils,e=mstrmojo.DocDataService,AD=mstrmojo.dom,c=mstrmojo.models.FormatModel,Ah=mstrmojo.vi.controllers.EnumEvents,L=mstrmojo.vi.controllers.EnumPanelManipulationType,Ae=mstrmojo.vi.controllers.EnumLayoutManipulationType,n=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,s=z.models,X=mstrmojo.vi.models.VIComponentMap.TYPES,AR=mstrmojo.vi.enums.EnumHiddenSections,AM=mstrmojo.vi.enums.EnumFeatures,q=mstrmojo.mstr.EnumFunction,V=mstrmojo.DocDataService.SUPPRESS_DATA;var Ai=3,AC=4,AA=1000;var AQ=12,AV=3076;var p=2;var Af={config:{waitBoxCfg:{message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress"}}};function Q(){var An=this.model.id;return{success:function E(Ao){mstrmojo.all[An].mid=Ao.mid;}};}function u(An,E,Aq){var Ap="mstrmojo-renameDerivedElement",Ao=mstrmojo.all[Ap]||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.RenameDEEditor",id:Ap,title:(Aq.funcVal===-1)?A(5414,"Create Group "):A(5415,"Create Calculation")});Ao.view=E;Ao.action=Aq;Ao.controller=An;Ao.open();Ao.set("title",(Aq.act.indexOf("edit")>=0)?A(1388,"Rename"):(Aq.funcVal===-1)?A(5187,"Group"):A(5188,"Calculation"));Ao.children[0].name.set("value",Aq.deName);}function Ad(An,E,Ap){var Aq="mstrmojo-CalculatedMemberEditor",Ao=mstrmojo.all[Aq]||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.CalculatedMemberEditor",id:Aq});Ao.view=E;Ao.action=Ap;Ao.controller=An;Ao.open();}function G(Ap,Ao,E){var Ar=this.id,An=this.model,Aq=R.walk("config.waitBoxCfg",E),At;if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){E=R.copy(E,R.copy(V,{preserveUndo:true}));At=An.getDataService().newUpdateWithoutCmd({extras:E});An.applyBufferedSelections(At);}E=R.copy(E,{params:{rapidExec:false,suppressData:true},message:(Aq&&Aq.message)||mstrmojo.desc(97,"Executing...")});this.view.layoutViewer.saveBoxLayout(undefined,undefined,{success:function As(){Ap.apply(mstrmojo.all[Ar],Ao);}.bind(this)},At,E);if(mstrApp.isAppStatePause&&mstrApp.isAppStatePause()){At.submit();}}function AG(Ar,Au,Ay,Ao){var Aw=this,An=[],Aq=[],As=[],Ax="\u001E",At=g.wrapMethods({success:function(A0){Ar.als=A0.als;}},Ar.controller.getRefreshCallback());N.forEach(Ay,function(A1){var A0=Ar.als&&Ar.als.links[Au+" "+A1.fid];N.forEach(A0,function(A2){An.push(A1.fid);var A3=A2.split(" ");Aq.push(A3[0]);As.push(A3[1]);});});if(An.length>0){var E=Aq[0],Av=null,Az=null;R.forEach(Ar.datasets,function(A0){N.forEach(A0.att,function(A1){if(A1.did===E){Av=A1.n;}else{if(A1.did===Au){Az=A1.n;}}if(Av&&Az){return false;}});if(Av&&Az){return false;}});new mstrmojo.Editor({params:null,cssClass:"mstrmojo-ConfirmEditLink-Editor",title:A(11812,"Notification"),onPreClose:function Ap(){Ao.canceled();this.hideTooltip();return true;},children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Warning-Box",children:[{scriptClass:"mstrmojo.Box",cssClass:"icon"},{scriptClass:"mstrmojo.Label",text:A(13157,"## and ### are linked. You need to unlink these attributes to make changes to ##.").replace("###",Av).replace(/##/g,Az),cssClass:"message"}]},{scriptClass:"mstrmojo.HBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[{scriptClass:"mstrmojo.Box"},C(mstrmojo.desc(13156,"Unlink and Edit"),function(){var A1=this.parent.parent,A0={act:"applyAttributeLinking",srcAttrId:Au,srcFormId:An.join(Ax),tgtAttrId:Aq.join(Ax),tgtFormId:As.join(Ax),unlink:true};Aw.cmdMgr.execute({execute:function(){this.submit(A0,g.wrapMethods(At,Ao),{style:{params:{treesToRender:3}}});},urInfo:{callback:At}});A1.close();},true,{width:"100px"}),C(mstrmojo.desc(221,"Cancel"),function(){Ao.canceled();this.parent.parent.close();})]}]}).render();}else{Ao.success();}}function B(An,Ar){var Ap=this,E=function(At){var As=Ap.daIDE.action,Aw=As.did,Av=this.dataset.set,Au=h.hasCGorCon(Av);At=N.filter(At,function(Az){var Ay=h.isCGorCon(Az,Av),Ax=(Az.t===47&&Az.st===12033);return Az.did!==Aw&&!Az.um&&!Az.rdm&&!Ay&&!Ax;});if(Ar||Au||An.isMDXDataset(Av)){At=N.filter(At,function(Ax){return Ax.t!==4;});}return At;},Ao=function(As){var At={};R.forEach(As,function(Au,Av){Au.isMDX=An.isMDXDataset(Au);Au.isDDA=An.isDDADataset(Au);Au.isSpark=An.isSparkDataset(Au);if(!(Au.isMDX&&Au.isDDA)){At[Av]=Au;}});return At;},Aq=Ar?{att:false,mx:false}:undefined;return R.copy({doubleClickItemHandler:function(As){Ap.daIDE.onObjectInsert(As);}},An.getDatasetsPanel("190px",E,Ao,Aq));}function AP(E,An){E.model.getDataService().refresh({styleName:"JsonRWDStyle"},g.wrapMethods(E.getRefreshCallback(),An));}function d(E,An){E.model.getDataService().refresh({styleName:"JsonRWDStyle",sessionState:mstrApp?mstrApp.sessionState:""},g.wrapMethods(An,E.getRefreshCallback()));}function Ac(E){return !!Object.keys(E.datasets||{}).length;}function j(){if(mstrApp.isSingleTier){var E=window.FormWrapper;if(E){E.serverRequest("syncRequests","","","");}}}mstrmojo.vi.controllers.DocumentController=mstrmojo.declare(mstrmojo.vi.controllers.DocumentControllerBase,[mstrmojo.vi.controllers._PanelControl,mstrmojo.vi.controllers._LayoutControl,mstrmojo.vi.controllers._NLPControl],{scriptClass:"mstrmojo.vi.controllers.DocumentController",datasetsPanel:null,tocPanel:null,galleryPanel:null,refStartTime:0,remTimeForRef:0,autoRefReqSent:false,autoRefReqId:undefined,start:function P(Aw){this._super(Aw);var A1=this.rootCtrl;var Av=this.model;var A0=this.view;var E=A1.view.linkbar;if(E){A1.view.attachEventListener(Ah.DO_LAYOUT,E.id,function(){A1.view.doLayout();});E.set("docId",Av.oid);E.showLinkBar(Av.isnew);}var Ax=c.ENUM_PROPERTY_NAMES.LAYOUT_TAB_POSITION,Au=Av[Ax]===undefined;if(Au){var An=(Av.isnew&&mstrApp.isWSStyling)?n.LEFT:n.BOTTOM;Av[Ax]=An;}var At=Av.defn.root.tocv;if(At===undefined){At=true;}if(!!mstrApp.isWSStyling){var Az=Av.defn.root,As=Az.tocw,Ay="174px";if(As){var Aq=parseInt(As,10);if(Aq<=mstrmojo.vi.ui.TableOfContents.MAX_WIDTH&&Aq>=mstrmojo.vi.ui.TableOfContents.MIN_WIDTH){Ay=As;}}this.tocPanel=new mstrmojo.vi.ui.TableOfContents({width:Ay,visible:At,data:Av.getTocData(),getPanelSaver:function(){return s.PanelFormatSaver.getPanelSaver(Av,{size:{set:"FormattingAnalysis",name:"TOCWidth",convert:true}});},model:Av});A1.view.attachEventListener(Ah.CONTENTS_PANEL_VISIBILITY_CHANGE,this.id,function(A2){this.tocPanel.onContentPanelVisibilityChange(A2);});Av.attachEventListener(Ah.UPDATE_TOC,this.id,function(){this.tocPanel.set("data",Av.getTocData());});this.addDisposable(this.tocPanel);A1.setTocPanel(this.tocPanel);}this.datasetsPanel=Av.getDocDatasetsPanel();A1.setDatasetObjectsPanel(this.datasetsPanel);var Ap=Aw.defn.root.layoutXML,Ar=Ap?!!Ap.go:true;this.galleryPanel=new z.ui.VizGallery({width:"170px",model:Av,visible:Ar&&mstrApp.allowWebDashboardDesign()});A1.setGalleryView(this.galleryPanel);if(!!mstrApp.isWSStyling){Av.attachEventListener("panelDisplaying",this.id,function(A2){this.tocPanel.set("displayPageInfo",{layoutKey:A2.layoutKey,panelKey:A2.panelKey});});Av.attachEventListener(Ah.CHANGE_COVER_IMAGE,this.id,function(A2){this.changeCoverPage(A2);});Av.ondefnChange();}A1.view.setIsCPVisible(At,true);A1.setDocumentView(A0);if(Aw.pvpe==="1"){mstrmojo.alert(mstrmojo.desc(15534,"Your personal view displays only a subset of your changes as the source dossier definition has been modified. Please contact your administrator for more information."));}var Ao=mstrApp.isSectionHidden(AR.VIPANE);if((Ao||mstrApp.isSectionHidden(AR.EDITOR))&&this.getViPanel("editPanel")){this.getViPanel("editPanel").setOpenStatus(false,true,undefined);}if((Ao||mstrApp.isSectionHidden(AR.PROPERTIES))&&this.getViPanel("propertiesPanel")){this.getViPanel("propertiesPanel").setOpenStatus(false,true,undefined);}if((Ao||mstrApp.isSectionHidden(AR.FILTER))&&this.getViPanel("filterPanel")){this.getViPanel("filterPanel").setOpenStatus(false,true,undefined);}if(mstrApp!==undefined&&window.mstrLocalStorage!==undefined){mstrLocalStorage.addScreenshot(mstrApp.getLastMsgRecoveryInfo(),A0.domNode);}Av.attachEventListener("layoutSelected",A0.id,"layoutSelected");Av.attachEventListener("selectPage",A0.id,"selectPage");Av.attachEventListener("updateDatasets",this.id,function(){A0.set("hasDataSource",Ac(Av));});Av.attachEventListener(Ah.MANIPULATE_LAYOUT,this.id,function(A2){this.manipulateLayout(A2);});Av.attachEventListener(Ah.MANIPULATE_PANEL,this.id,function(A2){this.manipulatePanel(A2);});this.addDisposable([this.datasetsPanel,this.galleryPanel]);if(mstrApp!==undefined&&window.mstrLocalStorage!==undefined){mstrLocalStorage.addScreenshot(mstrApp.getLastMsgRecoveryInfo(),A0.domNode);}if(mstrmojo.resolveFeature(AM.SUPPORT_NLP)&&Av.buildWordBase){Av.buildWordBase(true);}},convertToDoc:function W(){this.model.updateWidgetsProps();G.call(this,this._super,[true]);},save:function Z(An,E){this.model.updateWidgetsProps();j();G.call(this,this._super,[].concat(An||{}).concat(E||[]),Af);},savePromptOption:function(){var E=this;this.popPromptOption(function An(){E.dSave(undefined,undefined,true);});},printPDF:function S(Ao){var An=this.model,E=function E(){var Ap=An.getDataService().stid||0,Aq=An.lastSavedStid||0;if(Ap-Aq===1){An.lastSavedStid=Ap;}};G.call(this,g.composite([this._super,E]),[Ao]);},print:function K(E){if(AD.isChrome||(AD.isSafari&&AD.isMac())){var Ap=this;this.rootCtrl.togglePrintPreview(true);var An=window.matchMedia;if(An){var Ao=An("print");function Aq(Ar){var As=function(){Ap.rootCtrl.togglePrintPreview(false);Ao.removeListener(Aq);};if(!Ar.matches){As();}}Ao.addListener(Aq);}window.setTimeout(function(){window.print();},1300);}else{this.printPDF(E);}},dSave:function AH(As,Ar,Ap){var An=this,Aq=this._super,E=An.model,Ao=function(){E.getDataService().submitUpdates({},{submission:function(){mstrApp.showWait({message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress",showCancel:true});},complete:function At(){mstrApp.hideWait();},success:function(){Aq.call(An,As,Ar,Ap);E.set("lastModifiedTime",(new Date()).getTime());E.raiseEvent({name:Ah.LAST_MODIFIED_CHANGE,timeStamp:E.lastModifiedTime});}},R.copy(Af,{params:{taskId:"getObjectInfo",objectIDs:An.model.oid,objectTypes:"55"}}));};this.model.updateWidgetsProps();j();G.call(this,mstrApp.isSingleTier?this._super:Ao,undefined,Af);},openDME:function(At,Ap,An){var Ar=this,Aq=Ar.model,As=function Au(Av){return mstrmojo.array.filter(Av,function(Aw){return Aw.st!==AK.STP.CONS&&Aw.st!==AK.STP.CUSTOMGROUP&&Aw.did!==Ap.metricId;});},Ao=Ap.metricId||(Ap.action.refOi&&Ap.action.refOi.did),E=new mstrmojo.ME.DerivedMetricIDE({datasetsObjects:mstrmojo.hash.copy({visible:false},Aq.getDatasetsPanel("190px",As)),zIndex:5,disableConditionMetric:!mstrApp.supportFeature(AM.SUPPORT_CONDITION_METRIC)||Aq.isFromLiveMDXCube(Ao)});Ap.onApplyMetricCallback=An;Ap.datasets=Aq.datasets;E.open(At,Ap);E.datasetsObjects.refresh();this.addDisposable([E]);},openDAE:function o(Av,Ao,At,Ap){var Aq=this.model,Aw=this.daIDE=new mstrmojo.ME.DerivedAttributeIDE({datasetsObjects:B.call(this,Aq),zIndex:5}),Au=this,An=function(A2,Ay){var Az=Aw.action,A0=Az.did?Az.preupdate:Az.precreate,A1=Aq.controller.getRefreshCallback();A2=A0?A0(A2):A2;Au.submitUndoRedoUpdates(A2,null,g.wrapMethods(Ay,A1),R.copy(Az.extras,e.REQUEST_DEFN_DATA));};R.copy({cmd:"editNew",fnWait:At,msgID:Aq.mid,oncreate:An,onupdate:An},Ao);if(Ap){Ao.funccat=mstrmojo.ME.DerivedAttributeIDE.getDefaultFunctionCategory(Ap);var As=Ap.fs&&Ap.fs[0];if(As){Ao.refOi={n:Ap.n+"@"+As.fnm,did:Ap.did+"@"+As.fid};}}Aw.action=Ao;Aw.view=Av;if(Ao.did){AG.call(this,Aq,Ao.did,Ao.forms,{success:function Ax(){Aw.open(Av,{editorId:Ao.id});},failure:function E(){Aw.destroy();},canceled:function Ar(){Aw.destroy();}});}else{Aw.open(Av,{editorId:Ao.id});}this.addDisposable([Aw]);},openDynamicLinkEditor:function AN(Av,Ao,At,Ap){var Aq=this.model,Ar=this.daIDE=new mstrmojo.ME.DerivedAttributeIDE({datasetsObjects:B.call(this,Aq,true),zIndex:5,hasFunctionBrowser:false,onObjectInsert:function(Ax){mstrmojo.all.mstrDLE.onObjectInsert(Ax);}}),Au=this,An=function(A1,Ax){var Ay=Ar.action,Az=Ay.did?Ay.preupdate:Ay.precreate,A0=Aq.controller.getRefreshCallback();A1=Az?Az(A1):A1;Au.submitUndoRedoUpdates(A1,null,g.wrapMethods(Ax,A0),Ay.extras);};R.copy({cmd:"editNew",fnWait:At,msgID:Aq.mid,oncreate:An,onupdate:An},Ao);if(Ap){Ao.refOi=Ap;Ao.n=Ap.n+mstrmojo.desc(14719,"(Link)");}Ar.action=Ao;Ar.view=Av;if(Ao.did){AG.call(this,Aq,Ao.did,Ao.forms,{success:function Aw(){Ar.open(Av,{editorId:"mstrDLE"});},failure:function E(){Ar.destroy();},canceled:function As(){Ar.destroy();}});}else{Ar.open(Av,{editorId:"mstrDLE"});}this.addDisposable([Ar]);},resumeVIPanelSelection:function Ak(Ar){function Ao(At){var As=mstrmojo.array.filter(At.children,function(Au){return Au instanceof mstrmojo.vi.ui.BoxPanelContainer;});return As&&As[0];}function An(At){var Au=At.view&&At.view.getSelectedLayoutWidget(),As=Au&&Ao(Au);return As&&As.tabList;}var Aq=this,E=An(this),Ap=E&&E.selectedIndex;return g.wrapMethods({success:function(){var As=An(Aq);if(As){As.singleSelect(Ap);}}},Ar);},addChapter:function I(){var E=this.rootCtrl.view;if(!E.isCPVisible){E.setIsCPVisible(true);}this.model.raiseEvent({name:Ah.MANIPULATE_LAYOUT,type:Ae.NEW});},addPage:function U(){var Ao=this.model,Ap=Ao.getCurrentLayoutKey(),E=Ao.getVIComponent(X.VIZ_CONTENT,Ap),Aq=E.k;if(!!mstrApp.isWSStyling){var An=this.rootCtrl.view;if(!An.isCPVisible){An.setIsCPVisible(true);}}Ao.raiseEvent({name:Ah.MANIPULATE_PANEL,type:L.NEW,panelStackKey:Aq,layoutKey:Ap});},openNLP:function b(){var An=function(){var Ar=document.getElementsByClassName("mstrmojo-Editor-curtain"),Aq=false;N.forEach(Ar,function(As){Aq=(As.style.display==="block");return !Aq;});return Aq;};if(!mstrApp.isAppStateDefault()||mstrApp.isLayoutModePreview()||mstrApp.isVFEditingMode||mstrApp.isInVFConfigMode||mstrApp.isInVFInteractMode||An()){return ;}var E=this.model,Ap=this;var Ao=this.questionEditor;if(!Ao){this.questionEditor=Ao=this.addDisposable(mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.nlp.NLPEditor",model:E,docControl:Ap,top:"60px"}));this.addDisposable(Ao);}Ao.open();},insertVisualization:function AE(){var An=this.model,E=An.getVizContentPanel();E.restoreAnyMaxedVizBox();An.addVisualization();},insertFilter:function t(){var An=this.model,E=An.getVizContentPanel();E.restoreAnyMaxedVizBox();An.insertNewFilter();},getViPanel:function F(E){return this.view.getViPanel(E);},openViPanel:function AW(An,Ao,E){this.view.openViPanel(An,Ao,E);},selectViPanel:function k(E){this.view.selectViPanel(E);},insertText:function AF(){this.model.insertNewText();},insertHtml:function AJ(){this.model.insertNewHtmlContainer();},clearAllUnits:function m(){this.model.getSelectedViUnit().getZonesModel();},insertImage:function Y(){this.model.insertNewImage();},refresh:function AY(){AP(this,Q.call(this));},refreshWithData:function Aj(An){var Ao=this.model,E=Ao.defn.layouts;An.defn.layouts.forEach(function(Aq){var Ap=Aq.k;if(N.find(E,"k",Ap)===-1){Ao.replaceLayout(Ap,An,true);}});Ao.cbkey=An.cbkey;Ao.dsc=An.dsc;Ao.mid=An.mid;Ao.objInfo=An.objInfo;Ao.pfid=An.pfid;Ao.dataService=null;Ao.getDataService();this.getRefreshCallback().success(An);},toggleAutoRefresh:function(){this[(!!this.isAutoRefreshStarted()?"stop":"start")+"AutoRefresh"]();},startAutoRefresh:function D(){var E=this.model,An=E.rf,Ao=this;if(An>0){if(this.autoRefreshHandler){this.stopAutoRefresh();}this.refStartTime=new Date();this.autoRefreshHandler=setTimeout(function(){d(Ao,g.wrapMethods(Q.call(Ao),{success:function Aq(){if(E.clearDisposables){E.clearDisposables();}if(Ao.autoRefreshHandler){Ao.startAutoRefresh();}},submission:function Ar(As){Ao.autoRefReqId=As;Ao.autoRefReqSent=true;},complete:function Ap(){Ao.autoRefReqId=undefined;Ao.autoRefReqSent=false;Ao.remTimeForRef=0;}}));},((this.remTimeForRef!==0)?this.remTimeForRef:An)*AA);}},pauseAutoRefresh:function O(){if(this.autoRefreshHandler){clearTimeout(this.autoRefreshHandler);this.remTimeForRef=this.model.rf-(new Date().getTime()-this.refStartTime.getTime())/AA;}},showSaveToEnvDialog:function H(Aq,Ap,Ao){var E=this;mstrmojo.warn(mstrmojo.desc(15390,"To add existing objects from an application, the dossier needs to be saved in an environment at first. Do you want to continue?"),{confirmBtn:{t:this.model.isnew?mstrmojo.desc(118,"Save"):mstrmojo.desc(3167,"Save As"),fn:function An(){var As,At=Ao&&Ao.isParam;if(At){As=AB.create();E._datasetEditorConfig={id:As,config:Ao};}window.FormWrapper.saveAsDossier(At?Ap:Aq,Ap,As||"");}},cancelBtn:{t:mstrmojo.desc(221,"Cancel"),fn:function Ar(){if(Ao&&Ao.onCancel){Ao.onCancel();}}}});},addDataset:function Ag(Aq){if(mstrApp.isWorkstation){var An=window.FormWrapper;if(!An.hasAnyActiveEnvironment()){if(Aq&&Aq.onCancel){Aq.onCancel();}An.presentNoEnvironmentAlert(p);return ;}if(!(mstrApp.supportFeature(AM.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){this.showSaveToEnvDialog("addDataset","onCreateDatasetFailed",Aq);return ;}var Ap=this._datasetEditorConfig;if(typeof Aq==="string"&&Ap&&Ap.id===Aq){Aq=Ap.config;}var Ar;if(Aq&&Aq.isParam){Ar=AB.create();this._datasetEditorConfig={id:Ar,config:Aq};}An.showInsertExistingDatasets("onAddDatasetSuccess","onCreateDatasetFailed","onAddDatasetError",Ar||"");}else{var Ao=this,As=Ao&&Ao.datasetsPanel,E=As&&As.getShowDatasetPicker(Aq);if(E){E();}}},onAddDatasetError:function J(){var E=this.dataService();E.submitUpdates({act:"undo",stid:E.stid,killJob:true},null,{style:{params:{treesToRender:3},name:"RWIVEMojoStyle"}});},onAddDatasetSuccess:function AZ(An){var Ap=this._datasetEditorConfig;var Ao=An.config,E=An.dsId;if(typeof Ao==="string"&&Ap&&Ap.id===Ao){Ap.config.onOk(E);this._datasetEditorConfig=null;}},createDataset:function Al(Aq){var An=this,Ap=An.model,Ar=An&&An.datasetsPanel,Ao=this._datasetEditorConfig;if(typeof Aq==="string"&&Ao&&Ao.id===Aq){Aq=Ao.config;this._datasetEditorConfig=null;}if(mstrApp.isWorkstation){var E=window.FormWrapper;if(!E.hasAnyActiveEnvironment()){if(Aq&&Aq.onCancel){Aq.onCancel();}E.presentNoEnvironmentAlert(p);return ;}if(!(mstrApp.supportFeature(AM.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode())){this.showSaveToEnvDialog("createDataset","onCreateDatasetFailed",Aq);return ;}}if(Ar){Ar.openDatasetEditor(R.copy(Aq,{title:mstrmojo.desc(15395,"Add Existing Objects"),okBtnText:mstrmojo.desc(4447,"Add"),docModel:Ap,replaceDataset:!!Aq&&!Aq.n}));}},onCreateDatasetFailed:function AT(An){var E=this._datasetEditorConfig;if(typeof An==="string"&&E&&E.id===An){E.config.onCancel();this._datasetEditorConfig=null;}},importFile:function x(){var E=this.model&&this.model.controller,An=this.model,Ap=E&&E.datasetsPanel,Ao=[];R.forEach(An.datasets,function(Aq){if(Aq.st===779&&An.hasPrivilegesForAllTables(Aq.tables)){Ao.push(Aq);}});if(Ap&&Ap.showDataImport){Ap.showDataImport({isEdit:false,datasets:Ao,AnalysisId:this.model.mid,needDefn:true});}},inputConnectionDetails:function AX(Ap){var Ao=this;if(Ap&&Object.keys(Ap).length>0){this.model.existingServerConnection=Ap;}else{Ap=this.model.existingServerConnection;}this.model.operation="inputConnectionDetails";var An=function(){if(Ao.model.operation==="inputConnectionDetails"){Ao.model.operation="none";}mstrApp.serverRequest({taskId:"resumeDashboardExecution",checkCS:true},{success:function Aq(Ar){if(Ar&&Ar.statusOnly!==true){mstrApp.start(Ar);}}},{doNotHold:true});};var E=function(Ar){if(Ap&&Ar&&Ar.currentProject&&Ar.currentProject.project.id===Ap.datasets[0].connInfo.pid){mstrApp.serverRequest({taskId:"changeConnString",ws:Ar.currentProject.webServer.connection.id,isn:Ar.currentProject.iServer.name,isp:Ar.currentProject.iServer.port,pn:Ar.currentProject.project.name,pid:Ar.currentProject.project.id},{success:function As(){An();},failure:function Aq(){mstrmojo.error({shortDesc:mstrmojo.desc(14397,"Something went wrong when changing the connection string.")});}},{doNotHold:true});}else{if(Ap&&Ar&&Ar.currentProject.project.id!==Ap.datasets[0].connInfo.pid){mstrmojo.error({shortDesc:"We cannot find the dataset(s) in the logged in server. Please try a different server or edit the connection by going to preferences."});}else{}}};this.rootCtrl.loadDataProvider(E);},inputCredentials:function AL(Ao){var E=this.model&&this.model.controller,An=E&&E.datasetsPanel;if(An&&An.showDataImport){An.showDataImport({documentModel:Ao,StatusCode:4,callback:function(){mstrApp.serverRequest({taskId:"resumeDashboardExecution"},{success:function Ap(Aq){if(Aq&&Aq.statusOnly!==true){mstrApp.start(Aq);}}},{doNotHold:true});}});}},saveBeforeClosing:function v(Au,Ar){var As=this,An=As.model,Aq=An&&An.isnew,Ao=An&&An.isRWReadonly,Ap=function(){if(Au&&Au.success){Au.success();}if(Au&&Au.complete){Au.complete();}};if(this.isDocChanged()&&mstrmojo.resolveFeature("save-analysis")){if(!An.copyable){mstrmojo.confirm('<div class="warning-dialog-subject">Do you want to close this dossier?</div><div class="warning-dialog-description">Because the data has been limited for your specific user, no changes will be saved after closing the dossier.</div>',{confirmBtn:{t:A(2177,"Close"),fn:function(){Ap();}},cancelBtn:{t:A(221,"Cancel")}},{allowHTML:true,cssClass:"copyable-warning-on-close-editor",help:"Security_Filter_Create.htm"});}else{var At=function(){this.close();this.destroy();},E=new mstrmojo.vi.ui.editors.ConfirmSaveEditor({onSave:function(){if(Aq||Ao){As.save(null,Ar);}else{As.dSave(Au);}At.call(this);},onDonotSave:function(){Ap();At.call(this);},onCancel:function(){At.call(this);}});E.open();}}else{Ap();}},openDEEditor:function AI(Aq,A2){var A4=this,A1="mstrmojo-derivedElements",Au=mstrmojo.all[A1]||mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.DerivedElementsEditor",id:A1}),Aw=A2.deObj,At=Aw&&Aw.des,Ao=A2.fromDatasetPanel,Ap=A2.attId||(Aw&&Aw.attId),Ar=(A2&&A2.dsId)||(Aw&&Aw.dsId),An=A4.model.mid,Az=Ao?Aq.docModel:Aq.model.docModel,Av=Az.getObjectInfo(Ap),A0,As,A5=1,Ay={},Ax=new mstrmojo.XMLBuilder(),E=function(A6){A6.addChild("exp").addChild("nd").addAttribute("et",AK.ET.ANDOR).addAttribute("fn",AK.FN.AND).addChild("nds").addChild("nd").addAttribute("et",AK.ET.AE).addAttribute("fn",AK.FN.IN_LIST).addChild("a").addAttribute("did",Ap).closeElement().addChild("es");l(At,function(A7){if(A7.t===A5){l(A7.es,function(A8){A6.addChild("e").addAttribute("v",A8.v).addAttribute("n",A8.n).closeElement();});}});A6.closeElement().closeElement().closeElement().closeElement().closeElement();},A3=function(){if(A2.elemId){As=A2.elemId;delete A2.elemId;}A0=new mstrmojo.vi.models.DEConsolidation(A2);A0.xtab=Ao?null:Aq;A0.docModel=Az;A0.controller=A4;A0.fromDS=Ao;A0.isRA=Av&&Av.t===AQ&&Av.st===AV;Au.browseConfig={attributeID:Ap,datasetID:Ar,messageID:An};Au.set("model",A0);Au.open();if(As||!A2.deObj){Au.editItem(As);}};if(!At||At.length===0||!At.some(function(A6){return A6.t===A5;})){A3();return ;}A4.ifDataHelper=new mstrmojo.mstr.ElementsDataHelper({browseConfig:{styleName:"MojoAttributeStyle",attributeID:Ap,datasetID:Ar,messageID:An,useBrowseForm:1}});E(Ax);A4.ifDataHelper.browseConfig.expressionXML=Ax.toString();A4.ifDataHelper.getItems(1,{success:function(A6){l(A6.items,function(A7){Ay[A7.v]=A7.n;});l(At,function(A7){if(A7.t===A5){l(A7.es,function(A8){A8.n=Ay[A8.v]||A8.n;});}});A3(A6);},failure:function(A6){mstrmojo.alert(A6.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{});},onAddQuickDE:function AU(E,An){if(An.funcVal===q.FunctionApplySimple){Ad(this,E,An);}else{u(this,E,An,"addQuickDE");}},onEditQuickDEList:function a(E,Ao){var An=this;u(An,E,Ao,"editQuickDEList");},onEditQuickDECalculation:function AO(E,Ao){var An=this;u(An,E,Ao,"editQuickDECalculation");},onSetDEHierachyOptions:function Ab(E,An){this.submitDEAction(E,An);},editQuickDECalculation:function M(E,An){this.submitDEAction(E,An);},editQuickDECalculationNumberFormat:function AS(E,An){this.submitDEAction(E,An);},removeQuickDE:function f(E,An){this.submitDEAction(E,An);},submitDEAction:function w(E,Ar){this._addNodeKeyToAction(E,Ar);var Ao=this,Aq=this.dataService().getUpdateTemplateAction(E.k,Ar),An=this.model;An.addUpdateObjects(Aq,{id:Ar.oId,type:47,flag:mstrmojo.DocDataService.PARTIAL_UPDATE_FLAGS.DATA_CHANGE});var Ap=function(At){var As=[Aq];return function(){if(At){As=Ao.model.wrapUnsetVisualizationFilterAction(As);}Ao.submitUndoRedoUpdates(As,{},g.wrapMethods(An.getRebuildCallback(),An.getDatasetsUpdateCallback(),An.getUpdateHiddenLayoutsCallback()),e.REQUEST_DEFN_DATA);};};An.checkAndNotifyVFChangeOnGroupUpdate({actions:Aq},Ap(true),Ap(false));},addDSFromDatabase:mstrmojo.emptyFn,addDSFromFreeform:mstrmojo.emptyFn,close:function r(){var E=this._super.bind(this);mstrApp.onNavigateOut(null,E);},openCubeBrowser:function Am(E){mstrApp.rootCtrl.openCubeBrowser(E);},browseObjectsOnServer:function(){var Ao=this.datasetsPanel;var An=this;function Ap(){if(mstrApp.browseAllObjects===false){mstrmojo.alert(mstrmojo.desc(14332,"You do not have the privileges to browse the objects in this project."));}else{Ao.set("allObjectBrowserOpened",true);}An.model.operation="none";}this.model.operation="browseAllObjects";var E=mstrApp.rootCtrl.datasetsPanel;E.model.controller.rootCtrl.loadDataProvider(function(Aq){E.objectBrowser.set("dataProvider",Aq);Ap();});},uploadImageToServer:function(An,Ao){var E=this.dataService();E.uploadImageToServer(An,Ao);},addNamedDataset:function Aa(Ar){var Ap=this,E=Ar.objectId,An=Ar.objectType,Ao=this.model,Aq;if(!Ar.objectId){return ;}Aq={act:"addDataset",did:E,t:An,g:R.keyarray(Ap.datasetsPanel.data).length===1?1:0,disablePU:true};Ao.getDataService().submitUpdates(Aq,Ap.getRefreshCallback(),{style:{params:{treesToRender:1}}});},changeCoverPage:function(As){var E=As.url,An=As.originUrl,Ap=this.model,Ar=function(Av){Ap.objInfo=R.copy({icp:Av},Ap.objInfo);},Au=As.callback,At={success:function(){Au(E);Ar(E);}};var Ao={act:"changeCoverPage",url:E};Ap.execute({execute:function Aq(){this.submit(Ao,At,mstrmojo.DocDataService.SUPPRESS_DATA);},urInfo:{undo:function(){Au(An);Ar(An);},redo:function(){Au(E);Ar(E);},extras:{params:{suppressData:true}}}});}});}());(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.OIVMViewFactory","mstrmojo.vi.ui.BoxPanel","mstrmojo.vi.ui.DocBuilder","mstrmojo.vi.models.DocModel","mstrmojo.vi.controllers.DocumentController","mstrmojo.vi.controllers.UICmdMgr","mstrmojo.heatmap.vi.VisHeatmapUtility","mstrmojo.gm.GMUtility","mstrmojo.mstr.VisPropsEditorPanel");var P=mstrmojo.array;var S=mstrmojo.hash;var D=mstrmojo.EnumRWUnitType;var V=mstrmojo.heatmap.vi.VisHeatmapUtility;var E=mstrmojo.gm.GMUtility;var C=11;var I="mstrmojo-more-options-editor";var O="mstrmojo-simple-threshold-editor";var F={gm:"GraphMatrixVisualizationStyle",heatmap:"VIHeatMapVisualizationStyle",network:"NetworkVisualizationStyle"};function B(c,b){var d=null;if(c!==null&&typeof c==="object"){if(c.k===b&&c.vis&&c.vis.we){return c;}S.forEach(S.keyarray(c),function(e){if(c.hasOwnProperty(e)){d=B(c[e],b);}if(d){return false;}});}return d;}function A(c,b){var d=null;P.forEach(c.defn.layouts,function(e){P.forEach(S.keyarray(e.units),function(g){var f=e.units,h=f[g],j=(h&&h.t);if(!h||h._isDeleted||g!==b){return ;}if([D.GRID,D.GRAPH,D.GRIDGRAPH].indexOf(j)>-1){d=h;return false;}});if(d){return false;}});return d;}var U=[];mstrmojo.mstr.VisPropsEditor=mstrmojo.declare(mstrmojo.Editor,[],{scriptClass:"mstrmojo.mstr.VisPropsEditor",title:"Visualization Properties Editor",width:"220px",nodeKey:null,init:function W(b){this._super(b);mstrmojo.css.addWidgetCssClass(this,"mstrmojo-VisPropsEditor rw");if(!mstrApp.onerror){mstrApp.onerror=function(c){window.console.log(c);};U.push("onerror");}if(!mstrApp.isInteractive){mstrApp.isInteractive=function(){return false;};U.push("isInteractive");}},start:function H(){this.loadDocModelData();},close:function Q(){this._super();mstrmojo.array.forEach(U,function(b){delete mstrApp[b];});if(mstrmojo.all[I]){mstrmojo.all[I].destroy();}if(mstrmojo.all[O]){mstrmojo.all[O].destroy();}},children:[{scriptClass:"mstrmojo.HBox",alias:"buttonBarx",slot:"buttonNode",cssClass:"mstrmojo-VPE-buttonBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"btnOK",text:"OK",bindings:{enabled:function(){return(this.parent.parent.actions||[]).length>0;}},onclick:function(){var b=this.parent.parent;b.saveProps(b.actions);}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:"Cancel",onclick:function(){var b=this.parent.parent;b.close();}}]}],preparePropsPanelRendering:function a(c){var b=this;this.model=new mstrmojo.vi.models.DocModel(c);this.model.getDocBuilder=null;this.builder=new mstrmojo.vi.ui.DocBuilder({parent:this,model:this.model});mstrApp.viewFactory=new mstrmojo.OIVMViewFactory();this.controller=new mstrmojo.vi.controllers.DocumentController({model:this.model,submitUndoRedoUpdates:function(g){var e=b;g=mstrmojo.array.ensureArray(g);var f=g[0],d=e.mergeActions(f.actions?[{act:f.act,keyContext:f.keyContext||b.nodeKey,actions:f.actions}]:g);e.saveProps(d);}});this.model.controller=this.controller;this.controller.cmdMgr=new mstrmojo.vi.controllers.UICmdMgr({controller:this.controller,model:this.model,dataService:this.model.getDataService()});},isVizValid:function(){var b=this.getVisNode(),c=b&&b.data;if(!c){this.close();mstrmojo.alert(mstrmojo.desc(13687,"Unknown error"));return false;}switch(this.visName){case F.gm:if(E.isInvalidTemplate(c)){this.close();mstrmojo.alert(E.getInvalidTemplateErrMsg());return false;}break;case F.heatmap:if(V.isInvalidTemplate(c)){this.close();mstrmojo.alert(V.getInvalidTemplateErrMsg());return false;}break;case F.network:if((c.eg!==undefined)){this.close();mstrmojo.alert(c.eg);return false;}break;}return true;},renderPropsPanel:function R(b){this.preparePropsPanelRendering(b);if(!this.isVizValid()){return ;}this.addChildren([{scriptClass:"mstrmojo.mstr.VisPropsEditorPanel",alias:"propsPanel",width:parseInt(this.width)-2*C+"px",height:parseInt(this.height)-2*C+"px",edtModel:this.getEditorModel()}]);this.open();},getEditorModel:function G(){return this.getVisInstance().edtModel;},getVisNode:function Z(){this.node={defn:A(this.model,this.nodeKey),data:B(this.model.data,this.nodeKey)};var b=this.visName=this.builder.getMojoVisName(this.node);if(b){this.node.data.visName=b;}return this.node;},getVisInstance:function M(){var e=this,c=this.model,d=this.node=this.getVisNode();var b=this.builder.newMojoVisualization(c,d);b.defn=d.defn;b.k=this.nodeKey;b.updateAfterAction=function(f){e.set("actions",e.mergeActions(f));};if(this.visName===F.gm||this.visName===F.heatmap){b.submitUpdatesAndPersistXML=function(f){f=f||[];if(this.isXMLDirty&&this.isXMLDirty()){f.push(this.getPersistAction());}if(f.length===0){return ;}e.set("actions",e.mergeActions(f));};}b.parent=this;this.getTitleBarVisibility=function(){return true;};b.showTitleAndContainerFormats=false;if(b.zonesModel){b.zonesModel.checkAndWarnLargeItemsForAddUnits=function(f,g){g();};b.zonesModel.getUpdateCallback=function(){return{success:function(){var f=e.propsPanel&&e.propsPanel.contents;if(f){f.removeChildren();e.propsPanel.raiseEvent({name:"edtModelChanged"});}}};};}b.skipPaintedCheck=true;b.forceUpdateColorMap=true;b.skipSuppressDataCheck=true;b.update(d);this.renderViz(b);return b;},renderViz:function N(b){var c=[F.heatmap,F.gm,F.network].indexOf(this.visName)>-1;if(c){mstrApp.getThemeClassName=function(){return"mojo-theme-light";};b.placeholder=document.createElement("span");b.width="0px";b.height="0px";b.render();}if(this.visName===F.network){b.refresh=function(){};}if(this.visName===F.heatmap){b.reRender=function(){};}},mergeActions:function J(b){return(this.actions||[]).concat(b);},saveProps:function L(f,d){var e=this,c=function(){if(d!==false){e.close();}};if(f.length>0){this.submitPropsChange(f,function b(){if(e.onOK){e.onOK();}c();});}else{c();}},submitPropsChange:function K(e,b){var d={actions:e,style:{name:"RWIVEMojoStyle",params:{treesToRender:0}}};var c={taskId:"mojoRWManipulation",rwb:this.rwb,messageID:this.messageID,stateID:-1,params:JSON.stringify(d),suppressData:true};var f={success:function(g){b(g);},failure:function(g){mstrmojo.alert(g.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrmojo.xhr.request("POST",mstrConfig.taskURL,f,c);},loadDocModelData:function Y(){var c=this,b="ServerJsonRWDStyle";this.retrieveServerJson({host:this,nodes:[this.nodeKey]},{success:function(d){c.renderPropsPanel(d);},failure:function(d){mstrmojo.alert(d.getResponseHeader("X-MSTR-TaskFailureMsg"));}},{style:{name:b,params:{treesToRender:3}},params:{styleName:b}});},retrieveServerJson:function X(c,m,d){var k={},b,h;var j=c.nodes;if(j){k.partialRetrieval=j;}var l=c.slices;if(l){k.slices=l;}if(d){b=d.style;h=d.params;}var g=mstrApp&&mstrApp.isAppStatePause&&mstrApp.isAppStatePause(),f=!!(mstrConfig&&mstrConfig.resolveOnly);var e={taskId:"getServerJSONResults",styleName:"ServerJsonRWDStyle",compress:1,rwb:this.rwb,messageID:this.messageID,excludeData:g||f,stateID:-1,params:JSON.stringify(k)};if(this.executionMode){e.executionMode=this.executionMode;}mstrmojo.hash.copy(h,e);mstrmojo.xhr.request("POST",mstrConfig.taskURL,m,e);}});}());