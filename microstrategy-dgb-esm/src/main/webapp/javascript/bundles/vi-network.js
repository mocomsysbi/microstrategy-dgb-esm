mstrmojo.chart.enums.EnumLineStyle={LS_SOLID:0,LS_DASH:1,LS_DOT:2,LS_DOT_DASH:3,LS_DASH_DOT_DOT:4,LS_MEDIUM_DASH:5,LS_SHORT_DASH:6,LS_LONGEST_DASH:7,LS_LONG_DOT:8,LS_DOT_DOT_DOT:9,LS_DASH_DASH_DOT:10,LS_DASH_DASH_DOT_DOT:11,LS_LONG_DASH_DOT:12,LS_LONG_DASH_DOT_DOT:13,LS_LONG_DASH_DASH:14,LS_LONG_DASH_DASH_DASH:15,LS_GRADIENT:16,LS_NONE:99};(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum");var D=mstrmojo.array,A=mstrmojo.VisEnum,B=A.NETWORK_LAYOUT.LINEAR;mstrmojo.netviz._LinearLayout=mstrmojo.provide("mstrmojo.netviz._LinearLayout",{_mixinName:"mstrmojo.netviz._LinearLayout",init:function(E){if(this._super){this._super(E);}if(this.layouts===undefined){this.layouts={};}this.layouts[B]=C;}});function C(H,J,G){var E=H.nodes,I=E.length,M=G.dimension,K=Math.max(10,(180-M)/I)/2,F=J.height,L=-1*K,N=F/2;J.currentLayout=B;D.forEach(H.nodes,function(P){if(P.isExcluded){return ;}var O=P.sprite,Q=O.getGeometry(),R=Q.s;Q.x=L+R+K;Q.y=N;O.setGeometry(Q);L+=2*(R+K);});D.forEach(H.edges,function(Q){var V=Q.from.sprite,W=Q.to.sprite,O=V.getGeometry(),P=W.getGeometry(),T=P.x-O.x,S=P.y-O.y,X=(O.x+P.x)/2,U=(O.y+P.y)/2;Q=Q.sprite;var R={x:X-S*0.5,y:U+T*0.5};Q.setGeometry(R);});}}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum");var D=mstrmojo.array,A=mstrmojo.VisEnum,B=A.NETWORK_LAYOUT.CIRCULAR;mstrmojo.netviz._CircularLayout=mstrmojo.provide("mstrmojo.netviz._CircularLayout",{_mixinName:"mstrmojo.netviz._CircularLayout",init:function(E){if(this._super){this._super(E);}if(this.layouts===undefined){this.layouts={};}this.layouts[B]=C;}});function C(L,N,J){function K(Q){if(Q.isExcluded){return ;}var R=Q.sprite.getGeometry(),P,O;G+=F;R.x=Math.cos(G)*E+E+I;R.y=Math.sin(G)*E+E+I;Q.sprite.setGeometry(R);if(Q.edges){for(P=0,O=Q.edges.length;P<O;P++){Q.edges[P].sprite.setGeometry({x:E+I,y:E+I,type:"bezier"});}}G+=F;}var G=0,I=J.maxR+A.NETWORK_CIRCLE_BORDER_WIDTH,M=J.circleCount,H=M*I*2,E=Math.max(Math.min(N.width,N.height)/2-I,H/(2*Math.PI)),F=Math.PI/M;N.currentLayout=B;D.forEach(L.nodes,K);}}());(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom,D=Math;mstrmojo.gm._IsAnchorable={PLACEMENT_ABOVE:1,PLACEMENT_BELOW:2,PLACEMENT_LEFT:3,PLACEMENT_RIGHT:4,anchor:null,anchorPosition:null,boundary:null,boundaryPosition:null,popupNodeName:"infoNode",tipNodeName:"tipNode",baseTipClass:"arrow",infoNodeOffset:25,popupNodeOffset:0,placementOrder:[this.PLACEMENT_ABOVE,this.PLACEMENT_BELOW,this.PLACEMENT_LEFT,this.PLACEMENT_RIGHT],hasScrollbars:function G(){return(!mstrApp.isTouchApp||!mstrApp.isTouchApp());},positionDialog:function E(){if(!this.anchorPopup()){if(typeof this._super==="function"){this._super();}}},positionTipNode:function A(I){var J=this.baseTipClass,K=this[this.tipNodeName];K.className=J+" "+I;},getTipDimension:function B(){var J=this[this.tipNodeName],I=C.position(J);return I;},anchorPopup:function F(){this.positionTipNode("top");var K=this.anchor,b=this.boundary,n=this[this.popupNodeName],q=this.infoNodeOffset,h=this.popupNodeOffset,k=this.hasScrollbars(),Y=this.anchorPosition||C.position(K,true),M=this.boundaryPosition||C.position(b,true),s=M.w,L=M.h,c=n.offsetWidth,O=n.offsetHeight,U=c/2,I=O/2,W=this.getTipDimension(),g=D.min(W.h,W.w),P=D.max(W.h,W.w)/2;if(k){s-=15;L-=15;}var Z=C.contains(b,n),j=Z?0:M.y,r=s/2-U,Q=L/2-I+j,m=-1000,t=-1000;if(Z){Y.x=Y.x-M.x;Y.y=Y.y-M.y;}var f=Y.y+Y.h,N=Y.x+Y.w,e=Y.x>c,o=((N+c)<s),R=Y.y>O,l=((f+O)<L),T=this,V=function(i,v,u){return D.min(D.max(i,u),D.max(v,0));},d=function(){if((Y.x<s)&&R){var i=Y.x+(Y.w/2);T.positionTipNode("bottom");t=Y.y-g-h;Q=t-O+q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},J=function(){if((Y.x<s)&&l){var i=Y.x+(Y.w/2);T.positionTipNode("top");t=f+h;Q=t+g-q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},a=function(){if((Y.y<L)&&e){var i=Y.y+(Y.h/2);T.positionTipNode("right");m=Y.x-g-h;r=m-c+q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},X=function(){if((Y.y<L)&&o){var i=Y.y+(Y.h/2);T.positionTipNode("left");m=N+h;r=m+g-q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},S=[],p;for(p=0;p<this.placementOrder.length;p++){switch(this.placementOrder[p]){case this.PLACEMENT_ABOVE:S.push(d);break;case this.PLACEMENT_BELOW:S.push(J);break;case this.PLACEMENT_LEFT:S.push(a);break;case this.PLACEMENT_RIGHT:S.push(X);break;}}for(p=0;p<S.length;p++){if(S[p]()){break;}}Q=D.round(Q);r=D.round(r);t=D.round(t);m=D.round(m);this.applyPopupNodePos(Q,r,t,m);return true;},applyPopupNodePos:function H(K,J,M,I){var O=this[this.tipNodeName],L=O.style,P=this[this.popupNodeName],N=P.style;L.top=M+"px";L.left=I+"px";N.top=K+"px";N.left=J+"px";}};}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.gm.GMEnums");var A=mstrmojo.gm.EnumIdentityType;mstrmojo.gm.GMIdentities=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GMIdentities"});mstrmojo.gm.HeaderCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.HeaderCellIdentity",eid:undefined,v:undefined,tid:undefined,n:undefined,tui:undefined,fid:undefined,o:undefined,isRowAttribute:undefined,at:undefined,dei:undefined,dpt:undefined});mstrmojo.gm.GeneralIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GeneralIdentity",objType:undefined});mstrmojo.gm.TitleCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.TitleCellIdentity",tid:undefined,fid:undefined,n:undefined,tui:undefined,isRowAttribute:undefined,otp:undefined,init:function(B){this.fid=B.fid;this.tid=B.id;this.isRowAttribute=B.isRowAttribute;if(B.isRowAttribute){this.objType=A.ROW_TITLE;}else{this.objType=A.COL_TITLE;}this.n=B.n;this.otp=B.otp;this.ost=B.ost;this.tui=B.tui;}});mstrmojo.gm.MetricAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.MetricAxisTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AttributeAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AttributeAxiTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AxisIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AxisIdentity",isNumericAxis:undefined,metricIdxArr:undefined,attrIdArr:undefined});mstrmojo.gm.ColorSquareIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.ColorSquareIdentity",init:function(B){this._super(B);this.comb=this.getElementsCombination();},getElementsCombination:function(){var B,F=this.token,C,H,G,E,I,D;if(F){D=[];C=F.levels;H=F.elements;G=F.types;B=C.length;for(E=0;E<B;E++){I={eid:H[E],tid:C[E]};if(G){I.tp=G[E];}D.push(I);}return D;}return undefined;}});}());(function(){var E=false;mstrmojo.requiresCls("mstrmojo.Base");mstrmojo.netviz.PropertyParser=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.PropertyParser",methods:{unmarshal:function(W,V){var U=this;U._withConfig({unmarshal:true},function(){U.parsedProps[W]=V;});},marshal:function(V){var U=this;return U._withConfig({marshal:true},function(){return U.parsedProps[V];});}},init:function(U){if(this._super){this._super(U);}this.config={marshal:false,unmarshal:false};this.parsedProps={};},parse:function(V,X){var W=this,Y=this.parsedProps,U=this.methods;this.raw=V;this.schema=X;Object.keys(U).forEach(function(Z){W.defineMethod(Z,U[Z]);});Object.keys(X).forEach(function(Z){var a=X[Z];W.defineProperty(Z,a.type);Y.unmarshal(Z,V[a.key]);});return Y;},defineProperty:function(U,c){var b=this,W=b.config,a=this.parsedProps,V=(this.schema||{})[U]||{},g=V.preSet,Y=V.postSet,X=V.preGet,d=V.postGet,f=V.key,e=this.raw,Z;if(!T(c)){throw new TypeError("type does not implement required methods");}Object.defineProperty(a,U,{enumerable:true,get:function(){var h=Z;if(h!==undefined&&W.marshal){if(X instanceof Function){h=X.call(a,h,U,e,f);}h=c.marshal(h);if(d instanceof Function){h=d.call(a,h,U,e,f);}}return h;},set:function(i){var h=i;if(W.unmarshal){if(g instanceof Function){h=g.call(a,h,U,e,f);}h=c.unmarshal(h);if(Y instanceof Function){h=Y.call(a,h,U,e,f);}}if(h!==undefined&&!c.validate(h)){throw new TypeError("Invalid value in setter. Consider unmarshal(prop, val).");}Z=h;}});},defineMethod:function(X,U){var V=this,W=V.parsedProps;if(!L(X)||!(U instanceof Function)){return ;}Object.defineProperty(W,X,{enumerable:false,value:U.bind(V)});},_withConfig:function(W,Z){var X=this.config,Y=Object.keys(W||{}),V=Y.reduce(function(b,a){b[a]=X[a];return b;},{}),U;Y.forEach(function(a){X[a]=W[a];});U=Z();Y.forEach(function(a){X[a]=V[a];});return U;}});var O=Object.prototype.toString,G=mstrmojo.netviz.PropertyParser;function J(X,W,V){var U=parseInt(X,W);return isNaN(U)?V:U;}function N(U){return O.call(U)==="[object Number]";}function L(U){return O.call(U)==="[object String]";}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.PropertyParser.Property",init:function(U){if(this._super){this._super();}this.defval=U.defval;},marshal:function(U){return JSON.stringify(U).replace(/"/g,"'");}});G.BooleanProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.BooleanProperty",unmarshal:function(U){if(U===undefined){return this.defval;}return U.toString()==="true";},validate:function(U){return U===true||U===false||O.call(U)==="[object Boolean]";}});G.IntegerProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.IntegerProperty",unmarshal:function(U){return J(U,10,this.defval);},validate:N});G.FloatProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.FloatProperty",unmarshal:function(V){var U=parseFloat(V);return isNaN(U)?this.defval:U;},validate:N});G.JsonProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.JsonProperty",unmarshal:function(U){function V(X){var W;if(X!==undefined){try{W=JSON.parse(X.replace(/'/g,'"'));}catch(Y){W=X;}}return W;}if(typeof U==="string"){return V(U);}if(U!==undefined&&U!==null){return U;}return this.defval;},validate:function(U){return true;}});G.StringProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.StringProperty",unmarshal:function(U){if(U!==undefined&&U!==null){return U.toString();}return this.defval;},marshal:function(U){return U;},validate:L});var K=["BooleanProperty","StringProperty","JsonProperty","IntegerProperty","FloatProperty"];K.forEach(function(U){var V=G[U];V.preset=function(W){return new V({defval:W});};});function T(U){return Q(U,["marshal","unmarshal","validate"]);}function Q(V,U){if(!V){return false;}return(U||[]).every(function(W){return V[W] instanceof Function;});}if(E){var C=new G(),F=G.BooleanProperty,H=G.IntegerProperty,B=G.FloatProperty,S=G.StringProperty,M=G.JsonProperty;var R={x:1,y:{x:"n+1"},z:true,m:3.14};var P={bp1:"false",bp2:"true",bp3:"",dp1:"12",dp2:22,fp1:23.3,fp2:"3.14",sp1:"foobar",jp1:R,jp3:"transparent"};var A={boolProp1:{key:"bp1",type:F.preset(false)},boolProp2:{key:"bp2",type:F.preset(false)},boolProp3:{key:"bp3",type:F.preset(false)},boolProp4:{key:"bp4",type:F.preset(false)},boolProp5:{key:"bp5",type:F.preset(true)},decimalProp1:{key:"dp1",type:H.preset(-1)},decimalProp2:{key:"dp2",type:H.preset(-1)},decimalPropn:{key:"dpn",type:H.preset(-1)},floatProp1:{key:"fp1",type:B.preset(0)},floatProp2:{key:"fp2",type:B.preset(0)},floatProp3:{key:"fp3",type:B.preset(0.03)},stringProp1:{key:"sp1",type:S.preset("")},stringProp2:{key:"sp2",type:S.preset("string")},jsonProp1:{key:"jp1",type:M.preset({})},jsonProp2:{key:"jp2",type:M.preset({})},jsonProp3:{key:"jp3",type:M.preset("error")}};var D=C.parse(P,A);console.assert(Object.keys(D).length===Object.keys(A).length,"wrong property count");console.assert(D.unmarshal instanceof Function,"unmarshal not found");console.assert(D.marshal instanceof Function,"marshal not found");console.assert(D.boolProp1===false);console.assert(D.boolProp2===true);console.assert(D.boolProp3===false);console.assert(D.boolProp4===false);console.assert(D.boolProp5===true);console.assert(D.marshal("boolProp5")==="true");D.unmarshal("boolProp5","false");console.assert(D.boolProp5===false);console.assert(D.marshal("boolProp5")==="false");console.assert(D.decimalProp1===12);console.assert(D.decimalProp2===22);console.assert(D.decimalPropn===-1);D.unmarshal("decimalProp1",42);console.assert(D.decimalProp1===42);console.assert(D.marshal("decimalProp1")==="42");console.assert(D.floatProp1===23.3);console.assert(D.marshal("floatProp1")==="23.3");console.assert(D.floatProp2===3.14);console.assert(D.floatProp3===0.03);D.unmarshal("floatProp3",100);console.assert(D.floatProp3===100);console.assert(D.stringProp1==="foobar");console.assert(D.stringProp2==="string");D.unmarshal("stringProp2","quux");console.assert(D.marshal("stringProp2")==="quux");D.unmarshal("stringProp2",42);console.assert(D.stringProp2==="42");console.assert(JSON.stringify(D.jsonProp1)===JSON.stringify(R));console.assert(Object.keys(D.jsonProp2).length===0);console.assert(D.jsonProp3==="transparent");console.assert(D.marshal("jsonProp1")===JSON.stringify(R).replace(/"/g,"'"));D.unmarshal("jsonProp2",true);console.assert(D.jsonProp2===true);console.assert(D.marshal("jsonProp2")==="true");console.info("PropertyParser: all tests processed");}}());(function(){mstrmojo.requiresCls("mstrmojo.Base");var B=false;mstrmojo.netviz.Bitmap=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.Bitmap",init:function(F){if(this._super){this._super();}var I=F.scale||1,H=F.left,G=F.top,E=F.right,D=F.bottom;if(I>1){H/=I;G/=I;E/=I;D/=I;}this._colCnt=Math.ceil(E)-Math.floor(H)+1;this._rowCnt=Math.ceil(D)-Math.floor(G)+1;this._scale=I;this._bits=[];},testZeros:function(H){var J=C.call(this,H),G=J.left,I=J.top,L=J.right,D=J.bottom,M=this._bits,K=this._colCnt,N,F,E;for(N=I;N<=D;N+=1){for(F=G;F<=L;F+=1){E=M[N*K+F];if(E&&A(E,H)){return false;}}}return true;},set:function(G){var I=C.call(this,G),F=I.left,H=I.top,L=I.right,D=I.bottom,M=this._bits,K=this._colCnt,N,E,J;for(N=H;N<=D;N+=1){for(E=F;E<=L;E+=1){J=N*K+E;if(!M[J]){M[J]=G;}}}}});function A(E,D){if(E.left>D.right||D.left>E.right){return false;}if(E.top>D.bottom||D.top>E.bottom){return false;}return true;}function C(G){var I=G.left,H=G.top,F=G.right,D=G.bottom,E=this._colCnt,K=this._rowCnt,J=this._scale;if(J>1){I/=J;H/=J;F/=J;D/=J;}I=Math.floor(I);F=Math.ceil(F);H=Math.floor(H);D=Math.ceil(D);if(F>=E){F=E-1;}if(I<0){I=0;}if(I>F){I=F;}if(D>=K){D=K-1;}if(H<0){H=0;}if(H>D){H=D;}return{top:H,left:I,bottom:D,right:F};}if(B){(function(){function D(I,H,G,F){return{left:I,top:H,right:G,bottom:F};}var E=new mstrmojo.netviz.Bitmap({left:0,top:0,right:100,bottom:100});console.assert(E.testZeros(D(10,15,50,20)));E.set(D(10,25,50,50));console.assert(E._bits.reduce(function(F){return F+1;},0)===41*26);console.assert(E.testZeros(D(10,15,50,20)));console.assert(!E.testZeros(D(10,15,50,25)));console.assert(!E.testZeros(D(0,0,100,100)));console.assert(E.testZeros(D(75,70,100,75)));console.assert(E.testZeros(D(-1,-1,-1,-1)));console.assert(E.testZeros(D(-1,100,1000,1000)));console.assert(!E.testZeros(D(50,50,50,50)));}());}}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=Math,I=mstrmojo.dom,K=mstrmojo.css,E="active",L="ready",J=6,F=10,O=10,P={LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",BUTTON:"button"};mstrmojo.util.ui.LassoSelectorParamsType=null;function Q(S,R,T){return function(U){S.call(mstrmojo.all[R],U,T);};}function M(S){var U=S.view,T=I.eventTarget(window,S),R=this.lassoSelector;if(this.clickFromLassoResizer||(T!==R&&this.clickFromCreatingLasso)){I.stopPropogation(U,S);I.preventDefault(U,S);}delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;}function D(b,U){var R,d,S,Z,a=b.clientX,Y=b.clientY,T=this.lassoSelector,X=U.startX,W=U.startY,V=U.containerPos,e=a-V.x,c=Y-V.y;e=C.min(e,U.maxX);e=C.max(e,U.minX);c=C.min(c,U.maxY);c=C.max(c,U.minY);R=C.abs(e-X);d=C.abs(c-W);Z=C.min(W,c);S=C.min(X,e);T.style.width=R+"px";T.style.height=d+"px";T.style.left=S+"px";T.style.top=Z+"px";U.width=R;U.height=d;U.left=S;U.top=Z;if(R<=O&&d<=O){T.style.visibility="hidden";K.removeClass(T,E);}else{T.style.visibility="visible";K.addClass(T,E);document.body.style.cursor="crosshair";}}function H(T,W){var V=window.document,S=this.lassoSelector,U=W.width,R=W.height;I.detachEvent(V,"mousemove",W.fnMove);I.detachEvent(V,"mouseup",W.fnUp);delete W.fnMove;delete W.fnUp;document.body.style.cursor="default";if(!U||U===0||!R||R===0){this.dismissLassoSelector();}else{W.ctrlKey=T.ctrlKey;this.lassoSelected(W);this.clickFromCreatingLasso=true;K.addClass(S,L);this.positionBoxResizers();}}function N(g){var Z,c=g.view,b,a,d=I.eventTarget(window,g),R=d.getAttribute("type"),V=this.lassoSelector,S=this.lassoContainer,h=this.excludeAttrArr,U=h.length,Y,X={};delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;if(!V||!S||!this.lassoSelectorEnabled){return ;}if(I.contains(this.dropDownBtn,d,true)){return ;}for(Z=0;Z<U;Z++){if(R===h[Z]){return ;}}this.lassoSelecting();Y=I.position(S);b=g.clientX-Y.x;a=g.clientY-Y.y;X.containerPos=Y;X.maxX=Y.w;X.maxY=Y.h;X.startX=b;X.startY=a;X.minX=0;X.minY=0;X.info=this.getLassoSelectionInfo(d);X.useAsSelectorOrBrushes=this.useAsSelectorOrBrushes||((this.hasAssociatedNodes&&this.hasAssociatedNodes())||this.selectorControl);V.style.visibility="hidden";V.style.left=b+"px";V.style.top=a+"px";V.style.width="0px";V.style.height="0px";K.removeClass(V,L);S.appendChild(V);var T=this.id,e=document,W=Q(D,T,X),f=Q(H,T,X);I.attachEvent(e,"mousemove",W);I.attachEvent(e,"mouseup",f);X.fnMove=W;X.fnUp=f;I.stopPropogation(c,g);I.preventDefault(c,g);}function G(a,U){var Y=U.index,X=U.startX,W=U.startY,V=U.containerPos,f=a.clientX-V.x,e=a.clientY-V.y,T=this.lassoSelector;f=C.min(f,U.maxX);f=C.max(f,U.minX);e=C.min(e,U.maxY);e=C.max(e,U.minY);var d=f-X,c=e-W;if(Y%3===1){d=0;}if(Y===3||Y===5){c=0;}var R=U.selWidth,b=U.selHeight,S=U.selLeft,Z=U.selTop;if(d!==0){if(Y%3===0){S+=d;R-=d;}else{R+=d;}}if(c!==0){if(Y<3){Z+=c;b-=c;}else{b+=c;}}T.style.width=R+"px";T.style.left=S+"px";T.style.top=Z+"px";T.style.height=b+"px";U.width=R;U.left=S;U.height=b;U.top=Z;this.positionBoxResizers();}function B(R,U){var T=R.view,S=window.document;I.detachEvent(S,"mousemove",U.fnMove);I.detachEvent(S,"mouseup",U.fnUp);delete U.fnMove;delete U.fnUp;this.clickFromLassoResizer=true;I.stopPropogation(T,R);I.preventDefault(T,R);this.lassoSelectorResized(U);}function A(V){var T=V.view,h=I.eventTarget(window,V),U=parseInt(h.getAttribute("index"),10),a=this.lassoSelector,Z=a.offsetLeft,j=a.offsetTop,Y=Z+a.offsetWidth,g=j+a.offsetHeight,R=I.position(this.lassoContainer),f=0,c=0,d=R.w,b=R.h,e={};if(U%3===0){d=Y-F;}if(U%3===2){f=Z+F;}if(U<3){b=g-F;}if(U>=6){c=j+F;}e.minX=f;e.minY=c;e.maxX=d;e.maxY=b;e.startX=V.clientX-R.x;e.startY=V.clientY-R.y;e.index=U;e.containerPos=R;e.selWidth=a.clientWidth;e.selHeight=a.clientHeight;e.selLeft=a.offsetLeft;e.selTop=a.offsetTop;var X=this.id,i=document,S=Q(G,X,e),W=Q(B,X,e);I.attachEvent(i,"mousemove",S);I.attachEvent(i,"mouseup",W);e.fnMove=S;e.fnUp=W;I.stopPropogation(T,V);I.preventDefault(T,V);}mstrmojo.util.ui._LassoSelector=mstrmojo.provide("mstrmojo.util.ui._LassoSelector",{_mixinName:"mstrmojo.util.ui._LassoSelector",lassoContainer:undefined,lassoSelector:undefined,lassoSelectorEnabled:true,excludeAttrArr:null,boxResizers:null,useDropDownBtn:false,dropDownBtn:undefined,init:function(R){if(this._super){this._super(R);}this.excludeAttrArr=[];this.boxResizers=[];},registerLassoSelector:function(S,V,U){V=V||[];V.push(P.LASSO_SELECTOR);V.push(P.LASSO_RESIZER);V.push(P.BUTTON);this.lassoContainer=S;this.excludeAttrArr=V;this.useDropDownBtn=U||false;I.attachEvent(S,"mousedown",Q(N,this.id));I.attachEvent(S,"click",Q(M,this.id));var R=this.lassoSelector;if(!R){R=this.createLassoSelector();this.lassoSelector=R;}var T=R.parentNode;if(T){T.removeChild(R);}},createLassoSelector:function(){var U,V,S,T=this.boxResizers,R=document.createElement("div");R.setAttribute("class","lasso-selector");R.setAttribute("type",P.LASSO_SELECTOR);R.setAttribute("draggable",false);R.draggable=false;for(U=0;U<9;U++){if(U!==4){V=document.createElement("div");V.setAttribute("class","lasso-selector-resizer");V.setAttribute("type",P.LASSO_RESIZER);V.setAttribute("index",String(U));V.setAttribute("draggable",false);V.draggable=false;R.appendChild(V);T[U]=V;I.attachEvent(V,"mousedown",Q(A,this.id));}}K.addClass(T[0],["top","left"]);K.addClass(T[1],["top"]);K.addClass(T[2],["top","right"]);K.addClass(T[3],["left"]);K.addClass(T[5],["right"]);K.addClass(T[6],["bottom","left"]);K.addClass(T[7],["bottom"]);K.addClass(T[8],["bottom","right"]);if(this.useDropDownBtn===true){S=document.createElement("div");S.setAttribute("type",P.BUTTON);S.setAttribute("class","lasso-selector-dropdown-button");R.appendChild(S);I.attachEvent(S,"click",Q(this.lassoButtonClicked,this.id));this.dropDownBtn=S;}return R;},positionBoxResizers:function(){var T=this.boxResizers,S=this.lassoSelector,U=S.clientWidth,R=S.clientHeight,W=(U-J)>>1,V=(R-J)>>1;T[1].style.left=W+"px";T[3].style.top=V+"px";T[5].style.top=V+"px";T[7].style.left=W+"px";},dismissLassoSelector:function(){var R=this.lassoSelector;if(R){K.removeClass(R,[E,L]);if(R.parentNode){R.parentNode.removeChild(R);}}},isLassoSelectorActive:function(){function S(V,U){var W=V.className.split(/\s+/),T;for(T=0;T<W.length;T++){if(W[T]===U){return true;}}return false;}var R=this.lassoSelector;if(R){return S(R,E);}return false;},getLassoSelectionInfo:mstrmojo.emptyFn,lassoSelected:mstrmojo.emptyFn,lassoSelecting:mstrmojo.emptyFn,lassoButtonClicked:mstrmojo.emptyFn,lassoSelectorResized:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var B="___value",E="___parent",A="___key_map",D="___IS_LEAF";mstrmojo.netviz.ObservableModel=mstrmojo.declare(mstrmojo.Obj,[],{scriptClass:"mstrmojo.netviz.ObservableModel",init:function(H){var G=[];H=H||{};H=mstrmojo.hash.clone(H);var L=Object.keys(H),F=L.length,K,J;for(K=0;K<F;K++){var I=L[K],M=H[I];if(!(M instanceof Object)){J=new C();J[B]=M;J[D]=true;H[I]=J;}else{H[I]=J=new C(M);}G.push(J);H[I][E]=this;}if(this._super){this._super(H);}this.addDisposable(G);this[A]=H;},getParent:function(){return this[E];},getChildrenKeys:function(){return Object.keys(this[A]);},isLeafNode:function(){return this[D];},getValue:function(){if(this.isLeafNode()){return this[B];}return this.getRawObject();},setValue:function(G,K){var F=this.getValue();var M,J,I,L,H;if(this.isLeafNode()){if(!(G instanceof Object)){if(F!==G){this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{this[B]=undefined;this[D]=undefined;this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{var N=this.getChildrenKeys();J=N.length;for(I=0;I<J;I++){L=N[I];this[L]=undefined;}if(!(G instanceof Object)){this[D]=true;this[B]=G;this[A]=undefined;this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}else{this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}},stopPropagation:function(F){F._isStopped=true;},raiseEvent:function(G){if(this._super){this._super(G);}if(G._isStopped){return ;}var F=this.getParent();if(F){F.raiseEvent(G);}},getRawObject:function(){var G={},J=this.getChildrenKeys(),F=J.length,I;for(I=0;I<F;I++){var H=J[I],K=this[H];if(K.isLeafNode()){G[H]=K.getValue();}else{G[H]=K.getRawObject();}}return G;}});var C=mstrmojo.netviz.ObservableModel;}());(function(){mstrmojo.requiresClsP("mstrmojo","ListBase","_IsList","css","array");var H=mstrmojo.css;var K=0;var C=15;var B="collapsed";var A="expanded";var D="hidden";mstrmojo.VisMenuHierarchicalList=mstrmojo.declare(mstrmojo.ListBase,[mstrmojo._IsList],{scriptClass:"mstrmojo.VisMenuHierarchicalList",prevSelection:{},itemField:"v",selectionPolicy:"toggle",multiSelect:false,init:function N(P){this._super(P);var Q=this;},onRender:function O(){this.collapseAll();},getItemProps:function I(R,P){var Q=this._super(R,P);Q.tag="a";Q.addCls("mstrmojo-ui-Menu-item");Q.addCls("hierarachy");if(!R.isLeaf){var S=R.collapsed?B:A;Q.addCls(S);}if(!R.initVisible){Q.addCls(D);}Q.indent=R.level*C+K;return Q;},getItemMarkup:function L(Q,P){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="mark" style="position: static;"></span><span class="">{@en@n}</span></{@tag}>';},onselectionChange:function J(P){this._super(P);this.parent.data.set("valid",true);},doItemSelect:function E(R,P){if(R.isLeaf){this._super(R,P);}else{var Q=this._getItemNode(R._renderIdx);R.collapsed=!R.collapsed;if(R.collapsed){H.addClass(Q,B);H.removeClass(Q,A);}else{H.addClass(Q,A);H.removeClass(Q,B);}this.collapseChildren(R,R.collapsed);if(this.parent.adjustCornersForPopupOverflow){this.parent.adjustCornersForPopupOverflow();}if(this.parent.updateScrollbars){this.parent.updateScrollbars();}}},collapseChildren:function G(Q,R){var P=this;(Q.children||[]).forEach(function(S){if(R){P.setVisible(S,false);}else{P.setVisible(S,true);}P.collapseChildren(S,R||S.collapsed);});},setVisible:function M(Q,R){var P=this._getItemNode(Q._renderIdx);H.toggleClass(P,D,!R);},collapseAll:function F(){var Q=this;var P=this.items;if(P){P.forEach(function(S){if(!S.isLeaf){var R=Q._getItemNode(S._renderIdx);S.collapsed=true;H.addClass(R,B);H.removeClass(R,A);Q.collapseChildren(S,S.collapsed);}});}},});}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.Container");mstrmojo.requiresDescs(1442,2140);var C=mstrmojo.dom;mstrmojo.ui.menus.ToolbarEditor=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._IsMenuPopup,mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.menus.ToolbarEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-ToolbarEditor mstrmojo-ui-MenuEditor {@cssClass}" style="..." mstrAttach:mouseover,mouseout,click><div class="te-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},popupConfig:null,children:null,autoCloses:false,locksHover:true,visible:true,onclick:function B(E){C.stopPropogation(null,E.e);},init:function D(F){this._super(F);var E=this.popupConfig,G=E.contents;if(!G){throw new Error("Cannot open editor without editor content.");}this.cssClass=E.cssClass;this.addChildren(G);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.ToolbarEditor","mstrmojo.hash");mstrmojo.ui.menus.ToolbarEditorConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.ToolbarEditorConfig",cssClass:"",contents:null,init:function C(D){this._super(D);this.initBindings();},clear:function A(){this._super();this.contents=null;},newInstance:function B(D){return new mstrmojo.ui.menus.ToolbarEditor(mstrmojo.hash.copy({popupConfig:this},D));}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.vi.ui.rw._HasVisSelections","mstrmojo.VisUtility");var D=mstrmojo.array;var E=mstrmojo.VisUtility;var C=mstrmojo.vi.ui.rw.SelectionType;var G=2;function B(J){var I=-1;var K=this.modelData.gts.row||[],H=K.length,L;for(L=0;L<H;L++){if(K[L].id===J){I=L;}}return I;}mstrmojo.netviz._SupportNetworkBrushesAndHighlights=mstrmojo.provide("mstrmojo.netviz._SupportNetworkBrushesAndHighlights",{_mixinName:"mstrmojo.netviz._SupportNetworkBrushesAndHighlights",prepareSelectedNodesInfo:function(H,I){if(I===true){this.clearCxtMnuSelection();}else{this.clearSelections();}var J=I===true?this.getContextMenuSelectedNodes():this.getSelectedNodes();if(H instanceof Function){J=H.call(this,J);}D.forEach(J,function(L){var K=L.attributeElements;if(I===true){this.addContextMenuAttributeSelection(L.attribute.id,K[0].id,E.pluck(K,"name").join(":"));}else{this.addAttributeSelection(L.attribute.id,K[0].id,E.pluck(K,"name").join(":"));}},this);},highlight:function(Y,f){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill){return ;}var K,J,H,a,U,b=[],X,T,R=[],c=this.stage,W=(c&&c.spriteCollection)||[],M,L,P,N,O=this.model;if(!this.stage){return ;}function Q(m,j){var n,l,i,h,k=[],g;if(m){k.push(m);}if(j){k.push(j);}D.forEach(k,function(o){n=o.sprite;if(n&&b.indexOf(n)===-1){b.push(n);}});g=k.length;if(g===2){i=k[0].edges;h=k[1].edges;D.forEach(i,function(o){T=o&&o.sprite;if(h.indexOf(o)!==-1&&R.indexOf(T)===-1){R.push(T);}});}else{if(g===1){l=k[0].edges;D.forEach(l,function(o){T=o&&o.sprite;if(T&&R.indexOf(T)===-1){R.push(T);}});}}}function V(g){var h=null;D.forEach(W,function(i){if(i.type==="Circle"&&i.text===g){h=i;return false;}});return h;}function S(g){var k=null,h,j,i=[];D.forEach(W,function(l){if(l.type==="Circle"){h=l.unit;j=h?h.attributeElements:[];if(h&&h.hasSelfLoop){i=h.secondaryAttributeElements;}j=j.concat(i);D.forEach(j,function(m){if(O.compareElementsId(m.id,g)){k=l;return false;}});if(k){return false;}}});return k;}function Z(g){D.forEach(g,function(h){if(h){c.addToSelection(h);}});}function e(g){D.forEach(g,function(h){c.addToSelection(h);});}function d(){Z(b);e(R);c.draw();}function I(g){var h="";D.forEach(g||[],function(i){h+=i.n+" ";});h=h.substring(0,h.length-1);return h;}if(Y===C.ATTS){c.clearSelection();for(K in f){if(f.hasOwnProperty(K)){J=f[K];for(H in J){if(J.hasOwnProperty(H)){a=B.call(this,H);if(a<0){continue;}U=J[H];if(U&&U.length>0){X=S.call(this,U[0].id);}if(X&&b.indexOf(X)===-1){b.push(X);}}}}}d();}else{if(Y===C.METRICS){c.clearSelection();for(K in f){if(!f.hasOwnProperty(K)){continue;}J=f[K];M=null;L=null;P=null;N=null;for(H in J){if(!J.hasOwnProperty(H)){continue;}a=B.call(this,H);if(a<0||a>1){continue;}else{if(a===0){U=J[H];if(U&&U.length>0){P=S.call(this,U[0].id);}M=P&&P.unit;}else{if(a===1){U=J[H];if(U&&U.length>0){N=S.call(this,U[0].id);}L=N&&N.unit;}}}}Q(M,L);}d();}else{if(Y===C.EMPTY){c.clearSelection();c.draw();}}}},singleUnitSelect:function A(){var J=this.getSelections().length>0||this.clearSelectionsFlag;if(this.clearSelectionsFlag){delete this.clearSelectionsFlag;}if(J){var I=function(){var L=this.model.scm,N=Object.keys(L||{}),P=(N&&N[0])||"",O=this.model.data.gts.row,M=this.model.data.gts.col;D.forEach(O.concat(M),function(Q){if(N.indexOf(Q.id)!==-1){P=Q.id;return false;}});return P;};var K=function(){var L={};L.tid=I.call(this);L.eid="";L.isClearAll=false;L.anchor=this.domNode;L.at=G;L.selections=this.getSelections();L.selectionType=this.getSelectionType();if(L.selections.length&&L.selections[0][0].tid){L.tid=L.selections[0][0].tid;}return L;};var H=K.call(this);this.performAction([H]);}},clearSelections:function(H){this.clearSelectionsFlag=true;if(this._super){this._super();}if(H&&this.stage){this.stage.dismissLassoSelector();this.stage.clearSelection();this.stage.draw(false);}},clearCxtMnuSelection:function F(){if(this._super){this._super();}}});}());(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash","mstrmojo.Label","mstrmojo.array","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.dom","mstrmojo.models.FormatModel","mstrmojo.VisUtility");var G=mstrmojo.array,K=mstrmojo.hash,D=mstrmojo.dom,J=mstrmojo.VisUtility,L=11,A=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES;function Q(){var U=L,V,T=[],X=Math.round(100/(U-1));for(V=0;V<U;V++){var W=(V*X)/100,S=(V*X)+"%";if(V===U-1){S="100%";W=1;}T.push({n:S,did:W});}return T;}function M(){var S=[{n:mstrmojo.desc(12100,"Circle"),did:"Circle"},{n:mstrmojo.desc(12101,"Square"),did:"Square"},{n:mstrmojo.desc(14433,"Diamond"),did:"Diamond"},{n:mstrmojo.desc(14434,"Hexagon"),did:"Hexagon"},{n:mstrmojo.desc(14435,"Triangle"),did:"Triangle"},{n:mstrmojo.desc(12103,"Ring"),did:"Ring"}];return S;}function F(V){var T=L,U,S=0,W=Math.round(100/(T-1));V=Math.round(V*100);for(U=0;U<T;U++){if(Math.abs(V-U*W)<0.5*W){S=U;break;}}return S;}function I(S){S=S||[];G.forEach(S,function(T){T.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:S};}function B(U,S,T,W){W=W||"60px";var V=new mstrmojo.ui.Pulldown({items:U,width:W});V.set("selectedIndex",S);V.postselectedIndexChange=function(X){var Y=X.value,Z=U[Y]&&U[Y].did;G.forEach(T,function(a){a.setValue(Z);});};return{scriptClass:"mstrmojo.Box",children:[V]};}function O(T,S){return K.copy(S,{scriptClass:"mstrmojo.Label",text:T,cssText:"width: 60px;"});}function H(S,U){var T;G.forEach(S,function(W,V){if(W===U||W.did===U){T=V;return false;}});return T;}function N(U,S,T){T.shapeIndex=H(M(),U.shape.getValue());T.fillColorValue=U.color.value.getValue();T.opacityIndex=F(U.color.opacity.getValue());T.borderColorValue=U.border.color.value.getValue();T.borderStyleValue=U.border.style.getValue();S.push(U);}function R(W,Z,Y){var c=W.circleStyle.fromNode,X=W.circleStyle.toNode,f=c.shape.getValue(),V=X.shape.getValue(),T=c.color.value.getValue(),a=X.color.value.getValue(),d=c.color.opacity.getValue(),U=X.color.opacity.getValue(),g=c.border.color.value.getValue(),S=X.border.color.value.getValue(),b=c.border.style.getValue(),e=X.border.style.getValue();Y.shapeIndex=f===V?H(M(),f):-1;Y.fillColorValue=T===a?T:"conflict";Y.opacityIndex=d===U?F(d):-1;Y.borderColorValue=g===S?g:"conflict";Y.borderStyleValue=b===e?b:"conflict";Z.push(c);Z.push(X);}function E(S){if(!K.equals(S.value,S.valueWas)){G.forEach(this.models,function(T){T.setValue(S.value);});}}var C={background:function(T,S){var V=(S&&S.label)||mstrmojo.desc(3905,"Background"),U=mstrApp.getThemeClassName()||"";return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+U,locksHover:true,children:[I([O(V),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:U,selectedValue:T.value.getValue(),model:T.value,showNoFill:false,width:"60px",postselectedValueChange:function(W){this.model.setValue(W.value);}}]}])]};},bubble:function(T,S){var Y=mstrApp.getThemeClassName()||"",X=T.circleStyle.fromNode,V=T.circleStyle.toNode,U=[],W={shapeIndex:-1,fillColorValue:"conflict",opacityIndex:-1,borderColorValue:"conflict",borderStyleValue:"conflict"};if(S.alignment.attSrc==="from"){N(X,U,W);}else{if(S.alignment.attSrc==="to"){N(V,U,W);}else{R(T,U,W);}}return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+Y,locksHover:true,children:[I([O(mstrmojo.desc(2923,"Shape")),B(M(),W.shapeIndex,U.map(function(Z){return Z.shape;}),"128px")]),I([O(mstrmojo.desc(2885,"Fill")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:Y,showNoFill:false,selectedValue:W.fillColorValue,models:U.map(function(Z){return Z.color.value;}),width:"60px",postselectedValueChange:E}]},B(Q(),W.opacityIndex,U.map(function(Z){return Z.color.opacity;}))]),I([O(mstrmojo.desc(9736,"Border")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:Y,showNoFill:false,showGradient:false,selectedValue:W.borderColorValue,models:U.map(function(Z){return Z.border.color.value;}),width:"60px",postselectedValueChange:E}]},{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",width:"60px",isHostedWithin:true,models:U.map(function(Z){return Z.border.style;}),selectedValue:W.borderStyleValue,postselectedValueChange:E}]}]),I([O(mstrmojo.desc(11993,"Data Labels")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,showNoFillInColor:false,width:"397px",height:"22px,",onGroupValueChange:J.getCharGroupValueChangeCb(T.circleLabelStyle)}]}])]};}};function P(Y,W,X,T){var V=C[Y];if(V){var S=V(W,T),Z=D.position(this.containerNode,true),b=X.pageX-Z.x,a=X.pageY-Z.y;var U=this._contextMenuAnchor;if(!U||!U.parentElement){U=document.createElement("div");U.style.position="absolute";this._contextMenuAnchor=U;this.containerNode.appendChild(U);}U.style.left=b+1+"px";U.style.top=a+1+"px";var c={hostId:this.id,hostElement:U,isHostedWithin:false};if(T&&T.alignment){c.alignment=T.alignment;}S.popupConfig=new mstrmojo.ui.PopupConfig(c);S.visible=true;S.onClose=function(){this.unrender();};return S;}}mstrmojo.netviz._HasNetworkContextMenu=mstrmojo.provide("mstrmojo.netviz._HasNetworkContextMenu",{getWidget:function(){return this.owner;},showContextMenu:function(W,V,X,S){var U=P.call(this,W,V,X,S);if(S&&J.getPropertyByPath(S,"alignment.attSrc",false)!==false){if(S.alignment.attSrc==="from"){this.parent.textSelectedIndex=1;}else{if(S.alignment.attSrc==="from and to"){this.parent.textSelectedIndex=0;}else{this.parent.textSelectedIndex=2;}}}if(W==="bubble"){U=mstrmojo.registry.ref(U);var T=J.getPropertyByPath(U,"children.3.children.1.children.0");if(T!==undefined){T.setFormatSource(this.getDataLabelFormats());T.fontColor.isHostedWithin=true;T.fontSize.isHostedWithin=true;T.fontFamily.isHostedWithin=true;}}this.openPopup(U);},unrender:function(S){this._contextMenuAnchor=undefined;this._super(S);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.string","mstrmojo.gm._IsAnchorable","mstrmojo.ui._HasUITheme","mstrmojo.VisUtility");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.VisUtility;mstrmojo.gm.DndTooltip=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.gm._IsAnchorable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.gm.DndTooltip",left:0,top:0,zIndex:10,boundaryNodeName:"boundary",popupNodeName:"infoNode",baseTipClass:"arrow",infoNodeOffset:0,popupNodeOffset:5,anchor:null,boundary:null,utils:mstrmojo.VisChartUtils,themeClassName:"mojo-theme-light",markupString:'<div id="{@id}" class="mstrmojo-Tooltip {@cssClass}" style="top:{@top}px;left:{@left}px;z-index:{@zIndex};position:absolute;{@cssText};"><div class="mstrmojo-Tooltip-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Tooltip-content {@contentNodeCssClass}" style="{@contentNodeCssText}"><div class="content"></div><div class="arrow"><div class="after"></div><div class="before"></div></div></div></div>',markupSlots:{infoNode:function(){return this.domNode.childNodes[1];},contentNode:function(){return this.domNode.childNodes[1].firstChild;},tipNode:function(){return this.domNode.childNodes[1].lastChild;}},toggle:function A(H){if(H){this.domNode.style.display="block";}else{this.domNode.style.display="none";}},updateContent:function(H,J,I){this.set("themeClassName",mstrApp.getThemeClassName());this.fillContent(H,J,I);this.positionDialog();},fillContent:function C(J,N,L){this.anchor=J;this.anchorPosition=N;this.contentNode.innerText=L||this.anchor.innerText||this.anchor.textContent,true;this.toggle(true);var H=F.getComputedFontStyle(this.contentNode),M=this.contentNode.innerText,I=F.measureTextWidth(M,H),K=130;if(I<=K){this.contentNode.style.width=I+"px";}else{this.contentNode.innerText=F.truncateTextToLineWithWordWrap(M,H,K,3);this.contentNode.style.width=K+"px";}},getTipDimension:function B(){var I=this[this.tipNodeName],H=E.position(I.firstChild);return H;},applyPopupNodePos:function G(J,I,L,H){var N=this[this.tipNodeName],K=N.style,O=this[this.popupNodeName],M=O.style;M.top=J+"px";M.left=I+"px";K.top=(L-J)+"px";K.left=(H-I)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var N=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,M=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(O){return O.model.controller.cmdMgr;}function L(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function O(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(P,R){var O,U,Q,S,T={};T.tks=this.k;T.selectorObjects=P;T.keepOnly=!!R;T.isDocVis=true;O=L.call(this);U=O.getDataService();Q=U.getGMViewFilterAction(T);S=O.getSliceCallback(T);return{action:Q,callbacks:S};}function B(Q,P){var O,S,R;O=L.call(this);R=O.getDataService();if(!this.isXMLDirty()){R.submitUpdates(Q,P);}else{S=this.getPersistAction();R.submitUpdates([Q,S],P);this.resetXMLDirtyFlag();}}function A(){var b=this.modelData||this.model.data,S=b.k,Z,Y="FormattingWidget",U,T,X,P,Q,R=[],W=[],V=this.edtModel;if(!b){console.log("warning: modelData is missing");return null;}var a=function(d,f){var c=T.createElement(f),e;if(d instanceof Object){for(e in d){if(d.hasOwnProperty(e)){var g=a(d[e],e);if(g){c.appendChild(g);}}}}else{c.setAttribute("value",d);}return c;};var O=function(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");};X=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!X||X.length===0){U=this.getProperties(S);if(this.useCompatibleXML){T=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");T.firstChild.appendChild(a(U,"fmt"));}else{T=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");T.firstChild.firstChild.appendChild(a(U,"fmt"));}X=(new XMLSerializer()).serializeToString(T);}P=O(X);Q={act:"setProperty",nodeKey:S,prs:Y,pri:4,v:P};R.push(Q);return R;}function F(P,Q,O,T){if(!(T instanceof Function)){return D;}var S=this.id;function R(U){return function(){var W=mstrmojo.all[S],V;if(!W){return ;}V=W.getProperties();V[P]=U;T.call(W,U,true);W.getDocModel().selectVIUnit(W.parent.id,true);};}return{silent:true,undo:R(O),redo:R(Q)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(R){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var Q=this,P,O=(Q.getDocModel&&Q.getDocModel())||Q.model.docModel;if(O){return O.attachEventListener("colorMapChanged",Q.id,function(T){P=Q.parent&&Q.parent.parent;if(Q.forceUpdateColorMap||(P&&P.isPanelDisplaying())){R.call(Q);}else{var S=P.attachEventListener("panelDisplaying",Q.id,function(U){if(Q.postBuilderingCalled){R.call(Q);}P.detachEventListener(S);});}});}},detachUpdateColorMapListener:function(P){if(!P){return ;}var O=(this.getDocModel&&this.getDocModel())||this.model.docModel;O.detachEventListener(P);},updateTargets:function(P){var S={},Q=this,O=L.call(this);S.fromGM=true;S.type=1;S.src=this.k;S.selectorObjects=P;function R(V){var T=Q.modelData||Q.model.data,U=T.sc;if(U!==undefined){return U[V];}return undefined;}S.keepOnly=true;S.ck=R.call(this,"ck");S.keyContext=S.ck;S.tks=R.call(this,"tks");S.ckey=R.call(this,"ckey");S.isDocVis=true;S.include=true;S.showall=R.call(this,"showall");O.slice(S);},updateAfterViewFilter:function(Q,O){var V,U,P,T,S,W,R;V=L.call(this);U=V.getDataService();T=E.call(this,Q,O);P=T.action;S=T.callbacks;R=this.model.controller||V.controller;if(this.currKeepOnlyAction){W=[C.clone(this.currKeepOnlyAction)];}else{W=E.call(this,[],false).action;}this.currKeepOnlyAction=P;R.submitUndoRedoUpdates([P],W,S);},updateAfterKeepOnly:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnly(this,R,{keepOnly:Q,data:this.getContextMenuSelections()},Q?-2:undefined);},updateAfterKeepOnlyForMultiTemplate:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnlyForMutilTemplate(Q,R,true);},updateAfterDrill:function(O,c,Y){var Z=this,d=L.call(this),b=d.getDataService(),T=b.newUpdate(),R=this.getContextMenuSelections(),P=Y||this,S=P.model,U=P.model.data||P.node.data,X=S.getSelectorDataFromTemplateLimit(U.tpl).concat({keepOnly:true,data:R}),Q=d.getKeepOnlyOrExcludeAction(U.k,X),V=Z.model.controller||d.controller,W=V._getXtabCallback(Z);T.add(O,M(c,W));T.add(Q,H.call(Z));K(Z).execute({execute:function a(){this.submitUpdate(T);},urInfo:{callback:T.callback}});},updateAfterSort:function(R){var P=this,O=L.call(this),S=O.getDataService(),T=O.getSliceCallback({tks:P.k});K(P).execute({execute:function Q(){var V=S.newUpdate(this,undefined),U={act:"sortGM",nodeKey:P.k,subActions:R,partialUpdate:{nodes:[P.k]}};V.add(U,T,undefined);if(P.isXMLDirty()){V.addActions(P.getPersistAction());}this.submitUpdate(V,undefined);},urInfo:{callback:T}});},updateAfterAction:function(T,O,P,a,X){if(!T){return ;}var V=this,Q=V.parent&&V.parent.id,b=V.model.docModel,U=V.model.controller||b.controller,Z,Y,S={},W,R=X||D;if(P){Z=mstrmojo.emptyFn;W=function(){this.submitSilent(T);};}else{Z=b.getSliceCallback({tks:this.k});Z.success=G([Z.success,function(){b.selectVIUnit(Q,true);}]);W=function(){this.submit(T,Z,S);};}Y=U._getXtabCallback(V);if(O){Z=M(Z,O);Y=M(Y,O);}Y.success=G([Y.success,function(){b.selectVIUnit(Q,true);}]);if(P){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,S);}if(a){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,S);}K(this).execute({execute:W,urInfo:{silent:R.silent,callback:Y,redo:R.redo,undo:R.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(P,Q,O,R){this.updateAfterAction(A.call(this),P,Q,O,R);},setProperty:function(V,R,T){var P=T.callback,Q=!!T.suppressData,X=T.requestDefinition,S=T.clientUndoRedoCallback,W=this.getProperties(),O=W[V],U;if(V===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,R);}}else{if(W&&(W[V]===undefined||W[V].toString()!==R.toString())){W[V]=R;U=F.call(this,V,R,O,S);this.updateAfterPropertiesChange(P,Q,X,U);}}},showData:function(O){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.VisEnum","mstrmojo.VisUtility");var S=mstrmojo,N=S.array,M=S.VisEnum,L=S.VisUtility,J=M.NETWORK_LAYOUT.FORCE_DIRECTED,E=M.NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE,A=Math.ceil,U=Math.sqrt,O=Math.abs,I=0.1,T=U(I/2),C=L.isNearZero,D=(window.env||{}).isDebugging;function G(V){if(D){L.visPrint(V);}}mstrmojo.netviz._ForceDirectedLayout=mstrmojo.provide("mstrmojo.netviz._ForceDirectedLayout",{_mixinName:"mstrmojo.netviz._ForceDirectedLayout",init:function(V){if(this._super){this._super(V);}if(this.layouts===undefined){this.layouts={};}this.layouts[J]=R;}});function R(e,g){function Z(){var h=0,i;F(f);H(e.edges);g.setScene();g.draw();i=setInterval(function(){if(l>0){Q(f,a,l,Y,V);l-=W;F(f);H(e.edges);g.setScene();g.draw(false,true);G("iteration: "+h++);}else{clearInterval(i);}},17);}var f=[],a=[],j=100,d=100;g.currentLayout=J;B(e,f,a,j,d);var X=200,c=f.length,Y=U(j*d/c),V=Y*Y,l=j/(2*U(c)),W=l/X,b;if(D){Z();}else{for(b=0;b<X;b++){Q(f,a,l,Y,V);l-=W;}F(f,e.nodesIdHash);H(e.edges);}}function B(X,a,W,V,Y){function Z(g){var k=g.length,d=A(U(k)),b=V/d,m=Y/d,f,e;for(f=0;f<d;f++){for(e=0;e<d;e++){var h=f*d+e;if(h<k){var l=g[h];l.px=f*b-V/2;l.py=e*m-Y/2;}}}}N.forEach(X.nodes,function(c){if(!c.isExcluded){var b=c.getSize();var d={m:b*b,px:0,py:0,ax:0,ay:0,nodeId:c.id};c._shadowSprite=d;a.push(d);}});N.forEach(X.edges,function(b){if(!b.isExcluded){W.push({from:b.from._shadowSprite,to:b.to._shadowSprite});}});Z(a);}function K(c,e,X){var b=e.px-c.px,a=e.py-c.py,Z,Y,W,V;if(!C(b)&&!C(a)){Z=U(b*b+a*a);Y=Z*Z/X;W=b/Z*Y;V=a/Z*Y;c.ax+=W;c.ay+=V;e.ax-=W;e.ay-=V;}}function P(c,d,V){var b=d.px-c.px,Z=d.py-c.py,Y=b*b+Z*Z,a,X,W;if(Y<I){Y=I;b=(b>=0?1:-1)*T;Z=(Z>=0?1:-1)*T;}a=V/Y;X=-b*a;W=-Z*a;c.ax+=X;c.ay+=W;d.ax-=X;d.ay-=W;}function Q(a,Y,e,W,V){N.forEach(a,function(g){g.ax=0;g.ay=0;});var Z,b=a.length,X,f;for(Z=0;Z<b;Z++){f=a[Z];for(X=Z+1;X<b;X++){P(f,a[X],V);}}N.forEach(Y,function(c){K(c.from,c.to,W);});for(Z=0;Z<b;Z++){var d=a[Z];d.ax+=-d.px;d.ay+=-d.py;}N.forEach(a,function(g){if(O(g.ax)>e){g.ax=(g.ax>=0?1:-1)*e;}if(O(g.ay)>e){g.ay=(g.ay>=0?1:-1)*e;}g.px=g.px+g.ax;g.py=g.py+g.ay;});}function F(X,V){var W;N.forEach(X,function(Y){W=V[Y.nodeId];W.sprite.setGeometry({x:Y.px,y:Y.py});delete W._shadowSprite;});}function H(V){N.forEach(V,function(Y){Y=Y.sprite;var b=Y.from,a=Y.to,X=b.getGeometry(),W=a.getGeometry(),Z=E[(Y.unit.reversedEdge?1:0)];Y.setGeometry({x:(X.x+W.x)/2+(X.y-W.y)*Z,y:(X.y+W.y)/2+(W.x-X.x)*Z,type:"bezier"});});}}());(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisUtility");var A=mstrmojo.VisEnum.NETWORK_LOCAL_PROPS,B=mstrmojo.VisEnum.NETWORK_DRAG_MODE;var C=mstrmojo.css,E=mstrmojo.dom,D=mstrmojo.VisUtility;mstrmojo.netviz.VisNetworkStageScaleBar=mstrmojo.declare(mstrmojo.Container,[],{scriptClass:"mstrmojo.netviz.VisNetworkStageScaleBar",markupString:'<div class="VisNetworkStageScaleBar" id="{@id}-networkStageScaleBar" style="position: absolute; top:{@top}px; left:{@left}px; height: {@height}px; width: {@width}px; z-index: 2;" mstrAttach:mousedown,click><div class="_label"></div><div style="position: relative"><div class="_zoomTool"><div class="_FTWTrigger"></div><div class="_zoomInButton"></div><div class="_scaleBar"><div class="_bar"></div><div class="_slider"></div></div><div class="_zoomOutButton"></div></div><div class="pan-select-tool"><input class="_inputPan" type="radio" id="{@id}-panButton" name="{@id}-sptype"><label for="{@id}-panButton" class="_panButton"></label><input class="_inputSelect" type="radio" id="{@id}-selectButton" name="{@id}-sptype"><label for="{@id}-selectButton" class="_selectButton"></label></div></div></div>',markupSlots:{label:function(){return this.domNode.childNodes[0];},fitToWindowTrigger:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[0];},zoomInButton:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[1];},zoomTool:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[2].childNodes[0];},slider:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[2].childNodes[1];},zoomOutButton:function(){return this.domNode.childNodes[1].childNodes[0].childNodes[3];},SPTrigger:function(){return this.domNode.childNodes[1].childNodes[1];},inputPan:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[0];},panButton:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[1];},inputSelect:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[2];},selectButton:function(){return this.domNode.childNodes[1].childNodes[1].childNodes[3];}},init:function(F){if(this._super){this._super(F);}if(!this.placeholder){D.visPrint("A placeholder is needed for set the position for the ScaleBar. Init failed.");return ;}this.left=this.placeholder.offsetLeft;this.top=this.placeholder.offsetTop;},postBuildRendering:function(){if(this._super){this._super();}var I=["mousedown","mouseup","mousemove","click","mousewheel"],H,F=I.length;for(H=0;H<F;H++){var J=I[H],G="on"+J;if(this[G]){this.attachEventListener(J,this.id,this[G]);}}this.setScaleFactor(this.scaleFactor);this.initSPType();},initSPType:function(){var G=this.dragMode,F=this.owner;F.dragMode=G;if(G===B.pan){this.inputPan.checked=true;this.owner.lassoSelectorEnabled=false;}else{if(G===B.select){this.inputSelect.checked=true;this.owner.lassoSelectorEnabled=true;}}},onclick:function(H){H=H.e||H;H.stopPropagation();var G=H.target;var F;if(G===this.fitToWindowTrigger){this.resetScene.call(this.owner);this.setScaleFactor(1);var I=this;this._deActiveTimer=window.setTimeout(function(){I.setScaleFactorDone();},1000);}else{if(G===this.zoomInButton){this.setScaleFactor(this.scaleFactor+0.1,false,true);}else{if(G===this.zoomOutButton){this.setScaleFactor(this.scaleFactor-0.1,false,true);}else{if(G===this.panButton){F=B.pan;}else{if(G===this.selectButton){F=B.select;}}}}}if(F!==undefined){this.setSPType(F);}},setSPType:function(F){if(this.hasInterface("setDragType")){this.setDragType.call(this.owner,F);}},onmousedown:function(G){G=G.e||G;this.owner.dismissLassoSelector();G.stopPropagation();var F=G.target;if(F===this.slider){E.attachMouseMoveEvents(this.onmousemove.bind(this),this.onmouseup.bind(this));this._oldPageY=G.pageY;}},onmousemove:function(J){J=J.e||J;J.stopPropagation();var F=J.pageY-this._oldPageY;this._oldPageY=J.pageY;var K=this.slider.offsetTop+this.slider.offsetHeight/2+F-this.zoomTool.offsetTop,G=this.zoomTool.offsetHeight,I;if(this.hasInterface("range")){var H=this.range;I=(G-K)/G*(H.max-H.min)+H.min;}this.setScaleFactor(I);},onmouseup:function(F){F=F.e||F;F.stopPropagation();this.setScaleFactorDone();},setScaleFactor:function(P,K,F){if(isNaN(P)){D.visPrint("Invalid scale factor");return ;}if(this.hasInterface("owner")&&this.hasInterface("scale")&&this.hasInterface("range")){var Q,I;var O;var J=this.range;var G=1;if(P<J.min){O=J.min;}else{if(P>J.max){O=J.max;}else{O=P;}}if(O>this.scaleFactor){Q=true;}if(O<this.scaleFactor){I=true;}G=O/this.scaleFactor;this.scaleFactor=O;this.slider.style.top=(J.max-this.scaleFactor)/(J.max-J.min)*this.zoomTool.offsetHeight+this.zoomTool.offsetTop-this.slider.offsetHeight/2+"px";var H,L;if(Q){H=this.zoomInButton;L="_zoomInButtonActive";}if(I){H=this.zoomOutButton;L="_zoomOutButtonActive";}if(H){this.setScaleFactorDone();this._zoomButtonDomNode=H;this._zoomButtonActiveClassName=L;if(!F){C.addClass(H,L);}}var N=this.label;N.innerHTML=Math.floor(this.scaleFactor*100)+"%";this.owner.setLocalProp(A.ZOOM_FACTOR,this.scaleFactor);if(this.fadeLabelTimer){window.clearInterval(this.fadeLabelTimer);N.style.opacity=1;}var M=this;this.fadeLabelTimer=window.setInterval(function(){var R=N.style.opacity,S=0.01;if(R>S){R-=S;}else{R=0;if(M.fadeLabelTimer){window.clearInterval(M.fadeLabelTimer);}}N.style.opacity=R;},10);if(!K){this.scale.call(this.owner,G);}}},setScaleFactorDone:function(){if(this._zoomButtonActiveClassName&&this._zoomButtonDomNode){C.removeClass(this._zoomButtonDomNode,this._zoomButtonActiveClassName);delete this._zoomButtonActiveClassName;delete this._zoomButtonDomNode;}if(this._deActiveTimer){window.clearTimeout(this._deActiveTimer);}},hasInterface:function(F){if(this[F]){return true;}D.visPrint("warning: no interface found: "+F);return false;},scaleFactor:1,savedScaleFactor:1,range:null,scale:null,owner:null,dragMode:B.pan});})();(function(){var AC=false,D=function(Az){if(AC){AP.visPrint(Az);}};mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.Base","mstrmojo.dom","mstrmojo.Container","mstrmojo.hash","mstrmojo.array","mstrmojo.netviz.VisNetworkStageScaleBar","mstrmojo.css","mstrmojo.netviz.ObservableModel","mstrmojo._HasPopup","mstrmojo.netviz._HasNetworkContextMenu","mstrmojo.VisEnum","mstrmojo.VisTooltip","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.chart.enums.EnumLineStyle","mstrmojo.ui.PopupConfig","mstrmojo.VisUtility","mstrmojo.PerformanceLogOutput","mstrmojo.util.ui._LassoSelector","mstrmojo.netviz.Bitmap","mstrmojo.util.color","mstrmojo.ui.menus.MenuConfig");var Ac=mstrmojo.dom,AU=Ac.position,Af=mstrmojo.VisEnum.NETWORK_DRAG_MODE,AV=mstrmojo.netviz.ObservableModel,Ap=mstrmojo.css,N=mstrmojo.hash,J=mstrmojo.array,Q=mstrmojo.VisEnum,AP=mstrmojo.VisUtility,s=mstrmojo.PerformanceLogOutput,j=mstrmojo.util.color,F=mstrmojo.color;var Ao=Q.NETWORK_LOCAL_PROPS,a=Q.FormNameDisplayType,m=Q.NETWORK_FORCE_DIRECTED_LAYOUT_EDGE_CURVATURE,Ad=mstrmojo.chart.enums.EnumFontStyle,h=Q.NETWORK_LAYOUT;var O=["Select","Swipe","Multi","Tap",""],AJ=["Begin","End","Move","Cancel",""];var As=["click","dblclick","drage","dragend","dragenter","dragleave","dragover","dragstart","drop","mousedown","mousemove","mouseup","mouseout","mouseover","mousewheel","scroll","contextmenu"];var t=["mousemove","mouseup"];var Al=[];J.forEach(O,function(Az){J.forEach(AJ,function(A0){Al.push("touch"+Az+A0);});});var Ah=5*1000;var i=6;var Z=40*Math.PI/180;var c=3,n=30*Math.PI/180,M=Math.pow(c,2)+1-2*Math.cos(n)*c,AL=Math.cos(n)*c,AZ=Math.sin(n)*c;var AQ=500;var AN=26,Ay=5,Ak=25,W=350,AR={EDGE:0,CIRCLE:1,HIGHLIGHT:2},Ai={BASE:0,HIGHLIGHT:1};var AI={fontFamily:"Helvetica",fontSize:AP.psPt2CssPt("12pt",Math.round),fontStyle:Ad.FS_BOLD},AB=4,R=3,An=5;(function(){var A2=["ms","moz","webkit","o"],A1=0,A0,Az=A2.length;for(A0=0;A0<Az&&!window.requestAnimationFrame;A0+=1){window.requestAnimationFrame=window[A2[A0]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[A2[A0]+"CancelAnimationFrame"]||window[A2[A0]+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(A6){var A5=new Date().getTime(),A3=16-(A5-A1),A4;if(A3<0){A1=A5;A4=0;}else{A4=A3;}return setTimeout(function(){A6(A1);},A4);};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=clearTimeout;}}());function Aa(A2,A3){if(typeof A2!=="object"){return ;}var A1=Object.keys(A2),A0,Az;for(A0=0,Az=A1.length;A0<Az;A0++){A3(A1[A0]);}}function Aq(Az){var A0=[];if(Az&Ad.FS_BOLD){A0.push("bold");}if(Az&Ad.FS_ITALIC){A0.push("italic");}return A0.join(" ");}function V(Az){return[Aq(Az.fontStyle),Az.fontSize,"'"+Az.fontFamily+"'"].join(" ");}function T(Az){Ac.stopPropogation(window,Az);Ac.preventDefault(window,Az);}function w(Az){var A0=[];if(Az&Ad.FS_UNDERLINE){A0.push("underline");}if(Az&Ad.FS_STRIKETHROUGH){A0.push("line-through");}return A0.join(" ");}var H=(function(){var Az={},A0=new RegExp("(\\d+)(p[xt])","i");return function A1(A3){var A2,A5,A4;if(Az.hasOwnProperty(A3)){return Az[A3];}A2=A0.exec(A3);if(!A2){return ;}A5=parseInt(A2[1],10);A4=A2[2].toLowerCase();if(A4==="pt"){A5*=96/72;}A5=Math.ceil(A5);Az[A3]=A5;return A5;};}());function AS(A0,A5){if(A5 instanceof Object){var A3=Object.keys(A5),Az=A3.length,A2,A1,A4;for(A2=0;A2<Az;A2++){A1=A3[A2];A4=A5[A1];if(!(A4 instanceof Object)){A0[A1]=A4;}else{if(!A0[A1]){A0[A1]={};}AS(A0[A1],A4);}}}return A0;}function A(A0){var Az=arguments.length,A1,A2;A0=N.clone(A0||{});for(A1=1;A1<Az;A1++){A2=arguments[A1];if(A2 instanceof Object){AS(A0,A2);}}return A0;}function Au(A0){var Az;if(A0.which===undefined||A0.which===null){Az=(A0.button<2)?0:((A0.button===4)?1:2);}else{Az=(A0.which<2)?0:((A0.which===2)?1:2);}return Az;}function B(Az){var A0=Az._delayHideTimerId;if(A0){clearTimeout(A0);delete Az._delayHideTimerId;}}function G(Az){B(Az);Az._delayHideTimerId=setTimeout(function(){Az.toggle(false);delete this._isTooltipShown;},Ah);}function L(A0){var A2=[],Az,A1;A0=A0||[];for(A1=0,Az=A0.length;A1!==Az;A1++){A2.push(A1);}return A2;}function v(A8,A9,A5){var Az=mstrmojo.ui.PopupConfig.ENUM_CORNERS,BB={pageX:A8.pageX,pageY:A8.pageY-6},A2=this,A0=A2.owner;A0.closePopup();var A4="",A3=false,A7=false;J.forEach(A9,function(BC){if(BC.attSrc==="from"){A3=true;}else{if(BC.attSrc==="to"){A7=true;}}});A4=A3?(A7?"from and to":"from"):"to";A2.showContextMenu("bubble",A2.observableModel,BB,{alignment:{host:Az.TOP_LEFT,popup:Az.BOTTOM_LEFT,attSrc:A4}});var BA=A2._lastOpened;A0.showMenu(A2.owner.getFormatMenuConfig(),A8,A5);var A1=A0._lastOpened,A6=A1._unlockHoverCheck;A1._unlockHoverCheck=function(BD,BC){if(!Ac.contains(BA.domNode,Ac.eventTarget(BC,BD),true)){A1._unlockHoverCheck=A6;A1._unlockHoverCheck(BD,BC);}};}function U(A0){var A1=this,Az=A1.contextMenuSelection;v.call(A1,A0,Az,true);}function S(A0){var A1=this,Az=A1.selectedSprites;v.call(A1,A0,Az,false);}function f(A0,A6,A5,A4){var A2,A1,Az,A3;if(isNaN(A0)||A0<0||A0>1){return{x:NaN,y:NaN};}A2=1-A0;Az=A2*A2;A1=A0*A0;A3=2*A2*A0;return{x:Az*A6.x+A3*A5.x+A1*A4.x,y:Az*A6.y+A3*A5.y+A1*A4.y};}var Ar=mstrmojo.chart.enums.EnumLineStyle;function x(Az){var A2=1,A1=Ar.LS_SOLID;if(Az){if(Az==="none"){A1=Ar.LS_NONE;}else{var A0=parseInt(Az,10);if(!isNaN(A0)){A2=A0;}if(/dotted/.test(Az)){A1=Ar.LS_DOT;}else{if(/dashed/.test(Az)){A1=Ar.LS_DASH;}else{if(/solid/.test(Az)){A1=Ar.LS_SOLID;}}}}}return{ceLnStyle:A1,thk:A2};}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.Sprite",init:function(A3){this.zIndex=0;this.selectionState={};this.geometry={x:0,y:0,s:0};this.record();if(this._super){this._super(A3);}var Az=this.stage,A1=this,A0=As;var A2=function(A6){var A4=A6.layerX,A7=A6.layerY,A5=A6.name;if(!Az.transitionTimer&&!Az.eventHasBeenHandled&&this["on"+A5]&&(t.indexOf(A5)!==-1||A1.isHit(A4,A7))&&!this.isExcluded){A1["on"+A5](A6);}};J.forEach(A0,function(A4){Az.attachEventListenerForSprites(A4,A1,A2);});},updateZIndex:function(){var A4=this.stage&&this.stage.layers&&this.stage.layers[this.layerIndex];if(!(A4 instanceof Array&&A4.length>0)){return ;}var Az=A4.length,A3=this.type,A1,A0,A2;for(A1=0;A1<Az;A1++){A2=A4[A1];if(A2.type===A3){if(A2!==this){A0=A4.indexOf(this);this.zIndex=A2.zIndex+1;A2.zIndex=A4[A1-1]?A4[A1-1]-1:0;A4[A0]=A2;A4[A1]=this;this.stylesChanged();}break;}}},stopPropagation:function(){this.stage.eventHasBeenHandled=true;},draw:function(){this.record();},record:function(){var Az=this.getGeometry();this.oldGeometry=N.clone(Az);},drawStage:function(Az,A0){this.stage.draw(Az,A0);},stylesChanged:function(){this.hasStyleChanged=true;var Az=this.stage;if(Az){if(Az.onSpriteStyleChange&&Az.hasRendered){Az.onSpriteStyleChange(this.layerIndex);}}},highlight:function(){this.stage.addSpriteToLayer(this,AR.HIGHLIGHT);},unHighlight:function(){var Az=this.selectionState;if(!Az.selected&&!Az.hovered){this.stage.removeSpriteFromLayer(this,AR.HIGHLIGHT);var A0=this.type==="Circle"?AR.CIRCLE:AR.EDGE;this.stage.addSpriteToLayer(this,A0);}},showTooltip:function(Az){var A0=this.stage.tooltip;if(!this._isTooltipShown){this._isTooltipShown=true;A0.displayInfo(this.getTooltipInfo(),Az);}else{A0.moveTo(Az.x,Az.y);}A0.toggle(true);G(A0);},hideTooltip:function(){var Az=this.stage.tooltip;B(Az);Az.toggle(false);delete this._isTooltipShown;}});var y=0,Ae=16777215;var X={normal:{color:{value:2212863,opacity:0.8},border:{color:{value:8487297,opacity:0.8},width:2,style:"1pt solid"}},hovered:{color:{opacity:0.5},highlightBorder:{color:{value:Ae,opacity:1},width:2,distance:3}},selectedStyleA:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{value:y,opacity:1},width:2},outer:{color:{value:Ae,opacity:1},width:2}}},selectedStyleB:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{value:y,opacity:1},width:2},outer:{color:{opacity:1},width:2}}},selectedStyleC:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{opacity:1},width:2},outer:{color:{value:Ae,opacity:1},width:2}}}};var At={normal:{color:{value:2062260,opacity:0.7},border:{color:{value:2062260,opacity:1},width:2,style:"1pt solid"}},hovered:{color:{opacity:0.35},fromNode:{color:{opacity:0.35}},toNode:{color:{opacity:0.35}},highlightBorder:{color:{value:y,opacity:1},width:2,distance:3}},selectedHovered:{color:{opacity:0.7},fromNode:{color:{opacity:0.7}},toNode:{color:{opacity:0.7}}},selectedStyleA:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{value:Ae,opacity:1},width:2},outer:{color:{value:y,opacity:1},width:2}}},selectedStyleB:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{value:Ae,opacity:1},width:2},outer:{color:{opacity:1},width:2}}},selectedStyleC:{color:{opacity:1},fromNode:{color:{opacity:1}},toNode:{color:{opacity:1}},selectionBorders:{inner:{color:{opacity:1},width:2},outer:{color:{value:y,opacity:1},width:2}}}};function Aj(A0,Az,A4,A2,A3,A1){A0.arc(Az,A4,A2,A3,A1);}function C(A0,Az,A2,A1){A0.rect(Az-Math.sqrt(2)*A1/2,A2-Math.sqrt(2)*A1/2,Math.sqrt(2)*A1,Math.sqrt(2)*A1);}function AO(A0,Az,A2,A1){A0.moveTo(Az,A2-A1);A0.lineTo(Az+A1,A2);A0.lineTo(Az,A2+A1);A0.lineTo(Az-A1,A2);A0.lineTo(Az,A2-A1);}function Ag(A0,Az,A2,A1){A0.moveTo(Az,A2-A1);A0.lineTo(Az+A1*Math.sqrt(3)/2,A2-A1/2);A0.lineTo(Az+A1*Math.sqrt(3)/2,A2+A1/2);A0.lineTo(Az,A2+A1);A0.lineTo(Az-A1*Math.sqrt(3)/2,A2+A1/2);A0.lineTo(Az-A1*Math.sqrt(3)/2,A2-A1/2);A0.lineTo(Az,A2-A1);}function p(A0,Az,A2,A1){A0.moveTo(Az,A2-A1);A0.lineTo(Az+A1*Math.sqrt(3)/2,A2+A1/2);A0.lineTo(Az-A1*Math.sqrt(3)/2,A2+A1/2);A0.lineTo(Az,A2-A1);}var e={Circle:Aj,Square:C,Diamond:AO,Hexagon:Ag,Triangle:p,Ring:Aj};function AA(BC,A6,A4,A8,BF,BO){if(!BC||!A8){return A8;}BF=BF||{color:{value:0,opacity:1},width:1};var BM=Ar.LS_SOLID,A0=BF.distance||0;if(BF.style){var A2=x(BF.style);BM=A2.ceLnStyle;BF.width=A2.thk+1;}A8+=A0;var A7=BF.width,BA=BF.color,BL=j.getCSSColorString(BA.value,BA.opacity);if(BM===Ar.LS_NONE){return A8;}BC.save();var BN=A8+A7*0.5,BK=Math.PI*2;BC.strokeStyle=BL;BC.lineWidth=A7;BC.beginPath();if(BM===Ar.LS_SOLID){e[BO](BC,A6,A4,BN,0,BK,true);}else{var A5=BM===Ar.LS_DASH?0.5:0.2;var BB=BN/A5,A1=Math.PI*2/BB,BE=[],BD=-1,A3,A9,BI=(Math.cos(A1)*BN)+A6,Az=(Math.sin(A1)*BN)+A4,BJ=(Math.cos(2*A1)*BN)+A6,BH=(Math.sin(2*A1)*BN)+A4,BG=Math.sqrt(Math.pow(BI-BJ,2)+Math.pow(Az-BH,2));if(BO==="Ring"||BO==="Circle"){while(BD<BB){A3=A1*BD;A9=A1*(BD+1);BE.push({x:(Math.cos(A3)*BN)+A6,y:(Math.sin(A3)*BN)+A4,ex:(Math.cos(A9)*BN)+A6,ey:(Math.sin(A9)*BN)+A4});BD+=2;}J.forEach(BE,function(BP){BC.moveTo(BP.x,BP.y);BC.lineTo(BP.ex,BP.ey);});}else{BC.setLineDash([BG,BG]);BC.lineWidth=2;e[BO](BC,A6,A4,A8);}}BC.stroke();BC.closePath();BC.restore();return A8+A7;}function AY(A8,A1,A4,A5,A2){var A7=A4.x,A6=A4.y,Az=0,A0=0,A3=A1.value;if(j.isGradientColor(A3)){Az=A3.or;A0=1-Az;}A8.save();A8.fillStyle=j.createCanvasFillPattern(A1,A8,A7-A5*Az,A6-A5*A0,A7+A5*Az,A6+A5*A0);A8.beginPath();if(A2==="Ring"){A8.lineWidth=A5*0.3;A8.strokeStyle=A8.fillStyle;Aj(A8,A4.x,A4.y,A5*0.85,0,2*Math.PI,true);A8.stroke();}else{e[A2](A8,A4.x,A4.y,A5,0,2*Math.PI,true);}A8.closePath();if(A2!=="Ring"){A8.fill();}A8.restore();}var Y={dark:X,light:At},Aw={dark:{stroke:{value:"#1f1f1f",opacity:1},fill:{value:"#ffffff",opacity:1}},light:{stroke:{value:"#ffffff",opacity:1},fill:{value:"#000000",opacity:1}}};var AW=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.CircleSprite",init:function(Az){this.position={x:0,y:0,r:0};this.style=null;if(this._super){this._super(Az);}var A0=this.position;A0.x=isNaN(A0.x)||Math.abs(A0.x)===Infinity?0:A0.x;A0.y=isNaN(A0.y)||Math.abs(A0.y)===Infinity?0:A0.y;A0.r=isNaN(A0.r)||Math.abs(A0.r)===Infinity?0:A0.r;this.updateTextSize();},getTooltipInfo:function(){var Az=this.getTooltipAttrInfo();if(this.aggregationName){Az.push({n:this.aggregationName,v:this.displayValue});}return Az;},getTooltipAttrInfo:function(A1){var A0=this.stage.owner.abstractedModel.formNameDisplayType,Az=this.forms,A4=this.formValues,A3=A1||this.title,A2;if(A0===a.OFF||this.selfLoop){A2=[{n:A3,v:this.text}];}else{A2=Az.map(function(A6,A5){return{n:A6,v:A4[A5]};});}return A2;},onclick:function(){this.stopPropagation();},onmousedown:function(A0){A0=A0.e||A0;var A2=A0.srcElement||A0.target,A1=this.stage,Az=A1&&A1.lassoSelector;this.stopPropagation();if(!(Au(A0)===2&&A2===Az)){this.stage.dismissLassoSelector();}if(A1.dragMode===Af.select){A1.lassoSelectorEnabled=false;}this._isMouseDown=true;this._selectionState=N.clone(this.selectionState);this._lastMousePosition={x:A0.pageX,y:A0.pageY};},onmousemove:function(A7){var A2,A6,A4;var BA=A7.layerX,A9=A7.layerY,A0=this.stage,A1=false;A7=A7.e||A7;if(this._isMouseDown&&Au(window.event||A7)===0){var A5=this._lastMousePosition,BE=A7.pageX-A5.x,BB=A7.pageY-A5.y;this._lastMousePosition={x:A7.pageX,y:A7.pageY};this.stopPropagation();if(BE!==0||BB!==0){if(!this._dragged){A0.onSpriteStyleChange(AR.EDGE);A0.onSpriteStyleChange(AR.CIRCLE);}this._dragged=true;if(!this.selectionState.selected){if(!(A7.ctrlKey||A7.metaKey)){A0.clearSelection();}A0.addToSelection(this);A1=true;A0.owner.doSelection();}var BD=this.stage.selectedSprites,A3=this.stage.currentLayout;J.forEach(BD,function(BF){A4=BF.getGeometry();A4.x+=BE;A4.y+=BB;BF.setGeometry(A4);if(A3===h.LINEAR||A3===h.FORCE_DIRECTED){J.forEach(BF.unit.edges,function(BH){var BG=BH.from.sprite.getGeometry(),BI=BH.to.sprite.getGeometry(),BK,BJ;if(A3===h.LINEAR){BJ={x:(BG.x+BI.x)*0.5-(BI.y-BG.y)*0.5,y:(BG.y+BI.y)*0.5+(BI.x-BG.x)*0.5};}else{if(A3===h.FORCE_DIRECTED){BK=m[BH.reversedEdge?1:0];BJ={x:(BG.x+BI.x)*0.5+(BG.y-BI.y)*BK,y:(BG.y+BI.y)*0.5+(BI.x-BG.x)*BK};}}BH.sprite.setGeometry(BJ);});}});this.drawStage(false,A1);}}else{var A8,BC,Az=this.isHit(BA,A9);if(Az){this.stopPropagation();}if(this._hoverHighlighted){if(!Az){A8=this.getInvolvedSprites();A6=A8.length;for(A2=0;A2<A6;A2++){BC=A8[A2];A8[A2].unHoverHighlight();}delete this._hoverHighlighted;this.hideTooltip();if(A0._pendingRefresh){A0.onSpriteStyleChange(AR.CIRCLE);A0.onSpriteStyleChange(AR.EDGE);}A1=true;if(A0._pendingRefresh){delete A0._pendingRefresh;}}}else{if(Az){A8=this.getInvolvedSprites();A6=A8.length;for(A2=0;A2<A6;A2++){BC=A8[A2];BC.hoverHighlight();}this._hoverHighlighted=true;A1=true;}}if(A0.selectedSprites.length>0){A0.onSpriteStyleChange(AR.HIGHLIGHT);}this.drawStage(false,A1);}if(this._hoverHighlighted){this.showTooltip({x:A7.clientX,y:A7.clientY});}},onmouseup:function(Az){var A0=this.stage;Az=Az.e||Az;if(this._isMouseDown){this.stopPropagation();if(!this._dragged){if(Az.button===0){this.clickHandler(Az);}}A0._bubbleToolbarPos=Az;A0._pendingRefresh=true;delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;A0.circleMenuOnCloseFlag=false;}},clickHandler:function(A5,A6){A5=A5.e||A5;var A1=this.selectionState.selected,Az=A5.ctrlKey||A5.metaKey,A0=this.stage,A7=A0.selectedSprites.length>1,A2=A0.isClearAllEnabled(this),A3=A0.parent,A4=A3&&A3.parent;isAdded=false;A0.clearContextMenuSelection();if(A1&&!A7){if(!A6&&A2){A0.clearSelection();}}if((A1&&!Az&&A7&&!A6)||(!A1&&!Az)){A0.clearSelection();A0.addToSelection(this);isAdded=true;}if(!A1&&Az){A0.addToSelection(this);isAdded=true;}if(A1&&Az&&A7){if(!A6){A0.removeFromSelection(this);}}A3.displayVizBoxVisFilterIndicator(isAdded,A4);this.drawStage(false,true);A0.owner.doSelection();},contextMenuSelectionHandler:function(){var Az=this.selectionState.selected,A0=this.stage;A0.clearContextMenuSelection();if(Az){A0.cloneSelectionToContextMenuSelection();}else{A0.addSpriteToContextMenuSelection(this);}A0.contextMenuSelectionHighLight=true;A0.owner.doSelection(undefined,true);this.drawStage(false,true);},oncontextmenu:function AT(A0){if(mstrApp.isInVFInteractMode){T(A0);return false;}var A3=this.stage,Az=A3.owner,A1=A0.e||A0,A2=A1.ctrlKey||A1.metaKey;A0.preventDefault();A0.cancel();this.stopPropagation();if(!A2){this.contextMenuSelectionHandler();}if(this._isMouseDown){delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;}if(!A2){if(A3.isOnFormattingMode){U.call(A3,A1);}else{Az.showSelectionMenu(A1,function(){U.call(A3,A1);AP.selectPropertyPanel(Az,"de");},true);}this.hideTooltip();}return false;},getInvolvedSprites:function(){var A1=[],A4;A1.push(this);var A3=this.unit;if(A3){var A0=A3.edges,Az=A0.length,A2;for(A2=0;A2<Az;A2++){A4=A0[A2];A1.push(A4.sprite);if(A4.from===A3){A1.push(A4.to.sprite);}else{A1.push(A4.from.sprite);}}}return A1;},touchSwipeMove:function(A2){var Az=A2.layerX,A1=A2.layerY,A0=this.getGeometry();A0.x=Az;A0.y=A1;this.setGeometry(A0);this.drawStage(false);},hoverHighlight:function(){if(!this.selectionState.hovered){this.selectionState.hovered=true;this.highlight();}},unHoverHighlight:function(){if(this.selectionState.hovered){this.selectionState.hovered=false;this.unHighlight();}},getStyle:function(){var A3=this.selectionState,A0=this.stage,A2=this.stage.themeType==="dark"?A0.circleStyle.dark:A0.circleStyle.light,A1=this.stage.IsInContextMenuSelectionIndex(this),Az=false;if(A3.selected===true){if(A1===true&&A0.contextMenuSelectionHighLight===true){Az=A2.selectedStyleC;if(this.attSrc==="from"){Az.selectionBorders.inner.color.value=A2.normal.fromNode.color.value;}else{Az.selectionBorders.inner.color.value=A2.normal.toNode.color.value;}}else{Az=A2.selectedStyleA;}}else{if(A1===true&&A0.contextMenuSelectionHighLight===true){Az=A2.selectedStyleB;if(this.attSrc==="from"){Az.selectionBorders.outer.color.value=A2.normal.fromNode.color.value;}else{Az.selectionBorders.outer.color.value=A2.normal.toNode.color.value;}}}return A(A2.normal,A3.hovered&&A2.hovered,Az,A3.hovered&&A3.selected&&A2.selectedHovered);},getLabelBoundingBox:function(){var A8=this.textSize,A1=this.stage,A2=(A1.currentLayout===h.LINEAR),Az=this.position,A6=Az.x,A5=Az.y,A7,A4,A3,A0;if(A2){A7=A8.height;A4=A8.width;}else{A7=A8.width;A4=A8.height;}A3=(A7+An)/2;A0=(A4+An)/2;return{top:A5-A0,left:A6-A3,bottom:A5+A0,right:A6+A3};},isShowLabel:function AG(){var A4=this.stage,A1=A4.circleStyle.showNodeLabel||(this.selectionState.hovered&&!this._hoverHighlighted),Az=!A4.transitionTimer&&A1,A2=this.getLabelBoundingBox(),A3=A4.labelBitmap,A0;if(Az){A0=A3&&A3.testZeros(A2);if(A0){A3.set(A2);}}return Az&&A0;},draw:function Aj(A3,A5){if(this.isExcluded){return ;}this._super();var A6=this.stage,A2=this.getCanvas(),BA=A6.background;if(!A2){D("cannot find the corresponding canvas.");return ;}var BB=A2.getContext("2d"),A1=this.position,Az=A1.r>1?A1.r:1,A0=this.getStyle(),A8;var A4,A7=[];function A9(BC){A4=A0[BC+"Node"].shape;A8=A0[BC+"Node"].color;if(!A0.selectionBorders){A7.push(A0[BC+"Node"].border);}return A7;}A7=A9(A5);if(A3){A8=j.mix(A8,BA);}AY(BB,A8,A1,Az,A4);if(A0.selectionBorders){A7.push(A0.selectionBorders.inner);A7.push(A0.selectionBorders.outer);}if(A0.highlightBorder){A7.push(A0.highlightBorder);}J.forEach(A7,function(BC){if(A3){BC.color=j.mix(BC.color,BA);}Az=AA(BB,A1.x,A1.y,Az,BC,A4);});if(A6.onDraw){A6.onDraw(this);}this.drawText();},drawText:function(){function A6(BA,A8,BE){function BB(BG,BK,BH){var BJ=BK.x,BI=BK.y,BF=A8&Ad.FS_BOLD?2:1;BG.save();BG.lineWidth=1;BG.strokeRect(BJ-1,BI-1,BH+2,BF+2);BG.fillRect(BJ,BI,BH,BF);BG.restore();}var BC=this.textSize,A9=BC.width,BD=BE.x-A9/2;if(A8&Ad.FS_UNDERLINE){BB(BA,{x:BD,y:BE.y+BC.height/2},A9);}if(A8&Ad.FS_STRIKETHROUGH){BB(BA,{x:BD,y:BE.y},A9);}}var A3=this.stage,A0=this.getCanvas(),A7=A0.getContext("2d"),Az=this.position,A5=Az,A4=this.stage.circleLabelStyle,A2=A4.fontColor,A1=A4.fontStyle;if(!this.isShowLabel()){this.hasDrawnLabel=false;return ;}A7.save();A7.font=V(A4);A7.lineWidth=AB;A7.fillStyle=j.getCSSColorString(A2.fill.value,A2.fill.opacity);A7.strokeStyle=j.getCSSColorString(A2.stroke.value,A2.stroke.opacity);A7.lineJoin="round";A7.textBaseline="middle";A7.textAlign="center";if(A3.currentLayout===h.LINEAR){A7.translate(Az.x,Az.y);A7.rotate(-Math.PI/2);A5={x:0,y:0};}A7.strokeText(this.text,A5.x,A5.y);A7.fillText(this.text,A5.x,A5.y);A6.call(this,A7,A1,A5);A7.restore();this.hasDrawnLabel=true;},isHit:function(Az,A5){var A3=this.position,A1=A3.x-Az,A0=A3.y-A5,A2=A3.r,A4=A1*A1+A0*A0;return(A4<=A2*A2);},setGeometry:function(A3){if(A3){var Az=A3.x,A5=A3.y,A1=A3.s,A2=this.position,A4=false,A0;if(!isNaN(Az)&&Math.abs(Az)!==Infinity){if(Az!==A2.x){A4=true;A2.x=Az;}}if(!isNaN(A5)&&Math.abs(A5)!==Infinity){if(A5!==A2.y){A4=true;A2.y=A5;}}if(!isNaN(A1)&&Math.abs(A1)!==Infinity){if(A1!==A2.r){A4=true;A2.r=A1;}}if(A4){this.stylesChanged();A0=this.unit&&this.unit.edges;J.forEach(A0,function(A6){A6=A6.sprite;A6.stylesChanged(true);});}}},getGeometry:function(){var A0=this.position,Az=this.geometry;Az.x=A0.x;Az.y=A0.y;Az.s=A0.r;return Az;},getBorderWidth:function(){var A1,Az,A3=this.getStyle(),A4=[],A0,A2=0;if(A3.selectionBorders){A4.push(A3.selectionBorders.inner);A4.push(A3.selectionBorders.outer);}else{if(AP.getPropertyByPath(A3,"fromNode.border",false)===false&&AP.getPropertyByPath(A3,"toNode.border",false)===false){A4.push(A3.border);}else{A4.push(A3.fromNode.border);A4.push(A3.toNode.border);}}for(A1=0,Az=A4.length;A1!==Az;A1++){A3=A4[A1];if(A3.style){A0=x(A3.style);A2+=A0.thk+1;}else{A2+=A3.width||1;}}return A2;},updateTextSize:function(){var Az=this.text,A1=this.stage.circleLabelStyle,A2=H(A1.fontSize),A0=AP.measureTextWidth(Az,{fontSize:A1.fontSize,fontFamily:A1.fontFamily,fontStyle:Aq(A1.fontStyle)},R);this.textSize={width:A0,height:A2};}});var E={hovered:"white"};var d={hovered:"black"};function AF(A2){var A3=A2.start,Az=A2.end,A0,A1=false;if(A3>Az){A0=A3;A3=Az;Az=A0;A1=!A1;}if(A3<=Math.PI&&Az>A3+Math.PI){A0=A3;A3=Az;Az=A0;A1=!A1;}if(A1){A0=A2.p1;A2.p1=A2.p2;A2.p2=A0;}A2.start=A3;A2.end=Az;}function b(Az,A3){var A1=A3.x-Az.x,A0=A3.y-Az.y,A2=Math.acos(A1/Math.sqrt(A1*A1+A0*A0));if(A0>=0){return A2;}return 2*Math.PI-A2;}function g(BJ,BB,A5,A6,BD){var A1=AP.isNearZero,BH=BD/2,BF=A6*Math.cos(BH)+Math.sqrt(A5*A5-A6*A6*Math.pow(Math.sin(BH),2)),A9=BB.x-BJ.x,A8=BB.y-BJ.y,BE,A3,A2,BI,A4,BG,BC,BA,A7,A0,Az;BE=Math.sqrt(A9*A9+A8*A8);A3=A9*BF/BE;A2=A8*BF/BE;A4=Math.acos((A5*A5+BF*BF-A6*A6)/(2*A5*BF));BG=A2/BF;if(A1(Math.abs(A2)-Math.abs(BF))){if(A2<0){BG=-1;}else{if(A2>0){BG=1;}}}BG=Math.asin(BG);BC=BG+A4;BA=BG-A4;A7=A9/Math.abs(A9);BI={x:BB.x+A3,y:BB.y+A2};if(isNaN(A7)){A0={x:BB.x+A5*Math.cos(BC),y:BB.y+A5*Math.sin(BC)};Az={x:BB.x+A5*Math.cos(BA),y:BB.y+A5*Math.sin(BA)};}else{A0={x:BB.x+A5*Math.abs(Math.cos(BC))*A7,y:BB.y+A5*Math.sin(BC)};Az={x:BB.x+A5*Math.abs(Math.cos(BA))*A7,y:BB.y+A5*Math.sin(BA)};}return{center:BI,p1:A0,p2:Az};}function z(){var A9=this,A7=this.stage,A5=A7.currentLayout,A1=A9.from.position,A3;var A2=A9.width>1?A9.width:1,Az=A1.r+A9.from.getBorderWidth()/2,BA=i+A2/2;if(A5===h.CIRCULAR){A3=A7.graphCenter;}else{if(A5===h.FORCE_DIRECTED){A3=A7.findForceDirectedGraphCenter(A9.from);}else{A3=A7.findLinearLayoutGraphCenter(A9.from);}}var A8=g(A3,A1,Az,BA,Z);var A0=b(A8.center,A8.p1);var A4=b(A8.center,A8.p2);var A6=A8;A6.start=A0;A6.end=A4;A6.r=BA;AF(A6);return A6;}function o(A6){var A0=this,A4=z.call(A0),A8,A7,A5,Az=A4.start,A2=A4.end,A3=Math.max(A0.width,1),A1;if(isNaN(A4.center.x)||isNaN(A4.center.y)){return false;}A8=A6.x-A4.center.x;A7=A6.y-A4.center.y;A5=Math.sqrt(A8*A8+A7*A7)-i;if(A5<0||A5>A3){return false;}A1=b(A4.center,A6);if(Az<A2){return A1<=Az||A1>=A2;}if(Az>A2){return A2<=A1&&A1<=Az;}return true;}function AX(A1,A0,Az){Az.save();Az.fillStyle=A0;Az.lineWidth=A1.width;Az.lineJoin="round";Az.lineCap="round";Az.miterLimit=0;Az.beginPath();Az.moveTo(A1.tip.x,A1.tip.y);Az.lineTo(A1.wing1.x,A1.wing1.y);Az.lineTo(A1.crossing1.x,A1.crossing1.y);Az.lineTo(A1.crossing2.x,A1.crossing2.y);Az.lineTo(A1.wing2.x,A1.wing2.y);Az.closePath();Az.fill();Az.restore();}function AD(Az,A4,A5){var BB=A4.x-Az.x,BA=A4.y-Az.y,A6=AP.isNearZero,A2=A6(BB),A0=A6(BA),A1,A3,A7,A9,A8;if(A2&&A0){return{x:A4.x,y:A4.y};}if(A2){return{x:A4.x,y:A4.y-(BA>0?A5:-A5)};}if(A0){return{x:A4.x-(BB>0?A5:-A5),y:A4.y};}A3=BB/BA;A1=BA>0?-1:1;A7=Math.sqrt(A5*A5/(A3*A3+1));A8=A4.y+A1*A7;A9=A4.x+A3*(A8-A4.y);return{x:A9,y:A8};}function Av(A5,Az,A0){var A7=Az.x-A5.x,A6=Az.y-A5.y,A4=AP.isNearZero,A2=A4(A7),A1=A4(A6),A3;if(A2&&A1){return{a:A0.y/A0.x,b:-1,c:0};}if(A2){return{a:0,b:1,c:-A0.y};}if(A1){return{a:1,b:0,c:-A0.x};}A3=A7/A6;return{a:-A7,b:-A6,c:(A0.x*A3+A0.y)*A6};}function K(A6,BR,Az,BI){var BP=A6.a,BO=A6.b,BM=A6.c,A1=AP.isNearZero,BD=A1(BP),A4=A1(BO);if(BD||A4){var A5=AL*BI,BN=AD(BR,Az,A5),A7=AZ*BI;if(BD&&A4){return[{x:Az.x,y:Az.y},{x:Az.x,y:Az.y}];}if(BD){return[{x:BN.x+A7,y:BN.y},{x:BN.x-A7,y:BN.y}];}if(A4){return[{x:BN.x,y:BN.y+A7},{x:BN.x,y:BN.y-A7}];}}var BQ=BP*BP,BL=BR.x,A3=BR.y,BH=Math.sqrt(BP*BP+BO*BO),BG=AZ*BI*BH,BF=M*BI*BI,BE=BG-BM,BC=BP*BP+BO*BO,BB=2*(BL*BP*BO-BO*BE-BQ*A3),BA=BE*BE+BQ*BL*BL-2*BL*BP*BE+BQ*A3*A3-BF*BQ,A9=Math.sqrt(BB*BB-4*BC*BA),A8=2*BC,A2=(-BB+A9)/A8,A0=(-BB-A9)/A8,BK=(BE-BO*A2)/BP,BJ=(BE-BO*A0)/BP;return[{x:BK,y:A2},{x:BJ,y:A0}];}function l(A6,A0,A5,A1){var A8=AD(A6,A0,A5),A9=AD(A6,A0,A5+A1),A7=Av(A6,A0,A9),Az=K(A7,A9,A8,A1),A4=M*A1/3,A3=AD(A9,Az[0],A4),A2=AD(A9,Az[1],A4);return{tip:A8,inner:A9,wing1:Az[0],wing2:Az[1],crossing1:A3,crossing2:A2,width:A1};}function u(A7,A1,A6){var A4=A7.x,A3=A7.y,A0=A1.x,Az=A1.y,A5=A6.x,A2=A6.y;return AP.isNearZero(A4*(Az-A2)+A0*(A2-A3)+A5*(A3-Az));}var r=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.VisNetworkStage.EdgeSprite",init:function(Az){this.controlPoint={x:0,y:0};if(this._super){this._super(Az);}},getTooltipInfo:function(){function A1(A8){var A9=A8.unit;return[].concat(A8.from.getTooltipAttrInfo(A7),A8.to.getTooltipAttrInfo(A2),A9.values.map(function(BA,BB){return{n:BA.metricName,v:A9.format(BA.value,BB)};}));}var A0,Az=this.unit.reversedEdge,A3=this.stage.currentLayout===h.CIRCULAR,A5=this.stage.owner.abstractedModel||{},A6=A5.indexes,A4=A5.attributes,A7,A2;if(A6&&A4){A7=(A4[A6.fromIndex]||{}).name;A2=(A4[A6.toIndex]||{}).name;}A0=A1(this);if(A3&&Az){A0=A0.concat(null,A1(Az.sprite));}return A0;},onmousemove:function(A2){var Az=A2.layerX,A4=A2.layerY,A0=this.isHit(Az,A4),A3=this.stage,A1=false;A2=A2.e||A2;if(this.selectionState.hovered&&!A0){this.unHoverHighlight();this.hideTooltip();delete A3._isEdgeHovered;if(A3._pendingRefresh){A3.onSpriteStyleChange(AR.CIRCLE);A3.onSpriteStyleChange(AR.EDGE);}A1=true;}else{if(!this.selectionState.hovered&&A0){this.stopPropagation();this.hoverHighlight();A3._isEdgeHovered=true;A1=true;}}if(A1){if(A3.selectedSprites.length>0){A3.onSpriteStyleChange(AR.HIGHLIGHT);}A3.draw(false,true);if(!this.selectionState.hovered){delete A3._pendingRefresh;}}if(this.selectionState.hovered){this.stopPropagation();this.showTooltip({x:A2.clientX,y:A2.clientY});}},oncontextmenu:function(A3){if(mstrApp.isInVFInteractMode){T(A3);return false;}A3=A3.e||A3;this.stopPropagation();var A0=new mstrmojo.ui.menus.MenuConfig(),A2=this.stage,A1=A2.owner,A5=A1.getColorByMetric();if(A5&&!mstrApp.isDossier){A0.addMenuItem(mstrmojo.desc(13174,"Select color ranges..."),"",function(){A1.model.openThresholdEditor(A5,true,false);});}var Az=A1.observableModel.showEdgeDirection,A4=Az.getValue();A0.addMenuItem(mstrmojo.desc(12080,"Show Edge Direction"),A4?"on":"",function(){Az.setValue(!A4);});A0.hasToggleItem=true;A1.showMenu(A0,A3);},hoverHighlight:function(){this.selectionState.hovered=true;if(this.from){this.from.hoverHighlight();}if(this.to){this.to.hoverHighlight();}this.highlight();},unHoverHighlight:function(){this.selectionState.hovered=false;if(this.from){this.from.unHoverHighlight();}if(this.to){this.to.unHoverHighlight();}this.unHighlight();},getEndPoint:function(){var A0=this.stage,A2=A0.showEdgeDirection,A8=this,A3=A8.to,A7=A3.getGeometry(),A5=A7,A4=A8.controlPoint,Az=A8.width>1?A8.width:1,A1=Az<4?4:Az,A9,A6;if(A2){A9=A8.arrow||l(A4,A7,A7.s+A3.getBorderWidth(),A1);A6={x:(A9.crossing1.x+A9.crossing2.x)/2,y:(A9.crossing1.y+A9.crossing2.y)/2};A5=AD(A7,A6,0.15);if(!A8.arrow){A8.arrow=A9;}}return{pos:A5,arrow:A9};},draw:function k(){if(this.isExcluded){return ;}var BG=this.stage,A9=BG.currentLayout===h.CIRCULAR,BB=this.unit,BA,BC=this,A1=this.getCanvas(),BE=A1.getContext("2d"),A8=BC.to,A0=BC.from.position,Az=A8.position,A7=BC.controlPoint,BD=BC.width>1?BC.width:1,A5=BC.selectionState,BF,BH,BI,A3,A6,A4=A0,A2;if(A9&&this.skipBidirectional){return ;}if(A5.hovered||A5.selected){BF=this.stage.themeType==="dark"?E.hovered:d.hovered;}else{BF=BC.color;}BE.strokeStyle=BF;BE.lineWidth=BD;if(A0===Az){BH=z.call(this);BE.beginPath();BE.arc(BH.center.x,BH.center.y,BH.r,BH.start,BH.end,true);BE.stroke();}else{BI=this.getEndPoint();A2=BI.pos;A6=BI.arrow;BA=BB.reversedEdge;if(A9&&BA){BA=BA.sprite;BA.skipBidirectional=true;BC.skipBidirectional=false;BI=BA.getEndPoint();A4=BI.pos;A3=BI.arrow;}BE.beginPath();BE.moveTo(A4.x,A4.y);if(u(A4,A7,A2)){BE.lineTo(A2.x,A2.y);}else{BE.quadraticCurveTo(A7.x,A7.y,A2.x,A2.y);}BE.stroke();}if(A3){AX(A3,BE.strokeStyle,BE);}if(A6){AX(A6,BE.strokeStyle,BE);}if(BG.onDraw){BG.onDraw(this);}this._super();},isHit:function(BC,A9){var BI=Math.max(1,this.width/2),A0=this.controlPoint,Az=this.to.position,A1=this.from.position,BD=A1.x-2*A0.x+Az.x,BH=2*(A0.x-A1.x),A4=A1.x-BC,A8=BH*BH-4*BD*A4,BB=A1.y-2*A0.y+Az.y,BG=2*(A0.y-A1.y),A2=A1.y-A9,A6=BG*BG-4*BB*A2,BJ;function A3(BM,BL){return Math.sqrt(Math.pow((BM.x-BL.x),2)+Math.pow((BM.y-BL.y),2));}if(this.from===this.to){return o.call(this,{x:BC,y:A9});}var A5=[];var BE,BA,A7;if(BD===0){if(BH!==0){BE=(BC-A1.x)/(2*(A0.x-A1.x));}else{BE=0;}A5.push(BE);}else{if(A8>=0){BA=(Math.sqrt(A8)-BH)/(2*BD);A7=(-1*Math.sqrt(A8)-BH)/(2*BD);A5.push(BA);A5.push(A7);}}if(BB===0){if(BG!==0){BE=(A9-A1.y)/(2*(A0.y-A1.y));}else{BE=0;}A5.push(BE);}else{if(A6>=0){BA=(Math.sqrt(A6)-BG)/(2*BB);A7=(-1*Math.sqrt(A6)-BG)/(2*BB);A5.push(BA);A5.push(A7);}}var BF,BK;for(BF=0;BF<A5.length;BF++){BK=f(A5[BF],A1,A0,Az);BJ=A3({x:BC,y:A9},BK);if(BJ<=BI){return true;}}return false;},getGeometry:function(){var A0=this.controlPoint,Az=this.geometry;Az.x=A0.x;Az.y=A0.y;Az.s=this.width;return Az;},setGeometry:function(A2){if(A2){var Az=A2.x,A4=A2.y,A0=A2.s,A1=this.controlPoint,A3=false;if(!isNaN(Az)&&Math.abs(Az)!==Infinity){if(Az!==A1.x){A1.x=Az;A3=true;}}if(!isNaN(A4)&&Math.abs(A4)!==Infinity){if(A4!==A1.y){A1.y=A4;A3=true;}}if(!isNaN(A0)&&Math.abs(A0)!==Infinity){if(A0!==this.width){this.width=A0;A3=true;}}if(A3){this.stylesChanged();}}},stylesChanged:function(Az){if(this._super){this._super();}if(Az){this.arrow=undefined;}}});function AM(){function A0(){var A1=this.circleStyle,A5=this.themeType==="dark"?A1.dark:A1.light,A2=N.clone(A5.normal),A6=AP.getPropertyByPath(A2,"color.value",false)!==false?j.getCSSColorString(A2.color.value):undefined,BD=AP.getPropertyByPath(A2,"border.color.value",false)!==false?j.getCSSColorString(A2.border.color.value):undefined,BA=AP.getPropertyByPath(A2,"fromNode.color.value",false),BC=AP.getPropertyByPath(A2,"toNode.color.value",false),A4=AP.getPropertyByPath(A2,"fromNode.border.color.value",false),A8=AP.getPropertyByPath(A2,"toNode.border.color.value",false),A9=BA===false?A6:BA,BB=BC===false?A6:BC,A3=A4===false?BD:A4,A7=A8===false?BD:A8;A2={fromNode:{border:AP.getPropertyByPath(A2,"fromNode.border",false)!==false?A2.fromNode.border:A2.border,color:AP.getPropertyByPath(A2,"fromNode.color",false)!==false?A2.fromNode.color:A2.color,shape:A2.fromNode!==undefined?A2.fromNode.shape:"Circle"},toNode:{border:AP.getPropertyByPath(A2,"toNode.border",false)!==false?A2.toNode.border:A2.border,color:AP.getPropertyByPath(A2,"toNode.color",false)!==false?A2.toNode.color:A2.color,shape:A2.toNode!==undefined?A2.toNode.shape:"Circle"}};A2.fromNode.border.color.value=j.getCSSColorString(A3);A2.fromNode.color.value=j.getCSSColorString(A9,undefined,{retainGradientObject:true});A2.toNode.border.color.value=j.getCSSColorString(A7);A2.toNode.color.value=j.getCSSColorString(BB,undefined,{retainGradientObject:true});A2.showNodeLabel=A1.showNodeLabel;A5.normal=A2;return A2;}var Az=this.addDisposable(new AV({background:this.background,circleStyle:A0.call(this),circleLabelStyle:this.circleLabelStyle,dragMode:this.dragMode}));Az.background.attachEventListener("valueChanged",this.id,function(A2){var A4=Az.background.getRawObject();this.background=A4;var A1=this.owner,A3=F.encodeColor(A1.getFormats()["background-color"],10),A5=F.encodeColor(A2.newValue,10);if(A3!==A5){AP.changeWidgetBackground(A1,A2.newValue,A2.oldValue);}A1.onStylesModified("background",A4);});Az.circleStyle.attachEventListener("valueChanged",this.id,function(){function A3(A7,A6){var A4=this.observableModel,A5=A7;this.circleStyle=A7;Am.call(this);if(A6){A5=A0.call(this);A4.circleStyle.setValue(A5,true);this.owner.propInfo.circleStyle=A4.circleStyle;}this.draw(false,true,true);}var A1=Az.circleStyle.getRawObject();A1.fromNode.border.color.value=j.getColorValue(A1.fromNode.border.color.value);A1.fromNode.color.value=j.getColorValue(A1.fromNode.color.value);A1.toNode.border.color.value=j.getColorValue(A1.toNode.border.color.value);A1.toNode.color.value=j.getColorValue(A1.toNode.color.value);var A2=this.themeType==="dark"?this.circleStyle.dark:this.circleStyle.light;A2.normal=A1;this.circleStyle.showNodeLabel=A1.showNodeLabel;this.owner.onStylesModified("circleStyle",A1,A3);A3.call(this,this.circleStyle);});Az.circleLabelStyle.attachEventListener("valueChanged",this.id,function(A1){function A3(A6,A5){var A4=this.observableModel;this.circleLabelStyle=A6;if(A5){P.call(this);A4.circleLabelStyle.setValue(this.circleLabelStyle,true);}if(A2){(this.spriteCollection||[]).forEach(function(A7){if(A7.type==="Circle"){A7.updateTextSize();}});}this.draw(false,true,true);}var A2=(A1.target!==Az.circleLabelStyle.fontColor.fill.value);this.owner.onStylesModified("circleLabelStyle",Az.circleLabelStyle.getRawObject(),A3);A3.call(this,Az.circleLabelStyle.getRawObject());});Az.dragMode.attachEventListener("valueChanged",this.id,function(A1){function A3(A5,A4){this.dragMode=A5;if(A4){this.observableModel.dragMode.setValue(A5,true);}if(A5===Af.pan){this.dismissLassoSelector();this.lassoSelectorEnabled=false;this.scaleBar.inputPan.checked=true;}else{if(A5===Af.select){this.lassoSelectorEnabled=true;this.scaleBar.inputSelect.checked=true;}}}var A2=A1.newValue;A3.call(this,A2);this.owner.onStylesModified("dragMode",A2,A3);});return Az;}function P(){var Az=this.circleLabelStyle,A0=N.clone(AI);N.copy(Az||{},A0);if(!A0.fontColor){A0.fontColor=N.clone(this.themeType==="dark"?Aw.dark:Aw.light);}this.circleLabelStyle=A0;this.owner.propInfo.circleLabelStyle=A0;}function Am(){var A1=this.circleStyle,A0=Object.keys(A1),Az;if(!A1||(A0.length===1&&A0[0]==="showNodeLabel")){Az=A1.showNodeLabel;this.circleStyle=N.clone(Y);this.circleStyle.showNodeLabel=Az;}else{if(!this.circleStyle.light||!this.circleStyle.dark){var A3=N.clone(Y),A2=this.themeType==="dark"?A3.dark:A3.light;A2.normal=this.circleStyle;A3.showNodeLabel=this.circleStyle.showNodeLabel;delete this.circleStyle.showNodeLabel;this.circleStyle=A3;}}}mstrmojo.netviz.VisNetworkStage=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.netviz._HasNetworkContextMenu,mstrmojo.util.ui._LassoSelector],{scriptClass:"mstrmojo.netviz.VisNetworkStage",markupString:'<div id="{@id}-networkstage" style="position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height:{@height}px;" mstrAttach:mousedown,mousemove,click,contextmenu><div id="{@id}-canvas-parent-parent" style="position: absolute; width: {@width}px; height: {@height}px;"><div id="{@id}-canvas-parent" style="position: relative; z-index: 0;"><canvas id="{@id}-canvas" style="position: absolute; z-index: {@canvasCount}" id="canvas" width= "{@width}" height="{@height}"></canvas></div></div><div style="position: absolute; display:none; border: 2px dotted white; -webkit-user-select: none;"></div><div style="position: absolute; left: '+AN+"px; top: "+Ay+'px;"></div><div style="position: absolute;"></div></div>',markupSlots:{baseCanvas:function(){return this.domNode.firstChild.firstChild.firstChild;},canvasContainer:function(){return this.domNode.firstChild.firstChild;},canvasOuterContainer:function(){return this.domNode.firstChild;},selectionRectangle:function(){return this.domNode.childNodes[1];},scaleBarPlaceHolder:function(){return this.domNode.childNodes[2];},containerNode:function(){return this.domNode.childNodes[0];}},circleMenuOnCloseFlag:false,contextMenuSelectionHighLight:false,init:function(Az){this.spriteCollection=[];this.selectedSprites=[];this.contextMenuSelection=[];this.circleMenuOnCloseFlag=false;this.contextMenuSelectionHighLight=false;this.frameRate=60;this.frameInterval=Math.ceil(1000/this.frameRate);this.eventHasBeenHandled=false;this.isOnFormattingMode=false;this.dragMode=Af.pan;this.canvases=[];this.canvasCount=2;this.layers=[];this.transitionDuration=AQ;if(this._super){this._super(Az);}this.scaleBarRect={x:AN,y:Ay,w:Ak,h:W};Am.call(this);P.call(this);if(this.showTransition){this.enableTransition();}this.observableModel=AM.call(this);if(!this.tooltip){this.tooltip=this.addDisposable(new mstrmojo.VisTooltip({placeholder:document.body.appendChild(document.createElement("div")),owner:this}));this.tooltip.render();this.tooltip.domNode.style.display="none";}this.enableRaiseEventsForGestures();},themeType:"dark",destroy:function(){var Az=this.tooltip;if(Az.domNode&&Az.domNode.parentNode){Az.domNode.parentNode.removeChild(Az.domNode);}delete this.spriteCollection;delete this.selectedSprites;delete this.canvases;delete this.layers;if(this._super){this._super();}},preBuildRendering:function(Az){this._super(Az);},postBuildRendering:function(A0){if(this._super){this._super(A0);}var Az=this.baseCanvas;if(!Az){D("No canvas found. Init failed");return ;}this.putSpritesInCanvases();J.forEach(this.layers,function(A2){if(A2){A2.sort(function(A4,A3){if(A4.zIndex>A3.zIndex){return 1;}if(A4.zIndex===A3.zIndex){return 0;}return -1;});}});this.clear();this.updateCanvasPosition();this.draw();this.scaleBar=this.addDisposable(new mstrmojo.netviz.VisNetworkStageScaleBar({owner:this,placeholder:this.scaleBarPlaceHolder,width:this.scaleBarRect.w,height:this.scaleBarRect.h,scale:this.scale,range:{min:AC?0.00001:0.5,max:AC?10:2},setDragType:this.setDragType,resetScene:this.resetScene,dragMode:this.dragMode}));this.scaleBar.render();var A1=this;AP.addWheelListener(this.domNode,function(A5){A5.preventDefault();A1.dismissLassoSelector();if(A1.transitionTimer){return ;}var A2=A1.scaleBar,A4=A5.deltaY>0?-1:1,A6=0.1,A3=isNaN(A2.scaleFactor)?1:A2.scaleFactor;A3+=A4*A6;A2.setScaleFactor(A3);A2._deActoniveTimer=window.setTimeout(function(){A2.setScaleFactorDone();},1000);});this.registerLassoSelector(this.domNode,[],false);},lassoSelecting:function(){Ap.removeClass(this.lassoSelector,"lasso-selector-hasContent");},lassoSelected:function(A2){var A1=this,Az=A1.owner,A0=Az.parent;A1.areaSelect({x0:A2.left,y0:A2.top,x1:A2.left+A2.width,y1:A2.top+A2.height},A2);if(A1.selectedSprites.length){Ap.addClass(this.lassoSelector,"lasso-selector-hasContent");}Az.doSelection();Az.displayVizBoxVisFilterIndicator(true,A0);},lassoSelectorResized:function(Az){this.lassoSelecting();this.lassoSelected(Az);},initScaleBar:function(A0){var Az=this.scaleBar;var A1=A0||this.getLocalProp(Ao.ZOOM_FACTOR);if(!isNaN(A1)&&A1!==1){Az.setScaleFactor(A1);}},getLocalProp:function(A0){var Az=this.owner;return Az&&Az.getLocalProp(A0);},setLocalProp:function(A1,A0){var Az=this.owner;return Az&&Az.setLocalProp(A1,A0);},setMainRect:function(Az){if(!Az){return ;}this.scaleBarRect.x=Az.x+AN;if(this.scaleBar&&this.scaleBar.domNode){this.scaleBar.domNode.style.left=this.scaleBarRect.x+"px";}Az.x=this.scaleBarRect.x+this.scaleBarRect.w;Az.w=Az.w-this.scaleBarRect.w-AN;this.mainRect=Az;},onSpriteStyleChange:function(A0){if(!this.toBeDrawnLayersIndexes){this.toBeDrawnLayersIndexes=[];}var Az=this.toBeDrawnLayersIndexes;if(!isNaN(A0)&&Az.indexOf(A0)===-1){Az.push(A0);}},removeSpriteFromLayer:function(A1,A0){var Az=false,A3=this.layers[A0],A2=A3.indexOf(A1);if(A2!==-1){A3.splice(A2,1);Az=true;if(this.hasRendered){this.onSpriteStyleChange(A0);}}return Az;},addSpriteToLayer:function(A1,A0){var A2=this.layers[A0],Az=false;if(A2){A1.layerIndex=A0;if(A2.indexOf(A1)===-1){A2.push(A1);Az=true;}if(this.hasRendered){this.onSpriteStyleChange(A0);}}return Az;},putSpritesInCanvases:function(){this.canvases=[];var Az=this.canvasCount-1,A2=this.canvases,A4=[],A1,A0=document.createDocumentFragment(),A6;[AR.EDGE,AR.CIRCLE,AR.HIGHLIGHT].forEach(function(A8){var A7=A4[A8]=[];A7.canvasIndex=A8===AR.HIGHLIGHT?Ai.HIGHLIGHT:Ai.BASE;});function A3(A9,A8){var A7=A4[A8];if(A7.indexOf(A9)===-1){A9.layerIndex=A8;A7.push(A9);}A9.getCanvas=function(){return this.stage.canvases[this.stage.layers[this.layerIndex].canvasIndex];};}for(A1=0;A1<Az;A1++){A6=document.createElement("canvas");A6.width=this.width;A6.height=this.height;A6.style.position="absolute";A6.style.zIndex=(A1+1).toString();A0.appendChild(A6);A2.push(A6);}this.canvasContainer.appendChild(A0);this.canvases.push(this.baseCanvas);var A5=this.spriteCollection;J.forEach(A5,function(A7){if(A7.type==="Circle"){A3(A7,AR.CIRCLE);J.forEach(A7.unit.edges,function(A8){A8=A8.sprite;A3(A8,AR.EDGE);});}});this.layers=A4;},unrender:function(Az){if(this.scaleBar&&this.scaleBar.unrender){this.scaleBar.unrender(Az);}if(this._super){this._super(Az);}},updateCanvasPosition:function(){this.canvasPosition=AU(this.baseCanvas,true);},enableRaiseEventsForGestures:function(){var A4=As;var A3=this,A2,A5,A8=this.id;var A7=function(BD,BC){return function(BG){var BF=AU(this.baseCanvas,true),BE=BG.e||BG.evt||BG;BG.name=BD;BG.layerX=BE.pageX-BF.x;BG.layerY=BE.pageY-BF.y;mstrmojo.all[A8].eventHasBeenHandled=false;mstrmojo.all[A8].raiseEventForSprites(BG);if(BC){BC.call(mstrmojo.all[A8],BG);}};};var A6=A3.onmousemove,BA,A0,A1,Az,A9,BB;for(A2=0,A5=A4.length;A2<A5;A2++){BA=A4[A2];A0="on"+BA;A1=A3[A0];A3[A0]=A7(BA,A1);}Az=A3.onmousemove;A3.onmousemove=function(BC){if(!mstrmojo.all[A8]._isMouseDown){Az.call(mstrmojo.all[A8],BC);}else{A6.call(mstrmojo.all[A8],BC);}};A9=A3.onmousedown;BB=A3.onmouseup;A3.onmousedown=function(BC){A9.call(mstrmojo.all[A8],BC);AP.captureEventOnce("mouseup",BB,mstrmojo.all[A8]);};},clear:function AE(A2){var A1=[],A3=this,Az=this.width,A0=this.height;if(A2 instanceof Array){A2.forEach(function(A5){var A4=A3.canvases[A3.layers[A5].canvasIndex];if(A1.indexOf(A4)===-1){A1.push(A4);}});}else{A1=this.canvases;}A1.forEach(function(A5){var A4;A4=A5.getContext("2d");A4.clearRect(0,0,Az,A0);A4.fillStyle="rgba(0, 0, 0, 0)";A4.fillRect(0,0,Az,A0);});},applyScaleAndPosition:function(){var A4=this.spriteCollection,A3=A4.length,A0=this.sceneInformation.position,A2=this.scaleFactor,A7=this.width/2,A5=this.height/2,A1,A8,Az;if(isNaN(A2)){A2=1;}for(A1=0;A1<A3;A1++){A8=A4[A1];Az=A8.getGeometry();Az.s=Az.s*A2;Az.x=(Az.x-A7)*A2+A7+A0.x;Az.y=(Az.y-A5)*A2+A5+A0.y;A8.setGeometry(Az);}if(this.currentLayout===h.CIRCULAR){var A6=this.graphCenter;if(A6){A6.x=(A6.x-A7)*A2+A7+A0.x;A6.y=(A6.y-A5)*A2+A5+A0.y;}}this.scaleFactor=1;A0.x=0;A0.y=0;},setDragType:function(A0){var Az=AP.getPropertyByPath(this,"observableModel.dragMode");if(Az!==undefined){Az.setValue(A0);}},drawLayer:function AK(A1,A3){if(!A1){return ;}var Az=A1.length,A0,A2;for(A0=Az-1;A0>=0;A0--){A2=A1[A0];A2.draw(A3,A2.attSrc);delete A2.hasStyleChanged;}},drawFrame:function Ab(A0,BE){var BJ,BI,Az,BF,A2,BB,A8,A5,BH,BL,BD,A7,BN=this,A9="timerid_draw";function BK(BQ){var BO=BB["diff"+BQ],BP=BO*A7;if(!isNaN(BP)){BB[BQ]=BB["start"+BQ]+BP;}}if(!BN._hasDrawnTheFirstFrame){s.startTimer({functionName:"VisNetworkStage.draw",purpose:"Rendering the canvas"},A9);}BN.clear(BE);A8=[];if(BE instanceof Array){for(BI=0;BI<BE.length;BI++){A5=BE[BI];BL=BN.layers.length;for(BH=0;BH<BL;BH++){var BG=BN.layers[A5],BC=BN.layers[BH];if(BH!==A5&&BG&&BC&&BG.canvasIndex===BC.canvasIndex&&BE.indexOf(BH)===-1){BE.push(BH);}}}BE.sort();J.forEach(BE,function(BP){var BO=BN.layers[BP];if(BO){A8.push(BO);}});}else{A8=BN.layers;}if(!A8.length){D("nothing to draw");return ;}if(BN.transitionTimer){Az=BN.spriteCollection;BJ=Az.length;BD=A0-BN.transitionStartTime;if(BD>BN.transitionDuration){for(BI=0;BI<BJ;BI++){BF=Az[BI];A2=BF.newGeometry;BF.setGeometry(A2);delete BF.transitionGeometry;}BN.onDrawTransitionEnd();}else{A7=BD/BN.transitionDuration;for(BI=0;BI<BJ;BI++){BF=Az[BI];BB=BF.transitionGeometry;A2=BF.getGeometry();Aa(A2,BK);BF.setGeometry(BB);}}}var BM=BN.labelBitmap,A3=BE||N.valarray(AR),A4=A3.some(function(BO){return BO===AR.CIRCLE;}),A1=A3.some(function(BO){return BO===AR.HIGHLIGHT;})?BN.layers[AR.HIGHLIGHT]:[];BN.spriteCollection.forEach(function(BP){var BQ,BO;if(BP.type==="Circle"&&BP.hasDrawnLabel){BO=A4||A1.some(function(BR){return BR===BP;});if(!BO){BQ=BP.getLabelBoundingBox();BM.set(BQ.left,BQ.top,BQ.right,BQ.bottom);}}});var A6=A8.length;if(A8[AR.HIGHLIGHT]!==undefined&&A6>1){if(A6===2){D("WARN: refresh only two layers: highlight and [circle|edge]");}A8=A8.slice();A8.splice(AR.HIGHLIGHT,1);}var BA=BN.layers[AR.HIGHLIGHT];J.forEach(A8,function(BO){if(BO){BN.drawLayer(BO,BO===BA);}});D("draw done");BN.toBeDrawnLayersIndexes=[];if(!BN._hasDrawnTheFirstFrame){BN._hasDrawnTheFirstFrame=true;s.endTimer(A9);}},draw:function AH(Az,BB,A3){var A0,A7,A5,A1,BA,A9,A8,A4=this;function A6(BC){A9["diff"+BC]=A8[BC]-A9[BC];A9["start"+BC]=A9[BC];}function A2(BE){var BC=A4.id,BD=mstrmojo.all[BC];if(!BD){return ;}if(!BB&&A4.transitionTimer===undefined){if(A4.lastDrawTime!==undefined&&BE-A4.lastDrawTime<A4.frameInterval){D("draw ignored");return ;}}if(A4.transitionTimer&&!A4.transitionStartTime){A4.transitionStartTime=BE;}A4.labelBitmap=A4.addDisposable(new mstrmojo.netviz.Bitmap({left:0,top:0,right:A4.width,bottom:A4.height,scale:4}));A4.drawFrame.call(BD,BE,A0);A4.toBeDrawnLayersIndexes=[];A4.lastDrawTime=BE;if(A4.transitionTimer){A4.transitionTimer=window.requestAnimationFrame(A2);}}this.onDrawTransitionEnd();A0=this.toBeDrawnLayersIndexes;if(typeof A0==="number"&&this.layers[A0]){A0=[A0];}if(A3){A0=L(this.layers);}if(!Az){window.requestAnimationFrame(A2);}else{A7=this.spriteCollection;A5=A7.length;for(A1=0;A1<A5;A1++){BA=A7[A1];A9=N.clone(BA.oldGeometry);A8=N.clone(BA.getGeometry());Aa(A8,A6);BA.newGeometry=A8;BA.transitionGeometry=A9;}this.transitionTimer=window.requestAnimationFrame(A2);}},onDrawTransitionEnd:function(){if(this.transitionTimer){window.cancelAnimationFrame(this.transitionTimer);delete this.transitionTimer;delete this.transitionStartTime;}},clearHoverHighlight:function(){var A0=this.spriteCollection,Az=A0.length,A2,A1;for(A1=0;A1<Az;A1++){A2=A0[A1];if(A2.type==="Edge"){A2.unHoverHighlight();}}},clearSelection:function(){var A1=this.selectedSprites,Az=A1.length,A0,A2;for(A0=0;A0<Az;A0++){A2=A1[A0];A2.selectionState.selected=false;A2.unHighlight();}this.selectedSprites=[];},addToSelection:function(A0){var Az=this.selectedSprites;if(Az.indexOf(A0)===-1){A0.selectionState.selected=true;A0.highlight();Az.push(A0);}},clearContextMenuSelection:function(){var A0=this.contextMenuSelection,Az=A0.length,A1,A2;for(A1=0;A1<Az;A1++){A2=A0[A1];if(!A2.selectionState.selected){A2.unHighlight();}else{A2.highlight();}}this.contextMenuSelection=[];},clearContextMenuSelectionHighLight:function(){var A0=this.contextMenuSelection,Az=A0.length,A1,A2;for(A1=0;A1<Az;A1++){A2=A0[A1];if(!A2.selectionState.selected){A2.unHighlight();}else{A2.highlight();}}this.contextMenuSelectionHighLight=false;},cloneSelectionToContextMenuSelection:function(){var A0,Az,A1,A2;this.contextMenuSelection=this.selectedSprites.slice(0);A0=this.contextMenuSelection;Az=A0.length;for(A1=0;A1<Az;A1++){A2=A0[A1];A2.highlight();}},addSpriteToContextMenuSelection:function(A0){var Az=this.contextMenuSelection;if(Az.indexOf(A0)===-1){A0.highlight();Az.push(A0);}},IsInContextMenuSelectionIndex:function(Az){return this.contextMenuSelection.indexOf(Az)!==-1;},removeFromSelection:function(A1){var A0=this.selectedSprites,Az=A0.indexOf(A1);if(Az!==-1){A1.selectionState.selected=false;A1.unHighlight();A0.splice(Az,1);}},onclick:function(){},onmousedown:function(Az){Az=Az.e||Az;if(this.eventHasBeenHandled||this.transitionTimer||(this.lassoSelector!==Az.target&&this.canvases.indexOf(Az.target)===-1)){return ;}if(this.dragMode===Af.select){this.lassoSelectorEnabled=true;}this._isMouseDown=true;this._lastMousePosition={x:Az.pageX,y:Az.pageY};if(this._isEdgeHovered){delete this._isEdgeHovered;this._isEdgeMouseDown=true;}},onmousemove:function(A4){A4=A4.e||A4;if(this.eventHasBeenHandled||this.transitionTimer||!this._isMouseDown){return ;}var A1=this._lastMousePosition,A3={x:A4.pageX,y:A4.pageY},A0=A3.x-A1.x,Az=A3.y-A1.y;if(!this._isDragged){if(A0||Az){this._isDragged=true;if(this._isEdgeMouseDown){this._pendingRefresh=true;delete this._isEdgeMouseDown;}}}if(this.dragMode===Af.pan&&A4.button===0){var A2=this.sceneInformation.position;A2.x+=A0;A2.y+=Az;this.applyScaleAndPosition();this.draw(false);}this._lastMousePosition=A3;},onmouseup:function(A1){var A4=A1.e||A1,Az=this.owner,A3=[],A2,A0=this.circleMenuOnCloseFlag,A5=A4.ctrlKey||A4.metaKey;if(this.eventHasBeenHandled||this.transitionTimer||!this._isMouseDown){return ;}A2=this.contextMenuSelection.length;this.clearContextMenuSelection();if(!this._isDragged){if((Au(A4)===2)===false&&A0===false&&A5===false){A3=(this.selectedSprites||[]).filter(this.isClearAllEnabled,this);A3.forEach(function(A6){if(this.isClearAllEnabled(A6)){this.removeFromSelection(A6);}},this);}}if(A3.length>0||A2>0){if(A3.length>0){Az.doSelection();}if(A2>0){Az.doSelection(undefined,true);}this.draw(false);}delete this._isMouseDown;delete this._lastMousePosition;delete this._isDragged;delete this._isEdgeMouseDown;this.circleMenuOnCloseFlag=false;},oncontextmenu:function AT(A7){if(mstrApp.isInVFInteractMode){T(A7);return false;}var A5=A7.e||A7,Az=A5.target||A5.srcElement,A4=this.lassoSelector;Ac.stopPropogation(window,A5);Ac.preventDefault(window,A5);if(this.eventHasBeenHandled||this.transitionTimer){return ;}if(this.isOnFormattingMode){this.showContextMenu("background",this.observableModel.background,A5);}else{var A0=this.owner,A1=this;if(Az===A4){var A6=[],A3,A2;A1.clearContextMenuSelection();A1.cloneSelectionToContextMenuSelection();A6=A1.contextMenuSelection;A3=A6.length;if(A3>0){A1.contextMenuSelectionHighLight=true;A0.doSelection(undefined,true);for(A2=0;A2<A3;A2++){A6[A2].drawStage(false,true);}A0.showSelectionMenu(A5,function(){U.call(A1,A5);AP.selectPropertyPanel(A0,"de");},true);}}else{if(!Ac.contains(this.scaleBar.domNode,Az,true)){A0.showBlankSpaceMenu(A5,function(){A1.showContextMenu("background",A1.observableModel.background,A5);AP.selectPropertyPanel(A1.owner,0);});}}}if(this._isMouseDown){delete this._selectionState;delete this._isMouseDown;delete this._lastMousePosition;delete this._dragged;}},getCircleSpriteItems:function(){var Az=[];J.forEach(this.spriteCollection,function(A0){if(A0.type==="Circle"){Az.push({n:A0.text,id:A0});}});return Az;},areaSelect:function(A0,A4){if(isNaN(A0.x0)||isNaN(A0.x1)||isNaN(A0.y0)||isNaN(A0.y1)){D("Invalid selection area.");return ;}var A6=this.spriteCollection,Az=A6.length,A2,A1,A3;if(!A4.ctrlKey){this.clearSelection();}for(A2=0;A2<Az;A2++){A1=A6[A2];if(A1.type==="Circle"){A3=A1.getGeometry();if((A3.x-A0.x0)*(A3.x-A0.x1)<=0&&(A3.y-A0.y0)*(A3.y-A0.y1)<=0){this.addToSelection(A1);}}}var A5=AU(this.baseCanvas,true);this._bubbleToolbarPos={pageX:A0.x0+A5.x,pageY:A0.y0+A5.y};this.draw(false);},enableTransition:function(Az){this.showTransition=true;if(isNaN(Az)){Az=AQ;}this.transitionDuration=Az;},disableTransition:function(){this.showTransition=false;delete this.transitionDuration;var A1=this.spriteCollection,Az=A1.len,A0;for(A0=0;A0<Az;A0++){delete A1[A0].oldGeometry;delete A1[A0].newGeometry;}},getSpriteIndex:function Ax(A1){var Az=this.spriteCollection,A0;for(A0=0;Az[A0];A0++){if(A1===Az[A0]){return A0;}}return null;},createSprite:function(A0){A0.stage=this;var Az=null;if(A0.type==="Circle"){Az=this.addDisposable(new AW(A0));}if(A0.type==="Edge"){Az=this.addDisposable(new r(A0));}return Az;},addSprite:function q(A0,Az){if(!isNaN(Az)){this.spriteCollection.splice(Az,0,A0);}else{this.spriteCollection.push(A0);}},clearSprites:function(){this.spriteCollection=[];},removeSprite:function(A0,Az){if(isNaN(Az)){Az=this.getInex(A0);}if(!isNaN(Az)){this.spriteCollection.splice(Az,1);}},attachEventListenerForSprites:function(A0,Az,A1){if(!Az.eventHandlers){Az.eventHandlers={};}var A2=Az.eventHandlers;A2["on"+A0]=A1;},removeEventListenerForSprites:function(A0,Az){var A1=A0.eventHandlers;if(A1){delete A1[Az];if(Object.keys(A1).length===0){delete A0.eventHandlers;}}},raiseEventForSprites:function(A5){if(this.eventHasBeenHandled){return ;}var A6=A5.name;if(A6){var A1=[];J.forEach(this.layers,function(A9){var A8=[];A1.push(A8);J.forEach(A9,function(BA){A8.push(BA);});});var A4=A1.length,A2,A0,A3,A7,Az;for(A2=A4-1;A2>=0;A2--){A3=A1[A2];for(A0=0;A0<A3.length;A0++){A7=A3[A0];Az=A7.eventHandlers;if(Az&&Az["on"+A6]){Az["on"+A6].call(A7,A5);}if(this.eventHasBeenHandled){return ;}}}}},mainRect:null,setScene:function(){function A8(BW,BV,BU){function BX(BZ,BY){return AP.isNearZero(BZ.x-BY.x)&&AP.isNearZero(BZ.y-BY.y);}var BS=["x","y"].map(function BT(Ba){var BY=(BW[Ba]-2*BU[Ba]+BV[Ba]),BZ=AP.isNearZero(BY)?1:(BW[Ba]-BU[Ba])/BY;if(BZ<0||BZ>=1){return BV;}return f(BZ,BW,BU,BV);}).filter(function(BY){return !(BX(BY,BW)||BX(BY,BV));}),BR=BS.length;if(BR===2&&BX.apply(undefined,BS)){BS.pop();BR=1;}if(BR===0){return BV;}else{return BS[0];}}this.sceneInformation={};this.scaleFactor=1;var BD=this.mainRect||{x:0,y:0,w:this.width,h:this.height},A0,BG,BE,BC=[],A9=null,BL=null,BP=Q.NETWORK_CIRCLE_BORDER_WIDTH,BM=4,BK=Infinity,A3=this.showEdgeDirection,BF=Math.max,BB=Math.min,A1=Math.ceil,A4=Math.pow,BO=Math.sqrt,BH,Az,BQ,BJ,BA;A0=this.spriteCollection||[];J.forEach(A0,function(BU){var BY,BX,BW,BS,BR,BV,BT;if(BU.isExcluded){return ;}BY=BU.getGeometry();if(BU.type==="Circle"){BX=BY.s+BP;BW=BY;BC.push(BU);}else{BX=BF(A1(BY.s/2),BM);if(A3){BA=BU.getEndPoint().pos;}else{BA=BU.to.getGeometry();}BW=A8(BU.from.getGeometry(),BA,BY);}BS=BW.x-BX;BR=BW.x+BX;BV=BW.y-BX;BT=BW.y+BX;if(!A9){A9={x1:BS,x2:BR,y1:BV,y2:BT};}else{A9.x1=BB(A9.x1,BS);A9.x2=BF(A9.x2,BR);A9.y1=BB(A9.y1,BV);A9.y2=BF(A9.y2,BT);}if(!BL){BL={x1:BW.x,x2:BW.x,y1:BW.y,y2:BW.y};}else{BL.x1=BB(BL.x1,BW.x);BL.x2=BF(BL.x2,BW.x);BL.y1=BB(BL.y1,BW.y);BL.y2=BF(BL.y2,BW.y);}});if(!A9){A9={x1:0,x2:0,y1:0,y2:0};BL={x1:0,x2:0,y1:0,y2:0};}this.sceneInformation.position={x:0,y:0};var A5={left:BL.x1-A9.x1,top:BL.y1-A9.y1,bottom:A9.y2-BL.y2,right:A9.x2-BL.x2},BI,A2,BN;if(AP.isNearZero(BL.x2-BL.x1)){BI=0;}else{BI=(BD.w-A5.left-A5.right)/(BL.x2-BL.x1);}if(AP.isNearZero(BL.y2-BL.y1)){A2=0;}else{A2=(BD.h-A5.top-A5.bottom)/(BL.y2-BL.y1);}if(BI===0&&A2!==0){BN=A2;}else{if(A2===0&&BI!==0){BN=BI;}else{BN=BB(BI,A2);}}if(Math.abs(BN)===Infinity){return ;}var A7=(BD.w-(BL.x2-BL.x1)*BN-A5.left-A5.right)/2+A5.left,A6=(BD.h-(BL.y2-BL.y1)*BN-A5.top-A5.bottom)/2+A5.top;J.forEach(A0,function(BS){var BT=BS.getGeometry(),BR=BT.x,BU=BT.y;BR-=BL.x1;BR*=BN;BT.x=BR+BD.x+A7;BU-=BL.y1;BU*=BN;BT.y=BU+BD.y+A6;BS.setGeometry(BT);});if(this.currentLayout===h.CIRCULAR){this.graphCenter={x:BD.w/2+BD.x,y:BD.h/2+BD.y};}for(BG=0,BH=BC.length;BG<BH;BG++){Az=BC[BG].getGeometry();for(BE=BG+1;BE<BH;BE++){BQ=BC[BE].getGeometry();BJ=BO(A4(Az.x-BQ.x,2)+A4(Az.y-BQ.y,2));if(BJ>2){BK=BB(BK,BJ/(Az.s+BQ.s));}}}if(BK<1){J.forEach(A0,function(BR){BR.setGeometry({s:BR.getGeometry().s*BK});});}},resetScene:function(){if(this.sceneInformation){this.sceneInformation.position={x:0,y:0};}this.setScene();},scale:function(Az){if(!this.sceneInformation){this.sceneInformation={size:{width:this.width,height:this.height},position:{x:0,y:0}};}this.scaleFactor=Az;this.applyScaleAndPosition();this.draw(false);},findForceDirectedGraphCenter:function(A0){var A5=this.spriteCollection,A1={x:0,y:0},A2=0,A3,A4,BA,A9,A8,A6,A7={x:0,y:0},Az={};for(A3=0,A4=A5.length;A3!==A4;A3++){BA=A5[A3];if(BA instanceof r){A9=BA.from;A8=BA.to;if(A9===A0&&!Az.hasOwnProperty(A8.id)){A6=A8.position;A2++;Az[A8.id]=true;}else{if(A8===A0&&!Az.hasOwnProperty(A9.id)){A6=A9.position;A2++;Az[A9.id]=true;}else{A6=A7;}}A1.x+=A6.x;A1.y+=A6.y;}}A1.x/=A2;A1.y/=A2;return A1;},findLinearLayoutGraphCenter:function(Az){var A4=this.spriteCollection,A0=Az.position,A6=0,A2,A3,A7,A5,A1;for(A2=0,A3=A4.length;A2!==A3;A2++){A7=A4[A2];if(A7 instanceof r){if(A7.from===A7.to){continue;}A5=A7.controlPoint;if(A5.y<A0.y){A6++;}else{A6--;}}}if(A6>=0){A1={x:A0.x,y:0};}else{A1={x:A0.x,y:2*A0.y};}return A1;},getDataLabelFormats:function(){var Az=this.circleLabelStyle;return{color:j.getCSSColorString(Az.fontColor.fill.value),font:V(Az),"text-decoration":w(Az.fontStyle)};},execFormatHandler:function(){var Az=this.selectedSprites;if(Az&&Az.length>0){S.call(this,this._bubbleToolbarPos);AP.selectPropertyPanel(this.owner,"de");}else{AP.selectPropertyPanel(this.owner,0);}},isClearAllEnabled:function(Az){return this.owner.isClearAllEnabled(Az.unit);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gm.DndTooltip","mstrmojo.VisUtility","mstrmojo.vi.models.EnumDragSources");var N=mstrmojo,I=N.dom,K=N.VisUtility,C=N.vi.models.EnumDragSources,J=N.array;mstrmojo.gm._SupportDndAsBlackBox=mstrmojo.provide("mstrmojo.gm._SupportDndAsBlackBox",{_mixinName:"mstrmojo.gm._SupportDndAsBlackBox",mainContainerNode:"domNode",handleDndForParentNode:true,dndAsBlackBox:true,allowDrop:function H(R){var S=R.src.data,Q=S&&S.src;if(Q===C.DATASETS||Q===C.VIZ_EDITOR||Q===C.VIZ||Q===C.ALL_OBJECT_LIST){return true;}return false;},cleanUpAfterTarget:function E(Q){this._super(Q);if(this.domNode.contains(this.dndHighlightCanvas)){this.domNode.removeChild(this.dndHighlightCanvas);}delete this.dndHighlightCanvas;if(this.dndTooltip){this.dndTooltip.destroy();}delete this.dndTooltip;},ondragenter:function M(R){if(this._super){this._super(R);}var W=this.isEmpty();if(W&&!this.excludeData){R.tgt.widget=this;this.raiseEvent({name:"toggleCtrlOverlay",visible:false,controls:this.getVisEmptyMsgControls()});}var V;if(!this.dndHighlightCanvas){var Q=document.createElement("canvas"),U=I.position(this.domNode),T=I.position(this[this.mainContainerNode]);this.domNode.appendChild(Q);Q.style.position="absolute";Q.style.zIndex=1000;Q.width=T.w||U.w;Q.height=T.h||U.h;Q.style.top=(T.y-U.y)+"px";Q.style.left=(T.x-U.x)+"px";this.dndHighlightCanvas=Q;}if(!this.dndTooltip){V=document.createElement("div");document.body.appendChild(V);var S={placeholder:V,contentNodeCssClass:"gm-dnd-replace-node-tooltip",boundary:document.body};this.dndTooltip=new mstrmojo.gm.DndTooltip(S);this.dndTooltip.render();this.dndTooltip.parent=this;}this.ondragover(R);},ondragover:function B(Q){if(this._super){this._super(Q);}if(this.dndAsBlackBox){this.clearHighlightDropZoneOnGraph();this.drawBlackBoxHighlight(Q);}},ondragleave:function P(Q){var R=this.isEmpty();if(R){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});}if(this._super){this._super(Q);}},ondrop:function L(R){if(this._super){this._super(R);}if(this.dndAsBlackBox){var U=this.zonesModel,T=R.src.data,Q=T.items,S=R.getCtxtDragData().src;this.getDocModel().selectVIUnit(this.parent.id);U.addUnitsFromDataSource(Q,T.dsid,R.actions,S===C.ALL_OBJECT_LIST?R.callback:null);}},clearHighlightDropZoneOnGraph:function G(){var R=this.dndHighlightCanvas,Q=R.getContext("2d");Q.clearRect(0,0,R.width,R.height);this.dndTooltip.toggle(false);},isMetric:function O(Q){return Q&&Q.t===4;},isAttrCategory:function D(Q){return Q&&(Q.t===12||Q.t===1||Q.t===47);},singleTypeObject:function F(Q){var T=0,S=0,R=this;J.forEach(Q.src.data.items,function(U){if(R.isAttrCategory(U)){T++;}else{if(R.isMetric(U)){S++;}}});return !(T>0&&S>0);},drawBlackBoxHighlight:function A(S){var T=this.dndHighlightCanvas,a=T.getContext("2d"),X=I.position(this[this.mainContainerNode]),Q=I.position(this.domNode),R=X.w||Q.w,Z=X.h||Q.h,W=Math.min(30,0.25*R),b=Math.min(30,0.25*Z);a.save();a.beginPath();a.rect(W,b,R-2*W,Z-2*b);a.fillStyle="#bce8ff";a.globalAlpha=0.4;a.fill();a.strokeStyle="#34abeb";a.globalAlpha=1;K.drawDashLine(a,W,b,W,Z-b,2,2);K.drawDashLine(a,W,b,R-W,b,2,2);K.drawDashLine(a,R-W,b,R-W,Z-b,2,2);K.drawDashLine(a,W,Z-b,R-W,Z-b,2,2);a.restore();if(!this.singleTypeObject(S)){var U=this.dndTooltip,Y={x:S.tgt.e.x,y:S.tgt.e.y,w:0,h:0},V=S.src.widget.avatar;if(V){Y=I.position(V);}U.placementOrder=[U.PLACEMENT_ABOVE];U.popupNodeOffset=5;U.updateContent(null,Y,"Add Attributes and Metrics");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.color","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.ToolbarEditorConfig","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.AdvancedColorPicker");var Z=mstrmojo,I=Z.dom,K=Z.hash,a=Z.array,A=Z.css,i=Z.VisEnum.ControlType,h=mstrmojo.gm,F=mstrmojo.color,U=h.GMUtility,R=Z.VisUtility,j=h.FormatingPropertyTag,e=mstrmojo.models.FormatModel,c=e.ENUM_PROPERTY_NAMES,P=mstrmojo.chart.enums.EnumFontStyle,f=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,G=mstrmojo.VisEnum.NetworkLegendFormattingCategory,V=mstrmojo.ui.editors.controls.AdvancedColorPicker,W={GLOBAL:"glb",FORMATTING:"fmt"},D={FONT_COMP:"FntCmp",FONT_FAMILY:"FntFml",FONT_STYLE:"FntStyle",FONT_SIZE:"FntSz",FONT_COLOR:"FntClr",LINE_COMP:"LnCmp",SHOW:"Shw",COLOR:"Clr",STYLE:"Style",THICKNESS:"Thk"};function N(q,n){var m=this.widget,o=m.domToolbarPH,p=this;m._lastOpened=null;o.innerHTML="";document.body.appendChild(o);A.toggleClass(o,mstrApp.getThemeClassName(),true);this.configureLegendPopup(n,o);m.toolEditor=n.newInstance({unrender:function(){}});m.toolEditorClosefn=function(r){var t=r.target,s=m.toolEditor.domNode;if(!I.contains(s,t,true,s)&&!R.isHostedPopupNode(t,"class",true,document.body)){p.hideToolbar();}};I.attachEvent(document.body,"mousedown",m.toolEditorClosefn,true);m.openPopup(this.widget.toolEditor);A.toggleClass(document.body,"hasToolbarPopup",true);}function L(n,m){var o;if(m===W.GLOBAL){o=this.readGlobalProperty(n);}else{if(m===W.FORMATTING){o=this.widget.getPropertiesOfFormatable();}}if(n.slice(-3)===D.COLOR){if(n!==j.COLOR_SQUARE_COLOR||m!==W.GLOBAL){o=U.decodeColor(o);}}return o;}function Q(n,m){var o=this;if(m===W.GLOBAL){return function(q){var p=L.call(o,n,W.GLOBAL);if(n===j.COLOR_SQUARE_COLOR){p=p.color;}if(!K.equals(q,p)){if(n.indexOf(D.COLOR)!==-1){q=U.encodeColor(q);}o.writeGlobalProperty(n,q);}};}return function(r,p){var q=L.call(o,n,W.FORMATTING);if(r!==q){if(n.indexOf(D.COLOR)!==-1){r=F.encodeColor(r);}o.widget.writeFormatableProperties(n,r,p);}};}function O(n,m){n=n||[];m=m||"";a.forEach(n,function(o){o.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:m,children:n};}function d(n,o){n=n||[];var m=new mstrmojo.Box({children:n,cssText:o});return m;}function B(q,r,m){var p="white-space: nowrap; width: 50px;";if(q===mstrmojo.desc(3905,"Background")||q===mstrmojo.desc(6242,"Color")){p="white-space: nowrap;";}else{if(q===mstrmojo.desc(2885,"Fill")){p="white-space: nowrap; margin-right: 9px;";}}var n=new mstrmojo.Label({text:q}),o=d(n,p);return O([o,r],m);}function b(n,o,m){var p=this;n=n||{};if(n.propNames===undefined){n.propNames=o;}n.onGroupValueChange=function(q,s,r){if(s!==r&&s!==undefined){(Q.call(p,q,m))(s,r);}};return n;}function S(o,n,m){var p=this;a.forEach(n,function(q){var r=L.call(p,q,m);if(r!==undefined){o.setChildValue(q,r);}});}function C(m,p,o,n){n=b.call(this,n,p,o);K.copy({width:"140px",height:"22px",colorPickerHostWithin:true},n);var q=new mstrmojo.ui.editors.controls.FillConfigGroup(n);if(q){q.iniChildrenComp(p);S.call(this,q,p,o);}if(typeof m==="string"){return B(m,q,(n||[]).rowContainerCSSClass);}return q;}function Y(o,n,m){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolBoxBackgroundFill",children:[C.call(this,mstrmojo.desc(2885,"Fill"),o,n,K.copy({rowContainerCSSClass:"mstrmojo-ui-rowContainer"},m))]}]});}function k(q,o,s,r,n){var p=L.call(this,s,r),t=this;var m=new mstrmojo.ui.editors.controls.ColorPickerButton({isHostedWithin:true,width:"40px",selectedValue:p,showNoFill:false,postselectedValueChange:function(u){(Q.call(t,s,r))(u.value,u.valueWas);}});if(q){m.alias=q;}if(typeof o==="string"){return B(o,m);}return m;}function l(n){var m;if(n.listenToUpdateColorMap instanceof Function){m=n.listenToUpdateColorMap(function(){n.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});if(m&&n.detachUpdateColorMapListener instanceof Function){n.detachUpdateColorMapListener(m);}});}}function g(o,n){var m=L.call(this,o,n),p=this;return new mstrmojo.ui.menus.ToolbarEditorConfig({cssClass:"cbsquare-colorpicker",contents:[new mstrmojo.ui.editors.controls.AdvancedColorPicker({showAutomatic:!m.isDefaultColor,color:m.color,colorChanged:function(q){q=(this.showAutomatic&&q===V.VAL_AUTOMATIC)?"default":q;l(p.widget);(Q.call(p,o,n))(q,m.color);p.hideToolbar();},colorCanceled:function(){p.hideToolbar();}})]});}function T(s,n){var m={},r=L.call(this,n+D.FONT_STYLE,W.GLOBAL),p=L.call(this,n+D.FONT_COLOR,W.GLOBAL),o=L.call(this,n+D.FONT_FAMILY,W.GLOBAL),q=L.call(this,n+D.FONT_SIZE,W.GLOBAL);if(r!==undefined){m[c.FONT_WEIGHT]=(!isNaN(r)&&((r&P.FS_BOLD)>0));m[c.FONT_STYLE]=(!isNaN(r)&&((r&P.FS_ITALIC)>0));m[c.UNDERLINE]=(!isNaN(r)&&((r&P.FS_UNDERLINE)>0));m[c.LINE_THROUGH]=(!isNaN(r)&&((r&P.FS_STRIKETHROUGH)>0));}if(p!==undefined){m[c.COLOR]=p;}if(q!==undefined){m[c.FONT_SIZE]=q;}if(o!==undefined){m[c.FONT_FAMILY]=o;}s.setFormatSource(m);}function H(n,m){var o=null;if(m.indexOf(D.FONT_FAMILY)!==-1){o=n.fontFamily;}else{if(m.indexOf(D.FONT_STYLE)!==-1){o=n.fontStyle;}else{if(m.indexOf(D.FONT_SIZE)!==-1){o=n.fontSize;}else{if(m.indexOf(D.FONT_COLOR)!==-1){o=n.fontColor;}}}}return o;}function M(p,o,m){var n={bold:P.FS_BOLD,italic:P.FS_ITALIC,underline:P.FS_UNDERLINE,strikeout:P.FS_STRIKETHROUGH},q=this;o.forEach(function(r){var s=H(p,r);if(s){s.propName=r;if(r.indexOf(D.FONT_STYLE)!==-1){s.postselectionChange=function(t){var w=t.added,x=s.items[(w&&w[0]!==undefined)?w[0]:t.removed[0]],v=!!w,u=L.call(q,r,m),y=(u===undefined?0:u);if(v){y=y|n[x.css];}else{y=y&(~n[x.css]);}s.parent.raiseFormatValueChange(r,y,u);};}else{if(r.indexOf(D.FONT_FAMILY)!==-1){s.postselectedIndexChange=function(t){var w=t.value,v=t.valueWas;if(w!==v){var u=s.items;s.parent.raiseFormatValueChange(r,u[w].id,u[v]&&u[v].id);}};}else{if(r.indexOf(D.FONT_SIZE)!==-1){s.postselectedValueChange=function(t){var v=parseInt(t.value,10)+"pt",u=parseInt(t.valueWas,10)+"pt";if(v!==u){s.parent.parent.raiseFormatValueChange(r,v,u);}};}else{s.postselectedValueChange=function(t){s.parent.parent.raiseFormatValueChange(r,t.value,t.valueWas);};}}}}});}function X(n,q,p,o){var t=this;o=o||{};if(o.propNames===undefined){o.propNames=q;}if(o.onGroupValueChange===undefined){o.onGroupValueChange=function(u,w,v){if(w!==v&&w!==undefined){(Q.call(t,u,W.GLOBAL))(w,v);}};}var m={cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"397px",height:"22px"};o=K.copy(m,o);var s=new mstrmojo.ui.editors.controls.CharacterGroup(o),r=H(s,j.LEGEND_FONT_COLOR);r.showNoFill=false;M.call(this,s,q,p);T.call(this,s,n);return s;}function J(q,p){var u=p.firstChild,y=u?u.offsetWidth:0,n=u?u.offsetHeight:0,r=document.body.offsetWidth,x=document.body.offsetHeight,s=10,t=5,w=5;if(u){u.style.left="0";u.style.right="auto";u.style.top="0";u.style.bottom="auto";}var v={w:y,h:0};var o=n>0;if(o){v.h=n;}else{return false;}if(o){p.style.left=q.x+"px";p.style.top=q.y-n-s/2+"px";}if(q.x+v.w>r){p.style.left=q.x-y+"px";}if(o){var m=0;if(q.y-n-s/2<t){m=t;p.style.top=m+"px";}else{if(q.y+s/2>x){m=Math.max(x-s-n,t);p.style.top=m+"px";}}}}function E(m,p,o,n){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",showDivider:false,children:[X.call(this,m,p,o,n)]}]});}mstrmojo._FormateVisLegend=mstrmojo.provide("mstrmojo._FormateVisLegend",{_mixinName:"mstrmojo._FormateVisLegend",widget:null,readGlobalProperty:undefined,writeGlobalProperty:undefined,configureLegendPopup:undefined,init:function(m){this.widget=null;if(this._super){this._super(m);}if(this.widget&&!this.widget.domToolbarPH){var n;n=document.createElement("div");n.setAttribute("class","gm-menu-placeholder");this.widget.domToolbarPH=n;}},handleRMCOnLegend:function(x){var r=x.getTarget(),s=x.e,v={x:s.pageX,y:s.pageY},u=r.getAttribute("type"),n,t,p,q=this,o=this.widget;x.cancel();x.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()||mstrApp.isInVFInteractMode){return ;}var w,m=function(y){switch(y){case i.LGD_COLORBOX_CTN:case i.LGD_COLORBOX:if(y===i.LGD_COLORBOX){r=r.parentNode;}t=r.firstChild.identity;if(t&&t.comb){this.widget.colorSqureIdentity=t;this.selectColorBox(r,this.fmtMode);n=g.call(this,j.COLOR_SQUARE_COLOR,W.GLOBAL);v=this.adjustColorPickerPos(r);if(!v.alignLeft){p=n.ENUM_CORNERS;n.setAlignment(p.BOTTOM_LEFT,p.TOP_RIGHT);}}break;case i.LGD_TITLE:case i.LGD_TEXT:this.selectText(true);var z=[j.LEGEND_FONT_SIZE,j.LEGEND_FONT_FAMILY,j.LEGEND_FONT_STYLE,j.LEGEND_FONT_COLOR];n=E.call(this,"lgd",z,W.GLOBAL);w="lgd";break;default:this.selectLegendBody();var AA=[j.LEGEND_BG_COLOR,j.LEGEND_BG_FILL_TRANSPARENCY];n=Y.call(this,AA,W.GLOBAL);w="lgd";break;}if(n){N.call(this,v,n);if(!!w){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");o.parent.selectVIUnit();var AB=o.edtModel._targetPulldown;if(AB){AB.selectItemByField("v",w);}}}};m.call(this,u);J.call(this,v,this.widget.domToolbarPH);},hideToolbar:function(){var n=this.widget,o=n.domToolbarPH,q=o.firstChild,m=o.parentNode;if(q){o.removeChild(q);}if(m){m.removeChild(o);}var p=n.toolEditor;if(p){p.unrender=function(){p._super();};p.destroy();p.unrender=function(){};delete n.toolEditor;A.toggleClass(document.body,"hasToolbarPopup",false);A.toggleClass(o,mstrApp.getThemeClassName(),false);}if(n.toolEditorClosefn){I.detachEvent(document.body,"mousedown",n.toolEditorClosefn,true);delete n.toolEditorClosefn;}},highlightText:function(m){throw new Error("subclass need to implement highlightText function");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Vis","mstrmojo._HasOwnAvatar");var K=mstrmojo.css,I=mstrmojo.dom,F="px";function B(Q,P){return{x:Q.x-P.x,y:Q.y-P.y};}function M(Q,P){return(Q.x-P.x)*(Q.x-P.x)+(Q.y-P.y)*(Q.y-P.y);}function N(P){var Q=P.src.data;return(!Q||!Q.isScrollBar);}mstrmojo.VisLegend=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gm.VisLegend",bodyCssClass:"",avatarCssClass:"legend-dragged",dropZoneHighlightCss:"legend-dropZone",ownAvatar:true,draggable:true,dropZone:true,dockedPositions:null,calculateDockedPositions:mstrmojo.emptyFn,widget:null,boundaryNode:null,draggableNodeName:"domLegend",legendMarkup:"",extrasMarkup:"",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;position:absolute;" mstrAttach:click,mouseover,mouseout><div class="gm-legend-bg"><div class="{@bodyCssClass}" style="width:{@width}px;height:{@height}px;text-decoration:inherit">{@legendMarkup}</div></div><div class="gm-anchor-point topLeft"></div><div class="gm-anchor-point topRight"></div><div class="gm-anchor-point bottomLeft"></div><div class="gm-anchor-point bottomRight"></div>{@extrasMarkup}</div>',markupSlots:{dropZoneNode:function(){return this.domNode;},domLegend:function(){return this.domNode.firstChild.firstChild;}},postBuildRendering:function(){this._super();this.calculateDockedPositions(this.widget.getWidth(),this.widget.getHeight());this.boundaryNode=this.widget.domNode;this.boundaryPosition=I.position(this.boundaryNode,true);},createAvatar:function D(){return this[this.draggableNodeName];},updateDropZoneNode:function C(R){var P=this.dockedPositions;if(P&&P.length>0){var W=B(R.tgt.pos,this.boundaryPosition);var U=M(W,P[0]),T=0,Q,V;for(Q=1;Q<P.length;Q++){V=M(W,P[Q]);if(V<U){U=V;T=Q;}}if(T!==this.currDockedPositionIdx){var S=this.dropZoneNode.style;S.left=P[T].x+F;S.top=P[T].y+F;if(this.widget.onLegendDropZoneChange){this.widget.onLegendDropZoneChange(P[T],T);}this.currDockedPositionIdx=T;this.updateAlignClass();return true;}}return false;},toggleDropZoneBorder:function O(P){K.toggleClass(this.dropZoneNode,this.dropZoneHighlightCss,P);},isDragValid:N,ondragstart:function E(P){if(!N(P)){return ;}this._super(P);this.toggleDropZoneBorder(true);},ondragmove:function A(P){if(!N(P)){return ;}this.updateDropZoneNode(P);this._super(P);},allowDrop:function H(P){var R=P.src,Q=R&&R.widget;return(Q&&Q!==this&&Q.parent===this.parent);},ondrop:function J(R){var P=this.domLegend;K.removeClass(P,this.avatarCssClass);var S=P.style;S.left="0";S.top="0";this.dropZoneNode.firstChild.appendChild(P);if(this.widget.onLegendDropped){var Q=this.getDockedPosition();this.widget.onLegendDropped(Q&&Q.pos);}R.dropSuccessful=true;},getDockedPosition:function G(){return this.dockedPositions&&this.dockedPositions[this.currDockedPositionIdx];},ondragend:function A(P){if(!N(P)){return ;}this._super(P);if(!P.dropSuccessful){this.ondrop(P);}this.toggleDropZoneBorder(false);},positionAvatar:function L(U){var R=this,Q=this.avatar,S=Q.style,T=this.boundaryPosition;var P=function(V,W){if(V==="x"){if(W<T.x){return T.x;}return Math.min(W,T.x+T.w-R.domNode.offsetWidth);}if(V==="y"){if(W<T.y){return T.y;}return Math.min(W,T.y+T.h-R.domNode.offsetHeight);}};S.left=P("x",U.x)+F;S.top=P("y",U.y)+F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisLegend","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.gm.GMIdentities","mstrmojo.gm.GMUtility","mstrmojo.array","mstrmojo.string","mstrmojo.hash","mstrmojo._FormateVisLegend","mstrmojo.ui._HasScroller");var Ah=mstrmojo,Ad=Ah.gm,AA=Ah.dom,Ac=Ah.css,S=Ah.hash,AO=Ah.VisUtility,a=Ad.GMUtility,P=mstrmojo.array,Y=mstrmojo.string,AB=mstrmojo.ui.editors.controls.AdvancedColorPicker,f=Ad.ColorSquareIdentity,C=Ah.VisEnum.ControlType,j=Ad.EnumLegendSlot,AM=Ad.EnumDockPosition,n=Ad.EnumLegendSlot,AG=Ad.EnumIdentityType,AE=Ad.EnumShape,AY=Ah.VisEnum.GMLegendDataType,J=mstrmojo.desc(13966,"Size by:"),w="px",F=1.35,Z=0.75,W=5,K=20,l=K,AF=5,A=5,x=16,e=15,H=16,AJ=20,G=150,s=15,Af=1,z="setAttribute",k=3,h=2,Q=8,r=15,AT=14,u=1,R=2,g=4,Ai=8,Ag=16,L=10,AV=3,AK=50,AQ=-3,t=5,AR="gm-legend-lock-icon",AN=mstrmojo.desc(14442,"This metric has its axis scale set to custom min and max values"),O="http://www.w3.org/2000/svg",v="\u2026",N=/[ \-]/;function AS(Ao,Aq,Aj,Ar){if(!Ao){return ;}var Al,Au,Am,At,Ap=Ao.style,Av=Aq===AM.TOP,Ak=Aq===AM.BOTTOM,As=Aq===AM.LEFT,An=Aq===AM.RIGHT;if(Av||Ak){Al=Aj;Au=1;Am=-1;At=AQ;if(Ak){At+=Ar;}}else{if(As||An){Al=1;Au=Ar;At=-1;Am=AQ;if(An){Am+=Aj;}}}Ap.cssText="left:"+Am+w+";top:"+At+w+";width:"+Al+w+";height:"+Au+w+";";if(mstrApp.isInVFInteractMode){Ap.cursor="default";}}function I(Ak){var Aj=String(Ak);return Aj.indexOf(" ")>=0||Aj.indexOf("-")>=0;}function X(Al,Ak,Am){var Aj=typeof Al==="string"?a.restoreSpecialChars(Al):Al;return AO.measureTextWidth(Aj,Ak,Am);}function AI(An,Am,Ak,Aj){var Al=X(Am,Ak,L);An.setAttribute("measureWidth",Al);if(Al>Aj){Al=Aj;}else{An.style.overflow="visible";}An.setAttribute("displayWidth",Al);An.style.width=Al+w;return Al;}function Ae(Al,Ak){var Aj;if(parseInt(Al.getAttribute("measureWidth"))>Ak){Aj=parseInt(Al.style.maxHeight);}else{Aj=parseInt(Al.style.lineHeight);}return Aj;}function B(Ak){var Aj;if(Ak.textContent&&typeof (Ak.textContent)!==undefined){Aj=Ak.textContent;}else{Aj=Ak.innerText;}return Aj;}function b(Al){var Ak=Al.getAttribute("measureWidth"),Aj=Al.getAttribute("displayWidth");if(!Ak){Al[z]("title","");}Ak=parseFloat(Ak,10);Aj=parseFloat(Aj,10);if((Ak-Aj)>0.1){Al[z]("title",B(Al));}else{Al[z]("title","");}}function AL(An,Aj,Ak,Am){var Al=document.createElement("div");Al[z]("class","gm-legend-underLine");Al.style.width=Am-L+w;Al.style.left=Aj+5+w;Al.style.top=Ak+w;An.appendChild(Al);}function AX(Am,Aj,Ak){var Al=document.createElement("div");Al[z]("class","gm-legend-underLine-anchorPoint");Al.style.left=Aj+w;Al.style.top=Ak-3+w;Am.appendChild(Al);}function AH(Am,Aj,Ak,Al){AL(Am,Aj,Ak,Al);AX(Am,Aj,Ak);}function m(Al,Aw,As,Aq,Au){var Ar,Am,At,Aj,Av=a.restoreSpecialChars(Al.innerHTML),Ap=Av.length,An=0,Ak=Ap,Ao=false;if(Al.scrollHeight>1.5*H){Ar=X(Al.innerHTML,Aw,L);Am=Ar-As+L;if(Am>Au){while((Ak-An)>1){At=(An+Ak)>>1;Aj=Av.substring(0,At)+v;Ar=X(Aj,Aw,L);Am=Ar-As+L;if(Am>Au){Ak=At;}else{An=At;}}Al.innerHTML=Y.encodeHtmlString(Av.substring(0,An)+v,true);Al[z]("title",Av);Ao=true;Ar=X(Al.innerHTML,Aw,L);Am=Ar-As+L;}AL(Al,0,Aq+H,(Am<Au)?Am:Au);}if(As>Au){Al[z]("title",Av);}else{if(!Ao){Al[z]("title","");}}}function y(Aj,As,Ao,Ak,Ar,At){var Al,An,Ap,Aq,Am=document.createElement("div");Am[z]("class","gm-legend-textcell");Am[z]("type",C.LGD_TEXT);Am.style.lineHeight=e+w;if(Ar){Aq=AI(Am,As,At,Ar);}if(Ak&u){Al=(AJ+AT)/2+Ao*AJ;Ap=x;}else{Al=(s+AT)/2+Ao*s;if(Ak&Ai){if(Ak&Ag){Ap=0;}else{Ap=r;}}else{if(Ak&g){Ap=Q;}else{Ap=0;}}}An=Aq||r+L;Am.innerText=As;Am.identity={objType:AG.LEGEND_TEXT};AH(Aj,Ap,Al,An);this.textDivs.push(Am);Aj.appendChild(Am);}function Aa(Aj,Am){var Ak,Ao,An,Al=0;if(Aj){An=Aj.elements;for(Ak=0,Ao=An.length;Ak<Ao;Ak++){Al=Math.max(Al,X(An[Ak].label,Am,L));}Al+=x+A*2+AV;}return Al;}function V(Am,Al){var Ap,Aj,Ao,An=Am.items,Ak=0;if(!An){return 0;}Ap=An.length;Ao=Am.custMetrics;for(Aj=0;Aj<Ap;Aj++){if(Ao&&Ao.indexOf(An[Aj])!==-1){Ak=Math.max(Ak,X(An[Aj],Al,L)+Q);}else{Ak=Math.max(Ak,X(An[Aj],Al,L));}}return Ak;}function AP(Am,Al){var Aj,Ao,An,Ak=0;if(Am){An=Am.elements;Ao=An.length;if(Am.caseFlag===1){Ak=V(Am,Al);}else{if(Am.caseFlag===0){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X("Max: "+An[Aj].v,Al,L));}Ak+=s*k;Ak=Math.max(Ak,V(Am,Al));}else{if(Am.caseFlag===2){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X(An[Aj].v,Al,L));}Ak+=s*Ao+r;Ak=Math.max(Ak,V(Am,Al));}else{if(Am.caseFlag===3){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X(An[Aj].v,Al,L));}Ak+=s*t;}}}}Ak=Math.max(Ak,X(J,Al,L));Ak+=A*3;}return Ak;}function d(Au,Am,Ay){if(!Au||!Au.length||Au.length<1){return 0;}var An,Ak,Ax,Aj,Aq,At,Ap,As,Ar,Al,Ao,Aw=l+2*Af,Av=Aw;for(An=0;An<Au.length;An++){Ap=Au[An];if(Ap.dataType===AY.COLOR_BY){As=Ap.dataObj;if(As){Al=2*AF+H;Ax=a.removeExtraSpace(As.item);At=X(Ax,Ay,L);if((At+2*A>Am-2*Af)&&I(Ax)){Al+=H;}Aj=As.elements;Ak=Aj.length;Al+=A;Al+=h;Aj.forEach(function(Az){if(Az.bftp){Ad.GMLegend.IMAGE_SIZE_FIXED=G;AJ=G;}});Aw+=Al+AJ*Ak;Av+=Al+(Ak>0?AJ:0);}}else{if(Ap.dataType===AY.SIZE_BY){Ar=Ap.dataObj;if(Ar){Ao=2*AF+H;Ax=a.removeExtraSpace(Ar.item);At=X(Ax,Ay,L);if((At+2*A>Am-2*Af)&&I(Ax)){Ao+=H;}Aq=Ar.caseFlag;if(Aq===1){Ak=0;}else{if(Aq===0){Ak=2;}else{if(Ar.caseFlag===2||Aq===3){Ak=Ar.elements.length;}}}Ak+=(Ar.items&&Ar.items.length)||0;Ao+=s*Ak;Ao+=A;Ao+=h;Aw+=Ao;Av+=Ao;}}}}return{height:Aw,minHeight:Av};}function Ab(Aj,Ak){var Am=0,Al=0;P.forEach(Aj||[],function(An){var Ao;if(An.dataType===AY.COLOR_BY){Ao=Aa(An.dataObj,Ak);if(Ao>Am){Am=Ao;}}else{if(An.dataType===AY.SIZE_BY){Ao=AP(An.dataObj,Ak);if(Ao>Al){Al=Ao;}}}});return Math.max(Am,Al)+2*Af;}function i(Ak,Aq,Ao,An){var Al=d(Ak,Aq,An),Aj=Al.height,Ap=Ao-W*2,Am={};Am.autoCollapse=Al.minHeight>Ap;Am.minHeight=Al.minHeight;Am.width=Aq;Am.height=Math.min(Aj,Ap);if(Aj>Ap){Am.cutBy=Aj-Ap;}return Am;}function E(Ak,Al){var Am=Ak.decodedColor||Ak.color||AB.VAL_AUTOMATIC,Aj;if(Am.c1){Aj=Ac.buildGradient(Am.or,Am.c1,Am.c2);Al.style[Ac.convertCssToCamelCase(Aj.n)]=Aj.v;}else{Al.style.backgroundColor=Am;}if(Ak.image){Al.style.backgroundImage=Ak.image;}if(Ak.opacity!==undefined){Al.style.opacity=Ak.opacity;}Al.identity=new f({objType:AG.COLOR_SQUARE,parentIdentity:this.identity,token:Ak.token,decodedColor:Ak.decodedColor,encodedColor:Ak.encodedColor,isDefaultColor:Ak.isDefaultColor});}function AU(){var Ay,Av,At,Aj,Au,A0,Ak,Ar,Ap,Am,A2=document,A1=this.triBtn,Ax=this.closeBtn,Ao=this.cbContainer,Al=this.sb1Container,Aw=this.sb2Container,Aq=this.cbTableContainer,An=null,Az=this.height-l-A-2*Af,As=this.width-2*A-2*Af;A1[z]("class","gm-legend-tri-button-collapsed");if(this.autoCollapse){A1[z]("title",mstrmojo.desc(13682,"There is not enough space to display the legend"));}else{A1[z]("title",mstrmojo.desc(13683,"Maximize Legend"));}Ax.style.display="none";this.splitter.style.display="none";this.domNode.style.overflow="hidden";for(Ay=0;this.dataArray&&Ay<this.dataArray.length;Ay++){Aj=this.dataArray[Ay];if(Aj.dataType===AY.COLOR_BY){An=Aj.dataObj;break;}}Ao.style.display=An?"block":"none";Al.style.display="none";Aw.style.display="none";if(An){At=An.elements;Av=At.length;Au=this.cbTitle;Au.style.display="none";Ao.style.top=l+w;Ao.style.width=As+w;Aq.style.top="0px";A0=this.cbTable;A0.innerHTML="";for(Ay=0;Ay<Av;Ay++){Ak=A2.createElement("tr");Ar=A2.createElement("td");Am=A2.createElement("div");Ap=A2.createElement("div");Am[z]("class","gm-legend-colorbox-ctn-div");Am[z]("type",C.LGD_COLORBOX_CTN);Am[z]("title",At[Ay].label);Ap[z]("class","gm-legend-colorbox-div");Ap[z]("type",C.LGD_COLORBOX);E.call(this,At[Ay],Ap);Ak[z]("class","gm-legend-tr");Ak.style.height=AJ+w;Ar[z]("class","gm-legend-colorbox");Am.appendChild(Ap);Ar.appendChild(Am);Ak.appendChild(Ar);A0.appendChild(Ak);if(A0.offsetHeight+AJ>Az){break;}}A0.style.top="0px";A0.style.marginLeft="0px";Aq.style.top=A+w;Aq.style.height=A0.offsetHeight+w;}Ao.style.height=Az+w;}function o(Al,Ak,An,Aj){var Am=document.createElementNS(O,"circle");Am.setAttribute("cx",Ak);Am.setAttribute("cy",An);Am.setAttribute("r",Aj);Am.setAttribute("class","gm-legend-sizeby-circle");Al.appendChild(Am);}function AD(Al,Am,Ap,Ak,Ao,Aq,An){var Aj=document.createElementNS(O,"line");Aj.setAttribute("x1",Am);Aj.setAttribute("y1",Ap);Aj.setAttribute("x2",Ak);Aj.setAttribute("y2",Ao);Aj.style.strokeWidth=Aq;if(An){Aj.setAttribute("class",An);}Al.appendChild(Aj);}function AZ(Ak,Ay){var Ax,Al,An,Ao,Am,Aj,Aw,Ap,Az,Aq,Au=Math.PI,Ar=Ay.elements,As=Ar.length,At=As*s,Av=Ak.getContext("2d"),A0={LINE_COLOR:"#b0b0b0",MIN_WIDTH:1,MAX_WIDTH:10},A1=AO.getPropertyByPath(this,"widget.model.data.visName")||AO.getPropertyByPath(this,"widget.model.data.vis.vn");switch(A1){case"GraphMatrixVisualizationStyle":if(this.shapeType===AE.SQUARE||this.shapeType===AE.TICK||this.shapeType===AE.LINE||this.shapeType===AE.BAR||this.shapeType===AE.AREA||this.shapeType===AE.RECTANGLE){Aq="rectangle";}else{Aq="circle";}break;case"VIHeatMapVisualizationStyle":Aq="rectangle";break;default:Aq="circle";break;}switch(Ay.caseFlag){case 0:Av.save();if(mstrApp.getThemeClassName().indexOf("dark")>=0){Av.strokeStyle="rgba(116, 116, 117, 0.7)";Av.fillStyle="rgba(116, 116, 117, 0.7)";}else{Av.strokeStyle="rgba(188, 188, 189, 0.7)";Av.fillStyle="rgba(188, 188, 189, 0.7)";}At=s*k;Az=Math.floor(s*0.75+0.5);Al=Math.floor(Az/3.5+0.5);if(Aq==="circle"){Ao=Az+1;Am=s;Av.beginPath();Av.arc(Ao,Am,Az,0,2*Au,false);Av.fill();Av.stroke();Ao=2*Ao+2*Al;Am=Math.floor(0.53*s+0.5);Av.beginPath();Av.arc(Ao,Am,Al,0,2*Au,false);Av.fill();Av.stroke();}else{Ao=1;Am=s-Az;Av.beginPath();Av.fillRect(Ao,Am,2*Az,2*Az);Ao=2*Az+2+Al;Am=Math.floor(0.53*s-Al+0.5);Av.beginPath();Av.fillRect(Ao,Am,2*Al,2*Al);}Av.translate(0.5,0.5);Av.lineWidth=1;Av.strokeStyle="#9C9C9C";Ao=2*Az+3*Al+3;Am=Math.floor(0.53*s+0.5);Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(At,Am);Av.stroke();Ao=2*Az+2;Am=Math.floor(1.53*s-Al+0.5);Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(Ao+Al,Am+Al);Av.lineTo(At,Am+Al);Av.stroke();Av.restore();break;case 1:break;case 2:An=parseInt(Ar[0].diameter,10);An=Math.min(An,At);Av.fillStyle="#ADADAC";Av.strokeStyle="#ADADAC";if(Aq==="circle"){Ao=At>>1;Am=Ao;Av.arc(Ao,Am,An>>1,0,2*Au,false);Av.fill();Av.stroke();}else{Ao=(At-An)>>1;Am=Ao;Av.rect(Ao,Am,An,An);Av.fill();Av.stroke();}break;case 3:Aj=A0.MIN_WIDTH;Aw=(As===1?0:(A0.MAX_WIDTH-A0.MIN_WIDTH)/(As-1));At=Ak.width;Ap=s;Ao=0;Am=s/2;Av.strokeStyle=A0.LINE_COLOR;for(Ax=0;Ax<As;Ax++){Av.lineWidth=Aj;Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(At-Ao,Am);Av.stroke();Am+=Ap;Aj+=Aw;}break;default:break;}}function AW(Ak,As){var Aq=1,Aj,Ao=1.5*H,Ar=Ak.innerHTML,Ap=a.restoreSpecialChars(Ar),Al=Ap.split(N),At,Am;var An=function(Au){Am=Ap[Au];return Am!==undefined?Am:"";};if(Ak.scrollHeight>Ao){if(!Al[0]){return 0;}Aj=Al[0]+An(Al[0].length);while(Al[Aq]!==undefined){At=Aj+Al[Aq];At+=An(At.length);Ak.innerHTML=a.replaceSpecialChars(At);if(Ak.scrollHeight>Ao){break;}Aj=At;Aq++;}Ak.innerHTML=Ar;}else{Aj=Ap;}return X(Aj,As,L);}function c(Az,Ax,Ay,At){var Aw,Al,Ao,An,As,Av,Ar=Ax.elements,Au=Ar.length,Aq=[],A0=document,Aj=A0.createDocumentFragment(),Am=false,Ap=this.styles,Ak=Ay;switch(At){case 0:if(Au>0){Aq.push({v:"Min: "+Ar[Au-1].v});Aq.push({v:"Max: "+Ar[0].v});Au=2;}break;case 1:Ar=Ax.items;P.forEach(Ar,function(A1){Aq.push({v:A1});});break;case 3:Aq=Ar;break;default:Aq=Ar;Am=true;break;}Au=Aq.length;for(Aw=0;Aw<Au;Aw++){Al=A0.createElement("tr");Al[z]("class","gm-legend-tr2");Al.style.height=s+w;if(Am){Ao=A0.createElement("td");y.call(this,Ao,Aq[Aw].sign,Aw,R|Ai|Ag);Ao[z]("class","gm-legend-sign");Al.appendChild(Ao);Ak-=r;}An=A0.createElement("td");An[z]("class","gm-legend-desc");if(Ax.custMetrics&&Ax.custMetrics.indexOf(Aq[Aw].v)!==-1){y.call(this,An,Aq[Aw].v,Aw,R|g,Ak-Q,Ap);Av=parseInt(An.lastChild.style.width,10);As=A0.createElement("div");As.setAttribute("class",AR);As.setAttribute("title",AN);An.appendChild(As);As.style.top=(s-8)/2+Aw*s+w;An.lastChild.style.marginLeft=Av+w;}else{if(Am){y.call(this,An,Aq[Aw].v,Aw,R|Ai,Ak,Ap);}else{y.call(this,An,Aq[Aw].v,Aw,R,Ak,Ap);}}Al.appendChild(An);Aj.appendChild(Al);}Az.appendChild(Aj);}function U(){var Al="."+AR,Aj=this.domLegend.querySelectorAll(Al),Ak;P.forEach(Aj,function(Am){Ak=Am.parentNode;if(Ak){Ak.removeChild(Am);}});}function T(){var BC,A4,BH=0,BI,Az,A6,A0,Am,BA,BD,Aq,BG,BB,Aj=this.width-2*Af,Au=Aj-2*A,Ao=document,Al=this.triBtn,A5=this.closeBtn,A3=this.cbContainer,Av=this.cbTableContainer,BJ=this.sb1Container,Ap=this.sb2Container,At,Ar,An,As,A8,Ax,A7=this.cutBy,A2=l,BE=0,A1=this.styles,A9,BF,Ay=(H+AT)/2,Ak,Aw;Al[z]("class","gm-legend-tri-button");Al[z]("title",mstrmojo.desc(13684,"Minimize Legend"));A5.style.display="block";A5[z]("title",mstrmojo.desc(12002,"Hide Legend"));this.updateSplitter();U.call(this);this.domNode.style.overflow="visible";A3.style.display="none";BJ.style.display="none";Ap.style.display="none";for(A4=0;this.dataArray&&A4<this.dataArray.length;A4++){Ar=this.dataArray[A4];A8=null;Ax=null;if(Ar.dataType===AY.COLOR_BY){A8=Ar.dataObj;if(A8){A3.style.display="block";A0=a.removeExtraSpace(A8.item);Am=A8.elements;BC=Am.length;A3.style.top=A2+w;A3.style.width=Au+w;BG=0;if(BE===0){Ac.addClass(this.sepLine1,"toggleHide");BE++;}BI=this.cbTitle;BI.style.display="block";AI(BI,A0,A1,Au);BI.innerHTML=Y.encodeHtmlString(A0,true);BG+=Ae(BI,Au)+2*AF;Ak=AW(BI,A1);m(BI,A1,Ak,Ay,Au);AH(BI,0,Ay,(Ak<Au)?Ak:Au);Az=this.cbTable;Az.style.display="block";Az.style.width=(Au-AV)+w;Az.style.marginLeft=AV+w;Az.innerHTML="";Az.appendChild(this.fillColorByTable(A8,0));BA=AJ*BC+1;Av.style.top=BG+w;Az.style.display="table";BG+=BA+A;if(A7){BG-=A7;BA-=A7;}A3.style.height=BG+w;Av.style.height=BA+w;A2+=BG+h;}}else{if(Ar.dataType===AY.SIZE_BY){Ax=Ar.dataObj;if(Ax){BH++;if(BH===1){An=BJ;As=this.sb1Title;A6=this.sb1MetricNamesTable;Az=this.sb1DataTable;At=this.sb1Canvas;}else{An=Ap;As=this.sb2Title;A6=this.sb2MetricNamesTable;Az=this.sb2DataTable;At=this.sb2Canvas;}An.style.display="block";A0=a.removeExtraSpace(Ax.item);Am=Ax.elements;BC=Am.length;An.style.top=A2+w;An.style.width=Au+w;BG=0;if(BE===0){Ac.addClass(this.sepLine2,"toggleHide");BE++;}if(Ax.caseFlag===0){BD=k*s;Aq=2*s;}else{if(Ax.caseFlag===3){BD=t*s;Aq=BC*s;}else{BD=BC*s;Aq=BD;}}BI=As;BI.innerHTML=Y.encodeHtmlString(A0,true);BF=Ax.custMetrics&&Ax.custMetrics.indexOf(A0)!==-1;if(BF){Aw=Au-Q;}else{Aw=Au;}AI(BI,A0,A1,Aw);if(BF){A9=Ao.createElement("div");A9.setAttribute("class",AR);A9.setAttribute("title",AN);An.appendChild(A9);A9.style.top=(BI.offsetHeight-8)/2+AF+h+w;A9.style.left=BI.offsetWidth+"px";}Ak=AW(BI,A1);m(BI,A1,Ak,Ay,Aw);AH(BI,0,Ay,(Ak<Aw)?Ak:Aw);BG+=Ae(BI,Aw)+2*AF;BB=Au;A6.innerHTML="";if(Ax.items&&Ax.items.length>0){A6.style.display="block";c.call(this,A6,Ax,BB,1);}else{A6.style.display="none";}A6.style.top=BG+w;A6.style.left="0"+w;A6.style.width=BB+w;BG+=A6.offsetHeight;if(BD>0){BB-=BD+A;}Az.innerHTML="";if(Ax.elements&&Ax.elements.length>0){Az.style.display="block";c.call(this,Az,Ax,BB,Ax.caseFlag);}else{Az.style.display="none";}At.style.position="absolute";At.style.top=BG+w;At.style.marginLeft=A+w;Az.style.top=BG+w;Az.style.left=(BD+A)+w;Az.style.width=BB+w;BG+=Aq+A;An.style.height=BG+w;Az.style.display="table";At.width=BD;At.height=Aq;AZ.call(this,At,Ax);A2+=BG+h;}}}}}function p(){var Aj,Ak=this.textDivs,Al=Ak.length;for(Aj=0;Aj<Al;Aj++){b(Ak[Aj]);}}mstrmojo.gm.GMLegend=mstrmojo.declare(mstrmojo.VisLegend,[mstrmojo._FormateVisLegend,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gm.GMLegend",cssClass:"gm-legend",dropZoneHighlightCss:"gm-legend-slot",dockedPositions:null,dockPos:AM.LEFT,GMW:0,GMH:0,isMinimal:false,shapeType:undefined,legendMarkup:'<div class="gm-legend-button"><div class="gm-legend-tri-button"></div><div class="gm-legend-name"></div><div class="gm-legend-close-button"></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><div class="gm-legend-table-container"><table class="gm-legend-table"></table></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-resizer-v" draggable="false"></div><div class="gm-legend-resizeRect"></div>',init:function AC(Ak){this.styles={};this.cutBy=null;this.dataArray=null;this.textDivs=[];this.dockedPositions=[{pos:n.LEFT_TOP},{pos:n.LEFT_MIDDLE},{pos:n.LEFT_BOTTOM},{pos:n.RIGHT_TOP},{pos:n.RIGHT_MIDDLE},{pos:n.RIGHT_BOTTOM}];var Al=Ak.placeholder,Aj=Al.style;if(Al){this.cssClass=Al.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(Ak.hasOwnProperty("width")===false){Ak.width=(Aj&&Aj.width)||Al.clientWidth;}if(Ak.hasOwnProperty("height")===false){Ak.height=(Aj&&Aj.height)||Al.clientHeight;}if(Ak.hasOwnProperty("left")===false){Ak.left=Al.offsetLeft;}if(Ak.hasOwnProperty("top")===false){Ak.top=Al.offsetTop;}}this._super(Ak);},setupScrollNodes:function M(){this.scrollNode=this.cbTableContainer;},getSplitterDockPos:function(){return(this.currDockedPositionIdx<3)?AM.RIGHT:AM.LEFT;},updateAlignClass:function(){var An=this.getDockedPosition(),Ao=An&&An.pos,Al=(Ao===n.RIGHT_MIDDLE||Ao===n.RIGHT_TOP||Ao===n.RIGHT_BOTTOM||Ao===n.RIGHT),Aj=this.domLegend,Ak=this.domNode,Am=this.resizeRect;if(Al){Ac.removeClass(Aj,"gm-align-left");Ac.addClass(Aj,"gm-align-right");Ac.toggleClass(Aj,"gm-legend-alignRight",true);Ac.toggleClass(Aj,"gm-legend-alignLeft",false);Ac.toggleClass(Ak,"gm-legend-alignRight",true);Ac.toggleClass(Ak,"gm-legend-alignLeft",false);Ac.toggleClass(Am,"gm-legend-alignRight",true);Ac.toggleClass(Am,"gm-legend-alignLeft",false);}else{Ac.removeClass(Aj,"gm-align-right");Ac.addClass(Aj,"gm-align-left");Ac.toggleClass(Aj,"gm-legend-alignRight",false);Ac.toggleClass(Aj,"gm-legend-alignLeft",true);Ac.toggleClass(Ak,"gm-legend-alignRight",false);Ac.toggleClass(Ak,"gm-legend-alignLeft",true);Ac.toggleClass(Am,"gm-legend-alignRight",false);Ac.toggleClass(Am,"gm-legend-alignLeft",true);}},postBuildRendering:function(){this._super();var Av=this.styles,Ax=this.domNode,Am=this.domLegend.childNodes,Aq=Am[1],Ao=Am[2],Aw=Am[3],A0={objType:AG.LEGEND};this.addSlots({lgdBtn:Am[0],triBtn:Am[0].firstChild,lgdName:Am[0].childNodes[1],closeBtn:Am[0].lastChild,cbContainer:Am[1],sepLine1:Aq.firstChild,cbTitle:Aq.childNodes[1],cbTableContainer:Aq.childNodes[2],cbTable:Aq.childNodes[2].firstChild,sb1Container:Ao,sepLine2:Ao.firstChild,sb1Title:Ao.childNodes[1],sb1MetricNamesTable:Ao.childNodes[2],sb1DataTable:Ao.childNodes[3],sb1Canvas:Ao.childNodes[4],sb2Container:Aw,sepLine3:Aw.firstChild,sb2Title:Aw.childNodes[1],sb2MetricNamesTable:Ao.childNodes[2],sb2DataTable:Aw.childNodes[3],sb2Canvas:Aw.childNodes[4],splitter:Am[4],resizeRect:Am[5]});Ad.GMLegend.applyHTML5Props(Av);this.bgColor=Av.background||Av.backgroundColor||"transparent";AO.applyStyle2Legend(Av,Ax,this.domLegend);if(mstrApp.isInVFInteractMode){this.closeBtn.style.visibility="hidden";}var Ap=this.getSplitterDockPos(),Az=this.width-2*A-2*Af,Ar=this.cbTitle,Ak=Ar.style,Al=this.sb1Title,An=this.sb2Title,Ay=Al.style,Aj=An.style,Au=this.sepLine1,At=this.sepLine2,As=this.sepLine3;Au.style.width=Az+w;At.style.width=Az+w;As.style.width=Az+w;Ak.lineHeight=H+w;Ay.lineHeight=H+w;Aj.lineHeight=H+w;Ak.maxHeight=2*H+w;Ay.maxHeight=2*H+w;Aj.maxHeight=2*H+w;Ar.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};Al.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};An.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};this.dockPos=Ap;this.identity=Ax.identity=A0;this.updateAlignClass();},feedData:function(Aj,Ak){this.dataArray=Aj;this.isMinimal=Ak;this.textDivs=[];Ad.GMLegend.applyHTML5Props(this.styles);this.autoCollapseLegend();if(Ak||this.autoCollapse){AU.call(this);this.draggable=false;}else{T.call(this);this.draggable=true;}p.call(this);this.updateScrollbars();},autoCollapseLegend:function(){this.autoCollapse=false;},updateColorBySquare:function(Al){var Am,An,Ak,Aj;if(Al){Aj=this.domNode.querySelectorAll(".gm-legend-colorbox-div");Am=Al.elements;An=Math.min(Am.length,Aj.length);for(Ak=0;Ak<An;Ak++){E.call(this,Am[Ak],Aj[Ak]);}}},updateContainerSize:function(Aj,Ak){this.GMW=Aj;this.GMH=Ak;this.calculateDockedPositions(Aj,Ak);},updateAfterResize:function(){Ad.GMLegend.applyHTML5Props(this.styles);var Ao=0,An=this.width,Ap=this.cbContainer,Ar=this.sb1Container,Al=this.sb2Container,Am=this.sepLine1,Ak=this.sepLine2,Aj=this.sepLine3,Aq=An-2*A-2*Af;P.forEach(this.dataArray||[],function(As){if(As.dataType===AY.COLOR_BY){if(As.dataObj){if(Ap){Ap.style.width=Aq+w;}}}else{if(As.dataType===AY.SIZE_BY){if(As.dataObj){Ao++;if(Ao===1&&Ar){Ar.style.width=Aq+w;}if(Ao===2&&Al){Al.style.width=Aq+w;}}}}});if(Am){Am.style.width=Aq+w;}if(Ak){Ak.style.width=Aq+w;}if(Aj){Aj.style.width=Aq+w;}this.domLegend.style.width=this.width+w;this.domLegend.style.height=this.height+w;},updateStyle:function(Aj){this.styles=Aj;this.bgColor=Aj.background||Aj.backgroundColor||"transparent";AO.applyStyle2Legend(Aj,this.domNode,this.domLegend);},updateTitleLineHeight:function(){var Ak=this.cbTitle,An=Ak.style,Al=this.sb1Title,Aj=this.sb2Title,Ao=Al.style,Am=Aj.style;Ad.GMLegend.applyHTML5Props(this.styles);An.lineHeight=H+w;Ao.lineHeight=H+w;Am.lineHeight=H+w;An.maxHeight=2*H+w;Ao.maxHeight=2*H+w;Am.maxHeight=2*H+w;},getSplitterPosition:function(Al){var Ak=Al.src.startPos+Al.tgt.pos.x-Al.src.pos.x,An=Al.src.posInfo,Am=An&&An.min,Aj=An&&An.max;if(Am!==undefined){Ak=Math.max(Ak,Am);}if(Aj!==undefined){Ak=Math.min(Ak,Aj);}return Ak;},positionResizeRect:function(Aj,Ak){var Am=Aj.src.posInfo.dockPosition===AM.LEFT,An=Ak-AQ,Ao=Am?An:0,Al=Am?this.width-An:An;this.resizeRect.style.left=(Ao-1)+w;this.resizeRect.style.width=(Al-2)+w;},updateLegendSlot:function(Am,Aj){var Al=this.getDockedPosition(),Ak=Al&&Al.pos;if(Ak!==Am){this.currDockedPositionIdx=Aj;this.dockPos=this.getSplitterDockPos();this.updateDropZonePosition();this.updateAlignClass();this.updateSplitter();this.widget.onLegendDropZoneChange(this.getDockedPosition());}},isDragValid:function q(Aj){return !mstrApp.isInVFInteractMode&&this._super(Aj);},ondragstart:function(Aj){var Al=Aj.src.e.target,Ak=Aj.src.data;if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(false);}if(Al===this.splitter){Aj.src.startPos=Al.offsetLeft;Aj.src.posInfo=this.getSplitterInfo(Al);this.positionResizeRect(Aj,Aj.src.startPos);Ac.addClass(this.resizeRect,"resizing");}else{this.cbTableScrollTop=this.cbTableContainer.scrollTop;this._super(Aj);if(!Ak||!Ak.isScrollBar){this.clearSelectedTargets();Ac.toggleClass(this.domNode,"gm-legend-hover",false);Ac.toggleClass(this.domLegend,"active",false);this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background=this.bgColor;this.isDragging=true;}}},ondragmove:function D(Aj){var Al=Aj.src.e.target,Ak;if(Al===this.splitter){Ak=this.getSplitterPosition(Aj);Al.style.left=Ak+w;this.positionResizeRect(Aj,Ak);}else{this._super(Aj);}},ondragend:function(Aj){var Al=Aj.src.e.target;if(Al===this.splitter){Ac.removeClass(this.resizeRect,"resizing");this.splitterMoved(this.getSplitterPosition(Aj)-Aj.src.startPos,Aj.src.posInfo);}else{this._super(Aj);var Ak=Aj.src.data;if(!Ak||!Ak.isScrollBar){this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background="transparent";this.isDragging=false;}delete this.cbTableScrollTop;}if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},onscroll:function(){var Ak,Ao,An=this.scrollNode.scrollTop,Am,Al,Aj;if(this.prevScrpllTop===An){return ;}Ao=(this.dataArray&&this.dataArray.length)||0;for(Ak=0;Ak<Ao;Ak++){Al=this.dataArray[Ak];if(Al.dataType===AY.COLOR_BY){Aj=Al.dataObj;break;}}if(Aj){Am=this.cbTable;Am.innerHTML="";Am.appendChild(this.fillColorByTable(Aj,Math.floor(An/AJ)));this.prevScrpllTop=An;this.scrollNode.scrollTop=An;this._super();}},fillColorByTable:function(Az,Ap){var A0,Ax,Al,Ao,An,Aq,Ar,As=this.styles,Aj,Av=this.cutBy,At=this.width-2*Af-2*A,Au,Am,Ak,A1,Aw,A2;Au=Az.elements;Ax=Au.length;Aj=document.createDocumentFragment();Am=At-x-AV;Ak=0;A1=AJ*Ax;Aw=Ap*AJ;function Ay(A3){Al=document.createElement("tr");Ao=document.createElement("td");Al.style.height=A3+w;Ao[z]("class","gm-legend-colorbox");Al.appendChild(Ao);Aj.appendChild(Al);}if(Ap>0){Ay(Aw);}for(A0=Ap;A0<Ax;A0++){Al=document.createElement("tr");Ao=document.createElement("td");An=document.createElement("td");Aq=document.createElement("div");Ar=document.createElement("div");Aq[z]("class","gm-legend-colorbox-ctn-div");Aq[z]("type",C.LGD_COLORBOX_CTN);Ar[z]("class","gm-legend-colorbox-div");Ar[z]("type",C.LGD_COLORBOX);E.call(this,Au[A0],Ar);Al[z]("class","gm-legend-tr");Al.style.height=AJ+w;Ao[z]("class","gm-legend-colorbox");An[z]("class","gm-legend-desc");A2=Au[A0];if(A2.bftp){a.fillImageInDiv(An,A2.bftp,A2.label,"gm-img-legend");}else{y.call(this,An,A2.label,A0,u,Am,As);}Aq.appendChild(Ar);Ao.appendChild(Aq);Al.appendChild(Ao);Al.appendChild(An);Aj.appendChild(Al);Ak+=AJ;if(Av&&(Av+Ak-AJ)>A1){Ay(A1-Ak-Aw);break;}}return Aj;},calculateDockedPositions:function(Ak,An){var Am,Ap=this.getWidth(),Aj=this.getHeight(),Al=this.dockedPositions,Ao=function(Aq){switch(Aq.pos){case j.LEFT_TOP:Aq.x=0;Aq.y=W;break;case j.LEFT_MIDDLE:Aq.x=0;Aq.y=Math.max(W,(An-Aj)>>1);break;case j.LEFT_BOTTOM:Aq.x=0;Aq.y=Math.max(0,An-Aj-W);break;case j.RIGHT_TOP:Aq.x=Ak-Ap;Aq.y=W;break;case j.RIGHT_MIDDLE:Aq.x=Ak-Ap;Aq.y=Math.max(W,(An-Aj)>>1);break;case j.RIGHT_BOTTOM:Aq.x=Ak-Ap;Aq.y=Math.max(0,An-Aj-W);break;}};for(Am=0;Am<Al.length;Am++){Ao(Al[Am]);}this.updateDropZonePosition();},updateDropZonePosition:function(){var Aj=this.getDockedPosition(),Ak=this.dropZoneNode.style;Ak.left=Aj.x+w;Ak.top=Aj.y+w;},updateDropZoneNode:function(Aj){this._super(Aj);this.dockPos=this.getSplitterDockPos();this.updateSplitter();},onmouseover:function(Aj){var Al=this.domLegend,Ap=Aj.getTarget(),Am=Ap.getAttribute("type"),Ao=this.widget,Ak;if(this.isDragging){return ;}var An=S.copy(this.styles);An.opacity+=0.4;AO.applyStyles2DomNode(this.domNode,An);if(AA.contains(Al,Ap,true)){Ac.addClass(Al,"active");}if(Am===C.LGD_COLORBOX){Ap=Ap.parentNode;Am=Ap.getAttribute("type");}if(Am===C.LGD_COLORBOX_CTN){Ak=Ap.firstChild.identity;if(!Ak||!Ak.comb){return ;}Ac.toggleClass(Ap,"hover-colorsquare",true);return ;}if(Ao.formattingMode){switch(Am){case C.LGD_TITLE:case C.LGD_TEXT:Ac.toggleClass(Al,"hover-txt",true);break;default:Ac.toggleClass(this.domNode,"gm-legend-hover",true);break;}}},onmouseout:function(Ak){var Am=this.domLegend,Aj=Ak.e.toElement||Ak.e.relatedTarget,Ap=Ak.getTarget(),An=Ap.getAttribute("type"),Ao=this.widget,Al;AO.applyStyles2DomNode(this.domNode,this.styles);if(!AA.contains(Am,Aj,true)){Ac.removeClass(Am,"active");}if(An===C.LGD_COLORBOX){Ap=Ap.parentNode;An=Ap.getAttribute("type");}if(An===C.LGD_COLORBOX_CTN){Al=Ap.firstChild.identity;if(!Al||!Al.comb){return ;}Ac.toggleClass(Ap,"hover-colorsquare",false);return ;}if(Ao.formattingMode||Ao.isOnFormattingMode){switch(An){case C.LGD_COLORBOX_CTN:case C.LGD_COLORBOX:break;case C.LGD_TITLE:case C.LGD_TEXT:Ac.toggleClass(Am,"hover-txt",false);break;default:Ac.toggleClass(this.domNode,"gm-legend-hover",false);break;}}},onclick:function(Aj){var Am=Aj.getTarget(),Ak=Am.getAttribute("type"),Al=this.widget;if(Am===this.triBtn){if(!this.autoCollapse){this.raiseEvent({name:"gm-legend-clicked",action:(this.isMinimal?"restore":"minimize")});}}else{if(Am===this.closeBtn){this.raiseEvent({name:"gm-legend-clicked",action:"close",mousePos:Aj.e});}else{if(Ak===C.LGD_COLORBOX){Am=Am.parentNode;Ak=Am.getAttribute("type");}if(Al.formattingMode||Al.isOnFormattingMode){if(Ak===C.LGD_COLORBOX_CTN){this.selectColorBox(Am,true);}else{if(Ak===C.LGD_TEXT||Ak===C.LGD_TITLE){this.selectText();}else{this.selectLegendBody();}}}else{this.clearSelectedColorBox();}}}AA.stopPropogation(null,Aj.e);},attachClearEvent:function(){if(this.clearSelectTargetfn){return ;}var Ak=this,Aj=this.domLegend;this.clearSelectTargetfn=function(Ao){var An=Ao.target,Al=Ak.widget.toolEditor,Am;if(!AA.contains(Aj,An,true,Aj)){if(Al){Am=Al.domNode;if(!AA.contains(Am,An,true,Am)){Ak.clearSelectedTargets();}}else{Ak.clearSelectedTargets();}}};AA.attachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);},clearSelectedColorBox:function(){var Aj=this.selectedColorBox;if(Aj){Ac.toggleClass(Aj,"select",false);Ac.toggleClass(Aj,"selectfmt",false);this.selectedColorBox=undefined;}},clearSelectedText:function(){Ac.removeClass(this.domNode,"select-txt");},clearSelectedLegendBody:function(){Ac.removeClass(this.domNode,"gm-legend-select");},clearSelectedTargets:function(){this.clearSelectedColorBox();this.clearSelectedText();this.clearSelectedLegendBody();if(this.clearSelectTargetfn){AA.detachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);delete this.clearSelectTargetfn;}},selectColorBox:function(Al,Ak){var Aj=Al.firstChild.identity;if(!Aj||!Aj.comb){return ;}this.clearSelectedText();this.clearSelectedLegendBody();if(this.selectedColorBox!==Al){this.clearSelectedColorBox();this.selectedColorBox=Al;if(Ak){Ac.toggleClass(Al,"selectfmt",true);}else{Ac.toggleClass(Al,"select",true);}this.attachClearEvent();}},selectText:function(){this.clearSelectedColorBox();this.clearSelectedLegendBody();Ac.addClass(this.domNode,"select-txt");this.attachClearEvent();},selectLegendBody:function(){this.clearSelectedColorBox();this.clearSelectedText();Ac.addClass(this.domNode,"gm-legend-select");this.attachClearEvent();},adjustColorPickerPos:function(Aj){var Am=AA.position(Aj),Ak=0,Al={};if(this.currDockedPositionIdx<3){Al.x=Am.x+Am.w+Ak;Al.alignLeft=true;}else{Al.x=Am.x-Ak;Al.alignLeft=false;}Al.y=Am.y+Am.h+Ak;return Al;},getSplitterInfo:function(Ao){if(!Ao){return{};}var Ak=this.dockPos,An={},Am=this.width,Aj=AK,Al=Math.floor(this.GMW/3);An.dockPosition=Ak;if(Ak===AM.LEFT){An.min=Math.min(Am-Al,0);An.max=Math.max(Am-Aj,0);}else{if(Ak===AM.RIGHT){An.min=Aj;An.max=Al;}}An.min+=AQ;An.max+=AQ;return An;},splitterMoved:function(Aj,Ak){if(Aj===0){return ;}if(Ak.dockPosition===AM.LEFT){Aj=-Aj;}this.raiseEvent({name:"gm-legend-resized",position:Aj});this.updateSplitter();if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},updateSplitter:function(){AS(this.splitter,this.dockPos,this.width,this.height);this.resizeRect.style.height=this.height-2+w;}});Ad.GMLegend.IMAGE_SIZE_FIXED=0;Ad.GMLegend.applyHTML5Props=function(Al){var Am=parseInt(Al.fontSize,10)||8,Ak;if(Al.fontSize.indexOf("px")>=0){Am=Math.floor(Am*Z+0.5);}Ak=Math.floor(Am/Z*F+0.5);H=Math.max(Am,8)+9;AT=Math.floor(Am/Z+0.5);e=Math.max(Ak,15);AJ=Ad.GMLegend.IMAGE_SIZE_FIXED||(Math.max(Ak,20)+2);s=Math.max(Ak,14)+2;Af=parseInt(Al.borderWidth,10)||1;var Aj=parseInt(Al.tbHeight,10);l=isNaN(Aj)?K:Aj;};Ad.GMLegend.getLegendSize4MinMode=function(Ak,Al){var An,Am,Aj=l+2*Af;if(Ak){Am=Ak.elements;An=Am.length;Aj+=AJ*An;Aj+=2*A;}Aj=Math.min(Aj,Al-W*2);return{width:x+5+7+2*Af,height:Aj};};Ad.GMLegend.getLegendSize=function(Ax,Am,Aj,Ap,Az,Aq){var Ar,Ak,Ay,Ao,An=Ap-W*2,Av=0,Al=0,Au={},At,As,Aw;if(!Ax||!Ax.length||Ax.length<1){return{};}if(Am!==undefined){if(!Aq){Aq=Math.floor(Ab(Ax,Az)*Am);}Ao=Math.min(Aq,Math.floor(Aj/3));Ao=Math.max(Ao,50);return i(Ax,Ao,Ap,Az);}Ao=Math.min(Math.floor(0.2*Aj),300);for(Ar=0;Ar<Ax.length;Ar++){As=Ax[Ar];if(As.dataType===AY.COLOR_BY){At=Aa(As.dataObj,Az);if(At>Av){Av=At;}}else{if(As.dataType===AY.SIZE_BY){At=AP(As.dataObj,Az);if(At>Al){Al=At;}}}}Ak=Math.max(Av,Al)+2*Af;Au.width=Math.min(Ak,Ao);Au.scale=Au.width/Ak;Aw=d(Ax,Au.width,Az);Ay=Aw.height;Au.autoCollapse=Aw.minHeight>An;Au.minHeight=Aw.minHeight;Au.height=Math.min(Ay,An);if(Ay>An){Au.cutBy=Ay-An;}return Au;};}());(function(){if(!window.env){window.env={};}var j=window.env;j.isDebugging=false;var z=j.isDebugging;function I(Ae){if(z){AI.visPrint(Ae);}}mstrmojo.requiresCls("mstrmojo.css","mstrmojo.array","mstrmojo.num","mstrmojo.hash","mstrmojo.color","mstrmojo.dom","mstrmojo.Base","mstrmojo.Container","mstrmojo.Label","mstrmojo.VisBase","mstrmojo.ui.Pulldown","mstrmojo.VisMenuList","mstrmojo.VisMenuHierarchicalList","mstrmojo._VizSelectionHelper","mstrmojo._LoadsScript","mstrmojo.VisUtility","mstrmojo.VisEnum","mstrmojo.chart.common.Utility","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui._IsDropTarget","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.util.color","mstrmojo.PerformanceLogOutput");mstrmojo.requiresClsP("mstrmojo.ui.menus","MenuConfig","_HasMenuPopup","EditorConfig");mstrmojo.requiresClsP("mstrmojo.gm","GMLegend","GMUtility","EnumLegendSlot","_SupportDndAsBlackBox");mstrmojo.requiresClsP("mstrmojo.netviz","_SupportNetworkBrushesAndHighlights","VisNetworkStage","ObservableModel","PropertyParser","_ForceDirectedLayout","_CircularLayout","_LinearLayout");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights","_XtabDE");var AV={lgdBgFillClr:[15461355,1710618],lgdBgFillStyle:[0,0],lgdBgFillEff:[1,1],lgdBgFillTrans:[0,100],lgdFntSz:["8pt","8pt"],lgdFntFml:["Arial","Arial"],lgdFntStyle:[0,0],lgdFntClr:[6710886,16777215],lgdBdrShw:[false,false],lgdBdrClr:[11579568,5855577],lgdBdrThk:["1px","1px"],lgdBdrLnStyle:[0,0],lm:[0,0],lwr:[undefined,undefined]};function AK(Ae){var Af={};mstrmojo.hash.keyarray(AV).forEach(function(Ag){Af[Ag]=AV[Ag][Ae];});return Af;}var e=mstrmojo,AU=e.dom,AI=e.VisUtility,Aa=e.num,R=e.array,V=e.hash,AP=e.netviz.ObservableModel,AB=e.util.color,Ab=e.gm,T=Ab.GMLegend,g=5,o=Ab.EnumLegendSlot,AW=e.VisEnum.GMLegendDataType,G=e.chart.enums.EnumFontStyle,AX=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,Y=e.VisEnum,AS=Y.LegendPropertyTag,AL=Y.EnumLegendMode,y=mstrmojo.vi.enums.EnumFeatures,AO=Ab.GMUtility,v=e.PerformanceLogOutput,AH=Y.NETWORK_AGGREGATION_METHOD,AF=Y.NETWORK_PROPERTIES,m=Y.NETWORK_LAYOUT,A=mstrmojo.vi.viz.EnumDSSDropZones,b=mstrmojo.chart.model.enums.EnumDSSObjectType,d=Y.NETWORK_MAX_NODE_SIZE_TYPE,AC=Y.NETWORK_MIN_NODE_SIZE_TYPE;var X=24,u=24,S=76,P=28;var r=[{pos:o.LEFT_TOP},{pos:o.LEFT_MIDDLE},{pos:o.LEFT_BOTTOM},{pos:o.RIGHT_TOP},{pos:o.RIGHT_MIDDLE},{pos:o.RIGHT_BOTTOM}];var AQ=0.5;var Ad=Y.SERVER_JSON_ERROR_TYPE;var H=[m.CIRCULAR,m.LINEAR,m.FORCE_DIRECTED];var N=50;var AR=4;var Z=0.2;var k={};k[d.AUTOMATIC]={"size-by":0.9,"no-size-by":0.08};k[d.MANUAL]={"size-by":0.5,"no-size-by":0.16};var E=["click","contextmenu","mouseup"];function AJ(Al,Ai){function An(Av){var At=Ak.getDropZone();var Au={from:A.FromItem,to:A.ToItem};var Aw;Object.keys(Au).some(function(Ax){var Ay=Ax+".TemplateUnit.0.id";if(AI.getPropertyByPath(At,Ay)===Av){Aw=Au[Ax];return true;}return false;});return Aw;}var Ak=this,Ap={act:"updateTemplate",keyContext:Ak.k,actions:[]},Af=Ap.actions,As=[AI.pick(Al,["did","t"])];var Ag=Ai.drillFromUnit.id;var Ah=An(Ag);if(Ah===undefined){return Ap;}var Ao={id:Ah},Am=Ak.zonesModel,Aj=Am.getZoneModelByZoneId(Ah),Ar=Aj.items||[],Aq;var Ae=AI.findInArray(Ar,function(At){return At.did===Ag;});if(Ae!==-1){Aq=Ar[Ae];}if(Aq){Array.prototype.push.apply(Af,Am.getRemoveDropZoneUnitActions(Ao,Aq));Array.prototype.push.apply(Af,Am.getAddDropZoneUnitsActions(Ao,As,Aq.idx));}return Ap;}function D(){var Ae=this.propInfo.layoutMode,Af=H[Ae];if(Af===m.LINEAR){this.inputLinearIcon.checked=true;}else{if(Af===m.CIRCULAR){this.inputCircularIcon.checked=true;}else{if(Af===m.FORCE_DIRECTED){this.inputForceDirectedIcon.checked=true;}}}}function s(Ag){var Ae,Af=r.length;for(Ae=0;Ae<Af;Ae++){if(Ag===r[Ae].pos){return Ae;}}return -1;}function M(Ae,Af){if(isNaN(Ae)){return"rgba(0,0,0,1)";}Ae=parseInt(Ae,10);if(isNaN(Af)){Af=1;}return AB.getCSSColorString(Ae,Af);}function AZ(Ae){var Af=0;R.forEach(Ae,function(Ah){var Ag=parseFloat(Ah);if(!isNaN(Ag)){Af+=Ag;}});return Af;}var l={COUNT:"Count of",SUM:"Sum of",AVERAGE:"Average of",MIN:"Min of",MAX:"Max of"};var C={};C[l.COUNT]=function(Ae){return Ae.length;};C[l.SUM]=AZ;C[l.AVERAGE]=function(Af){var Ae=Af.length;return(Ae>0?AZ(Af)/Ae:NaN);};C[l.MIN]=function(Ag){var Ae=Ag.length,Ai,Ah,Af;if(Ae<1){return NaN;}Ai=Ag[0];for(Ah=1;Ah<Ae;Ah++){Af=Ag[Ah];if(Ai>Af){Ai=Af;}}return Ai;};C[l.MAX]=function(Ah){var Af=Ah.length,Ae,Ai,Ag;if(Af<1){return NaN;}Ae=Ah[0];for(Ai=1;Ai<Af;Ai++){Ag=Ah[Ai];if(Ae<Ag){Ae=Ag;}}return Ae;};function AY(Aj){if(!this.range||!this.sizeRange){I("No value range or size range available, cannot calculate size.");return 0;}var Af=this.range,Ah=this.sizeRange,Ae=Math.max(Af.max,Af.min*Ah.max/Ah.min);var Ai=Ae-Af.min||Infinity;var Ag=(Aj-Af.min)/Ai*(Ah.max-Ah.min)+Ah.min;if(isNaN(Ag)){I("something wrong in linear interpolation");Ag=0;}return Ag;}function f(){var Ae=this.stage;if(Ae){if(Ae.parent!==undefined){this.removeChildren(Ae);}Ae.destroy();delete this.stage;}}var Ac=0;var AT=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.VisNetwork.Node",init:function(Ae){this.adjacence=[];this.edges=[];this.properties={};this.range={};this.attribute={};this.attributeElements=[];this.aggregationName=0;this.aggregationMethod=null;this.itemSizeMetricName=null;this.size=0;this.style=null;this._super(Ae);this.id="x"+(++Ac);},getAttributeName:function(){return this.hasSelfLoop?"Name":this.attribute&&this.attribute.name;},getName:function i(){var Ae="";R.forEach(this.attributeElements||[],function(Af){Ae+=(Af.name+" ");});return Ae.slice(0,Ae.length-1);},getFormNames:function(){var Ae=[];R.forEach(this.attribute.forms,function(Af){Ae.push(Af.name);});return Ae;},getFormValues:function(){var Ae=[];R.forEach(this.attributeElements,function(Af){Ae.push(Af.name);});return Ae;},setAggregationMethod:function(){var Ae=l.SUM;this.aggregationMethodName=(this.properties&&this.properties.nodeSizeAggregation)||Ae;if(!AH.hasOwnProperty(this.aggregationMethodName)){this.aggregationMethodName=Ae;}this.aggregationMethod=C[this.aggregationMethodName];},getAggregatedValue:function(){if(!this.aggregationMethod){this.setAggregationMethod();}var Ag=this.edges,Af=[],Ah,Ae;this.aggregationName=this.aggregationMethodName+" "+(this.itemSizeMetricName||"");if(this.itemSizeMetricName!==null){for(Ah=0,Ae=Ag.length;Ah<Ae;Ah++){var Ai=Ag[Ah];if(Ai&&Ai.itemSizeValue&&!Ai.isExcluded&&!isNaN(Ai.itemSizeValue)){Af.push(Ai.itemSizeValue);}}return this.aggregationMethod(Af);}return 0;},getSize:function(){if(isNaN(this.aggregatedValue)){this.aggregatedValue=this.getAggregatedValue();}return this.valueToSize(this.aggregatedValue);},valueToSize:function(Al){var Af=this.getNodeSizeRange();var Aj=this.range;var Ag=Af.min,Ak=Af.max,Ai=Aj.min,An=Aj.max,Ae=Af.area;var Am,Ah;if(Ai===An){Am=Ak;}else{Ah=(Al-Ai)/(An-Ai);if(Ae){Ah=Math.sqrt(Ah);}Am=Ag+(Ak-Ag)*Ah;}return Am;},getNodeSizeRange:function(){var Ah=this.properties;var Aj=this.range;var Ag=Ah.maxNodeSize;var Ak=Ah.minNodeSize;var An=Aj.max,Ai=Aj.min,Ao=false,Al=N,Af=AR;var Am,Ae;if(this.isMetricSizeBy){switch(Ak.type){case AC.PROPORTIONAL:Am=Ag.ratio*Al;if(An===0){Ae=Af;}else{Ae=Am*Math.sqrt(Ai/An);}Ao=true;break;case AC.FULL_RANGE:Am=Ag.ratio*Al;Ae=Af;break;case AC.ADJUSTED_RANGE:Am=Ag.ratio*Al;Ae=Am*Ak.ratio;break;default:Am=Ag.ratio*Al;Ae=Af;break;}}else{Am=Al*Ag.ratio;Ae=Am;}if(Am<Af){Am=Af;}if(Am>Al){Am=Al;}if(Ae<Af){Ae=Af;}return{min:Ae,max:Am,area:Ao};},updateValues:function(){var Ae=this.getAggregatedValue();if(!isNaN(Ae)){if(this.itemSizeMetricName!==undefined&&this.itemSizeMetricName!==null&&this.properties.minNodeSize.type===AC.PROPORTIONAL){if(Ae<0&&Math.abs(Ae)<this.range.min){this.range.minNegtive=true;}if(Ae<0&&Math.abs(Ae)>this.range.max){this.range.maxNegtive=true;}Ae=Math.abs(Ae);}this.aggregatedValue=Ae;this.range.min=Math.min(this.range.min,Ae);this.range.max=Math.max(this.range.max,Ae);}},updateStyles:function(){this.size=this.getSize();},update:function(){this.updateValues();this.updateStyles();},exclude:function(){this.isExcluded=true;this.sprite.isExcluded=true;var Am=this.edges,Ai=Am.length,Ag=this.adjacence,Ae=Ag.length,An;for(An=0;An<Ai;An++){var Ao=Am[An];Ao.isExcluded=true;Ao.sprite.isExcluded=true;}for(An=0;An<Ae;An++){var Aj=Ag[An],Ah=0,Ak=Aj.edges,Af=Ak.length,Al;for(Al=0;Al<Af;Al++){if(!Ak[Al].isExcluded){Ah++;}}if(Ah===0){Aj.isExcluded=true;Aj.sprite.isExcluded=true;}Aj.update();}},format:function(Ag){if(this.edges&&this.edges.length){var Af=this.edges[0];var Ae;if(this.aggregationMethodName===l.COUNT){Ae=null;}else{if(Af&&Af.values[Af.indexes.nodeSizeMIndex]){Ae=Af.values[Af.indexes.nodeSizeMIndex].formatString;}else{Ae=null;}}return Aa.formatByMask(Ae,Ag);}return Ag.toString();},getActionInfo:function(){var Af=[],Ae=this;R.forEach(Ae.attributeElements,function(Ag){Af.push({n:Ae.attribute.name,tid:Ae.attribute.id,v:Ag.name,eid:Ag.id});});return Af;}});var J=[13376797,16734244,16749895,16762209,6672939];J.MISSING=5066061;J.FIRST_PALETTE_COLOR=2062260;var p=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.VisNetwork.Edge",sizeRange:{min:1,max:16},valueToWidth:AY,init:function(Ae){this.from=null;this.to=null;this.values=[];this.indexes={};this.properties={};this.range={};this.colorValueRange={};this.sizeValue=0;this.colorValue=0;this.itemSizeValue=0;this.width=0;this.color=0;if(this._super){this._super(Ae);}},update:function(){this.updateValues();this.updateStyles();},updateValues:function(){if(!this.values){return ;}var Ae=this.values[this.indexes.edgeColorMIndex],Af=this.values[this.indexes.edgeSizeMIndex],Ag=this.values[this.indexes.nodeSizeMIndex];this.colorValue=Ae?parseFloat(Ae.value):"missing";this.sizeValue=Af?parseFloat(Af.value):"missing";this.itemSizeValue=Ag?parseFloat(Ag.value):"missing";if(!isNaN(this.sizeValue)){this.range.min=Math.min(this.sizeValue,this.range.min);this.range.max=Math.max(this.sizeValue,this.range.max);}if(!isNaN(this.colorValue)){this.colorValueRange.min=Math.min(this.colorValue,this.colorValueRange.min);this.colorValueRange.max=Math.max(this.colorValue,this.colorValueRange.max);}},updateStyles:function(){this.width=this.valueToWidth(this.sizeValue);},format:function(Ag,Af){var Ae=(this.values[Af]&&this.values[Af].formatString)||null;return Aa.formatByMask(Ae,Ag);}});function K(Ak,Ag){var Am=mstrmojo.netviz.PropertyParser,Af=Am.BooleanProperty,Al=Am.IntegerProperty,Ah=Am.FloatProperty,Ae=Am.StringProperty,Aj=Am.JsonProperty;var Ai={showLegend:{key:AF.showLegend,type:Af.preset(true)},showEdgeDirection:{key:AF.showEdgeDirection,type:Af.preset(false)},showTransition:{key:AF.showTransition,type:Af.preset(false)},nodeSizeAggregation:{key:AF.nodeSizeAggregation,type:Ae.preset(l.SUM)},minNodeSize:{key:AF.minNodeSize,type:Aj.preset({type:AC.PROPORTIONAL}),postSet:function(Ap,Aq,An,Ao){if(Ap.type!==AC.ADJUSTED_RANGE){Ap.ratio=AR/N;}else{if(Ap.ratio===undefined){Ap.ratio=Z;}}return Ap;}},maxNodeSize:{key:AF.maxNodeSize,type:Aj.preset({type:d.AUTOMATIC}),postSet:function(Aq,Ar,An,Ao){var Ap=Ak.hasSizeByMetric()?"size-by":"no-size-by";if(Aq.type===d.AUTOMATIC||Aq.type===d.MANUAL&&Aq.ratio===undefined){Aq.ratio=k[Aq.type][Ap];}return Aq;}},themeType:{key:AF.themeType,type:Ae.preset("light"),preSet:function(Ap,Aq,An,Ao){return(parseInt(Ap,10)===0)?"dark":"light";}},background:{key:AF.background,type:Aj.preset({})},circleStyle:{key:AF.bubbleStyle,type:Aj.preset({}),postSet:function(Aq,Ar,Ao,Ap){var An=Ao.shownodelabel;if(Aq.showNodeLabel===undefined){Aq.showNodeLabel=!!(An!==undefined&&An.toString()==="true");}return Aq;}},circleLabelStyle:{key:AF.circleLabelFont,type:Aj.preset({})},layoutMode:{key:AF.layoutMode,type:Al.preset(0)},dragMode:{key:AF.dragMode,type:Al.preset(Y.NETWORK_DRAG_MODE.pan)},lgdBgFillClr:{key:AX.LEGEND_BG_COLOR,type:Aj.preset(undefined)},lgdBgFillStyle:{key:AX.LEGEND_BG_FILL_STYLE,type:Ae.preset(undefined)},lgdBgFillEff:{key:AX.LEGEND_BG_FILL_EFFECT,type:Ae.preset(undefined)},lgdBgFillTrans:{key:AX.LEGEND_BG_FILL_TRANSPARENCY,type:Ae.preset(undefined)},lgdFntSz:{key:AX.LEGEND_FONT_SIZE,type:Ae.preset(undefined)},lgdFntFml:{key:AX.LEGEND_FONT_FAMILY,type:Ae.preset(undefined)},lgdFntStyle:{key:AX.LEGEND_FONT_STYLE,type:Al.preset(undefined)},lgdFntClr:{key:AX.LEGEND_FONT_COLOR,type:Al.preset(undefined)},lgdBdrShw:{key:AX.LEGEND_BORDER_SHOW,type:Af.preset(undefined)},lgdBdrClr:{key:AX.LEGEND_BORDER_COLOR,type:Ae.preset(undefined)},lgdBdrStyle:{key:AX.LEGEND_BORDER_LINE_STYLE,type:Ae.preset(undefined)},lm:{key:AS.LEGEND_MODE,type:Al.preset(undefined)},LegendPosition:{key:AS.LEGEND_POSITION,type:Al.preset(2)},lwr:{key:AS.SCALE_LEGEND_WIDTH,type:Ah.preset(undefined)}};return new Am().parse(Ag,Ai);}function AN(Ae){function Af(Ai){var Ag=Ae[Ai],Ah=Ag&&(Ag.TemplateUnit||Ag.TemplateMetric);return(Ah&&Ah[0])||{};}return{edgeColor:Af("ColorBy"),edgeSize:Af("SizeBy"),itemSize:Af("itemsz"),from:Af("from"),to:Af("to")};}var AE=["at","dei","dpt","o","tui","ui"];function W(Bo,BV,Aj){BV=BV||{};BV.nodeValueRange=BV.nodeValueRange||{min:Infinity,max:-Infinity};BV.edgeValueRange=BV.edgeValueRange||{min:Infinity,max:-Infinity};BV.edgeColorValueRange=BV.edgeColorValueRange||{min:Infinity,max:-Infinity};BV.circleStyle.fromNode.shape=BV.circleStyle.fromNode.shape||"Circle";BV.circleStyle.toNode.shape=BV.circleStyle.toNode.shape||"Circle";var Ai=[],BA=[],Bl=[],BR=[],Bk={};var At=Aj.edgeColor.id,Ao=Aj.edgeSize.id,Bf=Aj.itemSize.id,BW=Aj.from.id,Aw=Aj.to.id;var A2={nodes:Ai,edges:BA,nodesIdHash:Bk,attributes:Bl,metrics:BR,indexes:{edgeColorMIndex:-1,edgeSizeMIndex:-1,nodeSizeMIndex:-1,fromIndex:-1,toIndex:-1},modifiedNodes:[],formNameDisplayType:Bo.lnm};var Be=this.model;function Bp(B3,B4,B2){return new AT({attribute:B3,attributeElements:B4,adjacence:[],edges:[],properties:BV,range:BV.nodeValueRange,isMetricSizeBy:Bf!==undefined,attSrc:B3.id===B2?"from":"to",shape:B3.id===B2?BV.circleStyle.fromNode.shape:BV.circleStyle.toNode.shape});}function BL(B4,B3,B2){return new p({from:B4,to:B3,values:[],indexes:B2,properties:BV,range:BV.edgeValueRange,colorValueRange:BV.edgeColorValueRange});}var Ba=Bo.gts.row;var BY=Bo.gts.col;var Bi=Bo.ghs.rhs.items;var BI=Bo.gvs.items||[];var Aq={};var Ar=true,Ak;R.forEach(Ba,function(B5,B4){AI.restoreEsForUnit(B5);var B6=[],B2=[],B3;R.forEach(B5.es,function(B7){B6.push({id:B7.id,name:B7.n});});R.forEach(B5.fs,function(B7){B2.push({name:B7.n});});Ak=Be.supportsViewFilterActions(B5.id);Ar=Ar&&Ak;B3={id:B5.id,name:B5.n,elements:B6,supportsViewFilter:Ak,forms:B2,formsLength:(B5.fs&&B5.fs.length)||1};if(B5.sc!==undefined){B3.sc=B5.sc;}Bl.push(B3);Aq[B5.id]=B4;});A2.allSupportsViewFilter=Ar;var Bg=(Bo.gsi&&Bo.gsi.mx)||[];try{R.forEach(Bg,function(B2,B3){BR.push({id:B2.did,name:B2.n,formatString:AI.getNumberFormat(Bo,B3)||""});Aq[B2.did]=B3;});}catch(B1){mstrmojo.err(B1);}var BT=A2.indexes;BT.edgeColorMIndex=Aq[At];BT.edgeSizeMIndex=Aq[Ao];BT.nodeSizeMIndex=Aq[Bf];BT.fromIndex=Aq[BW];BT.toIndex=Aq[Aw];var As=[];if(BT.edgeColorMIndex!==undefined){var A8=Bo.gsi&&Bo.gsi.thresholds[BR[BT.edgeColorMIndex].id],BJ;if(A8!==undefined&&A8.length>0){for(BJ=0;BJ<A8.length;BJ++){if(A8[BJ].fmt&&A8[BJ].fmt.bc){As[BJ]=mstrmojo.VisUtility.parseCSSColor(A8[BJ].fmt.bc);}else{As[BJ]=J.FIRST_PALETTE_COLOR;}}}}var A3={max:-Infinity,min:Infinity};if(AI.isOnExpressMode()){var BE=BT.edgeColorMIndex;R.forEach(BI,function(B3){var B2=B3&&B3.items&&B3.items[BE];if(B2){A3.max=Math.max(A3.max,B2.rv);A3.min=Math.min(A3.min,B2.rv);}});}var BC={},Ah={};var BQ,BP,BN,BM,A7,Bs,Au,Bd,Bn,An,B0,BD,Bv,Af,Bb,Bx,Bt,A9,Am,A0,BX,Ag=(Bi&&Bi.length)||0,BB=(Ba&&Ba.length)||0,BO=AE.length;for(BQ=0;BQ<Ag;++BQ){Bn=Bi[BQ].items;An=Bn.length;B0=[];Bs=1;A7=0;for(BP=0;BP<BB;BP++){if(BP!==BT.fromIndex&&BP!==BT.toIndex){B0.push(null);continue;}BD=Bl[BP];Bv=BD.elements;Af=[];Bb="";Au=BD.cs?BD.cs:1;Bs=BD.formsLength;A0=[];for(BN=0,Bd=Math.max(Au,Bs);BN<Bd;BN++){if(Bn[A7]&&Bn[A7].tui===BP){A9=Bn[A7];Bx=Bv[A9.idx];A7++;if(A0.indexOf(Bx)===-1){for(BM=0;BM!==BO;BM+=1){Am=AE[BM];Bx[Am]=A9[Am];}Bb+=Bx.name;A0.push(Bx);Af.push(Bx);}}}if(!BC[Bb]){BX=Bp(BD,Af,BW,Aw);BC[Bb]=Bk[BX.id]=BX;Ai.push(BX);}else{Bt=BC[Bb];if(Bt.attSrc==="to"&&BP===0){Bt.attSrc="from";Bt.shape=BV.circleStyle.fromNode.shape;}if(Bt.attribute!==BD){Bt.hasSelfLoop=true;Bt.secondaryAttribute=BD;Bt.secondaryAttributeElements=Af;}}B0.push(BC[Bb]);}var Bm=B0[BT.fromIndex],BS=B0[BT.toIndex];try{if(Bm&&BS){var Az=BL(Bm,BS,A2.indexes),BF=Az.from.id+Az.to.id,A1=Az.to.id+Az.from.id,By,A4=BI[BQ]?BI[BQ].items:[];if(A4!==null){var Bh=BR.length;for(BP=0;BP<Bh;++BP){var Ay={},Bj=BR[BP],A5=A4[BP];Ay.metricName=Bj.name;Ay.value=A5.rv;Ay.formatString=Bj.formatString;Az.values[BP]=Ay;if(BT.edgeColorMIndex!==undefined&&BT.edgeColorMIndex===BP&&As.length>0){var Bc=A5.ti;if(Bc===undefined&&AI.isOnExpressMode()){var BK,Ax=A3.max,Bz=A3.min,Br=A5.rv;if(Ax===Bz){BK=0;}else{BK=(Br-Bz)/(Ax-Bz);}if(BK<0.1){Bc=0;}else{if(BK>=0.1&&BK<0.3){Bc=1;}else{if(BK>=0.3&&BK<0.5){Bc=2;}else{if(BK>=0.5&&BK<0.7){Bc=3;}else{if(BK>=0.7&&BK<0.9){Bc=4;}else{if(BK>=0.9){Bc=5;}}}}}}}Az.color=M(As[Bc],AQ);}}if(BT.edgeColorMIndex===undefined||As.length===0){Az.color=M(J.MISSING,AQ);}}if(Ah[BF]){var BU=Ah[BF],BZ=Az.values||[],Ap=BZ.length,Al;for(Al=0;Al<Ap;Al++){BU.values[Al].value+=BZ[Al].value;}}else{By=Ah[A1];if(By){Az.reversedEdge=By;By.reversedEdge=Az;}Ah[BF]=Az;BA.push(Az);Bm.adjacence.push(BS);Bm.edges.push(Az);if(Bm!==BS){BS.adjacence.push(Bm);BS.edges.push(Az);}}}}catch(B1){mstrmojo.err(B1);}}R.forEach(BA,function(B2){B2.updateValues();});R.forEach(BA,function(B2){B2.updateStyles();});var Bq=BT.nodeSizeMIndex,BG=(BR[Bq]&&BR[Bq].name)||null;R.forEach(Ai,function(B2){B2.itemSizeMetricName=BG;B2.updateValues();});R.forEach(Ai,function(B2){B2.updateStyles();});R.forEach(BV.modifiedNodes,function(B3){var B2=BC[B3.name];if(B2){B2.style=B3.style;if(A2.modifiedNodes.indexOf(B2)===-1){A2.modifiedNodes.push(B2);}else{I("warning: duplicated nodes are store in the server.");}}});function Bw(B2){var B3;R.forEach(BY[0].es,function(B4){if(B4.oid===B2){B3=B4.n;return false;}});return B3;}function BH(B3,B4){var B2;if(isNaN(B4)){B2="--";}else{B2=B3.format(B4);}return B2;}function Bu(){if(Aj&&Aj.itemSize&&Aj.itemSize.id){var B5=A2.nodes[0]||new AT(),B3={},B8=[],B9=B5.range.minNegtive?(-B5.range.min):B5.range.min,B4=B5.range.maxNegtive?(-B5.range.max):B5.range.max,B7,B6,B2;B7=parseFloat(B4);if(B4===B9){B7=parseFloat(B4);B8.push({label:BH(B5,B7)});}else{[B4,B9].forEach(function(CA){B7=parseFloat(CA);B8.push({label:BH(B5,B7)});});}B3.item=mstrmojo.desc(13616,"Item size:")+" "+Bw(Aj.itemSize.id);if(B8.length>1){B6=B3.elements=[];R.forEach(B8,function(CA){B6.push({sign:"=",v:CA.label});});B3.caseFlag=0;}else{if(B8.length===1){B3.elements=[{diameter:12,shape:"rect",sign:"=",v:B8[0].label}];B3.caseFlag=2;}}return B3;}}A2.itemSizeByInfo=Bu();function Av(B3,B7,CA,B4){var CC=[];if(!CA||CA.length<2){for(BQ=0;BQ<B4;BQ++){CC.push(B3);}return CC;}var CB=(B7-B3)/(B4-1),B5=CA[2]?(CA[2]-CA[1]):(CA[1]-CA[0]),B8,B6=CA[1],B2=1,B9,CD;while(B5<1){B5*=10;B2/=10;}while(B5>=10){B5/=10;B2*=10;}CC.push(B3);while(B6>B3){B6-=B2;}for(BQ=1;BQ<B4-1;BQ++){B8=parseFloat(B3+BQ*CB);CD=Number.POSITIVE_INFINITY;B9=Math.abs(B8-B6);while(B9<CD){CD=B9;B6+=B2;B9=Math.abs(B8-B6);}B6-=B2;CC.push(B6);}CC.push(B7);return CC;}function A6(){if(Aj&&Aj.edgeSize&&Aj.edgeSize.id){var B4=A2.edges[0]||new p(),CC=5,CB=[],B2,B6={},CD=B4.range.min,CG=B4.range.max,B8=B4.indexes.edgeSizeMIndex,CE,B5=e.chart.common.Utility,CF,B3,B7,B9,CA=[];if((!CD&&CD!==0)||(!CG&&CG!==0)||!isFinite(CD)||!isFinite(CG)||(CG<CD)){CA.push("Error");}else{if(CD===CG){CA.push(CD);}else{CF=B5.prepareScalePlateOptions(false,0,4);B3=B5.getScalePlate(true);B3.computeTicks(CF,4,CG,CD);B3.GetTicks(CA);CA=Av(CD,CG,CA,CC);}}for(B7=0,B9=CA.length;B7<B9;B7++){if(!isFinite(CA[B7])){CE="--";}else{CE=B4.format(CA[B7],B8);}CB.push({label:CE});}B6.item=mstrmojo.desc(13617,"Edge size:")+" "+Bw(Aj.edgeSize.id);B2=B6.elements=[];R.forEach(CB,function(CH){B2.push({sign:"<",v:CH.label});});B9=B2.length;if(B9===5){B2[0].sign="=";B2[4].sign="=";}if(B9===1){B2[0].sign="=";}B6.caseFlag=3;return B6;}}A2.edgeSizeByInfo=A6();function Ae(CA){var B2=Aj&&Aj.edgeColor&&Aj.edgeColor.id,B9=Bo.gsi.mx,B5;if(B2&&CA!==undefined){R.forEach(B9,function(CB){if(CB.did===B2){B5=CB;}});if(B5){var B6=CA[B2];if(B6&&B6.length>0&&B6[0].fmt&&B6[0].fmt.bc){var B8=mstrmojo.VisUtility.getRankMode(B6),B4=AI.getNumberFormat(Bo,A2.indexes.edgeColorMIndex),B7=B4?mstrmojo.VisUtility.getColorByFormatStr(B4.replace(/\'/g,'"'),B8):"",B3=mstrmojo.VisUtility.getColorByItems(B6,B8,B5.max,B5.min,B5.cnt,B7,M(J.FIRST_PALETTE_COLOR));return{item:mstrmojo.desc(13618,"Edge color:")+" "+mstrmojo.VisUtility.getColorByTitle(Bw(B2),B8),elements:B3};}}}}A2.edgeColorByInfo=Ae(Bo.gsi.thresholds);return A2;}function AG(){function Ag(Al,Ao,An){var Ak=this.propInfo,Am;Ak.unmarshal(Al,Ao);Am=Ak[Al];if(An){this.observableModel[Al].setValue(Am,true);}return Am;}function Aj(Ak,Am,Al,Ao){function An(Ar,Aq){Ag.call(this,Ak,Ar,Aq);var Ap=this.legend;if(!Ap||!Ap.hasRendered){return ;}this.initHTML5Props(this.HTML5PROPS);Ap.updateStyle(this.HTML5PROPS.LEGEND);if(Ao){Ap.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();Ap.updateSplitter();this.updateStageContentForLegendChanged(r[Ap.currDockedPositionIdx].pos);}}An.call(this,Am);this.setProperty(Al,this.propInfo.marshal(Ak),{suppressData:true,clientUndoRedoCallback:An});}function Ai(Al){return function Ak(An){var Am=An.newValue;function Ao(Ar,Aq){var Ap=this.propInfo;Ag.call(this,Al,Ar,Aq);Ap.nodeValueRange={min:Infinity,max:-Infinity};Ap.edgeValueRange={min:Infinity,max:-Infinity};Ap.edgeColorValueRange={min:Infinity,max:-Infinity};this.abstractedModel=W.call(this,this.modelData,Ap,this.dropZoneInfo);this.generateSprites(this.abstractedModel,this.stage);this.refresh();}Ao.call(this,Am);this.setProperty(AF[Al],this.propInfo.marshal(Al),{suppressData:true,clientUndoRedoCallback:Ao});};}var Ae=this.propInfo,Ah=["showEdgeDirection","showTransition","nodeSizeAggregation","layoutMode","lgdBgFillTrans","lgdBgFillClr","lgdFntClr","lgdFntSz","lgdFntFml","lgdFntStyle","showLegend","maxNodeSize","minNodeSize"],Af=this.addDisposable(new AP(Ah.reduce(function(Ak,Al){Ak[Al]=Ae[Al];return Ak;},{})));Af.showEdgeDirection.attachEventListener("valueChanged",this.id,function(Am){var Al=Am.newValue,Ak="showEdgeDirection";function An(Aq,Ap){var Ao=Ag.call(this,Ak,Aq,Ap);this.stage.showEdgeDirection=Ao;this.stage.draw(false,true,true);}An.call(this,Al);this.setProperty(AF.showEdgeDirection,this.propInfo.marshal(Ak),{suppressData:true,clientUndoRedoCallback:An});});Af.showTransition.attachEventListener("valueChanged",this.id,function(Am){var Al=Am.newValue,Ak="showTransition";function An(Aq,Ap){var Ao=Ag.call(this,Ak,Aq,Ap);this.stage.showTransition=Ao;}An.call(this,Al);this.setProperty(AF.showTransition,this.propInfo.marshal(Ak),{suppressData:true,clientUndoRedoCallback:An});});Af.nodeSizeAggregation.attachEventListener("valueChanged",this.id,Ai("nodeSizeAggregation"));Af.maxNodeSize.attachEventListener("valueChanged",this.id,Ai("maxNodeSize"));Af.minNodeSize.attachEventListener("valueChanged",this.id,Ai("minNodeSize"));Af.layoutMode.attachEventListener("valueChanged",this.id,function(Am){var Al=Am.newValue,Ak="layoutMode";function An(Aq,Ap){var Ao=Ag.call(this,Ak,Aq,Ap);D.call(this);this.layoutSprites(this.abstractedModel,this.stage,H[Ao]);this.stage.draw(this.propInfo.showTransition,true,true);}An.call(this,Al);this.setProperty(AF.layoutMode,this.propInfo.marshal(Ak),{suppressData:true,clientUndoRedoCallback:An});});Af.lgdBgFillTrans.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdBgFillTrans",Ak.newValue,AF.lgdBgFillTrans);});Af.lgdBgFillClr.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdBgFillClr",Ak.newValue,AF.lgdBgFillClr);});Af.lgdFntClr.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdFntClr",Ak.newValue,AF.lgdFntClr);});Af.lgdFntSz.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdFntSz",Ak.newValue,AF.lgdFntSz,true);});Af.lgdFntFml.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdFntFml",Ak.newValue,AF.lgdFntFml,true);});Af.lgdFntStyle.attachEventListener("valueChanged",this.id,function(Ak){Aj.call(this,"lgdFntStyle",Ak.newValue,AF.lgdFntStyle,true);});Af.showLegend.attachEventListener("valueChanged",this.id,function(Am){var Al=Am.newValue,Ak="showLegend";function An(Aq,Ap){var Ao=Ag.call(this,Ak,Aq,Ap);if(this.isEmpty()){return ;}this.toggleLegend(Ao);this.updateStageContentForLegendChanged(r[this.legend.currDockedPositionIdx].pos,(Ae.showLegend?this.legendW:0));}An.call(this,Al);if(this.parent.selectVIUnit){this.parent.selectVIUnit(true);}this.setProperty(AF.showLegend,this.propInfo.marshal(Ak),{suppressData:true,clientUndoRedoCallback:An});});return Af;}function AM(){var Ah=this.contextMenuSelection,Ag,Af,Ae;for(Ag=0,Af=Ah.length;Ag!==Af;Ag++){Ae=Ah[Ag].unit.attribute;if(!Ae.supportsViewFilter){return false;}}return true;}function n(Aj,Ae,Ah){var Ag=this.menuAnchor,Ai=this,Af;if(!Ag){Ag=document.createElement("div");Ag.id=this.id+"-netviz-menu-anchor";Ag.style.position="absolute";document.body.appendChild(Ag);this.menuAnchor=Ag;}Ag.style.left=Ae.pageX+"px";Ag.style.top=Ae.pageY+"px";Ag.style.zIndex=101;this.configurePopup(Aj,Ag);Af=Aj.newInstance();if(Af&&Ah){Af.onCloseMenuCallBack=function(){Ai.stage.clearContextMenuSelectionHighLight();Ai.stage.draw(false);Ai.stage.circleMenuOnCloseFlag=true;};}this.openPopup(Af);}function U(Ag){var Ah=this,Ai=Ah.model,Ak=AI.getDrillCandidates(Ah,Ag),Am=Ak.length,Aj=Ai.docModel,Af=Aj.datasets[Ah.modelData.datasetId],Aq,Ao=[],Ap;function An(Ar,At,Au,As){return{id:-1,n:Ar,title:At,level:Au,isLeaf:false,initVisible:true,collapsed:false,children:[],_renderIdx:As,};}if(Af&&Aj.isMDXDataset(Af)){AI.sortMdxDrillCandidates(Ak);var Al=0;Aq=Af.tables[0];Aq.dimensions.forEach(function(At){var As=false,Ar=An(At.n,At.n,0,Al++),Au=[];Au.push(Ar);At.hierarchies.forEach(function(Aw){var Av=false,Ax=An(Aw.n,Aw.n,1,Al++),Ay=[];Ay.push(Ax);Aw.att.forEach(function(Az){Ap=R.findBin(Ak,Az,"did",Am);if(Ap!==-1){Av=true;var A1={level:2,isLeaf:true,initVisible:true,collapsed:null,_renderIdx:Al++,};var A0=V.copy(Ak[Ap],A1);Ay.push(A0);Ax.children.push(A0);}});if(Av){Ar.children.push(Ax);Au=Au.concat(Ay);As=true;}});if(As){Ao=Ao.concat(Au);}});}else{var Al;for(Al=0;Al<Ak.length;++Al){var Ae={_renderIdx:Al,};V.copy(Ak[Al],Ae);Ao.push(Ae);}}return Ao;}function AA(){function Ak(An){var Am=AI.getPropertyByPath(this,"modelData.gts.row",[]);var Al=AI.findInArray(Am,function(Ao){return Ao.id===An;});if(Al!==-1){return Am[Al];}}function Ai(){var Al=this.getDropZone();var Am=this;return["to","from"].map(function(Ao){var Ar=Ao+".TemplateUnit.0.id";var Aq=AI.getPropertyByPath(Al,Ar);var An=Ak.call(Am,Aq);var Ap=AI.pick(An,["n","id"]);Ap.title=Ap.n;return Ap;});}var Af=this.model,Ae=Af.docModel,Aj=Ae.datasets[this.modelData.datasetId],Ah=null;if(Aj&&Ae.isMDXDataset(Aj)){Ah={scriptClass:"mstrmojo.VisMenuHierarchicalList",alias:"candidateList",itemField:"n"};}else{Ah={scriptClass:"mstrmojo.VisMenuList",alias:"candidateList",itemField:"n"};}var Ag=this;return function(){return new mstrmojo.ui.menus.EditorConfig({cssClass:"base-on-calculation-editor",data:{},contents:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(11859,"Based on")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"attributeList",items:Ai.call(Ag),selectedIndex:0,onitemSelected:function(){var An=this.items[this.selectedIndex].id,Al=this.parent,Am=Al&&Al.candidateList;if(Am){Am.items=U.call(Ag,An);}if(Al){(Al.children||[]).forEach(function(Ao){if(Ao.scriptClass=="mstrmojo.VisMenuList"||Ao.scriptClass=="mstrmojo.VisMenuHierarchicalList"){Ao.clearSelect();Al.data.set("valid",false);Ao.unrender();Ao.render();}});}}},Ah,],bindings:{okEnabled:"this.valid",valid:function(){return this.data.valid;}},fnOk:function(Ap,An){var Am=AI.getPropertyByPath(An,"candidateList.selectedItem");var Ao=AI.pick(An.attributeList.getSelectedItem(),["id","n"]);Ag.doSelection(function Al(Ar){var Aq=Ao.id;return Ar.filter(function(As){return As.hasSelfLoop||As.attribute.id===Aq;}).map(function(At){var As=At;if(At.hasSelfLoop&&At.attribute.id!==Aq){As={attribute:At.secondaryAttribute,attributeElements:At.secondaryAttributeElements};}return As;});},true);AI.doDrill(Ag,Am,AJ,{drillFromUnit:Ao});}});};}function F(){var Am=this.abstractedModel.allSupportsViewFilter||AM.call(this.stage),Aj=new mstrmojo.ui.menus.MenuConfig(),Af=new mstrmojo.ui.menus.MenuConfig(),Ao={filter:Aj,showData:Af},Ak=this,Ag=this.stage.contextMenuSelection,Al=function(Ar){var Aq=Ag;var Ap=O(Aq);if(Ap.isSameAttr){return AI.getDrillMenu.bind(AI,Ak,Aq[0].unit.attribute.id,Ar,{drillFromUnit:AI.pick(Ap.nonLoopAttr,["id","n"])});}else{return AA.call(Ak);}};if(Am){if(this.isLinkedFilterEnabled()){var Ai=function(){Ak.handleContextMenuSelectionData(true);};Aj.addMenuItem(mstrmojo.desc(15070,"Go to Targets"),"",Ai);Aj.addSeparator();}Aj.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));Aj.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(y.WEB_DRILL_AND_LINK)){var Ah,An,Ae=false;for(Ah in Ag){An=AI.getPropertyByPath(Ag[Ah],"unit.attribute.id",null);if(An&&AI.getDrillCandidates(this,An).length>0){Ae=true;break;}}if(Ae){Aj.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,Al(this.getMenuHandler("drill")),"xt");}else{Aj.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}}if(!mstrApp.isDossier&&!this.excludeData){Af.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"xt",this.getMenuHandler("showData"));}}return Ao;}function O(Af){var Ae,Ag=Af.every(function(Aj){var Ai=Aj.unit,Ah=Ai.attribute;if(!Ai.hasSelfLoop){if(Ae===undefined){Ae=Ah;}return Ae===Ah;}return false;});return{isSameAttr:Ag,allSelfloops:Ae===undefined,nonLoopAttr:Ae};}function t(Ah){if(Ah.length===0){return{isSameAttr:false,allSelfloops:false,selection:[]};}var Ag=O(Ah),Aj=Ag.isSameAttr,Af=Ag.allSelfloops,Ai=Ag.nonLoopAttr;var Ae=Ah.reduce(function(Al,Ao){var An=Ao.unit,Ak=An.attribute,Am;if(An.hasSelfLoop){if(Af||Ak!==Ai){Am={attribute:An.secondaryAttribute,attributeElements:An.secondaryAttributeElements};Al.push({text:Ao.text,unit:Am,title:Am.attribute.name});}if(Af||Ak===Ai){Am={attribute:Ak,attributeElements:An.attributeElements};Al.push({text:Ao.text,unit:Am,title:Ak.name});}}else{Am={attribute:Ak,attributeElements:An.attributeElements};Al.push({text:Ao.text,unit:Am,title:Ak.name});}return Al;},[]);return{allSelfloops:Af,isSameAttr:Aj,selection:Ae};}function c(){var Af={};if(mstrApp.isAppStatePresentation()||mstrApp.isInVFConfigMode){return Af;}var Aj=this.stage.contextMenuSelection,Ah,Ae,Ak,Ai=function(Al){return Al.text;},Ag=function(Al){return Al;};if(Aj&&Aj.length>0){Ah=t(Aj);Aj=Ah.selection;Ae=Ah.allSelfloops;if(!Ae&&Ah.isSameAttr){Ak=this.getCellForNode(Aj[0]);Af=AI.getGroupAndCalculationContextMenu(this,Ak,{selection:Aj,skipSingleAttrCheck:true,fnCellName:Ai});}else{if(Ae){Af=AI.getGroupAndCalculationContextMenuForDataPoints(this,{selection:Aj,fnCellName:Ai,fnUnique:Ag,fnMakeNode:Ag});}}}return Af;}function Q(Af){var Ae=0,Ai=0,Ag=0;function Ah(Aj){if(Aj.isExcluded){return ;}var Ak=Aj.sprite.getGeometry();Ae++;if(!isNaN(Ak.s)){Ai+=Ak.s*2;if(Ag<Ak.s){Ag=Ak.s;}}}R.forEach(Af.nodes,Ah);return{circleCount:Ae,dimension:Ai,maxR:Ag};}function x(Af){var Ae=Af.nodes.reduce(function(Aj,Ai,Ah){Aj[Ai.id]=Ah;return Aj;},{});Af.nodes.sort(function Ag(Ai,Ah){var Al=Ai.sprite.getGeometry().s,Ak=Ah.sprite.getGeometry().s,Aj;if(Al>Ak){Aj=1;}else{if(Al===Ak){Aj=Ae[Ai.id]>Ae[Ah.id]?1:-1;}else{Aj=-1;}}return Aj;});}mstrmojo.netviz.VisNetwork=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo._VizSelectionHelper,mstrmojo._LoadsScript,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox,mstrmojo.netviz._ForceDirectedLayout,mstrmojo.netviz._CircularLayout,mstrmojo.netviz._LinearLayout,mstrmojo.netviz._SupportNetworkBrushesAndHighlights,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.netviz.VisNetwork",localProps:null,normalizedIdCache:{},markupString:'<div class="VisNetwork network-{@themeType}-theme mil-{@themeType} gm-{@themeType}-theme" id={@id} style="position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height: {@height}px; z-index: 1;" mstrAttach:'+E.join(",")+'><div style="width: {@width}px; height:{@height}px;"></div><div></div><div class="_layoutIcons" style="position: absolute; right: '+X+"px; top: "+u+"px; width: "+S+"px; height: "+P+'px"><input id="{@id}-inputForceDirectedIcon" class="_inputForceDirectedIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputForceDirectedIcon" class="_forceDirectedIcon" style=""></label><input id="{@id}-inputCircularIcon" class="_inputCircularIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputCircularIcon" class="_circularIcon" style=""></label><input id="{@id}-inputLinearIcon" class="_inputLinearIcon" type="radio" name="{@id}-layoutTypes" style="display:none;"><label for="{@id}-inputLinearIcon" class="_linearIcon" style=""></label></div>',markupSlots:{stageContainer:function(){return this.domNode.firstChild;},legendPlaceholder:function(){return this.domNode.childNodes[1];},modeSwitchButton:function(){return this.domNode.childNodes[2];},inputForceDirectedIcon:function(){return this.domNode.childNodes[2].childNodes[0];},forceDirectedIcon:function(){return this.domNode.childNodes[2].childNodes[1];},inputCircularIcon:function(){return this.domNode.childNodes[2].childNodes[2];},circularIcon:function(){return this.domNode.childNodes[2].childNodes[3];},inputLinearIcon:function(){return this.domNode.childNodes[2].childNodes[4];},linearIcon:function(){return this.domNode.childNodes[2].childNodes[5];}},init:function(Ae){this._super(Ae);this.modeSwitchButtonRect={r:X,t:u,w:S,h:P};this.HTML5PROPS={};this.localProps={};this.canOnlyDragOnTitleBar=true;},update:function(Ag){var Ai,Aj,Ao,Ae,Ah,Ak=this.excludeData,Af="timerid_update";v.startTimer({functionName:"VisNetwork.update",purpose:"JSON loading and consuming"},Af);Ai=this._super(Ag);if(Ai!==false){this.clearError();Ao=this.model.data||{};Ae=Ao.egt;Ah=Ao.eg;if((Ae!==undefined||Ah!==undefined)&&!Ak){this.setError(Ah,Ae);if(this.errorType!==Ad.EMPTY_DATA){return Ai;}}this.modelData=this.model.data;this.dropZoneInfo=AN(this.getDropZone());this.propInfo=K(this,this.getProperties());var An=this.getFormats()["background-color"];if(An===undefined){An=this.propInfo.themeType==="dark"?"#333333":"#ffffff";}this.propInfo.background={value:An,opacity:1};this.observableModel=AG.call(this);f.call(this);Aj=this.propInfo;this.stage=this.addDisposable(new mstrmojo.netviz.VisNetworkStage({owner:this,slot:"stageContainer",showTransition:Aj.showTransition,showEdgeDirection:Aj.showEdgeDirection,themeType:Aj.themeType,background:V.clone(Aj.background),circleStyle:V.clone(Aj.circleStyle),circleLabelStyle:V.clone(Aj.circleLabelStyle),dragMode:Aj.dragMode}));this.propInfo.circleStyle=this.stage.observableModel&&this.stage.observableModel.circleStyle;this.layoutMode=H[Aj.layoutMode];this.themeType=Aj.themeType;if(AI.isOnExpressMode()&&this.dropZoneInfo.edgeColor.id){var Am=this.modelData.gsi;if(Object.keys(Am.thresholds).length===0){var Al=this.dropZoneInfo.edgeColor;Am.thresholds=AI.getMockUpThresholds(Al.id,Al.n);}}if(AI.hasMergedRowCells(this.modelData)&&!Ak){this.error=mstrmojo.desc(13702,"The Network doesn't support grid data with merged row cell. Please disable cell merge and retry");}else{if(this.dropZoneInfo.from.id||this.dropZoneInfo.to.id){if(Aj.showLegend&&!this.hasSizebyOrColorby()){Aj.showLegend=false;}this.abstractedModel=W.call(this,this.modelData,Aj,this.dropZoneInfo);this.generateSprites(this.abstractedModel,this.stage);}else{if(!Ak){this.setError(null,Ad.NO_TEMPLATE_UNIT);}}}}v.endTimer(Af);return Ai;},getColorByMetric:function(){return AI.getMetricsInDropZone(this.zonesModel,mstrmojo.vi.viz.EnumDSSDropZones.ColorBy)[0]||null;},hasSizebyOrColorby:function(){return AI.getPropertyByPath(this,"dropZoneInfo.edgeColor.id",false)||AI.getPropertyByPath(this,"dropZoneInfo.edgeSize.id",false)||AI.getPropertyByPath(this,"dropZoneInfo.itemSize.id",false);},hasSizeByMetric:function(){return AI.getPropertyByPath(this,"dropZoneInfo.itemSize.t")===b.DssTypeMetric;},setError:function(Ag,Af){var Ae=AI.translateGridError(Ag,Af);this.error=Ae.msg;this.errorType=Ae.type;},clearError:function(){this.error=undefined;this.errorType=undefined;},hasError:function(){return this.error!==undefined||this.errorType!==undefined;},isEmpty:function(){return this.hasError();},getVisEmptyMsgControls:function(){return AI.getVisEmptyMsgControls.call(this);},preBuildRendering:function(){if(this.waitingForData){return ;}this._super();var Ae=this.stage;if(Ae){Ae.height=parseInt(this.height,10);Ae.width=parseInt(this.width,10);if(!this.hasError()&&!this.waitingForData){this.defaultsLegendPop=AK.call(this,(this.themeType==="light"?0:1));this.initHTML5Props(this.HTML5PROPS);}}},postBuildRendering:function(){var Af="timerid_fromBuildtoEnd";v.startTimer({functionName:"VisNetwork.postBuildRendering",purpose:"from Build to End"},Af);if(this.waitingForData){return ;}if(this.isEmpty()){if(AI.isOnExpressMode()){AI.renderWidgetErrorRSD(this,this.error,E);}else{this._super();}return ;}this.addChildren(this.stage);if(this.excludeData){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});return ;}this.stage.render();this.initLegend();D.call(this);this.layoutSprites(this.abstractedModel,this.stage,H[this.propInfo.layoutMode]);this.stage.draw(false);this.attachEventListener("click",this.id,this.onclick);var Ae=this.getExp(),Ag=this.getRowsAndCols();AI.modifyScExp(Ae,Ag,this.model,this.normalizedIdCache);if(this._super){this._super();}v.endTimer(Af);},destroy:function(){if(this.legend){this.legend.hideToolbar();}f.call(this);delete this.modelData;delete this.propInfo;delete this.legend;delete this.abstractedModel;if(this._super){this._super();}},getProperties:function(){return(this.modelData&&this.modelData.vp)||{};},getProperty:function(Ae){var Af=this.getProperties();return Af[Ae];},getDropZone:function(){var Af=this.modelData&&this.modelData.dz;if(!AI.isValidDropZone(Af)){Af={};var Ak=this.model&&this.model.data;if(Ak){var Ag=Ak.gts||{},Ah=Ag.row||[],Aj=(Ag.col&&Ag.col[0]&&Ag.col[0].es)||[],Al=["from","to"],Ae=["SizeBy","ColorBy","itemsz"],Ai=[{units:Ah,unitKeys:Al,setKey:"TemplateUnit"},{units:Aj,unitKeys:Ae,setKey:"TemplateMetric"}];R.forEach(Ai,function(Am){R.forEach(Am.units,function(Ao,Aq){var An=Am.unitKeys[Aq];if(An){var Ap={};Ap[Am.setKey]=[{id:Ao.oid||Ao.id,t:Ao.otp}];Af[An]=Ap;}});});}}return Af;},onAppStateChange:function AD(Ae){this._super(Ae);if(!this.selectorControl){this.clearSelections(true);}},onclick:function(Ae){delete this.noHighlightAfterKeepOnlyExcludeDrill;var Ah=Ae.e||Ae,Ag=Ah.target,Af;if(Ag===this.circularIcon){Af="0";}if(Ag===this.linearIcon){Af="1";}if(Ag===this.forceDirectedIcon){Af="2";}if(Af){this.observableModel.layoutMode.setValue(Af);}this.stage.dismissLassoSelector();if(this.legend){this.legend.hideToolbar();}},oncontextmenu:function(Ae){delete this.noHighlightAfterKeepOnlyExcludeDrill;var Af=Ae.getTarget();Ae.cancel();Ae.preventDefault();if(this.legend){if(AU.contains(this.legend.domNode,Af,true)){this.legend.handleRMCOnLegend(Ae);}else{this.legend.hideToolbar();}}},dismissLassoSelector:function L(){var Ae=this.stage;if(Ae){Ae.dismissLassoSelector();}},onmouseup:function(Ae){var Ag=Ae.e||Ae,Ah=this.stage,Af=Ag.target||Ag.srcElement;if(!AU.contains(Ah.domNode,Af,true)){Ah.dismissLassoSelector();}},initLegend:function(){var Af=0,Ae=0;this.hEvalSize4Legend();if(this.propInfo.showLegend){this.renderLegend();var Ag=r[this.legend.currDockedPositionIdx];Af=this.isOnRight(Ag.pos)?0:this.legendW;if(this.isLegendSwitchOverlap()){Ae=X+this.modeSwitchButtonRect.w;this.modeSwitchButtonRect.r=this.legendW+X;}else{this.modeSwitchButtonRect.r=X;}}this.modeSwitchButton.style.right=this.modeSwitchButtonRect.r+"px";this.stage.setMainRect({x:Af,y:0,w:parseInt(this.width-Ae-this.legendW,10),h:parseInt(this.height,10)});},hEvalSize4Legend:function(){var Aj,Ah=this.abstractedModel.edgeColorByInfo,Ag=this.abstractedModel.itemSizeByInfo,Af=this.abstractedModel.edgeSizeByInfo,Ai=this.getWidth(),Ae=this.getHeight(),Ak=this.HTML5PROPS.LEGEND,Al;if(this.propInfo.showLegend===false){this.legendW=this.legendH=this.legendP=0;}else{T.applyHTML5Props(Ak);this.legendP=g;Al=this.readGlobalProperty(AS.SCALE_LEGEND_WIDTH);if(Al===undefined||!this.legendScale||this.legendScale!==Al){this.legendScale=Al;this.legendResized=true;this.legendFixedW=undefined;}Aj=T.getLegendSize([{dataType:AW.COLOR_BY,dataObj:Ah},{dataType:AW.SIZE_BY,dataObj:Ag},{dataType:AW.SIZE_BY,dataObj:Af}],this.legendResized?this.legendScale:undefined,Ai,Ae,Ak,this.legendFixedW);this.legendCutBy=Aj.cutBy;this.legendMinHeight=Aj.minHeight;this.legendFixedW=Aj.width;if(Aj.scale){this.legendScale=Aj.scale;}if(this.readGlobalProperty(AS.LEGEND_MODE)===AL.MINIMIZED||Aj.autoCollapse){Aj=T.getLegendSize4MinMode(Ah,Ae);this.legendCutBy=undefined;}this.legendW=Aj.width;this.legendH=Aj.height;}},hInitLegendListeners:function(){var Ae=this,Af=this.id;if(this.legend){this.legendResizeListener=this.legend.attachEventListener("gm-legend-resized",Af,function(Ag){Ae.onLegendResized(Ag.position);});this.legendClickListener=this.legend.attachEventListener("gm-legend-clicked",Af,function(Ag){Ae.onLegendClicked(Ag);});}},onLegendResized:function(Ag){function Ae(){var Ah=this.legend;if(Ah){this.hEvalSize4Legend();this.updateLegend();Ah.updateAfterResize();this.updateStageContentForLegendChanged(r[Ah.currDockedPositionIdx].pos);}}function Af(Ai,Ah){if(Ah){this.legendScale=Ai;this.legendResized=true;this.legendFixedW=undefined;Ae.call(this);}}if(this.legend){this.legendFixedW=this.legendW+Ag;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);this.legendResized=true;this.writeLgendFormatProperty(AS.SCALE_LEGEND_WIDTH,this.legendScale,{success:Af});Ae.call(this);}},onLegendClicked:function(Ae){var Ag=Ae.action,Af=this.legend,Ah={success:function(){this.hEvalSize4Legend();this.updateLegend();this.updateStageContentForLegendChanged(r[Af.currDockedPositionIdx].pos);}};if(Ag==="close"){this.observableModel.showLegend.setValue(false);return ;}if(Ag==="minimize"){this.writeLgendFormatProperty(AS.LEGEND_MODE,AL.MINIMIZED,Ah);}else{if(Ag==="restore"){this.writeLgendFormatProperty(AS.LEGEND_MODE,AL.RESTORED,Ah);}}},renderLegend:function(){var Ae=this.legendPlaceholder;if(!this.propInfo.showLegend){Ae.style.display="none";}Ae.style.width=this.legendW+"px";Ae.style.height=this.legendH+"px";this.legend=this.addDisposable(new Ab.GMLegend({widget:this,model:this.model,placeholder:Ae,currDockedPositionIdx:s(this.readGlobalProperty(AS.LEGEND_POSITION)),cutBy:this.legendCutBy,cssClass:"gm-legend",styles:this.HTML5PROPS.LEGEND,readGlobalProperty:function(Af){return this.widget.readGlobalProperty(Af);},writeGlobalProperty:function(Af,Ag){this.widget.writeLgendFormatProperty(Af,Ag,{success:function(){this.widget.reRender();}.bind(this)});},configureLegendPopup:function(Af,Ag){return this.widget.configurePopup(Af,Ag);}}));this.legend.render();this.legend.parent=this;this.legend.cutBy=this.legendCutBy;this.legend.minHeight=this.legendMinHeight;this.legend.updateContainerSize(this.getWidth(),this.getHeight());this.legendPlaceholder=this.legend.domNode;this.hInitLegendListeners();this.legend.feedData([{dataType:AW.COLOR_BY,dataObj:this.abstractedModel.edgeColorByInfo},{dataType:AW.SIZE_BY,dataObj:this.abstractedModel.edgeSizeByInfo},{dataType:AW.SIZE_BY,dataObj:this.abstractedModel.itemSizeByInfo}],(this.readGlobalProperty(AS.LEGEND_MODE)===AL.MINIMIZED));},showMenu:n,showSelectionMenu:function(Ag,Ah,Af){var Ae;if(!AI.isOnExpressMode()){Ae=this.getSelectionMenuConfig();if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()&&Ah){if(Ae.hasMenuItems()){Ae.addSeparator();}Ae.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",Ah);}if(Ae.hasMenuItems()){this.showMenu(Ae,Ag,Af);}}},showBlankSpaceMenu:function(Ae,Af){if(!AI.isOnExpressMode()&&!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()&&!mstrApp.isInVFConfigMode){this.showMenu(this.getBlankSpaceMenuConfig(Af),Ae);}},getSelectionMenuConfig:function(){var Ae=AI.mergeHashes(F.call(this),c.call(this)),Af=[{name:"filter"},{name:"editGroup"},{name:"editCalculation"},{name:"createDe"},{name:"showData"},{name:"renameDe"}];return AI.mergeMenuConfigs(Ae,Af);},getFormatMenuConfig:function(){var Ae=this.addDisposable(new mstrmojo.ui.menus.MenuConfig()),Af=AI.getPropertyByPath(this,"stage.observableModel.circleStyle.showNodeLabel"),Ah=!!(Af&&Af.getValue()),Ag;if(Ah){Ag=mstrmojo.desc(13688,"Hide Node Label");}else{Ag=mstrmojo.desc(12079,"Show Node Label");}Ae.addMenuItem(Ag,"xt",function(){Af.setValue(!Ah);});return Ae;},getBlankSpaceMenuConfig:function(Ag){var Ae=this.addDisposable(new mstrmojo.ui.menus.MenuConfig()),Af=this;Ag=Ag||function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");};Ae.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",Ag);if(this.hasSizebyOrColorby()){if(!Af.propInfo.showLegend){Ae.addMenuItem(mstrmojo.desc(12001,"Show Legend"),"xt",this.getMenuHandler("showLegend"));}}return Ae;},getLocalProp:function(Ae){return this.localProps[Ae];},setLocalProp:function(Af,Ae){this.localProps[Af]=Ae;},unrender:function(){if(this.legendResizeListener){this.legendResizeListener.clear();}if(this.legendClickListener){this.legendClickListener.clear();}if(this.legend){this.legend.unrender();}if(this.stage){if(this.stage._contextMenuAnchor){this.stage._contextMenuAnchor=undefined;}this.removeChildren(this.stage);}var Ae=this._lastOpened;if(Ae){this.closePopup();}if(this._super){this._super();}},generateSprites:function q(Af,Ag){function Ah(Ai){Ai.sprite=Ag.createSprite({type:"Circle",position:{x:0,y:0,r:Ai.size},text:Ai.getName(),title:Ai.getAttributeName(),attSrc:Ai.attSrc,forms:Ai.getFormNames(),formValues:Ai.getFormValues(),displayValue:Ai.format(Ai.getAggregatedValue()),aggregationName:Ai.itemSizeMetricName?Ai.aggregationName:null,unit:Ai,style:Ai.style,selfLoop:Ai.hasSelfLoop});Ag.addSprite(Ai.sprite);}function Ae(Ai){Ai.sprite=Ag.createSprite({type:"Edge",from:Ai.from.sprite,to:Ai.to.sprite,controlPoint:{x:Ag.width/2,y:Ag.height/2},color:Ai.color,width:Ai.width,unit:Ai});Ag.addSprite(Ai.sprite);}Ag.clearSprites();R.forEach(Af.nodes,Ah);R.forEach(Af.edges,Ae);},getSelectedNodes:function(){return AI.pluck((this.stage.selectedSprites||[]).filter(function(Ae){return Ae.type==="Circle"&&Ae.unit;}),"unit");},getContextMenuSelectedNodes:function(){return AI.pluck((this.stage.contextMenuSelection||[]).filter(function(Ae){return Ae.type==="Circle"&&Ae.unit;}),"unit");},keepOnly:function(){var Ae=this.abstractedModel.nodes,Al=Ae.length,Am=this.getSelectedNodes(),Ah=Am.length,Aj,Af;for(Aj=0;Aj<Ah;Aj++){Af=Am[Aj];var Ag=Af.adjacence,Ak=Ag.length,Ai;for(Ai=0;Ai<Ak;Ai++){if(!Ag[Ai].isExcluded&&Am.indexOf(Ag[Ai])===-1){Am.push(Ag[Ai]);}}}for(Aj=0;Aj<Al;Aj++){Af=Ae[Aj];if(Am.indexOf(Af)===-1){Af.exclude();}}this.stage.draw(false);},exclude:function(){var Ag=this.getSelectedNodes(),Ae=Ag.length,Af;for(Af=0;Af<Ae;Af++){Ag[Af].exclude();}this.stage.draw(false);},getSelectedNodesInfo:function(){var Ae=[];R.forEach(this.getSelectedNodes(),function(Af){Ae.push(Af.getActionInfo());});return Ae;},getContextMenuSelectedNodesInfo:function(){var Ae=[];R.forEach(this.getContextMenuSelectedNodes(),function(Af){Ae.push(Af.getActionInfo());});return Ae;},getMenuHandler:function(Af){var Ak=this,An=this._super(Af);if(An!==mstrmojo.emptyFn){return An;}var Ag={keepOnly:function Ah(){Ak.updateAfterKeepOnly(true);Ak.noHighlightAfterKeepOnlyExcludeDrill=true;},exclude:function Am(){Ak.updateAfterKeepOnly(false);Ak.noHighlightAfterKeepOnlyExcludeDrill=true;},drill:function Aj(Ao){AI.doDrill(Ak,Ao.ctxt.drillUnit,AJ,Ao.ctxt);Ak.noHighlightAfterKeepOnlyExcludeDrill=true;},showData:function Ai(){Ak.showData(Ak.getContextMenuSelectedNodesInfo());},showLegend:function Al(){Ak.observableModel.showLegend.setValue(true);},hideLegend:function Ae(){Ak.observableModel.showLegend.setValue(false);}};if(Ag.hasOwnProperty(Af)){return Ag[Af];}return mstrmojo.emptyFn;},doSelection:function(Ae,Af){this.prepareSelectedNodesInfo(Ae,Af);if(!Af){this.endSelections();}},onStylesModified:function(Ag,Ah,Aj){var Ai=function(Ak){return function(An,Am){var Al=this.propInfo;Al.unmarshal(Ak,An);Aj.call(this.stage,Al[Ak],Am);};};var Ae={circleStyle:function(Ak){this.setProperty(AF.bubbleStyle,Ak,{suppressData:true,clientUndoRedoCallback:Ai("circleStyle")});},background:function(Ak){this.propInfo.background=Ak;},circleLabelStyle:function(Ak){this.setProperty(AF.circleLabelFont,Ak,{suppressData:true,clientUndoRedoCallback:Ai("circleLabelStyle")});},dragMode:function(Ak){this.setProperty(AF.dragMode,Ak,{suppressData:true,clientUndoRedoCallback:Ai("dragMode")});}};if(Ae[Ag]){this.propInfo[Ag]=Ah;var Af=Ae[Ag];if(Af instanceof Function){Af.call(this,this.propInfo.marshal(Ag));}}},layoutSprites:function(Af,Ag,Ae){var Ah="timerid_layoutSprites";v.startTimer({functionName:"VisNetwork.layoutSprites",purpose:"layout the bubbles"},Ah);x(Af);R.forEach(Af.nodes,function(Ai){Ai.sprite.setGeometry({s:Ai.size});});R.forEach(Af.edges,function(Ai){Ai.sprite.setGeometry({s:Ai.width});});this.layouts[Ae].call(this,Af,Ag,Q(Af));Ag.setScene();v.endTimer(Ah);},readGlobalProperty:function(Ae){var Af;switch(Ae){case AX.LEGEND_BG_COLOR:Af=this.propInfo.lgdBgFillClr;break;case AX.LEGEND_BG_FILL_STYLE:Af=this.propInfo.lgdBgFillStyle;break;case AX.LEGEND_BG_FILL_EFFECT:Af=this.propInfo.lgdBgFillEff;break;case AX.LEGEND_BG_FILL_TRANSPARENCY:Af=this.propInfo.lgdBgFillTrans;break;case AX.LEGEND_FONT_SIZE:Af=this.propInfo.lgdFntSz;break;case AX.LEGEND_FONT_FAMILY:Af=this.propInfo.lgdFntFml;break;case AX.LEGEND_FONT_STYLE:Af=this.propInfo.lgdFntStyle;break;case AX.LEGEND_FONT_COLOR:Af=this.propInfo.lgdFntClr;break;case AX.LEGEND_BORDER_SHOW:Af=this.propInfo.lgdBdrShw;break;case AX.LEGEND_BORDER_COLOR:Af=this.propInfo.lgdBdrClr;break;case AX.LEGEND_BORDER_LINE_STYLE:Af=this.propInfo.lgdBdrStyle;break;case AX.COLOR_SQUARE_COLOR:Af=this.propInfo.clrSqrClr;break;case AS.LEGEND_MODE:Af=this.propInfo.lm;break;case AS.LEGEND_POSITION:Af=this.propInfo.LegendPosition;break;case AS.SCALE_LEGEND_WIDTH:Af=this.propInfo.lwr;break;}if(Af===undefined||((typeof Af)==="number"&&isNaN(Af))){Af=this.defaultsLegendPop&&this.defaultsLegendPop[Ae];}return Af;},initHTML5Props:function(Ag){function Af(Ai,Ah){Ai.fontWeight=(Ah&G.FS_BOLD?"bold":"normal");Ai.fontStyle=(Ah&G.FS_ITALIC?"italic":"normal");if((Ah&G.FS_STRIKETHROUGH)&&(Ah&G.FS_UNDERLINE)){Ai.textDecoration="line-through underline";}else{if(Ah&G.FS_STRIKETHROUGH){Ai.textDecoration="line-through";}else{if(Ah&G.FS_UNDERLINE){Ai.textDecoration="underline";}else{Ai.textDecoration="none";}}}}var Ae={};Ae.fontFamily=this.readGlobalProperty(AX.LEGEND_FONT_FAMILY);Ae.fontSize=this.readGlobalProperty(AX.LEGEND_FONT_SIZE);Af(Ae,this.readGlobalProperty(AX.LEGEND_FONT_STYLE));Ae.color=AO.decodeColor(this.readGlobalProperty(AX.LEGEND_FONT_COLOR));Ae.backgroundColor=AO.decodeColor(this.readGlobalProperty(AX.LEGEND_BG_COLOR));Ae.opacity=this.readGlobalProperty(AX.LEGEND_BG_FILL_TRANSPARENCY)/100;if(this.readGlobalProperty(AX.LEGEND_BORDER_SHOW)){Ae.borderWidth=AI.translateLineStyle(this.readGlobalProperty(AX.LEGEND_BORDER_LINE_STYLE)).width;Ae.borderStyle=AI.translateLineStyle(this.readGlobalProperty(AX.LEGEND_BORDER_LINE_STYLE)).style;Ae.borderColor=AO.decodeColor(this.readGlobalProperty(AX.LEGEND_BORDER_COLOR));}Ag.LEGEND=Ae;},configurePopup:function w(Ae,Af){Ae.hostId=this.id;Ae.hostElement=Af;},writeLgendFormatProperty:function(Ag,Ah,Aj){var Af=!!(Aj&&Aj.success),Ai=function(Am,Al){var Ak=this.propInfo;Ak.unmarshal(Ag,Am);if(Af){Aj.success.call(this,Ak[Ag],Al);}},Ae;if(Ag===AX.COLOR_SQUARE_COLOR){this.propInfo.unmarshal(Ag,Ah);this.setProperty(Ag,Ah,{callback:Aj});}else{if(this.observableModel[Ag]){Ae=this.observableModel[Ag];Ae.setValue(Ah);}else{Ai.call(this,Ah,false);this.setProperty(Ag,Ah,{suppressData:true,clientUndoRedoCallback:Af?Ai:undefined});}}},onLegendDropZoneChange:function a(Ae,Af){this.setLegendSlot(Ae,Af);},onLegendDropped:function(Ae){this.writeLgendFormatProperty(AS.LEGEND_POSITION,Ae,{success:function(Ag,Af){if(Af){this.renderLegend();this.updateStageContentForLegendChanged(Ag);}}});},setLegendSlot:function(Ah,Ak){var Aj=this.legend.currDockedPositionIdx;if(Ak!==Aj){var Ae=this.isOnRight(r[Aj].pos),Ai=this.isOnRight(Ah.pos),Af=this.isOnRightTop(r[Aj].pos),Ag=this.isOnRightTop(Ah.pos);if(Ae!==Ai||(Ae&&Ai&&Af!==Ag)){this.updateStageContentForLegendChanged(Ah.pos);}}},isOnRight:function(Ae){return(Ae===o.RIGHT_MIDDLE||Ae===o.RIGHT_TOP||Ae===o.RIGHT_BOTTOM);},isOnRightTop:function(Ae){return Ae===o.RIGHT_TOP;},isLegendSwitchOverlap:function(){var Ah=AU.position(this.legend.domNode),Af=AU.position(this.modeSwitchButton),Ag=Ah.x,An=Ah.y,Aj=Ag+Ah.w,Al=An+Ah.h,Ae=Af.x,Am=Af.y,Ai=Ae+Af.w,Ak=Am+Af.h;return !(Ag>=Ai||An>=Ak||Ae>=Aj||Am>=Al);},updateStageContentForLegendChanged:function(Ah,Ag){var Af=0,Ae=0;Ag=(typeof Ag==="number")?Ag:this.legendW;this.modeSwitchButtonRect.r=X;if(this.propInfo.showLegend){Ah=Ah||this.readGlobalProperty(AS.LEGEND_POSITION);Af=this.isOnRight(Ah)?0:Ag;if(this.isLegendSwitchOverlap()){Ae=X+this.modeSwitchButtonRect.w;this.modeSwitchButtonRect.r=Ag+X;}}this.stage.setMainRect({x:Af,y:0,w:parseInt(this.width-Ae-Ag,10),h:parseInt(this.height,10)});this.modeSwitchButton.style.right=this.modeSwitchButtonRect.r+"px";D.call(this);this.stage.setScene();this.stage.draw(false);},updateLegend:function(){var Ae=this.legend,Ag=this.abstractedModel,Af=this.legendPlaceholder.style;Af.width=this.legendW+"px";Af.height=this.legendH+"px";Ae.width=this.legendW;Ae.height=this.legendH;Ae.cutBy=this.legendCutBy;Ae.minHeight=this.legendMinHeight;Ae.updateContainerSize(this.getWidth(),this.getHeight());Ae.feedData([{dataType:AW.COLOR_BY,dataObj:Ag.edgeColorByInfo},{dataType:AW.SIZE_BY,dataObj:Ag.edgeSizeByInfo},{dataType:AW.SIZE_BY,dataObj:Ag.itemSizeByInfo}],(this.readGlobalProperty(AS.LEGEND_MODE)===AL.MINIMIZED));Ae.updateAfterResize();},toggleLegend:function(Ae){var Ag=this.legend,Af;if(!Ag||!Ag.hasRendered||!Ag.domNode){this.initLegend();Ag=this.legend;}Af=Ag.domNode.style;if(!Ae){Ag.hideToolbar();Af.display="none";}else{if(Af.display!=="block"){Af.display="block";}}},getCellForNode:function h(Af){var Ah=Af.unit,Ae=Ah.attribute,Ag=Ah.attributeElements[0];return{at:Ag.at,dei:Ag.dei,dpt:Ag.dpt,o:Ag.o,n:Af.title,tui:Ag.tui,ui:Ag.tui,axis:1,v:Af.text,tid:Ae.id};},getCellUnitIndex:function B(Ae){return Ae.o;},execFormatHandler:function(){var Ae=this.stage;if(Ae){Ae.execFormatHandler();}},onNDECreated:function(Ae){var Ag=this.stage,Af=Ag.spriteCollection;Ae.forEach(function(Ak){var Ah=Ak.id,Aj=Ak.unitId;var Ai=AI.findInArray(Af,function(Al){var Am=Al.unit;return Al.type==="Circle"&&Am.attribute.id===Aj&&Am.attributeElements.some(function(An){return An.id.indexOf(Ah)!==-1;});});if(Ai!==-1){Ag.addToSelection(Af[Ai]);}});Ag.draw(false,true);},isClearAllEnabled:function(Af){var Ae=AI.getPropertyByPath(this,"modelData",{}),Ag=AI.getPropertyByPath(Af,"attribute.sc",Ae.sc);return !!(Ag===undefined||Ag.showall);}});}());