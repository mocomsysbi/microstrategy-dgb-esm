(function(){mstrmojo.requiresCls("mstrmojo.dom");var C=mstrmojo.dom,D=Math;mstrmojo.gm._IsAnchorable={PLACEMENT_ABOVE:1,PLACEMENT_BELOW:2,PLACEMENT_LEFT:3,PLACEMENT_RIGHT:4,anchor:null,anchorPosition:null,boundary:null,boundaryPosition:null,popupNodeName:"infoNode",tipNodeName:"tipNode",baseTipClass:"arrow",infoNodeOffset:25,popupNodeOffset:0,placementOrder:[this.PLACEMENT_ABOVE,this.PLACEMENT_BELOW,this.PLACEMENT_LEFT,this.PLACEMENT_RIGHT],hasScrollbars:function G(){return(!mstrApp.isTouchApp||!mstrApp.isTouchApp());},positionDialog:function E(){if(!this.anchorPopup()){if(typeof this._super==="function"){this._super();}}},positionTipNode:function A(I){var J=this.baseTipClass,K=this[this.tipNodeName];K.className=J+" "+I;},getTipDimension:function B(){var J=this[this.tipNodeName],I=C.position(J);return I;},anchorPopup:function F(){this.positionTipNode("top");var K=this.anchor,b=this.boundary,n=this[this.popupNodeName],q=this.infoNodeOffset,h=this.popupNodeOffset,k=this.hasScrollbars(),Y=this.anchorPosition||C.position(K,true),M=this.boundaryPosition||C.position(b,true),s=M.w,L=M.h,c=n.offsetWidth,O=n.offsetHeight,U=c/2,I=O/2,W=this.getTipDimension(),g=D.min(W.h,W.w),P=D.max(W.h,W.w)/2;if(k){s-=15;L-=15;}var Z=C.contains(b,n),j=Z?0:M.y,r=s/2-U,Q=L/2-I+j,m=-1000,t=-1000;if(Z){Y.x=Y.x-M.x;Y.y=Y.y-M.y;}var f=Y.y+Y.h,N=Y.x+Y.w,e=Y.x>c,o=((N+c)<s),R=Y.y>O,l=((f+O)<L),T=this,V=function(i,v,u){return D.min(D.max(i,u),D.max(v,0));},d=function(){if((Y.x<s)&&R){var i=Y.x+(Y.w/2);T.positionTipNode("bottom");t=Y.y-g-h;Q=t-O+q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},J=function(){if((Y.x<s)&&l){var i=Y.x+(Y.w/2);T.positionTipNode("top");t=f+h;Q=t+g-q;r=V(0,s-c,i-U);m=V(Y.x,N,i)-P;return true;}return false;},a=function(){if((Y.y<L)&&e){var i=Y.y+(Y.h/2);T.positionTipNode("right");m=Y.x-g-h;r=m-c+q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},X=function(){if((Y.y<L)&&o){var i=Y.y+(Y.h/2);T.positionTipNode("left");m=N+h;r=m+g-q;Q=V(j,L-O,i-I);t=V(Y.y,f,i)-P;return true;}return false;},S=[],p;for(p=0;p<this.placementOrder.length;p++){switch(this.placementOrder[p]){case this.PLACEMENT_ABOVE:S.push(d);break;case this.PLACEMENT_BELOW:S.push(J);break;case this.PLACEMENT_LEFT:S.push(a);break;case this.PLACEMENT_RIGHT:S.push(X);break;}}for(p=0;p<S.length;p++){if(S[p]()){break;}}Q=D.round(Q);r=D.round(r);t=D.round(t);m=D.round(m);this.applyPopupNodePos(Q,r,t,m);return true;},applyPopupNodePos:function H(K,J,M,I){var O=this[this.tipNodeName],L=O.style,P=this[this.popupNodeName],N=P.style;L.top=M+"px";L.left=I+"px";N.top=K+"px";N.left=J+"px";}};}());(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.vi.ui.rw._HasVisSelections");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","SelectionType");var B=mstrmojo,D=B.array,E=B.hash;var G=2;function C(J){var I=-1;var K=this.modelData.gts.row||[],H=K.length,L;for(L=0;L<H;L++){if(K[L].id===J){I=L;}}return I;}mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights=mstrmojo.provide("mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights",{_mixinName:"mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights",prepareSelectedNodesInfo:function(K){if(K==true){this.clearCxtMnuSelection();}else{this.clearSelections();}var L=this,I=this.attSpan,O=this.modelData.ghs.rhs.items,J=this.modelData.gts.row,M=[],N=K===true?this.contextMenuSelection:this.previousSelected,H={};D.forEach(N,function(X){var Q=X.level,V=(X.index===undefined)?X.indices[0]:X.index,W=O[V].items,P=(W&&W.length)||0,Y,b,T,c,U,S,Z=[],a,R;H={};for(U=X.entityChildren?Q:0;U<=Q;U++){Y=J[U];H[Y.id]=[];c=[];R=[];a={n:Y.n,tid:Y.id};for(S=0;S<P;S++){if(!W[S]||W[S].tui!==U){continue;}b=W[S].idx;if(b===-1){continue;}T=Y.es[b];if(c.indexOf(T)===-1){R.push(T.n);c.push(T);if(a.eid===undefined){a.eid=T.id;}}}a.v=R.join(":");if(U===Q){a.level=X.level;H[Y.id].push({id:a.eid,n:a.v,level:a.level});}else{H[Y.id].push({id:a.eid,n:a.v});}Z.push(a);}M.push(Z);if(Q<J.length-1){if(K==true){L.addContextMenuAttributeSelection(Y.id,a.eid,a.v);}else{L.addAttributeSelection(Y.id,a.eid,a.v);}}else{if(K==true){L.addContextMenuMetricValueSelection(H);}else{L.addMetricValueSelection(H);}}});return M;},highlight:function(S,J){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill){return ;}var T,I,Q,H,M,K,L,R,O=[];function P(h,a){var f=this.root,d=f&&f.entityChildren,k=this.modelData.gts.row||[],l,c,X,V,W=k.length,e=[],b=this;if(!a){a=[];}if(!E.isEmpty(h)){e.push(f);for(V=0;V<W;V++){l=h[V];c=l&&l.eNm;X=l&&l.eId;var j=[];D.forEach(e,function(m,n){d=m.entityChildren||[];var i=false;D.forEach(d,function(o){if(o.level===V&&((!c&&h.maxIndex>V)||b.model.compareElementsId(o.id,X))){e.push(o);i=true;}});if(!i&&c){j.push(n);}});D.forEach(j,function(m,i){e.splice(m-i,1);});if(V===0){e.splice(0,1);}var Z=e.length,Y,g=0;for(Y=0;Y<Z;Y++){if(e[Y].level===V){g=Y;break;}}if(g>0){e.splice(0,g);}}}return a.concat(e);}if(this.isEmpty()){return ;}var N=function(V){M+=V.n+" ";};for(I in J){var U=true;if(!J.hasOwnProperty(I)){continue;}T=J[I];R={};for(Q in T){if(!T.hasOwnProperty(Q)){continue;}L=C.call(this,Q);if(L<0){U=false;break;}if(!R.hasOwnProperty("maxIndex")){R.maxIndex=0;}H=T[Q]||[];M="";D.forEach(H,N);M=M.substring(0,M.length-1);K=H.length>0?H[0].id:"";R[L]={eNm:M,eId:K};R.maxIndex=Math.max(L,R.maxIndex);}if(U){O=P.call(this,R,O);}}this.removeAllSelections();this.previousSelected=O;this.refreshHighlights();},singleUnitSelect:function A(){var K=this.getSelections().length>0||this.clearSelectionsFlag;if(this.clearSelectionsFlag){delete this.clearSelectionsFlag;}if(K){var I=function(){var N=this.model.scm,P=Object.keys(N||{}),R=(P&&P[0])||"",M=this.model.data.gts,Q=M.row,O=M.col;D.forEach(Q.concat(O),function(S){if(P.indexOf(S.id)!==-1){R=S.id;return false;}});return R;};var J=function(){var N=this.model.scm,P=Object.keys(N||{}),R=[],M=this.model.data.gts,Q=M.row,O=M.col;D.forEach(Q.concat(O),function(S){if(P.indexOf(S.id)!==-1){R.push(S.id);}});return R;};var L=function(){var M={};M.tid=I.call(this);M.tids=J.call(this);M.eid="";M.isClearAll=false;M.anchor=this.domNode;M.at=G;M.selections=this.getSelections();M.selectionType=this.getSelectionType();return M;};var H=L.call(this);this.performAction([H]);}},clearSelections:function(){this.clearSelectionsFlag=true;if(this._super){this._super();}},clearCxtMnuSelection:function F(){if(this._super){this._super();}}});}());(function(){var E=false;mstrmojo.requiresCls("mstrmojo.Base");mstrmojo.netviz.PropertyParser=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.netviz.PropertyParser",methods:{unmarshal:function(W,V){var U=this;U._withConfig({unmarshal:true},function(){U.parsedProps[W]=V;});},marshal:function(V){var U=this;return U._withConfig({marshal:true},function(){return U.parsedProps[V];});}},init:function(U){if(this._super){this._super(U);}this.config={marshal:false,unmarshal:false};this.parsedProps={};},parse:function(V,X){var W=this,Y=this.parsedProps,U=this.methods;this.raw=V;this.schema=X;Object.keys(U).forEach(function(Z){W.defineMethod(Z,U[Z]);});Object.keys(X).forEach(function(Z){var a=X[Z];W.defineProperty(Z,a.type);Y.unmarshal(Z,V[a.key]);});return Y;},defineProperty:function(U,c){var b=this,W=b.config,a=this.parsedProps,V=(this.schema||{})[U]||{},g=V.preSet,Y=V.postSet,X=V.preGet,d=V.postGet,f=V.key,e=this.raw,Z;if(!T(c)){throw new TypeError("type does not implement required methods");}Object.defineProperty(a,U,{enumerable:true,get:function(){var h=Z;if(h!==undefined&&W.marshal){if(X instanceof Function){h=X.call(a,h,U,e,f);}h=c.marshal(h);if(d instanceof Function){h=d.call(a,h,U,e,f);}}return h;},set:function(i){var h=i;if(W.unmarshal){if(g instanceof Function){h=g.call(a,h,U,e,f);}h=c.unmarshal(h);if(Y instanceof Function){h=Y.call(a,h,U,e,f);}}if(h!==undefined&&!c.validate(h)){throw new TypeError("Invalid value in setter. Consider unmarshal(prop, val).");}Z=h;}});},defineMethod:function(X,U){var V=this,W=V.parsedProps;if(!L(X)||!(U instanceof Function)){return ;}Object.defineProperty(W,X,{enumerable:false,value:U.bind(V)});},_withConfig:function(W,Z){var X=this.config,Y=Object.keys(W||{}),V=Y.reduce(function(b,a){b[a]=X[a];return b;},{}),U;Y.forEach(function(a){X[a]=W[a];});U=Z();Y.forEach(function(a){X[a]=V[a];});return U;}});var O=Object.prototype.toString,G=mstrmojo.netviz.PropertyParser;function J(X,W,V){var U=parseInt(X,W);return isNaN(U)?V:U;}function N(U){return O.call(U)==="[object Number]";}function L(U){return O.call(U)==="[object String]";}var I=mstrmojo.declare(mstrmojo.Base,[],{scriptClass:"mstrmojo.netviz.PropertyParser.Property",init:function(U){if(this._super){this._super();}this.defval=U.defval;},marshal:function(U){return JSON.stringify(U).replace(/"/g,"'");}});G.BooleanProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.BooleanProperty",unmarshal:function(U){if(U===undefined){return this.defval;}return U.toString()==="true";},validate:function(U){return U===true||U===false||O.call(U)==="[object Boolean]";}});G.IntegerProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.IntegerProperty",unmarshal:function(U){return J(U,10,this.defval);},validate:N});G.FloatProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.FloatProperty",unmarshal:function(V){var U=parseFloat(V);return isNaN(U)?this.defval:U;},validate:N});G.JsonProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.JsonProperty",unmarshal:function(U){function V(X){var W;if(X!==undefined){try{W=JSON.parse(X.replace(/'/g,'"'));}catch(Y){W=X;}}return W;}if(typeof U==="string"){return V(U);}if(U!==undefined&&U!==null){return U;}return this.defval;},validate:function(U){return true;}});G.StringProperty=mstrmojo.declare(I,[],{scriptClass:"mstrmojo.netviz.PropertyParser.StringProperty",unmarshal:function(U){if(U!==undefined&&U!==null){return U.toString();}return this.defval;},marshal:function(U){return U;},validate:L});var K=["BooleanProperty","StringProperty","JsonProperty","IntegerProperty","FloatProperty"];K.forEach(function(U){var V=G[U];V.preset=function(W){return new V({defval:W});};});function T(U){return Q(U,["marshal","unmarshal","validate"]);}function Q(V,U){if(!V){return false;}return(U||[]).every(function(W){return V[W] instanceof Function;});}if(E){var C=new G(),F=G.BooleanProperty,H=G.IntegerProperty,B=G.FloatProperty,S=G.StringProperty,M=G.JsonProperty;var R={x:1,y:{x:"n+1"},z:true,m:3.14};var P={bp1:"false",bp2:"true",bp3:"",dp1:"12",dp2:22,fp1:23.3,fp2:"3.14",sp1:"foobar",jp1:R,jp3:"transparent"};var A={boolProp1:{key:"bp1",type:F.preset(false)},boolProp2:{key:"bp2",type:F.preset(false)},boolProp3:{key:"bp3",type:F.preset(false)},boolProp4:{key:"bp4",type:F.preset(false)},boolProp5:{key:"bp5",type:F.preset(true)},decimalProp1:{key:"dp1",type:H.preset(-1)},decimalProp2:{key:"dp2",type:H.preset(-1)},decimalPropn:{key:"dpn",type:H.preset(-1)},floatProp1:{key:"fp1",type:B.preset(0)},floatProp2:{key:"fp2",type:B.preset(0)},floatProp3:{key:"fp3",type:B.preset(0.03)},stringProp1:{key:"sp1",type:S.preset("")},stringProp2:{key:"sp2",type:S.preset("string")},jsonProp1:{key:"jp1",type:M.preset({})},jsonProp2:{key:"jp2",type:M.preset({})},jsonProp3:{key:"jp3",type:M.preset("error")}};var D=C.parse(P,A);console.assert(Object.keys(D).length===Object.keys(A).length,"wrong property count");console.assert(D.unmarshal instanceof Function,"unmarshal not found");console.assert(D.marshal instanceof Function,"marshal not found");console.assert(D.boolProp1===false);console.assert(D.boolProp2===true);console.assert(D.boolProp3===false);console.assert(D.boolProp4===false);console.assert(D.boolProp5===true);console.assert(D.marshal("boolProp5")==="true");D.unmarshal("boolProp5","false");console.assert(D.boolProp5===false);console.assert(D.marshal("boolProp5")==="false");console.assert(D.decimalProp1===12);console.assert(D.decimalProp2===22);console.assert(D.decimalPropn===-1);D.unmarshal("decimalProp1",42);console.assert(D.decimalProp1===42);console.assert(D.marshal("decimalProp1")==="42");console.assert(D.floatProp1===23.3);console.assert(D.marshal("floatProp1")==="23.3");console.assert(D.floatProp2===3.14);console.assert(D.floatProp3===0.03);D.unmarshal("floatProp3",100);console.assert(D.floatProp3===100);console.assert(D.stringProp1==="foobar");console.assert(D.stringProp2==="string");D.unmarshal("stringProp2","quux");console.assert(D.marshal("stringProp2")==="quux");D.unmarshal("stringProp2",42);console.assert(D.stringProp2==="42");console.assert(JSON.stringify(D.jsonProp1)===JSON.stringify(R));console.assert(Object.keys(D.jsonProp2).length===0);console.assert(D.jsonProp3==="transparent");console.assert(D.marshal("jsonProp1")===JSON.stringify(R).replace(/"/g,"'"));D.unmarshal("jsonProp2",true);console.assert(D.jsonProp2===true);console.assert(D.marshal("jsonProp2")==="true");console.info("PropertyParser: all tests processed");}}());(function(){mstrmojo.requiresCls("mstrmojo.Base","mstrmojo.gm.GMEnums");var A=mstrmojo.gm.EnumIdentityType;mstrmojo.gm.GMIdentities=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GMIdentities"});mstrmojo.gm.HeaderCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.HeaderCellIdentity",eid:undefined,v:undefined,tid:undefined,n:undefined,tui:undefined,fid:undefined,o:undefined,isRowAttribute:undefined,at:undefined,dei:undefined,dpt:undefined});mstrmojo.gm.GeneralIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.GeneralIdentity",objType:undefined});mstrmojo.gm.TitleCellIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.TitleCellIdentity",tid:undefined,fid:undefined,n:undefined,tui:undefined,isRowAttribute:undefined,otp:undefined,init:function(B){this.fid=B.fid;this.tid=B.id;this.isRowAttribute=B.isRowAttribute;if(B.isRowAttribute){this.objType=A.ROW_TITLE;}else{this.objType=A.COL_TITLE;}this.n=B.n;this.otp=B.otp;this.ost=B.ost;this.tui=B.tui;}});mstrmojo.gm.MetricAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.MetricAxisTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AttributeAxisTitleIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AttributeAxiTitleIdentity",init:function(B){this._super(B);}});mstrmojo.gm.AxisIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.AxisIdentity",isNumericAxis:undefined,metricIdxArr:undefined,attrIdArr:undefined});mstrmojo.gm.ColorSquareIdentity=mstrmojo.declare(mstrmojo.Base,null,{scriptClass:"mstrmojo.gm.ColorSquareIdentity",init:function(B){this._super(B);this.comb=this.getElementsCombination();},getElementsCombination:function(){var B,F=this.token,C,H,G,E,I,D;if(F){D=[];C=F.levels;H=F.elements;G=F.types;B=C.length;for(E=0;E<B;E++){I={eid:H[E],tid:C[E]};if(G){I.tp=G[E];}D.push(I);}return D;}return undefined;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var C=Math,I=mstrmojo.dom,K=mstrmojo.css,E="active",L="ready",J=6,F=10,O=10,P={LASSO_SELECTOR:"lasso-selector",LASSO_RESIZER:"lasso-resizer",BUTTON:"button"};mstrmojo.util.ui.LassoSelectorParamsType=null;function Q(S,R,T){return function(U){S.call(mstrmojo.all[R],U,T);};}function M(S){var U=S.view,T=I.eventTarget(window,S),R=this.lassoSelector;if(this.clickFromLassoResizer||(T!==R&&this.clickFromCreatingLasso)){I.stopPropogation(U,S);I.preventDefault(U,S);}delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;}function D(b,U){var R,d,S,Z,a=b.clientX,Y=b.clientY,T=this.lassoSelector,X=U.startX,W=U.startY,V=U.containerPos,e=a-V.x,c=Y-V.y;e=C.min(e,U.maxX);e=C.max(e,U.minX);c=C.min(c,U.maxY);c=C.max(c,U.minY);R=C.abs(e-X);d=C.abs(c-W);Z=C.min(W,c);S=C.min(X,e);T.style.width=R+"px";T.style.height=d+"px";T.style.left=S+"px";T.style.top=Z+"px";U.width=R;U.height=d;U.left=S;U.top=Z;if(R<=O&&d<=O){T.style.visibility="hidden";K.removeClass(T,E);}else{T.style.visibility="visible";K.addClass(T,E);document.body.style.cursor="crosshair";}}function H(T,W){var V=window.document,S=this.lassoSelector,U=W.width,R=W.height;I.detachEvent(V,"mousemove",W.fnMove);I.detachEvent(V,"mouseup",W.fnUp);delete W.fnMove;delete W.fnUp;document.body.style.cursor="default";if(!U||U===0||!R||R===0){this.dismissLassoSelector();}else{W.ctrlKey=T.ctrlKey;this.lassoSelected(W);this.clickFromCreatingLasso=true;K.addClass(S,L);this.positionBoxResizers();}}function N(g){var Z,c=g.view,b,a,d=I.eventTarget(window,g),R=d.getAttribute("type"),V=this.lassoSelector,S=this.lassoContainer,h=this.excludeAttrArr,U=h.length,Y,X={};delete this.clickFromLassoResizer;delete this.clickFromCreatingLasso;if(!V||!S||!this.lassoSelectorEnabled){return ;}if(I.contains(this.dropDownBtn,d,true)){return ;}for(Z=0;Z<U;Z++){if(R===h[Z]){return ;}}this.lassoSelecting();Y=I.position(S);b=g.clientX-Y.x;a=g.clientY-Y.y;X.containerPos=Y;X.maxX=Y.w;X.maxY=Y.h;X.startX=b;X.startY=a;X.minX=0;X.minY=0;X.info=this.getLassoSelectionInfo(d);X.useAsSelectorOrBrushes=this.useAsSelectorOrBrushes||((this.hasAssociatedNodes&&this.hasAssociatedNodes())||this.selectorControl);V.style.visibility="hidden";V.style.left=b+"px";V.style.top=a+"px";V.style.width="0px";V.style.height="0px";K.removeClass(V,L);S.appendChild(V);var T=this.id,e=document,W=Q(D,T,X),f=Q(H,T,X);I.attachEvent(e,"mousemove",W);I.attachEvent(e,"mouseup",f);X.fnMove=W;X.fnUp=f;I.stopPropogation(c,g);I.preventDefault(c,g);}function G(a,U){var Y=U.index,X=U.startX,W=U.startY,V=U.containerPos,f=a.clientX-V.x,e=a.clientY-V.y,T=this.lassoSelector;f=C.min(f,U.maxX);f=C.max(f,U.minX);e=C.min(e,U.maxY);e=C.max(e,U.minY);var d=f-X,c=e-W;if(Y%3===1){d=0;}if(Y===3||Y===5){c=0;}var R=U.selWidth,b=U.selHeight,S=U.selLeft,Z=U.selTop;if(d!==0){if(Y%3===0){S+=d;R-=d;}else{R+=d;}}if(c!==0){if(Y<3){Z+=c;b-=c;}else{b+=c;}}T.style.width=R+"px";T.style.left=S+"px";T.style.top=Z+"px";T.style.height=b+"px";U.width=R;U.left=S;U.height=b;U.top=Z;this.positionBoxResizers();}function B(R,U){var T=R.view,S=window.document;I.detachEvent(S,"mousemove",U.fnMove);I.detachEvent(S,"mouseup",U.fnUp);delete U.fnMove;delete U.fnUp;this.clickFromLassoResizer=true;I.stopPropogation(T,R);I.preventDefault(T,R);this.lassoSelectorResized(U);}function A(V){var T=V.view,h=I.eventTarget(window,V),U=parseInt(h.getAttribute("index"),10),a=this.lassoSelector,Z=a.offsetLeft,j=a.offsetTop,Y=Z+a.offsetWidth,g=j+a.offsetHeight,R=I.position(this.lassoContainer),f=0,c=0,d=R.w,b=R.h,e={};if(U%3===0){d=Y-F;}if(U%3===2){f=Z+F;}if(U<3){b=g-F;}if(U>=6){c=j+F;}e.minX=f;e.minY=c;e.maxX=d;e.maxY=b;e.startX=V.clientX-R.x;e.startY=V.clientY-R.y;e.index=U;e.containerPos=R;e.selWidth=a.clientWidth;e.selHeight=a.clientHeight;e.selLeft=a.offsetLeft;e.selTop=a.offsetTop;var X=this.id,i=document,S=Q(G,X,e),W=Q(B,X,e);I.attachEvent(i,"mousemove",S);I.attachEvent(i,"mouseup",W);e.fnMove=S;e.fnUp=W;I.stopPropogation(T,V);I.preventDefault(T,V);}mstrmojo.util.ui._LassoSelector=mstrmojo.provide("mstrmojo.util.ui._LassoSelector",{_mixinName:"mstrmojo.util.ui._LassoSelector",lassoContainer:undefined,lassoSelector:undefined,lassoSelectorEnabled:true,excludeAttrArr:null,boxResizers:null,useDropDownBtn:false,dropDownBtn:undefined,init:function(R){if(this._super){this._super(R);}this.excludeAttrArr=[];this.boxResizers=[];},registerLassoSelector:function(S,V,U){V=V||[];V.push(P.LASSO_SELECTOR);V.push(P.LASSO_RESIZER);V.push(P.BUTTON);this.lassoContainer=S;this.excludeAttrArr=V;this.useDropDownBtn=U||false;I.attachEvent(S,"mousedown",Q(N,this.id));I.attachEvent(S,"click",Q(M,this.id));var R=this.lassoSelector;if(!R){R=this.createLassoSelector();this.lassoSelector=R;}var T=R.parentNode;if(T){T.removeChild(R);}},createLassoSelector:function(){var U,V,S,T=this.boxResizers,R=document.createElement("div");R.setAttribute("class","lasso-selector");R.setAttribute("type",P.LASSO_SELECTOR);R.setAttribute("draggable",false);R.draggable=false;for(U=0;U<9;U++){if(U!==4){V=document.createElement("div");V.setAttribute("class","lasso-selector-resizer");V.setAttribute("type",P.LASSO_RESIZER);V.setAttribute("index",String(U));V.setAttribute("draggable",false);V.draggable=false;R.appendChild(V);T[U]=V;I.attachEvent(V,"mousedown",Q(A,this.id));}}K.addClass(T[0],["top","left"]);K.addClass(T[1],["top"]);K.addClass(T[2],["top","right"]);K.addClass(T[3],["left"]);K.addClass(T[5],["right"]);K.addClass(T[6],["bottom","left"]);K.addClass(T[7],["bottom"]);K.addClass(T[8],["bottom","right"]);if(this.useDropDownBtn===true){S=document.createElement("div");S.setAttribute("type",P.BUTTON);S.setAttribute("class","lasso-selector-dropdown-button");R.appendChild(S);I.attachEvent(S,"click",Q(this.lassoButtonClicked,this.id));this.dropDownBtn=S;}return R;},positionBoxResizers:function(){var T=this.boxResizers,S=this.lassoSelector,U=S.clientWidth,R=S.clientHeight,W=(U-J)>>1,V=(R-J)>>1;T[1].style.left=W+"px";T[3].style.top=V+"px";T[5].style.top=V+"px";T[7].style.left=W+"px";},dismissLassoSelector:function(){var R=this.lassoSelector;if(R){K.removeClass(R,[E,L]);if(R.parentNode){R.parentNode.removeChild(R);}}},isLassoSelectorActive:function(){function S(V,U){var W=V.className.split(/\s+/),T;for(T=0;T<W.length;T++){if(W[T]===U){return true;}}return false;}var R=this.lassoSelector;if(R){return S(R,E);}return false;},getLassoSelectionInfo:mstrmojo.emptyFn,lassoSelected:mstrmojo.emptyFn,lassoSelecting:mstrmojo.emptyFn,lassoButtonClicked:mstrmojo.emptyFn,lassoSelectorResized:mstrmojo.emptyFn});}());(function(){mstrmojo.requiresCls("mstrmojo.util.color");var Q=mstrmojo.util.color;var O={Min:15872549,Max:1489202,Invalid:0,NoColorMetric:16119287};var G={LeftToRight:0,RightToLeft:1,Center:2,None:3};var M={dark:[1487103,16725801,309794,16750094,11434462,13421861,1691360,11119017,11783663,16754582,10018698,16760704,14337004,14803088,10608618,14079702],light:[2062260,14034728,2924588,16744206,9725885,12369186,1556175,8355711,11454440,16750742,10018698,16759672,12955861,14408589,10410725,13092807]};function K(V,h,Z){if(V<0||V>1){return 0;}var W=256,Y=V*W,R,X,a,U=h>>16,T=Z>>16,d=(h&65280)>>8,c=(Z&65280)>>8,S=(h&255),f=(Z&255);R=U+Math.floor((Y*(T-U)/W));X=d+Math.floor((Y*(c-d)/W));a=S+Math.floor((Y*(f-S)/W));return a+(X<<8)+(R<<16);}function F(S,V){var U=S>>16,T=(S&65280)>>8,R=(S&255);U=Math.floor((1-V)*U);T=Math.floor((1-V)*T);R=Math.floor((1-V)*R);return R+(T<<8)+(U<<16);}function J(R){var X=[],W,S,U=R.dp,T=U.length,Y,Z,V;if(R===null||R.length===0){return[];}for(V=0;V<T;V++){S={};if(V>0){Y=W;W=Z;}else{W=U[V];}if(V<T-1){Z=U[V+1];}S.sv=(V===0)?W.v:(Y.v+W.v)/2;S.ev=(V===T-1)?W.v:(Z.v+W.v)/2;S.c=W.c;S.d=(V===0)?G.LeftToRight:(V===T-1?G.RightToLeft:G.Center);X[V]=S;}return X;}function E(Y){var X=[],W,V,U=Y.dp,R=U.length,S;if(Y===null||Y.length===0){return[];}for(S=0;S<R;S++){W={};V=U[S];W.c=V.c;switch(V.d){case G.LeftToRight:W.v=V.s;break;case G.RightToLeft:W.v=V.e;break;default:var T=(V.s+V.e)/2;W.v=T;break;}X[S]=W;}return X;}function L(a){if(isNaN(a)){return O.Invalid;}if(this.max===this.min){return this.blendEqualColor;}var T=this.blend.dp,S=T.length;if(!this.valid){var d=T[0],W=T[S-1];if(a<this.min){return d.c;}return W.c;}var U,Y=T[0],b=Y.v,X=Y.c,Z,V;for(U=1;U<S;U++){Y=T[U];if(Y.v>=a){break;}b=Y.v;X=Y.c;}U=Math.min(U,S-1);Y=T[U];Z=Y.v;V=Y.c;if(a<b){return X;}if(a>Z){return V;}if(b===Z){return K(0.5,X,V);}var R=(a-b)/(Z-b);return K(R,X,V);}function D(V,a){var R=[],S=[],X=[];if(this.min===this.max||isNaN(V)||isNaN(a)||V===a){R[0]=L.call(this,V);R[1]=L.call(this,a);S[0]=1;S[1]=1;X[0]=0;X[1]=1;}else{if(this.min<this.max){var Z,U=this.blend.dp,T=U.length,Y=0,W;R[Y]=L.call(this,V);S[Y]=1;X[Y]=0;Y++;for(W=0;W<T;W++){Z=U[W];if(Z.v>=V&&Z.v<=a){R[Y]=Z.c;S[Y]=1;X[Y]=(Z.v-V)/(a-V);Y++;}}R[Y]=L.call(this,a);S[Y]=1;X[Y]=1;}}return{c:R,a:S,r:X};}function I(T,W){var U=0.4,S=F(W.c,U),R,V;switch(W.d){case G.LeftToRight:if(T<W.s){return W.c;}if(T>W.e){return S;}if(W.s===W.e){return K(0.5,W.c,S);}V=(T-W.s)/(W.e-W.s);return K(V,W.c,S);case G.RightToLeft:if(T<W.s){return S;}if(T>W.e){return W.c;}if(W.s===W.e){return K(0.5,S,W.c);}V=(T-W.s)/(W.e-W.s);return K(V,S,W.c);case G.Center:R=(W.s+W.e)/2;if(T<W.s||T>W.e){return S;}if(W.s===W.e){return S;}if(T<=R){V=(T-W.s)/(R-W.s);return K(V,S,W.c);}V=(T-R)/(W.e-R);return K(V,W.c,S);default:return W.c;}}function B(S){if(isNaN(S)){return O.Invalid;}if(this.min===this.max){return this.bandEqualColor;}var X=this.band.dp,R=X.length;if(!this.valid){var U=X[0],V=X[R-1];if(S<this.min){return I(V.s,U);}if(S>=this.min){return I(V.e,V);}}var W=X[0],T;if(W.s>=S){return I(S,W);}for(T=0;T<R;T++){W=X[T];if(W.s<=S&&S<W.e){return I(S,W);}}return I(S,W);}function A(V,f){var R=[],S=[],X=[];if(this.min===this.max||isNaN(V)||isNaN(f)||V===f){R[0]=B.call(this,V);R[1]=B.call(this,f);S[0]=1;S[1]=1;X[0]=0;X[1]=1;}else{if(this.min<this.max){var U=this.band.dp,T=U.length,g=0.4,b,e,j,W,Z=0;if(V<0){R[Z]=B(V);S[Z]=1;X[Z]=0;Z++;if(f<1){R[Z]=B(f);S[Z]=1;X[Z]=1;Z++;}}for(W=0;W<T;W++){b=U[W];if(b.s>f||b.e<V){continue;}e=b.c;j=F(e,g);var h=Math.max(b.s,V),d=Math.min(b.e,f);if(d!==h){switch(b.d){case G.LeftToRight:case G.RightToLeft:case G.Center:if(h===b.s){R[Z]=(b.d!==G.LeftToRight)?j:e;}else{R[Z]=B.call(this,h);}X[Z]=(h-V)/(f-V);S[Z]=1;Z++;if(b.d===G.Center){var Y=(b.s+b.e)/2;if(Y>h&&Y<d){R[Z]=e;X[Z]=(Y-V)/(f-V);S[Z]=1;Z++;}}if(d===b.e){R[Z]=(b.d!==G.RightToLeft)?j:e;}else{R[Z]=B.call(this,d);}X[Z]=(d-V)/(f-V);S[Z]=1;Z++;break;default:R[Z]=e;X[Z]=(h-V)/(f-V);S[Z]=1;Z++;R[Z]=e;X[Z]=(d-V)/(f-V);S[Z]=1;Z++;break;}}}if(f>1){if(V>1){R[Z]=B.call(this,V);X[Z]=0;S[Z]=1;Z++;}R[Z]=B.call(this,f);X[Z]=1;S[Z]=1;}}}return{c:R,a:S,r:X};}function P(S,R){this.blend.dp=[];var U=this.blend.dp,T;T={};T.c=S;T.v=0;U[0]=T;T={};T.c=R;T.v=1;U[1]=T;}function N(S,R){this.band.dp=[];var U=this.band.dp,T;T={};T.d=G.LeftToRight;T.s=0;T.e=0.5;T.c=S;U[0]=T;T={};T.d=G.LeftToRight;T.s=0.5;T.e=1;T.c=R;U[1]=T;}function C(r,U,q){var W=[],V=0,Z,o,e=this.min,h=this.max,T=q.legendTickCount,S={},R,Y=!isNaN(this.min)&&!isNaN(this.max),j;if(this.min>=this.max||this.blend.dp.length<=2){var k=(h-e)/T;for(j=0;j<r;j++){S={x:V,w:Math.floor(U/T)};V+=S.w;if(Y){Z=e+j*k;o=Z+k;R=this.getColor((Z+o)/2);}else{Z="Null";o="Null";R=0;}W.push({r:S,c:R,sv:Z,ev:o});}}else{var b=this.blend.dp,g=b.length;for(j=0;j<g;j++){var m=b[j],X,a;if(j===0){Z=e;}else{X=b[j-1];Z=e+(h-e)*(m.v+X.v)/2;}if(j===g-1){o=h;}else{a=b[j+1];o=e+(h-e)*(m.v+a.v)/2;}S={x:V,w:Math.floor(U*(o-Z)/(h-e))};V+=S.w;if(Y){R=this.getColor((Z+o)/2);}else{Z="Null";o="Null";R=0;}W.push({r:S,c:R,sv:Z,ev:o});}}this.tooltipInfo=W;}function H(o,U,n){var W=[],V=0,Y,m,f=this.min,g=this.max,T=n.legendTickCount,S={},R,a="",X=!isNaN(this.min)&&!isNaN(this.max),h,k;if(this.min>=this.max){for(h=0;h<o;h++){S={x:V,w:Math.floor(U/T)};a+=S.w;if(X){R=this.getColor(f);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});}}else{var Z=this.band.dp,e=Z.length,j,b;if(e<=2){for(h=0;h<e;h++){k=Z[h];if(h===0){Y=f;}else{Y=f+(g-f)*k.s;}if(h===e-1){m=g;}else{m=f+(g-f)*k.e;}S={x:V,w:Math.floor(U*(m-Y)/(g-f)/2)};V+=S.w;if(X){m=(Y+m)/2;R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});V+=S.w;j=U*(m-Y)/(g-f)/2;S={x:V,w:Math.ceil(j)};if(h>0){b=W[W.length-1].r;if(S.x<b.x+b.w+1){b.w=S.x-b.x;}}V+=Math.floor(j);if(X){Y=(Y+m)/2;R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}W.push({r:S,c:R,sv:Y,ev:m});}}else{for(h=0;h<e;h++){k=Z[h];if(h===0){Y=n.props.legendAsc?f:g;}else{Y=n.props.legendAsc?f+(g-f)*k.s:g+(f-g)*k.s;}if(h===e-1){m=n.props.legendAsc?g:f;}else{m=n.props.legendAsc?f+(g-f)*k.e:g+(f-g)*k.e;}j=U*(m-Y)/(g-f);S={x:V,w:Math.ceil(j)};if(h>0){b=W[W.length-1].r;if(S.x<b.x+b.w+1){b.w=S.x-b.x;}}if(h===e-1){S.w=U-V;}V+=Math.floor(j);var p=n.props.legendAsc?" < ":" > ";if(X){R=this.getColor((Y+m)/2);}else{Y="Null";m="Null";R=0;}if(p){W.push({r:S,c:R,sv:Y,ev:m});}else{W.push({r:S,c:R,sv:Y,ev:m,sign:">"});}}}}this.tooltipInfo=W;}mstrmojo.heatmap.vi.VisHeatMapColorTheme={newInstance:function(){return{initialize:function V(){this.blend={};this.band={};this.valid=true;this.blendEqualColor=0;this.bandEqualColor=0;this.isBlend=true;this.style="dark";this.setDefaultDataProvider();this.checkMinMax();},getGradientFillInfo:function Y(e,b){var f,c;if(isNaN(e)||isNaN(b)){if(this.isBlend){return D.call(this,e,b);}return A.call(this,e,b);}if(this.min===this.max){if(e<this.min){f=0;}else{f=1;}if(b<this.max){c=0;}else{c=1;}}else{var g;if(this.isFixedColorBanding){g=this.initMax-this.initMin;f=(e-this.initMin)/g;c=(b-this.initMin)/g;}else{g=this.max-this.min;f=(e-this.min)/g;c=(b-this.min)/g;}}if(this.isBlend){return D.call(this,f,c);}return A.call(this,f,c);},checkMinMax:function W(){var h=this.min,b=this.max;if(h>b){this.valid=false;}else{if(h===b){h=b=1;var k=this.blend.dp,d=k.length,j,g,f;for(g=d-1;g>=0;g--){j=k[g];if(g===d-1&&j.v<=h){this.blendEqualColor=j.c;break;}if(g===0&&j.c>=h){this.blendEqualColor=j.c;break;}if(g>0&&j.c>=h){var e=k[g-1];if(e.c<h){f=(h-e.v)/(j.v-e.v);this.blendEqualColor=K(f,e.c,j.c);break;}}}k=this.band.dp;d=k.length;for(g=0;g<d;g++){j=k[g];if((g===0&&j.s>=h)||(g===d-1&&j.e<=h)||(j.s<=h&&j.e>=h)){this.bandEqualColor=j.c;break;}}}}},setDefaultDataProvider:function a(){P.call(this,O.Min,O.Max);N.call(this,O.Min,O.Max);this.useDefault=true;},getColor:function S(b){if(this.colorByType==="attribute"){return M[this.themeType][b%16];}if(this.hasNoColorMetric){return O.NoColorMetric;}var c=NaN;if(isNaN(b)){c=0;}else{if(this.min===this.max){c=b<this.min?0:1;}else{if(this.isFixedColorBanding){c=(b-this.initMin)/(this.initMax-this.initMin);}else{c=(b-this.min)/(this.max-this.min);}}}if(this.isBlend){return L.call(this,c);}return B.call(this,c);},isBrightColor:function Z(i){var f=i>>16,e=(i&65280)>>8,d=(i&255),h=(f*299+e*587+d*114)/1000;if(h>150){return true;}return false;},getContrastColor:function R(b){if(Q.isGradientColor(b)){b=b.c1;}if(this.isBrightColor(b)){return 0;}return 16777215;},createTooltipInfo:function U(e,c,g){var f=0;if(this.min>=this.max){f=1;}else{var b;if(this.isBlend){b=this.blend.dp.length;f=(b<=2)?5:b;}else{b=this.band.dp.length;f=(b<=2)?4:b;}}if(this.isBlend){C.call(this,f,c,g);}else{H.call(this,f,c,g);}},getTooltipInfo:function T(b){var d=this.tooltipInfo;var c;for(c=0;c<d.length;c++){var f=d[c],e=f.r;if(b>=e.x&&b<e.x+e.w){return c;}}return c-1;},getMaxMinByMetricID:function(o,c){var d=o.gts.col,l=d.length,g=0,k=null,h={min:null,max:null};for(g=0;g<l&&k===null;g++){var n=d[g].es,b=n.length,f;for(f=0;f<b;f++){if(n[f].oid===c){k=f;break;}}}if(k===null){return h;}var e=o.gvs.items||[];l=e.length;for(g=0;g<l;g++){var m=parseFloat(e[g].items[k].rv);if(h.min===null){h.min=m;}if(h.max===null){h.max=m;}if(h.min>m){h.min=m;}if(h.max<m){h.max=m;}}return h;},convertFixedValueToBlendString:function(f,e){var l="";if(f.length%2===0){var b=f.length,c=e.min,g=e.max,d=0;var k=g-c;l="0,"+f[1];for(d=2;d<b-2;d+=2){var j=parseInt(f[d],10);if(j<c||j>g){continue;}else{var h=(j-c)/k;l+=","+h+","+f[d+1];}}l+=",1,"+f[b-1];}return l;},convertAbsoluteToBlend:function(d,f){this.useDefault=false;this.isColorBanding=true;var b=f.abs.replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");b=(new window.DOMParser()).parseFromString(b,"text/xml");var e=b.getElementsByTagName("m")[0];d.absoluteColorID=e.getAttribute("id");this.isFixedColorBanding=true;this.fixedBandingArray=e.getAttribute("bl").split(",");var c;if(!isNaN(this.min)&&!isNaN(this.max)){c={max:this.max,min:this.min};}else{c=this.getMaxMinByMetricID(d.modelData,d.absoluteColorID);this.max=c.max;this.min=c.min;}if(isNaN(this.initMax)||isNaN(this.initMin)){c=this.getMaxMinByMetricID(d.modelData,d.absoluteColorID);this.max=c.max;this.min=c.min;this.initMax=c.max;this.initMin=c.min;}f.bandColors=e.getAttribute("ba");f.gradientColors=this.convertFixedValueToBlendString(this.fixedBandingArray,c);},createDataProviderFromString:function X(j,h){var b=j.split(","),d=0,g,f;this.blend.dp=[];this.useDefault=false;g=this.blend.dp;if(b.length%2===0){while(d<b.length){f={};f.v=parseFloat(b[d]);d++;f.c=parseInt(b[d],10);d++;g[g.length]=f;}}d=0;b=h.split(",");this.band.dp=[];g=this.band.dp;if(b.length%4===0){while(d<b.length){f={};f.s=parseFloat(b[d]);d++;f.e=parseFloat(b[d]);d++;f.c=parseInt(b[d],10);d++;var e=b[d];switch(e){case"leftToRight":f.d=G.LeftToRight;break;case"rightToLeft":f.d=G.RightToLeft;break;case"center":f.d=G.Center;break;default:f.d=G.None;}d++;g[g.length]=f;}}},getBackgroundColor:function(){if(this.style==="light"){return"#ffffff";}return"#333333";},decodeAttriColorByColor:function(c){if(typeof c==="object"){return c;}var b=this.RGB_BRG_Switch(c);return mstrmojo.color.decodeColor(b);},RGB_BRG_Switch:function(c){var e=(c>>16)&255,d=(c>>8)&255,b=(c>>0)&255;return(b<<16)|(d<<8)|(e<<0);}};}};}());(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash");var B="___value",E="___parent",A="___key_map",D="___IS_LEAF";mstrmojo.netviz.ObservableModel=mstrmojo.declare(mstrmojo.Obj,[],{scriptClass:"mstrmojo.netviz.ObservableModel",init:function(H){var G=[];H=H||{};H=mstrmojo.hash.clone(H);var L=Object.keys(H),F=L.length,K,J;for(K=0;K<F;K++){var I=L[K],M=H[I];if(!(M instanceof Object)){J=new C();J[B]=M;J[D]=true;H[I]=J;}else{H[I]=J=new C(M);}G.push(J);H[I][E]=this;}if(this._super){this._super(H);}this.addDisposable(G);this[A]=H;},getParent:function(){return this[E];},getChildrenKeys:function(){return Object.keys(this[A]);},isLeafNode:function(){return this[D];},getValue:function(){if(this.isLeafNode()){return this[B];}return this.getRawObject();},setValue:function(G,K){var F=this.getValue();var M,J,I,L,H;if(this.isLeafNode()){if(!(G instanceof Object)){if(F!==G){this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{this[B]=undefined;this[D]=undefined;this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}else{var N=this.getChildrenKeys();J=N.length;for(I=0;I<J;I++){L=N[I];this[L]=undefined;}if(!(G instanceof Object)){this[D]=true;this[B]=G;this[A]=undefined;this[B]=G;if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}else{this[A]=G;M=Object.keys(G);J=M.length;H=this.addDisposable(new C(G));for(I=0;I<J;I++){L=M[I];this[L]=H[L];H[E]=this;}if(!K){this.raiseEvent({name:"valueChanged",target:this,oldValue:F,newValue:G});}}}},stopPropagation:function(F){F._isStopped=true;},raiseEvent:function(G){if(this._super){this._super(G);}if(G._isStopped){return ;}var F=this.getParent();if(F){F.raiseEvent(G);}},getRawObject:function(){var G={},J=this.getChildrenKeys(),F=J.length,I;for(I=0;I<F;I++){var H=J[I],K=this[H];if(K.isLeafNode()){G[H]=K.getValue();}else{G[H]=K.getRawObject();}}return G;}});var C=mstrmojo.netviz.ObservableModel;}());(function(){mstrmojo.requiresCls("mstrmojo._HasPopup","mstrmojo.Button","mstrmojo.dom","mstrmojo.Container");mstrmojo.requiresDescs(1442,2140);var C=mstrmojo.dom;mstrmojo.ui.menus.ToolbarEditor=mstrmojo.declare(mstrmojo.Container,[mstrmojo.ui.menus._IsMenuPopup,mstrmojo._IsPopup,mstrmojo._CanAutoClose],{scriptClass:"mstrmojo.ui.menus.ToolbarEditor",markupString:'<div id="{@id}" class="mstrmojo-ui-ToolbarEditor mstrmojo-ui-MenuEditor {@cssClass}" style="..." mstrAttach:mouseover,mouseout,click><div class="te-content"></div></div>',markupSlots:{containerNode:function A(){return this.domNode.firstChild;}},popupConfig:null,children:null,autoCloses:false,locksHover:true,visible:true,onclick:function B(E){C.stopPropogation(null,E.e);},init:function D(F){this._super(F);var E=this.popupConfig,G=E.contents;if(!G){throw new Error("Cannot open editor without editor content.");}this.cssClass=E.cssClass;this.addChildren(G);}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.PopupConfig","mstrmojo.ui.menus.ToolbarEditor","mstrmojo.hash");mstrmojo.ui.menus.ToolbarEditorConfig=mstrmojo.declare(mstrmojo.ui.PopupConfig,[mstrmojo._HasBindings],{scriptClass:"mstrmojo.ui.menus.ToolbarEditorConfig",cssClass:"",contents:null,init:function C(D){this._super(D);this.initBindings();},clear:function A(){this._super();this.contents=null;},newInstance:function B(D){return new mstrmojo.ui.menus.ToolbarEditor(mstrmojo.hash.copy({popupConfig:this},D));}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var N=mstrmojo.gm.EnumTRFManipulations;var J=mstrmojo.array,C=mstrmojo.hash,M=mstrmojo.func.wrapMethods,G=mstrmojo.func.composite,I=mstrmojo.VisEnum.GMLegendFormatingPropertyTag;var D={silent:false,undo:mstrmojo.emptyFn,redo:mstrmojo.emptyFn};function K(O){return O.model.controller.cmdMgr;}function L(){return(this.getDocModel&&this.getDocModel())||this.model.docModel;}function H(){return{success:function O(){this.raiseEvent({name:"regenerateToolbar"});}.bind(this)};}function E(P,R){var O,U,Q,S,T={};T.tks=this.k;T.selectorObjects=P;T.keepOnly=!!R;T.isDocVis=true;O=L.call(this);U=O.getDataService();Q=U.getGMViewFilterAction(T);S=O.getSliceCallback(T);return{action:Q,callbacks:S};}function B(Q,P){var O,S,R;O=L.call(this);R=O.getDataService();if(!this.isXMLDirty()){R.submitUpdates(Q,P);}else{S=this.getPersistAction();R.submitUpdates([Q,S],P);this.resetXMLDirtyFlag();}}function A(){var b=this.modelData||this.model.data,S=b.k,Z,Y="FormattingWidget",U,T,X,P,Q,R=[],W=[],V=this.edtModel;if(!b){console.log("warning: modelData is missing");return null;}var a=function(d,f){var c=T.createElement(f),e;if(d instanceof Object){for(e in d){if(d.hasOwnProperty(e)){var g=a(d[e],e);if(g){c.appendChild(g);}}}}else{c.setAttribute("value",d);}return c;};var O=function(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");};X=this.createWidgetPropsXML?this.createWidgetPropsXML():null;if(!X||X.length===0){U=this.getProperties(S);if(this.useCompatibleXML){T=(new DOMParser()).parseFromString("<widgetProps></widgetProps>","text/xml");T.firstChild.appendChild(a(U,"fmt"));}else{T=(new DOMParser()).parseFromString("<props><widgetProps></widgetProps></props>","text/xml");T.firstChild.firstChild.appendChild(a(U,"fmt"));}X=(new XMLSerializer()).serializeToString(T);}P=O(X);Q={act:"setProperty",nodeKey:S,prs:Y,pri:4,v:P};R.push(Q);return R;}function F(P,Q,O,T){if(!(T instanceof Function)){return D;}var S=this.id;function R(U){return function(){var W=mstrmojo.all[S],V;if(!W){return ;}V=W.getProperties();V[P]=U;T.call(W,U,true);W.getDocModel().selectVIUnit(W.parent.id,true);};}return{silent:true,undo:R(O),redo:R(Q)};}mstrmojo._VizSelectionHelper=mstrmojo.provide("mstrmojo._VizSelectionHelper",{postBuilderingCalled:false,listenToUpdateColorMap:function(R){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var Q=this,P,O=(Q.getDocModel&&Q.getDocModel())||Q.model.docModel;if(O){return O.attachEventListener("colorMapChanged",Q.id,function(T){P=Q.parent&&Q.parent.parent;if(Q.forceUpdateColorMap||(P&&P.isPanelDisplaying())){R.call(Q);}else{var S=P.attachEventListener("panelDisplaying",Q.id,function(U){if(Q.postBuilderingCalled){R.call(Q);}P.detachEventListener(S);});}});}},detachUpdateColorMapListener:function(P){if(!P){return ;}var O=(this.getDocModel&&this.getDocModel())||this.model.docModel;O.detachEventListener(P);},updateTargets:function(P){var S={},Q=this,O=L.call(this);S.fromGM=true;S.type=1;S.src=this.k;S.selectorObjects=P;function R(V){var T=Q.modelData||Q.model.data,U=T.sc;if(U!==undefined){return U[V];}return undefined;}S.keepOnly=true;S.ck=R.call(this,"ck");S.keyContext=S.ck;S.tks=R.call(this,"tks");S.ckey=R.call(this,"ckey");S.isDocVis=true;S.include=true;S.showall=R.call(this,"showall");O.slice(S);},updateAfterViewFilter:function(Q,O){var V,U,P,T,S,W,R;V=L.call(this);U=V.getDataService();T=E.call(this,Q,O);P=T.action;S=T.callbacks;R=this.model.controller||V.controller;if(this.currKeepOnlyAction){W=[C.clone(this.currKeepOnlyAction)];}else{W=E.call(this,[],false).action;}this.currKeepOnlyAction=P;R.submitUndoRedoUpdates([P],W,S);},updateAfterKeepOnly:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnly(this,R,{keepOnly:Q,data:this.getContextMenuSelections()},Q?-2:undefined);},updateAfterKeepOnlyForMultiTemplate:function(Q){var P=L.call(this),O=this.model.controller||P.controller,R=M(O._getXtabCallback(this),H.call(this));O.applyKeepOnlyForMutilTemplate(Q,R,true);},updateAfterDrill:function(O,c,Y){var Z=this,d=L.call(this),b=d.getDataService(),T=b.newUpdate(),R=this.getContextMenuSelections(),P=Y||this,S=P.model,U=P.model.data||P.node.data,X=S.getSelectorDataFromTemplateLimit(U.tpl).concat({keepOnly:true,data:R}),Q=d.getKeepOnlyOrExcludeAction(U.k,X),V=Z.model.controller||d.controller,W=V._getXtabCallback(Z);T.add(O,M(c,W));T.add(Q,H.call(Z));K(Z).execute({execute:function a(){this.submitUpdate(T);},urInfo:{callback:T.callback}});},updateAfterSort:function(R){var P=this,O=L.call(this),S=O.getDataService(),T=O.getSliceCallback({tks:P.k});K(P).execute({execute:function Q(){var V=S.newUpdate(this,undefined),U={act:"sortGM",nodeKey:P.k,subActions:R,partialUpdate:{nodes:[P.k]}};V.add(U,T,undefined);if(P.isXMLDirty()){V.addActions(P.getPersistAction());}this.submitUpdate(V,undefined);},urInfo:{callback:T}});},updateAfterAction:function(T,O,P,a,X){if(!T){return ;}var V=this,Q=V.parent&&V.parent.id,b=V.model.docModel,U=V.model.controller||b.controller,Z,Y,S={},W,R=X||D;if(P){Z=mstrmojo.emptyFn;W=function(){this.submitSilent(T);};}else{Z=b.getSliceCallback({tks:this.k});Z.success=G([Z.success,function(){b.selectVIUnit(Q,true);}]);W=function(){this.submit(T,Z,S);};}Y=U._getXtabCallback(V);if(O){Z=M(Z,O);Y=M(Y,O);}Y.success=G([Y.success,function(){b.selectVIUnit(Q,true);}]);if(P){C.copy(mstrmojo.DocDataService.SUPPRESS_DATA,S);}if(a){C.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,S);}K(this).execute({execute:W,urInfo:{silent:R.silent,callback:Y,redo:R.redo,undo:R.undo}});},getProperties:mstrmojo.emptyFn,getSetPropertiesAction:A,updateAfterPropertiesChange:function(P,Q,O,R){this.updateAfterAction(A.call(this),P,Q,O,R);},setProperty:function(V,R,T){var P=T.callback,Q=!!T.suppressData,X=T.requestDefinition,S=T.clientUndoRedoCallback,W=this.getProperties(),O=W[V],U;if(V===I.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorMap(this.colorSqureIdentity.comb,R);}}else{if(W&&(W[V]===undefined||W[V].toString()!==R.toString())){W[V]=R;U=F.call(this,V,R,O,S);this.updateAfterPropertiesChange(P,Q,X,U);}}},showData:function(O){if(!this.gridData){this.gridData=this.model.data;}mstrmojo.vi.ui.ViewDataDialog.open(this.parent,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo.util.color","mstrmojo.VisUtility");var S=mstrmojo.util.color,N=mstrmojo.hash,K=mstrmojo.array;var H={BASE_FILL_COLOR_DARK:"#20516b",BASE_FILL_COLOR_LIGHT:"#bce8ff",BORDER_COLOR:"#34abeb",FONT_COLOR_DARK:"#34abeb",FONT_COLOR_LIGHT:"#007ebe"};var J={DARKA:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_DARK},DARKB:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_DARK},DARKC:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.6,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_DARK},LIGHTA:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_LIGHT},LIGHTB:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_LIGHT},LIGHTC:{BASE_FILL_COLOR:H.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.6,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:H.BORDER_COLOR,FONT_COLOR:H.FONT_COLOR_LIGHT}};var P=false,D=false;function C(W,V){return{x:W.x+V,y:W.y+V,w:Math.max(W.w-2*V,0),h:Math.max(W.h-2*V,0)};}function O(V,Y,a,W){if(W==0){return ;}var Z=W/2,X={x:Y.x+Z,y:Y.y+Z,w:Math.max(Y.w-W,0),h:Math.max(Y.h-W,0)};V.save();V.strokeStyle=a;V.lineWidth=W;V.strokeRect(X.x,X.y,X.w,X.h);V.restore();}function Q(V){return"_"+V;}function F(X,W,Y){if(!X){return ;}var Z=X.style;if(Z[W]===Y){return ;}var V=Q(W);if(X[V]===undefined){X[V]=getComputedStyle(X)[W];Z[W]=Y;}}function I(Y,X){if(!Y){return ;}var V=Q(X),W=Y[V];if(W!==undefined){Y.style[X]=W;Y[V]=undefined;}}function U(V,X){var W=C(X,this.outerBorderWidth);E.call(this);O(V,X,this.outerBorderColor,this.outerBorderWidth);O(V,W,this.innerBorderColor,this.innerBorderWidth);M.call(this);}function E(){if(P&&D){if(this.themeType==="dark"){this.outerBorderColor=this.innerBorderColor="#ffffff";}else{this.outerBorderColor=this.innerBorderColor="#000000";}this.innerBorderWidth=0;}else{if(P&&!D){this.outerBorderWidth=0;this.innerBorderColor="#ffffff";}else{if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}}}}function M(){if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}this.outerBorderWidth=2;this.innerBorderWidth=1;}function T(V,X){var W=C(X,this.outerBorderWidth);V.save();V.fillStyle=S.getCSSColorString(this.backgroundColor,0.3);V.fillRect(W.x,W.y,W.w,W.h);V.restore();}function G(V,Z,X,Y,a){F(X,"color",Y.FONT_COLOR);var W=C(Z,1);V.save();if(a){V.fillStyle=S.getCSSColorString(Y.BASE_FILL_COLOR,Y.HOVER_SELECTED_FILL_OPACITY);}else{V.fillStyle=S.getCSSColorString(Y.BASE_FILL_COLOR,Y.SELECTED_FILL_OPACITY);}V.fillRect(W.x,W.y,W.w,W.h);V.restore();O(V,Z,Y.BORDER_COLOR,1);}function L(X,V,W){if(V&&!X){W.selected();}else{if(!V&&X){W.hover();}else{if(V&&X){W.hoverSelected();}}}}function A(V,W){return{hover:function(){T.call(this,V,W);}.bind(this),selected:function(){U.call(this,V,W);}.bind(this),hoverSelected:function(){U.call(this,V,W);T.call(this,V,C(W,1));}.bind(this)};}function B(b,Y,X){var Z=X.isEntityContainer,d=Y.labelDomNode,V=X.isSelected,a=X.isHovered,f=this.canvas.getContext("2d"),e=this.themeType==="dark"?J.DARKA:J.LIGHTA;P=X.contextMenuSelected;D=X.isPreviousSelected;if(this.themeType!=="dark"){if(P&&D){e=J.LIGHTC;}else{if(!P&&D){e=J.LIGHTA;}else{if(P&&!D){e=J.LIGHTB;}}}}else{if(P&&D){e=J.DARKC;}else{if(!P&&D){e=J.DARKA;}else{if(P&&!D){e=J.DARKB;}}}}var W,c=this.parent;if(Z){W={hover:function(){I(d,"color");var g=C(b,1);f.save();f.fillStyle=S.getCSSColorString(e.BASE_FILL_COLOR,e.HOVER_FILL_OPACITY);f.fillRect(g.x,g.y,g.w,g.h);f.restore();},selected:function(){G(f,b,d,e,false);},hoverSelected:function(){G(f,b,d,e,true);}};}else{W=A.call(this,f,b);}F(d&&d.parentNode,"zIndex",3);f.clearRect(b.x,b.y,b.w,b.h);L(a,V,W);}function R(c,Y,X){var Z=X.isEntityContainer,d=Y.labelDomNode,V=X.isSelected,a=X.isHovered,e=this.canvas.getContext("2d");P=X.contextMenuSelected;D=X.isPreviousSelected;var b=this,W;if(Z){W={hover:function(){},selected:function(){},hoverSelected:function(){}};}else{e.clearRect(c.x,c.y,c.w,c.h);W=A.call(this,e,c);}F(d&&d.parentNode,"zIndex",3);L(a,V,W);}mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas",markupString:'<div id={@id}-HeatMapHighlightCanvas style="z-index: 2; position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height: {@height}px;"><canvas width={@width} height={@height}></canvas></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;}},backgroundColor:"#ffffff",init:function(V){this.isOnSelectionMode=mstrmojo.emptyFn;this.alpha=0.4;this.themeType="dark";if(this._super){this._super(V);}if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}this.outerBorderWidth=2;this.innerBorderWidth=1;this.maskColor="#ffffff";},preBuildRendering:function(){var V=this.placeholder;this.width=parseInt(V.style.width);this.height=parseInt(V.style.height);if(this._super){this._super();}},hide:function(){this.domNode.style.display="none";},show:function(){this.domNode.style.display="block";},clear:function(W){this.show();if(!W){W={x:0,y:0,w:this.width,h:this.height};}var V=this.canvas.getContext("2d");V.save();V.clearRect(W.x,W.y,W.w,W.h);if(this.isOnSelectionMode()){V.fillStyle=S.getCSSColorString(this.maskColor,this.alpha);V.fillRect(W.x,W.y,W.w,W.h);}V.restore();},resetCanvasRect:function(V){this.width=V.w;this.height=V.h;this.domNode.style.width=V.w+"px";this.domNode.style.height=V.h+"px";this.canvas.width=V.w;this.canvas.height=V.h;},highlight:function(Z,X,W){W=N.copy(W,{isHovered:false,isSelected:false,isEntityContainer:false,isHeaderOnTop:false});var b=W.isHeaderOnTop,V=W.isSelected,Y=W.isHovered,c=this.isOnSelectionMode(),a=X.labelDomNode,d=this.canvas.getContext("2d");this.show();if(!Y&&!V){I(a&&a.parentNode,"zIndex");I(a,"textDecoration");I(a,"color");d.clearRect(Z.x,Z.y,Z.w,Z.h);if(c){this.clear(Z);}else{this.clear();}return ;}if(b){B.call(this,Z,X,W);}else{R.call(this,Z,X,W);}}});}());(function(){mstrmojo.requiresCls("mstrmojo.gm.GMEnums","mstrmojo.hash","mstrmojo.DocDataService","mstrmojo.VisEnum.GMLegendFormatingPropertyTag","mstrmojo.VisUtility");var E=mstrmojo.array,D=mstrmojo.hash,A=mstrmojo.func.wrapMethods;function B(F){return F.model.controller.cmdMgr;}mstrmojo._colorPalette=mstrmojo.provide("mstrmojo._colorPalette",{listenToUpdateColorMap:function(I){if(mstrmojo.VisUtility.isOnExpressMode()){return ;}var H=this,G,F=(H.getDocModel&&H.getDocModel())||H.model.docModel;if(F){return F.attachEventListener("colorMapChanged",H.id,function(K){G=H.parent.parent;if(G.isPanelDisplaying()){I.call(H);}else{var J=G.attachEventListener("panelDisplaying",H.id,function(L){if(H.postBuilderingCalled){I.call(H);}G.detachEventListener(J);});}});}},detachUpdateColorMapListener:function(G){if(!G){return ;}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel;F.detachEventListener(G);},submitUpdatesAndPersistXML:function C(H,L,F,P){if(!H||H.length===0){return ;}var G={},M=this,Q=(M.getDocModel&&M.getDocModel())||M.model.docModel,O=Q.getDataService(),I=M.model.controller||Q.controller,J=I._getXtabCallback(M);if(F){D.copy(mstrmojo.DocDataService.SUPPRESS_DATA,G);}if(P){D.copy(mstrmojo.DocDataService.REQUEST_ONLY_DEFINITION,G);}var K=false;E.forEach(H,function(R){if(R.act==="updateElementsPropertiesMap"){K=true;}});if(K){A(Q.getUpdateColorMapCallback(),J);}B(M).execute({execute:function N(){var R=O.newUpdate(this,undefined);R.add(H,L,G);this.submitUpdate(R);},urInfo:{callback:J}});},updateColorMap:function(I,G){if(!E.isArray((G))){G=[G];I=[I];}if(I.length!==G.length){throw new Error("comb and color number mismatch");}var F=(this.getDocModel&&this.getDocModel())||this.model.docModel,J=mstrmojo.VisUtility.getUpdateColorMapAction.bind(this),H=I.map(function(L,K){return J(L,JSON.stringify({color:G[K]}));});this.submitUpdatesAndPersistXML(H,F.getUpdateColorMapCallback(),false,true);}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.dom","mstrmojo.string","mstrmojo.gm._IsAnchorable","mstrmojo.ui._HasUITheme","mstrmojo.VisUtility");var E=mstrmojo.dom,D=mstrmojo.string,F=mstrmojo.VisUtility;mstrmojo.gm.DndTooltip=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.gm._IsAnchorable,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.gm.DndTooltip",left:0,top:0,zIndex:10,boundaryNodeName:"boundary",popupNodeName:"infoNode",baseTipClass:"arrow",infoNodeOffset:0,popupNodeOffset:5,anchor:null,boundary:null,utils:mstrmojo.VisChartUtils,themeClassName:"mojo-theme-light",markupString:'<div id="{@id}" class="mstrmojo-Tooltip {@cssClass}" style="top:{@top}px;left:{@left}px;z-index:{@zIndex};position:absolute;{@cssText};"><div class="mstrmojo-Tooltip-shadow {@shadowNodeCssClass}"></div><div class="mstrmojo-Tooltip-content {@contentNodeCssClass}" style="{@contentNodeCssText}"><div class="content"></div><div class="arrow"><div class="after"></div><div class="before"></div></div></div></div>',markupSlots:{infoNode:function(){return this.domNode.childNodes[1];},contentNode:function(){return this.domNode.childNodes[1].firstChild;},tipNode:function(){return this.domNode.childNodes[1].lastChild;}},toggle:function A(H){if(H){this.domNode.style.display="block";}else{this.domNode.style.display="none";}},updateContent:function(H,J,I){this.set("themeClassName",mstrApp.getThemeClassName());this.fillContent(H,J,I);this.positionDialog();},fillContent:function C(J,N,L){this.anchor=J;this.anchorPosition=N;this.contentNode.innerText=L||this.anchor.innerText||this.anchor.textContent,true;this.toggle(true);var H=F.getComputedFontStyle(this.contentNode),M=this.contentNode.innerText,I=F.measureTextWidth(M,H),K=130;if(I<=K){this.contentNode.style.width=I+"px";}else{this.contentNode.innerText=F.truncateTextToLineWithWordWrap(M,H,K,3);this.contentNode.style.width=K+"px";}},getTipDimension:function B(){var I=this[this.tipNodeName],H=E.position(I.firstChild);return H;},applyPopupNodePos:function G(J,I,L,H){var N=this[this.tipNodeName],K=N.style,O=this[this.popupNodeName],M=O.style;M.top=J+"px";M.left=I+"px";K.top=(L-J)+"px";K.left=(H-I)+"px";}});}());(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.heatmap.vi.VisHeatMapColorTheme","mstrmojo.dom","mstrmojo.hash","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.heatmap.vi.VisHeatmapUtility","mstrmojo.util.color","mstrmojo.vi.enums.EnumThemeProperties");var E=mstrmojo.util.color,I=mstrmojo.VisUtility,H=mstrmojo.heatmap.vi.VisHeatmapUtility,F=mstrmojo.vi.enums.EnumThemeProperties.SUBTYPE.HEATMAP,C=mstrmojo.hash;var J={ON:0,OFF:1,PROPORTIONAL:2};var L={LABEL_CTNR_THRES:6,LABEL_CTNR_WIDTH_THRES:32,LGD_GUTTER:5,LABEL_PADDING:5};var N=0.5;function G(T,X){var R=[T];while(R.length!==0){var W=R.shift();if(W===undefined||W.deleted){continue;}X(W);var V=W.entityChildren;if(V!==undefined){var S=V.length,U;for(U=0;U<S;U++){R.push(V[U]);}}}}function D(T,W,U){if(T.deleted){return ;}if(U===undefined){W(T);}else{W(T,U);}if(T.entityChildren===undefined){return ;}var R=T.entityChildren,S=R.length,V;for(V=0;V<S;V++){var X=R[V];if(U===undefined){D(X,W);}else{var Y=U;if(!Y){Y=V.toString();}else{Y=Y+":"+V;}D(X,W,Y);}}}function M(V,U){var T=parseFloat(V),R=T.toString().length,S=V.substring(R);return T*U+S;}function Q(R,U,S){var T;if(S){if(R===0){T="heatmap-level-1-header-on-top";}else{if(R===1){T="heatmap-level-2-header-on-top";}else{T="heatmap-level-3-header-on-top";}}}else{if(U===1){if(R===0){T="heatmap-one-level-1";}}else{if(U===2){if(R===0){T="heatmap-multi-level-1";}else{if(R===1){T="heatmap-two-level-2";}}}else{if(U>=3){if(R===0){T="heatmap-multi-level-1";}else{if(R===1){T="heatmap-multi-level-2";}else{if(R===2){T="heatmap-multi-level-3";}}}}}}}return T;}function B(R,S){if(!R||!S){return false;}return !(S.x>=R.x+R.w||S.y>=R.y+R.h||S.x+S.w<=R.x||S.y+S.h<=R.y);}function A(U,S){var R=Math.max(U.x,S.x);var W=Math.max(U.y,S.y);var T=Math.min(U.x+U.w,S.x+S.w)-R;var V=Math.min(U.y+U.h,S.y+S.h)-W;if(T<0||V<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:R,y:W,w:T,h:V};}function P(R){var S=this.domSpan;Object.keys(R||[]).forEach(function(U){if(U==="style"){H.processFontStyle(R,parseInt(R.style));return ;}if(U!=="scale"&&U!=="family"){S.className=U;var V=R[U];if(V){S.style.fontFamily=R.family;S.style.fontSize=M(V,R.scale);}var T=document.defaultView.getComputedStyle(S);R[U]={fontSize:parseInt(T.fontSize,10),fontWeight:T.fontWeight};}});}function K(S){var R=this.bgColor,T={value:R!==undefined?R:"#ffffff",opacity:1};return E.mix(S,T);}function O(V){var Z=V.e,X=V.css,b=V.s,R=document.createElement("div"),W=this.getLabelColor(Z,b),S=R.style;R.className=X+" heatmap-trun-text";S.position="absolute";S.width=b.w+"px";S.height=b.h*1.3+"px";S.lineHeight=V.lh+"px";S.zIndex=1;S.color=W;if(V.fontSize){S.fontSize=V.fontSize;}if(V.fontFamily){S.fontFamily="'"+V.fontFamily+"'";}if(V.fontWeight){S.fontWeight=V.fontWeight;}R.innerHTML=Z.text;R.firstChild.setAttribute("idx",Z.idx);Z.labelDomNode=R;var T=document.createElement("div"),Y=T.style;Y.position="absolute";Y.left=b.x+"px";Y.top=b.y+"px";Y.width=b.w+"px";Y.height=b.h+"px";T.appendChild(R);var a=document.createElement("div");a.className="heatmap-label-square";var U=4;a.style.width=U+"px";a.style.height=U+"px";a.style.top=(V.lh-U)+"px";T.appendChild(a);return T;}mstrmojo.heatmap.vi.VisHeatMapCanvas=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.heatmap.vi.VisHeatMapCanvas",parent:null,root:null,colorTheme:null,attributes:[],scale:1,labelSetting:0,showMetric:false,bgColor:"#333333",numImages:0,offsetX:0,offsetY:0,markupString:'<div style="position:absolute; width:{@width}px; height:{@height}px"><canvas width={@width} height={@height} style="visibility: hidden; z-index:0"></canvas><span></span></div>',markupSlots:{domCanvas:function(){return this.domNode.firstChild;},domSpan:function(){return this.domNode.childNodes[1];},domImage:function(){return this.domNode.childNodes[2];}},init:function(R){if(this._super){this._super(R);}this.canvasStepX=this.scale*this.width;this.canvasStepY=this.scale*this.height;},postBuildRendering:function(){if(!this.isFontHeightMeasured){this.measureFontHeight();}this.draw();this._super();},removeImageAndLabels:function(){var T=this.domNode,V=T.childNodes,U=V.length,R;for(R=U-1;R>1;R--){var S=V[R];T.removeChild(S);}this.numImages=0;},removeLabels:function(){var U=this.domNode,W=U.childNodes,V=W.length,S=1+this.numImages,R;for(R=V-1;R>S;R--){var T=W[R];U.removeChild(T);}},updateOffsets:function(R,S){this.offsetX=R;this.offsetY=S;this.removeLabels();this.drawLabels();},draw:function(R,S){if(R!==undefined){this.offsetX=R;}if(S!==undefined){this.offsetY=S;}this.removeImageAndLabels();this.drawRects();this.drawLabels();},drawRects:function(){var Z=this.width,l=this.height,e=this.scale,S=Math.ceil(Z*e),b=Math.ceil(l*e),a=this.domCanvas,m=this.domNode,R=document.createDocumentFragment(),Y=this.canvasStepX,X=this.canvasStepY,V=Math.ceil(b/X),T=Math.ceil(S/Y),W=0,g,f,d,c;var U=function(r,v){var t,j,k,q,p,x,w;if(!r.deleted){if(r.entityChildren===undefined){t=r.size;j=r.color;}else{if(r.headerSize){t=r.headerSize;j=r.headerColor;}}if(B(c,t)){var i=Math.max(t.x-c.x,0),u=Math.max(t.y-c.y,0),h=Math.min(t.x+t.w-c.x,c.w),s=Math.min(t.y+t.h-c.y,c.h);k=j.value;if(E.isGradientColor(k)&&k.or===1){q=i;p=u;x=h;w=u;}else{q=i;p=u;x=i;w=s;}d.fillStyle=E.createCanvasFillPattern(j,d,q,p,x,w);d.fillRect(i,u,h-i,s-u);}}r.idx=v;};for(g=0;g<V;g++){for(f=0;f<T;f++){c={x:f*Y,y:g*X,w:Y,h:X};if(g+1===V){c.h=b-c.y;}if(f+1===T){c.w=S-c.x;}a.width=c.w;a.height=c.h;d=a.getContext("2d");d.fillStyle="rgba(0, 0, 0, 0)";d.fillRect(0,0,c.w,c.h);D(this.root,U,"");var o=a.toDataURL();var n=document.createElement("img");n.src=o;n.style.position="absolute";n.style.left=c.x+"px";n.style.top=c.y+"px";n.draggable=false;n.setAttribute("orgx",c.x);n.setAttribute("orgy",c.y);R.appendChild(n);W++;}}a.width=0;a.height=0;m.style.width=S+"px";m.style.height=b+"px";m.appendChild(R);this.numImages=W;},drawLabels:function(){var i=this.attributes.length,Y=this,V=L.LGD_GUTTER*2,a=2*L.LABEL_PADDING,Z={x:this.offsetX,y:this.offsetY,w:this.width,h:this.height},U=[],h=[{},{},{}];var X=Math.floor(Math.log(this.scale)/Math.log(2));X=Math.min(X,i-3);X=Math.max(X,0);this._ext=X;var b=this.labelSetting===J.OFF;var T="\u2026";var e=H.isSpatial();function W(q,o,l,p){var j=9,n=8,m=false,k=Y.getTextSize(q,o,j,l,false,p.w);while(n>=1){if(k.h<p.h){j+=n;}else{if(j===9){break;}if(j>=p.w){break;}if(!m){n/=2;}m=true;j-=n;}k=Y.getTextSize(q,o,j,l,false,p.w);if(m){n=n>>1;}}if(k.h>p.h&&j>9){j--;}if(j>p.w){j=p.w;}return{fontSize:j,loc:p};}function R(u,j,AA,z,k,t,o){AA.text=AA.text.replace("#addedStyleTemplate",o);var v=AA.text;var s=j&&(j.w-a),y=j&&(j.h-a);var x={drop:true};var AB,p,l,q,n;var m={fontFamily:z,fontSize:k+"px",fontWeight:t};if(Y.labelSetting===J.PROPORTIONAL){var r=mstrmojo.hash.copy(j);r.w=s;r.h=y;var AC=W(v,z,t,r);l=AC.fontSize;r=AC.loc;u.fs=l;u.lh=l;q=Y.getTextSize(v,z,l,t,false,s);if(q.h>r.h){return x;}AB=q.w;p=q.h;k=l;}else{l=k;q=Y.getTextSize(v,z,l,t,false,s,true);n=I.measureTextWidth(T,m);p=q.h;AB=q.w;u.lh=l;if(q.w/2+n+N>s){return x;}if(p>y){return x;}}u.isLowestLevel=true;return{w:AB,h:p,fontSize:k};}function S(z,k,AI,AG,m,u,r){var x=mstrApp.getThemeProps(F),t=k&&(k.w-2*x.leftPadding),AF=k&&(k.h-2*x.topPadding),n=m*x.lineHeightTime;var l="<div style='line-height: #lineHeightTime;width: #maxWidth;overflow: hidden;text-overflow: ellipsis;text-align: left; #addedStyleTemplate'>#innerText</div>",o="<div style='line-height: #lineHeightTime;margin-top: #marginTop;white-space: nowrap;text-align: left; #addedStyleTemplate'>#innerText</div>";l=l.replace("#maxWidth",t+"px").replace("#lineHeightTime",x.lineHeightTime).replace("#addedStyleTemplate",r);o=o.replace("#lineHeightTime",x.lineHeightTime).replace("#marginTop",x.marginTop).replace("#addedStyleTemplate",r);var AE={drop:true},q={fontFamily:AG,fontSize:m,fontWeight:u},AJ,p;var AK=Y.parent.getEntityDisplayName(AI),y=AK.split(" ");var AC=I.measureTextWidth(y[0],q);if(t<AC||AF<n){return AE;}var AA=[];AA.push(y[0]);var AD;for(AD=1;AD<y.length;AD++){AJ=I.measureTextWidth(y[AD],q);AA.push(y[AD]);if(AJ>t){if(AD<y.length-1){AA[AD]=AA[AD]+"...";}break;}}y=AA;AA=[];AK=y[0];AA.push(y[0]);var s=n;for(AD=1;AD<y.length;AD++){AK+=(" "+y[AD]);p=l.replace("#innerText",AK);AJ=Y.getTextSize(p,AG,m,u,false,t,true,n);if(AJ.h>AF){p=l.replace("#innerText",AA.join(" ")+" "+y[AD][0]+"...");AJ=Y.getTextSize(p,AG,m,u,false,t,true,n);if(AJ.h<AF){AA.push(y[AD]);}var AH=AA[AA.length-1];var AB;for(AB=0;AB<AH.length;AB++){AA[AA.length-1]=AH.substring(0,AH.length-AB)+"...";p=l.replace("#innerText",AA.join(" "));AJ=Y.getTextSize(p,AG,m,u,false,t,true,n);if(AJ.h<AF){break;}}break;}else{AA.push(y[AD]);s=AJ.h;}}AK=AA.join(" ");AI.text=l.replace("#innerText",AK).replace('style="','style="height:'+s+"px;");AJ=Y.getTextSize(AI.text,AG,m,u,false,t,true,n);if(AJ.h<AF){if(Y.parent.props.showMetricValues){var v=Y.parent.getMetricDisplayValues(Y.parent,AI);if(v.length>0){p=o.replace("#innerText",v.join("<br>"));AJ=Y.getTextSize(p,AG,m,u,false,t,true,n);if(AJ.w<t&&(AJ.h+s)<AF){AI.text+=p;}}}}AJ=Y.getTextSize(AI.text,AG,m,u,false,t,true,n);z.isLowestLevel=true;z.lh=n;return{w:AJ.w,h:AJ.h,fontSize:m};}function g(j,u,k,z,y,l,t,q){z.text=z.text.replace("#addedStyleTemplate",q);var s=k&&k.w,x=k&&k.h,v=!Y.isHeaderOnTop,p={drop:true};if(v&&i>1&&j===0){s-=V;x-=V;}var m,r,AA,o;var n={fontFamily:y,fontSize:l+"px",fontWeight:t};var AB=Y.parent.getEntityDisplayName(z);m=I.measureTextWidthWithSpan(AB,n)*1.05;r=l;AA=Math.min(m,s);o=I.measureTextWidth(T,n);if(m/2+o+N>s){return p;}if(r>x){return p;}u.lh=r;return{w:AA,h:r,fontSize:l};}function d(j,v,s,n,p,q,u){var o=n.w,l=n.h,w=n.fontSize,k,t,r;if(u&&!q.entityChildren&&Y.labelSetting!==J.PROPORTIONAL){k=mstrApp.getThemeProps(F);t=s.x+k.leftPadding;r=s.y+k.topPadding;}else{t=s.x+((s.w-o)/2);r=s.y+((s.h-l)/2);}p.s={x:t,y:r,w:o,h:l};if(h[j]===undefined){h[j]={};}var m=Y.getFontGroup(Y.fonts,j);if(m){p.fontFamily=m.family;}p.fontSize=w+"px";h[j][v]=p;}function f(k){if(k===Y.root||k.deleted||(b&&!k.entityChildren)){return true;}var j=(Y.isHeaderOnTop&&k.entityChildren)?k.headerSize:k.size;if(!B(Z,j)){return true;}if(j.w<L.LABEL_CTNR_WIDTH_THRES+2*L.LABEL_PADDING||j.h<L.LABEL_CTNR_THRES){return true;}if(!Y.isHeaderOnTop){var l=k.level-X;if(l<0||l>=3){return true;}}return false;}function c(q){if(f(q)){return ;}var t,j;if(Y.isHeaderOnTop){t=q.entityChildren?q.headerSize:q.size;j=q.level;}else{t=q.size;j=q.level-X;}var n,u=q.idx,o=Q(j,i,Y.isHeaderOnTop),l=Y.getFontGroup(Y.measuredFonts,q.level),r=l.family,m=l[o],v=m.fontSize,s=l.fontWeight,p={s:{},e:q,m:0,css:o};var k="font-weight: #fontWeight; font-style: #italic; text-decoration: #textDecoration";k=k.replace("#fontWeight",s).replace("#italic",l.fontStyle).replace("#textDecoration",l.textDecoration);if(!q.entityChildren){if(!e||Y.labelSetting===J.PROPORTIONAL){n=R(p,t,q,r,v,s,k);}else{n=S(p,t,q,r,v,s,k);}}else{n=g(j,p,t,q,r,v,s,k);}if(n.drop){return ;}d(j,u,t,n,p,q,e);}G(this.root,c);if(this.isHeaderOnTop){this.layoutLabelsOnTop(h);}else{this.layoutLabelsOnMiddle(h);}},layoutLabelsOnTop:function(U){var X=document.createDocumentFragment(),W=U.length,T,V=this;for(T=0;T<W;T++){var Y=U[T],a;for(a in Y){var S=Y[a],Z=O.call(this,S),R=Z.firstChild.style;if(S.isLowestLevel||V.isHeaderColorsModified()){R.color=V.getLabelColor(S.e);}if(S.isLowestLevel&&V.labelSetting===J.PROPORTIONAL){R.wordBreak="break-all";}else{R.textOverflow="ellipsis";R.wordBreak="normal";}X.appendChild(Z);}}this.domNode.appendChild(X);},layoutLabelsOnMiddle:function(p){var s=document,T=s.createDocumentFragment(),i=this;function c(v){var t=O.call(i,v);var u=t.firstChild.style;if(v.isLowestLevel&&i.labelSetting===J.PROPORTIONAL){u.wordBreak="break-all";}else{u.wordBreak="normal";}T.appendChild(t);}var n=p[0],m=p[1],l=p[2],f,g;for(f in m){g=false;var o=m[f],S=o.s,h=o.e,Y=h.parentEntity,r=n[Y.idx];if(r===undefined){c(o);}if(!!r){var W=r.s,Z=A(S,W);if(Z.w>5||Z.h>5){var q;if(W.y<=S.y){q=((W.y+W.h-S.y)>>1)+1;if(r.m!==2&&(W.y-q>=Y.size.y)&&(S.y+S.h+q<=h.size.y+h.size.h)){W.y-=q;S.y+=q;r.m=1;}else{g=true;}}else{q=((S.y+S.h-W.y)>>1)+1;if(r.m!==1&&(W.y+W.h+q<=Y.size.y+Y.size.h)&&(S.y-q>=h.size.y)){W.y+=q;S.y-=q;r.m=2;}else{g=true;}}}if(g!==true){c(o);}}}for(f in n){c(n[f]);}for(f in l){g=false;var a=l[f],R=a.e,U=R.parentEntity,V=U.parentEntity,j=U.idx,k=V.idx,b=m[j],d=n[k];if(b!==undefined){var e=A(b.s,a.s);if(!isNaN(e.w)){g=true;}}if(g===false&&d!==undefined){var X=A(d.s,a.s);if(!isNaN(X.w)){g=true;}}if(g!==true){c(a);}}this.domNode.appendChild(T);},getLabelColor:function(k,b,Y){var l,T=this.colorTheme,a=K.bind(this),h,f,R,U;if(Y){U=function(e){return Y(a(e));};}else{U=a;}if(this.isHeaderOnTop){if(!k.entityChildren){h=k.color;}else{h=k.headerColor;}h=U(h);f=E.getColorValue(h.value);l=E.getCSSColorString(T.getContrastColor(f));}else{R=k.level-this._ext;if(R===0){return"#FFFFFF";}if(k.entityChildren===undefined){h=U(k.color);f=E.getColorValue(h.value);return E.getCSSColorString(T.getContrastColor(f));}var W=[k],X=0,c=0;while(W.length!==0){var g=W.shift(),Z=g.entityChildren,d=g.entityChildren.length,j;for(j=0;j<d;j++){var V=Z[j];if(V.deleted){continue;}var S=A(b,V.size);if(V.entityChildren===undefined){if(!isNaN(S.w)){h=U(V.color);f=E.getColorValue(h.value);if(T.isBrightColor(f)){X+=S.w*S.h;}else{c+=S.w*S.h;}}}else{if(!isNaN(S.w)){W.push(V);}}}}if(X>c){l="#000000";}else{l="#FFFFFF";}}return l;},getEntity:function(W){var S=W.x,R=W.y,U;var T=function(c){if(c.deleted){return ;}var a;if(c.entityChildren===undefined){a=c.size;}else{if(c.entityChildren&&c.headerSize!==undefined){a=c.headerSize;}}if(a){var Y=a.x,b=a.y,X=Y+a.w,Z=b+a.h;if(S>=Y&&S<=X&&R>=b&&R<=Z){U=c;}}};var V=function(Z,b){if(Z.deleted){return ;}b(Z);var X=Z.entityChildren;if(X!==undefined){var Y=X.length,a;for(a=0;a<Y;a++){var c=X[a];V(c,b);if(U!==undefined){return ;}}}};V(this.root,T);return U;},getAllSiblingEntities:function(W){var U=W.id,Y=W.level,S=[],R=0,X=[],V,T;S.push({entity:this.root,level:-1});while(S.length>0){V=S.shift();T=V.entity;if(T.id===U){X.push(T);continue;}if(V.level<Y&&T.entityChildren){for(R=0;R<T.entityChildren.length;++R){S.push({entity:T.entityChildren[R],level:T.entityChildren[R].level});}}}return X;},getFontGroup:function(T,S){if(!this.isHeaderOnTop){return T.headerOnMiddle;}var R=this.attributes.length;return R===S+1?T.headerOnTop.cell:T.headerOnTop.header;},clearFontCache:function(){this.isFontHeightMeasured=false;},measureFontHeight:function(){this.measuredFonts=C.clone(this.fonts);var R=this.measuredFonts;P.call(this,R.headerOnMiddle);P.call(this,R.headerOnTop.header);P.call(this,R.headerOnTop.cell);this.isFontHeightMeasured=true;},getTextSize:function(X,S,a,Y,R,T,V){function U(){var d=document.getElementById("heatmap-measure-span"),b,c;if(!d){d=document.createElement("span");d.setAttribute("id","heatmap-measure-span");document.body.appendChild(d);}d.innerHTML=X;d.style.cssText="position:absolute; visibility:hidden; z-index:-1; font-family:"+S+"; font-size:"+a+"px; font-weight:"+Y+"; font-style:"+(R?"italic":"normal")+"; line-height:"+a+"px;";b=d.offsetWidth;c=d.offsetHeight;if(T!==undefined&&b>T){d.style.cssText+="overflow:hidden; word-break:"+W+"; max-width:"+T+"px;";c=d.offsetHeight;b=d.offsetWidth;}return{w:b,h:c};}var W="break-all";if(V){W="normal";}Y=Y||"normal";var Z=U.call(this);Z.w+=N;return Z;}});}());(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.Label","mstrmojo.array","mstrmojo.hash","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.dom","mstrmojo._FormatDefinition","mstrmojo.string","mstrmojo.Button","mstrmojo.models.FormatModel","mstrmojo.VisUtility","mstrmojo.heatmap.vi.VisHeatmapUtility");var J=mstrmojo.array,B=mstrmojo.hash,I=mstrmojo.dom,D=mstrmojo.VisUtility,H=mstrmojo.heatmap.vi.VisHeatmapUtility,N=mstrmojo.string,E=mstrmojo.chart.enums.EnumFontStyle,L=mstrmojo.ui.editors.controls.FillConfigGroup.CTRL_FLAGS;function O(Q,S){var P=Q.length,R;for(R=0;R<P;R++){if(S===Q[R].did){return R;}}}function K(Q,P){Q=Q||[];J.forEach(Q,function(R){R.cssDisplay="inline-block";});return B.copy(P||{},{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:Q});}function F(R,Q,S,T){var P=function(U){var V=U.value,W=R[V]&&R[V].did;S.setValue(W);};return A(R,Q,P,T);}function A(Q,P,U,T){T=T||"60px";var S=new mstrmojo.ui.Pulldown({items:Q,width:T,postselectedIndexChange:U,getPopupListConfig:function R(){var V=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);V.getItemProps=function W(Z,X){var Y=mstrmojo._IsList.getItemProps.call(this,Z,X);Y.style=Z.preview?"font-family:'"+N.encodeHtmlString(Z.n,true)+"';":"";return Y;};return V;}});S.set("selectedIndex",P);return{scriptClass:"mstrmojo.Box",children:[S]};}function G(S,Q){Q=B.copy(Q,{label:mstrmojo.desc(3905,"Background"),noOpacity:false,showNoFill:true});var R=!Q.noOpacity;var V,T,P;var X="ColorClr",Y="ColorFillTrans";if(R){V=L.FILL_COLOR|L.FILL_TRANSPARENCY;T=[X,Y];P="125px";}else{V=L.FILL_COLOR;T=[X];P="60px";}var U=new mstrmojo.ui.editors.controls.FillConfigGroup({colorPickerHostWithin:true,showNoFill:Q.showNoFill,visibleControls:V,onGroupValueChange:function(Z,a){if(Z===X){S.value.setValue(a);}if(Z===Y){S.opacity.setValue(a/100);}},width:P});if(U){if(R){U.fillColorAndTrans.layoutConfig={w:{col1Node:"50%",dividerNode:"5px",col2Node:"50%"},xt:true};}U.iniChildrenComp(T);U.syncControls(function(){this.setChildValue(X,S.value.getValue());if(R){this.setChildValue(Y,S.opacity.getValue()*100);}});}var W=[{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:Q.label}]},U];return[K(W)];}var C={background:G,headerFill:G,font:function(R,V){var P=H.getStepper(function(W){if(W>0){R.scale.setValue(R.scale.getValue()+0.1);}else{R.scale.setValue(Math.max(0.1,R.scale.getValue()-0.1));}},{width:"62px",dividerWidth:"5px"});this.attachEventListener("fontScaleChange",this.id,function(W){H.setStepperEnabled(P,[V.modelPath],W.limits);if(V.disableFontSize){P.set("enabled",false);}});var T=new mstrmojo.ui.ButtonBar({hasSpacing:true,multiSelect:true,items:H.getFontStyleItems(),postselectionChange:function(W){var Z=W.added,a=this.items[(Z&&Z[0]!==undefined)?Z[0]:W.removed[0]],Y=(Z&&Z.length>0);var X=R.style.getValue(),b=(X===undefined?E.NORMAL:X);if(Y){b=b|H.fontStyleValueMap[a.css];}else{b=b&(~H.fontStyleValueMap[a.css]);}if(X!==b){R.style.setValue(b.toString());}}}),S=function(X){var W={};var Y=parseInt(X.style.getValue());H.convertFontStyle(Y,W);return W;},U=function(X){var W=S(X);H.updateFontStyle(T,W);};var Q=[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(3544,"Text")}]},P,F(D.getFontFamilyItems(),O(D.getFontFamilyItems(),R.family.getValue()),R.family),T],{width:"335px"})];this.triggerFontScaleChangeEvent();U(R);return Q;},attributeColorBy:function(W,S){S=S||{};var V=mstrmojo.desc(2885,"Fill"),X=S.callback;var U="ShapeClr",Q="ShapeFillTrans",P=X&&X.onFillChanged&&X.onOpacityChanged,R=P?function(Z,Y){if(Z===U){X.onFillChanged.call(this,Y,function(a){T.syncControls(function(){this.setChildValue(U,a);});});D.setColorPickerShowAutomatic(T,Y!=="automatic");}else{if(Z===Q){X.onOpacityChanged.call(this,Y);}}}:mstrmojo.emptyFn,T=new mstrmojo.ui.editors.controls.FillConfigGroup({colorPickerHostWithin:true,onGroupValueChange:R,width:"125px"});if(T){T.fillColorAndTrans.layoutConfig={w:{col1Node:"50%",dividerNode:"5px",col2Node:"50%"},xt:true};T.iniChildrenComp([U,Q]);T.syncControls(function(){this.setChildValue(U,W.color);this.setChildValue(Q,W.opacity);});D.setColorPickerShowAutomatic(T,W.showAutomatic);}return[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:V}]},T],{width:"147px"})];},metricColorByOpacity:function(Q){var R="ShapeFillTrans";var P=new mstrmojo.ui.editors.controls.FillConfigGroup({visibleControls:L.FILL_TRANSPARENCY,onGroupValueChange:function(T,S){if(T===R&&Q){Q.setValue(S/100);}},width:"60px"});if(P&&Q){P.iniChildrenComp([R]);P.syncControls(function(){this.setChildValue(R,Q.getValue()*100);});}return[K([{scriptClass:"mstrmojo.Box",width:"60px",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(2885,"Fill")}]},P])];}};function M(Y,S,T){var X=[],R=this;Y.forEach(function(f){var c=f.type,b=f.model,a=C[c],e=R.getWidget();if(a){X=X.concat(a.call(e,b,f));}});if(X.length){var U=I.position(this.containerNode,true),W=S.pageX-U.x,V=S.pageY-U.y;var P={scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+mstrApp.getThemeClassName(),locksHover:true,children:X};var Q=this._contextMenuAnchor;if(!Q||!Q.parentElement){Q=document.createElement("div");Q.style.position="absolute";this._contextMenuAnchor=Q;this.containerNode.appendChild(Q);}Q.style.left=W+1+"px";Q.style.top=V+1+"px";var Z={hostId:this.id,hostElement:Q,isHostedWithin:false};if(T){Z.alignment=T;}P.popupConfig=new mstrmojo.ui.PopupConfig(Z);P.visible=true;P.onClose=function(){this.unrender();};return P;}}mstrmojo.heatmap.vi._HasHeatmapContextMenu=mstrmojo.provide("mstrmojo.heatmap.vi._HasHeatmapContextMenu",{getWidget:function(){return this;},showContextMenu:function(P,Q,R){P=[].concat(P);this.openPopup(M.call(this,P,Q,R));},unrender:function(P){this._contextMenuAnchor=undefined;this._super(P);}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.gm.DndTooltip","mstrmojo.VisUtility","mstrmojo.vi.models.EnumDragSources");var N=mstrmojo,I=N.dom,K=N.VisUtility,C=N.vi.models.EnumDragSources,J=N.array;mstrmojo.gm._SupportDndAsBlackBox=mstrmojo.provide("mstrmojo.gm._SupportDndAsBlackBox",{_mixinName:"mstrmojo.gm._SupportDndAsBlackBox",mainContainerNode:"domNode",handleDndForParentNode:true,dndAsBlackBox:true,allowDrop:function H(R){var S=R.src.data,Q=S&&S.src;if(Q===C.DATASETS||Q===C.VIZ_EDITOR||Q===C.VIZ||Q===C.ALL_OBJECT_LIST){return true;}return false;},cleanUpAfterTarget:function E(Q){this._super(Q);if(this.domNode.contains(this.dndHighlightCanvas)){this.domNode.removeChild(this.dndHighlightCanvas);}delete this.dndHighlightCanvas;if(this.dndTooltip){this.dndTooltip.destroy();}delete this.dndTooltip;},ondragenter:function M(R){if(this._super){this._super(R);}var W=this.isEmpty();if(W&&!this.excludeData){R.tgt.widget=this;this.raiseEvent({name:"toggleCtrlOverlay",visible:false,controls:this.getVisEmptyMsgControls()});}var V;if(!this.dndHighlightCanvas){var Q=document.createElement("canvas"),U=I.position(this.domNode),T=I.position(this[this.mainContainerNode]);this.domNode.appendChild(Q);Q.style.position="absolute";Q.style.zIndex=1000;Q.width=T.w||U.w;Q.height=T.h||U.h;Q.style.top=(T.y-U.y)+"px";Q.style.left=(T.x-U.x)+"px";this.dndHighlightCanvas=Q;}if(!this.dndTooltip){V=document.createElement("div");document.body.appendChild(V);var S={placeholder:V,contentNodeCssClass:"gm-dnd-replace-node-tooltip",boundary:document.body};this.dndTooltip=new mstrmojo.gm.DndTooltip(S);this.dndTooltip.render();this.dndTooltip.parent=this;}this.ondragover(R);},ondragover:function B(Q){if(this._super){this._super(Q);}if(this.dndAsBlackBox){this.clearHighlightDropZoneOnGraph();this.drawBlackBoxHighlight(Q);}},ondragleave:function P(Q){var R=this.isEmpty();if(R){this.raiseEvent({name:"toggleCtrlOverlay",visible:true,controls:this.getVisEmptyMsgControls()});}if(this._super){this._super(Q);}},ondrop:function L(R){if(this._super){this._super(R);}if(this.dndAsBlackBox){var U=this.zonesModel,T=R.src.data,Q=T.items,S=R.getCtxtDragData().src;this.getDocModel().selectVIUnit(this.parent.id);U.addUnitsFromDataSource(Q,T.dsid,R.actions,S===C.ALL_OBJECT_LIST?R.callback:null);}},clearHighlightDropZoneOnGraph:function G(){var R=this.dndHighlightCanvas,Q=R.getContext("2d");Q.clearRect(0,0,R.width,R.height);this.dndTooltip.toggle(false);},isMetric:function O(Q){return Q&&Q.t===4;},isAttrCategory:function D(Q){return Q&&(Q.t===12||Q.t===1||Q.t===47);},singleTypeObject:function F(Q){var T=0,S=0,R=this;J.forEach(Q.src.data.items,function(U){if(R.isAttrCategory(U)){T++;}else{if(R.isMetric(U)){S++;}}});return !(T>0&&S>0);},drawBlackBoxHighlight:function A(S){var T=this.dndHighlightCanvas,a=T.getContext("2d"),X=I.position(this[this.mainContainerNode]),Q=I.position(this.domNode),R=X.w||Q.w,Z=X.h||Q.h,W=Math.min(30,0.25*R),b=Math.min(30,0.25*Z);a.save();a.beginPath();a.rect(W,b,R-2*W,Z-2*b);a.fillStyle="#bce8ff";a.globalAlpha=0.4;a.fill();a.strokeStyle="#34abeb";a.globalAlpha=1;K.drawDashLine(a,W,b,W,Z-b,2,2);K.drawDashLine(a,W,b,R-W,b,2,2);K.drawDashLine(a,R-W,b,R-W,Z-b,2,2);K.drawDashLine(a,W,Z-b,R-W,Z-b,2,2);a.restore();if(!this.singleTypeObject(S)){var U=this.dndTooltip,Y={x:S.tgt.e.x,y:S.tgt.e.y,w:0,h:0},V=S.src.widget.avatar;if(V){Y=I.position(V);}U.placementOrder=[U.PLACEMENT_ABOVE];U.popupNodeOffset=5;U.updateContent(null,Y,"Add Attributes and Metrics");}}});}());(function(){mstrmojo.requiresCls("mstrmojo.string","mstrmojo.dom","mstrmojo.array","mstrmojo.css","mstrmojo.hash","mstrmojo.VisEnum","mstrmojo.VisUtility","mstrmojo.gm.GMUtility","mstrmojo.color","mstrmojo.ui.menus.EditorConfig","mstrmojo.ui.menus.ToolbarEditorConfig","mstrmojo.vi.ui.editors.EditorGroup","mstrmojo.ui.editors.controls.LineConfigGroup","mstrmojo.ui.editors.controls.FillConfigGroup","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.CharacterGroup","mstrmojo.ui.editors.controls.AdvancedColorPicker");var Z=mstrmojo,I=Z.dom,K=Z.hash,a=Z.array,A=Z.css,i=Z.VisEnum.ControlType,h=mstrmojo.gm,F=mstrmojo.color,U=h.GMUtility,R=Z.VisUtility,j=h.FormatingPropertyTag,e=mstrmojo.models.FormatModel,c=e.ENUM_PROPERTY_NAMES,P=mstrmojo.chart.enums.EnumFontStyle,f=mstrmojo.VisEnum.GMLegendFormatingPropertyTag,G=mstrmojo.VisEnum.NetworkLegendFormattingCategory,V=mstrmojo.ui.editors.controls.AdvancedColorPicker,W={GLOBAL:"glb",FORMATTING:"fmt"},D={FONT_COMP:"FntCmp",FONT_FAMILY:"FntFml",FONT_STYLE:"FntStyle",FONT_SIZE:"FntSz",FONT_COLOR:"FntClr",LINE_COMP:"LnCmp",SHOW:"Shw",COLOR:"Clr",STYLE:"Style",THICKNESS:"Thk"};function N(q,n){var m=this.widget,o=m.domToolbarPH,p=this;m._lastOpened=null;o.innerHTML="";document.body.appendChild(o);A.toggleClass(o,mstrApp.getThemeClassName(),true);this.configureLegendPopup(n,o);m.toolEditor=n.newInstance({unrender:function(){}});m.toolEditorClosefn=function(r){var t=r.target,s=m.toolEditor.domNode;if(!I.contains(s,t,true,s)&&!R.isHostedPopupNode(t,"class",true,document.body)){p.hideToolbar();}};I.attachEvent(document.body,"mousedown",m.toolEditorClosefn,true);m.openPopup(this.widget.toolEditor);A.toggleClass(document.body,"hasToolbarPopup",true);}function L(n,m){var o;if(m===W.GLOBAL){o=this.readGlobalProperty(n);}else{if(m===W.FORMATTING){o=this.widget.getPropertiesOfFormatable();}}if(n.slice(-3)===D.COLOR){if(n!==j.COLOR_SQUARE_COLOR||m!==W.GLOBAL){o=U.decodeColor(o);}}return o;}function Q(n,m){var o=this;if(m===W.GLOBAL){return function(q){var p=L.call(o,n,W.GLOBAL);if(n===j.COLOR_SQUARE_COLOR){p=p.color;}if(!K.equals(q,p)){if(n.indexOf(D.COLOR)!==-1){q=U.encodeColor(q);}o.writeGlobalProperty(n,q);}};}return function(r,p){var q=L.call(o,n,W.FORMATTING);if(r!==q){if(n.indexOf(D.COLOR)!==-1){r=F.encodeColor(r);}o.widget.writeFormatableProperties(n,r,p);}};}function O(n,m){n=n||[];m=m||"";a.forEach(n,function(o){o.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.HBox",cssClass:m,children:n};}function d(n,o){n=n||[];var m=new mstrmojo.Box({children:n,cssText:o});return m;}function B(q,r,m){var p="white-space: nowrap; width: 50px;";if(q===mstrmojo.desc(3905,"Background")||q===mstrmojo.desc(6242,"Color")){p="white-space: nowrap;";}else{if(q===mstrmojo.desc(2885,"Fill")){p="white-space: nowrap; margin-right: 9px;";}}var n=new mstrmojo.Label({text:q}),o=d(n,p);return O([o,r],m);}function b(n,o,m){var p=this;n=n||{};if(n.propNames===undefined){n.propNames=o;}n.onGroupValueChange=function(q,s,r){if(s!==r&&s!==undefined){(Q.call(p,q,m))(s,r);}};return n;}function S(o,n,m){var p=this;a.forEach(n,function(q){var r=L.call(p,q,m);if(r!==undefined){o.setChildValue(q,r);}});}function C(m,p,o,n){n=b.call(this,n,p,o);K.copy({width:"140px",height:"22px",colorPickerHostWithin:true},n);var q=new mstrmojo.ui.editors.controls.FillConfigGroup(n);if(q){q.iniChildrenComp(p);S.call(this,q,p,o);}if(typeof m==="string"){return B(m,q,(n||[]).rowContainerCSSClass);}return q;}function Y(o,n,m){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-ui-ToolBoxBackgroundFill",children:[C.call(this,mstrmojo.desc(2885,"Fill"),o,n,K.copy({rowContainerCSSClass:"mstrmojo-ui-rowContainer"},m))]}]});}function k(q,o,s,r,n){var p=L.call(this,s,r),t=this;var m=new mstrmojo.ui.editors.controls.ColorPickerButton({isHostedWithin:true,width:"40px",selectedValue:p,showNoFill:false,postselectedValueChange:function(u){(Q.call(t,s,r))(u.value,u.valueWas);}});if(q){m.alias=q;}if(typeof o==="string"){return B(o,m);}return m;}function l(n){var m;if(n.listenToUpdateColorMap instanceof Function){m=n.listenToUpdateColorMap(function(){n.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});if(m&&n.detachUpdateColorMapListener instanceof Function){n.detachUpdateColorMapListener(m);}});}}function g(o,n){var m=L.call(this,o,n),p=this;return new mstrmojo.ui.menus.ToolbarEditorConfig({cssClass:"cbsquare-colorpicker",contents:[new mstrmojo.ui.editors.controls.AdvancedColorPicker({showAutomatic:!m.isDefaultColor,color:m.color,colorChanged:function(q){q=(this.showAutomatic&&q===V.VAL_AUTOMATIC)?"default":q;l(p.widget);(Q.call(p,o,n))(q,m.color);p.hideToolbar();},colorCanceled:function(){p.hideToolbar();}})]});}function T(s,n){var m={},r=L.call(this,n+D.FONT_STYLE,W.GLOBAL),p=L.call(this,n+D.FONT_COLOR,W.GLOBAL),o=L.call(this,n+D.FONT_FAMILY,W.GLOBAL),q=L.call(this,n+D.FONT_SIZE,W.GLOBAL);if(r!==undefined){m[c.FONT_WEIGHT]=(!isNaN(r)&&((r&P.FS_BOLD)>0));m[c.FONT_STYLE]=(!isNaN(r)&&((r&P.FS_ITALIC)>0));m[c.UNDERLINE]=(!isNaN(r)&&((r&P.FS_UNDERLINE)>0));m[c.LINE_THROUGH]=(!isNaN(r)&&((r&P.FS_STRIKETHROUGH)>0));}if(p!==undefined){m[c.COLOR]=p;}if(q!==undefined){m[c.FONT_SIZE]=q;}if(o!==undefined){m[c.FONT_FAMILY]=o;}s.setFormatSource(m);}function H(n,m){var o=null;if(m.indexOf(D.FONT_FAMILY)!==-1){o=n.fontFamily;}else{if(m.indexOf(D.FONT_STYLE)!==-1){o=n.fontStyle;}else{if(m.indexOf(D.FONT_SIZE)!==-1){o=n.fontSize;}else{if(m.indexOf(D.FONT_COLOR)!==-1){o=n.fontColor;}}}}return o;}function M(p,o,m){var n={bold:P.FS_BOLD,italic:P.FS_ITALIC,underline:P.FS_UNDERLINE,strikeout:P.FS_STRIKETHROUGH},q=this;o.forEach(function(r){var s=H(p,r);if(s){s.propName=r;if(r.indexOf(D.FONT_STYLE)!==-1){s.postselectionChange=function(t){var w=t.added,x=s.items[(w&&w[0]!==undefined)?w[0]:t.removed[0]],v=!!w,u=L.call(q,r,m),y=(u===undefined?0:u);if(v){y=y|n[x.css];}else{y=y&(~n[x.css]);}s.parent.raiseFormatValueChange(r,y,u);};}else{if(r.indexOf(D.FONT_FAMILY)!==-1){s.postselectedIndexChange=function(t){var w=t.value,v=t.valueWas;if(w!==v){var u=s.items;s.parent.raiseFormatValueChange(r,u[w].id,u[v]&&u[v].id);}};}else{if(r.indexOf(D.FONT_SIZE)!==-1){s.postselectedValueChange=function(t){var v=parseInt(t.value,10)+"pt",u=parseInt(t.valueWas,10)+"pt";if(v!==u){s.parent.parent.raiseFormatValueChange(r,v,u);}};}else{s.postselectedValueChange=function(t){s.parent.parent.raiseFormatValueChange(r,t.value,t.valueWas);};}}}}});}function X(n,q,p,o){var t=this;o=o||{};if(o.propNames===undefined){o.propNames=q;}if(o.onGroupValueChange===undefined){o.onGroupValueChange=function(u,w,v){if(w!==v&&w!==undefined){(Q.call(t,u,W.GLOBAL))(w,v);}};}var m={cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,width:"397px",height:"22px"};o=K.copy(m,o);var s=new mstrmojo.ui.editors.controls.CharacterGroup(o),r=H(s,j.LEGEND_FONT_COLOR);r.showNoFill=false;M.call(this,s,q,p);T.call(this,s,n);return s;}function J(q,p){var u=p.firstChild,y=u?u.offsetWidth:0,n=u?u.offsetHeight:0,r=document.body.offsetWidth,x=document.body.offsetHeight,s=10,t=5,w=5;if(u){u.style.left="0";u.style.right="auto";u.style.top="0";u.style.bottom="auto";}var v={w:y,h:0};var o=n>0;if(o){v.h=n;}else{return false;}if(o){p.style.left=q.x+"px";p.style.top=q.y-n-s/2+"px";}if(q.x+v.w>r){p.style.left=q.x-y+"px";}if(o){var m=0;if(q.y-n-s/2<t){m=t;p.style.top=m+"px";}else{if(q.y+s/2>x){m=Math.max(x-s-n,t);p.style.top=m+"px";}}}}function E(m,p,o,n){return new mstrmojo.ui.menus.ToolbarEditorConfig({contents:[{scriptClass:"mstrmojo.vi.ui.editors.EditorGroup",showDivider:false,children:[X.call(this,m,p,o,n)]}]});}mstrmojo._FormateVisLegend=mstrmojo.provide("mstrmojo._FormateVisLegend",{_mixinName:"mstrmojo._FormateVisLegend",widget:null,readGlobalProperty:undefined,writeGlobalProperty:undefined,configureLegendPopup:undefined,init:function(m){this.widget=null;if(this._super){this._super(m);}if(this.widget&&!this.widget.domToolbarPH){var n;n=document.createElement("div");n.setAttribute("class","gm-menu-placeholder");this.widget.domToolbarPH=n;}},handleRMCOnLegend:function(x){var r=x.getTarget(),s=x.e,v={x:s.pageX,y:s.pageY},u=r.getAttribute("type"),n,t,p,q=this,o=this.widget;x.cancel();x.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()||mstrApp.isInVFInteractMode){return ;}var w,m=function(y){switch(y){case i.LGD_COLORBOX_CTN:case i.LGD_COLORBOX:if(y===i.LGD_COLORBOX){r=r.parentNode;}t=r.firstChild.identity;if(t&&t.comb){this.widget.colorSqureIdentity=t;this.selectColorBox(r,this.fmtMode);n=g.call(this,j.COLOR_SQUARE_COLOR,W.GLOBAL);v=this.adjustColorPickerPos(r);if(!v.alignLeft){p=n.ENUM_CORNERS;n.setAlignment(p.BOTTOM_LEFT,p.TOP_RIGHT);}}break;case i.LGD_TITLE:case i.LGD_TEXT:this.selectText(true);var z=[j.LEGEND_FONT_SIZE,j.LEGEND_FONT_FAMILY,j.LEGEND_FONT_STYLE,j.LEGEND_FONT_COLOR];n=E.call(this,"lgd",z,W.GLOBAL);w="lgd";break;default:this.selectLegendBody();var AA=[j.LEGEND_BG_COLOR,j.LEGEND_BG_FILL_TRANSPARENCY];n=Y.call(this,AA,W.GLOBAL);w="lgd";break;}if(n){N.call(this,v,n);if(!!w){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");o.parent.selectVIUnit();var AB=o.edtModel._targetPulldown;if(AB){AB.selectItemByField("v",w);}}}};m.call(this,u);J.call(this,v,this.widget.domToolbarPH);},hideToolbar:function(){var n=this.widget,o=n.domToolbarPH,q=o.firstChild,m=o.parentNode;if(q){o.removeChild(q);}if(m){m.removeChild(o);}var p=n.toolEditor;if(p){p.unrender=function(){p._super();};p.destroy();p.unrender=function(){};delete n.toolEditor;A.toggleClass(document.body,"hasToolbarPopup",false);A.toggleClass(o,mstrApp.getThemeClassName(),false);}if(n.toolEditorClosefn){I.detachEvent(document.body,"mousedown",n.toolEditorClosefn,true);delete n.toolEditorClosefn;}},highlightText:function(m){throw new Error("subclass need to implement highlightText function");}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.Vis","mstrmojo._HasOwnAvatar");var K=mstrmojo.css,I=mstrmojo.dom,F="px";function B(Q,P){return{x:Q.x-P.x,y:Q.y-P.y};}function M(Q,P){return(Q.x-P.x)*(Q.x-P.x)+(Q.y-P.y)*(Q.y-P.y);}function N(P){var Q=P.src.data;return(!Q||!Q.isScrollBar);}mstrmojo.VisLegend=mstrmojo.declare(mstrmojo.Vis,[mstrmojo._HasOwnAvatar],{scriptClass:"mstrmojo.gm.VisLegend",bodyCssClass:"",avatarCssClass:"legend-dragged",dropZoneHighlightCss:"legend-dropZone",ownAvatar:true,draggable:true,dropZone:true,dockedPositions:null,calculateDockedPositions:mstrmojo.emptyFn,widget:null,boundaryNode:null,draggableNodeName:"domLegend",legendMarkup:"",extrasMarkup:"",markupString:'<div id="{@id}" class="{@cssClass}" style="width:{@width}px;height:{@height}px;top:{@top}px;left:{@left}px;position:absolute;" mstrAttach:click,mouseover,mouseout><div class="gm-legend-bg"><div class="{@bodyCssClass}" style="width:{@width}px;height:{@height}px;text-decoration:inherit">{@legendMarkup}</div></div><div class="gm-anchor-point topLeft"></div><div class="gm-anchor-point topRight"></div><div class="gm-anchor-point bottomLeft"></div><div class="gm-anchor-point bottomRight"></div>{@extrasMarkup}</div>',markupSlots:{dropZoneNode:function(){return this.domNode;},domLegend:function(){return this.domNode.firstChild.firstChild;}},postBuildRendering:function(){this._super();this.calculateDockedPositions(this.widget.getWidth(),this.widget.getHeight());this.boundaryNode=this.widget.domNode;this.boundaryPosition=I.position(this.boundaryNode,true);},createAvatar:function D(){return this[this.draggableNodeName];},updateDropZoneNode:function C(R){var P=this.dockedPositions;if(P&&P.length>0){var W=B(R.tgt.pos,this.boundaryPosition);var U=M(W,P[0]),T=0,Q,V;for(Q=1;Q<P.length;Q++){V=M(W,P[Q]);if(V<U){U=V;T=Q;}}if(T!==this.currDockedPositionIdx){var S=this.dropZoneNode.style;S.left=P[T].x+F;S.top=P[T].y+F;if(this.widget.onLegendDropZoneChange){this.widget.onLegendDropZoneChange(P[T],T);}this.currDockedPositionIdx=T;this.updateAlignClass();return true;}}return false;},toggleDropZoneBorder:function O(P){K.toggleClass(this.dropZoneNode,this.dropZoneHighlightCss,P);},isDragValid:N,ondragstart:function E(P){if(!N(P)){return ;}this._super(P);this.toggleDropZoneBorder(true);},ondragmove:function A(P){if(!N(P)){return ;}this.updateDropZoneNode(P);this._super(P);},allowDrop:function H(P){var R=P.src,Q=R&&R.widget;return(Q&&Q!==this&&Q.parent===this.parent);},ondrop:function J(R){var P=this.domLegend;K.removeClass(P,this.avatarCssClass);var S=P.style;S.left="0";S.top="0";this.dropZoneNode.firstChild.appendChild(P);if(this.widget.onLegendDropped){var Q=this.getDockedPosition();this.widget.onLegendDropped(Q&&Q.pos);}R.dropSuccessful=true;},getDockedPosition:function G(){return this.dockedPositions&&this.dockedPositions[this.currDockedPositionIdx];},ondragend:function A(P){if(!N(P)){return ;}this._super(P);if(!P.dropSuccessful){this.ondrop(P);}this.toggleDropZoneBorder(false);},positionAvatar:function L(U){var R=this,Q=this.avatar,S=Q.style,T=this.boundaryPosition;var P=function(V,W){if(V==="x"){if(W<T.x){return T.x;}return Math.min(W,T.x+T.w-R.domNode.offsetWidth);}if(V==="y"){if(W<T.y){return T.y;}return Math.min(W,T.y+T.h-R.domNode.offsetHeight);}};S.left=P("x",U.x)+F;S.top=P("y",U.y)+F;}});}());(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css","mstrmojo.VisEnum","mstrmojo.VisLegend","mstrmojo.VisUtility","mstrmojo.gm.GMEnums","mstrmojo.gm.GMIdentities","mstrmojo.gm.GMUtility","mstrmojo.array","mstrmojo.string","mstrmojo.hash","mstrmojo._FormateVisLegend","mstrmojo.ui._HasScroller");var Ah=mstrmojo,Ad=Ah.gm,AA=Ah.dom,Ac=Ah.css,S=Ah.hash,AO=Ah.VisUtility,a=Ad.GMUtility,P=mstrmojo.array,Y=mstrmojo.string,AB=mstrmojo.ui.editors.controls.AdvancedColorPicker,f=Ad.ColorSquareIdentity,C=Ah.VisEnum.ControlType,j=Ad.EnumLegendSlot,AM=Ad.EnumDockPosition,n=Ad.EnumLegendSlot,AG=Ad.EnumIdentityType,AE=Ad.EnumShape,AY=Ah.VisEnum.GMLegendDataType,J=mstrmojo.desc(13966,"Size by:"),w="px",F=1.35,Z=0.75,W=5,K=20,l=K,AF=5,A=5,x=16,e=15,H=16,AJ=20,G=150,s=15,Af=1,z="setAttribute",k=3,h=2,Q=8,r=15,AT=14,u=1,R=2,g=4,Ai=8,Ag=16,L=10,AV=3,AK=50,AQ=-3,t=5,AR="gm-legend-lock-icon",AN=mstrmojo.desc(14442,"This metric has its axis scale set to custom min and max values"),O="http://www.w3.org/2000/svg",v="\u2026",N=/[ \-]/;function AS(Ao,Aq,Aj,Ar){if(!Ao){return ;}var Al,Au,Am,At,Ap=Ao.style,Av=Aq===AM.TOP,Ak=Aq===AM.BOTTOM,As=Aq===AM.LEFT,An=Aq===AM.RIGHT;if(Av||Ak){Al=Aj;Au=1;Am=-1;At=AQ;if(Ak){At+=Ar;}}else{if(As||An){Al=1;Au=Ar;At=-1;Am=AQ;if(An){Am+=Aj;}}}Ap.cssText="left:"+Am+w+";top:"+At+w+";width:"+Al+w+";height:"+Au+w+";";if(mstrApp.isInVFInteractMode){Ap.cursor="default";}}function I(Ak){var Aj=String(Ak);return Aj.indexOf(" ")>=0||Aj.indexOf("-")>=0;}function X(Al,Ak,Am){var Aj=typeof Al==="string"?a.restoreSpecialChars(Al):Al;return AO.measureTextWidth(Aj,Ak,Am);}function AI(An,Am,Ak,Aj){var Al=X(Am,Ak,L);An.setAttribute("measureWidth",Al);if(Al>Aj){Al=Aj;}else{An.style.overflow="visible";}An.setAttribute("displayWidth",Al);An.style.width=Al+w;return Al;}function Ae(Al,Ak){var Aj;if(parseInt(Al.getAttribute("measureWidth"))>Ak){Aj=parseInt(Al.style.maxHeight);}else{Aj=parseInt(Al.style.lineHeight);}return Aj;}function B(Ak){var Aj;if(Ak.textContent&&typeof (Ak.textContent)!==undefined){Aj=Ak.textContent;}else{Aj=Ak.innerText;}return Aj;}function b(Al){var Ak=Al.getAttribute("measureWidth"),Aj=Al.getAttribute("displayWidth");if(!Ak){Al[z]("title","");}Ak=parseFloat(Ak,10);Aj=parseFloat(Aj,10);if((Ak-Aj)>0.1){Al[z]("title",B(Al));}else{Al[z]("title","");}}function AL(An,Aj,Ak,Am){var Al=document.createElement("div");Al[z]("class","gm-legend-underLine");Al.style.width=Am-L+w;Al.style.left=Aj+5+w;Al.style.top=Ak+w;An.appendChild(Al);}function AX(Am,Aj,Ak){var Al=document.createElement("div");Al[z]("class","gm-legend-underLine-anchorPoint");Al.style.left=Aj+w;Al.style.top=Ak-3+w;Am.appendChild(Al);}function AH(Am,Aj,Ak,Al){AL(Am,Aj,Ak,Al);AX(Am,Aj,Ak);}function m(Al,Aw,As,Aq,Au){var Ar,Am,At,Aj,Av=a.restoreSpecialChars(Al.innerHTML),Ap=Av.length,An=0,Ak=Ap,Ao=false;if(Al.scrollHeight>1.5*H){Ar=X(Al.innerHTML,Aw,L);Am=Ar-As+L;if(Am>Au){while((Ak-An)>1){At=(An+Ak)>>1;Aj=Av.substring(0,At)+v;Ar=X(Aj,Aw,L);Am=Ar-As+L;if(Am>Au){Ak=At;}else{An=At;}}Al.innerHTML=Y.encodeHtmlString(Av.substring(0,An)+v,true);Al[z]("title",Av);Ao=true;Ar=X(Al.innerHTML,Aw,L);Am=Ar-As+L;}AL(Al,0,Aq+H,(Am<Au)?Am:Au);}if(As>Au){Al[z]("title",Av);}else{if(!Ao){Al[z]("title","");}}}function y(Aj,As,Ao,Ak,Ar,At){var Al,An,Ap,Aq,Am=document.createElement("div");Am[z]("class","gm-legend-textcell");Am[z]("type",C.LGD_TEXT);Am.style.lineHeight=e+w;if(Ar){Aq=AI(Am,As,At,Ar);}if(Ak&u){Al=(AJ+AT)/2+Ao*AJ;Ap=x;}else{Al=(s+AT)/2+Ao*s;if(Ak&Ai){if(Ak&Ag){Ap=0;}else{Ap=r;}}else{if(Ak&g){Ap=Q;}else{Ap=0;}}}An=Aq||r+L;Am.innerText=As;Am.identity={objType:AG.LEGEND_TEXT};AH(Aj,Ap,Al,An);this.textDivs.push(Am);Aj.appendChild(Am);}function Aa(Aj,Am){var Ak,Ao,An,Al=0;if(Aj){An=Aj.elements;for(Ak=0,Ao=An.length;Ak<Ao;Ak++){Al=Math.max(Al,X(An[Ak].label,Am,L));}Al+=x+A*2+AV;}return Al;}function V(Am,Al){var Ap,Aj,Ao,An=Am.items,Ak=0;if(!An){return 0;}Ap=An.length;Ao=Am.custMetrics;for(Aj=0;Aj<Ap;Aj++){if(Ao&&Ao.indexOf(An[Aj])!==-1){Ak=Math.max(Ak,X(An[Aj],Al,L)+Q);}else{Ak=Math.max(Ak,X(An[Aj],Al,L));}}return Ak;}function AP(Am,Al){var Aj,Ao,An,Ak=0;if(Am){An=Am.elements;Ao=An.length;if(Am.caseFlag===1){Ak=V(Am,Al);}else{if(Am.caseFlag===0){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X("Max: "+An[Aj].v,Al,L));}Ak+=s*k;Ak=Math.max(Ak,V(Am,Al));}else{if(Am.caseFlag===2){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X(An[Aj].v,Al,L));}Ak+=s*Ao+r;Ak=Math.max(Ak,V(Am,Al));}else{if(Am.caseFlag===3){for(Aj=0;Aj<Ao;Aj++){Ak=Math.max(Ak,X(An[Aj].v,Al,L));}Ak+=s*t;}}}}Ak=Math.max(Ak,X(J,Al,L));Ak+=A*3;}return Ak;}function d(Au,Am,Ay){if(!Au||!Au.length||Au.length<1){return 0;}var An,Ak,Ax,Aj,Aq,At,Ap,As,Ar,Al,Ao,Aw=l+2*Af,Av=Aw;for(An=0;An<Au.length;An++){Ap=Au[An];if(Ap.dataType===AY.COLOR_BY){As=Ap.dataObj;if(As){Al=2*AF+H;Ax=a.removeExtraSpace(As.item);At=X(Ax,Ay,L);if((At+2*A>Am-2*Af)&&I(Ax)){Al+=H;}Aj=As.elements;Ak=Aj.length;Al+=A;Al+=h;Aj.forEach(function(Az){if(Az.bftp){Ad.GMLegend.IMAGE_SIZE_FIXED=G;AJ=G;}});Aw+=Al+AJ*Ak;Av+=Al+(Ak>0?AJ:0);}}else{if(Ap.dataType===AY.SIZE_BY){Ar=Ap.dataObj;if(Ar){Ao=2*AF+H;Ax=a.removeExtraSpace(Ar.item);At=X(Ax,Ay,L);if((At+2*A>Am-2*Af)&&I(Ax)){Ao+=H;}Aq=Ar.caseFlag;if(Aq===1){Ak=0;}else{if(Aq===0){Ak=2;}else{if(Ar.caseFlag===2||Aq===3){Ak=Ar.elements.length;}}}Ak+=(Ar.items&&Ar.items.length)||0;Ao+=s*Ak;Ao+=A;Ao+=h;Aw+=Ao;Av+=Ao;}}}}return{height:Aw,minHeight:Av};}function Ab(Aj,Ak){var Am=0,Al=0;P.forEach(Aj||[],function(An){var Ao;if(An.dataType===AY.COLOR_BY){Ao=Aa(An.dataObj,Ak);if(Ao>Am){Am=Ao;}}else{if(An.dataType===AY.SIZE_BY){Ao=AP(An.dataObj,Ak);if(Ao>Al){Al=Ao;}}}});return Math.max(Am,Al)+2*Af;}function i(Ak,Aq,Ao,An){var Al=d(Ak,Aq,An),Aj=Al.height,Ap=Ao-W*2,Am={};Am.autoCollapse=Al.minHeight>Ap;Am.minHeight=Al.minHeight;Am.width=Aq;Am.height=Math.min(Aj,Ap);if(Aj>Ap){Am.cutBy=Aj-Ap;}return Am;}function E(Ak,Al){var Am=Ak.decodedColor||Ak.color||AB.VAL_AUTOMATIC,Aj;if(Am.c1){Aj=Ac.buildGradient(Am.or,Am.c1,Am.c2);Al.style[Ac.convertCssToCamelCase(Aj.n)]=Aj.v;}else{Al.style.backgroundColor=Am;}if(Ak.image){Al.style.backgroundImage=Ak.image;}if(Ak.opacity!==undefined){Al.style.opacity=Ak.opacity;}Al.identity=new f({objType:AG.COLOR_SQUARE,parentIdentity:this.identity,token:Ak.token,decodedColor:Ak.decodedColor,encodedColor:Ak.encodedColor,isDefaultColor:Ak.isDefaultColor});}function AU(){var Ay,Av,At,Aj,Au,A0,Ak,Ar,Ap,Am,A2=document,A1=this.triBtn,Ax=this.closeBtn,Ao=this.cbContainer,Al=this.sb1Container,Aw=this.sb2Container,Aq=this.cbTableContainer,An=null,Az=this.height-l-A-2*Af,As=this.width-2*A-2*Af;A1[z]("class","gm-legend-tri-button-collapsed");if(this.autoCollapse){A1[z]("title",mstrmojo.desc(13682,"There is not enough space to display the legend"));}else{A1[z]("title",mstrmojo.desc(13683,"Maximize Legend"));}Ax.style.display="none";this.splitter.style.display="none";this.domNode.style.overflow="hidden";for(Ay=0;this.dataArray&&Ay<this.dataArray.length;Ay++){Aj=this.dataArray[Ay];if(Aj.dataType===AY.COLOR_BY){An=Aj.dataObj;break;}}Ao.style.display=An?"block":"none";Al.style.display="none";Aw.style.display="none";if(An){At=An.elements;Av=At.length;Au=this.cbTitle;Au.style.display="none";Ao.style.top=l+w;Ao.style.width=As+w;Aq.style.top="0px";A0=this.cbTable;A0.innerHTML="";for(Ay=0;Ay<Av;Ay++){Ak=A2.createElement("tr");Ar=A2.createElement("td");Am=A2.createElement("div");Ap=A2.createElement("div");Am[z]("class","gm-legend-colorbox-ctn-div");Am[z]("type",C.LGD_COLORBOX_CTN);Am[z]("title",At[Ay].label);Ap[z]("class","gm-legend-colorbox-div");Ap[z]("type",C.LGD_COLORBOX);E.call(this,At[Ay],Ap);Ak[z]("class","gm-legend-tr");Ak.style.height=AJ+w;Ar[z]("class","gm-legend-colorbox");Am.appendChild(Ap);Ar.appendChild(Am);Ak.appendChild(Ar);A0.appendChild(Ak);if(A0.offsetHeight+AJ>Az){break;}}A0.style.top="0px";A0.style.marginLeft="0px";Aq.style.top=A+w;Aq.style.height=A0.offsetHeight+w;}Ao.style.height=Az+w;}function o(Al,Ak,An,Aj){var Am=document.createElementNS(O,"circle");Am.setAttribute("cx",Ak);Am.setAttribute("cy",An);Am.setAttribute("r",Aj);Am.setAttribute("class","gm-legend-sizeby-circle");Al.appendChild(Am);}function AD(Al,Am,Ap,Ak,Ao,Aq,An){var Aj=document.createElementNS(O,"line");Aj.setAttribute("x1",Am);Aj.setAttribute("y1",Ap);Aj.setAttribute("x2",Ak);Aj.setAttribute("y2",Ao);Aj.style.strokeWidth=Aq;if(An){Aj.setAttribute("class",An);}Al.appendChild(Aj);}function AZ(Ak,Ay){var Ax,Al,An,Ao,Am,Aj,Aw,Ap,Az,Aq,Au=Math.PI,Ar=Ay.elements,As=Ar.length,At=As*s,Av=Ak.getContext("2d"),A0={LINE_COLOR:"#b0b0b0",MIN_WIDTH:1,MAX_WIDTH:10},A1=AO.getPropertyByPath(this,"widget.model.data.visName")||AO.getPropertyByPath(this,"widget.model.data.vis.vn");switch(A1){case"GraphMatrixVisualizationStyle":if(this.shapeType===AE.SQUARE||this.shapeType===AE.TICK||this.shapeType===AE.LINE||this.shapeType===AE.BAR||this.shapeType===AE.AREA||this.shapeType===AE.RECTANGLE){Aq="rectangle";}else{Aq="circle";}break;case"VIHeatMapVisualizationStyle":Aq="rectangle";break;default:Aq="circle";break;}switch(Ay.caseFlag){case 0:Av.save();if(mstrApp.getThemeClassName().indexOf("dark")>=0){Av.strokeStyle="rgba(116, 116, 117, 0.7)";Av.fillStyle="rgba(116, 116, 117, 0.7)";}else{Av.strokeStyle="rgba(188, 188, 189, 0.7)";Av.fillStyle="rgba(188, 188, 189, 0.7)";}At=s*k;Az=Math.floor(s*0.75+0.5);Al=Math.floor(Az/3.5+0.5);if(Aq==="circle"){Ao=Az+1;Am=s;Av.beginPath();Av.arc(Ao,Am,Az,0,2*Au,false);Av.fill();Av.stroke();Ao=2*Ao+2*Al;Am=Math.floor(0.53*s+0.5);Av.beginPath();Av.arc(Ao,Am,Al,0,2*Au,false);Av.fill();Av.stroke();}else{Ao=1;Am=s-Az;Av.beginPath();Av.fillRect(Ao,Am,2*Az,2*Az);Ao=2*Az+2+Al;Am=Math.floor(0.53*s-Al+0.5);Av.beginPath();Av.fillRect(Ao,Am,2*Al,2*Al);}Av.translate(0.5,0.5);Av.lineWidth=1;Av.strokeStyle="#9C9C9C";Ao=2*Az+3*Al+3;Am=Math.floor(0.53*s+0.5);Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(At,Am);Av.stroke();Ao=2*Az+2;Am=Math.floor(1.53*s-Al+0.5);Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(Ao+Al,Am+Al);Av.lineTo(At,Am+Al);Av.stroke();Av.restore();break;case 1:break;case 2:An=parseInt(Ar[0].diameter,10);An=Math.min(An,At);Av.fillStyle="#ADADAC";Av.strokeStyle="#ADADAC";if(Aq==="circle"){Ao=At>>1;Am=Ao;Av.arc(Ao,Am,An>>1,0,2*Au,false);Av.fill();Av.stroke();}else{Ao=(At-An)>>1;Am=Ao;Av.rect(Ao,Am,An,An);Av.fill();Av.stroke();}break;case 3:Aj=A0.MIN_WIDTH;Aw=(As===1?0:(A0.MAX_WIDTH-A0.MIN_WIDTH)/(As-1));At=Ak.width;Ap=s;Ao=0;Am=s/2;Av.strokeStyle=A0.LINE_COLOR;for(Ax=0;Ax<As;Ax++){Av.lineWidth=Aj;Av.beginPath();Av.moveTo(Ao,Am);Av.lineTo(At-Ao,Am);Av.stroke();Am+=Ap;Aj+=Aw;}break;default:break;}}function AW(Ak,As){var Aq=1,Aj,Ao=1.5*H,Ar=Ak.innerHTML,Ap=a.restoreSpecialChars(Ar),Al=Ap.split(N),At,Am;var An=function(Au){Am=Ap[Au];return Am!==undefined?Am:"";};if(Ak.scrollHeight>Ao){if(!Al[0]){return 0;}Aj=Al[0]+An(Al[0].length);while(Al[Aq]!==undefined){At=Aj+Al[Aq];At+=An(At.length);Ak.innerHTML=a.replaceSpecialChars(At);if(Ak.scrollHeight>Ao){break;}Aj=At;Aq++;}Ak.innerHTML=Ar;}else{Aj=Ap;}return X(Aj,As,L);}function c(Az,Ax,Ay,At){var Aw,Al,Ao,An,As,Av,Ar=Ax.elements,Au=Ar.length,Aq=[],A0=document,Aj=A0.createDocumentFragment(),Am=false,Ap=this.styles,Ak=Ay;switch(At){case 0:if(Au>0){Aq.push({v:"Min: "+Ar[Au-1].v});Aq.push({v:"Max: "+Ar[0].v});Au=2;}break;case 1:Ar=Ax.items;P.forEach(Ar,function(A1){Aq.push({v:A1});});break;case 3:Aq=Ar;break;default:Aq=Ar;Am=true;break;}Au=Aq.length;for(Aw=0;Aw<Au;Aw++){Al=A0.createElement("tr");Al[z]("class","gm-legend-tr2");Al.style.height=s+w;if(Am){Ao=A0.createElement("td");y.call(this,Ao,Aq[Aw].sign,Aw,R|Ai|Ag);Ao[z]("class","gm-legend-sign");Al.appendChild(Ao);Ak-=r;}An=A0.createElement("td");An[z]("class","gm-legend-desc");if(Ax.custMetrics&&Ax.custMetrics.indexOf(Aq[Aw].v)!==-1){y.call(this,An,Aq[Aw].v,Aw,R|g,Ak-Q,Ap);Av=parseInt(An.lastChild.style.width,10);As=A0.createElement("div");As.setAttribute("class",AR);As.setAttribute("title",AN);An.appendChild(As);As.style.top=(s-8)/2+Aw*s+w;An.lastChild.style.marginLeft=Av+w;}else{if(Am){y.call(this,An,Aq[Aw].v,Aw,R|Ai,Ak,Ap);}else{y.call(this,An,Aq[Aw].v,Aw,R,Ak,Ap);}}Al.appendChild(An);Aj.appendChild(Al);}Az.appendChild(Aj);}function U(){var Al="."+AR,Aj=this.domLegend.querySelectorAll(Al),Ak;P.forEach(Aj,function(Am){Ak=Am.parentNode;if(Ak){Ak.removeChild(Am);}});}function T(){var BC,A4,BH=0,BI,Az,A6,A0,Am,BA,BD,Aq,BG,BB,Aj=this.width-2*Af,Au=Aj-2*A,Ao=document,Al=this.triBtn,A5=this.closeBtn,A3=this.cbContainer,Av=this.cbTableContainer,BJ=this.sb1Container,Ap=this.sb2Container,At,Ar,An,As,A8,Ax,A7=this.cutBy,A2=l,BE=0,A1=this.styles,A9,BF,Ay=(H+AT)/2,Ak,Aw;Al[z]("class","gm-legend-tri-button");Al[z]("title",mstrmojo.desc(13684,"Minimize Legend"));A5.style.display="block";A5[z]("title",mstrmojo.desc(12002,"Hide Legend"));this.updateSplitter();U.call(this);this.domNode.style.overflow="visible";A3.style.display="none";BJ.style.display="none";Ap.style.display="none";for(A4=0;this.dataArray&&A4<this.dataArray.length;A4++){Ar=this.dataArray[A4];A8=null;Ax=null;if(Ar.dataType===AY.COLOR_BY){A8=Ar.dataObj;if(A8){A3.style.display="block";A0=a.removeExtraSpace(A8.item);Am=A8.elements;BC=Am.length;A3.style.top=A2+w;A3.style.width=Au+w;BG=0;if(BE===0){Ac.addClass(this.sepLine1,"toggleHide");BE++;}BI=this.cbTitle;BI.style.display="block";AI(BI,A0,A1,Au);BI.innerHTML=Y.encodeHtmlString(A0,true);BG+=Ae(BI,Au)+2*AF;Ak=AW(BI,A1);m(BI,A1,Ak,Ay,Au);AH(BI,0,Ay,(Ak<Au)?Ak:Au);Az=this.cbTable;Az.style.display="block";Az.style.width=(Au-AV)+w;Az.style.marginLeft=AV+w;Az.innerHTML="";Az.appendChild(this.fillColorByTable(A8,0));BA=AJ*BC+1;Av.style.top=BG+w;Az.style.display="table";BG+=BA+A;if(A7){BG-=A7;BA-=A7;}A3.style.height=BG+w;Av.style.height=BA+w;A2+=BG+h;}}else{if(Ar.dataType===AY.SIZE_BY){Ax=Ar.dataObj;if(Ax){BH++;if(BH===1){An=BJ;As=this.sb1Title;A6=this.sb1MetricNamesTable;Az=this.sb1DataTable;At=this.sb1Canvas;}else{An=Ap;As=this.sb2Title;A6=this.sb2MetricNamesTable;Az=this.sb2DataTable;At=this.sb2Canvas;}An.style.display="block";A0=a.removeExtraSpace(Ax.item);Am=Ax.elements;BC=Am.length;An.style.top=A2+w;An.style.width=Au+w;BG=0;if(BE===0){Ac.addClass(this.sepLine2,"toggleHide");BE++;}if(Ax.caseFlag===0){BD=k*s;Aq=2*s;}else{if(Ax.caseFlag===3){BD=t*s;Aq=BC*s;}else{BD=BC*s;Aq=BD;}}BI=As;BI.innerHTML=Y.encodeHtmlString(A0,true);BF=Ax.custMetrics&&Ax.custMetrics.indexOf(A0)!==-1;if(BF){Aw=Au-Q;}else{Aw=Au;}AI(BI,A0,A1,Aw);if(BF){A9=Ao.createElement("div");A9.setAttribute("class",AR);A9.setAttribute("title",AN);An.appendChild(A9);A9.style.top=(BI.offsetHeight-8)/2+AF+h+w;A9.style.left=BI.offsetWidth+"px";}Ak=AW(BI,A1);m(BI,A1,Ak,Ay,Aw);AH(BI,0,Ay,(Ak<Aw)?Ak:Aw);BG+=Ae(BI,Aw)+2*AF;BB=Au;A6.innerHTML="";if(Ax.items&&Ax.items.length>0){A6.style.display="block";c.call(this,A6,Ax,BB,1);}else{A6.style.display="none";}A6.style.top=BG+w;A6.style.left="0"+w;A6.style.width=BB+w;BG+=A6.offsetHeight;if(BD>0){BB-=BD+A;}Az.innerHTML="";if(Ax.elements&&Ax.elements.length>0){Az.style.display="block";c.call(this,Az,Ax,BB,Ax.caseFlag);}else{Az.style.display="none";}At.style.position="absolute";At.style.top=BG+w;At.style.marginLeft=A+w;Az.style.top=BG+w;Az.style.left=(BD+A)+w;Az.style.width=BB+w;BG+=Aq+A;An.style.height=BG+w;Az.style.display="table";At.width=BD;At.height=Aq;AZ.call(this,At,Ax);A2+=BG+h;}}}}}function p(){var Aj,Ak=this.textDivs,Al=Ak.length;for(Aj=0;Aj<Al;Aj++){b(Ak[Aj]);}}mstrmojo.gm.GMLegend=mstrmojo.declare(mstrmojo.VisLegend,[mstrmojo._FormateVisLegend,mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gm.GMLegend",cssClass:"gm-legend",dropZoneHighlightCss:"gm-legend-slot",dockedPositions:null,dockPos:AM.LEFT,GMW:0,GMH:0,isMinimal:false,shapeType:undefined,legendMarkup:'<div class="gm-legend-button"><div class="gm-legend-tri-button"></div><div class="gm-legend-name"></div><div class="gm-legend-close-button"></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><div class="gm-legend-table-container"><table class="gm-legend-table"></table></div></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-container"><div class="gm-legend-separator-line" style="width:{@coreWidth}px"></div><div class="gm-legend-title" type="lgd-title" style="line-height:{@lineHeight}px; max-height:{@maxHeight}px"></div><table class="gm-legend-table"></table><table class="gm-legend-table"></table><canvas type="lgd-canvas"></canvas></div><div class="gm-legend-resizer-v" draggable="false"></div><div class="gm-legend-resizeRect"></div>',init:function AC(Ak){this.styles={};this.cutBy=null;this.dataArray=null;this.textDivs=[];this.dockedPositions=[{pos:n.LEFT_TOP},{pos:n.LEFT_MIDDLE},{pos:n.LEFT_BOTTOM},{pos:n.RIGHT_TOP},{pos:n.RIGHT_MIDDLE},{pos:n.RIGHT_BOTTOM}];var Al=Ak.placeholder,Aj=Al.style;if(Al){this.cssClass=Al.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(Ak.hasOwnProperty("width")===false){Ak.width=(Aj&&Aj.width)||Al.clientWidth;}if(Ak.hasOwnProperty("height")===false){Ak.height=(Aj&&Aj.height)||Al.clientHeight;}if(Ak.hasOwnProperty("left")===false){Ak.left=Al.offsetLeft;}if(Ak.hasOwnProperty("top")===false){Ak.top=Al.offsetTop;}}this._super(Ak);},setupScrollNodes:function M(){this.scrollNode=this.cbTableContainer;},getSplitterDockPos:function(){return(this.currDockedPositionIdx<3)?AM.RIGHT:AM.LEFT;},updateAlignClass:function(){var An=this.getDockedPosition(),Ao=An&&An.pos,Al=(Ao===n.RIGHT_MIDDLE||Ao===n.RIGHT_TOP||Ao===n.RIGHT_BOTTOM||Ao===n.RIGHT),Aj=this.domLegend,Ak=this.domNode,Am=this.resizeRect;if(Al){Ac.removeClass(Aj,"gm-align-left");Ac.addClass(Aj,"gm-align-right");Ac.toggleClass(Aj,"gm-legend-alignRight",true);Ac.toggleClass(Aj,"gm-legend-alignLeft",false);Ac.toggleClass(Ak,"gm-legend-alignRight",true);Ac.toggleClass(Ak,"gm-legend-alignLeft",false);Ac.toggleClass(Am,"gm-legend-alignRight",true);Ac.toggleClass(Am,"gm-legend-alignLeft",false);}else{Ac.removeClass(Aj,"gm-align-right");Ac.addClass(Aj,"gm-align-left");Ac.toggleClass(Aj,"gm-legend-alignRight",false);Ac.toggleClass(Aj,"gm-legend-alignLeft",true);Ac.toggleClass(Ak,"gm-legend-alignRight",false);Ac.toggleClass(Ak,"gm-legend-alignLeft",true);Ac.toggleClass(Am,"gm-legend-alignRight",false);Ac.toggleClass(Am,"gm-legend-alignLeft",true);}},postBuildRendering:function(){this._super();var Av=this.styles,Ax=this.domNode,Am=this.domLegend.childNodes,Aq=Am[1],Ao=Am[2],Aw=Am[3],A0={objType:AG.LEGEND};this.addSlots({lgdBtn:Am[0],triBtn:Am[0].firstChild,lgdName:Am[0].childNodes[1],closeBtn:Am[0].lastChild,cbContainer:Am[1],sepLine1:Aq.firstChild,cbTitle:Aq.childNodes[1],cbTableContainer:Aq.childNodes[2],cbTable:Aq.childNodes[2].firstChild,sb1Container:Ao,sepLine2:Ao.firstChild,sb1Title:Ao.childNodes[1],sb1MetricNamesTable:Ao.childNodes[2],sb1DataTable:Ao.childNodes[3],sb1Canvas:Ao.childNodes[4],sb2Container:Aw,sepLine3:Aw.firstChild,sb2Title:Aw.childNodes[1],sb2MetricNamesTable:Ao.childNodes[2],sb2DataTable:Aw.childNodes[3],sb2Canvas:Aw.childNodes[4],splitter:Am[4],resizeRect:Am[5]});Ad.GMLegend.applyHTML5Props(Av);this.bgColor=Av.background||Av.backgroundColor||"transparent";AO.applyStyle2Legend(Av,Ax,this.domLegend);if(mstrApp.isInVFInteractMode){this.closeBtn.style.visibility="hidden";}var Ap=this.getSplitterDockPos(),Az=this.width-2*A-2*Af,Ar=this.cbTitle,Ak=Ar.style,Al=this.sb1Title,An=this.sb2Title,Ay=Al.style,Aj=An.style,Au=this.sepLine1,At=this.sepLine2,As=this.sepLine3;Au.style.width=Az+w;At.style.width=Az+w;As.style.width=Az+w;Ak.lineHeight=H+w;Ay.lineHeight=H+w;Aj.lineHeight=H+w;Ak.maxHeight=2*H+w;Ay.maxHeight=2*H+w;Aj.maxHeight=2*H+w;Ar.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};Al.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};An.identity={objType:AG.LEGEND_TEXT,parentIdentity:A0};this.dockPos=Ap;this.identity=Ax.identity=A0;this.updateAlignClass();},feedData:function(Aj,Ak){this.dataArray=Aj;this.isMinimal=Ak;this.textDivs=[];Ad.GMLegend.applyHTML5Props(this.styles);this.autoCollapseLegend();if(Ak||this.autoCollapse){AU.call(this);this.draggable=false;}else{T.call(this);this.draggable=true;}p.call(this);this.updateScrollbars();},autoCollapseLegend:function(){this.autoCollapse=false;},updateColorBySquare:function(Al){var Am,An,Ak,Aj;if(Al){Aj=this.domNode.querySelectorAll(".gm-legend-colorbox-div");Am=Al.elements;An=Math.min(Am.length,Aj.length);for(Ak=0;Ak<An;Ak++){E.call(this,Am[Ak],Aj[Ak]);}}},updateContainerSize:function(Aj,Ak){this.GMW=Aj;this.GMH=Ak;this.calculateDockedPositions(Aj,Ak);},updateAfterResize:function(){Ad.GMLegend.applyHTML5Props(this.styles);var Ao=0,An=this.width,Ap=this.cbContainer,Ar=this.sb1Container,Al=this.sb2Container,Am=this.sepLine1,Ak=this.sepLine2,Aj=this.sepLine3,Aq=An-2*A-2*Af;P.forEach(this.dataArray||[],function(As){if(As.dataType===AY.COLOR_BY){if(As.dataObj){if(Ap){Ap.style.width=Aq+w;}}}else{if(As.dataType===AY.SIZE_BY){if(As.dataObj){Ao++;if(Ao===1&&Ar){Ar.style.width=Aq+w;}if(Ao===2&&Al){Al.style.width=Aq+w;}}}}});if(Am){Am.style.width=Aq+w;}if(Ak){Ak.style.width=Aq+w;}if(Aj){Aj.style.width=Aq+w;}this.domLegend.style.width=this.width+w;this.domLegend.style.height=this.height+w;},updateStyle:function(Aj){this.styles=Aj;this.bgColor=Aj.background||Aj.backgroundColor||"transparent";AO.applyStyle2Legend(Aj,this.domNode,this.domLegend);},updateTitleLineHeight:function(){var Ak=this.cbTitle,An=Ak.style,Al=this.sb1Title,Aj=this.sb2Title,Ao=Al.style,Am=Aj.style;Ad.GMLegend.applyHTML5Props(this.styles);An.lineHeight=H+w;Ao.lineHeight=H+w;Am.lineHeight=H+w;An.maxHeight=2*H+w;Ao.maxHeight=2*H+w;Am.maxHeight=2*H+w;},getSplitterPosition:function(Al){var Ak=Al.src.startPos+Al.tgt.pos.x-Al.src.pos.x,An=Al.src.posInfo,Am=An&&An.min,Aj=An&&An.max;if(Am!==undefined){Ak=Math.max(Ak,Am);}if(Aj!==undefined){Ak=Math.min(Ak,Aj);}return Ak;},positionResizeRect:function(Aj,Ak){var Am=Aj.src.posInfo.dockPosition===AM.LEFT,An=Ak-AQ,Ao=Am?An:0,Al=Am?this.width-An:An;this.resizeRect.style.left=(Ao-1)+w;this.resizeRect.style.width=(Al-2)+w;},updateLegendSlot:function(Am,Aj){var Al=this.getDockedPosition(),Ak=Al&&Al.pos;if(Ak!==Am){this.currDockedPositionIdx=Aj;this.dockPos=this.getSplitterDockPos();this.updateDropZonePosition();this.updateAlignClass();this.updateSplitter();this.widget.onLegendDropZoneChange(this.getDockedPosition());}},isDragValid:function q(Aj){return !mstrApp.isInVFInteractMode&&this._super(Aj);},ondragstart:function(Aj){var Al=Aj.src.e.target,Ak=Aj.src.data;if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(false);}if(Al===this.splitter){Aj.src.startPos=Al.offsetLeft;Aj.src.posInfo=this.getSplitterInfo(Al);this.positionResizeRect(Aj,Aj.src.startPos);Ac.addClass(this.resizeRect,"resizing");}else{this.cbTableScrollTop=this.cbTableContainer.scrollTop;this._super(Aj);if(!Ak||!Ak.isScrollBar){this.clearSelectedTargets();Ac.toggleClass(this.domNode,"gm-legend-hover",false);Ac.toggleClass(this.domLegend,"active",false);this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background=this.bgColor;this.isDragging=true;}}},ondragmove:function D(Aj){var Al=Aj.src.e.target,Ak;if(Al===this.splitter){Ak=this.getSplitterPosition(Aj);Al.style.left=Ak+w;this.positionResizeRect(Aj,Ak);}else{this._super(Aj);}},ondragend:function(Aj){var Al=Aj.src.e.target;if(Al===this.splitter){Ac.removeClass(this.resizeRect,"resizing");this.splitterMoved(this.getSplitterPosition(Aj)-Aj.src.startPos,Aj.src.posInfo);}else{this._super(Aj);var Ak=Aj.src.data;if(!Ak||!Ak.isScrollBar){this.cbTableContainer.scrollTop=this.cbTableScrollTop;this.domLegend.style.background="transparent";this.isDragging=false;}delete this.cbTableScrollTop;}if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},onscroll:function(){var Ak,Ao,An=this.scrollNode.scrollTop,Am,Al,Aj;if(this.prevScrpllTop===An){return ;}Ao=(this.dataArray&&this.dataArray.length)||0;for(Ak=0;Ak<Ao;Ak++){Al=this.dataArray[Ak];if(Al.dataType===AY.COLOR_BY){Aj=Al.dataObj;break;}}if(Aj){Am=this.cbTable;Am.innerHTML="";Am.appendChild(this.fillColorByTable(Aj,Math.floor(An/AJ)));this.prevScrpllTop=An;this.scrollNode.scrollTop=An;this._super();}},fillColorByTable:function(Az,Ap){var A0,Ax,Al,Ao,An,Aq,Ar,As=this.styles,Aj,Av=this.cutBy,At=this.width-2*Af-2*A,Au,Am,Ak,A1,Aw,A2;Au=Az.elements;Ax=Au.length;Aj=document.createDocumentFragment();Am=At-x-AV;Ak=0;A1=AJ*Ax;Aw=Ap*AJ;function Ay(A3){Al=document.createElement("tr");Ao=document.createElement("td");Al.style.height=A3+w;Ao[z]("class","gm-legend-colorbox");Al.appendChild(Ao);Aj.appendChild(Al);}if(Ap>0){Ay(Aw);}for(A0=Ap;A0<Ax;A0++){Al=document.createElement("tr");Ao=document.createElement("td");An=document.createElement("td");Aq=document.createElement("div");Ar=document.createElement("div");Aq[z]("class","gm-legend-colorbox-ctn-div");Aq[z]("type",C.LGD_COLORBOX_CTN);Ar[z]("class","gm-legend-colorbox-div");Ar[z]("type",C.LGD_COLORBOX);E.call(this,Au[A0],Ar);Al[z]("class","gm-legend-tr");Al.style.height=AJ+w;Ao[z]("class","gm-legend-colorbox");An[z]("class","gm-legend-desc");A2=Au[A0];if(A2.bftp){a.fillImageInDiv(An,A2.bftp,A2.label,"gm-img-legend");}else{y.call(this,An,A2.label,A0,u,Am,As);}Aq.appendChild(Ar);Ao.appendChild(Aq);Al.appendChild(Ao);Al.appendChild(An);Aj.appendChild(Al);Ak+=AJ;if(Av&&(Av+Ak-AJ)>A1){Ay(A1-Ak-Aw);break;}}return Aj;},calculateDockedPositions:function(Ak,An){var Am,Ap=this.getWidth(),Aj=this.getHeight(),Al=this.dockedPositions,Ao=function(Aq){switch(Aq.pos){case j.LEFT_TOP:Aq.x=0;Aq.y=W;break;case j.LEFT_MIDDLE:Aq.x=0;Aq.y=Math.max(W,(An-Aj)>>1);break;case j.LEFT_BOTTOM:Aq.x=0;Aq.y=Math.max(0,An-Aj-W);break;case j.RIGHT_TOP:Aq.x=Ak-Ap;Aq.y=W;break;case j.RIGHT_MIDDLE:Aq.x=Ak-Ap;Aq.y=Math.max(W,(An-Aj)>>1);break;case j.RIGHT_BOTTOM:Aq.x=Ak-Ap;Aq.y=Math.max(0,An-Aj-W);break;}};for(Am=0;Am<Al.length;Am++){Ao(Al[Am]);}this.updateDropZonePosition();},updateDropZonePosition:function(){var Aj=this.getDockedPosition(),Ak=this.dropZoneNode.style;Ak.left=Aj.x+w;Ak.top=Aj.y+w;},updateDropZoneNode:function(Aj){this._super(Aj);this.dockPos=this.getSplitterDockPos();this.updateSplitter();},onmouseover:function(Aj){var Al=this.domLegend,Ap=Aj.getTarget(),Am=Ap.getAttribute("type"),Ao=this.widget,Ak;if(this.isDragging){return ;}var An=S.copy(this.styles);An.opacity+=0.4;AO.applyStyles2DomNode(this.domNode,An);if(AA.contains(Al,Ap,true)){Ac.addClass(Al,"active");}if(Am===C.LGD_COLORBOX){Ap=Ap.parentNode;Am=Ap.getAttribute("type");}if(Am===C.LGD_COLORBOX_CTN){Ak=Ap.firstChild.identity;if(!Ak||!Ak.comb){return ;}Ac.toggleClass(Ap,"hover-colorsquare",true);return ;}if(Ao.formattingMode){switch(Am){case C.LGD_TITLE:case C.LGD_TEXT:Ac.toggleClass(Al,"hover-txt",true);break;default:Ac.toggleClass(this.domNode,"gm-legend-hover",true);break;}}},onmouseout:function(Ak){var Am=this.domLegend,Aj=Ak.e.toElement||Ak.e.relatedTarget,Ap=Ak.getTarget(),An=Ap.getAttribute("type"),Ao=this.widget,Al;AO.applyStyles2DomNode(this.domNode,this.styles);if(!AA.contains(Am,Aj,true)){Ac.removeClass(Am,"active");}if(An===C.LGD_COLORBOX){Ap=Ap.parentNode;An=Ap.getAttribute("type");}if(An===C.LGD_COLORBOX_CTN){Al=Ap.firstChild.identity;if(!Al||!Al.comb){return ;}Ac.toggleClass(Ap,"hover-colorsquare",false);return ;}if(Ao.formattingMode||Ao.isOnFormattingMode){switch(An){case C.LGD_COLORBOX_CTN:case C.LGD_COLORBOX:break;case C.LGD_TITLE:case C.LGD_TEXT:Ac.toggleClass(Am,"hover-txt",false);break;default:Ac.toggleClass(this.domNode,"gm-legend-hover",false);break;}}},onclick:function(Aj){var Am=Aj.getTarget(),Ak=Am.getAttribute("type"),Al=this.widget;if(Am===this.triBtn){if(!this.autoCollapse){this.raiseEvent({name:"gm-legend-clicked",action:(this.isMinimal?"restore":"minimize")});}}else{if(Am===this.closeBtn){this.raiseEvent({name:"gm-legend-clicked",action:"close",mousePos:Aj.e});}else{if(Ak===C.LGD_COLORBOX){Am=Am.parentNode;Ak=Am.getAttribute("type");}if(Al.formattingMode||Al.isOnFormattingMode){if(Ak===C.LGD_COLORBOX_CTN){this.selectColorBox(Am,true);}else{if(Ak===C.LGD_TEXT||Ak===C.LGD_TITLE){this.selectText();}else{this.selectLegendBody();}}}else{this.clearSelectedColorBox();}}}AA.stopPropogation(null,Aj.e);},attachClearEvent:function(){if(this.clearSelectTargetfn){return ;}var Ak=this,Aj=this.domLegend;this.clearSelectTargetfn=function(Ao){var An=Ao.target,Al=Ak.widget.toolEditor,Am;if(!AA.contains(Aj,An,true,Aj)){if(Al){Am=Al.domNode;if(!AA.contains(Am,An,true,Am)){Ak.clearSelectedTargets();}}else{Ak.clearSelectedTargets();}}};AA.attachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);},clearSelectedColorBox:function(){var Aj=this.selectedColorBox;if(Aj){Ac.toggleClass(Aj,"select",false);Ac.toggleClass(Aj,"selectfmt",false);this.selectedColorBox=undefined;}},clearSelectedText:function(){Ac.removeClass(this.domNode,"select-txt");},clearSelectedLegendBody:function(){Ac.removeClass(this.domNode,"gm-legend-select");},clearSelectedTargets:function(){this.clearSelectedColorBox();this.clearSelectedText();this.clearSelectedLegendBody();if(this.clearSelectTargetfn){AA.detachEvent(document.body,"mousedown",this.clearSelectTargetfn,true);delete this.clearSelectTargetfn;}},selectColorBox:function(Al,Ak){var Aj=Al.firstChild.identity;if(!Aj||!Aj.comb){return ;}this.clearSelectedText();this.clearSelectedLegendBody();if(this.selectedColorBox!==Al){this.clearSelectedColorBox();this.selectedColorBox=Al;if(Ak){Ac.toggleClass(Al,"selectfmt",true);}else{Ac.toggleClass(Al,"select",true);}this.attachClearEvent();}},selectText:function(){this.clearSelectedColorBox();this.clearSelectedLegendBody();Ac.addClass(this.domNode,"select-txt");this.attachClearEvent();},selectLegendBody:function(){this.clearSelectedColorBox();this.clearSelectedText();Ac.addClass(this.domNode,"gm-legend-select");this.attachClearEvent();},adjustColorPickerPos:function(Aj){var Am=AA.position(Aj),Ak=0,Al={};if(this.currDockedPositionIdx<3){Al.x=Am.x+Am.w+Ak;Al.alignLeft=true;}else{Al.x=Am.x-Ak;Al.alignLeft=false;}Al.y=Am.y+Am.h+Ak;return Al;},getSplitterInfo:function(Ao){if(!Ao){return{};}var Ak=this.dockPos,An={},Am=this.width,Aj=AK,Al=Math.floor(this.GMW/3);An.dockPosition=Ak;if(Ak===AM.LEFT){An.min=Math.min(Am-Al,0);An.max=Math.max(Am-Aj,0);}else{if(Ak===AM.RIGHT){An.min=Aj;An.max=Al;}}An.min+=AQ;An.max+=AQ;return An;},splitterMoved:function(Aj,Ak){if(Aj===0){return ;}if(Ak.dockPosition===AM.LEFT){Aj=-Aj;}this.raiseEvent({name:"gm-legend-resized",position:Aj});this.updateSplitter();if(this.widget&&this.widget.setInteractive){this.widget.setInteractive(true);}},updateSplitter:function(){AS(this.splitter,this.dockPos,this.width,this.height);this.resizeRect.style.height=this.height-2+w;}});Ad.GMLegend.IMAGE_SIZE_FIXED=0;Ad.GMLegend.applyHTML5Props=function(Al){var Am=parseInt(Al.fontSize,10)||8,Ak;if(Al.fontSize.indexOf("px")>=0){Am=Math.floor(Am*Z+0.5);}Ak=Math.floor(Am/Z*F+0.5);H=Math.max(Am,8)+9;AT=Math.floor(Am/Z+0.5);e=Math.max(Ak,15);AJ=Ad.GMLegend.IMAGE_SIZE_FIXED||(Math.max(Ak,20)+2);s=Math.max(Ak,14)+2;Af=parseInt(Al.borderWidth,10)||1;var Aj=parseInt(Al.tbHeight,10);l=isNaN(Aj)?K:Aj;};Ad.GMLegend.getLegendSize4MinMode=function(Ak,Al){var An,Am,Aj=l+2*Af;if(Ak){Am=Ak.elements;An=Am.length;Aj+=AJ*An;Aj+=2*A;}Aj=Math.min(Aj,Al-W*2);return{width:x+5+7+2*Af,height:Aj};};Ad.GMLegend.getLegendSize=function(Ax,Am,Aj,Ap,Az,Aq){var Ar,Ak,Ay,Ao,An=Ap-W*2,Av=0,Al=0,Au={},At,As,Aw;if(!Ax||!Ax.length||Ax.length<1){return{};}if(Am!==undefined){if(!Aq){Aq=Math.floor(Ab(Ax,Az)*Am);}Ao=Math.min(Aq,Math.floor(Aj/3));Ao=Math.max(Ao,50);return i(Ax,Ao,Ap,Az);}Ao=Math.min(Math.floor(0.2*Aj),300);for(Ar=0;Ar<Ax.length;Ar++){As=Ax[Ar];if(As.dataType===AY.COLOR_BY){At=Aa(As.dataObj,Az);if(At>Av){Av=At;}}else{if(As.dataType===AY.SIZE_BY){At=AP(As.dataObj,Az);if(At>Al){Al=At;}}}}Ak=Math.max(Av,Al)+2*Af;Au.width=Math.min(Ak,Ao);Au.scale=Au.width/Ak;Aw=d(Ax,Au.width,Az);Ay=Aw.height;Au.autoCollapse=Aw.minHeight>An;Au.minHeight=Aw.minHeight;Au.height=Math.min(Ay,An);if(Ay>An){Au.cutBy=Ay-An;}return Au;};}());(function(){mstrmojo.requiresCls("mstrmojo.VisBase","mstrmojo.dom","mstrmojo.array","mstrmojo.num","mstrmojo.hash","mstrmojo.color","mstrmojo.css","mstrmojo.string","mstrmojo.VisEnum","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.VisUtility","mstrmojo.util.ui._LassoSelector","mstrmojo.ui.menus._HasMenuPopup","mstrmojo._colorPalette","mstrmojo._VizSelectionHelper","mstrmojo.VisTooltip","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.enums.EnumFeatures","mstrmojo.heatmap.vi._HasHeatmapContextMenu","mstrmojo.netviz.ObservableModel","mstrmojo.chart.model.enums.EnumDSSDefaultFormats","mstrmojo.util.color","mstrmojo.vi.ui._IsDropTarget","mstrmojo.gm._SupportDndAsBlackBox","mstrmojo.ui.PopupConfig","mstrmojo.netviz.PropertyParser","mstrmojo.vi.viz.EnumDSSDropZones","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.PerformanceLogOutput");mstrmojo.requiresClsP("mstrmojo.gm","GMLegend","EnumLegendSlot","GMUtility");mstrmojo.requiresClsP("mstrmojo.vi.ui.rw","_HasVisSelections","selectors._IsMultiUnitControl","selectors._BrushesAndHighlights","_XtabDE");mstrmojo.requiresClsP("mstrmojo.heatmap.vi","_SupportHeatmapBrushesAndHighlights","VisHeatMapColorTheme","VisHeatMapCanvas","VisHeatMapHighlightCanvas","VisHeatmapUtility");var U=mstrmojo,BE=U.css,Ag=U.array,Ak=mstrmojo.string,AO=U.VisUtility,BL=mstrmojo.heatmap.vi.VisHeatmapUtility,m=mstrmojo.vi.enums.EnumFeatures,A9=U.gm,Y=A9.GMLegend,Ad=A9.EnumLegendSlot,j=A9.GMUtility,M=U.PerformanceLogOutput,Bg=U.VisEnum.GMLegendDataType,AK=U.chart.enums.EnumFontStyle,AN=mstrmojo.vi.enums.EnumThemeProperties,G=AN.SUBTYPE.HEATMAP,BV=U.VisEnum,Ao=BV.GMLegendFormatingPropertyTag,W=BV.LegendPropertyTag,BO=BV.EnumLegendMode,r=BV.FormNameDisplayType,v=BV.EnumColorRankMode,AY=mstrmojo.hash,Av=U.dom,AI=U.util.color,y=U.color,O=mstrmojo.VisEnum.HEATMAP_PROPERTIES,Ba=mstrmojo.vi.viz.EnumDSSDropZones;var Bq=BV.SERVER_JSON_ERROR_TYPE;var Ah=["at","dei","dpt","o","tui","ui"],b=Ah.length;var Bp=["mousedown","mouseup","mousemove","mouseout","click","contextmenu"];var Ar=5;var BY={lgdBgFillClr:[15461355,1710618],lgdBgFillStyle:[0,0],lgdBgFillEff:[1,1],lgdBgFillTrans:[0,100],lgdFntSz:["8pt","8pt"],lgdFntFml:["Arial","Arial"],lgdFntStyle:[0,0],lgdFntClr:[6710886,16777215],lgdBdrShw:[false,false],lgdBdrClr:[11579568,5855577],lgdBdrThk:[1,1],lgdBdrStyle:[0,0],lm:[1,1],lwr:[undefined,undefined]},Ac;var D=[{pos:Ad.LEFT_TOP},{pos:Ad.LEFT_MIDDLE},{pos:Ad.LEFT_BOTTOM},{pos:Ad.RIGHT_TOP},{pos:Ad.RIGHT_MIDDLE},{pos:Ad.RIGHT_BOTTOM}];var BS={VERTICAL:0,HORIZONTAL:1};var Q=mstrmojo.desc(14741,"Absolute value of");var BR="-";var w=false;function Bl(){var Bs=this.modelData,Bx=Bs.gsi.mx,Bu=this.props.sizeMetricID,Br=AO.findInArray(Bx,function(By){return By.did===Bu;}),Bv=false,Bw={min:-Infinity,max:Infinity},Bt={min:Infinity,max:-Infinity};if(Br===-1){return Bw;}this.dfs(this.root,function(Bz){if(Bz.entityChildren!==undefined){return ;}var B1=Bz.aggValues||[],By=B1[Br],B0=By.value;if(By.count===0||isNaN(B0)){return ;}Bv=true;if(B0<0){Bt.hasNegativeValue=true;B0=Math.abs(B0);}Bt.min=Math.min(Bt.min,B0);Bt.max=Math.max(Bt.max,B0);});return Bv?Bt:Bw;}function BF(Bs){if(!Bs||Bs.length!==3){return true;}var Br=Bs[0];return Bs.slice(1).every(function(Bt){return AY.equals(Br,Bt);});}function Al(){var Br=this;return{colorTheme:this.colorTheme,alias:"canvasObject",slot:"canvasSlot",root:this.root,width:this.heatMapSize.w,height:this.heatMapSize.h,attributes:this.levelAttributes,showMetric:this.props.showMetricValues,labelSetting:this.props.labelSize,isHeaderOnTop:this.props.isHeaderOnTop,fonts:this.props.fonts,bgColor:this.getSingleBackgroundColor(),isHeaderColorsModified:function(){return BF(Br.props.headerColors);}};}function J(Bs,Br){if(!Array.isArray(Bs)||!Array.isArray(Br)){return false;}if(Bs===Br){return true;}if(Bs.length!==Br.length){return false;}return Bs.every(function(Bt){return Br.indexOf(Bt)!==-1;});}function BA(Bs){Bs=Bs||[];var Bt={name:"selectionChange",type:[],selectedEntities:Bs},Br;if(A7.call(this)){Br=AG(Bs);if(Br.length>0){Bt.type.push("shapeColor");Bt.colorbyElements=Br;}this.edtModelCbInitSelection=Br;}this.raiseEvent(Bt);}function AZ(Br){Br=Br||[];if(A7.call(this)){this.cmColorByElements=AG(Br);}}function AG(Bs){var Br=Bs.filter(function(Bt){var Bu=Bt.colorByAttributeIds,Bv=Bt.colorByElementIds;return Bu&&Bv&&Bu.length===Bv.length;}).map(function(Bu){var Bv=Bu.colorByAttributeIds,Bw=Bu.colorByElementIds,Bt=Bu.colorByTypes;return Bv.map(function(By,Bx){return{tid:By,eid:Bw[Bx],tp:Bt[Bx]};});});return AO.arrayUnique(Br,function(Bt,Bu){Bt=AY.clone(Bt);Bu=AY.clone(Bu);return j.isEqualComb(Bt,Bu);});}function AS(Bx,Bt){var Bv=this.getPropsInfo().attrColorByOpacity||{},Bw,Bs,Br,Bu;Bx=Bx||[];Bt=Bt||[];Bw=Bx.join("|");Bs=Bt.join("|");Br=Bv[Bw]||{};Bu=Br[Bs];if(Bu===undefined){Bu=100;}return Bu;}function k(Bt){var Br,Bs=D.length;for(Br=0;Br<Bs;Br++){if(Bt===D[Br].pos){return Br;}}return -1;}function K(Br){var Bs={};AY.keyarray(BY).forEach(function(Bt){Bs[Bt]=BY[Bt][Br];});return Bs;}function A(Bs){if(Bs.entityChildren){var Br=false;if(Bs.entityChildren.length===0){return Br;}Ag.forEach(Bs.entityChildren,function(Bt){Br=A(Bt);if(Br){return false;}});return Br;}return true;}var A8=BV.HEATMAP_LABEL_SIZE;var BM={Sum:0,Avg:1,Cnt:2,Max:3,Min:4,GeoAvg:5,AESum:6};var Ae={Squarified:0,PivotByMiddle:1,SliceAndDice:2};var AT={Padding:5,headerOnTopPadding:5,MaxLegendHeight:60,AttributeColorByLegendWidth:140,LegendMenuEditorWidth:0,LegendMinWidth:15,LegendTickLength:4,LegendMaxBandWidth:400,LegendWidthPercent:0.9,LegendMinPadding:15,LegendBottomPadding:3,LegendGutter:5,LegendBandAspect:10,MinShowLabelDimension:6,DeletedListHeight:500,EditorDialogWidth:565,EditorDialogHeight:574,EditButtonWidth:0,EditButtonHeight:0,EditButtonRight:0,HeaderPixels:19};function Bh(Br){return Br&&Br.value!==undefined&&Br.opacity!==undefined;}var Aa=[{value:"#efefef",opacity:1},{value:"#e4e4e4",opacity:1},{value:"#e4e4e4",opacity:0.7}];var E=["headerOnMiddle","headerOnTop.header","headerOnTop.cell"];var A2=(function(){var Br={headerOnMiddle:{scale:1,family:"Arial",style:"0","heatmap-one-level-1":"14pt","heatmap-multi-level-1":"24pt","heatmap-two-level-2":"14pt","heatmap-multi-level-2":"20pt","heatmap-multi-level-3":"10pt"},headerOnTop:{header:{scale:1,family:"Arial",style:"0","heatmap-level-1-header-on-top":"12pt","heatmap-level-2-header-on-top":"11pt","heatmap-level-3-header-on-top":"11pt"},cell:{scale:1,family:"Arial",style:"0","heatmap-level-1-header-on-top":"12pt","heatmap-level-2-header-on-top":"12pt","heatmap-level-3-header-on-top":"12pt"}}};var Bs=AY.clone(Br);E.forEach(function(Bu){var Bt=AO.getPropertyByPath(Bs,Bu,{});Object.keys(Bt).filter(function(Bv){return AO.strStartsWith(Bv,"heatmap-");}).forEach(function(Bv){Bt[Bv]=AO.psPt2CssPt(Bt[Bv]);});});return Bs;}());var Bo=(function(){var Br={headerOnMiddle:{scale:1,family:"Open Sans",style:"0","heatmap-one-level-1":"14px","heatmap-multi-level-1":"24px","heatmap-two-level-2":"14px","heatmap-multi-level-2":"20px","heatmap-multi-level-3":"10px"},headerOnTop:{header:{scale:1,family:"Open Sans",style:"0","heatmap-level-1-header-on-top":"12px","heatmap-level-2-header-on-top":"11px","heatmap-level-3-header-on-top":"11px"},cell:{scale:1,family:"Open Sans",style:"0","heatmap-level-1-header-on-top":"11px","heatmap-level-2-header-on-top":"11px","heatmap-level-3-header-on-top":"11px"}}};var Bs=AY.clone(Br);return Bs;}());var R={headerOnTop:{header:{max:16/12,min:8/11},cell:{max:16/12,min:8/11}},headerOnMiddle:{max:36/24,min:8/10}};var Bf="--";var F=16119287;function Ap(Bs,Br){E.forEach(function(Bw){var B0=AO.getPropertyByPath(Bs,Bw,{}),Bv=AO.getPropertyByPath(R,Bw),Bu=AO.getPropertyByPath(Br,Bw,mstrmojo.emptyFn);var Bz,Bt,Bx,By;if(Bv){Bz=B0.scale;Bt=Bv.max;Bx=Bv.min;By={valid:true,min:"gt",max:"lt"};if(Bz>=Bt){Bz=Bt;By.valid=false;By.max=Bz===Bt?"eq":"gt";}if(Bz<=Bx){Bz=Bx;By.valid=false;By.min=Bz===Bx?"eq":"lt";}Bu(By,Bz);}});}function AP(Bs,Br){return Bs.reduce(function(Bx,Bw){var Bt=Bw.split("."),Bu=Bt.length,Bv=Bx;Bt.forEach(function(Bz,By){if(By===Bu-1){Bv[Bz]=Br(Bw);}if(Bv[Bz]===undefined){Bv[Bz]={};}Bv=Bv[Bz];});return Bx;},{});}function A6(Bt){var Br=AP(E,function(){return false;}),Bs=AP(E,function(Bu){return function(By,Bw){var Bv=Bu.split("."),B0=Bv.length-1,Bz=Bv[B0],Bx=B0===0?Br:AO.getPropertyByPath(Br,Bv.slice(0,B0).join("."));if(Bx!==undefined){Bx[Bz]=By;}};});Ap(Bt,Bs);this.raiseEvent({name:"fontScaleChange",type:"*",limits:Br});}function AF(B9,CA){var CB=this,B0={act:"updateTemplate",keyContext:CB.k,actions:[]},B5=B0.actions,B3=CB.zonesModel,Bz=[AO.pick(B9,["did","t"])],Br={id:Ba.Grouping},Bv=CB.getContextMenuSelections(),Bw=CB.modelData.datasetId,B4="00000000000000000000000000000000",B2=0,Bt=3,B8=CA.headerDrill,B1=CA.keepParent;var Bx={datasetId:Bw,datasetType:Bw===B4?B2:Bt};var By=Array.prototype.push;if(B8&&Bv.length>0){var Bs=null,B7=B3.getZoneModelByZoneId(Br.id),B6=Bv[Bv.length-1][0].tid;B7.items.forEach(function(CC){if(CC.did===B6){Bs=CC;return false;}});if(B1){By.apply(B5,B3.getAddDropZoneUnitsActions(Br,Bz,Bs?Bs.idx+1:0));}else{if(Bs){By.apply(B5,B3.getRemoveDropZoneUnitActions(Br,Bs));By.apply(B5,B3.getAddDropZoneUnitsActions(Br,Bz,Bs.idx));}}}else{var Bu=B3.getItemCountInZone(Br.id);By.apply(B5,B3.getAddDropZoneUnitsActions(Br,Bz,Bu,Bx));}return B0;}function d(Bu,Bv,Bw){var Bt=Bw.needsCopy,Bs=Bw.invalidReplacement;if(Bt&&Bu.total===undefined){Bu.avgTotal=Bu.total=Bu.geomProduct=Bu.max=Bu.min=Bu.value;Bu.positiveCount=Bu.value>0?1:0;}var Br=!isNaN(Bv);Bu.value=Br?Bv:Bs;Bu.count+=Br?1:0;Bu.allValueCount+=1;this.aggregated=Br;if(Br){if(isNaN(Bu.total)){Bu.total=Bv;}else{Bu.total+=Bv;}if(isNaN(Bu.avgTotal)){Bu.avgTotal=Bv;}else{Bu.avgTotal+=Bv;}if(isNaN(Bu.max)){Bu.max=Bv;}else{Bu.max=Math.max(Bu.max,Bv);}if(isNaN(Bu.min)){Bu.min=Bv;}else{Bu.min=Math.min(Bu.min,Bv);}if(isNaN(Bu.geomProduct)){if(Bv>0){Bu.geomProduct=Bv;Bu.positiveCount++;}}else{if(Bv>0){Bu.geomProduct*=Bv;Bu.positiveCount++;}}Bu.count++;}}function BG(Br){return Br.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');}var AR={dftUnDel:0,dftDel:1,usrDel:2};var BJ=(function(){var Bu=new window.DOMParser(),Br,Bs;try{Br=Bu.parseFromString("<","text/xml");Bs=Br.getElementsByTagName("parsererror")[0].namespaceURI;return function(Bv){return Bv.getElementsByTagNameNS(Bs,"parsererror").length>0;};}catch(Bt){return null;}}());function S(B5){if(B5.trim()===""){return{};}var Br=new window.DOMParser(),B0=false,B3;try{B3=Br.parseFromString(BG(B5),"text/xml");B0=BJ&&BJ(B3);}catch(B2){B0=true;}if(B0){return{};}var Bs=B3.childNodes[0]||{},By=B3.childNodes[0].childElementCount||0,B1=Bs.firstElementChild,Bt=B1&&B1.attributes,Bx=Bt&&Bt.length||0,Bz={},Bw=0,Bu,B4,Bv;while(Bw<By){Bu=Bz;Bt=B1.attributes;for(Bv=0;Bv<Bx;Bv++){B4=Bt[Bv].value;if(Bv===(Bx-1)){Bu[B4]=AR.dftDel;}else{if(!Bu[B4]){Bu[B4]={};}Bu=Bu[B4];}}Bw++;B1=B1.nextElementSibling;}return Bz;}function g(Br){return parseInt(Br,10);}function Bj(Br){return !!(Br&&Br.toString()==="true");}function AH(){var Br=this.modelData.dz,Bs=this.props;if(Br){if(Br.ColorBy&&Br.ColorBy.TemplateMetric&&Br.ColorBy.TemplateMetric[0]&&Br.ColorBy.TemplateMetric[0].id){Bs.colorMetricID=Br.ColorBy.TemplateMetric[0].id;this.setColorByType("metric");}else{Bs.colorMetricID=Bf;if(Br.ColorBy&&Br.ColorBy.TemplateUnit){x.call(this,Bs,Br.ColorBy.TemplateUnit,Z);this.setColorByType("attribute");}}if(Br.SizeBy&&Br.SizeBy.TemplateMetric&&Br.SizeBy.TemplateMetric[0]&&Br.SizeBy.TemplateMetric[0].id){Bs.sizeMetricID=Br.SizeBy.TemplateMetric[0].id;}else{Bs.sizeMetricID=Bf;}}}function At(Br){return AO.getPropertyByPath(Br,"ghs.chs.items.0.items",[]);}function A4(Bz){var By="",Bu=this.modelData,Bt=Bu.ghs.chs.items,Bs=Bt.length,Bv=Bt[0].items.length,B1=Bu.gts.col,Bw;if(Bz<0||Bz>=Bv){return"";}for(Bw=0;Bw<Bs;Bw++){var Bx=Bt[Bw].items[Bz].idx;var B0=B1[Bw].es[Bx];var Br=(B0.oid!==undefined)?B0.oid:B0.id;By+=Br+" ";}return By.slice(0,By.length-1);}function t(){var Bt=this.modelData,Bu=At(Bt).length,Br=this.props.sizeMetricID,By=this.props.colorMetricID,Bz=[],Bw;this.metricArray=Bz;for(Bw=0;Bw<Bu;Bw++){Bz.push(A4.call(this,Bw));}Bz.push(Bf);Bu++;this.sizeMetricIndex=0;this.colorMetricIndex=Bu>2?1:0;for(Bw=0;Bw<Bu;Bw++){if(Br===Bz[Bw]){this.sizeMetricIndex=Bw;}if(By===Bz[Bw]){this.colorMetricIndex=Bw;}}if(Br===undefined){Br=Bz[this.sizeMetricIndex];this.props.sizeMetricID=Br;}if(By===undefined){By=Bz[this.colorMetricIndex];this.props.colorMetricID=By;}if(this.props.sizeMetricID===Bf){this.props.sizeMetricEnabled=false;}if(this.props.colorMetricID===Bf){this.props.colorMetricEnabled=false;this.colorTheme.hasNoColorMetric=true;}if(AO.isOnExpressMode()&&this.props.colorMetricEnabled){this.setColorByType("metric");var Bs=Bt.gsi.thresholds;if(!Bs||Object.keys(Bt.gsi.thresholds).length===0){Bt.gsi.thresholds=AO.getMockUpThresholds(this.props.colorMetricID,this.getMetricName(this.colorMetricIndex));}}this.props.hasColorInThresholds=false;if(this.isMetricColorByType()&&Bt.gsi.thresholds[this.props.colorMetricID]!==undefined){var B0=Bt.gsi.thresholds[this.props.colorMetricID];for(Bw=0;Bw<B0.length;Bw++){var Bx=B0[Bw];if(Bx&&Bx.fmt){var Bv=Bx.fmt;if(Bv.bc===undefined&&typeof Bv.fc=="string"){Bx.fmt.bc=Bv.fc;Bx.fmt.bgs=Bx.fmt.bgs||0;this.props.hasColorInThresholds=true;}else{if(Bv.bc){this.props.hasColorInThresholds=true;break;}}}}}if(this.isMetricColorByType()&&this.props.sizeMetricEnabled===false&&this.props.hasColorInThresholds===false){this.props.showLegend=false;}}function Bd(Bs,Br){return this.getAttributeIndex({id:Bs},Br);}function Z(Bu,Bw){var Bs=this.modelData,Bt=Bs&&Bs.gts,Bv=Bt&&Bt.row,Bx=Bu.id,Br=AO.isHierarchyObject(Bu)?"hid":"id";return AO.findInArray(Bv,function(By){return By[Br]===Bx;},Bw);}function x(By,Bt,Br){var Bx=(Bt||[]).length,Bu,Bv=[],Bs=[],Bz=this.modelData&&this.modelData.gts&&this.modelData.gts.row,Bw;for(Bu=0;Bu<Bx;Bu++){Bw=-1;while(true){Bw=Br.call(this,Bt[Bu],Bw+1);if(Bw!==-1){Bv.push(Bw);}else{break;}}}Bv.sort();for(Bu=0,Bx=Bv.length;Bu<Bx;Bu++){Bs.push(Bz[Bv[Bu]]);}By.colorAttributeIndexes=Bv;By.colorAttributes=Bs;}function AX(){var B4=mstrmojo.netviz.PropertyParser,Bs=B4.BooleanProperty,Bx=B4.IntegerProperty,Bu=B4.FloatProperty,Br=B4.StringProperty,Bw=B4.JsonProperty;var Bt=this.getProperties(),Bz=BL.isSpatial(),Bv={deletedList:{key:O.deletedList,type:Bw.preset({}),preSet:function(B7,B8,B5,B6){return B7===undefined?B7:S(B7);}},showMetricValues:{key:O.showMetricValues,type:Bs.preset(Bz)},labelSize:{key:O.labelSize,type:Bx.preset(A8.On),preSet:function(B7,B8,B5,B6){return A8[B7];},postGet:function(B7,B9,B5,B6){var B8="On";Object.keys(A8).some(function(CA){if(A8[CA]===parseInt(B7,10)){B8=CA;return true;}return false;});return B8;}},showLegend:{key:O.showLegend,type:Bs.preset(true)},layout:{key:O.layout,type:Bx.preset(Ae.Squarified)},isHeaderOnTop:{key:O.headerType,type:Bs.preset(true),preSet:function(B7,B9,B5,B6){if(B7===undefined){return ;}var B8=B7.toString();if(B8==="true"||B8==="false"){return B8==="true";}return g(B7)!==0;},postGet:function(B7,B8,B5,B6){return B7==="true"?1:0;}},themeType:{key:O.themeType,type:Br.preset("light"),preSet:function(B7,B8,B5,B6){return g(B7)!==0?"light":"dark";},postGet:function(B7,B8,B5,B6){return B7==="dark"?0:1;}},headerColors:{key:O.headerColors,type:Bw.preset(AY.clone(Aa)),postSet:function(B9,CA,B6,B7){var B8=true;if(B9){if(!(B9 instanceof Array)){B9=[B9,B9,B9];}Ag.forEach(B9,function(CB){if(!Bh(CB)){if(CB&&CB.color!==undefined){CB.value=AI.getCSSColorString(CB.color);CB.opacity=1;CB.color=undefined;}else{B8=false;return false;}}});}else{B8=false;}var B5=B8?B9:AY.clone(Aa);this.isDefaultHeaderColor=BF(B5)===false;return B5;}},fonts:{key:O.fonts,type:Bw.preset(AY.clone(Bz?Bo:A2)),postSet:function(B7,B8,B5,B6){return AY.mergeHashes(AY.clone(Bz?Bo:A2),B7);}},attrColorByOpacity:{key:O.attrColorByOpacity,type:Bw.preset({})},metricColorByOpacity:{key:O.metricColorByOpacity,type:Bu.preset(1)},lgdBgFillClr:{key:Ao.LEGEND_BG_COLOR,type:Bw.preset(undefined)},lgdBgFillStyle:{key:Ao.LEGEND_BG_FILL_STYLE,type:Br.preset(undefined)},lgdBgFillEff:{key:Ao.LEGEND_BG_FILL_EFFECT,type:Br.preset(undefined)},lgdBgFillTrans:{key:Ao.LEGEND_BG_FILL_TRANSPARENCY,type:Br.preset(undefined)},lgdFntSz:{key:Ao.LEGEND_FONT_SIZE,type:Br.preset(undefined)},lgdFntFml:{key:Ao.LEGEND_FONT_FAMILY,type:Br.preset(undefined)},lgdFntStyle:{key:Ao.LEGEND_FONT_STYLE,type:Bx.preset(undefined)},lgdFntClr:{key:Ao.LEGEND_FONT_COLOR,type:Bx.preset(undefined)},lgdBdrShw:{key:Ao.LEGEND_BORDER_SHOW,type:Bs.preset(undefined)},lgdBdrClr:{key:Ao.LEGEND_BORDER_COLOR,type:Br.preset(undefined)},lgdBdrStyle:{key:Ao.LEGEND_BORDER_LINE_STYLE,type:Br.preset(undefined)},lgdBdrThk:{key:Ao.LEGEND_BORDER_THICKNESS,type:Br.preset(undefined)},lm:{key:W.LEGEND_MODE,type:Bx.preset(undefined)},LegendPosition:{key:W.LEGEND_POSITION,type:Bx.preset(2)},lwr:{key:W.SCALE_LEGEND_WIDTH,type:Bu.preset(undefined)}};var B0=mstrmojo.heatmap.vi.VisHeatMapColorTheme.newInstance();B0.initialize();this.colorTheme=B0;this.props=new B4().parse(Bt,Bv)||{};var By=this.props;B0.style=By.themeType;if(By.showLegend&&!By.colorByType&&By.sizeMetricID===Bf){By.showLegend=false;}By.sizeMetricEnabled=true;By.colorMetricEnabled=true;By.legendAsc=true;By.headerPixels=AT.HeaderPixels;var B3="metric",B2=this.modelData.dz,B1;if(AO.isValidDropZone(B2)){AH.call(this);}else{if(Bt[O.metricList]){B1=Bt[O.metricList].split(",");if(B1.length>=2){By.sizeMetricID=B1[0]||Bf;if(g(Bt[O.colorByType])===1){this.setColorByType("attribute");B1.splice(0,1);By.colorAttributeIDs=B1;x.call(this,By,B1,Bd);}else{this.setColorByType(B3);By.colorMetricID=B1[1];}}else{By.sizeMetricID=Bf;}}}if(Bt.rlp==="false"&&Bt[O.absoluteFixed]){B0.convertAbsoluteToBlend(this,Bt);}B0.isBlend=true;if(Bt[O.blendColor]){B0.isBlend=Bj(Bt[O.blendColor]);}if(Bt.gradientColors&&Bt.bandColors){B0.createDataProviderFromString(Bt.gradientColors,Bt.bandColors);}if(Bt.rlp==="false"&&Bt[O.absoluteFixed]){this.colorTheme.convertAbsoluteToBlend(this,Bt);this.colorTheme.createDataProviderFromString(Bt.gradientColors,Bt.bandColors);}this.bgColor=this.getFormats()["background-color"]||B0.getBackgroundColor();this.background={value:this.bgColor,opacity:1};t.call(this);}function z(){this.aggFunctions=[];var Bz=this.props,By=Bz.colorMetricID,B1=this.aggFunctions,Bu=this.modelData,Bs=Bu.vp||{},Bv=this.metricArray,Bw=Bv.length-1,Bx;if(By!==Bf){var B0=Bs["mle"+By]==="true";if(B0){var Bt=parseFloat(Bs["mlma"+By]);if(!isNaN(Bt)){this.mlmax=Bt;}Bt=parseFloat(Bs["mlmi"+By]);if(!isNaN(Bt)){this.mlmin=Bt;}}}for(Bx=0;Bx<Bw;Bx++){var Br="agf"+Bv[Bx];if(Bs[Br]!==undefined){B1.push(parseInt(Bs[Br],10));}else{B1.push(BM.AESum);}}}function T(){z.call(this);var Cj=this.modelData,Cp=this.props.deletedList,CY=(Cj.gts&&Cj.gts.row)||[],Cc=CY.length,B2=(Cj.gvs&&Cj.gvs.items)||[],CU=(Cj.ghs&&Cj.ghs.rhs&&Cj.ghs.rhs.items)||[],CV=CU.length,B7=At(Cj).length,B9=AO.range(0,B7).map(AO.hasValidValueInMetric.bind(this,this)),CS=this.colorMetricIndex,Bu={max:-Infinity,min:Infinity};if(Cc<=0&&!AO.isOnExpressMode()&&!this.excludeData){this.setError(null,Bq.NO_TEMPLATE_UNIT);return ;}if(AO.isOnExpressMode()&&(!AO.hasOnlyMetricsOnColumn(Cj)||!AO.hasNoMetricOnRow(Cj))){this.setError(mstrmojo.desc(13685,"The Heat Map requires at least one attribute on the row axis to render properly; it is recommended that two metrics be placed on the column axis as well"));return ;}if(AO.hasMergedRowCells(Cj)){this.setError(mstrmojo.desc(13686,"The HeatMap doesn't support grid data with merged row cell. Please disable cell merge and retry"));return ;}if(this.props.sizeMetricID!==Bf){var Ct=B2.some(function(Cu){return(typeof (Cu.items[0].rv)==="number")&&Cu.items[0].rv;});if(!Ct&&!this.error){this.error=mstrmojo.desc(16186,"No data could be displayed for this view. This might be because the data only contains non-numeric string.");return ;}}if(AO.isOnExpressMode()&&this.props.colorMetricEnabled&&B9[CS]){var Br,CH,Cl,Bw,Ca,Cs;for(Br=0;Br<CV;Br++){CH=CU[Br]&&CU[Br].items;Cl=CH&&CH.length;Cs=false;for(Bw=0;Bw<Cl;Bw++){if(CH[Bw].etk===-1||CH[Bw].etk==="-1"){Cs=true;break;}}if(Cs){continue;}Ca=B2[Br]&&B2[Br].items&&B2[Br].items[CS];if(Ca){Bu.max=Math.max(Bu.max,Ca.rv);Bu.min=Math.min(Bu.min,Ca.rv);}}}this.hasNegativeSizeValue=false;this.levelAttributes=[];this.root={aggValues:[],entityChildren:[],level:0};var Cn,Cq=true,B6,Ch=this.model;for(Cn=0;Cn<Cc;Cn++){AO.restoreEsForUnit(CY[Cn]);B6=Ch.supportsViewFilterActions(CY[Cn].id);Cq=Cq&&B6;this.levelAttributes[Cn]={index:Cn,order:Cn+1,isInLOA:Cn+1>0,supportsViewFilter:B6,name:CY[Cn].n,id:CY[Cn].id};}this.allSupportsViewFilter=Cq;var CI={},CT=[];for(Cn=0;Cn<Cc;Cn++){var Cg=CY[Cn].fs;CT[Cn]=Math.max(1,Cg?Cg.length:1);}this.attSpan=CT;var CJ=true,CG,B1,Bz,CN,B5,Cf,Ci,CO,CE,CW,CL,CF=Bu.max,Cr=Bu.min,Ce;for(Cn=0;Cn<CV;Cn++){var B4=CU[Cn].items,Cm,Ck;var CK="",Bt=Cp,B3=this.root,CZ,B0=0,CA,CR,CX,Cb=-1,CD;for(Cm=0;Cm<Cc;Cm++){var Bx,Cd,Bv,CC,CB=1;if(CY[Cm].cs){CB=CY[Cm].cs;CD=true;}if(B4[B0].etk===-1||B4[B0].etk==="-1"){if(B3){Bv=B3.aggValues;for(Ck=0;Ck<B7;Ck++){Bx=parseFloat(AO.getPropertyByPath(B2,Cn+".items."+Ck+".rv"));if(isNaN(Bx)){continue;}Bv[Ck]={AETotal:Bx};}}break;}else{var CQ,Co;CR="";CX="";CO=CY[Cm];CE=CT[Cm];CL=[];for(Ck=0,CC=Math.max(CE,CB);Ck<CC;Ck++){if(B4[B0]&&B4[B0].tui===Cm){CQ=B4[B0].idx;B0++;if(CQ===-1){continue;}CW=CO.es[CQ];if(CL.indexOf(CW)===-1){CR+=CW.n+" ";if(Ck===0){CX=CW.id;CK+=CQ;}CL.push(CW);}}}CR=CR.substring(0,CR.length-1);if(Bt){Bt=Bt[BG(CR)];}var By;if(Cm!==Cc-1){if(CI[CK]!==undefined){B3=CI[CK];}else{CZ={aggValues:[],entityChildren:[],parentEntity:B3};By=B3.entityChildren;By.push(CZ);CI[CK]=CZ;B3=CZ;CZ.deleted=false;CZ.text=CR;CZ.label=CR;CZ.id=CX;CZ.level=Cm;CZ.index=Cn;Ci=B4[B0-1];for(B5=0;B5!==b;B5+=1){Cf=Ah[B5];CZ[Cf]=Ci[Cf];}}CK+=":";Co=CZ;}else{var CP;if(CI[CK]!==undefined){CA=CI[CK];CP=CA.indices;CP.push(Cn);for(Ck=0;Ck<B7+1;Ck++){Cd=CA.aggValues[Ck];Bx=parseFloat(Ck===B7?1:B2[Cn].items[Ck].rv);if(!CD){d.call(this,Cd,Bx,{needsCopy:true,invalidReplacement:B9[Ck]?0:1});}}}else{CA={indices:[],aggValues:[],parentEntity:B3};CP=CA.indices;CP.push(Cn);Bv=CA.aggValues;for(Ck=0;Ck<B7+1;Ck++){Cd={};Bv[Ck]=Cd;Bx=parseFloat(Ck===B7?1:B2[Cn].items[Ck].rv);if(isNaN(Bx)){Cd.value=B9[Ck]?0:1;Cd.count=0;}else{Cd.value=Bx;Cd.count=1;}Cd.allValueCount=1;}this.aggregated=false;if(Bt){CA.deleted=true;this.colorTheme.useDefault=false;}if(this.isMetricColorByType()&&this.props.colorMetricID!==Bf&&B9[CS]){var Ca=B2[Cn].items[CS],Bs=Ca.ti,CM=parseFloat(Ca.rv);if(CM===""||CM===undefined||CM===null){Bs=-1;}else{if(Bs===undefined){if(AO.isOnExpressMode()){if(CF===Cr){Ce=0;}else{Ce=(CM-Cr)/(CF-Cr);}if(Ce<0.1){Bs=0;}else{if(Ce>=0.1&&Ce<0.3){Bs=1;}else{if(Ce>=0.3&&Ce<0.5){Bs=2;}else{if(Ce>=0.5&&Ce<0.7){Bs=3;}else{if(Ce>=0.7&&Ce<0.9){Bs=4;}else{if(Ce>=0.9){Bs=5;}}}}}}}else{Bs=-1;}}}CA.thrColorIndex=Bs;}else{CA.thrColorIndex=-1;}By=B3.entityChildren;By.push(CA);CA.level=Cc-1;CA.text=CR;CA.label=CR;CA.id=CX;CI[CK]=CA;Ci=B4[B0-1];for(B5=0;B5!==b;B5+=1){Cf=Ah[B5];CA[Cf]=Ci[Cf];}}Co=CA;}if(B4[Cm].cet!==undefined){if(Cm-Cb!==1||(!isNaN(CG)&&CG!==Cn)){CJ=false;}if(CJ){B1=Co;Cb=Cm;CG=Cn;}if(isNaN(CN)||CN<Cm){CN=Cm;Bz=Co;}}}}}if(this.errorType!==Bq.EMPTY_DATA&&!A(this.root)&&!this.excludeData){this.setError(mstrmojo.desc(2388,"No data returned for this view. This might be because the applied filter excludes all data."));return ;}function B8(Cv){var Cw=[];var Cu;if(Cv.entityChildren){for(Cu=0;Cu<B7+1;Cu++){if(!Cw[Cu]){Cw[Cu]={AETotal:0,isAETotalFaked:false};}}Ag.forEach(Cv.entityChildren,function(C0){var Cy=B8(C0);var Cx,C2,C1,Cz;for(Cu=0;Cu<B7+1;Cu++){C2=Cw[Cu];Cx=Cy[Cu];if(C0.entityChildren){C2.AETotal+=Cx.AETotal;C2.isAETotalFaked|=Cx.isAETotalFaked;}else{C1=Cx.total;if(C1===undefined){C1=Cx.value;}Cz=Cx.allValueCount!==0&&Cx.count!==0;Cw[Cu].AETotal+=C1;Cw[Cu].isAETotalFaked|=!Cz;}}});for(Cu=0;Cu<B7+1;Cu++){if(!Cv.aggValues[Cu]){Cv.aggValues[Cu]=Cw[Cu];}}}return Cv.aggValues;}B8(this.root);if(CJ&&B1){this.previousSelected=[B1];}else{if(Bz){this.previousSelected=[Bz];}}}function Ay(Bv,Bt,Bs){var Br=Bv.aggValues;if(Bt>=Br.length){return NaN;}var Bu=Br[Bt];if(Bv.entityChildren===undefined){return Bu.allValueCount===1?Bu.value:Bu.total;}else{return Bu.AETotal;}}function a(Bt,Bs){var Br=Bs.sizeMetricIndex,Bu=Ay(Bt,Br,Bs);if(Bu<0){Bs.hasNegativeSizeValue=true;return Math.abs(Bu);}return Bu;}function L(Bs){var Br={};Br.x=Bs.x;Br.y=Bs.y;Br.w=Bs.w;Br.h=Bs.h;return Br;}function A5(Bv){var Bt=BL.isSpatial(),Bu=Bt?AN.DEFAULT_THEME_PROPS[G]:AN.CLASSIC_THEME_PROPS[G];var Bw=Bv.level,Br=this.levelAttributes.length,Bs;switch(Br){case 1:Bs={v:1,h:1};break;case 2:switch(Bw){case 0:Bs={v:1,h:3};break;default:Bs={v:1,h:1};}break;case 3:switch(Bw){case 0:Bs={v:1,h:Bu.largeGap};break;case 1:Bs={v:1,h:3};break;default:Bs={v:1,h:1};}break;default:switch(Bw){case 0:Bs={v:1,h:Bu.largerGap};break;case 1:Bs={v:1,h:Bu.middleGap};break;case 2:Bs={v:1,h:Bu.smallGap};break;default:Bs={v:1,h:1};}}if(!this.props.isHeaderOnTop){Bs.v=Bs.h;}return Bs;}function C(Br){return Br.w>0&&Br.h>0;}function BU(Br){var Bs=L(Br);if(!C(Br)){Bs.w=0;Bs.h=0;}return Bs;}function AM(Br){var Bs=Br.x;Br.x=Br.y;Br.y=Bs;Bs=Br.w;Br.w=Br.h;Br.h=Bs;return Br;}function BH(Bu,Bs){var Br=Math.max(Bu.x,Bs.x);var Bw=Math.max(Bu.y,Bs.y);var Bt=Math.min(Bu.x+Bu.w,Bs.x+Bs.w)-Br;var Bv=Math.min(Bu.y+Bu.h,Bs.y+Bs.h)-Bw;if(Bt<0||Bv<0){return{x:NaN,y:NaN,w:NaN,h:NaN};}return{x:Br,y:Bw,w:Bt,h:Bv};}function u(Bv,Bt){var Bs=BU(Bt);Bv.size=Bs;if(this.props.isHeaderOnTop&&Bv.entityChildren){var Bu=this.props.headerPixels,Bw=A5.call(this,Bv).v,Br=A5.call(this,Bv).h;if(BL.isSpatial()&&Bs.y>0){Bs.y=Bs.y-1+Br;Bs.h=Bs.h+1-Br;}Bv.headerSize=BU({x:Bs.x,y:Bs.y,w:Bs.w,h:Math.min(Bu,Bs.h)});Bv.contentSize=BU({x:Bs.x,y:Bs.y+Bu+Bw,w:Bs.w,h:Bs.h-Bu-Bw});Bv.size=L(Bv.contentSize);Bt.y=Bv.contentSize.y;Bt.h=Bv.contentSize.h;}else{delete Bv.headerSize;delete Bv.contentSize;}}function AA(B8,CL,CC,Bv,CN){var CD,B9,B4=B8.r||[],CE=B4.length,B3,CH,CA,CM=false;if(CE===0){return ;}if(CC<CL.h){B3=CC;CH=CL.h;CA=CL;}else{B3=CL.h;CH=CC;CA=L(CL);AM(CA);CM=true;}var B1=CA.x,B0=CA.y,Bs={x:B1,y:B0,w:B3,h:CH};var CB=A5.call(this,B4[0]),CG,Bu=this;var Bx={v:CB.v,h:CB.h};if((CN===true&&CM!==true)||(CN===false&&CM===true)){Bx={v:CB.h,h:CB.v};}var CI=function CI(CQ,CP){var CS=a(CQ,Bu),CR=a(CP,Bu),CO;if(isNaN(CS)){if(isNaN(CR)){CO=0;}else{CO=1;}}else{if(isNaN(CR)){CO=-1;}else{CO=CS<CR?1:-1;}}return CO;};var B5=function(CS,CT,CQ){if(B6){return 1;}var CR=a(CS,CT),CP=CH*CR/Bv;var CO=(Bv<=0||CS.deleted)?0:Math.ceil(CP);if(CO>0){CJ+=CO-CP;}if(CR<Bv){if(CQ===0&&CE>1){if(By>1){if(CO>(By>>1)){CO-=(By>>1);}}else{if(CO>1){CO--;}}if(CO+(CE-1)*(By+1)>=CH){CO=CH-(CE-1)*(By+1);B6=true;}}else{if(CQ<CE-1){if(By>1){if(CO>(By>>1)){CO-=By;}else{CO=1;}}else{if(CO>1){CO--;}}if(CJ>1&&CO>1){CO--;CJ-=1;}}else{CO=Math.max(CH+CA.y-B0,1);}}}return CO;};var B2=0,CK,CF,By=Bx.v,Bw=Math.max(1,Math.floor((CH+By)/(1+By)));if(CE>Bw){for(CG=0;CG<CE;CG++){CK=B4[CG];if(CK.deleted){continue;}B2++;}}for(CF=CE-1,CG=B2-Bw;CG>0;CF--){CK=B4[CF];if(!CK.deleted){Bv-=a(CK,this);CG--;}}var CJ=0,B6=false;for(CF=0,CG=0,B2=B4.length,CE=Math.min(CE,Bw);CG<B2;CF++){var Bt,B7;CK=B4[CF];if(CK.deleted){continue;}if(CG>=CE){B9=0;}else{B9=B5(CK,this,CG);}CG++;CD=B3;var Bz={x:B1,y:B0,w:CD,h:B9};Bt=BH(Bz,Bs);if((CN===true&&CM!==true)||(CN===false&&CM===true)){AM(Bt);}u.call(this,CK,Bt);B0+=B9+By;if(CK.entityChildren!==undefined){B7=Math.min(Bt.w,Bt.h);var Br=CK.entityChildren.slice(0);Br.sort(CI);Aj.call(this,Br,{r:[]},B7,Bt);}}}function BX(B0,CB){var Bt=0,Br=B0.r,B4=Br.length;if(B4===0){return ;}var B5,B2=Br[0].parentEntity,By=B2.entityChildren,Bv=By.length;var B6,B8,Bw;for(B6=0;B6<B4;B6++){B8=Br[B6];Bw=a(B8,this);if(!B8.deleted&&Bw>0){Bt+=Bw;}}if(B0.t===undefined){var Bz=0;for(B6=0;B6<Bv;B6++){B8=By[B6];Bw=a(B8,this);if(!B8.deleted&&Bw>0){Bz+=Bw;}}B0.t=Bz;}B8=Br[0];var B1=A5.call(this,B8),Bs={x:0,y:0,w:0,h:0};if(B8===this.root){B5=this.heatMapSize.w*this.scaleFactor*this.heatMapSize.h*this.scaleFactor;Bs.w=this.heatMapSize.w*this.scaleFactor;Bs.h=this.heatMapSize.h*this.scaleFactor;}else{if(B2===this.root){B5=this.heatMapSize.w*this.scaleFactor*this.heatMapSize.h*this.scaleFactor;Bs.w=this.heatMapSize.w*this.scaleFactor;Bs.h=this.heatMapSize.h*this.scaleFactor;}else{var CD=B2.size;B5=CD.w*CD.h;Bs=L(CD);}if(B0.t===0){B5=0;}else{B5*=Bt/B0.t;}}var Bx=CB.w,B7=CB.h,CC=false;if(CB.h>=CB.w){CC=true;AM(CB);AM(Bs);var B9=Bx;Bx=B7;B7=B9;B1={h:B1.v,v:B1.h};}if((Bs.x<CB.x)||(Bs.x+Bs.w>CB.x+CB.w)){if(B1.h>1){Bx+=(B1.h>>1);}}if((Bs.y<CB.y)||(Bs.y+Bs.h>CB.y+CB.h)){if(B1.v>1){B7+=(B1.v>>1);}}var B3=B7===0?0:Math.min(CB.w,Math.ceil(B5/B7));if(Bt<B0.t&&Bt>0){if(CB.x+B3<Bs.x+Bs.w){if(B1.h>1){if(B3>B1.h>>1){B3-=(B1.h>>1);}}else{if(B3>1){B3--;}}}}AA.call(this,B0,CB,B3,Bt,CC);var CA=CB.x+B3,Bu=CB.w-B3;if(Bt<B0.t&&Bt>0){if(CB.x+B3<Bs.x+Bs.w){if(B1.h>1){if(Bu>B1.h){CA+=B1.h;Bu-=B1.h;}}else{if(Bu>1){CA++;Bu--;}}}}CB.x=CA;CB.w=Math.max(0,Bu);if(CC){AM(CB);}}function l(By,B0,B9){var B1,Br=By.r,B3=Br.length;if(B3>0&&B9>0){var B8=Br[0];var Bz=0,B4=this;if(By.t===undefined){Ag.forEach(B8.parentEntity.entityChildren,function(CB){if(!CB.deleted){Bz+=a(CB,B4);}});By.t=Bz;}else{Bz=By.t;}if(isNaN(Bz)||Bz<=0){return -1;}var B2,B5,Bs=0,CA,B7=false,B6;for(B6=0;B6<B3;B6++){B8=Br[B6];if(!B8.deleted){CA=a(B8,this);if(!isNaN(CA)){if(B7===false){B5=B2=CA;B7=true;}else{B5=Math.max(CA,B5);B2=Math.min(CA,B2);}Bs+=CA;}}}var Bt=B9*Bs/Bz,Bw=Bt/B0,Bx=(B0<Bw)?B0:Bw;B5=B9*B5/Bz;B2=B9*B2/Bz;var Bv=B5/(Bx*Bx);var Bu=B2/(Bx*Bx);Bv=(Bv>1)?Bv:(1/Bv);Bu=(Bu>1)?Bu:(1/Bu);B1=Math.max(Bv,Bu);}else{B1=-1;}return B1;}function Aj(B3,Br,Bu,B0,B1){var Bv=[[this,B3,Br,Bu,B0,B1]];while(Bv.length){var Bt=Bv.pop();var Bz=Bt.shift();B3=Bt.shift();Br=Bt.shift();Bu=Bt.shift();B0=Bt.shift();B1=Bt.shift();if(B3.length===0){BX.call(Bz,Br,B0);}else{var Bs=B0.w*B0.h;var B2;if(B1!==undefined){B2=B1;}else{B2=l.call(Bz,Br,Bu,Bs);}var Bw=B3[0],Bx=Br.r;Bx.push(Bw);var By=l.call(Bz,Br,Bu,Bs);if(B2>=By||B2===-1){B3.shift();Bv.push([Bz,B3,Br,Bu,B0,By]);}else{Br.r.pop();BX.call(Bz,Br,B0);Bu=Math.min(B0.w,B0.h);Bv.push([Bz,B3,{r:[],t:Br.t},Bu,B0]);}}}}function c(Bt){if(Bt===null){return[];}var Br=Bt.slice(0),Bv=0,Bs=Br.length,Bu;Br.t=[];for(Bu=0;Bu<Bs;Bu++){var Bw=Br[Bu],Bx=a(Bw,this);if(Bw.deleted||isNaN(Bx)||Bx<=0){Br.splice(Bu,1);Bu--;Bs--;continue;}Bv+=Bx;Br.t[Bu]=Bv;}return Br;}function BQ(Bv,By,Bx,Bw){var Bt=L(By);if(Bx===true){AM(Bt);}u.call(this,Bv,Bt);var Bu=Bv.entityChildren;if(Bu!==undefined){var Br=c.call(this,Bu),Bs=Br.length;if(Bs>0&&Bw){Bw.push([this,Br,0,Bs-1,Bt]);}}}function BI(B0,CC,B2,CI){var CJ=[[this,B0,CC,B2,CI]];while(CJ.length){var Bw=CJ.pop();var CE=Bw[0];B0=Bw[1];CC=Bw[2];B2=Bw[3];CI=Bw[4];var CG=B0[0],B8=A5.call(CE,CG),CA,CD,Bu,Bv,By,CM=false,B9=B2-CC+1,Bx=(B9>2?((B9-1)>>1):(B9>>1))+CC,B6;B6=L(CI);if(B6.w<=B6.h){AM(B6);B8={v:B8.h,h:B8.v};CM=true;}CA=L(B6);CD=L(B6);if(CC===B2){CG=B0[CC];BQ.call(CE,CG,B6,CM,CJ);continue;}if(CC+1===B2){CG=B0[CC];Bu=a(CG,CE);CG=B0[B2];Bv=a(CG,CE);}else{if(CC===0){Bu=B0.t[Bx-1];}else{Bu=B0.t[Bx-1]-B0.t[CC-1];}if(Bx===0){Bv=B0.t[B2];}else{Bv=B0.t[B2]-B0.t[Bx-1];}}By=Bu/(Bu+Bv);CA.w=Math.ceil(CA.w*By);if(CA.w<CI.w){if(B8.h>1){if(CA.w>(B8.h>>1)){CA.w-=(B8.h>>1);}}else{if(CA.w>1){CA.w--;}}}if(CC+1===B2){CD.w-=CA.w+B8.h;CD.x+=CA.w+B8.h;CG=B0[CC];BQ.call(CE,CG,CA,CM,CJ);CG=B0[B2];BQ.call(CE,CG,CD,CM,CJ);continue;}var CO=L(B6),B1,B5,Bt=0,CH=-1,CB=1,B7;if(Bx>CC){var Bz=L(CA);if(CM){AM(Bz);}CJ.push([CE,B0,CC,Bx-1,Bz]);}CO.w-=CA.w+B8.h;CO.x+=CA.w+B8.h;CD.w=CO.w;CD.x=CO.x;B1=CO.w/CO.h;CG=B0[Bx];B7=a(CG,CE);B5=B7/Bv;var CF;for(CF=Bx;CF<=B2;CF++){CG=B0[CF];Bt+=a(CG,CE);if(CF===B2-1){continue;}var Bs=Bt/Bv,CN=B7/Bt,CL=Bs/CN*B1;if(CL>=1){if(CB<1&&CB*CL>1){CH=(CF===B2)?CF-2:CF-1;}else{CH=CF;}break;}CB=CL;}CH=CH<0?B2:CH;var B4,B3,CK;if(Bx===0){B4=B0.t[CH];}else{B4=B0.t[CH]-B0.t[Bx-1];}B3=Math.min(Math.ceil(CO.w*(B4/Bv)),CO.w);CK=Math.min(Math.ceil(CO.h*(B7/B4)),CO.h);if(B3<CO.w){if(B8.h>1){if(B3>(B8.h>>1)){B3-=(B8.h>>1);}}else{if(B3>1){B3--;}}}if(CK<CO.h){if(B8.v>1){if(CK>(B8.v>>1)){CK-=(B8.v>>1);}}else{if(CK>1){CK--;}}}var Br={x:CO.x,y:CO.y,w:B3,h:CK};CG=B0[Bx];BQ.call(CE,CG,Br,CM,CJ);if(Bx<CH){CO.y+=CK+B8.v;CO.w=B3;CO.h-=CK+B8.v;if(CM){AM(CO);}CJ.push([CE,B0,Bx+1,CH,CO]);}if(CH<B2){CD.x+=B3+B8.h;CD.w-=B3+B8.h;if(CM){AM(CD);}CJ.push([CE,B0,CH+1,B2,CD]);}}}function BK(By,B8){var B9=[[this,By,B8]];while(B9.length){var Bs=B9.pop();var B4=Bs[0];By=Bs[1];B8=Bs[2];if(By===null||By.length===0){continue;}var Bx=0,B7=By[0],CB,B1=A5.call(B4,B7),CA=false,B3=By.length,Bv,Bu,Bw,B6;var B5;for(B5=0;B5<B3;B5++){B7=By[B5];CB=a(B7,B4);if(!B7.deleted&&CB>0){Bx+=CB;}}if(B8.w>=B8.h){CA=true;AM(B8);B1={h:B1.v,v:B1.h};}Bw=B8.w;B6=B8.h;Bv=B8.x;Bu=B8.y;for(B5=0;B5<B3;B5++){B7=By[B5];CB=a(B7,B4);if(!B7.deleted&&CB>0){var B2,B0;B0=Bx<=0?0:Math.ceil(CB/Bx*B6);B2=Bw;if(CB<Bx){if(B5===0||B5===B3-1){if(B1.v>1){if(B0>(B1.v>>1)){B0-=(B1.v>>1);}}else{if(B0>1){B0--;}}}else{if(B0>B1.v){B0-=B1.v;}}}B2=Math.max(0,B2);B0=Math.max(0,B0);var Bt={x:Bv,y:Bu,w:B2,h:B0},Br=BH(Bt,B8);Bu+=B0+B1.v;if(Bu>=B8.y+B6){Br.h=B8.y+B6-Br.y;}if(CA){AM(Br);}u.call(B4,B7,Br);if(B7.entityChildren!==undefined){B9.push([B4,B7.entityChildren,Br]);}}else{var Bz={x:Bv,y:Bu,w:0,h:0};if(CA){AM(Bz);}u.call(B4,B7,Bz);continue;}}if(CA){AM(B8);}}}function BB(){var Bt=0;if(this.props.showLegend){Bt=Math.min(Math.floor(0.2*(parseInt(this.height,10)-2*this.LayoutProperties.Padding)),this.LayoutProperties.MaxLegendHeight);}var By=this,Bx=L(this.heatMapSize);Bx.x=0;var Bu=Math.min(Bx.w,Bx.h);var Bv=this.root.entityChildren;var Br;switch(this.props.layout){case Ae.Squarified:Br=Bv.slice(0);Br.sort(function Bw(B0,Bz){var B2=a(B0,By);var B1=a(Bz,By);if(isNaN(B2)){if(isNaN(B1)){return 0;}return 1;}if(isNaN(B1)){return -1;}return B2<B1?1:-1;});Aj.call(this,Br,{r:[]},Bu,Bx);break;case Ae.SliceAndDice:BK.call(this,Bv,Bx);break;case Ae.PivotByMiddle:Br=c.call(this,Bv);var Bs=Br.length;if(Bs>0){BI.call(this,Br,0,Bs-1,Bx);}break;}}function Aq(Bt,Br){var Bs=mstrmojo.desc(14109,"Total of")+" {0}";return Bs.replace("{0}",Bt);}function A1(Bw,B0,Bs,Br){var Bv=(Bw.index===undefined)?Bw.indices[0]:Bw.index;var B2=AO.getPropertyByPath(B0,"modelData.gvs.items",[]);var By=B0.getMetricName(Bs);var Bz,B1,Bx,Bu;if(Bs===-1){Bz=BR;}else{if(Bw.entityChildren!==undefined||B0.aggregated){B1=B0.aggFunctions[Bs];By=Aq(By,B1);Bz=Ay(Bw,Bs,B0);Bx=AO.getPropertyByPath(Bw,"aggValues."+Bs);if(Bx.isAETotalFaked||isNaN(Bz)){Bz=BR;}else{var Bt=B0.getFormatString(Bs);Bz=B0.nf.formatByMask(Bt,Bz);}}else{Bz=AO.getPropertyByPath(B2,Bv+".items."+Bs+".v");if(Bz===""||Bz===undefined||Bz===null){Bz=BR;}}}Bu={n:By,v:Bz};if(Br){Br.push(Bu);}return Bu;}function BP(Bw,Br){var Bv=AO.getPropertyByPath(Bw,"modelData.gts.col.0.es.length",0);var Bu=[];var Bs=Bw.sizeMetricIndex,Bt=Bw.colorMetricIndex;if(Bs!==undefined&&Bs!==Bv){Bu.push(Bs);}if(!Bw.isAttributeColorByType()&&Br.entityChildren===undefined&&Bt!==undefined&&Bt!==Bv&&Bt!==Bs){Bu.push(Bt);}AO.range(0,Bv).forEach(function(Bx){if(Bu.indexOf(Bx)===-1){Bu.push(Bx);}});return Bu;}function AB(CA,Bw){var Bs=CA.level,Bv=(CA.index===undefined)?CA.indices[0]:CA.index,B1=Bw.attSpan,Br=Bw.modelData.ghs.rhs.items,CC=Br[Bv].items,B4=Bw.modelData.gts.row,B3;var CE="",B2="",CB=[],Bu=0,Bx,Bz,B7,B0,B6,By,B5,B9,Bt,B8;for(B7=0;B7<=Bs;B7++){if(B7>0&&B7===Bs){CB.push(null);}B3=B4[B7];B6=B3.cs?B3.cs:1;if(Bw.modelData.lnm===r.OFF){CE=B3.n;Bx=B3.id;B2="";B8=[];for(B5=0,B9=Math.max(B1[B7],B6);B5<B9;B5++){if(CC[Bu]&&CC[Bu].tui===B7){B0=CC[Bu].idx;Bu++;if(B0===-1){continue;}Bt=B3.es[B0];if(B8.indexOf(Bt)===-1){B2+=Bt.n+" ";if(B5===0){Bz=Bt.id;}B8.push(Bt);}}}B2=B2.substring(0,B2.length-1);CB.push({n:CE,v:B2,tid:Bx,eid:Bz});}else{for(B5=0,B9=Math.max(B1[B7],B6);B5<B9;B5++){if(CC[Bu]&&CC[Bu].tui===B7){B0=CC[Bu].idx;By=CC[Bu].fi?CC[Bu].fi:0;Bu++;if(B0===-1){continue;}CB.push({n:B3.fs[By].n,v:B3.es[B0].n});}}}}var CD=BP(Bw,CA);if(w){CD.push(-1);}CD.forEach(function(CF){A1(CA,Bw,CF,CB);});return CB;}function AL(Br){return{evt:Br,target:Br.getTarget(),pageX:Br.e.pageX,pageY:Br.e.pageY,clientX:Br.e.clientX,clientY:Br.e.clientY};}var o=function(Bw,Bv,Bu){if(AO.isOnExpressMode()){return ;}var Bs=Bw.e||Bw,Bx=Bs.ctrlKey||Bs.metaKey,Br=this.getSelectionMenuConfig(Bu);if(!mstrApp.isAppStatePresentation()&&mstrApp.allowWebDashboardDesign()&&Bv){var Bt=this;Br.addSeparator();Br.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",function(){mstrApp.rootCtrl.docCtrl.selectViPanel("propertiesPanel");Bt.parent.selectVIUnit();Bv(Bw);});}if(Br.hasMenuItems()&&Bx===false){this.showMenu(Br,Bs,true);}};function Bi(Br){if(AO.isOnExpressMode()||mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()||mstrApp.isInVFConfigMode){return ;}Br=Br.e||Br;this.showMenu(this.getBlankSpaceMenuConfig(Br),Br);}var e={BACKGROUND:"background",RECTANGLE:"rectangle",RECTANGLE_LABEL:"rectangleLabel",LEGEND_BACKGROUND:"legendBackground"};function AV(){function By(B3,B8,B2){var B1=this.props,B5=B2.updateModel,B7=B2.toModelValue,B6=B2.toModelPropName,B4;B1.unmarshal(B3,B8);B4=B1[B3];if(B5){if(B7 instanceof Function){B4=B7.call(this,B3,B4);}if(B6 instanceof Function){B3=B6.call(this,B3);}this.observableModel[B3].setValue(B4,true);}return B4;}function Bv(B2){var B1=this.attributeColorByLegend;if(B1){B1.updateStyle(this.HTML5PROPS.LEGEND);if(B2){B1.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();B1.updateSplitter();this.updateCanvasAfterAttributeLegendChanged(D[B1.currDockedPositionIdx].pos,this.legendW);}}}var Bz=function(){var B2=this.props,B1=B2.themeType==="light"?0:1,B3={value:this.bgColor,opacity:BY.lgdBgFillTrans[B1]/100};if(B2.lgdBgFillClr){B3.value=j.decodeColor(B2.lgdBgFillClr);}if(B2.lgdBgFillTrans){B3.opacity=B2.lgdBgFillTrans/100;}return B3;};var Bt=function(B1,B3,B2,B5){function B4(B9,B8){By.call(this,B1,B9,{updateModel:B8,toModelPropName:function(CA){if(CA===Ao.LEGEND_BG_COLOR||CA===Ao.LEGEND_BG_FILL_TRANSPARENCY){return"legendBackground";}return CA;},toModelValue:function(CB,CA){if(CB===Ao.LEGEND_BG_COLOR||CB===Ao.LEGEND_BG_FILL_TRANSPARENCY){return Bz.call(this);}return CA;}});var B7=this.attributeColorByLegend;if(!B7||!B7.hasRendered){return ;}this.initHTML5Props(this.HTML5PROPS);if(B1===Ao.LEGEND_FONT_FAMILY||B1===Ao.LEGEND_FONT_STYLE){var B6=[];An.call(this,B6);this.loadFonts(B6,{success:Bv.bind(this,true),failure:Bv.bind(this,true)});}else{Bv.call(this,B5);}}B4.call(this,B3);this.setProperty(B2,this.props.marshal(B1),{suppressData:true,clientUndoRedoCallback:B4});}.bind(this);function B0(B3,B2,B1){return function(){function B6(B8,B7){By.call(this,B2,B8,AY.copy(B4,{updateModel:B7}));if(!(this.excludeData||this.isEmpty())){this.refreshWidget();}if(B7&&B5){this.parent.selectVIUnit(true);}}B1=AY.copy(B1,{refreshPropertyPanel:true});var B5=B1.refreshPropertyPanel;var B4=B1.modelConfig;B6.call(this,Bw[B2].getValue(),false);this.setProperty(B3,this.props.marshal(B2),{suppressData:true,clientUndoRedoCallback:B6});};}var Bu=this.props.headerColors,Bx=this.getPropsInfo(),Br=this.isAttributeColorByType()?"attrColorByOpacity":"metricColorByOpacity",Bw=new mstrmojo.netviz.ObservableModel({isHeaderOnTop:Bx.isHeaderOnTop,labelSize:Bx.labelSize,showMetricValues:Bx.showMetricValues,layout:Bx.layout,background:this.background,headerColors:Bu[0],fonts:Bx.fonts,legendBackground:Bz.call(this),showLegend:Bx.showLegend,colorByOpacity:Bx[Br],lgdFntSz:Bx.lgdFntSz,lgdFntFml:Bx.lgdFntFml,lgdFntClr:Bx.lgdFntClr,lgdFntStyle:Bx.lgdFntStyle}),Bs=this.id;Bw.isHeaderOnTop.attachEventListener("valueChanged",Bs,B0(O.headerType,"isHeaderOnTop"));Bw.labelSize.attachEventListener("valueChanged",Bs,B0(O.labelSize,"labelSize"));Bw.showMetricValues.attachEventListener("valueChanged",Bs,B0(O.showMetricValues,"showMetricValues"));Bw.layout.attachEventListener("valueChanged",Bs,B0(O.layout,"layout"));Bw.headerColors.attachEventListener("valueChanged",Bs,B0(O.headerColors,"headerColors",{refreshPropertyPanel:false,modelConfig:{toModelValue:function(B2,B1){return B1&&B1[0];}}}));Bw.background.attachEventListener("valueChanged",Bs,function(B2){this.background=Bw.background.getValue();var B1=this.getSingleBackgroundColor();if(!this.canvasObject){return ;}this.canvasObject.bgColor=B1;this.highlightCanvas.backgroundColor=B1;var B3=y.encodeColor(this.getFormats()["background-color"],10),B4=y.encodeColor(B2.newValue,10);if(B3!==B4){AO.changeWidgetBackground(this,B2.newValue,B2.oldValue);}this.canvasObject.removeLabels();this.canvasObject.drawLabels();});Bw.fonts.attachEventListener("valueChanged",Bs,function(){var B1="fonts";function B2(B6,B5){function B8(B9){return function(CD,CB){if(CD.valid){return ;}var CC=AO.getPropertyByPath(B7,B9),CA=AO.getPropertyByPath(Bw.fonts,B9);if(CC&&CA){CC.scale=CB;CA.scale.setValue(CB,true);}};}var B7=By.call(this,B1,B6,{updateModel:B5});Ap(B7,AP(E,B8));A6.call(this,B7);if(!this.isEmpty()){var B3=[];this.canvasObject.fonts=this.props.fonts;function B4(){this.refreshWidget();}X.call(this,B3);this.loadFonts(B3,{success:B4.bind(this),failure:B4.bind(this)});}}B2.call(this,Bw.fonts.getValue(),false);this.setProperty(O.fonts,this.props.marshal(B1),{suppressData:true,clientUndoRedoCallback:B2});});Bw.legendBackground.attachEventListener("valueChanged",Bs,function(B3){var B1,B2=B3.newValue;if(isNaN(B2)){B2=j.encodeColor(B2);B1=Ao.LEGEND_BG_COLOR;}else{B2*=100;B1=Ao.LEGEND_BG_FILL_TRANSPARENCY;}Bt(B1,B2,B1,false);});Bw.lgdFntSz.attachEventListener("valueChanged",Bs,function(B1){Bt("lgdFntSz",B1.newValue,Ao.LEGEND_FONT_SIZE,true);});Bw.lgdFntFml.attachEventListener("valueChanged",Bs,function(B1){Bt("lgdFntFml",B1.newValue,Ao.LEGEND_FONT_FAMILY,true);});Bw.lgdFntClr.attachEventListener("valueChanged",Bs,function(B1){Bt("lgdFntClr",B1.newValue,Ao.LEGEND_FONT_COLOR,false);});Bw.lgdFntStyle.attachEventListener("valueChanged",Bs,function(B1){Bt("lgdFntStyle",B1.newValue,Ao.LEGEND_FONT_STYLE,true);});Bw.showLegend.attachEventListener("valueChanged",Bs,function(B1){var B2="showLegend";function B3(B7,B6){var B4=By.call(this,B2,B7,{updateModel:B6});var B5=this.attributeColorByLegend;if(!B5){this.reRender();return ;}this.toggleLegend(B4);this.updateCanvasAfterAttributeLegendChanged(D[B5.currDockedPositionIdx].pos,(B4?this.legendW:0));}B3.call(this,B1.newValue,false);this.setProperty(O.showLegend,this.props.marshal(B2),{suppressData:true,clientUndoRedoCallback:B3});});Bw.colorByOpacity.attachEventListener("valueChanged",Bs,function(B1){function B2(B4,B3){By.call(this,Br,B4,{updateModel:B3,toModelPropName:function(B5){return"colorByOpacity";}});this.refreshWidget();}B2.call(this,B1.newValue,false);this.setProperty(O[Br],this.props.marshal(Br),{suppressData:true,clientUndoRedoCallback:B2});});return Bw;}function Af(Bw,Bs){if(!Bw.family){return ;}var Br=Bw.family,Bv=Bw.style?parseInt(Bw.style):0,Bu=Bv&AK.FS_BOLD?true:false,Bx=Bv&AK.FS_ITALIC?true:false,Bt=Ag.some(Bs,function(By){return By.name===Br&&By.isBold===Bu&&By.isItalic===Bx;});if(!Bt){Bs.push({name:Br,isItalic:Bx,isBold:Bu});}}function X(Br){var Bs=AY.clone(this.props.fonts);Af(Bs.headerOnMiddle,Br);Af(Bs.headerOnTop.header,Br);Af(Bs.headerOnTop.cell,Br);}function An(Br){var Bu=this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_FAMILY),Bt=this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_STYLE),Bs={family:Bu,style:Bt};Af(Bs,Br);}function Ax(Br,Bs){if(Br===undefined||Br===null||Br.length===0){return false;}return Br.every(function(Bt){return Bs(Bt.level);});}function Am(){var Br=this.levelAttributes.length-1,Bt,Bs;Bt=this.contextMenuSelection.length>0?this.contextMenuSelection:this.previousSelected;return Ax(Bt,function(Bu){if(Bu===Br){return false;}if(Bs===undefined){Bs=Bu;}return Bs===Bu;});}function AE(){var Br=this.levelAttributes.length-1,Bs;Bs=this.contextMenuSelection.length>0?this.contextMenuSelection:this.previousSelected;return Ax(Bs,function(Bt){return Bt!==Br;});}function A7(){var Br=this.levelAttributes.length-1,Bs;Bs=this.contextMenuSelection.length>0?this.contextMenuSelection:this.previousSelected;return Ax(Bs,function(Bt){return Bt===Br;});}function BZ(Bw){var Bs={},Bv=[],Bu,Bx,Bt,Br;for(Bt=0,Br=Bw.length;Bt!==Br;Bt+=1){Bu=Bw[Bt];Bx=Bu&&Bu.id;if(Bx!==undefined&&!Bs.hasOwnProperty(Bx)){Bs[Bx]=true;Bv.push(Bu);}}return Bv;}function AQ(Bt,Bu){var Bs=(Bt.level===Bu.length-1),Bv=Bt,Br=Bu[Bt.level].supportsViewFilter;if(Bs){while(Br&&Bv.parentEntity){Bv=Bv.parentEntity;Br=Bu[Bv.level].supportsViewFilter;}}return Br;}function B(Bu,Bs){var Bt,Br;for(Bt=0,Br=Bu.length;Bt!==Br;Bt++){if(!AQ(Bu[Bt],Bs)){return false;}}return true;}function Au(Bs,Bt,Br){return Bt.map(function(Bv,Bu){return{eid:Bv,tid:Bs[Bu],tp:Br[Bu]};});}function BC(Br){Br=AY.clone(Br);this.dfs(this.root,function(Bs){var Bv=Bs.colorByAttributeIds||[],Bw=Bs.colorByElementIds||[],Bu=Bs.colorByTypes||[],Bt=Au(Bv,Bw,Bu);if(j.isEqualComb(Bt,Br)){this.addToSelection(Bs);}}.bind(this));}function Bb(){return{type:"metricColorByOpacity",model:this.observableModel.colorByOpacity};}function AC(){var Br=this.cmColorByElements,Bz=this.getColorByElements(),Bw=this,Bx,Bv,Bt,Bs,Bu,By;if(Br===undefined||Br.length===0){return ;}Bx=Br.length;if(Bx>1){Bv=Bz[0];}else{Bt=AY.clone(Br[0]);Bs=AO.findInArray(Bz,function(B0){return j.isEqualComb(Bt,AY.clone(B0.comb));});if(Bs===-1){return ;}Bv=Bz[Bs];}Bu={color:Bv.color,opacity:Bv.opacity,showAutomatic:Br.some(function(B0){return AO.isColorManuallySet(Bw,B0);})};By={onFillChanged:function(B4,B2){var B3=B4,B0=B3==="automatic",B1;if(B0){B4="default";}else{B4=j.encodeColor(B4);}B1=Bw.listenToUpdateColorMap(function(){var B5="#ffffff",B6=Br.length;if(B0){if(B6===1){B5=j.decodeColor(AO.getCombColor(Bw,Bv.comb));}if(B2 instanceof Function){B2(B5);}B3=B5;}Bw.raiseEvent({name:"colorByColorChange",type:"invalidateCache"});Bw.raiseEvent({name:"colorByColorChange",type:"fill",fill:B3,showAutomatic:!B0});Bw.detachUpdateColorMapListener(B1);});Bw.updateColorMap(Br,AO.repeat(B4,Br.length));},onOpacityChanged:function(B0){Bw.updateColorByOpacity(Br,AO.repeat(B0,Br.length));Bw.raiseEvent({name:"colorByColorChange",type:"opacity",opacity:B0});}};this.refreshHighlights();return{type:"attributeColorBy",model:Bu,callback:By};}function AD(){return{type:"headerFill",model:this.observableModel.headerColors,label:mstrmojo.desc(12105,"Header Fill")};}function BN(B2,CB){var B1=this.levelAttributes,B8=this,By=function(CD){return B8.props.isHeaderOnTop&&CD.level!==B1.length-1;},Br=By(B2),B6,Bw;if(this.props.isHeaderOnTop){var B9=this.observableModel.fonts.headerOnTop;if(Br){B6=B9.header;Bw="headerOnTop.header";}else{B6=B9.cell;Bw="headerOnTop.cell";}}else{B6=this.observableModel.fonts.headerOnMiddle;Bw="headerOnMiddle";}var B7=this.root;this.preorderTraverse(B7,function(CE){var CF=CE.labelDomNode;if(CF&&By(CE)===Br){CF._oldTextDecoration=CF.style.textDecoration;CF.style.textDecoration="underline";var CG=CF.parentNode.querySelector(".heatmap-label-square"),CD=getComputedStyle(CF).color;if(CG){CG.style.background=CD;CG.style.display="block";}}});var CC=[];if(this.props.isHeaderOnTop&&B2.entityChildren&&B2.headerColor){CC.push(AD.call(this));}if(!B2.entityChildren&&this.isAttributeColorByType()){CC.push(AC.call(this));}var Bt=this.props.labelSize===A8.Proportional;if(this.props.isHeaderOnTop&&Br){Bt=false;}CC.push({type:"font",model:B6,disableFontSize:Bt,modelPath:Bw});var B0,B5=CB.e||CB,CA=AO.getMetricsInDropZone(this.zonesModel,Ba.ColorBy)[0]||null,Bv=this.isMetricColorByType()&&CA;if(Bv&&!By(B2)){var B4=mstrmojo.ui.PopupConfig.ENUM_CORNERS;B5={pageX:B5.pageX,pageY:B5.pageY-6};B0={host:B4.TOP_LEFT,popup:B4.BOTTOM_LEFT};CC.unshift(Bb.call(this));}this.closePopup();this.showContextMenu(CC,B5,B0);this._lastOpened.onClose=function(){B8.preorderTraverse(B7,function(CD){var CE=CD.labelDomNode;if(CE&&By(CD)===Br){CE.style.textDecoration=CE._oldTextDecoration;CE._oldTextDecoration=undefined;var CF=CE.parentNode.querySelector(".heatmap-label-square");if(CF){CF.style.display="none";}}});};if(Bv&&!By(B2)&&!mstrApp.isDossier){var B3=this._lastOpened;this._lastOpened=null;var Bz=new mstrmojo.ui.menus.MenuConfig();Bz.addMenuItem(mstrmojo.desc(13174,"Select color ranges..."),"",function(){B8.model.openThresholdEditor(CA,true,false);});this.showMenu(Bz,CB,true);var Bs=this._lastOpened,Bu=Bs._unlockHoverCheck;Bs._unlockHoverCheck=function(CE,CD){if(!Av.contains(B3.domNode,Av.eventTarget(CD,CE),true)){Bs._unlockHoverCheck=Bu;Bs._unlockHoverCheck(CE,CD);}};}this.raiseEvent({name:"formatclick",type:"format",formatValue:Bw});var Bx=AG([B2]);if(Bx&&Bx.length>0){this.contextMenuCbSelection=Bx;}AO.selectPropertyPanel(this,"de");this.contextMenuCbSelection=null;}function A0(Br){return function(Bu){var Bv=AL(Bu),Bs=this.getEntityByTouch(Bv);var Bt=Bs.id.split(";")[1];if(Bt===undefined){console.log("Unable to get attribute id from entity");}if(this.isOnFormattingMode){Br.call(this,Bs,Bu);}else{o.call(this,Bu,Br.bind(this,Bs),Bt);}};}function N(Bs){var Br=this;Br.showContextMenu({type:"background",model:Br.observableModel.background,noOpacity:true,showNoFill:false},Bs);AO.selectPropertyPanel(Br,0);}var f={};f[e.BACKGROUND]=function(Br){if(this.isOnFormattingMode){N.call(this,Br);}else{Bi.call(this,Br);}};var Bn=A0(BN);f[e.RECTANGLE_LABEL]=Bn;f[e.RECTANGLE]=Bn;function I(Bs){var By=this.allSupportsViewFilter||B(this.contextMenuSelection,this.levelAttributes),Bu=new mstrmojo.ui.menus.MenuConfig(),Br=new mstrmojo.ui.menus.MenuConfig(),Bv={filter:Bu,showData:Br};if(!By){return Bv;}var Bz=AE.call(this),B0=A7.call(this),Bx,Bw=this;if(Bz){Bx=this.getMenuHandler("headerDrill");}if(B0){Bx=this.getMenuHandler("rectangleDrill");}var B1=AO.getDrillMenu.bind(AO,this,Bs,Bx);if(this.isLinkedFilterEnabled()){var Bt=function(){Bw.handleContextMenuSelectionData(true);};Bu.addMenuItem(mstrmojo.desc(15070,"Go to Targets"),"",Bt);Bu.addSeparator();}Bu.addMenuItem(mstrmojo.desc(11701,"Keep only"),"xt",this.getMenuHandler("keepOnly"));Bu.addMenuItem(mstrmojo.desc(3946,"Exclude"),"xt",this.getMenuHandler("exclude"));if(!mstrApp.isDossier&&!this.excludeData){Br.addMenuItem(mstrmojo.desc(13537,"Show Data..."),"xt",this.getMenuHandler("showData"));}if(!mstrApp.isInVFConfigMode&&mstrmojo.resolveFeature(m.WEB_DRILL_AND_LINK)){if(B1&&B1().hasMenuItems()){Bu.addPopupMenuItem(mstrmojo.desc(145,"Drill"),this.id,B1,"xt");}else{Bu.addNonInteractiveMenuItem(mstrmojo.desc(145,"Drill"),"",true);}}return Bv;}function Bm(){var Br={};if(mstrApp.isAppStatePresentation()||mstrApp.isInVFConfigMode){return Br;}var Bs=Am.call(this),Bx=A7.call(this),Bt=this.contextMenuSelection.length!==0?this.contextMenuSelection:this.previousSelected,Bw=function(By){return By.label;},Bu=this,Bv;if(Bs){Bv=this.getCellForNode(Bt[0]);Br=AO.getGroupAndCalculationContextMenu(this,Bv,{skipSingleAttrCheck:true,selection:BZ(Bt),fnCellName:Bw});}if(Bx){Br=AO.getGroupAndCalculationContextMenuForDataPoints(this,{selection:Bt,fnCellName:Bw,fnUnique:function(B7){var B1=[],B6=Bu.root,B4=B7,B5=B4.length,B3,B2,Bz,B8,By,B0;while(B5>0){if(B5===1){B2=B4[0];while(B2!==B6){B1.push(B2);B2=B2.parentEntity;}B5=0;}else{B8=[];By={};for(B3=0;B3!==B5;B3+=1){B2=B4[B3];Bz=B2.parentEntity;B0=B2.id;if(!By.hasOwnProperty(B0)){By[B0]=true;B1.push(B2);}if(B8.indexOf(Bz)===-1){B8.push(Bz);}}B4=B8;B5=B4.length;}}return B1;},fnMakeNode:function(By){return By;}});}return Br;}function AW(Bs,Br){var Bt=Bs;if(!this.nf.validateFormat(Bt)){Bt="#,##0.00;(#,##0.00)";}return this.nf.formatByMask(Bt,Br);}function A3(Bs,Br){if(Bs.idx&&Br.idx){var Bt=Bs.idx.split(":"),Bu=Br.idx.split(":");if(Bt.length>Bu.length){return false;}return Bt[Bt.length-1]===Bu[Bt.length-1];}return false;}function H(Br){this.updateEntityHighlight(Br);}mstrmojo.heatmap.vi.VisHeatMap=mstrmojo.declare(mstrmojo.VisBase,[mstrmojo.util.ui._LassoSelector,mstrmojo.ui.menus._HasMenuPopup,mstrmojo._colorPalette,mstrmojo._VizSelectionHelper,mstrmojo.vi.ui.rw._HasVisSelections,mstrmojo.vi.ui.rw.selectors._IsMultiUnitControl,mstrmojo.vi.ui.rw.selectors._BrushesAndHighlights,mstrmojo.heatmap.vi._SupportHeatmapBrushesAndHighlights,mstrmojo.heatmap.vi._HasHeatmapContextMenu,mstrmojo.vi._MonitorsAppState,mstrmojo.vi.ui.rw._XtabDE,mstrmojo.vi.ui._IsDropTarget,mstrmojo.gm._SupportDndAsBlackBox],{scriptClass:"mstrmojo.heatmap.vi.VisHeatMap",selectedStyle:"background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #058CF5), color-stop(1, #015DE6));color:#FFFFFF;",selectedClass:"",insertedStyles:[],LayoutProperties:{},normalizedIdCache:{},highlightBoxWidth:3,waitIconString:mstrmojo.desc("8445","Loading"),markupString:'<div id="{@id}" class="heatmap-{@themeType}-theme mil-{@themeType} gm-{@themeType}-theme" style="width:{@width}px;height:{@height}px; left:{@left}px; top:{@top}px; z-index: {@zIndex}; position:absolute;" mstrAttach:'+Bp.join(",")+'><div class="heatmap-canvas-outer-container" style="padding: {@LayoutProperties.Padding}px; height:{@heatMapSize.h}px; width:{@heatMapSize.w}px; left: {@heatMapSize.x}px;"><div id ="{@id}-heatmap-canvas-container" class="heatmap-canvas-container" style="left: {@LayoutProperties.Padding}px; top: {@LayoutProperties.Padding}px; height:{@heatMapSize.h}px; width:{@heatMapSize.w}px"><div style="z-index: 1;"><div></div><div style="width: {@heatMapSize.w}px; height: {@heatMapSize.h}px;"></div></div></div></div><div></div><div style="width: {@legendSize.w}px; height: {@legendSize.h}px"></div></div>',markupSlots:{canvasSlot:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0].childNodes[0];},highlightCanvasPlaceholder:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0].childNodes[1];},canvasContainer:function(){return this.domNode.childNodes[0].childNodes[0];},canvasOuterContainer:function(){return this.domNode.childNodes[0];},containerNode:function(){return this.domNode;},scrollNode:function(){return this.domNode.childNodes[0].childNodes[0].childNodes[0];},textSpan:function(){return this.domNode.childNodes[1];},infoBoxPuppet:function(){return this.domNode.childNodes[1];},attributeColorByLegendPlaceHolder:function(){return this.domNode.childNodes[2];}},requirePreload:true,getFonts:function q(){var Br=[];X.call(this,Br);An.call(this,Br);return Br;},onAppStateChange:function Ab(Br){this._super(Br);if(!this.selectorControl){this.removeAllSelections();this.clearSelections();}this.isOnFormattingMode=(Br.value&mstrmojo.vi.VisualInsightApp.APP_STATES.FORMATTING);},getProperties:function(){var Br=this.modelData;return(Br&&Br.vp)||{};},getPropsInfo:function(){return this.props||{};},init:function(Bt){this.props={};this.previousSelected=[];this.contextMenuSelection=[];this.isRectangleMenuOnClose=false;this._super(Bt);var Bs=document.createElement("canvas");var Br=Bs.getContext;this.nf=mstrmojo.num;if(!Br){this.browserSupportsHtml5=false;}else{this.browserSupportsHtml5=true;}this.HTML5PROPS={};if(!Ac){Ac=new mstrmojo.VisTooltip();Ac.render();}this.legendType=BS.VERTICAL;this.isOnFormattingMode=false;},update:function(Bu){var Bt=this._super(Bu),Br,Bw,Bs,Bv="timerid_update";M.startTimer({functionName:"VisHeatMap.update",purpose:"JSON loading and consuming, generate the labels and colors"},Bv);if(Bt!==false){this.clearError();Br=AO.getPropertyByPath(this,"model.data.egt");Bw=AO.getPropertyByPath(this,"model.data.eg");Bs=AO.getPropertyByPath(this,"model.data.err");if(!this.excludeData){if(Br!==undefined||Bw!==undefined){this.setError(Bw,Br);}if(Bs!==undefined){this.setError(Bs);}}if(!this.browserSupportsHtml5){this.setError(mstrmojo.desc(8126,"Your browser does not support HTML5"));}this.modelData=this.model.data;if(!this.modelData){this.setError(mstrmojo.desc(8426,"No model provided"));}if(this.hasError()&&this.errorType!==Bq.EMPTY_DATA){M.endTimer(Bv);return Bt;}delete this.verticalLegendColorByElements;delete this.verticalLegendSizeByElements;delete this.colorByMetricThreshold;AX.call(this);T.call(this);if(this.hasError()&&this.errorType!==Bq.EMPTY_DATA){M.endTimer(Bv);return Bt;}this.observableModel=this.addDisposable(AV.call(this));if(this.hasError()){M.endTimer(Bv);return Bt;}this.refreshLabelInTree();this.refreshColorInTree();}M.endTimer(Bv);return Bt;},preBuildRendering:function(){if(this.hasError()||this.waitingForData){return ;}if(!this._super()){return false;}var Bt=this.getPropsInfo(),Br=Bt.showLegend,Bs="timerid_preBuildRendering";if(Br&&this.legendType===BS.VERTICAL){this.defaultsLegendPop=K.call(this,(this.props.themeType==="light"?0:1));this.initHTML5Props(this.HTML5PROPS);}this.LayoutProperties=AT;M.startTimer({functionName:"VisHeatMap.preBuildRendering",purpose:"layout of the rectangles"},Bs);if(Br){if(this.isAttributeColorByType()||Bt.hasColorInThresholds){this.getVerticalLegendColorByInfo();}if(Bt.sizeMetricEnabled){this.getVerticalLegendSizeByInfo();}}this.setLayout();BB.call(this);M.endTimer(Bs);},setModel:function h(Br){this._super(Br);this.listenToUpdateColorMap(this.refreshWidget);},setError:function(Bt,Bs){var Br=AO.translateGridError(Bt,Bs);this.error=Br.msg;this.errorType=Br.type;},clearError:function(){this.error=undefined;this.errorType=undefined;},hasError:function(){return this.error!==undefined||this.errorType!==undefined;},isEmpty:function(){return this.hasError();},getVisEmptyMsgControls:function(){return AO.getVisEmptyMsgControls.call(this);},postBuildRendering:function Ai(){if(this.waitingForData){return ;}if(this.isEmpty()){if(AO.isOnExpressMode()){AO.renderWidgetErrorRSD(this,this.error,Bp);}else{this._super();}return ;}var Bu="timerid_fromBuildtoEnd";M.startTimer({functionName:"VisHeatMap.postBuildRendering",purpose:"from Build to End"},Bu);this.initCanvas();this.renderLegend();this.hInitListeners();this.registerLassoSelector(this.canvasOuterContainer,[],false);this.lassoSelectorEnabled=false;this.preorderTraverse(this.root,function(Bw){var Bx=Bw.entityChildren;if(Bx&&Bx.length>1){this.lassoSelectorEnabled=true;return false;}});var Bt=this.getExp(),Bv=this.getRowsAndCols();AO.modifyScExp(Bt,Bv,this.model,this.normalizedIdCache);var Br=this._super();var Bs=this.previousSelected;if(Bs&&Bs.length>0){this.edtModelCbInitSelection=AG(Bs);}M.endTimer(Bu);return Br;},hasSizebyOrColorby:function(){var Br=this.getPropsInfo();return Br.colorByType||Br.sizeMetricID!==Bf;},hInitListeners:function(){var Br=this.id;if(this.attributeColorByLegend){this.legendResizeListener=this.attributeColorByLegend.attachEventListener("gm-legend-resized",Br,function(Bs){this.onLegendResized(Bs.position);});this.legendClickListener=this.attributeColorByLegend.attachEventListener("gm-legend-clicked",Br,function(Bs){this.onLegendClicked(Bs);});}},onLegendResized:function(Bt){function Br(){var Bu=this.attributeColorByLegend;if(Bu){this.hEvalSize4Legend();this.updateLegend();Bu.updateAfterResize();this.updateCanvasAfterAttributeLegendChanged(D[Bu.currDockedPositionIdx].pos,this.legendW);}}function Bs(Bv,Bu){if(Bu){this.legendScale=Bv;this.legendResized=true;this.legendFixedW=undefined;Br.call(this);}}if(this.attributeColorByLegend){this.legendFixedW=this.legendW+Bt;this.legendScale=(this.legendFixedW)/(this.legendW/this.legendScale);this.legendResized=true;this.writeGlobalAttriLegndProperty(W.SCALE_LEGEND_WIDTH,this.legendScale,{success:Bs});Br.call(this);}},onLegendClicked:function(Br){var Bt=Br.action,Bs=this.attributeColorByLegend,Bu={success:function(){this.hEvalSize4Legend();this.updateLegend();this.updateCanvasAfterAttributeLegendChanged(D[Bs.currDockedPositionIdx].pos,this.legendW);}};if(Bt==="close"){this.observableModel.showLegend.setValue(false);return ;}if(Bt==="minimize"){this.writeGlobalAttriLegndProperty(W.LEGEND_MODE,BO.MINIMIZED,Bu);}else{if(Bt==="restore"){this.writeGlobalAttriLegndProperty(W.LEGEND_MODE,BO.RESTORED,Bu);}}},unrender:function(){this.previousSelected=[];var Bt=Av.detachEvent,Br=Av.TOUCHSTART,Bu=Ac&&Ac.domNode;Bt(this._tn,Br,this._tsCallback);if(Bu&&Bu.parentNode){this.previousTooltip=undefined;Bu.parentNode.removeChild(Bu);}if(this.attributeColorByLegend){this.attributeColorByLegend.unrender();delete this.attributeColorByLegend;}if(this.legendResizeListener){this.legendResizeListener.clear();}if(this.legendClickListener){this.legendClickListener.clear();}var Bs=this._lastOpened;if(Bs){this.closePopup();}this.destroyCanvas();this._super();},refreshLabelInTree:function(){var Br=function(Bt,Bs){if(Bt===this.root){return ;}Bt.text=this.getLabelForEntity(Bt);Bt.idx=Bs;};this.dfs(this.root,Br,"");},getColorByAttrsByID:function(Bs,Bv,Bu){var Br=AO.isHierarchyObject(Bv)?"hid":"id",Bw=Bv.id,Bt="";Ag.forEach(Bs,function(Bx){if(Bx[Br]===Bw){Bu.push(Bx.id);Bt+=(Bx.dn||Bx.n)+" ";}});return Bt;},getVerticalLegendColorByInfo:function(){if(this.isAttributeColorByType()){var CG=this.attributeColorByElementsTemp;if(CG===undefined){return ;}var CB,CA,B2,B6,Bv,B4,B5,Bx,B3,CE,CF,CC="",CH=[],B9=this.props.colorAttributes,Bu=B9.length,By=CG.length,CD=this.modelData.dz.ColorBy.TemplateUnit,B1,B7=(CD&&CD.length)||0,Bt=[],Br=function(CJ){var CI=CJ.lastIndexOf(";");if(CI>-1){return CJ.slice(CI+1);}return"";};for(CB=0;CB<B7;CB++){B1=CD[CB];CC+=this.getColorByAttrsByID(B9,B1,Bt);}CC=CC.substring(0,CC.length-1);for(CB=0;CB<By;CB++){Bv={};B4="";B5=[];Bx=[];B3=[];CE=CG[CB];CF=[];Bv.color=CE.color.value;Bv.decodedColor=Bv.color;Bv.encodedColor=j.encodeColor(Bv.color);Bv.isDefaultColor=CE.isDefaultColor;Bv.opacity=CE.color.opacity;while(CE&&CE.parentEntity){if(this.props.colorAttributeIndexes.indexOf(CE.level)!==-1){B2=Br(CE.id);CF.push({id:B2,text:CE.label});B5.splice(0,0,CE.id);}CE=CE.parentEntity;}for(CA=0;CA<CF.length;CA++){B6=Ag.find(CF,"id",Bt[CA]);B4=B4+CF[B6].text+" ";}CF=[];B4=B4.substring(0,B4.length-1);Bv.label=B4;for(CA=0;CA<Bu;CA++){Bx.push(B9[CA].id);B3.push(B9[CA].otp);}Bv.token={elements:B5,levels:Bx,types:B3};CH.push(Bv);}delete this.attributeColorByElementsTemp;this.verticalLegendColorByElements={item:CC,elements:CH};}else{if(this.props.hasColorInThresholds){var B0=this.getColorByMetricThreshold(),Bz,Bw,B8,Bs=this.getPropsInfo().metricColorByOpacity;if(B0){B8=[];Bz=AO.getColorByTitle(this.getMetricName(this.colorMetricIndex),B0.rankMode);Ag.forEach(B0.items,function(CI){Bw=AY.clone(CI);Bw.opacity=Bs;B8.push(Bw);});this.verticalLegendColorByElements={item:Bz,elements:B8};}else{this.verticalLegendColorByElements=undefined;}}}},getVerticalLegendSizeByInfo:function(){var Bx=Bl.call(this);if(Bx.max===Infinity&&Bx.min===-Infinity){this.verticalLegendSizeByElements=undefined;return ;}var By=this.getFormatString(this.sizeMetricIndex);var Bw=[],Bv,Bs=Bx.min,Bt=Bx.max,B0=(Bt-Bs)/4;for(Bv=0;Bv<5;Bv++){Bw.push(AW.call(this,By,Bt-Bv*B0));}var Bz={},Br;var Bu=this.getMetricName(this.sizeMetricIndex);if(Bx.hasNegativeValue){Bu=Q+" "+Bu;}Bz.item=Bu;if(Bw.length>1){Br=Bz.elements=[];Ag.forEach(Bw,function(B1){Br.push({sign:"<",v:B1});});if(Br.length===5){Br[0].sign="=";Br[4].sign="=";}Bz.caseFlag=0;}if(Bw.length===1){Bz.elements=[{diameter:12,shape:"rect",sign:"=",v:Bw[0]}];Bz.caseFlag=2;}this.verticalLegendSizeByElements=Bz;},getHeaderColor:function(Bs){var Br=AY.clone(this.props.headerColors[Math.min(Bs.level,2)]);if(Bs.level!==0&&!this.props.isDefaultHeaderColor){Br.opacity*=0.7;}return Br;},refreshColorInTree:function(){var Bu=[],Bt=[];var Bw=function(B7){if(B7===this.root){return ;}var B4=this.props.colorAttributeIndexes,By=B4[B4.length-1];if(B7.level===By){var B0,Bz,B5,B6=B4.length,B1=this.modelData.gts.row,B8=[],B3=[],B9=[],CA=[],B2="";Bz=B7;for(B0=0;B0<=By;B0++){B8.splice(0,0,Bz);Bz=Bz.parentEntity;}for(B0=0;B0<B6;B0++){B5=B4[B0];B3.push(B1[B5].id);CA.push(B1[B5].otp);B2+=B8[B5].id+":";B9.push(B8[B5].id);}if(Bu.indexOf(B2)===-1){this.attributeColorByElementsTemp.push(B7);Bu.push(B2);}this.preorderTraverse(B7,function(CB){CB.colorByAttributeIds=B3;CB.colorByElementIds=B9;CB.colorByTypes=CA;});}};if(this.isAttributeColorByType()){this.attributeColorByElementsTemp=[];this.preorderTraverse(this.root,Bw);}else{var Br=this.modelData;if(this.props.colorMetricID!==Bf&&Br.gsi.thresholds[this.props.colorMetricID]!==undefined){var Bx=Br.gsi.thresholds[this.props.colorMetricID],Bv;for(Bv=0;Bv<Bx.length;Bv++){if(Bx[Bv].fmt&&Bx[Bv].fmt.bc){Bt[Bv]=Bx[Bv].fmt.bc;}else{Bt[Bv]=AI.getCSSColorString(F);}}}}var Bs=function(B2){if(B2===this.root){return ;}var By,B0=this.colorTheme,Bz=1,B1,B3,B4;if(this.isAttributeColorByType()&&B2.colorByAttributeIds&&B2.colorByElementIds){B3=B2.colorByAttributeIds;B4=B2.colorByElementIds;B1=this.model.docModel.getColorBy(B3,B4);By=j.decodeColor(B1.color);Bz=AS.call(this,B3,B4)/100;B2.isDefaultColor=!B1.isManual;}else{if(this.props.colorMetricID!==Bf&&Bt.length>0&&B2.thrColorIndex>=0){By=AI.getCSSColorString(Bt[B2.thrColorIndex]);Bz=this.getPropsInfo().metricColorByOpacity;}else{By=AI.getCSSColorString(F);}}B2.color={value:By,opacity:Bz};if(this.props.isHeaderOnTop){B2.headerColor=this.getHeaderColor(B2,B0.style==="light");}};this.dfs(this.root,Bs,"");},dfs:function(Bt,Bw,Bu){if(!Bt||Bt.deleted){return ;}if(Bu===undefined){Bw.call(this,Bt);}else{Bw.call(this,Bt,Bu);}if(Bt.entityChildren===undefined){return ;}var Br=Bt.entityChildren,Bs=Br.length,Bv;for(Bv=0;Bv<Bs;Bv++){var Bx=Br[Bv];if(Bu===undefined){this.dfs(Bx,Bw);}else{var By=Bu;if(!By){By=Bv.toString();}else{By=By+":"+Bv;}this.dfs(Bx,Bw,By);}}},preorderTraverse:function(Bs,Bw){if(Bs){var Bt=Bw.call(this,Bs);if(Bt===false){return ;}var Bv=Bs.entityChildren||[],Br=Bv.length,Bu;for(Bu=0;Bu<Br;Bu++){this.preorderTraverse(Bv[Bu],Bw);}}},getSingleBackgroundColor:function(){return this.background&&this.background.value&&(this.background.value.c1||this.background.value);},initCanvas:function(){var Bs=this,Br=Al.call(this);this.destroyCanvas();this.addChildren(new mstrmojo.heatmap.vi.VisHeatMapCanvas(Br));this.highlightCanvas=this.canvasObject.addDisposable(new mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas({placeholder:this.highlightCanvasPlaceholder,isOnSelectionMode:function(){return Bs.previousSelected.length>0||Bs.contextMenuSelection.length>0;},themeType:this.props.themeType,backgroundColor:this.getSingleBackgroundColor()}));this.highlightCanvas.render();this.highlightCanvas.parent=this;},destroyCanvas:function s(){var Br=this.canvasObject;if(Br){this.highlightCanvas=null;this.removeChildren(Br);Br.destroy();}},scaleFactor:1,renderRectangles:function(){this.canvasObject.clearFontCache();this.refreshLabelInTree();this.refreshColorInTree();this.canvasObject.isHeaderOnTop=this.props.isHeaderOnTop;this.canvasObject.render();},renderLegend:function i(){if(!this.props.showLegend){if(this.attributeColorByLegendPlaceHolder){this.attributeColorByLegendPlaceHolder.style.display="none";}return ;}if(!this.attributeColorByLegend){var Bt=this;var Bs=this.canvasObject.addDisposable(new A9.GMLegend({widget:this,model:this.model,placeholder:this.attributeColorByLegendPlaceHolder,currDockedPositionIdx:k(this.readGlobalAttriLegndProperty(W.LEGEND_POSITION)),cutBy:this.legendCutBy,cssClass:"gm-legend",styles:this.HTML5PROPS.LEGEND,readGlobalProperty:function(Bu){return Bt.readGlobalAttriLegndProperty(Bu);},writeGlobalProperty:function(Bu,Bv){if(Bu===Ao.LEGEND_BG_COLOR){Bt.observableModel.legendBackground.value.setValue(j.decodeColor(Bv));}else{if(Bu===Ao.LEGEND_BG_FILL_TRANSPARENCY){Bt.observableModel.legendBackground.opacity.setValue(Bv/100);}else{if(Bt.observableModel[Bu]){Bt.observableModel[Bu].setValue(Bv);}else{Bt.writeGlobalAttriLegndProperty(Bu,Bv,{success:function(){Bt.reRender();}});}}}},configureLegendPopup:function(Bu,Bv){return Bt.configureAttriLegendPopup(Bu,Bv);}}));Bs.render();Bs.parent=this;this.attributeColorByLegend=Bs;this.attributeColorByLegendPlaceHolder=Bs.domNode;}else{var Br=this.attributeColorByLegend;Br.currDockedPositionIdx=k(this.readGlobalAttriLegndProperty(W.LEGEND_POSITION));this.initHTML5Props(this.HTML5PROPS);Br.updateStyle(this.HTML5PROPS.LEGEND);Br.updateTitleLineHeight();this.hEvalSize4Legend();this.updateLegend();Br.updateSplitter();this.updateCanvasAfterAttributeLegendChanged(D[Br.currDockedPositionIdx].pos,this.legendW);}this.attributeColorByLegend.cutBy=this.legendCutBy;this.attributeColorByLegend.minHeight=this.legendMinHeight;this.attributeColorByLegend.updateContainerSize(this.getWidth(),this.getHeight());this.attributeColorByLegend.feedData([{dataType:Bg.COLOR_BY,dataObj:this.verticalLegendColorByElements},{dataType:Bg.SIZE_BY,dataObj:this.verticalLegendSizeByElements}],(this.readGlobalAttriLegndProperty(W.LEGEND_MODE)===BO.MINIMIZED));},getColorByMetricThreshold:function(){if(!this.props.hasColorInThresholds){return undefined;}var Bw;if(this.colorByMetricThreshold){Bw=this.colorByMetricThreshold;}else{var Bt=this.modelData,Bx=Bt.gsi.mx,Br=this.props.colorMetricID,By={max:"",min:""},Bv,Bs;Ag.forEach(Bx,function(B0){if(B0.did===Br){By=B0;return false;}});if(By.max===""&&By.min===""){this.colorByMetricThreshold=undefined;return ;}if(Bt.gsi.thresholds[Br]&&By){var Bz,Bu;Bz=Bt.gsi.thresholds[Br];Bv=AO.getRankMode(Bz);Bu=AO.getColorByFormatStr(this.getFormatString(this.colorMetricIndex),Bv);Bs=AO.getColorByItems(Bz,Bv,By.max,By.min,By.cnt,Bu,AI.getCSSColorString(F));Bs.sort(function(B1,B0){var B2;if(B1.ceil>B0.ceil){B2=1;}else{if(B1.ceil===B0.ceil){B2=0;}else{B2=-1;}}return B2;});}else{if(By){Bs=AO.getDefaultColorByItems(AI.getCSSColorString(F),By.max,By.min);}else{Bs=AO.getDefaultColorByItems(AI.getCSSColorString(F),1,0);}Bv=v.VALUE;}Bw={rankMode:Bv,items:Bs};this.colorByMetricThreshold=Bw;}return Bw;},render:function(Br){if(this.hasRendered&&this.unrender){this.unrender();}this._super(Br);},reRender:function V(){if(this.hasError()){return ;}this._super();},loadDeleteStatus:function(Bv,Br){if(!Bv.entityChildren){if(Br===AR.dftDel||Br===AR.usrDel){Bv.deleted=true;}else{delete Bv.deleted;}return ;}if((!Br||Object.keys(Br).length===0)&&!Bv.hasChildDeleted){return ;}var Bu=Bv.entityChildren,Bt;for(Bt=0;Bt<Bu.length;Bt++){var Bx=Bu[Bt];var Bs=this.getEntityDisplayName(Bx);var Bw=Br&&Br[Bs];this.loadDeleteStatus(Bx,Bw);}},getFormatString:function Be(Bu){var Bt=this.modelData,Bv=Bt.nf||[],Bs=Bv.length,Br;if(Bu>=0&&Bu<Bs){Br=AO.getNumberFormat(Bt,Bu);return Br.replace(/\'/g,'"');}return"";},checkMetricValid:function Bk(Bs){var Br=this.modelData,Bt=Br.ghs.chs.items,Bu=Bt[0]?Bt[0].items.length:0;return !(Bs<0||Bs>=Bu);},getMetricName:function BT(By){var Bx="",Bu=this.modelData,Bt=Bu.ghs.chs.items,Bs=Bt.length,Bz=Bu.gts.col,Bv;if(!this.checkMetricValid(By)){return Bf;}for(Bv=0;Bv<Bs;Bv++){var Bw=Bt[Bv].items[By].idx;var Br=Bz[Bv].es[Bw].n;Bx+=Br+" ";}return Bx.slice(0,Bx.length-1);},getEntityDisplayName:function BW(By){var Bs=By.level,Bv=(By.index===undefined)?By.indices[0]:By.index,Bz="",Bx=this.modelData.ghs.rhs.items,Bw=Bx[Bv].items,Br=(Bw&&Bw.length)||0,B0=this.modelData.gts.row[Bs],Bu,Bt,B2=[];for(Bu=0;Bu<Br;Bu++){if(!Bw[Bu]||Bw[Bu].tui!==Bs){continue;}var B1=Bw[Bu].idx;if(B1===-1){continue;}Bt=B0.es[B1];if(B2.indexOf(Bt)===-1){Bz+=Bt.n+" ";B2.push(Bt);}}Bz=Bz.substring(0,Bz.length-1);return Bz;},previousTooltip:null,previousSelected:[],isRectangleMenuOnClose:false,drawHighlight:function(Br){if(!Br){return null;}var Bw=false,Bt=false,Bs=this.props.isHeaderOnTop,Bu=Br.headerSize||Br.size,Bv=!!Br.entityChildren,Bx=this.highlightCanvas;if(Br===this.previousTooltip){Bw=true;}else{if(this.previousTooltip&&this.previousTooltip.entityChildren){Bw=A3(this.previousTooltip,Br);}}if(this.previousSelected.indexOf(Br)!==-1||this.contextMenuSelection.indexOf(Br)!==-1){Bt=true;}else{Ag.forEach(this.previousSelected,function(By){if(By.entityChildren){if(A3(By,Br)){Bt=true;}}});Ag.forEach(this.contextMenuSelection,function(By){if(By.entityChildren){if(A3(By,Br)){Bt=true;}}});}if(!Bu){return null;}Bx.highlight(Bu,Br,{isHovered:Bw,isSelected:Bt,isEntityContainer:Bv,contextMenuSelected:this.IsInContextMenuSelectionIndex(Br),isPreviousSelected:this.previousSelected.indexOf(Br)!==-1,isHeaderOnTop:Bs});return Bu;},updateEntityHighlight:function(Br){if(!Br){return ;}this.drawHighlight(Br);},applyToEntityRecursively:function(Bs,Bt){if(!Bs){return ;}if(Bs.entityChildren){var Bv=this.getAllSiblingEntities(Bs),Bu=this,Br=Bv;while(Br.length>0){var Bw=Br.shift();Bt(Bw);if(Bw.entityChildren){Ag.forEach(Bw.entityChildren,function(Bx){Br.push(Bx);});}}}else{Bt(Bs);}},refreshHighlights:function(Br){if(!this.highlightCanvas){return ;}Br=Br||this.previousSelected||[];ContextMenuEntitySet=this.contextMenuSelection||[];if(!this.props.isHeaderOnTop){Br.sort(function(Bt,Bs){var Bv=Bt.level,Bu=Bs.level;return Bv<Bu?-1:(Bv>Bu?1:0);});ContextMenuEntitySet.sort(function(Bt,Bs){var Bv=Bt.level,Bu=Bs.level;return Bv<Bu?-1:(Bv>Bu?1:0);});}this.highlightCanvas.clear();Ag.forEach(ContextMenuEntitySet,function(Bs){this.applyToEntityRecursively(Bs,H.bind(this));},this);Ag.forEach(Br,function(Bs){this.applyToEntityRecursively(Bs,H.bind(this));},this);},getLowestLevelRectangle:function(Bt){var Bs=document.elementFromPoint(Bt.pageX,Bt.pageY);var Br=[];while(!this.isLowestLevelRectangle(Bs)){Bs.style.display="none";Br.push(Bs);Bs=document.elementFromPoint(Bt.pageX,Bt.pageY);}while(Br.length){Br.pop().style.display="block";}return Bs;},areaSelect:function(Bt,Bu){var Br=this.previousSelected.slice();if(!Bu.ctrlKey){this.removeAllSelections();}this.preorderTraverse(this.root,function(Bw){if(Bw===this.root||!Bw.size){return ;}if(!Bw.entityChildren&&!isNaN(BH(Bw.size,Bt).x)){this.addToSelection(Bw);return false;}});this.doSelection();this.refreshHighlights();if(!J(Br,this.previousSelected)){BA.call(this,this.previousSelected);}var Bv,Bs=this.previousSelected;if(Bs&&Bs.length>0){Bv=Av.position(this.canvasObject.domNode,true);this._toolbarContext={type:e.RECTANGLE,pos:{e:{pageX:Bt.x+Bv.x,pageY:Bt.y+Bv.y},getTarget:function(){return undefined;}},entity:Bs[0]};}},getEntityByTouch:function(Bx,B3){var B0=this.getElementBehindCurtains(Bx.evt);if(!B0){return null;}var Bv=Bx.pageX,Bt=Bx.pageY;if(B3){var Br=B0,B2=[];while(B0!==this.domNode&&B0.tagName.toLowerCase()!=="img"){B2.push(B0);B0.style.visibility="hidden";B0=document.elementFromPoint(Bv,Bt);if(!B0||B0===Br){break;}Br=B0;}while(B2.length>0){var Bs=B2.pop();Bs.style.visibility="visible";}}if(!B0){return null;}var Bu;if(B0!==this.domNode){if(B0.getAttribute("idx")&&!B3){Bu=this.getIdxObjectByTarget(B0);}else{var B1=Av.position(this.canvasObject.domNode,true),Bz=Bv-B1.x,Bw=Bt-B1.y;var By={x:Bz,y:Bw};Bu=this.canvasObject.getEntity(By);}}return Bu;},getAllSiblingEntities:function(Br){return this.canvasObject.getAllSiblingEntities(Br);},getMetricDisplayValues:function(Bt,Bu){var Bs=BP(Bt,Bu),Br=Bs.map(function(Bv){return A1(Bu,Bt,Bv).v;});return Br;},getLabelForEntity:function(Bv){var Bt=this.getEntityDisplayName(Bv);if(Bv.entityChildren!==undefined){return'<span style="#addedStyleTemplate">'+Ak.encodeHtmlString(Bt)+"</span>";}if(!this.props.showMetricValues){return'<span style="#addedStyleTemplate">'+Ak.encodeHtmlString(Bt,true)+"</span>";}var Bu=this,Br=this.getMetricDisplayValues(Bu,Bv);Br.unshift(Bt);Br=Br.map(function(Bw){return Ak.encodeHtmlString(Bw,true);});var Bs='<span style="#addedStyleTemplate">'+Br.join("<br>")+"</span>";return Bs;},lassoSelecting:function(){BE.removeClass(this.lassoSelector,"lasso-selector-hasContent");},lassoSelected:function(Bs){if(Av.supportsTouches===true){return ;}var Br=this.parent;this.areaSelect({x:Bs.left,y:Bs.top,w:Bs.width,h:Bs.height},Bs);if(this.previousSelected.length){BE.addClass(this.lassoSelector,"lasso-selector-hasContent");}this.displayVizBoxVisFilterIndicator(true,Br);},lassoSelectorResized:function(Br){this.lassoSelecting();this.lassoSelected(Br);},configurePopup:function(Br,Bs){Br.hostId=this.id;Br.hostElement=Bs;},showMenu:function(Bx,Br,Bw){var Bu=this.menuAnchor,Bv=this,Bt,Bs;if(!Bu){Bu=document.createElement("div");Bu.id=this.id+"-hm-menu-anchor";Bu.style.position="absolute";document.body.appendChild(Bu);this.menuAnchor=Bu;}Bs=Bu.style;Bs.left=Br.pageX+"px";Bs.top=Br.pageY+"px";Bs.zIndex=101;this.configurePopup(Bx,Bu);Bt=Bx.newInstance();if(Bt&&Bw){Bt.onCloseMenuCallBack=function(){Bv.clearContextMenuSelectionHighLight();Bv.isRectangleMenuOnClose=true;};}this.openPopup(Bt);},getSelectionMenuConfig:function(Bt){var Br=AO.mergeHashes(I.call(this,Bt),Bm.call(this)),Bs=[{name:"filter"},{name:"editGroup"},{name:"editCalculation"},{name:"createDe"},{name:"showData"},{name:"renameDe"}];return AO.mergeMenuConfigs(Br,Bs);},getBlankSpaceMenuConfig:function(Bw){var Bs=new mstrmojo.ui.menus.MenuConfig(),Bu=this,Bt=Bu.props;Bs.addMenuItem(mstrmojo.desc(1918,"Format"),"xt",function(){N.call(Bu,Bw);});if(this.hasSizebyOrColorby()){if(!Bt.showLegend){var Bv=mstrmojo.desc(12001,"Show Legend"),Br="showLegend";Bs.addMenuItem(Bv,"xt",this.getMenuHandler(Br));}}return Bs;},keepOnly:function(){this.updateAfterKeepOnly(true);},exclude:function(){this.updateAfterKeepOnly(false);},getMenuHandler:function(Bs){var B1=this._super(Bs);if(B1!==mstrmojo.emptyFn){return B1;}var Bx=this,Bu={keepOnly:function Bw(){Bx.keepOnly();Bx.clearContextMenuSelection();Bx.noHighlightAfterKeepOnlyExcludeDrill=true;},exclude:function Bz(){Bx.exclude();Bx.clearContextMenuSelection();Bx.noHighlightAfterKeepOnlyExcludeDrill=true;},showData:function Bt(){Bx.showData();},rectangleDrill:function Bv(B2){AO.doDrill(Bx,B2.ctxt.drillUnit,AF,{headerDrill:false});Bx.clearContextMenuSelection();Bx.noHighlightAfterKeepOnlyExcludeDrill=true;},headerDrill:function B0(B2){AO.doDrill(Bx,B2.ctxt.drillUnit,AF,{headerDrill:true});Bx.clearContextMenuSelection();Bx.noHighlightAfterKeepOnlyExcludeDrill=true;},showLegend:function By(){Bx.observableModel.showLegend.setValue(true);},hideLegend:function Br(){Bx.observableModel.showLegend.setValue(false);}};if(Bu.hasOwnProperty(Bs)){return Bu[Bs];}return mstrmojo.emptyFn;},isClearAllEnabled:function(Bv){var Bs=this.modelData||{},Bu=AO.getPropertyByPath(Bs,"gts.row",[]),Br,Bw,Bx=Bs.sc,Bt;if(Bv){Bt=Bv.id||"";Br=AO.findInArray(Bu,function(By){return Bt.indexOf(By.id)!==-1;});if(Br!==-1){Bw=Bu[Br];Bx=Bw.sc||Bx;}}return !!(Bx===undefined||Bx.showall);},addToSelection:function(Br){var Bs=this.previousSelected||[];if(Bs.indexOf(Br)===-1){Bs.push(Br);}},removeFromSelection:function(Br){var Bt=this.previousSelected||[],Bs=Bt.indexOf(Br);if(Bs!==-1){Bt.splice(Bs,1);return true;}return false;},removeAllSelections:function(Bs){var Br=(this.previousSelected||[]).slice();this.previousSelected=[];if(!Bs&&Br.length>0){this.raiseEvent({name:"selectionBatchRemove",entities:Br});}return Br;},clearContextMenuSelection:function(){if(this.contextMenuSelection.length!==0){this.contextMenuSelection=[];this.refreshHighlights();}},addEntityToContextMenuSelection:function(Br){var Bs=this.contextMenuSelection;if(Bs.indexOf(Br)===-1){Bs.push(Br);this.applyToEntityRecursively(Br,H.bind(this));}},cloneSelectionToContextMenuSelection:function(){this.contextMenuSelection=this.previousSelected.slice(0);},IsInContextMenuSelectionIndex:function(Br){return this.contextMenuSelection.indexOf(Br)!==-1;},contextMenuSelectionHandler:function(Bu){var Bt=Bu.getTarget();this.clearContextMenuSelection();if(this.isRectangle(Bt)){var Br=this.getEntityByTouch(AL(Bu)),Bs=this.previousSelected.indexOf(Br)!==-1,Bv=Bu.ctrlKey||Bu.metaKey;if(Bv===false){if(Bs){this.cloneSelectionToContextMenuSelection();this.refreshHighlights();}else{this.addEntityToContextMenuSelection(Br);}}if(this.previousSelected.length===0){this.highlightCanvas.clear();}this.doSelection(true);}},clearContextMenuSelectionHighLight:function(){this.clearContextMenuSelection();this.refreshHighlights();},isTargetHasInfoWindow:function(Bv){var Bt=this.modelData,Bz=Bt&&Bt.sc,By=this.model,B0=By&&By.docModel,B1,Bx,Bw=AO.getPropertyByPath(Bt,"gts.row",[]),Bs,Br;if(Bv){Br=Bv.id||"";Bx=AO.findInArray(Bw,function(B2){return Br.indexOf(B2.id)!==-1;});if(Bx!==-1){Bs=Bw[Bx];Bz=Bs.sc||Bz;}}B1=Bz&&Bz.tks;if(!B1){return false;}var Bu=B0.getTargetInfoWin(B1);return(Bu&&Bu.length>0);},onclick:function(B7,Bv){delete this.noHighlightAfterKeepOnlyExcludeDrill;if(!Bv){this.dismissLassoSelector();}var B9=B7.getTarget(),Bs=false,B0=false,Bw=false,B4=false,By,B6,B2,B8,Bu,Br,B3,CA=A7.call(this),Bt=AE.call(this),Bz;this.clearContextMenuSelection();Br=B7.e.ctrlKey||B7.e.metaKey;isRectangleMenuOnClose=this.isRectangleMenuOnClose;if(this.isRectangle(B9)){By=this.getEntityByTouch(AL(B7));if(By){Bz=By.level===this.levelAttributes.length-1;B2=this.previousSelected;B6=B2.length;B8=B6===0;Bu=B2.indexOf(By)!==-1;B3=B6>1;if(Bu&&!B3){if(!Bv&&(this.isClearAllEnabled(By)||this.isTargetHasInfoWindow(By))){B0=true;this.removeAllSelections();}}if((Bu&&!Br&&B3&&!Bv)||(!Bu&&!Br)||(CA^Bz&&!Bu&&Br)||(!(CA||Bt)&&Bu)){B0=true;Bw=true;this.removeAllSelections();this.addToSelection(By);}if(!Bu&&Br){Bw=true;this.addToSelection(By);}if(Bu&&Br&&B3){if(!Bv){B4=true;this.removeFromSelection(By);}}B0=B0||B8===(this.previousSelected.length>0);if(B0){this.highlightCanvas.clear();}if(Bw||B4){this.applyToEntityRecursively(By,H.bind(this));}if(B0||Bw||B4){this.doSelection();Bs=true;}this.displayVizBoxVisFilterIndicator(Bw,this.parent);if(!Bu){this.dismissLassoSelector();}}}var Bx=this.getComponentType(B7),B1;if(!Bv&&!Br&&isRectangleMenuOnClose===false){if(Bx.type===e.BACKGROUND||Bx.type===e.LEGEND_BACKGROUND){var B5=function(CB){return this.isClearAllEnabled(CB)||this.isTargetHasInfoWindow(CB);};B1=(this.previousSelected||[]).filter(B5,this);if(B1.length>0){B1.forEach(function(CB){this.removeFromSelection(CB);},this);this.doSelection();Bs=true;this.refreshHighlights(B1);this.refreshHighlights();}}}if(this.attributeColorByLegend){this.attributeColorByLegend.hideToolbar();}if(Bs){BA.call(this,this.previousSelected);}this._toolbarContext={type:Bx.type,pos:B7};this.isRectangleMenuOnClose=false;},getElementBehindCurtains:function(Bt){var Br=[this.highlightCanvas.domNode,this.lassoSelector];Ag.forEach(Br,function(Bu){Bu._visibility=Bu.style.visibility;Bu.style.visibility="hidden";});var Bs=document.elementFromPoint(Bt.e.pageX,Bt.e.pageY);Ag.forEach(Br,function(Bu){Bu.style.visibility=Bu._visibility;Bu._visibility=undefined;});return Bs;},getComponentType:function(Bv){var Bs;var Bu=this.getElementBehindCurtains(Bv),Bt=this.attributeColorByLegend;if(this.isRectangle(Bu)){if(Bu.getAttribute("idx")||(Bu.tagName==="SPAN"&&Bu.parentNode.getAttribute("idx"))){Bs=e.RECTANGLE_LABEL;}else{var Br=this.getEntityByTouch(AL(Bv));if(Br){Bs=e.RECTANGLE;}else{Bs=e.BACKGROUND;}}}else{if(Bt&&Bt.domLegend===Bu){Bs=e.LEGEND_BACKGROUND;}else{if(Bu===this.domNode||Bu.desc==="clearAllBtn"){Bs=e.BACKGROUND;}}}return{type:Bs,target:Bu};},isRectangle:function(Br){return Av.contains(this.canvasObject.domNode,Br,true)||Av.contains(this.highlightCanvas.domNode,Br,true)||Av.contains(this.lassoSelector,Br,true);},isLowestLevelRectangle:function(Br){return Br.getAttribute&&Br.getAttribute("idx")&&!(Br.innerHTML);},toggleSelectAll:function(Br){var Bs=this.modelData.gts.row[Br.level].sc;if((Bs&&Bs.all!=="false"&&Bs.all!==false)||!this.hasGridTarget){this.selectAll=!this.selectAll;return true;}return false;},doSelection:function(Br){this.prepareSelectedNodesInfo(Br);if(!Br){this.endSelections();}},getObjectByIdx:function(Br){if(Br){var Bs=Br.split(":");var Bu=this.root,Bt;for(Bt=0;Bt<Bs.length;Bt++){Bu=Bu.entityChildren[Bs[Bt]];}return Bu;}return null;},setColorByType:function(Br){if(Br==="attribute"){this.props.colorByType="attribute";this.colorTheme.colorByType="attribute";}else{this.props.colorByType="metric";delete this.colorTheme.colorByType;}},clearChildren:function(Br){if(!Br){return ;}while(Br.firstChild){Br.removeChild(Br.firstChild);}},setLayout:function AJ(Br){var Bu=parseInt(this.width,10),Bs=parseInt(this.height,10),Bv=this.LayoutProperties.Padding,Bw=Bu-2*Bv,By=Bs-2*Bv,Bt=0;if(!this.legendSize){this.legendSize={};}var Bx=this.legendSize;if(this.props.showLegend){if(this.legendType===BS.VERTICAL){if(!Br){if(this.attributeColorByLegend){Br=D[this.attributeColorByLegend.currDockedPositionIdx].pos;}else{Br=this.readGlobalAttriLegndProperty(W.LEGEND_POSITION);}}this.hEvalSize4Legend();Bx.w=this.legendW;Bx.h=this.legendH;Bw-=Bx.w;if(!this.isOnRight(Br)){Bt=Bx.w;}}}this.heatMapSize={x:Bt,y:0,w:Bw,h:By};this.maxScale=10;},hEvalSize4Legend:function(){var Bv,Bt=this.verticalLegendColorByElements,Bs=this.verticalLegendSizeByElements,Bu=this.getWidth(),Br=this.getHeight(),Bw=this.HTML5PROPS.LEGEND,Bx;if(this.props.showLegend===false){this.legendW=this.legendH=this.legendP=0;}else{Y.applyHTML5Props(Bw);this.legendP=Ar;if(!this.legendScale){Bx=this.readGlobalAttriLegndProperty(W.SCALE_LEGEND_WIDTH);if(Bx){this.legendScale=Bx;this.legendResized=true;}}Bv=Y.getLegendSize([{dataType:Bg.COLOR_BY,dataObj:Bt},{dataType:Bg.SIZE_BY,dataObj:Bs}],this.legendResized?this.legendScale:undefined,Bu,Br,Bw,this.legendFixedW);this.legendCutBy=Bv.cutBy;this.legendMinHeight=Bv.minHeight;this.legendFixedW=Bv.width;if(Bv.scale){this.legendScale=Bv.scale;}if(this.readGlobalAttriLegndProperty(W.LEGEND_MODE)===BO.MINIMIZED||Bv.autoCollapse){Bv=Y.getLegendSize4MinMode(Bt,Br);this.legendCutBy=undefined;}this.legendW=Bv.width;this.legendH=Bv.height;}},applyLayout:function(){if(this.heatMapSize){if(this.canvasOuterContainer){var Br=this.canvasOuterContainer.style;Br.left=this.heatMapSize.x+"px";Br.top=this.heatMapSize.y+"px";Br.width=this.heatMapSize.w+"px";Br.height=this.heatMapSize.h+"px";}if(this.canvasContainer){var Bt=this.canvasContainer.style;Bt.width=this.heatMapSize.w+"px";Bt.height=this.heatMapSize.h+"px";}if(this.canvasObject){var Bs=this.canvasObject;Bs.width=this.heatMapSize.w;Bs.height=this.heatMapSize.h;}}},refreshWidget:function(){var Bs=Al.call(this),Br=this.attributeColorByLegend;AY.copy(Bs,this.canvasObject);if(this.excludeData){return ;}this.setLayout();this.applyLayout();BB.call(this);this.renderRectangles();this.refreshHighlights();if(Br){if(this.isAttributeColorByType()||this.props.hasColorInThresholds){this.getVerticalLegendColorByInfo();}if(this.props.sizeMetricEnabled){this.getVerticalLegendSizeByInfo();}Br.feedData([{dataType:Bg.COLOR_BY,dataObj:this.verticalLegendColorByElements},{dataType:Bg.SIZE_BY,dataObj:this.verticalLegendSizeByElements}],(this.readGlobalAttriLegndProperty(W.LEGEND_MODE)===BO.MINIMIZED));}this.renderLegend();},hideInfoBox:function(){var Bs=Ac.domNode;if(Bs&&Bs.parentNode){var Br=this.previousTooltip;this.previousTooltip=undefined;this.applyToEntityRecursively(Br,H.bind(this));Bs.parentNode.removeChild(Bs);}},getIdxObjectByTarget:function(Bt){var Bs=Av.findAncestorByAttr(Bt,"idx",true,this.domNode);var Br=Bs&&Bs.value;if(!Br){return null;}return this.getObjectByIdx(Br);},showInfoBox:function(Bs,Bv){if(!Bs){return ;}Ac.toggle(true);if(Bs===this.previousTooltip){Ac.moveTo(Bv.x,Bv.y);return ;}var Bu=this.previousTooltip;this.previousTooltip=Bs;this.applyToEntityRecursively(Bu,H.bind(this));this.applyToEntityRecursively(Bs,H.bind(this));var Br=Bs.headerSize||Bs.size;if(!Br||isNaN(Br.x)){return ;}var Bt=AB(Bs,this);if(Bt){if(!Ac.domNode.parentNode){document.body.appendChild(Ac.domNode);}Ac.displayInfo(Bt,Bv);}},onmousedown:function(){this._isMouseDown=true;},onmousemove:function(Bt){if(!this._isMouseDown){var Bu=AL(Bt);var Bs=Bu.target;if(!Bs||!this.isRectangle(Bs)){return ;}var Br=this.getEntityByTouch(Bu);if(Br){this.showInfoBox(Br,{x:Bt.e.pageX,y:Bt.e.pageY});}}},onmouseup:function(){delete this._isMouseDown;},onmouseout:function AU(Bt){var Bs=this.canvasContainer,Br=Bt.e.toElement||Bt.e.relatedTarget;if(!Av.contains(Bs,Br,true)){this.hideInfoBox();}},oncontextmenu:function BD(Br){if(mstrApp.isInVFInteractMode){Av.stopPropogation(window,Br);Av.preventDefault(window,Br);return false;}this.contextMenuSelectionHandler(Br);this.hideInfoBox();AZ.call(this,this.contextMenuSelection);var Bs=this.getComponentType(Br),Bw=Br.ctrlKey||Br.metaKey,Bu=f[Bs.type];if(Bu){Bu.call(this,Br,Bs.target);Br.cancel();}if(this.attributeColorByLegend){var Bv=Br.getTarget(),Bt=this.attributeColorByLegend;if(Av.contains(Bt.domNode,Bv,true)){Bt.handleRMCOnLegend(Br);}else{Bt.hideToolbar();}}Br.preventDefault();return false;},destroy:function(Bs){var Br=this.attributeColorByLegend;if(Br){Br.hideToolbar();}this._super(Bs);},readGlobalAttriLegndProperty:function n(Bt){var Bs=this.props,Br,Bu;switch(Bt){case Ao.LEGEND_BG_COLOR:Bu=Bs.lgdBgFillClr;break;case Ao.LEGEND_BG_FILL_STYLE:Bu=Bs.lgdBgFillStyle;break;case Ao.LEGEND_BG_FILL_EFFECT:Bu=Bs.lgdBgFillEff;break;case Ao.LEGEND_BG_FILL_TRANSPARENCY:Bu=Bs.lgdBgFillTrans;break;case Ao.LEGEND_FONT_SIZE:Bu=Bs.lgdFntSz;break;case Ao.LEGEND_FONT_FAMILY:Bu=Bs.lgdFntFml;break;case Ao.LEGEND_FONT_STYLE:Bu=Bs.lgdFntStyle;break;case Ao.LEGEND_FONT_COLOR:Bu=Bs.lgdFntClr;break;case Ao.LEGEND_BORDER_SHOW:Bu=Bs.lgdBdrShw;break;case Ao.LEGEND_BORDER_COLOR:Bu=Bs.lgdBdrClr;break;case Ao.LEGEND_BORDER_THICKNESS:Bu=Bs.lgdBdrThk;break;case Ao.LEGEND_BORDER_LINE_STYLE:Bu=Bs.lgdBdrStyle;break;case Ao.COLOR_SQUARE_COLOR:Br=this.colorSqureIdentity;if(Br){Bu={color:Br.decodedColor,isDefaultColor:Br.isDefaultColor};}else{Bu={color:"#0000FF",isDefaultColor:true};}break;case W.LEGEND_MODE:Bu=Bs.lm;break;case W.LEGEND_POSITION:Bu=Bs.LegendPosition;break;case W.SCALE_LEGEND_WIDTH:Bu=Bs.lwr;break;}if(Bu===undefined||((typeof Bu)==="number"&&isNaN(Bu))){Bu=this.defaultsLegendPop&&this.defaultsLegendPop[Bt];}return Bu;},initHTML5Props:function(Bt){var Bs=Bt.LEGEND={},Br=function(Bu){var Bv=["solid","dashed","dotted"];return Bv[Bu]||"none";};Bs.fontFamily=this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_FAMILY);Bs.fontSize=this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_SIZE);BL.processFontStyle(Bs,this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_STYLE));Bs.color=j.decodeColor(this.readGlobalAttriLegndProperty(Ao.LEGEND_FONT_COLOR));Bs.backgroundColor=j.decodeColor(this.readGlobalAttriLegndProperty(Ao.LEGEND_BG_COLOR));Bs.opacity=this.readGlobalAttriLegndProperty(Ao.LEGEND_BG_FILL_TRANSPARENCY)/100;if(this.readGlobalAttriLegndProperty(Ao.LEGEND_BORDER_SHOW)){Bs.borderWidth=this.readGlobalAttriLegndProperty(Ao.LEGEND_BORDER_THICKNESS);Bs.borderStyle=Br(this.readGlobalAttriLegndProperty(Ao.LEGEND_BORDER_LINE_STYLE));Bs.borderColor=j.decodeColor(this.readGlobalAttriLegndProperty(Ao.LEGEND_BORDER_COLOR));}},configureAttriLegendPopup:function P(Br,Bs){Br.hostId=this.id;Br.hostElement=Bs;},writeGlobalAttriLegndProperty:function(Bs,Bt,Bv){var Br=!!(Bv&&Bv.success),Bu=function(By,Bx){var Bw=this.props;Bw.unmarshal(Bs,By);if(Br){Bv.success.call(this,Bw[Bs],Bx);}};if(Bs===Ao.COLOR_SQUARE_COLOR){this.props.unmarshal(Bs,Bt);this.setProperty(Bs,Bt,{callback:Bv});}else{Bu.call(this,Bt,false);this.setProperty(Bs,this.props.marshal(Bs),{suppressData:true,clientUndoRedoCallback:Br?Bu:undefined});}},onLegendDropZoneChange:function Aw(Br,Bs){this.setLegendSlot(Br,Bs);},onLegendDropped:function(Br){this.writeGlobalAttriLegndProperty(W.LEGEND_POSITION,Br,{success:function(Bt,Bs){if(Bs){this.renderLegend();this.updateCanvasAfterAttributeLegendChanged(Bt,this.legendW);}}});},setLegendSlot:function(Bs,Bv){var Bu=this.attributeColorByLegend.currDockedPositionIdx,Bw=this.canvasOuterContainer;if(Bv!==Bu){var Br=this.isOnRight(D[Bu].pos),Bt=this.isOnRight(Bs.pos);if(Br!==Bt){Bw.style.left=Bt?"0px":this.legendW+"px";}}},isOnRight:function(Br){return(Br===Ad.RIGHT_MIDDLE||Br===Ad.RIGHT_TOP||Br===Ad.RIGHT_BOTTOM);},updateLegend:function(){var Br=this.attributeColorByLegend;this.attributeColorByLegendPlaceHolder.style.width=this.legendW+"px";this.attributeColorByLegendPlaceHolder.style.height=this.legendH+"px";Br.width=this.legendW;Br.height=this.legendH;Br.cutBy=this.legendCutBy;Br.minHeight=this.legendMinHeight;Br.updateContainerSize(this.getWidth(),this.getHeight());Br.feedData([{dataType:Bg.COLOR_BY,dataObj:this.verticalLegendColorByElements},{dataType:Bg.SIZE_BY,dataObj:this.verticalLegendSizeByElements}],(this.readGlobalAttriLegndProperty(W.LEGEND_MODE)===BO.MINIMIZED));Br.updateAfterResize();},toggleLegend:function(Br){var Bt=this.attributeColorByLegend,Bs;Bs=Bt.domNode.style;if(!Br){Bt.hideToolbar();Bs.display="none";}else{if(Bs.display!=="block"){Bs.display="block";}}},updateCanvasAfterAttributeLegendChanged:function(Br,Bv){var Bu=parseInt(this.width,10),Bs=parseInt(this.height,10),Bw=this.LayoutProperties.Padding,Bx=Bu-2*Bw-Bv,By=Bs-2*Bw,Bt=0;if(this.props.showLegend&&!this.isOnRight(Br)){Bt=Bv;}this.heatMapSize={x:Bt,y:0,w:Bx,h:By};this.applyLayout();BB.call(this);this.renderRectangles();this.highlightCanvas.resetCanvasRect(this.heatMapSize);this.refreshHighlights();},getCellForNode:function Bc(Bs){var Br=this.levelAttributes[Bs.level];return{at:Bs.at,dei:Bs.dei,dpt:Bs.dpt,o:Bs.o,n:Br.name,tui:Bs.tui,ui:Bs.ui,axis:1,v:Bs.label,tid:Br.id};},getCellUnitIndex:function Az(Br){return Br.o;},getColorByElements:function p(){var Br=this.verticalLegendColorByElements,Bs=this,Bt;if(Br===undefined){this.getVerticalLegendColorByInfo();Br=this.verticalLegendColorByElements||{};}Bt=(Br.elements||[]).map(function(Bw){var Bu=Bw.token,By=Bu.elements||[],Bx=Bu.levels||[],Bv=Bu.types||[];return{text:Bw.label,color:Bw.color,opacity:AS.call(Bs,Bx,By),comb:Au(Bx,By,Bv)};});Bt.unshift({text:mstrmojo.desc(2461,"All"),color:"#ffffff",opacity:100,comb:[]});return Bt;},updateColorByOpacity:function(Bt,Br){Bt=[].concat(Bt);Br=[].concat(Br);if(Bt.length!==Br.length){throw new Error("comb and opacity number not match");}var Bs=this.getPropsInfo(),Bu=Bs.attrColorByOpacity||{};Bt.forEach(function(Bx,Bw){var Bz=Bx.map(function(B0){return B0.tid;}).join("|"),By=Bx.map(function(B0){return B0.eid;}).join("|"),Bv=Bu[Bz];if(Bv===undefined){Bv={};Bu={};}Bv[By]=Br[Bw];Bu[Bz]=Bv;});this.observableModel.colorByOpacity.setValue(Bu);},execFormatHandler:function(){var Bw=function(){AO.selectPropertyPanel(this,0);}.bind(this);var Bv=this.previousSelected;if(Bv===undefined||Bv.length===0){Bw();return ;}var Bx=A7.call(this),Bs=AE.call(this),Bt=this._toolbarContext,By,Bu,Br;if(!Bx&&!Bs){return ;}if(Bt===undefined){Bw();return ;}By=Bt.pos;Bu=Bt.type;Br=Bt.entity||this.getEntityByTouch(AL(By));switch(Bu){case e.RECTANGLE_LABEL:case e.RECTANGLE:BN.call(this,Br,By);break;default:Bw();break;}},onNDECreated:function(Br){Br.forEach(function(Bu){var Bs=Bu.id,Bt=Bu.unitId;this.dfs(this.root,function(Bv){var Bw=Bv.id||"";if(Bw.indexOf(Bs)!==-1&&Bw.indexOf(Bt)!==-1){this.addToSelection(Bv);}}.bind(this));},this);this.doSelection();this.refreshHighlights();},triggerFontScaleChangeEvent:function(){A6.call(this,this.props.fonts);},isAttributeColorByType:function(){return this.props.colorByType==="attribute";},isMetricColorByType:function(){return this.props.colorByType==="metric";},onselectionBatchRemove:function(Br){this.refreshHighlights(Br.entities);},clearAllSelectionsAndHighlight:function As(Bs){var Br=Bs.getTarget();if(Br){Br.desc="clearAllBtn";this.onclick(Bs);delete Br.desc;}}});}());