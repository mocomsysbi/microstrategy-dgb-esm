(function(){mstrmojo.requiresCls("mstrmojo.Stepper","mstrmojo._HasLayout","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.expr","mstrmojo.css","mstrmojo.ValidationTextBox");var $DTP=mstrmojo.expr.DTP,$CSS=mstrmojo.css,$HASH=mstrmojo.hash,$DES=mstrmojo.desc;var MINSLIDER=1000;var USECOMMA=false;function comma(value){return USECOMMA?value.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):value;}function decomma(value){return USECOMMA?parseInt(value.toString().replace(/,/g,""),10):value;}mstrmojo.Refine.RefineValidateStepper=mstrmojo.declare(mstrmojo.Stepper,[mstrmojo._HasLayout],{scriptClass:"mstrmojo.Refine.RefineValidateStepper",markupString:'<div id="{@id}" class="mstrmojo-Stepper {@orientation} {@cssClass}" mstrAttach:click,mousedown,mouseup,mousemove,selectstart><div class="title">{@title}</div><div class="next">+</div><div class="text"></div><div class="prev">-</div></div>',vflag:null,layoutConfig:{w:{textNode:"100%"},xt:true},textInput:null,init:function init(props){var provider=props.provider;if(!!mstrApp.isWSStyling){this.layoutConfig=null;}this.children=[{scriptClass:"mstrmojo.ValidationTextBox",alias:"textInput",slot:"textNode",dtp:provider.dtp||$DTP.INTEGER,cssDisplay:"inline-block",height:"20px",width:"70px",min:1000,max:10000,valueChangeDelay:200,warningTooltip:{cssClass:"vi-regular vi-tooltip-V",invalid:true,position:"TC",top:"0",left:"0",lasting:2000,closeOnClick:true,highlight:true},_isValid:true,onvalueChange:function(evt){var value=evt.value.toString().replace(/[^0-9,]/g,""),valueInt;if(value.charAt(0)==="0"&&value.length>1){value=value.substr(1);}valueInt=parseInt(value,10);this.set("value",value===""?value:comma(decomma(value)));if(valueInt!==this.parent.provider.curVal){this.parent.provider.setVal(valueInt);}},onInvalid:function(){this.parent.set("vflag",false);if(!this.domNode){return ;}this.warningTooltip.refNode=this.domNode;this.warningTooltip.errorCode=null;this.warningTooltip.errorMsg=this.validationStatus.msg;this.warningTooltip.top="-"+(parseInt(this.domNode.clientHeight,10)+10);this.showWarning(this.warningTooltip);this._isValid=false;},onValid:function(){this.parent.set("vflag",true);this.hideWarning();this._isValid=true;},constraints:{trigger:mstrmojo.validation.TRIGGER.VALUESET,validator:function(v){var min=this.min,max=this.max,isEmpty=$HASH.isEmpty(v),value=decomma(v);if(isEmpty){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:$DES(14701,"Please input a number.")};}value=parseInt(value,10);if(value>=min&&value<=max){return{code:mstrmojo.validation.STATUSCODE.VALID};}else{if(value>max){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:$DES(14757,"The maximum value is")+" "+comma(max)};}else{if(value<min){return{code:mstrmojo.validation.STATUSCODE.INVALID,msg:$DES(14758,"The minmum value is")+" "+comma(MINSLIDER)};}}}},invalidCssClass:"invalid"},autoFormat:false,useRichTooltip:true}];this._super(props);this.addDisposable(provider);$CSS.addWidgetCssClass(this,(!!mstrApp.isWSStyling)?"mstrmojo-Refine-RefineValidateStepper":"mstrmojo-ui-ctrl-Stepper");},postBuildRendering:function(){this.updateDisplayText();this._super();},updateDisplayText:function updateDisplayText(){var currentValue=this.provider.getVal();if(currentValue<0){this.provider.set("curVal",0);this.provider.setVal(0);this.textInput.set("value",0);return ;}this.textInput.set("value",currentValue);}});}());