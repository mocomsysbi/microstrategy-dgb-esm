(function(){mstrmojo.requiresCls("mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.ScrollableContainer","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.Button");var $NWB=mstrmojo.Button.newWebButton,$HASH=mstrmojo.hash,$CSS=mstrmojo.css,$DOM=mstrmojo.dom;var CSS_GROUPING="grouping",CSS_HIGHLIGHT="highlight",CSS_DISBALED="disabled";function showMenuContext(evt,props){$DOM.preventDefault(window,evt);$DOM.stopPropogation(window,evt);if(this.groupingOverlay.domNode.className.indexOf(CSS_HIGHLIGHT)===-1&&this.domNode.className.indexOf("selected")===-1){return ;}props=$HASH.copy(props,{supportsScroll:true,isHostedWithin:false,maxHeight:$DOM.getMaxScrollHeight()});var menuConfig=this.parent.getGroupContextMenuConfig(new mstrmojo.ui.menus.MenuConfig(props),this.k);if(menuConfig.hasMenuItems()){this.openPopup(menuConfig.newInstance());}}mstrmojo.vi.ui._CanGroup=mstrmojo.provide("mstrmojo.vi.ui._CanGroup",{_mixinName:"mstrmojo.vi.ui._CanGroup",startGrouping:function initGrouping(enabled){$CSS.addClass(this.domNode,CSS_GROUPING);var groupingOverlay=this.groupingOverlay;if(!groupingOverlay){var me=this,id=this.id;this.addChildren({scriptClass:"mstrmojo.ui.ScrollableContainer",cssClass:"groupingOverlay",alias:"groupingOverlay",cssDisplay:"",slot:"domNode",children:[$NWB(mstrmojo.desc(1911,"Group"),function(evt){evt.cancel();me.groupSelection();},true,{cssClass:"btnGroup",cssDisplay:""}),$NWB("",function(evt){var ENUM_CORNERS=mstrmojo.ui.PopupConfig.prototype.ENUM_CORNERS;showMenuContext.call(mstrmojo.all[id],evt.e,{hostId:id,hostElement:this.domNode,alignment:{host:ENUM_CORNERS.BOTTOM_LEFT,popup:ENUM_CORNERS.TOP_LEFT}});},false,{cssClass:"btnMenu",cssDisplay:""})]});this.groupingOverlay.render();var overlaynode=this.groupingOverlay.domNode;$DOM.attachEvent(overlaynode,"contextmenu",function(evt){showMenuContext.call(me,evt,{position:$DOM.getMousePosition(evt,window)});});$DOM.attachEvent(overlaynode,"click",function(evt){var target=evt.target;if(target.className.indexOf("mstrmojo-scrollbar")!==-1){$DOM.stopPropogation(window,evt);}});}this.setGroupingStatus(enabled?"":CSS_DISBALED);this._menuBtnInfo=this.menuBtnInfo;this.menuBtnInfo=null;this._originalContextMenu=this.shouldShowCustomizeContextMenu;this.shouldShowCustomizeContextMenu=function(){return false;};},setGroupingStatus:function setGroupingStatus(cssClass){var me=this,cssClasses=[CSS_DISBALED,CSS_HIGHLIGHT];cssClasses.forEach(function(className){$CSS.toggleClass(me.groupingOverlay.domNode,className,cssClass===className);});},endGrouping:function endGrouping(){$CSS.removeClass(this.domNode,CSS_GROUPING);this.setGroupingStatus("");this.menuBtnInfo=this._menuBtnInfo;delete this._menuBtnInfo;this.shouldShowCustomizeContextMenu=this._originalContextMenu;delete this._originalContextMenu;},initializeDrag:function initializeDrag(){return this.domNode.className.indexOf(CSS_GROUPING)===-1;},groupSelection:function groupSelection(){this.parent.groupSelection();},widgetResized:function onreize(){if(this._super){this._super();}var groupingOverlay=this.groupingOverlay;if(groupingOverlay){this.groupingOverlay.updateScrollbars();}}});}());