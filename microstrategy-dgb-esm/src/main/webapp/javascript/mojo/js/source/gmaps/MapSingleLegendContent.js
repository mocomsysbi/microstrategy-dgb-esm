(function(){mstrmojo.requiresCls("mstrmojo.Vis","mstrmojo.css","mstrmojo.VisUtility","mstrmojo.string","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapLegendEnums","mstrmojo.gmaps._MapLegendInteractivity");var $MOJO=mstrmojo,$CSS=$MOJO.css,$GMAPS=$MOJO.gmaps,$STR=$MOJO.string,$MUTIL=$GMAPS.MapUtils,SHAPE_TYPE=$GMAPS.ShapeType,INTERACTIVE_TYPE=$GMAPS.LegendInteractiveType;function removeExtraSpace(text){return text.replace(/ {2,}/g," ");}function fillContentTitle(div,titleText){var fillingTitleText;fillingTitleText=removeExtraSpace(titleText);div.innerHTML=$STR.encodeHtmlString(fillingTitleText,true);}function makeComb(tids,eids,tps){return eids.map(function(eid,idx){return{eid:eid,tid:tids[idx],tp:tps[idx]};});}function appendSvgShape(svgShape,element){var svgCon=$MUTIL.createSvgNode("svg"),token,eids,tids,tps;$MUTIL.setNodeAttributes(svgCon,{width:14,height:14});$MUTIL.setNodeAttributes(svgCon,{type:INTERACTIVE_TYPE.LGD_COLOR_SVG_CON});$MUTIL.setNodeAttributes(svgShape,{type:INTERACTIVE_TYPE.LGD_COLOR_SVG_SHAPE});$MUTIL.appendNode(svgCon,svgShape);if(this.isColorByAttr){token=element.token;eids=token.elements||[];tids=token.levels||[];tps=token.types||[];svgShape.colorIdentity={comb:makeComb(tids,eids,tps),decodedColor:element.decodedColor,isDefaultColor:element.isDefaultColor};}return svgCon;}function createCircleSvg(element){var svgShape=$MUTIL.createSvgNode("circle");$MUTIL.setNodeAttributes(svgShape,{r:5,cx:7,cy:7,fill:element.decodedColor||element.color,"fill-opacity":element.opacity});return appendSvgShape.call(this,svgShape,element);}function createRectSvg(element){var svgShape=$MUTIL.createSvgNode("rect");$MUTIL.setNodeAttributes(svgShape,{width:10,height:10,x:2,y:2,fill:element.decodedColor||element.color,"fill-opacity":element.opacity});return appendSvgShape.call(this,svgShape,element);}function createDiamondSvg(element){var svgShape=$MUTIL.createSvgNode("rect");$MUTIL.setNodeAttributes(svgShape,{width:8,height:8,x:2.9568542,y:2.9568542,transform:"translate(6.956854, 6.956854) rotate(45.000000) translate(-6.956854, -6.956854) ",fill:element.decodedColor||element.color,"fill-opacity":element.opacity});return appendSvgShape.call(this,svgShape,element);}function createPolygonSvg(element){var svgShape=$MUTIL.createSvgNode("polygon");$MUTIL.setNodeAttributes(svgShape,{points:"3.30359173 3.63001678 9.94312408 1.75 12.5 9.30555556 7 12.4201117 1.5 9.30555556",fill:element.decodedColor||element.color,"fill-opacity":element.opacity});return appendSvgShape.call(this,svgShape,element);}function createPinSvg(element){var svgShape=$MUTIL.createSvgNode("path");$MUTIL.setNodeAttributes(svgShape,{d:"M7,1.25 C4.51836842,1.25 2.5,3.26753947 2.5,5.74810526 C2.5,6.80051316 3.18234211,8.18994737 4.31278947,9.72740789 C5.16684211,10.8888816 6.24542105,12.0607763 6.79039474,12.4630526 L7.00082895,12.6184211 L7.21221053,12.4643553 C7.75765789,12.0669342 8.83564474,10.9003684 9.68946053,9.73960526 C10.81825,8.20486842 11.5,6.81117105 11.5,5.74810526 C11.5,3.26753947 9.48163158,1.25 7,1.25",fill:element.decodedColor||element.color,"fill-opacity":element.opacity});return appendSvgShape.call(this,svgShape,element);}function createTextDiv(text){var textBody=document.createElement("div");$MUTIL.setNodeAttributes(textBody,{"class":"map-legend-text-cell",title:text});textBody.innerHTML=text;return textBody;}function createImageDiv(image){var colorDiv=document.createElement("div");$MUTIL.setNodeAttributes(colorDiv,{"class":"map-legend-color-image-block"});if(image){colorDiv.style.backgroundImage=image;}return colorDiv;}function fillColorByTable(elements,shapeType){var i,n,row,fragment,colorBlockCon,color,element,svg;n=elements.length;fragment=document.createDocumentFragment();for(i=0;i<n;i+=1){element=elements[i];row=document.createElement("div");$MUTIL.setNodeAttributes(row,{"class":"map-legend-content-table-row"});colorBlockCon=document.createElement("div");$MUTIL.setNodeAttributes(colorBlockCon,{"class":"map-legend-color-block-container",type:INTERACTIVE_TYPE.LGD_COLOR_BLOCK_CON});if(!element.image){switch(shapeType){case SHAPE_TYPE.CIRCLE:svg=createCircleSvg.call(this,element);break;case SHAPE_TYPE.PIN:svg=createPinSvg.call(this,element);break;case SHAPE_TYPE.RECT:svg=createRectSvg.call(this,element);break;case SHAPE_TYPE.DIAMOND:svg=createDiamondSvg.call(this,element);break;case SHAPE_TYPE.POLYGON:svg=createPolygonSvg.call(this,element);break;default:svg=createRectSvg.call(this,element);break;}colorBlockCon.appendChild(svg);}else{colorBlockCon.appendChild(createImageDiv(element.image));}row.appendChild(colorBlockCon);row.appendChild(createTextDiv(element.label));fragment.appendChild(row);}return fragment;}function generateSizeByTableRow(sizeByBlockCon,text){var row;row=document.createElement("div");$MUTIL.setNodeAttributes(row,{"class":"map-legend-content-table-row"});row.appendChild(sizeByBlockCon);row.appendChild(createTextDiv(text));return row;}function fillSizeByTable(elements){var maxText,minText,maxSizeBlock,minSizeBlock,maxSizeByBlockCon,minSizeByBlockCon,fragment;fragment=document.createDocumentFragment();minText="Min: "+elements[elements.length-1];minSizeBlock=document.createElement("div");$MUTIL.setNodeAttributes(minSizeBlock,{"class":"map-legend-origin-size-block"});minSizeByBlockCon=document.createElement("div");$MUTIL.setNodeAttributes(minSizeByBlockCon,{"class":"map-legend-size-block-min-container"});minSizeByBlockCon.appendChild(minSizeBlock);maxText="Max: "+elements[0];maxSizeBlock=document.createElement("div");$MUTIL.setNodeAttributes(maxSizeBlock,{"class":"map-legend-origin-size-block"});maxSizeByBlockCon=document.createElement("div");$MUTIL.setNodeAttributes(maxSizeByBlockCon,{"class":"map-legend-size-block-max-container"});maxSizeByBlockCon.appendChild(maxSizeBlock);fragment.appendChild(generateSizeByTableRow.call(this,minSizeByBlockCon,minText));fragment.appendChild(generateSizeByTableRow.call(this,maxSizeByBlockCon,maxText));return fragment;}function getColorBlockContainerTarget(target){var type=target.getAttribute("type");if(type===INTERACTIVE_TYPE.LGD_COLOR_SVG_SHAPE){target=target.parentNode;type=target.getAttribute("type");}if(type===INTERACTIVE_TYPE.LGD_COLOR_SVG_CON){target=target.parentNode;type=target.getAttribute("type");}if(type===INTERACTIVE_TYPE.LGD_COLOR_BLOCK_CON){return target;}return null;}mstrmojo.gmaps.MapSingleLegendContent=mstrmojo.declare(mstrmojo.Vis,[mstrmojo.gmaps._MapLegendInteractivity],{scriptClass:"mstrmojo.gmaps.MapSingleLegendContent",isColorByAttr:false,initTableOffsetHeight:-1,widgetId:null,markupString:'<div class="map-legend-content" mstrAttach:click,mouseover,mouseout,contextmenu><div class="map-legend-content-name"></div><div class="map-legend-content-container"><div class="map-legend-content-table"></div></div></div>',markupSlots:{domLgdContent:function(){return this.domNode;}},postBuildRendering:function postBuildRendering(){this._super();var domLgdContent=this.domLgdContent,contentName=domLgdContent.firstChild,contentTableContainer=domLgdContent.lastChild,contentElementTable=contentTableContainer.firstChild;this.addSlots({contentName:contentName,contentElementTable:contentElementTable});},handleColorBy:function handleColorBy(colorByData,shapeType,isColorByAttr,widgetId){var contentName=this.contentName,contentElementTable=this.contentElementTable;if(isColorByAttr){this.isColorByAttr=isColorByAttr;this.widgetId=widgetId;this.initializePH();}fillContentTitle.call(this,contentName,colorByData.item);contentElementTable.appendChild(fillColorByTable.call(this,colorByData.elements,shapeType));},handleSizeBy:function handleSizeBy(sizeByData){var contentName=this.contentName,contentElementTable=this.contentElementTable;fillContentTitle.call(this,contentName,sizeByData.item);contentElementTable.appendChild(fillSizeByTable.call(this,sizeByData.elements));},onmouseover:function onmouseover(evt){var target=evt.getTarget();if(this.isColorByAttr){target=getColorBlockContainerTarget(target);if(target){$CSS.addClass(target,"hover");}}},onmouseout:function onmouseout(evt){var target=evt.getTarget();if(this.isColorByAttr){target=getColorBlockContainerTarget(target);if(target){$CSS.removeClass(target,"hover");}}},oncontextmenu:function(evt){var target=evt.getTarget(),type=target.getAttribute("type");if(this.isColorByAttr){if(type===INTERACTIVE_TYPE.LGD_COLOR_BLOCK_CON){target=target.firstChild;type=target.getAttribute("type");}if(type===INTERACTIVE_TYPE.LGD_COLOR_SVG_CON){target=target.firstChild;type=target.getAttribute("type");}if(type===INTERACTIVE_TYPE.LGD_COLOR_SVG_SHAPE){evt.cancel();evt.preventDefault();if(mstrApp.isAppStatePresentation()||!mstrApp.allowWebDashboardDesign()||mstrApp.isInVFInteractMode){return ;}this.handleRMCColorPicker(target);}}}});}());