(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.ClusterImage","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.graphic.ClusterGraphic","mstrmojo.array");var SMALL_CNT=10,MEDIUM_CNT=100,IMAGE_SIZE=50;var $MOJO=mstrmojo,$GEOMETRY=$MOJO.gmaps.geometry,GRAPHIC=$MOJO.gmaps.graphic.Graphic,$ARR=$MOJO.array;mstrmojo.gmaps.graphic.ImageClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.ClusterGraphic,null,{scriptClass:"mstrmojo.gmaps.graphic.ImageClusterGraphic",centerCircle:null,textLabel:null,geometry:null,init:function init(props){if(!this._checkProps(props)){return ;}var clusterCount=props.clusterCount,screenData=props.screenData,x=screenData&&screenData.x,y=screenData&&screenData.y,imagePrefix=this._getImageUrlPrefix(),imageColor=this._getImageUrlColor(clusterCount),imageSuffix=this._getImageUrlSuffix(),circle=this.geometry=new $GEOMETRY.ClusterImage({imgUrl:imagePrefix+imageColor+"_rest"+imageSuffix,imgUrlA:imagePrefix+imageColor+"_highlight_a"+imageSuffix,imgUrlB:imagePrefix+imageColor+"_highlight_b"+imageSuffix,imgUrlC:imagePrefix+imageColor+"_highlight_c"+imageSuffix,width:IMAGE_SIZE,height:IMAGE_SIZE,x:x,y:y});this.centerCircle=new GRAPHIC({geometry:circle});this.textLabel=new GRAPHIC({geometry:new $GEOMETRY.Text({setHover:function(isHovered){circle.setHover(isHovered);},text:clusterCount,isCenterAlign:true,x:x,y:y})});this._super(props);this.addSubGraphic(this.centerCircle);this.addSubGraphic(this.textLabel);},_getImageUrlPrefix:function _getImageUrlPrefix(){return $MOJO.getStyleRoot()+"/images/";},_getImageUrlSuffix:function _getImageUrlPrefix(){return"@2x.png";},_getImageUrlColor:function _getImageUrlColor(clusterCount){if(isNaN(clusterCount)){console.log("_getImageUrl(): invalid clusterCount.");return ;}if(clusterCount<SMALL_CNT){return"blue";}if(clusterCount<MEDIUM_CNT){return"orange";}return"red";},_addGraphicIDToNode:function _addGraphicIDToNode(){var graphics=[this.centerCircle,this.textLabel];$ARR.forEach(graphics,function(graphic){var geometry=graphic&&graphic.geometry,node=geometry&&geometry.node;if(node){node.graphicID=this.id;}},this);},setHover:function setHover(isHovered){var geometry=this.geometry;if(geometry){geometry.setHover(isHovered);}},setIsSelected:function setIsSelected(isSelected){var points=this.points;if(!points||points.length<=0){return ;}$ARR.forEach(points,function(point){var attributes=point.attributes;if(!attributes){point.attributes={};}attributes._isSelected=isSelected;});},isSelected:function isSelected(){var points=this.points,result=true;if(!points||points.length<=0){return false;}$ARR.forEach(points,function(point){var attributes=point.attributes;if(!attributes||!attributes._isSelected){result=false;return false;}});return result;},matchLocationName:function matchLocationName(matchPattern){if(!matchPattern){return false;}var re=new RegExp(matchPattern,"i"),result=[];$ARR.forEach(this.points,function(point){if(point){var geoName=point.attributes&&point.attributes.geoName;if(geoName&&re.test(geoName)){result.push(new GRAPHIC({attributes:point.attributes,geometry:new $GEOMETRY.Point(point.geoData)}));}}});return result;},getGraphicsForSelection:function getGraphicsForSelection(){return[this];},isClusterGraphic:function isClusterGraphic(){return true;},destroy:function destroy(ignoreDOM){this.centerCircle=null;this.textLabel=null;this.geometry=null;this._super(ignoreDOM);}});}());