(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.Button","mstrmojo.VBox","mstrmojo.HBox","mstrmojo.TextBox","mstrmojo.css");mstrmojo.requiresDescs(118,221,246,531,629,7778,14900,15038,15039,15040,15041,15360,15043,15044,15045,15046,15047,15048,15049,15050,15064,15082,15202,6138,15369);var constants=mstrmojo.DI.DIConstants,$STR=mstrmojo.string,$A=mstrmojo.array,$H=mstrmojo.hash,$DOM=mstrmojo.dom,$C=mstrmojo.css,$HTTP="http://",$HTTPS="https://",$IMAGEPREFIX="data:image",$imageNodePrefix="mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imageNode ",$HELPER=mstrmojo.DI.DIHelpers,$CSSHELPER=mstrmojo.css,$MARKPLACE_URL=constants.sdkUrl.MARKPLACE_URL;$SEPARATOR_INTRODUCTION="#DESCRIPTION#INTRODUCTION#";var accept=["image/jpeg","image/bmp","image/png"];var $MODE_ITEMS=[{did:constants.authMode.ANONYMOUS,n:mstrmojo.desc(7778,"Anonymous"),prefix:constants.authModePrefix.ANONYMOUS},{did:constants.authMode.USERNAME,n:mstrmojo.desc(14900,"Username and Password"),prefix:constants.authModePrefix.USERNAME},{did:constants.authMode.OAUTH,n:mstrmojo.desc(15038,"OAuth"),prefix:constants.authModePrefix.OAUTH}];function generateLabelControl(boxAlias,text,controls,textCss){return{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-box",alias:boxAlias,children:[{scriptClass:"mstrmojo.Label",cssClass:textCss?textCss:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-label",alias:"label",text:text,useRichTooltip:true,updateTooltipConfig:function(){var pos=$DOM.position(this.domNode);this.set("richTooltip",{cssClass:"vi-regular V-center vi-tooltip-V",top:Math.max(pos.y,0),left:Math.max(pos.x+pos.w/2,0),posType:mstrmojo.tooltip.POS_BOTTOMCENTER,content:this.text});}}].concat(controls)};}function generateTextBox(tbAlias,tbCss){return{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:tbAlias,onvalueChange:function(){if(this._super){this._super();}setButtonEnabled(this.parent.parent.parent);}};}function showExtraSetting(detail,userText,pwdText){var user=detail.userNode,pwd=detail.pwdNode;user.domNode.setAttribute("style","mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-extraSetting");user.label.set("text",userText);user.tbUser.set("value","");pwd.domNode.setAttribute("style","mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-extraSetting");pwd.label.set("text",pwdText);pwd.tbPwd.set("value","");}function saveFile(value,type,name){value=window.btoa(value);var blob;if(typeof window.Blob=="function"||"object"){blob=new Blob([value],{type:type});}else{var BlobBuilder=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.Blob;var bb=new BlobBuilder();bb.append(value);blob=bb.getBlob(type);}var URL=window.URL||window.webkitURL;var bloburl=URL.createObjectURL(blob);var anchor=document.createElement("a");if("download" in anchor){anchor.style.visibility="hidden";anchor.href=bloburl;anchor.download=name;document.body.appendChild(anchor);var evt=document.createEvent("MouseEvents");evt.initEvent("click",true,true);anchor.dispatchEvent(evt);document.body.removeChild(anchor);}else{if(navigator.msSaveBlob){navigator.msSaveBlob(blob,name);}else{location.href=bloburl;}}}function collapseEditor(editor){var fileBox=editor.fileBox,collapse=editor.collapseBox.collapse,detailInfo=editor.detailInfo,arrow=editor.collapseBox.arrow;detailInfo.set("visible",false);$C.toggleClass(fileBox.dnDNode,"expanded",false);editor.isExpand=false;$C.toggleClass(collapse.domNode,"expanded",false);$C.toggleClass(editor.buttonNode,"expanded",false);}function expandEditor(editor){var fileBox=editor.fileBox,collapse=editor.collapseBox.collapse,detailInfo=editor.detailInfo,arrow=editor.collapseBox.arrow;collapse.set("text",mstrmojo.desc(15304,"Collapse connector information"));detailInfo.set("visible",true);$C.toggleClass(fileBox.dnDNode,"expanded",true);editor.isExpand=true;$C.toggleClass(collapse.domNode,"expanded",true);$C.toggleClass(editor.buttonNode,"expanded",true);}function setParameters(editor){var info=editor.detailInfo;info.nameNode.tbName.set("value",editor.name);!mstrApp.diParams.Admin&&info.nameNode.tbName.domNode.setAttribute("readonly","readonly");info.urlNode.tbURL.set("value",editor.url);info.descNode.tbDesc.set("value",editor.desc);info.introductionNode.tbIntroduction.set("value",editor.introductionUrl);var imgNode=info.iconNode.imageNode;if(editor.iconData&&mstrmojo.string.startsWith(editor.iconData,$IMAGEPREFIX)){imgNode.set("src",editor.iconData);}else{imgNode.set("src","");}if(editor.oid===constants.originalConnector.elastic){info.iconNode.backgroundImage='url("images/DI/icons.svg") -3250px -200px no-repeat';}else{if(editor.oid===constants.originalConnector.tapClicks){info.iconNode.backgroundImage='url("images/DI/tapClicks.png") 0px 0px no-repeat';}}info.typeNode.type.set("selectedIndex",editor.type);info.userNode.tbUser.set("value",editor.user);info.pwdNode.tbPwd.set("value",editor.pwd);}function setButtonVisible(btn,visible){btn.set("enabled",visible);btn.set("visible",visible);}function showButtons(btns,isNew){if($HELPER.isLocalWS()){setButtonVisible(btns.btnDelete,!isNew);}else{setButtonVisible(btns.btnDelete,!isNew&&mstrApp.diParams.Admin&&mstrApp.diParams.AccessDataFromFiles);}setButtonVisible(btns.btnExport,!isNew);setButtonVisible(btns.btnSave,!isNew);setButtonVisible(btns.btnAdd,isNew);}function setDatas(editor,item){var info=editor.detailInfo,ctrl=mstrApp.getRootController(),model=ctrl.getModel();if(item.oid===undefined||$A.find(model.sourceItems,"oid",item.oid)<0){info.nameNode.tbName.set("value",item.name);info.urlNode.tbURL.set("value",item.url);info.descNode.tbDesc.set("value",item.desc);info.introductionNode.tbIntroduction.set("value",!!item.introductionUrl?item.introductionUrl:"");info.iconNode.imageNode.domNode.style.backgroundImage="";if(mstrmojo.string.startsWith(item.iconData,$IMAGEPREFIX)){info.iconNode.imageNode.set("src",item.iconData);}else{info.iconNode.imageNode.set("src","");}editor.iconData=item.iconData;editor.oid=item.oid;info.typeNode.type.set("selectedIndex",item.type);info.userNode.tbUser.set("value",item.user);expandEditor(editor);}else{resetFilebox(editor.fileBox);ctrl.displayError(mstrmojo.desc(15082,"The connector you selected is already added"));}}function readFile(editor,file){var reader=new FileReader(),info=editor.detailInfo,ctrl=mstrApp.getRootController(),model=ctrl.getModel(),item;reader.onload=function(event){if($HELPER.isLocalWS()){info.typeNode.type.set("enabled",false);editor.isMstrcc=true;}item=JSON.parse(window.atob(event.target.result));setDatas(editor,item);};reader.readAsText(file);}function loadImage(editor,file){if(file.size>48*1<<10){mstrApp.getRootController().displayError(mstrmojo.desc(15360,"Please upload the image whose size no more than ##KB, we support ### format.").replace("###","jpg, jpeg, png, bmp").replace("##","48"));return false;}var type=file.type,valid=false,info=editor.detailInfo;if($HELPER.isLocalWS()){type=file.data.split(";")[0].split(":")[1];}$A.forEach(accept,function(a){if(type===a){if($HELPER.isLocalWS()){info.iconNode.imageNode.set("src",file.data);editor.iconData=file.data;}else{var image=new Image(),reader=new FileReader();reader.onload=function(event){editor.iconData=image.src=event.target.result;image.onload=function(){var imgNode=editor.detailInfo.iconNode.imageNode;imgNode.set("src",window.URL.createObjectURL(file));imgNode.domNode.style.backgroundImage="";setButtonEnabled(editor);};};reader.readAsDataURL(file);}valid=true;return false;}});if(!valid){mstrApp.getRootController().displayError(mstrmojo.desc(15064,"Please select another image.\n The image size should be not larger than ## KB, and we only support ### format").replace("###","jpg, jpeg, png, bmp").replace("##","48"));return false;}}function generateDBRoleInfo(editor,oid,isNew,isMstrcc){var info=editor.detailInfo,type=info.typeNode.type,item=type.items[type.selectedIndex],dbRoleInfo;dbRoleInfo={tp:29,stp:7430,writable:"1",shared:"1",dbr_type:"7",owned:"1",db_type:constants.dbType.newConnector,cefu:1,driverMode:1,dbms:constants.newConnectorDBMSId,n:info.nameNode.tbName.value,connstr:item.prefix+info.urlNode.tbURL.value.trim()+";",des:info.descNode.tbDesc.value+$SEPARATOR_INTRODUCTION+info.introductionNode.tbIntroduction.value,iconData:window.btoa(editor.iconData===""?"default":editor.iconData),newly_created:0,};if(isMstrcc){dbRoleInfo.importFromMstrcc=1;}if(item.did!==constants.authMode.ANONYMOUS){dbRoleInfo.ln=info.userNode.tbUser.value;dbRoleInfo.password=info.pwdNode.tbPwd.value;}if(oid){dbRoleInfo.did=oid;if(isNew){dbRoleInfo.newly_created=1;}}return JSON.stringify(dbRoleInfo);}function CheckStr(str){var myReg=/^[^@\/\'\\\"#$%&\^\*]+$/;if(myReg.test(str)){return true;}return false;}function validation(editor){var info=editor.detailInfo,name=$STR.trim(info.nameNode.tbName.value),url=$STR.trim(info.urlNode.tbURL.value),type=info.typeNode.type.selectedIndex,user=info.userNode.tbUser.value,pwd=$STR.trim(info.pwdNode.tbPwd.value);if(!name.length||!CheckStr(name)||!($STR.startsWith(url,"http://")||$STR.startsWith(url,"https://"))){return false;}if(($STR.startsWith(url,$HTTP)&&url.length===$HTTP.length)||($STR.startsWith(url,$HTTPS)&&url.length===$HTTPS.length)){return false;}if(type===constants.authMode.USERNAME&&user.length===0){return false;}else{if(type===constants.authMode.OAUTH&&user.length===0){return false;}}return true;}function setButtonEnabled(editor){var btns=editor.btnHbox,enabled=validation(editor);if(editor.isNew){btns.btnAdd.set("enabled",enabled);$C.toggleClass(editor.buttonNode,"edit",false);}else{$C.toggleClass(editor.buttonNode,"edit",true);btns.btnExport.set("enabled",enabled);if($HELPER.isLocalWS()){btns.btnSave.set("enabled",enabled);}else{btns.btnSave.set("enabled",enabled&&mstrApp.diParams.Admin&&(mstrApp.diParams.AccessDataFromFiles===1));}}}function switchFilebox(editor,filename){var current=document.getElementById(editor.id+"_browseGallery");if(current.style.visibility==="visible"){current.style.visibility="hidden";}current=document.getElementById(editor.id+"_separator");if(current.style.visibility==="visible"){current.style.visibility="hidden";}var selectButton=document.getElementById(editor.id+"_selectButton");selectButton.innerHTML=mstrmojo.desc(190,"Remove");selectButton.setAttribute("onclick","document.getElementById('"+editor.id+"_fileRemove').click()");document.getElementById(editor.id+"_descStr").innerHTML=mstrmojo.desc(null,"Now Connector for "+filename);document.getElementById(editor.id+"_fileHolder").style.border="1px solid #B5B5B5";}function resetFilebox(editor){var current=document.getElementById(editor.id+"_browseGallery");if(current.style.visibility==="hidden"){current.style.visibility="visible";}current=document.getElementById(editor.id+"_separator");if(current.style.visibility==="hidden"){current.style.visibility="visible";}var selectButton=document.getElementById(editor.id+"_selectButton");selectButton.innerHTML=mstrmojo.desc(15049,"Select a file…");selectButton.setAttribute("onclick","document.getElementById('"+editor.id+"_fileSelect').click()");document.getElementById(editor.id+"_descStr").innerHTML=mstrmojo.desc(15048,"Drag the connector file (.mstrcc) here or");document.getElementById(editor.id+"_fileHolder").style.border="1px dashed #B5B5B5";var detail=editor.parent.detailInfo;detail.nameNode.tbName.set("value","");detail.urlNode.tbURL.set("value","");detail.descNode.tbDesc.set("value","");detail.introductionNode.tbIntroduction.set("value",""),detail.iconNode.imageNode.set("src","");detail.typeNode.type.set("enabled",true);detail.typeNode.type.set("selectedIndex","0");editor.isMstrcc=false;}function duplicateNameCheck(name,list){for(var i=0;i<list.length;i++){if(list[i].n===name&&list[i].pageType===constants.pageType.newConnector){return true;}}return false;}mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog",title:"",showTitle:true,sourceInfo:null,help:"How_to_Add_a_Custom_Connector.htm",pageType:null,subtype:null,isContainHadoop:false,items:null,isNew:true,name:"",url:"",desc:"",introductionUrl:"",iconData:"",oid:"",type:constants.authMode.ANONYMOUS,user:"",pwd:"",isExpend:false,isMstrcc:false,children:[{scriptClass:"mstrmojo.DI.FileDragDropBox",alias:"fileBox",preBuildRendering:function preBuildRendering(){if(this._super){this._super();}this.markupString='<div><form target="{@id}_iframe" enctype="multipart/form-data" method="post" action="taskProc"><div id="{@id}_fileHolder" class="mstrmojo-di-fileHolder {@cssClass}" style="width:439px; margin:11px 0px 0px 0px;" mstrAttach:dragover,dragend,drop><div><table><tbody><tr><td><div id="{@id}_fileIcon" style="height:60px; width:60px; background-image:url(../javascript/mojo/css/images/DI/icons.svg); background-position:-700px -10px; margin:30px 0px 30px 91px" /></td><td><table><tbody><tr><td colspan = "3"><div id="{@id}_descStr"  style="padding:11px 0px 0px 7px; font-size:12px; color:#444649; line-height:18px; ">'+mstrmojo.desc(15048,"Drag the connector file (.mstrcc) here or")+'</div></td></tr><tr><td><div id="{@id}_selectButton" style="padding-left:7px; font-si: ;ze:12px; color:#3B92ED; line-height:18px; " onclick="document.getElementById(\'{@id}_fileSelect\').click()";>'+mstrmojo.desc(15049,"Select a file…")+'</div><input id="{@id}_fileSelect" type="file" style="display:none" accept=".mstrcc" mstrAttach:change,click/><input id="{@id}_fileRemove" type="button" style="display:none"  mstrAttach:click/></td><td id="{@id}_separator" style="visibility : visible">|</td><td><div id="{@id}_browseGallery" style="padding-left:16px; font-si: ;ze:12px; color:#3B92ED; line-height:18px; visibility : visible" type="button" mstrAttach:click";>'+mstrmojo.desc(15369,"Browse Gallery")+'</div></td></tr></tbody></table></td></tr></tbody></table></div><div></div><div></div></div><div></div><div><div><div></div></div></div><div style="display:none;"></div></form><iframe id="{@id}_iframe" + name="{@id}_iframe" style="display:none;" src="about:blank"></iframe></div>';},onchange:function onchange(){var input=document.getElementById(this.id+"_fileSelect"),files=input&&input.files;if(files[0]){readFile(this.parent,files[0]);}switchFilebox(this,files[0].name);input.value="";},ondrop:function ondrop(evt){if(!this.droppable){return ;}var e=evt.e;e.preventDefault();var files=e.dataTransfer.files;if(files){readFile(this.parent,files[0]);}switchFilebox(this,files[0].name);},onclick:function onclick(evt){if(evt.e.currentTarget.id===this.id+"_browseGallery"){if($HELPER.isWS()){window.FormWrapper.openPage($MARKPLACE_URL);}else{window.open($MARKPLACE_URL);}}else{if(evt.e.currentTarget.id===this.id+"_fileRemove"){resetFilebox(this);}}},},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-expend-box",alias:"collapseBox",children:[{scriptClass:"mstrmojo.Image",alias:"arrow",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-arrow up"},{scriptClass:"mstrmojo.Label",alias:"collapse",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-collapse",text:mstrmojo.desc(15305,"Manually enter connection details"),onclick:function(){var editor=this.parent.parent;if(editor.detailInfo.visible){collapseEditor(editor);}else{expandEditor(editor);}}}]},{scriptClass:"mstrmojo.VBox",alias:"detailInfo",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-information",children:[generateLabelControl("nameNode",mstrmojo.desc(15043,"Connector Name"),[generateTextBox("tbName")]),generateLabelControl("urlNode",mstrmojo.desc(15044,"Input a URL"),[generateTextBox("tbURL")]),generateLabelControl("descNode",mstrmojo.desc(8680,"Description"),[{scriptClass:"mstrmojo.TextArea",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text Desc",alias:"tbDesc",maxLength:255}],"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-tbDesclabel"),generateLabelControl("introductionNode",mstrmojo.desc(15202,"Introduction Page"),[generateTextBox("tbIntroduction")]),generateLabelControl("iconNode",mstrmojo.desc(15045,"Connector Icon"),[{scriptClass:"mstrmojo.Image",alias:"imageNode",bindings:{cssClass:function(){if(this.parent.parent.parent.oid===constants.originalConnector.elastic){return $imageNodePrefix+"Elastic_Connector";}else{if(this.parent.parent.parent.oid===constants.originalConnector.tapClicks){return $imageNodePrefix+"TapClicks_Connector";}else{return this.parent.parent.parent.isNew?$imageNodePrefix+"new":$imageNodePrefix+"edit";}}}},onsrcChange:function(){mstrmojo.Image.prototype.markupMethods.onsrcChange.call(this);if(this.src){$CSSHELPER.addClass(this.imgNode.parentNode,"bgtransparent");}else{$CSSHELPER.removeClass(this.imgNode.parentNode,"bgtransparent");}},imgCssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imageNode-img"},{scriptClass:"mstrmojo.VBox",children:[{scriptClass:"mstrmojo.CheckBox",label:mstrmojo.desc(15046,"Select an image..."),preBuildRendering:function preBuildRendering(){if(this._super){this._super();}this.markupString='<span><input type="file" style="display:none" accept=".jpeg,.jpg,.bmp,.png" mstrAttach:change/><label class="mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-imagelabel" mstrAttach:click>{@label}</label></span>';},onclick:function(){if($HELPER.isLocalWS()){var formWrapper=window.FormWrapper;formWrapper.openImageFileDialog("mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierImageSelected");var workstationResponseEvt=mstrApp.getRootController().model.attachEventListener("getSdkImageDossier",this.id,function(evt){var editor=this.parent.parent.parent.parent;if(evt.data){loadImage(editor,evt.data);}});}else{this.inputNode.click();}},onchange:function(){var input=this.inputNode,files=input.files,editor=this.parent.parent.parent.parent;if(files){loadImage(editor,files[0]);}input.value="";if(input.value!=""){var newInput=input.cloneNode(true);input.parentNode.appendchild(newInput);if(input.removeNode){input.removeNode(true);}}}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15042,"Please upload the image whose size no more than ##KB, we support ### format.").replace("###","jpg, jpeg, png, bmp").replace("##","48"),cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-upload"}]}],"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-tbDesclabel"),generateLabelControl("typeNode",mstrmojo.desc(15047,"Credential Type"),[{scriptClass:"mstrmojo.ui.Pulldown",items:$MODE_ITEMS,cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:"type",postBuildRendering:function(){mstrmojo.ui.Pulldown.prototype.postBuildRendering.apply(this,arguments);var popup=this.list.adjustCornersForPopupOverflow;this.list.adjustCornersForPopupOverflow=function(){popup.call(this);this.domNode.style.top="calc(100% - 124px)";};},postselectedIndexChange:function(evt){var detail=this.parent.parent,newValue=evt.value,oldValue=evt.valueWas,item=this.items[newValue];if(newValue!==oldValue){switch(item&&item.did){case constants.authMode.USERNAME:showExtraSetting(detail,"User Name","Password");break;case constants.authMode.OAUTH:showExtraSetting(detail,"Client ID","Client Secret");break;default:detail.userNode.domNode.style.display="none";detail.pwdNode.domNode.style.display="none";}}if(constants.authMode.USERNAME==(item&&item.did)||constants.authMode.OAUTH==(item&&item.did)){detail.parent.isNew?detail.pwdNode.children[1].inputNode.setAttribute("placeholder",""):detail.pwdNode.children[1].inputNode.setAttribute("placeholder","********");}setButtonEnabled(detail.parent);}}]),generateLabelControl("userNode","User Name",[generateTextBox("tbUser")]),generateLabelControl("pwdNode","Password",[{scriptClass:"mstrmojo.TextBox",cssClass:"mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-detailInfo-text normal",alias:"tbPwd",type:"password",onvalueChange:function(){if(this._super){this._super();}setButtonEnabled(this.parent.parent.parent);}}])]}],buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIAddCustomConnectorDialog-btnDelete",text:mstrmojo.desc(629,"Delete"),alias:"btnDelete",enabled:false,onclick:function(){var editor=this.parent.parent,controller=mstrApp.getRootController(),oid=editor.oid;var msg=mstrmojo.desc(15041,"Do you want to delete this connector?");mstrmojo.confirm(msg,{confirmBtn:{fn:function(){controller.getDataService().deleteDBRole({success:function success(res){var model=controller.getModel(),index=$A.find(model.sourceItems,"oid",oid),indexForSourceList=$A.find(model.sourceList,"oid",oid);$A.removeIndices(model.sourceItems,index,1);$A.removeIndices(model.sourceList,indexForSourceList,1);editor.close();controller.showPage(constants.pageType.dataSelection);},failure:function failure(res){mstrApp.getRootController().displayError(res.message);}},{objectid:oid,objecttype:29});}}});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(246,"Export"),alias:"btnExport",enabled:false,onclick:function(){var editor=this.parent.parent,info=editor.detailInfo,name=info.nameNode.tbName.value,strValue=JSON.stringify({name:name,url:info.urlNode.tbURL.value,desc:info.descNode.tbDesc.value,introductionUrl:info.introductionNode.tbIntroduction.value,iconData:editor.iconData,type:info.typeNode.type.selectedIndex,user:info.userNode.tbUser.value,oid:editor.oid});if($HELPER.isWS()){window.FormWrapper.saveConnectorFile(window.btoa(strValue));}else{saveFile(strValue,"text/latex",name+".mstrcc");}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(118,"Save"),alias:"btnSave",enabled:false,onclick:function(){var editor=this.parent.parent,info=editor.detailInfo,controller=mstrApp.getRootController(),oid=editor.oid,oldName=editor.name,newName=info.nameNode.tbName.value;if(oldName!==newName&&duplicateNameCheck(newName,controller.getModel().sourceItems)){mstrApp.getRootController().displayError(mstrmojo.desc("6138","Cannot create object because the name is in use. Please use a different name."));return ;}controller.getDataService().saveDBRole({success:function success(res){var model=controller.getModel(),index=$A.find(model.sourceItems,"oid",oid),item=model.sourceItems[index];item=$H.copy({n:info.nameNode.tbName.value,url:info.urlNode.tbURL.value.trim(),connectorDesc:info.descNode.tbDesc.value,introductionUrl:info.introductionNode.tbIntroduction.value,iconData:editor.iconData,type:info.typeNode.type.selectedIndex,user:info.userNode.tbUser.value,pwd:info.pwdNode.tbPwd.value},item);editor.close();controller.showPage(constants.pageType.dataSelection);},failure:function failure(res){mstrApp.getRootController().displayError(res.message);}},{dbroleinfo:generateDBRoleInfo(editor,oid)});editor.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(531,"Add"),alias:"btnAdd",enabled:true,onclick:function(){var editor=this.parent.parent,info=editor.detailInfo,controller=mstrApp.getRootController();if(duplicateNameCheck(info.nameNode.tbName.value,controller.getModel().sourceItems)){mstrApp.getRootController().displayError(mstrmojo.desc("6138","Cannot create object because the name is in use. Please use a different name."));return ;}controller.getDataService().saveDBRole({success:function success(res){var model=controller.getModel(),oid=res.dbr.did;if($A.find(model.sourceItems,"oid",oid)<0){var tempObj,itemName=info.nameNode.tbName.value,itemUrl=info.urlNode.tbURL.value.trim(),user=info.userNode.tbUser.value;tempObj=$H.copy(model.customConnector,tempObj);model.sourceItems.push($H.copy({n:itemName,url:itemUrl,connectorDesc:info.descNode.tbDesc.value,introductionUrl:info.introductionNode.tbIntroduction.value,iconData:editor.iconData,oid:oid,type:info.typeNode.type.selectedIndex,user:user,pwd:info.pwdNode.tbPwd.value},tempObj));model.sourceList.push({n:itemName,url:itemUrl,oid:oid,user:user,pageType:constants.pageType.newConnector,initial:/[a-z]/i.test(itemName.charAt(0))?itemName.charAt(0).toUpperCase():"Others",checkConectivity:true,dbObjectsDisplayOptions:8,tags:["Customized"],oneTier:true,privilege:constants.privilegeType.accessDatabase,title:function(){var title="";if(!mstrApp.diParams.EnableURLImport){title=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){title=mstrmojo.desc(12751,"Disabled as the user does not have any &quot;Web Import Database&quot; privileges");}}return title;},isEnabled:function(){return mstrApp.diParams.EnableURLImport;},sourceInfo:{sourceType:constants.sourceType.bisource,name:"New connector",type:500,subtype:constants.sourceSubtype.bisource}});model.sourceList.sort(function(a,b){var tmpA=a.n,tmpB=b.n,A1=tmpA.charAt(0),B1=tmpB.charAt(0),capitalizeFirstLetter=function(str){return str.charAt(0).toUpperCase()+str.slice(1);};tmpA=capitalizeFirstLetter(tmpA);tmpB=capitalizeFirstLetter(tmpB);if(/[a-z]/i.test(A1)&&!/[a-z]/i.test(B1)){return -1;}else{if(!/[a-z]/i.test(A1)&&/[a-z]/i.test(B1)){return 1;}else{if(tmpA>tmpB){return 1;}else{if(tmpA<tmpB){return -1;}else{return 0;}}}}});}editor.close();info.iconNode.imageNode.set("src","");controller.showPage(constants.pageType.dataSelection);},failure:function failure(res){mstrApp.getRootController().displayError(res.message);}},{dbroleinfo:generateDBRoleInfo(editor,editor.oid,true,editor.isMstrcc)});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"btnCancel",enabled:true,onclick:function(){var editor=this.parent.parent;editor.close();}}],open:function open(opener,config){if(this._super){this._super(opener,config);}var info=this.detailInfo,fileBox=this.fileBox,collapse=this.collapseBox.collapse;if(this.isNew){this.fileBox.set("visible",true);collapseEditor(this);showButtons(this.btnHbox,true);resetFilebox(this.fileBox);collapse.set("visible",true);this.collapseBox.domNode.style.display="table";}else{if(!mstrApp.diParams.Admin&&!$HELPER.isLocalWS()){this.fileBox.set("visible",false);this.collapseBox.domNode.style.display="none";$C.toggleClass(this.editorNode,"common-user",true);}expandEditor(this);showButtons(this.btnHbox,false);}setParameters(this);if($HELPER.isLocalWS()){this.detailInfo.nameNode.tbName.domNode.removeAttribute("readOnly");}},close:function close(config){if(this._super){this._super(config);}}});mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierImageSelected=function(res){if(res&&res.data&&res.filename){mstrApp.getRootController().model.raiseEvent({name:"getSdkImageDossier",data:res});}};mstrmojo.DI.ui.dialogs.DIAddCustomConnectorDialog.onOneTierFileSelected=function(res){if(res&&res.data&&res.filename){mstrApp.getRootController().model.raiseEvent({name:"getSdkFileDossier",data:res});}};}());