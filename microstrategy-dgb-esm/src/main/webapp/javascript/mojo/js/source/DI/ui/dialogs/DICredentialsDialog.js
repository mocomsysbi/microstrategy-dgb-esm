(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.WidgetTree","mstrmojo.Container","mstrmojo._DocToolbarActions","mstrmojo.DI.DIDatabaseHelper","mstrmojo.DI.DIHelpers","mstrmojo.onetier.vi.ui.DBCredentialEditor");mstrmojo.requiresDescs(221,3958,4444,7776,8516,8519,8533,8534,8541,8545,8552,8553,8556,8558,8560,8561,8708,9149,9213,10056,10058,10059,10062,12450,12991,12995,12997,12998,13107,13223,13224,13225,13980,13981,15517,14285,14286,14287,14328);var $ARR=mstrmojo.array;var $HASH=mstrmojo.hash;var $DI_DATABASE_HELP=mstrmojo.DI.DIDatabaseHelper;var $DI_HELP=mstrmojo.DI.DIHelpers;var MAX_NAME_LENGTH=30,getName=function(item){return item.name||item.n;},LeafRenderer=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsTable",data:null,cssClass:"dataset-table",markupString:'<div id="{@id}" class="cf {@cssClass}" ><div class="dataset-table-status"></div><div></div><div></div></div>',markupSlots:{tableNode:function(){return this.domNode.children[1];},statusNode:function(){return this.domNode.children[0];},buttonNode:function(){return this.domNode.children[2];}},children:[{scriptClass:"mstrmojo.Label",slot:"tableNode",bindings:{text:function(){var tableName=getName(this.parent.data);if(tableName.length>MAX_NAME_LENGTH){tableName=tableName.substr(0,MAX_NAME_LENGTH)+"...";}return tableName;},title:function(){var tooltip="",titleName=getName(this.parent.data);if(titleName.length>MAX_NAME_LENGTH){tooltip=titleName;}return tooltip;},cssClass:function(){var css="table-font-credentials-not-fetched";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.domNode,css);css="";}else{mstrmojo.css.addClass(this.domNode,css);}return"dataset-table-name "+css;}}},{scriptClass:"mstrmojo.Label",slot:"statusNode",tableStatusClass:{"0":"","1":"waiting","2":"finished","3":"warning"},bindings:{cssClass:function(){var css;if(this.parent.data.credentialsFetched){css=this.tableStatusClass[2];}else{if(this.parent.data.credentialsFetched===false){css=this.tableStatusClass[3];}else{css=this.tableStatusClass[0];}}mstrmojo.css.addClass(this.domNode,css);return css;}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",bindings:{text:function(){return this.parent.data.credentialsFetched?mstrmojo.desc(14286,"Edit Credentials"):mstrmojo.desc(14287,"Input Credentials");},innerIconClass:function(){var css="button-font-input";if(this.parent.data.credentialsFetched===true){mstrmojo.css.removeClass(this.textNode,css);css="";}else{mstrmojo.css.addClass(this.textNode,css);}return css;},visible:function(){return this.parent.idx===0;}},slot:"buttonNode",onclick:function(){var me=this.parent,source=me.data,tableIDs=[source.did],rootController=mstrApp.getRootController(),srcType=$DI_DATABASE_HELP.getOASTFromBEST(source.dict);if(srcType>=0){if(!(document.location.protocol.indexOf("https")>-1||mstrApp.isSingleTier||$DI_HELP.isServerBasedWS())){mstrmojo.alert(mstrmojo.desc(15600,"We are unable to connect to this data source because your web server is not set up for HTTPS connections. Please contact your administrator."));return ;}var controller=rootController;if(!(rootController instanceof mstrmojo.DI.DIRootController)){var config={model:mstrmojo.all.CDDIModel||new mstrmojo.DI.DIModel({id:"CDDIModel"}),scriptClass:"mstrmojo.DI.DIRootController"};controller=rootController.CDDIcontroller=mstrmojo.insert(config);controller.addDisposable(mstrmojo.all.CDDIModel);me.addDisposable(controller);controller.oAuthController=new mstrmojo.DI.controller.DIOAuthController();controller.dataService=new mstrmojo.DI.DIDataService();controller.model.populateExternalSources();}controller.setTableIDsForOAuth(tableIDs);controller.gotoOAuthLogin(srcType,null,null,{success:function(){source.set("credentialsFetched",true);}});}else{var dbmsObj=source.dbRole.dbmsObj;if(dbmsObj.DBInfo.driverInstalled){new mstrmojo.onetier.vi.ui.DBCredentialEditor({data:source,zIndex:this.parent.parent.tree.parent.zIndex+1}).open();}else{mstrmojo.alert(mstrmojo.desc(14328,"There is no driver installed for ##. Please install it and try again.").replace("##",dbmsObj.n));}}}}]});var DSM={IN_MEMORY:1,DIRECT_ACCESS:2};function filterDisplayDatasets(datasets){var ret=[];$ARR.forEach(datasets,function(e){if(e.dsm===DSM.IN_MEMORY){return ;}var ds=$HASH.copy(e);ds.tables=$ARR.filter(ds.tables,function(t){return !!t.dbRole;});if(ds.tables.length){ret.push(ds);}});return ret;}mstrmojo.DI.ui.dialogs.DICredentialsDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DICredentialsDialog",title:mstrmojo.desc(14285,"Connection Information"),cssClass:"mstrmojo-di-credentials-dialog",buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(8708,"OK"),alias:"okButton",onclick:function(){var editor=this.parent.parent,ret=true;if(editor.onOK){ret=editor.onOK();}if(ret){editor.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),alias:"cancelButton",onclick:function(){var editor=this.parent.parent,ret=true;if(editor.onCancel){ret=editor.onCancel();}if(ret){editor.close();}}}],onOpen:function(){var items=this.filterDatasets?filterDisplayDatasets.call(this,this.model.datasets):this.model.datasets;this.set("items",items);if(this._super){this._super();}},onOK:function(){mstrApp.getRootController().wrapUpDataImport();this.onOkAction=true;return true;},onCancel:function(){if(mstrApp.isSingleTier){mstrApp.serverRequest({taskId:"authenticationCancelled"},null,{doNotHold:true});}return true;},onClose:function(){window.setTimeout(function(){if(mstrApp.container){mstrApp.container.close();}},0);if(!mstrApp.isSingleTier&&!this.onOkAction){mstrmojo._DocToolbarActions.close.call({model:{mid:mstrApp.docModelData.mid,bs:mstrApp.docModelData.bs}});}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-tablestatuslist-title",text:mstrmojo.desc(15517,"Please enter credentials used to create these datasets in order to access the following datasets in the dossier:")},{scriptClass:"mstrmojo.WidgetTree",bindings:{items:"this.parent.items"},itemIdField:"did",itemDisplayField:"name",itemChildrenField:"tables",cssClass:"datasets-list",itemFunction:function ifn(item,idx,w){var tree=w.tree||w;return new mstrmojo.TreeNode({idx:idx,data:item,state:1,parent:w,tree:tree,multiSelect:w.multiSelect,text:item[w.itemDisplayField],textCssClass:tree.item2textCss(item),items:item[w.itemChildrenField],itemIdField:w.itemIdField,itemDisplayField:w.itemDisplayField,itemIconField:w.itemIconField,itemChildrenField:w.itemChildrenField,itemFunction:function(item,idx,w){return new LeafRenderer({idx:idx,data:item,parent:w});},listSelector:w.listSelector});}}]});}());