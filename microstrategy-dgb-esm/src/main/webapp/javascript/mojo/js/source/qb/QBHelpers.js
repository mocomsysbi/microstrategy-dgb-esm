(function(){mstrmojo.requiresCls("mstrmojo.DI.ui.dialogs.DISaveAsDialog","mstrmojo.Button","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(221,1442,3415,3416,12376,12377,12925,14438,15065,15066,15066);var $DESC=mstrmojo.desc,$H=mstrmojo.DI.DIHelpers,$NWB=mstrmojo.Button.newWebButton;var QB_SAVEAS_DIALOG_ID;mstrmojo.qb.QBHelpers={showSaveAsDialog:function showSaveAsDialog(callback,defaultNameObj){var ERR_OK=0,ERR_INVALID_NAME=-1,ERR_EXISTING_NAME=-2;var dialog,openNativeTaskParams={};if($H.isServerBasedWS()&&callback){openNativeTaskParams.taskId="openNativeWindow";openNativeTaskParams.windowType=3;var openNativeWindowCB={success:function(res){if(res&&res.fileName){callback.onOK({folderID:res.folderID,objDesc:"",objName:res.fileName,objPath:res.filePath+"\\"+res.fileName});}}};mstrApp.serverRequest(openNativeTaskParams,openNativeWindowCB);return ;}dialog=QB_SAVEAS_DIALOG_ID&&mstrmojo.all[QB_SAVEAS_DIALOG_ID];if(!dialog){dialog=new mstrmojo.DI.ui.dialogs.DISaveAsDialog();QB_SAVEAS_DIALOG_ID=dialog.id;}dialog.set("name",defaultNameObj.name||"");dialog.set("desc",defaultNameObj.desc||"");dialog.set("saveParams",{});dialog.set("retainPrevFolder",true);dialog.buttonBox.ok.set("enabled",true);if(mstrApp.cubeSaveFolderId){dialog.set("rootFolderID",mstrApp.cubeSaveFolderId);}dialog.saveAs=function(overwrite){var popUpZIndex=dialog.zIndex+2;dialog.buttonBox.ok.set("enabled",false);this.validateInput(overwrite,function(result){var params={folderID:dialog.folderID,objDesc:dialog.desc||"",objName:dialog.name||"",saveAsOverwrite:dialog.saveAsOverwrite,objPath:dialog.getObjectPath()};switch(result){case ERR_OK:dialog.close();callback.onOK(params);break;case ERR_INVALID_NAME:mstrmojo.alert($DESC(12376,"Please enter a valid cube name"),null,"",popUpZIndex);dialog.buttonBox.ok.set("enabled",true);break;case ERR_EXISTING_NAME:dialog.buttonBox.ok.set("enabled",true);mstrmojo.confirm(mstrmojo.desc(12925,"The name ## already exists. Do you want to replace the existing one?").replace("##",this.name),{confirmBtn:{fn:function(){dialog.close();callback.onOK(params);}}},{title:$DESC(12377,"Saving cube with the same name"),zIndex:popUpZIndex});break;}});};dialog.open();return dialog;},saveWithUserOption:function(handler,env,ctrl){var content_title="<strong>"+$DESC(15066,"Do you want to replace the existing cube")+"?</strong><br/>",nameDuplicatdHandler={rename:function(){mstrmojo.confirm(content_title+$DESC(15067,"A cube named ## already exists in this location. Do you want to replace it with the one you are editing ?").replace("##",env.fileName),{},{title:$DESC(14438,"Replace"),allowHTML:true,cssClass:"CubeNameConflictDialog",buttons:[$NWB($DESC(15065,"Keep Both"),function(){handler(true);},false),$NWB($DESC(14438,"Replace"),function(){handler(false);},false)]});},saveDirectly:function(){handler(false);}};if(!env){return false;}ctrl.searchObjectName(nameDuplicatdHandler,{folderID:env.folderID,searchPattern:env.fileName});},clone:function clone(obj){if(!obj){return null;}var c;if(obj.constructor===Array){c=obj.concat();var first=c[0];if(first&&typeof first==="object"){var len=c.length,i;for(i=0;i<len;i++){c[i]=this.clone(obj[i]);}}}else{c={};var k,v;for(k in obj){if(k==="parent"){continue;}v=obj[k];if(v&&typeof v==="object"){c[k]=this.clone(v);}else{c[k]=v;}}}return c;}};}());