(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.string","mstrmojo.ui.SearchablePulldownCheckList","mstrmojo.ui.SearchablePulldown");var $ARR=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$H=mstrmojo.hash,$STR=mstrmojo.string,$DEFAULT_SELECTED={0:true};function buildSelectedText(){var indices=this.selectedIndices=$H.copy(this.getPopupList().selectedIndices),items=this.items,names=[],text,allIdx=this.allIdx,noneIdx=this.noneIdx;if(items&&items.length){if(indices[allIdx]){names.push(items[allIdx].n);}else{if(indices[noneIdx]){names.push(items[noneIdx].n);}else{$ARR.forEach(items,function(item,index){if(indices[index]){names.push(item.n);}});}}}text=names.join(", ");this.set("value",text);this.set("text",text);this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-C",content:$STR.encodeHtmlString(text)});}mstrmojo.ui.MultiSelectSearchablePulldown=mstrmojo.declare(mstrmojo.ui.SearchablePulldown,[],{scriptClass:"mstrmojo.ui.MultiSelectSearchablePulldown",isHostedWithin:false,init:function init(props){this._super(props);$CSS.addWidgetCssClass(this,"multi");this.hostedCSSClass=this.hostedCSSClass+" multi";},submitSelections:function submitSelections(){this.onchange();},_set_selectedIndices:function _set_selectedIndices(n,v){var popupList=this.getPopupList(),selectedIndices=$H.copy(this.selectedIndices);popupList.set("selectedIndices",v||selectedIndices||$DEFAULT_SELECTED);buildSelectedText.call(this);return true;},select:function select(idxs){this.getPopupList().select(idxs);},getPopupWidget:function getPopupWidget(){return this.popupWidget;},getPopupList:function getPopupList(){return this.popupWidget.list;},getPopupListConfig:function getPopupListConfig(){return[{scriptClass:"mstrmojo.ui.SearchablePulldownCheckList",alias:"popupWidget",_unlockHoverCheck:function _unlockHoverCheck(e,hWin){var target=$DOM.eventTarget(hWin,e),opener=this.opener;if($DOM.contains(opener.domNode,target,true,document.body)){opener.set("isEditing",true);}else{if(!$DOM.contains(this.domNode,target,true,document.body)){this.close();}}},bindings:{itemCssText:function(){return(this.parent&&this.parent.itemCssText)||"";}}}];},processSearch:function processSearch(){var widget=this.getPopupWidget();widget.toggleCacheMode(true);if(this._super){this._super();}widget.toggleCacheMode(false);}});}());