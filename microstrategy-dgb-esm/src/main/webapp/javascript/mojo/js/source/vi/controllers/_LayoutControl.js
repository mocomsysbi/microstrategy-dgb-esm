(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.func","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.models.VIComponentMap.TYPES","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.controllers.ControlUtils");var ARRAY=mstrmojo.array,LAYOUT_MANIPULATION_TYPE=mstrmojo.vi.controllers.EnumLayoutManipulationType,VI_TYPES=mstrmojo.vi.models.VIComponentMap.TYPES,EVENTS=mstrmojo.vi.controllers.EnumEvents,FUNC=mstrmojo.func,UTILS=mstrmojo.vi.controllers.ControlUtils;function deleteLayout(params){var model=this.model,doc=this.view,layoutKey=params.layoutKey;if(!!layoutKey){model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);doc.deleteLayout(layoutKey,update);this.submitUpdate(update);},urInfo:{treesToRender:3,callback:UTILS.rebuildAndUpdateTOCcallback.call(model)}});}}function duplicateLayout(params){var model=this.model,doc=this.view,layoutKey=params.layoutKey;if(!!layoutKey){model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);doc.duplicateLayout(update,layoutKey);this.submitUpdate(update,model.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3,callback:UTILS.rebuildAndUpdateTOCcallback.call(model)}});}}function newLayout(){var model=this.model,doc=this.view;model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);doc.addNewLayout(update,-1,null);this.submitUpdate(update,model.cmdMgr().CMD_PHASE.FIRST);},urInfo:{disablePU:true,treesToRender:3,callback:UTILS.rebuildAndUpdateTOCcallback.call(model)}});}function renameLayout(params){var model=this.model,doc=this.view,layoutKey=params.layoutKey,oldText=params.oldText,newText=params.newText,tabFn=function(){return ARRAY.filterOne(doc.layoutViewer.getSelector().getTabs(),function(tab){return tab.k===layoutKey;});};model.renameLayout(layoutKey,newText,oldText,{failure:function failure(err){mstrApp.onerror(err);tabFn().set("title",oldText);},success:function success(title){var currentLayout=doc.getLayoutByKey(layoutKey);currentLayout.set("n",title);var filterStack=currentLayout.builder.getLayoutVIMap(layoutKey).getComponent(VI_TYPES.FILTER_STACK);if(filterStack){filterStack.set("title",title);}tabFn().set("title",title);}});}function moveLayout(params){var doc=this.view,fromIdx=params&&params.fromIdx,toIdx=params&&params.toIdx;doc.layoutViewer.getSelector().moveTab(fromIdx,toIdx,fromIdx);}mstrmojo.vi.controllers._LayoutControl=mstrmojo.provide("mstrmojo.vi.controllers._LayoutControl",{_mixinName:"mstrmojo.vi.controllers._LayoutControl",manipulateLayout:function manipulateLayout(params){switch(params&&params.type){case LAYOUT_MANIPULATION_TYPE.DELETE:deleteLayout.call(this,params);break;case LAYOUT_MANIPULATION_TYPE.DUPLICATE:duplicateLayout.call(this,params);break;case LAYOUT_MANIPULATION_TYPE.MOVE:moveLayout.call(this,params);break;case LAYOUT_MANIPULATION_TYPE.NEW:newLayout.call(this);break;case LAYOUT_MANIPULATION_TYPE.RENAME:renameLayout.call(this,params);break;}}});}());