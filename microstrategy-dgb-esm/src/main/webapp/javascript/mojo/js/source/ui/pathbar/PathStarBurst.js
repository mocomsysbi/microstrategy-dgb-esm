(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.ui.pathbar.PathPopup","mstrmojo.mstr._RecentObjectsHelper","mstrmojo.util.LibraryHelper");function createProjectsPopup(parent,target){var menuItems=[],i,l=1;menuItems[0]={name:mstrmojo.desc(8661,"All Projects"),href:mstrApp.name+"?evt=3001&src="+mstrApp.name+".3001",isSpecial:true};if(mstrApp.projectsList&&mstrApp.projectsList.projects){var projects=mstrApp.projectsList.projects;for(i=0;i<projects.length;i++){menuItems[l++]=projects[i];}}var projectsPopup;parent.addDisposable(projectsPopup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrProjectsGenPopup",cssClass:"mstrShortcutsListPopup",targetNode:target,children:[{scriptClass:"mstrmojo.ui.pathbar.ScrollableList",alias:"menuItems",useRichTooltip:true,items:menuItems,preclick:function preclick(){this.parent.close();},getItemMarkup:function(item){if(item.isSpecial){if(this.items.length===1){item.cssText="border-bottom: none;";}return'<span id="allProjectsItem" class="item mstrMenuItem {@itemCls}" style="{@cssText}"><a class="mstrLink project{@idx}" href="{@href}" idx="{@idx}" style="width:100%;">{@en@displayName}</a></span>';}return'<span class="item mstrMenuItem {@itemCls}" style="{@cssText}"><a class="mstrLink project{@idx}" href="{@href}" idx="{@idx}" style="width:100%;"><div class="projectName">{@en@displayName}</div>  <div class="serverName">{@srvrName}</div></a></span>';},getItemProps:function getItemProps(item,idx){var isSelected=!!item.selected;return{sel:isSelected,itemCls:"mstr-project-item",cssText:item.cssText||"",cls:isSelected?"selected":"",newGroup:!!item.grp?"grp":"",displayName:item.alias||item.name,idx:idx,href:item.href||mstrApp.name+"?evt=3010&src="+mstrApp.name+".3010&Port="+encodeURIComponent(item.port)+"&Project="+encodeURIComponent(item.name)+"&Server="+encodeURIComponent(item.server),srvrName:item.server,target:item.target||"_self"};},getTooltipText:function getTooltipText(item){if(item&&!item.isSpecial){$STR=mstrmojo.string;return $STR.encodeHtmlString((item.alias||item.name))+"<br/>"+item.server+"<br/>"+$STR.encodeHtmlString(item.desc);}},onclick:function(evt){var fnStopPropagation=function(){mstrmojo.dom.preventDefault(evt.hWin,evt.e);mstrmojo.dom.stopPropogation(evt.hWin,evt.e);};var target=evt.getTarget();if(!target.getAttribute("href")){target=target.parentElement;}mstrmojo.form.sendLinkAsForm(target.href);fnStopPropagation();return false;}}],onvisibleChange:function(){if(this.visible){setTimeout(this.menuItems.updateScrollbars(),200);}},onClose:function onClose(){this.isOpen=false;mstrmojo.css.toggleClass(this.targetNode,"opened",false);this.domNode.style.left="";}}));return projectsPopup;}function createRecentsPopup(parent,target){var menuItems=this.handleRecentObjects();var recentsPopup;parent.addDisposable(recentsPopup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrRecentsGenPopup",cssClass:"mstrShortcutsListPopup",targetNode:target,children:[{scriptClass:"mstrmojo.ui.pathbar.List",alias:"menuItems",items:menuItems,preclick:function preclick(){this.parent.close();},getItemMarkup:function(item){var imgMarkup="";if(mstrConfig.showPreviews){if(item.recoveryInfo!==undefined){var imgSrc=(item.recoveryInfo.imgData!==undefined)?"data:image/png;base64,"+item.recoveryInfo.imgData:"";if(imgSrc!==""){imgMarkup='<img class = "img-preview" src = "'+imgSrc+'" height="200" width="250" style="z-index: 100; position: absolute;">';}}}return'<span class="item mstrMenuItem {@itemCls}" style="{@cssText}"><span class="{@iconCls}"></span><a class="mstrLink" href="{@href}"><div>{@n}</div>'+imgMarkup+"</a></span>";},getItemProps:function getItemProps(item,idx){var isSelected=!!item.selected,optimzeFitPageParams=(mstrApp&&mstrApp.optimizeFitToPage)?"&innerWidth="+window.innerWidth+"&innerHeight="+window.innerHeight:"";return{sel:isSelected,iconCls:item.iconClass,itemCls:item.itemClass,cssText:item.cssText||"",cls:isSelected?"selected":"",newGroup:!!item.grp?"grp":"",n:item.recoveryName,idx:idx,href:item.recoveryURL+optimzeFitPageParams,name:item.recoveryName,target:item.target||"_self"};},onclick:function(evt){var fnStopPropagation=function(){mstrmojo.dom.preventDefault(evt.hWin,evt.e);mstrmojo.dom.stopPropogation(evt.hWin,evt.e);};var oAnchor=evt.getTarget();if(oAnchor.getAttribute("href")){mstrmojo.form.sendLinkAsForm(oAnchor.href);}else{mstrmojo.form.sendLinkAsForm(oAnchor.parentElement.href);}fnStopPropagation();return false;}}],onClose:function onClose(){this.isOpen=false;mstrmojo.css.toggleClass(this.targetNode,"opened",false);this.domNode.style.left="";}}));return recentsPopup;}function createPopup(){var me=this;this.addDisposable(this.popup=new mstrmojo.ui.pathbar.PathPopup({id:"mstrSCList",cssClass:"mstrShortcutsListPopup",targetNode:this.domNode,offsetTop:2,recentsPopup:null,children:[{scriptClass:"mstrmojo.ui.pathbar.List",alias:"menuItems",preclick:function preclick(event){var target=event.getTarget();if(target.getAttribute("name")!=="recentObjects"&&target.getAttribute("name")!=="projects"){this.parent.close();}},handleMouseOver:function handleMouseOver(event,selectedItem){var target=event.getTarget(),projPopup=this.parent.projectsPopup,recPopup=this.parent.recentsPopup;if(target.getAttribute("name")=="recentObjects"){if(projPopup!=null){projPopup.close();}this.handleClick(event,selectedItem);}else{if(target.getAttribute("name")=="projects"){if(recPopup!=null){recPopup.close();}this.handleClick(event,selectedItem);}else{if(recPopup!=null){recPopup.close();}if(projPopup!=null){projPopup.close();}}}return false;},handleClick:function handleClick(event,selectedItem){var target=event.getTarget();var parent=this.parent;if(target.getAttribute("name")=="recentObjects"){if(target.nodeName==="SPAN"){target=target.parentNode;}if(parent.recentsPopup==null){parent.recentsPopup=createRecentsPopup.call(me,parent,target);}this.openHelper(target,parent.recentsPopup);return true;}else{if(target.getAttribute("name")=="projects"){if(target.nodeName==="SPAN"){target=target.parentNode;}if(parent.projectsPopup==null){this.loadProjects(target);}else{this.openHelper(target,parent.projectsPopup);}return true;}else{if(target.getAttribute("name")=="dossierLibrary"){mstrmojo.util.LibraryHelper.createTokenAndOpenLink(selectedItem.href);return true;}}}return false;},openHelper:function openHelper(target,mPopup){mPopup.autoPosition=false;var rect=target.getBoundingClientRect();if(!mPopup.isOpen){mPopup.offsetTop=rect.top-rect.bottom;mPopup.offsetLeft=this.domNode.clientWidth-rect.left;mPopup.open();}},loadProjects:function loadProjects(target){var that=this;var parent=that.parent;if(!mstrApp.projectsList){mstrApp.showWait();mstrApp.serverProxy.request({success:function(res){if(res){mstrApp.projectsList=res;parent.projectsPopup=createProjectsPopup.call(me,parent,target);that.openHelper(target,parent.projectsPopup);}},complete:function(){mstrApp.hideWait(true);}},{taskId:"getProjectsInfo",sort:true},false,{});}else{parent.projectsPopup=createProjectsPopup.call(me,parent,target);that.openHelper(target,parent.projectsPopup);}},items:mstrApp.pathInfo.sb,getItemMarkup:function(item){var cssclass="{@cls}";if(item.name==="recentObjects"||item.name==="projects"){cssclass="";}return'<a name="{@name}" class="item {@name} '+cssclass+' {@newGroup}" idx="{@idx}" onclick="{@onclick}" href="#" target="{@target}"><span name="{@name}" class="icon"></span><span name="{@name}">{@n}</span></a>';},getItemProps:function getItemProps(item,idx){var isSelected=!!item.selected;return{sel:isSelected,cls:isSelected?"selected":"",newGroup:!!item.grp?"grp":"",n:item.n,idx:idx,href:item.href,name:item.name,onclick:item.onclick||"return true",target:item.target||"_self"};}}]}));}mstrmojo.ui.pathbar.PathStarBurst=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.mstr._RecentObjectsHelper],{scriptClass:"mstrmojo.ui.pathbar.PathStarBurst",markupString:'<a id="mstrStarburst {@id}" mstrAttach:click,mouseover,mouseout class="mstrLink" style="top:0"><div id="mstrLogo" class="mstrLogo path"></div><div id="mstrLogoMenu" class="mstrLogoMenu path mstrPullArrow"></div></a>',markupSlots:{logoNode:function(){return this.domNode.children[0];},logoMenuNode:function(){return this.domNode.children[1];}},popup:null,postBuildRendering:function postBuildRendering(){createPopup.call(this);this.domNode.setAttribute("href",mstrApp.name+"?evt=3010&src="+mstrApp.name+".3010");},onclick:function onclick(evt){var fnStopPropagation=function(){mstrmojo.dom.preventDefault(evt.hWin,evt.e);mstrmojo.dom.stopPropogation(evt.hWin,evt.e);};if(evt.getTarget()===this.logoMenuNode){var mPopup=this.popup;if(!mPopup.isOpen){mPopup.open();}fnStopPropagation();}else{mstrmojo.form.sendLinkAsForm(evt.src.domNode.href);fnStopPropagation();return false;}}});}());