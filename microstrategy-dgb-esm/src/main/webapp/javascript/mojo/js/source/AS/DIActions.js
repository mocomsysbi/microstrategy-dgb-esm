(function(){mstrmojo.requiresCls("mstrmojo._IsWebApp","mstrmojo.dom","mstrmojo.DI.DIConstants");var DOM=mstrmojo.dom,DISABLED_FEATURES=mstrmojo.DI.DIConstants.disableFeatures;function openDataImportEditor(config){var curFolder=config.folderId,me=this,win_unload=window.onbeforeunload;window.onbeforeunload=null;function onClose(){window.mstrAppSchema&&window.mstrAppSchema.callbacks.updateAllDBRoles();window.onbeforeunload=win_unload;}var openDI=function(){mstrmojo._IsWebApp.showWait({cssClass:"mstr-appschema-wait"});var di;if(me.dataImportId){di=mstrmojo.all[me.dataImportId];}if(!di){getDICss();di=mstrmojo.insert({scriptClass:"mstrmojo.DI.DIContainer"});di.dataImportCallback=function(datasets){};me.dataImportId=di.id;}var disableFeatures=[DISABLED_FEATURES.DISABLE_CUSTOM_CONNECTOR,DISABLED_FEATURES.DISABLE_DDA,DISABLED_FEATURES.DISABLE_QUOTA,DISABLED_FEATURES.DISABLE_HADOOP,DISABLED_FEATURES.DISABLE_BI_TOOLS,DISABLED_FEATURES.DISABLE_CLIP_BOARD,DISABLED_FEATURES.DISABLE_FACE_BOOK,DISABLED_FEATURES.DISABLE_TWITTER,DISABLED_FEATURES.DISABLE_SAMPLE_FILES,DISABLED_FEATURES.DISABLE_PUBLIC_DATA,DISABLED_FEATURES.DISABLE_MERGE_CUBE,DISABLED_FEATURES.DISABLE_CE_SOURCE];var disableMap={};disableFeatures.forEach(function(item){disableMap[item]=true;});mstrmojo.hash.copy(disableMap,di.dataImportParams);var disabledSourcesObj={};disabledSourcesObj[DISABLED_FEATURES.DISABLE_FLATTERN_DB_SOURCE]=mstrApp.disabledSources;mstrmojo.hash.copy(disabledSourcesObj,di.dataImportParams);if(config){di.onClose=onClose;mstrmojo.hash.copy(config,di.dataImportParams);if(config.callback){di.dataImportCallback=function(datasets){config.callback(datasets);};}}if(curFolder){mstrmojo.hash.copy({cubeSaveFolderId:curFolder},di.dataImportParams);}di.open();mstrmojo._IsWebApp.hideWait();};var checkSession=function(){mstrmojo._IsWebApp.showWait({cssClass:"mstr-appschema-wait"});var callback={success:function(res){if(res){openDI();}else{if(mstrApp.onSessionExpired){mstrApp.onSessionExpired();}}},complete:function(){mstrmojo._IsWebApp.hideWait();}},params={taskId:"keepSessionAlive"};mstrmojo.xhr.request("POST",mstrConfig.taskURL,callback,params);};var getDICss=function(){var file="data-import.css";if(DOM.isIE8||DOM.isIE9){file="data-import-ie.css";}var link=document.createElement("link");link.rel="stylesheet";link.href="../javascript/mojo/css/"+file;link.type="text/css";document.head.appendChild(link);};checkSession();}mstrmojo.AS.DIActions=mstrmojo.provide("mstrmojo.AS.DIActions",{openDataImport:function(){openDataImportEditor({rootControllerCls:"mstrmojo.AS.ASDIRootController"});},openDBTableList:function(dbrId){openDataImportEditor({StatusCode:mstrmojo.DI.DIConstants.statusCode.pickTable,defaultDbrId:dbrId,rootControllerCls:"mstrmojo.AS.ASDIRootController"});},openHadoopTableList:function(dbrId){openDataImportEditor({StatusCode:mstrmojo.DI.DIConstants.statusCode.hadoopPickTable,defaultDbrId:dbrId,rootControllerCls:"mstrmojo.AS.ASDIRootController"});},openFFSQL:function(dbrId){openDataImportEditor({StatusCode:mstrmojo.DI.DIConstants.statusCode.ffsql,defaultDbrId:dbrId,rootControllerCls:"mstrmojo.AS.ASDIRootController"});},openHadoopFFSQL:function(dbrId){openDataImportEditor({StatusCode:mstrmojo.DI.DIConstants.statusCode.hadoopFFsql,defaultDbrId:dbrId,rootControllerCls:"mstrmojo.AS.ASDIRootController"});}});}());