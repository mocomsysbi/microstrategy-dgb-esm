(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils","mstrmojo.vi.models.editors.MapEditorModel","mstrmojo.Label","mstrmojo.expr","mstrmojo.array","mstrmojo.models.FormatModel","mstrmojo.chart.enums.EnumFontStyle","mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl","mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl");var $MOJO=mstrmojo,$EXCLUDED_FONT_FAMILIES=$MOJO.mapbox.EXCLUDED_FONT_FAMILIES,$GMAPS=$MOJO.gmaps,$ARR=mstrmojo.array,$MUTIL=$GMAPS.MapUtils,$EnumMarkerType=$GMAPS.EnumMarkerType,$EnumPropertyType=$GMAPS.EnumPropertyType,$EnumClusterMode=$GMAPS.EnumClusterMode,$EnumGraphicType=$GMAPS.EnumGraphicType,$EnumLanguageType=$GMAPS.EnumLanguageType,$EnumDistUnitType=$GMAPS.EnumDistUnitType,TARGET_FORMATTING_LAYERS=$GMAPS.TARGET_FORMATTING_LAYERS,$DTP=mstrmojo.expr.DTP,DIST_UNIT=[{id:$EnumDistUnitType.KM,n:mstrmojo.desc(15733,"km")},{id:$EnumDistUnitType.Miles,n:mstrmojo.desc(11140,"miles").toLowerCase()}];var CTRL_FONT_FAMILY=1,CTRL_FONT_SIZE_AND_COLOR=4;mstrmojo.vi.models.editors.MapboxEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.MapEditorModel,null,{scriptClass:"mstrmojo.vi.models.MapboxEditorModel",help:"Format_Panel_Geospatial_Service.htm",getInitialTarget:function getInitialTarget(){return TARGET_FORMATTING_LAYERS;},getTargetPulldownItems:function getTargetPulldownItems(dynamicCtrlGroup){var pulldownItems=this._super(dynamicCtrlGroup),host=this.getHost(),me=this,fmtLayerHandler=function(){var fn=me.getFormattingLayerControls;me.replaceChildControls(dynamicCtrlGroup,fn.call(me));};if(host.isBaseMapValid()&&!(host.excludeData||host.isEmpty())){pulldownItems.unshift({n:mstrmojo.desc(15734,"Formatting on layer"),v:TARGET_FORMATTING_LAYERS,h:fmtLayerHandler});}return pulldownItems;},getMapLabelsControls:function getMapLabelsControls(){var controls=[],host=this.getHost();controls.push(this.getGroupTitle(mstrmojo.desc(15925,"Map Labels")));controls.push(this.getMapboxCheckboxControl($EnumPropertyType.showMapLable,mstrmojo.desc(15735,"Show map labels")));controls.push(this.getMapboxCheckboxControl($EnumPropertyType.mapLabelOnTop,mstrmojo.desc(15736,"Bring map labels to front")));var languageCtrl=this.fnGetPulldown(this.getLanguageTypes(),this.getSelectedLanguageIndex(),mstrmojo.desc(13111,"Language"),$EnumPropertyType.languageType);languageCtrl.set("enabled",host.getPropertyValue($EnumPropertyType.showMapLable));controls.push(languageCtrl);return controls;},getZoomingFunctionControls:function getZoomingFunctionControls(){var controls=[],host=this.getHost();controls.push(this.getGroupTitle(mstrmojo.desc(15926,"Zooming Function")));controls.push(this.getZoomControls());controls.push(this.getKeepZoomLevelandPosCtrl());if(host.isZoomThroughLayerCtrlShown&&host.isZoomThroughLayerCtrlShown()){controls.push(this.getZoomThroughLayersControls());}return controls;},getGeoUnitControls:function getGeoUnitControls(){var controls=[];controls.push(this.fnGetPulldown(DIST_UNIT,this.getSelectedDistUnitIndex(),mstrmojo.desc(15737,"Geo unit"),$EnumPropertyType.distUnit,{isNested:true,showDivider:true,isContainer:true}));return controls;},getMapOptionControls:function getMapOptionControls(){var controls=[];controls.push(this.getMapStyleControls());controls.push(this.getEditorGroup(this.getMapLabelsControls(),{isNested:true,showDivider:true,isContainer:true}));controls.push(this.getEditorGroup(this.getZoomingFunctionControls(),{isNested:true,showDivider:true,isContainer:true}));controls.push(this.getEditorGroup(this.getGeoUnitControls(),{isNested:true,showDivider:true,isContainer:true}));controls.push(this.getMoreOptionsControl());return[this.getEditorGroup([this.getEditorGroup(controls)],{showDivider:true,isNested:true,isContainer:true})];},getFormattingLayerControls:function getFormattingLayerControls(){var controls=[];if(!mstrApp.isInVFConfigMode){this.mapLayersPullDown=this.getMapLayersPullDown();controls.push(this.mapLayersPullDown);}controls.push(this.getGraphicLayerOptionsControls());return[this.getEditorGroup([this.getEditorGroup(controls)],{showDivider:true,isNested:true,isContainer:true})];},getMapboxCheckboxControl:function getMapboxCheckboxControl(propName,title){var me=this,host=this.getHost(),properties=host&&host.getProperties(),isChecked=!!(properties&&(properties[propName]===true||properties[propName]==="true")),checkBox=new mstrmojo.ui.Checkbox({checked:isChecked,oncheckedChange:function oncheckedChange(evt){me.onPropertiesChanged(propName,evt.value);}}),control=this.getLabelAndControl(title,checkBox,"10px","100%",true,{enabled:this.isBmpLabelCtrlEnabled(propName)}),label=control.getLabel();label.onclick=function(){checkBox.onclick();};return control;},isBmpLabelCtrlEnabled:function isBmpLabelCtrlEnabled(propName){var host=this.getHost(),enabled=!!(host&&host.isLbGrpEstInBaseLayer()),showLabelPropName=$EnumPropertyType.showMapLable,properties,isShowLabelChecked;if(propName===showLabelPropName){return enabled;}else{properties=host&&host.getProperties();isShowLabelChecked=!!(properties&&(properties[showLabelPropName]===true||properties[showLabelPropName]==="true"));return enabled&&isShowLabelChecked;}},getSelectedDistUnitIndex:function getSelectedDistUnitIndex(){var host=this.getHost(),properties=host&&host.getProperties(),value=properties&&properties[$EnumPropertyType.distUnit],selectedIndex=0;if(value===undefined){value=host.getDefaultDistanceUnit();}switch(value){case $EnumDistUnitType.KM:default:selectedIndex=0;break;case $EnumDistUnitType.Miles:selectedIndex=1;break;}return selectedIndex;},getMapLayersPullDown:function getMapLayersPullDown(){var host=this.getHost(),items=host.getGraphicLayerNameArr();$ARR.forEach(items,function(item,idx){item.id=idx;});return this.fnGetPulldown(items,host.getEditingLayerIdx(),undefined,$EnumPropertyType.editingLayerIdx);},selectLayerForRMCFmt:function selectLayerForRMCFmt(layerKey){if(this.mapLayersPullDown&&layerKey){this.mapLayersPullDown.selectItemByField("k",layerKey);}},getLanguageTypes:function getLanguageTypes(){return[{id:$EnumLanguageType.Local,n:mstrmojo.desc(14937,"Local")},{id:$EnumLanguageType.English,n:mstrmojo.desc(1376,"English")},{id:$EnumLanguageType.Both,n:mstrmojo.desc(1376,"English")+" + "+mstrmojo.desc(14937,"Local")}];},getSelectedLanguageIndex:function getSelectedLanguageIndex(){var value=this.getEditingPropertyVal($EnumPropertyType.languageType),selectedIndex=1;switch(value){case $EnumLanguageType.Local:selectedIndex=0;break;case $EnumLanguageType.English:selectedIndex=1;break;case $EnumLanguageType.Both:selectedIndex=2;break;default:break;}return selectedIndex;},getGraphicTypes:function getGraphicTypes(){return[{n:mstrmojo.desc(13254,"Marker"),id:$EnumGraphicType.Marker},{n:mstrmojo.desc(348,"Bubble"),id:$EnumGraphicType.Bubble},{n:mstrmojo.desc(13255,"Area"),id:$EnumGraphicType.Area}];},getGraphicTypeSelectedIndex:function getGraphicTypeSelectedIndex(graphicType){var selectedIndex=0;switch(graphicType){case $EnumGraphicType.Marker:selectedIndex=0;break;case $EnumGraphicType.Bubble:selectedIndex=1;break;case $EnumGraphicType.Area:selectedIndex=2;break;default:break;}return selectedIndex;},getMarkerTypes:function getMarkerTypes(){return[{n:mstrmojo.desc(12100,"Circle"),id:$EnumMarkerType.Circle},{n:mstrmojo.desc(11837,"Pins"),id:$EnumMarkerType.Pin},{n:mstrmojo.desc(154,"Squares"),id:$EnumMarkerType.Square},{n:mstrmojo.desc(14746,"Diamonds"),id:$EnumMarkerType.Diamond},{n:mstrmojo.desc(14747,"Images"),id:$EnumMarkerType.Image}];},getMarkerTypeSelectedIndex:function getMarkerTypeSelectedIndex(){var value=this.getEditingPropertyVal($EnumPropertyType.markerType),selectedIndex=0;switch(value){case $EnumMarkerType.Circle:selectedIndex=0;break;case $EnumMarkerType.Pin:selectedIndex=1;break;case $EnumMarkerType.Square:selectedIndex=2;break;case $EnumMarkerType.Diamond:selectedIndex=3;break;case $EnumMarkerType.Image:selectedIndex=4;break;default:break;}return selectedIndex;},getValidationTextBoxWithUnitControl:function getValidationTextBoxWithUnitControl(textBoxProps,unitLabelProps,columnConfig){columnConfig=columnConfig||{col1Width:"100%",col2Width:"12px"};return this.getTwoColumnContainer([new mstrmojo.ui.editors.controls.ValidationTextBox(textBoxProps),new mstrmojo.Label(unitLabelProps)],columnConfig);},getClusteringControlForMarker:function getClusteringControlForMarker(){return this.getClusteringControls();},getClusteringControlForBubble:function getClusteringControlForBubble(){return this.getClusteringControls();},getClusteringControls:function getClusteringControls(controls){var editorModel=this,host=this.getHost(),props=host&&host.getEditingGridProps(),clusterModePropName=$EnumPropertyType.clusterMode,clusteringLabel=this.getGroupTitle(mstrmojo.desc(11841,"Clustering")),isClusterEnable=function(){return props[clusterModePropName]===$EnumClusterMode.ON;},clusteringEnable=this.getCheckboxAndLabel(isClusterEnable(),mstrmojo.desc(15705,"Enable Clustering"),function(newValue){var newClusterModeValue=newValue?$EnumClusterMode.ON:$EnumClusterMode.OFF;editorModel.onPropertiesChanged(clusterModePropName,newClusterModeValue);}),clusterRadius=this.getTwoColumnContainer([new mstrmojo.Label({text:mstrmojo.desc(15738,"Cluster radius"),enabled:isClusterEnable()}),this.getValidationTextBoxWithUnitControl({alias:"clusterRadius",required:true,errRevert:false,dtp:$DTP.INTEGER,constraints:{min:1,max:300,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},getInvalidMsg:function(){return mstrmojo.desc(15739,"Cluster radius should be integer between 1 and 300");},useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C mapbox_cluster_radius",left:this.domNode.offsetWidth+6+20,top:-4,refNode:this.domNode,keepArrowYPos:true,content:'<div class="name">'+mstrmojo.desc(15740,"All points within the radius of R pixels will be clustered.")+'</div><div class="cluster_radius_img"></div>'};return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C vi-calculation-warning",left:this.domNode.offsetWidth+6+20,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};},validationDelay:1500,value:parseInt(props[$EnumPropertyType.clusterRadius],10)||50,enabled:isClusterEnable(),onValid:function(){editorModel.onPropertiesChanged($EnumPropertyType.clusterRadius,this.value);}},{text:"px",enabled:isClusterEnable()})]),zoomLevelLabel=new mstrmojo.Label({text:mstrmojo.desc(15741,"Set zoom level for clustering"),enabled:isClusterEnable()}),maxZoomLevelSlider=new mstrmojo.mapbox.ui.selectors.ClusterMaxZoomControl({host:host,enabled:isClusterEnable()});return this.getEditorGroup([clusteringLabel,clusteringEnable,zoomLevelLabel,maxZoomLevelSlider,clusterRadius],{isNested:true,showDivider:true,isContainer:true});},getZoomThroughLayersControls:function getZoomThroughLayersControls(){var editorModel=this,host=this.getHost(),zoomThroughtLayerEnablePropName=$EnumPropertyType.enableZoomThroughLayer,isZoomThroughtLayerEnable=function(){return $MUTIL.parseBoolean(host.getPropertyValue(zoomThroughtLayerEnablePropName));},zoomThroughLayerCheckbox=this.getCheckboxAndLabel(isZoomThroughtLayerEnable(),mstrmojo.desc(15742,"Zoom through layers"),function(newValue){editorModel.onPropertiesChanged(zoomThroughtLayerEnablePropName,newValue);}),sliders=new mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl({host:host,enabled:isZoomThroughtLayerEnable()});zoomThroughLayerCheckbox.cssClass="";return this.getEditorGroup([zoomThroughLayerCheckbox,sliders],{isNested:true,showDivider:false,isContainer:true});},getDataLabelControlConfig:function getDataLabelControlConfig(){return CTRL_FONT_FAMILY+CTRL_FONT_SIZE_AND_COLOR;},getDataLabelExtraControlProps:function getDataLabelExtraControlProps(){return{getFontFamilyItems:$MUTIL.getFontFamilyItems.bind(this,$EXCLUDED_FONT_FAMILIES),getFontStyleItems:function(){return[{n:mstrmojo.desc(2718,"Bold"),id:"b",css:"bold"},{n:mstrmojo.desc(2719,"Italic"),id:"i",css:"italic"}];}};}});}());