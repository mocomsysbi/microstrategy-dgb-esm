(function(){mstrmojo.requiresCls("mstrmojo.gm._GMPropertyHandler");var ALL_VALUE="allVal",$MOJO=mstrmojo,$GM=$MOJO.gm,CTRL_TYPE=$MOJO.VisEnum.ControlType,ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,ENUM_XML_TAG=$GM.WidgetPropertyTag,GMUTIL=$GM.GMUtility,$GMProp=$GM.GMProperty,PRP_GRID_LINE=$GM.EnumNGMGridLines;var DO_NOT_SEPARATE_PROPERTY=[ENUM_FORMAT_TAG.ALL_TEXT_FONT_COLOR,ENUM_FORMAT_TAG.ALL_TEXT_FONT_STYLE,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_COLOR,ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_STYLE];function checkForPartialUpdate(propName,newValue){return(propName===ENUM_XML_TAG.REF_LINE_DEF&&newValue[ALL_VALUE].modifiedPropertyKeys[0]===ENUM_XML_TAG.REF_LINE_NAME)||(propName===ENUM_FORMAT_TAG.SHOW_MODEBAR);}function getDefaultHandleConfig(){return{suppressData:true,needRefresh:true,actions:[],undoRedoCallback:undefined};}mstrmojo.ngm._NewGMPropertyHandler=mstrmojo.provide("mstrmojo.ngm._NewGMPropertyHandler",mstrmojo.mixin({scriptClass:"mstrmojo.ngm._NewGMPropertyHandler",writeGlobalProperty:function writeGlobalProperty(propName,newValue,option,holdSumbitAndEvent,associatedPropValueTuples){var me=this,callback,handleConfig=getDefaultHandleConfig();me.GMController.clearShapeFormatsCache();if(propName!==""&&propName!==undefined){if(this.syning){return ;}if(propName===ENUM_FORMAT_TAG.COLOR_SQUARE_COLOR){if(this.colorSqureIdentity){this.updateColorByMap([this.colorSqureIdentity.comb],newValue);}return ;}if(propName.indexOf("CmbStyle")!==-1){handleConfig=this.processCombineLineStyle(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.TREND_LINE_DEF){handleConfig=this.processTrendLine(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.REF_LINE_DEF){handleConfig=this.processReferenceLine(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.TREND_BUBBLE_FORE_DEF){handleConfig=this.processTrendLineForcast(propName,newValue,option,holdSumbitAndEvent);}else{if(propName===ENUM_XML_TAG.AXIS_SCALE_DATA){handleConfig=this.processAxisScale(propName,newValue,option,holdSumbitAndEvent);}else{if(propName===ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL){handleConfig=this.processMetricLevelDataLabel(propName,newValue,option);}else{if(propName===ENUM_XML_TAG.AXIS_ORIGIN){handleConfig=this.processAxisOrigin(propName,newValue,option);}else{if(propName===ENUM_FORMAT_TAG.ALL_GRID_LINES_SHOW){handleConfig=this.processGridLineShow(propName,newValue);}else{if(propName===ENUM_FORMAT_TAG.LINE_MARKER_COLOR){handleConfig=this.processLineMarkColor(propName,newValue);}else{if([ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR,ENUM_XML_TAG.DATA_LABEL,ENUM_XML_TAG.DATA_LABELS_PLACEMENT,ENUM_XML_TAG.DATA_LABEL_FONT_SIZE_CONSTRAINT,ENUM_XML_TAG.DATA_LABEL_TEXT_ANGLE,ENUM_FORMAT_TAG.DATA_LABELS_FONT_FAMILY,ENUM_FORMAT_TAG.DATA_LABELS_FONT_SIZE].indexOf(propName)!==-1){handleConfig=this.processPropertiesUniformly(propName,newValue,option,associatedPropValueTuples);if(!me.GMController.isHistogram){handleConfig.needRefresh=false;}}else{handleConfig=this.processPropertiesUniformly(propName,newValue,option,associatedPropValueTuples);}}}}}}}}}}}if(holdSumbitAndEvent){return ;}callback=this.getPropertyUpdateCallback(propName,newValue,option,associatedPropValueTuples,handleConfig.suppressData);if(handleConfig.suppressData){me.partialUpdate(propName,{allVal:newValue},handleConfig.needRefresh,option);if(callback.success){callback.success();}}this.submitUpdatesAndPersistXML(handleConfig.actions,callback,handleConfig.undoRedoCallback,handleConfig.suppressData,false,handleConfig.puFiltersConfig);},partialUpdate:function(propName,newValue,needRefresh,option,isUndoRedo){var singlePropNames,ret,me=this,handled=false;if(this.noData){return ;}GMUTIL.startTimer({functionName:"VisNewGraphMatrix.partialUpdate",purpose:"Partial update of new graph matrix ("+this.k+")"});singlePropNames=$GMProp.getUnderlyingPropertyNameWithAll(propName);this.resetAxisProps(singlePropNames);this.resetHTML5Props();this.configureTrendAndRefLine(propName);this.resetGMCtrlCache(propName,newValue);this.setUpForceUpdateFlag(propName);handled=checkForPartialUpdate(propName,newValue);if(needRefresh&&!handled){handled=this.handlePartialUpdate(this.getPartialUpdateType(propName),isUndoRedo);}if(!handled){if(DO_NOT_SEPARATE_PROPERTY.indexOf(propName)>=0){singlePropNames=[propName];}singlePropNames.forEach(function(pn){ret=me.updateSingleProperty(pn,newValue,needRefresh,option);handled=handled||ret;});if(needRefresh){this.clientRerenderGraphMatrix();}}this.clearForceUpdateFlag();GMUTIL.endTimer();},rerenderChart:function(){if(this.excludeData){return ;}this.setChartLayout();this.resize();},updateSingleProperty:function(propName,newValue,needRefresh,option){var modifiedKey,subPropName={},HTML5PROPS=this.HTML5PROPS,allVal=newValue[ALL_VALUE],value=newValue.hasOwnProperty(propName)?newValue[propName]:allVal,GMC=this.GMController;switch(propName){case ENUM_FORMAT_TAG.BG_COLOR:case ENUM_FORMAT_TAG.BG_FILL_TRANSPARENCY:break;case ENUM_FORMAT_TAG.ROW_HEADER_FILL_COLOR:case ENUM_FORMAT_TAG.ROW_HEADER_FILL_TRANSPARENCY:this.updateRowValueBackground();this.updateHeaderTitle("row","bg");break;case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.ROW_HEADER_TEXT_ALIGNMENT_VERTICAL:this.updateHeaderTitle("row","font");break;case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.ROW_VAVLUE_TEXT_ALIGNMENT_VERTICAL:break;case ENUM_FORMAT_TAG.COLUMN_HEADER_FILL_COLOR:case ENUM_FORMAT_TAG.COLUMN_HEADER_FILL_TRANSPARENCY:this.updateColumnValueBackground();this.updateHeaderTitle("col","bg");break;case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.COLUMN_HEADER_TEXT_ALIGNMENT_VERTICAL:this.updateHeaderTitle("col","font");break;case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_FONT_STYLE:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_HORIZONTAL:case ENUM_FORMAT_TAG.COLUMN_VAVLUE_TEXT_ALIGNMENT_VERTICAL:break;case ENUM_FORMAT_TAG.V_MATRIX_LINES_COLOR:case ENUM_FORMAT_TAG.V_MATRIX_LINES_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-matrix-line.v",HTML5PROPS.MATRIX_LINE_V);break;case ENUM_FORMAT_TAG.H_MATRIX_LINES_COLOR:case ENUM_FORMAT_TAG.H_MATRIX_LINES_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-matrix-line.h",HTML5PROPS.MATRIX_LINE_H);break;case ENUM_FORMAT_TAG.X_AXIS_LINE_COLOR:case ENUM_FORMAT_TAG.X_AXIS_LINE_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-axis-line.h",HTML5PROPS.AXIS_LINE_X);break;case ENUM_FORMAT_TAG.Y_AXIS_LINE_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_LINE_COMBINED_STYLE:this.updateMatrixLineStyle(".gm-axis-line.v",HTML5PROPS.AXIS_LINE_Y);break;case ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COLOR:case ENUM_FORMAT_TAG.X_AXIS_ORIGIN_LINE_COMBINED_STYLE:this.updateOriginLineStyle(propName,"v",".gm-set-originline",value);break;case ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_ORIGIN_LINE_COMBINED_STYLE:this.updateOriginLineStyle(propName,"h",".gm-set-originline",value);break;case ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_TITLE_FONT_STYLE:this.updateAxisTitleFontColor("y",newValue);break;case ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.Y_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontColor("y",newValue);break;case ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_COLOR:case ENUM_FORMAT_TAG.X_AXIS_TITLE_FONT_STYLE:this.updateAxisTitleFontColor("x",newValue);break;case ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.X_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontColor("x",newValue);break;case ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.ALL_AXIS_LABELS_FONT_STYLE:this.updateAxisLabelFontColor("x",newValue);this.updateAxisLabelFontColor("y",newValue);break;case ENUM_FORMAT_TAG.ALL_NGM_GRID_LINES_SHOW:this.updateGridLine("x");this.updateGridLine("y");break;case ENUM_FORMAT_TAG.X_GRID_LINES_SHOW:this.updateGridLine("x");break;case ENUM_FORMAT_TAG.Y_GRID_LINES_SHOW:this.updateGridLine("y");break;case ENUM_XML_TAG.LEGEND_VISIBLE:case ENUM_XML_TAG.LEGEND_MODE:case ENUM_XML_TAG.SCALE_LEGEND_WIDTH:case ENUM_FORMAT_TAG.LEGEND_BG_COLOR:case ENUM_FORMAT_TAG.LEGEND_BG_FILL_TRANSPARENCY:case ENUM_FORMAT_TAG.LEGEND_FONT_COLOR:case ENUM_FORMAT_TAG.LEGEND_FONT_STYLE:case ENUM_FORMAT_TAG.LEGEND_FONT_SIZE:case ENUM_FORMAT_TAG.LEGEND_FONT_FAMILY:this.legendPartialUpdate(propName,needRefresh);break;case ENUM_XML_TAG.LEGEND_POSITION:this.updateLegendPosition(value);break;case ENUM_FORMAT_TAG.ALL_TEXT_FONT_COLOR:case ENUM_FORMAT_TAG.ALL_TEXT_FONT_STYLE:this.updateAxisLabelFontColor("x",newValue);this.updateAxisLabelFontColor("y",newValue);this.updateAxisTitleFontColor("x",newValue);this.updateAxisTitleFontColor("y",newValue);break;case ENUM_XML_TAG.BANDING:case ENUM_XML_TAG.AXIS_ORIGIN:case ENUM_XML_TAG.MAX_SIZE_TYPE:case ENUM_XML_TAG.MAX_SIZE_VALUE:case ENUM_XML_TAG.MIN_SIZE_VALUE:case ENUM_FORMAT_TAG.DATA_LABELS_FONT_COLOR:case ENUM_XML_TAG.DATA_LABEL:case ENUM_XML_TAG.DATA_LABELS_PLACEMENT:case ENUM_XML_TAG.DATA_LABEL_FONT_SIZE_CONSTRAINT:case ENUM_XML_TAG.DATA_LABEL_TEXT_ANGLE:case ENUM_XML_TAG.METRIC_LEVEL_DATA_LABEL:case ENUM_FORMAT_TAG.DATA_LABELS_FONT_FAMILY:case ENUM_FORMAT_TAG.DATA_LABELS_FONT_SIZE:this.restyleDataLabelData();break;case ENUM_XML_TAG.MIN_SIZE_TYPE:if(propName===ENUM_XML_TAG.MIN_SIZE_TYPE&&this.needLegend&&GMC.hasSizeBy()){this.sizeByData=GMC.getSizeByLegendInfo();}this.updateAxisAndCharts(propName);this.hUpdateLegend();break;case ENUM_FORMAT_TAG.DATA_LABELS_FONT_STYLE:if(needRefresh){this.updateAxisAndCharts(propName);}else{this.updateChartFontStyle(propName,CTRL_TYPE.GM_DATA_LABEL,value);}break;case ENUM_XML_TAG.REF_LINE_DEF:modifiedKey=value.modifiedPropertyKeys[0];if(modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COMBINED_STYLE||modifiedKey===ENUM_XML_TAG.TREND_REF_LINE_COLOR){this.updateTrdAndRefLineStyle(".gm-set-referenceline",value,option);}else{this.updateChartFontStyle(propName,CTRL_TYPE.GM_REF_LABEL,value);}break;case ENUM_XML_TAG.TREND_LINE_DEF:this.updateTrdAndRefLineStyle(".gm-set-trendline",value,option);break;case ENUM_FORMAT_TAG.REF_LABELS_FONT_COLOR:case ENUM_FORMAT_TAG.REF_LABELS_FONT_STYLE:this.updateChartFontStyle(propName,CTRL_TYPE.GM_REF_LABEL,value);break;default:return false;}return true;},updateGridLine:function(axis){var axisUpper=axis.toUpperCase();this.updateGridLineValue(axisUpper);},updateAxisLabelFontColor:function(axis,newValue){this.updateAxesManagerColor(axis,"label",newValue);},updateAxisTitleFontColor:function(axis,newValue){this.updateAxesManagerColor(axis,"title",newValue);},},mstrmojo.mixin(mstrmojo.gm._GMPropertyHandler)));}());