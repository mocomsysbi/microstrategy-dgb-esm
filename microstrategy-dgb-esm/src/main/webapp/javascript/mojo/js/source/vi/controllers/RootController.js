(function(){mstrmojo.requiresCls("mstrmojo.vi.controllers.RootControllerBase","mstrmojo.dom","mstrmojo.dnd","mstrmojo.hash","mstrmojo.css","mstrmojo.func","mstrmojo.array","mstrmojo.color","mstrmojo._DocToolbarActions","mstrmojo.DI.controller.DIDialogController","mstrmojo.DI.DIConstants","mstrmojo.DI.DIDataService","mstrmojo.DI.DIHelpers","mstrmojo.vi.enums.EnumFeatures","mstrmojo.vi.ui.RootView","mstrmojo.vi.ui.WorkstationRootView","mstrmojo.vi.ui.toolbars.RootToolbar","mstrmojo.ui.pathbar.PathBar","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.controllers.DocumentController","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.controllers.ControlUtils","mstrmojo.vi.ui.Annotations","mstrmojo.Popup","mstrmojo.vi.ui.rw.DocRelativePanel","mstrmojo.vi.ui.rw.DocQuillTextField","mstrmojo.PerformanceLogOutput","mstrmojo.mstr.EnumDSSXMLObjectTypes","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.gmaps.MapEnums","mstrmojo.vi.util.NavUtility","mstrmojo.vi.ui.LayoutsMenuConfig","mstrmojo.vi.ui.VisFilterInlineDialog","mstrmojo.vi.ui.ToggleViewBar","mstrmojo.vi.ui.GroupingInlineDialog","mstrmojo.vi.VIPrompt","mstrmojo.CustomGroupEditor","mstrmojo.ME.MetricIDE","mstrmojo.SharingEditor","mstrmojo.vi.enums.EnumThemeProperties");mstrmojo.requiresClsP("mstrmojo.vi.ui.editors","OpenVIEditor","ImportVIEditor","DocPropsEditor","DashboardStylesEditor");mstrmojo.requiresClsP("mstrmojo.ui.menus","ToolbarConfig","MenuConfig");mstrmojo.requiresClsP("mstrmojo.vi.ui.tutorial","TutorialView","WelcomeEditor");mstrmojo.requiresDescs(15761,15762,15780,15782,8445,9242,9849,14112,13406,13573,15495,13915,13980,13981,14281,14282,14304,14329,15530,15276,15277,15278,14875,14873,14874,14876,15432,16118);var $MOJO=mstrmojo,$HASH=$MOJO.hash,$CSS=$MOJO.css,$DOM=$MOJO.dom,$DECODE=$MOJO.color.decodeColor,$DESC=mstrmojo.desc,$FUNC=$MOJO.func,$EMPTY_FUNC=$MOJO.emptyFn,$ARR=$MOJO.array,$DI=$MOJO.DI,$NUM=mstrmojo.num,$DIHELP=$DI.DIHelpers,$DICONST=$DI.DIConstants,$DITYPE=$DICONST.dialogType,$FEATURES=mstrmojo.vi.enums.EnumFeatures,$HIDSEC=mstrmojo.vi.enums.EnumHiddenSections,$DOCPANEL=mstrmojo.vi.ui.rw.DocRelativePanel,$PREVIEW_MODES=$DOCPANEL.EnumPreviewModes,$PerfLog=mstrmojo.PerformanceLogOutput,$NAVIGATION=mstrmojo.vi.util.NavUtility,$VI_TYPES=mstrmojo.vi.models.VIComponentMap.TYPES,STYLE_SEARCH_BOX=9,UTILS=mstrmojo.vi.controllers.ControlUtils,DSM={IN_MEMORY:1,DIRECT_ACCESS:2};var DARK_THEME_ID="F1FED8AC42B57AC1B0E9518FED0F89D6",LIGHT_THEME_ID="21E8ECEA4EACEA161B5828BD79A4B1E2",DEFAULT_THEME_ID="0C2437E3440A676379C06C8C7C6E2AA6";var ENUM_LAYOUT_STYLE=mstrmojo.vi.ui.editors.DashboardStylesEditor.ENUM_LAYOUT_STYLE,ENUM_LAYOUT_THEME=mstrmojo.vi.enums.EnumThemeProperties.ENUM_LAYOUT_THEME;mstrmojo.vi.controllers.ToolbarButton=null;function addViewToRoot(view,propName,methodName){this[propName]=view;this.view[methodName](view);return view;}function getLightThemeForceDisplayed(){return !!this.forceLightThemeDisplayed;}function isCustomTheme(theme){return(theme&&theme.did!==LIGHT_THEME_ID&&theme.did!==DARK_THEME_ID&&theme.did!==DEFAULT_THEME_ID);}function getDisplayThemeName(themeID,themeName){switch(themeID){case DARK_THEME_ID:return mstrmojo.desc(15385,"Dark Theme (deprecated)");case LIGHT_THEME_ID:return mstrmojo.desc(16043,"Classic Theme");case DEFAULT_THEME_ID:return mstrmojo.desc(15426,"Default Theme");default:return themeName;}}function hasTheme(fn){var themes=mstrConfig.paletteThemes.themes,result=false;if(themes.length>1){$ARR.forEach(themes,function(theme){result=fn(theme);return !result;});}return result;}function hasCustomTheme(){return hasTheme(isCustomTheme);}function hasDefaultTheme(){return hasTheme(function(theme){return(theme&&theme.did===DEFAULT_THEME_ID);});}function getCurrShownPanels(){var rootCtrl=this,panels=["tocPanel","datasetsPanel","editPanel","filterPanel","propertiesPanel","galleryPanel"],currShownPanels=[],panel;$ARR.forEach(panels,function(panelName){if(panelName==="tocPanel"){if(rootCtrl.view.isCPVisible){currShownPanels.push(panelName);}}else{panel=getPanel.call(rootCtrl,panelName);if(panel&&panel.getOpenStatus()){currShownPanels.push(panelName);}}});return currShownPanels;}function hasTableErrors(ds){if(!ds){return false;}return Object.keys(ds).some(function(key){if(ds[key].tables&&ds[key].dsm!==DSM.IN_MEMORY){return ds[key].tables.some(function(table){return table.dbRole;});}});}function getDiDialogController(){if(!this.diDialogController){this.diDialogController=new mstrmojo.DI.controller.DIDialogController();}return this.diDialogController;}function getPanel(type){var panel=this[type];if(panel){return panel;}return this.docCtrl.getViPanel(type);}function getDisabledDescription(cmd){return{toggleFilterPanel:$DESC(15432,"There is no filter in this dossier")}[cmd];}function hasTbToggleHandler(cmd){return["DisplayPanel","ToggleContentsPanel","addPanel","togglePathbar","togglePresentationMode","togglePauseMode","toggleAutoRefresh","togglePreviewMode"].indexOf(cmd)>-1;}function getTbToggleHandler(cmd,cmdId,state){var $this=this;switch(cmd){case"DisplayPanel":return function(){$this.setPanelDisplay(cmdId,state);};case"ToggleContentsPanel":return function(){$this.view.setIsCPVisible(state);};case"addPanel":return function(){var view=$this.docCtrl.view,lk=view.model.getCurrentLayoutKey();view.builder.getLayoutVIMap(lk).getComponent(mstrmojo.vi.models.VIComponentMap.TYPES.VIZ_CONTENT).addPanel();};case"togglePathbar":return function(){this.view.togglePathbar();};case"togglePresentationMode":return function(ctxt){this.togglePresentationMode(ctxt);};case"togglePauseMode":return function(ctxt){this.togglePauseMode(ctxt);};case"togglePreviewMode":return function(ctxt){this.togglePreviewMode(ctxt);};case"toggleAutoRefresh":return function(ctxt){$this.docCtrl.toggleAutoRefresh(ctxt);$this.generateToolbar();console.log(JSON.stringify(ctxt));};}return mstrmojo.emptyFn;}function getTbToggleTooltip(menuItem,menuItemCmd){var tooltipOn=menuItem.ttp,tooltipOff=menuItem.ttpOff;if(menuItemCmd==="toggleAutoRefresh"){tooltipOn=tooltipOn.replace("##",this.docCtrl.model.rf);}return{on:tooltipOn,off:tooltipOff};}function getTbToggleState(cmd,cmdId){var docModel=this.docCtrl.model,view=this.view;switch(cmd){case"DisplayPanel":var panel=getPanel.call(this,cmdId);return panel&&panel.getOpenStatus();case"ToggleContentsPanel":return view.isCPVisible;case"togglePathbar":return view.getPathbarState();case"togglePresentationMode":return mstrApp.isAppStatePresentation()&&!mstrApp.enhancedPrensetation;case"togglePauseMode":return !mstrApp.isAppStatePause();case"SwitchPalette":case"SwitchCustomPalette":return docModel.plt?docModel.plt.did:"";case"SwitchTheme":case"SwitchCustomTheme":return docModel.thm?docModel.thm.did:"";case"toggleAutoRefresh":return !!this.docCtrl.isAutoRefreshStarted();case"togglePreviewMode":return mstrApp.isLayoutModePreview()?$PREVIEW_MODES.DefaultPreview:$PREVIEW_MODES.DefaultDesktop;}}function getTbEnabledState(cmd){var docCtrl=this.docCtrl,cmdMgr=docCtrl.cmdMgr,docModel=docCtrl.model,isPauseMode=mstrApp.isAppStatePause(),isPreviewMode=mstrApp.isLayoutModePreview();switch(cmd){case"undo":return cmdMgr.canUndo()&&!isPreviewMode;case"redo":return cmdMgr.canRedo()&&!isPreviewMode;case"saveToInbox":return(mstrApp.isSingleTier||!mstrmojo.resolveFeature("auto-add-history-list"))&&!isPauseMode;case"toggleFilterPanel":return docModel.toolbarModelStates.presModeFiltersAvailable;case"togglePreviewMode":return mstrApp.supportFeature($FEATURES.SUPPORT_RESPONSIVE_RESIZING)?!isPreviewMode||parseInt(this.view.documentView.layoutViewer.docLayout.docSection.width,10)>=$DOCPANEL.getLayoutBreakPoint():true;case"insertFilter":return !(isPauseMode&&docModel.hasRADataset()||isPreviewMode);case"saveAs":return !(isPauseMode&&docModel.hasUnpublishedCube())&&docModel.copyable;case"dSave":return docModel.copyable&&!(isPauseMode&&mstrApp.isWorkstation&&!mstrApp.getWSLiveMode());case"insertVisualization":case"insertText":case"insertImage":case"insertHtml":case"enterGroupingMode":return !isPreviewMode;case"togglePresentationMode":case"openNLP":return !(isPauseMode||isPreviewMode);case"refresh":case"printPDF":case"print":case"exportMSTR":case"scheduleHL":case"scheduleEmail":case"sendNow":case"createPersonalView":case"savePromptOption":return !isPauseMode;case"togglePauseMode":return !(isPauseMode&&docModel.hasUnpublishedCube());default:return true;}}function getTbSelectedState(cmd){switch(cmd){case"togglePreContentsPanel":return this.view.isCPVisible;case"toggleFilterPanel":return this.docCtrl.getViPanel("filterPanel")?true:false;default:return false;}}function getTbTitleState(cmd){switch(cmd){case"chapterPageTitle":return true;default:return false;}}function getToolbarVisibleState(command,commandId){var docModel=this.docCtrl.model,isPresentation=mstrApp.isAppStatePresentation(),isEnhancedPresentation=!!mstrApp.enhancedPrensetation,isAutoRefresh=this.docCtrl.isAutoRefreshEnabled(),isWSStyling=!!mstrApp.isWSStyling,canRefresh=!docModel.hasLTSDataset(docModel.datasets)||docModel.allowReExecuteRegularReport();if(command==="DisplayPanel"){if(commandId==="pageByPanel"){var stackKey=docModel.getVIPanelKeyFromUnits(mstrmojo.vi.models.EnumPanelTypes.PAGEBY);return !docModel.getTargetDefn(stackKey)[stackKey].empty;}else{if(commandId==="galleryPanel"||commandId==="propertiesPanel"){return mstrApp.allowWebDashboardDesign();}}}else{if(commandId==="help"){return !mstrApp.isSingleTier;}else{if(command==="importFile"){return !mstrmojo.resolveFeature("single-workingset")&&(!mstrmojo.resolveFeature("disable-access-data-from-file")||!mstrmojo.resolveFeature("disable-access-data-from-database")||!mstrmojo.resolveFeature("disable-access-data-from-cloud-app"));}else{if(command==="convertToDoc"){return !!mstrmojo.resolveFeature("documents-design-mode");}else{if(command==="dSave"){var hasSavePermission=true;if(mstrApp.isWorkstation&&!mstrApp.features["user-can-write"]&&mstrApp.getWSLiveMode()){hasSavePermission=false;}return(!isPresentation||isPresentation&&isEnhancedPresentation&&!mstrApp.isShare)&&hasSavePermission;}else{if(commandId==="addDS"){return !mstrmojo.resolveFeature("web-disable-manage-document-dataset")&&!this.datasetsPanel.model.hasMDXRADataset();}else{if(commandId==="newDS"){return(!mstrmojo.resolveFeature("vi-unsupport-create-edit-rolap-report")&&!!mstrmojo.resolveFeature("web-is-schema-defined"))||!!mstrApp.isWorkstation;}else{if(commandId==="insertVI"||commandId==="insert"||commandId==="dashboardStyles"||commandId==="formatObject"||commandId==="addChapter"||commandId==="addPage"){return mstrApp.allowWebDashboardDesign();}else{if(commandId==="refresh"){return canRefresh&&(!isPresentation||(isPresentation&&!isAutoRefresh));}else{if(commandId==="refreshPulldown"){return canRefresh&&!!isAutoRefresh;}else{if(commandId==="autoRefreshOn"){return !!isAutoRefresh;}else{if(commandId==="autoRefreshOff"){return !isAutoRefresh;}else{if(commandId==="annotationMode"){return !isPresentation;}else{if(commandId==="download"||commandId==="import"){return !this.datasetsPanel.model.hasMDXRADataset();}else{if(command==="togglePreContentsPanel"){return isPresentation&&isWSStyling;}else{if(command==="toggleFilterPanel"){return isPresentation&&isWSStyling;}else{if(command==="togglePreviewMode"){return !isPresentation&&isWSStyling;}else{if(command==="savePromptOption"){return !docModel.isnew;}else{if(command==="reprompt"){return isWSStyling&&(docModel.hasPrompted==="1"||!!docModel.prompted)&&!(mstrApp.isWorkstation&&mstrApp.getWSLiveMode&&!mstrApp.getWSLiveMode());}else{if(commandId==="SwitchTheme"){return hasCustomTheme()||hasDefaultTheme()||this.isDarkThemeEnabled()||getLightThemeForceDisplayed.call(this);}else{if(commandId==="shareByLinkMSTRLibrary"){return !mstrApp.isWorkstation&&mstrConfig&&mstrConfig.features&&mstrConfig.features["show-dossier-library-link"]&&!!mstrConfig.libraryWebBaseURL;}else{if(commandId==="presentationMode"){return !isEnhancedPresentation;}else{if(commandId==="dlmt"){return !isEnhancedPresentation;}else{if(commandId==="openNLP"){return !docModel.hasRADataset();}}}}}}}}}}}}}}}}}}}}}}}}return true;}function getCurrentProject(callback){mstrApp.serverRequest({taskId:"IsCurrentProj",gpjn:true},{success:function(res){callback.success(res);},failure:$EMPTY_FUNC},{silent:true});}function modifyMenuState(menuItemId,menuItemDesc,menuItemCmd,menuCfg){switch(menuItemId){case"importCube":getCurrentProject({success:function(res){if(res!==null){var projName=res.pn;if(!projName){menuItemDesc=(mstrApp.isSingleTier)?$DESC(14304,"Dataset from Server..."):$DESC(13573,"Existing Dataset...");}else{menuItemDesc=$DESC(14329,"Dataset from ##...").replace("##",projName);}}var menuItem=menuCfg.getMenuItem(menuItemId);if(menuItem){menuItem.n=menuItemDesc;}}});break;}}function setThemeCssClass(themeID){this.view.set("themeClassName",(themeID==="F1FED8AC42B57AC1B0E9518FED0F89D6"&&!mstrApp.isWSStyling)?"mojo-theme-dark":"mojo-theme-light");}function getLayoutTheme(layoutStyle){return(layoutStyle==ENUM_LAYOUT_STYLE.CARD||layoutStyle==ENUM_LAYOUT_STYLE.BASIC)?ENUM_LAYOUT_THEME.DEFAULT:ENUM_LAYOUT_THEME.CLASSIC;}function showUndoActionTooltip(){var openUndoActionTooltip=function(){var toolbar=this.toolbar,undoN="undo",idx=$ARR.find(toolbar.items,function(item){return item.n===undoN;});if(idx>-1){var linkPos=$DOM.position(toolbar._getItemNode(idx)),editorId="mstrTooltipEditor",docCtrl=this.docCtrl;if(!mstrmojo.all[editorId]){this.addDisposable([mstrmojo.insert({scriptClass:"mstrmojo.Editor",markupString:'<div id="{@id}" class="undoApplyTheme mstrmojo-Editor-wrapper"><div class="mstrmojo-Editor undoApplyTheme mstrmojo-Tooltip vi-regular vi-tooltip-A" style="z-index:{@zIndex}; left:{@left}; top:{@top}; display:block" mstrAttach:mouseup,mousedown,click,contextmenu><div class="mstrmojo-Editor-titlebar-none"></div><div class="mstrmojo-Editor-titleSpacer-none"></div><div class="mstrmojo-Editor-content mstrmojo-Tooltip-contentWrapper" style="z-index:8;"></div><div class="mstrmojo-Tooltip-arrow" style="z-index:9;"></div><div class="mstrmojo-Editor-curtain"></div></div>',id:editorId,showTitle:false,children:[{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-Tooltip-content",slot:"containerNode",children:[{scriptClass:"mstrmojo.Label",cssClass:"name icn",text:mstrmojo.desc(16188,"Would you like to revert the theme?")},{scriptClass:"mstrmojo.Label",cssClass:"name",text:mstrmojo.desc(16189,"Click undo to change back to your previous formatting.")},{scriptClass:"mstrmojo.Box",alias:"btns",cssClass:"mstrmojo-btns",children:[mstrmojo.Button.newWebButton(mstrmojo.desc(3482,"Undo"),function(){docCtrl.undo();mstrmojo.all[editorId].close();},true,{cssDisplay:"inline-block"}),mstrmojo.Button.newWebButton(mstrmojo.desc(8607,"Dismiss"),function(){mstrmojo.all[editorId].close();},false,{cssDisplay:"inline-block"})]}]}]})]);mstrmojo.all[editorId].open(null,{left:linkPos.x+4+"px",top:(linkPos.y+linkPos.h+2)+"px"});}}};this.checkToOpenUndoActionTooltip(openUndoActionTooltip.bind(this));}function setLayoutTheme(layoutStyle){this.view.set("layoutStyle",layoutStyle);this.view.set("layoutTheme",getLayoutTheme(layoutStyle));}function submitThemePaletteUpdate(action,callback){var docCtrl=this.docCtrl,docCtrlModel=docCtrl.model;docCtrl.submitUndoRedoUpdates([action],null,$FUNC.wrapMethods($FUNC.wrapMethods(docCtrl.model.getUpdateThemePaletteCallback(),{success:function(res){setThemeCssClass.call(this,res.thm.did);docCtrlModel.layoutstyle=res.layoutstyle;setLayoutTheme.call(this,res.layoutstyle);this.generateToolbar();}.bind(this)},$FUNC.wrapMethods(docCtrl.getRefreshCallback(),docCtrlModel.restoreVFConfigMode())),callback),mstrmojo.DocDataService.REQUEST_DEFN_DATA);}function tbRadioMenuValueChangeHandler(v,vWas,option){if(getLightThemeForceDisplayed.call(this)&&option.cmd==="SwitchTheme"){this.setTheme(v);return true;}var wasChanged=v!==vWas;if(wasChanged){switch(option.cmd){case"SwitchTheme":case"SwitchCustomTheme":this.confirmApplyTheme(option.text,v);break;case"SwitchPalette":case"SwitchCustomPalette":this.setPalette(v);break;}}return wasChanged;}function getToolbarContext(cmd){if(!cmd){return null;}var $this=this;return $this[cmd]?$this:$this.docCtrl;}function getToolbarButtonDescription(cmd,button){var desc=button&&button.desc,isPauseMode=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();if(cmd==="togglePauseMode"){desc='<div class="name pause">'+desc+'</div><div class="dsc pause">'+mstrmojo.desc(15781,"Edit the dossier without retrieving data")+"</div>";}else{if(isPauseMode&&!getTbEnabledState.call(this,cmd)){if(cmd!=="undo"&&cmd!=="redo"){desc='<div class="name pause disabled">'+desc+'</div><div class="dsc pause disabled">'+mstrmojo.desc(15784,"Requires Dossier Execution")+"</div>";}}}return desc;}function getToolbarButtonDescriptionOff(cmd,button){var desc=button&&button.descOff,isPauseMode=mstrApp.isAppStatePause&&mstrApp.isAppStatePause();if(cmd==="togglePauseMode"){if(this.docCtrl&&this.docCtrl.model&&this.docCtrl.model.hasUnpublishedCube()){desc='<div class="name pause disabled">'+desc+'</div><div class="dsc pause disabled unpublished">'+mstrmojo.desc(15802,"The dossier contains unpublished cubes")+"</div>";}else{desc='<div class="name pause">'+desc+'</div><div class="dsc pause">'+mstrmojo.desc(15783,"Dossier will retrieve data for editing")+"</div>";}}else{if(isPauseMode&&!getTbEnabledState.call(this,cmd)){if(cmd!=="undo"&&cmd!=="redo"){desc='<div class="name pause disabled">'+desc+'</div><div class="dsc pause disabled">'+mstrmojo.desc(15784,"Requires Dossier Execution")+"</div>";}}}return desc;}function getToolbarButtonFunction(cmd){if(!cmd){return null;}var cmdContext=getToolbarContext.call(this,cmd);return function(item,widget){cmdContext[cmd](item,widget);};}function getMenuConfig(menuItems){if(!menuItems){return null;}var menuCfg=new mstrmojo.ui.menus.MenuConfig(),me=this;menuItems.forEach(function(menuItem,menuItemIndex){var menuItemCmd=menuItem.cmd,menuItemId=menuItem.n,menuItemDesc=menuItem.desc,subMenuItems=menuItem.items,getCustomItemMarkupFunc=null,themes=mstrConfig.paletteThemes.themes,isMenuItemDisabled=mstrApp.isInVFConfigMode?(menuItemCmd!=="showHelpTopic"):!getTbEnabledState.call(this,menuItemCmd);if(!getToolbarVisibleState.call(this,menuItemCmd,menuItemId)){return ;}if(menuItemId==="SwitchTheme"){if(themes){var thmId;themes.sort(function(a,b){if(a.did===DEFAULT_THEME_ID){return -1;}if(b.did===DEFAULT_THEME_ID){return 1;}return 0;});subMenuItems=$ARR.filter(themes.map(function(thm){if(!isCustomTheme(thm)){thmId=thm.did;if(!me.isDarkThemeEnabled()&&thmId===DARK_THEME_ID){return ;}return{n:thmId,desc:getDisplayThemeName(thmId,thm.n),cmd:menuItemId};}}),function(itm){return !!itm;});if(menuItem.items&&hasCustomTheme()){subMenuItems=subMenuItems.concat([$ARR.filterOne(menuItem.items,function(item){return item.n==="SwitchCustomLabel";})]);}}}else{if(menuItemId==="SwitchCustomTheme"){if(themes){subMenuItems=menuItem.items=$ARR.filter(themes.map(function(thm){if(isCustomTheme(thm)){return{n:thm.did,desc:thm.n,cmd:menuItemId};}}),function(itm){return !!itm;});}}else{if(menuItemId==="SwitchPalette"||menuItemId==="SwitchCustomPalette"){var themeId=getTbToggleState.call(this,"SwitchTheme"),paletteThemes=mstrConfig.paletteThemes,themeObj=$ARR.filterOne(themes,function(theme){return theme.did===themeId;});var customIndex=1,hasCustomPalette=false;subMenuItems=$ARR.filter((themeObj?themeObj.sup:[]).map(function(pltRef){var plt=$ARR.filterOne(paletteThemes.palettes,function(palette){return palette.pltid===pltRef.did;});if(plt&&plt.tp===1&&menuItemId==="SwitchPalette"){return{n:plt.pltid,desc:plt.n,colors:plt.colors.map(function(c){return $DECODE(c);}),cmd:menuItemId};}else{if(plt&&plt.tp!==1&&menuItemId==="SwitchCustomPalette"){return{n:plt.pltid,desc:plt.n?plt.n:("Custom "+customIndex++),colors:plt.colors.map(function(c){return $DECODE(c);}),cmd:menuItemId};}else{if(plt&&plt!==1){hasCustomPalette=true;}}}return null;}),function(itm){return !!itm;});if(menuItem.items&&hasCustomPalette&&menuItemId==="SwitchPalette"){subMenuItems=subMenuItems.concat([$ARR.filterOne(menuItem.items,function(item){return item.n==="SwitchCustomLabel";})]);}getCustomItemMarkupFunc=function getCustomItemMarkupFunc(radio,radioIdx){return function getItemMarkup(){var colors=subMenuItems[radioIdx].colors,pm='<div class="paletteColors">',len=Math.min(colors.length,9),i;for(i=0;i<len;i++){pm+='<div class="colorIcon" style="background-color: '+colors[i]+'"></div>';}pm+="</div>";return'<{@tag} class="item {@cls} hasPaletteColors" idx="{@idx}" style="{@style}"><div class="palette-name">{@n}</div>'+pm+"</{@tag}>";};};}}}if(hasTbToggleHandler(menuItemCmd)){if(isMenuItemDisabled){menuCfg.addNonInteractiveMenuItem(menuItemDesc,"",isMenuItemDisabled);}else{var toggleState=getTbToggleState.call(this,menuItemCmd,menuItemId),toggleTooltip=getTbToggleTooltip.call(this,menuItem,menuItemCmd);menuCfg.addToggleMenuItem({on:menuItemDesc,off:menuItem.descOff||menuItemDesc,ttpOn:toggleTooltip.on,ttpOff:toggleTooltip.off},menuItemId+" tg",getTbToggleHandler.call(this,menuItemCmd,menuItemId,true),getTbToggleHandler.call(this,menuItemCmd,menuItemId,false),this.id,toggleState);}}else{if(subMenuItems){if(menuItem.hasRadioGroup){if(menuItemDesc){menuCfg.addMenuItem(menuItemDesc,"lbl",function(){return false;});}var radios=[];subMenuItems.forEach(function(item){if(item&&item.n!=="SwitchCustomLabel"){radios.push({text:item.desc,value:$NUM.isInt(item.value)?item.value:item.n,cmd:item.cmd,cls:item.n});}});menuCfg.addRadioMenuGroup(getTbToggleState.call(this,menuItemId),tbRadioMenuValueChangeHandler,radios,menuItemId+" tg",this,true,getCustomItemMarkupFunc);subMenuItems.forEach(function(item){if(item&&item.n==="SwitchCustomLabel"){menuCfg.addSubMenuItem(item.desc,item.n,me.id,function(){return getMenuConfig.call(me,item.items);});return false;}});}else{menuCfg.addSubMenuItem(menuItemDesc,menuItemId,this.id,function(){return getMenuConfig.call(this,subMenuItems);});}}else{if(menuItemCmd){if(isMenuItemDisabled){if((menuItemCmd==="dSave"||menuItemCmd==="saveAs")&&!this.docCtrl.model.copyable){menuItemDesc={n:menuItemDesc,ttp:$DESC(16118,"Saving is not available for this dossier as the data has been limited for your specific user.")};}menuCfg.addNonInteractiveMenuItem(menuItemDesc,"",isMenuItemDisabled);}else{menuCfg.addMenuItem(menuItemDesc,menuItemId,getToolbarButtonFunction.call(this,menuItemCmd),getToolbarContext.call(this,menuItemCmd));modifyMenuState.call(this,menuItemId,menuItemDesc,menuItemCmd,menuCfg);}}else{if(menuItemDesc){menuCfg.addMenuItem(menuItemDesc,"lbl",function(){return false;});}else{var shouldAddSeparator=menuItems.slice(menuItemIndex).some(function(item){return item.n!=="dlmt"&&getToolbarVisibleState.call(this,item.cmd,item.n);},this);if(shouldAddSeparator){menuCfg.addSeparator();}}}}}},this);return menuCfg;}var ENUM_PRESENTATION_STATE_OFF=0,ENUM_PRESENTATION_STATE_EXCLUSIVEON=2,ENUM_PREVIEW_STATE_OFF=0;function getButtonTooltipStr(button){if(button.n==="refreshPulldown"){var docCtrl=this.docCtrl;if(docCtrl.isAutoRefreshEnabled()){if(docCtrl.isAutoRefreshStarted()){return $DESC(14281,"Auto refresh every ## seconds. Use dropdown option to pause.").replace("##",docCtrl.model.rf);}return $DESC(14282,"Auto refresh is paused. Use dropdown option to resume.");}}return button.desc||"";}function toggleTutorial(){if(mstrApp.getShowVITutorial()&&!mstrApp.tutorialShown){mstrApp.rootCtrl.showTutorial({cls:"initial"});mstrApp.tutorialShown=true;}else{mstrApp.rootCtrl.hideTutorial();}}function showWelcomeEditor(samples,isInitialRun){(mstrmojo.all.mstrVIWelcome||new mstrmojo.vi.ui.tutorial.WelcomeEditor({title:$DESC(13406,"Getting Started"),id:"mstrVIWelcome",samplesData:samples,isInitialRun:isInitialRun,hasSamples:samples&&(samples.length>0),toggleTutorial:toggleTutorial})).open();}function toggleEnhancedPresentationMode(toggleFlag){if(toggleFlag){mstrApp.enhancedPrensetation=!mstrApp.enhancedPrensetation;}mstrmojo.css.toggleClass(this.view.domNode,"enhanced",mstrApp.enhancedPrensetation);}function stdFullScreenEventHandler(){var winDoc=window.document;if(mstrmojo.resolveFeature("edit-ive")&&mstrApp.isAppStatePresentation()&&!winDoc.fullscreenElement&&!winDoc.mozFullScreenElement&&!winDoc.webkitFullscreenElement&&!winDoc.msFullscreenElement){this.togglePresentationMode();}}function ieFullScreenEventHandler(evt){if(evt.keyCode===122){if(mstrApp.isAppStatePresentation()&&!this.skipFullScreenEvent){this.skipFullScreenEvent=true;this.togglePresentationMode();}delete this.skipFullScreenEvent;}}function escKeyPresentationModeEventHandler(evt){if(evt.keyCode===27){this.togglePresentationMode();}}function showDataImport(config){var di;if(this.dataImportId){di=mstrmojo.all[this.dataImportId];}if(!di){di=mstrmojo.insert(mstrmojo.DI.DIContainer);}this.dataImportId=di.id;$HASH.copy(config.cfg,di.dataImportParams);di.dataImportCallback=config.callback;di.open();}function openDIForMultipleCubeRefresh(datasets,docId,rwb,closeInfo){var ds=[];$HASH.forEach(datasets,function(dataset){ds.push({cube_id:dataset.did,cname:dataset.cubename,ddam:dataset.ddam,mdt:dataset.mdt,sz:"0",st:dataset.st});});showDataImport({cfg:{isEdit:false,datasets:{cubes:{cube:ds}},StatusCode:2,refreshMultipleCubes:true,rwb:rwb},callback:function(publishedDataset){var orignDS=$HASH.keyarray(datasets)||[],isResolveOnly=!!(mstrConfig.resolveOnly||mstrApp.isAppStatePause&&mstrApp.isAppStatePause());publishedDataset=publishedDataset||[];if(publishedDataset.length>=orignDS.length){mstrmojo.form.send({evt:3140,src:mstrApp.name+".3140",documentID:docId,resolveOnly:isResolveOnly});}else{mstrmojo._DocToolbarActions.close.call({model:{isnew:false,pfid:closeInfo.pfid,sysFolder:closeInfo.sysFolderId}});}}});}function getCubesInfo(cubeIds,callback){mstrApp.serverRequest({taskId:"getUserDICubeInfo",cubeIds:cubeIds.join(",")},{success:function(cubesInfo){callback(cubesInfo);}});}function sendGetUserDICubeInfoTask(cubesInfo,docId,rwb,closeInfo){var cubeIds=[];$HASH.forEach(cubesInfo,function(cubeInfo){cubeIds.push(cubeInfo.did);});getCubesInfo(cubeIds,function(res){var cubeId,filteredRes={};$HASH.forEach(cubesInfo,function(cubeInfo){cubeId=cubeInfo.did;if(res&&res[cubeId]&&(!res[cubeId].published)){res[cubeId].cubename=cubeInfo.n;res[cubeId].st=(res[cubeId].st&&res[cubeId].st!==-1)?res[cubeId].st:cubeInfo.st;filteredRes[cubeId]=res[cubeId];}});openDIForMultipleCubeRefresh(filteredRes,docId,rwb,closeInfo);});}function toggleCloseBtn(panelName,enable){var panel=getPanel.call(this,panelName),boxPanelContainer=panel&&panel.parent;if(boxPanelContainer&&boxPanelContainer.toggleCloseButton){boxPanelContainer.toggleCloseButton(enable);}}function setPanelsDisplay(panelNames,isVisible,enableCloseButton){var rootCtrl=this;$ARR.forEach(panelNames,function(panelName){if(panelName==="tocPanel"){rootCtrl.view.setIsCPVisible(isVisible,true);}else{rootCtrl.setPanelDisplay(panelName,isVisible,true);}if(enableCloseButton===true||enableCloseButton===false){toggleCloseBtn.call(rootCtrl,panelName,enableCloseButton);}});}mstrmojo.vi.controllers.RootController=mstrmojo.declare(mstrmojo.vi.controllers.RootControllerBase,[mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.controllers.RootController",view:null,docCtrl:null,document:null,datasetsPanel:null,dataProvider:null,tocPanel:null,galleryPanel:null,installedEventListeners:null,wrapUpDataImport:function(){var cb=this.DICallback,model=this.docCtrl&&this.docCtrl.model;if(cb&&model){model.getDataService().refresh({styleName:"JsonRWDStyle",fresh:true},{success:function(res){cb(res);}});}},hideTutorial:function hideTutorial(){var tutorial=mstrmojo.all.tutorial;if(tutorial){tutorial.destroy();}},handleFirstTimeUserHelp:function handleFirstTimeUserHelp(data){var datasets=data.datasets,hasDatasets=datasets&&(Object.keys(datasets).length>0);if(!hasDatasets&&mstrApp.getShowVIWelcome()){this.showWelcome({cls:"initial"});}else{if(data.isnew){toggleTutorial();}}},start:function start(startParams){var data=startParams.data,mstrErr=data.mstrerr,menubarModelData=mstrApp.menubarModelData;var view=this.view=(!!mstrApp.isWSStyling)?new mstrmojo.vi.ui.WorkstationRootView({id:"rootView",placeholder:startParams.placeholder,controller:this,hasMenubar:menubarModelData&&menubarModelData.items&&menubarModelData.items.length>0&&!mstrApp.isSectionHidden($HIDSEC.DOCKTOP)}):new mstrmojo.vi.ui.RootView({id:"rootView",placeholder:startParams.placeholder,controller:this});mstrmojo.css.addClass(window.document.body,"workstation");this.addDisposable([view]);view.render();if(mstrApp.hiddenSec&&!mstrApp.isSectionHidden($HIDSEC.PATH)){this.view.togglePathbar();}if(!mstrApp.allowWebDashboardDesign()){var domNode=view.domNode,clsNoWebDashDesign="nowebdashdesign";mstrmojo.css.addClass(domNode,clsNoWebDashDesign);}if(mstrErr){if(mstrErr.cubeinfo){if(window.mstrApp&&!mstrApp.features["web-execute-cube-report"]){view.showErrMsg($DESC(14112,"This document contains unpublished cubes.")+" "+$DESC(12933,"You do not have enough privileges to perform this operation"));}else{mstrmojo.error({longDesc:mstrErr.message},null,{buttons:[mstrmojo.Button.newWebButton($DESC(9242,"Republish"),function(){sendGetUserDICubeInfoTask(mstrErr.cubeinfo,data.docId,data.rwb,{pfid:mstrErr.pfid,sysFolderId:mstrErr.sysfolderid});},true),mstrmojo.Button.newWebButton($DESC(221,"Cancel"),function(){return true;},true)]});view.showErrMsg($DESC(14112,"This document contains unpublished cubes."));}}else{var dashboardParams={evt:3198,src:mstrApp.name+".3124"},closePageFn=$NAVIGATION.checkSessionAndSendForm.bind(this,dashboardParams,null,"post","_self"),webAPIErrorCodes=mstrmojo.mstr.EnumWebAPIErrorCodes;errorCodesToClosePageOnOk=[webAPIErrorCodes.MSI_ADDUSERJOB_ERROR,webAPIErrorCodes.MSI_INBOX_MSG_NOT_FOUND,webAPIErrorCodes.ERROR_CREATE_REPORT_INSTANCE],okFn=($ARR.indexOf(errorCodesToClosePageOnOk,mstrErr.code)!==-1)?closePageFn:$EMPTY_FUNC;mstrmojo.err({name:mstrErr.title||"",message:mstrErr.message||""},okFn);}}if(!mstrApp.error){this.loadDataAndStartController(startParams);}},loadDataAndStartController:function loadDataAndStartController(startParams){if(!mstrApp.isSingleTier){mstrmojo._FormatDefinition.getAvailableFonts();}mstrmojo.locales.load(function(){this.startControllerOnDataReady(startParams);}.bind(this));},startControllerOnDataReady:function startControllerOnDataReady(startParams){var data=startParams.data,view=this.view,me=this;if(!data.mstrerr){var fnDataAvailable=function(res){mstr_profile.timeEnd("Document Data");$PerfLog.visPrint("Receive data from backend");$PerfLog.startTimer({functionName:"RootController.startControllerOnDataReady: ",purpose:"from Data Response to End"},"timerid_fromResponsetoEnd");res.bp=mstrApp.rwbBeanPath||res.bp;mstrApp.parseSecondaryDataProviders(res);setThemeCssClass.call(this,res.thm&&res.thm.did);setLayoutTheme.call(this,res.layoutstyle);var docCtrl=this.docCtrl=new mstrmojo.vi.controllers.DocumentController({rootCtrl:this});if(res.PromptEditor){res.data={layouts:[{k:"K36",loaded:true,sections:[{k:"K7",wid:1,subsections:[{k:"K8",wid:1,objects:[{k:"K46",wid:1,selKey:"K49",panels:[{k:"K49",wid:1,objects:[]}]},{k:"K33",wid:1,selKey:"K47",panels:[{k:"K47",wid:1,objects:[{k:"K34",wid:1,selKey:"K53",panels:[{k:"K53",wid:1,objects:[{k:"K52",sid:1,wid:1,eg:"",egt:1,gsi:{rows:[],cols:[],mx:[]},ghs:{},gts:{},gvs:{}}]}]}]}]}]}]}],xtabStyles:{}}]};res.datasets={};res.defn={root:{k:"K3",dsv:true,dsw:"168px",tocv:true,tocw:"174px"},layouts:[{fmts:{width:"1056px","background-color":"#fff"},k:"K36",title:"Chapter 1",loaded:true,or:3,units:{K6:{pnk:"K36",chdidx:3,t:5,n:"",dk:0},K7:{pnk:"K6",chdidx:1,t:2,n:"",gby:"K6",dk:0},K8:{pnk:"K7",chdidx:1,fgk:"K45",fmts:{height:"553px"},t:4,n:"Analysis",vc:2,ck:{K46:1}},K46:{pnk:"K8",chdidx:1,fmts:{top:"12px",left:"48px",width:"143px",height:"324px","z-index":"1",overflow:"auto",border:"1pt solid #fefefe",ttl:{height:"19px","background-color":"#ddd",font:"8pt 'Arial'",color:"#444649","text-align":"left","vertical-align":"middle"}},t:8,n:"FiltersPanelStack",ttl:"Filters",ttlSrc:0,sw:false,od:false,ifp:true,fds:0,psType:1,empty:true},K49:{pnk:"K46",chdidx:1,fmts:{"background-color":"#eee",width:"139px",height:"301px"},t:9,n:"FiltersPanel",vc:2,hc:2,l:true,ttl:"Filters",isFilterPanel:true},K33:{pnk:"K8",chdidx:2,fmts:{top:"12px",left:"240px",width:"577px",height:"301px","z-index":"2",overflow:"auto"},t:8,n:"VisualizationContentPanelStack",ttl:"Visualization Content",ttlSrc:0,sw:false,od:false,psType:2,empty:true},K47:{pnk:"K33",chdidx:1,fmts:{"background-color":"#eee",width:"572px",height:"296px"},t:9,n:"VisualizationContentPanel",vc:2,hc:2,ck:{K34:1},l:true,ttl:"Visualization Content"},K60:{pnk:"K47",chdidx:1,fmts:{top:"12px",left:"24px",width:"529px",height:"25px","z-index":"1"},t:8,n:"PageByPanelStack",ttl:"Page By",ttlSrc:0,sw:false,od:false,psType:3,empty:true},K61:{pnk:"K60",chdidx:1,fmts:{"background-color":"#eee",width:"524px",height:"20px"},t:9,n:"PageByPanel",l:true,ttl:"Page By"},K34:{pnk:"K47",chdidx:2,fmts:{top:"48px",left:"24px",width:"527px",height:"239px","z-index":"2",overflow:"auto",border:"1pt solid #fefefe",ttl:{height:"19px","background-color":"#ddd",font:"8pt 'Arial'",color:"#444649","text-align":"center","vertical-align":"middle"}},t:8,n:"VisualizationsPanelStack",ttl:"Page 1",ttlSrc:0,sw:true,od:false,dzv:true,dzw:192,psType:4,empty:true},K53:{pnk:"K34",chdidx:1,fmts:{"background-color":"#eee",width:"524px",height:"217px"},t:9,n:"VisualizationPanel",vc:2,hc:2,l:true,ttl:"Page 1",layoutXML:{t:"b",o:"h",children:[{t:"c",k:"K52",l:100}]}},K52:{pnk:"K53",chdidx:1,fmts:{top:"28px",left:"23px",width:"457px",height:"96px","z-index":"1","background-color":"#fff",font:"10pt 'Tahoma'",ttl:{height:"19px","background-color":"#fff",font:"bold 9pt 'Arial'",color:"#444649","text-align":"center","vertical-align":"middle","white-space":"nowrap"}},t:521,n:"Visualization 1",ds:0,tt:1,eo:1,ins:1,ttl:"Visualization 1",httl:true,gpp:{gp:[{gaid:560,goid:-3,gsid:-3,v:-1},{gaid:604,goid:-3,gsid:-3,v:0},{gaid:804,goid:-3,gsid:-3,v:0},{gaid:10128,goid:-3,gsid:-3,v:-1},{gaid:30104,goid:-3,gsid:-3,v:10}]},vis:{}},K9:{pnk:"K6",chdidx:2,t:5,n:"",gby:"K6",dk:0},K10:{pnk:"K9",chdidx:1,fgk:"K35",fmts:{height:"48px"},t:4,n:"Details"},K11:{pnk:"K6",chdidx:3,t:3,n:"",gby:"K6",dk:0},K12:{pnk:"K11",chdidx:1,fmts:{height:"316px"},t:4,n:"Body Footer"},K51:{pnk:"K12",chdidx:1,fmts:{top:"48px",left:"144px",width:"457px",height:"96px","z-index":"1","background-color":"#fff",font:"10pt 'Tahoma'",ttl:{height:"19px","background-color":"#fff",font:"bold 9pt 'Arial'",color:"#444649","text-align":"center","vertical-align":"middle","white-space":"nowrap"}},t:521,n:"SourceGrid",ds:0,tt:1,eo:1,ins:1,ttl:"",httl:true,gpp:{gp:[{gaid:560,goid:-3,gsid:-3,v:-1},{gaid:604,goid:-3,gsid:-3,v:0},{gaid:804,goid:-3,gsid:-3,v:0},{gaid:10128,goid:-3,gsid:-3,v:-1},{gaid:30104,goid:-3,gsid:-3,v:10}]},vis:{}},K55:{pnk:"K12",chdidx:2,fmts:{top:"24px",left:"648px",width:"157px","z-index":"2","background-color":"#fff",font:"8pt 'Arial'",color:"#444649","text-align":"left","vertical-align":"top","white-space":"nowrap",padding:"0pt",ttl:{height:"16px","background-color":"#eee",font:"8pt 'Arial'",color:"#444649","text-align":"left","vertical-align":"middle","border-color":"#cecece","border-style":"solid","border-width":"1.0pt 0.0pt 0.0pt"}},t:111,n:"Selector1",ct:"3",ck:"1\u001eK54\u001eK55",ckey:"K55",style:0,horiz:false,multi:false,hm:2,iwm:1,tks:"K34",dsTks:"",sstyle:0,httl:true,ttl:"Selector1",ds:0,showall:false,sec:false,include:true,dk:false,cgb:{},clp:false,btot:false,htot:false,level:2},K48:{pnk:"K12",chdidx:3,fmts:{top:"168px",left:"144px",width:"457px",height:"96px","z-index":"3","background-color":"#fff",font:"10pt 'Tahoma'",ttl:{height:"19px","background-color":"#fff",font:"bold 9pt 'Arial'",color:"#444649","text-align":"left","vertical-align":"middle","white-space":"nowrap"}},t:521,n:"Show Data Grid",ds:0,tt:1,eo:1,ins:1,ttl:"",httl:true,gpp:{gp:[{gaid:560,goid:-3,gsid:-3,v:-1},{gaid:604,goid:-3,gsid:-3,v:0},{gaid:804,goid:-3,gsid:-3,v:0},{gaid:10128,goid:-3,gsid:-3,v:-1},{gaid:30104,goid:-3,gsid:-3,v:10}]},vis:{}}},dpb:true,iw:false,cgbMap:{},btn:"K51",btsd:"K48"}],efs:[]};res.currlaykey="K36";res.cbKey="K17";}var isPauseMode=mstrApp.isAppStatePause();if(!this.DICallback&&hasTableErrors(res&&res.datasets)&&!mstrConfig.resolveOnly&&!isPauseMode){if(!Array.isArray(res.datasets)){res.datasets=$DIHELP.standardizeDBRolesFormat(res.datasets);}getDiDialogController.call(this).show($DITYPE.credentialsDialog,{model:new mstrmojo.vi.models.DocModel(res),filterDatasets:true});view.togglePathbar();this.DICallback=fnDataAvailable;docCtrl.model=new mstrmojo.vi.models.DocModel(res);return ;}this.addDisposable([docCtrl]);docCtrl.start(res);function showPrompt(result){var fnOnCancel=$EMPTY_FUNC,fnOnApply=$EMPTY_FUNC,noCancel=false,PROMPT_STATE={open:1,insert:2,reprompt:3};switch(res.promptState){case PROMPT_STATE.open:fnOnCancel=function onCancel(){mstrApp.serverRequest({taskId:"exitApp"});};fnOnApply={success:function success(data){if(data.PromptEditor){showPrompt(data);}else{mstrApp.setDefaultAppState();mstrApp.start(data);}}};break;case PROMPT_STATE.insert:noCancel=true;default:fnOnApply={success:function success(data){if(data.PromptEditor){showPrompt(data);}else{mstrApp.start(data);}}};fnOnCancel=function onCancel(){mstrApp.serverRequest({taskId:"undo",stid:result.stid},docCtrl.getRefreshCallback());};break;}me.openPrompt({required:true,noCancel:noCancel,mid:result.mid,editor:result.PromptEditor,model:result.ReportInstanceModel,settings:result.Settings,onCancel:fnOnCancel,onApply:fnOnApply});}if(res.PromptEditor){showPrompt(res);}if(!!mstrApp.isWSStyling){var toggleViewBar=new mstrmojo.vi.ui.ToggleViewBar({useRichTooltip:true,ignoreLayout:true,model:me.docCtrl.model});toggleViewBar.generateToolbar();me.setToggleViewBar(toggleViewBar);}me.generateToolbar();var winDoc=window.document,hasAttachedEvent=false,standardFullScreenEventHandler=stdFullScreenEventHandler.bind(me),inetExplorerFullScreenEventHandler=ieFullScreenEventHandler.bind(me);var fullScreenChangeEvents=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];fullScreenChangeEvents.forEach(function(eventName){if(winDoc["on"+eventName.toLowerCase()]!==undefined){$DOM.attachEvent(winDoc,eventName,standardFullScreenEventHandler);this.installedEventListeners.push({evt:eventName,fn:standardFullScreenEventHandler});hasAttachedEvent=true;}},me);if(!hasAttachedEvent){var keyDown="keydown";$DOM.attachEvent(winDoc,keyDown,inetExplorerFullScreenEventHandler);me.installedEventListeners.push({evt:keyDown,fn:inetExplorerFullScreenEventHandler});}if(!this.hasUnpublishedEvt){this.hasUnpublishedEvt=this.docCtrl.model.attachEventListener("updateHasUnpublishedCube",this.id,this.unpublishedCubeChange.bind(this));}var hasNoEditPrivilege=!mstrmojo.resolveFeature("edit-ive"),isShare=mstrApp.isShare;if(hasNoEditPrivilege||isShare){me.togglePresentationMode();me.isFullScreen=hasNoEditPrivilege&&isShare;}if(!docCtrl.model.copyable&&this.toolbar&&this.toolbar.itemsContainerNode){var toolbarItems=this.toolbar.itemsContainerNode.children,saveBtnPos;saveBtnPos=$ARR.some(toolbarItems,function(item){if(item.classList.contains("save")){return $DOM.position(item);}});if(saveBtnPos){this.document.openPopup({scriptClass:"mstrmojo.Popup",locksHover:true,cssClass:"mstrmojo-VIRootToolbar mstrmojo-Tooltip vi-warning vi-tooltip-A animated-tooltip",titleNodeCssClass:"mstrmojo-Tooltip-arrow",contentNodeCssClass:"mstrmojo-Tooltip-contentWrapper",keepOpen:true,children:[{scriptClass:"mstrmojo.Label",cssClass:"save-warning-icon"},{scriptClass:"mstrmojo.Label",cssClass:"save-description",text:$DESC(16118,"Saving is not available for this dossier as the data has been limited for your specific user."),},{scriptClass:"mstrmojo.Label",text:$DESC(9849,"Learn More"),cssClass:"help-link-label",onclick:function onclick(){mstrApp.showHelpTopic("Security_Filter_Create.htm");}},mstrmojo.Button.newWebButton($DESC(8708,"OK"),function(){var popup=this.parent;popup.keepOpen=false;popup.close();})],updatePopupConfig:function updatePopupConfig(config){var popupConfig=this.popupConfig;if(!popupConfig){popupConfig=this.popupConfig=this.addDisposable(new mstrmojo.ui.PopupConfig({isHostedWithin:false}));}popupConfig.position=config.position;}},{position:{x:saveBtnPos.x,y:saveBtnPos.y+saveBtnPos.h}});}}if(mstrConfig.resolveOnly&&!isPauseMode){me.togglePauseMode();}}.bind(this);mstr_profile.log("Document data requested");mstr_profile.timeStart("Document Data");if(data.nsj){var windowDim=$DOM.windowDim(),params={innerWidth:windowDim.w,innerHeight:windowDim.h},callback={success:fnDataAvailable,failure:function(res){mstrmojo.alert((res.mstrerr&&res.mstrerr.message)||res.message||res.getResponseHeader("X-MSTR-TaskFailureMsg"));}};mstrApp.serverRequest($HASH.copy(params,{taskId:"getServerJSONResults",rwb:data.bs,messageID:data.mid,resFlags:data.ibx?16777216:0,styleName:"ServerJsonRWDStyle",excludeData:!!(mstrConfig.resolveOnly),compress:1}),callback,{src:"startControllerOnDataReady",showProgress:true,hideProgress:true,progressStateText:[$DESC(8445,"Loading")],waitBoxCfg:{showCancel:true}});}else{fnDataAvailable(data);}}else{view.togglePathbar();}},init:function init(props){this._super(props);this.installedEventListeners=[];},unpublishedCubeChange:function unpublishedCubeChange(){return mstrApp.isVI&&this.generateToolbar();},destroy:function destroy(ignoreDOM){if(this.hasUnpublishedEvt){this.docCtrl.model.detachEventListener(this.hasUnpublishedEvt);}this._super(ignoreDOM);},generateToolbar:function generateToolbar(){var app=mstrApp,modelArr=[{modelData:app.tbModelData,bar:this.toolbar}],isInPresentationMode=mstrApp.isAppStatePresentation();if((!isInPresentationMode||mstrApp.enhancedPrensetation)&&!mstrApp.isSectionHidden($HIDSEC.DOCKTOP)){modelArr.push({modelData:app.menubarModelData,bar:this.menubar});}modelArr.forEach(function(model){var modelData=model.modelData;if(!modelData){return ;}var tbCfg=new mstrmojo.ui.menus.ToolbarConfig();modelData.items.forEach(function(button){if((isInPresentationMode&&(!button.pm||ENUM_PRESENTATION_STATE_OFF===button.pm))||(!isInPresentationMode&&ENUM_PRESENTATION_STATE_EXCLUSIVEON===button.pm)){return ;}var cmd=button.cmd,buttonId=button.n,buttonDesc=getToolbarButtonDescription.call(this,cmd,button),buttonDescOff=getToolbarButtonDescriptionOff.call(this,cmd,button),menuItems=button.items,itemContext=getToolbarContext.call(this,cmd),cmdFn=getToolbarButtonFunction.call(this,cmd),menuCfg=getMenuConfig.call(this,menuItems),label=button.label,enabled;if(menuCfg){tbCfg.addDisposable(menuCfg);}if(getToolbarVisibleState.call(this,cmd,buttonId)===false){return ;}if(button.n==="addDS"&&this.docCtrl.model.hasMDXRADataset()){return ;}enabled=getTbEnabledState.call(this,cmd);if(hasTbToggleHandler(cmd)){if(!enabled){tbCfg.addDisabledToolbarBtn(getTbToggleState.call(this,cmd,buttonId)?buttonDesc:buttonDescOff,"btn "+buttonId);}else{tbCfg.addToggleToolbarButton({on:buttonDesc,off:buttonDescOff},buttonId+(enabled?"":" disabled"),(enabled?getTbToggleHandler.call(this,cmd,buttonId,true):$EMPTY_FUNC),(enabled?getTbToggleHandler.call(this,cmd,buttonId,false):$EMPTY_FUNC),this.id,getTbToggleState.call(this,cmd,buttonId));}}else{if(!enabled){var disabledDesc=getDisabledDescription(cmd),classNames="btn "+buttonId,ctxt={};if(!this.docCtrl.model.copyable&&cmd==="dSave"){disabledDesc=$DESC(16118,"Saving is not available for this dossier as the data has been limited for your specific user.");disabledDesc+="<div class='help-link-label' onclick='mstrApp.showHelpTopic(\"##HELPTOPIC##\")'>"+$DESC(9849,"Learn More")+"</div>";disabledDesc=disabledDesc.replace("##HELPTOPIC##","Security_Filter_Create.htm");classNames+=" mstrmojo-VIRootToolbar vi-warning";ctxt.hoverable=true;ctxt.posType="TL";}tbCfg.addDisabledToolbarBtn(disabledDesc||buttonDesc,classNames,ctxt);}else{if(cmd&&menuItems){tbCfg.addToolbarPickerBtn(buttonDesc,"pb "+buttonId,cmdFn,menuCfg,itemContext);}else{if(cmd){if(getTbTitleState.call(this,cmd)){var currentDefn=this.docCtrl.model.getCurrentLayoutAndUnitDefn(),currentChapter=currentDefn.layoutDefn.title,currentPage=currentDefn.layoutUnitDefn.ttl,btns=tbCfg.btns;tbCfg.addDisabledToolbarBtn(currentChapter+" : "+currentPage,"text "+buttonId);btns[btns.length-1].disallowHTML=true;}else{if(getTbSelectedState.call(this,cmd)){tbCfg.addToolbarBtn(buttonDescOff,"btn selected "+buttonId,cmdFn,itemContext,undefined);}else{tbCfg.addToolbarBtn(buttonDesc,"btn "+buttonId,cmdFn,itemContext,undefined,label);}}}else{if(menuItems){if(buttonId==="style"){menuCfg.supportsScroll=true;menuCfg.maxHeight=$DOM.getMaxScrollHeight();menuCfg.menuCssClass="menutoolbar-vitoolbar-style";}menuCfg.menuCssClass+=" vi-toolbarMenu";tbCfg.addMenuToolbarBtn(getButtonTooltipStr.call(this,button),"mb "+buttonId,menuCfg);}else{tbCfg.addToolbarBtn("",button.desc||"dlmt",$EMPTY_FUNC);}}}}}},this);model.bar.set("toolbarCfg",tbCfg);},this);this.toggleViewBar&&this.toggleViewBar.generateToolbar();},setToggleViewBar:function setToggleViewBar(toggleViewBar){if(mstrApp.isSectionHidden($HIDSEC.TOV)){toggleViewBar.visible=false;}return addViewToRoot.call(this,toggleViewBar,"toggleViewBar","setToggleViewBar");},setDatasetObjectsPanel:function setDatasetObjectsPanel(panel){if(mstrApp.isSectionHidden($HIDSEC.DATASETS)){panel.visible=false;}return addViewToRoot.call(this,panel,"datasetsPanel","setDatasetObjectsPanel");},setTocPanel:function setTocPanel(panel){return addViewToRoot.call(this,panel,"tocPanel","setTocPanel");},setGalleryView:function setGalleryView(gallery){if((mstrApp.isSectionHidden($HIDSEC.GALLERY))){gallery.visible=false;}return addViewToRoot.call(this,gallery,"galleryPanel","setGalleryView");},setDocumentView:function setDocumentView(doc){mstr_profile.log("View construction started");mstr_profile.timeStart("View construction");var result=addViewToRoot.call(this,doc,"document","setDocumentView");mstr_profile.timeEnd("View construction");return result;},closePanels:function closePanels(panelNames){var oldPanelState=this.oldPanelState=[];panelNames.forEach(function(panelName){var panel=getPanel.call(this,panelName),openState=panel&&panel.visible;if(openState&&panelName!=="tocPanel"){panel.setOpenStatus(false,true,undefined,true);}oldPanelState.push(openState);},this);},restorePanels:function restorePanels(panelNames){panelNames.forEach(function(panelName,idx){var panel=getPanel.call(this,panelName);panel.setOpenStatus(this.oldPanelState[idx],true,undefined,true);},this);delete this.oldPanelState;},getSelectorTabMenu:function getSelectorTabMenu(model,cfg){if(mstrApp.isAppStatePresentation()||mstrApp.isAppStateSelection()||!mstrApp.allowWebDashboardDesign()){return cfg;}var menuConfig=new mstrmojo.vi.ui.LayoutsMenuConfig({model:model,view:this.view});menuConfig.buildLayoutsMenuConfig();if(cfg){cfg.menus=cfg.menus.concat(menuConfig.menus);cfg.menuCssClass=menuConfig.menuCssClass;}return cfg||menuConfig;},togglePreviewMode:function togglePreviewMode(){if(mstrApp.isAppStatePrintPreview()){return ;}var layoutModes=mstrmojo.vi.VisualInsightApp.LAYOUT_MODES,wasPreview=mstrApp.isLayoutModePreview();this.adjustLayoutSectionWidth(wasPreview,true);mstrApp.set("layoutMode",wasPreview?layoutModes.DEFAULT:layoutModes.PREVIEW_TOGGLED);$CSS.toggleClass(this.view.domNode,"previewMode",!wasPreview);},onLayoutModeChange:function onLayoutModeChange(evt){if(mstrApp.isLayoutPreview(evt.valueWas)||mstrApp.isLayoutPreview(evt.value)){this.generateToolbar();}},adjustLayoutSectionWidth:function adjustLayoutSectionWidth(isPreview,isToggled){var view=this.view,layoutViewer=view.documentView.layoutViewer,docLayout=layoutViewer.docLayout,docSection=docLayout.docSection,sectionWidth=parseInt(docSection.width,10)||0;var changeMode=function changeMode(){var oldWidth=sectionWidth,newWidth,newLeft;isPreview=isToggled?!isPreview:isPreview;layoutViewer.isPreview=isPreview;if(isPreview){newWidth=Math.min(sectionWidth,$DOCPANEL.getLayoutBreakPoint());newLeft=Math.max(oldWidth-newWidth,0)/2;}else{newWidth=parseInt(docLayout.width,10)||0;newLeft=0;}docSection.domNode.style.left=newLeft+"px";docSection.set("width",newWidth+"px");};window.setTimeout(function(){changeMode();}.bind(this),0);},togglePresentationMode:function togglePresentationMode(ctxt){if(mstrApp.isAppStatePrintPreview()){return ;}var docController=this.docCtrl,view=this.view,hasNoEditPrivilege=!mstrmojo.resolveFeature("edit-ive"),isOn=hasNoEditPrivilege||!mstrApp.isAppStatePresentation(),appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,winDoc=window.document;if(!isOn){mstrmojo.dnd.enable();}var isShare=mstrApp.isShare;if(mstrApp.enhancedPrensetation===undefined&&(!isShare||isShare&&!isOn)){mstrApp.enhancedPrensetation=hasNoEditPrivilege;}if(docController){var toolbarStates=docController.model.toolbarModelStates;toolbarStates.presModeFiltersAvailable=docController.model.hasFiltersEx();toolbarStates.presModeTOCVisible=false;}var panelNames=(!!mstrApp.isWSStyling)?["toggleViewBar","datasetsPanel","galleryPanel"]:["datasetsPanel","galleryPanel"],tocPanel=this.tocPanel;if(isOn){var savedCPVisibleStatus=this.savedCPVisibleStatus=this.view.isCPVisible;if(tocPanel&&tocPanel.chapterCount===1&&tocPanel.pageCount===1&&savedCPVisibleStatus){this.view.setIsCPVisible(false,true);}this.closePanels(panelNames);}else{this.view.setIsCPVisible(this.savedCPVisibleStatus,true);this.restorePanels(panelNames);}if(!mstrApp.isSingleTier&&hasNoEditPrivilege){toggleEnhancedPresentationMode.call(this,ctxt);}if(isOn&&docController){docController.startAutoRefresh();}else{docController.stopAutoRefresh();}mstrApp.set("appState",isOn?appStates.PRESENTATION:appStates.DEFAULT);this.generateToolbar();if(mstrApp.isSingleTier){var isAppStatePresentation=mstrApp.isAppStatePresentation(),isWorkstation=!!mstrApp.isWorkstation,presentationNotify=mstrmojo.all[this._presentationNotifyId];if(ctxt!=="host"){window.FormWrapper.togglePresentationMode();}if(isAppStatePresentation&&!isWorkstation){this._presentationNotifyId=mstrmojo.notify($DESC(13915,"Press Esc to exit Presentation Mode"),null,{forceClose:true}).id;}if(!isAppStatePresentation&&presentationNotify){presentationNotify.close();}}else{if(!this.escKeyPresModeHandler){this.escKeyPresModeHandler=escKeyPresentationModeEventHandler.bind(this);}if(isOn){$DOM.attachEvent(winDoc,"keydown",this.escKeyPresModeHandler);}else{$DOM.detachEvent(winDoc,"keydown",this.escKeyPresModeHandler);}}view.updateLayoutConfig();view.doLayout();},togglePrintPreview:function togglePrintPreview(turnOn){var isInPrintPreviewState=mstrApp.isAppStatePrintPreview(),isPauseMode=mstrApp.isAppStatePause();if(turnOn===isInPrintPreviewState||mstrApp.isAppStatePresentation()){return ;}var isOff=!isInPrintPreviewState,appStates=mstrmojo.vi.VisualInsightApp.APP_STATES;var panelNames=(!!mstrApp.isWSStyling)?["toggleViewBar","tocPanel","datasetsPanel","galleryPanel"]:["datasetsPanel","galleryPanel"];if(isOff){this.closePanels(panelNames);}else{this.restorePanels(panelNames);}mstrApp.set("appState",isOff?(isPauseMode?appStates.PRINT_PREVIEW|appStates.PAUSE:appStates.PRINT_PREVIEW):(isPauseMode?appStates.PAUSE:appStates.DEFAULT));this.generateToolbar();this.view.toggleMenuToolbar(true);this.view.doLayout();},showHelpTopic:function showHelpTopic(topic){return mstrApp.showHelpTopic("About_MicroStrategy.htm");},showTutorial:function showTutorial(ctxt){var tutorial=mstrmojo.all.tutorial||this.addDisposable(new mstrmojo.vi.ui.tutorial.TutorialView({id:"tutorial",isFirstTime:ctxt&&ctxt.cls==="initial",controller:this}));tutorial.render();},showWelcome:function showWelcome(context){var samples;mstrApp.serverRequest({folderID:mstrApp.viWelcomeData.samplesFolderID,taskId:"folderBrowse",styleName:"MojoFolderStyle",includeObjectDesc:true,objectType:"55"},{success:function success(res){samples=res.items=$ARR.filter(res.items,function(item){var itemName=item.n;return(item.dvm===2048||item.dvm===8192)&&itemName!=="Airline Flight Analysis (1)"&&itemName!=="Slot Machine Performance (1)";});},complete:function complete(){if(mstrApp.isVI){showWelcomeEditor(samples,!!(context&&context.cls==="initial"));}}},{silent:true});},newVI:function newVI(){mstrApp.onNavigateOut({href:"?evt=3187&src="+mstrApp.name+".3187"},function(){mstrmojo.form.send({evt:3187,src:mstrApp.name+".3187"},null,"post");});},openVI:function openVI(){var model=this.docCtrl.view.model,pfid=model.isnew?null:model.pfid,openVIEditor=new mstrmojo.vi.ui.editors.OpenVIEditor({startingFolder:pfid,title:$DESC(15495,"Open Dossier")});openVIEditor.open();},importMSTR:function importMSTR(){var model=this.docCtrl.view.model,pfid=model.isnew?null:model.pfid,importVIEditor=new mstrmojo.vi.ui.editors.ImportVIEditor({startingFolder:pfid,title:$DESC(15530,"Import Dossier")});importVIEditor.open();},importDashboard:function importDashboard(documentID,documentType){var docView=this.docCtrl.view,model=docView.model,doid=documentID,rebuildCallBack=UTILS.rebuildAndUpdateTOCcallback.call(model),updateCallback=model.getDatasetsUpdateCallback();model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);docView.importDashboard(update,-1,null);if(documentType==mstrmojo.mstr.EnumDSSXMLObjectTypes.DocumentDefinition){update.actions[0].doid=doid;}else{if(documentType==mstrmojo.mstr.EnumDSSXMLObjectTypes.ReportDefinition){update.actions[0].rid=doid;}}this.submitUpdate(update);},urInfo:{disablePU:true,treesToRender:3,callback:$FUNC.wrapMethods(rebuildCallBack,updateCallback),extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA}});},openPrompt:function openPrompt(config){var windowSize=mstrmojo.dom.windowDim();config=config||{};function overrideFrameProcessor(){mstr.http.FrameProcessor.prototype.submit=function(){var me=this;if(!this.props.inputs.params.styleName){this.props.inputs.params.noStyle=true;}mstrApp.serverRequest(this.props.inputs.params,{success:function success(res){me.update({data:res,statusCode:200});},failure:function failure(res,errorCode){me.update({data:res,statusCode:errorCode});}});};mstr.http.FrameProcessor.prototype.update=function(res){this._clearTimeout();var r=this.props.response=res;if(parseInt(r&&r.statusCode)==200){this.props.lastSuccess=new Date();this.set("readyState",mstr.Enum.Widget.READYSTATE.SUCCESS);}else{this.set("readyState",mstr.Enum.Widget.READYSTATE.ERROR);}};}overrideFrameProcessor();var newPromptEditor=new mstrmojo.Editor({top:"40px",title:mstrmojo.desc(326,"Prompts"),cssClass:"wsprompteditor"+(config.noCancel?" noCancel":""),children:[{scriptClass:"mstrmojo.vi.VIPrompt",alias:"prompt",width:Math.min(windowSize.w*0.85,1200)+"px",editorProp:config.editor,model:config.model,settings:config.settings,mid:config.mid||"",onCancel:config.onCancel||$EMPTY_FUNC,onApply:config.onApply||$EMPTY_FUNC}],onPreClose:function onPreClose(){this.hideTooltip();this.prompt.onCancel();this.close();return false;},onClose:function onClose(){this.destroy();},monitorWindow:function monitorWindow(evt){var currentTarget=evt.currentTarget,size={w:Math.min(currentTarget.innerWidth*0.85,1200)+"px",h:Math.min(currentTarget.innerHeight*0.9,1000)+"px"};this.prompt.set("width",size.w);},onOpen:function onOpen(){if(!this._listenerProc){var id=this.id,timeoutId=null,fn=this._listenerProc=function(e){window.clearTimeout(timeoutId);timeoutId=window.setTimeout(function(){var evt=e||window.event;mstrmojo.all[id].monitorWindow(evt);},150);};$DOM.attachEvent(window,"resize",fn);}}});newPromptEditor.open();},reOpenVI:function reOpenVI(){mstrmojo.alert("OpenRecent... is under development...");},docProps:function docProps(){(new mstrmojo.vi.ui.editors.DocPropsEditor({docModel:this.docCtrl.model})).open();},togglePanel:function togglePanel(cmdId){if(cmdId==="tocPanel"){this.view.setIsCPVisible(!getTbToggleState.call(this,"ToggleContentsPanel",cmdId));}else{this.setPanelDisplay(cmdId,!getTbToggleState.call(this,"DisplayPanel",cmdId));}},togglePreContentsPanel:function togglePreContentsPanel(){this.view.setIsCPVisible(!getTbSelectedState.call(this,"togglePreContentsPanel"),true);},refreshDatasetToolbar:function refreshDatasetToolbar(){var datasetsPanel=this.datasetsPanel,datasetsCnt=datasetsPanel&&datasetsPanel.contents,datasets=datasetsCnt&&datasetsCnt.children;if(datasetsPanel){datasetsPanel.generateToolbar();}$ARR.forEach(datasets,function(dataset){dataset.generateToolbar();});},maskMenuToolbar:function maskMenuToolbar(isMasked){if(this.toolbar){this.toolbar.set("isMasked",isMasked);}if(this.toggleViewBar){this.toggleViewBar.set("isMasked",isMasked);var toggleBarSlot=this.toggleViewBar.domNode.parentNode;if(toggleBarSlot){toggleBarSlot.style.zIndex=isMasked?4:"";}}},initPanelStautsInConfigMode:function initPanelStautsInConfigMode(){var rootCtrl=this,panelsToClose=["tocPanel","filterPanel"],panelsToOpen=["datasetsPanel","editPanel","propertiesPanel","galleryPanel"];rootCtrl.cachedPanelStatus=getCurrShownPanels.call(rootCtrl);setPanelsDisplay.call(rootCtrl,panelsToClose,false);setPanelsDisplay.call(rootCtrl,panelsToOpen,true,false);rootCtrl.maskMenuToolbar(true);rootCtrl.refreshDatasetToolbar();},restorePanelStatus:function restorePanelStatus(stack){var rootCtrl=this,cachedPanelStatus=rootCtrl.cachedPanelStatus,currPanelStatus=getCurrShownPanels.call(rootCtrl),panelsToClose=$ARR.difference(currPanelStatus,cachedPanelStatus),panelsToOpen=$ARR.difference(cachedPanelStatus,currPanelStatus),FormWrapper=window.FormWrapper;mstrApp.isInVFConfigMode=false;setPanelsDisplay.call(rootCtrl,panelsToClose,false,true);setPanelsDisplay.call(rootCtrl,panelsToOpen,true,true);rootCtrl.refreshDatasetToolbar();var tabList=stack.parent&&stack.parent.tabList;if(tabList){tabList.singleSelect($ARR.find(tabList.items,"id","vi_flt"));}delete rootCtrl.cachedPanelStatus;if(FormWrapper&&FormWrapper.setVFConfigurationMode){FormWrapper.setVFConfigurationMode(0);}},setPanelDisplay:function setPanelDisplay(panelType,isVisible,noSave){var panel=getPanel.call(this,panelType),docController=this.docCtrl;if(panel){if(panel.getOpenStatus()!==isVisible){var update=docController.model.getDataService().newUpdateWithoutCmd();update.addExtras(mstrmojo.DocDataService.RAPID_EXEC);panel.setOpenStatus(isVisible,!!noSave,update);var actions=update.actions;if(actions&&actions.length&&!noSave){update.submit();}}}else{if(isVisible){docController.openViPanel(panelType,null,noSave);}}},toggleFilterPanel:function toggleFilterPanel(){this.view.toggleFilterPanel();},executeCommand:function executeCommand(cmdId,cmdValue){this.hideTutorial();switch(cmdId){case"togglePresentationMode":cmdValue="host";}(function(){if(hasTbToggleHandler(cmdId)){return getTbToggleHandler;}return getToolbarButtonFunction;}()).call(this,cmdId).call(this,cmdValue);},confirmApplyTheme:function confirmApplyTheme(themeName,themeId){var me=this;mstrmojo.confirm(mstrmojo.desc(16190,"Applying # will change the formatting in this dossier. Would you like to continue?").replace("#",themeName),{confirmBtn:{fn:function(){me.setTheme(themeId,{success:showUndoActionTooltip.bind(me)});},t:mstrmojo.desc(134,"Apply")},cancelBtn:{fn:function(){me.generateToolbar();},t:mstrmojo.desc(221,"Cancel")}},{title:mstrmojo.desc(16191,"Apply #").replace("#",themeName)});},checkToOpenUndoActionTooltip:function(openFn){var localStorage=mstrmojo.global.localStore,userID=mstrApp.userID;if(!localStorage.getItem(userID)){localStorage.setItem(userID,true);openFn();}},setTheme:function setTheme(thmid,callback){submitThemePaletteUpdate.call(this,{act:"setPreferredTheme",thmid:thmid},callback);},setPalette:function setPalette(pltid){submitThemePaletteUpdate.call(this,{act:"setPreferredPalette",pltid:pltid});},displayLightTheme:function displayLightTheme(){if(!this.forceLightThemeDisplayed){this.forceLightThemeDisplayed=true;if(!this.isDarkThemeEnabled()&&!hasCustomTheme()){this.generateToolbar();}}},dashboardStyles:function dashboardStyles(){var editorId="mstrDSE";if(!mstrmojo.all[editorId]){this.addDisposable([mstrmojo.insert({scriptClass:"mstrmojo.vi.ui.editors.DashboardStylesEditor",id:editorId,controller:this.docCtrl})]);}mstrmojo.all[editorId].open();},formatObject:function formatObject(){this.docCtrl.model.getSelectedViUnit().onFormat();},resetCmdMgr:function resetCmdMgr(){this.docCtrl.cmdMgr.reset();},showPrefsEditor:function showPrefsEditor(preferencesData){mstrmojo.onetier.controllers.RootController.prototype.showPrefsEditor.call(this,preferencesData);},showOrHideProgressBar:function showOrHideProgressBar(title,show){mstrmojo.onetier.controllers.RootController.prototype.showOrHideProgressBar.call(this,title,show);},updateProgressBar:function updateProgressBar(data){mstrmojo.onetier.controllers.RootController.prototype.updateProgressBar.call(this,data);},confirmLogout:function confirmLogout(){mstrmojo.onetier.controllers.RootController.prototype.confirmLogout.call(this);},loginToWebserver:function loginToWebserver(params){mstrmojo.onetier.controllers.RootController.prototype.loginToWebserver.call(this,params);},loginToProxy:function loginToProxy(params){mstrmojo.onetier.controllers.RootController.prototype.loginToProxy.call(this,params);},loginToProject:function loginToProject(params){mstrmojo.onetier.controllers.RootController.prototype.loginToProject.call(this,params);},openSaveToServerBrowser:function openSaveToServerBrowser(){mstrmojo.onetier.controllers.RootController.prototype.openSaveToServerBrowser.call(this);},openFromProjectBrowser:function openFromProjectBrowser(){mstrmojo.onetier.controllers.RootController.prototype.openFromProjectBrowser.call(this);},openCubeBrowser:function openCubeBrowser(callback){mstrmojo.onetier.controllers.RootController.prototype.openCubeBrowser.call(this,callback);},enterGroupingMode:function enterGroupingMode(){this.view.openInlineDialog({scriptClass:"mstrmojo.vi.ui.GroupingInlineDialog",vizContentPanel:this.docCtrl.model.getVizContentPanel()});},togglePauseMode:function togglePauseMode(){var appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,isPause=mstrApp.isAppStatePause(),docController=this.docCtrl,me=this,docModel=docController&&docController.model,cmdMgr=docModel.cmdMgr(),extras;var getCesUpdateKeys=function(scDefn,docModel){var canvasSelectors=scDefn.canvasSelectors,filterSelectors=scDefn.filterPanelSelectors,filterKeys=Object.keys(filterSelectors),res=[];res=[].concat(Object.keys(canvasSelectors));$ARR.forEach(filterKeys,function(key){var sc=filterSelectors[key],targetKeys=sc&&sc.tks&&sc.tks.split("\x1E"),style=sc.style;var selectorNode=docModel.getNodeDataByKey(key),data=selectorNode&&selectorNode&&selectorNode.data;if(!(data&&data.elms&&data.elms.length>0)&&style!==STYLE_SEARCH_BOX&&$ARR.indexOf(res,key)===-1){res.push(key);}$ARR.forEach(targetKeys,function(targetKey){if(filterSelectors[targetKey]&&$ARR.indexOf(res,targetKey)===-1){res.push(targetKey);}});});return res;},toggleState=function(){if(window.FormWrapper&&window.FormWrapper.setPauseMode){window.FormWrapper.setPauseMode(isPause?0:1);}if(isPause&&mstrConfig.resolveOnly){delete mstrConfig.resolveOnly;}var appState=isPause?appStates.DEFAULT:appStates.PAUSE;mstrApp.set("appState",appState);if(isPause){vps.defn.set("disableSelectionApply",false);}me.generateToolbar();};if(isPause){var refreshCallback=docController.getRefreshCallback(),props={extras:{params:{suppressData:true},style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.NONE}}}},vps=docModel.getVIComponent($VI_TYPES.VIZ_CONTENT);extras={style:{params:{treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH}},skipUICmdMgrOnFailure:[mstrmojo.mstr.EnumWebAPIErrorCodes.DOCDATA_PREPARE_TASK_REPORT_INCOMP],excludeData:!isPause,resolveOnly:!isPause};if(mstrApp.enableUpdate){var fnExecuteRebuild=function fnExecuteRebuild(){var update=docModel.getDataService().newUpdateWithoutCmd(props),rebuildCallback={success:function(){toggleState();},failure:function(){window.setTimeout(function(){var interimCmd=cmdMgr.curCmd,urInfo=interimCmd&&interimCmd.urInfo;if(urInfo){urInfo.callback={success:$EMPTY_FUNC};}interimCmd&&interimCmd.cancel(true);},0);},complete:function(){cmdMgr.reset();}},rebuildFn=function(update){update.extras=extras;update.addActions([{act:"rebuildDocument",disablePU:true}]);update.addCallbacks(mstrmojo.func.wrapMethods(rebuildCallback,refreshCallback));update.submit();},cb={success:function(){var update=docModel.getDataService().newUpdateWithoutCmd();rebuildFn(update);}};docModel.applyBufferedSelections(update);if(update.actions&&update.actions.length>0){update.addCallbacks(cb);update.submit();}else{rebuildFn(update);}}.bind(me);if(mstrConfig.resolveOnly&&hasTableErrors(docModel.datasets)){var cachedDatasets;if(!Array.isArray(docModel.datasets)){cachedDatasets=$HASH.clone(docModel.datasets);docModel.datasets=$DIHELP.standardizeDBRolesFormat(docModel.datasets);}getDiDialogController.call(this).show($DITYPE.credentialsDialog,{model:docModel,filterDatasets:true,onOK:function onOK(){fnExecuteRebuild();this.onOkAction=true;return true;},onCancel:function onCancel(){return true;},onClose:function onClose(){if(!this.onOkAction){if(!!cachedDatasets){docModel.datasets=cachedDatasets;}me.generateToolbar();}window.setTimeout(function(){if(mstrApp.container){mstrApp.container.close();}},0);}});return ;}fnExecuteRebuild();return ;}toggleState();cmdMgr.reset();}else{if(!mstrConfig.resolveOnly){mstrApp.enableUpdate=false;}else{mstrApp.enableUpdate=true;}extras={excludeData:true,resolveOnly:true,style:{params:{treesToRender:3}}};var scDefn=docModel.getCurrentLayoutSelectorDefn(),csTargetCesUpdateKeys=docModel.updateCSKeysforPause=getCesUpdateKeys(scDefn,docModel),callback={success:function(response){toggleState();docModel.partialUpdate(response.data,docModel.getTargetDefn(csTargetCesUpdateKeys),response.defn,csTargetCesUpdateKeys);},complete:function(){cmdMgr.reset();}};if(csTargetCesUpdateKeys.length&&!mstrConfig.resolveOnly){cmdMgr.execute({execute:function execute(){this.submit([{act:"rebuildDocument"}],callback,extras,cmdMgr.CMD_PHASE.LAST);}});}else{toggleState();cmdMgr.reset();}}},enterVizFilterConfigMode:function enterVizFilterConfigMode(filterName,isEditVisfilter){var FormWrapper=window.FormWrapper;mstrApp.isInVFConfigPage=true;mstrApp.restoreVFTitle=filterName;mstrApp.isVFEditingMode=isEditVisfilter;this.view.openInlineDialog({scriptClass:"mstrmojo.vi.ui.VisFilterInlineDialog",rootView:this.view,model:this.docCtrl.model,filterName:filterName,isEdit:isEditVisfilter});if(FormWrapper&&FormWrapper.setVFConfigurationMode){FormWrapper.setVFConfigurationMode(1);}},loadDataProvider:function loadDataProvider(callback){if(!this.dataProvider){this.set("dataProvider",new mstrmojo.ObjectBrowserDataProvider());}callback(this.dataProvider);},updatePromptStatus:function updatePromptStatus(hasPrompt){this.docCtrl.model.prompted=this.docCtrl.model.prompted||hasPrompt;},saveToCloud:function saveToCloud(){mstrmojo.onetier.controllers.RootController.prototype.saveToCloud.call(this);},WSItemDragEnter:function WSItemDragEnter(evt){mstrmojo.onetier.controllers.RootController.prototype.WSItemDragEnter.call(this);},WSItemDragOver:function WSItemDragOver(evt){mstrmojo.onetier.controllers.RootController.prototype.WSItemDragOver.call(this);},WSItemDrop:function WSItemDrop(evt){mstrmojo.onetier.controllers.RootController.prototype.WSItemDrop.call(this);},WSItemDragExit:function WSItemDragExit(evt){mstrmojo.onetier.controllers.RootController.prototype.WSItemDragExit.call(this);}});mstrmojo.vi.controllers.RootController.ENUM_LAYOUT_STYLE=ENUM_LAYOUT_STYLE;}());