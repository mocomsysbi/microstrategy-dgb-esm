(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.css");var $DOM=mstrmojo.dom,TOOLTIP_CLOSE_DELAY=100,TOOLTIP_OPEN_DELAY=700;var SAFARI_HIDE_TOOLTIP_CLASS="mojo-safari-hide-nativeTooltip",$CSS=mstrmojo.css;function getTooltipHandler(id,isDynamic){return function(e){var widget=mstrmojo.all[id];if(widget.customTooltipHandler){widget.customTooltipHandler(e);}widget[(isDynamic?"move":"show")+"Tooltip"](e,self);};}function attachTooltipEvents(){var node=this.tooltipNode||this.domNode,id=this.id,i,funcName="_ontooltip"+(this.isDynamicTooltip?"move":"over");if(!this._ontooltipout){this._ontooltipout=function(e){mstrmojo.all[id].hideTooltip(e,self);};}if(!this[funcName]){this[funcName]=getTooltipHandler(id,this.isDynamicTooltip);}node=[].concat(node);for(i=0;i<node.length;i++){node[i].removeAttribute("title");$DOM.attachEvent(node[i],(this.isDynamicTooltip?"mousemove":"mouseover"),this[funcName]);$DOM.attachEvent(node[i],"mouseout",this._ontooltipout);}}function detachTooltipEvents(){var node=this.tooltipNode||this.domNode,i;if(node&&node.constructor!==Array){node=[node];}if(node){var over=this._ontooltipover,out=this._ontooltipout,move=this._ontooltipmove;for(i=0;i<node.length;i++){if(over){$DOM.detachEvent(node[i],"mouseover",over);}if(out){$DOM.detachEvent(node[i],"mouseout",out);}if(move){$DOM.detachEvent(node[i],"mousemove",move);}}}}mstrmojo._HasTooltip=mstrmojo.provide("mstrmojo._HasTooltip",{tooltip:"",richTooltip:null,useRichTooltip:false,isDynamicTooltip:false,tooltipNode:null,tooltipOpenDelay:700,isIgnoreTooltipCloseDelay:false,hasWidgetContent:false,tooltipCloseDelay:TOOLTIP_CLOSE_DELAY,hasOpenTooltip:false,postBuildRendering:function(){var ret=this._super();if(this.useRichTooltip){attachTooltipEvents.call(this);}return ret;},onuseRichTooltipChange:function onuseRichTooltipChange(){if(this.hasRendered){if(this.useRichTooltip){attachTooltipEvents.call(this);}else{detachTooltipEvents.call(this);this.hideTooltip();}}},showTooltip:function showTooltip(e,win){var $this=this;if(!$this.hasOpenTooltip&&(!mstrApp.isInteractive||mstrApp.isInteractive&&mstrApp.isInteractive())){mstrmojo.requiresCls("mstrmojo.tooltip");if(this.updateTooltipConfig){this.updateTooltipConfig(e);}window.clearTimeout(this._tooltipTimeOut);if(mstrmojo.dom.isIE){var eventCopy={};for(var i in e){eventCopy[i]=e[i];}e=eventCopy;}var newAreaId=this.richTooltip?this.richTooltip.areaId:undefined;if($DOM.isSafari&&e){var src=e.srcElement;if(window.getComputedStyle(src)["text-overflow"]==="ellipsis"){this.baseElement=src;$CSS.toggleClass(src,SAFARI_HIDE_TOOLTIP_CLASS,true);}}this._tooltipTimeOut=window.setTimeout(function(){var richTooltip=$this.richTooltip;if($this._closeTooltipTimeout){window.clearTimeout($this._closeTooltipTimeout);delete $this._closeTooltipTimeout;}mstrmojo.tooltip.open($this,e,win);$this.tooltip.onmouseover=function(){if($this.richTooltip&&$this.richTooltip.enableHover){window.clearTimeout($this._closeTooltipTimeout);window.clearTimeout($this._deactivationTimeout);if($this.tooltip){$this.tooltip.onmouseout=function(evt){var e=evt.e;if((!e.toElement&&!e.relatedTarget)||!$DOM.contains(this.domNode,evt.e.toElement||evt.e.relatedTarget)){$this.hideTooltip();}};}}};$this.tooltip.allowOtherTooltips=$this.allowOtherTooltips;if(richTooltip&&richTooltip.onClose){$this.tooltip.onClose=richTooltip.onClose;}$this.hasOpenTooltip=true;$this._hasActiveArea=true;$this._tooltipAreaId=newAreaId;window.clearTimeout($this._deactivationTimeout);delete $this._deactivationTimeout;},(this._hasActiveArea&&newAreaId&&newAreaId===this._tooltipAreaId)?0:this.tooltipOpenDelay);}},moveTooltip:function moveTooltip(evt,win){if(this._tooltipTimeOut){window.clearTimeout(this._tooltipTimeOut);this._tooltipTimeOut=null;mstrmojo.tooltip.close();}var _this=this,_evt=evt,_win=win;this._tooltipTimeOut=setTimeout(function(){mstrmojo.tooltip.open(_this,_evt,_win);},this.tooltipOpenDelay);},hideTooltip:function hideTooltip(){var $this=this;window.clearTimeout(this._tooltipTimeOut);if($DOM.isSafari&&this.baseElement){$CSS.toggleClass(this.baseElement,SAFARI_HIDE_TOOLTIP_CLASS,false);}if(this._closeTooltipTimeout){window.clearTimeout(this._closeTooltipTimeout);}if(this._hasActiveArea&&!this._deactivationTimeout){this._deactivationTimeout=window.setTimeout(function(){delete $this._deactivationTimeout;delete $this._hasActiveArea;delete $this._tooltipAreaId;},100);}mstrmojo.requiresCls("mstrmojo.tooltip");if((!this.isIgnoreTooltipCloseDelay)&&$this.richTooltip&&$this.richTooltip.enableHover){this._closeTooltipTimeout=window.setTimeout(function(){mstrmojo.tooltip.close();delete $this._closeTooltipTimeout;},$this.richTooltip.tooltipCloseDelay||this.tooltipCloseDelay);}else{if($this.tooltip){this.isIgnoreTooltipCloseDelay=false;mstrmojo.tooltip.close();}}this.hasOpenTooltip=false;},unrender:function unrender(ignoreDom){detachTooltipEvents.call(this);this._super(ignoreDom);}});mstrmojo._HasTooltip.TOOLTIP_OPEN_DELAY=TOOLTIP_OPEN_DELAY;mstrmojo._HasTooltip.TOOLTIP_CLOSE_DELAY=TOOLTIP_CLOSE_DELAY;}());