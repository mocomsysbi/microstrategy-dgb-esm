(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.css","mstrmojo.Button","mstrmojo.TextBox","mstrmojo.imageUtils","mstrmojo.ui.editors.controls.TwoColumnContainer","mstrmojo.vi.ui.CoverPageGallery","mstrmojo.vi.ui.rw.selectors._HasWarningMessage");mstrmojo.requiresDescs(15020,15021,15025,15131,15132);var $NWB=mstrmojo.Button.newWebButton,CSS=mstrmojo.css,IMG_UTILS=mstrmojo.imageUtils,EDITOR_CONTENT_WIDTH="380px",BASE_URL="https://demo.microstrategy.com/MicroStrategy/images/Coverpages/16-9/",IMAGE_NAME=["22.jpg","23.jpg","24.jpg","25.jpg","26.jpg","27.jpg","28.jpg","29.jpg","30.jpg","31.jpg","32.jpg","33.jpg","34.jpg","35.jpg","36.jpg","37.jpg","38.jpg","39.jpg","40.jpg","41.jpg","42.jpg","43.jpg","44.jpg","45.jpg","46.jpg","47.jpg","48.jpg","49.jpg","50.jpg","51.jpg","52.jpg","53.jpg"],GALLERY_LIST=[];IMAGE_NAME.forEach(function(imageName){GALLERY_LIST.push({src:BASE_URL+imageName});});function saveTriggered(){var coverPageEditor=this,url=coverPageEditor.urlBox.value;coverPageEditor.hideWarning();coverPageEditor.onSave(url,url!==coverPageEditor.originURL,coverPageEditor.urlAccesible);coverPageEditor.afterSave();}mstrmojo.vi.ui.editors.CoverPageEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.vi.ui.editors.CoverPageEditor",cssClass:"mstrmojo-vi-ui-editors-CoverPageEditor",btnAlignment:"right",urlBox:undefined,originURL:"",title:mstrmojo.desc(15020,"Change Cover"),urlAccesible:true,isTooltipAllowed:true,init:function init(props){this._super(props);this.bindWarningHandler(this);},postBuildRendering:function(){if(this._super){this._super();}this.urlBox.focus();},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15131,"Paste an image URL:")},{scriptClass:"mstrmojo.TextBox",alias:"urlBox",cssClass:"urlBox",width:EDITOR_CONTENT_WIDTH,onEnter:function onEnter(){if(this._super){this._super();}var me=this,coverPageEditor=me.parent;coverPageEditor.hideWarning();IMG_UTILS.isImageAccessible(this.value,{success:function(){coverPageEditor.urlAccesible=true;},failure:function(){coverPageEditor.urlAccesible=false;coverPageEditor.set("validation",{refNode:me.domNode,position:2,invalid:true,errorMsg:mstrmojo.desc(15021,"Sorry, this image cannot be loaded, either because the URL is not valid, or there is no internet connection. Please enter a valid URL, and make sure the internet is connected."),errorCode:null,closeOnClick:false});}});coverPageEditor.gallery.set("selectedImgURL",this.value);},onvalueChange:function onvalueChange(){if(this._super){this._super();}var me=this,coverPageEditor=me.parent;coverPageEditor.hideWarning();coverPageEditor.btnHbox.saveButton.set("enabled",true);},onblur:function onblur(){var coverPageEditor=this;window.setTimeout(function(){if(coverPageEditor.parent.isTooltipAllowed){coverPageEditor.onEnter();}},200);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15132,"or select a sample image:")},{scriptClass:"mstrmojo.vi.ui.CoverPageGallery",height:"320px",width:EDITOR_CONTENT_WIDTH,alias:"gallery",onimageSelected:function onimageSelected(src){var coverPageEditor=this.parent;coverPageEditor.urlBox.set("value",src);CSS.toggleClass(coverPageEditor.urlBox.domNode,"changing",false);if(window.requestAnimationFrame){window.requestAnimationFrame(function(){CSS.toggleClass(coverPageEditor.urlBox.domNode,"changing",true);});}}}],buttons:[$NWB(mstrmojo.desc(118,"Save"),function(){var coverPageEditor=this.parent.parent;coverPageEditor.isTooltipAllowed=false;IMG_UTILS.isImageAccessible(coverPageEditor.urlBox.value,{success:function(){coverPageEditor.urlAccesible=true;},failure:function(){coverPageEditor.urlAccesible=false;}});window.setTimeout(function(){saveTriggered.call(coverPageEditor);},50);},true,{alias:"saveButton"}),$NWB(mstrmojo.desc(221,"Cancel"),function(){var coverPageEditor=this.parent.parent;coverPageEditor.isTooltipAllowed=false;coverPageEditor.onCancel();coverPageEditor.afterCancel();})],onOpen:function onOpen(){this.gallery.set("imageList",GALLERY_LIST);this.urlBox.set("value",this.originURL);this.btnHbox.saveButton.set("enabled",false);this.isTooltipAllowed=true;},onSave:mstrmojo.emptyFn,afterSave:mstrmojo.emptyFn,onCancel:mstrmojo.emptyFn,afterCancel:mstrmojo.emptyFn,close:function close(){this._super();this.hideWarning();}});}());