(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo._CanDrawHeatMap","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.AbstractGraphicLayerViewer");var $MOJO=mstrmojo,$ARR=$MOJO.array,$MUTIL=mstrmojo.gmaps.MapUtils;function _createCanvas(){var canvas=document.createElement("canvas");$MUTIL.setCssStyles(canvas,{position:"absolute",top:"0px",left:"0px"});return canvas;}mstrmojo.gmaps.layer.canvas.DensityLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.AbstractGraphicLayerViewer,[mstrmojo._CanDrawHeatMap],{scriptClass:"mstrmojo.gmaps.layer.canvas.DensityLayerViewer",parentDom:null,div_:null,themeData:null,init:function init(props){this._super(props);this._initLayerDomTree();},_initLayerDomTree:function _initLayerDomTree(){var div_=this.div_,parentDom=this.parentDom;if(!div_){div_=this.div_=document.createElement("div");$MUTIL.setLayerNodeProps(div_,null,"mstrMap-graphicLayer",this.getWidth(),this.getHeight());}this.canvas=_createCanvas();$MUTIL.appendNode(div_,this.canvas);if(parentDom){parentDom.appendChild(div_);}},getNode:function getNode(){return this.div_;},update:function update(props){var canvas=this.canvas,themeId=props&&props.themeId;if(!canvas){return ;}this.themeId=themeId;this.themeData=null;this.setTransform({x:0,y:0});canvas.width=this.getWidth();canvas.height=this.getHeight();this.drawDensity();},refresh:function refresh(){$MUTIL.appendNode(this.getNode(),this.canvas);},getGraphicsFromPoint:function getGraphicsFromPoint(evt){var pixelXY=$MUTIL.getEvtCoordInsideNode(evt,this.parentDom);if(!!pixelXY&&$MUTIL.checkVal(pixelXY.x)&&$MUTIL.checkVal(pixelXY.y)){return $ARR.ensureArray(this.getAttrsFromLocationMapRange(Math.ceil(pixelXY.x),Math.ceil(pixelXY.y)));}},getScreenPointForLocation:function getScreenPointForLocation(point){if(!point){return ;}var offset=this.getGraphicsOffset();return(offset&&$MUTIL.checkVal(offset.x)&&$MUTIL.checkVal(offset.y))?{x:point.x+offset.x,y:point.y+offset.y}:{x:point.x,y:point.y};},getTopLeft:function getTopLeft(){var canvas=this.canvas;return(!canvas)?null:{x:parseFloat(canvas.style.left.split("px")[0]),y:parseFloat(canvas.style.top.split("px")[0])};},clean:function clean(){this.clearDensity();},destroy:function destroy(){this.cleanLocationMap();this.clearDensity();delete this.canvas;this._super();}});}());