(function(){mstrmojo.requiresCls("mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.geometry.PieSlice","mstrmojo.gmaps.graphic.ClusterGraphic","mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic._HasPieSlices");var SMALL_CNT=10,MEDIUM_CNT=100;var $GEOMETRY=mstrmojo.gmaps.geometry,$ARR=mstrmojo.array;function getClusterColor(clusterCount){if(clusterCount<SMALL_CNT){return"rgba(0, 150, 255, 0.75)";}else{if(clusterCount<MEDIUM_CNT){return"rgba(255, 147, 0, 0.75)";}else{return"rgba(255, 38, 0, 0.75)";}}}mstrmojo.gmaps.graphic.PieClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.ClusterGraphic,[mstrmojo.gmaps.graphic._HasPieSlices],{scriptClass:"mstrmojo.gmaps.graphic.PieClusterGraphic",totalValue:null,centerCircle:null,textLabel:null,pieSlices:null,innerR:15,outterR:25,idxOfFirstSlice:2,init:function init(props){if(!this._checkProps(props)){return ;}var pos=props.screenData,x=pos&&pos.x,y=pos&&pos.y,clusterCount=props.clusterCount,clusterGraphic=this;this.geometry=new $GEOMETRY.Circle({setHover:function(isHovered){clusterGraphic.setHover(isHovered);},defaultFillColor:getClusterColor(clusterCount),radius:this.innerR,x:x,y:y});this.centerCircle=new mstrmojo.gmaps.graphic.Graphic({geometry:this.geometry});this.textLabel=new mstrmojo.gmaps.graphic.Graphic({geometry:new $GEOMETRY.Text({text:clusterCount,isCenterAlign:true,setHover:function(isHovered){clusterGraphic.setHover(isHovered);},x:x,y:y})});this._super(props);this.addSubGraphic(this.centerCircle);this.addSubGraphic(this.textLabel);this.createPieSliceGraphics(true,this.outterR,this.innerR,x,y);},_addGraphicIDToNode:function _addGraphicIDToNode(){var graphics=[this.centerCircle,this.textLabel];$ARR.forEach(graphics,function(graphic){var geometry=graphic&&graphic.geometry,node=geometry&&geometry.node;if(node){node.graphicID=this.id;}},this);},setHover:function setHover(isHovered){$ARR.forEach(this.pieSlices,function(slice){var geometry=slice&&slice.geometry;if(geometry){geometry.setHover(isHovered);}});},getGraphicSize:function getGraphicSize(){var pieSlice=this.pieSlices&&this.pieSlices[0],geometry=pieSlice&&pieSlice.geometry;return(geometry&&geometry.getGeometrySize())||0;},isSelected:function isSelected(){var subGraphics=this.pieSlices,result=true;$ARR.forEach(subGraphics,function(graphic){if(!graphic.isSelected()){result=false;return false;}});return result;},matchLocationName:function matchLocationName(matchPattern){if(!matchPattern){return[];}var re=new RegExp(matchPattern,"i"),result=[];$ARR.forEach(this.subGraphics,function(sub){var geoName=sub.getGeoName();if(geoName&&re.test(geoName)){result.push(sub);}});return result;},getGraphicsForSelection:function getGraphicsForSelection(){if(!this.pieSlices){return null;}return this.pieSlices;},isClusterGraphic:function isClusterGraphic(){return true;}});}());