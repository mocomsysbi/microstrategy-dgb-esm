(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.range","mstrmojo.Widget","mstrmojo.dom","mstrmojo.desc","mstrmojo.tooltip");var $CSS=mstrmojo.css,$RANGE=mstrmojo.range,$DOM=mstrmojo.dom,$DESC=mstrmojo.desc;mstrmojo.requiresDescs(15665);mstrmojo.vi.ui.editors.PassThroughExpressionInputBox=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.vi.ui.editors.PassThroughExpressionInputBox",markupString:'<div id={@id} class="mstrmojo-MEBox mstrmojo-PassThroughExpressionInputBox {@cssClass}" style="{@cssText}"><div class="mstrmojo-TokenInputBox-edit"mstrAttach:mouseup><span class="mstrmojo-itemwrap"><span class="mstrmojo-token  mstr">ApplySimple("</span></span><span class="mstrmojo-itemwrap"><span class="mstrmojo-token  nfn" contenteditable="true" style="display: inline-block; min-width: 4px; min-height: 13px;" mstrAttach:keypress,keyup,paste,blur,focus></span></span><span class="mstrmojo-itemwrap"><span class="mstrmojo-token  mstr">")</span></span></div></div>',markupSlots:{expressionNode:function(){return this.domNode.firstChild.childNodes[1].firstChild;}},tooltipOpenDelay:100,updateTooltipConfig:function updateTooltipConfig(){var target=this.domNode,position=$DOM.position(target),content=$DESC(15665,"MDX pass-through expression should not contain ', //, --, /*, */.");this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:content,top:position.y,left:position.x};},setValue:function setValue(value){this.expressionNode.textContent=value;this.set("value",value);},isExpressionInvalid:function isExpressionInvalid(){var regExp=/(\'|\/\/|\-\-|\/\*|\*\/)/,exp=this.value;return !!(exp&&regExp.test(exp));},oninvalidChange:function oninvalidChange(){var invalid=this.invalid;$CSS.toggleClass(this.domNode,"err",invalid);this.set("useRichTooltip",invalid);if(invalid){this.showTooltip();}else{this.hideTooltip();}},clearExpression:function clearExpression(){this.expressionNode.textContent="";this.set("value","");this.expressionNode.style.width="";this.set("exprNodeHasChildren",false);},onkeyup:function onkeyup(e){this._handleInputChange();},onpaste:function onpaste(e){var me=this;setTimeout(function(){me._handleInputChange();},0);},onkeypress:function keypress(e){if(e.e&&e.e.charCode===13){e.preventDefault();}},_handleInputChange:function _handleInputChange(){var exprNode=this.expressionNode,hasChildren=exprNode.children.length>0;var getNodeContent=function getNodeContent(rootNode){var nodeName=rootNode.nodeName&&rootNode.nodeName.toUpperCase&&rootNode.nodeName.toUpperCase()||"";if(nodeName=="SCRIPT"||nodeName=="STYLE"){return"";}else{if(nodeName=="#TEXT"){return rootNode.textContent;}else{var childNodes=rootNode.childNodes,length=childNodes&&childNodes.length||0,i,res="";for(i=0;i<length;i++){res+=getNodeContent(childNodes[i]);}return res;}}};this.set("value",getNodeContent(exprNode).replace(/\n/g,""));exprNode.style.width=hasChildren?"100%":"";this.set("exprNodeHasChildren",hasChildren);},onfocus:function onfocus(e){$CSS.toggleClass(this.domNode,"active",true);},onblur:function onblur(e){$CSS.toggleClass(this.domNode,"active",false);},onmouseup:function onmouseup(e){var target=e.target||(e.getTarget&&e.getTarget());if(!$DOM.contains(this.expressionNode,target,true)){this.expressionNode.focus();$RANGE.collapseOnNode(this.expressionNode,false);}},prevalueChange:function prevalueChange(){$CSS.toggleClass(this.domNode,"empty",!this.value);},preexprNodeHasChildrenChange:function preexprNodeHasChildrenChange(){$CSS.toggleClass(this.domNode,"empty",!this.exprNodeHasChildren);},});}());