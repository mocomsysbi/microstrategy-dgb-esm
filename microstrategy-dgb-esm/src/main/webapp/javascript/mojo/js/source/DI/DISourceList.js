(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.hash","mstrmojo.DI.DIConstants","mstrmojo.DI.DIHelpers","mstrmojo.Table","mstrmojo.DI.DIDatabaseImportOption","mstrmojo.DI.DISourceItem","mstrmojo.ui.CheckList","mstrmojo.array","mstrmojo.ui.SearchBox","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DISourceItemBox","mstrmojo.vi.enums.EnumDSSAccessRightFlags","mstrmojo.DI.ui.ScrollableBox");mstrmojo.requiresDescs(10,489,1563,2461,4700,9095,9096,9097,9098,9100,9213,9214,10213,12459,12666,12726,12727,12758,12889,12890,13027,13416,13961,14101,14102,14103,14104,14208,14210,14211,14212,14213,12491,12499,15169,15170,15171,14461,16144,15542,15626,15807,15808);var $DOM=mstrmojo.dom,$H=mstrmojo.hash,$A=mstrmojo.array,$HASH=mstrmojo.hash,$WIDGET=mstrmojo.Widget,$ACG=mstrmojo.vi.enums.EnumDSSAccessRightFlags,constants=mstrmojo.DI.DIConstants,$HELPER=mstrmojo.DI.DIDatabaseHelper,pageType=constants.pageType,sourceItem="mstrmojo.DI.DISourceItem",GRID_MODE=constants.mainPage.GRID_MODE,LIST_MODE=constants.mainPage.LIST_MODE,EMPTY_SEARCH_TEXT=mstrmojo.desc(12666,"Search..."),maxRows=24,numOfcols=4,maxRows_narrow=17,CACHE_WIDTH,CACHE_COLS,$MARKPLACE_URL=constants.sdkUrl.MARKPLACE_URL,$DIHELPER=mstrmojo.DI.DIHelpers,MAIN_PAGE_WAIT_BOX_ID="diMainPageWaitBox"+Date.now(),DEPLOY_COMMUNITY_CONNECTORS_READY="Community Connectors config ready";function centerSourceList(alias,width){var numCols=Math.floor(width/160),margin,children=this[alias]&&this[alias].children;if(numCols>0){margin=Math.floor((width-numCols*160)/2);}if(margin>0){$A.forEach(children,function(ch){if(ch.hasRendered){ch.domNode.style.left=margin+"px";}});}}var defaultCustomConnector={scriptClass:sourceItem,icon:"ds_suggest",n:mstrmojo.desc(12890,"Suggest a Data Source"),desc:mstrmojo.desc(12459,"Is your data source not available? Tell us which source it is and why it is important to you."),pageType:pageType.suggestNewSource,alias:"suggest",tags:["Customized"],sourceInfo:0};function getAdvSearchItems(){var items=[];if(mstrApp.diParams.AccessDataFromFiles===1){items.push({n:mstrmojo.desc(489,"File"),did:constants.Enum_SourceCategoryType.File,v:"File"});}if(mstrApp.diParams.ImportDatabase===1){items.push({n:mstrmojo.desc(15626,"Big Data"),did:constants.Enum_SourceCategoryType.BigData,v:"BigData"});items.push({n:mstrmojo.desc(14461,"Databases"),did:constants.Enum_SourceCategoryType.Database,v:"Database"});}if(mstrApp.diParams.ImportDatabase===1&&!window.mstrAppSchema){if(!mstrApp.isSingleTier){items.push({n:mstrmojo.desc(15542,"OLAP (MDX)"),did:constants.Enum_SourceCategoryType.OLAP,v:"OLAP"});}items.push({n:mstrmojo.desc(15171,"Community Extension"),did:constants.Enum_SourceCategoryType.Customized,v:"Customized"});}items.push({n:mstrmojo.desc(16145,"Applications"),did:constants.Enum_SourceCategoryType.Apps,v:"Apps"});return items;}function ddaVisible(){var model=mstrApp.getRootController().model;if(mstrApp.isWorkstation){return false;}if(mstrApp.showDDAOptions===false){return false;}if(mstrApp.diParams.ImportDatabase===0){return false;}if(model.currentDataset){return false;}var count=0,prop,sources=model.importSources;for(prop in sources){if(sources.hasOwnProperty(prop)){count++;}}return count<1;}function connectorPrivilegeCheck(){var title="";if(!mstrApp.diParams.EnableURLImport){title=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{if(mstrApp.diParams.ImportDatabase===0){title=mstrmojo.desc(12499,'Disabled as the user does not have any "Web Import Database" privileges');}}return title;}var tagConfig={scriptClass:"mstrmojo.Container",markupString:"<div class='mstrmojo-di-search-tag' mstrAttach:click ><div></div><div></div></div>",markupSlots:{containerNode:function(){return this.domNode;},contentNode:function(){return this.domNode.children[0];},deleteNode:function(){return this.domNode.children[1];}},tag:"",children:[{scriptClass:"mstrmojo.Label",alias:"tagName",slot:"contentNode",cssClass:"mstrmojo-di-search-tag-name",visible:false},{scriptClass:"mstrmojo.Button",slot:"deleteNode",cssClass:"mstrmojo-di-tag-delete-button",innerIconClass:"close-button"}],preBuildRendering:function(){if(this._super){this._super();}this.tagName.text=this.tag;},onclick:function(){var tagList=this.parent;tagList.removeChildren();var filterTags=tagList.parent.filterTags;var index=$A.find(filterTags,"n",this.tag);if(index>-1){$A.removeIndices(filterTags,index,1);}tagList.parent.raiseEvent({name:"filterTagsChange"});}};function composeSourceListChildren(items,hasFilterTag,keyWord){var row=0,col=0,SAP_HAHA_DBTYPE=4000;var initials={},children=[],text;var index=0;var $this=this;var isFilterDDA=$this.isFilterDDA;var dbItems=[];var dbTypes=[];var controller=mstrApp.getRootController();var model=controller.getModel();var sourceItemClickFn=function sourceItemClickFn(evt){var target=mstrmojo.dom.findWidget(evt.getTarget());if(target===this.dbList){mstrmojo.css.addClass(this.domNode,"selected");}else{if(target.alias==="closeList"){mstrmojo.css.removeClass(this.domNode,"selected");}else{if(this.parent.parent.mode===LIST_MODE){if(target.sourceInfo.type===constants.sourceType.googleBigQuery){controller.showDialog(constants.dialogType.qbImportOptionDialog,{isODBC:true,srcInfo:target.sourceInfo});}else{if(target.dbTypes){dbTypes=$HELPER.getUniqueDBTypes(target.dbTypes);$A.forEach(dbTypes,function(dbType){if(!isFilterDDA||model.canAddToDDACube(target.sourceInfo.subtype,dbType)){dbItems.push(dbType);}});mstrApp.dbTypes=dbItems;}else{if(target.dbTypes!==undefined){mstrApp.dbTypes=[target.dbType];}}mstrApp.supportDBObjects=controller.model.supportDBObjects;mstrApp.dbObjectsDisplayOptions=target.dbObjectsDisplayOptions;if(target.dbObjectsDisplayOptions===16){mstrApp.dbRolesVersionExcludeFilter=[17,18,21,22,23,24,25,37,45,46,47,48,63,66,74,89,92,101,103,105,123,134,157,172,202,232];}if(target.dbIds){mstrApp.dbIds=target.dbIds;}else{mstrApp.dbIds=target.dbId?[].concat(target.dbId):undefined;}if(target.showImportOption){controller.showDialog(constants.dialogType.qbImportOptionDialog,(target.dbType===SAP_HAHA_DBTYPE)?{isSAPHana:true}:{isODBC:true});}else{if(target.pageType===constants.pageType.newConnector){mstrApp.dbmsID=target.oid;mstrApp.conUrl=target.url;mstrApp.clientId=target.user;mstrApp.newConDbroleId=target.oid;if(target.enabled){var slot;if(mstrApp.isSingleTier&&target.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var errorMessage=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),replaceStr='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";errorMessage=errorMessage.replace("#",replaceStr)+".";controller.displayError(errorMessage,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}slot=controller.navigationController.getPageSlot();slot.setConfig({properties:{operationMode:constants.operationMode.create}});controller.showPage(target.pageType,target.sourceInfo,slot);}}else{$this.selectedSource=this;$this.onNextButtonClick(evt);}}}}}}};var maxCol=hasFilterTag?numOfcols:numOfcols+1;var initialsAmount=0;var max_row=maxRows_narrow;if(hasFilterTag&&CACHE_WIDTH<940){maxCol-=1;}CACHE_COLS=maxCol;$A.forEach(items,function(item){if(!initials[item.initial]){initialsAmount++;initials[item.initial]=true;}});initials={};var childrenAmount=initialsAmount+items.length;if(childrenAmount>maxCol*maxRows_narrow){max_row=childrenAmount/maxCol+1;}maxRows=max_row;$A.forEach(items,function(item){if(!initials[item.initial]){children.push({scriptClass:"mstrmojo.Label",text:item.initial,cssClass:"initial",slot:row+","+col});row++;initials[item.initial]=true;if(row>=max_row){row=0;col++;}}if(keyWord){index=item.n.toLowerCase().indexOf(keyWord.toLowerCase());if(index!==-1){text=item.n.substring(0,index)+'<span style="font-weight: bold;">'+item.n.substring(index,index+keyWord.length)+"</span>"+item.n.substr(index+keyWord.length);}}item.slot=row+","+col;if(item.isEnabled){item.enabled=item.isEnabled();}if(typeof item.title==="function"){item.title=item.title();}children.push(mstrmojo.hash.copy(item,{scriptClass:"mstrmojo.Label",allowHTML:true,text:text||item.n,onclick:sourceItemClickFn,tooltipOpenDelay:0,useRichTooltip:true,cssText:"overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",updateTooltipConfig:function(){var pos=$DOM.position(this.domNode);if(this.title!==undefined){this.set("richTooltip",{cssClass:"vi-regular vi-tooltip-V",top:Math.max(pos.y,0),left:Math.max(pos.x+4,0),posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:this.title});}}}));row++;if(row>=max_row){row=0;col++;}});return children;}function filterSourcesByDDAOnly(model,sources,hasDDAOnlySource){var ret=[],subtype;if(!hasDDAOnlySource){$A.forEach(sources,function(source){if(source.sourceInfo&&source.sourceInfo.subtype){subtype=source.sourceInfo.subtype;}else{subtype=source.subtype;}if(!model.isDDAOnlySource(subtype)){ret.push(source);}});}else{ret=sources;}return ret;}function filterSourcesByDDA(model,sources){var ddasources=[],row=0,column=0,ddaSource;$H.forEach(sources,function(source){ddaSource=null;var subtype,dbType;if(source.sourceInfo&&source.sourceInfo.subtype){subtype=source.sourceInfo.subtype;}else{subtype=source.subtype;}if(source.sourceInfo&&source.sourceInfo.dbType){dbType=source.sourceInfo.dbType;}else{dbType=source.dbType;}if(model.canAddToDDACube(subtype,dbType)){ddaSource=mstrmojo.hash.copy(source,ddaSource);if(column>3){row++;column=0;}column++;ddasources.push(ddaSource);}});return ddasources;}function filterSourcesByPrivileges(sources){var ret=[];$H.forEach(sources,function(source){if(source.privilege===constants.privilegeType.accessCloud&&mstrApp.diParams.AccessDataFromCloudApp){ret.push(source);}if(source.privilege===constants.privilegeType.accessDatabase&&mstrApp.diParams.ImportDatabase){ret.push(source);}if(source.privilege===constants.privilegeType.accessFile&&mstrApp.diParams.AccessDataFromFiles){ret.push(source);}});return ret;}function filterSourcesForOneTier(sources){var oneTierSources=[],row=0,column=0,ddaSource;$H.forEach(sources,function(source){ddaSource=null;if(source.oneTier){ddaSource=mstrmojo.hash.copy(source,ddaSource);if(column>3){row++;column=0;}column++;oneTierSources.push(ddaSource);}});return oneTierSources;}function filterSourcesByText(items,input,numOfcols){var k,index,result=[],row=0,col=0;for(k=0;k<items.length;k++){index=items[k].n.toLowerCase().indexOf(input.toLowerCase());if(index>-1){result.push(items[k]);col++;if(col===numOfcols){col=0;row=row+1;}}}return result;}function filterSourcesbyTag(items,tags,numberOfcols){var j,k,result=[],row=0,col=0,tag;for(k=0;k<items.length;k++){if(items[k].tags){for(j=0;j<items[k].tags.length;j++){tag=items[k].tags[j];if(tags[tag]){result.push(items[k]);col++;if(col===numberOfcols){col=0;row=row+1;}break;}}}}return result;}function shouldShowAddToDataset(){var ds=$A.filter(mstrApp.getRootController().model.datasets||[],function(item){return !item.hcs;});return ds&&ds.length>1&&!mstrApp.diParams.isEdit&&!mstrApp.getRootController().model.hasEMMAReportInstance();}function keywordPopulate(item,name,index,length){item.keywordLeft=name.substring(0,index);item.keyword=name.substring(index,index+length);item.keywordRight=name.substr(index+length);}mstrmojo.DI.DISourceList=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup,mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.DI.DISourceList",selectedSource:null,filterTags:[],filterTagsInGridView:[],mode:GRID_MODE,keyword:"",hasDDAOnlySource:true,isFilterDDA:true,isSAPHana:false,markupString:'<div id="{@id}" class="mstrmojo-di-sources {@cssClass}" mstrAttach:mousedown style="height: 100%"><div class="mstrmojo-di-source-datasets"></div><div class = "mstrmojo-di-source-content"></div><div class = "mstrmojo-di-search-tags"></div></div>',markupSlots:{datasetsNode:function(){return this.domNode.children[0];},allSourceNode:function(){return this.domNode.children[1];},searchTagsNode:function(){return this.domNode.children[2];}},markupMethods:{onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";},onheightChange:$WIDGET.heightMarkupMethod,onwidthChange:$WIDGET.widthMarkupMethod},onmodeChange:function(){var model=this.model;if(this.mode===LIST_MODE){this.sourceList.removeChildren();this.populateSources(constants.populateType.ALL_SOURCES);if(model.isDirectDataAccess!==this.sourceList.ddaList){this.update();}}else{if(!this.allSources.sourceTable.children){this.populateSources(constants.populateType.ALL_SOURCES);}this.updateViewByMode();if(model.isDirectDataAccess!==this.allSources.sourceTable.ddaList){this.update({type:constants.populateType.ALL_SOURCES});}}this.persistViewMode();this.clearSearchBox();model.raiseEvent({name:"sourceListModeChange",mode:this.mode});},onhasDDAOnlySourceChange:function(){if(this.hasRendered){this.update({name:constants.srcItemTypes.ALL_SOURCES});}},updateViewByMode:function updateViewByMode(){var model=this.model;var height;if(this.mode===LIST_MODE){this.sourceList.set("visible",true);this.allSources.set("visible",false);this.searchTagsNode.style.display="block";this.sourceView.set("selectedIndex",1);if(!mstrApp.isPopup&&this.height){height=parseInt(this.height,10)-30+"px";this.sourceList.domNode.style.height=height;}}else{this.sourceList.set("visible",false);this.allSources.set("visible",true);this.searchTagsNode.style.display="none";this.sourceView.set("selectedIndex",0);}if(model.isDirectDataAccess){this.allddatabs.children[0].set("selectedIndex",1);}else{this.allddatabs.children[0].set("selectedIndex",0);}},onfilterTagsInGridViewChange:function(){this.update({name:constants.srcItemTypes.ALL_SOURCES});},onfilterTagsChange:function(){var $this=this,filteredItems,children;filteredItems=this._onfilterTags(1);children=composeSourceListChildren.call($this,filteredItems,this.filterTags.length!==0);mstrmojo.css.toggleClass(this.sourceList.domNode,"narrow",this.filterTags.length>0);this.sourceList._set_children("children",children);},_onfilterTags:function(mode){var $this=this,filterTags={},list=mode?this.filterTags:this.filterTagsInGridView;var model=this.model;var filteredItems=model.sourceList;this.searchTagList.removeChildren();if(list.length!==0){filteredItems=filterSourcesbyTag(model.sourceList,filterTags,numOfcols);}if(model.isDirectDataAccess){filteredItems=filterSourcesByDDA(model,filteredItems);}if(!mstrApp.isSingleTier){filteredItems=filterSourcesByPrivileges(filteredItems);}else{filteredItems=filterSourcesForOneTier(filteredItems);}if(this.searchBox.inputNode.value!==""&&this.searchBox.inputNode.value!==EMPTY_SEARCH_TEXT){filteredItems=filterSourcesByText(filteredItems,this.searchBox.inputNode.value,numOfcols);}return filteredItems;},persistViewMode:function persitViewMode(){mstrApp.getRootController().rootView.setHomepageViewMode(this.mode);},children:[{scriptClass:"mstrmojo.Box",slot:"datasetsNode",cssClass:"mstrmojo-di-source-datasets-box cf",bindings:{visible:shouldShowAddToDataset},preBuildRendering:function preBuildRendering(){if(this.visible){mstrmojo.css.addClass(this.parent.domNode,"with-mstrmojo-di-source-datasets-box");}},children:[{scriptClass:"mstrmojo.Label",cssClass:"dataset-box-label",text:mstrmojo.desc(13027,"Add to:")},{scriptClass:"mstrmojo.ui.Pulldown",bindings:{items:function(){var dsArray=[];$A.forEach(mstrApp.getRootController().model.datasets||[],function(item){var isSparkCube=item.tables&&item.tables.length>0&&item.tables[0].xdaType===constants.xdaType.sparkDataset;var writable=item.acg?item.acg&$ACG.DssAccessRightWriteFlag:true,copyable=item.copyable!=="false";if(!item.hcs&&!isSparkCube&&writable&&copyable){dsArray.push({id:item.did,n:item.name});}});return dsArray;}},allowHTML:false,onitemSelected:function onitemSelected(item){if(this.parent.parent){this.parent.parent.filterTagsInGridView=[];}var model=mstrApp.getRootController().getModel(),idx=$A.find(model.datasets,"did",item.id),rootCtrl=mstrApp.getRootController(),rootView=rootCtrl.rootView;if(idx>-1){model.selectDataset(model.datasets[idx]);rootView._DISourceListPulldownSelectedIndex=idx;this.selectedIndex=idx;this.parent.parent.set("hasDDAOnlySource",model.datasets[idx].did===-1);this.parent.parent.allddatabs.set("visible",false&&ddaVisible());}},preBuildRendering:function preBuildRendering(){var rootCtrl=mstrApp.getRootController(),rootView=rootCtrl.rootView;if(this._super){this._super();}if(this.items.length>0){this.selectedIndex=rootView._DISourceListPulldownSelectedIndex!==undefined?rootView._DISourceListPulldownSelectedIndex:0;}}}]},{alias:"sourceView",slot:"allSourceNode",scriptClass:"mstrmojo.ui.ButtonBar",cssClass:"mstrmojo-di-source-view",renderOnScroll:false,selectedIndex:0,bindings:{visible:function(){return false&&!mstrApp.isWorkstation;}},postselectionChange:function(evt){var value=evt.added&&this.items[evt.added[0]].v;this.parent.set("mode",value);},items:[{v:GRID_MODE,css:"grid"},{v:LIST_MODE,css:"list"}]},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-source-direct-access-container",slot:"allSourceNode",alias:"allddatabs",bindings:{visible:function(){return false&&ddaVisible();}},children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,selectedIndex:0,postselectionChange:function(evt){var controller=mstrApp.getRootController(),model=controller.model,value=evt.added&&this.items[evt.added[0]].v,isDDA=!!value;if(model.isDirectDataAccess!==isDDA){controller.getDDAController().setDirectDataAccess(isDDA);model.origIsDirectDataAccess=isDDA;this.parent.parent.update();}},items:[{n:mstrmojo.desc(2461,"All"),v:0},{n:mstrmojo.desc(12726,"Connect Live"),v:1}]}]},{scriptClass:"mstrmojo.Button",slot:"allSourceNode",alias:"dropDownBtn",cssClass:"mstrmojo-di-source-search-button",onclick:function(){this.parent.showEditorConfig();},bindings:{visible:function(){return this.parent.mode===LIST_MODE&&!mstrApp.isWorkstation&&false;}}},{scriptClass:"mstrmojo.Label",slot:"allSourceNode",text:mstrmojo.desc(12727,"Advanced Search"),cssClass:"mstrmojo-di-source-search-label",bindings:{visible:function(){return this.parent.mode===LIST_MODE&&!mstrApp.isWorkstation&&false;}},onclick:function(){this.parent.showEditorConfig();}},{scriptClass:"mstrmojo.ui.SearchBox",markupString:'<div id={@id} class="mstrmojo-ui-SearchBox cf {@cssClass}" style="{@cssText}"><input class="mstrmojo-ui-sb-input" type="text" placeholder="{@emptyText}" mstrAttach:keyup,blur/><div class="mstrmojo-ui-sb-btn" mstrAttach:click ></div></div>',searchDelay:0,cssClass:"mstrmojo-di-source-search",slot:"allSourceNode",alias:"searchBox",emptyText:EMPTY_SEARCH_TEXT,bindings:{visible:function(){return this.parent.mode===LIST_MODE&&!mstrApp.isWorkstation&&false;}},searchTriggered:function(value){this.parent.onSearch(value);}},{scriptClass:"mstrmojo.DI.ui.ScrollableBox",alias:"allSources",cssClass:"mstrmojo-di-sourceGrid",slot:"allSourceNode",ddaList:false,padding:5,getHeight:function(){var height=$HASH.walk("parent.domNode.clientHeight",this)||0,dataSetsHeight=$HASH.walk("parent.datasetsNode.clientHeight",this)||0;return height-dataSetsHeight;},children:[{scriptClass:"mstrmojo.DI.DISourceItemBox",alias:"sourceTable",setSrcLsrs:function(){var ce=!mstrApp.diParams.disableCESource?constants.srcItemTypes.CLOUDELEMENT_CONNECTOR:undefined,db=mstrApp.diParams.ImportDatabase?constants.srcItemTypes.DBTYPE_SOURCE:undefined;return[ce,db];}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-communitybox",alias:"community",bindings:{visible:function(){return $DIHELPER.isWS()||!$DIHELPER.isOnetier();}},children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community title",text:mstrmojo.desc(15171,"Community Extension"),},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-addconnector",alias:"addConnector",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon addconnector",bindings:{enabled:function(){return $DIHELPER.isLocalWS()?true:mstrApp.diParams.AccessDataFromFiles&&mstrApp.diParams.Admin&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;},title:function(){return connectorPrivilegeCheck();}},onclick:function(){if(this.enabled){mstrApp.getRootController().showDialog(constants.dialogType.addConnectorDialog);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15170,"Add Connector"),bindings:{enabled:function(){return $DIHELPER.isLocalWS()?true:mstrApp.diParams.AccessDataFromFiles&&mstrApp.diParams.Admin&&(mstrApp.diParams.ImportDatabase!==0)&&mstrApp.diParams.EnableURLImport;},title:function(){return connectorPrivilegeCheck();}},onclick:function(){if(this.enabled){mstrApp.getRootController().showDialog(constants.dialogType.addConnectorDialog);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-community-addconnector-symbol",text:"|"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-extension",alias:"extension",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon extension",onclick:function(){window.open($MARKPLACE_URL);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15169,"Browse Extensions"),onclick:function(){if($DIHELPER.isWS()){window.FormWrapper.openPage($MARKPLACE_URL);}else{window.open($MARKPLACE_URL);}}}]},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-community-addconnector-symbol",text:"|"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-community-addconnector",alias:"deployConnector",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-community-icon addconnector",bindings:{enabled:function(){return $DIHELPER.isLocalWS()?false:mstrConfig.connectorWebBaseURL&&mstrApp.diParams.Admin;},title:function(){return mstrConfig.connectorWebBaseURL?"":mstrmojo.desc(15808,"Community Connectors Application URL is not set.");}},onclick:function(){if(this.enabled){window.open(mstrConfig.connectorWebBaseURL+"?webUrl="+window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+mstrConfig.taskURL+"&sessionState="+mstrApp.sessionState);}}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-community addconnector",text:mstrmojo.desc(15807,"Deploy Community Connectors"),bindings:{enabled:function(){return $DIHELPER.isLocalWS()?false:mstrConfig.connectorWebBaseURL&&mstrApp.diParams.Admin;},title:function(){return mstrConfig.connectorWebBaseURL?"":mstrmojo.desc(15808,"Community Connectors Application URL is not set.");}},onclick:function(){if(this.enabled){var me=this;var handleDeployCommunityConnectors=function(res){if(res.data===DEPLOY_COMMUNITY_CONNECTORS_READY){$DOM.detachEvent(window,"message",me.handleDeployCommunityConnectors);var response={webUrl:window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+mstrConfig.taskURL,sessionState:mstrApp.sessionState,baseURL:mstrConfig.connectorWebBaseURL};$DIHELPER.sendResponse2Window(response,window.location.origin,me.popupWnd);}};if(me.handleDeployCommunityConnectors){$DOM.detachEvent(window,"message",me.handleDeployCommunityConnectors);}$DOM.attachEvent(window,"message",handleDeployCommunityConnectors);me.handleDeployCommunityConnectors=handleDeployCommunityConnectors;me.popupWnd=window.open("../html/CommunityConnectorsWaiting.html");}}}]}]},{scriptClass:"mstrmojo.VBox",cssText:"position: relative",alias:"sourceTableConnector",bindings:{visible:function(){return $DIHELPER.isWS()||!$DIHELPER.isOnetier();}}}]},{scriptClass:"mstrmojo.Table",alias:"sourceList",cssClass:"mstrmojo-di-sourceList",slot:"allSourceNode",visible:false,rows:maxRows,cols:5,ddaList:false},{scriptClass:"mstrmojo.Label",slot:"searchTagsNode",text:mstrmojo.desc(12889,"Returned results are related to:"),bindings:{visible:function(){return this.parent.filterTags.length>0;}}},{scriptClass:"mstrmojo.VBox",slot:"searchTagsNode",alias:"searchTagList"}],showEditorConfig:function(cfg){var diSourceList=this;var cfgEditor=new mstrmojo.ui.menus.EditorConfig($HASH.copy(cfg,{hostId:this.id,hostElement:this.dropDownBtn.domNode,isHostedWithin:false,hostProxyCssClass:"item-mn-proxy",contents:new mstrmojo.ui.CheckList({multiSelect:true,orientation:"v",itemIdField:"did",alias:"list",items:getAdvSearchItems.call(diSourceList)}),data:{}}));cfgEditor.fnOk=function(){var selectedItems;selectedItems=cfgEditor.contents.getSelectedItems();if(diSourceList.mode===0){diSourceList.set("filterTagsInGridView",selectedItems);}else{diSourceList.set("filterTags",selectedItems);}};var listEditor=cfgEditor.newInstance();if(this.mode===0){if(this.filterTagsInGridView&&this.filterTagsInGridView.length>0){listEditor.list.selectItems(this.filterTagsInGridView);}}else{if(this.filterTags&&this.filterTags.length>0){listEditor.list.selectItems(this.filterTags);}}this.openPopup(listEditor);},preBuildRendering:function(){if(this._super){this._super();}var model=mstrApp.getRootController().getModel(),args=[constants.srcItemTypes.STATIC_SOURCE];if(model.hasCloudElementFetched()){args.push(constants.srcItemTypes.CLOUDELEMENT_CONNECTOR);}if(model.hasCustomConnenctFetched()){args.push(constants.srcItemTypes.CUSTOM_CONNECTOR);}if(model.hasDBMSTypeFetched()){args.push(constants.srcItemTypes.DBTYPE_SOURCE);}this.populateSources.apply(this,args);model.attachEventListener("isDirectDataAccessChange",this.id,this.update);model.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},adjustSize:function(evt){var width=Math.floor(parseInt(evt.size.w,10)),height=Math.floor(parseInt(evt.size.h,10)),target=evt.target;if(!$DIHELPER.acceptEventFromAncestor.call(this,target)){return ;}if(isNaN(width)||width<0||!this.domNode){return ;}centerSourceList.call(this,"allSources",width);var numListCols=Math.max(5,Math.floor((width-40)/195));if(!mstrApp.isPopup&&this.sourceList){numOfcols=numListCols-1;maxRows=Math.floor((parseInt(evt.size.h,10)-20)/25);this.sourceList.cols=numListCols;if(this.sourceList.domNode){this.sourceList.refresh();height=parseInt(evt.size.h,10)-30+"px";this.sourceList.domNode.style.height=height;}}if(this.sourceList&&this.sourceList.domNode){this.sourceList.domNode.children[0].style.width=(width-28)+"px";if(width-630<200&&mstrApp.isPopup){this.dropDownBtn.domNode.style.marginRight=(width-630)+"px";}if(this.filterTags.length>0){if(width<940&&CACHE_COLS!==3){this.onfilterTagsChange();}else{if(width>=940&&CACHE_COLS===3){this.onfilterTagsChange();}}}}CACHE_WIDTH=width;},onheightChange:function(){var h=parseInt(this.height,10);if(!mstrApp.isPopup){if(this.sourceList){this.sourceList.set("height",(h-20)+"px");}}},postBuildRendering:function(){var model=mstrApp.getRootController().model;if(this._super){this._super();}model.raiseEvent({name:"sourceListModeChange",mode:this.mode});model.attachEventListener(constants.srcItemTypes.DBTYPE_SOURCE,this.id,"update");model.attachEventListener(constants.srcItemTypes.CLOUDELEMENT_CONNECTOR,this.id,"update");model.attachEventListener(constants.srcItemTypes.CUSTOM_CONNECTOR,this.id,"update");},postCreate:function(){var model=mstrApp.getRootController().getModel();model.attachEventListener("sourceItemsChange",this.id,this.onsourceItemsChange);},displayCustomConnectors:function(cc){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return ;}var model=mstrApp.getRootController().getModel();var communityVisible=!model.isDirectDataAccess&&!mstrApp.diParams.disableDDA;this.allSources.community.set("visible",communityVisible&&!(cc&&cc.length===0)&&!mstrApp.diParams.disableCustomerConnector);this.allSources.sourceTableConnector.set("visible",communityVisible);this.allSources.sourceTableConnector.set("children",cc);this.allSources.updateScrollbars();this.allSources.disableScroll(true,false);},displayMainPageSourceItems:function(items,isAppaned){if(mstrApp.isSingleTier){items=filterSourcesForOneTier(items);}else{items=filterSourcesByPrivileges(items);}this.allSources.sourceTable.addItems(items,isAppaned);this.allSources.updateScrollbars();this.allSources.disableScroll(true,false);},populateSources:function populateSources(sourceItemType){var model=this.model,items,hasNonSAPHana=this.hasNonSAPHana,selectedSourceItem,$this=this,args=Array.prototype.slice.call(arguments,0);selectedSourceItem=$A.filter(model.sourceItems,function(item){return item.selected!==false;});if(this.parent.parent&&this.parent.parent.items){items=this.parent.parent.items;}else{if(this.isSAPHana){items=[model.sourceItems[2]];items[0].isSAPHanaDDA=true;}else{items=(this.isFilterDDA||model.isDirectDataAccess)?filterSourcesByDDA(model,selectedSourceItem):selectedSourceItem;$A.forEach(items,function(item){item.hasNonSAPHana=hasNonSAPHana;item.isSAPHanaDDA=false;});}}var hasDDAOnlySource=window.mstrAppSchema?false:this.hasDDAOnlySource;items=filterSourcesByDDAOnly(model,items,hasDDAOnlySource);var enabledItem=[],disabledItem=[];var itemsStatic=[],itemsCE=[],itemsDB,_itemsRelationalDB=[],_itemHadoopDB=[],itemsCustomConnector=[defaultCustomConnector];$A.forEach(items,function(item){if(item.bindings.enabled()){enabledItem.push(item);}else{disabledItem.push(item);}if(item.sid===constants.sourceItemType.database&&model.hasDBMSTypeFetched()){_itemsRelationalDB=_itemsRelationalDB.concat(model.getFlattenedDBTypeSourceItems(item,$this.isFilterDDA));itemsStatic.push(item);}else{if(item.sid===constants.sourceItemType.hadoop&&model.hasDBMSTypeFetched()){_itemHadoopDB=_itemHadoopDB.concat(model.getFlattenedDBTypeSourceItems(item,$this.isFilterDDA));itemsStatic.push(item);}else{if(item.sid===constants.sourceItemType.newConnector){itemsCustomConnector.push(item);}else{if(item.sid===constants.sourceItemType.cloudElement){itemsCE.push(item);}else{itemsStatic.push(item);}}}}});items=enabledItem.concat(disabledItem);itemsDB=_itemsRelationalDB.concat(_itemHadoopDB);if(this.isFilterDDA&&model.isDirectDataAccess){var index=$A.find(itemsDB,"dbType",constants.dbType.XQUERY);if(index>-1){itemsDB.splice(index,1);}}if($A.filter(itemsDB,function(item){return item.dbType===constants.dbType.GENERIC;}).length>1){itemsDB.splice($A.find(itemsDB,"dbType",constants.dbType.GENERIC),1);}itemsStatic=this.filterByTag(itemsStatic);itemsDB=this.filterByTag(itemsDB);itemsCE=this.filterByTag(itemsCE);itemsCustomConnector=this.filterByTag(itemsCustomConnector);if($this.keyword!==""){itemsStatic=this.filterByKeyword(itemsStatic);itemsDB=this.filterByKeyword(itemsDB);itemsCustomConnector=this.filterByKeyword(itemsCustomConnector);itemsCE=this.filterByKeyword(itemsCE);}if(args.indexOf(constants.srcItemTypes.STATIC_SOURCE)>=0){this.displayMainPageSourceItems(itemsStatic);this.displayCustomConnectors(itemsCustomConnector);}if(args.indexOf(constants.srcItemTypes.DBTYPE_SOURCE)>=0){this.displayMainPageSourceItems(itemsDB,true);}if(args.indexOf(constants.srcItemTypes.CLOUDELEMENT_CONNECTOR)>=0){if(!model.isDirectDataAccess){this.displayMainPageSourceItems(itemsCE,true);}}if(args.indexOf(constants.srcItemTypes.CUSTOM_CONNECTOR)>=0){this.displayCustomConnectors(itemsCustomConnector);}if(args.indexOf(constants.srcItemTypes.ALL_SOURCES)>=0){var cld=[].concat(itemsStatic).concat(itemsDB).concat(itemsCE);this.displayMainPageSourceItems(cld);this.displayCustomConnectors(itemsCustomConnector);}},filterByTag:function(items){var $this=this;return $this.filterTagsInGridView.length?$A.filter(items,function(item){return item.tags?$A.filter($this.filterTagsInGridView,function(it){var flag;if(constants.combination[it.v]){$A.forEach(constants.combination[it.v],function(value){flag=item.tags.indexOf(value)>-1;return !flag;});return flag;}else{return item.tags.indexOf(it.v)>-1;}}).length:false;}):items;},filterByKeyword:function(items){var keyword=this.keyword;var res=$A.filter(items,function(item){return item.n.toLowerCase().indexOf(keyword.toLowerCase())>-1;});res=$A.map(res,function(item){var index=item.n.toLowerCase().indexOf(keyword.toLowerCase()),_item=$H.copy(item);if(index!==-1){keywordPopulate(_item,item.n,index,keyword.length);}return _item;});return res;},update:function update(e){var model=this.model;this.allSources.sourceTable.ddaList=model.isDirectDataAccess;this.allSources.sourceTableConnector.ddaList=model.isDirectDataAccess;if(e&&e.name==="isDirectDataAccessChange"){this.populateSources(constants.srcItemTypes.ALL_SOURCES);}else{if(e&&e.name){this.populateSources(e.name);}}},onSearch:function(keyWord){var model=this.model;var filteredItems=filterSourcesByText(model.sourceList,keyWord,numOfcols);if(this.filterTags.length!==0){var filterTags={};$A.forEach(this.filterTags,function(item){filterTags[item.v]=true;});filteredItems=filterSourcesbyTag(filteredItems,filterTags,numOfcols);}if(model.isDirectDataAccess){filteredItems=filterSourcesByDDA(model,filteredItems);}if(!mstrApp.isSingleTier){filteredItems=filterSourcesByPrivileges(filteredItems);}else{filteredItems=filterSourcesForOneTier(filteredItems);}var children=composeSourceListChildren.call(this,filteredItems,this.filterTags.length!==0,keyWord);this.sourceList._set_children("children",children);},onSearchGridView:function(keyWord){var filteredItems=this._onfilterTags(0);this.set("keyword",keyWord);this.update({name:constants.srcItemTypes.ALL_SOURCES});},onmousedown:function(evt){if(evt&&evt.e&&evt.e.button===1){evt.preventDefault();evt.cancel();}},onNextButtonClick:function(evt){var controller=mstrApp.getRootController(),item=this.selectedSource,slot;if(item.enabled){if(mstrApp.isSingleTier&&item.checkConectivity&&window.FormWrapper.testInternetConnection()!==0){var errorMessage=mstrmojo.desc(13961,"No Internet connection. You can configure an Internet proxy through your computer's #."),replaceStr='<a href="" onclick="mstrApp.getRootController().dialogController.close(mstrmojo.DI.DIConstants.dialogType.errorDialog);mstrApp.getRootController().wrapUpDataImport();window.setTimeout(function(){window.FormWrapper.showProxyEditor();},100);return false;">'+mstrmojo.desc(14125,"settings")+"</a>";errorMessage=errorMessage.replace("#",replaceStr)+".";controller.displayError(errorMessage,false,"",null,mstrmojo.desc(11812,"Notification"));return ;}slot=mstrApp.getRootController().navigationController.getPageSlot();var properties={operationMode:constants.operationMode.create};if(item.mode){properties.mode=item.mode;}slot.setConfig({properties:properties});item.sourceInfo.evt=evt;if(item.pageType===constants.pageType.addConnectorList){mstrApp.getRootController().showDialog(constants.dialogType.addConnectorDialog);}else{controller.showPage(item.pageType,item.sourceInfo,slot);}}},onBackButtonClick:function(){mstrApp.getRootController().showPage(constants.pageType.emmaPreview,null);},onHelpButtonClick:function onHelpButtonClick(){return"Interfaces_for_importing_data.htm";}});}());