(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.DI.DIConstants","mstrmojo.qb.QBPanel","mstrmojo.DI.DIHelpers","mstrmojo.ui.Splitter");mstrmojo.requiresDescs(1442,3416,6189,9130,15255);var $DECODE_HTML=mstrmojo.string.decodeHtmlString,$DI_CONSTANTS=mstrmojo.DI.DIConstants,$BROWSE_FLAG=$DI_CONSTANTS.browseFlag,$DIHELPER=mstrmojo.DI.DIHelpers,$REQUEST_FLAG=$DI_CONSTANTS.requestFlag;function decodeHTMLString(input){return $DECODE_HTML(input).replace(/&apos;/g,"'");}mstrmojo.DI.ui.dialogs.DIAggregationDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIAggregationDialog",title:mstrmojo.desc(15255,"Aggregation"),zIndex:10,cssClass:"mstrmojo-di-aggregationDialog",tableID:undefined,model:undefined,controller:undefined,onClose:mstrmojo.emptyFn,onPreClose:function(){window.setTimeout((function($this){return function(){$this.btnGroup.btnClose.onclick();};})(this),0);return false;},onOpen:function onOpen(){var me=this,model=this.model,callback={success:function(res){mstrApp.msgid=res.msgid;model.loadReport($BROWSE_FLAG.reportBindingTable+$BROWSE_FLAG.dataPreview,0,$REQUEST_FLAG.mapping,null,{success:function success(res){model.loadDefinition(res);var scrollNode=me.splitter.tabPanel.tabView.scrollBox.domNode;scrollNode.style.overflowY="hidden";scrollNode.onmouseover=scrollNode.onmouseout=function(){};}});}};model.getFunctions(true);model.originalMsgID=mstrApp.msgid;mstrApp.getRootController().getDataService().removeOrDuplicateRI({success:function success(res){mstrApp.msgid=res.msgid;if(me.hasAggFilter){model.firstTimeLoading=true;callback.success({msgid:mstrApp.msgid});}else{me.controller.getDataService().submitRequest(callback,{taskId:"DIStartOrCancelAggFilterChange",tbid:me.tableID});}}},{messageID:mstrApp.msgid});},children:[{scriptClass:"mstrmojo.ui.Splitter",cssClass:"mstrmojo-qb-main-panel",alias:"splitter",orientation:mstrmojo.ui.Splitter.ENUM_OR.VERTICAL,getLayoutOffsets:function getLayoutOffsets(){return{h:2,w:2};},children:[{scriptClass:"mstrmojo.Box",slot:"firstSplitNode",alias:"tabPanel",children:[{scriptClass:"mstrmojo.Box",alias:"header",cssClass:"mstrmojo-qb-tableview-toolbar",children:[{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon play",useRichTooltip:true,text:mstrmojo.desc(9130,"Execute SQL"),onclick:function(){mstrApp.getRootController().model.autoMap(null,false,false);}},{scriptClass:"mstrmojo.qb.Button",iconClass:"mstrmojo-qb-tableview-toolbarIcon filter",useRichTooltip:true,text:mstrmojo.desc(12378,"Filter..."),cssText:"width:auto;",innerBtxCss:"width:auto;",onclick:function(){mstrApp.getRootController().openConditionDialog();}}]},{scriptClass:"mstrmojo.qb.QBTableView",cssClass:"mstrmojo-qb-tableview on",alias:"tabView",fromAggregation:true}]},{scriptClass:"mstrmojo.qb.QBMappings",alias:"mappingPanel",cssText:"position:relative;overflow:hidden;padding:0px;",onRender:function onRender(){this.set("height","300px");},slot:"secondSplitNode"}],config:{firstSplit:{v:"400px",min:"150px",max:undefined},secondSplit:{v:"215px",min:"150px",max:undefined},resizeHandle:{v:"5px"}}},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",alias:"btnGroup",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),onclick:function(){var editor=this.parent.parent,model=editor.model;model.autoMap({success:function success(){model.buildRelations({success:function(){model.cleanDuplicateRI(false);editor.close();editor.destroy();}});}},true);editor.fromAggregation=true;}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(3416,"Cancel"),alias:"btnClose",onclick:function(){var editor=this.parent.parent,model=editor.model;model.cleanDuplicateRI(true);editor.fromAggregation=false;editor.close();editor.destroy();}}]}],toggleDataPreview:function toggleDataPreview(){return ;},openExpressionEditor:function openExpressionEditor(obj,zIndex){var EXPR_EDITOR_ID="qb-expr",exprEditor=mstrmojo.all[EXPR_EDITOR_ID]||mstrmojo.insert({scriptClass:"mstrmojo.qb.ExpressionEditor",id:EXPR_EDITOR_ID});exprEditor.set("oi",mstrmojo.hash.copy(obj,{mhfts:{},mvfts:{}}));exprEditor.open(null,{zIndex:zIndex+1||10});}});}());