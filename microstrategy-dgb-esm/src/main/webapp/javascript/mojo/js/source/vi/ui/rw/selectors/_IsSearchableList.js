(function(){mstrmojo.requiresCls("mstrmojo.SearchWidget","mstrmojo.hash","mstrmojo.string");var $H=mstrmojo.hash,$S=mstrmojo.string,DELIMITER_START="\u001E",DELIMITER_END="\u001F";var filterItemName=function(item,itemNameField,filterExpression){var name=item[itemNameField],filterRegExp=new RegExp($S.regEscape(filterExpression),"ig"),filterMarkedName;if(filterRegExp.test(name)){filterMarkedName=filterExpression?name.replace(filterRegExp,function(match){return DELIMITER_START+match+DELIMITER_END;}):name;}return filterMarkedName;};mstrmojo.vi.ui.rw.selectors._IsSearchableList=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsSearchableList",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsSearchableList",itemNameField:"n",getItemProps:function getItemProp(item,idx){var prop=this._super(item,idx);prop.html=$S.encodeHtmlString(prop.n).replace(new RegExp(DELIMITER_START,"ig"),"<em>").replace(new RegExp(DELIMITER_END,"ig"),"</em>");return prop;},getItemMarkup:function getItemMarkUp(item,idx){return this._super(item,idx).replace("@en@n","@html");},_buildItemsMarkup:function _buildItemsMarkup(start,end,markupPrefix,markupSuffix,itemPrefix,itemSuffix){var filterExpr=this.filterExpr,itemNameField=this.itemNameField,fnItemRender=this.itemRenderer.render,items=this.items,markup=[],count=0;if(filterExpr.length===0){return this._super(start,end,markupPrefix,markupSuffix,itemPrefix,itemSuffix);}markup.push(markupPrefix||"");for(var i=0,len=items.length;i<len&&count<=end;i++){var item=items[i],filteredName=filterItemName(item,itemNameField,filterExpr);if(filteredName){if(count>=start){var clonedItem=$H.copy(item);clonedItem[itemNameField]=filteredName;markup.push(itemPrefix||"");markup.push(fnItemRender(clonedItem,i,this));markup.push(itemSuffix||"");}count++;}}markup.push(markupSuffix||"");return markup;},postfilterExprChange:function postfilterExprChange(){var items=this.items,itemsNode=this.itemsContainerNode;this.renderIndex=0;if(items&&itemsNode){itemsNode.innerHTML=this._buildItemsMarkup(0,this.renderOnScroll?this.renderBlockSize-1:items.length-1,this._markupPrefix&&this._markupPrefix(),this._markupSuffix&&this._markupSuffix(),this._itemPrefix&&this._itemPrefix(),this._itemSuffix&&this._itemSuffix()).join("");}},getSearchbarCfg:function getSearchbarCfg(){return{alias:"search",quickSearch:true,placeholder:this.searchboxNode,onsearch:function onsearch(pattern){this.parent.set("filterExpr",pattern);},onclear:function onclear(){this.parent.set("filterExpr","");}};},preBuildRendering:function(){this.filterExpr="";this.renderIndex=0;return this._super();},postBuildRendering:function postBuildRendering(){var tb=this.getSearchbarCfg(),sn=tb.placeholder,searchbox=this.searchbox;if(sn){if(!searchbox){tb.parent=this;searchbox=new mstrmojo.SearchWidget(tb);this.searchbox=searchbox;}searchbox.placeholder=sn;searchbox.render();}return this._super();},unrender:function unrender(ignoreDom){var searchbox=this.searchbox;if(searchbox){searchbox.unrender(ignoreDom);}return this._super(ignoreDom);}});}());