(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.Container","mstrmojo._HasPopup");var $FUNC=mstrmojo.func,$DOM=mstrmojo.dom,$THEME_NAMES=mstrmojo.ui._HasUITheme.EnumThemeNames,HOSTED_CSS_CLASS="mstrmojo-popup-widget-hosted";mstrmojo.ui.PopupButton=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasPopup],{scriptClass:"mstrmojo.ui.PopupButton",onPopupWidgetClosed:mstrmojo.emptyFn,onPopupWidgetOpened:mstrmojo.emptyFn,anchorSlot:"domNode",isHostedWithin:true,hostedCSSClass:"",destroy:function destroy(ignoreDom){if(this._listenerProc){$DOM.detachEvent(window,"resize",this._listenerProc);}this._super(ignoreDom);},getPopupWidget:mstrmojo.emptyFn,postCreateChildren:function postCreateChildren(){var popupWidget=this.getPopupWidget();if(!popupWidget||popupWidget._pbCfg){return ;}var fnBind=function fnBind(func,context){return function(){func.apply(context,arguments);};};popupWidget.onOpen=$FUNC.composite([fnBind(this.onPopupWidgetOpened,this),popupWidget.onOpen||mstrmojo.emptyFn]);popupWidget.onClose=$FUNC.composite([fnBind(this.onPopupWidgetClosed,this),popupWidget.onClose||mstrmojo.emptyFn]);popupWidget._pbCfg=true;},onclick:function onclick(evt){if(this.isClickingAnchorSlot(evt)){var popupWidget=this.getPopupWidget();if(!popupWidget.visible){this.openPopup(popupWidget);}else{this.closePopup();}}},isClickingAnchorSlot:function isClickingAnchorSlot(evt){var target=evt.getTarget();return target===this[this.anchorSlot]||target.parentNode===this[this.anchorSlot];},onPopupAutoClosed:function onPopupAutoClosed(e,hWin){if($DOM.contains(this[this.anchorSlot],$DOM.eventTarget(hWin,e),true)){return false;}},getPopupHostNode:function getPopupHostNode(){return this.containerNode;},getPopupConfig:function getPopupConfig(){var css=[HOSTED_CSS_CLASS],configCss=this.hostedCSSClass;if(configCss){css.push(configCss);}var popupCfg=new mstrmojo.ui.PopupConfig({hostId:this.id,hostElement:this.getPopupHostNode(),anchorElement:this[this.anchorSlot],isHostedWithin:this.isHostedWithin,hostProxyCssClass:css.join(" ")});return this.disposables?this.addDisposable(popupCfg):popupCfg;},unrender:function unrender(ignoreDom){if(this._listenerProc){$DOM.detachEvent(window,"resize",this._listenerProc);delete this._listenerProc;}this._super(ignoreDom);},postBuildRendering:function postBuildRendering(){var popupWidget=this.getPopupWidget();if(popupWidget){var popupCfg=this.getPopupConfig();if(!popupCfg.isHostedWithin){var ancestor=this.parent||this.opener,css=popupCfg.hostProxyCssClass.split(" ");css.push(this.domNode.className);while(ancestor){var themeClassName=ancestor.themeClassName;if(themeClassName){css.push(themeClassName);break;}ancestor=ancestor.parent||ancestor.opener;}if(popupCfg.useDarkTheme){css.splice(css.indexOf($THEME_NAMES.LIGHT_THEME),1);css.push($THEME_NAMES.DARK_THEME);}popupCfg.hostProxyCssClass=css.join(" ");}mstrmojo.Obj.free(popupWidget.popupConfig);popupWidget.popupConfig=popupWidget.addDisposable(popupCfg);}if(!(this.editableSlot&&$DOM.isMobile)){var popupWidgetId=popupWidget.id,fn=this._listenerProc=function(){var w=mstrmojo.all[popupWidgetId];if(w&&w.visible&&w.adjustCornersForPopupOverflow){w.adjustCornersForPopupOverflow();}};if(this.isHostedWithin===false){$DOM.attachEvent(window,"resize",fn);}}return this._super();}});}());