(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.css","mstrmojo.DI.DIConstants","mstrmojo.DI.DIApp","mstrmojo.DI.OneTierServerTransport","mstrmojo.DI.WorkstationServerProxy","mstrmojo.DI.WorkstationServerTransport");var $HASH=mstrmojo.hash;var $D=mstrmojo.dom;var sendHttpRequest=mstrmojo.DI.WorkstationServerTransport.sendHttpRequest;var STATUS_CODES=mstrmojo.DI.DIConstants.statusCode;var WAIT_BOX_ID="waitBox";var DEBUG_WEB_SERVER_BASE_URL="";var DEBUG_FAKE_CLIENT_DI_PARAMS=null;function readDiParams(){if(DEBUG_FAKE_CLIENT_DI_PARAMS){return DEBUG_FAKE_CLIENT_DI_PARAMS;}var diParamsConfig=window.FormWrapper.diParams||window.FormWrapper.getDIParams();var diParams=diParamsConfig?JSON.parse(diParamsConfig):{};return diParams;}function getLoginTaskUrl(workstationEnv){var env=workstationEnv;return env.debugWebServerTaskAdminUrl+"?taskId=login&taskEnv=xhr&taskContentType=json&server="+encodeURIComponent(env.serverName)+"&project="+encodeURIComponent(env.projectName)+"&userid="+encodeURIComponent(env.login)+"&password="+encodeURIComponent(env.password);}function appendSessionStateAsync(workstationEnv,callback){sendHttpRequest("GET",getLoginTaskUrl(workstationEnv),{callbacks:{success:function(res){callback(res.json.sessionState);}}});}mstrmojo.DI.WorkstationPageService={loadPage:function(){var initEnvAndDoLoadPage=function(){var passedInDiParams=readDiParams();if(passedInDiParams.serverBasedOneTier){console.log("Server-based DI",passedInDiParams);var workstationEnv=passedInDiParams.workstationEnv;if(workstationEnv){var debugWebServerBaseUrl=DEBUG_WEB_SERVER_BASE_URL||(workstationEnv.dossierServerUrl?workstationEnv.dossierServerUrl.replace(/\/$/,""):"");var debugWebServerIsAsp=debugWebServerBaseUrl.endsWith("/asp");var debugWebServerTaskProcUrl=debugWebServerBaseUrl+(debugWebServerIsAsp?"/TaskProc.aspx":"/taskProc");var debugWebServerTaskAdminUrl=debugWebServerBaseUrl+(debugWebServerIsAsp?"/TaskAdmin.aspx":"/taskAdmin");$HASH.copy({debugWebServerBaseUrl:debugWebServerBaseUrl,debugWebServerIsAsp:debugWebServerIsAsp,debugWebServerTaskProcUrl:debugWebServerTaskProcUrl,debugWebServerTaskAdminUrl:debugWebServerTaskAdminUrl},workstationEnv);}else{console.warn("window.FormWrapper.diParams.workstationEnv is not set. Server-based DI requires it.");}doLoadPage({workstationEnv:workstationEnv,passedInDiParams:passedInDiParams});mstrApp.start();}else{console.log("Local DI",passedInDiParams);doLoadPage({passedInDiParams:passedInDiParams});mstrApp.start();}}.bind(this);setTimeout(initEnvAndDoLoadPage,0);}};function doLoadPage(params){var prams=params||{};var workstationEnv=params.workstationEnv;var passedInDiParams=params.passedInDiParams;var mstrDebug=false;if(mstrDebug){var queue=[],idx=-1,isMinimized=false;var consoleContainer=document.createElement("div");consoleContainer.className="mstrConsole";document.body.appendChild(consoleContainer);var consoleDiv=document.createElement("div");consoleDiv.className="mstrDebugConsole";consoleContainer.appendChild(consoleDiv);var consoleInput=document.createElement("div");consoleInput.className="mstrConsoleInput";consoleContainer.appendChild(consoleInput);var execInput=document.createElement("input");execInput.onkeydown=function(evt){function jumpQueue(isDown){if(isDown?idx<queue.length-1:idx>0){idx=idx+(isDown?1:-1);execInput.value=queue[idx];}return false;}switch(evt.keyCode){case 13:execButton.click();break;case 40:return jumpQueue(true);case 38:return jumpQueue(false);}};consoleInput.appendChild(execInput);var execButton=document.createElement("input");execButton.setAttribute("type","button");execButton.setAttribute("value","Execute");execButton.onclick=function(){var value=execInput.value;idx=queue.push(value)-1;eval(value);};consoleInput.appendChild(execButton);var dvToolbar=document.createElement("div");dvToolbar.className="mstrConsoleToolbar";var clearBtn=document.createElement("div");clearBtn.setAttribute("title","Clear");clearBtn.innerText="X";clearBtn.onclick=function(){consoleDiv.innerHTML="";execInput.value="";};function configureMaxRestoreBtn(btn){btn.setAttribute("title",isMinimized?"Restore":"Minimize");btn.innerText=isMinimized?"?":"?";}var minimizeBtn=document.createElement("div");minimizeBtn.onclick=function(){isMinimized=!isMinimized;mstrmojo.css.toggleClass(consoleContainer,"min",isMinimized);configureMaxRestoreBtn(this);};configureMaxRestoreBtn(minimizeBtn);dvToolbar.appendChild(minimizeBtn);dvToolbar.appendChild(clearBtn);consoleContainer.appendChild(dvToolbar);window.console={log:function(){Array.prototype.slice.call(arguments).forEach(function(arg){if(typeof arg==="object"){arg=JSON.stringify(arg);arg=arg.replace(/{/g,"{<br/>");arg=arg.replace(/}/g,"<br/>}");arg=arg.replace(/,/g,",<br/>");}var div=document.createElement("div");div.innerHTML=arg;consoleDiv.appendChild(div);});}};}var diParams={isNewAnalysis:true,isEdit:false,isCloudPro:false,isEmmaCube:true,isDirectDataAccess:false,isManagedCube:false,ReportId:undefined,CubeName:undefined,FolderId:undefined,CubeDesc:undefined,AnalysisId:undefined,StatusCode:0,CreateAnalysis:1,CreateReportServices:1,CreateViewReport:1,CubeQuota:200,Delete:1,EnableFTPImport:true,EnableFileImport:true,EnableHttpImport:true,EnableURLImport:true,ShowDDAOptions:true,ImportDatabase:1,AccessDataFromFiles:1,AccessDataFromCloudApp:1,Republish:1,Share:1,Subscriptions:1,UploadSizeLimit:100,datasets:null,hasNonRADataset:false,documentModel:null,missingCredentialsData:null,refreshMultipleCubes:false};diParams=$HASH.copy(passedInDiParams,diParams);console.log(diParams);var isQuickSearchEnabled=true;window.mstrApp=new mstrmojo.DI.DIApp({placeholder:"mainDIApp",isSingleTier:false,isWorkstation:true,Privs:'<uaps><pris pgd="2168BF094415A4B4A499E880A63721A2"><pri>-25166091</pri><pri>125894239</pri><pri>-1</pri><pri>1876686812</pri><pri>23380215</pri><pri>-15728400</pri><pri>-16389</pri><pri>61809</pri></pris></uaps>',name:"mstrWeb",localeId:"1033",displayLocaleId:"1033",jsRoot:"../javascript/",jsMojoRoot:"../javascript/mojo/js/source/",serverProxy:new mstrmojo.DI.WorkstationServerProxy({transport:mstrmojo.DI.WorkstationServerTransport}),diParams:diParams,isPopup:diParams.StatusCode===STATUS_CODES.republish||diParams.StatusCode===STATUS_CODES.schedule,isEdit:diParams.isEdit,isNewAnalysis:diParams.isNewAnalysis,isCloudPro:diParams.isCloudPro,isEMMACube:diParams.isEmmaCube,showDDAOptions:diParams.showDDAOptions,refreshMultipleCubes:diParams.refreshMultipleCubes,cubeSaveFolderId:diParams.cubeSaveFolderId,useQuickSearch:function(){return isQuickSearchEnabled&&"1"=="1";},searchAutoComplete:function(){return"1"=="1";},searchAutoCompleteDelay:function(){return"200";},getMsgID:function(){return mstrApp.rootCtrl.docCtrl.model.mid;},helpUrl:"http://www2.microstrategy.com/producthelp/2019/MSTRWeb/",userHelpPage:"index.html#context/analytics_desktop/",enableEmbeddedImages:true,features:{"edit-ive":true},dialogDict:{},modalEditorChange:function modalEditorChange(id,isOpen){if(!diParams.SmallWindow){return ;}if(diParams.StatusCode!==STATUS_CODES.republish&&diParams.StatusCode!==STATUS_CODES.schedule){return ;}if(id===WAIT_BOX_ID){return ;}var diApp=this;var resizeWindow=function(){if($HASH.isEmpty(diApp.dialogDict)){return ;}var windowWidth=0,windowHeight=0;$HASH.forEach(diApp.dialogDict,function(sub,dialogId){var editorNode=mstrmojo.all[dialogId].editorNode;windowWidth=Math.max(windowWidth,editorNode.offsetWidth);windowHeight=Math.max(windowHeight,editorNode.offsetHeight);});window.FormWrapper.setWindowContentSize(windowWidth,windowHeight);};var dialog=mstrmojo.all[id];if(isOpen){window.setTimeout(function(){if(diApp.dialogDict.hasOwnProperty(id)){return ;}var sub=dialog.attachEventListener("EditorResized",id,function(){resizeWindow();});var isFirstDialog=$HASH.isEmpty(diApp.dialogDict);diApp.dialogDict[id]=sub;if(isFirstDialog){dialog.titleNode.parentNode.style.display="none";window.FormWrapper.setTitle(dialog.title);if(dialog.scriptClass==="mstrmojo.DI.DIRepublishScheduleEditor"){return ;}}resizeWindow();});}else{if(!diApp.dialogDict.hasOwnProperty(id)){return ;}var sub=diApp.dialogDict[id];dialog.detachEventListener(sub);delete diApp.dialogDict[id];if($HASH.isEmpty(diApp.dialogDict)){window.setTimeout(function(){window.FormWrapper.closeWindow("{}");});return ;}resizeWindow();}}});}}());