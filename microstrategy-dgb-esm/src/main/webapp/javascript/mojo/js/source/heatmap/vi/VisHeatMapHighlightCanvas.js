(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.Container","mstrmojo.util.color","mstrmojo.VisUtility");var $COLOR=mstrmojo.util.color,$HASH=mstrmojo.hash,$ARRAY=mstrmojo.array;var SHAPE_COLOR={BASE_FILL_COLOR_DARK:"#20516b",BASE_FILL_COLOR_LIGHT:"#bce8ff",BORDER_COLOR:"#34abeb",FONT_COLOR_DARK:"#34abeb",FONT_COLOR_LIGHT:"#007ebe"};var HEADER_HIGHLIGHT_STYLE={DARKA:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_DARK},DARKB:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_DARK},DARKC:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_DARK,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.6,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_DARK},LIGHTA:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.4,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_LIGHT},LIGHTB:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_LIGHT},LIGHTC:{BASE_FILL_COLOR:SHAPE_COLOR.BASE_FILL_COLOR_LIGHT,HOVER_FILL_OPACITY:0.4,SELECTED_FILL_OPACITY:0.6,HOVER_SELECTED_FILL_OPACITY:0.65,BORDER_COLOR:SHAPE_COLOR.BORDER_COLOR,FONT_COLOR:SHAPE_COLOR.FONT_COLOR_LIGHT}};var contextMenuSelected=false,isPreviousSelected=false;function shrinkRect(rect,width){return{x:rect.x+width,y:rect.y+width,w:Math.max(rect.w-2*width,0),h:Math.max(rect.h-2*width,0)};}function drawBorder(ctx,rect,strokeStyle,width){if(width==0){return ;}var halfWidth=width/2,borderRect={x:rect.x+halfWidth,y:rect.y+halfWidth,w:Math.max(rect.w-width,0),h:Math.max(rect.h-width,0)};ctx.save();ctx.strokeStyle=strokeStyle;ctx.lineWidth=width;ctx.strokeRect(borderRect.x,borderRect.y,borderRect.w,borderRect.h);ctx.restore();}function getBackupStyleName(styleName){return"_"+styleName;}function saveAndApplyStyle(domNode,styleName,value){if(!domNode){return ;}var dnStyle=domNode.style;if(dnStyle[styleName]===value){return ;}var backupName=getBackupStyleName(styleName);if(domNode[backupName]===undefined){domNode[backupName]=getComputedStyle(domNode)[styleName];dnStyle[styleName]=value;}}function restoreStyle(domNode,styleName){if(!domNode){return ;}var backupName=getBackupStyleName(styleName),backupValue=domNode[backupName];if(backupValue!==undefined){domNode.style[styleName]=backupValue;domNode[backupName]=undefined;}}function drawSelectedCell(ctx,rect){var innerRect=shrinkRect(rect,this.outerBorderWidth);setBoardStyle.call(this);drawBorder(ctx,rect,this.outerBorderColor,this.outerBorderWidth);drawBorder(ctx,innerRect,this.innerBorderColor,this.innerBorderWidth);resetBoardStyle.call(this);}function setBoardStyle(){if(contextMenuSelected&&isPreviousSelected){if(this.themeType==="dark"){this.outerBorderColor=this.innerBorderColor="#ffffff";}else{this.outerBorderColor=this.innerBorderColor="#000000";}this.innerBorderWidth=0;}else{if(contextMenuSelected&&!isPreviousSelected){this.outerBorderWidth=0;this.innerBorderColor="#ffffff";}else{if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}}}}function resetBoardStyle(){if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}this.outerBorderWidth=2;this.innerBorderWidth=1;}function drawHoveredCell(ctx,rect){var innerRect=shrinkRect(rect,this.outerBorderWidth);ctx.save();ctx.fillStyle=$COLOR.getCSSColorString(this.backgroundColor,0.3);ctx.fillRect(innerRect.x,innerRect.y,innerRect.w,innerRect.h);ctx.restore();}function drawSelectedHeader(ctx,rect,labelDomNode,styles,isHovered){saveAndApplyStyle(labelDomNode,"color",styles.FONT_COLOR);var highlightRect=shrinkRect(rect,1);ctx.save();if(isHovered){ctx.fillStyle=$COLOR.getCSSColorString(styles.BASE_FILL_COLOR,styles.HOVER_SELECTED_FILL_OPACITY);}else{ctx.fillStyle=$COLOR.getCSSColorString(styles.BASE_FILL_COLOR,styles.SELECTED_FILL_OPACITY);}ctx.fillRect(highlightRect.x,highlightRect.y,highlightRect.w,highlightRect.h);ctx.restore();drawBorder(ctx,rect,styles.BORDER_COLOR,1);}function drawHighlight(isHovered,isSelected,painters){if(isSelected&&!isHovered){painters.selected();}else{if(!isSelected&&isHovered){painters.hover();}else{if(isSelected&&isHovered){painters.hoverSelected();}}}}function getCellPainters(ctx,rect){return{hover:function(){drawHoveredCell.call(this,ctx,rect);}.bind(this),selected:function(){drawSelectedCell.call(this,ctx,rect);}.bind(this),hoverSelected:function(){drawSelectedCell.call(this,ctx,rect);drawHoveredCell.call(this,ctx,shrinkRect(rect,1));}.bind(this)};}function highlightHeaderOnTop(rect,entity,config){var isEntityContainer=config.isEntityContainer,labelDomNode=entity.labelDomNode,isSelected=config.isSelected,isHovered=config.isHovered,ctx=this.canvas.getContext("2d"),styles=this.themeType==="dark"?HEADER_HIGHLIGHT_STYLE.DARKA:HEADER_HIGHLIGHT_STYLE.LIGHTA;contextMenuSelected=config.contextMenuSelected;isPreviousSelected=config.isPreviousSelected;if(this.themeType!=="dark"){if(contextMenuSelected&&isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.LIGHTC;}else{if(!contextMenuSelected&&isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.LIGHTA;}else{if(contextMenuSelected&&!isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.LIGHTB;}}}}else{if(contextMenuSelected&&isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.DARKC;}else{if(!contextMenuSelected&&isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.DARKA;}else{if(contextMenuSelected&&!isPreviousSelected){styles=HEADER_HIGHLIGHT_STYLE.DARKB;}}}}var painters,visHeatMap=this.parent;if(isEntityContainer){painters={hover:function(){restoreStyle(labelDomNode,"color");var highlightRect=shrinkRect(rect,1);ctx.save();ctx.fillStyle=$COLOR.getCSSColorString(styles.BASE_FILL_COLOR,styles.HOVER_FILL_OPACITY);ctx.fillRect(highlightRect.x,highlightRect.y,highlightRect.w,highlightRect.h);ctx.restore();},selected:function(){drawSelectedHeader(ctx,rect,labelDomNode,styles,false);},hoverSelected:function(){drawSelectedHeader(ctx,rect,labelDomNode,styles,true);}};}else{painters=getCellPainters.call(this,ctx,rect);}saveAndApplyStyle(labelDomNode&&labelDomNode.parentNode,"zIndex",3);ctx.clearRect(rect.x,rect.y,rect.w,rect.h);drawHighlight(isHovered,isSelected,painters);}function highlightHeaderOnMiddle(rect,entity,config){var isEntityContainer=config.isEntityContainer,labelDomNode=entity.labelDomNode,isSelected=config.isSelected,isHovered=config.isHovered,ctx=this.canvas.getContext("2d");contextMenuSelected=config.contextMenuSelected;isPreviousSelected=config.isPreviousSelected;var me=this,painters;if(isEntityContainer){painters={hover:function(){},selected:function(){},hoverSelected:function(){}};}else{ctx.clearRect(rect.x,rect.y,rect.w,rect.h);painters=getCellPainters.call(this,ctx,rect);}saveAndApplyStyle(labelDomNode&&labelDomNode.parentNode,"zIndex",3);drawHighlight(isHovered,isSelected,painters);}mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.heatmap.vi.VisHeatMapHighlightCanvas",markupString:'<div id={@id}-HeatMapHighlightCanvas style="z-index: 2; position: absolute; left: {@left}px; top: {@top}px; width: {@width}px; height: {@height}px;"><canvas width={@width} height={@height}></canvas></div>',markupSlots:{canvas:function(){return this.domNode.firstChild;}},backgroundColor:"#ffffff",init:function(props){this.isOnSelectionMode=mstrmojo.emptyFn;this.alpha=0.4;this.themeType="dark";if(this._super){this._super(props);}if(this.themeType==="dark"){this.outerBorderColor="#ffffff";this.innerBorderColor="#000000";}else{this.outerBorderColor="#000000";this.innerBorderColor="#ffffff";}this.outerBorderWidth=2;this.innerBorderWidth=1;this.maskColor="#ffffff";},preBuildRendering:function(){var domNode=this.placeholder;this.width=parseInt(domNode.style.width);this.height=parseInt(domNode.style.height);if(this._super){this._super();}},hide:function(){this.domNode.style.display="none";},show:function(){this.domNode.style.display="block";},clear:function(rect){this.show();if(!rect){rect={x:0,y:0,w:this.width,h:this.height};}var ctx=this.canvas.getContext("2d");ctx.save();ctx.clearRect(rect.x,rect.y,rect.w,rect.h);if(this.isOnSelectionMode()){ctx.fillStyle=$COLOR.getCSSColorString(this.maskColor,this.alpha);ctx.fillRect(rect.x,rect.y,rect.w,rect.h);}ctx.restore();},resetCanvasRect:function(rect){this.width=rect.w;this.height=rect.h;this.domNode.style.width=rect.w+"px";this.domNode.style.height=rect.h+"px";this.canvas.width=rect.w;this.canvas.height=rect.h;},highlight:function(rect,entity,config){config=$HASH.copy(config,{isHovered:false,isSelected:false,isEntityContainer:false,isHeaderOnTop:false});var isHeaderOnTop=config.isHeaderOnTop,isSelected=config.isSelected,isHovered=config.isHovered,isOnSelectionMode=this.isOnSelectionMode(),labelDomNode=entity.labelDomNode,ctx=this.canvas.getContext("2d");this.show();if(!isHovered&&!isSelected){restoreStyle(labelDomNode&&labelDomNode.parentNode,"zIndex");restoreStyle(labelDomNode,"textDecoration");restoreStyle(labelDomNode,"color");ctx.clearRect(rect.x,rect.y,rect.w,rect.h);if(isOnSelectionMode){this.clear(rect);}else{this.clear();}return ;}if(isHeaderOnTop){highlightHeaderOnTop.call(this,rect,entity,config);}else{highlightHeaderOnMiddle.call(this,rect,entity,config);}}});}());