(function(){mstrmojo.requiresCls("mstrmojo.vi.VisualInsightAppBase","mstrmojo.vi.factories.ModelFactory","mstrmojo.vi.controllers.RootController","mstrmojo.vi.enums.EnumHiddenSections");mstrmojo.requiresDescs(1442,13886);var $DOM=mstrmojo.dom,$HIDSEC=mstrmojo.vi.enums.EnumHiddenSections,FEATURES=mstrmojo.vi.enums.EnumFeatures;window.mstrApp=null;function getConnectivityProxy(){if(mstrApp.isSingleTier&&!(mstrApp.supportFeature(FEATURES.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode&&mstrApp.getWSLiveMode())){return new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy();}return new mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy();}mstrmojo.vi.VisualInsightApp=mstrmojo.declare(mstrmojo.vi.VisualInsightAppBase,[],{scriptClass:"mstrmojo.vi.VisualInsightApp",start:function start(docModelData){mstr_profile.log("App started");var placeholder=this.placeholder;this.hiddenSecState=this.setHiddenSections(this.hiddenSec);if(this.rootCtrl){this.destroyDisposables();delete this.rootCtrl;var body=document.body,div=document.createElement("div");div.setAttribute("id",placeholder);body.insertBefore(div,body.childNodes[0]);}this.docModelData=docModelData;var modelFactory=this.modelFactory=new mstrmojo.vi.factories.ModelFactory(),rootCtrl=this.getRootController();this.addDisposable([modelFactory,rootCtrl]);rootCtrl.start({placeholder:placeholder,data:docModelData});this.startSessionManager();$DOM.attachEvent(document,"keydown",function(e){var doPrevent=e.keyCode===8;e=e||window.event;if(doPrevent){var d=e.srcElement||e.target,tagName=d.tagName.toUpperCase(),inputType=tagName==="INPUT"&&d.type.toUpperCase();if(tagName==="TEXTAREA"||d.isContentEditable||(inputType==="TEXT"||inputType==="PASSWORD"||inputType==="NUMBER"||inputType==="FILE"||inputType==="EMAIL"||inputType==="SEARCH"||inputType==="DATE")){doPrevent=d.readOnly||d.disabled;}if(doPrevent){$DOM.preventDefault(window,e);}}if(e.keyCode===191&&e.altKey&&e.ctrlKey&&mstrmojo.resolveFeature(FEATURES.SUPPORT_NLP)){try{mstrApp.rootCtrl.docCtrl.openNLP();}catch(err){}}});},oneTierOAuthHandler:function oneTierOAuthHandler(code){var rootController=this.getRootController();var oAuthController=mstrmojo.hash.walk("CDDIcontroller.oAuthController",rootController);if(oAuthController){oAuthController.oneTierOAuthHandler(code);}},setHiddenSections:function setHiddenSections(sections){var hiddenSecLookup={docktop:$HIDSEC.DOCKTOP,path:$HIDSEC.PATH,gallery:$HIDSEC.GALLERY,datasets:$HIDSEC.DATASETS,vipane:$HIDSEC.VIPANE,editor:$HIDSEC.EDITOR,properties:$HIDSEC.PROPERTIES,filter:$HIDSEC.FILTER,tov:$HIDSEC.TOV};var result=0;if(sections){sections=sections.toLowerCase();mstrmojo.hash.forEach(hiddenSecLookup,function(value,key){if(sections.indexOf(key)>-1){result+=value;}});}return result;},isSectionHidden:function isSectionHidden(section){return this.hiddenSecState&&(this.hiddenSecState&section)===section;},getRootController:function getRootController(){return(this.rootCtrl=this.rootCtrl||new mstrmojo.vi.controllers.RootController());},showLinkedNotification:function showLinkedNotification(message,fnHandler,callback){var notify=mstrmojo.notify(message.replace(/\{/g,'<span class="dyn-link">').replace(/}/g,"</span>"),{allowHTML:true},{forceClose:true,buttonText:mstrmojo.desc(1442,"Ok"),callback:callback||mstrmojo.emptyFn});Array.prototype.slice.call(notify.domNode.getElementsByTagName("span")).forEach(function(span,idx){$DOM.attachOneTimeEvent(span,"click",function(idx){fnHandler(idx);notify.destroy();}.bind(span,idx));});},showHelpMenuNotification:function showHelpMenuNotification(callback){mstrApp.showLinkedNotification(mstrmojo.desc(13886,"Access {Getting Started} and {Quick Tips} from the Help menu."),function(idx){var rootCtrl=mstrApp.rootCtrl;if(!idx){if(mstrApp.isSingleTier){window.FormWrapper.showWelcomeScreen();}else{rootCtrl.showWelcome();}}else{rootCtrl.showTutorial();}},callback);},togglePanel:function togglePanel(menuItemId){this.rootCtrl.togglePanel(menuItemId);},onNavigateOut:function onNavigateOut(item,execFn){var pathInfo=this.pathInfo,navigationButtons=pathInfo&&pathInfo.nb,backButton=navigationButtons&&navigationButtons[1],backHistoryItems=backButton&&backButton.items,historyItem=backHistoryItems[1],docCtrl=this.rootCtrl.docCtrl;item=item||historyItem;var href=item&&item.href;if(docCtrl&&docCtrl.saveBeforeClosing){docCtrl.saveBeforeClosing({success:execFn},href);return true;}else{return false;}},toggleNGM:function toggleNGM(val){getConnectivityProxy().savePreferences({feature_flag:{NGMTypeFlag:val}});this.updateFeatureFlag({feature_flag:{NGMTypeFlag:val}},function(){this.rootCtrl.galleryPanel.update();}.bind(this));}});mstrmojo.vi.VisualInsightApp.APP_STATES=mstrmojo.vi.VisualInsightAppBase.APP_STATES;mstrmojo.vi.VisualInsightApp.LAYOUT_MODES=mstrmojo.vi.VisualInsightAppBase.LAYOUT_MODES;}());