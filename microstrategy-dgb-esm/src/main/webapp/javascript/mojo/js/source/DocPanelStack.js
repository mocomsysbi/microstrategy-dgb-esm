(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._Formattable","mstrmojo.DocSelector","mstrmojo._IsSelectorTarget","mstrmojo.Serializer","mstrmojo._IsPanelStack","mstrmojo._HasBuilder","mstrmojo.array","mstrmojo.css","mstrmojo.hash");var $ARR=mstrmojo.array;function updateSelectedIndex(ps,dir){var idx=$ARR.find(ps.node.data.panels,"k",ps.selectedKey);idx+=(dir||0);ps.set("selectedIdx",idx);}function updatePSNavigationProps(ps){ps.set("hasNextPanel",(ps.selectedIdx<(ps.node.data.panels.length-1)));ps.set("hasPreviousPanel",(ps.selectedIdx>0));}mstrmojo.DocPanelStack=mstrmojo.declare(mstrmojo.Container,[mstrmojo._Formattable,mstrmojo._IsSelectorTarget,mstrmojo._HasBuilder,mstrmojo._IsPanelStack],{scriptClass:"mstrmojo.DocPanelStack",markupString:'<div id="{@id}" k="{@k}" title="{@tooltip}" nm="{@n}" class="mstrmojo-DocPanelStack {@cssClass}" style="{@domNodeCssText}"><div></div></div>',markupSlots:{containerNode:function(){return this.domNode.firstChild;}},formatHandlers:{domNode:["RW","B","overflow"]},model:null,hasNextPanel:false,hasPreviousPanel:false,applyEnabled:false,clearEnabled:true,renderMode:"onshow",n:"",node:null,selectedIdx:undefined,selectedKey:"",init:function init(props){this._super(props);updateSelectedIndex(this);this.node.sw=(this.node.data.panels.length>1&&this.defn.sw);this.n=props.node.defn.n;},onselectedKeyChange:function onselKeyChg(evt){var panelInfo=this._super(evt),on=panelInfo.on;if(on._delayRefresh){if(!on.defn.dirtyKeys){on.refresh();}delete on._delayRefresh;}updateSelectedIndex(this);},updateSelectedIdx:function updateSelected(dir){updateSelectedIndex(this,dir);},onselectedIdxChange:function onselectedIdxChange(){updatePSNavigationProps(this);},_bufferedSlices:null,canApply:function canApply(){var i,j,pal,s;for(i in this.children){pal=this.children[i];if(!pal.children){continue;}for(j in pal.children){s=pal.children[j];if(s.defn&&s.defn.ttl!==undefined){s=s.children[1];}if(s&&s.canApply&&!s.canApply()){return false;}}}return true;},bufferSlice:function bufferSlice(rEvt){var bs=this._bufferedSlices=this._bufferedSlices||[];bs.push(rEvt);this.set("applyEnabled",this.canApply());},applyBufferedSlices:function applyBufferedSlices(){var bufferedSlices=this._bufferedSlices;if(!bufferedSlices){return ;}var concatenateKeys=function(slices){var tks=[],keys,delimiter=String.fromCharCode(30);mstrmojo.hash.forEach(slices,function(slice){keys=slice.tks;if(keys){var keyArray=$ARR.isArray(keys)?keys:keys.split(delimiter);tks=tks.concat(keyArray);}});return tks;};var getIsUConDS=function(slices){var isUConDS=false;for(var i=0;i<slices.length;i++){if(slices[i].isUConDS){isUConDS=true;break;}}return isUConDS;};this.model.slice({bufferedSlices:true,tks:concatenateKeys(bufferedSlices),events:bufferedSlices,isUConDS:getIsUConDS(bufferedSlices)});this.clearBuffSlices();},clearBuffSlices:function(){this._bufferedSlices=null;this.set("applyEnabled",false);},_isFPS:function _isFPS(){return !!this.defn.ifp;},clearAllFilter:function clearAllFilter(){var $STYLES=mstrmojo.DocSelector.STYLES,fps=this;if(!fps._isFPS()){return ;}if(!(fps.children&&fps.children.length)){return ;}var i,j,pal,s,evt,cnt,len;for(i in fps.children){pal=fps.children[i];if(!pal.children){continue;}for(j in pal.children){s=pal.children[j];if(s.defn.ttl!=="undefined"){s=s.children[1];}if(s.model){evt={tks:s.tks,ck:s.ck,ckey:s.ckey,unset:true};fps.bufferSlice(evt);var defn=s.node.defn,data=s.node.data;var allElem=$ARR.filterOne(data.elms,function(e){return e.t===14;});if(defn.showall&&allElem){data.ces=[allElem];defn.cek=[allElem.v];}else{data.ces=[];defn.cek=null;}data.unset=true;data.cs=[];cnt=s.content;if(parseInt(defn.style,10)===$STYLES.SCROLLER){cnt.min=0;len=cnt.items&&cnt.items.length;cnt.max=len?len-1:0;}s.update(s.node);s.refresh();}}}},update:function(node){if(this._super){this._super(node);}var selKey=node.data&&node.data.selKey;if(selKey&&selKey!==this.selectedKey){this.defn.newSelKey=selKey;}var getPanelsCount=function(node){return node.data&&node.data.panels&&node.data.panels.length;};if(this.children&&(this.children.length!==getPanelsCount(node))){this.rebuildPanels();}},rebuildPanels:function(){this.destroyChildren(false);this.buildChildren(false);},postBuildRendering:function(){this._super();if(this.defn.itb){mstrmojo.css.addClass(this.domNode,"tableControl");}}});}());