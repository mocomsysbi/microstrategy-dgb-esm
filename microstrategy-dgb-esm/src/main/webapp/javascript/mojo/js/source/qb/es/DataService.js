(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.hash","mstrmojo.DI.DIDataService");mstrmojo.requiresDescs(889,13196);var $H=mstrmojo.hash,$DESC=mstrmojo.desc;var WAIT_MSG=$DESC(889,"Please wait...");function submitServerRequest(callback,params,waitBoxCfg){var showWait=params.showWait,suppressErrorMsg=params.suppressError,waitMsg=params.waitMsg,msgid=params.msgid,alertCfg=params.alertCfg;delete params.showWait;delete params.suppressError;delete params.waitMsg;delete params.msgid;delete params.alertCfg;mstrApp.serverRequest(params,callback,showWait,suppressErrorMsg,waitMsg,msgid,alertCfg,waitBoxCfg);}mstrmojo.qb.es.DataService=mstrmojo.provide("mstrmojo.qb.es.DataService",{emmaIRRMessageID:null,submitRequest:function submitRequest(callback,params){submitServerRequest.call(this,callback,params);},setDBRole:function setDBRole(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.SetDBRole",showWait:true}));},signOutOAuthSource:function signOutOAuthSource(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.FetchSourceObjects",flags:8,showWait:true,waitMsg:$DESC(12369,"Signing out...")}));},pollingStatus:function pollingStatus(callback,result,message,waitBoxCfg){var me=this;if(mstrApp.isSingleTier){if(callback.success){callback.success(result);}return ;}submitServerRequest.call(me,{success:function success(res){if(res.status==="1"){if(callback.success){callback.success(result);}}else{me.pollingStatus(callback,result,message);}},failure:function failure(res){if(callback.failure){callback.failure(res);}},canceled:function canceled(reqId){if(callback.canceled){callback.canceled(reqId,result);}}},{taskId:"pollStatus",resultSetType:3,pollingFrequency:500,maxWait:60000,taskEnv:"xhr",taskContentType:"json",showWait:true,waitMsg:message},waitBoxCfg);},taskByPollStatus:function taskByPollStatus(callback,result,message,waitBoxCfg,cfg,pollStatusTask){var me=this,pollStatus="pollStatus";if(mstrApp.isSingleTier){pollStatus=pollStatusTask||"DIPollStatus";}submitServerRequest.call(me,mstrmojo.DI.DIDataService.taskByPollStatusCb.call(me,callback,result,message,waitBoxCfg,cfg,pollStatusTask),{taskId:pollStatus,resultSetType:3,threadId:result.tid,maxWait:60000,taskEnv:"xhr",taskContentType:"json",isAsync:true,},waitBoxCfg);},createEmmaTables:function createEmmaTables(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.CreateEmmaTables",showWait:true,waitMsg:WAIT_MSG}));},createEmmaInstance:function createEmmaInstance(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DICreateEMMAReportInstance",showWait:true,waitMsg:WAIT_MSG}));},removeEMMATable:function removeEmmaTable(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DIRemoveEMMASourceTable",showWait:true,waitMsg:WAIT_MSG}));},changePartition:function changePartition(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"DIChangePartition",showWait:true,waitMsg:WAIT_MSG}));},editEmmaIRRSourceTable:function editEmmaIRRSourceTable(callback,params){var me=this,emmaIRRCallback;emmaIRRCallback={success:function success(res){me.emmaIRRMessageID=res.msgid;}};submitServerRequest.call(me,mstrmojo.func.wrapMethods(emmaIRRCallback,callback),$H.copy(params,{taskId:"DIEditEmmaIRRSourceTable",msgid:me.emmaIRRMessageID,showWait:true}));},search:function search(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"arch.search",showWait:true}));},searchFolderContents:function searchFolderContents(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"searchMetadata",styleName:"MojoFolderStyle",includeAncestorInfo:false,includeObjectDesc:false,fields:"name",recursive:0}),{showProgress:true,showProgressText:true,progressText:WAIT_MSG});},validateEmmaIRRAlternateSource:function validateEmmaIRRAlternateSource(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"DIValidateEmmaIRRAlternateSource",msgid:this.emmaIRRMessageID,showWait:true}));},clearDataCache:function clearDataCache(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"DIClearDataCache",}));},catalogActionForLocalDossier:function catalogActionForLocalDossier(callback,params,cancelEvent){var me=this;submitServerRequest.call(me,{success:function success(res){me.cancelEvt&&mstrApp.getRootController().model.detachEventListener(me.cancelEvt);me.cancelEvt=mstrApp.getRootController().model.attachEventListener(cancelEvent,this.id,function(){me.isPolling=false;callback.canceled(res);});me.isPolling=true;me.taskByPollStatus(callback,res,null,{silent:true},null,"arch.PollStatusCatalogAction");},failure:function failure(res){mstrmojo.alert("arch.catalogAction : Get thread Id failed.");},canceled:function(reqId){if(callback.canceled){callback.canceled(reqId);}}},$H.copy(params,{taskId:"arch.catalogAction",showWait:false,}));},prepareData:function prepareData(callback,params,current,total,msg,isEditTableMode){var waitMsg=msg||$DESC(13196,"Prepare data ## of ### tables...").replace("##",current).replace("###",total);var me=this,waitBoxCfg={showCancel:isEditTableMode?false:true};submitServerRequest.call(me,{success:function success(res){mstrApp.showWait(waitBoxCfg);me.taskByPollStatus(callback,res,waitMsg,{silent:true},{hideCancel:isEditTableMode});},canceled:function(reqId){if(callback.canceled){callback.canceled(reqId);}}},$H.copy(params,{taskId:"DIDataPreparation",showWait:true,waitMsg:waitMsg}),waitBoxCfg);},catalogAction:function catalogAction(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"arch.catalogAction",showWait:true}));},autoMap:function autoMap(callback,params){var me=this;submitServerRequest.call(me,{success:function success(res){mstrApp.msgid=res.msgid;me.pollingStatus(callback,res,WAIT_MSG);}},$H.copy(params,{taskId:"qBuilder.AutoMapTables",showWait:true,waitMsg:WAIT_MSG}));},killJob:function killJob(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"DIKillJob",showWait:true,suppressError:true,waitMsg:WAIT_MSG}));},getObjectInfo:function getObjectInfo(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"getObjectInfo"}),{showProgress:true,showProgressText:true,progressText:WAIT_MSG});},removeOrDuplicateRI:function removeOrDuplicateRI(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.RemoveOrDuplicateRI",showWait:true}));},getSingleDBRole:function getObjectDetails(callback,params){submitServerRequest.call(this,callback,$H.copy(params,{taskId:"qBuilder.GetSingleDBRole"}),{showProgress:true,showProgressText:true,progressText:WAIT_MSG});}});}());