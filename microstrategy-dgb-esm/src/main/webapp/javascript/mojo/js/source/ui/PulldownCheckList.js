(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.dom","mstrmojo.expr","mstrmojo.Button","mstrmojo.ui._HasListTooltip","mstrmojo.ui.PopupWidget","mstrmojo.ui.Pulldown","mstrmojo.ui.CheckList");var $H=mstrmojo.hash,$ARR=mstrmojo.array,$DOM=mstrmojo.dom,$NWB=mstrmojo.Button.newWebButton,TYPE_ALL=mstrmojo.expr.TP.DIM;function handleChecklistButtons(isOk){var pulldown=this.parent,listWidget=this.list;if(isOk){this.saveSelection();pulldown.submitSelections();}else{listWidget.selectedIndices=$H.copy(pulldown.selectedIndices);}this.close();}mstrmojo.ui.PulldownCheckList=mstrmojo.declare(mstrmojo.ui.PopupWidget,[mstrmojo.ui._HasListTooltip],{scriptClass:"mstrmojo.ui.PulldownCheckList",visible:false,itemCssText:"",onOpen:function onOpen(){var listWidget=this.list;listWidget.updateScrollbars();},onClose:function onClose(){this.list.refresh();},adjustCheckListForPopupOverflow:function adjustCheckListForPopupOverflow(adjusted){var domNode=this.domNode,curPos,curY,list=this.list,scrollNode=list&&(list.scrollNode||list.scrollboxNode);if(adjusted&&scrollNode){curPos=$DOM.position(domNode);curY=curPos.y;if(curY+curPos.h>$DOM.position(document.body).h){var domNodeHeight=domNode.offsetHeight,scrollNodeHeight=scrollNode&&scrollNode.offsetHeight;scrollNode.style.maxHeight=$DOM.getMaxScrollHeight()-(domNodeHeight-scrollNodeHeight)+"px";list.updateScrollbars();}}},getItemFromTarget:function getItemFromTarget(target){return this.list.getItemFromTarget(target);},getItemNodeFromTarget:function getItemNodeFromTarget(target){return this.list.getItemNodeFromTarget(target);},adjustCornersForPopupOverflow:function adjustCornersForPopupOverflow(){var adjusted=this._super();this.adjustCheckListForPopupOverflow(adjusted);return adjusted;},saveSelection:function saveSelection(){this.parent.set("selectedIndices",$H.copy(this.list.selectedIndices));},postselectionChange:function postselectionChange(evt){var listWidget=this.list,items=listWidget.items,added=evt.added||[],removed=evt.removed||[],selectedIndices=listWidget.selectedIndices,allIdx=this.parent.allIdx,allItem=items[allIdx],length=added.length+removed.length,hasChanged=false;if(allItem&&allItem.t===TYPE_ALL&&length===1){if(allIdx===added[0]){items.forEach(function(item,index){if(!selectedIndices[index]){hasChanged=true;selectedIndices[index]=$ARR.indexOf(removed,index)===-1;}});}else{if(allIdx===removed[0]){selectedIndices={};$ARR.forEach(added,function(ind){selectedIndices[ind]=true;});hasChanged=true;}else{if(selectedIndices[allIdx]){delete selectedIndices[allIdx];hasChanged=true;}}}}if(hasChanged){listWidget.set("selectedIndices",$H.copy(selectedIndices));listWidget.refresh();}},onitemsChange:mstrmojo.emptyFn,children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"list",postBuildRendering:function postBuildRendering(){this.icnCssText=this.parent.itemCssText||this.icnCssText;this.parent.adjustCheckListForPopupOverflow();},postselectionChange:function postselectionChange(evt){this.parent.postselectionChange(evt);},onitemsChange:function onitemsChange(evt){this.parent.onitemsChange(evt);}},{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-Buttons",children:[$NWB(mstrmojo.desc(1442,"Ok"),function(){handleChecklistButtons.call(this.parent.parent,true);},true,{cssDisplay:"inline-block"}),$NWB(mstrmojo.desc(2140,"Cancel"),function(){handleChecklistButtons.call(this.parent.parent,false);},false,{cssDisplay:"inline-block"})]}]});}());