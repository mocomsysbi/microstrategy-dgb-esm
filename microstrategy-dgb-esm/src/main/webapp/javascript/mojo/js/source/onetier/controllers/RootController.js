(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo.mstr.EnumWebAPIErrorCodes","mstrmojo.vi.controllers.RootController","mstrmojo.onetier.vi.prefs.OneTierPalettesEditor","mstrmojo.onetier.vi.prefs.PreferencesEditor","mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy","mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy","mstrmojo.onetier.vi.ui.LoginToProjectBox","mstrmojo.onetier.vi.ui.ObjectBrowserDataProvider","mstrmojo.onetier.vi.ui.OpenFromServerBrowser","mstrmojo.onetier.vi.ui.SaveToCloud","mstrmojo.onetier.vi.ui.SaveToServerBrowser","mstrmojo.onetier.vi.ui.CubeBrowser","mstrmojo.onetier.vi.ui.LoginBox","mstrmojo.vi.ui.editors.ExportPDFEditor","mstrmojo.vi.controllers.EnumEvents");mstrmojo.requiresDescs(1442,2399,8966,13811,14012,14014,14298,14299,14300,14491,14492,15201,2816,2903,4998,4737,949,950,2295,952,4738,6114,4739,953,4740,954,955,6047,1035,1375,956,212,15127,15238,15537,15240,15241,15242,15538,15433,11787,11788,15287,15922,15923);var $DOM=mstrmojo.dom,$ERROR=mstrmojo.onetier.vi.prefs.handleErrorMessage,$ENUM_EVENTS=mstrmojo.vi.controllers.EnumEvents,_forceShutDown;var LOCALE_OPTIONS={2052:mstrmojo.desc(2816,"Chinese (Simplified)"),1028:mstrmojo.desc(2903,"Chinese (Traditional)"),1030:mstrmojo.desc(4998,"Danish"),1043:mstrmojo.desc(4737,"Dutch (Netherlands)"),1031:mstrmojo.desc(949,"German"),1033:mstrmojo.desc(950,"English (US)"),2057:mstrmojo.desc(2295,"English (UK)"),1036:mstrmojo.desc(952,"French"),4108:mstrmojo.desc(4738,"French (Switzerland)"),2060:mstrmojo.desc(6114,"French (Belgium)"),2055:mstrmojo.desc(4739,"German (Switzerland)"),1040:mstrmojo.desc(953,"Italian"),2064:mstrmojo.desc(4740,"Italian (Switzerland)"),1041:mstrmojo.desc(954,"Japanese"),1042:mstrmojo.desc(955,"Korean"),1045:mstrmojo.desc(6047,"Polish"),1046:mstrmojo.desc(1035,"Portugese (Brasil)"),3082:mstrmojo.desc(1375,"Spanish"),1053:mstrmojo.desc(956,"Swedish")};function getConnectivityProxy(){return mstrApp.isSingleTier?new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy():new mstrmojo.onetier.vi.prefs.HostedDesktopConnectivityProxy();}mstrmojo.onetier.controllers.RootController=mstrmojo.declare(mstrmojo.vi.controllers.RootController,null,{scriptClass:"mstrmojo.onetier.controllers.RootController",dataProvider:null,init:function init(props){this._super(props);if(mstrApp.attachEventListener){mstrApp.attachEventListener("isWSLiveModeChange",this.id,"onIsWSLiveModeChange");}},handleFirstTimeUserHelp:function handleFirstTimeUserHelp(data){var dataSets=data.datasets;if(window.FormWrapper.getShowVITutorial()&&!mstrApp.tutorialShown&&(!dataSets||!Object.keys(dataSets).length)){this.showTutorial({cls:"initial"});mstrApp.tutorialShown=true;}else{this.hideTutorial();}},showNotification:function showNotification(config){mstrApp.hideWait(true);mstrmojo.alert(config.msg,function(){if(config.taskId){mstrApp.serverRequest({taskId:config.taskId},null,{doNotHold:true});}},mstrmojo.desc(11812,"Notification"));},loadDataAndStartController:function loadDataAndStartController(startParams){if(mstrConfig.messageBundle){mstrmojo.locales.update(mstrConfig.messageBundle.localeInfo);}var data=startParams&&startParams.data;if(data){mstrApp.hideWait();if(data.showWait){var messageType=data.msgTp,waitConfig;if(messageType){waitConfig={message:{dda:mstrmojo.desc(14014,"Connecting to data source. Please wait...")}[messageType]};}mstrApp.showWait(waitConfig);}else{var fnOnDataReady=function(){mstrApp.setupCustomVisualizations(mstrConfig.pluginNames,mstrApp.isVisBuilderApp);this.startControllerOnDataReady(startParams);["dragover","drop"].forEach(function(evtName){$DOM.attachEvent(window,evtName,function(e){e=e||event;e.preventDefault();});});}.bind(this);mstrApp.getDossierCustomVisList({success:fnOnDataReady});}}},unpublishedCubeChange:function unpublishedCubeChange(evt){this._super(evt);if(window.FormWrapper.setHasUnpublishedCube){window.FormWrapper.setHasUnpublishedCube(evt.hasUnpublishedCube);}},refreshVizGallery:function refreshVizGallery(isOnVizDeletion){this.galleryPanel.update(isOnVizDeletion);},showLocaleResolutionDialog:function showLocaleResolutionDialog(data){var errorMsg,title,readMoreHtml='<div class="locale-resolute-help" >'+mstrmojo.desc(15237,"Read more...")+"</div>",connectivityProxy=getConnectivityProxy(),openHelpUrl=function openHelpUrl(){mstrApp.showHelpTopic("using_mstr_files_from_different_locales.htm");},editor,getHandler=function getHandler(locale){return function(){connectivityProxy.resumeDashboardExecution({resolvedLocale:locale,notShowAgain:editor.chk.checked,callback:data.callback});editor.close();};},desktopLocale,mstrLocale;data=data||{};desktopLocale=data.desktopLocale;mstrLocale=data.mstrLocale;if(mstrApp.isWorkstation){title=mstrmojo.desc(15238,"Dossier published on a different locale");errorMsg=mstrmojo.desc(15242,"This Dossier contains a Cube(s) originally published in ## locale, whereas this Workstation is configured to use ###. If the Dossier uses functions that depend on the sorting locale, such as RunningSum or MovingAvg, you may want to use the original Cube's sorting locale to avoid discrepancies in the results.");}else{title=mstrmojo.desc(15537,"Dossier published on a different locale");errorMsg=mstrmojo.desc(15538,"This Dossier contains a Cube(s) originally published in ## locale, whereas this Desktop is configured to use ###. If the Dossier uses functions that depend on the sorting locale, such as RunningSum or MovingAvg, you may want to use the original Cube's sorting locale to avoid discrepancies in the results.");}errorMsg=errorMsg.replace("###",LOCALE_OPTIONS[desktopLocale]||desktopLocale).replace("##",LOCALE_OPTIONS[mstrLocale]||mstrLocale);editor=new mstrmojo.Editor({title:title,cssClass:"mstrmojo-locale-resolute",buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(15241,"Use Cube Locale"),getHandler(mstrLocale),false),mstrmojo.Button.newWebButton(mstrmojo.desc(212,"Continue"),getHandler(desktopLocale),true)],children:[{scriptClass:"mstrmojo.Label",alias:"errDisplay",cssClass:"locale-resolute-error",text:errorMsg+readMoreHtml,allowHTML:true},{scriptClass:"mstrmojo.CheckBox",cssClass:"locale-resolute-chk",alias:"chk",label:mstrmojo.desc(15240,"Remember my preference")}]});editor.open();$DOM.attachEvent(editor.errDisplay.domNode.children[0],"click",openHelpUrl);},showAEOutDatedDialog:function showAEOutDatedDialog(data){var errorMsg=mstrmojo.desc(15957,"This dossier was created in an application whose data engine version is no longer supported. The latest data engine behavior supported by this # version will be applied.").replace("#",window.FormWrapper.isDesktop()?mstrmojo.desc(619,"Desktop"):mstrmojo.desc(15963,"Workstation")),title=mstrmojo.desc(15958,"Data Engine Version is Outdated"),readMoreHtml='<div class="locale-resolute-help" >'+mstrmojo.desc(9849,"Learn More")+"</div>",connectivityProxy=getConnectivityProxy(),openHelpUrl=function openHelpUrl(){mstrApp.showHelpTopic("using_mstr_files_from_different_locales.htm");},editor,aeVersion;data=data||{};aeVersion=data.aevTarget||11.1;editor=new mstrmojo.Editor({title:title,cssClass:"mstrmojo-locale-resolute aeversionEditor",buttons:[mstrmojo.Button.newWebButton(mstrmojo.desc(15959,"Apply and Run Dossier"),function(){connectivityProxy.resumeDashboardExecution({AEVersion:aeVersion,callback:data.callback});editor.close();},true),mstrmojo.Button.newWebButton(mstrmojo.desc(15960,"Close Dossier"),function(){editor.close();window.FormWrapper.closeWindow("{}");},false)],children:[{scriptClass:"mstrmojo.Label",cssClass:"locale-resolute-error",text:errorMsg+readMoreHtml,alias:"errDisplay",allowHTML:true}],onClose:function onClose(){$DOM.detachEvent(this.errDisplay.domNode.children[0],"click",openHelpUrl);},onOpen:function onOpen(){$DOM.attachEvent(this.errDisplay.domNode.children[0],"click",openHelpUrl);}});editor.open();},showExportOptionEditor:function showExportOptionEditor(data,extras){var exportHandler=function exportHandler(opts){window.FormWrapper.setPDFExportOptions(JSON.stringify(opts));};var params={exOpts:data,exportHandler:exportHandler};if(extras){params=mstrmojo.hash.copy(extras,params);}var editor=new mstrmojo.vi.ui.editors.ExportPDFEditor(params);editor.open();},showExportOptionEditorFromSingleVI:function showExportOptionEditorSingleVI(data){var defaults=data||mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings,extras={singleVis:true};this.showExportOptionEditor(defaults,extras);},showPrefsEditor:function showPrefsEditor(preferencesData){var connectivityProxy=getConnectivityProxy(),controller=this,openPrefsEditor=function openPrefsEditor(data){var editor=new mstrmojo.onetier.vi.prefs.PreferencesEditor({data:data,connectivityProxy:connectivityProxy});if(preferencesData&&preferencesData.inputConnectionDetails){editor.onClose=function(){controller.docCtrl.inputConnectionDetails();};}else{if(preferencesData&&preferencesData.browseAllObjects){editor.onClose=function(){controller.docCtrl.browseObjectsOnServer();};}else{if(preferencesData&&preferencesData.uploadDashboard){editor.onClose=function(){controller.openSaveToServerBrowser();};}else{if(preferencesData&&preferencesData.downloadDashboard){editor.onClose=function(){controller.openFromProjectBrowser();};}else{if(preferencesData&&preferencesData.addDataset){editor.onClose=function(){controller.openCubeBrowser();};}}}}}editor.open();};if(!preferencesData){connectivityProxy.getSavedPreferences({success:function success(res){openPrefsEditor(res);}.bind(this)});}else{openPrefsEditor(preferencesData);}},showColorPalettesEditor:function showColorPalettesEditor(colorPalettesData){(new mstrmojo.onetier.vi.prefs.OneTierPalettesEditor({title:mstrmojo.desc(15286,"Color Palettes"),serverRequest:function(params,callback,config){mstrApp.serverRequest(params,callback,config);},paletteThemesData:colorPalettesData,selectedPaletteId:this.docCtrl.model.getCurrentPaletteId(),currentDefaultPtid:this.docCtrl.model.getCurrentDefaultPaletteId()})).open();},showOrHideProgressBar:function showOrHideProgressBar(title,show){var viProgressBarID="viProgBar",viProgressBarConfig={scriptClass:"mstrmojo.Editor",id:viProgressBarID,draggable:false,showTitle:true,zIndex:99999,cssClass:"viProgressBarDialog",children:[{scriptClass:"mstrmojo.ProgressBar",markupString:'<div id="{@id}" class="mstrmojo-ProgressBar {@cssClass}" style="{@cssText}"><div class="percentage">{@pctText}</div><div class="bar"><div class="indicator"></div></div><div class="text">{@progressText}</div></div>',markupSlots:{progressNode:function(){return this.domNode.firstChild;},barNode:function(){return this.domNode.children[1];},textNode:function(){return this.domNode.lastChild;}},updateProgress:function updateProgress(ptg,text){var percentage=Math.min(100,Math.max(0,parseInt(ptg,10)));if(this.hasRendered){this.barNode.firstChild.style.width=percentage+"%";if(text!==undefined){this.set("progressText",text);}this.progressNode.innerHTML=percentage+"% complete";}},alias:"progress"},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBar",alias:"buttonBar",slot:"buttonNode",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-WebButton",alias:"cancel",text:mstrmojo.desc(2399,"Cancel"),onclick:function(){var connectivityProxy=getConnectivityProxy(),editor=this.parent.parent;connectivityProxy.cancelRequest(editor.requestID,{success:function success(res){if(!res.isCancelled){mstrmojo.alert(mstrmojo.desc(14300,"You cannot cancel now."),null,"",editor.zIndex+1);}}});}}]}]},viProgressBarDialog=mstrmojo.all[viProgressBarID]||mstrmojo.insert(viProgressBarConfig);if(show){viProgressBarDialog.set("title",title);viProgressBarDialog.open();viProgressBarDialog.progress.updateProgress(0,"");}else{viProgressBarDialog.close();}},setEditMode:function setEditMode(mode){mstrApp.set("isWSLiveMode",parseInt(mode,10)===1);mstrApp.DSFeature=window.FormWrapper.getFeatures();var FEATURE_MAPPING={"DocServices/GUIDAsNodeIdentifier":"guid-as-node-identifier","acg/write":"user-can-write"};mstrApp.DSFeature.split(";").forEach(function(item){var pair=item.split(":");mstrApp.features[FEATURE_MAPPING[pair[0]]]=pair[1].toLowerCase()==="true";});this.generateToolbar();},onIsWSLiveModeChange:function onIsWSLiveModeChange(){mstrApp.resetCustomVisGallery();var dossierServerURL=FormWrapper.getDossierServerURL();mstrApp.dossierServerBaseUrl=dossierServerURL+(dossierServerURL&&dossierServerURL.slice(-1)!=="/"?"/":"");mstrApp.getDossierCustomVisList({success:function(){mstrApp.rootCtrl.refreshVizGallery();}});},updateProgressBar:function updateProgressBar(data){var viProgressBarID="viProgBar",viProgressBarDialog=mstrmojo.all[viProgressBarID];if(viProgressBarDialog===undefined){return ;}viProgressBarDialog.requestID=data.requestID;viProgressBarDialog.progress.updateProgress(data.pct,data.msg);viProgressBarDialog.buttonBar.cancel.set("enabled",data.canCancel);},shutDownDesktop:function shutDownDesktop(){var connectivityProxy=getConnectivityProxy(),position,waitBoxID="ShutDownWait",waitBox=mstrmojo.all[waitBoxID]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:waitBoxID,cssClass:"mstrWaitBox",draggable:false,showTitle:false,zIndex:1000000,position:null,children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",text:mstrmojo.desc(14491,"Shutting down...")},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",text:mstrmojo.desc(14492,"Force Quit"),onclick:function onclick(){_forceShutDown=true;}}]});if(!waitBox.visible){waitBox.open();}mstrmojo.dom.center(waitBox.editorNode);position=mstrApp.getWaitBoxPosition();if(position){var top=position.top,left=position.left;if(top!==undefined){waitBox.set("top",top+"px");}if(left!==undefined){waitBox.set("left",left+"px");}}connectivityProxy.shutDownDesktop({success:function success(res){if(res.close){waitBox.close();}}},_forceShutDown);},confirmLogout:function confirmLogout(){var controller=this;this.datasetsPanel.onLogout();mstrmojo.confirm(mstrmojo.desc(14298,"You have successfully logged out."),{confirmBtn:{t:mstrmojo.desc(1442,"OK")},cancelBtn:{t:mstrmojo.desc(14299,"Login Again"),fn:function(){if(this.text===mstrmojo.desc(14299,"Login Again")){controller.openFromProjectBrowser();}}}});},loginToWebserver:function loginToWebserver(params){var connectivityProxy=getConnectivityProxy();var postAuthFunction=mstrmojo.emptyFn;var controller=this;if(params.recoveryIndex!==undefined){mstrApp.recoveryIndex=params.recoveryIndex;}if(params.resumeDashboardExec){postAuthFunction=connectivityProxy.resumeDashboardExecution;}connectivityProxy.httpStatusCodeHandler(params.code,postAuthFunction,{loginTitle:mstrmojo.desc(14011,"Web Server: ##").replace("##",params.wsn),authenticateCredentials:function authenticateCredentials(userName,password){connectivityProxy.loginToWebserver(params.wsn,userName,password,{success:function(res){if(params.recoveryIndex!==undefined){res.resumeDashboardExec=true;}controller.loginToWebserver(res);}});}});},loginToProxy:function loginToProxy(params){var connectivityProxy=getConnectivityProxy();if(params.recoveryIndex!==undefined){mstrApp.recoveryIndex=params.recoveryIndex;}var proxyUrl=params.proxyUrl;connectivityProxy.httpStatusCodeHandler(params.code,mstrmojo.emptyFn,{saveToPrefs:true,loginTitle:mstrmojo.desc(14012,"Proxy authentication required: ##").replace("##",proxyUrl),authenticateCredentials:function authenticateCredentials(userName,password){connectivityProxy.loginToProxy(params.proxyUrl,userName,password,this.saveToPrefs,{success:this.loginToProxy.bind(this)});}.bind(this)});},loginToProject:function loginToProject(webServers){var webserverCntr=0,connectivityProxy=getConnectivityProxy(),items,index;if(webServers[0].recoveryIndex!==undefined){mstrApp.recoveryIndex=webServers[0].recoveryIndex;}function handleWebserverLoop(){if(webserverCntr<webServers.length){var webServer=webServers[webserverCntr++],defaultLoginInfo=webServer.loginInfo,connectionId=webServer.connectionId,iServers=[],iServerCntr=0,showLoginDialog=function showLoginDialog(){if(webServer.loginRequired){var l=connectivityProxy.parseServerURL(webServer.ws),hostName=l.wsn+":"+l.wsport;mstrmojo.onetier.vi.ui.LoginBox.openDialog(mstrmojo.desc(14013,"Login to server ##").replace("##",hostName),{webServer:{connection:{id:connectionId||"-1"},loginInfo:defaultLoginInfo,loginFirst:true,url:webServer.ws}},connectivityProxy,{success:function success(sessionState,authMode){connectivityProxy.login({connectionId:connectionId,server:webServer.server,project:webServer.project,port:webServer.port,webServerURL:webServer.ws,lfs:sessionState,authMode:authMode||webServer.loginInfo.defaultAuthMode},{success:function(){handleWebserverLoop();},failure:function(res){if(res.taskErrorCode===mstrmojo.mstr.EnumWebAPIErrorCodes.MSI_SERVER_NOT_FOUND){handleWebserverLoop();}else{$ERROR(res);}}});}});}else{if(iServerCntr<iServers.length){var iServer=iServers[iServerCntr++],projects=iServer.projects;projects.forEach(function(projectInfo){var iServerName=projectInfo.iServer.clusterName;mstrmojo.onetier.vi.ui.LoginBox.openDialog(mstrmojo.desc(14013,"Login to server ##").replace("##",iServerName+" - "+projectInfo.name),{webServer:{connection:{id:connectionId||"-1"},loginInfo:defaultLoginInfo},iServer:projectInfo.iServer,project:projectInfo},connectivityProxy,{success:function success(){showLoginDialog();}});});}else{handleWebserverLoop();}}};mstrmojo.array.forEach(webServer.clusters,function(cluster){items=[];cluster.forEach(function(iServer){(iServer.projects||[]).forEach(function(project){index=mstrmojo.array.find(items,"name",project.name);if(index<0){iServer.clusterName=iServer.name;project.iServer=iServer;items.push(project);}else{items[index].iServer.clusterName=items[index].iServer.clusterName+"/"+iServer.name;}});});iServers.push({projects:items});});showLoginDialog();}else{connectivityProxy.resumeDashboardExecution();}}handleWebserverLoop();},openSaveToServerBrowser:function openSaveToServerBrowser(){this.docCtrl.model.operation="uploadDashboard";var editor=new mstrmojo.onetier.vi.ui.SaveToServerBrowser({connectivityProxy:getConnectivityProxy(),docModel:this.docCtrl.model,dataProvider:this.dataProvider,selectedProject:this.selectedProject});this.connectToServerEditorId=editor.id;editor.open();},openFromProjectBrowser:function openFromProjectBrowser(){this.docCtrl.model.operation="downloadDashboard";var editor=new mstrmojo.onetier.vi.ui.OpenFromServerBrowser({connectivityProxy:getConnectivityProxy(),docModel:this.docCtrl.model,dataProvider:this.dataProvider,selectedProject:this.selectedProject});this.connectToServerEditorId=editor.id;editor.open();},openCubeBrowser:function openCubeBrowser(callback){var cb=!!(callback&&(callback.success||callback.failure))?callback:null,model=this.docCtrl.model;this.docCtrl.model.operation="addDataset";var editor=new mstrmojo.onetier.vi.ui.CubeBrowser({connectivityProxy:getConnectivityProxy(),docModel:model,callback:cb,addDataset:!cb,dataProvider:this.dataProvider,selectedProject:this.selectedProject,authMode:this.authMode});this.connectToServerEditorId=editor.id;editor.open();},saveToCloud:function saveToCloud(){(new mstrmojo.onetier.vi.ui.SaveToCloud({connectivityProxy:getConnectivityProxy(),docModel:this.docCtrl.model})).open();},WSItemDragEnter:function WSItemDragEnter(evt){var model=this.docCtrl.model;model.set("WSDragItems",evt.obj);model.set("WSItemDroppable",evt.flag===0&&!(mstrApp.isAppStatePresentation()||mstrApp.isLayoutModePreview()));model.raiseEvent({name:$ENUM_EVENTS.WSITEM_DRAG_ENTER,evt:evt});},WSItemDragOver:function WSItemDragOver(evt){this.docCtrl.model.raiseEvent({name:$ENUM_EVENTS.WSITEM_DRAG_OVER,evt:evt});},WSItemDrop:function WSItemDrop(evt){var model=this.docCtrl.model;model.raiseEvent({name:$ENUM_EVENTS.WSITEM_DROP,evt:evt});if(!model.WSItemDroppable){return ;}var action=model.getWSItemDragDropAction();model.set("WSDragItems",[]);model.set("WSItemDroppable",false);var rebuildCallBack=model.getRebuildCallback(),updateCallback=model.getDatasetsUpdateCallback(),tocCallback=this.docCtrl.getUpdateTOCPanlelCallback();model.set("WSItemAddAction",action[0].action);model.execute({execute:function execute(){var update=model.getDataService().newUpdate(this);update.add({act:"insertWSItems",items:action},mstrmojo.func.wrapMethods({success:function(res){if(model.resetKeySeed){model.resetKeySeed(res.keySeed);}model.prompted=res.prompted||model.prompted;model.hasPrompted=res.hasPrompted||model.hasPrompted;model.updateLayouts(res);},failure:function(res){if(!res.hideError){mstrmojo.err(typeof res.mstrerr==="object"?res.mstrerr:res);}model.controller.undo();}},model.controller.getUpdateLayoutsCallback(),{success:function success(){model.raiseEvent({name:$ENUM_EVENTS.UPDATE_TOC});}}),mstrmojo.hash.copy(mstrmojo.DocDataService.REQUEST_DEFN_DATA,{config:{hideFailureErr:true}}));this.submitUpdate(update);},urInfo:{disablePU:true,treesToRender:mstrmojo.DocDataService.EnumTreesToRender.BOTH,callback:mstrmojo.func.wrapMethods(rebuildCallBack,updateCallback,tocCallback),extras:mstrmojo.DocDataService.REQUEST_DEFN_DATA}});},WSItemDragExit:function WSItemDragExit(evt){var model=this.docCtrl.model;model.raiseEvent({name:$ENUM_EVENTS.WSITEM_DRAG_EXIT,evt:evt});model.set("WSDragItems",[]);model.set("WSItemDroppable",false);},checkToOpenUndoActionTooltip:function(openFn){if(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode()){openFn();return ;}var proxy=new mstrmojo.onetier.vi.prefs.DesktopConnectivityProxy();proxy.getSavedPreferences({success:function(res){var feature_flag=res.feature_flag||{},strUndoTheme="UNDO_THEME_TOOLTIP",dontShow=feature_flag[strUndoTheme];if(!dontShow){var pref={feature_flag:{}};pref.feature_flag[strUndoTheme]=true;proxy.savePreferences(pref);openFn();}}});},loadDataProvider:function loadDataProvider(callback){this._super(callback);},resetUndoStack:function resetUndoStack(){var cmdMgr=this.docCtrl.cmdMgr;cmdMgr.reset();cmdMgr.dataService.stid=0;},engineShowWait:function engineShowWait(msgType){var waitBoxMsgs={0:{},1:{message:mstrmojo.desc(97,"Executing...")},2:{message:mstrmojo.desc(10492,"Saving..."),cssClass:"saving-in-progress",showCancel:true},3:{message:mstrmojo.desc(13781,"Saved Successfully"),cssClass:"save-successful-waitbox",_autoClose:true,timeout:2000}};mstrApp.showWait(waitBoxMsgs[msgType]||{});},reprompt:function reprompt(){var me=this,docModel=this.docCtrl.model,originalMessageId=docModel.mid;function showPrompt(result){var fnOnApply={success:function success(data){if(data.PromptEditor){showPrompt(data);}else{mstrApp.serverRequest({taskId:"ackPrompt",toDel:originalMessageId,toKeep:data.mid},{success:function success(){docModel.keySeed=data.keySeed;docModel.mid=data.mid;docModel.dataService.msgId=data.mid;me.docCtrl.getRefreshCallback().success(data);}});}}},fnOnCancel=function fnOnCancel(){mstrApp.serverRequest({taskId:"ackPrompt",toDel:result.mid,toKeep:originalMessageId});};if(result.hasPrompted==="1"||!!result.prompted){me.openPrompt({required:false,mid:result.mid,editor:result.PromptEditor,model:result.ReportInstanceModel,settings:result.Settings,onApply:fnOnApply,onCancel:fnOnCancel});}}mstrApp.serverRequest({taskId:"reprompt"},{success:function success(res){showPrompt(res);}});}});}());