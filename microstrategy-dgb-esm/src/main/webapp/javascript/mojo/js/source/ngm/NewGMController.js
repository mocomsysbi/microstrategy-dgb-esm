(function(){mstrmojo.ngm=mstrmojo.ngm||{};mstrmojo.requiresCls("mstrmojo.gm.GMController","mstrmojo.gm.GMEnums","mstrmojo.ngm.NewGMEnums","mstrmojo.ngm.NewGMJSONModel");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array,getOptionObjArr=mstrmojo.gm.GMUtility.getOptionObjArr,COLOR_BY_TYPE=mstrmojo.gm.EnumColorByType,$VISUTIL=mstrmojo.VisUtility,ENUM_XML_TAG=mstrmojo.gm.WidgetPropertyTag,ENUM_FORMAT_TAG=mstrmojo.gm.FormatingPropertyTag,ENUM_TEMPLATE=mstrmojo.vi.viz.EnumVisualizationTemplates,ENUM_AGGR_TEMPLATE=mstrmojo.vi.viz.EnumAggregatedVisTemplates,OBJECT_TYPE=mstrmojo.mstr.EnumDSSXMLObjectTypes,PRP_SHAPE=mstrmojo.gm.EnumShape,PRP_SUBTYPE=mstrmojo.gm.EnumSubtype,ABL_DIRECTION=mstrmojo.gm.EnumABLDirection,$SAB=mstrmojo.gm.DualAxisSubAxisBit,INVALID_METRIC_IDX=-20,PRP_CONTAINER_FIT=mstrmojo.gm.EnumContainerFitModes,CHART_TYPE=mstrmojo.gm.EnumGraphType;var METRIC_NAMES_ID="00000000000000000000000000000000",METRIC_NAMES_UNIT_TYPE=0;function getDependentMetrics(){var mtxIdxArr,bbSeries,chtInfo=this.getChartInfo();if(chtInfo.isABL){if(chtInfo.dirc===mstrmojo.gm.EnumABLDirection.VERTICAL){mtxIdxArr=this.getMetricsOnYAxis();}else{mtxIdxArr=this.getMetricsOnXAxis();}}else{if(chtInfo.tp===CHART_TYPE.GRID){mtxIdxArr=[];}else{mtxIdxArr=this.getMetricsOnYAxis();bbSeries=this.bubbleSeriesNum;if(chtInfo.isBubbleOrScatter&&bbSeries!==undefined){mtxIdxArr=mtxIdxArr.slice(0,bbSeries);}}}return mtxIdxArr;}function getColorByType(dz,modelJSON){var colorBy=dz.ColorBy,atts=[],len,i,gsi,colorByMetricIndex,templateUnits=colorBy.TemplateUnit,templateMetrics=colorBy.TemplateMetric,hasAttributes=false,hasMetrics=false,hasMetricsNameItem=false,colorByType=COLOR_BY_TYPE.NULL;if(templateUnits&&templateUnits.length>0){hasAttributes=true;}if(templateMetrics&&templateMetrics.length>0){colorByMetricIndex=templateMetrics[0].idx;hasMetrics=true;}if(colorBy.MetricNames!==undefined){hasMetricsNameItem=true;}if(!(hasMetricsNameItem||templateMetrics||hasAttributes)){return{tp:COLOR_BY_TYPE.NULL};}if(hasAttributes){if(hasMetricsNameItem){colorByType=COLOR_BY_TYPE.ATT_METRICS;}else{colorByType=COLOR_BY_TYPE.ATT;}len=templateUnits.length;for(i=0;i<len;i++){atts.push(templateUnits[i]);}return{tp:colorByType,atts:atts};}if(hasMetricsNameItem){colorByType=COLOR_BY_TYPE.METRICS_ITEM;return{tp:colorByType};}if(hasMetrics){colorByType=COLOR_BY_TYPE.METRICS;gsi=modelJSON.gsi;this.thresholds=gsi.thresholds;var metricId=gsi.mx[colorByMetricIndex].did,thresholds=this.thresholds&&this.thresholds[metricId],rankMode;if(!thresholds){return{tp:COLOR_BY_TYPE.NULL};}rankMode=$VISUTIL.getRankMode(thresholds);return{tp:colorByType,metrics:templateMetrics,rankMode:rankMode,colorByMetricIndex:colorByMetricIndex,thresholds:thresholds};}}function preprocessGroupInfo(groupInfo){var count=groupInfo?groupInfo.length:0,i,pair,left,leftMetricIndex,right,rightMetricIndex,metricId;var getMetricIndex=function(param){var result,index=-1;if(param&&param.indexOf&&param.indexOf("idx")>=0){result=param.split(":");if(result&&result.length===2){index=parseInt(result[1]);}}return index;};var getMetricIdFromIndex=function(index,isPrimary){var chtInfo=this.getChartInfo(),metric,metricId=null,dz=this.dz,yAxis,xAxis,metricInZone,ax;if(chtInfo.dirc===ABL_DIRECTION.VERTICAL){yAxis=dz.YAxis;metricInZone=yAxis.TemplateMetric;metric=metricInZone&&metricInZone.length>0&&metricInZone[index];if(metric){ax=parseInt(metric.ax,10);if(ax===$SAB.PRIMARY&&isPrimary||ax===$SAB.SECONDARY&&!isPrimary){metricId=metric.id;}}}else{if(chtInfo.dirc===ABL_DIRECTION.HORIZONTAL){xAxis=dz.XAxis;metricInZone=xAxis.TemplateMetric;metric=metricInZone&&metricInZone.length>0&&metricInZone[index];if(metric){ax=parseInt(metric.ax,10);if(ax===$SAB.PRIMARY&&isPrimary||ax===$SAB.SECONDARY&&!isPrimary){metricId=metric.id;}}}}return metricId;};var removeFromGroupInfo=function(groupInfo,pairIndex,isPrimary){var pair=groupInfo[pairIndex],removeIndex=isPrimary?0:1;if(pair[0]===INVALID_METRIC_IDX||pair[1]===INVALID_METRIC_IDX){groupInfo[pairIndex]=undefined;}else{pair[removeIndex]=INVALID_METRIC_IDX;}};for(i=0;i<count;i++){pair=groupInfo[i];left=pair[0];leftMetricIndex=getMetricIndex(left);if(leftMetricIndex>=0){metricId=getMetricIdFromIndex.call(this,leftMetricIndex,true);if(metricId){pair[0]=metricId;}else{removeFromGroupInfo(groupInfo,i,true);}}right=pair[1];rightMetricIndex=getMetricIndex(right);if(rightMetricIndex>=0){metricId=getMetricIdFromIndex.call(this,rightMetricIndex,false);if(metricId){pair[1]=metricId;}else{removeFromGroupInfo(groupInfo,i,false);}}}var processedGroupInfo=[];for(i=0;i<count;i++){if(groupInfo[i]!==undefined){processedGroupInfo.push(groupInfo[i]);}}this.setGroupInfo(processedGroupInfo);return processedGroupInfo;}mstrmojo.ngm.NewGMController=mstrmojo.declare(mstrmojo.gm.GMController,null,{scriptClass:"mstrmojo.ngm.NewGMController",chartDirection:mstrmojo.ngm.EnumGraphDirection.UNDEFINED,init:function(props){this._super(props);this.axisRCache=null;this.axisCCache=null;this.jsonModel=this.addDisposable(new mstrmojo.ngm.NewGMJSONModel({node:this.firstRes,docModel:this.xtabModel.docModel,gmCtr:this}));this.inChartLayout=this.jsonModel._getInChartLayout();this.extrs=this.jsonModel.getData().extrs;this.splitPlottingMetrics=this.jsonModel.isSplitPlottingMetrics;this.model=this.jsonModel;this.dz=this.jsonModel.getData().dz;this.gts=this.jsonModel.getData().gts;this.gsi=this.jsonModel.getData().gsi;},adjustMetricNamesInDropZone:function(){if(!this.getChartInfo().isPie){if($HASH.walk("firstRes.dz.XAxis",this)&&this.firstRes.dz.XAxis.MetricNames!==undefined){this.firstRes.dz.BreakBy.MetricNames=this.firstRes.dz.XAxis.MetricNames;delete this.firstRes.dz.XAxis.MetricNames;}if($HASH.walk("firstRes.dz.YAxis",this)&&this.firstRes.dz.YAxis.MetricNames!==undefined){this.firstRes.dz.BreakBy.MetricNames=this.firstRes.dz.YAxis.MetricNames;delete this.firstRes.dz.YAxis.MetricNames;}}},postInit:function(){this.adjustMetricNamesInDropZone();this.consumeJSON(this.firstRes);this.setupDualAxis();this.colorByInfo=getColorByType.call(this,this.jsonModel.getData().dz,this.jsonModel.getData());this.composeCustomString();this.disabledUnits=$VISUTIL.findDisabledUnits(this.firstRes,this.xtabModel);},setupDualAxis:function(){this.haveX1=false;this.haveX2=false;this.haveY1=false;this.haveY2=false;if(this.jsonModel.getData().dz.XAxis.TemplateMetric){this.haveX1=true;}if(this.jsonModel.getData().dz.YAxis.TemplateMetric){this.haveY1=true;}},hasGroupInfoStored:function(){var gInfo,rawGInfo=this.view.getWidgetPropertyValue(ENUM_XML_TAG.GROUP_INFO);if(rawGInfo){rawGInfo=rawGInfo.replace(/'/g,'"');gInfo=JSON.parse(rawGInfo);}if(gInfo&&gInfo.length>0){if(rawGInfo.indexOf("idx")>=0){gInfo=preprocessGroupInfo.call(this,gInfo);}return{existing:true,gi:gInfo};}return{existing:false};},consumeJSON:function(modelJSON){this.configureTrendLine(modelJSON);var rhInfo=this.getRowTitleInfo(true),chInfo=this.getColTitleInfo(true),attributeSelectionInfo=this.attributeSelectionInfo={};if(rhInfo&&rhInfo.items){$ARR.forEach(rhInfo.items,function(att){attributeSelectionInfo[att.id]=att;});}if(chInfo&&chInfo.items){$ARR.forEach(chInfo.items,function(att){attributeSelectionInfo[att.id]=att;});}},getMetricFormat:function(met){var gmm=this.jsonModel,mIdx;if(typeof met==="string"){return gmm.queryMetric({id:met})||{};}else{mIdx=met;}if(mIdx>=0){var mx=gmm._getMetrics()[mIdx];return{mId:mx&&mx.oid,n:mx&&mx.n,nf:mx&&gmm.node.nf[mIdx].nfs,cds:mx&&mx.cds||false};}return{};},getHeaderFormat:function(hds){var res;(hds||[]).forEach(function(hd){if("mIdx" in hd&&!res){res=this.getMetricFormat(hd.mIdx).nf;}}.bind(this));return res;},resetFitTo:function(){if(this.dz){var myproperty=this.property,dft=((!!this.dz.Rows.TemplateUnit&&!this.dz.YAxis.TemplateMetric)||(!!this.dz.Columns.TemplateUnit&&!this.dz.XAxis.TemplateMetric))?PRP_CONTAINER_FIT.FIT_TO_CONTENT:PRP_CONTAINER_FIT.AUTOMATIC;myproperty.reInitItem(ENUM_FORMAT_TAG.CONTAINER_FIT_MODE,dft);}},getShowDataLabelOptions:function(){var visGM=this.view;if(visGM.noData){return[];}if(this.dlOptions){return this.dlOptions;}var me=this,chtInfo=this.getChartInfo(),mtxIdxArr,options=[];if(chtInfo.isPie){mtxIdxArr=this.getMetricsOnAngleBy();}else{if(chtInfo.tp!==CHART_TYPE.GRID){mtxIdxArr=getDependentMetrics.call(this);}else{mtxIdxArr=this.getSizeByMetrics();}}$ARR.forEach(mtxIdxArr,function(m){options.push(getOptionObjArr.call(me,[m]));});if(options.length>1){options.unshift({opt:mstrmojo.desc(2460,"All Metrics"),mos:this.getMetricFormatFromIndexArray(mtxIdxArr),key:"AllMetrics"});}this.dlOptions=options;return options;},textTypeDataLabelEnabled:function(){var chtInfo=this.getChartInfo(),result=false,hostStructure=this.getHostStructure();if(chtInfo.isWaterfall&&hostStructure.BreakBy.length>0){result=true;}return result;},getColorByLegendInfo:function(){return{itemName:"",elements:[]};},getRowHeaderTitles:function(){return this.jsonModel.getRowHeaderTitles();},getColumnHeaderTitles:function(){return this.jsonModel.getColumnHeaderTitles();},getXAxisHeaderTitles:function(rIdx,cIdx){return this.jsonModel.getXAxisHeaderTitles(rIdx,cIdx);},getYAxisHeaderTitles:function(rIdx,cIdx){return this.jsonModel.getYAxisHeaderTitles(rIdx,cIdx);},getBreakByHeaderTitles:function(rIdx,cIdx){return this.jsonModel.getBreakByHeaderTitles(rIdx,cIdx);},getYAxisHeaders:function(rIdx,cIdx){return this.jsonModel.getYAxisHeaders(rIdx,cIdx);},getXAxisHeaders:function(rIdx,cIdx){return this.jsonModel.getXAxisHeaders(rIdx,cIdx);},getBreakByHeaders:function(rIdx,cIdx){return this.jsonModel.getBreakByHeaders(rIdx,cIdx);},hasSizeBy:function(){return this.jsonModel.hasSizeBy();},hasColorBy:function(){return this.jsonModel.hasColorBy();},hasAttributesInDropzone:function(zone){return this.jsonModel.hasAttributesInDropzone(zone);},isUnitInTooltip:function(id){return this.jsonModel.isUnitInTooltip(id);},getTooltipItems:function(){return this.jsonModel.getTooltipItems();},queryAttribute:function(query){return this.jsonModel.queryAttribute(query);},getRowTitleInfo:function(isfullInfo){return this._getTitleInfo(isfullInfo,this.jsonModel.getRowTitleInfo(),this.rowHeaderCnt);},getColTitleInfo:function(isfullInfo){return this._getTitleInfo(isfullInfo,this.jsonModel.getColTitleInfo(),this.colHeaderCnt);},_getTitleInfo:function(isfullInfo,titleInfos,hCnt){var lbs=[];if(hCnt<titleInfos.length){titleInfos.slice(0,hCnt);}$ARR.forEach(titleInfos,function(titleInfo){lbs.push(isfullInfo?titleInfo:titleInfo.n);});return{items:lbs};},getHeaderPath:function(rIdx,cIdx){return this.jsonModel.getHeaderPath(rIdx,cIdx);},getMetrics:function(rIdx,cIdx){return this.jsonModel.fetchGVS(rIdx,cIdx);},getMatrixDimension:function(){return this.jsonModel.getMatrixDimension();},getAxis:function getAxis(rIdx,cIdx){if(rIdx<0||rIdx>=this.getRowChartCount()||cIdx<0||cIdx>=this.getColChartCount){throw"getAxis: index out of range";}return Object.assign({},this.axisRCache[rIdx],this.axisCCache[cIdx]);},getRowChartCount:function(){return this.jsonModel.getMatrixDimension().r;},getColChartCount:function(){return this.jsonModel.getMatrixDimension().c;},getRowHeaderTree:function(){return this.jsonModel.getRowHeaderTree();},getColHeaderTree:function(){return this.jsonModel.getColHeaderTree();},hasMetricNamesInXHeader:function(){return this.jsonModel.hasMetricNamesInXHeader();},hasMetricNamesInYHeader:function(){return this.jsonModel.hasMetricNamesInYHeader();},getAxisLabels:function(rIdx,cIdx){return this.jsonModel.getAxisLabels(rIdx,cIdx);},getWaterfallAxisLabels:function(idx){return this.waterfallLabels[idx];},addWaterfallAxisLabel:function(idx,labels){if(!this.waterfallLabels){this.waterfallLabels=[];}this.waterfallLabels[idx]=labels;},addWaterfallAxisVals:function(idx,vals){if(!this.waterfallVals){this.waterfallVals=[];}this.waterfallVals[idx]=vals;},getWaterfallAxisVals:function(idx){return this.waterfallVals[idx];},getExtremes:function(rIdx,cIdx){return this.getMinMaxForDP(rIdx,cIdx);},adjustMetricNamesInDropZone:function(){if($HASH.walk("firstRes.dz.XAxis",this)&&this.firstRes.dz.XAxis.MetricNames!==undefined){this.firstRes.dz.BreakBy.MetricNames=this.firstRes.dz.XAxis.MetricNames;delete this.firstRes.dz.XAxis.MetricNames;}if($HASH.walk("firstRes.dz.YAxis",this)&&this.firstRes.dz.YAxis.MetricNames!==undefined){this.firstRes.dz.BreakBy.MetricNames=this.firstRes.dz.YAxis.MetricNames;delete this.firstRes.dz.YAxis.MetricNames;}},getSortArray:function(cellIndex,ascending,attributeHeader,attributeHeaderAscending){var sortsArray=[],dataModel=this.jsonModel,mcnt=dataModel._getMetrics().length,i,attTitle,gvsRI,gvsCI,sortMtcIdx,allMetrics,selPropArr=["fi","headerID","headerText","id","idx","levelIndex","n","ui","tui"],metricObj,rowAttributesInTree=dataModel.getUnitAttributesCountOnRow(),colAttributesInTree=dataModel.getUnitAttributesCountOnCol(),selectedObj,isMetricSort=cellIndex!==null,moreInfo;if(cellIndex){gvsRI=cellIndex.row-this.gts.col.length;gvsCI=cellIndex.col-this.gts.row.length;sortMtcIdx=gvsCI%mcnt;allMetrics=dataModel._getMetrics();metricObj=$HASH.copy(allMetrics[sortMtcIdx],{});metricObj.gvsRI=gvsRI;metricObj.gvsCI=gvsCI;}var elements=[];for(i=0;i<colAttributesInTree;i++){attTitle=(this.getColTitleInfo(true).items)[i];if(isMetricSort&&this.horizontalMode){selectedObj=$HASH.copyProps(selPropArr,dataModel.getColHeaderObj(gvsCI,i),{});moreInfo=dataModel._headerInfoToProp(1,selectedObj,"n&id");$HASH.copy(moreInfo[0],selectedObj);elements.push(selectedObj);}else{if(attributeHeader&&!attributeHeader.isRowAttribute&&(attributeHeader.tui===i)){sortsArray.push({unit:attTitle,isAsc:attributeHeaderAscending});}}}if(isMetricSort&&this.horizontalMode){metricObj.axis=1;elements.push(metricObj);}for(i=0;i<rowAttributesInTree;i++){attTitle=(this.getRowTitleInfo(true).items)[i];if(isMetricSort&&!this.horizontalMode){selectedObj=$HASH.copyProps(selPropArr,dataModel.getRowHeaderObj(gvsRI,i),{});moreInfo=dataModel._headerInfoToProp(0,selectedObj,"n&id");$HASH.copy(moreInfo[0],selectedObj);elements.push(selectedObj);}else{if(attributeHeader&&attributeHeader.isRowAttribute&&(attributeHeader.tui===i)){sortsArray.push({unit:attTitle,isAsc:attributeHeaderAscending});}}}if(isMetricSort&&!this.horizontalMode){metricObj.axis=2;elements.push(metricObj);}if(isMetricSort){sortsArray.push({unit:metricObj,isAsc:ascending,elements:elements});}return sortsArray;},getSortActions:function(sortsArray){var sortActions=[],sorts=this.jsonModel.getSorts(),hasSortsRow=sorts[0]&&sorts[0].length>0,hasSortsColumn=sorts[1]&&sorts[1].length>0;if(hasSortsRow){sortActions.push({actionId:27,axisName:1});}if(hasSortsColumn){sortActions.push({actionId:27,axisName:2});}sortsArray.forEach(function(sort,i){var sortTarget=sort.unit,elements=sort.elements,sortType,axis,id;if(sortTarget.otp===OBJECT_TYPE.Attribute||sortTarget.otp===OBJECT_TYPE.Consolidation){axis=sortTarget.isRowAttribute?1:2;id=sortTarget.id;if(sortTarget.otp===OBJECT_TYPE.Consolidation&&sortTarget.ost===12033){sortType=24;}else{sortType=sortTarget.otp===OBJECT_TYPE.Consolidation?10:3;}}else{if(sortTarget.otp!==OBJECT_TYPE.Filter){sortType=1;axis=sortTarget.axis;id=sortTarget.oid;}}sortActions.push({sortIndex:i,sortType:sortType,objType:sortTarget.otp,objID:id,ascending:sort.isAsc,axisIndex:axis,subtotalsPosition:0,eIds:elements?elements:null,formId:sortTarget.fid?sortTarget.fid:"",actionId:26});});return sortActions;},getModelRhs:function(){return this.jsonModel.modelRhs;},getModelChs:function(){return this.jsonModel.modelChs;},getSizeByMetricsInfo:function(rIdx,cIdx){var mx=this.getSizeByMetrics()||[],dm=this.jsonModel,exrs=this.getExtremes(rIdx,cIdx),res=[];mx=mx.length>1?[mx[0]]:mx;mx.forEach(function(mIdx){var mx=dm._getMetrics()[mIdx];var sb={id:mx.oid,name:mx.n,max:exrs.ZMaxValue,min:exrs.ZMinValue};res.push(sb);});return res;},getAttributeAxesLetters:function(){var res=[];if(this.isHistogram){return res;}if(this.jsonModel.isAttrInXAxis()){res.push("x");}if(this.jsonModel.isAttrInYAxis()){res.push("y");}return res;},getMetricAxesLetters:function(){var res=[];if(this.jsonModel.isMetricInXAxis()){res.push("x");}if(this.jsonModel.isMetricInYAxis()){res.push("y");}return res;},getCellHandler:function(rIdx,cIdx,mIdx){var data=this.jsonModel.getData(),gts=data.gts,row=gts.row,col=gts.col,gvsPtt=this.jsonModel.mapChartToTemplatePartition(rIdx,cIdx);if(mIdx>=0){return{row:gvsPtt.r+col.length,col:gvsPtt.c+mIdx+row.length};}},getSizeByMetrics:function(){var res=this.jsonModel.getSizeByMetrics();if(res===undefined){return[];}else{if($ARR.isArray(res)){return res;}else{return[res];}}},mapFromChartToLDSIndex:function(r,c){var inChartLayout=this.jsonModel._getInChartLayout(),row=Math.floor(r/inChartLayout.r),col=Math.floor(c/inChartLayout.c),inchtRow=r%inChartLayout.r,inchtCol=c%inChartLayout.c,dpIdx=inchtRow*inChartLayout.c+inchtCol;return{r:row,c:col,dpIdx:dpIdx,inchtRow:inchtRow,inchtCol:inchtCol};},getHostStructure:function(){var i,arr,zName,zData,dz=this.jsonModel.getData().dz,zoneNames=["Rows","Columns","XAxis","YAxis","BreakBy","SliceBy","ColorBy","SizeBy","AdditionalMetrics","AngleBy"],nZones=zoneNames.length,hostStruct={},gts=this.jsonModel.getData().gts,me=this,gsi=this.jsonModel.getData().gsi,getUnitItem=function(unit){if(unit.srcUnit){unit=unit.srcUnit;if(arr.filter(function(elem){return unit.id===elem.id;}).length>0){return ;}}var item=$HASH.copy(unit,{zone:i+1});var uInGts;if(unit.t!==4){if(unit.axis!==undefined&&unit.uidx!==undefined){uInGts=gts[unit.axis][unit.uidx];}}var unt=me.jsonModel.queryAttribute({aid:unit.id},["fs"]);if(unt&&unt.fs){item.fs=unt.fs;}if(unt&&("st" in unt)){item.st=unt.st;}if(uInGts){item.at=uInGts.at;}arr.push(item);};for(i=0;i<nZones;i++){zName=zoneNames[i];zData=dz[zName]||dz.Angle;arr=hostStruct[zName]=[];if(zData.TemplateUnit){$ARR.forEach(zData.TemplateUnit,getUnitItem);}if(zData.TemplateMetric){$ARR.forEach(zData.TemplateMetric,getUnitItem);}if(zData.MetricNames!==undefined){arr.push({n:"Metric Names",id:METRIC_NAMES_ID,t:METRIC_NAMES_UNIT_TYPE,zone:i+1});}}return hostStruct;},isEmptyVis:function(){var struct=this.getHostStructure(),isPie=this.isPie,nRows=struct.Rows.length,nCols=struct.Columns.length,nXAxis=struct.XAxis.length,nYAxis=struct.YAxis.length,nSliceBy=struct.SliceBy.length,nAngleBy=struct.AngleBy.length;if(isPie&&this.getChartType()===CHART_TYPE.GRID){return this.isBlankGrid;}if(nRows>0||nCols>0||nXAxis>0||nYAxis>0){return false;}if(isPie){if(nSliceBy>0||nAngleBy>0){return false;}}return true;},getNewChartType:function(){return this.getChartType();},getChartType:function(){if(this.chartType===undefined||CHART_TYPE.UNDEFINED){var modelJSON=this.firstRes,dz=modelJSON.dz,xAxis=dz.XAxis,yAxis=dz.YAxis,chartType,visGM=this.view,propShape=visGM.getWidgetPropertyValue(ENUM_XML_TAG.SHAPE),visType=visGM.getWidgetPropertyValue(ENUM_XML_TAG.VIS_TYPE);if(visType===ENUM_TEMPLATE.GRAPHMATRIXVERTICALHISTOGRAM){chartType=CHART_TYPE.HISTOGRAM;this.isHistogram=true;}else{if(visType===ENUM_TEMPLATE.GRAPHMATRIXVERTICALBOXPLOT||visType===ENUM_TEMPLATE.GRAPHMATRIXHORIZONTALBOXPLOT){chartType=CHART_TYPE.BOXPLOT;this.isBoxPlot=true;}else{if(visType===ENUM_TEMPLATE.GRAPHMATRIXVERTICALWATERFALL||visType===ENUM_TEMPLATE.GRAPHMATRIXHORIZONTALWATERFALL){chartType=CHART_TYPE.WATERFALL;this.isWaterfall=true;}else{if(xAxis.TemplateMetric&&yAxis.TemplateMetric){if(this.hasSizeBy()){chartType=CHART_TYPE.BUBBLE;}else{chartType=CHART_TYPE.SCATTER;}}else{if(!xAxis.TemplateMetric&&!yAxis.TemplateMetric){chartType=CHART_TYPE.GRID;if((!xAxis.TemplateUnit||xAxis.TemplateUnit.length===0)&&(!yAxis.TemplateUnit||yAxis.TemplateUnit.length===0)){this.isBlankGrid=true;}}else{if(propShape===PRP_SHAPE.LINE){chartType=CHART_TYPE.LINE;}else{if(propShape===PRP_SHAPE.BAR){chartType=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.AREA){chartType=CHART_TYPE.AREA;}else{if(propShape===PRP_SHAPE.PIE){chartType=CHART_TYPE.BAR;}else{if(propShape===PRP_SHAPE.RING){chartType=CHART_TYPE.BAR;}else{chartType=CHART_TYPE.BAR;}}}}}}}}}}this.chartType=chartType;if(yAxis.TemplateMetric&&!xAxis.TemplateMetric){this.chartDirection=mstrmojo.gm.EnumABLDirection.VERTICAL;}else{if(!yAxis.TemplateMetric&&xAxis.TemplateMetric){this.horizontalMode=true;this.chartDirection=mstrmojo.gm.EnumABLDirection.HORIZONTAL;}else{this.chartDirection=mstrmojo.gm.EnumABLDirection.UNDEFINED;}}this.isPie=(propShape===PRP_SHAPE.PIE||propShape===PRP_SHAPE.RING);if(this.isPie){this.isBlankGrid=false;}if(modelJSON.eg!==undefined&&!(visGM&&visGM.excludeData)){this.isBlankGrid=true;}}return this.chartType;},getVisType:function getVisType(){return this.view.getWidgetPropertyValue(ENUM_XML_TAG.VIS_TYPE);},getAggregatedVisType:function getAggregatedVisType(){var visType=this.getVisType(),type="default";$HASH.forEach(ENUM_AGGR_TEMPLATE,function(templates,key){if(templates.indexOf(visType)>-1){type=key.toString().toLowerCase();return false;}});return type;},isGrid:function(){return this.chartType===CHART_TYPE.GRID;},isBubble:function(){return this.chartType===CHART_TYPE.BUBBLE;},isScatter:function(){return this.chartType===CHART_TYPE.SCATTER;},isBubbleOrScatter:function(){var type=this.chartType;return type===CHART_TYPE.BUBBLE||type===CHART_TYPE.SCATTER;},getChartInfo:function(){var chtInfo=this.chartInfo;if(chtInfo){return chtInfo;}var gTp=CHART_TYPE,tp=this.getChartType(),isABL=false;if(tp===gTp.AREA||tp===gTp.BAR||tp===gTp.LINE||tp===gTp.BOXPLOT||tp===gTp.WATERFALL||tp===gTp.HISTOGRAM){isABL=true;}this.chartInfo={tp:tp,sbtp:this.chartSubType,dirc:this.chartDirection,shape:this.markerShape,ceMarkerShape:this.ceMarkerShape,isABL:isABL,isPie:this.isPie,isHistogram:this.isHistogram,isBoxPlot:this.isBoxPlot,isWaterfall:this.isWaterfall,isRing:false,hasSizeBy:this.hasSizeBy(),isCombo:this.enableCombiChart,isBubbleOrScatter:this.isBubbleOrScatter(),isGrid:this.isGrid()};return this.chartInfo;},resetChartInfo:function(){delete this.chartInfo;}});}());