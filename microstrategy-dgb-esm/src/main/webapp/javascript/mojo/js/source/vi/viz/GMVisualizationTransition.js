(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.chart.model.enums.EnumDSSObjectType","mstrmojo.gm.GMEnums","mstrmojo.gm.EnumShape");mstrmojo.requiresClsP("mstrmojo.vi.viz","KnownVisualizations","EnumVizStyles","EnumVisualizationTemplates","VisualizationTransition","GraphMatrixHelper","HeatMapVisualizationHelper","NetworkVisualizationHelper","ImageLayoutHelper","MapHelper");var $MOJO=mstrmojo,$GM=mstrmojo.gm,$ARR=$MOJO.array,$HASH=$MOJO.hash,$VIZ=$MOJO.vi.viz,$KNOWN_VIZ=$VIZ.KnownVisualizations,$VIZTEMPLATES=$VIZ.EnumVisualizationTemplates,$VIZ_STYLES=$VIZ.EnumVizStyles,NEW_GRAPH_MATRIX_STYLE=$VIZ_STYLES.NEW_GRAPH_MATRIX,$GMH=$VIZ.GraphMatrixHelper,$DSSOBJ_TYPES=mstrmojo.chart.model.enums.EnumDSSObjectType,ENUM_FORMAT_TAG=$GM.FormatingPropertyTag,ENUM_XML_TAG=$GM.WidgetPropertyTag,ENUM_NGM_FIT_MODES=$GM.EnumContainerFitModes,$GRID="Grid",$SHAPE_TYPES=$GM.EnumShape,$SAB=$GM.DualAxisSubAxisBit,AXIS_PRIMARY=$SAB.PRIMARY,AXIS_SECONDARY=$SAB.SECONDARY,ENUM_DZID=$VIZ.EnumDSSDropZones,XAXIS=ENUM_DZID.XAxis,YAXIS=ENUM_DZID.YAxis,ANGLEBY=ENUM_DZID.Angle,COLORBY=ENUM_DZID.ColorBy,METRIC_NAMES_VISIBLE_THRESH=1;var GRAPHMATRIXVERTICALBARAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARAUTOMATIC,GRAPHMATRIXVERTICALLINEAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINEAUTOMATIC,GRAPHMATRIXVERTICALAREAAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREAAUTOMATIC,GRAPHMATRIXVERTICALBARSTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARSTACKED,GRAPHMATRIXVERTICALLINESTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINESTACKED,GRAPHMATRIXVERTICALAREASTACKED=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREASTACKED,GRAPHMATRIXBUBBLECIRCLEMM=$VIZTEMPLATES.GRAPHMATRIXBUBBLECIRCLEMM,GRAPHMATRIXBUBBLESQUAREMM=$VIZTEMPLATES.GRAPHMATRIXBUBBLESQUAREMM,GRAPHMATRIXSCATTERCIRCLEMM=$VIZTEMPLATES.GRAPHMATRIXSCATTERCIRCLEMM,GRAPHMATRIXSCATTERSQUAREMM=$VIZTEMPLATES.GRAPHMATRIXSCATTERSQUAREMM,GRAPHMATRIXBUBBLEGRIDCIRCLEAA=$VIZTEMPLATES.GRAPHMATRIXBUBBLEGRIDCIRCLEAA,GRAPHMATRIXBUBBLEGRIDSQUAREAA=$VIZTEMPLATES.GRAPHMATRIXBUBBLEGRIDSQUAREAA,GRAPHMATRIXSCATTERGRIDCIRCLEAA=$VIZTEMPLATES.GRAPHMATRIXSCATTERGRIDCIRCLEAA,GRAPHMATRIXSCATTERGRIDSQUAREAA=$VIZTEMPLATES.GRAPHMATRIXSCATTERGRIDSQUAREAA,GRAPHMATRIXVERTICALBARCLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARCLUSTERED,GRAPHMATRIXVERTICALLINECLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINECLUSTERED,GRAPHMATRIXVERTICALAREACLUSTERED=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREACLUSTERED,GRAPHMATRIXVERTICALBARPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALBARPERCENT,GRAPHMATRIXVERTICALLINEPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALLINEPERCENT,GRAPHMATRIXVERTICALAREAPERCENT=$VIZTEMPLATES.GRAPHMATRIXVERTICALAREAPERCENT,GRAPHMATRIXHORIZONTALBARAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARAUTOMATIC,GRAPHMATRIXHORIZONTALLINEAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINEAUTOMATIC,GRAPHMATRIXHORIZONTALAREAAUTOMATIC=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREAAUTOMATIC,GRAPHMATRIXHORIZONTALBARCLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARCLUSTERED,GRAPHMATRIXHORIZONTALLINECLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINECLUSTERED,GRAPHMATRIXHORIZONTALAREACLUSTERED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREACLUSTERED,GRAPHMATRIXHORIZONTALBARSTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARSTACKED,GRAPHMATRIXHORIZONTALLINESTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINESTACKED,GRAPHMATRIXHORIZONTALAREASTACKED=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREASTACKED,GRAPHMATRIXHORIZONTALBARPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBARPERCENT,GRAPHMATRIXHORIZONTALLINEPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALLINEPERCENT,GRAPHMATRIXHORIZONTALAREAPERCENT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALAREAPERCENT,GRAPHMATRIXPIE=$VIZTEMPLATES.GRAPHMATRIXPIE,GRAPHMATRIXRING=$VIZTEMPLATES.GRAPHMATRIXRING,GRAPHCOMBINATIONBARAREA=$VIZTEMPLATES.GRAPHCOMBINATIONBARAREA,GRAPHCOMBINATIONBARAREADUALAXIS=$VIZTEMPLATES.GRAPHCOMBINATIONBARAREADUALAXIS,GRAPHMATRIXBUBBLESQUAREAM=$VIZTEMPLATES.GRAPHMATRIXBUBBLESQUAREAM,GRAPHMATRIXSCATTERSQUAREAM=$VIZTEMPLATES.GRAPHMATRIXSCATTERSQUAREAM,GRAPHMATRIXHISTOGRAM=$VIZTEMPLATES.GRAPHMATRIXVERTICALHISTOGRAM,GRAPHMATRIXGRIDCHART=$VIZTEMPLATES.GRAPHMATRIXGRIDCHART,GRID=$VIZTEMPLATES.GRID,GRAPHMATRIXVERTICALBOXPLOT=$VIZTEMPLATES.GRAPHMATRIXVERTICALBOXPLOT,GRAPHMATRIXHORIZONTALBOXPLOT=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALBOXPLOT,GRAPHMATRIXVERTICALWATERFALL=$VIZTEMPLATES.GRAPHMATRIXVERTICALWATERFALL,GRAPHMATRIXHORIZONTALWATERFALL=$VIZTEMPLATES.GRAPHMATRIXHORIZONTALWATERFALL;var UNIT_TYPE_NONMETRIC="nm",UNIT_TYPE_METRIC="m",UNIT_TYPE_NONE="none",UNIT_TYPE_ANY="any",UNIT_TYPE_TOGGLE="toggle",METRICS_IN_ANY="MetricsInAny",METRICS_IN_NONE="MetricsInNone";function getTemplateInfo(node){var gsi=$HASH.copy(node.data.gsi),whichMetricsAxis=gsi.tma===1?"rows":"cols",metricsAxis=gsi[whichMetricsAxis],mx=gsi.mx;gsi[whichMetricsAxis]=metricsAxis.filter(function(unit){return unit.t!==-1&&unit.did!=="-1";});if(mx){mx.forEach(function(m){m.t=4;});}return gsi;}function removeFromCollection(obj){var ti=this.templateInfo,i;for(i=0;i<ti.rows.length;i++){if(ti.rows[i].did===obj.id){ti.rows.splice(i,1);return ;}}for(i=0;i<ti.cols.length;i++){if(ti.cols[i].did===obj.id){ti.cols.splice(i,1);return ;}}for(i=0;i<ti.mx.length;i++){if(ti.mx[i].did===obj.id){ti.mx.splice(i,1);return ;}}}function addDropZonesNode(defn,metricsDropZone){defn.MetricsDropZone=metricsDropZone;}function addDropZoneNode(defn,dropZoneId,unitType,min){defn.Zones[dropZoneId]={type:unitType,min:min};}function addPropertiesNode(defn,propertyName,propertyValue){defn.Properties[propertyName]=propertyValue;}function getDropZoneFromDefn(defn,dropZoneId){return defn.Zones[dropZoneId];}function getDefinition(templateID){var defn={Zones:[],Properties:[]};switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLESQUAREMM:addDropZonesNode(defn,METRICS_IN_ANY);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_ANY,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_ANY,0);break;case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERSQUAREMM:addDropZonesNode(defn,METRICS_IN_ANY);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_NONE,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_NONMETRIC,0);break;case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:addDropZonesNode(defn,METRICS_IN_NONE);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXSCATTERGRIDCIRCLEAA:case GRAPHMATRIXSCATTERGRIDSQUAREAA:addDropZonesNode(defn,METRICS_IN_NONE);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_BREAKBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_SIZEBY,UNIT_TYPE_NONE,0);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALAREACLUSTERED:case GRID:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALWATERFALL:case GRAPHMATRIXVERTICALBOXPLOT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREAPERCENT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALAREACLUSTERED:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXVERTICALWATERFALL:case GRAPHMATRIXHORIZONTALBOXPLOT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREAPERCENT:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_NONMETRIC,1);break;case GRAPHMATRIXPIE:case GRAPHMATRIXRING:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_SLICE,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_ANGLE,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_COLORBY,UNIT_TYPE_NONMETRIC,0);break;case GRAPHCOMBINATIONBARAREA:case GRAPHCOMBINATIONBARAREADUALAXIS:addDropZonesNode(defn,$GMH.PROP_ROWS);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);break;case GRAPHMATRIXHISTOGRAM:addDropZoneNode(defn,$GMH.PROP_YAXIS,UNIT_TYPE_METRIC,1);addDropZoneNode(defn,$GMH.PROP_XAXIS,UNIT_TYPE_NONMETRIC,1);}switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERGRIDCIRCLEAA:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_CIRCLE);break;case GRAPHMATRIXBUBBLESQUAREAM:case GRAPHMATRIXBUBBLESQUAREMM:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:case GRAPHMATRIXSCATTERSQUAREAM:case GRAPHMATRIXSCATTERSQUAREMM:case GRAPHMATRIXSCATTERGRIDSQUAREAA:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_SQUARE);break;case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_BAR);break;case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_LINE);break;case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_AREA);break;case GRAPHMATRIXPIE:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_PIE);break;case GRAPHMATRIXRING:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_RING);break;case GRAPHCOMBINATIONBARAREADUALAXIS:case GRAPHMATRIXGRIDCHART:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_BAR);break;case GRAPHMATRIXHISTOGRAM:case GRAPHMATRIXVERTICALWATERFALL:case GRAPHMATRIXHORIZONTALWATERFALL:case GRAPHMATRIXVERTICALBOXPLOT:case GRAPHMATRIXHORIZONTALBOXPLOT:addPropertiesNode(defn,$GMH.PROP_SHAPE,$GMH.PROP_SHAPE_BAR);break;}addPropertiesNode(defn,$GMH.PROP_SUBTYPE,getDefaultSubtype(templateID));return defn;}function getDefaultSubtype(vt){var subType=$GMH.PROP_SUBTYPE_AUTOMATIC;switch(vt){case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALAREACLUSTERED:subType=$GMH.PROP_SUBTYPE_CLUSTERED;break;case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXVERTICALWATERFALL:case GRAPHMATRIXHORIZONTALWATERFALL:subType=$GMH.PROP_SUBTYPE_STACKED;break;case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREAPERCENT:subType=$GMH.PROP_SUBTYPE_PERCENT;break;case GRAPHMATRIXPIE:case GRAPHMATRIXRING:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:case GRAPHCOMBINATIONBARAREADUALAXIS:subType=$GMH.PROP_SUBTYPE_AUTOMATIC;break;}return subType;}function isValidUnit(object,type,definition){if(type===UNIT_TYPE_NONE){return false;}if(type===UNIT_TYPE_ANY){return true;}if((object.t===$DSSOBJ_TYPES.DssTypeMetric)&&(type===UNIT_TYPE_METRIC)){return true;}if((object.t!==$DSSOBJ_TYPES.DssTypeMetric)&&(type===UNIT_TYPE_NONMETRIC)){return true;}if(type===UNIT_TYPE_TOGGLE){var dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if((dropZone&&dropZone.t===UNIT_TYPE_METRIC)&&(object.t!==$DSSOBJ_TYPES.DssTypeMetric)){return true;}if((dropZone&&dropZone.t===UNIT_TYPE_NONMETRIC)&&(object.t===$DSSOBJ_TYPES.DssTypeMetric)){return true;}return false;}return false;}function isHorizontalGraphMatrix(templateID){var result=false;switch(templateID){case GRAPHMATRIXHORIZONTALBARCLUSTERED:case GRAPHMATRIXHORIZONTALBARSTACKED:case GRAPHMATRIXHORIZONTALBARPERCENT:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXHORIZONTALBARAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:result=true;break;default:break;}return result;}function isBubbleOrScatterGraphMatrix(templateID){var result=false;switch(templateID){case GRAPHMATRIXBUBBLECIRCLEMM:case GRAPHMATRIXBUBBLEGRIDCIRCLEAA:case GRAPHMATRIXBUBBLESQUAREAM:case GRAPHMATRIXBUBBLESQUAREMM:case GRAPHMATRIXBUBBLEGRIDSQUAREAA:case GRAPHMATRIXSCATTERCIRCLEMM:case GRAPHMATRIXSCATTERGRIDCIRCLEAA:case GRAPHMATRIXSCATTERSQUAREAM:case GRAPHMATRIXSCATTERSQUAREMM:case GRAPHMATRIXSCATTERGRIDSQUAREAA:result=true;break;default:break;}return result;}function isComboGraphMatrix(templateID){return(templateID===GRAPHCOMBINATIONBARAREA||templateID===GRAPHCOMBINATIONBARAREADUALAXIS);}function addAttributeToZone(newGMHelper,_rows,_cols,zone,dropZone){if(_rows.length+_cols.length>=dropZone.min){if(_cols.length){newGMHelper[zone].push(_cols.pop());}else{if(_rows.length){newGMHelper[zone].push(_rows.pop());}}}}function addAttributes(definition,newGMHelper,newTemplateID){var gsi=this.templateInfo,rows=gsi.rows,cols=gsi.cols,dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SLICE);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.sliceObjects.length){addAttributeToZone(newGMHelper,rows,cols,"sliceObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(dropZone&&(dropZone.type===UNIT_TYPE_NONMETRIC||dropZone.type===UNIT_TYPE_ANY)&&!newGMHelper.xAxisObjects.length){addAttributeToZone(newGMHelper,cols,rows,"xAxisObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);var insertNonMetric=dropZone&&((dropZone.type===UNIT_TYPE_NONMETRIC)||(dropZone.type===UNIT_TYPE_ANY));if(!insertNonMetric&&dropZone&&dropZone.type===UNIT_TYPE_TOGGLE&&newGMHelper.xAxisObjects.length){if(newGMHelper.xAxisObjects[0].t===4){insertNonMetric=true;}}if(insertNonMetric){addAttributeToZone(newGMHelper,rows,cols,"yAxisObjects",dropZone);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.breakByObjects.length){if(isHorizontalGraphMatrix(newTemplateID)){addAttributeToZone(newGMHelper,rows,cols,"breakByObjects",dropZone);}else{addAttributeToZone(newGMHelper,cols,rows,"breakByObjects",dropZone);}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);if(dropZone&&dropZone.type===UNIT_TYPE_NONMETRIC&&!newGMHelper.colorByObjects.length){if(newGMHelper.sliceObjects.length){newGMHelper.colorByObjects.push(newGMHelper.sliceObjects[0]);}else{if(rows.length+cols.length>=dropZone.min){if(isHorizontalGraphMatrix(newTemplateID)){addAttributeToZone(newGMHelper,rows,cols,"colorByObjects",dropZone);}else{addAttributeToZone(newGMHelper,cols,rows,"colorByObjects",dropZone);}}}}}function shouldShowMetricNames(newGMHelper){if(newGMHelper.getMetricCountInZone(newGMHelper.xAxisObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}if(newGMHelper.getMetricCountInZone(newGMHelper.yAxisObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}if(newGMHelper.angleObjects&&newGMHelper.getMetricCountInZone(newGMHelper.angleObjects)>METRIC_NAMES_VISIBLE_THRESH){return true;}return false;}function addMetricsKeyword(definition,oldGMHelper,newGMHelper){if(shouldShowMetricNames(newGMHelper)){if(!hasMetricInZone(newGMHelper.colorByObjects)){newGMHelper.secondaryMetricsDropZone=$GMH.PROP_COLORBY;}var dropZoneID=definition.MetricsDropZone;if(!dropZoneID||dropZoneID!=="null"){switch(dropZoneID){case METRICS_IN_NONE:newGMHelper.metricsDropZone="";break;case METRICS_IN_ANY:newGMHelper.metricsDropZone=$GMH.PROP_COLUMNS;break;default:newGMHelper.metricsDropZone=dropZoneID;break;}}}}function addMetrics(definition,newGMHelper,newTemplateID){var mx=this.templateInfo.mx,dropZone;if(!mx.length){return ;}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_ANGLE);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.angleObjects.length&&mx.length>=dropZone.min){newGMHelper.angleObjects.push(mx[0]);mx.splice(0,1);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.xAxisObjects.length&&mx.length>=dropZone.min){newGMHelper.xAxisObjects.push(mx[0]);mx.splice(0,1);}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);if(dropZone){var insertMetric=(dropZone.type===UNIT_TYPE_METRIC);if(!insertMetric&&dropZone.type===UNIT_TYPE_TOGGLE){if(!newGMHelper.xAxisObjects.length||newGMHelper.xAxisObjects[0].t!==4){insertMetric=true;}}if(insertMetric&&!newGMHelper.yAxisObjects.length){if(mx.length>=dropZone.min){newGMHelper.yAxisObjects.push(mx[0]);mx.splice(0,1);if(mx.length>0&&(newTemplateID===GRAPHCOMBINATIONBARAREA||newTemplateID===GRAPHCOMBINATIONBARAREADUALAXIS)){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},mx[0]));mx.splice(0,1);}}}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.colorByObjects.length){if(mx.length>0){newGMHelper.colorByObjects.push(mx[0]);this.markedObjects.push(mx[0]);}else{[{n:"sizeByObjects",fn:function(n){return newGMHelper[n].length;}},{n:"xAxisObjects",fn:function(n){return newGMHelper[n].length&&newGMHelper[n][0].t===4;}},{n:"yAxisObjects",fn:function(n){return newGMHelper[n].length&&newGMHelper[n][0].t===4;}}].forEach(function(item){if(item.fn(item.n)){var z=newGMHelper[item.n],colorByItem=$HASH.copy(z[z.length-1]);colorByItem.ax=1;newGMHelper.colorByObjects.push(colorByItem);}});}}dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SIZEBY);if(dropZone&&dropZone.type===UNIT_TYPE_METRIC&&!newGMHelper.sizeByObjects.length){if(mx.length){newGMHelper.sizeByObjects.push(mx[0]);this.markedObjects.push(mx[0]);}else{["colorByObjects","xAxisObjects","yAxisObjects"].forEach(function(n){var from=newGMHelper[n],sz=from.length;if(sz&&from[0].t===4){newGMHelper.sizeByObjects.push(from[sz-1]);}});}}}function addToTooltip(newGMHelper,items){var zones=["rowObjects","columnObjects","xAxisObjects","yAxisObjects","colorByObjects","breakByObjects","sizeByObjects","sliceObjects","angleObjects"];for(var ind=0;ind<items.length;ind++){var occured=0;for(var i=0;i<zones.length;i++){var zone=zones[i];zone=newGMHelper[zone];zone.forEach(function(unit){if(unit&&unit.did==items[ind].did){occured++;}});}if(occured===0&&items.length){newGMHelper.tooltipMetrics.push(items[ind]);}}}function isMetricUsed(did){var r=false;$ARR.forEach(this.markedObjects,function(obj){if(obj.did===did){r=true;return false;}});return r;}function addRowColumnAdditionalMetricsZones(newGMHelper){var ths=this,ti=this.templateInfo;ti.rows.forEach(function(obj){newGMHelper.rowObjects.push(obj);});ti.cols.forEach(function(obj){newGMHelper.columnObjects.push(obj);});ti.mx.forEach(function(obj){if(!isMetricUsed.call(ths,obj.did)){newGMHelper.tooltipMetrics.push(obj);}});}function addProperties(definition,helper){var props=definition.Properties,isNGM=this.newVizInfo.s==="NewGraphMatrixVisualizationStyle";if(props[$GMH.PROP_SHAPE]){helper.shape=props[$GMH.PROP_SHAPE];}if(props[$GMH.PROP_SUBTYPE]&&(isNGM||(helper.subtype===""||helper.subtype===$GMH.PROP_SUBTYPE_AUTOMATIC))){helper.subtype=props[$GMH.PROP_SUBTYPE];}}function addThresholds(node,newGMHelper,actions){if(newGMHelper.colorByObjects.length<=0){return ;}var templateMetric=newGMHelper.colorByObjects[0];if(templateMetric.t===$DSSOBJ_TYPES.DssTypeMetric){this.addThresholds(node,templateMetric,actions,undefined,undefined);}}function clearAllSubTotals(node,actions){var rows=(node.data.gts&&node.data.gts.row)||[];rows.forEach(function(r){if(r.otp===12&&r.ast&&r.ast.length){actions.push({act:"showDefinedSubtotals"});actions.push({act:"showTotals",unitId:r.id,unitType:r.otp,subtotalType:[],clearSubtotalType:r.ast.map(function(tt){return tt.t;})});}});}function hasMetricInZone(zoneObjects){var i,unit;for(i=0;i<zoneObjects.length;i++){unit=zoneObjects[i];if(unit.t===$DSSOBJ_TYPES.DssTypeMetric){return true;}}return false;}function addSubTotalOnSliceAttr(newGMHelper){var unit,i,firstAttribute,doesSliceHaveAttribute=false,doesXYSizeByHaveMetric;for(i=0;i<newGMHelper.sliceObjects.length;i++){unit=newGMHelper.sliceObjects[i];if(unit.t===$DSSOBJ_TYPES.DssTypeAttribute){firstAttribute=unit;doesSliceHaveAttribute=true;break;}}if(!doesSliceHaveAttribute){return ;}doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.xAxisObjects);if(!doesXYSizeByHaveMetric){doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.yAxisObjects);}if(!doesXYSizeByHaveMetric){doesXYSizeByHaveMetric=hasMetricInZone(newGMHelper.sizeByObjects);}if(!doesXYSizeByHaveMetric){return ;}}function isVerticalGraphMatrix(templateID){switch(templateID){case GRAPHMATRIXVERTICALBARCLUSTERED:case GRAPHMATRIXVERTICALBARSTACKED:case GRAPHMATRIXVERTICALBARPERCENT:case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXVERTICALBARAUTOMATIC:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXVERTICALAREAAUTOMATIC:return true;default:return false;}}function isVerticalGraphMatrix2(node){if(!node.data.dz){return false;}var dz=node.data.dz,$GH=mstrmojo.vi.viz.GraphMatrixHelper,xAxis=dz[$GH.PROP_XAXIS],xAxisList=xAxis.TemplateUnit||xAxis.TemplateMetric||[],yAxis=dz[$GH.PROP_YAXIS],yAxisList=yAxis.TemplateUnit||yAxis.TemplateMetric||[];if(yAxisList.length>0&&yAxisList[0].t===$DSSOBJ_TYPES.DssTypeMetric){if(xAxisList.length===0||xAxisList[0].t!==$DSSOBJ_TYPES.DssTypeMetric){return true;}}return false;}function isHorizontalGraphMatrix2(node){if(!node.data.dz){return false;}var dz=node.data.dz,$GH=mstrmojo.vi.viz.GraphMatrixHelper,xAxis=dz[$GH.PROP_XAXIS],xAxisList=[],yAxis=dz[$GH.PROP_YAXIS],yAxisList=[];if(xAxis){xAxisList=xAxis.TemplateUnit||xAxis.TemplateMetric||[];}if(yAxis){yAxisList=yAxis.TemplateUnit||yAxis.TemplateMetric||[];}if(xAxisList.length>0&&(xAxisList[0].t===$DSSOBJ_TYPES.DssTypeMetric)){if(yAxisList.length===0||(yAxisList[0].t!==$DSSOBJ_TYPES.DssTypeMetric)){return true;}}return false;}function isABLGraphMatrix(templateID){return isVerticalGraphMatrix(templateID)||isHorizontalGraphMatrix(templateID);}function isLineChart(templateID){switch(templateID){case GRAPHMATRIXVERTICALLINECLUSTERED:case GRAPHMATRIXVERTICALLINESTACKED:case GRAPHMATRIXVERTICALLINEPERCENT:case GRAPHMATRIXHORIZONTALLINECLUSTERED:case GRAPHMATRIXHORIZONTALLINESTACKED:case GRAPHMATRIXHORIZONTALLINEPERCENT:case GRAPHMATRIXVERTICALLINEAUTOMATIC:case GRAPHMATRIXHORIZONTALLINEAUTOMATIC:return true;default:return false;}}function isAreaChart(templateID){switch(templateID){case GRAPHMATRIXVERTICALAREACLUSTERED:case GRAPHMATRIXVERTICALAREASTACKED:case GRAPHMATRIXVERTICALAREAPERCENT:case GRAPHMATRIXHORIZONTALAREACLUSTERED:case GRAPHMATRIXHORIZONTALAREASTACKED:case GRAPHMATRIXHORIZONTALAREAPERCENT:case GRAPHMATRIXVERTICALAREAAUTOMATIC:case GRAPHMATRIXHORIZONTALAREAAUTOMATIC:return true;default:return false;}}function getNumericAxis(oldGMHelper,node,zone){var z,secCnt=0,primCnt=0;if(zone){z=zone;}else{if(isHorizontalGraphMatrix2(node)){z="xAxisObjects";}else{z="yAxisObjects";}}oldGMHelper[z].forEach(function(m){if(m.ax===AXIS_PRIMARY){primCnt++;}else{if(m.ax===AXIS_SECONDARY){secCnt++;}}});if(secCnt&&primCnt){return -1;}else{if(secCnt){return AXIS_SECONDARY;}else{return AXIS_PRIMARY;}}}function swapDropZoneUnits(oldTemplateID,newTemplateID,oldGMHelper,newGMHelper,node){if(this.isGraphMatrix(oldTemplateID)){if((isHorizontalGraphMatrix2(node)&&isVerticalGraphMatrix(newTemplateID))||(isHorizontalGraphMatrix(newTemplateID)&&isVerticalGraphMatrix2(node))){var i;for(i=0;i<oldGMHelper.xAxisObjects.length;i++){newGMHelper.yAxisObjects.push(oldGMHelper.xAxisObjects[i]);removeFromCollection.call(this,oldGMHelper.xAxisObjects[i]);}for(i=0;i<oldGMHelper.yAxisObjects.length;i++){newGMHelper.xAxisObjects.push(oldGMHelper.yAxisObjects[i]);removeFromCollection.call(this,oldGMHelper.yAxisObjects[i]);}}}}function applyMetricNamesPie(oldGMHelper,newGMHelper,breakByDisabled){if(shouldShowMetricNames(newGMHelper)){if(oldGMHelper.secondaryMetricsDropZone){newGMHelper.secondaryMetricsDropZone=oldGMHelper.secondaryMetricsDropZone;}if(!breakByDisabled&&oldGMHelper.metricsDropZone==="BreakBy"){newGMHelper.metricsDropZone="BreakBy";}else{if(newGMHelper.angleObjects.length>1){newGMHelper.metricsDropZone="Rows";}else{if(oldGMHelper.metricsDropZone){newGMHelper.metricsDropZone=oldGMHelper.metricsDropZone;}else{if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{newGMHelper.metricsDropZone="Rows";}}}}}else{newGMHelper.metricsDropZone="";newGMHelper.secondaryMetricsDropZone="";}}function applyMetricNamesBubbleToABLCombo(oldGMHelper,newGMHelper){if(shouldShowMetricNames(newGMHelper)){if(oldGMHelper.secondaryMetricsDropZone){newGMHelper.secondaryMetricsDropZone=oldGMHelper.secondaryMetricsDropZone;}if(oldGMHelper.metricsDropZone==="BreakBy"){newGMHelper.metricsDropZone="BreakBy";}else{newGMHelper.metricsDropZone="Rows";}}else{newGMHelper.metricsDropZone="";newGMHelper.secondaryMetricsDropZone="";}}function applyMetricNamesGM(oldGMHelper,newGMHelper){if(shouldShowMetricNames(newGMHelper)){if(oldGMHelper.secondaryMetricsDropZone){newGMHelper.secondaryMetricsDropZone=oldGMHelper.secondaryMetricsDropZone;}if(oldGMHelper.metricsDropZone){if(oldGMHelper.metricsDropZone==="SliceBy"){newGMHelper.metricsDropZone="BreakBy";}else{newGMHelper.metricsDropZone=oldGMHelper.metricsDropZone;}}else{if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{newGMHelper.metricsDropZone="Rows";}}}else{newGMHelper.metricsDropZone="";newGMHelper.secondaryMetricsDropZone="";}}function transferUnits(definition,oldGMHelper,newGMHelper,oldTemplateID,actions,node){var dropZone,i,obj,oldHelper,oldIsMap=(oldTemplateID===$VIZTEMPLATES.GOOGLEMAP||oldTemplateID===$VIZTEMPLATES.ESRIMAP);if(oldTemplateID===$VIZTEMPLATES.HEATMAP){oldHelper=new $VIZ.HeatMapVisualizationHelper();oldHelper.setData(node.data.dz);}else{if(oldIsMap){var helperCls=$VIZ.MapHelper;oldHelper=new helperCls({data:node.data});oldHelper.setWidget(this.vis);}}if(this.isGraphMatrix(oldTemplateID)){if(oldGMHelper.xAxisObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_XAXIS);if(!dropZone||isValidUnit(oldGMHelper.xAxisObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.xAxisObjects.length;i++){obj=oldGMHelper.xAxisObjects[i];newGMHelper.xAxisObjects.push(obj);removeFromCollection.call(this,obj);}}}if(oldGMHelper.yAxisObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_YAXIS);if(!dropZone||isValidUnit(oldGMHelper.yAxisObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.yAxisObjects.length;i++){obj=oldGMHelper.yAxisObjects[i];newGMHelper.yAxisObjects.push(obj);removeFromCollection.call(this,obj);}}}if(oldGMHelper.breakByObjects.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY);if(!dropZone||isValidUnit(oldGMHelper.breakByObjects[0],dropZone.type,definition)){for(i=0;i<oldGMHelper.breakByObjects.length;i++){obj=oldGMHelper.breakByObjects[i];newGMHelper.breakByObjects.push(obj);removeFromCollection.call(this,obj);}}}}var colorByUnits=[];if(this.isGraphMatrix(oldTemplateID)){for(i=0;i<oldGMHelper.colorByObjects.length;i++){colorByUnits.push(oldGMHelper.colorByObjects[i]);}}else{if(oldTemplateID===$VIZTEMPLATES.HEATMAP){oldHelper.colorBy.forEach(function(unit){colorByUnits.push(unit);});}else{if(oldIsMap&&oldHelper.showColorByZone()){var cbUnit=oldHelper.getColorByUnit();if(cbUnit){colorByUnits.push(cbUnit);}}}}if(colorByUnits.length){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_COLORBY);var addColorBy=(!dropZone||isValidUnit(colorByUnits[0],dropZone.type,definition));if(addColorBy){for(i=0;i<colorByUnits.length;i++){obj=colorByUnits[i];newGMHelper.colorByObjects.push(obj);this.markedObjects.push(obj);}}}var sizeByUnits=[];if(this.isGraphMatrix(oldTemplateID)){for(i=0;i<oldGMHelper.sizeByObjects.length;i++){sizeByUnits.push(oldGMHelper.sizeByObjects[i]);}}else{if(oldTemplateID===$VIZTEMPLATES.HEATMAP){if(oldHelper.sizeByMetric){sizeByUnits.push(oldHelper.sizeByMetric);}}else{if(oldIsMap&&oldHelper.showSizeByZone()){var sbUnit=oldHelper.getSizeByUnit();if(sbUnit){sizeByUnits.push(sbUnit);}}}}if(sizeByUnits.length>0){dropZone=getDropZoneFromDefn(definition,$GMH.PROP_SIZEBY);var shape=definition.Properties[$GMH.PROP_SHAPE],addSizeBy;addSizeBy=(shape!=="Area")&&(!dropZone||isValidUnit(sizeByUnits,dropZone.type,definition));if(addSizeBy){for(i=0;i<sizeByUnits.length;i++){obj=sizeByUnits[i];newGMHelper.sizeByObjects.push(obj);this.markedObjects.push(obj);}}}}function handleCombinedTooltipZone(newGMHelper,newIsNGM){if(newIsNGM){var zone,j,unit,metrics=[],attributes=[];["columnObjects","rowObjects","xAxisObjects","yAxisObjects","breakByObjects","colorByObjects","sizeByObjects"].forEach(function(z){zone=newGMHelper[z];for(j=0;j<zone.length;j++){unit=zone[j];if(getUnitIndexInZone(newGMHelper.tooltipMetrics,unit)===-1){if(unit.t===12){attributes.push(unit);}else{metrics.push(unit);}}}});newGMHelper.tooltipMetrics=attributes.concat(newGMHelper.tooltipMetrics).concat(metrics);}else{var filtered=[];for(var i=0;i<newGMHelper.tooltipMetrics.length;i++){if(newGMHelper.tooltipMetrics[i].t===$DSSOBJ_TYPES.DssTypeMetric){filtered.push(newGMHelper.tooltipMetrics[i]);}}newGMHelper.tooltipMetrics=[];addToTooltip(newGMHelper,filtered);}}function transitionFromGridToGridChart(newGMHelper){var ti=this.templateInfo,mx=ti.mx,dz=this.vis.model.data.gsi,definition=this.definition;if(ti.cols.length&&ti.rows.length){newGMHelper.xAxisObjects.push(ti.cols.pop());newGMHelper.yAxisObjects.push(ti.rows.pop());hMoveUnitsToZoneByType(ti.cols,newGMHelper.columnObjects);hMoveUnitsToZoneByType(ti.rows,newGMHelper.rowObjects);}else{var gridAttributes=ti.rows.concat(ti.cols);if(gridAttributes.length){newGMHelper.xAxisObjects.push(gridAttributes.pop());}if(gridAttributes.length){newGMHelper.yAxisObjects.push(gridAttributes.pop());}hMoveUnitsToZoneByType(gridAttributes,newGMHelper.rowObjects);}if(mx.length>1){newGMHelper.sizeByObjects.push(mx.splice(0,1)[0]);}else{if(mx.length===1&&newGMHelper.xAxisObjects.length){newGMHelper.sizeByObjects.push(mx.splice(0,1)[0]);newGMHelper.colorByObjects.push(newGMHelper.xAxisObjects[0]);}}if(mx.length){newGMHelper.colorByObjects.push(mx.splice(0,1)[0]);hMoveUnitsToZoneByType(mx,newGMHelper.tooltipMetrics);}}function transitionGridtoABL(newGMHelper){var ti=this.templateInfo,mx=ti.mx,dz=this.vis.model.data.gsi,definition=this.definition;if(ti.cols.length&&ti.rows.length){var z;dz.rows.forEach(function(m){if(m.n==="Metrics"){z="Rows";}});dz.cols.forEach(function(m){if(m.n==="Metrics"){z="Columns";}});newGMHelper.metricsDropZone=z;if(z==="Rows"){if(dz.rows[dz.rows.length-1].n==="Metrics"){mx.forEach(function(m){newGMHelper.yAxisObjects.push(m);});newGMHelper.xAxisObjects.push(ti.cols.pop());ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}else{newGMHelper.yAxisObjects.push(dz.rows.pop());ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});mx.forEach(function(m){newGMHelper.xAxisObjects.push(m);});ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}}else{if(z==="Columns"){if(dz.cols[dz.cols.length-1].n==="Metrics"){mx.forEach(function(m){newGMHelper.xAxisObjects.push(m);});newGMHelper.yAxisObjects.push(ti.rows.pop());ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}else{if(dz.cols.length){newGMHelper.xAxisObjects.push(dz.cols.pop());}ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});mx.forEach(function(m){newGMHelper.yAxisObjects.push(m);});}}}}else{mx.forEach(function(m){newGMHelper.yAxisObjects.push(m);});if(ti.cols.length+ti.rows.length===1){addAttributeToZone(newGMHelper,ti.cols,ti.rows,"xAxisObjects",getDropZoneFromDefn(definition,$GMH.PROP_XAXIS));}else{var gridAttributes=ti.rows.concat(ti.cols);if(gridAttributes.length){newGMHelper.breakByObjects.push(gridAttributes.pop());}if(gridAttributes.length){newGMHelper.xAxisObjects.push(gridAttributes.pop());}gridAttributes.forEach(function(attr){newGMHelper.columnObjects.push(attr);});}if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{if(newGMHelper.yAxisObjects.length>1&&newGMHelper.yAxisObjects[0].t===4){newGMHelper.metricsDropZone="Rows";}else{newGMHelper.metricsDropZone="";}}newGMHelper.secondaryMetricsDropZone="";}}function transitionFromGridToBubble(newGMHelper){var ti=this.templateInfo,mx=ti.mx,dz=this.vis.model.data.gsi,definition=this.definition;for(var i=0;i<(mx.length/2);i++){newGMHelper.yAxisObjects.push(mx[i]);}for(i=Math.ceil(mx.length/2);i<mx.length;i++){newGMHelper.xAxisObjects.push(mx[i]);}if(ti.cols.length&&ti.rows.length){var z;dz.rows.forEach(function(m){if(m.n==="Metrics"){z="Rows";}});dz.cols.forEach(function(m){if(m.n==="Metrics"){z="Columns";}});newGMHelper.metricsDropZone=z;if(z==="Rows"){if(dz.rows[dz.rows.length-1].n==="Metrics"){newGMHelper.breakByObjects.push(ti.cols.pop());ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}else{var i=0,atMetricNames=false;while(atMetricNames===false){if(dz.rows[i].n!=="Metrics"){newGMHelper.rowObjects.push(ti.rows[i]);i++;}else{atMetricNames=true;}}while(i<ti.rows.length){newGMHelper.breakByObjects.push(ti.rows[i]);i++;}}ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}else{if(z==="Columns"){if(dz.cols[dz.cols.length-1].n==="Metrics"){mx.forEach(function(m){newGMHelper.xAxisObjects.push(m);});newGMHelper.breakByObjects.push(ti.rows.pop());ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}else{var i=0,atMetricNames=false;while(atMetricNames===false){if(dz.cols[i].n!=="Metrics"){newGMHelper.columnObjects.push(ti.cols[i]);i++;}else{atMetricNames=true;}}while(i<ti.cols.length){newGMHelper.breakByObjects.push(ti.cols[i]);i++;}}ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}}}else{if(ti.cols.length+ti.rows.length===1){addAttributeToZone(newGMHelper,ti.cols,ti.rows,"breakByObjects",getDropZoneFromDefn(definition,$GMH.PROP_BREAKBY));}else{if(ti.cols.length+ti.rows.length>1){var gridAttributes=ti.rows.concat(ti.cols);if(gridAttributes.length){newGMHelper.breakByObjects=gridAttributes.splice(-2,2);gridAttributes.forEach(function(attr){newGMHelper.columnObjects.push(attr);});}}}if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{if(newGMHelper.yAxisObjects.length>1&&newGMHelper.yAxisObjects[0].t===4){newGMHelper.metricsDropZone="Rows";}else{newGMHelper.metricsDropZone="";}}newGMHelper.secondaryMetricsDropZone="";}}function transitionFromGridToPie(newGMHelper){var ti=this.templateInfo,mx=ti.mx,dz=this.vis.model.data.gsi,definition=this.definition;mx.forEach(function(m){newGMHelper.angleObjects.push(m);});if(ti.cols.length&&ti.rows.length){var z;dz.rows.forEach(function(m){if(m.n==="Metrics"){z="Rows";}});dz.cols.forEach(function(m){if(m.n==="Metrics"){z="Columns";}});newGMHelper.metricsDropZone=z;if(z==="Rows"){if(dz.rows[dz.rows.length-1].n==="Metrics"){newGMHelper.sliceObjects.push(ti.cols.pop());ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}else{newGMHelper.sliceObjects.push(ti.rows.pop());var i=0,atMetricNames=false;while(atMetricNames===false){if(dz.rows[i].n!=="Metrics"){newGMHelper.rowObjects.push(ti.rows[i]);i++;}else{atMetricNames=true;}}while(i<ti.rows.length){newGMHelper.xAxisObjects.push(ti.rows[i]);i++;}}ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}else{if(z==="Columns"){if(dz.cols[dz.cols.length-1].n==="Metrics"){newGMHelper.sliceObjects.push(ti.rows.pop());ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}else{newGMHelper.sliceObjects.push(ti.cols.pop());var i=0,atMetricNames=false;while(atMetricNames===false){if(dz.cols[i].n!=="Metrics"){newGMHelper.columnObjects.push(ti.cols[i]);i++;}else{atMetricNames=true;}}while(i<ti.cols.length){newGMHelper.xAxisObjects.push(ti.cols[i]);i++;}}ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});}}}else{var gridAttributes=ti.rows.concat(ti.cols);if(gridAttributes.length){newGMHelper.sliceObjects.push(gridAttributes.pop());}if(gridAttributes.length){newGMHelper.xAxisObjects.push(gridAttributes.pop());gridAttributes.forEach(function(attr){newGMHelper.columnObjects.push(attr);});}}if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{if(newGMHelper.yAxisObjects.length>1&&newGMHelper.yAxisObjects[0].t===4){newGMHelper.metricsDropZone="Rows";}else{if(newGMHelper.angleObjects.length>1){newGMHelper.metricsDropZone="Rows";}else{newGMHelper.metricsDropZone="";}}}newGMHelper.secondaryMetricsDropZone="";}function getUnitIndexInZone(zone,item){return $ARR.find(zone,"did",item.did);}function isMetric(item){return item.t===$DSSOBJ_TYPES.DssTypeMetric;}function isAttribute(item){return item&&item.t!==$DSSOBJ_TYPES.DssTypeMetric;}function hMoveUnitsToZoneByType(objList,destZone,type){var result=false,fnMatch=function(){return true;};if(type){fnMatch=type===$DSSOBJ_TYPES.DssTypeMetric?isMetric:isAttribute;}if(objList.length&&(fnMatch(objList[0])||type===undefined)){objList.forEach(function(obj){if(getUnitIndexInZone(destZone,obj)===-1){destZone.push(obj);result=true;}});}return result;}function getZoneByType(type,objList,obj2List){var result=[],fnMatch=type===$DSSOBJ_TYPES.DssTypeMetric?isMetric:isAttribute;if(obj2List!==undefined&&obj2List.length){obj2List.forEach(function(obj){if(fnMatch(obj)){result.push(obj);}});}if(objList.length){objList.forEach(function(obj){if(fnMatch(obj)){result.push(obj);}});}return result;}function copyZones(zones,oldGMHelper,newGMHelper){zones.forEach(function(zoneObj){hMoveUnitsToZoneByType(oldGMHelper[zoneObj],newGMHelper[zoneObj]);});}function hMoveLastTooltipMetricToZone(toolTipMetrics,destZone){if(toolTipMetrics.length){destZone.push(toolTipMetrics.pop());}}function hCopyFirstMetricToZoneIfExist(objList,destZone){if(objList.length&&objList[0].t===4){destZone.push(objList[0]);return true;}return false;}function transitionFromHistogramToWaterfall(oldGMHelper,newGMHelper){if(oldGMHelper.xAxisObjects.length>1){newGMHelper.breakByObjects.push(oldGMHelper.xAxisObjects.pop());}hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects);}function transitionHeatmapToHistogram(newGMHelper,node){var oldHMHelper,objList,anObj;newGMHelper.xAxisObjects=[];newGMHelper.yAxisObjects=[];newGMHelper.tooltipMetrics=[];oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length&&objList[0].t!==4){hMoveUnitsToZoneByType(objList,newGMHelper.xAxisObjects);}objList=oldHMHelper.tooltipMetrics;anObj=oldHMHelper.sizeByMetric||oldHMHelper.getFirstColorByUnit(true)||objList.pop();if(anObj){newGMHelper.yAxisObjects.push(anObj);}}function transitionHeatmapToBoxplot_Waterfall(newGMHelper,node,newIsBoxPlot){var oldHMHelper,objList,arr_keys=[];oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length===1){newGMHelper.xAxisObjects.push(objList.pop());}else{if(objList.length>1){newGMHelper.breakByObjects.push(objList.pop());newGMHelper.xAxisObjects.push(objList.pop());newGMHelper.columnObjects=objList;}}if(newIsBoxPlot){if(newGMHelper.xAxisObjects[0]){arr_keys.push(newGMHelper.xAxisObjects[0].did);}$ARR.forEach(newGMHelper.columnObjects,function(unit){arr_keys.push(unit.did);});}if(oldHMHelper.sizeByMetric){newGMHelper.yAxisObjects.push(oldHMHelper.sizeByMetric);}if(oldHMHelper.colorBy){if(newGMHelper.isMetric(oldHMHelper.colorBy[0])){if(!oldHMHelper.sizeByMetric||oldHMHelper.sizeByMetric.did!==oldHMHelper.colorBy[0].did){newGMHelper.yAxisObjects.push(oldHMHelper.colorBy[0]);}}else{if(newIsBoxPlot){$ARR.forEach(oldHMHelper.colorBy,function(obj){if(arr_keys.indexOf(obj.did)>-1){newGMHelper.colorByObjects.push(obj);}});}}}if(!newGMHelper.yAxisObjects.length&&oldHMHelper.tooltipMetrics.length){newGMHelper.yAxisObjects.push(oldHMHelper.tooltipMetrics.shift());}newGMHelper.metricsDropZone="Rows";}function transitionHeatmapToABL(newGMHelper,node){var oldHMHelper,objList;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length===1){newGMHelper.xAxisObjects.push(objList[0]);}else{if(objList.length===2){newGMHelper.xAxisObjects.push(objList[0]);newGMHelper.breakByObjects.push(objList[1]);}else{if(objList.length>2){newGMHelper.breakByObjects.push(objList.pop());newGMHelper.xAxisObjects.push(objList.pop());newGMHelper.columnObjects=objList;}}}if(oldHMHelper.sizeByMetric){newGMHelper.yAxisObjects.push(oldHMHelper.sizeByMetric);}newGMHelper.colorByObjects=oldHMHelper.colorBy;newGMHelper.tooltipMetrics=oldHMHelper.tooltipMetrics;}function transitionHeatmapToBubble(newGMHelper,node){var oldHMHelper,objList,anObj;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.tooltipMetrics;anObj=oldHMHelper.sizeByMetric||oldHMHelper.getFirstColorByUnit(true)||objList.shift();if(anObj){newGMHelper.yAxisObjects.push(anObj);}anObj=oldHMHelper.getFirstColorByUnit(true);if(!anObj||newGMHelper.yAxisObjects.length&&newGMHelper.yAxisObjects[0].did===anObj.did){anObj=objList.shift();}if(anObj){newGMHelper.xAxisObjects.push(anObj);}hMoveUnitsToZoneByType(oldHMHelper.groupingObjects,newGMHelper.breakByObjects);hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionNetworkToBubble(newGMHelper,node){var oldHelper,anObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);var mx=oldHelper.getNetworkMetrics();anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.xAxisObjects.push(anObj);}anObj=mx[0];if(anObj){newGMHelper.yAxisObjects.push(anObj);}anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.sizeByObjects.push(anObj);}anObj=oldHelper.fromItemAttribute;if(anObj){newGMHelper.breakByObjects.push(anObj);}anObj=oldHelper.toItemAttribute;if(anObj){newGMHelper.rowObjects.push(anObj);}hMoveUnitsToZoneByType(mx,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionFromBubbleToABL(oldGMHelper,newGMHelper){var objList=oldGMHelper.breakByObjects;if(objList.length){newGMHelper.xAxisObjects.push(objList[0]);for(var i=1;i<objList.length;i++){newGMHelper.breakByObjects.push(objList[i]);}hMoveUnitsToZoneByType(oldGMHelper.columnObjects,newGMHelper.columnObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.rowObjects,newGMHelper.rowObjects,$DSSOBJ_TYPES.DssTypeAttribute);}else{if(oldGMHelper.columnObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{newGMHelper.xAxisObjects.push(oldGMHelper.rowObjects.pop());}}hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);var i=0;while(i<newGMHelper.yAxisObjects.length){newGMHelper.yAxisObjects[i].ax=AXIS_PRIMARY;i++;}newGMHelper.metricShapes="{}";if(oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.sizeByObjects.splice(0,1)[0]);hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.tooltipMetrics);}copyZones(["tooltipMetrics","colorByObjects","columnObjects","rowObjects"],oldGMHelper,newGMHelper);applyMetricNamesBubbleToABLCombo(oldGMHelper,newGMHelper);}function transitionImageLayoutOrMapToBubble(newGMHelper,geoObj,sizeByObj,colorByObj,tooltips,isMap){var xAxisObj,yAxisObj,firstTooltip,firstTooltipIndex=-1,tooltipCount=tooltips?tooltips.length:0,colorBy,sizeBy,tooltipsCopy=tooltips.concat([]),tooltipUsed=false;colorBy=(colorByObj&&newGMHelper.isMetric(colorByObj))?colorByObj:undefined;for(var i=0;i<tooltipCount;i++){if(newGMHelper.isMetric(tooltips[i])){firstTooltip=tooltips[i];firstTooltipIndex=i;break;}}xAxisObj=sizeByObj||colorBy;if(!xAxisObj&&firstTooltip){xAxisObj=firstTooltip;tooltipUsed=true;}if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}yAxisObj=colorBy||firstTooltip;if(yAxisObj&&yAxisObj.did!==xAxisObj.did){newGMHelper.yAxisObjects.push(yAxisObj);if(!colorBy){tooltipUsed=true;}}if(isMap){sizeBy=xAxisObj;}else{sizeBy=firstTooltip||colorBy||sizeByObj;if(firstTooltip){tooltipUsed=true;}}if(sizeBy){newGMHelper.sizeByObjects.push(sizeBy);}if(geoObj){newGMHelper.breakByObjects.push(geoObj);}if(colorByObj){newGMHelper.colorByObjects.push(colorByObj);}if(tooltipUsed){tooltipsCopy.splice(firstTooltipIndex,1);}hMoveUnitsToZoneByType(tooltipsCopy,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionMapToBubble(oldTemplateID,newGMHelper){var oldHelper=new $VIZ.MapHelper(),topLayer=this.vis.getTopLayerHost();oldHelper.setWidget(topLayer);transitionImageLayoutOrMapToBubble(newGMHelper,oldHelper.getGeoUnit(),oldHelper.getSizeByUnit(),oldHelper.getColorByUnit(),oldHelper.getTooltipUnits(),true);}function transitionImageLayoutToBubble(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToBubble(newGMHelper,oldHelper.geoAttribute,oldHelper.sizeByMetric,oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionFromABLToBubble(oldGMHelper,newGMHelper,node){var axisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects,oldGMHelper.yAxisObjects);if(axisAttributes.length){hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);}else{if(oldGMHelper.breakByObjects.length===0){var zoneAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.columnObjects,oldGMHelper.rowObjects);if(zoneAttributes.length){if(oldGMHelper.columnObjects.length){newGMHelper.breakByObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.breakByObjects.push(oldGMHelper.rowObjects.pop());}}}}}var yMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects),xMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects);var z=yMetrics.length?"yAxisObjects":"xAxisObjects";var notZ=xMetrics.length?"yAxisObjects":"xAxisObjects";if(yMetrics.length+xMetrics.length===1){newGMHelper[z].push(oldGMHelper[z].pop());if(oldGMHelper.sizeByObjects.length==0){if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){hMoveUnitsToZoneByType(oldGMHelper.colorByObjects,newGMHelper[notZ],$DSSOBJ_TYPES.DssTypeMetric);}else{newGMHelper[notZ].push(oldGMHelper.tooltipMetrics.pop());}}else{hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper[notZ],$DSSOBJ_TYPES.DssTypeMetric);}}else{if(yMetrics.length+xMetrics.length!==0){var i=Math.ceil(oldGMHelper[z].length/2);for(var a=0;a<i;a++){newGMHelper[notZ].push(oldGMHelper[z][a]);}for(i;i<oldGMHelper[z].length;i++){newGMHelper[z].push(oldGMHelper[z][i]);}}else{var colorByMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.colorByObjects);if(oldGMHelper.sizeByObjects.length&&colorByMetrics.length){hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.colorByObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);}else{hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.colorByObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);}}}copyZones(["tooltipMetrics","sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],oldGMHelper,newGMHelper);applyMetricNamesGM(oldGMHelper,newGMHelper);}function populateAngle(oldGMHelper,newGMHelper,isGridChart){if(oldGMHelper.sizeByObjects.length){hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.angleObjects);}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){newGMHelper.angleObjects.push(oldGMHelper.colorByObjects[0]);}else{if(oldGMHelper.xAxisObjects.length&&oldGMHelper.xAxisObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.angleObjects);oldGMHelper.xAxisObjects=[];hMoveUnitsToZoneByType(newGMHelper.breakByObjects,newGMHelper.sliceObjects);}if(oldGMHelper.yAxisObjects.length&&oldGMHelper.yAxisObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.angleObjects);oldGMHelper.yAxisObjects=[];hMoveUnitsToZoneByType(newGMHelper.breakByObjects,newGMHelper.sliceObjects);}else{if(isGridChart){if(oldGMHelper.tooltipMetrics.length){newGMHelper.angleObjects.push(oldGMHelper.tooltipMetrics.splice(0,1)[0]);}}}}}}function breakByDisabledPie(newGMHelper){var axisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,newGMHelper.xAxisObjects,newGMHelper.yAxisObjects);if(!axisMetrics.length){hMoveUnitsToZoneByType(newGMHelper.breakByObjects,newGMHelper.sliceObjects);return true;}return false;}function transitionFromGridChartToABL(oldGMHelper,newGMHelper){var fnFindMetric=function(){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects[0];}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects[0];}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}};var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects),mx;if(xAxisAttributes.length>0){if(xAxisAttributes.length>1&&!yAxisAttributes.length){newGMHelper.breakByObjects.push(oldGMHelper.xAxisObjects.pop());}hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);mx=fnFindMetric();if(mx){newGMHelper.yAxisObjects.push(mx);}}else{if(yAxisAttributes.length>0){if(yAxisAttributes.length>1){newGMHelper.breakByObjects.push(oldGMHelper.yAxisObjects.pop());}hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);mx=fnFindMetric();if(mx){newGMHelper.xAxisObjects.push(mx);}}else{if(oldGMHelper.breakByObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.breakByObjects.splice(0,1)[0]);mx=fnFindMetric();if(mx){newGMHelper.yAxisObjects.push(mx);}}else{if(oldGMHelper.columnObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());mx=fnFindMetric();if(mx){newGMHelper.yAxisObjects.push(mx);}}else{if(oldGMHelper.rowObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());mx=fnFindMetric();if(mx){newGMHelper.xAxisObjects.push(mx);}}else{mx=fnFindMetric();if(mx){newGMHelper.yAxisObjects.push(mx);}}}}}}copyZones(["colorByObjects","columnObjects","rowObjects","sizeByObjects","tooltipMetrics","breakByObjects"],oldGMHelper,newGMHelper);}function transitionFromGridChartToBubble(oldGMHelper,newGMHelper){var fnFindMetric=function(){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects.pop();}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects.pop();}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}};hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);if(!newGMHelper.breakByObjects.length){if(oldGMHelper.breakByObjects.length){hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.breakByObjects);}else{if(oldGMHelper.columnObjects.length){newGMHelper.breakByObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.breakByObjects.push(oldGMHelper.rowObjects.pop());}}}}copyZones(["sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],oldGMHelper,newGMHelper);var mx=fnFindMetric();if(mx){newGMHelper.yAxisObjects.push(mx);mx=fnFindMetric();if(mx){newGMHelper.xAxisObjects.push(mx);}}hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics);}function transitionFromGridChartToPie(oldGMHelper,newGMHelper){var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects);if(xAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.xAxisObjects.pop());}else{if(yAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.yAxisObjects.pop());}else{if(oldGMHelper.breakByObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.breakByObjects.splice(0,1)[0]);}else{if(oldGMHelper.columnObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.rowObjects.pop());}}}}}hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);copyZones(["sizeByObjects","colorByObjects","columnObjects","rowObjects","breakByObjects"],oldGMHelper,newGMHelper);populateAngle(oldGMHelper,newGMHelper,true);hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics);}function transitionHeatmapToGridChart(newGMHelper,node){var oldHMHelper,objList,anObj;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length&&!newGMHelper.isMetric(objList[0])){newGMHelper.xAxisObjects.push(objList.pop());if(objList.length){newGMHelper.yAxisObjects.push(objList.pop());}}hMoveUnitsToZoneByType(oldHMHelper.groupingObjects,newGMHelper.columnObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);anObj=oldHMHelper.sizeByMetric;if(anObj){newGMHelper.sizeByObjects.push(anObj);}hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionImageLayoutOrMapToGridChart(newGMHelper,xAxisObj,sizeByObj,colorByObj,tooltips){var tooltipCount=tooltips?tooltips.length:0;if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}for(var i=0;i<tooltipCount;i++){if(!newGMHelper.isMetric(tooltips[i])){newGMHelper.yAxisObjects.push(tooltips[i]);}else{if(newGMHelper.isMetric(tooltips[i])){newGMHelper.tooltipMetrics.push(tooltips[i]);}}}if(colorByObj){newGMHelper.colorByObjects.push(colorByObj);}}function transitionMapToGridChart(oldTemplateID,newGMHelper){var oldHelper=new $VIZ.MapHelper(),topLayer=this.vis.getTopLayerHost();oldHelper.setWidget(topLayer);transitionImageLayoutOrMapToGridChart(newGMHelper,oldHelper.getGeoUnit(),oldHelper.getSizeByUnit(),oldHelper.getColorByUnit(),oldHelper.getTooltipUnits());}function bubbleToGraphMatrixPie(oldTemplateID,oldGMHelper,newGMHelper){if(oldGMHelper.breakByObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.breakByObjects.pop());}else{if(oldGMHelper.columnObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.rowObjects.pop());}}}populateAngle(oldGMHelper,newGMHelper);copyZones(["columnObjects","rowObjects","colorByObjects","xAxisObjects","yAxisObjects","colorByObjects","tooltipMetrics","breakByObjects","sizeByObjects"],oldGMHelper,newGMHelper);var breakByDisabled=breakByDisabledPie(newGMHelper);applyMetricNamesPie(oldGMHelper,newGMHelper,breakByDisabled);}function transitionFromABLToPie(oldGMHelper,newGMHelper){if(oldGMHelper.breakByObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.breakByObjects.pop());}else{var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects);if(yAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.yAxisObjects.pop());}else{if(xAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.xAxisObjects.pop());}else{if(oldGMHelper.rowObjects.length&&oldGMHelper.columnObjects.length===0){newGMHelper.sliceObjects.push(oldGMHelper.rowObjects.pop());}else{if(oldGMHelper.columnObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.columnObjects.pop());}}}}}populateAngle(oldGMHelper,newGMHelper);copyZones(["sizeByObjects","breakByObjects","rowObjects","columnObjects","xAxisObjects","yAxisObjects","colorByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);var breakByDisabled=breakByDisabledPie(newGMHelper);applyMetricNamesPie(oldGMHelper,newGMHelper,breakByDisabled);}function transitionHeatmapToPie(newGMHelper,node){var oldHMHelper,objList;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length>0){newGMHelper.sliceObjects.push(objList.pop());if(objList.length>0){newGMHelper.xAxisObjects.push(objList.pop());}if(objList.length>0){newGMHelper.columnObjects=objList;}}if(oldHMHelper.sizeByMetric){newGMHelper.angleObjects.push(oldHMHelper.sizeByMetric);}newGMHelper.colorByObjects=oldHMHelper.colorBy;newGMHelper.tooltipMetrics=oldHMHelper.tooltipMetrics;}function transitionNetworkToPie(newGMHelper,node){var oldHelper,objList,anObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.sliceObjects.push(anObj);}anObj=oldHelper.nodeSizeMetric||oldHelper.edgeSizeMetric||oldHelper.edgeColorMetric;if(anObj){newGMHelper.angleObjects.push(anObj);}objList=newGMHelper.sliceObjects;anObj=objList.length&&objList[0];if(anObj){newGMHelper.colorByObjects.push(anObj);}}function transitionImageLayoutOrMapToPie(newGMHelper,sliceObj,angleObj,colorByObj,tooltips){var objList,anObj;if(sliceObj){newGMHelper.sliceObjects.push(sliceObj);}if(angleObj){newGMHelper.angleObjects.push(angleObj);}objList=newGMHelper.sliceObjects;anObj=colorByObj||(objList.length&&objList[0]);if(anObj){newGMHelper.colorByObjects.push(anObj);}hMoveUnitsToZoneByType(tooltips,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionImageLayoutToPie(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToPie(newGMHelper,oldHelper.geoAttribute,(oldHelper.sizeByMetric||oldHelper.colorByMetric),oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionToHistogram(oldGMHelper,newGMHelper){var templateInfo=this.templateInfo,rows=templateInfo.rows,cols=templateInfo.cols,mx=templateInfo.mx[0];hMoveUnitsToZoneByType(rows,newGMHelper.xAxisObjects);hMoveUnitsToZoneByType(cols,newGMHelper.xAxisObjects);if(mx){newGMHelper.yAxisObjects.push(mx);}}function transitionMapToPie(oldTemplateID,newGMHelper){var oldHelper=new $VIZ.MapHelper(),topLayer=this.vis.getTopLayerHost();oldHelper.setWidget(topLayer);var colorBy=oldHelper.getColorByUnit();transitionImageLayoutOrMapToPie(newGMHelper,oldHelper.getGeoUnit(),(oldHelper.getSizeByUnit()||colorBy),colorBy,oldHelper.getTooltipUnits());}function transitionToGraphMatrixPie(oldTemplateID,oldGMHelper,newGMHelper,node){if(oldGMHelper){transitionFromABLToPie.call(this,oldGMHelper,newGMHelper);}else{switch(oldTemplateID){case $VIZTEMPLATES.ESRIMAP:case $VIZTEMPLATES.GOOGLEMAP:transitionMapToPie.call(this,oldTemplateID,newGMHelper,node);break;case $VIZTEMPLATES.HEATMAP:transitionHeatmapToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.NETWORK:transitionNetworkToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.IMAGELAYOUT:transitionImageLayoutToPie.call(this,newGMHelper,node);break;case $VIZTEMPLATES.GRID:transitionFromGridToPie.call(this,newGMHelper,node);break;}}}function getAxisBySide(oldGMHelper,z){var objList=oldGMHelper[z],primaryItems=[],secondaryItems=[];if(objList&&objList.length&&oldGMHelper.isMetric(objList[0])){objList.forEach(function(m){if(m.ax===AXIS_PRIMARY){primaryItems.push(m);}else{if(m.ax===AXIS_SECONDARY){secondaryItems.push(m);}}});}return[primaryItems,secondaryItems];}function moveSecondaryAxisToPrimary(oldGMHelper,z){var objList=oldGMHelper[z];if(objList&&objList.length){objList.forEach(function(m){if(m.ax===AXIS_SECONDARY){m.ax=AXIS_PRIMARY;}});}}function distributeMetricsToAxis(newGMHelper,mx,z){var metricShapes=[],numLeft=(mx.length/2),fnPushShape=function(aMetric,shape){metricShapes.push("'"+aMetric.did+"':"+shape);};var ind=0;while(numLeft>0){mx[0].ax=AXIS_PRIMARY;newGMHelper[z].push(mx[0]);fnPushShape(mx[0],$SHAPE_TYPES.BAR);mx.splice(0,1);numLeft-=1;ind++;}while(mx.length){mx[0].ax=AXIS_SECONDARY;newGMHelper[z].push($HASH.copy({ax:AXIS_SECONDARY},mx[0]));fnPushShape(mx[0],$SHAPE_TYPES.LINE);mx.splice(0,1);ind++;}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function evenOutAxes(oldGMHelper,newGMHelper,z){var dividedAxes=getAxisBySide(oldGMHelper,z),oldPrimaryAxis=dividedAxes[0],oldSecondaryAxis=dividedAxes[1],primaryAxis=[],secondaryAxis=[];var diff=oldPrimaryAxis.length-oldSecondaryAxis.length,ind;if(diff>0){secondaryAxis=oldSecondaryAxis;ind=oldPrimaryAxis.length-Math.floor(diff/2);for(var i=ind;i<oldPrimaryAxis.length;i++){secondaryAxis.push(oldPrimaryAxis[i]);}oldPrimaryAxis.splice(oldPrimaryAxis.length-Math.floor(diff/2),oldPrimaryAxis.length-Math.floor(diff/2));primaryAxis=oldPrimaryAxis;}else{if(diff<0){primaryAxis=oldPrimaryAxis;diff=diff*-1;ind=oldSecondaryAxis.length-Math.floor(diff/2);for(var i=ind;i<oldSecondaryAxis.length;i++){primaryAxis.push(oldSecondaryAxis[i]);}oldSecondaryAxis.splice(oldSecondaryAxis.length-Math.floor(diff/2),oldSecondaryAxis.length-Math.floor(diff/2));secondaryAxis=oldSecondaryAxis;}else{secondaryAxis=oldSecondaryAxis;primaryAxis=oldPrimaryAxis;}}primaryAxis=primaryAxis.concat(secondaryAxis);distributeMetricsToAxis(newGMHelper,primaryAxis,z);}function transitionFromPieToCombo(oldGMHelper,newGMHelper){newGMHelper.breakByObjects=[];newGMHelper.xAxisObjects=[];var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects),xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects),fnFindFirstMetric=function(zone,axis){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects.splice(0,1)[0];}else{if(oldGMHelper.angleObjects.length){return oldGMHelper.angleObjects.pop();}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects[0];}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}}},fnFindFirstAttribute=function(zone){if(oldGMHelper.breakByObjects.length){return oldGMHelper.breakByObjects.splice(0,1)[0];}else{if(oldGMHelper.sliceObjects.length){return oldGMHelper.sliceObjects.splice(0,1)[0];}else{if(oldGMHelper.columnObjects.length||oldGMHelper.rowObjects.length){if(zone==="xAxisObjects"){if(oldGMHelper.columnObjects.length){return oldGMHelper.columnObjects.pop();}else{return oldGMHelper.rowObjects.pop();}}else{if(oldGMHelper.rowObjects.length){return oldGMHelper.rowObjects.pop();}else{return oldGMHelper.columnObjects.pop();}}}}}};if(xAxisAttributes.length===0&&yAxisAttributes.length===0){if(xAxisMetrics.length&&yAxisMetrics.length){var attr=fnFindFirstAttribute("xAxisObjects");if(attr!=undefined){newGMHelper.xAxisObjects.push(attr);}var oldPrimaryAxis,oldSecondaryAxis,axis=[],secondaryAxis=[];if(oldGMHelper.yAxisObjects[0].ax===AXIS_PRIMARY){axis=oldGMHelper.yAxisObjects.concat(oldGMHelper.xAxisObjects);}else{axis=oldGMHelper.xAxisObjects.concat(oldGMHelper.yAxisObjects);}distributeMetricsToAxis(newGMHelper,axis,"yAxisObjects");}else{if(xAxisMetrics.length||yAxisMetrics.length){var z=xAxisMetrics.length?"xAxisObjects":"yAxisObjects",notZ=yAxisMetrics.length?"xAxisObjects":"yAxisObjects";newGMHelper[notZ].push(fnFindFirstAttribute(notZ));var metricToMove=[],mx=[];if(oldGMHelper[z].length===1){if(oldGMHelper[z][0].ax===AXIS_PRIMARY){metricToMove[0]=fnFindFirstMetric(z);if(metricToMove[0]!==undefined){mx=oldGMHelper[z].concat(metricToMove);}}else{metricToMove[0]=fnFindFirstMetric(z);if(metricToMove[0]!==undefined){mx=metricToMove.concat(oldGMHelper[z]);}}distributeMetricsToAxis(newGMHelper,mx,z);}else{evenOutAxes(oldGMHelper,newGMHelper,z);}}else{var met=fnFindFirstMetric("yAxisObjects");if(met!==undefined){oldGMHelper.yAxisObjects.push(met);}met=fnFindFirstMetric("yAxisObjects");if(met!==undefined){oldGMHelper.yAxisObjects.push(met);}evenOutAxes(oldGMHelper,newGMHelper,"yAxisObjects");newGMHelper.xAxisObjects.push(fnFindFirstAttribute("xAxisObjects"));}}}else{if(xAxisAttributes.length&&yAxisAttributes.length){var axis=[];hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);var met=fnFindFirstMetric("yAxisObjects");if(met!==undefined){axis.push(met);}met=fnFindFirstMetric("yAxisObjects");if(met!==undefined){axis.push(met);}distributeMetricsToAxis(newGMHelper,axis,"yAxisObjects");}else{if(xAxisAttributes.length||yAxisAttributes.length){var z,notZ,axis=[];if(xAxisAttributes.length){z="xAxisObjects";notZ="yAxisObjects";}else{if(yAxisAttributes.length){z="yAxisObjects";notZ="xAxisObjects";}}axis=oldGMHelper[notZ];hMoveUnitsToZoneByType(oldGMHelper[z],newGMHelper[z],$DSSOBJ_TYPES.DssTypeAttribute);var met=fnFindFirstMetric(notZ);if(met!==undefined){axis.push(met);}if(xAxisMetrics.length===0&&yAxisMetrics.length===0){met=fnFindFirstMetric(notZ);if(met!==undefined){axis.push(met);}}distributeMetricsToAxis(newGMHelper,axis,notZ);}}}hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.breakByObjects);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.breakByObjects);if(oldGMHelper.angleObjects.length){if(!oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.angleObjects.pop());}addToTooltip(newGMHelper,oldGMHelper.angleObjects);}copyZones(["colorByObjects","rowObjects","columnObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);applyMetricNamesGM(oldGMHelper,newGMHelper);}function transitionFromABLToCombo(oldGMHelper,newGMHelper){newGMHelper.xAxisObjects=[];newGMHelper.yAxisObjects=[];var axisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects,oldGMHelper.yAxisObjects),xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects),fnFindMetric=function(){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects[0];}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects.pop();}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}};if(axisAttributes.length){hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);}else{if(oldGMHelper.breakByObjects.length){if(xAxisMetrics.length==0){if(oldGMHelper.breakByObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.breakByObjects[0]);oldGMHelper.breakByObjects.splice(0,1);}}else{if(oldGMHelper.breakByObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.breakByObjects[0]);oldGMHelper.breakByObjects.splice(0,1);}}}else{if(yAxisMetrics.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{if(xAxisMetrics.length){newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());}}}}var z;if(xAxisMetrics.length){z="xAxisObjects";}else{if(yAxisMetrics.length){z="yAxisObjects";}}var dividedAxes=getAxisBySide(oldGMHelper,z),oldPrimaryAxis=dividedAxes[0],oldSecondaryAxis=dividedAxes[1];if(oldPrimaryAxis.length+oldSecondaryAxis.length===1){var met=fnFindMetric();if(met){if(oldPrimaryAxis.length){met.ax=AXIS_SECONDARY;}else{met.ax=AXIS_PRIMARY;}oldGMHelper[z].push(met);}}evenOutAxes(oldGMHelper,newGMHelper,z);applyMetricNamesGM(oldGMHelper,newGMHelper);copyZones(["columnObjects","rowObjects","colorByObjects","breakByObjects"],oldGMHelper,newGMHelper);}function transitionFromBubbleToCombo(oldGMHelper,newGMHelper){if(oldGMHelper.breakByObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.breakByObjects[0]);oldGMHelper.breakByObjects.splice(0,1);}else{if(oldGMHelper.columnObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{newGMHelper.xAxisObjects.push(oldGMHelper.rowObjects.pop());}}var axis=getNumericAxis(oldGMHelper,null,"yAxisObjects"),xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),newAxis=[];if(axis===AXIS_PRIMARY){newAxis=oldGMHelper.yAxisObjects.concat(xAxisMetrics);}else{newAxis=xAxisMetrics.concat(oldGMHelper.yAxisObjects);}distributeMetricsToAxis(newGMHelper,newAxis,"yAxisObjects");if(oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.sizeByObjects.splice(0,1)[0]);hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.tooltipMetrics);}copyZones(["breakByObjects","colorByObjects","columnObjects","rowObjects","tooltipMetrics"],oldGMHelper,newGMHelper);applyMetricNamesBubbleToABLCombo(oldGMHelper,newGMHelper);}function transitionFromGridChartToCombo(oldGMHelper,newGMHelper){var obj,leftSideMetric,metricShapes=[],fnFindMetric=function(){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects.pop();}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects.pop();}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}};copyZones(["colorByObjects","columnObjects","rowObjects","sizeByObjects"],oldGMHelper,newGMHelper);var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects),z="yAxisObjects";if(xAxisAttributes.length){z="yAxisObjects";hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);}else{if(yAxisAttributes.length){z="xAxisObjects";hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeAttribute);}else{if(oldGMHelper.breakByObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.breakByObjects.splice(0,1)[0]);z="yAxisObjects";}else{if(oldGMHelper.columnObjects.length){z="yAxisObjects";newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){z="xAxisObjects";newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());}}}}}leftSideMetric=fnFindMetric();if(leftSideMetric){newGMHelper[z].push(leftSideMetric);metricShapes.push("'"+leftSideMetric.did+"':"+$SHAPE_TYPES.BAR);}obj=fnFindMetric();if(obj){newGMHelper[z].push($HASH.copy({ax:AXIS_SECONDARY},obj));metricShapes.push("'"+obj.did+"':"+$SHAPE_TYPES.LINE);}hMoveUnitsToZoneByType(oldGMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.breakByObjects);if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}applyMetricNamesGM(oldGMHelper,newGMHelper);}function transitionFromGridToCombo(oldTemplateID,oldGMHelper,newGMHelper){var ti=this.templateInfo,mx=ti.mx,dz=this.vis.model.data.gsi,definition=this.definition;if(ti.cols.length&&ti.rows.length){var z;dz.rows.forEach(function(m){if(m.n==="Metrics"){z="Rows";}});dz.cols.forEach(function(m){if(m.n==="Metrics"){z="Columns";}});if(z==="Rows"){if(dz.rows[dz.rows.length-1].n==="Metrics"){distributeMetricsToAxis(newGMHelper,mx,"yAxisObjects");newGMHelper.xAxisObjects.push(ti.cols.pop());}else{newGMHelper.yAxisObjects.push(ti.rows.pop());distributeMetricsToAxis(newGMHelper,mx,"xAxisObjects");}ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}else{if(z==="Columns"){if(dz.cols[dz.cols.length-1].n==="Metrics"){distributeMetricsToAxis(newGMHelper,mx,"xAxisObjects");newGMHelper.yAxisObjects.push(ti.rows.pop());}else{newGMHelper.xAxisObjects.push(ti.cols.pop());distributeMetricsToAxis(newGMHelper,mx,"yAxisObjects");}ti.rows.forEach(function(m){newGMHelper.rowObjects.push(m);});ti.cols.forEach(function(m){newGMHelper.columnObjects.push(m);});}}}else{distributeMetricsToAxis(newGMHelper,mx,"yAxisObjects");if(ti.cols.length+ti.rows.length===1){addAttributeToZone(newGMHelper,ti.cols,ti.rows,"xAxisObjects",getDropZoneFromDefn(definition,$GMH.PROP_XAXIS));}else{var gridAttributes=ti.rows.concat(ti.cols);if(gridAttributes.length){newGMHelper.breakByObjects.push(gridAttributes.pop());}if(gridAttributes.length){newGMHelper.xAxisObjects.push(gridAttributes.pop());}gridAttributes.forEach(function(attr){newGMHelper.columnObjects.push(attr);});}}if(newGMHelper.xAxisObjects.length>1&&newGMHelper.xAxisObjects[0].t===4){newGMHelper.metricsDropZone="Columns";}else{if(newGMHelper.yAxisObjects.length>1&&newGMHelper.yAxisObjects[0].t===4){newGMHelper.metricsDropZone="Rows";}else{newGMHelper.metricsDropZone="";}}newGMHelper.secondaryMetricsDropZone="";}function transitionHeatmapToCombo(newGMHelper,node){var oldHMHelper,objList,anObj,leftSideMetric,metricShapes=[],hmColorByMetric;oldHMHelper=new $VIZ.HeatMapVisualizationHelper();oldHMHelper.setData(node.data.dz);objList=oldHMHelper.groupingObjects;if(objList.length===1){newGMHelper.xAxisObjects.push(objList[0]);}else{if(objList.length===2){newGMHelper.xAxisObjects.push(objList[0]);newGMHelper.breakByObjects.push(objList[1]);}else{if(objList.length>2){newGMHelper.breakByObjects.push(objList.pop());newGMHelper.xAxisObjects.push(objList.pop());newGMHelper.columnObjects=objList;}}}hmColorByMetric=oldHMHelper.getFirstColorByUnit(true);objList=oldHMHelper.tooltipMetrics;leftSideMetric=anObj=oldHMHelper.sizeByMetric||hmColorByMetric||objList.shift();if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.BAR);}anObj=(hmColorByMetric&&(hmColorByMetric.did!==leftSideMetric.did))?hmColorByMetric:objList.shift();if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}hMoveUnitsToZoneByType(oldHMHelper.colorBy,newGMHelper.colorByObjects);hMoveUnitsToZoneByType(oldHMHelper.tooltipMetrics,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function findFirstMetricInArrayAndRemove(mx,usedMetric){var aMetric;$ARR.forEach(mx,function(m,idx,arr){if(m&&m!==usedMetric){aMetric=m;arr.splice(idx,1);return false;}});return aMetric;}function transitionNetworkToCombo(newGMHelper,node){var oldHelper,anObj,leftSideMetric,xAxisObj,metricShapes=[];oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.xAxisObjects.push(anObj);xAxisObj=anObj;}var mx=oldHelper.getNetworkMetrics();leftSideMetric=anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+mx.did+"':"+$SHAPE_TYPES.BAR);}anObj=findFirstMetricInArrayAndRemove(mx,leftSideMetric);if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}anObj=oldHelper.toItemAttribute;if(anObj&&(xAxisObj!==anObj)){newGMHelper.rowObjects.push(anObj);}}function transitionImageLayoutOrMapToCombo(newGMHelper,xAxisObj,yAxisMetrics,tooltips,colorByMetric){var anObj,leftSideMetric,metricShapes=[];if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}leftSideMetric=anObj=findFirstMetricInArrayAndRemove(yAxisMetrics);if(!anObj){leftSideMetric=anObj=tooltips&&(tooltips.length>0)&&(tooltips[tooltips.length-1].t===$DSSOBJ_TYPES.DssTypeMetric)&&tooltips.pop();}if(anObj){newGMHelper.yAxisObjects.push(anObj);metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.BAR);}anObj=findFirstMetricInArrayAndRemove(yAxisMetrics,leftSideMetric);if(!anObj){anObj=tooltips&&(tooltips.length>0)&&(tooltips[tooltips.length-1].t===$DSSOBJ_TYPES.DssTypeMetric)&&tooltips.pop();}if(anObj){newGMHelper.yAxisObjects.push($HASH.copy({ax:AXIS_SECONDARY},anObj));metricShapes.push("'"+anObj.did+"':"+$SHAPE_TYPES.LINE);}if(colorByMetric){newGMHelper.colorByObjects.push(colorByMetric);}if(tooltips){hMoveUnitsToZoneByType(tooltips,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}if(metricShapes.length){newGMHelper.metricShapes="{"+metricShapes.join(",")+"}";}}function transitionImageLayoutToCombo(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToCombo(newGMHelper,oldHelper.geoAttribute,[oldHelper.sizeByMetric,oldHelper.colorByMetric],oldHelper.tooltipMetrics,oldHelper.colorByMetric);}function transitionMapToCombo(oldTemplateID,newGMHelper){var oldHelper=new $VIZ.MapHelper(),topLayer=this.vis.getTopLayerHost();oldHelper.setWidget(topLayer);var colorBy=oldHelper.getColorByUnit(),metrics=[oldHelper.getSizeByUnit()];if(colorBy&&colorBy.t===$DSSOBJ_TYPES.DssTypeMetric){metrics.push(colorBy);}transitionImageLayoutOrMapToCombo(newGMHelper,oldHelper.getGeoUnit(),metrics,oldHelper.getTooltipUnits(),colorBy);}function transitionToGraphMatrixCombo(oldTemplateID,oldGMHelper,newGMHelper,node){switch(oldTemplateID){case $VIZTEMPLATES.ESRIMAP:case $VIZTEMPLATES.GOOGLEMAP:transitionMapToCombo.call(this,oldTemplateID,newGMHelper,node);break;case $VIZTEMPLATES.HEATMAP:transitionHeatmapToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.NETWORK:transitionNetworkToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.IMAGELAYOUT:transitionImageLayoutToCombo.call(this,newGMHelper,node);break;case $VIZTEMPLATES.KPICARD:transitionFromGridToCombo.call(this,oldTemplateID,oldGMHelper,newGMHelper);break;case $VIZTEMPLATES.GRID:transitionFromGridToCombo.call(this,oldTemplateID,oldGMHelper,newGMHelper);break;}}function moveMetricsToPrimaryAxis(oldGMHelper,z){var objList=oldGMHelper[z],prim=[],sec=[];if(objList&&objList.length&&oldGMHelper.isMetric(objList[0])){objList.forEach(function(m){if(m.ax===AXIS_PRIMARY){prim.push(m);}else{if(m.ax===AXIS_SECONDARY){sec.push(m);m.ax=AXIS_PRIMARY;}}});oldGMHelper[z]=sec.concat(prim);}}function moveMetricsToSecondaryAxis(oldGMHelper,z){var objList=oldGMHelper[z];if(objList&&objList.length&&oldGMHelper.isMetric(objList[0])){objList.forEach(function(m){oldGMHelper[z].push(m);if(m.ax===AXIS_PRIMARY){m.ax=AXIS_SECONDARY;}});}}function moveMetricsOnNumericAxisToSecondary(oldGMHelper,node){if(isHorizontalGraphMatrix2(node)){moveMetricsToSecondaryAxis(oldGMHelper,"xAxisObjects");}else{moveMetricsToSecondaryAxis(oldGMHelper,"yAxisObjects");}}function moveMetricsOnNumericAxisToPrimary(oldGMHelper,node){if(isHorizontalGraphMatrix2(node)){moveMetricsToPrimaryAxis(oldGMHelper,"xAxisObjects");}else{moveMetricsToPrimaryAxis(oldGMHelper,"yAxisObjects");}}function transitionComboToPie(oldGMHelper,newGMHelper,node){if(oldGMHelper.breakByObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.breakByObjects.pop());}else{var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects);if(xAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.xAxisObjects.pop());}else{if(yAxisAttributes.length){newGMHelper.sliceObjects.push(oldGMHelper.yAxisObjects.pop());}else{if(oldGMHelper.columnObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.sliceObjects.push(oldGMHelper.rowObjects.pop());}}}}}populateAngle(oldGMHelper,newGMHelper);moveMetricsOnNumericAxisToPrimary(oldGMHelper,node);if(oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.sizeByObjects.splice(0,1)[0]);hMoveUnitsToZoneByType(oldGMHelper.sizeByObjects,newGMHelper.tooltipMetrics);}copyZones(["columnObjects","rowObjects","yAxisObjects","xAxisObjects","colorByObjects","tooltipMetrics","breakByObjects"],oldGMHelper,newGMHelper);var breakByDisabled=breakByDisabledPie(newGMHelper);applyMetricNamesPie(oldGMHelper,newGMHelper,breakByDisabled);}function transitionFromComboToABL(oldGMHelper,newGMHelper,node){if(getNumericAxis(oldGMHelper,node)===AXIS_SECONDARY){moveMetricsOnNumericAxisToSecondary(oldGMHelper,node);}else{moveMetricsOnNumericAxisToPrimary(oldGMHelper,node);}newGMHelper.clone(oldGMHelper);if(isAreaChart()){applyMetricNamesGM(oldGMHelper,newGMHelper);}}function transitionNetworkToABL(newGMHelper,node){var oldHelper,anObj,xAxisObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute||oldHelper.toItemAttribute;if(anObj){newGMHelper.xAxisObjects.push(anObj);xAxisObj=anObj;}var mx=oldHelper.getNetworkMetrics();anObj=findFirstMetricInArrayAndRemove(mx);if(anObj){newGMHelper.yAxisObjects.push(anObj);}hMoveUnitsToZoneByType(mx,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);anObj=oldHelper.toItemAttribute;if(anObj&&(xAxisObj!==anObj)){newGMHelper.rowObjects.push(anObj);}}function transitionImageLayoutOrMapToABL(newGMHelper,xAxisObj,sizeByObj,colorByObj,tooltips){var firstTooltip,firstTooltipIndex=-1,tooltipCount=tooltips?tooltips.length:0,yAxisObj,tooltipsCopy=tooltips.concat([]);if(xAxisObj){newGMHelper.xAxisObjects.push(xAxisObj);}for(var i=0;i<tooltipCount;i++){if(newGMHelper.isMetric(tooltips[i])){firstTooltip=tooltips[i];firstTooltipIndex=i;break;}}yAxisObj=sizeByObj||colorByObj;if(!yAxisObj&&firstTooltip){yAxisObj=firstTooltip;tooltipsCopy.splice(firstTooltipIndex,1);}if(yAxisObj){newGMHelper.yAxisObjects.push(yAxisObj);}if(colorByObj){newGMHelper.colorByObjects.push(colorByObj);}hMoveUnitsToZoneByType(tooltipsCopy,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}function transitionMapToABL(oldTemplateID,newGMHelper){var oldHelper=new $VIZ.MapHelper(),topLayer=this.vis.getTopLayerHost();oldHelper.setWidget(topLayer);transitionImageLayoutOrMapToABL(newGMHelper,oldHelper.getGeoUnit(),oldHelper.getSizeByUnit(),oldHelper.getColorByUnit(),oldHelper.getTooltipUnits());}function transitionImageLayoutToABL(newGMHelper,node){var oldHelper=new $VIZ.ImageLayoutHelper({node:node});oldHelper.setData(node.data.dz);transitionImageLayoutOrMapToABL(newGMHelper,oldHelper.geoAttribute,oldHelper.sizeByMetric,oldHelper.colorByMetric,oldHelper.tooltipMetrics);}function transitionFromComboToBubble(oldGMHelper,newGMHelper,node){var axisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects,oldGMHelper.yAxisObjects);if(oldGMHelper.breakByObjects.length||axisAttributes.length){newGMHelper.breakByObjects=axisAttributes.concat(oldGMHelper.breakByObjects);}else{var xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects);if(yAxisMetrics.length){newGMHelper.breakByObjects.push(oldGMHelper.columnObjects.pop());}else{if(xAxisMetrics.length){newGMHelper.breakByObjects.push(oldGMHelper.rowObjects.pop());}}}var z,notZ,ax=getNumericAxis(oldGMHelper,node);if(isHorizontalGraphMatrix2(node)){z="xAxisObjects";notZ="yAxisObjects";}else{z="yAxisObjects";notZ="xAxisObjects";}if(ax===AXIS_SECONDARY||ax===AXIS_PRIMARY){var half=Math.floor(oldGMHelper[z].length/2);newGMHelper[notZ]=oldGMHelper[z].splice(0,half);newGMHelper[z]=oldGMHelper[z];newGMHelper[notZ].forEach(function(m){m.ax=AXIS_PRIMARY;});}else{oldGMHelper[z].forEach(function(m){if(m.ax===AXIS_PRIMARY){newGMHelper[z].push(m);}else{if(m.ax===AXIS_SECONDARY){newGMHelper[notZ].push(m);m.ax=AXIS_PRIMARY;}}});}copyZones(["colorByObjects","columnObjects","rowObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);applyMetricNamesGM(oldGMHelper,newGMHelper);}function transitionFromPieToBubble(oldGMHelper,newGMHelper){var fnFindFirstMetric=function(){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects[0];}else{if(oldGMHelper.angleObjects.length){return oldGMHelper.angleObjects.pop();}else{if(oldGMHelper.colorByObjects.length&&oldGMHelper.colorByObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){return oldGMHelper.colorByObjects[0];}else{if(oldGMHelper.tooltipMetrics.length){return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}}};copyZones(["breakByObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.breakByObjects,$DSSOBJ_TYPES.DssTypeAttribute);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.breakByObjects);if(newGMHelper.breakByObjects.length===0){if(oldGMHelper.columnObjects.length){newGMHelper.breakByObjects.push(oldGMHelper.columnObjects.pop());}else{newGMHelper.breakByObjects.push(oldGMHelper.rowObjects.pop());}}var xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects);if(xAxisMetrics.length&&yAxisMetrics.length){if(!oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.angleObjects.pop());}hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects,$DSSOBJ_TYPES.DssTypeMetric);}else{if((xAxisMetrics.length>1&&yAxisMetrics.length===0)){addToTooltip(newGMHelper,oldGMHelper.angleObjects);var i=Math.ceil(xAxisMetrics.length/2);for(var a=0;a<i;a++){newGMHelper.yAxisObjects.push(xAxisMetrics[a]);}for(i;i<xAxisMetrics.length;i++){newGMHelper.xAxisObjects.push(xAxisMetrics[i]);}}else{if(yAxisMetrics.length>1&&xAxisMetrics.length===0){addToTooltip(newGMHelper,oldGMHelper.angleObjects);var i=Math.ceil(yAxisMetrics.length/2);for(var a=0;a<i;a++){newGMHelper.yAxisObjects.push(yAxisMetrics[a]);}for(i;i<yAxisMetrics.length;i++){newGMHelper.xAxisObjects.push(yAxisMetrics[i]);}}else{if(xAxisMetrics.length===1&&yAxisMetrics.length===0){newGMHelper.xAxisObjects.push(xAxisMetrics.pop());newGMHelper.yAxisObjects.push(fnFindFirstMetric());}else{if(yAxisMetrics.length===1&&xAxisMetrics.length===0){newGMHelper.yAxisObjects.push(yAxisMetrics.pop());newGMHelper.xAxisObjects.push(fnFindFirstMetric());}else{if(xAxisMetrics.length===0&&yAxisMetrics.length===0){newGMHelper.yAxisObjects.push(fnFindFirstMetric());newGMHelper.xAxisObjects.push(fnFindFirstMetric());}}}}}}copyZones(["columnObjects","rowObjects","colorByObjects","sizeByObjects"],oldGMHelper,newGMHelper);addToTooltip(newGMHelper,oldGMHelper.angleObjects);addToTooltip(newGMHelper,oldGMHelper.tooltipMetrics);applyMetricNamesGM(oldGMHelper,newGMHelper);}function transitionFromPieToABL(oldGMHelper,newGMHelper){newGMHelper.breakByObjects=[];newGMHelper.tooltipMetrics=[];var fnFindAttribute=function(z){if(oldGMHelper.breakByObjects.length){return oldGMHelper.breakByObjects.pop();}else{if(oldGMHelper.sliceObjects.length){return oldGMHelper.sliceObjects.pop();}else{if(oldGMHelper.columnObjects.length&&(z==="xAxisObjects"||!oldGMHelper.rowObjects.length)){return oldGMHelper.columnObjects.pop();}else{return oldGMHelper.rowObjects.pop();}}}},fnFindMetric=function(z){if(oldGMHelper.sizeByObjects.length){return oldGMHelper.sizeByObjects[0];}else{if(oldGMHelper.angleObjects.length){var ret=oldGMHelper.angleObjects;oldGMHelper.angleObjects=[];return ret;}else{if(oldGMHelper.colorByObjects.length){return oldGMHelper.colorByObjects[0];}else{return oldGMHelper.tooltipMetrics.splice(0,1)[0];}}}};var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects),xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects),attr,met;if((xAxisAttributes.length&&yAxisMetrics.length)||(yAxisAttributes.length&&xAxisMetrics.length)){copyZones(["xAxisObjects","yAxisObjects"],oldGMHelper,newGMHelper);}else{if(yAxisMetrics.length===0&&xAxisMetrics.length===0){var z="yAxisObjects";met=fnFindMetric();if(!xAxisAttributes.length&&!yAxisAttributes.length){attr=fnFindAttribute("xAxisObjects");if(attr){newGMHelper.xAxisObjects.push(attr);}}else{if(xAxisAttributes.length&&yAxisAttributes.length){copyZones(["xAxisObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.xAxisObjects);}else{if(xAxisAttributes.length){copyZones(["xAxisObjects"],oldGMHelper,newGMHelper);}else{if(yAxisAttributes.length){copyZones(["yAxisObjects"],oldGMHelper,newGMHelper);z="xAxisObjects";}}}}if(met&&met.length){hMoveUnitsToZoneByType(met,newGMHelper[z]);}else{if(met){newGMHelper[z].push(met);}}}else{if(xAxisAttributes.length===0&&yAxisAttributes.length===0){if(yAxisMetrics.length&&xAxisMetrics.length){hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.yAxisObjects);attr=fnFindAttribute("xAxisObjects");if(attr){newGMHelper.xAxisObjects.push(attr);}}else{if(yAxisMetrics.length){hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects);attr=fnFindAttribute("xAxisObjects");if(attr){newGMHelper.xAxisObjects.push(attr);}}else{if(xAxisMetrics.length){hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects);attr=fnFindAttribute("yAxisObjects");if(attr){newGMHelper.yAxisObjects.push();}}}}}}}if(oldGMHelper.angleObjects.length){if(oldGMHelper.sizeByObjects.length){addToTooltip(newGMHelper,oldGMHelper.angleObjects);}else{newGMHelper.sizeByObjects.push(oldGMHelper.angleObjects.pop());if(oldGMHelper.angleObjects.length){addToTooltip(newGMHelper,oldGMHelper.angleObjects);}}}copyZones(["colorByObjects","sizeByObjects","tooltipMetrics","columnObjects","rowObjects","breakByObjects"],oldGMHelper,newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.breakByObjects);newGMHelper.angleObjects=[];applyMetricNamesGM(oldGMHelper,newGMHelper);}function hDistributeMetricsToAxes(newGMHelper,mx){var numLeft=(mx.length/2);var ind=0;while(numLeft>0){newGMHelper.xAxisObjects.push(mx[0]);mx.splice(0,1);numLeft-=1;ind++;}while(mx.length){newGMHelper.yAxisObjects.push(mx[0]);mx.splice(0,1);ind++;}}function hMoveMetricGridChart(met,newGMHelper){if(!met){return ;}if(!newGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(met);}else{if(!newGMHelper.colorByObjects.length){newGMHelper.colorByObjects.push(met);}else{addToTooltip(newGMHelper,[met]);}}}function populateAttributeAxesGridChart(oldGMHelper,newGMHelper){var xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects);if(xAxisAttributes.length||yAxisAttributes.length){var z;if(xAxisAttributes.length){z={attrZone:"xAxisObjects",blankZone:"yAxisObjects",h1:"rowObjects",h2:"columnObjects"};}else{z={attrZone:"yAxisObjects",blankZone:"xAxisObjects",h1:"columnObjects",h2:"rowObjects"};}if(oldGMHelper.breakByObjects.length){hMoveUnitsToZoneByType(oldGMHelper[z.attrZone],newGMHelper[z.attrZone]);newGMHelper[z.blankZone].push(oldGMHelper.breakByObjects.pop());}else{if(oldGMHelper[z.attrZone].length>1){hDistributeMetricsToAxes(newGMHelper,oldGMHelper[z.attrZone]);}else{hMoveUnitsToZoneByType(oldGMHelper[z.attrZone],newGMHelper[z.attrZone]);if(oldGMHelper[z.h1].length){newGMHelper[z.blankZone].push(oldGMHelper[z.h1].pop());}else{newGMHelper[z.blankZone].push(oldGMHelper[z.h2].pop());}}}}else{if(oldGMHelper.breakByObjects.length>1){hDistributeMetricsToAxes(newGMHelper,oldGMHelper.breakByObjects);oldGMHelper.breakByObjects=[];}else{if(oldGMHelper.breakByObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.breakByObjects.pop());if(oldGMHelper.rowObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());}else{newGMHelper.yAxisObjects.push(oldGMHelper.columnObjects.pop());}}else{if(oldGMHelper.columnObjects.length&&oldGMHelper.rowObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());}else{if(oldGMHelper.columnObjects.length){newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());newGMHelper.yAxisObjects.push(oldGMHelper.columnObjects.pop());}else{newGMHelper.xAxisObjects.push(oldGMHelper.rowObjects.pop());newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());}}}}}copyZones(["breakByObjects","columnObjects","rowObjects"],oldGMHelper,newGMHelper);}function transitionFromABLToGridChart(oldGMHelper,newGMHelper,node){copyZones(["colorByObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);var z,notZ,headers;if(isHorizontalGraphMatrix2(node)){z="xAxisObjects";notZ="yAxisObjects";headers={0:"columnObjects",1:"rowObjects"};}else{z="yAxisObjects";notZ="xAxisObjects";headers={0:"rowObjects",1:"columnObjects"};}if(oldGMHelper[z].length){hMoveMetricGridChart(oldGMHelper[z].splice(0,1)[0],newGMHelper);hMoveMetricGridChart(oldGMHelper[z].splice(0,1)[0],newGMHelper);addToTooltip(newGMHelper,oldGMHelper[z]);}populateAttributeAxesGridChart(oldGMHelper,newGMHelper);copyZones(["colorByObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);}function transitionFromPieToGridChart(oldGMHelper,newGMHelper){copyZones(["colorByObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);if(oldGMHelper.angleObjects.length){hMoveMetricGridChart(oldGMHelper.angleObjects.splice(0,1)[0],newGMHelper);hMoveMetricGridChart(oldGMHelper.angleObjects.splice(0,1)[0],newGMHelper);hMoveUnitsToZoneByType(oldGMHelper.angleObjects,newGMHelper.tooltipMetrics);}var xAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects),yAxisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects),xAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.xAxisObjects),yAxisAttributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,oldGMHelper.yAxisObjects);if(xAxisMetrics.length||yAxisMetrics.length){var axisMetrics=xAxisMetrics.concat(yAxisMetrics);hMoveMetricGridChart(axisMetrics.splice(0,1)[0],newGMHelper);hMoveMetricGridChart(axisMetrics.splice(0,1)[0],newGMHelper);hMoveUnitsToZoneByType(axisMetrics,newGMHelper.tooltipMetrics);xAxisMetrics=[];yAxisMetrics=[];if(xAxisAttributes.length||yAxisAttributes.length){var z=xAxisAttributes.length?"yAxisObjects":"xAxisObjects",notZ=xAxisAttributes.length?"xAxisObjects":"yAxisObjects";hMoveUnitsToZoneByType(oldGMHelper[notZ],newGMHelper[notZ]);hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper[z]);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper[z]);if(!newGMHelper.xAxisObjects.length){oldGMHelper.columnObjects.length?newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop()):newGMHelper.xAxisObjects.push(oldGMHelper.rowObjects.pop());}if(!newGMHelper.yAxisObjects.length){oldGMHelper.rowObjects.length?newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop()):newGMHelper.yAxisObjects.push(oldGMHelper.columnObjects.pop());}}else{if(oldGMHelper.sliceObjects.length&&oldGMHelper.breakByObjects.length){hMoveUnitsToZoneByType(oldGMHelper.breakByObjects,newGMHelper.yAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.xAxisObjects);}else{if(oldGMHelper.sliceObjects.length||oldGMHelper.breakByObjects){var attrToDistribute=oldGMHelper.sliceObjects.length?oldGMHelper.sliceObjects:oldGMHelper.breakByObjects;hDistributeMetricsToAxes(newGMHelper,attrToDistribute);}else{if(oldGMHelper.columnObjects.length&&oldGMHelper.rowObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.columnObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.columnObjects.pop());newGMHelper.xAxisObjects.push(oldGMHelper.columnObjects.pop());}else{if(oldGMHelper.rowObjects.length){newGMHelper.yAxisObjects.push(oldGMHelper.rowObjects.pop());newGMHelper.xAxisObjects.push(oldGMHelper.rowObjects.pop());}}}}}}oldGMHelper.xAxisObjects=[];oldGMHelper.yAxisObjects=[];}else{if(xAxisAttributes.length||yAxisAttributes.length){if(yAxisAttributes.length&&xAxisAttributes.length){hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.xAxisObjects);}else{if(yAxisAttributes.length){hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.xAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.yAxisObjects,newGMHelper.yAxisObjects);}else{hMoveUnitsToZoneByType(oldGMHelper.sliceObjects,newGMHelper.yAxisObjects);hMoveUnitsToZoneByType(oldGMHelper.xAxisObjects,newGMHelper.xAxisObjects);}}}else{hDistributeMetricsToAxes(newGMHelper,oldGMHelper.sliceObjects);}}copyZones(["columnObjects","rowObjects"],oldGMHelper,newGMHelper);}function transitionFromComboToGridChart(oldGMHelper,newGMHelper,node){copyZones(["colorByObjects","sizeByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);var z;if(isHorizontalGraphMatrix2(node)){z="xAxisObjects";}else{z="yAxisObjects";}var axes=getAxisBySide(oldGMHelper,z);axes=axes[0].concat(axes[1]);hMoveMetricGridChart(axes.splice(0,1)[0],newGMHelper);hMoveMetricGridChart(axes.splice(0,1)[0],newGMHelper);addToTooltip(newGMHelper,axes);oldGMHelper[z]=[];populateAttributeAxesGridChart(oldGMHelper,newGMHelper);}function transitionFromBubbleToGridChart(oldGMHelper,newGMHelper){if(oldGMHelper.sizeByObjects.length){newGMHelper.sizeByObjects.push(oldGMHelper.sizeByObjects.splice(0,1)[0]);addToTooltip(newGMHelper,oldGMHelper.sizeByObjects);}copyZones(["colorByObjects","tooltipMetrics"],oldGMHelper,newGMHelper);var axisMetrics=getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.xAxisObjects).concat(getZoneByType($DSSOBJ_TYPES.DssTypeMetric,oldGMHelper.yAxisObjects));axisMetrics.forEach(function(unit){hMoveMetricGridChart(unit,newGMHelper);});populateAttributeAxesGridChart(oldGMHelper,newGMHelper);}function transitionNetworkToGridChart(newGMHelper,node){var oldHelper,anObj,xAxisObj;oldHelper=new $VIZ.NetworkVisualizationHelper();oldHelper.setData(node.data.dz);anObj=oldHelper.fromItemAttribute;if(anObj){newGMHelper.yAxisObjects.push(anObj);}anObj=oldHelper.toItemAttribute;if(anObj){newGMHelper.xAxisObjects.push(anObj);}if(oldHelper.edgeColorMetric){newGMHelper.colorByObjects.push(oldHelper.edgeColorMetric);}if(oldHelper.edgeSizeMetric){newGMHelper.sizeByObjects.push(oldHelper.edgeSizeMetric);}if(!newGMHelper.colorByObjects.length&&!newGMHelper.sizeByObjects.length&&oldHelper.nodeSizeMetric){newGMHelper.sizeByObjects.push(oldHelper.nodeSizeMetric);}else{if(oldHelper.nodeSizeMetric){hMoveUnitsToZoneByType([oldHelper.nodeSizeMetric],newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}}}function addBoxPlotRules(newGMHelper){var breakBy=newGMHelper.breakByObjects;if(breakBy.length===0){var attributes,hasOne=false,row=newGMHelper.rowObjects,col=newGMHelper.columnObjects,xaxis=newGMHelper.xAxisObjects,yaxis=newGMHelper.yAxisObjects;if((row.length>0&&yaxis.length>0)||yaxis.length>1){attributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,yaxis,row);if(attributes.length>0){breakBy.push(attributes.pop());hasOne=true;}}if(!hasOne&&((col.length>0&&xaxis.length>0)||xaxis.length>1)){attributes=getZoneByType($DSSOBJ_TYPES.DssTypeAttribute,xaxis,col);if(attributes.length>0){breakBy.push(attributes.pop());}}}var colorBy=newGMHelper.colorByObjects,bHash={};if(breakBy.length>0){for(var i=0;i<breakBy.length;i++){if(breakBy[i]!==undefined){bHash[breakBy[i].did]=i;}}}colorBy.forEach(function(item){var index;if(item.t===4){index=colorBy.indexOf(item);colorBy.splice(index,1);}else{if(bHash[item.did]!==undefined){index=colorBy.indexOf(item);colorBy.splice(index,1);}}});}function doFlashTransition(oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper){transferUnits.call(this,this.definition,oldGMHelper,newGMHelper,oldTemplateID,actions,node);swapDropZoneUnits.call(this,oldTemplateID,newTemplateID,oldGMHelper,newGMHelper,node);addAttributes.call(this,this.definition,newGMHelper,newTemplateID);addMetricsKeyword.call(this,this.definition,oldGMHelper,newGMHelper);addMetrics.call(this,this.definition,newGMHelper,newTemplateID);addRowColumnAdditionalMetricsZones.call(this,newGMHelper);}function transition(oldTemplateID,newTemplateID,actions,node){var newGMHelper=new $VIZ.GraphMatrixHelper({data:node.data,visType:newTemplateID,visStyle:this.newVizInfo.s}),oldGMHelper,templateActions=[],thresholdActions=[],chartInfo;if(this.isGraphMatrix(oldTemplateID)){oldGMHelper=new $VIZ.GraphMatrixHelper({data:node.data});oldGMHelper.setData(node.data.dz);oldGMHelper.setMetricsDropZone(node.data.dz);chartInfo=this.chartInfo=this.vis.getChartInfo();newGMHelper.metricsDropZone=oldGMHelper.metricsDropZone;newGMHelper.secondaryMetricsDropZone=oldGMHelper.secondaryMetricsDropZone;}var isGridChart=chartInfo&&chartInfo.isGrid,isBubbleOrScatter=chartInfo&&chartInfo.isBubbleOrScatter,isABL=chartInfo&&chartInfo.isABL,isCombo=chartInfo&&chartInfo.isCombo,isHistogram=chartInfo&&chartInfo.isHistogram,isBoxPlot=chartInfo&&chartInfo.isBoxPlot,isWaterfall=chartInfo&&chartInfo.isWaterfall,isPie=chartInfo&&(chartInfo.isPie||chartInfo.isRing),isHeatMap=(oldTemplateID===$VIZTEMPLATES.HEATMAP),isNetwork=(oldTemplateID===$VIZTEMPLATES.NETWORK),isMap=(oldTemplateID===$VIZTEMPLATES.GOOGLEMAP||oldTemplateID===$VIZTEMPLATES.ESRIMAP),isImageLayout=(oldTemplateID===$VIZTEMPLATES.IMAGELAYOUT),isKPICard=(oldTemplateID===$VIZTEMPLATES.KPICARD),newIsHistogram=(newTemplateID===GRAPHMATRIXHISTOGRAM),newIsBubbleOrScatter=isBubbleOrScatterGraphMatrix(newTemplateID),newIsABL=isABLGraphMatrix(newTemplateID),newIsLine=isLineChart(newTemplateID),newIsCombo=isComboGraphMatrix(newTemplateID),newIsPie=(newTemplateID===GRAPHMATRIXPIE||newTemplateID===GRAPHMATRIXRING),newIsArea=isAreaChart(newTemplateID),newIsGridChart=newTemplateID===$VIZTEMPLATES.GRAPHMATRIXGRIDCHART,newIsWaterfall=(newTemplateID===$VIZTEMPLATES.GRAPHMATRIXVERTICALWATERFALL||newTemplateID===$VIZTEMPLATES.GRAPHMATRIXHORIZONTALWATERFALL),newIsBoxPlot=(newTemplateID===GRAPHMATRIXVERTICALBOXPLOT||newTemplateID===GRAPHMATRIXHORIZONTALBOXPLOT),newIsNGM=this.newVizInfo.s==="NewGraphMatrixVisualizationStyle",newIsOGM=this.newVizInfo.s==="GraphMatrixVisualizationStyle",oldIsNGM=node.data&&node.data.visName==="NewGraphMatrixVisualizationStyle",oldIsOGM=node.data&&node.data.visName==="GraphMatrixVisualizationStyle";if(newIsHistogram){if(isHeatMap){transitionHeatmapToHistogram.call(this,newGMHelper,node);}else{transitionToHistogram.call(this,oldGMHelper,newGMHelper,node);}}else{if(newIsGridChart){if(isPie){transitionFromPieToGridChart.call(this,oldGMHelper,newGMHelper,node);}else{if(isCombo){transitionFromComboToGridChart.call(this,oldGMHelper,newGMHelper,node);}else{if(isABL){transitionFromABLToGridChart.call(this,oldGMHelper,newGMHelper,node);}else{if(isBubbleOrScatter){transitionFromBubbleToGridChart.call(this,oldGMHelper,newGMHelper,node);}else{if(isHeatMap){transitionHeatmapToGridChart.call(this,newGMHelper,node);}else{if(isNetwork){transitionNetworkToGridChart.call(this,newGMHelper,node);}else{if(isMap){transitionMapToGridChart.call(this,oldTemplateID,newGMHelper,node);}else{if(isGridChart){newGMHelper.clone(oldGMHelper);var vis=this.vis,data=vis.node.data,curVisName=data.visName;if(this.newVizInfo.s===curVisName){newGMHelper.handled=true;var gm=this.vis;gm.setWidgetPropertyValue("visType",newGMHelper.visType);}}else{transitionFromGridToGridChart.call(this,newGMHelper,node);}}}}}}}}newGMHelper.metricsDropZone="";newGMHelper.secondaryMetricsDropZone="";}else{if(newIsABL||newIsBoxPlot||newIsWaterfall){if((newIsBoxPlot||newIsWaterfall)&&this.vis.GMController){var vis=this.vis,act=vis.GMController.getSortActions([]);vis.removeWidgetProperty("so");vis.removeWidgetProperty("si");actions.push({act:"sortGM",nodeKey:vis.k,subActions:act,partialUpdate:{nodes:[vis.k]}});}if(isPie){transitionFromPieToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isGridChart){transitionFromGridChartToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isCombo){transitionFromComboToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isBubbleOrScatter){transitionFromBubbleToABL.call(this,oldGMHelper,newGMHelper,node);}else{if(isWaterfall||isBoxPlot){newGMHelper.clone(oldGMHelper);var gm=this.vis;gm.setWidgetPropertyValue("visType",newGMHelper.visType);}else{if(isABL){if(isHistogram&&newIsWaterfall){transitionFromHistogramToWaterfall(oldGMHelper,newGMHelper,node);}else{newGMHelper.clone(oldGMHelper);var vis=this.vis,data=vis.node.data,curVisName=data.visName;if(this.newVizInfo.s===curVisName&&newIsABL){newGMHelper.handled=true;var gm=this.vis;gm.setWidgetPropertyValue($GM.WidgetPropertyTag.METRIC_SHAPES,{});gm.writeGlobalProperty("visType",newGMHelper.visType);gm.writeGlobalProperty("Shape",$SHAPE_TYPES[this.definition.Properties[$GMH.PROP_SHAPE].toUpperCase()]);}}}else{if(isHeatMap){if(newIsBoxPlot||newIsWaterfall){transitionHeatmapToBoxplot_Waterfall.call(this,newGMHelper,node,newIsBoxPlot);}else{transitionHeatmapToABL.call(this,newGMHelper,node);}}else{if(isNetwork){transitionNetworkToABL.call(this,newGMHelper,node);}else{if(isMap){transitionMapToABL.call(this,oldTemplateID,newGMHelper,node);}else{if(isImageLayout){transitionImageLayoutToABL.call(this,newGMHelper,node);}else{transitionGridtoABL.call(this,newGMHelper,node);}}}}}}}}}}if(newIsArea&&newGMHelper.sizeByObjects.length){var occurance=this.vis.zonesModel.gmZones.hGetItemOccurrence(newGMHelper.sizeByObjects[0],[XAXIS,YAXIS,COLORBY]);if(occurance.length===0){hMoveUnitsToZoneByType(newGMHelper.sizeByObjects,newGMHelper.tooltipMetrics,$DSSOBJ_TYPES.DssTypeMetric);}newGMHelper.sizeByObjects=[];}if(newIsBoxPlot||newIsWaterfall){if(newIsBoxPlot&&!isHeatMap){addBoxPlotRules(newGMHelper);if(newGMHelper.secondaryMetricsDropZone==="ColorBy"&&newGMHelper.metricsDropZone==="BreakBy"){newGMHelper.secondaryMetricsDropZone="";}}if(newGMHelper.sizeByObjects.length){if(newGMHelper.xAxisObjects[0]&&newGMHelper.xAxisObjects[0].t===$DSSOBJ_TYPES.DssTypeMetric){hMoveUnitsToZoneByType(newGMHelper.sizeByObjects,newGMHelper.xAxisObjects);newGMHelper.metricsDropZone="Columns";}else{hMoveUnitsToZoneByType(newGMHelper.sizeByObjects,newGMHelper.yAxisObjects);if(newGMHelper.yAxisObjects.length>1){newGMHelper.metricsDropZone="Rows";}}}if(newGMHelper.metricsDropZone==="YAxis"||newGMHelper.metricsDropZone==="XAxis"){newGMHelper.metricsDropZone="BreakBy";}var vis=this.vis,data=vis.node.data,curVisName=data.visName;if(this.newVizInfo.s===curVisName){vis.setWidgetPropertyValue("visType",newGMHelper.visType);}newGMHelper.angleObjects=[];newGMHelper.sliceObjects=[];newGMHelper.sizeByObjects=[];}else{if(newIsLine&&newGMHelper&&newGMHelper.visStyle===NEW_GRAPH_MATRIX_STYLE){var itemsToMove=newGMHelper.sizeByObjects;newGMHelper.sizeByObjects=[];addToTooltip(newGMHelper,itemsToMove);}}}else{if(newIsCombo){if(isBoxPlot||isHistogram||isWaterfall){oldGMHelper.tooltipMetrics=[];}if(isPie){transitionFromPieToCombo.call(this,oldGMHelper,newGMHelper);}else{if(isGridChart){transitionFromGridChartToCombo.call(this,oldGMHelper,newGMHelper);}else{if(isCombo){newGMHelper.clone(oldGMHelper);}else{if(isABL){transitionFromABLToCombo.call(this,oldGMHelper,newGMHelper);}else{if(isBubbleOrScatter){transitionFromBubbleToCombo.call(this,oldGMHelper,newGMHelper);}else{transitionToGraphMatrixCombo.call(this,oldTemplateID,oldGMHelper,newGMHelper,node);}}}}}}else{if(newIsBubbleOrScatter){if(isPie){transitionFromPieToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(isGridChart){transitionFromGridChartToBubble(oldGMHelper,newGMHelper,node);}else{if(isCombo){transitionFromComboToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(oldTemplateID===$VIZTEMPLATES.GRID){transitionFromGridToBubble.call(this,newGMHelper,node);}else{if(isABL){transitionFromABLToBubble.call(this,oldGMHelper,newGMHelper,node);}else{if(isHeatMap){transitionHeatmapToBubble.call(this,newGMHelper,node);}else{if(isNetwork){transitionNetworkToBubble.call(this,newGMHelper,node);}else{if(isBubbleOrScatter){newGMHelper.clone(oldGMHelper);}else{if(isMap){transitionMapToBubble.call(this,oldTemplateID,newGMHelper,node);}else{if(isImageLayout){transitionImageLayoutToBubble.call(this,newGMHelper,node);}else{if(isKPICard){transitionFromGridToBubble.call(this,newGMHelper,node);}else{doFlashTransition.call(this,oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper);}}}}}}}}}}}}else{if(newIsPie){if(isPie){newGMHelper.clone(oldGMHelper);}else{if(isGridChart){transitionFromGridChartToPie(oldGMHelper,newGMHelper,node);}else{if(isBubbleOrScatter){bubbleToGraphMatrixPie.call(this,oldTemplateID,oldGMHelper,newGMHelper);}else{if(isCombo){transitionComboToPie.call(this,oldGMHelper,newGMHelper,node);}else{if(isABL){transitionToGraphMatrixPie.call(this,oldTemplateID,oldGMHelper,newGMHelper,node);}else{if(isNetwork){transitionNetworkToPie.call(this,newGMHelper,node);}else{if(isMap){transitionMapToPie.call(this,oldTemplateID,newGMHelper,node);}else{if(isHeatMap){transitionHeatmapToPie.call(this,newGMHelper,node);}else{if(isImageLayout){transitionImageLayoutToPie.call(this,newGMHelper,node);}else{transitionFromGridToPie.call(this,newGMHelper,node);}}}}}}}}}}else{doFlashTransition.call(this,oldTemplateID,newTemplateID,actions,node,newGMHelper,oldGMHelper);}}}}}}if(newIsNGM){moveSecondaryAxisToPrimary(newGMHelper,"xAxisObjects");moveSecondaryAxisToPrimary(newGMHelper,"yAxisObjects");}handleCombinedTooltipZone.call(this,newGMHelper,newIsNGM);addProperties.call(this,this.definition,newGMHelper);addThresholds.call(this,node,newGMHelper,thresholdActions);if(newIsPie){addSubTotalOnSliceAttr.call(this,newGMHelper,actions,node);}clearAllSubTotals.call(this,node,thresholdActions);var dzActions=newGMHelper.getAddDropZonesAction();dzActions.actions=templateActions.concat(dzActions.actions).concat(thresholdActions);if(dzActions.actions.length){actions.push(dzActions);}if(oldIsOGM||oldIsNGM){var vis=this.vis,newFitMode,gmProp=vis.property,currFitMode=oldIsNGM?parseInt(gmProp.hGetPropValue(ENUM_FORMAT_TAG.CONTAINER_FIT_MODE)):gmProp.hGetPropValue(ENUM_XML_TAG.FIT_TO),map={},newGMModes=[ENUM_NGM_FIT_MODES.FIT_TO_CONTENT,ENUM_NGM_FIT_MODES.AUTOMATIC,ENUM_NGM_FIT_MODES.FIT_TO_CONTAINER],oldGMModes=["Content","Window","Compact"];newGMModes.forEach(function(value,i){map[value]=oldGMModes[i];});oldGMModes.forEach(function(value,i){map[value]=newGMModes[i];});if((!currFitMode||currFitMode==="Content"||currFitMode===ENUM_NGM_FIT_MODES.FIT_TO_CONTENT)&&newIsHistogram){currFitMode=undefined;}newFitMode=map[currFitMode];if(oldIsNGM&&newIsOGM){gmProp.hSetPropValue(ENUM_XML_TAG.FIT_TO,newFitMode);}else{if(oldIsOGM&&newIsNGM){vis.setWidgetPropertyValue(ENUM_FORMAT_TAG.CONTAINER_FIT_MODE,newFitMode);}else{if(newIsHistogram&&!currFitMode){vis.setWidgetPropertyValue(ENUM_FORMAT_TAG.CONTAINER_FIT_MODE,currFitMode);}}}}return newGMHelper;}function getTransistionInfo(oldTemplateID,newTemplateID,actions,node){this.templateInfo=getTemplateInfo.call(this,node);this.definition=getDefinition.call(this,newTemplateID);var gmHelper=transition.call(this,oldTemplateID,newTemplateID,actions,node);return{wp:gmHelper.getXml(),handled:gmHelper.handled};}mstrmojo.vi.viz.GMVisualizationTransition=mstrmojo.declare(mstrmojo.vi.viz.VisualizationTransition,null,{scriptClass:"mstrmojo.vi.viz.GMVisualizationTransition",templateInfo:null,definition:null,markedObjects:null,chartInfo:null,init:function init(props){this._super(props);this.markedObjects=[];},transitionDropZones:function transitionDropZones(actions,vt){var transitionData,vis=this.vis,data=vis.node.data,curVisName=data.visName||$GRID,fnMapNewTemplate=function(w,vt){var vtIsObj=(typeof vt==="object"),newVT=vtIsObj?vt.v:vt;if(isHorizontalGraphMatrix2(w.node)&&vtIsObj){newVT=vt.h;}return newVT;};vt=fnMapNewTemplate.call(this,vis,vt);switch($KNOWN_VIZ.getDefinition(curVisName).id){case $KNOWN_VIZ.GRAPHMATRIX:case $KNOWN_VIZ.NEWGRAPHMATRIX:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.UNKNOWN_GRAPHMATRIX_TYPE,vt,actions,vis.node);break;case $KNOWN_VIZ.ESRIMAP:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.ESRIMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.GOOGLEMAP:case $KNOWN_VIZ.MAPBOX:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.GOOGLEMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.HEATMAP:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.HEATMAP,vt,actions,vis.node);break;case $KNOWN_VIZ.IMAGELAYOUT:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.IMAGELAYOUT,vt,actions,vis.node);break;case $KNOWN_VIZ.NETWORK:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.NETWORK,vt,actions,vis.node);break;case $KNOWN_VIZ.KPICARD:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.KPICARD,vt,actions,vis.node);break;default:transitionData=getTransistionInfo.call(this,$VIZTEMPLATES.GRID,vt,actions,vis.node);break;}return transitionData;}});}());