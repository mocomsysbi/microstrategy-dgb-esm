(function(){mstrmojo.requiresClsP("mstrmojo","Editor","HBox","Button","Label","TextBox","hash","dom","css","array","desc");mstrmojo.requiresCls("mstrmojo.warehouse.EnumDatabaseType","mstrmojo.ui.Checkbox","mstrmojo.ui.Pulldown","mstrmojo.ui.CheckList");mstrmojo.requiresDescs(959,2056,15656,15657,15658,15659,15660,15661,2397,2399);var $DBT=mstrmojo.warehouse.EnumDatabaseType,$HASH=mstrmojo.hash,$ARR=mstrmojo.array,$DOM=mstrmojo.dom,$CSS=mstrmojo.css,$DESC=mstrmojo.desc;var FS_ITEMS=[{v:"",n:$DESC(959,"Default")},{v:"General Number",},{v:"Standard"},{v:"Currency"},{v:"Percent"},{v:"Scientific"},{v:"General Date"},{v:"Long Date"},{v:"Short Date"},{n:$DESC(2056,"Custom")}];FS_ITEMS.forEach(function(item){if(item.n===undefined){item.n=item.v;}});var CONSTRAINT_SOLVE_ORDER={};CONSTRAINT_SOLVE_ORDER[$DBT.MSAS]={min:0,max:65535,maxlength:5};CONSTRAINT_SOLVE_ORDER[$DBT.EssBase]={min:0,max:126,maxlength:3};function parseSolveOderValue(value,dbt){var res=null,constraint=CONSTRAINT_SOLVE_ORDER[dbt],regExp=/^-?\d+$/;if(regExp.test(value)){value=parseInt(value);if(constraint&&value>=constraint.min&&value<=constraint.max||!constraint){res=value;}}return res;}function validateFormatString(fs){var regExp=/(\"|\-\-|\/\/|\/\*|\*\/)/;return fs&&fs.length&&!regExp.test(fs);}var DEFAULT_CONFIG={mptf:{mptso:{pru:1,v:500},mptsim:{pru:1,v:0},mptfms:""},dbt:$DBT.MSAS,so_dft:0,sim_dft:0};function getDefaultConfig(){return $HASH.clone(DEFAULT_CONFIG);}function getOptionFromConfig(opt){switch(opt){case"so":return this.config.mptf.mptso;case"si":return this.config.mptf.mptsim;case"fs":return this.config.mptf.mptfms;case"dbt":return this.config.dbt;case"soDefault":return this.config.so_dft;case"siDefault":return this.config.sim_dft;}}function getCurrentOptions(){return{mptso:{pru:this.soBox.soDefaultCb.checked?1:0,v:parseInt(this.soBox.soTB.value)},mptsim:{pru:this.siBox.siDefaultCbBox.siDefaultCb.checked?1:0,v:this.siBox.siClBox.siCl.selectedIndex},mptfms:this.fsBox.fsTbBox.fsTb.value};}mstrmojo.PassThroughOptions=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.PassThroughOptions",cssClass:"mstrmojo-PassThroughOptions",title:$DESC(15656,"Pass-through Options"),updatePopupConfig:function updatePopupConfig(config,opener){if(config){this.onOK=config.onOK;delete config.onOK;}["left","top","width","height","zIndex"].forEach(function(prop){if(config[prop]!==undefined){this.set(prop,config[prop]);delete config[prop];}}.bind(this));var dCfg=getDefaultConfig();$HASH.forEach(config,function(v,k){if(v===undefined){delete config[k];}});this.config=$HASH.copy(config,dCfg);},onOpen:function onOpen(){this.soBox.set("dirty",false);this.soBox.set("valid",true);this.siBox.set("dirty",false);this.fsBox.set("dirty",false);this.fsBox.set("valid",true);var isEssbase=getOptionFromConfig.call(this,"dbt")===$DBT.EssBase,so=getOptionFromConfig.call(this,"so");$CSS.toggleClass(this.editorNode,"ess",isEssbase);this.soBox.soDefaultCb.set("checked",so.pru);if(!so.pru){this.soBox.soTB.set("value",so.v);}else{this.soBox.soTB.set("value",getOptionFromConfig.call(this,"soDefault"));}if(!isEssbase){var si=getOptionFromConfig.call(this,"si"),fs=getOptionFromConfig.call(this,"fs"),fsIndex;this.siBox.siDefaultCbBox.siDefaultCb.set("checked",si.pru);if(!si.pru){this.siBox.siClBox.siCl.select(si.v);}else{this.siBox.siClBox.siCl.select(getOptionFromConfig.call(this,"siDefault"));}fsIndex=$ARR.find(FS_ITEMS,"v",fs);if(fsIndex<0){fsIndex=$ARR.find(FS_ITEMS,"v",undefined);}this.fsBox.fsPdBox.fsPd.set("selectedIndex",fsIndex);this.fsBox.fsTbBox.fsTb.set("value",fs);}},children:[{scriptClass:"mstrmojo.Box",alias:"soBox",cssClass:"mstrmojo-PassThroughOptions-soBox",processDirty:function processDirty(){var ptoEditor=this.parent,soInCfg=getOptionFromConfig.call(ptoEditor,"so"),pruInCfg=soInCfg.pru,vInCfg=soInCfg.v,pru=this.soDefaultCb.checked,v=this.soTB.value,dirty=pruInCfg!=pru||(!pru&&vInCfg!=v);this.set("dirty",dirty);},children:[{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",text:$DESC(15657,"Solve Order:")},{scriptClass:"mstrmojo.TextBox",alias:"soTB",cssClass:"mstrmojo-PassThroughOptions-soTB",cssDisplay:"inline-block",useRichTooltip:true,enabled:false,updateTooltipConfig:function(){var ptoEditor=this.parent.parent,target=this.domNode,position=$DOM.position(target),dbt=getOptionFromConfig.call(ptoEditor,"dbt"),content=$DESC(15658,"The value has to be between # and ##.").replace("#",CONSTRAINT_SOLVE_ORDER[dbt].min).replace("##",CONSTRAINT_SOLVE_ORDER[dbt].max);this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:content,top:position.y,left:position.x};},onvalueChange:function(){var ptoEditor=this.parent.parent,dbt=getOptionFromConfig.call(ptoEditor,"dbt"),so=parseSolveOderValue(this.value,dbt),valid=(so!=null);this.set("textValid",valid);if(!valid){this.showTooltip();}else{this.hideTooltip();}this.parent.set("valid",valid);this.parent.processDirty();}},{scriptClass:"mstrmojo.Label",cssDisplay:"inline-block",cssClass:"right",text:$DESC(959,"Default")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"soDefaultCb",cssDisplay:"inline-block",cssClass:"right",checked:true,oncheckedChange:function(evt){var ptoEditor=this.parent.parent,soTB=this.parent.soTB,checked=this.checked;soTB.set("enabled",!checked);if(checked){soTB.set("value",getOptionFromConfig.call(ptoEditor,"soDefault"));}this.parent.processDirty();}}]},{scriptClass:"mstrmojo.Box",alias:"siBox",cssClass:"mstrmojo-PassThroughOptions-siBox",processDirty:function processDirty(){var ptoEditor=this.parent,siInCfg=getOptionFromConfig.call(ptoEditor,"si"),pruInCfg=siInCfg.pru,vInCfg=siInCfg.v,pru=this.siDefaultCbBox.siDefaultCb.checked,v=this.siClBox.siCl.selectedIndex,dirty=pruInCfg!=pru||(!pru&&vInCfg!=v);this.set("dirty",dirty);},children:[{scriptClass:"mstrmojo.HBox",alias:"siDefaultCbBox",cssClass:"mstrmojo-PassThroughOptions-siDefaultCbBox",children:[{scriptClass:"mstrmojo.Label",text:$DESC(15659,"Scope Isolation:")},{scriptClass:"mstrmojo.ui.Checkbox",alias:"siDefaultCb",checked:true,oncheckedChange:function(evt){var siBox=this.parent.parent,ptoEditor=siBox.parent,siCl=siBox.siClBox.siCl;siCl.set("enabled",!this.checked);if(this.checked){siCl.select(getOptionFromConfig.call(ptoEditor,"siDefault"));}siBox.processDirty();}},{scriptClass:"mstrmojo.Label",text:$DESC(959,"Default")}]},{scriptClass:"mstrmojo.HBox",alias:"siClBox",cssClass:"mstrmojo-PassThroughOptions-siClBox",children:[{scriptClass:"mstrmojo.ui.CheckList",alias:"siCl",multiSelect:false,orientation:"h",selectedIndex:1,items:[{n:"NONE",v:0},{n:"CUBE",v:1}],onchange:function(evt){this.parent.parent.processDirty();}}]}]},{scriptClass:"mstrmojo.Box",alias:"fsBox",cssClass:"mstrmojo-PassThroughOptions-fsBox",children:[{scriptClass:"mstrmojo.HBox",alias:"fsPdBox",cssClass:"mstrmojo-PassThroughOptions-fsPdBox",children:[{scriptClass:"mstrmojo.Label",text:$DESC(15660,"Format String:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"fsPd",selectedIndex:0,items:FS_ITEMS,onselectedIndexChange:function(){var item=this.getSelectedItem(),isCustom=item&&item.v===undefined,fsTb=this.parent.parent.fsTbBox.fsTb;fsTb.set("visible",isCustom);if(isCustom){fsTb.set("value","");}else{fsTb.set("value",item&&item.v);}}}]},{scriptClass:"mstrmojo.HBox",alias:"fsTbBox",cssClass:"mstrmojo-PassThroughOptions-fsTbBox",children:[{scriptClass:"mstrmojo.TextBox",alias:"fsTb",updateTooltipConfig:function(){var target=this.domNode,position=$DOM.position(target),content=$DESC(15661,'Custom Format String should not be empty or contain ",Â //, --, /*, */.');this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT,content:content,top:position.y,left:position.x};},onvalueChange:function(){var fsBox=this.parent.parent;fsBox.processDirty();},bindings:{textValid:function(){var selectedIndex=this.parent.parent.fsPdBox.fsPd.selectedIndex,fsBox=this.parent.parent,selectedItem=fsBox.fsPdBox.fsPd.getSelectedItem(),isCustom=selectedItem&&selectedItem.v===undefined,valid=!isCustom||validateFormatString(this.value);fsBox.set("valid",valid);if(!valid){this.showTooltip();}else{this.hideTooltip();}return valid;}}}]}],processDirty:function(){var currV=this.fsTbBox.fsTb.value,vInCfg=getOptionFromConfig.call(this.parent,"fs");this.set("dirty",currV!==vInCfg);}},{scriptClass:"mstrmojo.HBox",alias:"buttonBar",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",cellCssClass:"subBox",children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton hot",alias:"saveokButton",text:$DESC(2397,"OK"),bindings:{enabled:function(){var soDirty=this.parent.parent.soBox.dirty,siDirty=this.parent.parent.siBox.dirty,fsDirty=this.parent.parent.fsBox.dirty,soValid=this.parent.parent.soBox.valid,fsValid=this.parent.parent.fsBox.valid;return(soDirty||siDirty||fsDirty)&&(soValid&&fsValid);}},onclick:function(){if(this.enabled){var ptoEditor=this.parent.parent;if(ptoEditor.onOK){ptoEditor.onOK(getCurrentOptions.call(ptoEditor));}ptoEditor.close();}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Editor-button mstrmojo-WebButton",text:$DESC(2399,"Cancel"),onclick:function(){var ptoEditor=this.parent.parent;ptoEditor.close();}}]}]});}());