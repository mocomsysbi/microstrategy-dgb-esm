(function(){mstrmojo.requiresCls("mstrmojo._IsWebApp","mstrmojo.vi.factories.ModelFactory","mstrmojo.hash","mstrmojo.css","mstrmojo.array","mstrmojo.color","mstrmojo.dom","mstrmojo.func","mstrmojo.form","mstrmojo.vi.enums.EnumFeatures","mstrmojo.VisUtility","mstrmojo.gm.GMUtility");mstrmojo.requiresDescs(6828,13159,13160,13162,13163,13353,15490,13376,13407,13345,13346,13347,13348,15486,15487,13351,15488,13472,13473,13339,13340,13341,13342,13343,13344,13538,13539,13988);var STATE_DEFAULT=1,STATE_PRESENTATION=2,STATE_SELECTOR_TARGETING=4,STATE_PRINT_PREVIEW=8,STATE_PAUSE=16,$DOM=mstrmojo.dom,$FUNC=mstrmojo.func,FEATURES=mstrmojo.vi.enums.EnumFeatures,$GMU=mstrmojo.gm.GMUtility;var LAYOUT_DEFAULT=0,LAYOUT_PREVIEW_TOGGLED=1,LAYOUT_PREVIEW_RESIZE=2;window.mstrConfig=mstrConfig;var requestQueue=[];function submitNextInQueue(){if(requestQueue.length===0){return ;}var currentRequest=requestQueue.shift(),me=this;this._super.call(this,currentRequest.params,$FUNC.wrapMethods(currentRequest.callback,{success:function success(){submitNextInQueue.call(me);}}),currentRequest.config);}mstrmojo.vi.VisualInsightAppBase=mstrmojo.declare(mstrmojo.Obj,[mstrmojo._IsWebApp],{scriptClass:"mstrmojo.vi.VisualInsightApp",isVI:true,isSingleTier:false,appState:STATE_DEFAULT,layoutMode:LAYOUT_DEFAULT,pageName:"",styleName:"RWIVEMojoStyle",rootCtrl:null,menubarModelData:null,tbModelData:null,enableWaitBox:true,customization:{},hiddenSecState:null,hiddenSec:null,start:function start(docModelData){},getRootController:function getRootController(){},getPreferredColors:function(){return mstrmojo.array.map(this.rootCtrl.docCtrl.model.getCurrentPaletteColors(),function(encodedColor){return mstrmojo.color.decodeColor(encodedColor);});},serverRequest:function serverRequest(params,callback,config){try{var bs=this.docModelData.bs,enableLogging=mstrApp.enableLoggingRequest,timerId=enableLogging?$GMU.startTimer({functionName:params.taskId}):undefined,isResolveOnly=!!(mstrConfig&&mstrConfig.resolveOnly||this.isAppStatePause&&this.isAppStatePause());if(params.rapidExec&&!mstrApp.isDossier){config.silent=true;params.resolveOnly=true;params.excludeData=true;if(callback){if(callback.submission){callback.submission();}var stid=this.getRootController().docCtrl.model.getDataService().stid+1;if(callback.success){callback.success({stid:stid});}if(enableLogging){mstrmojo.VisUtility.visPrint("%c[Response received at: "+new Date().toLocaleString()+"] on taskId: "+params.taskId+", time consumed: "+$GMU.endTimer(timerId)+" ms","color: green");}if(callback.complete){callback.complete({stid:stid});}}callback=undefined;}else{callback=$FUNC.override({success:function(res,request){if(res.isPrompted){mstrmojo.form.send({evt:5005,src:mstrApp.name+"."+mstrApp.pageName+".5005",resolveOnly:isResolveOnly,preventCancelPrompt:!(config&&config.canCancelPrompt),rwb:bs});}else{if(res.prompted&&res.promptState===2){var callbackFn=this._super,showPrompt=function showPrompt(result){var fnOnApply={success:function success(data){if(data.PromptEditor){showPrompt(data);}else{mstrApp.getRootController().updatePromptStatus(data.prompted||data.hasPrompted==="1");callbackFn(data,request);}}},fnOnCancel=mstrmojo.emptyFn;mstrApp.getRootController().openPrompt({required:false,mid:result.mid,noCancel:true,editor:result.PromptEditor,model:result.ReportInstanceModel,settings:result.Settings,onApply:fnOnApply,onCancel:fnOnCancel});};showPrompt(res);}else{return this._super(res,request);}}},complete:function complete(res){if(enableLogging){mstrmojo.VisUtility.visPrint("%c[Response received at: "+new Date().toLocaleString()+"] on taskId: "+params.taskId+", time consumed: "+$GMU.endTimer(timerId)+" ms","color: green");}if(this._super){this._super(res);}}},callback);}requestQueue.push({params:params,callback:callback,config:config});submitNextInQueue.call(this);}catch(ex){mstrmojo.err(ex);}},serverResponse:function serverResponse(id,methodName,requestID,status,responseJSON){var obj=mstrmojo.all[id];if(obj){obj[methodName](requestID,!!status,responseJSON);}},onerror:function onerror(res,callback){if(!res||res.handledError){return ;}var msg=[],map={title:"",message:mstrmojo.desc(6828,"Error:")+" ",sourceURL:"Source URL: ",fileName:"File: ",lineNumber:"Line: ",line:"Line: "};mstrmojo.hash.forEach(map,function(v,n){if(res[n]!==undefined){msg.push(v+res[n]);if(n==="title"){msg.push("");}}});if(res.getResponseHeader){msg.push("XHR: "+res.getResponseHeader("X-MSTR-TaskFailureMsg"));}var message=msg.join("\n");if(message.length){mstrmojo.error({longDesc:message},callback);res.handledError=true;mstrmojo.dbg(res.stack||message);}},showWait:function showWait(config){var waitBox=this._super(config),themeClassName=this.rootCtrl.view.themeClassName;if(themeClassName){waitBox.set("themeClassName",themeClassName);}},getWaitBoxPosition:function getWaitBoxPosition(){var view=this.rootCtrl.view;return{top:$DOM.position(view.pathbarNode).h+$DOM.position(view.menuToolbarNode).h+2};},getShowVIWelcome:function getShowVIWelcome(){return false;},executeCommand:function executeCommand(cmdId,cmdValue){if(typeof this[cmdId]==="function"){this[cmdId](cmdValue);}else{this.rootCtrl.executeCommand(cmdId,cmdValue);}},setDefaultAppState:function setDefaultAppState(){this.set("appState",STATE_DEFAULT);},isAppStateDefault:function isAppStateDefault(){return !!(this.appState&STATE_DEFAULT);},isAppStateDefault:function isAppStateDefault(){return this.appState===STATE_DEFAULT;},isAppStatePresentation:function isAppStatePresentation(){return !!(this.appState&STATE_PRESENTATION);},isAppStatePrintPreview:function isAppStatePrintPreview(){return !!(this.appState&STATE_PRINT_PREVIEW);},isAppStateSelection:function isAppStateSelection(){return !!(this.appState&STATE_SELECTOR_TARGETING);},isAppStatePause:function isAppStatePause(){return !!(this.appState&STATE_PAUSE);},isLayoutModePreview:function isLayoutModePreview(){return this.isLayoutPreview(this.layoutMode);},isLayoutPreview:function isLayoutPreview(layout){return layout===LAYOUT_PREVIEW_TOGGLED||(this.supportFeature(FEATURES.SUPPORT_RESPONSIVE_RESIZING)&&layout===LAYOUT_PREVIEW_RESIZE);},allowWebDashboardDesign:function allowWebDashboardDesign(){var features=this.features;return !(features&&features["disable-dashboard-design"]);},setTheme:function setTheme(themeId){this.rootCtrl.setTheme(themeId);},getThemeClassName:function getThemeClassName(){return this.rootCtrl.view.themeClassName;},setPalette:function setPalette(paletteId){this.rootCtrl.setPalette(paletteId);},resetCmdMgr:function resetCmdMgr(){this.rootCtrl.resetCmdMgr();},supportFeature:function supportFeature(feature){var WEB_FEATURES=mstrApp.features||{};switch(feature){case FEATURES.SUPPORT_RESPONSIVE:return !this.isAppStatePresentation()||mstrApp.isDossier;case FEATURES.SUPPORT_RESPONSIVE_RESIZING:return mstrApp.isDossier;case FEATURES.SUPPORT_GHOST_IMG:return true;case FEATURES.SUPPORT_CONDITION_METRIC:return true;case FEATURES.USE_WORKSTATION_NAMING_STYLE:return true;case FEATURES.SUPPORT_TOC_UPDATEPOISITION:return !mstrApp.isDossier&&mstrApp.isWSStyling;case FEATURES.SUPPORT_LIVEMODE:return mstrApp.isWorkstation&&!mstrApp.isDossier;case FEATURES.DATA_ENGINE_VERSION:return mstrApp.isWorkstation&&!mstrApp.getWSLiveMode();}return !!WEB_FEATURES[feature];},updateFeatureFlag:function updateFeatureFlag(res,callback){mstrApp.features=mstrApp.features||{};if(res&&res.feature_flag){switch(res.feature_flag.NGMTypeFlag){case 1989:case 6574:mstrApp.features.ngm=true;mstrApp.features.ngmPartial=false;break;case 0:mstrApp.features.ngm=false;mstrApp.features.ngmPartial=false;break;case 1:default:mstrApp.features.ngm=true;mstrApp.features.ngmPartial=true;}}if(callback){callback();}},setPalette:function setPalette(paletteId){this.rootCtrl.setPalette(paletteId);},setTheme:function setTheme(themeId){this.rootCtrl.setTheme(themeId);},getThemeClassName:function getThemeClassName(){return this.rootCtrl.view.themeClassName;},resetCmdMgr:function resetCmdMgr(){this.rootCtrl.resetCmdMgr();},getDefaultAppState:function getDefaultAppState(){return STATE_DEFAULT;}});mstrmojo.vi.VisualInsightAppBase.APP_STATES={DEFAULT:STATE_DEFAULT,PRESENTATION:STATE_PRESENTATION,PRINT_PREVIEW:STATE_PRINT_PREVIEW,SELECTOR_TARGETING:STATE_SELECTOR_TARGETING,PAUSE:STATE_PAUSE};mstrmojo.vi.VisualInsightAppBase.LAYOUT_MODES={DEFAULT:LAYOUT_DEFAULT,PREVIEW_TOGGLED:LAYOUT_PREVIEW_TOGGLED,PREVIEW_RESIZE:LAYOUT_PREVIEW_RESIZE};}());