(function(){mstrmojo.requiresCls("mstrmojo.DocSelector","mstrmojo.vi.ui.rw.selectors.SearchableCheckList","mstrmojo.vi.ui.rw.selectors.LevelCheckList","mstrmojo.vi.ui.rw.selectors.LevelPopupList","mstrmojo.vi.ui.rw.selectors.HierarchyCheckList","mstrmojo.vi.ui.rw.selectors.PageBySlider","mstrmojo.vi.ui.rw.selectors.PageByButtonBar","mstrmojo.vi.ui.rw.selectors.MetricQualification","mstrmojo.vi.ui.rw.selectors.MetricSlider","mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.LinkList","mstrmojo.vi.ui.rw.selectors.ListBoxSelector","mstrmojo.vi.ui.rw.selectors.VisSelectorBox","mstrmojo.array","mstrmojo.css","mstrmojo.hash");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array,$SELECTOR_ROOT="vi.ui.rw.selectors.",$STYLES=mstrmojo.DocSelector.STYLES;var TP_ATTRIBUTE=12,TP_CONSOLIDATION=47,STP_DERIVED_ELEMENT=12033,STP_RECURSIVE_ATTRIBUTE=3076;var widgetMap={};widgetMap[$STYLES.CHECKBOX]=widgetMap[$STYLES.RADIO]=$SELECTOR_ROOT+"SearchableCheckList";widgetMap[$STYLES.LIST]=["ListBoxHoriz",$SELECTOR_ROOT+"ListBoxSelector"];widgetMap[$STYLES.SCROLLER]=$SELECTOR_ROOT+"Slider";widgetMap[$STYLES.METRIC_SLIDER]=$SELECTOR_ROOT+"MetricSlider";widgetMap[$STYLES.METRIC_QUAL]=$SELECTOR_ROOT+"MetricQualification";widgetMap[$STYLES.LINK]=widgetMap[$STYLES.BUTTON]=$SELECTOR_ROOT+"LinkList";widgetMap[$STYLES.VISUALIZATION]=$SELECTOR_ROOT+"VisSelectorBox";function isSelectContiguous(indices){var keys=Object.keys(indices),cnt=keys.length,rangeCnt=cnt-1,min=$ARR.applyLargeArray(keys,Math.min,Number.POSITIVE_INFINITY),max=$ARR.applyLargeArray(keys,Math.max,Number.NEGATIVE_INFINITY);return cnt===0||max-min===rangeCnt;}mstrmojo.vi.ui.rw.selectors._IsDocSelector=mstrmojo.provide("mstrmojo.vi.ui.rw.selectors._IsDocSelector",{_mixinName:"mstrmojo.vi.ui.rw.selectors._IsDocSelector",model:null,multi:false,k:"",init:function init(props){this._super(props);mstrmojo.css.addWidgetCssClass(this,"vi-DocSelector");},layoutConfig:{h:{containerNode:"100%"},w:{containerNode:"100%"},xt:true},getLayoutOffsets:function getLayoutOffsets(){if(this.isInFilterPanel()){return null;}return{h:18,w:18};},update:function update(node){var formats=node.defn&&node.defn.fmts||{},isPageBy=this.isViPageBy,definition=node.defn;if(isPageBy||this.isInFilterPanel()){definition.fmts=$HASH.copyProps(["height","z-index"],formats);}else{definition.fmts=$HASH.copy(formats);}if(isPageBy){definition.multi=false;}this._super(node);},preBuildRendering:function preBuildRendering(){if(!this.isViPageBy&&!this.isInFilterPanel()){this.formatHandlers={domNode:["F","text-align","vertical-align","line-height"],contentNode:["fx"],item:["F","text-align","line-height"]};}var selectorStyle=this.style,isRadio=selectorStyle===$STYLES.RADIO,isCheckBox=selectorStyle===$STYLES.CHECKBOX;if(isCheckBox||isRadio||selectorStyle===$STYLES.LINK||selectorStyle===$STYLES.BUTTON){var ctrl=this.children[0];ctrl.orientation=this.node.defn.horiz?"h":"v";if(isCheckBox||isRadio){ctrl.multiSelect=!isRadio;}}this.content.hostedCSSClass="selector";this._super();},postBuildRendering:function postBuildRendering(evt){if(this.bindWarningHandler){this.bindWarningHandler(this,this.content);this.validate();}return this._super(evt);},getWidgetClass:function getWidgetClass(selectorContainer,selectorStyle,isHoriz){if(selectorContainer.isViPageBy){if(selectorStyle===$STYLES.SCROLLER){return $SELECTOR_ROOT+"PageBySlider";}if(selectorStyle===$STYLES.BUTTON){return $SELECTOR_ROOT+"PageByButtonBar";}}if(this.isRecursiveAttributeSelector()&&selectorStyle===$STYLES.CHECKBOX){if(this.isInFilterPanel()){return $SELECTOR_ROOT+"HierarchyCheckList";}else{return $SELECTOR_ROOT+(isHoriz?"LevelPopupList":"LevelCheckList");}}var scriptClass=widgetMap[selectorStyle];if(scriptClass){if(scriptClass.constructor===Array){scriptClass=scriptClass[isHoriz?0:1];}return scriptClass;}return this._super(selectorContainer,selectorStyle,isHoriz);},updateWidget:function updateWidget(selectorContainer){var selectorCtrl=this._super(selectorContainer);if(selectorContainer.style===mstrmojo.DocSelector.STYLES.SCROLLER&&!isSelectContiguous(selectorContainer.selIdx)){selectorCtrl.selectedIndices={};}return selectorCtrl;},validate:function validate(){if(this.isValidSelection&&!this.isValidSelection()){this.set("validation",{refNode:this.parent.domNode,position:1,invalid:true,errorCode:"unableDisplaySelectionVIWarning"});}},getSelectorReplaceUnitList:function getSelectorReplaceList(){var units=[],existingUnits=[];if(!this.isRecursiveAttributeSelector()){return[];}if(this.isInFilterPanel()){existingUnits=this.getFilterPanel().getFilterDefinitions();}$HASH.forEach(this.model.datasets,function(dataset){$ARR.forEach(dataset.att,function(unit){var srcid=this.defn&&this.defn.srcid,srcInfo=this.model.getDEObject(srcid),unitSrcid=unit.did,unitSrcInfo=this.model.getDEObject(unitSrcid);if(!unit.hide&&srcid!==unitSrcid&&$ARR.find(existingUnits,"srcid",unitSrcid)<0&&(srcInfo?srcInfo.attId:srcid)===(unitSrcInfo?unitSrcInfo.attId:unitSrcid)){units.push(unit);}},this);},this);return units;}});}());