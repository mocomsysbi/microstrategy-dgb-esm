(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.geometry.SVGImage","mstrmojo.gmaps.geometry.Pin","mstrmojo.gmaps.geometry.Square","mstrmojo.gmaps.geometry.Diamond","mstrmojo.gmaps.layer.svg.GraphicLayerViewer","mstrmojo.gmaps.layer.svg._ClusterViewerWrapper");var $MOJO=mstrmojo,$HASH=$MOJO.hash,$GMAPS=$MOJO.gmaps,$MUTIL=$GMAPS.MapUtils,$GEOMETRY=$GMAPS.geometry,$EnumThType=$GMAPS.EnumThresholdType,$EnumMarkerType=$GMAPS.EnumMarkerType,DEFAULT_IMG=mstrmojo.getStyleRoot()+"/../images/balloonpp.png",textMarkerStyle={fontFamily:"Serif",fontSize:"12pt",fontWeight:"bold",fontStyle:"normal"};function addGeometryThresholdParams(threshold,params){var text;if(!threshold){return ;}params.imgUrl=threshold.url||params.imgUrl;params.fillColor=threshold.colorStr||params.fillColor;text=threshold.text;if($MUTIL.checkDefined(text)){params.text=text;$HASH.copy(textMarkerStyle,params);}}mstrmojo.gmaps.layer.svg.MarkerLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.GraphicLayerViewer,[mstrmojo.gmaps.layer.svg._ClusterViewerWrapper],{scriptClass:"mstrmojo.gmaps.layer.svg.MarkerLayerViewer",imageMarkerUrl:null,isCluster:null,clusterMode:null,isMarkerMapType:true,getGmtCls:function getGmtCls(attributes){var GmtClass,threshold=attributes&&attributes.threshold;switch(this.markerType){case $EnumMarkerType.Pin:default:GmtClass=$GEOMETRY.Pin;break;case $EnumMarkerType.Square:GmtClass=$GEOMETRY.Square;break;case $EnumMarkerType.Diamond:GmtClass=$GEOMETRY.Diamond;break;case $EnumMarkerType.Image:GmtClass=$GEOMETRY.SVGImage;break;}return threshold?this.getThresholdGeometryClass(GmtClass,threshold):GmtClass;},getThresholdGeometryClass:function getThresholdGeometryClass(gmtClass,threshold){var result=gmtClass;if(this.applyThreshold){if(this.needApplyThresholdForImages(threshold)){result=$GEOMETRY.Pin;}else{switch(threshold.type){case $EnumThType.Url:result=$GEOMETRY.SVGImage;break;case $EnumThType.Text:result=$GEOMETRY.Text;break;}}}return result;},needApplyThresholdForImages:function needApplyThresholdForImages(threshold){return !!threshold&&(threshold.type===$EnumThType.Number||threshold.type===$EnumThType.Default)&&this.markerType===$EnumMarkerType.Image&&this.imageMarkerUrl;},getGeometryParams:function getGeometryParams(graphic){if(!graphic||!graphic.attributes){return ;}var screenData=graphic.screenData,threshold=graphic.attributes.threshold,params=$HASH.copy(this.getFmts());if(screenData&&$MUTIL.checkVal(screenData.x)&&$MUTIL.checkVal(screenData.y)){params.x=screenData.x;params.y=screenData.y;}if(this.markerType===$EnumMarkerType.Image){params.imgUrl=this.imageMarkerUrl?mstrmojo.getStyleRoot()+"/../"+this.imageMarkerUrl:DEFAULT_IMG;}addGeometryThresholdParams(threshold,params);return params;},setMarkerType:function setMarkerType(markerType){if(markerType===this.markerType){return ;}this.markerType=markerType;this.buildGeometries();},setClusterMode:function setClusterMode(clusterMode,isCluster){this.clusterMode=clusterMode;this.isCluster=isCluster;this.setVisibility(false);this.clean();this.desolveClusterGraphics();if(isCluster){this.buildClusterGraphics();}this.appendGeometries();this.setVisibility(true);},desolveClustersIfZoomChanged:function desolveClustersIfZoomChanged(){if(this._zoom!==this.getMapZoom()){this.desolveClusterGraphics();}},isZoomChanged:function isZoomChanged(){var currentZoom=this.getMapZoom();if(this._zoom!==currentZoom){this._zoom=currentZoom;return true;}},update:function update(){var isCluster=this.isCluster;if(isCluster&&this.isZoomChanged()){this.setClusterMode(this.clusterMode,isCluster);}this._super();}});}());