(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.Widget","mstrmojo.array","mstrmojo.VisUtility","mstrmojo.ui._HasScroller");var $MOJO=mstrmojo,$DOM=$MOJO.dom,$VISUTILS=$MOJO.VisUtility,$ARR=$MOJO.array,$CSS=$MOJO.css;mstrmojo.gm.GMScroll=mstrmojo.declare(mstrmojo.Widget,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.gm.GMScroll",cssClass:undefined,bodyClass:undefined,view:undefined,direction:undefined,markupString:'<div id="{@id}" class="gm-scrollbar"><div class="{@cssClass}"><div class="{@bodyClass}"></div></div></div>',markupSlots:{domContainer:function(){return this.domNode.firstChild;},domBody:function(){return this.domNode.firstChild.firstChild;}},init:function(props){this._super(props);},addScrollListener:function(){if(this.useNativeScrollBar()){$DOM.attachMarkupEvent(this.id,this.domContainer,"scroll");}this.overrideListeners();},setupScrollNodes:function(){this.scrollNode=this.domContainer;},onscroll:function onscroll(){this.view.updateChartsPosition(this.direction,this.getCurrentPosition());this._super();},toggleHoverState:function(hover){$CSS.toggleClass(this.domNode,"hover",hover);},updateScrollPosition:function(p){var node=this.domContainer;if(this.direction==="v"){if(node.scrollTop===p){return ;}node.scrollTop=p;}else{if(node.scrollLeft===p){return ;}node.scrollLeft=p;}},updateScrollbars:function updateScrollbars(){var domNode=this.domNode,domNodeStyle=domNode&&domNode.style,scrollNodeStyle;if(domNodeStyle===undefined){console.log("dom style is missing");return ;}this._super();if(this.scrollNode){scrollNodeStyle=this.scrollNode.style;if(this.direction==="v"){if(scrollNodeStyle.overflowY==="scroll"){domNodeStyle.display="block";}else{domNodeStyle.display="none";}}else{if(scrollNodeStyle.overflowX==="scroll"){domNodeStyle.display="block";}else{domNodeStyle.display="none";}}}},getCurrentPosition:function(){var node=this.domContainer;if(this.direction==="v"){return node.scrollTop;}return node.scrollLeft;},useNativeScrollBar:function(){return !this.hasCustomScrollbar;},overrideListeners:function(){var me=this;function pauseEvent(e){if(e.stopPropagation){e.stopPropagation();}if(e.preventDefault){e.preventDefault();}e.cancelBubble=true;return false;}function voidCallback(details){pauseEvent(details.event);}function setupScrollTrackNodes(){var scrollTrackClick;$ARR.forEach(me.installedEventListeners,function(h){if(h.evt==="click"){$DOM.detachEvent(h.e,h.evt,h.fn);scrollTrackClick=h.fn;}});function onClickScrollTrackCallback(details){me.toggleHoverState(true);scrollTrackClick.call(me,details.event);pauseEvent(details.event);}$VISUTILS.addTouchSupportHelper(me.scrollTrackNodes.v,me,voidCallback.bind(me),voidCallback.bind(me),onClickScrollTrackCallback.bind(me));$VISUTILS.addTouchSupportHelper(me.scrollTrackNodes.h,me,voidCallback.bind(me),voidCallback.bind(me),onClickScrollTrackCallback.bind(me));}function setupScrollBarNodes(){function scrollTrackWheelHandler(details){var scrollNode=me.scrollNode;mstrmojo.array.forEach(["h","v"],function(direction){var scrollBarProps=me.getDefaultScrollBarProps(direction),wheelDeltaProp="delta",wheelDelta=details[wheelDeltaProp+{h:"X",v:"Y"}[direction]],wheelDeltaAbs=Math.abs(wheelDelta);scrollNode[scrollBarProps.scroll]+=wheelDelta;});}function onDragScrollNodeMoveCallback(details){me.toggleHoverState(true);var scrollNode=me.scrollNode,scrollNodePos=$DOM.position(scrollNode),conversionRatio={y:scrollNode.scrollHeight/scrollNodePos.h,x:scrollNode.scrollWidth/scrollNodePos.w};details.deltaX=conversionRatio.x*details.deltaX;details.deltaY=conversionRatio.y*details.deltaY;scrollTrackWheelHandler(details);pauseEvent(details.event);}function onDragScrollNodeEndCallback(details){me.toggleHoverState(false);pauseEvent(details.event);}$VISUTILS.addTouchSupportHelper(me.scrollBarNodes.v,me,voidCallback.bind(me),onDragScrollNodeMoveCallback.bind(me),onDragScrollNodeEndCallback.bind(me));$VISUTILS.addTouchSupportHelper(me.scrollBarNodes.h,me,voidCallback.bind(me),onDragScrollNodeMoveCallback.bind(me),onDragScrollNodeEndCallback.bind(me));}if(me.scrollTrackNodes){setupScrollTrackNodes();}if(me.scrollBarNodes){setupScrollBarNodes();}}});}());