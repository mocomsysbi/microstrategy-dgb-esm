(function(){mstrmojo.requiresCls("mstrmojo.VBox","mstrmojo.array","mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItem");var spinnerCfg={scriptClass:"mstrmojo.DI.DISourceItem",icon:"mstrmojo-di-main-page-wait-box",iconData:"",dbTypeIconCls:"wait-box-icon",alias:"spinner",bindings:{visible:function(){return this.parent.showSpinner;}}};var constants=mstrmojo.DI.DIConstants,$A=mstrmojo.array;mstrmojo.DI.DISourceItemBox=mstrmojo.declare(mstrmojo.VBox,null,{scriptClass:"mstrmojo.DI.DISourceItemBox",markupString:'<table id="{@id}" class="mstrmojo-VBox {@cssClass}" style="position: relative; {@cssText}" cellspacing="0" cellpadding="0"><tr><td></td></tr></table>',showSpinner:true,setSrcLsrs:function(){return[];},asyncSrcFetched:function(){if(mstrApp.placeholder!=="DIApp"&&mstrApp.placeholder!=="mainDIApp"){return{};}var model=mstrApp.getRootController().getModel();return{DBTYPE_SOURCE:model.hasDBMSTypeFetched(),CLOUDELEMENT_CONNECTOR:model.hasCloudElementFetched(),CUSTOM_CONNECTOR:model.hasCustomConnenctFetched()};},postCreate:function(){var model=mstrApp.getRootController().model;if(this._super){this._super();}this.addChildren([spinnerCfg],true);this.addDisposable(model.attachEventListener(constants.srcItemTypes.DBTYPE_SOURCE,this.id,"updateSpinner"));this.addDisposable(model.attachEventListener(constants.srcItemTypes.CLOUDELEMENT_CONNECTOR,this.id,"updateSpinner"));this.addDisposable(model.attachEventListener(constants.srcItemTypes.CUSTOM_CONNECTOR,this.id,"updateSpinner"));this.updateSpinner();},updateSpinner:function(){var hasUnFetchedSrc=this.isAllListenedSrcFetched();if(!hasUnFetchedSrc){this.set("showSpinner",false);}},isAllListenedSrcFetched:function(){var listeners=this.setSrcLsrs(),$this=this;listeners=$A.filter(listeners,function(l){return typeof l!=="undefined";});return $A.some(listeners,function(l){return !$this.asyncSrcFetched()[l];});},addChildren:function(c,useSuper){if(useSuper){this._super(c);return ;}var length=this.children?this.children.length:undefined;this._super(c,!length||length<0?0:length-1);},removeChildren:function(c,useSuper){this._super(c);if(useSuper){return ;}this.addChildren([spinnerCfg],true);},removeItems:function(items){this.removeChildren(items,true);},addItems:function(items,isAppended){if(!isAppended){this.removeChildren();}this.addChildren(items);}});}());