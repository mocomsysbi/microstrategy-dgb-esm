(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.css");var $CSS=mstrmojo.css,KEY_CODE_NAME={9:"Tab",13:"Enter",27:"Esc",38:"ArrowUp",40:"ArrowDown"},CLEAR_BTN="sbClear",SEARCH_BTN="sbSearch";mstrmojo.SearchWidget=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.SearchWidget",quickSearch:false,quickSearchForClear:false,showClearNode:true,placeholderText:"",markupString:'<table id={@id} cellspacing="0" cellpadding="0" class="mstrmojo-SearchWidget mstrmojo-SearchBox-Wrapper {@cssClass}" style="{@cssText};"><tr><td><div class="mstrmojo-SearchBox" mstrAttach:click ><input class="mstrmojo-SearchBox-input" type="text" style="width:{@width};" placeholder="{@placeholderText}" mstrAttach:keyup,focus,blur/></div></td><td><div class="mstrmojo-SearchBox-clear" id="{@id}'+CLEAR_BTN+'" mstrAttach:click></div></td><td><div class="mstrmojo-SearchBox-bg"><div class="mstrmojo-SearchBox-search" id="{@id}'+SEARCH_BTN+'" mstrAttach:click ></div></div></td></tr></table>',markupSlots:{inputNode:function(){return this.domNode.rows[0].cells[0].firstChild.firstChild;},clearNode:function(){return this.domNode.rows[0].cells[1].firstChild;},searchNode:function(){return this.domNode.rows[0].cells[2].firstChild.firstChild;}},markupMethods:{onquickSearchChange:function(){$CSS.toggleClass(this.domNode,"quick-search",this.quickSearch);},onwidthChange:function(){if(this.inputNode&&this.inputNode.style&&this.inputNode.style.width){this.inputNode.style.width=this.width;}},ondisabledChange:function ondisabledChange(){var disabled=this.disabled;$CSS.toggleClass(this.domNode,"disabled",disabled);if(this.inputNode){this.inputNode.disabled=disabled;}}},clearNode:null,searchNode:null,isFocus:false,disabled:false,onsearch:mstrmojo.emptyFn,onclear:mstrmojo.emptyFn,prekeyup:function prekeyup(evt){var hWin=evt.hWin,e=evt.e||hWin.event;this.updateSearch();var n=KEY_CODE_NAME[e.keyCode];if(this["on"+n]){this["on"+n](evt);}},setClearIcon:function setClearIcon(){var parent=this.parent;if(!parent){return ;}var searchNode=parent.search&&parent.search.searchNode,pattern=this.getSearchPattern(),noPattern=(pattern.length===0);if(searchNode){$CSS.toggleClass(this.searchNode,"clear",!noPattern&&this.quickSearch);}},onEnter:function onEnter(evt){this.onsearch(this.getSearchPattern());},onEsc:function onEsc(evt){this.clearSearch();},getSearchPattern:function getSearchPattern(){return mstrmojo.string.trim(this.inputNode.value);},setSearchPattern:function getSearchPattern(pattern){if(this.inputNode){this.inputNode.value=pattern||"";this.updateSearch();}},preclick:function preclick(evt){var tgt=evt.getTarget(),id=tgt&&tgt.id;switch(id.replace(this.id,"")){case SEARCH_BTN:if(this.quickSearch){this.clearSearch();}else{this.onsearch(this.getSearchPattern());}break;case CLEAR_BTN:this.clearSearch();break;}},updateSearch:function updateSearch(){var pattern=this.getSearchPattern(),empty=(pattern.length===0),quickSearch=this.quickSearch;$CSS.toggleClass(this.clearNode,"show",this.showClearNode&&!empty&&!quickSearch);$CSS.toggleClass(this.searchNode,"clear",!empty&&quickSearch);$CSS.toggleClass(this.domNode,"hasPattern",!empty);if(quickSearch||this.quickSearchForClear&&empty){this[empty?"clearSearch":"onsearch"](pattern);}},clearSearch:function clearSearch(){var pattern=this.getSearchPattern();this.reset();this.onclear(pattern);},onfocus:function onfocus(){this.isFocus=true;$CSS.addClass(this.domNode,"focus");},onblur:function onblur(){this.isFocus=false;$CSS.removeClass(this.domNode,"focus");},reset:function reset(){this.inputNode.value="";$CSS.removeClass(this.clearNode,"show");$CSS.removeClass(this.domNode,"hasPattern");$CSS.removeClass(this.searchNode,"clear");}});}());