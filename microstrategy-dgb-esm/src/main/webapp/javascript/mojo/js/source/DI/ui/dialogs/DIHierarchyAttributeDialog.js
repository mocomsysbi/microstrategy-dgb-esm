(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.DI.DIConstants","mstrmojo.string","mstrmojo.Button","mstrmojo.DI.DIHelpers");mstrmojo.requiresDescs(118,221,2148,13325,15051,15052,15053,15054,15055,15056,15057,15058,15059,15060,15088,15089,15851);var constants=mstrmojo.DI.DIConstants,hierarchyOptions=constants.hierarchyOptions,rdcsFlag=constants.rdcsFlag;var $ARR=mstrmojo.array,$DESC=mstrmojo.desc,$NWB=mstrmojo.Button.newWebButton,$STR=mstrmojo.string,$Helper=mstrmojo.DI.DIHelpers;var $ENUM_OT=mstrmojo.warehouse.EnumObjectTypes,ENUM_OT_TABLE=$ENUM_OT.TABLE,ATTRIBUTE_TYPE=12,METRIC_TYPE=4,COLUMN_TYPE=0;var ENUM_CHECK_RESULTS={OK:0,DISTANCE_NOT_INT:1,LINKED_TO_RELATIONAL_TABLE:2,};function unLink(col,alias,silent){var model=this.model;var maps=model.findMappingItem(col);var i;for(i=0;i<maps.length;i++){if(maps[i].tableId===col.tableId){maps[i].alias=alias;maps[i].linkObjID="";if(maps[i].tp===ATTRIBUTE_TYPE){maps[i].formID="";maps[i].oid="";}maps[i].lv=0;}}if(!silent){this.changeEMMAMappings();}}function generateHierarchyLine(HBoxAlias,text,pulldownAlias,rflag){return{scriptClass:"mstrmojo.HBox",alias:HBoxAlias,cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-roleAttributeLine",children:[{scriptClass:"mstrmojo.Label",text:text},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-IDPulldown",alias:pulldownAlias,value:mstrmojo.desc(15328,"Select a column"),popupToBody:true,itemField:"n",itemIdField:"id",visible:true,enabled:false,bindings:{popupZIndex:"this.parent.parent.parent.parent.zIndex"},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}},postselectedIndexChange:function(evt){var editor=this.parent.parent.parent.parent;var newValue=evt.value,oldValue=evt.valueWas,selectedAttribute;if(editor.hierarchyMaps===null){var hierarchyMaps={};editor.set("hierarchyMaps",hierarchyMaps);}if(newValue!==oldValue){if(editor.relationAttributes.length===evt.src.items.length){selectedAttribute=editor.relationAttributes[newValue];}else{var new_index=$ARR.find(editor.relationAttributes,"did",evt.src.items[newValue].id);selectedAttribute=editor.relationAttributes[new_index];}editor.hierarchyMaps[rflag]=selectedAttribute;}var roles=["IDAttributeContainer","JoinIDAttributeContainer","FilterIDAttributeContainer","DistanceAttributeContainer"],pulldowns=["IDAttributePullDown","JoinIDAttributePullDown","FilterIDAttributePullDown","DistanceAttributePullDown"],container=this.parent.parent,isDuplicated=false,i,j,rolei,rolej,pulldowni,pulldownj,itemi,itemj;for(i=0;i<4;i++){this.parent.parent[roles[i]][pulldowns[i]+"Warning"].domNode.style.display="none";}var selectingNow=pulldowns.indexOf(evt.src.alias);for(i=selectingNow;i!==selectingNow+1;i++){i=i%4;rolei=roles[i];pulldowni=pulldowns[i];itemi=container[rolei][pulldowni].getSelectedItem();if(typeof itemi==="undefined"){continue;}for(j=0;j<4;j++){if(i===j){continue;}rolej=roles[j];pulldownj=pulldowns[j];itemj=container[rolej][pulldownj].getSelectedItem();if(typeof itemj!=="undefined"&&itemi.id===itemj.id){var position=mstrmojo.dom.position(this.parent[pulldowni].domNode);this.parent[pulldowni+"Warning"].domNode.textContent="'"+itemi.n+"' has been taken";this.parent[pulldowni+"Warning"].domNode.style.display="block";this.parent[pulldowni+"Warning"].domNode.style.position="fixed";this.parent[pulldowni+"Warning"].domNode.style.left=position.x-10+"px";this.parent[pulldowni+"Warning"].domNode.style.top=position.y+20+4+"px";setSaveBtn(editor,{hasEmptyForm:true});isDuplicated=true;}}}if(!isDuplicated){validateForms(editor);}}},{scriptClass:"mstrmojo.Label",cssClass:"pulldownWarning",alias:pulldownAlias+"Warning",cssDisplay:"none",text:""}]};}function setEditorConfig(editor,tableId){editor.set("relationTableId",tableId);var tables=editor.tables;var config=tables[tableId];editor.set("relationAttributes",config.attributes);var roleAttributeContainer=editor.boxContainer.roleAttributeContainer;var IDAttributePullDown=roleAttributeContainer.IDAttributeContainer.IDAttributePullDown;var JoinIDAttributePullDown=roleAttributeContainer.JoinIDAttributeContainer.JoinIDAttributePullDown;var FilterIDAttributePullDown=roleAttributeContainer.FilterIDAttributeContainer.FilterIDAttributePullDown;var DistanceAttributePullDown=roleAttributeContainer.DistanceAttributeContainer.DistanceAttributePullDown;var attributePullDowns=[IDAttributePullDown,JoinIDAttributePullDown,FilterIDAttributePullDown,DistanceAttributePullDown];var items=[],item,attributes=editor.relationAttributes;$ARR.forEach(attributes,function(attribute){if(isAvailabeHierarchyAttribute(attribute,editor.hierarchyOption)){item={};item[IDAttributePullDown.itemIdField]=attribute.did;item[IDAttributePullDown.itemField]=attribute.alias;items.push(item);}});$ARR.forEach(attributePullDowns,function(attributePullDown){attributePullDown.set("enabled",true);attributePullDown.set("items",items);});if(editor.hierarchyOption===constants.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){if(editor.tableId===tableId){var id_idx=$ARR.find(IDAttributePullDown.items,IDAttributePullDown.itemIdField,editor.attribute.did);IDAttributePullDown.set("selectedIndex",id_idx);IDAttributePullDown.set("enabled",false);}else{if(editor.attribute.isLinked){var linkedName=editor.attribute.alias;var linkedIdx=$ARR.find(IDAttributePullDown.items,IDAttributePullDown.itemField,linkedName);if(linkedIdx>=0){IDAttributePullDown.set("selectedIndex",linkedIdx);IDAttributePullDown.set("enabled",false);}}}}validateForms(editor);}function getTitle(option){switch(option){case hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15051,"Create Hierarchy Attribute");case hierarchyOptions.EDIT_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15052,"Edit Hierarchy Attribute");case hierarchyOptions.RESET_HIERARCHY_ATTRIBUTE:return mstrmojo.desc(15053,"Reset Hierarchy Attribute");default:return"";}}function setSaveBtn(editor,validateResults){var saveButton=editor.btnHbox.save;var validate=!validateResults.hasEmptyForm;var errorMsg;saveButton.set("enabled",validate);if(validate){saveButton.title="";return ;}else{}}function validateForms(editor){var hierarchyMaps=editor.hierarchyMaps,hasEmptyForm=!hierarchyMaps,validateResult,fg;if(!hasEmptyForm){for(fg in rdcsFlag){if(!hierarchyMaps[rdcsFlag[fg]]){hasEmptyForm=true;break;}}}validateResult={hasEmptyForm:hasEmptyForm};setSaveBtn(editor,validateResult);return validateResult;}function updateMapping(editor){var controller=mstrApp.getRootController(),m=controller.getModel(),rtid=editor.relationTableId;var callback={success:function(res){var flags=constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship;if(editor.hierarchyOption!==hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){controller.getImportedDataEMMA(constants.actions.none,flags);}else{controller.getImportedDataEMMA(constants.actions.none,flags,null,null,null,null,{success:function(){var source=m.getImportSource(rtid),changed=false;$ARR.forEach(source.currentMapping,function(item){var alias;if(item.selected&&item.tp===12&&item.isLinked&&!item.recursive){alias=item.alias+" - "+source.sourceInfo.name;alias=m.getUniqueAlias(12,alias);unLink.call(controller,item,$STR.encodeXMLAttribute(alias),true);changed=true;}});if(changed){controller.changeEMMAMappings();}}});}editor.destroy();},failure:function(res){controller.displayError(res.message);}};if(editor.tableIds&&editor.tableIds.length){updateMappingOption(editor,editor.hierarchyOption,editor.isLinked,editor.tableId,editor.attribute,editor.relationTableId,editor.hierarchyMaps,callback);}}function updateMappingOption(editor,option,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback){switch(option){case hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE:updateMappingCreate(editor,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback);break;case hierarchyOptions.EDIT_HIERARCHY_ATTRIBUTE:updateMappingCreate(editor,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback);break;case hierarchyOptions.RESET_HIERARCHY_ATTRIBUTE:updateMappingReset(editor,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback);break;}}function updateMappingCreate(editor,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback){if(isLinked){updateHierarchyMapping(editor,relationTableId,null,hierarchyMaps,callback);}else{if(tableId===relationTableId){updateHierarchyMapping(editor,relationTableId,null,hierarchyMaps,callback);}else{editor.hierarchyMaps[rdcsFlag.ID].n=attribute.n;updateHierarchyMapping(editor,relationTableId,attribute.oid,hierarchyMaps,callback);}}}function updateMappingReset(editor,isLinked,tableId,attribute,relationTableId,hierarchyMaps,callback){if(!isLinked){updateHierarchyMapping(editor,tableId,attribute.did,hierarchyMaps,callback,true,attribute.n);}else{var controller=mstrApp.getRootController(),sources=controller.model.importSources,x,tbid,did;for(x in sources){if(sources.hasOwnProperty(x)){$ARR.forEach(sources[x].currentMapping,function(v,i,arr){if(v.isLinked&&v.recursive&&v.id===attribute.id&&v.rdcs.length>0){tbid=v.tableId;did=v.did;return false;}});}}if(tbid&&did){updateHierarchyMapping(editor,tbid,did,hierarchyMaps,callback,true,attribute.n);}else{controller.displayError(mstrmojo.desc(999999,"cannot find the corresponding table and attribute."));}}}function updateHierarchyMapping(editor,relationTableId,oid,hierarchyMaps,callback,isReset,n){isReset=isReset||false;var params={tbid:relationTableId,mapping:!isReset?$Helper.getHierarchyMappingXML(oid,hierarchyMaps):getMappingResetXML(oid,n)};var controller=mstrApp.getRootController();var updateHierarchyAttributeCallback={success:function(res){if(res&&res.msgid){controller.dataService.set("messageID",res.msgid);}var model=controller.model;var source=model.getImportSource(relationTableId);source.invalidPreview();if(source.canAutoMappingAndDetectRelation()){controller.dataService.detectRelationshipSourceTable(callback||onRSDetected(),{did:relationTableId});}else{if(callback&&callback.success){callback.success(res);}else{onRSDetected().success(res);}}},failure:function(res){controller.displayError(res.message);}};controller.dataService.changeMappingSourceTable(updateHierarchyAttributeCallback,params);}function onRSDetected(){return{success:function(res){var controller=mstrApp.getRootController();controller.dataService.set("messageID",res.msgid);var flags=constants.requestFlag.mapping|constants.requestFlag.sourceInfo|constants.requestFlag.relationship;controller.getImportedDataEMMA(constants.actions.none,flags);},failure:function(res){controller.displayError(res.message);}};}function getMappingResetXML(oid,n){return'<mpcs><mpc did="'+oid+'" drvflg="0" n="'+n+'" ot="12" recurisve="0" ></mpc></mpcs>';}function isRelationalTable(table){if(table&&table.currentMapping&&table.currentMapping.length>0){var x,mapping;for(x in table.currentMapping){mapping=table.currentMapping[x];if(mapping.recursive&&mapping.rdcs.length>0){return true;}}}return false;}function isFactTable(table){if(table&&table.currentMapping&&table.currentMapping.length>0){var x,mapping;for(x in table.currentMapping){mapping=table.currentMapping[x];if(mapping.recursive&&mapping.rdcs.length===0){return true;}}}return false;}function isAvailabeHierarchyAttribute(attribute,hierarchyOption){return !(attribute.isMultiForm||attribute.ipa===1||(attribute.recursive&&hierarchyOption===constants.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE));}function checkBeforeSave(boxContainer){var sources=mstrApp.getRootController().getModel().importSources,sourceId,source,idx,IDattributeName=boxContainer.roleAttributeContainer.IDAttributeContainer.IDAttributePullDown.getSelectedItem().n,DistanceAttributeId=boxContainer.roleAttributeContainer.DistanceAttributeContainer.DistanceAttributePullDown.getSelectedItem().id,thisTableId=boxContainer.hierarchyTableContainer.tablesPullDown.getSelectedItem().id,thisTable=sources[thisTableId],distanceIdx,distance;distanceIdx=$ARR.find(thisTable.currentMapping,"did",DistanceAttributeId);if(distanceIdx>=0){distance=thisTable.currentMapping[distanceIdx];if(!(distance.ctp&&distance.ctp===constants.columnDataTypes.integer)){return ENUM_CHECK_RESULTS.DISTANCE_NOT_INT;}}for(sourceId in sources){if(!sources.hasOwnProperty(sourceId)||sourceId===thisTableId){continue;}source=sources[sourceId];idx=$ARR.find(source.currentMapping,"alias",IDattributeName);if(idx>=0&&isRelationalTable(source)){return ENUM_CHECK_RESULTS.LINKED_TO_RELATIONAL_TABLE;}}return ENUM_CHECK_RESULTS.OK;}mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog",title:"",hierarchyOption:null,tables:null,tableIds:null,relationTableId:null,tableId:null,relationAttributes:null,attribute:null,hierarchyMaps:null,isLinked:null,onOpen:function(){var controller=mstrApp.getRootController(),sources=controller.model.importSources,k,tables={},tableIds=[],mappings,attributes,source,hierarchyID=this.attribute.columnId;for(k in sources){if(sources.hasOwnProperty(k)){source=sources[k];if(!((source.type===constants.sourceType.file&&source.subtype!==constants.sourceSubtype.samplefile&&source.subtype!==constants.sourceSubtype.clipboard&&source.subtype!==constants.sourceSubtype.publicData&&source.subtype!==constants.sourceSubtype.cloudElement&&(source.xdaType===constants.xdaType.excel||source.xdaType===constants.xdaType.text))||(source.type===constants.sourceType.querybuilder&&source.subtype===constants.sourceSubtype.querybuilder&&source.xdaType===constants.xdaType.qbSingleTable))){continue;}if(this.hierarchyOption===constants.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE&&(isRelationalTable(source)||isFactTable(source))){continue;}mappings=source.currentMapping;if(this.hierarchyOption===constants.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){attributes=$ARR.filter(mappings,function(mapping){return mapping.tp===ATTRIBUTE_TYPE;});}else{attributes=$ARR.filter(mappings,function(mapping){return mapping.tp===COLUMN_TYPE||mapping.tp===ATTRIBUTE_TYPE;});}tables[k]={id:source.tableID,did:source.tableID,n:source.sourceInfo.name,tp:ENUM_OT_TABLE,attributes:attributes};tableIds.push(source.tableID);}}validateForms(this);this.set("tables",tables);this.set("tableIds",tableIds);this.set("title",getTitle(this.hierarchyOption));this.set("isLinked",this.attribute.isLinked);var hierarchyTableContainer=this.boxContainer.hierarchyTableContainer;var tableNamesPulldown=hierarchyTableContainer.tablesPullDown;if(this.tableIds.length>0){var items=[],item,table="";$ARR.forEach(tableIds,function(tableId){table=tables[tableId];item={};item[tableNamesPulldown.itemIdField]=table.id;item[tableNamesPulldown.itemField]=table.n;items.push(item);});tableNamesPulldown.set("items",items);}else{tableNamesPulldown.set("value",mstrmojo.desc(15851,"Not available"));}if(this.hierarchyOption===constants.hierarchyOptions.EDIT_HIERARCHY_ATTRIBUTE){var table_idx,id_idx,joinId_idx,filterId_idx,distance_idx;var tableId=this.attribute.tableId;table_idx=$ARR.find(tableNamesPulldown.items,tableNamesPulldown.itemIdField,tableId);tableNamesPulldown.set("selectedIndex",table_idx);var rdcs=this.attribute.rdcs;var oid=this.attribute.oid;var x;for(x in sources){if(sources.hasOwnProperty(x)){var oid_idx=$ARR.find(sources[x].currentMapping,"oid",oid);if(oid_idx>=0&&sources[x].currentMapping[oid_idx].recursive&&sources[x].currentMapping[oid_idx].isLinked&&sources[x].currentMapping[oid_idx].rdcs.length>0){if(rdcs.length===0){hierarchyID=sources[x].currentMapping[oid_idx].did;rdcs=sources[x].currentMapping[oid_idx].rdcs;tableId=sources[x].tableID;table_idx=$ARR.find(tableNamesPulldown.items,tableNamesPulldown.itemIdField,tableId);tableNamesPulldown.set("selectedIndex",table_idx);break;}}}}var roleAttributeContainer=this.boxContainer.roleAttributeContainer;var IDAttributePullDown=roleAttributeContainer.IDAttributeContainer.IDAttributePullDown;var JoinIDAttributePullDown=roleAttributeContainer.JoinIDAttributeContainer.JoinIDAttributePullDown;var FilterIDAttributePullDown=roleAttributeContainer.FilterIDAttributeContainer.FilterIDAttributePullDown;var DistanceAttributePullDown=roleAttributeContainer.DistanceAttributeContainer.DistanceAttributePullDown;id_idx=$ARR.find(IDAttributePullDown.items,IDAttributePullDown.itemIdField,hierarchyID);joinId_idx=$ARR.find(JoinIDAttributePullDown.items,JoinIDAttributePullDown.itemIdField,rdcs[0].did);filterId_idx=$ARR.find(FilterIDAttributePullDown.items,FilterIDAttributePullDown.itemIdField,rdcs[1].did);distance_idx=$ARR.find(DistanceAttributePullDown.items,DistanceAttributePullDown.itemIdField,rdcs[2].did);IDAttributePullDown.set("selectedIndex",id_idx);JoinIDAttributePullDown.set("selectedIndex",joinId_idx);FilterIDAttributePullDown.set("selectedIndex",filterId_idx);DistanceAttributePullDown.set("selectedIndex",distance_idx);tableNamesPulldown.set("enabled",false);IDAttributePullDown.set("enabled",false);}},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1442,"OK"),alias:"save",enabled:false,onclick:function(){var editor=this.parent.parent;mstrmojo.confirm($DESC(null,"Except the hierarchy attribute, other attributes or metrics will not be imported after clicking 'Finish' or 'Save', but you can find them in 'Show All Columns'"),{},{title:$DESC(null,"Not Importing Attributes and Metrics"),buttons:[$NWB($DESC(1442,"OK"),function(){var check_status=checkBeforeSave(editor.boxContainer);switch(check_status){case ENUM_CHECK_RESULTS.OK:updateMapping(editor);editor.close();break;case ENUM_CHECK_RESULTS.LINKED_TO_RELATIONAL_TABLE:mstrApp.getRootController().displayError(mstrmojo.desc(15113,"The ID is linked with an attribute, which is in a relational table, so we cannot create the Hierarchy Table."));break;case ENUM_CHECK_RESULTS.DISTANCE_NOT_INT:mstrApp.getRootController().displayError(mstrmojo.desc(15114,"The Distance attribute datatype should be integer."));break;}},true),$NWB($DESC(221,"Cancel"))]});}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var editor=this.parent.parent;editor.close();editor.destroy();}}],children:[{scriptClass:"mstrmojo.VBox",alias:"boxContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-boxContainer",children:[{scriptClass:"mstrmojo.HBox",alias:"hierarchyTableContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-hierarchyTableContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-hierarchy-tableName",text:mstrmojo.desc(15054,"Hierarchy Table")},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-tablePulldown",alias:"tablesPullDown",value:mstrmojo.desc(15327,"Select a Hierarchy Table"),popupToBody:true,itemField:"n",itemIdField:"id",visible:true,bindings:{popupZIndex:"this.parent.parent.parent.zIndex"},useRichTooltip:true,updateTooltipConfig:function(){var position=mstrmojo.dom.position(this.domNode);var tip_content="";if(!this.enabled){tip_content=mstrmojo.desc(15092,"Hierarchy table can not be changed");}this.richTooltip={cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_TOPRIGHT,content:tip_content,top:position.y-35,left:position.x+198};},preBuildRendering:function(){if(mstrmojo.ui.Pulldown.prototype.preBuildRendering){mstrmojo.ui.Pulldown.prototype.preBuildRendering.call(this);}},postselectedIndexChange:function(evt){var editor=this.parent.parent.parent;var newValue=evt.value,oldValue=evt.valueWas,tableId;if(newValue!==oldValue){tableId=editor.tableIds[newValue];setEditorConfig(editor,tableId);}}}]},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeaderContainer",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-role",text:mstrmojo.desc(15056,"Role")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-Search-infoIcon mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-infoIcon",alias:"infoIcon",onclick:function(){}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-mapsListHeader-attribute",text:mstrmojo.desc(2148,"Attribute")}]},{scriptClass:"mstrmojo.VBox",alias:"roleAttributeContainer",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeDialog-roleAttributeContainer",children:[generateHierarchyLine("IDAttributeContainer",mstrmojo.desc(15057,"ID"),"IDAttributePullDown",rdcsFlag.ID),generateHierarchyLine("JoinIDAttributeContainer",mstrmojo.desc(15059,"JoinID"),"JoinIDAttributePullDown",rdcsFlag.JOIN_ID),generateHierarchyLine("FilterIDAttributeContainer",mstrmojo.desc(15060,"FilterID"),"FilterIDAttributePullDown",rdcsFlag.FILTER_ID),generateHierarchyLine("DistanceAttributeContainer",mstrmojo.desc(13325,"Distance"),"DistanceAttributePullDown",rdcsFlag.DISTANCE)]}]}],});mstrmojo.DI.ui.dialogs.DIHierarchyAttributeResetDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHierarchyAttributeDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog",title:"",hierarchyOption:null,tables:null,tableIds:null,relationTableId:null,tableId:null,relationAttributes:null,attribute:null,hierarchyMaps:null,isLinked:null,onOpen:function(){var controller=mstrApp.getRootController(),sources=controller.model.importSources,k,tables={},tableIds=[],mappings,attributes;for(k in sources){if(sources.hasOwnProperty(k)){var source=sources[k];mappings=source.currentMapping;if(this.hierarchyOption===constants.hierarchyOptions.CREATE_HIERARCHY_ATTRIBUTE){attributes=$ARR.filter(mappings,function(mapping){return mapping.tp===ATTRIBUTE_TYPE;});}else{attributes=$ARR.filter(mappings,function(mapping){return mapping.tp===COLUMN_TYPE||mapping.tp===ATTRIBUTE_TYPE;});}tables[k]={id:source.tableID,did:source.tableID,n:source.sourceInfo.name,tp:ENUM_OT_TABLE,attributes:attributes};tableIds.push(source.tableID);}}this.set("tables",tables);this.set("tableIds",tableIds);this.set("title",getTitle(this.hierarchyOption));this.set("isLinked",this.attribute.isLinked);},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(1905,"Reset"),onclick:function(){var editor=this.parent.parent;updateMapping(editor);editor.close();}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Cancel hot",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var editor=this.parent.parent;editor.close();editor.destroy();}}],children:[{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Container",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-icon",text:""},{scriptClass:"mstrmojo.VBox",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-Container",children:[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-warning",text:mstrmojo.desc(15088,"Do you want to reset hierarchy attribute")},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHierarchyAttributeResetDialog-warning-info",text:mstrmojo.desc(15089,"After resetting hierarchy attribute, it will turn back to a normal attribute.")}]}]}],});}());