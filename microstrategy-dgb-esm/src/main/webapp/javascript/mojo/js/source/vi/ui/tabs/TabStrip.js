(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.tabs.Tab","mstrmojo.dom","mstrmojo.css");var $DOM=mstrmojo.dom,$ARR=mstrmojo.array,$CSS=mstrmojo.css,CSS_ANIMATE="animate",ADD_BUTTON_WIDTH="90px",MENU_BUTTON_WIDTH="70px",NAV_BUTTONS_WIDTH="52px",SET_BUTTON_DELAY=200,TOOLTIP_OPEN_DELAY=700,TAB_NAV_INTERVAL=750;function getTransitionEndEvtName(){var modernizr=window.Modernizr,transitionProp="transition";if(modernizr&&modernizr.testProp(transitionProp)){return $DOM.transEndEvtNames[modernizr.prefixed(transitionProp)];}return null;}function getPopupHandler(isOpen){return function(){this.menuNode.style.display=isOpen?"block":"none";};}function getWidthDelta(tabContainer){return Math.min(tabContainer.offsetWidth-tabContainer.firstChild.offsetWidth,0);}function getPositionProp(tabstrip){return tabstrip.isAlignRight?"right":"left";}function getTablePosition(tabTable,tabstrip){return parseInt(tabTable.style[getPositionProp(tabstrip)],10)||0;}function setButtonDisplay(){var tabContainer=this.tabContainerNode,showLeft=false,showRight=false,showNav=false,leftBtn=this.leftBtnNode,rightBtn=this.rightBtnNode,isValidMode=this.isValidMode();window.setTimeout(function(){if(getWidthDelta(tabContainer)<0){var tabContainerPos=$DOM.position(tabContainer),tabTablePos=$DOM.position(tabContainer.firstChild);showLeft=(tabTablePos.x<tabContainerPos.x);showRight=(tabTablePos.x+tabTablePos.w>tabContainerPos.x+tabContainerPos.w+1);}showNav=showLeft||showRight;$CSS.toggleClass(this.btnBarNode,"highlightBar",showNav);leftBtn.style.display=rightBtn.style.display=showNav?"block":"none";leftBtn.disabled=!showLeft;rightBtn.disabled=!showRight;$CSS.toggleClass(leftBtn,"disable",!showLeft);$CSS.toggleClass(rightBtn,"disable",!showRight);if(this.domNode){this.addBtnNode.style.display=this.tabStripMenuNode.style.display=isValidMode?"block":"none";this.bufferNode.style.display=isValidMode?"none":"block";this.floaterNode.style.display=this.hasFloater&&showLeft?"block":"none";}this.widgetResized();}.bind(this),SET_BUTTON_DELAY);}function filterArray(arr,fn){arr=(arr||[]);if(!arr.filter){return $ARR.filter(arr,fn);}return arr.filter(fn);}function mapArray(arr,fn){arr=(arr||[]);if(!arr.map){return $ARR.map(arr,fn);}return arr.map(fn);}function positionTabTable(alignToSelected,animate,toBeSelectedTab){var tabContainer=this.tabContainerNode,tabStripNode=this.domNode;if(this.isStatic||!tabContainer||!tabStripNode||tabStripNode.style.display==="none"){return ;}var tabTable=tabContainer.firstChild,widthDelta=getWidthDelta(tabContainer),currentTablePosition=getTablePosition(tabTable,this),newTablePosition=Math.max(currentTablePosition,widthDelta),selectedTab=filterArray(this.children,function(tab){return tab.isSelected;})[0],selectedTabDomNode=toBeSelectedTab&&toBeSelectedTab.domNode||selectedTab&&selectedTab.domNode;if(alignToSelected&&selectedTabDomNode){if(widthDelta<0){var selectedTabPosition=$DOM.position(selectedTabDomNode),tabContainerPosition=$DOM.position(tabContainer),leftEdgeDelta=Math.floor(selectedTabPosition.x-tabContainerPosition.x),rightEdgeDelta=Math.floor(selectedTabPosition.x+selectedTabPosition.w-(tabContainerPosition.x+tabContainerPosition.w));if(toBeSelectedTab){var selectedTabWidth=Math.ceil(selectedTabDomNode.offsetWidth);leftEdgeDelta=leftEdgeDelta===0?Math.max(widthDelta,-selectedTabWidth):leftEdgeDelta;rightEdgeDelta=rightEdgeDelta===0?Math.min(-widthDelta,selectedTabWidth):rightEdgeDelta;}var edgeDelta=leftEdgeDelta<0?leftEdgeDelta:(rightEdgeDelta>0?rightEdgeDelta:0);newTablePosition=this.isAlignRight?newTablePosition+edgeDelta:newTablePosition-edgeDelta;}}if(newTablePosition!==currentTablePosition){if(animate){this.setAnimation(tabTable);}tabTable.style[getPositionProp(this)]=Math.max(widthDelta,Math.min(newTablePosition,0))+"px";}setButtonDisplay.call(this);}function isTab(child){return child.hasOwnProperty("index");}function setTabProperties(){var tabContainer=this.tabContainerNode,tabContainerPosition=$DOM.position(tabContainer),isAlignRight=this.isAlignRight;$ARR.forEach(this.children||[],function(tab){var tabNode=tab.domNode,tabPosition=$DOM.position(tabNode),leftEdgeDelta=Math.floor(tabPosition.x-tabContainerPosition.x),rightEdgeDelta=Math.floor(tabPosition.x+tabPosition.w-(tabContainerPosition.x+tabContainerPosition.w)),isSelected=tab.isSelected,tabWidth=Math.ceil(tabNode.offsetWidth),visibleWidth=0;tab.isCutoff=tab.isHidden=tab.isLeftMost=tab.isRightMost=false;tab.leftEdgeHiddenWidth=tab.rightEdgeHiddenWidth=0;if(leftEdgeDelta<0){var leftEdgeDeltaAbs=Math.abs(leftEdgeDelta);visibleWidth=tabWidth-leftEdgeDeltaAbs;tab.isLeftMost=visibleWidth>=0;tab.isCutoff=tab.isLeftMost&&leftEdgeDeltaAbs>0&&visibleWidth>0;tab.isHidden=visibleWidth<=0;tab.leftEdgeHiddenWidth=leftEdgeDeltaAbs;}else{if(rightEdgeDelta>0){visibleWidth=tabWidth-rightEdgeDelta;tab.isRightMost=visibleWidth>=0;tab.isCutoff=tab.isRightMost&&rightEdgeDelta>0&&visibleWidth>0;tab.isHidden=visibleWidth<=0;tab.rightEdgeHiddenWidth=rightEdgeDelta;}}});}function updateTabProperties(){var children=this.children,total=0;(children||[]).every(function(child,idx){if(!isTab(child)){return false;}total++;child.index=idx;return true;});(children||[]).every(function(child){if(!isTab(child)){return false;}child.total=total;return true;});}function showTabMenu(menuCfg,menuPosition){var enumCorners=menuCfg.ENUM_CORNERS,alignment=[enumCorners.TOP_LEFT,enumCorners.BOTTOM_LEFT],tabStrip=this.parent;if(tabStrip.position!=="bottom"){alignment.reverse();}menuCfg.setAlignment(alignment[0],alignment[1]);var stripPosition=$DOM.position(tabStrip.domNode),menuNode=tabStrip.menuNode;var menuNodeStyle=menuNode.style;menuNodeStyle.top=(menuPosition.y-stripPosition.y)+"px";menuNodeStyle.left=(menuPosition.x-stripPosition.x)+"px";menuCfg.addPopupHandlers(tabStrip.id,getPopupHandler(true),getPopupHandler(false));menuCfg.hostId=tabStrip.id;menuCfg.hostElement=menuNode;menuCfg.isHostedWithin=false;tabStrip.openPopup(menuCfg.newInstance());}function raiseTabsChangeEvent(tabStrip){tabStrip.raiseEvent({name:"TabsChange"});}mstrmojo.vi.ui.tabs.TabStrip=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.ui.menus._HasMenuPopup,mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.vi.ui.tabs.TabStrip",markupString:'<div id="{@id}" class="mstrmojo-VITabStrip {@cssClass}" style="{@cssText}" ><div class="mstrmojo-VITabStrip-menu" mstrAttach:click><div id="tabCommonIcon" class="mstrmojo-VITabStrip-menuIcon"></div><div id="tabCommonButton" class="mstrmojo-VITabStrip-menuButton"></div><div id="tabCommonMenuHost" class="mstrmojo-VITabStrip-menuButtonHost"></div></div><div class="mstrmojo-VITabStrip-tabs"><div style="display:table"><div style="display:table-row"></div></div></div><div class="mstrmojo-VITabStrip-buffer"></div><div class="mstrmojo-VITabStrip-btnBar"><div class="mstrmojo-VITabStrip-addBtn" mstrAttach:click><div class="mstrmojo-VITabStrip-addBtn-Img"></div><div class="mstrmojo-VITabStrip-addBtn-Text"></div></div><div class="mstrmojo-VITabStrip-navBtns"><div id="tabRightButton" class="mstrmojo-VITabStrip-rightBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div><div id="tabLeftButton" class="mstrmojo-VITabStrip-leftBtn" mstrAttach:click,mousedown,mouseup,mouseover,mouseout><div class="navBtnIcon"></div></div></div></div><div class="mstrmojo-VITabStrip-floater"></div><div class="mstrmojo-VITabStrip-menuHost"></div><div class="mstrmojo-VIDND-mask"></div></div>',markupSlots:{tabStripMenuNode:function(){return this.domNode.firstChild;},menuImgNode:function(){return this.domNode.firstChild.firstChild;},menuBtnNode:function(){return this.domNode.firstChild.childNodes[1];},menuBtnHostNode:function(){return this.domNode.firstChild.lastChild;},tabContainerNode:function(){return this.domNode.childNodes[1];},containerNode:function(){return this.domNode.childNodes[1].firstChild.firstChild;},bufferNode:function(){return this.domNode.childNodes[2];},btnBarNode:function(){return this.domNode.childNodes[3];},addBtnNode:function(){return this.domNode.childNodes[3].firstChild;},addBtnImgNode:function(){return this.domNode.childNodes[3].firstChild.firstChild;},addBtnTxtNode:function(){return this.domNode.childNodes[3].firstChild.lastChild;},navBtnsNode:function(){return this.domNode.childNodes[3].lastChild;},rightBtnNode:function(){return this.domNode.childNodes[3].lastChild.firstChild;},leftBtnNode:function(){return this.domNode.childNodes[3].lastChild.lastChild;},floaterNode:function(){return this.domNode.childNodes[4];},menuNode:function(){return this.domNode.childNodes[5];},maskNode:function(){return this.domNode.lastChild;}},isStatic:false,isAlignRight:true,tabStripMenuNode:null,menuImgNode:null,menuBtnNode:null,menuBtnHostNode:null,tabContainerNode:null,addBtnNode:null,bufferNode:null,navBtnsNode:null,leftBtnNode:null,rightBtnNode:null,menuNode:null,position:"bottom",selectMovedTab:false,hasFloater:false,tabObjects:null,layoutConfig:{w:{tabContainerNode:"100%",bufferNode:"6px",addBtnNode:ADD_BUTTON_WIDTH,navBtnsNode:NAV_BUTTONS_WIDTH,tabStripMenuNode:MENU_BUTTON_WIDTH},xt:true},onAppStateChange:function onAppStateChange(evt){var appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,presentationMode=appStates.PRESENTATION,targetingMode=appStates.SELECTOR_TARGETING,currentMode=evt.value,previousMode=evt.valueWas,isValidMode=this.isValidMode();if(currentMode&presentationMode||previousMode&presentationMode||currentMode&targetingMode||previousMode&targetingMode){var addBtnNode=this.addBtnNode,tabStripMenuNode=this.tabStripMenuNode;if(addBtnNode&&tabStripMenuNode){addBtnNode.style.display=tabStripMenuNode.style.display=isValidMode?"block":"none";this.bufferNode.style.display=isValidMode?"none":"block";this.doLayout();}}},setStatic:function setStatic(isStatic,animate){this.isStatic=isStatic;if(!isStatic){positionTabTable.call(this,true,animate);}},setTabs:function setTabs(tabObjects,selectedKey){this.removeChildren();this.tabObjects=tabObjects;var $this=this,total=(tabObjects&&tabObjects.length)||0;this.addChildren(mapArray(tabObjects,function(currentTab,idx){var tabKey=currentTab.k;return $this.getTabCfg(tabObjects,currentTab,{scriptClass:"mstrmojo.vi.ui.tabs.Tab",index:idx,total:total,draggable:!!total,dropZone:!!total,k:tabKey,isSelected:tabKey===selectedKey,showTabMenu:showTabMenu,tabMoved:function(isLeft){var tabIndex=this.index;$this.moveTab(tabIndex,tabIndex+(isLeft?-1:1),tabIndex);}});}));positionTabTable.call(this,true);raiseTabsChangeEvent(this);},getTabs:function getTabs(){return filterArray(this.children,isTab);},getTabCfg:function getTabCfg(allTabObjects,currentTabObject,cfg){return cfg;},deleteTab:function deleteTab(idx){var id=this.id,targetChild=this.children[idx],transEndEvt=getTransitionEndEvtName(),fnDelete=function(){var strip=mstrmojo.all[id];strip.removeChildren(targetChild);targetChild.destroy();updateTabProperties.call(strip);setButtonDisplay.call(strip);raiseTabsChangeEvent(strip);};if(transEndEvt){var tab=targetChild.domNode.firstChild,tabStyle=tab.style;tabStyle.width=tab.offsetWidth+"px";window.setTimeout(function(){$CSS.addClass(tab,CSS_ANIMATE);$DOM.attachOneTimeEvent(tab,transEndEvt,fnDelete);tabStyle.width=0;},0);}else{fnDelete();}},buildRendering:function bldRnd(){this._super();$CSS.toggleClass(this.domNode,"alignLeft",!this.isAlignRight);},postBuildRendering:function postBuildRendering(){var rtn=this._super();positionTabTable.call(this,true);return rtn;},doLayout:function doLayout(){this._super();positionTabTable.call(this,true);},isValidMode:function isValidMode(){return !((mstrApp.isAppStatePresentation&&mstrApp.isAppStatePresentation())||(mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection())||(mstrApp.allowWebDashboardDesign&&!mstrApp.allowWebDashboardDesign()));},setSelectedTab:function setSelectedTab(selectedKey){$ARR.forEach(this.children||[],function(tab){tab.set("isSelected",tab.k===selectedKey);});raiseTabsChangeEvent(this);},getSelectedTab:function getSelectedTab(){var selTab=null,ch=this.children||[],i;for(i=0;i<ch.length;i++){if(ch[i].isSelected){selTab=ch[i];break;}}return selTab;},onclick:function onclick(evt){if(!this.isValidMode()){return ;}if(evt.getTarget()===this.addBtnImgNode||evt.getTarget()===this.addBtnTxtNode){this.addTab();}},addTab:mstrmojo.emptyFn,clearBtnTooltips:function clearBtnTooltips(target){var isLeftBtn=(target===this.leftBtnNode),isRightBtn=(target===this.rightBtnNode);if(isLeftBtn||isRightBtn){this.clearTooltips();return true;}return false;},showBtnTooltips:function showBtnTooltips(evt){var target=evt.getTarget().parentNode,clearedTooltips=this.clearBtnTooltips(target);if(clearedTooltips){this.toggleTooltip(target);}},onmouseout:function onmouseout(evt){var target=evt.getTarget().parentNode;this.clearBtnTooltips(target);},onmouseover:function onmouseover(evt){this.showBtnTooltips(evt);},onmouseup:function onmouseup(evt){window.setTimeout(function(){this.showBtnTooltips(evt);}.bind(this),SET_BUTTON_DELAY);},onmousedown:function onmousedown(evt){var target=evt.getTarget().parentNode,isLeftBtn=(target===this.leftBtnNode),isRightBtn=(target===this.rightBtnNode);if(isLeftBtn||isRightBtn){var tabContainer=this.tabContainerNode,tabTable=tabContainer.firstChild,id=this.id,me=this,h;if(mstrApp.setInteractive){mstrApp.setInteractive(false);}$CSS.addClass(target,"active");var fnScrollDone=function(){window.clearInterval(h);$CSS.removeClass(target,"active");setButtonDisplay.call(mstrmojo.all[id]);if(mstrApp.setInteractive){mstrApp.setInteractive(true);}};$DOM.attachOneTimeEvent(document.body,"mouseup",fnScrollDone);var navigateTabsFn=function(){var minimumPosition=getWidthDelta(tabContainer),currentPosition=getTablePosition(tabTable,me),maxRightPosition=currentPosition-minimumPosition,minLeftPosition=0-currentPosition;setTabProperties.call(me);me.setAnimation(tabTable);var cornerTabs=me.getCornerTabs()||[],cornerTab=filterArray(cornerTabs,function(tab){if(isLeftBtn&&tab.isLeftMost||isRightBtn&&tab.isRightMost){return tab;}})[0],jumpByWidth=0;if(cornerTab){jumpByWidth=cornerTab.isCutoff?(isLeftBtn?cornerTab.leftEdgeHiddenWidth:cornerTab.rightEdgeHiddenWidth):Math.ceil(cornerTab.domNode.offsetWidth);jumpByWidth=Math.min(jumpByWidth,isLeftBtn?minLeftPosition:maxRightPosition);jumpByWidth=me.isAlignRight?(isLeftBtn?-jumpByWidth:jumpByWidth):(isLeftBtn?jumpByWidth:-jumpByWidth);}tabTable.style[getPositionProp(me)]=parseInt(tabTable.style[getPositionProp(me)]||0)+jumpByWidth+"px";};navigateTabsFn();h=window.setInterval(function(){navigateTabsFn();},TAB_NAV_INTERVAL);}},getCornerTabs:function getCornerTabs(){return filterArray(this.children,function(tab){return tab.isLeftMost||tab.isRightMost;});},setAnimation:function setAnimation(tabTable){var transEndEvt=getTransitionEndEvtName();if(transEndEvt){$CSS.addClass(tabTable,CSS_ANIMATE);$DOM.attachOneTimeEvent(tabTable,transEndEvt,function(){$CSS.removeClass(tabTable,CSS_ANIMATE);});}},createTooltip:function createTooltip(button){var tooltipWrap=document.createElement("div");tooltipWrap.className="navBtnTooltip";tooltipWrap.appendChild(document.createTextNode(button.getAttribute("tooltip")||""));var firstChild=document.body.firstChild;firstChild.parentNode.insertBefore(tooltipWrap,firstChild);var paddingTop=5,paddingRight=tooltipWrap.offsetWidth-25,linkProps=button.getBoundingClientRect(),tooltipProps=tooltipWrap.getBoundingClientRect(),topPos=linkProps.top-(tooltipProps.height+paddingTop);tooltipWrap.style.top=topPos+"px";tooltipWrap.style.left=(linkProps.left-paddingRight)+"px";return tooltipWrap;},clearTooltips:function clearTooltips(){window.clearTimeout(this._tooltipTimeOut);var existingTooltips=document.querySelectorAll(".navBtnTooltip");$ARR.forEach(existingTooltips||[],function(ttpNode){ttpNode.parentNode.removeChild(ttpNode);});},toggleTooltip:function toggleTooltip(button){window.clearTimeout(this._tooltipTimeOut);if(button.disabled){this._tooltipTimeOut=window.setTimeout(function(){this.createTooltip(button);}.bind(this),TOOLTIP_OPEN_DELAY);}},moveTab:function moveTab(fromIdx,toIdx,startIdx,silent){var children=this.children,childToMove=children.splice(fromIdx,1)[0];children.splice(toIdx,0,childToMove);updateTabProperties.call(this);this.setAnimation(this.tabContainerNode.firstChild);var containerNode=this.containerNode,containerChildren=containerNode.childNodes,nodeToMove=containerNode.removeChild(containerChildren[fromIdx]),insertBeforeChild=containerChildren[toIdx];if(insertBeforeChild){containerNode.insertBefore(nodeToMove,insertBeforeChild);}else{containerNode.appendChild(nodeToMove);}if(this.selectMovedTab||childToMove.isSelected){positionTabTable.call(this,true,true,childToMove);}if(!silent&&startIdx!==undefined&&startIdx!==toIdx){this.commitTabMove(startIdx,toIdx);raiseTabsChangeEvent(this);}},commitTabMove:function commitTabMove(fromIdx,toIdx){throw new Error(this.scriptClass+" must implement commitTabMove.");},updateTabTable:function updateTabTable(){if(!this.isStatic){positionTabTable.call(this,true);}},setLinkIcon:function setLinkIcon(shouldShow,sourceKey){var tab,cls;if(shouldShow){if(sourceKey){cls="src";$ARR.some(this.getTabs(),function(t){if(t.k===sourceKey){tab=t;}return tab;});if(!tab){return ;}}else{cls="tgt";tab=this.getSelectedTab();}$CSS.addClass(tab.domNode,cls);}else{cls=sourceKey?["src","tgt"]:"tgt";$ARR.forEach(this.children,function(child){$CSS.removeClass(child.domNode,cls);});}}});}());