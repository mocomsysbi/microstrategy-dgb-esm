(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.Graphic");var $MOJO=mstrmojo,$ARR=$MOJO.array,$MUTLS=$MOJO.gmaps.MapUtils;mstrmojo.gmaps.graphic.ClusterGraphic=mstrmojo.declare(mstrmojo.gmaps.graphic.Graphic,null,{scriptClass:"mstrmojo.gmaps.graphic.ClusterGraphic",type:"Point",subGraphics:null,idxOfFirstSlice:0,init:function init(props){if(!props){return ;}this.subGraphics=[];this._super(props);},_checkProps:function _checkProps(props){if(!props||!props.points){return false;}var clusterCount=props.clusterCount,pos=props.geoData,lat=pos&&pos.lat,lng=pos&&pos.lng,points=props.points;if(!clusterCount){props.clusterCount=points.length;}if(isNaN(lat)||isNaN(lng)){pos=points[0]&&points[0].geoData;lat=pos&&pos.lat;lng=pos&&pos.lng;if(isNaN(lat)||isNaN(lng)){return false;}props.geoData=pos;}return true;},addSubGraphic:function addSubGraphics(graphic){this.subGraphics.push(graphic);graphic.parentGraphic=this;},getSubGraphics:function getSubGraphics(){return this.subGraphics;},getGeometryArr:function getGeometryArr(){var graphicArray=this.getSubGraphics(),gmtArray=[];if(!$ARR.isArray(graphicArray)){return ;}$ARR.forEach(graphicArray,function(graphic){gmtArray.push(graphic.geometry);});return gmtArray;},updatePosition:function updatePosition(props){var graphicArray=this.getSubGraphics(),i;for(i in graphicArray){graphicArray[i].updatePosition(props);}},isSelected:function isSelected(){var subGraphics=this.getSubGraphics(),result=true;$ARR.forEach(subGraphics,function(graphic){if(!graphic.isSelected()){result=false;return false;}});return result;},getGraphicsForSelection:function getGraphicsForSelection(){if(!this.subGraphics){return null;}return this.subGraphics;},getFirstNode:function getFirstNode(){var subGraphics=this.subGraphics,firstGraphic=subGraphics&&subGraphics[this.idxOfFirstSlice],gmt=firstGraphic&&firstGraphic.geometry;if(gmt){return gmt.getNode();}},getLastNode:function getLastNode(){var subGraphics=this.subGraphics,lastGraphic=subGraphics&&subGraphics[subGraphics.length-1],gmt=lastGraphic&&lastGraphic.geometry;if(gmt){return gmt.getNode();}},moveGraphicToTop:function moveGraphicToTop(graphic){var lastNode=this.getLastNode(),subGraphics=this.subGraphics,geometry=graphic&&graphic.geometry,nd=geometry&&geometry.getNode();if(!lastNode||!$ARR.isArray(subGraphics)||!nd){return ;}$MUTLS.insertAfter(nd,lastNode);$ARR.removeItem(subGraphics,graphic);subGraphics.push(graphic);},moveGraphicToBottom:function moveGraphicToBottom(parentElement,graphic){var firstNode=this.getFirstNode(),subGraphics=this.subGraphics,geometry=graphic&&graphic.geometry,nd=geometry&&geometry.getNode();if(!parentElement||!firstNode||!$ARR.isArray(subGraphics)||!nd){return ;}parentElement.insertBefore(nd,firstNode);$ARR.removeItem(subGraphics,graphic);$ARR.insert(subGraphics,this.idxOfFirstSlice,graphic);},destroy:function destroy(){if(this.subGraphics){$ARR.forEach(this.subGraphics,function(graphic){graphic.destroy();});delete this.subGraphics;}this._super();}});}());