(function(){mstrmojo.requiresCls("mstrmojo.Label","mstrmojo.array","mstrmojo.hash","mstrmojo.color","mstrmojo.expr","mstrmojo.Button","mstrmojo.ui.Checkbox","mstrmojo.ui.Pulldown","mstrmojo.util.ui.ColorPicker","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.editors.controls.ValidationTextBox","mstrmojo.kpicard.editors.KPICardThresholdHeaderControl","mstrmojo.models.FormatModel","mstrmojo.vi.models.editors.BaseEditorModel","mstrmojo.VisUtility","mstrmojo.kpicard.KPICardEnum","mstrmojo.string","mstrmojo._CanValidate","mstrmojo._FormatDefinition","mstrmojo.NumStepperContentProvider","mstrmojo.ui.editors.controls.Stepper","mstrmojo.VisEnum");var $HASH=mstrmojo.hash,$ARR=mstrmojo.array,$DTP=mstrmojo.expr.DTP,$FORMAT_MODEL=mstrmojo.models.FormatModel,$Pulldown=mstrmojo.ui.Pulldown,$ColorPicker=mstrmojo.util.ui.ColorPicker,$STR=mstrmojo.string,DisplayMode=mstrmojo.kpicard.DISPLAY_MODE,BadgeMode=mstrmojo.kpicard.BADGE_MODE,KPIStyles=mstrmojo.kpicard.KPI_STYLES,$KPI_PROPERTIES=mstrmojo.kpicard.KPI_PROPERTIES,$DEFAULT_PROPERTY=mstrmojo.kpicard.DEFAULT_PROPS,$TEXT_SIZE_TYPE=mstrmojo.kpicard.TEXT_SIZE_TYPE,$ENUM_PROPERTY_NAMES=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES,$STATUSCODE=mstrmojo.validation.STATUSCODE;var TARGET_KPISETTING=1,VAL_AUTOMATIC="automatic",INCREASE_DEFAULT_COLOR=$DEFAULT_PROPERTY.ibc,DECREASE_DEFAULT_COLOR=$DEFAULT_PROPERTY.dbc;var DisplayModeOptions=[{n:mstrmojo.desc(959,"Default"),id:DisplayMode.DEFAULT},{n:mstrmojo.desc(359,"Stacked"),id:DisplayMode.STACKED},{n:mstrmojo.desc(12286,"Horizontal"),id:DisplayMode.HORIZONTAL},{n:mstrmojo.desc(12285,"Vertical"),id:DisplayMode.VERTICAL},{n:mstrmojo.desc(114,"Grid"),id:DisplayMode.GRID}],BadgeOptions=[{n:mstrmojo.desc(2057,"None"),id:BadgeMode.NONE},{n:mstrmojo.desc(2053,"Percentage"),id:BadgeMode.PERCENTAGE},{n:mstrmojo.desc(527,"Value"),id:BadgeMode.VALUE}];function getPullDownCallback(propertyName){var id=this.id;return function(newValue){var editorModel=mstrmojo.all[id];if(!editorModel){return ;}if(propertyName===$KPI_PROPERTIES.DISPLAY_MODE){if(editorModel.warning){editorModel.warning=false;return ;}if(newValue.id===DisplayMode.STACKED){var pulldown=this,host=editorModel.getHost(),oldVal=host.getFormatPropertyValue(propertyName),callback=function(){mstrmojo.all[id].onPropertiesChanged(propertyName,newValue.id);},cancelCB=function(){editorModel.warning=true;pulldown.set("selectedIndex",parseInt(oldVal)-1);};host.zonesModel.checkBreakByLimit(callback,cancelCB);return ;}}mstrmojo.all[id].onPropertiesChanged(propertyName,newValue.id);};}function addThresholdControl(){var host=this.getHost(),fontColor=host.getDefaultPrimaryValueColor();host.addColorThreshold(fontColor);}function changeTextSize(step){var host=this.getHost();host.plusMinus=step;this.setFontPropertyValue(this.selectedFontPart,$KPI_PROPERTIES.UNIFY_STEPS,step);}function getTextSizeBtn(obj,type){var btn={};btn.scriptClass="mstrmojo.Button";btn.cssClass="mstrmojo-WebButton kpi-icon "+type;btn.onclick=changeTextSize.bind(obj,type==="reset"?0:(type==="plus"?1:-1));return btn;}mstrmojo.vi.models.editors.KPICardEditorModel=mstrmojo.declare(mstrmojo.vi.models.editors.BaseEditorModel,null,{scriptClass:"mstrmojo.vi.models.KPICardEditorModel",help:"format_panel_kpi.htm",warning:false,updateColorSub:null,init:function init(props){if(this._super){this._super(props);}var host=this.getHost();if(host&&host.id&&host.onBEMFormatChange){this.updateColorSub=this.attachEventListener("BEMFormatChange",host.id,host.onBEMFormatChange);}},destroy:function destroy(ignoreDOM){if(this._super){this._super(ignoreDOM);}var updateColorSub=this.updateColorSub;if(updateColorSub){this.detachEventListener(updateColorSub);this.updateColorSub=null;}},getInitialTarget:function getInitialTarget(){return TARGET_KPISETTING;},getTargetPulldownItems:function getTargetPulldownItems(dynamicCtrlGroup){var pulldownItems=this._super(dynamicCtrlGroup),host=this.getHost(),me=this,kpiSettingHandler=function(){var fn=me.getKPISettingControls;me.replaceChildControls(dynamicCtrlGroup,fn.call(me));};if(this.isNormalOrExcludeAllDataButNotInPauseMode(host)){pulldownItems.unshift({n:mstrmojo.desc(6560,"General Settings"),v:TARGET_KPISETTING,h:kpiSettingHandler});}return pulldownItems;},fnGetPulldown:function fnGetPulldown(items,selectedIndex,descriptor,propName,options){var control,pulldown;if(items&&items.length){pulldown=$Pulldown.newPulldown(items,getPullDownCallback.call(this,propName),selectedIndex,{isHostedWithin:false,getPopupListConfig:function getpopupListConfig(){var config=mstrmojo.ui.Pulldown.prototype.getPopupListConfig.call(this);config.getItemProps=function getItemProps(item,idx){var props=mstrmojo._IsList.getItemProps.call(this,item,idx);props.style=item.preview?"font-family:'"+$STR.encodeHtmlString(item.n,true)+"';":"";return props;};return config;}});if(descriptor!==undefined){var opts=options||{};var labelWidth=opts.labelWidth||"50%";var pullDownWidth=opts.pulldownWidth||"50%";control=this.getLabelAndControl(descriptor,pulldown,labelWidth,pullDownWidth);}else{control=pulldown;}}return control;},onPropertiesChanged:function onPropertiesChanged(propName,newValue){var host=this.getHost();host.writeProperties(propName,newValue);},getKPISettingControls:function getKPISettingControls(){var controls=[],host=this.getHost();if(host.getUnitsByDropZoneID("BreakBy").length>0){controls.push(this.getDisplayModeCtrolGroup());}controls.push(this.getStyleControls());if(host.getUnitsByDropZoneID("trend").length>0){controls.push(this.getBadgeControlGroup());}controls.push(this.getThresholdControlGroup());var children=[this.getEditorGroup([this.getEditorGroup(controls)],{showDivider:true,isNested:true,isContainer:true}),this.getEditorGroup([this.getMoreOptionsEditorLink((host.modelData&&host.modelData.gsi&&host.modelData.gsi.prop)||{})])];return children;},getShowMetricNameCheckbox:function getShowMetricNameCheckbox(){var me=this,host=this.getHost(),showMetricName=host.getFormatPropertyValue($KPI_PROPERTIES.SHOW_METRIC_NAME),checkBox=new mstrmojo.ui.Checkbox({checked:showMetricName==="true",oncheckedChange:function oncheckedChange(evt){me.onPropertiesChanged($KPI_PROPERTIES.SHOW_METRIC_NAME,evt.value.toString());}}),labelControl=this.getLabelAndControl(mstrmojo.desc(15915,"Show metric name"),checkBox,"14px","100%",true),label=labelControl.getLabel();label.onclick=function(){checkBox.onclick();};return labelControl;},getDisplayModeCtrolGroup:function getDisplayModeCtrolGroup(){var controls=[],host=this.getHost(),dispMode=host.getFormatPropertyValue($KPI_PROPERTIES.DISPLAY_MODE);controls.push(this.getShowMetricNameCheckbox());controls.push(new mstrmojo.Label({text:mstrmojo.desc(4963,"Display Mode")}));controls.push(this.fnGetPulldown(DisplayModeOptions,this.getDisplayModeSelectedIndex(),undefined,$KPI_PROPERTIES.DISPLAY_MODE));if(dispMode===DisplayMode.STACKED){controls.push(this.getAutoPlayCheckbox());}else{if(dispMode===DisplayMode.GRID){var isCardHeightFixed=host.getFormatPropertyValue($KPI_PROPERTIES.FIX_CARD_HEIGHT);controls.push(this.getGridColumnCountInputCtrl());controls.push(this.getFixCardHeightCheckbox());if(isCardHeightFixed){controls.push(this.getFixedCardHeightInputCtrl());}}}return this.getEditorGroup(controls,{showDivider:true,isNested:true,isContainer:true});},getDisplayModeSelectedIndex:function getDisplayModeSelectedIndex(){var host=this.getHost(),dispMode=host.getFormatPropertyValue($KPI_PROPERTIES.DISPLAY_MODE),selectedIndex=0;switch(dispMode){case DisplayMode.DEFAULT:selectedIndex=0;break;case DisplayMode.STACKED:selectedIndex=1;break;case DisplayMode.HORIZONTAL:selectedIndex=2;break;case DisplayMode.VERTICAL:selectedIndex=3;break;case DisplayMode.GRID:selectedIndex=4;break;default:break;}return selectedIndex;},getFixCardHeightCheckbox:function getFixCardHeightCheckbox(){var host=this.getHost(),fixCardHeight=host.getFormatPropertyValue($KPI_PROPERTIES.FIX_CARD_HEIGHT),checkBox=new mstrmojo.ui.Checkbox({checked:fixCardHeight,oncheckedChange:function oncheckedChange(evt){var isCardHeightFixed=evt.value;var dependedPropertyChanges=[];if(isCardHeightFixed){var columnCnt=host.getFormatPropertyValue($KPI_PROPERTIES.GRID_COLUMN_COUNT),singleKPICnt=host.singleKPIModels.length,rowCnt=Math.ceil(singleKPICnt/columnCnt),height=Math.floor(parseFloat(host.height)/rowCnt);dependedPropertyChanges.push({propertyName:$KPI_PROPERTIES.CARD_HEIGHT,value:height,oldValue:host.getFormatPropertyValue($KPI_PROPERTIES.CARD_HEIGHT)});}host.writeProperties($KPI_PROPERTIES.FIX_CARD_HEIGHT,evt.value.toString(),dependedPropertyChanges);}}),labelControl=this.getLabelAndControl(mstrmojo.desc(16027,"Fix card height"),checkBox,"14px","100%",true),label=labelControl.getLabel();label.onclick=function(){checkBox.onclick();};return labelControl;},getNumericInputCommonProperty:function getNumericInputCommonProperty(writePropertiesCallback){return{cssClass:"kpi-cth-TextBox",errRevert:false,dtp:$DTP.INTEGER,validationDelay:1500,updateText:function(val){this.inputNode.value=val;this.value=val;},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C triangle-warning",left:this.domNode.offsetWidth+10,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};if(this.tooltipTimeout){window.clearTimeout(this.tooltipTimeout);}this.tooltipTimeout=window.setTimeout(this.hideTooltip,1500);},onValid:writePropertiesCallback};},getFixedCardHeightInputCtrl:function getFixCardHeightInputCtrl(){var host=this.getHost(),minCardHeight=1,validRegex=/[0-9]+/,isCardHeightFixed=host.getFormatPropertyValue($KPI_PROPERTIES.FIX_CARD_HEIGHT);var numericInputCtrlProps=this.getNumericInputCommonProperty(function(){host.writeProperties($KPI_PROPERTIES.CARD_HEIGHT,this.value);});var cardHeightControl=new mstrmojo.ui.editors.controls.ValidationTextBox($HASH.copy(numericInputCtrlProps,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:minCardHeight,regExp:validRegex,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},value:host.getFormatPropertyValue($KPI_PROPERTIES.CARD_HEIGHT),getInvalidMsg:function(vs){if(vs.code===$STATUSCODE.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min-1);}return mstrmojo.desc(11935,"Invalid characters");}}));return this.getLabelAndControl("px",cardHeightControl,"90%","10%",true,{enabled:isCardHeightFixed});},getGridColumnCountInputCtrl:function getGridColumnCountInputCtrl(){var host=this.getHost(),minColCnt=1,validRegex=/[0-9]+/;var numericInputCtrlProps=this.getNumericInputCommonProperty(function(){host.writeProperties($KPI_PROPERTIES.GRID_COLUMN_COUNT,this.value);});var columnControl=new mstrmojo.ui.editors.controls.ValidationTextBox($HASH.copy(numericInputCtrlProps,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:minColCnt,regExp:validRegex,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},value:host.getFormatPropertyValue($KPI_PROPERTIES.GRID_COLUMN_COUNT),getInvalidMsg:function(vs){if(vs.code===$STATUSCODE.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min-1);}return mstrmojo.desc(11935,"Invalid characters");}}));return this.getLabelAndControl(mstrmojo.desc(6052,"Column"),columnControl,"50%","50%",undefined,{enabled:true});},getAutoPlayCheckbox:function getAutoPlayCheckbox(){var me=this,host=this.getHost(),autoPlay=host.getFormatPropertyValue($KPI_PROPERTIES.AUTO_PLAY),checkBox=new mstrmojo.ui.Checkbox({checked:autoPlay,oncheckedChange:function oncheckedChange(evt){me.onPropertiesChanged($KPI_PROPERTIES.AUTO_PLAY,evt.value);}}),labelControl=this.getLabelAndControl(mstrmojo.desc(15869,"Auto Play"),checkBox,"14px","100%",true),label=labelControl.getLabel();label.onclick=function(){checkBox.onclick();};return labelControl;},getStyleSelectedIndex:function getStyleSelectedIndex(){var host=this.getHost(),dispMode=host.getFormatPropertyValue($KPI_PROPERTIES.KPI_STYLE),selectedIndex=0;switch(dispMode){case KPIStyles.LIGHT:selectedIndex=0;break;case KPIStyles.NIGHT:selectedIndex=1;break;case KPIStyles.DESERT:selectedIndex=2;break;case KPIStyles.OCEAN:selectedIndex=3;break;default:break;}return selectedIndex;},getTextSizeController:function getTextSizeController(resetEnabled){var me=this,textSizeController,resetBtn=getTextSizeBtn(me,"reset"),minusBtn=getTextSizeBtn(me,"minus"),plusBtn=getTextSizeBtn(me,"plus");if(!resetEnabled){resetBtn.cssClass+=" inactive";}resetBtn.slot="col1Node";minusBtn.slot="col2Node";plusBtn.slot="col3Node";textSizeController=new mstrmojo.ui.editors.controls.ThreeColumnContainer({col1Width:"33%",col2Width:"33%",col3Width:"33%",divider1Width:"18px",divider2Width:"18px",children:[resetBtn,minusBtn,plusBtn],cssText:"padding-bottom: 6px"});return textSizeController;},getFontControlGroup:function(){var me=this;var host=this.getHost();var CAN_SET_FONT_PARTS=mstrmojo.kpicard.CAN_SET_FONT_PARTS;var ALL="__all__";var CONFLICT_FLAG=-1;var getFontPropertyValue=function(selectedPart){var compareProps=function(arr,propName){var firstValue=arr[0][propName];var equal=arr.every(function(partFont){return partFont[propName]===firstValue;});return{equal:equal,value:firstValue};};var mergeProps=function(fps){var arr=$HASH.valarray(fps);var propNames=$HASH.keyarray(arr[0]);var formats={};return propNames.reduce(function(res,propName){var compareResult=compareProps(arr,propName);if(compareResult.equal){res[propName]=compareResult.value;return res;}var value;switch(propName){case $FORMAT_MODEL.ENUM_PROPERTY_NAMES.FONT_FAMILY:value=CONFLICT_FLAG;break;case $FORMAT_MODEL.ENUM_PROPERTY_NAMES.FONT_SIZE:value=CONFLICT_FLAG;break;case $FORMAT_MODEL.ENUM_PROPERTY_NAMES.COLOR:value="";break;default:value=false;}res[propName]=value;return res;},formats);};var fontProps=host.getFormatPropertyValue($KPI_PROPERTIES.NEW_FONT);if(selectedPart===ALL){return mergeProps(fontProps);}return fontProps[selectedPart];};var setFontPropertyValue=function(selectedPart,propName,newValue){var wrapNewValue=function(p,pn,nv){var realNewValue=nv;if(pn===$KPI_PROPERTIES.UNIFY_STEPS){var fontProps=host.getFormatPropertyValue($KPI_PROPERTIES.NEW_FONT);realNewValue=nv===0?"0":(Number(fontProps[p][pn])+nv).toString();}return{part:p,propName:pn,propValue:realNewValue};};var nValue;if(selectedPart===ALL){nValue=$HASH.valarray(CAN_SET_FONT_PARTS).map(function(part){return wrapNewValue(part,propName,newValue);});}else{nValue=[wrapNewValue(selectedPart,propName,newValue)];}return me.onPropertiesChanged($KPI_PROPERTIES.NEW_FONT,nValue);};var getUnifyTextSizeDropdown=function(){var options=[{n:mstrmojo.desc(16296,"Unified"),id:$TEXT_SIZE_TYPE.UNIFIED},{n:mstrmojo.desc(12058,"Fit to container"),id:$TEXT_SIZE_TYPE.FIT_TO_CONTAINER},{n:mstrmojo.desc(4961,"Fixed"),id:$TEXT_SIZE_TYPE.FIXED},];if(host.getFormatPropertyValue($KPI_PROPERTIES.DISPLAY_MODE)===DisplayMode.STACKED){options=$ARR.filter(options,function(option){return option.id!==$TEXT_SIZE_TYPE.UNIFIED;});}var textSizeType=host.getFormatPropertyValue($KPI_PROPERTIES.TEXT_SIZE_TYPE);var selectedIndex=$ARR.find(options,"id",textSizeType);return me.fnGetPulldown(options,selectedIndex,mstrmojo.desc(16258,"Text Size"),$KPI_PROPERTIES.TEXT_SIZE_TYPE,{labelWidth:"30%",pulldownWidth:"70%"});};var getFontPartSelect=function(){var options=[{n:mstrmojo.desc(2461,"All"),id:ALL},{n:mstrmojo.desc(8263,"Label"),id:CAN_SET_FONT_PARTS.LABEL},{n:mstrmojo.desc(16260,"Primary Value"),id:CAN_SET_FONT_PARTS.PRIMARY_VALUE},{n:mstrmojo.desc(16261,"Previous Value"),id:CAN_SET_FONT_PARTS.PREVIOUS_VALUE},{n:mstrmojo.desc(16262,"Trend Identity"),id:CAN_SET_FONT_PARTS.TREND_IDENTITY},];var getSelectedIndex=function(arr,id){var index=0;$ARR.forEach(arr,function(value,i){if(value.id===id){index=i;return false;}});return index;};var onChange=function(newValue){me.selectedFontPart=newValue.id;me.getHost().zonesModel.getUpdateCallback().success();};return $Pulldown.newPulldown(options,onChange,getSelectedIndex(options,me.selectedFontPart),{isHostedWithin:false});};var getCharacterGroup=function(){var onFontChange=function(propName,newValue){setFontPropertyValue(me.selectedFontPart,propName,newValue);};var getPixelCharacterGroup=function(onChange,fmts){var fontSize=fmts[$ENUM_PROPERTY_NAMES.FONT_SIZE];if(fontSize&&fontSize!==CONFLICT_FLAG){fmts[$ENUM_PROPERTY_NAMES.FONT_SIZE]=Math.round(parseInt(fontSize)/4*3)+"pt";}return me.getCharacterGroup(function(propName,newValue){if(propName===$ENUM_PROPERTY_NAMES.FONT_SIZE){newValue=parseInt(newValue)/3*4+"px";}onChange(propName,newValue);},fmts);};var formats=getFontPropertyValue(me.selectedFontPart);var characterGroup=getPixelCharacterGroup(onFontChange,formats);var textSizeType=host.getFormatPropertyValue($KPI_PROPERTIES.TEXT_SIZE_TYPE);var step=formats[$KPI_PROPERTIES.UNIFY_STEPS];var resetEnabled=step===false||step!=="0";var textSizeController=me.getTextSizeController(resetEnabled);var isFixed=textSizeType===$TEXT_SIZE_TYPE.FIXED;characterGroup.fontSize.set("enabled",isFixed);textSizeController.set("visible",!isFixed);return[characterGroup,textSizeController];};this.selectedFontPart=this.selectedFontPart||ALL;this.setFontPropertyValue=setFontPropertyValue;var controls=[me.getGroupTitle(mstrmojo.desc(16259,"Font")),getUnifyTextSizeDropdown(),getFontPartSelect(),].concat(getCharacterGroup());return this.getEditorGroup(controls,{showDivider:true,isNested:true,isContainer:true,});},getKPIStyleControls:function getKPIStyleControls(){var CUSTOM="custom";var controls=[];var host=this.getHost();var kpiStyle=host.getFormatPropertyValue($KPI_PROPERTIES.KPI_STYLE);var styleOptions=[{n:mstrmojo.desc(8959,"Light"),id:KPIStyles.LIGHT},{n:mstrmojo.desc(15866,"Night"),id:KPIStyles.NIGHT},{n:mstrmojo.desc(9237,"Desert"),id:KPIStyles.DESERT},{n:mstrmojo.desc(15867,"Ocean"),id:KPIStyles.OCEAN},{n:mstrmojo.desc(14417,"Customize"),id:CUSTOM},];controls.push(this.fnGetPulldown(styleOptions,$ARR.find(styleOptions,"id",kpiStyle)||0,mstrmojo.desc(1400,"Style"),$KPI_PROPERTIES.KPI_STYLE));if(kpiStyle===CUSTOM){var onFillColorChange=function(colorProp,opacityProp){var getRealProp=function(n){var FillCompName=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName;if(n===FillCompName.FILL_COLOR){return colorProp;}if(n===FillCompName.FILL_TRANSPARENT){return opacityProp;}return colorProp;};return function(name,newValue){host.writeProperties($KPI_PROPERTIES.CUSTOM_KPI_STYLE,host.generateUpdatedCustomStyleConfigs(CUSTOM,getRealProp(name),newValue));};};var kpiStyleConfig=host.getSpecificKPIStyle(kpiStyle)||{};controls.push(this.getColorFormatsControl(mstrmojo.desc(16291,"Area Fill Color"),kpiStyleConfig.bgColor,kpiStyleConfig.bgOpacity,onFillColorChange("bgColor","bgOpacity")));controls.push(this.getColorFormatsControl(mstrmojo.desc(16290,"Trend Fill Color"),kpiStyleConfig.chartColor,kpiStyleConfig.chartOpacity,onFillColorChange("chartColor","chartOpacity")));}return this.getEditorGroup(controls,{showDivider:false,isNested:true,isContainer:true});},getColorFormatsControl:function getColorFormatsControl(label,color,opacity,onChange){var inited=false;var COLOR=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName.FILL_COLOR;var OPACITY=mstrmojo.ui.editors.controls.FillConfigGroup.FillCompName.FILL_TRANSPARENT;var labelControl=new mstrmojo.Label({text:label});var fillConfigGroup=new mstrmojo.ui.editors.controls.FillConfigGroup({showNoFill:false,onGroupValueChange:function(name,newValue){if(!inited){return ;}if(name===OPACITY){newValue=newValue/100;}onChange(name,newValue);},});fillConfigGroup.iniChildrenComp([COLOR,OPACITY]);fillConfigGroup.setChildrenValue([[COLOR,color],[OPACITY,opacity*100],]);inited=true;return this.getEditorGroup([labelControl,fillConfigGroup],{showDivider:false,isNested:true,isContainer:true});},getStyleControls:function getStyleControls(){var host=this.getHost(),controls=[],prvMtxVal=host.getFormatPropertyValue($KPI_PROPERTIES.PREVIOUS_METRIC_NAME),textbox;controls.push(this.getKPIStyleControls());controls.push(this.getFontControlGroup());if(host.getUnitsByDropZoneID("trend").length>0){controls.push(new mstrmojo.Label({text:mstrmojo.desc(15872,"Previous Value Label")}));textbox=new mstrmojo.ui.editors.controls.ValidationTextBox({required:false,dtp:$DTP.VARCHAR,validationDelay:1500,value:prvMtxVal,autoComplete:false,onValid:function(){host.writeProperties($KPI_PROPERTIES.PREVIOUS_METRIC_NAME,this.value);},onRender:function(){var invisibleInput=document.createElement("input");invisibleInput.type="text";invisibleInput.style.cssText="display: none !important;";if(this.domNode.parentNode){this.domNode.parentNode.appendChild(invisibleInput);}}});controls.push(textbox);}return this.getEditorGroup(controls,{showDivider:false,isNested:true,isContainer:true});},getBadgeModeSelectedIndex:function getBadgeModeSelectedIndex(){var host=this.getHost(),dispMode=host.getFormatPropertyValue($KPI_PROPERTIES.BADGE_MODE),selectedIndex=1;switch(dispMode){case BadgeMode.NONE:selectedIndex=0;break;case BadgeMode.PERCENTAGE:selectedIndex=1;break;case BadgeMode.VALUE:selectedIndex=2;break;default:break;}return selectedIndex;},getBadgeControlGroup:function getBadgeControlGroup(){var controls=[],me=this,host=this.getHost(),dispMode=host.getFormatPropertyValue($KPI_PROPERTIES.BADGE_MODE),inClr=host.getFormatPropertyValue($KPI_PROPERTIES.INCREASE_BG_COLOR),deClr=host.getFormatPropertyValue($KPI_PROPERTIES.DECREASE_BG_COLOR),enableBgClrSetting=dispMode!==BadgeMode.NONE,insClrPicker,desClrPicker;controls.push(this.getGroupTitle(mstrmojo.desc(15870,"Trend Indicator")));controls.push(this.fnGetPulldown(BadgeOptions,this.getBadgeModeSelectedIndex(),undefined,$KPI_PROPERTIES.BADGE_MODE));$ColorPicker.addCustomColor(INCREASE_DEFAULT_COLOR);$ColorPicker.addCustomColor(DECREASE_DEFAULT_COLOR);insClrPicker=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,showAutomatic:true,autoPreviewColor:INCREASE_DEFAULT_COLOR,selectedValue:inClr===INCREASE_DEFAULT_COLOR?VAL_AUTOMATIC:inClr,postselectedValueChange:function(evt){var newClr=evt.value;me.onPropertiesChanged($KPI_PROPERTIES.INCREASE_BG_COLOR,newClr===VAL_AUTOMATIC?INCREASE_DEFAULT_COLOR:newClr);}});desClrPicker=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,showAutomatic:true,autoPreviewColor:DECREASE_DEFAULT_COLOR,selectedValue:deClr===DECREASE_DEFAULT_COLOR?VAL_AUTOMATIC:deClr,postselectedValueChange:function(evt){var newClr=evt.value;me.onPropertiesChanged($KPI_PROPERTIES.DECREASE_BG_COLOR,newClr===VAL_AUTOMATIC?DECREASE_DEFAULT_COLOR:newClr);}});controls.push(this.getLabelAndControl(mstrmojo.desc(8314,"Increase"),insClrPicker,"50%","50%",undefined,{enabled:enableBgClrSetting}));controls.push(this.getLabelAndControl(mstrmojo.desc(8315,"Decrease"),desClrPicker,"50%","50%",undefined,{enabled:enableBgClrSetting}));return this.getEditorGroup(controls,{showDivider:true,isNested:true,isContainer:true});},getThresholdControlGroup:function getThresholdControlGroup(){var controls=[],me=this,addButton;controls.push(this.getGroupTitle(mstrmojo.desc(3647,"Thresholds")));this.initThresholdControls(controls);addButton=new mstrmojo.Button.newWebButton(mstrmojo.desc(531,"Add"),addThresholdControl.bind(me),false,{});controls.push(addButton);return this.getEditorGroup(controls,{showDivider:true,isNested:true,isContainer:true});},initThresholdControls:function initThresholdControls(controls){var host=this.getHost(),colorThresholdsProp=host.readColorThresholdsProp(),colorThresholds=colorThresholdsProp&&colorThresholdsProp.thresholds,colorThresholdNum,colorThreshold,singleControlItem,i;if(!colorThresholds||!$ARR.isArray(colorThresholds)){return ;}colorThresholdNum=colorThresholds.length;for(i=0;i<colorThresholdNum;i+=1){colorThreshold=colorThresholds[i];singleControlItem=this.initSingleThresholdControlItem(i,colorThreshold.enabled,colorThreshold.min,colorThreshold.max,colorThreshold.color);controls.push(singleControlItem);}},initSingleThresholdControlItem:function initSingleThresholdControlItem(idx,enabled,min,max,color){var controls=[],title,enableControl,deleteControl,headerControl,fromControl,toControl,clrPicker,me=this,commonInputCtrlProps,validRegex=/^$|(^(-|\d*)\d+(\.\d+)?)$/;enableControl=new mstrmojo.ui.Checkbox({checked:enabled,colorThresholdIdx:idx,oncheckedChange:function oncheckedChange(evt){var enabled=evt.value,host=me.getHost();host.setColorThresholdProperty(this.colorThresholdIdx,"enabled",enabled);}});title=this.getGroupTitle(mstrmojo.desc(15873,"Threshold ##").replace("##",(idx+1)));deleteControl=mstrmojo.Button.newIconButton(undefined,"kpi-cth-delete-button",function(){var host=me.getHost();this.hideTooltip();host.removeColorThreshold(this.colorThresholdIdx);},undefined,{colorThresholdIdx:idx,useRichTooltip:true,updateTooltipConfig:function(){this.richTooltip={cssClass:"vi-regular vi-tooltip-C",content:mstrmojo.desc(15874,"Delete the threshold"),refNode:this.domNode,posType:mstrmojo.tooltip.POS_TOPLEFT,left:25,top:-7};}});enableControl.slot="col1Node";title.slot="col2Node";deleteControl.slot="col3Node";headerControl=new mstrmojo.kpicard.editors.KPICardThresholdHeaderControl({col1Width:"15px",col2Width:"auto",col3Width:"18px",children:[enableControl,title,deleteControl]});commonInputCtrlProps={cssClass:"kpi-cth-TextBox",errRevert:false,dtp:$DTP.FLOAT,validationDelay:1500,colorThresholdIdx:idx,updateText:function(val){this.inputNode.value=val;this.value=val;},tooltipOpenDelay:0,useRichTooltip:true,updateTooltipConfig:function(){if(this.isValid()){this.richTooltip=null;return ;}this.richTooltip={posType:mstrmojo.tooltip.POS_TOPLEFT,cssClass:"vi-warning vi-tooltip-C triangle-warning",left:this.domNode.offsetWidth+10,top:-4,refNode:this.domNode,keepArrowYPos:true,content:this.getInvalidMsg(this.validationStatus)};if(this.tooltipTimeout){window.clearTimeout(this.tooltipTimeout);}this.tooltipTimeout=window.setTimeout(this.hideTooltip,1500);},onValid:function(){var nodeValue=this.value,value=nodeValue&&parseFloat(nodeValue),host=me.getHost();if(isNaN(value)||(!value&&value!==0)||value===""){value=undefined;}host.setColorThresholdProperty(this.colorThresholdIdx,this.cthPropName,value);},onfocus:function(){this.orignText=this.value;var inputNode=this.inputNode;if(inputNode){this.inputNode.setAttribute("placeholder","");}},onblur:function(){if(this.value!==this.orignText){this.validate();}var inputNode=this.inputNode;if(inputNode){this.inputNode.setAttribute("placeholder",this.hint);}}};fromControl=new mstrmojo.ui.editors.controls.ValidationTextBox($HASH.copy(commonInputCtrlProps,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,max:!isNaN(max)?parseFloat(max):undefined,regExp:validRegex,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},hint:"\ue80d",value:min?min.toString():min,cthPropName:"min",getInvalidMsg:function(vs){if(vs.code===$STATUSCODE.INVALID_OUTOFRANGE){return mstrmojo.desc(15875,"Value should be less than ##").replace("##",this.constraints.max);}return mstrmojo.desc(11935,"Invalid characters");}}));toControl=new mstrmojo.ui.editors.controls.ValidationTextBox($HASH.copy(commonInputCtrlProps,{constraints:{trigger:mstrmojo.validation.TRIGGER.ALL,min:!isNaN(min)?parseFloat(min):undefined,regExp:validRegex,invalidCssClass:"mstrmojo-TextBox-ErrValidation"},hint:"\ue80e",value:max?max.toString():max,cthPropName:"max",getInvalidMsg:function(vs){if(vs.code===$STATUSCODE.INVALID_OUTOFRANGE){return mstrmojo.desc(15876,"Value should be greater than ##").replace("##",this.constraints.min);}return mstrmojo.desc(11935,"Invalid characters");}}));clrPicker=new mstrmojo.ui.editors.controls.ColorPickerButton({showGradient:false,showNoFill:false,selectedValue:color,colorThresholdIdx:idx,postselectedValueChange:function(evt){var newClr=evt.value,host=me.getHost();host.setColorThresholdProperty(this.colorThresholdIdx,"color",newClr);}});controls.push(headerControl);controls.push(this.getLabelAndControl(mstrmojo.desc(9305,"From"),fromControl,"33%","67%",undefined,{enabled:enabled}));controls.push(this.getLabelAndControl(mstrmojo.desc(15877,"To"),toControl,"33%","67%",undefined,{enabled:enabled}));controls.push(this.getLabelAndControl(mstrmojo.desc(6242,"Color"),clrPicker,"50%","50%",undefined,{enabled:enabled}));return this.getEditorGroup(controls,{showDivider:false,isNested:true,isContainer:true});}});}());