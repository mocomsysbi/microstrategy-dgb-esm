(function(){var xhrPool={};var CLASS_NAME="XHRServerTransport";mstrmojo.XHRServerTransport={serverRequest:function serverRequest(id,requestId,request){var proxy=mstrmojo.all[id],xhr=xhrPool[requestId]=new mstrmojo.SimpleXHR();$MAPF(true,CLASS_NAME,"transportRequest");if(request.params&&!request.params.sessionState&&mstrConfig&&mstrConfig.isAddSessionState&&mstrApp&&mstrApp.sessionState){request.params.sessionState=mstrApp.sessionState;}xhr.request(request.config.method||"POST",request.taskURL||mstrConfig.taskURL,{success:function(res){if(typeof res==="string"&&res[0]==="{"){try{res=JSON.parse(res);}catch(e){}}if(res.mstrerr){res.code=res.mstrerr.code;res.message=res.mstrerr.message;}proxy&&proxy.response(requestId,true,res);},failure:function(res){var resStatus=res.status,resHeaderErrCode=res.getResponseHeader("X-MSTR-TaskErrorCode"),resMsg;if(resStatus===0){resStatus=resHeaderErrCode||resStatus;resMsg=mstrmojo.desc(15666,"The connection to the MicroStrategy Web Server failed. Please wait a few minutes and then attempt to reload the page. If the condition persists, please contact your administrator.");}else{resStatus=resHeaderErrCode||resStatus||"-999";resMsg=res.getResponseHeader("X-MSTR-TaskFailureMsg")||res.responseText||"Unexpected error, please contact your administrator";}proxy&&proxy.response(requestId,false,{code:resStatus,message:resMsg});},complete:function(){delete xhrPool[requestId];},textResponse:request.callback.textResponse},request.params);},cancelRequest:function cancelRequest(requestId){var xhr=xhrPool[requestId],didCancel=false;if(xhr){didCancel=xhr.cancel();delete xhrPool[requestId];}$MAPF(false,CLASS_NAME,"transportRequest");return didCancel;}};}());