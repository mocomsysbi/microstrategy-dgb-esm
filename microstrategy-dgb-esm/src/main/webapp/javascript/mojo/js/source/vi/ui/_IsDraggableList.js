(function(){mstrmojo.requiresClsP("mstrmojo","css","array");var $ARR=mstrmojo.array,$CSS=mstrmojo.css;var DROP_AREA="dragIn";mstrmojo.vi.ui._IsDraggableList=mstrmojo.provide("mstrmojo.vi.ui._IsDraggableList",{_mixinName:"mstrmojo.vi.ui._IsDraggableList",avatarCssClass:"element-drag-avatar",cachedItems:null,disableDrop:false,isDraggingItem:function isDraggingItem(context){return context.src.node&&context.src.node.className.indexOf("item")>=0;},selectDragNode:function selectDragNode(context){if(this._super){this._super(context);}var data=context.src.data;data.items=mstrmojo.all[data.srcId].getSelectedItems();},ondragstart:function ondragstart(context){if(this.isDraggingItem(context)){this.selectDragNode(context);}if(this._super){this._super(context);}this.processDragStart(context);},createAvatar:function createAvatar(srcNode,context){if(this._super){var avatar=this._super(srcNode,context);if(avatar){avatar.className=[this.avatarCssClass,"hasOwnAvatar"].join(" ");}return avatar;}},ondragenter:function ondragenter(context){if(this.isDraggingItem(context)){$CSS.addClass(this.domNode,DROP_AREA);}if(this._super){this._super(context);}},ondragleave:function ondragleave(context){if(this.isDraggingItem(context)){$CSS.removeClass(this.domNode,DROP_AREA);}if(this._super){this._super(context);}},adjustPosition:function adjustPosition(pos){pos.y=pos.y-this.avatar.offsetHeight-13;},positionAvatar:function positionAvatar(pos,context){if(!this.avatar){return ;}this.adjustPosition(pos);if(this._super){this._super(pos,context);}},getDragData:function getDragData(context){var ret={},me=this;if(this._super){ret=this._super(context);}if(ret){ret.setAvatarClass=function setAvatarClass(cls){var avatar=me.avatar;if(avatar){var classes=[me.avatarCssClass,"hasOwnAvatar",cls];avatar.className=classes.join(" ");}};}return ret;},processDragStart:function processDragStart(context){if(this.isDraggingItem(context)){var dragItemsIndices=$ARR.map(context.src.data.items,function(item){return item._renderIdx;}).reverse(),me=this;this.cachedItems=this.items.slice(0)||[];$ARR.forEach(dragItemsIndices,function(index){me.items.splice(index,1);});this.clearSelect();this.refresh();}},isDragValid:function isDragValid(context){return this.isDraggingItem(context)||this._super&&this._super(context)||false;},ondragend:function ondragend(context){var data=context.src.data;if(this._super){this._super(context);}this.processDragEnd(context);},processDragEnd:function processDragEnd(context){var data=context.src.data;if(!data.isDropSuccess&&data.srcId===this.id){if(this.cachedItems){this.items=this.cachedItems;}this.refresh();}},ondrop:function ondrop(context){$CSS.removeClass(this.domNode,DROP_AREA);this.processDrop(context);this.refresh();context.src.data.isDropSuccess=true;},allowDrop:function allowDrop(context){if(this.disableDrop){return false;}else{var data=context.src.data;return data&&data.items&&data.items.length>0;}},processDrop:mstrmojo.fnEmpty});}());