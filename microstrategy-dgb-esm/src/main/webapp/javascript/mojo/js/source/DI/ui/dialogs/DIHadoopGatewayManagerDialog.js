(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.DI.DIConstants");mstrmojo.requiresDescs(2102,4447,7559,14931,14932,14933,14934,8726,762,6792,2554,14935,14936,14952,14953,8727,14954,14955,14965,14967,15083);var constants=mstrmojo.DI.DIConstants,$HASH=mstrmojo.hash;function createHint(container,title,content){var hintTitle=document.createElement("div");hintTitle.innerHTML=title;hintTitle.className="hintTitle";container.appendChild(hintTitle);var hintContent=document.createElement("div");hintContent.innerHTML=content;hintContent.className="hintContent";container.appendChild(hintContent);}mstrmojo.DI.ui.dialogs.DIHadoopGatewayManagerDialog=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.ui.dialogs.DIHadoopGatewayManagerDialog",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog",title:mstrmojo.desc(14906,"Manage Hadoop Gateway"),items:null,sh:null,update:function(){var me=this;controller=mstrApp.getRootController().getHadoopGatewayController();controller.listGateways({success:function(res){if(res&&res.length){me.set("items",res[0].entity);}}});},onOpen:function(){var me=this;var grid=me.grid;sh=setInterval(function(){controller=mstrApp.getRootController().getHadoopGatewayController();var cfg=false;controller.listGateways({success:function(res){if(res&&res.length){var height;if(grid&&grid.domNode){height=grid.scrollNode.scrollTop;}me.set("items",res[0].entity);if(height!==null){grid.scrollNode.scrollTop=height;}}}},cfg);},3000);},buttons:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(2102,"Close"),onclick:function(){this.parent.parent.close();}}],onClose:function(){clearInterval(sh);var hadoopController;hadoopController=mstrApp.getRootController().getHadoopController();hadoopController.updateDBRoleEditor();},children:[{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-addBtn mstrmojo-WebButton hot",text:mstrmojo.desc(4447,"Add"),onclick:function(){var list=this.parent;mstrApp.getRootController().showDialog(constants.dialogType.hadoopGatewayDialog,{afterSave:function(){list.update();}});}},{scriptClass:"mstrmojo.DataGrid",alias:"grid",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid",bindings:{items:"this.parent.items"},postBuildRendering:function postBuildRendering(){mstrmojo.DataGrid.prototype.postBuildRendering.call(this);if(this.items&&this.items.length===0){createHint(this.itemsContainerNode,mstrmojo.desc(14965,"No Hadoop Gateway"),mstrmojo.desc(14967,"Click 'Add' to start configuration for a new Hadoop Gateway Manager"));}},columns:[{headerText:mstrmojo.desc(7559,"Name"),colCss:"nameCol",dataWidget:{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col name",onclick:function(){var list=this.parent.parent.parent;mstrApp.getRootController().showDialog(constants.dialogType.hadoopGatewayDialog,{data:this.parent.data,afterSave:function(){list.update();}});},bindings:{text:"this.parent.data.hgosName"}}},{headerText:mstrmojo.desc(14931,"Host"),colCss:"hostCol",dataFunction:function(item){return item.config.hostAddr;}},{headerText:mstrmojo.desc(16,"Port"),colCss:"portCol",dataFunction:function(item){return item.config.tcpPort;}},{headerText:mstrmojo.desc(14932,"Hadoop NameNode"),colCss:"namenodeAddrCol",dataFunction:function(item){return item.config.namenodeAddr;}},{headerText:mstrmojo.desc(14933,"HDFS Port"),colCss:"hdfsRpcPortCol",dataFunction:function(item){return item.config.hdfsRpcPort;}},{headerText:mstrmojo.desc(14934,"WebHDFS Port"),colCss:"hdfsHttpPortCol",dataFunction:function(item){return item.config.hdfsHttpPort;}},{headerText:mstrmojo.desc(8726,"Status"),colCss:"statusCol",dataWidget:{scriptClass:"mstrmojo.Label",bindings:{text:function(){var flag=this.parent.data.status;if(flag==="INITIAL"||flag==="Unavailable"){return mstrmojo.desc(14952,"Undeployed");}else{if(flag==="BUSY"){return mstrmojo.desc(14953,"Running");}else{if(flag==="Available"){return mstrmojo.desc(8727,"Stopped");}else{if(flag==="Deploying"){return mstrmojo.desc(14954,"Deploying...");}else{if(flag==="Starting"){return mstrmojo.desc(15083,"Starting...");}}}}}},cssClass:function(){var flag=this.parent.data.status;if(flag==="BUSY"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusRunning";}else{if(flag=="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusStopped";}else{if(flag==="INITIAL"||flag==="Unavailable"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusUndeployed";}else{if(flag==="Deploying"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusDeploying";}else{if(flag==="Starting"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col statusDeploying";}}}}}}}}},{headerText:mstrmojo.desc(762,"Action"),colCss:"actionCol",dataWidget:{scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-col action cf",children:[{scriptClass:"mstrmojo.Button",cssDisplay:"inline-block",bindings:{text:function(){var flag=this.parent.data.status;if(flag==="Available"){return mstrmojo.desc(14935,"Undeploy");}else{return mstrmojo.desc(14936,"Deploy");}},enabled:function(){var flag=this.parent.data.status;if(flag==="Available"||flag==="Unavailable"||flag==="INITIAL"){return true;}else{return false;}},visible:function(){var flag=this.parent.data.status;if(flag==="Deploying"||flag==="Starting"){return false;}else{return true;}},cssClass:function(){var flag=this.parent.data.status;if(flag==="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-undelpoy";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-delpoy";}}},onclick:function(){var cb={success:function(e){editor.close();},failure:function(e){editor.close();}};var flag=this.parent.data.status;if(flag!=="Available"){var hgController=mstrApp.getRootController().getHadoopGatewayController(),data=this.parent.parent.data,editor,dirtyData={};function doDeploy(){var callback={success:function(){if(editor){editor.close();}}};var cfg=$HASH.copy(dirtyData,data.config);cfg.sshPort=22;hgController.updateGateway(cfg,callback);hgController.installGateway(cfg,cb);}hgController.confirmAuthentication(function(user,password){editor=this;dirtyData.user=user;dirtyData.passwd=password;doDeploy();});}else{var hgController=mstrApp.getRootController().getHadoopGatewayController(),data=this.parent.parent.data,editor,dirtyData={};function doUninstall(){var cfg=$HASH.copy(dirtyData,data.config);hgController.uninstallGateway(cfg,cb);}hgController.confirmAuthentication(function(user,password){editor=this;dirtyData.user=user;dirtyData.passwd=password;doUninstall();});}}},{scriptClass:"mstrmojo.Button",cssDisplay:"inline-block",bindings:{text:function(){var flag=this.parent.data.status;if(flag==="Available"){return mstrmojo.desc(6792,"Start");}else{return mstrmojo.desc(2554,"Stop");}},visible:function(){var flag=this.parent.data.status;if(flag==="Available"||flag==="BUSY"){return true;}else{return false;}},cssClass:function(){var flag=this.parent.data.status;if(flag==="Available"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-start";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-action-stop";}}},onclick:function(){var flag=this.parent.data.status;if(flag==="Available"){var hgController=mstrApp.getRootController().getHadoopGatewayController(),list=this.parent.parent.parent.parent,data=this.parent.parent.data,editor,dirtyData={};function doStart(){var cfg=$HASH.copy(dirtyData,data.config);hgController.startGateway(cfg,{success:function(){editor.close();}});}hgController.confirmAuthentication(function(user,password){editor=this;dirtyData.user=user;dirtyData.passwd=password;doStart();});}else{var hgController=mstrApp.getRootController().getHadoopGatewayController(),list=this.parent.parent.parent.parent,data=this.parent.parent.data,editor,dirtyData={};function doStop(){var cfg=$HASH.copy(dirtyData,data.config);hgController.stopGateway(cfg,{success:function(){editor.close();}});}hgController.confirmAuthentication(function(user,password){editor=this;dirtyData.user=user;dirtyData.passwd=password;doStop();});}}}]}},{headerText:mstrmojo.desc(14955,"Logs"),colCss:"LogsCol",dataWidget:{scriptClass:"mstrmojo.Button",bindings:{cssClass:function(){var flag=this.parent.data.status;if(flag==="BUSY"){return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-logs normal";}else{return"mstrmojo-di-ui-dialogs-DIHadoopGatewayManagerDialog-grid-logs disable";}},title:function(){var flag=this.parent.data.status;if(flag==="BUSY"){return this.parent.data.config.hostAddr+":/opt/hgos-0.1.0/log/hgos.out";}else{return"";}}}}}]}]});}());