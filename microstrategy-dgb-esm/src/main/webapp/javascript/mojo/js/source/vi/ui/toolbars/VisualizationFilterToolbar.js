(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.css","mstrmojo.EditableLabel");mstrmojo.requiresClsP("mstrmojo.vi.models","EnumPanelTypes","VIComponentMap");var $DOM=mstrmojo.dom,$VI_MODELS=mstrmojo.vi.models,$VI_TYPES=$VI_MODELS.VIComponentMap.TYPES,VI_FILTER_STACK=$VI_TYPES.FILTER_STACK,$CSS=mstrmojo.css;mstrmojo.vi.ui.toolbars.VisualizationFilterToolbar=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout],{filterName:"Visualization Filter 1",placeholder:"",style:"",id:"visualizationFilterToolbar",isEditVisualizationFilter:false,scriptClass:"mstrmojo.vi.ui.toolbars.VisualizationFilterToolbar",markupString:'<div id="{@id}" class="mstrmojo-VIPanel mstrmojo-VisFilterToolbar {@cssClass}" style="position:absolute; z-Index:1000; {@cssText} "><div class="mstrmojo-VisFilterToolbar-contents" style="position:absolute; width: {@width}; display: flex; justify-content: center; color: white "></div><div class="mstrmojo-VisFilterToolbar-btns" style="position:absolute; width: {@width}; display: flex; justify-content: flex-end"></div></div>',markupSlots:{titlebarNode:function titlebarNode(){return this.domNode.firstChild;},btnNode:function btnNode(){return this.domNode.childNodes[1];}},generateVisualizationFilterToolbar:function generateVisualizationFilterToolbar(docModel,filterName,isEditVisfilter){var rootCtrl=docModel&&docModel.controller&&docModel.controller.rootCtrl,rootView=rootCtrl&&rootCtrl.view,menuToolbarNode=rootView&&rootView.menuToolbarNode,visFilterToolbar=mstrmojo.all.visualizationFilterToolbar;if(!visFilterToolbar&&menuToolbarNode){visFilterToolbar=new mstrmojo.vi.ui.toolbars.VisualizationFilterToolbar({rootView:rootView,model:docModel,menuToolbar:menuToolbarNode,placeholder:menuToolbarNode.appendChild(document.createElement("div")),filterName:filterName,isEditVisualizationFilter:isEditVisfilter});visFilterToolbar.render();}return visFilterToolbar;},init:function init(props){var ph=props.menuToolbar,phStyle=ph.style;if(ph){this.cssClass=ph.getAttribute("class");if(!this.cssClass){this.cssClass="";}if(props.hasOwnProperty("width")===false){props.width=(phStyle&&phStyle.width)||(ph.clientWidth+"px");}if(props.hasOwnProperty("height")===false){props.height=(phStyle&&phStyle.height)||(ph.clientHeight+"px");}if(props.hasOwnProperty("left")===false){props.left=ph.offsetLeft+"px";}if(props.hasOwnProperty("top")===false){props.top=(ph.offsetTop)+"px";}}this._super(props);if(!this._listenerProc){var id=this.id,fn=this._listenerProc=function(e){var evt=e||window.event;mstrmojo.all[id].monitorWindow(evt);};$DOM.attachEvent(window,"resize",fn);}if(this.isEditVisualizationFilter){var saveBtn=this.savebtn;this.children.splice(this.children.length-1,1);this.toggleSaveBtn(true);}},layoutConfig:{h:{titlebarNode:"all",containerNode:"all"},xt:true},children:[{scriptClass:"mstrmojo.Label",slot:"titlebarNode",cssClass:"icn",alias:"icn",enabled:true,onclick:function(){console.log("trigger tip windows");}},{scriptClass:"mstrmojo.Label",slot:"titlebarNode",cssClass:"title",text:mstrmojo.desc(15289,"Configure Visualization Filter:"),},{scriptClass:"mstrmojo.EditableLabel",slot:"titlebarNode",cssClass:"filtername",alias:"filterNameLabel",text:this.filterName,editOnClick:false,editOnDoubleClick:true,onTextEditComplete:function(textChanged,oldText){this.set("text",this.text);this.parent.model.getSelectedViUnit().updateDisplayName(this.text,oldText);}},{alias:"savebtn",scriptClass:"mstrmojo.Button",slot:"btnNode",cssClass:"mstrmojo-button mstrmojo-WebButton savebtn emphasized",text:mstrmojo.desc(5891,"Save"),enabled:false,onclick:function(){mstrmojo.all.visualizationFilterToolbar.savefn();}},{alias:"canclebtn",scriptClass:"mstrmojo.Button",slot:"btnNode",cssClass:"mstrmojo-button mstrmojo-WebButton canclebtn primary",text:mstrmojo.desc(221,"Cancel"),onclick:function(){mstrmojo.all.visualizationFilterToolbar.cancelfn();}}],postBuildRendering:function(){this._super();var domNode=this.domNode,index=parseInt(domNode.style.zIndex)+1;domNode.style.width=this.width;domNode.style.height=this.height;domNode.style.top=this.top;domNode.style.left=this.left;this.icn.domNode.style.zIndex=index;this.filterNameLabel.domNode.style.zIndex=index;this.updateDisplayFilterName(this.filterName);},updateDisplayFilterName:function updateDisplayFilterName(displayText){this.filterNameLabel.set("text",displayText);},toggleSaveBtn:function toggleSaveBtn(enable){this.savebtn.set("enabled",enable);},cancelfn:function cancelfn(){var model=this.model,viMap=model.getVIMap(),stack=viMap.getComponent(VI_FILTER_STACK);this.closeToolbar();model.removeVizFilterUnit(false);model.destroyVisualiztionselector();model.controller.rootCtrl.restorePanelStatus(stack);},savefn:function savefn(){var docModel=this.model;if(!this.isEditVisualizationFilter){docModel.saveVisAsSelector();}else{docModel.saveVisSelectorAndExit();}this.closeToolbar();},closeToolbar:function close(){this.destroy();},destroy:function destroy(){var parent=this.menuToolbar;if(parent){parent.removeChild(this.domNode);}if(this._listenerProc){$DOM.detachEvent(window,"resize",this._listenerProc);}this._super();},monitorWindow:function monitorWindow(evt){var currentTarget=evt.currentTarget,winDim=$DOM.windowDim(),browserDimensions={w:Math.max(winDim.w,0)+"px",h:this.height},size={w:(currentTarget?currentTarget.innerWidth+"px":browserDimensions.w),h:this.height};if((size.w===this.width)||parseInt(size.w,10)<=20){return ;}if(!this.browserResized||this.browserResized(size,true)!==true){if(size.w!==this.width){this.set("width",size.w);}}this.titlebarNode.style.width=size.w;this.btnNode.style.width=size.w;}});}());