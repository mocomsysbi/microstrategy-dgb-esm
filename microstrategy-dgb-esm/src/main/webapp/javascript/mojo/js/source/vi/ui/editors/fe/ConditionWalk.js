(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.expr","mstrmojo.css","mstrmojo.Button","mstrmojo.Label","mstrmojo.rw.ConditionWalk","mstrmojo.ui.Pulldown","mstrmojo.ui.Checkbox","mstrmojo.ui._IsIncFetchList","mstrmojo.ui.ColumnWalk","mstrmojo.mstr.DocElementDataHelper");var $MQ=mstrmojo.expr.ET.MQ,$MC=mstrmojo.expr.ET.MC,$CSS=mstrmojo.css,idcsiText=mstrmojo.desc(14387,"Evaluate this condition independent of other dataset level conditions");var showTools=function(conditionData,level){var et=conditionData.et,datasets=this.parent&&this.parent.docModel&&this.parent.docModel.datasets,isMdxDM=conditionData.m&&mstrmojo.rw.ConditionWalk.isMdxDM(conditionData.m.did,datasets),visible=((et===$MQ||et===$MC)&&!this.inRelation&&!isMdxDM)?"block":"none",selectLevel=(((level===1)||et!==$MQ)&&!isMdxDM)?1:0;$CSS.toggleClass(this.toolNode,"unselectable",et===$MC);this.toolNode.style.display=visible;this.level.set("selectedIndex",selectLevel);this.includeExist.set("visible",selectLevel===1&&(et===$MC||et===$MQ));this.includeExist.set("checked",conditionData.idcsi===undefined?false:conditionData.idcsi);};mstrmojo.vi.ui.editors.fe.ConditionWalk=mstrmojo.declare(mstrmojo.rw.ConditionWalk,[mstrmojo.ui._IsIncFetchList],{scriptClass:"mstrmojo.vi.ui.editors.fe.ConditionWalk",markupString:'<div class="mstrmojo-rw-ConditionWalk" mstrAttach:click><div class="condition mstrmojo-ConditionNode"><div class="mstrmojo-cond-contents"></div></div><div class="walk"></div><div class="tools"></div><div class="apply"></div></div>',markupSlots:mstrmojo.hash.copy({toolNode:function(){return this.domNode.childNodes[2];}},mstrmojo.hash.copy(mstrmojo.rw.ConditionWalk.prototype.markupSlots)),layoutConfig:{h:{conditionNode:"auto",walkNode:"100%",toolNode:"auto",applyNode:"auto"},xt:true},children:[{scriptClass:"mstrmojo.ui.ColumnWalk",alias:"columnWalk",slot:"walkNode",height:"333px",width:"800px"},{alias:"cancelBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"cancelBtn",title:mstrmojo.desc(2399,"Cancel"),ignoreLayout:true,onclick:function(){var p=this.parent;if(p.close){p.close();}}},{alias:"okBtn",slot:"applyNode",scriptClass:"mstrmojo.Button",cssClass:"okBtn",title:mstrmojo.desc(2397,"OK"),onclick:function(){var p=this.parent;if(p.onOK){p.onOK();}}},{scriptClass:"mstrmojo.Label",alias:"tip",slot:"applyNode",cssClass:"tip",text:"",ignoreLayout:true}],init:function init(props){this._super(props);this.attachEventListener("conditionWalkUpdateOkBtn",this.id,function(evt){var valid=evt.valid,editor=this.parent;editor.toggleOkButtonStatus(valid);});},postCreate:function postCreate(){this.children=mstrmojo.hash.clone(this.children).concat([{scriptClass:"mstrmojo.Label",slot:"toolNode",text:mstrmojo.desc(13517,"Calculate on")},{scriptClass:"mstrmojo.ui.Pulldown",slot:"toolNode",alias:"level",isHostedWithin:false,items:[{n:mstrmojo.desc(13518,"Template level"),v:0},{n:mstrmojo.desc(13519,"Dataset level"),v:1}],onitemSelected:function onitemSelected(item){var p=this.parent;if(p&&p.condition&&p.visible){p.includeExist.set("visible",item.v===1);p.condition.level=item.v;}}},{scriptClass:"mstrmojo.ui.Checkbox",alias:"includeExist",slot:"toolNode",postBuildRendering:function(){this.domNode.innerHTML=idcsiText;},oncheckedChange:function(){var p=this.parent;if(p){p.model.set("idcsi",this.checked);}}}]);if(this._super){this._super();}},onvisibleChange:function onvisibleChange(evt){var cond=this.condition;if(cond&&this.toolNode&&this.visible){showTools.call(this,cond.data,cond.tree.level);}if(this._super){this._super(evt);}},onmodeledit:function onmodeledit(evt){if(this._super){this._super(evt);}if(this.toolNode){showTools.call(this,this.model.get(),this.model.level);}},getAttributeForms:function getAttributeForms(did){return mstrmojo.rw.ConditionWalk.getAttForms(did,this.editor.docModel.datasets);},getElements:function getElements(attribute,callback){var params={},fn=callback.complete,me=this;this.scrollNode=this.columnWalk.es.scrollNode;var scrollNodeStyle=this.scrollNode&&this.scrollNode.style;if(scrollNodeStyle){scrollNodeStyle.height="100%";}if(!this.ifDataHelper){this.ifDataHelper=new mstrmojo.mstr.DocElementDataHelper({source:this.editor.docModel.getDataService()});}else{this.ifDataHelper.set("items",null);}this.columnWalk.es.es.allowUnlistedValues=false;this.updateBrowseElementsParams(params,attribute);this.ifDataHelper.browseConfig=params;callback=mstrmojo.func.wrapMethods(callback,{complete:function(res){me.initScroll();}});this.ifDataHelper.getItems(1,callback);},postNext:function postNext(){this.columnWalk.es.updateList(this.ifDataHelper.items);}});}());